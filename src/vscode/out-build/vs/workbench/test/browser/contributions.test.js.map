{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/test/browser/contributions.test.ts","vs/workbench/test/browser/contributions.test.ts"],"names":[],"mappings":"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","file":"contributions.test.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport assert from 'assert';\nimport { DeferredPromise } from '../../../base/common/async.js';\nimport { DisposableStore } from '../../../base/common/lifecycle.js';\nimport { isCI } from '../../../base/common/platform.js';\nimport { URI } from '../../../base/common/uri.js';\nimport { ensureNoDisposablesAreLeakedInTestSuite } from '../../../base/test/common/utils.js';\nimport { SyncDescriptor } from '../../../platform/instantiation/common/descriptors.js';\nimport { ServiceCollection } from '../../../platform/instantiation/common/serviceCollection.js';\nimport { EditorPart } from '../../browser/parts/editor/editorPart.js';\nimport { WorkbenchPhase, WorkbenchContributionsRegistry } from '../../common/contributions.js';\nimport { EditorService } from '../../services/editor/browser/editorService.js';\nimport { IEditorGroupsService } from '../../services/editor/common/editorGroupsService.js';\nimport { IEditorService, SIDE_GROUP } from '../../services/editor/common/editorService.js';\nimport { LifecyclePhase } from '../../services/lifecycle/common/lifecycle.js';\nimport { ITestInstantiationService, TestFileEditorInput, TestServiceAccessor, TestSingletonFileEditorInput, createEditorPart, registerTestEditor, workbenchInstantiationService } from './workbenchTestServices.js';\n\nsuite('Contributions', () => {\n\tconst disposables = new DisposableStore();\n\n\tlet aCreated: boolean;\n\tlet aCreatedPromise: DeferredPromise<void>;\n\n\tlet bCreated: boolean;\n\tlet bCreatedPromise: DeferredPromise<void>;\n\n\tconst TEST_EDITOR_ID = 'MyTestEditorForContributions';\n\tconst TEST_EDITOR_INPUT_ID = 'testEditorInputForContributions';\n\n\tasync function createEditorService(instantiationService: ITestInstantiationService = workbenchInstantiationService(undefined, disposables)): Promise<[EditorPart, EditorService]> {\n\t\tconst part = await createEditorPart(instantiationService, disposables);\n\t\tinstantiationService.stub(IEditorGroupsService, part);\n\n\t\tconst editorService = disposables.add(instantiationService.createInstance(EditorService, undefined));\n\t\tinstantiationService.stub(IEditorService, editorService);\n\n\t\treturn [part, editorService];\n\t}\n\n\tsetup(() => {\n\t\taCreated = false;\n\t\taCreatedPromise = new DeferredPromise<void>();\n\n\t\tbCreated = false;\n\t\tbCreatedPromise = new DeferredPromise<void>();\n\n\t\tdisposables.add(registerTestEditor(TEST_EDITOR_ID, [new SyncDescriptor(TestFileEditorInput), new SyncDescriptor(TestSingletonFileEditorInput)], TEST_EDITOR_INPUT_ID));\n\t});\n\n\tteardown(async () => {\n\t\tdisposables.clear();\n\t});\n\n\tclass TestContributionA {\n\t\tconstructor() {\n\t\t\taCreated = true;\n\t\t\taCreatedPromise.complete();\n\t\t}\n\t}\n\tclass TestContributionB {\n\t\tconstructor() {\n\t\t\tbCreated = true;\n\t\t\tbCreatedPromise.complete();\n\t\t}\n\t}\n\tclass TestContributionError {\n\t\tconstructor() {\n\t\t\tthrow new Error();\n\t\t}\n\t}\n\n\ttest('getWorkbenchContribution() - with lazy contributions', () => {\n\t\tconst registry = disposables.add(new WorkbenchContributionsRegistry());\n\n\t\tassert.throws(() => registry.getWorkbenchContribution('a'));\n\n\t\tregistry.registerWorkbenchContribution2('a', TestContributionA, { lazy: true });\n\t\tassert.throws(() => registry.getWorkbenchContribution('a'));\n\n\t\tregistry.registerWorkbenchContribution2('b', TestContributionB, { lazy: true });\n\t\tregistry.registerWorkbenchContribution2('c', TestContributionError, { lazy: true });\n\n\t\tconst instantiationService = workbenchInstantiationService(undefined, disposables);\n\t\tregistry.start(instantiationService);\n\n\t\tconst instanceA = registry.getWorkbenchContribution('a');\n\t\tassert.ok(instanceA instanceof TestContributionA);\n\t\tassert.ok(aCreated);\n\t\tassert.strictEqual(instanceA, registry.getWorkbenchContribution('a'));\n\n\t\tconst instanceB = registry.getWorkbenchContribution('b');\n\t\tassert.ok(instanceB instanceof TestContributionB);\n\n\t\tassert.throws(() => registry.getWorkbenchContribution('c'));\n\t});\n\n\ttest('getWorkbenchContribution() - with non-lazy contributions', async () => {\n\t\tconst registry = disposables.add(new WorkbenchContributionsRegistry());\n\n\t\tconst instantiationService = workbenchInstantiationService(undefined, disposables);\n\t\tconst accessor = instantiationService.createInstance(TestServiceAccessor);\n\t\taccessor.lifecycleService.usePhases = true;\n\t\tregistry.start(instantiationService);\n\n\t\tassert.throws(() => registry.getWorkbenchContribution('a'));\n\n\t\tregistry.registerWorkbenchContribution2('a', TestContributionA, WorkbenchPhase.BlockRestore);\n\n\t\tconst instanceA = registry.getWorkbenchContribution('a');\n\t\tassert.ok(instanceA instanceof TestContributionA);\n\t\tassert.ok(aCreated);\n\n\t\taccessor.lifecycleService.phase = LifecyclePhase.Ready;\n\t\tawait aCreatedPromise.p;\n\n\t\tassert.strictEqual(instanceA, registry.getWorkbenchContribution('a'));\n\t});\n\n\ttest('lifecycle phase instantiation works when phase changes', async () => {\n\t\tconst registry = disposables.add(new WorkbenchContributionsRegistry());\n\n\t\tconst instantiationService = workbenchInstantiationService(undefined, disposables);\n\t\tconst accessor = instantiationService.createInstance(TestServiceAccessor);\n\t\tregistry.start(instantiationService);\n\n\t\tregistry.registerWorkbenchContribution2('a', TestContributionA, WorkbenchPhase.BlockRestore);\n\t\tassert.ok(!aCreated);\n\n\t\taccessor.lifecycleService.phase = LifecyclePhase.Ready;\n\t\tawait aCreatedPromise.p;\n\t\tassert.ok(aCreated);\n\t});\n\n\ttest('lifecycle phase instantiation works when phase was already met', async () => {\n\t\tconst registry = disposables.add(new WorkbenchContributionsRegistry());\n\n\t\tconst instantiationService = workbenchInstantiationService(undefined, disposables);\n\t\tconst accessor = instantiationService.createInstance(TestServiceAccessor);\n\t\taccessor.lifecycleService.usePhases = true;\n\t\taccessor.lifecycleService.phase = LifecyclePhase.Restored;\n\n\t\tregistry.registerWorkbenchContribution2('a', TestContributionA, WorkbenchPhase.BlockRestore);\n\t\tregistry.start(instantiationService);\n\n\t\tawait aCreatedPromise.p;\n\t\tassert.ok(aCreated);\n\t});\n\n\t(isCI ? test.skip /* runWhenIdle seems flaky in CI on Windows */ : test)('lifecycle phase instantiation works for late phases', async () => {\n\t\tconst registry = disposables.add(new WorkbenchContributionsRegistry());\n\n\t\tconst instantiationService = workbenchInstantiationService(undefined, disposables);\n\t\tconst accessor = instantiationService.createInstance(TestServiceAccessor);\n\t\taccessor.lifecycleService.usePhases = true;\n\t\tregistry.start(instantiationService);\n\n\t\tregistry.registerWorkbenchContribution2('a', TestContributionA, WorkbenchPhase.AfterRestored);\n\t\tregistry.registerWorkbenchContribution2('b', TestContributionB, WorkbenchPhase.Eventually);\n\t\tassert.ok(!aCreated);\n\t\tassert.ok(!bCreated);\n\n\t\taccessor.lifecycleService.phase = LifecyclePhase.Starting;\n\t\taccessor.lifecycleService.phase = LifecyclePhase.Ready;\n\t\taccessor.lifecycleService.phase = LifecyclePhase.Restored;\n\t\tawait aCreatedPromise.p;\n\t\tassert.ok(aCreated);\n\n\t\taccessor.lifecycleService.phase = LifecyclePhase.Eventually;\n\t\tawait bCreatedPromise.p;\n\t\tassert.ok(bCreated);\n\t});\n\n\ttest('contribution on editor - editor exists before start', async function () {\n\t\tconst registry = disposables.add(new WorkbenchContributionsRegistry());\n\n\t\tconst instantiationService = workbenchInstantiationService(undefined, disposables);\n\n\t\tconst [, editorService] = await createEditorService(instantiationService);\n\n\t\tconst input = disposables.add(new TestFileEditorInput(URI.parse('my://resource-basics'), TEST_EDITOR_INPUT_ID));\n\t\tawait editorService.openEditor(input, { pinned: true });\n\n\t\tregistry.registerWorkbenchContribution2('a', TestContributionA, { editorTypeId: TEST_EDITOR_ID });\n\t\tregistry.start(instantiationService.createChild(new ServiceCollection([IEditorService, editorService])));\n\n\t\tawait aCreatedPromise.p;\n\t\tassert.ok(aCreated);\n\n\t\tregistry.registerWorkbenchContribution2('b', TestContributionB, { editorTypeId: TEST_EDITOR_ID });\n\n\t\tconst input2 = disposables.add(new TestFileEditorInput(URI.parse('my://resource-basics2'), TEST_EDITOR_INPUT_ID));\n\t\tawait editorService.openEditor(input2, { pinned: true }, SIDE_GROUP);\n\n\t\tawait bCreatedPromise.p;\n\t\tassert.ok(bCreated);\n\t});\n\n\ttest('contribution on editor - editor does not exist before start', async function () {\n\t\tconst registry = disposables.add(new WorkbenchContributionsRegistry());\n\n\t\tconst instantiationService = workbenchInstantiationService(undefined, disposables);\n\n\t\tconst [, editorService] = await createEditorService(instantiationService);\n\n\t\tconst input = disposables.add(new TestFileEditorInput(URI.parse('my://resource-basics'), TEST_EDITOR_INPUT_ID));\n\n\t\tregistry.registerWorkbenchContribution2('a', TestContributionA, { editorTypeId: TEST_EDITOR_ID });\n\t\tregistry.start(instantiationService.createChild(new ServiceCollection([IEditorService, editorService])));\n\n\t\tawait editorService.openEditor(input, { pinned: true });\n\n\t\tawait aCreatedPromise.p;\n\t\tassert.ok(aCreated);\n\t});\n\n\tensureNoDisposablesAreLeakedInTestSuite();\n});\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport assert from 'assert';\nimport { DeferredPromise } from '../../../base/common/async.js';\nimport { DisposableStore } from '../../../base/common/lifecycle.js';\nimport { isCI } from '../../../base/common/platform.js';\nimport { URI } from '../../../base/common/uri.js';\nimport { ensureNoDisposablesAreLeakedInTestSuite } from '../../../base/test/common/utils.js';\nimport { SyncDescriptor } from '../../../platform/instantiation/common/descriptors.js';\nimport { ServiceCollection } from '../../../platform/instantiation/common/serviceCollection.js';\nimport { EditorPart } from '../../browser/parts/editor/editorPart.js';\nimport { WorkbenchPhase, WorkbenchContributionsRegistry } from '../../common/contributions.js';\nimport { EditorService } from '../../services/editor/browser/editorService.js';\nimport { IEditorGroupsService } from '../../services/editor/common/editorGroupsService.js';\nimport { IEditorService, SIDE_GROUP } from '../../services/editor/common/editorService.js';\nimport { LifecyclePhase } from '../../services/lifecycle/common/lifecycle.js';\nimport { ITestInstantiationService, TestFileEditorInput, TestServiceAccessor, TestSingletonFileEditorInput, createEditorPart, registerTestEditor, workbenchInstantiationService } from './workbenchTestServices.js';\n\nsuite('Contributions', () => {\n\tconst disposables = new DisposableStore();\n\n\tlet aCreated: boolean;\n\tlet aCreatedPromise: DeferredPromise<void>;\n\n\tlet bCreated: boolean;\n\tlet bCreatedPromise: DeferredPromise<void>;\n\n\tconst TEST_EDITOR_ID = 'MyTestEditorForContributions';\n\tconst TEST_EDITOR_INPUT_ID = 'testEditorInputForContributions';\n\n\tasync function createEditorService(instantiationService: ITestInstantiationService = workbenchInstantiationService(undefined, disposables)): Promise<[EditorPart, EditorService]> {\n\t\tconst part = await createEditorPart(instantiationService, disposables);\n\t\tinstantiationService.stub(IEditorGroupsService, part);\n\n\t\tconst editorService = disposables.add(instantiationService.createInstance(EditorService, undefined));\n\t\tinstantiationService.stub(IEditorService, editorService);\n\n\t\treturn [part, editorService];\n\t}\n\n\tsetup(() => {\n\t\taCreated = false;\n\t\taCreatedPromise = new DeferredPromise<void>();\n\n\t\tbCreated = false;\n\t\tbCreatedPromise = new DeferredPromise<void>();\n\n\t\tdisposables.add(registerTestEditor(TEST_EDITOR_ID, [new SyncDescriptor(TestFileEditorInput), new SyncDescriptor(TestSingletonFileEditorInput)], TEST_EDITOR_INPUT_ID));\n\t});\n\n\tteardown(async () => {\n\t\tdisposables.clear();\n\t});\n\n\tclass TestContributionA {\n\t\tconstructor() {\n\t\t\taCreated = true;\n\t\t\taCreatedPromise.complete();\n\t\t}\n\t}\n\tclass TestContributionB {\n\t\tconstructor() {\n\t\t\tbCreated = true;\n\t\t\tbCreatedPromise.complete();\n\t\t}\n\t}\n\tclass TestContributionError {\n\t\tconstructor() {\n\t\t\tthrow new Error();\n\t\t}\n\t}\n\n\ttest('getWorkbenchContribution() - with lazy contributions', () => {\n\t\tconst registry = disposables.add(new WorkbenchContributionsRegistry());\n\n\t\tassert.throws(() => registry.getWorkbenchContribution('a'));\n\n\t\tregistry.registerWorkbenchContribution2('a', TestContributionA, { lazy: true });\n\t\tassert.throws(() => registry.getWorkbenchContribution('a'));\n\n\t\tregistry.registerWorkbenchContribution2('b', TestContributionB, { lazy: true });\n\t\tregistry.registerWorkbenchContribution2('c', TestContributionError, { lazy: true });\n\n\t\tconst instantiationService = workbenchInstantiationService(undefined, disposables);\n\t\tregistry.start(instantiationService);\n\n\t\tconst instanceA = registry.getWorkbenchContribution('a');\n\t\tassert.ok(instanceA instanceof TestContributionA);\n\t\tassert.ok(aCreated);\n\t\tassert.strictEqual(instanceA, registry.getWorkbenchContribution('a'));\n\n\t\tconst instanceB = registry.getWorkbenchContribution('b');\n\t\tassert.ok(instanceB instanceof TestContributionB);\n\n\t\tassert.throws(() => registry.getWorkbenchContribution('c'));\n\t});\n\n\ttest('getWorkbenchContribution() - with non-lazy contributions', async () => {\n\t\tconst registry = disposables.add(new WorkbenchContributionsRegistry());\n\n\t\tconst instantiationService = workbenchInstantiationService(undefined, disposables);\n\t\tconst accessor = instantiationService.createInstance(TestServiceAccessor);\n\t\taccessor.lifecycleService.usePhases = true;\n\t\tregistry.start(instantiationService);\n\n\t\tassert.throws(() => registry.getWorkbenchContribution('a'));\n\n\t\tregistry.registerWorkbenchContribution2('a', TestContributionA, WorkbenchPhase.BlockRestore);\n\n\t\tconst instanceA = registry.getWorkbenchContribution('a');\n\t\tassert.ok(instanceA instanceof TestContributionA);\n\t\tassert.ok(aCreated);\n\n\t\taccessor.lifecycleService.phase = LifecyclePhase.Ready;\n\t\tawait aCreatedPromise.p;\n\n\t\tassert.strictEqual(instanceA, registry.getWorkbenchContribution('a'));\n\t});\n\n\ttest('lifecycle phase instantiation works when phase changes', async () => {\n\t\tconst registry = disposables.add(new WorkbenchContributionsRegistry());\n\n\t\tconst instantiationService = workbenchInstantiationService(undefined, disposables);\n\t\tconst accessor = instantiationService.createInstance(TestServiceAccessor);\n\t\tregistry.start(instantiationService);\n\n\t\tregistry.registerWorkbenchContribution2('a', TestContributionA, WorkbenchPhase.BlockRestore);\n\t\tassert.ok(!aCreated);\n\n\t\taccessor.lifecycleService.phase = LifecyclePhase.Ready;\n\t\tawait aCreatedPromise.p;\n\t\tassert.ok(aCreated);\n\t});\n\n\ttest('lifecycle phase instantiation works when phase was already met', async () => {\n\t\tconst registry = disposables.add(new WorkbenchContributionsRegistry());\n\n\t\tconst instantiationService = workbenchInstantiationService(undefined, disposables);\n\t\tconst accessor = instantiationService.createInstance(TestServiceAccessor);\n\t\taccessor.lifecycleService.usePhases = true;\n\t\taccessor.lifecycleService.phase = LifecyclePhase.Restored;\n\n\t\tregistry.registerWorkbenchContribution2('a', TestContributionA, WorkbenchPhase.BlockRestore);\n\t\tregistry.start(instantiationService);\n\n\t\tawait aCreatedPromise.p;\n\t\tassert.ok(aCreated);\n\t});\n\n\t(isCI ? test.skip /* runWhenIdle seems flaky in CI on Windows */ : test)('lifecycle phase instantiation works for late phases', async () => {\n\t\tconst registry = disposables.add(new WorkbenchContributionsRegistry());\n\n\t\tconst instantiationService = workbenchInstantiationService(undefined, disposables);\n\t\tconst accessor = instantiationService.createInstance(TestServiceAccessor);\n\t\taccessor.lifecycleService.usePhases = true;\n\t\tregistry.start(instantiationService);\n\n\t\tregistry.registerWorkbenchContribution2('a', TestContributionA, WorkbenchPhase.AfterRestored);\n\t\tregistry.registerWorkbenchContribution2('b', TestContributionB, WorkbenchPhase.Eventually);\n\t\tassert.ok(!aCreated);\n\t\tassert.ok(!bCreated);\n\n\t\taccessor.lifecycleService.phase = LifecyclePhase.Starting;\n\t\taccessor.lifecycleService.phase = LifecyclePhase.Ready;\n\t\taccessor.lifecycleService.phase = LifecyclePhase.Restored;\n\t\tawait aCreatedPromise.p;\n\t\tassert.ok(aCreated);\n\n\t\taccessor.lifecycleService.phase = LifecyclePhase.Eventually;\n\t\tawait bCreatedPromise.p;\n\t\tassert.ok(bCreated);\n\t});\n\n\ttest('contribution on editor - editor exists before start', async function () {\n\t\tconst registry = disposables.add(new WorkbenchContributionsRegistry());\n\n\t\tconst instantiationService = workbenchInstantiationService(undefined, disposables);\n\n\t\tconst [, editorService] = await createEditorService(instantiationService);\n\n\t\tconst input = disposables.add(new TestFileEditorInput(URI.parse('my://resource-basics'), TEST_EDITOR_INPUT_ID));\n\t\tawait editorService.openEditor(input, { pinned: true });\n\n\t\tregistry.registerWorkbenchContribution2('a', TestContributionA, { editorTypeId: TEST_EDITOR_ID });\n\t\tregistry.start(instantiationService.createChild(new ServiceCollection([IEditorService, editorService])));\n\n\t\tawait aCreatedPromise.p;\n\t\tassert.ok(aCreated);\n\n\t\tregistry.registerWorkbenchContribution2('b', TestContributionB, { editorTypeId: TEST_EDITOR_ID });\n\n\t\tconst input2 = disposables.add(new TestFileEditorInput(URI.parse('my://resource-basics2'), TEST_EDITOR_INPUT_ID));\n\t\tawait editorService.openEditor(input2, { pinned: true }, SIDE_GROUP);\n\n\t\tawait bCreatedPromise.p;\n\t\tassert.ok(bCreated);\n\t});\n\n\ttest('contribution on editor - editor does not exist before start', async function () {\n\t\tconst registry = disposables.add(new WorkbenchContributionsRegistry());\n\n\t\tconst instantiationService = workbenchInstantiationService(undefined, disposables);\n\n\t\tconst [, editorService] = await createEditorService(instantiationService);\n\n\t\tconst input = disposables.add(new TestFileEditorInput(URI.parse('my://resource-basics'), TEST_EDITOR_INPUT_ID));\n\n\t\tregistry.registerWorkbenchContribution2('a', TestContributionA, { editorTypeId: TEST_EDITOR_ID });\n\t\tregistry.start(instantiationService.createChild(new ServiceCollection([IEditorService, editorService])));\n\n\t\tawait editorService.openEditor(input, { pinned: true });\n\n\t\tawait aCreatedPromise.p;\n\t\tassert.ok(aCreated);\n\t});\n\n\tensureNoDisposablesAreLeakedInTestSuite();\n});\n"]}