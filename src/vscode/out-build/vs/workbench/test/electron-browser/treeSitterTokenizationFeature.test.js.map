{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/test/electron-browser/treeSitterTokenizationFeature.test.ts","vs/workbench/test/electron-browser/treeSitterTokenizationFeature.test.ts"],"names":[],"mappings":"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","file":"treeSitterTokenizationFeature.test.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport assert from 'assert';\nimport { TestInstantiationService } from '../../../platform/instantiation/test/common/instantiationServiceMock.js';\nimport { ensureNoDisposablesAreLeakedInTestSuite } from '../../../base/test/common/utils.js';\nimport { IModelService } from '../../../editor/common/services/model.js';\nimport { Event } from '../../../base/common/event.js';\nimport { URI } from '../../../base/common/uri.js';\nimport { IFileService } from '../../../platform/files/common/files.js';\nimport { ILogService, NullLogService } from '../../../platform/log/common/log.js';\nimport { ITelemetryData, ITelemetryService, TelemetryLevel } from '../../../platform/telemetry/common/telemetry.js';\nimport { ClassifiedEvent, OmitMetadata, IGDPRProperty, StrictPropertyCheck } from '../../../platform/telemetry/common/gdprTypings.js';\nimport { IConfigurationService } from '../../../platform/configuration/common/configuration.js';\nimport { TestConfigurationService } from '../../../platform/configuration/test/common/testConfigurationService.js';\nimport { IEnvironmentService } from '../../../platform/environment/common/environment.js';\nimport { ModelService } from '../../../editor/common/services/modelService.js';\n\nimport { FileService } from '../../../platform/files/common/fileService.js';\nimport { Schemas } from '../../../base/common/network.js';\nimport { TestIPCFileSystemProvider } from './workbenchTestServices.js';\nimport { ILanguageService } from '../../../editor/common/languages/language.js';\nimport { LanguageService } from '../../../editor/common/services/languageService.js';\nimport { TestColorTheme, TestThemeService } from '../../../platform/theme/test/common/testThemeService.js';\nimport { IThemeService } from '../../../platform/theme/common/themeService.js';\nimport { ITextResourcePropertiesService } from '../../../editor/common/services/textResourceConfiguration.js';\nimport { TestTextResourcePropertiesService } from '../common/workbenchTestServices.js';\nimport { TestLanguageConfigurationService } from '../../../editor/test/common/modes/testLanguageConfigurationService.js';\nimport { ILanguageConfigurationService } from '../../../editor/common/languages/languageConfigurationRegistry.js';\nimport { IUndoRedoService } from '../../../platform/undoRedo/common/undoRedo.js';\nimport { UndoRedoService } from '../../../platform/undoRedo/common/undoRedoService.js';\nimport { TestDialogService } from '../../../platform/dialogs/test/common/testDialogService.js';\nimport { TestNotificationService } from '../../../platform/notification/test/common/testNotificationService.js';\nimport { DisposableStore, IDisposable } from '../../../base/common/lifecycle.js';\nimport { ProbeScope, TokenStyle } from '../../../platform/theme/common/tokenClassificationRegistry.js';\nimport { TextMateThemingRuleDefinitions } from '../../services/themes/common/colorThemeData.js';\nimport { Color } from '../../../base/common/color.js';\nimport { Range } from '../../../editor/common/core/range.js';\nimport { TokenUpdate } from '../../../editor/common/model/tokens/treeSitter/tokenStore.js';\nimport { ITreeSitterLibraryService } from '../../../editor/common/services/treeSitter/treeSitterLibraryService.js';\nimport { TreeSitterLibraryService } from '../../services/treeSitter/browser/treeSitterLibraryService.js';\nimport { TokenizationTextModelPart } from '../../../editor/common/model/tokens/tokenizationTextModelPart.js';\nimport { TreeSitterSyntaxTokenBackend } from '../../../editor/common/model/tokens/treeSitter/treeSitterSyntaxTokenBackend.js';\nimport { TreeParseUpdateEvent, TreeSitterTree } from '../../../editor/common/model/tokens/treeSitter/treeSitterTree.js';\nimport { ITextModel } from '../../../editor/common/model.js';\nimport { TreeSitterTokenizationImpl } from '../../../editor/common/model/tokens/treeSitter/treeSitterTokenizationImpl.js';\nimport { autorunHandleChanges, recordChanges, waitForState } from '../../../base/common/observable.js';\nimport { ITreeSitterThemeService } from '../../../editor/common/services/treeSitter/treeSitterThemeService.js';\nimport { TreeSitterThemeService } from '../../services/treeSitter/browser/treeSitterThemeService.js';\n\nclass MockTelemetryService implements ITelemetryService {\n\t_serviceBrand: undefined;\n\ttelemetryLevel: TelemetryLevel = TelemetryLevel.NONE;\n\tsessionId: string = '';\n\tmachineId: string = '';\n\tsqmId: string = '';\n\tdevDeviceId: string = '';\n\tfirstSessionDate: string = '';\n\tsendErrorTelemetry: boolean = false;\n\tpublicLog(eventName: string, data?: ITelemetryData): void {\n\t}\n\tpublicLog2<E extends ClassifiedEvent<OmitMetadata<T>> = never, T extends IGDPRProperty = never>(eventName: string, data?: StrictPropertyCheck<T, E>): void {\n\t}\n\tpublicLogError(errorEventName: string, data?: ITelemetryData): void {\n\t}\n\tpublicLogError2<E extends ClassifiedEvent<OmitMetadata<T>> = never, T extends IGDPRProperty = never>(eventName: string, data?: StrictPropertyCheck<T, E>): void {\n\t}\n\tsetExperimentProperty(name: string, value: string): void {\n\t}\n}\n\n\nclass TestTreeSitterColorTheme extends TestColorTheme {\n\tpublic resolveScopes(scopes: ProbeScope[], definitions?: TextMateThemingRuleDefinitions): TokenStyle | undefined {\n\t\treturn new TokenStyle(Color.red, undefined, undefined, undefined, undefined);\n\t}\n\tpublic getTokenColorIndex(): { get: () => number } {\n\t\treturn { get: () => 10 };\n\t}\n}\n\nsuite('Tree Sitter TokenizationFeature', function () {\n\n\tlet instantiationService: TestInstantiationService;\n\tlet modelService: IModelService;\n\tlet fileService: IFileService;\n\tlet textResourcePropertiesService: ITextResourcePropertiesService;\n\tlet languageConfigurationService: ILanguageConfigurationService;\n\tlet telemetryService: ITelemetryService;\n\tlet logService: ILogService;\n\tlet configurationService: IConfigurationService;\n\tlet themeService: IThemeService;\n\tlet languageService: ILanguageService;\n\tlet environmentService: IEnvironmentService;\n\n\tlet disposables: DisposableStore;\n\n\tsetup(async () => {\n\t\tdisposables = new DisposableStore();\n\t\tinstantiationService = disposables.add(new TestInstantiationService());\n\n\t\ttelemetryService = new MockTelemetryService();\n\t\tlogService = new NullLogService();\n\t\tconfigurationService = new TestConfigurationService({ 'editor.experimental.preferTreeSitter.typescript': true });\n\t\tthemeService = new TestThemeService(new TestTreeSitterColorTheme());\n\t\tenvironmentService = {} as IEnvironmentService;\n\n\t\tinstantiationService.set(IEnvironmentService, environmentService);\n\t\tinstantiationService.set(IConfigurationService, configurationService);\n\t\tinstantiationService.set(ILogService, logService);\n\t\tinstantiationService.set(ITelemetryService, telemetryService);\n\t\tlanguageService = disposables.add(instantiationService.createInstance(LanguageService));\n\t\tinstantiationService.set(ILanguageService, languageService);\n\t\tinstantiationService.set(IThemeService, themeService);\n\t\ttextResourcePropertiesService = instantiationService.createInstance(TestTextResourcePropertiesService);\n\t\tinstantiationService.set(ITextResourcePropertiesService, textResourcePropertiesService);\n\t\tlanguageConfigurationService = disposables.add(instantiationService.createInstance(TestLanguageConfigurationService));\n\t\tinstantiationService.set(ILanguageConfigurationService, languageConfigurationService);\n\n\t\tfileService = disposables.add(instantiationService.createInstance(FileService));\n\t\tconst fileSystemProvider = new TestIPCFileSystemProvider();\n\t\tdisposables.add(fileService.registerProvider(Schemas.file, fileSystemProvider));\n\t\tinstantiationService.set(IFileService, fileService);\n\n\t\tconst libraryService = disposables.add(instantiationService.createInstance(TreeSitterLibraryService));\n\t\tlibraryService.isTest = true;\n\t\tinstantiationService.set(ITreeSitterLibraryService, libraryService);\n\n\t\tinstantiationService.set(ITreeSitterThemeService, instantiationService.createInstance(TreeSitterThemeService));\n\n\t\tconst dialogService = new TestDialogService();\n\t\tconst notificationService = new TestNotificationService();\n\t\tconst undoRedoService = new UndoRedoService(dialogService, notificationService);\n\t\tinstantiationService.set(IUndoRedoService, undoRedoService);\n\t\tmodelService = new ModelService(\n\t\t\tconfigurationService,\n\t\t\ttextResourcePropertiesService,\n\t\t\tundoRedoService,\n\t\t\tinstantiationService\n\t\t);\n\t\tinstantiationService.set(IModelService, modelService);\n\t});\n\n\tteardown(() => {\n\t\tdisposables.dispose();\n\t});\n\n\tensureNoDisposablesAreLeakedInTestSuite();\n\n\tfunction tokensContentSize(tokens: TokenUpdate[]) {\n\t\treturn tokens[tokens.length - 1].startOffsetInclusive + tokens[tokens.length - 1].length;\n\t}\n\n\tlet nameNumber = 1;\n\tasync function getModelAndPrepTree(content: string): Promise<{ model: ITextModel; treeSitterTree: TreeSitterTree; tokenizationImpl: TreeSitterTokenizationImpl }> {\n\t\tconst model = disposables.add(modelService.createModel(content, { languageId: 'typescript', onDidChange: Event.None }, URI.file(`file${nameNumber++}.ts`)));\n\t\tconst treeSitterTreeObs = disposables.add((model.tokenization as TokenizationTextModelPart).tokens.get() as TreeSitterSyntaxTokenBackend).tree;\n\t\tconst tokenizationImplObs = disposables.add((model.tokenization as TokenizationTextModelPart).tokens.get() as TreeSitterSyntaxTokenBackend).tokenizationImpl;\n\t\tconst treeSitterTree = treeSitterTreeObs.get() ?? await waitForState(treeSitterTreeObs);\n\t\tif (!treeSitterTree.tree.get()) {\n\t\t\tawait waitForState(treeSitterTree.tree);\n\t\t}\n\t\tconst tokenizationImpl = tokenizationImplObs.get() ?? await waitForState(tokenizationImplObs);\n\n\t\tassert.ok(treeSitterTree);\n\t\treturn { model, treeSitterTree, tokenizationImpl };\n\t}\n\n\tfunction verifyTokens(tokens: TokenUpdate[] | undefined) {\n\t\tassert.ok(tokens);\n\t\tfor (let i = 1; i < tokens.length; i++) {\n\t\t\tconst previousToken: TokenUpdate = tokens[i - 1];\n\t\t\tconst token: TokenUpdate = tokens[i];\n\t\t\tassert.deepStrictEqual(previousToken.startOffsetInclusive + previousToken.length, token.startOffsetInclusive);\n\t\t}\n\t}\n\n\ttest('Three changes come back to back ', async () => {\n\t\tconst content = `/**\n**/\nclass x {\n}\n\n\n\n\nclass y {\n}`;\n\t\tconst { model, treeSitterTree } = await getModelAndPrepTree(content);\n\n\t\tlet updateListener: IDisposable | undefined;\n\t\tconst changePromise = new Promise<TreeParseUpdateEvent | undefined>(resolve => {\n\t\t\tupdateListener = autorunHandleChanges({\n\t\t\t\towner: this,\n\t\t\t\tchangeTracker: recordChanges({ tree: treeSitterTree.tree }),\n\t\t\t}, (reader, ctx) => {\n\t\t\t\tconst changeEvent = ctx.changes.at(0)?.change;\n\t\t\t\tif (changeEvent) {\n\t\t\t\t\tresolve(changeEvent);\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\n\t\tconst edit1 = new Promise<void>(resolve => {\n\t\t\tmodel.applyEdits([{ range: new Range(7, 1, 8, 1), text: '' }]);\n\t\t\tresolve();\n\t\t});\n\t\tconst edit2 = new Promise<void>(resolve => {\n\t\t\tmodel.applyEdits([{ range: new Range(6, 1, 7, 1), text: '' }]);\n\t\t\tresolve();\n\t\t});\n\t\tconst edit3 = new Promise<void>(resolve => {\n\t\t\tmodel.applyEdits([{ range: new Range(5, 1, 6, 1), text: '' }]);\n\t\t\tresolve();\n\t\t});\n\t\tconst edits = Promise.all([edit1, edit2, edit3]);\n\t\tconst change = await changePromise;\n\t\tawait edits;\n\t\tassert.ok(change);\n\n\t\tassert.strictEqual(change.versionId, 4);\n\t\tassert.strictEqual(change.ranges[0].newRangeStartOffset, 0);\n\t\tassert.strictEqual(change.ranges[0].newRangeEndOffset, 32);\n\t\tassert.strictEqual(change.ranges[0].newRange.startLineNumber, 1);\n\t\tassert.strictEqual(change.ranges[0].newRange.endLineNumber, 7);\n\n\t\tupdateListener?.dispose();\n\t\tmodelService.destroyModel(model.uri);\n\t});\n\n\ttest('File single line file', async () => {\n\t\tconst content = `console.log('x');`;\n\t\tconst { model, tokenizationImpl } = await getModelAndPrepTree(content);\n\t\tconst tokens = tokenizationImpl.getTokensInRange(new Range(1, 1, 1, 18), 0, 17);\n\t\tverifyTokens(tokens);\n\t\tassert.deepStrictEqual(tokens?.length, 9);\n\t\tassert.deepStrictEqual(tokensContentSize(tokens), content.length);\n\t\tmodelService.destroyModel(model.uri);\n\t});\n\n\ttest('File with new lines at beginning and end', async () => {\n\t\tconst content = `\nconsole.log('x');\n`;\n\t\tconst { model, tokenizationImpl } = await getModelAndPrepTree(content);\n\t\tconst tokens = tokenizationImpl.getTokensInRange(new Range(1, 1, 3, 1), 0, 19);\n\t\tverifyTokens(tokens);\n\t\tassert.deepStrictEqual(tokens?.length, 11);\n\t\tassert.deepStrictEqual(tokensContentSize(tokens), content.length);\n\t\tmodelService.destroyModel(model.uri);\n\t});\n\n\ttest('File with new lines at beginning and end \\\\r\\\\n', async () => {\n\t\tconst content = '\\r\\nconsole.log(\\'x\\');\\r\\n';\n\t\tconst { model, tokenizationImpl } = await getModelAndPrepTree(content);\n\t\tconst tokens = tokenizationImpl.getTokensInRange(new Range(1, 1, 3, 1), 0, 21);\n\t\tverifyTokens(tokens);\n\t\tassert.deepStrictEqual(tokens?.length, 11);\n\t\tassert.deepStrictEqual(tokensContentSize(tokens), content.length);\n\t\tmodelService.destroyModel(model.uri);\n\t});\n\n\ttest('File with empty lines in the middle', async () => {\n\t\tconst content = `\nconsole.log('x');\n\nconsole.log('7');\n`;\n\t\tconst { model, tokenizationImpl } = await getModelAndPrepTree(content);\n\t\tconst tokens = tokenizationImpl.getTokensInRange(new Range(1, 1, 5, 1), 0, 38);\n\t\tverifyTokens(tokens);\n\t\tassert.deepStrictEqual(tokens?.length, 21);\n\t\tassert.deepStrictEqual(tokensContentSize(tokens), content.length);\n\t\tmodelService.destroyModel(model.uri);\n\t});\n\n\ttest('File with empty lines in the middle \\\\r\\\\n', async () => {\n\t\tconst content = '\\r\\nconsole.log(\\'x\\');\\r\\n\\r\\nconsole.log(\\'7\\');\\r\\n';\n\t\tconst { model, tokenizationImpl } = await getModelAndPrepTree(content);\n\t\tconst tokens = tokenizationImpl.getTokensInRange(new Range(1, 1, 5, 1), 0, 42);\n\t\tverifyTokens(tokens);\n\t\tassert.deepStrictEqual(tokens?.length, 21);\n\t\tassert.deepStrictEqual(tokensContentSize(tokens), content.length);\n\t\tmodelService.destroyModel(model.uri);\n\t});\n\n\ttest('File with non-empty lines that match no scopes', async () => {\n\t\tconst content = `console.log('x');\n;\n{\n}\n`;\n\t\tconst { model, tokenizationImpl } = await getModelAndPrepTree(content);\n\t\tconst tokens = tokenizationImpl.getTokensInRange(new Range(1, 1, 5, 1), 0, 24);\n\t\tverifyTokens(tokens);\n\t\tassert.deepStrictEqual(tokens?.length, 16);\n\t\tassert.deepStrictEqual(tokensContentSize(tokens), content.length);\n\t\tmodelService.destroyModel(model.uri);\n\t});\n\n\ttest('File with non-empty lines that match no scopes \\\\r\\\\n', async () => {\n\t\tconst content = 'console.log(\\'x\\');\\r\\n;\\r\\n{\\r\\n}\\r\\n';\n\t\tconst { model, tokenizationImpl } = await getModelAndPrepTree(content);\n\t\tconst tokens = tokenizationImpl.getTokensInRange(new Range(1, 1, 5, 1), 0, 28);\n\t\tverifyTokens(tokens);\n\t\tassert.deepStrictEqual(tokens?.length, 16);\n\t\tassert.deepStrictEqual(tokensContentSize(tokens), content.length);\n\t\tmodelService.destroyModel(model.uri);\n\t});\n\n\ttest('File with tree-sitter token that spans multiple lines', async () => {\n\t\tconst content = `/**\n**/\n\nconsole.log('x');\n\n`;\n\t\tconst { model, tokenizationImpl } = await getModelAndPrepTree(content);\n\t\tconst tokens = tokenizationImpl.getTokensInRange(new Range(1, 1, 6, 1), 0, 28);\n\t\tverifyTokens(tokens);\n\t\tassert.deepStrictEqual(tokens?.length, 12);\n\t\tassert.deepStrictEqual(tokensContentSize(tokens), content.length);\n\t\tmodelService.destroyModel(model.uri);\n\t});\n\n\ttest('File with tree-sitter token that spans multiple lines \\\\r\\\\n', async () => {\n\t\tconst content = '/**\\r\\n**/\\r\\n\\r\\nconsole.log(\\'x\\');\\r\\n\\r\\n';\n\t\tconst { model, tokenizationImpl } = await getModelAndPrepTree(content);\n\t\tconst tokens = tokenizationImpl.getTokensInRange(new Range(1, 1, 6, 1), 0, 33);\n\t\tverifyTokens(tokens);\n\t\tassert.deepStrictEqual(tokens?.length, 12);\n\t\tassert.deepStrictEqual(tokensContentSize(tokens), content.length);\n\t\tmodelService.destroyModel(model.uri);\n\t});\n\n\ttest('File with tabs', async () => {\n\t\tconst content = `function x() {\n\treturn true;\n}\n\nclass Y {\n\tprivate z = false;\n}`;\n\t\tconst { model, tokenizationImpl } = await getModelAndPrepTree(content);\n\t\tconst tokens = tokenizationImpl.getTokensInRange(new Range(1, 1, 7, 1), 0, 63);\n\t\tverifyTokens(tokens);\n\t\tassert.deepStrictEqual(tokens?.length, 30);\n\t\tassert.deepStrictEqual(tokensContentSize(tokens), content.length);\n\t\tmodelService.destroyModel(model.uri);\n\t});\n\n\ttest('File with tabs \\\\r\\\\n', async () => {\n\t\tconst content = 'function x() {\\r\\n\\treturn true;\\r\\n}\\r\\n\\r\\nclass Y {\\r\\n\\tprivate z = false;\\r\\n}';\n\t\tconst { model, tokenizationImpl } = await getModelAndPrepTree(content);\n\t\tconst tokens = tokenizationImpl.getTokensInRange(new Range(1, 1, 7, 1), 0, 69);\n\t\tverifyTokens(tokens);\n\t\tassert.deepStrictEqual(tokens?.length, 30);\n\t\tassert.deepStrictEqual(tokensContentSize(tokens), content.length);\n\t\tmodelService.destroyModel(model.uri);\n\t});\n\n\ttest('Template string', async () => {\n\t\tconst content = '`t ${6}`';\n\t\tconst { model, tokenizationImpl } = await getModelAndPrepTree(content);\n\t\tconst tokens = tokenizationImpl.getTokensInRange(new Range(1, 1, 1, 8), 0, 8);\n\t\tverifyTokens(tokens);\n\t\tassert.deepStrictEqual(tokens?.length, 6);\n\t\tassert.deepStrictEqual(tokensContentSize(tokens), content.length);\n\t\tmodelService.destroyModel(model.uri);\n\t});\n\n\ttest('Many nested scopes', async () => {\n\t\tconst content = `y = new x(ttt({\n\tmessage: '{0} i\\\\n\\\\n [commandName]({1}).',\n\targs: ['Test', \\`command:\\${openSettingsCommand}?\\${encodeURIComponent('[\"SettingName\"]')}\\`],\n\t// To make sure the translators don't break the link\n\tcomment: [\"{Locked=']({'}\"]\n}));`;\n\t\tconst { model, tokenizationImpl } = await getModelAndPrepTree(content);\n\t\tconst tokens = tokenizationImpl.getTokensInRange(new Range(1, 1, 6, 5), 0, 238);\n\t\tverifyTokens(tokens);\n\t\tassert.deepStrictEqual(tokens?.length, 65);\n\t\tassert.deepStrictEqual(tokensContentSize(tokens), content.length);\n\t\tmodelService.destroyModel(model.uri);\n\t});\n\n});\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport assert from 'assert';\nimport { TestInstantiationService } from '../../../platform/instantiation/test/common/instantiationServiceMock.js';\nimport { ensureNoDisposablesAreLeakedInTestSuite } from '../../../base/test/common/utils.js';\nimport { IModelService } from '../../../editor/common/services/model.js';\nimport { Event } from '../../../base/common/event.js';\nimport { URI } from '../../../base/common/uri.js';\nimport { IFileService } from '../../../platform/files/common/files.js';\nimport { ILogService, NullLogService } from '../../../platform/log/common/log.js';\nimport { ITelemetryData, ITelemetryService, TelemetryLevel } from '../../../platform/telemetry/common/telemetry.js';\nimport { ClassifiedEvent, OmitMetadata, IGDPRProperty, StrictPropertyCheck } from '../../../platform/telemetry/common/gdprTypings.js';\nimport { IConfigurationService } from '../../../platform/configuration/common/configuration.js';\nimport { TestConfigurationService } from '../../../platform/configuration/test/common/testConfigurationService.js';\nimport { IEnvironmentService } from '../../../platform/environment/common/environment.js';\nimport { ModelService } from '../../../editor/common/services/modelService.js';\n\nimport { FileService } from '../../../platform/files/common/fileService.js';\nimport { Schemas } from '../../../base/common/network.js';\nimport { TestIPCFileSystemProvider } from './workbenchTestServices.js';\nimport { ILanguageService } from '../../../editor/common/languages/language.js';\nimport { LanguageService } from '../../../editor/common/services/languageService.js';\nimport { TestColorTheme, TestThemeService } from '../../../platform/theme/test/common/testThemeService.js';\nimport { IThemeService } from '../../../platform/theme/common/themeService.js';\nimport { ITextResourcePropertiesService } from '../../../editor/common/services/textResourceConfiguration.js';\nimport { TestTextResourcePropertiesService } from '../common/workbenchTestServices.js';\nimport { TestLanguageConfigurationService } from '../../../editor/test/common/modes/testLanguageConfigurationService.js';\nimport { ILanguageConfigurationService } from '../../../editor/common/languages/languageConfigurationRegistry.js';\nimport { IUndoRedoService } from '../../../platform/undoRedo/common/undoRedo.js';\nimport { UndoRedoService } from '../../../platform/undoRedo/common/undoRedoService.js';\nimport { TestDialogService } from '../../../platform/dialogs/test/common/testDialogService.js';\nimport { TestNotificationService } from '../../../platform/notification/test/common/testNotificationService.js';\nimport { DisposableStore, IDisposable } from '../../../base/common/lifecycle.js';\nimport { ProbeScope, TokenStyle } from '../../../platform/theme/common/tokenClassificationRegistry.js';\nimport { TextMateThemingRuleDefinitions } from '../../services/themes/common/colorThemeData.js';\nimport { Color } from '../../../base/common/color.js';\nimport { Range } from '../../../editor/common/core/range.js';\nimport { TokenUpdate } from '../../../editor/common/model/tokens/treeSitter/tokenStore.js';\nimport { ITreeSitterLibraryService } from '../../../editor/common/services/treeSitter/treeSitterLibraryService.js';\nimport { TreeSitterLibraryService } from '../../services/treeSitter/browser/treeSitterLibraryService.js';\nimport { TokenizationTextModelPart } from '../../../editor/common/model/tokens/tokenizationTextModelPart.js';\nimport { TreeSitterSyntaxTokenBackend } from '../../../editor/common/model/tokens/treeSitter/treeSitterSyntaxTokenBackend.js';\nimport { TreeParseUpdateEvent, TreeSitterTree } from '../../../editor/common/model/tokens/treeSitter/treeSitterTree.js';\nimport { ITextModel } from '../../../editor/common/model.js';\nimport { TreeSitterTokenizationImpl } from '../../../editor/common/model/tokens/treeSitter/treeSitterTokenizationImpl.js';\nimport { autorunHandleChanges, recordChanges, waitForState } from '../../../base/common/observable.js';\nimport { ITreeSitterThemeService } from '../../../editor/common/services/treeSitter/treeSitterThemeService.js';\nimport { TreeSitterThemeService } from '../../services/treeSitter/browser/treeSitterThemeService.js';\n\nclass MockTelemetryService implements ITelemetryService {\n\t_serviceBrand: undefined;\n\ttelemetryLevel: TelemetryLevel = TelemetryLevel.NONE;\n\tsessionId: string = '';\n\tmachineId: string = '';\n\tsqmId: string = '';\n\tdevDeviceId: string = '';\n\tfirstSessionDate: string = '';\n\tsendErrorTelemetry: boolean = false;\n\tpublicLog(eventName: string, data?: ITelemetryData): void {\n\t}\n\tpublicLog2<E extends ClassifiedEvent<OmitMetadata<T>> = never, T extends IGDPRProperty = never>(eventName: string, data?: StrictPropertyCheck<T, E>): void {\n\t}\n\tpublicLogError(errorEventName: string, data?: ITelemetryData): void {\n\t}\n\tpublicLogError2<E extends ClassifiedEvent<OmitMetadata<T>> = never, T extends IGDPRProperty = never>(eventName: string, data?: StrictPropertyCheck<T, E>): void {\n\t}\n\tsetExperimentProperty(name: string, value: string): void {\n\t}\n}\n\n\nclass TestTreeSitterColorTheme extends TestColorTheme {\n\tpublic resolveScopes(scopes: ProbeScope[], definitions?: TextMateThemingRuleDefinitions): TokenStyle | undefined {\n\t\treturn new TokenStyle(Color.red, undefined, undefined, undefined, undefined);\n\t}\n\tpublic getTokenColorIndex(): { get: () => number } {\n\t\treturn { get: () => 10 };\n\t}\n}\n\nsuite('Tree Sitter TokenizationFeature', function () {\n\n\tlet instantiationService: TestInstantiationService;\n\tlet modelService: IModelService;\n\tlet fileService: IFileService;\n\tlet textResourcePropertiesService: ITextResourcePropertiesService;\n\tlet languageConfigurationService: ILanguageConfigurationService;\n\tlet telemetryService: ITelemetryService;\n\tlet logService: ILogService;\n\tlet configurationService: IConfigurationService;\n\tlet themeService: IThemeService;\n\tlet languageService: ILanguageService;\n\tlet environmentService: IEnvironmentService;\n\n\tlet disposables: DisposableStore;\n\n\tsetup(async () => {\n\t\tdisposables = new DisposableStore();\n\t\tinstantiationService = disposables.add(new TestInstantiationService());\n\n\t\ttelemetryService = new MockTelemetryService();\n\t\tlogService = new NullLogService();\n\t\tconfigurationService = new TestConfigurationService({ 'editor.experimental.preferTreeSitter.typescript': true });\n\t\tthemeService = new TestThemeService(new TestTreeSitterColorTheme());\n\t\tenvironmentService = {} as IEnvironmentService;\n\n\t\tinstantiationService.set(IEnvironmentService, environmentService);\n\t\tinstantiationService.set(IConfigurationService, configurationService);\n\t\tinstantiationService.set(ILogService, logService);\n\t\tinstantiationService.set(ITelemetryService, telemetryService);\n\t\tlanguageService = disposables.add(instantiationService.createInstance(LanguageService));\n\t\tinstantiationService.set(ILanguageService, languageService);\n\t\tinstantiationService.set(IThemeService, themeService);\n\t\ttextResourcePropertiesService = instantiationService.createInstance(TestTextResourcePropertiesService);\n\t\tinstantiationService.set(ITextResourcePropertiesService, textResourcePropertiesService);\n\t\tlanguageConfigurationService = disposables.add(instantiationService.createInstance(TestLanguageConfigurationService));\n\t\tinstantiationService.set(ILanguageConfigurationService, languageConfigurationService);\n\n\t\tfileService = disposables.add(instantiationService.createInstance(FileService));\n\t\tconst fileSystemProvider = new TestIPCFileSystemProvider();\n\t\tdisposables.add(fileService.registerProvider(Schemas.file, fileSystemProvider));\n\t\tinstantiationService.set(IFileService, fileService);\n\n\t\tconst libraryService = disposables.add(instantiationService.createInstance(TreeSitterLibraryService));\n\t\tlibraryService.isTest = true;\n\t\tinstantiationService.set(ITreeSitterLibraryService, libraryService);\n\n\t\tinstantiationService.set(ITreeSitterThemeService, instantiationService.createInstance(TreeSitterThemeService));\n\n\t\tconst dialogService = new TestDialogService();\n\t\tconst notificationService = new TestNotificationService();\n\t\tconst undoRedoService = new UndoRedoService(dialogService, notificationService);\n\t\tinstantiationService.set(IUndoRedoService, undoRedoService);\n\t\tmodelService = new ModelService(\n\t\t\tconfigurationService,\n\t\t\ttextResourcePropertiesService,\n\t\t\tundoRedoService,\n\t\t\tinstantiationService\n\t\t);\n\t\tinstantiationService.set(IModelService, modelService);\n\t});\n\n\tteardown(() => {\n\t\tdisposables.dispose();\n\t});\n\n\tensureNoDisposablesAreLeakedInTestSuite();\n\n\tfunction tokensContentSize(tokens: TokenUpdate[]) {\n\t\treturn tokens[tokens.length - 1].startOffsetInclusive + tokens[tokens.length - 1].length;\n\t}\n\n\tlet nameNumber = 1;\n\tasync function getModelAndPrepTree(content: string): Promise<{ model: ITextModel; treeSitterTree: TreeSitterTree; tokenizationImpl: TreeSitterTokenizationImpl }> {\n\t\tconst model = disposables.add(modelService.createModel(content, { languageId: 'typescript', onDidChange: Event.None }, URI.file(`file${nameNumber++}.ts`)));\n\t\tconst treeSitterTreeObs = disposables.add((model.tokenization as TokenizationTextModelPart).tokens.get() as TreeSitterSyntaxTokenBackend).tree;\n\t\tconst tokenizationImplObs = disposables.add((model.tokenization as TokenizationTextModelPart).tokens.get() as TreeSitterSyntaxTokenBackend).tokenizationImpl;\n\t\tconst treeSitterTree = treeSitterTreeObs.get() ?? await waitForState(treeSitterTreeObs);\n\t\tif (!treeSitterTree.tree.get()) {\n\t\t\tawait waitForState(treeSitterTree.tree);\n\t\t}\n\t\tconst tokenizationImpl = tokenizationImplObs.get() ?? await waitForState(tokenizationImplObs);\n\n\t\tassert.ok(treeSitterTree);\n\t\treturn { model, treeSitterTree, tokenizationImpl };\n\t}\n\n\tfunction verifyTokens(tokens: TokenUpdate[] | undefined) {\n\t\tassert.ok(tokens);\n\t\tfor (let i = 1; i < tokens.length; i++) {\n\t\t\tconst previousToken: TokenUpdate = tokens[i - 1];\n\t\t\tconst token: TokenUpdate = tokens[i];\n\t\t\tassert.deepStrictEqual(previousToken.startOffsetInclusive + previousToken.length, token.startOffsetInclusive);\n\t\t}\n\t}\n\n\ttest('Three changes come back to back ', async () => {\n\t\tconst content = `/**\n**/\nclass x {\n}\n\n\n\n\nclass y {\n}`;\n\t\tconst { model, treeSitterTree } = await getModelAndPrepTree(content);\n\n\t\tlet updateListener: IDisposable | undefined;\n\t\tconst changePromise = new Promise<TreeParseUpdateEvent | undefined>(resolve => {\n\t\t\tupdateListener = autorunHandleChanges({\n\t\t\t\towner: this,\n\t\t\t\tchangeTracker: recordChanges({ tree: treeSitterTree.tree }),\n\t\t\t}, (reader, ctx) => {\n\t\t\t\tconst changeEvent = ctx.changes.at(0)?.change;\n\t\t\t\tif (changeEvent) {\n\t\t\t\t\tresolve(changeEvent);\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\n\t\tconst edit1 = new Promise<void>(resolve => {\n\t\t\tmodel.applyEdits([{ range: new Range(7, 1, 8, 1), text: '' }]);\n\t\t\tresolve();\n\t\t});\n\t\tconst edit2 = new Promise<void>(resolve => {\n\t\t\tmodel.applyEdits([{ range: new Range(6, 1, 7, 1), text: '' }]);\n\t\t\tresolve();\n\t\t});\n\t\tconst edit3 = new Promise<void>(resolve => {\n\t\t\tmodel.applyEdits([{ range: new Range(5, 1, 6, 1), text: '' }]);\n\t\t\tresolve();\n\t\t});\n\t\tconst edits = Promise.all([edit1, edit2, edit3]);\n\t\tconst change = await changePromise;\n\t\tawait edits;\n\t\tassert.ok(change);\n\n\t\tassert.strictEqual(change.versionId, 4);\n\t\tassert.strictEqual(change.ranges[0].newRangeStartOffset, 0);\n\t\tassert.strictEqual(change.ranges[0].newRangeEndOffset, 32);\n\t\tassert.strictEqual(change.ranges[0].newRange.startLineNumber, 1);\n\t\tassert.strictEqual(change.ranges[0].newRange.endLineNumber, 7);\n\n\t\tupdateListener?.dispose();\n\t\tmodelService.destroyModel(model.uri);\n\t});\n\n\ttest('File single line file', async () => {\n\t\tconst content = `console.log('x');`;\n\t\tconst { model, tokenizationImpl } = await getModelAndPrepTree(content);\n\t\tconst tokens = tokenizationImpl.getTokensInRange(new Range(1, 1, 1, 18), 0, 17);\n\t\tverifyTokens(tokens);\n\t\tassert.deepStrictEqual(tokens?.length, 9);\n\t\tassert.deepStrictEqual(tokensContentSize(tokens), content.length);\n\t\tmodelService.destroyModel(model.uri);\n\t});\n\n\ttest('File with new lines at beginning and end', async () => {\n\t\tconst content = `\nconsole.log('x');\n`;\n\t\tconst { model, tokenizationImpl } = await getModelAndPrepTree(content);\n\t\tconst tokens = tokenizationImpl.getTokensInRange(new Range(1, 1, 3, 1), 0, 19);\n\t\tverifyTokens(tokens);\n\t\tassert.deepStrictEqual(tokens?.length, 11);\n\t\tassert.deepStrictEqual(tokensContentSize(tokens), content.length);\n\t\tmodelService.destroyModel(model.uri);\n\t});\n\n\ttest('File with new lines at beginning and end \\\\r\\\\n', async () => {\n\t\tconst content = '\\r\\nconsole.log(\\'x\\');\\r\\n';\n\t\tconst { model, tokenizationImpl } = await getModelAndPrepTree(content);\n\t\tconst tokens = tokenizationImpl.getTokensInRange(new Range(1, 1, 3, 1), 0, 21);\n\t\tverifyTokens(tokens);\n\t\tassert.deepStrictEqual(tokens?.length, 11);\n\t\tassert.deepStrictEqual(tokensContentSize(tokens), content.length);\n\t\tmodelService.destroyModel(model.uri);\n\t});\n\n\ttest('File with empty lines in the middle', async () => {\n\t\tconst content = `\nconsole.log('x');\n\nconsole.log('7');\n`;\n\t\tconst { model, tokenizationImpl } = await getModelAndPrepTree(content);\n\t\tconst tokens = tokenizationImpl.getTokensInRange(new Range(1, 1, 5, 1), 0, 38);\n\t\tverifyTokens(tokens);\n\t\tassert.deepStrictEqual(tokens?.length, 21);\n\t\tassert.deepStrictEqual(tokensContentSize(tokens), content.length);\n\t\tmodelService.destroyModel(model.uri);\n\t});\n\n\ttest('File with empty lines in the middle \\\\r\\\\n', async () => {\n\t\tconst content = '\\r\\nconsole.log(\\'x\\');\\r\\n\\r\\nconsole.log(\\'7\\');\\r\\n';\n\t\tconst { model, tokenizationImpl } = await getModelAndPrepTree(content);\n\t\tconst tokens = tokenizationImpl.getTokensInRange(new Range(1, 1, 5, 1), 0, 42);\n\t\tverifyTokens(tokens);\n\t\tassert.deepStrictEqual(tokens?.length, 21);\n\t\tassert.deepStrictEqual(tokensContentSize(tokens), content.length);\n\t\tmodelService.destroyModel(model.uri);\n\t});\n\n\ttest('File with non-empty lines that match no scopes', async () => {\n\t\tconst content = `console.log('x');\n;\n{\n}\n`;\n\t\tconst { model, tokenizationImpl } = await getModelAndPrepTree(content);\n\t\tconst tokens = tokenizationImpl.getTokensInRange(new Range(1, 1, 5, 1), 0, 24);\n\t\tverifyTokens(tokens);\n\t\tassert.deepStrictEqual(tokens?.length, 16);\n\t\tassert.deepStrictEqual(tokensContentSize(tokens), content.length);\n\t\tmodelService.destroyModel(model.uri);\n\t});\n\n\ttest('File with non-empty lines that match no scopes \\\\r\\\\n', async () => {\n\t\tconst content = 'console.log(\\'x\\');\\r\\n;\\r\\n{\\r\\n}\\r\\n';\n\t\tconst { model, tokenizationImpl } = await getModelAndPrepTree(content);\n\t\tconst tokens = tokenizationImpl.getTokensInRange(new Range(1, 1, 5, 1), 0, 28);\n\t\tverifyTokens(tokens);\n\t\tassert.deepStrictEqual(tokens?.length, 16);\n\t\tassert.deepStrictEqual(tokensContentSize(tokens), content.length);\n\t\tmodelService.destroyModel(model.uri);\n\t});\n\n\ttest('File with tree-sitter token that spans multiple lines', async () => {\n\t\tconst content = `/**\n**/\n\nconsole.log('x');\n\n`;\n\t\tconst { model, tokenizationImpl } = await getModelAndPrepTree(content);\n\t\tconst tokens = tokenizationImpl.getTokensInRange(new Range(1, 1, 6, 1), 0, 28);\n\t\tverifyTokens(tokens);\n\t\tassert.deepStrictEqual(tokens?.length, 12);\n\t\tassert.deepStrictEqual(tokensContentSize(tokens), content.length);\n\t\tmodelService.destroyModel(model.uri);\n\t});\n\n\ttest('File with tree-sitter token that spans multiple lines \\\\r\\\\n', async () => {\n\t\tconst content = '/**\\r\\n**/\\r\\n\\r\\nconsole.log(\\'x\\');\\r\\n\\r\\n';\n\t\tconst { model, tokenizationImpl } = await getModelAndPrepTree(content);\n\t\tconst tokens = tokenizationImpl.getTokensInRange(new Range(1, 1, 6, 1), 0, 33);\n\t\tverifyTokens(tokens);\n\t\tassert.deepStrictEqual(tokens?.length, 12);\n\t\tassert.deepStrictEqual(tokensContentSize(tokens), content.length);\n\t\tmodelService.destroyModel(model.uri);\n\t});\n\n\ttest('File with tabs', async () => {\n\t\tconst content = `function x() {\n\treturn true;\n}\n\nclass Y {\n\tprivate z = false;\n}`;\n\t\tconst { model, tokenizationImpl } = await getModelAndPrepTree(content);\n\t\tconst tokens = tokenizationImpl.getTokensInRange(new Range(1, 1, 7, 1), 0, 63);\n\t\tverifyTokens(tokens);\n\t\tassert.deepStrictEqual(tokens?.length, 30);\n\t\tassert.deepStrictEqual(tokensContentSize(tokens), content.length);\n\t\tmodelService.destroyModel(model.uri);\n\t});\n\n\ttest('File with tabs \\\\r\\\\n', async () => {\n\t\tconst content = 'function x() {\\r\\n\\treturn true;\\r\\n}\\r\\n\\r\\nclass Y {\\r\\n\\tprivate z = false;\\r\\n}';\n\t\tconst { model, tokenizationImpl } = await getModelAndPrepTree(content);\n\t\tconst tokens = tokenizationImpl.getTokensInRange(new Range(1, 1, 7, 1), 0, 69);\n\t\tverifyTokens(tokens);\n\t\tassert.deepStrictEqual(tokens?.length, 30);\n\t\tassert.deepStrictEqual(tokensContentSize(tokens), content.length);\n\t\tmodelService.destroyModel(model.uri);\n\t});\n\n\ttest('Template string', async () => {\n\t\tconst content = '`t ${6}`';\n\t\tconst { model, tokenizationImpl } = await getModelAndPrepTree(content);\n\t\tconst tokens = tokenizationImpl.getTokensInRange(new Range(1, 1, 1, 8), 0, 8);\n\t\tverifyTokens(tokens);\n\t\tassert.deepStrictEqual(tokens?.length, 6);\n\t\tassert.deepStrictEqual(tokensContentSize(tokens), content.length);\n\t\tmodelService.destroyModel(model.uri);\n\t});\n\n\ttest('Many nested scopes', async () => {\n\t\tconst content = `y = new x(ttt({\n\tmessage: '{0} i\\\\n\\\\n [commandName]({1}).',\n\targs: ['Test', \\`command:\\${openSettingsCommand}?\\${encodeURIComponent('[\"SettingName\"]')}\\`],\n\t// To make sure the translators don't break the link\n\tcomment: [\"{Locked=']({'}\"]\n}));`;\n\t\tconst { model, tokenizationImpl } = await getModelAndPrepTree(content);\n\t\tconst tokens = tokenizationImpl.getTokensInRange(new Range(1, 1, 6, 5), 0, 238);\n\t\tverifyTokens(tokens);\n\t\tassert.deepStrictEqual(tokens?.length, 65);\n\t\tassert.deepStrictEqual(tokensContentSize(tokens), content.length);\n\t\tmodelService.destroyModel(model.uri);\n\t});\n\n});\n"]}