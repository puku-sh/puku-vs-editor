{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/electron-browser/parts/titlebar/menubarControl.ts","vs/workbench/electron-browser/parts/titlebar/menubarControl.ts"],"names":[],"mappings":"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","file":"menubarControl.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { IAction, Separator } from '../../../../base/common/actions.js';\nimport { IMenuService, SubmenuItemAction, MenuItemAction } from '../../../../platform/actions/common/actions.js';\nimport { IContextKeyService } from '../../../../platform/contextkey/common/contextkey.js';\nimport { IWorkspacesService } from '../../../../platform/workspaces/common/workspaces.js';\nimport { isMacintosh } from '../../../../base/common/platform.js';\nimport { INotificationService } from '../../../../platform/notification/common/notification.js';\nimport { IKeybindingService } from '../../../../platform/keybinding/common/keybinding.js';\nimport { INativeWorkbenchEnvironmentService } from '../../../services/environment/electron-browser/environmentService.js';\nimport { IAccessibilityService } from '../../../../platform/accessibility/common/accessibility.js';\nimport { IConfigurationService } from '../../../../platform/configuration/common/configuration.js';\nimport { ILabelService } from '../../../../platform/label/common/label.js';\nimport { IUpdateService } from '../../../../platform/update/common/update.js';\nimport { IOpenRecentAction, MenubarControl } from '../../../browser/parts/titlebar/menubarControl.js';\nimport { IStorageService } from '../../../../platform/storage/common/storage.js';\nimport { IMenubarData, IMenubarMenu, IMenubarKeybinding, IMenubarMenuItemSubmenu, IMenubarMenuItemAction, MenubarMenuItem } from '../../../../platform/menubar/common/menubar.js';\nimport { IMenubarService } from '../../../../platform/menubar/electron-browser/menubar.js';\nimport { INativeHostService } from '../../../../platform/native/common/native.js';\nimport { IHostService } from '../../../services/host/browser/host.js';\nimport { IPreferencesService } from '../../../services/preferences/common/preferences.js';\nimport { ICommandService } from '../../../../platform/commands/common/commands.js';\nimport { OpenRecentAction } from '../../../browser/actions/windowActions.js';\nimport { isICommandActionToggleInfo } from '../../../../platform/action/common/action.js';\nimport { getFlatContextMenuActions } from '../../../../platform/actions/browser/menuEntryActionViewItem.js';\n\nexport class NativeMenubarControl extends MenubarControl {\n\n\tconstructor(\n\t\t@IMenuService menuService: IMenuService,\n\t\t@IWorkspacesService workspacesService: IWorkspacesService,\n\t\t@IContextKeyService contextKeyService: IContextKeyService,\n\t\t@IKeybindingService keybindingService: IKeybindingService,\n\t\t@IConfigurationService configurationService: IConfigurationService,\n\t\t@ILabelService labelService: ILabelService,\n\t\t@IUpdateService updateService: IUpdateService,\n\t\t@IStorageService storageService: IStorageService,\n\t\t@INotificationService notificationService: INotificationService,\n\t\t@IPreferencesService preferencesService: IPreferencesService,\n\t\t@INativeWorkbenchEnvironmentService environmentService: INativeWorkbenchEnvironmentService,\n\t\t@IAccessibilityService accessibilityService: IAccessibilityService,\n\t\t@IMenubarService private readonly menubarService: IMenubarService,\n\t\t@IHostService hostService: IHostService,\n\t\t@INativeHostService private readonly nativeHostService: INativeHostService,\n\t\t@ICommandService commandService: ICommandService,\n\t) {\n\t\tsuper(menuService, workspacesService, contextKeyService, keybindingService, configurationService, labelService, updateService, storageService, notificationService, preferencesService, environmentService, accessibilityService, hostService, commandService);\n\n\t\t(async () => {\n\t\t\tthis.recentlyOpened = await this.workspacesService.getRecentlyOpened();\n\n\t\t\tthis.doUpdateMenubar();\n\t\t})();\n\n\t\tthis.registerListeners();\n\t}\n\n\tprotected override setupMainMenu(): void {\n\t\tsuper.setupMainMenu();\n\n\t\tfor (const topLevelMenuName of Object.keys(this.topLevelTitles)) {\n\t\t\tconst menu = this.menus[topLevelMenuName];\n\t\t\tif (menu) {\n\t\t\t\tthis.mainMenuDisposables.add(menu.onDidChange(() => this.updateMenubar()));\n\t\t\t}\n\t\t}\n\t}\n\n\tprotected doUpdateMenubar(): void {\n\t\t// Since the native menubar is shared between windows (main process)\n\t\t// only allow the focused window to update the menubar\n\t\tif (!this.hostService.hasFocus) {\n\t\t\treturn;\n\t\t}\n\n\t\t// Send menus to main process to be rendered by Electron\n\t\tconst menubarData = { menus: {}, keybindings: {} };\n\t\tif (this.getMenubarMenus(menubarData)) {\n\t\t\tthis.menubarService.updateMenubar(this.nativeHostService.windowId, menubarData);\n\t\t}\n\t}\n\n\tprivate getMenubarMenus(menubarData: IMenubarData): boolean {\n\t\tif (!menubarData) {\n\t\t\treturn false;\n\t\t}\n\n\t\tmenubarData.keybindings = this.getAdditionalKeybindings();\n\t\tfor (const topLevelMenuName of Object.keys(this.topLevelTitles)) {\n\t\t\tconst menu = this.menus[topLevelMenuName];\n\t\t\tif (menu) {\n\t\t\t\tconst menubarMenu: IMenubarMenu = { items: [] };\n\t\t\t\tconst menuActions = getFlatContextMenuActions(menu.getActions({ shouldForwardArgs: true }));\n\t\t\t\tthis.populateMenuItems(menuActions, menubarMenu, menubarData.keybindings);\n\t\t\t\tif (menubarMenu.items.length === 0) {\n\t\t\t\t\treturn false; // Menus are incomplete\n\t\t\t\t}\n\t\t\t\tmenubarData.menus[topLevelMenuName] = menubarMenu;\n\t\t\t}\n\t\t}\n\n\t\treturn true;\n\t}\n\n\tprivate populateMenuItems(menuActions: readonly IAction[], menuToPopulate: IMenubarMenu, keybindings: { [id: string]: IMenubarKeybinding | undefined }) {\n\t\tfor (const menuItem of menuActions) {\n\t\t\tif (menuItem instanceof Separator) {\n\t\t\t\tmenuToPopulate.items.push({ id: 'vscode.menubar.separator' });\n\t\t\t} else if (menuItem instanceof MenuItemAction || menuItem instanceof SubmenuItemAction) {\n\n\t\t\t\t// use mnemonicTitle whenever possible\n\t\t\t\tconst title = typeof menuItem.item.title === 'string'\n\t\t\t\t\t? menuItem.item.title\n\t\t\t\t\t: menuItem.item.title.mnemonicTitle ?? menuItem.item.title.value;\n\n\t\t\t\tif (menuItem instanceof SubmenuItemAction) {\n\t\t\t\t\tconst submenu = { items: [] };\n\n\t\t\t\t\tthis.populateMenuItems(menuItem.actions, submenu, keybindings);\n\n\t\t\t\t\tif (submenu.items.length > 0) {\n\t\t\t\t\t\tconst menubarSubmenuItem: IMenubarMenuItemSubmenu = {\n\t\t\t\t\t\t\tid: menuItem.id,\n\t\t\t\t\t\t\tlabel: title,\n\t\t\t\t\t\t\tsubmenu\n\t\t\t\t\t\t};\n\n\t\t\t\t\t\tmenuToPopulate.items.push(menubarSubmenuItem);\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tif (menuItem.id === OpenRecentAction.ID) {\n\t\t\t\t\t\tconst actions = this.getOpenRecentActions().map(this.transformOpenRecentAction);\n\t\t\t\t\t\tmenuToPopulate.items.push(...actions);\n\t\t\t\t\t}\n\n\t\t\t\t\tconst menubarMenuItem: IMenubarMenuItemAction = {\n\t\t\t\t\t\tid: menuItem.id,\n\t\t\t\t\t\tlabel: title\n\t\t\t\t\t};\n\n\t\t\t\t\tif (isICommandActionToggleInfo(menuItem.item.toggled)) {\n\t\t\t\t\t\tmenubarMenuItem.label = menuItem.item.toggled.mnemonicTitle ?? menuItem.item.toggled.title ?? title;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (menuItem.checked) {\n\t\t\t\t\t\tmenubarMenuItem.checked = true;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!menuItem.enabled) {\n\t\t\t\t\t\tmenubarMenuItem.enabled = false;\n\t\t\t\t\t}\n\n\t\t\t\t\tkeybindings[menuItem.id] = this.getMenubarKeybinding(menuItem.id);\n\t\t\t\t\tmenuToPopulate.items.push(menubarMenuItem);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate transformOpenRecentAction(action: Separator | IOpenRecentAction): MenubarMenuItem {\n\t\tif (action instanceof Separator) {\n\t\t\treturn { id: 'vscode.menubar.separator' };\n\t\t}\n\n\t\treturn {\n\t\t\tid: action.id,\n\t\t\turi: action.uri,\n\t\t\tremoteAuthority: action.remoteAuthority,\n\t\t\tenabled: action.enabled,\n\t\t\tlabel: action.label\n\t\t};\n\t}\n\n\tprivate getAdditionalKeybindings(): { [id: string]: IMenubarKeybinding } {\n\t\tconst keybindings: { [id: string]: IMenubarKeybinding } = {};\n\t\tif (isMacintosh) {\n\t\t\tconst keybinding = this.getMenubarKeybinding('workbench.action.quit');\n\t\t\tif (keybinding) {\n\t\t\t\tkeybindings['workbench.action.quit'] = keybinding;\n\t\t\t}\n\t\t}\n\n\t\treturn keybindings;\n\t}\n\n\tprivate getMenubarKeybinding(id: string): IMenubarKeybinding | undefined {\n\t\tconst binding = this.keybindingService.lookupKeybinding(id);\n\t\tif (!binding) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\t// first try to resolve a native accelerator\n\t\tconst electronAccelerator = binding.getElectronAccelerator();\n\t\tif (electronAccelerator) {\n\t\t\treturn { label: electronAccelerator, userSettingsLabel: binding.getUserSettingsLabel() ?? undefined };\n\t\t}\n\n\t\t// we need this fallback to support keybindings that cannot show in electron menus (e.g. chords)\n\t\tconst acceleratorLabel = binding.getLabel();\n\t\tif (acceleratorLabel) {\n\t\t\treturn { label: acceleratorLabel, isNative: false, userSettingsLabel: binding.getUserSettingsLabel() ?? undefined };\n\t\t}\n\n\t\treturn undefined;\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { IAction, Separator } from '../../../../base/common/actions.js';\nimport { IMenuService, SubmenuItemAction, MenuItemAction } from '../../../../platform/actions/common/actions.js';\nimport { IContextKeyService } from '../../../../platform/contextkey/common/contextkey.js';\nimport { IWorkspacesService } from '../../../../platform/workspaces/common/workspaces.js';\nimport { isMacintosh } from '../../../../base/common/platform.js';\nimport { INotificationService } from '../../../../platform/notification/common/notification.js';\nimport { IKeybindingService } from '../../../../platform/keybinding/common/keybinding.js';\nimport { INativeWorkbenchEnvironmentService } from '../../../services/environment/electron-browser/environmentService.js';\nimport { IAccessibilityService } from '../../../../platform/accessibility/common/accessibility.js';\nimport { IConfigurationService } from '../../../../platform/configuration/common/configuration.js';\nimport { ILabelService } from '../../../../platform/label/common/label.js';\nimport { IUpdateService } from '../../../../platform/update/common/update.js';\nimport { IOpenRecentAction, MenubarControl } from '../../../browser/parts/titlebar/menubarControl.js';\nimport { IStorageService } from '../../../../platform/storage/common/storage.js';\nimport { IMenubarData, IMenubarMenu, IMenubarKeybinding, IMenubarMenuItemSubmenu, IMenubarMenuItemAction, MenubarMenuItem } from '../../../../platform/menubar/common/menubar.js';\nimport { IMenubarService } from '../../../../platform/menubar/electron-browser/menubar.js';\nimport { INativeHostService } from '../../../../platform/native/common/native.js';\nimport { IHostService } from '../../../services/host/browser/host.js';\nimport { IPreferencesService } from '../../../services/preferences/common/preferences.js';\nimport { ICommandService } from '../../../../platform/commands/common/commands.js';\nimport { OpenRecentAction } from '../../../browser/actions/windowActions.js';\nimport { isICommandActionToggleInfo } from '../../../../platform/action/common/action.js';\nimport { getFlatContextMenuActions } from '../../../../platform/actions/browser/menuEntryActionViewItem.js';\n\nexport class NativeMenubarControl extends MenubarControl {\n\n\tconstructor(\n\t\t@IMenuService menuService: IMenuService,\n\t\t@IWorkspacesService workspacesService: IWorkspacesService,\n\t\t@IContextKeyService contextKeyService: IContextKeyService,\n\t\t@IKeybindingService keybindingService: IKeybindingService,\n\t\t@IConfigurationService configurationService: IConfigurationService,\n\t\t@ILabelService labelService: ILabelService,\n\t\t@IUpdateService updateService: IUpdateService,\n\t\t@IStorageService storageService: IStorageService,\n\t\t@INotificationService notificationService: INotificationService,\n\t\t@IPreferencesService preferencesService: IPreferencesService,\n\t\t@INativeWorkbenchEnvironmentService environmentService: INativeWorkbenchEnvironmentService,\n\t\t@IAccessibilityService accessibilityService: IAccessibilityService,\n\t\t@IMenubarService private readonly menubarService: IMenubarService,\n\t\t@IHostService hostService: IHostService,\n\t\t@INativeHostService private readonly nativeHostService: INativeHostService,\n\t\t@ICommandService commandService: ICommandService,\n\t) {\n\t\tsuper(menuService, workspacesService, contextKeyService, keybindingService, configurationService, labelService, updateService, storageService, notificationService, preferencesService, environmentService, accessibilityService, hostService, commandService);\n\n\t\t(async () => {\n\t\t\tthis.recentlyOpened = await this.workspacesService.getRecentlyOpened();\n\n\t\t\tthis.doUpdateMenubar();\n\t\t})();\n\n\t\tthis.registerListeners();\n\t}\n\n\tprotected override setupMainMenu(): void {\n\t\tsuper.setupMainMenu();\n\n\t\tfor (const topLevelMenuName of Object.keys(this.topLevelTitles)) {\n\t\t\tconst menu = this.menus[topLevelMenuName];\n\t\t\tif (menu) {\n\t\t\t\tthis.mainMenuDisposables.add(menu.onDidChange(() => this.updateMenubar()));\n\t\t\t}\n\t\t}\n\t}\n\n\tprotected doUpdateMenubar(): void {\n\t\t// Since the native menubar is shared between windows (main process)\n\t\t// only allow the focused window to update the menubar\n\t\tif (!this.hostService.hasFocus) {\n\t\t\treturn;\n\t\t}\n\n\t\t// Send menus to main process to be rendered by Electron\n\t\tconst menubarData = { menus: {}, keybindings: {} };\n\t\tif (this.getMenubarMenus(menubarData)) {\n\t\t\tthis.menubarService.updateMenubar(this.nativeHostService.windowId, menubarData);\n\t\t}\n\t}\n\n\tprivate getMenubarMenus(menubarData: IMenubarData): boolean {\n\t\tif (!menubarData) {\n\t\t\treturn false;\n\t\t}\n\n\t\tmenubarData.keybindings = this.getAdditionalKeybindings();\n\t\tfor (const topLevelMenuName of Object.keys(this.topLevelTitles)) {\n\t\t\tconst menu = this.menus[topLevelMenuName];\n\t\t\tif (menu) {\n\t\t\t\tconst menubarMenu: IMenubarMenu = { items: [] };\n\t\t\t\tconst menuActions = getFlatContextMenuActions(menu.getActions({ shouldForwardArgs: true }));\n\t\t\t\tthis.populateMenuItems(menuActions, menubarMenu, menubarData.keybindings);\n\t\t\t\tif (menubarMenu.items.length === 0) {\n\t\t\t\t\treturn false; // Menus are incomplete\n\t\t\t\t}\n\t\t\t\tmenubarData.menus[topLevelMenuName] = menubarMenu;\n\t\t\t}\n\t\t}\n\n\t\treturn true;\n\t}\n\n\tprivate populateMenuItems(menuActions: readonly IAction[], menuToPopulate: IMenubarMenu, keybindings: { [id: string]: IMenubarKeybinding | undefined }) {\n\t\tfor (const menuItem of menuActions) {\n\t\t\tif (menuItem instanceof Separator) {\n\t\t\t\tmenuToPopulate.items.push({ id: 'vscode.menubar.separator' });\n\t\t\t} else if (menuItem instanceof MenuItemAction || menuItem instanceof SubmenuItemAction) {\n\n\t\t\t\t// use mnemonicTitle whenever possible\n\t\t\t\tconst title = typeof menuItem.item.title === 'string'\n\t\t\t\t\t? menuItem.item.title\n\t\t\t\t\t: menuItem.item.title.mnemonicTitle ?? menuItem.item.title.value;\n\n\t\t\t\tif (menuItem instanceof SubmenuItemAction) {\n\t\t\t\t\tconst submenu = { items: [] };\n\n\t\t\t\t\tthis.populateMenuItems(menuItem.actions, submenu, keybindings);\n\n\t\t\t\t\tif (submenu.items.length > 0) {\n\t\t\t\t\t\tconst menubarSubmenuItem: IMenubarMenuItemSubmenu = {\n\t\t\t\t\t\t\tid: menuItem.id,\n\t\t\t\t\t\t\tlabel: title,\n\t\t\t\t\t\t\tsubmenu\n\t\t\t\t\t\t};\n\n\t\t\t\t\t\tmenuToPopulate.items.push(menubarSubmenuItem);\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tif (menuItem.id === OpenRecentAction.ID) {\n\t\t\t\t\t\tconst actions = this.getOpenRecentActions().map(this.transformOpenRecentAction);\n\t\t\t\t\t\tmenuToPopulate.items.push(...actions);\n\t\t\t\t\t}\n\n\t\t\t\t\tconst menubarMenuItem: IMenubarMenuItemAction = {\n\t\t\t\t\t\tid: menuItem.id,\n\t\t\t\t\t\tlabel: title\n\t\t\t\t\t};\n\n\t\t\t\t\tif (isICommandActionToggleInfo(menuItem.item.toggled)) {\n\t\t\t\t\t\tmenubarMenuItem.label = menuItem.item.toggled.mnemonicTitle ?? menuItem.item.toggled.title ?? title;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (menuItem.checked) {\n\t\t\t\t\t\tmenubarMenuItem.checked = true;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!menuItem.enabled) {\n\t\t\t\t\t\tmenubarMenuItem.enabled = false;\n\t\t\t\t\t}\n\n\t\t\t\t\tkeybindings[menuItem.id] = this.getMenubarKeybinding(menuItem.id);\n\t\t\t\t\tmenuToPopulate.items.push(menubarMenuItem);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate transformOpenRecentAction(action: Separator | IOpenRecentAction): MenubarMenuItem {\n\t\tif (action instanceof Separator) {\n\t\t\treturn { id: 'vscode.menubar.separator' };\n\t\t}\n\n\t\treturn {\n\t\t\tid: action.id,\n\t\t\turi: action.uri,\n\t\t\tremoteAuthority: action.remoteAuthority,\n\t\t\tenabled: action.enabled,\n\t\t\tlabel: action.label\n\t\t};\n\t}\n\n\tprivate getAdditionalKeybindings(): { [id: string]: IMenubarKeybinding } {\n\t\tconst keybindings: { [id: string]: IMenubarKeybinding } = {};\n\t\tif (isMacintosh) {\n\t\t\tconst keybinding = this.getMenubarKeybinding('workbench.action.quit');\n\t\t\tif (keybinding) {\n\t\t\t\tkeybindings['workbench.action.quit'] = keybinding;\n\t\t\t}\n\t\t}\n\n\t\treturn keybindings;\n\t}\n\n\tprivate getMenubarKeybinding(id: string): IMenubarKeybinding | undefined {\n\t\tconst binding = this.keybindingService.lookupKeybinding(id);\n\t\tif (!binding) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\t// first try to resolve a native accelerator\n\t\tconst electronAccelerator = binding.getElectronAccelerator();\n\t\tif (electronAccelerator) {\n\t\t\treturn { label: electronAccelerator, userSettingsLabel: binding.getUserSettingsLabel() ?? undefined };\n\t\t}\n\n\t\t// we need this fallback to support keybindings that cannot show in electron menus (e.g. chords)\n\t\tconst acceleratorLabel = binding.getLabel();\n\t\tif (acceleratorLabel) {\n\t\t\treturn { label: acceleratorLabel, isNative: false, userSettingsLabel: binding.getUserSettingsLabel() ?? undefined };\n\t\t}\n\n\t\treturn undefined;\n\t}\n}\n"]}