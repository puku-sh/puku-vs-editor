{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/contrib/testing/browser/testMessageColorizer.ts","vs/workbench/contrib/testing/browser/testMessageColorizer.ts"],"names":[],"mappings":"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","file":"testMessageColorizer.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { renderAsPlaintext } from '../../../../base/browser/markdownRenderer.js';\nimport { IMarkdownString } from '../../../../base/common/htmlContent.js';\nimport { IDisposable, toDisposable } from '../../../../base/common/lifecycle.js';\nimport { GraphemeIterator, forAnsiStringParts, removeAnsiEscapeCodes } from '../../../../base/common/strings.js';\nimport './media/testMessageColorizer.css';\nimport { CodeEditorWidget } from '../../../../editor/browser/widget/codeEditor/codeEditorWidget.js';\nimport { Position } from '../../../../editor/common/core/position.js';\nimport { Range } from '../../../../editor/common/core/range.js';\n\nconst colorAttrRe = /^\\x1b\\[([0-9]+)m$/;\n\nconst enum Classes {\n\tPrefix = 'tstm-ansidec-',\n\tForegroundPrefix = Classes.Prefix + 'fg',\n\tBackgroundPrefix = Classes.Prefix + 'bg',\n\tBold = Classes.Prefix + '1',\n\tFaint = Classes.Prefix + '2',\n\tItalic = Classes.Prefix + '3',\n\tUnderline = Classes.Prefix + '4',\n}\n\nexport const renderTestMessageAsText = (tm: string | IMarkdownString) =>\n\ttypeof tm === 'string' ? removeAnsiEscapeCodes(tm) : renderAsPlaintext(tm);\n\n\n/**\n * Applies decorations based on ANSI styles from the test message in the editor.\n * ANSI sequences are stripped from the text displayed in editor, and this\n * re-applies their colorization.\n *\n * This uses decorations rather than language features because the string\n * rendered in the editor lacks the ANSI codes needed to actually apply the\n * colorization.\n *\n * Note: does not support TrueColor.\n */\nexport const colorizeTestMessageInEditor = (message: string, editor: CodeEditorWidget): IDisposable => {\n\tconst decos: string[] = [];\n\n\teditor.changeDecorations(changeAccessor => {\n\t\tlet start = new Position(1, 1);\n\t\tlet cls: string[] = [];\n\t\tfor (const part of forAnsiStringParts(message)) {\n\t\t\tif (part.isCode) {\n\t\t\t\tconst colorAttr = colorAttrRe.exec(part.str)?.[1];\n\t\t\t\tif (!colorAttr) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tconst n = Number(colorAttr);\n\t\t\t\tif (n === 0) {\n\t\t\t\t\tcls.length = 0;\n\t\t\t\t} else if (n === 22) {\n\t\t\t\t\tcls = cls.filter(c => c !== Classes.Bold && c !== Classes.Italic);\n\t\t\t\t} else if (n === 23) {\n\t\t\t\t\tcls = cls.filter(c => c !== Classes.Italic);\n\t\t\t\t} else if (n === 24) {\n\t\t\t\t\tcls = cls.filter(c => c !== Classes.Underline);\n\t\t\t\t} else if ((n >= 30 && n <= 39) || (n >= 90 && n <= 99)) {\n\t\t\t\t\tcls = cls.filter(c => !c.startsWith(Classes.ForegroundPrefix));\n\t\t\t\t\tcls.push(Classes.ForegroundPrefix + colorAttr);\n\t\t\t\t} else if ((n >= 40 && n <= 49) || (n >= 100 && n <= 109)) {\n\t\t\t\t\tcls = cls.filter(c => !c.startsWith(Classes.BackgroundPrefix));\n\t\t\t\t\tcls.push(Classes.BackgroundPrefix + colorAttr);\n\t\t\t\t} else {\n\t\t\t\t\tcls.push(Classes.Prefix + colorAttr);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tlet line = start.lineNumber;\n\t\t\t\tlet col = start.column;\n\n\t\t\t\tconst graphemes = new GraphemeIterator(part.str);\n\t\t\t\tfor (let i = 0; !graphemes.eol(); i += graphemes.nextGraphemeLength()) {\n\t\t\t\t\tif (part.str[i] === '\\n') {\n\t\t\t\t\t\tline++;\n\t\t\t\t\t\tcol = 1;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tcol++;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tconst end = new Position(line, col);\n\t\t\t\tif (cls.length) {\n\t\t\t\t\tdecos.push(changeAccessor.addDecoration(Range.fromPositions(start, end), {\n\t\t\t\t\t\tinlineClassName: cls.join(' '),\n\t\t\t\t\t\tdescription: 'test-message-colorized',\n\t\t\t\t\t}));\n\t\t\t\t}\n\t\t\t\tstart = end;\n\t\t\t}\n\t\t}\n\t});\n\n\treturn toDisposable(() => editor.removeDecorations(decos));\n};\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { renderAsPlaintext } from '../../../../base/browser/markdownRenderer.js';\nimport { IMarkdownString } from '../../../../base/common/htmlContent.js';\nimport { IDisposable, toDisposable } from '../../../../base/common/lifecycle.js';\nimport { GraphemeIterator, forAnsiStringParts, removeAnsiEscapeCodes } from '../../../../base/common/strings.js';\nimport './media/testMessageColorizer.css';\nimport { CodeEditorWidget } from '../../../../editor/browser/widget/codeEditor/codeEditorWidget.js';\nimport { Position } from '../../../../editor/common/core/position.js';\nimport { Range } from '../../../../editor/common/core/range.js';\n\nconst colorAttrRe = /^\\x1b\\[([0-9]+)m$/;\n\nconst enum Classes {\n\tPrefix = 'tstm-ansidec-',\n\tForegroundPrefix = Classes.Prefix + 'fg',\n\tBackgroundPrefix = Classes.Prefix + 'bg',\n\tBold = Classes.Prefix + '1',\n\tFaint = Classes.Prefix + '2',\n\tItalic = Classes.Prefix + '3',\n\tUnderline = Classes.Prefix + '4',\n}\n\nexport const renderTestMessageAsText = (tm: string | IMarkdownString) =>\n\ttypeof tm === 'string' ? removeAnsiEscapeCodes(tm) : renderAsPlaintext(tm);\n\n\n/**\n * Applies decorations based on ANSI styles from the test message in the editor.\n * ANSI sequences are stripped from the text displayed in editor, and this\n * re-applies their colorization.\n *\n * This uses decorations rather than language features because the string\n * rendered in the editor lacks the ANSI codes needed to actually apply the\n * colorization.\n *\n * Note: does not support TrueColor.\n */\nexport const colorizeTestMessageInEditor = (message: string, editor: CodeEditorWidget): IDisposable => {\n\tconst decos: string[] = [];\n\n\teditor.changeDecorations(changeAccessor => {\n\t\tlet start = new Position(1, 1);\n\t\tlet cls: string[] = [];\n\t\tfor (const part of forAnsiStringParts(message)) {\n\t\t\tif (part.isCode) {\n\t\t\t\tconst colorAttr = colorAttrRe.exec(part.str)?.[1];\n\t\t\t\tif (!colorAttr) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tconst n = Number(colorAttr);\n\t\t\t\tif (n === 0) {\n\t\t\t\t\tcls.length = 0;\n\t\t\t\t} else if (n === 22) {\n\t\t\t\t\tcls = cls.filter(c => c !== Classes.Bold && c !== Classes.Italic);\n\t\t\t\t} else if (n === 23) {\n\t\t\t\t\tcls = cls.filter(c => c !== Classes.Italic);\n\t\t\t\t} else if (n === 24) {\n\t\t\t\t\tcls = cls.filter(c => c !== Classes.Underline);\n\t\t\t\t} else if ((n >= 30 && n <= 39) || (n >= 90 && n <= 99)) {\n\t\t\t\t\tcls = cls.filter(c => !c.startsWith(Classes.ForegroundPrefix));\n\t\t\t\t\tcls.push(Classes.ForegroundPrefix + colorAttr);\n\t\t\t\t} else if ((n >= 40 && n <= 49) || (n >= 100 && n <= 109)) {\n\t\t\t\t\tcls = cls.filter(c => !c.startsWith(Classes.BackgroundPrefix));\n\t\t\t\t\tcls.push(Classes.BackgroundPrefix + colorAttr);\n\t\t\t\t} else {\n\t\t\t\t\tcls.push(Classes.Prefix + colorAttr);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tlet line = start.lineNumber;\n\t\t\t\tlet col = start.column;\n\n\t\t\t\tconst graphemes = new GraphemeIterator(part.str);\n\t\t\t\tfor (let i = 0; !graphemes.eol(); i += graphemes.nextGraphemeLength()) {\n\t\t\t\t\tif (part.str[i] === '\\n') {\n\t\t\t\t\t\tline++;\n\t\t\t\t\t\tcol = 1;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tcol++;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tconst end = new Position(line, col);\n\t\t\t\tif (cls.length) {\n\t\t\t\t\tdecos.push(changeAccessor.addDecoration(Range.fromPositions(start, end), {\n\t\t\t\t\t\tinlineClassName: cls.join(' '),\n\t\t\t\t\t\tdescription: 'test-message-colorized',\n\t\t\t\t\t}));\n\t\t\t\t}\n\t\t\t\tstart = end;\n\t\t\t}\n\t\t}\n\t});\n\n\treturn toDisposable(() => editor.removeDecorations(decos));\n};\n"]}