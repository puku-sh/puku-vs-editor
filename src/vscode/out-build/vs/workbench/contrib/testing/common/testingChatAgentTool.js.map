{"version":3,"sources":["vs/workbench/contrib/testing/common/testingChatAgentTool.ts"],"names":[],"mappings":"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","file":"testingChatAgentTool.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { disposableTimeout, RunOnceScheduler } from '../../../../base/common/async.js';\nimport { CancellationToken } from '../../../../base/common/cancellation.js';\nimport { Codicon } from '../../../../base/common/codicons.js';\nimport { Emitter } from '../../../../base/common/event.js';\nimport { MarkdownString } from '../../../../base/common/htmlContent.js';\nimport { Disposable, DisposableStore } from '../../../../base/common/lifecycle.js';\nimport { basename, isAbsolute } from '../../../../base/common/path.js';\nimport { isDefined, Mutable } from '../../../../base/common/types.js';\nimport { URI } from '../../../../base/common/uri.js';\nimport { localize } from '../../../../nls.js';\nimport { IContextKeyService } from '../../../../platform/contextkey/common/contextkey.js';\nimport { IInstantiationService } from '../../../../platform/instantiation/common/instantiation.js';\nimport { IUriIdentityService } from '../../../../platform/uriIdentity/common/uriIdentity.js';\nimport { IWorkspaceContextService } from '../../../../platform/workspace/common/workspace.js';\nimport { IWorkbenchContribution } from '../../../common/contributions.js';\nimport {\n\tCountTokensCallback,\n\tILanguageModelToolsService,\n\tIPreparedToolInvocation,\n\tIToolData,\n\tIToolImpl,\n\tIToolInvocation,\n\tIToolInvocationPreparationContext,\n\tIToolResult,\n\tToolDataSource,\n\tToolProgress,\n} from '../../chat/common/languageModelToolsService.js';\nimport { TestId } from './testId.js';\nimport { FileCoverage, getTotalCoveragePercent } from './testCoverage.js';\nimport { TestingContextKeys } from './testingContextKeys.js';\nimport { collectTestStateCounts, getTestProgressText } from './testingProgressMessages.js';\nimport { isFailedState } from './testingStates.js';\nimport { LiveTestResult } from './testResult.js';\nimport { ITestResultService } from './testResultService.js';\nimport { ITestService, testsInFile, waitForTestToBeIdle } from './testService.js';\nimport { IncrementalTestCollectionItem, TestItemExpandState, TestMessageType, TestResultState, TestRunProfileBitset } from './testTypes.js';\nimport { Position } from '../../../../editor/common/core/position.js';\nimport { ITestProfileService } from './testProfileService.js';\n\nexport class TestingChatAgentToolContribution extends Disposable implements IWorkbenchContribution {\n\tpublic static readonly ID = 'workbench.contrib.testing.chatAgentTool';\n\n\tconstructor(\n\t\t@IInstantiationService instantiationService: IInstantiationService,\n\t\t@ILanguageModelToolsService toolsService: ILanguageModelToolsService,\n\t\t@IContextKeyService contextKeyService: IContextKeyService\n\t) {\n\t\tsuper();\n\t\tconst runTestsTool = instantiationService.createInstance(RunTestTool);\n\t\tthis._register(toolsService.registerTool(RunTestTool.DEFINITION, runTestsTool));\n\t\tthis._register(toolsService.launchToolSet.addTool(RunTestTool.DEFINITION));\n\n\t\t// todo@connor4312: temporary for 1.103 release during changeover\n\t\tcontextKeyService.createKey('chat.coreTestFailureToolEnabled', true).set(true);\n\t}\n}\n\ntype Mode = 'run' | 'coverage';\n\ninterface IRunTestToolParams {\n\tfiles?: string[];\n\ttestNames?: string[];\n\t/** File paths to return coverage info for (only used when mode === 'coverage') */\n\tcoverageFiles?: string[];\n\tmode?: Mode;\n}\n\nclass RunTestTool implements IToolImpl {\n\tpublic static readonly ID = 'runTests';\n\tpublic static readonly DEFINITION: IToolData = {\n\t\tid: this.ID,\n\t\ttoolReferenceName: 'runTests',\n\t\tlegacyToolReferenceFullNames: ['runTests'],\n\t\tcanBeReferencedInPrompt: true,\n\t\twhen: TestingContextKeys.hasRunnableTests,\n\t\tdisplayName: 'Run tests',\n\t\tmodelDescription: 'Runs unit tests in files. Use this tool if the user asks to run tests or when you want to validate changes using unit tests, and prefer using this tool instead of the terminal tool. When possible, always try to provide `files` paths containing the relevant unit tests in order to avoid unnecessarily long test runs. This tool outputs detailed information about the results of the test run. Set mode=\"coverage\" to also collect coverage and optionally provide coverageFiles for focused reporting.',\n\t\ticon: Codicon.beaker,\n\t\tinputSchema: {\n\t\t\ttype: 'object',\n\t\t\tproperties: {\n\t\t\t\tfiles: {\n\t\t\t\t\ttype: 'array',\n\t\t\t\t\titems: { type: 'string' },\n\t\t\t\t\tdescription: 'Absolute paths to the test files to run. If not provided, all test files will be run.',\n\t\t\t\t},\n\t\t\t\ttestNames: {\n\t\t\t\t\ttype: 'array',\n\t\t\t\t\titems: { type: 'string' },\n\t\t\t\t\tdescription: 'An array of test names to run. Depending on the context, test names defined in code may be strings or the names of functions or classes containing the test cases. If not provided, all tests in the files will be run.',\n\t\t\t\t},\n\t\t\t\tmode: {\n\t\t\t\t\ttype: 'string',\n\t\t\t\t\tenum: ['run', 'coverage'],\n\t\t\t\t\tdescription: 'Execution mode: \"run\" (default) runs tests normally, \"coverage\" collects coverage.',\n\t\t\t\t},\n\t\t\t\tcoverageFiles: {\n\t\t\t\t\ttype: 'array',\n\t\t\t\t\titems: { type: 'string' },\n\t\t\t\t\tdescription: 'When mode=\"coverage\": absolute file paths to include detailed coverage info for. Only the first matching file will be summarized.'\n\t\t\t\t}\n\t\t\t},\n\t\t},\n\t\tuserDescription: localize('runTestTool.userDescription', 'Run unit tests (optionally with coverage)'),\n\t\tsource: ToolDataSource.Internal,\n\t\ttags: [\n\t\t\t'vscode_editing_with_tests',\n\t\t\t'enable_other_tool_copilot_readFile',\n\t\t\t'enable_other_tool_copilot_listDirectory',\n\t\t\t'enable_other_tool_copilot_findFiles',\n\t\t\t'enable_other_tool_copilot_runTests',\n\t\t\t'enable_other_tool_copilot_runTestsWithCoverage',\n\t\t\t'enable_other_tool_copilot_testFailure',\n\t\t],\n\t};\n\n\tconstructor(\n\t\t@ITestService private readonly _testService: ITestService,\n\t\t@IUriIdentityService private readonly _uriIdentityService: IUriIdentityService,\n\t\t@IWorkspaceContextService private readonly _workspaceContextService: IWorkspaceContextService,\n\t\t@ITestResultService private readonly _testResultService: ITestResultService,\n\t\t@ITestProfileService private readonly _testProfileService: ITestProfileService,\n\t) { }\n\n\tasync invoke(invocation: IToolInvocation, countTokens: CountTokensCallback, progress: ToolProgress, token: CancellationToken): Promise<IToolResult> {\n\t\tconst params: IRunTestToolParams = invocation.parameters;\n\t\tconst mode: Mode = (params.mode === 'coverage' ? 'coverage' : 'run');\n\t\tlet group = (mode === 'coverage' ? TestRunProfileBitset.Coverage : TestRunProfileBitset.Run);\n\t\tconst coverageFiles = (mode === 'coverage' ? (params.coverageFiles && params.coverageFiles.length ? params.coverageFiles : undefined) : undefined);\n\n\t\tconst testFiles = await this._getFileTestsToRun(params, progress);\n\t\tconst testCases = await this._getTestCasesToRun(params, testFiles, progress);\n\t\tif (!testCases.length) {\n\t\t\treturn {\n\t\t\t\tcontent: [{ kind: 'text', value: 'No tests found in the files. Ensure the correct absolute paths are passed to the tool.' }],\n\t\t\t\ttoolResultError: localize('runTestTool.noTests', 'No tests found in the files'),\n\t\t\t};\n\t\t}\n\n\t\tprogress.report({ message: localize('runTestTool.invoke.progress', 'Starting test run...') });\n\n\t\t// If the model asks for coverage but the test provider doesn't support it, use normal 'run' mode\n\t\tif (group === TestRunProfileBitset.Coverage) {\n\t\t\tif (!testCases.some(tc => this._testProfileService.capabilitiesForTest(tc.item) & TestRunProfileBitset.Coverage)) {\n\t\t\t\tgroup = TestRunProfileBitset.Run;\n\t\t\t}\n\t\t}\n\n\t\tconst result = await this._captureTestResult(testCases, group, token);\n\t\tif (!result) {\n\t\t\treturn {\n\t\t\t\tcontent: [{ kind: 'text', value: 'No test run was started. Instruct the user to ensure their test runner is correctly configured' }],\n\t\t\t\ttoolResultError: localize('runTestTool.noRunStarted', 'No test run was started. This may be an issue with your test runner or extension.'),\n\t\t\t};\n\t\t}\n\n\t\tawait this._monitorRunProgress(result, progress, token);\n\n\t\tif (token.isCancellationRequested) {\n\t\t\tthis._testService.cancelTestRun(result.id);\n\t\t\treturn {\n\t\t\t\tcontent: [{ kind: 'text', value: localize('runTestTool.invoke.cancelled', 'Test run was cancelled.') }],\n\t\t\t\ttoolResultMessage: localize('runTestTool.invoke.cancelled', 'Test run was cancelled.'),\n\t\t\t};\n\t\t}\n\n\t\tconst summary = await this._buildSummary(result, mode, coverageFiles);\n\t\tconst content = [{ kind: 'text', value: summary } as const];\n\n\t\treturn {\n\t\t\tcontent: content as Mutable<IToolResult['content']>,\n\t\t\ttoolResultMessage: getTestProgressText(collectTestStateCounts(false, [result])),\n\t\t};\n\t}\n\n\tprivate async _buildSummary(result: LiveTestResult, mode: Mode, coverageFiles: string[] | undefined): Promise<string> {\n\t\tconst failures = result.counts[TestResultState.Errored] + result.counts[TestResultState.Failed];\n\t\tlet str = `<summary passed=${result.counts[TestResultState.Passed]} failed=${failures} />\\n`;\n\t\tif (failures !== 0) {\n\t\t\tstr += await this._getFailureDetails(result);\n\t\t}\n\t\tif (mode === 'coverage') {\n\t\t\tstr += await this._getCoverageSummary(result, coverageFiles);\n\t\t}\n\t\treturn str;\n\t}\n\n\tprivate async _getCoverageSummary(result: LiveTestResult, coverageFiles: string[] | undefined): Promise<string> {\n\t\tif (!coverageFiles || !coverageFiles.length) {\n\t\t\treturn '';\n\t\t}\n\t\tfor (const task of result.tasks) {\n\t\t\tconst coverage = task.coverage.get();\n\t\t\tif (!coverage) {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tconst normalized = coverageFiles.map(file => URI.file(file).fsPath);\n\t\t\tconst coveredFilesMap = new Map<string, FileCoverage>();\n\t\t\tfor (const file of coverage.getAllFiles().values()) {\n\t\t\t\tcoveredFilesMap.set(file.uri.fsPath, file);\n\t\t\t}\n\t\t\tfor (const path of normalized) {\n\t\t\t\tconst file = coveredFilesMap.get(path);\n\t\t\t\tif (!file) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tlet summary = `<coverage task=${JSON.stringify(task.name || '')}>\\n`;\n\t\t\t\tconst pct = getTotalCoveragePercent(file.statement, file.branch, file.declaration) * 100;\n\t\t\t\tsummary += `<firstUncoveredFile path=${JSON.stringify(path)} statementsCovered=${file.statement.covered} statementsTotal=${file.statement.total}`;\n\t\t\t\tif (file.branch) {\n\t\t\t\t\tsummary += ` branchesCovered=${file.branch.covered} branchesTotal=${file.branch.total}`;\n\t\t\t\t}\n\t\t\t\tif (file.declaration) {\n\t\t\t\t\tsummary += ` declarationsCovered=${file.declaration.covered} declarationsTotal=${file.declaration.total}`;\n\t\t\t\t}\n\t\t\t\tsummary += ` percent=${pct.toFixed(2)}`;\n\t\t\t\ttry {\n\t\t\t\t\tconst details = await file.details();\n\t\t\t\t\tfor (const detail of details) {\n\t\t\t\t\t\tif (detail.count || !detail.location) {\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tlet startLine: number;\n\t\t\t\t\t\tlet endLine: number;\n\t\t\t\t\t\tif (Position.isIPosition(detail.location)) {\n\t\t\t\t\t\t\tstartLine = endLine = detail.location.lineNumber;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tstartLine = detail.location.startLineNumber;\n\t\t\t\t\t\t\tendLine = detail.location.endLineNumber;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tsummary += ` firstUncoveredStart=${startLine} firstUncoveredEnd=${endLine}`;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t} catch { /* ignore */ }\n\t\t\t\tsummary += ` />\\n`;\n\t\t\t\tsummary += `</coverage>\\n`;\n\t\t\t\treturn summary;\n\t\t\t}\n\t\t}\n\t\treturn '';\n\t}\n\n\tprivate async _getFailureDetails(result: LiveTestResult): Promise<string> {\n\t\tlet str = '';\n\t\tlet hadMessages = false;\n\t\tfor (const failure of result.tests) {\n\t\t\tif (!isFailedState(failure.ownComputedState)) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tconst [, ...testPath] = TestId.split(failure.item.extId);\n\t\t\tconst testName = testPath.pop();\n\t\t\tstr += `<testFailure name=${JSON.stringify(testName)} path=${JSON.stringify(testPath.join(' > '))}>\\n`;\n\t\t\t// Extract detailed failure information from error messages\n\t\t\tfor (const task of failure.tasks) {\n\t\t\t\tfor (const message of task.messages.filter(m => m.type === TestMessageType.Error)) {\n\t\t\t\t\thadMessages = true;\n\n\t\t\t\t\t// Add expected/actual outputs if available\n\t\t\t\t\tif (message.expected !== undefined && message.actual !== undefined) {\n\t\t\t\t\t\tstr += `<expectedOutput>\\n${message.expected}\\n</expectedOutput>\\n`;\n\t\t\t\t\t\tstr += `<actualOutput>\\n${message.actual}\\n</actualOutput>\\n`;\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// Fallback to the message content\n\t\t\t\t\t\tconst messageText = typeof message.message === 'string' ? message.message : message.message.value;\n\t\t\t\t\t\tstr += `<message>\\n${messageText}\\n</message>\\n`;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Add stack trace information if available (limit to first 10 frames)\n\t\t\t\t\tif (message.stackTrace && message.stackTrace.length > 0) {\n\t\t\t\t\t\tfor (const frame of message.stackTrace.slice(0, 10)) {\n\t\t\t\t\t\t\tif (frame.uri && frame.position) {\n\t\t\t\t\t\t\t\tstr += `<stackFrame path=\"${frame.uri.fsPath}\" line=\"${frame.position.lineNumber}\" col=\"${frame.position.column}\" />\\n`;\n\t\t\t\t\t\t\t} else if (frame.uri) {\n\t\t\t\t\t\t\t\tstr += `<stackFrame path=\"${frame.uri.fsPath}\">${frame.label}</stackFrame>\\n`;\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tstr += `<stackFrame>${frame.label}</stackFrame>\\n`;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t// Add location information if available\n\t\t\t\t\tif (message.location) {\n\t\t\t\t\t\tstr += `<location path=\"${message.location.uri.fsPath}\" line=\"${message.location.range.startLineNumber}\" col=\"${message.location.range.startColumn}\" />\\n`;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tstr += `</testFailure>\\n`;\n\t\t}\n\n\t\tif (!hadMessages) { // some adapters don't have any per-test messages and just output\n\t\t\tconst output = result.tasks.map(t => t.output.getRange(0, t.output.length).toString().trim()).join('\\n');\n\t\t\tif (output) {\n\t\t\t\tstr += `<output>\\n${output}\\n</output>\\n`;\n\t\t\t}\n\t\t}\n\n\t\treturn str;\n\t}\n\n\t/** Updates the UI progress as the test runs, resolving when the run is finished. */\n\tprivate async _monitorRunProgress(result: LiveTestResult, progress: ToolProgress, token: CancellationToken): Promise<void> {\n\t\tconst store = new DisposableStore();\n\n\t\tconst update = () => {\n\t\t\tconst counts = collectTestStateCounts(!result.completedAt, [result]);\n\t\t\tconst text = getTestProgressText(counts);\n\t\t\tprogress.report({ message: text, progress: counts.runSoFar / counts.totalWillBeRun });\n\t\t};\n\n\t\tconst throttler = store.add(new RunOnceScheduler(update, 500));\n\n\t\treturn new Promise<void>(resolve => {\n\t\t\tstore.add(result.onChange(() => {\n\t\t\t\tif (!throttler.isScheduled) {\n\t\t\t\t\tthrottler.schedule();\n\t\t\t\t}\n\t\t\t}));\n\n\t\t\tstore.add(token.onCancellationRequested(() => {\n\t\t\t\tthis._testService.cancelTestRun(result.id);\n\t\t\t\tresolve();\n\t\t\t}));\n\n\t\t\tstore.add(result.onComplete(() => {\n\t\t\t\tupdate();\n\t\t\t\tresolve();\n\t\t\t}));\n\t\t}).finally(() => store.dispose());\n\t}\n\n\t/**\n\t * Captures the test result. This is a little tricky because some extensions\n\t * trigger an 'out of bound' test run, so we actually wait for the first\n\t * test run to come in that contains one or more tasks and treat that as the\n\t * one we're looking for.\n\t */\n\tprivate async _captureTestResult(testCases: IncrementalTestCollectionItem[], group: TestRunProfileBitset, token: CancellationToken): Promise<LiveTestResult | undefined> {\n\t\tconst store = new DisposableStore();\n\t\tconst onDidTimeout = store.add(new Emitter<void>());\n\n\t\treturn new Promise<LiveTestResult | undefined>(resolve => {\n\t\t\tstore.add(onDidTimeout.event(() => {\n\t\t\t\tresolve(undefined);\n\t\t\t}));\n\n\t\t\tstore.add(this._testResultService.onResultsChanged(ev => {\n\t\t\t\tif ('started' in ev) {\n\t\t\t\t\tstore.add(ev.started.onNewTask(() => {\n\t\t\t\t\t\tstore.dispose();\n\t\t\t\t\t\tresolve(ev.started);\n\t\t\t\t\t}));\n\t\t\t\t}\n\t\t\t}));\n\n\t\t\tthis._testService.runTests({\n\t\t\t\tgroup,\n\t\t\t\ttests: testCases,\n\t\t\t\tpreserveFocus: true,\n\t\t\t}, token).then(() => {\n\t\t\t\tif (!store.isDisposed) {\n\t\t\t\t\tstore.add(disposableTimeout(() => onDidTimeout.fire(), 5_000));\n\t\t\t\t}\n\t\t\t});\n\t\t}).finally(() => store.dispose());\n\t}\n\n\t/** Filters the test files to individual test cases based on the provided parameters. */\n\tprivate async _getTestCasesToRun(params: IRunTestToolParams, tests: IncrementalTestCollectionItem[], progress: ToolProgress): Promise<IncrementalTestCollectionItem[]> {\n\t\tif (!params.testNames?.length) {\n\t\t\treturn tests;\n\t\t}\n\n\t\tprogress.report({ message: localize('runTestTool.invoke.filterProgress', 'Filtering tests...') });\n\n\t\tconst testNames = params.testNames.map(t => t.toLowerCase().trim());\n\t\tconst filtered: IncrementalTestCollectionItem[] = [];\n\t\tconst doFilter = async (test: IncrementalTestCollectionItem) => {\n\t\t\tconst name = test.item.label.toLowerCase().trim();\n\t\t\tif (testNames.some(tn => name.includes(tn))) {\n\t\t\t\tfiltered.push(test);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (test.expand === TestItemExpandState.Expandable) {\n\t\t\t\tawait this._testService.collection.expand(test.item.extId, 1);\n\t\t\t}\n\t\t\tawait waitForTestToBeIdle(this._testService, test);\n\t\t\tawait Promise.all([...test.children].map(async id => {\n\t\t\t\tconst item = this._testService.collection.getNodeById(id);\n\t\t\t\tif (item) {\n\t\t\t\t\tawait doFilter(item);\n\t\t\t\t}\n\t\t\t}));\n\t\t};\n\n\t\tawait Promise.all(tests.map(doFilter));\n\t\treturn filtered;\n\t}\n\n\t/** Gets the file tests to run based on the provided parameters. */\n\tprivate async _getFileTestsToRun(params: IRunTestToolParams, progress: ToolProgress): Promise<IncrementalTestCollectionItem[]> {\n\t\tif (!params.files?.length) {\n\t\t\treturn [...this._testService.collection.rootItems];\n\t\t}\n\n\t\tprogress.report({ message: localize('runTestTool.invoke.filesProgress', 'Discovering tests...') });\n\n\t\tconst firstWorkspaceFolder = this._workspaceContextService.getWorkspace().folders.at(0)?.uri;\n\t\tconst uris = params.files.map(f => {\n\t\t\tif (isAbsolute(f)) {\n\t\t\t\treturn URI.file(f);\n\t\t\t} else if (firstWorkspaceFolder) {\n\t\t\t\treturn URI.joinPath(firstWorkspaceFolder, f);\n\t\t\t} else {\n\t\t\t\treturn undefined;\n\t\t\t}\n\t\t}).filter(isDefined);\n\n\t\tconst tests: IncrementalTestCollectionItem[] = [];\n\t\tfor (const uri of uris) {\n\t\t\tfor await (const files of testsInFile(this._testService, this._uriIdentityService, uri, undefined, false)) {\n\t\t\t\tfor (const file of files) {\n\t\t\t\t\ttests.push(file);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn tests;\n\t}\n\n\tprepareToolInvocation(context: IToolInvocationPreparationContext, token: CancellationToken): Promise<IPreparedToolInvocation | undefined> {\n\t\tconst params: IRunTestToolParams = context.parameters;\n\t\tconst title = localize('runTestTool.confirm.title', 'Allow test run?');\n\t\tconst inFiles = params.files?.map((f: string) => '`' + basename(f) + '`');\n\n\t\treturn Promise.resolve({\n\t\t\tinvocationMessage: localize('runTestTool.confirm.invocation', 'Running tests...'),\n\t\t\tconfirmationMessages: {\n\t\t\t\ttitle,\n\t\t\t\tmessage: inFiles?.length\n\t\t\t\t\t? new MarkdownString().appendMarkdown(localize('runTestTool.confirm.message', 'The model wants to run tests in {0}.', inFiles.join(', ')))\n\t\t\t\t\t: localize('runTestTool.confirm.all', 'The model wants to run all tests.'),\n\t\t\t\tallowAutoConfirm: true,\n\t\t\t},\n\t\t});\n\t}\n}\n"]}