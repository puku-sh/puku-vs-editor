{"version":3,"sources":["vs/workbench/contrib/testing/common/testServiceImpl.ts"],"names":[],"mappings":"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","file":"testServiceImpl.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { groupBy } from '../../../../base/common/arrays.js';\nimport { CancellationToken, CancellationTokenSource } from '../../../../base/common/cancellation.js';\nimport { Emitter } from '../../../../base/common/event.js';\nimport { Iterable } from '../../../../base/common/iterator.js';\nimport { Disposable, IDisposable, toDisposable } from '../../../../base/common/lifecycle.js';\nimport { observableValue } from '../../../../base/common/observable.js';\nimport { isDefined } from '../../../../base/common/types.js';\nimport { URI } from '../../../../base/common/uri.js';\nimport { Position } from '../../../../editor/common/core/position.js';\nimport { Location } from '../../../../editor/common/languages.js';\nimport { localize } from '../../../../nls.js';\nimport { IConfigurationService } from '../../../../platform/configuration/common/configuration.js';\nimport { IContextKey, IContextKeyService, RawContextKey } from '../../../../platform/contextkey/common/contextkey.js';\nimport { IInstantiationService } from '../../../../platform/instantiation/common/instantiation.js';\nimport { INotificationService } from '../../../../platform/notification/common/notification.js';\nimport { bindContextKey } from '../../../../platform/observable/common/platformObservableUtils.js';\nimport { IStorageService, StorageScope, StorageTarget } from '../../../../platform/storage/common/storage.js';\nimport { IUriIdentityService } from '../../../../platform/uriIdentity/common/uriIdentity.js';\nimport { IWorkspaceTrustRequestService } from '../../../../platform/workspace/common/workspaceTrust.js';\nimport { getTestingConfiguration, TestingConfigKeys } from './configuration.js';\nimport { MainThreadTestCollection } from './mainThreadTestCollection.js';\nimport { MutableObservableValue } from './observableValue.js';\nimport { StoredValue } from './storedValue.js';\nimport { TestExclusions } from './testExclusions.js';\nimport { TestId } from './testId.js';\nimport { TestingContextKeys } from './testingContextKeys.js';\nimport { canUseProfileWithTest, ITestProfileService } from './testProfileService.js';\nimport { ITestResult } from './testResult.js';\nimport { ITestResultService } from './testResultService.js';\nimport { AmbiguousRunTestsRequest, IMainThreadTestController, IMainThreadTestHostProxy, ITestFollowups, ITestService } from './testService.js';\nimport { InternalTestItem, ITestRunProfile, ResolvedTestRunRequest, TestControllerCapability, TestDiffOpType, TestMessageFollowupRequest, TestsDiff } from './testTypes.js';\nimport { IEditorService } from '../../../services/editor/common/editorService.js';\n\nexport class TestService extends Disposable implements ITestService {\n\tdeclare readonly _serviceBrand: undefined;\n\tprivate testControllers = observableValue<ReadonlyMap<string, IMainThreadTestController>>('testControllers', new Map<string, IMainThreadTestController>());\n\tprivate testExtHosts = new Set<IMainThreadTestHostProxy>();\n\n\tprivate readonly cancelExtensionTestRunEmitter = new Emitter<{ runId: string | undefined; taskId: string | undefined }>();\n\tprivate readonly willProcessDiffEmitter = new Emitter<TestsDiff>();\n\tprivate readonly didProcessDiffEmitter = new Emitter<TestsDiff>();\n\tprivate readonly testRefreshCancellations = new Set<CancellationTokenSource>();\n\tprivate readonly isRefreshingTests: IContextKey<boolean>;\n\tprivate readonly activeEditorHasTests: IContextKey<boolean>;\n\n\t/**\n\t * Cancellation for runs requested by the user being managed by the UI.\n\t * Test runs initiated by extensions are not included here.\n\t */\n\tprivate readonly uiRunningTests = new Map<string /* run ID */, CancellationTokenSource>();\n\n\t/**\n\t * @inheritdoc\n\t */\n\tpublic readonly onWillProcessDiff = this.willProcessDiffEmitter.event;\n\n\t/**\n\t * @inheritdoc\n\t */\n\tpublic readonly onDidProcessDiff = this.didProcessDiffEmitter.event;\n\n\t/**\n\t * @inheritdoc\n\t */\n\tpublic readonly onDidCancelTestRun = this.cancelExtensionTestRunEmitter.event;\n\n\t/**\n\t * @inheritdoc\n\t */\n\tpublic readonly collection: MainThreadTestCollection;\n\n\t/**\n\t * @inheritdoc\n\t */\n\tpublic readonly excluded: TestExclusions;\n\n\t/**\n\t * @inheritdoc\n\t */\n\tpublic readonly showInlineOutput: MutableObservableValue<boolean>;\n\n\tconstructor(\n\t\t@IContextKeyService contextKeyService: IContextKeyService,\n\t\t@IInstantiationService instantiationService: IInstantiationService,\n\t\t@IUriIdentityService uriIdentityService: IUriIdentityService,\n\t\t@IStorageService storage: IStorageService,\n\t\t@IEditorService private readonly editorService: IEditorService,\n\t\t@ITestProfileService private readonly testProfiles: ITestProfileService,\n\t\t@INotificationService private readonly notificationService: INotificationService,\n\t\t@IConfigurationService private readonly configurationService: IConfigurationService,\n\t\t@ITestResultService private readonly testResults: ITestResultService,\n\t\t@IWorkspaceTrustRequestService private readonly workspaceTrustRequestService: IWorkspaceTrustRequestService,\n\t) {\n\t\tsuper();\n\t\tthis.collection = new MainThreadTestCollection(uriIdentityService, this.expandTest.bind(this));\n\t\tthis.showInlineOutput = this._register(MutableObservableValue.stored(new StoredValue<boolean>({\n\t\t\tkey: 'inlineTestOutputVisible',\n\t\t\tscope: StorageScope.WORKSPACE,\n\t\t\ttarget: StorageTarget.USER\n\t\t}, storage), true));\n\n\t\tthis.excluded = instantiationService.createInstance(TestExclusions);\n\t\tthis.isRefreshingTests = TestingContextKeys.isRefreshingTests.bindTo(contextKeyService);\n\t\tthis.activeEditorHasTests = TestingContextKeys.activeEditorHasTests.bindTo(contextKeyService);\n\n\t\tthis._register(bindContextKey(TestingContextKeys.providerCount, contextKeyService,\n\t\t\treader => this.testControllers.read(reader).size));\n\n\t\tconst bindCapability = (key: RawContextKey<boolean>, capability: TestControllerCapability) =>\n\t\t\tthis._register(bindContextKey(key, contextKeyService, reader =>\n\t\t\t\tIterable.some(\n\t\t\t\t\tthis.testControllers.read(reader).values(),\n\t\t\t\t\tctrl => !!(ctrl.capabilities.read(reader) & capability)\n\t\t\t\t),\n\t\t\t));\n\n\t\tbindCapability(TestingContextKeys.canRefreshTests, TestControllerCapability.Refresh);\n\t\tbindCapability(TestingContextKeys.canGoToRelatedCode, TestControllerCapability.CodeRelatedToTest);\n\t\tbindCapability(TestingContextKeys.canGoToRelatedTest, TestControllerCapability.TestRelatedToCode);\n\n\t\tthis._register(editorService.onDidActiveEditorChange(() => this.updateEditorContextKeys()));\n\t}\n\n\t/**\n\t * @inheritdoc\n\t */\n\tpublic async expandTest(id: string, levels: number) {\n\t\tawait this.testControllers.get().get(TestId.fromString(id).controllerId)?.expandTest(id, levels);\n\t}\n\n\t/**\n\t * @inheritdoc\n\t */\n\tpublic cancelTestRun(runId?: string, taskId?: string) {\n\t\tthis.cancelExtensionTestRunEmitter.fire({ runId, taskId });\n\n\t\tif (runId === undefined) {\n\t\t\tfor (const runCts of this.uiRunningTests.values()) {\n\t\t\t\trunCts.cancel();\n\t\t\t}\n\t\t} else if (!taskId) {\n\t\t\tthis.uiRunningTests.get(runId)?.cancel();\n\t\t}\n\t}\n\n\t/**\n\t * @inheritdoc\n\t */\n\tpublic async runTests(req: AmbiguousRunTestsRequest, token = CancellationToken.None): Promise<ITestResult> {\n\t\t// We try to ensure that all tests in the request will be run, preferring\n\t\t// to use default profiles for each controller when possible.\n\t\tconst byProfile: { profile: ITestRunProfile; tests: InternalTestItem[] }[] = [];\n\t\tfor (const test of req.tests) {\n\t\t\tconst existing = byProfile.find(p => canUseProfileWithTest(p.profile, test));\n\t\t\tif (existing) {\n\t\t\t\texisting.tests.push(test);\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tconst bestProfile = this.testProfiles.getDefaultProfileForTest(req.group, test);\n\t\t\tif (!bestProfile) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tbyProfile.push({ profile: bestProfile, tests: [test] });\n\t\t}\n\n\t\tconst resolved: ResolvedTestRunRequest = {\n\t\t\ttargets: byProfile.map(({ profile, tests }) => ({\n\t\t\t\tprofileId: profile.profileId,\n\t\t\t\tcontrollerId: tests[0].controllerId,\n\t\t\t\ttestIds: tests.map(t => t.item.extId),\n\t\t\t})),\n\t\t\tgroup: req.group,\n\t\t\texclude: req.exclude?.map(t => t.item.extId),\n\t\t\tcontinuous: req.continuous,\n\t\t\tpreserveFocus: req.preserveFocus,\n\t\t};\n\n\t\t// If no tests are covered by the defaults, just use whatever the defaults\n\t\t// for their controller are. This can happen if the user chose specific\n\t\t// profiles for the run button, but then asked to run a single test from the\n\t\t// explorer or decoration. We shouldn't no-op.\n\t\tif (resolved.targets.length === 0) {\n\t\t\tfor (const byController of groupBy(req.tests, (a, b) => a.controllerId === b.controllerId ? 0 : 1)) {\n\t\t\t\tconst profiles = this.testProfiles.getControllerProfiles(byController[0].controllerId);\n\t\t\t\tconst withControllers = byController.map(test => ({\n\t\t\t\t\tprofile: profiles.find(p => p.group === req.group && canUseProfileWithTest(p, test)),\n\t\t\t\t\ttest,\n\t\t\t\t}));\n\n\t\t\t\tfor (const byProfile of groupBy(withControllers, (a, b) => a.profile === b.profile ? 0 : 1)) {\n\t\t\t\t\tconst profile = byProfile[0].profile;\n\t\t\t\t\tif (profile) {\n\t\t\t\t\t\tresolved.targets.push({\n\t\t\t\t\t\t\ttestIds: byProfile.map(t => t.test.item.extId),\n\t\t\t\t\t\t\tprofileId: profile.profileId,\n\t\t\t\t\t\t\tcontrollerId: profile.controllerId,\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn this.runResolvedTests(resolved, token);\n\t}\n\n\t/** @inheritdoc */\n\tpublic async startContinuousRun(req: ResolvedTestRunRequest, token: CancellationToken) {\n\t\tif (!req.exclude) {\n\t\t\treq.exclude = [...this.excluded.all];\n\t\t}\n\n\t\tconst trust = await this.workspaceTrustRequestService.requestWorkspaceTrust({\n\t\t\tmessage: localize('testTrust', \"Running tests may execute code in your workspace.\"),\n\t\t});\n\n\t\tif (!trust) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst byController = groupBy(req.targets, (a, b) => a.controllerId.localeCompare(b.controllerId));\n\t\tconst requests = byController.map(\n\t\t\tgroup => this.getTestController(group[0].controllerId)?.startContinuousRun(\n\t\t\t\tgroup.map(controlReq => ({\n\t\t\t\t\texcludeExtIds: req.exclude!.filter(t => !controlReq.testIds.includes(t)),\n\t\t\t\t\tprofileId: controlReq.profileId,\n\t\t\t\t\tcontrollerId: controlReq.controllerId,\n\t\t\t\t\ttestIds: controlReq.testIds,\n\t\t\t\t})),\n\t\t\t\ttoken,\n\t\t\t).then(result => {\n\t\t\t\tconst errs = result.map(r => r.error).filter(isDefined);\n\t\t\t\tif (errs.length) {\n\t\t\t\t\tthis.notificationService.error(localize('testError', 'An error occurred attempting to run tests: {0}', errs.join(' ')));\n\t\t\t\t}\n\t\t\t})\n\t\t);\n\n\t\tawait Promise.all(requests);\n\t}\n\n\t/**\n\t * @inheritdoc\n\t */\n\tpublic async runResolvedTests(req: ResolvedTestRunRequest, token = CancellationToken.None) {\n\t\tif (!req.exclude) {\n\t\t\treq.exclude = [...this.excluded.all];\n\t\t}\n\n\t\tconst result = this.testResults.createLiveResult(req);\n\t\tconst trust = await this.workspaceTrustRequestService.requestWorkspaceTrust({\n\t\t\tmessage: localize('testTrust', \"Running tests may execute code in your workspace.\"),\n\t\t});\n\n\t\tif (!trust) {\n\t\t\tresult.markComplete();\n\t\t\treturn result;\n\t\t}\n\n\t\ttry {\n\t\t\tconst cancelSource = new CancellationTokenSource(token);\n\t\t\tthis.uiRunningTests.set(result.id, cancelSource);\n\n\t\t\tconst byController = groupBy(req.targets, (a, b) => a.controllerId.localeCompare(b.controllerId));\n\t\t\tconst requests = byController.map(\n\t\t\t\tgroup => this.getTestController(group[0].controllerId)?.runTests(\n\t\t\t\t\tgroup.map(controlReq => ({\n\t\t\t\t\t\trunId: result.id,\n\t\t\t\t\t\texcludeExtIds: req.exclude!.filter(t => !controlReq.testIds.includes(t)),\n\t\t\t\t\t\tprofileId: controlReq.profileId,\n\t\t\t\t\t\tcontrollerId: controlReq.controllerId,\n\t\t\t\t\t\ttestIds: controlReq.testIds,\n\t\t\t\t\t})),\n\t\t\t\t\tcancelSource.token,\n\t\t\t\t).then(result => {\n\t\t\t\t\tconst errs = result.map(r => r.error).filter(isDefined);\n\t\t\t\t\tif (errs.length) {\n\t\t\t\t\t\tthis.notificationService.error(localize('testError', 'An error occurred attempting to run tests: {0}', errs.join(' ')));\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t);\n\t\t\tawait this.saveAllBeforeTest(req);\n\t\t\tawait Promise.all(requests);\n\t\t\treturn result;\n\t\t} finally {\n\t\t\tthis.uiRunningTests.delete(result.id);\n\t\t\tresult.markComplete();\n\t\t}\n\t}\n\n\t/**\n\t * @inheritdoc\n\t */\n\tpublic async provideTestFollowups(req: TestMessageFollowupRequest, token: CancellationToken): Promise<ITestFollowups> {\n\t\tconst reqs = await Promise.all([...this.testExtHosts].map(async ctrl =>\n\t\t\t({ ctrl, followups: await ctrl.provideTestFollowups(req, token) })));\n\n\t\tconst followups: ITestFollowups = {\n\t\t\tfollowups: reqs.flatMap(({ ctrl, followups }) => followups.map(f => ({\n\t\t\t\tmessage: f.title,\n\t\t\t\texecute: () => ctrl.executeTestFollowup(f.id)\n\t\t\t}))),\n\t\t\tdispose: () => {\n\t\t\t\tfor (const { ctrl, followups } of reqs) {\n\t\t\t\t\tctrl.disposeTestFollowups(followups.map(f => f.id));\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\tif (token.isCancellationRequested) {\n\t\t\tfollowups.dispose();\n\t\t}\n\n\t\treturn followups;\n\t}\n\n\t/**\n\t * @inheritdoc\n\t */\n\tpublic publishDiff(_controllerId: string, diff: TestsDiff) {\n\t\tthis.willProcessDiffEmitter.fire(diff);\n\t\tthis.collection.apply(diff);\n\t\tthis.updateEditorContextKeys();\n\t\tthis.didProcessDiffEmitter.fire(diff);\n\t}\n\n\t/**\n\t * @inheritdoc\n\t */\n\tpublic getTestController(id: string) {\n\t\treturn this.testControllers.get().get(id);\n\t}\n\n\t/**\n\t * @inheritdoc\n\t */\n\tpublic async syncTests(): Promise<void> {\n\t\tconst cts = new CancellationTokenSource();\n\t\ttry {\n\t\t\tawait Promise.all([...this.testControllers.get().values()].map(c => c.syncTests(cts.token)));\n\t\t} finally {\n\t\t\tcts.dispose(true);\n\t\t}\n\t}\n\n\t/**\n\t * @inheritdoc\n\t */\n\tpublic async refreshTests(controllerId?: string): Promise<void> {\n\t\tconst cts = new CancellationTokenSource();\n\t\tthis.testRefreshCancellations.add(cts);\n\t\tthis.isRefreshingTests.set(true);\n\n\t\ttry {\n\t\t\tif (controllerId) {\n\t\t\t\tawait this.getTestController(controllerId)?.refreshTests(cts.token);\n\t\t\t} else {\n\t\t\t\tawait Promise.all([...this.testControllers.get().values()].map(c => c.refreshTests(cts.token)));\n\t\t\t}\n\t\t} finally {\n\t\t\tthis.testRefreshCancellations.delete(cts);\n\t\t\tthis.isRefreshingTests.set(this.testRefreshCancellations.size > 0);\n\t\t\tcts.dispose(true);\n\t\t}\n\t}\n\n\t/**\n\t * @inheritdoc\n\t */\n\tpublic cancelRefreshTests(): void {\n\t\tfor (const cts of this.testRefreshCancellations) {\n\t\t\tcts.cancel();\n\t\t}\n\t\tthis.testRefreshCancellations.clear();\n\t\tthis.isRefreshingTests.set(false);\n\t}\n\n\t/**\n\t * @inheritdoc\n\t */\n\tpublic registerExtHost(controller: IMainThreadTestHostProxy): IDisposable {\n\t\tthis.testExtHosts.add(controller);\n\t\treturn toDisposable(() => this.testExtHosts.delete(controller));\n\t}\n\n\t/**\n\t * @inheritdoc\n\t */\n\tpublic async getTestsRelatedToCode(uri: URI, position: Position, token: CancellationToken = CancellationToken.None): Promise<InternalTestItem[]> {\n\t\tconst testIds = await Promise.all([...this.testExtHosts.values()].map(v => v.getTestsRelatedToCode(uri, position, token)));\n\t\t// ext host will flush diffs before returning, so we should have everything here:\n\t\treturn testIds.flatMap(ids => ids.map(id => this.collection.getNodeById(id))).filter(isDefined);\n\t}\n\n\t/**\n\t * @inheritdoc\n\t */\n\tpublic registerTestController(id: string, controller: IMainThreadTestController): IDisposable {\n\t\tthis.testControllers.set(new Map(this.testControllers.get()).set(id, controller), undefined);\n\n\t\treturn toDisposable(() => {\n\t\t\tconst diff: TestsDiff = [];\n\t\t\tfor (const root of this.collection.rootItems) {\n\t\t\t\tif (root.controllerId === id) {\n\t\t\t\t\tdiff.push({ op: TestDiffOpType.Remove, itemId: root.item.extId });\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis.publishDiff(id, diff);\n\n\t\t\tconst next = new Map(this.testControllers.get());\n\t\t\tnext.delete(id);\n\t\t\tthis.testControllers.set(next, undefined);\n\t\t});\n\t}\n\n\t/**\n\t * @inheritdoc\n\t */\n\tpublic async getCodeRelatedToTest(test: InternalTestItem, token: CancellationToken = CancellationToken.None): Promise<Location[]> {\n\t\treturn (await this.testControllers.get().get(test.controllerId)?.getRelatedCode(test.item.extId, token)) || [];\n\t}\n\n\tprivate updateEditorContextKeys() {\n\t\tconst uri = this.editorService.activeEditor?.resource;\n\t\tif (uri) {\n\t\t\tthis.activeEditorHasTests.set(!Iterable.isEmpty(this.collection.getNodeByUrl(uri)));\n\t\t} else {\n\t\t\tthis.activeEditorHasTests.set(false);\n\t\t}\n\t}\n\n\tprivate async saveAllBeforeTest(req: ResolvedTestRunRequest, configurationService: IConfigurationService = this.configurationService, editorService: IEditorService = this.editorService): Promise<void> {\n\t\tif (req.preserveFocus === true) {\n\t\t\treturn;\n\t\t}\n\t\tconst saveBeforeTest = getTestingConfiguration(this.configurationService, TestingConfigKeys.SaveBeforeTest);\n\t\tif (saveBeforeTest) {\n\t\t\tawait editorService.saveAll();\n\t\t}\n\t\treturn;\n\t}\n}\n\n\n"]}