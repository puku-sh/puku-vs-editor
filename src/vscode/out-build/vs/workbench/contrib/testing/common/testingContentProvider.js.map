{"version":3,"sources":["vs/workbench/contrib/testing/common/testingContentProvider.ts"],"names":[],"mappings":"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","file":"testingContentProvider.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { VSBuffer } from '../../../../base/common/buffer.js';\nimport { DisposableStore } from '../../../../base/common/lifecycle.js';\nimport { removeAnsiEscapeCodes } from '../../../../base/common/strings.js';\nimport { URI } from '../../../../base/common/uri.js';\nimport { ILanguageSelection, ILanguageService } from '../../../../editor/common/languages/language.js';\nimport { ITextModel } from '../../../../editor/common/model.js';\nimport { IModelService } from '../../../../editor/common/services/model.js';\nimport { ITextModelContentProvider, ITextModelService } from '../../../../editor/common/services/resolverService.js';\nimport { localize } from '../../../../nls.js';\nimport { IWorkbenchContribution } from '../../../common/contributions.js';\nimport { ITestResultService } from './testResultService.js';\nimport { TestMessageType } from './testTypes.js';\nimport { TEST_DATA_SCHEME, TestUriType, parseTestUri } from './testingUri.js';\n\n/**\n * A content provider that returns various outputs for tests. This is used\n * in the inline peek view.\n */\nexport class TestingContentProvider implements IWorkbenchContribution, ITextModelContentProvider {\n\tpublic static readonly ID = 'workbench.contrib.testing.contentProvider';\n\n\tconstructor(\n\t\t@ITextModelService textModelResolverService: ITextModelService,\n\t\t@ILanguageService private readonly languageService: ILanguageService,\n\t\t@IModelService private readonly modelService: IModelService,\n\t\t@ITestResultService private readonly resultService: ITestResultService,\n\t) {\n\t\ttextModelResolverService.registerTextModelContentProvider(TEST_DATA_SCHEME, this);\n\t}\n\n\t/**\n\t * @inheritdoc\n\t */\n\tpublic async provideTextContent(resource: URI): Promise<ITextModel | null> {\n\t\tconst existing = this.modelService.getModel(resource);\n\t\tif (existing && !existing.isDisposed()) {\n\t\t\treturn existing;\n\t\t}\n\n\t\tconst parsed = parseTestUri(resource);\n\t\tif (!parsed) {\n\t\t\treturn null;\n\t\t}\n\n\t\tconst result = this.resultService.getResult(parsed.resultId);\n\t\tif (!result) {\n\t\t\treturn null;\n\t\t}\n\n\t\tif (parsed.type === TestUriType.TaskOutput) {\n\t\t\tconst task = result.tasks[parsed.taskIndex];\n\t\t\tconst model = this.modelService.createModel('', null, resource, false);\n\t\t\tconst append = (text: string) => model.applyEdits([{\n\t\t\t\trange: { startColumn: 1, endColumn: 1, startLineNumber: Infinity, endLineNumber: Infinity },\n\t\t\t\ttext,\n\t\t\t}]);\n\n\t\t\tconst init = VSBuffer.concat(task.output.buffers, task.output.length).toString();\n\t\t\tappend(removeAnsiEscapeCodes(init));\n\n\t\t\tlet hadContent = init.length > 0;\n\t\t\tconst dispose = new DisposableStore();\n\t\t\tdispose.add(task.output.onDidWriteData(d => {\n\t\t\t\thadContent ||= d.byteLength > 0;\n\t\t\t\tappend(removeAnsiEscapeCodes(d.toString()));\n\t\t\t}));\n\t\t\ttask.output.endPromise.then(() => {\n\t\t\t\tif (dispose.isDisposed) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tif (!hadContent) {\n\t\t\t\t\tappend(localize('runNoOutout', 'The test run did not record any output.'));\n\t\t\t\t\tdispose.dispose();\n\t\t\t\t}\n\t\t\t});\n\t\t\tmodel.onWillDispose(() => dispose.dispose());\n\n\t\t\treturn model;\n\t\t}\n\n\t\tconst test = result?.getStateById(parsed.testExtId);\n\t\tif (!test) {\n\t\t\treturn null;\n\t\t}\n\n\t\tlet text: string | undefined;\n\t\tlet language: ILanguageSelection | null = null;\n\t\tswitch (parsed.type) {\n\t\t\tcase TestUriType.ResultActualOutput: {\n\t\t\t\tconst message = test.tasks[parsed.taskIndex].messages[parsed.messageIndex];\n\t\t\t\tif (message?.type === TestMessageType.Error) { text = message.actual; }\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcase TestUriType.TestOutput: {\n\t\t\t\ttext = '';\n\t\t\t\tconst output = result.tasks[parsed.taskIndex].output;\n\t\t\t\tfor (const message of test.tasks[parsed.taskIndex].messages) {\n\t\t\t\t\tif (message.type === TestMessageType.Output) {\n\t\t\t\t\t\ttext += removeAnsiEscapeCodes(output.getRange(message.offset, message.length).toString());\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcase TestUriType.ResultExpectedOutput: {\n\t\t\t\tconst message = test.tasks[parsed.taskIndex].messages[parsed.messageIndex];\n\t\t\t\tif (message?.type === TestMessageType.Error) { text = message.expected; }\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcase TestUriType.ResultMessage: {\n\t\t\t\tconst message = test.tasks[parsed.taskIndex].messages[parsed.messageIndex];\n\t\t\t\tif (!message) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tif (message.type === TestMessageType.Output) {\n\t\t\t\t\tconst content = result.tasks[parsed.taskIndex].output.getRange(message.offset, message.length);\n\t\t\t\t\ttext = removeAnsiEscapeCodes(content.toString());\n\t\t\t\t} else if (typeof message.message === 'string') {\n\t\t\t\t\ttext = removeAnsiEscapeCodes(message.message);\n\t\t\t\t} else {\n\t\t\t\t\ttext = message.message.value;\n\t\t\t\t\tlanguage = this.languageService.createById('markdown');\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (text === undefined) {\n\t\t\treturn null;\n\t\t}\n\n\t\treturn this.modelService.createModel(text, language, resource, false);\n\t}\n}\n"]}