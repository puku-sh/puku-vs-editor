{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/contrib/testing/test/common/testingContinuousRunService.test.ts","vs/workbench/contrib/testing/test/common/testingContinuousRunService.test.ts"],"names":[],"mappings":"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","file":"testingContinuousRunService.test.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as assert from 'assert';\nimport { CancellationToken } from '../../../../../base/common/cancellation.js';\nimport { Emitter } from '../../../../../base/common/event.js';\nimport { ensureNoDisposablesAreLeakedInTestSuite } from '../../../../../base/test/common/utils.js';\nimport { MockContextKeyService } from '../../../../../platform/keybinding/test/common/mockKeybindingService.js';\nimport { mock, TestStorageService } from '../../../../test/common/workbenchTestServices.js';\nimport { ITestingContinuousRunService, TestingContinuousRunService } from '../../common/testingContinuousRunService.js';\nimport { ITestProfileService } from '../../common/testProfileService.js';\nimport { ITestService } from '../../common/testService.js';\nimport { ITestRunProfile, ResolvedTestRunRequest, TestRunProfileBitset } from '../../common/testTypes.js';\n\nsuite('TestingContinuousRunService', () => {\n\tconst ds = ensureNoDisposablesAreLeakedInTestSuite();\n\tlet testService: MockTestService;\n\tlet cr: ITestingContinuousRunService;\n\n\tconst profile1: ITestRunProfile = { profileId: 1, controllerId: 'ctrl', group: TestRunProfileBitset.Run, label: 'label', supportsContinuousRun: true, isDefault: false, hasConfigurationHandler: true, tag: null };\n\tconst profile2: ITestRunProfile = { profileId: 2, controllerId: 'ctrl', group: TestRunProfileBitset.Run, label: 'label', supportsContinuousRun: true, isDefault: false, hasConfigurationHandler: true, tag: null };\n\n\tclass MockTestService extends mock<ITestService>() {\n\t\tpublic requests = new Set<ResolvedTestRunRequest>();\n\t\tpublic log: [kind: 'start' | 'stop', profileId: number, testIds: string[]][] = [];\n\n\t\toverride startContinuousRun(req: ResolvedTestRunRequest, token: CancellationToken): Promise<void> {\n\t\t\tthis.requests.add(req);\n\t\t\tthis.log.push(['start', req.targets[0].profileId, req.targets[0].testIds]);\n\t\t\tds.add(token.onCancellationRequested(() => {\n\t\t\t\tthis.log.push(['stop', req.targets[0].profileId, req.targets[0].testIds]);\n\t\t\t\tthis.requests.delete(req);\n\t\t\t}));\n\t\t\treturn Promise.resolve();\n\t\t}\n\t}\n\n\tclass MockProfilesService extends mock<ITestProfileService>() {\n\t\tpublic didChangeEmitter = ds.add(new Emitter<void>());\n\t\toverride onDidChange = this.didChangeEmitter.event;\n\n\t\toverride getGroupDefaultProfiles(group: TestRunProfileBitset, controllerId?: string): ITestRunProfile[] {\n\t\t\treturn [];\n\t\t}\n\t}\n\n\tsetup(() => {\n\t\ttestService = new MockTestService();\n\t\tcr = ds.add(new TestingContinuousRunService(\n\t\t\ttestService,\n\t\t\tds.add(new TestStorageService()),\n\t\t\tds.add(new MockContextKeyService()),\n\t\t\tnew MockProfilesService(),\n\t\t));\n\t});\n\n\ttest('isSpecificallyEnabledFor', () => {\n\t\tassert.strictEqual(cr.isEnabled(), false);\n\t\tassert.strictEqual(cr.isSpecificallyEnabledFor('testId'), false);\n\n\t\tcr.start([profile1], 'testId\\0child');\n\t\tassert.strictEqual(cr.isSpecificallyEnabledFor('testId'), false);\n\t\tassert.strictEqual(cr.isSpecificallyEnabledFor('testId\\0child'), true);\n\n\t\tassert.deepStrictEqual(testService.log, [\n\t\t\t['start', 1, ['testId\\0child']],\n\t\t]);\n\t});\n\n\ttest('isEnabledForAParentOf', () => {\n\t\tassert.strictEqual(cr.isEnabled(), false);\n\t\tassert.strictEqual(cr.isEnabledForAParentOf('testId'), false);\n\t\tcr.start([profile1], 'parentTestId\\0testId');\n\t\tassert.strictEqual(cr.isEnabledForAParentOf('parentTestId'), false);\n\t\tassert.strictEqual(cr.isEnabledForAParentOf('parentTestId\\0testId'), true);\n\t\tassert.strictEqual(cr.isEnabledForAParentOf('parentTestId\\0testId\\0nestd'), true);\n\t\tassert.strictEqual(cr.isEnabled(), true);\n\n\t\tassert.deepStrictEqual(testService.log, [\n\t\t\t['start', 1, ['parentTestId\\0testId']],\n\t\t]);\n\t});\n\n\ttest('isEnabledForAChildOf', () => {\n\t\tassert.strictEqual(cr.isEnabled(), false);\n\t\tassert.strictEqual(cr.isEnabledForAChildOf('testId'), false);\n\t\tcr.start([profile1], 'testId\\0childTestId');\n\t\tassert.strictEqual(cr.isEnabledForAChildOf('testId'), true);\n\t\tassert.strictEqual(cr.isEnabledForAChildOf('testId\\0childTestId'), true);\n\t\tassert.strictEqual(cr.isEnabledForAChildOf('testId\\0childTestId\\0neested'), false);\n\t\tassert.strictEqual(cr.isEnabled(), true);\n\t});\n\n\tsuite('lifecycle', () => {\n\t\ttest('stops general in DFS order', () => {\n\t\t\tcr.start([profile1], 'a\\0b\\0c\\0d');\n\t\t\tcr.start([profile1], 'a\\0b');\n\t\t\tcr.start([profile1], 'a\\0b\\0c');\n\t\t\tcr.stop();\n\t\t\tassert.deepStrictEqual(testService.log, [\n\t\t\t\t['start', 1, ['a\\0b\\0c\\0d']],\n\t\t\t\t['start', 1, ['a\\0b']],\n\t\t\t\t['start', 1, ['a\\0b\\0c']],\n\t\t\t\t['stop', 1, ['a\\0b\\0c\\0d']],\n\t\t\t\t['stop', 1, ['a\\0b\\0c']],\n\t\t\t\t['stop', 1, ['a\\0b']],\n\t\t\t]);\n\t\t\tassert.strictEqual(cr.isEnabled(), false);\n\t\t});\n\n\t\ttest('stops profiles in DFS order', () => {\n\t\t\tcr.start([profile1], 'a\\0b\\0c\\0d');\n\t\t\tcr.start([profile1], 'a\\0b');\n\t\t\tcr.start([profile1], 'a\\0b\\0c');\n\t\t\tcr.stopProfile(profile1);\n\t\t\tassert.deepStrictEqual(testService.log, [\n\t\t\t\t['start', 1, ['a\\0b\\0c\\0d']],\n\t\t\t\t['start', 1, ['a\\0b']],\n\t\t\t\t['start', 1, ['a\\0b\\0c']],\n\t\t\t\t['stop', 1, ['a\\0b\\0c\\0d']],\n\t\t\t\t['stop', 1, ['a\\0b\\0c']],\n\t\t\t\t['stop', 1, ['a\\0b']],\n\t\t\t]);\n\t\t\tassert.strictEqual(cr.isEnabled(), false);\n\t\t});\n\n\t\ttest('updates profile for a test if profile is changed', () => {\n\t\t\tcr.start([profile1], 'parent\\0testId');\n\t\t\tcr.start([profile2], 'parent\\0testId');\n\t\t\tassert.strictEqual(cr.isEnabled(), true);\n\t\t\tcr.stop();\n\t\t\tassert.strictEqual(cr.isEnabled(), false);\n\t\t\tassert.deepStrictEqual(testService.log, [\n\t\t\t\t['start', 1, ['parent\\0testId']],\n\t\t\t\t['start', 2, ['parent\\0testId']],\n\t\t\t\t['stop', 1, ['parent\\0testId']],\n\t\t\t\t['stop', 2, ['parent\\0testId']],\n\t\t\t]);\n\t\t\tassert.strictEqual(cr.isEnabled(), false);\n\t\t});\n\n\t\ttest('stops a single profile test', () => {\n\t\t\tcr.start([profile1, profile2], 'parent\\0testId');\n\t\t\tcr.stopProfile(profile1);\n\t\t\tassert.deepStrictEqual(testService.log, [\n\t\t\t\t['start', 1, ['parent\\0testId']],\n\t\t\t\t['start', 2, ['parent\\0testId']],\n\t\t\t\t['stop', 1, ['parent\\0testId']],\n\t\t\t]);\n\t\t\tassert.strictEqual(cr.isEnabled(), true);\n\n\t\t\tcr.stopProfile(profile2);\n\t\t\tassert.deepStrictEqual(testService.log, [\n\t\t\t\t['start', 1, ['parent\\0testId']],\n\t\t\t\t['start', 2, ['parent\\0testId']],\n\t\t\t\t['stop', 1, ['parent\\0testId']],\n\t\t\t\t['stop', 2, ['parent\\0testId']],\n\t\t\t]);\n\t\t\tassert.strictEqual(cr.isEnabled(), false);\n\t\t});\n\t});\n});\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as assert from 'assert';\nimport { CancellationToken } from '../../../../../base/common/cancellation.js';\nimport { Emitter } from '../../../../../base/common/event.js';\nimport { ensureNoDisposablesAreLeakedInTestSuite } from '../../../../../base/test/common/utils.js';\nimport { MockContextKeyService } from '../../../../../platform/keybinding/test/common/mockKeybindingService.js';\nimport { mock, TestStorageService } from '../../../../test/common/workbenchTestServices.js';\nimport { ITestingContinuousRunService, TestingContinuousRunService } from '../../common/testingContinuousRunService.js';\nimport { ITestProfileService } from '../../common/testProfileService.js';\nimport { ITestService } from '../../common/testService.js';\nimport { ITestRunProfile, ResolvedTestRunRequest, TestRunProfileBitset } from '../../common/testTypes.js';\n\nsuite('TestingContinuousRunService', () => {\n\tconst ds = ensureNoDisposablesAreLeakedInTestSuite();\n\tlet testService: MockTestService;\n\tlet cr: ITestingContinuousRunService;\n\n\tconst profile1: ITestRunProfile = { profileId: 1, controllerId: 'ctrl', group: TestRunProfileBitset.Run, label: 'label', supportsContinuousRun: true, isDefault: false, hasConfigurationHandler: true, tag: null };\n\tconst profile2: ITestRunProfile = { profileId: 2, controllerId: 'ctrl', group: TestRunProfileBitset.Run, label: 'label', supportsContinuousRun: true, isDefault: false, hasConfigurationHandler: true, tag: null };\n\n\tclass MockTestService extends mock<ITestService>() {\n\t\tpublic requests = new Set<ResolvedTestRunRequest>();\n\t\tpublic log: [kind: 'start' | 'stop', profileId: number, testIds: string[]][] = [];\n\n\t\toverride startContinuousRun(req: ResolvedTestRunRequest, token: CancellationToken): Promise<void> {\n\t\t\tthis.requests.add(req);\n\t\t\tthis.log.push(['start', req.targets[0].profileId, req.targets[0].testIds]);\n\t\t\tds.add(token.onCancellationRequested(() => {\n\t\t\t\tthis.log.push(['stop', req.targets[0].profileId, req.targets[0].testIds]);\n\t\t\t\tthis.requests.delete(req);\n\t\t\t}));\n\t\t\treturn Promise.resolve();\n\t\t}\n\t}\n\n\tclass MockProfilesService extends mock<ITestProfileService>() {\n\t\tpublic didChangeEmitter = ds.add(new Emitter<void>());\n\t\toverride onDidChange = this.didChangeEmitter.event;\n\n\t\toverride getGroupDefaultProfiles(group: TestRunProfileBitset, controllerId?: string): ITestRunProfile[] {\n\t\t\treturn [];\n\t\t}\n\t}\n\n\tsetup(() => {\n\t\ttestService = new MockTestService();\n\t\tcr = ds.add(new TestingContinuousRunService(\n\t\t\ttestService,\n\t\t\tds.add(new TestStorageService()),\n\t\t\tds.add(new MockContextKeyService()),\n\t\t\tnew MockProfilesService(),\n\t\t));\n\t});\n\n\ttest('isSpecificallyEnabledFor', () => {\n\t\tassert.strictEqual(cr.isEnabled(), false);\n\t\tassert.strictEqual(cr.isSpecificallyEnabledFor('testId'), false);\n\n\t\tcr.start([profile1], 'testId\\0child');\n\t\tassert.strictEqual(cr.isSpecificallyEnabledFor('testId'), false);\n\t\tassert.strictEqual(cr.isSpecificallyEnabledFor('testId\\0child'), true);\n\n\t\tassert.deepStrictEqual(testService.log, [\n\t\t\t['start', 1, ['testId\\0child']],\n\t\t]);\n\t});\n\n\ttest('isEnabledForAParentOf', () => {\n\t\tassert.strictEqual(cr.isEnabled(), false);\n\t\tassert.strictEqual(cr.isEnabledForAParentOf('testId'), false);\n\t\tcr.start([profile1], 'parentTestId\\0testId');\n\t\tassert.strictEqual(cr.isEnabledForAParentOf('parentTestId'), false);\n\t\tassert.strictEqual(cr.isEnabledForAParentOf('parentTestId\\0testId'), true);\n\t\tassert.strictEqual(cr.isEnabledForAParentOf('parentTestId\\0testId\\0nestd'), true);\n\t\tassert.strictEqual(cr.isEnabled(), true);\n\n\t\tassert.deepStrictEqual(testService.log, [\n\t\t\t['start', 1, ['parentTestId\\0testId']],\n\t\t]);\n\t});\n\n\ttest('isEnabledForAChildOf', () => {\n\t\tassert.strictEqual(cr.isEnabled(), false);\n\t\tassert.strictEqual(cr.isEnabledForAChildOf('testId'), false);\n\t\tcr.start([profile1], 'testId\\0childTestId');\n\t\tassert.strictEqual(cr.isEnabledForAChildOf('testId'), true);\n\t\tassert.strictEqual(cr.isEnabledForAChildOf('testId\\0childTestId'), true);\n\t\tassert.strictEqual(cr.isEnabledForAChildOf('testId\\0childTestId\\0neested'), false);\n\t\tassert.strictEqual(cr.isEnabled(), true);\n\t});\n\n\tsuite('lifecycle', () => {\n\t\ttest('stops general in DFS order', () => {\n\t\t\tcr.start([profile1], 'a\\0b\\0c\\0d');\n\t\t\tcr.start([profile1], 'a\\0b');\n\t\t\tcr.start([profile1], 'a\\0b\\0c');\n\t\t\tcr.stop();\n\t\t\tassert.deepStrictEqual(testService.log, [\n\t\t\t\t['start', 1, ['a\\0b\\0c\\0d']],\n\t\t\t\t['start', 1, ['a\\0b']],\n\t\t\t\t['start', 1, ['a\\0b\\0c']],\n\t\t\t\t['stop', 1, ['a\\0b\\0c\\0d']],\n\t\t\t\t['stop', 1, ['a\\0b\\0c']],\n\t\t\t\t['stop', 1, ['a\\0b']],\n\t\t\t]);\n\t\t\tassert.strictEqual(cr.isEnabled(), false);\n\t\t});\n\n\t\ttest('stops profiles in DFS order', () => {\n\t\t\tcr.start([profile1], 'a\\0b\\0c\\0d');\n\t\t\tcr.start([profile1], 'a\\0b');\n\t\t\tcr.start([profile1], 'a\\0b\\0c');\n\t\t\tcr.stopProfile(profile1);\n\t\t\tassert.deepStrictEqual(testService.log, [\n\t\t\t\t['start', 1, ['a\\0b\\0c\\0d']],\n\t\t\t\t['start', 1, ['a\\0b']],\n\t\t\t\t['start', 1, ['a\\0b\\0c']],\n\t\t\t\t['stop', 1, ['a\\0b\\0c\\0d']],\n\t\t\t\t['stop', 1, ['a\\0b\\0c']],\n\t\t\t\t['stop', 1, ['a\\0b']],\n\t\t\t]);\n\t\t\tassert.strictEqual(cr.isEnabled(), false);\n\t\t});\n\n\t\ttest('updates profile for a test if profile is changed', () => {\n\t\t\tcr.start([profile1], 'parent\\0testId');\n\t\t\tcr.start([profile2], 'parent\\0testId');\n\t\t\tassert.strictEqual(cr.isEnabled(), true);\n\t\t\tcr.stop();\n\t\t\tassert.strictEqual(cr.isEnabled(), false);\n\t\t\tassert.deepStrictEqual(testService.log, [\n\t\t\t\t['start', 1, ['parent\\0testId']],\n\t\t\t\t['start', 2, ['parent\\0testId']],\n\t\t\t\t['stop', 1, ['parent\\0testId']],\n\t\t\t\t['stop', 2, ['parent\\0testId']],\n\t\t\t]);\n\t\t\tassert.strictEqual(cr.isEnabled(), false);\n\t\t});\n\n\t\ttest('stops a single profile test', () => {\n\t\t\tcr.start([profile1, profile2], 'parent\\0testId');\n\t\t\tcr.stopProfile(profile1);\n\t\t\tassert.deepStrictEqual(testService.log, [\n\t\t\t\t['start', 1, ['parent\\0testId']],\n\t\t\t\t['start', 2, ['parent\\0testId']],\n\t\t\t\t['stop', 1, ['parent\\0testId']],\n\t\t\t]);\n\t\t\tassert.strictEqual(cr.isEnabled(), true);\n\n\t\t\tcr.stopProfile(profile2);\n\t\t\tassert.deepStrictEqual(testService.log, [\n\t\t\t\t['start', 1, ['parent\\0testId']],\n\t\t\t\t['start', 2, ['parent\\0testId']],\n\t\t\t\t['stop', 1, ['parent\\0testId']],\n\t\t\t\t['stop', 2, ['parent\\0testId']],\n\t\t\t]);\n\t\t\tassert.strictEqual(cr.isEnabled(), false);\n\t\t});\n\t});\n});\n"]}