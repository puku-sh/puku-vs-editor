{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/contrib/testing/test/common/testCoverage.test.ts","vs/workbench/contrib/testing/test/common/testCoverage.test.ts"],"names":[],"mappings":"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","file":"testCoverage.test.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport assert from 'assert';\nimport { SinonSandbox, createSandbox } from 'sinon';\nimport { URI } from '../../../../../base/common/uri.js';\nimport { ensureNoDisposablesAreLeakedInTestSuite } from '../../../../../base/test/common/utils.js';\nimport { onObservableChange } from '../../common/observableUtils.js';\nimport { ICoverageAccessor, TestCoverage } from '../../common/testCoverage.js';\nimport { LiveTestResult } from '../../common/testResult.js';\nimport { IFileCoverage } from '../../common/testTypes.js';\nimport { IUriIdentityService } from '../../../../../platform/uriIdentity/common/uriIdentity.js';\nimport { upcastDeepPartial, upcastPartial } from '../../../../../base/test/common/mock.js';\n\nsuite('TestCoverage', () => {\n\tlet sandbox: SinonSandbox;\n\tlet coverageAccessor: ICoverageAccessor;\n\tlet testCoverage: TestCoverage;\n\n\tconst ds = ensureNoDisposablesAreLeakedInTestSuite();\n\n\tsetup(() => {\n\t\tsandbox = createSandbox();\n\t\tcoverageAccessor = {\n\t\t\tgetCoverageDetails: sandbox.stub().resolves([]),\n\t\t};\n\t\ttestCoverage = new TestCoverage({} as LiveTestResult, 'taskId', upcastDeepPartial<IUriIdentityService>({ extUri: upcastPartial({ ignorePathCasing: () => true }) }), coverageAccessor);\n\t});\n\n\tteardown(() => {\n\t\tsandbox.restore();\n\t});\n\n\tfunction addTests() {\n\t\tconst raw1: IFileCoverage = {\n\t\t\tid: '1',\n\t\t\turi: URI.file('/path/to/file'),\n\t\t\tstatement: { covered: 10, total: 20 },\n\t\t\tbranch: { covered: 5, total: 10 },\n\t\t\tdeclaration: { covered: 2, total: 5 },\n\t\t};\n\n\t\ttestCoverage.append(raw1, undefined);\n\n\t\tconst raw2: IFileCoverage = {\n\t\t\tid: '1',\n\t\t\turi: URI.file('/path/to/file2'),\n\t\t\tstatement: { covered: 5, total: 10 },\n\t\t\tbranch: { covered: 1, total: 5 },\n\t\t};\n\n\t\ttestCoverage.append(raw2, undefined);\n\n\t\treturn { raw1, raw2 };\n\t}\n\n\ttest('should look up file coverage', async () => {\n\t\tconst { raw1 } = addTests();\n\n\t\tconst fileCoverage = testCoverage.getUri(raw1.uri);\n\t\tassert.equal(fileCoverage?.id, raw1.id);\n\t\tassert.deepEqual(fileCoverage?.statement, raw1.statement);\n\t\tassert.deepEqual(fileCoverage?.branch, raw1.branch);\n\t\tassert.deepEqual(fileCoverage?.declaration, raw1.declaration);\n\n\t\tassert.strictEqual(testCoverage.getComputedForUri(raw1.uri), testCoverage.getUri(raw1.uri));\n\t\tassert.strictEqual(testCoverage.getComputedForUri(URI.file('/path/to/x')), undefined);\n\t\tassert.strictEqual(testCoverage.getUri(URI.file('/path/to/x')), undefined);\n\t});\n\n\ttest('should compute coverage for directories', async () => {\n\t\tconst { raw1 } = addTests();\n\t\tconst dirCoverage = testCoverage.getComputedForUri(URI.file('/path/to'));\n\t\tassert.deepEqual(dirCoverage?.statement, { covered: 15, total: 30 });\n\t\tassert.deepEqual(dirCoverage?.branch, { covered: 6, total: 15 });\n\t\tassert.deepEqual(dirCoverage?.declaration, raw1.declaration);\n\t});\n\n\ttest('should incrementally diff updates to existing files', async () => {\n\t\taddTests();\n\n\t\tconst raw3: IFileCoverage = {\n\t\t\tid: '1',\n\t\t\turi: URI.file('/path/to/file'),\n\t\t\tstatement: { covered: 12, total: 24 },\n\t\t\tbranch: { covered: 7, total: 10 },\n\t\t\tdeclaration: { covered: 2, total: 5 },\n\t\t};\n\n\t\ttestCoverage.append(raw3, undefined);\n\n\t\tconst fileCoverage = testCoverage.getUri(raw3.uri);\n\t\tassert.deepEqual(fileCoverage?.statement, raw3.statement);\n\t\tassert.deepEqual(fileCoverage?.branch, raw3.branch);\n\t\tassert.deepEqual(fileCoverage?.declaration, raw3.declaration);\n\n\t\tconst dirCoverage = testCoverage.getComputedForUri(URI.file('/path/to'));\n\t\tassert.deepEqual(dirCoverage?.statement, { covered: 17, total: 34 });\n\t\tassert.deepEqual(dirCoverage?.branch, { covered: 8, total: 15 });\n\t\tassert.deepEqual(dirCoverage?.declaration, raw3.declaration);\n\t});\n\n\ttest('should emit changes', async () => {\n\t\tconst changes: string[][] = [];\n\t\tds.add(onObservableChange(testCoverage.didAddCoverage, value =>\n\t\t\tchanges.push(value.map(v => v.value!.uri.toString()))));\n\n\t\taddTests();\n\n\t\tassert.deepStrictEqual(changes, [\n\t\t\t[\n\t\t\t\t'file:///',\n\t\t\t\t'file:///',\n\t\t\t\t'file:///',\n\t\t\t\t'file:///path',\n\t\t\t\t'file:///path/to',\n\t\t\t\t'file:///path/to/file',\n\t\t\t],\n\t\t\t[\n\t\t\t\t'file:///',\n\t\t\t\t'file:///',\n\t\t\t\t'file:///',\n\t\t\t\t'file:///path',\n\t\t\t\t'file:///path/to',\n\t\t\t\t'file:///path/to/file2',\n\t\t\t],\n\t\t]);\n\t});\n});\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport assert from 'assert';\nimport { SinonSandbox, createSandbox } from 'sinon';\nimport { URI } from '../../../../../base/common/uri.js';\nimport { ensureNoDisposablesAreLeakedInTestSuite } from '../../../../../base/test/common/utils.js';\nimport { onObservableChange } from '../../common/observableUtils.js';\nimport { ICoverageAccessor, TestCoverage } from '../../common/testCoverage.js';\nimport { LiveTestResult } from '../../common/testResult.js';\nimport { IFileCoverage } from '../../common/testTypes.js';\nimport { IUriIdentityService } from '../../../../../platform/uriIdentity/common/uriIdentity.js';\nimport { upcastDeepPartial, upcastPartial } from '../../../../../base/test/common/mock.js';\n\nsuite('TestCoverage', () => {\n\tlet sandbox: SinonSandbox;\n\tlet coverageAccessor: ICoverageAccessor;\n\tlet testCoverage: TestCoverage;\n\n\tconst ds = ensureNoDisposablesAreLeakedInTestSuite();\n\n\tsetup(() => {\n\t\tsandbox = createSandbox();\n\t\tcoverageAccessor = {\n\t\t\tgetCoverageDetails: sandbox.stub().resolves([]),\n\t\t};\n\t\ttestCoverage = new TestCoverage({} as LiveTestResult, 'taskId', upcastDeepPartial<IUriIdentityService>({ extUri: upcastPartial({ ignorePathCasing: () => true }) }), coverageAccessor);\n\t});\n\n\tteardown(() => {\n\t\tsandbox.restore();\n\t});\n\n\tfunction addTests() {\n\t\tconst raw1: IFileCoverage = {\n\t\t\tid: '1',\n\t\t\turi: URI.file('/path/to/file'),\n\t\t\tstatement: { covered: 10, total: 20 },\n\t\t\tbranch: { covered: 5, total: 10 },\n\t\t\tdeclaration: { covered: 2, total: 5 },\n\t\t};\n\n\t\ttestCoverage.append(raw1, undefined);\n\n\t\tconst raw2: IFileCoverage = {\n\t\t\tid: '1',\n\t\t\turi: URI.file('/path/to/file2'),\n\t\t\tstatement: { covered: 5, total: 10 },\n\t\t\tbranch: { covered: 1, total: 5 },\n\t\t};\n\n\t\ttestCoverage.append(raw2, undefined);\n\n\t\treturn { raw1, raw2 };\n\t}\n\n\ttest('should look up file coverage', async () => {\n\t\tconst { raw1 } = addTests();\n\n\t\tconst fileCoverage = testCoverage.getUri(raw1.uri);\n\t\tassert.equal(fileCoverage?.id, raw1.id);\n\t\tassert.deepEqual(fileCoverage?.statement, raw1.statement);\n\t\tassert.deepEqual(fileCoverage?.branch, raw1.branch);\n\t\tassert.deepEqual(fileCoverage?.declaration, raw1.declaration);\n\n\t\tassert.strictEqual(testCoverage.getComputedForUri(raw1.uri), testCoverage.getUri(raw1.uri));\n\t\tassert.strictEqual(testCoverage.getComputedForUri(URI.file('/path/to/x')), undefined);\n\t\tassert.strictEqual(testCoverage.getUri(URI.file('/path/to/x')), undefined);\n\t});\n\n\ttest('should compute coverage for directories', async () => {\n\t\tconst { raw1 } = addTests();\n\t\tconst dirCoverage = testCoverage.getComputedForUri(URI.file('/path/to'));\n\t\tassert.deepEqual(dirCoverage?.statement, { covered: 15, total: 30 });\n\t\tassert.deepEqual(dirCoverage?.branch, { covered: 6, total: 15 });\n\t\tassert.deepEqual(dirCoverage?.declaration, raw1.declaration);\n\t});\n\n\ttest('should incrementally diff updates to existing files', async () => {\n\t\taddTests();\n\n\t\tconst raw3: IFileCoverage = {\n\t\t\tid: '1',\n\t\t\turi: URI.file('/path/to/file'),\n\t\t\tstatement: { covered: 12, total: 24 },\n\t\t\tbranch: { covered: 7, total: 10 },\n\t\t\tdeclaration: { covered: 2, total: 5 },\n\t\t};\n\n\t\ttestCoverage.append(raw3, undefined);\n\n\t\tconst fileCoverage = testCoverage.getUri(raw3.uri);\n\t\tassert.deepEqual(fileCoverage?.statement, raw3.statement);\n\t\tassert.deepEqual(fileCoverage?.branch, raw3.branch);\n\t\tassert.deepEqual(fileCoverage?.declaration, raw3.declaration);\n\n\t\tconst dirCoverage = testCoverage.getComputedForUri(URI.file('/path/to'));\n\t\tassert.deepEqual(dirCoverage?.statement, { covered: 17, total: 34 });\n\t\tassert.deepEqual(dirCoverage?.branch, { covered: 8, total: 15 });\n\t\tassert.deepEqual(dirCoverage?.declaration, raw3.declaration);\n\t});\n\n\ttest('should emit changes', async () => {\n\t\tconst changes: string[][] = [];\n\t\tds.add(onObservableChange(testCoverage.didAddCoverage, value =>\n\t\t\tchanges.push(value.map(v => v.value!.uri.toString()))));\n\n\t\taddTests();\n\n\t\tassert.deepStrictEqual(changes, [\n\t\t\t[\n\t\t\t\t'file:///',\n\t\t\t\t'file:///',\n\t\t\t\t'file:///',\n\t\t\t\t'file:///path',\n\t\t\t\t'file:///path/to',\n\t\t\t\t'file:///path/to/file',\n\t\t\t],\n\t\t\t[\n\t\t\t\t'file:///',\n\t\t\t\t'file:///',\n\t\t\t\t'file:///',\n\t\t\t\t'file:///path',\n\t\t\t\t'file:///path/to',\n\t\t\t\t'file:///path/to/file2',\n\t\t\t],\n\t\t]);\n\t});\n});\n"]}