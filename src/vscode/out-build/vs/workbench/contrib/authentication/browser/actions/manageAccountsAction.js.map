{"version":3,"sources":["vs/workbench/contrib/authentication/browser/actions/manageAccountsAction.ts"],"names":[],"mappings":"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","file":"manageAccountsAction.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Lazy } from '../../../../../base/common/lazy.js';\nimport { DisposableStore } from '../../../../../base/common/lifecycle.js';\nimport { localize, localize2 } from '../../../../../nls.js';\nimport { Action2 } from '../../../../../platform/actions/common/actions.js';\nimport { ICommandService } from '../../../../../platform/commands/common/commands.js';\nimport { IInstantiationService, ServicesAccessor } from '../../../../../platform/instantiation/common/instantiation.js';\nimport { IProductService } from '../../../../../platform/product/common/productService.js';\nimport { IQuickInputService, IQuickPickItem } from '../../../../../platform/quickinput/common/quickInput.js';\nimport { ISecretStorageService } from '../../../../../platform/secrets/common/secrets.js';\nimport { AuthenticationSessionInfo, getCurrentAuthenticationSessionInfo } from '../../../../services/authentication/browser/authenticationService.js';\nimport { IAuthenticationProvider, IAuthenticationService } from '../../../../services/authentication/common/authentication.js';\n\nexport class ManageAccountsAction extends Action2 {\n\tconstructor() {\n\t\tsuper({\n\t\t\tid: 'workbench.action.manageAccounts',\n\t\t\ttitle: localize2('manageAccounts', \"Manage Accounts\"),\n\t\t\tcategory: localize2('accounts', \"Accounts\"),\n\t\t\tf1: true\n\t\t});\n\t}\n\n\tpublic override run(accessor: ServicesAccessor): Promise<void> {\n\t\tconst instantiationService = accessor.get(IInstantiationService);\n\t\treturn instantiationService.createInstance(ManageAccountsActionImpl).run();\n\t}\n}\n\ninterface AccountQuickPickItem extends IQuickPickItem {\n\tproviderId: string;\n\tcanUseMcp: boolean;\n\tcanSignOut: () => Promise<boolean>;\n}\n\ninterface AccountActionQuickPickItem extends IQuickPickItem {\n\taction: () => void;\n}\n\nclass ManageAccountsActionImpl {\n\tconstructor(\n\t\t@IQuickInputService private readonly quickInputService: IQuickInputService,\n\t\t@IAuthenticationService private readonly authenticationService: IAuthenticationService,\n\t\t@ICommandService private readonly commandService: ICommandService,\n\t\t@ISecretStorageService private readonly secretStorageService: ISecretStorageService,\n\t\t@IProductService private readonly productService: IProductService,\n\t) { }\n\n\tpublic async run() {\n\t\tconst placeHolder = localize('pickAccount', \"Select an account to manage\");\n\n\t\tconst accounts = await this.listAccounts();\n\t\tif (!accounts.length) {\n\t\t\tawait this.quickInputService.pick([{ label: localize('noActiveAccounts', \"There are no active accounts.\") }], { placeHolder });\n\t\t\treturn;\n\t\t}\n\n\t\tconst account = await this.quickInputService.pick(accounts, { placeHolder, matchOnDescription: true });\n\t\tif (!account) {\n\t\t\treturn;\n\t\t}\n\n\t\tawait this.showAccountActions(account);\n\t}\n\n\tprivate async listAccounts(): Promise<AccountQuickPickItem[]> {\n\t\tconst activeSession = new Lazy(() => getCurrentAuthenticationSessionInfo(this.secretStorageService, this.productService));\n\t\tconst accounts: AccountQuickPickItem[] = [];\n\t\tfor (const providerId of this.authenticationService.getProviderIds()) {\n\t\t\tconst provider = this.authenticationService.getProvider(providerId);\n\t\t\tfor (const { label, id } of await this.authenticationService.getAccounts(providerId)) {\n\t\t\t\taccounts.push({\n\t\t\t\t\tlabel,\n\t\t\t\t\tdescription: provider.label,\n\t\t\t\t\tproviderId,\n\t\t\t\t\tcanUseMcp: !!provider.authorizationServers?.length,\n\t\t\t\t\tcanSignOut: async () => this.canSignOut(provider, id, await activeSession.value)\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t\treturn accounts;\n\t}\n\n\tprivate async canSignOut(provider: IAuthenticationProvider, accountId: string, session?: AuthenticationSessionInfo): Promise<boolean> {\n\t\tif (session && !session.canSignOut && session.providerId === provider.id) {\n\t\t\tconst sessions = await this.authenticationService.getSessions(provider.id);\n\t\t\treturn !sessions.some(o => o.id === session.id && o.account.id === accountId);\n\t\t}\n\t\treturn true;\n\t}\n\n\tprivate async showAccountActions(account: AccountQuickPickItem): Promise<void> {\n\t\tconst { providerId, label: accountLabel, canUseMcp, canSignOut } = account;\n\n\t\tconst store = new DisposableStore();\n\t\tconst quickPick = store.add(this.quickInputService.createQuickPick<AccountActionQuickPickItem>());\n\n\t\tquickPick.title = localize('manageAccount', \"Manage '{0}'\", accountLabel);\n\t\tquickPick.placeholder = localize('selectAction', \"Select an action\");\n\t\tquickPick.buttons = [this.quickInputService.backButton];\n\n\t\tconst items: AccountActionQuickPickItem[] = [{\n\t\t\tlabel: localize('manageTrustedExtensions', \"Manage Trusted Extensions\"),\n\t\t\taction: () => this.commandService.executeCommand('_manageTrustedExtensionsForAccount', { providerId, accountLabel })\n\t\t}];\n\n\t\tif (canUseMcp) {\n\t\t\titems.push({\n\t\t\t\tlabel: localize('manageTrustedMCPServers', \"Manage Trusted MCP Servers\"),\n\t\t\t\taction: () => this.commandService.executeCommand('_manageTrustedMCPServersForAccount', { providerId, accountLabel })\n\t\t\t});\n\t\t}\n\n\t\tif (await canSignOut()) {\n\t\t\titems.push({\n\t\t\t\tlabel: localize('signOut', \"Sign Out\"),\n\t\t\t\taction: () => this.commandService.executeCommand('_signOutOfAccount', { providerId, accountLabel })\n\t\t\t});\n\t\t}\n\n\t\tquickPick.items = items;\n\n\t\tstore.add(quickPick.onDidAccept(() => {\n\t\t\tconst selected = quickPick.selectedItems[0];\n\t\t\tif (selected) {\n\t\t\t\tquickPick.hide();\n\t\t\t\tselected.action();\n\t\t\t}\n\t\t}));\n\n\t\tstore.add(quickPick.onDidTriggerButton((button) => {\n\t\t\tif (button === this.quickInputService.backButton) {\n\t\t\t\tvoid this.run();\n\t\t\t}\n\t\t}));\n\n\t\tstore.add(quickPick.onDidHide(() => store.dispose()));\n\n\t\tquickPick.show();\n\t}\n}\n"]}