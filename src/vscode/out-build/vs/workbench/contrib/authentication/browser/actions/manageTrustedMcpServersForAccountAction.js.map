{"version":3,"sources":["vs/workbench/contrib/authentication/browser/actions/manageTrustedMcpServersForAccountAction.ts"],"names":[],"mappings":"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","file":"manageTrustedMcpServersForAccountAction.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Codicon } from '../../../../../base/common/codicons.js';\nimport { fromNow } from '../../../../../base/common/date.js';\nimport { DisposableStore } from '../../../../../base/common/lifecycle.js';\nimport { ThemeIcon } from '../../../../../base/common/themables.js';\nimport { localize, localize2 } from '../../../../../nls.js';\nimport { Action2 } from '../../../../../platform/actions/common/actions.js';\nimport { ICommandService } from '../../../../../platform/commands/common/commands.js';\nimport { IDialogService } from '../../../../../platform/dialogs/common/dialogs.js';\nimport { IInstantiationService, ServicesAccessor } from '../../../../../platform/instantiation/common/instantiation.js';\nimport { IQuickInputService, IQuickPickItem, IQuickPickSeparator } from '../../../../../platform/quickinput/common/quickInput.js';\nimport { AllowedMcpServer } from '../../../../services/authentication/browser/authenticationMcpAccessService.js';\nimport { IAuthenticationService } from '../../../../services/authentication/common/authentication.js';\nimport { IAuthenticationQueryService, IAccountQuery } from '../../../../services/authentication/common/authenticationQuery.js';\nimport { ChatContextKeys } from '../../../chat/common/chatContextKeys.js';\nimport { IMcpService } from '../../../mcp/common/mcpTypes.js';\n\nexport class ManageTrustedMcpServersForAccountAction extends Action2 {\n\tconstructor() {\n\t\tsuper({\n\t\t\tid: '_manageTrustedMCPServersForAccount',\n\t\t\ttitle: localize2('manageTrustedMcpServersForAccount', \"Manage Trusted MCP Servers For Account\"),\n\t\t\tcategory: localize2('accounts', \"Accounts\"),\n\t\t\tf1: true,\n\t\t\tprecondition: ChatContextKeys.Setup.hidden.negate()\n\t\t});\n\t}\n\n\toverride run(accessor: ServicesAccessor, options?: { providerId: string; accountLabel: string }): Promise<void> {\n\t\tconst instantiationService = accessor.get(IInstantiationService);\n\t\treturn instantiationService.createInstance(ManageTrustedMcpServersForAccountActionImpl).run(options);\n\t}\n}\n\ninterface TrustedMcpServersQuickPickItem extends IQuickPickItem {\n\tmcpServer: AllowedMcpServer;\n\tlastUsed?: number;\n}\n\nclass ManageTrustedMcpServersForAccountActionImpl {\n\tconstructor(\n\t\t@IMcpService private readonly _mcpServerService: IMcpService,\n\t\t@IDialogService private readonly _dialogService: IDialogService,\n\t\t@IQuickInputService private readonly _quickInputService: IQuickInputService,\n\t\t@IAuthenticationService private readonly _mcpServerAuthenticationService: IAuthenticationService,\n\t\t@IAuthenticationQueryService private readonly _authenticationQueryService: IAuthenticationQueryService,\n\t\t@ICommandService private readonly _commandService: ICommandService\n\t) { }\n\n\tasync run(options?: { providerId: string; accountLabel: string }) {\n\t\tconst accountQuery = await this._resolveAccountQuery(options?.providerId, options?.accountLabel);\n\t\tif (!accountQuery) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst items = await this._getItems(accountQuery);\n\t\tif (!items.length) {\n\t\t\treturn;\n\t\t}\n\t\tconst picker = this._createQuickPick(accountQuery);\n\t\tpicker.items = items;\n\t\tpicker.selectedItems = items.filter((i): i is TrustedMcpServersQuickPickItem => i.type !== 'separator' && !!i.picked);\n\t\tpicker.show();\n\t}\n\n\t//#region Account Query Resolution\n\n\tprivate async _resolveAccountQuery(providerId: string | undefined, accountLabel: string | undefined): Promise<IAccountQuery | undefined> {\n\t\tif (providerId && accountLabel) {\n\t\t\treturn this._authenticationQueryService.provider(providerId).account(accountLabel);\n\t\t}\n\n\t\tconst accounts = await this._getAllAvailableAccounts();\n\t\tconst pick = await this._quickInputService.pick(accounts, {\n\t\t\tplaceHolder: localize('pickAccount', \"Pick an account to manage trusted MCP servers for\"),\n\t\t\tmatchOnDescription: true,\n\t\t});\n\n\t\treturn pick ? this._authenticationQueryService.provider(pick.providerId).account(pick.label) : undefined;\n\t}\n\n\tprivate async _getAllAvailableAccounts() {\n\t\tconst accounts = [];\n\t\tfor (const providerId of this._mcpServerAuthenticationService.getProviderIds()) {\n\t\t\tconst provider = this._mcpServerAuthenticationService.getProvider(providerId);\n\t\t\tconst sessions = await this._mcpServerAuthenticationService.getSessions(providerId);\n\t\t\tconst uniqueLabels = new Set<string>();\n\n\t\t\tfor (const session of sessions) {\n\t\t\t\tif (!uniqueLabels.has(session.account.label)) {\n\t\t\t\t\tuniqueLabels.add(session.account.label);\n\t\t\t\t\taccounts.push({\n\t\t\t\t\t\tproviderId,\n\t\t\t\t\t\tlabel: session.account.label,\n\t\t\t\t\t\tdescription: provider.label\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn accounts;\n\t}\n\n\t//#endregion\n\n\t//#region Item Retrieval and Quick Pick Creation\n\n\tprivate async _getItems(accountQuery: IAccountQuery) {\n\t\tconst allowedMcpServers = accountQuery.mcpServers().getAllowedMcpServers();\n\t\tconst serverIdToLabel = new Map<string, string>(this._mcpServerService.servers.get().map(s => [s.definition.id, s.definition.label]));\n\t\tconst filteredMcpServers = allowedMcpServers\n\t\t\t// Filter out MCP servers that are not in the current list of servers\n\t\t\t.filter(server => serverIdToLabel.has(server.id))\n\t\t\t.map(server => {\n\t\t\t\tconst usage = accountQuery.mcpServer(server.id).getUsage();\n\t\t\t\treturn {\n\t\t\t\t\t...server,\n\t\t\t\t\t// Use the server name from the MCP service\n\t\t\t\t\tname: serverIdToLabel.get(server.id)!,\n\t\t\t\t\tlastUsed: usage.length > 0 ? Math.max(...usage.map(u => u.lastUsed)) : server.lastUsed\n\t\t\t\t};\n\t\t\t});\n\n\t\tif (!filteredMcpServers.length) {\n\t\t\tthis._dialogService.info(localize('noTrustedMcpServers', \"This account has not been used by any MCP servers.\"));\n\t\t\treturn [];\n\t\t}\n\n\t\tconst trustedServers = filteredMcpServers.filter(s => s.trusted);\n\t\tconst otherServers = filteredMcpServers.filter(s => !s.trusted);\n\t\tconst sortByLastUsed = (a: AllowedMcpServer, b: AllowedMcpServer) => (b.lastUsed || 0) - (a.lastUsed || 0);\n\n\t\treturn [\n\t\t\t...otherServers.sort(sortByLastUsed).map(this._toQuickPickItem),\n\t\t\t{ type: 'separator', label: localize('trustedMcpServers', \"Trusted by Microsoft\") } satisfies IQuickPickSeparator,\n\t\t\t...trustedServers.sort(sortByLastUsed).map(this._toQuickPickItem)\n\t\t];\n\t}\n\n\tprivate _toQuickPickItem(mcpServer: AllowedMcpServer): TrustedMcpServersQuickPickItem {\n\t\tconst lastUsed = mcpServer.lastUsed;\n\t\tconst description = lastUsed\n\t\t\t? localize({ key: 'accountLastUsedDate', comment: ['The placeholder {0} is a string with time information, such as \"3 days ago\"'] }, \"Last used this account {0}\", fromNow(lastUsed, true))\n\t\t\t: localize('notUsed', \"Has not used this account\");\n\t\tlet tooltip: string | undefined;\n\t\tlet disabled: boolean | undefined;\n\t\tif (mcpServer.trusted) {\n\t\t\ttooltip = localize('trustedMcpServerTooltip', \"This MCP server is trusted by Microsoft and\\nalways has access to this account\");\n\t\t\tdisabled = true;\n\t\t}\n\t\treturn {\n\t\t\tlabel: mcpServer.name,\n\t\t\tmcpServer,\n\t\t\tdescription,\n\t\t\ttooltip,\n\t\t\tdisabled,\n\t\t\tbuttons: [{\n\t\t\t\ttooltip: localize('accountPreferences', \"Manage account preferences for this MCP server\"),\n\t\t\t\ticonClass: ThemeIcon.asClassName(Codicon.settingsGear),\n\t\t\t}],\n\t\t\tpicked: mcpServer.allowed === undefined || mcpServer.allowed\n\t\t};\n\t}\n\n\tprivate _createQuickPick(accountQuery: IAccountQuery) {\n\t\tconst disposableStore = new DisposableStore();\n\t\tconst quickPick = disposableStore.add(this._quickInputService.createQuickPick<TrustedMcpServersQuickPickItem>({ useSeparators: true }));\n\n\t\t// Configure quick pick\n\t\tquickPick.canSelectMany = true;\n\t\tquickPick.customButton = true;\n\t\tquickPick.customLabel = localize('manageTrustedMcpServers.cancel', 'Cancel');\n\t\tquickPick.title = localize('manageTrustedMcpServers', \"Manage Trusted MCP Servers\");\n\t\tquickPick.placeholder = localize('manageMcpServers', \"Choose which MCP servers can access this account\");\n\n\t\t// Set up event handlers\n\t\tdisposableStore.add(quickPick.onDidAccept(() => {\n\t\t\tquickPick.hide();\n\t\t\tconst allServers = quickPick.items\n\t\t\t\t.filter((item: any): item is TrustedMcpServersQuickPickItem => item.type !== 'separator')\n\t\t\t\t.map((i: any) => i.mcpServer);\n\n\t\t\tconst selectedServers = new Set(quickPick.selectedItems.map((i: any) => i.mcpServer));\n\n\t\t\tfor (const mcpServer of allServers) {\n\t\t\t\tconst isAllowed = selectedServers.has(mcpServer);\n\t\t\t\taccountQuery.mcpServer(mcpServer.id).setAccessAllowed(isAllowed, mcpServer.name);\n\t\t\t}\n\t\t}));\n\t\tdisposableStore.add(quickPick.onDidHide(() => disposableStore.dispose()));\n\t\tdisposableStore.add(quickPick.onDidCustom(() => quickPick.hide()));\n\t\tdisposableStore.add(quickPick.onDidTriggerItemButton((e: any) =>\n\t\t\tthis._commandService.executeCommand('_manageAccountPreferencesForMcpServer', e.item.mcpServer.id, accountQuery.providerId)\n\t\t));\n\n\t\treturn quickPick;\n\t}\n\n\t//#endregion\n}\n"]}