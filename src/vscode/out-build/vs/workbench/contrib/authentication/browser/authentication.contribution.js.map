{"version":3,"sources":["vs/workbench/contrib/authentication/browser/authentication.contribution.ts"],"names":[],"mappings":"AAAA;;;gGAGgG;;;;;;;;;;AAEhG,OAAO,EAAE,UAAU,EAAE,MAAM,sCAAsC,CAAC;AAClE,OAAO,EAAE,QAAQ,EAAE,MAAM,oBAAoB,CAAC;AAC9C,OAAO,EAAE,eAAe,EAAE,MAAM,gDAAgD,CAAC;AACjF,OAAO,EAAE,gBAAgB,EAAE,MAAM,kDAAkD,CAAC;AAEpF,OAAO,EAAE,cAAc,EAAE,MAAM,0DAA0D,CAAC;AAC1F,OAAO,EAAE,QAAQ,EAAE,MAAM,kDAAkD,CAAC;AAC5E,OAAO,EAA0C,8BAA8B,EAAE,MAAM,kCAAkC,CAAC;AAC1H,OAAO,EAAE,sBAAsB,EAAE,MAAM,qCAAqC,CAAC;AAC7E,OAAO,EAAE,mCAAmC,EAAE,MAAM,6DAA6D,CAAC;AAClH,OAAO,EAAE,UAAU,EAAmG,MAAM,mEAAmE,CAAC;AAChM,OAAO,EAAE,uCAAuC,EAAE,MAAM,sDAAsD,CAAC;AAC/G,OAAO,EAAE,0CAA0C,EAAE,MAAM,yDAAyD,CAAC;AACrH,OAAO,EAAE,2BAA2B,EAAE,MAAM,wEAAwE,CAAC;AACrH,OAAO,EAAE,0CAA0C,EAAE,MAAM,yDAAyD,CAAC;AACrH,OAAO,EAAE,uCAAuC,EAAE,MAAM,sDAAsD,CAAC;AAC/G,OAAO,EAAE,0CAA0C,EAAE,MAAM,yDAAyD,CAAC;AACrH,OAAO,EAAE,oBAAoB,EAAE,MAAM,mCAAmC,CAAC;AAEzE,MAAM,wBAAwB,GAAG,gBAAgB,CAAC,eAAe,CAAC,yCAAyC,EAAE,UAAU,QAAQ,EAAE,CAAC;IACjI,MAAM,kBAAkB,GAAG,QAAQ,CAAC,GAAG,CAAC,mCAAmC,CAAC,CAAC;IAC7E,OAAO,kBAAkB,CAAC,OAAO,EAAE,0BAA0B,CAAC;AAC/D,CAAC,CAAC,CAAC;AAEH,MAAM,0BAA2B,SAAQ,UAAU;IAAnD;;QAEU,SAAI,GAAG,OAAO,CAAC;IAoCzB,CAAC;IAlCA,YAAY,CAAC,QAA4B;QACxC,OAAO,CAAC,CAAC,QAAQ,CAAC,WAAW,EAAE,cAAc,CAAC;IAC/C,CAAC;IAED,MAAM,CAAC,QAA4B;QAClC,MAAM,cAAc,GAAG,QAAQ,CAAC,WAAW,EAAE,cAAc,IAAI,EAAE,CAAC;QAClE,IAAI,CAAC,cAAc,CAAC,MAAM,EAAE,CAAC;YAC5B,OAAO,EAAE,IAAI,EAAE,EAAE,OAAO,EAAE,EAAE,EAAE,IAAI,EAAE,EAAE,EAAE,EAAE,OAAO,EAAE,GAAG,EAAE,GAAG,CAAC,EAAE,CAAC;QAChE,CAAC;QAED,MAAM,OAAO,GAAG;YACf,QAAQ,CAAC,IAAqB,EAAE,IAAO,CAAC;YACxC,QAAQ,CAAC,IAAkB,EAAE,IAAI,CAAC;YAClC,QAAQ,CAAC,IAAuC,EAAE,IAA2B,CAAC;SAC9E,CAAC;QAEF,MAAM,IAAI,GAAiB,cAAc;aACvC,IAAI,CAAC,CAAC,CAAC,EAAE,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC,KAAK,CAAC,aAAa,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC;aAC9C,GAAG,CAAC,IAAI,CAAC,EAAE;YACX,OAAO;gBACN,IAAI,CAAC,KAAK;gBACV,IAAI,CAAC,EAAE;gBACP,CAAC,IAAI,CAAC,wBAAwB,IAAI,EAAE,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC;aACjD,CAAC;QACH,CAAC,CAAC,CAAC;QAEJ,OAAO;YACN,IAAI,EAAE;gBACL,OAAO;gBACP,IAAI;aACJ;YACD,OAAO,EAAE,GAAG,EAAE,GAAG,CAAC;SAClB,CAAC;IACH,CAAC;CACD;AAED,MAAM,gBAAgB,GAAG,QAAQ,CAAC,EAAE,CAA6B,UAAU,CAAC,yBAAyB,CAAC,CAAC,wBAAwB,CAAC;IAC/H,EAAE,EAAE,gBAAgB;IACpB,KAAK,EAAE,QAAQ,CAAC,IAAgB,EAAE,IAAgB,CAAC;IACnD,MAAM,EAAE;QACP,SAAS,EAAE,KAAK;KAChB;IACD,QAAQ,EAAE,IAAI,cAAc,CAAC,0BAA0B,CAAC;CACxD,CAAC,CAAC;AAEH,MAAM,0BAA2B,SAAQ,UAAU;aAC3C,OAAE,GAAG,kCAAkC,CAAC;IAE/C;QACC,KAAK,EAAE,CAAC;QACR,IAAI,CAAC,SAAS,CAAC,wBAAwB,CAAC,CAAC;QACzC,IAAI,CAAC,SAAS,CAAC,gBAAgB,CAAC,CAAC;QAEjC,IAAI,CAAC,gBAAgB,EAAE,CAAC;IACzB,CAAC;IAEO,gBAAgB;QACvB,IAAI,CAAC,SAAS,CAAC,eAAe,CAAC,oBAAoB,CAAC,CAAC,CAAC;QACtD,IAAI,CAAC,SAAS,CAAC,eAAe,CAAC,sBAAsB,CAAC,CAAC,CAAC;QACxD,IAAI,CAAC,SAAS,CAAC,eAAe,CAAC,uCAAuC,CAAC,CAAC,CAAC;QACzE,IAAI,CAAC,SAAS,CAAC,eAAe,CAAC,0CAA0C,CAAC,CAAC,CAAC;QAC5E,IAAI,CAAC,SAAS,CAAC,eAAe,CAAC,uCAAuC,CAAC,CAAC,CAAC;QACzE,IAAI,CAAC,SAAS,CAAC,eAAe,CAAC,0CAA0C,CAAC,CAAC,CAAC;QAC5E,IAAI,CAAC,SAAS,CAAC,eAAe,CAAC,0CAA0C,CAAC,CAAC,CAAC;IAC7E,CAAC;;AAGF,IAAM,+BAA+B,GAArC,MAAM,+BAA+B;aAC7B,OAAE,GAAG,uCAAH,AAA0C,CAAC;IAEpD,YAC+C,2BAAwD;QAAxD,gCAA2B,GAA3B,2BAA2B,CAA6B;QAEtG,IAAI,CAAC,8BAA8B,EAAE,CAAC;IACvC,CAAC;IAEO,KAAK,CAAC,8BAA8B;QAC3C,MAAM,IAAI,CAAC,2BAA2B,CAAC,6BAA6B,EAAE,CAAC;IACxE,CAAC;;AAXI,+BAA+B;IAIlC,WAAA,2BAA2B,CAAA;GAJxB,+BAA+B,CAYpC;AAED,oGAAoG;AACpG,6DAA6D;AAE7D,gBAAgB;AAChB,8EAA8E;AAC9E,4GAA4G;AAC5G,4FAA4F;AAC5F,OAAO;AACP,aAAa;AACb,qBAAqB;AACrB,qGAAqG;AACrG,oBAAoB;AACpB,gBAAgB;AAChB,gEAAgE;AAChE,sEAAsE;AACtE,+CAA+C;AAC/C,OAAO;AACP,KAAK;AAEL,gCAAgC;AAChC,sEAAsE;AACtE,sCAAsC;AACtC,KAAK;AAEL,2JAA2J;AAC3J,oCAAoC;AACpC,oDAAoD;AACpD,MAAM;AACN,KAAK;AAEL,mGAAmG;AACnG,mDAAmD;AACnD,+DAA+D;AAC/D,gFAAgF;AAEhF,gFAAgF;AAChF,mDAAmD;AAEnD,2EAA2E;AAC3E,4CAA4C;AAC5C,uFAAuF;AACvF,kDAAkD;AAClD,8CAA8C;AAC9C,0DAA0D;AAC1D,4DAA4D;AAE5D,2BAA2B;AAC3B,iCAAiC;AACjC,2CAA2C;AAC3C,SAAS;AACT,UAAU;AACV,SAAS;AACT,MAAM;AACN,KAAK;AACL,IAAI;AAEJ,6FAA6F;AAC7F,sDAAsD;AAEtD,gBAAgB;AAChB,+DAA+D;AAC/D,4GAA4G;AAC5G,4FAA4F;AAC5F,OAAO;AACP,aAAa;AACb,sCAAsC;AAEtC,yEAAyE;AACzE,uCAAuC;AACvC,+DAA+D;AAC/D,iDAAiD;AACjD,kFAAkF;AAClF,6DAA6D;AAC7D,SAAS;AACT,oBAAoB;AACpB,gBAAgB;AAChB,gEAAgE;AAChE,sEAAsE;AACtE,+CAA+C;AAC/C,OAAO;AACP,KAAK;AAEL,+CAA+C;AAC/C,kIAAkI;AAClI,2EAA2E;AAC3E,4CAA4C;AAC5C,uFAAuF;AACvF,+CAA+C;AAC/C,wDAAwD;AACxD,8BAA8B;AAC9B,wCAAwC;AACxC,SAAS;AACT,UAAU;AACV,SAAS;AACT,MAAM;AACN,KAAK;AACL,IAAI;AAEJ,8BAA8B,CAAC,0BAA0B,CAAC,EAAE,EAAE,0BAA0B,uCAA+B,CAAC;AACxH,8BAA8B,CAAC,+BAA+B,CAAC,EAAE,EAAE,+BAA+B,oCAA4B,CAAC;AAC/H,4IAA4I;AAC5I,8HAA8H","file":"authentication.contribution.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Disposable } from '../../../../base/common/lifecycle.js';\nimport { localize } from '../../../../nls.js';\nimport { registerAction2 } from '../../../../platform/actions/common/actions.js';\nimport { CommandsRegistry } from '../../../../platform/commands/common/commands.js';\nimport { IExtensionManifest } from '../../../../platform/extensions/common/extensions.js';\nimport { SyncDescriptor } from '../../../../platform/instantiation/common/descriptors.js';\nimport { Registry } from '../../../../platform/registry/common/platform.js';\nimport { IWorkbenchContribution, WorkbenchPhase, registerWorkbenchContribution2 } from '../../../common/contributions.js';\nimport { SignOutOfAccountAction } from './actions/signOutOfAccountAction.js';\nimport { IBrowserWorkbenchEnvironmentService } from '../../../services/environment/browser/environmentService.js';\nimport { Extensions, IExtensionFeatureTableRenderer, IExtensionFeaturesRegistry, IRenderedData, IRowData, ITableData } from '../../../services/extensionManagement/common/extensionFeatures.js';\nimport { ManageTrustedExtensionsForAccountAction } from './actions/manageTrustedExtensionsForAccountAction.js';\nimport { ManageAccountPreferencesForExtensionAction } from './actions/manageAccountPreferencesForExtensionAction.js';\nimport { IAuthenticationUsageService } from '../../../services/authentication/browser/authenticationUsageService.js';\nimport { ManageAccountPreferencesForMcpServerAction } from './actions/manageAccountPreferencesForMcpServerAction.js';\nimport { ManageTrustedMcpServersForAccountAction } from './actions/manageTrustedMcpServersForAccountAction.js';\nimport { RemoveDynamicAuthenticationProvidersAction } from './actions/manageDynamicAuthenticationProvidersAction.js';\nimport { ManageAccountsAction } from './actions/manageAccountsAction.js';\n\nconst codeExchangeProxyCommand = CommandsRegistry.registerCommand('workbench.getCodeExchangeProxyEndpoints', function (accessor, _) {\n\tconst environmentService = accessor.get(IBrowserWorkbenchEnvironmentService);\n\treturn environmentService.options?.codeExchangeProxyEndpoints;\n});\n\nclass AuthenticationDataRenderer extends Disposable implements IExtensionFeatureTableRenderer {\n\n\treadonly type = 'table';\n\n\tshouldRender(manifest: IExtensionManifest): boolean {\n\t\treturn !!manifest.contributes?.authentication;\n\t}\n\n\trender(manifest: IExtensionManifest): IRenderedData<ITableData> {\n\t\tconst authentication = manifest.contributes?.authentication || [];\n\t\tif (!authentication.length) {\n\t\t\treturn { data: { headers: [], rows: [] }, dispose: () => { } };\n\t\t}\n\n\t\tconst headers = [\n\t\t\tlocalize('authenticationlabel', \"Label\"),\n\t\t\tlocalize('authenticationid', \"ID\"),\n\t\t\tlocalize('authenticationMcpAuthorizationServers', \"MCP Authorization Servers\")\n\t\t];\n\n\t\tconst rows: IRowData[][] = authentication\n\t\t\t.sort((a, b) => a.label.localeCompare(b.label))\n\t\t\t.map(auth => {\n\t\t\t\treturn [\n\t\t\t\t\tauth.label,\n\t\t\t\t\tauth.id,\n\t\t\t\t\t(auth.authorizationServerGlobs ?? []).join(',\\n')\n\t\t\t\t];\n\t\t\t});\n\n\t\treturn {\n\t\t\tdata: {\n\t\t\t\theaders,\n\t\t\t\trows\n\t\t\t},\n\t\t\tdispose: () => { }\n\t\t};\n\t}\n}\n\nconst extensionFeature = Registry.as<IExtensionFeaturesRegistry>(Extensions.ExtensionFeaturesRegistry).registerExtensionFeature({\n\tid: 'authentication',\n\tlabel: localize('authentication', \"Authentication\"),\n\taccess: {\n\t\tcanToggle: false\n\t},\n\trenderer: new SyncDescriptor(AuthenticationDataRenderer),\n});\n\nclass AuthenticationContribution extends Disposable implements IWorkbenchContribution {\n\tstatic ID = 'workbench.contrib.authentication';\n\n\tconstructor() {\n\t\tsuper();\n\t\tthis._register(codeExchangeProxyCommand);\n\t\tthis._register(extensionFeature);\n\n\t\tthis._registerActions();\n\t}\n\n\tprivate _registerActions(): void {\n\t\tthis._register(registerAction2(ManageAccountsAction));\n\t\tthis._register(registerAction2(SignOutOfAccountAction));\n\t\tthis._register(registerAction2(ManageTrustedExtensionsForAccountAction));\n\t\tthis._register(registerAction2(ManageAccountPreferencesForExtensionAction));\n\t\tthis._register(registerAction2(ManageTrustedMcpServersForAccountAction));\n\t\tthis._register(registerAction2(ManageAccountPreferencesForMcpServerAction));\n\t\tthis._register(registerAction2(RemoveDynamicAuthenticationProvidersAction));\n\t}\n}\n\nclass AuthenticationUsageContribution implements IWorkbenchContribution {\n\tstatic ID = 'workbench.contrib.authenticationUsage';\n\n\tconstructor(\n\t\t@IAuthenticationUsageService private readonly _authenticationUsageService: IAuthenticationUsageService,\n\t) {\n\t\tthis._initializeExtensionUsageCache();\n\t}\n\n\tprivate async _initializeExtensionUsageCache() {\n\t\tawait this._authenticationUsageService.initializeExtensionUsageCache();\n\t}\n}\n\n// class AuthenticationExtensionsContribution extends Disposable implements IWorkbenchContribution {\n// \tstatic ID = 'workbench.contrib.authenticationExtensions';\n\n// \tconstructor(\n// \t\t@IExtensionService private readonly _extensionService: IExtensionService,\n// \t\t@IAuthenticationQueryService private readonly _authenticationQueryService: IAuthenticationQueryService,\n// \t\t@IAuthenticationService private readonly _authenticationService: IAuthenticationService\n// \t) {\n// \t\tsuper();\n// \t\tvoid this.run();\n// \t\tthis._register(this._extensionService.onDidChangeExtensions(this._onDidChangeExtensions, this));\n// \t\tthis._register(\n// \t\t\tEvent.any(\n// \t\t\t\tthis._authenticationService.onDidChangeDeclaredProviders,\n// \t\t\t\tthis._authenticationService.onDidRegisterAuthenticationProvider\n// \t\t\t)(() => this._cleanupRemovedExtensions())\n// \t\t);\n// \t}\n\n// \tasync run(): Promise<void> {\n// \t\tawait this._extensionService.whenInstalledExtensionsRegistered();\n// \t\tthis._cleanupRemovedExtensions();\n// \t}\n\n// \tprivate _onDidChangeExtensions(delta: { readonly added: readonly IExtensionDescription[]; readonly removed: readonly IExtensionDescription[] }): void {\n// \t\tif (delta.removed.length > 0) {\n// \t\t\tthis._cleanupRemovedExtensions(delta.removed);\n// \t\t}\n// \t}\n\n// \tprivate _cleanupRemovedExtensions(removedExtensions?: readonly IExtensionDescription[]): void {\n// \t\tconst extensionIdsToRemove = removedExtensions\n// \t\t\t? new Set(removedExtensions.map(e => e.identifier.value))\n// \t\t\t: new Set(this._extensionService.extensions.map(e => e.identifier.value));\n\n// \t\t// If we are cleaning up specific removed extensions, we only remove those.\n// \t\tconst isTargetedCleanup = !!removedExtensions;\n\n// \t\tconst providerIds = this._authenticationQueryService.getProviderIds();\n// \t\tfor (const providerId of providerIds) {\n// \t\t\tthis._authenticationQueryService.provider(providerId).forEachAccount(account => {\n// \t\t\t\taccount.extensions().forEach(extension => {\n// \t\t\t\t\tconst shouldRemove = isTargetedCleanup\n// \t\t\t\t\t\t? extensionIdsToRemove.has(extension.extensionId)\n// \t\t\t\t\t\t: !extensionIdsToRemove.has(extension.extensionId);\n\n// \t\t\t\t\tif (shouldRemove) {\n// \t\t\t\t\t\textension.removeUsage();\n// \t\t\t\t\t\textension.setAccessAllowed(false);\n// \t\t\t\t\t}\n// \t\t\t\t});\n// \t\t\t});\n// \t\t}\n// \t}\n// }\n\n// class AuthenticationMcpContribution extends Disposable implements IWorkbenchContribution {\n// \tstatic ID = 'workbench.contrib.authenticationMcp';\n\n// \tconstructor(\n// \t\t@IMcpRegistry private readonly _mcpRegistry: IMcpRegistry,\n// \t\t@IAuthenticationQueryService private readonly _authenticationQueryService: IAuthenticationQueryService,\n// \t\t@IAuthenticationService private readonly _authenticationService: IAuthenticationService\n// \t) {\n// \t\tsuper();\n// \t\tthis._cleanupRemovedMcpServers();\n\n// \t\t// Listen for MCP collections changes using autorun with observables\n// \t\tthis._register(autorun(reader => {\n// \t\t\t// Read the collections observable to register dependency\n// \t\t\tthis._mcpRegistry.collections.read(reader);\n// \t\t\t// Schedule cleanup for next tick to avoid running during observable updates\n// \t\t\tqueueMicrotask(() => this._cleanupRemovedMcpServers());\n// \t\t}));\n// \t\tthis._register(\n// \t\t\tEvent.any(\n// \t\t\t\tthis._authenticationService.onDidChangeDeclaredProviders,\n// \t\t\t\tthis._authenticationService.onDidRegisterAuthenticationProvider\n// \t\t\t)(() => this._cleanupRemovedMcpServers())\n// \t\t);\n// \t}\n\n// \tprivate _cleanupRemovedMcpServers(): void {\n// \t\tconst currentServerIds = new Set(this._mcpRegistry.collections.get().flatMap(c => c.serverDefinitions.get()).map(s => s.id));\n// \t\tconst providerIds = this._authenticationQueryService.getProviderIds();\n// \t\tfor (const providerId of providerIds) {\n// \t\t\tthis._authenticationQueryService.provider(providerId).forEachAccount(account => {\n// \t\t\t\taccount.mcpServers().forEach(server => {\n// \t\t\t\t\tif (!currentServerIds.has(server.mcpServerId)) {\n// \t\t\t\t\t\tserver.removeUsage();\n// \t\t\t\t\t\tserver.setAccessAllowed(false);\n// \t\t\t\t\t}\n// \t\t\t\t});\n// \t\t\t});\n// \t\t}\n// \t}\n// }\n\nregisterWorkbenchContribution2(AuthenticationContribution.ID, AuthenticationContribution, WorkbenchPhase.AfterRestored);\nregisterWorkbenchContribution2(AuthenticationUsageContribution.ID, AuthenticationUsageContribution, WorkbenchPhase.Eventually);\n// registerWorkbenchContribution2(AuthenticationExtensionsContribution.ID, AuthenticationExtensionsContribution, WorkbenchPhase.Eventually);\n// registerWorkbenchContribution2(AuthenticationMcpContribution.ID, AuthenticationMcpContribution, WorkbenchPhase.Eventually);\n"]}