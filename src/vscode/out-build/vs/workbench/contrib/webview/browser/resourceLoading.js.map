{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/contrib/webview/browser/resourceLoading.ts","vs/workbench/contrib/webview/browser/resourceLoading.ts"],"names":[],"mappings":"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","file":"resourceLoading.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { VSBufferReadableStream } from '../../../../base/common/buffer.js';\nimport { CancellationToken } from '../../../../base/common/cancellation.js';\nimport { isUNC } from '../../../../base/common/extpath.js';\nimport { Schemas } from '../../../../base/common/network.js';\nimport { normalize, sep } from '../../../../base/common/path.js';\nimport { URI } from '../../../../base/common/uri.js';\nimport { FileOperationError, FileOperationResult, IFileService, IWriteFileOptions } from '../../../../platform/files/common/files.js';\nimport { ILogService } from '../../../../platform/log/common/log.js';\nimport { getWebviewContentMimeType } from '../../../../platform/webview/common/mimeTypes.js';\n\nexport namespace WebviewResourceResponse {\n\texport enum Type { Success, Failed, AccessDenied, NotModified }\n\n\texport class StreamSuccess {\n\t\treadonly type = Type.Success;\n\n\t\tconstructor(\n\t\t\tpublic readonly stream: VSBufferReadableStream,\n\t\t\tpublic readonly etag: string | undefined,\n\t\t\tpublic readonly mtime: number | undefined,\n\t\t\tpublic readonly mimeType: string,\n\t\t) { }\n\t}\n\n\texport const Failed = { type: Type.Failed } as const;\n\texport const AccessDenied = { type: Type.AccessDenied } as const;\n\n\texport class NotModified {\n\t\treadonly type = Type.NotModified;\n\n\t\tconstructor(\n\t\t\tpublic readonly mimeType: string,\n\t\t\tpublic readonly mtime: number | undefined,\n\t\t) { }\n\t}\n\n\texport type StreamResponse = StreamSuccess | typeof Failed | typeof AccessDenied | NotModified;\n}\n\nexport async function loadLocalResource(\n\trequestUri: URI,\n\toptions: {\n\t\tifNoneMatch: string | undefined;\n\t\troots: ReadonlyArray<URI>;\n\t},\n\tfileService: IFileService,\n\tlogService: ILogService,\n\ttoken: CancellationToken,\n): Promise<WebviewResourceResponse.StreamResponse> {\n\tconst resourceToLoad = getResourceToLoad(requestUri, options.roots);\n\n\tlogService.trace(`Webview.loadLocalResource - trying to load resource. requestUri=${requestUri}, resourceToLoad=${resourceToLoad}`);\n\n\tif (!resourceToLoad) {\n\t\tlogService.trace(`Webview.loadLocalResource - access denied. requestUri=${requestUri}, resourceToLoad=${resourceToLoad}`);\n\t\treturn WebviewResourceResponse.AccessDenied;\n\t}\n\n\tconst mime = getWebviewContentMimeType(requestUri); // Use the original path for the mime\n\n\ttry {\n\t\tconst result = await fileService.readFileStream(resourceToLoad, { etag: options.ifNoneMatch }, token);\n\t\tlogService.trace(`Webview.loadLocalResource - Loaded. requestUri=${requestUri}, resourceToLoad=${resourceToLoad}`);\n\t\treturn new WebviewResourceResponse.StreamSuccess(result.value, result.etag, result.mtime, mime);\n\t} catch (err) {\n\t\tif (err instanceof FileOperationError) {\n\t\t\tconst result = err.fileOperationResult;\n\n\t\t\t// NotModified status is expected and can be handled gracefully\n\t\t\tif (result === FileOperationResult.FILE_NOT_MODIFIED_SINCE) {\n\t\t\t\tlogService.trace(`Webview.loadLocalResource - not modified. requestUri=${requestUri}, resourceToLoad=${resourceToLoad}`);\n\t\t\t\treturn new WebviewResourceResponse.NotModified(mime, (err.options as IWriteFileOptions | undefined)?.mtime);\n\t\t\t}\n\t\t}\n\n\t\t// Otherwise the error is unexpected.\n\t\tlogService.error(`Webview.loadLocalResource - Error using fileReader. requestUri=${requestUri}, resourceToLoad=${resourceToLoad}`);\n\t\treturn WebviewResourceResponse.Failed;\n\t}\n}\n\nfunction getResourceToLoad(\n\trequestUri: URI,\n\troots: ReadonlyArray<URI>,\n): URI | undefined {\n\tfor (const root of roots) {\n\t\tif (containsResource(root, requestUri)) {\n\t\t\treturn normalizeResourcePath(requestUri);\n\t\t}\n\t}\n\n\treturn undefined;\n}\n\nfunction containsResource(root: URI, resource: URI): boolean {\n\tif (root.scheme !== resource.scheme) {\n\t\treturn false;\n\t}\n\n\tlet resourceFsPath = normalize(resource.fsPath);\n\tlet rootPath = normalize(root.fsPath + (root.fsPath.endsWith(sep) ? '' : sep));\n\n\tif (isUNC(root.fsPath) && isUNC(resource.fsPath)) {\n\t\trootPath = rootPath.toLowerCase();\n\t\tresourceFsPath = resourceFsPath.toLowerCase();\n\t}\n\n\treturn resourceFsPath.startsWith(rootPath);\n}\n\nfunction normalizeResourcePath(resource: URI): URI {\n\t// Rewrite remote uris to a path that the remote file system can understand\n\tif (resource.scheme === Schemas.vscodeRemote) {\n\t\treturn URI.from({\n\t\t\tscheme: Schemas.vscodeRemote,\n\t\t\tauthority: resource.authority,\n\t\t\tpath: '/vscode-resource',\n\t\t\tquery: JSON.stringify({\n\t\t\t\trequestResourcePath: resource.path\n\t\t\t})\n\t\t});\n\t}\n\treturn resource;\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { VSBufferReadableStream } from '../../../../base/common/buffer.js';\nimport { CancellationToken } from '../../../../base/common/cancellation.js';\nimport { isUNC } from '../../../../base/common/extpath.js';\nimport { Schemas } from '../../../../base/common/network.js';\nimport { normalize, sep } from '../../../../base/common/path.js';\nimport { URI } from '../../../../base/common/uri.js';\nimport { FileOperationError, FileOperationResult, IFileService, IWriteFileOptions } from '../../../../platform/files/common/files.js';\nimport { ILogService } from '../../../../platform/log/common/log.js';\nimport { getWebviewContentMimeType } from '../../../../platform/webview/common/mimeTypes.js';\n\nexport namespace WebviewResourceResponse {\n\texport enum Type { Success, Failed, AccessDenied, NotModified }\n\n\texport class StreamSuccess {\n\t\treadonly type = Type.Success;\n\n\t\tconstructor(\n\t\t\tpublic readonly stream: VSBufferReadableStream,\n\t\t\tpublic readonly etag: string | undefined,\n\t\t\tpublic readonly mtime: number | undefined,\n\t\t\tpublic readonly mimeType: string,\n\t\t) { }\n\t}\n\n\texport const Failed = { type: Type.Failed } as const;\n\texport const AccessDenied = { type: Type.AccessDenied } as const;\n\n\texport class NotModified {\n\t\treadonly type = Type.NotModified;\n\n\t\tconstructor(\n\t\t\tpublic readonly mimeType: string,\n\t\t\tpublic readonly mtime: number | undefined,\n\t\t) { }\n\t}\n\n\texport type StreamResponse = StreamSuccess | typeof Failed | typeof AccessDenied | NotModified;\n}\n\nexport async function loadLocalResource(\n\trequestUri: URI,\n\toptions: {\n\t\tifNoneMatch: string | undefined;\n\t\troots: ReadonlyArray<URI>;\n\t},\n\tfileService: IFileService,\n\tlogService: ILogService,\n\ttoken: CancellationToken,\n): Promise<WebviewResourceResponse.StreamResponse> {\n\tconst resourceToLoad = getResourceToLoad(requestUri, options.roots);\n\n\tlogService.trace(`Webview.loadLocalResource - trying to load resource. requestUri=${requestUri}, resourceToLoad=${resourceToLoad}`);\n\n\tif (!resourceToLoad) {\n\t\tlogService.trace(`Webview.loadLocalResource - access denied. requestUri=${requestUri}, resourceToLoad=${resourceToLoad}`);\n\t\treturn WebviewResourceResponse.AccessDenied;\n\t}\n\n\tconst mime = getWebviewContentMimeType(requestUri); // Use the original path for the mime\n\n\ttry {\n\t\tconst result = await fileService.readFileStream(resourceToLoad, { etag: options.ifNoneMatch }, token);\n\t\tlogService.trace(`Webview.loadLocalResource - Loaded. requestUri=${requestUri}, resourceToLoad=${resourceToLoad}`);\n\t\treturn new WebviewResourceResponse.StreamSuccess(result.value, result.etag, result.mtime, mime);\n\t} catch (err) {\n\t\tif (err instanceof FileOperationError) {\n\t\t\tconst result = err.fileOperationResult;\n\n\t\t\t// NotModified status is expected and can be handled gracefully\n\t\t\tif (result === FileOperationResult.FILE_NOT_MODIFIED_SINCE) {\n\t\t\t\tlogService.trace(`Webview.loadLocalResource - not modified. requestUri=${requestUri}, resourceToLoad=${resourceToLoad}`);\n\t\t\t\treturn new WebviewResourceResponse.NotModified(mime, (err.options as IWriteFileOptions | undefined)?.mtime);\n\t\t\t}\n\t\t}\n\n\t\t// Otherwise the error is unexpected.\n\t\tlogService.error(`Webview.loadLocalResource - Error using fileReader. requestUri=${requestUri}, resourceToLoad=${resourceToLoad}`);\n\t\treturn WebviewResourceResponse.Failed;\n\t}\n}\n\nfunction getResourceToLoad(\n\trequestUri: URI,\n\troots: ReadonlyArray<URI>,\n): URI | undefined {\n\tfor (const root of roots) {\n\t\tif (containsResource(root, requestUri)) {\n\t\t\treturn normalizeResourcePath(requestUri);\n\t\t}\n\t}\n\n\treturn undefined;\n}\n\nfunction containsResource(root: URI, resource: URI): boolean {\n\tif (root.scheme !== resource.scheme) {\n\t\treturn false;\n\t}\n\n\tlet resourceFsPath = normalize(resource.fsPath);\n\tlet rootPath = normalize(root.fsPath + (root.fsPath.endsWith(sep) ? '' : sep));\n\n\tif (isUNC(root.fsPath) && isUNC(resource.fsPath)) {\n\t\trootPath = rootPath.toLowerCase();\n\t\tresourceFsPath = resourceFsPath.toLowerCase();\n\t}\n\n\treturn resourceFsPath.startsWith(rootPath);\n}\n\nfunction normalizeResourcePath(resource: URI): URI {\n\t// Rewrite remote uris to a path that the remote file system can understand\n\tif (resource.scheme === Schemas.vscodeRemote) {\n\t\treturn URI.from({\n\t\t\tscheme: Schemas.vscodeRemote,\n\t\t\tauthority: resource.authority,\n\t\t\tpath: '/vscode-resource',\n\t\t\tquery: JSON.stringify({\n\t\t\t\trequestResourcePath: resource.path\n\t\t\t})\n\t\t});\n\t}\n\treturn resource;\n}\n"]}