{"version":3,"sources":["vs/workbench/contrib/mergeEditor/browser/mergeEditorInputModel.ts"],"names":[],"mappings":"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","file":"mergeEditorInputModel.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { assertFn } from '../../../../base/common/assert.js';\nimport { BugIndicatingError, onUnexpectedError } from '../../../../base/common/errors.js';\nimport { Event } from '../../../../base/common/event.js';\nimport { DisposableStore, IDisposable, IReference } from '../../../../base/common/lifecycle.js';\nimport { derived, IObservable, observableFromEvent, observableValue } from '../../../../base/common/observable.js';\nimport { basename, isEqual } from '../../../../base/common/resources.js';\nimport Severity from '../../../../base/common/severity.js';\nimport { URI } from '../../../../base/common/uri.js';\nimport { IModelService } from '../../../../editor/common/services/model.js';\nimport { IResolvedTextEditorModel, ITextModelService } from '../../../../editor/common/services/resolverService.js';\nimport { localize } from '../../../../nls.js';\nimport { ConfirmResult, IDialogService, IPromptButton } from '../../../../platform/dialogs/common/dialogs.js';\nimport { IInstantiationService } from '../../../../platform/instantiation/common/instantiation.js';\nimport { IStorageService, StorageScope, StorageTarget } from '../../../../platform/storage/common/storage.js';\nimport { IRevertOptions, SaveSourceRegistry } from '../../../common/editor.js';\nimport { EditorModel } from '../../../common/editor/editorModel.js';\nimport { MergeEditorInputData } from './mergeEditorInput.js';\nimport { conflictMarkers } from './mergeMarkers/mergeMarkersController.js';\nimport { MergeDiffComputer } from './model/diffComputer.js';\nimport { InputData, MergeEditorModel } from './model/mergeEditorModel.js';\nimport { MergeEditorTelemetry } from './telemetry.js';\nimport { StorageCloseWithConflicts } from '../common/mergeEditor.js';\nimport { IEditorService } from '../../../services/editor/common/editorService.js';\nimport { ITextFileEditorModel, ITextFileSaveOptions, ITextFileService } from '../../../services/textfile/common/textfiles.js';\nimport { ITextModel } from '../../../../editor/common/model.js';\nimport { ILanguageService } from '../../../../editor/common/languages/language.js';\n\nexport interface MergeEditorArgs {\n\tbase: URI;\n\tinput1: MergeEditorInputData;\n\tinput2: MergeEditorInputData;\n\tresult: URI;\n}\n\nexport interface IMergeEditorInputModelFactory {\n\tcreateInputModel(args: MergeEditorArgs): Promise<IMergeEditorInputModel>;\n}\n\nexport interface IMergeEditorInputModel extends IDisposable {\n\treadonly resultUri: URI;\n\n\treadonly model: MergeEditorModel;\n\treadonly isDirty: IObservable<boolean>;\n\n\tsave(options?: ITextFileSaveOptions): Promise<void>;\n\n\t/**\n\t * If save resets the dirty state, revert must do so too.\n\t*/\n\trevert(options?: IRevertOptions): Promise<void>;\n\n\tshouldConfirmClose(): boolean;\n\n\tconfirmClose(inputModels: IMergeEditorInputModel[]): Promise<ConfirmResult>;\n\n\t/**\n\t * Marks the merge as done. The merge editor must be closed afterwards.\n\t*/\n\taccept(): Promise<void>;\n}\n\n/* ================ Temp File ================ */\n\nexport class TempFileMergeEditorModeFactory implements IMergeEditorInputModelFactory {\n\tconstructor(\n\t\tprivate readonly _mergeEditorTelemetry: MergeEditorTelemetry,\n\t\t@IInstantiationService private readonly _instantiationService: IInstantiationService,\n\t\t@ITextModelService private readonly _textModelService: ITextModelService,\n\t\t@IModelService private readonly _modelService: IModelService,\n\t) {\n\t}\n\n\tasync createInputModel(args: MergeEditorArgs): Promise<IMergeEditorInputModel> {\n\t\tconst store = new DisposableStore();\n\n\t\tconst [\n\t\t\tbase,\n\t\t\tresult,\n\t\t\tinput1Data,\n\t\t\tinput2Data,\n\t\t] = await Promise.all([\n\t\t\tthis._textModelService.createModelReference(args.base),\n\t\t\tthis._textModelService.createModelReference(args.result),\n\t\t\ttoInputData(args.input1, this._textModelService, store),\n\t\t\ttoInputData(args.input2, this._textModelService, store),\n\t\t]);\n\n\t\tstore.add(base);\n\t\tstore.add(result);\n\n\t\tconst tempResultUri = result.object.textEditorModel.uri.with({ scheme: 'merge-result' });\n\n\t\tconst temporaryResultModel = this._modelService.createModel(\n\t\t\t'',\n\t\t\t{\n\t\t\t\tlanguageId: result.object.textEditorModel.getLanguageId(),\n\t\t\t\tonDidChange: Event.None,\n\t\t\t},\n\t\t\ttempResultUri,\n\t\t);\n\t\tstore.add(temporaryResultModel);\n\n\t\tconst mergeDiffComputer = this._instantiationService.createInstance(MergeDiffComputer);\n\t\tconst model = this._instantiationService.createInstance(\n\t\t\tMergeEditorModel,\n\t\t\tbase.object.textEditorModel,\n\t\t\tinput1Data,\n\t\t\tinput2Data,\n\t\t\ttemporaryResultModel,\n\t\t\tmergeDiffComputer,\n\t\t\t{\n\t\t\t\tresetResult: true,\n\t\t\t},\n\t\t\tthis._mergeEditorTelemetry,\n\t\t);\n\t\tstore.add(model);\n\n\t\tawait model.onInitialized;\n\n\t\treturn this._instantiationService.createInstance(TempFileMergeEditorInputModel, model, store, result.object, args.result);\n\t}\n}\n\nclass TempFileMergeEditorInputModel extends EditorModel implements IMergeEditorInputModel {\n\tprivate readonly savedAltVersionId;\n\tprivate readonly altVersionId;\n\n\tpublic readonly isDirty;\n\n\tprivate finished;\n\n\tconstructor(\n\t\tpublic readonly model: MergeEditorModel,\n\t\tprivate readonly disposable: IDisposable,\n\t\tprivate readonly result: IResolvedTextEditorModel,\n\t\tpublic readonly resultUri: URI,\n\t\t@ITextFileService private readonly textFileService: ITextFileService,\n\t\t@IDialogService private readonly dialogService: IDialogService,\n\t\t@IEditorService private readonly editorService: IEditorService,\n\t) {\n\t\tsuper();\n\t\tthis.savedAltVersionId = observableValue(this, this.model.resultTextModel.getAlternativeVersionId());\n\t\tthis.altVersionId = observableFromEvent(this,\n\t\t\te => this.model.resultTextModel.onDidChangeContent(e),\n\t\t\t() => /** @description getAlternativeVersionId */ this.model.resultTextModel.getAlternativeVersionId()\n\t\t);\n\t\tthis.isDirty = derived(this, (reader) => this.altVersionId.read(reader) !== this.savedAltVersionId.read(reader));\n\t\tthis.finished = false;\n\t}\n\n\toverride dispose(): void {\n\t\tthis.disposable.dispose();\n\t\tsuper.dispose();\n\t}\n\n\tasync accept(): Promise<void> {\n\t\tconst value = await this.model.resultTextModel.getValue();\n\t\tthis.result.textEditorModel.setValue(value);\n\t\tthis.savedAltVersionId.set(this.model.resultTextModel.getAlternativeVersionId(), undefined);\n\t\tawait this.textFileService.save(this.result.textEditorModel.uri);\n\t\tthis.finished = true;\n\t}\n\n\tprivate async _discard(): Promise<void> {\n\t\tawait this.textFileService.revert(this.model.resultTextModel.uri);\n\t\tthis.savedAltVersionId.set(this.model.resultTextModel.getAlternativeVersionId(), undefined);\n\t\tthis.finished = true;\n\t}\n\n\tpublic shouldConfirmClose(): boolean {\n\t\treturn true;\n\t}\n\n\tpublic async confirmClose(inputModels: TempFileMergeEditorInputModel[]): Promise<ConfirmResult> {\n\t\tassertFn(\n\t\t\t() => inputModels.some((m) => m === this)\n\t\t);\n\n\t\tconst someDirty = inputModels.some((m) => m.isDirty.get());\n\t\tlet choice: ConfirmResult;\n\t\tif (someDirty) {\n\t\t\tconst isMany = inputModels.length > 1;\n\n\t\t\tconst message = isMany\n\t\t\t\t? localize('messageN', 'Do you want keep the merge result of {0} files?', inputModels.length)\n\t\t\t\t: localize('message1', 'Do you want keep the merge result of {0}?', basename(inputModels[0].model.resultTextModel.uri));\n\n\t\t\tconst hasUnhandledConflicts = inputModels.some((m) => m.model.hasUnhandledConflicts.get());\n\n\t\t\tconst buttons: IPromptButton<ConfirmResult>[] = [\n\t\t\t\t{\n\t\t\t\t\tlabel: hasUnhandledConflicts ?\n\t\t\t\t\t\tlocalize({ key: 'saveWithConflict', comment: ['&& denotes a mnemonic'] }, \"&&Save With Conflicts\") :\n\t\t\t\t\t\tlocalize({ key: 'save', comment: ['&& denotes a mnemonic'] }, \"&&Save\"),\n\t\t\t\t\trun: () => ConfirmResult.SAVE\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tlabel: localize({ key: 'discard', comment: ['&& denotes a mnemonic'] }, \"Do&&n't Save\"),\n\t\t\t\t\trun: () => ConfirmResult.DONT_SAVE\n\t\t\t\t}\n\t\t\t];\n\n\t\t\tchoice = (await this.dialogService.prompt<ConfirmResult>({\n\t\t\t\ttype: Severity.Info,\n\t\t\t\tmessage,\n\t\t\t\tdetail:\n\t\t\t\t\thasUnhandledConflicts\n\t\t\t\t\t\t? isMany\n\t\t\t\t\t\t\t? localize('detailNConflicts', \"The files contain unhandled conflicts. The merge results will be lost if you don't save them.\")\n\t\t\t\t\t\t\t: localize('detail1Conflicts', \"The file contains unhandled conflicts. The merge result will be lost if you don't save it.\")\n\t\t\t\t\t\t: isMany\n\t\t\t\t\t\t\t? localize('detailN', \"The merge results will be lost if you don't save them.\")\n\t\t\t\t\t\t\t: localize('detail1', \"The merge result will be lost if you don't save it.\"),\n\t\t\t\tbuttons,\n\t\t\t\tcancelButton: {\n\t\t\t\t\trun: () => ConfirmResult.CANCEL\n\t\t\t\t}\n\t\t\t})).result;\n\t\t} else {\n\t\t\tchoice = ConfirmResult.DONT_SAVE;\n\t\t}\n\n\t\tif (choice === ConfirmResult.SAVE) {\n\t\t\t// save with conflicts\n\t\t\tawait Promise.all(inputModels.map(m => m.accept()));\n\t\t} else if (choice === ConfirmResult.DONT_SAVE) {\n\t\t\t// discard changes\n\t\t\tawait Promise.all(inputModels.map(m => m._discard()));\n\t\t} else {\n\t\t\t// cancel: stay in editor\n\t\t}\n\t\treturn choice;\n\t}\n\n\tpublic async save(options?: ITextFileSaveOptions): Promise<void> {\n\t\tif (this.finished) {\n\t\t\treturn;\n\t\t}\n\t\t// It does not make sense to save anything in the temp file mode.\n\t\t// The file stays dirty from the first edit on.\n\n\t\t(async () => {\n\t\t\tconst { confirmed } = await this.dialogService.confirm({\n\t\t\t\tmessage: localize(\n\t\t\t\t\t'saveTempFile.message',\n\t\t\t\t\t\"Do you want to accept the merge result?\"\n\t\t\t\t),\n\t\t\t\tdetail: localize(\n\t\t\t\t\t'saveTempFile.detail',\n\t\t\t\t\t\"This will write the merge result to the original file and close the merge editor.\"\n\t\t\t\t),\n\t\t\t\tprimaryButton: localize({ key: 'acceptMerge', comment: ['&& denotes a mnemonic'] }, '&&Accept Merge')\n\t\t\t});\n\n\t\t\tif (confirmed) {\n\t\t\t\tawait this.accept();\n\t\t\t\tconst editors = this.editorService.findEditors(this.resultUri).filter(e => e.editor.typeId === 'mergeEditor.Input');\n\t\t\t\tawait this.editorService.closeEditors(editors);\n\t\t\t}\n\t\t})();\n\t}\n\n\tpublic async revert(options?: IRevertOptions): Promise<void> {\n\t\t// no op\n\t}\n}\n\n/* ================ Workspace ================ */\n\nexport class WorkspaceMergeEditorModeFactory implements IMergeEditorInputModelFactory {\n\tconstructor(\n\t\tprivate readonly _mergeEditorTelemetry: MergeEditorTelemetry,\n\t\t@IInstantiationService private readonly _instantiationService: IInstantiationService,\n\t\t@ITextModelService private readonly _textModelService: ITextModelService,\n\t\t@ITextFileService private readonly textFileService: ITextFileService,\n\t\t@IModelService private readonly _modelService: IModelService,\n\t\t@ILanguageService private readonly _languageService: ILanguageService,\n\t) {\n\t}\n\n\tprivate static readonly FILE_SAVED_SOURCE = SaveSourceRegistry.registerSource('merge-editor.source', localize('merge-editor.source', \"Before Resolving Conflicts In Merge Editor\"));\n\n\tpublic async createInputModel(args: MergeEditorArgs): Promise<IMergeEditorInputModel> {\n\t\tconst store = new DisposableStore();\n\n\t\tlet resultTextFileModel = undefined as ITextFileEditorModel | undefined;\n\t\tconst modelListener = store.add(new DisposableStore());\n\t\tconst handleDidCreate = (model: ITextFileEditorModel) => {\n\t\t\tif (isEqual(args.result, model.resource)) {\n\t\t\t\tmodelListener.clear();\n\t\t\t\tresultTextFileModel = model;\n\t\t\t}\n\t\t};\n\t\tmodelListener.add(this.textFileService.files.onDidCreate(handleDidCreate));\n\t\tthis.textFileService.files.models.forEach(handleDidCreate);\n\n\t\tlet [\n\t\t\tbase,\n\t\t\tresult,\n\t\t\tinput1Data,\n\t\t\tinput2Data,\n\t\t] = await Promise.all([\n\t\t\tthis._textModelService.createModelReference(args.base).then<IReference<ITextModel>>(v => ({\n\t\t\t\tobject: v.object.textEditorModel,\n\t\t\t\tdispose: () => v.dispose(),\n\t\t\t})).catch(e => {\n\t\t\t\tonUnexpectedError(e);\n\t\t\t\tconsole.error(e); // Only file not found error should be handled ideally\n\t\t\t\treturn undefined;\n\t\t\t}),\n\t\t\tthis._textModelService.createModelReference(args.result),\n\t\t\ttoInputData(args.input1, this._textModelService, store),\n\t\t\ttoInputData(args.input2, this._textModelService, store),\n\t\t]);\n\n\t\tif (base === undefined) {\n\t\t\tconst tm = this._modelService.createModel('', this._languageService.createById(result.object.getLanguageId()));\n\t\t\tbase = {\n\t\t\t\tdispose: () => { tm.dispose(); },\n\t\t\t\tobject: tm\n\t\t\t};\n\t\t}\n\n\t\tstore.add(base);\n\t\tstore.add(result);\n\n\t\tif (!resultTextFileModel) {\n\t\t\tthrow new BugIndicatingError();\n\t\t}\n\t\t// So that \"Don't save\" does revert the file\n\t\tawait resultTextFileModel.save({ source: WorkspaceMergeEditorModeFactory.FILE_SAVED_SOURCE });\n\n\t\tconst lines = resultTextFileModel.textEditorModel!.getLinesContent();\n\t\tconst hasConflictMarkers = lines.some(l => l.startsWith(conflictMarkers.start));\n\t\tconst resetResult = hasConflictMarkers;\n\n\t\tconst mergeDiffComputer = this._instantiationService.createInstance(MergeDiffComputer);\n\n\t\tconst model = this._instantiationService.createInstance(\n\t\t\tMergeEditorModel,\n\t\t\tbase.object,\n\t\t\tinput1Data,\n\t\t\tinput2Data,\n\t\t\tresult.object.textEditorModel,\n\t\t\tmergeDiffComputer,\n\t\t\t{\n\t\t\t\tresetResult\n\t\t\t},\n\t\t\tthis._mergeEditorTelemetry,\n\t\t);\n\t\tstore.add(model);\n\n\t\tawait model.onInitialized;\n\n\t\treturn this._instantiationService.createInstance(WorkspaceMergeEditorInputModel, model, store, resultTextFileModel, this._mergeEditorTelemetry);\n\t}\n}\n\nclass WorkspaceMergeEditorInputModel extends EditorModel implements IMergeEditorInputModel {\n\tpublic readonly isDirty;\n\n\tprivate reported;\n\tprivate readonly dateTimeOpened;\n\n\tconstructor(\n\t\tpublic readonly model: MergeEditorModel,\n\t\tprivate readonly disposableStore: DisposableStore,\n\t\tprivate readonly resultTextFileModel: ITextFileEditorModel,\n\t\tprivate readonly telemetry: MergeEditorTelemetry,\n\t\t@IDialogService private readonly _dialogService: IDialogService,\n\t\t@IStorageService private readonly _storageService: IStorageService,\n\t) {\n\t\tsuper();\n\t\tthis.isDirty = observableFromEvent(this,\n\t\t\tEvent.any(this.resultTextFileModel.onDidChangeDirty, this.resultTextFileModel.onDidSaveError),\n\t\t\t() => /** @description isDirty */ this.resultTextFileModel.isDirty()\n\t\t);\n\t\tthis.reported = false;\n\t\tthis.dateTimeOpened = new Date();\n\t}\n\n\tpublic override dispose(): void {\n\t\tthis.disposableStore.dispose();\n\t\tsuper.dispose();\n\n\t\tthis.reportClose(false);\n\t}\n\n\tprivate reportClose(accepted: boolean): void {\n\t\tif (!this.reported) {\n\t\t\tconst remainingConflictCount = this.model.unhandledConflictsCount.get();\n\t\t\tconst durationOpenedMs = new Date().getTime() - this.dateTimeOpened.getTime();\n\t\t\tthis.telemetry.reportMergeEditorClosed({\n\t\t\t\tdurationOpenedSecs: durationOpenedMs / 1000,\n\t\t\t\tremainingConflictCount,\n\t\t\t\taccepted,\n\n\t\t\t\tconflictCount: this.model.conflictCount,\n\t\t\t\tcombinableConflictCount: this.model.combinableConflictCount,\n\n\t\t\t\tconflictsResolvedWithBase: this.model.conflictsResolvedWithBase,\n\t\t\t\tconflictsResolvedWithInput1: this.model.conflictsResolvedWithInput1,\n\t\t\t\tconflictsResolvedWithInput2: this.model.conflictsResolvedWithInput2,\n\t\t\t\tconflictsResolvedWithSmartCombination: this.model.conflictsResolvedWithSmartCombination,\n\n\t\t\t\tmanuallySolvedConflictCountThatEqualNone: this.model.manuallySolvedConflictCountThatEqualNone,\n\t\t\t\tmanuallySolvedConflictCountThatEqualSmartCombine: this.model.manuallySolvedConflictCountThatEqualSmartCombine,\n\t\t\t\tmanuallySolvedConflictCountThatEqualInput1: this.model.manuallySolvedConflictCountThatEqualInput1,\n\t\t\t\tmanuallySolvedConflictCountThatEqualInput2: this.model.manuallySolvedConflictCountThatEqualInput2,\n\n\t\t\t\tmanuallySolvedConflictCountThatEqualNoneAndStartedWithBase: this.model.manuallySolvedConflictCountThatEqualNoneAndStartedWithBase,\n\t\t\t\tmanuallySolvedConflictCountThatEqualNoneAndStartedWithInput1: this.model.manuallySolvedConflictCountThatEqualNoneAndStartedWithInput1,\n\t\t\t\tmanuallySolvedConflictCountThatEqualNoneAndStartedWithInput2: this.model.manuallySolvedConflictCountThatEqualNoneAndStartedWithInput2,\n\t\t\t\tmanuallySolvedConflictCountThatEqualNoneAndStartedWithBothNonSmart: this.model.manuallySolvedConflictCountThatEqualNoneAndStartedWithBothNonSmart,\n\t\t\t\tmanuallySolvedConflictCountThatEqualNoneAndStartedWithBothSmart: this.model.manuallySolvedConflictCountThatEqualNoneAndStartedWithBothSmart,\n\t\t\t});\n\t\t\tthis.reported = true;\n\t\t}\n\t}\n\n\tpublic async accept(): Promise<void> {\n\t\tthis.reportClose(true);\n\t\tawait this.resultTextFileModel.save();\n\t}\n\n\tget resultUri(): URI {\n\t\treturn this.resultTextFileModel.resource;\n\t}\n\n\tasync save(options?: ITextFileSaveOptions): Promise<void> {\n\t\tawait this.resultTextFileModel.save(options);\n\t}\n\n\t/**\n\t * If save resets the dirty state, revert must do so too.\n\t*/\n\tasync revert(options?: IRevertOptions): Promise<void> {\n\t\tawait this.resultTextFileModel.revert(options);\n\t}\n\n\tshouldConfirmClose(): boolean {\n\t\t// Always confirm\n\t\treturn true;\n\t}\n\n\tasync confirmClose(inputModels: IMergeEditorInputModel[]): Promise<ConfirmResult> {\n\t\tconst isMany = inputModels.length > 1;\n\t\tconst someDirty = inputModels.some(m => m.isDirty.get());\n\t\tconst someUnhandledConflicts = inputModels.some(m => m.model.hasUnhandledConflicts.get());\n\t\tif (someDirty) {\n\t\t\tconst message = isMany\n\t\t\t\t? localize('workspace.messageN', 'Do you want to save the changes you made to {0} files?', inputModels.length)\n\t\t\t\t: localize('workspace.message1', 'Do you want to save the changes you made to {0}?', basename(inputModels[0].resultUri));\n\t\t\tconst { result } = await this._dialogService.prompt<ConfirmResult>({\n\t\t\t\ttype: Severity.Info,\n\t\t\t\tmessage,\n\t\t\t\tdetail:\n\t\t\t\t\tsomeUnhandledConflicts ?\n\t\t\t\t\t\tisMany\n\t\t\t\t\t\t\t? localize('workspace.detailN.unhandled', \"The files contain unhandled conflicts. Your changes will be lost if you don't save them.\")\n\t\t\t\t\t\t\t: localize('workspace.detail1.unhandled', \"The file contains unhandled conflicts. Your changes will be lost if you don't save them.\")\n\t\t\t\t\t\t: isMany\n\t\t\t\t\t\t\t? localize('workspace.detailN.handled', \"Your changes will be lost if you don't save them.\")\n\t\t\t\t\t\t\t: localize('workspace.detail1.handled', \"Your changes will be lost if you don't save them.\"),\n\t\t\t\tbuttons: [\n\t\t\t\t\t{\n\t\t\t\t\t\tlabel: someUnhandledConflicts\n\t\t\t\t\t\t\t? localize({ key: 'workspace.saveWithConflict', comment: ['&& denotes a mnemonic'] }, '&&Save with Conflicts')\n\t\t\t\t\t\t\t: localize({ key: 'workspace.save', comment: ['&& denotes a mnemonic'] }, '&&Save'),\n\t\t\t\t\t\trun: () => ConfirmResult.SAVE\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tlabel: localize({ key: 'workspace.doNotSave', comment: ['&& denotes a mnemonic'] }, \"Do&&n't Save\"),\n\t\t\t\t\t\trun: () => ConfirmResult.DONT_SAVE\n\t\t\t\t\t}\n\t\t\t\t],\n\t\t\t\tcancelButton: {\n\t\t\t\t\trun: () => ConfirmResult.CANCEL\n\t\t\t\t}\n\t\t\t});\n\t\t\treturn result;\n\n\t\t} else if (someUnhandledConflicts && !this._storageService.getBoolean(StorageCloseWithConflicts, StorageScope.PROFILE, false)) {\n\t\t\tconst { confirmed, checkboxChecked } = await this._dialogService.confirm({\n\t\t\t\tmessage: isMany\n\t\t\t\t\t? localize('workspace.messageN.nonDirty', 'Do you want to close {0} merge editors?', inputModels.length)\n\t\t\t\t\t: localize('workspace.message1.nonDirty', 'Do you want to close the merge editor for {0}?', basename(inputModels[0].resultUri)),\n\t\t\t\tdetail: someUnhandledConflicts ?\n\t\t\t\t\tisMany\n\t\t\t\t\t\t? localize('workspace.detailN.unhandled.nonDirty', \"The files contain unhandled conflicts.\")\n\t\t\t\t\t\t: localize('workspace.detail1.unhandled.nonDirty', \"The file contains unhandled conflicts.\")\n\t\t\t\t\t: undefined,\n\t\t\t\tprimaryButton: someUnhandledConflicts\n\t\t\t\t\t? localize({ key: 'workspace.closeWithConflicts', comment: ['&& denotes a mnemonic'] }, '&&Close with Conflicts')\n\t\t\t\t\t: localize({ key: 'workspace.close', comment: ['&& denotes a mnemonic'] }, '&&Close'),\n\t\t\t\tcheckbox: { label: localize('noMoreWarn', \"Do not ask me again\") }\n\t\t\t});\n\n\t\t\tif (checkboxChecked) {\n\t\t\t\tthis._storageService.store(StorageCloseWithConflicts, true, StorageScope.PROFILE, StorageTarget.USER);\n\t\t\t}\n\n\t\t\treturn confirmed ? ConfirmResult.SAVE : ConfirmResult.CANCEL;\n\t\t} else {\n\t\t\t// This shouldn't do anything\n\t\t\treturn ConfirmResult.SAVE;\n\t\t}\n\t}\n}\n\n/* ================= Utils ================== */\n\nasync function toInputData(data: MergeEditorInputData, textModelService: ITextModelService, store: DisposableStore): Promise<InputData> {\n\tconst ref = await textModelService.createModelReference(data.uri);\n\tstore.add(ref);\n\treturn {\n\t\ttextModel: ref.object.textEditorModel,\n\t\ttitle: data.title,\n\t\tdescription: data.description,\n\t\tdetail: data.detail,\n\t};\n}\n"]}