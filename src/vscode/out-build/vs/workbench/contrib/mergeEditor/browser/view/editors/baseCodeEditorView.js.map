{"version":3,"sources":["vs/workbench/contrib/mergeEditor/browser/view/editors/baseCodeEditorView.ts"],"names":[],"mappings":"AAAA;;;gGAGgG;;;;;;;;;;AAEhG,OAAO,EAAE,CAAC,EAAE,KAAK,EAAE,MAAM,uCAAuC,CAAC;AACjE,OAAO,EAAE,oBAAoB,EAAE,MAAM,2DAA2D,CAAC;AACjG,OAAO,EAAE,kBAAkB,EAAE,MAAM,yCAAyC,CAAC;AAC7E,OAAO,EAAe,OAAO,EAAE,gBAAgB,EAAE,OAAO,EAAE,MAAM,6CAA6C,CAAC;AAC9G,OAAO,EAA0C,iBAAiB,EAAE,MAAM,0CAA0C,CAAC;AACrH,OAAO,EAAE,QAAQ,EAAE,MAAM,0BAA0B,CAAC;AACpD,OAAO,EAAE,MAAM,EAAE,MAAM,sDAAsD,CAAC;AAC9E,OAAO,EAAE,qBAAqB,EAAE,MAAM,kEAAkE,CAAC;AACzG,OAAO,EAAE,qBAAqB,EAAE,MAAM,kEAAkE,CAAC;AACzG,OAAO,EAAE,0BAA0B,EAAE,MAAM,gBAAgB,CAAC;AAC5D,OAAO,EAAE,wCAAwC,EAAE,0CAA0C,EAAE,MAAM,cAAc,CAAC;AACpH,OAAO,EAAE,YAAY,EAAE,MAAM,oBAAoB,CAAC;AAElD,OAAO,EAAE,cAAc,EAAE,SAAS,EAAE,uBAAuB,EAAE,MAAM,qBAAqB,CAAC;AAElF,IAAM,kBAAkB,GAAxB,MAAM,kBAAmB,SAAQ,cAAc;IACrD,YACC,SAAwD,EACjC,oBAA2C,EAC3C,oBAA2C;QAElE,KAAK,CAAC,oBAAoB,EAAE,SAAS,EAAE,oBAAoB,CAAC,CAAC;QA+C7C,gBAAW,GAAG,OAAO,CAAC,IAAI,EAAE,MAAM,CAAC,EAAE;YACrD,MAAM,SAAS,GAAG,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;YAC9C,IAAI,CAAC,SAAS,EAAE,CAAC;gBAChB,OAAO,EAAE,CAAC;YACX,CAAC;YACD,MAAM,KAAK,GAAG,SAAS,CAAC,KAAK,CAAC;YAC9B,MAAM,SAAS,GAAG,KAAK,CAAC,IAAI,CAAC;YAE7B,MAAM,uBAAuB,GAAG,SAAS,CAAC,uBAAuB,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;YAC/E,MAAM,yBAAyB,GAAG,SAAS,CAAC,yBAAyB,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;YACnF,MAAM,mBAAmB,GAAG,IAAI,CAAC,mBAAmB,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;YAElE,MAAM,MAAM,GAA4B,EAAE,CAAC;YAC3C,KAAK,MAAM,iBAAiB,IAAI,KAAK,CAAC,kBAAkB,CAAC,IAAI,CAAC,MAAM,CAAC,EAAE,CAAC;gBAEvE,MAAM,KAAK,GAAG,iBAAiB,CAAC,SAAS,CAAC;gBAC1C,IAAI,CAAC,KAAK,EAAE,CAAC;oBACZ,SAAS;gBACV,CAAC;gBAED,MAAM,SAAS,GAAG,KAAK,CAAC,SAAS,CAAC,iBAAiB,CAAC,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;gBAClE,IAAI,CAAC,iBAAiB,CAAC,aAAa,IAAI,SAAS,IAAI,CAAC,yBAAyB,EAAE,CAAC;oBACjF,SAAS;gBACV,CAAC;gBAED,MAAM,eAAe,GAAG,CAAC,oBAAoB,CAAC,CAAC;gBAC/C,IAAI,YAAY,GAA+D,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC;gBAC5F,IAAI,SAAS,EAAE,CAAC;oBACf,eAAe,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC;gBACjC,CAAC;gBACD,IAAI,iBAAiB,KAAK,uBAAuB,EAAE,CAAC;oBACnD,eAAe,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC;oBAChC,YAAY,GAAG,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC;gBAC7B,CAAC;gBACD,eAAe,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;gBAE7B,MAAM,kBAAkB,GAAG,SAAS,CAAC,mBAAmB,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;gBAEtE,IAAI,kBAAkB,EAAE,CAAC;oBACxB,KAAK,MAAM,IAAI,IAAI,iBAAiB,CAAC,aAAa,CAAC,kBAAkB,CAAC,EAAE,CAAC;wBACxE,MAAM,KAAK,GAAG,IAAI,CAAC,UAAU,CAAC,gBAAgB,EAAE,CAAC;wBACjD,IAAI,KAAK,EAAE,CAAC;4BACX,MAAM,CAAC,IAAI,CAAC;gCACX,KAAK;gCACL,OAAO,EAAE;oCACR,SAAS,EAAE,wBAAwB;oCACnC,WAAW,EAAE,cAAc;oCAC3B,WAAW,EAAE,IAAI;iCACjB;6BACD,CAAC,CAAC;wBACJ,CAAC;wBAED,KAAK,MAAM,KAAK,IAAI,IAAI,CAAC,aAAa,EAAE,CAAC;4BACxC,IAAI,mBAAmB,IAAI,CAAC,KAAK,CAAC,UAAU,CAAC,OAAO,EAAE,EAAE,CAAC;gCACxD,MAAM,CAAC,IAAI,CAAC;oCACX,KAAK,EAAE,KAAK,CAAC,UAAU;oCACvB,OAAO,EAAE;wCACR,SAAS,EAAE,KAAK,CAAC,UAAU,CAAC,OAAO,EAAE,CAAC,CAAC,CAAC,mCAAmC,CAAC,CAAC,CAAC,6BAA6B;wCAC3G,WAAW,EAAE,cAAc;wCAC3B,eAAe,EAAE,IAAI;qCACrB;iCACD,CAAC,CAAC;4BACJ,CAAC;wBACF,CAAC;oBACF,CAAC;gBACF,CAAC;gBAED,MAAM,CAAC,IAAI,CAAC;oBACX,KAAK,EAAE,KAAK,CAAC,uBAAuB,EAAE;oBACtC,OAAO,EAAE;wBACR,eAAe,EAAE,IAAI;wBACrB,cAAc,EAAE,eAAe,CAAC,IAAI,CAAC,GAAG,CAAC;wBACzC,YAAY;wBACZ,eAAe,EAAE,KAAK,CAAC,eAAe,GAAG,SAAS,CAAC,YAAY,EAAE;wBACjE,WAAW,EAAE,cAAc;wBAC3B,OAAO,EAAE;4BACR,QAAQ,gCAAwB;4BAChC,KAAK,EAAE,EAAE,EAAE,EAAE,SAAS,CAAC,CAAC,CAAC,wCAAwC,CAAC,CAAC,CAAC,0CAA0C,EAAE;yBAChH;wBACD,aAAa,EAAE,iBAAiB,CAAC,aAAa,CAAC,CAAC,CAAC;4BAChD,QAAQ,EAAE,iBAAiB,CAAC,MAAM;4BAClC,KAAK,EAAE,EAAE,EAAE,EAAE,SAAS,CAAC,CAAC,CAAC,wCAAwC,CAAC,CAAC,CAAC,0CAA0C,EAAE;yBAChH,CAAC,CAAC,CAAC,SAAS;qBACb;iBACD,CAAC,CAAC;YACJ,CAAC;YACD,OAAO,MAAM,CAAC;QACf,CAAC,CAAC,CAAC;QApIF,IAAI,CAAC,SAAS,CACb,uBAAuB,CAAC,IAAI,EAAE,CAAC,SAAS,EAAE,SAAS,EAAE,EAAE,CAAC,SAAS,CAAC,CAClE,CAAC;QAEF,IAAI,CAAC,SAAS,CACb,oBAAoB,CAAC,cAAc,CAAC,SAAS,EAAE,MAAM,CAAC,gBAAgB,EAAE,IAAI,CAAC,YAAY,CAAC,KAAK,CAAC,CAChG,CAAC;QAEF,IAAI,CAAC,SAAS,CACb,gBAAgB,CAAC,CAAC,MAAM,EAAE,KAAK,EAAE,EAAE;YAClC,qCAAqC;YACrC,IAAI,IAAI,CAAC,iBAAiB,CAAC,IAAI,CAAC,MAAM,CAAC,EAAE,CAAC;gBACzC,KAAK,CAAC,GAAG,CAAC,IAAI,YAAY,CAAC,IAAI,CAAC,MAAM,EAAE,IAAI,CAAC,YAAY,CAAC,SAAS,EAAE;oBACpE,0BAA0B,EAAE,CAAC,KAAK,EAAE,MAAM,EAAE,EAAE,CAAC,EAAE;oBACjD,UAAU,EAAE,CAAC,IAAI,EAAE,MAAM,EAAE,EAAE,GAAG,MAAM,IAAI,kBAAkB,EAAE,CAAC,CAAC,CAAC;iBACjE,CAAC,CAAC,CAAC;YACL,CAAC;QACF,CAAC,CAAC,CACF,CAAC;QAEF,IAAI,CAAC,SAAS,CACb,OAAO,CAAC,MAAM,CAAC,EAAE;YAChB,8CAA8C;YAC9C,MAAM,EAAE,GAAG,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;YACvC,IAAI,CAAC,EAAE,EAAE,CAAC;gBACT,OAAO;YACR,CAAC;YACD,IAAI,CAAC,MAAM,CAAC,QAAQ,CAAC,EAAE,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC;YACpC,KAAK,CAAC,IAAI,CAAC,YAAY,CAAC,KAAK,EAAE,GAAG,oBAAoB,CAAC,QAAQ,CAAC,KAAM,EAAE,IAAM,CAAC,CAAC,CAAC,CAAC;YAElF,MAAM,mBAAmB,GAAG,EAAE,CAAC,mBAAmB,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;YAEhE,IAAI,IAAI,GAAqB,SAAS,CAAC;YACvC,IAAI,mBAAmB,EAAE,CAAC;gBACzB,MAAM,KAAK,GAAG,QAAQ,CAAC,KAAa,EAAE,IAAoB,EAAE,mBAAmB,KAAK,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,KAAK,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC,CAAC,EAAE,CAAC,KAAK,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC;gBACvI,MAAM,OAAO,GAAG,QAAQ,CAAC,KAAoB,EAAE,IAAsD,CAAC,CAAC;gBACvG,IAAI,GAAG,CAAC,CAAC,MAAM,EAAE,EAAE,KAAK,EAAE,OAAO,EAAE,EAAE,CAAC,KAAK,CAAC,CAAC,CAAC,IAAI,CAAC;YACpD,CAAC;YACD,KAAK,CAAC,IAAI,CAAC,YAAY,CAAC,WAAW,EAAE,GAAG,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;QAC/D,CAAC,CAAC,CACF,CAAC;QAEF,IAAI,CAAC,SAAS,CAAC,0BAA0B,CAAC,IAAI,CAAC,MAAM,EAAE,IAAI,CAAC,WAAW,CAAC,CAAC,CAAC;IAC3E,CAAC;CA0FD,CAAA;AA7IY,kBAAkB;IAG5B,WAAA,qBAAqB,CAAA;IACrB,WAAA,qBAAqB,CAAA;GAJX,kBAAkB,CA6I9B","file":"baseCodeEditorView.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { h, reset } from '../../../../../../base/browser/dom.js';\nimport { renderLabelWithIcons } from '../../../../../../base/browser/ui/iconLabel/iconLabels.js';\nimport { BugIndicatingError } from '../../../../../../base/common/errors.js';\nimport { IObservable, autorun, autorunWithStore, derived } from '../../../../../../base/common/observable.js';\nimport { IModelDeltaDecoration, MinimapPosition, OverviewRulerLane } from '../../../../../../editor/common/model.js';\nimport { localize } from '../../../../../../nls.js';\nimport { MenuId } from '../../../../../../platform/actions/common/actions.js';\nimport { IConfigurationService } from '../../../../../../platform/configuration/common/configuration.js';\nimport { IInstantiationService } from '../../../../../../platform/instantiation/common/instantiation.js';\nimport { applyObservableDecorations } from '../../utils.js';\nimport { handledConflictMinimapOverViewRulerColor, unhandledConflictMinimapOverViewRulerColor } from '../colors.js';\nimport { EditorGutter } from '../editorGutter.js';\nimport { MergeEditorViewModel } from '../viewModel.js';\nimport { CodeEditorView, TitleMenu, createSelectionsAutorun } from './codeEditorView.js';\n\nexport class BaseCodeEditorView extends CodeEditorView {\n\tconstructor(\n\t\tviewModel: IObservable<MergeEditorViewModel | undefined>,\n\t\t@IInstantiationService instantiationService: IInstantiationService,\n\t\t@IConfigurationService configurationService: IConfigurationService,\n\t) {\n\t\tsuper(instantiationService, viewModel, configurationService);\n\n\t\tthis._register(\n\t\t\tcreateSelectionsAutorun(this, (baseRange, viewModel) => baseRange)\n\t\t);\n\n\t\tthis._register(\n\t\t\tinstantiationService.createInstance(TitleMenu, MenuId.MergeBaseToolbar, this.htmlElements.title)\n\t\t);\n\n\t\tthis._register(\n\t\t\tautorunWithStore((reader, store) => {\n\t\t\t\t/** @description update checkboxes */\n\t\t\t\tif (this.checkboxesVisible.read(reader)) {\n\t\t\t\t\tstore.add(new EditorGutter(this.editor, this.htmlElements.gutterDiv, {\n\t\t\t\t\t\tgetIntersectingGutterItems: (range, reader) => [],\n\t\t\t\t\t\tcreateView: (item, target) => { throw new BugIndicatingError(); },\n\t\t\t\t\t}));\n\t\t\t\t}\n\t\t\t})\n\t\t);\n\n\t\tthis._register(\n\t\t\tautorun(reader => {\n\t\t\t\t/** @description update labels & text model */\n\t\t\t\tconst vm = this.viewModel.read(reader);\n\t\t\t\tif (!vm) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tthis.editor.setModel(vm.model.base);\n\t\t\t\treset(this.htmlElements.title, ...renderLabelWithIcons(localize('base', 'Base')));\n\n\t\t\t\tconst baseShowDiffAgainst = vm.baseShowDiffAgainst.read(reader);\n\n\t\t\t\tlet node: Node | undefined = undefined;\n\t\t\t\tif (baseShowDiffAgainst) {\n\t\t\t\t\tconst label = localize('compareWith', 'Comparing with {0}', baseShowDiffAgainst === 1 ? vm.model.input1.title : vm.model.input2.title);\n\t\t\t\t\tconst tooltip = localize('compareWithTooltip', 'Differences are highlighted with a background color.');\n\t\t\t\t\tnode = h('span', { title: tooltip }, [label]).root;\n\t\t\t\t}\n\t\t\t\treset(this.htmlElements.description, ...(node ? [node] : []));\n\t\t\t})\n\t\t);\n\n\t\tthis._register(applyObservableDecorations(this.editor, this.decorations));\n\t}\n\n\tprivate readonly decorations = derived(this, reader => {\n\t\tconst viewModel = this.viewModel.read(reader);\n\t\tif (!viewModel) {\n\t\t\treturn [];\n\t\t}\n\t\tconst model = viewModel.model;\n\t\tconst textModel = model.base;\n\n\t\tconst activeModifiedBaseRange = viewModel.activeModifiedBaseRange.read(reader);\n\t\tconst showNonConflictingChanges = viewModel.showNonConflictingChanges.read(reader);\n\t\tconst showDeletionMarkers = this.showDeletionMarkers.read(reader);\n\n\t\tconst result: IModelDeltaDecoration[] = [];\n\t\tfor (const modifiedBaseRange of model.modifiedBaseRanges.read(reader)) {\n\n\t\t\tconst range = modifiedBaseRange.baseRange;\n\t\t\tif (!range) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tconst isHandled = model.isHandled(modifiedBaseRange).read(reader);\n\t\t\tif (!modifiedBaseRange.isConflicting && isHandled && !showNonConflictingChanges) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tconst blockClassNames = ['merge-editor-block'];\n\t\t\tlet blockPadding: [top: number, right: number, bottom: number, left: number] = [0, 0, 0, 0];\n\t\t\tif (isHandled) {\n\t\t\t\tblockClassNames.push('handled');\n\t\t\t}\n\t\t\tif (modifiedBaseRange === activeModifiedBaseRange) {\n\t\t\t\tblockClassNames.push('focused');\n\t\t\t\tblockPadding = [0, 2, 0, 2];\n\t\t\t}\n\t\t\tblockClassNames.push('base');\n\n\t\t\tconst inputToDiffAgainst = viewModel.baseShowDiffAgainst.read(reader);\n\n\t\t\tif (inputToDiffAgainst) {\n\t\t\t\tfor (const diff of modifiedBaseRange.getInputDiffs(inputToDiffAgainst)) {\n\t\t\t\t\tconst range = diff.inputRange.toInclusiveRange();\n\t\t\t\t\tif (range) {\n\t\t\t\t\t\tresult.push({\n\t\t\t\t\t\t\trange,\n\t\t\t\t\t\t\toptions: {\n\t\t\t\t\t\t\t\tclassName: `merge-editor-diff base`,\n\t\t\t\t\t\t\t\tdescription: 'Merge Editor',\n\t\t\t\t\t\t\t\tisWholeLine: true,\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\tfor (const diff2 of diff.rangeMappings) {\n\t\t\t\t\t\tif (showDeletionMarkers || !diff2.inputRange.isEmpty()) {\n\t\t\t\t\t\t\tresult.push({\n\t\t\t\t\t\t\t\trange: diff2.inputRange,\n\t\t\t\t\t\t\t\toptions: {\n\t\t\t\t\t\t\t\t\tclassName: diff2.inputRange.isEmpty() ? `merge-editor-diff-empty-word base` : `merge-editor-diff-word base`,\n\t\t\t\t\t\t\t\t\tdescription: 'Merge Editor',\n\t\t\t\t\t\t\t\t\tshowIfCollapsed: true,\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tresult.push({\n\t\t\t\trange: range.toInclusiveRangeOrEmpty(),\n\t\t\t\toptions: {\n\t\t\t\t\tshowIfCollapsed: true,\n\t\t\t\t\tblockClassName: blockClassNames.join(' '),\n\t\t\t\t\tblockPadding,\n\t\t\t\t\tblockIsAfterEnd: range.startLineNumber > textModel.getLineCount(),\n\t\t\t\t\tdescription: 'Merge Editor',\n\t\t\t\t\tminimap: {\n\t\t\t\t\t\tposition: MinimapPosition.Gutter,\n\t\t\t\t\t\tcolor: { id: isHandled ? handledConflictMinimapOverViewRulerColor : unhandledConflictMinimapOverViewRulerColor },\n\t\t\t\t\t},\n\t\t\t\t\toverviewRuler: modifiedBaseRange.isConflicting ? {\n\t\t\t\t\t\tposition: OverviewRulerLane.Center,\n\t\t\t\t\t\tcolor: { id: isHandled ? handledConflictMinimapOverViewRulerColor : unhandledConflictMinimapOverViewRulerColor },\n\t\t\t\t\t} : undefined\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\treturn result;\n\t});\n}\n"]}