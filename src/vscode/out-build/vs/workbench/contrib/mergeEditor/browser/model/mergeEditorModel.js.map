{"version":3,"sources":["vs/workbench/contrib/mergeEditor/browser/model/mergeEditorModel.ts"],"names":[],"mappings":"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","file":"mergeEditorModel.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { CompareResult, equals } from '../../../../../base/common/arrays.js';\nimport { BugIndicatingError } from '../../../../../base/common/errors.js';\nimport { autorunHandleChanges, derived, IObservable, IReader, ISettableObservable, ITransaction, keepObserved, observableValue, transaction, waitForState } from '../../../../../base/common/observable.js';\nimport { URI } from '../../../../../base/common/uri.js';\nimport { Range } from '../../../../../editor/common/core/range.js';\nimport { ILanguageService } from '../../../../../editor/common/languages/language.js';\nimport { ITextModel } from '../../../../../editor/common/model.js';\nimport { localize } from '../../../../../nls.js';\nimport { IResourceUndoRedoElement, IUndoRedoService, UndoRedoElementType, UndoRedoGroup } from '../../../../../platform/undoRedo/common/undoRedo.js';\nimport { EditorModel } from '../../../../common/editor/editorModel.js';\nimport { IMergeDiffComputer } from './diffComputer.js';\nimport { MergeEditorLineRange } from './lineRange.js';\nimport { DetailedLineRangeMapping, DocumentLineRangeMap, DocumentRangeMap, LineRangeMapping } from './mapping.js';\nimport { TextModelDiffChangeReason, TextModelDiffs, TextModelDiffState } from './textModelDiffs.js';\nimport { MergeEditorTelemetry } from '../telemetry.js';\nimport { leftJoin } from '../utils.js';\nimport { InputNumber, ModifiedBaseRange, ModifiedBaseRangeState, ModifiedBaseRangeStateKind } from './modifiedBaseRange.js';\n\nexport interface InputData {\n\treadonly textModel: ITextModel;\n\treadonly title: string | undefined;\n\treadonly detail: string | undefined;\n\treadonly description: string | undefined;\n}\n\nexport class MergeEditorModel extends EditorModel {\n\tprivate readonly input1TextModelDiffs;\n\tprivate readonly input2TextModelDiffs;\n\tprivate readonly resultTextModelDiffs;\n\tpublic readonly modifiedBaseRanges;\n\n\tprivate readonly modifiedBaseRangeResultStates;\n\n\tprivate readonly resultSnapshot;\n\n\tconstructor(\n\t\treadonly base: ITextModel,\n\t\treadonly input1: InputData,\n\t\treadonly input2: InputData,\n\t\treadonly resultTextModel: ITextModel,\n\t\tprivate readonly diffComputer: IMergeDiffComputer,\n\t\tprivate readonly options: { resetResult: boolean },\n\t\tpublic readonly telemetry: MergeEditorTelemetry,\n\t\t@ILanguageService private readonly languageService: ILanguageService,\n\t\t@IUndoRedoService private readonly undoRedoService: IUndoRedoService,\n\t) {\n\t\tsuper();\n\t\tthis.input1TextModelDiffs = this._register(new TextModelDiffs(this.base, this.input1.textModel, this.diffComputer));\n\t\tthis.input2TextModelDiffs = this._register(new TextModelDiffs(this.base, this.input2.textModel, this.diffComputer));\n\t\tthis.resultTextModelDiffs = this._register(new TextModelDiffs(this.base, this.resultTextModel, this.diffComputer));\n\t\tthis.modifiedBaseRanges = derived<ModifiedBaseRange[]>(this, (reader) => {\n\t\t\tconst input1Diffs = this.input1TextModelDiffs.diffs.read(reader);\n\t\t\tconst input2Diffs = this.input2TextModelDiffs.diffs.read(reader);\n\t\t\treturn ModifiedBaseRange.fromDiffs(input1Diffs, input2Diffs, this.base, this.input1.textModel, this.input2.textModel);\n\t\t});\n\t\tthis.modifiedBaseRangeResultStates = derived(this, reader => {\n\t\t\tconst map = new Map<ModifiedBaseRange, ModifiedBaseRangeData>(\n\t\t\t\tthis.modifiedBaseRanges.read(reader).map<[ModifiedBaseRange, ModifiedBaseRangeData]>((s) => [\n\t\t\t\t\ts, new ModifiedBaseRangeData(s)\n\t\t\t\t])\n\t\t\t);\n\t\t\treturn map;\n\t\t});\n\t\tthis.resultSnapshot = this.resultTextModel.createSnapshot();\n\t\tthis.baseInput1Diffs = this.input1TextModelDiffs.diffs;\n\t\tthis.baseInput2Diffs = this.input2TextModelDiffs.diffs;\n\t\tthis.baseResultDiffs = this.resultTextModelDiffs.diffs;\n\t\tthis.input1ResultMapping = derived(this, reader => {\n\t\t\treturn this.getInputResultMapping(\n\t\t\t\tthis.baseInput1Diffs.read(reader),\n\t\t\t\tthis.baseResultDiffs.read(reader),\n\t\t\t\tthis.input1.textModel.getLineCount(),\n\t\t\t);\n\t\t});\n\t\tthis.resultInput1Mapping = derived(this, reader => this.input1ResultMapping.read(reader).reverse());\n\t\tthis.input2ResultMapping = derived(this, reader => {\n\t\t\treturn this.getInputResultMapping(\n\t\t\t\tthis.baseInput2Diffs.read(reader),\n\t\t\t\tthis.baseResultDiffs.read(reader),\n\t\t\t\tthis.input2.textModel.getLineCount(),\n\t\t\t);\n\t\t});\n\t\tthis.resultInput2Mapping = derived(this, reader => this.input2ResultMapping.read(reader).reverse());\n\t\tthis.baseResultMapping = derived(this, reader => {\n\t\t\tconst map = new DocumentLineRangeMap(this.baseResultDiffs.read(reader), -1);\n\t\t\treturn new DocumentLineRangeMap(\n\t\t\t\tmap.lineRangeMappings.map((m) =>\n\t\t\t\t\tm.inputRange.isEmpty || m.outputRange.isEmpty\n\t\t\t\t\t\t? new LineRangeMapping(\n\t\t\t\t\t\t\t// We can do this because two adjacent diffs have one line in between.\n\t\t\t\t\t\t\tm.inputRange.deltaStart(-1),\n\t\t\t\t\t\t\tm.outputRange.deltaStart(-1)\n\t\t\t\t\t\t)\n\t\t\t\t\t\t: m\n\t\t\t\t),\n\t\t\t\tmap.inputLineCount\n\t\t\t);\n\t\t});\n\t\tthis.resultBaseMapping = derived(this, reader => this.baseResultMapping.read(reader).reverse());\n\t\tthis.diffComputingState = derived(this, reader => {\n\t\t\tconst states = [\n\t\t\t\tthis.input1TextModelDiffs,\n\t\t\t\tthis.input2TextModelDiffs,\n\t\t\t\tthis.resultTextModelDiffs,\n\t\t\t].map((s) => s.state.read(reader));\n\n\t\t\tif (states.some((s) => s === TextModelDiffState.initializing)) {\n\t\t\t\treturn MergeEditorModelState.initializing;\n\t\t\t}\n\t\t\tif (states.some((s) => s === TextModelDiffState.updating)) {\n\t\t\t\treturn MergeEditorModelState.updating;\n\t\t\t}\n\t\t\treturn MergeEditorModelState.upToDate;\n\t\t});\n\t\tthis.inputDiffComputingState = derived(this, reader => {\n\t\t\tconst states = [\n\t\t\t\tthis.input1TextModelDiffs,\n\t\t\t\tthis.input2TextModelDiffs,\n\t\t\t].map((s) => s.state.read(reader));\n\n\t\t\tif (states.some((s) => s === TextModelDiffState.initializing)) {\n\t\t\t\treturn MergeEditorModelState.initializing;\n\t\t\t}\n\t\t\tif (states.some((s) => s === TextModelDiffState.updating)) {\n\t\t\t\treturn MergeEditorModelState.updating;\n\t\t\t}\n\t\t\treturn MergeEditorModelState.upToDate;\n\t\t});\n\t\tthis.isUpToDate = derived(this, reader => this.diffComputingState.read(reader) === MergeEditorModelState.upToDate);\n\n\t\tthis.firstRun = true;\n\t\tthis.unhandledConflictsCount = derived(this, reader => {\n\t\t\tconst map = this.modifiedBaseRangeResultStates.read(reader);\n\t\t\tlet unhandledCount = 0;\n\t\t\tfor (const [_key, value] of map) {\n\t\t\t\tif (!value.handled.read(reader)) {\n\t\t\t\t\tunhandledCount++;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn unhandledCount;\n\t\t});\n\t\tthis.hasUnhandledConflicts = this.unhandledConflictsCount.map(value => /** @description hasUnhandledConflicts */ value > 0);\n\n\t\tthis._register(keepObserved(this.modifiedBaseRangeResultStates));\n\t\tthis._register(keepObserved(this.input1ResultMapping));\n\t\tthis._register(keepObserved(this.input2ResultMapping));\n\n\t\tconst initializePromise = this.initialize();\n\n\t\tthis.onInitialized = waitForState(this.diffComputingState, state => state === MergeEditorModelState.upToDate).then(async () => {\n\t\t\tawait initializePromise;\n\t\t});\n\n\t\tinitializePromise.then(() => {\n\t\t\tlet shouldRecomputeHandledFromAccepted = true;\n\t\t\tthis._register(\n\t\t\t\tautorunHandleChanges(\n\t\t\t\t\t{\n\t\t\t\t\t\tchangeTracker: {\n\t\t\t\t\t\t\tcreateChangeSummary: () => undefined,\n\t\t\t\t\t\t\thandleChange: (ctx) => {\n\t\t\t\t\t\t\t\tif (ctx.didChange(this.modifiedBaseRangeResultStates)) {\n\t\t\t\t\t\t\t\t\tshouldRecomputeHandledFromAccepted = true;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\treturn ctx.didChange(this.resultTextModelDiffs.diffs)\n\t\t\t\t\t\t\t\t\t// Ignore non-text changes as we update the state directly\n\t\t\t\t\t\t\t\t\t? ctx.change === TextModelDiffChangeReason.textChange\n\t\t\t\t\t\t\t\t\t: true;\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\t(reader) => {\n\t\t\t\t\t\t/** @description Merge Editor Model: Recompute State From Result */\n\t\t\t\t\t\tconst states = this.modifiedBaseRangeResultStates.read(reader);\n\t\t\t\t\t\tif (!this.isUpToDate.read(reader)) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tconst resultDiffs = this.resultTextModelDiffs.diffs.read(reader);\n\t\t\t\t\t\ttransaction(tx => {\n\t\t\t\t\t\t\t/** @description Merge Editor Model: Recompute State */\n\n\t\t\t\t\t\t\tthis.updateBaseRangeAcceptedState(resultDiffs, states, tx);\n\n\t\t\t\t\t\t\tif (shouldRecomputeHandledFromAccepted) {\n\t\t\t\t\t\t\t\tshouldRecomputeHandledFromAccepted = false;\n\t\t\t\t\t\t\t\tfor (const [_range, observableState] of states) {\n\t\t\t\t\t\t\t\t\tconst state = observableState.accepted.read(undefined);\n\t\t\t\t\t\t\t\t\tconst handled = !(state.kind === ModifiedBaseRangeStateKind.base || state.kind === ModifiedBaseRangeStateKind.unrecognized);\n\t\t\t\t\t\t\t\t\tobservableState.handledInput1.set(handled, tx);\n\t\t\t\t\t\t\t\t\tobservableState.handledInput2.set(handled, tx);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t)\n\t\t\t);\n\t\t});\n\t}\n\n\tprivate async initialize(): Promise<void> {\n\t\tif (this.options.resetResult) {\n\t\t\tawait this.reset();\n\t\t}\n\t}\n\n\tpublic async reset(): Promise<void> {\n\t\tawait waitForState(this.inputDiffComputingState, state => state === MergeEditorModelState.upToDate);\n\t\tconst states = this.modifiedBaseRangeResultStates.get();\n\n\t\ttransaction(tx => {\n\t\t\t/** @description Set initial state */\n\n\t\t\tfor (const [range, state] of states) {\n\t\t\t\tlet newState: ModifiedBaseRangeState;\n\t\t\t\tlet handled = false;\n\t\t\t\tif (range.input1Diffs.length === 0) {\n\t\t\t\t\tnewState = ModifiedBaseRangeState.base.withInputValue(2, true);\n\t\t\t\t\thandled = true;\n\t\t\t\t} else if (range.input2Diffs.length === 0) {\n\t\t\t\t\tnewState = ModifiedBaseRangeState.base.withInputValue(1, true);\n\t\t\t\t\thandled = true;\n\t\t\t\t} else if (range.isEqualChange) {\n\t\t\t\t\tnewState = ModifiedBaseRangeState.base.withInputValue(1, true);\n\t\t\t\t\thandled = true;\n\t\t\t\t} else {\n\t\t\t\t\tnewState = ModifiedBaseRangeState.base;\n\t\t\t\t\thandled = false;\n\t\t\t\t}\n\n\t\t\t\tstate.accepted.set(newState, tx);\n\t\t\t\tstate.computedFromDiffing = false;\n\t\t\t\tstate.previousNonDiffingState = undefined;\n\t\t\t\tstate.handledInput1.set(handled, tx);\n\t\t\t\tstate.handledInput2.set(handled, tx);\n\t\t\t}\n\n\t\t\tthis.resultTextModel.pushEditOperations(null, [{\n\t\t\t\trange: new Range(1, 1, Number.MAX_SAFE_INTEGER, 1),\n\t\t\t\ttext: this.computeAutoMergedResult()\n\t\t\t}], () => null);\n\t\t});\n\t}\n\n\tprivate computeAutoMergedResult(): string {\n\t\tconst baseRanges = this.modifiedBaseRanges.get();\n\n\t\tconst baseLines = this.base.getLinesContent();\n\t\tconst input1Lines = this.input1.textModel.getLinesContent();\n\t\tconst input2Lines = this.input2.textModel.getLinesContent();\n\n\t\tconst resultLines: string[] = [];\n\t\tfunction appendLinesToResult(source: string[], lineRange: MergeEditorLineRange) {\n\t\t\tfor (let i = lineRange.startLineNumber; i < lineRange.endLineNumberExclusive; i++) {\n\t\t\t\tresultLines.push(source[i - 1]);\n\t\t\t}\n\t\t}\n\n\t\tlet baseStartLineNumber = 1;\n\n\t\tfor (const baseRange of baseRanges) {\n\t\t\tappendLinesToResult(baseLines, MergeEditorLineRange.fromLineNumbers(baseStartLineNumber, baseRange.baseRange.startLineNumber));\n\t\t\tbaseStartLineNumber = baseRange.baseRange.endLineNumberExclusive;\n\n\t\t\tif (baseRange.input1Diffs.length === 0) {\n\t\t\t\tappendLinesToResult(input2Lines, baseRange.input2Range);\n\t\t\t} else if (baseRange.input2Diffs.length === 0) {\n\t\t\t\tappendLinesToResult(input1Lines, baseRange.input1Range);\n\t\t\t} else if (baseRange.isEqualChange) {\n\t\t\t\tappendLinesToResult(input1Lines, baseRange.input1Range);\n\t\t\t} else {\n\t\t\t\tappendLinesToResult(baseLines, baseRange.baseRange);\n\t\t\t}\n\t\t}\n\n\t\tappendLinesToResult(baseLines, MergeEditorLineRange.fromLineNumbers(baseStartLineNumber, baseLines.length + 1));\n\n\t\treturn resultLines.join(this.resultTextModel.getEOL());\n\t}\n\n\tpublic hasBaseRange(baseRange: ModifiedBaseRange): boolean {\n\t\treturn this.modifiedBaseRangeResultStates.get().has(baseRange);\n\t}\n\n\tpublic readonly baseInput1Diffs;\n\n\tpublic readonly baseInput2Diffs;\n\tpublic readonly baseResultDiffs;\n\tpublic get isApplyingEditInResult(): boolean { return this.resultTextModelDiffs.isApplyingChange; }\n\tpublic readonly input1ResultMapping;\n\n\tpublic readonly resultInput1Mapping;\n\n\tpublic readonly input2ResultMapping;\n\n\tpublic readonly resultInput2Mapping;\n\n\tprivate getInputResultMapping(inputLinesDiffs: DetailedLineRangeMapping[], resultDiffs: DetailedLineRangeMapping[], inputLineCount: number) {\n\t\tconst map = DocumentLineRangeMap.betweenOutputs(inputLinesDiffs, resultDiffs, inputLineCount);\n\t\treturn new DocumentLineRangeMap(\n\t\t\tmap.lineRangeMappings.map((m) =>\n\t\t\t\tm.inputRange.isEmpty || m.outputRange.isEmpty\n\t\t\t\t\t? new LineRangeMapping(\n\t\t\t\t\t\t// We can do this because two adjacent diffs have one line in between.\n\t\t\t\t\t\tm.inputRange.deltaStart(-1),\n\t\t\t\t\t\tm.outputRange.deltaStart(-1)\n\t\t\t\t\t)\n\t\t\t\t\t: m\n\t\t\t),\n\t\t\tmap.inputLineCount\n\t\t);\n\t}\n\n\tpublic readonly baseResultMapping;\n\n\tpublic readonly resultBaseMapping;\n\n\tpublic translateInputRangeToBase(input: 1 | 2, range: Range): Range {\n\t\tconst baseInputDiffs = input === 1 ? this.baseInput1Diffs.get() : this.baseInput2Diffs.get();\n\t\tconst map = new DocumentRangeMap(baseInputDiffs.flatMap(d => d.rangeMappings), 0).reverse();\n\t\treturn map.projectRange(range).outputRange;\n\t}\n\n\tpublic translateBaseRangeToInput(input: 1 | 2, range: Range): Range {\n\t\tconst baseInputDiffs = input === 1 ? this.baseInput1Diffs.get() : this.baseInput2Diffs.get();\n\t\tconst map = new DocumentRangeMap(baseInputDiffs.flatMap(d => d.rangeMappings), 0);\n\t\treturn map.projectRange(range).outputRange;\n\t}\n\n\tpublic getLineRangeInResult(baseRange: MergeEditorLineRange, reader?: IReader): MergeEditorLineRange {\n\t\treturn this.resultTextModelDiffs.getResultLineRange(baseRange, reader);\n\t}\n\n\tpublic translateResultRangeToBase(range: Range): Range {\n\t\tconst map = new DocumentRangeMap(this.baseResultDiffs.get().flatMap(d => d.rangeMappings), 0).reverse();\n\t\treturn map.projectRange(range).outputRange;\n\t}\n\n\tpublic translateBaseRangeToResult(range: Range): Range {\n\t\tconst map = new DocumentRangeMap(this.baseResultDiffs.get().flatMap(d => d.rangeMappings), 0);\n\t\treturn map.projectRange(range).outputRange;\n\t}\n\n\tpublic findModifiedBaseRangesInRange(rangeInBase: MergeEditorLineRange): ModifiedBaseRange[] {\n\t\t// TODO use binary search\n\t\treturn this.modifiedBaseRanges.get().filter(r => r.baseRange.intersectsOrTouches(rangeInBase));\n\t}\n\n\tpublic readonly diffComputingState;\n\n\tpublic readonly inputDiffComputingState;\n\n\tpublic readonly isUpToDate;\n\n\tpublic readonly onInitialized;\n\n\tprivate firstRun;\n\tprivate updateBaseRangeAcceptedState(resultDiffs: DetailedLineRangeMapping[], states: Map<ModifiedBaseRange, ModifiedBaseRangeData>, tx: ITransaction): void {\n\t\tconst baseRangeWithStoreAndTouchingDiffs = leftJoin(\n\t\t\tstates,\n\t\t\tresultDiffs,\n\t\t\t(baseRange, diff) =>\n\t\t\t\tbaseRange[0].baseRange.intersectsOrTouches(diff.inputRange)\n\t\t\t\t\t? CompareResult.neitherLessOrGreaterThan\n\t\t\t\t\t: MergeEditorLineRange.compareByStart(\n\t\t\t\t\t\tbaseRange[0].baseRange,\n\t\t\t\t\t\tdiff.inputRange\n\t\t\t\t\t)\n\t\t);\n\n\t\tfor (const row of baseRangeWithStoreAndTouchingDiffs) {\n\t\t\tconst newState = this.computeState(row.left[0], row.rights);\n\t\t\tconst data = row.left[1];\n\t\t\tconst oldState = data.accepted.get();\n\t\t\tif (!oldState.equals(newState)) {\n\t\t\t\tif (!this.firstRun && !data.computedFromDiffing) {\n\t\t\t\t\t// Don't set this on the first run - the first run might be used to restore state.\n\t\t\t\t\tdata.computedFromDiffing = true;\n\t\t\t\t\tdata.previousNonDiffingState = oldState;\n\t\t\t\t}\n\t\t\t\tdata.accepted.set(newState, tx);\n\t\t\t}\n\t\t}\n\n\t\tif (this.firstRun) {\n\t\t\tthis.firstRun = false;\n\t\t}\n\t}\n\n\tprivate computeState(baseRange: ModifiedBaseRange, conflictingDiffs: DetailedLineRangeMapping[]): ModifiedBaseRangeState {\n\t\tif (conflictingDiffs.length === 0) {\n\t\t\treturn ModifiedBaseRangeState.base;\n\t\t}\n\t\tconst conflictingEdits = conflictingDiffs.map((d) => d.getLineEdit());\n\n\t\tfunction editsAgreeWithDiffs(diffs: readonly DetailedLineRangeMapping[]): boolean {\n\t\t\treturn equals(\n\t\t\t\tconflictingEdits,\n\t\t\t\tdiffs.map((d) => d.getLineEdit()),\n\t\t\t\t(a, b) => a.equals(b)\n\t\t\t);\n\t\t}\n\n\t\tif (editsAgreeWithDiffs(baseRange.input1Diffs)) {\n\t\t\treturn ModifiedBaseRangeState.base.withInputValue(1, true);\n\t\t}\n\t\tif (editsAgreeWithDiffs(baseRange.input2Diffs)) {\n\t\t\treturn ModifiedBaseRangeState.base.withInputValue(2, true);\n\t\t}\n\n\t\tconst states = [\n\t\t\tModifiedBaseRangeState.base.withInputValue(1, true).withInputValue(2, true, true),\n\t\t\tModifiedBaseRangeState.base.withInputValue(2, true).withInputValue(1, true, true),\n\t\t\tModifiedBaseRangeState.base.withInputValue(1, true).withInputValue(2, true, false),\n\t\t\tModifiedBaseRangeState.base.withInputValue(2, true).withInputValue(1, true, false),\n\t\t];\n\n\t\tfor (const s of states) {\n\t\t\tconst { edit } = baseRange.getEditForBase(s);\n\t\t\tif (edit) {\n\t\t\t\tconst resultRange = this.resultTextModelDiffs.getResultLineRange(baseRange.baseRange);\n\t\t\t\tconst existingLines = resultRange.getLines(this.resultTextModel);\n\n\t\t\t\tif (equals(edit.newLines, existingLines, (a, b) => a === b)) {\n\t\t\t\t\treturn s;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn ModifiedBaseRangeState.unrecognized;\n\t}\n\n\tpublic getState(baseRange: ModifiedBaseRange): IObservable<ModifiedBaseRangeState> {\n\t\tconst existingState = this.modifiedBaseRangeResultStates.get().get(baseRange);\n\t\tif (!existingState) {\n\t\t\tthrow new BugIndicatingError('object must be from this instance');\n\t\t}\n\t\treturn existingState.accepted;\n\t}\n\n\tpublic setState(\n\t\tbaseRange: ModifiedBaseRange,\n\t\tstate: ModifiedBaseRangeState,\n\t\t_markInputAsHandled: boolean | InputNumber,\n\t\ttx: ITransaction,\n\t\t_pushStackElement: boolean = false\n\t): void {\n\t\tif (!this.isUpToDate.get()) {\n\t\t\tthrow new BugIndicatingError('Cannot set state while updating');\n\t\t}\n\n\t\tconst existingState = this.modifiedBaseRangeResultStates.get().get(baseRange);\n\t\tif (!existingState) {\n\t\t\tthrow new BugIndicatingError('object must be from this instance');\n\t\t}\n\n\t\tconst conflictingDiffs = this.resultTextModelDiffs.findTouchingDiffs(\n\t\t\tbaseRange.baseRange\n\t\t);\n\t\tconst group = new UndoRedoGroup();\n\t\tif (conflictingDiffs) {\n\t\t\tthis.resultTextModelDiffs.removeDiffs(conflictingDiffs, tx, group);\n\t\t}\n\n\t\tconst { edit, effectiveState } = baseRange.getEditForBase(state);\n\n\t\texistingState.accepted.set(effectiveState, tx);\n\t\texistingState.previousNonDiffingState = undefined;\n\t\texistingState.computedFromDiffing = false;\n\n\t\tconst input1Handled = existingState.handledInput1.get();\n\t\tconst input2Handled = existingState.handledInput2.get();\n\n\t\tif (!input1Handled || !input2Handled) {\n\t\t\tthis.undoRedoService.pushElement(\n\t\t\t\tnew MarkAsHandledUndoRedoElement(this.resultTextModel.uri, new WeakRef(this), new WeakRef(existingState), input1Handled, input2Handled),\n\t\t\t\tgroup\n\t\t\t);\n\t\t}\n\n\t\tif (edit) {\n\t\t\tthis.resultTextModel.pushStackElement();\n\t\t\tthis.resultTextModelDiffs.applyEditRelativeToOriginal(edit, tx, group);\n\t\t\tthis.resultTextModel.pushStackElement();\n\t\t}\n\n\t\t// always set conflict as handled\n\t\texistingState.handledInput1.set(true, tx);\n\t\texistingState.handledInput2.set(true, tx);\n\t}\n\n\tpublic resetDirtyConflictsToBase(): void {\n\t\ttransaction(tx => {\n\t\t\t/** @description Reset Unknown Base Range States */\n\t\t\tthis.resultTextModel.pushStackElement();\n\t\t\tfor (const range of this.modifiedBaseRanges.get()) {\n\t\t\t\tif (this.getState(range).get().kind === ModifiedBaseRangeStateKind.unrecognized) {\n\t\t\t\t\tthis.setState(range, ModifiedBaseRangeState.base, false, tx, false);\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis.resultTextModel.pushStackElement();\n\t\t});\n\t}\n\n\tpublic isHandled(baseRange: ModifiedBaseRange): IObservable<boolean> {\n\t\treturn this.modifiedBaseRangeResultStates.get().get(baseRange)!.handled;\n\t}\n\n\tpublic isInputHandled(baseRange: ModifiedBaseRange, inputNumber: InputNumber): IObservable<boolean> {\n\t\tconst state = this.modifiedBaseRangeResultStates.get().get(baseRange)!;\n\t\treturn inputNumber === 1 ? state.handledInput1 : state.handledInput2;\n\t}\n\n\tpublic setInputHandled(baseRange: ModifiedBaseRange, inputNumber: InputNumber, handled: boolean, tx: ITransaction): void {\n\t\tconst state = this.modifiedBaseRangeResultStates.get().get(baseRange)!;\n\t\tif (state.handled.get() === handled) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst dataRef = new WeakRef(ModifiedBaseRangeData);\n\t\tconst modelRef = new WeakRef(this);\n\n\t\tthis.undoRedoService.pushElement({\n\t\t\ttype: UndoRedoElementType.Resource,\n\t\t\tresource: this.resultTextModel.uri,\n\t\t\tcode: 'setInputHandled',\n\t\t\tlabel: localize('setInputHandled', \"Set Input Handled\"),\n\t\t\tredo() {\n\t\t\t\tconst model = modelRef.deref();\n\t\t\t\tconst data = dataRef.deref();\n\t\t\t\tif (model && !model.isDisposed() && data) {\n\t\t\t\t\ttransaction(tx => {\n\t\t\t\t\t\tif (inputNumber === 1) {\n\t\t\t\t\t\t\tstate.handledInput1.set(handled, tx);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tstate.handledInput2.set(handled, tx);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t},\n\t\t\tundo() {\n\t\t\t\tconst model = modelRef.deref();\n\t\t\t\tconst data = dataRef.deref();\n\t\t\t\tif (model && !model.isDisposed() && data) {\n\t\t\t\t\ttransaction(tx => {\n\t\t\t\t\t\tif (inputNumber === 1) {\n\t\t\t\t\t\t\tstate.handledInput1.set(!handled, tx);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tstate.handledInput2.set(!handled, tx);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t},\n\t\t});\n\n\t\tif (inputNumber === 1) {\n\t\t\tstate.handledInput1.set(handled, tx);\n\t\t} else {\n\t\t\tstate.handledInput2.set(handled, tx);\n\t\t}\n\t}\n\n\tpublic setHandled(baseRange: ModifiedBaseRange, handled: boolean, tx: ITransaction): void {\n\t\tconst state = this.modifiedBaseRangeResultStates.get().get(baseRange)!;\n\t\tif (state.handled.get() === handled) {\n\t\t\treturn;\n\t\t}\n\n\t\tstate.handledInput1.set(handled, tx);\n\t\tstate.handledInput2.set(handled, tx);\n\t}\n\n\tpublic readonly unhandledConflictsCount;\n\n\tpublic readonly hasUnhandledConflicts;\n\n\tpublic setLanguageId(languageId: string, source?: string): void {\n\t\tconst language = this.languageService.createById(languageId);\n\t\tthis.base.setLanguage(language, source);\n\t\tthis.input1.textModel.setLanguage(language, source);\n\t\tthis.input2.textModel.setLanguage(language, source);\n\t\tthis.resultTextModel.setLanguage(language, source);\n\t}\n\n\tpublic getInitialResultValue(): string {\n\t\tconst chunks: string[] = [];\n\t\twhile (true) {\n\t\t\tconst chunk = this.resultSnapshot.read();\n\t\t\tif (chunk === null) {\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tchunks.push(chunk);\n\t\t}\n\t\treturn chunks.join();\n\t}\n\n\tpublic async getResultValueWithConflictMarkers(): Promise<string> {\n\t\tawait waitForState(this.diffComputingState, state => state === MergeEditorModelState.upToDate);\n\n\t\tif (this.unhandledConflictsCount.get() === 0) {\n\t\t\treturn this.resultTextModel.getValue();\n\t\t}\n\n\t\tconst resultLines = this.resultTextModel.getLinesContent();\n\t\tconst input1Lines = this.input1.textModel.getLinesContent();\n\t\tconst input2Lines = this.input2.textModel.getLinesContent();\n\n\t\tconst states = this.modifiedBaseRangeResultStates.get();\n\n\t\tconst outputLines: string[] = [];\n\t\tfunction appendLinesToResult(source: string[], lineRange: MergeEditorLineRange) {\n\t\t\tfor (let i = lineRange.startLineNumber; i < lineRange.endLineNumberExclusive; i++) {\n\t\t\t\toutputLines.push(source[i - 1]);\n\t\t\t}\n\t\t}\n\n\t\tlet resultStartLineNumber = 1;\n\n\t\tfor (const [range, state] of states) {\n\t\t\tif (state.handled.get()) {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tconst resultRange = this.resultTextModelDiffs.getResultLineRange(range.baseRange);\n\n\t\t\tappendLinesToResult(resultLines, MergeEditorLineRange.fromLineNumbers(resultStartLineNumber, Math.max(resultStartLineNumber, resultRange.startLineNumber)));\n\t\t\tresultStartLineNumber = resultRange.endLineNumberExclusive;\n\n\t\t\toutputLines.push('<<<<<<<');\n\t\t\tif (state.accepted.get().kind === ModifiedBaseRangeStateKind.unrecognized) {\n\t\t\t\t// to prevent loss of data, use modified result as \"ours\"\n\t\t\t\tappendLinesToResult(resultLines, resultRange);\n\t\t\t} else {\n\t\t\t\tappendLinesToResult(input1Lines, range.input1Range);\n\t\t\t}\n\t\t\toutputLines.push('=======');\n\t\t\tappendLinesToResult(input2Lines, range.input2Range);\n\t\t\toutputLines.push('>>>>>>>');\n\t\t}\n\n\t\tappendLinesToResult(resultLines, MergeEditorLineRange.fromLineNumbers(resultStartLineNumber, resultLines.length + 1));\n\t\treturn outputLines.join('\\n');\n\t}\n\n\tpublic get conflictCount(): number {\n\t\treturn arrayCount(this.modifiedBaseRanges.get(), r => r.isConflicting);\n\t}\n\tpublic get combinableConflictCount(): number {\n\t\treturn arrayCount(this.modifiedBaseRanges.get(), r => r.isConflicting && r.canBeCombined);\n\t}\n\n\tpublic get conflictsResolvedWithBase(): number {\n\t\treturn arrayCount(\n\t\t\tthis.modifiedBaseRangeResultStates.get().entries(),\n\t\t\t([r, s]) =>\n\t\t\t\tr.isConflicting &&\n\t\t\t\ts.accepted.get().kind === ModifiedBaseRangeStateKind.base\n\t\t);\n\t}\n\tpublic get conflictsResolvedWithInput1(): number {\n\t\treturn arrayCount(\n\t\t\tthis.modifiedBaseRangeResultStates.get().entries(),\n\t\t\t([r, s]) =>\n\t\t\t\tr.isConflicting &&\n\t\t\t\ts.accepted.get().kind === ModifiedBaseRangeStateKind.input1\n\t\t);\n\t}\n\tpublic get conflictsResolvedWithInput2(): number {\n\t\treturn arrayCount(\n\t\t\tthis.modifiedBaseRangeResultStates.get().entries(),\n\t\t\t([r, s]) =>\n\t\t\t\tr.isConflicting &&\n\t\t\t\ts.accepted.get().kind === ModifiedBaseRangeStateKind.input2\n\t\t);\n\t}\n\tpublic get conflictsResolvedWithSmartCombination(): number {\n\t\treturn arrayCount(\n\t\t\tthis.modifiedBaseRangeResultStates.get().entries(),\n\t\t\t([r, s]: [ModifiedBaseRange, ModifiedBaseRangeData]) => {\n\t\t\t\tconst state = s.accepted.get();\n\t\t\t\treturn r.isConflicting && state.kind === ModifiedBaseRangeStateKind.both && state.smartCombination;\n\t\t\t}\n\t\t);\n\t}\n\n\tpublic get manuallySolvedConflictCountThatEqualNone(): number {\n\t\treturn arrayCount(\n\t\t\tthis.modifiedBaseRangeResultStates.get().entries(),\n\t\t\t([r, s]) =>\n\t\t\t\tr.isConflicting &&\n\t\t\t\ts.accepted.get().kind === ModifiedBaseRangeStateKind.unrecognized\n\t\t);\n\t}\n\tpublic get manuallySolvedConflictCountThatEqualSmartCombine(): number {\n\t\treturn arrayCount(\n\t\t\tthis.modifiedBaseRangeResultStates.get().entries(),\n\t\t\t([r, s]: [ModifiedBaseRange, ModifiedBaseRangeData]) => {\n\t\t\t\tconst state = s.accepted.get();\n\t\t\t\treturn r.isConflicting && s.computedFromDiffing && state.kind === ModifiedBaseRangeStateKind.both && state.smartCombination;\n\t\t\t}\n\t\t);\n\t}\n\tpublic get manuallySolvedConflictCountThatEqualInput1(): number {\n\t\treturn arrayCount(\n\t\t\tthis.modifiedBaseRangeResultStates.get().entries(),\n\t\t\t([r, s]: [ModifiedBaseRange, ModifiedBaseRangeData]) => {\n\t\t\t\tconst state = s.accepted.get();\n\t\t\t\treturn r.isConflicting && s.computedFromDiffing && state.kind === ModifiedBaseRangeStateKind.input1;\n\t\t\t}\n\t\t);\n\t}\n\tpublic get manuallySolvedConflictCountThatEqualInput2(): number {\n\t\treturn arrayCount(\n\t\t\tthis.modifiedBaseRangeResultStates.get().entries(),\n\t\t\t([r, s]: [ModifiedBaseRange, ModifiedBaseRangeData]) => {\n\t\t\t\tconst state = s.accepted.get();\n\t\t\t\treturn r.isConflicting && s.computedFromDiffing && state.kind === ModifiedBaseRangeStateKind.input2;\n\t\t\t}\n\t\t);\n\t}\n\n\tpublic get manuallySolvedConflictCountThatEqualNoneAndStartedWithBase(): number {\n\t\treturn arrayCount(\n\t\t\tthis.modifiedBaseRangeResultStates.get().entries(),\n\t\t\t([r, s]: [ModifiedBaseRange, ModifiedBaseRangeData]) => {\n\t\t\t\tconst state = s.accepted.get();\n\t\t\t\treturn r.isConflicting && state.kind === ModifiedBaseRangeStateKind.unrecognized && s.previousNonDiffingState?.kind === ModifiedBaseRangeStateKind.base;\n\t\t\t}\n\t\t);\n\t}\n\tpublic get manuallySolvedConflictCountThatEqualNoneAndStartedWithInput1(): number {\n\t\treturn arrayCount(\n\t\t\tthis.modifiedBaseRangeResultStates.get().entries(),\n\t\t\t([r, s]: [ModifiedBaseRange, ModifiedBaseRangeData]) => {\n\t\t\t\tconst state = s.accepted.get();\n\t\t\t\treturn r.isConflicting && state.kind === ModifiedBaseRangeStateKind.unrecognized && s.previousNonDiffingState?.kind === ModifiedBaseRangeStateKind.input1;\n\t\t\t}\n\t\t);\n\t}\n\tpublic get manuallySolvedConflictCountThatEqualNoneAndStartedWithInput2(): number {\n\t\treturn arrayCount(\n\t\t\tthis.modifiedBaseRangeResultStates.get().entries(),\n\t\t\t([r, s]: [ModifiedBaseRange, ModifiedBaseRangeData]) => {\n\t\t\t\tconst state = s.accepted.get();\n\t\t\t\treturn r.isConflicting && state.kind === ModifiedBaseRangeStateKind.unrecognized && s.previousNonDiffingState?.kind === ModifiedBaseRangeStateKind.input2;\n\t\t\t}\n\t\t);\n\t}\n\tpublic get manuallySolvedConflictCountThatEqualNoneAndStartedWithBothNonSmart(): number {\n\t\treturn arrayCount(\n\t\t\tthis.modifiedBaseRangeResultStates.get().entries(),\n\t\t\t([r, s]: [ModifiedBaseRange, ModifiedBaseRangeData]) => {\n\t\t\t\tconst state = s.accepted.get();\n\t\t\t\treturn r.isConflicting && state.kind === ModifiedBaseRangeStateKind.unrecognized && s.previousNonDiffingState?.kind === ModifiedBaseRangeStateKind.both && !s.previousNonDiffingState?.smartCombination;\n\t\t\t}\n\t\t);\n\t}\n\tpublic get manuallySolvedConflictCountThatEqualNoneAndStartedWithBothSmart(): number {\n\t\treturn arrayCount(\n\t\t\tthis.modifiedBaseRangeResultStates.get().entries(),\n\t\t\t([r, s]: [ModifiedBaseRange, ModifiedBaseRangeData]) => {\n\t\t\t\tconst state = s.accepted.get();\n\t\t\t\treturn r.isConflicting && state.kind === ModifiedBaseRangeStateKind.unrecognized && s.previousNonDiffingState?.kind === ModifiedBaseRangeStateKind.both && s.previousNonDiffingState?.smartCombination;\n\t\t\t}\n\t\t);\n\t}\n}\n\nfunction arrayCount<T>(array: Iterable<T>, predicate: (value: T) => boolean): number {\n\tlet count = 0;\n\tfor (const value of array) {\n\t\tif (predicate(value)) {\n\t\t\tcount++;\n\t\t}\n\t}\n\treturn count;\n}\n\nclass ModifiedBaseRangeData {\n\tconstructor(private readonly baseRange: ModifiedBaseRange) {\n\t\tthis.accepted = observableValue(`BaseRangeState${this.baseRange.baseRange}`, ModifiedBaseRangeState.base);\n\t\tthis.handledInput1 = observableValue(`BaseRangeHandledState${this.baseRange.baseRange}.Input1`, false);\n\t\tthis.handledInput2 = observableValue(`BaseRangeHandledState${this.baseRange.baseRange}.Input2`, false);\n\t\tthis.computedFromDiffing = false;\n\t\tthis.previousNonDiffingState = undefined;\n\t\tthis.handled = derived(this, reader => this.handledInput1.read(reader) && this.handledInput2.read(reader));\n\t}\n\n\tpublic accepted: ISettableObservable<ModifiedBaseRangeState>;\n\tpublic handledInput1: ISettableObservable<boolean>;\n\tpublic handledInput2: ISettableObservable<boolean>;\n\n\tpublic computedFromDiffing;\n\tpublic previousNonDiffingState: ModifiedBaseRangeState | undefined;\n\n\tpublic readonly handled;\n}\n\nexport const enum MergeEditorModelState {\n\tinitializing = 1,\n\tupToDate = 2,\n\tupdating = 3,\n}\n\nclass MarkAsHandledUndoRedoElement implements IResourceUndoRedoElement {\n\tpublic readonly code = 'undoMarkAsHandled';\n\tpublic readonly label = localize('undoMarkAsHandled', 'Undo Mark As Handled');\n\n\tpublic readonly type = UndoRedoElementType.Resource;\n\n\tconstructor(\n\t\tpublic readonly resource: URI,\n\t\tprivate readonly mergeEditorModelRef: WeakRef<MergeEditorModel>,\n\t\tprivate readonly stateRef: WeakRef<ModifiedBaseRangeData>,\n\t\tprivate readonly input1Handled: boolean,\n\t\tprivate readonly input2Handled: boolean,\n\t) { }\n\n\tpublic redo() {\n\t\tconst mergeEditorModel = this.mergeEditorModelRef.deref();\n\t\tif (!mergeEditorModel || mergeEditorModel.isDisposed()) {\n\t\t\treturn;\n\t\t}\n\t\tconst state = this.stateRef.deref();\n\t\tif (!state) { return; }\n\t\ttransaction(tx => {\n\t\t\tstate.handledInput1.set(true, tx);\n\t\t\tstate.handledInput2.set(true, tx);\n\t\t});\n\t}\n\tpublic undo() {\n\t\tconst mergeEditorModel = this.mergeEditorModelRef.deref();\n\t\tif (!mergeEditorModel || mergeEditorModel.isDisposed()) {\n\t\t\treturn;\n\t\t}\n\t\tconst state = this.stateRef.deref();\n\t\tif (!state) { return; }\n\t\ttransaction(tx => {\n\t\t\tstate.handledInput1.set(this.input1Handled, tx);\n\t\t\tstate.handledInput2.set(this.input2Handled, tx);\n\t\t});\n\t}\n}\n"]}