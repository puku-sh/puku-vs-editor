{"version":3,"sources":["vs/workbench/contrib/mergeEditor/browser/mergeMarkers/mergeMarkersController.ts"],"names":[],"mappings":"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","file":"mergeMarkersController.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { h } from '../../../../../base/browser/dom.js';\nimport { Disposable, DisposableStore } from '../../../../../base/common/lifecycle.js';\nimport { autorun, IObservable } from '../../../../../base/common/observable.js';\nimport { ICodeEditor } from '../../../../../editor/browser/editorBrowser.js';\nimport { ITextModel } from '../../../../../editor/common/model.js';\nimport { MergeEditorLineRange } from '../model/lineRange.js';\nimport { MergeEditorViewModel } from '../view/viewModel.js';\nimport * as nls from '../../../../../nls.js';\n\nexport const conflictMarkers = {\n\tstart: '<<<<<<<',\n\tend: '>>>>>>>',\n};\n\nexport class MergeMarkersController extends Disposable {\n\tprivate readonly viewZoneIds: string[] = [];\n\tprivate readonly disposableStore = new DisposableStore();\n\n\tpublic constructor(\n\t\tpublic readonly editor: ICodeEditor,\n\t\tpublic readonly mergeEditorViewModel: IObservable<MergeEditorViewModel | undefined>,\n\t) {\n\t\tsuper();\n\n\t\tthis._register(editor.onDidChangeModelContent(e => {\n\t\t\tthis.updateDecorations();\n\t\t}));\n\n\t\tthis._register(editor.onDidChangeModel(e => {\n\t\t\tthis.updateDecorations();\n\t\t}));\n\n\t\tthis.updateDecorations();\n\t}\n\n\tprivate updateDecorations() {\n\t\tconst model = this.editor.getModel();\n\t\tconst blocks = model ? getBlocks(model, { blockToRemoveStartLinePrefix: conflictMarkers.start, blockToRemoveEndLinePrefix: conflictMarkers.end }) : { blocks: [] };\n\n\t\tthis.editor.setHiddenAreas(blocks.blocks.map(b => b.lineRange.deltaEnd(-1).toExclusiveRange()), this);\n\t\tthis.editor.changeViewZones(c => {\n\t\t\tthis.disposableStore.clear();\n\t\t\tfor (const id of this.viewZoneIds) {\n\t\t\t\tc.removeZone(id);\n\t\t\t}\n\t\t\tthis.viewZoneIds.length = 0;\n\t\t\tfor (const b of blocks.blocks) {\n\n\t\t\t\tconst startLine = model!.getLineContent(b.lineRange.startLineNumber).substring(0, 20);\n\t\t\t\tconst endLine = model!.getLineContent(b.lineRange.endLineNumberExclusive - 1).substring(0, 20);\n\n\t\t\t\tconst conflictingLinesCount = b.lineRange.length - 2;\n\n\t\t\t\tconst domNode = h('div', [\n\t\t\t\t\th('div.conflict-zone-root', [\n\t\t\t\t\t\th('pre', [startLine]),\n\t\t\t\t\t\th('span.dots', ['...']),\n\t\t\t\t\t\th('pre', [endLine]),\n\t\t\t\t\t\th('span.text', [\n\t\t\t\t\t\t\tconflictingLinesCount === 1\n\t\t\t\t\t\t\t\t? nls.localize('conflictingLine', \"1 Conflicting Line\")\n\t\t\t\t\t\t\t\t: nls.localize('conflictingLines', \"{0} Conflicting Lines\", conflictingLinesCount)\n\t\t\t\t\t\t]),\n\t\t\t\t\t]),\n\t\t\t\t]).root;\n\t\t\t\tthis.viewZoneIds.push(c.addZone({\n\t\t\t\t\tafterLineNumber: b.lineRange.endLineNumberExclusive - 1,\n\t\t\t\t\tdomNode,\n\t\t\t\t\theightInLines: 1.5,\n\t\t\t\t}));\n\n\t\t\t\tconst updateWidth = () => {\n\t\t\t\t\tconst layoutInfo = this.editor.getLayoutInfo();\n\t\t\t\t\tdomNode.style.width = `${layoutInfo.contentWidth - layoutInfo.verticalScrollbarWidth}px`;\n\t\t\t\t};\n\n\t\t\t\tthis.disposableStore.add(\n\t\t\t\t\tthis.editor.onDidLayoutChange(() => {\n\t\t\t\t\t\tupdateWidth();\n\t\t\t\t\t})\n\t\t\t\t);\n\t\t\t\tupdateWidth();\n\n\n\t\t\t\tthis.disposableStore.add(autorun(reader => {\n\t\t\t\t\t/** @description update classname */\n\t\t\t\t\tconst vm = this.mergeEditorViewModel.read(reader);\n\t\t\t\t\tif (!vm) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tconst activeRange = vm.activeModifiedBaseRange.read(reader);\n\n\t\t\t\t\tconst classNames: string[] = [];\n\t\t\t\t\tclassNames.push('conflict-zone');\n\n\t\t\t\t\tif (activeRange) {\n\t\t\t\t\t\tconst activeRangeInResult = vm.model.getLineRangeInResult(activeRange.baseRange, reader);\n\t\t\t\t\t\tif (activeRangeInResult.intersectsOrTouches(b.lineRange)) {\n\t\t\t\t\t\t\tclassNames.push('focused');\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tdomNode.className = classNames.join(' ');\n\t\t\t\t}));\n\t\t\t}\n\t\t});\n\t}\n}\n\n\nfunction getBlocks(document: ITextModel, configuration: ProjectionConfiguration): { blocks: Block[]; transformedContent: string } {\n\tconst blocks: Block[] = [];\n\tconst transformedContent: string[] = [];\n\n\tlet inBlock = false;\n\tlet startLineNumber = -1;\n\tlet curLine = 0;\n\n\tfor (const line of document.getLinesContent()) {\n\t\tcurLine++;\n\t\tif (!inBlock) {\n\t\t\tif (line.startsWith(configuration.blockToRemoveStartLinePrefix)) {\n\t\t\t\tinBlock = true;\n\t\t\t\tstartLineNumber = curLine;\n\t\t\t} else {\n\t\t\t\ttransformedContent.push(line);\n\t\t\t}\n\t\t} else {\n\t\t\tif (line.startsWith(configuration.blockToRemoveEndLinePrefix)) {\n\t\t\t\tinBlock = false;\n\t\t\t\tblocks.push(new Block(MergeEditorLineRange.fromLength(startLineNumber, curLine - startLineNumber + 1)));\n\t\t\t\ttransformedContent.push('');\n\t\t\t}\n\t\t}\n\t}\n\n\treturn {\n\t\tblocks,\n\t\ttransformedContent: transformedContent.join('\\n')\n\t};\n}\n\nclass Block {\n\tconstructor(public readonly lineRange: MergeEditorLineRange) { }\n}\n\ninterface ProjectionConfiguration {\n\tblockToRemoveStartLinePrefix: string;\n\tblockToRemoveEndLinePrefix: string;\n}\n"]}