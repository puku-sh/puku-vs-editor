{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/contrib/mergeEditor/browser/view/viewZones.ts","vs/workbench/contrib/mergeEditor/browser/view/viewZones.ts"],"names":[],"mappings":"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","file":"viewZones.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { $ } from '../../../../../base/browser/dom.js';\nimport { CompareResult } from '../../../../../base/common/arrays.js';\nimport { DisposableStore } from '../../../../../base/common/lifecycle.js';\nimport { IObservable, IReader } from '../../../../../base/common/observable.js';\nimport { ICodeEditor, IViewZoneChangeAccessor } from '../../../../../editor/browser/editorBrowser.js';\nimport { MergeEditorLineRange } from '../model/lineRange.js';\nimport { DetailedLineRangeMapping } from '../model/mapping.js';\nimport { ModifiedBaseRange } from '../model/modifiedBaseRange.js';\nimport { join } from '../utils.js';\nimport { ActionsSource, ConflictActionsFactory, IContentWidgetAction } from './conflictActions.js';\nimport { getAlignments } from './lineAlignment.js';\nimport { MergeEditorViewModel } from './viewModel.js';\n\nexport class ViewZoneComputer {\n\tprivate readonly conflictActionsFactoryInput1;\n\tprivate readonly conflictActionsFactoryInput2;\n\tprivate readonly conflictActionsFactoryResult;\n\n\tconstructor(\n\t\tprivate readonly input1Editor: ICodeEditor,\n\t\tprivate readonly input2Editor: ICodeEditor,\n\t\tprivate readonly resultEditor: ICodeEditor,\n\t) {\n\t\tthis.conflictActionsFactoryInput1 = new ConflictActionsFactory(this.input1Editor);\n\t\tthis.conflictActionsFactoryInput2 = new ConflictActionsFactory(this.input2Editor);\n\t\tthis.conflictActionsFactoryResult = new ConflictActionsFactory(this.resultEditor);\n\t}\n\n\tpublic computeViewZones(\n\t\treader: IReader,\n\t\tviewModel: MergeEditorViewModel,\n\t\toptions: {\n\t\t\tshouldAlignResult: boolean;\n\t\t\tshouldAlignBase: boolean;\n\t\t\tcodeLensesVisible: boolean;\n\t\t\tshowNonConflictingChanges: boolean;\n\t\t}\n\t): MergeEditorViewZones {\n\t\tlet input1LinesAdded = 0;\n\t\tlet input2LinesAdded = 0;\n\t\tlet baseLinesAdded = 0;\n\t\tlet resultLinesAdded = 0;\n\n\t\tconst input1ViewZones: MergeEditorViewZone[] = [];\n\t\tconst input2ViewZones: MergeEditorViewZone[] = [];\n\t\tconst baseViewZones: MergeEditorViewZone[] = [];\n\t\tconst resultViewZones: MergeEditorViewZone[] = [];\n\n\t\tconst model = viewModel.model;\n\n\t\tconst resultDiffs = model.baseResultDiffs.read(reader);\n\t\tconst baseRangeWithStoreAndTouchingDiffs = join(\n\t\t\tmodel.modifiedBaseRanges.read(reader),\n\t\t\tresultDiffs,\n\t\t\t(baseRange, diff) =>\n\t\t\t\tbaseRange.baseRange.intersectsOrTouches(diff.inputRange)\n\t\t\t\t\t? CompareResult.neitherLessOrGreaterThan\n\t\t\t\t\t: MergeEditorLineRange.compareByStart(\n\t\t\t\t\t\tbaseRange.baseRange,\n\t\t\t\t\t\tdiff.inputRange\n\t\t\t\t\t)\n\t\t);\n\n\t\tconst shouldShowCodeLenses = options.codeLensesVisible;\n\t\tconst showNonConflictingChanges = options.showNonConflictingChanges;\n\n\t\tlet lastModifiedBaseRange: ModifiedBaseRange | undefined = undefined;\n\t\tlet lastBaseResultDiff: DetailedLineRangeMapping | undefined = undefined;\n\t\tfor (const m of baseRangeWithStoreAndTouchingDiffs) {\n\t\t\tif (shouldShowCodeLenses && m.left && (m.left.isConflicting || showNonConflictingChanges || !model.isHandled(m.left).read(reader))) {\n\t\t\t\tconst actions = new ActionsSource(viewModel, m.left);\n\t\t\t\tif (options.shouldAlignResult || !actions.inputIsEmpty.read(reader)) {\n\t\t\t\t\tinput1ViewZones.push(new CommandViewZone(this.conflictActionsFactoryInput1, m.left.input1Range.startLineNumber - 1, actions.itemsInput1));\n\t\t\t\t\tinput2ViewZones.push(new CommandViewZone(this.conflictActionsFactoryInput2, m.left.input2Range.startLineNumber - 1, actions.itemsInput2));\n\t\t\t\t\tif (options.shouldAlignBase) {\n\t\t\t\t\t\tbaseViewZones.push(new Placeholder(m.left.baseRange.startLineNumber - 1, 16));\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tconst afterLineNumber = m.left.baseRange.startLineNumber + (lastBaseResultDiff?.resultingDeltaFromOriginalToModified ?? 0) - 1;\n\t\t\t\tresultViewZones.push(new CommandViewZone(this.conflictActionsFactoryResult, afterLineNumber, actions.resultItems));\n\n\t\t\t}\n\n\t\t\tconst lastResultDiff = m.rights.at(-1)!;\n\t\t\tif (lastResultDiff) {\n\t\t\t\tlastBaseResultDiff = lastResultDiff;\n\t\t\t}\n\t\t\tlet alignedLines: LineAlignment[];\n\t\t\tif (m.left) {\n\t\t\t\talignedLines = getAlignments(m.left).map(a => ({\n\t\t\t\t\tinput1Line: a[0],\n\t\t\t\t\tbaseLine: a[1],\n\t\t\t\t\tinput2Line: a[2],\n\t\t\t\t\tresultLine: undefined,\n\t\t\t\t}));\n\n\t\t\t\tlastModifiedBaseRange = m.left;\n\t\t\t\t// This is a total hack.\n\t\t\t\talignedLines[alignedLines.length - 1].resultLine =\n\t\t\t\t\tm.left.baseRange.endLineNumberExclusive\n\t\t\t\t\t+ (lastBaseResultDiff ? lastBaseResultDiff.resultingDeltaFromOriginalToModified : 0);\n\n\t\t\t} else {\n\t\t\t\talignedLines = [{\n\t\t\t\t\tbaseLine: lastResultDiff.inputRange.endLineNumberExclusive,\n\t\t\t\t\tinput1Line: lastResultDiff.inputRange.endLineNumberExclusive + (lastModifiedBaseRange ? (lastModifiedBaseRange.input1Range.endLineNumberExclusive - lastModifiedBaseRange.baseRange.endLineNumberExclusive) : 0),\n\t\t\t\t\tinput2Line: lastResultDiff.inputRange.endLineNumberExclusive + (lastModifiedBaseRange ? (lastModifiedBaseRange.input2Range.endLineNumberExclusive - lastModifiedBaseRange.baseRange.endLineNumberExclusive) : 0),\n\t\t\t\t\tresultLine: lastResultDiff.outputRange.endLineNumberExclusive,\n\t\t\t\t}];\n\t\t\t}\n\n\t\t\tfor (const { input1Line, baseLine, input2Line, resultLine } of alignedLines) {\n\t\t\t\tif (!options.shouldAlignBase && (input1Line === undefined || input2Line === undefined)) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tconst input1Line_ =\n\t\t\t\t\tinput1Line !== undefined ? input1Line + input1LinesAdded : -1;\n\t\t\t\tconst input2Line_ =\n\t\t\t\t\tinput2Line !== undefined ? input2Line + input2LinesAdded : -1;\n\t\t\t\tconst baseLine_ = baseLine + baseLinesAdded;\n\t\t\t\tconst resultLine_ = resultLine !== undefined ? resultLine + resultLinesAdded : -1;\n\n\t\t\t\tconst max = Math.max(options.shouldAlignBase ? baseLine_ : 0, input1Line_, input2Line_, options.shouldAlignResult ? resultLine_ : 0);\n\n\t\t\t\tif (input1Line !== undefined) {\n\t\t\t\t\tconst diffInput1 = max - input1Line_;\n\t\t\t\t\tif (diffInput1 > 0) {\n\t\t\t\t\t\tinput1ViewZones.push(new Spacer(input1Line - 1, diffInput1));\n\t\t\t\t\t\tinput1LinesAdded += diffInput1;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (input2Line !== undefined) {\n\t\t\t\t\tconst diffInput2 = max - input2Line_;\n\t\t\t\t\tif (diffInput2 > 0) {\n\t\t\t\t\t\tinput2ViewZones.push(new Spacer(input2Line - 1, diffInput2));\n\t\t\t\t\t\tinput2LinesAdded += diffInput2;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (options.shouldAlignBase) {\n\t\t\t\t\tconst diffBase = max - baseLine_;\n\t\t\t\t\tif (diffBase > 0) {\n\t\t\t\t\t\tbaseViewZones.push(new Spacer(baseLine - 1, diffBase));\n\t\t\t\t\t\tbaseLinesAdded += diffBase;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (options.shouldAlignResult && resultLine !== undefined) {\n\t\t\t\t\tconst diffResult = max - resultLine_;\n\t\t\t\t\tif (diffResult > 0) {\n\t\t\t\t\t\tresultViewZones.push(new Spacer(resultLine - 1, diffResult));\n\t\t\t\t\t\tresultLinesAdded += diffResult;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn new MergeEditorViewZones(input1ViewZones, input2ViewZones, baseViewZones, resultViewZones);\n\t}\n}\n\ninterface LineAlignment {\n\tbaseLine: number;\n\tinput1Line?: number;\n\tinput2Line?: number;\n\tresultLine?: number;\n}\n\nexport class MergeEditorViewZones {\n\tconstructor(\n\t\tpublic readonly input1ViewZones: readonly MergeEditorViewZone[],\n\t\tpublic readonly input2ViewZones: readonly MergeEditorViewZone[],\n\t\tpublic readonly baseViewZones: readonly MergeEditorViewZone[],\n\t\tpublic readonly resultViewZones: readonly MergeEditorViewZone[],\n\t) { }\n}\n\n/**\n * This is an abstract class to create various editor view zones.\n*/\nexport abstract class MergeEditorViewZone {\n\tabstract create(viewZoneChangeAccessor: IViewZoneChangeAccessor, viewZoneIdsToCleanUp: string[], disposableStore: DisposableStore): void;\n}\n\nclass Spacer extends MergeEditorViewZone {\n\tconstructor(\n\t\tprivate readonly afterLineNumber: number,\n\t\tprivate readonly heightInLines: number\n\t) {\n\t\tsuper();\n\t}\n\n\toverride create(\n\t\tviewZoneChangeAccessor: IViewZoneChangeAccessor,\n\t\tviewZoneIdsToCleanUp: string[],\n\t\tdisposableStore: DisposableStore\n\t): void {\n\t\tviewZoneIdsToCleanUp.push(\n\t\t\tviewZoneChangeAccessor.addZone({\n\t\t\t\tafterLineNumber: this.afterLineNumber,\n\t\t\t\theightInLines: this.heightInLines,\n\t\t\t\tdomNode: $('div.diagonal-fill'),\n\t\t\t})\n\t\t);\n\t}\n}\n\nclass Placeholder extends MergeEditorViewZone {\n\tconstructor(\n\t\tprivate readonly afterLineNumber: number,\n\t\tprivate readonly heightPx: number\n\t) {\n\t\tsuper();\n\t}\n\n\toverride create(\n\t\tviewZoneChangeAccessor: IViewZoneChangeAccessor,\n\t\tviewZoneIdsToCleanUp: string[],\n\t\tdisposableStore: DisposableStore\n\t): void {\n\t\tviewZoneIdsToCleanUp.push(\n\t\t\tviewZoneChangeAccessor.addZone({\n\t\t\t\tafterLineNumber: this.afterLineNumber,\n\t\t\t\theightInPx: this.heightPx,\n\t\t\t\tdomNode: $('div.conflict-actions-placeholder'),\n\t\t\t})\n\t\t);\n\t}\n}\n\nclass CommandViewZone extends MergeEditorViewZone {\n\tconstructor(\n\t\tprivate readonly conflictActionsFactory: ConflictActionsFactory,\n\t\tprivate readonly lineNumber: number,\n\t\tprivate readonly items: IObservable<IContentWidgetAction[]>,\n\t) {\n\t\tsuper();\n\t}\n\n\toverride create(viewZoneChangeAccessor: IViewZoneChangeAccessor, viewZoneIdsToCleanUp: string[], disposableStore: DisposableStore): void {\n\t\tdisposableStore.add(\n\t\t\tthis.conflictActionsFactory.createWidget(\n\t\t\t\tviewZoneChangeAccessor,\n\t\t\t\tthis.lineNumber,\n\t\t\t\tthis.items,\n\t\t\t\tviewZoneIdsToCleanUp,\n\t\t\t)\n\t\t);\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { $ } from '../../../../../base/browser/dom.js';\nimport { CompareResult } from '../../../../../base/common/arrays.js';\nimport { DisposableStore } from '../../../../../base/common/lifecycle.js';\nimport { IObservable, IReader } from '../../../../../base/common/observable.js';\nimport { ICodeEditor, IViewZoneChangeAccessor } from '../../../../../editor/browser/editorBrowser.js';\nimport { MergeEditorLineRange } from '../model/lineRange.js';\nimport { DetailedLineRangeMapping } from '../model/mapping.js';\nimport { ModifiedBaseRange } from '../model/modifiedBaseRange.js';\nimport { join } from '../utils.js';\nimport { ActionsSource, ConflictActionsFactory, IContentWidgetAction } from './conflictActions.js';\nimport { getAlignments } from './lineAlignment.js';\nimport { MergeEditorViewModel } from './viewModel.js';\n\nexport class ViewZoneComputer {\n\tprivate readonly conflictActionsFactoryInput1;\n\tprivate readonly conflictActionsFactoryInput2;\n\tprivate readonly conflictActionsFactoryResult;\n\n\tconstructor(\n\t\tprivate readonly input1Editor: ICodeEditor,\n\t\tprivate readonly input2Editor: ICodeEditor,\n\t\tprivate readonly resultEditor: ICodeEditor,\n\t) {\n\t\tthis.conflictActionsFactoryInput1 = new ConflictActionsFactory(this.input1Editor);\n\t\tthis.conflictActionsFactoryInput2 = new ConflictActionsFactory(this.input2Editor);\n\t\tthis.conflictActionsFactoryResult = new ConflictActionsFactory(this.resultEditor);\n\t}\n\n\tpublic computeViewZones(\n\t\treader: IReader,\n\t\tviewModel: MergeEditorViewModel,\n\t\toptions: {\n\t\t\tshouldAlignResult: boolean;\n\t\t\tshouldAlignBase: boolean;\n\t\t\tcodeLensesVisible: boolean;\n\t\t\tshowNonConflictingChanges: boolean;\n\t\t}\n\t): MergeEditorViewZones {\n\t\tlet input1LinesAdded = 0;\n\t\tlet input2LinesAdded = 0;\n\t\tlet baseLinesAdded = 0;\n\t\tlet resultLinesAdded = 0;\n\n\t\tconst input1ViewZones: MergeEditorViewZone[] = [];\n\t\tconst input2ViewZones: MergeEditorViewZone[] = [];\n\t\tconst baseViewZones: MergeEditorViewZone[] = [];\n\t\tconst resultViewZones: MergeEditorViewZone[] = [];\n\n\t\tconst model = viewModel.model;\n\n\t\tconst resultDiffs = model.baseResultDiffs.read(reader);\n\t\tconst baseRangeWithStoreAndTouchingDiffs = join(\n\t\t\tmodel.modifiedBaseRanges.read(reader),\n\t\t\tresultDiffs,\n\t\t\t(baseRange, diff) =>\n\t\t\t\tbaseRange.baseRange.intersectsOrTouches(diff.inputRange)\n\t\t\t\t\t? CompareResult.neitherLessOrGreaterThan\n\t\t\t\t\t: MergeEditorLineRange.compareByStart(\n\t\t\t\t\t\tbaseRange.baseRange,\n\t\t\t\t\t\tdiff.inputRange\n\t\t\t\t\t)\n\t\t);\n\n\t\tconst shouldShowCodeLenses = options.codeLensesVisible;\n\t\tconst showNonConflictingChanges = options.showNonConflictingChanges;\n\n\t\tlet lastModifiedBaseRange: ModifiedBaseRange | undefined = undefined;\n\t\tlet lastBaseResultDiff: DetailedLineRangeMapping | undefined = undefined;\n\t\tfor (const m of baseRangeWithStoreAndTouchingDiffs) {\n\t\t\tif (shouldShowCodeLenses && m.left && (m.left.isConflicting || showNonConflictingChanges || !model.isHandled(m.left).read(reader))) {\n\t\t\t\tconst actions = new ActionsSource(viewModel, m.left);\n\t\t\t\tif (options.shouldAlignResult || !actions.inputIsEmpty.read(reader)) {\n\t\t\t\t\tinput1ViewZones.push(new CommandViewZone(this.conflictActionsFactoryInput1, m.left.input1Range.startLineNumber - 1, actions.itemsInput1));\n\t\t\t\t\tinput2ViewZones.push(new CommandViewZone(this.conflictActionsFactoryInput2, m.left.input2Range.startLineNumber - 1, actions.itemsInput2));\n\t\t\t\t\tif (options.shouldAlignBase) {\n\t\t\t\t\t\tbaseViewZones.push(new Placeholder(m.left.baseRange.startLineNumber - 1, 16));\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tconst afterLineNumber = m.left.baseRange.startLineNumber + (lastBaseResultDiff?.resultingDeltaFromOriginalToModified ?? 0) - 1;\n\t\t\t\tresultViewZones.push(new CommandViewZone(this.conflictActionsFactoryResult, afterLineNumber, actions.resultItems));\n\n\t\t\t}\n\n\t\t\tconst lastResultDiff = m.rights.at(-1)!;\n\t\t\tif (lastResultDiff) {\n\t\t\t\tlastBaseResultDiff = lastResultDiff;\n\t\t\t}\n\t\t\tlet alignedLines: LineAlignment[];\n\t\t\tif (m.left) {\n\t\t\t\talignedLines = getAlignments(m.left).map(a => ({\n\t\t\t\t\tinput1Line: a[0],\n\t\t\t\t\tbaseLine: a[1],\n\t\t\t\t\tinput2Line: a[2],\n\t\t\t\t\tresultLine: undefined,\n\t\t\t\t}));\n\n\t\t\t\tlastModifiedBaseRange = m.left;\n\t\t\t\t// This is a total hack.\n\t\t\t\talignedLines[alignedLines.length - 1].resultLine =\n\t\t\t\t\tm.left.baseRange.endLineNumberExclusive\n\t\t\t\t\t+ (lastBaseResultDiff ? lastBaseResultDiff.resultingDeltaFromOriginalToModified : 0);\n\n\t\t\t} else {\n\t\t\t\talignedLines = [{\n\t\t\t\t\tbaseLine: lastResultDiff.inputRange.endLineNumberExclusive,\n\t\t\t\t\tinput1Line: lastResultDiff.inputRange.endLineNumberExclusive + (lastModifiedBaseRange ? (lastModifiedBaseRange.input1Range.endLineNumberExclusive - lastModifiedBaseRange.baseRange.endLineNumberExclusive) : 0),\n\t\t\t\t\tinput2Line: lastResultDiff.inputRange.endLineNumberExclusive + (lastModifiedBaseRange ? (lastModifiedBaseRange.input2Range.endLineNumberExclusive - lastModifiedBaseRange.baseRange.endLineNumberExclusive) : 0),\n\t\t\t\t\tresultLine: lastResultDiff.outputRange.endLineNumberExclusive,\n\t\t\t\t}];\n\t\t\t}\n\n\t\t\tfor (const { input1Line, baseLine, input2Line, resultLine } of alignedLines) {\n\t\t\t\tif (!options.shouldAlignBase && (input1Line === undefined || input2Line === undefined)) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tconst input1Line_ =\n\t\t\t\t\tinput1Line !== undefined ? input1Line + input1LinesAdded : -1;\n\t\t\t\tconst input2Line_ =\n\t\t\t\t\tinput2Line !== undefined ? input2Line + input2LinesAdded : -1;\n\t\t\t\tconst baseLine_ = baseLine + baseLinesAdded;\n\t\t\t\tconst resultLine_ = resultLine !== undefined ? resultLine + resultLinesAdded : -1;\n\n\t\t\t\tconst max = Math.max(options.shouldAlignBase ? baseLine_ : 0, input1Line_, input2Line_, options.shouldAlignResult ? resultLine_ : 0);\n\n\t\t\t\tif (input1Line !== undefined) {\n\t\t\t\t\tconst diffInput1 = max - input1Line_;\n\t\t\t\t\tif (diffInput1 > 0) {\n\t\t\t\t\t\tinput1ViewZones.push(new Spacer(input1Line - 1, diffInput1));\n\t\t\t\t\t\tinput1LinesAdded += diffInput1;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (input2Line !== undefined) {\n\t\t\t\t\tconst diffInput2 = max - input2Line_;\n\t\t\t\t\tif (diffInput2 > 0) {\n\t\t\t\t\t\tinput2ViewZones.push(new Spacer(input2Line - 1, diffInput2));\n\t\t\t\t\t\tinput2LinesAdded += diffInput2;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (options.shouldAlignBase) {\n\t\t\t\t\tconst diffBase = max - baseLine_;\n\t\t\t\t\tif (diffBase > 0) {\n\t\t\t\t\t\tbaseViewZones.push(new Spacer(baseLine - 1, diffBase));\n\t\t\t\t\t\tbaseLinesAdded += diffBase;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (options.shouldAlignResult && resultLine !== undefined) {\n\t\t\t\t\tconst diffResult = max - resultLine_;\n\t\t\t\t\tif (diffResult > 0) {\n\t\t\t\t\t\tresultViewZones.push(new Spacer(resultLine - 1, diffResult));\n\t\t\t\t\t\tresultLinesAdded += diffResult;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn new MergeEditorViewZones(input1ViewZones, input2ViewZones, baseViewZones, resultViewZones);\n\t}\n}\n\ninterface LineAlignment {\n\tbaseLine: number;\n\tinput1Line?: number;\n\tinput2Line?: number;\n\tresultLine?: number;\n}\n\nexport class MergeEditorViewZones {\n\tconstructor(\n\t\tpublic readonly input1ViewZones: readonly MergeEditorViewZone[],\n\t\tpublic readonly input2ViewZones: readonly MergeEditorViewZone[],\n\t\tpublic readonly baseViewZones: readonly MergeEditorViewZone[],\n\t\tpublic readonly resultViewZones: readonly MergeEditorViewZone[],\n\t) { }\n}\n\n/**\n * This is an abstract class to create various editor view zones.\n*/\nexport abstract class MergeEditorViewZone {\n\tabstract create(viewZoneChangeAccessor: IViewZoneChangeAccessor, viewZoneIdsToCleanUp: string[], disposableStore: DisposableStore): void;\n}\n\nclass Spacer extends MergeEditorViewZone {\n\tconstructor(\n\t\tprivate readonly afterLineNumber: number,\n\t\tprivate readonly heightInLines: number\n\t) {\n\t\tsuper();\n\t}\n\n\toverride create(\n\t\tviewZoneChangeAccessor: IViewZoneChangeAccessor,\n\t\tviewZoneIdsToCleanUp: string[],\n\t\tdisposableStore: DisposableStore\n\t): void {\n\t\tviewZoneIdsToCleanUp.push(\n\t\t\tviewZoneChangeAccessor.addZone({\n\t\t\t\tafterLineNumber: this.afterLineNumber,\n\t\t\t\theightInLines: this.heightInLines,\n\t\t\t\tdomNode: $('div.diagonal-fill'),\n\t\t\t})\n\t\t);\n\t}\n}\n\nclass Placeholder extends MergeEditorViewZone {\n\tconstructor(\n\t\tprivate readonly afterLineNumber: number,\n\t\tprivate readonly heightPx: number\n\t) {\n\t\tsuper();\n\t}\n\n\toverride create(\n\t\tviewZoneChangeAccessor: IViewZoneChangeAccessor,\n\t\tviewZoneIdsToCleanUp: string[],\n\t\tdisposableStore: DisposableStore\n\t): void {\n\t\tviewZoneIdsToCleanUp.push(\n\t\t\tviewZoneChangeAccessor.addZone({\n\t\t\t\tafterLineNumber: this.afterLineNumber,\n\t\t\t\theightInPx: this.heightPx,\n\t\t\t\tdomNode: $('div.conflict-actions-placeholder'),\n\t\t\t})\n\t\t);\n\t}\n}\n\nclass CommandViewZone extends MergeEditorViewZone {\n\tconstructor(\n\t\tprivate readonly conflictActionsFactory: ConflictActionsFactory,\n\t\tprivate readonly lineNumber: number,\n\t\tprivate readonly items: IObservable<IContentWidgetAction[]>,\n\t) {\n\t\tsuper();\n\t}\n\n\toverride create(viewZoneChangeAccessor: IViewZoneChangeAccessor, viewZoneIdsToCleanUp: string[], disposableStore: DisposableStore): void {\n\t\tdisposableStore.add(\n\t\t\tthis.conflictActionsFactory.createWidget(\n\t\t\t\tviewZoneChangeAccessor,\n\t\t\t\tthis.lineNumber,\n\t\t\t\tthis.items,\n\t\t\t\tviewZoneIdsToCleanUp,\n\t\t\t)\n\t\t);\n\t}\n}\n"]}