{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/contrib/mergeEditor/test/browser/model.test.ts","vs/workbench/contrib/mergeEditor/test/browser/model.test.ts"],"names":[],"mappings":"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","file":"model.test.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport assert from 'assert';\nimport { Disposable, DisposableStore } from '../../../../../base/common/lifecycle.js';\nimport { IReader, transaction } from '../../../../../base/common/observable.js';\nimport { isDefined } from '../../../../../base/common/types.js';\nimport { Range } from '../../../../../editor/common/core/range.js';\nimport { linesDiffComputers } from '../../../../../editor/common/diff/linesDiffComputers.js';\nimport { EndOfLinePreference, ITextModel } from '../../../../../editor/common/model.js';\nimport { createModelServices, createTextModel } from '../../../../../editor/test/common/testTextModel.js';\nimport { IInstantiationService } from '../../../../../platform/instantiation/common/instantiation.js';\nimport { NullTelemetryService } from '../../../../../platform/telemetry/common/telemetryUtils.js';\nimport { IMergeDiffComputer, IMergeDiffComputerResult, toLineRange, toRangeMapping } from '../../browser/model/diffComputer.js';\nimport { DetailedLineRangeMapping } from '../../browser/model/mapping.js';\nimport { MergeEditorModel } from '../../browser/model/mergeEditorModel.js';\nimport { MergeEditorTelemetry } from '../../browser/telemetry.js';\n\nsuite('merge editor model', () => {\n\t// todo: renable when failing case is found https://github.com/microsoft/vscode/pull/190444#issuecomment-1678151428\n\t// ensureNoDisposablesAreLeakedInTestSuite();\n\n\ttest('prepend line', async () => {\n\t\tawait testMergeModel(\n\t\t\t{\n\t\t\t\t'languageId': 'plaintext',\n\t\t\t\t'base': 'line1\\nline2',\n\t\t\t\t'input1': '0\\nline1\\nline2',\n\t\t\t\t'input2': '0\\nline1\\nline2',\n\t\t\t\t'result': ''\n\t\t\t},\n\t\t\tmodel => {\n\t\t\t\tassert.deepStrictEqual(model.getProjections(), {\n\t\t\t\t\tbase: ['⟦⟧₀line1', 'line2'],\n\t\t\t\t\tinput1: ['⟦0', '⟧₀line1', 'line2'],\n\t\t\t\t\tinput2: ['⟦0', '⟧₀line1', 'line2'],\n\t\t\t\t\tresult: ['⟦⟧{unrecognized}₀'],\n\t\t\t\t});\n\n\t\t\t\tmodel.toggleConflict(0, 1);\n\t\t\t\tassert.deepStrictEqual(\n\t\t\t\t\t{ result: model.getResult() },\n\t\t\t\t\t{ result: '0\\nline1\\nline2' }\n\t\t\t\t);\n\n\t\t\t\tmodel.toggleConflict(0, 2);\n\t\t\t\tassert.deepStrictEqual(\n\t\t\t\t\t{ result: model.getResult() },\n\t\t\t\t\t({ result: '0\\n0\\nline1\\nline2' })\n\t\t\t\t);\n\t\t\t}\n\t\t);\n\t});\n\n\ttest('empty base', async () => {\n\t\tawait testMergeModel(\n\t\t\t{\n\t\t\t\t'languageId': 'plaintext',\n\t\t\t\t'base': '',\n\t\t\t\t'input1': 'input1',\n\t\t\t\t'input2': 'input2',\n\t\t\t\t'result': ''\n\t\t\t},\n\t\t\tmodel => {\n\t\t\t\tassert.deepStrictEqual(model.getProjections(), {\n\t\t\t\t\tbase: ['⟦⟧₀'],\n\t\t\t\t\tinput1: ['⟦input1⟧₀'],\n\t\t\t\t\tinput2: ['⟦input2⟧₀'],\n\t\t\t\t\tresult: ['⟦⟧{base}₀'],\n\t\t\t\t});\n\n\t\t\t\tmodel.toggleConflict(0, 1);\n\t\t\t\tassert.deepStrictEqual(\n\t\t\t\t\t{ result: model.getResult() },\n\t\t\t\t\t({ result: 'input1' })\n\t\t\t\t);\n\n\t\t\t\tmodel.toggleConflict(0, 2);\n\t\t\t\tassert.deepStrictEqual(\n\t\t\t\t\t{ result: model.getResult() },\n\t\t\t\t\t({ result: 'input2' })\n\t\t\t\t);\n\t\t\t}\n\t\t);\n\t});\n\n\ttest('can merge word changes', async () => {\n\t\tawait testMergeModel(\n\t\t\t{\n\t\t\t\t'languageId': 'plaintext',\n\t\t\t\t'base': 'hello',\n\t\t\t\t'input1': 'hallo',\n\t\t\t\t'input2': 'helloworld',\n\t\t\t\t'result': ''\n\t\t\t},\n\t\t\tmodel => {\n\t\t\t\tassert.deepStrictEqual(model.getProjections(), {\n\t\t\t\t\tbase: ['⟦hello⟧₀'],\n\t\t\t\t\tinput1: ['⟦hallo⟧₀'],\n\t\t\t\t\tinput2: ['⟦helloworld⟧₀'],\n\t\t\t\t\tresult: ['⟦⟧{unrecognized}₀'],\n\t\t\t\t});\n\n\t\t\t\tmodel.toggleConflict(0, 1);\n\t\t\t\tmodel.toggleConflict(0, 2);\n\n\t\t\t\tassert.deepStrictEqual(\n\t\t\t\t\t{ result: model.getResult() },\n\t\t\t\t\t{ result: 'halloworld' }\n\t\t\t\t);\n\t\t\t}\n\t\t);\n\n\t});\n\n\ttest('can combine insertions at end of document', async () => {\n\t\tawait testMergeModel(\n\t\t\t{\n\t\t\t\t'languageId': 'plaintext',\n\t\t\t\t'base': 'Zürich\\nBern\\nBasel\\nChur\\nGenf\\nThun',\n\t\t\t\t'input1': 'Zürich\\nBern\\nChur\\nDavos\\nGenf\\nThun\\nfunction f(b:boolean) {}',\n\t\t\t\t'input2': 'Zürich\\nBern\\nBasel (FCB)\\nChur\\nGenf\\nThun\\nfunction f(a:number) {}',\n\t\t\t\t'result': 'Zürich\\nBern\\nBasel\\nChur\\nDavos\\nGenf\\nThun'\n\t\t\t},\n\t\t\tmodel => {\n\t\t\t\tassert.deepStrictEqual(model.getProjections(), {\n\t\t\t\t\tbase: ['Zürich', 'Bern', '⟦Basel', '⟧₀Chur', '⟦⟧₁Genf', 'Thun⟦⟧₂'],\n\t\t\t\t\tinput1: [\n\t\t\t\t\t\t'Zürich',\n\t\t\t\t\t\t'Bern',\n\t\t\t\t\t\t'⟦⟧₀Chur',\n\t\t\t\t\t\t'⟦Davos',\n\t\t\t\t\t\t'⟧₁Genf',\n\t\t\t\t\t\t'Thun',\n\t\t\t\t\t\t'⟦function f(b:boolean) {}⟧₂',\n\t\t\t\t\t],\n\t\t\t\t\tinput2: [\n\t\t\t\t\t\t'Zürich',\n\t\t\t\t\t\t'Bern',\n\t\t\t\t\t\t'⟦Basel (FCB)',\n\t\t\t\t\t\t'⟧₀Chur',\n\t\t\t\t\t\t'⟦⟧₁Genf',\n\t\t\t\t\t\t'Thun',\n\t\t\t\t\t\t'⟦function f(a:number) {}⟧₂',\n\t\t\t\t\t],\n\t\t\t\t\tresult: [\n\t\t\t\t\t\t'Zürich',\n\t\t\t\t\t\t'Bern',\n\t\t\t\t\t\t'⟦Basel',\n\t\t\t\t\t\t'⟧{base}₀Chur',\n\t\t\t\t\t\t'⟦Davos',\n\t\t\t\t\t\t'⟧{1✓}₁Genf',\n\t\t\t\t\t\t'Thun⟦⟧{base}₂',\n\t\t\t\t\t],\n\t\t\t\t});\n\n\t\t\t\tmodel.toggleConflict(2, 1);\n\t\t\t\tmodel.toggleConflict(2, 2);\n\n\t\t\t\tassert.deepStrictEqual(\n\t\t\t\t\t{ result: model.getResult() },\n\t\t\t\t\t{\n\t\t\t\t\t\tresult:\n\t\t\t\t\t\t\t'Zürich\\nBern\\nBasel\\nChur\\nDavos\\nGenf\\nThun\\nfunction f(b:boolean) {}\\nfunction f(a:number) {}',\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t}\n\t\t);\n\t});\n\n\ttest('conflicts are reset', async () => {\n\t\tawait testMergeModel(\n\t\t\t{\n\t\t\t\t'languageId': 'typescript',\n\t\t\t\t'base': `import { h } from 'vs/base/browser/dom';\\nimport { Disposable, IDisposable } from 'vs/base/common/lifecycle';\\nimport { CodeEditorWidget } from 'vs/editor/browser/widget/codeEditorWidget';\\nimport { EditorOption } from 'vs/editor/common/config/editorOptions';\\nimport { autorun, IReader, observableFromEvent, ObservableValue } from 'vs/workbench/contrib/audioCues/browser/observable';\\nimport { LineRange } from 'vs/workbench/contrib/mergeEditor/browser/model/lineRange';\\n`,\n\t\t\t\t'input1': `import { h } from 'vs/base/browser/dom';\\nimport { Disposable, IDisposable } from 'vs/base/common/lifecycle';\\nimport { observableSignalFromEvent } from 'vs/base/common/observable';\\nimport { CodeEditorWidget } from 'vs/editor/browser/widget/codeEditorWidget';\\nimport { autorun, IReader, observableFromEvent } from 'vs/workbench/contrib/audioCues/browser/observable';\\nimport { LineRange } from 'vs/workbench/contrib/mergeEditor/browser/model/lineRange';\\n`,\n\t\t\t\t'input2': `import { h } from 'vs/base/browser/dom';\\nimport { Disposable, IDisposable } from 'vs/base/common/lifecycle';\\nimport { CodeEditorWidget } from 'vs/editor/browser/widget/codeEditorWidget';\\nimport { autorun, IReader, observableFromEvent, ObservableValue } from 'vs/workbench/contrib/audioCues/browser/observable';\\nimport { LineRange } from 'vs/workbench/contrib/mergeEditor/browser/model/lineRange';\\n`,\n\t\t\t\t'result': `import { h } from 'vs/base/browser/dom';\\r\\nimport { Disposable, IDisposable } from 'vs/base/common/lifecycle';\\r\\nimport { observableSignalFromEvent } from 'vs/base/common/observable';\\r\\nimport { CodeEditorWidget } from 'vs/editor/browser/widget/codeEditorWidget';\\r\\n<<<<<<< Updated upstream\\r\\nimport { autorun, IReader, observableFromEvent, ObservableValue } from 'vs/workbench/contrib/audioCues/browser/observable';\\r\\n=======\\r\\nimport { autorun, IReader, observableFromEvent } from 'vs/workbench/contrib/audioCues/browser/observable';\\r\\n>>>>>>> Stashed changes\\r\\nimport { LineRange } from 'vs/workbench/contrib/mergeEditor/browser/model/lineRange';\\r\\n`\n\t\t\t},\n\t\t\tmodel => {\n\t\t\t\tassert.deepStrictEqual(model.getProjections(), {\n\t\t\t\t\tbase: [\n\t\t\t\t\t\t`import { h } from 'vs/base/browser/dom';`,\n\t\t\t\t\t\t`import { Disposable, IDisposable } from 'vs/base/common/lifecycle';`,\n\t\t\t\t\t\t`⟦⟧₀import { CodeEditorWidget } from 'vs/editor/browser/widget/codeEditorWidget';`,\n\t\t\t\t\t\t`⟦import { EditorOption } from 'vs/editor/common/config/editorOptions';`,\n\t\t\t\t\t\t`import { autorun, IReader, observableFromEvent, ObservableValue } from 'vs/workbench/contrib/audioCues/browser/observable';`,\n\t\t\t\t\t\t`⟧₁import { LineRange } from 'vs/workbench/contrib/mergeEditor/browser/model/lineRange';`,\n\t\t\t\t\t\t'',\n\t\t\t\t\t],\n\t\t\t\t\tinput1: [\n\t\t\t\t\t\t`import { h } from 'vs/base/browser/dom';`,\n\t\t\t\t\t\t`import { Disposable, IDisposable } from 'vs/base/common/lifecycle';`,\n\t\t\t\t\t\t`⟦import { observableSignalFromEvent } from 'vs/base/common/observable';`,\n\t\t\t\t\t\t`⟧₀import { CodeEditorWidget } from 'vs/editor/browser/widget/codeEditorWidget';`,\n\t\t\t\t\t\t`⟦import { autorun, IReader, observableFromEvent } from 'vs/workbench/contrib/audioCues/browser/observable';`,\n\t\t\t\t\t\t`⟧₁import { LineRange } from 'vs/workbench/contrib/mergeEditor/browser/model/lineRange';`,\n\t\t\t\t\t\t'',\n\t\t\t\t\t],\n\t\t\t\t\tinput2: [\n\t\t\t\t\t\t`import { h } from 'vs/base/browser/dom';`,\n\t\t\t\t\t\t`import { Disposable, IDisposable } from 'vs/base/common/lifecycle';`,\n\t\t\t\t\t\t`⟦⟧₀import { CodeEditorWidget } from 'vs/editor/browser/widget/codeEditorWidget';`,\n\t\t\t\t\t\t`⟦import { autorun, IReader, observableFromEvent, ObservableValue } from 'vs/workbench/contrib/audioCues/browser/observable';`,\n\t\t\t\t\t\t`⟧₁import { LineRange } from 'vs/workbench/contrib/mergeEditor/browser/model/lineRange';`,\n\t\t\t\t\t\t'',\n\t\t\t\t\t],\n\t\t\t\t\tresult: [\n\t\t\t\t\t\t`import { h } from 'vs/base/browser/dom';`,\n\t\t\t\t\t\t`import { Disposable, IDisposable } from 'vs/base/common/lifecycle';`,\n\t\t\t\t\t\t`⟦import { observableSignalFromEvent } from 'vs/base/common/observable';`,\n\t\t\t\t\t\t`⟧{1✓}₀import { CodeEditorWidget } from 'vs/editor/browser/widget/codeEditorWidget';`,\n\t\t\t\t\t\t'⟦<<<<<<< Updated upstream',\n\t\t\t\t\t\t`import { autorun, IReader, observableFromEvent, ObservableValue } from 'vs/workbench/contrib/audioCues/browser/observable';`,\n\t\t\t\t\t\t'=======',\n\t\t\t\t\t\t`import { autorun, IReader, observableFromEvent } from 'vs/workbench/contrib/audioCues/browser/observable';`,\n\t\t\t\t\t\t'>>>>>>> Stashed changes',\n\t\t\t\t\t\t`⟧{unrecognized}₁import { LineRange } from 'vs/workbench/contrib/mergeEditor/browser/model/lineRange';`,\n\t\t\t\t\t\t'',\n\t\t\t\t\t],\n\t\t\t\t});\n\t\t\t}\n\t\t);\n\t});\n\n\ttest('auto-solve equal edits', async () => {\n\t\tawait testMergeModel(\n\t\t\t{\n\t\t\t\t'languageId': 'javascript',\n\t\t\t\t'base': `const { readFileSync } = require('fs');\\n\\nlet paths = process.argv.slice(2);\\nmain(paths);\\n\\nfunction main(paths) {\\n    // print the welcome message\\n    printMessage();\\n\\n    let data = getLineCountInfo(paths);\\n    console.log(\"Lines: \" + data.totalLineCount);\\n}\\n\\n/**\\n * Prints the welcome message\\n*/\\nfunction printMessage() {\\n    console.log(\"Welcome To Line Counter\");\\n}\\n\\n/**\\n * @param {string[]} paths\\n*/\\nfunction getLineCountInfo(paths) {\\n    let lineCounts = paths.map(path => ({ path, count: getLinesLength(readFileSync(path, 'utf8')) }));\\n    return {\\n        totalLineCount: lineCounts.reduce((acc, { count }) => acc + count, 0),\\n        lineCounts,\\n    };\\n}\\n\\n/**\\n * @param {string} str\\n */\\nfunction getLinesLength(str) {\\n    return str.split('\\\\n').length;\\n}\\n`,\n\t\t\t\t'input1': `const { readFileSync } = require('fs');\\n\\nlet paths = process.argv.slice(2);\\nmain(paths);\\n\\nfunction main(paths) {\\n    // print the welcome message\\n    printMessage();\\n\\n    const data = getLineCountInfo(paths);\\n    console.log(\"Lines: \" + data.totalLineCount);\\n}\\n\\nfunction printMessage() {\\n    console.log(\"Welcome To Line Counter\");\\n}\\n\\n/**\\n * @param {string[]} paths\\n*/\\nfunction getLineCountInfo(paths) {\\n    let lineCounts = paths.map(path => ({ path, count: getLinesLength(readFileSync(path, 'utf8')) }));\\n    return {\\n        totalLineCount: lineCounts.reduce((acc, { count }) => acc + count, 0),\\n        lineCounts,\\n    };\\n}\\n\\n/**\\n * @param {string} str\\n */\\nfunction getLinesLength(str) {\\n    return str.split('\\\\n').length;\\n}\\n`,\n\t\t\t\t'input2': `const { readFileSync } = require('fs');\\n\\nlet paths = process.argv.slice(2);\\nrun(paths);\\n\\nfunction run(paths) {\\n    // print the welcome message\\n    printMessage();\\n\\n    const data = getLineCountInfo(paths);\\n    console.log(\"Lines: \" + data.totalLineCount);\\n}\\n\\nfunction printMessage() {\\n    console.log(\"Welcome To Line Counter\");\\n}\\n\\n/**\\n * @param {string[]} paths\\n*/\\nfunction getLineCountInfo(paths) {\\n    let lineCounts = paths.map(path => ({ path, count: getLinesLength(readFileSync(path, 'utf8')) }));\\n    return {\\n        totalLineCount: lineCounts.reduce((acc, { count }) => acc + count, 0),\\n        lineCounts,\\n    };\\n}\\n\\n/**\\n * @param {string} str\\n */\\nfunction getLinesLength(str) {\\n    return str.split('\\\\n').length;\\n}\\n`,\n\t\t\t\t'result': '<<<<<<< uiae\\n>>>>>>> Stashed changes',\n\t\t\t\tresetResult: true,\n\t\t\t},\n\t\t\tasync model => {\n\t\t\t\tawait model.mergeModel.reset();\n\n\t\t\t\tassert.deepStrictEqual(model.getResult(), `const { readFileSync } = require('fs');\\n\\nlet paths = process.argv.slice(2);\\nrun(paths);\\n\\nfunction run(paths) {\\n    // print the welcome message\\n    printMessage();\\n\\n    const data = getLineCountInfo(paths);\\n    console.log(\"Lines: \" + data.totalLineCount);\\n}\\n\\nfunction printMessage() {\\n    console.log(\"Welcome To Line Counter\");\\n}\\n\\n/**\\n * @param {string[]} paths\\n*/\\nfunction getLineCountInfo(paths) {\\n    let lineCounts = paths.map(path => ({ path, count: getLinesLength(readFileSync(path, 'utf8')) }));\\n    return {\\n        totalLineCount: lineCounts.reduce((acc, { count }) => acc + count, 0),\\n        lineCounts,\\n    };\\n}\\n\\n/**\\n * @param {string} str\\n */\\nfunction getLinesLength(str) {\\n    return str.split('\\\\n').length;\\n}\\n`);\n\t\t\t}\n\t\t);\n\t});\n});\n\nasync function testMergeModel(\n\toptions: MergeModelOptions,\n\tfn: (model: MergeModelInterface) => void\n): Promise<void> {\n\tconst disposables = new DisposableStore();\n\tconst modelInterface = disposables.add(\n\t\tnew MergeModelInterface(options, createModelServices(disposables))\n\t);\n\tawait modelInterface.mergeModel.onInitialized;\n\tawait fn(modelInterface);\n\tdisposables.dispose();\n}\n\ninterface MergeModelOptions {\n\tlanguageId: string;\n\tinput1: string;\n\tinput2: string;\n\tbase: string;\n\tresult: string;\n\tresetResult?: boolean;\n}\n\nfunction toSmallNumbersDec(value: number): string {\n\tconst smallNumbers = ['₀', '₁', '₂', '₃', '₄', '₅', '₆', '₇', '₈', '₉'];\n\treturn value.toString().split('').map(c => smallNumbers[parseInt(c)]).join('');\n}\n\nclass MergeModelInterface extends Disposable {\n\tpublic readonly mergeModel: MergeEditorModel;\n\n\tconstructor(options: MergeModelOptions, instantiationService: IInstantiationService) {\n\t\tsuper();\n\t\tconst input1TextModel = this._register(createTextModel(options.input1, options.languageId));\n\t\tconst input2TextModel = this._register(createTextModel(options.input2, options.languageId));\n\t\tconst baseTextModel = this._register(createTextModel(options.base, options.languageId));\n\t\tconst resultTextModel = this._register(createTextModel(options.result, options.languageId));\n\n\t\tconst diffComputer: IMergeDiffComputer = {\n\t\t\tasync computeDiff(textModel1: ITextModel, textModel2: ITextModel, reader: IReader): Promise<IMergeDiffComputerResult> {\n\t\t\t\tconst result = await linesDiffComputers.getLegacy().computeDiff(\n\t\t\t\t\ttextModel1.getLinesContent(),\n\t\t\t\t\ttextModel2.getLinesContent(),\n\t\t\t\t\t{ ignoreTrimWhitespace: false, maxComputationTimeMs: 10000, computeMoves: false }\n\t\t\t\t);\n\t\t\t\tconst changes = result.changes.map(c =>\n\t\t\t\t\tnew DetailedLineRangeMapping(\n\t\t\t\t\t\ttoLineRange(c.original),\n\t\t\t\t\t\ttextModel1,\n\t\t\t\t\t\ttoLineRange(c.modified),\n\t\t\t\t\t\ttextModel2,\n\t\t\t\t\t\tc.innerChanges?.map(ic => toRangeMapping(ic)).filter(isDefined)\n\t\t\t\t\t)\n\t\t\t\t);\n\t\t\t\treturn {\n\t\t\t\t\tdiffs: changes\n\t\t\t\t};\n\t\t\t}\n\t\t};\n\n\t\tthis.mergeModel = this._register(instantiationService.createInstance(MergeEditorModel,\n\t\t\tbaseTextModel,\n\t\t\t{\n\t\t\t\ttextModel: input1TextModel,\n\t\t\t\tdescription: '',\n\t\t\t\tdetail: '',\n\t\t\t\ttitle: '',\n\t\t\t},\n\t\t\t{\n\t\t\t\ttextModel: input2TextModel,\n\t\t\t\tdescription: '',\n\t\t\t\tdetail: '',\n\t\t\t\ttitle: '',\n\t\t\t},\n\t\t\tresultTextModel,\n\t\t\tdiffComputer,\n\t\t\t{\n\t\t\t\tresetResult: options.resetResult || false\n\t\t\t},\n\t\t\tnew MergeEditorTelemetry(NullTelemetryService),\n\t\t));\n\t}\n\n\tgetProjections(): unknown {\n\t\tinterface LabeledRange {\n\t\t\trange: Range;\n\t\t\tlabel: string;\n\t\t}\n\t\tfunction applyRanges(textModel: ITextModel, ranges: LabeledRange[]): void {\n\t\t\ttextModel.applyEdits(ranges.map(({ range, label }) => ({\n\t\t\t\trange: range,\n\t\t\t\ttext: `⟦${textModel.getValueInRange(range)}⟧${label}`,\n\t\t\t})));\n\t\t}\n\t\tconst baseRanges = this.mergeModel.modifiedBaseRanges.get();\n\n\t\tconst baseTextModel = createTextModel(this.mergeModel.base.getValue());\n\t\tapplyRanges(\n\t\t\tbaseTextModel,\n\t\t\tbaseRanges.map<LabeledRange>((r, idx) => ({\n\t\t\t\trange: r.baseRange.toExclusiveRange(),\n\t\t\t\tlabel: toSmallNumbersDec(idx),\n\t\t\t}))\n\t\t);\n\n\t\tconst input1TextModel = createTextModel(this.mergeModel.input1.textModel.getValue());\n\t\tapplyRanges(\n\t\t\tinput1TextModel,\n\t\t\tbaseRanges.map<LabeledRange>((r, idx) => ({\n\t\t\t\trange: r.input1Range.toExclusiveRange(),\n\t\t\t\tlabel: toSmallNumbersDec(idx),\n\t\t\t}))\n\t\t);\n\n\t\tconst input2TextModel = createTextModel(this.mergeModel.input2.textModel.getValue());\n\t\tapplyRanges(\n\t\t\tinput2TextModel,\n\t\t\tbaseRanges.map<LabeledRange>((r, idx) => ({\n\t\t\t\trange: r.input2Range.toExclusiveRange(),\n\t\t\t\tlabel: toSmallNumbersDec(idx),\n\t\t\t}))\n\t\t);\n\n\t\tconst resultTextModel = createTextModel(this.mergeModel.resultTextModel.getValue());\n\t\tapplyRanges(\n\t\t\tresultTextModel,\n\t\t\tbaseRanges.map<LabeledRange>((r, idx) => ({\n\t\t\t\trange: this.mergeModel.getLineRangeInResult(r.baseRange).toExclusiveRange(),\n\t\t\t\tlabel: `{${this.mergeModel.getState(r).get()}}${toSmallNumbersDec(idx)}`,\n\t\t\t}))\n\t\t);\n\n\t\tconst result = {\n\t\t\tbase: baseTextModel.getValue(EndOfLinePreference.LF).split('\\n'),\n\t\t\tinput1: input1TextModel.getValue(EndOfLinePreference.LF).split('\\n'),\n\t\t\tinput2: input2TextModel.getValue(EndOfLinePreference.LF).split('\\n'),\n\t\t\tresult: resultTextModel.getValue(EndOfLinePreference.LF).split('\\n'),\n\t\t};\n\t\tbaseTextModel.dispose();\n\t\tinput1TextModel.dispose();\n\t\tinput2TextModel.dispose();\n\t\tresultTextModel.dispose();\n\t\treturn result;\n\t}\n\n\ttoggleConflict(conflictIdx: number, inputNumber: 1 | 2): void {\n\t\tconst baseRange = this.mergeModel.modifiedBaseRanges.get()[conflictIdx];\n\t\tif (!baseRange) {\n\t\t\tthrow new Error();\n\t\t}\n\t\tconst state = this.mergeModel.getState(baseRange).get();\n\t\ttransaction(tx => {\n\t\t\tthis.mergeModel.setState(baseRange, state.toggle(inputNumber), true, tx);\n\t\t});\n\t}\n\n\tgetResult(): string {\n\t\treturn this.mergeModel.resultTextModel.getValue();\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport assert from 'assert';\nimport { Disposable, DisposableStore } from '../../../../../base/common/lifecycle.js';\nimport { IReader, transaction } from '../../../../../base/common/observable.js';\nimport { isDefined } from '../../../../../base/common/types.js';\nimport { Range } from '../../../../../editor/common/core/range.js';\nimport { linesDiffComputers } from '../../../../../editor/common/diff/linesDiffComputers.js';\nimport { EndOfLinePreference, ITextModel } from '../../../../../editor/common/model.js';\nimport { createModelServices, createTextModel } from '../../../../../editor/test/common/testTextModel.js';\nimport { IInstantiationService } from '../../../../../platform/instantiation/common/instantiation.js';\nimport { NullTelemetryService } from '../../../../../platform/telemetry/common/telemetryUtils.js';\nimport { IMergeDiffComputer, IMergeDiffComputerResult, toLineRange, toRangeMapping } from '../../browser/model/diffComputer.js';\nimport { DetailedLineRangeMapping } from '../../browser/model/mapping.js';\nimport { MergeEditorModel } from '../../browser/model/mergeEditorModel.js';\nimport { MergeEditorTelemetry } from '../../browser/telemetry.js';\n\nsuite('merge editor model', () => {\n\t// todo: renable when failing case is found https://github.com/microsoft/vscode/pull/190444#issuecomment-1678151428\n\t// ensureNoDisposablesAreLeakedInTestSuite();\n\n\ttest('prepend line', async () => {\n\t\tawait testMergeModel(\n\t\t\t{\n\t\t\t\t'languageId': 'plaintext',\n\t\t\t\t'base': 'line1\\nline2',\n\t\t\t\t'input1': '0\\nline1\\nline2',\n\t\t\t\t'input2': '0\\nline1\\nline2',\n\t\t\t\t'result': ''\n\t\t\t},\n\t\t\tmodel => {\n\t\t\t\tassert.deepStrictEqual(model.getProjections(), {\n\t\t\t\t\tbase: ['⟦⟧₀line1', 'line2'],\n\t\t\t\t\tinput1: ['⟦0', '⟧₀line1', 'line2'],\n\t\t\t\t\tinput2: ['⟦0', '⟧₀line1', 'line2'],\n\t\t\t\t\tresult: ['⟦⟧{unrecognized}₀'],\n\t\t\t\t});\n\n\t\t\t\tmodel.toggleConflict(0, 1);\n\t\t\t\tassert.deepStrictEqual(\n\t\t\t\t\t{ result: model.getResult() },\n\t\t\t\t\t{ result: '0\\nline1\\nline2' }\n\t\t\t\t);\n\n\t\t\t\tmodel.toggleConflict(0, 2);\n\t\t\t\tassert.deepStrictEqual(\n\t\t\t\t\t{ result: model.getResult() },\n\t\t\t\t\t({ result: '0\\n0\\nline1\\nline2' })\n\t\t\t\t);\n\t\t\t}\n\t\t);\n\t});\n\n\ttest('empty base', async () => {\n\t\tawait testMergeModel(\n\t\t\t{\n\t\t\t\t'languageId': 'plaintext',\n\t\t\t\t'base': '',\n\t\t\t\t'input1': 'input1',\n\t\t\t\t'input2': 'input2',\n\t\t\t\t'result': ''\n\t\t\t},\n\t\t\tmodel => {\n\t\t\t\tassert.deepStrictEqual(model.getProjections(), {\n\t\t\t\t\tbase: ['⟦⟧₀'],\n\t\t\t\t\tinput1: ['⟦input1⟧₀'],\n\t\t\t\t\tinput2: ['⟦input2⟧₀'],\n\t\t\t\t\tresult: ['⟦⟧{base}₀'],\n\t\t\t\t});\n\n\t\t\t\tmodel.toggleConflict(0, 1);\n\t\t\t\tassert.deepStrictEqual(\n\t\t\t\t\t{ result: model.getResult() },\n\t\t\t\t\t({ result: 'input1' })\n\t\t\t\t);\n\n\t\t\t\tmodel.toggleConflict(0, 2);\n\t\t\t\tassert.deepStrictEqual(\n\t\t\t\t\t{ result: model.getResult() },\n\t\t\t\t\t({ result: 'input2' })\n\t\t\t\t);\n\t\t\t}\n\t\t);\n\t});\n\n\ttest('can merge word changes', async () => {\n\t\tawait testMergeModel(\n\t\t\t{\n\t\t\t\t'languageId': 'plaintext',\n\t\t\t\t'base': 'hello',\n\t\t\t\t'input1': 'hallo',\n\t\t\t\t'input2': 'helloworld',\n\t\t\t\t'result': ''\n\t\t\t},\n\t\t\tmodel => {\n\t\t\t\tassert.deepStrictEqual(model.getProjections(), {\n\t\t\t\t\tbase: ['⟦hello⟧₀'],\n\t\t\t\t\tinput1: ['⟦hallo⟧₀'],\n\t\t\t\t\tinput2: ['⟦helloworld⟧₀'],\n\t\t\t\t\tresult: ['⟦⟧{unrecognized}₀'],\n\t\t\t\t});\n\n\t\t\t\tmodel.toggleConflict(0, 1);\n\t\t\t\tmodel.toggleConflict(0, 2);\n\n\t\t\t\tassert.deepStrictEqual(\n\t\t\t\t\t{ result: model.getResult() },\n\t\t\t\t\t{ result: 'halloworld' }\n\t\t\t\t);\n\t\t\t}\n\t\t);\n\n\t});\n\n\ttest('can combine insertions at end of document', async () => {\n\t\tawait testMergeModel(\n\t\t\t{\n\t\t\t\t'languageId': 'plaintext',\n\t\t\t\t'base': 'Zürich\\nBern\\nBasel\\nChur\\nGenf\\nThun',\n\t\t\t\t'input1': 'Zürich\\nBern\\nChur\\nDavos\\nGenf\\nThun\\nfunction f(b:boolean) {}',\n\t\t\t\t'input2': 'Zürich\\nBern\\nBasel (FCB)\\nChur\\nGenf\\nThun\\nfunction f(a:number) {}',\n\t\t\t\t'result': 'Zürich\\nBern\\nBasel\\nChur\\nDavos\\nGenf\\nThun'\n\t\t\t},\n\t\t\tmodel => {\n\t\t\t\tassert.deepStrictEqual(model.getProjections(), {\n\t\t\t\t\tbase: ['Zürich', 'Bern', '⟦Basel', '⟧₀Chur', '⟦⟧₁Genf', 'Thun⟦⟧₂'],\n\t\t\t\t\tinput1: [\n\t\t\t\t\t\t'Zürich',\n\t\t\t\t\t\t'Bern',\n\t\t\t\t\t\t'⟦⟧₀Chur',\n\t\t\t\t\t\t'⟦Davos',\n\t\t\t\t\t\t'⟧₁Genf',\n\t\t\t\t\t\t'Thun',\n\t\t\t\t\t\t'⟦function f(b:boolean) {}⟧₂',\n\t\t\t\t\t],\n\t\t\t\t\tinput2: [\n\t\t\t\t\t\t'Zürich',\n\t\t\t\t\t\t'Bern',\n\t\t\t\t\t\t'⟦Basel (FCB)',\n\t\t\t\t\t\t'⟧₀Chur',\n\t\t\t\t\t\t'⟦⟧₁Genf',\n\t\t\t\t\t\t'Thun',\n\t\t\t\t\t\t'⟦function f(a:number) {}⟧₂',\n\t\t\t\t\t],\n\t\t\t\t\tresult: [\n\t\t\t\t\t\t'Zürich',\n\t\t\t\t\t\t'Bern',\n\t\t\t\t\t\t'⟦Basel',\n\t\t\t\t\t\t'⟧{base}₀Chur',\n\t\t\t\t\t\t'⟦Davos',\n\t\t\t\t\t\t'⟧{1✓}₁Genf',\n\t\t\t\t\t\t'Thun⟦⟧{base}₂',\n\t\t\t\t\t],\n\t\t\t\t});\n\n\t\t\t\tmodel.toggleConflict(2, 1);\n\t\t\t\tmodel.toggleConflict(2, 2);\n\n\t\t\t\tassert.deepStrictEqual(\n\t\t\t\t\t{ result: model.getResult() },\n\t\t\t\t\t{\n\t\t\t\t\t\tresult:\n\t\t\t\t\t\t\t'Zürich\\nBern\\nBasel\\nChur\\nDavos\\nGenf\\nThun\\nfunction f(b:boolean) {}\\nfunction f(a:number) {}',\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t}\n\t\t);\n\t});\n\n\ttest('conflicts are reset', async () => {\n\t\tawait testMergeModel(\n\t\t\t{\n\t\t\t\t'languageId': 'typescript',\n\t\t\t\t'base': `import { h } from 'vs/base/browser/dom';\\nimport { Disposable, IDisposable } from 'vs/base/common/lifecycle';\\nimport { CodeEditorWidget } from 'vs/editor/browser/widget/codeEditorWidget';\\nimport { EditorOption } from 'vs/editor/common/config/editorOptions';\\nimport { autorun, IReader, observableFromEvent, ObservableValue } from 'vs/workbench/contrib/audioCues/browser/observable';\\nimport { LineRange } from 'vs/workbench/contrib/mergeEditor/browser/model/lineRange';\\n`,\n\t\t\t\t'input1': `import { h } from 'vs/base/browser/dom';\\nimport { Disposable, IDisposable } from 'vs/base/common/lifecycle';\\nimport { observableSignalFromEvent } from 'vs/base/common/observable';\\nimport { CodeEditorWidget } from 'vs/editor/browser/widget/codeEditorWidget';\\nimport { autorun, IReader, observableFromEvent } from 'vs/workbench/contrib/audioCues/browser/observable';\\nimport { LineRange } from 'vs/workbench/contrib/mergeEditor/browser/model/lineRange';\\n`,\n\t\t\t\t'input2': `import { h } from 'vs/base/browser/dom';\\nimport { Disposable, IDisposable } from 'vs/base/common/lifecycle';\\nimport { CodeEditorWidget } from 'vs/editor/browser/widget/codeEditorWidget';\\nimport { autorun, IReader, observableFromEvent, ObservableValue } from 'vs/workbench/contrib/audioCues/browser/observable';\\nimport { LineRange } from 'vs/workbench/contrib/mergeEditor/browser/model/lineRange';\\n`,\n\t\t\t\t'result': `import { h } from 'vs/base/browser/dom';\\r\\nimport { Disposable, IDisposable } from 'vs/base/common/lifecycle';\\r\\nimport { observableSignalFromEvent } from 'vs/base/common/observable';\\r\\nimport { CodeEditorWidget } from 'vs/editor/browser/widget/codeEditorWidget';\\r\\n<<<<<<< Updated upstream\\r\\nimport { autorun, IReader, observableFromEvent, ObservableValue } from 'vs/workbench/contrib/audioCues/browser/observable';\\r\\n=======\\r\\nimport { autorun, IReader, observableFromEvent } from 'vs/workbench/contrib/audioCues/browser/observable';\\r\\n>>>>>>> Stashed changes\\r\\nimport { LineRange } from 'vs/workbench/contrib/mergeEditor/browser/model/lineRange';\\r\\n`\n\t\t\t},\n\t\t\tmodel => {\n\t\t\t\tassert.deepStrictEqual(model.getProjections(), {\n\t\t\t\t\tbase: [\n\t\t\t\t\t\t`import { h } from 'vs/base/browser/dom';`,\n\t\t\t\t\t\t`import { Disposable, IDisposable } from 'vs/base/common/lifecycle';`,\n\t\t\t\t\t\t`⟦⟧₀import { CodeEditorWidget } from 'vs/editor/browser/widget/codeEditorWidget';`,\n\t\t\t\t\t\t`⟦import { EditorOption } from 'vs/editor/common/config/editorOptions';`,\n\t\t\t\t\t\t`import { autorun, IReader, observableFromEvent, ObservableValue } from 'vs/workbench/contrib/audioCues/browser/observable';`,\n\t\t\t\t\t\t`⟧₁import { LineRange } from 'vs/workbench/contrib/mergeEditor/browser/model/lineRange';`,\n\t\t\t\t\t\t'',\n\t\t\t\t\t],\n\t\t\t\t\tinput1: [\n\t\t\t\t\t\t`import { h } from 'vs/base/browser/dom';`,\n\t\t\t\t\t\t`import { Disposable, IDisposable } from 'vs/base/common/lifecycle';`,\n\t\t\t\t\t\t`⟦import { observableSignalFromEvent } from 'vs/base/common/observable';`,\n\t\t\t\t\t\t`⟧₀import { CodeEditorWidget } from 'vs/editor/browser/widget/codeEditorWidget';`,\n\t\t\t\t\t\t`⟦import { autorun, IReader, observableFromEvent } from 'vs/workbench/contrib/audioCues/browser/observable';`,\n\t\t\t\t\t\t`⟧₁import { LineRange } from 'vs/workbench/contrib/mergeEditor/browser/model/lineRange';`,\n\t\t\t\t\t\t'',\n\t\t\t\t\t],\n\t\t\t\t\tinput2: [\n\t\t\t\t\t\t`import { h } from 'vs/base/browser/dom';`,\n\t\t\t\t\t\t`import { Disposable, IDisposable } from 'vs/base/common/lifecycle';`,\n\t\t\t\t\t\t`⟦⟧₀import { CodeEditorWidget } from 'vs/editor/browser/widget/codeEditorWidget';`,\n\t\t\t\t\t\t`⟦import { autorun, IReader, observableFromEvent, ObservableValue } from 'vs/workbench/contrib/audioCues/browser/observable';`,\n\t\t\t\t\t\t`⟧₁import { LineRange } from 'vs/workbench/contrib/mergeEditor/browser/model/lineRange';`,\n\t\t\t\t\t\t'',\n\t\t\t\t\t],\n\t\t\t\t\tresult: [\n\t\t\t\t\t\t`import { h } from 'vs/base/browser/dom';`,\n\t\t\t\t\t\t`import { Disposable, IDisposable } from 'vs/base/common/lifecycle';`,\n\t\t\t\t\t\t`⟦import { observableSignalFromEvent } from 'vs/base/common/observable';`,\n\t\t\t\t\t\t`⟧{1✓}₀import { CodeEditorWidget } from 'vs/editor/browser/widget/codeEditorWidget';`,\n\t\t\t\t\t\t'⟦<<<<<<< Updated upstream',\n\t\t\t\t\t\t`import { autorun, IReader, observableFromEvent, ObservableValue } from 'vs/workbench/contrib/audioCues/browser/observable';`,\n\t\t\t\t\t\t'=======',\n\t\t\t\t\t\t`import { autorun, IReader, observableFromEvent } from 'vs/workbench/contrib/audioCues/browser/observable';`,\n\t\t\t\t\t\t'>>>>>>> Stashed changes',\n\t\t\t\t\t\t`⟧{unrecognized}₁import { LineRange } from 'vs/workbench/contrib/mergeEditor/browser/model/lineRange';`,\n\t\t\t\t\t\t'',\n\t\t\t\t\t],\n\t\t\t\t});\n\t\t\t}\n\t\t);\n\t});\n\n\ttest('auto-solve equal edits', async () => {\n\t\tawait testMergeModel(\n\t\t\t{\n\t\t\t\t'languageId': 'javascript',\n\t\t\t\t'base': `const { readFileSync } = require('fs');\\n\\nlet paths = process.argv.slice(2);\\nmain(paths);\\n\\nfunction main(paths) {\\n    // print the welcome message\\n    printMessage();\\n\\n    let data = getLineCountInfo(paths);\\n    console.log(\"Lines: \" + data.totalLineCount);\\n}\\n\\n/**\\n * Prints the welcome message\\n*/\\nfunction printMessage() {\\n    console.log(\"Welcome To Line Counter\");\\n}\\n\\n/**\\n * @param {string[]} paths\\n*/\\nfunction getLineCountInfo(paths) {\\n    let lineCounts = paths.map(path => ({ path, count: getLinesLength(readFileSync(path, 'utf8')) }));\\n    return {\\n        totalLineCount: lineCounts.reduce((acc, { count }) => acc + count, 0),\\n        lineCounts,\\n    };\\n}\\n\\n/**\\n * @param {string} str\\n */\\nfunction getLinesLength(str) {\\n    return str.split('\\\\n').length;\\n}\\n`,\n\t\t\t\t'input1': `const { readFileSync } = require('fs');\\n\\nlet paths = process.argv.slice(2);\\nmain(paths);\\n\\nfunction main(paths) {\\n    // print the welcome message\\n    printMessage();\\n\\n    const data = getLineCountInfo(paths);\\n    console.log(\"Lines: \" + data.totalLineCount);\\n}\\n\\nfunction printMessage() {\\n    console.log(\"Welcome To Line Counter\");\\n}\\n\\n/**\\n * @param {string[]} paths\\n*/\\nfunction getLineCountInfo(paths) {\\n    let lineCounts = paths.map(path => ({ path, count: getLinesLength(readFileSync(path, 'utf8')) }));\\n    return {\\n        totalLineCount: lineCounts.reduce((acc, { count }) => acc + count, 0),\\n        lineCounts,\\n    };\\n}\\n\\n/**\\n * @param {string} str\\n */\\nfunction getLinesLength(str) {\\n    return str.split('\\\\n').length;\\n}\\n`,\n\t\t\t\t'input2': `const { readFileSync } = require('fs');\\n\\nlet paths = process.argv.slice(2);\\nrun(paths);\\n\\nfunction run(paths) {\\n    // print the welcome message\\n    printMessage();\\n\\n    const data = getLineCountInfo(paths);\\n    console.log(\"Lines: \" + data.totalLineCount);\\n}\\n\\nfunction printMessage() {\\n    console.log(\"Welcome To Line Counter\");\\n}\\n\\n/**\\n * @param {string[]} paths\\n*/\\nfunction getLineCountInfo(paths) {\\n    let lineCounts = paths.map(path => ({ path, count: getLinesLength(readFileSync(path, 'utf8')) }));\\n    return {\\n        totalLineCount: lineCounts.reduce((acc, { count }) => acc + count, 0),\\n        lineCounts,\\n    };\\n}\\n\\n/**\\n * @param {string} str\\n */\\nfunction getLinesLength(str) {\\n    return str.split('\\\\n').length;\\n}\\n`,\n\t\t\t\t'result': '<<<<<<< uiae\\n>>>>>>> Stashed changes',\n\t\t\t\tresetResult: true,\n\t\t\t},\n\t\t\tasync model => {\n\t\t\t\tawait model.mergeModel.reset();\n\n\t\t\t\tassert.deepStrictEqual(model.getResult(), `const { readFileSync } = require('fs');\\n\\nlet paths = process.argv.slice(2);\\nrun(paths);\\n\\nfunction run(paths) {\\n    // print the welcome message\\n    printMessage();\\n\\n    const data = getLineCountInfo(paths);\\n    console.log(\"Lines: \" + data.totalLineCount);\\n}\\n\\nfunction printMessage() {\\n    console.log(\"Welcome To Line Counter\");\\n}\\n\\n/**\\n * @param {string[]} paths\\n*/\\nfunction getLineCountInfo(paths) {\\n    let lineCounts = paths.map(path => ({ path, count: getLinesLength(readFileSync(path, 'utf8')) }));\\n    return {\\n        totalLineCount: lineCounts.reduce((acc, { count }) => acc + count, 0),\\n        lineCounts,\\n    };\\n}\\n\\n/**\\n * @param {string} str\\n */\\nfunction getLinesLength(str) {\\n    return str.split('\\\\n').length;\\n}\\n`);\n\t\t\t}\n\t\t);\n\t});\n});\n\nasync function testMergeModel(\n\toptions: MergeModelOptions,\n\tfn: (model: MergeModelInterface) => void\n): Promise<void> {\n\tconst disposables = new DisposableStore();\n\tconst modelInterface = disposables.add(\n\t\tnew MergeModelInterface(options, createModelServices(disposables))\n\t);\n\tawait modelInterface.mergeModel.onInitialized;\n\tawait fn(modelInterface);\n\tdisposables.dispose();\n}\n\ninterface MergeModelOptions {\n\tlanguageId: string;\n\tinput1: string;\n\tinput2: string;\n\tbase: string;\n\tresult: string;\n\tresetResult?: boolean;\n}\n\nfunction toSmallNumbersDec(value: number): string {\n\tconst smallNumbers = ['₀', '₁', '₂', '₃', '₄', '₅', '₆', '₇', '₈', '₉'];\n\treturn value.toString().split('').map(c => smallNumbers[parseInt(c)]).join('');\n}\n\nclass MergeModelInterface extends Disposable {\n\tpublic readonly mergeModel: MergeEditorModel;\n\n\tconstructor(options: MergeModelOptions, instantiationService: IInstantiationService) {\n\t\tsuper();\n\t\tconst input1TextModel = this._register(createTextModel(options.input1, options.languageId));\n\t\tconst input2TextModel = this._register(createTextModel(options.input2, options.languageId));\n\t\tconst baseTextModel = this._register(createTextModel(options.base, options.languageId));\n\t\tconst resultTextModel = this._register(createTextModel(options.result, options.languageId));\n\n\t\tconst diffComputer: IMergeDiffComputer = {\n\t\t\tasync computeDiff(textModel1: ITextModel, textModel2: ITextModel, reader: IReader): Promise<IMergeDiffComputerResult> {\n\t\t\t\tconst result = await linesDiffComputers.getLegacy().computeDiff(\n\t\t\t\t\ttextModel1.getLinesContent(),\n\t\t\t\t\ttextModel2.getLinesContent(),\n\t\t\t\t\t{ ignoreTrimWhitespace: false, maxComputationTimeMs: 10000, computeMoves: false }\n\t\t\t\t);\n\t\t\t\tconst changes = result.changes.map(c =>\n\t\t\t\t\tnew DetailedLineRangeMapping(\n\t\t\t\t\t\ttoLineRange(c.original),\n\t\t\t\t\t\ttextModel1,\n\t\t\t\t\t\ttoLineRange(c.modified),\n\t\t\t\t\t\ttextModel2,\n\t\t\t\t\t\tc.innerChanges?.map(ic => toRangeMapping(ic)).filter(isDefined)\n\t\t\t\t\t)\n\t\t\t\t);\n\t\t\t\treturn {\n\t\t\t\t\tdiffs: changes\n\t\t\t\t};\n\t\t\t}\n\t\t};\n\n\t\tthis.mergeModel = this._register(instantiationService.createInstance(MergeEditorModel,\n\t\t\tbaseTextModel,\n\t\t\t{\n\t\t\t\ttextModel: input1TextModel,\n\t\t\t\tdescription: '',\n\t\t\t\tdetail: '',\n\t\t\t\ttitle: '',\n\t\t\t},\n\t\t\t{\n\t\t\t\ttextModel: input2TextModel,\n\t\t\t\tdescription: '',\n\t\t\t\tdetail: '',\n\t\t\t\ttitle: '',\n\t\t\t},\n\t\t\tresultTextModel,\n\t\t\tdiffComputer,\n\t\t\t{\n\t\t\t\tresetResult: options.resetResult || false\n\t\t\t},\n\t\t\tnew MergeEditorTelemetry(NullTelemetryService),\n\t\t));\n\t}\n\n\tgetProjections(): unknown {\n\t\tinterface LabeledRange {\n\t\t\trange: Range;\n\t\t\tlabel: string;\n\t\t}\n\t\tfunction applyRanges(textModel: ITextModel, ranges: LabeledRange[]): void {\n\t\t\ttextModel.applyEdits(ranges.map(({ range, label }) => ({\n\t\t\t\trange: range,\n\t\t\t\ttext: `⟦${textModel.getValueInRange(range)}⟧${label}`,\n\t\t\t})));\n\t\t}\n\t\tconst baseRanges = this.mergeModel.modifiedBaseRanges.get();\n\n\t\tconst baseTextModel = createTextModel(this.mergeModel.base.getValue());\n\t\tapplyRanges(\n\t\t\tbaseTextModel,\n\t\t\tbaseRanges.map<LabeledRange>((r, idx) => ({\n\t\t\t\trange: r.baseRange.toExclusiveRange(),\n\t\t\t\tlabel: toSmallNumbersDec(idx),\n\t\t\t}))\n\t\t);\n\n\t\tconst input1TextModel = createTextModel(this.mergeModel.input1.textModel.getValue());\n\t\tapplyRanges(\n\t\t\tinput1TextModel,\n\t\t\tbaseRanges.map<LabeledRange>((r, idx) => ({\n\t\t\t\trange: r.input1Range.toExclusiveRange(),\n\t\t\t\tlabel: toSmallNumbersDec(idx),\n\t\t\t}))\n\t\t);\n\n\t\tconst input2TextModel = createTextModel(this.mergeModel.input2.textModel.getValue());\n\t\tapplyRanges(\n\t\t\tinput2TextModel,\n\t\t\tbaseRanges.map<LabeledRange>((r, idx) => ({\n\t\t\t\trange: r.input2Range.toExclusiveRange(),\n\t\t\t\tlabel: toSmallNumbersDec(idx),\n\t\t\t}))\n\t\t);\n\n\t\tconst resultTextModel = createTextModel(this.mergeModel.resultTextModel.getValue());\n\t\tapplyRanges(\n\t\t\tresultTextModel,\n\t\t\tbaseRanges.map<LabeledRange>((r, idx) => ({\n\t\t\t\trange: this.mergeModel.getLineRangeInResult(r.baseRange).toExclusiveRange(),\n\t\t\t\tlabel: `{${this.mergeModel.getState(r).get()}}${toSmallNumbersDec(idx)}`,\n\t\t\t}))\n\t\t);\n\n\t\tconst result = {\n\t\t\tbase: baseTextModel.getValue(EndOfLinePreference.LF).split('\\n'),\n\t\t\tinput1: input1TextModel.getValue(EndOfLinePreference.LF).split('\\n'),\n\t\t\tinput2: input2TextModel.getValue(EndOfLinePreference.LF).split('\\n'),\n\t\t\tresult: resultTextModel.getValue(EndOfLinePreference.LF).split('\\n'),\n\t\t};\n\t\tbaseTextModel.dispose();\n\t\tinput1TextModel.dispose();\n\t\tinput2TextModel.dispose();\n\t\tresultTextModel.dispose();\n\t\treturn result;\n\t}\n\n\ttoggleConflict(conflictIdx: number, inputNumber: 1 | 2): void {\n\t\tconst baseRange = this.mergeModel.modifiedBaseRanges.get()[conflictIdx];\n\t\tif (!baseRange) {\n\t\t\tthrow new Error();\n\t\t}\n\t\tconst state = this.mergeModel.getState(baseRange).get();\n\t\ttransaction(tx => {\n\t\t\tthis.mergeModel.setState(baseRange, state.toggle(inputNumber), true, tx);\n\t\t});\n\t}\n\n\tgetResult(): string {\n\t\treturn this.mergeModel.resultTextModel.getValue();\n\t}\n}\n"]}