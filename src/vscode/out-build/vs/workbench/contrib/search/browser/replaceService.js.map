{"version":3,"sources":["vs/workbench/contrib/search/browser/replaceService.ts"],"names":[],"mappings":"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","file":"replaceService.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as nls from '../../../../nls.js';\nimport { URI } from '../../../../base/common/uri.js';\nimport * as network from '../../../../base/common/network.js';\nimport { Disposable, IReference } from '../../../../base/common/lifecycle.js';\nimport { IReplaceService } from './replace.js';\nimport { IEditorService } from '../../../services/editor/common/editorService.js';\nimport { IModelService } from '../../../../editor/common/services/model.js';\nimport { ILanguageService } from '../../../../editor/common/languages/language.js';\nimport { ISearchViewModelWorkbenchService } from './searchTreeModel/searchViewModelWorkbenchService.js';\nimport { IProgress, IProgressStep } from '../../../../platform/progress/common/progress.js';\nimport { ITextModelService, ITextModelContentProvider } from '../../../../editor/common/services/resolverService.js';\nimport { IWorkbenchContribution } from '../../../common/contributions.js';\nimport { ScrollType } from '../../../../editor/common/editorCommon.js';\nimport { ITextModel } from '../../../../editor/common/model.js';\nimport { IInstantiationService } from '../../../../platform/instantiation/common/instantiation.js';\nimport { createTextBufferFactoryFromSnapshot } from '../../../../editor/common/model/textModel.js';\nimport { ITextFileService } from '../../../services/textfile/common/textfiles.js';\nimport { IBulkEditService, ResourceTextEdit } from '../../../../editor/browser/services/bulkEditService.js';\nimport { Range } from '../../../../editor/common/core/range.js';\nimport { EditOperation, ISingleEditOperation } from '../../../../editor/common/core/editOperation.js';\nimport { ILabelService } from '../../../../platform/label/common/label.js';\nimport { dirname } from '../../../../base/common/resources.js';\nimport { Promises } from '../../../../base/common/async.js';\nimport { SaveSourceRegistry } from '../../../common/editor.js';\nimport { CellUri, IResolvedNotebookEditorModel } from '../../notebook/common/notebookCommon.js';\nimport { INotebookEditorModelResolverService } from '../../notebook/common/notebookEditorModelResolverService.js';\nimport { ISearchTreeFileMatch, isSearchTreeFileMatch, ISearchTreeMatch, FileMatchOrMatch, isSearchTreeMatch } from './searchTreeModel/searchTreeCommon.js';\nimport { isIMatchInNotebook } from './notebookSearch/notebookSearchModelBase.js';\n\nconst REPLACE_PREVIEW = 'replacePreview';\n\nconst toReplaceResource = (fileResource: URI): URI => {\n\treturn fileResource.with({ scheme: network.Schemas.internal, fragment: REPLACE_PREVIEW, query: JSON.stringify({ scheme: fileResource.scheme }) });\n};\n\nconst toFileResource = (replaceResource: URI): URI => {\n\treturn replaceResource.with({ scheme: JSON.parse(replaceResource.query)['scheme'], fragment: '', query: '' });\n};\n\nexport class ReplacePreviewContentProvider implements ITextModelContentProvider, IWorkbenchContribution {\n\n\tstatic readonly ID = 'workbench.contrib.replacePreviewContentProvider';\n\n\tconstructor(\n\t\t@IInstantiationService private readonly instantiationService: IInstantiationService,\n\t\t@ITextModelService private readonly textModelResolverService: ITextModelService\n\t) {\n\t\tthis.textModelResolverService.registerTextModelContentProvider(network.Schemas.internal, this);\n\t}\n\n\tprovideTextContent(uri: URI): Promise<ITextModel> | null {\n\t\tif (uri.fragment === REPLACE_PREVIEW) {\n\t\t\treturn this.instantiationService.createInstance(ReplacePreviewModel).resolve(uri);\n\t\t}\n\t\treturn null;\n\t}\n}\n\nclass ReplacePreviewModel extends Disposable {\n\tconstructor(\n\t\t@IModelService private readonly modelService: IModelService,\n\t\t@ILanguageService private readonly languageService: ILanguageService,\n\t\t@ITextModelService private readonly textModelResolverService: ITextModelService,\n\t\t@IReplaceService private readonly replaceService: IReplaceService,\n\t\t@ISearchViewModelWorkbenchService private readonly searchWorkbenchService: ISearchViewModelWorkbenchService\n\t) {\n\t\tsuper();\n\t}\n\n\tasync resolve(replacePreviewUri: URI): Promise<ITextModel> {\n\t\tconst fileResource = toFileResource(replacePreviewUri);\n\t\tconst fileMatch = <ISearchTreeFileMatch>this.searchWorkbenchService.searchModel.searchResult.matches(false).filter(match => match.resource.toString() === fileResource.toString())[0];\n\t\tconst ref = this._register(await this.textModelResolverService.createModelReference(fileResource));\n\t\tconst sourceModel = ref.object.textEditorModel;\n\t\tconst sourceModelLanguageId = sourceModel.getLanguageId();\n\t\tconst replacePreviewModel = this.modelService.createModel(createTextBufferFactoryFromSnapshot(sourceModel.createSnapshot()), this.languageService.createById(sourceModelLanguageId), replacePreviewUri);\n\t\tthis._register(fileMatch.onChange(({ forceUpdateModel }) => this.update(sourceModel, replacePreviewModel, fileMatch, forceUpdateModel)));\n\t\tthis._register(this.searchWorkbenchService.searchModel.onReplaceTermChanged(() => this.update(sourceModel, replacePreviewModel, fileMatch)));\n\t\tthis._register(fileMatch.onDispose(() => replacePreviewModel.dispose())); // TODO@Sandeep we should not dispose a model directly but rather the reference (depends on https://github.com/microsoft/vscode/issues/17073)\n\t\tthis._register(replacePreviewModel.onWillDispose(() => this.dispose()));\n\t\tthis._register(sourceModel.onWillDispose(() => this.dispose()));\n\t\treturn replacePreviewModel;\n\t}\n\n\tprivate update(sourceModel: ITextModel, replacePreviewModel: ITextModel, fileMatch: ISearchTreeFileMatch, override: boolean = false): void {\n\t\tif (!sourceModel.isDisposed() && !replacePreviewModel.isDisposed()) {\n\t\t\tthis.replaceService.updateReplacePreview(fileMatch, override);\n\t\t}\n\t}\n}\n\nexport class ReplaceService implements IReplaceService {\n\n\tdeclare readonly _serviceBrand: undefined;\n\n\tprivate static readonly REPLACE_SAVE_SOURCE = SaveSourceRegistry.registerSource('searchReplace.source', nls.localize('searchReplace.source', \"Search and Replace\"));\n\n\tconstructor(\n\t\t@ITextFileService private readonly textFileService: ITextFileService,\n\t\t@IEditorService private readonly editorService: IEditorService,\n\t\t@ITextModelService private readonly textModelResolverService: ITextModelService,\n\t\t@IBulkEditService private readonly bulkEditorService: IBulkEditService,\n\t\t@ILabelService private readonly labelService: ILabelService,\n\t\t@INotebookEditorModelResolverService private readonly notebookEditorModelResolverService: INotebookEditorModelResolverService\n\t) { }\n\n\treplace(match: ISearchTreeMatch): Promise<any>;\n\treplace(files: ISearchTreeFileMatch[], progress?: IProgress<IProgressStep>): Promise<any>;\n\treplace(match: FileMatchOrMatch, progress?: IProgress<IProgressStep>, resource?: URI): Promise<any>;\n\tasync replace(arg: any, progress: IProgress<IProgressStep> | undefined = undefined, resource: URI | null = null): Promise<any> {\n\t\tconst edits = this.createEdits(arg, resource);\n\t\tawait this.bulkEditorService.apply(edits, { progress });\n\n\t\tconst rawTextPromises = edits.map(async e => {\n\t\t\tif (e.resource.scheme === network.Schemas.vscodeNotebookCell) {\n\t\t\t\tconst notebookResource = CellUri.parse(e.resource)?.notebook;\n\t\t\t\tif (notebookResource) {\n\t\t\t\t\tlet ref: IReference<IResolvedNotebookEditorModel> | undefined;\n\t\t\t\t\ttry {\n\t\t\t\t\t\tref = await this.notebookEditorModelResolverService.resolve(notebookResource);\n\t\t\t\t\t\tawait ref.object.save({ source: ReplaceService.REPLACE_SAVE_SOURCE });\n\t\t\t\t\t} finally {\n\t\t\t\t\t\tref?.dispose();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn;\n\t\t\t} else {\n\t\t\t\treturn this.textFileService.files.get(e.resource)?.save({ source: ReplaceService.REPLACE_SAVE_SOURCE });\n\t\t\t}\n\t\t});\n\n\t\treturn Promises.settled(rawTextPromises);\n\t}\n\n\tasync openReplacePreview(element: FileMatchOrMatch, preserveFocus?: boolean, sideBySide?: boolean, pinned?: boolean): Promise<any> {\n\t\tconst fileMatch = isSearchTreeMatch(element) ? element.parent() : element;\n\n\t\tconst editor = await this.editorService.openEditor({\n\t\t\toriginal: { resource: fileMatch.resource },\n\t\t\tmodified: { resource: toReplaceResource(fileMatch.resource) },\n\t\t\tlabel: nls.localize('fileReplaceChanges', \"{0} â†” {1} (Replace Preview)\", fileMatch.name(), fileMatch.name()),\n\t\t\tdescription: this.labelService.getUriLabel(dirname(fileMatch.resource), { relative: true }),\n\t\t\toptions: {\n\t\t\t\tpreserveFocus,\n\t\t\t\tpinned,\n\t\t\t\trevealIfVisible: true\n\t\t\t}\n\t\t});\n\t\tconst input = editor?.input;\n\t\tconst disposable = fileMatch.onDispose(() => {\n\t\t\tinput?.dispose();\n\t\t\tdisposable.dispose();\n\t\t});\n\t\tawait this.updateReplacePreview(fileMatch);\n\t\tif (editor) {\n\t\t\tconst editorControl = editor.getControl();\n\t\t\tif (isSearchTreeMatch(element) && editorControl) {\n\t\t\t\teditorControl.revealLineInCenter(element.range().startLineNumber, ScrollType.Immediate);\n\t\t\t}\n\t\t}\n\t}\n\n\tasync updateReplacePreview(fileMatch: ISearchTreeFileMatch, override: boolean = false): Promise<void> {\n\t\tconst replacePreviewUri = toReplaceResource(fileMatch.resource);\n\t\tconst [sourceModelRef, replaceModelRef] = await Promise.all([this.textModelResolverService.createModelReference(fileMatch.resource), this.textModelResolverService.createModelReference(replacePreviewUri)]);\n\t\tconst sourceModel = sourceModelRef.object.textEditorModel;\n\t\tconst replaceModel = replaceModelRef.object.textEditorModel;\n\t\t// If model is disposed do not update\n\t\ttry {\n\t\t\tif (sourceModel && replaceModel) {\n\t\t\t\tif (override) {\n\t\t\t\t\treplaceModel.setValue(sourceModel.getValue());\n\t\t\t\t} else {\n\t\t\t\t\treplaceModel.undo();\n\t\t\t\t}\n\t\t\t\tthis.applyEditsToPreview(fileMatch, replaceModel);\n\t\t\t}\n\t\t} finally {\n\t\t\tsourceModelRef.dispose();\n\t\t\treplaceModelRef.dispose();\n\t\t}\n\t}\n\n\tprivate applyEditsToPreview(fileMatch: ISearchTreeFileMatch, replaceModel: ITextModel): void {\n\t\tconst resourceEdits = this.createEdits(fileMatch, replaceModel.uri);\n\t\tconst modelEdits: ISingleEditOperation[] = [];\n\t\tfor (const resourceEdit of resourceEdits) {\n\t\t\tmodelEdits.push(EditOperation.replaceMove(\n\t\t\t\tRange.lift(resourceEdit.textEdit.range),\n\t\t\t\tresourceEdit.textEdit.text)\n\t\t\t);\n\t\t}\n\t\treplaceModel.pushEditOperations([], modelEdits.sort((a, b) => Range.compareRangesUsingStarts(a.range, b.range)), () => []);\n\t}\n\n\tprivate createEdits(arg: FileMatchOrMatch | ISearchTreeFileMatch[], resource: URI | null = null): ResourceTextEdit[] {\n\t\tconst edits: ResourceTextEdit[] = [];\n\n\t\tif (isSearchTreeMatch(arg)) {\n\t\t\tif (!arg.isReadonly) {\n\t\t\t\tif (isIMatchInNotebook(arg)) {\n\t\t\t\t\t// only apply edits if it's not a webview match, since webview matches are read-only\n\t\t\t\t\tconst match = arg;\n\t\t\t\t\tedits.push(this.createEdit(match, match.replaceString, match.cell?.uri));\n\t\t\t\t} else {\n\t\t\t\t\tconst match = <ISearchTreeMatch>arg;\n\t\t\t\t\tedits.push(this.createEdit(match, match.replaceString, resource));\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (isSearchTreeFileMatch(arg)) {\n\t\t\targ = [arg];\n\t\t}\n\n\t\tif (arg instanceof Array) {\n\t\t\targ.forEach(element => {\n\t\t\t\tconst fileMatch = <ISearchTreeFileMatch>element;\n\t\t\t\tif (fileMatch.count() > 0) {\n\t\t\t\t\tedits.push(...fileMatch.matches().flatMap(\n\t\t\t\t\t\tmatch => this.createEdits(match, resource)\n\t\t\t\t\t));\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\treturn edits;\n\t}\n\n\tprivate createEdit(match: ISearchTreeMatch, text: string, resource: URI | null = null): ResourceTextEdit {\n\t\tconst fileMatch: ISearchTreeFileMatch = match.parent();\n\t\treturn new ResourceTextEdit(\n\t\t\tresource ?? fileMatch.resource,\n\t\t\t{ range: match.range(), text }, undefined, undefined\n\t\t);\n\t}\n}\n"]}