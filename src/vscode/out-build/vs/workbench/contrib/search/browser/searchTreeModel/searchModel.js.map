{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/contrib/search/browser/searchTreeModel/searchModel.ts","vs/workbench/contrib/search/browser/searchTreeModel/searchModel.ts"],"names":[],"mappings":"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","file":"searchModel.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\n\nimport { CancellationToken, CancellationTokenSource } from '../../../../../base/common/cancellation.js';\nimport * as errors from '../../../../../base/common/errors.js';\nimport { Emitter, Event, PauseableEmitter } from '../../../../../base/common/event.js';\nimport { Lazy } from '../../../../../base/common/lazy.js';\nimport { Disposable, IDisposable } from '../../../../../base/common/lifecycle.js';\nimport { Schemas } from '../../../../../base/common/network.js';\nimport { URI } from '../../../../../base/common/uri.js';\nimport { IConfigurationService } from '../../../../../platform/configuration/common/configuration.js';\nimport { IInstantiationService } from '../../../../../platform/instantiation/common/instantiation.js';\nimport { ILogService } from '../../../../../platform/log/common/log.js';\nimport { ITelemetryService } from '../../../../../platform/telemetry/common/telemetry.js';\nimport { INotebookSearchService } from '../../common/notebookSearch.js';\nimport { ReplacePattern } from '../../../../services/search/common/replace.js';\nimport { IFileMatch, IPatternInfo, ISearchComplete, ISearchConfigurationProperties, ISearchProgressItem, ISearchService, ITextQuery, ITextSearchStats, QueryType, SearchCompletionExitCode } from '../../../../services/search/common/search.js';\nimport { IChangeEvent, mergeSearchResultEvents, SearchModelLocation, ISearchModel, ISearchResult, SEARCH_MODEL_PREFIX } from './searchTreeCommon.js';\nimport { SearchResultImpl } from './searchResult.js';\nimport { ISearchViewModelWorkbenchService } from './searchViewModelWorkbenchService.js';\n\nexport class SearchModelImpl extends Disposable implements ISearchModel {\n\n\tprivate _searchResult: ISearchResult;\n\tprivate _searchQuery: ITextQuery | null = null;\n\tprivate _replaceActive: boolean = false;\n\tprivate _replaceString: string | null = null;\n\tprivate _replacePattern: ReplacePattern | null = null;\n\tprivate _preserveCase: boolean = false;\n\tprivate _startStreamDelay: Promise<void> = Promise.resolve();\n\tprivate readonly _resultQueue: IFileMatch[] = [];\n\tprivate readonly _aiResultQueue: IFileMatch[] = [];\n\n\tprivate readonly _onReplaceTermChanged: Emitter<void> = this._register(new Emitter<void>());\n\treadonly onReplaceTermChanged: Event<void> = this._onReplaceTermChanged.event;\n\n\tprivate readonly _onSearchResultChanged = this._register(new PauseableEmitter<IChangeEvent>({\n\t\tmerge: mergeSearchResultEvents\n\t}));\n\treadonly onSearchResultChanged: Event<IChangeEvent> = this._onSearchResultChanged.event;\n\n\tprivate currentCancelTokenSource: CancellationTokenSource | null = null;\n\tprivate currentAICancelTokenSource: CancellationTokenSource | null = null;\n\tprivate searchCancelledForNewSearch: boolean = false;\n\tprivate aiSearchCancelledForNewSearch: boolean = false;\n\tpublic location: SearchModelLocation = SearchModelLocation.PANEL;\n\tprivate readonly _aiTextResultProviderName: Lazy<Promise<string | undefined>>;\n\n\tprivate readonly _id: string;\n\n\tconstructor(\n\t\t@ISearchService private readonly searchService: ISearchService,\n\t\t@ITelemetryService private readonly telemetryService: ITelemetryService,\n\t\t@IConfigurationService private readonly configurationService: IConfigurationService,\n\t\t@IInstantiationService private readonly instantiationService: IInstantiationService,\n\t\t@ILogService private readonly logService: ILogService,\n\t\t@INotebookSearchService private readonly notebookSearchService: INotebookSearchService,\n\t) {\n\t\tsuper();\n\t\tthis._searchResult = this.instantiationService.createInstance(SearchResultImpl, this);\n\t\tthis._register(this._searchResult.onChange((e) => this._onSearchResultChanged.fire(e)));\n\n\t\tthis._aiTextResultProviderName = new Lazy(async () => this.searchService.getAIName());\n\t\tthis._id = SEARCH_MODEL_PREFIX + Date.now().toString();\n\t}\n\n\tid(): string {\n\t\treturn this._id;\n\t}\n\n\tasync getAITextResultProviderName(): Promise<string> {\n\t\tconst result = await this._aiTextResultProviderName.value;\n\t\tif (!result) {\n\t\t\tthrow Error('Fetching AI name when no provider present.');\n\t\t}\n\t\treturn result;\n\t}\n\n\tisReplaceActive(): boolean {\n\t\treturn this._replaceActive;\n\t}\n\n\tset replaceActive(replaceActive: boolean) {\n\t\tthis._replaceActive = replaceActive;\n\t}\n\n\tget replacePattern(): ReplacePattern | null {\n\t\treturn this._replacePattern;\n\t}\n\n\tget replaceString(): string {\n\t\treturn this._replaceString || '';\n\t}\n\n\tset preserveCase(value: boolean) {\n\t\tthis._preserveCase = value;\n\t}\n\n\tget preserveCase(): boolean {\n\t\treturn this._preserveCase;\n\t}\n\n\tset replaceString(replaceString: string) {\n\t\tthis._replaceString = replaceString;\n\t\tif (this._searchQuery) {\n\t\t\tthis._replacePattern = new ReplacePattern(replaceString, this._searchQuery.contentPattern);\n\t\t}\n\t\tthis._onReplaceTermChanged.fire();\n\t}\n\n\tget searchResult(): ISearchResult {\n\t\treturn this._searchResult;\n\t}\n\n\taiSearch(onResult: (result: ISearchProgressItem | undefined) => void): Promise<ISearchComplete> {\n\t\tif (this.hasAIResults) {\n\t\t\t// already has matches or pending matches\n\t\t\tthrow Error('AI results already exist');\n\t\t}\n\t\tif (!this._searchQuery) {\n\t\t\tthrow Error('No search query');\n\t\t}\n\n\t\tconst searchInstanceID = Date.now().toString();\n\t\tconst tokenSource = new CancellationTokenSource();\n\t\tthis.currentAICancelTokenSource = tokenSource;\n\t\tconst start = Date.now();\n\t\tconst asyncAIResults = this.searchService.aiTextSearch(\n\t\t\t{ ...this._searchQuery, contentPattern: this._searchQuery.contentPattern.pattern, type: QueryType.aiText },\n\t\t\ttokenSource.token,\n\t\t\tasync (p: ISearchProgressItem) => {\n\t\t\t\tonResult(p);\n\t\t\t\tthis.onSearchProgress(p, searchInstanceID, false, true);\n\t\t\t}).finally(() => {\n\t\t\t\ttokenSource.dispose(true);\n\t\t\t}).then(\n\t\t\t\tvalue => {\n\t\t\t\t\tif (value.results.length === 0) {\n\t\t\t\t\t\t// alert of no results since onProgress won't be called\n\t\t\t\t\t\tonResult(undefined);\n\t\t\t\t\t}\n\t\t\t\t\tthis.onSearchCompleted(value, Date.now() - start, searchInstanceID, true);\n\t\t\t\t\treturn value;\n\t\t\t\t},\n\t\t\t\te => {\n\t\t\t\t\tthis.onSearchError(e, Date.now() - start, true);\n\t\t\t\t\tthrow e;\n\t\t\t\t});\n\t\treturn asyncAIResults;\n\t}\n\n\tprivate doSearch(query: ITextQuery, progressEmitter: Emitter<void>, searchQuery: ITextQuery, searchInstanceID: string, onProgress?: (result: ISearchProgressItem) => void, callerToken?: CancellationToken): {\n\t\tasyncResults: Promise<ISearchComplete>;\n\t\tsyncResults: IFileMatch<URI>[];\n\t} {\n\t\tconst asyncGenerateOnProgress = async (p: ISearchProgressItem) => {\n\t\t\tprogressEmitter.fire();\n\t\t\tthis.onSearchProgress(p, searchInstanceID, false, false);\n\t\t\tonProgress?.(p);\n\t\t};\n\n\t\tconst syncGenerateOnProgress = (p: ISearchProgressItem) => {\n\t\t\tprogressEmitter.fire();\n\t\t\tthis.onSearchProgress(p, searchInstanceID, true);\n\t\t\tonProgress?.(p);\n\t\t};\n\t\tconst tokenSource = this.currentCancelTokenSource = new CancellationTokenSource(callerToken);\n\n\t\tconst notebookResult = this.notebookSearchService.notebookSearch(query, tokenSource.token, searchInstanceID, asyncGenerateOnProgress);\n\t\tconst textResult = this.searchService.textSearchSplitSyncAsync(\n\t\t\tsearchQuery,\n\t\t\ttokenSource.token, asyncGenerateOnProgress,\n\t\t\tnotebookResult.openFilesToScan,\n\t\t\tnotebookResult.allScannedFiles,\n\t\t);\n\n\t\tconst syncResults = textResult.syncResults.results;\n\t\tsyncResults.forEach(p => { if (p) { syncGenerateOnProgress(p); } });\n\n\t\tconst getAsyncResults = async (): Promise<ISearchComplete> => {\n\t\t\tconst searchStart = Date.now();\n\n\t\t\t// resolve async parts of search\n\t\t\tconst allClosedEditorResults = await textResult.asyncResults;\n\t\t\tconst resolvedNotebookResults = await notebookResult.completeData;\n\t\t\tconst searchLength = Date.now() - searchStart;\n\t\t\tconst resolvedResult: ISearchComplete = {\n\t\t\t\tresults: [...allClosedEditorResults.results, ...resolvedNotebookResults.results],\n\t\t\t\tmessages: [...allClosedEditorResults.messages, ...resolvedNotebookResults.messages],\n\t\t\t\tlimitHit: allClosedEditorResults.limitHit || resolvedNotebookResults.limitHit,\n\t\t\t\texit: allClosedEditorResults.exit,\n\t\t\t\tstats: allClosedEditorResults.stats,\n\t\t\t};\n\t\t\tthis.logService.trace(`whole search time | ${searchLength}ms`);\n\t\t\treturn resolvedResult;\n\t\t};\n\t\treturn {\n\t\t\tasyncResults: getAsyncResults()\n\t\t\t\t.finally(() => tokenSource.dispose(true)),\n\t\t\tsyncResults\n\t\t};\n\t}\n\n\tget hasAIResults(): boolean {\n\t\treturn !!(this.searchResult.getCachedSearchComplete(true)) || (!!this.currentAICancelTokenSource && !this.currentAICancelTokenSource.token.isCancellationRequested);\n\t}\n\n\tget hasPlainResults(): boolean {\n\t\treturn !!(this.searchResult.getCachedSearchComplete(false)) || (!!this.currentCancelTokenSource && !this.currentCancelTokenSource.token.isCancellationRequested);\n\t}\n\n\tsearch(query: ITextQuery, onProgress?: (result: ISearchProgressItem) => void, callerToken?: CancellationToken): {\n\t\tasyncResults: Promise<ISearchComplete>;\n\t\tsyncResults: IFileMatch<URI>[];\n\t} {\n\t\tthis.cancelSearch(true);\n\n\t\tthis._searchQuery = query;\n\t\tif (!this.searchConfig.searchOnType) {\n\t\t\tthis.searchResult.clear();\n\t\t}\n\t\tconst searchInstanceID = Date.now().toString();\n\n\t\tthis._searchResult.query = this._searchQuery;\n\n\t\tconst progressEmitter = this._register(new Emitter<void>());\n\t\tthis._replacePattern = new ReplacePattern(this.replaceString, this._searchQuery.contentPattern);\n\n\t\t// In search on type case, delay the streaming of results just a bit, so that we don't flash the only \"local results\" fast path\n\t\tthis._startStreamDelay = new Promise(resolve => setTimeout(resolve, this.searchConfig.searchOnType ? 150 : 0));\n\n\t\tconst req = this.doSearch(query, progressEmitter, this._searchQuery, searchInstanceID, onProgress, callerToken);\n\t\tconst asyncResults = req.asyncResults;\n\t\tconst syncResults = req.syncResults;\n\n\t\tif (onProgress) {\n\t\t\tsyncResults.forEach(p => {\n\t\t\t\tif (p) {\n\t\t\t\t\tonProgress(p);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tconst start = Date.now();\n\t\tlet event: IDisposable | undefined;\n\n\t\tconst progressEmitterPromise = new Promise(resolve => {\n\t\t\tevent = Event.once(progressEmitter.event)(resolve);\n\t\t\treturn event;\n\t\t});\n\n\t\tPromise.race([asyncResults, progressEmitterPromise]).finally(() => {\n\t\t\t/* __GDPR__\n\t\t\t\t\"searchResultsFirstRender\" : {\n\t\t\t\t\t\"owner\": \"roblourens\",\n\t\t\t\t\t\"duration\" : { \"classification\": \"SystemMetaData\", \"purpose\": \"PerformanceAndHealth\", \"isMeasurement\": true }\n\t\t\t\t}\n\t\t\t*/\n\t\t\tevent?.dispose();\n\t\t\tthis.telemetryService.publicLog('searchResultsFirstRender', { duration: Date.now() - start });\n\t\t});\n\n\t\ttry {\n\t\t\treturn {\n\t\t\t\tasyncResults: asyncResults.then(\n\t\t\t\t\tvalue => {\n\t\t\t\t\t\tthis.onSearchCompleted(value, Date.now() - start, searchInstanceID, false);\n\t\t\t\t\t\treturn value;\n\t\t\t\t\t},\n\t\t\t\t\te => {\n\t\t\t\t\t\tthis.onSearchError(e, Date.now() - start, false);\n\t\t\t\t\t\tthrow e;\n\t\t\t\t\t}),\n\t\t\t\tsyncResults\n\t\t\t};\n\t\t} finally {\n\t\t\t/* __GDPR__\n\t\t\t\t\"searchResultsFinished\" : {\n\t\t\t\t\t\"owner\": \"roblourens\",\n\t\t\t\t\t\"duration\" : { \"classification\": \"SystemMetaData\", \"purpose\": \"PerformanceAndHealth\", \"isMeasurement\": true }\n\t\t\t\t}\n\t\t\t*/\n\t\t\tthis.telemetryService.publicLog('searchResultsFinished', { duration: Date.now() - start });\n\t\t}\n\t}\n\n\tprivate onSearchCompleted(completed: ISearchComplete | undefined, duration: number, searchInstanceID: string, ai: boolean): ISearchComplete | undefined {\n\t\tif (!this._searchQuery) {\n\t\t\tthrow new Error('onSearchCompleted must be called after a search is started');\n\t\t}\n\n\t\tif (ai) {\n\t\t\tthis._searchResult.add(this._aiResultQueue, searchInstanceID, true);\n\t\t\tthis._aiResultQueue.length = 0;\n\t\t} else {\n\t\t\tthis._searchResult.add(this._resultQueue, searchInstanceID, false);\n\t\t\tthis._resultQueue.length = 0;\n\t\t}\n\n\t\tthis.searchResult.setCachedSearchComplete(completed, ai);\n\n\t\tconst options: IPatternInfo = Object.assign({}, this._searchQuery.contentPattern);\n\t\t// eslint-disable-next-line local/code-no-any-casts\n\t\tdelete (options as any).pattern;\n\n\t\tconst stats = completed && completed.stats as ITextSearchStats;\n\n\t\tconst fileSchemeOnly = this._searchQuery.folderQueries.every(fq => fq.folder.scheme === Schemas.file);\n\t\tconst otherSchemeOnly = this._searchQuery.folderQueries.every(fq => fq.folder.scheme !== Schemas.file);\n\t\tconst scheme = fileSchemeOnly ? Schemas.file :\n\t\t\totherSchemeOnly ? 'other' :\n\t\t\t\t'mixed';\n\n\t\t/* __GDPR__\n\t\t\t\"searchResultsShown\" : {\n\t\t\t\t\"owner\": \"roblourens\",\n\t\t\t\t\"count\" : { \"classification\": \"SystemMetaData\", \"purpose\": \"FeatureInsight\", \"isMeasurement\": true },\n\t\t\t\t\"fileCount\": { \"classification\": \"SystemMetaData\", \"purpose\": \"FeatureInsight\", \"isMeasurement\": true },\n\t\t\t\t\"options\": { \"${inline}\": [ \"${IPatternInfo}\" ] },\n\t\t\t\t\"duration\": { \"classification\": \"SystemMetaData\", \"purpose\": \"PerformanceAndHealth\", \"isMeasurement\": true },\n\t\t\t\t\"type\" : { \"classification\": \"SystemMetaData\", \"purpose\": \"PerformanceAndHealth\" },\n\t\t\t\t\"scheme\" : { \"classification\": \"SystemMetaData\", \"purpose\": \"PerformanceAndHealth\" },\n\t\t\t\t\"searchOnTypeEnabled\" : { \"classification\": \"SystemMetaData\", \"purpose\": \"FeatureInsight\" }\n\t\t\t}\n\t\t*/\n\t\tthis.telemetryService.publicLog('searchResultsShown', {\n\t\t\tcount: this._searchResult.count(),\n\t\t\tfileCount: this._searchResult.fileCount(),\n\t\t\toptions,\n\t\t\tduration,\n\t\t\ttype: stats && stats.type,\n\t\t\tscheme,\n\t\t\tsearchOnTypeEnabled: this.searchConfig.searchOnType\n\t\t});\n\t\treturn completed;\n\t}\n\n\tprivate onSearchError(e: any, duration: number, ai: boolean): void {\n\t\tif (errors.isCancellationError(e)) {\n\t\t\tthis.onSearchCompleted(\n\t\t\t\t(ai ? this.aiSearchCancelledForNewSearch : this.searchCancelledForNewSearch)\n\t\t\t\t\t? { exit: SearchCompletionExitCode.NewSearchStarted, results: [], messages: [] }\n\t\t\t\t\t: undefined,\n\t\t\t\tduration, '', ai);\n\t\t\tif (ai) {\n\t\t\t\tthis.aiSearchCancelledForNewSearch = false;\n\t\t\t} else {\n\t\t\t\tthis.searchCancelledForNewSearch = false;\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate onSearchProgress(p: ISearchProgressItem, searchInstanceID: string, sync = true, ai: boolean = false) {\n\t\tconst targetQueue = ai ? this._aiResultQueue : this._resultQueue;\n\t\tif ((<IFileMatch>p).resource) {\n\t\t\ttargetQueue.push(<IFileMatch>p);\n\t\t\tif (sync) {\n\t\t\t\tif (targetQueue.length) {\n\t\t\t\t\tthis._searchResult.add(targetQueue, searchInstanceID, false, true);\n\t\t\t\t\ttargetQueue.length = 0;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tthis._startStreamDelay.then(() => {\n\t\t\t\t\tif (targetQueue.length) {\n\t\t\t\t\t\tthis._searchResult.add(targetQueue, searchInstanceID, ai, !ai);\n\t\t\t\t\t\ttargetQueue.length = 0;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\n\t\t}\n\t}\n\n\tprivate get searchConfig() {\n\t\treturn this.configurationService.getValue<ISearchConfigurationProperties>('search');\n\t}\n\n\tcancelSearch(cancelledForNewSearch = false): boolean {\n\t\tif (this.currentCancelTokenSource) {\n\t\t\tthis.searchCancelledForNewSearch = cancelledForNewSearch;\n\t\t\tthis.currentCancelTokenSource.cancel();\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\tcancelAISearch(cancelledForNewSearch = false): boolean {\n\t\tif (this.currentAICancelTokenSource) {\n\t\t\tthis.aiSearchCancelledForNewSearch = cancelledForNewSearch;\n\t\t\tthis.currentAICancelTokenSource.cancel();\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\tclearAiSearchResults(): void {\n\t\tthis._aiResultQueue.length = 0;\n\t\t// it's not clear all as we are only clearing the AI results\n\t\tthis._searchResult.aiTextSearchResult.clear(false);\n\t}\n\toverride dispose(): void {\n\t\tthis.cancelSearch();\n\t\tthis.cancelAISearch();\n\t\tthis.searchResult.dispose();\n\t\tsuper.dispose();\n\t}\n\n}\n\n\nexport class SearchViewModelWorkbenchService implements ISearchViewModelWorkbenchService {\n\n\tdeclare readonly _serviceBrand: undefined;\n\tprivate _searchModel: SearchModelImpl | null = null;\n\n\tconstructor(@IInstantiationService private readonly instantiationService: IInstantiationService) {\n\t}\n\n\tget searchModel(): SearchModelImpl {\n\t\tif (!this._searchModel) {\n\t\t\tthis._searchModel = this.instantiationService.createInstance(SearchModelImpl);\n\t\t}\n\t\treturn this._searchModel;\n\t}\n\n\tset searchModel(searchModel: SearchModelImpl) {\n\t\tthis._searchModel?.dispose();\n\t\tthis._searchModel = searchModel;\n\t}\n}\n\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\n\nimport { CancellationToken, CancellationTokenSource } from '../../../../../base/common/cancellation.js';\nimport * as errors from '../../../../../base/common/errors.js';\nimport { Emitter, Event, PauseableEmitter } from '../../../../../base/common/event.js';\nimport { Lazy } from '../../../../../base/common/lazy.js';\nimport { Disposable, IDisposable } from '../../../../../base/common/lifecycle.js';\nimport { Schemas } from '../../../../../base/common/network.js';\nimport { URI } from '../../../../../base/common/uri.js';\nimport { IConfigurationService } from '../../../../../platform/configuration/common/configuration.js';\nimport { IInstantiationService } from '../../../../../platform/instantiation/common/instantiation.js';\nimport { ILogService } from '../../../../../platform/log/common/log.js';\nimport { ITelemetryService } from '../../../../../platform/telemetry/common/telemetry.js';\nimport { INotebookSearchService } from '../../common/notebookSearch.js';\nimport { ReplacePattern } from '../../../../services/search/common/replace.js';\nimport { IFileMatch, IPatternInfo, ISearchComplete, ISearchConfigurationProperties, ISearchProgressItem, ISearchService, ITextQuery, ITextSearchStats, QueryType, SearchCompletionExitCode } from '../../../../services/search/common/search.js';\nimport { IChangeEvent, mergeSearchResultEvents, SearchModelLocation, ISearchModel, ISearchResult, SEARCH_MODEL_PREFIX } from './searchTreeCommon.js';\nimport { SearchResultImpl } from './searchResult.js';\nimport { ISearchViewModelWorkbenchService } from './searchViewModelWorkbenchService.js';\n\nexport class SearchModelImpl extends Disposable implements ISearchModel {\n\n\tprivate _searchResult: ISearchResult;\n\tprivate _searchQuery: ITextQuery | null = null;\n\tprivate _replaceActive: boolean = false;\n\tprivate _replaceString: string | null = null;\n\tprivate _replacePattern: ReplacePattern | null = null;\n\tprivate _preserveCase: boolean = false;\n\tprivate _startStreamDelay: Promise<void> = Promise.resolve();\n\tprivate readonly _resultQueue: IFileMatch[] = [];\n\tprivate readonly _aiResultQueue: IFileMatch[] = [];\n\n\tprivate readonly _onReplaceTermChanged: Emitter<void> = this._register(new Emitter<void>());\n\treadonly onReplaceTermChanged: Event<void> = this._onReplaceTermChanged.event;\n\n\tprivate readonly _onSearchResultChanged = this._register(new PauseableEmitter<IChangeEvent>({\n\t\tmerge: mergeSearchResultEvents\n\t}));\n\treadonly onSearchResultChanged: Event<IChangeEvent> = this._onSearchResultChanged.event;\n\n\tprivate currentCancelTokenSource: CancellationTokenSource | null = null;\n\tprivate currentAICancelTokenSource: CancellationTokenSource | null = null;\n\tprivate searchCancelledForNewSearch: boolean = false;\n\tprivate aiSearchCancelledForNewSearch: boolean = false;\n\tpublic location: SearchModelLocation = SearchModelLocation.PANEL;\n\tprivate readonly _aiTextResultProviderName: Lazy<Promise<string | undefined>>;\n\n\tprivate readonly _id: string;\n\n\tconstructor(\n\t\t@ISearchService private readonly searchService: ISearchService,\n\t\t@ITelemetryService private readonly telemetryService: ITelemetryService,\n\t\t@IConfigurationService private readonly configurationService: IConfigurationService,\n\t\t@IInstantiationService private readonly instantiationService: IInstantiationService,\n\t\t@ILogService private readonly logService: ILogService,\n\t\t@INotebookSearchService private readonly notebookSearchService: INotebookSearchService,\n\t) {\n\t\tsuper();\n\t\tthis._searchResult = this.instantiationService.createInstance(SearchResultImpl, this);\n\t\tthis._register(this._searchResult.onChange((e) => this._onSearchResultChanged.fire(e)));\n\n\t\tthis._aiTextResultProviderName = new Lazy(async () => this.searchService.getAIName());\n\t\tthis._id = SEARCH_MODEL_PREFIX + Date.now().toString();\n\t}\n\n\tid(): string {\n\t\treturn this._id;\n\t}\n\n\tasync getAITextResultProviderName(): Promise<string> {\n\t\tconst result = await this._aiTextResultProviderName.value;\n\t\tif (!result) {\n\t\t\tthrow Error('Fetching AI name when no provider present.');\n\t\t}\n\t\treturn result;\n\t}\n\n\tisReplaceActive(): boolean {\n\t\treturn this._replaceActive;\n\t}\n\n\tset replaceActive(replaceActive: boolean) {\n\t\tthis._replaceActive = replaceActive;\n\t}\n\n\tget replacePattern(): ReplacePattern | null {\n\t\treturn this._replacePattern;\n\t}\n\n\tget replaceString(): string {\n\t\treturn this._replaceString || '';\n\t}\n\n\tset preserveCase(value: boolean) {\n\t\tthis._preserveCase = value;\n\t}\n\n\tget preserveCase(): boolean {\n\t\treturn this._preserveCase;\n\t}\n\n\tset replaceString(replaceString: string) {\n\t\tthis._replaceString = replaceString;\n\t\tif (this._searchQuery) {\n\t\t\tthis._replacePattern = new ReplacePattern(replaceString, this._searchQuery.contentPattern);\n\t\t}\n\t\tthis._onReplaceTermChanged.fire();\n\t}\n\n\tget searchResult(): ISearchResult {\n\t\treturn this._searchResult;\n\t}\n\n\taiSearch(onResult: (result: ISearchProgressItem | undefined) => void): Promise<ISearchComplete> {\n\t\tif (this.hasAIResults) {\n\t\t\t// already has matches or pending matches\n\t\t\tthrow Error('AI results already exist');\n\t\t}\n\t\tif (!this._searchQuery) {\n\t\t\tthrow Error('No search query');\n\t\t}\n\n\t\tconst searchInstanceID = Date.now().toString();\n\t\tconst tokenSource = new CancellationTokenSource();\n\t\tthis.currentAICancelTokenSource = tokenSource;\n\t\tconst start = Date.now();\n\t\tconst asyncAIResults = this.searchService.aiTextSearch(\n\t\t\t{ ...this._searchQuery, contentPattern: this._searchQuery.contentPattern.pattern, type: QueryType.aiText },\n\t\t\ttokenSource.token,\n\t\t\tasync (p: ISearchProgressItem) => {\n\t\t\t\tonResult(p);\n\t\t\t\tthis.onSearchProgress(p, searchInstanceID, false, true);\n\t\t\t}).finally(() => {\n\t\t\t\ttokenSource.dispose(true);\n\t\t\t}).then(\n\t\t\t\tvalue => {\n\t\t\t\t\tif (value.results.length === 0) {\n\t\t\t\t\t\t// alert of no results since onProgress won't be called\n\t\t\t\t\t\tonResult(undefined);\n\t\t\t\t\t}\n\t\t\t\t\tthis.onSearchCompleted(value, Date.now() - start, searchInstanceID, true);\n\t\t\t\t\treturn value;\n\t\t\t\t},\n\t\t\t\te => {\n\t\t\t\t\tthis.onSearchError(e, Date.now() - start, true);\n\t\t\t\t\tthrow e;\n\t\t\t\t});\n\t\treturn asyncAIResults;\n\t}\n\n\tprivate doSearch(query: ITextQuery, progressEmitter: Emitter<void>, searchQuery: ITextQuery, searchInstanceID: string, onProgress?: (result: ISearchProgressItem) => void, callerToken?: CancellationToken): {\n\t\tasyncResults: Promise<ISearchComplete>;\n\t\tsyncResults: IFileMatch<URI>[];\n\t} {\n\t\tconst asyncGenerateOnProgress = async (p: ISearchProgressItem) => {\n\t\t\tprogressEmitter.fire();\n\t\t\tthis.onSearchProgress(p, searchInstanceID, false, false);\n\t\t\tonProgress?.(p);\n\t\t};\n\n\t\tconst syncGenerateOnProgress = (p: ISearchProgressItem) => {\n\t\t\tprogressEmitter.fire();\n\t\t\tthis.onSearchProgress(p, searchInstanceID, true);\n\t\t\tonProgress?.(p);\n\t\t};\n\t\tconst tokenSource = this.currentCancelTokenSource = new CancellationTokenSource(callerToken);\n\n\t\tconst notebookResult = this.notebookSearchService.notebookSearch(query, tokenSource.token, searchInstanceID, asyncGenerateOnProgress);\n\t\tconst textResult = this.searchService.textSearchSplitSyncAsync(\n\t\t\tsearchQuery,\n\t\t\ttokenSource.token, asyncGenerateOnProgress,\n\t\t\tnotebookResult.openFilesToScan,\n\t\t\tnotebookResult.allScannedFiles,\n\t\t);\n\n\t\tconst syncResults = textResult.syncResults.results;\n\t\tsyncResults.forEach(p => { if (p) { syncGenerateOnProgress(p); } });\n\n\t\tconst getAsyncResults = async (): Promise<ISearchComplete> => {\n\t\t\tconst searchStart = Date.now();\n\n\t\t\t// resolve async parts of search\n\t\t\tconst allClosedEditorResults = await textResult.asyncResults;\n\t\t\tconst resolvedNotebookResults = await notebookResult.completeData;\n\t\t\tconst searchLength = Date.now() - searchStart;\n\t\t\tconst resolvedResult: ISearchComplete = {\n\t\t\t\tresults: [...allClosedEditorResults.results, ...resolvedNotebookResults.results],\n\t\t\t\tmessages: [...allClosedEditorResults.messages, ...resolvedNotebookResults.messages],\n\t\t\t\tlimitHit: allClosedEditorResults.limitHit || resolvedNotebookResults.limitHit,\n\t\t\t\texit: allClosedEditorResults.exit,\n\t\t\t\tstats: allClosedEditorResults.stats,\n\t\t\t};\n\t\t\tthis.logService.trace(`whole search time | ${searchLength}ms`);\n\t\t\treturn resolvedResult;\n\t\t};\n\t\treturn {\n\t\t\tasyncResults: getAsyncResults()\n\t\t\t\t.finally(() => tokenSource.dispose(true)),\n\t\t\tsyncResults\n\t\t};\n\t}\n\n\tget hasAIResults(): boolean {\n\t\treturn !!(this.searchResult.getCachedSearchComplete(true)) || (!!this.currentAICancelTokenSource && !this.currentAICancelTokenSource.token.isCancellationRequested);\n\t}\n\n\tget hasPlainResults(): boolean {\n\t\treturn !!(this.searchResult.getCachedSearchComplete(false)) || (!!this.currentCancelTokenSource && !this.currentCancelTokenSource.token.isCancellationRequested);\n\t}\n\n\tsearch(query: ITextQuery, onProgress?: (result: ISearchProgressItem) => void, callerToken?: CancellationToken): {\n\t\tasyncResults: Promise<ISearchComplete>;\n\t\tsyncResults: IFileMatch<URI>[];\n\t} {\n\t\tthis.cancelSearch(true);\n\n\t\tthis._searchQuery = query;\n\t\tif (!this.searchConfig.searchOnType) {\n\t\t\tthis.searchResult.clear();\n\t\t}\n\t\tconst searchInstanceID = Date.now().toString();\n\n\t\tthis._searchResult.query = this._searchQuery;\n\n\t\tconst progressEmitter = this._register(new Emitter<void>());\n\t\tthis._replacePattern = new ReplacePattern(this.replaceString, this._searchQuery.contentPattern);\n\n\t\t// In search on type case, delay the streaming of results just a bit, so that we don't flash the only \"local results\" fast path\n\t\tthis._startStreamDelay = new Promise(resolve => setTimeout(resolve, this.searchConfig.searchOnType ? 150 : 0));\n\n\t\tconst req = this.doSearch(query, progressEmitter, this._searchQuery, searchInstanceID, onProgress, callerToken);\n\t\tconst asyncResults = req.asyncResults;\n\t\tconst syncResults = req.syncResults;\n\n\t\tif (onProgress) {\n\t\t\tsyncResults.forEach(p => {\n\t\t\t\tif (p) {\n\t\t\t\t\tonProgress(p);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tconst start = Date.now();\n\t\tlet event: IDisposable | undefined;\n\n\t\tconst progressEmitterPromise = new Promise(resolve => {\n\t\t\tevent = Event.once(progressEmitter.event)(resolve);\n\t\t\treturn event;\n\t\t});\n\n\t\tPromise.race([asyncResults, progressEmitterPromise]).finally(() => {\n\t\t\t/* __GDPR__\n\t\t\t\t\"searchResultsFirstRender\" : {\n\t\t\t\t\t\"owner\": \"roblourens\",\n\t\t\t\t\t\"duration\" : { \"classification\": \"SystemMetaData\", \"purpose\": \"PerformanceAndHealth\", \"isMeasurement\": true }\n\t\t\t\t}\n\t\t\t*/\n\t\t\tevent?.dispose();\n\t\t\tthis.telemetryService.publicLog('searchResultsFirstRender', { duration: Date.now() - start });\n\t\t});\n\n\t\ttry {\n\t\t\treturn {\n\t\t\t\tasyncResults: asyncResults.then(\n\t\t\t\t\tvalue => {\n\t\t\t\t\t\tthis.onSearchCompleted(value, Date.now() - start, searchInstanceID, false);\n\t\t\t\t\t\treturn value;\n\t\t\t\t\t},\n\t\t\t\t\te => {\n\t\t\t\t\t\tthis.onSearchError(e, Date.now() - start, false);\n\t\t\t\t\t\tthrow e;\n\t\t\t\t\t}),\n\t\t\t\tsyncResults\n\t\t\t};\n\t\t} finally {\n\t\t\t/* __GDPR__\n\t\t\t\t\"searchResultsFinished\" : {\n\t\t\t\t\t\"owner\": \"roblourens\",\n\t\t\t\t\t\"duration\" : { \"classification\": \"SystemMetaData\", \"purpose\": \"PerformanceAndHealth\", \"isMeasurement\": true }\n\t\t\t\t}\n\t\t\t*/\n\t\t\tthis.telemetryService.publicLog('searchResultsFinished', { duration: Date.now() - start });\n\t\t}\n\t}\n\n\tprivate onSearchCompleted(completed: ISearchComplete | undefined, duration: number, searchInstanceID: string, ai: boolean): ISearchComplete | undefined {\n\t\tif (!this._searchQuery) {\n\t\t\tthrow new Error('onSearchCompleted must be called after a search is started');\n\t\t}\n\n\t\tif (ai) {\n\t\t\tthis._searchResult.add(this._aiResultQueue, searchInstanceID, true);\n\t\t\tthis._aiResultQueue.length = 0;\n\t\t} else {\n\t\t\tthis._searchResult.add(this._resultQueue, searchInstanceID, false);\n\t\t\tthis._resultQueue.length = 0;\n\t\t}\n\n\t\tthis.searchResult.setCachedSearchComplete(completed, ai);\n\n\t\tconst options: IPatternInfo = Object.assign({}, this._searchQuery.contentPattern);\n\t\t// eslint-disable-next-line local/code-no-any-casts\n\t\tdelete (options as any).pattern;\n\n\t\tconst stats = completed && completed.stats as ITextSearchStats;\n\n\t\tconst fileSchemeOnly = this._searchQuery.folderQueries.every(fq => fq.folder.scheme === Schemas.file);\n\t\tconst otherSchemeOnly = this._searchQuery.folderQueries.every(fq => fq.folder.scheme !== Schemas.file);\n\t\tconst scheme = fileSchemeOnly ? Schemas.file :\n\t\t\totherSchemeOnly ? 'other' :\n\t\t\t\t'mixed';\n\n\t\t/* __GDPR__\n\t\t\t\"searchResultsShown\" : {\n\t\t\t\t\"owner\": \"roblourens\",\n\t\t\t\t\"count\" : { \"classification\": \"SystemMetaData\", \"purpose\": \"FeatureInsight\", \"isMeasurement\": true },\n\t\t\t\t\"fileCount\": { \"classification\": \"SystemMetaData\", \"purpose\": \"FeatureInsight\", \"isMeasurement\": true },\n\t\t\t\t\"options\": { \"${inline}\": [ \"${IPatternInfo}\" ] },\n\t\t\t\t\"duration\": { \"classification\": \"SystemMetaData\", \"purpose\": \"PerformanceAndHealth\", \"isMeasurement\": true },\n\t\t\t\t\"type\" : { \"classification\": \"SystemMetaData\", \"purpose\": \"PerformanceAndHealth\" },\n\t\t\t\t\"scheme\" : { \"classification\": \"SystemMetaData\", \"purpose\": \"PerformanceAndHealth\" },\n\t\t\t\t\"searchOnTypeEnabled\" : { \"classification\": \"SystemMetaData\", \"purpose\": \"FeatureInsight\" }\n\t\t\t}\n\t\t*/\n\t\tthis.telemetryService.publicLog('searchResultsShown', {\n\t\t\tcount: this._searchResult.count(),\n\t\t\tfileCount: this._searchResult.fileCount(),\n\t\t\toptions,\n\t\t\tduration,\n\t\t\ttype: stats && stats.type,\n\t\t\tscheme,\n\t\t\tsearchOnTypeEnabled: this.searchConfig.searchOnType\n\t\t});\n\t\treturn completed;\n\t}\n\n\tprivate onSearchError(e: any, duration: number, ai: boolean): void {\n\t\tif (errors.isCancellationError(e)) {\n\t\t\tthis.onSearchCompleted(\n\t\t\t\t(ai ? this.aiSearchCancelledForNewSearch : this.searchCancelledForNewSearch)\n\t\t\t\t\t? { exit: SearchCompletionExitCode.NewSearchStarted, results: [], messages: [] }\n\t\t\t\t\t: undefined,\n\t\t\t\tduration, '', ai);\n\t\t\tif (ai) {\n\t\t\t\tthis.aiSearchCancelledForNewSearch = false;\n\t\t\t} else {\n\t\t\t\tthis.searchCancelledForNewSearch = false;\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate onSearchProgress(p: ISearchProgressItem, searchInstanceID: string, sync = true, ai: boolean = false) {\n\t\tconst targetQueue = ai ? this._aiResultQueue : this._resultQueue;\n\t\tif ((<IFileMatch>p).resource) {\n\t\t\ttargetQueue.push(<IFileMatch>p);\n\t\t\tif (sync) {\n\t\t\t\tif (targetQueue.length) {\n\t\t\t\t\tthis._searchResult.add(targetQueue, searchInstanceID, false, true);\n\t\t\t\t\ttargetQueue.length = 0;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tthis._startStreamDelay.then(() => {\n\t\t\t\t\tif (targetQueue.length) {\n\t\t\t\t\t\tthis._searchResult.add(targetQueue, searchInstanceID, ai, !ai);\n\t\t\t\t\t\ttargetQueue.length = 0;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\n\t\t}\n\t}\n\n\tprivate get searchConfig() {\n\t\treturn this.configurationService.getValue<ISearchConfigurationProperties>('search');\n\t}\n\n\tcancelSearch(cancelledForNewSearch = false): boolean {\n\t\tif (this.currentCancelTokenSource) {\n\t\t\tthis.searchCancelledForNewSearch = cancelledForNewSearch;\n\t\t\tthis.currentCancelTokenSource.cancel();\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\tcancelAISearch(cancelledForNewSearch = false): boolean {\n\t\tif (this.currentAICancelTokenSource) {\n\t\t\tthis.aiSearchCancelledForNewSearch = cancelledForNewSearch;\n\t\t\tthis.currentAICancelTokenSource.cancel();\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\tclearAiSearchResults(): void {\n\t\tthis._aiResultQueue.length = 0;\n\t\t// it's not clear all as we are only clearing the AI results\n\t\tthis._searchResult.aiTextSearchResult.clear(false);\n\t}\n\toverride dispose(): void {\n\t\tthis.cancelSearch();\n\t\tthis.cancelAISearch();\n\t\tthis.searchResult.dispose();\n\t\tsuper.dispose();\n\t}\n\n}\n\n\nexport class SearchViewModelWorkbenchService implements ISearchViewModelWorkbenchService {\n\n\tdeclare readonly _serviceBrand: undefined;\n\tprivate _searchModel: SearchModelImpl | null = null;\n\n\tconstructor(@IInstantiationService private readonly instantiationService: IInstantiationService) {\n\t}\n\n\tget searchModel(): SearchModelImpl {\n\t\tif (!this._searchModel) {\n\t\t\tthis._searchModel = this.instantiationService.createInstance(SearchModelImpl);\n\t\t}\n\t\treturn this._searchModel;\n\t}\n\n\tset searchModel(searchModel: SearchModelImpl) {\n\t\tthis._searchModel?.dispose();\n\t\tthis._searchModel = searchModel;\n\t}\n}\n\n"]}