{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/contrib/search/browser/notebookSearch/notebookSearchModel.ts","vs/workbench/contrib/search/browser/notebookSearch/notebookSearchModel.ts"],"names":[],"mappings":"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","file":"notebookSearchModel.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { coalesce } from '../../../../../base/common/arrays.js';\nimport { RunOnceScheduler } from '../../../../../base/common/async.js';\nimport { CancellationToken } from '../../../../../base/common/cancellation.js';\nimport { IDisposable } from '../../../../../base/common/lifecycle.js';\nimport { FindMatch } from '../../../../../editor/common/model.js';\nimport { IModelService } from '../../../../../editor/common/services/model.js';\nimport { ILabelService } from '../../../../../platform/label/common/label.js';\nimport { ISearchRange, ITextSearchMatch, resultIsMatch, ITextSearchContext, IPatternInfo, ITextSearchPreviewOptions, IFileMatch } from '../../../../services/search/common/search.js';\nimport { getTextSearchMatchWithModelContext } from '../../../../services/search/common/searchHelpers.js';\nimport { FindMatchDecorationModel } from '../../../notebook/browser/contrib/find/findMatchDecorationModel.js';\nimport { CellFindMatchModel } from '../../../notebook/browser/contrib/find/findModel.js';\nimport { CellFindMatchWithIndex, CellWebviewFindMatch, ICellViewModel } from '../../../notebook/browser/notebookBrowser.js';\nimport { NotebookEditorWidget } from '../../../notebook/browser/notebookEditorWidget.js';\nimport { INotebookEditorService } from '../../../notebook/browser/services/notebookEditorService.js';\nimport { NotebookCellsChangeType } from '../../../notebook/common/notebookCommon.js';\nimport { CellSearchModel } from '../../common/cellSearchModel.js';\nimport { INotebookCellMatchNoModel, isINotebookFileMatchNoModel, rawCellPrefix } from '../../common/searchNotebookHelpers.js';\nimport { contentMatchesToTextSearchMatches, INotebookCellMatchWithModel, isINotebookCellMatchWithModel, isINotebookFileMatchWithModel, webviewMatchesToTextSearchMatches } from './searchNotebookHelpers.js';\nimport { ISearchTreeMatch, ISearchTreeFolderMatch, ISearchTreeFolderMatchWorkspaceRoot, MATCH_PREFIX } from '../searchTreeModel/searchTreeCommon.js';\nimport { IReplaceService } from '../replace.js';\nimport { FileMatchImpl } from '../searchTreeModel/fileMatch.js';\nimport { ICellMatch, IMatchInNotebook, INotebookFileInstanceMatch, isIMatchInNotebook } from './notebookSearchModelBase.js';\nimport { MatchImpl, textSearchResultToMatches } from '../searchTreeModel/match.js';\n\nexport class MatchInNotebook extends MatchImpl implements IMatchInNotebook {\n\tprivate _webviewIndex: number | undefined;\n\n\tconstructor(private readonly _cellParent: ICellMatch, _fullPreviewLines: string[], _fullPreviewRange: ISearchRange, _documentRange: ISearchRange, webviewIndex?: number) {\n\t\tsuper(_cellParent.parent, _fullPreviewLines, _fullPreviewRange, _documentRange, false);\n\t\tthis._id = MATCH_PREFIX + this._parent.resource.toString() + '>' + this._cellParent.cellIndex + (webviewIndex ? '_' + webviewIndex : '') + '_' + this.notebookMatchTypeString() + this._range + this.getMatchString();\n\t\tthis._webviewIndex = webviewIndex;\n\t}\n\n\toverride parent(): INotebookFileInstanceMatch { // visible parent in search tree\n\t\treturn this._cellParent.parent;\n\t}\n\n\tget cellParent(): ICellMatch {\n\t\treturn this._cellParent;\n\t}\n\n\tprivate notebookMatchTypeString(): string {\n\t\treturn this.isWebviewMatch() ? 'webview' : 'content';\n\t}\n\n\tpublic isWebviewMatch() {\n\t\treturn this._webviewIndex !== undefined;\n\t}\n\n\toverride get isReadonly(): boolean {\n\t\treturn super.isReadonly || (!this._cellParent.hasCellViewModel()) || this.isWebviewMatch();\n\t}\n\n\tget cellIndex() {\n\t\treturn this._cellParent.cellIndex;\n\t}\n\n\tget webviewIndex() {\n\t\treturn this._webviewIndex;\n\t}\n\n\tget cell() {\n\t\treturn this._cellParent.cell;\n\t}\n}\n\nexport class CellMatch implements ICellMatch {\n\tprivate _contentMatches: Map<string, MatchInNotebook>;\n\tprivate _webviewMatches: Map<string, MatchInNotebook>;\n\tprivate _context: Map<number, string>;\n\n\tconstructor(\n\t\tprivate readonly _parent: INotebookFileInstanceMatch,\n\t\tprivate _cell: ICellViewModel | undefined,\n\t\tprivate readonly _cellIndex: number,\n\t) {\n\n\t\tthis._contentMatches = new Map<string, MatchInNotebook>();\n\t\tthis._webviewMatches = new Map<string, MatchInNotebook>();\n\t\tthis._context = new Map<number, string>();\n\t}\n\n\tpublic hasCellViewModel() {\n\t\treturn !(this._cell instanceof CellSearchModel);\n\t}\n\n\tget context(): Map<number, string> {\n\t\treturn new Map(this._context);\n\t}\n\n\tmatches() {\n\t\treturn [...this._contentMatches.values(), ... this._webviewMatches.values()];\n\t}\n\n\tget contentMatches(): MatchInNotebook[] {\n\t\treturn Array.from(this._contentMatches.values());\n\t}\n\n\tget webviewMatches(): MatchInNotebook[] {\n\t\treturn Array.from(this._webviewMatches.values());\n\t}\n\n\tremove(matches: MatchInNotebook | MatchInNotebook[]): void {\n\t\tif (!Array.isArray(matches)) {\n\t\t\tmatches = [matches];\n\t\t}\n\t\tfor (const match of matches) {\n\t\t\tthis._contentMatches.delete(match.id());\n\t\t\tthis._webviewMatches.delete(match.id());\n\t\t}\n\t}\n\n\tclearAllMatches() {\n\t\tthis._contentMatches.clear();\n\t\tthis._webviewMatches.clear();\n\t}\n\n\taddContentMatches(textSearchMatches: ITextSearchMatch[]) {\n\t\tconst contentMatches = textSearchMatchesToNotebookMatches(textSearchMatches, this);\n\t\tcontentMatches.forEach((match) => {\n\t\t\tthis._contentMatches.set(match.id(), match);\n\t\t});\n\t\tthis.addContext(textSearchMatches);\n\t}\n\n\tpublic addContext(textSearchMatches: ITextSearchMatch[]) {\n\t\tif (!this.cell) {\n\t\t\t// todo: get closed notebook results in search editor\n\t\t\treturn;\n\t\t}\n\t\tthis.cell.resolveTextModel().then((textModel) => {\n\t\t\tconst textResultsWithContext = getTextSearchMatchWithModelContext(textSearchMatches, textModel, this.parent.parent().query!);\n\t\t\tconst contexts = textResultsWithContext.filter((result => !resultIsMatch(result)) as ((a: any) => a is ITextSearchContext));\n\t\t\tcontexts.map(context => ({ ...context, lineNumber: context.lineNumber + 1 }))\n\t\t\t\t.forEach((context) => { this._context.set(context.lineNumber, context.text); });\n\t\t});\n\t}\n\n\taddWebviewMatches(textSearchMatches: ITextSearchMatch[]) {\n\t\tconst webviewMatches = textSearchMatchesToNotebookMatches(textSearchMatches, this);\n\t\twebviewMatches.forEach((match) => {\n\t\t\tthis._webviewMatches.set(match.id(), match);\n\t\t});\n\t\t// TODO: add webview results to context\n\t}\n\n\n\tsetCellModel(cell: ICellViewModel) {\n\t\tthis._cell = cell;\n\t}\n\n\tget parent(): INotebookFileInstanceMatch {\n\t\treturn this._parent;\n\t}\n\n\tget id(): string {\n\t\treturn this._cell?.id ?? `${rawCellPrefix}${this.cellIndex}`;\n\t}\n\n\tget cellIndex(): number {\n\t\treturn this._cellIndex;\n\t}\n\n\tget cell(): ICellViewModel | undefined {\n\t\treturn this._cell;\n\t}\n\n}\n\nexport class NotebookCompatibleFileMatch extends FileMatchImpl implements INotebookFileInstanceMatch {\n\n\n\tprivate _notebookEditorWidget: NotebookEditorWidget | null = null;\n\tprivate _editorWidgetListener: IDisposable | null = null;\n\tprivate _notebookUpdateScheduler: RunOnceScheduler;\n\tprivate _lastEditorWidgetIdForUpdate: string | undefined;\n\n\tconstructor(\n\t\t_query: IPatternInfo,\n\t\t_previewOptions: ITextSearchPreviewOptions | undefined,\n\t\t_maxResults: number | undefined,\n\t\t_parent: ISearchTreeFolderMatch,\n\t\trawMatch: IFileMatch,\n\t\t_closestRoot: ISearchTreeFolderMatchWorkspaceRoot | null,\n\t\tprivate readonly searchInstanceID: string,\n\t\t@IModelService modelService: IModelService,\n\t\t@IReplaceService replaceService: IReplaceService,\n\t\t@ILabelService labelService: ILabelService,\n\t\t@INotebookEditorService private readonly notebookEditorService: INotebookEditorService,\n\t) {\n\t\tsuper(_query, _previewOptions, _maxResults, _parent, rawMatch, _closestRoot, modelService, replaceService, labelService);\n\t\tthis._cellMatches = new Map<string, ICellMatch>();\n\t\tthis._notebookUpdateScheduler = new RunOnceScheduler(this.updateMatchesForEditorWidget.bind(this), 250);\n\t}\n\tprivate _cellMatches: Map<string, ICellMatch>;\n\tpublic get cellContext(): Map<string, Map<number, string>> {\n\t\tconst cellContext = new Map<string, Map<number, string>>();\n\t\tthis._cellMatches.forEach(cellMatch => {\n\t\t\tcellContext.set(cellMatch.id, cellMatch.context);\n\t\t});\n\t\treturn cellContext;\n\t}\n\n\tgetCellMatch(cellID: string): ICellMatch | undefined {\n\t\treturn this._cellMatches.get(cellID);\n\t}\n\n\taddCellMatch(rawCell: INotebookCellMatchNoModel | INotebookCellMatchWithModel) {\n\t\tconst cellMatch = new CellMatch(this, isINotebookCellMatchWithModel(rawCell) ? rawCell.cell : undefined, rawCell.index);\n\t\tthis._cellMatches.set(cellMatch.id, cellMatch);\n\t\tthis.addWebviewMatchesToCell(cellMatch.id, rawCell.webviewResults);\n\t\tthis.addContentMatchesToCell(cellMatch.id, rawCell.contentResults);\n\t}\n\n\taddWebviewMatchesToCell(cellID: string, webviewMatches: ITextSearchMatch[]) {\n\t\tconst cellMatch = this.getCellMatch(cellID);\n\t\tif (cellMatch !== undefined) {\n\t\t\tcellMatch.addWebviewMatches(webviewMatches);\n\t\t}\n\t}\n\n\taddContentMatchesToCell(cellID: string, contentMatches: ITextSearchMatch[]) {\n\t\tconst cellMatch = this.getCellMatch(cellID);\n\t\tif (cellMatch !== undefined) {\n\t\t\tcellMatch.addContentMatches(contentMatches);\n\t\t}\n\t}\n\n\tprivate revealCellRange(match: MatchInNotebook, outputOffset: number | null) {\n\t\tif (!this._notebookEditorWidget || !match.cell) {\n\t\t\t// match cell should never be a CellSearchModel if the notebook is open\n\t\t\treturn;\n\t\t}\n\t\tif (match.webviewIndex !== undefined) {\n\t\t\tconst index = this._notebookEditorWidget.getCellIndex(match.cell);\n\t\t\tif (index !== undefined) {\n\t\t\t\tthis._notebookEditorWidget.revealCellOffsetInCenter(match.cell, outputOffset ?? 0);\n\t\t\t}\n\t\t} else {\n\t\t\tmatch.cell.updateEditState(match.cell.getEditState(), 'focusNotebookCell');\n\t\t\tthis._notebookEditorWidget.setCellEditorSelection(match.cell, match.range());\n\t\t\tthis._notebookEditorWidget.revealRangeInCenterIfOutsideViewportAsync(match.cell, match.range());\n\t\t}\n\t}\n\n\n\tbindNotebookEditorWidget(widget: NotebookEditorWidget) {\n\t\tif (this._notebookEditorWidget === widget) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._notebookEditorWidget = widget;\n\n\t\tthis._editorWidgetListener = this._notebookEditorWidget.textModel?.onDidChangeContent((e) => {\n\t\t\tif (!e.rawEvents.some(event => event.kind === NotebookCellsChangeType.ChangeCellContent || event.kind === NotebookCellsChangeType.ModelChange)) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis._notebookUpdateScheduler.schedule();\n\t\t}) ?? null;\n\t\tthis._addNotebookHighlights();\n\t}\n\n\tunbindNotebookEditorWidget(widget?: NotebookEditorWidget) {\n\t\tif (widget && this._notebookEditorWidget !== widget) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (this._notebookEditorWidget) {\n\t\t\tthis._notebookUpdateScheduler.cancel();\n\t\t\tthis._editorWidgetListener?.dispose();\n\t\t}\n\t\tthis._removeNotebookHighlights();\n\t\tthis._notebookEditorWidget = null;\n\t}\n\n\tupdateNotebookHighlights(): void {\n\t\tif (this.parent().showHighlights) {\n\t\t\tthis._addNotebookHighlights();\n\t\t\tthis.setNotebookFindMatchDecorationsUsingCellMatches(Array.from(this._cellMatches.values()));\n\t\t} else {\n\t\t\tthis._removeNotebookHighlights();\n\t\t}\n\t}\n\n\tprivate _addNotebookHighlights(): void {\n\t\tif (!this._notebookEditorWidget) {\n\t\t\treturn;\n\t\t}\n\t\tthis._findMatchDecorationModel?.stopWebviewFind();\n\t\tthis._findMatchDecorationModel?.dispose();\n\t\tthis._findMatchDecorationModel = new FindMatchDecorationModel(this._notebookEditorWidget, this.searchInstanceID);\n\t\tif (this._selectedMatch instanceof MatchInNotebook) {\n\t\t\tthis.highlightCurrentFindMatchDecoration(this._selectedMatch);\n\t\t}\n\t}\n\n\tprivate _removeNotebookHighlights(): void {\n\t\tif (this._findMatchDecorationModel) {\n\t\t\tthis._findMatchDecorationModel?.stopWebviewFind();\n\t\t\tthis._findMatchDecorationModel?.dispose();\n\t\t\tthis._findMatchDecorationModel = undefined;\n\t\t}\n\t}\n\n\tprivate updateNotebookMatches(matches: CellFindMatchWithIndex[], modelChange: boolean): void {\n\t\tif (!this._notebookEditorWidget) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst oldCellMatches = new Map<string, ICellMatch>(this._cellMatches);\n\t\tif (this._notebookEditorWidget.getId() !== this._lastEditorWidgetIdForUpdate) {\n\t\t\tthis._cellMatches.clear();\n\t\t\tthis._lastEditorWidgetIdForUpdate = this._notebookEditorWidget.getId();\n\t\t}\n\t\tmatches.forEach(match => {\n\t\t\tlet existingCell = this._cellMatches.get(match.cell.id);\n\t\t\tif (this._notebookEditorWidget && !existingCell) {\n\t\t\t\tconst index = this._notebookEditorWidget.getCellIndex(match.cell);\n\t\t\t\tconst existingRawCell = oldCellMatches.get(`${rawCellPrefix}${index}`);\n\t\t\t\tif (existingRawCell) {\n\t\t\t\t\texistingRawCell.setCellModel(match.cell);\n\t\t\t\t\texistingRawCell.clearAllMatches();\n\t\t\t\t\texistingCell = existingRawCell;\n\t\t\t\t}\n\t\t\t}\n\t\t\texistingCell?.clearAllMatches();\n\t\t\tconst cell = existingCell ?? new CellMatch(this, match.cell, match.index);\n\t\t\tcell.addContentMatches(contentMatchesToTextSearchMatches(match.contentMatches, match.cell));\n\t\t\tcell.addWebviewMatches(webviewMatchesToTextSearchMatches(match.webviewMatches));\n\t\t\tthis._cellMatches.set(cell.id, cell);\n\n\t\t});\n\n\t\tthis._findMatchDecorationModel?.setAllFindMatchesDecorations(matches);\n\t\tif (this._selectedMatch instanceof MatchInNotebook) {\n\t\t\tthis.highlightCurrentFindMatchDecoration(this._selectedMatch);\n\t\t}\n\t\tthis._onChange.fire({ forceUpdateModel: modelChange });\n\t}\n\n\tprivate setNotebookFindMatchDecorationsUsingCellMatches(cells: ICellMatch[]): void {\n\t\tif (!this._findMatchDecorationModel) {\n\t\t\treturn;\n\t\t}\n\t\tconst cellFindMatch = coalesce(cells.map((cell): CellFindMatchModel | undefined => {\n\t\t\tconst webviewMatches: CellWebviewFindMatch[] = coalesce(cell.webviewMatches.map((match): CellWebviewFindMatch | undefined => {\n\t\t\t\tif (!match.webviewIndex) {\n\t\t\t\t\treturn undefined;\n\t\t\t\t}\n\t\t\t\treturn {\n\t\t\t\t\tindex: match.webviewIndex,\n\t\t\t\t};\n\t\t\t}));\n\t\t\tif (!cell.cell) {\n\t\t\t\treturn undefined;\n\t\t\t}\n\t\t\tconst findMatches: FindMatch[] = cell.contentMatches.map(match => {\n\t\t\t\treturn new FindMatch(match.range(), [match.text()]);\n\t\t\t});\n\t\t\treturn new CellFindMatchModel(cell.cell, cell.cellIndex, findMatches, webviewMatches);\n\t\t}));\n\t\ttry {\n\t\t\tthis._findMatchDecorationModel.setAllFindMatchesDecorations(cellFindMatch);\n\t\t} catch (e) {\n\t\t\t// no op, might happen due to bugs related to cell output regex search\n\t\t}\n\t}\n\tasync updateMatchesForEditorWidget(): Promise<void> {\n\t\tif (!this._notebookEditorWidget) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._textMatches = new Map<string, ISearchTreeMatch>();\n\n\t\tconst wordSeparators = this._query.isWordMatch && this._query.wordSeparators ? this._query.wordSeparators : null;\n\t\tconst allMatches = await this._notebookEditorWidget\n\t\t\t.find(this._query.pattern, {\n\t\t\t\tregex: this._query.isRegExp,\n\t\t\t\twholeWord: this._query.isWordMatch,\n\t\t\t\tcaseSensitive: this._query.isCaseSensitive,\n\t\t\t\twordSeparators: wordSeparators ?? undefined,\n\t\t\t\tincludeMarkupInput: this._query.notebookInfo?.isInNotebookMarkdownInput,\n\t\t\t\tincludeMarkupPreview: this._query.notebookInfo?.isInNotebookMarkdownPreview,\n\t\t\t\tincludeCodeInput: this._query.notebookInfo?.isInNotebookCellInput,\n\t\t\t\tincludeOutput: this._query.notebookInfo?.isInNotebookCellOutput,\n\t\t\t}, CancellationToken.None, false, true, this.searchInstanceID);\n\n\t\tthis.updateNotebookMatches(allMatches, true);\n\t}\n\n\tpublic async showMatch(match: MatchInNotebook) {\n\t\tconst offset = await this.highlightCurrentFindMatchDecoration(match);\n\t\tthis.setSelectedMatch(match);\n\t\tthis.revealCellRange(match, offset);\n\t}\n\n\tprivate async highlightCurrentFindMatchDecoration(match: MatchInNotebook): Promise<number | null> {\n\t\tif (!this._findMatchDecorationModel || !match.cell) {\n\t\t\t// match cell should never be a CellSearchModel if the notebook is open\n\t\t\treturn null;\n\t\t}\n\t\tif (match.webviewIndex === undefined) {\n\t\t\treturn this._findMatchDecorationModel.highlightCurrentFindMatchDecorationInCell(match.cell, match.range());\n\t\t} else {\n\t\t\treturn this._findMatchDecorationModel.highlightCurrentFindMatchDecorationInWebview(match.cell, match.webviewIndex);\n\t\t}\n\t}\n\n\n\toverride matches(): ISearchTreeMatch[] {\n\t\tconst matches = Array.from(this._cellMatches.values()).flatMap((e) => e.matches());\n\t\treturn [...super.matches(), ...matches];\n\t}\n\n\tprotected override removeMatch(match: ISearchTreeMatch) {\n\n\t\tif (match instanceof MatchInNotebook) {\n\t\t\tmatch.cellParent.remove(match);\n\t\t\tif (match.cellParent.matches().length === 0) {\n\t\t\t\tthis._cellMatches.delete(match.cellParent.id);\n\t\t\t}\n\n\t\t\tif (this.isMatchSelected(match)) {\n\t\t\t\tthis.setSelectedMatch(null);\n\t\t\t\tthis._findMatchDecorationModel?.clearCurrentFindMatchDecoration();\n\t\t\t} else {\n\t\t\t\tthis.updateHighlights();\n\t\t\t}\n\n\t\t\tthis.setNotebookFindMatchDecorationsUsingCellMatches(this.cellMatches());\n\t\t} else {\n\t\t\tsuper.removeMatch(match);\n\t\t}\n\t}\n\n\tcellMatches(): ICellMatch[] {\n\t\treturn Array.from(this._cellMatches.values());\n\t}\n\n\n\toverride createMatches(): void {\n\t\tconst model = this.modelService.getModel(this._resource);\n\t\tif (model) {\n\t\t\t// todo: handle better when ai contributed results has model, currently, createMatches does not work for this\n\t\t\tthis.bindModel(model);\n\t\t\tthis.updateMatchesForModel();\n\t\t} else {\n\t\t\tconst notebookEditorWidgetBorrow = this.notebookEditorService.retrieveExistingWidgetFromURI(this.resource);\n\n\t\t\tif (notebookEditorWidgetBorrow?.value) {\n\t\t\t\tthis.bindNotebookEditorWidget(notebookEditorWidgetBorrow.value);\n\t\t\t}\n\t\t\tif (this.rawMatch.results) {\n\t\t\t\tthis.rawMatch.results\n\t\t\t\t\t.filter(resultIsMatch)\n\t\t\t\t\t.forEach(rawMatch => {\n\t\t\t\t\t\ttextSearchResultToMatches(rawMatch, this, false)\n\t\t\t\t\t\t\t.forEach(m => this.add(m));\n\t\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (isINotebookFileMatchWithModel(this.rawMatch) || isINotebookFileMatchNoModel(this.rawMatch)) {\n\t\t\t\tthis.rawMatch.cellResults?.forEach(cell => this.addCellMatch(cell));\n\t\t\t\tthis.setNotebookFindMatchDecorationsUsingCellMatches(this.cellMatches());\n\t\t\t\tthis._onChange.fire({ forceUpdateModel: true });\n\t\t\t}\n\t\t\tthis.addContext(this.rawMatch.results);\n\t\t}\n\t}\n\n\toverride get hasChildren(): boolean {\n\t\treturn super.hasChildren || this._cellMatches.size > 0;\n\t}\n\n\toverride setSelectedMatch(match: ISearchTreeMatch | null): void {\n\t\tif (match) {\n\t\t\tif (!this.isMatchSelected(match) && isIMatchInNotebook(match)) {\n\t\t\t\tthis._selectedMatch = match;\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (!this._textMatches.has(match.id())) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (this.isMatchSelected(match)) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tthis._selectedMatch = match;\n\t\tthis.updateHighlights();\n\t}\n\n\toverride dispose(): void {\n\t\tthis.unbindNotebookEditorWidget();\n\t\tsuper.dispose();\n\t}\n\n}\n// text search to notebook matches\n\nexport function textSearchMatchesToNotebookMatches(textSearchMatches: ITextSearchMatch[], cell: CellMatch): MatchInNotebook[] {\n\tconst notebookMatches: MatchInNotebook[] = [];\n\ttextSearchMatches.forEach((textSearchMatch) => {\n\t\tconst previewLines = textSearchMatch.previewText.split('\\n');\n\t\ttextSearchMatch.rangeLocations.map((rangeLocation) => {\n\t\t\tconst previewRange: ISearchRange = rangeLocation.preview;\n\t\t\tconst match = new MatchInNotebook(cell, previewLines, previewRange, rangeLocation.source, textSearchMatch.webviewIndex);\n\t\t\tnotebookMatches.push(match);\n\t\t});\n\t});\n\treturn notebookMatches;\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { coalesce } from '../../../../../base/common/arrays.js';\nimport { RunOnceScheduler } from '../../../../../base/common/async.js';\nimport { CancellationToken } from '../../../../../base/common/cancellation.js';\nimport { IDisposable } from '../../../../../base/common/lifecycle.js';\nimport { FindMatch } from '../../../../../editor/common/model.js';\nimport { IModelService } from '../../../../../editor/common/services/model.js';\nimport { ILabelService } from '../../../../../platform/label/common/label.js';\nimport { ISearchRange, ITextSearchMatch, resultIsMatch, ITextSearchContext, IPatternInfo, ITextSearchPreviewOptions, IFileMatch } from '../../../../services/search/common/search.js';\nimport { getTextSearchMatchWithModelContext } from '../../../../services/search/common/searchHelpers.js';\nimport { FindMatchDecorationModel } from '../../../notebook/browser/contrib/find/findMatchDecorationModel.js';\nimport { CellFindMatchModel } from '../../../notebook/browser/contrib/find/findModel.js';\nimport { CellFindMatchWithIndex, CellWebviewFindMatch, ICellViewModel } from '../../../notebook/browser/notebookBrowser.js';\nimport { NotebookEditorWidget } from '../../../notebook/browser/notebookEditorWidget.js';\nimport { INotebookEditorService } from '../../../notebook/browser/services/notebookEditorService.js';\nimport { NotebookCellsChangeType } from '../../../notebook/common/notebookCommon.js';\nimport { CellSearchModel } from '../../common/cellSearchModel.js';\nimport { INotebookCellMatchNoModel, isINotebookFileMatchNoModel, rawCellPrefix } from '../../common/searchNotebookHelpers.js';\nimport { contentMatchesToTextSearchMatches, INotebookCellMatchWithModel, isINotebookCellMatchWithModel, isINotebookFileMatchWithModel, webviewMatchesToTextSearchMatches } from './searchNotebookHelpers.js';\nimport { ISearchTreeMatch, ISearchTreeFolderMatch, ISearchTreeFolderMatchWorkspaceRoot, MATCH_PREFIX } from '../searchTreeModel/searchTreeCommon.js';\nimport { IReplaceService } from '../replace.js';\nimport { FileMatchImpl } from '../searchTreeModel/fileMatch.js';\nimport { ICellMatch, IMatchInNotebook, INotebookFileInstanceMatch, isIMatchInNotebook } from './notebookSearchModelBase.js';\nimport { MatchImpl, textSearchResultToMatches } from '../searchTreeModel/match.js';\n\nexport class MatchInNotebook extends MatchImpl implements IMatchInNotebook {\n\tprivate _webviewIndex: number | undefined;\n\n\tconstructor(private readonly _cellParent: ICellMatch, _fullPreviewLines: string[], _fullPreviewRange: ISearchRange, _documentRange: ISearchRange, webviewIndex?: number) {\n\t\tsuper(_cellParent.parent, _fullPreviewLines, _fullPreviewRange, _documentRange, false);\n\t\tthis._id = MATCH_PREFIX + this._parent.resource.toString() + '>' + this._cellParent.cellIndex + (webviewIndex ? '_' + webviewIndex : '') + '_' + this.notebookMatchTypeString() + this._range + this.getMatchString();\n\t\tthis._webviewIndex = webviewIndex;\n\t}\n\n\toverride parent(): INotebookFileInstanceMatch { // visible parent in search tree\n\t\treturn this._cellParent.parent;\n\t}\n\n\tget cellParent(): ICellMatch {\n\t\treturn this._cellParent;\n\t}\n\n\tprivate notebookMatchTypeString(): string {\n\t\treturn this.isWebviewMatch() ? 'webview' : 'content';\n\t}\n\n\tpublic isWebviewMatch() {\n\t\treturn this._webviewIndex !== undefined;\n\t}\n\n\toverride get isReadonly(): boolean {\n\t\treturn super.isReadonly || (!this._cellParent.hasCellViewModel()) || this.isWebviewMatch();\n\t}\n\n\tget cellIndex() {\n\t\treturn this._cellParent.cellIndex;\n\t}\n\n\tget webviewIndex() {\n\t\treturn this._webviewIndex;\n\t}\n\n\tget cell() {\n\t\treturn this._cellParent.cell;\n\t}\n}\n\nexport class CellMatch implements ICellMatch {\n\tprivate _contentMatches: Map<string, MatchInNotebook>;\n\tprivate _webviewMatches: Map<string, MatchInNotebook>;\n\tprivate _context: Map<number, string>;\n\n\tconstructor(\n\t\tprivate readonly _parent: INotebookFileInstanceMatch,\n\t\tprivate _cell: ICellViewModel | undefined,\n\t\tprivate readonly _cellIndex: number,\n\t) {\n\n\t\tthis._contentMatches = new Map<string, MatchInNotebook>();\n\t\tthis._webviewMatches = new Map<string, MatchInNotebook>();\n\t\tthis._context = new Map<number, string>();\n\t}\n\n\tpublic hasCellViewModel() {\n\t\treturn !(this._cell instanceof CellSearchModel);\n\t}\n\n\tget context(): Map<number, string> {\n\t\treturn new Map(this._context);\n\t}\n\n\tmatches() {\n\t\treturn [...this._contentMatches.values(), ... this._webviewMatches.values()];\n\t}\n\n\tget contentMatches(): MatchInNotebook[] {\n\t\treturn Array.from(this._contentMatches.values());\n\t}\n\n\tget webviewMatches(): MatchInNotebook[] {\n\t\treturn Array.from(this._webviewMatches.values());\n\t}\n\n\tremove(matches: MatchInNotebook | MatchInNotebook[]): void {\n\t\tif (!Array.isArray(matches)) {\n\t\t\tmatches = [matches];\n\t\t}\n\t\tfor (const match of matches) {\n\t\t\tthis._contentMatches.delete(match.id());\n\t\t\tthis._webviewMatches.delete(match.id());\n\t\t}\n\t}\n\n\tclearAllMatches() {\n\t\tthis._contentMatches.clear();\n\t\tthis._webviewMatches.clear();\n\t}\n\n\taddContentMatches(textSearchMatches: ITextSearchMatch[]) {\n\t\tconst contentMatches = textSearchMatchesToNotebookMatches(textSearchMatches, this);\n\t\tcontentMatches.forEach((match) => {\n\t\t\tthis._contentMatches.set(match.id(), match);\n\t\t});\n\t\tthis.addContext(textSearchMatches);\n\t}\n\n\tpublic addContext(textSearchMatches: ITextSearchMatch[]) {\n\t\tif (!this.cell) {\n\t\t\t// todo: get closed notebook results in search editor\n\t\t\treturn;\n\t\t}\n\t\tthis.cell.resolveTextModel().then((textModel) => {\n\t\t\tconst textResultsWithContext = getTextSearchMatchWithModelContext(textSearchMatches, textModel, this.parent.parent().query!);\n\t\t\tconst contexts = textResultsWithContext.filter((result => !resultIsMatch(result)) as ((a: any) => a is ITextSearchContext));\n\t\t\tcontexts.map(context => ({ ...context, lineNumber: context.lineNumber + 1 }))\n\t\t\t\t.forEach((context) => { this._context.set(context.lineNumber, context.text); });\n\t\t});\n\t}\n\n\taddWebviewMatches(textSearchMatches: ITextSearchMatch[]) {\n\t\tconst webviewMatches = textSearchMatchesToNotebookMatches(textSearchMatches, this);\n\t\twebviewMatches.forEach((match) => {\n\t\t\tthis._webviewMatches.set(match.id(), match);\n\t\t});\n\t\t// TODO: add webview results to context\n\t}\n\n\n\tsetCellModel(cell: ICellViewModel) {\n\t\tthis._cell = cell;\n\t}\n\n\tget parent(): INotebookFileInstanceMatch {\n\t\treturn this._parent;\n\t}\n\n\tget id(): string {\n\t\treturn this._cell?.id ?? `${rawCellPrefix}${this.cellIndex}`;\n\t}\n\n\tget cellIndex(): number {\n\t\treturn this._cellIndex;\n\t}\n\n\tget cell(): ICellViewModel | undefined {\n\t\treturn this._cell;\n\t}\n\n}\n\nexport class NotebookCompatibleFileMatch extends FileMatchImpl implements INotebookFileInstanceMatch {\n\n\n\tprivate _notebookEditorWidget: NotebookEditorWidget | null = null;\n\tprivate _editorWidgetListener: IDisposable | null = null;\n\tprivate _notebookUpdateScheduler: RunOnceScheduler;\n\tprivate _lastEditorWidgetIdForUpdate: string | undefined;\n\n\tconstructor(\n\t\t_query: IPatternInfo,\n\t\t_previewOptions: ITextSearchPreviewOptions | undefined,\n\t\t_maxResults: number | undefined,\n\t\t_parent: ISearchTreeFolderMatch,\n\t\trawMatch: IFileMatch,\n\t\t_closestRoot: ISearchTreeFolderMatchWorkspaceRoot | null,\n\t\tprivate readonly searchInstanceID: string,\n\t\t@IModelService modelService: IModelService,\n\t\t@IReplaceService replaceService: IReplaceService,\n\t\t@ILabelService labelService: ILabelService,\n\t\t@INotebookEditorService private readonly notebookEditorService: INotebookEditorService,\n\t) {\n\t\tsuper(_query, _previewOptions, _maxResults, _parent, rawMatch, _closestRoot, modelService, replaceService, labelService);\n\t\tthis._cellMatches = new Map<string, ICellMatch>();\n\t\tthis._notebookUpdateScheduler = new RunOnceScheduler(this.updateMatchesForEditorWidget.bind(this), 250);\n\t}\n\tprivate _cellMatches: Map<string, ICellMatch>;\n\tpublic get cellContext(): Map<string, Map<number, string>> {\n\t\tconst cellContext = new Map<string, Map<number, string>>();\n\t\tthis._cellMatches.forEach(cellMatch => {\n\t\t\tcellContext.set(cellMatch.id, cellMatch.context);\n\t\t});\n\t\treturn cellContext;\n\t}\n\n\tgetCellMatch(cellID: string): ICellMatch | undefined {\n\t\treturn this._cellMatches.get(cellID);\n\t}\n\n\taddCellMatch(rawCell: INotebookCellMatchNoModel | INotebookCellMatchWithModel) {\n\t\tconst cellMatch = new CellMatch(this, isINotebookCellMatchWithModel(rawCell) ? rawCell.cell : undefined, rawCell.index);\n\t\tthis._cellMatches.set(cellMatch.id, cellMatch);\n\t\tthis.addWebviewMatchesToCell(cellMatch.id, rawCell.webviewResults);\n\t\tthis.addContentMatchesToCell(cellMatch.id, rawCell.contentResults);\n\t}\n\n\taddWebviewMatchesToCell(cellID: string, webviewMatches: ITextSearchMatch[]) {\n\t\tconst cellMatch = this.getCellMatch(cellID);\n\t\tif (cellMatch !== undefined) {\n\t\t\tcellMatch.addWebviewMatches(webviewMatches);\n\t\t}\n\t}\n\n\taddContentMatchesToCell(cellID: string, contentMatches: ITextSearchMatch[]) {\n\t\tconst cellMatch = this.getCellMatch(cellID);\n\t\tif (cellMatch !== undefined) {\n\t\t\tcellMatch.addContentMatches(contentMatches);\n\t\t}\n\t}\n\n\tprivate revealCellRange(match: MatchInNotebook, outputOffset: number | null) {\n\t\tif (!this._notebookEditorWidget || !match.cell) {\n\t\t\t// match cell should never be a CellSearchModel if the notebook is open\n\t\t\treturn;\n\t\t}\n\t\tif (match.webviewIndex !== undefined) {\n\t\t\tconst index = this._notebookEditorWidget.getCellIndex(match.cell);\n\t\t\tif (index !== undefined) {\n\t\t\t\tthis._notebookEditorWidget.revealCellOffsetInCenter(match.cell, outputOffset ?? 0);\n\t\t\t}\n\t\t} else {\n\t\t\tmatch.cell.updateEditState(match.cell.getEditState(), 'focusNotebookCell');\n\t\t\tthis._notebookEditorWidget.setCellEditorSelection(match.cell, match.range());\n\t\t\tthis._notebookEditorWidget.revealRangeInCenterIfOutsideViewportAsync(match.cell, match.range());\n\t\t}\n\t}\n\n\n\tbindNotebookEditorWidget(widget: NotebookEditorWidget) {\n\t\tif (this._notebookEditorWidget === widget) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._notebookEditorWidget = widget;\n\n\t\tthis._editorWidgetListener = this._notebookEditorWidget.textModel?.onDidChangeContent((e) => {\n\t\t\tif (!e.rawEvents.some(event => event.kind === NotebookCellsChangeType.ChangeCellContent || event.kind === NotebookCellsChangeType.ModelChange)) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis._notebookUpdateScheduler.schedule();\n\t\t}) ?? null;\n\t\tthis._addNotebookHighlights();\n\t}\n\n\tunbindNotebookEditorWidget(widget?: NotebookEditorWidget) {\n\t\tif (widget && this._notebookEditorWidget !== widget) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (this._notebookEditorWidget) {\n\t\t\tthis._notebookUpdateScheduler.cancel();\n\t\t\tthis._editorWidgetListener?.dispose();\n\t\t}\n\t\tthis._removeNotebookHighlights();\n\t\tthis._notebookEditorWidget = null;\n\t}\n\n\tupdateNotebookHighlights(): void {\n\t\tif (this.parent().showHighlights) {\n\t\t\tthis._addNotebookHighlights();\n\t\t\tthis.setNotebookFindMatchDecorationsUsingCellMatches(Array.from(this._cellMatches.values()));\n\t\t} else {\n\t\t\tthis._removeNotebookHighlights();\n\t\t}\n\t}\n\n\tprivate _addNotebookHighlights(): void {\n\t\tif (!this._notebookEditorWidget) {\n\t\t\treturn;\n\t\t}\n\t\tthis._findMatchDecorationModel?.stopWebviewFind();\n\t\tthis._findMatchDecorationModel?.dispose();\n\t\tthis._findMatchDecorationModel = new FindMatchDecorationModel(this._notebookEditorWidget, this.searchInstanceID);\n\t\tif (this._selectedMatch instanceof MatchInNotebook) {\n\t\t\tthis.highlightCurrentFindMatchDecoration(this._selectedMatch);\n\t\t}\n\t}\n\n\tprivate _removeNotebookHighlights(): void {\n\t\tif (this._findMatchDecorationModel) {\n\t\t\tthis._findMatchDecorationModel?.stopWebviewFind();\n\t\t\tthis._findMatchDecorationModel?.dispose();\n\t\t\tthis._findMatchDecorationModel = undefined;\n\t\t}\n\t}\n\n\tprivate updateNotebookMatches(matches: CellFindMatchWithIndex[], modelChange: boolean): void {\n\t\tif (!this._notebookEditorWidget) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst oldCellMatches = new Map<string, ICellMatch>(this._cellMatches);\n\t\tif (this._notebookEditorWidget.getId() !== this._lastEditorWidgetIdForUpdate) {\n\t\t\tthis._cellMatches.clear();\n\t\t\tthis._lastEditorWidgetIdForUpdate = this._notebookEditorWidget.getId();\n\t\t}\n\t\tmatches.forEach(match => {\n\t\t\tlet existingCell = this._cellMatches.get(match.cell.id);\n\t\t\tif (this._notebookEditorWidget && !existingCell) {\n\t\t\t\tconst index = this._notebookEditorWidget.getCellIndex(match.cell);\n\t\t\t\tconst existingRawCell = oldCellMatches.get(`${rawCellPrefix}${index}`);\n\t\t\t\tif (existingRawCell) {\n\t\t\t\t\texistingRawCell.setCellModel(match.cell);\n\t\t\t\t\texistingRawCell.clearAllMatches();\n\t\t\t\t\texistingCell = existingRawCell;\n\t\t\t\t}\n\t\t\t}\n\t\t\texistingCell?.clearAllMatches();\n\t\t\tconst cell = existingCell ?? new CellMatch(this, match.cell, match.index);\n\t\t\tcell.addContentMatches(contentMatchesToTextSearchMatches(match.contentMatches, match.cell));\n\t\t\tcell.addWebviewMatches(webviewMatchesToTextSearchMatches(match.webviewMatches));\n\t\t\tthis._cellMatches.set(cell.id, cell);\n\n\t\t});\n\n\t\tthis._findMatchDecorationModel?.setAllFindMatchesDecorations(matches);\n\t\tif (this._selectedMatch instanceof MatchInNotebook) {\n\t\t\tthis.highlightCurrentFindMatchDecoration(this._selectedMatch);\n\t\t}\n\t\tthis._onChange.fire({ forceUpdateModel: modelChange });\n\t}\n\n\tprivate setNotebookFindMatchDecorationsUsingCellMatches(cells: ICellMatch[]): void {\n\t\tif (!this._findMatchDecorationModel) {\n\t\t\treturn;\n\t\t}\n\t\tconst cellFindMatch = coalesce(cells.map((cell): CellFindMatchModel | undefined => {\n\t\t\tconst webviewMatches: CellWebviewFindMatch[] = coalesce(cell.webviewMatches.map((match): CellWebviewFindMatch | undefined => {\n\t\t\t\tif (!match.webviewIndex) {\n\t\t\t\t\treturn undefined;\n\t\t\t\t}\n\t\t\t\treturn {\n\t\t\t\t\tindex: match.webviewIndex,\n\t\t\t\t};\n\t\t\t}));\n\t\t\tif (!cell.cell) {\n\t\t\t\treturn undefined;\n\t\t\t}\n\t\t\tconst findMatches: FindMatch[] = cell.contentMatches.map(match => {\n\t\t\t\treturn new FindMatch(match.range(), [match.text()]);\n\t\t\t});\n\t\t\treturn new CellFindMatchModel(cell.cell, cell.cellIndex, findMatches, webviewMatches);\n\t\t}));\n\t\ttry {\n\t\t\tthis._findMatchDecorationModel.setAllFindMatchesDecorations(cellFindMatch);\n\t\t} catch (e) {\n\t\t\t// no op, might happen due to bugs related to cell output regex search\n\t\t}\n\t}\n\tasync updateMatchesForEditorWidget(): Promise<void> {\n\t\tif (!this._notebookEditorWidget) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._textMatches = new Map<string, ISearchTreeMatch>();\n\n\t\tconst wordSeparators = this._query.isWordMatch && this._query.wordSeparators ? this._query.wordSeparators : null;\n\t\tconst allMatches = await this._notebookEditorWidget\n\t\t\t.find(this._query.pattern, {\n\t\t\t\tregex: this._query.isRegExp,\n\t\t\t\twholeWord: this._query.isWordMatch,\n\t\t\t\tcaseSensitive: this._query.isCaseSensitive,\n\t\t\t\twordSeparators: wordSeparators ?? undefined,\n\t\t\t\tincludeMarkupInput: this._query.notebookInfo?.isInNotebookMarkdownInput,\n\t\t\t\tincludeMarkupPreview: this._query.notebookInfo?.isInNotebookMarkdownPreview,\n\t\t\t\tincludeCodeInput: this._query.notebookInfo?.isInNotebookCellInput,\n\t\t\t\tincludeOutput: this._query.notebookInfo?.isInNotebookCellOutput,\n\t\t\t}, CancellationToken.None, false, true, this.searchInstanceID);\n\n\t\tthis.updateNotebookMatches(allMatches, true);\n\t}\n\n\tpublic async showMatch(match: MatchInNotebook) {\n\t\tconst offset = await this.highlightCurrentFindMatchDecoration(match);\n\t\tthis.setSelectedMatch(match);\n\t\tthis.revealCellRange(match, offset);\n\t}\n\n\tprivate async highlightCurrentFindMatchDecoration(match: MatchInNotebook): Promise<number | null> {\n\t\tif (!this._findMatchDecorationModel || !match.cell) {\n\t\t\t// match cell should never be a CellSearchModel if the notebook is open\n\t\t\treturn null;\n\t\t}\n\t\tif (match.webviewIndex === undefined) {\n\t\t\treturn this._findMatchDecorationModel.highlightCurrentFindMatchDecorationInCell(match.cell, match.range());\n\t\t} else {\n\t\t\treturn this._findMatchDecorationModel.highlightCurrentFindMatchDecorationInWebview(match.cell, match.webviewIndex);\n\t\t}\n\t}\n\n\n\toverride matches(): ISearchTreeMatch[] {\n\t\tconst matches = Array.from(this._cellMatches.values()).flatMap((e) => e.matches());\n\t\treturn [...super.matches(), ...matches];\n\t}\n\n\tprotected override removeMatch(match: ISearchTreeMatch) {\n\n\t\tif (match instanceof MatchInNotebook) {\n\t\t\tmatch.cellParent.remove(match);\n\t\t\tif (match.cellParent.matches().length === 0) {\n\t\t\t\tthis._cellMatches.delete(match.cellParent.id);\n\t\t\t}\n\n\t\t\tif (this.isMatchSelected(match)) {\n\t\t\t\tthis.setSelectedMatch(null);\n\t\t\t\tthis._findMatchDecorationModel?.clearCurrentFindMatchDecoration();\n\t\t\t} else {\n\t\t\t\tthis.updateHighlights();\n\t\t\t}\n\n\t\t\tthis.setNotebookFindMatchDecorationsUsingCellMatches(this.cellMatches());\n\t\t} else {\n\t\t\tsuper.removeMatch(match);\n\t\t}\n\t}\n\n\tcellMatches(): ICellMatch[] {\n\t\treturn Array.from(this._cellMatches.values());\n\t}\n\n\n\toverride createMatches(): void {\n\t\tconst model = this.modelService.getModel(this._resource);\n\t\tif (model) {\n\t\t\t// todo: handle better when ai contributed results has model, currently, createMatches does not work for this\n\t\t\tthis.bindModel(model);\n\t\t\tthis.updateMatchesForModel();\n\t\t} else {\n\t\t\tconst notebookEditorWidgetBorrow = this.notebookEditorService.retrieveExistingWidgetFromURI(this.resource);\n\n\t\t\tif (notebookEditorWidgetBorrow?.value) {\n\t\t\t\tthis.bindNotebookEditorWidget(notebookEditorWidgetBorrow.value);\n\t\t\t}\n\t\t\tif (this.rawMatch.results) {\n\t\t\t\tthis.rawMatch.results\n\t\t\t\t\t.filter(resultIsMatch)\n\t\t\t\t\t.forEach(rawMatch => {\n\t\t\t\t\t\ttextSearchResultToMatches(rawMatch, this, false)\n\t\t\t\t\t\t\t.forEach(m => this.add(m));\n\t\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (isINotebookFileMatchWithModel(this.rawMatch) || isINotebookFileMatchNoModel(this.rawMatch)) {\n\t\t\t\tthis.rawMatch.cellResults?.forEach(cell => this.addCellMatch(cell));\n\t\t\t\tthis.setNotebookFindMatchDecorationsUsingCellMatches(this.cellMatches());\n\t\t\t\tthis._onChange.fire({ forceUpdateModel: true });\n\t\t\t}\n\t\t\tthis.addContext(this.rawMatch.results);\n\t\t}\n\t}\n\n\toverride get hasChildren(): boolean {\n\t\treturn super.hasChildren || this._cellMatches.size > 0;\n\t}\n\n\toverride setSelectedMatch(match: ISearchTreeMatch | null): void {\n\t\tif (match) {\n\t\t\tif (!this.isMatchSelected(match) && isIMatchInNotebook(match)) {\n\t\t\t\tthis._selectedMatch = match;\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (!this._textMatches.has(match.id())) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (this.isMatchSelected(match)) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tthis._selectedMatch = match;\n\t\tthis.updateHighlights();\n\t}\n\n\toverride dispose(): void {\n\t\tthis.unbindNotebookEditorWidget();\n\t\tsuper.dispose();\n\t}\n\n}\n// text search to notebook matches\n\nexport function textSearchMatchesToNotebookMatches(textSearchMatches: ITextSearchMatch[], cell: CellMatch): MatchInNotebook[] {\n\tconst notebookMatches: MatchInNotebook[] = [];\n\ttextSearchMatches.forEach((textSearchMatch) => {\n\t\tconst previewLines = textSearchMatch.previewText.split('\\n');\n\t\ttextSearchMatch.rangeLocations.map((rangeLocation) => {\n\t\t\tconst previewRange: ISearchRange = rangeLocation.preview;\n\t\t\tconst match = new MatchInNotebook(cell, previewLines, previewRange, rangeLocation.source, textSearchMatch.webviewIndex);\n\t\t\tnotebookMatches.push(match);\n\t\t});\n\t});\n\treturn notebookMatches;\n}\n"]}