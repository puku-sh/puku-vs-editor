{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/contrib/search/browser/AISearch/aiSearchModel.ts","vs/workbench/contrib/search/browser/AISearch/aiSearchModel.ts"],"names":[],"mappings":"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","file":"aiSearchModel.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Emitter, Event } from '../../../../../base/common/event.js';\nimport { Lazy } from '../../../../../base/common/lazy.js';\nimport { Disposable } from '../../../../../base/common/lifecycle.js';\nimport { URI } from '../../../../../base/common/uri.js';\nimport { IPosition } from '../../../../../editor/common/core/position.js';\nimport { ITextModel } from '../../../../../editor/common/model.js';\nimport { IModelService } from '../../../../../editor/common/services/model.js';\nimport { IInstantiationService } from '../../../../../platform/instantiation/common/instantiation.js';\nimport { ILabelService } from '../../../../../platform/label/common/label.js';\nimport { IUriIdentityService } from '../../../../../platform/uriIdentity/common/uriIdentity.js';\nimport { IAITextQuery, IFileMatch, ITextSearchPreviewOptions, resultIsMatch } from '../../../../services/search/common/search.js';\nimport { NotebookEditorWidget } from '../../../notebook/browser/notebookEditorWidget.js';\nimport { IReplaceService } from '../replace.js';\n\nimport { FileMatchImpl } from '../searchTreeModel/fileMatch.js';\nimport { ISearchResult, TEXT_SEARCH_HEADING_PREFIX, AI_TEXT_SEARCH_RESULT_ID, ISearchTreeFolderMatchWorkspaceRoot, ISearchTreeFolderMatch, ISearchTreeFolderMatchWithResource, ITextSearchHeading, IChangeEvent, ISearchModel, ISearchTreeFileMatch, FOLDER_MATCH_PREFIX, getFileMatches, FILE_MATCH_PREFIX } from '../searchTreeModel/searchTreeCommon.js';\nimport { TextSearchHeadingImpl } from '../searchTreeModel/textSearchHeading.js';\nimport { Range } from '../../../../../editor/common/core/range.js';\nimport { textSearchResultToMatches } from '../searchTreeModel/match.js';\nimport { ISearchTreeAIFileMatch } from './aiSearchModelBase.js';\nimport { ResourceSet } from '../../../../../base/common/map.js';\n\nexport class AITextSearchHeadingImpl extends TextSearchHeadingImpl<IAITextQuery> {\n\tpublic override hidden: boolean;\n\tconstructor(\n\t\tparent: ISearchResult,\n\t\t@IInstantiationService instantiationService: IInstantiationService,\n\t\t@IUriIdentityService uriIdentityService: IUriIdentityService\n\t) {\n\t\tsuper(false, parent, instantiationService, uriIdentityService);\n\n\t\tthis.hidden = true;\n\t}\n\n\toverride name(): string {\n\t\treturn 'AI';\n\t}\n\n\tid(): string {\n\t\treturn TEXT_SEARCH_HEADING_PREFIX + AI_TEXT_SEARCH_RESULT_ID;\n\t}\n\n\tget isAIContributed(): boolean {\n\t\treturn true;\n\t}\n\n\toverride get query(): IAITextQuery | null {\n\t\treturn this._query;\n\t}\n\n\toverride set query(query: IAITextQuery | null) {\n\t\tthis.clearQuery();\n\t\tif (!query) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._folderMatches = (query && query.folderQueries || [])\n\t\t\t.map(fq => fq.folder)\n\t\t\t.map((resource, index) => <ISearchTreeFolderMatchWorkspaceRoot>this._createBaseFolderMatch(resource, resource.toString(), index, query));\n\n\t\tthis._folderMatches.forEach(fm => this._folderMatchesMap.set(fm.resource, fm));\n\n\t\tthis._query = query;\n\t}\n\n\toverride fileCount(): number {\n\t\tconst uniqueFileUris = new ResourceSet();\n\t\tfor (const folderMatch of this.folderMatches()) {\n\t\t\tif (folderMatch.isEmpty()) {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tfor (const fileMatch of folderMatch.allDownstreamFileMatches()) {\n\t\t\t\tuniqueFileUris.add(fileMatch.resource);\n\t\t\t}\n\t\t}\n\n\t\treturn uniqueFileUris.size;\n\t}\n\n\tprivate _createBaseFolderMatch(resource: URI, id: string, index: number, query: IAITextQuery): ISearchTreeFolderMatch {\n\t\tconst folderMatch: ISearchTreeFolderMatch = this._register(this.createWorkspaceRootWithResourceImpl(resource, id, index, query));\n\t\tconst disposable = folderMatch.onChange((event) => this._onChange.fire(event));\n\t\tthis._register(folderMatch.onDispose(() => disposable.dispose()));\n\t\treturn folderMatch;\n\t}\n\n\tprivate createWorkspaceRootWithResourceImpl(resource: URI, id: string, index: number, query: IAITextQuery): ISearchTreeFolderMatchWorkspaceRoot {\n\t\treturn this.instantiationService.createInstance(AIFolderMatchWorkspaceRootImpl, resource, id, index, query, this);\n\t}\n}\n\nexport class AIFolderMatchWorkspaceRootImpl extends Disposable implements ISearchTreeFolderMatchWorkspaceRoot {\n\tprotected _onChange = this._register(new Emitter<IChangeEvent>());\n\treadonly onChange: Event<IChangeEvent> = this._onChange.event;\n\n\tprivate _onDispose = this._register(new Emitter<void>());\n\treadonly onDispose: Event<void> = this._onDispose.event;\n\tprivate readonly _id: string;\n\tprivate _name: Lazy<string>;\n\tprotected _unDisposedFileMatches: Map<string, ISearchTreeFileMatch>; // id to fileMatch\n\n\tprotected _fileMatches: Map<string, ISearchTreeFileMatch>; // id to fileMatch\n\n\tconstructor(private _resource: URI,\n\t\t_id: string,\n\t\tprivate _index: number,\n\t\tprivate _query: IAITextQuery,\n\t\tprivate _parent: ITextSearchHeading,\n\t\t@IInstantiationService private instantiationService: IInstantiationService,\n\t\t@ILabelService labelService: ILabelService,\n\t) {\n\t\tsuper();\n\t\tthis._fileMatches = new Map<string, ISearchTreeFileMatch>();\n\n\t\tthis._id = FOLDER_MATCH_PREFIX + _id;\n\t\tthis._name = new Lazy(() => this.resource ? labelService.getUriBasenameLabel(this.resource) : '');\n\t\tthis._unDisposedFileMatches = new Map<string, ISearchTreeFileMatch>();\n\t}\n\tget resource(): URI {\n\t\treturn this._resource;\n\t}\n\tid(): string {\n\t\treturn this._id;\n\t}\n\n\tindex(): number {\n\t\treturn this._index;\n\t}\n\tname(): string {\n\t\treturn this._name.value;\n\t}\n\tcount(): number {\n\t\treturn this._fileMatches.size;\n\t}\n\n\tdoAddFile(fileMatch: ISearchTreeFileMatch): void {\n\t\tthis._fileMatches.set(fileMatch.id(), fileMatch);\n\t}\n\n\tprivate latestRank = 0;\n\tcreateAndConfigureFileMatch(rawFileMatch: IFileMatch<URI>, searchInstanceID: string): FileMatchImpl {\n\n\t\tconst fileMatch =\n\t\t\tthis.instantiationService.createInstance(\n\t\t\t\tAIFileMatch,\n\t\t\t\tthis._query.contentPattern,\n\t\t\t\tthis._query.previewOptions,\n\t\t\t\tthis._query.maxResults,\n\t\t\t\tthis,\n\t\t\t\trawFileMatch,\n\t\t\t\tthis,\n\t\t\t\trawFileMatch.resource.toString() + '_' + Date.now().toString(),\n\t\t\t\tthis.latestRank++,\n\t\t\t);\n\t\tfileMatch.createMatches();\n\t\tthis.doAddFile(fileMatch);\n\t\tconst disposable = fileMatch.onChange(({ didRemove }) => this.onFileChange(fileMatch, didRemove));\n\t\tthis._register(fileMatch.onDispose(() => disposable.dispose()));\n\t\treturn fileMatch;\n\t}\n\n\tisAIContributed(): boolean {\n\t\treturn true;\n\t}\n\n\tprivate onFileChange(fileMatch: ISearchTreeFileMatch, removed = false): void {\n\t\tlet added = false;\n\t\tif (!this._fileMatches.has(fileMatch.id())) {\n\t\t\tthis.doAddFile(fileMatch);\n\t\t\tadded = true;\n\t\t}\n\t\tif (fileMatch.count() === 0) {\n\t\t\tthis.doRemoveFile([fileMatch], false, false);\n\t\t\tadded = false;\n\t\t\tremoved = true;\n\t\t}\n\t\tthis._onChange.fire({ elements: [fileMatch], added: added, removed: removed });\n\n\t}\n\n\tget hasChildren(): boolean {\n\t\treturn this._fileMatches.size > 0;\n\t}\n\n\tparent(): ISearchTreeFolderMatch | ITextSearchHeading {\n\t\treturn this._parent;\n\t}\n\tmatches(): (ISearchTreeFileMatch | ISearchTreeFolderMatchWithResource)[] {\n\t\treturn [...this._fileMatches.values()];\n\t}\n\tallDownstreamFileMatches(): ISearchTreeFileMatch[] {\n\t\treturn [...this._fileMatches.values()];\n\t}\n\n\tremove(matches: ISearchTreeFileMatch | ISearchTreeFolderMatchWithResource | (ISearchTreeFileMatch | ISearchTreeFolderMatchWithResource)[]): void {\n\t\tif (!Array.isArray(matches)) {\n\t\t\tmatches = [matches];\n\t\t}\n\t\tconst allMatches = getFileMatches(matches);\n\t\tthis.doRemoveFile(allMatches);\n\t}\n\taddFileMatch(raw: IFileMatch[], silent: boolean, searchInstanceID: string): void {\n\t\t// when adding a fileMatch that has intermediate directories\n\t\tconst added: ISearchTreeFileMatch[] = [];\n\t\tconst updated: ISearchTreeFileMatch[] = [];\n\n\t\traw.forEach(rawFileMatch => {\n\t\t\tconst fileMatch = this.createAndConfigureFileMatch(rawFileMatch, searchInstanceID);\n\t\t\tadded.push(fileMatch);\n\t\t});\n\n\t\tconst elements = [...added, ...updated];\n\t\tif (!silent && elements.length) {\n\t\t\tthis._onChange.fire({ elements, added: !!added.length });\n\t\t}\n\t}\n\tisEmpty(): boolean {\n\t\treturn this.recursiveFileCount() === 0;\n\t}\n\tclear(clearingAll?: boolean): void {\n\t\tconst changed: ISearchTreeFileMatch[] = this.allDownstreamFileMatches();\n\t\tif (changed.length > 0) {\n\t\t\tthis.disposeMatches();\n\t\t\tthis._onChange.fire({ elements: changed, removed: true, added: false, clearingAll });\n\t\t}\n\t}\n\n\tget showHighlights(): boolean {\n\t\treturn this._parent.showHighlights;\n\t}\n\n\tget searchModel(): ISearchModel {\n\t\treturn this._searchResult.searchModel;\n\t}\n\n\tget _searchResult(): ISearchResult {\n\t\treturn this._parent.parent();\n\t}\n\n\tget query(): IAITextQuery | null {\n\t\treturn this._query;\n\t}\n\tgetDownstreamFileMatch(uri: URI): ISearchTreeFileMatch | null {\n\t\tfor (const fileMatch of this._fileMatches.values()) {\n\t\t\tif (fileMatch.resource.toString() === uri.toString()) {\n\t\t\t\treturn fileMatch;\n\t\t\t}\n\t\t}\n\t\treturn null;\n\t}\n\treplaceAll(): Promise<any> {\n\t\tthrow new Error('Cannot replace in AI search');\n\t}\n\trecursiveFileCount(): number {\n\t\treturn this._fileMatches.size;\n\t}\n\n\tdoRemoveFile(fileMatches: ISearchTreeFileMatch[], dispose: boolean = true, trigger: boolean = true, keepReadonly = false): void {\n\n\t\tconst removed = [];\n\t\tfor (const match of fileMatches as ISearchTreeFileMatch[]) {\n\t\t\tif (this._fileMatches.get(match.id())) {\n\t\t\t\tif (keepReadonly && match.hasReadonlyMatches()) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tthis._fileMatches.delete(match.id());\n\t\t\t\tif (dispose) {\n\t\t\t\t\tmatch.dispose();\n\t\t\t\t} else {\n\t\t\t\t\tthis._unDisposedFileMatches.set(match.id(), match);\n\t\t\t\t}\n\t\t\t\tremoved.push(match);\n\t\t\t}\n\t\t}\n\n\t\tif (trigger) {\n\t\t\tthis._onChange.fire({ elements: removed, removed: true });\n\t\t}\n\t}\n\n\treplace(match: ISearchTreeFileMatch): Promise<any> {\n\t\tthrow new Error('Cannot replace in AI search');\n\t}\n\treplacingAll: boolean = false;\n\n\tbindModel(model: ITextModel): void {\n\t\t// no op\n\t}\n\tunbindNotebookEditorWidget(editor: NotebookEditorWidget, resource: URI): void {\n\t\t//no op\n\t}\n\tbindNotebookEditorWidget(editor: NotebookEditorWidget, resource: URI): Promise<void> {\n\t\t//no op\n\t\treturn Promise.resolve();\n\t}\n\n\thasOnlyReadOnlyMatches(): boolean {\n\t\treturn Array.from(this._fileMatches.values()).every(fm => fm.hasOnlyReadOnlyMatches());\n\t}\n\tfileMatchesIterator(): IterableIterator<ISearchTreeFileMatch> {\n\t\treturn this._fileMatches.values();\n\t}\n\tfolderMatchesIterator(): IterableIterator<ISearchTreeFolderMatchWithResource> {\n\t\treturn [].values();\n\t}\n\trecursiveMatchCount(): number {\n\t\treturn this._fileMatches.size;\n\t}\n\n\tprivate disposeMatches(): void {\n\t\t[...this._fileMatches.values()].forEach((fileMatch: ISearchTreeFileMatch) => fileMatch.dispose());\n\t\t[...this._unDisposedFileMatches.values()].forEach((fileMatch: ISearchTreeFileMatch) => fileMatch.dispose());\n\t\tthis._fileMatches.clear();\n\t}\n\n\toverride dispose(): void {\n\t\tthis.disposeMatches();\n\t\tthis._onDispose.fire();\n\t\tsuper.dispose();\n\t}\n}\n\nclass AIFileMatch extends FileMatchImpl implements ISearchTreeAIFileMatch {\n\tconstructor(\n\t\t_query: string,\n\t\t_previewOptions: ITextSearchPreviewOptions | undefined,\n\t\t_maxResults: number | undefined,\n\t\t_parent: ISearchTreeFolderMatch,\n\t\trawMatch: IFileMatch,\n\t\t_closestRoot: ISearchTreeFolderMatchWorkspaceRoot | null,\n\t\tprivate readonly _id: string,\n\t\tpublic readonly rank: number,\n\t\t@IModelService modelService: IModelService,\n\t\t@IReplaceService replaceService: IReplaceService,\n\t\t@ILabelService labelService: ILabelService,\n\t) {\n\t\tsuper({ pattern: _query }, _previewOptions, _maxResults, _parent, rawMatch, _closestRoot, modelService, replaceService, labelService);\n\t}\n\n\toverride id() {\n\t\treturn FILE_MATCH_PREFIX + this._id;\n\t}\n\tgetFullRange(): Range | undefined {\n\n\t\tlet earliestStart: IPosition | undefined = undefined;\n\t\tlet latestEnd: IPosition | undefined = undefined;\n\n\t\tfor (const match of this.matches()) {\n\t\t\tconst matchStart = match.range().getStartPosition();\n\t\t\tconst matchEnd = match.range().getEndPosition();\n\t\t\tif (earliestStart === undefined) {\n\t\t\t\tearliestStart = matchStart;\n\t\t\t} else if (matchStart.isBefore(earliestStart)) {\n\t\t\t\tearliestStart = matchStart;\n\t\t\t}\n\n\t\t\tif (latestEnd === undefined) {\n\t\t\t\tlatestEnd = matchEnd;\n\t\t\t} else if (!matchEnd.isBefore(latestEnd)) {\n\t\t\t\tlatestEnd = matchEnd;\n\t\t\t}\n\t\t}\n\n\t\tif (earliestStart === undefined || latestEnd === undefined) {\n\t\t\treturn undefined;\n\t\t}\n\t\treturn new Range(earliestStart.lineNumber, earliestStart.column, latestEnd.lineNumber, latestEnd.column);\n\n\t}\n\n\tprivate rangeAsString(): undefined | string {\n\t\tconst range = this.getFullRange();\n\t\tif (!range) {\n\t\t\treturn undefined;\n\t\t}\n\t\treturn range.startLineNumber + ':' + range.startColumn + '-' + range.endLineNumber + ':' + range.endColumn;\n\t}\n\n\toverride name(): string {\n\t\tconst range = this.rangeAsString();\n\t\treturn super.name() + range ? ' ' + range : '';\n\t}\n\n\toverride createMatches(): void {\n\t\tif (this.rawMatch.results) {\n\t\t\tthis.rawMatch.results\n\t\t\t\t.filter(resultIsMatch)\n\t\t\t\t.forEach(rawMatch => {\n\t\t\t\t\ttextSearchResultToMatches(rawMatch, this, true)\n\t\t\t\t\t\t.forEach(m => this.add(m));\n\t\t\t\t});\n\t\t}\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Emitter, Event } from '../../../../../base/common/event.js';\nimport { Lazy } from '../../../../../base/common/lazy.js';\nimport { Disposable } from '../../../../../base/common/lifecycle.js';\nimport { URI } from '../../../../../base/common/uri.js';\nimport { IPosition } from '../../../../../editor/common/core/position.js';\nimport { ITextModel } from '../../../../../editor/common/model.js';\nimport { IModelService } from '../../../../../editor/common/services/model.js';\nimport { IInstantiationService } from '../../../../../platform/instantiation/common/instantiation.js';\nimport { ILabelService } from '../../../../../platform/label/common/label.js';\nimport { IUriIdentityService } from '../../../../../platform/uriIdentity/common/uriIdentity.js';\nimport { IAITextQuery, IFileMatch, ITextSearchPreviewOptions, resultIsMatch } from '../../../../services/search/common/search.js';\nimport { NotebookEditorWidget } from '../../../notebook/browser/notebookEditorWidget.js';\nimport { IReplaceService } from '../replace.js';\n\nimport { FileMatchImpl } from '../searchTreeModel/fileMatch.js';\nimport { ISearchResult, TEXT_SEARCH_HEADING_PREFIX, AI_TEXT_SEARCH_RESULT_ID, ISearchTreeFolderMatchWorkspaceRoot, ISearchTreeFolderMatch, ISearchTreeFolderMatchWithResource, ITextSearchHeading, IChangeEvent, ISearchModel, ISearchTreeFileMatch, FOLDER_MATCH_PREFIX, getFileMatches, FILE_MATCH_PREFIX } from '../searchTreeModel/searchTreeCommon.js';\nimport { TextSearchHeadingImpl } from '../searchTreeModel/textSearchHeading.js';\nimport { Range } from '../../../../../editor/common/core/range.js';\nimport { textSearchResultToMatches } from '../searchTreeModel/match.js';\nimport { ISearchTreeAIFileMatch } from './aiSearchModelBase.js';\nimport { ResourceSet } from '../../../../../base/common/map.js';\n\nexport class AITextSearchHeadingImpl extends TextSearchHeadingImpl<IAITextQuery> {\n\tpublic override hidden: boolean;\n\tconstructor(\n\t\tparent: ISearchResult,\n\t\t@IInstantiationService instantiationService: IInstantiationService,\n\t\t@IUriIdentityService uriIdentityService: IUriIdentityService\n\t) {\n\t\tsuper(false, parent, instantiationService, uriIdentityService);\n\n\t\tthis.hidden = true;\n\t}\n\n\toverride name(): string {\n\t\treturn 'AI';\n\t}\n\n\tid(): string {\n\t\treturn TEXT_SEARCH_HEADING_PREFIX + AI_TEXT_SEARCH_RESULT_ID;\n\t}\n\n\tget isAIContributed(): boolean {\n\t\treturn true;\n\t}\n\n\toverride get query(): IAITextQuery | null {\n\t\treturn this._query;\n\t}\n\n\toverride set query(query: IAITextQuery | null) {\n\t\tthis.clearQuery();\n\t\tif (!query) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._folderMatches = (query && query.folderQueries || [])\n\t\t\t.map(fq => fq.folder)\n\t\t\t.map((resource, index) => <ISearchTreeFolderMatchWorkspaceRoot>this._createBaseFolderMatch(resource, resource.toString(), index, query));\n\n\t\tthis._folderMatches.forEach(fm => this._folderMatchesMap.set(fm.resource, fm));\n\n\t\tthis._query = query;\n\t}\n\n\toverride fileCount(): number {\n\t\tconst uniqueFileUris = new ResourceSet();\n\t\tfor (const folderMatch of this.folderMatches()) {\n\t\t\tif (folderMatch.isEmpty()) {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tfor (const fileMatch of folderMatch.allDownstreamFileMatches()) {\n\t\t\t\tuniqueFileUris.add(fileMatch.resource);\n\t\t\t}\n\t\t}\n\n\t\treturn uniqueFileUris.size;\n\t}\n\n\tprivate _createBaseFolderMatch(resource: URI, id: string, index: number, query: IAITextQuery): ISearchTreeFolderMatch {\n\t\tconst folderMatch: ISearchTreeFolderMatch = this._register(this.createWorkspaceRootWithResourceImpl(resource, id, index, query));\n\t\tconst disposable = folderMatch.onChange((event) => this._onChange.fire(event));\n\t\tthis._register(folderMatch.onDispose(() => disposable.dispose()));\n\t\treturn folderMatch;\n\t}\n\n\tprivate createWorkspaceRootWithResourceImpl(resource: URI, id: string, index: number, query: IAITextQuery): ISearchTreeFolderMatchWorkspaceRoot {\n\t\treturn this.instantiationService.createInstance(AIFolderMatchWorkspaceRootImpl, resource, id, index, query, this);\n\t}\n}\n\nexport class AIFolderMatchWorkspaceRootImpl extends Disposable implements ISearchTreeFolderMatchWorkspaceRoot {\n\tprotected _onChange = this._register(new Emitter<IChangeEvent>());\n\treadonly onChange: Event<IChangeEvent> = this._onChange.event;\n\n\tprivate _onDispose = this._register(new Emitter<void>());\n\treadonly onDispose: Event<void> = this._onDispose.event;\n\tprivate readonly _id: string;\n\tprivate _name: Lazy<string>;\n\tprotected _unDisposedFileMatches: Map<string, ISearchTreeFileMatch>; // id to fileMatch\n\n\tprotected _fileMatches: Map<string, ISearchTreeFileMatch>; // id to fileMatch\n\n\tconstructor(private _resource: URI,\n\t\t_id: string,\n\t\tprivate _index: number,\n\t\tprivate _query: IAITextQuery,\n\t\tprivate _parent: ITextSearchHeading,\n\t\t@IInstantiationService private instantiationService: IInstantiationService,\n\t\t@ILabelService labelService: ILabelService,\n\t) {\n\t\tsuper();\n\t\tthis._fileMatches = new Map<string, ISearchTreeFileMatch>();\n\n\t\tthis._id = FOLDER_MATCH_PREFIX + _id;\n\t\tthis._name = new Lazy(() => this.resource ? labelService.getUriBasenameLabel(this.resource) : '');\n\t\tthis._unDisposedFileMatches = new Map<string, ISearchTreeFileMatch>();\n\t}\n\tget resource(): URI {\n\t\treturn this._resource;\n\t}\n\tid(): string {\n\t\treturn this._id;\n\t}\n\n\tindex(): number {\n\t\treturn this._index;\n\t}\n\tname(): string {\n\t\treturn this._name.value;\n\t}\n\tcount(): number {\n\t\treturn this._fileMatches.size;\n\t}\n\n\tdoAddFile(fileMatch: ISearchTreeFileMatch): void {\n\t\tthis._fileMatches.set(fileMatch.id(), fileMatch);\n\t}\n\n\tprivate latestRank = 0;\n\tcreateAndConfigureFileMatch(rawFileMatch: IFileMatch<URI>, searchInstanceID: string): FileMatchImpl {\n\n\t\tconst fileMatch =\n\t\t\tthis.instantiationService.createInstance(\n\t\t\t\tAIFileMatch,\n\t\t\t\tthis._query.contentPattern,\n\t\t\t\tthis._query.previewOptions,\n\t\t\t\tthis._query.maxResults,\n\t\t\t\tthis,\n\t\t\t\trawFileMatch,\n\t\t\t\tthis,\n\t\t\t\trawFileMatch.resource.toString() + '_' + Date.now().toString(),\n\t\t\t\tthis.latestRank++,\n\t\t\t);\n\t\tfileMatch.createMatches();\n\t\tthis.doAddFile(fileMatch);\n\t\tconst disposable = fileMatch.onChange(({ didRemove }) => this.onFileChange(fileMatch, didRemove));\n\t\tthis._register(fileMatch.onDispose(() => disposable.dispose()));\n\t\treturn fileMatch;\n\t}\n\n\tisAIContributed(): boolean {\n\t\treturn true;\n\t}\n\n\tprivate onFileChange(fileMatch: ISearchTreeFileMatch, removed = false): void {\n\t\tlet added = false;\n\t\tif (!this._fileMatches.has(fileMatch.id())) {\n\t\t\tthis.doAddFile(fileMatch);\n\t\t\tadded = true;\n\t\t}\n\t\tif (fileMatch.count() === 0) {\n\t\t\tthis.doRemoveFile([fileMatch], false, false);\n\t\t\tadded = false;\n\t\t\tremoved = true;\n\t\t}\n\t\tthis._onChange.fire({ elements: [fileMatch], added: added, removed: removed });\n\n\t}\n\n\tget hasChildren(): boolean {\n\t\treturn this._fileMatches.size > 0;\n\t}\n\n\tparent(): ISearchTreeFolderMatch | ITextSearchHeading {\n\t\treturn this._parent;\n\t}\n\tmatches(): (ISearchTreeFileMatch | ISearchTreeFolderMatchWithResource)[] {\n\t\treturn [...this._fileMatches.values()];\n\t}\n\tallDownstreamFileMatches(): ISearchTreeFileMatch[] {\n\t\treturn [...this._fileMatches.values()];\n\t}\n\n\tremove(matches: ISearchTreeFileMatch | ISearchTreeFolderMatchWithResource | (ISearchTreeFileMatch | ISearchTreeFolderMatchWithResource)[]): void {\n\t\tif (!Array.isArray(matches)) {\n\t\t\tmatches = [matches];\n\t\t}\n\t\tconst allMatches = getFileMatches(matches);\n\t\tthis.doRemoveFile(allMatches);\n\t}\n\taddFileMatch(raw: IFileMatch[], silent: boolean, searchInstanceID: string): void {\n\t\t// when adding a fileMatch that has intermediate directories\n\t\tconst added: ISearchTreeFileMatch[] = [];\n\t\tconst updated: ISearchTreeFileMatch[] = [];\n\n\t\traw.forEach(rawFileMatch => {\n\t\t\tconst fileMatch = this.createAndConfigureFileMatch(rawFileMatch, searchInstanceID);\n\t\t\tadded.push(fileMatch);\n\t\t});\n\n\t\tconst elements = [...added, ...updated];\n\t\tif (!silent && elements.length) {\n\t\t\tthis._onChange.fire({ elements, added: !!added.length });\n\t\t}\n\t}\n\tisEmpty(): boolean {\n\t\treturn this.recursiveFileCount() === 0;\n\t}\n\tclear(clearingAll?: boolean): void {\n\t\tconst changed: ISearchTreeFileMatch[] = this.allDownstreamFileMatches();\n\t\tif (changed.length > 0) {\n\t\t\tthis.disposeMatches();\n\t\t\tthis._onChange.fire({ elements: changed, removed: true, added: false, clearingAll });\n\t\t}\n\t}\n\n\tget showHighlights(): boolean {\n\t\treturn this._parent.showHighlights;\n\t}\n\n\tget searchModel(): ISearchModel {\n\t\treturn this._searchResult.searchModel;\n\t}\n\n\tget _searchResult(): ISearchResult {\n\t\treturn this._parent.parent();\n\t}\n\n\tget query(): IAITextQuery | null {\n\t\treturn this._query;\n\t}\n\tgetDownstreamFileMatch(uri: URI): ISearchTreeFileMatch | null {\n\t\tfor (const fileMatch of this._fileMatches.values()) {\n\t\t\tif (fileMatch.resource.toString() === uri.toString()) {\n\t\t\t\treturn fileMatch;\n\t\t\t}\n\t\t}\n\t\treturn null;\n\t}\n\treplaceAll(): Promise<any> {\n\t\tthrow new Error('Cannot replace in AI search');\n\t}\n\trecursiveFileCount(): number {\n\t\treturn this._fileMatches.size;\n\t}\n\n\tdoRemoveFile(fileMatches: ISearchTreeFileMatch[], dispose: boolean = true, trigger: boolean = true, keepReadonly = false): void {\n\n\t\tconst removed = [];\n\t\tfor (const match of fileMatches as ISearchTreeFileMatch[]) {\n\t\t\tif (this._fileMatches.get(match.id())) {\n\t\t\t\tif (keepReadonly && match.hasReadonlyMatches()) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tthis._fileMatches.delete(match.id());\n\t\t\t\tif (dispose) {\n\t\t\t\t\tmatch.dispose();\n\t\t\t\t} else {\n\t\t\t\t\tthis._unDisposedFileMatches.set(match.id(), match);\n\t\t\t\t}\n\t\t\t\tremoved.push(match);\n\t\t\t}\n\t\t}\n\n\t\tif (trigger) {\n\t\t\tthis._onChange.fire({ elements: removed, removed: true });\n\t\t}\n\t}\n\n\treplace(match: ISearchTreeFileMatch): Promise<any> {\n\t\tthrow new Error('Cannot replace in AI search');\n\t}\n\treplacingAll: boolean = false;\n\n\tbindModel(model: ITextModel): void {\n\t\t// no op\n\t}\n\tunbindNotebookEditorWidget(editor: NotebookEditorWidget, resource: URI): void {\n\t\t//no op\n\t}\n\tbindNotebookEditorWidget(editor: NotebookEditorWidget, resource: URI): Promise<void> {\n\t\t//no op\n\t\treturn Promise.resolve();\n\t}\n\n\thasOnlyReadOnlyMatches(): boolean {\n\t\treturn Array.from(this._fileMatches.values()).every(fm => fm.hasOnlyReadOnlyMatches());\n\t}\n\tfileMatchesIterator(): IterableIterator<ISearchTreeFileMatch> {\n\t\treturn this._fileMatches.values();\n\t}\n\tfolderMatchesIterator(): IterableIterator<ISearchTreeFolderMatchWithResource> {\n\t\treturn [].values();\n\t}\n\trecursiveMatchCount(): number {\n\t\treturn this._fileMatches.size;\n\t}\n\n\tprivate disposeMatches(): void {\n\t\t[...this._fileMatches.values()].forEach((fileMatch: ISearchTreeFileMatch) => fileMatch.dispose());\n\t\t[...this._unDisposedFileMatches.values()].forEach((fileMatch: ISearchTreeFileMatch) => fileMatch.dispose());\n\t\tthis._fileMatches.clear();\n\t}\n\n\toverride dispose(): void {\n\t\tthis.disposeMatches();\n\t\tthis._onDispose.fire();\n\t\tsuper.dispose();\n\t}\n}\n\nclass AIFileMatch extends FileMatchImpl implements ISearchTreeAIFileMatch {\n\tconstructor(\n\t\t_query: string,\n\t\t_previewOptions: ITextSearchPreviewOptions | undefined,\n\t\t_maxResults: number | undefined,\n\t\t_parent: ISearchTreeFolderMatch,\n\t\trawMatch: IFileMatch,\n\t\t_closestRoot: ISearchTreeFolderMatchWorkspaceRoot | null,\n\t\tprivate readonly _id: string,\n\t\tpublic readonly rank: number,\n\t\t@IModelService modelService: IModelService,\n\t\t@IReplaceService replaceService: IReplaceService,\n\t\t@ILabelService labelService: ILabelService,\n\t) {\n\t\tsuper({ pattern: _query }, _previewOptions, _maxResults, _parent, rawMatch, _closestRoot, modelService, replaceService, labelService);\n\t}\n\n\toverride id() {\n\t\treturn FILE_MATCH_PREFIX + this._id;\n\t}\n\tgetFullRange(): Range | undefined {\n\n\t\tlet earliestStart: IPosition | undefined = undefined;\n\t\tlet latestEnd: IPosition | undefined = undefined;\n\n\t\tfor (const match of this.matches()) {\n\t\t\tconst matchStart = match.range().getStartPosition();\n\t\t\tconst matchEnd = match.range().getEndPosition();\n\t\t\tif (earliestStart === undefined) {\n\t\t\t\tearliestStart = matchStart;\n\t\t\t} else if (matchStart.isBefore(earliestStart)) {\n\t\t\t\tearliestStart = matchStart;\n\t\t\t}\n\n\t\t\tif (latestEnd === undefined) {\n\t\t\t\tlatestEnd = matchEnd;\n\t\t\t} else if (!matchEnd.isBefore(latestEnd)) {\n\t\t\t\tlatestEnd = matchEnd;\n\t\t\t}\n\t\t}\n\n\t\tif (earliestStart === undefined || latestEnd === undefined) {\n\t\t\treturn undefined;\n\t\t}\n\t\treturn new Range(earliestStart.lineNumber, earliestStart.column, latestEnd.lineNumber, latestEnd.column);\n\n\t}\n\n\tprivate rangeAsString(): undefined | string {\n\t\tconst range = this.getFullRange();\n\t\tif (!range) {\n\t\t\treturn undefined;\n\t\t}\n\t\treturn range.startLineNumber + ':' + range.startColumn + '-' + range.endLineNumber + ':' + range.endColumn;\n\t}\n\n\toverride name(): string {\n\t\tconst range = this.rangeAsString();\n\t\treturn super.name() + range ? ' ' + range : '';\n\t}\n\n\toverride createMatches(): void {\n\t\tif (this.rawMatch.results) {\n\t\t\tthis.rawMatch.results\n\t\t\t\t.filter(resultIsMatch)\n\t\t\t\t.forEach(rawMatch => {\n\t\t\t\t\ttextSearchResultToMatches(rawMatch, this, true)\n\t\t\t\t\t\t.forEach(m => this.add(m));\n\t\t\t\t});\n\t\t}\n\t}\n}\n"]}