{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/contrib/search/common/search.ts","vs/workbench/contrib/search/common/search.ts"],"names":[],"mappings":"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","file":"search.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { onUnexpectedExternalError } from '../../../../base/common/errors.js';\nimport { IDisposable } from '../../../../base/common/lifecycle.js';\nimport { ISearchConfiguration, ISearchConfigurationProperties } from '../../../services/search/common/search.js';\nimport { SymbolKind, Location, ProviderResult, SymbolTag } from '../../../../editor/common/languages.js';\nimport { IWorkspaceContextService } from '../../../../platform/workspace/common/workspace.js';\nimport { URI } from '../../../../base/common/uri.js';\nimport { EditorResourceAccessor, SideBySideEditor } from '../../../common/editor.js';\nimport { IEditorService } from '../../../services/editor/common/editorService.js';\nimport { CancellationToken } from '../../../../base/common/cancellation.js';\nimport { ServicesAccessor } from '../../../../platform/instantiation/common/instantiation.js';\nimport { IFileService } from '../../../../platform/files/common/files.js';\nimport { IRange, Range } from '../../../../editor/common/core/range.js';\nimport { isNumber } from '../../../../base/common/types.js';\nimport { RawContextKey } from '../../../../platform/contextkey/common/contextkey.js';\nimport { compare } from '../../../../base/common/strings.js';\nimport { groupBy } from '../../../../base/common/arrays.js';\n\nexport interface IWorkspaceSymbol {\n\tname: string;\n\tcontainerName?: string;\n\tkind: SymbolKind;\n\ttags?: SymbolTag[];\n\tlocation: Location;\n}\n\nexport interface IWorkspaceSymbolProvider {\n\tprovideWorkspaceSymbols(search: string, token: CancellationToken): ProviderResult<IWorkspaceSymbol[]>;\n\tresolveWorkspaceSymbol?(item: IWorkspaceSymbol, token: CancellationToken): ProviderResult<IWorkspaceSymbol>;\n}\n\nexport namespace WorkspaceSymbolProviderRegistry {\n\n\tconst _supports: IWorkspaceSymbolProvider[] = [];\n\n\texport function register(provider: IWorkspaceSymbolProvider): IDisposable {\n\t\tlet support: IWorkspaceSymbolProvider | undefined = provider;\n\t\tif (support) {\n\t\t\t_supports.push(support);\n\t\t}\n\n\t\treturn {\n\t\t\tdispose() {\n\t\t\t\tif (support) {\n\t\t\t\t\tconst idx = _supports.indexOf(support);\n\t\t\t\t\tif (idx >= 0) {\n\t\t\t\t\t\t_supports.splice(idx, 1);\n\t\t\t\t\t\tsupport = undefined;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t}\n\n\texport function all(): IWorkspaceSymbolProvider[] {\n\t\treturn _supports.slice(0);\n\t}\n}\n\nexport class WorkspaceSymbolItem {\n\tconstructor(readonly symbol: IWorkspaceSymbol, readonly provider: IWorkspaceSymbolProvider) { }\n}\n\nexport async function getWorkspaceSymbols(query: string, token: CancellationToken = CancellationToken.None): Promise<WorkspaceSymbolItem[]> {\n\n\tconst all: WorkspaceSymbolItem[] = [];\n\n\tconst promises = WorkspaceSymbolProviderRegistry.all().map(async provider => {\n\t\ttry {\n\t\t\tconst value = await provider.provideWorkspaceSymbols(query, token);\n\t\t\tif (!value) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tfor (const symbol of value) {\n\t\t\t\tall.push(new WorkspaceSymbolItem(symbol, provider));\n\t\t\t}\n\t\t} catch (err) {\n\t\t\tonUnexpectedExternalError(err);\n\t\t}\n\t});\n\n\tawait Promise.all(promises);\n\n\tif (token.isCancellationRequested) {\n\t\treturn [];\n\t}\n\n\t// de-duplicate entries\n\n\tfunction compareItems(a: WorkspaceSymbolItem, b: WorkspaceSymbolItem): number {\n\t\tlet res = compare(a.symbol.name, b.symbol.name);\n\t\tif (res === 0) {\n\t\t\tres = a.symbol.kind - b.symbol.kind;\n\t\t}\n\t\tif (res === 0) {\n\t\t\tres = compare(a.symbol.location.uri.toString(), b.symbol.location.uri.toString());\n\t\t}\n\t\tif (res === 0) {\n\t\t\tif (a.symbol.location.range && b.symbol.location.range) {\n\t\t\t\tif (!Range.areIntersecting(a.symbol.location.range, b.symbol.location.range)) {\n\t\t\t\t\tres = Range.compareRangesUsingStarts(a.symbol.location.range, b.symbol.location.range);\n\t\t\t\t}\n\t\t\t} else if (a.provider.resolveWorkspaceSymbol && !b.provider.resolveWorkspaceSymbol) {\n\t\t\t\tres = -1;\n\t\t\t} else if (!a.provider.resolveWorkspaceSymbol && b.provider.resolveWorkspaceSymbol) {\n\t\t\t\tres = 1;\n\t\t\t}\n\t\t}\n\t\tif (res === 0) {\n\t\t\tres = compare(a.symbol.containerName ?? '', b.symbol.containerName ?? '');\n\t\t}\n\t\treturn res;\n\t}\n\n\treturn groupBy(all, compareItems).map(group => group[0]).flat();\n}\n\nexport interface IWorkbenchSearchConfigurationProperties extends ISearchConfigurationProperties {\n\tquickOpen: {\n\t\tincludeSymbols: boolean;\n\t\tincludeHistory: boolean;\n\t\thistory: {\n\t\t\tfilterSortOrder: 'default' | 'recency';\n\t\t};\n\t};\n}\n\nexport interface IWorkbenchSearchConfiguration extends ISearchConfiguration {\n\tsearch: IWorkbenchSearchConfigurationProperties;\n}\n\n/**\n * Helper to return all opened editors with resources not belonging to the currently opened workspace.\n */\nexport function getOutOfWorkspaceEditorResources(accessor: ServicesAccessor): URI[] {\n\tconst editorService = accessor.get(IEditorService);\n\tconst contextService = accessor.get(IWorkspaceContextService);\n\tconst fileService = accessor.get(IFileService);\n\n\tconst resources = editorService.editors\n\t\t.map(editor => EditorResourceAccessor.getOriginalUri(editor, { supportSideBySide: SideBySideEditor.PRIMARY }))\n\t\t.filter(resource => !!resource && !contextService.isInsideWorkspace(resource) && fileService.hasProvider(resource));\n\n\treturn resources as URI[];\n}\n\n// Supports patterns of <path><#|:|(><line><#|:|,><col?><:?>\nconst LINE_COLON_PATTERN = /\\s?[#:\\(](?:line )?(\\d*)(?:[#:,](\\d*))?\\)?:?\\s*$/;\n\nexport interface IFilterAndRange {\n\tfilter: string;\n\trange: IRange;\n}\n\nexport function extractRangeFromFilter(filter: string, unless?: string[]): IFilterAndRange | undefined {\n\t// Ignore when the unless character not the first character or is before the line colon pattern\n\tif (!filter || unless?.some(value => {\n\t\tconst unlessCharPos = filter.indexOf(value);\n\t\treturn unlessCharPos === 0 || unlessCharPos > 0 && !LINE_COLON_PATTERN.test(filter.substring(unlessCharPos + 1));\n\t})) {\n\t\treturn undefined;\n\t}\n\n\tlet range: IRange | undefined = undefined;\n\n\t// Find Line/Column number from search value using RegExp\n\tconst patternMatch = LINE_COLON_PATTERN.exec(filter);\n\n\tif (patternMatch) {\n\t\tconst startLineNumber = parseInt(patternMatch[1] ?? '', 10);\n\n\t\t// Line Number\n\t\tif (isNumber(startLineNumber)) {\n\t\t\trange = {\n\t\t\t\tstartLineNumber: startLineNumber,\n\t\t\t\tstartColumn: 1,\n\t\t\t\tendLineNumber: startLineNumber,\n\t\t\t\tendColumn: 1\n\t\t\t};\n\n\t\t\t// Column Number\n\t\t\tconst startColumn = parseInt(patternMatch[2] ?? '', 10);\n\t\t\tif (isNumber(startColumn)) {\n\t\t\t\trange = {\n\t\t\t\t\tstartLineNumber: range.startLineNumber,\n\t\t\t\t\tstartColumn: startColumn,\n\t\t\t\t\tendLineNumber: range.endLineNumber,\n\t\t\t\t\tendColumn: startColumn\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\n\t\t// User has typed \"something:\" or \"something#\" without a line number, in this case treat as start of file\n\t\telse if (patternMatch[1] === '') {\n\t\t\trange = {\n\t\t\t\tstartLineNumber: 1,\n\t\t\t\tstartColumn: 1,\n\t\t\t\tendLineNumber: 1,\n\t\t\t\tendColumn: 1\n\t\t\t};\n\t\t}\n\t}\n\n\tif (patternMatch && range) {\n\t\treturn {\n\t\t\tfilter: filter.substr(0, patternMatch.index), // clear range suffix from search value\n\t\t\trange\n\t\t};\n\t}\n\n\treturn undefined;\n}\n\nexport enum SearchUIState {\n\tIdle,\n\tSearching,\n\tSlowSearch\n}\n\nexport const SearchStateKey = new RawContextKey<SearchUIState>('searchState', SearchUIState.Idle);\n\nexport interface NotebookPriorityInfo {\n\tisFromSettings: boolean;\n\tfilenamePatterns: string[];\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { onUnexpectedExternalError } from '../../../../base/common/errors.js';\nimport { IDisposable } from '../../../../base/common/lifecycle.js';\nimport { ISearchConfiguration, ISearchConfigurationProperties } from '../../../services/search/common/search.js';\nimport { SymbolKind, Location, ProviderResult, SymbolTag } from '../../../../editor/common/languages.js';\nimport { IWorkspaceContextService } from '../../../../platform/workspace/common/workspace.js';\nimport { URI } from '../../../../base/common/uri.js';\nimport { EditorResourceAccessor, SideBySideEditor } from '../../../common/editor.js';\nimport { IEditorService } from '../../../services/editor/common/editorService.js';\nimport { CancellationToken } from '../../../../base/common/cancellation.js';\nimport { ServicesAccessor } from '../../../../platform/instantiation/common/instantiation.js';\nimport { IFileService } from '../../../../platform/files/common/files.js';\nimport { IRange, Range } from '../../../../editor/common/core/range.js';\nimport { isNumber } from '../../../../base/common/types.js';\nimport { RawContextKey } from '../../../../platform/contextkey/common/contextkey.js';\nimport { compare } from '../../../../base/common/strings.js';\nimport { groupBy } from '../../../../base/common/arrays.js';\n\nexport interface IWorkspaceSymbol {\n\tname: string;\n\tcontainerName?: string;\n\tkind: SymbolKind;\n\ttags?: SymbolTag[];\n\tlocation: Location;\n}\n\nexport interface IWorkspaceSymbolProvider {\n\tprovideWorkspaceSymbols(search: string, token: CancellationToken): ProviderResult<IWorkspaceSymbol[]>;\n\tresolveWorkspaceSymbol?(item: IWorkspaceSymbol, token: CancellationToken): ProviderResult<IWorkspaceSymbol>;\n}\n\nexport namespace WorkspaceSymbolProviderRegistry {\n\n\tconst _supports: IWorkspaceSymbolProvider[] = [];\n\n\texport function register(provider: IWorkspaceSymbolProvider): IDisposable {\n\t\tlet support: IWorkspaceSymbolProvider | undefined = provider;\n\t\tif (support) {\n\t\t\t_supports.push(support);\n\t\t}\n\n\t\treturn {\n\t\t\tdispose() {\n\t\t\t\tif (support) {\n\t\t\t\t\tconst idx = _supports.indexOf(support);\n\t\t\t\t\tif (idx >= 0) {\n\t\t\t\t\t\t_supports.splice(idx, 1);\n\t\t\t\t\t\tsupport = undefined;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t}\n\n\texport function all(): IWorkspaceSymbolProvider[] {\n\t\treturn _supports.slice(0);\n\t}\n}\n\nexport class WorkspaceSymbolItem {\n\tconstructor(readonly symbol: IWorkspaceSymbol, readonly provider: IWorkspaceSymbolProvider) { }\n}\n\nexport async function getWorkspaceSymbols(query: string, token: CancellationToken = CancellationToken.None): Promise<WorkspaceSymbolItem[]> {\n\n\tconst all: WorkspaceSymbolItem[] = [];\n\n\tconst promises = WorkspaceSymbolProviderRegistry.all().map(async provider => {\n\t\ttry {\n\t\t\tconst value = await provider.provideWorkspaceSymbols(query, token);\n\t\t\tif (!value) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tfor (const symbol of value) {\n\t\t\t\tall.push(new WorkspaceSymbolItem(symbol, provider));\n\t\t\t}\n\t\t} catch (err) {\n\t\t\tonUnexpectedExternalError(err);\n\t\t}\n\t});\n\n\tawait Promise.all(promises);\n\n\tif (token.isCancellationRequested) {\n\t\treturn [];\n\t}\n\n\t// de-duplicate entries\n\n\tfunction compareItems(a: WorkspaceSymbolItem, b: WorkspaceSymbolItem): number {\n\t\tlet res = compare(a.symbol.name, b.symbol.name);\n\t\tif (res === 0) {\n\t\t\tres = a.symbol.kind - b.symbol.kind;\n\t\t}\n\t\tif (res === 0) {\n\t\t\tres = compare(a.symbol.location.uri.toString(), b.symbol.location.uri.toString());\n\t\t}\n\t\tif (res === 0) {\n\t\t\tif (a.symbol.location.range && b.symbol.location.range) {\n\t\t\t\tif (!Range.areIntersecting(a.symbol.location.range, b.symbol.location.range)) {\n\t\t\t\t\tres = Range.compareRangesUsingStarts(a.symbol.location.range, b.symbol.location.range);\n\t\t\t\t}\n\t\t\t} else if (a.provider.resolveWorkspaceSymbol && !b.provider.resolveWorkspaceSymbol) {\n\t\t\t\tres = -1;\n\t\t\t} else if (!a.provider.resolveWorkspaceSymbol && b.provider.resolveWorkspaceSymbol) {\n\t\t\t\tres = 1;\n\t\t\t}\n\t\t}\n\t\tif (res === 0) {\n\t\t\tres = compare(a.symbol.containerName ?? '', b.symbol.containerName ?? '');\n\t\t}\n\t\treturn res;\n\t}\n\n\treturn groupBy(all, compareItems).map(group => group[0]).flat();\n}\n\nexport interface IWorkbenchSearchConfigurationProperties extends ISearchConfigurationProperties {\n\tquickOpen: {\n\t\tincludeSymbols: boolean;\n\t\tincludeHistory: boolean;\n\t\thistory: {\n\t\t\tfilterSortOrder: 'default' | 'recency';\n\t\t};\n\t};\n}\n\nexport interface IWorkbenchSearchConfiguration extends ISearchConfiguration {\n\tsearch: IWorkbenchSearchConfigurationProperties;\n}\n\n/**\n * Helper to return all opened editors with resources not belonging to the currently opened workspace.\n */\nexport function getOutOfWorkspaceEditorResources(accessor: ServicesAccessor): URI[] {\n\tconst editorService = accessor.get(IEditorService);\n\tconst contextService = accessor.get(IWorkspaceContextService);\n\tconst fileService = accessor.get(IFileService);\n\n\tconst resources = editorService.editors\n\t\t.map(editor => EditorResourceAccessor.getOriginalUri(editor, { supportSideBySide: SideBySideEditor.PRIMARY }))\n\t\t.filter(resource => !!resource && !contextService.isInsideWorkspace(resource) && fileService.hasProvider(resource));\n\n\treturn resources as URI[];\n}\n\n// Supports patterns of <path><#|:|(><line><#|:|,><col?><:?>\nconst LINE_COLON_PATTERN = /\\s?[#:\\(](?:line )?(\\d*)(?:[#:,](\\d*))?\\)?:?\\s*$/;\n\nexport interface IFilterAndRange {\n\tfilter: string;\n\trange: IRange;\n}\n\nexport function extractRangeFromFilter(filter: string, unless?: string[]): IFilterAndRange | undefined {\n\t// Ignore when the unless character not the first character or is before the line colon pattern\n\tif (!filter || unless?.some(value => {\n\t\tconst unlessCharPos = filter.indexOf(value);\n\t\treturn unlessCharPos === 0 || unlessCharPos > 0 && !LINE_COLON_PATTERN.test(filter.substring(unlessCharPos + 1));\n\t})) {\n\t\treturn undefined;\n\t}\n\n\tlet range: IRange | undefined = undefined;\n\n\t// Find Line/Column number from search value using RegExp\n\tconst patternMatch = LINE_COLON_PATTERN.exec(filter);\n\n\tif (patternMatch) {\n\t\tconst startLineNumber = parseInt(patternMatch[1] ?? '', 10);\n\n\t\t// Line Number\n\t\tif (isNumber(startLineNumber)) {\n\t\t\trange = {\n\t\t\t\tstartLineNumber: startLineNumber,\n\t\t\t\tstartColumn: 1,\n\t\t\t\tendLineNumber: startLineNumber,\n\t\t\t\tendColumn: 1\n\t\t\t};\n\n\t\t\t// Column Number\n\t\t\tconst startColumn = parseInt(patternMatch[2] ?? '', 10);\n\t\t\tif (isNumber(startColumn)) {\n\t\t\t\trange = {\n\t\t\t\t\tstartLineNumber: range.startLineNumber,\n\t\t\t\t\tstartColumn: startColumn,\n\t\t\t\t\tendLineNumber: range.endLineNumber,\n\t\t\t\t\tendColumn: startColumn\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\n\t\t// User has typed \"something:\" or \"something#\" without a line number, in this case treat as start of file\n\t\telse if (patternMatch[1] === '') {\n\t\t\trange = {\n\t\t\t\tstartLineNumber: 1,\n\t\t\t\tstartColumn: 1,\n\t\t\t\tendLineNumber: 1,\n\t\t\t\tendColumn: 1\n\t\t\t};\n\t\t}\n\t}\n\n\tif (patternMatch && range) {\n\t\treturn {\n\t\t\tfilter: filter.substr(0, patternMatch.index), // clear range suffix from search value\n\t\t\trange\n\t\t};\n\t}\n\n\treturn undefined;\n}\n\nexport enum SearchUIState {\n\tIdle,\n\tSearching,\n\tSlowSearch\n}\n\nexport const SearchStateKey = new RawContextKey<SearchUIState>('searchState', SearchUIState.Idle);\n\nexport interface NotebookPriorityInfo {\n\tisFromSettings: boolean;\n\tfilenamePatterns: string[];\n}\n"]}