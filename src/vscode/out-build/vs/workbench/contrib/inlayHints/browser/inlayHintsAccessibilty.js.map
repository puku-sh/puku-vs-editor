{"version":3,"sources":["vs/workbench/contrib/inlayHints/browser/inlayHintsAccessibilty.ts"],"names":[],"mappings":"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","file":"inlayHintsAccessibilty.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as dom from '../../../../base/browser/dom.js';\nimport { CancellationTokenSource } from '../../../../base/common/cancellation.js';\nimport { KeyCode } from '../../../../base/common/keyCodes.js';\nimport { DisposableStore } from '../../../../base/common/lifecycle.js';\nimport { ICodeEditor } from '../../../../editor/browser/editorBrowser.js';\nimport { EditorAction2, EditorContributionInstantiation, registerEditorContribution } from '../../../../editor/browser/editorExtensions.js';\nimport { IEditorContribution } from '../../../../editor/common/editorCommon.js';\nimport { EditorContextKeys } from '../../../../editor/common/editorContextKeys.js';\nimport { InlayHintItem, asCommandLink } from '../../../../editor/contrib/inlayHints/browser/inlayHints.js';\nimport { InlayHintsController } from '../../../../editor/contrib/inlayHints/browser/inlayHintsController.js';\nimport { localize, localize2 } from '../../../../nls.js';\nimport { registerAction2 } from '../../../../platform/actions/common/actions.js';\nimport { AccessibilitySignal, IAccessibilitySignalService } from '../../../../platform/accessibilitySignal/browser/accessibilitySignalService.js';\nimport { IContextKey, IContextKeyService, RawContextKey } from '../../../../platform/contextkey/common/contextkey.js';\nimport { IInstantiationService, ServicesAccessor } from '../../../../platform/instantiation/common/instantiation.js';\nimport { KeybindingWeight } from '../../../../platform/keybinding/common/keybindingsRegistry.js';\nimport { Link } from '../../../../platform/opener/browser/link.js';\n\n\nexport class InlayHintsAccessibility implements IEditorContribution {\n\n\tstatic readonly IsReading = new RawContextKey<boolean>('isReadingLineWithInlayHints', false, { type: 'boolean', description: localize('isReadingLineWithInlayHints', \"Whether the current line and its inlay hints are currently focused\") });\n\n\tstatic readonly ID: string = 'editor.contrib.InlayHintsAccessibility';\n\n\tstatic get(editor: ICodeEditor): InlayHintsAccessibility | undefined {\n\t\treturn editor.getContribution<InlayHintsAccessibility>(InlayHintsAccessibility.ID) ?? undefined;\n\t}\n\n\tprivate readonly _ariaElement: HTMLSpanElement;\n\tprivate readonly _ctxIsReading: IContextKey<boolean>;\n\n\tprivate readonly _sessionDispoosables = new DisposableStore();\n\n\tconstructor(\n\t\tprivate readonly _editor: ICodeEditor,\n\t\t@IContextKeyService contextKeyService: IContextKeyService,\n\t\t@IAccessibilitySignalService private readonly _accessibilitySignalService: IAccessibilitySignalService,\n\t\t@IInstantiationService private readonly _instaService: IInstantiationService,\n\t) {\n\t\tthis._ariaElement = document.createElement('span');\n\t\tthis._ariaElement.style.position = 'fixed';\n\t\tthis._ariaElement.className = 'inlayhint-accessibility-element';\n\t\tthis._ariaElement.tabIndex = 0;\n\t\tthis._ariaElement.setAttribute('aria-description', localize('description', \"Code with Inlay Hint Information\"));\n\n\t\tthis._ctxIsReading = InlayHintsAccessibility.IsReading.bindTo(contextKeyService);\n\t}\n\n\tdispose(): void {\n\t\tthis._sessionDispoosables.dispose();\n\t\tthis._ctxIsReading.reset();\n\t\tthis._ariaElement.remove();\n\t}\n\n\tprivate _reset(): void {\n\t\tdom.clearNode(this._ariaElement);\n\t\tthis._sessionDispoosables.clear();\n\t\tthis._ctxIsReading.reset();\n\t}\n\n\tprivate async _read(line: number, hints: InlayHintItem[]) {\n\n\t\tthis._sessionDispoosables.clear();\n\n\t\tif (!this._ariaElement.isConnected) {\n\t\t\tthis._editor.getDomNode()?.appendChild(this._ariaElement);\n\t\t}\n\n\t\tif (!this._editor.hasModel() || !this._ariaElement.isConnected) {\n\t\t\tthis._ctxIsReading.set(false);\n\t\t\treturn;\n\t\t}\n\n\t\tconst cts = new CancellationTokenSource();\n\t\tthis._sessionDispoosables.add(cts);\n\n\t\tfor (const hint of hints) {\n\t\t\tawait hint.resolve(cts.token);\n\t\t}\n\n\t\tif (cts.token.isCancellationRequested) {\n\t\t\treturn;\n\t\t}\n\t\tconst model = this._editor.getModel();\n\t\t// const text = this._editor.getModel().getLineContent(line);\n\t\tconst newChildren: (string | HTMLElement)[] = [];\n\n\t\tlet start = 0;\n\t\tlet tooLongToRead = false;\n\n\t\tfor (const item of hints) {\n\n\t\t\t// text\n\t\t\tconst part = model.getValueInRange({ startLineNumber: line, startColumn: start + 1, endLineNumber: line, endColumn: item.hint.position.column });\n\t\t\tif (part.length > 0) {\n\t\t\t\tnewChildren.push(part);\n\t\t\t\tstart = item.hint.position.column - 1;\n\t\t\t}\n\n\t\t\t// check length\n\t\t\tif (start > 750) {\n\t\t\t\tnewChildren.push('â€¦');\n\t\t\t\ttooLongToRead = true;\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\t// hint\n\t\t\tconst em = document.createElement('em');\n\t\t\tconst { label } = item.hint;\n\t\t\tif (typeof label === 'string') {\n\t\t\t\tem.innerText = label;\n\t\t\t} else {\n\t\t\t\tfor (const part of label) {\n\t\t\t\t\tif (part.command) {\n\t\t\t\t\t\tconst link = this._instaService.createInstance(Link, em,\n\t\t\t\t\t\t\t{ href: asCommandLink(part.command), label: part.label, title: part.command.title },\n\t\t\t\t\t\t\tundefined\n\t\t\t\t\t\t);\n\t\t\t\t\t\tthis._sessionDispoosables.add(link);\n\n\t\t\t\t\t} else {\n\t\t\t\t\t\tem.innerText += part.label;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tnewChildren.push(em);\n\t\t}\n\n\t\t// trailing text\n\t\tif (!tooLongToRead) {\n\t\t\tnewChildren.push(model.getValueInRange({ startLineNumber: line, startColumn: start + 1, endLineNumber: line, endColumn: Number.MAX_SAFE_INTEGER }));\n\t\t}\n\n\t\tdom.reset(this._ariaElement, ...newChildren);\n\t\tthis._ariaElement.focus();\n\t\tthis._ctxIsReading.set(true);\n\n\t\t// reset on blur\n\t\tthis._sessionDispoosables.add(dom.addDisposableListener(this._ariaElement, 'focusout', () => {\n\t\t\tthis._reset();\n\t\t}));\n\t}\n\n\n\n\tstartInlayHintsReading(): void {\n\t\tif (!this._editor.hasModel()) {\n\t\t\treturn;\n\t\t}\n\t\tconst line = this._editor.getPosition().lineNumber;\n\t\tconst hints = InlayHintsController.get(this._editor)?.getInlayHintsForLine(line);\n\t\tif (!hints || hints.length === 0) {\n\t\t\tthis._accessibilitySignalService.playSignal(AccessibilitySignal.noInlayHints);\n\t\t} else {\n\t\t\tthis._read(line, hints);\n\t\t}\n\t}\n\n\tstopInlayHintsReading(): void {\n\t\tthis._reset();\n\t\tthis._editor.focus();\n\t}\n}\n\n\nregisterAction2(class StartReadHints extends EditorAction2 {\n\n\tconstructor() {\n\t\tsuper({\n\t\t\tid: 'inlayHints.startReadingLineWithHint',\n\t\t\ttitle: localize2('read.title', \"Read Line with Inlay Hints\"),\n\t\t\tprecondition: EditorContextKeys.hasInlayHintsProvider,\n\t\t\tf1: true\n\t\t});\n\t}\n\n\trunEditorCommand(_accessor: ServicesAccessor, editor: ICodeEditor) {\n\t\tconst ctrl = InlayHintsAccessibility.get(editor);\n\t\tctrl?.startInlayHintsReading();\n\t}\n});\n\nregisterAction2(class StopReadHints extends EditorAction2 {\n\n\tconstructor() {\n\t\tsuper({\n\t\t\tid: 'inlayHints.stopReadingLineWithHint',\n\t\t\ttitle: localize2('stop.title', \"Stop Inlay Hints Reading\"),\n\t\t\tprecondition: InlayHintsAccessibility.IsReading,\n\t\t\tf1: true,\n\t\t\tkeybinding: {\n\t\t\t\tweight: KeybindingWeight.EditorContrib,\n\t\t\t\tprimary: KeyCode.Escape\n\t\t\t}\n\t\t});\n\t}\n\n\trunEditorCommand(_accessor: ServicesAccessor, editor: ICodeEditor) {\n\t\tconst ctrl = InlayHintsAccessibility.get(editor);\n\t\tctrl?.stopInlayHintsReading();\n\t}\n});\n\nregisterEditorContribution(InlayHintsAccessibility.ID, InlayHintsAccessibility, EditorContributionInstantiation.Lazy);\n"]}