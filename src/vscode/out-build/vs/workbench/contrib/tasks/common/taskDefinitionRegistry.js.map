{"version":3,"sources":["vs/workbench/contrib/tasks/common/taskDefinitionRegistry.ts"],"names":[],"mappings":"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","file":"taskDefinitionRegistry.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as nls from '../../../../nls.js';\nimport { IJSONSchema, IJSONSchemaMap } from '../../../../base/common/jsonSchema.js';\nimport { IStringDictionary } from '../../../../base/common/collections.js';\nimport * as Types from '../../../../base/common/types.js';\nimport * as Objects from '../../../../base/common/objects.js';\n\nimport { ExtensionsRegistry, ExtensionMessageCollector } from '../../../services/extensions/common/extensionsRegistry.js';\n\nimport * as Tasks from './tasks.js';\nimport { ExtensionIdentifier } from '../../../../platform/extensions/common/extensions.js';\nimport { ContextKeyExpr } from '../../../../platform/contextkey/common/contextkey.js';\nimport { Emitter, Event } from '../../../../base/common/event.js';\n\n\nconst taskDefinitionSchema: IJSONSchema = {\n\ttype: 'object',\n\tadditionalProperties: false,\n\tproperties: {\n\t\ttype: {\n\t\t\ttype: 'string',\n\t\t\tdescription: nls.localize('TaskDefinition.description', 'The actual task type. Please note that types starting with a \\'$\\' are reserved for internal usage.')\n\t\t},\n\t\trequired: {\n\t\t\ttype: 'array',\n\t\t\titems: {\n\t\t\t\ttype: 'string'\n\t\t\t}\n\t\t},\n\t\tproperties: {\n\t\t\ttype: 'object',\n\t\t\tdescription: nls.localize('TaskDefinition.properties', 'Additional properties of the task type'),\n\t\t\tadditionalProperties: {\n\t\t\t\t$ref: 'http://json-schema.org/draft-07/schema#'\n\t\t\t}\n\t\t},\n\t\twhen: {\n\t\t\ttype: 'string',\n\t\t\tmarkdownDescription: nls.localize('TaskDefinition.when', 'Condition which must be true to enable this type of task. Consider using `shellExecutionSupported`, `processExecutionSupported`, and `customExecutionSupported` as appropriate for this task definition. See the [API documentation](https://code.visualstudio.com/api/extension-guides/task-provider#when-clause) for more information.'),\n\t\t\tdefault: ''\n\t\t}\n\t}\n};\n\nnamespace Configuration {\n\texport interface ITaskDefinition {\n\t\ttype?: string;\n\t\trequired?: string[];\n\t\tproperties?: IJSONSchemaMap;\n\t\twhen?: string;\n\t}\n\n\texport function from(value: ITaskDefinition, extensionId: ExtensionIdentifier, messageCollector: ExtensionMessageCollector): Tasks.ITaskDefinition | undefined {\n\t\tif (!value) {\n\t\t\treturn undefined;\n\t\t}\n\t\tconst taskType = Types.isString(value.type) ? value.type : undefined;\n\t\tif (!taskType || taskType.length === 0) {\n\t\t\tmessageCollector.error(nls.localize('TaskTypeConfiguration.noType', 'The task type configuration is missing the required \\'taskType\\' property'));\n\t\t\treturn undefined;\n\t\t}\n\t\tconst required: string[] = [];\n\t\tif (Array.isArray(value.required)) {\n\t\t\tfor (const element of value.required) {\n\t\t\t\tif (Types.isString(element)) {\n\t\t\t\t\trequired.push(element);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn {\n\t\t\textensionId: extensionId.value,\n\t\t\ttaskType, required: required,\n\t\t\tproperties: value.properties ? Objects.deepClone(value.properties) : {},\n\t\t\twhen: value.when ? ContextKeyExpr.deserialize(value.when) : undefined\n\t\t};\n\t}\n}\n\n\nconst taskDefinitionsExtPoint = ExtensionsRegistry.registerExtensionPoint<Configuration.ITaskDefinition[]>({\n\textensionPoint: 'taskDefinitions',\n\tactivationEventsGenerator: function* (contributions: readonly Configuration.ITaskDefinition[]) {\n\t\tfor (const task of contributions) {\n\t\t\tif (task.type) {\n\t\t\t\tyield `onTaskType:${task.type}`;\n\t\t\t}\n\t\t}\n\t},\n\tjsonSchema: {\n\t\tdescription: nls.localize('TaskDefinitionExtPoint', 'Contributes task kinds'),\n\t\ttype: 'array',\n\t\titems: taskDefinitionSchema\n\t}\n});\n\nexport interface ITaskDefinitionRegistry {\n\tonReady(): Promise<void>;\n\n\tget(key: string): Tasks.ITaskDefinition;\n\tall(): Tasks.ITaskDefinition[];\n\tgetJsonSchema(): IJSONSchema;\n\treadonly onDefinitionsChanged: Event<void>;\n}\n\nclass TaskDefinitionRegistryImpl implements ITaskDefinitionRegistry {\n\n\tprivate taskTypes: IStringDictionary<Tasks.ITaskDefinition>;\n\tprivate readyPromise: Promise<void>;\n\tprivate _schema: IJSONSchema | undefined;\n\tprivate _onDefinitionsChanged: Emitter<void> = new Emitter();\n\tpublic onDefinitionsChanged: Event<void> = this._onDefinitionsChanged.event;\n\n\tconstructor() {\n\t\tthis.taskTypes = Object.create(null);\n\t\tthis.readyPromise = new Promise<void>((resolve, reject) => {\n\t\t\ttaskDefinitionsExtPoint.setHandler((extensions, delta) => {\n\t\t\t\tthis._schema = undefined;\n\t\t\t\ttry {\n\t\t\t\t\tfor (const extension of delta.removed) {\n\t\t\t\t\t\tconst taskTypes = extension.value;\n\t\t\t\t\t\tfor (const taskType of taskTypes) {\n\t\t\t\t\t\t\tif (this.taskTypes && taskType.type && this.taskTypes[taskType.type]) {\n\t\t\t\t\t\t\t\tdelete this.taskTypes[taskType.type];\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tfor (const extension of delta.added) {\n\t\t\t\t\t\tconst taskTypes = extension.value;\n\t\t\t\t\t\tfor (const taskType of taskTypes) {\n\t\t\t\t\t\t\tconst type = Configuration.from(taskType, extension.description.identifier, extension.collector);\n\t\t\t\t\t\t\tif (type) {\n\t\t\t\t\t\t\t\tthis.taskTypes[type.taskType] = type;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif ((delta.removed.length > 0) || (delta.added.length > 0)) {\n\t\t\t\t\t\tthis._onDefinitionsChanged.fire();\n\t\t\t\t\t}\n\t\t\t\t} catch (error) {\n\t\t\t\t}\n\t\t\t\tresolve(undefined);\n\t\t\t});\n\t\t});\n\t}\n\n\tpublic onReady(): Promise<void> {\n\t\treturn this.readyPromise;\n\t}\n\n\tpublic get(key: string): Tasks.ITaskDefinition {\n\t\treturn this.taskTypes[key];\n\t}\n\n\tpublic all(): Tasks.ITaskDefinition[] {\n\t\treturn Object.keys(this.taskTypes).map(key => this.taskTypes[key]);\n\t}\n\n\tpublic getJsonSchema(): IJSONSchema {\n\t\tif (this._schema === undefined) {\n\t\t\tconst schemas: IJSONSchema[] = [];\n\t\t\tfor (const definition of this.all()) {\n\t\t\t\tconst schema: IJSONSchema = {\n\t\t\t\t\ttype: 'object',\n\t\t\t\t\tadditionalProperties: false\n\t\t\t\t};\n\t\t\t\tif (definition.required.length > 0) {\n\t\t\t\t\tschema.required = definition.required.slice(0);\n\t\t\t\t}\n\t\t\t\tif (definition.properties !== undefined) {\n\t\t\t\t\tschema.properties = Objects.deepClone(definition.properties);\n\t\t\t\t} else {\n\t\t\t\t\tschema.properties = Object.create(null);\n\t\t\t\t}\n\t\t\t\tschema.properties!.type = {\n\t\t\t\t\ttype: 'string',\n\t\t\t\t\tenum: [definition.taskType]\n\t\t\t\t};\n\t\t\t\tschemas.push(schema);\n\t\t\t}\n\t\t\tthis._schema = { oneOf: schemas };\n\t\t}\n\t\treturn this._schema;\n\t}\n}\n\nexport const TaskDefinitionRegistry: ITaskDefinitionRegistry = new TaskDefinitionRegistryImpl();\n"]}