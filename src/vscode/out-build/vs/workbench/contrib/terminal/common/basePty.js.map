{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/contrib/terminal/common/basePty.ts","vs/workbench/contrib/terminal/common/basePty.ts"],"names":[],"mappings":"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","file":"basePty.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Emitter } from '../../../../base/common/event.js';\nimport { Disposable } from '../../../../base/common/lifecycle.js';\nimport { mark } from '../../../../base/common/performance.js';\nimport { isString } from '../../../../base/common/types.js';\nimport { URI } from '../../../../base/common/uri.js';\nimport type { IPtyHostProcessReplayEvent, ISerializedCommandDetectionCapability } from '../../../../platform/terminal/common/capabilities/capabilities.js';\nimport { ProcessPropertyType, type IProcessDataEvent, type IProcessProperty, type IProcessPropertyMap, type IProcessReadyEvent, type ITerminalChildProcess } from '../../../../platform/terminal/common/terminal.js';\n\n/**\n * Responsible for establishing and maintaining a connection with an existing terminal process\n * created on the local pty host.\n */\nexport abstract class BasePty extends Disposable implements Partial<ITerminalChildProcess> {\n\tprotected readonly _properties: IProcessPropertyMap = {\n\t\tcwd: '',\n\t\tinitialCwd: '',\n\t\tfixedDimensions: { cols: undefined, rows: undefined },\n\t\ttitle: '',\n\t\tshellType: undefined,\n\t\thasChildProcesses: true,\n\t\tresolvedShellLaunchConfig: {},\n\t\toverrideDimensions: undefined,\n\t\tfailedShellIntegrationActivation: false,\n\t\tusedShellIntegrationInjection: undefined,\n\t\tshellIntegrationInjectionFailureReason: undefined,\n\t};\n\tprotected readonly _lastDimensions: { cols: number; rows: number } = { cols: -1, rows: -1 };\n\tprotected _inReplay = false;\n\n\tprotected readonly _onProcessData = this._register(new Emitter<IProcessDataEvent | string>());\n\treadonly onProcessData = this._onProcessData.event;\n\tprotected readonly _onProcessReplayComplete = this._register(new Emitter<void>());\n\treadonly onProcessReplayComplete = this._onProcessReplayComplete.event;\n\tprotected readonly _onProcessReady = this._register(new Emitter<IProcessReadyEvent>());\n\treadonly onProcessReady = this._onProcessReady.event;\n\tprotected readonly _onDidChangeProperty = this._register(new Emitter<IProcessProperty>());\n\treadonly onDidChangeProperty = this._onDidChangeProperty.event;\n\tprotected readonly _onProcessExit = this._register(new Emitter<number | undefined>());\n\treadonly onProcessExit = this._onProcessExit.event;\n\tprotected readonly _onRestoreCommands = this._register(new Emitter<ISerializedCommandDetectionCapability>());\n\treadonly onRestoreCommands = this._onRestoreCommands.event;\n\n\tconstructor(\n\t\treadonly id: number,\n\t\treadonly shouldPersist: boolean\n\t) {\n\t\tsuper();\n\t}\n\n\tasync getInitialCwd(): Promise<string> {\n\t\treturn this._properties.initialCwd;\n\t}\n\n\tasync getCwd(): Promise<string> {\n\t\treturn this._properties.cwd || this._properties.initialCwd;\n\t}\n\n\thandleData(e: string | IProcessDataEvent) {\n\t\tthis._onProcessData.fire(e);\n\t}\n\thandleExit(e: number | undefined) {\n\t\tthis._onProcessExit.fire(e);\n\t}\n\thandleReady(e: IProcessReadyEvent) {\n\t\tthis._onProcessReady.fire(e);\n\t}\n\thandleDidChangeProperty({ type, value }: IProcessProperty) {\n\t\tswitch (type) {\n\t\t\tcase ProcessPropertyType.Cwd:\n\t\t\t\tthis._properties.cwd = value as IProcessPropertyMap[ProcessPropertyType.Cwd];\n\t\t\t\tbreak;\n\t\t\tcase ProcessPropertyType.InitialCwd:\n\t\t\t\tthis._properties.initialCwd = value as IProcessPropertyMap[ProcessPropertyType.InitialCwd];\n\t\t\t\tbreak;\n\t\t\tcase ProcessPropertyType.ResolvedShellLaunchConfig: {\n\t\t\t\tconst cast = value as IProcessPropertyMap[ProcessPropertyType.ResolvedShellLaunchConfig];\n\t\t\t\tif (cast.cwd && !isString(cast.cwd)) {\n\t\t\t\t\tcast.cwd = URI.revive(cast.cwd);\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\tthis._onDidChangeProperty.fire({ type, value });\n\t}\n\tasync handleReplay(e: IPtyHostProcessReplayEvent) {\n\t\tmark(`code/terminal/willHandleReplay/${this.id}`);\n\t\ttry {\n\t\t\tthis._inReplay = true;\n\t\t\tfor (const innerEvent of e.events) {\n\t\t\t\tif (innerEvent.cols !== 0 || innerEvent.rows !== 0) {\n\t\t\t\t\t// never override with 0x0 as that is a marker for an unknown initial size\n\t\t\t\t\tthis._onDidChangeProperty.fire({ type: ProcessPropertyType.OverrideDimensions, value: { cols: innerEvent.cols, rows: innerEvent.rows, forceExactSize: true } });\n\t\t\t\t}\n\t\t\t\tconst e: IProcessDataEvent = { data: innerEvent.data, trackCommit: true };\n\t\t\t\tthis._onProcessData.fire(e);\n\t\t\t\tawait e.writePromise;\n\t\t\t}\n\t\t} finally {\n\t\t\tthis._inReplay = false;\n\t\t}\n\n\t\tif (e.commands) {\n\t\t\tthis._onRestoreCommands.fire(e.commands);\n\t\t}\n\n\t\t// remove size override\n\t\tthis._onDidChangeProperty.fire({ type: ProcessPropertyType.OverrideDimensions, value: undefined });\n\n\t\tmark(`code/terminal/didHandleReplay/${this.id}`);\n\t\tthis._onProcessReplayComplete.fire();\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Emitter } from '../../../../base/common/event.js';\nimport { Disposable } from '../../../../base/common/lifecycle.js';\nimport { mark } from '../../../../base/common/performance.js';\nimport { isString } from '../../../../base/common/types.js';\nimport { URI } from '../../../../base/common/uri.js';\nimport type { IPtyHostProcessReplayEvent, ISerializedCommandDetectionCapability } from '../../../../platform/terminal/common/capabilities/capabilities.js';\nimport { ProcessPropertyType, type IProcessDataEvent, type IProcessProperty, type IProcessPropertyMap, type IProcessReadyEvent, type ITerminalChildProcess } from '../../../../platform/terminal/common/terminal.js';\n\n/**\n * Responsible for establishing and maintaining a connection with an existing terminal process\n * created on the local pty host.\n */\nexport abstract class BasePty extends Disposable implements Partial<ITerminalChildProcess> {\n\tprotected readonly _properties: IProcessPropertyMap = {\n\t\tcwd: '',\n\t\tinitialCwd: '',\n\t\tfixedDimensions: { cols: undefined, rows: undefined },\n\t\ttitle: '',\n\t\tshellType: undefined,\n\t\thasChildProcesses: true,\n\t\tresolvedShellLaunchConfig: {},\n\t\toverrideDimensions: undefined,\n\t\tfailedShellIntegrationActivation: false,\n\t\tusedShellIntegrationInjection: undefined,\n\t\tshellIntegrationInjectionFailureReason: undefined,\n\t};\n\tprotected readonly _lastDimensions: { cols: number; rows: number } = { cols: -1, rows: -1 };\n\tprotected _inReplay = false;\n\n\tprotected readonly _onProcessData = this._register(new Emitter<IProcessDataEvent | string>());\n\treadonly onProcessData = this._onProcessData.event;\n\tprotected readonly _onProcessReplayComplete = this._register(new Emitter<void>());\n\treadonly onProcessReplayComplete = this._onProcessReplayComplete.event;\n\tprotected readonly _onProcessReady = this._register(new Emitter<IProcessReadyEvent>());\n\treadonly onProcessReady = this._onProcessReady.event;\n\tprotected readonly _onDidChangeProperty = this._register(new Emitter<IProcessProperty>());\n\treadonly onDidChangeProperty = this._onDidChangeProperty.event;\n\tprotected readonly _onProcessExit = this._register(new Emitter<number | undefined>());\n\treadonly onProcessExit = this._onProcessExit.event;\n\tprotected readonly _onRestoreCommands = this._register(new Emitter<ISerializedCommandDetectionCapability>());\n\treadonly onRestoreCommands = this._onRestoreCommands.event;\n\n\tconstructor(\n\t\treadonly id: number,\n\t\treadonly shouldPersist: boolean\n\t) {\n\t\tsuper();\n\t}\n\n\tasync getInitialCwd(): Promise<string> {\n\t\treturn this._properties.initialCwd;\n\t}\n\n\tasync getCwd(): Promise<string> {\n\t\treturn this._properties.cwd || this._properties.initialCwd;\n\t}\n\n\thandleData(e: string | IProcessDataEvent) {\n\t\tthis._onProcessData.fire(e);\n\t}\n\thandleExit(e: number | undefined) {\n\t\tthis._onProcessExit.fire(e);\n\t}\n\thandleReady(e: IProcessReadyEvent) {\n\t\tthis._onProcessReady.fire(e);\n\t}\n\thandleDidChangeProperty({ type, value }: IProcessProperty) {\n\t\tswitch (type) {\n\t\t\tcase ProcessPropertyType.Cwd:\n\t\t\t\tthis._properties.cwd = value as IProcessPropertyMap[ProcessPropertyType.Cwd];\n\t\t\t\tbreak;\n\t\t\tcase ProcessPropertyType.InitialCwd:\n\t\t\t\tthis._properties.initialCwd = value as IProcessPropertyMap[ProcessPropertyType.InitialCwd];\n\t\t\t\tbreak;\n\t\t\tcase ProcessPropertyType.ResolvedShellLaunchConfig: {\n\t\t\t\tconst cast = value as IProcessPropertyMap[ProcessPropertyType.ResolvedShellLaunchConfig];\n\t\t\t\tif (cast.cwd && !isString(cast.cwd)) {\n\t\t\t\t\tcast.cwd = URI.revive(cast.cwd);\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\tthis._onDidChangeProperty.fire({ type, value });\n\t}\n\tasync handleReplay(e: IPtyHostProcessReplayEvent) {\n\t\tmark(`code/terminal/willHandleReplay/${this.id}`);\n\t\ttry {\n\t\t\tthis._inReplay = true;\n\t\t\tfor (const innerEvent of e.events) {\n\t\t\t\tif (innerEvent.cols !== 0 || innerEvent.rows !== 0) {\n\t\t\t\t\t// never override with 0x0 as that is a marker for an unknown initial size\n\t\t\t\t\tthis._onDidChangeProperty.fire({ type: ProcessPropertyType.OverrideDimensions, value: { cols: innerEvent.cols, rows: innerEvent.rows, forceExactSize: true } });\n\t\t\t\t}\n\t\t\t\tconst e: IProcessDataEvent = { data: innerEvent.data, trackCommit: true };\n\t\t\t\tthis._onProcessData.fire(e);\n\t\t\t\tawait e.writePromise;\n\t\t\t}\n\t\t} finally {\n\t\t\tthis._inReplay = false;\n\t\t}\n\n\t\tif (e.commands) {\n\t\t\tthis._onRestoreCommands.fire(e.commands);\n\t\t}\n\n\t\t// remove size override\n\t\tthis._onDidChangeProperty.fire({ type: ProcessPropertyType.OverrideDimensions, value: undefined });\n\n\t\tmark(`code/terminal/didHandleReplay/${this.id}`);\n\t\tthis._onProcessReplayComplete.fire();\n\t}\n}\n"]}