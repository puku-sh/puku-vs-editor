{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/contrib/terminal/common/environmentVariableService.ts","vs/workbench/contrib/terminal/common/environmentVariableService.ts"],"names":[],"mappings":"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","file":"environmentVariableService.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Event, Emitter } from '../../../../base/common/event.js';\nimport { debounce, throttle } from '../../../../base/common/decorators.js';\nimport { IStorageService, StorageScope, StorageTarget } from '../../../../platform/storage/common/storage.js';\nimport { IExtensionService } from '../../../services/extensions/common/extensions.js';\nimport { MergedEnvironmentVariableCollection } from '../../../../platform/terminal/common/environmentVariableCollection.js';\nimport { deserializeEnvironmentDescriptionMap, deserializeEnvironmentVariableCollection, serializeEnvironmentDescriptionMap, serializeEnvironmentVariableCollection } from '../../../../platform/terminal/common/environmentVariableShared.js';\nimport { IEnvironmentVariableCollectionWithPersistence, IEnvironmentVariableService } from './environmentVariable.js';\nimport { TerminalStorageKeys } from './terminalStorageKeys.js';\nimport { IMergedEnvironmentVariableCollection, ISerializableEnvironmentDescriptionMap, ISerializableEnvironmentVariableCollection } from '../../../../platform/terminal/common/environmentVariable.js';\nimport { Disposable } from '../../../../base/common/lifecycle.js';\n\ninterface ISerializableExtensionEnvironmentVariableCollection {\n\textensionIdentifier: string;\n\tcollection: ISerializableEnvironmentVariableCollection;\n\tdescription?: ISerializableEnvironmentDescriptionMap;\n}\n\n/**\n * Tracks and persists environment variable collections as defined by extensions.\n */\nexport class EnvironmentVariableService extends Disposable implements IEnvironmentVariableService {\n\tdeclare readonly _serviceBrand: undefined;\n\n\tcollections: Map<string, IEnvironmentVariableCollectionWithPersistence> = new Map();\n\tmergedCollection: IMergedEnvironmentVariableCollection;\n\n\tprivate readonly _onDidChangeCollections = this._register(new Emitter<IMergedEnvironmentVariableCollection>());\n\tget onDidChangeCollections(): Event<IMergedEnvironmentVariableCollection> { return this._onDidChangeCollections.event; }\n\n\tconstructor(\n\t\t@IExtensionService private readonly _extensionService: IExtensionService,\n\t\t@IStorageService private readonly _storageService: IStorageService\n\t) {\n\t\tsuper();\n\n\t\tthis._storageService.remove(TerminalStorageKeys.DeprecatedEnvironmentVariableCollections, StorageScope.WORKSPACE);\n\t\tconst serializedPersistedCollections = this._storageService.get(TerminalStorageKeys.EnvironmentVariableCollections, StorageScope.WORKSPACE);\n\t\tif (serializedPersistedCollections) {\n\t\t\tconst collectionsJson: ISerializableExtensionEnvironmentVariableCollection[] = JSON.parse(serializedPersistedCollections);\n\t\t\tcollectionsJson.forEach(c => this.collections.set(c.extensionIdentifier, {\n\t\t\t\tpersistent: true,\n\t\t\t\tmap: deserializeEnvironmentVariableCollection(c.collection),\n\t\t\t\tdescriptionMap: deserializeEnvironmentDescriptionMap(c.description)\n\t\t\t}));\n\n\t\t\t// Asynchronously invalidate collections where extensions have been uninstalled, this is\n\t\t\t// async to avoid making all functions on the service synchronous and because extensions\n\t\t\t// being uninstalled is rare.\n\t\t\tthis._invalidateExtensionCollections();\n\t\t}\n\t\tthis.mergedCollection = this._resolveMergedCollection();\n\n\t\t// Listen for uninstalled/disabled extensions\n\t\tthis._register(this._extensionService.onDidChangeExtensions(() => this._invalidateExtensionCollections()));\n\t}\n\n\tset(extensionIdentifier: string, collection: IEnvironmentVariableCollectionWithPersistence): void {\n\t\tthis.collections.set(extensionIdentifier, collection);\n\t\tthis._updateCollections();\n\t}\n\n\tdelete(extensionIdentifier: string): void {\n\t\tthis.collections.delete(extensionIdentifier);\n\t\tthis._updateCollections();\n\t}\n\n\tprivate _updateCollections(): void {\n\t\tthis._persistCollectionsEventually();\n\t\tthis.mergedCollection = this._resolveMergedCollection();\n\t\tthis._notifyCollectionUpdatesEventually();\n\t}\n\n\t@throttle(1000)\n\tprivate _persistCollectionsEventually(): void {\n\t\tthis._persistCollections();\n\t}\n\n\tprotected _persistCollections(): void {\n\t\tconst collectionsJson: ISerializableExtensionEnvironmentVariableCollection[] = [];\n\t\tthis.collections.forEach((collection, extensionIdentifier) => {\n\t\t\tif (collection.persistent) {\n\t\t\t\tcollectionsJson.push({\n\t\t\t\t\textensionIdentifier,\n\t\t\t\t\tcollection: serializeEnvironmentVariableCollection(this.collections.get(extensionIdentifier)!.map),\n\t\t\t\t\tdescription: serializeEnvironmentDescriptionMap(collection.descriptionMap)\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t\tconst stringifiedJson = JSON.stringify(collectionsJson);\n\t\tthis._storageService.store(TerminalStorageKeys.EnvironmentVariableCollections, stringifiedJson, StorageScope.WORKSPACE, StorageTarget.MACHINE);\n\t}\n\n\t@debounce(1000)\n\tprivate _notifyCollectionUpdatesEventually(): void {\n\t\tthis._notifyCollectionUpdates();\n\t}\n\n\tprotected _notifyCollectionUpdates(): void {\n\t\tthis._onDidChangeCollections.fire(this.mergedCollection);\n\t}\n\n\tprivate _resolveMergedCollection(): IMergedEnvironmentVariableCollection {\n\t\treturn new MergedEnvironmentVariableCollection(this.collections);\n\t}\n\n\tprivate async _invalidateExtensionCollections(): Promise<void> {\n\t\tawait this._extensionService.whenInstalledExtensionsRegistered();\n\t\tconst registeredExtensions = this._extensionService.extensions;\n\t\tlet changes = false;\n\t\tthis.collections.forEach((_, extensionIdentifier) => {\n\t\t\tconst isExtensionRegistered = registeredExtensions.some(r => r.identifier.value === extensionIdentifier);\n\t\t\tif (!isExtensionRegistered) {\n\t\t\t\tthis.collections.delete(extensionIdentifier);\n\t\t\t\tchanges = true;\n\t\t\t}\n\t\t});\n\t\tif (changes) {\n\t\t\tthis._updateCollections();\n\t\t}\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Event, Emitter } from '../../../../base/common/event.js';\nimport { debounce, throttle } from '../../../../base/common/decorators.js';\nimport { IStorageService, StorageScope, StorageTarget } from '../../../../platform/storage/common/storage.js';\nimport { IExtensionService } from '../../../services/extensions/common/extensions.js';\nimport { MergedEnvironmentVariableCollection } from '../../../../platform/terminal/common/environmentVariableCollection.js';\nimport { deserializeEnvironmentDescriptionMap, deserializeEnvironmentVariableCollection, serializeEnvironmentDescriptionMap, serializeEnvironmentVariableCollection } from '../../../../platform/terminal/common/environmentVariableShared.js';\nimport { IEnvironmentVariableCollectionWithPersistence, IEnvironmentVariableService } from './environmentVariable.js';\nimport { TerminalStorageKeys } from './terminalStorageKeys.js';\nimport { IMergedEnvironmentVariableCollection, ISerializableEnvironmentDescriptionMap, ISerializableEnvironmentVariableCollection } from '../../../../platform/terminal/common/environmentVariable.js';\nimport { Disposable } from '../../../../base/common/lifecycle.js';\n\ninterface ISerializableExtensionEnvironmentVariableCollection {\n\textensionIdentifier: string;\n\tcollection: ISerializableEnvironmentVariableCollection;\n\tdescription?: ISerializableEnvironmentDescriptionMap;\n}\n\n/**\n * Tracks and persists environment variable collections as defined by extensions.\n */\nexport class EnvironmentVariableService extends Disposable implements IEnvironmentVariableService {\n\tdeclare readonly _serviceBrand: undefined;\n\n\tcollections: Map<string, IEnvironmentVariableCollectionWithPersistence> = new Map();\n\tmergedCollection: IMergedEnvironmentVariableCollection;\n\n\tprivate readonly _onDidChangeCollections = this._register(new Emitter<IMergedEnvironmentVariableCollection>());\n\tget onDidChangeCollections(): Event<IMergedEnvironmentVariableCollection> { return this._onDidChangeCollections.event; }\n\n\tconstructor(\n\t\t@IExtensionService private readonly _extensionService: IExtensionService,\n\t\t@IStorageService private readonly _storageService: IStorageService\n\t) {\n\t\tsuper();\n\n\t\tthis._storageService.remove(TerminalStorageKeys.DeprecatedEnvironmentVariableCollections, StorageScope.WORKSPACE);\n\t\tconst serializedPersistedCollections = this._storageService.get(TerminalStorageKeys.EnvironmentVariableCollections, StorageScope.WORKSPACE);\n\t\tif (serializedPersistedCollections) {\n\t\t\tconst collectionsJson: ISerializableExtensionEnvironmentVariableCollection[] = JSON.parse(serializedPersistedCollections);\n\t\t\tcollectionsJson.forEach(c => this.collections.set(c.extensionIdentifier, {\n\t\t\t\tpersistent: true,\n\t\t\t\tmap: deserializeEnvironmentVariableCollection(c.collection),\n\t\t\t\tdescriptionMap: deserializeEnvironmentDescriptionMap(c.description)\n\t\t\t}));\n\n\t\t\t// Asynchronously invalidate collections where extensions have been uninstalled, this is\n\t\t\t// async to avoid making all functions on the service synchronous and because extensions\n\t\t\t// being uninstalled is rare.\n\t\t\tthis._invalidateExtensionCollections();\n\t\t}\n\t\tthis.mergedCollection = this._resolveMergedCollection();\n\n\t\t// Listen for uninstalled/disabled extensions\n\t\tthis._register(this._extensionService.onDidChangeExtensions(() => this._invalidateExtensionCollections()));\n\t}\n\n\tset(extensionIdentifier: string, collection: IEnvironmentVariableCollectionWithPersistence): void {\n\t\tthis.collections.set(extensionIdentifier, collection);\n\t\tthis._updateCollections();\n\t}\n\n\tdelete(extensionIdentifier: string): void {\n\t\tthis.collections.delete(extensionIdentifier);\n\t\tthis._updateCollections();\n\t}\n\n\tprivate _updateCollections(): void {\n\t\tthis._persistCollectionsEventually();\n\t\tthis.mergedCollection = this._resolveMergedCollection();\n\t\tthis._notifyCollectionUpdatesEventually();\n\t}\n\n\t@throttle(1000)\n\tprivate _persistCollectionsEventually(): void {\n\t\tthis._persistCollections();\n\t}\n\n\tprotected _persistCollections(): void {\n\t\tconst collectionsJson: ISerializableExtensionEnvironmentVariableCollection[] = [];\n\t\tthis.collections.forEach((collection, extensionIdentifier) => {\n\t\t\tif (collection.persistent) {\n\t\t\t\tcollectionsJson.push({\n\t\t\t\t\textensionIdentifier,\n\t\t\t\t\tcollection: serializeEnvironmentVariableCollection(this.collections.get(extensionIdentifier)!.map),\n\t\t\t\t\tdescription: serializeEnvironmentDescriptionMap(collection.descriptionMap)\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t\tconst stringifiedJson = JSON.stringify(collectionsJson);\n\t\tthis._storageService.store(TerminalStorageKeys.EnvironmentVariableCollections, stringifiedJson, StorageScope.WORKSPACE, StorageTarget.MACHINE);\n\t}\n\n\t@debounce(1000)\n\tprivate _notifyCollectionUpdatesEventually(): void {\n\t\tthis._notifyCollectionUpdates();\n\t}\n\n\tprotected _notifyCollectionUpdates(): void {\n\t\tthis._onDidChangeCollections.fire(this.mergedCollection);\n\t}\n\n\tprivate _resolveMergedCollection(): IMergedEnvironmentVariableCollection {\n\t\treturn new MergedEnvironmentVariableCollection(this.collections);\n\t}\n\n\tprivate async _invalidateExtensionCollections(): Promise<void> {\n\t\tawait this._extensionService.whenInstalledExtensionsRegistered();\n\t\tconst registeredExtensions = this._extensionService.extensions;\n\t\tlet changes = false;\n\t\tthis.collections.forEach((_, extensionIdentifier) => {\n\t\t\tconst isExtensionRegistered = registeredExtensions.some(r => r.identifier.value === extensionIdentifier);\n\t\t\tif (!isExtensionRegistered) {\n\t\t\t\tthis.collections.delete(extensionIdentifier);\n\t\t\t\tchanges = true;\n\t\t\t}\n\t\t});\n\t\tif (changes) {\n\t\t\tthis._updateCollections();\n\t\t}\n\t}\n}\n"]}