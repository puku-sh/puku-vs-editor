{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/contrib/terminal/electron-browser/terminalNativeContribution.ts","vs/workbench/contrib/terminal/electron-browser/terminalNativeContribution.ts"],"names":[],"mappings":"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","file":"terminalNativeContribution.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { ipcRenderer } from '../../../../base/parts/sandbox/electron-browser/globals.js';\nimport { INativeOpenFileRequest } from '../../../../platform/window/common/window.js';\nimport { URI } from '../../../../base/common/uri.js';\nimport { IFileService } from '../../../../platform/files/common/files.js';\nimport { registerRemoteContributions } from './terminalRemote.js';\nimport { IRemoteAgentService } from '../../../services/remote/common/remoteAgentService.js';\nimport { INativeHostService } from '../../../../platform/native/common/native.js';\nimport { Disposable } from '../../../../base/common/lifecycle.js';\nimport { ITerminalService } from '../browser/terminal.js';\nimport { IWorkbenchContribution } from '../../../common/contributions.js';\nimport { disposableWindowInterval, getActiveWindow } from '../../../../base/browser/dom.js';\n\nexport class TerminalNativeContribution extends Disposable implements IWorkbenchContribution {\n\tdeclare _serviceBrand: undefined;\n\n\tconstructor(\n\t\t@IFileService private readonly _fileService: IFileService,\n\t\t@ITerminalService private readonly _terminalService: ITerminalService,\n\t\t@IRemoteAgentService remoteAgentService: IRemoteAgentService,\n\t\t@INativeHostService nativeHostService: INativeHostService\n\t) {\n\t\tsuper();\n\n\t\tipcRenderer.on('vscode:openFiles', (_: unknown, ...args: unknown[]) => { this._onOpenFileRequest(args[0] as INativeOpenFileRequest); });\n\t\tthis._register(nativeHostService.onDidResumeOS(() => this._onOsResume()));\n\n\t\tthis._terminalService.setNativeDelegate({\n\t\t\tgetWindowCount: () => nativeHostService.getWindowCount()\n\t\t});\n\n\t\tconst connection = remoteAgentService.getConnection();\n\t\tif (connection && connection.remoteAuthority) {\n\t\t\tregisterRemoteContributions();\n\t\t}\n\t}\n\n\tprivate _onOsResume(): void {\n\t\tfor (const instance of this._terminalService.instances) {\n\t\t\tinstance.xterm?.forceRedraw();\n\t\t}\n\t}\n\n\tprivate async _onOpenFileRequest(request: INativeOpenFileRequest): Promise<void> {\n\t\t// if the request to open files is coming in from the integrated terminal (identified though\n\t\t// the termProgram variable) and we are instructed to wait for editors close, wait for the\n\t\t// marker file to get deleted and then focus back to the integrated terminal.\n\t\tif (request.termProgram === 'vscode' && request.filesToWait) {\n\t\t\tconst waitMarkerFileUri = URI.revive(request.filesToWait.waitMarkerFileUri);\n\t\t\tawait this._whenFileDeleted(waitMarkerFileUri);\n\n\t\t\t// Focus active terminal\n\t\t\tthis._terminalService.activeInstance?.focus();\n\t\t}\n\t}\n\n\tprivate _whenFileDeleted(path: URI): Promise<void> {\n\t\t// Complete when wait marker file is deleted\n\t\treturn new Promise<void>(resolve => {\n\t\t\tlet running = false;\n\t\t\tconst interval = disposableWindowInterval(getActiveWindow(), async () => {\n\t\t\t\tif (!running) {\n\t\t\t\t\trunning = true;\n\t\t\t\t\tconst exists = await this._fileService.exists(path);\n\t\t\t\t\trunning = false;\n\n\t\t\t\t\tif (!exists) {\n\t\t\t\t\t\tinterval.dispose();\n\t\t\t\t\t\tresolve(undefined);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}, 1000);\n\t\t});\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { ipcRenderer } from '../../../../base/parts/sandbox/electron-browser/globals.js';\nimport { INativeOpenFileRequest } from '../../../../platform/window/common/window.js';\nimport { URI } from '../../../../base/common/uri.js';\nimport { IFileService } from '../../../../platform/files/common/files.js';\nimport { registerRemoteContributions } from './terminalRemote.js';\nimport { IRemoteAgentService } from '../../../services/remote/common/remoteAgentService.js';\nimport { INativeHostService } from '../../../../platform/native/common/native.js';\nimport { Disposable } from '../../../../base/common/lifecycle.js';\nimport { ITerminalService } from '../browser/terminal.js';\nimport { IWorkbenchContribution } from '../../../common/contributions.js';\nimport { disposableWindowInterval, getActiveWindow } from '../../../../base/browser/dom.js';\n\nexport class TerminalNativeContribution extends Disposable implements IWorkbenchContribution {\n\tdeclare _serviceBrand: undefined;\n\n\tconstructor(\n\t\t@IFileService private readonly _fileService: IFileService,\n\t\t@ITerminalService private readonly _terminalService: ITerminalService,\n\t\t@IRemoteAgentService remoteAgentService: IRemoteAgentService,\n\t\t@INativeHostService nativeHostService: INativeHostService\n\t) {\n\t\tsuper();\n\n\t\tipcRenderer.on('vscode:openFiles', (_: unknown, ...args: unknown[]) => { this._onOpenFileRequest(args[0] as INativeOpenFileRequest); });\n\t\tthis._register(nativeHostService.onDidResumeOS(() => this._onOsResume()));\n\n\t\tthis._terminalService.setNativeDelegate({\n\t\t\tgetWindowCount: () => nativeHostService.getWindowCount()\n\t\t});\n\n\t\tconst connection = remoteAgentService.getConnection();\n\t\tif (connection && connection.remoteAuthority) {\n\t\t\tregisterRemoteContributions();\n\t\t}\n\t}\n\n\tprivate _onOsResume(): void {\n\t\tfor (const instance of this._terminalService.instances) {\n\t\t\tinstance.xterm?.forceRedraw();\n\t\t}\n\t}\n\n\tprivate async _onOpenFileRequest(request: INativeOpenFileRequest): Promise<void> {\n\t\t// if the request to open files is coming in from the integrated terminal (identified though\n\t\t// the termProgram variable) and we are instructed to wait for editors close, wait for the\n\t\t// marker file to get deleted and then focus back to the integrated terminal.\n\t\tif (request.termProgram === 'vscode' && request.filesToWait) {\n\t\t\tconst waitMarkerFileUri = URI.revive(request.filesToWait.waitMarkerFileUri);\n\t\t\tawait this._whenFileDeleted(waitMarkerFileUri);\n\n\t\t\t// Focus active terminal\n\t\t\tthis._terminalService.activeInstance?.focus();\n\t\t}\n\t}\n\n\tprivate _whenFileDeleted(path: URI): Promise<void> {\n\t\t// Complete when wait marker file is deleted\n\t\treturn new Promise<void>(resolve => {\n\t\t\tlet running = false;\n\t\t\tconst interval = disposableWindowInterval(getActiveWindow(), async () => {\n\t\t\t\tif (!running) {\n\t\t\t\t\trunning = true;\n\t\t\t\t\tconst exists = await this._fileService.exists(path);\n\t\t\t\t\trunning = false;\n\n\t\t\t\t\tif (!exists) {\n\t\t\t\t\t\tinterval.dispose();\n\t\t\t\t\t\tresolve(undefined);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}, 1000);\n\t\t});\n\t}\n}\n"]}