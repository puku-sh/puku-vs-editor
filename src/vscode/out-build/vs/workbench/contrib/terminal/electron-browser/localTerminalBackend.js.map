{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/contrib/terminal/electron-browser/localTerminalBackend.ts","vs/workbench/contrib/terminal/electron-browser/localTerminalBackend.ts"],"names":[],"mappings":"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","file":"localTerminalBackend.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Emitter } from '../../../../base/common/event.js';\nimport { IProcessEnvironment, isMacintosh, isWindows, OperatingSystem } from '../../../../base/common/platform.js';\nimport { URI } from '../../../../base/common/uri.js';\nimport { IConfigurationService } from '../../../../platform/configuration/common/configuration.js';\nimport { IInstantiationService } from '../../../../platform/instantiation/common/instantiation.js';\nimport { ILabelService } from '../../../../platform/label/common/label.js';\nimport { Registry } from '../../../../platform/registry/common/platform.js';\nimport { IStorageService, StorageScope, StorageTarget } from '../../../../platform/storage/common/storage.js';\nimport { ILocalPtyService, IProcessPropertyMap, IPtyHostLatencyMeasurement, IPtyService, IShellLaunchConfig, ITerminalBackend, ITerminalBackendRegistry, ITerminalChildProcess, ITerminalEnvironment, ITerminalLogService, ITerminalProcessOptions, ITerminalsLayoutInfo, ITerminalsLayoutInfoById, ProcessPropertyType, TerminalExtensions, TerminalIpcChannels, TerminalSettingId, TitleEventSource } from '../../../../platform/terminal/common/terminal.js';\nimport { IGetTerminalLayoutInfoArgs, IProcessDetails, ISetTerminalLayoutInfoArgs } from '../../../../platform/terminal/common/terminalProcess.js';\nimport { IWorkspaceContextService } from '../../../../platform/workspace/common/workspace.js';\nimport { IWorkbenchContribution } from '../../../common/contributions.js';\nimport { ITerminalInstanceService } from '../browser/terminal.js';\nimport { ITerminalProfileResolverService } from '../common/terminal.js';\nimport { TerminalStorageKeys } from '../common/terminalStorageKeys.js';\nimport { LocalPty } from './localPty.js';\nimport { IConfigurationResolverService } from '../../../services/configurationResolver/common/configurationResolver.js';\nimport { IShellEnvironmentService } from '../../../services/environment/electron-browser/shellEnvironmentService.js';\nimport { IHistoryService } from '../../../services/history/common/history.js';\nimport * as terminalEnvironment from '../common/terminalEnvironment.js';\nimport { IProductService } from '../../../../platform/product/common/productService.js';\nimport { IEnvironmentVariableService } from '../common/environmentVariable.js';\nimport { BaseTerminalBackend } from '../browser/baseTerminalBackend.js';\nimport { INativeHostService } from '../../../../platform/native/common/native.js';\nimport { Client as MessagePortClient } from '../../../../base/parts/ipc/common/ipc.mp.js';\nimport { acquirePort } from '../../../../base/parts/ipc/electron-browser/ipc.mp.js';\nimport { getDelayedChannel, ProxyChannel } from '../../../../base/parts/ipc/common/ipc.js';\nimport { mark, PerformanceMark } from '../../../../base/common/performance.js';\nimport { ILifecycleService, LifecyclePhase } from '../../../services/lifecycle/common/lifecycle.js';\nimport { DeferredPromise } from '../../../../base/common/async.js';\nimport { IStatusbarService } from '../../../services/statusbar/browser/statusbar.js';\nimport { memoize } from '../../../../base/common/decorators.js';\nimport { StopWatch } from '../../../../base/common/stopwatch.js';\nimport { IRemoteAgentService } from '../../../services/remote/common/remoteAgentService.js';\nimport { shouldUseEnvironmentVariableCollection } from '../../../../platform/terminal/common/terminalEnvironment.js';\nimport { DisposableStore, MutableDisposable } from '../../../../base/common/lifecycle.js';\n\nexport class LocalTerminalBackendContribution implements IWorkbenchContribution {\n\n\tstatic readonly ID = 'workbench.contrib.localTerminalBackend';\n\n\tconstructor(\n\t\t@IInstantiationService instantiationService: IInstantiationService,\n\t\t@ITerminalInstanceService terminalInstanceService: ITerminalInstanceService\n\t) {\n\t\tconst backend = instantiationService.createInstance(LocalTerminalBackend);\n\t\tRegistry.as<ITerminalBackendRegistry>(TerminalExtensions.Backend).registerTerminalBackend(backend);\n\t\tterminalInstanceService.didRegisterBackend(backend);\n\t}\n}\n\nclass LocalTerminalBackend extends BaseTerminalBackend implements ITerminalBackend {\n\treadonly remoteAuthority = undefined;\n\n\tprivate readonly _ptys: Map<number, LocalPty> = new Map();\n\n\tprivate _directProxyClientEventually: DeferredPromise<MessagePortClient> | undefined;\n\tprivate _directProxy: IPtyService | undefined;\n\tprivate readonly _directProxyDisposables = this._register(new MutableDisposable());\n\n\t/**\n\t * Communicate to the direct proxy (renderer<->ptyhost) if it's available, otherwise use the\n\t * indirect proxy (renderer<->main<->ptyhost). The latter may not need to actually launch the\n\t * pty host, for example when detecting profiles.\n\t */\n\tprivate get _proxy(): IPtyService { return this._directProxy || this._localPtyService; }\n\n\tprivate readonly _whenReady = new DeferredPromise<void>();\n\tget whenReady(): Promise<void> { return this._whenReady.p; }\n\tsetReady(): void { this._whenReady.complete(); }\n\n\tprivate readonly _onDidRequestDetach = this._register(new Emitter<{ requestId: number; workspaceId: string; instanceId: number }>());\n\treadonly onDidRequestDetach = this._onDidRequestDetach.event;\n\n\tconstructor(\n\t\t@IWorkspaceContextService workspaceContextService: IWorkspaceContextService,\n\t\t@ILifecycleService private readonly _lifecycleService: ILifecycleService,\n\t\t@ITerminalLogService logService: ITerminalLogService,\n\t\t@ILocalPtyService private readonly _localPtyService: ILocalPtyService,\n\t\t@ILabelService private readonly _labelService: ILabelService,\n\t\t@IShellEnvironmentService private readonly _shellEnvironmentService: IShellEnvironmentService,\n\t\t@IStorageService private readonly _storageService: IStorageService,\n\t\t@IConfigurationResolverService private readonly _configurationResolverService: IConfigurationResolverService,\n\t\t@IConfigurationService private readonly _configurationService: IConfigurationService,\n\t\t@IProductService private readonly _productService: IProductService,\n\t\t@IHistoryService private readonly _historyService: IHistoryService,\n\t\t@ITerminalProfileResolverService private readonly _terminalProfileResolverService: ITerminalProfileResolverService,\n\t\t@IEnvironmentVariableService private readonly _environmentVariableService: IEnvironmentVariableService,\n\t\t@IHistoryService historyService: IHistoryService,\n\t\t@INativeHostService private readonly _nativeHostService: INativeHostService,\n\t\t@IStatusbarService statusBarService: IStatusbarService,\n\t\t@IRemoteAgentService private readonly _remoteAgentService: IRemoteAgentService,\n\t) {\n\t\tsuper(_localPtyService, logService, historyService, _configurationResolverService, statusBarService, workspaceContextService);\n\n\t\tthis._register(this.onPtyHostRestart(() => {\n\t\t\tthis._directProxy = undefined;\n\t\t\tthis._directProxyClientEventually = undefined;\n\t\t\tthis._connectToDirectProxy();\n\t\t}));\n\t}\n\n\t/**\n\t * Request a direct connection to the pty host, this will launch the pty host process if necessary.\n\t */\n\tprivate async _connectToDirectProxy(): Promise<void> {\n\t\t// Check if connecting is in progress\n\t\tif (this._directProxyClientEventually) {\n\t\t\tawait this._directProxyClientEventually.p;\n\t\t\treturn;\n\t\t}\n\n\t\tthis._logService.debug('Starting pty host');\n\t\tconst directProxyClientEventually = new DeferredPromise<MessagePortClient>();\n\t\tthis._directProxyClientEventually = directProxyClientEventually;\n\t\tconst directProxy = ProxyChannel.toService<IPtyService>(getDelayedChannel(this._directProxyClientEventually.p.then(client => client.getChannel(TerminalIpcChannels.PtyHostWindow))));\n\t\tthis._directProxy = directProxy;\n\t\tthis._directProxyDisposables.clear();\n\n\t\t// The pty host should not get launched until at least the window restored phase\n\t\t// if remote auth exists, don't await\n\t\tif (!this._remoteAgentService.getConnection()?.remoteAuthority) {\n\t\t\tawait this._lifecycleService.when(LifecyclePhase.Restored);\n\t\t}\n\n\t\tmark('code/terminal/willConnectPtyHost');\n\t\tthis._logService.trace('Renderer->PtyHost#connect: before acquirePort');\n\t\tacquirePort('vscode:createPtyHostMessageChannel', 'vscode:createPtyHostMessageChannelResult').then(port => {\n\t\t\tmark('code/terminal/didConnectPtyHost');\n\t\t\tthis._logService.trace('Renderer->PtyHost#connect: connection established');\n\n\t\t\tconst store = new DisposableStore();\n\t\t\tthis._directProxyDisposables.value = store;\n\n\t\t\t// There are two connections to the pty host; one to the regular shared process\n\t\t\t// _localPtyService, and one directly via message port _ptyHostDirectProxy. The former is\n\t\t\t// used for pty host management messages, it would make sense in the future to use a\n\t\t\t// separate interface/service for this one.\n\t\t\tconst client = store.add(new MessagePortClient(port, `window:${this._nativeHostService.windowId}`));\n\t\t\tdirectProxyClientEventually.complete(client);\n\t\t\tthis._onPtyHostConnected.fire();\n\n\t\t\t// Attach process listeners\n\t\t\tstore.add(directProxy.onProcessData(e => this._ptys.get(e.id)?.handleData(e.event)));\n\t\t\tstore.add(directProxy.onDidChangeProperty(e => this._ptys.get(e.id)?.handleDidChangeProperty(e.property)));\n\t\t\tstore.add(directProxy.onProcessExit(e => {\n\t\t\t\tconst pty = this._ptys.get(e.id);\n\t\t\t\tif (pty) {\n\t\t\t\t\tpty.handleExit(e.event);\n\t\t\t\t\tpty.dispose();\n\t\t\t\t\tthis._ptys.delete(e.id);\n\t\t\t\t}\n\t\t\t}));\n\t\t\tstore.add(directProxy.onProcessReady(e => this._ptys.get(e.id)?.handleReady(e.event)));\n\t\t\tstore.add(directProxy.onProcessReplay(e => this._ptys.get(e.id)?.handleReplay(e.event)));\n\t\t\tstore.add(directProxy.onProcessOrphanQuestion(e => this._ptys.get(e.id)?.handleOrphanQuestion()));\n\t\t\tstore.add(directProxy.onDidRequestDetach(e => this._onDidRequestDetach.fire(e)));\n\n\t\t\t// Eagerly fetch the backend's environment for memoization\n\t\t\tthis.getEnvironment();\n\t\t});\n\t}\n\n\tasync requestDetachInstance(workspaceId: string, instanceId: number): Promise<IProcessDetails | undefined> {\n\t\treturn this._proxy.requestDetachInstance(workspaceId, instanceId);\n\t}\n\n\tasync acceptDetachInstanceReply(requestId: number, persistentProcessId?: number): Promise<void> {\n\t\tif (!persistentProcessId) {\n\t\t\tthis._logService.warn('Cannot attach to feature terminals, custom pty terminals, or those without a persistentProcessId');\n\t\t\treturn;\n\t\t}\n\t\treturn this._proxy.acceptDetachInstanceReply(requestId, persistentProcessId);\n\t}\n\n\tasync persistTerminalState(): Promise<void> {\n\t\tconst ids = Array.from(this._ptys.keys());\n\t\tconst serialized = await this._proxy.serializeTerminalState(ids);\n\t\tthis._storageService.store(TerminalStorageKeys.TerminalBufferState, serialized, StorageScope.WORKSPACE, StorageTarget.MACHINE);\n\t}\n\n\tasync updateTitle(id: number, title: string, titleSource: TitleEventSource): Promise<void> {\n\t\tawait this._proxy.updateTitle(id, title, titleSource);\n\t}\n\n\tasync updateIcon(id: number, userInitiated: boolean, icon: URI | { light: URI; dark: URI } | { id: string; color?: { id: string } }, color?: string): Promise<void> {\n\t\tawait this._proxy.updateIcon(id, userInitiated, icon, color);\n\t}\n\n\tasync setNextCommandId(id: number, commandLine: string, commandId: string): Promise<void> {\n\t\tawait this._proxy.setNextCommandId(id, commandLine, commandId);\n\t}\n\n\tasync updateProperty<T extends ProcessPropertyType>(id: number, property: ProcessPropertyType, value: IProcessPropertyMap[T]): Promise<void> {\n\t\treturn this._proxy.updateProperty(id, property, value);\n\t}\n\n\tasync createProcess(\n\t\tshellLaunchConfig: IShellLaunchConfig,\n\t\tcwd: string,\n\t\tcols: number,\n\t\trows: number,\n\t\tunicodeVersion: '6' | '11',\n\t\tenv: IProcessEnvironment,\n\t\toptions: ITerminalProcessOptions,\n\t\tshouldPersist: boolean\n\t): Promise<ITerminalChildProcess> {\n\t\tawait this._connectToDirectProxy();\n\t\tconst executableEnv = await this._shellEnvironmentService.getShellEnv();\n\t\tconst id = await this._proxy.createProcess(shellLaunchConfig, cwd, cols, rows, unicodeVersion, env, executableEnv, options, shouldPersist, this._getWorkspaceId(), this._getWorkspaceName());\n\t\tconst pty = new LocalPty(id, shouldPersist, this._proxy);\n\t\tthis._ptys.set(id, pty);\n\t\treturn pty;\n\t}\n\n\tasync attachToProcess(id: number): Promise<ITerminalChildProcess | undefined> {\n\t\tawait this._connectToDirectProxy();\n\t\ttry {\n\t\t\tawait this._proxy.attachToProcess(id);\n\t\t\tconst pty = new LocalPty(id, true, this._proxy);\n\t\t\tthis._ptys.set(id, pty);\n\t\t\treturn pty;\n\t\t} catch (e) {\n\t\t\tthis._logService.warn(`Couldn't attach to process ${e.message}`);\n\t\t}\n\t\treturn undefined;\n\t}\n\n\tasync attachToRevivedProcess(id: number): Promise<ITerminalChildProcess | undefined> {\n\t\tawait this._connectToDirectProxy();\n\t\ttry {\n\t\t\tconst newId = await this._proxy.getRevivedPtyNewId(this._getWorkspaceId(), id) ?? id;\n\t\t\treturn await this.attachToProcess(newId);\n\t\t} catch (e) {\n\t\t\tthis._logService.warn(`Couldn't attach to process ${e.message}`);\n\t\t}\n\t\treturn undefined;\n\t}\n\n\tasync listProcesses(): Promise<IProcessDetails[]> {\n\t\tawait this._connectToDirectProxy();\n\t\treturn this._proxy.listProcesses();\n\t}\n\n\tasync getLatency(): Promise<IPtyHostLatencyMeasurement[]> {\n\t\tconst measurements: IPtyHostLatencyMeasurement[] = [];\n\t\tconst sw = new StopWatch();\n\t\tif (this._directProxy) {\n\t\t\tawait this._directProxy.getLatency();\n\t\t\tsw.stop();\n\t\t\tmeasurements.push({\n\t\t\t\tlabel: 'window<->ptyhost (message port)',\n\t\t\t\tlatency: sw.elapsed()\n\t\t\t});\n\t\t\tsw.reset();\n\t\t}\n\t\tconst results = await this._localPtyService.getLatency();\n\t\tsw.stop();\n\t\tmeasurements.push({\n\t\t\tlabel: 'window<->ptyhostservice<->ptyhost',\n\t\t\tlatency: sw.elapsed()\n\t\t});\n\t\treturn [\n\t\t\t...measurements,\n\t\t\t...results\n\t\t];\n\t}\n\n\tasync getPerformanceMarks(): Promise<PerformanceMark[]> {\n\t\treturn this._proxy.getPerformanceMarks();\n\t}\n\n\tasync reduceConnectionGraceTime(): Promise<void> {\n\t\tthis._proxy.reduceConnectionGraceTime();\n\t}\n\n\tasync getDefaultSystemShell(osOverride?: OperatingSystem): Promise<string> {\n\t\treturn this._proxy.getDefaultSystemShell(osOverride);\n\t}\n\n\tasync getProfiles(profiles: unknown, defaultProfile: unknown, includeDetectedProfiles?: boolean) {\n\t\treturn this._localPtyService.getProfiles(this._workspaceContextService.getWorkspace().id, profiles, defaultProfile, includeDetectedProfiles) || [];\n\t}\n\n\t@memoize\n\tasync getEnvironment(): Promise<IProcessEnvironment> {\n\t\treturn this._proxy.getEnvironment();\n\t}\n\n\t@memoize\n\tasync getShellEnvironment(): Promise<IProcessEnvironment> {\n\t\treturn this._shellEnvironmentService.getShellEnv();\n\t}\n\n\tasync getWslPath(original: string, direction: 'unix-to-win' | 'win-to-unix'): Promise<string> {\n\t\treturn this._proxy.getWslPath(original, direction);\n\t}\n\n\tasync setTerminalLayoutInfo(layoutInfo?: ITerminalsLayoutInfoById): Promise<void> {\n\t\tconst args: ISetTerminalLayoutInfoArgs = {\n\t\t\tworkspaceId: this._getWorkspaceId(),\n\t\t\ttabs: layoutInfo ? layoutInfo.tabs : [],\n\t\t\tbackground: layoutInfo ? layoutInfo.background : null\n\t\t};\n\t\tawait this._proxy.setTerminalLayoutInfo(args);\n\t\t// Store in the storage service as well to be used when reviving processes as normally this\n\t\t// is stored in memory on the pty host\n\t\tthis._storageService.store(TerminalStorageKeys.TerminalLayoutInfo, JSON.stringify(args), StorageScope.WORKSPACE, StorageTarget.MACHINE);\n\t}\n\n\tasync getTerminalLayoutInfo(): Promise<ITerminalsLayoutInfo | undefined> {\n\t\tconst workspaceId = this._getWorkspaceId();\n\t\tconst layoutArgs: IGetTerminalLayoutInfoArgs = { workspaceId };\n\n\t\t// Revive processes if needed\n\t\tconst serializedState = this._storageService.get(TerminalStorageKeys.TerminalBufferState, StorageScope.WORKSPACE);\n\t\tconst reviveBufferState = this._deserializeTerminalState(serializedState);\n\t\tif (reviveBufferState && reviveBufferState.length > 0) {\n\t\t\ttry {\n\t\t\t\t// Create variable resolver\n\t\t\t\tconst activeWorkspaceRootUri = this._historyService.getLastActiveWorkspaceRoot();\n\t\t\t\tconst lastActiveWorkspace = activeWorkspaceRootUri ? this._workspaceContextService.getWorkspaceFolder(activeWorkspaceRootUri) ?? undefined : undefined;\n\t\t\t\tconst variableResolver = terminalEnvironment.createVariableResolver(lastActiveWorkspace, await this._terminalProfileResolverService.getEnvironment(this.remoteAuthority), this._configurationResolverService);\n\n\t\t\t\t// Re-resolve the environments and replace it on the state so local terminals use a fresh\n\t\t\t\t// environment\n\t\t\t\tmark('code/terminal/willGetReviveEnvironments');\n\t\t\t\tawait Promise.all(reviveBufferState.map(state => new Promise<void>(r => {\n\t\t\t\t\tthis._resolveEnvironmentForRevive(variableResolver, state.shellLaunchConfig).then(freshEnv => {\n\t\t\t\t\t\tstate.processLaunchConfig.env = freshEnv;\n\t\t\t\t\t\tr();\n\t\t\t\t\t});\n\t\t\t\t})));\n\t\t\t\tmark('code/terminal/didGetReviveEnvironments');\n\n\t\t\t\tmark('code/terminal/willReviveTerminalProcesses');\n\t\t\t\tawait this._proxy.reviveTerminalProcesses(workspaceId, reviveBufferState, Intl.DateTimeFormat().resolvedOptions().locale);\n\t\t\t\tmark('code/terminal/didReviveTerminalProcesses');\n\t\t\t\tthis._storageService.remove(TerminalStorageKeys.TerminalBufferState, StorageScope.WORKSPACE);\n\t\t\t\t// If reviving processes, send the terminal layout info back to the pty host as it\n\t\t\t\t// will not have been persisted on application exit\n\t\t\t\tconst layoutInfo = this._storageService.get(TerminalStorageKeys.TerminalLayoutInfo, StorageScope.WORKSPACE);\n\t\t\t\tif (layoutInfo) {\n\t\t\t\t\tmark('code/terminal/willSetTerminalLayoutInfo');\n\t\t\t\t\tawait this._proxy.setTerminalLayoutInfo(JSON.parse(layoutInfo));\n\t\t\t\t\tmark('code/terminal/didSetTerminalLayoutInfo');\n\t\t\t\t\tthis._storageService.remove(TerminalStorageKeys.TerminalLayoutInfo, StorageScope.WORKSPACE);\n\t\t\t\t}\n\t\t\t} catch (e: unknown) {\n\t\t\t\tthis._logService.warn('LocalTerminalBackend#getTerminalLayoutInfo Error', (<{ message?: string }>e).message ?? e);\n\t\t\t}\n\t\t}\n\n\t\treturn this._proxy.getTerminalLayoutInfo(layoutArgs);\n\t}\n\n\tprivate async _resolveEnvironmentForRevive(variableResolver: terminalEnvironment.VariableResolver | undefined, shellLaunchConfig: IShellLaunchConfig): Promise<IProcessEnvironment> {\n\t\tconst platformKey = isWindows ? 'windows' : (isMacintosh ? 'osx' : 'linux');\n\t\tconst envFromConfigValue = this._configurationService.getValue<ITerminalEnvironment | undefined>(`terminal.integrated.env.${platformKey}`);\n\t\tconst baseEnv = await (shellLaunchConfig.useShellEnvironment ? this.getShellEnvironment() : this.getEnvironment());\n\t\tconst env = await terminalEnvironment.createTerminalEnvironment(shellLaunchConfig, envFromConfigValue, variableResolver, this._productService.version, this._configurationService.getValue(TerminalSettingId.DetectLocale), baseEnv);\n\t\tif (shouldUseEnvironmentVariableCollection(shellLaunchConfig)) {\n\t\t\tconst workspaceFolder = terminalEnvironment.getWorkspaceForTerminal(shellLaunchConfig.cwd, this._workspaceContextService, this._historyService);\n\t\t\tawait this._environmentVariableService.mergedCollection.applyToProcessEnvironment(env, { workspaceFolder }, variableResolver);\n\t\t}\n\t\treturn env;\n\t}\n\n\tprivate _getWorkspaceName(): string {\n\t\treturn this._labelService.getWorkspaceLabel(this._workspaceContextService.getWorkspace());\n\t}\n\n\t// #region Pty service contribution RPC calls\n\n\tinstallAutoReply(match: string, reply: string): Promise<void> {\n\t\treturn this._proxy.installAutoReply(match, reply);\n\t}\n\tuninstallAllAutoReplies(): Promise<void> {\n\t\treturn this._proxy.uninstallAllAutoReplies();\n\t}\n\n\t// #endregion\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Emitter } from '../../../../base/common/event.js';\nimport { IProcessEnvironment, isMacintosh, isWindows, OperatingSystem } from '../../../../base/common/platform.js';\nimport { URI } from '../../../../base/common/uri.js';\nimport { IConfigurationService } from '../../../../platform/configuration/common/configuration.js';\nimport { IInstantiationService } from '../../../../platform/instantiation/common/instantiation.js';\nimport { ILabelService } from '../../../../platform/label/common/label.js';\nimport { Registry } from '../../../../platform/registry/common/platform.js';\nimport { IStorageService, StorageScope, StorageTarget } from '../../../../platform/storage/common/storage.js';\nimport { ILocalPtyService, IProcessPropertyMap, IPtyHostLatencyMeasurement, IPtyService, IShellLaunchConfig, ITerminalBackend, ITerminalBackendRegistry, ITerminalChildProcess, ITerminalEnvironment, ITerminalLogService, ITerminalProcessOptions, ITerminalsLayoutInfo, ITerminalsLayoutInfoById, ProcessPropertyType, TerminalExtensions, TerminalIpcChannels, TerminalSettingId, TitleEventSource } from '../../../../platform/terminal/common/terminal.js';\nimport { IGetTerminalLayoutInfoArgs, IProcessDetails, ISetTerminalLayoutInfoArgs } from '../../../../platform/terminal/common/terminalProcess.js';\nimport { IWorkspaceContextService } from '../../../../platform/workspace/common/workspace.js';\nimport { IWorkbenchContribution } from '../../../common/contributions.js';\nimport { ITerminalInstanceService } from '../browser/terminal.js';\nimport { ITerminalProfileResolverService } from '../common/terminal.js';\nimport { TerminalStorageKeys } from '../common/terminalStorageKeys.js';\nimport { LocalPty } from './localPty.js';\nimport { IConfigurationResolverService } from '../../../services/configurationResolver/common/configurationResolver.js';\nimport { IShellEnvironmentService } from '../../../services/environment/electron-browser/shellEnvironmentService.js';\nimport { IHistoryService } from '../../../services/history/common/history.js';\nimport * as terminalEnvironment from '../common/terminalEnvironment.js';\nimport { IProductService } from '../../../../platform/product/common/productService.js';\nimport { IEnvironmentVariableService } from '../common/environmentVariable.js';\nimport { BaseTerminalBackend } from '../browser/baseTerminalBackend.js';\nimport { INativeHostService } from '../../../../platform/native/common/native.js';\nimport { Client as MessagePortClient } from '../../../../base/parts/ipc/common/ipc.mp.js';\nimport { acquirePort } from '../../../../base/parts/ipc/electron-browser/ipc.mp.js';\nimport { getDelayedChannel, ProxyChannel } from '../../../../base/parts/ipc/common/ipc.js';\nimport { mark, PerformanceMark } from '../../../../base/common/performance.js';\nimport { ILifecycleService, LifecyclePhase } from '../../../services/lifecycle/common/lifecycle.js';\nimport { DeferredPromise } from '../../../../base/common/async.js';\nimport { IStatusbarService } from '../../../services/statusbar/browser/statusbar.js';\nimport { memoize } from '../../../../base/common/decorators.js';\nimport { StopWatch } from '../../../../base/common/stopwatch.js';\nimport { IRemoteAgentService } from '../../../services/remote/common/remoteAgentService.js';\nimport { shouldUseEnvironmentVariableCollection } from '../../../../platform/terminal/common/terminalEnvironment.js';\nimport { DisposableStore, MutableDisposable } from '../../../../base/common/lifecycle.js';\n\nexport class LocalTerminalBackendContribution implements IWorkbenchContribution {\n\n\tstatic readonly ID = 'workbench.contrib.localTerminalBackend';\n\n\tconstructor(\n\t\t@IInstantiationService instantiationService: IInstantiationService,\n\t\t@ITerminalInstanceService terminalInstanceService: ITerminalInstanceService\n\t) {\n\t\tconst backend = instantiationService.createInstance(LocalTerminalBackend);\n\t\tRegistry.as<ITerminalBackendRegistry>(TerminalExtensions.Backend).registerTerminalBackend(backend);\n\t\tterminalInstanceService.didRegisterBackend(backend);\n\t}\n}\n\nclass LocalTerminalBackend extends BaseTerminalBackend implements ITerminalBackend {\n\treadonly remoteAuthority = undefined;\n\n\tprivate readonly _ptys: Map<number, LocalPty> = new Map();\n\n\tprivate _directProxyClientEventually: DeferredPromise<MessagePortClient> | undefined;\n\tprivate _directProxy: IPtyService | undefined;\n\tprivate readonly _directProxyDisposables = this._register(new MutableDisposable());\n\n\t/**\n\t * Communicate to the direct proxy (renderer<->ptyhost) if it's available, otherwise use the\n\t * indirect proxy (renderer<->main<->ptyhost). The latter may not need to actually launch the\n\t * pty host, for example when detecting profiles.\n\t */\n\tprivate get _proxy(): IPtyService { return this._directProxy || this._localPtyService; }\n\n\tprivate readonly _whenReady = new DeferredPromise<void>();\n\tget whenReady(): Promise<void> { return this._whenReady.p; }\n\tsetReady(): void { this._whenReady.complete(); }\n\n\tprivate readonly _onDidRequestDetach = this._register(new Emitter<{ requestId: number; workspaceId: string; instanceId: number }>());\n\treadonly onDidRequestDetach = this._onDidRequestDetach.event;\n\n\tconstructor(\n\t\t@IWorkspaceContextService workspaceContextService: IWorkspaceContextService,\n\t\t@ILifecycleService private readonly _lifecycleService: ILifecycleService,\n\t\t@ITerminalLogService logService: ITerminalLogService,\n\t\t@ILocalPtyService private readonly _localPtyService: ILocalPtyService,\n\t\t@ILabelService private readonly _labelService: ILabelService,\n\t\t@IShellEnvironmentService private readonly _shellEnvironmentService: IShellEnvironmentService,\n\t\t@IStorageService private readonly _storageService: IStorageService,\n\t\t@IConfigurationResolverService private readonly _configurationResolverService: IConfigurationResolverService,\n\t\t@IConfigurationService private readonly _configurationService: IConfigurationService,\n\t\t@IProductService private readonly _productService: IProductService,\n\t\t@IHistoryService private readonly _historyService: IHistoryService,\n\t\t@ITerminalProfileResolverService private readonly _terminalProfileResolverService: ITerminalProfileResolverService,\n\t\t@IEnvironmentVariableService private readonly _environmentVariableService: IEnvironmentVariableService,\n\t\t@IHistoryService historyService: IHistoryService,\n\t\t@INativeHostService private readonly _nativeHostService: INativeHostService,\n\t\t@IStatusbarService statusBarService: IStatusbarService,\n\t\t@IRemoteAgentService private readonly _remoteAgentService: IRemoteAgentService,\n\t) {\n\t\tsuper(_localPtyService, logService, historyService, _configurationResolverService, statusBarService, workspaceContextService);\n\n\t\tthis._register(this.onPtyHostRestart(() => {\n\t\t\tthis._directProxy = undefined;\n\t\t\tthis._directProxyClientEventually = undefined;\n\t\t\tthis._connectToDirectProxy();\n\t\t}));\n\t}\n\n\t/**\n\t * Request a direct connection to the pty host, this will launch the pty host process if necessary.\n\t */\n\tprivate async _connectToDirectProxy(): Promise<void> {\n\t\t// Check if connecting is in progress\n\t\tif (this._directProxyClientEventually) {\n\t\t\tawait this._directProxyClientEventually.p;\n\t\t\treturn;\n\t\t}\n\n\t\tthis._logService.debug('Starting pty host');\n\t\tconst directProxyClientEventually = new DeferredPromise<MessagePortClient>();\n\t\tthis._directProxyClientEventually = directProxyClientEventually;\n\t\tconst directProxy = ProxyChannel.toService<IPtyService>(getDelayedChannel(this._directProxyClientEventually.p.then(client => client.getChannel(TerminalIpcChannels.PtyHostWindow))));\n\t\tthis._directProxy = directProxy;\n\t\tthis._directProxyDisposables.clear();\n\n\t\t// The pty host should not get launched until at least the window restored phase\n\t\t// if remote auth exists, don't await\n\t\tif (!this._remoteAgentService.getConnection()?.remoteAuthority) {\n\t\t\tawait this._lifecycleService.when(LifecyclePhase.Restored);\n\t\t}\n\n\t\tmark('code/terminal/willConnectPtyHost');\n\t\tthis._logService.trace('Renderer->PtyHost#connect: before acquirePort');\n\t\tacquirePort('vscode:createPtyHostMessageChannel', 'vscode:createPtyHostMessageChannelResult').then(port => {\n\t\t\tmark('code/terminal/didConnectPtyHost');\n\t\t\tthis._logService.trace('Renderer->PtyHost#connect: connection established');\n\n\t\t\tconst store = new DisposableStore();\n\t\t\tthis._directProxyDisposables.value = store;\n\n\t\t\t// There are two connections to the pty host; one to the regular shared process\n\t\t\t// _localPtyService, and one directly via message port _ptyHostDirectProxy. The former is\n\t\t\t// used for pty host management messages, it would make sense in the future to use a\n\t\t\t// separate interface/service for this one.\n\t\t\tconst client = store.add(new MessagePortClient(port, `window:${this._nativeHostService.windowId}`));\n\t\t\tdirectProxyClientEventually.complete(client);\n\t\t\tthis._onPtyHostConnected.fire();\n\n\t\t\t// Attach process listeners\n\t\t\tstore.add(directProxy.onProcessData(e => this._ptys.get(e.id)?.handleData(e.event)));\n\t\t\tstore.add(directProxy.onDidChangeProperty(e => this._ptys.get(e.id)?.handleDidChangeProperty(e.property)));\n\t\t\tstore.add(directProxy.onProcessExit(e => {\n\t\t\t\tconst pty = this._ptys.get(e.id);\n\t\t\t\tif (pty) {\n\t\t\t\t\tpty.handleExit(e.event);\n\t\t\t\t\tpty.dispose();\n\t\t\t\t\tthis._ptys.delete(e.id);\n\t\t\t\t}\n\t\t\t}));\n\t\t\tstore.add(directProxy.onProcessReady(e => this._ptys.get(e.id)?.handleReady(e.event)));\n\t\t\tstore.add(directProxy.onProcessReplay(e => this._ptys.get(e.id)?.handleReplay(e.event)));\n\t\t\tstore.add(directProxy.onProcessOrphanQuestion(e => this._ptys.get(e.id)?.handleOrphanQuestion()));\n\t\t\tstore.add(directProxy.onDidRequestDetach(e => this._onDidRequestDetach.fire(e)));\n\n\t\t\t// Eagerly fetch the backend's environment for memoization\n\t\t\tthis.getEnvironment();\n\t\t});\n\t}\n\n\tasync requestDetachInstance(workspaceId: string, instanceId: number): Promise<IProcessDetails | undefined> {\n\t\treturn this._proxy.requestDetachInstance(workspaceId, instanceId);\n\t}\n\n\tasync acceptDetachInstanceReply(requestId: number, persistentProcessId?: number): Promise<void> {\n\t\tif (!persistentProcessId) {\n\t\t\tthis._logService.warn('Cannot attach to feature terminals, custom pty terminals, or those without a persistentProcessId');\n\t\t\treturn;\n\t\t}\n\t\treturn this._proxy.acceptDetachInstanceReply(requestId, persistentProcessId);\n\t}\n\n\tasync persistTerminalState(): Promise<void> {\n\t\tconst ids = Array.from(this._ptys.keys());\n\t\tconst serialized = await this._proxy.serializeTerminalState(ids);\n\t\tthis._storageService.store(TerminalStorageKeys.TerminalBufferState, serialized, StorageScope.WORKSPACE, StorageTarget.MACHINE);\n\t}\n\n\tasync updateTitle(id: number, title: string, titleSource: TitleEventSource): Promise<void> {\n\t\tawait this._proxy.updateTitle(id, title, titleSource);\n\t}\n\n\tasync updateIcon(id: number, userInitiated: boolean, icon: URI | { light: URI; dark: URI } | { id: string; color?: { id: string } }, color?: string): Promise<void> {\n\t\tawait this._proxy.updateIcon(id, userInitiated, icon, color);\n\t}\n\n\tasync setNextCommandId(id: number, commandLine: string, commandId: string): Promise<void> {\n\t\tawait this._proxy.setNextCommandId(id, commandLine, commandId);\n\t}\n\n\tasync updateProperty<T extends ProcessPropertyType>(id: number, property: ProcessPropertyType, value: IProcessPropertyMap[T]): Promise<void> {\n\t\treturn this._proxy.updateProperty(id, property, value);\n\t}\n\n\tasync createProcess(\n\t\tshellLaunchConfig: IShellLaunchConfig,\n\t\tcwd: string,\n\t\tcols: number,\n\t\trows: number,\n\t\tunicodeVersion: '6' | '11',\n\t\tenv: IProcessEnvironment,\n\t\toptions: ITerminalProcessOptions,\n\t\tshouldPersist: boolean\n\t): Promise<ITerminalChildProcess> {\n\t\tawait this._connectToDirectProxy();\n\t\tconst executableEnv = await this._shellEnvironmentService.getShellEnv();\n\t\tconst id = await this._proxy.createProcess(shellLaunchConfig, cwd, cols, rows, unicodeVersion, env, executableEnv, options, shouldPersist, this._getWorkspaceId(), this._getWorkspaceName());\n\t\tconst pty = new LocalPty(id, shouldPersist, this._proxy);\n\t\tthis._ptys.set(id, pty);\n\t\treturn pty;\n\t}\n\n\tasync attachToProcess(id: number): Promise<ITerminalChildProcess | undefined> {\n\t\tawait this._connectToDirectProxy();\n\t\ttry {\n\t\t\tawait this._proxy.attachToProcess(id);\n\t\t\tconst pty = new LocalPty(id, true, this._proxy);\n\t\t\tthis._ptys.set(id, pty);\n\t\t\treturn pty;\n\t\t} catch (e) {\n\t\t\tthis._logService.warn(`Couldn't attach to process ${e.message}`);\n\t\t}\n\t\treturn undefined;\n\t}\n\n\tasync attachToRevivedProcess(id: number): Promise<ITerminalChildProcess | undefined> {\n\t\tawait this._connectToDirectProxy();\n\t\ttry {\n\t\t\tconst newId = await this._proxy.getRevivedPtyNewId(this._getWorkspaceId(), id) ?? id;\n\t\t\treturn await this.attachToProcess(newId);\n\t\t} catch (e) {\n\t\t\tthis._logService.warn(`Couldn't attach to process ${e.message}`);\n\t\t}\n\t\treturn undefined;\n\t}\n\n\tasync listProcesses(): Promise<IProcessDetails[]> {\n\t\tawait this._connectToDirectProxy();\n\t\treturn this._proxy.listProcesses();\n\t}\n\n\tasync getLatency(): Promise<IPtyHostLatencyMeasurement[]> {\n\t\tconst measurements: IPtyHostLatencyMeasurement[] = [];\n\t\tconst sw = new StopWatch();\n\t\tif (this._directProxy) {\n\t\t\tawait this._directProxy.getLatency();\n\t\t\tsw.stop();\n\t\t\tmeasurements.push({\n\t\t\t\tlabel: 'window<->ptyhost (message port)',\n\t\t\t\tlatency: sw.elapsed()\n\t\t\t});\n\t\t\tsw.reset();\n\t\t}\n\t\tconst results = await this._localPtyService.getLatency();\n\t\tsw.stop();\n\t\tmeasurements.push({\n\t\t\tlabel: 'window<->ptyhostservice<->ptyhost',\n\t\t\tlatency: sw.elapsed()\n\t\t});\n\t\treturn [\n\t\t\t...measurements,\n\t\t\t...results\n\t\t];\n\t}\n\n\tasync getPerformanceMarks(): Promise<PerformanceMark[]> {\n\t\treturn this._proxy.getPerformanceMarks();\n\t}\n\n\tasync reduceConnectionGraceTime(): Promise<void> {\n\t\tthis._proxy.reduceConnectionGraceTime();\n\t}\n\n\tasync getDefaultSystemShell(osOverride?: OperatingSystem): Promise<string> {\n\t\treturn this._proxy.getDefaultSystemShell(osOverride);\n\t}\n\n\tasync getProfiles(profiles: unknown, defaultProfile: unknown, includeDetectedProfiles?: boolean) {\n\t\treturn this._localPtyService.getProfiles(this._workspaceContextService.getWorkspace().id, profiles, defaultProfile, includeDetectedProfiles) || [];\n\t}\n\n\t@memoize\n\tasync getEnvironment(): Promise<IProcessEnvironment> {\n\t\treturn this._proxy.getEnvironment();\n\t}\n\n\t@memoize\n\tasync getShellEnvironment(): Promise<IProcessEnvironment> {\n\t\treturn this._shellEnvironmentService.getShellEnv();\n\t}\n\n\tasync getWslPath(original: string, direction: 'unix-to-win' | 'win-to-unix'): Promise<string> {\n\t\treturn this._proxy.getWslPath(original, direction);\n\t}\n\n\tasync setTerminalLayoutInfo(layoutInfo?: ITerminalsLayoutInfoById): Promise<void> {\n\t\tconst args: ISetTerminalLayoutInfoArgs = {\n\t\t\tworkspaceId: this._getWorkspaceId(),\n\t\t\ttabs: layoutInfo ? layoutInfo.tabs : [],\n\t\t\tbackground: layoutInfo ? layoutInfo.background : null\n\t\t};\n\t\tawait this._proxy.setTerminalLayoutInfo(args);\n\t\t// Store in the storage service as well to be used when reviving processes as normally this\n\t\t// is stored in memory on the pty host\n\t\tthis._storageService.store(TerminalStorageKeys.TerminalLayoutInfo, JSON.stringify(args), StorageScope.WORKSPACE, StorageTarget.MACHINE);\n\t}\n\n\tasync getTerminalLayoutInfo(): Promise<ITerminalsLayoutInfo | undefined> {\n\t\tconst workspaceId = this._getWorkspaceId();\n\t\tconst layoutArgs: IGetTerminalLayoutInfoArgs = { workspaceId };\n\n\t\t// Revive processes if needed\n\t\tconst serializedState = this._storageService.get(TerminalStorageKeys.TerminalBufferState, StorageScope.WORKSPACE);\n\t\tconst reviveBufferState = this._deserializeTerminalState(serializedState);\n\t\tif (reviveBufferState && reviveBufferState.length > 0) {\n\t\t\ttry {\n\t\t\t\t// Create variable resolver\n\t\t\t\tconst activeWorkspaceRootUri = this._historyService.getLastActiveWorkspaceRoot();\n\t\t\t\tconst lastActiveWorkspace = activeWorkspaceRootUri ? this._workspaceContextService.getWorkspaceFolder(activeWorkspaceRootUri) ?? undefined : undefined;\n\t\t\t\tconst variableResolver = terminalEnvironment.createVariableResolver(lastActiveWorkspace, await this._terminalProfileResolverService.getEnvironment(this.remoteAuthority), this._configurationResolverService);\n\n\t\t\t\t// Re-resolve the environments and replace it on the state so local terminals use a fresh\n\t\t\t\t// environment\n\t\t\t\tmark('code/terminal/willGetReviveEnvironments');\n\t\t\t\tawait Promise.all(reviveBufferState.map(state => new Promise<void>(r => {\n\t\t\t\t\tthis._resolveEnvironmentForRevive(variableResolver, state.shellLaunchConfig).then(freshEnv => {\n\t\t\t\t\t\tstate.processLaunchConfig.env = freshEnv;\n\t\t\t\t\t\tr();\n\t\t\t\t\t});\n\t\t\t\t})));\n\t\t\t\tmark('code/terminal/didGetReviveEnvironments');\n\n\t\t\t\tmark('code/terminal/willReviveTerminalProcesses');\n\t\t\t\tawait this._proxy.reviveTerminalProcesses(workspaceId, reviveBufferState, Intl.DateTimeFormat().resolvedOptions().locale);\n\t\t\t\tmark('code/terminal/didReviveTerminalProcesses');\n\t\t\t\tthis._storageService.remove(TerminalStorageKeys.TerminalBufferState, StorageScope.WORKSPACE);\n\t\t\t\t// If reviving processes, send the terminal layout info back to the pty host as it\n\t\t\t\t// will not have been persisted on application exit\n\t\t\t\tconst layoutInfo = this._storageService.get(TerminalStorageKeys.TerminalLayoutInfo, StorageScope.WORKSPACE);\n\t\t\t\tif (layoutInfo) {\n\t\t\t\t\tmark('code/terminal/willSetTerminalLayoutInfo');\n\t\t\t\t\tawait this._proxy.setTerminalLayoutInfo(JSON.parse(layoutInfo));\n\t\t\t\t\tmark('code/terminal/didSetTerminalLayoutInfo');\n\t\t\t\t\tthis._storageService.remove(TerminalStorageKeys.TerminalLayoutInfo, StorageScope.WORKSPACE);\n\t\t\t\t}\n\t\t\t} catch (e: unknown) {\n\t\t\t\tthis._logService.warn('LocalTerminalBackend#getTerminalLayoutInfo Error', (<{ message?: string }>e).message ?? e);\n\t\t\t}\n\t\t}\n\n\t\treturn this._proxy.getTerminalLayoutInfo(layoutArgs);\n\t}\n\n\tprivate async _resolveEnvironmentForRevive(variableResolver: terminalEnvironment.VariableResolver | undefined, shellLaunchConfig: IShellLaunchConfig): Promise<IProcessEnvironment> {\n\t\tconst platformKey = isWindows ? 'windows' : (isMacintosh ? 'osx' : 'linux');\n\t\tconst envFromConfigValue = this._configurationService.getValue<ITerminalEnvironment | undefined>(`terminal.integrated.env.${platformKey}`);\n\t\tconst baseEnv = await (shellLaunchConfig.useShellEnvironment ? this.getShellEnvironment() : this.getEnvironment());\n\t\tconst env = await terminalEnvironment.createTerminalEnvironment(shellLaunchConfig, envFromConfigValue, variableResolver, this._productService.version, this._configurationService.getValue(TerminalSettingId.DetectLocale), baseEnv);\n\t\tif (shouldUseEnvironmentVariableCollection(shellLaunchConfig)) {\n\t\t\tconst workspaceFolder = terminalEnvironment.getWorkspaceForTerminal(shellLaunchConfig.cwd, this._workspaceContextService, this._historyService);\n\t\t\tawait this._environmentVariableService.mergedCollection.applyToProcessEnvironment(env, { workspaceFolder }, variableResolver);\n\t\t}\n\t\treturn env;\n\t}\n\n\tprivate _getWorkspaceName(): string {\n\t\treturn this._labelService.getWorkspaceLabel(this._workspaceContextService.getWorkspace());\n\t}\n\n\t// #region Pty service contribution RPC calls\n\n\tinstallAutoReply(match: string, reply: string): Promise<void> {\n\t\treturn this._proxy.installAutoReply(match, reply);\n\t}\n\tuninstallAllAutoReplies(): Promise<void> {\n\t\treturn this._proxy.uninstallAllAutoReplies();\n\t}\n\n\t// #endregion\n}\n"]}