{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/contrib/terminal/test/browser/terminalService.test.ts","vs/workbench/contrib/terminal/test/browser/terminalService.test.ts"],"names":[],"mappings":"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","file":"terminalService.test.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { fail } from 'assert';\nimport { Emitter } from '../../../../../base/common/event.js';\nimport { ensureNoDisposablesAreLeakedInTestSuite } from '../../../../../base/test/common/utils.js';\nimport { TestConfigurationService } from '../../../../../platform/configuration/test/common/testConfigurationService.js';\nimport { IDialogService } from '../../../../../platform/dialogs/common/dialogs.js';\nimport { TestDialogService } from '../../../../../platform/dialogs/test/common/testDialogService.js';\nimport { TerminalLocation } from '../../../../../platform/terminal/common/terminal.js';\nimport { ITerminalInstance, ITerminalInstanceService, ITerminalService } from '../../browser/terminal.js';\nimport { TerminalService } from '../../browser/terminalService.js';\nimport { TERMINAL_CONFIG_SECTION } from '../../common/terminal.js';\nimport { IRemoteAgentService } from '../../../../services/remote/common/remoteAgentService.js';\nimport { workbenchInstantiationService } from '../../../../test/browser/workbenchTestServices.js';\nimport type { IConfigurationChangeEvent } from '../../../../../platform/configuration/common/configuration.js';\n\nsuite('Workbench - TerminalService', () => {\n\tconst store = ensureNoDisposablesAreLeakedInTestSuite();\n\n\tlet terminalService: TerminalService;\n\tlet configurationService: TestConfigurationService;\n\tlet dialogService: TestDialogService;\n\n\tsetup(async () => {\n\t\tdialogService = new TestDialogService();\n\t\tconfigurationService = new TestConfigurationService({\n\t\t\tfiles: {},\n\t\t\tterminal: {\n\t\t\t\tintegrated: {\n\t\t\t\t\tconfirmOnKill: 'never'\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tconst instantiationService = workbenchInstantiationService({\n\t\t\tconfigurationService: () => configurationService,\n\t\t}, store);\n\t\tinstantiationService.stub(IDialogService, dialogService);\n\t\tinstantiationService.stub(ITerminalInstanceService, 'getBackend', undefined);\n\t\tinstantiationService.stub(ITerminalInstanceService, 'getRegisteredBackends', []);\n\t\tinstantiationService.stub(IRemoteAgentService, 'getConnection', null);\n\n\t\tterminalService = store.add(instantiationService.createInstance(TerminalService));\n\t\tinstantiationService.stub(ITerminalService, terminalService);\n\t});\n\n\tsuite('safeDisposeTerminal', () => {\n\t\tlet onExitEmitter: Emitter<number | undefined>;\n\n\t\tsetup(() => {\n\t\t\tonExitEmitter = store.add(new Emitter<number | undefined>());\n\t\t});\n\n\t\ttest('should not show prompt when confirmOnKill is never', async () => {\n\t\t\tawait setConfirmOnKill(configurationService, 'never');\n\t\t\tawait terminalService.safeDisposeTerminal({\n\t\t\t\ttarget: TerminalLocation.Editor,\n\t\t\t\thasChildProcesses: true,\n\t\t\t\tonExit: onExitEmitter.event,\n\t\t\t\tdispose: () => onExitEmitter.fire(undefined)\n\t\t\t} satisfies Partial<ITerminalInstance> as unknown as ITerminalInstance);\n\t\t\tawait terminalService.safeDisposeTerminal({\n\t\t\t\ttarget: TerminalLocation.Panel,\n\t\t\t\thasChildProcesses: true,\n\t\t\t\tonExit: onExitEmitter.event,\n\t\t\t\tdispose: () => onExitEmitter.fire(undefined)\n\t\t\t} satisfies Partial<ITerminalInstance> as unknown as ITerminalInstance);\n\t\t});\n\t\ttest('should not show prompt when any terminal editor is closed (handled by editor itself)', async () => {\n\t\t\tawait setConfirmOnKill(configurationService, 'editor');\n\t\t\tterminalService.safeDisposeTerminal({\n\t\t\t\ttarget: TerminalLocation.Editor,\n\t\t\t\thasChildProcesses: true,\n\t\t\t\tonExit: onExitEmitter.event,\n\t\t\t\tdispose: () => onExitEmitter.fire(undefined)\n\t\t\t} satisfies Partial<ITerminalInstance> as unknown as ITerminalInstance);\n\t\t\tawait setConfirmOnKill(configurationService, 'always');\n\t\t\tterminalService.safeDisposeTerminal({\n\t\t\t\ttarget: TerminalLocation.Editor,\n\t\t\t\thasChildProcesses: true,\n\t\t\t\tonExit: onExitEmitter.event,\n\t\t\t\tdispose: () => onExitEmitter.fire(undefined)\n\t\t\t} satisfies Partial<ITerminalInstance> as unknown as ITerminalInstance);\n\t\t});\n\t\ttest('should not show prompt when confirmOnKill is editor and panel terminal is closed', async () => {\n\t\t\tawait setConfirmOnKill(configurationService, 'editor');\n\t\t\tterminalService.safeDisposeTerminal({\n\t\t\t\ttarget: TerminalLocation.Panel,\n\t\t\t\thasChildProcesses: true,\n\t\t\t\tonExit: onExitEmitter.event,\n\t\t\t\tdispose: () => onExitEmitter.fire(undefined)\n\t\t\t} satisfies Partial<ITerminalInstance> as unknown as ITerminalInstance);\n\t\t});\n\t\ttest('should show prompt when confirmOnKill is panel and panel terminal is closed', async () => {\n\t\t\tawait setConfirmOnKill(configurationService, 'panel');\n\t\t\t// No child process cases\n\t\t\tdialogService.setConfirmResult({ confirmed: false });\n\t\t\tterminalService.safeDisposeTerminal({\n\t\t\t\ttarget: TerminalLocation.Panel,\n\t\t\t\thasChildProcesses: false,\n\t\t\t\tonExit: onExitEmitter.event,\n\t\t\t\tdispose: () => onExitEmitter.fire(undefined)\n\t\t\t} satisfies Partial<ITerminalInstance> as unknown as ITerminalInstance);\n\t\t\tdialogService.setConfirmResult({ confirmed: true });\n\t\t\tterminalService.safeDisposeTerminal({\n\t\t\t\ttarget: TerminalLocation.Panel,\n\t\t\t\thasChildProcesses: false,\n\t\t\t\tonExit: onExitEmitter.event,\n\t\t\t\tdispose: () => onExitEmitter.fire(undefined)\n\t\t\t} satisfies Partial<ITerminalInstance> as unknown as ITerminalInstance);\n\t\t\t// Child process cases\n\t\t\tdialogService.setConfirmResult({ confirmed: false });\n\t\t\tawait terminalService.safeDisposeTerminal({\n\t\t\t\ttarget: TerminalLocation.Panel,\n\t\t\t\thasChildProcesses: true,\n\t\t\t\tdispose: () => fail()\n\t\t\t} satisfies Partial<ITerminalInstance> as unknown as ITerminalInstance);\n\t\t\tdialogService.setConfirmResult({ confirmed: true });\n\t\t\tterminalService.safeDisposeTerminal({\n\t\t\t\ttarget: TerminalLocation.Panel,\n\t\t\t\thasChildProcesses: true,\n\t\t\t\tonExit: onExitEmitter.event,\n\t\t\t\tdispose: () => onExitEmitter.fire(undefined)\n\t\t\t} satisfies Partial<ITerminalInstance> as unknown as ITerminalInstance);\n\t\t});\n\t\ttest('should show prompt when confirmOnKill is always and panel terminal is closed', async () => {\n\t\t\tawait setConfirmOnKill(configurationService, 'always');\n\t\t\t// No child process cases\n\t\t\tdialogService.setConfirmResult({ confirmed: false });\n\t\t\tterminalService.safeDisposeTerminal({\n\t\t\t\ttarget: TerminalLocation.Panel,\n\t\t\t\thasChildProcesses: false,\n\t\t\t\tonExit: onExitEmitter.event,\n\t\t\t\tdispose: () => onExitEmitter.fire(undefined)\n\t\t\t} satisfies Partial<ITerminalInstance> as unknown as ITerminalInstance);\n\t\t\tdialogService.setConfirmResult({ confirmed: true });\n\t\t\tterminalService.safeDisposeTerminal({\n\t\t\t\ttarget: TerminalLocation.Panel,\n\t\t\t\thasChildProcesses: false,\n\t\t\t\tonExit: onExitEmitter.event,\n\t\t\t\tdispose: () => onExitEmitter.fire(undefined)\n\t\t\t} satisfies Partial<ITerminalInstance> as unknown as ITerminalInstance);\n\t\t\t// Child process cases\n\t\t\tdialogService.setConfirmResult({ confirmed: false });\n\t\t\tawait terminalService.safeDisposeTerminal({\n\t\t\t\ttarget: TerminalLocation.Panel,\n\t\t\t\thasChildProcesses: true,\n\t\t\t\tdispose: () => fail()\n\t\t\t} satisfies Partial<ITerminalInstance> as unknown as ITerminalInstance);\n\t\t\tdialogService.setConfirmResult({ confirmed: true });\n\t\t\tterminalService.safeDisposeTerminal({\n\t\t\t\ttarget: TerminalLocation.Panel,\n\t\t\t\thasChildProcesses: true,\n\t\t\t\tonExit: onExitEmitter.event,\n\t\t\t\tdispose: () => onExitEmitter.fire(undefined)\n\t\t\t} satisfies Partial<ITerminalInstance> as unknown as ITerminalInstance);\n\t\t});\n\t});\n});\n\nasync function setConfirmOnKill(configurationService: TestConfigurationService, value: 'never' | 'always' | 'panel' | 'editor') {\n\tawait configurationService.setUserConfiguration(TERMINAL_CONFIG_SECTION, { confirmOnKill: value });\n\tconfigurationService.onDidChangeConfigurationEmitter.fire({\n\t\taffectsConfiguration: () => true,\n\t\taffectedKeys: ['terminal.integrated.confirmOnKill']\n\t} as unknown as IConfigurationChangeEvent);\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { fail } from 'assert';\nimport { Emitter } from '../../../../../base/common/event.js';\nimport { ensureNoDisposablesAreLeakedInTestSuite } from '../../../../../base/test/common/utils.js';\nimport { TestConfigurationService } from '../../../../../platform/configuration/test/common/testConfigurationService.js';\nimport { IDialogService } from '../../../../../platform/dialogs/common/dialogs.js';\nimport { TestDialogService } from '../../../../../platform/dialogs/test/common/testDialogService.js';\nimport { TerminalLocation } from '../../../../../platform/terminal/common/terminal.js';\nimport { ITerminalInstance, ITerminalInstanceService, ITerminalService } from '../../browser/terminal.js';\nimport { TerminalService } from '../../browser/terminalService.js';\nimport { TERMINAL_CONFIG_SECTION } from '../../common/terminal.js';\nimport { IRemoteAgentService } from '../../../../services/remote/common/remoteAgentService.js';\nimport { workbenchInstantiationService } from '../../../../test/browser/workbenchTestServices.js';\nimport type { IConfigurationChangeEvent } from '../../../../../platform/configuration/common/configuration.js';\n\nsuite('Workbench - TerminalService', () => {\n\tconst store = ensureNoDisposablesAreLeakedInTestSuite();\n\n\tlet terminalService: TerminalService;\n\tlet configurationService: TestConfigurationService;\n\tlet dialogService: TestDialogService;\n\n\tsetup(async () => {\n\t\tdialogService = new TestDialogService();\n\t\tconfigurationService = new TestConfigurationService({\n\t\t\tfiles: {},\n\t\t\tterminal: {\n\t\t\t\tintegrated: {\n\t\t\t\t\tconfirmOnKill: 'never'\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tconst instantiationService = workbenchInstantiationService({\n\t\t\tconfigurationService: () => configurationService,\n\t\t}, store);\n\t\tinstantiationService.stub(IDialogService, dialogService);\n\t\tinstantiationService.stub(ITerminalInstanceService, 'getBackend', undefined);\n\t\tinstantiationService.stub(ITerminalInstanceService, 'getRegisteredBackends', []);\n\t\tinstantiationService.stub(IRemoteAgentService, 'getConnection', null);\n\n\t\tterminalService = store.add(instantiationService.createInstance(TerminalService));\n\t\tinstantiationService.stub(ITerminalService, terminalService);\n\t});\n\n\tsuite('safeDisposeTerminal', () => {\n\t\tlet onExitEmitter: Emitter<number | undefined>;\n\n\t\tsetup(() => {\n\t\t\tonExitEmitter = store.add(new Emitter<number | undefined>());\n\t\t});\n\n\t\ttest('should not show prompt when confirmOnKill is never', async () => {\n\t\t\tawait setConfirmOnKill(configurationService, 'never');\n\t\t\tawait terminalService.safeDisposeTerminal({\n\t\t\t\ttarget: TerminalLocation.Editor,\n\t\t\t\thasChildProcesses: true,\n\t\t\t\tonExit: onExitEmitter.event,\n\t\t\t\tdispose: () => onExitEmitter.fire(undefined)\n\t\t\t} satisfies Partial<ITerminalInstance> as unknown as ITerminalInstance);\n\t\t\tawait terminalService.safeDisposeTerminal({\n\t\t\t\ttarget: TerminalLocation.Panel,\n\t\t\t\thasChildProcesses: true,\n\t\t\t\tonExit: onExitEmitter.event,\n\t\t\t\tdispose: () => onExitEmitter.fire(undefined)\n\t\t\t} satisfies Partial<ITerminalInstance> as unknown as ITerminalInstance);\n\t\t});\n\t\ttest('should not show prompt when any terminal editor is closed (handled by editor itself)', async () => {\n\t\t\tawait setConfirmOnKill(configurationService, 'editor');\n\t\t\tterminalService.safeDisposeTerminal({\n\t\t\t\ttarget: TerminalLocation.Editor,\n\t\t\t\thasChildProcesses: true,\n\t\t\t\tonExit: onExitEmitter.event,\n\t\t\t\tdispose: () => onExitEmitter.fire(undefined)\n\t\t\t} satisfies Partial<ITerminalInstance> as unknown as ITerminalInstance);\n\t\t\tawait setConfirmOnKill(configurationService, 'always');\n\t\t\tterminalService.safeDisposeTerminal({\n\t\t\t\ttarget: TerminalLocation.Editor,\n\t\t\t\thasChildProcesses: true,\n\t\t\t\tonExit: onExitEmitter.event,\n\t\t\t\tdispose: () => onExitEmitter.fire(undefined)\n\t\t\t} satisfies Partial<ITerminalInstance> as unknown as ITerminalInstance);\n\t\t});\n\t\ttest('should not show prompt when confirmOnKill is editor and panel terminal is closed', async () => {\n\t\t\tawait setConfirmOnKill(configurationService, 'editor');\n\t\t\tterminalService.safeDisposeTerminal({\n\t\t\t\ttarget: TerminalLocation.Panel,\n\t\t\t\thasChildProcesses: true,\n\t\t\t\tonExit: onExitEmitter.event,\n\t\t\t\tdispose: () => onExitEmitter.fire(undefined)\n\t\t\t} satisfies Partial<ITerminalInstance> as unknown as ITerminalInstance);\n\t\t});\n\t\ttest('should show prompt when confirmOnKill is panel and panel terminal is closed', async () => {\n\t\t\tawait setConfirmOnKill(configurationService, 'panel');\n\t\t\t// No child process cases\n\t\t\tdialogService.setConfirmResult({ confirmed: false });\n\t\t\tterminalService.safeDisposeTerminal({\n\t\t\t\ttarget: TerminalLocation.Panel,\n\t\t\t\thasChildProcesses: false,\n\t\t\t\tonExit: onExitEmitter.event,\n\t\t\t\tdispose: () => onExitEmitter.fire(undefined)\n\t\t\t} satisfies Partial<ITerminalInstance> as unknown as ITerminalInstance);\n\t\t\tdialogService.setConfirmResult({ confirmed: true });\n\t\t\tterminalService.safeDisposeTerminal({\n\t\t\t\ttarget: TerminalLocation.Panel,\n\t\t\t\thasChildProcesses: false,\n\t\t\t\tonExit: onExitEmitter.event,\n\t\t\t\tdispose: () => onExitEmitter.fire(undefined)\n\t\t\t} satisfies Partial<ITerminalInstance> as unknown as ITerminalInstance);\n\t\t\t// Child process cases\n\t\t\tdialogService.setConfirmResult({ confirmed: false });\n\t\t\tawait terminalService.safeDisposeTerminal({\n\t\t\t\ttarget: TerminalLocation.Panel,\n\t\t\t\thasChildProcesses: true,\n\t\t\t\tdispose: () => fail()\n\t\t\t} satisfies Partial<ITerminalInstance> as unknown as ITerminalInstance);\n\t\t\tdialogService.setConfirmResult({ confirmed: true });\n\t\t\tterminalService.safeDisposeTerminal({\n\t\t\t\ttarget: TerminalLocation.Panel,\n\t\t\t\thasChildProcesses: true,\n\t\t\t\tonExit: onExitEmitter.event,\n\t\t\t\tdispose: () => onExitEmitter.fire(undefined)\n\t\t\t} satisfies Partial<ITerminalInstance> as unknown as ITerminalInstance);\n\t\t});\n\t\ttest('should show prompt when confirmOnKill is always and panel terminal is closed', async () => {\n\t\t\tawait setConfirmOnKill(configurationService, 'always');\n\t\t\t// No child process cases\n\t\t\tdialogService.setConfirmResult({ confirmed: false });\n\t\t\tterminalService.safeDisposeTerminal({\n\t\t\t\ttarget: TerminalLocation.Panel,\n\t\t\t\thasChildProcesses: false,\n\t\t\t\tonExit: onExitEmitter.event,\n\t\t\t\tdispose: () => onExitEmitter.fire(undefined)\n\t\t\t} satisfies Partial<ITerminalInstance> as unknown as ITerminalInstance);\n\t\t\tdialogService.setConfirmResult({ confirmed: true });\n\t\t\tterminalService.safeDisposeTerminal({\n\t\t\t\ttarget: TerminalLocation.Panel,\n\t\t\t\thasChildProcesses: false,\n\t\t\t\tonExit: onExitEmitter.event,\n\t\t\t\tdispose: () => onExitEmitter.fire(undefined)\n\t\t\t} satisfies Partial<ITerminalInstance> as unknown as ITerminalInstance);\n\t\t\t// Child process cases\n\t\t\tdialogService.setConfirmResult({ confirmed: false });\n\t\t\tawait terminalService.safeDisposeTerminal({\n\t\t\t\ttarget: TerminalLocation.Panel,\n\t\t\t\thasChildProcesses: true,\n\t\t\t\tdispose: () => fail()\n\t\t\t} satisfies Partial<ITerminalInstance> as unknown as ITerminalInstance);\n\t\t\tdialogService.setConfirmResult({ confirmed: true });\n\t\t\tterminalService.safeDisposeTerminal({\n\t\t\t\ttarget: TerminalLocation.Panel,\n\t\t\t\thasChildProcesses: true,\n\t\t\t\tonExit: onExitEmitter.event,\n\t\t\t\tdispose: () => onExitEmitter.fire(undefined)\n\t\t\t} satisfies Partial<ITerminalInstance> as unknown as ITerminalInstance);\n\t\t});\n\t});\n});\n\nasync function setConfirmOnKill(configurationService: TestConfigurationService, value: 'never' | 'always' | 'panel' | 'editor') {\n\tawait configurationService.setUserConfiguration(TERMINAL_CONFIG_SECTION, { confirmOnKill: value });\n\tconfigurationService.onDidChangeConfigurationEmitter.fire({\n\t\taffectsConfiguration: () => true,\n\t\taffectedKeys: ['terminal.integrated.confirmOnKill']\n\t} as unknown as IConfigurationChangeEvent);\n}\n"]}