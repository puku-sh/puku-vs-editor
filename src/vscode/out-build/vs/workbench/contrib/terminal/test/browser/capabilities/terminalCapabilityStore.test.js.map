{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/contrib/terminal/test/browser/capabilities/terminalCapabilityStore.test.ts","vs/workbench/contrib/terminal/test/browser/capabilities/terminalCapabilityStore.test.ts"],"names":[],"mappings":"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","file":"terminalCapabilityStore.test.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { deepStrictEqual, strictEqual } from 'assert';\nimport { ensureNoDisposablesAreLeakedInTestSuite } from '../../../../../../base/test/common/utils.js';\nimport { TerminalCapability, type ICommandDetectionCapability, type ICwdDetectionCapability, type INaiveCwdDetectionCapability, type ITerminalCapabilityStore } from '../../../../../../platform/terminal/common/capabilities/capabilities.js';\nimport { TerminalCapabilityStore, TerminalCapabilityStoreMultiplexer } from '../../../../../../platform/terminal/common/capabilities/terminalCapabilityStore.js';\n\nsuite('TerminalCapabilityStore', () => {\n\tconst store = ensureNoDisposablesAreLeakedInTestSuite();\n\n\tlet capabilityStore: TerminalCapabilityStore;\n\tlet addEvents: TerminalCapability[];\n\tlet removeEvents: TerminalCapability[];\n\n\tsetup(() => {\n\t\tcapabilityStore = store.add(new TerminalCapabilityStore());\n\t\tstore.add(capabilityStore.onDidAddCapability(e => addEvents.push(e.id)));\n\t\tstore.add(capabilityStore.onDidRemoveCapability(e => removeEvents.push(e.id)));\n\t\taddEvents = [];\n\t\tremoveEvents = [];\n\t});\n\n\ttest('should fire events when capabilities are added', () => {\n\t\tassertEvents(addEvents, []);\n\t\tcapabilityStore.add(TerminalCapability.CwdDetection, {} as unknown as ICwdDetectionCapability);\n\t\tassertEvents(addEvents, [TerminalCapability.CwdDetection]);\n\t});\n\ttest('should fire events when capabilities are removed', async () => {\n\t\tassertEvents(removeEvents, []);\n\t\tcapabilityStore.add(TerminalCapability.CwdDetection, {} as unknown as ICwdDetectionCapability);\n\t\tassertEvents(removeEvents, []);\n\t\tcapabilityStore.remove(TerminalCapability.CwdDetection);\n\t\tassertEvents(removeEvents, [TerminalCapability.CwdDetection]);\n\t});\n\ttest('has should return whether a capability is present', () => {\n\t\tdeepStrictEqual(capabilityStore.has(TerminalCapability.CwdDetection), false);\n\t\tcapabilityStore.add(TerminalCapability.CwdDetection, {} as unknown as ICwdDetectionCapability);\n\t\tdeepStrictEqual(capabilityStore.has(TerminalCapability.CwdDetection), true);\n\t\tcapabilityStore.remove(TerminalCapability.CwdDetection);\n\t\tdeepStrictEqual(capabilityStore.has(TerminalCapability.CwdDetection), false);\n\t});\n\ttest('items should reflect current state', () => {\n\t\tdeepStrictEqual(Array.from(capabilityStore.items), []);\n\t\tcapabilityStore.add(TerminalCapability.CwdDetection, {} as unknown as ICwdDetectionCapability);\n\t\tdeepStrictEqual(Array.from(capabilityStore.items), [TerminalCapability.CwdDetection]);\n\t\tcapabilityStore.add(TerminalCapability.NaiveCwdDetection, {} as unknown as INaiveCwdDetectionCapability);\n\t\tdeepStrictEqual(Array.from(capabilityStore.items), [TerminalCapability.CwdDetection, TerminalCapability.NaiveCwdDetection]);\n\t\tcapabilityStore.remove(TerminalCapability.CwdDetection);\n\t\tdeepStrictEqual(Array.from(capabilityStore.items), [TerminalCapability.NaiveCwdDetection]);\n\t});\n\ttest('ensure events are memoized', () => {\n\t\tfor (const getEvent of getDerivedEventGetters(capabilityStore)) {\n\t\t\tstrictEqual(getEvent(), getEvent());\n\t\t}\n\t});\n\ttest('ensure events are cleaned up', () => {\n\t\tfor (const getEvent of getDerivedEventGetters(capabilityStore)) {\n\t\t\tstore.add(getEvent()(() => { }));\n\t\t}\n\t});\n});\n\nsuite('TerminalCapabilityStoreMultiplexer', () => {\n\tconst store = ensureNoDisposablesAreLeakedInTestSuite();\n\n\tlet multiplexer: TerminalCapabilityStoreMultiplexer;\n\tlet store1: TerminalCapabilityStore;\n\tlet store2: TerminalCapabilityStore;\n\tlet addEvents: TerminalCapability[];\n\tlet removeEvents: TerminalCapability[];\n\n\tsetup(() => {\n\t\tmultiplexer = store.add(new TerminalCapabilityStoreMultiplexer());\n\t\tstore.add(multiplexer.onDidAddCapability(e => addEvents.push(e.id)));\n\t\tstore.add(multiplexer.onDidRemoveCapability(e => removeEvents.push(e.id)));\n\t\tstore1 = store.add(new TerminalCapabilityStore());\n\t\tstore2 = store.add(new TerminalCapabilityStore());\n\t\taddEvents = [];\n\t\tremoveEvents = [];\n\t});\n\n\ttest('should fire events when capabilities are enabled', async () => {\n\t\tassertEvents(addEvents, []);\n\t\tmultiplexer.add(store1);\n\t\tmultiplexer.add(store2);\n\t\tstore1.add(TerminalCapability.CwdDetection, {} as unknown as ICwdDetectionCapability);\n\t\tassertEvents(addEvents, [TerminalCapability.CwdDetection]);\n\t\tstore2.add(TerminalCapability.NaiveCwdDetection, {} as unknown as INaiveCwdDetectionCapability);\n\t\tassertEvents(addEvents, [TerminalCapability.NaiveCwdDetection]);\n\t});\n\ttest('should fire events when capabilities are disabled', async () => {\n\t\tassertEvents(removeEvents, []);\n\t\tmultiplexer.add(store1);\n\t\tmultiplexer.add(store2);\n\t\tstore1.add(TerminalCapability.CwdDetection, {} as unknown as ICwdDetectionCapability);\n\t\tstore2.add(TerminalCapability.NaiveCwdDetection, {} as unknown as INaiveCwdDetectionCapability);\n\t\tassertEvents(removeEvents, []);\n\t\tstore1.remove(TerminalCapability.CwdDetection);\n\t\tassertEvents(removeEvents, [TerminalCapability.CwdDetection]);\n\t\tstore2.remove(TerminalCapability.NaiveCwdDetection);\n\t\tassertEvents(removeEvents, [TerminalCapability.NaiveCwdDetection]);\n\t});\n\ttest('should fire events when stores are added', async () => {\n\t\tassertEvents(addEvents, []);\n\t\tstore1.add(TerminalCapability.CwdDetection, {} as unknown as ICwdDetectionCapability);\n\t\tassertEvents(addEvents, []);\n\t\tstore2.add(TerminalCapability.NaiveCwdDetection, {} as unknown as INaiveCwdDetectionCapability);\n\t\tmultiplexer.add(store1);\n\t\tmultiplexer.add(store2);\n\t\tassertEvents(addEvents, [TerminalCapability.CwdDetection, TerminalCapability.NaiveCwdDetection]);\n\t});\n\ttest('items should return items from all stores', () => {\n\t\tdeepStrictEqual(Array.from(multiplexer.items).sort(), [].sort());\n\t\tmultiplexer.add(store1);\n\t\tmultiplexer.add(store2);\n\t\tstore1.add(TerminalCapability.CwdDetection, {} as unknown as ICwdDetectionCapability);\n\t\tdeepStrictEqual(Array.from(multiplexer.items).sort(), [TerminalCapability.CwdDetection].sort());\n\t\tstore1.add(TerminalCapability.CommandDetection, {} as unknown as ICommandDetectionCapability);\n\t\tstore2.add(TerminalCapability.NaiveCwdDetection, {} as unknown as INaiveCwdDetectionCapability);\n\t\tdeepStrictEqual(Array.from(multiplexer.items).sort(), [TerminalCapability.CwdDetection, TerminalCapability.CommandDetection, TerminalCapability.NaiveCwdDetection].sort());\n\t\tstore2.remove(TerminalCapability.NaiveCwdDetection);\n\t\tdeepStrictEqual(Array.from(multiplexer.items).sort(), [TerminalCapability.CwdDetection, TerminalCapability.CommandDetection].sort());\n\t});\n\ttest('has should return whether a capability is present', () => {\n\t\tdeepStrictEqual(multiplexer.has(TerminalCapability.CwdDetection), false);\n\t\tmultiplexer.add(store1);\n\t\tstore1.add(TerminalCapability.CwdDetection, {} as unknown as ICwdDetectionCapability);\n\t\tdeepStrictEqual(multiplexer.has(TerminalCapability.CwdDetection), true);\n\t\tstore1.remove(TerminalCapability.CwdDetection);\n\t\tdeepStrictEqual(multiplexer.has(TerminalCapability.CwdDetection), false);\n\t});\n\ttest('ensure events are memoized', () => {\n\t\tfor (const getEvent of getDerivedEventGetters(multiplexer)) {\n\t\t\tstrictEqual(getEvent(), getEvent());\n\t\t}\n\t});\n\ttest('ensure events are cleaned up', () => {\n\t\tfor (const getEvent of getDerivedEventGetters(multiplexer)) {\n\t\t\tstore.add(getEvent()(() => { }));\n\t\t}\n\t});\n});\n\nfunction assertEvents(actual: TerminalCapability[], expected: TerminalCapability[]) {\n\tdeepStrictEqual(actual, expected);\n\tactual.length = 0;\n}\n\nfunction getDerivedEventGetters(capabilityStore: ITerminalCapabilityStore) {\n\treturn [\n\t\t() => capabilityStore.onDidChangeCapabilities,\n\t\t() => capabilityStore.onDidAddCommandDetectionCapability,\n\t\t() => capabilityStore.onDidRemoveCommandDetectionCapability,\n\t\t() => capabilityStore.onDidAddCwdDetectionCapability,\n\t\t() => capabilityStore.onDidRemoveCwdDetectionCapability,\n\t];\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { deepStrictEqual, strictEqual } from 'assert';\nimport { ensureNoDisposablesAreLeakedInTestSuite } from '../../../../../../base/test/common/utils.js';\nimport { TerminalCapability, type ICommandDetectionCapability, type ICwdDetectionCapability, type INaiveCwdDetectionCapability, type ITerminalCapabilityStore } from '../../../../../../platform/terminal/common/capabilities/capabilities.js';\nimport { TerminalCapabilityStore, TerminalCapabilityStoreMultiplexer } from '../../../../../../platform/terminal/common/capabilities/terminalCapabilityStore.js';\n\nsuite('TerminalCapabilityStore', () => {\n\tconst store = ensureNoDisposablesAreLeakedInTestSuite();\n\n\tlet capabilityStore: TerminalCapabilityStore;\n\tlet addEvents: TerminalCapability[];\n\tlet removeEvents: TerminalCapability[];\n\n\tsetup(() => {\n\t\tcapabilityStore = store.add(new TerminalCapabilityStore());\n\t\tstore.add(capabilityStore.onDidAddCapability(e => addEvents.push(e.id)));\n\t\tstore.add(capabilityStore.onDidRemoveCapability(e => removeEvents.push(e.id)));\n\t\taddEvents = [];\n\t\tremoveEvents = [];\n\t});\n\n\ttest('should fire events when capabilities are added', () => {\n\t\tassertEvents(addEvents, []);\n\t\tcapabilityStore.add(TerminalCapability.CwdDetection, {} as unknown as ICwdDetectionCapability);\n\t\tassertEvents(addEvents, [TerminalCapability.CwdDetection]);\n\t});\n\ttest('should fire events when capabilities are removed', async () => {\n\t\tassertEvents(removeEvents, []);\n\t\tcapabilityStore.add(TerminalCapability.CwdDetection, {} as unknown as ICwdDetectionCapability);\n\t\tassertEvents(removeEvents, []);\n\t\tcapabilityStore.remove(TerminalCapability.CwdDetection);\n\t\tassertEvents(removeEvents, [TerminalCapability.CwdDetection]);\n\t});\n\ttest('has should return whether a capability is present', () => {\n\t\tdeepStrictEqual(capabilityStore.has(TerminalCapability.CwdDetection), false);\n\t\tcapabilityStore.add(TerminalCapability.CwdDetection, {} as unknown as ICwdDetectionCapability);\n\t\tdeepStrictEqual(capabilityStore.has(TerminalCapability.CwdDetection), true);\n\t\tcapabilityStore.remove(TerminalCapability.CwdDetection);\n\t\tdeepStrictEqual(capabilityStore.has(TerminalCapability.CwdDetection), false);\n\t});\n\ttest('items should reflect current state', () => {\n\t\tdeepStrictEqual(Array.from(capabilityStore.items), []);\n\t\tcapabilityStore.add(TerminalCapability.CwdDetection, {} as unknown as ICwdDetectionCapability);\n\t\tdeepStrictEqual(Array.from(capabilityStore.items), [TerminalCapability.CwdDetection]);\n\t\tcapabilityStore.add(TerminalCapability.NaiveCwdDetection, {} as unknown as INaiveCwdDetectionCapability);\n\t\tdeepStrictEqual(Array.from(capabilityStore.items), [TerminalCapability.CwdDetection, TerminalCapability.NaiveCwdDetection]);\n\t\tcapabilityStore.remove(TerminalCapability.CwdDetection);\n\t\tdeepStrictEqual(Array.from(capabilityStore.items), [TerminalCapability.NaiveCwdDetection]);\n\t});\n\ttest('ensure events are memoized', () => {\n\t\tfor (const getEvent of getDerivedEventGetters(capabilityStore)) {\n\t\t\tstrictEqual(getEvent(), getEvent());\n\t\t}\n\t});\n\ttest('ensure events are cleaned up', () => {\n\t\tfor (const getEvent of getDerivedEventGetters(capabilityStore)) {\n\t\t\tstore.add(getEvent()(() => { }));\n\t\t}\n\t});\n});\n\nsuite('TerminalCapabilityStoreMultiplexer', () => {\n\tconst store = ensureNoDisposablesAreLeakedInTestSuite();\n\n\tlet multiplexer: TerminalCapabilityStoreMultiplexer;\n\tlet store1: TerminalCapabilityStore;\n\tlet store2: TerminalCapabilityStore;\n\tlet addEvents: TerminalCapability[];\n\tlet removeEvents: TerminalCapability[];\n\n\tsetup(() => {\n\t\tmultiplexer = store.add(new TerminalCapabilityStoreMultiplexer());\n\t\tstore.add(multiplexer.onDidAddCapability(e => addEvents.push(e.id)));\n\t\tstore.add(multiplexer.onDidRemoveCapability(e => removeEvents.push(e.id)));\n\t\tstore1 = store.add(new TerminalCapabilityStore());\n\t\tstore2 = store.add(new TerminalCapabilityStore());\n\t\taddEvents = [];\n\t\tremoveEvents = [];\n\t});\n\n\ttest('should fire events when capabilities are enabled', async () => {\n\t\tassertEvents(addEvents, []);\n\t\tmultiplexer.add(store1);\n\t\tmultiplexer.add(store2);\n\t\tstore1.add(TerminalCapability.CwdDetection, {} as unknown as ICwdDetectionCapability);\n\t\tassertEvents(addEvents, [TerminalCapability.CwdDetection]);\n\t\tstore2.add(TerminalCapability.NaiveCwdDetection, {} as unknown as INaiveCwdDetectionCapability);\n\t\tassertEvents(addEvents, [TerminalCapability.NaiveCwdDetection]);\n\t});\n\ttest('should fire events when capabilities are disabled', async () => {\n\t\tassertEvents(removeEvents, []);\n\t\tmultiplexer.add(store1);\n\t\tmultiplexer.add(store2);\n\t\tstore1.add(TerminalCapability.CwdDetection, {} as unknown as ICwdDetectionCapability);\n\t\tstore2.add(TerminalCapability.NaiveCwdDetection, {} as unknown as INaiveCwdDetectionCapability);\n\t\tassertEvents(removeEvents, []);\n\t\tstore1.remove(TerminalCapability.CwdDetection);\n\t\tassertEvents(removeEvents, [TerminalCapability.CwdDetection]);\n\t\tstore2.remove(TerminalCapability.NaiveCwdDetection);\n\t\tassertEvents(removeEvents, [TerminalCapability.NaiveCwdDetection]);\n\t});\n\ttest('should fire events when stores are added', async () => {\n\t\tassertEvents(addEvents, []);\n\t\tstore1.add(TerminalCapability.CwdDetection, {} as unknown as ICwdDetectionCapability);\n\t\tassertEvents(addEvents, []);\n\t\tstore2.add(TerminalCapability.NaiveCwdDetection, {} as unknown as INaiveCwdDetectionCapability);\n\t\tmultiplexer.add(store1);\n\t\tmultiplexer.add(store2);\n\t\tassertEvents(addEvents, [TerminalCapability.CwdDetection, TerminalCapability.NaiveCwdDetection]);\n\t});\n\ttest('items should return items from all stores', () => {\n\t\tdeepStrictEqual(Array.from(multiplexer.items).sort(), [].sort());\n\t\tmultiplexer.add(store1);\n\t\tmultiplexer.add(store2);\n\t\tstore1.add(TerminalCapability.CwdDetection, {} as unknown as ICwdDetectionCapability);\n\t\tdeepStrictEqual(Array.from(multiplexer.items).sort(), [TerminalCapability.CwdDetection].sort());\n\t\tstore1.add(TerminalCapability.CommandDetection, {} as unknown as ICommandDetectionCapability);\n\t\tstore2.add(TerminalCapability.NaiveCwdDetection, {} as unknown as INaiveCwdDetectionCapability);\n\t\tdeepStrictEqual(Array.from(multiplexer.items).sort(), [TerminalCapability.CwdDetection, TerminalCapability.CommandDetection, TerminalCapability.NaiveCwdDetection].sort());\n\t\tstore2.remove(TerminalCapability.NaiveCwdDetection);\n\t\tdeepStrictEqual(Array.from(multiplexer.items).sort(), [TerminalCapability.CwdDetection, TerminalCapability.CommandDetection].sort());\n\t});\n\ttest('has should return whether a capability is present', () => {\n\t\tdeepStrictEqual(multiplexer.has(TerminalCapability.CwdDetection), false);\n\t\tmultiplexer.add(store1);\n\t\tstore1.add(TerminalCapability.CwdDetection, {} as unknown as ICwdDetectionCapability);\n\t\tdeepStrictEqual(multiplexer.has(TerminalCapability.CwdDetection), true);\n\t\tstore1.remove(TerminalCapability.CwdDetection);\n\t\tdeepStrictEqual(multiplexer.has(TerminalCapability.CwdDetection), false);\n\t});\n\ttest('ensure events are memoized', () => {\n\t\tfor (const getEvent of getDerivedEventGetters(multiplexer)) {\n\t\t\tstrictEqual(getEvent(), getEvent());\n\t\t}\n\t});\n\ttest('ensure events are cleaned up', () => {\n\t\tfor (const getEvent of getDerivedEventGetters(multiplexer)) {\n\t\t\tstore.add(getEvent()(() => { }));\n\t\t}\n\t});\n});\n\nfunction assertEvents(actual: TerminalCapability[], expected: TerminalCapability[]) {\n\tdeepStrictEqual(actual, expected);\n\tactual.length = 0;\n}\n\nfunction getDerivedEventGetters(capabilityStore: ITerminalCapabilityStore) {\n\treturn [\n\t\t() => capabilityStore.onDidChangeCapabilities,\n\t\t() => capabilityStore.onDidAddCommandDetectionCapability,\n\t\t() => capabilityStore.onDidRemoveCommandDetectionCapability,\n\t\t() => capabilityStore.onDidAddCwdDetectionCapability,\n\t\t() => capabilityStore.onDidRemoveCwdDetectionCapability,\n\t];\n}\n"]}