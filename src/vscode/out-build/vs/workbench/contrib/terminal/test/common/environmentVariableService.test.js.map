{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/contrib/terminal/test/common/environmentVariableService.test.ts","vs/workbench/contrib/terminal/test/common/environmentVariableService.test.ts"],"names":[],"mappings":"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","file":"environmentVariableService.test.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { deepStrictEqual } from 'assert';\nimport { TestExtensionService, TestHistoryService, TestStorageService } from '../../../../test/common/workbenchTestServices.js';\nimport { EnvironmentVariableService } from '../../common/environmentVariableService.js';\nimport { EnvironmentVariableMutatorType, IEnvironmentVariableMutator } from '../../../../../platform/terminal/common/environmentVariable.js';\nimport { IStorageService } from '../../../../../platform/storage/common/storage.js';\nimport { TestInstantiationService } from '../../../../../platform/instantiation/test/common/instantiationServiceMock.js';\nimport { IExtensionService } from '../../../../services/extensions/common/extensions.js';\nimport { Emitter } from '../../../../../base/common/event.js';\nimport { IProcessEnvironment } from '../../../../../base/common/platform.js';\nimport { IHistoryService } from '../../../../services/history/common/history.js';\nimport { URI } from '../../../../../base/common/uri.js';\nimport { ensureNoDisposablesAreLeakedInTestSuite } from '../../../../../base/test/common/utils.js';\n\nclass TestEnvironmentVariableService extends EnvironmentVariableService {\n\tpersistCollections(): void { this._persistCollections(); }\n\tnotifyCollectionUpdates(): void { this._notifyCollectionUpdates(); }\n}\n\nsuite('EnvironmentVariable - EnvironmentVariableService', () => {\n\tconst store = ensureNoDisposablesAreLeakedInTestSuite();\n\n\tlet instantiationService: TestInstantiationService;\n\tlet environmentVariableService: TestEnvironmentVariableService;\n\tlet changeExtensionsEvent: Emitter<void>;\n\n\tsetup(() => {\n\t\tchangeExtensionsEvent = store.add(new Emitter<void>());\n\n\t\tinstantiationService = store.add(new TestInstantiationService());\n\t\tinstantiationService.stub(IExtensionService, TestExtensionService);\n\t\tinstantiationService.stub(IStorageService, store.add(new TestStorageService()));\n\t\tinstantiationService.stub(IHistoryService, new TestHistoryService());\n\t\tinstantiationService.stub(IExtensionService, TestExtensionService);\n\t\tinstantiationService.stub(IExtensionService, 'onDidChangeExtensions', changeExtensionsEvent.event);\n\t\tinstantiationService.stub(IExtensionService, 'extensions', [\n\t\t\t{ identifier: { value: 'ext1' } },\n\t\t\t{ identifier: { value: 'ext2' } },\n\t\t\t{ identifier: { value: 'ext3' } }\n\t\t]);\n\n\t\tenvironmentVariableService = store.add(instantiationService.createInstance(TestEnvironmentVariableService));\n\t});\n\n\ttest('should persist collections to the storage service and be able to restore from them', () => {\n\t\tconst collection = new Map<string, IEnvironmentVariableMutator>();\n\t\tcollection.set('A-key', { value: 'a', type: EnvironmentVariableMutatorType.Replace, variable: 'A' });\n\t\tcollection.set('B-key', { value: 'b', type: EnvironmentVariableMutatorType.Append, variable: 'B' });\n\t\tcollection.set('C-key', { value: 'c', type: EnvironmentVariableMutatorType.Prepend, variable: 'C', options: { applyAtProcessCreation: true, applyAtShellIntegration: true } });\n\t\tenvironmentVariableService.set('ext1', { map: collection, persistent: true });\n\t\tdeepStrictEqual([...environmentVariableService.mergedCollection.getVariableMap(undefined).entries()], [\n\t\t\t['A', [{ extensionIdentifier: 'ext1', type: EnvironmentVariableMutatorType.Replace, value: 'a', variable: 'A', options: undefined }]],\n\t\t\t['B', [{ extensionIdentifier: 'ext1', type: EnvironmentVariableMutatorType.Append, value: 'b', variable: 'B', options: undefined }]],\n\t\t\t['C', [{ extensionIdentifier: 'ext1', type: EnvironmentVariableMutatorType.Prepend, value: 'c', variable: 'C', options: { applyAtProcessCreation: true, applyAtShellIntegration: true } }]]\n\t\t]);\n\n\t\t// Persist with old service, create a new service with the same storage service to verify restore\n\t\tenvironmentVariableService.persistCollections();\n\t\tconst service2: TestEnvironmentVariableService = store.add(instantiationService.createInstance(TestEnvironmentVariableService));\n\t\tdeepStrictEqual([...service2.mergedCollection.getVariableMap(undefined).entries()], [\n\t\t\t['A', [{ extensionIdentifier: 'ext1', type: EnvironmentVariableMutatorType.Replace, value: 'a', variable: 'A', options: undefined }]],\n\t\t\t['B', [{ extensionIdentifier: 'ext1', type: EnvironmentVariableMutatorType.Append, value: 'b', variable: 'B', options: undefined }]],\n\t\t\t['C', [{ extensionIdentifier: 'ext1', type: EnvironmentVariableMutatorType.Prepend, value: 'c', variable: 'C', options: { applyAtProcessCreation: true, applyAtShellIntegration: true } }]]\n\t\t]);\n\t});\n\n\tsuite('mergedCollection', () => {\n\t\ttest('should overwrite any other variable with the first extension that replaces', () => {\n\t\t\tconst collection1 = new Map<string, IEnvironmentVariableMutator>();\n\t\t\tconst collection2 = new Map<string, IEnvironmentVariableMutator>();\n\t\t\tconst collection3 = new Map<string, IEnvironmentVariableMutator>();\n\t\t\tcollection1.set('A-key', { value: 'a1', type: EnvironmentVariableMutatorType.Append, variable: 'A' });\n\t\t\tcollection1.set('B-key', { value: 'b1', type: EnvironmentVariableMutatorType.Replace, variable: 'B' });\n\t\t\tcollection2.set('A-key', { value: 'a2', type: EnvironmentVariableMutatorType.Replace, variable: 'A' });\n\t\t\tcollection2.set('B-key', { value: 'b2', type: EnvironmentVariableMutatorType.Append, variable: 'B' });\n\t\t\tcollection3.set('A-key', { value: 'a3', type: EnvironmentVariableMutatorType.Prepend, variable: 'A' });\n\t\t\tcollection3.set('B-key', { value: 'b3', type: EnvironmentVariableMutatorType.Replace, variable: 'B' });\n\t\t\tenvironmentVariableService.set('ext1', { map: collection1, persistent: true });\n\t\t\tenvironmentVariableService.set('ext2', { map: collection2, persistent: true });\n\t\t\tenvironmentVariableService.set('ext3', { map: collection3, persistent: true });\n\t\t\tdeepStrictEqual([...environmentVariableService.mergedCollection.getVariableMap(undefined).entries()], [\n\t\t\t\t['A', [\n\t\t\t\t\t{ extensionIdentifier: 'ext2', type: EnvironmentVariableMutatorType.Replace, value: 'a2', variable: 'A', options: undefined },\n\t\t\t\t\t{ extensionIdentifier: 'ext1', type: EnvironmentVariableMutatorType.Append, value: 'a1', variable: 'A', options: undefined }\n\t\t\t\t]],\n\t\t\t\t['B', [{ extensionIdentifier: 'ext1', type: EnvironmentVariableMutatorType.Replace, value: 'b1', variable: 'B', options: undefined }]]\n\t\t\t]);\n\t\t});\n\n\t\ttest('should correctly apply the environment values from multiple extension contributions in the correct order', async () => {\n\t\t\tconst collection1 = new Map<string, IEnvironmentVariableMutator>();\n\t\t\tconst collection2 = new Map<string, IEnvironmentVariableMutator>();\n\t\t\tconst collection3 = new Map<string, IEnvironmentVariableMutator>();\n\t\t\tcollection1.set('A-key', { value: ':a1', type: EnvironmentVariableMutatorType.Append, variable: 'A' });\n\t\t\tcollection2.set('A-key', { value: 'a2:', type: EnvironmentVariableMutatorType.Prepend, variable: 'A' });\n\t\t\tcollection3.set('A-key', { value: 'a3', type: EnvironmentVariableMutatorType.Replace, variable: 'A' });\n\t\t\tenvironmentVariableService.set('ext1', { map: collection1, persistent: true });\n\t\t\tenvironmentVariableService.set('ext2', { map: collection2, persistent: true });\n\t\t\tenvironmentVariableService.set('ext3', { map: collection3, persistent: true });\n\n\t\t\t// The entries should be ordered in the order they are applied\n\t\t\tdeepStrictEqual([...environmentVariableService.mergedCollection.getVariableMap(undefined).entries()], [\n\t\t\t\t['A', [\n\t\t\t\t\t{ extensionIdentifier: 'ext3', type: EnvironmentVariableMutatorType.Replace, value: 'a3', variable: 'A', options: undefined },\n\t\t\t\t\t{ extensionIdentifier: 'ext2', type: EnvironmentVariableMutatorType.Prepend, value: 'a2:', variable: 'A', options: undefined },\n\t\t\t\t\t{ extensionIdentifier: 'ext1', type: EnvironmentVariableMutatorType.Append, value: ':a1', variable: 'A', options: undefined }\n\t\t\t\t]]\n\t\t\t]);\n\n\t\t\t// Verify the entries get applied to the environment as expected\n\t\t\tconst env: IProcessEnvironment = { A: 'foo' };\n\t\t\tawait environmentVariableService.mergedCollection.applyToProcessEnvironment(env, undefined);\n\t\t\tdeepStrictEqual(env, { A: 'a2:a3:a1' });\n\t\t});\n\n\t\ttest('should correctly apply the workspace specific environment values from multiple extension contributions in the correct order', async () => {\n\t\t\tconst scope1 = { workspaceFolder: { uri: URI.file('workspace1'), name: 'workspace1', index: 0 } };\n\t\t\tconst scope2 = { workspaceFolder: { uri: URI.file('workspace2'), name: 'workspace2', index: 3 } };\n\t\t\tconst collection1 = new Map<string, IEnvironmentVariableMutator>();\n\t\t\tconst collection2 = new Map<string, IEnvironmentVariableMutator>();\n\t\t\tconst collection3 = new Map<string, IEnvironmentVariableMutator>();\n\t\t\tcollection1.set('A-key', { value: ':a1', type: EnvironmentVariableMutatorType.Append, scope: scope1, variable: 'A' });\n\t\t\tcollection2.set('A-key', { value: 'a2:', type: EnvironmentVariableMutatorType.Prepend, variable: 'A' });\n\t\t\tcollection3.set('A-key', { value: 'a3', type: EnvironmentVariableMutatorType.Replace, scope: scope2, variable: 'A' });\n\t\t\tenvironmentVariableService.set('ext1', { map: collection1, persistent: true });\n\t\t\tenvironmentVariableService.set('ext2', { map: collection2, persistent: true });\n\t\t\tenvironmentVariableService.set('ext3', { map: collection3, persistent: true });\n\n\t\t\t// The entries should be ordered in the order they are applied\n\t\t\tdeepStrictEqual([...environmentVariableService.mergedCollection.getVariableMap(scope1).entries()], [\n\t\t\t\t['A', [\n\t\t\t\t\t{ extensionIdentifier: 'ext2', type: EnvironmentVariableMutatorType.Prepend, value: 'a2:', variable: 'A', options: undefined },\n\t\t\t\t\t{ extensionIdentifier: 'ext1', type: EnvironmentVariableMutatorType.Append, value: ':a1', scope: scope1, variable: 'A', options: undefined }\n\t\t\t\t]]\n\t\t\t]);\n\n\t\t\t// Verify the entries get applied to the environment as expected\n\t\t\tconst env: IProcessEnvironment = { A: 'foo' };\n\t\t\tawait environmentVariableService.mergedCollection.applyToProcessEnvironment(env, scope1);\n\t\t\tdeepStrictEqual(env, { A: 'a2:foo:a1' });\n\t\t});\n\t});\n});\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { deepStrictEqual } from 'assert';\nimport { TestExtensionService, TestHistoryService, TestStorageService } from '../../../../test/common/workbenchTestServices.js';\nimport { EnvironmentVariableService } from '../../common/environmentVariableService.js';\nimport { EnvironmentVariableMutatorType, IEnvironmentVariableMutator } from '../../../../../platform/terminal/common/environmentVariable.js';\nimport { IStorageService } from '../../../../../platform/storage/common/storage.js';\nimport { TestInstantiationService } from '../../../../../platform/instantiation/test/common/instantiationServiceMock.js';\nimport { IExtensionService } from '../../../../services/extensions/common/extensions.js';\nimport { Emitter } from '../../../../../base/common/event.js';\nimport { IProcessEnvironment } from '../../../../../base/common/platform.js';\nimport { IHistoryService } from '../../../../services/history/common/history.js';\nimport { URI } from '../../../../../base/common/uri.js';\nimport { ensureNoDisposablesAreLeakedInTestSuite } from '../../../../../base/test/common/utils.js';\n\nclass TestEnvironmentVariableService extends EnvironmentVariableService {\n\tpersistCollections(): void { this._persistCollections(); }\n\tnotifyCollectionUpdates(): void { this._notifyCollectionUpdates(); }\n}\n\nsuite('EnvironmentVariable - EnvironmentVariableService', () => {\n\tconst store = ensureNoDisposablesAreLeakedInTestSuite();\n\n\tlet instantiationService: TestInstantiationService;\n\tlet environmentVariableService: TestEnvironmentVariableService;\n\tlet changeExtensionsEvent: Emitter<void>;\n\n\tsetup(() => {\n\t\tchangeExtensionsEvent = store.add(new Emitter<void>());\n\n\t\tinstantiationService = store.add(new TestInstantiationService());\n\t\tinstantiationService.stub(IExtensionService, TestExtensionService);\n\t\tinstantiationService.stub(IStorageService, store.add(new TestStorageService()));\n\t\tinstantiationService.stub(IHistoryService, new TestHistoryService());\n\t\tinstantiationService.stub(IExtensionService, TestExtensionService);\n\t\tinstantiationService.stub(IExtensionService, 'onDidChangeExtensions', changeExtensionsEvent.event);\n\t\tinstantiationService.stub(IExtensionService, 'extensions', [\n\t\t\t{ identifier: { value: 'ext1' } },\n\t\t\t{ identifier: { value: 'ext2' } },\n\t\t\t{ identifier: { value: 'ext3' } }\n\t\t]);\n\n\t\tenvironmentVariableService = store.add(instantiationService.createInstance(TestEnvironmentVariableService));\n\t});\n\n\ttest('should persist collections to the storage service and be able to restore from them', () => {\n\t\tconst collection = new Map<string, IEnvironmentVariableMutator>();\n\t\tcollection.set('A-key', { value: 'a', type: EnvironmentVariableMutatorType.Replace, variable: 'A' });\n\t\tcollection.set('B-key', { value: 'b', type: EnvironmentVariableMutatorType.Append, variable: 'B' });\n\t\tcollection.set('C-key', { value: 'c', type: EnvironmentVariableMutatorType.Prepend, variable: 'C', options: { applyAtProcessCreation: true, applyAtShellIntegration: true } });\n\t\tenvironmentVariableService.set('ext1', { map: collection, persistent: true });\n\t\tdeepStrictEqual([...environmentVariableService.mergedCollection.getVariableMap(undefined).entries()], [\n\t\t\t['A', [{ extensionIdentifier: 'ext1', type: EnvironmentVariableMutatorType.Replace, value: 'a', variable: 'A', options: undefined }]],\n\t\t\t['B', [{ extensionIdentifier: 'ext1', type: EnvironmentVariableMutatorType.Append, value: 'b', variable: 'B', options: undefined }]],\n\t\t\t['C', [{ extensionIdentifier: 'ext1', type: EnvironmentVariableMutatorType.Prepend, value: 'c', variable: 'C', options: { applyAtProcessCreation: true, applyAtShellIntegration: true } }]]\n\t\t]);\n\n\t\t// Persist with old service, create a new service with the same storage service to verify restore\n\t\tenvironmentVariableService.persistCollections();\n\t\tconst service2: TestEnvironmentVariableService = store.add(instantiationService.createInstance(TestEnvironmentVariableService));\n\t\tdeepStrictEqual([...service2.mergedCollection.getVariableMap(undefined).entries()], [\n\t\t\t['A', [{ extensionIdentifier: 'ext1', type: EnvironmentVariableMutatorType.Replace, value: 'a', variable: 'A', options: undefined }]],\n\t\t\t['B', [{ extensionIdentifier: 'ext1', type: EnvironmentVariableMutatorType.Append, value: 'b', variable: 'B', options: undefined }]],\n\t\t\t['C', [{ extensionIdentifier: 'ext1', type: EnvironmentVariableMutatorType.Prepend, value: 'c', variable: 'C', options: { applyAtProcessCreation: true, applyAtShellIntegration: true } }]]\n\t\t]);\n\t});\n\n\tsuite('mergedCollection', () => {\n\t\ttest('should overwrite any other variable with the first extension that replaces', () => {\n\t\t\tconst collection1 = new Map<string, IEnvironmentVariableMutator>();\n\t\t\tconst collection2 = new Map<string, IEnvironmentVariableMutator>();\n\t\t\tconst collection3 = new Map<string, IEnvironmentVariableMutator>();\n\t\t\tcollection1.set('A-key', { value: 'a1', type: EnvironmentVariableMutatorType.Append, variable: 'A' });\n\t\t\tcollection1.set('B-key', { value: 'b1', type: EnvironmentVariableMutatorType.Replace, variable: 'B' });\n\t\t\tcollection2.set('A-key', { value: 'a2', type: EnvironmentVariableMutatorType.Replace, variable: 'A' });\n\t\t\tcollection2.set('B-key', { value: 'b2', type: EnvironmentVariableMutatorType.Append, variable: 'B' });\n\t\t\tcollection3.set('A-key', { value: 'a3', type: EnvironmentVariableMutatorType.Prepend, variable: 'A' });\n\t\t\tcollection3.set('B-key', { value: 'b3', type: EnvironmentVariableMutatorType.Replace, variable: 'B' });\n\t\t\tenvironmentVariableService.set('ext1', { map: collection1, persistent: true });\n\t\t\tenvironmentVariableService.set('ext2', { map: collection2, persistent: true });\n\t\t\tenvironmentVariableService.set('ext3', { map: collection3, persistent: true });\n\t\t\tdeepStrictEqual([...environmentVariableService.mergedCollection.getVariableMap(undefined).entries()], [\n\t\t\t\t['A', [\n\t\t\t\t\t{ extensionIdentifier: 'ext2', type: EnvironmentVariableMutatorType.Replace, value: 'a2', variable: 'A', options: undefined },\n\t\t\t\t\t{ extensionIdentifier: 'ext1', type: EnvironmentVariableMutatorType.Append, value: 'a1', variable: 'A', options: undefined }\n\t\t\t\t]],\n\t\t\t\t['B', [{ extensionIdentifier: 'ext1', type: EnvironmentVariableMutatorType.Replace, value: 'b1', variable: 'B', options: undefined }]]\n\t\t\t]);\n\t\t});\n\n\t\ttest('should correctly apply the environment values from multiple extension contributions in the correct order', async () => {\n\t\t\tconst collection1 = new Map<string, IEnvironmentVariableMutator>();\n\t\t\tconst collection2 = new Map<string, IEnvironmentVariableMutator>();\n\t\t\tconst collection3 = new Map<string, IEnvironmentVariableMutator>();\n\t\t\tcollection1.set('A-key', { value: ':a1', type: EnvironmentVariableMutatorType.Append, variable: 'A' });\n\t\t\tcollection2.set('A-key', { value: 'a2:', type: EnvironmentVariableMutatorType.Prepend, variable: 'A' });\n\t\t\tcollection3.set('A-key', { value: 'a3', type: EnvironmentVariableMutatorType.Replace, variable: 'A' });\n\t\t\tenvironmentVariableService.set('ext1', { map: collection1, persistent: true });\n\t\t\tenvironmentVariableService.set('ext2', { map: collection2, persistent: true });\n\t\t\tenvironmentVariableService.set('ext3', { map: collection3, persistent: true });\n\n\t\t\t// The entries should be ordered in the order they are applied\n\t\t\tdeepStrictEqual([...environmentVariableService.mergedCollection.getVariableMap(undefined).entries()], [\n\t\t\t\t['A', [\n\t\t\t\t\t{ extensionIdentifier: 'ext3', type: EnvironmentVariableMutatorType.Replace, value: 'a3', variable: 'A', options: undefined },\n\t\t\t\t\t{ extensionIdentifier: 'ext2', type: EnvironmentVariableMutatorType.Prepend, value: 'a2:', variable: 'A', options: undefined },\n\t\t\t\t\t{ extensionIdentifier: 'ext1', type: EnvironmentVariableMutatorType.Append, value: ':a1', variable: 'A', options: undefined }\n\t\t\t\t]]\n\t\t\t]);\n\n\t\t\t// Verify the entries get applied to the environment as expected\n\t\t\tconst env: IProcessEnvironment = { A: 'foo' };\n\t\t\tawait environmentVariableService.mergedCollection.applyToProcessEnvironment(env, undefined);\n\t\t\tdeepStrictEqual(env, { A: 'a2:a3:a1' });\n\t\t});\n\n\t\ttest('should correctly apply the workspace specific environment values from multiple extension contributions in the correct order', async () => {\n\t\t\tconst scope1 = { workspaceFolder: { uri: URI.file('workspace1'), name: 'workspace1', index: 0 } };\n\t\t\tconst scope2 = { workspaceFolder: { uri: URI.file('workspace2'), name: 'workspace2', index: 3 } };\n\t\t\tconst collection1 = new Map<string, IEnvironmentVariableMutator>();\n\t\t\tconst collection2 = new Map<string, IEnvironmentVariableMutator>();\n\t\t\tconst collection3 = new Map<string, IEnvironmentVariableMutator>();\n\t\t\tcollection1.set('A-key', { value: ':a1', type: EnvironmentVariableMutatorType.Append, scope: scope1, variable: 'A' });\n\t\t\tcollection2.set('A-key', { value: 'a2:', type: EnvironmentVariableMutatorType.Prepend, variable: 'A' });\n\t\t\tcollection3.set('A-key', { value: 'a3', type: EnvironmentVariableMutatorType.Replace, scope: scope2, variable: 'A' });\n\t\t\tenvironmentVariableService.set('ext1', { map: collection1, persistent: true });\n\t\t\tenvironmentVariableService.set('ext2', { map: collection2, persistent: true });\n\t\t\tenvironmentVariableService.set('ext3', { map: collection3, persistent: true });\n\n\t\t\t// The entries should be ordered in the order they are applied\n\t\t\tdeepStrictEqual([...environmentVariableService.mergedCollection.getVariableMap(scope1).entries()], [\n\t\t\t\t['A', [\n\t\t\t\t\t{ extensionIdentifier: 'ext2', type: EnvironmentVariableMutatorType.Prepend, value: 'a2:', variable: 'A', options: undefined },\n\t\t\t\t\t{ extensionIdentifier: 'ext1', type: EnvironmentVariableMutatorType.Append, value: ':a1', scope: scope1, variable: 'A', options: undefined }\n\t\t\t\t]]\n\t\t\t]);\n\n\t\t\t// Verify the entries get applied to the environment as expected\n\t\t\tconst env: IProcessEnvironment = { A: 'foo' };\n\t\t\tawait environmentVariableService.mergedCollection.applyToProcessEnvironment(env, scope1);\n\t\t\tdeepStrictEqual(env, { A: 'a2:foo:a1' });\n\t\t});\n\t});\n});\n"]}