{"version":3,"sources":["vs/workbench/contrib/terminal/browser/baseTerminalBackend.ts"],"names":[],"mappings":"AAAA;;;gGAGgG;AAEhG,OAAO,EAAE,OAAO,EAAE,MAAM,kCAAkC,CAAC;AAC3D,OAAO,EAAE,UAAU,EAAE,MAAM,sCAAsC,CAAC;AAClE,OAAO,EAAE,OAAO,EAAE,MAAM,oCAAoC,CAAC;AAC7D,OAAO,EAAE,QAAQ,EAAE,QAAQ,EAAE,MAAM,kCAAkC,CAAC;AACtE,OAAO,EAAE,QAAQ,EAAE,MAAM,oBAAoB,CAAC;AAQ9C,MAAM,OAAgB,mBAAoB,SAAQ,UAAU;IAG3D,IAAI,YAAY,KAAc,OAAO,CAAC,IAAI,CAAC,sBAAsB,CAAC,CAAC,CAAC;IAWpE,YACkB,kBAAsC,EACpC,WAAgC,EACnD,cAA+B,EAC/B,4BAA2D,EAC3D,gBAAmC,EAChB,wBAAkD;QAErE,KAAK,EAAE,CAAC;QAPS,uBAAkB,GAAlB,kBAAkB,CAAoB;QACpC,gBAAW,GAAX,WAAW,CAAqB;QAIhC,6BAAwB,GAAxB,wBAAwB,CAA0B;QAnB9D,2BAAsB,GAAY,KAAK,CAAC;QAI7B,wBAAmB,GAAG,IAAI,CAAC,SAAS,CAAC,IAAI,OAAO,EAAQ,CAAC,CAAC;QACpE,uBAAkB,GAAG,IAAI,CAAC,mBAAmB,CAAC,KAAK,CAAC;QAC1C,sBAAiB,GAAG,IAAI,CAAC,SAAS,CAAC,IAAI,OAAO,EAAQ,CAAC,CAAC;QAClE,qBAAgB,GAAG,IAAI,CAAC,iBAAiB,CAAC,KAAK,CAAC;QACtC,2BAAsB,GAAG,IAAI,CAAC,SAAS,CAAC,IAAI,OAAO,EAAQ,CAAC,CAAC;QACvE,0BAAqB,GAAG,IAAI,CAAC,sBAAsB,CAAC,KAAK,CAAC;QAChD,yBAAoB,GAAG,IAAI,CAAC,SAAS,CAAC,IAAI,OAAO,EAAQ,CAAC,CAAC;QACrE,wBAAmB,GAAG,IAAI,CAAC,oBAAoB,CAAC,KAAK,CAAC;QAY9D,IAAI,0BAA2C,CAAC;QAChD,IAAI,iBAA0C,CAAC;QAC/C,IAAI,UAAU,GAAG,KAAK,CAAC;QAEvB,4BAA4B;QAC5B,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,kBAAkB,CAAC,aAAa,CAAC,GAAG,EAAE;YACzD,IAAI,CAAC,WAAW,CAAC,KAAK,CAAC,2FAA2F,CAAC,CAAC;QACrH,CAAC,CAAC,CAAC,CAAC;QACJ,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,kBAAkB,CAAC,GAAG,EAAE,CAAC,UAAU,GAAG,IAAI,CAAC,CAAC,CAAC;QACjE,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,kBAAkB,CAAC,cAAc,CAAC,GAAG,EAAE;YAC1D,IAAI,CAAC,WAAW,CAAC,KAAK,CAAC,6CAA6C,CAAC,CAAC;YACtE,qDAAqD;YACrD,IAAI,UAAU,EAAE,CAAC;gBAChB,IAAI,CAAC,WAAW,CAAC,KAAK,CAAC,qCAAqC,CAAC,CAAC;gBAC9D,IAAI,CAAC,iBAAiB,CAAC,IAAI,EAAE,CAAC;YAC/B,CAAC;YACD,iBAAiB,EAAE,OAAO,EAAE,CAAC;YAC7B,IAAI,CAAC,sBAAsB,GAAG,KAAK,CAAC;QACrC,CAAC,CAAC,CAAC,CAAC;QACJ,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,kBAAkB,CAAC,qBAAqB,CAAC,GAAG,EAAE;YACjE,iBAAiB,EAAE,OAAO,EAAE,CAAC;YAC7B,IAAI,CAAC,0BAA0B,EAAE,CAAC;gBACjC,0BAA0B,GAAG;oBAC5B,IAAI,EAAE,QAAQ,CAAC,KAAe,EAAE,IAAiB,CAAC;oBAClD,IAAI,EAAE,uBAAuB,QAAQ,CAAC,KAAqB,EAAE,IAAU,CAAC,EAAE;oBAC1E,OAAO,EAAE,QAAQ,CAAC,KAAsB,EAAE,IAAwI,CAAC;oBACnL,SAAS,EAAE,QAAQ,CAAC,KAAyB,EAAE,IAA0B,CAAC;oBAC1E,OAAO,mGAAkD;oBACzD,IAAI,EAAE,SAAS;iBACf,CAAC;YACH,CAAC;YACD,iBAAiB,GAAG,gBAAgB,CAAC,QAAQ,CAAC,0BAA0B,EAAE,eAAe,kCAA0B,CAAC;YACpH,IAAI,CAAC,sBAAsB,GAAG,IAAI,CAAC;YACnC,IAAI,CAAC,sBAAsB,CAAC,IAAI,EAAE,CAAC;QACpC,CAAC,CAAC,CAAC,CAAC;QACJ,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,kBAAkB,CAAC,mBAAmB,CAAC,GAAG,EAAE;YAC/D,IAAI,CAAC,IAAI,CAAC,sBAAsB,EAAE,CAAC;gBAClC,OAAO;YACR,CAAC;YACD,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,sCAAsC,CAAC,CAAC;YAC9D,iBAAiB,EAAE,OAAO,EAAE,CAAC;YAC7B,IAAI,CAAC,sBAAsB,GAAG,KAAK,CAAC;YACpC,IAAI,CAAC,oBAAoB,CAAC,IAAI,EAAE,CAAC;QAClC,CAAC,CAAC,CAAC,CAAC;QACJ,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,kBAAkB,CAAC,gCAAgC,CAAC,KAAK,EAAC,CAAC,EAAC,EAAE;YACjF,0CAA0C;YAC1C,IAAI,CAAC,CAAC,WAAW,KAAK,IAAI,CAAC,wBAAwB,CAAC,YAAY,EAAE,CAAC,EAAE,EAAE,CAAC;gBACvE,OAAO;YACR,CAAC;YACD,MAAM,sBAAsB,GAAG,cAAc,CAAC,0BAA0B,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC;YACvF,MAAM,uBAAuB,GAAG,sBAAsB,CAAC,CAAC,CAAC,IAAI,CAAC,wBAAwB,CAAC,kBAAkB,CAAC,sBAAsB,CAAC,IAAI,SAAS,CAAC,CAAC,CAAC,SAAS,CAAC;YAC3J,MAAM,YAAY,GAAsB,CAAC,CAAC,YAAY,CAAC,GAAG,CAAC,CAAC,CAAC,EAAE;gBAC9D,OAAO,4BAA4B,CAAC,YAAY,CAAC,uBAAuB,EAAE,CAAC,CAAC,CAAC;YAC9E,CAAC,CAAC,CAAC;YACH,MAAM,MAAM,GAAG,MAAM,OAAO,CAAC,GAAG,CAAC,YAAY,CAAC,CAAC;YAC/C,IAAI,CAAC,kBAAkB,CAAC,8BAA8B,CAAC,CAAC,CAAC,SAAS,EAAE,MAAM,CAAC,CAAC;QAC7E,CAAC,CAAC,CAAC,CAAC;IACL,CAAC;IAED,cAAc;QACb,IAAI,CAAC,kBAAkB,CAAC,cAAc,EAAE,CAAC;IAC1C,CAAC;IAES,yBAAyB,CAAC,eAAmC;QACtE,IAAI,eAAe,KAAK,SAAS,EAAE,CAAC;YACnC,OAAO,SAAS,CAAC;QAClB,CAAC;QACD,MAAM,iBAAiB,GAAG,IAAI,CAAC,KAAK,CAAC,eAAe,CAAY,CAAC;QACjE,IAAI,CAAC,qCAAqC,CAAC,iBAAiB,CAAC,EAAE,CAAC;YAC/D,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,qDAAqD,EAAE,iBAAiB,CAAC,CAAC;YAChG,OAAO,SAAS,CAAC;QAClB,CAAC;QACD,IAAI,iBAAiB,CAAC,OAAO,KAAK,CAAC,EAAE,CAAC;YACrC,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,yDAAyD,iBAAiB,CAAC,OAAO,GAAG,EAAE,iBAAiB,CAAC,CAAC;YAChI,OAAO,SAAS,CAAC;QAClB,CAAC;QACD,OAAO,iBAAiB,CAAC,KAAmC,CAAC;IAC9D,CAAC;IAES,eAAe;QACxB,OAAO,IAAI,CAAC,wBAAwB,CAAC,YAAY,EAAE,CAAC,EAAE,CAAC;IACxD,CAAC;CACD;AAED,SAAS,qCAAqC,CAAC,GAAY;IAC1D,OAAO,CACN,QAAQ,CAAC,GAAG,CAAC;QACb,SAAS,IAAI,GAAG,IAAI,QAAQ,CAAC,GAAG,CAAC,OAAO,CAAC;QACzC,OAAO,IAAI,GAAG,IAAI,KAAK,CAAC,OAAO,CAAC,GAAG,CAAC,KAAK,CAAC,CAC1C,CAAC;AACH,CAAC","file":"baseTerminalBackend.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Emitter } from '../../../../base/common/event.js';\nimport { Disposable } from '../../../../base/common/lifecycle.js';\nimport { Schemas } from '../../../../base/common/network.js';\nimport { isNumber, isObject } from '../../../../base/common/types.js';\nimport { localize } from '../../../../nls.js';\nimport { ICrossVersionSerializedTerminalState, IPtyHostController, ISerializedTerminalState, ITerminalLogService } from '../../../../platform/terminal/common/terminal.js';\nimport { IWorkspaceContextService } from '../../../../platform/workspace/common/workspace.js';\nimport { IConfigurationResolverService } from '../../../services/configurationResolver/common/configurationResolver.js';\nimport { IHistoryService } from '../../../services/history/common/history.js';\nimport { IStatusbarEntry, IStatusbarEntryAccessor, IStatusbarService, StatusbarAlignment } from '../../../services/statusbar/browser/statusbar.js';\nimport { TerminalContribCommandId } from '../terminalContribExports.js';\n\nexport abstract class BaseTerminalBackend extends Disposable {\n\tprivate _isPtyHostUnresponsive: boolean = false;\n\n\tget isResponsive(): boolean { return !this._isPtyHostUnresponsive; }\n\n\tprotected readonly _onPtyHostConnected = this._register(new Emitter<void>());\n\treadonly onPtyHostConnected = this._onPtyHostConnected.event;\n\tprotected readonly _onPtyHostRestart = this._register(new Emitter<void>());\n\treadonly onPtyHostRestart = this._onPtyHostRestart.event;\n\tprotected readonly _onPtyHostUnresponsive = this._register(new Emitter<void>());\n\treadonly onPtyHostUnresponsive = this._onPtyHostUnresponsive.event;\n\tprotected readonly _onPtyHostResponsive = this._register(new Emitter<void>());\n\treadonly onPtyHostResponsive = this._onPtyHostResponsive.event;\n\n\tconstructor(\n\t\tprivate readonly _ptyHostController: IPtyHostController,\n\t\tprotected readonly _logService: ITerminalLogService,\n\t\thistoryService: IHistoryService,\n\t\tconfigurationResolverService: IConfigurationResolverService,\n\t\tstatusBarService: IStatusbarService,\n\t\tprotected readonly _workspaceContextService: IWorkspaceContextService\n\t) {\n\t\tsuper();\n\n\t\tlet unresponsiveStatusBarEntry: IStatusbarEntry;\n\t\tlet statusBarAccessor: IStatusbarEntryAccessor;\n\t\tlet hasStarted = false;\n\n\t\t// Attach pty host listeners\n\t\tthis._register(this._ptyHostController.onPtyHostExit(() => {\n\t\t\tthis._logService.error(`The terminal's pty host process exited, the connection to all terminal processes was lost`);\n\t\t}));\n\t\tthis._register(this.onPtyHostConnected(() => hasStarted = true));\n\t\tthis._register(this._ptyHostController.onPtyHostStart(() => {\n\t\t\tthis._logService.debug(`The terminal's pty host process is starting`);\n\t\t\t// Only fire the _restart_ event after it has started\n\t\t\tif (hasStarted) {\n\t\t\t\tthis._logService.trace('IPtyHostController#onPtyHostRestart');\n\t\t\t\tthis._onPtyHostRestart.fire();\n\t\t\t}\n\t\t\tstatusBarAccessor?.dispose();\n\t\t\tthis._isPtyHostUnresponsive = false;\n\t\t}));\n\t\tthis._register(this._ptyHostController.onPtyHostUnresponsive(() => {\n\t\t\tstatusBarAccessor?.dispose();\n\t\t\tif (!unresponsiveStatusBarEntry) {\n\t\t\t\tunresponsiveStatusBarEntry = {\n\t\t\t\t\tname: localize('ptyHostStatus', 'Pty Host Status'),\n\t\t\t\t\ttext: `$(debug-disconnect) ${localize('ptyHostStatus.short', 'Pty Host')}`,\n\t\t\t\t\ttooltip: localize('nonResponsivePtyHost', \"The connection to the terminal's pty host process is unresponsive, terminals may stop working. Click to manually restart the pty host.\"),\n\t\t\t\t\tariaLabel: localize('ptyHostStatus.ariaLabel', 'Pty Host is unresponsive'),\n\t\t\t\t\tcommand: TerminalContribCommandId.DeveloperRestartPtyHost,\n\t\t\t\t\tkind: 'warning'\n\t\t\t\t};\n\t\t\t}\n\t\t\tstatusBarAccessor = statusBarService.addEntry(unresponsiveStatusBarEntry, 'ptyHostStatus', StatusbarAlignment.LEFT);\n\t\t\tthis._isPtyHostUnresponsive = true;\n\t\t\tthis._onPtyHostUnresponsive.fire();\n\t\t}));\n\t\tthis._register(this._ptyHostController.onPtyHostResponsive(() => {\n\t\t\tif (!this._isPtyHostUnresponsive) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis._logService.info('The pty host became responsive again');\n\t\t\tstatusBarAccessor?.dispose();\n\t\t\tthis._isPtyHostUnresponsive = false;\n\t\t\tthis._onPtyHostResponsive.fire();\n\t\t}));\n\t\tthis._register(this._ptyHostController.onPtyHostRequestResolveVariables(async e => {\n\t\t\t// Only answer requests for this workspace\n\t\t\tif (e.workspaceId !== this._workspaceContextService.getWorkspace().id) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst activeWorkspaceRootUri = historyService.getLastActiveWorkspaceRoot(Schemas.file);\n\t\t\tconst lastActiveWorkspaceRoot = activeWorkspaceRootUri ? this._workspaceContextService.getWorkspaceFolder(activeWorkspaceRootUri) ?? undefined : undefined;\n\t\t\tconst resolveCalls: Promise<string>[] = e.originalText.map(t => {\n\t\t\t\treturn configurationResolverService.resolveAsync(lastActiveWorkspaceRoot, t);\n\t\t\t});\n\t\t\tconst result = await Promise.all(resolveCalls);\n\t\t\tthis._ptyHostController.acceptPtyHostResolvedVariables(e.requestId, result);\n\t\t}));\n\t}\n\n\trestartPtyHost(): void {\n\t\tthis._ptyHostController.restartPtyHost();\n\t}\n\n\tprotected _deserializeTerminalState(serializedState: string | undefined): ISerializedTerminalState[] | undefined {\n\t\tif (serializedState === undefined) {\n\t\t\treturn undefined;\n\t\t}\n\t\tconst crossVersionState = JSON.parse(serializedState) as unknown;\n\t\tif (!isCrossVersionSerializedTerminalState(crossVersionState)) {\n\t\t\tthis._logService.warn('Could not revive serialized processes, wrong format', crossVersionState);\n\t\t\treturn undefined;\n\t\t}\n\t\tif (crossVersionState.version !== 1) {\n\t\t\tthis._logService.warn(`Could not revive serialized processes, wrong version \"${crossVersionState.version}\"`, crossVersionState);\n\t\t\treturn undefined;\n\t\t}\n\t\treturn crossVersionState.state as ISerializedTerminalState[];\n\t}\n\n\tprotected _getWorkspaceId(): string {\n\t\treturn this._workspaceContextService.getWorkspace().id;\n\t}\n}\n\nfunction isCrossVersionSerializedTerminalState(obj: unknown): obj is ICrossVersionSerializedTerminalState {\n\treturn (\n\t\tisObject(obj) &&\n\t\t'version' in obj && isNumber(obj.version) &&\n\t\t'state' in obj && Array.isArray(obj.state)\n\t);\n}\n"]}