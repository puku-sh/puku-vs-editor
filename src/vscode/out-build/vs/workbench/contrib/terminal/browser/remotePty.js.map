{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/contrib/terminal/browser/remotePty.ts","vs/workbench/contrib/terminal/browser/remotePty.ts"],"names":[],"mappings":"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","file":"remotePty.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Barrier } from '../../../../base/common/async.js';\nimport { ITerminalLaunchResult, IProcessPropertyMap, ITerminalChildProcess, ITerminalLaunchError, ITerminalLogService, ProcessPropertyType } from '../../../../platform/terminal/common/terminal.js';\nimport { BasePty } from '../common/basePty.js';\nimport { RemoteTerminalChannelClient } from '../common/remote/remoteTerminalChannel.js';\nimport { IRemoteAgentService } from '../../../services/remote/common/remoteAgentService.js';\nimport { hasKey } from '../../../../base/common/types.js';\n\nexport class RemotePty extends BasePty implements ITerminalChildProcess {\n\tprivate readonly _startBarrier: Barrier;\n\n\tconstructor(\n\t\tid: number,\n\t\tshouldPersist: boolean,\n\t\tprivate readonly _remoteTerminalChannel: RemoteTerminalChannelClient,\n\t\t@IRemoteAgentService private readonly _remoteAgentService: IRemoteAgentService,\n\t\t@ITerminalLogService private readonly _logService: ITerminalLogService\n\t) {\n\t\tsuper(id, shouldPersist);\n\t\tthis._startBarrier = new Barrier();\n\t}\n\n\tasync start(): Promise<ITerminalLaunchError | ITerminalLaunchResult | undefined> {\n\t\t// Fetch the environment to check shell permissions\n\t\tconst env = await this._remoteAgentService.getEnvironment();\n\t\tif (!env) {\n\t\t\t// Extension host processes are only allowed in remote extension hosts currently\n\t\t\tthrow new Error('Could not fetch remote environment');\n\t\t}\n\n\t\tthis._logService.trace('Spawning remote agent process', { terminalId: this.id });\n\n\t\tconst startResult = await this._remoteTerminalChannel.start(this.id);\n\n\t\tif (startResult && hasKey(startResult, { message: true })) {\n\t\t\t// An error occurred\n\t\t\treturn startResult;\n\t\t}\n\n\t\tthis._startBarrier.open();\n\t\treturn startResult;\n\t}\n\n\tasync detach(forcePersist?: boolean): Promise<void> {\n\t\tawait this._startBarrier.wait();\n\t\treturn this._remoteTerminalChannel.detachFromProcess(this.id, forcePersist);\n\t}\n\n\tshutdown(immediate: boolean): void {\n\t\tthis._startBarrier.wait().then(_ => {\n\t\t\tthis._remoteTerminalChannel.shutdown(this.id, immediate);\n\t\t});\n\t}\n\n\tinput(data: string): void {\n\t\tif (this._inReplay) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._startBarrier.wait().then(_ => {\n\t\t\tthis._remoteTerminalChannel.input(this.id, data);\n\t\t});\n\t}\n\n\tsendSignal(signal: string): void {\n\t\tif (this._inReplay) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._startBarrier.wait().then(_ => {\n\t\t\tthis._remoteTerminalChannel.sendSignal(this.id, signal);\n\t\t});\n\t}\n\n\tprocessBinary(e: string): Promise<void> {\n\t\treturn this._remoteTerminalChannel.processBinary(this.id, e);\n\t}\n\n\tresize(cols: number, rows: number): void {\n\t\tif (this._inReplay || this._lastDimensions.cols === cols && this._lastDimensions.rows === rows) {\n\t\t\treturn;\n\t\t}\n\t\tthis._startBarrier.wait().then(_ => {\n\t\t\tthis._lastDimensions.cols = cols;\n\t\t\tthis._lastDimensions.rows = rows;\n\t\t\tthis._remoteTerminalChannel.resize(this.id, cols, rows);\n\t\t});\n\t}\n\n\tasync clearBuffer(): Promise<void> {\n\t\tawait this._remoteTerminalChannel.clearBuffer(this.id);\n\t}\n\n\tfreePortKillProcess(port: string): Promise<{ port: string; processId: string }> {\n\t\tif (!this._remoteTerminalChannel.freePortKillProcess) {\n\t\t\tthrow new Error('freePortKillProcess does not exist on the local pty service');\n\t\t}\n\t\treturn this._remoteTerminalChannel.freePortKillProcess(port);\n\t}\n\n\tacknowledgeDataEvent(charCount: number): void {\n\t\t// Support flow control for server spawned processes\n\t\tif (this._inReplay) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._startBarrier.wait().then(_ => {\n\t\t\tthis._remoteTerminalChannel.acknowledgeDataEvent(this.id, charCount);\n\t\t});\n\t}\n\n\tasync setUnicodeVersion(version: '6' | '11'): Promise<void> {\n\t\treturn this._remoteTerminalChannel.setUnicodeVersion(this.id, version);\n\t}\n\n\tasync refreshProperty<T extends ProcessPropertyType>(type: T): Promise<IProcessPropertyMap[T]> {\n\t\treturn this._remoteTerminalChannel.refreshProperty(this.id, type);\n\t}\n\n\tasync updateProperty<T extends ProcessPropertyType>(type: T, value: IProcessPropertyMap[T]): Promise<void> {\n\t\treturn this._remoteTerminalChannel.updateProperty(this.id, type, value);\n\t}\n\n\thandleOrphanQuestion() {\n\t\tthis._remoteTerminalChannel.orphanQuestionReply(this.id);\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Barrier } from '../../../../base/common/async.js';\nimport { ITerminalLaunchResult, IProcessPropertyMap, ITerminalChildProcess, ITerminalLaunchError, ITerminalLogService, ProcessPropertyType } from '../../../../platform/terminal/common/terminal.js';\nimport { BasePty } from '../common/basePty.js';\nimport { RemoteTerminalChannelClient } from '../common/remote/remoteTerminalChannel.js';\nimport { IRemoteAgentService } from '../../../services/remote/common/remoteAgentService.js';\nimport { hasKey } from '../../../../base/common/types.js';\n\nexport class RemotePty extends BasePty implements ITerminalChildProcess {\n\tprivate readonly _startBarrier: Barrier;\n\n\tconstructor(\n\t\tid: number,\n\t\tshouldPersist: boolean,\n\t\tprivate readonly _remoteTerminalChannel: RemoteTerminalChannelClient,\n\t\t@IRemoteAgentService private readonly _remoteAgentService: IRemoteAgentService,\n\t\t@ITerminalLogService private readonly _logService: ITerminalLogService\n\t) {\n\t\tsuper(id, shouldPersist);\n\t\tthis._startBarrier = new Barrier();\n\t}\n\n\tasync start(): Promise<ITerminalLaunchError | ITerminalLaunchResult | undefined> {\n\t\t// Fetch the environment to check shell permissions\n\t\tconst env = await this._remoteAgentService.getEnvironment();\n\t\tif (!env) {\n\t\t\t// Extension host processes are only allowed in remote extension hosts currently\n\t\t\tthrow new Error('Could not fetch remote environment');\n\t\t}\n\n\t\tthis._logService.trace('Spawning remote agent process', { terminalId: this.id });\n\n\t\tconst startResult = await this._remoteTerminalChannel.start(this.id);\n\n\t\tif (startResult && hasKey(startResult, { message: true })) {\n\t\t\t// An error occurred\n\t\t\treturn startResult;\n\t\t}\n\n\t\tthis._startBarrier.open();\n\t\treturn startResult;\n\t}\n\n\tasync detach(forcePersist?: boolean): Promise<void> {\n\t\tawait this._startBarrier.wait();\n\t\treturn this._remoteTerminalChannel.detachFromProcess(this.id, forcePersist);\n\t}\n\n\tshutdown(immediate: boolean): void {\n\t\tthis._startBarrier.wait().then(_ => {\n\t\t\tthis._remoteTerminalChannel.shutdown(this.id, immediate);\n\t\t});\n\t}\n\n\tinput(data: string): void {\n\t\tif (this._inReplay) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._startBarrier.wait().then(_ => {\n\t\t\tthis._remoteTerminalChannel.input(this.id, data);\n\t\t});\n\t}\n\n\tsendSignal(signal: string): void {\n\t\tif (this._inReplay) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._startBarrier.wait().then(_ => {\n\t\t\tthis._remoteTerminalChannel.sendSignal(this.id, signal);\n\t\t});\n\t}\n\n\tprocessBinary(e: string): Promise<void> {\n\t\treturn this._remoteTerminalChannel.processBinary(this.id, e);\n\t}\n\n\tresize(cols: number, rows: number): void {\n\t\tif (this._inReplay || this._lastDimensions.cols === cols && this._lastDimensions.rows === rows) {\n\t\t\treturn;\n\t\t}\n\t\tthis._startBarrier.wait().then(_ => {\n\t\t\tthis._lastDimensions.cols = cols;\n\t\t\tthis._lastDimensions.rows = rows;\n\t\t\tthis._remoteTerminalChannel.resize(this.id, cols, rows);\n\t\t});\n\t}\n\n\tasync clearBuffer(): Promise<void> {\n\t\tawait this._remoteTerminalChannel.clearBuffer(this.id);\n\t}\n\n\tfreePortKillProcess(port: string): Promise<{ port: string; processId: string }> {\n\t\tif (!this._remoteTerminalChannel.freePortKillProcess) {\n\t\t\tthrow new Error('freePortKillProcess does not exist on the local pty service');\n\t\t}\n\t\treturn this._remoteTerminalChannel.freePortKillProcess(port);\n\t}\n\n\tacknowledgeDataEvent(charCount: number): void {\n\t\t// Support flow control for server spawned processes\n\t\tif (this._inReplay) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._startBarrier.wait().then(_ => {\n\t\t\tthis._remoteTerminalChannel.acknowledgeDataEvent(this.id, charCount);\n\t\t});\n\t}\n\n\tasync setUnicodeVersion(version: '6' | '11'): Promise<void> {\n\t\treturn this._remoteTerminalChannel.setUnicodeVersion(this.id, version);\n\t}\n\n\tasync refreshProperty<T extends ProcessPropertyType>(type: T): Promise<IProcessPropertyMap[T]> {\n\t\treturn this._remoteTerminalChannel.refreshProperty(this.id, type);\n\t}\n\n\tasync updateProperty<T extends ProcessPropertyType>(type: T, value: IProcessPropertyMap[T]): Promise<void> {\n\t\treturn this._remoteTerminalChannel.updateProperty(this.id, type, value);\n\t}\n\n\thandleOrphanQuestion() {\n\t\tthis._remoteTerminalChannel.orphanQuestionReply(this.id);\n\t}\n}\n"]}