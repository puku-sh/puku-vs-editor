{"version":3,"sources":["vs/workbench/contrib/terminal/browser/terminalService.ts"],"names":[],"mappings":"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","file":"terminalService.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as domStylesheets from '../../../../base/browser/domStylesheets.js';\nimport * as cssValue from '../../../../base/browser/cssValue.js';\nimport { DeferredPromise, timeout, type MaybePromise } from '../../../../base/common/async.js';\nimport { debounce, memoize } from '../../../../base/common/decorators.js';\nimport { DynamicListEventMultiplexer, Emitter, Event, IDynamicListEventMultiplexer } from '../../../../base/common/event.js';\nimport { Disposable, DisposableStore, dispose, IDisposable, toDisposable } from '../../../../base/common/lifecycle.js';\nimport { Schemas } from '../../../../base/common/network.js';\nimport { isMacintosh, isWeb } from '../../../../base/common/platform.js';\nimport { URI } from '../../../../base/common/uri.js';\nimport { IKeyMods } from '../../../../platform/quickinput/common/quickInput.js';\nimport * as nls from '../../../../nls.js';\nimport { ICommandService } from '../../../../platform/commands/common/commands.js';\nimport { IConfigurationService } from '../../../../platform/configuration/common/configuration.js';\nimport { IContextKey, IContextKeyService } from '../../../../platform/contextkey/common/contextkey.js';\nimport { IDialogService } from '../../../../platform/dialogs/common/dialogs.js';\nimport { IInstantiationService } from '../../../../platform/instantiation/common/instantiation.js';\nimport { INotificationService } from '../../../../platform/notification/common/notification.js';\nimport { ICreateContributedTerminalProfileOptions, IExtensionTerminalProfile, IPtyHostAttachTarget, IRawTerminalInstanceLayoutInfo, IRawTerminalTabLayoutInfo, IShellLaunchConfig, ITerminalBackend, ITerminalLaunchError, ITerminalLogService, ITerminalsLayoutInfo, ITerminalsLayoutInfoById, TerminalExitReason, TerminalLocation, TitleEventSource } from '../../../../platform/terminal/common/terminal.js';\nimport { formatMessageForTerminal } from '../../../../platform/terminal/common/terminalStrings.js';\nimport { iconForeground } from '../../../../platform/theme/common/colorRegistry.js';\nimport { getIconRegistry } from '../../../../platform/theme/common/iconRegistry.js';\nimport { isDark } from '../../../../platform/theme/common/theme.js';\nimport { IThemeService, Themable } from '../../../../platform/theme/common/themeService.js';\nimport { ThemeIcon } from '../../../../base/common/themables.js';\nimport { IWorkspaceContextService } from '../../../../platform/workspace/common/workspace.js';\nimport { VirtualWorkspaceContext } from '../../../common/contextkeys.js';\nimport { ICreateTerminalOptions, IDetachedTerminalInstance, IDetachedXTermOptions, IRequestAddInstanceToGroupEvent, ITerminalConfigurationService, ITerminalEditorService, ITerminalGroup, ITerminalGroupService, ITerminalInstance, ITerminalInstanceHost, ITerminalInstanceService, ITerminalLocationOptions, ITerminalService, ITerminalServiceNativeDelegate, TerminalConnectionState, TerminalEditorLocation } from './terminal.js';\nimport { getCwdForSplit } from './terminalActions.js';\nimport { TerminalEditorInput } from './terminalEditorInput.js';\nimport { getColorStyleContent, getUriClasses } from './terminalIcon.js';\nimport { TerminalProfileQuickpick } from './terminalProfileQuickpick.js';\nimport { getInstanceFromResource, getTerminalUri, parseTerminalUri } from './terminalUri.js';\nimport { IRemoteTerminalAttachTarget, IStartExtensionTerminalRequest, ITerminalProcessExtHostProxy, ITerminalProfileService } from '../common/terminal.js';\nimport { TerminalContextKeys } from '../common/terminalContextKey.js';\nimport { columnToEditorGroup } from '../../../services/editor/common/editorGroupColumn.js';\nimport { IEditorGroupsService } from '../../../services/editor/common/editorGroupsService.js';\nimport { ACTIVE_GROUP, ACTIVE_GROUP_TYPE, AUX_WINDOW_GROUP, AUX_WINDOW_GROUP_TYPE, IEditorService, SIDE_GROUP, SIDE_GROUP_TYPE } from '../../../services/editor/common/editorService.js';\nimport { IWorkbenchEnvironmentService } from '../../../services/environment/common/environmentService.js';\nimport { IExtensionService } from '../../../services/extensions/common/extensions.js';\nimport { ILifecycleService, ShutdownReason, StartupKind, WillShutdownEvent } from '../../../services/lifecycle/common/lifecycle.js';\nimport { IRemoteAgentService } from '../../../services/remote/common/remoteAgentService.js';\nimport { XtermTerminal } from './xterm/xtermTerminal.js';\nimport { TerminalInstance } from './terminalInstance.js';\nimport { IKeybindingService } from '../../../../platform/keybinding/common/keybinding.js';\nimport { TerminalCapabilityStore } from '../../../../platform/terminal/common/capabilities/terminalCapabilityStore.js';\nimport { ITimerService } from '../../../services/timer/browser/timerService.js';\nimport { mark } from '../../../../base/common/performance.js';\nimport { DetachedTerminal } from './detachedTerminal.js';\nimport { ITerminalCapabilityImplMap, TerminalCapability } from '../../../../platform/terminal/common/capabilities/capabilities.js';\nimport { createInstanceCapabilityEventMultiplexer } from './terminalEvents.js';\nimport { isAuxiliaryWindow, mainWindow } from '../../../../base/browser/window.js';\nimport { GroupIdentifier } from '../../../common/editor.js';\nimport { getActiveWindow } from '../../../../base/browser/dom.js';\nimport { hasKey, isString } from '../../../../base/common/types.js';\n\ninterface IBackgroundTerminal {\n\tinstance: ITerminalInstance;\n\tterminalLocationOptions?: ITerminalLocationOptions;\n}\n\nexport class TerminalService extends Disposable implements ITerminalService {\n\tdeclare _serviceBrand: undefined;\n\n\tprivate _hostActiveTerminals: Map<ITerminalInstanceHost, ITerminalInstance | undefined> = new Map();\n\n\tprivate _detachedXterms = new Set<IDetachedTerminalInstance>();\n\tprivate _terminalEditorActive: IContextKey<boolean>;\n\tprivate readonly _terminalShellTypeContextKey: IContextKey<string>;\n\n\tprivate _isShuttingDown: boolean = false;\n\tprivate _backgroundedTerminalInstances: IBackgroundTerminal[] = [];\n\tprivate _backgroundedTerminalDisposables: Map<number, IDisposable[]> = new Map();\n\tprivate _processSupportContextKey: IContextKey<boolean>;\n\n\tprivate _primaryBackend?: ITerminalBackend;\n\tprivate _terminalHasBeenCreated: IContextKey<boolean>;\n\tprivate _terminalCountContextKey: IContextKey<number>;\n\tprivate _nativeDelegate?: ITerminalServiceNativeDelegate;\n\tprivate _shutdownWindowCount?: number;\n\n\tget isProcessSupportRegistered(): boolean { return !!this._processSupportContextKey.get(); }\n\n\tprivate _connectionState: TerminalConnectionState = TerminalConnectionState.Connecting;\n\tget connectionState(): TerminalConnectionState { return this._connectionState; }\n\n\tprivate readonly _whenConnected = new DeferredPromise<void>();\n\tget whenConnected(): Promise<void> { return this._whenConnected.p; }\n\n\tprivate _restoredGroupCount: number = 0;\n\tget restoredGroupCount(): number { return this._restoredGroupCount; }\n\n\tget instances(): ITerminalInstance[] {\n\t\treturn this._terminalGroupService.instances.concat(this._terminalEditorService.instances).concat(this._backgroundedTerminalInstances.map(bg => bg.instance));\n\t}\n\t/** Gets all non-background terminals. */\n\tget foregroundInstances(): ITerminalInstance[] {\n\t\treturn this._terminalGroupService.instances.concat(this._terminalEditorService.instances);\n\t}\n\tget detachedInstances(): Iterable<IDetachedTerminalInstance> {\n\t\treturn this._detachedXterms;\n\t}\n\n\tprivate _reconnectedTerminalGroups: Promise<ITerminalGroup[]> | undefined;\n\n\tprivate _reconnectedTerminals: Map<string, ITerminalInstance[]> = new Map();\n\tgetReconnectedTerminals(reconnectionOwner: string): ITerminalInstance[] | undefined {\n\t\treturn this._reconnectedTerminals.get(reconnectionOwner);\n\t}\n\n\tprivate _activeInstance: ITerminalInstance | undefined;\n\tget activeInstance(): ITerminalInstance | undefined {\n\t\t// Check if either an editor or panel terminal has focus and return that, regardless of the\n\t\t// value of _activeInstance. This avoids terminals created in the panel for example stealing\n\t\t// the active status even when it's not focused.\n\t\tfor (const activeHostTerminal of this._hostActiveTerminals.values()) {\n\t\t\tif (activeHostTerminal?.hasFocus) {\n\t\t\t\treturn activeHostTerminal;\n\t\t\t}\n\t\t}\n\t\t// Fallback to the last recorded active terminal if neither have focus\n\t\treturn this._activeInstance;\n\t}\n\n\tprivate readonly _onDidCreateInstance = this._register(new Emitter<ITerminalInstance>());\n\tget onDidCreateInstance(): Event<ITerminalInstance> { return this._onDidCreateInstance.event; }\n\tprivate readonly _onDidChangeInstanceDimensions = this._register(new Emitter<ITerminalInstance>());\n\tget onDidChangeInstanceDimensions(): Event<ITerminalInstance> { return this._onDidChangeInstanceDimensions.event; }\n\tprivate readonly _onDidRegisterProcessSupport = this._register(new Emitter<void>());\n\tget onDidRegisterProcessSupport(): Event<void> { return this._onDidRegisterProcessSupport.event; }\n\tprivate readonly _onDidChangeConnectionState = this._register(new Emitter<void>());\n\tget onDidChangeConnectionState(): Event<void> { return this._onDidChangeConnectionState.event; }\n\tprivate readonly _onDidRequestStartExtensionTerminal = this._register(new Emitter<IStartExtensionTerminalRequest>());\n\tget onDidRequestStartExtensionTerminal(): Event<IStartExtensionTerminalRequest> { return this._onDidRequestStartExtensionTerminal.event; }\n\n\t// ITerminalInstanceHost events\n\tprivate readonly _onDidDisposeInstance = this._register(new Emitter<ITerminalInstance>());\n\tget onDidDisposeInstance(): Event<ITerminalInstance> { return this._onDidDisposeInstance.event; }\n\tprivate readonly _onDidFocusInstance = this._register(new Emitter<ITerminalInstance>());\n\tget onDidFocusInstance(): Event<ITerminalInstance> { return this._onDidFocusInstance.event; }\n\tprivate readonly _onDidChangeActiveInstance = this._register(new Emitter<ITerminalInstance | undefined>());\n\tget onDidChangeActiveInstance(): Event<ITerminalInstance | undefined> { return this._onDidChangeActiveInstance.event; }\n\tprivate readonly _onDidChangeInstances = this._register(new Emitter<void>());\n\tget onDidChangeInstances(): Event<void> { return this._onDidChangeInstances.event; }\n\tprivate readonly _onDidChangeInstanceCapability = this._register(new Emitter<ITerminalInstance>());\n\tget onDidChangeInstanceCapability(): Event<ITerminalInstance> { return this._onDidChangeInstanceCapability.event; }\n\n\t// Terminal view events\n\tprivate readonly _onDidChangeActiveGroup = this._register(new Emitter<ITerminalGroup | undefined>());\n\tget onDidChangeActiveGroup(): Event<ITerminalGroup | undefined> { return this._onDidChangeActiveGroup.event; }\n\n\t// Lazily initialized events that fire when the specified event fires on _any_ terminal\n\t// TODO: Batch events\n\t@memoize get onAnyInstanceData() { return this._register(this.createOnInstanceEvent(instance => Event.map(instance.onData, data => ({ instance, data })))).event; }\n\t@memoize get onAnyInstanceDataInput() { return this._register(this.createOnInstanceEvent(e => Event.map(e.onDidInputData, () => e, e.store))).event; }\n\t@memoize get onAnyInstanceIconChange() { return this._register(this.createOnInstanceEvent(e => e.onIconChanged)).event; }\n\t@memoize get onAnyInstanceMaximumDimensionsChange() { return this._register(this.createOnInstanceEvent(e => Event.map(e.onMaximumDimensionsChanged, () => e, e.store))).event; }\n\t@memoize get onAnyInstancePrimaryStatusChange() { return this._register(this.createOnInstanceEvent(e => Event.map(e.statusList.onDidChangePrimaryStatus, () => e, e.store))).event; }\n\t@memoize get onAnyInstanceProcessIdReady() { return this._register(this.createOnInstanceEvent(e => e.onProcessIdReady)).event; }\n\t@memoize get onAnyInstanceSelectionChange() { return this._register(this.createOnInstanceEvent(e => e.onDidChangeSelection)).event; }\n\t@memoize get onAnyInstanceTitleChange() { return this._register(this.createOnInstanceEvent(e => e.onTitleChanged)).event; }\n\t@memoize get onAnyInstanceShellTypeChanged() { return this._register(this.createOnInstanceEvent(e => Event.map(e.onDidChangeShellType, () => e))).event; }\n\t@memoize get onAnyInstanceAddedCapabilityType() { return this._register(this.createOnInstanceEvent(e => Event.map(e.capabilities.onDidAddCapability, e => e.id))).event; }\n\n\tconstructor(\n\t\t@IContextKeyService private _contextKeyService: IContextKeyService,\n\t\t@ILifecycleService private readonly _lifecycleService: ILifecycleService,\n\t\t@ITerminalLogService private readonly _logService: ITerminalLogService,\n\t\t@IDialogService private _dialogService: IDialogService,\n\t\t@IInstantiationService private _instantiationService: IInstantiationService,\n\t\t@IRemoteAgentService private _remoteAgentService: IRemoteAgentService,\n\t\t@IConfigurationService private readonly _configurationService: IConfigurationService,\n\t\t@IWorkbenchEnvironmentService private readonly _environmentService: IWorkbenchEnvironmentService,\n\t\t@ITerminalConfigurationService private readonly _terminalConfigurationService: ITerminalConfigurationService,\n\t\t@ITerminalEditorService private readonly _terminalEditorService: ITerminalEditorService,\n\t\t@ITerminalGroupService private readonly _terminalGroupService: ITerminalGroupService,\n\t\t@ITerminalInstanceService private readonly _terminalInstanceService: ITerminalInstanceService,\n\t\t@IEditorGroupsService private readonly _editorGroupsService: IEditorGroupsService,\n\t\t@ITerminalProfileService private readonly _terminalProfileService: ITerminalProfileService,\n\t\t@IExtensionService private readonly _extensionService: IExtensionService,\n\t\t@INotificationService private readonly _notificationService: INotificationService,\n\t\t@IWorkspaceContextService private readonly _workspaceContextService: IWorkspaceContextService,\n\t\t@ICommandService private readonly _commandService: ICommandService,\n\t\t@IKeybindingService private readonly _keybindingService: IKeybindingService,\n\t\t@ITimerService private readonly _timerService: ITimerService\n\t) {\n\t\tsuper();\n\n\t\t// the below avoids having to poll routinely.\n\t\t// we update detected profiles when an instance is created so that,\n\t\t// for example, we detect if you've installed a pwsh\n\t\tthis._register(this.onDidCreateInstance(() => this._terminalProfileService.refreshAvailableProfiles()));\n\t\tthis._forwardInstanceHostEvents(this._terminalGroupService);\n\t\tthis._forwardInstanceHostEvents(this._terminalEditorService);\n\t\tthis._register(this._terminalGroupService.onDidChangeActiveGroup(this._onDidChangeActiveGroup.fire, this._onDidChangeActiveGroup));\n\t\tthis._register(this._terminalInstanceService.onDidCreateInstance(instance => {\n\t\t\tthis._initInstanceListeners(instance);\n\t\t\tthis._onDidCreateInstance.fire(instance);\n\t\t}));\n\n\t\t// Hide the panel if there are no more instances, provided that VS Code is not shutting\n\t\t// down. When shutting down the panel is locked in place so that it is restored upon next\n\t\t// launch.\n\t\tthis._register(this._terminalGroupService.onDidChangeActiveInstance(instance => {\n\t\t\tif (!instance && !this._isShuttingDown && this._terminalConfigurationService.config.hideOnLastClosed) {\n\t\t\t\tthis._terminalGroupService.hidePanel();\n\t\t\t}\n\t\t\tif (instance?.shellType) {\n\t\t\t\tthis._terminalShellTypeContextKey.set(instance.shellType.toString());\n\t\t\t} else if (!instance || !(instance.shellType)) {\n\t\t\t\tthis._terminalShellTypeContextKey.reset();\n\t\t\t}\n\t\t}));\n\n\t\tthis._handleInstanceContextKeys();\n\t\tthis._terminalShellTypeContextKey = TerminalContextKeys.shellType.bindTo(this._contextKeyService);\n\t\tthis._processSupportContextKey = TerminalContextKeys.processSupported.bindTo(this._contextKeyService);\n\t\tthis._processSupportContextKey.set(!isWeb || this._remoteAgentService.getConnection() !== null);\n\t\tthis._terminalHasBeenCreated = TerminalContextKeys.terminalHasBeenCreated.bindTo(this._contextKeyService);\n\t\tthis._terminalCountContextKey = TerminalContextKeys.count.bindTo(this._contextKeyService);\n\t\tthis._terminalEditorActive = TerminalContextKeys.terminalEditorActive.bindTo(this._contextKeyService);\n\n\t\tthis._register(this.onDidChangeActiveInstance(instance => {\n\t\t\tthis._terminalEditorActive.set(!!instance?.target && instance.target === TerminalLocation.Editor);\n\t\t}));\n\n\t\tthis._register(_lifecycleService.onBeforeShutdown(async e => e.veto(this._onBeforeShutdown(e.reason), 'veto.terminal')));\n\t\tthis._register(_lifecycleService.onWillShutdown(e => this._onWillShutdown(e)));\n\n\t\tthis._initializePrimaryBackend();\n\n\t\t// Create async as the class depends on `this`\n\t\ttimeout(0).then(() => this._register(this._instantiationService.createInstance(TerminalEditorStyle, mainWindow.document.head)));\n\t}\n\n\tasync showProfileQuickPick(type: 'setDefault' | 'createInstance', cwd?: string | URI): Promise<ITerminalInstance | undefined> {\n\t\tconst quickPick = this._instantiationService.createInstance(TerminalProfileQuickpick);\n\t\tconst result = await quickPick.showAndGetResult(type);\n\t\tif (!result) {\n\t\t\treturn;\n\t\t}\n\t\tif (isString(result)) {\n\t\t\treturn;\n\t\t}\n\t\tconst keyMods: IKeyMods | undefined = result.keyMods;\n\t\tif (type === 'createInstance') {\n\t\t\tconst activeInstance = this.getDefaultInstanceHost().activeInstance;\n\t\t\tconst defaultLocation = this._terminalConfigurationService.defaultLocation;\n\t\t\tlet instance;\n\n\t\t\tif (result.config && hasKey(result.config, { id: true })) {\n\t\t\t\tawait this.createContributedTerminalProfile(result.config.extensionIdentifier, result.config.id, {\n\t\t\t\t\ticon: result.config.options?.icon,\n\t\t\t\t\tcolor: result.config.options?.color,\n\t\t\t\t\tlocation: !!(keyMods?.alt && activeInstance) ? { splitActiveTerminal: true } : defaultLocation\n\t\t\t\t});\n\t\t\t\treturn;\n\t\t\t} else if (result.config && hasKey(result.config, { profileName: true })) {\n\t\t\t\tif (keyMods?.alt && activeInstance) {\n\t\t\t\t\t// create split, only valid if there's an active instance\n\t\t\t\t\tinstance = await this.createTerminal({ location: { parentTerminal: activeInstance }, config: result.config, cwd });\n\t\t\t\t} else {\n\t\t\t\t\tinstance = await this.createTerminal({ location: defaultLocation, config: result.config, cwd });\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (instance && defaultLocation !== TerminalLocation.Editor) {\n\t\t\t\tthis._terminalGroupService.showPanel(true);\n\t\t\t\tthis.setActiveInstance(instance);\n\t\t\t\treturn instance;\n\t\t\t}\n\t\t}\n\t\treturn undefined;\n\t}\n\n\tprivate async _initializePrimaryBackend() {\n\t\tmark('code/terminal/willGetTerminalBackend');\n\t\tthis._primaryBackend = await this._terminalInstanceService.getBackend(this._environmentService.remoteAuthority);\n\t\tmark('code/terminal/didGetTerminalBackend');\n\t\tconst enableTerminalReconnection = this._terminalConfigurationService.config.enablePersistentSessions;\n\n\t\t// Connect to the extension host if it's there, set the connection state to connected when\n\t\t// it's done. This should happen even when there is no extension host.\n\t\tthis._connectionState = TerminalConnectionState.Connecting;\n\n\t\tconst isPersistentRemote = !!this._environmentService.remoteAuthority && enableTerminalReconnection;\n\n\t\tif (this._primaryBackend) {\n\t\t\tthis._register(this._primaryBackend.onDidRequestDetach(async (e) => {\n\t\t\t\tconst instanceToDetach = this.getInstanceFromResource(getTerminalUri(e.workspaceId, e.instanceId));\n\t\t\t\tif (instanceToDetach) {\n\t\t\t\t\tconst persistentProcessId = instanceToDetach?.persistentProcessId;\n\t\t\t\t\tif (persistentProcessId && !instanceToDetach.shellLaunchConfig.isFeatureTerminal && !instanceToDetach.shellLaunchConfig.customPtyImplementation) {\n\t\t\t\t\t\tif (instanceToDetach.target === TerminalLocation.Editor) {\n\t\t\t\t\t\t\tthis._terminalEditorService.detachInstance(instanceToDetach);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tthis._terminalGroupService.getGroupForInstance(instanceToDetach)?.removeInstance(instanceToDetach);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tawait instanceToDetach.detachProcessAndDispose(TerminalExitReason.User);\n\t\t\t\t\t\tawait this._primaryBackend?.acceptDetachInstanceReply(e.requestId, persistentProcessId);\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// will get rejected without a persistentProcessId to attach to\n\t\t\t\t\t\tawait this._primaryBackend?.acceptDetachInstanceReply(e.requestId, undefined);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}));\n\t\t}\n\n\t\tmark('code/terminal/willReconnect');\n\t\tlet reconnectedPromise: Promise<unknown>;\n\t\tif (isPersistentRemote) {\n\t\t\treconnectedPromise = this._reconnectToRemoteTerminals();\n\t\t} else if (enableTerminalReconnection) {\n\t\t\treconnectedPromise = this._reconnectToLocalTerminals();\n\t\t} else {\n\t\t\treconnectedPromise = Promise.resolve();\n\t\t}\n\t\treconnectedPromise.then(async () => {\n\t\t\tthis._setConnected();\n\t\t\tmark('code/terminal/didReconnect');\n\t\t\tmark('code/terminal/willReplay');\n\t\t\tconst instances = await this._reconnectedTerminalGroups?.then(groups => groups.map(e => e.terminalInstances).flat()) ?? [];\n\t\t\tawait Promise.all(instances.map(e => new Promise<void>(r => Event.once(e.onProcessReplayComplete)(r))));\n\t\t\tmark('code/terminal/didReplay');\n\t\t\tmark('code/terminal/willGetPerformanceMarks');\n\t\t\tawait Promise.all(Array.from(this._terminalInstanceService.getRegisteredBackends()).map(async backend => {\n\t\t\t\tthis._timerService.setPerformanceMarks(backend.remoteAuthority === undefined ? 'localPtyHost' : 'remotePtyHost', await backend.getPerformanceMarks());\n\t\t\t\tbackend.setReady();\n\t\t\t}));\n\t\t\tmark('code/terminal/didGetPerformanceMarks');\n\t\t\tthis._whenConnected.complete();\n\t\t});\n\t}\n\n\tgetPrimaryBackend(): ITerminalBackend | undefined {\n\t\treturn this._primaryBackend;\n\t}\n\n\tasync setNextCommandId(id: number, commandLine: string, commandId: string): Promise<void> {\n\t\tif (!this._primaryBackend || id <= 0) {\n\t\t\treturn;\n\t\t}\n\t\tawait this._primaryBackend.setNextCommandId(id, commandLine, commandId);\n\t}\n\n\tprivate _forwardInstanceHostEvents(host: ITerminalInstanceHost) {\n\t\tthis._register(host.onDidChangeInstances(this._onDidChangeInstances.fire, this._onDidChangeInstances));\n\t\tthis._register(host.onDidDisposeInstance(this._onDidDisposeInstance.fire, this._onDidDisposeInstance));\n\t\tthis._register(host.onDidChangeActiveInstance(instance => this._evaluateActiveInstance(host, instance)));\n\t\tthis._register(host.onDidFocusInstance(instance => {\n\t\t\tthis._onDidFocusInstance.fire(instance);\n\t\t\tthis._evaluateActiveInstance(host, instance);\n\t\t}));\n\t\tthis._register(host.onDidChangeInstanceCapability((instance) => {\n\t\t\tthis._onDidChangeInstanceCapability.fire(instance);\n\t\t}));\n\t\tthis._hostActiveTerminals.set(host, undefined);\n\t}\n\n\tprivate _evaluateActiveInstance(host: ITerminalInstanceHost, instance: ITerminalInstance | undefined) {\n\t\t// Track the latest active terminal for each host so that when one becomes undefined, the\n\t\t// TerminalService's active terminal is set to the last active terminal from the other host.\n\t\t// This means if the last terminal editor is closed such that it becomes undefined, the last\n\t\t// active group's terminal will be used as the active terminal if available.\n\t\tthis._hostActiveTerminals.set(host, instance);\n\t\tif (instance === undefined) {\n\t\t\tfor (const active of this._hostActiveTerminals.values()) {\n\t\t\t\tif (active) {\n\t\t\t\t\tinstance = active;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tthis._activeInstance = instance;\n\t\tthis._onDidChangeActiveInstance.fire(instance);\n\t}\n\n\tsetActiveInstance(value: ITerminalInstance | undefined) {\n\t\t// TODO@meganrogge: Is this the right logic for when instance is undefined?\n\t\tif (!value) {\n\t\t\treturn;\n\t\t}\n\t\t// If this was a hideFromUser terminal created by the API this was triggered by show,\n\t\t// in which case we need to create the terminal group\n\t\tif (value.shellLaunchConfig.hideFromUser) {\n\t\t\tthis.showBackgroundTerminal(value);\n\t\t}\n\t\tif (value.target === TerminalLocation.Editor) {\n\t\t\tthis._terminalEditorService.setActiveInstance(value);\n\t\t} else {\n\t\t\tthis._terminalGroupService.setActiveInstance(value);\n\t\t}\n\t}\n\n\tasync focusInstance(instance: ITerminalInstance): Promise<void> {\n\t\tif (instance.target === TerminalLocation.Editor) {\n\t\t\treturn this._terminalEditorService.focusInstance(instance);\n\t\t}\n\t\treturn this._terminalGroupService.focusInstance(instance);\n\t}\n\n\tasync focusActiveInstance(): Promise<void> {\n\t\tif (!this._activeInstance) {\n\t\t\treturn;\n\t\t}\n\t\treturn this.focusInstance(this._activeInstance);\n\t}\n\n\tasync createContributedTerminalProfile(extensionIdentifier: string, id: string, options: ICreateContributedTerminalProfileOptions): Promise<void> {\n\t\tawait this._extensionService.activateByEvent(`onTerminalProfile:${id}`);\n\n\t\tconst profileProvider = this._terminalProfileService.getContributedProfileProvider(extensionIdentifier, id);\n\t\tif (!profileProvider) {\n\t\t\tthis._notificationService.error(`No terminal profile provider registered for id \"${id}\"`);\n\t\t\treturn;\n\t\t}\n\t\ttry {\n\t\t\tawait profileProvider.createContributedTerminalProfile(options);\n\t\t\tthis._terminalGroupService.setActiveInstanceByIndex(this._terminalGroupService.instances.length - 1);\n\t\t\tawait this._terminalGroupService.activeInstance?.focusWhenReady();\n\t\t} catch (e) {\n\t\t\tthis._notificationService.error(e.message);\n\t\t}\n\t}\n\n\tasync safeDisposeTerminal(instance: ITerminalInstance): Promise<void> {\n\t\t// Confirm on kill in the editor is handled by the editor input\n\t\tif (instance.target !== TerminalLocation.Editor &&\n\t\t\tinstance.hasChildProcesses &&\n\t\t\t(this._terminalConfigurationService.config.confirmOnKill === 'panel' || this._terminalConfigurationService.config.confirmOnKill === 'always')) {\n\t\t\tconst veto = await this._showTerminalCloseConfirmation(true);\n\t\t\tif (veto) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\t\treturn new Promise<void>(r => {\n\t\t\tEvent.once(instance.onExit)(() => r());\n\t\t\tinstance.dispose(TerminalExitReason.User);\n\t\t});\n\t}\n\n\tprivate _setConnected() {\n\t\tthis._connectionState = TerminalConnectionState.Connected;\n\t\tthis._onDidChangeConnectionState.fire();\n\t\tthis._logService.trace('Pty host ready');\n\t}\n\n\tprivate async _reconnectToRemoteTerminals(): Promise<void> {\n\t\tconst remoteAuthority = this._environmentService.remoteAuthority;\n\t\tif (!remoteAuthority) {\n\t\t\treturn;\n\t\t}\n\t\tconst backend = await this._terminalInstanceService.getBackend(remoteAuthority);\n\t\tif (!backend) {\n\t\t\treturn;\n\t\t}\n\t\tmark('code/terminal/willGetTerminalLayoutInfo');\n\t\tconst layoutInfo = await backend.getTerminalLayoutInfo();\n\t\tmark('code/terminal/didGetTerminalLayoutInfo');\n\t\tbackend.reduceConnectionGraceTime();\n\t\tmark('code/terminal/willRecreateTerminalGroups');\n\t\tawait this._recreateTerminalGroups(layoutInfo);\n\t\tmark('code/terminal/didRecreateTerminalGroups');\n\t\t// now that terminals have been restored,\n\t\t// attach listeners to update remote when terminals are changed\n\t\tthis._attachProcessLayoutListeners();\n\n\t\tthis._logService.trace('Reconnected to remote terminals');\n\t}\n\n\tprivate async _reconnectToLocalTerminals(): Promise<void> {\n\t\tconst localBackend = await this._terminalInstanceService.getBackend();\n\t\tif (!localBackend) {\n\t\t\treturn;\n\t\t}\n\t\tmark('code/terminal/willGetTerminalLayoutInfo');\n\t\tconst layoutInfo = await localBackend.getTerminalLayoutInfo();\n\t\tmark('code/terminal/didGetTerminalLayoutInfo');\n\t\tif (layoutInfo && (layoutInfo.tabs.length > 0 || layoutInfo?.background?.length)) {\n\t\t\tmark('code/terminal/willRecreateTerminalGroups');\n\t\t\tthis._reconnectedTerminalGroups = this._recreateTerminalGroups(layoutInfo);\n\t\t\tconst revivedInstances = await this._reviveBackgroundTerminalInstances(layoutInfo.background || []);\n\t\t\tthis._backgroundedTerminalInstances = revivedInstances.map(instance => ({ instance }));\n\t\t\tmark('code/terminal/didRecreateTerminalGroups');\n\t\t}\n\t\t// now that terminals have been restored,\n\t\t// attach listeners to update local state when terminals are changed\n\t\tthis._attachProcessLayoutListeners();\n\n\t\tthis._logService.trace('Reconnected to local terminals');\n\t}\n\n\tprivate _recreateTerminalGroups(layoutInfo?: ITerminalsLayoutInfo): Promise<ITerminalGroup[]> {\n\t\tconst groupPromises: Promise<ITerminalGroup | undefined>[] = [];\n\t\tlet activeGroup: Promise<ITerminalGroup | undefined> | undefined;\n\t\tif (layoutInfo) {\n\t\t\tfor (const tabLayout of layoutInfo.tabs) {\n\t\t\t\tconst terminalLayouts = tabLayout.terminals.filter(t => t.terminal && t.terminal.isOrphan);\n\t\t\t\tif (terminalLayouts.length) {\n\t\t\t\t\tthis._restoredGroupCount += terminalLayouts.length;\n\t\t\t\t\tconst promise = this._recreateTerminalGroup(tabLayout, terminalLayouts);\n\t\t\t\t\tgroupPromises.push(promise);\n\t\t\t\t\tif (tabLayout.isActive) {\n\t\t\t\t\t\tactiveGroup = promise;\n\t\t\t\t\t}\n\t\t\t\t\tconst activeInstance = this.instances.find(t => t.shellLaunchConfig.attachPersistentProcess?.id === tabLayout.activePersistentProcessId);\n\t\t\t\t\tif (activeInstance) {\n\t\t\t\t\t\tthis.setActiveInstance(activeInstance);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (layoutInfo.tabs.length) {\n\t\t\t\tactiveGroup?.then(group => this._terminalGroupService.activeGroup = group);\n\t\t\t}\n\t\t}\n\t\treturn Promise.all(groupPromises).then(result => result.filter(e => !!e) as ITerminalGroup[]);\n\t}\n\n\tprivate async _reviveBackgroundTerminalInstances(bgTerminals: (IPtyHostAttachTarget | null)[]): Promise<ITerminalInstance[]> {\n\t\tconst instances: ITerminalInstance[] = [];\n\t\tfor (const bg of bgTerminals) {\n\t\t\tconst attachPersistentProcess = bg;\n\t\t\tif (!attachPersistentProcess) {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tconst instance = await this.createTerminal({ config: { attachPersistentProcess, hideFromUser: true, forcePersist: true }, location: TerminalLocation.Panel });\n\t\t\tinstances.push(instance);\n\t\t}\n\t\treturn instances;\n\t}\n\n\tprivate async _recreateTerminalGroup(tabLayout: IRawTerminalTabLayoutInfo<IPtyHostAttachTarget | null>, terminalLayouts: IRawTerminalInstanceLayoutInfo<IPtyHostAttachTarget | null>[]): Promise<ITerminalGroup | undefined> {\n\t\tlet lastInstance: Promise<ITerminalInstance> | undefined;\n\t\tfor (const terminalLayout of terminalLayouts) {\n\t\t\tconst attachPersistentProcess = terminalLayout.terminal!;\n\t\t\tif (this._lifecycleService.startupKind !== StartupKind.ReloadedWindow && attachPersistentProcess.type === 'Task') {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tmark(`code/terminal/willRecreateTerminal/${attachPersistentProcess.id}-${attachPersistentProcess.pid}`);\n\t\t\tlastInstance = this.createTerminal({\n\t\t\t\tconfig: { attachPersistentProcess },\n\t\t\t\tlocation: lastInstance ? { parentTerminal: lastInstance } : TerminalLocation.Panel\n\t\t\t});\n\t\t\tlastInstance.then(() => mark(`code/terminal/didRecreateTerminal/${attachPersistentProcess.id}-${attachPersistentProcess.pid}`));\n\t\t}\n\t\tconst group = lastInstance?.then(instance => {\n\t\t\tconst g = this._terminalGroupService.getGroupForInstance(instance);\n\t\t\tg?.resizePanes(tabLayout.terminals.map(terminal => terminal.relativeSize));\n\t\t\treturn g;\n\t\t});\n\t\treturn group;\n\t}\n\n\tprivate _attachProcessLayoutListeners(): void {\n\t\tthis._register(this.onDidChangeActiveGroup(() => this._saveState()));\n\t\tthis._register(this.onDidChangeActiveInstance(() => this._saveState()));\n\t\tthis._register(this.onDidChangeInstances(() => this._saveState()));\n\t\t// The state must be updated when the terminal is relaunched, otherwise the persistent\n\t\t// terminal ID will be stale and the process will be leaked.\n\t\tthis._register(this.onAnyInstanceProcessIdReady(() => this._saveState()));\n\t\tthis._register(this.onAnyInstanceTitleChange(instance => this._updateTitle(instance)));\n\t\tthis._register(this.onAnyInstanceIconChange(e => this._updateIcon(e.instance, e.userInitiated)));\n\t}\n\n\tprivate _handleInstanceContextKeys(): void {\n\t\tconst terminalIsOpenContext = TerminalContextKeys.isOpen.bindTo(this._contextKeyService);\n\t\tconst updateTerminalContextKeys = () => {\n\t\t\tterminalIsOpenContext.set(this.instances.length > 0);\n\t\t\tthis._terminalCountContextKey.set(this.instances.length);\n\t\t};\n\t\tthis._register(this.onDidChangeInstances(() => updateTerminalContextKeys()));\n\t}\n\n\tasync getActiveOrCreateInstance(options?: { acceptsInput?: boolean }): Promise<ITerminalInstance> {\n\t\tconst activeInstance = this.activeInstance;\n\t\t// No instance, create\n\t\tif (!activeInstance) {\n\t\t\treturn this.createTerminal();\n\t\t}\n\t\t// Active instance, ensure accepts input\n\t\tif (!options?.acceptsInput || activeInstance.xterm?.isStdinDisabled !== true) {\n\t\t\treturn activeInstance;\n\t\t}\n\t\t// Active instance doesn't accept input, create and focus\n\t\tconst instance = await this.createTerminal();\n\t\tthis.setActiveInstance(instance);\n\t\tawait this.revealActiveTerminal();\n\t\treturn instance;\n\t}\n\n\tasync revealTerminal(source: ITerminalInstance, preserveFocus?: boolean): Promise<void> {\n\t\tif (source.target === TerminalLocation.Editor) {\n\t\t\tawait this._terminalEditorService.revealActiveEditor(preserveFocus);\n\t\t} else {\n\t\t\tawait this._terminalGroupService.showPanel();\n\t\t}\n\t}\n\n\tasync revealActiveTerminal(preserveFocus?: boolean): Promise<void> {\n\t\tconst instance = this.activeInstance;\n\t\tif (!instance) {\n\t\t\treturn;\n\t\t}\n\t\tawait this.revealTerminal(instance, preserveFocus);\n\t}\n\n\n\n\trequestStartExtensionTerminal(proxy: ITerminalProcessExtHostProxy, cols: number, rows: number): Promise<ITerminalLaunchError | undefined> {\n\t\t// The initial request came from the extension host, no need to wait for it\n\t\treturn new Promise<ITerminalLaunchError | undefined>(callback => {\n\t\t\tthis._onDidRequestStartExtensionTerminal.fire({ proxy, cols, rows, callback });\n\t\t});\n\t}\n\n\tprivate _onBeforeShutdown(reason: ShutdownReason): MaybePromise<boolean> {\n\t\t// Never veto on web as this would block all windows from being closed. This disables\n\t\t// process revive as we can't handle it on shutdown.\n\t\tif (isWeb) {\n\t\t\tthis._isShuttingDown = true;\n\t\t\treturn false;\n\t\t}\n\t\treturn this._onBeforeShutdownAsync(reason);\n\t}\n\n\tprivate async _onBeforeShutdownAsync(reason: ShutdownReason): Promise<boolean> {\n\t\tif (this.instances.length === 0) {\n\t\t\t// No terminal instances, don't veto\n\t\t\treturn false;\n\t\t}\n\n\t\t// Persist terminal _buffer state_, note that even if this happens the dirty terminal prompt\n\t\t// still shows as that cannot be revived\n\t\ttry {\n\t\t\tthis._shutdownWindowCount = await this._nativeDelegate?.getWindowCount();\n\t\t\tconst shouldReviveProcesses = this._shouldReviveProcesses(reason);\n\t\t\tif (shouldReviveProcesses) {\n\t\t\t\t// Attempt to persist the terminal state but only allow 2000ms as we can't block\n\t\t\t\t// shutdown. This can happen when in a remote workspace but the other side has been\n\t\t\t\t// suspended and is in the process of reconnecting, the message will be put in a\n\t\t\t\t// queue in this case for when the connection is back up and running. Aborting the\n\t\t\t\t// process is preferable in this case.\n\t\t\t\tawait Promise.race([\n\t\t\t\t\tthis._primaryBackend?.persistTerminalState(),\n\t\t\t\t\ttimeout(2000)\n\t\t\t\t]);\n\t\t\t}\n\n\t\t\t// Persist terminal _processes_\n\t\t\tconst shouldPersistProcesses = this._terminalConfigurationService.config.enablePersistentSessions && reason === ShutdownReason.RELOAD;\n\t\t\tif (!shouldPersistProcesses) {\n\t\t\t\tconst hasDirtyInstances = (\n\t\t\t\t\t(this._terminalConfigurationService.config.confirmOnExit === 'always' && this.foregroundInstances.length > 0) ||\n\t\t\t\t\t(this._terminalConfigurationService.config.confirmOnExit === 'hasChildProcesses' && this.foregroundInstances.some(e => e.hasChildProcesses))\n\t\t\t\t);\n\t\t\t\tif (hasDirtyInstances) {\n\t\t\t\t\treturn this._onBeforeShutdownConfirmation(reason);\n\t\t\t\t}\n\t\t\t}\n\t\t} catch (err: unknown) {\n\t\t\t// Swallow as exceptions should not cause a veto to prevent shutdown\n\t\t\tthis._logService.warn('Exception occurred during terminal shutdown', err);\n\t\t}\n\n\t\tthis._isShuttingDown = true;\n\n\t\treturn false;\n\t}\n\n\tsetNativeDelegate(nativeDelegate: ITerminalServiceNativeDelegate): void {\n\t\tthis._nativeDelegate = nativeDelegate;\n\t}\n\n\tprivate _shouldReviveProcesses(reason: ShutdownReason): boolean {\n\t\tif (!this._terminalConfigurationService.config.enablePersistentSessions) {\n\t\t\treturn false;\n\t\t}\n\t\tswitch (this._terminalConfigurationService.config.persistentSessionReviveProcess) {\n\t\t\tcase 'onExit': {\n\t\t\t\t// Allow on close if it's the last window on Windows or Linux\n\t\t\t\tif (reason === ShutdownReason.CLOSE && (this._shutdownWindowCount === 1 && !isMacintosh)) {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t\treturn reason === ShutdownReason.LOAD || reason === ShutdownReason.QUIT;\n\t\t\t}\n\t\t\tcase 'onExitAndWindowClose': return reason !== ShutdownReason.RELOAD;\n\t\t\tdefault: return false;\n\t\t}\n\t}\n\n\tprivate async _onBeforeShutdownConfirmation(reason: ShutdownReason): Promise<boolean> {\n\t\t// veto if configured to show confirmation and the user chose not to exit\n\t\tconst veto = await this._showTerminalCloseConfirmation();\n\t\tif (!veto) {\n\t\t\tthis._isShuttingDown = true;\n\t\t}\n\n\t\treturn veto;\n\t}\n\n\tprivate _onWillShutdown(e: WillShutdownEvent): void {\n\t\t// Don't touch processes if the shutdown was a result of reload as they will be reattached\n\t\tconst shouldPersistTerminals = this._terminalConfigurationService.config.enablePersistentSessions && e.reason === ShutdownReason.RELOAD;\n\n\t\tfor (const instance of [...this._terminalGroupService.instances, ...this._backgroundedTerminalInstances.map(bg => bg.instance)]) {\n\t\t\tif (shouldPersistTerminals && instance.shouldPersist) {\n\t\t\t\tinstance.detachProcessAndDispose(TerminalExitReason.Shutdown);\n\t\t\t} else {\n\t\t\t\tinstance.dispose(TerminalExitReason.Shutdown);\n\t\t\t}\n\t\t}\n\n\t\t// Clear terminal layout info only when not persisting\n\t\tif (!shouldPersistTerminals && !this._shouldReviveProcesses(e.reason)) {\n\t\t\tthis._primaryBackend?.setTerminalLayoutInfo(undefined);\n\t\t}\n\t}\n\n\t@debounce(500)\n\tprivate _saveState(): void {\n\t\t// Avoid saving state when shutting down as that would override process state to be revived\n\t\tif (this._isShuttingDown) {\n\t\t\treturn;\n\t\t}\n\t\tif (!this._terminalConfigurationService.config.enablePersistentSessions) {\n\t\t\treturn;\n\t\t}\n\t\tconst tabs = this._terminalGroupService.groups.map(g => g.getLayoutInfo(g === this._terminalGroupService.activeGroup));\n\t\tconst state: ITerminalsLayoutInfoById = { tabs, background: this._backgroundedTerminalInstances.map(bg => bg.instance).filter(i => i.shellLaunchConfig.forcePersist).map(i => i.persistentProcessId).filter((e): e is number => e !== undefined) };\n\t\tthis._primaryBackend?.setTerminalLayoutInfo(state);\n\t}\n\n\t@debounce(500)\n\tprivate _updateTitle(instance: ITerminalInstance | undefined): void {\n\t\tif (!this._terminalConfigurationService.config.enablePersistentSessions || !instance || !instance.persistentProcessId || !instance.title || instance.isDisposed) {\n\t\t\treturn;\n\t\t}\n\t\tif (instance.staticTitle) {\n\t\t\tthis._primaryBackend?.updateTitle(instance.persistentProcessId, instance.staticTitle, TitleEventSource.Api);\n\t\t} else {\n\t\t\tthis._primaryBackend?.updateTitle(instance.persistentProcessId, instance.title, instance.titleSource);\n\t\t}\n\t}\n\n\t@debounce(500)\n\tprivate _updateIcon(instance: ITerminalInstance, userInitiated: boolean): void {\n\t\tif (!this._terminalConfigurationService.config.enablePersistentSessions || !instance || !instance.persistentProcessId || !instance.icon || instance.isDisposed) {\n\t\t\treturn;\n\t\t}\n\t\tthis._primaryBackend?.updateIcon(instance.persistentProcessId, userInitiated, instance.icon, instance.color);\n\t}\n\n\trefreshActiveGroup(): void {\n\t\tthis._onDidChangeActiveGroup.fire(this._terminalGroupService.activeGroup);\n\t}\n\n\tgetInstanceFromId(terminalId: number): ITerminalInstance | undefined {\n\t\tlet bgIndex = -1;\n\t\tthis._backgroundedTerminalInstances.forEach((bg, i) => {\n\t\t\tif (bg.instance.instanceId === terminalId) {\n\t\t\t\tbgIndex = i;\n\t\t\t}\n\t\t});\n\t\tif (bgIndex !== -1) {\n\t\t\treturn this._backgroundedTerminalInstances[bgIndex].instance;\n\t\t}\n\t\ttry {\n\t\t\treturn this.instances[this._getIndexFromId(terminalId)];\n\t\t} catch {\n\t\t\treturn undefined;\n\t\t}\n\t}\n\n\tgetInstanceFromResource(resource: URI | undefined): ITerminalInstance | undefined {\n\t\treturn getInstanceFromResource(this.instances, resource);\n\t}\n\n\topenResource(resource: URI): void {\n\t\tconst instance = this.getInstanceFromResource(resource);\n\t\tif (instance) {\n\t\t\tthis.setActiveInstance(instance);\n\t\t\tthis.revealTerminal(instance);\n\t\t\tconst commands = instance.capabilities.get(TerminalCapability.CommandDetection)?.commands;\n\t\t\tconst params = new URLSearchParams(resource.query);\n\t\t\tconst relevantCommand = commands?.find(c => c.id === params.get('command'));\n\t\t\tif (relevantCommand) {\n\t\t\t\tinstance.xterm?.markTracker.revealCommand(relevantCommand);\n\t\t\t}\n\t\t}\n\t}\n\n\tisAttachedToTerminal(remoteTerm: IRemoteTerminalAttachTarget): boolean {\n\t\treturn this.instances.some(term => term.processId === remoteTerm.pid);\n\t}\n\n\tmoveToEditor(source: ITerminalInstance, group?: GroupIdentifier | SIDE_GROUP_TYPE | ACTIVE_GROUP_TYPE | AUX_WINDOW_GROUP_TYPE): void {\n\t\tif (source.target === TerminalLocation.Editor) {\n\t\t\treturn;\n\t\t}\n\t\tconst sourceGroup = this._terminalGroupService.getGroupForInstance(source);\n\t\tif (!sourceGroup) {\n\t\t\treturn;\n\t\t}\n\t\tsourceGroup.removeInstance(source);\n\t\tthis._terminalEditorService.openEditor(source, group ? { viewColumn: group } : undefined);\n\n\t}\n\n\tmoveIntoNewEditor(source: ITerminalInstance): void {\n\t\tthis.moveToEditor(source, AUX_WINDOW_GROUP);\n\t}\n\n\tasync moveToTerminalView(source?: ITerminalInstance | URI, target?: ITerminalInstance, side?: 'before' | 'after'): Promise<void> {\n\t\tif (URI.isUri(source)) {\n\t\t\tsource = this.getInstanceFromResource(source);\n\t\t}\n\n\t\tif (!source) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._terminalEditorService.detachInstance(source);\n\n\t\tif (source.target !== TerminalLocation.Editor) {\n\t\t\tawait this._terminalGroupService.showPanel(true);\n\t\t\treturn;\n\t\t}\n\t\tsource.target = TerminalLocation.Panel;\n\n\t\tlet group: ITerminalGroup | undefined;\n\t\tif (target) {\n\t\t\tgroup = this._terminalGroupService.getGroupForInstance(target);\n\t\t}\n\n\t\tif (!group) {\n\t\t\tgroup = this._terminalGroupService.createGroup();\n\t\t}\n\n\t\tgroup.addInstance(source);\n\t\tthis.setActiveInstance(source);\n\t\tawait this._terminalGroupService.showPanel(true);\n\n\t\tif (target && side) {\n\t\t\tconst index = group.terminalInstances.indexOf(target) + (side === 'after' ? 1 : 0);\n\t\t\tgroup.moveInstance(source, index, side);\n\t\t}\n\n\t\t// Fire events\n\t\tthis._onDidChangeInstances.fire();\n\t\tthis._onDidChangeActiveGroup.fire(this._terminalGroupService.activeGroup);\n\t}\n\n\tprotected _initInstanceListeners(instance: ITerminalInstance): void {\n\t\tconst instanceDisposables = new DisposableStore();\n\t\tinstanceDisposables.add(instance.onDimensionsChanged(() => {\n\t\t\tthis._onDidChangeInstanceDimensions.fire(instance);\n\t\t\tif (this._terminalConfigurationService.config.enablePersistentSessions && this.isProcessSupportRegistered) {\n\t\t\t\tthis._saveState();\n\t\t\t}\n\t\t}));\n\t\tinstanceDisposables.add(instance.onDidFocus(this._onDidChangeActiveInstance.fire, this._onDidChangeActiveInstance));\n\t\tinstanceDisposables.add(instance.onRequestAddInstanceToGroup(async e => await this._addInstanceToGroup(instance, e)));\n\t\tinstanceDisposables.add(instance.onDidChangeShellType(() => this._extensionService.activateByEvent(`onTerminal:${instance.shellType}`)));\n\t\tinstanceDisposables.add(Event.runAndSubscribe(instance.capabilities.onDidAddCapability, (() => {\n\t\t\tif (instance.capabilities.has(TerminalCapability.CommandDetection)) {\n\t\t\t\tthis._extensionService.activateByEvent(`onTerminalShellIntegration:${instance.shellType}`);\n\t\t\t}\n\t\t})));\n\t\tconst disposeListener = this._register(instance.onDisposed(() => {\n\t\t\tinstanceDisposables.dispose();\n\t\t\tthis._store.delete(disposeListener);\n\t\t}));\n\t}\n\n\tprivate async _addInstanceToGroup(instance: ITerminalInstance, e: IRequestAddInstanceToGroupEvent): Promise<void> {\n\t\tconst terminalIdentifier = parseTerminalUri(e.uri);\n\t\tif (terminalIdentifier.instanceId === undefined) {\n\t\t\treturn;\n\t\t}\n\n\t\tlet sourceInstance: ITerminalInstance | undefined = this.getInstanceFromResource(e.uri);\n\n\t\t// Terminal from a different window\n\t\tif (!sourceInstance) {\n\t\t\tconst attachPersistentProcess = await this._primaryBackend?.requestDetachInstance(terminalIdentifier.workspaceId, terminalIdentifier.instanceId);\n\t\t\tif (attachPersistentProcess) {\n\t\t\t\tsourceInstance = await this.createTerminal({ config: { attachPersistentProcess }, resource: e.uri });\n\t\t\t\tthis._terminalGroupService.moveInstance(sourceInstance, instance, e.side);\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\t// View terminals\n\t\tsourceInstance = this._terminalGroupService.getInstanceFromResource(e.uri);\n\t\tif (sourceInstance) {\n\t\t\tthis._terminalGroupService.moveInstance(sourceInstance, instance, e.side);\n\t\t\treturn;\n\t\t}\n\n\t\t// Terminal editors\n\t\tsourceInstance = this._terminalEditorService.getInstanceFromResource(e.uri);\n\t\tif (sourceInstance) {\n\t\t\tthis.moveToTerminalView(sourceInstance, instance, e.side);\n\t\t\treturn;\n\t\t}\n\t\treturn;\n\t}\n\n\tregisterProcessSupport(isSupported: boolean): void {\n\t\tif (!isSupported) {\n\t\t\treturn;\n\t\t}\n\t\tthis._processSupportContextKey.set(isSupported);\n\t\tthis._onDidRegisterProcessSupport.fire();\n\t}\n\n\t// TODO: Remove this, it should live in group/editor servioce\n\tprivate _getIndexFromId(terminalId: number): number {\n\t\tlet terminalIndex = -1;\n\t\tthis.instances.forEach((terminalInstance, i) => {\n\t\t\tif (terminalInstance.instanceId === terminalId) {\n\t\t\t\tterminalIndex = i;\n\t\t\t}\n\t\t});\n\t\tif (terminalIndex === -1) {\n\t\t\tthrow new Error(`Terminal with ID ${terminalId} does not exist (has it already been disposed?)`);\n\t\t}\n\t\treturn terminalIndex;\n\t}\n\n\tprotected async _showTerminalCloseConfirmation(singleTerminal?: boolean): Promise<boolean> {\n\t\tlet message: string;\n\t\tconst foregroundInstances = this.foregroundInstances;\n\t\tif (foregroundInstances.length === 1 || singleTerminal) {\n\t\t\tmessage = nls.localize('terminalService.terminalCloseConfirmationSingular', \"Do you want to terminate the active terminal session?\");\n\t\t} else {\n\t\t\tmessage = nls.localize('terminalService.terminalCloseConfirmationPlural', \"Do you want to terminate the {0} active terminal sessions?\", foregroundInstances.length);\n\t\t}\n\t\tconst { confirmed } = await this._dialogService.confirm({\n\t\t\ttype: 'warning',\n\t\t\tmessage,\n\t\t\tprimaryButton: nls.localize({ key: 'terminate', comment: ['&& denotes a mnemonic'] }, \"&&Terminate\")\n\t\t});\n\t\treturn !confirmed;\n\t}\n\n\tgetDefaultInstanceHost(): ITerminalInstanceHost {\n\t\tif (this._terminalConfigurationService.defaultLocation === TerminalLocation.Editor) {\n\t\t\treturn this._terminalEditorService;\n\t\t}\n\t\treturn this._terminalGroupService;\n\t}\n\n\tasync getInstanceHost(location: ITerminalLocationOptions | undefined): Promise<ITerminalInstanceHost> {\n\t\tif (location) {\n\t\t\tif (location === TerminalLocation.Editor) {\n\t\t\t\treturn this._terminalEditorService;\n\t\t\t} else if (typeof location === 'object') {\n\t\t\t\tif (hasKey(location, { viewColumn: true })) {\n\t\t\t\t\treturn this._terminalEditorService;\n\t\t\t\t} else if (hasKey(location, { parentTerminal: true })) {\n\t\t\t\t\treturn (await location.parentTerminal).target === TerminalLocation.Editor ? this._terminalEditorService : this._terminalGroupService;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\treturn this._terminalGroupService;\n\t\t\t}\n\t\t}\n\t\treturn this;\n\t}\n\n\tasync createTerminal(options?: ICreateTerminalOptions): Promise<ITerminalInstance> {\n\t\t// Await the initialization of available profiles as long as this is not a pty terminal or a\n\t\t// local terminal in a remote workspace as profile won't be used in those cases and these\n\t\t// terminals need to be launched before remote connections are established.\n\t\tconst isLocalInRemoteTerminal = this._remoteAgentService.getConnection() && URI.isUri(options?.cwd) && options?.cwd.scheme === Schemas.file;\n\t\tif (this._terminalProfileService.availableProfiles.length === 0) {\n\t\t\tconst isPtyTerminal = options?.config && hasKey(options.config, { customPtyImplementation: true });\n\t\t\tif (!isPtyTerminal && !isLocalInRemoteTerminal) {\n\t\t\t\tif (this._connectionState === TerminalConnectionState.Connecting) {\n\t\t\t\t\tmark(`code/terminal/willGetProfiles`);\n\t\t\t\t}\n\t\t\t\tawait this._terminalProfileService.profilesReady;\n\t\t\t\tif (this._connectionState === TerminalConnectionState.Connecting) {\n\t\t\t\t\tmark(`code/terminal/didGetProfiles`);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tlet config = options?.config;\n\t\tif (!config && isLocalInRemoteTerminal) {\n\t\t\tconst backend = await this._terminalInstanceService.getBackend(undefined);\n\t\t\tconst executable = await backend?.getDefaultSystemShell();\n\t\t\tif (executable) {\n\t\t\t\tconfig = { executable };\n\t\t\t}\n\t\t}\n\n\t\tif (!config) {\n\t\t\tconfig = this._terminalProfileService.getDefaultProfile();\n\t\t}\n\t\tconst shellLaunchConfig = config && hasKey(config, { extensionIdentifier: true }) ? {} : this._terminalInstanceService.convertProfileToShellLaunchConfig(config || {});\n\n\t\t// Get the contributed profile if it was provided\n\t\tconst contributedProfile = options?.skipContributedProfileCheck ? undefined : await this._getContributedProfile(shellLaunchConfig, options);\n\n\t\tconst splitActiveTerminal = typeof options?.location === 'object' && hasKey(options.location, { splitActiveTerminal: true })\n\t\t\t? options.location.splitActiveTerminal\n\t\t\t: typeof options?.location === 'object' ? hasKey(options.location, { parentTerminal: true }) : false;\n\n\t\tawait this._resolveCwd(shellLaunchConfig, splitActiveTerminal, options);\n\n\t\t// Launch the contributed profile\n\t\t// If it's a custom pty implementation, we did not await the profiles ready, so\n\t\t// we cannot launch the contributed profile and doing so would cause an error\n\t\tif (!shellLaunchConfig.customPtyImplementation && contributedProfile) {\n\t\t\tconst resolvedLocation = await this.resolveLocation(options?.location);\n\t\t\tlet location: TerminalLocation | { viewColumn: number; preserveState?: boolean } | { splitActiveTerminal: boolean } | undefined;\n\t\t\tif (splitActiveTerminal) {\n\t\t\t\tlocation = resolvedLocation === TerminalLocation.Editor ? { viewColumn: SIDE_GROUP } : { splitActiveTerminal: true };\n\t\t\t} else {\n\t\t\t\tlocation = typeof options?.location === 'object' && hasKey(options.location, { viewColumn: true }) ? options.location : resolvedLocation;\n\t\t\t}\n\t\t\tawait this.createContributedTerminalProfile(contributedProfile.extensionIdentifier, contributedProfile.id, {\n\t\t\t\ticon: contributedProfile.icon,\n\t\t\t\tcolor: contributedProfile.color,\n\t\t\t\tlocation,\n\t\t\t\tcwd: shellLaunchConfig.cwd,\n\t\t\t});\n\t\t\tconst instanceHost = resolvedLocation === TerminalLocation.Editor ? this._terminalEditorService : this._terminalGroupService;\n\t\t\t// TODO@meganrogge: This returns undefined in the remote & web smoke tests but the function\n\t\t\t// does not return undefined. This should be handled correctly.\n\t\t\tconst instance = instanceHost.instances[instanceHost.instances.length - 1];\n\t\t\tawait instance?.focusWhenReady();\n\t\t\tthis._terminalHasBeenCreated.set(true);\n\t\t\treturn instance;\n\t\t}\n\n\t\tif (!shellLaunchConfig.customPtyImplementation && !this.isProcessSupportRegistered) {\n\t\t\tthrow new Error('Could not create terminal when process support is not registered');\n\t\t}\n\n\t\tthis._evaluateLocalCwd(shellLaunchConfig);\n\t\tconst location = await this.resolveLocation(options?.location) || this._terminalConfigurationService.defaultLocation;\n\n\t\tif (shellLaunchConfig.hideFromUser) {\n\t\t\tconst instance = this._terminalInstanceService.createInstance(shellLaunchConfig, location);\n\t\t\tthis._backgroundedTerminalInstances.push({ instance, terminalLocationOptions: options?.location });\n\t\t\tthis._backgroundedTerminalDisposables.set(instance.instanceId, [\n\t\t\t\tinstance.onDisposed(instance => {\n\t\t\t\t\tconst idx = this._backgroundedTerminalInstances.findIndex(bg => bg.instance === instance);\n\t\t\t\t\tif (idx !== -1) {\n\t\t\t\t\t\tthis._backgroundedTerminalInstances.splice(idx, 1);\n\t\t\t\t\t}\n\t\t\t\t\tthis._onDidDisposeInstance.fire(instance);\n\t\t\t\t})\n\t\t\t]);\n\t\t\tthis._onDidChangeInstances.fire();\n\t\t\treturn instance;\n\t\t}\n\n\t\tconst parent = await this._getSplitParent(options?.location);\n\t\tthis._terminalHasBeenCreated.set(true);\n\t\tthis._extensionService.activateByEvent('onTerminal:*');\n\t\tlet instance;\n\t\tif (parent) {\n\t\t\tinstance = this._splitTerminal(shellLaunchConfig, location, parent);\n\t\t} else {\n\t\t\tinstance = this._createTerminal(shellLaunchConfig, location, options);\n\t\t}\n\t\tif (instance.shellType) {\n\t\t\tthis._extensionService.activateByEvent(`onTerminal:${instance.shellType}`);\n\t\t}\n\n\t\treturn instance;\n\t}\n\n\tasync createAndFocusTerminal(options?: ICreateTerminalOptions): Promise<ITerminalInstance> {\n\t\tconst instance = await this.createTerminal(options);\n\t\tthis.setActiveInstance(instance);\n\t\tawait instance.focusWhenReady();\n\t\treturn instance;\n\t}\n\n\tprivate async _getContributedProfile(shellLaunchConfig: IShellLaunchConfig, options?: ICreateTerminalOptions): Promise<IExtensionTerminalProfile | undefined> {\n\t\tif (options?.config && hasKey(options.config, { extensionIdentifier: true })) {\n\t\t\treturn options.config;\n\t\t}\n\n\t\treturn this._terminalProfileService.getContributedDefaultProfile(shellLaunchConfig);\n\t}\n\n\tasync createDetachedTerminal(options: IDetachedXTermOptions): Promise<IDetachedTerminalInstance> {\n\t\tconst ctor = await TerminalInstance.getXtermConstructor(this._keybindingService, this._contextKeyService);\n\t\tconst xterm = this._instantiationService.createInstance(XtermTerminal, undefined, ctor, {\n\t\t\tcols: options.cols,\n\t\t\trows: options.rows,\n\t\t\txtermColorProvider: options.colorProvider,\n\t\t\tcapabilities: options.capabilities || new TerminalCapabilityStore(),\n\t\t}, undefined);\n\n\t\tif (options.readonly) {\n\t\t\txterm.raw.attachCustomKeyEventHandler(() => false);\n\t\t}\n\n\t\tconst instance = new DetachedTerminal(xterm, options, this._instantiationService);\n\t\tthis._detachedXterms.add(instance);\n\t\tconst l = xterm.onDidDispose(() => {\n\t\t\tthis._detachedXterms.delete(instance);\n\t\t\tl.dispose();\n\t\t});\n\n\t\treturn instance;\n\t}\n\n\tprivate async _resolveCwd(shellLaunchConfig: IShellLaunchConfig, splitActiveTerminal: boolean, options?: ICreateTerminalOptions): Promise<void> {\n\t\tconst cwd = shellLaunchConfig.cwd;\n\t\tif (!cwd) {\n\t\t\tif (options?.cwd) {\n\t\t\t\tshellLaunchConfig.cwd = options.cwd;\n\t\t\t} else if (splitActiveTerminal && options?.location) {\n\t\t\t\tlet parent = this.activeInstance;\n\t\t\t\tif (typeof options.location === 'object' && hasKey(options.location, { parentTerminal: true })) {\n\t\t\t\t\tparent = await options.location.parentTerminal;\n\t\t\t\t}\n\t\t\t\tif (!parent) {\n\t\t\t\t\tthrow new Error('Cannot split without an active instance');\n\t\t\t\t}\n\t\t\t\tshellLaunchConfig.cwd = await getCwdForSplit(parent, this._workspaceContextService.getWorkspace().folders, this._commandService, this._terminalConfigurationService);\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate _splitTerminal(shellLaunchConfig: IShellLaunchConfig, location: TerminalLocation, parent: ITerminalInstance): ITerminalInstance {\n\t\tlet instance;\n\t\t// Use the URI from the base instance if it exists, this will correctly split local terminals\n\t\tif (typeof shellLaunchConfig.cwd !== 'object' && typeof parent.shellLaunchConfig.cwd === 'object') {\n\t\t\tshellLaunchConfig.cwd = URI.from({\n\t\t\t\tscheme: parent.shellLaunchConfig.cwd.scheme,\n\t\t\t\tauthority: parent.shellLaunchConfig.cwd.authority,\n\t\t\t\tpath: shellLaunchConfig.cwd || parent.shellLaunchConfig.cwd.path\n\t\t\t});\n\t\t}\n\t\tif (location === TerminalLocation.Editor || parent.target === TerminalLocation.Editor) {\n\t\t\tinstance = this._terminalEditorService.splitInstance(parent, shellLaunchConfig);\n\t\t} else {\n\t\t\tconst group = this._terminalGroupService.getGroupForInstance(parent);\n\t\t\tif (!group) {\n\t\t\t\tthrow new Error(`Cannot split a terminal without a group (instanceId: ${parent.instanceId}, title: ${parent.title})`);\n\t\t\t}\n\t\t\tshellLaunchConfig.parentTerminalId = parent.instanceId;\n\t\t\tinstance = group.split(shellLaunchConfig);\n\t\t}\n\t\treturn instance;\n\t}\n\n\tprivate _createTerminal(shellLaunchConfig: IShellLaunchConfig, location: TerminalLocation, options?: ICreateTerminalOptions): ITerminalInstance {\n\t\tlet instance;\n\t\tif (location === TerminalLocation.Editor) {\n\t\t\tinstance = this._terminalInstanceService.createInstance(shellLaunchConfig, TerminalLocation.Editor);\n\t\t\tif (!shellLaunchConfig.hideFromUser) {\n\t\t\t\tconst editorOptions = this._getEditorOptions(options?.location);\n\t\t\t\tthis._terminalEditorService.openEditor(instance, editorOptions);\n\t\t\t}\n\t\t} else {\n\t\t\t// TODO: pass resource?\n\t\t\tconst group = this._terminalGroupService.createGroup(shellLaunchConfig);\n\t\t\tinstance = group.terminalInstances[0];\n\t\t}\n\t\treturn instance;\n\t}\n\n\tasync resolveLocation(location?: ITerminalLocationOptions): Promise<TerminalLocation | undefined> {\n\t\tif (location && typeof location === 'object') {\n\t\t\tif (hasKey(location, { parentTerminal: true })) {\n\t\t\t\t// since we don't set the target unless it's an editor terminal, this is necessary\n\t\t\t\tconst parentTerminal = await location.parentTerminal;\n\t\t\t\treturn !parentTerminal.target ? TerminalLocation.Panel : parentTerminal.target;\n\t\t\t} else if (hasKey(location, { viewColumn: true })) {\n\t\t\t\treturn TerminalLocation.Editor;\n\t\t\t} else if (hasKey(location, { splitActiveTerminal: true })) {\n\t\t\t\t// since we don't set the target unless it's an editor terminal, this is necessary\n\t\t\t\treturn !this._activeInstance?.target ? TerminalLocation.Panel : this._activeInstance?.target;\n\t\t\t}\n\t\t}\n\t\treturn location;\n\t}\n\n\tprivate async _getSplitParent(location?: ITerminalLocationOptions): Promise<ITerminalInstance | undefined> {\n\t\tif (location && typeof location === 'object' && hasKey(location, { parentTerminal: true })) {\n\t\t\treturn location.parentTerminal;\n\t\t} else if (location && typeof location === 'object' && hasKey(location, { splitActiveTerminal: true })) {\n\t\t\treturn this.activeInstance;\n\t\t}\n\t\treturn undefined;\n\t}\n\n\tprivate _getEditorOptions(location?: ITerminalLocationOptions): TerminalEditorLocation | undefined {\n\t\tif (location && typeof location === 'object' && hasKey(location, { viewColumn: true })) {\n\t\t\t// Terminal-specific workaround to resolve the active group in auxiliary windows to\n\t\t\t// override the locked editor behavior.\n\t\t\tif (location.viewColumn === ACTIVE_GROUP && isAuxiliaryWindow(getActiveWindow())) {\n\t\t\t\tlocation.viewColumn = this._editorGroupsService.activeGroup.id;\n\t\t\t\treturn location;\n\t\t\t}\n\t\t\tlocation.viewColumn = columnToEditorGroup(this._editorGroupsService, this._configurationService, location.viewColumn);\n\t\t\treturn location;\n\t\t}\n\t\treturn undefined;\n\t}\n\n\tprivate _evaluateLocalCwd(shellLaunchConfig: IShellLaunchConfig) {\n\t\t// Add welcome message and title annotation for local terminals launched within remote or\n\t\t// virtual workspaces\n\t\tif (!isString(shellLaunchConfig.cwd) && shellLaunchConfig.cwd?.scheme === Schemas.file) {\n\t\t\tif (VirtualWorkspaceContext.getValue(this._contextKeyService)) {\n\t\t\t\tshellLaunchConfig.initialText = formatMessageForTerminal(nls.localize('localTerminalVirtualWorkspace', \"This shell is open to a {0}local{1} folder, NOT to the virtual folder\", '\\x1b[3m', '\\x1b[23m'), { excludeLeadingNewLine: true, loudFormatting: true });\n\t\t\t\tshellLaunchConfig.type = 'Local';\n\t\t\t} else if (this._remoteAgentService.getConnection()) {\n\t\t\t\tshellLaunchConfig.initialText = formatMessageForTerminal(nls.localize('localTerminalRemote', \"This shell is running on your {0}local{1} machine, NOT on the connected remote machine\", '\\x1b[3m', '\\x1b[23m'), { excludeLeadingNewLine: true, loudFormatting: true });\n\t\t\t\tshellLaunchConfig.type = 'Local';\n\t\t\t}\n\t\t}\n\t}\n\n\tpublic async showBackgroundTerminal(instance: ITerminalInstance, suppressSetActive?: boolean): Promise<void> {\n\t\tconst index = this._backgroundedTerminalInstances.findIndex(bg => bg.instance === instance);\n\t\tif (index === -1) {\n\t\t\treturn;\n\t\t}\n\t\tconst backgroundTerminal = this._backgroundedTerminalInstances[index];\n\t\tthis._backgroundedTerminalInstances.splice(index, 1);\n\t\tconst disposables = this._backgroundedTerminalDisposables.get(instance.instanceId);\n\t\tif (disposables) {\n\t\t\tdispose(disposables);\n\t\t}\n\t\tthis._backgroundedTerminalDisposables.delete(instance.instanceId);\n\t\tif (instance.target === TerminalLocation.Panel) {\n\t\t\tthis._terminalGroupService.createGroup(instance);\n\n\t\t\t// Make active automatically if it's the first instance\n\t\t\tif (this.instances.length === 1 && !suppressSetActive) {\n\t\t\t\tthis._terminalGroupService.setActiveInstanceByIndex(0);\n\t\t\t}\n\t\t} else {\n\t\t\tconst editorOptions = backgroundTerminal.terminalLocationOptions ? this._getEditorOptions(backgroundTerminal.terminalLocationOptions) : this._getEditorOptions(instance.target);\n\t\t\tthis._terminalEditorService.openEditor(instance, editorOptions);\n\t\t}\n\n\t\tthis._onDidChangeInstances.fire();\n\t}\n\n\tasync setContainers(panelContainer: HTMLElement, terminalContainer: HTMLElement): Promise<void> {\n\t\tthis._terminalConfigurationService.setPanelContainer(panelContainer);\n\t\tthis._terminalGroupService.setContainer(terminalContainer);\n\t}\n\n\n\n\tcreateOnInstanceEvent<T>(getEvent: (instance: ITerminalInstance) => Event<T>): DynamicListEventMultiplexer<ITerminalInstance, T> {\n\t\treturn new DynamicListEventMultiplexer(this.instances, this.onDidCreateInstance, this.onDidDisposeInstance, getEvent);\n\t}\n\n\tcreateOnInstanceCapabilityEvent<T extends TerminalCapability, K>(capabilityId: T, getEvent: (capability: ITerminalCapabilityImplMap[T]) => Event<K>): IDynamicListEventMultiplexer<{ instance: ITerminalInstance; data: K }> {\n\t\treturn createInstanceCapabilityEventMultiplexer(this.instances, this.onDidCreateInstance, this.onDidDisposeInstance, capabilityId, getEvent);\n\t}\n}\n\nclass TerminalEditorStyle extends Themable {\n\tprivate _styleElement: HTMLElement;\n\n\tconstructor(\n\t\tcontainer: HTMLElement,\n\t\t@ITerminalService private readonly _terminalService: ITerminalService,\n\t\t@IThemeService private readonly _themeService: IThemeService,\n\t\t@ITerminalProfileService private readonly _terminalProfileService: ITerminalProfileService,\n\t\t@IEditorService private readonly _editorService: IEditorService\n\t) {\n\t\tsuper(_themeService);\n\t\tthis._registerListeners();\n\t\tthis._styleElement = domStylesheets.createStyleSheet(container);\n\t\tthis._register(toDisposable(() => this._styleElement.remove()));\n\t\tthis.updateStyles();\n\t}\n\n\tprivate _registerListeners(): void {\n\t\tthis._register(this._terminalService.onAnyInstanceIconChange(() => this.updateStyles()));\n\t\tthis._register(this._terminalService.onDidCreateInstance(() => this.updateStyles()));\n\t\tthis._register(this._editorService.onDidActiveEditorChange(() => {\n\t\t\tif (this._editorService.activeEditor instanceof TerminalEditorInput) {\n\t\t\t\tthis.updateStyles();\n\t\t\t}\n\t\t}));\n\t\tthis._register(this._editorService.onDidCloseEditor(() => {\n\t\t\tif (this._editorService.activeEditor instanceof TerminalEditorInput) {\n\t\t\t\tthis.updateStyles();\n\t\t\t}\n\t\t}));\n\t\tthis._register(this._terminalProfileService.onDidChangeAvailableProfiles(() => this.updateStyles()));\n\t}\n\n\toverride updateStyles(): void {\n\t\tsuper.updateStyles();\n\t\tconst colorTheme = this._themeService.getColorTheme();\n\n\t\t// TODO: add a rule collector to avoid duplication\n\t\tlet css = '';\n\n\t\tconst productIconTheme = this._themeService.getProductIconTheme();\n\n\t\t// Add icons\n\t\tfor (const instance of this._terminalService.instances) {\n\t\t\tconst icon = instance.icon;\n\t\t\tif (!icon) {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tlet uri = undefined;\n\t\t\tif (icon instanceof URI) {\n\t\t\t\turi = icon;\n\t\t\t} else if (icon instanceof Object && hasKey(icon, { light: true, dark: true })) {\n\t\t\t\turi = isDark(colorTheme.type) ? icon.dark : icon.light;\n\t\t\t}\n\t\t\tconst iconClasses = getUriClasses(instance, colorTheme.type);\n\t\t\tif (uri instanceof URI && iconClasses && iconClasses.length > 1) {\n\t\t\t\tcss += (\n\t\t\t\t\tcssValue.inline`.monaco-workbench .terminal-tab.${cssValue.className(iconClasses[0])}::before\n\t\t\t\t\t{content: ''; background-image: ${cssValue.asCSSUrl(uri)};}`\n\t\t\t\t);\n\t\t\t}\n\t\t\tif (ThemeIcon.isThemeIcon(icon)) {\n\t\t\t\tconst iconRegistry = getIconRegistry();\n\t\t\t\tconst iconContribution = iconRegistry.getIcon(icon.id);\n\t\t\t\tif (iconContribution) {\n\t\t\t\t\tconst def = productIconTheme.getIcon(iconContribution);\n\t\t\t\t\tif (def) {\n\t\t\t\t\t\tcss += cssValue.inline`.monaco-workbench .terminal-tab.codicon-${cssValue.className(icon.id)}::before\n\t\t\t\t\t\t\t{content: ${cssValue.stringValue(def.fontCharacter)} !important; font-family: ${cssValue.stringValue(def.font?.id ?? 'codicon')} !important;}`;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// Add colors\n\t\tconst iconForegroundColor = colorTheme.getColor(iconForeground);\n\t\tif (iconForegroundColor) {\n\t\t\tcss += cssValue.inline`.monaco-workbench .show-file-icons .file-icon.terminal-tab::before { color: ${iconForegroundColor}; }`;\n\t\t}\n\n\t\tcss += getColorStyleContent(colorTheme, true);\n\t\tthis._styleElement.textContent = css;\n\t}\n}\n"]}