{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/contrib/terminal/browser/terminalConfigurationService.ts","vs/workbench/contrib/terminal/browser/terminalConfigurationService.ts"],"names":[],"mappings":"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","file":"terminalConfigurationService.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Emitter, Event } from '../../../../base/common/event.js';\nimport { Disposable, toDisposable } from '../../../../base/common/lifecycle.js';\nimport { type IEditorOptions } from '../../../../editor/common/config/editorOptions.js';\nimport { EDITOR_FONT_DEFAULTS } from '../../../../editor/common/config/fontInfo.js';\nimport { IConfigurationService } from '../../../../platform/configuration/common/configuration.js';\nimport { ITerminalConfigurationService, LinuxDistro } from './terminal.js';\nimport type { IXtermCore } from './xterm-private.js';\nimport { DEFAULT_BOLD_FONT_WEIGHT, DEFAULT_FONT_WEIGHT, DEFAULT_LETTER_SPACING, DEFAULT_LINE_HEIGHT, FontWeight, ITerminalConfiguration, MAXIMUM_FONT_WEIGHT, MINIMUM_FONT_WEIGHT, MINIMUM_LETTER_SPACING, TERMINAL_CONFIG_SECTION, type ITerminalFont } from '../common/terminal.js';\nimport { isMacintosh } from '../../../../base/common/platform.js';\nimport { TerminalLocation, TerminalLocationConfigValue } from '../../../../platform/terminal/common/terminal.js';\nimport { isString } from '../../../../base/common/types.js';\nimport { clamp } from '../../../../base/common/numbers.js';\n\n// #region TerminalConfigurationService\n\nexport class TerminalConfigurationService extends Disposable implements ITerminalConfigurationService {\n\tdeclare _serviceBrand: undefined;\n\n\tprotected _fontMetrics: TerminalFontMetrics;\n\n\tprotected _config!: Readonly<ITerminalConfiguration>;\n\tget config() { return this._config; }\n\n\tget defaultLocation(): TerminalLocation {\n\t\tif (this.config.defaultLocation === TerminalLocationConfigValue.Editor) {\n\t\t\treturn TerminalLocation.Editor;\n\t\t}\n\t\treturn TerminalLocation.Panel;\n\t}\n\n\tprivate readonly _onConfigChanged = new Emitter<void>();\n\tget onConfigChanged(): Event<void> { return this._onConfigChanged.event; }\n\n\tconstructor(\n\t\t@IConfigurationService private readonly _configurationService: IConfigurationService,\n\t) {\n\t\tsuper();\n\n\t\tthis._fontMetrics = this._register(new TerminalFontMetrics(this, this._configurationService));\n\n\t\tthis._register(Event.runAndSubscribe(this._configurationService.onDidChangeConfiguration, e => {\n\t\t\tif (!e || e.affectsConfiguration(TERMINAL_CONFIG_SECTION)) {\n\t\t\t\tthis._updateConfig();\n\t\t\t}\n\t\t}));\n\t}\n\n\tsetPanelContainer(panelContainer: HTMLElement): void { return this._fontMetrics.setPanelContainer(panelContainer); }\n\tconfigFontIsMonospace(): boolean { return this._fontMetrics.configFontIsMonospace(); }\n\tgetFont(w: Window, xtermCore?: IXtermCore, excludeDimensions?: boolean): ITerminalFont { return this._fontMetrics.getFont(w, xtermCore, excludeDimensions); }\n\n\tprivate _updateConfig(): void {\n\t\tconst configValues = { ...this._configurationService.getValue<ITerminalConfiguration>(TERMINAL_CONFIG_SECTION) };\n\t\tconfigValues.fontWeight = this._normalizeFontWeight(configValues.fontWeight, DEFAULT_FONT_WEIGHT);\n\t\tconfigValues.fontWeightBold = this._normalizeFontWeight(configValues.fontWeightBold, DEFAULT_BOLD_FONT_WEIGHT);\n\t\tthis._config = configValues;\n\t\tthis._onConfigChanged.fire();\n\t}\n\n\tprivate _normalizeFontWeight(input: FontWeight, defaultWeight: FontWeight): FontWeight {\n\t\tif (input === 'normal' || input === 'bold') {\n\t\t\treturn input;\n\t\t}\n\t\treturn clampInt(input, MINIMUM_FONT_WEIGHT, MAXIMUM_FONT_WEIGHT, defaultWeight);\n\t}\n}\n\n// #endregion TerminalConfigurationService\n\n// #region TerminalFontMetrics\n\nconst enum FontConstants {\n\tMinimumFontSize = 6,\n\tMaximumFontSize = 100,\n}\n\nexport class TerminalFontMetrics extends Disposable {\n\tprivate _panelContainer: HTMLElement | undefined;\n\tprivate _charMeasureElement: HTMLElement | undefined;\n\tprivate _lastFontMeasurement: ITerminalFont | undefined;\n\n\tlinuxDistro: LinuxDistro = LinuxDistro.Unknown;\n\n\tconstructor(\n\t\tprivate readonly _terminalConfigurationService: ITerminalConfigurationService,\n\t\tprivate readonly _configurationService: IConfigurationService,\n\t) {\n\t\tsuper();\n\t\tthis._register(toDisposable(() => this._charMeasureElement?.remove()));\n\t}\n\n\tsetPanelContainer(panelContainer: HTMLElement): void {\n\t\tthis._panelContainer = panelContainer;\n\t}\n\n\tconfigFontIsMonospace(): boolean {\n\t\tconst fontSize = 15;\n\t\tconst fontFamily = this._terminalConfigurationService.config.fontFamily || this._configurationService.getValue<IEditorOptions>('editor').fontFamily || EDITOR_FONT_DEFAULTS.fontFamily;\n\t\tconst iRect = this._getBoundingRectFor('i', fontFamily, fontSize);\n\t\tconst wRect = this._getBoundingRectFor('w', fontFamily, fontSize);\n\n\t\t// Check for invalid bounds, there is no reason to believe the font is not monospace\n\t\tif (!iRect || !wRect || !iRect.width || !wRect.width) {\n\t\t\treturn true;\n\t\t}\n\n\t\treturn iRect.width === wRect.width;\n\t}\n\n\t/**\n\t * Gets the font information based on the terminal.integrated.fontFamily\n\t * terminal.integrated.fontSize, terminal.integrated.lineHeight configuration properties\n\t */\n\tgetFont(w: Window, xtermCore?: IXtermCore, excludeDimensions?: boolean): ITerminalFont {\n\t\tconst editorConfig = this._configurationService.getValue<IEditorOptions>('editor');\n\n\t\tlet fontFamily = this._terminalConfigurationService.config.fontFamily || editorConfig.fontFamily || EDITOR_FONT_DEFAULTS.fontFamily || 'monospace';\n\t\tlet fontSize = clampInt(this._terminalConfigurationService.config.fontSize, FontConstants.MinimumFontSize, FontConstants.MaximumFontSize, EDITOR_FONT_DEFAULTS.fontSize);\n\n\t\t// Work around bad font on Fedora/Ubuntu\n\t\tif (!this._terminalConfigurationService.config.fontFamily) {\n\t\t\tif (this.linuxDistro === LinuxDistro.Fedora) {\n\t\t\t\tfontFamily = '\\'DejaVu Sans Mono\\'';\n\t\t\t}\n\t\t\tif (this.linuxDistro === LinuxDistro.Ubuntu) {\n\t\t\t\tfontFamily = '\\'Ubuntu Mono\\'';\n\n\t\t\t\t// Ubuntu mono is somehow smaller, so set fontSize a bit larger to get the same perceived size.\n\t\t\t\tfontSize = clampInt(fontSize + 2, FontConstants.MinimumFontSize, FontConstants.MaximumFontSize, EDITOR_FONT_DEFAULTS.fontSize);\n\t\t\t}\n\t\t}\n\n\t\t// Always fallback to monospace, otherwise a proportional font may become the default\n\t\tfontFamily += ', monospace';\n\n\t\t// Always fallback to AppleBraille on macOS, otherwise braille will render with filled and\n\t\t// empty circles in all 8 positions, instead of just filled circles\n\t\t// See https://github.com/microsoft/vscode/issues/174521\n\t\tif (isMacintosh) {\n\t\t\tfontFamily += ', AppleBraille';\n\t\t}\n\n\t\tconst letterSpacing = this._terminalConfigurationService.config.letterSpacing ? Math.max(Math.floor(this._terminalConfigurationService.config.letterSpacing), MINIMUM_LETTER_SPACING) : DEFAULT_LETTER_SPACING;\n\t\tconst lineHeight = this._terminalConfigurationService.config.lineHeight ? Math.max(this._terminalConfigurationService.config.lineHeight, 1) : DEFAULT_LINE_HEIGHT;\n\n\t\tif (excludeDimensions) {\n\t\t\treturn {\n\t\t\t\tfontFamily,\n\t\t\t\tfontSize,\n\t\t\t\tletterSpacing,\n\t\t\t\tlineHeight\n\t\t\t};\n\t\t}\n\n\t\t// Get the character dimensions from xterm if it's available\n\t\tif (xtermCore?._renderService?._renderer.value) {\n\t\t\tconst cellDims = xtermCore._renderService.dimensions.css.cell;\n\t\t\tif (cellDims?.width && cellDims?.height) {\n\t\t\t\treturn {\n\t\t\t\t\tfontFamily,\n\t\t\t\t\tfontSize,\n\t\t\t\t\tletterSpacing,\n\t\t\t\t\tlineHeight,\n\t\t\t\t\tcharHeight: cellDims.height / lineHeight,\n\t\t\t\t\tcharWidth: cellDims.width - Math.round(letterSpacing) / w.devicePixelRatio\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\n\t\t// Fall back to measuring the font ourselves\n\t\treturn this._measureFont(w, fontFamily, fontSize, letterSpacing, lineHeight);\n\t}\n\n\tprivate _createCharMeasureElementIfNecessary(): HTMLElement {\n\t\tif (!this._panelContainer) {\n\t\t\tthrow new Error('Cannot measure element when terminal is not attached');\n\t\t}\n\t\t// Create charMeasureElement if it hasn't been created or if it was orphaned by its parent\n\t\tif (!this._charMeasureElement || !this._charMeasureElement.parentElement) {\n\t\t\tthis._charMeasureElement = document.createElement('div');\n\t\t\tthis._panelContainer.appendChild(this._charMeasureElement);\n\t\t}\n\t\treturn this._charMeasureElement;\n\t}\n\n\tprivate _getBoundingRectFor(char: string, fontFamily: string, fontSize: number): ClientRect | DOMRect | undefined {\n\t\tlet charMeasureElement: HTMLElement;\n\t\ttry {\n\t\t\tcharMeasureElement = this._createCharMeasureElementIfNecessary();\n\t\t} catch {\n\t\t\treturn undefined;\n\t\t}\n\t\tconst style = charMeasureElement.style;\n\t\tstyle.display = 'inline-block';\n\t\tstyle.fontFamily = fontFamily;\n\t\tstyle.fontSize = fontSize + 'px';\n\t\tstyle.lineHeight = 'normal';\n\t\tcharMeasureElement.innerText = char;\n\t\tconst rect = charMeasureElement.getBoundingClientRect();\n\t\tstyle.display = 'none';\n\n\t\treturn rect;\n\t}\n\n\tprivate _measureFont(w: Window, fontFamily: string, fontSize: number, letterSpacing: number, lineHeight: number): ITerminalFont {\n\t\tconst rect = this._getBoundingRectFor('X', fontFamily, fontSize);\n\n\t\t// Bounding client rect was invalid, use last font measurement if available.\n\t\tif (this._lastFontMeasurement && (!rect || !rect.width || !rect.height)) {\n\t\t\treturn this._lastFontMeasurement;\n\t\t}\n\n\t\tthis._lastFontMeasurement = {\n\t\t\tfontFamily,\n\t\t\tfontSize,\n\t\t\tletterSpacing,\n\t\t\tlineHeight,\n\t\t\tcharWidth: 0,\n\t\t\tcharHeight: 0\n\t\t};\n\n\t\tif (rect && rect.width && rect.height) {\n\t\t\tthis._lastFontMeasurement.charHeight = Math.ceil(rect.height);\n\t\t\t// Char width is calculated differently for DOM and the other renderer types. Refer to\n\t\t\t// how each renderer updates their dimensions in xterm.js\n\t\t\tif (this._terminalConfigurationService.config.gpuAcceleration === 'off') {\n\t\t\t\tthis._lastFontMeasurement.charWidth = rect.width;\n\t\t\t} else {\n\t\t\t\tconst deviceCharWidth = Math.floor(rect.width * w.devicePixelRatio);\n\t\t\t\tconst deviceCellWidth = deviceCharWidth + Math.round(letterSpacing);\n\t\t\t\tconst cssCellWidth = deviceCellWidth / w.devicePixelRatio;\n\t\t\t\tthis._lastFontMeasurement.charWidth = cssCellWidth - Math.round(letterSpacing) / w.devicePixelRatio;\n\t\t\t}\n\t\t}\n\n\t\treturn this._lastFontMeasurement;\n\t}\n}\n\n// #endregion TerminalFontMetrics\n\n// #region Utils\n\nfunction clampInt<T>(source: string | number, minimum: number, maximum: number, fallback: T): number | T {\n\tif (source === null || source === undefined) {\n\t\treturn fallback;\n\t}\n\tconst r = isString(source) ? parseInt(source, 10) : source;\n\tif (isNaN(r)) {\n\t\treturn fallback;\n\t}\n\treturn clamp(r, minimum, maximum);\n}\n// #endregion Utils\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Emitter, Event } from '../../../../base/common/event.js';\nimport { Disposable, toDisposable } from '../../../../base/common/lifecycle.js';\nimport { type IEditorOptions } from '../../../../editor/common/config/editorOptions.js';\nimport { EDITOR_FONT_DEFAULTS } from '../../../../editor/common/config/fontInfo.js';\nimport { IConfigurationService } from '../../../../platform/configuration/common/configuration.js';\nimport { ITerminalConfigurationService, LinuxDistro } from './terminal.js';\nimport type { IXtermCore } from './xterm-private.js';\nimport { DEFAULT_BOLD_FONT_WEIGHT, DEFAULT_FONT_WEIGHT, DEFAULT_LETTER_SPACING, DEFAULT_LINE_HEIGHT, FontWeight, ITerminalConfiguration, MAXIMUM_FONT_WEIGHT, MINIMUM_FONT_WEIGHT, MINIMUM_LETTER_SPACING, TERMINAL_CONFIG_SECTION, type ITerminalFont } from '../common/terminal.js';\nimport { isMacintosh } from '../../../../base/common/platform.js';\nimport { TerminalLocation, TerminalLocationConfigValue } from '../../../../platform/terminal/common/terminal.js';\nimport { isString } from '../../../../base/common/types.js';\nimport { clamp } from '../../../../base/common/numbers.js';\n\n// #region TerminalConfigurationService\n\nexport class TerminalConfigurationService extends Disposable implements ITerminalConfigurationService {\n\tdeclare _serviceBrand: undefined;\n\n\tprotected _fontMetrics: TerminalFontMetrics;\n\n\tprotected _config!: Readonly<ITerminalConfiguration>;\n\tget config() { return this._config; }\n\n\tget defaultLocation(): TerminalLocation {\n\t\tif (this.config.defaultLocation === TerminalLocationConfigValue.Editor) {\n\t\t\treturn TerminalLocation.Editor;\n\t\t}\n\t\treturn TerminalLocation.Panel;\n\t}\n\n\tprivate readonly _onConfigChanged = new Emitter<void>();\n\tget onConfigChanged(): Event<void> { return this._onConfigChanged.event; }\n\n\tconstructor(\n\t\t@IConfigurationService private readonly _configurationService: IConfigurationService,\n\t) {\n\t\tsuper();\n\n\t\tthis._fontMetrics = this._register(new TerminalFontMetrics(this, this._configurationService));\n\n\t\tthis._register(Event.runAndSubscribe(this._configurationService.onDidChangeConfiguration, e => {\n\t\t\tif (!e || e.affectsConfiguration(TERMINAL_CONFIG_SECTION)) {\n\t\t\t\tthis._updateConfig();\n\t\t\t}\n\t\t}));\n\t}\n\n\tsetPanelContainer(panelContainer: HTMLElement): void { return this._fontMetrics.setPanelContainer(panelContainer); }\n\tconfigFontIsMonospace(): boolean { return this._fontMetrics.configFontIsMonospace(); }\n\tgetFont(w: Window, xtermCore?: IXtermCore, excludeDimensions?: boolean): ITerminalFont { return this._fontMetrics.getFont(w, xtermCore, excludeDimensions); }\n\n\tprivate _updateConfig(): void {\n\t\tconst configValues = { ...this._configurationService.getValue<ITerminalConfiguration>(TERMINAL_CONFIG_SECTION) };\n\t\tconfigValues.fontWeight = this._normalizeFontWeight(configValues.fontWeight, DEFAULT_FONT_WEIGHT);\n\t\tconfigValues.fontWeightBold = this._normalizeFontWeight(configValues.fontWeightBold, DEFAULT_BOLD_FONT_WEIGHT);\n\t\tthis._config = configValues;\n\t\tthis._onConfigChanged.fire();\n\t}\n\n\tprivate _normalizeFontWeight(input: FontWeight, defaultWeight: FontWeight): FontWeight {\n\t\tif (input === 'normal' || input === 'bold') {\n\t\t\treturn input;\n\t\t}\n\t\treturn clampInt(input, MINIMUM_FONT_WEIGHT, MAXIMUM_FONT_WEIGHT, defaultWeight);\n\t}\n}\n\n// #endregion TerminalConfigurationService\n\n// #region TerminalFontMetrics\n\nconst enum FontConstants {\n\tMinimumFontSize = 6,\n\tMaximumFontSize = 100,\n}\n\nexport class TerminalFontMetrics extends Disposable {\n\tprivate _panelContainer: HTMLElement | undefined;\n\tprivate _charMeasureElement: HTMLElement | undefined;\n\tprivate _lastFontMeasurement: ITerminalFont | undefined;\n\n\tlinuxDistro: LinuxDistro = LinuxDistro.Unknown;\n\n\tconstructor(\n\t\tprivate readonly _terminalConfigurationService: ITerminalConfigurationService,\n\t\tprivate readonly _configurationService: IConfigurationService,\n\t) {\n\t\tsuper();\n\t\tthis._register(toDisposable(() => this._charMeasureElement?.remove()));\n\t}\n\n\tsetPanelContainer(panelContainer: HTMLElement): void {\n\t\tthis._panelContainer = panelContainer;\n\t}\n\n\tconfigFontIsMonospace(): boolean {\n\t\tconst fontSize = 15;\n\t\tconst fontFamily = this._terminalConfigurationService.config.fontFamily || this._configurationService.getValue<IEditorOptions>('editor').fontFamily || EDITOR_FONT_DEFAULTS.fontFamily;\n\t\tconst iRect = this._getBoundingRectFor('i', fontFamily, fontSize);\n\t\tconst wRect = this._getBoundingRectFor('w', fontFamily, fontSize);\n\n\t\t// Check for invalid bounds, there is no reason to believe the font is not monospace\n\t\tif (!iRect || !wRect || !iRect.width || !wRect.width) {\n\t\t\treturn true;\n\t\t}\n\n\t\treturn iRect.width === wRect.width;\n\t}\n\n\t/**\n\t * Gets the font information based on the terminal.integrated.fontFamily\n\t * terminal.integrated.fontSize, terminal.integrated.lineHeight configuration properties\n\t */\n\tgetFont(w: Window, xtermCore?: IXtermCore, excludeDimensions?: boolean): ITerminalFont {\n\t\tconst editorConfig = this._configurationService.getValue<IEditorOptions>('editor');\n\n\t\tlet fontFamily = this._terminalConfigurationService.config.fontFamily || editorConfig.fontFamily || EDITOR_FONT_DEFAULTS.fontFamily || 'monospace';\n\t\tlet fontSize = clampInt(this._terminalConfigurationService.config.fontSize, FontConstants.MinimumFontSize, FontConstants.MaximumFontSize, EDITOR_FONT_DEFAULTS.fontSize);\n\n\t\t// Work around bad font on Fedora/Ubuntu\n\t\tif (!this._terminalConfigurationService.config.fontFamily) {\n\t\t\tif (this.linuxDistro === LinuxDistro.Fedora) {\n\t\t\t\tfontFamily = '\\'DejaVu Sans Mono\\'';\n\t\t\t}\n\t\t\tif (this.linuxDistro === LinuxDistro.Ubuntu) {\n\t\t\t\tfontFamily = '\\'Ubuntu Mono\\'';\n\n\t\t\t\t// Ubuntu mono is somehow smaller, so set fontSize a bit larger to get the same perceived size.\n\t\t\t\tfontSize = clampInt(fontSize + 2, FontConstants.MinimumFontSize, FontConstants.MaximumFontSize, EDITOR_FONT_DEFAULTS.fontSize);\n\t\t\t}\n\t\t}\n\n\t\t// Always fallback to monospace, otherwise a proportional font may become the default\n\t\tfontFamily += ', monospace';\n\n\t\t// Always fallback to AppleBraille on macOS, otherwise braille will render with filled and\n\t\t// empty circles in all 8 positions, instead of just filled circles\n\t\t// See https://github.com/microsoft/vscode/issues/174521\n\t\tif (isMacintosh) {\n\t\t\tfontFamily += ', AppleBraille';\n\t\t}\n\n\t\tconst letterSpacing = this._terminalConfigurationService.config.letterSpacing ? Math.max(Math.floor(this._terminalConfigurationService.config.letterSpacing), MINIMUM_LETTER_SPACING) : DEFAULT_LETTER_SPACING;\n\t\tconst lineHeight = this._terminalConfigurationService.config.lineHeight ? Math.max(this._terminalConfigurationService.config.lineHeight, 1) : DEFAULT_LINE_HEIGHT;\n\n\t\tif (excludeDimensions) {\n\t\t\treturn {\n\t\t\t\tfontFamily,\n\t\t\t\tfontSize,\n\t\t\t\tletterSpacing,\n\t\t\t\tlineHeight\n\t\t\t};\n\t\t}\n\n\t\t// Get the character dimensions from xterm if it's available\n\t\tif (xtermCore?._renderService?._renderer.value) {\n\t\t\tconst cellDims = xtermCore._renderService.dimensions.css.cell;\n\t\t\tif (cellDims?.width && cellDims?.height) {\n\t\t\t\treturn {\n\t\t\t\t\tfontFamily,\n\t\t\t\t\tfontSize,\n\t\t\t\t\tletterSpacing,\n\t\t\t\t\tlineHeight,\n\t\t\t\t\tcharHeight: cellDims.height / lineHeight,\n\t\t\t\t\tcharWidth: cellDims.width - Math.round(letterSpacing) / w.devicePixelRatio\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\n\t\t// Fall back to measuring the font ourselves\n\t\treturn this._measureFont(w, fontFamily, fontSize, letterSpacing, lineHeight);\n\t}\n\n\tprivate _createCharMeasureElementIfNecessary(): HTMLElement {\n\t\tif (!this._panelContainer) {\n\t\t\tthrow new Error('Cannot measure element when terminal is not attached');\n\t\t}\n\t\t// Create charMeasureElement if it hasn't been created or if it was orphaned by its parent\n\t\tif (!this._charMeasureElement || !this._charMeasureElement.parentElement) {\n\t\t\tthis._charMeasureElement = document.createElement('div');\n\t\t\tthis._panelContainer.appendChild(this._charMeasureElement);\n\t\t}\n\t\treturn this._charMeasureElement;\n\t}\n\n\tprivate _getBoundingRectFor(char: string, fontFamily: string, fontSize: number): ClientRect | DOMRect | undefined {\n\t\tlet charMeasureElement: HTMLElement;\n\t\ttry {\n\t\t\tcharMeasureElement = this._createCharMeasureElementIfNecessary();\n\t\t} catch {\n\t\t\treturn undefined;\n\t\t}\n\t\tconst style = charMeasureElement.style;\n\t\tstyle.display = 'inline-block';\n\t\tstyle.fontFamily = fontFamily;\n\t\tstyle.fontSize = fontSize + 'px';\n\t\tstyle.lineHeight = 'normal';\n\t\tcharMeasureElement.innerText = char;\n\t\tconst rect = charMeasureElement.getBoundingClientRect();\n\t\tstyle.display = 'none';\n\n\t\treturn rect;\n\t}\n\n\tprivate _measureFont(w: Window, fontFamily: string, fontSize: number, letterSpacing: number, lineHeight: number): ITerminalFont {\n\t\tconst rect = this._getBoundingRectFor('X', fontFamily, fontSize);\n\n\t\t// Bounding client rect was invalid, use last font measurement if available.\n\t\tif (this._lastFontMeasurement && (!rect || !rect.width || !rect.height)) {\n\t\t\treturn this._lastFontMeasurement;\n\t\t}\n\n\t\tthis._lastFontMeasurement = {\n\t\t\tfontFamily,\n\t\t\tfontSize,\n\t\t\tletterSpacing,\n\t\t\tlineHeight,\n\t\t\tcharWidth: 0,\n\t\t\tcharHeight: 0\n\t\t};\n\n\t\tif (rect && rect.width && rect.height) {\n\t\t\tthis._lastFontMeasurement.charHeight = Math.ceil(rect.height);\n\t\t\t// Char width is calculated differently for DOM and the other renderer types. Refer to\n\t\t\t// how each renderer updates their dimensions in xterm.js\n\t\t\tif (this._terminalConfigurationService.config.gpuAcceleration === 'off') {\n\t\t\t\tthis._lastFontMeasurement.charWidth = rect.width;\n\t\t\t} else {\n\t\t\t\tconst deviceCharWidth = Math.floor(rect.width * w.devicePixelRatio);\n\t\t\t\tconst deviceCellWidth = deviceCharWidth + Math.round(letterSpacing);\n\t\t\t\tconst cssCellWidth = deviceCellWidth / w.devicePixelRatio;\n\t\t\t\tthis._lastFontMeasurement.charWidth = cssCellWidth - Math.round(letterSpacing) / w.devicePixelRatio;\n\t\t\t}\n\t\t}\n\n\t\treturn this._lastFontMeasurement;\n\t}\n}\n\n// #endregion TerminalFontMetrics\n\n// #region Utils\n\nfunction clampInt<T>(source: string | number, minimum: number, maximum: number, fallback: T): number | T {\n\tif (source === null || source === undefined) {\n\t\treturn fallback;\n\t}\n\tconst r = isString(source) ? parseInt(source, 10) : source;\n\tif (isNaN(r)) {\n\t\treturn fallback;\n\t}\n\treturn clamp(r, minimum, maximum);\n}\n// #endregion Utils\n"]}