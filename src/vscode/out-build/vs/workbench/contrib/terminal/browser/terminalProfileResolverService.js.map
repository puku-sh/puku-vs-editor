{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/contrib/terminal/browser/terminalProfileResolverService.ts","vs/workbench/contrib/terminal/browser/terminalProfileResolverService.ts"],"names":[],"mappings":"AAAA;;;gGAGgG;;;;;;;;;;AAEhG,OAAO,EAAE,OAAO,EAAE,MAAM,oCAAoC,CAAC;AAC7D,OAAO,EAAE,GAAG,EAAE,MAAM,oCAAoC,CAAC;AACzD,OAAO,EAAE,qBAAqB,EAAE,MAAM,4DAA4D,CAAC;AACnG,OAAO,EAAE,wBAAwB,EAAoB,MAAM,oDAAoD,CAAC;AAChH,OAAO,EAAE,6BAA6B,EAAE,MAAM,yEAAyE,CAAC;AACxH,OAAO,EAAE,eAAe,EAAE,MAAM,6CAA6C,CAAC;AAC9E,OAAO,EAAwC,EAAE,EAAE,MAAM,qCAAqC,CAAC;AAC/F,OAAO,EAAsB,mBAAmB,EAAqD,MAAM,kDAAkD,CAAC;AAC9J,OAAO,EAAqE,uBAAuB,EAAE,MAAM,uBAAuB,CAAC;AACnI,OAAO,KAAK,IAAI,MAAM,iCAAiC,CAAC;AACxD,OAAO,EAAE,OAAO,EAAE,MAAM,qCAAqC,CAAC;AAC9D,OAAO,EAAE,eAAe,EAAiB,MAAM,mDAAmD,CAAC;AACnG,OAAO,EAAE,mBAAmB,EAAE,MAAM,uDAAuD,CAAC;AAC5F,OAAO,EAAE,QAAQ,EAAE,MAAM,uCAAuC,CAAC;AACjE,OAAO,EAAE,SAAS,EAAE,MAAM,sCAAsC,CAAC;AACjE,OAAO,EAAE,eAAe,EAAE,GAAG,EAAE,MAAM,gCAAgC,CAAC;AACtE,OAAO,EAAE,SAAS,EAAE,MAAM,oCAAoC,CAAC;AAC/D,OAAO,EAAE,wBAAwB,EAAE,MAAM,eAAe,CAAC;AACzD,OAAO,EAAE,UAAU,EAAE,MAAM,sCAAsC,CAAC;AAClE,OAAO,EAAE,QAAQ,EAAqB,MAAM,kCAAkC,CAAC;AAO/E,MAAM,oBAAoB,GAAG,WAAW,CAAC;AAEzC;;;GAGG;AACH,MAAM,OAAgB,kCAAmC,SAAQ,UAAU;IAQ1E,IAAI,kBAAkB,KAAyB,OAAO,IAAI,CAAC,mBAAmB,CAAC,CAAC,CAAC;IAEjF,YACkB,QAAiC,EACjC,qBAA4C,EAC5C,6BAA4D,EAC5D,eAAgC,EAChC,WAAgC,EAChC,uBAAgD,EAChD,wBAAkD,EAClD,mBAAwC;QAEzD,KAAK,EAAE,CAAC;QATS,aAAQ,GAAR,QAAQ,CAAyB;QACjC,0BAAqB,GAArB,qBAAqB,CAAuB;QAC5C,kCAA6B,GAA7B,6BAA6B,CAA+B;QAC5D,oBAAe,GAAf,eAAe,CAAiB;QAChC,gBAAW,GAAX,WAAW,CAAqB;QAChC,4BAAuB,GAAvB,uBAAuB,CAAyB;QAChD,6BAAwB,GAAxB,wBAAwB,CAA0B;QAClD,wBAAmB,GAAnB,mBAAmB,CAAqB;QAbzC,kBAAa,GAAkB,eAAe,EAAE,CAAC;QAiBjE,IAAI,IAAI,CAAC,mBAAmB,CAAC,aAAa,EAAE,EAAE,CAAC;YAC9C,IAAI,CAAC,mBAAmB,CAAC,cAAc,EAAE,CAAC,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,IAAI,CAAC,iBAAiB,GAAG,GAAG,EAAE,EAAE,IAAI,EAAE,CAAC,CAAC;QAC/F,CAAC;aAAM,CAAC;YACP,IAAI,CAAC,iBAAiB,GAAG,EAAE,CAAC;QAC7B,CAAC;QACD,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,qBAAqB,CAAC,wBAAwB,CAAC,CAAC,CAAC,EAAE;YACtE,IAAI,CAAC,CAAC,oBAAoB,4FAAyC;gBAClE,CAAC,CAAC,oBAAoB,sFAAuC;gBAC7D,CAAC,CAAC,oBAAoB,wFAAuC,EAAE,CAAC;gBAChE,IAAI,CAAC,0BAA0B,EAAE,CAAC;YACnC,CAAC;QACF,CAAC,CAAC,CAAC,CAAC;QACJ,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,uBAAuB,CAAC,4BAA4B,CAAC,GAAG,EAAE,CAAC,IAAI,CAAC,0BAA0B,EAAE,CAAC,CAAC,CAAC;IACpH,CAAC;IAGO,AAAM,KAAD,CAAC,0BAA0B;QACvC,IAAI,IAAI,CAAC,iBAAiB,EAAE,CAAC;YAC5B,IAAI,CAAC,mBAAmB,GAAG,CAAC,MAAM,IAAI,CAAC,iBAAiB,CAAC;gBACxD,eAAe,EAAE,IAAI,CAAC,mBAAmB,CAAC,aAAa,EAAE,EAAE,eAAe;gBAC1E,EAAE,EAAE,IAAI,CAAC,iBAAiB;aAC1B,CAAC,CAAC,EAAE,WAAW,CAAC;QAClB,CAAC;IACF,CAAC;IAED,WAAW,CAAC,iBAAqC,EAAE,EAAmB;QACrE,IAAI,iBAAiB,CAAC,IAAI,EAAE,CAAC;YAC5B,iBAAiB,CAAC,IAAI,GAAG,IAAI,CAAC,cAAc,CAAC,iBAAiB,CAAC,IAAI,CAAC,IAAI,IAAI,CAAC,cAAc,EAAE,CAAC;YAC9F,OAAO;QACR,CAAC;QACD,IAAI,iBAAiB,CAAC,uBAAuB,EAAE,CAAC;YAC/C,iBAAiB,CAAC,IAAI,GAAG,IAAI,CAAC,cAAc,EAAE,CAAC;YAC/C,OAAO;QACR,CAAC;QACD,IAAI,iBAAiB,CAAC,UAAU,EAAE,CAAC;YAClC,OAAO;QACR,CAAC;QACD,MAAM,cAAc,GAAG,IAAI,CAAC,gCAAgC,CAAC,EAAE,CAAC,CAAC;QACjE,IAAI,cAAc,EAAE,CAAC;YACpB,iBAAiB,CAAC,IAAI,GAAG,cAAc,CAAC,IAAI,CAAC;QAC9C,CAAC;QACD,IAAI,CAAC,iBAAiB,CAAC,IAAI,EAAE,CAAC;YAC7B,iBAAiB,CAAC,IAAI,GAAG,IAAI,CAAC,cAAc,EAAE,CAAC;QAChD,CAAC;IACF,CAAC;IAED,cAAc,CAAC,QAAc;QAC5B,OAAO,IAAI,CAAC,aAAa,CAAC,OAAO,CAAC,IAAI,CAAC,qBAAqB,CAAC,QAAQ,iFAAoC,EAAE,QAAQ,EAAE,CAAC,CAAC,IAAI,OAAO,CAAC,QAAQ,CAAC;IAC7I,CAAC;IAED,KAAK,CAAC,wBAAwB,CAAC,iBAAqC,EAAE,OAAyC;QAC9G,mCAAmC;QACnC,IAAI,eAAiC,CAAC;QACtC,IAAI,iBAAiB,CAAC,UAAU,EAAE,CAAC;YAClC,eAAe,GAAG,MAAM,IAAI,CAAC,eAAe,CAAC;gBAC5C,IAAI,EAAE,iBAAiB,CAAC,UAAU;gBAClC,IAAI,EAAE,iBAAiB,CAAC,IAAI;gBAC5B,WAAW,EAAE,oBAAoB;gBACjC,SAAS,EAAE,KAAK;aAChB,EAAE,OAAO,CAAC,CAAC;QACb,CAAC;aAAM,CAAC;YACP,eAAe,GAAG,MAAM,IAAI,CAAC,iBAAiB,CAAC,OAAO,CAAC,CAAC;QACzD,CAAC;QACD,iBAAiB,CAAC,UAAU,GAAG,eAAe,CAAC,IAAI,CAAC;QACpD,iBAAiB,CAAC,IAAI,GAAG,eAAe,CAAC,IAAI,CAAC;QAC9C,IAAI,eAAe,CAAC,GAAG,EAAE,CAAC;YACzB,IAAI,iBAAiB,CAAC,GAAG,EAAE,CAAC;gBAC3B,iBAAiB,CAAC,GAAG,GAAG,EAAE,GAAG,iBAAiB,CAAC,GAAG,EAAE,GAAG,eAAe,CAAC,GAAG,EAAE,CAAC;YAC9E,CAAC;iBAAM,CAAC;gBACP,iBAAiB,CAAC,GAAG,GAAG,eAAe,CAAC,GAAG,CAAC;YAC7C,CAAC;QACF,CAAC;QAED,0FAA0F;QAC1F,WAAW;QACX,MAAM,QAAQ,GAAG,iBAAiB,KAAK,SAAS,IAAI,QAAQ,CAAC,iBAAiB,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,SAAS,CAAC,CAAC,CAAC,iBAAiB,CAAC,GAAG,CAAC;QACxH,iBAAiB,CAAC,IAAI,GAAG,IAAI,CAAC,cAAc,CAAC,iBAAiB,CAAC,IAAI,CAAC;eAChE,IAAI,CAAC,cAAc,CAAC,eAAe,CAAC,IAAI,CAAC;eACzC,IAAI,CAAC,cAAc,CAAC,QAAQ,CAAC,CAAC;QAElC,iCAAiC;QACjC,IAAI,eAAe,CAAC,YAAY,EAAE,CAAC;YAClC,iBAAiB,CAAC,IAAI,GAAG,eAAe,CAAC,WAAW,CAAC;QACtD,CAAC;QAED,kBAAkB;QAClB,iBAAiB,CAAC,KAAK,GAAG,iBAAiB,CAAC,KAAK;eAC7C,eAAe,CAAC,KAAK;eACrB,IAAI,CAAC,qBAAqB,CAAC,QAAQ,mFAAqC,EAAE,QAAQ,EAAE,CAAC,CAAC;QAE1F,mEAAmE;QACnE,IAAI,iBAAiB,CAAC,mBAAmB,KAAK,SAAS,EAAE,CAAC;YACzD,iBAAiB,CAAC,mBAAmB,GAAG,IAAI,CAAC,qBAAqB,CAAC,QAAQ,qEAA8B,CAAC;QAC3G,CAAC;IACF,CAAC;IAED,KAAK,CAAC,eAAe,CAAC,OAAyC;QAC9D,OAAO,CAAC,MAAM,IAAI,CAAC,iBAAiB,CAAC,OAAO,CAAC,CAAC,CAAC,IAAI,CAAC;IACrD,CAAC;IAED,KAAK,CAAC,mBAAmB,CAAC,OAAyC;QAClE,OAAO,CAAC,MAAM,IAAI,CAAC,iBAAiB,CAAC,OAAO,CAAC,CAAC,CAAC,IAAI,IAAI,EAAE,CAAC;IAC3D,CAAC;IAED,KAAK,CAAC,iBAAiB,CAAC,OAAyC;QAChE,OAAO,IAAI,CAAC,eAAe,CAAC,MAAM,IAAI,CAAC,4BAA4B,CAAC,OAAO,CAAC,EAAE,OAAO,CAAC,CAAC;IACxF,CAAC;IAED,cAAc,CAAC,eAAmC;QACjD,OAAO,IAAI,CAAC,QAAQ,CAAC,cAAc,CAAC,eAAe,CAAC,CAAC;IACtD,CAAC;IAEO,cAAc,CAAC,IAAmB;QACzC,IAAI,CAAC,IAAI,EAAE,CAAC;YACX,OAAO,SAAS,CAAC;QAClB,CAAC;QACD,IAAI,QAAQ,CAAC,IAAI,CAAC,EAAE,CAAC;YACpB,OAAO,SAAS,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC;QAC/B,CAAC;QACD,IAAI,SAAS,CAAC,WAAW,CAAC,IAAI,CAAC,EAAE,CAAC;YACjC,OAAO,IAAI,CAAC;QACb,CAAC;QACD,IAAI,GAAG,CAAC,KAAK,CAAC,IAAI,CAAC,IAAI,eAAe,CAAC,IAAI,CAAC,EAAE,CAAC;YAC9C,OAAO,GAAG,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC;QACzB,CAAC;QACD,IAAI,CAAC,GAAG,CAAC,KAAK,CAAC,IAAI,CAAC,KAAK,CAAC,IAAI,eAAe,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,IAAI,eAAe,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,EAAE,CAAC;YACpH,OAAO,EAAE,KAAK,EAAE,GAAG,CAAC,MAAM,CAAC,IAAI,CAAC,KAAK,CAAC,EAAE,IAAI,EAAE,GAAG,CAAC,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,EAAE,CAAC;QACvE,CAAC;QACD,OAAO,SAAS,CAAC;IAClB,CAAC;IAEO,KAAK,CAAC,4BAA4B,CAAC,OAAyC;QACnF,8CAA8C;QAC9C,IAAI,OAAO,CAAC,oBAAoB,EAAE,CAAC;YAClC,MAAM,sBAAsB,GAAG,IAAI,CAAC,oCAAoC,CAAC,OAAO,CAAC,CAAC;YAClF,IAAI,sBAAsB,EAAE,CAAC;gBAC5B,OAAO,sBAAsB,CAAC;YAC/B,CAAC;QACF,CAAC;QAED,2FAA2F;QAC3F,4BAA4B;QAC5B,MAAM,IAAI,CAAC,uBAAuB,CAAC,aAAa,CAAC;QACjD,MAAM,cAAc,GAAG,IAAI,CAAC,gCAAgC,CAAC,OAAO,CAAC,EAAE,CAAC,CAAC;QACzE,IAAI,cAAc,EAAE,CAAC;YACpB,OAAO,IAAI,CAAC,qBAAqB,CAAC,OAAO,EAAE,cAAc,CAAC,CAAC;QAC5D,CAAC;QAED,4FAA4F;QAC5F,iEAAiE;QACjE,OAAO,IAAI,CAAC,qBAAqB,CAAC,OAAO,EAAE,MAAM,IAAI,CAAC,oCAAoC,CAAC,OAAO,CAAC,CAAC,CAAC;IACtG,CAAC;IAEO,qBAAqB,CAAC,OAAyC,EAAE,OAAyB;QACjG,IAAI,OAAO,CAAC,oBAAoB,EAAE,CAAC;YAClC,MAAM,YAAY,GAAG,SAAS,CAAC,OAAO,CAAC,CAAC;YACxC,YAAY,CAAC,IAAI,GAAG,OAAO,CAAC,KAAK,CAAC;YAClC,OAAO,YAAY,CAAC;QACrB,CAAC;QACD,OAAO,OAAO,CAAC;IAChB,CAAC;IAEO,gCAAgC,CAAC,EAAmB;QAC3D,OAAO,IAAI,CAAC,uBAAuB,CAAC,iBAAiB,CAAC,EAAE,CAAC,CAAC;IAC3D,CAAC;IAEO,KAAK,CAAC,oCAAoC,CAAC,OAAyC;QAC3F,MAAM,UAAU,GAAG,MAAM,IAAI,CAAC,QAAQ,CAAC,qBAAqB,CAAC,OAAO,CAAC,eAAe,EAAE,OAAO,CAAC,EAAE,CAAC,CAAC;QAElG,4FAA4F;QAC5F,0FAA0F;QAC1F,6CAA6C;QAC7C,IAAI,OAAO,CAAC,EAAE,KAAK,EAAE,EAAE,CAAC;YACvB,IAAI,eAAe,GAAG,IAAI,CAAC,uBAAuB,CAAC,iBAAiB,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,IAAI,KAAK,IAAI,CAAC,KAAK,CAAC,UAAU,CAAC,CAAC,IAAI,CAAC,CAAC;YACxI,IAAI,eAAe,EAAE,CAAC;gBACrB,IAAI,OAAO,CAAC,oBAAoB,EAAE,CAAC;oBAClC,eAAe,GAAG,SAAS,CAAC,eAAe,CAAC,CAAC;oBAC7C,eAAe,CAAC,IAAI,GAAG,OAAO,CAAC,KAAK,CAAC;gBACtC,CAAC;gBACD,OAAO,eAAe,CAAC;YACxB,CAAC;QACF,CAAC;QAED,0CAA0C;QAC1C,IAAI,IAAsC,CAAC;QAC3C,IAAI,OAAO,CAAC,EAAE,sCAA8B,IAAI,IAAI,CAAC,KAAK,CAAC,UAAU,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,YAAY,CAAC,EAAE,CAAC;YACjG,+CAA+C;YAC/C,IAAI,GAAG,CAAC,SAAS,CAAC,CAAC;QACpB,CAAC;aAAM,CAAC;YACP,0BAA0B;YAC1B,IAAI,GAAG,EAAE,CAAC;QACX,CAAC;QAED,MAAM,IAAI,GAAG,IAAI,CAAC,iBAAiB,CAAC,UAAU,CAAC,CAAC;QAEhD,OAAO;YACN,WAAW,EAAE,oBAAoB;YACjC,IAAI,EAAE,UAAU;YAChB,IAAI;YACJ,IAAI;YACJ,SAAS,EAAE,KAAK;SAChB,CAAC;IACH,CAAC;IAEO,oCAAoC,CAAC,OAAyC;QACrF,MAAM,iBAAiB,GAAG,IAAI,CAAC,qBAAqB,CAAC,QAAQ,CAAC,yCAAyC,IAAI,CAAC,SAAS,CAAC,OAAO,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC;QACrI,IAAI,IAAI,CAAC,yBAAyB,CAAC,iBAAiB,EAAE,OAAO,CAAC,EAAE,CAAC,EAAE,CAAC;YACnE,iBAAiB,CAAC,IAAI,GAAG,IAAI,CAAC,cAAc,CAAC,iBAAiB,CAAC,IAAI,CAAC,IAAI,OAAO,CAAC,KAAK,CAAC;YACtF,OAAO,iBAAiB,CAAC;QAC1B,CAAC;QAED,OAAO,SAAS,CAAC;IAClB,CAAC;IAEO,KAAK,CAAC,eAAe,CAAC,OAAyB,EAAE,OAAyC;QACjG,MAAM,GAAG,GAAG,MAAM,IAAI,CAAC,QAAQ,CAAC,cAAc,CAAC,OAAO,CAAC,eAAe,CAAC,CAAC;QAExE,IAAI,OAAO,CAAC,EAAE,oCAA4B,EAAE,CAAC;YAC5C,wEAAwE;YACxE,sEAAsE;YACtE,+DAA+D;YAC/D,MAAM,OAAO,GAAG,CAAC,CAAC,GAAG,CAAC,cAAc,CAAC,wBAAwB,CAAC,CAAC;YAC/D,MAAM,MAAM,GAAG,GAAG,CAAC,MAAM,CAAC;YAC1B,IAAI,CAAC,OAAO,IAAI,MAAM,EAAE,CAAC;gBACxB,MAAM,aAAa,GAAG,IAAI,CAAC,IAAI,CAAC,MAAM,EAAE,WAAW,CAAC,CAAC,OAAO,CAAC,KAAK,EAAE,IAAI,CAAC,CAAC,WAAW,EAAE,CAAC;gBACxF,IAAI,OAAO,CAAC,IAAI,IAAI,OAAO,CAAC,IAAI,CAAC,WAAW,EAAE,CAAC,OAAO,CAAC,aAAa,CAAC,KAAK,CAAC,EAAE,CAAC;oBAC7E,OAAO,CAAC,IAAI,GAAG,IAAI,CAAC,IAAI,CAAC,MAAM,EAAE,UAAU,EAAE,OAAO,CAAC,IAAI,CAAC,MAAM,CAAC,aAAa,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC,CAAC;gBAC7F,CAAC;YACF,CAAC;YAED,4CAA4C;YAC5C,IAAI,OAAO,CAAC,IAAI,EAAE,CAAC;gBAClB,OAAO,CAAC,IAAI,GAAG,OAAO,CAAC,IAAI,CAAC,OAAO,CAAC,KAAK,EAAE,IAAI,CAAC,CAAC;YAClD,CAAC;QACF,CAAC;QAED,yBAAyB;QACzB,MAAM,sBAAsB,GAAG,IAAI,CAAC,eAAe,CAAC,0BAA0B,CAAC,OAAO,CAAC,eAAe,CAAC,CAAC,CAAC,OAAO,CAAC,YAAY,CAAC,CAAC,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC;QAC9I,MAAM,mBAAmB,GAAG,sBAAsB,CAAC,CAAC,CAAC,IAAI,CAAC,wBAAwB,CAAC,kBAAkB,CAAC,sBAAsB,CAAC,IAAI,SAAS,CAAC,CAAC,CAAC,SAAS,CAAC;QACvJ,OAAO,CAAC,IAAI,GAAG,MAAM,IAAI,CAAC,iBAAiB,CAAC,OAAO,CAAC,IAAI,EAAE,GAAG,EAAE,mBAAmB,CAAC,CAAC;QAEpF,yBAAyB;QACzB,IAAI,OAAO,CAAC,IAAI,EAAE,CAAC;YAClB,IAAI,QAAQ,CAAC,OAAO,CAAC,IAAI,CAAC,EAAE,CAAC;gBAC5B,OAAO,CAAC,IAAI,GAAG,MAAM,IAAI,CAAC,iBAAiB,CAAC,OAAO,CAAC,IAAI,EAAE,GAAG,EAAE,mBAAmB,CAAC,CAAC;YACrF,CAAC;iBAAM,CAAC;gBACP,OAAO,CAAC,IAAI,GAAG,MAAM,OAAO,CAAC,GAAG,CAAC,OAAO,CAAC,IAAI,CAAC,GAAG,CAAC,GAAG,CAAC,EAAE,CAAC,IAAI,CAAC,iBAAiB,CAAC,GAAG,EAAE,GAAG,EAAE,mBAAmB,CAAC,CAAC,CAAC,CAAC;YAClH,CAAC;QACF,CAAC;QAED,OAAO,OAAO,CAAC;IAChB,CAAC;IAEO,KAAK,CAAC,iBAAiB,CAAC,KAAa,EAAE,GAAwB,EAAE,mBAAiD;QACzH,IAAI,CAAC;YACJ,KAAK,GAAG,MAAM,IAAI,CAAC,6BAA6B,CAAC,sBAAsB,CAAC,GAAG,EAAE,mBAAmB,EAAE,KAAK,CAAC,CAAC;QAC1G,CAAC;QAAC,OAAO,CAAC,EAAE,CAAC;YACZ,IAAI,CAAC,WAAW,CAAC,KAAK,CAAC,yBAAyB,EAAE,CAAC,CAAC,CAAC;QACtD,CAAC;QACD,OAAO,KAAK,CAAC;IACd,CAAC;IAEO,SAAS,CAAC,EAAmB;QACpC,QAAQ,EAAE,EAAE,CAAC;YACZ,kCAA0B,CAAC,CAAC,OAAO,OAAO,CAAC;YAC3C,sCAA8B,CAAC,CAAC,OAAO,KAAK,CAAC;YAC7C,oCAA4B,CAAC,CAAC,OAAO,SAAS,CAAC;QAChD,CAAC;IACF,CAAC;IAEO,iBAAiB,CAAC,KAAa;QACtC,MAAM,IAAI,GAAG,IAAI,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC,IAAI,CAAC;QACpC,QAAQ,IAAI,EAAE,CAAC;YACd,KAAK,MAAM;gBACV,OAAO,OAAO,CAAC,YAAY,CAAC;YAC7B,KAAK,MAAM,CAAC;YACZ,KAAK,YAAY;gBAChB,OAAO,OAAO,CAAC,kBAAkB,CAAC;YACnC,KAAK,MAAM;gBACV,OAAO,OAAO,CAAC,YAAY,CAAC;YAC7B,KAAK,KAAK;gBACT,OAAO,OAAO,CAAC,WAAW,CAAC;YAC5B;gBACC,OAAO,SAAS,CAAC;QACnB,CAAC;IACF,CAAC;IAEO,yBAAyB,CAAC,OAAgB,EAAE,EAAmB;QACtE,IAAI,OAAO,KAAK,IAAI,IAAI,OAAO,KAAK,SAAS,IAAI,OAAO,OAAO,KAAK,QAAQ,EAAE,CAAC;YAC9E,OAAO,KAAK,CAAC;QACd,CAAC;QACD,IAAI,MAAM,IAAI,OAAO,IAAI,QAAQ,CAAE,OAA6B,CAAC,IAAI,CAAC,EAAE,CAAC;YACxE,OAAO,IAAI,CAAC;QACb,CAAC;QACD,OAAO,KAAK,CAAC;IACd,CAAC;CACD;AAxRc;IADb,QAAQ,CAAC,GAAG,CAAC;oFAQb;AAmRK,IAAM,qCAAqC,GAA3C,MAAM,qCAAsC,SAAQ,kCAAkC;IAE5F,YACgC,4BAA2D,EACnE,oBAA2C,EACjD,cAA+B,EAC3B,UAA+B,EAC1B,uBAAiD,EAClD,sBAA+C,EAC9C,uBAAiD,EACtD,kBAAuC;QAE5D,KAAK,CACJ;YACC,qBAAqB,EAAE,KAAK,EAAE,eAAe,EAAE,EAAE,EAAE,EAAE;gBACpD,MAAM,OAAO,GAAG,MAAM,uBAAuB,CAAC,UAAU,CAAC,eAAe,CAAC,CAAC;gBAC1E,IAAI,CAAC,eAAe,IAAI,CAAC,OAAO,EAAE,CAAC;oBAClC,iFAAiF;oBACjF,OAAO,EAAE,oCAA4B,CAAC,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC,MAAM,CAAC;gBACzD,CAAC;gBACD,OAAO,OAAO,CAAC,qBAAqB,CAAC,EAAE,CAAC,CAAC;YAC1C,CAAC;YACD,cAAc,EAAE,KAAK,EAAE,eAAe,EAAE,EAAE;gBACzC,MAAM,OAAO,GAAG,MAAM,uBAAuB,CAAC,UAAU,CAAC,eAAe,CAAC,CAAC;gBAC1E,IAAI,CAAC,eAAe,IAAI,CAAC,OAAO,EAAE,CAAC;oBAClC,OAAO,GAAG,CAAC;gBACZ,CAAC;gBACD,OAAO,OAAO,CAAC,cAAc,EAAE,CAAC;YACjC,CAAC;SACD,EACD,oBAAoB,EACpB,4BAA4B,EAC5B,cAAc,EACd,UAAU,EACV,sBAAsB,EACtB,uBAAuB,EACvB,kBAAkB,CAClB,CAAC;IACH,CAAC;CACD,CAAA;AAvCY,qCAAqC;IAG/C,WAAA,6BAA6B,CAAA;IAC7B,WAAA,qBAAqB,CAAA;IACrB,WAAA,eAAe,CAAA;IACf,WAAA,mBAAmB,CAAA;IACnB,WAAA,wBAAwB,CAAA;IACxB,WAAA,uBAAuB,CAAA;IACvB,WAAA,wBAAwB,CAAA;IACxB,WAAA,mBAAmB,CAAA;GAVT,qCAAqC,CAuCjD","file":"terminalProfileResolverService.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Schemas } from '../../../../base/common/network.js';\nimport { env } from '../../../../base/common/process.js';\nimport { IConfigurationService } from '../../../../platform/configuration/common/configuration.js';\nimport { IWorkspaceContextService, IWorkspaceFolder } from '../../../../platform/workspace/common/workspace.js';\nimport { IConfigurationResolverService } from '../../../services/configurationResolver/common/configurationResolver.js';\nimport { IHistoryService } from '../../../services/history/common/history.js';\nimport { IProcessEnvironment, OperatingSystem, OS } from '../../../../base/common/platform.js';\nimport { IShellLaunchConfig, ITerminalLogService, ITerminalProfile, TerminalIcon, TerminalSettingId } from '../../../../platform/terminal/common/terminal.js';\nimport { IShellLaunchConfigResolveOptions, ITerminalProfileResolverService, ITerminalProfileService } from '../common/terminal.js';\nimport * as path from '../../../../base/common/path.js';\nimport { Codicon } from '../../../../base/common/codicons.js';\nimport { getIconRegistry, IIconRegistry } from '../../../../platform/theme/common/iconRegistry.js';\nimport { IRemoteAgentService } from '../../../services/remote/common/remoteAgentService.js';\nimport { debounce } from '../../../../base/common/decorators.js';\nimport { ThemeIcon } from '../../../../base/common/themables.js';\nimport { isUriComponents, URI } from '../../../../base/common/uri.js';\nimport { deepClone } from '../../../../base/common/objects.js';\nimport { ITerminalInstanceService } from './terminal.js';\nimport { Disposable } from '../../../../base/common/lifecycle.js';\nimport { isString, type SingleOrMany } from '../../../../base/common/types.js';\n\nexport interface IProfileContextProvider {\n\tgetDefaultSystemShell(remoteAuthority: string | undefined, os: OperatingSystem): Promise<string>;\n\tgetEnvironment(remoteAuthority: string | undefined): Promise<IProcessEnvironment>;\n}\n\nconst generatedProfileName = 'Generated';\n\n/*\n * Resolves terminal shell launch config and terminal profiles for the given operating system,\n * environment, and user configuration.\n */\nexport abstract class BaseTerminalProfileResolverService extends Disposable implements ITerminalProfileResolverService {\n\tdeclare _serviceBrand: undefined;\n\n\tprivate _primaryBackendOs: OperatingSystem | undefined;\n\n\tprivate readonly _iconRegistry: IIconRegistry = getIconRegistry();\n\n\tprivate _defaultProfileName: string | undefined;\n\tget defaultProfileName(): string | undefined { return this._defaultProfileName; }\n\n\tconstructor(\n\t\tprivate readonly _context: IProfileContextProvider,\n\t\tprivate readonly _configurationService: IConfigurationService,\n\t\tprivate readonly _configurationResolverService: IConfigurationResolverService,\n\t\tprivate readonly _historyService: IHistoryService,\n\t\tprivate readonly _logService: ITerminalLogService,\n\t\tprivate readonly _terminalProfileService: ITerminalProfileService,\n\t\tprivate readonly _workspaceContextService: IWorkspaceContextService,\n\t\tprivate readonly _remoteAgentService: IRemoteAgentService\n\t) {\n\t\tsuper();\n\n\t\tif (this._remoteAgentService.getConnection()) {\n\t\t\tthis._remoteAgentService.getEnvironment().then(env => this._primaryBackendOs = env?.os || OS);\n\t\t} else {\n\t\t\tthis._primaryBackendOs = OS;\n\t\t}\n\t\tthis._register(this._configurationService.onDidChangeConfiguration(e => {\n\t\t\tif (e.affectsConfiguration(TerminalSettingId.DefaultProfileWindows) ||\n\t\t\t\te.affectsConfiguration(TerminalSettingId.DefaultProfileMacOs) ||\n\t\t\t\te.affectsConfiguration(TerminalSettingId.DefaultProfileLinux)) {\n\t\t\t\tthis._refreshDefaultProfileName();\n\t\t\t}\n\t\t}));\n\t\tthis._register(this._terminalProfileService.onDidChangeAvailableProfiles(() => this._refreshDefaultProfileName()));\n\t}\n\n\t@debounce(200)\n\tprivate async _refreshDefaultProfileName() {\n\t\tif (this._primaryBackendOs) {\n\t\t\tthis._defaultProfileName = (await this.getDefaultProfile({\n\t\t\t\tremoteAuthority: this._remoteAgentService.getConnection()?.remoteAuthority,\n\t\t\t\tos: this._primaryBackendOs\n\t\t\t}))?.profileName;\n\t\t}\n\t}\n\n\tresolveIcon(shellLaunchConfig: IShellLaunchConfig, os: OperatingSystem): void {\n\t\tif (shellLaunchConfig.icon) {\n\t\t\tshellLaunchConfig.icon = this._getCustomIcon(shellLaunchConfig.icon) || this.getDefaultIcon();\n\t\t\treturn;\n\t\t}\n\t\tif (shellLaunchConfig.customPtyImplementation) {\n\t\t\tshellLaunchConfig.icon = this.getDefaultIcon();\n\t\t\treturn;\n\t\t}\n\t\tif (shellLaunchConfig.executable) {\n\t\t\treturn;\n\t\t}\n\t\tconst defaultProfile = this._getUnresolvedRealDefaultProfile(os);\n\t\tif (defaultProfile) {\n\t\t\tshellLaunchConfig.icon = defaultProfile.icon;\n\t\t}\n\t\tif (!shellLaunchConfig.icon) {\n\t\t\tshellLaunchConfig.icon = this.getDefaultIcon();\n\t\t}\n\t}\n\n\tgetDefaultIcon(resource?: URI): TerminalIcon & ThemeIcon {\n\t\treturn this._iconRegistry.getIcon(this._configurationService.getValue(TerminalSettingId.TabsDefaultIcon, { resource })) || Codicon.terminal;\n\t}\n\n\tasync resolveShellLaunchConfig(shellLaunchConfig: IShellLaunchConfig, options: IShellLaunchConfigResolveOptions): Promise<void> {\n\t\t// Resolve the shell and shell args\n\t\tlet resolvedProfile: ITerminalProfile;\n\t\tif (shellLaunchConfig.executable) {\n\t\t\tresolvedProfile = await this._resolveProfile({\n\t\t\t\tpath: shellLaunchConfig.executable,\n\t\t\t\targs: shellLaunchConfig.args,\n\t\t\t\tprofileName: generatedProfileName,\n\t\t\t\tisDefault: false\n\t\t\t}, options);\n\t\t} else {\n\t\t\tresolvedProfile = await this.getDefaultProfile(options);\n\t\t}\n\t\tshellLaunchConfig.executable = resolvedProfile.path;\n\t\tshellLaunchConfig.args = resolvedProfile.args;\n\t\tif (resolvedProfile.env) {\n\t\t\tif (shellLaunchConfig.env) {\n\t\t\t\tshellLaunchConfig.env = { ...shellLaunchConfig.env, ...resolvedProfile.env };\n\t\t\t} else {\n\t\t\t\tshellLaunchConfig.env = resolvedProfile.env;\n\t\t\t}\n\t\t}\n\n\t\t// Verify the icon is valid, and fallback correctly to the generic terminal id if there is\n\t\t// an issue\n\t\tconst resource = shellLaunchConfig === undefined || isString(shellLaunchConfig.cwd) ? undefined : shellLaunchConfig.cwd;\n\t\tshellLaunchConfig.icon = this._getCustomIcon(shellLaunchConfig.icon)\n\t\t\t|| this._getCustomIcon(resolvedProfile.icon)\n\t\t\t|| this.getDefaultIcon(resource);\n\n\t\t// Override the name if specified\n\t\tif (resolvedProfile.overrideName) {\n\t\t\tshellLaunchConfig.name = resolvedProfile.profileName;\n\t\t}\n\n\t\t// Apply the color\n\t\tshellLaunchConfig.color = shellLaunchConfig.color\n\t\t\t|| resolvedProfile.color\n\t\t\t|| this._configurationService.getValue(TerminalSettingId.TabsDefaultColor, { resource });\n\n\t\t// Resolve useShellEnvironment based on the setting if it's not set\n\t\tif (shellLaunchConfig.useShellEnvironment === undefined) {\n\t\t\tshellLaunchConfig.useShellEnvironment = this._configurationService.getValue(TerminalSettingId.InheritEnv);\n\t\t}\n\t}\n\n\tasync getDefaultShell(options: IShellLaunchConfigResolveOptions): Promise<string> {\n\t\treturn (await this.getDefaultProfile(options)).path;\n\t}\n\n\tasync getDefaultShellArgs(options: IShellLaunchConfigResolveOptions): Promise<SingleOrMany<string>> {\n\t\treturn (await this.getDefaultProfile(options)).args || [];\n\t}\n\n\tasync getDefaultProfile(options: IShellLaunchConfigResolveOptions): Promise<ITerminalProfile> {\n\t\treturn this._resolveProfile(await this._getUnresolvedDefaultProfile(options), options);\n\t}\n\n\tgetEnvironment(remoteAuthority: string | undefined): Promise<IProcessEnvironment> {\n\t\treturn this._context.getEnvironment(remoteAuthority);\n\t}\n\n\tprivate _getCustomIcon(icon?: TerminalIcon): TerminalIcon | undefined {\n\t\tif (!icon) {\n\t\t\treturn undefined;\n\t\t}\n\t\tif (isString(icon)) {\n\t\t\treturn ThemeIcon.fromId(icon);\n\t\t}\n\t\tif (ThemeIcon.isThemeIcon(icon)) {\n\t\t\treturn icon;\n\t\t}\n\t\tif (URI.isUri(icon) || isUriComponents(icon)) {\n\t\t\treturn URI.revive(icon);\n\t\t}\n\t\tif ((URI.isUri(icon.light) || isUriComponents(icon.light)) && (URI.isUri(icon.dark) || isUriComponents(icon.dark))) {\n\t\t\treturn { light: URI.revive(icon.light), dark: URI.revive(icon.dark) };\n\t\t}\n\t\treturn undefined;\n\t}\n\n\tprivate async _getUnresolvedDefaultProfile(options: IShellLaunchConfigResolveOptions): Promise<ITerminalProfile> {\n\t\t// If automation shell is allowed, prefer that\n\t\tif (options.allowAutomationShell) {\n\t\t\tconst automationShellProfile = this._getUnresolvedAutomationShellProfile(options);\n\t\t\tif (automationShellProfile) {\n\t\t\t\treturn automationShellProfile;\n\t\t\t}\n\t\t}\n\n\t\t// Return the real default profile if it exists and is valid, wait for profiles to be ready\n\t\t// if the window just opened\n\t\tawait this._terminalProfileService.profilesReady;\n\t\tconst defaultProfile = this._getUnresolvedRealDefaultProfile(options.os);\n\t\tif (defaultProfile) {\n\t\t\treturn this._setIconForAutomation(options, defaultProfile);\n\t\t}\n\n\t\t// If there is no real default profile, create a fallback default profile based on the shell\n\t\t// and shellArgs settings in addition to the current environment.\n\t\treturn this._setIconForAutomation(options, await this._getUnresolvedFallbackDefaultProfile(options));\n\t}\n\n\tprivate _setIconForAutomation(options: IShellLaunchConfigResolveOptions, profile: ITerminalProfile): ITerminalProfile {\n\t\tif (options.allowAutomationShell) {\n\t\t\tconst profileClone = deepClone(profile);\n\t\t\tprofileClone.icon = Codicon.tools;\n\t\t\treturn profileClone;\n\t\t}\n\t\treturn profile;\n\t}\n\n\tprivate _getUnresolvedRealDefaultProfile(os: OperatingSystem): ITerminalProfile | undefined {\n\t\treturn this._terminalProfileService.getDefaultProfile(os);\n\t}\n\n\tprivate async _getUnresolvedFallbackDefaultProfile(options: IShellLaunchConfigResolveOptions): Promise<ITerminalProfile> {\n\t\tconst executable = await this._context.getDefaultSystemShell(options.remoteAuthority, options.os);\n\n\t\t// Try select an existing profile to fallback to, based on the default system shell, only do\n\t\t// this when it is NOT a local terminal in a remote window where the front and back end OS\n\t\t// differs (eg. Windows -> WSL, Mac -> Linux)\n\t\tif (options.os === OS) {\n\t\t\tlet existingProfile = this._terminalProfileService.availableProfiles.find(e => path.parse(e.path).name === path.parse(executable).name);\n\t\t\tif (existingProfile) {\n\t\t\t\tif (options.allowAutomationShell) {\n\t\t\t\t\texistingProfile = deepClone(existingProfile);\n\t\t\t\t\texistingProfile.icon = Codicon.tools;\n\t\t\t\t}\n\t\t\t\treturn existingProfile;\n\t\t\t}\n\t\t}\n\n\t\t// Finally fallback to a generated profile\n\t\tlet args: SingleOrMany<string> | undefined;\n\t\tif (options.os === OperatingSystem.Macintosh && path.parse(executable).name.match(/(zsh|bash)/)) {\n\t\t\t// macOS should launch a login shell by default\n\t\t\targs = ['--login'];\n\t\t} else {\n\t\t\t// Resolve undefined to []\n\t\t\targs = [];\n\t\t}\n\n\t\tconst icon = this._guessProfileIcon(executable);\n\n\t\treturn {\n\t\t\tprofileName: generatedProfileName,\n\t\t\tpath: executable,\n\t\t\targs,\n\t\t\ticon,\n\t\t\tisDefault: false\n\t\t};\n\t}\n\n\tprivate _getUnresolvedAutomationShellProfile(options: IShellLaunchConfigResolveOptions): ITerminalProfile | undefined {\n\t\tconst automationProfile = this._configurationService.getValue(`terminal.integrated.automationProfile.${this._getOsKey(options.os)}`);\n\t\tif (this._isValidAutomationProfile(automationProfile, options.os)) {\n\t\t\tautomationProfile.icon = this._getCustomIcon(automationProfile.icon) || Codicon.tools;\n\t\t\treturn automationProfile;\n\t\t}\n\n\t\treturn undefined;\n\t}\n\n\tprivate async _resolveProfile(profile: ITerminalProfile, options: IShellLaunchConfigResolveOptions): Promise<ITerminalProfile> {\n\t\tconst env = await this._context.getEnvironment(options.remoteAuthority);\n\n\t\tif (options.os === OperatingSystem.Windows) {\n\t\t\t// Change Sysnative to System32 if the OS is Windows but NOT WoW64. It's\n\t\t\t// safe to assume that this was used by accident as Sysnative does not\n\t\t\t// exist and will break the terminal in non-WoW64 environments.\n\t\t\tconst isWoW64 = !!env.hasOwnProperty('PROCESSOR_ARCHITEW6432');\n\t\t\tconst windir = env.windir;\n\t\t\tif (!isWoW64 && windir) {\n\t\t\t\tconst sysnativePath = path.join(windir, 'Sysnative').replace(/\\//g, '\\\\').toLowerCase();\n\t\t\t\tif (profile.path && profile.path.toLowerCase().indexOf(sysnativePath) === 0) {\n\t\t\t\t\tprofile.path = path.join(windir, 'System32', profile.path.substr(sysnativePath.length + 1));\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Convert / to \\ on Windows for convenience\n\t\t\tif (profile.path) {\n\t\t\t\tprofile.path = profile.path.replace(/\\//g, '\\\\');\n\t\t\t}\n\t\t}\n\n\t\t// Resolve path variables\n\t\tconst activeWorkspaceRootUri = this._historyService.getLastActiveWorkspaceRoot(options.remoteAuthority ? Schemas.vscodeRemote : Schemas.file);\n\t\tconst lastActiveWorkspace = activeWorkspaceRootUri ? this._workspaceContextService.getWorkspaceFolder(activeWorkspaceRootUri) ?? undefined : undefined;\n\t\tprofile.path = await this._resolveVariables(profile.path, env, lastActiveWorkspace);\n\n\t\t// Resolve args variables\n\t\tif (profile.args) {\n\t\t\tif (isString(profile.args)) {\n\t\t\t\tprofile.args = await this._resolveVariables(profile.args, env, lastActiveWorkspace);\n\t\t\t} else {\n\t\t\t\tprofile.args = await Promise.all(profile.args.map(arg => this._resolveVariables(arg, env, lastActiveWorkspace)));\n\t\t\t}\n\t\t}\n\n\t\treturn profile;\n\t}\n\n\tprivate async _resolveVariables(value: string, env: IProcessEnvironment, lastActiveWorkspace: IWorkspaceFolder | undefined) {\n\t\ttry {\n\t\t\tvalue = await this._configurationResolverService.resolveWithEnvironment(env, lastActiveWorkspace, value);\n\t\t} catch (e) {\n\t\t\tthis._logService.error(`Could not resolve shell`, e);\n\t\t}\n\t\treturn value;\n\t}\n\n\tprivate _getOsKey(os: OperatingSystem): string {\n\t\tswitch (os) {\n\t\t\tcase OperatingSystem.Linux: return 'linux';\n\t\t\tcase OperatingSystem.Macintosh: return 'osx';\n\t\t\tcase OperatingSystem.Windows: return 'windows';\n\t\t}\n\t}\n\n\tprivate _guessProfileIcon(shell: string): ThemeIcon | undefined {\n\t\tconst file = path.parse(shell).name;\n\t\tswitch (file) {\n\t\t\tcase 'bash':\n\t\t\t\treturn Codicon.terminalBash;\n\t\t\tcase 'pwsh':\n\t\t\tcase 'powershell':\n\t\t\t\treturn Codicon.terminalPowershell;\n\t\t\tcase 'tmux':\n\t\t\t\treturn Codicon.terminalTmux;\n\t\t\tcase 'cmd':\n\t\t\t\treturn Codicon.terminalCmd;\n\t\t\tdefault:\n\t\t\t\treturn undefined;\n\t\t}\n\t}\n\n\tprivate _isValidAutomationProfile(profile: unknown, os: OperatingSystem): profile is ITerminalProfile {\n\t\tif (profile === null || profile === undefined || typeof profile !== 'object') {\n\t\t\treturn false;\n\t\t}\n\t\tif ('path' in profile && isString((profile as { path: unknown }).path)) {\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n}\n\nexport class BrowserTerminalProfileResolverService extends BaseTerminalProfileResolverService {\n\n\tconstructor(\n\t\t@IConfigurationResolverService configurationResolverService: IConfigurationResolverService,\n\t\t@IConfigurationService configurationService: IConfigurationService,\n\t\t@IHistoryService historyService: IHistoryService,\n\t\t@ITerminalLogService logService: ITerminalLogService,\n\t\t@ITerminalInstanceService terminalInstanceService: ITerminalInstanceService,\n\t\t@ITerminalProfileService terminalProfileService: ITerminalProfileService,\n\t\t@IWorkspaceContextService workspaceContextService: IWorkspaceContextService,\n\t\t@IRemoteAgentService remoteAgentService: IRemoteAgentService\n\t) {\n\t\tsuper(\n\t\t\t{\n\t\t\t\tgetDefaultSystemShell: async (remoteAuthority, os) => {\n\t\t\t\t\tconst backend = await terminalInstanceService.getBackend(remoteAuthority);\n\t\t\t\t\tif (!remoteAuthority || !backend) {\n\t\t\t\t\t\t// Just return basic values, this is only for serverless web and wouldn't be used\n\t\t\t\t\t\treturn os === OperatingSystem.Windows ? 'pwsh' : 'bash';\n\t\t\t\t\t}\n\t\t\t\t\treturn backend.getDefaultSystemShell(os);\n\t\t\t\t},\n\t\t\t\tgetEnvironment: async (remoteAuthority) => {\n\t\t\t\t\tconst backend = await terminalInstanceService.getBackend(remoteAuthority);\n\t\t\t\t\tif (!remoteAuthority || !backend) {\n\t\t\t\t\t\treturn env;\n\t\t\t\t\t}\n\t\t\t\t\treturn backend.getEnvironment();\n\t\t\t\t}\n\t\t\t},\n\t\t\tconfigurationService,\n\t\t\tconfigurationResolverService,\n\t\t\thistoryService,\n\t\t\tlogService,\n\t\t\tterminalProfileService,\n\t\t\tworkspaceContextService,\n\t\t\tremoteAgentService\n\t\t);\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Schemas } from '../../../../base/common/network.js';\nimport { env } from '../../../../base/common/process.js';\nimport { IConfigurationService } from '../../../../platform/configuration/common/configuration.js';\nimport { IWorkspaceContextService, IWorkspaceFolder } from '../../../../platform/workspace/common/workspace.js';\nimport { IConfigurationResolverService } from '../../../services/configurationResolver/common/configurationResolver.js';\nimport { IHistoryService } from '../../../services/history/common/history.js';\nimport { IProcessEnvironment, OperatingSystem, OS } from '../../../../base/common/platform.js';\nimport { IShellLaunchConfig, ITerminalLogService, ITerminalProfile, TerminalIcon, TerminalSettingId } from '../../../../platform/terminal/common/terminal.js';\nimport { IShellLaunchConfigResolveOptions, ITerminalProfileResolverService, ITerminalProfileService } from '../common/terminal.js';\nimport * as path from '../../../../base/common/path.js';\nimport { Codicon } from '../../../../base/common/codicons.js';\nimport { getIconRegistry, IIconRegistry } from '../../../../platform/theme/common/iconRegistry.js';\nimport { IRemoteAgentService } from '../../../services/remote/common/remoteAgentService.js';\nimport { debounce } from '../../../../base/common/decorators.js';\nimport { ThemeIcon } from '../../../../base/common/themables.js';\nimport { isUriComponents, URI } from '../../../../base/common/uri.js';\nimport { deepClone } from '../../../../base/common/objects.js';\nimport { ITerminalInstanceService } from './terminal.js';\nimport { Disposable } from '../../../../base/common/lifecycle.js';\nimport { isString, type SingleOrMany } from '../../../../base/common/types.js';\n\nexport interface IProfileContextProvider {\n\tgetDefaultSystemShell(remoteAuthority: string | undefined, os: OperatingSystem): Promise<string>;\n\tgetEnvironment(remoteAuthority: string | undefined): Promise<IProcessEnvironment>;\n}\n\nconst generatedProfileName = 'Generated';\n\n/*\n * Resolves terminal shell launch config and terminal profiles for the given operating system,\n * environment, and user configuration.\n */\nexport abstract class BaseTerminalProfileResolverService extends Disposable implements ITerminalProfileResolverService {\n\tdeclare _serviceBrand: undefined;\n\n\tprivate _primaryBackendOs: OperatingSystem | undefined;\n\n\tprivate readonly _iconRegistry: IIconRegistry = getIconRegistry();\n\n\tprivate _defaultProfileName: string | undefined;\n\tget defaultProfileName(): string | undefined { return this._defaultProfileName; }\n\n\tconstructor(\n\t\tprivate readonly _context: IProfileContextProvider,\n\t\tprivate readonly _configurationService: IConfigurationService,\n\t\tprivate readonly _configurationResolverService: IConfigurationResolverService,\n\t\tprivate readonly _historyService: IHistoryService,\n\t\tprivate readonly _logService: ITerminalLogService,\n\t\tprivate readonly _terminalProfileService: ITerminalProfileService,\n\t\tprivate readonly _workspaceContextService: IWorkspaceContextService,\n\t\tprivate readonly _remoteAgentService: IRemoteAgentService\n\t) {\n\t\tsuper();\n\n\t\tif (this._remoteAgentService.getConnection()) {\n\t\t\tthis._remoteAgentService.getEnvironment().then(env => this._primaryBackendOs = env?.os || OS);\n\t\t} else {\n\t\t\tthis._primaryBackendOs = OS;\n\t\t}\n\t\tthis._register(this._configurationService.onDidChangeConfiguration(e => {\n\t\t\tif (e.affectsConfiguration(TerminalSettingId.DefaultProfileWindows) ||\n\t\t\t\te.affectsConfiguration(TerminalSettingId.DefaultProfileMacOs) ||\n\t\t\t\te.affectsConfiguration(TerminalSettingId.DefaultProfileLinux)) {\n\t\t\t\tthis._refreshDefaultProfileName();\n\t\t\t}\n\t\t}));\n\t\tthis._register(this._terminalProfileService.onDidChangeAvailableProfiles(() => this._refreshDefaultProfileName()));\n\t}\n\n\t@debounce(200)\n\tprivate async _refreshDefaultProfileName() {\n\t\tif (this._primaryBackendOs) {\n\t\t\tthis._defaultProfileName = (await this.getDefaultProfile({\n\t\t\t\tremoteAuthority: this._remoteAgentService.getConnection()?.remoteAuthority,\n\t\t\t\tos: this._primaryBackendOs\n\t\t\t}))?.profileName;\n\t\t}\n\t}\n\n\tresolveIcon(shellLaunchConfig: IShellLaunchConfig, os: OperatingSystem): void {\n\t\tif (shellLaunchConfig.icon) {\n\t\t\tshellLaunchConfig.icon = this._getCustomIcon(shellLaunchConfig.icon) || this.getDefaultIcon();\n\t\t\treturn;\n\t\t}\n\t\tif (shellLaunchConfig.customPtyImplementation) {\n\t\t\tshellLaunchConfig.icon = this.getDefaultIcon();\n\t\t\treturn;\n\t\t}\n\t\tif (shellLaunchConfig.executable) {\n\t\t\treturn;\n\t\t}\n\t\tconst defaultProfile = this._getUnresolvedRealDefaultProfile(os);\n\t\tif (defaultProfile) {\n\t\t\tshellLaunchConfig.icon = defaultProfile.icon;\n\t\t}\n\t\tif (!shellLaunchConfig.icon) {\n\t\t\tshellLaunchConfig.icon = this.getDefaultIcon();\n\t\t}\n\t}\n\n\tgetDefaultIcon(resource?: URI): TerminalIcon & ThemeIcon {\n\t\treturn this._iconRegistry.getIcon(this._configurationService.getValue(TerminalSettingId.TabsDefaultIcon, { resource })) || Codicon.terminal;\n\t}\n\n\tasync resolveShellLaunchConfig(shellLaunchConfig: IShellLaunchConfig, options: IShellLaunchConfigResolveOptions): Promise<void> {\n\t\t// Resolve the shell and shell args\n\t\tlet resolvedProfile: ITerminalProfile;\n\t\tif (shellLaunchConfig.executable) {\n\t\t\tresolvedProfile = await this._resolveProfile({\n\t\t\t\tpath: shellLaunchConfig.executable,\n\t\t\t\targs: shellLaunchConfig.args,\n\t\t\t\tprofileName: generatedProfileName,\n\t\t\t\tisDefault: false\n\t\t\t}, options);\n\t\t} else {\n\t\t\tresolvedProfile = await this.getDefaultProfile(options);\n\t\t}\n\t\tshellLaunchConfig.executable = resolvedProfile.path;\n\t\tshellLaunchConfig.args = resolvedProfile.args;\n\t\tif (resolvedProfile.env) {\n\t\t\tif (shellLaunchConfig.env) {\n\t\t\t\tshellLaunchConfig.env = { ...shellLaunchConfig.env, ...resolvedProfile.env };\n\t\t\t} else {\n\t\t\t\tshellLaunchConfig.env = resolvedProfile.env;\n\t\t\t}\n\t\t}\n\n\t\t// Verify the icon is valid, and fallback correctly to the generic terminal id if there is\n\t\t// an issue\n\t\tconst resource = shellLaunchConfig === undefined || isString(shellLaunchConfig.cwd) ? undefined : shellLaunchConfig.cwd;\n\t\tshellLaunchConfig.icon = this._getCustomIcon(shellLaunchConfig.icon)\n\t\t\t|| this._getCustomIcon(resolvedProfile.icon)\n\t\t\t|| this.getDefaultIcon(resource);\n\n\t\t// Override the name if specified\n\t\tif (resolvedProfile.overrideName) {\n\t\t\tshellLaunchConfig.name = resolvedProfile.profileName;\n\t\t}\n\n\t\t// Apply the color\n\t\tshellLaunchConfig.color = shellLaunchConfig.color\n\t\t\t|| resolvedProfile.color\n\t\t\t|| this._configurationService.getValue(TerminalSettingId.TabsDefaultColor, { resource });\n\n\t\t// Resolve useShellEnvironment based on the setting if it's not set\n\t\tif (shellLaunchConfig.useShellEnvironment === undefined) {\n\t\t\tshellLaunchConfig.useShellEnvironment = this._configurationService.getValue(TerminalSettingId.InheritEnv);\n\t\t}\n\t}\n\n\tasync getDefaultShell(options: IShellLaunchConfigResolveOptions): Promise<string> {\n\t\treturn (await this.getDefaultProfile(options)).path;\n\t}\n\n\tasync getDefaultShellArgs(options: IShellLaunchConfigResolveOptions): Promise<SingleOrMany<string>> {\n\t\treturn (await this.getDefaultProfile(options)).args || [];\n\t}\n\n\tasync getDefaultProfile(options: IShellLaunchConfigResolveOptions): Promise<ITerminalProfile> {\n\t\treturn this._resolveProfile(await this._getUnresolvedDefaultProfile(options), options);\n\t}\n\n\tgetEnvironment(remoteAuthority: string | undefined): Promise<IProcessEnvironment> {\n\t\treturn this._context.getEnvironment(remoteAuthority);\n\t}\n\n\tprivate _getCustomIcon(icon?: TerminalIcon): TerminalIcon | undefined {\n\t\tif (!icon) {\n\t\t\treturn undefined;\n\t\t}\n\t\tif (isString(icon)) {\n\t\t\treturn ThemeIcon.fromId(icon);\n\t\t}\n\t\tif (ThemeIcon.isThemeIcon(icon)) {\n\t\t\treturn icon;\n\t\t}\n\t\tif (URI.isUri(icon) || isUriComponents(icon)) {\n\t\t\treturn URI.revive(icon);\n\t\t}\n\t\tif ((URI.isUri(icon.light) || isUriComponents(icon.light)) && (URI.isUri(icon.dark) || isUriComponents(icon.dark))) {\n\t\t\treturn { light: URI.revive(icon.light), dark: URI.revive(icon.dark) };\n\t\t}\n\t\treturn undefined;\n\t}\n\n\tprivate async _getUnresolvedDefaultProfile(options: IShellLaunchConfigResolveOptions): Promise<ITerminalProfile> {\n\t\t// If automation shell is allowed, prefer that\n\t\tif (options.allowAutomationShell) {\n\t\t\tconst automationShellProfile = this._getUnresolvedAutomationShellProfile(options);\n\t\t\tif (automationShellProfile) {\n\t\t\t\treturn automationShellProfile;\n\t\t\t}\n\t\t}\n\n\t\t// Return the real default profile if it exists and is valid, wait for profiles to be ready\n\t\t// if the window just opened\n\t\tawait this._terminalProfileService.profilesReady;\n\t\tconst defaultProfile = this._getUnresolvedRealDefaultProfile(options.os);\n\t\tif (defaultProfile) {\n\t\t\treturn this._setIconForAutomation(options, defaultProfile);\n\t\t}\n\n\t\t// If there is no real default profile, create a fallback default profile based on the shell\n\t\t// and shellArgs settings in addition to the current environment.\n\t\treturn this._setIconForAutomation(options, await this._getUnresolvedFallbackDefaultProfile(options));\n\t}\n\n\tprivate _setIconForAutomation(options: IShellLaunchConfigResolveOptions, profile: ITerminalProfile): ITerminalProfile {\n\t\tif (options.allowAutomationShell) {\n\t\t\tconst profileClone = deepClone(profile);\n\t\t\tprofileClone.icon = Codicon.tools;\n\t\t\treturn profileClone;\n\t\t}\n\t\treturn profile;\n\t}\n\n\tprivate _getUnresolvedRealDefaultProfile(os: OperatingSystem): ITerminalProfile | undefined {\n\t\treturn this._terminalProfileService.getDefaultProfile(os);\n\t}\n\n\tprivate async _getUnresolvedFallbackDefaultProfile(options: IShellLaunchConfigResolveOptions): Promise<ITerminalProfile> {\n\t\tconst executable = await this._context.getDefaultSystemShell(options.remoteAuthority, options.os);\n\n\t\t// Try select an existing profile to fallback to, based on the default system shell, only do\n\t\t// this when it is NOT a local terminal in a remote window where the front and back end OS\n\t\t// differs (eg. Windows -> WSL, Mac -> Linux)\n\t\tif (options.os === OS) {\n\t\t\tlet existingProfile = this._terminalProfileService.availableProfiles.find(e => path.parse(e.path).name === path.parse(executable).name);\n\t\t\tif (existingProfile) {\n\t\t\t\tif (options.allowAutomationShell) {\n\t\t\t\t\texistingProfile = deepClone(existingProfile);\n\t\t\t\t\texistingProfile.icon = Codicon.tools;\n\t\t\t\t}\n\t\t\t\treturn existingProfile;\n\t\t\t}\n\t\t}\n\n\t\t// Finally fallback to a generated profile\n\t\tlet args: SingleOrMany<string> | undefined;\n\t\tif (options.os === OperatingSystem.Macintosh && path.parse(executable).name.match(/(zsh|bash)/)) {\n\t\t\t// macOS should launch a login shell by default\n\t\t\targs = ['--login'];\n\t\t} else {\n\t\t\t// Resolve undefined to []\n\t\t\targs = [];\n\t\t}\n\n\t\tconst icon = this._guessProfileIcon(executable);\n\n\t\treturn {\n\t\t\tprofileName: generatedProfileName,\n\t\t\tpath: executable,\n\t\t\targs,\n\t\t\ticon,\n\t\t\tisDefault: false\n\t\t};\n\t}\n\n\tprivate _getUnresolvedAutomationShellProfile(options: IShellLaunchConfigResolveOptions): ITerminalProfile | undefined {\n\t\tconst automationProfile = this._configurationService.getValue(`terminal.integrated.automationProfile.${this._getOsKey(options.os)}`);\n\t\tif (this._isValidAutomationProfile(automationProfile, options.os)) {\n\t\t\tautomationProfile.icon = this._getCustomIcon(automationProfile.icon) || Codicon.tools;\n\t\t\treturn automationProfile;\n\t\t}\n\n\t\treturn undefined;\n\t}\n\n\tprivate async _resolveProfile(profile: ITerminalProfile, options: IShellLaunchConfigResolveOptions): Promise<ITerminalProfile> {\n\t\tconst env = await this._context.getEnvironment(options.remoteAuthority);\n\n\t\tif (options.os === OperatingSystem.Windows) {\n\t\t\t// Change Sysnative to System32 if the OS is Windows but NOT WoW64. It's\n\t\t\t// safe to assume that this was used by accident as Sysnative does not\n\t\t\t// exist and will break the terminal in non-WoW64 environments.\n\t\t\tconst isWoW64 = !!env.hasOwnProperty('PROCESSOR_ARCHITEW6432');\n\t\t\tconst windir = env.windir;\n\t\t\tif (!isWoW64 && windir) {\n\t\t\t\tconst sysnativePath = path.join(windir, 'Sysnative').replace(/\\//g, '\\\\').toLowerCase();\n\t\t\t\tif (profile.path && profile.path.toLowerCase().indexOf(sysnativePath) === 0) {\n\t\t\t\t\tprofile.path = path.join(windir, 'System32', profile.path.substr(sysnativePath.length + 1));\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Convert / to \\ on Windows for convenience\n\t\t\tif (profile.path) {\n\t\t\t\tprofile.path = profile.path.replace(/\\//g, '\\\\');\n\t\t\t}\n\t\t}\n\n\t\t// Resolve path variables\n\t\tconst activeWorkspaceRootUri = this._historyService.getLastActiveWorkspaceRoot(options.remoteAuthority ? Schemas.vscodeRemote : Schemas.file);\n\t\tconst lastActiveWorkspace = activeWorkspaceRootUri ? this._workspaceContextService.getWorkspaceFolder(activeWorkspaceRootUri) ?? undefined : undefined;\n\t\tprofile.path = await this._resolveVariables(profile.path, env, lastActiveWorkspace);\n\n\t\t// Resolve args variables\n\t\tif (profile.args) {\n\t\t\tif (isString(profile.args)) {\n\t\t\t\tprofile.args = await this._resolveVariables(profile.args, env, lastActiveWorkspace);\n\t\t\t} else {\n\t\t\t\tprofile.args = await Promise.all(profile.args.map(arg => this._resolveVariables(arg, env, lastActiveWorkspace)));\n\t\t\t}\n\t\t}\n\n\t\treturn profile;\n\t}\n\n\tprivate async _resolveVariables(value: string, env: IProcessEnvironment, lastActiveWorkspace: IWorkspaceFolder | undefined) {\n\t\ttry {\n\t\t\tvalue = await this._configurationResolverService.resolveWithEnvironment(env, lastActiveWorkspace, value);\n\t\t} catch (e) {\n\t\t\tthis._logService.error(`Could not resolve shell`, e);\n\t\t}\n\t\treturn value;\n\t}\n\n\tprivate _getOsKey(os: OperatingSystem): string {\n\t\tswitch (os) {\n\t\t\tcase OperatingSystem.Linux: return 'linux';\n\t\t\tcase OperatingSystem.Macintosh: return 'osx';\n\t\t\tcase OperatingSystem.Windows: return 'windows';\n\t\t}\n\t}\n\n\tprivate _guessProfileIcon(shell: string): ThemeIcon | undefined {\n\t\tconst file = path.parse(shell).name;\n\t\tswitch (file) {\n\t\t\tcase 'bash':\n\t\t\t\treturn Codicon.terminalBash;\n\t\t\tcase 'pwsh':\n\t\t\tcase 'powershell':\n\t\t\t\treturn Codicon.terminalPowershell;\n\t\t\tcase 'tmux':\n\t\t\t\treturn Codicon.terminalTmux;\n\t\t\tcase 'cmd':\n\t\t\t\treturn Codicon.terminalCmd;\n\t\t\tdefault:\n\t\t\t\treturn undefined;\n\t\t}\n\t}\n\n\tprivate _isValidAutomationProfile(profile: unknown, os: OperatingSystem): profile is ITerminalProfile {\n\t\tif (profile === null || profile === undefined || typeof profile !== 'object') {\n\t\t\treturn false;\n\t\t}\n\t\tif ('path' in profile && isString((profile as { path: unknown }).path)) {\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n}\n\nexport class BrowserTerminalProfileResolverService extends BaseTerminalProfileResolverService {\n\n\tconstructor(\n\t\t@IConfigurationResolverService configurationResolverService: IConfigurationResolverService,\n\t\t@IConfigurationService configurationService: IConfigurationService,\n\t\t@IHistoryService historyService: IHistoryService,\n\t\t@ITerminalLogService logService: ITerminalLogService,\n\t\t@ITerminalInstanceService terminalInstanceService: ITerminalInstanceService,\n\t\t@ITerminalProfileService terminalProfileService: ITerminalProfileService,\n\t\t@IWorkspaceContextService workspaceContextService: IWorkspaceContextService,\n\t\t@IRemoteAgentService remoteAgentService: IRemoteAgentService\n\t) {\n\t\tsuper(\n\t\t\t{\n\t\t\t\tgetDefaultSystemShell: async (remoteAuthority, os) => {\n\t\t\t\t\tconst backend = await terminalInstanceService.getBackend(remoteAuthority);\n\t\t\t\t\tif (!remoteAuthority || !backend) {\n\t\t\t\t\t\t// Just return basic values, this is only for serverless web and wouldn't be used\n\t\t\t\t\t\treturn os === OperatingSystem.Windows ? 'pwsh' : 'bash';\n\t\t\t\t\t}\n\t\t\t\t\treturn backend.getDefaultSystemShell(os);\n\t\t\t\t},\n\t\t\t\tgetEnvironment: async (remoteAuthority) => {\n\t\t\t\t\tconst backend = await terminalInstanceService.getBackend(remoteAuthority);\n\t\t\t\t\tif (!remoteAuthority || !backend) {\n\t\t\t\t\t\treturn env;\n\t\t\t\t\t}\n\t\t\t\t\treturn backend.getEnvironment();\n\t\t\t\t}\n\t\t\t},\n\t\t\tconfigurationService,\n\t\t\tconfigurationResolverService,\n\t\t\thistoryService,\n\t\t\tlogService,\n\t\t\tterminalProfileService,\n\t\t\tworkspaceContextService,\n\t\t\tremoteAgentService\n\t\t);\n\t}\n}\n"]}