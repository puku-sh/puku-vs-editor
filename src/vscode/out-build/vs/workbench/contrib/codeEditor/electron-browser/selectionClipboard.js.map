{"version":3,"sources":["vs/workbench/contrib/codeEditor/electron-browser/selectionClipboard.ts"],"names":[],"mappings":"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","file":"selectionClipboard.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as nls from '../../../../nls.js';\nimport { RunOnceScheduler } from '../../../../base/common/async.js';\nimport { Disposable } from '../../../../base/common/lifecycle.js';\nimport * as platform from '../../../../base/common/platform.js';\nimport { ICodeEditor } from '../../../../editor/browser/editorBrowser.js';\nimport { registerEditorContribution, EditorAction, ServicesAccessor, registerEditorAction, EditorContributionInstantiation } from '../../../../editor/browser/editorExtensions.js';\nimport { ConfigurationChangedEvent, EditorOption } from '../../../../editor/common/config/editorOptions.js';\nimport { ICursorSelectionChangedEvent } from '../../../../editor/common/cursorEvents.js';\nimport { Range } from '../../../../editor/common/core/range.js';\nimport { IEditorContribution, Handler } from '../../../../editor/common/editorCommon.js';\nimport { EndOfLinePreference } from '../../../../editor/common/model.js';\nimport { IClipboardService } from '../../../../platform/clipboard/common/clipboardService.js';\nimport { SelectionClipboardContributionID } from '../browser/selectionClipboard.js';\nimport { IWorkbenchContribution, WorkbenchPhase, registerWorkbenchContribution2 } from '../../../common/contributions.js';\nimport { IConfigurationService } from '../../../../platform/configuration/common/configuration.js';\nimport { EditorContextKeys } from '../../../../editor/common/editorContextKeys.js';\nimport { mainWindow } from '../../../../base/browser/window.js';\nimport { Event } from '../../../../base/common/event.js';\nimport { addDisposableListener, onDidRegisterWindow } from '../../../../base/browser/dom.js';\n\nexport class SelectionClipboard extends Disposable implements IEditorContribution {\n\tprivate static readonly SELECTION_LENGTH_LIMIT = 65536;\n\n\tconstructor(editor: ICodeEditor, @IClipboardService clipboardService: IClipboardService) {\n\t\tsuper();\n\n\t\tif (platform.isLinux) {\n\t\t\tlet isEnabled = editor.getOption(EditorOption.selectionClipboard);\n\n\t\t\tthis._register(editor.onDidChangeConfiguration((e: ConfigurationChangedEvent) => {\n\t\t\t\tif (e.hasChanged(EditorOption.selectionClipboard)) {\n\t\t\t\t\tisEnabled = editor.getOption(EditorOption.selectionClipboard);\n\t\t\t\t}\n\t\t\t}));\n\n\t\t\tconst setSelectionToClipboard = this._register(new RunOnceScheduler(() => {\n\t\t\t\tif (!editor.hasModel()) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tconst model = editor.getModel();\n\t\t\t\tlet selections = editor.getSelections();\n\t\t\t\tselections = selections.slice(0);\n\t\t\t\tselections.sort(Range.compareRangesUsingStarts);\n\n\t\t\t\tlet resultLength = 0;\n\t\t\t\tfor (const sel of selections) {\n\t\t\t\t\tif (sel.isEmpty()) {\n\t\t\t\t\t\t// Only write if all cursors have selection\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tresultLength += model.getValueLengthInRange(sel);\n\t\t\t\t}\n\n\t\t\t\tif (resultLength > SelectionClipboard.SELECTION_LENGTH_LIMIT) {\n\t\t\t\t\t// This is a large selection!\n\t\t\t\t\t// => do not write it to the selection clipboard\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst result: string[] = [];\n\t\t\t\tfor (const sel of selections) {\n\t\t\t\t\tresult.push(model.getValueInRange(sel, EndOfLinePreference.TextDefined));\n\t\t\t\t}\n\n\t\t\t\tconst textToCopy = result.join(model.getEOL());\n\t\t\t\tclipboardService.writeText(textToCopy, 'selection');\n\t\t\t}, 100));\n\n\t\t\tthis._register(editor.onDidChangeCursorSelection((e: ICursorSelectionChangedEvent) => {\n\t\t\t\tif (!isEnabled) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tif (e.source === 'restoreState') {\n\t\t\t\t\t// do not set selection to clipboard if this selection change\n\t\t\t\t\t// was caused by restoring editors...\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tsetSelectionToClipboard.schedule();\n\t\t\t}));\n\t\t}\n\t}\n\n\tpublic override dispose(): void {\n\t\tsuper.dispose();\n\t}\n}\n\nclass LinuxSelectionClipboardPastePreventer extends Disposable implements IWorkbenchContribution {\n\n\tstatic readonly ID = 'workbench.contrib.linuxSelectionClipboardPastePreventer';\n\n\tconstructor(\n\t\t@IConfigurationService configurationService: IConfigurationService\n\t) {\n\t\tsuper();\n\n\t\tthis._register(Event.runAndSubscribe(onDidRegisterWindow, ({ window, disposables }) => {\n\t\t\tdisposables.add(addDisposableListener(window.document, 'mouseup', e => {\n\t\t\t\tif (e.button === 1) {\n\t\t\t\t\t// middle button\n\t\t\t\t\tconst config = configurationService.getValue<{ selectionClipboard: boolean }>('editor');\n\t\t\t\t\tif (!config.selectionClipboard) {\n\t\t\t\t\t\t// selection clipboard is disabled\n\t\t\t\t\t\t// try to stop the upcoming paste\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}));\n\t\t}, { window: mainWindow, disposables: this._store }));\n\t}\n}\n\nclass PasteSelectionClipboardAction extends EditorAction {\n\n\tconstructor() {\n\t\tsuper({\n\t\t\tid: 'editor.action.selectionClipboardPaste',\n\t\t\tlabel: nls.localize2('actions.pasteSelectionClipboard', \"Paste Selection Clipboard\"),\n\t\t\tprecondition: EditorContextKeys.writable\n\t\t});\n\t}\n\n\tpublic async run(accessor: ServicesAccessor, editor: ICodeEditor, args: unknown): Promise<void> {\n\t\tconst clipboardService = accessor.get(IClipboardService);\n\n\t\t// read selection clipboard\n\t\tconst text = await clipboardService.readText('selection');\n\n\t\teditor.trigger('keyboard', Handler.Paste, {\n\t\t\ttext: text,\n\t\t\tpasteOnNewLine: false,\n\t\t\tmulticursorText: null\n\t\t});\n\t}\n}\n\nregisterEditorContribution(SelectionClipboardContributionID, SelectionClipboard, EditorContributionInstantiation.Eager); // eager because it needs to listen to selection change events\nif (platform.isLinux) {\n\tregisterWorkbenchContribution2(LinuxSelectionClipboardPastePreventer.ID, LinuxSelectionClipboardPastePreventer, WorkbenchPhase.BlockRestore); // eager because it listens to mouse-up events globally\n\tregisterEditorAction(PasteSelectionClipboardAction);\n}\n"]}