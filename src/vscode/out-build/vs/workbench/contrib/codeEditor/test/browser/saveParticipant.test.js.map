{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/contrib/codeEditor/test/browser/saveParticipant.test.ts","vs/workbench/contrib/codeEditor/test/browser/saveParticipant.test.ts"],"names":[],"mappings":"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","file":"saveParticipant.test.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport assert from 'assert';\nimport { IInstantiationService } from '../../../../../platform/instantiation/common/instantiation.js';\nimport { FinalNewLineParticipant, TrimFinalNewLinesParticipant, TrimWhitespaceParticipant } from '../../browser/saveParticipants.js';\nimport { TestConfigurationService } from '../../../../../platform/configuration/test/common/testConfigurationService.js';\nimport { workbenchInstantiationService, TestServiceAccessor } from '../../../../test/browser/workbenchTestServices.js';\nimport { ensureNoDisposablesAreLeakedInTestSuite, toResource } from '../../../../../base/test/common/utils.js';\nimport { Range } from '../../../../../editor/common/core/range.js';\nimport { Selection } from '../../../../../editor/common/core/selection.js';\nimport { TextFileEditorModel } from '../../../../services/textfile/common/textFileEditorModel.js';\nimport { IResolvedTextFileEditorModel, snapshotToString } from '../../../../services/textfile/common/textfiles.js';\nimport { SaveReason } from '../../../../common/editor.js';\nimport { TextFileEditorModelManager } from '../../../../services/textfile/common/textFileEditorModelManager.js';\nimport { DisposableStore } from '../../../../../base/common/lifecycle.js';\n\nsuite('Save Participants', function () {\n\n\tconst disposables = new DisposableStore();\n\tlet instantiationService: IInstantiationService;\n\tlet accessor: TestServiceAccessor;\n\n\tsetup(() => {\n\t\tinstantiationService = workbenchInstantiationService(undefined, disposables);\n\t\taccessor = instantiationService.createInstance(TestServiceAccessor);\n\t\tdisposables.add(<TextFileEditorModelManager>accessor.textFileService.files);\n\t});\n\n\tteardown(() => {\n\t\tdisposables.clear();\n\t});\n\n\ttest('insert final new line', async function () {\n\t\tconst model: IResolvedTextFileEditorModel = disposables.add(instantiationService.createInstance(TextFileEditorModel, toResource.call(this, '/path/final_new_line.txt'), 'utf8', undefined) as IResolvedTextFileEditorModel);\n\n\t\tawait model.resolve();\n\t\tconst configService = new TestConfigurationService();\n\t\tconfigService.setUserConfiguration('files', { 'insertFinalNewline': true });\n\t\tconst participant = new FinalNewLineParticipant(configService, undefined!);\n\n\t\t// No new line for empty lines\n\t\tlet lineContent = '';\n\t\tmodel.textEditorModel.setValue(lineContent);\n\t\tawait participant.participate(model, { reason: SaveReason.EXPLICIT });\n\t\tassert.strictEqual(snapshotToString(model.createSnapshot()!), lineContent);\n\n\t\t// No new line if last line already empty\n\t\tlineContent = `Hello New Line${model.textEditorModel.getEOL()}`;\n\t\tmodel.textEditorModel.setValue(lineContent);\n\t\tawait participant.participate(model, { reason: SaveReason.EXPLICIT });\n\t\tassert.strictEqual(snapshotToString(model.createSnapshot()!), lineContent);\n\n\t\t// New empty line added (single line)\n\t\tlineContent = 'Hello New Line';\n\t\tmodel.textEditorModel.setValue(lineContent);\n\t\tawait participant.participate(model, { reason: SaveReason.EXPLICIT });\n\t\tassert.strictEqual(snapshotToString(model.createSnapshot()!), `${lineContent}${model.textEditorModel.getEOL()}`);\n\n\t\t// New empty line added (multi line)\n\t\tlineContent = `Hello New Line${model.textEditorModel.getEOL()}Hello New Line${model.textEditorModel.getEOL()}Hello New Line`;\n\t\tmodel.textEditorModel.setValue(lineContent);\n\t\tawait participant.participate(model, { reason: SaveReason.EXPLICIT });\n\t\tassert.strictEqual(snapshotToString(model.createSnapshot()!), `${lineContent}${model.textEditorModel.getEOL()}`);\n\t});\n\n\ttest('trim final new lines', async function () {\n\t\tconst model: IResolvedTextFileEditorModel = disposables.add(instantiationService.createInstance(TextFileEditorModel, toResource.call(this, '/path/trim_final_new_line.txt'), 'utf8', undefined) as IResolvedTextFileEditorModel);\n\n\t\tawait model.resolve();\n\t\tconst configService = new TestConfigurationService();\n\t\tconfigService.setUserConfiguration('files', { 'trimFinalNewlines': true });\n\t\tconst participant = new TrimFinalNewLinesParticipant(configService, undefined!);\n\t\tconst textContent = 'Trim New Line';\n\t\tconst eol = `${model.textEditorModel.getEOL()}`;\n\n\t\t// No new line removal if last line is not new line\n\t\tlet lineContent = `${textContent}`;\n\t\tmodel.textEditorModel.setValue(lineContent);\n\t\tawait participant.participate(model, { reason: SaveReason.EXPLICIT });\n\t\tassert.strictEqual(snapshotToString(model.createSnapshot()!), lineContent);\n\n\t\t// No new line removal if last line is single new line\n\t\tlineContent = `${textContent}${eol}`;\n\t\tmodel.textEditorModel.setValue(lineContent);\n\t\tawait participant.participate(model, { reason: SaveReason.EXPLICIT });\n\t\tassert.strictEqual(snapshotToString(model.createSnapshot()!), lineContent);\n\n\t\t// Remove new line (single line with two new lines)\n\t\tlineContent = `${textContent}${eol}${eol}`;\n\t\tmodel.textEditorModel.setValue(lineContent);\n\t\tawait participant.participate(model, { reason: SaveReason.EXPLICIT });\n\t\tassert.strictEqual(snapshotToString(model.createSnapshot()!), `${textContent}${eol}`);\n\n\t\t// Remove new lines (multiple lines with multiple new lines)\n\t\tlineContent = `${textContent}${eol}${textContent}${eol}${eol}${eol}`;\n\t\tmodel.textEditorModel.setValue(lineContent);\n\t\tawait participant.participate(model, { reason: SaveReason.EXPLICIT });\n\t\tassert.strictEqual(snapshotToString(model.createSnapshot()!), `${textContent}${eol}${textContent}${eol}`);\n\t});\n\n\ttest('trim final new lines bug#39750', async function () {\n\t\tconst model: IResolvedTextFileEditorModel = disposables.add(instantiationService.createInstance(TextFileEditorModel, toResource.call(this, '/path/trim_final_new_line.txt'), 'utf8', undefined) as IResolvedTextFileEditorModel);\n\n\t\tawait model.resolve();\n\t\tconst configService = new TestConfigurationService();\n\t\tconfigService.setUserConfiguration('files', { 'trimFinalNewlines': true });\n\t\tconst participant = new TrimFinalNewLinesParticipant(configService, undefined!);\n\t\tconst textContent = 'Trim New Line';\n\n\t\t// single line\n\t\tconst lineContent = `${textContent}`;\n\t\tmodel.textEditorModel.setValue(lineContent);\n\n\t\t// apply edits and push to undo stack.\n\t\tconst textEdits = [{ range: new Range(1, 14, 1, 14), text: '.', forceMoveMarkers: false }];\n\t\tmodel.textEditorModel.pushEditOperations([new Selection(1, 14, 1, 14)], textEdits, () => { return [new Selection(1, 15, 1, 15)]; });\n\n\t\t// undo\n\t\tawait model.textEditorModel.undo();\n\t\tassert.strictEqual(snapshotToString(model.createSnapshot()!), `${textContent}`);\n\n\t\t// trim final new lines should not mess the undo stack\n\t\tawait participant.participate(model, { reason: SaveReason.EXPLICIT });\n\t\tawait model.textEditorModel.redo();\n\t\tassert.strictEqual(snapshotToString(model.createSnapshot()!), `${textContent}.`);\n\t});\n\n\ttest('trim final new lines bug#46075', async function () {\n\t\tconst model: IResolvedTextFileEditorModel = disposables.add(instantiationService.createInstance(TextFileEditorModel, toResource.call(this, '/path/trim_final_new_line.txt'), 'utf8', undefined) as IResolvedTextFileEditorModel);\n\n\t\tawait model.resolve();\n\t\tconst configService = new TestConfigurationService();\n\t\tconfigService.setUserConfiguration('files', { 'trimFinalNewlines': true });\n\t\tconst participant = new TrimFinalNewLinesParticipant(configService, undefined!);\n\t\tconst textContent = 'Test';\n\t\tconst eol = `${model.textEditorModel.getEOL()}`;\n\t\tconst content = `${textContent}${eol}${eol}`;\n\t\tmodel.textEditorModel.setValue(content);\n\n\t\t// save many times\n\t\tfor (let i = 0; i < 10; i++) {\n\t\t\tawait participant.participate(model, { reason: SaveReason.EXPLICIT });\n\t\t}\n\n\t\t// confirm trimming\n\t\tassert.strictEqual(snapshotToString(model.createSnapshot()!), `${textContent}${eol}`);\n\n\t\t// undo should go back to previous content immediately\n\t\tawait model.textEditorModel.undo();\n\t\tassert.strictEqual(snapshotToString(model.createSnapshot()!), `${textContent}${eol}${eol}`);\n\t\tawait model.textEditorModel.redo();\n\t\tassert.strictEqual(snapshotToString(model.createSnapshot()!), `${textContent}${eol}`);\n\t});\n\n\ttest('trim whitespace', async function () {\n\t\tconst model: IResolvedTextFileEditorModel = disposables.add(instantiationService.createInstance(TextFileEditorModel, toResource.call(this, '/path/trim_final_new_line.txt'), 'utf8', undefined) as IResolvedTextFileEditorModel);\n\n\t\tawait model.resolve();\n\t\tconst configService = new TestConfigurationService();\n\t\tconfigService.setUserConfiguration('files', { 'trimTrailingWhitespace': true });\n\t\tconst participant = new TrimWhitespaceParticipant(configService, undefined!);\n\t\tconst textContent = 'Test';\n\t\tconst content = `${textContent} \t`;\n\t\tmodel.textEditorModel.setValue(content);\n\n\t\t// save many times\n\t\tfor (let i = 0; i < 10; i++) {\n\t\t\tawait participant.participate(model, { reason: SaveReason.EXPLICIT });\n\t\t}\n\n\t\t// confirm trimming\n\t\tassert.strictEqual(snapshotToString(model.createSnapshot()!), `${textContent}`);\n\t});\n\n\tensureNoDisposablesAreLeakedInTestSuite();\n});\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport assert from 'assert';\nimport { IInstantiationService } from '../../../../../platform/instantiation/common/instantiation.js';\nimport { FinalNewLineParticipant, TrimFinalNewLinesParticipant, TrimWhitespaceParticipant } from '../../browser/saveParticipants.js';\nimport { TestConfigurationService } from '../../../../../platform/configuration/test/common/testConfigurationService.js';\nimport { workbenchInstantiationService, TestServiceAccessor } from '../../../../test/browser/workbenchTestServices.js';\nimport { ensureNoDisposablesAreLeakedInTestSuite, toResource } from '../../../../../base/test/common/utils.js';\nimport { Range } from '../../../../../editor/common/core/range.js';\nimport { Selection } from '../../../../../editor/common/core/selection.js';\nimport { TextFileEditorModel } from '../../../../services/textfile/common/textFileEditorModel.js';\nimport { IResolvedTextFileEditorModel, snapshotToString } from '../../../../services/textfile/common/textfiles.js';\nimport { SaveReason } from '../../../../common/editor.js';\nimport { TextFileEditorModelManager } from '../../../../services/textfile/common/textFileEditorModelManager.js';\nimport { DisposableStore } from '../../../../../base/common/lifecycle.js';\n\nsuite('Save Participants', function () {\n\n\tconst disposables = new DisposableStore();\n\tlet instantiationService: IInstantiationService;\n\tlet accessor: TestServiceAccessor;\n\n\tsetup(() => {\n\t\tinstantiationService = workbenchInstantiationService(undefined, disposables);\n\t\taccessor = instantiationService.createInstance(TestServiceAccessor);\n\t\tdisposables.add(<TextFileEditorModelManager>accessor.textFileService.files);\n\t});\n\n\tteardown(() => {\n\t\tdisposables.clear();\n\t});\n\n\ttest('insert final new line', async function () {\n\t\tconst model: IResolvedTextFileEditorModel = disposables.add(instantiationService.createInstance(TextFileEditorModel, toResource.call(this, '/path/final_new_line.txt'), 'utf8', undefined) as IResolvedTextFileEditorModel);\n\n\t\tawait model.resolve();\n\t\tconst configService = new TestConfigurationService();\n\t\tconfigService.setUserConfiguration('files', { 'insertFinalNewline': true });\n\t\tconst participant = new FinalNewLineParticipant(configService, undefined!);\n\n\t\t// No new line for empty lines\n\t\tlet lineContent = '';\n\t\tmodel.textEditorModel.setValue(lineContent);\n\t\tawait participant.participate(model, { reason: SaveReason.EXPLICIT });\n\t\tassert.strictEqual(snapshotToString(model.createSnapshot()!), lineContent);\n\n\t\t// No new line if last line already empty\n\t\tlineContent = `Hello New Line${model.textEditorModel.getEOL()}`;\n\t\tmodel.textEditorModel.setValue(lineContent);\n\t\tawait participant.participate(model, { reason: SaveReason.EXPLICIT });\n\t\tassert.strictEqual(snapshotToString(model.createSnapshot()!), lineContent);\n\n\t\t// New empty line added (single line)\n\t\tlineContent = 'Hello New Line';\n\t\tmodel.textEditorModel.setValue(lineContent);\n\t\tawait participant.participate(model, { reason: SaveReason.EXPLICIT });\n\t\tassert.strictEqual(snapshotToString(model.createSnapshot()!), `${lineContent}${model.textEditorModel.getEOL()}`);\n\n\t\t// New empty line added (multi line)\n\t\tlineContent = `Hello New Line${model.textEditorModel.getEOL()}Hello New Line${model.textEditorModel.getEOL()}Hello New Line`;\n\t\tmodel.textEditorModel.setValue(lineContent);\n\t\tawait participant.participate(model, { reason: SaveReason.EXPLICIT });\n\t\tassert.strictEqual(snapshotToString(model.createSnapshot()!), `${lineContent}${model.textEditorModel.getEOL()}`);\n\t});\n\n\ttest('trim final new lines', async function () {\n\t\tconst model: IResolvedTextFileEditorModel = disposables.add(instantiationService.createInstance(TextFileEditorModel, toResource.call(this, '/path/trim_final_new_line.txt'), 'utf8', undefined) as IResolvedTextFileEditorModel);\n\n\t\tawait model.resolve();\n\t\tconst configService = new TestConfigurationService();\n\t\tconfigService.setUserConfiguration('files', { 'trimFinalNewlines': true });\n\t\tconst participant = new TrimFinalNewLinesParticipant(configService, undefined!);\n\t\tconst textContent = 'Trim New Line';\n\t\tconst eol = `${model.textEditorModel.getEOL()}`;\n\n\t\t// No new line removal if last line is not new line\n\t\tlet lineContent = `${textContent}`;\n\t\tmodel.textEditorModel.setValue(lineContent);\n\t\tawait participant.participate(model, { reason: SaveReason.EXPLICIT });\n\t\tassert.strictEqual(snapshotToString(model.createSnapshot()!), lineContent);\n\n\t\t// No new line removal if last line is single new line\n\t\tlineContent = `${textContent}${eol}`;\n\t\tmodel.textEditorModel.setValue(lineContent);\n\t\tawait participant.participate(model, { reason: SaveReason.EXPLICIT });\n\t\tassert.strictEqual(snapshotToString(model.createSnapshot()!), lineContent);\n\n\t\t// Remove new line (single line with two new lines)\n\t\tlineContent = `${textContent}${eol}${eol}`;\n\t\tmodel.textEditorModel.setValue(lineContent);\n\t\tawait participant.participate(model, { reason: SaveReason.EXPLICIT });\n\t\tassert.strictEqual(snapshotToString(model.createSnapshot()!), `${textContent}${eol}`);\n\n\t\t// Remove new lines (multiple lines with multiple new lines)\n\t\tlineContent = `${textContent}${eol}${textContent}${eol}${eol}${eol}`;\n\t\tmodel.textEditorModel.setValue(lineContent);\n\t\tawait participant.participate(model, { reason: SaveReason.EXPLICIT });\n\t\tassert.strictEqual(snapshotToString(model.createSnapshot()!), `${textContent}${eol}${textContent}${eol}`);\n\t});\n\n\ttest('trim final new lines bug#39750', async function () {\n\t\tconst model: IResolvedTextFileEditorModel = disposables.add(instantiationService.createInstance(TextFileEditorModel, toResource.call(this, '/path/trim_final_new_line.txt'), 'utf8', undefined) as IResolvedTextFileEditorModel);\n\n\t\tawait model.resolve();\n\t\tconst configService = new TestConfigurationService();\n\t\tconfigService.setUserConfiguration('files', { 'trimFinalNewlines': true });\n\t\tconst participant = new TrimFinalNewLinesParticipant(configService, undefined!);\n\t\tconst textContent = 'Trim New Line';\n\n\t\t// single line\n\t\tconst lineContent = `${textContent}`;\n\t\tmodel.textEditorModel.setValue(lineContent);\n\n\t\t// apply edits and push to undo stack.\n\t\tconst textEdits = [{ range: new Range(1, 14, 1, 14), text: '.', forceMoveMarkers: false }];\n\t\tmodel.textEditorModel.pushEditOperations([new Selection(1, 14, 1, 14)], textEdits, () => { return [new Selection(1, 15, 1, 15)]; });\n\n\t\t// undo\n\t\tawait model.textEditorModel.undo();\n\t\tassert.strictEqual(snapshotToString(model.createSnapshot()!), `${textContent}`);\n\n\t\t// trim final new lines should not mess the undo stack\n\t\tawait participant.participate(model, { reason: SaveReason.EXPLICIT });\n\t\tawait model.textEditorModel.redo();\n\t\tassert.strictEqual(snapshotToString(model.createSnapshot()!), `${textContent}.`);\n\t});\n\n\ttest('trim final new lines bug#46075', async function () {\n\t\tconst model: IResolvedTextFileEditorModel = disposables.add(instantiationService.createInstance(TextFileEditorModel, toResource.call(this, '/path/trim_final_new_line.txt'), 'utf8', undefined) as IResolvedTextFileEditorModel);\n\n\t\tawait model.resolve();\n\t\tconst configService = new TestConfigurationService();\n\t\tconfigService.setUserConfiguration('files', { 'trimFinalNewlines': true });\n\t\tconst participant = new TrimFinalNewLinesParticipant(configService, undefined!);\n\t\tconst textContent = 'Test';\n\t\tconst eol = `${model.textEditorModel.getEOL()}`;\n\t\tconst content = `${textContent}${eol}${eol}`;\n\t\tmodel.textEditorModel.setValue(content);\n\n\t\t// save many times\n\t\tfor (let i = 0; i < 10; i++) {\n\t\t\tawait participant.participate(model, { reason: SaveReason.EXPLICIT });\n\t\t}\n\n\t\t// confirm trimming\n\t\tassert.strictEqual(snapshotToString(model.createSnapshot()!), `${textContent}${eol}`);\n\n\t\t// undo should go back to previous content immediately\n\t\tawait model.textEditorModel.undo();\n\t\tassert.strictEqual(snapshotToString(model.createSnapshot()!), `${textContent}${eol}${eol}`);\n\t\tawait model.textEditorModel.redo();\n\t\tassert.strictEqual(snapshotToString(model.createSnapshot()!), `${textContent}${eol}`);\n\t});\n\n\ttest('trim whitespace', async function () {\n\t\tconst model: IResolvedTextFileEditorModel = disposables.add(instantiationService.createInstance(TextFileEditorModel, toResource.call(this, '/path/trim_final_new_line.txt'), 'utf8', undefined) as IResolvedTextFileEditorModel);\n\n\t\tawait model.resolve();\n\t\tconst configService = new TestConfigurationService();\n\t\tconfigService.setUserConfiguration('files', { 'trimTrailingWhitespace': true });\n\t\tconst participant = new TrimWhitespaceParticipant(configService, undefined!);\n\t\tconst textContent = 'Test';\n\t\tconst content = `${textContent} \t`;\n\t\tmodel.textEditorModel.setValue(content);\n\n\t\t// save many times\n\t\tfor (let i = 0; i < 10; i++) {\n\t\t\tawait participant.participate(model, { reason: SaveReason.EXPLICIT });\n\t\t}\n\n\t\t// confirm trimming\n\t\tassert.strictEqual(snapshotToString(model.createSnapshot()!), `${textContent}`);\n\t});\n\n\tensureNoDisposablesAreLeakedInTestSuite();\n});\n"]}