{"version":3,"sources":["vs/workbench/contrib/codeEditor/browser/dictation/editorDictation.ts"],"names":[],"mappings":"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","file":"editorDictation.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport './editorDictation.css';\nimport { localize, localize2 } from '../../../../../nls.js';\nimport { IDimension } from '../../../../../base/browser/dom.js';\nimport { CancellationTokenSource } from '../../../../../base/common/cancellation.js';\nimport { Disposable, DisposableStore, MutableDisposable, toDisposable } from '../../../../../base/common/lifecycle.js';\nimport { ContentWidgetPositionPreference, ICodeEditor, IContentWidget, IContentWidgetPosition } from '../../../../../editor/browser/editorBrowser.js';\nimport { IEditorContribution } from '../../../../../editor/common/editorCommon.js';\nimport { ContextKeyExpr, IContextKey, IContextKeyService, RawContextKey } from '../../../../../platform/contextkey/common/contextkey.js';\nimport { HasSpeechProvider, ISpeechService, SpeechToTextInProgress, SpeechToTextStatus } from '../../../speech/common/speechService.js';\nimport { Codicon } from '../../../../../base/common/codicons.js';\nimport { EditorOption } from '../../../../../editor/common/config/editorOptions.js';\nimport { EditorAction2, EditorContributionInstantiation, registerEditorContribution } from '../../../../../editor/browser/editorExtensions.js';\nimport { EditorContextKeys } from '../../../../../editor/common/editorContextKeys.js';\nimport { KeyCode, KeyMod } from '../../../../../base/common/keyCodes.js';\nimport { KeybindingWeight } from '../../../../../platform/keybinding/common/keybindingsRegistry.js';\nimport { ServicesAccessor } from '../../../../../platform/instantiation/common/instantiation.js';\nimport { IKeybindingService } from '../../../../../platform/keybinding/common/keybinding.js';\nimport { EditOperation } from '../../../../../editor/common/core/editOperation.js';\nimport { Selection } from '../../../../../editor/common/core/selection.js';\nimport { Position } from '../../../../../editor/common/core/position.js';\nimport { Range } from '../../../../../editor/common/core/range.js';\nimport { registerAction2 } from '../../../../../platform/actions/common/actions.js';\nimport { assertReturnsDefined } from '../../../../../base/common/types.js';\nimport { ActionBar } from '../../../../../base/browser/ui/actionbar/actionbar.js';\nimport { toAction } from '../../../../../base/common/actions.js';\nimport { ThemeIcon } from '../../../../../base/common/themables.js';\nimport { isWindows } from '../../../../../base/common/platform.js';\n\nconst EDITOR_DICTATION_IN_PROGRESS = new RawContextKey<boolean>('editorDictation.inProgress', false);\nconst VOICE_CATEGORY = localize2('voiceCategory', \"Voice\");\n\nexport class EditorDictationStartAction extends EditorAction2 {\n\n\tconstructor() {\n\t\tsuper({\n\t\t\tid: 'workbench.action.editorDictation.start',\n\t\t\ttitle: localize2('startDictation', \"Start Dictation in Editor\"),\n\t\t\tcategory: VOICE_CATEGORY,\n\t\t\tprecondition: ContextKeyExpr.and(\n\t\t\t\tHasSpeechProvider,\n\t\t\t\tSpeechToTextInProgress.toNegated(),\t\t// disable when any speech-to-text is in progress\n\t\t\t\tEditorContextKeys.readOnly.toNegated()\t// disable in read-only editors\n\t\t\t),\n\t\t\tf1: true,\n\t\t\tkeybinding: {\n\t\t\t\tprimary: KeyMod.CtrlCmd | KeyMod.Alt | KeyCode.KeyV,\n\t\t\t\tweight: KeybindingWeight.WorkbenchContrib,\n\t\t\t\tsecondary: isWindows ? [\n\t\t\t\t\tKeyMod.Alt | KeyCode.Backquote\n\t\t\t\t] : undefined\n\t\t\t}\n\t\t});\n\t}\n\n\toverride runEditorCommand(accessor: ServicesAccessor, editor: ICodeEditor): void {\n\t\tconst keybindingService = accessor.get(IKeybindingService);\n\n\t\tconst holdMode = keybindingService.enableKeybindingHoldMode(this.desc.id);\n\t\tif (holdMode) {\n\t\t\tlet shouldCallStop = false;\n\n\t\t\tconst handle = setTimeout(() => {\n\t\t\t\tshouldCallStop = true;\n\t\t\t}, 500);\n\n\t\t\tholdMode.finally(() => {\n\t\t\t\tclearTimeout(handle);\n\n\t\t\t\tif (shouldCallStop) {\n\t\t\t\t\tEditorDictation.get(editor)?.stop();\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tEditorDictation.get(editor)?.start();\n\t}\n}\n\nexport class EditorDictationStopAction extends EditorAction2 {\n\n\tstatic readonly ID = 'workbench.action.editorDictation.stop';\n\n\tconstructor() {\n\t\tsuper({\n\t\t\tid: EditorDictationStopAction.ID,\n\t\t\ttitle: localize2('stopDictation', \"Stop Dictation in Editor\"),\n\t\t\tcategory: VOICE_CATEGORY,\n\t\t\tprecondition: EDITOR_DICTATION_IN_PROGRESS,\n\t\t\tf1: true,\n\t\t\tkeybinding: {\n\t\t\t\tprimary: KeyCode.Escape,\n\t\t\t\tweight: KeybindingWeight.WorkbenchContrib + 100\n\t\t\t}\n\t\t});\n\t}\n\n\toverride runEditorCommand(_accessor: ServicesAccessor, editor: ICodeEditor): void {\n\t\tEditorDictation.get(editor)?.stop();\n\t}\n}\n\nexport class DictationWidget extends Disposable implements IContentWidget {\n\n\treadonly suppressMouseDown = true;\n\treadonly allowEditorOverflow = true;\n\n\tprivate readonly domNode = document.createElement('div');\n\n\tconstructor(private readonly editor: ICodeEditor, keybindingService: IKeybindingService) {\n\t\tsuper();\n\n\t\tconst actionBar = this._register(new ActionBar(this.domNode));\n\t\tconst stopActionKeybinding = keybindingService.lookupKeybinding(EditorDictationStopAction.ID)?.getLabel();\n\t\tactionBar.push(toAction({\n\t\t\tid: EditorDictationStopAction.ID,\n\t\t\tlabel: stopActionKeybinding ? localize('stopDictationShort1', \"Stop Dictation ({0})\", stopActionKeybinding) : localize('stopDictationShort2', \"Stop Dictation\"),\n\t\t\tclass: ThemeIcon.asClassName(Codicon.micFilled),\n\t\t\trun: () => EditorDictation.get(editor)?.stop()\n\t\t}), { icon: true, label: false, keybinding: stopActionKeybinding });\n\n\t\tthis.domNode.classList.add('editor-dictation-widget');\n\t\tthis.domNode.appendChild(actionBar.domNode);\n\t}\n\n\tgetId(): string {\n\t\treturn 'editorDictation';\n\t}\n\n\tgetDomNode(): HTMLElement {\n\t\treturn this.domNode;\n\t}\n\n\tgetPosition(): IContentWidgetPosition | null {\n\t\tif (!this.editor.hasModel()) {\n\t\t\treturn null;\n\t\t}\n\n\t\tconst selection = this.editor.getSelection();\n\n\t\treturn {\n\t\t\tposition: selection.getPosition(),\n\t\t\tpreference: [\n\t\t\t\tselection.getPosition().equals(selection.getStartPosition()) ? ContentWidgetPositionPreference.ABOVE : ContentWidgetPositionPreference.BELOW,\n\t\t\t\tContentWidgetPositionPreference.EXACT\n\t\t\t]\n\t\t};\n\t}\n\n\tbeforeRender(): IDimension | null {\n\t\tconst position = this.editor.getPosition();\n\t\tconst lineHeight = position ? this.editor.getLineHeightForPosition(position) : this.editor.getOption(EditorOption.lineHeight);\n\t\tconst width = this.editor.getLayoutInfo().contentWidth * 0.7;\n\n\t\tthis.domNode.style.setProperty('--vscode-editor-dictation-widget-height', `${lineHeight}px`);\n\t\tthis.domNode.style.setProperty('--vscode-editor-dictation-widget-width', `${width}px`);\n\n\t\treturn null;\n\t}\n\n\tshow() {\n\t\tthis.editor.addContentWidget(this);\n\t}\n\n\tlayout(): void {\n\t\tthis.editor.layoutContentWidget(this);\n\t}\n\n\tactive(): void {\n\t\tthis.domNode.classList.add('recording');\n\t}\n\n\thide() {\n\t\tthis.domNode.classList.remove('recording');\n\t\tthis.editor.removeContentWidget(this);\n\t}\n}\n\nexport class EditorDictation extends Disposable implements IEditorContribution {\n\n\tstatic readonly ID = 'editorDictation';\n\n\tstatic get(editor: ICodeEditor): EditorDictation | null {\n\t\treturn editor.getContribution<EditorDictation>(EditorDictation.ID);\n\t}\n\n\tprivate readonly widget: DictationWidget;\n\tprivate readonly editorDictationInProgress: IContextKey<boolean>;\n\n\tprivate readonly sessionDisposables = this._register(new MutableDisposable());\n\n\tconstructor(\n\t\tprivate readonly editor: ICodeEditor,\n\t\t@ISpeechService private readonly speechService: ISpeechService,\n\t\t@IContextKeyService contextKeyService: IContextKeyService,\n\t\t@IKeybindingService keybindingService: IKeybindingService\n\t) {\n\t\tsuper();\n\n\t\tthis.widget = this._register(new DictationWidget(this.editor, keybindingService));\n\t\tthis.editorDictationInProgress = EDITOR_DICTATION_IN_PROGRESS.bindTo(contextKeyService);\n\t}\n\n\tasync start(): Promise<void> {\n\t\tconst disposables = new DisposableStore();\n\t\tthis.sessionDisposables.value = disposables;\n\n\t\tthis.widget.show();\n\t\tdisposables.add(toDisposable(() => this.widget.hide()));\n\n\t\tthis.editorDictationInProgress.set(true);\n\t\tdisposables.add(toDisposable(() => this.editorDictationInProgress.reset()));\n\n\t\tconst collection = this.editor.createDecorationsCollection();\n\t\tdisposables.add(toDisposable(() => collection.clear()));\n\n\t\tdisposables.add(this.editor.onDidChangeCursorPosition(() => this.widget.layout()));\n\n\t\tlet previewStart: Position | undefined = undefined;\n\n\t\tlet lastReplaceTextLength = 0;\n\t\tconst replaceText = (text: string, isPreview: boolean) => {\n\t\t\tif (!previewStart) {\n\t\t\t\tpreviewStart = assertReturnsDefined(this.editor.getPosition());\n\t\t\t}\n\n\t\t\tconst endPosition = new Position(previewStart.lineNumber, previewStart.column + text.length);\n\t\t\tthis.editor.executeEdits(EditorDictation.ID, [\n\t\t\t\tEditOperation.replace(Range.fromPositions(previewStart, previewStart.with(undefined, previewStart.column + lastReplaceTextLength)), text)\n\t\t\t], [\n\t\t\t\tSelection.fromPositions(endPosition)\n\t\t\t]);\n\n\t\t\tif (isPreview) {\n\t\t\t\tcollection.set([\n\t\t\t\t\t{\n\t\t\t\t\t\trange: Range.fromPositions(previewStart, previewStart.with(undefined, previewStart.column + text.length)),\n\t\t\t\t\t\toptions: {\n\t\t\t\t\t\t\tdescription: 'editor-dictation-preview',\n\t\t\t\t\t\t\tinlineClassName: 'ghost-text-decoration-preview'\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t]);\n\t\t\t} else {\n\t\t\t\tcollection.clear();\n\t\t\t}\n\n\t\t\tlastReplaceTextLength = text.length;\n\t\t\tif (!isPreview) {\n\t\t\t\tpreviewStart = undefined;\n\t\t\t\tlastReplaceTextLength = 0;\n\t\t\t}\n\n\t\t\tthis.editor.revealPositionInCenterIfOutsideViewport(endPosition);\n\t\t};\n\n\t\tconst cts = new CancellationTokenSource();\n\t\tdisposables.add(toDisposable(() => cts.dispose(true)));\n\n\t\tconst session = await this.speechService.createSpeechToTextSession(cts.token, 'editor');\n\t\tdisposables.add(session.onDidChange(e => {\n\t\t\tif (cts.token.isCancellationRequested) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tswitch (e.status) {\n\t\t\t\tcase SpeechToTextStatus.Started:\n\t\t\t\t\tthis.widget.active();\n\t\t\t\t\tbreak;\n\t\t\t\tcase SpeechToTextStatus.Stopped:\n\t\t\t\t\tdisposables.dispose();\n\t\t\t\t\tbreak;\n\t\t\t\tcase SpeechToTextStatus.Recognizing: {\n\t\t\t\t\tif (!e.text) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\treplaceText(e.text, true);\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tcase SpeechToTextStatus.Recognized: {\n\t\t\t\t\tif (!e.text) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\treplaceText(`${e.text} `, false);\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}));\n\t}\n\n\tstop(): void {\n\t\tthis.sessionDisposables.clear();\n\t}\n}\n\nregisterEditorContribution(EditorDictation.ID, EditorDictation, EditorContributionInstantiation.Lazy);\nregisterAction2(EditorDictationStartAction);\nregisterAction2(EditorDictationStopAction);\n"]}