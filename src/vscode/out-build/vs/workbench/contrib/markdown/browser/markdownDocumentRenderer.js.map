{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/contrib/markdown/browser/markdownDocumentRenderer.ts","vs/workbench/contrib/markdown/browser/markdownDocumentRenderer.ts"],"names":[],"mappings":"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","file":"markdownDocumentRenderer.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { sanitizeHtml } from '../../../../base/browser/domSanitize.js';\nimport { allowedMarkdownHtmlAttributes, allowedMarkdownHtmlTags } from '../../../../base/browser/markdownRenderer.js';\nimport { raceCancellationError } from '../../../../base/common/async.js';\nimport { CancellationToken } from '../../../../base/common/cancellation.js';\nimport * as marked from '../../../../base/common/marked/marked.js';\nimport { Schemas } from '../../../../base/common/network.js';\nimport { escape } from '../../../../base/common/strings.js';\nimport { ILanguageService } from '../../../../editor/common/languages/language.js';\nimport { tokenizeToString } from '../../../../editor/common/languages/textToHtmlTokenizer.js';\nimport { IExtensionService } from '../../../services/extensions/common/extensions.js';\nimport { markedGfmHeadingIdPlugin } from './markedGfmHeadingIdPlugin.js';\n\nexport const DEFAULT_MARKDOWN_STYLES = `\nbody {\n\tpadding: 10px 20px;\n\tline-height: 22px;\n\tmax-width: 882px;\n\tmargin: 0 auto;\n}\n\nbody *:last-child {\n\tmargin-bottom: 0;\n}\n\nimg {\n\tmax-width: 100%;\n\tmax-height: 100%;\n}\n\na {\n\ttext-decoration: var(--text-link-decoration);\n}\n\na:hover {\n\ttext-decoration: underline;\n}\n\na:focus,\ninput:focus,\nselect:focus,\ntextarea:focus {\n\toutline: 1px solid -webkit-focus-ring-color;\n\toutline-offset: -1px;\n}\n\nhr {\n\tborder: 0;\n\theight: 2px;\n\tborder-bottom: 2px solid;\n}\n\nh1 {\n\tpadding-bottom: 0.3em;\n\tline-height: 1.2;\n\tborder-bottom-width: 1px;\n\tborder-bottom-style: solid;\n}\n\nh1, h2, h3 {\n\tfont-weight: normal;\n}\n\ntable {\n\tborder-collapse: collapse;\n}\n\nth {\n\ttext-align: left;\n\tborder-bottom: 1px solid;\n}\n\nth,\ntd {\n\tpadding: 5px 10px;\n}\n\ntable > tbody > tr + tr > td {\n\tborder-top-width: 1px;\n\tborder-top-style: solid;\n}\n\nblockquote {\n\tmargin: 0 7px 0 5px;\n\tpadding: 0 16px 0 10px;\n\tborder-left-width: 5px;\n\tborder-left-style: solid;\n}\n\ncode {\n\tfont-family: \"SF Mono\", Monaco, Menlo, Consolas, \"Ubuntu Mono\", \"Liberation Mono\", \"DejaVu Sans Mono\", \"Courier New\", monospace;\n}\n\npre {\n\tpadding: 16px;\n\tborder-radius: 3px;\n\toverflow: auto;\n}\n\npre code {\n\tfont-family: var(--vscode-editor-font-family);\n\tfont-weight: var(--vscode-editor-font-weight);\n\tfont-size: var(--vscode-editor-font-size);\n\tline-height: 1.5;\n\tcolor: var(--vscode-editor-foreground);\n\ttab-size: 4;\n}\n\n.monaco-tokenized-source {\n\twhite-space: pre;\n}\n\n/** Theming */\n\n.pre {\n\tbackground-color: var(--vscode-textCodeBlock-background);\n}\n\n.vscode-high-contrast h1 {\n\tborder-color: rgb(0, 0, 0);\n}\n\n.vscode-light th {\n\tborder-color: rgba(0, 0, 0, 0.69);\n}\n\n.vscode-dark th {\n\tborder-color: rgba(255, 255, 255, 0.69);\n}\n\n.vscode-light h1,\n.vscode-light hr,\n.vscode-light td {\n\tborder-color: rgba(0, 0, 0, 0.18);\n}\n\n.vscode-dark h1,\n.vscode-dark hr,\n.vscode-dark td {\n\tborder-color: rgba(255, 255, 255, 0.18);\n}\n\n@media (forced-colors: active) and (prefers-color-scheme: light){\n\tbody {\n\t\tforced-color-adjust: none;\n\t}\n}\n\n@media (forced-colors: active) and (prefers-color-scheme: dark){\n\tbody {\n\t\tforced-color-adjust: none;\n\t}\n}\n`;\n\nconst defaultAllowedLinkProtocols = Object.freeze([\n\tSchemas.http,\n\tSchemas.https,\n]);\n\nfunction sanitize(documentContent: string, sanitizerConfig: MarkdownDocumentSanitizerConfig | undefined): TrustedHTML {\n\treturn sanitizeHtml(documentContent, {\n\t\tallowedLinkProtocols: {\n\t\t\toverride: sanitizerConfig?.allowedLinkProtocols?.override ?? defaultAllowedLinkProtocols,\n\t\t},\n\t\tallowRelativeLinkPaths: sanitizerConfig?.allowRelativeLinkPaths,\n\t\tallowedMediaProtocols: sanitizerConfig?.allowedMediaProtocols,\n\t\tallowRelativeMediaPaths: sanitizerConfig?.allowRelativeMediaPaths,\n\t\tallowedTags: {\n\t\t\toverride: allowedMarkdownHtmlTags,\n\t\t\taugment: sanitizerConfig?.allowedTags?.augment\n\t\t},\n\t\tallowedAttributes: {\n\t\t\toverride: [\n\t\t\t\t...allowedMarkdownHtmlAttributes,\n\t\t\t\t'name',\n\t\t\t\t'id',\n\t\t\t\t'class',\n\t\t\t\t'role',\n\t\t\t\t'tabindex',\n\t\t\t\t'placeholder',\n\t\t\t],\n\t\t\taugment: sanitizerConfig?.allowedAttributes?.augment ?? [],\n\t\t}\n\t});\n}\n\ninterface MarkdownDocumentSanitizerConfig {\n\treadonly allowedLinkProtocols?: {\n\t\treadonly override: readonly string[] | '*';\n\t};\n\treadonly allowRelativeLinkPaths?: boolean;\n\n\treadonly allowedMediaProtocols?: {\n\t\treadonly override: readonly string[] | '*';\n\t};\n\treadonly allowRelativeMediaPaths?: boolean;\n\n\treadonly allowedTags?: {\n\t\treadonly augment: readonly string[];\n\t};\n\n\treadonly allowedAttributes?: {\n\t\treadonly augment: readonly string[];\n\t};\n}\n\ninterface IRenderMarkdownDocumentOptions {\n\treadonly sanitizerConfig?: MarkdownDocumentSanitizerConfig;\n\treadonly markedExtensions?: readonly marked.MarkedExtension[];\n}\n\n/**\n * Renders a string of markdown for use in an external document context.\n *\n * Uses VS Code's syntax highlighting code blocks. Also does not attach all the hooks and customization that normal\n * markdown renderer.\n */\nexport async function renderMarkdownDocument(\n\ttext: string,\n\textensionService: IExtensionService,\n\tlanguageService: ILanguageService,\n\toptions?: IRenderMarkdownDocumentOptions,\n\ttoken: CancellationToken = CancellationToken.None,\n): Promise<TrustedHTML> {\n\tconst m = new marked.Marked(\n\t\tMarkedHighlight.markedHighlight({\n\t\t\tasync: true,\n\t\t\tasync highlight(code: string, lang: string): Promise<string> {\n\t\t\t\tif (typeof lang !== 'string') {\n\t\t\t\t\treturn escape(code);\n\t\t\t\t}\n\n\t\t\t\tawait extensionService.whenInstalledExtensionsRegistered();\n\t\t\t\tif (token?.isCancellationRequested) {\n\t\t\t\t\treturn '';\n\t\t\t\t}\n\n\t\t\t\tconst languageId = languageService.getLanguageIdByLanguageName(lang) ?? languageService.getLanguageIdByLanguageName(lang.split(/\\s+|:|,|(?!^)\\{|\\?]/, 1)[0]);\n\t\t\t\treturn tokenizeToString(languageService, code, languageId);\n\t\t\t}\n\t\t}),\n\t\tmarkedGfmHeadingIdPlugin(),\n\t\t...(options?.markedExtensions ?? []),\n\t);\n\n\tconst raw = await raceCancellationError(m.parse(text, { async: true }), token ?? CancellationToken.None);\n\treturn sanitize(raw, options?.sanitizerConfig);\n}\n\nnamespace MarkedHighlight {\n\t// Copied from https://github.com/markedjs/marked-highlight/blob/main/src/index.js\n\n\texport function markedHighlight(options: marked.MarkedOptions & { highlight: (code: string, lang: string) => string | Promise<string> }): marked.MarkedExtension {\n\t\tif (typeof options === 'function') {\n\t\t\toptions = {\n\t\t\t\thighlight: options,\n\t\t\t};\n\t\t}\n\n\t\tif (!options || typeof options.highlight !== 'function') {\n\t\t\tthrow new Error('Must provide highlight function');\n\t\t}\n\n\t\treturn {\n\t\t\tasync: !!options.async,\n\t\t\twalkTokens(token: marked.Token): Promise<void> | void {\n\t\t\t\tif (token.type !== 'code') {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (options.async) {\n\t\t\t\t\treturn Promise.resolve(options.highlight(token.text, token.lang)).then(updateToken(token));\n\t\t\t\t}\n\n\t\t\t\tconst code = options.highlight(token.text, token.lang);\n\t\t\t\tif (code instanceof Promise) {\n\t\t\t\t\tthrow new Error('markedHighlight is not set to async but the highlight function is async. Set the async option to true on markedHighlight to await the async highlight function.');\n\t\t\t\t}\n\t\t\t\tupdateToken(token)(code);\n\t\t\t},\n\t\t\trenderer: {\n\t\t\t\tcode({ text, lang, escaped }: marked.Tokens.Code) {\n\t\t\t\t\tconst classAttr = lang\n\t\t\t\t\t\t? ` class=\"language-${escape(lang)}\"`\n\t\t\t\t\t\t: '';\n\t\t\t\t\ttext = text.replace(/\\n$/, '');\n\t\t\t\t\treturn `<pre><code${classAttr}>${escaped ? text : escape(text, true)}\\n</code></pre>`;\n\t\t\t\t},\n\t\t\t},\n\t\t};\n\t}\n\n\tfunction updateToken(token: any) {\n\t\treturn (code: string) => {\n\t\t\tif (typeof code === 'string' && code !== token.text) {\n\t\t\t\ttoken.escaped = true;\n\t\t\t\ttoken.text = code;\n\t\t\t}\n\t\t};\n\t}\n\n\t// copied from marked helpers\n\tconst escapeTest = /[&<>\"']/;\n\tconst escapeReplace = new RegExp(escapeTest.source, 'g');\n\tconst escapeTestNoEncode = /[<>\"']|&(?!(#\\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\\w+);)/;\n\tconst escapeReplaceNoEncode = new RegExp(escapeTestNoEncode.source, 'g');\n\tconst escapeReplacement: Record<string, string> = {\n\t\t'&': '&amp;',\n\t\t'<': '&lt;',\n\t\t'>': '&gt;',\n\t\t'\"': '&quot;',\n\t\t[`'`]: '&#39;',\n\t};\n\tconst getEscapeReplacement = (ch: string) => escapeReplacement[ch];\n\tfunction escape(html: string, encode?: boolean) {\n\t\tif (encode) {\n\t\t\tif (escapeTest.test(html)) {\n\t\t\t\treturn html.replace(escapeReplace, getEscapeReplacement);\n\t\t\t}\n\t\t} else {\n\t\t\tif (escapeTestNoEncode.test(html)) {\n\t\t\t\treturn html.replace(escapeReplaceNoEncode, getEscapeReplacement);\n\t\t\t}\n\t\t}\n\n\t\treturn html;\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { sanitizeHtml } from '../../../../base/browser/domSanitize.js';\nimport { allowedMarkdownHtmlAttributes, allowedMarkdownHtmlTags } from '../../../../base/browser/markdownRenderer.js';\nimport { raceCancellationError } from '../../../../base/common/async.js';\nimport { CancellationToken } from '../../../../base/common/cancellation.js';\nimport * as marked from '../../../../base/common/marked/marked.js';\nimport { Schemas } from '../../../../base/common/network.js';\nimport { escape } from '../../../../base/common/strings.js';\nimport { ILanguageService } from '../../../../editor/common/languages/language.js';\nimport { tokenizeToString } from '../../../../editor/common/languages/textToHtmlTokenizer.js';\nimport { IExtensionService } from '../../../services/extensions/common/extensions.js';\nimport { markedGfmHeadingIdPlugin } from './markedGfmHeadingIdPlugin.js';\n\nexport const DEFAULT_MARKDOWN_STYLES = `\nbody {\n\tpadding: 10px 20px;\n\tline-height: 22px;\n\tmax-width: 882px;\n\tmargin: 0 auto;\n}\n\nbody *:last-child {\n\tmargin-bottom: 0;\n}\n\nimg {\n\tmax-width: 100%;\n\tmax-height: 100%;\n}\n\na {\n\ttext-decoration: var(--text-link-decoration);\n}\n\na:hover {\n\ttext-decoration: underline;\n}\n\na:focus,\ninput:focus,\nselect:focus,\ntextarea:focus {\n\toutline: 1px solid -webkit-focus-ring-color;\n\toutline-offset: -1px;\n}\n\nhr {\n\tborder: 0;\n\theight: 2px;\n\tborder-bottom: 2px solid;\n}\n\nh1 {\n\tpadding-bottom: 0.3em;\n\tline-height: 1.2;\n\tborder-bottom-width: 1px;\n\tborder-bottom-style: solid;\n}\n\nh1, h2, h3 {\n\tfont-weight: normal;\n}\n\ntable {\n\tborder-collapse: collapse;\n}\n\nth {\n\ttext-align: left;\n\tborder-bottom: 1px solid;\n}\n\nth,\ntd {\n\tpadding: 5px 10px;\n}\n\ntable > tbody > tr + tr > td {\n\tborder-top-width: 1px;\n\tborder-top-style: solid;\n}\n\nblockquote {\n\tmargin: 0 7px 0 5px;\n\tpadding: 0 16px 0 10px;\n\tborder-left-width: 5px;\n\tborder-left-style: solid;\n}\n\ncode {\n\tfont-family: \"SF Mono\", Monaco, Menlo, Consolas, \"Ubuntu Mono\", \"Liberation Mono\", \"DejaVu Sans Mono\", \"Courier New\", monospace;\n}\n\npre {\n\tpadding: 16px;\n\tborder-radius: 3px;\n\toverflow: auto;\n}\n\npre code {\n\tfont-family: var(--vscode-editor-font-family);\n\tfont-weight: var(--vscode-editor-font-weight);\n\tfont-size: var(--vscode-editor-font-size);\n\tline-height: 1.5;\n\tcolor: var(--vscode-editor-foreground);\n\ttab-size: 4;\n}\n\n.monaco-tokenized-source {\n\twhite-space: pre;\n}\n\n/** Theming */\n\n.pre {\n\tbackground-color: var(--vscode-textCodeBlock-background);\n}\n\n.vscode-high-contrast h1 {\n\tborder-color: rgb(0, 0, 0);\n}\n\n.vscode-light th {\n\tborder-color: rgba(0, 0, 0, 0.69);\n}\n\n.vscode-dark th {\n\tborder-color: rgba(255, 255, 255, 0.69);\n}\n\n.vscode-light h1,\n.vscode-light hr,\n.vscode-light td {\n\tborder-color: rgba(0, 0, 0, 0.18);\n}\n\n.vscode-dark h1,\n.vscode-dark hr,\n.vscode-dark td {\n\tborder-color: rgba(255, 255, 255, 0.18);\n}\n\n@media (forced-colors: active) and (prefers-color-scheme: light){\n\tbody {\n\t\tforced-color-adjust: none;\n\t}\n}\n\n@media (forced-colors: active) and (prefers-color-scheme: dark){\n\tbody {\n\t\tforced-color-adjust: none;\n\t}\n}\n`;\n\nconst defaultAllowedLinkProtocols = Object.freeze([\n\tSchemas.http,\n\tSchemas.https,\n]);\n\nfunction sanitize(documentContent: string, sanitizerConfig: MarkdownDocumentSanitizerConfig | undefined): TrustedHTML {\n\treturn sanitizeHtml(documentContent, {\n\t\tallowedLinkProtocols: {\n\t\t\toverride: sanitizerConfig?.allowedLinkProtocols?.override ?? defaultAllowedLinkProtocols,\n\t\t},\n\t\tallowRelativeLinkPaths: sanitizerConfig?.allowRelativeLinkPaths,\n\t\tallowedMediaProtocols: sanitizerConfig?.allowedMediaProtocols,\n\t\tallowRelativeMediaPaths: sanitizerConfig?.allowRelativeMediaPaths,\n\t\tallowedTags: {\n\t\t\toverride: allowedMarkdownHtmlTags,\n\t\t\taugment: sanitizerConfig?.allowedTags?.augment\n\t\t},\n\t\tallowedAttributes: {\n\t\t\toverride: [\n\t\t\t\t...allowedMarkdownHtmlAttributes,\n\t\t\t\t'name',\n\t\t\t\t'id',\n\t\t\t\t'class',\n\t\t\t\t'role',\n\t\t\t\t'tabindex',\n\t\t\t\t'placeholder',\n\t\t\t],\n\t\t\taugment: sanitizerConfig?.allowedAttributes?.augment ?? [],\n\t\t}\n\t});\n}\n\ninterface MarkdownDocumentSanitizerConfig {\n\treadonly allowedLinkProtocols?: {\n\t\treadonly override: readonly string[] | '*';\n\t};\n\treadonly allowRelativeLinkPaths?: boolean;\n\n\treadonly allowedMediaProtocols?: {\n\t\treadonly override: readonly string[] | '*';\n\t};\n\treadonly allowRelativeMediaPaths?: boolean;\n\n\treadonly allowedTags?: {\n\t\treadonly augment: readonly string[];\n\t};\n\n\treadonly allowedAttributes?: {\n\t\treadonly augment: readonly string[];\n\t};\n}\n\ninterface IRenderMarkdownDocumentOptions {\n\treadonly sanitizerConfig?: MarkdownDocumentSanitizerConfig;\n\treadonly markedExtensions?: readonly marked.MarkedExtension[];\n}\n\n/**\n * Renders a string of markdown for use in an external document context.\n *\n * Uses VS Code's syntax highlighting code blocks. Also does not attach all the hooks and customization that normal\n * markdown renderer.\n */\nexport async function renderMarkdownDocument(\n\ttext: string,\n\textensionService: IExtensionService,\n\tlanguageService: ILanguageService,\n\toptions?: IRenderMarkdownDocumentOptions,\n\ttoken: CancellationToken = CancellationToken.None,\n): Promise<TrustedHTML> {\n\tconst m = new marked.Marked(\n\t\tMarkedHighlight.markedHighlight({\n\t\t\tasync: true,\n\t\t\tasync highlight(code: string, lang: string): Promise<string> {\n\t\t\t\tif (typeof lang !== 'string') {\n\t\t\t\t\treturn escape(code);\n\t\t\t\t}\n\n\t\t\t\tawait extensionService.whenInstalledExtensionsRegistered();\n\t\t\t\tif (token?.isCancellationRequested) {\n\t\t\t\t\treturn '';\n\t\t\t\t}\n\n\t\t\t\tconst languageId = languageService.getLanguageIdByLanguageName(lang) ?? languageService.getLanguageIdByLanguageName(lang.split(/\\s+|:|,|(?!^)\\{|\\?]/, 1)[0]);\n\t\t\t\treturn tokenizeToString(languageService, code, languageId);\n\t\t\t}\n\t\t}),\n\t\tmarkedGfmHeadingIdPlugin(),\n\t\t...(options?.markedExtensions ?? []),\n\t);\n\n\tconst raw = await raceCancellationError(m.parse(text, { async: true }), token ?? CancellationToken.None);\n\treturn sanitize(raw, options?.sanitizerConfig);\n}\n\nnamespace MarkedHighlight {\n\t// Copied from https://github.com/markedjs/marked-highlight/blob/main/src/index.js\n\n\texport function markedHighlight(options: marked.MarkedOptions & { highlight: (code: string, lang: string) => string | Promise<string> }): marked.MarkedExtension {\n\t\tif (typeof options === 'function') {\n\t\t\toptions = {\n\t\t\t\thighlight: options,\n\t\t\t};\n\t\t}\n\n\t\tif (!options || typeof options.highlight !== 'function') {\n\t\t\tthrow new Error('Must provide highlight function');\n\t\t}\n\n\t\treturn {\n\t\t\tasync: !!options.async,\n\t\t\twalkTokens(token: marked.Token): Promise<void> | void {\n\t\t\t\tif (token.type !== 'code') {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (options.async) {\n\t\t\t\t\treturn Promise.resolve(options.highlight(token.text, token.lang)).then(updateToken(token));\n\t\t\t\t}\n\n\t\t\t\tconst code = options.highlight(token.text, token.lang);\n\t\t\t\tif (code instanceof Promise) {\n\t\t\t\t\tthrow new Error('markedHighlight is not set to async but the highlight function is async. Set the async option to true on markedHighlight to await the async highlight function.');\n\t\t\t\t}\n\t\t\t\tupdateToken(token)(code);\n\t\t\t},\n\t\t\trenderer: {\n\t\t\t\tcode({ text, lang, escaped }: marked.Tokens.Code) {\n\t\t\t\t\tconst classAttr = lang\n\t\t\t\t\t\t? ` class=\"language-${escape(lang)}\"`\n\t\t\t\t\t\t: '';\n\t\t\t\t\ttext = text.replace(/\\n$/, '');\n\t\t\t\t\treturn `<pre><code${classAttr}>${escaped ? text : escape(text, true)}\\n</code></pre>`;\n\t\t\t\t},\n\t\t\t},\n\t\t};\n\t}\n\n\tfunction updateToken(token: any) {\n\t\treturn (code: string) => {\n\t\t\tif (typeof code === 'string' && code !== token.text) {\n\t\t\t\ttoken.escaped = true;\n\t\t\t\ttoken.text = code;\n\t\t\t}\n\t\t};\n\t}\n\n\t// copied from marked helpers\n\tconst escapeTest = /[&<>\"']/;\n\tconst escapeReplace = new RegExp(escapeTest.source, 'g');\n\tconst escapeTestNoEncode = /[<>\"']|&(?!(#\\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\\w+);)/;\n\tconst escapeReplaceNoEncode = new RegExp(escapeTestNoEncode.source, 'g');\n\tconst escapeReplacement: Record<string, string> = {\n\t\t'&': '&amp;',\n\t\t'<': '&lt;',\n\t\t'>': '&gt;',\n\t\t'\"': '&quot;',\n\t\t[`'`]: '&#39;',\n\t};\n\tconst getEscapeReplacement = (ch: string) => escapeReplacement[ch];\n\tfunction escape(html: string, encode?: boolean) {\n\t\tif (encode) {\n\t\t\tif (escapeTest.test(html)) {\n\t\t\t\treturn html.replace(escapeReplace, getEscapeReplacement);\n\t\t\t}\n\t\t} else {\n\t\t\tif (escapeTestNoEncode.test(html)) {\n\t\t\t\treturn html.replace(escapeReplaceNoEncode, getEscapeReplacement);\n\t\t\t}\n\t\t}\n\n\t\treturn html;\n\t}\n}\n"]}