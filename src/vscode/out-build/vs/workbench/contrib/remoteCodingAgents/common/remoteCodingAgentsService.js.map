{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/contrib/remoteCodingAgents/common/remoteCodingAgentsService.ts","vs/workbench/contrib/remoteCodingAgents/common/remoteCodingAgentsService.ts"],"names":[],"mappings":"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","file":"remoteCodingAgentsService.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Disposable } from '../../../../base/common/lifecycle.js';\nimport { Event } from '../../../../base/common/event.js';\nimport { ContextKeyExpr, IContextKey, IContextKeyService } from '../../../../platform/contextkey/common/contextkey.js';\nimport { InstantiationType, registerSingleton } from '../../../../platform/instantiation/common/extensions.js';\nimport { createDecorator } from '../../../../platform/instantiation/common/instantiation.js';\nimport { ChatContextKeys } from '../../chat/common/chatContextKeys.js';\n\nexport interface IRemoteCodingAgent {\n\tid: string;\n\tcommand: string;\n\tdisplayName: string;\n\tdescription?: string;\n\tfollowUpRegex?: string;\n\twhen?: string;\n}\n\nexport interface IRemoteCodingAgentsService {\n\treadonly _serviceBrand: undefined;\n\tgetRegisteredAgents(): IRemoteCodingAgent[];\n\tgetAvailableAgents(): IRemoteCodingAgent[];\n\tregisterAgent(agent: IRemoteCodingAgent): void;\n}\n\nexport const IRemoteCodingAgentsService = createDecorator<IRemoteCodingAgentsService>('remoteCodingAgentsService');\n\nexport class RemoteCodingAgentsService extends Disposable implements IRemoteCodingAgentsService {\n\treadonly _serviceBrand: undefined;\n\tprivate readonly _ctxHasRemoteCodingAgent: IContextKey<boolean>;\n\tprivate readonly agents: IRemoteCodingAgent[] = [];\n\tprivate readonly contextKeys = new Set<string>();\n\n\tconstructor(\n\t\t@IContextKeyService private readonly contextKeyService: IContextKeyService\n\t) {\n\t\tsuper();\n\t\tthis._ctxHasRemoteCodingAgent = ChatContextKeys.hasRemoteCodingAgent.bindTo(this.contextKeyService);\n\n\t\t// Listen for context changes and re-evaluate agent availability\n\t\tthis._register(Event.filter(contextKeyService.onDidChangeContext, e => e.affectsSome(this.contextKeys))(() => {\n\t\t\tthis.updateContextKeys();\n\t\t}));\n\t}\n\n\tgetRegisteredAgents(): IRemoteCodingAgent[] {\n\t\treturn [...this.agents];\n\t}\n\n\tgetAvailableAgents(): IRemoteCodingAgent[] {\n\t\treturn this.agents.filter(agent => this.isAgentAvailable(agent));\n\t}\n\n\tregisterAgent(agent: IRemoteCodingAgent): void {\n\t\t// Check if agent already exists\n\t\tconst existingIndex = this.agents.findIndex(a => a.id === agent.id);\n\t\tif (existingIndex >= 0) {\n\t\t\t// Update existing agent\n\t\t\tthis.agents[existingIndex] = agent;\n\t\t} else {\n\t\t\t// Add new agent\n\t\t\tthis.agents.push(agent);\n\t\t}\n\n\t\t// Track context keys from the when condition\n\t\tif (agent.when) {\n\t\t\tconst whenExpr = ContextKeyExpr.deserialize(agent.when);\n\t\t\tif (whenExpr) {\n\t\t\t\tfor (const key of whenExpr.keys()) {\n\t\t\t\t\tthis.contextKeys.add(key);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tthis.updateContextKeys();\n\t}\n\n\tprivate isAgentAvailable(agent: IRemoteCodingAgent): boolean {\n\t\tif (!agent.when) {\n\t\t\treturn true;\n\t\t}\n\n\t\tconst whenExpr = ContextKeyExpr.deserialize(agent.when);\n\t\treturn !whenExpr || this.contextKeyService.contextMatchesRules(whenExpr);\n\t}\n\n\tprivate updateContextKeys(): void {\n\t\tconst hasAvailableAgent = this.getAvailableAgents().length > 0;\n\t\tthis._ctxHasRemoteCodingAgent.set(hasAvailableAgent);\n\t}\n}\n\nregisterSingleton(IRemoteCodingAgentsService, RemoteCodingAgentsService, InstantiationType.Delayed);\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Disposable } from '../../../../base/common/lifecycle.js';\nimport { Event } from '../../../../base/common/event.js';\nimport { ContextKeyExpr, IContextKey, IContextKeyService } from '../../../../platform/contextkey/common/contextkey.js';\nimport { InstantiationType, registerSingleton } from '../../../../platform/instantiation/common/extensions.js';\nimport { createDecorator } from '../../../../platform/instantiation/common/instantiation.js';\nimport { ChatContextKeys } from '../../chat/common/chatContextKeys.js';\n\nexport interface IRemoteCodingAgent {\n\tid: string;\n\tcommand: string;\n\tdisplayName: string;\n\tdescription?: string;\n\tfollowUpRegex?: string;\n\twhen?: string;\n}\n\nexport interface IRemoteCodingAgentsService {\n\treadonly _serviceBrand: undefined;\n\tgetRegisteredAgents(): IRemoteCodingAgent[];\n\tgetAvailableAgents(): IRemoteCodingAgent[];\n\tregisterAgent(agent: IRemoteCodingAgent): void;\n}\n\nexport const IRemoteCodingAgentsService = createDecorator<IRemoteCodingAgentsService>('remoteCodingAgentsService');\n\nexport class RemoteCodingAgentsService extends Disposable implements IRemoteCodingAgentsService {\n\treadonly _serviceBrand: undefined;\n\tprivate readonly _ctxHasRemoteCodingAgent: IContextKey<boolean>;\n\tprivate readonly agents: IRemoteCodingAgent[] = [];\n\tprivate readonly contextKeys = new Set<string>();\n\n\tconstructor(\n\t\t@IContextKeyService private readonly contextKeyService: IContextKeyService\n\t) {\n\t\tsuper();\n\t\tthis._ctxHasRemoteCodingAgent = ChatContextKeys.hasRemoteCodingAgent.bindTo(this.contextKeyService);\n\n\t\t// Listen for context changes and re-evaluate agent availability\n\t\tthis._register(Event.filter(contextKeyService.onDidChangeContext, e => e.affectsSome(this.contextKeys))(() => {\n\t\t\tthis.updateContextKeys();\n\t\t}));\n\t}\n\n\tgetRegisteredAgents(): IRemoteCodingAgent[] {\n\t\treturn [...this.agents];\n\t}\n\n\tgetAvailableAgents(): IRemoteCodingAgent[] {\n\t\treturn this.agents.filter(agent => this.isAgentAvailable(agent));\n\t}\n\n\tregisterAgent(agent: IRemoteCodingAgent): void {\n\t\t// Check if agent already exists\n\t\tconst existingIndex = this.agents.findIndex(a => a.id === agent.id);\n\t\tif (existingIndex >= 0) {\n\t\t\t// Update existing agent\n\t\t\tthis.agents[existingIndex] = agent;\n\t\t} else {\n\t\t\t// Add new agent\n\t\t\tthis.agents.push(agent);\n\t\t}\n\n\t\t// Track context keys from the when condition\n\t\tif (agent.when) {\n\t\t\tconst whenExpr = ContextKeyExpr.deserialize(agent.when);\n\t\t\tif (whenExpr) {\n\t\t\t\tfor (const key of whenExpr.keys()) {\n\t\t\t\t\tthis.contextKeys.add(key);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tthis.updateContextKeys();\n\t}\n\n\tprivate isAgentAvailable(agent: IRemoteCodingAgent): boolean {\n\t\tif (!agent.when) {\n\t\t\treturn true;\n\t\t}\n\n\t\tconst whenExpr = ContextKeyExpr.deserialize(agent.when);\n\t\treturn !whenExpr || this.contextKeyService.contextMatchesRules(whenExpr);\n\t}\n\n\tprivate updateContextKeys(): void {\n\t\tconst hasAvailableAgent = this.getAvailableAgents().length > 0;\n\t\tthis._ctxHasRemoteCodingAgent.set(hasAvailableAgent);\n\t}\n}\n\nregisterSingleton(IRemoteCodingAgentsService, RemoteCodingAgentsService, InstantiationType.Delayed);\n"]}