{"version":3,"sources":["vs/workbench/contrib/localHistory/browser/localHistoryTimeline.ts"],"names":[],"mappings":"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","file":"localHistoryTimeline.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { localize } from '../../../../nls.js';\nimport { Emitter } from '../../../../base/common/event.js';\nimport { CancellationToken } from '../../../../base/common/cancellation.js';\nimport { Disposable, MutableDisposable } from '../../../../base/common/lifecycle.js';\nimport { IWorkbenchContribution } from '../../../common/contributions.js';\nimport { ITimelineService, Timeline, TimelineChangeEvent, TimelineItem, TimelineOptions, TimelineProvider } from '../../timeline/common/timeline.js';\nimport { IWorkingCopyHistoryEntry, IWorkingCopyHistoryService } from '../../../services/workingCopy/common/workingCopyHistory.js';\nimport { URI } from '../../../../base/common/uri.js';\nimport { IPathService } from '../../../services/path/common/pathService.js';\nimport { API_OPEN_DIFF_EDITOR_COMMAND_ID } from '../../../browser/parts/editor/editorCommands.js';\nimport { IFileService } from '../../../../platform/files/common/files.js';\nimport { LocalHistoryFileSystemProvider } from './localHistoryFileSystemProvider.js';\nimport { IWorkbenchEnvironmentService } from '../../../services/environment/common/environmentService.js';\nimport { SaveSourceRegistry } from '../../../common/editor.js';\nimport { IConfigurationService } from '../../../../platform/configuration/common/configuration.js';\nimport { COMPARE_WITH_FILE_LABEL, toDiffEditorArguments } from './localHistoryCommands.js';\nimport { MarkdownString } from '../../../../base/common/htmlContent.js';\nimport { getLocalHistoryDateFormatter, LOCAL_HISTORY_ICON_ENTRY, LOCAL_HISTORY_MENU_CONTEXT_VALUE } from './localHistory.js';\nimport { Schemas } from '../../../../base/common/network.js';\nimport { IWorkspaceContextService } from '../../../../platform/workspace/common/workspace.js';\nimport { getVirtualWorkspaceAuthority } from '../../../../platform/workspace/common/virtualWorkspace.js';\n\nexport class LocalHistoryTimeline extends Disposable implements IWorkbenchContribution, TimelineProvider {\n\n\tstatic readonly ID = 'workbench.contrib.localHistoryTimeline';\n\n\tprivate static readonly LOCAL_HISTORY_ENABLED_SETTINGS_KEY = 'workbench.localHistory.enabled';\n\n\treadonly id = 'timeline.localHistory';\n\n\treadonly label = localize('localHistory', \"Local History\");\n\n\treadonly scheme = '*'; // we try to show local history for all schemes if possible\n\n\tprivate readonly _onDidChange = this._register(new Emitter<TimelineChangeEvent>());\n\treadonly onDidChange = this._onDidChange.event;\n\n\tprivate readonly timelineProviderDisposable = this._register(new MutableDisposable());\n\n\tconstructor(\n\t\t@ITimelineService private readonly timelineService: ITimelineService,\n\t\t@IWorkingCopyHistoryService private readonly workingCopyHistoryService: IWorkingCopyHistoryService,\n\t\t@IPathService private readonly pathService: IPathService,\n\t\t@IFileService private readonly fileService: IFileService,\n\t\t@IWorkbenchEnvironmentService private readonly environmentService: IWorkbenchEnvironmentService,\n\t\t@IConfigurationService private readonly configurationService: IConfigurationService,\n\t\t@IWorkspaceContextService private readonly contextService: IWorkspaceContextService\n\t) {\n\t\tsuper();\n\n\t\tthis.registerComponents();\n\t\tthis.registerListeners();\n\t}\n\n\tprivate registerComponents(): void {\n\n\t\t// Timeline (if enabled)\n\t\tthis.updateTimelineRegistration();\n\n\t\t// File Service Provider\n\t\tthis._register(this.fileService.registerProvider(LocalHistoryFileSystemProvider.SCHEMA, new LocalHistoryFileSystemProvider(this.fileService)));\n\t}\n\n\tprivate updateTimelineRegistration(): void {\n\t\tif (this.configurationService.getValue<boolean>(LocalHistoryTimeline.LOCAL_HISTORY_ENABLED_SETTINGS_KEY)) {\n\t\t\tthis.timelineProviderDisposable.value = this.timelineService.registerTimelineProvider(this);\n\t\t} else {\n\t\t\tthis.timelineProviderDisposable.clear();\n\t\t}\n\t}\n\n\tprivate registerListeners(): void {\n\n\t\t// History changes\n\t\tthis._register(this.workingCopyHistoryService.onDidAddEntry(e => this.onDidChangeWorkingCopyHistoryEntry(e.entry)));\n\t\tthis._register(this.workingCopyHistoryService.onDidChangeEntry(e => this.onDidChangeWorkingCopyHistoryEntry(e.entry)));\n\t\tthis._register(this.workingCopyHistoryService.onDidReplaceEntry(e => this.onDidChangeWorkingCopyHistoryEntry(e.entry)));\n\t\tthis._register(this.workingCopyHistoryService.onDidRemoveEntry(e => this.onDidChangeWorkingCopyHistoryEntry(e.entry)));\n\t\tthis._register(this.workingCopyHistoryService.onDidRemoveEntries(() => this.onDidChangeWorkingCopyHistoryEntry(undefined /* all entries */)));\n\t\tthis._register(this.workingCopyHistoryService.onDidMoveEntries(() => this.onDidChangeWorkingCopyHistoryEntry(undefined /* all entries */)));\n\n\t\t// Configuration changes\n\t\tthis._register(this.configurationService.onDidChangeConfiguration(e => {\n\t\t\tif (e.affectsConfiguration(LocalHistoryTimeline.LOCAL_HISTORY_ENABLED_SETTINGS_KEY)) {\n\t\t\t\tthis.updateTimelineRegistration();\n\t\t\t}\n\t\t}));\n\t}\n\n\tprivate onDidChangeWorkingCopyHistoryEntry(entry: IWorkingCopyHistoryEntry | undefined): void {\n\n\t\t// Re-emit as timeline change event\n\t\tthis._onDidChange.fire({\n\t\t\tid: this.id,\n\t\t\turi: entry?.workingCopy.resource,\n\t\t\treset: true // there is no other way to indicate that items might have been replaced/removed\n\t\t});\n\t}\n\n\tasync provideTimeline(uri: URI, options: TimelineOptions, token: CancellationToken): Promise<Timeline> {\n\t\tconst items: TimelineItem[] = [];\n\n\t\t// Try to convert the provided `uri` into a form that is likely\n\t\t// for the provider to find entries for so that we can ensure\n\t\t// the timeline is always providing local history entries\n\n\t\tlet resource: URI | undefined = undefined;\n\t\tif (uri.scheme === LocalHistoryFileSystemProvider.SCHEMA) {\n\t\t\t// `vscode-local-history`: convert back to the associated resource\n\t\t\tresource = LocalHistoryFileSystemProvider.fromLocalHistoryFileSystem(uri).associatedResource;\n\t\t} else if (uri.scheme === this.pathService.defaultUriScheme || uri.scheme === Schemas.vscodeUserData) {\n\t\t\t// default-scheme / settings: keep as is\n\t\t\tresource = uri;\n\t\t} else if (this.fileService.hasProvider(uri)) {\n\t\t\t// anything that is backed by a file system provider:\n\t\t\t// try best to convert the URI back into a form that is\n\t\t\t// likely to match the workspace URIs. That means:\n\t\t\t// - change to the default URI scheme\n\t\t\t// - change to the remote authority or virtual workspace authority\n\t\t\t// - preserve the path\n\t\t\tresource = URI.from({\n\t\t\t\tscheme: this.pathService.defaultUriScheme,\n\t\t\t\tauthority: this.environmentService.remoteAuthority ?? getVirtualWorkspaceAuthority(this.contextService.getWorkspace()),\n\t\t\t\tpath: uri.path\n\t\t\t});\n\t\t}\n\n\t\tif (resource) {\n\n\t\t\t// Retrieve from working copy history\n\t\t\tconst entries = await this.workingCopyHistoryService.getEntries(resource, token);\n\n\t\t\t// Convert to timeline items\n\t\t\tfor (const entry of entries) {\n\t\t\t\titems.push(this.toTimelineItem(entry));\n\t\t\t}\n\t\t}\n\n\t\treturn {\n\t\t\tsource: this.id,\n\t\t\titems\n\t\t};\n\t}\n\n\tprivate toTimelineItem(entry: IWorkingCopyHistoryEntry): TimelineItem {\n\t\treturn {\n\t\t\thandle: entry.id,\n\t\t\tlabel: SaveSourceRegistry.getSourceLabel(entry.source),\n\t\t\ttooltip: new MarkdownString(`$(history) ${getLocalHistoryDateFormatter().format(entry.timestamp)}\\n\\n${SaveSourceRegistry.getSourceLabel(entry.source)}${entry.sourceDescription ? ` (${entry.sourceDescription})` : ``}`, { supportThemeIcons: true }),\n\t\t\tsource: this.id,\n\t\t\ttimestamp: entry.timestamp,\n\t\t\tthemeIcon: LOCAL_HISTORY_ICON_ENTRY,\n\t\t\tcontextValue: LOCAL_HISTORY_MENU_CONTEXT_VALUE,\n\t\t\tcommand: {\n\t\t\t\tid: API_OPEN_DIFF_EDITOR_COMMAND_ID,\n\t\t\t\ttitle: COMPARE_WITH_FILE_LABEL.value,\n\t\t\t\targuments: toDiffEditorArguments(entry, entry.workingCopy.resource)\n\t\t\t}\n\t\t};\n\t}\n}\n"]}