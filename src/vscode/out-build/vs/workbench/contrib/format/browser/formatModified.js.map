{"version":3,"sources":["vs/workbench/contrib/format/browser/formatModified.ts"],"names":[],"mappings":"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","file":"formatModified.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { isNonEmptyArray } from '../../../../base/common/arrays.js';\nimport { CancellationToken } from '../../../../base/common/cancellation.js';\nimport { ICodeEditor } from '../../../../editor/browser/editorBrowser.js';\nimport { EditorAction, registerEditorAction, ServicesAccessor } from '../../../../editor/browser/editorExtensions.js';\nimport { Range } from '../../../../editor/common/core/range.js';\nimport { EditorContextKeys } from '../../../../editor/common/editorContextKeys.js';\nimport { ITextModel, shouldSynchronizeModel } from '../../../../editor/common/model.js';\nimport { IEditorWorkerService } from '../../../../editor/common/services/editorWorker.js';\nimport { ITextModelService } from '../../../../editor/common/services/resolverService.js';\nimport { formatDocumentRangesWithSelectedProvider, FormattingMode } from '../../../../editor/contrib/format/browser/format.js';\nimport * as nls from '../../../../nls.js';\nimport { ContextKeyExpr } from '../../../../platform/contextkey/common/contextkey.js';\nimport { IInstantiationService } from '../../../../platform/instantiation/common/instantiation.js';\nimport { Progress } from '../../../../platform/progress/common/progress.js';\nimport { IQuickDiffService } from '../../scm/common/quickDiff.js';\nimport { getOriginalResource } from '../../scm/common/quickDiffService.js';\n\nregisterEditorAction(class FormatModifiedAction extends EditorAction {\n\n\tconstructor() {\n\t\tsuper({\n\t\t\tid: 'editor.action.formatChanges',\n\t\t\tlabel: nls.localize2('formatChanges', \"Format Modified Lines\"),\n\t\t\tprecondition: ContextKeyExpr.and(EditorContextKeys.writable, EditorContextKeys.hasDocumentSelectionFormattingProvider),\n\t\t});\n\t}\n\n\tasync run(accessor: ServicesAccessor, editor: ICodeEditor): Promise<void> {\n\t\tconst instaService = accessor.get(IInstantiationService);\n\n\t\tif (!editor.hasModel()) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst ranges = await instaService.invokeFunction(getModifiedRanges, editor.getModel());\n\t\tif (isNonEmptyArray(ranges)) {\n\t\t\treturn instaService.invokeFunction(\n\t\t\t\tformatDocumentRangesWithSelectedProvider, editor, ranges,\n\t\t\t\tFormattingMode.Explicit, Progress.None, CancellationToken.None,\n\t\t\t\ttrue\n\t\t\t);\n\t\t}\n\t}\n});\n\nexport async function getModifiedRanges(accessor: ServicesAccessor, modified: ITextModel): Promise<Range[] | undefined | null> {\n\tconst quickDiffService = accessor.get(IQuickDiffService);\n\tconst workerService = accessor.get(IEditorWorkerService);\n\tconst modelService = accessor.get(ITextModelService);\n\n\tconst original = await getOriginalResource(quickDiffService, modified.uri, modified.getLanguageId(), shouldSynchronizeModel(modified));\n\tif (!original) {\n\t\treturn null; // let undefined signify no changes, null represents no source control (there's probably a better way, but I can't think of one rn)\n\t}\n\n\tconst ranges: Range[] = [];\n\tconst ref = await modelService.createModelReference(original);\n\ttry {\n\t\tif (!workerService.canComputeDirtyDiff(original, modified.uri)) {\n\t\t\treturn undefined;\n\t\t}\n\t\tconst changes = await workerService.computeDirtyDiff(original, modified.uri, false);\n\t\tif (!isNonEmptyArray(changes)) {\n\t\t\treturn undefined;\n\t\t}\n\t\tfor (const change of changes) {\n\t\t\tranges.push(modified.validateRange(new Range(\n\t\t\t\tchange.modifiedStartLineNumber, 1,\n\t\t\t\tchange.modifiedEndLineNumber || change.modifiedStartLineNumber /*endLineNumber is 0 when things got deleted*/, Number.MAX_SAFE_INTEGER)\n\t\t\t));\n\t\t}\n\t} finally {\n\t\tref.dispose();\n\t}\n\n\treturn ranges;\n}\n"]}