{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/contrib/emergencyAlert/electron-browser/emergencyAlert.contribution.ts","vs/workbench/contrib/emergencyAlert/electron-browser/emergencyAlert.contribution.ts"],"names":[],"mappings":"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","file":"emergencyAlert.contribution.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { IWorkbenchContribution, registerWorkbenchContribution2, WorkbenchPhase } from '../../../common/contributions.js';\nimport { IBannerService } from '../../../services/banner/browser/bannerService.js';\nimport { asJson, IRequestService } from '../../../../platform/request/common/request.js';\nimport { IProductService } from '../../../../platform/product/common/productService.js';\nimport { CancellationToken } from '../../../../base/common/cancellation.js';\nimport { ILogService } from '../../../../platform/log/common/log.js';\nimport { Codicon } from '../../../../base/common/codicons.js';\nimport { arch, platform } from '../../../../base/common/process.js';\n\ninterface IEmergencyAlert {\n\treadonly commit: string;\n\treadonly platform?: string;\n\treadonly arch?: string;\n\treadonly message: string;\n\treadonly actions?: [{\n\t\treadonly label: string;\n\t\treadonly href: string;\n\t}];\n}\n\ninterface IEmergencyAlerts {\n\treadonly alerts: IEmergencyAlert[];\n}\n\nexport class EmergencyAlert implements IWorkbenchContribution {\n\n\tstatic readonly ID = 'workbench.contrib.emergencyAlert';\n\n\tconstructor(\n\t\t@IBannerService private readonly bannerService: IBannerService,\n\t\t@IRequestService private readonly requestService: IRequestService,\n\t\t@IProductService private readonly productService: IProductService,\n\t\t@ILogService private readonly logService: ILogService\n\t) {\n\t\tif (productService.quality !== 'insider') {\n\t\t\treturn; // only enabled in insiders for now\n\t\t}\n\n\t\tconst emergencyAlertUrl = productService.emergencyAlertUrl;\n\t\tif (!emergencyAlertUrl) {\n\t\t\treturn; // no emergency alert configured\n\t\t}\n\n\t\tthis.fetchAlerts(emergencyAlertUrl);\n\t}\n\n\tprivate async fetchAlerts(url: string): Promise<void> {\n\t\ttry {\n\t\t\tawait this.doFetchAlerts(url);\n\t\t} catch (e) {\n\t\t\tthis.logService.error(e);\n\t\t}\n\t}\n\n\tprivate async doFetchAlerts(url: string): Promise<void> {\n\t\tconst requestResult = await this.requestService.request({ type: 'GET', url, disableCache: true }, CancellationToken.None);\n\n\t\tif (requestResult.res.statusCode !== 200) {\n\t\t\tthrow new Error(`Failed to fetch emergency alerts: HTTP ${requestResult.res.statusCode}`);\n\t\t}\n\n\t\tconst emergencyAlerts = await asJson<IEmergencyAlerts>(requestResult);\n\t\tif (!emergencyAlerts) {\n\t\t\treturn;\n\t\t}\n\n\t\tfor (const emergencyAlert of emergencyAlerts.alerts) {\n\t\t\tif (\n\t\t\t\t(emergencyAlert.commit !== this.productService.commit) ||\t\t\t\t// version mismatch\n\t\t\t\t(emergencyAlert.platform && emergencyAlert.platform !== platform) ||\t// platform mismatch\n\t\t\t\t(emergencyAlert.arch && emergencyAlert.arch !== arch)\t\t\t\t\t// arch mismatch\n\t\t\t) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.bannerService.show({\n\t\t\t\tid: 'emergencyAlert.banner',\n\t\t\t\ticon: Codicon.warning,\n\t\t\t\tmessage: emergencyAlert.message,\n\t\t\t\tactions: emergencyAlert.actions\n\t\t\t});\n\n\t\t\tbreak;\n\t\t}\n\t}\n}\n\nregisterWorkbenchContribution2('workbench.emergencyAlert', EmergencyAlert, WorkbenchPhase.Eventually);\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { IWorkbenchContribution, registerWorkbenchContribution2, WorkbenchPhase } from '../../../common/contributions.js';\nimport { IBannerService } from '../../../services/banner/browser/bannerService.js';\nimport { asJson, IRequestService } from '../../../../platform/request/common/request.js';\nimport { IProductService } from '../../../../platform/product/common/productService.js';\nimport { CancellationToken } from '../../../../base/common/cancellation.js';\nimport { ILogService } from '../../../../platform/log/common/log.js';\nimport { Codicon } from '../../../../base/common/codicons.js';\nimport { arch, platform } from '../../../../base/common/process.js';\n\ninterface IEmergencyAlert {\n\treadonly commit: string;\n\treadonly platform?: string;\n\treadonly arch?: string;\n\treadonly message: string;\n\treadonly actions?: [{\n\t\treadonly label: string;\n\t\treadonly href: string;\n\t}];\n}\n\ninterface IEmergencyAlerts {\n\treadonly alerts: IEmergencyAlert[];\n}\n\nexport class EmergencyAlert implements IWorkbenchContribution {\n\n\tstatic readonly ID = 'workbench.contrib.emergencyAlert';\n\n\tconstructor(\n\t\t@IBannerService private readonly bannerService: IBannerService,\n\t\t@IRequestService private readonly requestService: IRequestService,\n\t\t@IProductService private readonly productService: IProductService,\n\t\t@ILogService private readonly logService: ILogService\n\t) {\n\t\tif (productService.quality !== 'insider') {\n\t\t\treturn; // only enabled in insiders for now\n\t\t}\n\n\t\tconst emergencyAlertUrl = productService.emergencyAlertUrl;\n\t\tif (!emergencyAlertUrl) {\n\t\t\treturn; // no emergency alert configured\n\t\t}\n\n\t\tthis.fetchAlerts(emergencyAlertUrl);\n\t}\n\n\tprivate async fetchAlerts(url: string): Promise<void> {\n\t\ttry {\n\t\t\tawait this.doFetchAlerts(url);\n\t\t} catch (e) {\n\t\t\tthis.logService.error(e);\n\t\t}\n\t}\n\n\tprivate async doFetchAlerts(url: string): Promise<void> {\n\t\tconst requestResult = await this.requestService.request({ type: 'GET', url, disableCache: true }, CancellationToken.None);\n\n\t\tif (requestResult.res.statusCode !== 200) {\n\t\t\tthrow new Error(`Failed to fetch emergency alerts: HTTP ${requestResult.res.statusCode}`);\n\t\t}\n\n\t\tconst emergencyAlerts = await asJson<IEmergencyAlerts>(requestResult);\n\t\tif (!emergencyAlerts) {\n\t\t\treturn;\n\t\t}\n\n\t\tfor (const emergencyAlert of emergencyAlerts.alerts) {\n\t\t\tif (\n\t\t\t\t(emergencyAlert.commit !== this.productService.commit) ||\t\t\t\t// version mismatch\n\t\t\t\t(emergencyAlert.platform && emergencyAlert.platform !== platform) ||\t// platform mismatch\n\t\t\t\t(emergencyAlert.arch && emergencyAlert.arch !== arch)\t\t\t\t\t// arch mismatch\n\t\t\t) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.bannerService.show({\n\t\t\t\tid: 'emergencyAlert.banner',\n\t\t\t\ticon: Codicon.warning,\n\t\t\t\tmessage: emergencyAlert.message,\n\t\t\t\tactions: emergencyAlert.actions\n\t\t\t});\n\n\t\t\tbreak;\n\t\t}\n\t}\n}\n\nregisterWorkbenchContribution2('workbench.emergencyAlert', EmergencyAlert, WorkbenchPhase.Eventually);\n"]}