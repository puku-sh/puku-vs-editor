{"version":3,"sources":["vs/workbench/contrib/remote/browser/tunnelFactory.ts"],"names":[],"mappings":"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","file":"tunnelFactory.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as nls from '../../../../nls.js';\nimport { ITunnelService, TunnelOptions, RemoteTunnel, TunnelCreationOptions, ITunnel, TunnelProtocol, TunnelPrivacyId } from '../../../../platform/tunnel/common/tunnel.js';\nimport { Disposable } from '../../../../base/common/lifecycle.js';\nimport { IWorkbenchContribution } from '../../../common/contributions.js';\nimport { IBrowserWorkbenchEnvironmentService } from '../../../services/environment/browser/environmentService.js';\nimport { IOpenerService } from '../../../../platform/opener/common/opener.js';\nimport { URI } from '../../../../base/common/uri.js';\nimport { IRemoteExplorerService } from '../../../services/remote/common/remoteExplorerService.js';\nimport { ILogService } from '../../../../platform/log/common/log.js';\nimport { IContextKeyService } from '../../../../platform/contextkey/common/contextkey.js';\nimport { forwardedPortsFeaturesEnabled } from '../../../services/remote/common/tunnelModel.js';\n\nexport class TunnelFactoryContribution extends Disposable implements IWorkbenchContribution {\n\n\tstatic readonly ID = 'workbench.contrib.tunnelFactory';\n\n\tconstructor(\n\t\t@ITunnelService tunnelService: ITunnelService,\n\t\t@IBrowserWorkbenchEnvironmentService environmentService: IBrowserWorkbenchEnvironmentService,\n\t\t@IOpenerService private openerService: IOpenerService,\n\t\t@IRemoteExplorerService remoteExplorerService: IRemoteExplorerService,\n\t\t@ILogService logService: ILogService,\n\t\t@IContextKeyService contextKeyService: IContextKeyService\n\t) {\n\t\tsuper();\n\t\tconst tunnelFactory = environmentService.options?.tunnelProvider?.tunnelFactory;\n\t\tif (tunnelFactory) {\n\t\t\t// At this point we clearly want the ports view/features since we have a tunnel factory\n\t\t\tcontextKeyService.createKey(forwardedPortsFeaturesEnabled.key, true);\n\t\t\tlet privacyOptions = environmentService.options?.tunnelProvider?.features?.privacyOptions ?? [];\n\t\t\tif (environmentService.options?.tunnelProvider?.features?.public\n\t\t\t\t&& (privacyOptions.length === 0)) {\n\t\t\t\tprivacyOptions = [\n\t\t\t\t\t{\n\t\t\t\t\t\tid: 'private',\n\t\t\t\t\t\tlabel: nls.localize('tunnelPrivacy.private', \"Private\"),\n\t\t\t\t\t\tthemeIcon: 'lock'\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tid: 'public',\n\t\t\t\t\t\tlabel: nls.localize('tunnelPrivacy.public', \"Public\"),\n\t\t\t\t\t\tthemeIcon: 'eye'\n\t\t\t\t\t}\n\t\t\t\t];\n\t\t\t}\n\n\t\t\tthis._register(tunnelService.setTunnelProvider({\n\t\t\t\tforwardPort: async (tunnelOptions: TunnelOptions, tunnelCreationOptions: TunnelCreationOptions): Promise<RemoteTunnel | string | undefined> => {\n\t\t\t\t\tlet tunnelPromise: Promise<ITunnel> | undefined;\n\t\t\t\t\ttry {\n\t\t\t\t\t\ttunnelPromise = tunnelFactory(tunnelOptions, tunnelCreationOptions);\n\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\tlogService.trace('tunnelFactory: tunnel provider error');\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!tunnelPromise) {\n\t\t\t\t\t\treturn undefined;\n\t\t\t\t\t}\n\t\t\t\t\tlet tunnel: ITunnel;\n\t\t\t\t\ttry {\n\t\t\t\t\t\ttunnel = await tunnelPromise;\n\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\tlogService.trace('tunnelFactory: tunnel provider promise error');\n\t\t\t\t\t\tif (e instanceof Error) {\n\t\t\t\t\t\t\treturn e.message;\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn undefined;\n\t\t\t\t\t}\n\t\t\t\t\tconst localAddress = tunnel.localAddress.startsWith('http') ? tunnel.localAddress : `http://${tunnel.localAddress}`;\n\t\t\t\t\tconst remoteTunnel: RemoteTunnel = {\n\t\t\t\t\t\ttunnelRemotePort: tunnel.remoteAddress.port,\n\t\t\t\t\t\ttunnelRemoteHost: tunnel.remoteAddress.host,\n\t\t\t\t\t\t// The tunnel factory may give us an inaccessible local address.\n\t\t\t\t\t\t// To make sure this doesn't happen, resolve the uri immediately.\n\t\t\t\t\t\tlocalAddress: await this.resolveExternalUri(localAddress),\n\t\t\t\t\t\tprivacy: tunnel.privacy ?? (tunnel.public ? TunnelPrivacyId.Public : TunnelPrivacyId.Private),\n\t\t\t\t\t\tprotocol: tunnel.protocol ?? TunnelProtocol.Http,\n\t\t\t\t\t\tdispose: async () => { await tunnel.dispose(); }\n\t\t\t\t\t};\n\t\t\t\t\treturn remoteTunnel;\n\t\t\t\t}\n\t\t\t}));\n\t\t\tconst tunnelInformation = environmentService.options?.tunnelProvider?.features ?\n\t\t\t\t{\n\t\t\t\t\tfeatures: {\n\t\t\t\t\t\televation: !!environmentService.options?.tunnelProvider?.features?.elevation,\n\t\t\t\t\t\tpublic: !!environmentService.options?.tunnelProvider?.features?.public,\n\t\t\t\t\t\tprivacyOptions,\n\t\t\t\t\t\tprotocol: environmentService.options?.tunnelProvider?.features?.protocol === undefined ? true : !!environmentService.options?.tunnelProvider?.features?.protocol\n\t\t\t\t\t}\n\t\t\t\t} : undefined;\n\t\t\tremoteExplorerService.setTunnelInformation(tunnelInformation);\n\t\t}\n\t}\n\n\tprivate async resolveExternalUri(uri: string): Promise<string> {\n\t\ttry {\n\t\t\treturn (await this.openerService.resolveExternalUri(URI.parse(uri))).resolved.toString();\n\t\t} catch {\n\t\t\treturn uri;\n\t\t}\n\t}\n}\n"]}