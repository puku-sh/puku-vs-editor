{"version":3,"sources":["vs/workbench/contrib/share/browser/shareService.ts"],"names":[],"mappings":"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","file":"shareService.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { CancellationToken } from '../../../../base/common/cancellation.js';\nimport { IDisposable } from '../../../../base/common/lifecycle.js';\nimport { URI } from '../../../../base/common/uri.js';\nimport { ICodeEditorService } from '../../../../editor/browser/services/codeEditorService.js';\nimport { score } from '../../../../editor/common/languageSelector.js';\nimport { localize } from '../../../../nls.js';\nimport { ISubmenuItem, registerAction2 } from '../../../../platform/actions/common/actions.js';\nimport { ContextKeyExpr, IContextKey, IContextKeyService, RawContextKey } from '../../../../platform/contextkey/common/contextkey.js';\nimport { ILabelService } from '../../../../platform/label/common/label.js';\nimport { IQuickInputService, IQuickPickItem } from '../../../../platform/quickinput/common/quickInput.js';\nimport { ITelemetryService } from '../../../../platform/telemetry/common/telemetry.js';\nimport { ToggleTitleBarConfigAction } from '../../../browser/parts/titlebar/titlebarActions.js';\nimport { IsCompactTitleBarContext, WorkspaceFolderCountContext } from '../../../common/contextkeys.js';\nimport { IShareProvider, IShareService, IShareableItem } from '../common/share.js';\n\nexport const ShareProviderCountContext = new RawContextKey<number>('shareProviderCount', 0, localize('shareProviderCount', \"The number of available share providers\"));\n\ntype ShareEvent = {\n\tproviderId: string;\n};\ntype ShareClassification = {\n\towner: 'joyceerhl'; comment: 'Reporting which share provider is invoked.';\n\tproviderId: { classification: 'SystemMetaData'; purpose: 'FeatureInsight'; comment: 'The id of the selected share provider.' };\n};\n\nexport class ShareService implements IShareService {\n\treadonly _serviceBrand: undefined;\n\n\treadonly providerCount: IContextKey<number>;\n\tprivate readonly _providers = new Set<IShareProvider>();\n\n\tconstructor(\n\t\t@IContextKeyService private contextKeyService: IContextKeyService,\n\t\t@ILabelService private readonly labelService: ILabelService,\n\t\t@IQuickInputService private quickInputService: IQuickInputService,\n\t\t@ICodeEditorService private readonly codeEditorService: ICodeEditorService,\n\t\t@ITelemetryService private readonly telemetryService: ITelemetryService,\n\t) {\n\t\tthis.providerCount = ShareProviderCountContext.bindTo(this.contextKeyService);\n\t}\n\n\tregisterShareProvider(provider: IShareProvider): IDisposable {\n\t\tthis._providers.add(provider);\n\t\tthis.providerCount.set(this._providers.size);\n\t\treturn {\n\t\t\tdispose: () => {\n\t\t\t\tthis._providers.delete(provider);\n\t\t\t\tthis.providerCount.set(this._providers.size);\n\t\t\t}\n\t\t};\n\t}\n\n\tgetShareActions(): ISubmenuItem[] {\n\t\t// todo@joyceerhl return share actions\n\t\treturn [];\n\t}\n\n\tasync provideShare(item: IShareableItem, token: CancellationToken): Promise<URI | string | undefined> {\n\t\tconst language = this.codeEditorService.getActiveCodeEditor()?.getModel()?.getLanguageId() ?? '';\n\t\tconst providers = [...this._providers.values()]\n\t\t\t.filter((p) => score(p.selector, item.resourceUri, language, true, undefined, undefined) > 0)\n\t\t\t.sort((a, b) => a.priority - b.priority);\n\n\t\tif (providers.length === 0) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\tif (providers.length === 1) {\n\t\t\tthis.telemetryService.publicLog2<ShareEvent, ShareClassification>('shareService.share', { providerId: providers[0].id });\n\t\t\treturn providers[0].provideShare(item, token);\n\t\t}\n\n\t\tconst items: (IQuickPickItem & { provider: IShareProvider })[] = providers.map((p) => ({ label: p.label, provider: p }));\n\t\tconst selected = await this.quickInputService.pick(items, { canPickMany: false, placeHolder: localize('type to filter', 'Choose how to share {0}', this.labelService.getUriLabel(item.resourceUri)) }, token);\n\n\t\tif (selected !== undefined) {\n\t\t\tthis.telemetryService.publicLog2<ShareEvent, ShareClassification>('shareService.share', { providerId: selected.provider.id });\n\t\t\treturn selected.provider.provideShare(item, token);\n\t\t}\n\n\t\treturn;\n\t}\n}\n\nregisterAction2(class ToggleShareControl extends ToggleTitleBarConfigAction {\n\tconstructor() {\n\t\tsuper('workbench.experimental.share.enabled', localize('toggle.share', 'Share'), localize('toggle.shareDescription', \"Toggle visibility of the Share action in title bar\"), 3, ContextKeyExpr.and(IsCompactTitleBarContext.toNegated(), ContextKeyExpr.has('config.window.commandCenter'), ContextKeyExpr.and(ShareProviderCountContext.notEqualsTo(0), WorkspaceFolderCountContext.notEqualsTo(0))));\n\t}\n});\n"]}