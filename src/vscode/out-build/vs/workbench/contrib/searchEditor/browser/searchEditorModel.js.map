{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/contrib/searchEditor/browser/searchEditorModel.ts","vs/workbench/contrib/searchEditor/browser/searchEditorModel.ts"],"names":[],"mappings":"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","file":"searchEditorModel.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { URI } from '../../../../base/common/uri.js';\nimport { ITextModel } from '../../../../editor/common/model.js';\nimport { IModelService } from '../../../../editor/common/services/model.js';\nimport { ILanguageService } from '../../../../editor/common/languages/language.js';\nimport { IInstantiationService, ServicesAccessor } from '../../../../platform/instantiation/common/instantiation.js';\nimport { parseSavedSearchEditor, parseSerializedSearchEditor } from './searchEditorSerialization.js';\nimport { IWorkingCopyBackupService } from '../../../services/workingCopy/common/workingCopyBackup.js';\nimport { SearchConfiguration, SearchEditorWorkingCopyTypeId } from './constants.js';\nimport { assertReturnsDefined } from '../../../../base/common/types.js';\nimport { createTextBufferFactoryFromStream } from '../../../../editor/common/model/textModel.js';\nimport { Emitter } from '../../../../base/common/event.js';\nimport { ResourceMap } from '../../../../base/common/map.js';\nimport { SEARCH_RESULT_LANGUAGE_ID } from '../../../services/search/common/search.js';\n\nexport type SearchEditorData = { resultsModel: ITextModel; configurationModel: SearchConfigurationModel };\n\nexport class SearchConfigurationModel {\n\tprivate _onConfigDidUpdate = new Emitter<SearchConfiguration>();\n\tpublic readonly onConfigDidUpdate = this._onConfigDidUpdate.event;\n\n\tconstructor(public config: Readonly<SearchConfiguration>) { }\n\tupdateConfig(config: SearchConfiguration) { this.config = config; this._onConfigDidUpdate.fire(config); }\n}\n\nexport class SearchEditorModel {\n\tconstructor(\n\t\tprivate resource: URI,\n\t) { }\n\n\tasync resolve(): Promise<SearchEditorData> {\n\t\treturn assertReturnsDefined(searchEditorModelFactory.models.get(this.resource)).resolve();\n\t}\n}\n\nclass SearchEditorModelFactory {\n\tmodels = new ResourceMap<{ resolve: () => Promise<SearchEditorData> }>();\n\n\tconstructor() { }\n\n\tinitializeModelFromExistingModel(accessor: ServicesAccessor, resource: URI, config: SearchConfiguration) {\n\t\tif (this.models.has(resource)) {\n\t\t\tthrow Error('Unable to contruct model for resource that already exists');\n\t\t}\n\n\t\tconst languageService = accessor.get(ILanguageService);\n\t\tconst modelService = accessor.get(IModelService);\n\t\tconst instantiationService = accessor.get(IInstantiationService);\n\t\tconst workingCopyBackupService = accessor.get(IWorkingCopyBackupService);\n\n\t\tlet ongoingResolve: Promise<SearchEditorData> | undefined;\n\n\t\tthis.models.set(resource, {\n\t\t\tresolve: () => {\n\t\t\t\tif (!ongoingResolve) {\n\t\t\t\t\tongoingResolve = (async () => {\n\n\t\t\t\t\t\tconst backup = await this.tryFetchModelFromBackupService(resource, languageService, modelService, workingCopyBackupService, instantiationService);\n\t\t\t\t\t\tif (backup) {\n\t\t\t\t\t\t\treturn backup;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn Promise.resolve({\n\t\t\t\t\t\t\tresultsModel: modelService.getModel(resource) ?? modelService.createModel('', languageService.createById(SEARCH_RESULT_LANGUAGE_ID), resource),\n\t\t\t\t\t\t\tconfigurationModel: new SearchConfigurationModel(config)\n\t\t\t\t\t\t});\n\t\t\t\t\t})();\n\t\t\t\t}\n\t\t\t\treturn ongoingResolve;\n\t\t\t}\n\t\t});\n\t}\n\n\tinitializeModelFromRawData(accessor: ServicesAccessor, resource: URI, config: SearchConfiguration, contents: string | undefined) {\n\t\tif (this.models.has(resource)) {\n\t\t\tthrow Error('Unable to contruct model for resource that already exists');\n\t\t}\n\n\t\tconst languageService = accessor.get(ILanguageService);\n\t\tconst modelService = accessor.get(IModelService);\n\t\tconst instantiationService = accessor.get(IInstantiationService);\n\t\tconst workingCopyBackupService = accessor.get(IWorkingCopyBackupService);\n\n\t\tlet ongoingResolve: Promise<SearchEditorData> | undefined;\n\n\t\tthis.models.set(resource, {\n\t\t\tresolve: () => {\n\t\t\t\tif (!ongoingResolve) {\n\t\t\t\t\tongoingResolve = (async () => {\n\n\t\t\t\t\t\tconst backup = await this.tryFetchModelFromBackupService(resource, languageService, modelService, workingCopyBackupService, instantiationService);\n\t\t\t\t\t\tif (backup) {\n\t\t\t\t\t\t\treturn backup;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn Promise.resolve({\n\t\t\t\t\t\t\tresultsModel: modelService.createModel(contents ?? '', languageService.createById(SEARCH_RESULT_LANGUAGE_ID), resource),\n\t\t\t\t\t\t\tconfigurationModel: new SearchConfigurationModel(config)\n\t\t\t\t\t\t});\n\t\t\t\t\t})();\n\t\t\t\t}\n\t\t\t\treturn ongoingResolve;\n\t\t\t}\n\t\t});\n\t}\n\n\tinitializeModelFromExistingFile(accessor: ServicesAccessor, resource: URI, existingFile: URI) {\n\t\tif (this.models.has(resource)) {\n\t\t\tthrow Error('Unable to contruct model for resource that already exists');\n\t\t}\n\n\t\tconst languageService = accessor.get(ILanguageService);\n\t\tconst modelService = accessor.get(IModelService);\n\t\tconst instantiationService = accessor.get(IInstantiationService);\n\t\tconst workingCopyBackupService = accessor.get(IWorkingCopyBackupService);\n\n\t\tlet ongoingResolve: Promise<SearchEditorData> | undefined;\n\n\t\tthis.models.set(resource, {\n\t\t\tresolve: async () => {\n\t\t\t\tif (!ongoingResolve) {\n\t\t\t\t\tongoingResolve = (async () => {\n\n\t\t\t\t\t\tconst backup = await this.tryFetchModelFromBackupService(resource, languageService, modelService, workingCopyBackupService, instantiationService);\n\t\t\t\t\t\tif (backup) {\n\t\t\t\t\t\t\treturn backup;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tconst { text, config } = await instantiationService.invokeFunction(parseSavedSearchEditor, existingFile);\n\t\t\t\t\t\treturn ({\n\t\t\t\t\t\t\tresultsModel: modelService.createModel(text ?? '', languageService.createById(SEARCH_RESULT_LANGUAGE_ID), resource),\n\t\t\t\t\t\t\tconfigurationModel: new SearchConfigurationModel(config)\n\t\t\t\t\t\t});\n\t\t\t\t\t})();\n\t\t\t\t}\n\t\t\t\treturn ongoingResolve;\n\t\t\t}\n\t\t});\n\t}\n\n\tprivate async tryFetchModelFromBackupService(resource: URI, languageService: ILanguageService, modelService: IModelService, workingCopyBackupService: IWorkingCopyBackupService, instantiationService: IInstantiationService): Promise<SearchEditorData | undefined> {\n\t\tconst backup = await workingCopyBackupService.resolve({ resource, typeId: SearchEditorWorkingCopyTypeId });\n\n\t\tlet model = modelService.getModel(resource);\n\t\tif (!model && backup) {\n\t\t\tconst factory = await createTextBufferFactoryFromStream(backup.value);\n\n\t\t\tmodel = modelService.createModel(factory, languageService.createById(SEARCH_RESULT_LANGUAGE_ID), resource);\n\t\t}\n\n\t\tif (model) {\n\t\t\tconst existingFile = model.getValue();\n\t\t\tconst { text, config } = parseSerializedSearchEditor(existingFile);\n\t\t\tmodelService.destroyModel(resource);\n\t\t\treturn ({\n\t\t\t\tresultsModel: modelService.createModel(text ?? '', languageService.createById(SEARCH_RESULT_LANGUAGE_ID), resource),\n\t\t\t\tconfigurationModel: new SearchConfigurationModel(config)\n\t\t\t});\n\t\t}\n\t\telse {\n\t\t\treturn undefined;\n\t\t}\n\t}\n}\n\nexport const searchEditorModelFactory = new SearchEditorModelFactory();\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { URI } from '../../../../base/common/uri.js';\nimport { ITextModel } from '../../../../editor/common/model.js';\nimport { IModelService } from '../../../../editor/common/services/model.js';\nimport { ILanguageService } from '../../../../editor/common/languages/language.js';\nimport { IInstantiationService, ServicesAccessor } from '../../../../platform/instantiation/common/instantiation.js';\nimport { parseSavedSearchEditor, parseSerializedSearchEditor } from './searchEditorSerialization.js';\nimport { IWorkingCopyBackupService } from '../../../services/workingCopy/common/workingCopyBackup.js';\nimport { SearchConfiguration, SearchEditorWorkingCopyTypeId } from './constants.js';\nimport { assertReturnsDefined } from '../../../../base/common/types.js';\nimport { createTextBufferFactoryFromStream } from '../../../../editor/common/model/textModel.js';\nimport { Emitter } from '../../../../base/common/event.js';\nimport { ResourceMap } from '../../../../base/common/map.js';\nimport { SEARCH_RESULT_LANGUAGE_ID } from '../../../services/search/common/search.js';\n\nexport type SearchEditorData = { resultsModel: ITextModel; configurationModel: SearchConfigurationModel };\n\nexport class SearchConfigurationModel {\n\tprivate _onConfigDidUpdate = new Emitter<SearchConfiguration>();\n\tpublic readonly onConfigDidUpdate = this._onConfigDidUpdate.event;\n\n\tconstructor(public config: Readonly<SearchConfiguration>) { }\n\tupdateConfig(config: SearchConfiguration) { this.config = config; this._onConfigDidUpdate.fire(config); }\n}\n\nexport class SearchEditorModel {\n\tconstructor(\n\t\tprivate resource: URI,\n\t) { }\n\n\tasync resolve(): Promise<SearchEditorData> {\n\t\treturn assertReturnsDefined(searchEditorModelFactory.models.get(this.resource)).resolve();\n\t}\n}\n\nclass SearchEditorModelFactory {\n\tmodels = new ResourceMap<{ resolve: () => Promise<SearchEditorData> }>();\n\n\tconstructor() { }\n\n\tinitializeModelFromExistingModel(accessor: ServicesAccessor, resource: URI, config: SearchConfiguration) {\n\t\tif (this.models.has(resource)) {\n\t\t\tthrow Error('Unable to contruct model for resource that already exists');\n\t\t}\n\n\t\tconst languageService = accessor.get(ILanguageService);\n\t\tconst modelService = accessor.get(IModelService);\n\t\tconst instantiationService = accessor.get(IInstantiationService);\n\t\tconst workingCopyBackupService = accessor.get(IWorkingCopyBackupService);\n\n\t\tlet ongoingResolve: Promise<SearchEditorData> | undefined;\n\n\t\tthis.models.set(resource, {\n\t\t\tresolve: () => {\n\t\t\t\tif (!ongoingResolve) {\n\t\t\t\t\tongoingResolve = (async () => {\n\n\t\t\t\t\t\tconst backup = await this.tryFetchModelFromBackupService(resource, languageService, modelService, workingCopyBackupService, instantiationService);\n\t\t\t\t\t\tif (backup) {\n\t\t\t\t\t\t\treturn backup;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn Promise.resolve({\n\t\t\t\t\t\t\tresultsModel: modelService.getModel(resource) ?? modelService.createModel('', languageService.createById(SEARCH_RESULT_LANGUAGE_ID), resource),\n\t\t\t\t\t\t\tconfigurationModel: new SearchConfigurationModel(config)\n\t\t\t\t\t\t});\n\t\t\t\t\t})();\n\t\t\t\t}\n\t\t\t\treturn ongoingResolve;\n\t\t\t}\n\t\t});\n\t}\n\n\tinitializeModelFromRawData(accessor: ServicesAccessor, resource: URI, config: SearchConfiguration, contents: string | undefined) {\n\t\tif (this.models.has(resource)) {\n\t\t\tthrow Error('Unable to contruct model for resource that already exists');\n\t\t}\n\n\t\tconst languageService = accessor.get(ILanguageService);\n\t\tconst modelService = accessor.get(IModelService);\n\t\tconst instantiationService = accessor.get(IInstantiationService);\n\t\tconst workingCopyBackupService = accessor.get(IWorkingCopyBackupService);\n\n\t\tlet ongoingResolve: Promise<SearchEditorData> | undefined;\n\n\t\tthis.models.set(resource, {\n\t\t\tresolve: () => {\n\t\t\t\tif (!ongoingResolve) {\n\t\t\t\t\tongoingResolve = (async () => {\n\n\t\t\t\t\t\tconst backup = await this.tryFetchModelFromBackupService(resource, languageService, modelService, workingCopyBackupService, instantiationService);\n\t\t\t\t\t\tif (backup) {\n\t\t\t\t\t\t\treturn backup;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn Promise.resolve({\n\t\t\t\t\t\t\tresultsModel: modelService.createModel(contents ?? '', languageService.createById(SEARCH_RESULT_LANGUAGE_ID), resource),\n\t\t\t\t\t\t\tconfigurationModel: new SearchConfigurationModel(config)\n\t\t\t\t\t\t});\n\t\t\t\t\t})();\n\t\t\t\t}\n\t\t\t\treturn ongoingResolve;\n\t\t\t}\n\t\t});\n\t}\n\n\tinitializeModelFromExistingFile(accessor: ServicesAccessor, resource: URI, existingFile: URI) {\n\t\tif (this.models.has(resource)) {\n\t\t\tthrow Error('Unable to contruct model for resource that already exists');\n\t\t}\n\n\t\tconst languageService = accessor.get(ILanguageService);\n\t\tconst modelService = accessor.get(IModelService);\n\t\tconst instantiationService = accessor.get(IInstantiationService);\n\t\tconst workingCopyBackupService = accessor.get(IWorkingCopyBackupService);\n\n\t\tlet ongoingResolve: Promise<SearchEditorData> | undefined;\n\n\t\tthis.models.set(resource, {\n\t\t\tresolve: async () => {\n\t\t\t\tif (!ongoingResolve) {\n\t\t\t\t\tongoingResolve = (async () => {\n\n\t\t\t\t\t\tconst backup = await this.tryFetchModelFromBackupService(resource, languageService, modelService, workingCopyBackupService, instantiationService);\n\t\t\t\t\t\tif (backup) {\n\t\t\t\t\t\t\treturn backup;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tconst { text, config } = await instantiationService.invokeFunction(parseSavedSearchEditor, existingFile);\n\t\t\t\t\t\treturn ({\n\t\t\t\t\t\t\tresultsModel: modelService.createModel(text ?? '', languageService.createById(SEARCH_RESULT_LANGUAGE_ID), resource),\n\t\t\t\t\t\t\tconfigurationModel: new SearchConfigurationModel(config)\n\t\t\t\t\t\t});\n\t\t\t\t\t})();\n\t\t\t\t}\n\t\t\t\treturn ongoingResolve;\n\t\t\t}\n\t\t});\n\t}\n\n\tprivate async tryFetchModelFromBackupService(resource: URI, languageService: ILanguageService, modelService: IModelService, workingCopyBackupService: IWorkingCopyBackupService, instantiationService: IInstantiationService): Promise<SearchEditorData | undefined> {\n\t\tconst backup = await workingCopyBackupService.resolve({ resource, typeId: SearchEditorWorkingCopyTypeId });\n\n\t\tlet model = modelService.getModel(resource);\n\t\tif (!model && backup) {\n\t\t\tconst factory = await createTextBufferFactoryFromStream(backup.value);\n\n\t\t\tmodel = modelService.createModel(factory, languageService.createById(SEARCH_RESULT_LANGUAGE_ID), resource);\n\t\t}\n\n\t\tif (model) {\n\t\t\tconst existingFile = model.getValue();\n\t\t\tconst { text, config } = parseSerializedSearchEditor(existingFile);\n\t\t\tmodelService.destroyModel(resource);\n\t\t\treturn ({\n\t\t\t\tresultsModel: modelService.createModel(text ?? '', languageService.createById(SEARCH_RESULT_LANGUAGE_ID), resource),\n\t\t\t\tconfigurationModel: new SearchConfigurationModel(config)\n\t\t\t});\n\t\t}\n\t\telse {\n\t\t\treturn undefined;\n\t\t}\n\t}\n}\n\nexport const searchEditorModelFactory = new SearchEditorModelFactory();\n"]}