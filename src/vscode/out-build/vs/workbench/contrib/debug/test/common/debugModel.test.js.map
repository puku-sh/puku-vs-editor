{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/contrib/debug/test/common/debugModel.test.ts","vs/workbench/contrib/debug/test/common/debugModel.test.ts"],"names":[],"mappings":"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","file":"debugModel.test.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport assert from 'assert';\nimport { DeferredPromise } from '../../../../../base/common/async.js';\nimport { DisposableStore } from '../../../../../base/common/lifecycle.js';\nimport { mockObject, upcastDeepPartial, upcastPartial } from '../../../../../base/test/common/mock.js';\nimport { ensureNoDisposablesAreLeakedInTestSuite } from '../../../../../base/test/common/utils.js';\nimport { NullLogService } from '../../../../../platform/log/common/log.js';\nimport { ITextFileService } from '../../../../services/textfile/common/textfiles.js';\nimport { TestStorageService } from '../../../../test/common/workbenchTestServices.js';\nimport { IDebugSession } from '../../common/debug.js';\nimport { DebugModel, ExceptionBreakpoint, FunctionBreakpoint, Thread } from '../../common/debugModel.js';\nimport { MockDebugStorage } from './mockDebug.js';\nimport { runWithFakedTimers } from '../../../../../base/test/common/timeTravelScheduler.js';\n\nsuite('DebugModel', () => {\n\tensureNoDisposablesAreLeakedInTestSuite();\n\n\tsuite('FunctionBreakpoint', () => {\n\t\ttest('Id is saved', () => {\n\t\t\tconst fbp = new FunctionBreakpoint({ name: 'function', enabled: true, hitCondition: 'hit condition', condition: 'condition', logMessage: 'log message' });\n\t\t\tconst strigified = JSON.stringify(fbp);\n\t\t\tconst parsed = JSON.parse(strigified);\n\t\t\tassert.equal(parsed.id, fbp.getId());\n\t\t});\n\t});\n\n\tsuite('ExceptionBreakpoint', () => {\n\t\ttest('Restored matches new', () => {\n\t\t\tconst ebp = new ExceptionBreakpoint({\n\t\t\t\tconditionDescription: 'condition description',\n\t\t\t\tdescription: 'description',\n\t\t\t\tfilter: 'condition',\n\t\t\t\tlabel: 'label',\n\t\t\t\tsupportsCondition: true,\n\t\t\t\tenabled: true,\n\t\t\t}, 'id');\n\t\t\tconst strigified = JSON.stringify(ebp);\n\t\t\tconst parsed = JSON.parse(strigified);\n\t\t\tconst newEbp = new ExceptionBreakpoint(parsed);\n\t\t\tassert.ok(ebp.matches(newEbp));\n\t\t});\n\t});\n\n\tsuite('DebugModel', () => {\n\t\ttest('refreshTopOfCallstack resolves all returned promises when called multiple times', async () => {\n\t\t\treturn runWithFakedTimers({}, async () => {\n\t\t\t\tconst topFrameDeferred = new DeferredPromise<void>();\n\t\t\t\tconst wholeStackDeferred = new DeferredPromise<void>();\n\t\t\t\tconst fakeThread = mockObject<Thread>()({\n\t\t\t\t\tsession: upcastDeepPartial<IDebugSession>({ capabilities: { supportsDelayedStackTraceLoading: true } }),\n\t\t\t\t\tgetCallStack: () => [],\n\t\t\t\t\tgetStaleCallStack: () => [],\n\t\t\t\t});\n\t\t\t\tfakeThread.fetchCallStack.callsFake((levels: number) => {\n\t\t\t\t\treturn levels === 1 ? topFrameDeferred.p : wholeStackDeferred.p;\n\t\t\t\t});\n\t\t\t\tfakeThread.getId.returns(1);\n\n\t\t\t\tconst disposable = new DisposableStore();\n\t\t\t\tconst storage = disposable.add(new TestStorageService());\n\t\t\t\tconst model = new DebugModel(disposable.add(new MockDebugStorage(storage)), upcastPartial<ITextFileService>({ isDirty: (e: unknown) => false }), undefined!, new NullLogService());\n\t\t\t\tdisposable.add(model);\n\n\t\t\t\tlet top1Resolved = false;\n\t\t\t\tlet whole1Resolved = false;\n\t\t\t\tlet top2Resolved = false;\n\t\t\t\tlet whole2Resolved = false;\n\t\t\t\t// eslint-disable-next-line local/code-no-any-casts\n\t\t\t\tconst result1 = model.refreshTopOfCallstack(fakeThread as any);\n\t\t\t\tresult1.topCallStack.then(() => top1Resolved = true);\n\t\t\t\tresult1.wholeCallStack.then(() => whole1Resolved = true);\n\n\t\t\t\t// eslint-disable-next-line local/code-no-any-casts\n\t\t\t\tconst result2 = model.refreshTopOfCallstack(fakeThread as any);\n\t\t\t\tresult2.topCallStack.then(() => top2Resolved = true);\n\t\t\t\tresult2.wholeCallStack.then(() => whole2Resolved = true);\n\n\t\t\t\tassert.ok(!top1Resolved);\n\t\t\t\tassert.ok(!whole1Resolved);\n\t\t\t\tassert.ok(!top2Resolved);\n\t\t\t\tassert.ok(!whole2Resolved);\n\n\t\t\t\tawait topFrameDeferred.complete();\n\t\t\t\tawait result1.topCallStack;\n\t\t\t\tawait result2.topCallStack;\n\t\t\t\tassert.ok(!whole1Resolved);\n\t\t\t\tassert.ok(!whole2Resolved);\n\n\t\t\t\tawait wholeStackDeferred.complete();\n\t\t\t\tawait result1.wholeCallStack;\n\t\t\t\tawait result2.wholeCallStack;\n\n\t\t\t\tdisposable.dispose();\n\t\t\t});\n\t\t});\n\t});\n});\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport assert from 'assert';\nimport { DeferredPromise } from '../../../../../base/common/async.js';\nimport { DisposableStore } from '../../../../../base/common/lifecycle.js';\nimport { mockObject, upcastDeepPartial, upcastPartial } from '../../../../../base/test/common/mock.js';\nimport { ensureNoDisposablesAreLeakedInTestSuite } from '../../../../../base/test/common/utils.js';\nimport { NullLogService } from '../../../../../platform/log/common/log.js';\nimport { ITextFileService } from '../../../../services/textfile/common/textfiles.js';\nimport { TestStorageService } from '../../../../test/common/workbenchTestServices.js';\nimport { IDebugSession } from '../../common/debug.js';\nimport { DebugModel, ExceptionBreakpoint, FunctionBreakpoint, Thread } from '../../common/debugModel.js';\nimport { MockDebugStorage } from './mockDebug.js';\nimport { runWithFakedTimers } from '../../../../../base/test/common/timeTravelScheduler.js';\n\nsuite('DebugModel', () => {\n\tensureNoDisposablesAreLeakedInTestSuite();\n\n\tsuite('FunctionBreakpoint', () => {\n\t\ttest('Id is saved', () => {\n\t\t\tconst fbp = new FunctionBreakpoint({ name: 'function', enabled: true, hitCondition: 'hit condition', condition: 'condition', logMessage: 'log message' });\n\t\t\tconst strigified = JSON.stringify(fbp);\n\t\t\tconst parsed = JSON.parse(strigified);\n\t\t\tassert.equal(parsed.id, fbp.getId());\n\t\t});\n\t});\n\n\tsuite('ExceptionBreakpoint', () => {\n\t\ttest('Restored matches new', () => {\n\t\t\tconst ebp = new ExceptionBreakpoint({\n\t\t\t\tconditionDescription: 'condition description',\n\t\t\t\tdescription: 'description',\n\t\t\t\tfilter: 'condition',\n\t\t\t\tlabel: 'label',\n\t\t\t\tsupportsCondition: true,\n\t\t\t\tenabled: true,\n\t\t\t}, 'id');\n\t\t\tconst strigified = JSON.stringify(ebp);\n\t\t\tconst parsed = JSON.parse(strigified);\n\t\t\tconst newEbp = new ExceptionBreakpoint(parsed);\n\t\t\tassert.ok(ebp.matches(newEbp));\n\t\t});\n\t});\n\n\tsuite('DebugModel', () => {\n\t\ttest('refreshTopOfCallstack resolves all returned promises when called multiple times', async () => {\n\t\t\treturn runWithFakedTimers({}, async () => {\n\t\t\t\tconst topFrameDeferred = new DeferredPromise<void>();\n\t\t\t\tconst wholeStackDeferred = new DeferredPromise<void>();\n\t\t\t\tconst fakeThread = mockObject<Thread>()({\n\t\t\t\t\tsession: upcastDeepPartial<IDebugSession>({ capabilities: { supportsDelayedStackTraceLoading: true } }),\n\t\t\t\t\tgetCallStack: () => [],\n\t\t\t\t\tgetStaleCallStack: () => [],\n\t\t\t\t});\n\t\t\t\tfakeThread.fetchCallStack.callsFake((levels: number) => {\n\t\t\t\t\treturn levels === 1 ? topFrameDeferred.p : wholeStackDeferred.p;\n\t\t\t\t});\n\t\t\t\tfakeThread.getId.returns(1);\n\n\t\t\t\tconst disposable = new DisposableStore();\n\t\t\t\tconst storage = disposable.add(new TestStorageService());\n\t\t\t\tconst model = new DebugModel(disposable.add(new MockDebugStorage(storage)), upcastPartial<ITextFileService>({ isDirty: (e: unknown) => false }), undefined!, new NullLogService());\n\t\t\t\tdisposable.add(model);\n\n\t\t\t\tlet top1Resolved = false;\n\t\t\t\tlet whole1Resolved = false;\n\t\t\t\tlet top2Resolved = false;\n\t\t\t\tlet whole2Resolved = false;\n\t\t\t\t// eslint-disable-next-line local/code-no-any-casts\n\t\t\t\tconst result1 = model.refreshTopOfCallstack(fakeThread as any);\n\t\t\t\tresult1.topCallStack.then(() => top1Resolved = true);\n\t\t\t\tresult1.wholeCallStack.then(() => whole1Resolved = true);\n\n\t\t\t\t// eslint-disable-next-line local/code-no-any-casts\n\t\t\t\tconst result2 = model.refreshTopOfCallstack(fakeThread as any);\n\t\t\t\tresult2.topCallStack.then(() => top2Resolved = true);\n\t\t\t\tresult2.wholeCallStack.then(() => whole2Resolved = true);\n\n\t\t\t\tassert.ok(!top1Resolved);\n\t\t\t\tassert.ok(!whole1Resolved);\n\t\t\t\tassert.ok(!top2Resolved);\n\t\t\t\tassert.ok(!whole2Resolved);\n\n\t\t\t\tawait topFrameDeferred.complete();\n\t\t\t\tawait result1.topCallStack;\n\t\t\t\tawait result2.topCallStack;\n\t\t\t\tassert.ok(!whole1Resolved);\n\t\t\t\tassert.ok(!whole2Resolved);\n\n\t\t\t\tawait wholeStackDeferred.complete();\n\t\t\t\tawait result1.wholeCallStack;\n\t\t\t\tawait result2.wholeCallStack;\n\n\t\t\t\tdisposable.dispose();\n\t\t\t});\n\t\t});\n\t});\n});\n"]}