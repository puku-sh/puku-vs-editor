{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/contrib/debug/node/terminals.ts","vs/workbench/contrib/debug/node/terminals.ts"],"names":[],"mappings":"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","file":"terminals.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as cp from 'child_process';\nimport { getDriveLetter } from '../../../../base/common/extpath.js';\nimport * as platform from '../../../../base/common/platform.js';\n\nfunction spawnAsPromised(command: string, args: string[]): Promise<string> {\n\treturn new Promise((resolve, reject) => {\n\t\tlet stdout = '';\n\t\tconst child = cp.spawn(command, args);\n\t\tif (child.pid) {\n\t\t\tchild.stdout.on('data', (data: Buffer) => {\n\t\t\t\tstdout += data.toString();\n\t\t\t});\n\t\t}\n\t\tchild.on('error', err => {\n\t\t\treject(err);\n\t\t});\n\t\tchild.on('close', code => {\n\t\t\tresolve(stdout);\n\t\t});\n\t});\n}\n\nexport async function hasChildProcesses(processId: number | undefined): Promise<boolean> {\n\tif (processId) {\n\n\t\t// if shell has at least one child process, assume that shell is busy\n\t\tif (platform.isWindows) {\n\t\t\tconst windowsProcessTree = await import('@vscode/windows-process-tree');\n\t\t\treturn new Promise<boolean>(resolve => {\n\t\t\t\twindowsProcessTree.getProcessTree(processId, processTree => {\n\t\t\t\t\tresolve(!!processTree && processTree.children.length > 0);\n\t\t\t\t});\n\t\t\t});\n\t\t} else {\n\t\t\treturn spawnAsPromised('/usr/bin/pgrep', ['-lP', String(processId)]).then(stdout => {\n\t\t\t\tconst r = stdout.trim();\n\t\t\t\tif (r.length === 0 || r.indexOf(' tmux') >= 0) { // ignore 'tmux'; see #43683\n\t\t\t\t\treturn false;\n\t\t\t\t} else {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t}, error => {\n\t\t\t\treturn true;\n\t\t\t});\n\t\t}\n\t}\n\t// fall back to safe side\n\treturn Promise.resolve(true);\n}\n\nconst enum ShellType { cmd, powershell, bash }\n\n\nexport function prepareCommand(shell: string, args: string[], argsCanBeInterpretedByShell: boolean, cwd?: string, env?: { [key: string]: string | null }): string {\n\n\tshell = shell.trim().toLowerCase();\n\n\t// try to determine the shell type\n\tlet shellType;\n\tif (shell.indexOf('powershell') >= 0 || shell.indexOf('pwsh') >= 0) {\n\t\tshellType = ShellType.powershell;\n\t} else if (shell.indexOf('cmd.exe') >= 0) {\n\t\tshellType = ShellType.cmd;\n\t} else if (shell.indexOf('bash') >= 0) {\n\t\tshellType = ShellType.bash;\n\t} else if (platform.isWindows) {\n\t\tshellType = ShellType.cmd; // pick a good default for Windows\n\t} else {\n\t\tshellType = ShellType.bash;\t// pick a good default for anything else\n\t}\n\n\tlet quote: (s: string) => string;\n\t// begin command with a space to avoid polluting shell history\n\tlet command = ' ';\n\n\tswitch (shellType) {\n\n\t\tcase ShellType.powershell:\n\n\t\t\tquote = (s: string) => {\n\t\t\t\ts = s.replace(/\\'/g, '\\'\\'');\n\t\t\t\tif (s.length > 0 && s.charAt(s.length - 1) === '\\\\') {\n\t\t\t\t\treturn `'${s}\\\\'`;\n\t\t\t\t}\n\t\t\t\treturn `'${s}'`;\n\t\t\t};\n\n\t\t\tif (cwd) {\n\t\t\t\tconst driveLetter = getDriveLetter(cwd);\n\t\t\t\tif (driveLetter) {\n\t\t\t\t\tcommand += `${driveLetter}:; `;\n\t\t\t\t}\n\t\t\t\tcommand += `cd ${quote(cwd)}; `;\n\t\t\t}\n\t\t\tif (env) {\n\t\t\t\tfor (const key in env) {\n\t\t\t\t\tconst value = env[key];\n\t\t\t\t\tif (value === null) {\n\t\t\t\t\t\tcommand += `Remove-Item env:${key}; `;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tcommand += `\\${env:${key}}='${value}'; `;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (args.length > 0) {\n\t\t\t\tconst arg = args.shift()!;\n\t\t\t\tconst cmd = argsCanBeInterpretedByShell ? arg : quote(arg);\n\t\t\t\tcommand += (cmd[0] === '\\'') ? `& ${cmd} ` : `${cmd} `;\n\t\t\t\tfor (const a of args) {\n\t\t\t\t\tcommand += (a === '<' || a === '>' || argsCanBeInterpretedByShell) ? a : quote(a);\n\t\t\t\t\tcommand += ' ';\n\t\t\t\t}\n\t\t\t}\n\t\t\tbreak;\n\n\t\tcase ShellType.cmd:\n\n\t\t\tquote = (s: string) => {\n\t\t\t\t// Note: Wrapping in cmd /C \"...\" complicates the escaping.\n\t\t\t\t// cmd /C \"node -e \"console.log(process.argv)\" \"\"\"A^>0\"\"\"\" # prints \"A>0\"\n\t\t\t\t// cmd /C \"node -e \"console.log(process.argv)\" \"foo^> bar\"\" # prints foo> bar\n\t\t\t\t// Outside of the cmd /C, it could be a simple quoting, but here, the ^ is needed too\n\t\t\t\ts = s.replace(/\\\"/g, '\"\"');\n\t\t\t\ts = s.replace(/([><!^&|])/g, '^$1');\n\t\t\t\treturn (' \"'.split('').some(char => s.includes(char)) || s.length === 0) ? `\"${s}\"` : s;\n\t\t\t};\n\n\t\t\tif (cwd) {\n\t\t\t\tconst driveLetter = getDriveLetter(cwd);\n\t\t\t\tif (driveLetter) {\n\t\t\t\t\tcommand += `${driveLetter}: && `;\n\t\t\t\t}\n\t\t\t\tcommand += `cd ${quote(cwd)} && `;\n\t\t\t}\n\t\t\tif (env) {\n\t\t\t\tcommand += 'cmd /C \"';\n\t\t\t\tfor (const key in env) {\n\t\t\t\t\tlet value = env[key];\n\t\t\t\t\tif (value === null) {\n\t\t\t\t\t\tcommand += `set \"${key}=\" && `;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tvalue = value.replace(/[&^|<>]/g, s => `^${s}`);\n\t\t\t\t\t\tcommand += `set \"${key}=${value}\" && `;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tfor (const a of args) {\n\t\t\t\tcommand += (a === '<' || a === '>' || argsCanBeInterpretedByShell) ? a : quote(a);\n\t\t\t\tcommand += ' ';\n\t\t\t}\n\t\t\tif (env) {\n\t\t\t\tcommand += '\"';\n\t\t\t}\n\t\t\tbreak;\n\n\t\tcase ShellType.bash: {\n\n\t\t\tquote = (s: string) => {\n\t\t\t\ts = s.replace(/([\"'\\\\\\$!><#()\\[\\]*&^| ;{}?`])/g, '\\\\$1');\n\t\t\t\treturn s.length === 0 ? `\"\"` : s;\n\t\t\t};\n\n\t\t\tconst hardQuote = (s: string) => {\n\t\t\t\treturn /[^\\w@%\\/+=,.:^-]/.test(s) ? `'${s.replace(/'/g, '\\'\\\\\\'\\'')}'` : s;\n\t\t\t};\n\n\t\t\tif (cwd) {\n\t\t\t\tcommand += `cd ${quote(cwd)} ; `;\n\t\t\t}\n\t\t\tif (env) {\n\t\t\t\tcommand += '/usr/bin/env';\n\t\t\t\tfor (const key in env) {\n\t\t\t\t\tconst value = env[key];\n\t\t\t\t\tif (value === null) {\n\t\t\t\t\t\tcommand += ` -u ${hardQuote(key)}`;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tcommand += ` ${hardQuote(`${key}=${value}`)}`;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tcommand += ' ';\n\t\t\t}\n\t\t\tfor (const a of args) {\n\t\t\t\tcommand += (a === '<' || a === '>' || argsCanBeInterpretedByShell) ? a : quote(a);\n\t\t\t\tcommand += ' ';\n\t\t\t}\n\t\t\tbreak;\n\t\t}\n\t}\n\n\treturn command;\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as cp from 'child_process';\nimport { getDriveLetter } from '../../../../base/common/extpath.js';\nimport * as platform from '../../../../base/common/platform.js';\n\nfunction spawnAsPromised(command: string, args: string[]): Promise<string> {\n\treturn new Promise((resolve, reject) => {\n\t\tlet stdout = '';\n\t\tconst child = cp.spawn(command, args);\n\t\tif (child.pid) {\n\t\t\tchild.stdout.on('data', (data: Buffer) => {\n\t\t\t\tstdout += data.toString();\n\t\t\t});\n\t\t}\n\t\tchild.on('error', err => {\n\t\t\treject(err);\n\t\t});\n\t\tchild.on('close', code => {\n\t\t\tresolve(stdout);\n\t\t});\n\t});\n}\n\nexport async function hasChildProcesses(processId: number | undefined): Promise<boolean> {\n\tif (processId) {\n\n\t\t// if shell has at least one child process, assume that shell is busy\n\t\tif (platform.isWindows) {\n\t\t\tconst windowsProcessTree = await import('@vscode/windows-process-tree');\n\t\t\treturn new Promise<boolean>(resolve => {\n\t\t\t\twindowsProcessTree.getProcessTree(processId, processTree => {\n\t\t\t\t\tresolve(!!processTree && processTree.children.length > 0);\n\t\t\t\t});\n\t\t\t});\n\t\t} else {\n\t\t\treturn spawnAsPromised('/usr/bin/pgrep', ['-lP', String(processId)]).then(stdout => {\n\t\t\t\tconst r = stdout.trim();\n\t\t\t\tif (r.length === 0 || r.indexOf(' tmux') >= 0) { // ignore 'tmux'; see #43683\n\t\t\t\t\treturn false;\n\t\t\t\t} else {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t}, error => {\n\t\t\t\treturn true;\n\t\t\t});\n\t\t}\n\t}\n\t// fall back to safe side\n\treturn Promise.resolve(true);\n}\n\nconst enum ShellType { cmd, powershell, bash }\n\n\nexport function prepareCommand(shell: string, args: string[], argsCanBeInterpretedByShell: boolean, cwd?: string, env?: { [key: string]: string | null }): string {\n\n\tshell = shell.trim().toLowerCase();\n\n\t// try to determine the shell type\n\tlet shellType;\n\tif (shell.indexOf('powershell') >= 0 || shell.indexOf('pwsh') >= 0) {\n\t\tshellType = ShellType.powershell;\n\t} else if (shell.indexOf('cmd.exe') >= 0) {\n\t\tshellType = ShellType.cmd;\n\t} else if (shell.indexOf('bash') >= 0) {\n\t\tshellType = ShellType.bash;\n\t} else if (platform.isWindows) {\n\t\tshellType = ShellType.cmd; // pick a good default for Windows\n\t} else {\n\t\tshellType = ShellType.bash;\t// pick a good default for anything else\n\t}\n\n\tlet quote: (s: string) => string;\n\t// begin command with a space to avoid polluting shell history\n\tlet command = ' ';\n\n\tswitch (shellType) {\n\n\t\tcase ShellType.powershell:\n\n\t\t\tquote = (s: string) => {\n\t\t\t\ts = s.replace(/\\'/g, '\\'\\'');\n\t\t\t\tif (s.length > 0 && s.charAt(s.length - 1) === '\\\\') {\n\t\t\t\t\treturn `'${s}\\\\'`;\n\t\t\t\t}\n\t\t\t\treturn `'${s}'`;\n\t\t\t};\n\n\t\t\tif (cwd) {\n\t\t\t\tconst driveLetter = getDriveLetter(cwd);\n\t\t\t\tif (driveLetter) {\n\t\t\t\t\tcommand += `${driveLetter}:; `;\n\t\t\t\t}\n\t\t\t\tcommand += `cd ${quote(cwd)}; `;\n\t\t\t}\n\t\t\tif (env) {\n\t\t\t\tfor (const key in env) {\n\t\t\t\t\tconst value = env[key];\n\t\t\t\t\tif (value === null) {\n\t\t\t\t\t\tcommand += `Remove-Item env:${key}; `;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tcommand += `\\${env:${key}}='${value}'; `;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (args.length > 0) {\n\t\t\t\tconst arg = args.shift()!;\n\t\t\t\tconst cmd = argsCanBeInterpretedByShell ? arg : quote(arg);\n\t\t\t\tcommand += (cmd[0] === '\\'') ? `& ${cmd} ` : `${cmd} `;\n\t\t\t\tfor (const a of args) {\n\t\t\t\t\tcommand += (a === '<' || a === '>' || argsCanBeInterpretedByShell) ? a : quote(a);\n\t\t\t\t\tcommand += ' ';\n\t\t\t\t}\n\t\t\t}\n\t\t\tbreak;\n\n\t\tcase ShellType.cmd:\n\n\t\t\tquote = (s: string) => {\n\t\t\t\t// Note: Wrapping in cmd /C \"...\" complicates the escaping.\n\t\t\t\t// cmd /C \"node -e \"console.log(process.argv)\" \"\"\"A^>0\"\"\"\" # prints \"A>0\"\n\t\t\t\t// cmd /C \"node -e \"console.log(process.argv)\" \"foo^> bar\"\" # prints foo> bar\n\t\t\t\t// Outside of the cmd /C, it could be a simple quoting, but here, the ^ is needed too\n\t\t\t\ts = s.replace(/\\\"/g, '\"\"');\n\t\t\t\ts = s.replace(/([><!^&|])/g, '^$1');\n\t\t\t\treturn (' \"'.split('').some(char => s.includes(char)) || s.length === 0) ? `\"${s}\"` : s;\n\t\t\t};\n\n\t\t\tif (cwd) {\n\t\t\t\tconst driveLetter = getDriveLetter(cwd);\n\t\t\t\tif (driveLetter) {\n\t\t\t\t\tcommand += `${driveLetter}: && `;\n\t\t\t\t}\n\t\t\t\tcommand += `cd ${quote(cwd)} && `;\n\t\t\t}\n\t\t\tif (env) {\n\t\t\t\tcommand += 'cmd /C \"';\n\t\t\t\tfor (const key in env) {\n\t\t\t\t\tlet value = env[key];\n\t\t\t\t\tif (value === null) {\n\t\t\t\t\t\tcommand += `set \"${key}=\" && `;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tvalue = value.replace(/[&^|<>]/g, s => `^${s}`);\n\t\t\t\t\t\tcommand += `set \"${key}=${value}\" && `;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tfor (const a of args) {\n\t\t\t\tcommand += (a === '<' || a === '>' || argsCanBeInterpretedByShell) ? a : quote(a);\n\t\t\t\tcommand += ' ';\n\t\t\t}\n\t\t\tif (env) {\n\t\t\t\tcommand += '\"';\n\t\t\t}\n\t\t\tbreak;\n\n\t\tcase ShellType.bash: {\n\n\t\t\tquote = (s: string) => {\n\t\t\t\ts = s.replace(/([\"'\\\\\\$!><#()\\[\\]*&^| ;{}?`])/g, '\\\\$1');\n\t\t\t\treturn s.length === 0 ? `\"\"` : s;\n\t\t\t};\n\n\t\t\tconst hardQuote = (s: string) => {\n\t\t\t\treturn /[^\\w@%\\/+=,.:^-]/.test(s) ? `'${s.replace(/'/g, '\\'\\\\\\'\\'')}'` : s;\n\t\t\t};\n\n\t\t\tif (cwd) {\n\t\t\t\tcommand += `cd ${quote(cwd)} ; `;\n\t\t\t}\n\t\t\tif (env) {\n\t\t\t\tcommand += '/usr/bin/env';\n\t\t\t\tfor (const key in env) {\n\t\t\t\t\tconst value = env[key];\n\t\t\t\t\tif (value === null) {\n\t\t\t\t\t\tcommand += ` -u ${hardQuote(key)}`;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tcommand += ` ${hardQuote(`${key}=${value}`)}`;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tcommand += ' ';\n\t\t\t}\n\t\t\tfor (const a of args) {\n\t\t\t\tcommand += (a === '<' || a === '>' || argsCanBeInterpretedByShell) ? a : quote(a);\n\t\t\t\tcommand += ' ';\n\t\t\t}\n\t\t\tbreak;\n\t\t}\n\t}\n\n\treturn command;\n}\n"]}