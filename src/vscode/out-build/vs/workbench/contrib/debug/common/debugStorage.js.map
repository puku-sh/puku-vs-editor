{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/contrib/debug/common/debugStorage.ts","vs/workbench/contrib/debug/common/debugStorage.ts"],"names":[],"mappings":"AAAA;;;gGAGgG;;;;;;;;;;AAEhG,OAAO,EAAE,UAAU,EAAE,MAAM,sCAAsC,CAAC;AAClE,OAAO,EAAuB,eAAe,EAAE,MAAM,uCAAuC,CAAC;AAC7F,OAAO,EAAE,GAAG,EAAE,MAAM,gCAAgC,CAAC;AACrD,OAAO,EAAE,WAAW,EAAE,MAAM,wCAAwC,CAAC;AACrE,OAAO,EAAE,eAAe,EAA+B,MAAM,gDAAgD,CAAC;AAC9G,OAAO,EAAE,mBAAmB,EAAE,MAAM,wDAAwD,CAAC;AAE7F,OAAO,EAAE,UAAU,EAAE,cAAc,EAAE,mBAAmB,EAAE,UAAU,EAAE,kBAAkB,EAAE,MAAM,iBAAiB,CAAC;AAClH,OAAO,EAAE,gBAAgB,EAAE,MAAM,gDAAgD,CAAC;AAClF,OAAO,EAAE,SAAS,EAAE,MAAM,oCAAoC,CAAC;AAE/D,MAAM,qBAAqB,GAAG,kBAAkB,CAAC;AACjD,MAAM,8BAA8B,GAAG,0BAA0B,CAAC;AAClE,MAAM,0BAA0B,GAAG,sBAAsB,CAAC;AAC1D,MAAM,+BAA+B,GAAG,2BAA2B,CAAC;AACpE,MAAM,2BAA2B,GAAG,wBAAwB,CAAC;AAC7D,MAAM,6BAA6B,GAAG,yBAAyB,CAAC;AAChE,MAAM,kBAAkB,GAAG,eAAe,CAAC;AAOpC,IAAM,YAAY,GAAlB,MAAM,YAAa,SAAQ,UAAU;IAO3C,YACmC,cAA+B,EAC9B,eAAiC,EAC9B,kBAAuC,EAC/C,UAAuB;QAErD,KAAK,EAAE,CAAC;QAL0B,mBAAc,GAAd,cAAc,CAAiB;QAC9B,oBAAe,GAAf,eAAe,CAAkB;QAC9B,uBAAkB,GAAlB,kBAAkB,CAAqB;QAC/C,eAAU,GAAV,UAAU,CAAa;QAGrD,IAAI,CAAC,WAAW,GAAG,eAAe,CAAC,IAAI,EAAE,IAAI,CAAC,eAAe,EAAE,CAAC,CAAC;QACjE,IAAI,CAAC,mBAAmB,GAAG,eAAe,CAAC,IAAI,EAAE,IAAI,CAAC,uBAAuB,EAAE,CAAC,CAAC;QACjF,IAAI,CAAC,oBAAoB,GAAG,eAAe,CAAC,IAAI,EAAE,IAAI,CAAC,wBAAwB,EAAE,CAAC,CAAC;QACnF,IAAI,CAAC,eAAe,GAAG,eAAe,CAAC,IAAI,EAAE,IAAI,CAAC,mBAAmB,EAAE,CAAC,CAAC;QACzE,IAAI,CAAC,gBAAgB,GAAG,eAAe,CAAC,IAAI,EAAE,IAAI,CAAC,oBAAoB,EAAE,CAAC,CAAC;QAE3E,IAAI,CAAC,SAAS,CAAC,cAAc,CAAC,gBAAgB,iCAAyB,SAAS,EAAE,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,EAAE;YAClG,IAAI,CAAC,CAAC,QAAQ,EAAE,CAAC;gBAChB,QAAQ,CAAC,CAAC,GAAG,EAAE,CAAC;oBACf,KAAK,qBAAqB;wBACzB,OAAO,IAAI,CAAC,WAAW,CAAC,GAAG,CAAC,IAAI,CAAC,eAAe,EAAE,EAAE,SAAS,CAAC,CAAC;oBAChE,KAAK,8BAA8B;wBAClC,OAAO,IAAI,CAAC,mBAAmB,CAAC,GAAG,CAAC,IAAI,CAAC,uBAAuB,EAAE,EAAE,SAAS,CAAC,CAAC;oBAChF,KAAK,+BAA+B;wBACnC,OAAO,IAAI,CAAC,oBAAoB,CAAC,GAAG,CAAC,IAAI,CAAC,wBAAwB,EAAE,EAAE,SAAS,CAAC,CAAC;oBAClF,KAAK,0BAA0B;wBAC9B,OAAO,IAAI,CAAC,eAAe,CAAC,GAAG,CAAC,IAAI,CAAC,mBAAmB,EAAE,EAAE,SAAS,CAAC,CAAC;oBACxE,KAAK,2BAA2B;wBAC/B,OAAO,IAAI,CAAC,gBAAgB,CAAC,GAAG,CAAC,IAAI,CAAC,oBAAoB,EAAE,EAAE,SAAS,CAAC,CAAC;gBAC3E,CAAC;YACF,CAAC;QACF,CAAC,CAAC,CAAC,CAAC;IACL,CAAC;IAED,gBAAgB;QACf,OAAO,IAAI,CAAC,cAAc,CAAC,GAAG,CAAC,kBAAkB,kCAA0B,SAAS,CAAyB,CAAC;IAC/G,CAAC;IAED,iBAAiB,CAAC,KAA2B;QAC5C,IAAI,CAAC,cAAc,CAAC,KAAK,CAAC,kBAAkB,EAAE,KAAK,gEAAgD,CAAC;IACrG,CAAC;IAEO,eAAe;QACtB,IAAI,MAAgC,CAAC;QACrC,IAAI,CAAC;YACJ,MAAM,GAAG,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,cAAc,CAAC,GAAG,CAAC,qBAAqB,kCAA0B,IAAI,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,UAA4C,EAAE,EAAE;gBACtJ,UAAU,CAAC,GAAG,GAAG,GAAG,CAAC,MAAM,CAAC,UAAU,CAAC,GAAG,CAAC,CAAC;gBAC5C,OAAO,IAAI,UAAU,CAAC,UAAU,EAAE,IAAI,CAAC,eAAe,EAAE,IAAI,CAAC,kBAAkB,EAAE,IAAI,CAAC,UAAU,EAAE,UAAU,CAAC,EAAE,CAAC,CAAC;YAClH,CAAC,CAAC,CAAC;QACJ,CAAC;QAAC,OAAO,CAAC,EAAE,CAAC,CAAC,CAAC;QAEf,OAAO,MAAM,IAAI,EAAE,CAAC;IACrB,CAAC;IAEO,uBAAuB;QAC9B,IAAI,MAAwC,CAAC;QAC7C,IAAI,CAAC;YACJ,MAAM,GAAG,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,cAAc,CAAC,GAAG,CAAC,8BAA8B,kCAA0B,IAAI,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,EAA4C,EAAE,EAAE;gBAC/J,OAAO,IAAI,kBAAkB,CAAC,EAAE,EAAE,EAAE,CAAC,EAAE,CAAC,CAAC;YAC1C,CAAC,CAAC,CAAC;QACJ,CAAC;QAAC,OAAO,CAAC,EAAE,CAAC,CAAC,CAAC;QAEf,OAAO,MAAM,IAAI,EAAE,CAAC;IACrB,CAAC;IAEO,wBAAwB;QAC/B,IAAI,MAAyC,CAAC;QAC9C,IAAI,CAAC;YACJ,MAAM,GAAG,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,cAAc,CAAC,GAAG,CAAC,+BAA+B,kCAA0B,IAAI,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,YAAuD,EAAE,EAAE;gBAC3K,OAAO,IAAI,mBAAmB,CAAC,YAAY,EAAE,YAAY,CAAC,EAAE,CAAC,CAAC;YAC/D,CAAC,CAAC,CAAC;QACJ,CAAC;QAAC,OAAO,CAAC,EAAE,CAAC,CAAC,CAAC;QAEf,OAAO,MAAM,IAAI,EAAE,CAAC;IACrB,CAAC;IAEO,mBAAmB;QAC1B,IAAI,MAAoC,CAAC;QACzC,IAAI,CAAC;YACJ,MAAM,GAAG,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,cAAc,CAAC,GAAG,CAAC,0BAA0B,kCAA0B,IAAI,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,GAAyC,EAAE,EAAE;gBACxJ,OAAO,IAAI,cAAc,CAAC,GAAG,EAAE,GAAG,CAAC,EAAE,CAAC,CAAC;YACxC,CAAC,CAAC,CAAC;QACJ,CAAC;QAAC,OAAO,CAAC,EAAE,CAAC,CAAC,CAAC;QAEf,OAAO,MAAM,IAAI,EAAE,CAAC;IACrB,CAAC;IAEO,oBAAoB;QAC3B,IAAI,MAAgC,CAAC;QACrC,IAAI,CAAC;YACJ,MAAM,GAAG,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,cAAc,CAAC,GAAG,CAAC,2BAA2B,kCAA0B,IAAI,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,eAA6C,EAAE,EAAE;gBAC7J,OAAO,IAAI,UAAU,CAAC,eAAe,CAAC,IAAI,EAAE,eAAe,CAAC,EAAE,CAAC,CAAC;YACjE,CAAC,CAAC,CAAC;QACJ,CAAC;QAAC,OAAO,CAAC,EAAE,CAAC,CAAC,CAAC;QAEf,OAAO,MAAM,IAAI,EAAE,CAAC;IACrB,CAAC;IAED,sBAAsB;QACrB,MAAM,GAAG,GAAG,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,cAAc,CAAC,GAAG,CAAC,6BAA6B,kCAA0B,IAAI,CAAC,CAAC,CAAC;QAC7G,+CAA+C;QAC/C,OAAO,SAAS,CAAC,GAAG,EAAE,CAAC,KAAK,EAAsB,EAAE,CAAC,OAAO,KAAK,KAAK,QAAQ,CAAC,CAAC,CAAC,EAAE,IAAI,EAAE,KAAK,EAAE,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC;IAC3G,CAAC;IAED,uBAAuB,CAAC,YAAgD;QACvE,IAAI,CAAC,cAAc,CAAC,KAAK,CAAC,6BAA6B,EAAE,IAAI,CAAC,SAAS,CAAC,YAAY,CAAC,gEAAgD,CAAC;IACvI,CAAC;IAED,qBAAqB,CAAC,gBAA6C;QAClE,IAAI,gBAAgB,CAAC,MAAM,EAAE,CAAC;YAC7B,IAAI,CAAC,cAAc,CAAC,KAAK,CAAC,2BAA2B,EAAE,IAAI,CAAC,SAAS,CAAC,gBAAgB,CAAC,GAAG,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,EAAE,IAAI,EAAE,EAAE,CAAC,IAAI,EAAE,EAAE,EAAE,EAAE,CAAC,KAAK,EAAE,EAAE,CAAC,CAAC,CAAC,gEAAgD,CAAC;QACxL,CAAC;aAAM,CAAC;YACP,IAAI,CAAC,cAAc,CAAC,MAAM,CAAC,2BAA2B,iCAAyB,CAAC;QACjF,CAAC;IACF,CAAC;IAED,gBAAgB,CAAC,UAAuB;QACvC,MAAM,WAAW,GAAG,UAAU,CAAC,cAAc,EAAE,CAAC;QAChD,IAAI,WAAW,CAAC,MAAM,EAAE,CAAC;YACxB,IAAI,CAAC,cAAc,CAAC,KAAK,CAAC,qBAAqB,EAAE,IAAI,CAAC,SAAS,CAAC,WAAW,CAAC,gEAAgD,CAAC;QAC9H,CAAC;aAAM,CAAC;YACP,IAAI,CAAC,cAAc,CAAC,MAAM,CAAC,qBAAqB,iCAAyB,CAAC;QAC3E,CAAC;QAED,MAAM,mBAAmB,GAAG,UAAU,CAAC,sBAAsB,EAAE,CAAC;QAChE,IAAI,mBAAmB,CAAC,MAAM,EAAE,CAAC;YAChC,IAAI,CAAC,cAAc,CAAC,KAAK,CAAC,8BAA8B,EAAE,IAAI,CAAC,SAAS,CAAC,mBAAmB,CAAC,gEAAgD,CAAC;QAC/I,CAAC;aAAM,CAAC;YACP,IAAI,CAAC,cAAc,CAAC,MAAM,CAAC,8BAA8B,iCAAyB,CAAC;QACpF,CAAC;QAED,MAAM,eAAe,GAAG,UAAU,CAAC,kBAAkB,EAAE,CAAC,MAAM,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,CAAC,UAAU,CAAC,CAAC;QACtF,IAAI,eAAe,CAAC,MAAM,EAAE,CAAC;YAC5B,IAAI,CAAC,cAAc,CAAC,KAAK,CAAC,0BAA0B,EAAE,IAAI,CAAC,SAAS,CAAC,eAAe,CAAC,gEAAgD,CAAC;QACvI,CAAC;aAAM,CAAC;YACP,IAAI,CAAC,cAAc,CAAC,MAAM,CAAC,0BAA0B,iCAAyB,CAAC;QAChF,CAAC;QAED,MAAM,oBAAoB,GAAG,UAAU,CAAC,uBAAuB,EAAE,CAAC;QAClE,IAAI,oBAAoB,CAAC,MAAM,EAAE,CAAC;YACjC,IAAI,CAAC,cAAc,CAAC,KAAK,CAAC,+BAA+B,EAAE,IAAI,CAAC,SAAS,CAAC,oBAAoB,CAAC,gEAAgD,CAAC;QACjJ,CAAC;aAAM,CAAC;YACP,IAAI,CAAC,cAAc,CAAC,MAAM,CAAC,+BAA+B,iCAAyB,CAAC;QACrF,CAAC;IACF,CAAC;CACD,CAAA;AArJY,YAAY;IAQtB,WAAA,eAAe,CAAA;IACf,WAAA,gBAAgB,CAAA;IAChB,WAAA,mBAAmB,CAAA;IACnB,WAAA,WAAW,CAAA;GAXD,YAAY,CAqJxB","file":"debugStorage.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Disposable } from '../../../../base/common/lifecycle.js';\nimport { ISettableObservable, observableValue } from '../../../../base/common/observable.js';\nimport { URI } from '../../../../base/common/uri.js';\nimport { ILogService } from '../../../../platform/log/common/log.js';\nimport { IStorageService, StorageScope, StorageTarget } from '../../../../platform/storage/common/storage.js';\nimport { IUriIdentityService } from '../../../../platform/uriIdentity/common/uriIdentity.js';\nimport { IDebugModel, IEvaluate, IExpression } from './debug.js';\nimport { Breakpoint, DataBreakpoint, ExceptionBreakpoint, Expression, FunctionBreakpoint } from './debugModel.js';\nimport { ITextFileService } from '../../../services/textfile/common/textfiles.js';\nimport { mapValues } from '../../../../base/common/objects.js';\n\nconst DEBUG_BREAKPOINTS_KEY = 'debug.breakpoint';\nconst DEBUG_FUNCTION_BREAKPOINTS_KEY = 'debug.functionbreakpoint';\nconst DEBUG_DATA_BREAKPOINTS_KEY = 'debug.databreakpoint';\nconst DEBUG_EXCEPTION_BREAKPOINTS_KEY = 'debug.exceptionbreakpoint';\nconst DEBUG_WATCH_EXPRESSIONS_KEY = 'debug.watchexpressions';\nconst DEBUG_CHOSEN_ENVIRONMENTS_KEY = 'debug.chosenenvironment';\nconst DEBUG_UX_STATE_KEY = 'debug.uxstate';\n\nexport interface IChosenEnvironment {\n\ttype: string;\n\tdynamicLabel?: string;\n}\n\nexport class DebugStorage extends Disposable {\n\tpublic readonly breakpoints: ISettableObservable<Breakpoint[]>;\n\tpublic readonly functionBreakpoints: ISettableObservable<FunctionBreakpoint[]>;\n\tpublic readonly exceptionBreakpoints: ISettableObservable<ExceptionBreakpoint[]>;\n\tpublic readonly dataBreakpoints: ISettableObservable<DataBreakpoint[]>;\n\tpublic readonly watchExpressions: ISettableObservable<Expression[]>;\n\n\tconstructor(\n\t\t@IStorageService private readonly storageService: IStorageService,\n\t\t@ITextFileService private readonly textFileService: ITextFileService,\n\t\t@IUriIdentityService private readonly uriIdentityService: IUriIdentityService,\n\t\t@ILogService private readonly logService: ILogService\n\t) {\n\t\tsuper();\n\t\tthis.breakpoints = observableValue(this, this.loadBreakpoints());\n\t\tthis.functionBreakpoints = observableValue(this, this.loadFunctionBreakpoints());\n\t\tthis.exceptionBreakpoints = observableValue(this, this.loadExceptionBreakpoints());\n\t\tthis.dataBreakpoints = observableValue(this, this.loadDataBreakpoints());\n\t\tthis.watchExpressions = observableValue(this, this.loadWatchExpressions());\n\n\t\tthis._register(storageService.onDidChangeValue(StorageScope.WORKSPACE, undefined, this._store)(e => {\n\t\t\tif (e.external) {\n\t\t\t\tswitch (e.key) {\n\t\t\t\t\tcase DEBUG_BREAKPOINTS_KEY:\n\t\t\t\t\t\treturn this.breakpoints.set(this.loadBreakpoints(), undefined);\n\t\t\t\t\tcase DEBUG_FUNCTION_BREAKPOINTS_KEY:\n\t\t\t\t\t\treturn this.functionBreakpoints.set(this.loadFunctionBreakpoints(), undefined);\n\t\t\t\t\tcase DEBUG_EXCEPTION_BREAKPOINTS_KEY:\n\t\t\t\t\t\treturn this.exceptionBreakpoints.set(this.loadExceptionBreakpoints(), undefined);\n\t\t\t\t\tcase DEBUG_DATA_BREAKPOINTS_KEY:\n\t\t\t\t\t\treturn this.dataBreakpoints.set(this.loadDataBreakpoints(), undefined);\n\t\t\t\t\tcase DEBUG_WATCH_EXPRESSIONS_KEY:\n\t\t\t\t\t\treturn this.watchExpressions.set(this.loadWatchExpressions(), undefined);\n\t\t\t\t}\n\t\t\t}\n\t\t}));\n\t}\n\n\tloadDebugUxState(): 'simple' | 'default' {\n\t\treturn this.storageService.get(DEBUG_UX_STATE_KEY, StorageScope.WORKSPACE, 'default') as 'simple' | 'default';\n\t}\n\n\tstoreDebugUxState(value: 'simple' | 'default'): void {\n\t\tthis.storageService.store(DEBUG_UX_STATE_KEY, value, StorageScope.WORKSPACE, StorageTarget.MACHINE);\n\t}\n\n\tprivate loadBreakpoints(): Breakpoint[] {\n\t\tlet result: Breakpoint[] | undefined;\n\t\ttry {\n\t\t\tresult = JSON.parse(this.storageService.get(DEBUG_BREAKPOINTS_KEY, StorageScope.WORKSPACE, '[]')).map((breakpoint: ReturnType<Breakpoint['toJSON']>) => {\n\t\t\t\tbreakpoint.uri = URI.revive(breakpoint.uri);\n\t\t\t\treturn new Breakpoint(breakpoint, this.textFileService, this.uriIdentityService, this.logService, breakpoint.id);\n\t\t\t});\n\t\t} catch (e) { }\n\n\t\treturn result || [];\n\t}\n\n\tprivate loadFunctionBreakpoints(): FunctionBreakpoint[] {\n\t\tlet result: FunctionBreakpoint[] | undefined;\n\t\ttry {\n\t\t\tresult = JSON.parse(this.storageService.get(DEBUG_FUNCTION_BREAKPOINTS_KEY, StorageScope.WORKSPACE, '[]')).map((fb: ReturnType<FunctionBreakpoint['toJSON']>) => {\n\t\t\t\treturn new FunctionBreakpoint(fb, fb.id);\n\t\t\t});\n\t\t} catch (e) { }\n\n\t\treturn result || [];\n\t}\n\n\tprivate loadExceptionBreakpoints(): ExceptionBreakpoint[] {\n\t\tlet result: ExceptionBreakpoint[] | undefined;\n\t\ttry {\n\t\t\tresult = JSON.parse(this.storageService.get(DEBUG_EXCEPTION_BREAKPOINTS_KEY, StorageScope.WORKSPACE, '[]')).map((exBreakpoint: ReturnType<ExceptionBreakpoint['toJSON']>) => {\n\t\t\t\treturn new ExceptionBreakpoint(exBreakpoint, exBreakpoint.id);\n\t\t\t});\n\t\t} catch (e) { }\n\n\t\treturn result || [];\n\t}\n\n\tprivate loadDataBreakpoints(): DataBreakpoint[] {\n\t\tlet result: DataBreakpoint[] | undefined;\n\t\ttry {\n\t\t\tresult = JSON.parse(this.storageService.get(DEBUG_DATA_BREAKPOINTS_KEY, StorageScope.WORKSPACE, '[]')).map((dbp: ReturnType<DataBreakpoint['toJSON']>) => {\n\t\t\t\treturn new DataBreakpoint(dbp, dbp.id);\n\t\t\t});\n\t\t} catch (e) { }\n\n\t\treturn result || [];\n\t}\n\n\tprivate loadWatchExpressions(): Expression[] {\n\t\tlet result: Expression[] | undefined;\n\t\ttry {\n\t\t\tresult = JSON.parse(this.storageService.get(DEBUG_WATCH_EXPRESSIONS_KEY, StorageScope.WORKSPACE, '[]')).map((watchStoredData: { name: string; id: string }) => {\n\t\t\t\treturn new Expression(watchStoredData.name, watchStoredData.id);\n\t\t\t});\n\t\t} catch (e) { }\n\n\t\treturn result || [];\n\t}\n\n\tloadChosenEnvironments(): Record<string, IChosenEnvironment> {\n\t\tconst obj = JSON.parse(this.storageService.get(DEBUG_CHOSEN_ENVIRONMENTS_KEY, StorageScope.WORKSPACE, '{}'));\n\t\t// back compat from when this was a string map:\n\t\treturn mapValues(obj, (value): IChosenEnvironment => typeof value === 'string' ? { type: value } : value);\n\t}\n\n\tstoreChosenEnvironments(environments: Record<string, IChosenEnvironment>): void {\n\t\tthis.storageService.store(DEBUG_CHOSEN_ENVIRONMENTS_KEY, JSON.stringify(environments), StorageScope.WORKSPACE, StorageTarget.MACHINE);\n\t}\n\n\tstoreWatchExpressions(watchExpressions: (IExpression & IEvaluate)[]): void {\n\t\tif (watchExpressions.length) {\n\t\t\tthis.storageService.store(DEBUG_WATCH_EXPRESSIONS_KEY, JSON.stringify(watchExpressions.map(we => ({ name: we.name, id: we.getId() }))), StorageScope.WORKSPACE, StorageTarget.MACHINE);\n\t\t} else {\n\t\t\tthis.storageService.remove(DEBUG_WATCH_EXPRESSIONS_KEY, StorageScope.WORKSPACE);\n\t\t}\n\t}\n\n\tstoreBreakpoints(debugModel: IDebugModel): void {\n\t\tconst breakpoints = debugModel.getBreakpoints();\n\t\tif (breakpoints.length) {\n\t\t\tthis.storageService.store(DEBUG_BREAKPOINTS_KEY, JSON.stringify(breakpoints), StorageScope.WORKSPACE, StorageTarget.MACHINE);\n\t\t} else {\n\t\t\tthis.storageService.remove(DEBUG_BREAKPOINTS_KEY, StorageScope.WORKSPACE);\n\t\t}\n\n\t\tconst functionBreakpoints = debugModel.getFunctionBreakpoints();\n\t\tif (functionBreakpoints.length) {\n\t\t\tthis.storageService.store(DEBUG_FUNCTION_BREAKPOINTS_KEY, JSON.stringify(functionBreakpoints), StorageScope.WORKSPACE, StorageTarget.MACHINE);\n\t\t} else {\n\t\t\tthis.storageService.remove(DEBUG_FUNCTION_BREAKPOINTS_KEY, StorageScope.WORKSPACE);\n\t\t}\n\n\t\tconst dataBreakpoints = debugModel.getDataBreakpoints().filter(dbp => dbp.canPersist);\n\t\tif (dataBreakpoints.length) {\n\t\t\tthis.storageService.store(DEBUG_DATA_BREAKPOINTS_KEY, JSON.stringify(dataBreakpoints), StorageScope.WORKSPACE, StorageTarget.MACHINE);\n\t\t} else {\n\t\t\tthis.storageService.remove(DEBUG_DATA_BREAKPOINTS_KEY, StorageScope.WORKSPACE);\n\t\t}\n\n\t\tconst exceptionBreakpoints = debugModel.getExceptionBreakpoints();\n\t\tif (exceptionBreakpoints.length) {\n\t\t\tthis.storageService.store(DEBUG_EXCEPTION_BREAKPOINTS_KEY, JSON.stringify(exceptionBreakpoints), StorageScope.WORKSPACE, StorageTarget.MACHINE);\n\t\t} else {\n\t\t\tthis.storageService.remove(DEBUG_EXCEPTION_BREAKPOINTS_KEY, StorageScope.WORKSPACE);\n\t\t}\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Disposable } from '../../../../base/common/lifecycle.js';\nimport { ISettableObservable, observableValue } from '../../../../base/common/observable.js';\nimport { URI } from '../../../../base/common/uri.js';\nimport { ILogService } from '../../../../platform/log/common/log.js';\nimport { IStorageService, StorageScope, StorageTarget } from '../../../../platform/storage/common/storage.js';\nimport { IUriIdentityService } from '../../../../platform/uriIdentity/common/uriIdentity.js';\nimport { IDebugModel, IEvaluate, IExpression } from './debug.js';\nimport { Breakpoint, DataBreakpoint, ExceptionBreakpoint, Expression, FunctionBreakpoint } from './debugModel.js';\nimport { ITextFileService } from '../../../services/textfile/common/textfiles.js';\nimport { mapValues } from '../../../../base/common/objects.js';\n\nconst DEBUG_BREAKPOINTS_KEY = 'debug.breakpoint';\nconst DEBUG_FUNCTION_BREAKPOINTS_KEY = 'debug.functionbreakpoint';\nconst DEBUG_DATA_BREAKPOINTS_KEY = 'debug.databreakpoint';\nconst DEBUG_EXCEPTION_BREAKPOINTS_KEY = 'debug.exceptionbreakpoint';\nconst DEBUG_WATCH_EXPRESSIONS_KEY = 'debug.watchexpressions';\nconst DEBUG_CHOSEN_ENVIRONMENTS_KEY = 'debug.chosenenvironment';\nconst DEBUG_UX_STATE_KEY = 'debug.uxstate';\n\nexport interface IChosenEnvironment {\n\ttype: string;\n\tdynamicLabel?: string;\n}\n\nexport class DebugStorage extends Disposable {\n\tpublic readonly breakpoints: ISettableObservable<Breakpoint[]>;\n\tpublic readonly functionBreakpoints: ISettableObservable<FunctionBreakpoint[]>;\n\tpublic readonly exceptionBreakpoints: ISettableObservable<ExceptionBreakpoint[]>;\n\tpublic readonly dataBreakpoints: ISettableObservable<DataBreakpoint[]>;\n\tpublic readonly watchExpressions: ISettableObservable<Expression[]>;\n\n\tconstructor(\n\t\t@IStorageService private readonly storageService: IStorageService,\n\t\t@ITextFileService private readonly textFileService: ITextFileService,\n\t\t@IUriIdentityService private readonly uriIdentityService: IUriIdentityService,\n\t\t@ILogService private readonly logService: ILogService\n\t) {\n\t\tsuper();\n\t\tthis.breakpoints = observableValue(this, this.loadBreakpoints());\n\t\tthis.functionBreakpoints = observableValue(this, this.loadFunctionBreakpoints());\n\t\tthis.exceptionBreakpoints = observableValue(this, this.loadExceptionBreakpoints());\n\t\tthis.dataBreakpoints = observableValue(this, this.loadDataBreakpoints());\n\t\tthis.watchExpressions = observableValue(this, this.loadWatchExpressions());\n\n\t\tthis._register(storageService.onDidChangeValue(StorageScope.WORKSPACE, undefined, this._store)(e => {\n\t\t\tif (e.external) {\n\t\t\t\tswitch (e.key) {\n\t\t\t\t\tcase DEBUG_BREAKPOINTS_KEY:\n\t\t\t\t\t\treturn this.breakpoints.set(this.loadBreakpoints(), undefined);\n\t\t\t\t\tcase DEBUG_FUNCTION_BREAKPOINTS_KEY:\n\t\t\t\t\t\treturn this.functionBreakpoints.set(this.loadFunctionBreakpoints(), undefined);\n\t\t\t\t\tcase DEBUG_EXCEPTION_BREAKPOINTS_KEY:\n\t\t\t\t\t\treturn this.exceptionBreakpoints.set(this.loadExceptionBreakpoints(), undefined);\n\t\t\t\t\tcase DEBUG_DATA_BREAKPOINTS_KEY:\n\t\t\t\t\t\treturn this.dataBreakpoints.set(this.loadDataBreakpoints(), undefined);\n\t\t\t\t\tcase DEBUG_WATCH_EXPRESSIONS_KEY:\n\t\t\t\t\t\treturn this.watchExpressions.set(this.loadWatchExpressions(), undefined);\n\t\t\t\t}\n\t\t\t}\n\t\t}));\n\t}\n\n\tloadDebugUxState(): 'simple' | 'default' {\n\t\treturn this.storageService.get(DEBUG_UX_STATE_KEY, StorageScope.WORKSPACE, 'default') as 'simple' | 'default';\n\t}\n\n\tstoreDebugUxState(value: 'simple' | 'default'): void {\n\t\tthis.storageService.store(DEBUG_UX_STATE_KEY, value, StorageScope.WORKSPACE, StorageTarget.MACHINE);\n\t}\n\n\tprivate loadBreakpoints(): Breakpoint[] {\n\t\tlet result: Breakpoint[] | undefined;\n\t\ttry {\n\t\t\tresult = JSON.parse(this.storageService.get(DEBUG_BREAKPOINTS_KEY, StorageScope.WORKSPACE, '[]')).map((breakpoint: ReturnType<Breakpoint['toJSON']>) => {\n\t\t\t\tbreakpoint.uri = URI.revive(breakpoint.uri);\n\t\t\t\treturn new Breakpoint(breakpoint, this.textFileService, this.uriIdentityService, this.logService, breakpoint.id);\n\t\t\t});\n\t\t} catch (e) { }\n\n\t\treturn result || [];\n\t}\n\n\tprivate loadFunctionBreakpoints(): FunctionBreakpoint[] {\n\t\tlet result: FunctionBreakpoint[] | undefined;\n\t\ttry {\n\t\t\tresult = JSON.parse(this.storageService.get(DEBUG_FUNCTION_BREAKPOINTS_KEY, StorageScope.WORKSPACE, '[]')).map((fb: ReturnType<FunctionBreakpoint['toJSON']>) => {\n\t\t\t\treturn new FunctionBreakpoint(fb, fb.id);\n\t\t\t});\n\t\t} catch (e) { }\n\n\t\treturn result || [];\n\t}\n\n\tprivate loadExceptionBreakpoints(): ExceptionBreakpoint[] {\n\t\tlet result: ExceptionBreakpoint[] | undefined;\n\t\ttry {\n\t\t\tresult = JSON.parse(this.storageService.get(DEBUG_EXCEPTION_BREAKPOINTS_KEY, StorageScope.WORKSPACE, '[]')).map((exBreakpoint: ReturnType<ExceptionBreakpoint['toJSON']>) => {\n\t\t\t\treturn new ExceptionBreakpoint(exBreakpoint, exBreakpoint.id);\n\t\t\t});\n\t\t} catch (e) { }\n\n\t\treturn result || [];\n\t}\n\n\tprivate loadDataBreakpoints(): DataBreakpoint[] {\n\t\tlet result: DataBreakpoint[] | undefined;\n\t\ttry {\n\t\t\tresult = JSON.parse(this.storageService.get(DEBUG_DATA_BREAKPOINTS_KEY, StorageScope.WORKSPACE, '[]')).map((dbp: ReturnType<DataBreakpoint['toJSON']>) => {\n\t\t\t\treturn new DataBreakpoint(dbp, dbp.id);\n\t\t\t});\n\t\t} catch (e) { }\n\n\t\treturn result || [];\n\t}\n\n\tprivate loadWatchExpressions(): Expression[] {\n\t\tlet result: Expression[] | undefined;\n\t\ttry {\n\t\t\tresult = JSON.parse(this.storageService.get(DEBUG_WATCH_EXPRESSIONS_KEY, StorageScope.WORKSPACE, '[]')).map((watchStoredData: { name: string; id: string }) => {\n\t\t\t\treturn new Expression(watchStoredData.name, watchStoredData.id);\n\t\t\t});\n\t\t} catch (e) { }\n\n\t\treturn result || [];\n\t}\n\n\tloadChosenEnvironments(): Record<string, IChosenEnvironment> {\n\t\tconst obj = JSON.parse(this.storageService.get(DEBUG_CHOSEN_ENVIRONMENTS_KEY, StorageScope.WORKSPACE, '{}'));\n\t\t// back compat from when this was a string map:\n\t\treturn mapValues(obj, (value): IChosenEnvironment => typeof value === 'string' ? { type: value } : value);\n\t}\n\n\tstoreChosenEnvironments(environments: Record<string, IChosenEnvironment>): void {\n\t\tthis.storageService.store(DEBUG_CHOSEN_ENVIRONMENTS_KEY, JSON.stringify(environments), StorageScope.WORKSPACE, StorageTarget.MACHINE);\n\t}\n\n\tstoreWatchExpressions(watchExpressions: (IExpression & IEvaluate)[]): void {\n\t\tif (watchExpressions.length) {\n\t\t\tthis.storageService.store(DEBUG_WATCH_EXPRESSIONS_KEY, JSON.stringify(watchExpressions.map(we => ({ name: we.name, id: we.getId() }))), StorageScope.WORKSPACE, StorageTarget.MACHINE);\n\t\t} else {\n\t\t\tthis.storageService.remove(DEBUG_WATCH_EXPRESSIONS_KEY, StorageScope.WORKSPACE);\n\t\t}\n\t}\n\n\tstoreBreakpoints(debugModel: IDebugModel): void {\n\t\tconst breakpoints = debugModel.getBreakpoints();\n\t\tif (breakpoints.length) {\n\t\t\tthis.storageService.store(DEBUG_BREAKPOINTS_KEY, JSON.stringify(breakpoints), StorageScope.WORKSPACE, StorageTarget.MACHINE);\n\t\t} else {\n\t\t\tthis.storageService.remove(DEBUG_BREAKPOINTS_KEY, StorageScope.WORKSPACE);\n\t\t}\n\n\t\tconst functionBreakpoints = debugModel.getFunctionBreakpoints();\n\t\tif (functionBreakpoints.length) {\n\t\t\tthis.storageService.store(DEBUG_FUNCTION_BREAKPOINTS_KEY, JSON.stringify(functionBreakpoints), StorageScope.WORKSPACE, StorageTarget.MACHINE);\n\t\t} else {\n\t\t\tthis.storageService.remove(DEBUG_FUNCTION_BREAKPOINTS_KEY, StorageScope.WORKSPACE);\n\t\t}\n\n\t\tconst dataBreakpoints = debugModel.getDataBreakpoints().filter(dbp => dbp.canPersist);\n\t\tif (dataBreakpoints.length) {\n\t\t\tthis.storageService.store(DEBUG_DATA_BREAKPOINTS_KEY, JSON.stringify(dataBreakpoints), StorageScope.WORKSPACE, StorageTarget.MACHINE);\n\t\t} else {\n\t\t\tthis.storageService.remove(DEBUG_DATA_BREAKPOINTS_KEY, StorageScope.WORKSPACE);\n\t\t}\n\n\t\tconst exceptionBreakpoints = debugModel.getExceptionBreakpoints();\n\t\tif (exceptionBreakpoints.length) {\n\t\t\tthis.storageService.store(DEBUG_EXCEPTION_BREAKPOINTS_KEY, JSON.stringify(exceptionBreakpoints), StorageScope.WORKSPACE, StorageTarget.MACHINE);\n\t\t} else {\n\t\t\tthis.storageService.remove(DEBUG_EXCEPTION_BREAKPOINTS_KEY, StorageScope.WORKSPACE);\n\t\t}\n\t}\n}\n"]}