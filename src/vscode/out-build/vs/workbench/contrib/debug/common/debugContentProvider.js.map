{"version":3,"sources":["vs/workbench/contrib/debug/common/debugContentProvider.ts"],"names":[],"mappings":"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","file":"debugContentProvider.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { URI as uri } from '../../../../base/common/uri.js';\nimport { localize } from '../../../../nls.js';\nimport { getMimeTypes } from '../../../../editor/common/services/languagesAssociations.js';\nimport { ITextModel } from '../../../../editor/common/model.js';\nimport { IModelService } from '../../../../editor/common/services/model.js';\nimport { ILanguageService } from '../../../../editor/common/languages/language.js';\nimport { ITextModelService, ITextModelContentProvider } from '../../../../editor/common/services/resolverService.js';\nimport { IWorkbenchContribution } from '../../../common/contributions.js';\nimport { DEBUG_SCHEME, IDebugService, IDebugSession } from './debug.js';\nimport { Source } from './debugSource.js';\nimport { IEditorWorkerService } from '../../../../editor/common/services/editorWorker.js';\nimport { EditOperation } from '../../../../editor/common/core/editOperation.js';\nimport { Range } from '../../../../editor/common/core/range.js';\nimport { CancellationTokenSource } from '../../../../base/common/cancellation.js';\nimport { PLAINTEXT_LANGUAGE_ID } from '../../../../editor/common/languages/modesRegistry.js';\nimport { ErrorNoTelemetry } from '../../../../base/common/errors.js';\nimport { Disposable } from '../../../../base/common/lifecycle.js';\n\n/**\n * Debug URI format\n *\n * a debug URI represents a Source object and the debug session where the Source comes from.\n *\n *       debug:arbitrary_path?session=123e4567-e89b-12d3-a456-426655440000&ref=1016\n *       \\___/ \\____________/ \\__________________________________________/ \\______/\n *         |          |                             |                          |\n *      scheme   source.path                    session id            source.reference\n *\n * the arbitrary_path and the session id are encoded with 'encodeURIComponent'\n *\n */\nexport class DebugContentProvider extends Disposable implements IWorkbenchContribution, ITextModelContentProvider {\n\n\tprivate static INSTANCE: DebugContentProvider;\n\n\tprivate readonly pendingUpdates = new Map<string, CancellationTokenSource>();\n\n\tconstructor(\n\t\t@ITextModelService textModelResolverService: ITextModelService,\n\t\t@IDebugService private readonly debugService: IDebugService,\n\t\t@IModelService private readonly modelService: IModelService,\n\t\t@ILanguageService private readonly languageService: ILanguageService,\n\t\t@IEditorWorkerService private readonly editorWorkerService: IEditorWorkerService\n\t) {\n\t\tsuper();\n\t\tthis._store.add(textModelResolverService.registerTextModelContentProvider(DEBUG_SCHEME, this));\n\t\tDebugContentProvider.INSTANCE = this;\n\t}\n\n\toverride dispose(): void {\n\t\tthis.pendingUpdates.forEach(cancellationSource => cancellationSource.dispose());\n\t\tsuper.dispose();\n\t}\n\n\tprovideTextContent(resource: uri): Promise<ITextModel> | null {\n\t\treturn this.createOrUpdateContentModel(resource, true);\n\t}\n\n\t/**\n\t * Reload the model content of the given resource.\n\t * If there is no model for the given resource, this method does nothing.\n\t */\n\tstatic refreshDebugContent(resource: uri): void {\n\t\tDebugContentProvider.INSTANCE?.createOrUpdateContentModel(resource, false);\n\t}\n\n\t/**\n\t * Create or reload the model content of the given resource.\n\t */\n\tprivate createOrUpdateContentModel(resource: uri, createIfNotExists: boolean): Promise<ITextModel> | null {\n\n\t\tconst model = this.modelService.getModel(resource);\n\t\tif (!model && !createIfNotExists) {\n\t\t\t// nothing to do\n\t\t\treturn null;\n\t\t}\n\n\t\tlet session: IDebugSession | undefined;\n\n\t\tif (resource.query) {\n\t\t\tconst data = Source.getEncodedDebugData(resource);\n\t\t\tsession = this.debugService.getModel().getSession(data.sessionId);\n\t\t}\n\n\t\tif (!session) {\n\t\t\t// fallback: use focused session\n\t\t\tsession = this.debugService.getViewModel().focusedSession;\n\t\t}\n\n\t\tif (!session) {\n\t\t\treturn Promise.reject(new ErrorNoTelemetry(localize('unable', \"Unable to resolve the resource without a debug session\")));\n\t\t}\n\t\tconst createErrModel = (errMsg?: string) => {\n\t\t\tthis.debugService.sourceIsNotAvailable(resource);\n\t\t\tconst languageSelection = this.languageService.createById(PLAINTEXT_LANGUAGE_ID);\n\t\t\tconst message = errMsg\n\t\t\t\t? localize('canNotResolveSourceWithError', \"Could not load source '{0}': {1}.\", resource.path, errMsg)\n\t\t\t\t: localize('canNotResolveSource', \"Could not load source '{0}'.\", resource.path);\n\t\t\treturn this.modelService.createModel(message, languageSelection, resource);\n\t\t};\n\n\t\treturn session.loadSource(resource).then(response => {\n\n\t\t\tif (response && response.body) {\n\n\t\t\t\tif (model) {\n\n\t\t\t\t\tconst newContent = response.body.content;\n\n\t\t\t\t\t// cancel and dispose an existing update\n\t\t\t\t\tconst cancellationSource = this.pendingUpdates.get(model.id);\n\t\t\t\t\tcancellationSource?.cancel();\n\n\t\t\t\t\t// create and keep update token\n\t\t\t\t\tconst myToken = new CancellationTokenSource();\n\t\t\t\t\tthis.pendingUpdates.set(model.id, myToken);\n\n\t\t\t\t\t// update text model\n\t\t\t\t\treturn this.editorWorkerService.computeMoreMinimalEdits(model.uri, [{ text: newContent, range: model.getFullModelRange() }]).then(edits => {\n\n\t\t\t\t\t\t// remove token\n\t\t\t\t\t\tthis.pendingUpdates.delete(model.id);\n\n\t\t\t\t\t\tif (!myToken.token.isCancellationRequested && edits && edits.length > 0) {\n\t\t\t\t\t\t\t// use the evil-edit as these models show in readonly-editor only\n\t\t\t\t\t\t\tmodel.applyEdits(edits.map(edit => EditOperation.replace(Range.lift(edit.range), edit.text)));\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn model;\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\t// create text model\n\t\t\t\t\tconst mime = response.body.mimeType || getMimeTypes(resource)[0];\n\t\t\t\t\tconst languageSelection = this.languageService.createByMimeType(mime);\n\t\t\t\t\treturn this.modelService.createModel(response.body.content, languageSelection, resource);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn createErrModel();\n\n\t\t}, (err: DebugProtocol.ErrorResponse) => createErrModel(err.message));\n\t}\n}\n"]}