{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/contrib/debug/browser/replAccessibleView.ts","vs/workbench/contrib/debug/browser/replAccessibleView.ts"],"names":[],"mappings":"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","file":"replAccessibleView.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { AccessibleViewProviderId, AccessibleViewType, IAccessibleViewContentProvider, IAccessibleViewService } from '../../../../platform/accessibility/browser/accessibleView.js';\nimport { AccessibilityVerbositySettingId } from '../../accessibility/browser/accessibilityConfiguration.js';\nimport { IReplElement } from '../common/debug.js';\nimport { IAccessibleViewImplementation } from '../../../../platform/accessibility/browser/accessibleViewRegistry.js';\nimport { ServicesAccessor } from '../../../../platform/instantiation/common/instantiation.js';\nimport { getReplView, Repl } from './repl.js';\nimport { IViewsService } from '../../../services/views/common/viewsService.js';\nimport { ContextKeyExpr } from '../../../../platform/contextkey/common/contextkey.js';\nimport { Emitter, Event } from '../../../../base/common/event.js';\nimport { Disposable } from '../../../../base/common/lifecycle.js';\nimport { Position } from '../../../../editor/common/core/position.js';\n\nexport class ReplAccessibleView implements IAccessibleViewImplementation {\n\tpriority = 70;\n\tname = 'debugConsole';\n\twhen = ContextKeyExpr.equals('focusedView', 'workbench.panel.repl.view');\n\ttype: AccessibleViewType = AccessibleViewType.View;\n\tgetProvider(accessor: ServicesAccessor) {\n\t\tconst viewsService = accessor.get(IViewsService);\n\t\tconst accessibleViewService = accessor.get(IAccessibleViewService);\n\t\tconst replView = getReplView(viewsService);\n\t\tif (!replView) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\tconst focusedElement = replView.getFocusedElement();\n\t\treturn new ReplOutputAccessibleViewProvider(replView, focusedElement, accessibleViewService);\n\t}\n}\n\nclass ReplOutputAccessibleViewProvider extends Disposable implements IAccessibleViewContentProvider {\n\tpublic readonly id = AccessibleViewProviderId.Repl;\n\tprivate _content: string | undefined;\n\tprivate readonly _onDidChangeContent: Emitter<void> = this._register(new Emitter<void>());\n\tpublic readonly onDidChangeContent: Event<void> = this._onDidChangeContent.event;\n\tprivate readonly _onDidResolveChildren: Emitter<void> = this._register(new Emitter<void>());\n\tpublic readonly onDidResolveChildren: Event<void> = this._onDidResolveChildren.event;\n\n\tpublic readonly verbositySettingKey = AccessibilityVerbositySettingId.Debug;\n\tpublic readonly options = {\n\t\ttype: AccessibleViewType.View\n\t};\n\n\tprivate _elementPositionMap: Map<string, Position> = new Map<string, Position>();\n\tprivate _treeHadFocus = false;\n\n\tconstructor(\n\t\tprivate readonly _replView: Repl,\n\t\tprivate readonly _focusedElement: IReplElement | undefined,\n\t\t@IAccessibleViewService private readonly _accessibleViewService: IAccessibleViewService) {\n\t\tsuper();\n\t\tthis._treeHadFocus = !!_focusedElement;\n\t}\n\tpublic provideContent(): string {\n\t\tconst debugSession = this._replView.getDebugSession();\n\t\tif (!debugSession) {\n\t\t\treturn 'No debug session available.';\n\t\t}\n\t\tconst elements = debugSession.getReplElements();\n\t\tif (!elements.length) {\n\t\t\treturn 'No output in the debug console.';\n\t\t}\n\t\tif (!this._content) {\n\t\t\tthis._updateContent(elements);\n\t\t}\n\t\t// Content is loaded asynchronously, so we need to check if it's available or fallback to the elements that are already available.\n\t\treturn this._content ?? elements.map(e => e.toString(true)).join('\\n');\n\t}\n\n\tpublic onClose(): void {\n\t\tthis._content = undefined;\n\t\tthis._elementPositionMap.clear();\n\t\tif (this._treeHadFocus) {\n\t\t\treturn this._replView.focusTree();\n\t\t}\n\t\tthis._replView.getReplInput().focus();\n\t}\n\n\tpublic onOpen(): void {\n\t\t// Children are resolved async, so we need to update the content when they are resolved.\n\t\tthis._register(this.onDidResolveChildren(() => {\n\t\t\tthis._onDidChangeContent.fire();\n\t\t\tqueueMicrotask(() => {\n\t\t\t\tif (this._focusedElement) {\n\t\t\t\t\tconst position = this._elementPositionMap.get(this._focusedElement.getId());\n\t\t\t\t\tif (position) {\n\t\t\t\t\t\tthis._accessibleViewService.setPosition(position, true);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}));\n\t}\n\n\tprivate async _updateContent(elements: IReplElement[]) {\n\t\tconst dataSource = this._replView.getReplDataSource();\n\t\tif (!dataSource) {\n\t\t\treturn;\n\t\t}\n\t\tlet line = 1;\n\t\tconst content: string[] = [];\n\t\tfor (const e of elements) {\n\t\t\tcontent.push(e.toString().replace(/\\n/g, ''));\n\t\t\tthis._elementPositionMap.set(e.getId(), new Position(line, 1));\n\t\t\tline++;\n\t\t\tif (dataSource.hasChildren(e)) {\n\t\t\t\tconst childContent: string[] = [];\n\t\t\t\tconst children = await dataSource.getChildren(e);\n\t\t\t\tfor (const child of children) {\n\t\t\t\t\tconst id = child.getId();\n\t\t\t\t\tif (!this._elementPositionMap.has(id)) {\n\t\t\t\t\t\t// don't overwrite parent position\n\t\t\t\t\t\tthis._elementPositionMap.set(id, new Position(line, 1));\n\t\t\t\t\t}\n\t\t\t\t\tchildContent.push('  ' + child.toString());\n\t\t\t\t\tline++;\n\t\t\t\t}\n\t\t\t\tcontent.push(childContent.join('\\n'));\n\t\t\t}\n\t\t}\n\n\t\tthis._content = content.join('\\n');\n\t\tthis._onDidResolveChildren.fire();\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { AccessibleViewProviderId, AccessibleViewType, IAccessibleViewContentProvider, IAccessibleViewService } from '../../../../platform/accessibility/browser/accessibleView.js';\nimport { AccessibilityVerbositySettingId } from '../../accessibility/browser/accessibilityConfiguration.js';\nimport { IReplElement } from '../common/debug.js';\nimport { IAccessibleViewImplementation } from '../../../../platform/accessibility/browser/accessibleViewRegistry.js';\nimport { ServicesAccessor } from '../../../../platform/instantiation/common/instantiation.js';\nimport { getReplView, Repl } from './repl.js';\nimport { IViewsService } from '../../../services/views/common/viewsService.js';\nimport { ContextKeyExpr } from '../../../../platform/contextkey/common/contextkey.js';\nimport { Emitter, Event } from '../../../../base/common/event.js';\nimport { Disposable } from '../../../../base/common/lifecycle.js';\nimport { Position } from '../../../../editor/common/core/position.js';\n\nexport class ReplAccessibleView implements IAccessibleViewImplementation {\n\tpriority = 70;\n\tname = 'debugConsole';\n\twhen = ContextKeyExpr.equals('focusedView', 'workbench.panel.repl.view');\n\ttype: AccessibleViewType = AccessibleViewType.View;\n\tgetProvider(accessor: ServicesAccessor) {\n\t\tconst viewsService = accessor.get(IViewsService);\n\t\tconst accessibleViewService = accessor.get(IAccessibleViewService);\n\t\tconst replView = getReplView(viewsService);\n\t\tif (!replView) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\tconst focusedElement = replView.getFocusedElement();\n\t\treturn new ReplOutputAccessibleViewProvider(replView, focusedElement, accessibleViewService);\n\t}\n}\n\nclass ReplOutputAccessibleViewProvider extends Disposable implements IAccessibleViewContentProvider {\n\tpublic readonly id = AccessibleViewProviderId.Repl;\n\tprivate _content: string | undefined;\n\tprivate readonly _onDidChangeContent: Emitter<void> = this._register(new Emitter<void>());\n\tpublic readonly onDidChangeContent: Event<void> = this._onDidChangeContent.event;\n\tprivate readonly _onDidResolveChildren: Emitter<void> = this._register(new Emitter<void>());\n\tpublic readonly onDidResolveChildren: Event<void> = this._onDidResolveChildren.event;\n\n\tpublic readonly verbositySettingKey = AccessibilityVerbositySettingId.Debug;\n\tpublic readonly options = {\n\t\ttype: AccessibleViewType.View\n\t};\n\n\tprivate _elementPositionMap: Map<string, Position> = new Map<string, Position>();\n\tprivate _treeHadFocus = false;\n\n\tconstructor(\n\t\tprivate readonly _replView: Repl,\n\t\tprivate readonly _focusedElement: IReplElement | undefined,\n\t\t@IAccessibleViewService private readonly _accessibleViewService: IAccessibleViewService) {\n\t\tsuper();\n\t\tthis._treeHadFocus = !!_focusedElement;\n\t}\n\tpublic provideContent(): string {\n\t\tconst debugSession = this._replView.getDebugSession();\n\t\tif (!debugSession) {\n\t\t\treturn 'No debug session available.';\n\t\t}\n\t\tconst elements = debugSession.getReplElements();\n\t\tif (!elements.length) {\n\t\t\treturn 'No output in the debug console.';\n\t\t}\n\t\tif (!this._content) {\n\t\t\tthis._updateContent(elements);\n\t\t}\n\t\t// Content is loaded asynchronously, so we need to check if it's available or fallback to the elements that are already available.\n\t\treturn this._content ?? elements.map(e => e.toString(true)).join('\\n');\n\t}\n\n\tpublic onClose(): void {\n\t\tthis._content = undefined;\n\t\tthis._elementPositionMap.clear();\n\t\tif (this._treeHadFocus) {\n\t\t\treturn this._replView.focusTree();\n\t\t}\n\t\tthis._replView.getReplInput().focus();\n\t}\n\n\tpublic onOpen(): void {\n\t\t// Children are resolved async, so we need to update the content when they are resolved.\n\t\tthis._register(this.onDidResolveChildren(() => {\n\t\t\tthis._onDidChangeContent.fire();\n\t\t\tqueueMicrotask(() => {\n\t\t\t\tif (this._focusedElement) {\n\t\t\t\t\tconst position = this._elementPositionMap.get(this._focusedElement.getId());\n\t\t\t\t\tif (position) {\n\t\t\t\t\t\tthis._accessibleViewService.setPosition(position, true);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}));\n\t}\n\n\tprivate async _updateContent(elements: IReplElement[]) {\n\t\tconst dataSource = this._replView.getReplDataSource();\n\t\tif (!dataSource) {\n\t\t\treturn;\n\t\t}\n\t\tlet line = 1;\n\t\tconst content: string[] = [];\n\t\tfor (const e of elements) {\n\t\t\tcontent.push(e.toString().replace(/\\n/g, ''));\n\t\t\tthis._elementPositionMap.set(e.getId(), new Position(line, 1));\n\t\t\tline++;\n\t\t\tif (dataSource.hasChildren(e)) {\n\t\t\t\tconst childContent: string[] = [];\n\t\t\t\tconst children = await dataSource.getChildren(e);\n\t\t\t\tfor (const child of children) {\n\t\t\t\t\tconst id = child.getId();\n\t\t\t\t\tif (!this._elementPositionMap.has(id)) {\n\t\t\t\t\t\t// don't overwrite parent position\n\t\t\t\t\t\tthis._elementPositionMap.set(id, new Position(line, 1));\n\t\t\t\t\t}\n\t\t\t\t\tchildContent.push('  ' + child.toString());\n\t\t\t\t\tline++;\n\t\t\t\t}\n\t\t\t\tcontent.push(childContent.join('\\n'));\n\t\t\t}\n\t\t}\n\n\t\tthis._content = content.join('\\n');\n\t\tthis._onDidResolveChildren.fire();\n\t}\n}\n"]}