{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/contrib/timeline/common/timelineService.ts","vs/workbench/contrib/timeline/common/timelineService.ts"],"names":[],"mappings":"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","file":"timelineService.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { CancellationTokenSource } from '../../../../base/common/cancellation.js';\nimport { Emitter } from '../../../../base/common/event.js';\nimport { Disposable, DisposableMap, IDisposable } from '../../../../base/common/lifecycle.js';\nimport { URI } from '../../../../base/common/uri.js';\nimport { ILogService } from '../../../../platform/log/common/log.js';\nimport { ITimelineService, TimelineChangeEvent, TimelineOptions, TimelineProvidersChangeEvent, TimelineProvider, TimelinePaneId } from './timeline.js';\nimport { IViewsService } from '../../../services/views/common/viewsService.js';\nimport { IConfigurationService } from '../../../../platform/configuration/common/configuration.js';\nimport { IContextKey, IContextKeyService, RawContextKey } from '../../../../platform/contextkey/common/contextkey.js';\n\nexport const TimelineHasProviderContext = new RawContextKey<boolean>('timelineHasProvider', false);\n\nexport class TimelineService extends Disposable implements ITimelineService {\n\n\tdeclare readonly _serviceBrand: undefined;\n\n\tprivate readonly _onDidChangeProviders = this._register(new Emitter<TimelineProvidersChangeEvent>());\n\treadonly onDidChangeProviders = this._onDidChangeProviders.event;\n\n\tprivate readonly _onDidChangeTimeline = this._register(new Emitter<TimelineChangeEvent>());\n\treadonly onDidChangeTimeline = this._onDidChangeTimeline.event;\n\n\tprivate readonly _onDidChangeUri = this._register(new Emitter<URI>());\n\treadonly onDidChangeUri = this._onDidChangeUri.event;\n\n\tprivate readonly hasProviderContext: IContextKey<boolean>;\n\tprivate readonly providers = new Map<string, TimelineProvider>();\n\tprivate readonly providerSubscriptions = this._register(new DisposableMap<string>());\n\n\tconstructor(\n\t\t@ILogService private readonly logService: ILogService,\n\t\t@IViewsService protected viewsService: IViewsService,\n\t\t@IConfigurationService protected configurationService: IConfigurationService,\n\t\t@IContextKeyService protected contextKeyService: IContextKeyService,\n\t) {\n\t\tsuper();\n\n\t\tthis.hasProviderContext = TimelineHasProviderContext.bindTo(this.contextKeyService);\n\t\tthis.updateHasProviderContext();\n\t}\n\n\tgetSources() {\n\t\treturn [...this.providers.values()].map(p => ({ id: p.id, label: p.label }));\n\t}\n\n\tgetTimeline(id: string, uri: URI, options: TimelineOptions, tokenSource: CancellationTokenSource) {\n\t\tthis.logService.trace(`TimelineService#getTimeline(${id}): uri=${uri.toString()}`);\n\n\t\tconst provider = this.providers.get(id);\n\t\tif (provider === undefined) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\tif (typeof provider.scheme === 'string') {\n\t\t\tif (provider.scheme !== '*' && provider.scheme !== uri.scheme) {\n\t\t\t\treturn undefined;\n\t\t\t}\n\t\t} else if (!provider.scheme.includes(uri.scheme)) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\treturn {\n\t\t\tresult: provider.provideTimeline(uri, options, tokenSource.token)\n\t\t\t\t.then(result => {\n\t\t\t\t\tif (result === undefined) {\n\t\t\t\t\t\treturn undefined;\n\t\t\t\t\t}\n\n\t\t\t\t\tresult.items = result.items.map(item => ({ ...item, source: provider.id }));\n\t\t\t\t\tresult.items.sort((a, b) => (b.timestamp - a.timestamp) || b.source.localeCompare(a.source, undefined, { numeric: true, sensitivity: 'base' }));\n\n\t\t\t\t\treturn result;\n\t\t\t\t}),\n\t\t\toptions,\n\t\t\tsource: provider.id,\n\t\t\ttokenSource,\n\t\t\turi\n\t\t};\n\t}\n\n\tregisterTimelineProvider(provider: TimelineProvider): IDisposable {\n\t\tthis.logService.trace(`TimelineService#registerTimelineProvider: id=${provider.id}`);\n\n\t\tconst id = provider.id;\n\n\t\tconst existing = this.providers.get(id);\n\t\tif (existing) {\n\t\t\t// For now to deal with https://github.com/microsoft/vscode/issues/89553 allow any overwritting here (still will be blocked in the Extension Host)\n\t\t\t// TODO@eamodio: Ultimately will need to figure out a way to unregister providers when the Extension Host restarts/crashes\n\t\t\t// throw new Error(`Timeline Provider ${id} already exists.`);\n\t\t\ttry {\n\t\t\t\texisting?.dispose();\n\t\t\t}\n\t\t\tcatch { }\n\t\t}\n\n\t\tthis.providers.set(id, provider);\n\n\t\tthis.updateHasProviderContext();\n\n\t\tif (provider.onDidChange) {\n\t\t\tthis.providerSubscriptions.set(id, provider.onDidChange(e => this._onDidChangeTimeline.fire(e)));\n\t\t}\n\t\tthis._onDidChangeProviders.fire({ added: [id] });\n\n\t\treturn {\n\t\t\tdispose: () => {\n\t\t\t\tthis.providers.delete(id);\n\t\t\t\tthis._onDidChangeProviders.fire({ removed: [id] });\n\t\t\t}\n\t\t};\n\t}\n\n\tunregisterTimelineProvider(id: string): void {\n\t\tthis.logService.trace(`TimelineService#unregisterTimelineProvider: id=${id}`);\n\n\t\tif (!this.providers.has(id)) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.providers.delete(id);\n\t\tthis.providerSubscriptions.deleteAndDispose(id);\n\n\t\tthis.updateHasProviderContext();\n\n\t\tthis._onDidChangeProviders.fire({ removed: [id] });\n\t}\n\n\tsetUri(uri: URI) {\n\t\tthis.viewsService.openView(TimelinePaneId, true);\n\t\tthis._onDidChangeUri.fire(uri);\n\t}\n\n\tprivate updateHasProviderContext() {\n\t\tthis.hasProviderContext.set(this.providers.size !== 0);\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { CancellationTokenSource } from '../../../../base/common/cancellation.js';\nimport { Emitter } from '../../../../base/common/event.js';\nimport { Disposable, DisposableMap, IDisposable } from '../../../../base/common/lifecycle.js';\nimport { URI } from '../../../../base/common/uri.js';\nimport { ILogService } from '../../../../platform/log/common/log.js';\nimport { ITimelineService, TimelineChangeEvent, TimelineOptions, TimelineProvidersChangeEvent, TimelineProvider, TimelinePaneId } from './timeline.js';\nimport { IViewsService } from '../../../services/views/common/viewsService.js';\nimport { IConfigurationService } from '../../../../platform/configuration/common/configuration.js';\nimport { IContextKey, IContextKeyService, RawContextKey } from '../../../../platform/contextkey/common/contextkey.js';\n\nexport const TimelineHasProviderContext = new RawContextKey<boolean>('timelineHasProvider', false);\n\nexport class TimelineService extends Disposable implements ITimelineService {\n\n\tdeclare readonly _serviceBrand: undefined;\n\n\tprivate readonly _onDidChangeProviders = this._register(new Emitter<TimelineProvidersChangeEvent>());\n\treadonly onDidChangeProviders = this._onDidChangeProviders.event;\n\n\tprivate readonly _onDidChangeTimeline = this._register(new Emitter<TimelineChangeEvent>());\n\treadonly onDidChangeTimeline = this._onDidChangeTimeline.event;\n\n\tprivate readonly _onDidChangeUri = this._register(new Emitter<URI>());\n\treadonly onDidChangeUri = this._onDidChangeUri.event;\n\n\tprivate readonly hasProviderContext: IContextKey<boolean>;\n\tprivate readonly providers = new Map<string, TimelineProvider>();\n\tprivate readonly providerSubscriptions = this._register(new DisposableMap<string>());\n\n\tconstructor(\n\t\t@ILogService private readonly logService: ILogService,\n\t\t@IViewsService protected viewsService: IViewsService,\n\t\t@IConfigurationService protected configurationService: IConfigurationService,\n\t\t@IContextKeyService protected contextKeyService: IContextKeyService,\n\t) {\n\t\tsuper();\n\n\t\tthis.hasProviderContext = TimelineHasProviderContext.bindTo(this.contextKeyService);\n\t\tthis.updateHasProviderContext();\n\t}\n\n\tgetSources() {\n\t\treturn [...this.providers.values()].map(p => ({ id: p.id, label: p.label }));\n\t}\n\n\tgetTimeline(id: string, uri: URI, options: TimelineOptions, tokenSource: CancellationTokenSource) {\n\t\tthis.logService.trace(`TimelineService#getTimeline(${id}): uri=${uri.toString()}`);\n\n\t\tconst provider = this.providers.get(id);\n\t\tif (provider === undefined) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\tif (typeof provider.scheme === 'string') {\n\t\t\tif (provider.scheme !== '*' && provider.scheme !== uri.scheme) {\n\t\t\t\treturn undefined;\n\t\t\t}\n\t\t} else if (!provider.scheme.includes(uri.scheme)) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\treturn {\n\t\t\tresult: provider.provideTimeline(uri, options, tokenSource.token)\n\t\t\t\t.then(result => {\n\t\t\t\t\tif (result === undefined) {\n\t\t\t\t\t\treturn undefined;\n\t\t\t\t\t}\n\n\t\t\t\t\tresult.items = result.items.map(item => ({ ...item, source: provider.id }));\n\t\t\t\t\tresult.items.sort((a, b) => (b.timestamp - a.timestamp) || b.source.localeCompare(a.source, undefined, { numeric: true, sensitivity: 'base' }));\n\n\t\t\t\t\treturn result;\n\t\t\t\t}),\n\t\t\toptions,\n\t\t\tsource: provider.id,\n\t\t\ttokenSource,\n\t\t\turi\n\t\t};\n\t}\n\n\tregisterTimelineProvider(provider: TimelineProvider): IDisposable {\n\t\tthis.logService.trace(`TimelineService#registerTimelineProvider: id=${provider.id}`);\n\n\t\tconst id = provider.id;\n\n\t\tconst existing = this.providers.get(id);\n\t\tif (existing) {\n\t\t\t// For now to deal with https://github.com/microsoft/vscode/issues/89553 allow any overwritting here (still will be blocked in the Extension Host)\n\t\t\t// TODO@eamodio: Ultimately will need to figure out a way to unregister providers when the Extension Host restarts/crashes\n\t\t\t// throw new Error(`Timeline Provider ${id} already exists.`);\n\t\t\ttry {\n\t\t\t\texisting?.dispose();\n\t\t\t}\n\t\t\tcatch { }\n\t\t}\n\n\t\tthis.providers.set(id, provider);\n\n\t\tthis.updateHasProviderContext();\n\n\t\tif (provider.onDidChange) {\n\t\t\tthis.providerSubscriptions.set(id, provider.onDidChange(e => this._onDidChangeTimeline.fire(e)));\n\t\t}\n\t\tthis._onDidChangeProviders.fire({ added: [id] });\n\n\t\treturn {\n\t\t\tdispose: () => {\n\t\t\t\tthis.providers.delete(id);\n\t\t\t\tthis._onDidChangeProviders.fire({ removed: [id] });\n\t\t\t}\n\t\t};\n\t}\n\n\tunregisterTimelineProvider(id: string): void {\n\t\tthis.logService.trace(`TimelineService#unregisterTimelineProvider: id=${id}`);\n\n\t\tif (!this.providers.has(id)) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.providers.delete(id);\n\t\tthis.providerSubscriptions.deleteAndDispose(id);\n\n\t\tthis.updateHasProviderContext();\n\n\t\tthis._onDidChangeProviders.fire({ removed: [id] });\n\t}\n\n\tsetUri(uri: URI) {\n\t\tthis.viewsService.openView(TimelinePaneId, true);\n\t\tthis._onDidChangeUri.fire(uri);\n\t}\n\n\tprivate updateHasProviderContext() {\n\t\tthis.hasProviderContext.set(this.providers.size !== 0);\n\t}\n}\n"]}