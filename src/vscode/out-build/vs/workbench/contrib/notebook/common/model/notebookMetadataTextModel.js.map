{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/contrib/notebook/common/model/notebookMetadataTextModel.ts","vs/workbench/contrib/notebook/common/model/notebookMetadataTextModel.ts"],"names":[],"mappings":"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","file":"notebookMetadataTextModel.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { toFormattedString } from '../../../../../base/common/jsonFormatter.js';\nimport { INotebookDocumentMetadataTextModel, INotebookTextModel, NotebookCellMetadata, NotebookCellsChangeType, NotebookDocumentMetadata, NotebookMetadataUri, TransientDocumentMetadata } from '../notebookCommon.js';\nimport { StringSHA1 } from '../../../../../base/common/hash.js';\nimport { Disposable } from '../../../../../base/common/lifecycle.js';\nimport { URI } from '../../../../../base/common/uri.js';\nimport { DefaultEndOfLine, EndOfLinePreference, ITextBuffer } from '../../../../../editor/common/model.js';\nimport { Emitter } from '../../../../../base/common/event.js';\nimport { Range } from '../../../../../editor/common/core/range.js';\nimport { createTextBuffer } from '../../../../../editor/common/model/textModel.js';\n\nexport function getFormattedNotebookMetadataJSON(transientMetadata: TransientDocumentMetadata | undefined, metadata: NotebookDocumentMetadata) {\n\tlet filteredMetadata: { [key: string]: any } = {};\n\n\tif (transientMetadata) {\n\t\tconst keys = new Set([...Object.keys(metadata)]);\n\t\tfor (const key of keys) {\n\t\t\tif (!(transientMetadata[key as keyof NotebookCellMetadata])\n\t\t\t) {\n\t\t\t\tfilteredMetadata[key] = metadata[key as keyof NotebookCellMetadata];\n\t\t\t}\n\t\t}\n\t} else {\n\t\tfilteredMetadata = metadata;\n\t}\n\n\tconst metadataSource = toFormattedString(filteredMetadata, {});\n\n\treturn metadataSource;\n}\n\nexport class NotebookDocumentMetadataTextModel extends Disposable implements INotebookDocumentMetadataTextModel {\n\tpublic readonly uri: URI;\n\tpublic get metadata(): NotebookDocumentMetadata {\n\t\treturn this.notebookModel.metadata;\n\t}\n\tprivate readonly _onDidChange = this._register(new Emitter<void>());\n\tpublic readonly onDidChange = this._onDidChange.event;\n\n\tprivate _textBufferHash: string | null = null;\n\tprivate _textBuffer?: ITextBuffer;\n\tget textBuffer() {\n\t\tif (this._textBuffer) {\n\t\t\treturn this._textBuffer;\n\t\t}\n\n\t\tconst source = getFormattedNotebookMetadataJSON(this.notebookModel.transientOptions.transientDocumentMetadata, this.metadata);\n\t\tthis._textBuffer = this._register(createTextBuffer(source, DefaultEndOfLine.LF).textBuffer);\n\n\t\tthis._register(this._textBuffer.onDidChangeContent(() => {\n\t\t\tthis._onDidChange.fire();\n\t\t}));\n\n\t\treturn this._textBuffer;\n\t}\n\n\tconstructor(public readonly notebookModel: INotebookTextModel) {\n\t\tsuper();\n\t\tthis.uri = NotebookMetadataUri.generate(this.notebookModel.uri);\n\t\tthis._register(this.notebookModel.onDidChangeContent((e) => {\n\t\t\tif (e.rawEvents.some(event => event.kind === NotebookCellsChangeType.ChangeDocumentMetadata || event.kind === NotebookCellsChangeType.ModelChange)) {\n\t\t\t\tthis._textBuffer?.dispose();\n\t\t\t\tthis._textBuffer = undefined;\n\t\t\t\tthis._textBufferHash = null;\n\t\t\t\tthis._onDidChange.fire();\n\t\t\t}\n\t\t}));\n\t}\n\n\tgetHash() {\n\t\tif (this._textBufferHash !== null) {\n\t\t\treturn this._textBufferHash;\n\t\t}\n\n\t\tconst shaComputer = new StringSHA1();\n\t\tconst snapshot = this.textBuffer.createSnapshot(false);\n\t\tlet text: string | null;\n\t\twhile ((text = snapshot.read())) {\n\t\t\tshaComputer.update(text);\n\t\t}\n\t\tthis._textBufferHash = shaComputer.digest();\n\t\treturn this._textBufferHash;\n\t}\n\n\tpublic getValue() {\n\t\tconst fullRange = this.getFullModelRange();\n\t\tconst eol = this.textBuffer.getEOL();\n\t\tif (eol === '\\n') {\n\t\t\treturn this.textBuffer.getValueInRange(fullRange, EndOfLinePreference.LF);\n\t\t} else {\n\t\t\treturn this.textBuffer.getValueInRange(fullRange, EndOfLinePreference.CRLF);\n\t\t}\n\t}\n\tprivate getFullModelRange() {\n\t\tconst lineCount = this.textBuffer.getLineCount();\n\t\treturn new Range(1, 1, lineCount, this.textBuffer.getLineLength(lineCount) + 1);\n\t}\n\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { toFormattedString } from '../../../../../base/common/jsonFormatter.js';\nimport { INotebookDocumentMetadataTextModel, INotebookTextModel, NotebookCellMetadata, NotebookCellsChangeType, NotebookDocumentMetadata, NotebookMetadataUri, TransientDocumentMetadata } from '../notebookCommon.js';\nimport { StringSHA1 } from '../../../../../base/common/hash.js';\nimport { Disposable } from '../../../../../base/common/lifecycle.js';\nimport { URI } from '../../../../../base/common/uri.js';\nimport { DefaultEndOfLine, EndOfLinePreference, ITextBuffer } from '../../../../../editor/common/model.js';\nimport { Emitter } from '../../../../../base/common/event.js';\nimport { Range } from '../../../../../editor/common/core/range.js';\nimport { createTextBuffer } from '../../../../../editor/common/model/textModel.js';\n\nexport function getFormattedNotebookMetadataJSON(transientMetadata: TransientDocumentMetadata | undefined, metadata: NotebookDocumentMetadata) {\n\tlet filteredMetadata: { [key: string]: any } = {};\n\n\tif (transientMetadata) {\n\t\tconst keys = new Set([...Object.keys(metadata)]);\n\t\tfor (const key of keys) {\n\t\t\tif (!(transientMetadata[key as keyof NotebookCellMetadata])\n\t\t\t) {\n\t\t\t\tfilteredMetadata[key] = metadata[key as keyof NotebookCellMetadata];\n\t\t\t}\n\t\t}\n\t} else {\n\t\tfilteredMetadata = metadata;\n\t}\n\n\tconst metadataSource = toFormattedString(filteredMetadata, {});\n\n\treturn metadataSource;\n}\n\nexport class NotebookDocumentMetadataTextModel extends Disposable implements INotebookDocumentMetadataTextModel {\n\tpublic readonly uri: URI;\n\tpublic get metadata(): NotebookDocumentMetadata {\n\t\treturn this.notebookModel.metadata;\n\t}\n\tprivate readonly _onDidChange = this._register(new Emitter<void>());\n\tpublic readonly onDidChange = this._onDidChange.event;\n\n\tprivate _textBufferHash: string | null = null;\n\tprivate _textBuffer?: ITextBuffer;\n\tget textBuffer() {\n\t\tif (this._textBuffer) {\n\t\t\treturn this._textBuffer;\n\t\t}\n\n\t\tconst source = getFormattedNotebookMetadataJSON(this.notebookModel.transientOptions.transientDocumentMetadata, this.metadata);\n\t\tthis._textBuffer = this._register(createTextBuffer(source, DefaultEndOfLine.LF).textBuffer);\n\n\t\tthis._register(this._textBuffer.onDidChangeContent(() => {\n\t\t\tthis._onDidChange.fire();\n\t\t}));\n\n\t\treturn this._textBuffer;\n\t}\n\n\tconstructor(public readonly notebookModel: INotebookTextModel) {\n\t\tsuper();\n\t\tthis.uri = NotebookMetadataUri.generate(this.notebookModel.uri);\n\t\tthis._register(this.notebookModel.onDidChangeContent((e) => {\n\t\t\tif (e.rawEvents.some(event => event.kind === NotebookCellsChangeType.ChangeDocumentMetadata || event.kind === NotebookCellsChangeType.ModelChange)) {\n\t\t\t\tthis._textBuffer?.dispose();\n\t\t\t\tthis._textBuffer = undefined;\n\t\t\t\tthis._textBufferHash = null;\n\t\t\t\tthis._onDidChange.fire();\n\t\t\t}\n\t\t}));\n\t}\n\n\tgetHash() {\n\t\tif (this._textBufferHash !== null) {\n\t\t\treturn this._textBufferHash;\n\t\t}\n\n\t\tconst shaComputer = new StringSHA1();\n\t\tconst snapshot = this.textBuffer.createSnapshot(false);\n\t\tlet text: string | null;\n\t\twhile ((text = snapshot.read())) {\n\t\t\tshaComputer.update(text);\n\t\t}\n\t\tthis._textBufferHash = shaComputer.digest();\n\t\treturn this._textBufferHash;\n\t}\n\n\tpublic getValue() {\n\t\tconst fullRange = this.getFullModelRange();\n\t\tconst eol = this.textBuffer.getEOL();\n\t\tif (eol === '\\n') {\n\t\t\treturn this.textBuffer.getValueInRange(fullRange, EndOfLinePreference.LF);\n\t\t} else {\n\t\t\treturn this.textBuffer.getValueInRange(fullRange, EndOfLinePreference.CRLF);\n\t\t}\n\t}\n\tprivate getFullModelRange() {\n\t\tconst lineCount = this.textBuffer.getLineCount();\n\t\treturn new Range(1, 1, lineCount, this.textBuffer.getLineLength(lineCount) + 1);\n\t}\n\n}\n"]}