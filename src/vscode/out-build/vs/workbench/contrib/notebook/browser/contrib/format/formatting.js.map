{"version":3,"sources":["vs/workbench/contrib/notebook/browser/contrib/format/formatting.ts"],"names":[],"mappings":"AAAA;;;gGAGgG;;;;;;;;;;AAEhG,OAAO,EAAE,QAAQ,EAAE,SAAS,EAAE,MAAM,0BAA0B,CAAC;AAC/D,OAAO,EAAE,iBAAiB,EAAE,MAAM,+CAA+C,CAAC;AAElF,OAAO,EAAE,UAAU,EAAE,eAAe,EAAE,MAAM,4CAA4C,CAAC;AAEzF,OAAO,EAAE,YAAY,EAAE,oBAAoB,EAAE,MAAM,sDAAsD,CAAC;AAC1G,OAAO,EAAE,gBAAgB,EAAE,gBAAgB,EAAE,MAAM,8DAA8D,CAAC;AAClH,OAAO,EAAE,iBAAiB,EAAE,MAAM,sDAAsD,CAAC;AACzF,OAAO,EAAE,oBAAoB,EAAE,MAAM,0DAA0D,CAAC;AAChG,OAAO,EAAE,wBAAwB,EAAE,MAAM,8DAA8D,CAAC;AACxG,OAAO,EAAE,iBAAiB,EAAE,MAAM,6DAA6D,CAAC;AAChG,OAAO,EAAkB,kCAAkC,EAAE,8CAA8C,EAAE,MAAM,2DAA2D,CAAC;AAC/K,OAAO,EAAE,OAAO,EAAE,MAAM,EAAE,eAAe,EAAE,MAAM,sDAAsD,CAAC;AACxG,OAAO,EAAE,cAAc,EAAE,MAAM,4DAA4D,CAAC;AAC5F,OAAO,EAAE,qBAAqB,EAAoB,MAAM,kEAAkE,CAAC;AAE3H,OAAO,EAAE,QAAQ,EAAE,MAAM,wDAAwD,CAAC;AAClF,OAAO,EAAE,yBAAyB,EAAE,MAAM,iCAAiC,CAAC;AAC5E,OAAO,EAAE,+BAA+B,EAAE,MAAM,0BAA0B,CAAC;AAC3E,OAAO,EAAE,wBAAwB,EAAE,yBAAyB,EAAE,MAAM,wCAAwC,CAAC;AAC7G,OAAO,EAAE,cAAc,EAAE,MAAM,wDAAwD,CAAC;AAExF,OAAO,EAA6B,yBAAyB,EAAE,MAAM,6CAA6C,CAAC;AACnH,OAAO,EAAE,eAAe,EAAE,MAAM,mCAAmC,CAAC;AACpE,OAAO,EAAE,qBAAqB,EAAE,MAAM,kEAAkE,CAAC;AAEzG,OAAO,EAAE,QAAQ,EAAE,MAAM,wDAAwD,CAAC;AAClF,OAAO,EAA2D,UAAU,IAAI,gCAAgC,EAAE,MAAM,wCAAwC,CAAC;AACjK,OAAO,EAAE,gBAAgB,EAAE,MAAM,oCAAoC,CAAC;AACtE,OAAO,EAAE,0BAA0B,EAAE,MAAM,yCAAyC,CAAC;AAErF,kBAAkB;AAClB,eAAe,CAAC,KAAM,SAAQ,OAAO;IACpC;QACC,KAAK,CAAC;YACL,EAAE,EAAE,iBAAiB;YACrB,KAAK,EAAE,SAAS,CAAC,KAAc,EAAE,iBAAiB,CAAC;YACnD,QAAQ,EAAE,yBAAyB;YACnC,YAAY,EAAE,cAAc,CAAC,GAAG,CAAC,yBAAyB,EAAE,wBAAwB,CAAC;YACrF,UAAU,EAAE;gBACX,IAAI,EAAE,iBAAiB,CAAC,eAAe,CAAC,SAAS,EAAE;gBACnD,OAAO,EAAE,8CAAyB,wBAAe;gBACjD,KAAK,EAAE,EAAE,OAAO,EAAE,mDAA6B,wBAAe,EAAE;gBAChE,MAAM,6CAAmC;aACzC;YACD,EAAE,EAAE,IAAI;YACR,IAAI,EAAE;gBACL,EAAE,EAAE,MAAM,CAAC,aAAa;gBACxB,IAAI,EAAE,cAAc,CAAC,GAAG,CAAC,iBAAiB,CAAC,iBAAiB,EAAE,iBAAiB,CAAC,6BAA6B,CAAC;gBAC9G,KAAK,EAAE,gBAAgB;gBACvB,KAAK,EAAE,GAAG;aACV;SACD,CAAC,CAAC;IACJ,CAAC;IAED,KAAK,CAAC,GAAG,CAAC,QAA0B;QACnC,MAAM,aAAa,GAAG,QAAQ,CAAC,GAAG,CAAC,cAAc,CAAC,CAAC;QACnD,MAAM,gBAAgB,GAAG,QAAQ,CAAC,GAAG,CAAC,iBAAiB,CAAC,CAAC;QACzD,MAAM,mBAAmB,GAAG,QAAQ,CAAC,GAAG,CAAC,oBAAoB,CAAC,CAAC;QAC/D,MAAM,uBAAuB,GAAG,QAAQ,CAAC,GAAG,CAAC,wBAAwB,CAAC,CAAC;QACvE,MAAM,eAAe,GAAG,QAAQ,CAAC,GAAG,CAAC,gBAAgB,CAAC,CAAC;QACvD,MAAM,oBAAoB,GAAG,QAAQ,CAAC,GAAG,CAAC,qBAAqB,CAAC,CAAC;QAEjE,MAAM,MAAM,GAAG,+BAA+B,CAAC,aAAa,CAAC,gBAAgB,CAAC,CAAC;QAC/E,IAAI,CAAC,MAAM,IAAI,CAAC,MAAM,CAAC,QAAQ,EAAE,EAAE,CAAC;YACnC,OAAO;QACR,CAAC;QAED,MAAM,QAAQ,GAAG,MAAM,CAAC,SAAS,CAAC;QAElC,MAAM,aAAa,GAAY,MAAM,oBAAoB,CAAC,cAAc,CAAC,0BAA0B,CAAC,2BAA2B,EAAE,QAAQ,EAAE,QAAQ,CAAC,IAAI,EAAE,iBAAiB,CAAC,IAAI,CAAC,CAAC;QAElL,MAAM,UAAU,GAAG,IAAI,eAAe,EAAE,CAAC;QACzC,IAAI,CAAC;YACJ,IAAI,CAAC,aAAa,EAAE,CAAC;gBACpB,MAAM,YAAY,GAAG,MAAM,OAAO,CAAC,GAAG,CAAC,QAAQ,CAAC,KAAK,CAAC,GAAG,CAAC,KAAK,EAAC,IAAI,EAAC,EAAE;oBACtE,MAAM,GAAG,GAAG,MAAM,gBAAgB,CAAC,oBAAoB,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;oBAClE,UAAU,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC;oBAEpB,MAAM,KAAK,GAAG,GAAG,CAAC,MAAM,CAAC,eAAe,CAAC;oBAEzC,MAAM,WAAW,GAAG,MAAM,8CAA8C,CACvE,mBAAmB,EACnB,uBAAuB,EACvB,KAAK,mCAEL,iBAAiB,CAAC,IAAI,CACtB,CAAC;oBAEF,MAAM,KAAK,GAAuB,EAAE,CAAC;oBAErC,IAAI,WAAW,EAAE,CAAC;wBACjB,KAAK,MAAM,IAAI,IAAI,WAAW,EAAE,CAAC;4BAChC,KAAK,CAAC,IAAI,CAAC,IAAI,gBAAgB,CAAC,KAAK,CAAC,GAAG,EAAE,IAAI,EAAE,KAAK,CAAC,YAAY,EAAE,CAAC,CAAC,CAAC;wBACzE,CAAC;wBAED,OAAO,KAAK,CAAC;oBACd,CAAC;oBAED,OAAO,EAAE,CAAC;gBACX,CAAC,CAAC,CAAC,CAAC;gBAEJ,MAAM,eAAe,CAAC,KAAK,CAAC,UAAU,CAAA,YAAY,CAAC,IAAI,EAAE,EAAE,EAAE,KAAK,EAAE,QAAQ,CAAC,KAAO,EAAE,IAAiB,CAAC,EAAE,IAAI,EAAE,yBAAyB,GAAG,CAAC,CAAC;YAC/I,CAAC;QACF,CAAC;gBAAS,CAAC;YACV,UAAU,CAAC,OAAO,EAAE,CAAC;QACtB,CAAC;IACF,CAAC;CACD,CAAC,CAAC;AAEH,cAAc;AACd,oBAAoB,CAAC,MAAM,gBAAiB,SAAQ,YAAY;IAC/D;QACC,KAAK,CAAC;YACL,EAAE,EAAE,qBAAqB;YACzB,KAAK,EAAE,SAAS,CAAC,KAAkB,EAAE,aAAa,CAAC;YACnD,YAAY,EAAE,cAAc,CAAC,GAAG,CAAC,yBAAyB,EAAE,wBAAwB,EAAE,iBAAiB,CAAC,iBAAiB,EAAE,iBAAiB,CAAC,QAAQ,EAAE,iBAAiB,CAAC,6BAA6B,CAAC;YACvM,MAAM,EAAE;gBACP,MAAM,EAAE,cAAc,CAAC,GAAG,CAAC,iBAAiB,CAAC,eAAe,CAAC;gBAC7D,OAAO,EAAE,8CAAyB,wBAAe;gBACjD,KAAK,EAAE,EAAE,OAAO,EAAE,mDAA6B,wBAAe,EAAE;gBAChE,MAAM,0CAAgC;aACtC;YACD,eAAe,EAAE;gBAChB,KAAK,EAAE,gBAAgB;gBACvB,KAAK,EAAE,KAAK;aACZ;SACD,CAAC,CAAC;IACJ,CAAC;IAED,KAAK,CAAC,GAAG,CAAC,QAA0B,EAAE,MAAmB;QACxD,IAAI,MAAM,CAAC,QAAQ,EAAE,EAAE,CAAC;YACvB,MAAM,YAAY,GAAG,QAAQ,CAAC,GAAG,CAAC,qBAAqB,CAAC,CAAC;YACzD,MAAM,YAAY,CAAC,cAAc,CAAC,kCAAkC,EAAE,MAAM,mCAA2B,QAAQ,CAAC,IAAI,EAAE,iBAAiB,CAAC,IAAI,EAAE,IAAI,CAAC,CAAC;QACrJ,CAAC;IACF,CAAC;CACD,CAAC,CAAC;AAEH,IAAM,gCAAgC,GAAtC,MAAM,gCAAgC;IACrC,YACoC,eAAiC,EACzB,uBAAiD,EACxD,gBAAmC,EAChC,mBAAyC,EACxC,oBAA2C,EAChD,gBAAkC;QALlC,oBAAe,GAAf,eAAe,CAAkB;QACzB,4BAAuB,GAAvB,uBAAuB,CAA0B;QACxD,qBAAgB,GAAhB,gBAAgB,CAAmB;QAChC,wBAAmB,GAAnB,mBAAmB,CAAsB;QACxC,yBAAoB,GAApB,oBAAoB,CAAuB;QAChD,qBAAgB,GAAhB,gBAAgB,CAAkB;IAEtE,CAAC;IAED,KAAK,CAAC,iBAAiB,CAAC,UAAoC;QAE3D,MAAM,OAAO,GAAG,IAAI,CAAC,oBAAoB,CAAC,QAAQ,CAAU,eAAe,CAAC,qBAAqB,CAAC,CAAC;QACnG,IAAI,CAAC,OAAO,EAAE,CAAC;YACd,OAAO;QACR,CAAC;QAED,MAAM,UAAU,GAAG,IAAI,eAAe,EAAE,CAAC;QACzC,IAAI,CAAC;YACJ,MAAM,YAAY,GAAG,MAAM,OAAO,CAAC,GAAG,CAAC,UAAU,CAAC,GAAG,CAAC,KAAK,EAAC,aAAa,EAAC,EAAE;gBAC3E,MAAM,OAAO,GAAG,IAAI,CAAC,gBAAgB,CAAC,oBAAoB,CAAC,aAAa,CAAC,QAAQ,CAAC,CAAC;gBACnF,IAAI,CAAC,OAAO,EAAE,CAAC;oBACd,OAAO,EAAE,CAAC;gBACX,CAAC;gBACD,IAAI,UAAU,CAAC;gBACf,KAAK,MAAM,IAAI,IAAI,OAAO,CAAC,KAAK,EAAE,CAAC;oBAClC,IAAI,IAAI,CAAC,MAAM,KAAK,aAAa,CAAC,UAAU,EAAE,CAAC;wBAC9C,UAAU,GAAG,IAAI,CAAC;wBAClB,MAAM;oBACP,CAAC;gBACF,CAAC;gBACD,IAAI,CAAC,UAAU,EAAE,CAAC;oBACjB,OAAO,EAAE,CAAC;gBACX,CAAC;gBAED,MAAM,GAAG,GAAG,MAAM,IAAI,CAAC,gBAAgB,CAAC,oBAAoB,CAAC,UAAU,CAAC,GAAG,CAAC,CAAC;gBAC7E,UAAU,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC;gBAEpB,MAAM,KAAK,GAAG,GAAG,CAAC,MAAM,CAAC,eAAe,CAAC;gBAEzC,MAAM,WAAW,GAAG,MAAM,8CAA8C,CACvE,IAAI,CAAC,mBAAmB,EACxB,IAAI,CAAC,uBAAuB,EAC5B,KAAK,iCAEL,iBAAiB,CAAC,IAAI,CACtB,CAAC;gBAEF,MAAM,KAAK,GAAuB,EAAE,CAAC;gBAErC,IAAI,WAAW,EAAE,CAAC;oBACjB,KAAK,CAAC,IAAI,CAAC,GAAG,WAAW,CAAC,GAAG,CAAC,IAAI,CAAC,EAAE,CAAC,IAAI,gBAAgB,CAAC,KAAK,CAAC,GAAG,EAAE,IAAI,EAAE,KAAK,CAAC,YAAY,EAAE,CAAC,CAAC,CAAC,CAAC;oBACpG,OAAO,KAAK,CAAC;gBACd,CAAC;gBAED,OAAO,EAAE,CAAC;YACX,CAAC,CAAC,CAAC,CAAC;YAEJ,MAAM,IAAI,CAAC,eAAe,CAAC,KAAK,CAAC,UAAU,CAAA,YAAY,CAAC,IAAI,EAAE,EAAE,EAAE,KAAK,EAAE,QAAQ,CAAC,KAAmB,EAAE,IAAc,CAAC,EAAE,IAAI,EAAE,wCAAwC,GAAG,CAAC,CAAC;QAE5K,CAAC;gBAAS,CAAC;YACV,UAAU,CAAC,OAAO,EAAE,CAAC;QACtB,CAAC;IACF,CAAC;CACD,CAAA;AAjEK,gCAAgC;IAEnC,WAAA,gBAAgB,CAAA;IAChB,WAAA,wBAAwB,CAAA;IACxB,WAAA,iBAAiB,CAAA;IACjB,WAAA,oBAAoB,CAAA;IACpB,WAAA,qBAAqB,CAAA;IACrB,WAAA,gBAAgB,CAAA;GAPb,gCAAgC,CAiErC;AAEM,IAAM,qCAAqC,GAA3C,MAAM,qCAAsC,SAAQ,UAAU;IACpE,YACyC,oBAA2C,EACvC,wBAAmD;QAE/F,KAAK,EAAE,CAAC;QAHgC,yBAAoB,GAApB,oBAAoB,CAAuB;QACvC,6BAAwB,GAAxB,wBAAwB,CAA2B;QAG/F,IAAI,CAAC,mCAAmC,EAAE,CAAC;IAC5C,CAAC;IAEO,mCAAmC;QAC1C,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,wBAAwB,CAAC,4BAA4B,CAAC,IAAI,CAAC,oBAAoB,CAAC,cAAc,CAAC,gCAAgC,CAAC,CAAC,CAAC,CAAC;IACxJ,CAAC;CACD,CAAA;AAZY,qCAAqC;IAE/C,WAAA,qBAAqB,CAAA;IACrB,WAAA,yBAAyB,CAAA;GAHf,qCAAqC,CAYjD;;AAED,MAAM,8BAA8B,GAAG,QAAQ,CAAC,EAAE,CAAkC,gCAAgC,CAAC,SAAS,CAAC,CAAC;AAChI,8BAA8B,CAAC,6BAA6B,CAAC,qCAAqC,kCAA0B,CAAC","file":"formatting.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { localize, localize2 } from '../../../../../../nls.js';\nimport { CancellationToken } from '../../../../../../base/common/cancellation.js';\nimport { KeyCode, KeyMod } from '../../../../../../base/common/keyCodes.js';\nimport { Disposable, DisposableStore } from '../../../../../../base/common/lifecycle.js';\nimport { ICodeEditor } from '../../../../../../editor/browser/editorBrowser.js';\nimport { EditorAction, registerEditorAction } from '../../../../../../editor/browser/editorExtensions.js';\nimport { IBulkEditService, ResourceTextEdit } from '../../../../../../editor/browser/services/bulkEditService.js';\nimport { EditorContextKeys } from '../../../../../../editor/common/editorContextKeys.js';\nimport { IEditorWorkerService } from '../../../../../../editor/common/services/editorWorker.js';\nimport { ILanguageFeaturesService } from '../../../../../../editor/common/services/languageFeatures.js';\nimport { ITextModelService } from '../../../../../../editor/common/services/resolverService.js';\nimport { FormattingMode, formatDocumentWithSelectedProvider, getDocumentFormattingEditsWithSelectedProvider } from '../../../../../../editor/contrib/format/browser/format.js';\nimport { Action2, MenuId, registerAction2 } from '../../../../../../platform/actions/common/actions.js';\nimport { ContextKeyExpr } from '../../../../../../platform/contextkey/common/contextkey.js';\nimport { IInstantiationService, ServicesAccessor } from '../../../../../../platform/instantiation/common/instantiation.js';\nimport { KeybindingWeight } from '../../../../../../platform/keybinding/common/keybindingsRegistry.js';\nimport { Progress } from '../../../../../../platform/progress/common/progress.js';\nimport { NOTEBOOK_ACTIONS_CATEGORY } from '../../controller/coreActions.js';\nimport { getNotebookEditorFromEditorPane } from '../../notebookBrowser.js';\nimport { NOTEBOOK_EDITOR_EDITABLE, NOTEBOOK_IS_ACTIVE_EDITOR } from '../../../common/notebookContextKeys.js';\nimport { IEditorService } from '../../../../../services/editor/common/editorService.js';\nimport { INotebookCellExecution } from '../../../common/notebookExecutionStateService.js';\nimport { ICellExecutionParticipant, INotebookExecutionService } from '../../../common/notebookExecutionService.js';\nimport { NotebookSetting } from '../../../common/notebookCommon.js';\nimport { IConfigurationService } from '../../../../../../platform/configuration/common/configuration.js';\nimport { LifecyclePhase } from '../../../../../services/lifecycle/common/lifecycle.js';\nimport { Registry } from '../../../../../../platform/registry/common/platform.js';\nimport { IWorkbenchContribution, IWorkbenchContributionsRegistry, Extensions as WorkbenchContributionsExtensions } from '../../../../../common/contributions.js';\nimport { INotebookService } from '../../../common/notebookService.js';\nimport { CodeActionParticipantUtils } from '../saveParticipants/saveParticipants.js';\n\n// format notebook\nregisterAction2(class extends Action2 {\n\tconstructor() {\n\t\tsuper({\n\t\t\tid: 'notebook.format',\n\t\t\ttitle: localize2('format.title', 'Format Notebook'),\n\t\t\tcategory: NOTEBOOK_ACTIONS_CATEGORY,\n\t\t\tprecondition: ContextKeyExpr.and(NOTEBOOK_IS_ACTIVE_EDITOR, NOTEBOOK_EDITOR_EDITABLE),\n\t\t\tkeybinding: {\n\t\t\t\twhen: EditorContextKeys.editorTextFocus.toNegated(),\n\t\t\t\tprimary: KeyMod.Shift | KeyMod.Alt | KeyCode.KeyF,\n\t\t\t\tlinux: { primary: KeyMod.CtrlCmd | KeyMod.Shift | KeyCode.KeyI },\n\t\t\t\tweight: KeybindingWeight.WorkbenchContrib\n\t\t\t},\n\t\t\tf1: true,\n\t\t\tmenu: {\n\t\t\t\tid: MenuId.EditorContext,\n\t\t\t\twhen: ContextKeyExpr.and(EditorContextKeys.inCompositeEditor, EditorContextKeys.hasDocumentFormattingProvider),\n\t\t\t\tgroup: '1_modification',\n\t\t\t\torder: 1.3\n\t\t\t}\n\t\t});\n\t}\n\n\tasync run(accessor: ServicesAccessor): Promise<void> {\n\t\tconst editorService = accessor.get(IEditorService);\n\t\tconst textModelService = accessor.get(ITextModelService);\n\t\tconst editorWorkerService = accessor.get(IEditorWorkerService);\n\t\tconst languageFeaturesService = accessor.get(ILanguageFeaturesService);\n\t\tconst bulkEditService = accessor.get(IBulkEditService);\n\t\tconst instantiationService = accessor.get(IInstantiationService);\n\n\t\tconst editor = getNotebookEditorFromEditorPane(editorService.activeEditorPane);\n\t\tif (!editor || !editor.hasModel()) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst notebook = editor.textModel;\n\n\t\tconst formatApplied: boolean = await instantiationService.invokeFunction(CodeActionParticipantUtils.checkAndRunFormatCodeAction, notebook, Progress.None, CancellationToken.None);\n\n\t\tconst disposable = new DisposableStore();\n\t\ttry {\n\t\t\tif (!formatApplied) {\n\t\t\t\tconst allCellEdits = await Promise.all(notebook.cells.map(async cell => {\n\t\t\t\t\tconst ref = await textModelService.createModelReference(cell.uri);\n\t\t\t\t\tdisposable.add(ref);\n\n\t\t\t\t\tconst model = ref.object.textEditorModel;\n\n\t\t\t\t\tconst formatEdits = await getDocumentFormattingEditsWithSelectedProvider(\n\t\t\t\t\t\teditorWorkerService,\n\t\t\t\t\t\tlanguageFeaturesService,\n\t\t\t\t\t\tmodel,\n\t\t\t\t\t\tFormattingMode.Explicit,\n\t\t\t\t\t\tCancellationToken.None\n\t\t\t\t\t);\n\n\t\t\t\t\tconst edits: ResourceTextEdit[] = [];\n\n\t\t\t\t\tif (formatEdits) {\n\t\t\t\t\t\tfor (const edit of formatEdits) {\n\t\t\t\t\t\t\tedits.push(new ResourceTextEdit(model.uri, edit, model.getVersionId()));\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn edits;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn [];\n\t\t\t\t}));\n\n\t\t\t\tawait bulkEditService.apply(/* edit */allCellEdits.flat(), { label: localize('label', \"Format Notebook\"), code: 'undoredo.formatNotebook', });\n\t\t\t}\n\t\t} finally {\n\t\t\tdisposable.dispose();\n\t\t}\n\t}\n});\n\n// format cell\nregisterEditorAction(class FormatCellAction extends EditorAction {\n\tconstructor() {\n\t\tsuper({\n\t\t\tid: 'notebook.formatCell',\n\t\t\tlabel: localize2('formatCell.label', \"Format Cell\"),\n\t\t\tprecondition: ContextKeyExpr.and(NOTEBOOK_IS_ACTIVE_EDITOR, NOTEBOOK_EDITOR_EDITABLE, EditorContextKeys.inCompositeEditor, EditorContextKeys.writable, EditorContextKeys.hasDocumentFormattingProvider),\n\t\t\tkbOpts: {\n\t\t\t\tkbExpr: ContextKeyExpr.and(EditorContextKeys.editorTextFocus),\n\t\t\t\tprimary: KeyMod.Shift | KeyMod.Alt | KeyCode.KeyF,\n\t\t\t\tlinux: { primary: KeyMod.CtrlCmd | KeyMod.Shift | KeyCode.KeyI },\n\t\t\t\tweight: KeybindingWeight.EditorContrib\n\t\t\t},\n\t\t\tcontextMenuOpts: {\n\t\t\t\tgroup: '1_modification',\n\t\t\t\torder: 1.301\n\t\t\t}\n\t\t});\n\t}\n\n\tasync run(accessor: ServicesAccessor, editor: ICodeEditor): Promise<void> {\n\t\tif (editor.hasModel()) {\n\t\t\tconst instaService = accessor.get(IInstantiationService);\n\t\t\tawait instaService.invokeFunction(formatDocumentWithSelectedProvider, editor, FormattingMode.Explicit, Progress.None, CancellationToken.None, true);\n\t\t}\n\t}\n});\n\nclass FormatOnCellExecutionParticipant implements ICellExecutionParticipant {\n\tconstructor(\n\t\t@IBulkEditService private readonly bulkEditService: IBulkEditService,\n\t\t@ILanguageFeaturesService private readonly languageFeaturesService: ILanguageFeaturesService,\n\t\t@ITextModelService private readonly textModelService: ITextModelService,\n\t\t@IEditorWorkerService private readonly editorWorkerService: IEditorWorkerService,\n\t\t@IConfigurationService private readonly configurationService: IConfigurationService,\n\t\t@INotebookService private readonly _notebookService: INotebookService,\n\t) {\n\t}\n\n\tasync onWillExecuteCell(executions: INotebookCellExecution[]): Promise<void> {\n\n\t\tconst enabled = this.configurationService.getValue<boolean>(NotebookSetting.formatOnCellExecution);\n\t\tif (!enabled) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst disposable = new DisposableStore();\n\t\ttry {\n\t\t\tconst allCellEdits = await Promise.all(executions.map(async cellExecution => {\n\t\t\t\tconst nbModel = this._notebookService.getNotebookTextModel(cellExecution.notebook);\n\t\t\t\tif (!nbModel) {\n\t\t\t\t\treturn [];\n\t\t\t\t}\n\t\t\t\tlet activeCell;\n\t\t\t\tfor (const cell of nbModel.cells) {\n\t\t\t\t\tif (cell.handle === cellExecution.cellHandle) {\n\t\t\t\t\t\tactiveCell = cell;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (!activeCell) {\n\t\t\t\t\treturn [];\n\t\t\t\t}\n\n\t\t\t\tconst ref = await this.textModelService.createModelReference(activeCell.uri);\n\t\t\t\tdisposable.add(ref);\n\n\t\t\t\tconst model = ref.object.textEditorModel;\n\n\t\t\t\tconst formatEdits = await getDocumentFormattingEditsWithSelectedProvider(\n\t\t\t\t\tthis.editorWorkerService,\n\t\t\t\t\tthis.languageFeaturesService,\n\t\t\t\t\tmodel,\n\t\t\t\t\tFormattingMode.Silent,\n\t\t\t\t\tCancellationToken.None\n\t\t\t\t);\n\n\t\t\t\tconst edits: ResourceTextEdit[] = [];\n\n\t\t\t\tif (formatEdits) {\n\t\t\t\t\tedits.push(...formatEdits.map(edit => new ResourceTextEdit(model.uri, edit, model.getVersionId())));\n\t\t\t\t\treturn edits;\n\t\t\t\t}\n\n\t\t\t\treturn [];\n\t\t\t}));\n\n\t\t\tawait this.bulkEditService.apply(/* edit */allCellEdits.flat(), { label: localize('formatCells.label', \"Format Cells\"), code: 'undoredo.notebooks.onWillExecuteFormat', });\n\n\t\t} finally {\n\t\t\tdisposable.dispose();\n\t\t}\n\t}\n}\n\nexport class CellExecutionParticipantsContribution extends Disposable implements IWorkbenchContribution {\n\tconstructor(\n\t\t@IInstantiationService private readonly instantiationService: IInstantiationService,\n\t\t@INotebookExecutionService private readonly notebookExecutionService: INotebookExecutionService\n\t) {\n\t\tsuper();\n\t\tthis.registerKernelExecutionParticipants();\n\t}\n\n\tprivate registerKernelExecutionParticipants(): void {\n\t\tthis._register(this.notebookExecutionService.registerExecutionParticipant(this.instantiationService.createInstance(FormatOnCellExecutionParticipant)));\n\t}\n}\n\nconst workbenchContributionsRegistry = Registry.as<IWorkbenchContributionsRegistry>(WorkbenchContributionsExtensions.Workbench);\nworkbenchContributionsRegistry.registerWorkbenchContribution(CellExecutionParticipantsContribution, LifecyclePhase.Restored);\n"]}