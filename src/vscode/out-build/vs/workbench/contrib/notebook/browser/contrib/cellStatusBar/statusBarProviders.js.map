{"version":3,"sources":["vs/workbench/contrib/notebook/browser/contrib/cellStatusBar/statusBarProviders.ts"],"names":[],"mappings":"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","file":"statusBarProviders.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { CancellationToken } from '../../../../../../base/common/cancellation.js';\nimport { Disposable } from '../../../../../../base/common/lifecycle.js';\nimport { ResourceMap } from '../../../../../../base/common/map.js';\nimport { URI } from '../../../../../../base/common/uri.js';\nimport { ILanguageService } from '../../../../../../editor/common/languages/language.js';\nimport { localize } from '../../../../../../nls.js';\nimport { IConfigurationService } from '../../../../../../platform/configuration/common/configuration.js';\nimport { IInstantiationService } from '../../../../../../platform/instantiation/common/instantiation.js';\nimport { IKeybindingService } from '../../../../../../platform/keybinding/common/keybinding.js';\nimport { Registry } from '../../../../../../platform/registry/common/platform.js';\nimport { Extensions as WorkbenchExtensions, IWorkbenchContributionsRegistry } from '../../../../../common/contributions.js';\nimport { CHANGE_CELL_LANGUAGE, DETECT_CELL_LANGUAGE } from '../../notebookBrowser.js';\nimport { INotebookCellStatusBarService } from '../../../common/notebookCellStatusBarService.js';\nimport { CellKind, CellStatusbarAlignment, INotebookCellStatusBarItem, INotebookCellStatusBarItemList, INotebookCellStatusBarItemProvider } from '../../../common/notebookCommon.js';\nimport { INotebookKernelService } from '../../../common/notebookKernelService.js';\nimport { INotebookService } from '../../../common/notebookService.js';\nimport { ILanguageDetectionService, LanguageDetectionHintConfig } from '../../../../../services/languageDetection/common/languageDetectionWorkerService.js';\nimport { LifecyclePhase } from '../../../../../services/lifecycle/common/lifecycle.js';\n\nclass CellStatusBarLanguagePickerProvider implements INotebookCellStatusBarItemProvider {\n\n\treadonly viewType = '*';\n\n\tconstructor(\n\t\t@INotebookService private readonly _notebookService: INotebookService,\n\t\t@ILanguageService private readonly _languageService: ILanguageService,\n\t) { }\n\n\tasync provideCellStatusBarItems(uri: URI, index: number, _token: CancellationToken): Promise<INotebookCellStatusBarItemList | undefined> {\n\t\tconst doc = this._notebookService.getNotebookTextModel(uri);\n\t\tconst cell = doc?.cells[index];\n\t\tif (!cell) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst statusBarItems: INotebookCellStatusBarItem[] = [];\n\t\tlet displayLanguage = cell.language;\n\t\tif (cell.cellKind === CellKind.Markup) {\n\t\t\tdisplayLanguage = 'markdown';\n\t\t} else {\n\t\t\tconst registeredId = this._languageService.getLanguageIdByLanguageName(cell.language);\n\t\t\tif (registeredId) {\n\t\t\t\tdisplayLanguage = this._languageService.getLanguageName(displayLanguage) ?? displayLanguage;\n\t\t\t} else {\n\t\t\t\t// add unregistered lanugage warning item\n\t\t\t\tconst searchTooltip = localize('notebook.cell.status.searchLanguageExtensions', \"Unknown cell language. Click to search for '{0}' extensions\", cell.language);\n\t\t\t\tstatusBarItems.push({\n\t\t\t\t\ttext: `$(dialog-warning)`,\n\t\t\t\t\tcommand: { id: 'workbench.extensions.search', arguments: [`@tag:${cell.language}`], title: 'Search Extensions' },\n\t\t\t\t\ttooltip: searchTooltip,\n\t\t\t\t\talignment: CellStatusbarAlignment.Right,\n\t\t\t\t\tpriority: -Number.MAX_SAFE_INTEGER + 1\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tstatusBarItems.push({\n\t\t\ttext: displayLanguage,\n\t\t\tcommand: CHANGE_CELL_LANGUAGE,\n\t\t\ttooltip: localize('notebook.cell.status.language', \"Select Cell Language Mode\"),\n\t\t\talignment: CellStatusbarAlignment.Right,\n\t\t\tpriority: -Number.MAX_SAFE_INTEGER\n\t\t});\n\t\treturn {\n\t\t\titems: statusBarItems\n\t\t};\n\t}\n}\n\nclass CellStatusBarLanguageDetectionProvider implements INotebookCellStatusBarItemProvider {\n\n\treadonly viewType = '*';\n\n\tprivate cache = new ResourceMap<{\n\t\tcontentVersion: number;\n\t\tupdateTimestamp: number;\n\t\tcellLanguage: string;\n\n\t\tguess?: string;\n\t}>();\n\n\tconstructor(\n\t\t@INotebookService private readonly _notebookService: INotebookService,\n\t\t@INotebookKernelService private readonly _notebookKernelService: INotebookKernelService,\n\t\t@ILanguageService private readonly _languageService: ILanguageService,\n\t\t@IConfigurationService private readonly _configurationService: IConfigurationService,\n\t\t@ILanguageDetectionService private readonly _languageDetectionService: ILanguageDetectionService,\n\t\t@IKeybindingService private readonly _keybindingService: IKeybindingService,\n\t) { }\n\n\tasync provideCellStatusBarItems(uri: URI, index: number, token: CancellationToken): Promise<INotebookCellStatusBarItemList | undefined> {\n\t\tconst doc = this._notebookService.getNotebookTextModel(uri);\n\t\tconst cell = doc?.cells[index];\n\t\tif (!cell) { return; }\n\n\t\tconst enablementConfig = this._configurationService.getValue<LanguageDetectionHintConfig>('workbench.editor.languageDetectionHints');\n\t\tconst enabled = typeof enablementConfig === 'object' && enablementConfig?.notebookEditors;\n\t\tif (!enabled) {\n\t\t\treturn;\n\t\t}\n\t\tconst cellUri = cell.uri;\n\t\tconst contentVersion = cell.textModel?.getVersionId();\n\t\tif (!contentVersion) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst currentLanguageId = cell.cellKind === CellKind.Markup ?\n\t\t\t'markdown' :\n\t\t\t(this._languageService.getLanguageIdByLanguageName(cell.language) || cell.language);\n\n\t\tif (!this.cache.has(cellUri)) {\n\t\t\tthis.cache.set(cellUri, {\n\t\t\t\tcellLanguage: currentLanguageId, // force a re-compute upon a change in configured language\n\t\t\t\tupdateTimestamp: 0, // facilitates a disposable-free debounce operation\n\t\t\t\tcontentVersion: 1, // dont run for the initial contents, only on update\n\t\t\t});\n\t\t}\n\n\t\tconst cached = this.cache.get(cellUri)!;\n\t\tif (cached.cellLanguage !== currentLanguageId || (cached.updateTimestamp < Date.now() - 1000 && cached.contentVersion !== contentVersion)) {\n\t\t\tcached.updateTimestamp = Date.now();\n\t\t\tcached.cellLanguage = currentLanguageId;\n\t\t\tcached.contentVersion = contentVersion;\n\n\t\t\tconst kernel = this._notebookKernelService.getSelectedOrSuggestedKernel(doc);\n\t\t\tif (kernel) {\n\t\t\t\tconst supportedLangs = [...kernel.supportedLanguages, 'markdown'];\n\t\t\t\tcached.guess = await this._languageDetectionService.detectLanguage(cell.uri, supportedLangs);\n\t\t\t}\n\t\t}\n\n\t\tconst items: INotebookCellStatusBarItem[] = [];\n\t\tif (cached.guess && currentLanguageId !== cached.guess) {\n\t\t\tconst detectedName = this._languageService.getLanguageName(cached.guess) || cached.guess;\n\t\t\tlet tooltip = localize('notebook.cell.status.autoDetectLanguage', \"Accept Detected Language: {0}\", detectedName);\n\t\t\tconst keybinding = this._keybindingService.lookupKeybinding(DETECT_CELL_LANGUAGE);\n\t\t\tconst label = keybinding?.getLabel();\n\t\t\tif (label) {\n\t\t\t\ttooltip += ` (${label})`;\n\t\t\t}\n\t\t\titems.push({\n\t\t\t\ttext: '$(lightbulb-autofix)',\n\t\t\t\tcommand: DETECT_CELL_LANGUAGE,\n\t\t\t\ttooltip,\n\t\t\t\talignment: CellStatusbarAlignment.Right,\n\t\t\t\tpriority: -Number.MAX_SAFE_INTEGER + 1\n\t\t\t});\n\t\t}\n\n\t\treturn { items };\n\t}\n}\n\nclass BuiltinCellStatusBarProviders extends Disposable {\n\tconstructor(\n\t\t@IInstantiationService instantiationService: IInstantiationService,\n\t\t@INotebookCellStatusBarService notebookCellStatusBarService: INotebookCellStatusBarService) {\n\t\tsuper();\n\n\t\tconst builtinProviders = [\n\t\t\tCellStatusBarLanguagePickerProvider,\n\t\t\tCellStatusBarLanguageDetectionProvider,\n\t\t];\n\t\tbuiltinProviders.forEach(p => {\n\t\t\tthis._register(notebookCellStatusBarService.registerCellStatusBarItemProvider(instantiationService.createInstance(p)));\n\t\t});\n\t}\n}\n\nRegistry.as<IWorkbenchContributionsRegistry>(WorkbenchExtensions.Workbench).registerWorkbenchContribution(BuiltinCellStatusBarProviders, LifecyclePhase.Restored);\n"]}