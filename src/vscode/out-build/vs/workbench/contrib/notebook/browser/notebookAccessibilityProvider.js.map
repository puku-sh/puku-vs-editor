{"version":3,"sources":["vs/workbench/contrib/notebook/browser/notebookAccessibilityProvider.ts"],"names":[],"mappings":"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","file":"notebookAccessibilityProvider.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { IListAccessibilityProvider } from '../../../../base/browser/ui/list/listWidget.js';\nimport { Event, Emitter } from '../../../../base/common/event.js';\nimport { Disposable } from '../../../../base/common/lifecycle.js';\nimport { observableFromEvent } from '../../../../base/common/observable.js';\nimport * as nls from '../../../../nls.js';\nimport { IConfigurationService } from '../../../../platform/configuration/common/configuration.js';\nimport { IKeybindingService } from '../../../../platform/keybinding/common/keybinding.js';\nimport { AccessibilityVerbositySettingId } from '../../accessibility/browser/accessibilityConfiguration.js';\nimport { AccessibilityCommandId } from '../../accessibility/common/accessibilityCommands.js';\nimport { CellViewModel, NotebookViewModel } from './viewModel/notebookViewModelImpl.js';\nimport { CellKind, NotebookCellExecutionState } from '../common/notebookCommon.js';\nimport { ICellExecutionStateChangedEvent, IExecutionStateChangedEvent, INotebookExecutionStateService, NotebookExecutionType } from '../common/notebookExecutionStateService.js';\nimport { getAllOutputsText } from './viewModel/cellOutputTextHelper.js';\nimport { IAccessibilityService } from '../../../../platform/accessibility/common/accessibility.js';\nimport { alert } from '../../../../base/browser/ui/aria/aria.js';\n\ntype executionUpdate = { cellHandle: number; state: NotebookCellExecutionState | undefined };\n\nexport class NotebookAccessibilityProvider extends Disposable implements IListAccessibilityProvider<CellViewModel> {\n\tprivate readonly _onDidAriaLabelChange = new Emitter<CellViewModel>();\n\tprivate readonly onDidAriaLabelChange = this._onDidAriaLabelChange.event;\n\n\tconstructor(\n\t\tprivate readonly viewModel: () => NotebookViewModel | undefined,\n\t\tprivate readonly isReplHistory: boolean,\n\t\t@INotebookExecutionStateService private readonly notebookExecutionStateService: INotebookExecutionStateService,\n\t\t@IKeybindingService private readonly keybindingService: IKeybindingService,\n\t\t@IConfigurationService private readonly configurationService: IConfigurationService,\n\t\t@IAccessibilityService private readonly accessibilityService: IAccessibilityService\n\t) {\n\t\tsuper();\n\t\tthis._register(Event.debounce<ICellExecutionStateChangedEvent | IExecutionStateChangedEvent, executionUpdate[]>(\n\t\t\tthis.notebookExecutionStateService.onDidChangeExecution,\n\t\t\t(last: executionUpdate[] | undefined, e: ICellExecutionStateChangedEvent | IExecutionStateChangedEvent) => this.mergeEvents(last, e),\n\t\t\t100\n\t\t)((updates: executionUpdate[]) => {\n\t\t\tif (!updates.length) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst viewModel = this.viewModel();\n\t\t\tif (viewModel) {\n\t\t\t\tfor (const update of updates) {\n\t\t\t\t\tconst cellModel = viewModel.getCellByHandle(update.cellHandle);\n\t\t\t\t\tif (cellModel) {\n\t\t\t\t\t\tthis._onDidAriaLabelChange.fire(cellModel as CellViewModel);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tconst lastUpdate = updates[updates.length - 1];\n\t\t\t\tif (this.shouldReadCellOutputs(lastUpdate.state)) {\n\t\t\t\t\tconst cell = viewModel.getCellByHandle(lastUpdate.cellHandle);\n\t\t\t\t\tif (cell && cell.outputsViewModels.length) {\n\t\t\t\t\t\tconst text = getAllOutputsText(viewModel.notebookDocument, cell, true);\n\t\t\t\t\t\talert(text);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}, this));\n\t}\n\n\tprivate shouldReadCellOutputs(state: NotebookCellExecutionState | undefined): boolean {\n\t\treturn state === undefined // execution completed\n\t\t\t&& this.isReplHistory\n\t\t\t&& this.accessibilityService.isScreenReaderOptimized()\n\t\t\t&& this.configurationService.getValue<boolean>('accessibility.replEditor.readLastExecutionOutput');\n\t}\n\n\tget verbositySettingId() {\n\t\treturn this.isReplHistory ?\n\t\t\tAccessibilityVerbositySettingId.ReplEditor :\n\t\t\tAccessibilityVerbositySettingId.Notebook;\n\t}\n\n\tgetAriaLabel(element: CellViewModel) {\n\t\tconst event = Event.filter(this.onDidAriaLabelChange, e => e === element);\n\t\treturn observableFromEvent(this, event, () => {\n\t\t\tconst viewModel = this.viewModel();\n\t\t\tif (!viewModel) {\n\t\t\t\treturn '';\n\t\t\t}\n\t\t\tconst index = viewModel.getCellIndex(element);\n\n\t\t\tif (index >= 0) {\n\t\t\t\treturn this.getLabel(element);\n\t\t\t}\n\n\t\t\treturn '';\n\t\t});\n\t}\n\n\tprivate createItemLabel(executionLabel: string, cellKind: CellKind) {\n\t\treturn this.isReplHistory ?\n\t\t\t`cell${executionLabel}` :\n\t\t\t`${cellKind === CellKind.Markup ? 'markdown' : 'code'} cell${executionLabel}`;\n\t}\n\n\tprivate getLabel(element: CellViewModel) {\n\t\tconst executionState = this.notebookExecutionStateService.getCellExecution(element.uri)?.state;\n\t\tconst executionLabel =\n\t\t\texecutionState === NotebookCellExecutionState.Executing\n\t\t\t\t? ', executing'\n\t\t\t\t: executionState === NotebookCellExecutionState.Pending\n\t\t\t\t\t? ', pending'\n\t\t\t\t\t: '';\n\n\t\treturn this.createItemLabel(executionLabel, element.cellKind);\n\t}\n\n\tprivate get widgetAriaLabelName() {\n\t\treturn this.isReplHistory ?\n\t\t\tnls.localize('replHistoryTreeAriaLabel', \"REPL Editor History\") :\n\t\t\tnls.localize('notebookTreeAriaLabel', \"Notebook\");\n\t}\n\n\tgetWidgetAriaLabel() {\n\t\tconst keybinding = this.keybindingService.lookupKeybinding(AccessibilityCommandId.OpenAccessibilityHelp)?.getLabel();\n\n\t\tif (this.configurationService.getValue(this.verbositySettingId)) {\n\t\t\treturn keybinding\n\t\t\t\t? nls.localize('notebookTreeAriaLabelHelp', \"{0}\\nUse {1} for accessibility help\", this.widgetAriaLabelName, keybinding)\n\t\t\t\t: nls.localize('notebookTreeAriaLabelHelpNoKb', \"{0}\\nRun the Open Accessibility Help command for more information\", this.widgetAriaLabelName);\n\t\t}\n\t\treturn this.widgetAriaLabelName;\n\t}\n\n\tprivate mergeEvents(last: executionUpdate[] | undefined, e: ICellExecutionStateChangedEvent | IExecutionStateChangedEvent): executionUpdate[] {\n\t\tconst viewModel = this.viewModel();\n\t\tconst result = last || [];\n\t\tif (viewModel && e.type === NotebookExecutionType.cell && e.affectsNotebook(viewModel.uri)) {\n\t\t\tconst index = result.findIndex(update => update.cellHandle === e.cellHandle);\n\t\t\tif (index >= 0) {\n\t\t\t\tresult.splice(index, 1);\n\t\t\t}\n\t\t\tresult.push({ cellHandle: e.cellHandle, state: e.changed?.state });\n\t\t}\n\t\treturn result;\n\t}\n}\n"]}