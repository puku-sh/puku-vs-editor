{"version":3,"sources":["vs/workbench/contrib/notebook/browser/services/notebookServiceImpl.ts"],"names":[],"mappings":"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","file":"notebookServiceImpl.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { localize } from '../../../../../nls.js';\nimport { toAction } from '../../../../../base/common/actions.js';\nimport { createErrorWithActions } from '../../../../../base/common/errorMessage.js';\nimport { Emitter, Event } from '../../../../../base/common/event.js';\nimport * as glob from '../../../../../base/common/glob.js';\nimport { Iterable } from '../../../../../base/common/iterator.js';\nimport { Lazy } from '../../../../../base/common/lazy.js';\nimport { Disposable, DisposableStore, IDisposable, toDisposable } from '../../../../../base/common/lifecycle.js';\nimport { ResourceMap } from '../../../../../base/common/map.js';\nimport { Schemas } from '../../../../../base/common/network.js';\nimport { basename, isEqual } from '../../../../../base/common/resources.js';\nimport { isDefined } from '../../../../../base/common/types.js';\nimport { URI } from '../../../../../base/common/uri.js';\nimport { IAccessibilityService } from '../../../../../platform/accessibility/common/accessibility.js';\nimport { ConfigurationTarget, IConfigurationService } from '../../../../../platform/configuration/common/configuration.js';\nimport { IResourceEditorInput } from '../../../../../platform/editor/common/editor.js';\nimport { IFileService } from '../../../../../platform/files/common/files.js';\nimport { IInstantiationService } from '../../../../../platform/instantiation/common/instantiation.js';\nimport { IStorageService, StorageScope, StorageTarget } from '../../../../../platform/storage/common/storage.js';\nimport { Memento } from '../../../../common/memento.js';\nimport { INotebookEditorContribution, notebookPreloadExtensionPoint, notebookRendererExtensionPoint, notebooksExtensionPoint } from '../notebookExtensionPoint.js';\nimport { INotebookEditorOptions } from '../notebookBrowser.js';\nimport { NotebookDiffEditorInput } from '../../common/notebookDiffEditorInput.js';\nimport { NotebookCellTextModel } from '../../common/model/notebookCellTextModel.js';\nimport { NotebookTextModel } from '../../common/model/notebookTextModel.js';\nimport { ACCESSIBLE_NOTEBOOK_DISPLAY_ORDER, CellUri, NotebookSetting, INotebookContributionData, INotebookExclusiveDocumentFilter, INotebookRendererInfo, INotebookTextModel, IOrderedMimeType, IOutputDto, MimeTypeDisplayOrder, NotebookEditorPriority, NotebookRendererMatch, NOTEBOOK_DISPLAY_ORDER, RENDERER_EQUIVALENT_EXTENSIONS, RENDERER_NOT_AVAILABLE, NotebookExtensionDescription, INotebookStaticPreloadInfo, NotebookData } from '../../common/notebookCommon.js';\nimport { NotebookEditorInput } from '../../common/notebookEditorInput.js';\nimport { INotebookEditorModelResolverService } from '../../common/notebookEditorModelResolverService.js';\nimport { NotebookOutputRendererInfo, NotebookStaticPreloadInfo as NotebookStaticPreloadInfo } from '../../common/notebookOutputRenderer.js';\nimport { NotebookEditorDescriptor, NotebookProviderInfo } from '../../common/notebookProvider.js';\nimport { INotebookSerializer, INotebookService, SimpleNotebookProviderInfo } from '../../common/notebookService.js';\nimport { DiffEditorInputFactoryFunction, EditorInputFactoryFunction, EditorInputFactoryObject, IEditorResolverService, IEditorType, RegisteredEditorInfo, RegisteredEditorPriority, UntitledEditorInputFactoryFunction, type MergeEditorInputFactoryFunction } from '../../../../services/editor/common/editorResolverService.js';\nimport { IExtensionService, isProposedApiEnabled } from '../../../../services/extensions/common/extensions.js';\nimport { IExtensionPointUser } from '../../../../services/extensions/common/extensionsRegistry.js';\nimport { InstallRecommendedExtensionAction } from '../../../extensions/browser/extensionsActions.js';\nimport { IUriIdentityService } from '../../../../../platform/uriIdentity/common/uriIdentity.js';\nimport { INotebookDocument, INotebookDocumentService } from '../../../../services/notebook/common/notebookDocumentService.js';\nimport { MergeEditorInput } from '../../../mergeEditor/browser/mergeEditorInput.js';\nimport type { EditorInputWithOptions, IResourceDiffEditorInput, IResourceMergeEditorInput } from '../../../../common/editor.js';\nimport { bufferToStream, streamToBuffer, VSBuffer, VSBufferReadableStream } from '../../../../../base/common/buffer.js';\nimport type { IEditorGroup } from '../../../../services/editor/common/editorGroupsService.js';\nimport { NotebookMultiDiffEditorInput } from '../diff/notebookMultiDiffEditorInput.js';\nimport { SnapshotContext } from '../../../../services/workingCopy/common/fileWorkingCopy.js';\nimport { CancellationToken } from '../../../../../base/common/cancellation.js';\nimport { CancellationError } from '../../../../../base/common/errors.js';\nimport { ICellRange } from '../../common/notebookRange.js';\n\ninterface NotebookProviderInfoStoreMemento {\n\teditors: NotebookProviderInfo[];\n}\n\nexport class NotebookProviderInfoStore extends Disposable {\n\n\tprivate static readonly CUSTOM_EDITORS_STORAGE_ID = 'notebookEditors';\n\tprivate static readonly CUSTOM_EDITORS_ENTRY_ID = 'editors';\n\n\tprivate readonly _memento: Memento<NotebookProviderInfoStoreMemento>;\n\tprivate _handled: boolean = false;\n\n\tprivate readonly _contributedEditors = new Map<string, NotebookProviderInfo>();\n\tprivate readonly _contributedEditorDisposables = this._register(new DisposableStore());\n\n\tconstructor(\n\t\t@IStorageService storageService: IStorageService,\n\t\t@IExtensionService extensionService: IExtensionService,\n\t\t@IEditorResolverService private readonly _editorResolverService: IEditorResolverService,\n\t\t@IConfigurationService private readonly _configurationService: IConfigurationService,\n\t\t@IAccessibilityService private readonly _accessibilityService: IAccessibilityService,\n\t\t@IInstantiationService private readonly _instantiationService: IInstantiationService,\n\t\t@IFileService private readonly _fileService: IFileService,\n\t\t@INotebookEditorModelResolverService private readonly _notebookEditorModelResolverService: INotebookEditorModelResolverService,\n\t\t@IUriIdentityService private readonly uriIdentService: IUriIdentityService,\n\t) {\n\t\tsuper();\n\n\t\tthis._memento = new Memento(NotebookProviderInfoStore.CUSTOM_EDITORS_STORAGE_ID, storageService);\n\n\t\tconst mementoObject = this._memento.getMemento(StorageScope.PROFILE, StorageTarget.MACHINE);\n\t\t// Process the notebook contributions but buffer changes from the resolver\n\t\tthis._editorResolverService.bufferChangeEvents(() => {\n\t\t\tfor (const info of (mementoObject[NotebookProviderInfoStore.CUSTOM_EDITORS_ENTRY_ID] || []) as NotebookEditorDescriptor[]) {\n\t\t\t\tthis.add(new NotebookProviderInfo(info), false);\n\t\t\t}\n\t\t});\n\n\t\tthis._register(extensionService.onDidRegisterExtensions(() => {\n\t\t\tif (!this._handled) {\n\t\t\t\t// there is no extension point registered for notebook content provider\n\t\t\t\t// clear the memento and cache\n\t\t\t\tthis._clear();\n\t\t\t\tmementoObject[NotebookProviderInfoStore.CUSTOM_EDITORS_ENTRY_ID] = [];\n\t\t\t\tthis._memento.saveMemento();\n\t\t\t}\n\t\t}));\n\n\t\tnotebooksExtensionPoint.setHandler(extensions => this._setupHandler(extensions));\n\t}\n\n\toverride dispose(): void {\n\t\tthis._clear();\n\t\tsuper.dispose();\n\t}\n\n\tprivate _setupHandler(extensions: readonly IExtensionPointUser<INotebookEditorContribution[]>[]) {\n\t\tthis._handled = true;\n\t\tconst builtins: NotebookProviderInfo[] = [...this._contributedEditors.values()].filter(info => !info.extension);\n\t\tthis._clear();\n\n\t\tconst builtinProvidersFromCache: Map<string, IDisposable> = new Map();\n\t\tbuiltins.forEach(builtin => {\n\t\t\tbuiltinProvidersFromCache.set(builtin.id, this.add(builtin));\n\t\t});\n\n\t\tfor (const extension of extensions) {\n\t\t\tfor (const notebookContribution of extension.value) {\n\n\t\t\t\tif (!notebookContribution.type) {\n\t\t\t\t\textension.collector.error(`Notebook does not specify type-property`);\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tconst existing = this.get(notebookContribution.type);\n\n\t\t\t\tif (existing) {\n\t\t\t\t\tif (!existing.extension && extension.description.isBuiltin && builtins.find(builtin => builtin.id === notebookContribution.type)) {\n\t\t\t\t\t\t// we are registering an extension which is using the same view type which is already cached\n\t\t\t\t\t\tbuiltinProvidersFromCache.get(notebookContribution.type)?.dispose();\n\t\t\t\t\t} else {\n\t\t\t\t\t\textension.collector.error(`Notebook type '${notebookContribution.type}' already used`);\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tthis.add(new NotebookProviderInfo({\n\t\t\t\t\textension: extension.description.identifier,\n\t\t\t\t\tid: notebookContribution.type,\n\t\t\t\t\tdisplayName: notebookContribution.displayName,\n\t\t\t\t\tselectors: notebookContribution.selector || [],\n\t\t\t\t\tpriority: this._convertPriority(notebookContribution.priority),\n\t\t\t\t\tproviderDisplayName: extension.description.displayName ?? extension.description.identifier.value,\n\t\t\t\t}));\n\t\t\t}\n\t\t}\n\n\t\tconst mementoObject = this._memento.getMemento(StorageScope.PROFILE, StorageTarget.MACHINE);\n\t\tmementoObject[NotebookProviderInfoStore.CUSTOM_EDITORS_ENTRY_ID] = Array.from(this._contributedEditors.values());\n\t\tthis._memento.saveMemento();\n\t}\n\n\tclearEditorCache() {\n\t\tconst mementoObject = this._memento.getMemento(StorageScope.PROFILE, StorageTarget.MACHINE);\n\t\tmementoObject[NotebookProviderInfoStore.CUSTOM_EDITORS_ENTRY_ID] = [];\n\t\tthis._memento.saveMemento();\n\t}\n\n\tprivate _convertPriority(priority?: string) {\n\t\tif (!priority) {\n\t\t\treturn RegisteredEditorPriority.default;\n\t\t}\n\n\t\tif (priority === NotebookEditorPriority.default) {\n\t\t\treturn RegisteredEditorPriority.default;\n\t\t}\n\n\t\treturn RegisteredEditorPriority.option;\n\n\t}\n\n\tprivate _registerContributionPoint(notebookProviderInfo: NotebookProviderInfo): IDisposable {\n\n\t\tconst disposables = new DisposableStore();\n\n\t\tfor (const selector of notebookProviderInfo.selectors) {\n\t\t\tconst globPattern = (selector as INotebookExclusiveDocumentFilter).include || selector as glob.IRelativePattern | string;\n\t\t\tconst notebookEditorInfo: RegisteredEditorInfo = {\n\t\t\t\tid: notebookProviderInfo.id,\n\t\t\t\tlabel: notebookProviderInfo.displayName,\n\t\t\t\tdetail: notebookProviderInfo.providerDisplayName,\n\t\t\t\tpriority: notebookProviderInfo.priority,\n\t\t\t};\n\t\t\tconst notebookEditorOptions = {\n\t\t\t\tcanHandleDiff: () => !!this._configurationService.getValue(NotebookSetting.textDiffEditorPreview) && !this._accessibilityService.isScreenReaderOptimized(),\n\t\t\t\tcanSupportResource: (resource: URI) => {\n\t\t\t\t\tif (resource.scheme === Schemas.vscodeNotebookCellOutput) {\n\t\t\t\t\t\tconst params = new URLSearchParams(resource.query);\n\t\t\t\t\t\treturn params.get('openIn') === 'notebook';\n\t\t\t\t\t}\n\t\t\t\t\treturn resource.scheme === Schemas.untitled || resource.scheme === Schemas.vscodeNotebookCell || this._fileService.hasProvider(resource);\n\t\t\t\t}\n\t\t\t};\n\t\t\tconst notebookEditorInputFactory: EditorInputFactoryFunction = async ({ resource, options }) => {\n\t\t\t\tlet data;\n\t\t\t\tif (resource.scheme === Schemas.vscodeNotebookCellOutput) {\n\t\t\t\t\tconst outputUriData = CellUri.parseCellOutputUri(resource);\n\t\t\t\t\tif (!outputUriData || !outputUriData.notebook || outputUriData.cellHandle === undefined) {\n\t\t\t\t\t\tthrow new Error('Invalid cell output uri');\n\t\t\t\t\t}\n\n\t\t\t\t\tdata = {\n\t\t\t\t\t\tnotebook: outputUriData.notebook,\n\t\t\t\t\t\thandle: outputUriData.cellHandle\n\t\t\t\t\t};\n\n\t\t\t\t} else {\n\t\t\t\t\tdata = CellUri.parse(resource);\n\t\t\t\t}\n\n\t\t\t\tlet notebookUri: URI;\n\n\t\t\t\tlet cellOptions: IResourceEditorInput | undefined;\n\n\t\t\t\tif (data) {\n\t\t\t\t\t// resource is a notebook cell\n\t\t\t\t\tnotebookUri = this.uriIdentService.asCanonicalUri(data.notebook);\n\t\t\t\t\tcellOptions = { resource, options };\n\t\t\t\t} else {\n\t\t\t\t\tnotebookUri = this.uriIdentService.asCanonicalUri(resource);\n\t\t\t\t}\n\n\t\t\t\tif (!cellOptions) {\n\t\t\t\t\tcellOptions = (options as INotebookEditorOptions | undefined)?.cellOptions;\n\t\t\t\t}\n\n\t\t\t\tlet notebookOptions: INotebookEditorOptions;\n\n\t\t\t\tif (resource.scheme === Schemas.vscodeNotebookCellOutput) {\n\t\t\t\t\tif (data?.handle === undefined || !data?.notebook) {\n\t\t\t\t\t\tthrow new Error('Invalid cell handle');\n\t\t\t\t\t}\n\n\t\t\t\t\tconst cellUri = CellUri.generate(data.notebook, data.handle);\n\n\t\t\t\t\tcellOptions = { resource: cellUri, options };\n\n\t\t\t\t\tconst cellIndex = await this._notebookEditorModelResolverService.resolve(notebookUri)\n\t\t\t\t\t\t.then(model => model.object.notebook.cells.findIndex(cell => cell.handle === data?.handle))\n\t\t\t\t\t\t.then(index => index >= 0 ? index : 0);\n\n\t\t\t\t\tconst cellIndexesToRanges: ICellRange[] = [{ start: cellIndex, end: cellIndex + 1 }];\n\n\t\t\t\t\tnotebookOptions = {\n\t\t\t\t\t\t...options,\n\t\t\t\t\t\tcellOptions,\n\t\t\t\t\t\tviewState: undefined,\n\t\t\t\t\t\tcellSelections: cellIndexesToRanges\n\t\t\t\t\t};\n\t\t\t\t} else {\n\t\t\t\t\tnotebookOptions = {\n\t\t\t\t\t\t...options,\n\t\t\t\t\t\tcellOptions,\n\t\t\t\t\t\tviewState: undefined,\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t\tconst preferredResourceParam = cellOptions?.resource;\n\t\t\t\tconst editor = NotebookEditorInput.getOrCreate(this._instantiationService, notebookUri, preferredResourceParam, notebookProviderInfo.id);\n\t\t\t\treturn { editor, options: notebookOptions };\n\t\t\t};\n\n\t\t\tconst notebookUntitledEditorFactory: UntitledEditorInputFactoryFunction = async ({ resource, options }) => {\n\t\t\t\tconst ref = await this._notebookEditorModelResolverService.resolve({ untitledResource: resource }, notebookProviderInfo.id);\n\n\t\t\t\t// untitled notebooks are disposed when they get saved. we should not hold a reference\n\t\t\t\t// to such a disposed notebook and therefore dispose the reference as well\n\t\t\t\tEvent.once(ref.object.notebook.onWillDispose)(() => {\n\t\t\t\t\tref.dispose();\n\t\t\t\t});\n\n\t\t\t\treturn { editor: NotebookEditorInput.getOrCreate(this._instantiationService, ref.object.resource, undefined, notebookProviderInfo.id), options };\n\t\t\t};\n\t\t\tconst notebookDiffEditorInputFactory: DiffEditorInputFactoryFunction = (diffEditorInput: IResourceDiffEditorInput, group: IEditorGroup) => {\n\t\t\t\tconst { modified, original, label, description } = diffEditorInput;\n\n\t\t\t\tif (this._configurationService.getValue('notebook.experimental.enableNewDiffEditor')) {\n\t\t\t\t\treturn { editor: NotebookMultiDiffEditorInput.create(this._instantiationService, modified.resource!, label, description, original.resource!, notebookProviderInfo.id) };\n\t\t\t\t}\n\t\t\t\treturn { editor: NotebookDiffEditorInput.create(this._instantiationService, modified.resource!, label, description, original.resource!, notebookProviderInfo.id) };\n\t\t\t};\n\t\t\tconst mergeEditorInputFactory: MergeEditorInputFactoryFunction = (mergeEditor: IResourceMergeEditorInput): EditorInputWithOptions => {\n\t\t\t\treturn {\n\t\t\t\t\teditor: this._instantiationService.createInstance(\n\t\t\t\t\t\tMergeEditorInput,\n\t\t\t\t\t\tmergeEditor.base.resource,\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\turi: mergeEditor.input1.resource,\n\t\t\t\t\t\t\ttitle: mergeEditor.input1.label ?? basename(mergeEditor.input1.resource),\n\t\t\t\t\t\t\tdescription: mergeEditor.input1.description ?? '',\n\t\t\t\t\t\t\tdetail: mergeEditor.input1.detail\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\turi: mergeEditor.input2.resource,\n\t\t\t\t\t\t\ttitle: mergeEditor.input2.label ?? basename(mergeEditor.input2.resource),\n\t\t\t\t\t\t\tdescription: mergeEditor.input2.description ?? '',\n\t\t\t\t\t\t\tdetail: mergeEditor.input2.detail\n\t\t\t\t\t\t},\n\t\t\t\t\t\tmergeEditor.result.resource\n\t\t\t\t\t)\n\t\t\t\t};\n\t\t\t};\n\n\t\t\tconst notebookFactoryObject: EditorInputFactoryObject = {\n\t\t\t\tcreateEditorInput: notebookEditorInputFactory,\n\t\t\t\tcreateDiffEditorInput: notebookDiffEditorInputFactory,\n\t\t\t\tcreateUntitledEditorInput: notebookUntitledEditorFactory,\n\t\t\t\tcreateMergeEditorInput: mergeEditorInputFactory\n\t\t\t};\n\t\t\tconst notebookCellFactoryObject: EditorInputFactoryObject = {\n\t\t\t\tcreateEditorInput: notebookEditorInputFactory,\n\t\t\t\tcreateDiffEditorInput: notebookDiffEditorInputFactory,\n\t\t\t};\n\n\t\t\t// TODO @lramos15 find a better way to toggle handling diff editors than needing these listeners for every registration\n\t\t\t// This is a lot of event listeners especially if there are many notebooks\n\t\t\tdisposables.add(this._configurationService.onDidChangeConfiguration(e => {\n\t\t\t\tif (e.affectsConfiguration(NotebookSetting.textDiffEditorPreview)) {\n\t\t\t\t\tconst canHandleDiff = !!this._configurationService.getValue(NotebookSetting.textDiffEditorPreview) && !this._accessibilityService.isScreenReaderOptimized();\n\t\t\t\t\tif (canHandleDiff) {\n\t\t\t\t\t\tnotebookFactoryObject.createDiffEditorInput = notebookDiffEditorInputFactory;\n\t\t\t\t\t\tnotebookCellFactoryObject.createDiffEditorInput = notebookDiffEditorInputFactory;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tnotebookFactoryObject.createDiffEditorInput = undefined;\n\t\t\t\t\t\tnotebookCellFactoryObject.createDiffEditorInput = undefined;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}));\n\n\t\t\tdisposables.add(this._accessibilityService.onDidChangeScreenReaderOptimized(() => {\n\t\t\t\tconst canHandleDiff = !!this._configurationService.getValue(NotebookSetting.textDiffEditorPreview) && !this._accessibilityService.isScreenReaderOptimized();\n\t\t\t\tif (canHandleDiff) {\n\t\t\t\t\tnotebookFactoryObject.createDiffEditorInput = notebookDiffEditorInputFactory;\n\t\t\t\t\tnotebookCellFactoryObject.createDiffEditorInput = notebookDiffEditorInputFactory;\n\t\t\t\t} else {\n\t\t\t\t\tnotebookFactoryObject.createDiffEditorInput = undefined;\n\t\t\t\t\tnotebookCellFactoryObject.createDiffEditorInput = undefined;\n\t\t\t\t}\n\t\t\t}));\n\n\t\t\t// Register the notebook editor\n\t\t\tdisposables.add(this._editorResolverService.registerEditor(\n\t\t\t\tglobPattern,\n\t\t\t\tnotebookEditorInfo,\n\t\t\t\tnotebookEditorOptions,\n\t\t\t\tnotebookFactoryObject,\n\t\t\t));\n\t\t\t// Then register the schema handler as exclusive for that notebook\n\t\t\tdisposables.add(this._editorResolverService.registerEditor(\n\t\t\t\t`${Schemas.vscodeNotebookCell}:/**/${globPattern}`,\n\t\t\t\t{ ...notebookEditorInfo, priority: RegisteredEditorPriority.exclusive },\n\t\t\t\tnotebookEditorOptions,\n\t\t\t\tnotebookCellFactoryObject\n\t\t\t));\n\t\t}\n\n\t\treturn disposables;\n\t}\n\n\n\tprivate _clear(): void {\n\t\tthis._contributedEditors.clear();\n\t\tthis._contributedEditorDisposables.clear();\n\t}\n\n\tget(viewType: string): NotebookProviderInfo | undefined {\n\t\treturn this._contributedEditors.get(viewType);\n\t}\n\n\tadd(info: NotebookProviderInfo, saveMemento = true): IDisposable {\n\t\tif (this._contributedEditors.has(info.id)) {\n\t\t\tthrow new Error(`notebook type '${info.id}' ALREADY EXISTS`);\n\t\t}\n\t\tthis._contributedEditors.set(info.id, info);\n\t\tlet editorRegistration: IDisposable | undefined;\n\n\t\t// built-in notebook providers contribute their own editors\n\t\tif (info.extension) {\n\t\t\teditorRegistration = this._registerContributionPoint(info);\n\t\t\tthis._contributedEditorDisposables.add(editorRegistration);\n\t\t}\n\n\t\tif (saveMemento) {\n\t\t\tconst mementoObject = this._memento.getMemento(StorageScope.PROFILE, StorageTarget.MACHINE);\n\t\t\tmementoObject[NotebookProviderInfoStore.CUSTOM_EDITORS_ENTRY_ID] = Array.from(this._contributedEditors.values());\n\t\t\tthis._memento.saveMemento();\n\t\t}\n\n\t\treturn this._register(toDisposable(() => {\n\t\t\tconst mementoObject = this._memento.getMemento(StorageScope.PROFILE, StorageTarget.MACHINE);\n\t\t\tmementoObject[NotebookProviderInfoStore.CUSTOM_EDITORS_ENTRY_ID] = Array.from(this._contributedEditors.values());\n\t\t\tthis._memento.saveMemento();\n\t\t\teditorRegistration?.dispose();\n\t\t\tthis._contributedEditors.delete(info.id);\n\t\t}));\n\t}\n\n\tgetContributedNotebook(resource: URI): readonly NotebookProviderInfo[] {\n\t\tconst result: NotebookProviderInfo[] = [];\n\t\tfor (const info of this._contributedEditors.values()) {\n\t\t\tif (info.matches(resource)) {\n\t\t\t\tresult.push(info);\n\t\t\t}\n\t\t}\n\t\tif (result.length === 0 && resource.scheme === Schemas.untitled) {\n\t\t\t// untitled resource and no path-specific match => all providers apply\n\t\t\treturn Array.from(this._contributedEditors.values());\n\t\t}\n\t\treturn result;\n\t}\n\n\t[Symbol.iterator](): Iterator<NotebookProviderInfo> {\n\t\treturn this._contributedEditors.values();\n\t}\n}\n\ninterface NotebookOutputRendererInfoStoreMemento {\n\t[notebookType: string]: { [mimeType: string]: string } | undefined;\n}\n\nexport class NotebookOutputRendererInfoStore {\n\tprivate readonly contributedRenderers = new Map</* rendererId */ string, NotebookOutputRendererInfo>();\n\tprivate readonly preferredMimetypeMemento: Memento<NotebookOutputRendererInfoStoreMemento>;\n\tprivate readonly preferredMimetype = new Lazy<NotebookOutputRendererInfoStoreMemento>(\n\t\t() => this.preferredMimetypeMemento.getMemento(StorageScope.WORKSPACE, StorageTarget.MACHINE));\n\n\tconstructor(\n\t\t@IStorageService storageService: IStorageService,\n\t) {\n\t\tthis.preferredMimetypeMemento = new Memento('workbench.editor.notebook.preferredRenderer2', storageService);\n\t}\n\n\tclear() {\n\t\tthis.contributedRenderers.clear();\n\t}\n\n\tget(rendererId: string): NotebookOutputRendererInfo | undefined {\n\t\treturn this.contributedRenderers.get(rendererId);\n\t}\n\n\tgetAll(): NotebookOutputRendererInfo[] {\n\t\treturn Array.from(this.contributedRenderers.values());\n\t}\n\n\tadd(info: NotebookOutputRendererInfo): void {\n\t\tif (this.contributedRenderers.has(info.id)) {\n\t\t\treturn;\n\t\t}\n\t\tthis.contributedRenderers.set(info.id, info);\n\t}\n\n\t/** Update and remember the preferred renderer for the given mimetype in this workspace */\n\tsetPreferred(notebookProviderInfo: NotebookProviderInfo, mimeType: string, rendererId: string) {\n\t\tconst mementoObj = this.preferredMimetype.value;\n\t\tconst forNotebook = mementoObj[notebookProviderInfo.id];\n\t\tif (forNotebook) {\n\t\t\tforNotebook[mimeType] = rendererId;\n\t\t} else {\n\t\t\tmementoObj[notebookProviderInfo.id] = { [mimeType]: rendererId };\n\t\t}\n\n\t\tthis.preferredMimetypeMemento.saveMemento();\n\t}\n\n\tfindBestRenderers(notebookProviderInfo: NotebookProviderInfo | undefined, mimeType: string, kernelProvides: readonly string[] | undefined): IOrderedMimeType[] {\n\n\t\tconst enum ReuseOrder {\n\t\t\tPreviouslySelected = 1 << 8,\n\t\t\tSameExtensionAsNotebook = 2 << 8,\n\t\t\tOtherRenderer = 3 << 8,\n\t\t\tBuiltIn = 4 << 8,\n\t\t}\n\n\t\tconst preferred = notebookProviderInfo && this.preferredMimetype.value[notebookProviderInfo.id]?.[mimeType];\n\t\tconst notebookExtId = notebookProviderInfo?.extension?.value;\n\t\tconst notebookId = notebookProviderInfo?.id;\n\t\tconst renderers: { ordered: IOrderedMimeType; score: number }[] = Array.from(this.contributedRenderers.values())\n\t\t\t.map(renderer => {\n\t\t\t\tconst ownScore = kernelProvides === undefined\n\t\t\t\t\t? renderer.matchesWithoutKernel(mimeType)\n\t\t\t\t\t: renderer.matches(mimeType, kernelProvides);\n\n\t\t\t\tif (ownScore === NotebookRendererMatch.Never) {\n\t\t\t\t\treturn undefined;\n\t\t\t\t}\n\n\t\t\t\tconst rendererExtId = renderer.extensionId.value;\n\t\t\t\tconst reuseScore = preferred === renderer.id\n\t\t\t\t\t? ReuseOrder.PreviouslySelected\n\t\t\t\t\t: rendererExtId === notebookExtId || RENDERER_EQUIVALENT_EXTENSIONS.get(rendererExtId)?.has(notebookId!)\n\t\t\t\t\t\t? ReuseOrder.SameExtensionAsNotebook\n\t\t\t\t\t\t: renderer.isBuiltin ? ReuseOrder.BuiltIn : ReuseOrder.OtherRenderer;\n\t\t\t\treturn {\n\t\t\t\t\tordered: { mimeType, rendererId: renderer.id, isTrusted: true },\n\t\t\t\t\tscore: reuseScore | ownScore,\n\t\t\t\t};\n\t\t\t}).filter(isDefined);\n\n\t\tif (renderers.length === 0) {\n\t\t\treturn [{ mimeType, rendererId: RENDERER_NOT_AVAILABLE, isTrusted: true }];\n\t\t}\n\n\t\treturn renderers.sort((a, b) => a.score - b.score).map(r => r.ordered);\n\t}\n}\n\nclass ModelData implements IDisposable, INotebookDocument {\n\tprivate readonly _modelEventListeners = new DisposableStore();\n\tget uri() { return this.model.uri; }\n\n\tconstructor(\n\t\treadonly model: NotebookTextModel,\n\t\tonWillDispose: (model: INotebookTextModel) => void\n\t) {\n\t\tthis._modelEventListeners.add(model.onWillDispose(() => onWillDispose(model)));\n\t}\n\n\tgetCellIndex(cellUri: URI): number | undefined {\n\t\treturn this.model.cells.findIndex(cell => isEqual(cell.uri, cellUri));\n\t}\n\n\tdispose(): void {\n\t\tthis._modelEventListeners.dispose();\n\t}\n}\n\ninterface NotebookServiceMemento {\n\t[viewType: string]: string | undefined;\n}\n\nexport class NotebookService extends Disposable implements INotebookService {\n\n\tdeclare readonly _serviceBrand: undefined;\n\tprivate static _storageNotebookViewTypeProvider = 'notebook.viewTypeProvider';\n\tprivate readonly _memento: Memento<NotebookServiceMemento>;\n\tprivate readonly _viewTypeCache: NotebookServiceMemento;\n\n\tprivate readonly _notebookProviders;\n\tprivate _notebookProviderInfoStore: NotebookProviderInfoStore | undefined;\n\tprivate get notebookProviderInfoStore(): NotebookProviderInfoStore {\n\t\tif (!this._notebookProviderInfoStore) {\n\t\t\tthis._notebookProviderInfoStore = this._register(this._instantiationService.createInstance(NotebookProviderInfoStore));\n\t\t}\n\n\t\treturn this._notebookProviderInfoStore;\n\t}\n\tprivate readonly _notebookRenderersInfoStore;\n\tprivate readonly _onDidChangeOutputRenderers;\n\treadonly onDidChangeOutputRenderers;\n\n\tprivate readonly _notebookStaticPreloadInfoStore;\n\n\tprivate readonly _models;\n\n\tprivate readonly _onWillAddNotebookDocument;\n\tprivate readonly _onDidAddNotebookDocument;\n\tprivate readonly _onWillRemoveNotebookDocument;\n\tprivate readonly _onDidRemoveNotebookDocument;\n\n\treadonly onWillAddNotebookDocument;\n\treadonly onDidAddNotebookDocument;\n\treadonly onDidRemoveNotebookDocument;\n\treadonly onWillRemoveNotebookDocument;\n\n\tprivate readonly _onAddViewType;\n\treadonly onAddViewType;\n\n\tprivate readonly _onWillRemoveViewType;\n\treadonly onWillRemoveViewType;\n\n\tprivate readonly _onDidChangeEditorTypes;\n\treadonly onDidChangeEditorTypes: Event<void>;\n\n\tprivate _cutItems: NotebookCellTextModel[] | undefined;\n\tprivate _lastClipboardIsCopy: boolean;\n\n\tprivate _displayOrder!: MimeTypeDisplayOrder;\n\n\tconstructor(\n\t\t@IExtensionService private readonly _extensionService: IExtensionService,\n\t\t@IConfigurationService private readonly _configurationService: IConfigurationService,\n\t\t@IAccessibilityService private readonly _accessibilityService: IAccessibilityService,\n\t\t@IInstantiationService private readonly _instantiationService: IInstantiationService,\n\t\t@IStorageService private readonly _storageService: IStorageService,\n\t\t@INotebookDocumentService private readonly _notebookDocumentService: INotebookDocumentService\n\t) {\n\t\tsuper();\n\t\tthis._notebookProviders = new Map<string, SimpleNotebookProviderInfo>();\n\t\tthis._notebookProviderInfoStore = undefined;\n\t\tthis._notebookRenderersInfoStore = this._instantiationService.createInstance(NotebookOutputRendererInfoStore);\n\t\tthis._onDidChangeOutputRenderers = this._register(new Emitter<void>());\n\t\tthis.onDidChangeOutputRenderers = this._onDidChangeOutputRenderers.event;\n\t\tthis._notebookStaticPreloadInfoStore = new Set<NotebookStaticPreloadInfo>();\n\t\tthis._models = new ResourceMap<ModelData>();\n\t\tthis._onWillAddNotebookDocument = this._register(new Emitter<NotebookTextModel>());\n\t\tthis._onDidAddNotebookDocument = this._register(new Emitter<NotebookTextModel>());\n\t\tthis._onWillRemoveNotebookDocument = this._register(new Emitter<NotebookTextModel>());\n\t\tthis._onDidRemoveNotebookDocument = this._register(new Emitter<NotebookTextModel>());\n\t\tthis.onWillAddNotebookDocument = this._onWillAddNotebookDocument.event;\n\t\tthis.onDidAddNotebookDocument = this._onDidAddNotebookDocument.event;\n\t\tthis.onDidRemoveNotebookDocument = this._onDidRemoveNotebookDocument.event;\n\t\tthis.onWillRemoveNotebookDocument = this._onWillRemoveNotebookDocument.event;\n\t\tthis._onAddViewType = this._register(new Emitter<string>());\n\t\tthis.onAddViewType = this._onAddViewType.event;\n\t\tthis._onWillRemoveViewType = this._register(new Emitter<string>());\n\t\tthis.onWillRemoveViewType = this._onWillRemoveViewType.event;\n\t\tthis._onDidChangeEditorTypes = this._register(new Emitter<void>());\n\t\tthis.onDidChangeEditorTypes = this._onDidChangeEditorTypes.event;\n\t\tthis._lastClipboardIsCopy = true;\n\n\t\tnotebookRendererExtensionPoint.setHandler((renderers) => {\n\t\t\tthis._notebookRenderersInfoStore.clear();\n\n\t\t\tfor (const extension of renderers) {\n\t\t\t\tfor (const notebookContribution of extension.value) {\n\t\t\t\t\tif (!notebookContribution.entrypoint) { // avoid crashing\n\t\t\t\t\t\textension.collector.error(`Notebook renderer does not specify entry point`);\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\n\t\t\t\t\tconst id = notebookContribution.id;\n\t\t\t\t\tif (!id) {\n\t\t\t\t\t\textension.collector.error(`Notebook renderer does not specify id-property`);\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis._notebookRenderersInfoStore.add(new NotebookOutputRendererInfo({\n\t\t\t\t\t\tid,\n\t\t\t\t\t\textension: extension.description,\n\t\t\t\t\t\tentrypoint: notebookContribution.entrypoint,\n\t\t\t\t\t\tdisplayName: notebookContribution.displayName,\n\t\t\t\t\t\tmimeTypes: notebookContribution.mimeTypes || [],\n\t\t\t\t\t\tdependencies: notebookContribution.dependencies,\n\t\t\t\t\t\toptionalDependencies: notebookContribution.optionalDependencies,\n\t\t\t\t\t\trequiresMessaging: notebookContribution.requiresMessaging,\n\t\t\t\t\t}));\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis._onDidChangeOutputRenderers.fire();\n\t\t});\n\n\t\tnotebookPreloadExtensionPoint.setHandler(extensions => {\n\t\t\tthis._notebookStaticPreloadInfoStore.clear();\n\n\t\t\tfor (const extension of extensions) {\n\t\t\t\tif (!isProposedApiEnabled(extension.description, 'contribNotebookStaticPreloads')) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tfor (const notebookContribution of extension.value) {\n\t\t\t\t\tif (!notebookContribution.entrypoint) { // avoid crashing\n\t\t\t\t\t\textension.collector.error(`Notebook preload does not specify entry point`);\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\n\t\t\t\t\tconst type = notebookContribution.type;\n\t\t\t\t\tif (!type) {\n\t\t\t\t\t\textension.collector.error(`Notebook preload does not specify type-property`);\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis._notebookStaticPreloadInfoStore.add(new NotebookStaticPreloadInfo({\n\t\t\t\t\t\ttype,\n\t\t\t\t\t\textension: extension.description,\n\t\t\t\t\t\tentrypoint: notebookContribution.entrypoint,\n\t\t\t\t\t\tlocalResourceRoots: notebookContribution.localResourceRoots ?? [],\n\t\t\t\t\t}));\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tconst updateOrder = () => {\n\t\t\tthis._displayOrder = new MimeTypeDisplayOrder(\n\t\t\t\tthis._configurationService.getValue<string[]>(NotebookSetting.displayOrder) || [],\n\t\t\t\tthis._accessibilityService.isScreenReaderOptimized()\n\t\t\t\t\t? ACCESSIBLE_NOTEBOOK_DISPLAY_ORDER\n\t\t\t\t\t: NOTEBOOK_DISPLAY_ORDER,\n\t\t\t);\n\t\t};\n\n\t\tupdateOrder();\n\n\t\tthis._register(this._configurationService.onDidChangeConfiguration(e => {\n\t\t\tif (e.affectsConfiguration(NotebookSetting.displayOrder)) {\n\t\t\t\tupdateOrder();\n\t\t\t}\n\t\t}));\n\n\t\tthis._register(this._accessibilityService.onDidChangeScreenReaderOptimized(() => {\n\t\t\tupdateOrder();\n\t\t}));\n\n\t\tthis._memento = new Memento(NotebookService._storageNotebookViewTypeProvider, this._storageService);\n\t\tthis._viewTypeCache = this._memento.getMemento(StorageScope.WORKSPACE, StorageTarget.MACHINE);\n\t}\n\n\n\tgetEditorTypes(): IEditorType[] {\n\t\treturn [...this.notebookProviderInfoStore].map(info => ({\n\t\t\tid: info.id,\n\t\t\tdisplayName: info.displayName,\n\t\t\tproviderDisplayName: info.providerDisplayName\n\t\t}));\n\t}\n\n\tclearEditorCache(): void {\n\t\tthis.notebookProviderInfoStore.clearEditorCache();\n\t}\n\n\tprivate _postDocumentOpenActivation(viewType: string) {\n\t\t// send out activations on notebook text model creation\n\t\tthis._extensionService.activateByEvent(`onNotebook:${viewType}`);\n\t\tthis._extensionService.activateByEvent(`onNotebook:*`);\n\t}\n\n\tasync canResolve(viewType: string): Promise<boolean> {\n\t\tif (this._notebookProviders.has(viewType)) {\n\t\t\treturn true;\n\t\t}\n\n\t\tawait this._extensionService.whenInstalledExtensionsRegistered();\n\t\tawait this._extensionService.activateByEvent(`onNotebookSerializer:${viewType}`);\n\n\t\treturn this._notebookProviders.has(viewType);\n\t}\n\n\tregisterContributedNotebookType(viewType: string, data: INotebookContributionData): IDisposable {\n\n\t\tconst info = new NotebookProviderInfo({\n\t\t\textension: data.extension,\n\t\t\tid: viewType,\n\t\t\tdisplayName: data.displayName,\n\t\t\tproviderDisplayName: data.providerDisplayName,\n\t\t\tpriority: data.priority || RegisteredEditorPriority.default,\n\t\t\tselectors: []\n\t\t});\n\n\t\tinfo.update({ selectors: data.filenamePattern });\n\n\t\tconst reg = this.notebookProviderInfoStore.add(info);\n\t\tthis._onDidChangeEditorTypes.fire();\n\n\t\treturn toDisposable(() => {\n\t\t\treg.dispose();\n\t\t\tthis._onDidChangeEditorTypes.fire();\n\t\t});\n\t}\n\n\tprivate _registerProviderData(viewType: string, data: SimpleNotebookProviderInfo): IDisposable {\n\t\tif (this._notebookProviders.has(viewType)) {\n\t\t\tthrow new Error(`notebook provider for viewtype '${viewType}' already exists`);\n\t\t}\n\t\tthis._notebookProviders.set(viewType, data);\n\t\tthis._onAddViewType.fire(viewType);\n\t\treturn toDisposable(() => {\n\t\t\tthis._onWillRemoveViewType.fire(viewType);\n\t\t\tthis._notebookProviders.delete(viewType);\n\t\t});\n\t}\n\n\tregisterNotebookSerializer(viewType: string, extensionData: NotebookExtensionDescription, serializer: INotebookSerializer): IDisposable {\n\t\tthis.notebookProviderInfoStore.get(viewType)?.update({ options: serializer.options });\n\t\tthis._viewTypeCache[viewType] = extensionData.id.value;\n\t\tthis._persistMementos();\n\t\treturn this._registerProviderData(viewType, new SimpleNotebookProviderInfo(viewType, serializer, extensionData));\n\t}\n\n\tasync withNotebookDataProvider(viewType: string): Promise<SimpleNotebookProviderInfo> {\n\t\tconst selected = this.notebookProviderInfoStore.get(viewType);\n\t\tif (!selected) {\n\t\t\tconst knownProvider = this.getViewTypeProvider(viewType);\n\n\t\t\tconst actions = knownProvider ? [\n\t\t\t\ttoAction({\n\t\t\t\t\tid: 'workbench.notebook.action.installMissingViewType', label: localize('notebookOpenInstallMissingViewType', \"Install extension for '{0}'\", viewType), run: async () => {\n\t\t\t\t\t\tawait this._instantiationService.createInstance(InstallRecommendedExtensionAction, knownProvider).run();\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t] : [];\n\n\t\t\tthrow createErrorWithActions(`UNKNOWN notebook type '${viewType}'`, actions);\n\t\t}\n\t\tawait this.canResolve(selected.id);\n\t\tconst result = this._notebookProviders.get(selected.id);\n\t\tif (!result) {\n\t\t\tthrow new Error(`NO provider registered for view type: '${selected.id}'`);\n\t\t}\n\t\treturn result;\n\t}\n\n\ttryGetDataProviderSync(viewType: string): SimpleNotebookProviderInfo | undefined {\n\t\tconst selected = this.notebookProviderInfoStore.get(viewType);\n\t\tif (!selected) {\n\t\t\treturn undefined;\n\t\t}\n\t\treturn this._notebookProviders.get(selected.id);\n\t}\n\n\n\tprivate _persistMementos(): void {\n\t\tthis._memento.saveMemento();\n\t}\n\n\tgetViewTypeProvider(viewType: string): string | undefined {\n\t\treturn this._viewTypeCache[viewType];\n\t}\n\n\tgetRendererInfo(rendererId: string): INotebookRendererInfo | undefined {\n\t\treturn this._notebookRenderersInfoStore.get(rendererId);\n\t}\n\n\tupdateMimePreferredRenderer(viewType: string, mimeType: string, rendererId: string, otherMimetypes: readonly string[]): void {\n\t\tconst info = this.notebookProviderInfoStore.get(viewType);\n\t\tif (info) {\n\t\t\tthis._notebookRenderersInfoStore.setPreferred(info, mimeType, rendererId);\n\t\t}\n\n\t\tthis._displayOrder.prioritize(mimeType, otherMimetypes);\n\t}\n\n\tsaveMimeDisplayOrder(target: ConfigurationTarget) {\n\t\tthis._configurationService.updateValue(NotebookSetting.displayOrder, this._displayOrder.toArray(), target);\n\t}\n\n\tgetRenderers(): INotebookRendererInfo[] {\n\t\treturn this._notebookRenderersInfoStore.getAll();\n\t}\n\n\t*getStaticPreloads(viewType: string): Iterable<INotebookStaticPreloadInfo> {\n\t\tfor (const preload of this._notebookStaticPreloadInfoStore) {\n\t\t\tif (preload.type === viewType) {\n\t\t\t\tyield preload;\n\t\t\t}\n\t\t}\n\t}\n\n\t// --- notebook documents: create, destory, retrieve, enumerate\n\n\tasync createNotebookTextModel(viewType: string, uri: URI, stream?: VSBufferReadableStream): Promise<NotebookTextModel> {\n\t\tif (this._models.has(uri)) {\n\t\t\tthrow new Error(`notebook for ${uri} already exists`);\n\t\t}\n\n\t\tconst info = await this.withNotebookDataProvider(viewType);\n\t\tif (!(info instanceof SimpleNotebookProviderInfo)) {\n\t\t\tthrow new Error('CANNOT open file notebook with this provider');\n\t\t}\n\n\n\t\tconst bytes = stream ? await streamToBuffer(stream) : VSBuffer.fromByteArray([]);\n\t\tconst data = await info.serializer.dataToNotebook(bytes);\n\n\n\t\tconst notebookModel = this._instantiationService.createInstance(NotebookTextModel, info.viewType, uri, data.cells, data.metadata, info.serializer.options);\n\t\tconst modelData = new ModelData(notebookModel, this._onWillDisposeDocument.bind(this));\n\t\tthis._models.set(uri, modelData);\n\t\tthis._notebookDocumentService.addNotebookDocument(modelData);\n\t\tthis._onWillAddNotebookDocument.fire(notebookModel);\n\t\tthis._onDidAddNotebookDocument.fire(notebookModel);\n\t\tthis._postDocumentOpenActivation(info.viewType);\n\t\treturn notebookModel;\n\t}\n\n\tasync createNotebookTextDocumentSnapshot(uri: URI, context: SnapshotContext, token: CancellationToken): Promise<VSBufferReadableStream> {\n\t\tconst model = this.getNotebookTextModel(uri);\n\n\t\tif (!model) {\n\t\t\tthrow new Error(`notebook for ${uri} doesn't exist`);\n\t\t}\n\n\t\tconst info = await this.withNotebookDataProvider(model.viewType);\n\n\t\tif (!(info instanceof SimpleNotebookProviderInfo)) {\n\t\t\tthrow new Error('CANNOT open file notebook with this provider');\n\t\t}\n\n\t\tconst serializer = info.serializer;\n\t\tconst outputSizeLimit = this._configurationService.getValue<number>(NotebookSetting.outputBackupSizeLimit) * 1024;\n\t\tconst data: NotebookData = model.createSnapshot({ context: context, outputSizeLimit: outputSizeLimit, transientOptions: serializer.options });\n\t\tconst indentAmount = model.metadata.indentAmount;\n\t\tif (typeof indentAmount === 'string' && indentAmount) {\n\t\t\t// This is required for ipynb serializer to preserve the whitespace in the notebook.\n\t\t\tdata.metadata.indentAmount = indentAmount;\n\t\t}\n\t\tconst bytes = await serializer.notebookToData(data);\n\n\t\tif (token.isCancellationRequested) {\n\t\t\tthrow new CancellationError();\n\t\t}\n\t\treturn bufferToStream(bytes);\n\t}\n\n\tasync restoreNotebookTextModelFromSnapshot(uri: URI, viewType: string, snapshot: VSBufferReadableStream): Promise<NotebookTextModel> {\n\t\tconst model = this.getNotebookTextModel(uri);\n\n\t\tif (!model) {\n\t\t\tthrow new Error(`notebook for ${uri} doesn't exist`);\n\t\t}\n\n\t\tconst info = await this.withNotebookDataProvider(model.viewType);\n\n\t\tif (!(info instanceof SimpleNotebookProviderInfo)) {\n\t\t\tthrow new Error('CANNOT open file notebook with this provider');\n\t\t}\n\n\t\tconst serializer = info.serializer;\n\n\t\tconst bytes = await streamToBuffer(snapshot);\n\t\tconst data = await info.serializer.dataToNotebook(bytes);\n\t\tmodel.restoreSnapshot(data, serializer.options);\n\n\t\treturn model;\n\t}\n\n\tgetNotebookTextModel(uri: URI): NotebookTextModel | undefined {\n\t\treturn this._models.get(uri)?.model;\n\t}\n\n\tgetNotebookTextModels(): Iterable<NotebookTextModel> {\n\t\treturn Iterable.map(this._models.values(), data => data.model);\n\t}\n\n\tlistNotebookDocuments(): NotebookTextModel[] {\n\t\treturn [...this._models].map(e => e[1].model);\n\t}\n\n\tprivate _onWillDisposeDocument(model: INotebookTextModel): void {\n\t\tconst modelData = this._models.get(model.uri);\n\t\tif (modelData) {\n\t\t\tthis._onWillRemoveNotebookDocument.fire(modelData.model);\n\t\t\tthis._models.delete(model.uri);\n\t\t\tthis._notebookDocumentService.removeNotebookDocument(modelData);\n\t\t\tmodelData.dispose();\n\t\t\tthis._onDidRemoveNotebookDocument.fire(modelData.model);\n\t\t}\n\t}\n\n\tgetOutputMimeTypeInfo(textModel: NotebookTextModel, kernelProvides: readonly string[] | undefined, output: IOutputDto): readonly IOrderedMimeType[] {\n\t\tconst sorted = this._displayOrder.sort(new Set<string>(output.outputs.map(op => op.mime)));\n\t\tconst notebookProviderInfo = this.notebookProviderInfoStore.get(textModel.viewType);\n\n\t\treturn sorted\n\t\t\t.flatMap(mimeType => this._notebookRenderersInfoStore.findBestRenderers(notebookProviderInfo, mimeType, kernelProvides))\n\t\t\t.sort((a, b) => (a.rendererId === RENDERER_NOT_AVAILABLE ? 1 : 0) - (b.rendererId === RENDERER_NOT_AVAILABLE ? 1 : 0));\n\t}\n\n\tgetContributedNotebookTypes(resource?: URI): readonly NotebookProviderInfo[] {\n\t\tif (resource) {\n\t\t\treturn this.notebookProviderInfoStore.getContributedNotebook(resource);\n\t\t}\n\n\t\treturn [...this.notebookProviderInfoStore];\n\t}\n\n\thasSupportedNotebooks(resource: URI): boolean {\n\t\tif (this._models.has(resource)) {\n\t\t\t// it might be untitled\n\t\t\treturn true;\n\t\t}\n\n\t\tconst contribution = this.notebookProviderInfoStore.getContributedNotebook(resource);\n\t\tif (!contribution.length) {\n\t\t\treturn false;\n\t\t}\n\t\treturn contribution.some(info => info.matches(resource) &&\n\t\t\t(info.priority === RegisteredEditorPriority.default || info.priority === RegisteredEditorPriority.exclusive)\n\t\t);\n\t}\n\n\tgetContributedNotebookType(viewType: string): NotebookProviderInfo | undefined {\n\t\treturn this.notebookProviderInfoStore.get(viewType);\n\t}\n\n\tgetNotebookProviderResourceRoots(): URI[] {\n\t\tconst ret: URI[] = [];\n\t\tthis._notebookProviders.forEach(val => {\n\t\t\tif (val.extensionData.location) {\n\t\t\t\tret.push(URI.revive(val.extensionData.location));\n\t\t\t}\n\t\t});\n\n\t\treturn ret;\n\t}\n\n\t// --- copy & paste\n\n\tsetToCopy(items: NotebookCellTextModel[], isCopy: boolean) {\n\t\tthis._cutItems = items;\n\t\tthis._lastClipboardIsCopy = isCopy;\n\t}\n\n\tgetToCopy(): { items: NotebookCellTextModel[]; isCopy: boolean } | undefined {\n\t\tif (this._cutItems) {\n\t\t\treturn { items: this._cutItems, isCopy: this._lastClipboardIsCopy };\n\t\t}\n\n\t\treturn undefined;\n\t}\n\n}\n"]}