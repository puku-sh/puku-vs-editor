{"version":3,"sources":["vs/workbench/contrib/notebook/browser/controller/chat/cellChatActions.ts"],"names":[],"mappings":"AAAA;;;gGAGgG;AAEhG,OAAO,EAAE,OAAO,EAAE,MAAM,2CAA2C,CAAC;AACpE,OAAO,EAAE,QAAQ,EAAmB,MAAM,2CAA2C,CAAC;AACtF,OAAO,EAAE,QAAQ,EAAE,SAAS,EAAE,MAAM,0BAA0B,CAAC;AAC/D,OAAO,EAAE,MAAM,EAAE,YAAY,EAAE,eAAe,EAAE,MAAM,sDAAsD,CAAC;AAC7G,OAAO,EAAE,eAAe,EAAE,MAAM,wDAAwD,CAAC;AACzF,OAAO,EAAE,qBAAqB,EAAE,MAAM,kEAAkE,CAAC;AACzG,OAAO,EAAE,cAAc,EAAE,MAAM,4DAA4D,CAAC;AAC5F,OAAO,EAAE,sBAAsB,EAAE,MAAM,6DAA6D,CAAC;AAGrG,OAAO,EAAE,mCAAmC,EAAE,6BAA6B,EAAE,uBAAuB,EAA0B,8BAA8B,EAAE,MAAM,6CAA6C,CAAC;AAClN,OAAO,EAAE,2BAA2B,EAAE,MAAM,0BAA0B,CAAC;AACvE,OAAO,EAA0B,cAAc,EAAE,0BAA0B,EAAE,6BAA6B,EAAE,MAAM,mBAAmB,CAAC;AACtI,OAAO,EAAE,aAAa,EAAE,MAAM,yBAAyB,CAAC;AACxD,OAAO,EAAE,QAAQ,EAAE,eAAe,EAAE,MAAM,mCAAmC,CAAC;AAC9E,OAAO,EAAE,wBAAwB,EAAE,uBAAuB,EAAE,MAAM,wCAAwC,CAAC;AAC3G,OAAO,EAAE,QAAQ,EAAE,MAAM,2CAA2C,CAAC;AAErE,OAAO,EAAE,cAAc,EAAE,MAAM,wDAAwD,CAAC;AACxF,OAAO,EAAE,eAAe,EAAE,MAAM,4CAA4C,CAAC;AAC7E,OAAO,EAAE,oBAAoB,EAAE,MAAM,wDAAwD,CAAC;AAC9F,OAAO,EAAE,aAAa,EAAE,MAAM,sDAAsD,CAAC;AAQrF,KAAK,UAAU,SAAS,CAAC,QAA0B,EAAE,OAA+B,EAAE,KAAa,EAAE,KAAc,EAAE,QAAkB,EAAE,MAAe;IACvJ,MAAM,oBAAoB,GAAG,QAAQ,CAAC,GAAG,CAAC,qBAAqB,CAAC,CAAC;IACjE,MAAM,cAAc,GAAG,QAAQ,CAAC,GAAG,CAAC,eAAe,CAAC,CAAC;IAErD,IAAI,oBAAoB,CAAC,QAAQ,CAAU,eAAe,CAAC,YAAY,CAAC,IAAI,oBAAoB,CAAC,QAAQ,CAAU,eAAe,CAAC,QAAQ,CAAC,EAAE,CAAC;QAC9I,MAAM,UAAU,GAAG,OAAO,CAAC,cAAc,CAAC,aAAa,EAAE,CAAC;QAC1D,MAAM,UAAU,GAAG,UAAU,EAAE,aAAa,EAAE,KAAK,CAAC,IAAI,MAAM,KAAK,eAAe,CAAC,CAAC,CAAC,UAAU,CAAC,CAAC,CAAC,CAAC,MAAM,aAAa,CAAC,QAAQ,EAAE,OAAO,EAAE,QAAQ,CAAC,IAAI,EAAE,OAAO,EAAE,IAAI,CAAC,CAAC,CAAC;QAEzK,IAAI,UAAU,EAAE,CAAC;YAChB,UAAU,CAAC,2BAA2B,EAAE,CAAC;YACzC,MAAM,OAAO,CAAC,cAAc,CAAC,gCAAgC,CAAC,UAAU,CAAC,CAAC;YAC1E,MAAM,UAAU,GAAG,OAAO,CAAC,cAAc,CAAC,WAAW,CAAC,IAAI,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC,KAAK,UAAU,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC;YAC5F,IAAI,UAAU,EAAE,CAAC;gBAChB,UAAU,CAAC,KAAK,EAAE,CAAC;gBACnB,cAAc,CAAC,cAAc,CAAC,kBAAkB,CAAC,CAAC;YACnD,CAAC;QACF,CAAC;IACF,CAAC;AACF,CAAC;AAED,eAAe,CAAC,KAAM,SAAQ,cAAc;IAC3C;QACC,KAAK,CACJ;YACC,EAAE,EAAE,0BAA0B;YAC9B,KAAK,EAAE;gBACN,KAAK,EAAE,aAAa,GAAG,QAAQ,CAAC,KAA6C,EAAE,IAAU,CAAC;gBAC1F,QAAQ,EAAE,qBAAqB;aAC/B;YACD,OAAO,EAAE,QAAQ,CAAC,KAAqD,EAAE,IAA6B,CAAC;YACvG,QAAQ,EAAE;gBACT,WAAW,EAAE,QAAQ,CAAC,KAAqD,EAAE,IAA6B,CAAC;gBAC3G,IAAI,EAAE;oBACL;wBACC,IAAI,EAAE,MAAM;wBACZ,MAAM,EAAE;4BACP,IAAI,EAAE,QAAQ;4BACd,QAAQ,EAAE,CAAC,OAAO,CAAC;4BACnB,UAAU,EAAE;gCACX,OAAO,EAAE;oCACR,IAAI,EAAE,QAAQ;iCACd;gCACD,OAAO,EAAE;oCACR,IAAI,EAAE,QAAQ;iCACd;gCACD,UAAU,EAAE;oCACX,IAAI,EAAE,SAAS;iCACf;6BACD;yBACD;qBACD;iBACD;aACD;YACD,EAAE,EAAE,KAAK;YACT,UAAU,EAAE;gBACX,IAAI,EAAE,cAAc,CAAC,GAAG,CACvB,uBAAuB,EACvB,wBAAwB,CAAC,SAAS,CAAC,IAAI,CAAC,EACxC,cAAc,CAAC,GAAG,CAAC,sBAAsB,CAAC,EAC1C,2BAA2B,EAC3B,cAAc,CAAC,EAAE,CAChB,cAAc,CAAC,MAAM,CAAC,UAAU,eAAe,CAAC,QAAQ,EAAE,EAAE,IAAI,CAAC,EACjE,cAAc,CAAC,MAAM,CAAC,UAAU,eAAe,CAAC,YAAY,EAAE,EAAE,IAAI,CAAC,CACrE,CACD;gBACD,MAAM,6CAAmC;gBACzC,OAAO,EAAE,iDAA6B;gBACtC,SAAS,EAAE,CAAC,QAAQ,CAAC,iDAA6B,wBAAe,CAAC;aAClE;YACD,IAAI,EAAE;gBACL;oBACC,EAAE,EAAE,MAAM,CAAC,mBAAmB;oBAC9B,KAAK,EAAE,QAAQ;oBACf,KAAK,EAAE,CAAC,CAAC;oBACT,IAAI,EAAE,cAAc,CAAC,GAAG,CACvB,wBAAwB,CAAC,SAAS,CAAC,IAAI,CAAC,EACxC,2BAA2B,EAC3B,cAAc,CAAC,EAAE,CAChB,cAAc,CAAC,MAAM,CAAC,UAAU,eAAe,CAAC,QAAQ,EAAE,EAAE,IAAI,CAAC,EACjE,cAAc,CAAC,MAAM,CAAC,UAAU,eAAe,CAAC,YAAY,EAAE,EAAE,IAAI,CAAC,CACrE,CACD;iBACD;aACD;SACD,CAAC,CAAC;IACL,CAAC;IAEQ,gCAAgC,CAAC,QAA0B,EAAE,GAAG,IAAW;QACnF,MAAM,CAAC,QAAQ,CAAC,GAAG,IAAI,CAAC;QACxB,IAAI,CAAC,QAAQ,EAAE,CAAC;YACf,MAAM,cAAc,GAAG,6BAA6B,CAAC,QAAQ,CAAC,CAAC;YAC/D,IAAI,CAAC,cAAc,EAAE,CAAC;gBACrB,OAAO,SAAS,CAAC;YAClB,CAAC;YAED,MAAM,UAAU,GAAG,cAAc,CAAC,aAAa,EAAE,CAAC;YAClD,IAAI,CAAC,UAAU,EAAE,CAAC;gBACjB,OAAO,SAAS,CAAC;YAClB,CAAC;YAED,OAAO;gBACN,IAAI,EAAE,UAAU;gBAChB,cAAc;gBACd,KAAK,EAAE,SAAS;gBAChB,QAAQ,EAAE,SAAS;aACnB,CAAC;QACH,CAAC;QAED,IAAI,OAAO,QAAQ,KAAK,QAAQ,IAAI,OAAO,QAAQ,CAAC,KAAK,KAAK,QAAQ,EAAE,CAAC;YACxE,OAAO,SAAS,CAAC;QAClB,CAAC;QAED,MAAM,cAAc,GAAG,6BAA6B,CAAC,QAAQ,CAAC,CAAC;QAC/D,IAAI,CAAC,cAAc,EAAE,CAAC;YACrB,OAAO,SAAS,CAAC;QAClB,CAAC;QAED,MAAM,IAAI,GAAG,QAAQ,CAAC,KAAK,IAAI,CAAC,CAAC,CAAC,CAAC,SAAS,CAAC,CAAC,CAAC,cAAc,CAAC,MAAM,CAAC,QAAQ,CAAC,KAAK,GAAG,CAAC,CAAC,CAAC;QAEzF,OAAO;YACN,IAAI;YACJ,cAAc;YACd,KAAK,EAAE,QAAQ,CAAC,KAAK;YACrB,QAAQ,EAAE,QAAQ,CAAC,QAAQ;SAC3B,CAAC;IACH,CAAC;IAED,KAAK,CAAC,cAAc,CAAC,QAA0B,EAAE,OAAgC;QAChF,MAAM,KAAK,GAAG,IAAI,CAAC,GAAG,CAAC,CAAC,EAAE,OAAO,CAAC,IAAI,CAAC,CAAC,CAAC,OAAO,CAAC,cAAc,CAAC,YAAY,CAAC,OAAO,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;QACpG,MAAM,SAAS,CAAC,QAAQ,EAAE,OAAO,EAAE,KAAK,EAAE,OAAO,CAAC,KAAK,EAAE,OAAO,CAAC,QAAQ,EAAE,OAAO,CAAC,MAAM,CAAC,CAAC;IAC5F,CAAC;CACD,CAAC,CAAC;AAEH,eAAe,CAAC,KAAM,SAAQ,cAAc;IAC3C;QACC,KAAK,CACJ;YACC,EAAE,EAAE,+BAA+B;YACnC,KAAK,EAAE;gBACN,KAAK,EAAE,aAAa,GAAG,QAAQ,CAAC,KAA6C,EAAE,IAAU,CAAC;gBAC1F,QAAQ,EAAE,qBAAqB;aAC/B;YACD,OAAO,EAAE,QAAQ,CAAC,KAAqD,EAAE,IAA6B,CAAC;YACvG,EAAE,EAAE,KAAK;YACT,IAAI,EAAE;gBACL;oBACC,EAAE,EAAE,MAAM,CAAC,mBAAmB;oBAC9B,KAAK,EAAE,QAAQ;oBACf,KAAK,EAAE,CAAC,CAAC;oBACT,IAAI,EAAE,cAAc,CAAC,GAAG,CACvB,wBAAwB,CAAC,SAAS,CAAC,IAAI,CAAC,EACxC,2BAA2B,EAC3B,cAAc,CAAC,EAAE,CAChB,cAAc,CAAC,MAAM,CAAC,UAAU,eAAe,CAAC,QAAQ,EAAE,EAAE,IAAI,CAAC,EACjE,cAAc,CAAC,MAAM,CAAC,UAAU,eAAe,CAAC,YAAY,EAAE,EAAE,IAAI,CAAC,CACrE,CACD;iBACD;aACD;SACD,CAAC,CAAC;IACL,CAAC;IAED,KAAK,CAAC,cAAc,CAAC,QAA0B,EAAE,OAA+B;QAC/E,MAAM,SAAS,CAAC,QAAQ,EAAE,OAAO,EAAE,CAAC,EAAE,EAAE,EAAE,KAAK,CAAC,CAAC;IAClD,CAAC;CACD,CAAC,CAAC;AAEH,YAAY,CAAC,cAAc,CAAC,MAAM,CAAC,eAAe,EAAE;IACnD,OAAO,EAAE;QACR,EAAE,EAAE,0BAA0B;QAC9B,IAAI,EAAE,OAAO,CAAC,OAAO;QACrB,KAAK,EAAE,QAAQ,CAAC,KAA2C,EAAE,IAAU,CAAC;QACxE,OAAO,EAAE,QAAQ,CAAC,KAAyC,EAAE,IAA6B,CAAC;KAC3F;IACD,KAAK,EAAE,CAAC,EAAE;IACV,KAAK,EAAE,gBAAgB;IACvB,IAAI,EAAE,cAAc,CAAC,GAAG,CACvB,wBAAwB,CAAC,SAAS,CAAC,IAAI,CAAC,EACxC,cAAc,CAAC,SAAS,CAAC,uCAAuC,EAAE,cAAc,CAAC,EACjF,cAAc,CAAC,SAAS,CAAC,uCAAuC,EAAE,QAAQ,CAAC,EAC3E,2BAA2B,EAC3B,cAAc,CAAC,EAAE,CAChB,cAAc,CAAC,MAAM,CAAC,UAAU,eAAe,CAAC,QAAQ,EAAE,EAAE,IAAI,CAAC,EACjE,cAAc,CAAC,MAAM,CAAC,UAAU,eAAe,CAAC,YAAY,EAAE,EAAE,IAAI,CAAC,CACrE,CACD;CACD,CAAC,CAAC;AAEH,MAAM,OAAO,mBAAoB,SAAQ,aAAa;IAErD;QACC,KAAK,CAAC;YACL,EAAE,EAAE,yCAAyC;YAC7C,KAAK,EAAE,SAAS,CAAC,KAAiB,EAAE,gBAAgB,CAAC;YACrD,UAAU,EAAE,QAAQ,CAAC,KAAiB,EAAE,IAAc,CAAC;YACvD,OAAO,EAAE,QAAQ,CAAC,KAAiB,EAAE,IAAqC,CAAC;YAC3E,IAAI,EAAE,OAAO,CAAC,KAAK;YACnB,EAAE,EAAE,IAAI;YACR,YAAY,EAAE,cAAc,CAAC,GAAG,CAC/B,wBAAwB,CAAC,SAAS,CAAC,IAAI,CAAC,EACxC,uBAAuB,CACvB;YACD,UAAU,EAAE,SAAS;YACrB,IAAI,EAAE,CAAC;oBACN,EAAE,EAAE,8BAA8B;oBAClC,KAAK,EAAE,QAAQ;oBACf,KAAK,EAAE,CAAC;oBACR,IAAI,EAAE,cAAc,CAAC,GAAG,CACvB,wBAAwB,CAAC,SAAS,CAAC,IAAI,CAAC,EACxC,eAAe,CAAC,YAAY,CAAC,SAAS,EAAE,EACxC,mCAAmC,CAAC,SAAS,EAAE,EAC/C,6BAA6B,CAAC,SAAS,kEAAyC,CAChF;iBACD,CAAC;SACF,CAAC,CAAC;IACJ,CAAC;IAEQ,gBAAgB,CAAC,QAA0B,EAAE,UAAuB;QAC5E,MAAM,MAAM,GAAG,0BAA0B,CAAC,QAAQ,CAAC,GAAG,CAAC,cAAc,CAAC,CAAC,CAAC;QACxE,MAAM,IAAI,GAAG,oBAAoB,CAAC,GAAG,CAAC,UAAU,CAAC,CAAC;QAElD,IAAI,CAAC,MAAM,IAAI,CAAC,IAAI,EAAE,CAAC;YACtB,OAAO;QACR,CAAC;QAED,MAAM,WAAW,GAAG,MAAM,CAAC,cAAc,CAAC,WAAW,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,KAAK,UAAU,CAAC,CAAC;QACrF,MAAM,IAAI,GAAG,WAAW,EAAE,CAAC,CAAC,CAAC,CAAC;QAE9B,IAAI,CAAC,IAAI,EAAE,CAAC;YACX,OAAO;QACR,CAAC;QAED,IAAI,CAAC,aAAa,EAAE,CAAC;QACrB,OAAO,MAAM,CAAC,cAAc,CAAC,oBAAoB,CAAC,QAAQ,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC,CAAC;IAC1E,CAAC;CACD;AACD,eAAe,CAAC,mBAAmB,CAAC,CAAC","file":"cellChatActions.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Codicon } from '../../../../../../base/common/codicons.js';\nimport { KeyChord, KeyCode, KeyMod } from '../../../../../../base/common/keyCodes.js';\nimport { localize, localize2 } from '../../../../../../nls.js';\nimport { MenuId, MenuRegistry, registerAction2 } from '../../../../../../platform/actions/common/actions.js';\nimport { ICommandService } from '../../../../../../platform/commands/common/commands.js';\nimport { IConfigurationService } from '../../../../../../platform/configuration/common/configuration.js';\nimport { ContextKeyExpr } from '../../../../../../platform/contextkey/common/contextkey.js';\nimport { InputFocusedContextKey } from '../../../../../../platform/contextkey/common/contextkeys.js';\nimport { ServicesAccessor } from '../../../../../../platform/instantiation/common/instantiation.js';\nimport { KeybindingWeight } from '../../../../../../platform/keybinding/common/keybindingsRegistry.js';\nimport { CTX_INLINE_CHAT_REQUEST_IN_PROGRESS, CTX_INLINE_CHAT_RESPONSE_TYPE, CTX_INLINE_CHAT_VISIBLE, InlineChatResponseType, MENU_INLINE_CHAT_WIDGET_STATUS } from '../../../../inlineChat/common/inlineChat.js';\nimport { CTX_NOTEBOOK_CHAT_HAS_AGENT } from './notebookChatContext.js';\nimport { INotebookActionContext, NotebookAction, getContextFromActiveEditor, getEditorFromArgsOrActivePane } from '../coreActions.js';\nimport { insertNewCell } from '../insertCellActions.js';\nimport { CellKind, NotebookSetting } from '../../../common/notebookCommon.js';\nimport { NOTEBOOK_EDITOR_EDITABLE, NOTEBOOK_EDITOR_FOCUSED } from '../../../common/notebookContextKeys.js';\nimport { Iterable } from '../../../../../../base/common/iterator.js';\nimport { ICodeEditor } from '../../../../../../editor/browser/editorBrowser.js';\nimport { IEditorService } from '../../../../../services/editor/common/editorService.js';\nimport { ChatContextKeys } from '../../../../chat/common/chatContextKeys.js';\nimport { InlineChatController } from '../../../../inlineChat/browser/inlineChatController.js';\nimport { EditorAction2 } from '../../../../../../editor/browser/editorExtensions.js';\n\ninterface IInsertCellWithChatArgs extends INotebookActionContext {\n\tinput?: string;\n\tautoSend?: boolean;\n\tsource?: string;\n}\n\nasync function startChat(accessor: ServicesAccessor, context: INotebookActionContext, index: number, input?: string, autoSend?: boolean, source?: string) {\n\tconst configurationService = accessor.get(IConfigurationService);\n\tconst commandService = accessor.get(ICommandService);\n\n\tif (configurationService.getValue<boolean>(NotebookSetting.cellGenerate) || configurationService.getValue<boolean>(NotebookSetting.cellChat)) {\n\t\tconst activeCell = context.notebookEditor.getActiveCell();\n\t\tconst targetCell = activeCell?.getTextLength() === 0 && source !== 'insertToolbar' ? activeCell : (await insertNewCell(accessor, context, CellKind.Code, 'below', true));\n\n\t\tif (targetCell) {\n\t\t\ttargetCell.enableAutoLanguageDetection();\n\t\t\tawait context.notebookEditor.revealFirstLineIfOutsideViewport(targetCell);\n\t\t\tconst codeEditor = context.notebookEditor.codeEditors.find(ce => ce[0] === targetCell)?.[1];\n\t\t\tif (codeEditor) {\n\t\t\t\tcodeEditor.focus();\n\t\t\t\tcommandService.executeCommand('inlineChat.start');\n\t\t\t}\n\t\t}\n\t}\n}\n\nregisterAction2(class extends NotebookAction {\n\tconstructor() {\n\t\tsuper(\n\t\t\t{\n\t\t\t\tid: 'notebook.cell.chat.start',\n\t\t\t\ttitle: {\n\t\t\t\t\tvalue: '$(sparkle) ' + localize('notebookActions.menu.insertCodeCellWithChat', \"Generate\"),\n\t\t\t\t\toriginal: '$(sparkle) Generate',\n\t\t\t\t},\n\t\t\t\ttooltip: localize('notebookActions.menu.insertCodeCellWithChat.tooltip', \"Start Chat to Generate Code\"),\n\t\t\t\tmetadata: {\n\t\t\t\t\tdescription: localize('notebookActions.menu.insertCodeCellWithChat.tooltip', \"Start Chat to Generate Code\"),\n\t\t\t\t\targs: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tname: 'args',\n\t\t\t\t\t\t\tschema: {\n\t\t\t\t\t\t\t\ttype: 'object',\n\t\t\t\t\t\t\t\trequired: ['index'],\n\t\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\t\t'index': {\n\t\t\t\t\t\t\t\t\t\ttype: 'number'\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t'input': {\n\t\t\t\t\t\t\t\t\t\ttype: 'string'\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t'autoSend': {\n\t\t\t\t\t\t\t\t\t\ttype: 'boolean'\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t]\n\t\t\t\t},\n\t\t\t\tf1: false,\n\t\t\t\tkeybinding: {\n\t\t\t\t\twhen: ContextKeyExpr.and(\n\t\t\t\t\t\tNOTEBOOK_EDITOR_FOCUSED,\n\t\t\t\t\t\tNOTEBOOK_EDITOR_EDITABLE.isEqualTo(true),\n\t\t\t\t\t\tContextKeyExpr.not(InputFocusedContextKey),\n\t\t\t\t\t\tCTX_NOTEBOOK_CHAT_HAS_AGENT,\n\t\t\t\t\t\tContextKeyExpr.or(\n\t\t\t\t\t\t\tContextKeyExpr.equals(`config.${NotebookSetting.cellChat}`, true),\n\t\t\t\t\t\t\tContextKeyExpr.equals(`config.${NotebookSetting.cellGenerate}`, true)\n\t\t\t\t\t\t)\n\t\t\t\t\t),\n\t\t\t\t\tweight: KeybindingWeight.WorkbenchContrib,\n\t\t\t\t\tprimary: KeyMod.CtrlCmd | KeyCode.KeyI,\n\t\t\t\t\tsecondary: [KeyChord(KeyMod.CtrlCmd | KeyCode.KeyK, KeyCode.KeyI)],\n\t\t\t\t},\n\t\t\t\tmenu: [\n\t\t\t\t\t{\n\t\t\t\t\t\tid: MenuId.NotebookCellBetween,\n\t\t\t\t\t\tgroup: 'inline',\n\t\t\t\t\t\torder: -1,\n\t\t\t\t\t\twhen: ContextKeyExpr.and(\n\t\t\t\t\t\t\tNOTEBOOK_EDITOR_EDITABLE.isEqualTo(true),\n\t\t\t\t\t\t\tCTX_NOTEBOOK_CHAT_HAS_AGENT,\n\t\t\t\t\t\t\tContextKeyExpr.or(\n\t\t\t\t\t\t\t\tContextKeyExpr.equals(`config.${NotebookSetting.cellChat}`, true),\n\t\t\t\t\t\t\t\tContextKeyExpr.equals(`config.${NotebookSetting.cellGenerate}`, true)\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t)\n\t\t\t\t\t}\n\t\t\t\t]\n\t\t\t});\n\t}\n\n\toverride getEditorContextFromArgsOrActive(accessor: ServicesAccessor, ...args: any[]): IInsertCellWithChatArgs | undefined {\n\t\tconst [firstArg] = args;\n\t\tif (!firstArg) {\n\t\t\tconst notebookEditor = getEditorFromArgsOrActivePane(accessor);\n\t\t\tif (!notebookEditor) {\n\t\t\t\treturn undefined;\n\t\t\t}\n\n\t\t\tconst activeCell = notebookEditor.getActiveCell();\n\t\t\tif (!activeCell) {\n\t\t\t\treturn undefined;\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\tcell: activeCell,\n\t\t\t\tnotebookEditor,\n\t\t\t\tinput: undefined,\n\t\t\t\tautoSend: undefined\n\t\t\t};\n\t\t}\n\n\t\tif (typeof firstArg !== 'object' || typeof firstArg.index !== 'number') {\n\t\t\treturn undefined;\n\t\t}\n\n\t\tconst notebookEditor = getEditorFromArgsOrActivePane(accessor);\n\t\tif (!notebookEditor) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\tconst cell = firstArg.index <= 0 ? undefined : notebookEditor.cellAt(firstArg.index - 1);\n\n\t\treturn {\n\t\t\tcell,\n\t\t\tnotebookEditor,\n\t\t\tinput: firstArg.input,\n\t\t\tautoSend: firstArg.autoSend\n\t\t};\n\t}\n\n\tasync runWithContext(accessor: ServicesAccessor, context: IInsertCellWithChatArgs) {\n\t\tconst index = Math.max(0, context.cell ? context.notebookEditor.getCellIndex(context.cell) + 1 : 0);\n\t\tawait startChat(accessor, context, index, context.input, context.autoSend, context.source);\n\t}\n});\n\nregisterAction2(class extends NotebookAction {\n\tconstructor() {\n\t\tsuper(\n\t\t\t{\n\t\t\t\tid: 'notebook.cell.chat.startAtTop',\n\t\t\t\ttitle: {\n\t\t\t\t\tvalue: '$(sparkle) ' + localize('notebookActions.menu.insertCodeCellWithChat', \"Generate\"),\n\t\t\t\t\toriginal: '$(sparkle) Generate',\n\t\t\t\t},\n\t\t\t\ttooltip: localize('notebookActions.menu.insertCodeCellWithChat.tooltip', \"Start Chat to Generate Code\"),\n\t\t\t\tf1: false,\n\t\t\t\tmenu: [\n\t\t\t\t\t{\n\t\t\t\t\t\tid: MenuId.NotebookCellListTop,\n\t\t\t\t\t\tgroup: 'inline',\n\t\t\t\t\t\torder: -1,\n\t\t\t\t\t\twhen: ContextKeyExpr.and(\n\t\t\t\t\t\t\tNOTEBOOK_EDITOR_EDITABLE.isEqualTo(true),\n\t\t\t\t\t\t\tCTX_NOTEBOOK_CHAT_HAS_AGENT,\n\t\t\t\t\t\t\tContextKeyExpr.or(\n\t\t\t\t\t\t\t\tContextKeyExpr.equals(`config.${NotebookSetting.cellChat}`, true),\n\t\t\t\t\t\t\t\tContextKeyExpr.equals(`config.${NotebookSetting.cellGenerate}`, true)\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t)\n\t\t\t\t\t},\n\t\t\t\t]\n\t\t\t});\n\t}\n\n\tasync runWithContext(accessor: ServicesAccessor, context: INotebookActionContext) {\n\t\tawait startChat(accessor, context, 0, '', false);\n\t}\n});\n\nMenuRegistry.appendMenuItem(MenuId.NotebookToolbar, {\n\tcommand: {\n\t\tid: 'notebook.cell.chat.start',\n\t\ticon: Codicon.sparkle,\n\t\ttitle: localize('notebookActions.menu.insertCode.ontoolbar', \"Generate\"),\n\t\ttooltip: localize('notebookActions.menu.insertCode.tooltip', \"Start Chat to Generate Code\")\n\t},\n\torder: -10,\n\tgroup: 'navigation/add',\n\twhen: ContextKeyExpr.and(\n\t\tNOTEBOOK_EDITOR_EDITABLE.isEqualTo(true),\n\t\tContextKeyExpr.notEquals('config.notebook.insertToolbarLocation', 'betweenCells'),\n\t\tContextKeyExpr.notEquals('config.notebook.insertToolbarLocation', 'hidden'),\n\t\tCTX_NOTEBOOK_CHAT_HAS_AGENT,\n\t\tContextKeyExpr.or(\n\t\t\tContextKeyExpr.equals(`config.${NotebookSetting.cellChat}`, true),\n\t\t\tContextKeyExpr.equals(`config.${NotebookSetting.cellGenerate}`, true)\n\t\t)\n\t)\n});\n\nexport class AcceptChangesAndRun extends EditorAction2 {\n\n\tconstructor() {\n\t\tsuper({\n\t\t\tid: 'notebook.inlineChat.acceptChangesAndRun',\n\t\t\ttitle: localize2('notebook.apply1', \"Accept and Run\"),\n\t\t\tshortTitle: localize('notebook.apply2', 'Accept & Run'),\n\t\t\ttooltip: localize('notebook.apply3', 'Accept the changes and run the cell'),\n\t\t\ticon: Codicon.check,\n\t\t\tf1: true,\n\t\t\tprecondition: ContextKeyExpr.and(\n\t\t\t\tNOTEBOOK_EDITOR_EDITABLE.isEqualTo(true),\n\t\t\t\tCTX_INLINE_CHAT_VISIBLE,\n\t\t\t),\n\t\t\tkeybinding: undefined,\n\t\t\tmenu: [{\n\t\t\t\tid: MENU_INLINE_CHAT_WIDGET_STATUS,\n\t\t\t\tgroup: '0_main',\n\t\t\t\torder: 2,\n\t\t\t\twhen: ContextKeyExpr.and(\n\t\t\t\t\tNOTEBOOK_EDITOR_EDITABLE.isEqualTo(true),\n\t\t\t\t\tChatContextKeys.inputHasText.toNegated(),\n\t\t\t\t\tCTX_INLINE_CHAT_REQUEST_IN_PROGRESS.toNegated(),\n\t\t\t\t\tCTX_INLINE_CHAT_RESPONSE_TYPE.isEqualTo(InlineChatResponseType.MessagesAndEdits)\n\t\t\t\t)\n\t\t\t}]\n\t\t});\n\t}\n\n\toverride runEditorCommand(accessor: ServicesAccessor, codeEditor: ICodeEditor) {\n\t\tconst editor = getContextFromActiveEditor(accessor.get(IEditorService));\n\t\tconst ctrl = InlineChatController.get(codeEditor);\n\n\t\tif (!editor || !ctrl) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst matchedCell = editor.notebookEditor.codeEditors.find(e => e[1] === codeEditor);\n\t\tconst cell = matchedCell?.[0];\n\n\t\tif (!cell) {\n\t\t\treturn;\n\t\t}\n\n\t\tctrl.acceptSession();\n\t\treturn editor.notebookEditor.executeNotebookCells(Iterable.single(cell));\n\t}\n}\nregisterAction2(AcceptChangesAndRun);\n"]}