{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/contrib/notebook/browser/viewModel/codeCellViewModel.ts","vs/workbench/contrib/notebook/browser/viewModel/codeCellViewModel.ts"],"names":[],"mappings":"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","file":"codeCellViewModel.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Emitter, Event, PauseableEmitter } from '../../../../../base/common/event.js';\nimport { dispose } from '../../../../../base/common/lifecycle.js';\nimport { observableValue } from '../../../../../base/common/observable.js';\nimport * as UUID from '../../../../../base/common/uuid.js';\nimport { ICodeEditorService } from '../../../../../editor/browser/services/codeEditorService.js';\nimport * as editorCommon from '../../../../../editor/common/editorCommon.js';\nimport { PrefixSumComputer } from '../../../../../editor/common/model/prefixSumComputer.js';\nimport { ITextModelService } from '../../../../../editor/common/services/resolverService.js';\nimport { IConfigurationService } from '../../../../../platform/configuration/common/configuration.js';\nimport { IUndoRedoService } from '../../../../../platform/undoRedo/common/undoRedo.js';\nimport { CellEditState, CellFindMatch, CellLayoutState, CodeCellLayoutChangeEvent, CodeCellLayoutInfo, ICellOutputViewModel, ICellViewModel } from '../notebookBrowser.js';\nimport { NotebookOptionsChangeEvent } from '../notebookOptions.js';\nimport { NotebookLayoutInfo } from '../notebookViewEvents.js';\nimport { CellOutputViewModel } from './cellOutputViewModel.js';\nimport { ViewContext } from './viewContext.js';\nimport { NotebookCellTextModel } from '../../common/model/notebookCellTextModel.js';\nimport { CellKind, INotebookFindOptions, NotebookCellOutputsSplice } from '../../common/notebookCommon.js';\nimport { ICellExecutionError, ICellExecutionStateChangedEvent } from '../../common/notebookExecutionStateService.js';\nimport { INotebookService } from '../../common/notebookService.js';\nimport { BaseCellViewModel } from './baseCellViewModel.js';\nimport { IInlineChatSessionService } from '../../../inlineChat/browser/inlineChatSessionService.js';\n\nexport const outputDisplayLimit = 500;\n\nexport class CodeCellViewModel extends BaseCellViewModel implements ICellViewModel {\n\treadonly cellKind = CellKind.Code;\n\n\tprotected readonly _onLayoutInfoRead = this._register(new Emitter<void>());\n\treadonly onLayoutInfoRead = this._onLayoutInfoRead.event;\n\n\tprotected readonly _onDidStartExecution = this._register(new Emitter<ICellExecutionStateChangedEvent>());\n\treadonly onDidStartExecution = this._onDidStartExecution.event;\n\tprotected readonly _onDidStopExecution = this._register(new Emitter<ICellExecutionStateChangedEvent>());\n\treadonly onDidStopExecution = this._onDidStopExecution.event;\n\n\tprotected readonly _onDidChangeOutputs = this._register(new Emitter<NotebookCellOutputsSplice>());\n\treadonly onDidChangeOutputs = this._onDidChangeOutputs.event;\n\n\tprivate readonly _onDidRemoveOutputs = this._register(new Emitter<readonly ICellOutputViewModel[]>());\n\treadonly onDidRemoveOutputs = this._onDidRemoveOutputs.event;\n\n\tprivate _outputCollection: number[] = [];\n\n\tprivate _outputsTop: PrefixSumComputer | null = null;\n\n\tprotected _pauseableEmitter = this._register(new PauseableEmitter<CodeCellLayoutChangeEvent>());\n\n\treadonly onDidChangeLayout = this._pauseableEmitter.event;\n\n\tprivate _editorHeight = 0;\n\tset editorHeight(height: number) {\n\t\tif (this._editorHeight === height) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._editorHeight = height;\n\t\tthis.layoutChange({ editorHeight: true }, 'CodeCellViewModel#editorHeight');\n\t}\n\n\tget editorHeight() {\n\t\tthrow new Error('editorHeight is write-only');\n\t}\n\n\tprivate _chatHeight = 0;\n\tset chatHeight(height: number) {\n\t\tif (this._chatHeight === height) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._chatHeight = height;\n\t\tthis.layoutChange({ chatHeight: true }, 'CodeCellViewModel#chatHeight');\n\t}\n\n\tget chatHeight() {\n\t\treturn this._chatHeight;\n\t}\n\n\tprivate _hoveringOutput: boolean = false;\n\tpublic get outputIsHovered(): boolean {\n\t\treturn this._hoveringOutput;\n\t}\n\n\tpublic set outputIsHovered(v: boolean) {\n\t\tthis._hoveringOutput = v;\n\t\tthis._onDidChangeState.fire({ outputIsHoveredChanged: true });\n\t}\n\n\tprivate _focusOnOutput: boolean = false;\n\tpublic get outputIsFocused(): boolean {\n\t\treturn this._focusOnOutput;\n\t}\n\n\tpublic set outputIsFocused(v: boolean) {\n\t\tthis._focusOnOutput = v;\n\t\tthis._onDidChangeState.fire({ outputIsFocusedChanged: true });\n\t}\n\n\tprivate _focusInputInOutput: boolean = false;\n\tpublic get inputInOutputIsFocused(): boolean {\n\t\treturn this._focusInputInOutput;\n\t}\n\n\tpublic set inputInOutputIsFocused(v: boolean) {\n\t\tthis._focusInputInOutput = v;\n\t}\n\n\tprivate _outputMinHeight: number = 0;\n\n\tprivate get outputMinHeight() {\n\t\treturn this._outputMinHeight;\n\t}\n\n\t/**\n\t * The minimum height of the output region. It's only set to non-zero temporarily when replacing an output with a new one.\n\t * It's reset to 0 when the new output is rendered, or in one second.\n\t */\n\tprivate set outputMinHeight(newMin: number) {\n\t\tthis._outputMinHeight = newMin;\n\t}\n\n\tprivate _layoutInfo: CodeCellLayoutInfo;\n\n\tget layoutInfo() {\n\t\treturn this._layoutInfo;\n\t}\n\n\tprivate _outputViewModels: ICellOutputViewModel[];\n\n\tget outputsViewModels() {\n\t\treturn this._outputViewModels;\n\t}\n\n\treadonly executionErrorDiagnostic = observableValue<ICellExecutionError | undefined>('excecutionError', undefined);\n\n\tconstructor(\n\t\tviewType: string,\n\t\tmodel: NotebookCellTextModel,\n\t\tinitialNotebookLayoutInfo: NotebookLayoutInfo | null,\n\t\treadonly viewContext: ViewContext,\n\t\t@IConfigurationService configurationService: IConfigurationService,\n\t\t@INotebookService private readonly _notebookService: INotebookService,\n\t\t@ITextModelService modelService: ITextModelService,\n\t\t@IUndoRedoService undoRedoService: IUndoRedoService,\n\t\t@ICodeEditorService codeEditorService: ICodeEditorService,\n\t\t@IInlineChatSessionService inlineChatSessionService: IInlineChatSessionService\n\t) {\n\t\tsuper(viewType, model, UUID.generateUuid(), viewContext, configurationService, modelService, undoRedoService, codeEditorService, inlineChatSessionService);\n\t\tthis._outputViewModels = this.model.outputs.map(output => new CellOutputViewModel(this, output, this._notebookService));\n\n\t\tthis._register(this.model.onDidChangeOutputs((splice) => {\n\t\t\tconst removedOutputs: ICellOutputViewModel[] = [];\n\t\t\tlet outputLayoutChange = false;\n\t\t\tfor (let i = splice.start; i < splice.start + splice.deleteCount; i++) {\n\t\t\t\tif (this._outputCollection[i] !== undefined && this._outputCollection[i] !== 0) {\n\t\t\t\t\toutputLayoutChange = true;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis._outputCollection.splice(splice.start, splice.deleteCount, ...splice.newOutputs.map(() => 0));\n\t\t\tremovedOutputs.push(...this._outputViewModels.splice(splice.start, splice.deleteCount, ...splice.newOutputs.map(output => new CellOutputViewModel(this, output, this._notebookService))));\n\n\t\t\tthis._outputsTop = null;\n\t\t\tthis._onDidChangeOutputs.fire(splice);\n\t\t\tthis._onDidRemoveOutputs.fire(removedOutputs);\n\t\t\tif (outputLayoutChange) {\n\t\t\t\tthis.layoutChange({ outputHeight: true }, 'CodeCellViewModel#model.onDidChangeOutputs');\n\t\t\t}\n\t\t\tif (!this._outputCollection.length) {\n\t\t\t\tthis.executionErrorDiagnostic.set(undefined, undefined);\n\t\t\t}\n\t\t\tdispose(removedOutputs);\n\t\t}));\n\n\t\tthis._outputCollection = new Array(this.model.outputs.length);\n\t\tconst layoutConfiguration = this.viewContext.notebookOptions.getLayoutConfiguration();\n\t\tthis._layoutInfo = {\n\t\t\tfontInfo: initialNotebookLayoutInfo?.fontInfo || null,\n\t\t\teditorHeight: 0,\n\t\t\teditorWidth: initialNotebookLayoutInfo\n\t\t\t\t? this.viewContext.notebookOptions.computeCodeCellEditorWidth(initialNotebookLayoutInfo.width)\n\t\t\t\t: 0,\n\t\t\tchatHeight: 0,\n\t\t\tstatusBarHeight: 0,\n\t\t\tcommentOffset: 0,\n\t\t\tcommentHeight: 0,\n\t\t\toutputContainerOffset: 0,\n\t\t\toutputTotalHeight: 0,\n\t\t\toutputShowMoreContainerHeight: 0,\n\t\t\toutputShowMoreContainerOffset: 0,\n\t\t\ttotalHeight: this.computeTotalHeight(17, 0, 0, 0),\n\t\t\tcodeIndicatorHeight: 0,\n\t\t\toutputIndicatorHeight: 0,\n\t\t\tbottomToolbarOffset: 0,\n\t\t\tlayoutState: CellLayoutState.Uninitialized,\n\t\t\testimatedHasHorizontalScrolling: false,\n\t\t\toutlineWidth: 1,\n\t\t\ttopMargin: layoutConfiguration.cellTopMargin,\n\t\t\tbottomMargin: layoutConfiguration.cellBottomMargin,\n\t\t};\n\t}\n\n\tupdateExecutionState(e: ICellExecutionStateChangedEvent) {\n\t\tif (e.changed) {\n\t\t\tthis.executionErrorDiagnostic.set(undefined, undefined);\n\t\t\tthis._onDidStartExecution.fire(e);\n\t\t} else {\n\t\t\tthis._onDidStopExecution.fire(e);\n\t\t}\n\t}\n\n\toverride updateOptions(e: NotebookOptionsChangeEvent) {\n\t\tsuper.updateOptions(e);\n\t\tif (e.cellStatusBarVisibility || e.insertToolbarPosition || e.cellToolbarLocation) {\n\t\t\tthis.layoutChange({});\n\t\t}\n\t}\n\n\tpauseLayout() {\n\t\tthis._pauseableEmitter.pause();\n\t}\n\n\tresumeLayout() {\n\t\tthis._pauseableEmitter.resume();\n\t}\n\n\tlayoutChange(state: CodeCellLayoutChangeEvent, source?: string) {\n\t\t// recompute\n\t\tthis._ensureOutputsTop();\n\t\tconst notebookLayoutConfiguration = this.viewContext.notebookOptions.getLayoutConfiguration();\n\t\tconst bottomToolbarDimensions = this.viewContext.notebookOptions.computeBottomToolbarDimensions(this.viewType);\n\t\tconst outputShowMoreContainerHeight = state.outputShowMoreContainerHeight ? state.outputShowMoreContainerHeight : this._layoutInfo.outputShowMoreContainerHeight;\n\t\tconst outputTotalHeight = Math.max(this._outputMinHeight, this.isOutputCollapsed ? notebookLayoutConfiguration.collapsedIndicatorHeight : this._outputsTop!.getTotalSum());\n\t\tconst commentHeight = state.commentHeight ? this._commentHeight : this._layoutInfo.commentHeight;\n\n\t\tconst originalLayout = this.layoutInfo;\n\t\tif (!this.isInputCollapsed) {\n\t\t\tlet newState: CellLayoutState;\n\t\t\tlet editorHeight: number;\n\t\t\tlet totalHeight: number;\n\t\t\tlet hasHorizontalScrolling = false;\n\t\t\tconst chatHeight = state.chatHeight ? this._chatHeight : this._layoutInfo.chatHeight;\n\t\t\tif (!state.editorHeight && this._layoutInfo.layoutState === CellLayoutState.FromCache && !state.outputHeight) {\n\t\t\t\t// No new editorHeight info - keep cached totalHeight and estimate editorHeight\n\t\t\t\tconst estimate = this.estimateEditorHeight(state.font?.lineHeight ?? this._layoutInfo.fontInfo?.lineHeight);\n\t\t\t\teditorHeight = estimate.editorHeight;\n\t\t\t\thasHorizontalScrolling = estimate.hasHorizontalScrolling;\n\t\t\t\ttotalHeight = this._layoutInfo.totalHeight;\n\t\t\t\tnewState = CellLayoutState.FromCache;\n\t\t\t} else if (state.editorHeight || this._layoutInfo.layoutState === CellLayoutState.Measured) {\n\t\t\t\t// Editor has been measured\n\t\t\t\teditorHeight = this._editorHeight;\n\t\t\t\ttotalHeight = this.computeTotalHeight(this._editorHeight, outputTotalHeight, outputShowMoreContainerHeight, chatHeight);\n\t\t\t\tnewState = CellLayoutState.Measured;\n\t\t\t\thasHorizontalScrolling = this._layoutInfo.estimatedHasHorizontalScrolling;\n\t\t\t} else {\n\t\t\t\tconst estimate = this.estimateEditorHeight(state.font?.lineHeight ?? this._layoutInfo.fontInfo?.lineHeight);\n\t\t\t\teditorHeight = estimate.editorHeight;\n\t\t\t\thasHorizontalScrolling = estimate.hasHorizontalScrolling;\n\t\t\t\ttotalHeight = this.computeTotalHeight(editorHeight, outputTotalHeight, outputShowMoreContainerHeight, chatHeight);\n\t\t\t\tnewState = CellLayoutState.Estimated;\n\t\t\t}\n\n\t\t\tconst statusBarHeight = this.viewContext.notebookOptions.computeEditorStatusbarHeight(this.internalMetadata, this.uri);\n\t\t\tconst codeIndicatorHeight = editorHeight + statusBarHeight;\n\t\t\tconst outputIndicatorHeight = outputTotalHeight + outputShowMoreContainerHeight;\n\t\t\tconst outputContainerOffset = notebookLayoutConfiguration.editorToolbarHeight\n\t\t\t\t+ notebookLayoutConfiguration.cellTopMargin // CELL_TOP_MARGIN\n\t\t\t\t+ chatHeight\n\t\t\t\t+ editorHeight\n\t\t\t\t+ statusBarHeight;\n\t\t\tconst outputShowMoreContainerOffset = totalHeight\n\t\t\t\t- bottomToolbarDimensions.bottomToolbarGap\n\t\t\t\t- bottomToolbarDimensions.bottomToolbarHeight / 2\n\t\t\t\t- outputShowMoreContainerHeight;\n\t\t\tconst bottomToolbarOffset = this.viewContext.notebookOptions.computeBottomToolbarOffset(totalHeight, this.viewType);\n\t\t\tconst editorWidth = state.outerWidth !== undefined\n\t\t\t\t? this.viewContext.notebookOptions.computeCodeCellEditorWidth(state.outerWidth)\n\t\t\t\t: this._layoutInfo?.editorWidth;\n\n\t\t\tthis._layoutInfo = {\n\t\t\t\tfontInfo: state.font ?? this._layoutInfo.fontInfo ?? null,\n\t\t\t\tchatHeight,\n\t\t\t\teditorHeight,\n\t\t\t\teditorWidth,\n\t\t\t\tstatusBarHeight,\n\t\t\t\toutputContainerOffset,\n\t\t\t\toutputTotalHeight,\n\t\t\t\toutputShowMoreContainerHeight,\n\t\t\t\toutputShowMoreContainerOffset,\n\t\t\t\tcommentOffset: outputContainerOffset + outputTotalHeight,\n\t\t\t\tcommentHeight,\n\t\t\t\ttotalHeight,\n\t\t\t\tcodeIndicatorHeight,\n\t\t\t\toutputIndicatorHeight,\n\t\t\t\tbottomToolbarOffset,\n\t\t\t\tlayoutState: newState,\n\t\t\t\testimatedHasHorizontalScrolling: hasHorizontalScrolling,\n\t\t\t\ttopMargin: notebookLayoutConfiguration.cellTopMargin,\n\t\t\t\tbottomMargin: notebookLayoutConfiguration.cellBottomMargin,\n\t\t\t\toutlineWidth: 1\n\t\t\t};\n\t\t} else {\n\t\t\tconst codeIndicatorHeight = notebookLayoutConfiguration.collapsedIndicatorHeight;\n\t\t\tconst outputIndicatorHeight = outputTotalHeight + outputShowMoreContainerHeight;\n\t\t\tconst chatHeight = state.chatHeight ? this._chatHeight : this._layoutInfo.chatHeight;\n\n\t\t\tconst outputContainerOffset = notebookLayoutConfiguration.cellTopMargin + notebookLayoutConfiguration.collapsedIndicatorHeight;\n\t\t\tconst totalHeight =\n\t\t\t\tnotebookLayoutConfiguration.cellTopMargin\n\t\t\t\t+ notebookLayoutConfiguration.collapsedIndicatorHeight\n\t\t\t\t+ notebookLayoutConfiguration.cellBottomMargin //CELL_BOTTOM_MARGIN\n\t\t\t\t+ bottomToolbarDimensions.bottomToolbarGap //BOTTOM_CELL_TOOLBAR_GAP\n\t\t\t\t+ chatHeight\n\t\t\t\t+ commentHeight\n\t\t\t\t+ outputTotalHeight + outputShowMoreContainerHeight;\n\t\t\tconst outputShowMoreContainerOffset = totalHeight\n\t\t\t\t- bottomToolbarDimensions.bottomToolbarGap\n\t\t\t\t- bottomToolbarDimensions.bottomToolbarHeight / 2\n\t\t\t\t- outputShowMoreContainerHeight;\n\t\t\tconst bottomToolbarOffset = this.viewContext.notebookOptions.computeBottomToolbarOffset(totalHeight, this.viewType);\n\t\t\tconst editorWidth = state.outerWidth !== undefined\n\t\t\t\t? this.viewContext.notebookOptions.computeCodeCellEditorWidth(state.outerWidth)\n\t\t\t\t: this._layoutInfo?.editorWidth;\n\n\t\t\tthis._layoutInfo = {\n\t\t\t\tfontInfo: state.font ?? this._layoutInfo.fontInfo ?? null,\n\t\t\t\teditorHeight: this._layoutInfo.editorHeight,\n\t\t\t\teditorWidth,\n\t\t\t\tchatHeight: chatHeight,\n\t\t\t\tstatusBarHeight: 0,\n\t\t\t\toutputContainerOffset,\n\t\t\t\toutputTotalHeight,\n\t\t\t\toutputShowMoreContainerHeight,\n\t\t\t\toutputShowMoreContainerOffset,\n\t\t\t\tcommentOffset: outputContainerOffset + outputTotalHeight,\n\t\t\t\tcommentHeight,\n\t\t\t\ttotalHeight,\n\t\t\t\tcodeIndicatorHeight,\n\t\t\t\toutputIndicatorHeight,\n\t\t\t\tbottomToolbarOffset,\n\t\t\t\tlayoutState: this._layoutInfo.layoutState,\n\t\t\t\testimatedHasHorizontalScrolling: false,\n\t\t\t\toutlineWidth: 1,\n\t\t\t\ttopMargin: notebookLayoutConfiguration.cellTopMargin,\n\t\t\t\tbottomMargin: notebookLayoutConfiguration.cellBottomMargin,\n\t\t\t};\n\t\t}\n\n\t\tthis._fireOnDidChangeLayout({\n\t\t\t...state,\n\t\t\ttotalHeight: this.layoutInfo.totalHeight !== originalLayout.totalHeight,\n\t\t\tsource,\n\t\t});\n\t}\n\n\tprivate _fireOnDidChangeLayout(state: CodeCellLayoutChangeEvent) {\n\t\tthis._pauseableEmitter.fire(state);\n\t}\n\n\toverride restoreEditorViewState(editorViewStates: editorCommon.ICodeEditorViewState | null, totalHeight?: number) {\n\t\tsuper.restoreEditorViewState(editorViewStates);\n\t\tif (totalHeight !== undefined && this._layoutInfo.layoutState !== CellLayoutState.Measured) {\n\t\t\tthis._layoutInfo = {\n\t\t\t\t...this._layoutInfo,\n\t\t\t\ttotalHeight: totalHeight,\n\t\t\t\tlayoutState: CellLayoutState.FromCache,\n\t\t\t};\n\t\t}\n\t}\n\n\tgetDynamicHeight() {\n\t\tthis._onLayoutInfoRead.fire();\n\t\treturn this._layoutInfo.totalHeight;\n\t}\n\n\tgetHeight(lineHeight: number) {\n\t\tif (this._layoutInfo.layoutState === CellLayoutState.Uninitialized) {\n\t\t\tconst estimate = this.estimateEditorHeight(lineHeight);\n\t\t\treturn this.computeTotalHeight(estimate.editorHeight, 0, 0, 0);\n\t\t} else {\n\t\t\treturn this._layoutInfo.totalHeight;\n\t\t}\n\t}\n\n\tprivate estimateEditorHeight(lineHeight: number | undefined = 20): { editorHeight: number; hasHorizontalScrolling: boolean } {\n\t\tlet hasHorizontalScrolling = false;\n\t\tconst cellEditorOptions = this.viewContext.getBaseCellEditorOptions(this.language);\n\t\tif (this.layoutInfo.fontInfo && cellEditorOptions.value.wordWrap === 'off') {\n\t\t\tfor (let i = 0; i < this.lineCount; i++) {\n\t\t\t\tconst max = this.textBuffer.getLineLastNonWhitespaceColumn(i + 1);\n\t\t\t\tconst estimatedWidth = max * (this.layoutInfo.fontInfo.typicalHalfwidthCharacterWidth + this.layoutInfo.fontInfo.letterSpacing);\n\t\t\t\tif (estimatedWidth > this.layoutInfo.editorWidth) {\n\t\t\t\t\thasHorizontalScrolling = true;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tconst verticalScrollbarHeight = hasHorizontalScrolling ? 12 : 0; // take zoom level into account\n\t\tconst editorPadding = this.viewContext.notebookOptions.computeEditorPadding(this.internalMetadata, this.uri);\n\t\tconst editorHeight = this.lineCount * lineHeight\n\t\t\t+ editorPadding.top\n\t\t\t+ editorPadding.bottom // EDITOR_BOTTOM_PADDING\n\t\t\t+ verticalScrollbarHeight;\n\t\treturn {\n\t\t\teditorHeight,\n\t\t\thasHorizontalScrolling\n\t\t};\n\t}\n\n\tprivate computeTotalHeight(editorHeight: number, outputsTotalHeight: number, outputShowMoreContainerHeight: number, chatHeight: number): number {\n\t\tconst layoutConfiguration = this.viewContext.notebookOptions.getLayoutConfiguration();\n\t\tconst { bottomToolbarGap } = this.viewContext.notebookOptions.computeBottomToolbarDimensions(this.viewType);\n\t\treturn layoutConfiguration.editorToolbarHeight\n\t\t\t+ layoutConfiguration.cellTopMargin\n\t\t\t+ chatHeight\n\t\t\t+ editorHeight\n\t\t\t+ this.viewContext.notebookOptions.computeEditorStatusbarHeight(this.internalMetadata, this.uri)\n\t\t\t+ this._commentHeight\n\t\t\t+ outputsTotalHeight\n\t\t\t+ outputShowMoreContainerHeight\n\t\t\t+ bottomToolbarGap\n\t\t\t+ layoutConfiguration.cellBottomMargin;\n\t}\n\n\tprotected onDidChangeTextModelContent(): void {\n\t\tif (this.getEditState() !== CellEditState.Editing) {\n\t\t\tthis.updateEditState(CellEditState.Editing, 'onDidChangeTextModelContent');\n\t\t\tthis._onDidChangeState.fire({ contentChanged: true });\n\t\t}\n\t}\n\n\tonDeselect() {\n\t\tthis.updateEditState(CellEditState.Preview, 'onDeselect');\n\t}\n\n\tupdateOutputShowMoreContainerHeight(height: number) {\n\t\tthis.layoutChange({ outputShowMoreContainerHeight: height }, 'CodeCellViewModel#updateOutputShowMoreContainerHeight');\n\t}\n\n\tupdateOutputMinHeight(height: number) {\n\t\tthis.outputMinHeight = height;\n\t}\n\n\tunlockOutputHeight() {\n\t\tthis.outputMinHeight = 0;\n\t\tthis.layoutChange({ outputHeight: true });\n\t}\n\n\tupdateOutputHeight(index: number, height: number, source?: string) {\n\t\tif (index >= this._outputCollection.length) {\n\t\t\tthrow new Error('Output index out of range!');\n\t\t}\n\n\t\tthis._ensureOutputsTop();\n\n\t\ttry {\n\t\t\tif (index === 0 || height > 0) {\n\t\t\t\tthis._outputViewModels[index].setVisible(true);\n\t\t\t} else if (height === 0) {\n\t\t\t\tthis._outputViewModels[index].setVisible(false);\n\t\t\t}\n\t\t} catch (e) {\n\t\t\tconst errorMessage = `Failed to update output height for cell ${this.handle}, output ${index}. `\n\t\t\t\t+ `this.outputCollection.length: ${this._outputCollection.length}, this._outputViewModels.length: ${this._outputViewModels.length}`;\n\t\t\tthrow new Error(`${errorMessage}.\\n Error: ${e.message}`);\n\t\t}\n\n\t\tif (this._outputViewModels[index].visible.get() && height < 28) {\n\t\t\theight = 28;\n\t\t}\n\n\t\tthis._outputCollection[index] = height;\n\t\tif (this._outputsTop!.setValue(index, height)) {\n\t\t\tthis.layoutChange({ outputHeight: true }, source);\n\t\t}\n\t}\n\n\tgetOutputOffsetInContainer(index: number) {\n\t\tthis._ensureOutputsTop();\n\n\t\tif (index >= this._outputCollection.length) {\n\t\t\tthrow new Error('Output index out of range!');\n\t\t}\n\n\t\treturn this._outputsTop!.getPrefixSum(index - 1);\n\t}\n\n\tgetOutputOffset(index: number): number {\n\t\treturn this.layoutInfo.outputContainerOffset + this.getOutputOffsetInContainer(index);\n\t}\n\n\tspliceOutputHeights(start: number, deleteCnt: number, heights: number[]) {\n\t\tthis._ensureOutputsTop();\n\n\t\tthis._outputsTop!.removeValues(start, deleteCnt);\n\t\tif (heights.length) {\n\t\t\tconst values = new Uint32Array(heights.length);\n\t\t\tfor (let i = 0; i < heights.length; i++) {\n\t\t\t\tvalues[i] = heights[i];\n\t\t\t}\n\n\t\t\tthis._outputsTop!.insertValues(start, values);\n\t\t}\n\n\t\tthis.layoutChange({ outputHeight: true }, 'CodeCellViewModel#spliceOutputs');\n\t}\n\n\tprivate _ensureOutputsTop(): void {\n\t\tif (!this._outputsTop) {\n\t\t\tconst values = new Uint32Array(this._outputCollection.length);\n\t\t\tfor (let i = 0; i < this._outputCollection.length; i++) {\n\t\t\t\tvalues[i] = this._outputCollection[i];\n\t\t\t}\n\n\t\t\tthis._outputsTop = new PrefixSumComputer(values);\n\t\t}\n\t}\n\n\tprivate readonly _hasFindResult = this._register(new Emitter<boolean>());\n\tpublic readonly hasFindResult: Event<boolean> = this._hasFindResult.event;\n\n\tstartFind(value: string, options: INotebookFindOptions): CellFindMatch | null {\n\t\tconst matches = super.cellStartFind(value, options);\n\n\t\tif (matches === null) {\n\t\t\treturn null;\n\t\t}\n\n\t\treturn {\n\t\t\tcell: this,\n\t\t\tcontentMatches: matches\n\t\t};\n\t}\n\n\toverride dispose() {\n\t\tsuper.dispose();\n\n\t\tthis._outputCollection = [];\n\t\tthis._outputsTop = null;\n\t\tdispose(this._outputViewModels);\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Emitter, Event, PauseableEmitter } from '../../../../../base/common/event.js';\nimport { dispose } from '../../../../../base/common/lifecycle.js';\nimport { observableValue } from '../../../../../base/common/observable.js';\nimport * as UUID from '../../../../../base/common/uuid.js';\nimport { ICodeEditorService } from '../../../../../editor/browser/services/codeEditorService.js';\nimport * as editorCommon from '../../../../../editor/common/editorCommon.js';\nimport { PrefixSumComputer } from '../../../../../editor/common/model/prefixSumComputer.js';\nimport { ITextModelService } from '../../../../../editor/common/services/resolverService.js';\nimport { IConfigurationService } from '../../../../../platform/configuration/common/configuration.js';\nimport { IUndoRedoService } from '../../../../../platform/undoRedo/common/undoRedo.js';\nimport { CellEditState, CellFindMatch, CellLayoutState, CodeCellLayoutChangeEvent, CodeCellLayoutInfo, ICellOutputViewModel, ICellViewModel } from '../notebookBrowser.js';\nimport { NotebookOptionsChangeEvent } from '../notebookOptions.js';\nimport { NotebookLayoutInfo } from '../notebookViewEvents.js';\nimport { CellOutputViewModel } from './cellOutputViewModel.js';\nimport { ViewContext } from './viewContext.js';\nimport { NotebookCellTextModel } from '../../common/model/notebookCellTextModel.js';\nimport { CellKind, INotebookFindOptions, NotebookCellOutputsSplice } from '../../common/notebookCommon.js';\nimport { ICellExecutionError, ICellExecutionStateChangedEvent } from '../../common/notebookExecutionStateService.js';\nimport { INotebookService } from '../../common/notebookService.js';\nimport { BaseCellViewModel } from './baseCellViewModel.js';\nimport { IInlineChatSessionService } from '../../../inlineChat/browser/inlineChatSessionService.js';\n\nexport const outputDisplayLimit = 500;\n\nexport class CodeCellViewModel extends BaseCellViewModel implements ICellViewModel {\n\treadonly cellKind = CellKind.Code;\n\n\tprotected readonly _onLayoutInfoRead = this._register(new Emitter<void>());\n\treadonly onLayoutInfoRead = this._onLayoutInfoRead.event;\n\n\tprotected readonly _onDidStartExecution = this._register(new Emitter<ICellExecutionStateChangedEvent>());\n\treadonly onDidStartExecution = this._onDidStartExecution.event;\n\tprotected readonly _onDidStopExecution = this._register(new Emitter<ICellExecutionStateChangedEvent>());\n\treadonly onDidStopExecution = this._onDidStopExecution.event;\n\n\tprotected readonly _onDidChangeOutputs = this._register(new Emitter<NotebookCellOutputsSplice>());\n\treadonly onDidChangeOutputs = this._onDidChangeOutputs.event;\n\n\tprivate readonly _onDidRemoveOutputs = this._register(new Emitter<readonly ICellOutputViewModel[]>());\n\treadonly onDidRemoveOutputs = this._onDidRemoveOutputs.event;\n\n\tprivate _outputCollection: number[] = [];\n\n\tprivate _outputsTop: PrefixSumComputer | null = null;\n\n\tprotected _pauseableEmitter = this._register(new PauseableEmitter<CodeCellLayoutChangeEvent>());\n\n\treadonly onDidChangeLayout = this._pauseableEmitter.event;\n\n\tprivate _editorHeight = 0;\n\tset editorHeight(height: number) {\n\t\tif (this._editorHeight === height) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._editorHeight = height;\n\t\tthis.layoutChange({ editorHeight: true }, 'CodeCellViewModel#editorHeight');\n\t}\n\n\tget editorHeight() {\n\t\tthrow new Error('editorHeight is write-only');\n\t}\n\n\tprivate _chatHeight = 0;\n\tset chatHeight(height: number) {\n\t\tif (this._chatHeight === height) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._chatHeight = height;\n\t\tthis.layoutChange({ chatHeight: true }, 'CodeCellViewModel#chatHeight');\n\t}\n\n\tget chatHeight() {\n\t\treturn this._chatHeight;\n\t}\n\n\tprivate _hoveringOutput: boolean = false;\n\tpublic get outputIsHovered(): boolean {\n\t\treturn this._hoveringOutput;\n\t}\n\n\tpublic set outputIsHovered(v: boolean) {\n\t\tthis._hoveringOutput = v;\n\t\tthis._onDidChangeState.fire({ outputIsHoveredChanged: true });\n\t}\n\n\tprivate _focusOnOutput: boolean = false;\n\tpublic get outputIsFocused(): boolean {\n\t\treturn this._focusOnOutput;\n\t}\n\n\tpublic set outputIsFocused(v: boolean) {\n\t\tthis._focusOnOutput = v;\n\t\tthis._onDidChangeState.fire({ outputIsFocusedChanged: true });\n\t}\n\n\tprivate _focusInputInOutput: boolean = false;\n\tpublic get inputInOutputIsFocused(): boolean {\n\t\treturn this._focusInputInOutput;\n\t}\n\n\tpublic set inputInOutputIsFocused(v: boolean) {\n\t\tthis._focusInputInOutput = v;\n\t}\n\n\tprivate _outputMinHeight: number = 0;\n\n\tprivate get outputMinHeight() {\n\t\treturn this._outputMinHeight;\n\t}\n\n\t/**\n\t * The minimum height of the output region. It's only set to non-zero temporarily when replacing an output with a new one.\n\t * It's reset to 0 when the new output is rendered, or in one second.\n\t */\n\tprivate set outputMinHeight(newMin: number) {\n\t\tthis._outputMinHeight = newMin;\n\t}\n\n\tprivate _layoutInfo: CodeCellLayoutInfo;\n\n\tget layoutInfo() {\n\t\treturn this._layoutInfo;\n\t}\n\n\tprivate _outputViewModels: ICellOutputViewModel[];\n\n\tget outputsViewModels() {\n\t\treturn this._outputViewModels;\n\t}\n\n\treadonly executionErrorDiagnostic = observableValue<ICellExecutionError | undefined>('excecutionError', undefined);\n\n\tconstructor(\n\t\tviewType: string,\n\t\tmodel: NotebookCellTextModel,\n\t\tinitialNotebookLayoutInfo: NotebookLayoutInfo | null,\n\t\treadonly viewContext: ViewContext,\n\t\t@IConfigurationService configurationService: IConfigurationService,\n\t\t@INotebookService private readonly _notebookService: INotebookService,\n\t\t@ITextModelService modelService: ITextModelService,\n\t\t@IUndoRedoService undoRedoService: IUndoRedoService,\n\t\t@ICodeEditorService codeEditorService: ICodeEditorService,\n\t\t@IInlineChatSessionService inlineChatSessionService: IInlineChatSessionService\n\t) {\n\t\tsuper(viewType, model, UUID.generateUuid(), viewContext, configurationService, modelService, undoRedoService, codeEditorService, inlineChatSessionService);\n\t\tthis._outputViewModels = this.model.outputs.map(output => new CellOutputViewModel(this, output, this._notebookService));\n\n\t\tthis._register(this.model.onDidChangeOutputs((splice) => {\n\t\t\tconst removedOutputs: ICellOutputViewModel[] = [];\n\t\t\tlet outputLayoutChange = false;\n\t\t\tfor (let i = splice.start; i < splice.start + splice.deleteCount; i++) {\n\t\t\t\tif (this._outputCollection[i] !== undefined && this._outputCollection[i] !== 0) {\n\t\t\t\t\toutputLayoutChange = true;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis._outputCollection.splice(splice.start, splice.deleteCount, ...splice.newOutputs.map(() => 0));\n\t\t\tremovedOutputs.push(...this._outputViewModels.splice(splice.start, splice.deleteCount, ...splice.newOutputs.map(output => new CellOutputViewModel(this, output, this._notebookService))));\n\n\t\t\tthis._outputsTop = null;\n\t\t\tthis._onDidChangeOutputs.fire(splice);\n\t\t\tthis._onDidRemoveOutputs.fire(removedOutputs);\n\t\t\tif (outputLayoutChange) {\n\t\t\t\tthis.layoutChange({ outputHeight: true }, 'CodeCellViewModel#model.onDidChangeOutputs');\n\t\t\t}\n\t\t\tif (!this._outputCollection.length) {\n\t\t\t\tthis.executionErrorDiagnostic.set(undefined, undefined);\n\t\t\t}\n\t\t\tdispose(removedOutputs);\n\t\t}));\n\n\t\tthis._outputCollection = new Array(this.model.outputs.length);\n\t\tconst layoutConfiguration = this.viewContext.notebookOptions.getLayoutConfiguration();\n\t\tthis._layoutInfo = {\n\t\t\tfontInfo: initialNotebookLayoutInfo?.fontInfo || null,\n\t\t\teditorHeight: 0,\n\t\t\teditorWidth: initialNotebookLayoutInfo\n\t\t\t\t? this.viewContext.notebookOptions.computeCodeCellEditorWidth(initialNotebookLayoutInfo.width)\n\t\t\t\t: 0,\n\t\t\tchatHeight: 0,\n\t\t\tstatusBarHeight: 0,\n\t\t\tcommentOffset: 0,\n\t\t\tcommentHeight: 0,\n\t\t\toutputContainerOffset: 0,\n\t\t\toutputTotalHeight: 0,\n\t\t\toutputShowMoreContainerHeight: 0,\n\t\t\toutputShowMoreContainerOffset: 0,\n\t\t\ttotalHeight: this.computeTotalHeight(17, 0, 0, 0),\n\t\t\tcodeIndicatorHeight: 0,\n\t\t\toutputIndicatorHeight: 0,\n\t\t\tbottomToolbarOffset: 0,\n\t\t\tlayoutState: CellLayoutState.Uninitialized,\n\t\t\testimatedHasHorizontalScrolling: false,\n\t\t\toutlineWidth: 1,\n\t\t\ttopMargin: layoutConfiguration.cellTopMargin,\n\t\t\tbottomMargin: layoutConfiguration.cellBottomMargin,\n\t\t};\n\t}\n\n\tupdateExecutionState(e: ICellExecutionStateChangedEvent) {\n\t\tif (e.changed) {\n\t\t\tthis.executionErrorDiagnostic.set(undefined, undefined);\n\t\t\tthis._onDidStartExecution.fire(e);\n\t\t} else {\n\t\t\tthis._onDidStopExecution.fire(e);\n\t\t}\n\t}\n\n\toverride updateOptions(e: NotebookOptionsChangeEvent) {\n\t\tsuper.updateOptions(e);\n\t\tif (e.cellStatusBarVisibility || e.insertToolbarPosition || e.cellToolbarLocation) {\n\t\t\tthis.layoutChange({});\n\t\t}\n\t}\n\n\tpauseLayout() {\n\t\tthis._pauseableEmitter.pause();\n\t}\n\n\tresumeLayout() {\n\t\tthis._pauseableEmitter.resume();\n\t}\n\n\tlayoutChange(state: CodeCellLayoutChangeEvent, source?: string) {\n\t\t// recompute\n\t\tthis._ensureOutputsTop();\n\t\tconst notebookLayoutConfiguration = this.viewContext.notebookOptions.getLayoutConfiguration();\n\t\tconst bottomToolbarDimensions = this.viewContext.notebookOptions.computeBottomToolbarDimensions(this.viewType);\n\t\tconst outputShowMoreContainerHeight = state.outputShowMoreContainerHeight ? state.outputShowMoreContainerHeight : this._layoutInfo.outputShowMoreContainerHeight;\n\t\tconst outputTotalHeight = Math.max(this._outputMinHeight, this.isOutputCollapsed ? notebookLayoutConfiguration.collapsedIndicatorHeight : this._outputsTop!.getTotalSum());\n\t\tconst commentHeight = state.commentHeight ? this._commentHeight : this._layoutInfo.commentHeight;\n\n\t\tconst originalLayout = this.layoutInfo;\n\t\tif (!this.isInputCollapsed) {\n\t\t\tlet newState: CellLayoutState;\n\t\t\tlet editorHeight: number;\n\t\t\tlet totalHeight: number;\n\t\t\tlet hasHorizontalScrolling = false;\n\t\t\tconst chatHeight = state.chatHeight ? this._chatHeight : this._layoutInfo.chatHeight;\n\t\t\tif (!state.editorHeight && this._layoutInfo.layoutState === CellLayoutState.FromCache && !state.outputHeight) {\n\t\t\t\t// No new editorHeight info - keep cached totalHeight and estimate editorHeight\n\t\t\t\tconst estimate = this.estimateEditorHeight(state.font?.lineHeight ?? this._layoutInfo.fontInfo?.lineHeight);\n\t\t\t\teditorHeight = estimate.editorHeight;\n\t\t\t\thasHorizontalScrolling = estimate.hasHorizontalScrolling;\n\t\t\t\ttotalHeight = this._layoutInfo.totalHeight;\n\t\t\t\tnewState = CellLayoutState.FromCache;\n\t\t\t} else if (state.editorHeight || this._layoutInfo.layoutState === CellLayoutState.Measured) {\n\t\t\t\t// Editor has been measured\n\t\t\t\teditorHeight = this._editorHeight;\n\t\t\t\ttotalHeight = this.computeTotalHeight(this._editorHeight, outputTotalHeight, outputShowMoreContainerHeight, chatHeight);\n\t\t\t\tnewState = CellLayoutState.Measured;\n\t\t\t\thasHorizontalScrolling = this._layoutInfo.estimatedHasHorizontalScrolling;\n\t\t\t} else {\n\t\t\t\tconst estimate = this.estimateEditorHeight(state.font?.lineHeight ?? this._layoutInfo.fontInfo?.lineHeight);\n\t\t\t\teditorHeight = estimate.editorHeight;\n\t\t\t\thasHorizontalScrolling = estimate.hasHorizontalScrolling;\n\t\t\t\ttotalHeight = this.computeTotalHeight(editorHeight, outputTotalHeight, outputShowMoreContainerHeight, chatHeight);\n\t\t\t\tnewState = CellLayoutState.Estimated;\n\t\t\t}\n\n\t\t\tconst statusBarHeight = this.viewContext.notebookOptions.computeEditorStatusbarHeight(this.internalMetadata, this.uri);\n\t\t\tconst codeIndicatorHeight = editorHeight + statusBarHeight;\n\t\t\tconst outputIndicatorHeight = outputTotalHeight + outputShowMoreContainerHeight;\n\t\t\tconst outputContainerOffset = notebookLayoutConfiguration.editorToolbarHeight\n\t\t\t\t+ notebookLayoutConfiguration.cellTopMargin // CELL_TOP_MARGIN\n\t\t\t\t+ chatHeight\n\t\t\t\t+ editorHeight\n\t\t\t\t+ statusBarHeight;\n\t\t\tconst outputShowMoreContainerOffset = totalHeight\n\t\t\t\t- bottomToolbarDimensions.bottomToolbarGap\n\t\t\t\t- bottomToolbarDimensions.bottomToolbarHeight / 2\n\t\t\t\t- outputShowMoreContainerHeight;\n\t\t\tconst bottomToolbarOffset = this.viewContext.notebookOptions.computeBottomToolbarOffset(totalHeight, this.viewType);\n\t\t\tconst editorWidth = state.outerWidth !== undefined\n\t\t\t\t? this.viewContext.notebookOptions.computeCodeCellEditorWidth(state.outerWidth)\n\t\t\t\t: this._layoutInfo?.editorWidth;\n\n\t\t\tthis._layoutInfo = {\n\t\t\t\tfontInfo: state.font ?? this._layoutInfo.fontInfo ?? null,\n\t\t\t\tchatHeight,\n\t\t\t\teditorHeight,\n\t\t\t\teditorWidth,\n\t\t\t\tstatusBarHeight,\n\t\t\t\toutputContainerOffset,\n\t\t\t\toutputTotalHeight,\n\t\t\t\toutputShowMoreContainerHeight,\n\t\t\t\toutputShowMoreContainerOffset,\n\t\t\t\tcommentOffset: outputContainerOffset + outputTotalHeight,\n\t\t\t\tcommentHeight,\n\t\t\t\ttotalHeight,\n\t\t\t\tcodeIndicatorHeight,\n\t\t\t\toutputIndicatorHeight,\n\t\t\t\tbottomToolbarOffset,\n\t\t\t\tlayoutState: newState,\n\t\t\t\testimatedHasHorizontalScrolling: hasHorizontalScrolling,\n\t\t\t\ttopMargin: notebookLayoutConfiguration.cellTopMargin,\n\t\t\t\tbottomMargin: notebookLayoutConfiguration.cellBottomMargin,\n\t\t\t\toutlineWidth: 1\n\t\t\t};\n\t\t} else {\n\t\t\tconst codeIndicatorHeight = notebookLayoutConfiguration.collapsedIndicatorHeight;\n\t\t\tconst outputIndicatorHeight = outputTotalHeight + outputShowMoreContainerHeight;\n\t\t\tconst chatHeight = state.chatHeight ? this._chatHeight : this._layoutInfo.chatHeight;\n\n\t\t\tconst outputContainerOffset = notebookLayoutConfiguration.cellTopMargin + notebookLayoutConfiguration.collapsedIndicatorHeight;\n\t\t\tconst totalHeight =\n\t\t\t\tnotebookLayoutConfiguration.cellTopMargin\n\t\t\t\t+ notebookLayoutConfiguration.collapsedIndicatorHeight\n\t\t\t\t+ notebookLayoutConfiguration.cellBottomMargin //CELL_BOTTOM_MARGIN\n\t\t\t\t+ bottomToolbarDimensions.bottomToolbarGap //BOTTOM_CELL_TOOLBAR_GAP\n\t\t\t\t+ chatHeight\n\t\t\t\t+ commentHeight\n\t\t\t\t+ outputTotalHeight + outputShowMoreContainerHeight;\n\t\t\tconst outputShowMoreContainerOffset = totalHeight\n\t\t\t\t- bottomToolbarDimensions.bottomToolbarGap\n\t\t\t\t- bottomToolbarDimensions.bottomToolbarHeight / 2\n\t\t\t\t- outputShowMoreContainerHeight;\n\t\t\tconst bottomToolbarOffset = this.viewContext.notebookOptions.computeBottomToolbarOffset(totalHeight, this.viewType);\n\t\t\tconst editorWidth = state.outerWidth !== undefined\n\t\t\t\t? this.viewContext.notebookOptions.computeCodeCellEditorWidth(state.outerWidth)\n\t\t\t\t: this._layoutInfo?.editorWidth;\n\n\t\t\tthis._layoutInfo = {\n\t\t\t\tfontInfo: state.font ?? this._layoutInfo.fontInfo ?? null,\n\t\t\t\teditorHeight: this._layoutInfo.editorHeight,\n\t\t\t\teditorWidth,\n\t\t\t\tchatHeight: chatHeight,\n\t\t\t\tstatusBarHeight: 0,\n\t\t\t\toutputContainerOffset,\n\t\t\t\toutputTotalHeight,\n\t\t\t\toutputShowMoreContainerHeight,\n\t\t\t\toutputShowMoreContainerOffset,\n\t\t\t\tcommentOffset: outputContainerOffset + outputTotalHeight,\n\t\t\t\tcommentHeight,\n\t\t\t\ttotalHeight,\n\t\t\t\tcodeIndicatorHeight,\n\t\t\t\toutputIndicatorHeight,\n\t\t\t\tbottomToolbarOffset,\n\t\t\t\tlayoutState: this._layoutInfo.layoutState,\n\t\t\t\testimatedHasHorizontalScrolling: false,\n\t\t\t\toutlineWidth: 1,\n\t\t\t\ttopMargin: notebookLayoutConfiguration.cellTopMargin,\n\t\t\t\tbottomMargin: notebookLayoutConfiguration.cellBottomMargin,\n\t\t\t};\n\t\t}\n\n\t\tthis._fireOnDidChangeLayout({\n\t\t\t...state,\n\t\t\ttotalHeight: this.layoutInfo.totalHeight !== originalLayout.totalHeight,\n\t\t\tsource,\n\t\t});\n\t}\n\n\tprivate _fireOnDidChangeLayout(state: CodeCellLayoutChangeEvent) {\n\t\tthis._pauseableEmitter.fire(state);\n\t}\n\n\toverride restoreEditorViewState(editorViewStates: editorCommon.ICodeEditorViewState | null, totalHeight?: number) {\n\t\tsuper.restoreEditorViewState(editorViewStates);\n\t\tif (totalHeight !== undefined && this._layoutInfo.layoutState !== CellLayoutState.Measured) {\n\t\t\tthis._layoutInfo = {\n\t\t\t\t...this._layoutInfo,\n\t\t\t\ttotalHeight: totalHeight,\n\t\t\t\tlayoutState: CellLayoutState.FromCache,\n\t\t\t};\n\t\t}\n\t}\n\n\tgetDynamicHeight() {\n\t\tthis._onLayoutInfoRead.fire();\n\t\treturn this._layoutInfo.totalHeight;\n\t}\n\n\tgetHeight(lineHeight: number) {\n\t\tif (this._layoutInfo.layoutState === CellLayoutState.Uninitialized) {\n\t\t\tconst estimate = this.estimateEditorHeight(lineHeight);\n\t\t\treturn this.computeTotalHeight(estimate.editorHeight, 0, 0, 0);\n\t\t} else {\n\t\t\treturn this._layoutInfo.totalHeight;\n\t\t}\n\t}\n\n\tprivate estimateEditorHeight(lineHeight: number | undefined = 20): { editorHeight: number; hasHorizontalScrolling: boolean } {\n\t\tlet hasHorizontalScrolling = false;\n\t\tconst cellEditorOptions = this.viewContext.getBaseCellEditorOptions(this.language);\n\t\tif (this.layoutInfo.fontInfo && cellEditorOptions.value.wordWrap === 'off') {\n\t\t\tfor (let i = 0; i < this.lineCount; i++) {\n\t\t\t\tconst max = this.textBuffer.getLineLastNonWhitespaceColumn(i + 1);\n\t\t\t\tconst estimatedWidth = max * (this.layoutInfo.fontInfo.typicalHalfwidthCharacterWidth + this.layoutInfo.fontInfo.letterSpacing);\n\t\t\t\tif (estimatedWidth > this.layoutInfo.editorWidth) {\n\t\t\t\t\thasHorizontalScrolling = true;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tconst verticalScrollbarHeight = hasHorizontalScrolling ? 12 : 0; // take zoom level into account\n\t\tconst editorPadding = this.viewContext.notebookOptions.computeEditorPadding(this.internalMetadata, this.uri);\n\t\tconst editorHeight = this.lineCount * lineHeight\n\t\t\t+ editorPadding.top\n\t\t\t+ editorPadding.bottom // EDITOR_BOTTOM_PADDING\n\t\t\t+ verticalScrollbarHeight;\n\t\treturn {\n\t\t\teditorHeight,\n\t\t\thasHorizontalScrolling\n\t\t};\n\t}\n\n\tprivate computeTotalHeight(editorHeight: number, outputsTotalHeight: number, outputShowMoreContainerHeight: number, chatHeight: number): number {\n\t\tconst layoutConfiguration = this.viewContext.notebookOptions.getLayoutConfiguration();\n\t\tconst { bottomToolbarGap } = this.viewContext.notebookOptions.computeBottomToolbarDimensions(this.viewType);\n\t\treturn layoutConfiguration.editorToolbarHeight\n\t\t\t+ layoutConfiguration.cellTopMargin\n\t\t\t+ chatHeight\n\t\t\t+ editorHeight\n\t\t\t+ this.viewContext.notebookOptions.computeEditorStatusbarHeight(this.internalMetadata, this.uri)\n\t\t\t+ this._commentHeight\n\t\t\t+ outputsTotalHeight\n\t\t\t+ outputShowMoreContainerHeight\n\t\t\t+ bottomToolbarGap\n\t\t\t+ layoutConfiguration.cellBottomMargin;\n\t}\n\n\tprotected onDidChangeTextModelContent(): void {\n\t\tif (this.getEditState() !== CellEditState.Editing) {\n\t\t\tthis.updateEditState(CellEditState.Editing, 'onDidChangeTextModelContent');\n\t\t\tthis._onDidChangeState.fire({ contentChanged: true });\n\t\t}\n\t}\n\n\tonDeselect() {\n\t\tthis.updateEditState(CellEditState.Preview, 'onDeselect');\n\t}\n\n\tupdateOutputShowMoreContainerHeight(height: number) {\n\t\tthis.layoutChange({ outputShowMoreContainerHeight: height }, 'CodeCellViewModel#updateOutputShowMoreContainerHeight');\n\t}\n\n\tupdateOutputMinHeight(height: number) {\n\t\tthis.outputMinHeight = height;\n\t}\n\n\tunlockOutputHeight() {\n\t\tthis.outputMinHeight = 0;\n\t\tthis.layoutChange({ outputHeight: true });\n\t}\n\n\tupdateOutputHeight(index: number, height: number, source?: string) {\n\t\tif (index >= this._outputCollection.length) {\n\t\t\tthrow new Error('Output index out of range!');\n\t\t}\n\n\t\tthis._ensureOutputsTop();\n\n\t\ttry {\n\t\t\tif (index === 0 || height > 0) {\n\t\t\t\tthis._outputViewModels[index].setVisible(true);\n\t\t\t} else if (height === 0) {\n\t\t\t\tthis._outputViewModels[index].setVisible(false);\n\t\t\t}\n\t\t} catch (e) {\n\t\t\tconst errorMessage = `Failed to update output height for cell ${this.handle}, output ${index}. `\n\t\t\t\t+ `this.outputCollection.length: ${this._outputCollection.length}, this._outputViewModels.length: ${this._outputViewModels.length}`;\n\t\t\tthrow new Error(`${errorMessage}.\\n Error: ${e.message}`);\n\t\t}\n\n\t\tif (this._outputViewModels[index].visible.get() && height < 28) {\n\t\t\theight = 28;\n\t\t}\n\n\t\tthis._outputCollection[index] = height;\n\t\tif (this._outputsTop!.setValue(index, height)) {\n\t\t\tthis.layoutChange({ outputHeight: true }, source);\n\t\t}\n\t}\n\n\tgetOutputOffsetInContainer(index: number) {\n\t\tthis._ensureOutputsTop();\n\n\t\tif (index >= this._outputCollection.length) {\n\t\t\tthrow new Error('Output index out of range!');\n\t\t}\n\n\t\treturn this._outputsTop!.getPrefixSum(index - 1);\n\t}\n\n\tgetOutputOffset(index: number): number {\n\t\treturn this.layoutInfo.outputContainerOffset + this.getOutputOffsetInContainer(index);\n\t}\n\n\tspliceOutputHeights(start: number, deleteCnt: number, heights: number[]) {\n\t\tthis._ensureOutputsTop();\n\n\t\tthis._outputsTop!.removeValues(start, deleteCnt);\n\t\tif (heights.length) {\n\t\t\tconst values = new Uint32Array(heights.length);\n\t\t\tfor (let i = 0; i < heights.length; i++) {\n\t\t\t\tvalues[i] = heights[i];\n\t\t\t}\n\n\t\t\tthis._outputsTop!.insertValues(start, values);\n\t\t}\n\n\t\tthis.layoutChange({ outputHeight: true }, 'CodeCellViewModel#spliceOutputs');\n\t}\n\n\tprivate _ensureOutputsTop(): void {\n\t\tif (!this._outputsTop) {\n\t\t\tconst values = new Uint32Array(this._outputCollection.length);\n\t\t\tfor (let i = 0; i < this._outputCollection.length; i++) {\n\t\t\t\tvalues[i] = this._outputCollection[i];\n\t\t\t}\n\n\t\t\tthis._outputsTop = new PrefixSumComputer(values);\n\t\t}\n\t}\n\n\tprivate readonly _hasFindResult = this._register(new Emitter<boolean>());\n\tpublic readonly hasFindResult: Event<boolean> = this._hasFindResult.event;\n\n\tstartFind(value: string, options: INotebookFindOptions): CellFindMatch | null {\n\t\tconst matches = super.cellStartFind(value, options);\n\n\t\tif (matches === null) {\n\t\t\treturn null;\n\t\t}\n\n\t\treturn {\n\t\t\tcell: this,\n\t\t\tcontentMatches: matches\n\t\t};\n\t}\n\n\toverride dispose() {\n\t\tsuper.dispose();\n\n\t\tthis._outputCollection = [];\n\t\tthis._outputsTop = null;\n\t\tdispose(this._outputViewModels);\n\t}\n}\n"]}