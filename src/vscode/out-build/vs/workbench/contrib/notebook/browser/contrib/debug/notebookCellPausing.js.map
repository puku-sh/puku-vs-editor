{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/contrib/notebook/browser/contrib/debug/notebookCellPausing.ts","vs/workbench/contrib/notebook/browser/contrib/debug/notebookCellPausing.ts"],"names":[],"mappings":"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","file":"notebookCellPausing.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { RunOnceScheduler } from '../../../../../../base/common/async.js';\nimport { Disposable } from '../../../../../../base/common/lifecycle.js';\nimport { URI } from '../../../../../../base/common/uri.js';\nimport { Registry } from '../../../../../../platform/registry/common/platform.js';\nimport { Extensions as WorkbenchExtensions, IWorkbenchContribution, IWorkbenchContributionsRegistry } from '../../../../../common/contributions.js';\nimport { IDebugService } from '../../../../debug/common/debug.js';\nimport { Thread } from '../../../../debug/common/debugModel.js';\nimport { CellUri } from '../../../common/notebookCommon.js';\nimport { CellExecutionUpdateType } from '../../../common/notebookExecutionService.js';\nimport { INotebookExecutionStateService } from '../../../common/notebookExecutionStateService.js';\nimport { LifecyclePhase } from '../../../../../services/lifecycle/common/lifecycle.js';\n\nclass NotebookCellPausing extends Disposable implements IWorkbenchContribution {\n\tprivate readonly _pausedCells = new Set<string>();\n\n\tprivate _scheduler: RunOnceScheduler;\n\n\tconstructor(\n\t\t@IDebugService private readonly _debugService: IDebugService,\n\t\t@INotebookExecutionStateService private readonly _notebookExecutionStateService: INotebookExecutionStateService,\n\t) {\n\t\tsuper();\n\n\t\tthis._register(_debugService.getModel().onDidChangeCallStack(() => {\n\t\t\t// First update using the stale callstack if the real callstack is empty, to reduce blinking while stepping.\n\t\t\t// After not pausing for 2s, update again with the latest callstack.\n\t\t\tthis.onDidChangeCallStack(true);\n\t\t\tthis._scheduler.schedule();\n\t\t}));\n\t\tthis._scheduler = this._register(new RunOnceScheduler(() => this.onDidChangeCallStack(false), 2000));\n\t}\n\n\tprivate async onDidChangeCallStack(fallBackOnStaleCallstack: boolean): Promise<void> {\n\t\tconst newPausedCells = new Set<string>();\n\n\t\tfor (const session of this._debugService.getModel().getSessions()) {\n\t\t\tfor (const thread of session.getAllThreads()) {\n\t\t\t\tlet callStack = thread.getCallStack();\n\t\t\t\tif (fallBackOnStaleCallstack && !callStack.length) {\n\t\t\t\t\tcallStack = (thread as Thread).getStaleCallStack();\n\t\t\t\t}\n\n\t\t\t\tcallStack.forEach(sf => {\n\t\t\t\t\tconst parsed = CellUri.parse(sf.source.uri);\n\t\t\t\t\tif (parsed) {\n\t\t\t\t\t\tnewPausedCells.add(sf.source.uri.toString());\n\t\t\t\t\t\tthis.editIsPaused(sf.source.uri, true);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tfor (const uri of this._pausedCells) {\n\t\t\tif (!newPausedCells.has(uri)) {\n\t\t\t\tthis.editIsPaused(URI.parse(uri), false);\n\t\t\t\tthis._pausedCells.delete(uri);\n\t\t\t}\n\t\t}\n\n\t\tnewPausedCells.forEach(cell => this._pausedCells.add(cell));\n\t}\n\n\tprivate editIsPaused(cellUri: URI, isPaused: boolean) {\n\t\tconst parsed = CellUri.parse(cellUri);\n\t\tif (parsed) {\n\t\t\tconst exeState = this._notebookExecutionStateService.getCellExecution(cellUri);\n\t\t\tif (exeState && (exeState.isPaused !== isPaused || !exeState.didPause)) {\n\t\t\t\texeState.update([{\n\t\t\t\t\teditType: CellExecutionUpdateType.ExecutionState,\n\t\t\t\t\tdidPause: true,\n\t\t\t\t\tisPaused\n\t\t\t\t}]);\n\t\t\t}\n\t\t}\n\t}\n}\n\nRegistry.as<IWorkbenchContributionsRegistry>(WorkbenchExtensions.Workbench).registerWorkbenchContribution(NotebookCellPausing, LifecyclePhase.Restored);\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { RunOnceScheduler } from '../../../../../../base/common/async.js';\nimport { Disposable } from '../../../../../../base/common/lifecycle.js';\nimport { URI } from '../../../../../../base/common/uri.js';\nimport { Registry } from '../../../../../../platform/registry/common/platform.js';\nimport { Extensions as WorkbenchExtensions, IWorkbenchContribution, IWorkbenchContributionsRegistry } from '../../../../../common/contributions.js';\nimport { IDebugService } from '../../../../debug/common/debug.js';\nimport { Thread } from '../../../../debug/common/debugModel.js';\nimport { CellUri } from '../../../common/notebookCommon.js';\nimport { CellExecutionUpdateType } from '../../../common/notebookExecutionService.js';\nimport { INotebookExecutionStateService } from '../../../common/notebookExecutionStateService.js';\nimport { LifecyclePhase } from '../../../../../services/lifecycle/common/lifecycle.js';\n\nclass NotebookCellPausing extends Disposable implements IWorkbenchContribution {\n\tprivate readonly _pausedCells = new Set<string>();\n\n\tprivate _scheduler: RunOnceScheduler;\n\n\tconstructor(\n\t\t@IDebugService private readonly _debugService: IDebugService,\n\t\t@INotebookExecutionStateService private readonly _notebookExecutionStateService: INotebookExecutionStateService,\n\t) {\n\t\tsuper();\n\n\t\tthis._register(_debugService.getModel().onDidChangeCallStack(() => {\n\t\t\t// First update using the stale callstack if the real callstack is empty, to reduce blinking while stepping.\n\t\t\t// After not pausing for 2s, update again with the latest callstack.\n\t\t\tthis.onDidChangeCallStack(true);\n\t\t\tthis._scheduler.schedule();\n\t\t}));\n\t\tthis._scheduler = this._register(new RunOnceScheduler(() => this.onDidChangeCallStack(false), 2000));\n\t}\n\n\tprivate async onDidChangeCallStack(fallBackOnStaleCallstack: boolean): Promise<void> {\n\t\tconst newPausedCells = new Set<string>();\n\n\t\tfor (const session of this._debugService.getModel().getSessions()) {\n\t\t\tfor (const thread of session.getAllThreads()) {\n\t\t\t\tlet callStack = thread.getCallStack();\n\t\t\t\tif (fallBackOnStaleCallstack && !callStack.length) {\n\t\t\t\t\tcallStack = (thread as Thread).getStaleCallStack();\n\t\t\t\t}\n\n\t\t\t\tcallStack.forEach(sf => {\n\t\t\t\t\tconst parsed = CellUri.parse(sf.source.uri);\n\t\t\t\t\tif (parsed) {\n\t\t\t\t\t\tnewPausedCells.add(sf.source.uri.toString());\n\t\t\t\t\t\tthis.editIsPaused(sf.source.uri, true);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tfor (const uri of this._pausedCells) {\n\t\t\tif (!newPausedCells.has(uri)) {\n\t\t\t\tthis.editIsPaused(URI.parse(uri), false);\n\t\t\t\tthis._pausedCells.delete(uri);\n\t\t\t}\n\t\t}\n\n\t\tnewPausedCells.forEach(cell => this._pausedCells.add(cell));\n\t}\n\n\tprivate editIsPaused(cellUri: URI, isPaused: boolean) {\n\t\tconst parsed = CellUri.parse(cellUri);\n\t\tif (parsed) {\n\t\t\tconst exeState = this._notebookExecutionStateService.getCellExecution(cellUri);\n\t\t\tif (exeState && (exeState.isPaused !== isPaused || !exeState.didPause)) {\n\t\t\t\texeState.update([{\n\t\t\t\t\teditType: CellExecutionUpdateType.ExecutionState,\n\t\t\t\t\tdidPause: true,\n\t\t\t\t\tisPaused\n\t\t\t\t}]);\n\t\t\t}\n\t\t}\n\t}\n}\n\nRegistry.as<IWorkbenchContributionsRegistry>(WorkbenchExtensions.Workbench).registerWorkbenchContribution(NotebookCellPausing, LifecyclePhase.Restored);\n"]}