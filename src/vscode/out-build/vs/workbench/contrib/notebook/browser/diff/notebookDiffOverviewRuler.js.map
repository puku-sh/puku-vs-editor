{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/contrib/notebook/browser/diff/notebookDiffOverviewRuler.ts","vs/workbench/contrib/notebook/browser/diff/notebookDiffOverviewRuler.ts"],"names":[],"mappings":"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","file":"notebookDiffOverviewRuler.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as DOM from '../../../../../base/browser/dom.js';\nimport { createFastDomNode, FastDomNode } from '../../../../../base/browser/fastDomNode.js';\nimport { PixelRatio } from '../../../../../base/browser/pixelRatio.js';\nimport { Color } from '../../../../../base/common/color.js';\nimport { DisposableStore, IDisposable } from '../../../../../base/common/lifecycle.js';\nimport { defaultInsertColor, defaultRemoveColor, diffInserted, diffOverviewRulerInserted, diffOverviewRulerRemoved, diffRemoved } from '../../../../../platform/theme/common/colorRegistry.js';\nimport { IColorTheme, IThemeService, Themable } from '../../../../../platform/theme/common/themeService.js';\nimport { IDiffElementViewModelBase } from './diffElementViewModel.js';\nimport { NotebookDiffEditorEventDispatcher } from './eventDispatcher.js';\nimport { INotebookTextDiffEditor } from './notebookDiffEditorBrowser.js';\n\nconst MINIMUM_SLIDER_SIZE = 20;\n\nexport class NotebookDiffOverviewRuler extends Themable {\n\tprivate readonly _domNode: FastDomNode<HTMLCanvasElement>;\n\tprivate readonly _overviewViewportDomElement: FastDomNode<HTMLElement>;\n\n\tprivate _diffElementViewModels: readonly IDiffElementViewModelBase[] = [];\n\tprivate _lanes = 2;\n\n\tprivate _insertColor: Color | null;\n\tprivate _insertColorHex: string | null;\n\tprivate _removeColor: Color | null;\n\tprivate _removeColorHex: string | null;\n\n\tprivate readonly _disposables: DisposableStore;\n\tprivate _renderAnimationFrame: IDisposable | null;\n\n\tconstructor(readonly notebookEditor: INotebookTextDiffEditor, readonly width: number, container: HTMLElement, @IThemeService themeService: IThemeService) {\n\t\tsuper(themeService);\n\t\tthis._insertColor = null;\n\t\tthis._removeColor = null;\n\t\tthis._insertColorHex = null;\n\t\tthis._removeColorHex = null;\n\t\tthis._disposables = this._register(new DisposableStore());\n\t\tthis._renderAnimationFrame = null;\n\t\tthis._domNode = createFastDomNode(document.createElement('canvas'));\n\t\tthis._domNode.setPosition('relative');\n\t\tthis._domNode.setLayerHinting(true);\n\t\tthis._domNode.setContain('strict');\n\n\t\tcontainer.appendChild(this._domNode.domNode);\n\n\t\tthis._overviewViewportDomElement = createFastDomNode(document.createElement('div'));\n\t\tthis._overviewViewportDomElement.setClassName('diffViewport');\n\t\tthis._overviewViewportDomElement.setPosition('absolute');\n\t\tthis._overviewViewportDomElement.setWidth(width);\n\t\tcontainer.appendChild(this._overviewViewportDomElement.domNode);\n\n\t\tthis._register(PixelRatio.getInstance(DOM.getWindow(this._domNode.domNode)).onDidChange(() => {\n\t\t\tthis._scheduleRender();\n\t\t}));\n\n\t\tthis._register(this.themeService.onDidColorThemeChange(e => {\n\t\t\tconst colorChanged = this.applyColors(e);\n\t\t\tif (colorChanged) {\n\t\t\t\tthis._scheduleRender();\n\t\t\t}\n\t\t}));\n\t\tthis.applyColors(this.themeService.getColorTheme());\n\n\t\tthis._register(this.notebookEditor.onDidScroll(() => {\n\t\t\tthis._renderOverviewViewport();\n\t\t}));\n\n\t\tthis._register(DOM.addStandardDisposableListener(container, DOM.EventType.POINTER_DOWN, (e) => {\n\t\t\tthis.notebookEditor.delegateVerticalScrollbarPointerDown(e);\n\t\t}));\n\t}\n\n\tprivate applyColors(theme: IColorTheme): boolean {\n\t\tconst newInsertColor = theme.getColor(diffOverviewRulerInserted) || (theme.getColor(diffInserted) || defaultInsertColor).transparent(2);\n\t\tconst newRemoveColor = theme.getColor(diffOverviewRulerRemoved) || (theme.getColor(diffRemoved) || defaultRemoveColor).transparent(2);\n\t\tconst hasChanges = !newInsertColor.equals(this._insertColor) || !newRemoveColor.equals(this._removeColor);\n\t\tthis._insertColor = newInsertColor;\n\t\tthis._removeColor = newRemoveColor;\n\t\tif (this._insertColor) {\n\t\t\tthis._insertColorHex = Color.Format.CSS.formatHexA(this._insertColor);\n\t\t}\n\n\t\tif (this._removeColor) {\n\t\t\tthis._removeColorHex = Color.Format.CSS.formatHexA(this._removeColor);\n\t\t}\n\n\t\treturn hasChanges;\n\t}\n\n\tlayout() {\n\t\tthis._layoutNow();\n\t}\n\n\tupdateViewModels(elements: readonly IDiffElementViewModelBase[], eventDispatcher: NotebookDiffEditorEventDispatcher | undefined) {\n\t\tthis._disposables.clear();\n\n\t\tthis._diffElementViewModels = elements;\n\n\t\tif (eventDispatcher) {\n\t\t\tthis._disposables.add(eventDispatcher.onDidChangeLayout(() => {\n\t\t\t\tthis._scheduleRender();\n\t\t\t}));\n\n\t\t\tthis._disposables.add(eventDispatcher.onDidChangeCellLayout(() => {\n\t\t\t\tthis._scheduleRender();\n\t\t\t}));\n\t\t}\n\n\t\tthis._scheduleRender();\n\t}\n\n\tprivate _scheduleRender(): void {\n\t\tif (this._renderAnimationFrame === null) {\n\t\t\tthis._renderAnimationFrame = DOM.runAtThisOrScheduleAtNextAnimationFrame(DOM.getWindow(this._domNode.domNode), this._onRenderScheduled.bind(this), 16);\n\t\t}\n\t}\n\n\tprivate _onRenderScheduled(): void {\n\t\tthis._renderAnimationFrame = null;\n\t\tthis._layoutNow();\n\t}\n\n\tprivate _layoutNow() {\n\t\tconst layoutInfo = this.notebookEditor.getLayoutInfo();\n\t\tconst height = layoutInfo.height;\n\t\tconst contentHeight = this._diffElementViewModels.map(view => view.totalHeight).reduce((a, b) => a + b, 0);\n\t\tconst ratio = PixelRatio.getInstance(DOM.getWindow(this._domNode.domNode)).value;\n\t\tthis._domNode.setWidth(this.width);\n\t\tthis._domNode.setHeight(height);\n\t\tthis._domNode.domNode.width = this.width * ratio;\n\t\tthis._domNode.domNode.height = height * ratio;\n\t\tconst ctx = this._domNode.domNode.getContext('2d')!;\n\t\tctx.clearRect(0, 0, this.width * ratio, height * ratio);\n\t\tthis._renderCanvas(ctx, this.width * ratio, height * ratio, contentHeight * ratio, ratio);\n\t\tthis._renderOverviewViewport();\n\t}\n\n\tprivate _renderOverviewViewport(): void {\n\t\tconst layout = this._computeOverviewViewport();\n\t\tif (!layout) {\n\t\t\tthis._overviewViewportDomElement.setTop(0);\n\t\t\tthis._overviewViewportDomElement.setHeight(0);\n\t\t} else {\n\t\t\tthis._overviewViewportDomElement.setTop(layout.top);\n\t\t\tthis._overviewViewportDomElement.setHeight(layout.height);\n\t\t}\n\t}\n\n\tprivate _computeOverviewViewport(): { height: number; top: number } | null {\n\t\tconst layoutInfo = this.notebookEditor.getLayoutInfo();\n\t\tif (!layoutInfo) {\n\t\t\treturn null;\n\t\t}\n\n\t\tconst scrollTop = this.notebookEditor.getScrollTop();\n\t\tconst scrollHeight = this.notebookEditor.getScrollHeight();\n\n\t\tconst computedAvailableSize = Math.max(0, layoutInfo.height);\n\t\tconst computedRepresentableSize = Math.max(0, computedAvailableSize - 2 * 0);\n\t\tconst visibleSize = layoutInfo.height;\n\t\tconst computedSliderSize = Math.round(Math.max(MINIMUM_SLIDER_SIZE, Math.floor(visibleSize * computedRepresentableSize / scrollHeight)));\n\t\tconst computedSliderRatio = (computedRepresentableSize - computedSliderSize) / (scrollHeight - visibleSize);\n\t\tconst computedSliderPosition = Math.round(scrollTop * computedSliderRatio);\n\n\t\treturn {\n\t\t\theight: computedSliderSize,\n\t\t\ttop: computedSliderPosition\n\t\t};\n\t}\n\n\tprivate _renderCanvas(ctx: CanvasRenderingContext2D, width: number, height: number, scrollHeight: number, ratio: number) {\n\t\tif (!this._insertColorHex || !this._removeColorHex) {\n\t\t\t// no op when colors are not yet known\n\t\t\treturn;\n\t\t}\n\n\t\tconst laneWidth = width / this._lanes;\n\t\tlet currentFrom = 0;\n\t\tfor (let i = 0; i < this._diffElementViewModels.length; i++) {\n\t\t\tconst element = this._diffElementViewModels[i];\n\n\t\t\tconst cellHeight = Math.round((element.totalHeight / scrollHeight) * ratio * height);\n\t\t\tswitch (element.type) {\n\t\t\t\tcase 'insert':\n\t\t\t\t\tctx.fillStyle = this._insertColorHex;\n\t\t\t\t\tctx.fillRect(laneWidth, currentFrom, laneWidth, cellHeight);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'delete':\n\t\t\t\t\tctx.fillStyle = this._removeColorHex;\n\t\t\t\t\tctx.fillRect(0, currentFrom, laneWidth, cellHeight);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'unchanged':\n\t\t\t\tcase 'unchangedMetadata':\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'modified':\n\t\t\t\tcase 'modifiedMetadata':\n\t\t\t\t\tctx.fillStyle = this._removeColorHex;\n\t\t\t\t\tctx.fillRect(0, currentFrom, laneWidth, cellHeight);\n\t\t\t\t\tctx.fillStyle = this._insertColorHex;\n\t\t\t\t\tctx.fillRect(laneWidth, currentFrom, laneWidth, cellHeight);\n\t\t\t\t\tbreak;\n\t\t\t}\n\n\n\t\t\tcurrentFrom += cellHeight;\n\t\t}\n\t}\n\n\toverride dispose() {\n\t\tif (this._renderAnimationFrame !== null) {\n\t\t\tthis._renderAnimationFrame.dispose();\n\t\t\tthis._renderAnimationFrame = null;\n\t\t}\n\n\t\tsuper.dispose();\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as DOM from '../../../../../base/browser/dom.js';\nimport { createFastDomNode, FastDomNode } from '../../../../../base/browser/fastDomNode.js';\nimport { PixelRatio } from '../../../../../base/browser/pixelRatio.js';\nimport { Color } from '../../../../../base/common/color.js';\nimport { DisposableStore, IDisposable } from '../../../../../base/common/lifecycle.js';\nimport { defaultInsertColor, defaultRemoveColor, diffInserted, diffOverviewRulerInserted, diffOverviewRulerRemoved, diffRemoved } from '../../../../../platform/theme/common/colorRegistry.js';\nimport { IColorTheme, IThemeService, Themable } from '../../../../../platform/theme/common/themeService.js';\nimport { IDiffElementViewModelBase } from './diffElementViewModel.js';\nimport { NotebookDiffEditorEventDispatcher } from './eventDispatcher.js';\nimport { INotebookTextDiffEditor } from './notebookDiffEditorBrowser.js';\n\nconst MINIMUM_SLIDER_SIZE = 20;\n\nexport class NotebookDiffOverviewRuler extends Themable {\n\tprivate readonly _domNode: FastDomNode<HTMLCanvasElement>;\n\tprivate readonly _overviewViewportDomElement: FastDomNode<HTMLElement>;\n\n\tprivate _diffElementViewModels: readonly IDiffElementViewModelBase[] = [];\n\tprivate _lanes = 2;\n\n\tprivate _insertColor: Color | null;\n\tprivate _insertColorHex: string | null;\n\tprivate _removeColor: Color | null;\n\tprivate _removeColorHex: string | null;\n\n\tprivate readonly _disposables: DisposableStore;\n\tprivate _renderAnimationFrame: IDisposable | null;\n\n\tconstructor(readonly notebookEditor: INotebookTextDiffEditor, readonly width: number, container: HTMLElement, @IThemeService themeService: IThemeService) {\n\t\tsuper(themeService);\n\t\tthis._insertColor = null;\n\t\tthis._removeColor = null;\n\t\tthis._insertColorHex = null;\n\t\tthis._removeColorHex = null;\n\t\tthis._disposables = this._register(new DisposableStore());\n\t\tthis._renderAnimationFrame = null;\n\t\tthis._domNode = createFastDomNode(document.createElement('canvas'));\n\t\tthis._domNode.setPosition('relative');\n\t\tthis._domNode.setLayerHinting(true);\n\t\tthis._domNode.setContain('strict');\n\n\t\tcontainer.appendChild(this._domNode.domNode);\n\n\t\tthis._overviewViewportDomElement = createFastDomNode(document.createElement('div'));\n\t\tthis._overviewViewportDomElement.setClassName('diffViewport');\n\t\tthis._overviewViewportDomElement.setPosition('absolute');\n\t\tthis._overviewViewportDomElement.setWidth(width);\n\t\tcontainer.appendChild(this._overviewViewportDomElement.domNode);\n\n\t\tthis._register(PixelRatio.getInstance(DOM.getWindow(this._domNode.domNode)).onDidChange(() => {\n\t\t\tthis._scheduleRender();\n\t\t}));\n\n\t\tthis._register(this.themeService.onDidColorThemeChange(e => {\n\t\t\tconst colorChanged = this.applyColors(e);\n\t\t\tif (colorChanged) {\n\t\t\t\tthis._scheduleRender();\n\t\t\t}\n\t\t}));\n\t\tthis.applyColors(this.themeService.getColorTheme());\n\n\t\tthis._register(this.notebookEditor.onDidScroll(() => {\n\t\t\tthis._renderOverviewViewport();\n\t\t}));\n\n\t\tthis._register(DOM.addStandardDisposableListener(container, DOM.EventType.POINTER_DOWN, (e) => {\n\t\t\tthis.notebookEditor.delegateVerticalScrollbarPointerDown(e);\n\t\t}));\n\t}\n\n\tprivate applyColors(theme: IColorTheme): boolean {\n\t\tconst newInsertColor = theme.getColor(diffOverviewRulerInserted) || (theme.getColor(diffInserted) || defaultInsertColor).transparent(2);\n\t\tconst newRemoveColor = theme.getColor(diffOverviewRulerRemoved) || (theme.getColor(diffRemoved) || defaultRemoveColor).transparent(2);\n\t\tconst hasChanges = !newInsertColor.equals(this._insertColor) || !newRemoveColor.equals(this._removeColor);\n\t\tthis._insertColor = newInsertColor;\n\t\tthis._removeColor = newRemoveColor;\n\t\tif (this._insertColor) {\n\t\t\tthis._insertColorHex = Color.Format.CSS.formatHexA(this._insertColor);\n\t\t}\n\n\t\tif (this._removeColor) {\n\t\t\tthis._removeColorHex = Color.Format.CSS.formatHexA(this._removeColor);\n\t\t}\n\n\t\treturn hasChanges;\n\t}\n\n\tlayout() {\n\t\tthis._layoutNow();\n\t}\n\n\tupdateViewModels(elements: readonly IDiffElementViewModelBase[], eventDispatcher: NotebookDiffEditorEventDispatcher | undefined) {\n\t\tthis._disposables.clear();\n\n\t\tthis._diffElementViewModels = elements;\n\n\t\tif (eventDispatcher) {\n\t\t\tthis._disposables.add(eventDispatcher.onDidChangeLayout(() => {\n\t\t\t\tthis._scheduleRender();\n\t\t\t}));\n\n\t\t\tthis._disposables.add(eventDispatcher.onDidChangeCellLayout(() => {\n\t\t\t\tthis._scheduleRender();\n\t\t\t}));\n\t\t}\n\n\t\tthis._scheduleRender();\n\t}\n\n\tprivate _scheduleRender(): void {\n\t\tif (this._renderAnimationFrame === null) {\n\t\t\tthis._renderAnimationFrame = DOM.runAtThisOrScheduleAtNextAnimationFrame(DOM.getWindow(this._domNode.domNode), this._onRenderScheduled.bind(this), 16);\n\t\t}\n\t}\n\n\tprivate _onRenderScheduled(): void {\n\t\tthis._renderAnimationFrame = null;\n\t\tthis._layoutNow();\n\t}\n\n\tprivate _layoutNow() {\n\t\tconst layoutInfo = this.notebookEditor.getLayoutInfo();\n\t\tconst height = layoutInfo.height;\n\t\tconst contentHeight = this._diffElementViewModels.map(view => view.totalHeight).reduce((a, b) => a + b, 0);\n\t\tconst ratio = PixelRatio.getInstance(DOM.getWindow(this._domNode.domNode)).value;\n\t\tthis._domNode.setWidth(this.width);\n\t\tthis._domNode.setHeight(height);\n\t\tthis._domNode.domNode.width = this.width * ratio;\n\t\tthis._domNode.domNode.height = height * ratio;\n\t\tconst ctx = this._domNode.domNode.getContext('2d')!;\n\t\tctx.clearRect(0, 0, this.width * ratio, height * ratio);\n\t\tthis._renderCanvas(ctx, this.width * ratio, height * ratio, contentHeight * ratio, ratio);\n\t\tthis._renderOverviewViewport();\n\t}\n\n\tprivate _renderOverviewViewport(): void {\n\t\tconst layout = this._computeOverviewViewport();\n\t\tif (!layout) {\n\t\t\tthis._overviewViewportDomElement.setTop(0);\n\t\t\tthis._overviewViewportDomElement.setHeight(0);\n\t\t} else {\n\t\t\tthis._overviewViewportDomElement.setTop(layout.top);\n\t\t\tthis._overviewViewportDomElement.setHeight(layout.height);\n\t\t}\n\t}\n\n\tprivate _computeOverviewViewport(): { height: number; top: number } | null {\n\t\tconst layoutInfo = this.notebookEditor.getLayoutInfo();\n\t\tif (!layoutInfo) {\n\t\t\treturn null;\n\t\t}\n\n\t\tconst scrollTop = this.notebookEditor.getScrollTop();\n\t\tconst scrollHeight = this.notebookEditor.getScrollHeight();\n\n\t\tconst computedAvailableSize = Math.max(0, layoutInfo.height);\n\t\tconst computedRepresentableSize = Math.max(0, computedAvailableSize - 2 * 0);\n\t\tconst visibleSize = layoutInfo.height;\n\t\tconst computedSliderSize = Math.round(Math.max(MINIMUM_SLIDER_SIZE, Math.floor(visibleSize * computedRepresentableSize / scrollHeight)));\n\t\tconst computedSliderRatio = (computedRepresentableSize - computedSliderSize) / (scrollHeight - visibleSize);\n\t\tconst computedSliderPosition = Math.round(scrollTop * computedSliderRatio);\n\n\t\treturn {\n\t\t\theight: computedSliderSize,\n\t\t\ttop: computedSliderPosition\n\t\t};\n\t}\n\n\tprivate _renderCanvas(ctx: CanvasRenderingContext2D, width: number, height: number, scrollHeight: number, ratio: number) {\n\t\tif (!this._insertColorHex || !this._removeColorHex) {\n\t\t\t// no op when colors are not yet known\n\t\t\treturn;\n\t\t}\n\n\t\tconst laneWidth = width / this._lanes;\n\t\tlet currentFrom = 0;\n\t\tfor (let i = 0; i < this._diffElementViewModels.length; i++) {\n\t\t\tconst element = this._diffElementViewModels[i];\n\n\t\t\tconst cellHeight = Math.round((element.totalHeight / scrollHeight) * ratio * height);\n\t\t\tswitch (element.type) {\n\t\t\t\tcase 'insert':\n\t\t\t\t\tctx.fillStyle = this._insertColorHex;\n\t\t\t\t\tctx.fillRect(laneWidth, currentFrom, laneWidth, cellHeight);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'delete':\n\t\t\t\t\tctx.fillStyle = this._removeColorHex;\n\t\t\t\t\tctx.fillRect(0, currentFrom, laneWidth, cellHeight);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'unchanged':\n\t\t\t\tcase 'unchangedMetadata':\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'modified':\n\t\t\t\tcase 'modifiedMetadata':\n\t\t\t\t\tctx.fillStyle = this._removeColorHex;\n\t\t\t\t\tctx.fillRect(0, currentFrom, laneWidth, cellHeight);\n\t\t\t\t\tctx.fillStyle = this._insertColorHex;\n\t\t\t\t\tctx.fillRect(laneWidth, currentFrom, laneWidth, cellHeight);\n\t\t\t\t\tbreak;\n\t\t\t}\n\n\n\t\t\tcurrentFrom += cellHeight;\n\t\t}\n\t}\n\n\toverride dispose() {\n\t\tif (this._renderAnimationFrame !== null) {\n\t\t\tthis._renderAnimationFrame.dispose();\n\t\t\tthis._renderAnimationFrame = null;\n\t\t}\n\n\t\tsuper.dispose();\n\t}\n}\n"]}