{"version":3,"sources":["vs/workbench/contrib/notebook/browser/controller/cellOperations.ts"],"names":[],"mappings":"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","file":"cellOperations.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { IBulkEditService, ResourceEdit, ResourceTextEdit } from '../../../../../editor/browser/services/bulkEditService.js';\nimport { IPosition, Position } from '../../../../../editor/common/core/position.js';\nimport { Range } from '../../../../../editor/common/core/range.js';\nimport { EndOfLinePreference, IReadonlyTextBuffer } from '../../../../../editor/common/model.js';\nimport { PLAINTEXT_LANGUAGE_ID } from '../../../../../editor/common/languages/modesRegistry.js';\nimport { ILanguageService } from '../../../../../editor/common/languages/language.js';\nimport { ResourceNotebookCellEdit } from '../../../bulkEdit/browser/bulkCellEdits.js';\nimport { INotebookActionContext, INotebookCellActionContext } from './coreActions.js';\nimport { CellEditState, CellFocusMode, expandCellRangesWithHiddenCells, IActiveNotebookEditor, ICellViewModel } from '../notebookBrowser.js';\nimport { CellViewModel, NotebookViewModel } from '../viewModel/notebookViewModelImpl.js';\nimport { cloneNotebookCellTextModel } from '../../common/model/notebookCellTextModel.js';\nimport { CellEditType, CellKind, ICellEditOperation, ICellReplaceEdit, IOutputDto, ISelectionState, NotebookCellMetadata, SelectionStateType } from '../../common/notebookCommon.js';\nimport { cellRangeContains, cellRangesToIndexes, ICellRange } from '../../common/notebookRange.js';\nimport { localize } from '../../../../../nls.js';\nimport { INotificationService } from '../../../../../platform/notification/common/notification.js';\nimport { INotebookKernelHistoryService } from '../../common/notebookKernelService.js';\n\nexport async function changeCellToKind(kind: CellKind, context: INotebookActionContext, language?: string, mime?: string): Promise<void> {\n\tconst { notebookEditor } = context;\n\tif (!notebookEditor.hasModel()) {\n\t\treturn;\n\t}\n\n\tif (notebookEditor.isReadOnly) {\n\t\treturn;\n\t}\n\n\tif (context.ui && context.cell) {\n\t\t// action from UI\n\t\tconst { cell } = context;\n\n\t\tif (cell.cellKind === kind) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst text = cell.getText();\n\t\tconst idx = notebookEditor.getCellIndex(cell);\n\n\t\tif (language === undefined) {\n\t\t\tconst availableLanguages = notebookEditor.activeKernel?.supportedLanguages ?? [];\n\t\t\tlanguage = availableLanguages[0] ?? PLAINTEXT_LANGUAGE_ID;\n\t\t}\n\n\t\tnotebookEditor.textModel.applyEdits([\n\t\t\t{\n\t\t\t\teditType: CellEditType.Replace,\n\t\t\t\tindex: idx,\n\t\t\t\tcount: 1,\n\t\t\t\tcells: [{\n\t\t\t\t\tcellKind: kind,\n\t\t\t\t\tsource: text,\n\t\t\t\t\tlanguage: language,\n\t\t\t\t\tmime: mime ?? cell.mime,\n\t\t\t\t\toutputs: cell.model.outputs,\n\t\t\t\t\tmetadata: cell.metadata,\n\t\t\t\t}]\n\t\t\t}\n\t\t], true, {\n\t\t\tkind: SelectionStateType.Index,\n\t\t\tfocus: notebookEditor.getFocus(),\n\t\t\tselections: notebookEditor.getSelections()\n\t\t}, () => {\n\t\t\treturn {\n\t\t\t\tkind: SelectionStateType.Index,\n\t\t\t\tfocus: notebookEditor.getFocus(),\n\t\t\t\tselections: notebookEditor.getSelections()\n\t\t\t};\n\t\t}, undefined, true);\n\t\tconst newCell = notebookEditor.cellAt(idx);\n\t\tawait notebookEditor.focusNotebookCell(newCell, cell.getEditState() === CellEditState.Editing ? 'editor' : 'container');\n\t} else if (context.selectedCells) {\n\t\tconst selectedCells = context.selectedCells;\n\t\tconst rawEdits: ICellEditOperation[] = [];\n\n\t\tselectedCells.forEach(cell => {\n\t\t\tif (cell.cellKind === kind) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst text = cell.getText();\n\t\t\tconst idx = notebookEditor.getCellIndex(cell);\n\n\t\t\tif (language === undefined) {\n\t\t\t\tconst availableLanguages = notebookEditor.activeKernel?.supportedLanguages ?? [];\n\t\t\t\tlanguage = availableLanguages[0] ?? PLAINTEXT_LANGUAGE_ID;\n\t\t\t}\n\n\t\t\trawEdits.push(\n\t\t\t\t{\n\t\t\t\t\teditType: CellEditType.Replace,\n\t\t\t\t\tindex: idx,\n\t\t\t\t\tcount: 1,\n\t\t\t\t\tcells: [{\n\t\t\t\t\t\tcellKind: kind,\n\t\t\t\t\t\tsource: text,\n\t\t\t\t\t\tlanguage: language,\n\t\t\t\t\t\tmime: mime ?? cell.mime,\n\t\t\t\t\t\toutputs: cell.model.outputs,\n\t\t\t\t\t\tmetadata: cell.metadata,\n\t\t\t\t\t}]\n\t\t\t\t}\n\t\t\t);\n\t\t});\n\n\t\tnotebookEditor.textModel.applyEdits(rawEdits, true, {\n\t\t\tkind: SelectionStateType.Index,\n\t\t\tfocus: notebookEditor.getFocus(),\n\t\t\tselections: notebookEditor.getSelections()\n\t\t}, () => {\n\t\t\treturn {\n\t\t\t\tkind: SelectionStateType.Index,\n\t\t\t\tfocus: notebookEditor.getFocus(),\n\t\t\t\tselections: notebookEditor.getSelections()\n\t\t\t};\n\t\t}, undefined, true);\n\t}\n}\n\nexport function runDeleteAction(editor: IActiveNotebookEditor, cell: ICellViewModel) {\n\tconst textModel = editor.textModel;\n\tconst selections = editor.getSelections();\n\tconst targetCellIndex = editor.getCellIndex(cell);\n\tconst containingSelection = selections.find(selection => selection.start <= targetCellIndex && targetCellIndex < selection.end);\n\n\tconst computeUndoRedo = !editor.isReadOnly || textModel.viewType === 'interactive';\n\tif (containingSelection) {\n\t\tconst edits: ICellReplaceEdit[] = selections.reverse().map(selection => ({\n\t\t\teditType: CellEditType.Replace, index: selection.start, count: selection.end - selection.start, cells: []\n\t\t}));\n\n\t\tconst nextCellAfterContainingSelection = containingSelection.end >= editor.getLength() ? undefined : editor.cellAt(containingSelection.end);\n\n\t\ttextModel.applyEdits(edits, true, { kind: SelectionStateType.Index, focus: editor.getFocus(), selections: editor.getSelections() }, () => {\n\t\t\tif (nextCellAfterContainingSelection) {\n\t\t\t\tconst cellIndex = textModel.cells.findIndex(cell => cell.handle === nextCellAfterContainingSelection.handle);\n\t\t\t\treturn { kind: SelectionStateType.Index, focus: { start: cellIndex, end: cellIndex + 1 }, selections: [{ start: cellIndex, end: cellIndex + 1 }] };\n\t\t\t} else {\n\t\t\t\tif (textModel.length) {\n\t\t\t\t\tconst lastCellIndex = textModel.length - 1;\n\t\t\t\t\treturn { kind: SelectionStateType.Index, focus: { start: lastCellIndex, end: lastCellIndex + 1 }, selections: [{ start: lastCellIndex, end: lastCellIndex + 1 }] };\n\n\t\t\t\t} else {\n\t\t\t\t\treturn { kind: SelectionStateType.Index, focus: { start: 0, end: 0 }, selections: [{ start: 0, end: 0 }] };\n\t\t\t\t}\n\t\t\t}\n\t\t}, undefined, computeUndoRedo);\n\t} else {\n\t\tconst focus = editor.getFocus();\n\t\tconst edits: ICellReplaceEdit[] = [{\n\t\t\teditType: CellEditType.Replace, index: targetCellIndex, count: 1, cells: []\n\t\t}];\n\n\t\tconst finalSelections: ICellRange[] = [];\n\t\tfor (let i = 0; i < selections.length; i++) {\n\t\t\tconst selection = selections[i];\n\n\t\t\tif (selection.end <= targetCellIndex) {\n\t\t\t\tfinalSelections.push(selection);\n\t\t\t} else if (selection.start > targetCellIndex) {\n\t\t\t\tfinalSelections.push({ start: selection.start - 1, end: selection.end - 1 });\n\t\t\t} else {\n\t\t\t\tfinalSelections.push({ start: targetCellIndex, end: targetCellIndex + 1 });\n\t\t\t}\n\t\t}\n\n\t\tif (editor.cellAt(focus.start) === cell) {\n\t\t\t// focus is the target, focus is also not part of any selection\n\t\t\tconst newFocus = focus.end === textModel.length ? { start: focus.start - 1, end: focus.end - 1 } : focus;\n\n\t\t\ttextModel.applyEdits(edits, true, { kind: SelectionStateType.Index, focus: editor.getFocus(), selections: editor.getSelections() }, () => ({\n\t\t\t\tkind: SelectionStateType.Index, focus: newFocus, selections: finalSelections\n\t\t\t}), undefined, computeUndoRedo);\n\t\t} else {\n\t\t\t// users decide to delete a cell out of current focus/selection\n\t\t\tconst newFocus = focus.start > targetCellIndex ? { start: focus.start - 1, end: focus.end - 1 } : focus;\n\n\t\t\ttextModel.applyEdits(edits, true, { kind: SelectionStateType.Index, focus: editor.getFocus(), selections: editor.getSelections() }, () => ({\n\t\t\t\tkind: SelectionStateType.Index, focus: newFocus, selections: finalSelections\n\t\t\t}), undefined, computeUndoRedo);\n\t\t}\n\t}\n}\n\nexport async function moveCellRange(context: INotebookActionContext, direction: 'up' | 'down'): Promise<void> {\n\tif (!context.notebookEditor.hasModel()) {\n\t\treturn;\n\t}\n\tconst editor = context.notebookEditor;\n\tconst textModel = editor.textModel;\n\n\tif (editor.isReadOnly) {\n\t\treturn;\n\t}\n\n\tlet range: ICellRange | undefined = undefined;\n\n\tif (context.cell) {\n\t\tconst idx = editor.getCellIndex(context.cell);\n\t\trange = { start: idx, end: idx + 1 };\n\t} else {\n\t\tconst selections = editor.getSelections();\n\t\tconst modelRanges = expandCellRangesWithHiddenCells(editor, selections);\n\t\trange = modelRanges[0];\n\t}\n\n\tif (!range || range.start === range.end) {\n\t\treturn;\n\t}\n\n\tif (direction === 'up') {\n\t\tif (range.start === 0) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst indexAbove = range.start - 1;\n\t\tconst finalSelection = { start: range.start - 1, end: range.end - 1 };\n\t\tconst focus = context.notebookEditor.getFocus();\n\t\tconst newFocus = cellRangeContains(range, focus) ? { start: focus.start - 1, end: focus.end - 1 } : { start: range.start - 1, end: range.start };\n\t\ttextModel.applyEdits([\n\t\t\t{\n\t\t\t\teditType: CellEditType.Move,\n\t\t\t\tindex: indexAbove,\n\t\t\t\tlength: 1,\n\t\t\t\tnewIdx: range.end - 1\n\t\t\t}],\n\t\t\ttrue,\n\t\t\t{\n\t\t\t\tkind: SelectionStateType.Index,\n\t\t\t\tfocus: editor.getFocus(),\n\t\t\t\tselections: editor.getSelections()\n\t\t\t},\n\t\t\t() => ({ kind: SelectionStateType.Index, focus: newFocus, selections: [finalSelection] }),\n\t\t\tundefined,\n\t\t\ttrue\n\t\t);\n\t\tconst focusRange = editor.getSelections()[0] ?? editor.getFocus();\n\t\teditor.revealCellRangeInView(focusRange);\n\t} else {\n\t\tif (range.end >= textModel.length) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst indexBelow = range.end;\n\t\tconst finalSelection = { start: range.start + 1, end: range.end + 1 };\n\t\tconst focus = editor.getFocus();\n\t\tconst newFocus = cellRangeContains(range, focus) ? { start: focus.start + 1, end: focus.end + 1 } : { start: range.start + 1, end: range.start + 2 };\n\n\t\ttextModel.applyEdits([\n\t\t\t{\n\t\t\t\teditType: CellEditType.Move,\n\t\t\t\tindex: indexBelow,\n\t\t\t\tlength: 1,\n\t\t\t\tnewIdx: range.start\n\t\t\t}],\n\t\t\ttrue,\n\t\t\t{\n\t\t\t\tkind: SelectionStateType.Index,\n\t\t\t\tfocus: editor.getFocus(),\n\t\t\t\tselections: editor.getSelections()\n\t\t\t},\n\t\t\t() => ({ kind: SelectionStateType.Index, focus: newFocus, selections: [finalSelection] }),\n\t\t\tundefined,\n\t\t\ttrue\n\t\t);\n\n\t\tconst focusRange = editor.getSelections()[0] ?? editor.getFocus();\n\t\teditor.revealCellRangeInView(focusRange);\n\t}\n}\n\nexport async function copyCellRange(context: INotebookCellActionContext, direction: 'up' | 'down'): Promise<void> {\n\tconst editor = context.notebookEditor;\n\tif (!editor.hasModel()) {\n\t\treturn;\n\t}\n\n\tconst textModel = editor.textModel;\n\n\tif (editor.isReadOnly) {\n\t\treturn;\n\t}\n\n\tlet range: ICellRange | undefined = undefined;\n\n\tif (context.ui) {\n\t\tconst targetCell = context.cell;\n\t\tconst targetCellIndex = editor.getCellIndex(targetCell);\n\t\trange = { start: targetCellIndex, end: targetCellIndex + 1 };\n\t} else {\n\t\tconst selections = editor.getSelections();\n\t\tconst modelRanges = expandCellRangesWithHiddenCells(editor, selections);\n\t\trange = modelRanges[0];\n\t}\n\n\tif (!range || range.start === range.end) {\n\t\treturn;\n\t}\n\n\tif (direction === 'up') {\n\t\t// insert up, without changing focus and selections\n\t\tconst focus = editor.getFocus();\n\t\tconst selections = editor.getSelections();\n\t\ttextModel.applyEdits([\n\t\t\t{\n\t\t\t\teditType: CellEditType.Replace,\n\t\t\t\tindex: range.end,\n\t\t\t\tcount: 0,\n\t\t\t\tcells: cellRangesToIndexes([range]).map(index => cloneNotebookCellTextModel(editor.cellAt(index)!.model))\n\t\t\t}],\n\t\t\ttrue,\n\t\t\t{\n\t\t\t\tkind: SelectionStateType.Index,\n\t\t\t\tfocus: focus,\n\t\t\t\tselections: selections\n\t\t\t},\n\t\t\t() => ({ kind: SelectionStateType.Index, focus: focus, selections: selections }),\n\t\t\tundefined,\n\t\t\ttrue\n\t\t);\n\t} else {\n\t\t// insert down, move selections\n\t\tconst focus = editor.getFocus();\n\t\tconst selections = editor.getSelections();\n\t\tconst newCells = cellRangesToIndexes([range]).map(index => cloneNotebookCellTextModel(editor.cellAt(index)!.model));\n\t\tconst countDelta = newCells.length;\n\t\tconst newFocus = context.ui ? focus : { start: focus.start + countDelta, end: focus.end + countDelta };\n\t\tconst newSelections = context.ui ? selections : [{ start: range.start + countDelta, end: range.end + countDelta }];\n\t\ttextModel.applyEdits([\n\t\t\t{\n\t\t\t\teditType: CellEditType.Replace,\n\t\t\t\tindex: range.end,\n\t\t\t\tcount: 0,\n\t\t\t\tcells: cellRangesToIndexes([range]).map(index => cloneNotebookCellTextModel(editor.cellAt(index)!.model))\n\t\t\t}],\n\t\t\ttrue,\n\t\t\t{\n\t\t\t\tkind: SelectionStateType.Index,\n\t\t\t\tfocus: focus,\n\t\t\t\tselections: selections\n\t\t\t},\n\t\t\t() => ({ kind: SelectionStateType.Index, focus: newFocus, selections: newSelections }),\n\t\t\tundefined,\n\t\t\ttrue\n\t\t);\n\n\t\tconst focusRange = editor.getSelections()[0] ?? editor.getFocus();\n\t\teditor.revealCellRangeInView(focusRange);\n\t}\n}\n\nexport async function joinSelectedCells(bulkEditService: IBulkEditService, notificationService: INotificationService, context: INotebookCellActionContext): Promise<void> {\n\tconst editor = context.notebookEditor;\n\tif (editor.isReadOnly) {\n\t\treturn;\n\t}\n\n\tconst edits: ResourceEdit[] = [];\n\tconst cells: ICellViewModel[] = [];\n\tfor (const selection of editor.getSelections()) {\n\t\tcells.push(...editor.getCellsInRange(selection));\n\t}\n\n\tif (cells.length <= 1) {\n\t\treturn;\n\t}\n\n\t// check if all cells are of the same kind\n\tconst cellKind = cells[0].cellKind;\n\tconst isSameKind = cells.every(cell => cell.cellKind === cellKind);\n\tif (!isSameKind) {\n\t\t// cannot join cells of different kinds\n\t\t// show warning and quit\n\t\tconst message = localize('notebookActions.joinSelectedCells', \"Cannot join cells of different kinds\");\n\t\treturn notificationService.warn(message);\n\t}\n\n\t// merge all cells content into first cell\n\tconst firstCell = cells[0];\n\tconst insertContent = cells.map(cell => cell.getText()).join(firstCell.textBuffer.getEOL());\n\tconst firstSelection = editor.getSelections()[0];\n\tedits.push(\n\t\tnew ResourceNotebookCellEdit(editor.textModel.uri,\n\t\t\t{\n\t\t\t\teditType: CellEditType.Replace,\n\t\t\t\tindex: firstSelection.start,\n\t\t\t\tcount: firstSelection.end - firstSelection.start,\n\t\t\t\tcells: [{\n\t\t\t\t\tcellKind: firstCell.cellKind,\n\t\t\t\t\tsource: insertContent,\n\t\t\t\t\tlanguage: firstCell.language,\n\t\t\t\t\tmime: firstCell.mime,\n\t\t\t\t\toutputs: firstCell.model.outputs,\n\t\t\t\t\tmetadata: firstCell.metadata,\n\t\t\t\t}]\n\t\t\t}\n\t\t)\n\t);\n\n\tfor (const selection of editor.getSelections().slice(1)) {\n\t\tedits.push(new ResourceNotebookCellEdit(editor.textModel.uri,\n\t\t\t{\n\t\t\t\teditType: CellEditType.Replace,\n\t\t\t\tindex: selection.start,\n\t\t\t\tcount: selection.end - selection.start,\n\t\t\t\tcells: []\n\t\t\t}));\n\t}\n\n\tif (edits.length) {\n\t\tawait bulkEditService.apply(\n\t\t\tedits,\n\t\t\t{ quotableLabel: localize('notebookActions.joinSelectedCells.label', \"Join Notebook Cells\") }\n\t\t);\n\t}\n}\n\nexport async function joinNotebookCells(editor: IActiveNotebookEditor, range: ICellRange, direction: 'above' | 'below', constraint?: CellKind): Promise<{ edits: ResourceEdit[]; cell: ICellViewModel; endFocus: ICellRange; endSelections: ICellRange[] } | null> {\n\tif (editor.isReadOnly) {\n\t\treturn null;\n\t}\n\n\tconst textModel = editor.textModel;\n\tconst cells = editor.getCellsInRange(range);\n\n\tif (!cells.length) {\n\t\treturn null;\n\t}\n\n\tif (range.start === 0 && direction === 'above') {\n\t\treturn null;\n\t}\n\n\tif (range.end === textModel.length && direction === 'below') {\n\t\treturn null;\n\t}\n\n\tfor (let i = 0; i < cells.length; i++) {\n\t\tconst cell = cells[i];\n\n\t\tif (constraint && cell.cellKind !== constraint) {\n\t\t\treturn null;\n\t\t}\n\t}\n\n\tif (direction === 'above') {\n\t\tconst above = editor.cellAt(range.start - 1) as CellViewModel;\n\t\tif (constraint && above.cellKind !== constraint) {\n\t\t\treturn null;\n\t\t}\n\n\t\tconst insertContent = cells.map(cell => (cell.textBuffer.getEOL() ?? '') + cell.getText()).join('');\n\t\tconst aboveCellLineCount = above.textBuffer.getLineCount();\n\t\tconst aboveCellLastLineEndColumn = above.textBuffer.getLineLength(aboveCellLineCount);\n\n\t\treturn {\n\t\t\tedits: [\n\t\t\t\tnew ResourceTextEdit(above.uri, { range: new Range(aboveCellLineCount, aboveCellLastLineEndColumn + 1, aboveCellLineCount, aboveCellLastLineEndColumn + 1), text: insertContent }),\n\t\t\t\tnew ResourceNotebookCellEdit(textModel.uri,\n\t\t\t\t\t{\n\t\t\t\t\t\teditType: CellEditType.Replace,\n\t\t\t\t\t\tindex: range.start,\n\t\t\t\t\t\tcount: range.end - range.start,\n\t\t\t\t\t\tcells: []\n\t\t\t\t\t}\n\t\t\t\t)\n\t\t\t],\n\t\t\tcell: above,\n\t\t\tendFocus: { start: range.start - 1, end: range.start },\n\t\t\tendSelections: [{ start: range.start - 1, end: range.start }]\n\t\t};\n\t} else {\n\t\tconst below = editor.cellAt(range.end) as CellViewModel;\n\t\tif (constraint && below.cellKind !== constraint) {\n\t\t\treturn null;\n\t\t}\n\n\t\tconst cell = cells[0];\n\t\tconst restCells = [...cells.slice(1), below];\n\t\tconst insertContent = restCells.map(cl => (cl.textBuffer.getEOL() ?? '') + cl.getText()).join('');\n\n\t\tconst cellLineCount = cell.textBuffer.getLineCount();\n\t\tconst cellLastLineEndColumn = cell.textBuffer.getLineLength(cellLineCount);\n\n\t\treturn {\n\t\t\tedits: [\n\t\t\t\tnew ResourceTextEdit(cell.uri, { range: new Range(cellLineCount, cellLastLineEndColumn + 1, cellLineCount, cellLastLineEndColumn + 1), text: insertContent }),\n\t\t\t\tnew ResourceNotebookCellEdit(textModel.uri,\n\t\t\t\t\t{\n\t\t\t\t\t\teditType: CellEditType.Replace,\n\t\t\t\t\t\tindex: range.start + 1,\n\t\t\t\t\t\tcount: range.end - range.start,\n\t\t\t\t\t\tcells: []\n\t\t\t\t\t}\n\t\t\t\t)\n\t\t\t],\n\t\t\tcell,\n\t\t\tendFocus: { start: range.start, end: range.start + 1 },\n\t\t\tendSelections: [{ start: range.start, end: range.start + 1 }]\n\t\t};\n\t}\n}\n\nexport async function joinCellsWithSurrounds(bulkEditService: IBulkEditService, context: INotebookCellActionContext, direction: 'above' | 'below'): Promise<void> {\n\tconst editor = context.notebookEditor;\n\tconst textModel = editor.textModel;\n\tconst viewModel = editor.getViewModel() as NotebookViewModel;\n\tlet ret: {\n\t\tedits: ResourceEdit[];\n\t\tcell: ICellViewModel;\n\t\tendFocus: ICellRange;\n\t\tendSelections: ICellRange[];\n\t} | null = null;\n\n\tif (context.ui) {\n\t\tconst focusMode = context.cell.focusMode;\n\t\tconst cellIndex = editor.getCellIndex(context.cell);\n\t\tret = await joinNotebookCells(editor, { start: cellIndex, end: cellIndex + 1 }, direction);\n\t\tif (!ret) {\n\t\t\treturn;\n\t\t}\n\n\t\tawait bulkEditService.apply(\n\t\t\tret?.edits,\n\t\t\t{ quotableLabel: 'Join Notebook Cells' }\n\t\t);\n\t\tviewModel.updateSelectionsState({ kind: SelectionStateType.Index, focus: ret.endFocus, selections: ret.endSelections });\n\t\tret.cell.updateEditState(CellEditState.Editing, 'joinCellsWithSurrounds');\n\t\teditor.revealCellRangeInView(editor.getFocus());\n\t\tif (focusMode === CellFocusMode.Editor) {\n\t\t\tret.cell.focusMode = CellFocusMode.Editor;\n\t\t}\n\t} else {\n\t\tconst selections = editor.getSelections();\n\t\tif (!selections.length) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst focus = editor.getFocus();\n\t\tconst focusMode = editor.cellAt(focus.start)?.focusMode;\n\n\t\tconst edits: ResourceEdit[] = [];\n\t\tlet cell: ICellViewModel | null = null;\n\t\tconst cells: ICellViewModel[] = [];\n\n\t\tfor (let i = selections.length - 1; i >= 0; i--) {\n\t\t\tconst selection = selections[i];\n\t\t\tconst containFocus = cellRangeContains(selection, focus);\n\n\t\t\tif (\n\t\t\t\tselection.end >= textModel.length && direction === 'below'\n\t\t\t\t|| selection.start === 0 && direction === 'above'\n\t\t\t) {\n\t\t\t\tif (containFocus) {\n\t\t\t\t\tcell = editor.cellAt(focus.start)!;\n\t\t\t\t}\n\n\t\t\t\tcells.push(...editor.getCellsInRange(selection));\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tconst singleRet = await joinNotebookCells(editor, selection, direction);\n\n\t\t\tif (!singleRet) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tedits.push(...singleRet.edits);\n\t\t\tcells.push(singleRet.cell);\n\n\t\t\tif (containFocus) {\n\t\t\t\tcell = singleRet.cell;\n\t\t\t}\n\t\t}\n\n\t\tif (!edits.length) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!cell || !cells.length) {\n\t\t\treturn;\n\t\t}\n\n\t\tawait bulkEditService.apply(\n\t\t\tedits,\n\t\t\t{ quotableLabel: 'Join Notebook Cells' }\n\t\t);\n\n\t\tcells.forEach(cell => {\n\t\t\tcell.updateEditState(CellEditState.Editing, 'joinCellsWithSurrounds');\n\t\t});\n\n\t\tviewModel.updateSelectionsState({ kind: SelectionStateType.Handle, primary: cell.handle, selections: cells.map(cell => cell.handle) });\n\t\teditor.revealCellRangeInView(editor.getFocus());\n\t\tconst newFocusedCell = editor.cellAt(editor.getFocus().start);\n\t\tif (focusMode === CellFocusMode.Editor && newFocusedCell) {\n\t\t\tnewFocusedCell.focusMode = CellFocusMode.Editor;\n\t\t}\n\t}\n}\n\nfunction _splitPointsToBoundaries(splitPoints: IPosition[], textBuffer: IReadonlyTextBuffer): IPosition[] | null {\n\tconst boundaries: IPosition[] = [];\n\tconst lineCnt = textBuffer.getLineCount();\n\tconst getLineLen = (lineNumber: number) => {\n\t\treturn textBuffer.getLineLength(lineNumber);\n\t};\n\n\t// split points need to be sorted\n\tsplitPoints = splitPoints.sort((l, r) => {\n\t\tconst lineDiff = l.lineNumber - r.lineNumber;\n\t\tconst columnDiff = l.column - r.column;\n\t\treturn lineDiff !== 0 ? lineDiff : columnDiff;\n\t});\n\n\tfor (let sp of splitPoints) {\n\t\tif (getLineLen(sp.lineNumber) + 1 === sp.column && sp.column !== 1 /** empty line */ && sp.lineNumber < lineCnt) {\n\t\t\tsp = new Position(sp.lineNumber + 1, 1);\n\t\t}\n\t\t_pushIfAbsent(boundaries, sp);\n\t}\n\n\tif (boundaries.length === 0) {\n\t\treturn null;\n\t}\n\n\t// boundaries already sorted and not empty\n\tconst modelStart = new Position(1, 1);\n\tconst modelEnd = new Position(lineCnt, getLineLen(lineCnt) + 1);\n\treturn [modelStart, ...boundaries, modelEnd];\n}\n\nfunction _pushIfAbsent(positions: IPosition[], p: IPosition) {\n\tconst last = positions.length > 0 ? positions[positions.length - 1] : undefined;\n\tif (!last || last.lineNumber !== p.lineNumber || last.column !== p.column) {\n\t\tpositions.push(p);\n\t}\n}\n\nexport function computeCellLinesContents(cell: ICellViewModel, splitPoints: IPosition[]): string[] | null {\n\tconst rangeBoundaries = _splitPointsToBoundaries(splitPoints, cell.textBuffer);\n\tif (!rangeBoundaries) {\n\t\treturn null;\n\t}\n\tconst newLineModels: string[] = [];\n\tfor (let i = 1; i < rangeBoundaries.length; i++) {\n\t\tconst start = rangeBoundaries[i - 1];\n\t\tconst end = rangeBoundaries[i];\n\n\t\tnewLineModels.push(cell.textBuffer.getValueInRange(new Range(start.lineNumber, start.column, end.lineNumber, end.column), EndOfLinePreference.TextDefined));\n\t}\n\n\treturn newLineModels;\n}\n\nexport function insertCell(\n\tlanguageService: ILanguageService,\n\teditor: IActiveNotebookEditor,\n\tindex: number,\n\ttype: CellKind,\n\tdirection: 'above' | 'below' = 'above',\n\tinitialText: string = '',\n\tui: boolean = false,\n\tkernelHistoryService?: INotebookKernelHistoryService\n) {\n\tconst viewModel = editor.getViewModel() as NotebookViewModel;\n\tconst activeKernel = editor.activeKernel;\n\tif (viewModel.options.isReadOnly) {\n\t\treturn null;\n\t}\n\n\tconst cell = editor.cellAt(index);\n\tconst nextIndex = ui ? viewModel.getNextVisibleCellIndex(index) : index + 1;\n\tlet language;\n\tif (type === CellKind.Code) {\n\t\tconst supportedLanguages = activeKernel?.supportedLanguages ?? languageService.getRegisteredLanguageIds();\n\t\tconst defaultLanguage = supportedLanguages[0] || PLAINTEXT_LANGUAGE_ID;\n\n\t\tif (cell?.cellKind === CellKind.Code) {\n\t\t\tlanguage = cell.language;\n\t\t} else if (cell?.cellKind === CellKind.Markup) {\n\t\t\tconst nearestCodeCellIndex = viewModel.nearestCodeCellIndex(index);\n\t\t\tif (nearestCodeCellIndex > -1) {\n\t\t\t\tlanguage = viewModel.cellAt(nearestCodeCellIndex)!.language;\n\t\t\t} else {\n\t\t\t\tlanguage = defaultLanguage;\n\t\t\t}\n\t\t} else if (!cell && viewModel.length === 0) {\n\t\t\t// No cells in notebook - check kernel history\n\t\t\tconst lastKernels = kernelHistoryService?.getKernels(viewModel.notebookDocument);\n\t\t\tif (lastKernels?.all.length) {\n\t\t\t\tconst lastKernel = lastKernels.all[0];\n\t\t\t\tlanguage = lastKernel.supportedLanguages[0] || defaultLanguage;\n\t\t\t} else {\n\t\t\t\tlanguage = defaultLanguage;\n\t\t\t}\n\t\t} else {\n\t\t\tif (cell === undefined && direction === 'above') {\n\t\t\t\t// insert cell at the very top\n\t\t\t\tlanguage = viewModel.viewCells.find(cell => cell.cellKind === CellKind.Code)?.language || defaultLanguage;\n\t\t\t} else {\n\t\t\t\tlanguage = defaultLanguage;\n\t\t\t}\n\t\t}\n\n\t\tif (!supportedLanguages.includes(language)) {\n\t\t\t// the language no longer exists\n\t\t\tlanguage = defaultLanguage;\n\t\t}\n\t} else {\n\t\tlanguage = 'markdown';\n\t}\n\n\tconst insertIndex = cell ?\n\t\t(direction === 'above' ? index : nextIndex) :\n\t\tindex;\n\treturn insertCellAtIndex(viewModel, insertIndex, initialText, language, type, undefined, [], true, true);\n}\n\nexport function insertCellAtIndex(viewModel: NotebookViewModel, index: number, source: string, language: string, type: CellKind, metadata: NotebookCellMetadata | undefined, outputs: IOutputDto[], synchronous: boolean, pushUndoStop: boolean): CellViewModel {\n\tconst endSelections: ISelectionState = { kind: SelectionStateType.Index, focus: { start: index, end: index + 1 }, selections: [{ start: index, end: index + 1 }] };\n\tviewModel.notebookDocument.applyEdits([\n\t\t{\n\t\t\teditType: CellEditType.Replace,\n\t\t\tindex,\n\t\t\tcount: 0,\n\t\t\tcells: [\n\t\t\t\t{\n\t\t\t\t\tcellKind: type,\n\t\t\t\t\tlanguage: language,\n\t\t\t\t\tmime: undefined,\n\t\t\t\t\toutputs: outputs,\n\t\t\t\t\tmetadata: metadata,\n\t\t\t\t\tsource: source\n\t\t\t\t}\n\t\t\t]\n\t\t}\n\t], synchronous, { kind: SelectionStateType.Index, focus: viewModel.getFocus(), selections: viewModel.getSelections() }, () => endSelections, undefined, pushUndoStop && !viewModel.options.isReadOnly);\n\treturn viewModel.cellAt(index)!;\n}\n"]}