{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/contrib/notebook/browser/view/cellParts/cellDragRenderer.ts","vs/workbench/contrib/notebook/browser/view/cellParts/cellDragRenderer.ts"],"names":[],"mappings":"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","file":"cellDragRenderer.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as DOM from '../../../../../../base/browser/dom.js';\nimport { createTrustedTypesPolicy } from '../../../../../../base/browser/trustedTypes.js';\nimport { Color } from '../../../../../../base/common/color.js';\nimport * as platform from '../../../../../../base/common/platform.js';\nimport { ICodeEditor } from '../../../../../../editor/browser/editorBrowser.js';\nimport { EditorOption } from '../../../../../../editor/common/config/editorOptions.js';\nimport { Range } from '../../../../../../editor/common/core/range.js';\nimport { ColorId } from '../../../../../../editor/common/encodedTokenAttributes.js';\nimport * as languages from '../../../../../../editor/common/languages.js';\nimport { tokenizeLineToHTML } from '../../../../../../editor/common/languages/textToHtmlTokenizer.js';\nimport { ITextModel } from '../../../../../../editor/common/model.js';\nimport { BaseCellRenderTemplate } from '../notebookRenderingCommon.js';\n\nclass EditorTextRenderer {\n\n\tprivate static _ttPolicy = createTrustedTypesPolicy('cellRendererEditorText', {\n\t\tcreateHTML(input) { return input; }\n\t});\n\n\tgetRichText(editor: ICodeEditor, modelRange: Range): HTMLElement | null {\n\t\tconst model = editor.getModel();\n\t\tif (!model) {\n\t\t\treturn null;\n\t\t}\n\n\t\tconst colorMap = this.getDefaultColorMap();\n\t\tconst fontInfo = editor.getOptions().get(EditorOption.fontInfo);\n\t\tconst fontFamilyVar = '--notebook-editor-font-family';\n\t\tconst fontSizeVar = '--notebook-editor-font-size';\n\t\tconst fontWeightVar = '--notebook-editor-font-weight';\n\n\t\tconst style = ``\n\t\t\t+ `color: ${colorMap[ColorId.DefaultForeground]};`\n\t\t\t+ `background-color: ${colorMap[ColorId.DefaultBackground]};`\n\t\t\t+ `font-family: var(${fontFamilyVar});`\n\t\t\t+ `font-weight: var(${fontWeightVar});`\n\t\t\t+ `font-size: var(${fontSizeVar});`\n\t\t\t+ `line-height: ${fontInfo.lineHeight}px;`\n\t\t\t+ `white-space: pre;`;\n\n\t\tconst element = DOM.$('div', { style });\n\n\t\tconst fontSize = fontInfo.fontSize;\n\t\tconst fontWeight = fontInfo.fontWeight;\n\t\telement.style.setProperty(fontFamilyVar, fontInfo.fontFamily);\n\t\telement.style.setProperty(fontSizeVar, `${fontSize}px`);\n\t\telement.style.setProperty(fontWeightVar, fontWeight);\n\n\t\tconst linesHtml = this.getRichTextLinesAsHtml(model, modelRange, colorMap);\n\t\telement.innerHTML = linesHtml as string;\n\t\treturn element;\n\t}\n\n\tprivate getRichTextLinesAsHtml(model: ITextModel, modelRange: Range, colorMap: string[]): string | TrustedHTML {\n\t\tconst startLineNumber = modelRange.startLineNumber;\n\t\tconst startColumn = modelRange.startColumn;\n\t\tconst endLineNumber = modelRange.endLineNumber;\n\t\tconst endColumn = modelRange.endColumn;\n\n\t\tconst tabSize = model.getOptions().tabSize;\n\n\t\tlet result = '';\n\n\t\tfor (let lineNumber = startLineNumber; lineNumber <= endLineNumber; lineNumber++) {\n\t\t\tconst lineTokens = model.tokenization.getLineTokens(lineNumber);\n\t\t\tconst lineContent = lineTokens.getLineContent();\n\t\t\tconst startOffset = (lineNumber === startLineNumber ? startColumn - 1 : 0);\n\t\t\tconst endOffset = (lineNumber === endLineNumber ? endColumn - 1 : lineContent.length);\n\n\t\t\tif (lineContent === '') {\n\t\t\t\tresult += '<br>';\n\t\t\t} else {\n\t\t\t\tresult += tokenizeLineToHTML(lineContent, lineTokens.inflate(), colorMap, startOffset, endOffset, tabSize, platform.isWindows);\n\t\t\t}\n\t\t}\n\n\t\treturn EditorTextRenderer._ttPolicy?.createHTML(result) ?? result;\n\t}\n\n\tprivate getDefaultColorMap(): string[] {\n\t\tconst colorMap = languages.TokenizationRegistry.getColorMap();\n\t\tconst result: string[] = ['#000000'];\n\t\tif (colorMap) {\n\t\t\tfor (let i = 1, len = colorMap.length; i < len; i++) {\n\t\t\t\tresult[i] = Color.Format.CSS.formatHex(colorMap[i]);\n\t\t\t}\n\t\t}\n\t\treturn result;\n\t}\n}\n\nexport class CodeCellDragImageRenderer {\n\tgetDragImage(templateData: BaseCellRenderTemplate, editor: ICodeEditor, type: 'code' | 'markdown'): HTMLElement {\n\t\tlet dragImage = this.getDragImageImpl(templateData, editor, type);\n\t\tif (!dragImage) {\n\t\t\t// TODO@roblourens I don't think this can happen\n\t\t\tdragImage = document.createElement('div');\n\t\t\tdragImage.textContent = '1 cell';\n\t\t}\n\n\t\treturn dragImage;\n\t}\n\n\tprivate getDragImageImpl(templateData: BaseCellRenderTemplate, editor: ICodeEditor, type: 'code' | 'markdown'): HTMLElement | null {\n\t\tconst dragImageContainer = templateData.container.cloneNode(true) as HTMLElement;\n\t\tdragImageContainer.classList.forEach(c => dragImageContainer.classList.remove(c));\n\t\tdragImageContainer.classList.add('cell-drag-image', 'monaco-list-row', 'focused', `${type}-cell-row`);\n\n\t\t// eslint-disable-next-line no-restricted-syntax\n\t\tconst editorContainer: HTMLElement | null = dragImageContainer.querySelector('.cell-editor-container');\n\t\tif (!editorContainer) {\n\t\t\treturn null;\n\t\t}\n\n\t\tconst richEditorText = new EditorTextRenderer().getRichText(editor, new Range(1, 1, 1, 1000));\n\t\tif (!richEditorText) {\n\t\t\treturn null;\n\t\t}\n\t\tDOM.reset(editorContainer, richEditorText);\n\n\t\treturn dragImageContainer;\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as DOM from '../../../../../../base/browser/dom.js';\nimport { createTrustedTypesPolicy } from '../../../../../../base/browser/trustedTypes.js';\nimport { Color } from '../../../../../../base/common/color.js';\nimport * as platform from '../../../../../../base/common/platform.js';\nimport { ICodeEditor } from '../../../../../../editor/browser/editorBrowser.js';\nimport { EditorOption } from '../../../../../../editor/common/config/editorOptions.js';\nimport { Range } from '../../../../../../editor/common/core/range.js';\nimport { ColorId } from '../../../../../../editor/common/encodedTokenAttributes.js';\nimport * as languages from '../../../../../../editor/common/languages.js';\nimport { tokenizeLineToHTML } from '../../../../../../editor/common/languages/textToHtmlTokenizer.js';\nimport { ITextModel } from '../../../../../../editor/common/model.js';\nimport { BaseCellRenderTemplate } from '../notebookRenderingCommon.js';\n\nclass EditorTextRenderer {\n\n\tprivate static _ttPolicy = createTrustedTypesPolicy('cellRendererEditorText', {\n\t\tcreateHTML(input) { return input; }\n\t});\n\n\tgetRichText(editor: ICodeEditor, modelRange: Range): HTMLElement | null {\n\t\tconst model = editor.getModel();\n\t\tif (!model) {\n\t\t\treturn null;\n\t\t}\n\n\t\tconst colorMap = this.getDefaultColorMap();\n\t\tconst fontInfo = editor.getOptions().get(EditorOption.fontInfo);\n\t\tconst fontFamilyVar = '--notebook-editor-font-family';\n\t\tconst fontSizeVar = '--notebook-editor-font-size';\n\t\tconst fontWeightVar = '--notebook-editor-font-weight';\n\n\t\tconst style = ``\n\t\t\t+ `color: ${colorMap[ColorId.DefaultForeground]};`\n\t\t\t+ `background-color: ${colorMap[ColorId.DefaultBackground]};`\n\t\t\t+ `font-family: var(${fontFamilyVar});`\n\t\t\t+ `font-weight: var(${fontWeightVar});`\n\t\t\t+ `font-size: var(${fontSizeVar});`\n\t\t\t+ `line-height: ${fontInfo.lineHeight}px;`\n\t\t\t+ `white-space: pre;`;\n\n\t\tconst element = DOM.$('div', { style });\n\n\t\tconst fontSize = fontInfo.fontSize;\n\t\tconst fontWeight = fontInfo.fontWeight;\n\t\telement.style.setProperty(fontFamilyVar, fontInfo.fontFamily);\n\t\telement.style.setProperty(fontSizeVar, `${fontSize}px`);\n\t\telement.style.setProperty(fontWeightVar, fontWeight);\n\n\t\tconst linesHtml = this.getRichTextLinesAsHtml(model, modelRange, colorMap);\n\t\telement.innerHTML = linesHtml as string;\n\t\treturn element;\n\t}\n\n\tprivate getRichTextLinesAsHtml(model: ITextModel, modelRange: Range, colorMap: string[]): string | TrustedHTML {\n\t\tconst startLineNumber = modelRange.startLineNumber;\n\t\tconst startColumn = modelRange.startColumn;\n\t\tconst endLineNumber = modelRange.endLineNumber;\n\t\tconst endColumn = modelRange.endColumn;\n\n\t\tconst tabSize = model.getOptions().tabSize;\n\n\t\tlet result = '';\n\n\t\tfor (let lineNumber = startLineNumber; lineNumber <= endLineNumber; lineNumber++) {\n\t\t\tconst lineTokens = model.tokenization.getLineTokens(lineNumber);\n\t\t\tconst lineContent = lineTokens.getLineContent();\n\t\t\tconst startOffset = (lineNumber === startLineNumber ? startColumn - 1 : 0);\n\t\t\tconst endOffset = (lineNumber === endLineNumber ? endColumn - 1 : lineContent.length);\n\n\t\t\tif (lineContent === '') {\n\t\t\t\tresult += '<br>';\n\t\t\t} else {\n\t\t\t\tresult += tokenizeLineToHTML(lineContent, lineTokens.inflate(), colorMap, startOffset, endOffset, tabSize, platform.isWindows);\n\t\t\t}\n\t\t}\n\n\t\treturn EditorTextRenderer._ttPolicy?.createHTML(result) ?? result;\n\t}\n\n\tprivate getDefaultColorMap(): string[] {\n\t\tconst colorMap = languages.TokenizationRegistry.getColorMap();\n\t\tconst result: string[] = ['#000000'];\n\t\tif (colorMap) {\n\t\t\tfor (let i = 1, len = colorMap.length; i < len; i++) {\n\t\t\t\tresult[i] = Color.Format.CSS.formatHex(colorMap[i]);\n\t\t\t}\n\t\t}\n\t\treturn result;\n\t}\n}\n\nexport class CodeCellDragImageRenderer {\n\tgetDragImage(templateData: BaseCellRenderTemplate, editor: ICodeEditor, type: 'code' | 'markdown'): HTMLElement {\n\t\tlet dragImage = this.getDragImageImpl(templateData, editor, type);\n\t\tif (!dragImage) {\n\t\t\t// TODO@roblourens I don't think this can happen\n\t\t\tdragImage = document.createElement('div');\n\t\t\tdragImage.textContent = '1 cell';\n\t\t}\n\n\t\treturn dragImage;\n\t}\n\n\tprivate getDragImageImpl(templateData: BaseCellRenderTemplate, editor: ICodeEditor, type: 'code' | 'markdown'): HTMLElement | null {\n\t\tconst dragImageContainer = templateData.container.cloneNode(true) as HTMLElement;\n\t\tdragImageContainer.classList.forEach(c => dragImageContainer.classList.remove(c));\n\t\tdragImageContainer.classList.add('cell-drag-image', 'monaco-list-row', 'focused', `${type}-cell-row`);\n\n\t\t// eslint-disable-next-line no-restricted-syntax\n\t\tconst editorContainer: HTMLElement | null = dragImageContainer.querySelector('.cell-editor-container');\n\t\tif (!editorContainer) {\n\t\t\treturn null;\n\t\t}\n\n\t\tconst richEditorText = new EditorTextRenderer().getRichText(editor, new Range(1, 1, 1, 1000));\n\t\tif (!richEditorText) {\n\t\t\treturn null;\n\t\t}\n\t\tDOM.reset(editorContainer, richEditorText);\n\n\t\treturn dragImageContainer;\n\t}\n}\n"]}