{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/contrib/notebook/browser/viewModel/cellOutputTextHelper.ts","vs/workbench/contrib/notebook/browser/viewModel/cellOutputTextHelper.ts"],"names":[],"mappings":"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","file":"cellOutputTextHelper.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { IClipboardService } from '../../../../../platform/clipboard/common/clipboardService.js';\nimport { ILogService } from '../../../../../platform/log/common/log.js';\nimport { NotebookTextModel } from '../../common/model/notebookTextModel.js';\nimport { IOutputItemDto } from '../../common/notebookCommon.js';\nimport { isTextStreamMime } from '../../../../../base/common/mime.js';\nimport { ICellOutputViewModel, ICellViewModel } from '../notebookBrowser.js';\n\ninterface Error {\n\tname: string;\n\tmessage: string;\n\tstack?: string;\n}\n\nexport function getAllOutputsText(notebook: NotebookTextModel, viewCell: ICellViewModel, shortErrors: boolean = false): string {\n\tconst outputText: string[] = [];\n\tfor (let i = 0; i < viewCell.outputsViewModels.length; i++) {\n\t\tconst outputViewModel = viewCell.outputsViewModels[i];\n\t\tconst outputTextModel = viewCell.model.outputs[i];\n\t\tconst [mimeTypes, pick] = outputViewModel.resolveMimeTypes(notebook, undefined);\n\t\tconst mimeType = mimeTypes[pick].mimeType;\n\t\tlet buffer = outputTextModel.outputs.find(output => output.mime === mimeType);\n\n\t\tif (!buffer || mimeType.startsWith('image')) {\n\t\t\tbuffer = outputTextModel.outputs.find(output => !output.mime.startsWith('image'));\n\t\t}\n\n\t\tif (!buffer) {\n\t\t\tcontinue;\n\t\t}\n\n\t\tlet text = '';\n\t\tif (isTextStreamMime(mimeType)) {\n\t\t\tconst { text: stream, count } = getOutputStreamText(outputViewModel);\n\t\t\ttext = stream;\n\t\t\tif (count > 1) {\n\t\t\t\ti += count - 1;\n\t\t\t}\n\t\t} else {\n\t\t\ttext = getOutputText(mimeType, buffer, shortErrors);\n\t\t}\n\n\t\toutputText.push(text);\n\t}\n\n\tlet outputContent: string;\n\tif (outputText.length > 1) {\n\t\toutputContent = outputText.map((output, i) => {\n\t\t\treturn `Cell output ${i + 1} of ${outputText.length}\\n${output}`;\n\t\t}).join('\\n');\n\t} else {\n\t\toutputContent = outputText[0] ?? '';\n\t}\n\n\treturn outputContent;\n}\n\nexport function getOutputStreamText(output: ICellOutputViewModel): { text: string; count: number } {\n\tlet text = '';\n\tconst cellViewModel = output.cellViewModel as ICellViewModel;\n\tlet index = cellViewModel.outputsViewModels.indexOf(output);\n\tlet count = 0;\n\twhile (index < cellViewModel.model.outputs.length) {\n\t\tconst nextCellOutput = cellViewModel.model.outputs[index];\n\t\tconst nextOutput = nextCellOutput.outputs.find(output => isTextStreamMime(output.mime));\n\t\tif (!nextOutput) {\n\t\t\tbreak;\n\t\t}\n\n\t\ttext = text + decoder.decode(nextOutput.data.buffer);\n\t\tindex = index + 1;\n\t\tcount++;\n\t}\n\n\treturn { text: text.trim(), count };\n}\n\nconst decoder = new TextDecoder();\n\nexport function getOutputText(mimeType: string, buffer: IOutputItemDto, shortError: boolean = false): string {\n\tlet text = `${mimeType}`; // default in case we can't get the text value for some reason.\n\n\tconst charLimit = 100000;\n\ttext = decoder.decode(buffer.data.slice(0, charLimit).buffer);\n\n\tif (buffer.data.byteLength > charLimit) {\n\t\ttext = text + '...(truncated)';\n\t} else if (mimeType === 'application/vnd.code.notebook.error') {\n\t\ttext = text.replace(/\\\\u001b\\[[0-9;]*m/gi, '');\n\t\ttry {\n\t\t\tconst error = JSON.parse(text) as Error;\n\t\t\tif (!error.stack || shortError) {\n\t\t\t\ttext = `${error.name}: ${error.message}`;\n\t\t\t} else {\n\t\t\t\ttext = error.stack;\n\t\t\t}\n\t\t} catch {\n\t\t\t// just use raw text\n\t\t}\n\t}\n\n\treturn text.trim();\n}\n\nexport async function copyCellOutput(mimeType: string | undefined, outputViewModel: ICellOutputViewModel, clipboardService: IClipboardService, logService: ILogService) {\n\tconst cellOutput = outputViewModel.model;\n\tconst output = mimeType && TEXT_BASED_MIMETYPES.includes(mimeType) ?\n\t\tcellOutput.outputs.find(output => output.mime === mimeType) :\n\t\tcellOutput.outputs.find(output => TEXT_BASED_MIMETYPES.includes(output.mime));\n\n\tmimeType = output?.mime;\n\n\tif (!mimeType || !output) {\n\t\treturn;\n\t}\n\n\tconst text = isTextStreamMime(mimeType) ? getOutputStreamText(outputViewModel).text : getOutputText(mimeType, output);\n\n\ttry {\n\t\tawait clipboardService.writeText(text);\n\n\t} catch (e) {\n\t\tlogService.error(`Failed to copy content: ${e}`);\n\t}\n}\n\nexport const TEXT_BASED_MIMETYPES = [\n\t'text/latex',\n\t'text/html',\n\t'application/vnd.code.notebook.error',\n\t'application/vnd.code.notebook.stdout',\n\t'application/x.notebook.stdout',\n\t'application/x.notebook.stream',\n\t'application/vnd.code.notebook.stderr',\n\t'application/x.notebook.stderr',\n\t'text/plain',\n\t'text/markdown',\n\t'application/json'\n];\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { IClipboardService } from '../../../../../platform/clipboard/common/clipboardService.js';\nimport { ILogService } from '../../../../../platform/log/common/log.js';\nimport { NotebookTextModel } from '../../common/model/notebookTextModel.js';\nimport { IOutputItemDto } from '../../common/notebookCommon.js';\nimport { isTextStreamMime } from '../../../../../base/common/mime.js';\nimport { ICellOutputViewModel, ICellViewModel } from '../notebookBrowser.js';\n\ninterface Error {\n\tname: string;\n\tmessage: string;\n\tstack?: string;\n}\n\nexport function getAllOutputsText(notebook: NotebookTextModel, viewCell: ICellViewModel, shortErrors: boolean = false): string {\n\tconst outputText: string[] = [];\n\tfor (let i = 0; i < viewCell.outputsViewModels.length; i++) {\n\t\tconst outputViewModel = viewCell.outputsViewModels[i];\n\t\tconst outputTextModel = viewCell.model.outputs[i];\n\t\tconst [mimeTypes, pick] = outputViewModel.resolveMimeTypes(notebook, undefined);\n\t\tconst mimeType = mimeTypes[pick].mimeType;\n\t\tlet buffer = outputTextModel.outputs.find(output => output.mime === mimeType);\n\n\t\tif (!buffer || mimeType.startsWith('image')) {\n\t\t\tbuffer = outputTextModel.outputs.find(output => !output.mime.startsWith('image'));\n\t\t}\n\n\t\tif (!buffer) {\n\t\t\tcontinue;\n\t\t}\n\n\t\tlet text = '';\n\t\tif (isTextStreamMime(mimeType)) {\n\t\t\tconst { text: stream, count } = getOutputStreamText(outputViewModel);\n\t\t\ttext = stream;\n\t\t\tif (count > 1) {\n\t\t\t\ti += count - 1;\n\t\t\t}\n\t\t} else {\n\t\t\ttext = getOutputText(mimeType, buffer, shortErrors);\n\t\t}\n\n\t\toutputText.push(text);\n\t}\n\n\tlet outputContent: string;\n\tif (outputText.length > 1) {\n\t\toutputContent = outputText.map((output, i) => {\n\t\t\treturn `Cell output ${i + 1} of ${outputText.length}\\n${output}`;\n\t\t}).join('\\n');\n\t} else {\n\t\toutputContent = outputText[0] ?? '';\n\t}\n\n\treturn outputContent;\n}\n\nexport function getOutputStreamText(output: ICellOutputViewModel): { text: string; count: number } {\n\tlet text = '';\n\tconst cellViewModel = output.cellViewModel as ICellViewModel;\n\tlet index = cellViewModel.outputsViewModels.indexOf(output);\n\tlet count = 0;\n\twhile (index < cellViewModel.model.outputs.length) {\n\t\tconst nextCellOutput = cellViewModel.model.outputs[index];\n\t\tconst nextOutput = nextCellOutput.outputs.find(output => isTextStreamMime(output.mime));\n\t\tif (!nextOutput) {\n\t\t\tbreak;\n\t\t}\n\n\t\ttext = text + decoder.decode(nextOutput.data.buffer);\n\t\tindex = index + 1;\n\t\tcount++;\n\t}\n\n\treturn { text: text.trim(), count };\n}\n\nconst decoder = new TextDecoder();\n\nexport function getOutputText(mimeType: string, buffer: IOutputItemDto, shortError: boolean = false): string {\n\tlet text = `${mimeType}`; // default in case we can't get the text value for some reason.\n\n\tconst charLimit = 100000;\n\ttext = decoder.decode(buffer.data.slice(0, charLimit).buffer);\n\n\tif (buffer.data.byteLength > charLimit) {\n\t\ttext = text + '...(truncated)';\n\t} else if (mimeType === 'application/vnd.code.notebook.error') {\n\t\ttext = text.replace(/\\\\u001b\\[[0-9;]*m/gi, '');\n\t\ttry {\n\t\t\tconst error = JSON.parse(text) as Error;\n\t\t\tif (!error.stack || shortError) {\n\t\t\t\ttext = `${error.name}: ${error.message}`;\n\t\t\t} else {\n\t\t\t\ttext = error.stack;\n\t\t\t}\n\t\t} catch {\n\t\t\t// just use raw text\n\t\t}\n\t}\n\n\treturn text.trim();\n}\n\nexport async function copyCellOutput(mimeType: string | undefined, outputViewModel: ICellOutputViewModel, clipboardService: IClipboardService, logService: ILogService) {\n\tconst cellOutput = outputViewModel.model;\n\tconst output = mimeType && TEXT_BASED_MIMETYPES.includes(mimeType) ?\n\t\tcellOutput.outputs.find(output => output.mime === mimeType) :\n\t\tcellOutput.outputs.find(output => TEXT_BASED_MIMETYPES.includes(output.mime));\n\n\tmimeType = output?.mime;\n\n\tif (!mimeType || !output) {\n\t\treturn;\n\t}\n\n\tconst text = isTextStreamMime(mimeType) ? getOutputStreamText(outputViewModel).text : getOutputText(mimeType, output);\n\n\ttry {\n\t\tawait clipboardService.writeText(text);\n\n\t} catch (e) {\n\t\tlogService.error(`Failed to copy content: ${e}`);\n\t}\n}\n\nexport const TEXT_BASED_MIMETYPES = [\n\t'text/latex',\n\t'text/html',\n\t'application/vnd.code.notebook.error',\n\t'application/vnd.code.notebook.stdout',\n\t'application/x.notebook.stdout',\n\t'application/x.notebook.stream',\n\t'application/vnd.code.notebook.stderr',\n\t'application/x.notebook.stderr',\n\t'text/plain',\n\t'text/markdown',\n\t'application/json'\n];\n"]}