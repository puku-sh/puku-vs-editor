{"version":3,"sources":["vs/workbench/contrib/notebook/browser/contrib/multicursor/notebookMulticursor.ts"],"names":[],"mappings":"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","file":"notebookMulticursor.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { localize } from '../../../../../../nls.js';\nimport { Emitter, Event } from '../../../../../../base/common/event.js';\nimport { KeyCode, KeyMod } from '../../../../../../base/common/keyCodes.js';\nimport { Disposable, DisposableStore } from '../../../../../../base/common/lifecycle.js';\nimport { ResourceMap } from '../../../../../../base/common/map.js';\nimport { URI } from '../../../../../../base/common/uri.js';\nimport { EditorConfiguration } from '../../../../../../editor/browser/config/editorConfiguration.js';\nimport { CoreEditingCommands } from '../../../../../../editor/browser/coreCommands.js';\nimport { ICodeEditor, PastePayload } from '../../../../../../editor/browser/editorBrowser.js';\nimport { RedoCommand, UndoCommand } from '../../../../../../editor/browser/editorExtensions.js';\nimport { CodeEditorWidget } from '../../../../../../editor/browser/widget/codeEditor/codeEditorWidget.js';\nimport { IEditorConfiguration } from '../../../../../../editor/common/config/editorConfiguration.js';\nimport { cursorBlinkingStyleFromString, cursorStyleFromString, TextEditorCursorBlinkingStyle, TextEditorCursorStyle } from '../../../../../../editor/common/config/editorOptions.js';\nimport { Position } from '../../../../../../editor/common/core/position.js';\nimport { Range } from '../../../../../../editor/common/core/range.js';\nimport { Selection, SelectionDirection } from '../../../../../../editor/common/core/selection.js';\nimport { IWordAtPosition, USUAL_WORD_SEPARATORS } from '../../../../../../editor/common/core/wordHelper.js';\nimport { CommandExecutor, CursorsController } from '../../../../../../editor/common/cursor/cursor.js';\nimport { DeleteOperations } from '../../../../../../editor/common/cursor/cursorDeleteOperations.js';\nimport { CursorConfiguration, ICursorSimpleModel } from '../../../../../../editor/common/cursorCommon.js';\nimport { CursorChangeReason } from '../../../../../../editor/common/cursorEvents.js';\nimport { CompositionTypePayload, Handler, ITriggerEditorOperationEvent, ReplacePreviousCharPayload } from '../../../../../../editor/common/editorCommon.js';\nimport { ILanguageConfigurationService } from '../../../../../../editor/common/languages/languageConfigurationRegistry.js';\nimport { IModelDeltaDecoration, ITextModel, PositionAffinity } from '../../../../../../editor/common/model.js';\nimport { indentOfLine } from '../../../../../../editor/common/model/textModel.js';\nimport { ITextModelService } from '../../../../../../editor/common/services/resolverService.js';\nimport { ViewModelEventsCollector } from '../../../../../../editor/common/viewModelEventDispatcher.js';\nimport { IAccessibilityService } from '../../../../../../platform/accessibility/common/accessibility.js';\nimport { MenuId, registerAction2 } from '../../../../../../platform/actions/common/actions.js';\nimport { IConfigurationService } from '../../../../../../platform/configuration/common/configuration.js';\nimport { ContextKeyExpr, IContextKeyService, RawContextKey } from '../../../../../../platform/contextkey/common/contextkey.js';\nimport { ServicesAccessor } from '../../../../../../platform/instantiation/common/instantiation.js';\nimport { KeybindingWeight } from '../../../../../../platform/keybinding/common/keybindingsRegistry.js';\nimport { IPastFutureElements, IUndoRedoElement, IUndoRedoService, UndoRedoElementType } from '../../../../../../platform/undoRedo/common/undoRedo.js';\nimport { registerWorkbenchContribution2, WorkbenchPhase } from '../../../../../common/contributions.js';\nimport { IEditorService } from '../../../../../services/editor/common/editorService.js';\nimport { KEYBINDING_CONTEXT_NOTEBOOK_FIND_WIDGET_FOCUSED, NOTEBOOK_CELL_EDITOR_FOCUSED, NOTEBOOK_IS_ACTIVE_EDITOR } from '../../../common/notebookContextKeys.js';\nimport { INotebookActionContext, NotebookAction } from '../../controller/coreActions.js';\nimport { CellFindMatchWithIndex, getNotebookEditorFromEditorPane, ICellViewModel, INotebookEditor, INotebookEditorContribution } from '../../notebookBrowser.js';\nimport { registerNotebookContribution } from '../../notebookEditorExtensions.js';\nimport { CellEditorOptions } from '../../view/cellParts/cellEditorOptions.js';\nimport { NotebookFindContrib } from '../find/notebookFindWidget.js';\nimport { NotebookTextModel } from '../../../common/model/notebookTextModel.js';\nimport { NotebookCellTextModel } from '../../../common/model/notebookCellTextModel.js';\nimport { ICoordinatesConverter } from '../../../../../../editor/common/coordinatesConverter.js';\n\nconst NOTEBOOK_ADD_FIND_MATCH_TO_SELECTION_ID = 'notebook.addFindMatchToSelection';\nconst NOTEBOOK_SELECT_ALL_FIND_MATCHES_ID = 'notebook.selectAllFindMatches';\n\nexport enum NotebookMultiCursorState {\n\tIdle,\n\tSelecting,\n\tEditing,\n}\n\ninterface NotebookCursorConfig {\n\tcursorStyle: TextEditorCursorStyle;\n\tcursorBlinking: TextEditorCursorBlinkingStyle;\n\tcursorSmoothCaretAnimation: 'off' | 'explicit' | 'on';\n}\n\ninterface SelectionTranslation {\n\tdeltaStartCol: number;\n\tdeltaStartLine: number;\n\tdeltaEndCol: number;\n\tdeltaEndLine: number;\n}\n\ninterface TrackedCell {\n\tcellViewModel: ICellViewModel;\n\tinitialSelection: Selection;\n\tmatchSelections: Selection[];\n\teditorConfig: IEditorConfiguration;\n\tcursorConfig: NotebookCursorConfig;\n\tdecorationIds: string[];\n\tundoRedoHistory: IPastFutureElements;\n}\n\nexport const NOTEBOOK_MULTI_CURSOR_CONTEXT = {\n\tIsNotebookMultiCursor: new RawContextKey<boolean>('isNotebookMultiSelect', false),\n\tNotebookMultiSelectCursorState: new RawContextKey<NotebookMultiCursorState>('notebookMultiSelectCursorState', NotebookMultiCursorState.Idle),\n};\n\nexport class NotebookMultiCursorController extends Disposable implements INotebookEditorContribution {\n\n\tstatic readonly id: string = 'notebook.multiCursorController';\n\n\tprivate word: string;\n\tprivate startPosition: {\n\t\tcellIndex: number;\n\t\tposition: Position;\n\t} | undefined;\n\tprivate trackedCells: TrackedCell[];\n\tprivate totalMatchesCount: number;\n\n\tprivate readonly _onDidChangeAnchorCell;\n\treadonly onDidChangeAnchorCell: Event<void>;\n\tprivate anchorCell: [ICellViewModel, ICodeEditor] | undefined;\n\n\tprivate readonly anchorDisposables;\n\tprivate readonly cursorsDisposables;\n\tprivate cursorsControllers: ResourceMap<CursorsController>;\n\n\tprivate state: NotebookMultiCursorState;\n\tpublic getState(): NotebookMultiCursorState {\n\t\treturn this.state;\n\t}\n\n\tprivate _nbIsMultiSelectSession;\n\tprivate _nbMultiSelectState;\n\n\tconstructor(\n\t\tprivate readonly notebookEditor: INotebookEditor,\n\t\t@IContextKeyService private readonly contextKeyService: IContextKeyService,\n\t\t@ITextModelService private readonly textModelService: ITextModelService,\n\t\t@ILanguageConfigurationService private readonly languageConfigurationService: ILanguageConfigurationService,\n\t\t@IAccessibilityService private readonly accessibilityService: IAccessibilityService,\n\t\t@IConfigurationService private readonly configurationService: IConfigurationService,\n\t\t@IUndoRedoService private readonly undoRedoService: IUndoRedoService,\n\t) {\n\t\tsuper();\n\t\tthis.word = '';\n\t\tthis.trackedCells = [];\n\t\tthis.totalMatchesCount = 0;\n\t\tthis._onDidChangeAnchorCell = this._register(new Emitter<void>());\n\t\tthis.onDidChangeAnchorCell = this._onDidChangeAnchorCell.event;\n\t\tthis.anchorDisposables = this._register(new DisposableStore());\n\t\tthis.cursorsDisposables = this._register(new DisposableStore());\n\t\tthis.cursorsControllers = new ResourceMap<CursorsController>();\n\t\tthis.state = NotebookMultiCursorState.Idle;\n\t\tthis._nbIsMultiSelectSession = NOTEBOOK_MULTI_CURSOR_CONTEXT.IsNotebookMultiCursor.bindTo(this.contextKeyService);\n\t\tthis._nbMultiSelectState = NOTEBOOK_MULTI_CURSOR_CONTEXT.NotebookMultiSelectCursorState.bindTo(this.contextKeyService);\n\n\t\tthis.anchorCell = this.notebookEditor.activeCellAndCodeEditor;\n\n\t\t// anchor cell will catch and relay all type, cut, paste events to the cursors controllers\n\t\t// need to create new controllers when the anchor cell changes, then update their listeners\n\t\t// ** cursor controllers need to happen first, because anchor listeners relay to them\n\t\tthis._register(this.onDidChangeAnchorCell(async () => {\n\t\t\tawait this.syncCursorsControllers();\n\t\t\tthis.syncAnchorListeners();\n\t\t}));\n\t}\n\n\tprivate syncAnchorListeners() {\n\t\tthis.anchorDisposables.clear();\n\n\t\tif (!this.anchorCell) {\n\t\t\tthrow new Error('Anchor cell is undefined');\n\t\t}\n\n\t\t// typing\n\t\tthis.anchorDisposables.add(this.anchorCell[1].onWillType((input) => {\n\t\t\tconst collector = new ViewModelEventsCollector();\n\t\t\tthis.trackedCells.forEach(cell => {\n\t\t\t\tconst controller = this.cursorsControllers.get(cell.cellViewModel.uri);\n\t\t\t\tif (!controller) {\n\t\t\t\t\t// should not happen\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tif (cell.cellViewModel.handle !== this.anchorCell?.[0].handle) { // don't relay to active cell, already has a controller for typing\n\t\t\t\t\tcontroller.type(collector, input, 'keyboard');\n\t\t\t\t}\n\t\t\t});\n\t\t}));\n\n\t\tthis.anchorDisposables.add(this.anchorCell[1].onDidType(() => {\n\t\t\tthis.state = NotebookMultiCursorState.Editing; // typing will continue to work as normal across ranges, just preps for another cmd+d\n\t\t\tthis._nbMultiSelectState.set(NotebookMultiCursorState.Editing);\n\n\t\t\tconst anchorController = this.cursorsControllers.get(this.anchorCell![0].uri);\n\t\t\tif (!anchorController) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst activeSelections = this.notebookEditor.activeCodeEditor?.getSelections();\n\t\t\tif (!activeSelections) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// need to keep anchor cursor controller in sync manually (for delete usage), since we don't relay type event to it\n\t\t\tanchorController.setSelections(new ViewModelEventsCollector(), 'keyboard', activeSelections, CursorChangeReason.Explicit);\n\n\t\t\tthis.trackedCells.forEach(cell => {\n\t\t\t\tconst controller = this.cursorsControllers.get(cell.cellViewModel.uri);\n\t\t\t\tif (!controller) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t// this is used upon exiting the multicursor session to set the selections back to the correct cursor state\n\t\t\t\tcell.initialSelection = controller.getSelection();\n\t\t\t\t// clear tracked selection data as it is invalid once typing begins\n\t\t\t\tcell.matchSelections = [];\n\t\t\t});\n\n\t\t\tthis.updateLazyDecorations();\n\t\t}));\n\n\t\t// arrow key navigation\n\t\tthis.anchorDisposables.add(this.anchorCell[1].onDidChangeCursorSelection((e) => {\n\t\t\tif (e.source === 'mouse') {\n\t\t\t\tthis.resetToIdleState();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// ignore this event if it was caused by a typing event or a delete (NotSet and RecoverFromMarkers respectively)\n\t\t\tif (!e.oldSelections || e.reason === CursorChangeReason.NotSet || e.reason === CursorChangeReason.RecoverFromMarkers) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst translation: SelectionTranslation = {\n\t\t\t\tdeltaStartCol: e.selection.startColumn - e.oldSelections[0].startColumn,\n\t\t\t\tdeltaStartLine: e.selection.startLineNumber - e.oldSelections[0].startLineNumber,\n\t\t\t\tdeltaEndCol: e.selection.endColumn - e.oldSelections[0].endColumn,\n\t\t\t\tdeltaEndLine: e.selection.endLineNumber - e.oldSelections[0].endLineNumber,\n\t\t\t};\n\t\t\tconst translationDir = e.selection.getDirection();\n\n\t\t\tthis.trackedCells.forEach(cell => {\n\t\t\t\tconst controller = this.cursorsControllers.get(cell.cellViewModel.uri);\n\t\t\t\tif (!controller) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst newSelections = controller.getSelections().map(selection => {\n\t\t\t\t\tconst newStartCol = selection.startColumn + translation.deltaStartCol;\n\t\t\t\t\tconst newStartLine = selection.startLineNumber + translation.deltaStartLine;\n\t\t\t\t\tconst newEndCol = selection.endColumn + translation.deltaEndCol;\n\t\t\t\t\tconst newEndLine = selection.endLineNumber + translation.deltaEndLine;\n\t\t\t\t\treturn Selection.createWithDirection(newStartLine, newStartCol, newEndLine, newEndCol, translationDir);\n\t\t\t\t});\n\n\t\t\t\tcontroller.setSelections(new ViewModelEventsCollector(), e.source, newSelections, CursorChangeReason.Explicit);\n\t\t\t});\n\n\t\t\tthis.updateLazyDecorations();\n\t\t}));\n\n\t\t// core actions\n\t\tthis.anchorDisposables.add(this.anchorCell[1].onWillTriggerEditorOperationEvent((e) => {\n\t\t\tthis.handleEditorOperationEvent(e);\n\t\t}));\n\n\t\t// exit mode\n\t\tthis.anchorDisposables.add(this.anchorCell[1].onDidBlurEditorWidget(() => {\n\t\t\tif (this.state === NotebookMultiCursorState.Selecting || this.state === NotebookMultiCursorState.Editing) {\n\t\t\t\tthis.resetToIdleState();\n\t\t\t}\n\t\t}));\n\t}\n\n\tprivate async syncCursorsControllers() {\n\t\tthis.cursorsDisposables.clear(); // TODO: dial this back for perf and just update the relevant controllers\n\t\tawait Promise.all(this.trackedCells.map(async cell => {\n\t\t\tconst controller = await this.createCursorController(cell);\n\t\t\tif (!controller) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis.cursorsControllers.set(cell.cellViewModel.uri, controller);\n\n\t\t\tconst selections = cell.matchSelections;\n\t\t\tcontroller.setSelections(new ViewModelEventsCollector(), undefined, selections, CursorChangeReason.Explicit);\n\t\t}));\n\n\t\tthis.updateLazyDecorations();\n\t}\n\n\tprivate async createCursorController(cell: TrackedCell): Promise<CursorsController | undefined> {\n\t\tconst textModelRef = await this.textModelService.createModelReference(cell.cellViewModel.uri);\n\t\tconst textModel = textModelRef.object.textEditorModel;\n\t\tif (!textModel) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\tconst cursorSimpleModel = this.constructCursorSimpleModel(cell.cellViewModel);\n\t\tconst converter = this.constructCoordinatesConverter();\n\t\tconst editorConfig = cell.editorConfig;\n\n\t\tconst controller = this.cursorsDisposables.add(new CursorsController(\n\t\t\ttextModel,\n\t\t\tcursorSimpleModel,\n\t\t\tconverter,\n\t\t\tnew CursorConfiguration(textModel.getLanguageId(), textModel.getOptions(), editorConfig, this.languageConfigurationService)\n\t\t));\n\n\t\tcontroller.setSelections(new ViewModelEventsCollector(), undefined, cell.matchSelections, CursorChangeReason.Explicit);\n\t\treturn controller;\n\t}\n\n\tprivate constructCoordinatesConverter(): ICoordinatesConverter {\n\t\treturn {\n\t\t\tconvertViewPositionToModelPosition(viewPosition: Position): Position {\n\t\t\t\treturn viewPosition;\n\t\t\t},\n\t\t\tconvertViewRangeToModelRange(viewRange: Range): Range {\n\t\t\t\treturn viewRange;\n\t\t\t},\n\t\t\tvalidateViewPosition(viewPosition: Position, expectedModelPosition: Position): Position {\n\t\t\t\treturn viewPosition;\n\t\t\t},\n\t\t\tvalidateViewRange(viewRange: Range, expectedModelRange: Range): Range {\n\t\t\t\treturn viewRange;\n\t\t\t},\n\t\t\tconvertModelPositionToViewPosition(modelPosition: Position, affinity?: PositionAffinity, allowZeroLineNumber?: boolean, belowHiddenRanges?: boolean): Position {\n\t\t\t\treturn modelPosition;\n\t\t\t},\n\t\t\tconvertModelRangeToViewRange(modelRange: Range, affinity?: PositionAffinity): Range {\n\t\t\t\treturn modelRange;\n\t\t\t},\n\t\t\tmodelPositionIsVisible(modelPosition: Position): boolean {\n\t\t\t\treturn true;\n\t\t\t},\n\t\t\tgetModelLineViewLineCount(modelLineNumber: number): number {\n\t\t\t\treturn 1;\n\t\t\t},\n\t\t\tgetViewLineNumberOfModelPosition(modelLineNumber: number, modelColumn: number): number {\n\t\t\t\treturn modelLineNumber;\n\t\t\t}\n\t\t};\n\t}\n\n\tprivate constructCursorSimpleModel(cell: ICellViewModel): ICursorSimpleModel {\n\t\treturn {\n\t\t\tgetLineCount(): number {\n\t\t\t\treturn cell.textBuffer.getLineCount();\n\t\t\t},\n\t\t\tgetLineContent(lineNumber: number): string {\n\t\t\t\treturn cell.textBuffer.getLineContent(lineNumber);\n\t\t\t},\n\t\t\tgetLineMinColumn(lineNumber: number): number {\n\t\t\t\treturn cell.textBuffer.getLineMinColumn(lineNumber);\n\t\t\t},\n\t\t\tgetLineMaxColumn(lineNumber: number): number {\n\t\t\t\treturn cell.textBuffer.getLineMaxColumn(lineNumber);\n\t\t\t},\n\t\t\tgetLineFirstNonWhitespaceColumn(lineNumber: number): number {\n\t\t\t\treturn cell.textBuffer.getLineFirstNonWhitespaceColumn(lineNumber);\n\t\t\t},\n\t\t\tgetLineLastNonWhitespaceColumn(lineNumber: number): number {\n\t\t\t\treturn cell.textBuffer.getLineLastNonWhitespaceColumn(lineNumber);\n\t\t\t},\n\t\t\tnormalizePosition(position: Position, affinity: PositionAffinity): Position {\n\t\t\t\treturn position;\n\t\t\t},\n\t\t\tgetLineIndentColumn(lineNumber: number): number {\n\t\t\t\treturn indentOfLine(cell.textBuffer.getLineContent(lineNumber)) + 1;\n\t\t\t}\n\t\t};\n\t}\n\n\tprivate handleEditorOperationEvent(e: ITriggerEditorOperationEvent) {\n\t\tthis.trackedCells.forEach(cell => {\n\t\t\tif (cell.cellViewModel.handle === this.anchorCell?.[0].handle) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst eventsCollector = new ViewModelEventsCollector();\n\t\t\tconst controller = this.cursorsControllers.get(cell.cellViewModel.uri);\n\t\t\tif (!controller) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis.executeEditorOperation(controller, eventsCollector, e);\n\t\t});\n\t}\n\n\tprivate executeEditorOperation(controller: CursorsController, eventsCollector: ViewModelEventsCollector, e: ITriggerEditorOperationEvent) {\n\t\tswitch (e.handlerId) {\n\t\t\tcase Handler.CompositionStart:\n\t\t\t\tcontroller.startComposition(eventsCollector);\n\t\t\t\tbreak;\n\t\t\tcase Handler.CompositionEnd:\n\t\t\t\tcontroller.endComposition(eventsCollector, e.source);\n\t\t\t\tbreak;\n\t\t\tcase Handler.ReplacePreviousChar: {\n\t\t\t\tconst args = <Partial<ReplacePreviousCharPayload>>e.payload;\n\t\t\t\tcontroller.compositionType(eventsCollector, args.text || '', args.replaceCharCnt || 0, 0, 0, e.source);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcase Handler.CompositionType: {\n\t\t\t\tconst args = <Partial<CompositionTypePayload>>e.payload;\n\t\t\t\tcontroller.compositionType(eventsCollector, args.text || '', args.replacePrevCharCnt || 0, args.replaceNextCharCnt || 0, args.positionDelta || 0, e.source);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcase Handler.Paste: {\n\t\t\t\tconst args = <Partial<PastePayload>>e.payload;\n\t\t\t\tcontroller.paste(eventsCollector, args.text || '', args.pasteOnNewLine || false, args.multicursorText || null, e.source);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcase Handler.Cut:\n\t\t\t\tcontroller.cut(eventsCollector, e.source);\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tprivate updateViewModelSelections() {\n\t\tfor (const cell of this.trackedCells) {\n\t\t\tconst controller = this.cursorsControllers.get(cell.cellViewModel.uri);\n\t\t\tif (!controller) {\n\t\t\t\t// should not happen\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tcell.cellViewModel.setSelections(controller.getSelections());\n\t\t}\n\t}\n\n\tprivate updateFinalUndoRedo() {\n\t\tconst anchorCellModel = this.anchorCell?.[1].getModel();\n\t\tif (!anchorCellModel) {\n\t\t\t// should not happen\n\t\t\treturn;\n\t\t}\n\n\t\tconst newElementsMap: ResourceMap<IUndoRedoElement[]> = new ResourceMap<IUndoRedoElement[]>();\n\t\tconst resources: URI[] = [];\n\n\t\tthis.trackedCells.forEach(trackedMatch => {\n\t\t\tconst undoRedoState = trackedMatch.undoRedoHistory;\n\t\t\tif (!undoRedoState) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tresources.push(trackedMatch.cellViewModel.uri);\n\n\t\t\tconst currentPastElements = this.undoRedoService.getElements(trackedMatch.cellViewModel.uri).past.slice();\n\t\t\tconst oldPastElements = trackedMatch.undoRedoHistory.past.slice();\n\t\t\tconst newElements = currentPastElements.slice(oldPastElements.length);\n\t\t\tif (newElements.length === 0) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tnewElementsMap.set(trackedMatch.cellViewModel.uri, newElements);\n\n\t\t\tthis.undoRedoService.removeElements(trackedMatch.cellViewModel.uri);\n\t\t\toldPastElements.forEach(element => {\n\t\t\t\tthis.undoRedoService.pushElement(element);\n\t\t\t});\n\t\t});\n\n\t\tthis.undoRedoService.pushElement({\n\t\t\ttype: UndoRedoElementType.Workspace,\n\t\t\tresources: resources,\n\t\t\tlabel: 'Multi Cursor Edit',\n\t\t\tcode: 'multiCursorEdit',\n\t\t\tconfirmBeforeUndo: false,\n\t\t\tundo: async () => {\n\t\t\t\tnewElementsMap.forEach(async value => {\n\t\t\t\t\tvalue.reverse().forEach(async element => {\n\t\t\t\t\t\tawait element.undo();\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t},\n\t\t\tredo: async () => {\n\t\t\t\tnewElementsMap.forEach(async value => {\n\t\t\t\t\tvalue.forEach(async element => {\n\t\t\t\t\t\tawait element.redo();\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t}\n\n\tpublic resetToIdleState() {\n\t\tthis.state = NotebookMultiCursorState.Idle;\n\t\tthis._nbMultiSelectState.set(NotebookMultiCursorState.Idle);\n\t\tthis._nbIsMultiSelectSession.set(false);\n\t\tthis.updateFinalUndoRedo();\n\n\t\tthis.trackedCells.forEach(cell => {\n\t\t\tthis.clearDecorations(cell);\n\t\t\tcell.cellViewModel.setSelections([cell.initialSelection]); // correct cursor placement upon exiting cmd-d session\n\t\t});\n\n\t\tthis.anchorDisposables.clear();\n\t\tthis.anchorCell = undefined;\n\t\tthis.cursorsDisposables.clear();\n\t\tthis.cursorsControllers.clear();\n\t\tthis.trackedCells = [];\n\t\tthis.totalMatchesCount = 0;\n\t\tthis.startPosition = undefined;\n\t\tthis.word = '';\n\t}\n\n\tpublic async findAndTrackNextSelection(focusedCell: ICellViewModel): Promise<void> {\n\t\tif (this.state === NotebookMultiCursorState.Idle) { // move cursor to end of the symbol + track it, transition to selecting state\n\t\t\tconst textModel = focusedCell.textModel;\n\t\t\tif (!textModel) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst inputSelection = focusedCell.getSelections()[0];\n\t\t\tconst word = this.getWord(inputSelection, textModel);\n\t\t\tif (!word) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis.word = word.word;\n\n\t\t\t// Record the total number of matches at the beginning of the selection process for performance\n\t\t\tconst notebookTextModel = this.notebookEditor.textModel;\n\t\t\tif (notebookTextModel) {\n\t\t\t\tconst allMatches = notebookTextModel.findMatches(this.word, false, true, USUAL_WORD_SEPARATORS);\n\t\t\t\tthis.totalMatchesCount = allMatches.reduce((sum, cellMatch) => sum + cellMatch.matches.length, 0);\n\t\t\t}\n\n\t\t\tconst index = this.notebookEditor.getCellIndex(focusedCell);\n\t\t\tif (index === undefined) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.startPosition = {\n\t\t\t\tcellIndex: index,\n\t\t\t\tposition: new Position(inputSelection.startLineNumber, word.startColumn),\n\t\t\t};\n\n\t\t\tconst newSelection = new Selection(\n\t\t\t\tinputSelection.startLineNumber,\n\t\t\t\tword.startColumn,\n\t\t\t\tinputSelection.startLineNumber,\n\t\t\t\tword.endColumn\n\t\t\t);\n\t\t\tfocusedCell.setSelections([newSelection]);\n\n\t\t\tthis.anchorCell = this.notebookEditor.activeCellAndCodeEditor;\n\t\t\tif (!this.anchorCell || this.anchorCell[0].handle !== focusedCell.handle) {\n\t\t\t\tthrow new Error('Active cell is not the same as the cell passed as context');\n\t\t\t}\n\t\t\tif (!(this.anchorCell[1] instanceof CodeEditorWidget)) {\n\t\t\t\tthrow new Error('Active cell is not an instance of CodeEditorWidget');\n\t\t\t}\n\n\t\t\tawait this.updateTrackedCell(focusedCell, [newSelection]);\n\n\t\t\tthis._nbIsMultiSelectSession.set(true);\n\t\t\tthis.state = NotebookMultiCursorState.Selecting;\n\t\t\tthis._nbMultiSelectState.set(NotebookMultiCursorState.Selecting);\n\n\t\t\tthis._onDidChangeAnchorCell.fire();\n\n\t\t} else if (this.state === NotebookMultiCursorState.Selecting) { // use the word we stored from idle state transition to find next match, track it\n\t\t\tconst notebookTextModel = this.notebookEditor.textModel;\n\t\t\tif (!notebookTextModel) {\n\t\t\t\treturn; // should not happen\n\t\t\t}\n\n\t\t\tconst index = this.notebookEditor.getCellIndex(focusedCell);\n\t\t\tif (index === undefined) {\n\t\t\t\treturn; // should not happen\n\t\t\t}\n\n\t\t\tif (!this.startPosition) {\n\t\t\t\treturn; // should not happen\n\t\t\t}\n\n\t\t\t// Check if all matches are already covered by selections to avoid infinite looping\n\t\t\tconst totalSelections = this.trackedCells.reduce((sum, trackedCell) => sum + trackedCell.matchSelections.length, 0);\n\n\t\t\tif (totalSelections >= this.totalMatchesCount) {\n\t\t\t\t// All matches are already selected, make this a no-op like in regular editors\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst findResult = notebookTextModel.findNextMatch(\n\t\t\t\tthis.word,\n\t\t\t\t{ cellIndex: index, position: focusedCell.getSelections()[focusedCell.getSelections().length - 1].getEndPosition() },\n\t\t\t\tfalse,\n\t\t\t\ttrue,\n\t\t\t\tUSUAL_WORD_SEPARATORS,\n\t\t\t\tthis.startPosition,\n\t\t\t);\n\t\t\tif (!findResult) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst findResultCellViewModel = this.notebookEditor.getCellByHandle(findResult.cell.handle);\n\t\t\tif (!findResultCellViewModel) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (findResult.cell.handle === focusedCell.handle) { // match is in the same cell, find tracked entry, update and set selections in viewmodel and cursorController\n\t\t\t\tconst selections = [...focusedCell.getSelections(), Selection.fromRange(findResult.match.range, SelectionDirection.LTR)];\n\t\t\t\tconst trackedCell = await this.updateTrackedCell(focusedCell, selections);\n\t\t\t\tfindResultCellViewModel.setSelections(trackedCell.matchSelections);\n\n\n\t\t\t} else if (findResult.cell.handle !== focusedCell.handle) {\t// result is in a different cell, move focus there and apply selection, then update anchor\n\t\t\t\tawait this.notebookEditor.revealRangeInViewAsync(findResultCellViewModel, findResult.match.range);\n\t\t\t\tawait this.notebookEditor.focusNotebookCell(findResultCellViewModel, 'editor');\n\n\t\t\t\tconst trackedCell = await this.updateTrackedCell(findResultCellViewModel, [Selection.fromRange(findResult.match.range, SelectionDirection.LTR)]);\n\t\t\t\tfindResultCellViewModel.setSelections(trackedCell.matchSelections);\n\n\t\t\t\tthis.anchorCell = this.notebookEditor.activeCellAndCodeEditor;\n\t\t\t\tif (!this.anchorCell || !(this.anchorCell[1] instanceof CodeEditorWidget)) {\n\t\t\t\t\tthrow new Error('Active cell is not an instance of CodeEditorWidget');\n\t\t\t\t}\n\n\t\t\t\tthis._onDidChangeAnchorCell.fire();\n\n\t\t\t\t// we set the decorations manually for the cell we have just departed, since it blurs\n\t\t\t\t// we can find the match with the handle that the find and track request originated\n\t\t\t\tthis.initializeMultiSelectDecorations(this.trackedCells.find(trackedCell => trackedCell.cellViewModel.handle === focusedCell.handle));\n\t\t\t}\n\t\t}\n\t}\n\n\tpublic async selectAllMatches(focusedCell: ICellViewModel, matches?: CellFindMatchWithIndex[]): Promise<void> {\n\t\tconst notebookTextModel = this.notebookEditor.textModel;\n\t\tif (!notebookTextModel) {\n\t\t\treturn; // should not happen\n\t\t}\n\n\t\tif (matches) {\n\t\t\tawait this.handleFindWidgetSelectAllMatches(matches);\n\t\t} else {\n\t\t\tawait this.handleCellEditorSelectAllMatches(notebookTextModel, focusedCell);\n\t\t}\n\n\t\tawait this.syncCursorsControllers();\n\t\tthis.syncAnchorListeners();\n\t\tthis.updateLazyDecorations();\n\t}\n\n\tprivate async handleFindWidgetSelectAllMatches(matches: CellFindMatchWithIndex[]) {\n\t\t// TODO: support selecting state maybe. UX could get confusing since selecting state could be hit via ctrl+d which would have different filters (case sensetive + whole word)\n\t\tif (this.state !== NotebookMultiCursorState.Idle) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!matches.length) {\n\t\t\treturn;\n\t\t}\n\n\t\tawait this.notebookEditor.focusNotebookCell(matches[0].cell, 'editor');\n\t\tthis.anchorCell = this.notebookEditor.activeCellAndCodeEditor;\n\n\t\tthis.trackedCells = [];\n\t\tfor (const match of matches) {\n\t\t\tthis.updateTrackedCell(match.cell, match.contentMatches.map(match => Selection.fromRange(match.range, SelectionDirection.LTR)));\n\n\t\t\tif (this.anchorCell && match.cell.handle === this.anchorCell[0].handle) {\n\t\t\t\t// only explicitly set the focused cell's selections, the rest are handled by cursor controllers + decorations\n\t\t\t\tmatch.cell.setSelections(match.contentMatches.map(match => Selection.fromRange(match.range, SelectionDirection.LTR)));\n\t\t\t}\n\t\t}\n\n\t\tthis._nbIsMultiSelectSession.set(true);\n\t\tthis.state = NotebookMultiCursorState.Selecting;\n\t\tthis._nbMultiSelectState.set(NotebookMultiCursorState.Selecting);\n\t}\n\n\tprivate async handleCellEditorSelectAllMatches(notebookTextModel: NotebookTextModel, focusedCell: ICellViewModel) {\n\t\t// can be triggered mid multiselect session, or from idle state\n\t\tif (this.state === NotebookMultiCursorState.Idle) {\n\t\t\t// get word from current selection + rest of notebook objects\n\t\t\tconst textModel = focusedCell.textModel;\n\t\t\tif (!textModel) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst inputSelection = focusedCell.getSelections()[0];\n\t\t\tconst word = this.getWord(inputSelection, textModel);\n\t\t\tif (!word) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis.word = word.word;\n\t\t\tconst index = this.notebookEditor.getCellIndex(focusedCell);\n\t\t\tif (index === undefined) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis.startPosition = {\n\t\t\t\tcellIndex: index,\n\t\t\t\tposition: new Position(inputSelection.startLineNumber, word.startColumn),\n\t\t\t};\n\n\t\t\tthis.anchorCell = this.notebookEditor.activeCellAndCodeEditor;\n\t\t\tif (!this.anchorCell || this.anchorCell[0].handle !== focusedCell.handle) {\n\t\t\t\tthrow new Error('Active cell is not the same as the cell passed as context');\n\t\t\t}\n\t\t\tif (!(this.anchorCell[1] instanceof CodeEditorWidget)) {\n\t\t\t\tthrow new Error('Active cell is not an instance of CodeEditorWidget');\n\t\t\t}\n\n\t\t\t// get all matches in the notebook\n\t\t\tconst findResults = notebookTextModel.findMatches(this.word, false, true, USUAL_WORD_SEPARATORS);\n\n\t\t\t// create the tracked matches for every result, needed for cursor controllers\n\t\t\tthis.trackedCells = [];\n\t\t\tfor (const res of findResults) {\n\t\t\t\tawait this.updateTrackedCell(res.cell, res.matches.map(match => Selection.fromRange(match.range, SelectionDirection.LTR)));\n\n\t\t\t\tif (res.cell.handle === focusedCell.handle) {\n\t\t\t\t\tconst cellViewModel = this.notebookEditor.getCellByHandle(res.cell.handle);\n\t\t\t\t\tif (cellViewModel) {\n\t\t\t\t\t\tcellViewModel.setSelections(res.matches.map(match => Selection.fromRange(match.range, SelectionDirection.LTR)));\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis._nbIsMultiSelectSession.set(true);\n\t\t\tthis.state = NotebookMultiCursorState.Selecting;\n\t\t\tthis._nbMultiSelectState.set(NotebookMultiCursorState.Selecting);\n\n\t\t} else if (this.state === NotebookMultiCursorState.Selecting) {\n\t\t\t// we will already have a word + some number of tracked matches, need to update them with the rest given findAllMatches result\n\t\t\tconst findResults = notebookTextModel.findMatches(this.word, false, true, USUAL_WORD_SEPARATORS);\n\n\t\t\t// update existing tracked matches with new selections and create new tracked matches for cells that aren't tracked yet\n\t\t\tfor (const res of findResults) {\n\t\t\t\tawait this.updateTrackedCell(res.cell, res.matches.map(match => Selection.fromRange(match.range, SelectionDirection.LTR)));\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate async updateTrackedCell(cell: ICellViewModel | NotebookCellTextModel, selections: Selection[]) {\n\t\tconst cellViewModel = cell instanceof NotebookCellTextModel ? this.notebookEditor.getCellByHandle(cell.handle) : cell;\n\t\tif (!cellViewModel) {\n\t\t\tthrow new Error('Cell not found');\n\t\t}\n\n\t\tlet trackedMatch = this.trackedCells.find(trackedCell => trackedCell.cellViewModel.handle === cellViewModel.handle);\n\n\t\tif (trackedMatch) {\n\t\t\tthis.clearDecorations(trackedMatch); // need this to avoid leaking decorations -- TODO: just optimize the lazy decorations fn\n\t\t\ttrackedMatch.matchSelections = selections;\n\t\t} else {\n\t\t\tconst initialSelection = cellViewModel.getSelections()[0];\n\t\t\tconst textModel = await cellViewModel.resolveTextModel();\n\t\t\ttextModel.pushStackElement();\n\n\t\t\tconst editorConfig = this.constructCellEditorOptions(cellViewModel);\n\t\t\tconst rawEditorOptions = editorConfig.getRawOptions();\n\t\t\tconst cursorConfig: NotebookCursorConfig = {\n\t\t\t\tcursorStyle: cursorStyleFromString(rawEditorOptions.cursorStyle!),\n\t\t\t\tcursorBlinking: cursorBlinkingStyleFromString(rawEditorOptions.cursorBlinking!),\n\t\t\t\tcursorSmoothCaretAnimation: rawEditorOptions.cursorSmoothCaretAnimation!\n\t\t\t};\n\n\t\t\ttrackedMatch = {\n\t\t\t\tcellViewModel: cellViewModel,\n\t\t\t\tinitialSelection: initialSelection,\n\t\t\t\tmatchSelections: selections,\n\t\t\t\teditorConfig: editorConfig,\n\t\t\t\tcursorConfig: cursorConfig,\n\t\t\t\tdecorationIds: [],\n\t\t\t\tundoRedoHistory: this.undoRedoService.getElements(cellViewModel.uri)\n\t\t\t};\n\t\t\tthis.trackedCells.push(trackedMatch);\n\t\t}\n\t\treturn trackedMatch;\n\t}\n\n\tpublic async deleteLeft(): Promise<void> {\n\t\tthis.trackedCells.forEach(cell => {\n\t\t\tconst controller = this.cursorsControllers.get(cell.cellViewModel.uri);\n\t\t\tif (!controller) {\n\t\t\t\t// should not happen\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst [, commands] = DeleteOperations.deleteLeft(\n\t\t\t\tcontroller.getPrevEditOperationType(),\n\t\t\t\tcontroller.context.cursorConfig,\n\t\t\t\tcontroller.context.model,\n\t\t\t\tcontroller.getSelections(),\n\t\t\t\tcontroller.getAutoClosedCharacters(),\n\t\t\t);\n\n\t\t\tconst delSelections = CommandExecutor.executeCommands(controller.context.model, controller.getSelections(), commands);\n\t\t\tif (!delSelections) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tcontroller.setSelections(new ViewModelEventsCollector(), undefined, delSelections, CursorChangeReason.Explicit);\n\t\t});\n\t\tthis.updateLazyDecorations();\n\t}\n\n\tpublic async deleteRight(): Promise<void> {\n\t\tthis.trackedCells.forEach(cell => {\n\t\t\tconst controller = this.cursorsControllers.get(cell.cellViewModel.uri);\n\t\t\tif (!controller) {\n\t\t\t\t// should not happen\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst [, commands] = DeleteOperations.deleteRight(\n\t\t\t\tcontroller.getPrevEditOperationType(),\n\t\t\t\tcontroller.context.cursorConfig,\n\t\t\t\tcontroller.context.model,\n\t\t\t\tcontroller.getSelections(),\n\t\t\t);\n\n\t\t\tif (cell.cellViewModel.handle !== this.anchorCell?.[0].handle) {\n\t\t\t\tconst delSelections = CommandExecutor.executeCommands(controller.context.model, controller.getSelections(), commands);\n\t\t\t\tif (!delSelections) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tcontroller.setSelections(new ViewModelEventsCollector(), undefined, delSelections, CursorChangeReason.Explicit);\n\t\t\t} else {\n\t\t\t\t// get the selections from the viewmodel since we run the command manually (for cursor decoration reasons)\n\t\t\t\tcontroller.setSelections(new ViewModelEventsCollector(), undefined, cell.cellViewModel.getSelections(), CursorChangeReason.Explicit);\n\t\t\t}\n\n\t\t});\n\t\tthis.updateLazyDecorations();\n\t}\n\n\tasync undo() {\n\t\tconst models: ITextModel[] = [];\n\t\tfor (const cell of this.trackedCells) {\n\t\t\tconst model = await cell.cellViewModel.resolveTextModel();\n\t\t\tif (model) {\n\t\t\t\tmodels.push(model);\n\t\t\t}\n\t\t}\n\n\t\tawait Promise.all(models.map(model => model.undo()));\n\t\tthis.updateViewModelSelections();\n\t\tthis.updateLazyDecorations();\n\t}\n\n\tasync redo() {\n\t\tconst models: ITextModel[] = [];\n\t\tfor (const cell of this.trackedCells) {\n\t\t\tconst model = await cell.cellViewModel.resolveTextModel();\n\t\t\tif (model) {\n\t\t\t\tmodels.push(model);\n\t\t\t}\n\t\t}\n\n\t\tawait Promise.all(models.map(model => model.redo()));\n\t\tthis.updateViewModelSelections();\n\t\tthis.updateLazyDecorations();\n\t}\n\n\tprivate constructCellEditorOptions(cell: ICellViewModel): EditorConfiguration {\n\t\tconst cellEditorOptions = new CellEditorOptions(this.notebookEditor.getBaseCellEditorOptions(cell.language), this.notebookEditor.notebookOptions, this.configurationService);\n\t\tconst options = cellEditorOptions.getUpdatedValue(cell.internalMetadata, cell.uri);\n\t\tcellEditorOptions.dispose();\n\t\treturn new EditorConfiguration(false, MenuId.EditorContent, options, null, this.accessibilityService);\n\t}\n\n\t/**\n\t * Updates the multicursor selection decorations for a specific matched cell\n\t *\n\t * @param cell -- match object containing the viewmodel + selections\n\t */\n\tprivate initializeMultiSelectDecorations(cell: TrackedCell | undefined) {\n\t\tif (!cell) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst decorations: IModelDeltaDecoration[] = [];\n\t\tcell.matchSelections.forEach(selection => {\n\t\t\t// mock cursor at the end of the selection\n\t\t\tdecorations.push({\n\t\t\t\trange: Selection.fromPositions(selection.getEndPosition()),\n\t\t\t\toptions: {\n\t\t\t\t\tdescription: '',\n\t\t\t\t\tclassName: this.getClassName(cell.cursorConfig, true),\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\n\t\tcell.decorationIds = cell.cellViewModel.deltaModelDecorations(\n\t\t\tcell.decorationIds,\n\t\t\tdecorations\n\t\t);\n\t}\n\n\tprivate updateLazyDecorations() {\n\t\tthis.trackedCells.forEach(cell => {\n\t\t\tif (cell.cellViewModel.handle === this.anchorCell?.[0].handle) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst controller = this.cursorsControllers.get(cell.cellViewModel.uri);\n\t\t\tif (!controller) {\n\t\t\t\t// should not happen\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst selections = controller.getSelections();\n\n\t\t\tconst newDecorations: IModelDeltaDecoration[] = [];\n\t\t\tselections?.map(selection => {\n\t\t\t\tconst isEmpty = selection.isEmpty();\n\n\t\t\t\tif (!isEmpty) {\n\t\t\t\t\t// selection decoration (shift+arrow, etc)\n\t\t\t\t\tnewDecorations.push({\n\t\t\t\t\t\trange: selection,\n\t\t\t\t\t\toptions: {\n\t\t\t\t\t\t\tdescription: '',\n\t\t\t\t\t\t\tclassName: this.getClassName(cell.cursorConfig, false),\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\t// mock cursor at the end of the selection\n\t\t\t\tnewDecorations.push({\n\t\t\t\t\trange: Selection.fromPositions(selection.getPosition()),\n\t\t\t\t\toptions: {\n\t\t\t\t\t\tdescription: '',\n\t\t\t\t\t\tzIndex: 10000,\n\t\t\t\t\t\tclassName: this.getClassName(cell.cursorConfig, true),\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\n\t\t\tcell.decorationIds = cell.cellViewModel.deltaModelDecorations(\n\t\t\t\tcell.decorationIds,\n\t\t\t\tnewDecorations\n\t\t\t);\n\t\t});\n\t}\n\n\tprivate clearDecorations(cell: TrackedCell) {\n\t\tcell.decorationIds = cell.cellViewModel.deltaModelDecorations(\n\t\t\tcell.decorationIds,\n\t\t\t[]\n\t\t);\n\t}\n\n\tprivate getWord(selection: Selection, model: ITextModel): IWordAtPosition | null {\n\t\tconst lineNumber = selection.startLineNumber;\n\t\tconst startColumn = selection.startColumn;\n\n\t\tif (model.isDisposed()) {\n\t\t\treturn null;\n\t\t}\n\n\t\treturn model.getWordAtPosition({\n\t\t\tlineNumber: lineNumber,\n\t\t\tcolumn: startColumn\n\t\t});\n\t}\n\n\tprivate getClassName(cursorConfig: NotebookCursorConfig, isCursor?: boolean): string {\n\t\tlet result = isCursor ? '.nb-multicursor-cursor' : '.nb-multicursor-selection';\n\n\t\tif (isCursor) {\n\t\t\t// handle base style\n\t\t\tswitch (cursorConfig.cursorStyle) {\n\t\t\t\tcase TextEditorCursorStyle.Line:\n\t\t\t\t\tbreak; // default style, no additional class needed (handled by base css style)\n\t\t\t\tcase TextEditorCursorStyle.Block:\n\t\t\t\t\tresult += '.nb-cursor-block-style';\n\t\t\t\t\tbreak;\n\t\t\t\tcase TextEditorCursorStyle.Underline:\n\t\t\t\t\tresult += '.nb-cursor-underline-style';\n\t\t\t\t\tbreak;\n\t\t\t\tcase TextEditorCursorStyle.LineThin:\n\t\t\t\t\tresult += '.nb-cursor-line-thin-style';\n\t\t\t\t\tbreak;\n\t\t\t\tcase TextEditorCursorStyle.BlockOutline:\n\t\t\t\t\tresult += '.nb-cursor-block-outline-style';\n\t\t\t\t\tbreak;\n\t\t\t\tcase TextEditorCursorStyle.UnderlineThin:\n\t\t\t\t\tresult += '.nb-cursor-underline-thin-style';\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\t// handle animation style\n\t\t\tswitch (cursorConfig.cursorBlinking) {\n\t\t\t\tcase TextEditorCursorBlinkingStyle.Blink:\n\t\t\t\t\tresult += '.nb-blink';\n\t\t\t\t\tbreak;\n\t\t\t\tcase TextEditorCursorBlinkingStyle.Smooth:\n\t\t\t\t\tresult += '.nb-smooth';\n\t\t\t\t\tbreak;\n\t\t\t\tcase TextEditorCursorBlinkingStyle.Phase:\n\t\t\t\t\tresult += '.nb-phase';\n\t\t\t\t\tbreak;\n\t\t\t\tcase TextEditorCursorBlinkingStyle.Expand:\n\t\t\t\t\tresult += '.nb-expand';\n\t\t\t\t\tbreak;\n\t\t\t\tcase TextEditorCursorBlinkingStyle.Solid:\n\t\t\t\t\tresult += '.nb-solid';\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\tresult += '.nb-solid';\n\t\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\t// handle caret animation style\n\t\t\tif (cursorConfig.cursorSmoothCaretAnimation === 'on' || cursorConfig.cursorSmoothCaretAnimation === 'explicit') {\n\t\t\t\tresult += '.nb-smooth-caret-animation';\n\t\t\t}\n\n\t\t}\n\t\treturn result;\n\t}\n\n\toverride dispose(): void {\n\t\tsuper.dispose();\n\t\tthis.anchorDisposables.dispose();\n\t\tthis.cursorsDisposables.dispose();\n\n\t\tthis.trackedCells.forEach(cell => {\n\t\t\tthis.clearDecorations(cell);\n\t\t});\n\t\tthis.trackedCells = [];\n\t}\n\n}\n\nclass NotebookSelectAllFindMatches extends NotebookAction {\n\tconstructor() {\n\t\tsuper({\n\t\t\tid: NOTEBOOK_SELECT_ALL_FIND_MATCHES_ID,\n\t\t\ttitle: localize('selectAllFindMatches', \"Select All Occurrences of Find Match\"),\n\t\t\tprecondition: ContextKeyExpr.and(\n\t\t\t\tContextKeyExpr.equals('config.notebook.multiCursor.enabled', true),\n\t\t\t),\n\t\t\tkeybinding: {\n\t\t\t\twhen: ContextKeyExpr.or(\n\t\t\t\t\tContextKeyExpr.and(\n\t\t\t\t\t\tContextKeyExpr.equals('config.notebook.multiCursor.enabled', true),\n\t\t\t\t\t\tNOTEBOOK_IS_ACTIVE_EDITOR,\n\t\t\t\t\t\tNOTEBOOK_CELL_EDITOR_FOCUSED,\n\t\t\t\t\t),\n\t\t\t\t\tContextKeyExpr.and(\n\t\t\t\t\t\tContextKeyExpr.equals('config.notebook.multiCursor.enabled', true),\n\t\t\t\t\t\tKEYBINDING_CONTEXT_NOTEBOOK_FIND_WIDGET_FOCUSED\n\t\t\t\t\t),\n\t\t\t\t),\n\t\t\t\tprimary: KeyMod.CtrlCmd | KeyMod.Shift | KeyCode.KeyL,\n\t\t\t\tweight: KeybindingWeight.WorkbenchContrib\n\t\t\t}\n\t\t});\n\t}\n\n\toverride async runWithContext(accessor: ServicesAccessor, context: INotebookActionContext): Promise<void> {\n\t\tconst editorService = accessor.get(IEditorService);\n\n\t\tconst editor = getNotebookEditorFromEditorPane(editorService.activeEditorPane);\n\t\tif (!editor) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!context.cell) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst cursorController = editor.getContribution<NotebookMultiCursorController>(NotebookMultiCursorController.id);\n\t\tconst findController = editor.getContribution<NotebookFindContrib>(NotebookFindContrib.id);\n\n\t\tif (findController.widget.isFocused) {\n\t\t\tconst findModel = findController.widget.findModel;\n\t\t\tcursorController.selectAllMatches(context.cell, findModel.findMatches);\n\t\t} else {\n\t\t\tcursorController.selectAllMatches(context.cell);\n\t\t}\n\n\t}\n}\n\nclass NotebookAddMatchToMultiSelectionAction extends NotebookAction {\n\tconstructor() {\n\t\tsuper({\n\t\t\tid: NOTEBOOK_ADD_FIND_MATCH_TO_SELECTION_ID,\n\t\t\ttitle: localize('addFindMatchToSelection', \"Add Selection to Next Find Match\"),\n\t\t\tprecondition: ContextKeyExpr.and(\n\t\t\t\tContextKeyExpr.equals('config.notebook.multiCursor.enabled', true),\n\t\t\t\tNOTEBOOK_IS_ACTIVE_EDITOR,\n\t\t\t\tNOTEBOOK_CELL_EDITOR_FOCUSED,\n\t\t\t),\n\t\t\tkeybinding: {\n\t\t\t\twhen: ContextKeyExpr.and(\n\t\t\t\t\tContextKeyExpr.equals('config.notebook.multiCursor.enabled', true),\n\t\t\t\t\tNOTEBOOK_IS_ACTIVE_EDITOR,\n\t\t\t\t\tNOTEBOOK_CELL_EDITOR_FOCUSED,\n\t\t\t\t),\n\t\t\t\tprimary: KeyMod.CtrlCmd | KeyCode.KeyD,\n\t\t\t\tweight: KeybindingWeight.WorkbenchContrib\n\t\t\t}\n\t\t});\n\t}\n\n\toverride async runWithContext(accessor: ServicesAccessor, context: INotebookActionContext): Promise<void> {\n\t\tconst editorService = accessor.get(IEditorService);\n\t\tconst editor = getNotebookEditorFromEditorPane(editorService.activeEditorPane);\n\n\t\tif (!editor) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!context.cell) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst controller = editor.getContribution<NotebookMultiCursorController>(NotebookMultiCursorController.id);\n\t\tcontroller.findAndTrackNextSelection(context.cell);\n\t}\n}\n\nclass NotebookExitMultiSelectionAction extends NotebookAction {\n\tconstructor() {\n\t\tsuper({\n\t\t\tid: 'noteMultiCursor.exit',\n\t\t\ttitle: localize('exitMultiSelection', \"Exit Multi Cursor Mode\"),\n\t\t\tprecondition: ContextKeyExpr.and(\n\t\t\t\tContextKeyExpr.equals('config.notebook.multiCursor.enabled', true),\n\t\t\t\tNOTEBOOK_IS_ACTIVE_EDITOR,\n\t\t\t\tNOTEBOOK_MULTI_CURSOR_CONTEXT.IsNotebookMultiCursor,\n\t\t\t),\n\t\t\tkeybinding: {\n\t\t\t\twhen: ContextKeyExpr.and(\n\t\t\t\t\tContextKeyExpr.equals('config.notebook.multiCursor.enabled', true),\n\t\t\t\t\tNOTEBOOK_IS_ACTIVE_EDITOR,\n\t\t\t\t\tNOTEBOOK_MULTI_CURSOR_CONTEXT.IsNotebookMultiCursor,\n\t\t\t\t),\n\t\t\t\tprimary: KeyCode.Escape,\n\t\t\t\tweight: KeybindingWeight.WorkbenchContrib\n\t\t\t}\n\t\t});\n\t}\n\n\toverride async runWithContext(accessor: ServicesAccessor, context: INotebookActionContext): Promise<void> {\n\t\tconst editorService = accessor.get(IEditorService);\n\t\tconst editor = getNotebookEditorFromEditorPane(editorService.activeEditorPane);\n\n\t\tif (!editor) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst controller = editor.getContribution<NotebookMultiCursorController>(NotebookMultiCursorController.id);\n\t\tcontroller.resetToIdleState();\n\t}\n}\n\nclass NotebookDeleteLeftMultiSelectionAction extends NotebookAction {\n\tconstructor() {\n\t\tsuper({\n\t\t\tid: 'noteMultiCursor.deleteLeft',\n\t\t\ttitle: localize('deleteLeftMultiSelection', \"Delete Left\"),\n\t\t\tprecondition: ContextKeyExpr.and(\n\t\t\t\tContextKeyExpr.equals('config.notebook.multiCursor.enabled', true),\n\t\t\t\tNOTEBOOK_IS_ACTIVE_EDITOR,\n\t\t\t\tNOTEBOOK_MULTI_CURSOR_CONTEXT.IsNotebookMultiCursor,\n\t\t\t\tContextKeyExpr.or(\n\t\t\t\t\tNOTEBOOK_MULTI_CURSOR_CONTEXT.NotebookMultiSelectCursorState.isEqualTo(NotebookMultiCursorState.Selecting),\n\t\t\t\t\tNOTEBOOK_MULTI_CURSOR_CONTEXT.NotebookMultiSelectCursorState.isEqualTo(NotebookMultiCursorState.Editing)\n\t\t\t\t)\n\t\t\t),\n\t\t\tkeybinding: {\n\t\t\t\twhen: ContextKeyExpr.and(\n\t\t\t\t\tContextKeyExpr.equals('config.notebook.multiCursor.enabled', true),\n\t\t\t\t\tNOTEBOOK_IS_ACTIVE_EDITOR,\n\t\t\t\t\tNOTEBOOK_MULTI_CURSOR_CONTEXT.IsNotebookMultiCursor,\n\t\t\t\t\tContextKeyExpr.or(\n\t\t\t\t\t\tNOTEBOOK_MULTI_CURSOR_CONTEXT.NotebookMultiSelectCursorState.isEqualTo(NotebookMultiCursorState.Selecting),\n\t\t\t\t\t\tNOTEBOOK_MULTI_CURSOR_CONTEXT.NotebookMultiSelectCursorState.isEqualTo(NotebookMultiCursorState.Editing)\n\t\t\t\t\t)\n\t\t\t\t),\n\t\t\t\tprimary: KeyCode.Backspace,\n\t\t\t\tweight: KeybindingWeight.WorkbenchContrib\n\t\t\t}\n\t\t});\n\t}\n\n\toverride async runWithContext(accessor: ServicesAccessor, context: INotebookActionContext): Promise<void> {\n\t\tconst editorService = accessor.get(IEditorService);\n\t\tconst editor = getNotebookEditorFromEditorPane(editorService.activeEditorPane);\n\n\t\tif (!editor) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst controller = editor.getContribution<NotebookMultiCursorController>(NotebookMultiCursorController.id);\n\t\tcontroller.deleteLeft();\n\t}\n}\n\nclass NotebookDeleteRightMultiSelectionAction extends NotebookAction {\n\tconstructor() {\n\t\tsuper({\n\t\t\tid: 'noteMultiCursor.deleteRight',\n\t\t\ttitle: localize('deleteRightMultiSelection', \"Delete Right\"),\n\t\t\tprecondition: ContextKeyExpr.and(\n\t\t\t\tContextKeyExpr.equals('config.notebook.multiCursor.enabled', true),\n\t\t\t\tNOTEBOOK_IS_ACTIVE_EDITOR,\n\t\t\t\tNOTEBOOK_MULTI_CURSOR_CONTEXT.IsNotebookMultiCursor,\n\t\t\t\tContextKeyExpr.or(\n\t\t\t\t\tNOTEBOOK_MULTI_CURSOR_CONTEXT.NotebookMultiSelectCursorState.isEqualTo(NotebookMultiCursorState.Selecting),\n\t\t\t\t\tNOTEBOOK_MULTI_CURSOR_CONTEXT.NotebookMultiSelectCursorState.isEqualTo(NotebookMultiCursorState.Editing)\n\t\t\t\t)\n\t\t\t),\n\t\t\tkeybinding: {\n\t\t\t\twhen: ContextKeyExpr.and(\n\t\t\t\t\tContextKeyExpr.equals('config.notebook.multiCursor.enabled', true),\n\t\t\t\t\tNOTEBOOK_IS_ACTIVE_EDITOR,\n\t\t\t\t\tNOTEBOOK_MULTI_CURSOR_CONTEXT.IsNotebookMultiCursor,\n\t\t\t\t\tContextKeyExpr.or(\n\t\t\t\t\t\tNOTEBOOK_MULTI_CURSOR_CONTEXT.NotebookMultiSelectCursorState.isEqualTo(NotebookMultiCursorState.Selecting),\n\t\t\t\t\t\tNOTEBOOK_MULTI_CURSOR_CONTEXT.NotebookMultiSelectCursorState.isEqualTo(NotebookMultiCursorState.Editing)\n\t\t\t\t\t)\n\t\t\t\t),\n\t\t\t\tprimary: KeyCode.Delete,\n\t\t\t\tweight: KeybindingWeight.WorkbenchContrib\n\t\t\t}\n\t\t});\n\t}\n\n\toverride async runWithContext(accessor: ServicesAccessor, context: INotebookActionContext): Promise<void> {\n\t\tconst editorService = accessor.get(IEditorService);\n\t\tconst nbEditor = getNotebookEditorFromEditorPane(editorService.activeEditorPane);\n\t\tif (!nbEditor) {\n\t\t\treturn;\n\t\t}\n\t\tconst cellEditor = nbEditor.activeCodeEditor;\n\t\tif (!cellEditor) {\n\t\t\treturn;\n\t\t}\n\n\t\t// need to run the command manually since we are overriding the command, this ensures proper cursor animation behavior\n\t\tCoreEditingCommands.DeleteRight.runEditorCommand(accessor, cellEditor, null);\n\n\t\tconst controller = nbEditor.getContribution<NotebookMultiCursorController>(NotebookMultiCursorController.id);\n\t\tcontroller.deleteRight();\n\t}\n}\n\nclass NotebookMultiCursorUndoRedoContribution extends Disposable {\n\n\tstatic readonly ID = 'workbench.contrib.notebook.multiCursorUndoRedo';\n\n\tconstructor(@IEditorService private readonly _editorService: IEditorService, @IConfigurationService private readonly configurationService: IConfigurationService) {\n\t\tsuper();\n\n\t\tif (!this.configurationService.getValue<boolean>('notebook.multiCursor.enabled')) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst PRIORITY = 10005;\n\t\tthis._register(UndoCommand.addImplementation(PRIORITY, 'notebook-multicursor-undo-redo', () => {\n\t\t\tconst editor = getNotebookEditorFromEditorPane(this._editorService.activeEditorPane);\n\t\t\tif (!editor) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif (!editor.hasModel()) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tconst controller = editor.getContribution<NotebookMultiCursorController>(NotebookMultiCursorController.id);\n\n\t\t\treturn controller.undo();\n\t\t}, ContextKeyExpr.and(\n\t\t\tContextKeyExpr.equals('config.notebook.multiCursor.enabled', true),\n\t\t\tNOTEBOOK_IS_ACTIVE_EDITOR,\n\t\t\tNOTEBOOK_MULTI_CURSOR_CONTEXT.IsNotebookMultiCursor,\n\t\t)));\n\n\t\tthis._register(RedoCommand.addImplementation(PRIORITY, 'notebook-multicursor-undo-redo', () => {\n\t\t\tconst editor = getNotebookEditorFromEditorPane(this._editorService.activeEditorPane);\n\t\t\tif (!editor) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif (!editor.hasModel()) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tconst controller = editor.getContribution<NotebookMultiCursorController>(NotebookMultiCursorController.id);\n\t\t\treturn controller.redo();\n\t\t}, ContextKeyExpr.and(\n\t\t\tContextKeyExpr.equals('config.notebook.multiCursor.enabled', true),\n\t\t\tNOTEBOOK_IS_ACTIVE_EDITOR,\n\t\t\tNOTEBOOK_MULTI_CURSOR_CONTEXT.IsNotebookMultiCursor,\n\t\t)));\n\t}\n}\n\nregisterNotebookContribution(NotebookMultiCursorController.id, NotebookMultiCursorController);\nregisterWorkbenchContribution2(NotebookMultiCursorUndoRedoContribution.ID, NotebookMultiCursorUndoRedoContribution, WorkbenchPhase.BlockRestore);\n\nregisterAction2(NotebookSelectAllFindMatches);\nregisterAction2(NotebookAddMatchToMultiSelectionAction);\nregisterAction2(NotebookExitMultiSelectionAction);\nregisterAction2(NotebookDeleteLeftMultiSelectionAction);\nregisterAction2(NotebookDeleteRightMultiSelectionAction);\n"]}