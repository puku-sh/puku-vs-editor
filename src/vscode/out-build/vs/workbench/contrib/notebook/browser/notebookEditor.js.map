{"version":3,"sources":["vs/workbench/contrib/notebook/browser/notebookEditor.ts"],"names":[],"mappings":"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","file":"notebookEditor.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as DOM from '../../../../base/browser/dom.js';\nimport { IActionViewItem } from '../../../../base/browser/ui/actionbar/actionbar.js';\nimport { IAction, toAction } from '../../../../base/common/actions.js';\nimport { timeout } from '../../../../base/common/async.js';\nimport { CancellationToken } from '../../../../base/common/cancellation.js';\nimport { Emitter, Event } from '../../../../base/common/event.js';\nimport { DisposableStore, MutableDisposable } from '../../../../base/common/lifecycle.js';\nimport { extname, isEqual } from '../../../../base/common/resources.js';\nimport { URI } from '../../../../base/common/uri.js';\nimport { generateUuid } from '../../../../base/common/uuid.js';\nimport { ITextResourceConfigurationService } from '../../../../editor/common/services/textResourceConfiguration.js';\nimport { localize } from '../../../../nls.js';\nimport { IContextKeyService } from '../../../../platform/contextkey/common/contextkey.js';\nimport { IEditorOptions } from '../../../../platform/editor/common/editor.js';\nimport { ByteSize, FileOperationError, FileOperationResult, IFileService, TooLargeFileOperationError } from '../../../../platform/files/common/files.js';\nimport { IInstantiationService } from '../../../../platform/instantiation/common/instantiation.js';\nimport { IStorageService } from '../../../../platform/storage/common/storage.js';\nimport { ITelemetryService } from '../../../../platform/telemetry/common/telemetry.js';\nimport { IThemeService } from '../../../../platform/theme/common/themeService.js';\nimport { Selection } from '../../../../editor/common/core/selection.js';\nimport { EditorPane } from '../../../browser/parts/editor/editorPane.js';\nimport { DEFAULT_EDITOR_ASSOCIATION, EditorPaneSelectionChangeReason, EditorPaneSelectionCompareResult, EditorResourceAccessor, IEditorMemento, IEditorOpenContext, IEditorPane, IEditorPaneScrollPosition, IEditorPaneSelection, IEditorPaneSelectionChangeEvent, IEditorPaneWithScrolling, createEditorOpenError, createTooLargeFileError, isEditorOpenError } from '../../../common/editor.js';\nimport { EditorInput } from '../../../common/editor/editorInput.js';\nimport { SELECT_KERNEL_ID } from './controller/coreActions.js';\nimport { INotebookEditorOptions, INotebookEditorPane, INotebookEditorViewState } from './notebookBrowser.js';\nimport { IBorrowValue, INotebookEditorService } from './services/notebookEditorService.js';\nimport { NotebookEditorWidget } from './notebookEditorWidget.js';\nimport { NotebooKernelActionViewItem } from './viewParts/notebookKernelView.js';\nimport { NotebookTextModel } from '../common/model/notebookTextModel.js';\nimport { CellKind, NOTEBOOK_EDITOR_ID, NotebookWorkingCopyTypeIdentifier } from '../common/notebookCommon.js';\nimport { NotebookEditorInput } from '../common/notebookEditorInput.js';\nimport { NotebookPerfMarks } from '../common/notebookPerformance.js';\nimport { GroupsOrder, IEditorGroup, IEditorGroupsService } from '../../../services/editor/common/editorGroupsService.js';\nimport { IEditorService } from '../../../services/editor/common/editorService.js';\nimport { IEditorProgressService } from '../../../../platform/progress/common/progress.js';\nimport { InstallRecommendedExtensionAction } from '../../extensions/browser/extensionsActions.js';\nimport { INotebookService } from '../common/notebookService.js';\nimport { IExtensionsWorkbenchService } from '../../extensions/common/extensions.js';\nimport { EnablementState } from '../../../services/extensionManagement/common/extensionManagement.js';\nimport { IWorkingCopyBackupService } from '../../../services/workingCopy/common/workingCopyBackup.js';\nimport { streamToBuffer } from '../../../../base/common/buffer.js';\nimport { ILogService } from '../../../../platform/log/common/log.js';\nimport { IPreferencesService } from '../../../services/preferences/common/preferences.js';\nimport { IActionViewItemOptions } from '../../../../base/browser/ui/actionbar/actionViewItems.js';\nimport { StopWatch } from '../../../../base/common/stopwatch.js';\nimport { ICodeEditor } from '../../../../editor/browser/editorBrowser.js';\n\nconst NOTEBOOK_EDITOR_VIEW_STATE_PREFERENCE_KEY = 'NotebookEditorViewState';\n\nexport class NotebookEditor extends EditorPane implements INotebookEditorPane, IEditorPaneWithScrolling {\n\tstatic readonly ID: string = NOTEBOOK_EDITOR_ID;\n\n\tprivate readonly _editorMemento: IEditorMemento<INotebookEditorViewState>;\n\tprivate readonly _groupListener = this._register(new DisposableStore());\n\tprivate readonly _widgetDisposableStore: DisposableStore = this._register(new DisposableStore());\n\tprivate _widget: IBorrowValue<NotebookEditorWidget> = { value: undefined };\n\tprivate _rootElement!: HTMLElement;\n\tprivate _pagePosition?: { readonly dimension: DOM.Dimension; readonly position: DOM.IDomPosition };\n\n\tprivate readonly _inputListener = this._register(new MutableDisposable());\n\n\t// override onDidFocus and onDidBlur to be based on the NotebookEditorWidget element\n\tprivate readonly _onDidFocusWidget = this._register(new Emitter<void>());\n\toverride get onDidFocus(): Event<void> { return this._onDidFocusWidget.event; }\n\tprivate readonly _onDidBlurWidget = this._register(new Emitter<void>());\n\toverride get onDidBlur(): Event<void> { return this._onDidBlurWidget.event; }\n\n\tprivate readonly _onDidChangeModel = this._register(new Emitter<void>());\n\treadonly onDidChangeModel: Event<void> = this._onDidChangeModel.event;\n\n\tprivate readonly _onDidChangeSelection = this._register(new Emitter<IEditorPaneSelectionChangeEvent>());\n\treadonly onDidChangeSelection = this._onDidChangeSelection.event;\n\n\tprotected readonly _onDidChangeScroll = this._register(new Emitter<void>());\n\treadonly onDidChangeScroll = this._onDidChangeScroll.event;\n\n\tconstructor(\n\t\tgroup: IEditorGroup,\n\t\t@ITelemetryService telemetryService: ITelemetryService,\n\t\t@IThemeService themeService: IThemeService,\n\t\t@IInstantiationService private readonly _instantiationService: IInstantiationService,\n\t\t@IStorageService storageService: IStorageService,\n\t\t@IEditorService private readonly _editorService: IEditorService,\n\t\t@IEditorGroupsService private readonly _editorGroupService: IEditorGroupsService,\n\t\t@INotebookEditorService private readonly _notebookWidgetService: INotebookEditorService,\n\t\t@IContextKeyService private readonly _contextKeyService: IContextKeyService,\n\t\t@IFileService private readonly _fileService: IFileService,\n\t\t@ITextResourceConfigurationService configurationService: ITextResourceConfigurationService,\n\t\t@IEditorProgressService private readonly _editorProgressService: IEditorProgressService,\n\t\t@INotebookService private readonly _notebookService: INotebookService,\n\t\t@IExtensionsWorkbenchService private readonly _extensionsWorkbenchService: IExtensionsWorkbenchService,\n\t\t@IWorkingCopyBackupService private readonly _workingCopyBackupService: IWorkingCopyBackupService,\n\t\t@ILogService private readonly logService: ILogService,\n\t\t@IPreferencesService private readonly _preferencesService: IPreferencesService\n\t) {\n\t\tsuper(NotebookEditor.ID, group, telemetryService, themeService, storageService);\n\t\tthis._editorMemento = this.getEditorMemento<INotebookEditorViewState>(_editorGroupService, configurationService, NOTEBOOK_EDITOR_VIEW_STATE_PREFERENCE_KEY);\n\n\t\tthis._register(this._fileService.onDidChangeFileSystemProviderCapabilities(e => this._onDidChangeFileSystemProvider(e.scheme)));\n\t\tthis._register(this._fileService.onDidChangeFileSystemProviderRegistrations(e => this._onDidChangeFileSystemProvider(e.scheme)));\n\t}\n\n\tprivate _onDidChangeFileSystemProvider(scheme: string): void {\n\t\tif (this.input instanceof NotebookEditorInput && this.input.resource?.scheme === scheme) {\n\t\t\tthis._updateReadonly(this.input);\n\t\t}\n\t}\n\n\tprivate _onDidChangeInputCapabilities(input: NotebookEditorInput): void {\n\t\tif (this.input === input) {\n\t\t\tthis._updateReadonly(input);\n\t\t}\n\t}\n\n\tprivate _updateReadonly(input: NotebookEditorInput): void {\n\t\tthis._widget.value?.setOptions({ isReadOnly: !!input.isReadonly() });\n\t}\n\n\tget textModel(): NotebookTextModel | undefined {\n\t\treturn this._widget.value?.textModel;\n\t}\n\n\toverride get minimumWidth(): number { return 220; }\n\toverride get maximumWidth(): number { return Number.POSITIVE_INFINITY; }\n\n\t// these setters need to exist because this extends from EditorPane\n\toverride set minimumWidth(value: number) { /*noop*/ }\n\toverride set maximumWidth(value: number) { /*noop*/ }\n\n\t//#region Editor Core\n\toverride get scopedContextKeyService(): IContextKeyService | undefined {\n\t\treturn this._widget.value?.scopedContextKeyService;\n\t}\n\n\tprotected createEditor(parent: HTMLElement): void {\n\t\tthis._rootElement = DOM.append(parent, DOM.$('.notebook-editor'));\n\t\tthis._rootElement.id = `notebook-editor-element-${generateUuid()}`;\n\t}\n\n\toverride getActionViewItem(action: IAction, options: IActionViewItemOptions): IActionViewItem | undefined {\n\t\tif (action.id === SELECT_KERNEL_ID) {\n\t\t\t// this is being disposed by the consumer\n\t\t\treturn this._register(this._instantiationService.createInstance(NotebooKernelActionViewItem, action, this, options));\n\t\t}\n\t\treturn undefined;\n\t}\n\n\toverride getControl(): NotebookEditorWidget | undefined {\n\t\treturn this._widget.value;\n\t}\n\n\toverride setVisible(visible: boolean): void {\n\t\tsuper.setVisible(visible);\n\t\tif (!visible) {\n\t\t\tthis._widget.value?.onWillHide();\n\t\t}\n\t}\n\n\tprotected override setEditorVisible(visible: boolean): void {\n\t\tsuper.setEditorVisible(visible);\n\t\tthis._groupListener.clear();\n\t\tthis._groupListener.add(this.group.onWillCloseEditor(e => this._saveEditorViewState(e.editor)));\n\t\tthis._groupListener.add(this.group.onDidModelChange(() => {\n\t\t\tif (this._editorGroupService.activeGroup !== this.group) {\n\t\t\t\tthis._widget?.value?.updateEditorFocus();\n\t\t\t}\n\t\t}));\n\n\t\tif (!visible) {\n\t\t\tthis._saveEditorViewState(this.input);\n\t\t\tif (this.input && this._widget.value) {\n\t\t\t\t// the widget is not transfered to other editor inputs\n\t\t\t\tthis._widget.value.onWillHide();\n\t\t\t}\n\t\t}\n\t}\n\n\toverride focus() {\n\t\tsuper.focus();\n\t\tthis._widget.value?.focus();\n\t}\n\n\toverride hasFocus(): boolean {\n\t\tconst value = this._widget.value;\n\t\tif (!value) {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn !!value && (DOM.isAncestorOfActiveElement(value.getDomNode() || DOM.isAncestorOfActiveElement(value.getOverflowContainerDomNode())));\n\t}\n\n\toverride async setInput(input: NotebookEditorInput, options: INotebookEditorOptions | undefined, context: IEditorOpenContext, token: CancellationToken, noRetry?: boolean): Promise<void> {\n\t\ttry {\n\t\t\tlet perfMarksCaptured = false;\n\t\t\tconst fileOpenMonitor = timeout(10000);\n\t\t\tfileOpenMonitor.then(() => {\n\t\t\t\tperfMarksCaptured = true;\n\t\t\t\tthis._handlePerfMark(perf, input);\n\t\t\t});\n\n\t\t\tconst perf = new NotebookPerfMarks();\n\t\t\tperf.mark('startTime');\n\n\t\t\tthis._inputListener.value = input.onDidChangeCapabilities(() => this._onDidChangeInputCapabilities(input));\n\n\t\t\tthis._widgetDisposableStore.clear();\n\n\t\t\t// there currently is a widget which we still own so\n\t\t\t// we need to hide it before getting a new widget\n\t\t\tthis._widget.value?.onWillHide();\n\n\t\t\tthis._widget = <IBorrowValue<NotebookEditorWidget>>this._instantiationService.invokeFunction(this._notebookWidgetService.retrieveWidget, this.group.id, input, undefined, this._pagePosition?.dimension, this.window);\n\n\t\t\tif (this._rootElement && this._widget.value!.getDomNode()) {\n\t\t\t\tthis._rootElement.setAttribute('aria-flowto', this._widget.value!.getDomNode().id || '');\n\t\t\t\tDOM.setParentFlowTo(this._widget.value!.getDomNode(), this._rootElement);\n\t\t\t}\n\n\t\t\tthis._widgetDisposableStore.add(this._widget.value!.onDidChangeModel(() => this._onDidChangeModel.fire()));\n\t\t\tthis._widgetDisposableStore.add(this._widget.value!.onDidChangeActiveCell(() => this._onDidChangeSelection.fire({ reason: EditorPaneSelectionChangeReason.USER })));\n\n\t\t\tif (this._pagePosition) {\n\t\t\t\tthis._widget.value!.layout(this._pagePosition.dimension, this._rootElement, this._pagePosition.position);\n\t\t\t}\n\n\t\t\t// only now `setInput` and yield/await. this is AFTER the actual widget is ready. This is very important\n\t\t\t// so that others synchronously receive a notebook editor with the correct widget being set\n\t\t\tawait super.setInput(input, options, context, token);\n\t\t\tconst model = await input.resolve(options, perf);\n\t\t\tperf.mark('inputLoaded');\n\n\t\t\t// Check for cancellation\n\t\t\tif (token.isCancellationRequested) {\n\t\t\t\treturn undefined;\n\t\t\t}\n\n\t\t\t// The widget has been taken away again. This can happen when the tab has been closed while\n\t\t\t// loading was in progress, in particular when open the same resource as different view type.\n\t\t\t// When this happen, retry once\n\t\t\tif (!this._widget.value) {\n\t\t\t\tif (noRetry) {\n\t\t\t\t\treturn undefined;\n\t\t\t\t}\n\t\t\t\treturn this.setInput(input, options, context, token, true);\n\t\t\t}\n\n\t\t\tif (model === null) {\n\t\t\t\tconst knownProvider = this._notebookService.getViewTypeProvider(input.viewType);\n\n\t\t\t\tif (!knownProvider) {\n\t\t\t\t\tthrow new Error(localize('fail.noEditor', \"Cannot open resource with notebook editor type '{0}', please check if you have the right extension installed and enabled.\", input.viewType));\n\t\t\t\t}\n\n\t\t\t\tawait this._extensionsWorkbenchService.whenInitialized;\n\t\t\t\tconst extensionInfo = this._extensionsWorkbenchService.local.find(e => e.identifier.id === knownProvider);\n\n\t\t\t\tthrow createEditorOpenError(new Error(localize('fail.noEditor.extensionMissing', \"Cannot open resource with notebook editor type '{0}', please check if you have the right extension installed and enabled.\", input.viewType)), [\n\t\t\t\t\ttoAction({\n\t\t\t\t\t\tid: 'workbench.notebook.action.installOrEnableMissing', label:\n\t\t\t\t\t\t\textensionInfo\n\t\t\t\t\t\t\t\t? localize('notebookOpenEnableMissingViewType', \"Enable extension for '{0}'\", input.viewType)\n\t\t\t\t\t\t\t\t: localize('notebookOpenInstallMissingViewType', \"Install extension for '{0}'\", input.viewType)\n\t\t\t\t\t\t, run: async () => {\n\t\t\t\t\t\t\tconst d = this._notebookService.onAddViewType(viewType => {\n\t\t\t\t\t\t\t\tif (viewType === input.viewType) {\n\t\t\t\t\t\t\t\t\t// serializer is registered, try to open again\n\t\t\t\t\t\t\t\t\tthis._editorService.openEditor({ resource: input.resource });\n\t\t\t\t\t\t\t\t\td.dispose();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tconst extensionInfo = this._extensionsWorkbenchService.local.find(e => e.identifier.id === knownProvider);\n\n\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\tif (extensionInfo) {\n\t\t\t\t\t\t\t\t\tawait this._extensionsWorkbenchService.setEnablement(extensionInfo, extensionInfo.enablementState === EnablementState.DisabledWorkspace ? EnablementState.EnabledWorkspace : EnablementState.EnabledGlobally);\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tawait this._instantiationService.createInstance(InstallRecommendedExtensionAction, knownProvider).run();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} catch (ex) {\n\t\t\t\t\t\t\t\tthis.logService.error(`Failed to install or enable extension ${knownProvider}`, ex);\n\t\t\t\t\t\t\t\td.dispose();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}),\n\t\t\t\t\ttoAction({\n\t\t\t\t\t\tid: 'workbench.notebook.action.openAsText', label: localize('notebookOpenAsText', \"Open As Text\"), run: async () => {\n\t\t\t\t\t\t\tconst backup = await this._workingCopyBackupService.resolve({ resource: input.resource, typeId: NotebookWorkingCopyTypeIdentifier.create(input.viewType) });\n\t\t\t\t\t\t\tif (backup) {\n\t\t\t\t\t\t\t\t// with a backup present, we must resort to opening the backup contents\n\t\t\t\t\t\t\t\t// as untitled text file to not show the wrong data to the user\n\t\t\t\t\t\t\t\tconst contents = await streamToBuffer(backup.value);\n\t\t\t\t\t\t\t\tthis._editorService.openEditor({ resource: undefined, contents: contents.toString() });\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t// without a backup present, we can open the original resource\n\t\t\t\t\t\t\t\tthis._editorService.openEditor({ resource: input.resource, options: { override: DEFAULT_EDITOR_ASSOCIATION.id, pinned: true } });\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t], { allowDialog: true });\n\n\t\t\t}\n\n\t\t\tthis._widgetDisposableStore.add(model.notebook.onDidChangeContent(() => this._onDidChangeSelection.fire({ reason: EditorPaneSelectionChangeReason.EDIT })));\n\n\t\t\tconst viewState = options?.viewState ?? this._loadNotebookEditorViewState(input);\n\n\t\t\t// We might be moving the notebook widget between groups, and these services are tied to the group\n\t\t\tthis._widget.value.setParentContextKeyService(this._contextKeyService);\n\t\t\tthis._widget.value.setEditorProgressService(this._editorProgressService);\n\n\t\t\tawait this._widget.value.setModel(model.notebook, viewState, perf);\n\t\t\tconst isReadOnly = !!input.isReadonly();\n\t\t\tawait this._widget.value.setOptions({ ...options, isReadOnly });\n\t\t\tthis._widgetDisposableStore.add(this._widget.value.onDidFocusWidget(() => this._onDidFocusWidget.fire()));\n\t\t\tthis._widgetDisposableStore.add(this._widget.value.onDidBlurWidget(() => this._onDidBlurWidget.fire()));\n\n\t\t\tthis._widgetDisposableStore.add(this._editorGroupService.createEditorDropTarget(this._widget.value.getDomNode(), {\n\t\t\t\tcontainsGroup: (group) => this.group.id === group.id\n\t\t\t}));\n\n\t\t\tthis._widgetDisposableStore.add(this._widget.value.onDidScroll(() => { this._onDidChangeScroll.fire(); }));\n\n\t\t\tperf.mark('editorLoaded');\n\n\t\t\tfileOpenMonitor.cancel();\n\t\t\tif (perfMarksCaptured) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis._handlePerfMark(perf, input, model.notebook);\n\t\t\tthis._onDidChangeControl.fire();\n\t\t} catch (e) {\n\t\t\tthis.logService.warn('NotebookEditorWidget#setInput failed', e);\n\t\t\tif (isEditorOpenError(e)) {\n\t\t\t\tthrow e;\n\t\t\t}\n\n\t\t\t// Handle case where a file is too large to open without confirmation\n\t\t\tif ((<FileOperationError>e).fileOperationResult === FileOperationResult.FILE_TOO_LARGE) {\n\t\t\t\tlet message: string;\n\t\t\t\tif (e instanceof TooLargeFileOperationError) {\n\t\t\t\t\tmessage = localize('notebookTooLargeForHeapErrorWithSize', \"The notebook is not displayed in the notebook editor because it is very large ({0}).\", ByteSize.formatSize(e.size));\n\t\t\t\t} else {\n\t\t\t\t\tmessage = localize('notebookTooLargeForHeapErrorWithoutSize', \"The notebook is not displayed in the notebook editor because it is very large.\");\n\t\t\t\t}\n\n\t\t\t\tthrow createTooLargeFileError(this.group, input, options, message, this._preferencesService);\n\t\t\t}\n\n\t\t\tconst error = createEditorOpenError(e instanceof Error ? e : new Error((e ? e.message : '')), [\n\t\t\t\ttoAction({\n\t\t\t\t\tid: 'workbench.notebook.action.openInTextEditor', label: localize('notebookOpenInTextEditor', \"Open in Text Editor\"), run: async () => {\n\t\t\t\t\t\tconst activeEditorPane = this._editorService.activeEditorPane;\n\t\t\t\t\t\tif (!activeEditorPane) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tconst activeEditorResource = EditorResourceAccessor.getCanonicalUri(activeEditorPane.input);\n\t\t\t\t\t\tif (!activeEditorResource) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (activeEditorResource.toString() === input.resource?.toString()) {\n\t\t\t\t\t\t\t// Replace the current editor with the text editor\n\t\t\t\t\t\t\treturn this._editorService.openEditor({\n\t\t\t\t\t\t\t\tresource: activeEditorResource,\n\t\t\t\t\t\t\t\toptions: {\n\t\t\t\t\t\t\t\t\toverride: DEFAULT_EDITOR_ASSOCIATION.id,\n\t\t\t\t\t\t\t\t\tpinned: true // new file gets pinned by default\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t], { allowDialog: true });\n\n\t\t\tthrow error;\n\t\t}\n\t}\n\n\tprivate _handlePerfMark(perf: NotebookPerfMarks, input: NotebookEditorInput, notebook?: NotebookTextModel) {\n\t\tconst perfMarks = perf.value;\n\n\t\ttype WorkbenchNotebookOpenClassification = {\n\t\t\towner: 'rebornix';\n\t\t\tcomment: 'The notebook file open metrics. Used to get a better understanding of the performance of notebook file opening';\n\t\t\tscheme: { classification: 'SystemMetaData'; purpose: 'FeatureInsight'; comment: 'File system provider scheme for the notebook resource' };\n\t\t\text: { classification: 'SystemMetaData'; purpose: 'FeatureInsight'; comment: 'File extension for the notebook resource' };\n\t\t\tviewType: { classification: 'SystemMetaData'; purpose: 'FeatureInsight'; comment: 'The view type of the notebook editor' };\n\t\t\textensionActivated: { classification: 'SystemMetaData'; purpose: 'FeatureInsight'; comment: 'Extension activation time for the resource opening' };\n\t\t\tinputLoaded: { classification: 'SystemMetaData'; purpose: 'FeatureInsight'; comment: 'Editor Input loading time for the resource opening' };\n\t\t\twebviewCommLoaded: { classification: 'SystemMetaData'; purpose: 'FeatureInsight'; comment: 'Webview initialization time for the resource opening' };\n\t\t\tcustomMarkdownLoaded: { classification: 'SystemMetaData'; purpose: 'FeatureInsight'; comment: 'Custom markdown loading time for the resource opening' };\n\t\t\teditorLoaded: { classification: 'SystemMetaData'; purpose: 'FeatureInsight'; comment: 'Overall editor loading time for the resource opening' };\n\t\t\tcodeCellCount: { classification: 'SystemMetaData'; purpose: 'FeatureInsight'; comment: 'Total number of code cell' };\n\t\t\tmdCellCount: { classification: 'SystemMetaData'; purpose: 'FeatureInsight'; comment: 'Total number of markdown cell' };\n\t\t\toutputCount: { classification: 'SystemMetaData'; purpose: 'FeatureInsight'; comment: 'Total number of cell outputs' };\n\t\t\toutputBytes: { classification: 'SystemMetaData'; purpose: 'FeatureInsight'; comment: 'Total number of bytes for all outputs' };\n\t\t\tcodeLength: { classification: 'SystemMetaData'; purpose: 'FeatureInsight'; comment: 'Length of text in all code cells' };\n\t\t\tmarkdownLength: { classification: 'SystemMetaData'; purpose: 'FeatureInsight'; comment: 'Length of text in all markdown cells' };\n\t\t\tnotebookStatsLoaded: { classification: 'SystemMetaData'; purpose: 'FeatureInsight'; comment: 'Time for generating the notebook level information for telemetry' };\n\t\t};\n\n\t\ttype WorkbenchNotebookOpenEvent = {\n\t\t\tscheme: string;\n\t\t\text: string;\n\t\t\tviewType: string;\n\t\t\textensionActivated: number;\n\t\t\tinputLoaded: number;\n\t\t\twebviewCommLoaded: number;\n\t\t\tcustomMarkdownLoaded: number | undefined;\n\t\t\teditorLoaded: number;\n\t\t\tcodeCellCount: number | undefined;\n\t\t\tmdCellCount: number | undefined;\n\t\t\toutputCount: number | undefined;\n\t\t\toutputBytes: number | undefined;\n\t\t\tcodeLength: number | undefined;\n\t\t\tmarkdownLength: number | undefined;\n\t\t\tnotebookStatsLoaded: number | undefined;\n\t\t};\n\n\t\tconst startTime = perfMarks['startTime'];\n\t\tconst extensionActivated = perfMarks['extensionActivated'];\n\t\tconst inputLoaded = perfMarks['inputLoaded'];\n\t\tconst webviewCommLoaded = perfMarks['webviewCommLoaded'];\n\t\tconst customMarkdownLoaded = perfMarks['customMarkdownLoaded'];\n\t\tconst editorLoaded = perfMarks['editorLoaded'];\n\n\t\tlet extensionActivationTimespan = -1;\n\t\tlet inputLoadingTimespan = -1;\n\t\tlet webviewCommLoadingTimespan = -1;\n\t\tlet customMarkdownLoadingTimespan = -1;\n\t\tlet editorLoadingTimespan = -1;\n\n\t\tif (startTime !== undefined && extensionActivated !== undefined) {\n\t\t\textensionActivationTimespan = extensionActivated - startTime;\n\n\t\t\tif (inputLoaded !== undefined) {\n\t\t\t\tinputLoadingTimespan = inputLoaded - extensionActivated;\n\t\t\t}\n\n\t\t\tif (webviewCommLoaded !== undefined) {\n\t\t\t\twebviewCommLoadingTimespan = webviewCommLoaded - extensionActivated;\n\n\t\t\t}\n\n\t\t\tif (customMarkdownLoaded !== undefined) {\n\t\t\t\tcustomMarkdownLoadingTimespan = customMarkdownLoaded - startTime;\n\t\t\t}\n\n\t\t\tif (editorLoaded !== undefined) {\n\t\t\t\teditorLoadingTimespan = editorLoaded - startTime;\n\t\t\t}\n\t\t}\n\n\t\t// Notebook information\n\t\tlet codeCellCount: number | undefined = undefined;\n\t\tlet mdCellCount: number | undefined = undefined;\n\t\tlet outputCount: number | undefined = undefined;\n\t\tlet outputBytes: number | undefined = undefined;\n\t\tlet codeLength: number | undefined = undefined;\n\t\tlet markdownLength: number | undefined = undefined;\n\t\tlet notebookStatsLoaded: number | undefined = undefined;\n\t\tif (notebook) {\n\t\t\tconst stopWatch = new StopWatch();\n\t\t\tfor (const cell of notebook.cells) {\n\t\t\t\tif (cell.cellKind === CellKind.Code) {\n\t\t\t\t\tcodeCellCount = (codeCellCount || 0) + 1;\n\t\t\t\t\tcodeLength = (codeLength || 0) + cell.getTextLength();\n\t\t\t\t\toutputCount = (outputCount || 0) + cell.outputs.length;\n\t\t\t\t\toutputBytes = (outputBytes || 0) + cell.outputs.reduce((prev, cur) => prev + cur.outputs.reduce((size, item) => size + item.data.byteLength, 0), 0);\n\t\t\t\t} else {\n\t\t\t\t\tmdCellCount = (mdCellCount || 0) + 1;\n\t\t\t\t\tmarkdownLength = (codeLength || 0) + cell.getTextLength();\n\t\t\t\t}\n\t\t\t}\n\t\t\tnotebookStatsLoaded = stopWatch.elapsed();\n\t\t}\n\n\t\tthis.logService.trace(`[NotebookEditor] open notebook perf ${notebook?.uri.toString() ?? ''} - extensionActivation: ${extensionActivationTimespan}, inputLoad: ${inputLoadingTimespan}, webviewComm: ${webviewCommLoadingTimespan}, customMarkdown: ${customMarkdownLoadingTimespan}, editorLoad: ${editorLoadingTimespan}`);\n\n\t\tthis.telemetryService.publicLog2<WorkbenchNotebookOpenEvent, WorkbenchNotebookOpenClassification>('notebook/editorOpenPerf', {\n\t\t\tscheme: input.resource.scheme,\n\t\t\text: extname(input.resource),\n\t\t\tviewType: input.viewType,\n\t\t\textensionActivated: extensionActivationTimespan,\n\t\t\tinputLoaded: inputLoadingTimespan,\n\t\t\twebviewCommLoaded: webviewCommLoadingTimespan,\n\t\t\tcustomMarkdownLoaded: customMarkdownLoadingTimespan,\n\t\t\teditorLoaded: editorLoadingTimespan,\n\t\t\tcodeCellCount,\n\t\t\tmdCellCount,\n\t\t\toutputCount,\n\t\t\toutputBytes,\n\t\t\tcodeLength,\n\t\t\tmarkdownLength,\n\t\t\tnotebookStatsLoaded\n\t\t});\n\t}\n\n\toverride clearInput(): void {\n\t\tthis._inputListener.clear();\n\n\t\tif (this._widget.value) {\n\t\t\tthis._saveEditorViewState(this.input);\n\t\t\tthis._widget.value.onWillHide();\n\t\t}\n\t\tsuper.clearInput();\n\t}\n\n\toverride setOptions(options: INotebookEditorOptions | undefined): void {\n\t\tthis._widget.value?.setOptions(options);\n\t\tsuper.setOptions(options);\n\t}\n\n\tprotected override saveState(): void {\n\t\tthis._saveEditorViewState(this.input);\n\t\tsuper.saveState();\n\t}\n\n\toverride getViewState(): INotebookEditorViewState | undefined {\n\t\tconst input = this.input;\n\t\tif (!(input instanceof NotebookEditorInput)) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\tthis._saveEditorViewState(input);\n\t\treturn this._loadNotebookEditorViewState(input);\n\t}\n\n\tgetSelection(): IEditorPaneSelection | undefined {\n\t\tif (this._widget.value) {\n\t\t\tconst activeCell = this._widget.value.getActiveCell();\n\t\t\tif (activeCell) {\n\t\t\t\tconst cellUri = activeCell.uri;\n\t\t\t\treturn new NotebookEditorSelection(cellUri, activeCell.getSelections());\n\t\t\t}\n\t\t}\n\n\t\treturn undefined;\n\t}\n\n\tgetScrollPosition(): IEditorPaneScrollPosition {\n\t\tconst widget = this.getControl();\n\t\tif (!widget) {\n\t\t\tthrow new Error('Notebook widget has not yet been initialized');\n\t\t}\n\n\t\treturn {\n\t\t\tscrollTop: widget.scrollTop,\n\t\t\tscrollLeft: 0,\n\t\t};\n\t}\n\n\tsetScrollPosition(scrollPosition: IEditorPaneScrollPosition): void {\n\t\tconst editor = this.getControl();\n\t\tif (!editor) {\n\t\t\tthrow new Error('Control has not yet been initialized');\n\t\t}\n\n\t\teditor.setScrollTop(scrollPosition.scrollTop);\n\t}\n\n\tprivate _saveEditorViewState(input: EditorInput | undefined): void {\n\t\tif (this._widget.value && input instanceof NotebookEditorInput) {\n\t\t\tif (this._widget.value.isDisposed) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst state = this._widget.value.getEditorViewState();\n\t\t\tthis._editorMemento.saveEditorState(this.group, input.resource, state);\n\t\t}\n\t}\n\n\tprivate _loadNotebookEditorViewState(input: NotebookEditorInput): INotebookEditorViewState | undefined {\n\t\tconst result = this._editorMemento.loadEditorState(this.group, input.resource);\n\t\tif (result) {\n\t\t\treturn result;\n\t\t}\n\t\t// when we don't have a view state for the group/input-tuple then we try to use an existing\n\t\t// editor for the same resource.\n\t\tfor (const group of this._editorGroupService.getGroups(GroupsOrder.MOST_RECENTLY_ACTIVE)) {\n\t\t\tif (group.activeEditorPane !== this && group.activeEditorPane instanceof NotebookEditor && group.activeEditor?.matches(input)) {\n\t\t\t\treturn group.activeEditorPane._widget.value?.getEditorViewState();\n\t\t\t}\n\t\t}\n\t\treturn;\n\t}\n\n\tlayout(dimension: DOM.Dimension, position: DOM.IDomPosition): void {\n\t\tthis._rootElement.classList.toggle('mid-width', dimension.width < 1000 && dimension.width >= 600);\n\t\tthis._rootElement.classList.toggle('narrow-width', dimension.width < 600);\n\t\tthis._pagePosition = { dimension, position };\n\n\t\tif (!this._widget.value || !(this.input instanceof NotebookEditorInput)) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.input.resource.toString() !== this.textModel?.uri.toString() && this._widget.value?.hasModel()) {\n\t\t\t// input and widget mismatch\n\t\t\t// this happens when\n\t\t\t// 1. open document A, pin the document\n\t\t\t// 2. open document B\n\t\t\t// 3. close document B\n\t\t\t// 4. a layout is triggered\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.isVisible()) {\n\t\t\tthis._widget.value.layout(dimension, this._rootElement, position);\n\t\t}\n\t}\n\n\t//#endregion\n}\n\nclass NotebookEditorSelection implements IEditorPaneSelection {\n\n\tconstructor(\n\t\tprivate readonly cellUri: URI,\n\t\tprivate readonly selections: Selection[]\n\t) { }\n\n\tcompare(other: IEditorPaneSelection): EditorPaneSelectionCompareResult {\n\t\tif (!(other instanceof NotebookEditorSelection)) {\n\t\t\treturn EditorPaneSelectionCompareResult.DIFFERENT;\n\t\t}\n\n\t\tif (isEqual(this.cellUri, other.cellUri)) {\n\t\t\treturn EditorPaneSelectionCompareResult.IDENTICAL;\n\t\t}\n\n\t\treturn EditorPaneSelectionCompareResult.DIFFERENT;\n\t}\n\n\trestore(options: IEditorOptions): INotebookEditorOptions {\n\t\tconst notebookOptions: INotebookEditorOptions = {\n\t\t\tcellOptions: {\n\t\t\t\tresource: this.cellUri,\n\t\t\t\toptions: {\n\t\t\t\t\tselection: this.selections[0]\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\tObject.assign(notebookOptions, options);\n\n\t\treturn notebookOptions;\n\t}\n\n\tlog(): string {\n\t\treturn this.cellUri.fragment;\n\t}\n}\n\nexport function isNotebookContainingCellEditor(editor: IEditorPane | undefined, codeEditor: ICodeEditor): boolean {\n\tif (editor?.getId() === NotebookEditor.ID) {\n\t\tconst notebookWidget = editor.getControl() as NotebookEditorWidget;\n\t\tif (notebookWidget) {\n\t\t\tfor (const [_, editor] of notebookWidget.codeEditors) {\n\t\t\t\tif (editor === codeEditor) {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\treturn false;\n}\n"]}