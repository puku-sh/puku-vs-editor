{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/contrib/notebook/browser/services/notebookExecutionStateServiceImpl.ts","vs/workbench/contrib/notebook/browser/services/notebookExecutionStateServiceImpl.ts"],"names":[],"mappings":"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","file":"notebookExecutionStateServiceImpl.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Emitter } from '../../../../../base/common/event.js';\nimport { combinedDisposable, Disposable, IDisposable } from '../../../../../base/common/lifecycle.js';\nimport { ResourceMap } from '../../../../../base/common/map.js';\nimport { isEqual } from '../../../../../base/common/resources.js';\nimport { URI } from '../../../../../base/common/uri.js';\nimport { generateUuid } from '../../../../../base/common/uuid.js';\nimport { AccessibilitySignal, IAccessibilitySignalService } from '../../../../../platform/accessibilitySignal/browser/accessibilitySignalService.js';\nimport { IInstantiationService } from '../../../../../platform/instantiation/common/instantiation.js';\nimport { ILogService } from '../../../../../platform/log/common/log.js';\nimport { NotebookTextModel } from '../../common/model/notebookTextModel.js';\nimport { CellEditType, CellUri, ICellEditOperation, NotebookCellExecutionState, NotebookCellInternalMetadata, NotebookExecutionState, NotebookTextModelWillAddRemoveEvent } from '../../common/notebookCommon.js';\nimport { CellExecutionUpdateType, INotebookExecutionService } from '../../common/notebookExecutionService.js';\nimport { ICellExecuteUpdate, ICellExecutionComplete, ICellExecutionStateChangedEvent, ICellExecutionStateUpdate, IExecutionStateChangedEvent, IFailedCellInfo, INotebookCellExecution, INotebookExecution, INotebookExecutionStateService, INotebookFailStateChangedEvent, NotebookExecutionType } from '../../common/notebookExecutionStateService.js';\nimport { INotebookKernelService } from '../../common/notebookKernelService.js';\nimport { INotebookService } from '../../common/notebookService.js';\n\nexport class NotebookExecutionStateService extends Disposable implements INotebookExecutionStateService {\n\tdeclare _serviceBrand: undefined;\n\n\tprivate readonly _executions = new ResourceMap<Map<number, CellExecution>>();\n\tprivate readonly _notebookExecutions = new ResourceMap<[NotebookExecution, IDisposable]>();\n\tprivate readonly _notebookListeners = new ResourceMap<NotebookExecutionListeners>();\n\tprivate readonly _cellListeners = new ResourceMap<IDisposable>();\n\tprivate readonly _lastFailedCells = new ResourceMap<IFailedCellInfo>();\n\tprivate readonly _lastCompletedCellHandles = new ResourceMap<number>();\n\n\tprivate readonly _onDidChangeExecution = this._register(new Emitter<ICellExecutionStateChangedEvent | IExecutionStateChangedEvent>());\n\tonDidChangeExecution = this._onDidChangeExecution.event;\n\n\tprivate readonly _onDidChangeLastRunFailState = this._register(new Emitter<INotebookFailStateChangedEvent>());\n\tonDidChangeLastRunFailState = this._onDidChangeLastRunFailState.event;\n\n\tconstructor(\n\t\t@IInstantiationService private readonly _instantiationService: IInstantiationService,\n\t\t@ILogService private readonly _logService: ILogService,\n\t\t@INotebookService private readonly _notebookService: INotebookService,\n\t\t@IAccessibilitySignalService private readonly _accessibilitySignalService: IAccessibilitySignalService\n\t) {\n\t\tsuper();\n\t}\n\n\tgetLastFailedCellForNotebook(notebook: URI): number | undefined {\n\t\tconst failedCell = this._lastFailedCells.get(notebook);\n\t\treturn failedCell?.visible ? failedCell.cellHandle : undefined;\n\t}\n\n\tgetLastCompletedCellForNotebook(notebook: URI): number | undefined {\n\t\treturn this._lastCompletedCellHandles.get(notebook);\n\t}\n\n\tforceCancelNotebookExecutions(notebookUri: URI): void {\n\t\tconst notebookCellExecutions = this._executions.get(notebookUri);\n\t\tif (notebookCellExecutions) {\n\t\t\tfor (const exe of notebookCellExecutions.values()) {\n\t\t\t\tthis._onCellExecutionDidComplete(notebookUri, exe.cellHandle, exe);\n\t\t\t}\n\t\t}\n\t\tif (this._notebookExecutions.has(notebookUri)) {\n\t\t\tthis._onExecutionDidComplete(notebookUri);\n\t\t}\n\t}\n\n\tgetCellExecution(cellUri: URI): INotebookCellExecution | undefined {\n\t\tconst parsed = CellUri.parse(cellUri);\n\t\tif (!parsed) {\n\t\t\tthrow new Error(`Not a cell URI: ${cellUri}`);\n\t\t}\n\n\t\tconst exeMap = this._executions.get(parsed.notebook);\n\t\tif (exeMap) {\n\t\t\treturn exeMap.get(parsed.handle);\n\t\t}\n\n\t\treturn undefined;\n\t}\n\tgetExecution(notebook: URI): INotebookExecution | undefined {\n\t\treturn this._notebookExecutions.get(notebook)?.[0];\n\t}\n\n\tgetCellExecutionsForNotebook(notebook: URI): INotebookCellExecution[] {\n\t\tconst exeMap = this._executions.get(notebook);\n\t\treturn exeMap ? Array.from(exeMap.values()) : [];\n\t}\n\n\tgetCellExecutionsByHandleForNotebook(notebook: URI): Map<number, INotebookCellExecution> | undefined {\n\t\tconst exeMap = this._executions.get(notebook);\n\t\treturn exeMap ? new Map(exeMap.entries()) : undefined;\n\t}\n\n\tprivate _onCellExecutionDidChange(notebookUri: URI, cellHandle: number, exe: CellExecution): void {\n\t\tthis._onDidChangeExecution.fire(new NotebookCellExecutionEvent(notebookUri, cellHandle, exe));\n\t}\n\n\tprivate _onCellExecutionDidComplete(notebookUri: URI, cellHandle: number, exe: CellExecution, lastRunSuccess?: boolean): void {\n\t\tconst notebookExecutions = this._executions.get(notebookUri);\n\t\tif (!notebookExecutions) {\n\t\t\tthis._logService.debug(`NotebookExecutionStateService#_onCellExecutionDidComplete - unknown notebook ${notebookUri.toString()}`);\n\t\t\treturn;\n\t\t}\n\n\t\texe.dispose();\n\t\tconst cellUri = CellUri.generate(notebookUri, cellHandle);\n\t\tthis._cellListeners.get(cellUri)?.dispose();\n\t\tthis._cellListeners.delete(cellUri);\n\t\tnotebookExecutions.delete(cellHandle);\n\t\tif (notebookExecutions.size === 0) {\n\t\t\tthis._executions.delete(notebookUri);\n\t\t\tthis._notebookListeners.get(notebookUri)?.dispose();\n\t\t\tthis._notebookListeners.delete(notebookUri);\n\t\t}\n\n\t\tif (lastRunSuccess !== undefined) {\n\t\t\tif (lastRunSuccess) {\n\t\t\t\tif (this._executions.size === 0) {\n\t\t\t\t\tthis._accessibilitySignalService.playSignal(AccessibilitySignal.notebookCellCompleted);\n\t\t\t\t}\n\t\t\t\tthis._clearLastFailedCell(notebookUri);\n\t\t\t} else {\n\t\t\t\tthis._accessibilitySignalService.playSignal(AccessibilitySignal.notebookCellFailed);\n\t\t\t\tthis._setLastFailedCell(notebookUri, cellHandle);\n\t\t\t}\n\t\t\tthis._lastCompletedCellHandles.set(notebookUri, cellHandle);\n\t\t}\n\n\t\tthis._onDidChangeExecution.fire(new NotebookCellExecutionEvent(notebookUri, cellHandle));\n\t}\n\n\tprivate _onExecutionDidChange(notebookUri: URI, exe: NotebookExecution): void {\n\t\tthis._onDidChangeExecution.fire(new NotebookExecutionEvent(notebookUri, exe));\n\t}\n\n\tprivate _onExecutionDidComplete(notebookUri: URI): void {\n\t\tconst disposables = this._notebookExecutions.get(notebookUri);\n\t\tif (!Array.isArray(disposables)) {\n\t\t\tthis._logService.debug(`NotebookExecutionStateService#_onCellExecutionDidComplete - unknown notebook ${notebookUri.toString()}`);\n\t\t\treturn;\n\t\t}\n\n\t\tthis._notebookExecutions.delete(notebookUri);\n\t\tthis._onDidChangeExecution.fire(new NotebookExecutionEvent(notebookUri));\n\t\tdisposables.forEach(d => d.dispose());\n\t}\n\n\tcreateCellExecution(notebookUri: URI, cellHandle: number): INotebookCellExecution {\n\t\tconst notebook = this._notebookService.getNotebookTextModel(notebookUri);\n\t\tif (!notebook) {\n\t\t\tthrow new Error(`Notebook not found: ${notebookUri.toString()}`);\n\t\t}\n\n\t\tlet notebookExecutionMap = this._executions.get(notebookUri);\n\t\tif (!notebookExecutionMap) {\n\t\t\tconst listeners = this._instantiationService.createInstance(NotebookExecutionListeners, notebookUri);\n\t\t\tthis._notebookListeners.set(notebookUri, listeners);\n\n\t\t\tnotebookExecutionMap = new Map<number, CellExecution>();\n\t\t\tthis._executions.set(notebookUri, notebookExecutionMap);\n\t\t}\n\n\t\tlet exe = notebookExecutionMap.get(cellHandle);\n\t\tif (!exe) {\n\t\t\texe = this._createNotebookCellExecution(notebook, cellHandle);\n\t\t\tnotebookExecutionMap.set(cellHandle, exe);\n\t\t\texe.initialize();\n\t\t\tthis._onDidChangeExecution.fire(new NotebookCellExecutionEvent(notebookUri, cellHandle, exe));\n\t\t}\n\n\t\treturn exe;\n\t}\n\tcreateExecution(notebookUri: URI): INotebookExecution {\n\t\tconst notebook = this._notebookService.getNotebookTextModel(notebookUri);\n\t\tif (!notebook) {\n\t\t\tthrow new Error(`Notebook not found: ${notebookUri.toString()}`);\n\t\t}\n\n\t\tif (!this._notebookListeners.has(notebookUri)) {\n\t\t\tconst listeners = this._instantiationService.createInstance(NotebookExecutionListeners, notebookUri);\n\t\t\tthis._notebookListeners.set(notebookUri, listeners);\n\t\t}\n\n\t\tlet info = this._notebookExecutions.get(notebookUri);\n\t\tif (!info) {\n\t\t\tinfo = this._createNotebookExecution(notebook);\n\t\t\tthis._notebookExecutions.set(notebookUri, info);\n\t\t\tthis._onDidChangeExecution.fire(new NotebookExecutionEvent(notebookUri, info[0]));\n\t\t}\n\n\t\treturn info[0];\n\t}\n\n\tprivate _createNotebookCellExecution(notebook: NotebookTextModel, cellHandle: number): CellExecution {\n\t\tconst notebookUri = notebook.uri;\n\t\tconst exe: CellExecution = this._instantiationService.createInstance(CellExecution, cellHandle, notebook);\n\t\tconst disposable = combinedDisposable(\n\t\t\texe.onDidUpdate(() => this._onCellExecutionDidChange(notebookUri, cellHandle, exe)),\n\t\t\texe.onDidComplete(lastRunSuccess => this._onCellExecutionDidComplete(notebookUri, cellHandle, exe, lastRunSuccess)));\n\t\tthis._cellListeners.set(CellUri.generate(notebookUri, cellHandle), disposable);\n\n\t\treturn exe;\n\t}\n\n\tprivate _createNotebookExecution(notebook: NotebookTextModel): [NotebookExecution, IDisposable] {\n\t\tconst notebookUri = notebook.uri;\n\t\tconst exe: NotebookExecution = this._instantiationService.createInstance(NotebookExecution, notebook);\n\t\tconst disposable = combinedDisposable(\n\t\t\texe.onDidUpdate(() => this._onExecutionDidChange(notebookUri, exe)),\n\t\t\texe.onDidComplete(() => this._onExecutionDidComplete(notebookUri)));\n\t\treturn [exe, disposable];\n\t}\n\n\tprivate _setLastFailedCell(notebookURI: URI, cellHandle: number): void {\n\t\tconst prevLastFailedCellInfo = this._lastFailedCells.get(notebookURI);\n\t\tconst notebook = this._notebookService.getNotebookTextModel(notebookURI);\n\t\tif (!notebook) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst newLastFailedCellInfo: IFailedCellInfo = {\n\t\t\tcellHandle: cellHandle,\n\t\t\tdisposable: prevLastFailedCellInfo ? prevLastFailedCellInfo.disposable : this._getFailedCellListener(notebook),\n\t\t\tvisible: true\n\t\t};\n\n\t\tthis._lastFailedCells.set(notebookURI, newLastFailedCellInfo);\n\n\t\tthis._onDidChangeLastRunFailState.fire({ visible: true, notebook: notebookURI });\n\t}\n\n\tprivate _setLastFailedCellVisibility(notebookURI: URI, visible: boolean): void {\n\t\tconst lastFailedCellInfo = this._lastFailedCells.get(notebookURI);\n\n\t\tif (lastFailedCellInfo) {\n\t\t\tthis._lastFailedCells.set(notebookURI, {\n\t\t\t\tcellHandle: lastFailedCellInfo.cellHandle,\n\t\t\t\tdisposable: lastFailedCellInfo.disposable,\n\t\t\t\tvisible: visible,\n\t\t\t});\n\t\t}\n\n\t\tthis._onDidChangeLastRunFailState.fire({ visible: visible, notebook: notebookURI });\n\t}\n\n\tprivate _clearLastFailedCell(notebookURI: URI): void {\n\t\tconst lastFailedCellInfo = this._lastFailedCells.get(notebookURI);\n\n\t\tif (lastFailedCellInfo) {\n\t\t\tlastFailedCellInfo.disposable?.dispose();\n\t\t\tthis._lastFailedCells.delete(notebookURI);\n\t\t}\n\n\t\tthis._onDidChangeLastRunFailState.fire({ visible: false, notebook: notebookURI });\n\t}\n\n\tprivate _getFailedCellListener(notebook: NotebookTextModel): IDisposable {\n\t\treturn notebook.onWillAddRemoveCells((e: NotebookTextModelWillAddRemoveEvent) => {\n\t\t\tconst lastFailedCell = this._lastFailedCells.get(notebook.uri)?.cellHandle;\n\t\t\tif (lastFailedCell !== undefined) {\n\t\t\t\tconst lastFailedCellPos = notebook.cells.findIndex(c => c.handle === lastFailedCell);\n\t\t\t\te.rawEvent.changes.forEach(([start, deleteCount, addedCells]) => {\n\t\t\t\t\tif (deleteCount) {\n\t\t\t\t\t\tif (lastFailedCellPos >= start && lastFailedCellPos < start + deleteCount) {\n\t\t\t\t\t\t\tthis._setLastFailedCellVisibility(notebook.uri, false);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif (addedCells.some(cell => cell.handle === lastFailedCell)) {\n\t\t\t\t\t\tthis._setLastFailedCellVisibility(notebook.uri, true);\n\t\t\t\t\t}\n\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t}\n\n\toverride dispose(): void {\n\t\tsuper.dispose();\n\t\tthis._executions.forEach(executionMap => {\n\t\t\texecutionMap.forEach(execution => execution.dispose());\n\t\t\texecutionMap.clear();\n\t\t});\n\t\tthis._executions.clear();\n\t\tthis._notebookExecutions.forEach(disposables => {\n\t\t\tdisposables.forEach(d => d.dispose());\n\t\t});\n\t\tthis._notebookExecutions.clear();\n\n\t\tthis._cellListeners.forEach(disposable => disposable.dispose());\n\t\tthis._notebookListeners.forEach(disposable => disposable.dispose());\n\t\tthis._lastFailedCells.forEach(elem => elem.disposable.dispose());\n\t}\n}\n\nclass NotebookCellExecutionEvent implements ICellExecutionStateChangedEvent {\n\treadonly type = NotebookExecutionType.cell;\n\tconstructor(\n\t\treadonly notebook: URI,\n\t\treadonly cellHandle: number,\n\t\treadonly changed?: CellExecution\n\t) { }\n\n\taffectsCell(cell: URI): boolean {\n\t\tconst parsedUri = CellUri.parse(cell);\n\t\treturn !!parsedUri && isEqual(this.notebook, parsedUri.notebook) && this.cellHandle === parsedUri.handle;\n\t}\n\n\taffectsNotebook(notebook: URI): boolean {\n\t\treturn isEqual(this.notebook, notebook);\n\t}\n}\n\nclass NotebookExecutionEvent implements IExecutionStateChangedEvent {\n\treadonly type = NotebookExecutionType.notebook;\n\tconstructor(\n\t\treadonly notebook: URI,\n\t\treadonly changed?: NotebookExecution\n\t) { }\n\n\taffectsNotebook(notebook: URI): boolean {\n\t\treturn isEqual(this.notebook, notebook);\n\t}\n}\n\nclass NotebookExecutionListeners extends Disposable {\n\tprivate readonly _notebookModel: NotebookTextModel;\n\n\tconstructor(\n\t\tnotebook: URI,\n\t\t@INotebookService private readonly _notebookService: INotebookService,\n\t\t@INotebookKernelService private readonly _notebookKernelService: INotebookKernelService,\n\t\t@INotebookExecutionService private readonly _notebookExecutionService: INotebookExecutionService,\n\t\t@INotebookExecutionStateService private readonly _notebookExecutionStateService: INotebookExecutionStateService,\n\t\t@ILogService private readonly _logService: ILogService,\n\t) {\n\t\tsuper();\n\t\tthis._logService.debug(`NotebookExecution#ctor ${notebook.toString()}`);\n\n\t\tconst notebookModel = this._notebookService.getNotebookTextModel(notebook);\n\t\tif (!notebookModel) {\n\t\t\tthrow new Error('Notebook not found: ' + notebook);\n\t\t}\n\n\t\tthis._notebookModel = notebookModel;\n\t\tthis._register(this._notebookModel.onWillAddRemoveCells(e => this.onWillAddRemoveCells(e)));\n\t\tthis._register(this._notebookModel.onWillDispose(() => this.onWillDisposeDocument()));\n\t}\n\n\tprivate cancelAll(): void {\n\t\tthis._logService.debug(`NotebookExecutionListeners#cancelAll`);\n\t\tconst exes = this._notebookExecutionStateService.getCellExecutionsForNotebook(this._notebookModel.uri);\n\t\tthis._notebookExecutionService.cancelNotebookCellHandles(this._notebookModel, exes.map(exe => exe.cellHandle));\n\t}\n\n\tprivate onWillDisposeDocument(): void {\n\t\tthis._logService.debug(`NotebookExecution#onWillDisposeDocument`);\n\t\tthis.cancelAll();\n\t}\n\n\tprivate onWillAddRemoveCells(e: NotebookTextModelWillAddRemoveEvent): void {\n\t\tconst notebookExes = this._notebookExecutionStateService.getCellExecutionsByHandleForNotebook(this._notebookModel.uri);\n\n\t\tconst executingDeletedHandles = new Set<number>();\n\t\tconst pendingDeletedHandles = new Set<number>();\n\t\tif (notebookExes) {\n\t\t\te.rawEvent.changes.forEach(([start, deleteCount]) => {\n\t\t\t\tif (deleteCount) {\n\t\t\t\t\tconst deletedHandles = this._notebookModel.cells.slice(start, start + deleteCount).map(c => c.handle);\n\t\t\t\t\tdeletedHandles.forEach(h => {\n\t\t\t\t\t\tconst exe = notebookExes.get(h);\n\t\t\t\t\t\tif (exe?.state === NotebookCellExecutionState.Executing) {\n\t\t\t\t\t\t\texecutingDeletedHandles.add(h);\n\t\t\t\t\t\t} else if (exe) {\n\t\t\t\t\t\t\tpendingDeletedHandles.add(h);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tif (executingDeletedHandles.size || pendingDeletedHandles.size) {\n\t\t\tconst kernel = this._notebookKernelService.getSelectedOrSuggestedKernel(this._notebookModel);\n\t\t\tif (kernel) {\n\t\t\t\tconst implementsInterrupt = kernel.implementsInterrupt;\n\t\t\t\tconst handlesToCancel = implementsInterrupt ? [...executingDeletedHandles] : [...executingDeletedHandles, ...pendingDeletedHandles];\n\t\t\t\tthis._logService.debug(`NotebookExecution#onWillAddRemoveCells, ${JSON.stringify([...handlesToCancel])}`);\n\t\t\t\tif (handlesToCancel.length) {\n\t\t\t\t\tkernel.cancelNotebookCellExecution(this._notebookModel.uri, handlesToCancel);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n}\n\nfunction updateToEdit(update: ICellExecuteUpdate, cellHandle: number): ICellEditOperation {\n\tif (update.editType === CellExecutionUpdateType.Output) {\n\t\treturn {\n\t\t\teditType: CellEditType.Output,\n\t\t\thandle: update.cellHandle,\n\t\t\tappend: update.append,\n\t\t\toutputs: update.outputs,\n\t\t};\n\t} else if (update.editType === CellExecutionUpdateType.OutputItems) {\n\t\treturn {\n\t\t\teditType: CellEditType.OutputItems,\n\t\t\titems: update.items,\n\t\t\tappend: update.append,\n\t\t\toutputId: update.outputId\n\t\t};\n\t} else if (update.editType === CellExecutionUpdateType.ExecutionState) {\n\t\tconst newInternalMetadata: Partial<NotebookCellInternalMetadata> = {};\n\t\tif (typeof update.executionOrder !== 'undefined') {\n\t\t\tnewInternalMetadata.executionOrder = update.executionOrder;\n\t\t}\n\t\tif (typeof update.runStartTime !== 'undefined') {\n\t\t\tnewInternalMetadata.runStartTime = update.runStartTime;\n\t\t}\n\t\treturn {\n\t\t\teditType: CellEditType.PartialInternalMetadata,\n\t\t\thandle: cellHandle,\n\t\t\tinternalMetadata: newInternalMetadata\n\t\t};\n\t}\n\n\tthrow new Error('Unknown cell update type');\n}\n\nclass CellExecution extends Disposable implements INotebookCellExecution {\n\tprivate readonly _onDidUpdate = this._register(new Emitter<void>());\n\treadonly onDidUpdate = this._onDidUpdate.event;\n\n\tprivate readonly _onDidComplete = this._register(new Emitter<boolean | undefined>());\n\treadonly onDidComplete = this._onDidComplete.event;\n\n\tprivate _state: NotebookCellExecutionState = NotebookCellExecutionState.Unconfirmed;\n\tget state() {\n\t\treturn this._state;\n\t}\n\n\tget notebook(): URI {\n\t\treturn this._notebookModel.uri;\n\t}\n\n\tprivate _didPause = false;\n\tget didPause() {\n\t\treturn this._didPause;\n\t}\n\n\tprivate _isPaused = false;\n\tget isPaused() {\n\t\treturn this._isPaused;\n\t}\n\n\tconstructor(\n\t\treadonly cellHandle: number,\n\t\tprivate readonly _notebookModel: NotebookTextModel,\n\t\t@ILogService private readonly _logService: ILogService,\n\t) {\n\t\tsuper();\n\t\tthis._logService.debug(`CellExecution#ctor ${this.getCellLog()}`);\n\t}\n\n\tinitialize() {\n\t\tconst startExecuteEdit: ICellEditOperation = {\n\t\t\teditType: CellEditType.PartialInternalMetadata,\n\t\t\thandle: this.cellHandle,\n\t\t\tinternalMetadata: {\n\t\t\t\texecutionId: generateUuid(),\n\t\t\t\trunStartTime: null,\n\t\t\t\trunEndTime: null,\n\t\t\t\tlastRunSuccess: null,\n\t\t\t\texecutionOrder: null,\n\t\t\t\trenderDuration: null,\n\t\t\t}\n\t\t};\n\t\tthis._applyExecutionEdits([startExecuteEdit]);\n\t}\n\n\tprivate getCellLog(): string {\n\t\treturn `${this._notebookModel.uri.toString()}, ${this.cellHandle}`;\n\t}\n\n\tprivate logUpdates(updates: ICellExecuteUpdate[]): void {\n\t\tconst updateTypes = updates.map(u => CellExecutionUpdateType[u.editType]).join(', ');\n\t\tthis._logService.debug(`CellExecution#updateExecution ${this.getCellLog()}, [${updateTypes}]`);\n\t}\n\n\tconfirm() {\n\t\tthis._logService.debug(`CellExecution#confirm ${this.getCellLog()}`);\n\t\tthis._state = NotebookCellExecutionState.Pending;\n\t\tthis._onDidUpdate.fire();\n\t}\n\n\tupdate(updates: ICellExecuteUpdate[]): void {\n\t\tthis.logUpdates(updates);\n\t\tif (updates.some(u => u.editType === CellExecutionUpdateType.ExecutionState)) {\n\t\t\tthis._state = NotebookCellExecutionState.Executing;\n\t\t}\n\n\t\tif (!this._didPause && updates.some(u => u.editType === CellExecutionUpdateType.ExecutionState && u.didPause)) {\n\t\t\tthis._didPause = true;\n\t\t}\n\n\t\tconst lastIsPausedUpdate = [...updates].reverse().find(u => u.editType === CellExecutionUpdateType.ExecutionState && typeof u.isPaused === 'boolean');\n\t\tif (lastIsPausedUpdate) {\n\t\t\tthis._isPaused = (lastIsPausedUpdate as ICellExecutionStateUpdate).isPaused!;\n\t\t}\n\n\t\tconst cellModel = this._notebookModel.cells.find(c => c.handle === this.cellHandle);\n\t\tif (!cellModel) {\n\t\t\tthis._logService.debug(`CellExecution#update, updating cell not in notebook: ${this._notebookModel.uri.toString()}, ${this.cellHandle}`);\n\t\t} else {\n\t\t\tconst edits = updates.map(update => updateToEdit(update, this.cellHandle));\n\t\t\tthis._applyExecutionEdits(edits);\n\t\t}\n\n\t\tif (updates.some(u => u.editType === CellExecutionUpdateType.ExecutionState)) {\n\t\t\tthis._onDidUpdate.fire();\n\t\t}\n\t}\n\n\tcomplete(completionData: ICellExecutionComplete): void {\n\t\tconst cellModel = this._notebookModel.cells.find(c => c.handle === this.cellHandle);\n\t\tif (!cellModel) {\n\t\t\tthis._logService.debug(`CellExecution#complete, completing cell not in notebook: ${this._notebookModel.uri.toString()}, ${this.cellHandle}`);\n\t\t} else {\n\t\t\tconst edit: ICellEditOperation = {\n\t\t\t\teditType: CellEditType.PartialInternalMetadata,\n\t\t\t\thandle: this.cellHandle,\n\t\t\t\tinternalMetadata: {\n\t\t\t\t\tlastRunSuccess: completionData.lastRunSuccess,\n\t\t\t\t\trunStartTime: this._didPause ? null : cellModel.internalMetadata.runStartTime,\n\t\t\t\t\trunEndTime: this._didPause ? null : completionData.runEndTime,\n\t\t\t\t\terror: completionData.error\n\t\t\t\t}\n\t\t\t};\n\t\t\tthis._applyExecutionEdits([edit]);\n\t\t}\n\n\t\tthis._onDidComplete.fire(completionData.lastRunSuccess);\n\t}\n\n\tprivate _applyExecutionEdits(edits: ICellEditOperation[]): void {\n\t\tthis._notebookModel.applyEdits(edits, true, undefined, () => undefined, undefined, false);\n\t}\n}\n\nclass NotebookExecution extends Disposable implements INotebookExecution {\n\tprivate readonly _onDidUpdate = this._register(new Emitter<void>());\n\treadonly onDidUpdate = this._onDidUpdate.event;\n\n\tprivate readonly _onDidComplete = this._register(new Emitter<void>());\n\treadonly onDidComplete = this._onDidComplete.event;\n\n\tprivate _state: NotebookExecutionState = NotebookExecutionState.Unconfirmed;\n\tget state() {\n\t\treturn this._state;\n\t}\n\n\tget notebook(): URI {\n\t\treturn this._notebookModel.uri;\n\t}\n\n\tconstructor(\n\t\tprivate readonly _notebookModel: NotebookTextModel,\n\t\t@ILogService private readonly _logService: ILogService,\n\t) {\n\t\tsuper();\n\t\tthis._logService.debug(`NotebookExecution#ctor`);\n\t}\n\tprivate debug(message: string) {\n\t\tthis._logService.debug(`${message} ${this._notebookModel.uri.toString()}`);\n\t}\n\n\tconfirm() {\n\t\tthis.debug(`Execution#confirm`);\n\t\tthis._state = NotebookExecutionState.Pending;\n\t\tthis._onDidUpdate.fire();\n\t}\n\n\tbegin(): void {\n\t\tthis.debug(`Execution#begin`);\n\t\tthis._state = NotebookExecutionState.Executing;\n\t\tthis._onDidUpdate.fire();\n\t}\n\n\tcomplete(): void {\n\t\tthis.debug(`Execution#begin`);\n\t\tthis._state = NotebookExecutionState.Unconfirmed;\n\t\tthis._onDidComplete.fire();\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Emitter } from '../../../../../base/common/event.js';\nimport { combinedDisposable, Disposable, IDisposable } from '../../../../../base/common/lifecycle.js';\nimport { ResourceMap } from '../../../../../base/common/map.js';\nimport { isEqual } from '../../../../../base/common/resources.js';\nimport { URI } from '../../../../../base/common/uri.js';\nimport { generateUuid } from '../../../../../base/common/uuid.js';\nimport { AccessibilitySignal, IAccessibilitySignalService } from '../../../../../platform/accessibilitySignal/browser/accessibilitySignalService.js';\nimport { IInstantiationService } from '../../../../../platform/instantiation/common/instantiation.js';\nimport { ILogService } from '../../../../../platform/log/common/log.js';\nimport { NotebookTextModel } from '../../common/model/notebookTextModel.js';\nimport { CellEditType, CellUri, ICellEditOperation, NotebookCellExecutionState, NotebookCellInternalMetadata, NotebookExecutionState, NotebookTextModelWillAddRemoveEvent } from '../../common/notebookCommon.js';\nimport { CellExecutionUpdateType, INotebookExecutionService } from '../../common/notebookExecutionService.js';\nimport { ICellExecuteUpdate, ICellExecutionComplete, ICellExecutionStateChangedEvent, ICellExecutionStateUpdate, IExecutionStateChangedEvent, IFailedCellInfo, INotebookCellExecution, INotebookExecution, INotebookExecutionStateService, INotebookFailStateChangedEvent, NotebookExecutionType } from '../../common/notebookExecutionStateService.js';\nimport { INotebookKernelService } from '../../common/notebookKernelService.js';\nimport { INotebookService } from '../../common/notebookService.js';\n\nexport class NotebookExecutionStateService extends Disposable implements INotebookExecutionStateService {\n\tdeclare _serviceBrand: undefined;\n\n\tprivate readonly _executions = new ResourceMap<Map<number, CellExecution>>();\n\tprivate readonly _notebookExecutions = new ResourceMap<[NotebookExecution, IDisposable]>();\n\tprivate readonly _notebookListeners = new ResourceMap<NotebookExecutionListeners>();\n\tprivate readonly _cellListeners = new ResourceMap<IDisposable>();\n\tprivate readonly _lastFailedCells = new ResourceMap<IFailedCellInfo>();\n\tprivate readonly _lastCompletedCellHandles = new ResourceMap<number>();\n\n\tprivate readonly _onDidChangeExecution = this._register(new Emitter<ICellExecutionStateChangedEvent | IExecutionStateChangedEvent>());\n\tonDidChangeExecution = this._onDidChangeExecution.event;\n\n\tprivate readonly _onDidChangeLastRunFailState = this._register(new Emitter<INotebookFailStateChangedEvent>());\n\tonDidChangeLastRunFailState = this._onDidChangeLastRunFailState.event;\n\n\tconstructor(\n\t\t@IInstantiationService private readonly _instantiationService: IInstantiationService,\n\t\t@ILogService private readonly _logService: ILogService,\n\t\t@INotebookService private readonly _notebookService: INotebookService,\n\t\t@IAccessibilitySignalService private readonly _accessibilitySignalService: IAccessibilitySignalService\n\t) {\n\t\tsuper();\n\t}\n\n\tgetLastFailedCellForNotebook(notebook: URI): number | undefined {\n\t\tconst failedCell = this._lastFailedCells.get(notebook);\n\t\treturn failedCell?.visible ? failedCell.cellHandle : undefined;\n\t}\n\n\tgetLastCompletedCellForNotebook(notebook: URI): number | undefined {\n\t\treturn this._lastCompletedCellHandles.get(notebook);\n\t}\n\n\tforceCancelNotebookExecutions(notebookUri: URI): void {\n\t\tconst notebookCellExecutions = this._executions.get(notebookUri);\n\t\tif (notebookCellExecutions) {\n\t\t\tfor (const exe of notebookCellExecutions.values()) {\n\t\t\t\tthis._onCellExecutionDidComplete(notebookUri, exe.cellHandle, exe);\n\t\t\t}\n\t\t}\n\t\tif (this._notebookExecutions.has(notebookUri)) {\n\t\t\tthis._onExecutionDidComplete(notebookUri);\n\t\t}\n\t}\n\n\tgetCellExecution(cellUri: URI): INotebookCellExecution | undefined {\n\t\tconst parsed = CellUri.parse(cellUri);\n\t\tif (!parsed) {\n\t\t\tthrow new Error(`Not a cell URI: ${cellUri}`);\n\t\t}\n\n\t\tconst exeMap = this._executions.get(parsed.notebook);\n\t\tif (exeMap) {\n\t\t\treturn exeMap.get(parsed.handle);\n\t\t}\n\n\t\treturn undefined;\n\t}\n\tgetExecution(notebook: URI): INotebookExecution | undefined {\n\t\treturn this._notebookExecutions.get(notebook)?.[0];\n\t}\n\n\tgetCellExecutionsForNotebook(notebook: URI): INotebookCellExecution[] {\n\t\tconst exeMap = this._executions.get(notebook);\n\t\treturn exeMap ? Array.from(exeMap.values()) : [];\n\t}\n\n\tgetCellExecutionsByHandleForNotebook(notebook: URI): Map<number, INotebookCellExecution> | undefined {\n\t\tconst exeMap = this._executions.get(notebook);\n\t\treturn exeMap ? new Map(exeMap.entries()) : undefined;\n\t}\n\n\tprivate _onCellExecutionDidChange(notebookUri: URI, cellHandle: number, exe: CellExecution): void {\n\t\tthis._onDidChangeExecution.fire(new NotebookCellExecutionEvent(notebookUri, cellHandle, exe));\n\t}\n\n\tprivate _onCellExecutionDidComplete(notebookUri: URI, cellHandle: number, exe: CellExecution, lastRunSuccess?: boolean): void {\n\t\tconst notebookExecutions = this._executions.get(notebookUri);\n\t\tif (!notebookExecutions) {\n\t\t\tthis._logService.debug(`NotebookExecutionStateService#_onCellExecutionDidComplete - unknown notebook ${notebookUri.toString()}`);\n\t\t\treturn;\n\t\t}\n\n\t\texe.dispose();\n\t\tconst cellUri = CellUri.generate(notebookUri, cellHandle);\n\t\tthis._cellListeners.get(cellUri)?.dispose();\n\t\tthis._cellListeners.delete(cellUri);\n\t\tnotebookExecutions.delete(cellHandle);\n\t\tif (notebookExecutions.size === 0) {\n\t\t\tthis._executions.delete(notebookUri);\n\t\t\tthis._notebookListeners.get(notebookUri)?.dispose();\n\t\t\tthis._notebookListeners.delete(notebookUri);\n\t\t}\n\n\t\tif (lastRunSuccess !== undefined) {\n\t\t\tif (lastRunSuccess) {\n\t\t\t\tif (this._executions.size === 0) {\n\t\t\t\t\tthis._accessibilitySignalService.playSignal(AccessibilitySignal.notebookCellCompleted);\n\t\t\t\t}\n\t\t\t\tthis._clearLastFailedCell(notebookUri);\n\t\t\t} else {\n\t\t\t\tthis._accessibilitySignalService.playSignal(AccessibilitySignal.notebookCellFailed);\n\t\t\t\tthis._setLastFailedCell(notebookUri, cellHandle);\n\t\t\t}\n\t\t\tthis._lastCompletedCellHandles.set(notebookUri, cellHandle);\n\t\t}\n\n\t\tthis._onDidChangeExecution.fire(new NotebookCellExecutionEvent(notebookUri, cellHandle));\n\t}\n\n\tprivate _onExecutionDidChange(notebookUri: URI, exe: NotebookExecution): void {\n\t\tthis._onDidChangeExecution.fire(new NotebookExecutionEvent(notebookUri, exe));\n\t}\n\n\tprivate _onExecutionDidComplete(notebookUri: URI): void {\n\t\tconst disposables = this._notebookExecutions.get(notebookUri);\n\t\tif (!Array.isArray(disposables)) {\n\t\t\tthis._logService.debug(`NotebookExecutionStateService#_onCellExecutionDidComplete - unknown notebook ${notebookUri.toString()}`);\n\t\t\treturn;\n\t\t}\n\n\t\tthis._notebookExecutions.delete(notebookUri);\n\t\tthis._onDidChangeExecution.fire(new NotebookExecutionEvent(notebookUri));\n\t\tdisposables.forEach(d => d.dispose());\n\t}\n\n\tcreateCellExecution(notebookUri: URI, cellHandle: number): INotebookCellExecution {\n\t\tconst notebook = this._notebookService.getNotebookTextModel(notebookUri);\n\t\tif (!notebook) {\n\t\t\tthrow new Error(`Notebook not found: ${notebookUri.toString()}`);\n\t\t}\n\n\t\tlet notebookExecutionMap = this._executions.get(notebookUri);\n\t\tif (!notebookExecutionMap) {\n\t\t\tconst listeners = this._instantiationService.createInstance(NotebookExecutionListeners, notebookUri);\n\t\t\tthis._notebookListeners.set(notebookUri, listeners);\n\n\t\t\tnotebookExecutionMap = new Map<number, CellExecution>();\n\t\t\tthis._executions.set(notebookUri, notebookExecutionMap);\n\t\t}\n\n\t\tlet exe = notebookExecutionMap.get(cellHandle);\n\t\tif (!exe) {\n\t\t\texe = this._createNotebookCellExecution(notebook, cellHandle);\n\t\t\tnotebookExecutionMap.set(cellHandle, exe);\n\t\t\texe.initialize();\n\t\t\tthis._onDidChangeExecution.fire(new NotebookCellExecutionEvent(notebookUri, cellHandle, exe));\n\t\t}\n\n\t\treturn exe;\n\t}\n\tcreateExecution(notebookUri: URI): INotebookExecution {\n\t\tconst notebook = this._notebookService.getNotebookTextModel(notebookUri);\n\t\tif (!notebook) {\n\t\t\tthrow new Error(`Notebook not found: ${notebookUri.toString()}`);\n\t\t}\n\n\t\tif (!this._notebookListeners.has(notebookUri)) {\n\t\t\tconst listeners = this._instantiationService.createInstance(NotebookExecutionListeners, notebookUri);\n\t\t\tthis._notebookListeners.set(notebookUri, listeners);\n\t\t}\n\n\t\tlet info = this._notebookExecutions.get(notebookUri);\n\t\tif (!info) {\n\t\t\tinfo = this._createNotebookExecution(notebook);\n\t\t\tthis._notebookExecutions.set(notebookUri, info);\n\t\t\tthis._onDidChangeExecution.fire(new NotebookExecutionEvent(notebookUri, info[0]));\n\t\t}\n\n\t\treturn info[0];\n\t}\n\n\tprivate _createNotebookCellExecution(notebook: NotebookTextModel, cellHandle: number): CellExecution {\n\t\tconst notebookUri = notebook.uri;\n\t\tconst exe: CellExecution = this._instantiationService.createInstance(CellExecution, cellHandle, notebook);\n\t\tconst disposable = combinedDisposable(\n\t\t\texe.onDidUpdate(() => this._onCellExecutionDidChange(notebookUri, cellHandle, exe)),\n\t\t\texe.onDidComplete(lastRunSuccess => this._onCellExecutionDidComplete(notebookUri, cellHandle, exe, lastRunSuccess)));\n\t\tthis._cellListeners.set(CellUri.generate(notebookUri, cellHandle), disposable);\n\n\t\treturn exe;\n\t}\n\n\tprivate _createNotebookExecution(notebook: NotebookTextModel): [NotebookExecution, IDisposable] {\n\t\tconst notebookUri = notebook.uri;\n\t\tconst exe: NotebookExecution = this._instantiationService.createInstance(NotebookExecution, notebook);\n\t\tconst disposable = combinedDisposable(\n\t\t\texe.onDidUpdate(() => this._onExecutionDidChange(notebookUri, exe)),\n\t\t\texe.onDidComplete(() => this._onExecutionDidComplete(notebookUri)));\n\t\treturn [exe, disposable];\n\t}\n\n\tprivate _setLastFailedCell(notebookURI: URI, cellHandle: number): void {\n\t\tconst prevLastFailedCellInfo = this._lastFailedCells.get(notebookURI);\n\t\tconst notebook = this._notebookService.getNotebookTextModel(notebookURI);\n\t\tif (!notebook) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst newLastFailedCellInfo: IFailedCellInfo = {\n\t\t\tcellHandle: cellHandle,\n\t\t\tdisposable: prevLastFailedCellInfo ? prevLastFailedCellInfo.disposable : this._getFailedCellListener(notebook),\n\t\t\tvisible: true\n\t\t};\n\n\t\tthis._lastFailedCells.set(notebookURI, newLastFailedCellInfo);\n\n\t\tthis._onDidChangeLastRunFailState.fire({ visible: true, notebook: notebookURI });\n\t}\n\n\tprivate _setLastFailedCellVisibility(notebookURI: URI, visible: boolean): void {\n\t\tconst lastFailedCellInfo = this._lastFailedCells.get(notebookURI);\n\n\t\tif (lastFailedCellInfo) {\n\t\t\tthis._lastFailedCells.set(notebookURI, {\n\t\t\t\tcellHandle: lastFailedCellInfo.cellHandle,\n\t\t\t\tdisposable: lastFailedCellInfo.disposable,\n\t\t\t\tvisible: visible,\n\t\t\t});\n\t\t}\n\n\t\tthis._onDidChangeLastRunFailState.fire({ visible: visible, notebook: notebookURI });\n\t}\n\n\tprivate _clearLastFailedCell(notebookURI: URI): void {\n\t\tconst lastFailedCellInfo = this._lastFailedCells.get(notebookURI);\n\n\t\tif (lastFailedCellInfo) {\n\t\t\tlastFailedCellInfo.disposable?.dispose();\n\t\t\tthis._lastFailedCells.delete(notebookURI);\n\t\t}\n\n\t\tthis._onDidChangeLastRunFailState.fire({ visible: false, notebook: notebookURI });\n\t}\n\n\tprivate _getFailedCellListener(notebook: NotebookTextModel): IDisposable {\n\t\treturn notebook.onWillAddRemoveCells((e: NotebookTextModelWillAddRemoveEvent) => {\n\t\t\tconst lastFailedCell = this._lastFailedCells.get(notebook.uri)?.cellHandle;\n\t\t\tif (lastFailedCell !== undefined) {\n\t\t\t\tconst lastFailedCellPos = notebook.cells.findIndex(c => c.handle === lastFailedCell);\n\t\t\t\te.rawEvent.changes.forEach(([start, deleteCount, addedCells]) => {\n\t\t\t\t\tif (deleteCount) {\n\t\t\t\t\t\tif (lastFailedCellPos >= start && lastFailedCellPos < start + deleteCount) {\n\t\t\t\t\t\t\tthis._setLastFailedCellVisibility(notebook.uri, false);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif (addedCells.some(cell => cell.handle === lastFailedCell)) {\n\t\t\t\t\t\tthis._setLastFailedCellVisibility(notebook.uri, true);\n\t\t\t\t\t}\n\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t}\n\n\toverride dispose(): void {\n\t\tsuper.dispose();\n\t\tthis._executions.forEach(executionMap => {\n\t\t\texecutionMap.forEach(execution => execution.dispose());\n\t\t\texecutionMap.clear();\n\t\t});\n\t\tthis._executions.clear();\n\t\tthis._notebookExecutions.forEach(disposables => {\n\t\t\tdisposables.forEach(d => d.dispose());\n\t\t});\n\t\tthis._notebookExecutions.clear();\n\n\t\tthis._cellListeners.forEach(disposable => disposable.dispose());\n\t\tthis._notebookListeners.forEach(disposable => disposable.dispose());\n\t\tthis._lastFailedCells.forEach(elem => elem.disposable.dispose());\n\t}\n}\n\nclass NotebookCellExecutionEvent implements ICellExecutionStateChangedEvent {\n\treadonly type = NotebookExecutionType.cell;\n\tconstructor(\n\t\treadonly notebook: URI,\n\t\treadonly cellHandle: number,\n\t\treadonly changed?: CellExecution\n\t) { }\n\n\taffectsCell(cell: URI): boolean {\n\t\tconst parsedUri = CellUri.parse(cell);\n\t\treturn !!parsedUri && isEqual(this.notebook, parsedUri.notebook) && this.cellHandle === parsedUri.handle;\n\t}\n\n\taffectsNotebook(notebook: URI): boolean {\n\t\treturn isEqual(this.notebook, notebook);\n\t}\n}\n\nclass NotebookExecutionEvent implements IExecutionStateChangedEvent {\n\treadonly type = NotebookExecutionType.notebook;\n\tconstructor(\n\t\treadonly notebook: URI,\n\t\treadonly changed?: NotebookExecution\n\t) { }\n\n\taffectsNotebook(notebook: URI): boolean {\n\t\treturn isEqual(this.notebook, notebook);\n\t}\n}\n\nclass NotebookExecutionListeners extends Disposable {\n\tprivate readonly _notebookModel: NotebookTextModel;\n\n\tconstructor(\n\t\tnotebook: URI,\n\t\t@INotebookService private readonly _notebookService: INotebookService,\n\t\t@INotebookKernelService private readonly _notebookKernelService: INotebookKernelService,\n\t\t@INotebookExecutionService private readonly _notebookExecutionService: INotebookExecutionService,\n\t\t@INotebookExecutionStateService private readonly _notebookExecutionStateService: INotebookExecutionStateService,\n\t\t@ILogService private readonly _logService: ILogService,\n\t) {\n\t\tsuper();\n\t\tthis._logService.debug(`NotebookExecution#ctor ${notebook.toString()}`);\n\n\t\tconst notebookModel = this._notebookService.getNotebookTextModel(notebook);\n\t\tif (!notebookModel) {\n\t\t\tthrow new Error('Notebook not found: ' + notebook);\n\t\t}\n\n\t\tthis._notebookModel = notebookModel;\n\t\tthis._register(this._notebookModel.onWillAddRemoveCells(e => this.onWillAddRemoveCells(e)));\n\t\tthis._register(this._notebookModel.onWillDispose(() => this.onWillDisposeDocument()));\n\t}\n\n\tprivate cancelAll(): void {\n\t\tthis._logService.debug(`NotebookExecutionListeners#cancelAll`);\n\t\tconst exes = this._notebookExecutionStateService.getCellExecutionsForNotebook(this._notebookModel.uri);\n\t\tthis._notebookExecutionService.cancelNotebookCellHandles(this._notebookModel, exes.map(exe => exe.cellHandle));\n\t}\n\n\tprivate onWillDisposeDocument(): void {\n\t\tthis._logService.debug(`NotebookExecution#onWillDisposeDocument`);\n\t\tthis.cancelAll();\n\t}\n\n\tprivate onWillAddRemoveCells(e: NotebookTextModelWillAddRemoveEvent): void {\n\t\tconst notebookExes = this._notebookExecutionStateService.getCellExecutionsByHandleForNotebook(this._notebookModel.uri);\n\n\t\tconst executingDeletedHandles = new Set<number>();\n\t\tconst pendingDeletedHandles = new Set<number>();\n\t\tif (notebookExes) {\n\t\t\te.rawEvent.changes.forEach(([start, deleteCount]) => {\n\t\t\t\tif (deleteCount) {\n\t\t\t\t\tconst deletedHandles = this._notebookModel.cells.slice(start, start + deleteCount).map(c => c.handle);\n\t\t\t\t\tdeletedHandles.forEach(h => {\n\t\t\t\t\t\tconst exe = notebookExes.get(h);\n\t\t\t\t\t\tif (exe?.state === NotebookCellExecutionState.Executing) {\n\t\t\t\t\t\t\texecutingDeletedHandles.add(h);\n\t\t\t\t\t\t} else if (exe) {\n\t\t\t\t\t\t\tpendingDeletedHandles.add(h);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tif (executingDeletedHandles.size || pendingDeletedHandles.size) {\n\t\t\tconst kernel = this._notebookKernelService.getSelectedOrSuggestedKernel(this._notebookModel);\n\t\t\tif (kernel) {\n\t\t\t\tconst implementsInterrupt = kernel.implementsInterrupt;\n\t\t\t\tconst handlesToCancel = implementsInterrupt ? [...executingDeletedHandles] : [...executingDeletedHandles, ...pendingDeletedHandles];\n\t\t\t\tthis._logService.debug(`NotebookExecution#onWillAddRemoveCells, ${JSON.stringify([...handlesToCancel])}`);\n\t\t\t\tif (handlesToCancel.length) {\n\t\t\t\t\tkernel.cancelNotebookCellExecution(this._notebookModel.uri, handlesToCancel);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n}\n\nfunction updateToEdit(update: ICellExecuteUpdate, cellHandle: number): ICellEditOperation {\n\tif (update.editType === CellExecutionUpdateType.Output) {\n\t\treturn {\n\t\t\teditType: CellEditType.Output,\n\t\t\thandle: update.cellHandle,\n\t\t\tappend: update.append,\n\t\t\toutputs: update.outputs,\n\t\t};\n\t} else if (update.editType === CellExecutionUpdateType.OutputItems) {\n\t\treturn {\n\t\t\teditType: CellEditType.OutputItems,\n\t\t\titems: update.items,\n\t\t\tappend: update.append,\n\t\t\toutputId: update.outputId\n\t\t};\n\t} else if (update.editType === CellExecutionUpdateType.ExecutionState) {\n\t\tconst newInternalMetadata: Partial<NotebookCellInternalMetadata> = {};\n\t\tif (typeof update.executionOrder !== 'undefined') {\n\t\t\tnewInternalMetadata.executionOrder = update.executionOrder;\n\t\t}\n\t\tif (typeof update.runStartTime !== 'undefined') {\n\t\t\tnewInternalMetadata.runStartTime = update.runStartTime;\n\t\t}\n\t\treturn {\n\t\t\teditType: CellEditType.PartialInternalMetadata,\n\t\t\thandle: cellHandle,\n\t\t\tinternalMetadata: newInternalMetadata\n\t\t};\n\t}\n\n\tthrow new Error('Unknown cell update type');\n}\n\nclass CellExecution extends Disposable implements INotebookCellExecution {\n\tprivate readonly _onDidUpdate = this._register(new Emitter<void>());\n\treadonly onDidUpdate = this._onDidUpdate.event;\n\n\tprivate readonly _onDidComplete = this._register(new Emitter<boolean | undefined>());\n\treadonly onDidComplete = this._onDidComplete.event;\n\n\tprivate _state: NotebookCellExecutionState = NotebookCellExecutionState.Unconfirmed;\n\tget state() {\n\t\treturn this._state;\n\t}\n\n\tget notebook(): URI {\n\t\treturn this._notebookModel.uri;\n\t}\n\n\tprivate _didPause = false;\n\tget didPause() {\n\t\treturn this._didPause;\n\t}\n\n\tprivate _isPaused = false;\n\tget isPaused() {\n\t\treturn this._isPaused;\n\t}\n\n\tconstructor(\n\t\treadonly cellHandle: number,\n\t\tprivate readonly _notebookModel: NotebookTextModel,\n\t\t@ILogService private readonly _logService: ILogService,\n\t) {\n\t\tsuper();\n\t\tthis._logService.debug(`CellExecution#ctor ${this.getCellLog()}`);\n\t}\n\n\tinitialize() {\n\t\tconst startExecuteEdit: ICellEditOperation = {\n\t\t\teditType: CellEditType.PartialInternalMetadata,\n\t\t\thandle: this.cellHandle,\n\t\t\tinternalMetadata: {\n\t\t\t\texecutionId: generateUuid(),\n\t\t\t\trunStartTime: null,\n\t\t\t\trunEndTime: null,\n\t\t\t\tlastRunSuccess: null,\n\t\t\t\texecutionOrder: null,\n\t\t\t\trenderDuration: null,\n\t\t\t}\n\t\t};\n\t\tthis._applyExecutionEdits([startExecuteEdit]);\n\t}\n\n\tprivate getCellLog(): string {\n\t\treturn `${this._notebookModel.uri.toString()}, ${this.cellHandle}`;\n\t}\n\n\tprivate logUpdates(updates: ICellExecuteUpdate[]): void {\n\t\tconst updateTypes = updates.map(u => CellExecutionUpdateType[u.editType]).join(', ');\n\t\tthis._logService.debug(`CellExecution#updateExecution ${this.getCellLog()}, [${updateTypes}]`);\n\t}\n\n\tconfirm() {\n\t\tthis._logService.debug(`CellExecution#confirm ${this.getCellLog()}`);\n\t\tthis._state = NotebookCellExecutionState.Pending;\n\t\tthis._onDidUpdate.fire();\n\t}\n\n\tupdate(updates: ICellExecuteUpdate[]): void {\n\t\tthis.logUpdates(updates);\n\t\tif (updates.some(u => u.editType === CellExecutionUpdateType.ExecutionState)) {\n\t\t\tthis._state = NotebookCellExecutionState.Executing;\n\t\t}\n\n\t\tif (!this._didPause && updates.some(u => u.editType === CellExecutionUpdateType.ExecutionState && u.didPause)) {\n\t\t\tthis._didPause = true;\n\t\t}\n\n\t\tconst lastIsPausedUpdate = [...updates].reverse().find(u => u.editType === CellExecutionUpdateType.ExecutionState && typeof u.isPaused === 'boolean');\n\t\tif (lastIsPausedUpdate) {\n\t\t\tthis._isPaused = (lastIsPausedUpdate as ICellExecutionStateUpdate).isPaused!;\n\t\t}\n\n\t\tconst cellModel = this._notebookModel.cells.find(c => c.handle === this.cellHandle);\n\t\tif (!cellModel) {\n\t\t\tthis._logService.debug(`CellExecution#update, updating cell not in notebook: ${this._notebookModel.uri.toString()}, ${this.cellHandle}`);\n\t\t} else {\n\t\t\tconst edits = updates.map(update => updateToEdit(update, this.cellHandle));\n\t\t\tthis._applyExecutionEdits(edits);\n\t\t}\n\n\t\tif (updates.some(u => u.editType === CellExecutionUpdateType.ExecutionState)) {\n\t\t\tthis._onDidUpdate.fire();\n\t\t}\n\t}\n\n\tcomplete(completionData: ICellExecutionComplete): void {\n\t\tconst cellModel = this._notebookModel.cells.find(c => c.handle === this.cellHandle);\n\t\tif (!cellModel) {\n\t\t\tthis._logService.debug(`CellExecution#complete, completing cell not in notebook: ${this._notebookModel.uri.toString()}, ${this.cellHandle}`);\n\t\t} else {\n\t\t\tconst edit: ICellEditOperation = {\n\t\t\t\teditType: CellEditType.PartialInternalMetadata,\n\t\t\t\thandle: this.cellHandle,\n\t\t\t\tinternalMetadata: {\n\t\t\t\t\tlastRunSuccess: completionData.lastRunSuccess,\n\t\t\t\t\trunStartTime: this._didPause ? null : cellModel.internalMetadata.runStartTime,\n\t\t\t\t\trunEndTime: this._didPause ? null : completionData.runEndTime,\n\t\t\t\t\terror: completionData.error\n\t\t\t\t}\n\t\t\t};\n\t\t\tthis._applyExecutionEdits([edit]);\n\t\t}\n\n\t\tthis._onDidComplete.fire(completionData.lastRunSuccess);\n\t}\n\n\tprivate _applyExecutionEdits(edits: ICellEditOperation[]): void {\n\t\tthis._notebookModel.applyEdits(edits, true, undefined, () => undefined, undefined, false);\n\t}\n}\n\nclass NotebookExecution extends Disposable implements INotebookExecution {\n\tprivate readonly _onDidUpdate = this._register(new Emitter<void>());\n\treadonly onDidUpdate = this._onDidUpdate.event;\n\n\tprivate readonly _onDidComplete = this._register(new Emitter<void>());\n\treadonly onDidComplete = this._onDidComplete.event;\n\n\tprivate _state: NotebookExecutionState = NotebookExecutionState.Unconfirmed;\n\tget state() {\n\t\treturn this._state;\n\t}\n\n\tget notebook(): URI {\n\t\treturn this._notebookModel.uri;\n\t}\n\n\tconstructor(\n\t\tprivate readonly _notebookModel: NotebookTextModel,\n\t\t@ILogService private readonly _logService: ILogService,\n\t) {\n\t\tsuper();\n\t\tthis._logService.debug(`NotebookExecution#ctor`);\n\t}\n\tprivate debug(message: string) {\n\t\tthis._logService.debug(`${message} ${this._notebookModel.uri.toString()}`);\n\t}\n\n\tconfirm() {\n\t\tthis.debug(`Execution#confirm`);\n\t\tthis._state = NotebookExecutionState.Pending;\n\t\tthis._onDidUpdate.fire();\n\t}\n\n\tbegin(): void {\n\t\tthis.debug(`Execution#begin`);\n\t\tthis._state = NotebookExecutionState.Executing;\n\t\tthis._onDidUpdate.fire();\n\t}\n\n\tcomplete(): void {\n\t\tthis.debug(`Execution#begin`);\n\t\tthis._state = NotebookExecutionState.Unconfirmed;\n\t\tthis._onDidComplete.fire();\n\t}\n}\n"]}