{"version":3,"sources":["vs/workbench/contrib/notebook/browser/contrib/notebookVariables/notebookVariablesDataSource.ts"],"names":[],"mappings":"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","file":"notebookVariablesDataSource.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { IAsyncDataSource } from '../../../../../../base/browser/ui/tree/tree.js';\nimport { CancellationTokenSource } from '../../../../../../base/common/cancellation.js';\nimport { localize } from '../../../../../../nls.js';\nimport { NotebookTextModel } from '../../../common/model/notebookTextModel.js';\nimport { INotebookKernel, INotebookKernelService, VariablesResult, variablePageSize } from '../../../common/notebookKernelService.js';\n\nexport interface IEmptyScope {\n\tkind: 'empty';\n}\n\nexport interface INotebookScope {\n\tkind: 'root';\n\treadonly notebook: NotebookTextModel;\n}\n\nexport interface INotebookVariableElement {\n\tkind: 'variable';\n\treadonly id: string;\n\treadonly extHostId: number;\n\treadonly name: string;\n\treadonly value: string;\n\treadonly type?: string;\n\treadonly interfaces?: string[];\n\treadonly expression?: string;\n\treadonly language?: string;\n\treadonly indexedChildrenCount: number;\n\treadonly indexStart?: number;\n\treadonly hasNamedChildren: boolean;\n\treadonly notebook: NotebookTextModel;\n\treadonly extensionId?: string;\n}\n\nexport class NotebookVariableDataSource implements IAsyncDataSource<INotebookScope, INotebookVariableElement> {\n\n\tprivate cancellationTokenSource: CancellationTokenSource;\n\n\tconstructor(private readonly notebookKernelService: INotebookKernelService) {\n\t\tthis.cancellationTokenSource = new CancellationTokenSource();\n\t}\n\n\thasChildren(element: INotebookScope | INotebookVariableElement): boolean {\n\t\treturn element.kind === 'root' || element.hasNamedChildren || element.indexedChildrenCount > 0;\n\t}\n\n\tpublic cancel(): void {\n\t\tthis.cancellationTokenSource.cancel();\n\t\tthis.cancellationTokenSource.dispose();\n\t\tthis.cancellationTokenSource = new CancellationTokenSource();\n\t}\n\n\tasync getChildren(element: INotebookScope | INotebookVariableElement | IEmptyScope): Promise<Array<INotebookVariableElement>> {\n\t\tif (element.kind === 'empty') {\n\t\t\treturn [];\n\t\t} else if (element.kind === 'root') {\n\t\t\treturn this.getRootVariables(element.notebook);\n\t\t} else {\n\t\t\treturn this.getVariables(element);\n\t\t}\n\t}\n\n\tprivate async getVariables(parent: INotebookVariableElement): Promise<INotebookVariableElement[]> {\n\t\tconst selectedKernel = this.notebookKernelService.getMatchingKernel(parent.notebook).selected;\n\t\tif (selectedKernel && selectedKernel.hasVariableProvider) {\n\n\t\t\tlet children: INotebookVariableElement[] = [];\n\t\t\tif (parent.hasNamedChildren) {\n\t\t\t\tconst variables = selectedKernel.provideVariables(parent.notebook.uri, parent.extHostId, 'named', 0, this.cancellationTokenSource.token);\n\t\t\t\tfor await (const variable of variables) {\n\t\t\t\t\tchildren.push(this.createVariableElement(variable, parent.notebook));\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (parent.indexedChildrenCount > 0) {\n\t\t\t\tconst childNodes = await this.getIndexedChildren(parent, selectedKernel);\n\t\t\t\tchildren = children.concat(childNodes);\n\t\t\t}\n\n\t\t\treturn children;\n\t\t}\n\t\treturn [];\n\t}\n\n\tprivate async getIndexedChildren(parent: INotebookVariableElement, kernel: INotebookKernel) {\n\t\tconst childNodes: INotebookVariableElement[] = [];\n\n\t\tif (parent.indexedChildrenCount > variablePageSize) {\n\n\t\t\tconst nestedPageSize = Math.floor(Math.max(parent.indexedChildrenCount / variablePageSize, 100));\n\n\t\t\tconst indexedChildCountLimit = 1_000_000;\n\t\t\tlet start = parent.indexStart ?? 0;\n\t\t\tconst last = start + Math.min(parent.indexedChildrenCount, indexedChildCountLimit);\n\t\t\tfor (; start < last; start += nestedPageSize) {\n\t\t\t\tlet end = start + nestedPageSize;\n\t\t\t\tif (end > last) {\n\t\t\t\t\tend = last;\n\t\t\t\t}\n\n\t\t\t\tchildNodes.push({\n\t\t\t\t\tkind: 'variable',\n\t\t\t\t\tnotebook: parent.notebook,\n\t\t\t\t\tid: parent.id + `${start}`,\n\t\t\t\t\textHostId: parent.extHostId,\n\t\t\t\t\tname: `[${start}..${end - 1}]`,\n\t\t\t\t\tvalue: '',\n\t\t\t\t\tindexedChildrenCount: end - start,\n\t\t\t\t\tindexStart: start,\n\t\t\t\t\thasNamedChildren: false\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (parent.indexedChildrenCount > indexedChildCountLimit) {\n\t\t\t\tchildNodes.push({\n\t\t\t\t\tkind: 'variable',\n\t\t\t\t\tnotebook: parent.notebook,\n\t\t\t\t\tid: parent.id + `${last + 1}`,\n\t\t\t\t\textHostId: parent.extHostId,\n\t\t\t\t\tname: localize('notebook.indexedChildrenLimitReached', \"Display limit reached\"),\n\t\t\t\t\tvalue: '',\n\t\t\t\t\tindexedChildrenCount: 0,\n\t\t\t\t\thasNamedChildren: false\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t\telse if (parent.indexedChildrenCount > 0) {\n\t\t\tconst variables = kernel.provideVariables(parent.notebook.uri, parent.extHostId, 'indexed', parent.indexStart ?? 0, this.cancellationTokenSource.token);\n\n\t\t\tfor await (const variable of variables) {\n\t\t\t\tchildNodes.push(this.createVariableElement(variable, parent.notebook));\n\t\t\t\tif (childNodes.length >= variablePageSize) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t}\n\t\treturn childNodes;\n\t}\n\n\tprivate async getRootVariables(notebook: NotebookTextModel): Promise<INotebookVariableElement[]> {\n\t\tconst selectedKernel = this.notebookKernelService.getMatchingKernel(notebook).selected;\n\t\tif (selectedKernel && selectedKernel.hasVariableProvider) {\n\t\t\tconst variables = selectedKernel.provideVariables(notebook.uri, undefined, 'named', 0, this.cancellationTokenSource.token);\n\t\t\tconst varElements: INotebookVariableElement[] = [];\n\t\t\tfor await (const variable of variables) {\n\t\t\t\tvarElements.push(this.createVariableElement(variable, notebook));\n\t\t\t}\n\t\t\treturn varElements;\n\t\t}\n\n\t\treturn [];\n\t}\n\n\tprivate createVariableElement(variable: VariablesResult, notebook: NotebookTextModel): INotebookVariableElement {\n\t\treturn {\n\t\t\t...variable,\n\t\t\tkind: 'variable',\n\t\t\tnotebook,\n\t\t\textHostId: variable.id,\n\t\t\tid: `${variable.id}`\n\t\t};\n\t}\n}\n"]}