{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/contrib/notebook/browser/contrib/viewportWarmup/viewportWarmup.ts","vs/workbench/contrib/notebook/browser/contrib/viewportWarmup/viewportWarmup.ts"],"names":[],"mappings":"AAAA;;;gGAGgG;;;;;;;;;;AAEhG,OAAO,EAAE,gBAAgB,EAAE,MAAM,wCAAwC,CAAC;AAC1E,OAAO,EAAE,UAAU,EAAE,MAAM,4CAA4C,CAAC;AACxE,OAAO,EAAE,qBAAqB,EAAE,MAAM,kEAAkE,CAAC;AACzG,OAAO,EAAE,aAAa,EAA+G,MAAM,0BAA0B,CAAC;AACtK,OAAO,EAAE,4BAA4B,EAAE,MAAM,mCAAmC,CAAC;AACjF,OAAO,EAAqB,kBAAkB,EAAE,MAAM,sCAAsC,CAAC;AAC7F,OAAO,EAAE,QAAQ,EAAE,MAAM,mCAAmC,CAAC;AAC7D,OAAO,EAAE,mBAAmB,EAAE,MAAM,kCAAkC,CAAC;AACvE,OAAO,EAAE,gBAAgB,EAAE,MAAM,oCAAoC,CAAC;AAEtE,IAAM,4BAA4B,GAAlC,MAAM,4BAA6B,SAAQ,UAAU;aAC7C,OAAE,GAAW,mCAAX,AAA8C,CAAC;IAIxD,YACkB,eAAgC,EAC/B,gBAAmD,EAC9C,oBAA2C;QAElE,KAAK,EAAE,CAAC;QAJS,oBAAe,GAAf,eAAe,CAAiB;QACd,qBAAgB,GAAhB,gBAAgB,CAAkB;QAJrD,oBAAe,GAA4B,IAAI,CAAC;QAShE,IAAI,CAAC,eAAe,GAAG,IAAI,gBAAgB,CAAC,GAAG,EAAE,CAAC,IAAI,CAAC,kBAAkB,EAAE,EAAE,GAAG,CAAC,CAAC;QAClF,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,eAAe,CAAC,CAAC;QACrC,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,eAAe,CAAC,WAAW,CAAC,GAAG,EAAE;YACpD,IAAI,CAAC,eAAe,CAAC,QAAQ,EAAE,CAAC;QACjC,CAAC,CAAC,CAAC,CAAC;QAEJ,IAAI,CAAC,eAAe,GAAG,IAAI,gBAAgB,CAAC,GAAG,EAAE,CAAC,IAAI,CAAC,kBAAkB,EAAE,EAAE,GAAG,CAAC,CAAC;QAClF,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,eAAe,CAAC,CAAC;QACrC,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,eAAe,CAAC,oBAAoB,CAAC,GAAG,EAAE;YAC7D,IAAI,IAAI,CAAC,eAAe,CAAC,QAAQ,EAAE,EAAE,CAAC;gBACrC,IAAI,CAAC,eAAe,EAAE,QAAQ,EAAE,CAAC;YAClC,CAAC;QACF,CAAC,CAAC,CAAC,CAAC;QAEJ,IAAI,IAAI,CAAC,eAAe,CAAC,QAAQ,EAAE,EAAE,CAAC;YACrC,IAAI,CAAC,eAAe,EAAE,QAAQ,EAAE,CAAC;QAClC,CAAC;IACF,CAAC;IAEO,kBAAkB;QACzB,IAAI,IAAI,CAAC,eAAe,CAAC,QAAQ,EAAE,EAAE,CAAC;YACrC,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,IAAI,CAAC,eAAe,CAAC,SAAS,EAAE,EAAE,CAAC,EAAE,EAAE,CAAC;gBAC3D,MAAM,IAAI,GAAG,IAAI,CAAC,eAAe,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC;gBAE5C,IAAI,IAAI,EAAE,QAAQ,KAAK,QAAQ,CAAC,MAAM,IAAI,IAAI,EAAE,YAAY,EAAE,KAAK,aAAa,CAAC,OAAO,IAAI,CAAC,IAAI,CAAC,gBAAgB,EAAE,CAAC;oBACpH,0FAA0F;oBAC1F,kDAAkD;gBACnD,CAAC;qBAAM,IAAI,IAAI,EAAE,QAAQ,KAAK,QAAQ,CAAC,IAAI,EAAE,CAAC;oBAC7C,IAAI,CAAC,eAAe,CAAE,IAA0B,CAAC,CAAC;gBACnD,CAAC;YACF,CAAC;QACF,CAAC;IACF,CAAC;IAEO,kBAAkB;QACzB,IAAI,IAAI,CAAC,eAAe,CAAC,UAAU,EAAE,CAAC;YACrC,OAAO;QACR,CAAC;QAED,IAAI,CAAC,IAAI,CAAC,eAAe,CAAC,QAAQ,EAAE,EAAE,CAAC;YACtC,OAAO;QACR,CAAC;QAED,MAAM,aAAa,GAAG,IAAI,CAAC,eAAe,CAAC,yCAAyC,EAAE,CAAC;QACvF,mBAAmB,CAAC,aAAa,CAAC,CAAC,OAAO,CAAC,KAAK,CAAC,EAAE;YAClD,MAAM,IAAI,GAAG,IAAI,CAAC,eAAe,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC;YAEhD,IAAI,IAAI,EAAE,QAAQ,KAAK,QAAQ,CAAC,MAAM,IAAI,IAAI,EAAE,YAAY,EAAE,KAAK,aAAa,CAAC,OAAO,IAAI,CAAC,IAAI,CAAC,gBAAgB,EAAE,CAAC;gBACnH,IAAI,CAAC,eAA2C,CAAC,mBAAmB,CAAC,IAAI,CAAC,CAAC;YAC7E,CAAC;iBAAM,IAAI,IAAI,EAAE,QAAQ,KAAK,QAAQ,CAAC,IAAI,EAAE,CAAC;gBAC7C,IAAI,CAAC,eAAe,CAAE,IAA0B,CAAC,CAAC;YACnD,CAAC;QACF,CAAC,CAAC,CAAC;IACJ,CAAC;IAEO,eAAe,CAAC,QAA2B;QAClD,IAAI,QAAQ,CAAC,iBAAiB,EAAE,CAAC;YAChC,OAAO;QACR,CAAC;QAED,MAAM,OAAO,GAAG,QAAQ,CAAC,iBAAiB,CAAC;QAC3C,KAAK,MAAM,MAAM,IAAI,OAAO,CAAC,KAAK,CAAC,CAAC,EAAE,kBAAkB,CAAC,EAAE,CAAC;YAC3D,MAAM,CAAC,SAAS,EAAE,IAAI,CAAC,GAAG,MAAM,CAAC,gBAAgB,CAAC,IAAI,CAAC,eAAe,CAAC,SAAU,EAAE,SAAS,CAAC,CAAC;YAC9F,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,QAAQ,CAAC,EAAE,CAAC,QAAQ,CAAC,SAAS,CAAC,IAAI,SAAS,CAAC,MAAM,KAAK,CAAC,EAAE,CAAC;gBAC/E,SAAS;YACV,CAAC;YAED,MAAM,sBAAsB,GAAG,SAAS,CAAC,IAAI,CAAC,CAAC;YAE/C,IAAI,CAAC,sBAAsB,EAAE,CAAC;gBAC7B,OAAO;YACR,CAAC;YAED,IAAI,CAAC,IAAI,CAAC,eAAe,CAAC,QAAQ,EAAE,EAAE,CAAC;gBACtC,OAAO;YACR,CAAC;YAED,MAAM,QAAQ,GAAG,IAAI,CAAC,gBAAgB,CAAC,eAAe,CAAC,sBAAsB,CAAC,UAAU,CAAC,CAAC;YAE1F,IAAI,CAAC,QAAQ,EAAE,CAAC;gBACf,OAAO;YACR,CAAC;YAED,MAAM,MAAM,GAAuB,EAAE,IAAI,oCAA4B,EAAE,QAAQ,EAAE,MAAM,EAAE,MAAM,EAAE,QAAQ,EAAE,sBAAsB,CAAC,QAAQ,EAAE,CAAC;YAC7I,IAAI,CAAC,eAAe,CAAC,YAAY,CAAC,QAAQ,EAAE,MAAM,EAAE,CAAC,EAAE,IAAI,CAAC,CAAC;QAC9D,CAAC;IAEF,CAAC;;AAnGI,4BAA4B;IAO/B,WAAA,gBAAgB,CAAA;IAChB,WAAA,qBAAqB,CAAA;GARlB,4BAA4B,CAoGjC;AAED,4BAA4B,CAAC,4BAA4B,CAAC,EAAE,EAAE,4BAA4B,CAAC,CAAC","file":"viewportWarmup.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { RunOnceScheduler } from '../../../../../../base/common/async.js';\nimport { Disposable } from '../../../../../../base/common/lifecycle.js';\nimport { IAccessibilityService } from '../../../../../../platform/accessibility/common/accessibility.js';\nimport { CellEditState, IInsetRenderOutput, INotebookEditor, INotebookEditorContribution, INotebookEditorDelegate, RenderOutputType } from '../../notebookBrowser.js';\nimport { registerNotebookContribution } from '../../notebookEditorExtensions.js';\nimport { CodeCellViewModel, outputDisplayLimit } from '../../viewModel/codeCellViewModel.js';\nimport { CellKind } from '../../../common/notebookCommon.js';\nimport { cellRangesToIndexes } from '../../../common/notebookRange.js';\nimport { INotebookService } from '../../../common/notebookService.js';\n\nclass NotebookViewportContribution extends Disposable implements INotebookEditorContribution {\n\tstatic id: string = 'workbench.notebook.viewportWarmup';\n\tprivate readonly _warmupViewport: RunOnceScheduler;\n\tprivate readonly _warmupDocument: RunOnceScheduler | null = null;\n\n\tconstructor(\n\t\tprivate readonly _notebookEditor: INotebookEditor,\n\t\t@INotebookService private readonly _notebookService: INotebookService,\n\t\t@IAccessibilityService accessibilityService: IAccessibilityService,\n\t) {\n\t\tsuper();\n\n\t\tthis._warmupViewport = new RunOnceScheduler(() => this._warmupViewportNow(), 200);\n\t\tthis._register(this._warmupViewport);\n\t\tthis._register(this._notebookEditor.onDidScroll(() => {\n\t\t\tthis._warmupViewport.schedule();\n\t\t}));\n\n\t\tthis._warmupDocument = new RunOnceScheduler(() => this._warmupDocumentNow(), 200);\n\t\tthis._register(this._warmupDocument);\n\t\tthis._register(this._notebookEditor.onDidAttachViewModel(() => {\n\t\t\tif (this._notebookEditor.hasModel()) {\n\t\t\t\tthis._warmupDocument?.schedule();\n\t\t\t}\n\t\t}));\n\n\t\tif (this._notebookEditor.hasModel()) {\n\t\t\tthis._warmupDocument?.schedule();\n\t\t}\n\t}\n\n\tprivate _warmupDocumentNow() {\n\t\tif (this._notebookEditor.hasModel()) {\n\t\t\tfor (let i = 0; i < this._notebookEditor.getLength(); i++) {\n\t\t\t\tconst cell = this._notebookEditor.cellAt(i);\n\n\t\t\t\tif (cell?.cellKind === CellKind.Markup && cell?.getEditState() === CellEditState.Preview && !cell.isInputCollapsed) {\n\t\t\t\t\t// TODO@rebornix currently we disable markdown cell rendering in webview for accessibility\n\t\t\t\t\t// this._notebookEditor.createMarkupPreview(cell);\n\t\t\t\t} else if (cell?.cellKind === CellKind.Code) {\n\t\t\t\t\tthis._warmupCodeCell((cell as CodeCellViewModel));\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate _warmupViewportNow() {\n\t\tif (this._notebookEditor.isDisposed) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this._notebookEditor.hasModel()) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst visibleRanges = this._notebookEditor.getVisibleRangesPlusViewportAboveAndBelow();\n\t\tcellRangesToIndexes(visibleRanges).forEach(index => {\n\t\t\tconst cell = this._notebookEditor.cellAt(index);\n\n\t\t\tif (cell?.cellKind === CellKind.Markup && cell?.getEditState() === CellEditState.Preview && !cell.isInputCollapsed) {\n\t\t\t\t(this._notebookEditor as INotebookEditorDelegate).createMarkupPreview(cell);\n\t\t\t} else if (cell?.cellKind === CellKind.Code) {\n\t\t\t\tthis._warmupCodeCell((cell as CodeCellViewModel));\n\t\t\t}\n\t\t});\n\t}\n\n\tprivate _warmupCodeCell(viewCell: CodeCellViewModel) {\n\t\tif (viewCell.isOutputCollapsed) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst outputs = viewCell.outputsViewModels;\n\t\tfor (const output of outputs.slice(0, outputDisplayLimit)) {\n\t\t\tconst [mimeTypes, pick] = output.resolveMimeTypes(this._notebookEditor.textModel!, undefined);\n\t\t\tif (!mimeTypes.find(mimeType => mimeType.isTrusted) || mimeTypes.length === 0) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tconst pickedMimeTypeRenderer = mimeTypes[pick];\n\n\t\t\tif (!pickedMimeTypeRenderer) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (!this._notebookEditor.hasModel()) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst renderer = this._notebookService.getRendererInfo(pickedMimeTypeRenderer.rendererId);\n\n\t\t\tif (!renderer) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst result: IInsetRenderOutput = { type: RenderOutputType.Extension, renderer, source: output, mimeType: pickedMimeTypeRenderer.mimeType };\n\t\t\tthis._notebookEditor.createOutput(viewCell, result, 0, true);\n\t\t}\n\n\t}\n}\n\nregisterNotebookContribution(NotebookViewportContribution.id, NotebookViewportContribution);\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { RunOnceScheduler } from '../../../../../../base/common/async.js';\nimport { Disposable } from '../../../../../../base/common/lifecycle.js';\nimport { IAccessibilityService } from '../../../../../../platform/accessibility/common/accessibility.js';\nimport { CellEditState, IInsetRenderOutput, INotebookEditor, INotebookEditorContribution, INotebookEditorDelegate, RenderOutputType } from '../../notebookBrowser.js';\nimport { registerNotebookContribution } from '../../notebookEditorExtensions.js';\nimport { CodeCellViewModel, outputDisplayLimit } from '../../viewModel/codeCellViewModel.js';\nimport { CellKind } from '../../../common/notebookCommon.js';\nimport { cellRangesToIndexes } from '../../../common/notebookRange.js';\nimport { INotebookService } from '../../../common/notebookService.js';\n\nclass NotebookViewportContribution extends Disposable implements INotebookEditorContribution {\n\tstatic id: string = 'workbench.notebook.viewportWarmup';\n\tprivate readonly _warmupViewport: RunOnceScheduler;\n\tprivate readonly _warmupDocument: RunOnceScheduler | null = null;\n\n\tconstructor(\n\t\tprivate readonly _notebookEditor: INotebookEditor,\n\t\t@INotebookService private readonly _notebookService: INotebookService,\n\t\t@IAccessibilityService accessibilityService: IAccessibilityService,\n\t) {\n\t\tsuper();\n\n\t\tthis._warmupViewport = new RunOnceScheduler(() => this._warmupViewportNow(), 200);\n\t\tthis._register(this._warmupViewport);\n\t\tthis._register(this._notebookEditor.onDidScroll(() => {\n\t\t\tthis._warmupViewport.schedule();\n\t\t}));\n\n\t\tthis._warmupDocument = new RunOnceScheduler(() => this._warmupDocumentNow(), 200);\n\t\tthis._register(this._warmupDocument);\n\t\tthis._register(this._notebookEditor.onDidAttachViewModel(() => {\n\t\t\tif (this._notebookEditor.hasModel()) {\n\t\t\t\tthis._warmupDocument?.schedule();\n\t\t\t}\n\t\t}));\n\n\t\tif (this._notebookEditor.hasModel()) {\n\t\t\tthis._warmupDocument?.schedule();\n\t\t}\n\t}\n\n\tprivate _warmupDocumentNow() {\n\t\tif (this._notebookEditor.hasModel()) {\n\t\t\tfor (let i = 0; i < this._notebookEditor.getLength(); i++) {\n\t\t\t\tconst cell = this._notebookEditor.cellAt(i);\n\n\t\t\t\tif (cell?.cellKind === CellKind.Markup && cell?.getEditState() === CellEditState.Preview && !cell.isInputCollapsed) {\n\t\t\t\t\t// TODO@rebornix currently we disable markdown cell rendering in webview for accessibility\n\t\t\t\t\t// this._notebookEditor.createMarkupPreview(cell);\n\t\t\t\t} else if (cell?.cellKind === CellKind.Code) {\n\t\t\t\t\tthis._warmupCodeCell((cell as CodeCellViewModel));\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate _warmupViewportNow() {\n\t\tif (this._notebookEditor.isDisposed) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this._notebookEditor.hasModel()) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst visibleRanges = this._notebookEditor.getVisibleRangesPlusViewportAboveAndBelow();\n\t\tcellRangesToIndexes(visibleRanges).forEach(index => {\n\t\t\tconst cell = this._notebookEditor.cellAt(index);\n\n\t\t\tif (cell?.cellKind === CellKind.Markup && cell?.getEditState() === CellEditState.Preview && !cell.isInputCollapsed) {\n\t\t\t\t(this._notebookEditor as INotebookEditorDelegate).createMarkupPreview(cell);\n\t\t\t} else if (cell?.cellKind === CellKind.Code) {\n\t\t\t\tthis._warmupCodeCell((cell as CodeCellViewModel));\n\t\t\t}\n\t\t});\n\t}\n\n\tprivate _warmupCodeCell(viewCell: CodeCellViewModel) {\n\t\tif (viewCell.isOutputCollapsed) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst outputs = viewCell.outputsViewModels;\n\t\tfor (const output of outputs.slice(0, outputDisplayLimit)) {\n\t\t\tconst [mimeTypes, pick] = output.resolveMimeTypes(this._notebookEditor.textModel!, undefined);\n\t\t\tif (!mimeTypes.find(mimeType => mimeType.isTrusted) || mimeTypes.length === 0) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tconst pickedMimeTypeRenderer = mimeTypes[pick];\n\n\t\t\tif (!pickedMimeTypeRenderer) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (!this._notebookEditor.hasModel()) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst renderer = this._notebookService.getRendererInfo(pickedMimeTypeRenderer.rendererId);\n\n\t\t\tif (!renderer) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst result: IInsetRenderOutput = { type: RenderOutputType.Extension, renderer, source: output, mimeType: pickedMimeTypeRenderer.mimeType };\n\t\t\tthis._notebookEditor.createOutput(viewCell, result, 0, true);\n\t\t}\n\n\t}\n}\n\nregisterNotebookContribution(NotebookViewportContribution.id, NotebookViewportContribution);\n"]}