{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/contrib/notebook/browser/contrib/kernelDetection/notebookKernelDetection.ts","vs/workbench/contrib/notebook/browser/contrib/kernelDetection/notebookKernelDetection.ts"],"names":[],"mappings":"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","file":"notebookKernelDetection.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\n\nimport { Disposable, DisposableStore, IDisposable } from '../../../../../../base/common/lifecycle.js';\nimport { Registry } from '../../../../../../platform/registry/common/platform.js';\nimport { IWorkbenchContribution, IWorkbenchContributionsRegistry, Extensions as WorkbenchExtensions } from '../../../../../common/contributions.js';\nimport { INotebookKernelService } from '../../../common/notebookKernelService.js';\nimport { INotebookLoggingService } from '../../../common/notebookLoggingService.js';\nimport { IExtensionService } from '../../../../../services/extensions/common/extensions.js';\nimport { LifecyclePhase } from '../../../../../services/lifecycle/common/lifecycle.js';\n\nclass NotebookKernelDetection extends Disposable implements IWorkbenchContribution {\n\tprivate _detectionMap = new Map<string, IDisposable>();\n\tprivate readonly _localDisposableStore = this._register(new DisposableStore());\n\n\tconstructor(\n\t\t@INotebookKernelService private readonly _notebookKernelService: INotebookKernelService,\n\t\t@IExtensionService private readonly _extensionService: IExtensionService,\n\t\t@INotebookLoggingService private readonly _notebookLoggingService: INotebookLoggingService\n\t) {\n\t\tsuper();\n\n\t\tthis._registerListeners();\n\t}\n\n\tprivate _registerListeners() {\n\t\tthis._localDisposableStore.clear();\n\n\t\tthis._localDisposableStore.add(this._extensionService.onWillActivateByEvent(e => {\n\t\t\tif (e.event.startsWith('onNotebook:')) {\n\t\t\t\tif (this._extensionService.activationEventIsDone(e.event)) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t// parse the event to get the notebook type\n\t\t\t\tconst notebookType = e.event.substring('onNotebook:'.length);\n\n\t\t\t\tif (notebookType === '*') {\n\t\t\t\t\t// ignore\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tlet shouldStartDetection = false;\n\n\t\t\t\tconst extensionStatus = this._extensionService.getExtensionsStatus();\n\t\t\t\tthis._extensionService.extensions.forEach(extension => {\n\t\t\t\t\tif (extensionStatus[extension.identifier.value].activationTimes) {\n\t\t\t\t\t\t// already activated\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tif (extension.activationEvents?.includes(e.event)) {\n\t\t\t\t\t\tshouldStartDetection = true;\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tif (shouldStartDetection && !this._detectionMap.has(notebookType)) {\n\t\t\t\t\tthis._notebookLoggingService.debug('KernelDetection', `start extension activation for ${notebookType}`);\n\t\t\t\t\tconst task = this._notebookKernelService.registerNotebookKernelDetectionTask({\n\t\t\t\t\t\tnotebookType: notebookType\n\t\t\t\t\t});\n\n\t\t\t\t\tthis._detectionMap.set(notebookType, task);\n\t\t\t\t}\n\t\t\t}\n\t\t}));\n\n\t\tlet timer: Timeout | null = null;\n\n\t\tthis._localDisposableStore.add(this._extensionService.onDidChangeExtensionsStatus(() => {\n\t\t\tif (timer) {\n\t\t\t\tclearTimeout(timer);\n\t\t\t}\n\n\t\t\t// activation state might not be updated yet, postpone to next frame\n\t\t\ttimer = setTimeout(() => {\n\t\t\t\tconst taskToDelete: string[] = [];\n\t\t\t\tfor (const [notebookType, task] of this._detectionMap) {\n\t\t\t\t\tif (this._extensionService.activationEventIsDone(`onNotebook:${notebookType}`)) {\n\t\t\t\t\t\tthis._notebookLoggingService.debug('KernelDetection', `finish extension activation for ${notebookType}`);\n\t\t\t\t\t\ttaskToDelete.push(notebookType);\n\t\t\t\t\t\ttask.dispose();\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\ttaskToDelete.forEach(notebookType => {\n\t\t\t\t\tthis._detectionMap.delete(notebookType);\n\t\t\t\t});\n\t\t\t});\n\t\t}));\n\n\t\tthis._localDisposableStore.add({\n\t\t\tdispose: () => {\n\t\t\t\tif (timer) {\n\t\t\t\t\tclearTimeout(timer);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n}\n\nRegistry.as<IWorkbenchContributionsRegistry>(WorkbenchExtensions.Workbench).registerWorkbenchContribution(NotebookKernelDetection, LifecyclePhase.Restored);\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\n\nimport { Disposable, DisposableStore, IDisposable } from '../../../../../../base/common/lifecycle.js';\nimport { Registry } from '../../../../../../platform/registry/common/platform.js';\nimport { IWorkbenchContribution, IWorkbenchContributionsRegistry, Extensions as WorkbenchExtensions } from '../../../../../common/contributions.js';\nimport { INotebookKernelService } from '../../../common/notebookKernelService.js';\nimport { INotebookLoggingService } from '../../../common/notebookLoggingService.js';\nimport { IExtensionService } from '../../../../../services/extensions/common/extensions.js';\nimport { LifecyclePhase } from '../../../../../services/lifecycle/common/lifecycle.js';\n\nclass NotebookKernelDetection extends Disposable implements IWorkbenchContribution {\n\tprivate _detectionMap = new Map<string, IDisposable>();\n\tprivate readonly _localDisposableStore = this._register(new DisposableStore());\n\n\tconstructor(\n\t\t@INotebookKernelService private readonly _notebookKernelService: INotebookKernelService,\n\t\t@IExtensionService private readonly _extensionService: IExtensionService,\n\t\t@INotebookLoggingService private readonly _notebookLoggingService: INotebookLoggingService\n\t) {\n\t\tsuper();\n\n\t\tthis._registerListeners();\n\t}\n\n\tprivate _registerListeners() {\n\t\tthis._localDisposableStore.clear();\n\n\t\tthis._localDisposableStore.add(this._extensionService.onWillActivateByEvent(e => {\n\t\t\tif (e.event.startsWith('onNotebook:')) {\n\t\t\t\tif (this._extensionService.activationEventIsDone(e.event)) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t// parse the event to get the notebook type\n\t\t\t\tconst notebookType = e.event.substring('onNotebook:'.length);\n\n\t\t\t\tif (notebookType === '*') {\n\t\t\t\t\t// ignore\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tlet shouldStartDetection = false;\n\n\t\t\t\tconst extensionStatus = this._extensionService.getExtensionsStatus();\n\t\t\t\tthis._extensionService.extensions.forEach(extension => {\n\t\t\t\t\tif (extensionStatus[extension.identifier.value].activationTimes) {\n\t\t\t\t\t\t// already activated\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tif (extension.activationEvents?.includes(e.event)) {\n\t\t\t\t\t\tshouldStartDetection = true;\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tif (shouldStartDetection && !this._detectionMap.has(notebookType)) {\n\t\t\t\t\tthis._notebookLoggingService.debug('KernelDetection', `start extension activation for ${notebookType}`);\n\t\t\t\t\tconst task = this._notebookKernelService.registerNotebookKernelDetectionTask({\n\t\t\t\t\t\tnotebookType: notebookType\n\t\t\t\t\t});\n\n\t\t\t\t\tthis._detectionMap.set(notebookType, task);\n\t\t\t\t}\n\t\t\t}\n\t\t}));\n\n\t\tlet timer: Timeout | null = null;\n\n\t\tthis._localDisposableStore.add(this._extensionService.onDidChangeExtensionsStatus(() => {\n\t\t\tif (timer) {\n\t\t\t\tclearTimeout(timer);\n\t\t\t}\n\n\t\t\t// activation state might not be updated yet, postpone to next frame\n\t\t\ttimer = setTimeout(() => {\n\t\t\t\tconst taskToDelete: string[] = [];\n\t\t\t\tfor (const [notebookType, task] of this._detectionMap) {\n\t\t\t\t\tif (this._extensionService.activationEventIsDone(`onNotebook:${notebookType}`)) {\n\t\t\t\t\t\tthis._notebookLoggingService.debug('KernelDetection', `finish extension activation for ${notebookType}`);\n\t\t\t\t\t\ttaskToDelete.push(notebookType);\n\t\t\t\t\t\ttask.dispose();\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\ttaskToDelete.forEach(notebookType => {\n\t\t\t\t\tthis._detectionMap.delete(notebookType);\n\t\t\t\t});\n\t\t\t});\n\t\t}));\n\n\t\tthis._localDisposableStore.add({\n\t\t\tdispose: () => {\n\t\t\t\tif (timer) {\n\t\t\t\t\tclearTimeout(timer);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n}\n\nRegistry.as<IWorkbenchContributionsRegistry>(WorkbenchExtensions.Workbench).registerWorkbenchContribution(NotebookKernelDetection, LifecyclePhase.Restored);\n"]}