{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/contrib/notebook/browser/contrib/debug/notebookBreakpoints.ts","vs/workbench/contrib/notebook/browser/contrib/debug/notebookBreakpoints.ts"],"names":[],"mappings":"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","file":"notebookBreakpoints.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Disposable, IDisposable } from '../../../../../../base/common/lifecycle.js';\nimport { ResourceMap } from '../../../../../../base/common/map.js';\nimport { Schemas } from '../../../../../../base/common/network.js';\nimport { isEqual } from '../../../../../../base/common/resources.js';\nimport { Registry } from '../../../../../../platform/registry/common/platform.js';\nimport { Extensions as WorkbenchExtensions, IWorkbenchContribution, IWorkbenchContributionsRegistry } from '../../../../../common/contributions.js';\nimport { IBreakpoint, IDebugService } from '../../../../debug/common/debug.js';\nimport { getNotebookEditorFromEditorPane } from '../../notebookBrowser.js';\nimport { NotebookTextModel } from '../../../common/model/notebookTextModel.js';\nimport { CellUri, NotebookCellsChangeType } from '../../../common/notebookCommon.js';\nimport { INotebookService } from '../../../common/notebookService.js';\nimport { IEditorService } from '../../../../../services/editor/common/editorService.js';\nimport { LifecyclePhase } from '../../../../../services/lifecycle/common/lifecycle.js';\nimport { hasKey } from '../../../../../../base/common/types.js';\n\nclass NotebookBreakpoints extends Disposable implements IWorkbenchContribution {\n\tconstructor(\n\t\t@IDebugService private readonly _debugService: IDebugService,\n\t\t@INotebookService _notebookService: INotebookService,\n\t\t@IEditorService private readonly _editorService: IEditorService,\n\t) {\n\t\tsuper();\n\n\t\tconst listeners = new ResourceMap<IDisposable>();\n\t\tthis._register(_notebookService.onWillAddNotebookDocument(model => {\n\t\t\tlisteners.set(model.uri, model.onWillAddRemoveCells(e => {\n\t\t\t\t// When deleting a cell, remove its breakpoints\n\t\t\t\tconst debugModel = this._debugService.getModel();\n\t\t\t\tif (!debugModel.getBreakpoints().length) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (e.rawEvent.kind !== NotebookCellsChangeType.ModelChange) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tfor (const change of e.rawEvent.changes) {\n\t\t\t\t\tconst [start, deleteCount] = change;\n\t\t\t\t\tif (deleteCount > 0) {\n\t\t\t\t\t\tconst deleted = model.cells.slice(start, start + deleteCount);\n\t\t\t\t\t\tfor (const deletedCell of deleted) {\n\t\t\t\t\t\t\tconst cellBps = debugModel.getBreakpoints({ uri: deletedCell.uri });\n\t\t\t\t\t\t\tcellBps.forEach(cellBp => this._debugService.removeBreakpoints(cellBp.getId()));\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}));\n\t\t}));\n\n\t\tthis._register(_notebookService.onWillRemoveNotebookDocument(model => {\n\t\t\tthis.updateBreakpoints(model);\n\t\t\tlisteners.get(model.uri)?.dispose();\n\t\t\tlisteners.delete(model.uri);\n\t\t}));\n\n\t\tthis._register(this._debugService.getModel().onDidChangeBreakpoints(e => {\n\t\t\tconst newCellBp = e?.added?.find(bp => hasKey(bp, { uri: true }) && bp.uri.scheme === Schemas.vscodeNotebookCell) as IBreakpoint | undefined;\n\t\t\tif (newCellBp) {\n\t\t\t\tconst parsed = CellUri.parse(newCellBp.uri);\n\t\t\t\tif (!parsed) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst editor = getNotebookEditorFromEditorPane(this._editorService.activeEditorPane);\n\t\t\t\tif (!editor || !editor.hasModel() || editor.textModel.uri.toString() !== parsed.notebook.toString()) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\n\t\t\t\tconst cell = editor.getCellByHandle(parsed.handle);\n\t\t\t\tif (!cell) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\teditor.focusElement(cell);\n\t\t\t}\n\t\t}));\n\t}\n\n\tprivate updateBreakpoints(model: NotebookTextModel): void {\n\t\tconst bps = this._debugService.getModel().getBreakpoints();\n\t\tif (!bps.length || !model.cells.length) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst idxMap = new ResourceMap<number>();\n\t\tmodel.cells.forEach((cell, i) => {\n\t\t\tidxMap.set(cell.uri, i);\n\t\t});\n\n\t\tbps.forEach(bp => {\n\t\t\tconst idx = idxMap.get(bp.uri);\n\t\t\tif (typeof idx !== 'number') {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst notebook = CellUri.parse(bp.uri)?.notebook;\n\t\t\tif (!notebook) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst newUri = CellUri.generate(notebook, idx);\n\t\t\tif (isEqual(newUri, bp.uri)) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis._debugService.removeBreakpoints(bp.getId());\n\t\t\tthis._debugService.addBreakpoints(newUri, [\n\t\t\t\t{\n\t\t\t\t\tcolumn: bp.column,\n\t\t\t\t\tcondition: bp.condition,\n\t\t\t\t\tenabled: bp.enabled,\n\t\t\t\t\thitCondition: bp.hitCondition,\n\t\t\t\t\tlogMessage: bp.logMessage,\n\t\t\t\t\tlineNumber: bp.lineNumber\n\t\t\t\t}\n\t\t\t]);\n\t\t});\n\t}\n}\n\nRegistry.as<IWorkbenchContributionsRegistry>(WorkbenchExtensions.Workbench).registerWorkbenchContribution(NotebookBreakpoints, LifecyclePhase.Restored);\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Disposable, IDisposable } from '../../../../../../base/common/lifecycle.js';\nimport { ResourceMap } from '../../../../../../base/common/map.js';\nimport { Schemas } from '../../../../../../base/common/network.js';\nimport { isEqual } from '../../../../../../base/common/resources.js';\nimport { Registry } from '../../../../../../platform/registry/common/platform.js';\nimport { Extensions as WorkbenchExtensions, IWorkbenchContribution, IWorkbenchContributionsRegistry } from '../../../../../common/contributions.js';\nimport { IBreakpoint, IDebugService } from '../../../../debug/common/debug.js';\nimport { getNotebookEditorFromEditorPane } from '../../notebookBrowser.js';\nimport { NotebookTextModel } from '../../../common/model/notebookTextModel.js';\nimport { CellUri, NotebookCellsChangeType } from '../../../common/notebookCommon.js';\nimport { INotebookService } from '../../../common/notebookService.js';\nimport { IEditorService } from '../../../../../services/editor/common/editorService.js';\nimport { LifecyclePhase } from '../../../../../services/lifecycle/common/lifecycle.js';\nimport { hasKey } from '../../../../../../base/common/types.js';\n\nclass NotebookBreakpoints extends Disposable implements IWorkbenchContribution {\n\tconstructor(\n\t\t@IDebugService private readonly _debugService: IDebugService,\n\t\t@INotebookService _notebookService: INotebookService,\n\t\t@IEditorService private readonly _editorService: IEditorService,\n\t) {\n\t\tsuper();\n\n\t\tconst listeners = new ResourceMap<IDisposable>();\n\t\tthis._register(_notebookService.onWillAddNotebookDocument(model => {\n\t\t\tlisteners.set(model.uri, model.onWillAddRemoveCells(e => {\n\t\t\t\t// When deleting a cell, remove its breakpoints\n\t\t\t\tconst debugModel = this._debugService.getModel();\n\t\t\t\tif (!debugModel.getBreakpoints().length) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (e.rawEvent.kind !== NotebookCellsChangeType.ModelChange) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tfor (const change of e.rawEvent.changes) {\n\t\t\t\t\tconst [start, deleteCount] = change;\n\t\t\t\t\tif (deleteCount > 0) {\n\t\t\t\t\t\tconst deleted = model.cells.slice(start, start + deleteCount);\n\t\t\t\t\t\tfor (const deletedCell of deleted) {\n\t\t\t\t\t\t\tconst cellBps = debugModel.getBreakpoints({ uri: deletedCell.uri });\n\t\t\t\t\t\t\tcellBps.forEach(cellBp => this._debugService.removeBreakpoints(cellBp.getId()));\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}));\n\t\t}));\n\n\t\tthis._register(_notebookService.onWillRemoveNotebookDocument(model => {\n\t\t\tthis.updateBreakpoints(model);\n\t\t\tlisteners.get(model.uri)?.dispose();\n\t\t\tlisteners.delete(model.uri);\n\t\t}));\n\n\t\tthis._register(this._debugService.getModel().onDidChangeBreakpoints(e => {\n\t\t\tconst newCellBp = e?.added?.find(bp => hasKey(bp, { uri: true }) && bp.uri.scheme === Schemas.vscodeNotebookCell) as IBreakpoint | undefined;\n\t\t\tif (newCellBp) {\n\t\t\t\tconst parsed = CellUri.parse(newCellBp.uri);\n\t\t\t\tif (!parsed) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst editor = getNotebookEditorFromEditorPane(this._editorService.activeEditorPane);\n\t\t\t\tif (!editor || !editor.hasModel() || editor.textModel.uri.toString() !== parsed.notebook.toString()) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\n\t\t\t\tconst cell = editor.getCellByHandle(parsed.handle);\n\t\t\t\tif (!cell) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\teditor.focusElement(cell);\n\t\t\t}\n\t\t}));\n\t}\n\n\tprivate updateBreakpoints(model: NotebookTextModel): void {\n\t\tconst bps = this._debugService.getModel().getBreakpoints();\n\t\tif (!bps.length || !model.cells.length) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst idxMap = new ResourceMap<number>();\n\t\tmodel.cells.forEach((cell, i) => {\n\t\t\tidxMap.set(cell.uri, i);\n\t\t});\n\n\t\tbps.forEach(bp => {\n\t\t\tconst idx = idxMap.get(bp.uri);\n\t\t\tif (typeof idx !== 'number') {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst notebook = CellUri.parse(bp.uri)?.notebook;\n\t\t\tif (!notebook) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst newUri = CellUri.generate(notebook, idx);\n\t\t\tif (isEqual(newUri, bp.uri)) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis._debugService.removeBreakpoints(bp.getId());\n\t\t\tthis._debugService.addBreakpoints(newUri, [\n\t\t\t\t{\n\t\t\t\t\tcolumn: bp.column,\n\t\t\t\t\tcondition: bp.condition,\n\t\t\t\t\tenabled: bp.enabled,\n\t\t\t\t\thitCondition: bp.hitCondition,\n\t\t\t\t\tlogMessage: bp.logMessage,\n\t\t\t\t\tlineNumber: bp.lineNumber\n\t\t\t\t}\n\t\t\t]);\n\t\t});\n\t}\n}\n\nRegistry.as<IWorkbenchContributionsRegistry>(WorkbenchExtensions.Workbench).registerWorkbenchContribution(NotebookBreakpoints, LifecyclePhase.Restored);\n"]}