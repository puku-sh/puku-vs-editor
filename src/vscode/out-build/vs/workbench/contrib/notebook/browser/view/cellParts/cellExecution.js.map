{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/contrib/notebook/browser/view/cellParts/cellExecution.ts","vs/workbench/contrib/notebook/browser/view/cellParts/cellExecution.ts"],"names":[],"mappings":"AAAA;;;gGAGgG;;;;;;;;;;AAEhG,OAAO,KAAK,GAAG,MAAM,uCAAuC,CAAC;AAC7D,OAAO,EAAE,iBAAiB,EAAE,MAAM,wCAAwC,CAAC;AAC3E,OAAO,EAAE,eAAe,EAAE,MAAM,4CAA4C,CAAC;AAC7E,OAAO,EAAE,KAAK,EAAE,MAAM,0CAA0C,CAAC;AACjE,OAAO,EAAE,SAAS,EAAE,MAAM,4CAA4C,CAAC;AAEvE,OAAO,EAAE,eAAe,EAAE,MAAM,gBAAgB,CAAC;AACjD,OAAO,EAAE,iBAAiB,EAAE,MAAM,sCAAsC,CAAC;AAEzE,OAAO,EAAE,8BAA8B,EAAE,MAAM,kDAAkD,CAAC;AAClG,OAAO,EAAE,kBAAkB,EAAE,MAAM,wBAAwB,CAAC;AAC5D,OAAO,EAAE,oBAAoB,EAAE,MAAM,2DAA2D,CAAC;AAEjG,OAAO,EAAE,MAAM,EAAE,MAAM,wCAAwC,CAAC;AAEhE,MAAM,mCAAmC,GAAG,GAAG,CAAC;AAEzC,IAAM,iBAAiB,GAAvB,MAAM,iBAAkB,SAAQ,eAAe;IAIrD,YACkB,eAAwC,EACxC,oBAAiC,EAClB,8BAA+E;QAE/G,KAAK,EAAE,CAAC;QAJS,oBAAe,GAAf,eAAe,CAAyB;QACxC,yBAAoB,GAApB,oBAAoB,CAAa;QACD,mCAA8B,GAA9B,8BAA8B,CAAgC;QAN/F,sBAAiB,GAAG,IAAI,CAAC,SAAS,CAAC,IAAI,eAAe,EAAE,CAAC,CAAC;QAU1E,+CAA+C;QAC/C,IAAI,CAAC,oBAAoB,CAAC,SAAS,CAAC,GAAG,CAAC,sBAAsB,CAAC,CAAC;QAEhE,gCAAgC;QAChC,IAAI,CAAC,sBAAsB,GAAG,GAAG,CAAC,MAAM,CAAC,IAAI,CAAC,oBAAoB,EAAE,GAAG,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC;QAElF,yDAAyD;QACzD,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,8BAA8B,CAAC,oBAAoB,CAAC,CAAC,CAAC,EAAE;YAC3E,IAAI,IAAI,CAAC,WAAW,IAAI,MAAM,CAAC,CAAC,EAAE,EAAE,WAAW,EAAE,IAAI,EAAE,CAAC,IAAI,CAAC,CAAC,WAAW,CAAC,IAAI,CAAC,WAAW,CAAC,GAAG,CAAC,EAAE,CAAC;gBACjG,IAAI,CAAC,eAAe,EAAE,CAAC;YACxB,CAAC;QACF,CAAC,CAAC,CAAC,CAAC;QAEJ,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,eAAe,CAAC,uBAAuB,CAAC,GAAG,EAAE;YAChE,IAAI,IAAI,CAAC,WAAW,EAAE,CAAC;gBACtB,IAAI,CAAC,iBAAiB,CAAC,KAAK,EAAE,CAAC;gBAE/B,IAAI,IAAI,CAAC,eAAe,CAAC,YAAY,EAAE,CAAC;oBACvC,IAAI,CAAC,iBAAiB,CAAC,GAAG,CAAC,IAAI,CAAC,eAAe,CAAC,YAAY,CAAC,WAAW,CAAC,GAAG,EAAE;wBAC7E,IAAI,IAAI,CAAC,WAAW,EAAE,CAAC;4BACtB,IAAI,CAAC,oBAAoB,CAAC,IAAI,CAAC,WAAW,CAAC,gBAAgB,CAAC,CAAC;wBAC9D,CAAC;oBACF,CAAC,CAAC,CAAC,CAAC;gBACL,CAAC;gBAED,IAAI,CAAC,oBAAoB,CAAC,IAAI,CAAC,WAAW,CAAC,gBAAgB,CAAC,CAAC;YAC9D,CAAC;QACF,CAAC,CAAC,CAAC,CAAC;QAEJ,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,eAAe,CAAC,WAAW,CAAC,GAAG,EAAE;YACpD,IAAI,CAAC,eAAe,EAAE,CAAC;QACxB,CAAC,CAAC,CAAC,CAAC;IACL,CAAC;IAEQ,aAAa,CAAC,OAAuB;QAC7C,IAAI,CAAC,oBAAoB,CAAC,OAAO,CAAC,gBAAgB,EAAE,IAAI,CAAC,CAAC;IAC3D,CAAC;IAEQ,WAAW,CAAC,OAAuB,EAAE,CAAgC;QAC7E,IAAI,CAAC,CAAC,uBAAuB,EAAE,CAAC;YAC/B,IAAI,CAAC,oBAAoB,CAAC,OAAO,CAAC,gBAAgB,CAAC,CAAC;QACrD,CAAC;IACF,CAAC;IAEO,oBAAoB,CAAC,gBAA8C,EAAE,UAAU,GAAG,KAAK;QAC9F,IAAI,IAAI,CAAC,eAAe,CAAC,YAAY,EAAE,wBAAwB,IAAI,CAAC,CAAC,IAAI,CAAC,eAAe,CAAC,YAAY,IAAI,OAAO,gBAAgB,CAAC,cAAc,KAAK,QAAQ,CAAC,EAAE,CAAC;YAChK,gIAAgI;YAChI,IAAI,OAAO,gBAAgB,CAAC,cAAc,KAAK,QAAQ,IAAI,CAAC,UAAU,IAAI,CAAC,CAAC,IAAI,CAAC,8BAA8B,CAAC,gBAAgB,CAAC,IAAI,CAAC,WAAY,CAAC,GAAG,CAAC,EAAE,CAAC;gBACzJ,MAAM,aAAa,GAAG,IAAI,CAAC,WAAW,CAAC;gBACvC,iBAAiB,CAAC,GAAG,EAAE;oBACtB,IAAI,IAAI,CAAC,WAAW,KAAK,aAAa,EAAE,CAAC;wBACxC,IAAI,CAAC,oBAAoB,CAAC,IAAI,CAAC,WAAY,CAAC,gBAAgB,EAAE,IAAI,CAAC,CAAC;wBACpE,IAAI,CAAC,eAAe,EAAE,CAAC;oBACxB,CAAC;gBACF,CAAC,EAAE,mCAAmC,EAAE,IAAI,CAAC,eAAe,CAAC,CAAC;gBAC9D,OAAO;YACR,CAAC;YAED,MAAM,mBAAmB,GAAG,OAAO,gBAAgB,CAAC,cAAc,KAAK,QAAQ,CAAC,CAAC;gBAChF,IAAI,gBAAgB,CAAC,cAAc,GAAG,CAAC,CAAC;gBACxC,KAAK,CAAC;YACP,IAAI,CAAC,sBAAsB,CAAC,SAAS,GAAG,mBAAmB,CAAC;YAE5D,gDAAgD;YAChD,IAAI,CAAC,eAAe,EAAE,CAAC;QACxB,CAAC;aAAM,CAAC;YACP,IAAI,CAAC,sBAAsB,CAAC,SAAS,GAAG,EAAE,CAAC;QAC5C,CAAC;IACF,CAAC;IAEQ,uBAAuB,CAAC,OAAuB;QACvD,IAAI,CAAC,eAAe,EAAE,CAAC;IACxB,CAAC;IAEO,eAAe;QACtB,IAAI,CAAC,IAAI,CAAC,WAAW,EAAE,CAAC;YACvB,OAAO;QACR,CAAC;QAED,IAAI,IAAI,CAAC,WAAW,CAAC,gBAAgB,EAAE,CAAC;YACvC,GAAG,CAAC,IAAI,CAAC,IAAI,CAAC,oBAAoB,CAAC,CAAC;YACpC,OAAO;QACR,CAAC;QAED,+DAA+D;QAC/D,MAAM,aAAa,GAAG,CAAC,CAAC,IAAI,CAAC,8BAA8B,CAAC,gBAAgB,CAAC,IAAI,CAAC,WAAW,CAAC,GAAG,CAAC,CAAC;QAEnG,2DAA2D;QAC3D,MAAM,SAAS,GAAG,IAAI,CAAC,oBAAoB,CAAC,SAAS,CAAC,QAAQ,CAAC,QAAQ,CAAC,CAAC;QAEzE,IAAI,CAAC,aAAa,EAAE,CAAC;YACpB,iEAAiE;YACjE,IAAI,CAAC,oBAAoB,CAAC,SAAS,CAAC,MAAM,CAAC,QAAQ,CAAC,CAAC;YAErD,yEAAyE;YACzE,IAAI,SAAS,EAAE,CAAC;gBACf,MAAM,cAAc,GAAG,IAAI,CAAC,WAAW,CAAC,gBAAgB,CAAC,cAAc,CAAC;gBACxE,MAAM,mBAAmB,GAAG,OAAO,cAAc,KAAK,QAAQ,CAAC,CAAC;oBAC/D,IAAI,cAAc,GAAG,CAAC,CAAC;oBACvB,KAAK,CAAC;gBACP,IAAI,CAAC,sBAAsB,CAAC,SAAS,GAAG,mBAAmB,CAAC;YAC7D,CAAC;QACF,CAAC;QAED,GAAG,CAAC,IAAI,CAAC,IAAI,CAAC,oBAAoB,CAAC,CAAC;QACpC,IAAI,GAAG,GAAG,IAAI,CAAC,WAAW,CAAC,UAAU,CAAC,YAAY,GAAG,EAAE,GAAG,IAAI,CAAC,WAAW,CAAC,UAAU,CAAC,eAAe,CAAC;QAEtG,IAAI,IAAI,CAAC,WAAW,YAAY,iBAAiB,EAAE,CAAC;YACnD,MAAM,UAAU,GAAG,IAAI,CAAC,eAAe,CAAC,uBAAuB,CAAC,IAAI,CAAC,WAAW,CAAC,CAAC;YAClF,MAAM,YAAY,GAAG,UAAU,GAAG,IAAI,CAAC,WAAW,CAAC,UAAU,CAAC,qBAAqB,CAAC;YACpF,MAAM,YAAY,GAAG,IAAI,CAAC,eAAe,CAAC,YAAY,CAAC;YACvD,MAAM,UAAU,GAAG,EAAE,CAAC;YAEtB,MAAM,gBAAgB,GAAG,IAAI,CAAC,WAAW,CAAC,UAAU,CAAC,eAAe,GAAG,CAAC,CAAC;YAEzE,+DAA+D;YAC/D,MAAM,MAAM,GAAG,YAAY,GAAG,YAAY,CAAC;YAC3C,GAAG,IAAI,MAAM,CAAC;YACd,GAAG,GAAG,KAAK,CACV,GAAG,EACH,UAAU,GAAG,EAAE,EAAE,wCAAwC;YACzD,IAAI,CAAC,WAAW,CAAC,UAAU,CAAC,YAAY,GAAG,UAAU,GAAG,IAAI,CAAC,WAAW,CAAC,UAAU,CAAC,eAAe,CACnG,CAAC;YAEF,IAAI,YAAY,IAAI,YAAY,IAAI,aAAa,EAAE,CAAC;gBACnD,MAAM,aAAa,GAAG,IAAI,CAAC,sBAAsB,CAAC,SAAS,CAAC,QAAQ,CAAC,gBAAgB,CAAC,CAAC;gBACvF,2DAA2D;gBAC3D,IAAI,CAAC,aAAa,EAAE,CAAC;oBACpB,IAAI,CAAC,oBAAoB,CAAC,SAAS,CAAC,GAAG,CAAC,gBAAgB,CAAC,CAAC;oBAC1D,2DAA2D;oBAC3D,GAAG,CAAC,SAAS,CAAC,IAAI,CAAC,sBAAsB,CAAC,CAAC;oBAC3C,MAAM,IAAI,GAAG,SAAS,CAAC,MAAM,CAAC,kBAAkB,EAAE,MAAM,CAAC,CAAC;oBAC1D,GAAG,CAAC,MAAM,CAAC,IAAI,CAAC,sBAAsB,EAAE,GAAG,oBAAoB,CAAC,KAAK,IAAI,CAAC,EAAE,GAAG,CAAC,CAAC,CAAC;gBACnF,CAAC;gBACD,6DAA6D;YAC9D,CAAC;iBAAM,IAAI,CAAC,gBAAgB,IAAI,aAAa,EAAE,CAAC;gBAC/C,wGAAwG;gBACxG,MAAM,aAAa,GAAG,IAAI,CAAC,oBAAoB,CAAC,SAAS,CAAC,QAAQ,CAAC,QAAQ,CAAC,CAAC;gBAC7E,IAAI,CAAC,oBAAoB,CAAC,SAAS,CAAC,MAAM,CAAC,QAAQ,CAAC,CAAC;gBACrD,GAAG,GAAG,IAAI,CAAC,WAAW,CAAC,UAAU,CAAC,YAAY,GAAG,UAAU,CAAC,CAAC,oCAAoC;gBACjG,6EAA6E;gBAC7E,gDAAgD;gBAChD,MAAM,aAAa,GAAG,IAAI,CAAC,sBAAsB,CAAC,aAAa,CAAC,UAAU,CAAC,KAAK,IAAI,CAAC;gBACrF,IAAI,aAAa,IAAI,aAAa,EAAE,CAAC;oBACpC,MAAM,cAAc,GAAG,IAAI,CAAC,WAAW,CAAC,gBAAgB,CAAC,cAAc,CAAC;oBACxE,MAAM,mBAAmB,GAAG,OAAO,cAAc,KAAK,QAAQ,CAAC,CAAC;wBAC/D,IAAI,cAAc,GAAG,CAAC,CAAC;wBACvB,KAAK,CAAC;oBACP,IAAI,CAAC,sBAAsB,CAAC,SAAS,GAAG,mBAAmB,CAAC;gBAC7D,CAAC;YACF,CAAC;iBAAM,CAAC;gBACP,6CAA6C;gBAC7C,MAAM,eAAe,GAAG,IAAI,CAAC,oBAAoB,CAAC,SAAS,CAAC,QAAQ,CAAC,QAAQ,CAAC,CAAC;gBAC/E,IAAI,CAAC,oBAAoB,CAAC,SAAS,CAAC,MAAM,CAAC,QAAQ,CAAC,CAAC;gBAErD,2EAA2E;gBAC3E,IAAI,eAAe,EAAE,CAAC;oBACrB,MAAM,cAAc,GAAG,IAAI,CAAC,WAAW,CAAC,gBAAgB,CAAC,cAAc,CAAC;oBACxE,MAAM,mBAAmB,GAAG,OAAO,cAAc,KAAK,QAAQ,CAAC,CAAC;wBAC/D,IAAI,cAAc,GAAG,CAAC,CAAC;wBACvB,KAAK,CAAC;oBACP,IAAI,CAAC,sBAAsB,CAAC,SAAS,GAAG,mBAAmB,CAAC;gBAC7D,CAAC;YACF,CAAC;QACF,CAAC;QAED,IAAI,CAAC,oBAAoB,CAAC,KAAK,CAAC,GAAG,GAAG,GAAG,GAAG,IAAI,CAAC;IAClD,CAAC;CACD,CAAA;AAnLY,iBAAiB;IAO3B,WAAA,8BAA8B,CAAA;GAPpB,iBAAiB,CAmL7B","file":"cellExecution.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as DOM from '../../../../../../base/browser/dom.js';\nimport { disposableTimeout } from '../../../../../../base/common/async.js';\nimport { DisposableStore } from '../../../../../../base/common/lifecycle.js';\nimport { clamp } from '../../../../../../base/common/numbers.js';\nimport { ThemeIcon } from '../../../../../../base/common/themables.js';\nimport { ICellViewModel, INotebookEditorDelegate } from '../../notebookBrowser.js';\nimport { CellContentPart } from '../cellPart.js';\nimport { CodeCellViewModel } from '../../viewModel/codeCellViewModel.js';\nimport { NotebookCellInternalMetadata } from '../../../common/notebookCommon.js';\nimport { INotebookExecutionStateService } from '../../../common/notebookExecutionStateService.js';\nimport { executingStateIcon } from '../../notebookIcons.js';\nimport { renderLabelWithIcons } from '../../../../../../base/browser/ui/iconLabel/iconLabels.js';\nimport { CellViewModelStateChangeEvent } from '../../notebookViewEvents.js';\nimport { hasKey } from '../../../../../../base/common/types.js';\n\nconst UPDATE_EXECUTION_ORDER_GRACE_PERIOD = 200;\n\nexport class CellExecutionPart extends CellContentPart {\n\tprivate readonly kernelDisposables = this._register(new DisposableStore());\n\tprivate readonly _executionOrderContent: HTMLElement;\n\n\tconstructor(\n\t\tprivate readonly _notebookEditor: INotebookEditorDelegate,\n\t\tprivate readonly _executionOrderLabel: HTMLElement,\n\t\t@INotebookExecutionStateService private readonly _notebookExecutionStateService: INotebookExecutionStateService\n\t) {\n\t\tsuper();\n\n\t\t// Add class to the outer container for styling\n\t\tthis._executionOrderLabel.classList.add('cell-execution-order');\n\n\t\t// Create nested div for content\n\t\tthis._executionOrderContent = DOM.append(this._executionOrderLabel, DOM.$('div'));\n\n\t\t// Add a method to watch for cell execution state changes\n\t\tthis._register(this._notebookExecutionStateService.onDidChangeExecution(e => {\n\t\t\tif (this.currentCell && hasKey(e, { affectsCell: true }) && e.affectsCell(this.currentCell.uri)) {\n\t\t\t\tthis._updatePosition();\n\t\t\t}\n\t\t}));\n\n\t\tthis._register(this._notebookEditor.onDidChangeActiveKernel(() => {\n\t\t\tif (this.currentCell) {\n\t\t\t\tthis.kernelDisposables.clear();\n\n\t\t\t\tif (this._notebookEditor.activeKernel) {\n\t\t\t\t\tthis.kernelDisposables.add(this._notebookEditor.activeKernel.onDidChange(() => {\n\t\t\t\t\t\tif (this.currentCell) {\n\t\t\t\t\t\t\tthis.updateExecutionOrder(this.currentCell.internalMetadata);\n\t\t\t\t\t\t}\n\t\t\t\t\t}));\n\t\t\t\t}\n\n\t\t\t\tthis.updateExecutionOrder(this.currentCell.internalMetadata);\n\t\t\t}\n\t\t}));\n\n\t\tthis._register(this._notebookEditor.onDidScroll(() => {\n\t\t\tthis._updatePosition();\n\t\t}));\n\t}\n\n\toverride didRenderCell(element: ICellViewModel): void {\n\t\tthis.updateExecutionOrder(element.internalMetadata, true);\n\t}\n\n\toverride updateState(element: ICellViewModel, e: CellViewModelStateChangeEvent): void {\n\t\tif (e.internalMetadataChanged) {\n\t\t\tthis.updateExecutionOrder(element.internalMetadata);\n\t\t}\n\t}\n\n\tprivate updateExecutionOrder(internalMetadata: NotebookCellInternalMetadata, forceClear = false): void {\n\t\tif (this._notebookEditor.activeKernel?.implementsExecutionOrder || (!this._notebookEditor.activeKernel && typeof internalMetadata.executionOrder === 'number')) {\n\t\t\t// If the executionOrder was just cleared, and the cell is executing, wait just a bit before clearing the view to avoid flashing\n\t\t\tif (typeof internalMetadata.executionOrder !== 'number' && !forceClear && !!this._notebookExecutionStateService.getCellExecution(this.currentCell!.uri)) {\n\t\t\t\tconst renderingCell = this.currentCell;\n\t\t\t\tdisposableTimeout(() => {\n\t\t\t\t\tif (this.currentCell === renderingCell) {\n\t\t\t\t\t\tthis.updateExecutionOrder(this.currentCell!.internalMetadata, true);\n\t\t\t\t\t\tthis._updatePosition();\n\t\t\t\t\t}\n\t\t\t\t}, UPDATE_EXECUTION_ORDER_GRACE_PERIOD, this.cellDisposables);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst executionOrderLabel = typeof internalMetadata.executionOrder === 'number' ?\n\t\t\t\t`[${internalMetadata.executionOrder}]` :\n\t\t\t\t'[ ]';\n\t\t\tthis._executionOrderContent.innerText = executionOrderLabel;\n\n\t\t\t// Call _updatePosition to refresh sticky status\n\t\t\tthis._updatePosition();\n\t\t} else {\n\t\t\tthis._executionOrderContent.innerText = '';\n\t\t}\n\t}\n\n\toverride updateInternalLayoutNow(element: ICellViewModel): void {\n\t\tthis._updatePosition();\n\t}\n\n\tprivate _updatePosition() {\n\t\tif (!this.currentCell) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.currentCell.isInputCollapsed) {\n\t\t\tDOM.hide(this._executionOrderLabel);\n\t\t\treturn;\n\t\t}\n\n\t\t// Only show the execution order label when the cell is running\n\t\tconst cellIsRunning = !!this._notebookExecutionStateService.getCellExecution(this.currentCell.uri);\n\n\t\t// Store sticky state before potentially removing the class\n\t\tconst wasSticky = this._executionOrderLabel.classList.contains('sticky');\n\n\t\tif (!cellIsRunning) {\n\t\t\t// Keep showing the execution order label but remove sticky class\n\t\t\tthis._executionOrderLabel.classList.remove('sticky');\n\n\t\t\t// If we were sticky and cell stopped running, restore the proper content\n\t\t\tif (wasSticky) {\n\t\t\t\tconst executionOrder = this.currentCell.internalMetadata.executionOrder;\n\t\t\t\tconst executionOrderLabel = typeof executionOrder === 'number' ?\n\t\t\t\t\t`[${executionOrder}]` :\n\t\t\t\t\t'[ ]';\n\t\t\t\tthis._executionOrderContent.innerText = executionOrderLabel;\n\t\t\t}\n\t\t}\n\n\t\tDOM.show(this._executionOrderLabel);\n\t\tlet top = this.currentCell.layoutInfo.editorHeight - 22 + this.currentCell.layoutInfo.statusBarHeight;\n\n\t\tif (this.currentCell instanceof CodeCellViewModel) {\n\t\t\tconst elementTop = this._notebookEditor.getAbsoluteTopOfElement(this.currentCell);\n\t\t\tconst editorBottom = elementTop + this.currentCell.layoutInfo.outputContainerOffset;\n\t\t\tconst scrollBottom = this._notebookEditor.scrollBottom;\n\t\t\tconst lineHeight = 22;\n\n\t\t\tconst statusBarVisible = this.currentCell.layoutInfo.statusBarHeight > 0;\n\n\t\t\t// Sticky mode: cell is running and editor is not fully visible\n\t\t\tconst offset = editorBottom - scrollBottom;\n\t\t\ttop -= offset;\n\t\t\ttop = clamp(\n\t\t\t\ttop,\n\t\t\t\tlineHeight + 12, // line height + padding for single line\n\t\t\t\tthis.currentCell.layoutInfo.editorHeight - lineHeight + this.currentCell.layoutInfo.statusBarHeight\n\t\t\t);\n\n\t\t\tif (scrollBottom <= editorBottom && cellIsRunning) {\n\t\t\t\tconst isAlreadyIcon = this._executionOrderContent.classList.contains('sticky-spinner');\n\t\t\t\t// Add a class when it's in sticky mode for special styling\n\t\t\t\tif (!isAlreadyIcon) {\n\t\t\t\t\tthis._executionOrderLabel.classList.add('sticky-spinner');\n\t\t\t\t\t// Only recreate the content if we're newly becoming sticky\n\t\t\t\t\tDOM.clearNode(this._executionOrderContent);\n\t\t\t\t\tconst icon = ThemeIcon.modify(executingStateIcon, 'spin');\n\t\t\t\t\tDOM.append(this._executionOrderContent, ...renderLabelWithIcons(`$(${icon.id})`));\n\t\t\t\t}\n\t\t\t\t// When already sticky, we don't need to recreate the content\n\t\t\t} else if (!statusBarVisible && cellIsRunning) {\n\t\t\t\t// Status bar is hidden but cell is running: show execution order label at the bottom of the editor area\n\t\t\t\tconst wasStickyHere = this._executionOrderLabel.classList.contains('sticky');\n\t\t\t\tthis._executionOrderLabel.classList.remove('sticky');\n\t\t\t\ttop = this.currentCell.layoutInfo.editorHeight - lineHeight; // Place at the bottom of the editor\n\t\t\t\t// Only update content if we were previously sticky or content is not correct\n\t\t\t\t// eslint-disable-next-line no-restricted-syntax\n\t\t\t\tconst iconIsPresent = this._executionOrderContent.querySelector('.codicon') !== null;\n\t\t\t\tif (wasStickyHere || iconIsPresent) {\n\t\t\t\t\tconst executionOrder = this.currentCell.internalMetadata.executionOrder;\n\t\t\t\t\tconst executionOrderLabel = typeof executionOrder === 'number' ?\n\t\t\t\t\t\t`[${executionOrder}]` :\n\t\t\t\t\t\t'[ ]';\n\t\t\t\t\tthis._executionOrderContent.innerText = executionOrderLabel;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// Only update if the current state is sticky\n\t\t\t\tconst currentlySticky = this._executionOrderLabel.classList.contains('sticky');\n\t\t\t\tthis._executionOrderLabel.classList.remove('sticky');\n\n\t\t\t\t// When transitioning from sticky to non-sticky, restore the proper content\n\t\t\t\tif (currentlySticky) {\n\t\t\t\t\tconst executionOrder = this.currentCell.internalMetadata.executionOrder;\n\t\t\t\t\tconst executionOrderLabel = typeof executionOrder === 'number' ?\n\t\t\t\t\t\t`[${executionOrder}]` :\n\t\t\t\t\t\t'[ ]';\n\t\t\t\t\tthis._executionOrderContent.innerText = executionOrderLabel;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tthis._executionOrderLabel.style.top = `${top}px`;\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as DOM from '../../../../../../base/browser/dom.js';\nimport { disposableTimeout } from '../../../../../../base/common/async.js';\nimport { DisposableStore } from '../../../../../../base/common/lifecycle.js';\nimport { clamp } from '../../../../../../base/common/numbers.js';\nimport { ThemeIcon } from '../../../../../../base/common/themables.js';\nimport { ICellViewModel, INotebookEditorDelegate } from '../../notebookBrowser.js';\nimport { CellContentPart } from '../cellPart.js';\nimport { CodeCellViewModel } from '../../viewModel/codeCellViewModel.js';\nimport { NotebookCellInternalMetadata } from '../../../common/notebookCommon.js';\nimport { INotebookExecutionStateService } from '../../../common/notebookExecutionStateService.js';\nimport { executingStateIcon } from '../../notebookIcons.js';\nimport { renderLabelWithIcons } from '../../../../../../base/browser/ui/iconLabel/iconLabels.js';\nimport { CellViewModelStateChangeEvent } from '../../notebookViewEvents.js';\nimport { hasKey } from '../../../../../../base/common/types.js';\n\nconst UPDATE_EXECUTION_ORDER_GRACE_PERIOD = 200;\n\nexport class CellExecutionPart extends CellContentPart {\n\tprivate readonly kernelDisposables = this._register(new DisposableStore());\n\tprivate readonly _executionOrderContent: HTMLElement;\n\n\tconstructor(\n\t\tprivate readonly _notebookEditor: INotebookEditorDelegate,\n\t\tprivate readonly _executionOrderLabel: HTMLElement,\n\t\t@INotebookExecutionStateService private readonly _notebookExecutionStateService: INotebookExecutionStateService\n\t) {\n\t\tsuper();\n\n\t\t// Add class to the outer container for styling\n\t\tthis._executionOrderLabel.classList.add('cell-execution-order');\n\n\t\t// Create nested div for content\n\t\tthis._executionOrderContent = DOM.append(this._executionOrderLabel, DOM.$('div'));\n\n\t\t// Add a method to watch for cell execution state changes\n\t\tthis._register(this._notebookExecutionStateService.onDidChangeExecution(e => {\n\t\t\tif (this.currentCell && hasKey(e, { affectsCell: true }) && e.affectsCell(this.currentCell.uri)) {\n\t\t\t\tthis._updatePosition();\n\t\t\t}\n\t\t}));\n\n\t\tthis._register(this._notebookEditor.onDidChangeActiveKernel(() => {\n\t\t\tif (this.currentCell) {\n\t\t\t\tthis.kernelDisposables.clear();\n\n\t\t\t\tif (this._notebookEditor.activeKernel) {\n\t\t\t\t\tthis.kernelDisposables.add(this._notebookEditor.activeKernel.onDidChange(() => {\n\t\t\t\t\t\tif (this.currentCell) {\n\t\t\t\t\t\t\tthis.updateExecutionOrder(this.currentCell.internalMetadata);\n\t\t\t\t\t\t}\n\t\t\t\t\t}));\n\t\t\t\t}\n\n\t\t\t\tthis.updateExecutionOrder(this.currentCell.internalMetadata);\n\t\t\t}\n\t\t}));\n\n\t\tthis._register(this._notebookEditor.onDidScroll(() => {\n\t\t\tthis._updatePosition();\n\t\t}));\n\t}\n\n\toverride didRenderCell(element: ICellViewModel): void {\n\t\tthis.updateExecutionOrder(element.internalMetadata, true);\n\t}\n\n\toverride updateState(element: ICellViewModel, e: CellViewModelStateChangeEvent): void {\n\t\tif (e.internalMetadataChanged) {\n\t\t\tthis.updateExecutionOrder(element.internalMetadata);\n\t\t}\n\t}\n\n\tprivate updateExecutionOrder(internalMetadata: NotebookCellInternalMetadata, forceClear = false): void {\n\t\tif (this._notebookEditor.activeKernel?.implementsExecutionOrder || (!this._notebookEditor.activeKernel && typeof internalMetadata.executionOrder === 'number')) {\n\t\t\t// If the executionOrder was just cleared, and the cell is executing, wait just a bit before clearing the view to avoid flashing\n\t\t\tif (typeof internalMetadata.executionOrder !== 'number' && !forceClear && !!this._notebookExecutionStateService.getCellExecution(this.currentCell!.uri)) {\n\t\t\t\tconst renderingCell = this.currentCell;\n\t\t\t\tdisposableTimeout(() => {\n\t\t\t\t\tif (this.currentCell === renderingCell) {\n\t\t\t\t\t\tthis.updateExecutionOrder(this.currentCell!.internalMetadata, true);\n\t\t\t\t\t\tthis._updatePosition();\n\t\t\t\t\t}\n\t\t\t\t}, UPDATE_EXECUTION_ORDER_GRACE_PERIOD, this.cellDisposables);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst executionOrderLabel = typeof internalMetadata.executionOrder === 'number' ?\n\t\t\t\t`[${internalMetadata.executionOrder}]` :\n\t\t\t\t'[ ]';\n\t\t\tthis._executionOrderContent.innerText = executionOrderLabel;\n\n\t\t\t// Call _updatePosition to refresh sticky status\n\t\t\tthis._updatePosition();\n\t\t} else {\n\t\t\tthis._executionOrderContent.innerText = '';\n\t\t}\n\t}\n\n\toverride updateInternalLayoutNow(element: ICellViewModel): void {\n\t\tthis._updatePosition();\n\t}\n\n\tprivate _updatePosition() {\n\t\tif (!this.currentCell) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.currentCell.isInputCollapsed) {\n\t\t\tDOM.hide(this._executionOrderLabel);\n\t\t\treturn;\n\t\t}\n\n\t\t// Only show the execution order label when the cell is running\n\t\tconst cellIsRunning = !!this._notebookExecutionStateService.getCellExecution(this.currentCell.uri);\n\n\t\t// Store sticky state before potentially removing the class\n\t\tconst wasSticky = this._executionOrderLabel.classList.contains('sticky');\n\n\t\tif (!cellIsRunning) {\n\t\t\t// Keep showing the execution order label but remove sticky class\n\t\t\tthis._executionOrderLabel.classList.remove('sticky');\n\n\t\t\t// If we were sticky and cell stopped running, restore the proper content\n\t\t\tif (wasSticky) {\n\t\t\t\tconst executionOrder = this.currentCell.internalMetadata.executionOrder;\n\t\t\t\tconst executionOrderLabel = typeof executionOrder === 'number' ?\n\t\t\t\t\t`[${executionOrder}]` :\n\t\t\t\t\t'[ ]';\n\t\t\t\tthis._executionOrderContent.innerText = executionOrderLabel;\n\t\t\t}\n\t\t}\n\n\t\tDOM.show(this._executionOrderLabel);\n\t\tlet top = this.currentCell.layoutInfo.editorHeight - 22 + this.currentCell.layoutInfo.statusBarHeight;\n\n\t\tif (this.currentCell instanceof CodeCellViewModel) {\n\t\t\tconst elementTop = this._notebookEditor.getAbsoluteTopOfElement(this.currentCell);\n\t\t\tconst editorBottom = elementTop + this.currentCell.layoutInfo.outputContainerOffset;\n\t\t\tconst scrollBottom = this._notebookEditor.scrollBottom;\n\t\t\tconst lineHeight = 22;\n\n\t\t\tconst statusBarVisible = this.currentCell.layoutInfo.statusBarHeight > 0;\n\n\t\t\t// Sticky mode: cell is running and editor is not fully visible\n\t\t\tconst offset = editorBottom - scrollBottom;\n\t\t\ttop -= offset;\n\t\t\ttop = clamp(\n\t\t\t\ttop,\n\t\t\t\tlineHeight + 12, // line height + padding for single line\n\t\t\t\tthis.currentCell.layoutInfo.editorHeight - lineHeight + this.currentCell.layoutInfo.statusBarHeight\n\t\t\t);\n\n\t\t\tif (scrollBottom <= editorBottom && cellIsRunning) {\n\t\t\t\tconst isAlreadyIcon = this._executionOrderContent.classList.contains('sticky-spinner');\n\t\t\t\t// Add a class when it's in sticky mode for special styling\n\t\t\t\tif (!isAlreadyIcon) {\n\t\t\t\t\tthis._executionOrderLabel.classList.add('sticky-spinner');\n\t\t\t\t\t// Only recreate the content if we're newly becoming sticky\n\t\t\t\t\tDOM.clearNode(this._executionOrderContent);\n\t\t\t\t\tconst icon = ThemeIcon.modify(executingStateIcon, 'spin');\n\t\t\t\t\tDOM.append(this._executionOrderContent, ...renderLabelWithIcons(`$(${icon.id})`));\n\t\t\t\t}\n\t\t\t\t// When already sticky, we don't need to recreate the content\n\t\t\t} else if (!statusBarVisible && cellIsRunning) {\n\t\t\t\t// Status bar is hidden but cell is running: show execution order label at the bottom of the editor area\n\t\t\t\tconst wasStickyHere = this._executionOrderLabel.classList.contains('sticky');\n\t\t\t\tthis._executionOrderLabel.classList.remove('sticky');\n\t\t\t\ttop = this.currentCell.layoutInfo.editorHeight - lineHeight; // Place at the bottom of the editor\n\t\t\t\t// Only update content if we were previously sticky or content is not correct\n\t\t\t\t// eslint-disable-next-line no-restricted-syntax\n\t\t\t\tconst iconIsPresent = this._executionOrderContent.querySelector('.codicon') !== null;\n\t\t\t\tif (wasStickyHere || iconIsPresent) {\n\t\t\t\t\tconst executionOrder = this.currentCell.internalMetadata.executionOrder;\n\t\t\t\t\tconst executionOrderLabel = typeof executionOrder === 'number' ?\n\t\t\t\t\t\t`[${executionOrder}]` :\n\t\t\t\t\t\t'[ ]';\n\t\t\t\t\tthis._executionOrderContent.innerText = executionOrderLabel;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// Only update if the current state is sticky\n\t\t\t\tconst currentlySticky = this._executionOrderLabel.classList.contains('sticky');\n\t\t\t\tthis._executionOrderLabel.classList.remove('sticky');\n\n\t\t\t\t// When transitioning from sticky to non-sticky, restore the proper content\n\t\t\t\tif (currentlySticky) {\n\t\t\t\t\tconst executionOrder = this.currentCell.internalMetadata.executionOrder;\n\t\t\t\t\tconst executionOrderLabel = typeof executionOrder === 'number' ?\n\t\t\t\t\t\t`[${executionOrder}]` :\n\t\t\t\t\t\t'[ ]';\n\t\t\t\t\tthis._executionOrderContent.innerText = executionOrderLabel;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tthis._executionOrderLabel.style.top = `${top}px`;\n\t}\n}\n"]}