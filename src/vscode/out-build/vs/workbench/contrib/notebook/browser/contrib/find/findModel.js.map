{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/contrib/notebook/browser/contrib/find/findModel.ts","vs/workbench/contrib/notebook/browser/contrib/find/findModel.ts"],"names":[],"mappings":"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","file":"findModel.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { findFirstIdxMonotonousOrArrLen } from '../../../../../../base/common/arraysFind.js';\nimport { CancelablePromise, createCancelablePromise, Delayer } from '../../../../../../base/common/async.js';\nimport { CancellationToken } from '../../../../../../base/common/cancellation.js';\nimport { Disposable, DisposableStore } from '../../../../../../base/common/lifecycle.js';\nimport { Range } from '../../../../../../editor/common/core/range.js';\nimport { FindMatch } from '../../../../../../editor/common/model.js';\nimport { PrefixSumComputer } from '../../../../../../editor/common/model/prefixSumComputer.js';\nimport { FindReplaceState, FindReplaceStateChangedEvent } from '../../../../../../editor/contrib/find/browser/findState.js';\nimport { IConfigurationService } from '../../../../../../platform/configuration/common/configuration.js';\nimport { NotebookFindFilters } from './findFilters.js';\nimport { FindMatchDecorationModel } from './findMatchDecorationModel.js';\nimport { CellEditState, CellFindMatchWithIndex, CellWebviewFindMatch, ICellViewModel, INotebookEditor } from '../../notebookBrowser.js';\nimport { NotebookViewModel } from '../../viewModel/notebookViewModelImpl.js';\nimport { NotebookTextModel } from '../../../common/model/notebookTextModel.js';\nimport { CellKind, INotebookFindOptions, NotebookCellsChangeType } from '../../../common/notebookCommon.js';\nimport { hasKey } from '../../../../../../base/common/types.js';\n\nexport class CellFindMatchModel implements CellFindMatchWithIndex {\n\treadonly cell: ICellViewModel;\n\treadonly index: number;\n\tprivate _contentMatches: FindMatch[];\n\tprivate _webviewMatches: CellWebviewFindMatch[];\n\tget length() {\n\t\treturn this._contentMatches.length + this._webviewMatches.length;\n\t}\n\n\tget contentMatches(): FindMatch[] {\n\t\treturn this._contentMatches;\n\t}\n\n\tget webviewMatches(): CellWebviewFindMatch[] {\n\t\treturn this._webviewMatches;\n\t}\n\n\tconstructor(cell: ICellViewModel, index: number, contentMatches: FindMatch[], webviewMatches: CellWebviewFindMatch[]) {\n\t\tthis.cell = cell;\n\t\tthis.index = index;\n\t\tthis._contentMatches = contentMatches;\n\t\tthis._webviewMatches = webviewMatches;\n\t}\n\n\tgetMatch(index: number) {\n\t\tif (index >= this.length) {\n\t\t\tthrow new Error('NotebookCellFindMatch: index out of range');\n\t\t}\n\n\t\tif (index < this._contentMatches.length) {\n\t\t\treturn this._contentMatches[index];\n\t\t}\n\n\t\treturn this._webviewMatches[index - this._contentMatches.length];\n\t}\n}\n\nexport class FindModel extends Disposable {\n\tprivate _findMatches: CellFindMatchWithIndex[] = [];\n\tprotected _findMatchesStarts: PrefixSumComputer | null = null;\n\tprivate _currentMatch: number = -1;\n\n\tprivate readonly _throttledDelayer: Delayer<void>;\n\tprivate _computePromise: CancelablePromise<CellFindMatchWithIndex[] | null> | null = null;\n\tprivate readonly _modelDisposable = this._register(new DisposableStore());\n\tprivate _findMatchDecorationModel: FindMatchDecorationModel;\n\n\tget findMatches() {\n\t\treturn this._findMatches;\n\t}\n\n\tget currentMatch() {\n\t\treturn this._currentMatch;\n\t}\n\n\tconstructor(\n\t\tprivate readonly _notebookEditor: INotebookEditor,\n\t\tprivate readonly _state: FindReplaceState<NotebookFindFilters>,\n\t\t@IConfigurationService private readonly _configurationService: IConfigurationService\n\t) {\n\t\tsuper();\n\n\t\tthis._throttledDelayer = new Delayer(20);\n\t\tthis._computePromise = null;\n\n\t\tthis._register(_state.onFindReplaceStateChange(e => {\n\t\t\tthis._updateCellStates(e);\n\n\t\t\tif (e.searchString || e.isRegex || e.matchCase || e.searchScope || e.wholeWord || (e.isRevealed && this._state.isRevealed) || e.filters || e.isReplaceRevealed) {\n\t\t\t\tthis.research();\n\t\t\t}\n\n\t\t\tif (e.isRevealed && !this._state.isRevealed) {\n\t\t\t\tthis.clear();\n\t\t\t}\n\t\t}));\n\n\t\tthis._register(this._notebookEditor.onDidChangeModel(e => {\n\t\t\tthis._registerModelListener(e);\n\t\t}));\n\n\t\tthis._register(this._notebookEditor.onDidChangeCellState(e => {\n\t\t\tif (e.cell.cellKind === CellKind.Markup && e.source.editStateChanged) {\n\t\t\t\t// research when markdown cell is switching between markdown preview and editing mode.\n\t\t\t\tthis.research();\n\t\t\t}\n\t\t}));\n\n\t\tif (this._notebookEditor.hasModel()) {\n\t\t\tthis._registerModelListener(this._notebookEditor.textModel);\n\t\t}\n\n\t\tthis._findMatchDecorationModel = new FindMatchDecorationModel(this._notebookEditor, this._notebookEditor.getId());\n\t}\n\n\tprivate _updateCellStates(e: FindReplaceStateChangedEvent) {\n\t\tif (!this._state.filters?.markupInput || !this._state.filters?.markupPreview || !this._state.filters?.findScope) {\n\t\t\treturn;\n\t\t}\n\n\t\t// we only update cell state if users are using the hybrid mode (both input and preview are enabled)\n\t\tconst updateEditingState = () => {\n\t\t\tconst viewModel = this._notebookEditor.getViewModel() as NotebookViewModel | undefined;\n\t\t\tif (!viewModel) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t// search markup sources first to decide if a markup cell should be in editing mode\n\t\t\tconst wordSeparators = this._configurationService.inspect<string>('editor.wordSeparators').value;\n\t\t\tconst options: INotebookFindOptions = {\n\t\t\t\tregex: this._state.isRegex,\n\t\t\t\twholeWord: this._state.wholeWord,\n\t\t\t\tcaseSensitive: this._state.matchCase,\n\t\t\t\twordSeparators: wordSeparators,\n\t\t\t\tincludeMarkupInput: true,\n\t\t\t\tincludeCodeInput: false,\n\t\t\t\tincludeMarkupPreview: false,\n\t\t\t\tincludeOutput: false,\n\t\t\t\tfindScope: this._state.filters?.findScope,\n\t\t\t};\n\n\t\t\tconst contentMatches = viewModel.find(this._state.searchString, options);\n\t\t\tfor (let i = 0; i < viewModel.length; i++) {\n\t\t\t\tconst cell = viewModel.cellAt(i);\n\t\t\t\tif (cell && cell.cellKind === CellKind.Markup) {\n\t\t\t\t\tconst foundContentMatch = contentMatches.find(m => m.cell.handle === cell.handle && m.contentMatches.length > 0);\n\t\t\t\t\tconst targetState = foundContentMatch ? CellEditState.Editing : CellEditState.Preview;\n\t\t\t\t\tconst currentEditingState = cell.getEditState();\n\n\t\t\t\t\tif (currentEditingState === CellEditState.Editing && cell.editStateSource !== 'find') {\n\t\t\t\t\t\t// it's already in editing mode, we should not update\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\t\tif (currentEditingState !== targetState) {\n\t\t\t\t\t\tcell.updateEditState(targetState, 'find');\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\n\t\tif (e.isReplaceRevealed && !this._state.isReplaceRevealed) {\n\t\t\t// replace is hidden, we need to switch all markdown cells to preview mode\n\t\t\tconst viewModel = this._notebookEditor.getViewModel() as NotebookViewModel | undefined;\n\t\t\tif (!viewModel) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tfor (let i = 0; i < viewModel.length; i++) {\n\t\t\t\tconst cell = viewModel.cellAt(i);\n\t\t\t\tif (cell && cell.cellKind === CellKind.Markup) {\n\t\t\t\t\tif (cell.getEditState() === CellEditState.Editing && cell.editStateSource === 'find') {\n\t\t\t\t\t\tcell.updateEditState(CellEditState.Preview, 'find');\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn;\n\t\t}\n\n\t\tif (e.isReplaceRevealed) {\n\t\t\tupdateEditingState();\n\t\t} else if ((e.filters || e.isRevealed || e.searchString || e.replaceString) && this._state.isRevealed && this._state.isReplaceRevealed) {\n\t\t\tupdateEditingState();\n\t\t}\n\t}\n\n\tensureFindMatches() {\n\t\tif (!this._findMatchesStarts) {\n\t\t\tthis.set(this._findMatches, true);\n\t\t}\n\t}\n\n\tgetCurrentMatch() {\n\t\tconst nextIndex = this._findMatchesStarts!.getIndexOf(this._currentMatch);\n\t\tconst cell = this._findMatches[nextIndex.index].cell;\n\t\tconst match = this._findMatches[nextIndex.index].getMatch(nextIndex.remainder);\n\n\t\treturn {\n\t\t\tcell,\n\t\t\tmatch,\n\t\t\tisModelMatch: nextIndex.remainder < this._findMatches[nextIndex.index].contentMatches.length\n\t\t};\n\t}\n\n\trefreshCurrentMatch(focus: { cell: ICellViewModel; range: Range }) {\n\t\tconst findMatchIndex = this.findMatches.findIndex(match => match.cell === focus.cell);\n\n\t\tif (findMatchIndex === -1) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst findMatch = this.findMatches[findMatchIndex];\n\t\tconst index = findMatch.contentMatches.findIndex(match => match.range.intersectRanges(focus.range) !== null);\n\n\t\tif (index === undefined) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst matchesBefore = findMatchIndex === 0 ? 0 : (this._findMatchesStarts?.getPrefixSum(findMatchIndex - 1) ?? 0);\n\t\tthis._currentMatch = matchesBefore + index;\n\n\t\tthis.highlightCurrentFindMatchDecoration(findMatchIndex, index).then(async offset => {\n\t\t\tawait this.revealCellRange(findMatchIndex, index, offset);\n\n\t\t\tthis._state.changeMatchInfo(\n\t\t\t\tthis._currentMatch,\n\t\t\t\tthis._findMatches.reduce((p, c) => p + c.length, 0),\n\t\t\t\tundefined\n\t\t\t);\n\t\t});\n\t}\n\n\tfind(option: { previous: boolean } | { index: number }) {\n\t\tif (!this.findMatches.length) {\n\t\t\treturn;\n\t\t}\n\n\t\t// let currCell;\n\t\tif (!this._findMatchesStarts) {\n\t\t\tthis.set(this._findMatches, true);\n\t\t\tif (hasKey(option, { index: true })) {\n\t\t\t\tthis._currentMatch = option.index;\n\t\t\t}\n\t\t} else {\n\t\t\t// const currIndex = this._findMatchesStarts!.getIndexOf(this._currentMatch);\n\t\t\t// currCell = this._findMatches[currIndex.index].cell;\n\t\t\tconst totalVal = this._findMatchesStarts.getTotalSum();\n\t\t\tif (hasKey(option, { index: true })) {\n\t\t\t\tthis._currentMatch = option.index;\n\t\t\t}\n\t\t\telse if (this._currentMatch === -1) {\n\t\t\t\tthis._currentMatch = option.previous ? totalVal - 1 : 0;\n\t\t\t} else {\n\t\t\t\tconst nextVal = (this._currentMatch + (option.previous ? -1 : 1) + totalVal) % totalVal;\n\t\t\t\tthis._currentMatch = nextVal;\n\t\t\t}\n\t\t}\n\n\t\tconst nextIndex = this._findMatchesStarts!.getIndexOf(this._currentMatch);\n\t\t// const newFocusedCell = this._findMatches[nextIndex.index].cell;\n\t\tthis.highlightCurrentFindMatchDecoration(nextIndex.index, nextIndex.remainder).then(async offset => {\n\t\t\tawait this.revealCellRange(nextIndex.index, nextIndex.remainder, offset);\n\n\t\t\tthis._state.changeMatchInfo(\n\t\t\t\tthis._currentMatch,\n\t\t\t\tthis._findMatches.reduce((p, c) => p + c.length, 0),\n\t\t\t\tundefined\n\t\t\t);\n\t\t});\n\t}\n\n\tprivate async revealCellRange(cellIndex: number, matchIndex: number, outputOffset: number | null) {\n\t\tconst findMatch = this._findMatches[cellIndex];\n\t\tif (matchIndex >= findMatch.contentMatches.length) {\n\t\t\t// reveal output range\n\t\t\tthis._notebookEditor.focusElement(findMatch.cell);\n\t\t\tconst index = this._notebookEditor.getCellIndex(findMatch.cell);\n\t\t\tif (index !== undefined) {\n\t\t\t\t// const range: ICellRange = { start: index, end: index + 1 };\n\t\t\t\tthis._notebookEditor.revealCellOffsetInCenter(findMatch.cell, outputOffset ?? 0);\n\t\t\t}\n\t\t} else {\n\t\t\tconst match = findMatch.getMatch(matchIndex) as FindMatch;\n\t\t\tif (findMatch.cell.getEditState() !== CellEditState.Editing) {\n\t\t\t\tfindMatch.cell.updateEditState(CellEditState.Editing, 'find');\n\t\t\t}\n\t\t\tfindMatch.cell.isInputCollapsed = false;\n\t\t\tthis._notebookEditor.focusElement(findMatch.cell);\n\t\t\tthis._notebookEditor.setCellEditorSelection(findMatch.cell, match.range);\n\t\t\t// First ensure the cell is visible in the notebook viewport\n\t\t\tawait this._notebookEditor.revealInView(findMatch.cell);\n\t\t\t// Then reveal the specific range within the cell editor\n\t\t\tthis._notebookEditor.revealRangeInCenterIfOutsideViewportAsync(findMatch.cell, match.range);\n\t\t}\n\t}\n\n\tprivate _registerModelListener(notebookTextModel?: NotebookTextModel) {\n\t\tthis._modelDisposable.clear();\n\n\t\tif (notebookTextModel) {\n\t\t\tthis._modelDisposable.add(notebookTextModel.onDidChangeContent((e) => {\n\t\t\t\tif (!e.rawEvents.some(event => event.kind === NotebookCellsChangeType.ChangeCellContent || event.kind === NotebookCellsChangeType.ModelChange)) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tthis.research();\n\t\t\t}));\n\t\t}\n\n\t\tthis.research();\n\t}\n\n\tasync research() {\n\t\treturn this._throttledDelayer.trigger(async () => {\n\t\t\tthis._state.change({ isSearching: true }, false);\n\t\t\tawait this._research();\n\t\t\tthis._state.change({ isSearching: false }, false);\n\t\t});\n\t}\n\n\tasync _research() {\n\t\tthis._computePromise?.cancel();\n\n\t\tif (!this._state.isRevealed || !this._notebookEditor.hasModel()) {\n\t\t\tthis.set([], false);\n\t\t\treturn;\n\t\t}\n\n\t\tthis._computePromise = createCancelablePromise(token => this._compute(token));\n\n\t\tconst findMatches = await this._computePromise;\n\t\tif (!findMatches) {\n\t\t\tthis.set([], false);\n\t\t\treturn;\n\t\t}\n\n\t\tif (findMatches.length === 0) {\n\t\t\tthis.set([], false);\n\t\t\treturn;\n\t\t}\n\n\t\tconst findFirstMatchAfterCellIndex = (cellIndex: number) => {\n\t\t\tconst matchAfterSelection = findFirstIdxMonotonousOrArrLen(findMatches.map(match => match.index), index => index >= cellIndex);\n\t\t\tthis._updateCurrentMatch(findMatches, this._matchesCountBeforeIndex(findMatches, matchAfterSelection));\n\t\t};\n\n\t\tif (this._currentMatch === -1) {\n\t\t\t// no active current match\n\t\t\tif (this._notebookEditor.getLength() === 0) {\n\t\t\t\tthis.set(findMatches, false);\n\t\t\t\treturn;\n\t\t\t} else {\n\t\t\t\tconst focus = this._notebookEditor.getFocus().start;\n\t\t\t\tfindFirstMatchAfterCellIndex(focus);\n\t\t\t\tthis.set(findMatches, false);\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tconst oldCurrIndex = this._findMatchesStarts!.getIndexOf(this._currentMatch);\n\t\tconst oldCurrCell = this._findMatches[oldCurrIndex.index].cell;\n\t\tconst oldCurrMatchCellIndex = this._notebookEditor.getCellIndex(oldCurrCell);\n\n\n\t\tif (oldCurrMatchCellIndex < 0) {\n\t\t\t// the cell containing the active match is deleted\n\t\t\tif (this._notebookEditor.getLength() === 0) {\n\t\t\t\tthis.set(findMatches, false);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tfindFirstMatchAfterCellIndex(oldCurrMatchCellIndex);\n\t\t\treturn;\n\t\t}\n\n\t\t// the cell still exist\n\t\tconst cell = this._notebookEditor.cellAt(oldCurrMatchCellIndex);\n\t\t// we will try restore the active find match in this cell, if it contains any find match\n\n\t\tif (cell.cellKind === CellKind.Markup && cell.getEditState() === CellEditState.Preview) {\n\t\t\t// find first match in this cell or below\n\t\t\tfindFirstMatchAfterCellIndex(oldCurrMatchCellIndex);\n\t\t\treturn;\n\t\t}\n\n\t\t// the cell is a markup cell in editing mode or a code cell, both should have monaco editor rendered\n\n\t\tif (!this._findMatchDecorationModel.currentMatchDecorations) {\n\t\t\t// no current highlight decoration\n\t\t\tfindFirstMatchAfterCellIndex(oldCurrMatchCellIndex);\n\t\t\treturn;\n\t\t}\n\n\t\t// check if there is monaco editor selection and find the first match, otherwise find the first match above current cell\n\t\t// this._findMatches[cellIndex].matches[matchIndex].range\n\t\tif (this._findMatchDecorationModel.currentMatchDecorations.kind === 'input') {\n\t\t\tconst currentMatchDecorationId = this._findMatchDecorationModel.currentMatchDecorations.decorations.find(decoration => decoration.ownerId === cell.handle);\n\n\t\t\tif (!currentMatchDecorationId) {\n\t\t\t\t// current match decoration is no longer valid\n\t\t\t\tfindFirstMatchAfterCellIndex(oldCurrMatchCellIndex);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst matchAfterSelection = findFirstIdxMonotonousOrArrLen(findMatches, match => match.index >= oldCurrMatchCellIndex) % findMatches.length;\n\t\t\tif (findMatches[matchAfterSelection].index > oldCurrMatchCellIndex) {\n\t\t\t\t// there is no search result in curr cell anymore, find the nearest one (from top to bottom)\n\t\t\t\tthis._updateCurrentMatch(findMatches, this._matchesCountBeforeIndex(findMatches, matchAfterSelection));\n\t\t\t\treturn;\n\t\t\t} else {\n\t\t\t\t// there are still some search results in current cell\n\t\t\t\tlet currMatchRangeInEditor = cell.editorAttached && currentMatchDecorationId.decorations[0] ? cell.getCellDecorationRange(currentMatchDecorationId.decorations[0]) : null;\n\n\t\t\t\tif (currMatchRangeInEditor === null && oldCurrIndex.remainder < this._findMatches[oldCurrIndex.index].contentMatches.length) {\n\t\t\t\t\tcurrMatchRangeInEditor = (this._findMatches[oldCurrIndex.index].getMatch(oldCurrIndex.remainder) as FindMatch).range;\n\t\t\t\t}\n\n\t\t\t\tif (currMatchRangeInEditor !== null) {\n\t\t\t\t\t// we find a range for the previous current match, let's find the nearest one after it (can overlap)\n\t\t\t\t\tconst cellMatch = findMatches[matchAfterSelection];\n\t\t\t\t\tconst matchAfterOldSelection = findFirstIdxMonotonousOrArrLen(cellMatch.contentMatches, match => Range.compareRangesUsingStarts((match as FindMatch).range, currMatchRangeInEditor) >= 0);\n\t\t\t\t\tthis._updateCurrentMatch(findMatches, this._matchesCountBeforeIndex(findMatches, matchAfterSelection) + matchAfterOldSelection);\n\t\t\t\t} else {\n\t\t\t\t\t// no range found, let's fall back to finding the nearest match\n\t\t\t\t\tthis._updateCurrentMatch(findMatches, this._matchesCountBeforeIndex(findMatches, matchAfterSelection));\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\t// output now has the highlight\n\t\t\tconst matchAfterSelection = findFirstIdxMonotonousOrArrLen(findMatches.map(match => match.index), index => index >= oldCurrMatchCellIndex) % findMatches.length;\n\t\t\tthis._updateCurrentMatch(findMatches, this._matchesCountBeforeIndex(findMatches, matchAfterSelection));\n\t\t}\n\t}\n\n\tprivate set(cellFindMatches: CellFindMatchWithIndex[] | null, autoStart: boolean): void {\n\t\tif (!cellFindMatches || !cellFindMatches.length) {\n\t\t\tthis._findMatches = [];\n\t\t\tthis._findMatchDecorationModel.setAllFindMatchesDecorations([]);\n\n\t\t\tthis.constructFindMatchesStarts();\n\t\t\tthis._currentMatch = -1;\n\t\t\tthis._findMatchDecorationModel.clearCurrentFindMatchDecoration();\n\n\t\t\tthis._state.changeMatchInfo(\n\t\t\t\tthis._currentMatch,\n\t\t\t\tthis._findMatches.reduce((p, c) => p + c.length, 0),\n\t\t\t\tundefined\n\t\t\t);\n\t\t\treturn;\n\t\t}\n\n\t\t// all matches\n\t\tthis._findMatches = cellFindMatches;\n\t\tthis._findMatchDecorationModel.setAllFindMatchesDecorations(cellFindMatches || []);\n\n\t\t// current match\n\t\tthis.constructFindMatchesStarts();\n\n\t\tif (autoStart) {\n\t\t\tthis._currentMatch = 0;\n\t\t\tthis.highlightCurrentFindMatchDecoration(0, 0);\n\t\t}\n\n\t\tthis._state.changeMatchInfo(\n\t\t\tthis._currentMatch,\n\t\t\tthis._findMatches.reduce((p, c) => p + c.length, 0),\n\t\t\tundefined\n\t\t);\n\t}\n\n\tprivate async _compute(token: CancellationToken): Promise<CellFindMatchWithIndex[] | null> {\n\t\tif (!this._notebookEditor.hasModel()) {\n\t\t\treturn null;\n\t\t}\n\t\tlet ret: CellFindMatchWithIndex[] | null = null;\n\t\tconst val = this._state.searchString;\n\t\tconst wordSeparators = this._configurationService.inspect<string>('editor.wordSeparators').value;\n\n\t\tconst options: INotebookFindOptions = {\n\t\t\tregex: this._state.isRegex,\n\t\t\twholeWord: this._state.wholeWord,\n\t\t\tcaseSensitive: this._state.matchCase,\n\t\t\twordSeparators: wordSeparators,\n\t\t\tincludeMarkupInput: this._state.filters?.markupInput ?? true,\n\t\t\tincludeCodeInput: this._state.filters?.codeInput ?? true,\n\t\t\tincludeMarkupPreview: !!this._state.filters?.markupPreview,\n\t\t\tincludeOutput: !!this._state.filters?.codeOutput,\n\t\t\tfindScope: this._state.filters?.findScope,\n\t\t};\n\n\t\tret = await this._notebookEditor.find(val, options, token);\n\n\t\tif (token.isCancellationRequested) {\n\t\t\treturn null;\n\t\t}\n\n\t\treturn ret;\n\t}\n\n\tprivate _updateCurrentMatch(findMatches: CellFindMatchWithIndex[], currentMatchesPosition: number) {\n\t\tthis._currentMatch = currentMatchesPosition % findMatches.length;\n\t\tthis.set(findMatches, false);\n\t\tconst nextIndex = this._findMatchesStarts!.getIndexOf(this._currentMatch);\n\t\tthis.highlightCurrentFindMatchDecoration(nextIndex.index, nextIndex.remainder);\n\n\t\tthis._state.changeMatchInfo(\n\t\t\tthis._currentMatch,\n\t\t\tthis._findMatches.reduce((p, c) => p + c.length, 0),\n\t\t\tundefined\n\t\t);\n\t}\n\n\tprivate _matchesCountBeforeIndex(findMatches: CellFindMatchWithIndex[], index: number) {\n\t\tlet prevMatchesCount = 0;\n\t\tfor (let i = 0; i < index; i++) {\n\t\t\tprevMatchesCount += findMatches[i].length;\n\t\t}\n\n\t\treturn prevMatchesCount;\n\t}\n\n\tprivate constructFindMatchesStarts() {\n\t\tif (this._findMatches && this._findMatches.length) {\n\t\t\tconst values = new Uint32Array(this._findMatches.length);\n\t\t\tfor (let i = 0; i < this._findMatches.length; i++) {\n\t\t\t\tvalues[i] = this._findMatches[i].length;\n\t\t\t}\n\n\t\t\tthis._findMatchesStarts = new PrefixSumComputer(values);\n\t\t} else {\n\t\t\tthis._findMatchesStarts = null;\n\t\t}\n\t}\n\n\n\tprivate async highlightCurrentFindMatchDecoration(cellIndex: number, matchIndex: number): Promise<number | null> {\n\t\tconst cell = this._findMatches[cellIndex].cell;\n\t\tconst match = this._findMatches[cellIndex].getMatch(matchIndex);\n\n\t\tif (matchIndex < this._findMatches[cellIndex].contentMatches.length) {\n\t\t\treturn this._findMatchDecorationModel.highlightCurrentFindMatchDecorationInCell(cell, (match as FindMatch).range);\n\t\t} else {\n\t\t\treturn this._findMatchDecorationModel.highlightCurrentFindMatchDecorationInWebview(cell, (match as CellWebviewFindMatch).index);\n\t\t}\n\t}\n\n\tclear() {\n\t\tthis._computePromise?.cancel();\n\t\tthis._throttledDelayer.cancel();\n\t\tthis.set([], false);\n\t}\n\n\toverride dispose() {\n\t\tthis._findMatchDecorationModel.dispose();\n\t\tsuper.dispose();\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { findFirstIdxMonotonousOrArrLen } from '../../../../../../base/common/arraysFind.js';\nimport { CancelablePromise, createCancelablePromise, Delayer } from '../../../../../../base/common/async.js';\nimport { CancellationToken } from '../../../../../../base/common/cancellation.js';\nimport { Disposable, DisposableStore } from '../../../../../../base/common/lifecycle.js';\nimport { Range } from '../../../../../../editor/common/core/range.js';\nimport { FindMatch } from '../../../../../../editor/common/model.js';\nimport { PrefixSumComputer } from '../../../../../../editor/common/model/prefixSumComputer.js';\nimport { FindReplaceState, FindReplaceStateChangedEvent } from '../../../../../../editor/contrib/find/browser/findState.js';\nimport { IConfigurationService } from '../../../../../../platform/configuration/common/configuration.js';\nimport { NotebookFindFilters } from './findFilters.js';\nimport { FindMatchDecorationModel } from './findMatchDecorationModel.js';\nimport { CellEditState, CellFindMatchWithIndex, CellWebviewFindMatch, ICellViewModel, INotebookEditor } from '../../notebookBrowser.js';\nimport { NotebookViewModel } from '../../viewModel/notebookViewModelImpl.js';\nimport { NotebookTextModel } from '../../../common/model/notebookTextModel.js';\nimport { CellKind, INotebookFindOptions, NotebookCellsChangeType } from '../../../common/notebookCommon.js';\nimport { hasKey } from '../../../../../../base/common/types.js';\n\nexport class CellFindMatchModel implements CellFindMatchWithIndex {\n\treadonly cell: ICellViewModel;\n\treadonly index: number;\n\tprivate _contentMatches: FindMatch[];\n\tprivate _webviewMatches: CellWebviewFindMatch[];\n\tget length() {\n\t\treturn this._contentMatches.length + this._webviewMatches.length;\n\t}\n\n\tget contentMatches(): FindMatch[] {\n\t\treturn this._contentMatches;\n\t}\n\n\tget webviewMatches(): CellWebviewFindMatch[] {\n\t\treturn this._webviewMatches;\n\t}\n\n\tconstructor(cell: ICellViewModel, index: number, contentMatches: FindMatch[], webviewMatches: CellWebviewFindMatch[]) {\n\t\tthis.cell = cell;\n\t\tthis.index = index;\n\t\tthis._contentMatches = contentMatches;\n\t\tthis._webviewMatches = webviewMatches;\n\t}\n\n\tgetMatch(index: number) {\n\t\tif (index >= this.length) {\n\t\t\tthrow new Error('NotebookCellFindMatch: index out of range');\n\t\t}\n\n\t\tif (index < this._contentMatches.length) {\n\t\t\treturn this._contentMatches[index];\n\t\t}\n\n\t\treturn this._webviewMatches[index - this._contentMatches.length];\n\t}\n}\n\nexport class FindModel extends Disposable {\n\tprivate _findMatches: CellFindMatchWithIndex[] = [];\n\tprotected _findMatchesStarts: PrefixSumComputer | null = null;\n\tprivate _currentMatch: number = -1;\n\n\tprivate readonly _throttledDelayer: Delayer<void>;\n\tprivate _computePromise: CancelablePromise<CellFindMatchWithIndex[] | null> | null = null;\n\tprivate readonly _modelDisposable = this._register(new DisposableStore());\n\tprivate _findMatchDecorationModel: FindMatchDecorationModel;\n\n\tget findMatches() {\n\t\treturn this._findMatches;\n\t}\n\n\tget currentMatch() {\n\t\treturn this._currentMatch;\n\t}\n\n\tconstructor(\n\t\tprivate readonly _notebookEditor: INotebookEditor,\n\t\tprivate readonly _state: FindReplaceState<NotebookFindFilters>,\n\t\t@IConfigurationService private readonly _configurationService: IConfigurationService\n\t) {\n\t\tsuper();\n\n\t\tthis._throttledDelayer = new Delayer(20);\n\t\tthis._computePromise = null;\n\n\t\tthis._register(_state.onFindReplaceStateChange(e => {\n\t\t\tthis._updateCellStates(e);\n\n\t\t\tif (e.searchString || e.isRegex || e.matchCase || e.searchScope || e.wholeWord || (e.isRevealed && this._state.isRevealed) || e.filters || e.isReplaceRevealed) {\n\t\t\t\tthis.research();\n\t\t\t}\n\n\t\t\tif (e.isRevealed && !this._state.isRevealed) {\n\t\t\t\tthis.clear();\n\t\t\t}\n\t\t}));\n\n\t\tthis._register(this._notebookEditor.onDidChangeModel(e => {\n\t\t\tthis._registerModelListener(e);\n\t\t}));\n\n\t\tthis._register(this._notebookEditor.onDidChangeCellState(e => {\n\t\t\tif (e.cell.cellKind === CellKind.Markup && e.source.editStateChanged) {\n\t\t\t\t// research when markdown cell is switching between markdown preview and editing mode.\n\t\t\t\tthis.research();\n\t\t\t}\n\t\t}));\n\n\t\tif (this._notebookEditor.hasModel()) {\n\t\t\tthis._registerModelListener(this._notebookEditor.textModel);\n\t\t}\n\n\t\tthis._findMatchDecorationModel = new FindMatchDecorationModel(this._notebookEditor, this._notebookEditor.getId());\n\t}\n\n\tprivate _updateCellStates(e: FindReplaceStateChangedEvent) {\n\t\tif (!this._state.filters?.markupInput || !this._state.filters?.markupPreview || !this._state.filters?.findScope) {\n\t\t\treturn;\n\t\t}\n\n\t\t// we only update cell state if users are using the hybrid mode (both input and preview are enabled)\n\t\tconst updateEditingState = () => {\n\t\t\tconst viewModel = this._notebookEditor.getViewModel() as NotebookViewModel | undefined;\n\t\t\tif (!viewModel) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t// search markup sources first to decide if a markup cell should be in editing mode\n\t\t\tconst wordSeparators = this._configurationService.inspect<string>('editor.wordSeparators').value;\n\t\t\tconst options: INotebookFindOptions = {\n\t\t\t\tregex: this._state.isRegex,\n\t\t\t\twholeWord: this._state.wholeWord,\n\t\t\t\tcaseSensitive: this._state.matchCase,\n\t\t\t\twordSeparators: wordSeparators,\n\t\t\t\tincludeMarkupInput: true,\n\t\t\t\tincludeCodeInput: false,\n\t\t\t\tincludeMarkupPreview: false,\n\t\t\t\tincludeOutput: false,\n\t\t\t\tfindScope: this._state.filters?.findScope,\n\t\t\t};\n\n\t\t\tconst contentMatches = viewModel.find(this._state.searchString, options);\n\t\t\tfor (let i = 0; i < viewModel.length; i++) {\n\t\t\t\tconst cell = viewModel.cellAt(i);\n\t\t\t\tif (cell && cell.cellKind === CellKind.Markup) {\n\t\t\t\t\tconst foundContentMatch = contentMatches.find(m => m.cell.handle === cell.handle && m.contentMatches.length > 0);\n\t\t\t\t\tconst targetState = foundContentMatch ? CellEditState.Editing : CellEditState.Preview;\n\t\t\t\t\tconst currentEditingState = cell.getEditState();\n\n\t\t\t\t\tif (currentEditingState === CellEditState.Editing && cell.editStateSource !== 'find') {\n\t\t\t\t\t\t// it's already in editing mode, we should not update\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\t\tif (currentEditingState !== targetState) {\n\t\t\t\t\t\tcell.updateEditState(targetState, 'find');\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\n\t\tif (e.isReplaceRevealed && !this._state.isReplaceRevealed) {\n\t\t\t// replace is hidden, we need to switch all markdown cells to preview mode\n\t\t\tconst viewModel = this._notebookEditor.getViewModel() as NotebookViewModel | undefined;\n\t\t\tif (!viewModel) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tfor (let i = 0; i < viewModel.length; i++) {\n\t\t\t\tconst cell = viewModel.cellAt(i);\n\t\t\t\tif (cell && cell.cellKind === CellKind.Markup) {\n\t\t\t\t\tif (cell.getEditState() === CellEditState.Editing && cell.editStateSource === 'find') {\n\t\t\t\t\t\tcell.updateEditState(CellEditState.Preview, 'find');\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn;\n\t\t}\n\n\t\tif (e.isReplaceRevealed) {\n\t\t\tupdateEditingState();\n\t\t} else if ((e.filters || e.isRevealed || e.searchString || e.replaceString) && this._state.isRevealed && this._state.isReplaceRevealed) {\n\t\t\tupdateEditingState();\n\t\t}\n\t}\n\n\tensureFindMatches() {\n\t\tif (!this._findMatchesStarts) {\n\t\t\tthis.set(this._findMatches, true);\n\t\t}\n\t}\n\n\tgetCurrentMatch() {\n\t\tconst nextIndex = this._findMatchesStarts!.getIndexOf(this._currentMatch);\n\t\tconst cell = this._findMatches[nextIndex.index].cell;\n\t\tconst match = this._findMatches[nextIndex.index].getMatch(nextIndex.remainder);\n\n\t\treturn {\n\t\t\tcell,\n\t\t\tmatch,\n\t\t\tisModelMatch: nextIndex.remainder < this._findMatches[nextIndex.index].contentMatches.length\n\t\t};\n\t}\n\n\trefreshCurrentMatch(focus: { cell: ICellViewModel; range: Range }) {\n\t\tconst findMatchIndex = this.findMatches.findIndex(match => match.cell === focus.cell);\n\n\t\tif (findMatchIndex === -1) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst findMatch = this.findMatches[findMatchIndex];\n\t\tconst index = findMatch.contentMatches.findIndex(match => match.range.intersectRanges(focus.range) !== null);\n\n\t\tif (index === undefined) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst matchesBefore = findMatchIndex === 0 ? 0 : (this._findMatchesStarts?.getPrefixSum(findMatchIndex - 1) ?? 0);\n\t\tthis._currentMatch = matchesBefore + index;\n\n\t\tthis.highlightCurrentFindMatchDecoration(findMatchIndex, index).then(async offset => {\n\t\t\tawait this.revealCellRange(findMatchIndex, index, offset);\n\n\t\t\tthis._state.changeMatchInfo(\n\t\t\t\tthis._currentMatch,\n\t\t\t\tthis._findMatches.reduce((p, c) => p + c.length, 0),\n\t\t\t\tundefined\n\t\t\t);\n\t\t});\n\t}\n\n\tfind(option: { previous: boolean } | { index: number }) {\n\t\tif (!this.findMatches.length) {\n\t\t\treturn;\n\t\t}\n\n\t\t// let currCell;\n\t\tif (!this._findMatchesStarts) {\n\t\t\tthis.set(this._findMatches, true);\n\t\t\tif (hasKey(option, { index: true })) {\n\t\t\t\tthis._currentMatch = option.index;\n\t\t\t}\n\t\t} else {\n\t\t\t// const currIndex = this._findMatchesStarts!.getIndexOf(this._currentMatch);\n\t\t\t// currCell = this._findMatches[currIndex.index].cell;\n\t\t\tconst totalVal = this._findMatchesStarts.getTotalSum();\n\t\t\tif (hasKey(option, { index: true })) {\n\t\t\t\tthis._currentMatch = option.index;\n\t\t\t}\n\t\t\telse if (this._currentMatch === -1) {\n\t\t\t\tthis._currentMatch = option.previous ? totalVal - 1 : 0;\n\t\t\t} else {\n\t\t\t\tconst nextVal = (this._currentMatch + (option.previous ? -1 : 1) + totalVal) % totalVal;\n\t\t\t\tthis._currentMatch = nextVal;\n\t\t\t}\n\t\t}\n\n\t\tconst nextIndex = this._findMatchesStarts!.getIndexOf(this._currentMatch);\n\t\t// const newFocusedCell = this._findMatches[nextIndex.index].cell;\n\t\tthis.highlightCurrentFindMatchDecoration(nextIndex.index, nextIndex.remainder).then(async offset => {\n\t\t\tawait this.revealCellRange(nextIndex.index, nextIndex.remainder, offset);\n\n\t\t\tthis._state.changeMatchInfo(\n\t\t\t\tthis._currentMatch,\n\t\t\t\tthis._findMatches.reduce((p, c) => p + c.length, 0),\n\t\t\t\tundefined\n\t\t\t);\n\t\t});\n\t}\n\n\tprivate async revealCellRange(cellIndex: number, matchIndex: number, outputOffset: number | null) {\n\t\tconst findMatch = this._findMatches[cellIndex];\n\t\tif (matchIndex >= findMatch.contentMatches.length) {\n\t\t\t// reveal output range\n\t\t\tthis._notebookEditor.focusElement(findMatch.cell);\n\t\t\tconst index = this._notebookEditor.getCellIndex(findMatch.cell);\n\t\t\tif (index !== undefined) {\n\t\t\t\t// const range: ICellRange = { start: index, end: index + 1 };\n\t\t\t\tthis._notebookEditor.revealCellOffsetInCenter(findMatch.cell, outputOffset ?? 0);\n\t\t\t}\n\t\t} else {\n\t\t\tconst match = findMatch.getMatch(matchIndex) as FindMatch;\n\t\t\tif (findMatch.cell.getEditState() !== CellEditState.Editing) {\n\t\t\t\tfindMatch.cell.updateEditState(CellEditState.Editing, 'find');\n\t\t\t}\n\t\t\tfindMatch.cell.isInputCollapsed = false;\n\t\t\tthis._notebookEditor.focusElement(findMatch.cell);\n\t\t\tthis._notebookEditor.setCellEditorSelection(findMatch.cell, match.range);\n\t\t\t// First ensure the cell is visible in the notebook viewport\n\t\t\tawait this._notebookEditor.revealInView(findMatch.cell);\n\t\t\t// Then reveal the specific range within the cell editor\n\t\t\tthis._notebookEditor.revealRangeInCenterIfOutsideViewportAsync(findMatch.cell, match.range);\n\t\t}\n\t}\n\n\tprivate _registerModelListener(notebookTextModel?: NotebookTextModel) {\n\t\tthis._modelDisposable.clear();\n\n\t\tif (notebookTextModel) {\n\t\t\tthis._modelDisposable.add(notebookTextModel.onDidChangeContent((e) => {\n\t\t\t\tif (!e.rawEvents.some(event => event.kind === NotebookCellsChangeType.ChangeCellContent || event.kind === NotebookCellsChangeType.ModelChange)) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tthis.research();\n\t\t\t}));\n\t\t}\n\n\t\tthis.research();\n\t}\n\n\tasync research() {\n\t\treturn this._throttledDelayer.trigger(async () => {\n\t\t\tthis._state.change({ isSearching: true }, false);\n\t\t\tawait this._research();\n\t\t\tthis._state.change({ isSearching: false }, false);\n\t\t});\n\t}\n\n\tasync _research() {\n\t\tthis._computePromise?.cancel();\n\n\t\tif (!this._state.isRevealed || !this._notebookEditor.hasModel()) {\n\t\t\tthis.set([], false);\n\t\t\treturn;\n\t\t}\n\n\t\tthis._computePromise = createCancelablePromise(token => this._compute(token));\n\n\t\tconst findMatches = await this._computePromise;\n\t\tif (!findMatches) {\n\t\t\tthis.set([], false);\n\t\t\treturn;\n\t\t}\n\n\t\tif (findMatches.length === 0) {\n\t\t\tthis.set([], false);\n\t\t\treturn;\n\t\t}\n\n\t\tconst findFirstMatchAfterCellIndex = (cellIndex: number) => {\n\t\t\tconst matchAfterSelection = findFirstIdxMonotonousOrArrLen(findMatches.map(match => match.index), index => index >= cellIndex);\n\t\t\tthis._updateCurrentMatch(findMatches, this._matchesCountBeforeIndex(findMatches, matchAfterSelection));\n\t\t};\n\n\t\tif (this._currentMatch === -1) {\n\t\t\t// no active current match\n\t\t\tif (this._notebookEditor.getLength() === 0) {\n\t\t\t\tthis.set(findMatches, false);\n\t\t\t\treturn;\n\t\t\t} else {\n\t\t\t\tconst focus = this._notebookEditor.getFocus().start;\n\t\t\t\tfindFirstMatchAfterCellIndex(focus);\n\t\t\t\tthis.set(findMatches, false);\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tconst oldCurrIndex = this._findMatchesStarts!.getIndexOf(this._currentMatch);\n\t\tconst oldCurrCell = this._findMatches[oldCurrIndex.index].cell;\n\t\tconst oldCurrMatchCellIndex = this._notebookEditor.getCellIndex(oldCurrCell);\n\n\n\t\tif (oldCurrMatchCellIndex < 0) {\n\t\t\t// the cell containing the active match is deleted\n\t\t\tif (this._notebookEditor.getLength() === 0) {\n\t\t\t\tthis.set(findMatches, false);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tfindFirstMatchAfterCellIndex(oldCurrMatchCellIndex);\n\t\t\treturn;\n\t\t}\n\n\t\t// the cell still exist\n\t\tconst cell = this._notebookEditor.cellAt(oldCurrMatchCellIndex);\n\t\t// we will try restore the active find match in this cell, if it contains any find match\n\n\t\tif (cell.cellKind === CellKind.Markup && cell.getEditState() === CellEditState.Preview) {\n\t\t\t// find first match in this cell or below\n\t\t\tfindFirstMatchAfterCellIndex(oldCurrMatchCellIndex);\n\t\t\treturn;\n\t\t}\n\n\t\t// the cell is a markup cell in editing mode or a code cell, both should have monaco editor rendered\n\n\t\tif (!this._findMatchDecorationModel.currentMatchDecorations) {\n\t\t\t// no current highlight decoration\n\t\t\tfindFirstMatchAfterCellIndex(oldCurrMatchCellIndex);\n\t\t\treturn;\n\t\t}\n\n\t\t// check if there is monaco editor selection and find the first match, otherwise find the first match above current cell\n\t\t// this._findMatches[cellIndex].matches[matchIndex].range\n\t\tif (this._findMatchDecorationModel.currentMatchDecorations.kind === 'input') {\n\t\t\tconst currentMatchDecorationId = this._findMatchDecorationModel.currentMatchDecorations.decorations.find(decoration => decoration.ownerId === cell.handle);\n\n\t\t\tif (!currentMatchDecorationId) {\n\t\t\t\t// current match decoration is no longer valid\n\t\t\t\tfindFirstMatchAfterCellIndex(oldCurrMatchCellIndex);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst matchAfterSelection = findFirstIdxMonotonousOrArrLen(findMatches, match => match.index >= oldCurrMatchCellIndex) % findMatches.length;\n\t\t\tif (findMatches[matchAfterSelection].index > oldCurrMatchCellIndex) {\n\t\t\t\t// there is no search result in curr cell anymore, find the nearest one (from top to bottom)\n\t\t\t\tthis._updateCurrentMatch(findMatches, this._matchesCountBeforeIndex(findMatches, matchAfterSelection));\n\t\t\t\treturn;\n\t\t\t} else {\n\t\t\t\t// there are still some search results in current cell\n\t\t\t\tlet currMatchRangeInEditor = cell.editorAttached && currentMatchDecorationId.decorations[0] ? cell.getCellDecorationRange(currentMatchDecorationId.decorations[0]) : null;\n\n\t\t\t\tif (currMatchRangeInEditor === null && oldCurrIndex.remainder < this._findMatches[oldCurrIndex.index].contentMatches.length) {\n\t\t\t\t\tcurrMatchRangeInEditor = (this._findMatches[oldCurrIndex.index].getMatch(oldCurrIndex.remainder) as FindMatch).range;\n\t\t\t\t}\n\n\t\t\t\tif (currMatchRangeInEditor !== null) {\n\t\t\t\t\t// we find a range for the previous current match, let's find the nearest one after it (can overlap)\n\t\t\t\t\tconst cellMatch = findMatches[matchAfterSelection];\n\t\t\t\t\tconst matchAfterOldSelection = findFirstIdxMonotonousOrArrLen(cellMatch.contentMatches, match => Range.compareRangesUsingStarts((match as FindMatch).range, currMatchRangeInEditor) >= 0);\n\t\t\t\t\tthis._updateCurrentMatch(findMatches, this._matchesCountBeforeIndex(findMatches, matchAfterSelection) + matchAfterOldSelection);\n\t\t\t\t} else {\n\t\t\t\t\t// no range found, let's fall back to finding the nearest match\n\t\t\t\t\tthis._updateCurrentMatch(findMatches, this._matchesCountBeforeIndex(findMatches, matchAfterSelection));\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\t// output now has the highlight\n\t\t\tconst matchAfterSelection = findFirstIdxMonotonousOrArrLen(findMatches.map(match => match.index), index => index >= oldCurrMatchCellIndex) % findMatches.length;\n\t\t\tthis._updateCurrentMatch(findMatches, this._matchesCountBeforeIndex(findMatches, matchAfterSelection));\n\t\t}\n\t}\n\n\tprivate set(cellFindMatches: CellFindMatchWithIndex[] | null, autoStart: boolean): void {\n\t\tif (!cellFindMatches || !cellFindMatches.length) {\n\t\t\tthis._findMatches = [];\n\t\t\tthis._findMatchDecorationModel.setAllFindMatchesDecorations([]);\n\n\t\t\tthis.constructFindMatchesStarts();\n\t\t\tthis._currentMatch = -1;\n\t\t\tthis._findMatchDecorationModel.clearCurrentFindMatchDecoration();\n\n\t\t\tthis._state.changeMatchInfo(\n\t\t\t\tthis._currentMatch,\n\t\t\t\tthis._findMatches.reduce((p, c) => p + c.length, 0),\n\t\t\t\tundefined\n\t\t\t);\n\t\t\treturn;\n\t\t}\n\n\t\t// all matches\n\t\tthis._findMatches = cellFindMatches;\n\t\tthis._findMatchDecorationModel.setAllFindMatchesDecorations(cellFindMatches || []);\n\n\t\t// current match\n\t\tthis.constructFindMatchesStarts();\n\n\t\tif (autoStart) {\n\t\t\tthis._currentMatch = 0;\n\t\t\tthis.highlightCurrentFindMatchDecoration(0, 0);\n\t\t}\n\n\t\tthis._state.changeMatchInfo(\n\t\t\tthis._currentMatch,\n\t\t\tthis._findMatches.reduce((p, c) => p + c.length, 0),\n\t\t\tundefined\n\t\t);\n\t}\n\n\tprivate async _compute(token: CancellationToken): Promise<CellFindMatchWithIndex[] | null> {\n\t\tif (!this._notebookEditor.hasModel()) {\n\t\t\treturn null;\n\t\t}\n\t\tlet ret: CellFindMatchWithIndex[] | null = null;\n\t\tconst val = this._state.searchString;\n\t\tconst wordSeparators = this._configurationService.inspect<string>('editor.wordSeparators').value;\n\n\t\tconst options: INotebookFindOptions = {\n\t\t\tregex: this._state.isRegex,\n\t\t\twholeWord: this._state.wholeWord,\n\t\t\tcaseSensitive: this._state.matchCase,\n\t\t\twordSeparators: wordSeparators,\n\t\t\tincludeMarkupInput: this._state.filters?.markupInput ?? true,\n\t\t\tincludeCodeInput: this._state.filters?.codeInput ?? true,\n\t\t\tincludeMarkupPreview: !!this._state.filters?.markupPreview,\n\t\t\tincludeOutput: !!this._state.filters?.codeOutput,\n\t\t\tfindScope: this._state.filters?.findScope,\n\t\t};\n\n\t\tret = await this._notebookEditor.find(val, options, token);\n\n\t\tif (token.isCancellationRequested) {\n\t\t\treturn null;\n\t\t}\n\n\t\treturn ret;\n\t}\n\n\tprivate _updateCurrentMatch(findMatches: CellFindMatchWithIndex[], currentMatchesPosition: number) {\n\t\tthis._currentMatch = currentMatchesPosition % findMatches.length;\n\t\tthis.set(findMatches, false);\n\t\tconst nextIndex = this._findMatchesStarts!.getIndexOf(this._currentMatch);\n\t\tthis.highlightCurrentFindMatchDecoration(nextIndex.index, nextIndex.remainder);\n\n\t\tthis._state.changeMatchInfo(\n\t\t\tthis._currentMatch,\n\t\t\tthis._findMatches.reduce((p, c) => p + c.length, 0),\n\t\t\tundefined\n\t\t);\n\t}\n\n\tprivate _matchesCountBeforeIndex(findMatches: CellFindMatchWithIndex[], index: number) {\n\t\tlet prevMatchesCount = 0;\n\t\tfor (let i = 0; i < index; i++) {\n\t\t\tprevMatchesCount += findMatches[i].length;\n\t\t}\n\n\t\treturn prevMatchesCount;\n\t}\n\n\tprivate constructFindMatchesStarts() {\n\t\tif (this._findMatches && this._findMatches.length) {\n\t\t\tconst values = new Uint32Array(this._findMatches.length);\n\t\t\tfor (let i = 0; i < this._findMatches.length; i++) {\n\t\t\t\tvalues[i] = this._findMatches[i].length;\n\t\t\t}\n\n\t\t\tthis._findMatchesStarts = new PrefixSumComputer(values);\n\t\t} else {\n\t\t\tthis._findMatchesStarts = null;\n\t\t}\n\t}\n\n\n\tprivate async highlightCurrentFindMatchDecoration(cellIndex: number, matchIndex: number): Promise<number | null> {\n\t\tconst cell = this._findMatches[cellIndex].cell;\n\t\tconst match = this._findMatches[cellIndex].getMatch(matchIndex);\n\n\t\tif (matchIndex < this._findMatches[cellIndex].contentMatches.length) {\n\t\t\treturn this._findMatchDecorationModel.highlightCurrentFindMatchDecorationInCell(cell, (match as FindMatch).range);\n\t\t} else {\n\t\t\treturn this._findMatchDecorationModel.highlightCurrentFindMatchDecorationInWebview(cell, (match as CellWebviewFindMatch).index);\n\t\t}\n\t}\n\n\tclear() {\n\t\tthis._computePromise?.cancel();\n\t\tthis._throttledDelayer.cancel();\n\t\tthis.set([], false);\n\t}\n\n\toverride dispose() {\n\t\tthis._findMatchDecorationModel.dispose();\n\t\tsuper.dispose();\n\t}\n}\n"]}