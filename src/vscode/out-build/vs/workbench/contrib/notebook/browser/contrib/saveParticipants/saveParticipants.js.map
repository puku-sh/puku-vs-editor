{"version":3,"sources":["vs/workbench/contrib/notebook/browser/contrib/saveParticipants/saveParticipants.ts"],"names":[],"mappings":"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","file":"saveParticipants.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { CancellationToken } from '../../../../../../base/common/cancellation.js';\nimport { HierarchicalKind } from '../../../../../../base/common/hierarchicalKind.js';\nimport { Disposable, DisposableStore } from '../../../../../../base/common/lifecycle.js';\nimport { isEqual } from '../../../../../../base/common/resources.js';\nimport { ICodeEditor } from '../../../../../../editor/browser/editorBrowser.js';\nimport { IBulkEditService, ResourceEdit, ResourceTextEdit } from '../../../../../../editor/browser/services/bulkEditService.js';\nimport { trimTrailingWhitespace } from '../../../../../../editor/common/commands/trimTrailingWhitespaceCommand.js';\nimport { Position } from '../../../../../../editor/common/core/position.js';\nimport { Range } from '../../../../../../editor/common/core/range.js';\nimport { Selection } from '../../../../../../editor/common/core/selection.js';\nimport { CodeActionProvider, CodeActionTriggerType, IWorkspaceTextEdit } from '../../../../../../editor/common/languages.js';\nimport { IReadonlyTextBuffer, ITextModel } from '../../../../../../editor/common/model.js';\nimport { IEditorWorkerService } from '../../../../../../editor/common/services/editorWorker.js';\nimport { ILanguageFeaturesService } from '../../../../../../editor/common/services/languageFeatures.js';\nimport { ITextModelService } from '../../../../../../editor/common/services/resolverService.js';\nimport { ApplyCodeActionReason, applyCodeAction, getCodeActions } from '../../../../../../editor/contrib/codeAction/browser/codeAction.js';\nimport { CodeActionItem, CodeActionKind, CodeActionTriggerSource } from '../../../../../../editor/contrib/codeAction/common/types.js';\nimport { FormattingMode, getDocumentFormattingEditsWithSelectedProvider } from '../../../../../../editor/contrib/format/browser/format.js';\nimport { SnippetController2 } from '../../../../../../editor/contrib/snippet/browser/snippetController2.js';\nimport { localize } from '../../../../../../nls.js';\nimport { IConfigurationService } from '../../../../../../platform/configuration/common/configuration.js';\nimport { IInstantiationService, ServicesAccessor } from '../../../../../../platform/instantiation/common/instantiation.js';\nimport { ILogService } from '../../../../../../platform/log/common/log.js';\nimport { IProgress, IProgressStep } from '../../../../../../platform/progress/common/progress.js';\nimport { Registry } from '../../../../../../platform/registry/common/platform.js';\nimport { IWorkspaceTrustManagementService } from '../../../../../../platform/workspace/common/workspaceTrust.js';\nimport { IWorkbenchContribution, IWorkbenchContributionsRegistry, Extensions as WorkbenchContributionsExtensions } from '../../../../../common/contributions.js';\nimport { SaveReason } from '../../../../../common/editor.js';\nimport { getNotebookEditorFromEditorPane } from '../../notebookBrowser.js';\nimport { NotebookTextModel } from '../../../common/model/notebookTextModel.js';\nimport { CellKind, NotebookSetting } from '../../../common/notebookCommon.js';\nimport { NotebookFileWorkingCopyModel } from '../../../common/notebookEditorModel.js';\nimport { IEditorService } from '../../../../../services/editor/common/editorService.js';\nimport { LifecyclePhase } from '../../../../../services/lifecycle/common/lifecycle.js';\nimport { IStoredFileWorkingCopy, IStoredFileWorkingCopyModel } from '../../../../../services/workingCopy/common/storedFileWorkingCopy.js';\nimport { IStoredFileWorkingCopySaveParticipant, IStoredFileWorkingCopySaveParticipantContext, IWorkingCopyFileService } from '../../../../../services/workingCopy/common/workingCopyFileService.js';\nimport { NotebookMultiCursorController, NotebookMultiCursorState } from '../multicursor/notebookMulticursor.js';\n\nexport abstract class NotebookSaveParticipant implements IStoredFileWorkingCopySaveParticipant {\n\tconstructor(\n\t\tprivate readonly _editorService: IEditorService,\n\t) { }\n\tabstract participate(workingCopy: IStoredFileWorkingCopy<IStoredFileWorkingCopyModel>, context: IStoredFileWorkingCopySaveParticipantContext, progress: IProgress<IProgressStep>, token: CancellationToken): Promise<void>;\n\n\tprotected canParticipate(): boolean {\n\t\tconst editor = getNotebookEditorFromEditorPane(this._editorService.activeEditorPane);\n\t\tconst controller = editor?.getContribution<NotebookMultiCursorController>(NotebookMultiCursorController.id);\n\t\tif (!controller) {\n\t\t\treturn true;\n\t\t}\n\n\t\treturn controller.getState() !== NotebookMultiCursorState.Editing;\n\t}\n}\n\nclass FormatOnSaveParticipant implements IStoredFileWorkingCopySaveParticipant {\n\tconstructor(\n\t\t@IEditorWorkerService private readonly editorWorkerService: IEditorWorkerService,\n\t\t@ILanguageFeaturesService private readonly languageFeaturesService: ILanguageFeaturesService,\n\t\t@IInstantiationService private readonly instantiationService: IInstantiationService,\n\t\t@ITextModelService private readonly textModelService: ITextModelService,\n\t\t@IBulkEditService private readonly bulkEditService: IBulkEditService,\n\t\t@IConfigurationService private readonly configurationService: IConfigurationService,\n\t) { }\n\n\tasync participate(workingCopy: IStoredFileWorkingCopy<IStoredFileWorkingCopyModel>, context: IStoredFileWorkingCopySaveParticipantContext, progress: IProgress<IProgressStep>, token: CancellationToken): Promise<void> {\n\t\tif (!workingCopy.model || !(workingCopy.model instanceof NotebookFileWorkingCopyModel)) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (context.reason === SaveReason.AUTO) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\tconst enabled = this.configurationService.getValue<boolean>(NotebookSetting.formatOnSave);\n\t\tif (!enabled) {\n\t\t\treturn undefined;\n\t\t}\n\t\tprogress.report({ message: localize('notebookFormatSave.formatting', \"Formatting\") });\n\n\t\tconst notebook = workingCopy.model.notebookModel;\n\t\tconst formatApplied: boolean = await this.instantiationService.invokeFunction(CodeActionParticipantUtils.checkAndRunFormatCodeAction, notebook, progress, token);\n\n\t\tconst disposable = new DisposableStore();\n\t\ttry {\n\t\t\tif (!formatApplied) {\n\t\t\t\tconst allCellEdits = await Promise.all(notebook.cells.map(async cell => {\n\t\t\t\t\tconst ref = await this.textModelService.createModelReference(cell.uri);\n\t\t\t\t\tdisposable.add(ref);\n\n\t\t\t\t\tconst model = ref.object.textEditorModel;\n\n\t\t\t\t\tconst formatEdits = await getDocumentFormattingEditsWithSelectedProvider(\n\t\t\t\t\t\tthis.editorWorkerService,\n\t\t\t\t\t\tthis.languageFeaturesService,\n\t\t\t\t\t\tmodel,\n\t\t\t\t\t\tFormattingMode.Silent,\n\t\t\t\t\t\ttoken\n\t\t\t\t\t);\n\n\t\t\t\t\tconst edits: ResourceTextEdit[] = [];\n\n\t\t\t\t\tif (formatEdits) {\n\t\t\t\t\t\tedits.push(...formatEdits.map(edit => new ResourceTextEdit(model.uri, edit, model.getVersionId())));\n\t\t\t\t\t\treturn edits;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn [];\n\t\t\t\t}));\n\n\t\t\t\tawait this.bulkEditService.apply(/* edit */allCellEdits.flat(), { label: localize('formatNotebook', \"Format Notebook\"), code: 'undoredo.formatNotebook', });\n\t\t\t}\n\t\t} finally {\n\t\t\tprogress.report({ increment: 100 });\n\t\t\tdisposable.dispose();\n\t\t}\n\t}\n}\n\nclass TrimWhitespaceParticipant extends NotebookSaveParticipant {\n\n\tconstructor(\n\t\t@IConfigurationService private readonly configurationService: IConfigurationService,\n\t\t@IEditorService private readonly editorService: IEditorService,\n\t\t@ITextModelService private readonly textModelService: ITextModelService,\n\t\t@IBulkEditService private readonly bulkEditService: IBulkEditService,\n\t) {\n\t\tsuper(editorService);\n\t}\n\n\tasync participate(workingCopy: IStoredFileWorkingCopy<IStoredFileWorkingCopyModel>, context: IStoredFileWorkingCopySaveParticipantContext, progress: IProgress<IProgressStep>, _token: CancellationToken): Promise<void> {\n\t\tconst trimTrailingWhitespaceOption = this.configurationService.getValue<boolean>('files.trimTrailingWhitespace');\n\t\tconst trimInRegexAndStrings = this.configurationService.getValue<boolean>('files.trimTrailingWhitespaceInRegexAndStrings');\n\t\tif (trimTrailingWhitespaceOption && this.canParticipate()) {\n\t\t\tawait this.doTrimTrailingWhitespace(workingCopy, context.reason === SaveReason.AUTO, trimInRegexAndStrings, progress);\n\t\t}\n\t}\n\n\tprivate async doTrimTrailingWhitespace(workingCopy: IStoredFileWorkingCopy<IStoredFileWorkingCopyModel>, isAutoSaved: boolean, trimInRegexesAndStrings: boolean, progress: IProgress<IProgressStep>) {\n\t\tif (!workingCopy.model || !(workingCopy.model instanceof NotebookFileWorkingCopyModel)) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst disposable = new DisposableStore();\n\t\tconst notebook = workingCopy.model.notebookModel;\n\t\tconst activeCellEditor = getActiveCellCodeEditor(this.editorService);\n\n\t\tlet cursors: Position[] = [];\n\t\tlet prevSelection: Selection[] = [];\n\t\ttry {\n\t\t\tconst allCellEdits = await Promise.all(notebook.cells.map(async (cell) => {\n\t\t\t\tif (cell.cellKind !== CellKind.Code) {\n\t\t\t\t\treturn [];\n\t\t\t\t}\n\n\t\t\t\tconst ref = await this.textModelService.createModelReference(cell.uri);\n\t\t\t\tdisposable.add(ref);\n\t\t\t\tconst model = ref.object.textEditorModel;\n\n\t\t\t\tconst isActiveCell = (activeCellEditor && cell.uri.toString() === activeCellEditor.getModel()?.uri.toString());\n\t\t\t\tif (isActiveCell) {\n\t\t\t\t\tprevSelection = activeCellEditor.getSelections() ?? [];\n\t\t\t\t\tif (isAutoSaved) {\n\t\t\t\t\t\tcursors = prevSelection.map(s => s.getPosition()); // get initial cursor positions\n\t\t\t\t\t\tconst snippetsRange = SnippetController2.get(activeCellEditor)?.getSessionEnclosingRange();\n\t\t\t\t\t\tif (snippetsRange) {\n\t\t\t\t\t\t\tfor (let lineNumber = snippetsRange.startLineNumber; lineNumber <= snippetsRange.endLineNumber; lineNumber++) {\n\t\t\t\t\t\t\t\tcursors.push(new Position(lineNumber, model.getLineMaxColumn(lineNumber)));\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tconst ops = trimTrailingWhitespace(model, cursors, trimInRegexesAndStrings);\n\t\t\t\tif (!ops.length) {\n\t\t\t\t\treturn []; // Nothing to do\n\t\t\t\t}\n\n\t\t\t\treturn ops.map(op => new ResourceTextEdit(model.uri, { ...op, text: op.text || '' }, model.getVersionId()));\n\t\t\t}));\n\n\t\t\tconst filteredEdits = allCellEdits.flat().filter(edit => edit !== undefined) as ResourceEdit[];\n\t\t\tawait this.bulkEditService.apply(filteredEdits, { label: localize('trimNotebookWhitespace', \"Notebook Trim Trailing Whitespace\"), code: 'undoredo.notebookTrimTrailingWhitespace' });\n\n\t\t} finally {\n\t\t\tprogress.report({ increment: 100 });\n\t\t\tdisposable.dispose();\n\t\t}\n\t}\n}\n\nclass TrimFinalNewLinesParticipant extends NotebookSaveParticipant {\n\n\tconstructor(\n\t\t@IConfigurationService private readonly configurationService: IConfigurationService,\n\t\t@IEditorService private readonly editorService: IEditorService,\n\t\t@IBulkEditService private readonly bulkEditService: IBulkEditService,\n\t) {\n\t\tsuper(editorService);\n\t}\n\n\n\tasync participate(workingCopy: IStoredFileWorkingCopy<IStoredFileWorkingCopyModel>, context: IStoredFileWorkingCopySaveParticipantContext, progress: IProgress<IProgressStep>, _token: CancellationToken): Promise<void> {\n\t\tif (this.configurationService.getValue<boolean>('files.trimFinalNewlines') && this.canParticipate()) {\n\t\t\tawait this.doTrimFinalNewLines(workingCopy, context.reason === SaveReason.AUTO, progress);\n\t\t}\n\t}\n\n\t/**\n\t * returns 0 if the entire file is empty\n\t */\n\tprivate findLastNonEmptyLine(textBuffer: IReadonlyTextBuffer): number {\n\t\tfor (let lineNumber = textBuffer.getLineCount(); lineNumber >= 1; lineNumber--) {\n\t\t\tconst lineLength = textBuffer.getLineLength(lineNumber);\n\t\t\tif (lineLength) {\n\t\t\t\t// this line has content\n\t\t\t\treturn lineNumber;\n\t\t\t}\n\t\t}\n\t\t// no line has content\n\t\treturn 0;\n\t}\n\n\tprivate async doTrimFinalNewLines(workingCopy: IStoredFileWorkingCopy<IStoredFileWorkingCopyModel>, isAutoSaved: boolean, progress: IProgress<IProgressStep>): Promise<void> {\n\t\tif (!workingCopy.model || !(workingCopy.model instanceof NotebookFileWorkingCopyModel)) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst disposable = new DisposableStore();\n\t\tconst notebook = workingCopy.model.notebookModel;\n\t\tconst activeCellEditor = getActiveCellCodeEditor(this.editorService);\n\n\t\ttry {\n\t\t\tconst allCellEdits = await Promise.all(notebook.cells.map(async (cell) => {\n\t\t\t\tif (cell.cellKind !== CellKind.Code) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t// autosave -- don't trim every trailing line, just up to the cursor line\n\t\t\t\tlet cannotTouchLineNumber = 0;\n\t\t\t\tconst isActiveCell = (activeCellEditor && cell.uri.toString() === activeCellEditor.getModel()?.uri.toString());\n\t\t\t\tif (isAutoSaved && isActiveCell) {\n\t\t\t\t\tconst selections = activeCellEditor.getSelections() ?? [];\n\t\t\t\t\tfor (const sel of selections) {\n\t\t\t\t\t\tcannotTouchLineNumber = Math.max(cannotTouchLineNumber, sel.selectionStartLineNumber);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tconst textBuffer = cell.textBuffer;\n\t\t\t\tconst lastNonEmptyLine = this.findLastNonEmptyLine(textBuffer);\n\t\t\t\tconst deleteFromLineNumber = Math.max(lastNonEmptyLine + 1, cannotTouchLineNumber + 1);\n\t\t\t\tif (deleteFromLineNumber > textBuffer.getLineCount()) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst deletionRange = new Range(deleteFromLineNumber, 1, textBuffer.getLineCount(), textBuffer.getLineLastNonWhitespaceColumn(textBuffer.getLineCount()));\n\t\t\t\tif (deletionRange.isEmpty()) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t// create the edit to delete all lines in deletionRange\n\t\t\t\treturn new ResourceTextEdit(cell.uri, { range: deletionRange, text: '' }, cell.textModel?.getVersionId());\n\t\t\t}));\n\n\t\t\tconst filteredEdits = allCellEdits.flat().filter(edit => edit !== undefined) as ResourceEdit[];\n\t\t\tawait this.bulkEditService.apply(filteredEdits, { label: localize('trimNotebookNewlines', \"Trim Final New Lines\"), code: 'undoredo.trimFinalNewLines' });\n\n\t\t} finally {\n\t\t\tprogress.report({ increment: 100 });\n\t\t\tdisposable.dispose();\n\t\t}\n\t}\n}\n\nclass InsertFinalNewLineParticipant extends NotebookSaveParticipant {\n\n\tconstructor(\n\t\t@IConfigurationService private readonly configurationService: IConfigurationService,\n\t\t@IBulkEditService private readonly bulkEditService: IBulkEditService,\n\t\t@IEditorService private readonly editorService: IEditorService,\n\t) {\n\t\tsuper(editorService);\n\t}\n\n\tasync participate(workingCopy: IStoredFileWorkingCopy<IStoredFileWorkingCopyModel>, context: IStoredFileWorkingCopySaveParticipantContext, progress: IProgress<IProgressStep>, _token: CancellationToken): Promise<void> {\n\t\t// waiting on notebook-specific override before this feature can sync with 'files.insertFinalNewline'\n\t\t// if (this.configurationService.getValue('files.insertFinalNewline')) {\n\n\t\tif (this.configurationService.getValue<boolean>(NotebookSetting.insertFinalNewline) && this.canParticipate()) {\n\t\t\tawait this.doInsertFinalNewLine(workingCopy, context.reason === SaveReason.AUTO, progress);\n\t\t}\n\t}\n\n\tprivate async doInsertFinalNewLine(workingCopy: IStoredFileWorkingCopy<IStoredFileWorkingCopyModel>, isAutoSaved: boolean, progress: IProgress<IProgressStep>): Promise<void> {\n\t\tif (!workingCopy.model || !(workingCopy.model instanceof NotebookFileWorkingCopyModel)) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst disposable = new DisposableStore();\n\t\tconst notebook = workingCopy.model.notebookModel;\n\n\t\t// get initial cursor positions\n\t\tconst activeCellEditor = getActiveCellCodeEditor(this.editorService);\n\t\tlet selections;\n\t\tif (activeCellEditor) {\n\t\t\tselections = activeCellEditor.getSelections() ?? [];\n\t\t}\n\n\t\ttry {\n\t\t\tconst allCellEdits = await Promise.all(notebook.cells.map(async (cell) => {\n\t\t\t\tif (cell.cellKind !== CellKind.Code) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst lineCount = cell.textBuffer.getLineCount();\n\t\t\t\tconst lastLineIsEmptyOrWhitespace = cell.textBuffer.getLineFirstNonWhitespaceColumn(lineCount) === 0;\n\n\t\t\t\tif (!lineCount || lastLineIsEmptyOrWhitespace) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\treturn new ResourceTextEdit(cell.uri, { range: new Range(lineCount + 1, cell.textBuffer.getLineLength(lineCount), lineCount + 1, cell.textBuffer.getLineLength(lineCount)), text: cell.textBuffer.getEOL() }, cell.textModel?.getVersionId());\n\t\t\t}));\n\n\t\t\tconst filteredEdits = allCellEdits.filter(edit => edit !== undefined) as ResourceEdit[];\n\t\t\tawait this.bulkEditService.apply(filteredEdits, { label: localize('insertFinalNewLine', \"Insert Final New Line\"), code: 'undoredo.insertFinalNewLine' });\n\n\t\t\t// set cursor back to initial position after inserting final new line\n\t\t\tif (activeCellEditor && selections) {\n\t\t\t\tactiveCellEditor.setSelections(selections);\n\t\t\t}\n\t\t} finally {\n\t\t\tprogress.report({ increment: 100 });\n\t\t\tdisposable.dispose();\n\t\t}\n\t}\n}\n\nclass CodeActionOnSaveParticipant implements IStoredFileWorkingCopySaveParticipant {\n\tconstructor(\n\t\t@IConfigurationService private readonly configurationService: IConfigurationService,\n\t\t@ILogService private readonly logService: ILogService,\n\t\t@IWorkspaceTrustManagementService private readonly workspaceTrustManagementService: IWorkspaceTrustManagementService,\n\t\t@ITextModelService private readonly textModelService: ITextModelService,\n\t\t@IInstantiationService private readonly instantiationService: IInstantiationService,\n\t) {\n\t}\n\n\tasync participate(workingCopy: IStoredFileWorkingCopy<IStoredFileWorkingCopyModel>, context: IStoredFileWorkingCopySaveParticipantContext, progress: IProgress<IProgressStep>, token: CancellationToken): Promise<void> {\n\t\tconst isTrusted = this.workspaceTrustManagementService.isWorkspaceTrusted();\n\t\tif (!isTrusted) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!workingCopy.model || !(workingCopy.model instanceof NotebookFileWorkingCopyModel)) {\n\t\t\treturn;\n\t\t}\n\n\t\tlet saveTrigger = '';\n\t\tif (context.reason === SaveReason.AUTO) {\n\t\t\t// currently this won't happen, as vs/editor/contrib/codeAction/browser/codeAction.ts L#104 filters out codeactions on autosave. Just future-proofing\n\t\t\t// ? notebook CodeActions on autosave seems dangerous (perf-wise)\n\t\t\t// saveTrigger = 'always'; // TODO@Yoyokrazy, support during debt\n\t\t\treturn undefined;\n\t\t} else if (context.reason === SaveReason.EXPLICIT) {\n\t\t\tsaveTrigger = 'explicit';\n\t\t} else {\n\t\t\t// \tSaveReason.FOCUS_CHANGE, WINDOW_CHANGE need to be addressed when autosaves are enabled\n\t\t\treturn undefined;\n\t\t}\n\n\t\tconst notebookModel = workingCopy.model.notebookModel;\n\n\t\tconst setting = this.configurationService.getValue<{ [kind: string]: string | boolean }>(NotebookSetting.codeActionsOnSave);\n\t\tconst settingItems: string[] = Array.isArray(setting)\n\t\t\t? setting\n\t\t\t: Object.keys(setting).filter(x => setting[x]);\n\n\t\tconst allCodeActions = this.createCodeActionsOnSave(settingItems);\n\t\tconst excludedActions = allCodeActions\n\t\t\t.filter(x => setting[x.value] === 'never' || setting[x.value] === false);\n\t\tconst includedActions = allCodeActions\n\t\t\t.filter(x => setting[x.value] === saveTrigger || setting[x.value] === true);\n\n\t\tconst editorCodeActionsOnSave = includedActions.filter(x => !CodeActionKind.Notebook.contains(x));\n\t\tconst notebookCodeActionsOnSave = includedActions.filter(x => CodeActionKind.Notebook.contains(x));\n\n\t\t// run notebook code actions\n\t\tif (notebookCodeActionsOnSave.length) {\n\t\t\tconst nbDisposable = new DisposableStore();\n\t\t\tprogress.report({ message: localize('notebookSaveParticipants.notebookCodeActions', \"Running 'Notebook' code actions\") });\n\t\t\ttry {\n\t\t\t\tconst cell = notebookModel.cells[0];\n\t\t\t\tconst ref = await this.textModelService.createModelReference(cell.uri);\n\t\t\t\tnbDisposable.add(ref);\n\n\t\t\t\tconst textEditorModel = ref.object.textEditorModel;\n\n\t\t\t\tawait this.instantiationService.invokeFunction(CodeActionParticipantUtils.applyOnSaveGenericCodeActions, textEditorModel, notebookCodeActionsOnSave, excludedActions, progress, token);\n\t\t\t} catch {\n\t\t\t\tthis.logService.error('Failed to apply notebook code action on save');\n\t\t\t} finally {\n\t\t\t\tprogress.report({ increment: 100 });\n\t\t\t\tnbDisposable.dispose();\n\t\t\t}\n\t\t}\n\n\t\t// run cell level code actions\n\t\tif (editorCodeActionsOnSave.length) {\n\t\t\t// prioritize `source.fixAll` code actions\n\t\t\tif (!Array.isArray(setting)) {\n\t\t\t\teditorCodeActionsOnSave.sort((a, b) => {\n\t\t\t\t\tif (CodeActionKind.SourceFixAll.contains(a)) {\n\t\t\t\t\t\tif (CodeActionKind.SourceFixAll.contains(b)) {\n\t\t\t\t\t\t\treturn 0;\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn -1;\n\t\t\t\t\t}\n\t\t\t\t\tif (CodeActionKind.SourceFixAll.contains(b)) {\n\t\t\t\t\t\treturn 1;\n\t\t\t\t\t}\n\t\t\t\t\treturn 0;\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tconst cellDisposable = new DisposableStore();\n\t\t\tprogress.report({ message: localize('notebookSaveParticipants.cellCodeActions', \"Running 'Cell' code actions\") });\n\t\t\ttry {\n\t\t\t\tawait Promise.all(notebookModel.cells.map(async cell => {\n\t\t\t\t\tconst ref = await this.textModelService.createModelReference(cell.uri);\n\t\t\t\t\tcellDisposable.add(ref);\n\n\t\t\t\t\tconst textEditorModel = ref.object.textEditorModel;\n\n\t\t\t\t\tawait this.instantiationService.invokeFunction(CodeActionParticipantUtils.applyOnSaveGenericCodeActions, textEditorModel, editorCodeActionsOnSave, excludedActions, progress, token);\n\t\t\t\t}));\n\t\t\t} catch {\n\t\t\t\tthis.logService.error('Failed to apply code action on save');\n\t\t\t} finally {\n\t\t\t\tprogress.report({ increment: 100 });\n\t\t\t\tcellDisposable.dispose();\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate createCodeActionsOnSave(settingItems: readonly string[]): HierarchicalKind[] {\n\t\tconst kinds = settingItems.map(x => new HierarchicalKind(x));\n\n\t\t// Remove subsets\n\t\treturn kinds.filter(kind => {\n\t\t\treturn kinds.every(otherKind => otherKind.equals(kind) || !otherKind.contains(kind));\n\t\t});\n\t}\n}\n\nexport class CodeActionParticipantUtils {\n\n\tstatic async checkAndRunFormatCodeAction(\n\t\taccessor: ServicesAccessor,\n\t\tnotebookModel: NotebookTextModel,\n\t\tprogress: IProgress<IProgressStep>,\n\t\ttoken: CancellationToken): Promise<boolean> {\n\n\t\tconst instantiationService: IInstantiationService = accessor.get(IInstantiationService);\n\t\tconst textModelService: ITextModelService = accessor.get(ITextModelService);\n\t\tconst logService: ILogService = accessor.get(ILogService);\n\t\tconst configurationService: IConfigurationService = accessor.get(IConfigurationService);\n\n\t\tconst formatDisposable = new DisposableStore();\n\t\tlet formatResult: boolean = false;\n\t\tprogress.report({ message: localize('notebookSaveParticipants.formatCodeActions', \"Running 'Format' code actions\") });\n\t\ttry {\n\t\t\tconst cell = notebookModel.cells[0];\n\t\t\tconst ref = await textModelService.createModelReference(cell.uri);\n\t\t\tformatDisposable.add(ref);\n\t\t\tconst textEditorModel = ref.object.textEditorModel;\n\n\t\t\tconst defaultFormatterExtId = configurationService.getValue<string | undefined>(NotebookSetting.defaultFormatter);\n\t\t\tformatResult = await instantiationService.invokeFunction(CodeActionParticipantUtils.applyOnSaveFormatCodeAction, textEditorModel, new HierarchicalKind('notebook.format'), [], defaultFormatterExtId, progress, token);\n\t\t} catch {\n\t\t\tlogService.error('Failed to apply notebook format action on save');\n\t\t} finally {\n\t\t\tprogress.report({ increment: 100 });\n\t\t\tformatDisposable.dispose();\n\t\t}\n\t\treturn formatResult;\n\t}\n\n\tstatic async applyOnSaveGenericCodeActions(\n\t\taccessor: ServicesAccessor,\n\t\tmodel: ITextModel,\n\t\tcodeActionsOnSave: readonly HierarchicalKind[],\n\t\texcludes: readonly HierarchicalKind[],\n\t\tprogress: IProgress<IProgressStep>,\n\t\ttoken: CancellationToken): Promise<void> {\n\n\t\tconst instantiationService: IInstantiationService = accessor.get(IInstantiationService);\n\t\tconst languageFeaturesService: ILanguageFeaturesService = accessor.get(ILanguageFeaturesService);\n\t\tconst logService: ILogService = accessor.get(ILogService);\n\n\t\tconst getActionProgress = new class implements IProgress<CodeActionProvider> {\n\t\t\tprivate _names = new Set<string>();\n\t\t\tprivate _report(): void {\n\t\t\t\tprogress.report({\n\t\t\t\t\tmessage: localize(\n\t\t\t\t\t\t{ key: 'codeaction.get2', comment: ['[configure]({1}) is a link. Only translate `configure`. Do not change brackets and parentheses or {1}'] },\n\t\t\t\t\t\t\"Getting code actions from '{0}' ([configure]({1})).\",\n\t\t\t\t\t\t[...this._names].map(name => `'${name}'`).join(', '),\n\t\t\t\t\t\t'command:workbench.action.openSettings?%5B%22notebook.codeActionsOnSave%22%5D'\n\t\t\t\t\t)\n\t\t\t\t});\n\t\t\t}\n\t\t\treport(provider: CodeActionProvider) {\n\t\t\t\tif (provider.displayName && !this._names.has(provider.displayName)) {\n\t\t\t\t\tthis._names.add(provider.displayName);\n\t\t\t\t\tthis._report();\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\tfor (const codeActionKind of codeActionsOnSave) {\n\t\t\tconst actionsToRun = await CodeActionParticipantUtils.getActionsToRun(model, codeActionKind, excludes, languageFeaturesService, getActionProgress, token);\n\t\t\tif (token.isCancellationRequested) {\n\t\t\t\tactionsToRun.dispose();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\ttry {\n\t\t\t\tfor (const action of actionsToRun.validActions) {\n\t\t\t\t\tconst codeActionEdits = action.action.edit?.edits;\n\t\t\t\t\tlet breakFlag = false;\n\t\t\t\t\tif (!action.action.kind?.startsWith('notebook')) {\n\t\t\t\t\t\tfor (const edit of codeActionEdits ?? []) {\n\t\t\t\t\t\t\tconst workspaceTextEdit = edit as IWorkspaceTextEdit;\n\t\t\t\t\t\t\tif (workspaceTextEdit.resource && isEqual(workspaceTextEdit.resource, model.uri)) {\n\t\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t// error -> applied to multiple resources\n\t\t\t\t\t\t\t\tbreakFlag = true;\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif (breakFlag) {\n\t\t\t\t\t\tlogService.warn('Failed to apply code action on save, applied to multiple resources.');\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\t\tprogress.report({ message: localize('codeAction.apply', \"Applying code action '{0}'.\", action.action.title) });\n\t\t\t\t\tawait instantiationService.invokeFunction(applyCodeAction, action, ApplyCodeActionReason.OnSave, {}, token);\n\t\t\t\t\tif (token.isCancellationRequested) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} catch {\n\t\t\t\t// Failure to apply a code action should not block other on save actions\n\t\t\t} finally {\n\t\t\t\tactionsToRun.dispose();\n\t\t\t}\n\t\t}\n\t}\n\n\tstatic async applyOnSaveFormatCodeAction(\n\t\taccessor: ServicesAccessor,\n\t\tmodel: ITextModel,\n\t\tformatCodeActionOnSave: HierarchicalKind,\n\t\texcludes: readonly HierarchicalKind[],\n\t\textensionId: string | undefined,\n\t\tprogress: IProgress<IProgressStep>,\n\t\ttoken: CancellationToken): Promise<boolean> {\n\n\t\tconst instantiationService: IInstantiationService = accessor.get(IInstantiationService);\n\t\tconst languageFeaturesService: ILanguageFeaturesService = accessor.get(ILanguageFeaturesService);\n\t\tconst logService: ILogService = accessor.get(ILogService);\n\n\t\tconst getActionProgress = new class implements IProgress<CodeActionProvider> {\n\t\t\tprivate _names = new Set<string>();\n\t\t\tprivate _report(): void {\n\t\t\t\tprogress.report({\n\t\t\t\t\tmessage: localize(\n\t\t\t\t\t\t{ key: 'codeaction.get2', comment: ['[configure]({1}) is a link. Only translate `configure`. Do not change brackets and parentheses or {1}'] },\n\t\t\t\t\t\t\"Getting code actions from '{0}' ([configure]({1})).\",\n\t\t\t\t\t\t[...this._names].map(name => `'${name}'`).join(', '),\n\t\t\t\t\t\t'command:workbench.action.openSettings?%5B%22notebook.defaultFormatter%22%5D'\n\t\t\t\t\t)\n\t\t\t\t});\n\t\t\t}\n\t\t\treport(provider: CodeActionProvider) {\n\t\t\t\tif (provider.displayName && !this._names.has(provider.displayName)) {\n\t\t\t\t\tthis._names.add(provider.displayName);\n\t\t\t\t\tthis._report();\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\tconst providedActions = await CodeActionParticipantUtils.getActionsToRun(model, formatCodeActionOnSave, excludes, languageFeaturesService, getActionProgress, token);\n\t\t// warn the user if there are more than one provided format action, and there is no specified defaultFormatter\n\t\tif (providedActions.validActions.length > 1 && !extensionId) {\n\t\t\tlogService.warn('More than one format code action is provided, the 0th one will be used. A default can be specified via `notebook.defaultFormatter` in your settings.');\n\t\t}\n\n\t\tif (token.isCancellationRequested) {\n\t\t\tprovidedActions.dispose();\n\t\t\treturn false;\n\t\t}\n\n\t\ttry {\n\t\t\tconst action: CodeActionItem | undefined = extensionId ? providedActions.validActions.find(action => action.provider?.extensionId === extensionId) : providedActions.validActions[0];\n\t\t\tif (!action) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tprogress.report({ message: localize('codeAction.apply', \"Applying code action '{0}'.\", action.action.title) });\n\t\t\tawait instantiationService.invokeFunction(applyCodeAction, action, ApplyCodeActionReason.OnSave, {}, token);\n\t\t\tif (token.isCancellationRequested) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t} catch {\n\t\t\tlogService.error('Failed to apply notebook format code action on save');\n\t\t\treturn false;\n\t\t} finally {\n\t\t\tprovidedActions.dispose();\n\t\t}\n\t\treturn true;\n\t}\n\n\t// @Yoyokrazy this could likely be modified to leverage the extensionID, therefore not getting actions from providers unnecessarily -- future work\n\tstatic getActionsToRun(model: ITextModel, codeActionKind: HierarchicalKind, excludes: readonly HierarchicalKind[], languageFeaturesService: ILanguageFeaturesService, progress: IProgress<CodeActionProvider>, token: CancellationToken) {\n\t\treturn getCodeActions(languageFeaturesService.codeActionProvider, model, model.getFullModelRange(), {\n\t\t\ttype: CodeActionTriggerType.Invoke,\n\t\t\ttriggerAction: CodeActionTriggerSource.OnSave,\n\t\t\tfilter: { include: codeActionKind, excludes: excludes, includeSourceActions: true },\n\t\t}, progress, token);\n\t}\n\n}\n\nfunction getActiveCellCodeEditor(editorService: IEditorService): ICodeEditor | undefined {\n\tconst activePane = editorService.activeEditorPane;\n\tconst notebookEditor = getNotebookEditorFromEditorPane(activePane);\n\tconst activeCodeEditor = notebookEditor?.activeCodeEditor;\n\treturn activeCodeEditor;\n}\n\nexport class SaveParticipantsContribution extends Disposable implements IWorkbenchContribution {\n\tconstructor(\n\t\t@IInstantiationService private readonly instantiationService: IInstantiationService,\n\t\t@IWorkingCopyFileService private readonly workingCopyFileService: IWorkingCopyFileService) {\n\n\t\tsuper();\n\t\tthis.registerSaveParticipants();\n\t}\n\n\tprivate registerSaveParticipants(): void {\n\t\tthis._register(this.workingCopyFileService.addSaveParticipant(this.instantiationService.createInstance(TrimWhitespaceParticipant)));\n\t\tthis._register(this.workingCopyFileService.addSaveParticipant(this.instantiationService.createInstance(CodeActionOnSaveParticipant)));\n\t\tthis._register(this.workingCopyFileService.addSaveParticipant(this.instantiationService.createInstance(FormatOnSaveParticipant)));\n\t\tthis._register(this.workingCopyFileService.addSaveParticipant(this.instantiationService.createInstance(InsertFinalNewLineParticipant)));\n\t\tthis._register(this.workingCopyFileService.addSaveParticipant(this.instantiationService.createInstance(TrimFinalNewLinesParticipant)));\n\t}\n}\n\nconst workbenchContributionsRegistry = Registry.as<IWorkbenchContributionsRegistry>(WorkbenchContributionsExtensions.Workbench);\nworkbenchContributionsRegistry.registerWorkbenchContribution(SaveParticipantsContribution, LifecyclePhase.Restored);\n"]}