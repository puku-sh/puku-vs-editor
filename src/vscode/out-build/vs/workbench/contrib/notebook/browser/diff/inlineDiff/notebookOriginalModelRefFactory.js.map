{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/contrib/notebook/browser/diff/inlineDiff/notebookOriginalModelRefFactory.ts","vs/workbench/contrib/notebook/browser/diff/inlineDiff/notebookOriginalModelRefFactory.ts"],"names":[],"mappings":"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","file":"notebookOriginalModelRefFactory.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { AsyncReferenceCollection, IReference, ReferenceCollection } from '../../../../../../base/common/lifecycle.js';\nimport { IModifiedFileEntry } from '../../../../chat/common/chatEditingService.js';\nimport { INotebookService } from '../../../common/notebookService.js';\nimport { bufferToStream, VSBuffer } from '../../../../../../base/common/buffer.js';\nimport { NotebookTextModel } from '../../../common/model/notebookTextModel.js';\nimport { createDecorator, IInstantiationService } from '../../../../../../platform/instantiation/common/instantiation.js';\nimport { ITextModelService } from '../../../../../../editor/common/services/resolverService.js';\n\n\nexport const INotebookOriginalModelReferenceFactory = createDecorator<INotebookOriginalModelReferenceFactory>('INotebookOriginalModelReferenceFactory');\n\nexport interface INotebookOriginalModelReferenceFactory {\n\treadonly _serviceBrand: undefined;\n\tgetOrCreate(fileEntry: IModifiedFileEntry, viewType: string): Promise<IReference<NotebookTextModel>>;\n}\n\n\nexport class OriginalNotebookModelReferenceCollection extends ReferenceCollection<Promise<NotebookTextModel>> {\n\tprivate readonly modelsToDispose = new Set<string>();\n\tconstructor(@INotebookService private readonly notebookService: INotebookService,\n\t\t@ITextModelService private readonly modelService: ITextModelService\n\t) {\n\t\tsuper();\n\t}\n\n\tprotected override async createReferencedObject(key: string, fileEntry: IModifiedFileEntry, viewType: string): Promise<NotebookTextModel> {\n\t\tthis.modelsToDispose.delete(key);\n\t\tconst uri = fileEntry.originalURI;\n\t\tconst model = this.notebookService.getNotebookTextModel(uri);\n\t\tif (model) {\n\t\t\treturn model;\n\t\t}\n\t\tconst modelRef = await this.modelService.createModelReference(uri);\n\t\tconst bytes = VSBuffer.fromString(modelRef.object.textEditorModel.getValue());\n\t\tconst stream = bufferToStream(bytes);\n\t\tmodelRef.dispose();\n\n\t\treturn this.notebookService.createNotebookTextModel(viewType, uri, stream);\n\t}\n\tprotected override destroyReferencedObject(key: string, modelPromise: Promise<NotebookTextModel>): void {\n\t\tthis.modelsToDispose.add(key);\n\n\t\t(async () => {\n\t\t\ttry {\n\t\t\t\tconst model = await modelPromise;\n\n\t\t\t\tif (!this.modelsToDispose.has(key)) {\n\t\t\t\t\t// return if model has been acquired again meanwhile\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t// Finally we can dispose the model\n\t\t\t\tmodel.dispose();\n\t\t\t} catch (error) {\n\t\t\t\t// ignore\n\t\t\t} finally {\n\t\t\t\tthis.modelsToDispose.delete(key); // Untrack as being disposed\n\t\t\t}\n\t\t})();\n\t}\n}\n\nexport class NotebookOriginalModelReferenceFactory implements INotebookOriginalModelReferenceFactory {\n\treadonly _serviceBrand: undefined;\n\tprivate _resourceModelCollection: OriginalNotebookModelReferenceCollection & ReferenceCollection<Promise<NotebookTextModel>> /* TS Fail */ | undefined = undefined;\n\tprivate get resourceModelCollection() {\n\t\tif (!this._resourceModelCollection) {\n\t\t\tthis._resourceModelCollection = this.instantiationService.createInstance(OriginalNotebookModelReferenceCollection);\n\t\t}\n\n\t\treturn this._resourceModelCollection;\n\t}\n\n\tprivate _asyncModelCollection: AsyncReferenceCollection<NotebookTextModel> | undefined = undefined;\n\tprivate get asyncModelCollection() {\n\t\tif (!this._asyncModelCollection) {\n\t\t\tthis._asyncModelCollection = new AsyncReferenceCollection(this.resourceModelCollection);\n\t\t}\n\n\t\treturn this._asyncModelCollection;\n\t}\n\n\tconstructor(@IInstantiationService private readonly instantiationService: IInstantiationService) {\n\t}\n\n\tgetOrCreate(fileEntry: IModifiedFileEntry, viewType: string): Promise<IReference<NotebookTextModel>> {\n\t\treturn this.asyncModelCollection.acquire(fileEntry.originalURI.toString(), fileEntry, viewType);\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { AsyncReferenceCollection, IReference, ReferenceCollection } from '../../../../../../base/common/lifecycle.js';\nimport { IModifiedFileEntry } from '../../../../chat/common/chatEditingService.js';\nimport { INotebookService } from '../../../common/notebookService.js';\nimport { bufferToStream, VSBuffer } from '../../../../../../base/common/buffer.js';\nimport { NotebookTextModel } from '../../../common/model/notebookTextModel.js';\nimport { createDecorator, IInstantiationService } from '../../../../../../platform/instantiation/common/instantiation.js';\nimport { ITextModelService } from '../../../../../../editor/common/services/resolverService.js';\n\n\nexport const INotebookOriginalModelReferenceFactory = createDecorator<INotebookOriginalModelReferenceFactory>('INotebookOriginalModelReferenceFactory');\n\nexport interface INotebookOriginalModelReferenceFactory {\n\treadonly _serviceBrand: undefined;\n\tgetOrCreate(fileEntry: IModifiedFileEntry, viewType: string): Promise<IReference<NotebookTextModel>>;\n}\n\n\nexport class OriginalNotebookModelReferenceCollection extends ReferenceCollection<Promise<NotebookTextModel>> {\n\tprivate readonly modelsToDispose = new Set<string>();\n\tconstructor(@INotebookService private readonly notebookService: INotebookService,\n\t\t@ITextModelService private readonly modelService: ITextModelService\n\t) {\n\t\tsuper();\n\t}\n\n\tprotected override async createReferencedObject(key: string, fileEntry: IModifiedFileEntry, viewType: string): Promise<NotebookTextModel> {\n\t\tthis.modelsToDispose.delete(key);\n\t\tconst uri = fileEntry.originalURI;\n\t\tconst model = this.notebookService.getNotebookTextModel(uri);\n\t\tif (model) {\n\t\t\treturn model;\n\t\t}\n\t\tconst modelRef = await this.modelService.createModelReference(uri);\n\t\tconst bytes = VSBuffer.fromString(modelRef.object.textEditorModel.getValue());\n\t\tconst stream = bufferToStream(bytes);\n\t\tmodelRef.dispose();\n\n\t\treturn this.notebookService.createNotebookTextModel(viewType, uri, stream);\n\t}\n\tprotected override destroyReferencedObject(key: string, modelPromise: Promise<NotebookTextModel>): void {\n\t\tthis.modelsToDispose.add(key);\n\n\t\t(async () => {\n\t\t\ttry {\n\t\t\t\tconst model = await modelPromise;\n\n\t\t\t\tif (!this.modelsToDispose.has(key)) {\n\t\t\t\t\t// return if model has been acquired again meanwhile\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t// Finally we can dispose the model\n\t\t\t\tmodel.dispose();\n\t\t\t} catch (error) {\n\t\t\t\t// ignore\n\t\t\t} finally {\n\t\t\t\tthis.modelsToDispose.delete(key); // Untrack as being disposed\n\t\t\t}\n\t\t})();\n\t}\n}\n\nexport class NotebookOriginalModelReferenceFactory implements INotebookOriginalModelReferenceFactory {\n\treadonly _serviceBrand: undefined;\n\tprivate _resourceModelCollection: OriginalNotebookModelReferenceCollection & ReferenceCollection<Promise<NotebookTextModel>> /* TS Fail */ | undefined = undefined;\n\tprivate get resourceModelCollection() {\n\t\tif (!this._resourceModelCollection) {\n\t\t\tthis._resourceModelCollection = this.instantiationService.createInstance(OriginalNotebookModelReferenceCollection);\n\t\t}\n\n\t\treturn this._resourceModelCollection;\n\t}\n\n\tprivate _asyncModelCollection: AsyncReferenceCollection<NotebookTextModel> | undefined = undefined;\n\tprivate get asyncModelCollection() {\n\t\tif (!this._asyncModelCollection) {\n\t\t\tthis._asyncModelCollection = new AsyncReferenceCollection(this.resourceModelCollection);\n\t\t}\n\n\t\treturn this._asyncModelCollection;\n\t}\n\n\tconstructor(@IInstantiationService private readonly instantiationService: IInstantiationService) {\n\t}\n\n\tgetOrCreate(fileEntry: IModifiedFileEntry, viewType: string): Promise<IReference<NotebookTextModel>> {\n\t\treturn this.asyncModelCollection.acquire(fileEntry.originalURI.toString(), fileEntry, viewType);\n\t}\n}\n"]}