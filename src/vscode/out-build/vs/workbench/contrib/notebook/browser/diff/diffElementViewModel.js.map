{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/contrib/notebook/browser/diff/diffElementViewModel.ts","vs/workbench/contrib/notebook/browser/diff/diffElementViewModel.ts"],"names":[],"mappings":"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","file":"diffElementViewModel.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Emitter } from '../../../../../base/common/event.js';\nimport { hash } from '../../../../../base/common/hash.js';\nimport { Disposable } from '../../../../../base/common/lifecycle.js';\nimport { URI } from '../../../../../base/common/uri.js';\nimport { DiffEditorWidget } from '../../../../../editor/browser/widget/diffEditor/diffEditorWidget.js';\nimport { FontInfo } from '../../../../../editor/common/config/fontInfo.js';\nimport * as editorCommon from '../../../../../editor/common/editorCommon.js';\nimport { getEditorPadding } from './diffCellEditorOptions.js';\nimport { DiffNestedCellViewModel } from './diffNestedCellViewModel.js';\nimport { NotebookDiffEditorEventDispatcher, NotebookDiffViewEventType } from './eventDispatcher.js';\nimport { CellDiffViewModelLayoutChangeEvent, DIFF_CELL_MARGIN, DiffSide, IDiffElementLayoutInfo } from './notebookDiffEditorBrowser.js';\nimport { CellLayoutState, IGenericCellViewModel } from '../notebookBrowser.js';\nimport { NotebookLayoutInfo } from '../notebookViewEvents.js';\nimport { getFormattedMetadataJSON, NotebookCellTextModel } from '../../common/model/notebookCellTextModel.js';\nimport { NotebookTextModel } from '../../common/model/notebookTextModel.js';\nimport { CellUri, ICellOutput, INotebookTextModel, IOutputDto, IOutputItemDto } from '../../common/notebookCommon.js';\nimport { INotebookService } from '../../common/notebookService.js';\nimport { IConfigurationService } from '../../../../../platform/configuration/common/configuration.js';\nimport { Schemas } from '../../../../../base/common/network.js';\nimport { IDiffEditorHeightCalculatorService } from './editorHeightCalculator.js';\nimport { NotebookDocumentMetadataTextModel } from '../../common/model/notebookMetadataTextModel.js';\n\nconst PropertyHeaderHeight = 25;\n\n// From `.monaco-editor .diff-hidden-lines .center` in src/vs/editor/browser/widget/diffEditor/style.css\nexport const HeightOfHiddenLinesRegionInDiffEditor = 24;\n\nexport const DefaultLineHeight = 17;\n\nexport enum PropertyFoldingState {\n\tExpanded,\n\tCollapsed\n}\n\nexport const OUTPUT_EDITOR_HEIGHT_MAGIC = 1440;\n\ntype ILayoutInfoDelta0 = { [K in keyof IDiffElementLayoutInfo]?: number; };\ninterface ILayoutInfoDelta extends ILayoutInfoDelta0 {\n\trawOutputHeight?: number;\n\trecomputeOutput?: boolean;\n}\n\nexport type IDiffElementViewModelBase = DiffElementCellViewModelBase | DiffElementPlaceholderViewModel | NotebookDocumentMetadataViewModel;\n\nexport abstract class DiffElementViewModelBase extends Disposable {\n\tprotected _layoutInfoEmitter = this._register(new Emitter<CellDiffViewModelLayoutChangeEvent>());\n\tonDidLayoutChange = this._layoutInfoEmitter.event;\n\tabstract renderOutput: boolean;\n\tconstructor(\n\t\tpublic readonly mainDocumentTextModel: INotebookTextModel,\n\t\tpublic readonly editorEventDispatcher: NotebookDiffEditorEventDispatcher,\n\t\tpublic readonly initData: {\n\t\t\tmetadataStatusHeight: number;\n\t\t\toutputStatusHeight: number;\n\t\t\tfontInfo: FontInfo | undefined;\n\t\t}\n\t) {\n\t\tsuper();\n\n\t\tthis._register(this.editorEventDispatcher.onDidChangeLayout(e => this._layoutInfoEmitter.fire({ outerWidth: true })));\n\t}\n\n\tabstract layoutChange(): void;\n\tabstract getHeight(lineHeight: number): number;\n\tabstract get totalHeight(): number;\n}\n\nexport class DiffElementPlaceholderViewModel extends DiffElementViewModelBase {\n\treadonly type: 'placeholder' = 'placeholder';\n\tpublic hiddenCells: DiffElementCellViewModelBase[] = [];\n\tprotected _unfoldHiddenCells = this._register(new Emitter<void>());\n\tonUnfoldHiddenCells = this._unfoldHiddenCells.event;\n\n\tpublic renderOutput: boolean = false;\n\tconstructor(\n\t\tmainDocumentTextModel: INotebookTextModel,\n\t\teditorEventDispatcher: NotebookDiffEditorEventDispatcher,\n\t\tinitData: {\n\t\t\tmetadataStatusHeight: number;\n\t\t\toutputStatusHeight: number;\n\t\t\tfontInfo: FontInfo | undefined;\n\t\t}\n\t) {\n\t\tsuper(mainDocumentTextModel, editorEventDispatcher, initData);\n\n\t}\n\tget totalHeight() {\n\t\treturn 24 + (2 * DIFF_CELL_MARGIN);\n\t}\n\tgetHeight(_: number): number {\n\t\treturn this.totalHeight;\n\t}\n\toverride layoutChange(): void {\n\t\t//\n\t}\n\tshowHiddenCells() {\n\t\tthis._unfoldHiddenCells.fire();\n\t}\n}\n\n\nexport class NotebookDocumentMetadataViewModel extends DiffElementViewModelBase {\n\tpublic readonly originalMetadata: NotebookDocumentMetadataTextModel;\n\tpublic readonly modifiedMetadata: NotebookDocumentMetadataTextModel;\n\tpublic cellFoldingState: PropertyFoldingState;\n\tprotected _layoutInfo!: IDiffElementLayoutInfo;\n\tpublic renderOutput: boolean = false;\n\tset editorHeight(height: number) {\n\t\tthis._layout({ editorHeight: height });\n\t}\n\n\tget editorHeight() {\n\t\tthrow new Error('Use Cell.layoutInfo.editorHeight');\n\t}\n\n\tset editorMargin(margin: number) {\n\t\tthis._layout({ editorMargin: margin });\n\t}\n\n\tget editorMargin() {\n\t\tthrow new Error('Use Cell.layoutInfo.editorMargin');\n\t}\n\tget layoutInfo(): IDiffElementLayoutInfo {\n\t\treturn this._layoutInfo;\n\t}\n\n\tget totalHeight() {\n\t\treturn this.layoutInfo.totalHeight;\n\t}\n\n\tprivate _sourceEditorViewState: editorCommon.ICodeEditorViewState | editorCommon.IDiffEditorViewState | null = null;\n\tconstructor(\n\t\tpublic readonly originalDocumentTextModel: INotebookTextModel,\n\t\tpublic readonly modifiedDocumentTextModel: INotebookTextModel,\n\t\tpublic readonly type: 'unchangedMetadata' | 'modifiedMetadata',\n\t\teditorEventDispatcher: NotebookDiffEditorEventDispatcher,\n\t\tinitData: {\n\t\t\tmetadataStatusHeight: number;\n\t\t\toutputStatusHeight: number;\n\t\t\tfontInfo: FontInfo | undefined;\n\t\t},\n\t\tnotebookService: INotebookService,\n\t\tprivate readonly editorHeightCalculator: IDiffEditorHeightCalculatorService\n\t) {\n\t\tsuper(originalDocumentTextModel, editorEventDispatcher, initData);\n\n\t\tconst cellStatusHeight = PropertyHeaderHeight;\n\t\tthis._layoutInfo = {\n\t\t\twidth: 0,\n\t\t\teditorHeight: 0,\n\t\t\teditorMargin: 0,\n\t\t\tmetadataHeight: 0,\n\t\t\tcellStatusHeight,\n\t\t\tmetadataStatusHeight: 0,\n\t\t\trawOutputHeight: 0,\n\t\t\toutputTotalHeight: 0,\n\t\t\toutputStatusHeight: 0,\n\t\t\toutputMetadataHeight: 0,\n\t\t\tbodyMargin: 32,\n\t\t\ttotalHeight: 82 + cellStatusHeight + 0,\n\t\t\tlayoutState: CellLayoutState.Uninitialized\n\t\t};\n\n\t\tthis.cellFoldingState = type === 'modifiedMetadata' ? PropertyFoldingState.Expanded : PropertyFoldingState.Collapsed;\n\t\tthis.originalMetadata = this._register(new NotebookDocumentMetadataTextModel(originalDocumentTextModel));\n\t\tthis.modifiedMetadata = this._register(new NotebookDocumentMetadataTextModel(modifiedDocumentTextModel));\n\t}\n\n\tpublic async computeHeights() {\n\t\tif (this.type === 'unchangedMetadata') {\n\t\t\tthis.editorHeight = this.editorHeightCalculator.computeHeightFromLines(this.originalMetadata.textBuffer.getLineCount());\n\t\t} else {\n\t\t\tconst original = this.originalMetadata.uri;\n\t\t\tconst modified = this.modifiedMetadata.uri;\n\t\t\tthis.editorHeight = await this.editorHeightCalculator.diffAndComputeHeight(original, modified);\n\t\t}\n\t}\n\n\tlayoutChange() {\n\t\tthis._layout({ recomputeOutput: true });\n\t}\n\n\tprotected _layout(delta: ILayoutInfoDelta) {\n\t\tconst width = delta.width !== undefined ? delta.width : this._layoutInfo.width;\n\t\tconst editorHeight = delta.editorHeight !== undefined ? delta.editorHeight : this._layoutInfo.editorHeight;\n\t\tconst editorMargin = delta.editorMargin !== undefined ? delta.editorMargin : this._layoutInfo.editorMargin;\n\t\tconst cellStatusHeight = delta.cellStatusHeight !== undefined ? delta.cellStatusHeight : this._layoutInfo.cellStatusHeight;\n\t\tconst bodyMargin = delta.bodyMargin !== undefined ? delta.bodyMargin : this._layoutInfo.bodyMargin;\n\n\t\tconst totalHeight = editorHeight\n\t\t\t+ editorMargin\n\t\t\t+ cellStatusHeight\n\t\t\t+ bodyMargin;\n\n\t\tconst newLayout: IDiffElementLayoutInfo = {\n\t\t\twidth: width,\n\t\t\teditorHeight: editorHeight,\n\t\t\teditorMargin: editorMargin,\n\t\t\tmetadataHeight: 0,\n\t\t\tcellStatusHeight,\n\t\t\tmetadataStatusHeight: 0,\n\t\t\toutputTotalHeight: 0,\n\t\t\toutputStatusHeight: 0,\n\t\t\tbodyMargin: bodyMargin,\n\t\t\trawOutputHeight: 0,\n\t\t\toutputMetadataHeight: 0,\n\t\t\ttotalHeight: totalHeight,\n\t\t\tlayoutState: CellLayoutState.Measured\n\t\t};\n\n\t\tlet somethingChanged = false;\n\n\t\tconst changeEvent: CellDiffViewModelLayoutChangeEvent = {};\n\n\t\tif (newLayout.width !== this._layoutInfo.width) {\n\t\t\tchangeEvent.width = true;\n\t\t\tsomethingChanged = true;\n\t\t}\n\n\t\tif (newLayout.editorHeight !== this._layoutInfo.editorHeight) {\n\t\t\tchangeEvent.editorHeight = true;\n\t\t\tsomethingChanged = true;\n\t\t}\n\n\t\tif (newLayout.editorMargin !== this._layoutInfo.editorMargin) {\n\t\t\tchangeEvent.editorMargin = true;\n\t\t\tsomethingChanged = true;\n\t\t}\n\n\t\tif (newLayout.cellStatusHeight !== this._layoutInfo.cellStatusHeight) {\n\t\t\tchangeEvent.cellStatusHeight = true;\n\t\t\tsomethingChanged = true;\n\t\t}\n\n\t\tif (newLayout.bodyMargin !== this._layoutInfo.bodyMargin) {\n\t\t\tchangeEvent.bodyMargin = true;\n\t\t\tsomethingChanged = true;\n\t\t}\n\n\t\tif (newLayout.totalHeight !== this._layoutInfo.totalHeight) {\n\t\t\tchangeEvent.totalHeight = true;\n\t\t\tsomethingChanged = true;\n\t\t}\n\n\t\tif (somethingChanged) {\n\t\t\tthis._layoutInfo = newLayout;\n\t\t\tthis._fireLayoutChangeEvent(changeEvent);\n\t\t}\n\t}\n\n\tgetHeight(lineHeight: number) {\n\t\tif (this._layoutInfo.layoutState === CellLayoutState.Uninitialized) {\n\t\t\tconst editorHeight = this.cellFoldingState === PropertyFoldingState.Collapsed ? 0 : this.computeInputEditorHeight(lineHeight);\n\t\t\treturn this._computeTotalHeight(editorHeight);\n\t\t} else {\n\t\t\treturn this._layoutInfo.totalHeight;\n\t\t}\n\t}\n\n\tprivate _computeTotalHeight(editorHeight: number) {\n\t\tconst totalHeight = editorHeight\n\t\t\t+ this._layoutInfo.editorMargin\n\t\t\t+ this._layoutInfo.metadataHeight\n\t\t\t+ this._layoutInfo.cellStatusHeight\n\t\t\t+ this._layoutInfo.metadataStatusHeight\n\t\t\t+ this._layoutInfo.outputTotalHeight\n\t\t\t+ this._layoutInfo.outputStatusHeight\n\t\t\t+ this._layoutInfo.outputMetadataHeight\n\t\t\t+ this._layoutInfo.bodyMargin;\n\n\t\treturn totalHeight;\n\t}\n\n\tpublic computeInputEditorHeight(_lineHeight: number): number {\n\t\treturn this.editorHeightCalculator.computeHeightFromLines(Math.max(this.originalMetadata.textBuffer.getLineCount(), this.modifiedMetadata.textBuffer.getLineCount()));\n\t}\n\n\tprivate _fireLayoutChangeEvent(state: CellDiffViewModelLayoutChangeEvent) {\n\t\tthis._layoutInfoEmitter.fire(state);\n\t\tthis.editorEventDispatcher.emit([{ type: NotebookDiffViewEventType.CellLayoutChanged, source: this._layoutInfo }]);\n\t}\n\n\tgetComputedCellContainerWidth(layoutInfo: NotebookLayoutInfo, diffEditor: boolean, fullWidth: boolean) {\n\t\tif (fullWidth) {\n\t\t\treturn layoutInfo.width - 2 * DIFF_CELL_MARGIN + (diffEditor ? DiffEditorWidget.ENTIRE_DIFF_OVERVIEW_WIDTH : 0) - 2;\n\t\t}\n\n\t\treturn (layoutInfo.width - 2 * DIFF_CELL_MARGIN + (diffEditor ? DiffEditorWidget.ENTIRE_DIFF_OVERVIEW_WIDTH : 0)) / 2 - 18 - 2;\n\t}\n\n\tgetSourceEditorViewState(): editorCommon.ICodeEditorViewState | editorCommon.IDiffEditorViewState | null {\n\t\treturn this._sourceEditorViewState;\n\t}\n\n\tsaveSpirceEditorViewState(viewState: editorCommon.ICodeEditorViewState | editorCommon.IDiffEditorViewState | null) {\n\t\tthis._sourceEditorViewState = viewState;\n\t}\n}\n\n\nexport abstract class DiffElementCellViewModelBase extends DiffElementViewModelBase {\n\tpublic cellFoldingState: PropertyFoldingState;\n\tpublic metadataFoldingState: PropertyFoldingState;\n\tpublic outputFoldingState: PropertyFoldingState;\n\tprotected _stateChangeEmitter = this._register(new Emitter<{ renderOutput: boolean }>());\n\tonDidStateChange = this._stateChangeEmitter.event;\n\tprotected _layoutInfo!: IDiffElementLayoutInfo;\n\n\tpublic displayIconToHideUnmodifiedCells?: boolean;\n\tprivate _hideUnchangedCells = this._register(new Emitter<void>());\n\tpublic onHideUnchangedCells = this._hideUnchangedCells.event;\n\n\thideUnchangedCells() {\n\t\tthis._hideUnchangedCells.fire();\n\t}\n\tset rawOutputHeight(height: number) {\n\t\tthis._layout({ rawOutputHeight: Math.min(OUTPUT_EDITOR_HEIGHT_MAGIC, height) });\n\t}\n\n\tget rawOutputHeight() {\n\t\tthrow new Error('Use Cell.layoutInfo.rawOutputHeight');\n\t}\n\n\tset outputStatusHeight(height: number) {\n\t\tthis._layout({ outputStatusHeight: height });\n\t}\n\n\tget outputStatusHeight() {\n\t\tthrow new Error('Use Cell.layoutInfo.outputStatusHeight');\n\t}\n\n\tset outputMetadataHeight(height: number) {\n\t\tthis._layout({ outputMetadataHeight: height });\n\t}\n\n\tget outputMetadataHeight() {\n\t\tthrow new Error('Use Cell.layoutInfo.outputStatusHeight');\n\t}\n\n\tset editorHeight(height: number) {\n\t\tthis._layout({ editorHeight: height });\n\t}\n\n\tget editorHeight() {\n\t\tthrow new Error('Use Cell.layoutInfo.editorHeight');\n\t}\n\n\tset editorMargin(margin: number) {\n\t\tthis._layout({ editorMargin: margin });\n\t}\n\n\tget editorMargin() {\n\t\tthrow new Error('Use Cell.layoutInfo.editorMargin');\n\t}\n\n\tset metadataStatusHeight(height: number) {\n\t\tthis._layout({ metadataStatusHeight: height });\n\t}\n\n\tget metadataStatusHeight() {\n\t\tthrow new Error('Use Cell.layoutInfo.outputStatusHeight');\n\t}\n\n\tset metadataHeight(height: number) {\n\t\tthis._layout({ metadataHeight: height });\n\t}\n\n\tget metadataHeight() {\n\t\tthrow new Error('Use Cell.layoutInfo.metadataHeight');\n\t}\n\n\tprivate _renderOutput = true;\n\n\tset renderOutput(value: boolean) {\n\t\tthis._renderOutput = value;\n\t\tthis._layout({ recomputeOutput: true });\n\t\tthis._stateChangeEmitter.fire({ renderOutput: this._renderOutput });\n\t}\n\n\tget renderOutput() {\n\t\treturn this._renderOutput;\n\t}\n\n\tget layoutInfo(): IDiffElementLayoutInfo {\n\t\treturn this._layoutInfo;\n\t}\n\n\tget totalHeight() {\n\t\treturn this.layoutInfo.totalHeight;\n\t}\n\n\tprotected get ignoreOutputs() {\n\t\treturn this.configurationService.getValue<boolean>('notebook.diff.ignoreOutputs') || !!(this.mainDocumentTextModel?.transientOptions.transientOutputs);\n\t}\n\n\tprotected get ignoreMetadata() {\n\t\treturn this.configurationService.getValue<boolean>('notebook.diff.ignoreMetadata');\n\t}\n\n\tprivate _sourceEditorViewState: editorCommon.ICodeEditorViewState | editorCommon.IDiffEditorViewState | null = null;\n\tprivate _outputEditorViewState: editorCommon.ICodeEditorViewState | editorCommon.IDiffEditorViewState | null = null;\n\tprivate _metadataEditorViewState: editorCommon.ICodeEditorViewState | editorCommon.IDiffEditorViewState | null = null;\n\tpublic readonly original: DiffNestedCellViewModel | undefined;\n\n\tpublic readonly modified: DiffNestedCellViewModel | undefined;\n\tconstructor(\n\t\tmainDocumentTextModel: INotebookTextModel,\n\t\toriginal: NotebookCellTextModel | undefined,\n\t\tmodified: NotebookCellTextModel | undefined,\n\t\treadonly type: 'unchanged' | 'insert' | 'delete' | 'modified',\n\t\teditorEventDispatcher: NotebookDiffEditorEventDispatcher,\n\t\tinitData: {\n\t\t\tmetadataStatusHeight: number;\n\t\t\toutputStatusHeight: number;\n\t\t\tfontInfo: FontInfo | undefined;\n\t\t},\n\t\tnotebookService: INotebookService,\n\t\tpublic readonly index: number,\n\t\tprivate readonly configurationService: IConfigurationService,\n\t\tpublic readonly diffEditorHeightCalculator: IDiffEditorHeightCalculatorService\n\t) {\n\t\tsuper(mainDocumentTextModel, editorEventDispatcher, initData);\n\t\tthis.original = original ? this._register(new DiffNestedCellViewModel(original, notebookService)) : undefined;\n\t\tthis.modified = modified ? this._register(new DiffNestedCellViewModel(modified, notebookService)) : undefined;\n\t\tconst editorHeight = this._estimateEditorHeight(initData.fontInfo);\n\t\tconst cellStatusHeight = PropertyHeaderHeight;\n\t\tthis._layoutInfo = {\n\t\t\twidth: 0,\n\t\t\teditorHeight: editorHeight,\n\t\t\teditorMargin: 0,\n\t\t\tmetadataHeight: 0,\n\t\t\tcellStatusHeight,\n\t\t\tmetadataStatusHeight: this.ignoreMetadata ? 0 : PropertyHeaderHeight,\n\t\t\trawOutputHeight: 0,\n\t\t\toutputTotalHeight: 0,\n\t\t\toutputStatusHeight: this.ignoreOutputs ? 0 : PropertyHeaderHeight,\n\t\t\toutputMetadataHeight: 0,\n\t\t\tbodyMargin: 32,\n\t\t\ttotalHeight: 82 + cellStatusHeight + editorHeight,\n\t\t\tlayoutState: CellLayoutState.Uninitialized\n\t\t};\n\n\t\tthis.cellFoldingState = modified?.getTextBufferHash() !== original?.getTextBufferHash() ? PropertyFoldingState.Expanded : PropertyFoldingState.Collapsed;\n\t\tthis.metadataFoldingState = PropertyFoldingState.Collapsed;\n\t\tthis.outputFoldingState = PropertyFoldingState.Collapsed;\n\t}\n\n\tlayoutChange() {\n\t\tthis._layout({ recomputeOutput: true });\n\t}\n\n\tprivate _estimateEditorHeight(fontInfo: FontInfo | undefined) {\n\t\tconst lineHeight = fontInfo?.lineHeight ?? 17;\n\n\t\tswitch (this.type) {\n\t\t\tcase 'unchanged':\n\t\t\tcase 'insert':\n\t\t\t\t{\n\t\t\t\t\tconst lineCount = this.modified!.textModel.textBuffer.getLineCount();\n\t\t\t\t\tconst editorHeight = lineCount * lineHeight + getEditorPadding(lineCount).top + getEditorPadding(lineCount).bottom;\n\t\t\t\t\treturn editorHeight;\n\t\t\t\t}\n\t\t\tcase 'delete':\n\t\t\tcase 'modified':\n\t\t\t\t{\n\t\t\t\t\tconst lineCount = this.original!.textModel.textBuffer.getLineCount();\n\t\t\t\t\tconst editorHeight = lineCount * lineHeight + getEditorPadding(lineCount).top + getEditorPadding(lineCount).bottom;\n\t\t\t\t\treturn editorHeight;\n\t\t\t\t}\n\t\t}\n\t}\n\n\tprotected _layout(delta: ILayoutInfoDelta) {\n\t\tconst width = delta.width !== undefined ? delta.width : this._layoutInfo.width;\n\t\tconst editorHeight = delta.editorHeight !== undefined ? delta.editorHeight : this._layoutInfo.editorHeight;\n\t\tconst editorMargin = delta.editorMargin !== undefined ? delta.editorMargin : this._layoutInfo.editorMargin;\n\t\tconst metadataHeight = delta.metadataHeight !== undefined ? delta.metadataHeight : this._layoutInfo.metadataHeight;\n\t\tconst cellStatusHeight = delta.cellStatusHeight !== undefined ? delta.cellStatusHeight : this._layoutInfo.cellStatusHeight;\n\t\tconst metadataStatusHeight = delta.metadataStatusHeight !== undefined ? delta.metadataStatusHeight : this._layoutInfo.metadataStatusHeight;\n\t\tconst rawOutputHeight = delta.rawOutputHeight !== undefined ? delta.rawOutputHeight : this._layoutInfo.rawOutputHeight;\n\t\tconst outputStatusHeight = delta.outputStatusHeight !== undefined ? delta.outputStatusHeight : this._layoutInfo.outputStatusHeight;\n\t\tconst bodyMargin = delta.bodyMargin !== undefined ? delta.bodyMargin : this._layoutInfo.bodyMargin;\n\t\tconst outputMetadataHeight = delta.outputMetadataHeight !== undefined ? delta.outputMetadataHeight : this._layoutInfo.outputMetadataHeight;\n\t\tconst outputHeight = this.ignoreOutputs ? 0 : (delta.recomputeOutput || delta.rawOutputHeight !== undefined || delta.outputMetadataHeight !== undefined) ? this._getOutputTotalHeight(rawOutputHeight, outputMetadataHeight) : this._layoutInfo.outputTotalHeight;\n\n\t\tconst totalHeight = editorHeight\n\t\t\t+ editorMargin\n\t\t\t+ cellStatusHeight\n\t\t\t+ metadataHeight\n\t\t\t+ metadataStatusHeight\n\t\t\t+ outputHeight\n\t\t\t+ outputStatusHeight\n\t\t\t+ bodyMargin;\n\n\t\tconst newLayout: IDiffElementLayoutInfo = {\n\t\t\twidth: width,\n\t\t\teditorHeight: editorHeight,\n\t\t\teditorMargin: editorMargin,\n\t\t\tmetadataHeight: metadataHeight,\n\t\t\tcellStatusHeight,\n\t\t\tmetadataStatusHeight: metadataStatusHeight,\n\t\t\toutputTotalHeight: outputHeight,\n\t\t\toutputStatusHeight: outputStatusHeight,\n\t\t\tbodyMargin: bodyMargin,\n\t\t\trawOutputHeight: rawOutputHeight,\n\t\t\toutputMetadataHeight: outputMetadataHeight,\n\t\t\ttotalHeight: totalHeight,\n\t\t\tlayoutState: CellLayoutState.Measured\n\t\t};\n\n\t\tlet somethingChanged = false;\n\n\t\tconst changeEvent: CellDiffViewModelLayoutChangeEvent = {};\n\n\t\tif (newLayout.width !== this._layoutInfo.width) {\n\t\t\tchangeEvent.width = true;\n\t\t\tsomethingChanged = true;\n\t\t}\n\n\t\tif (newLayout.editorHeight !== this._layoutInfo.editorHeight) {\n\t\t\tchangeEvent.editorHeight = true;\n\t\t\tsomethingChanged = true;\n\t\t}\n\n\t\tif (newLayout.editorMargin !== this._layoutInfo.editorMargin) {\n\t\t\tchangeEvent.editorMargin = true;\n\t\t\tsomethingChanged = true;\n\t\t}\n\n\t\tif (newLayout.metadataHeight !== this._layoutInfo.metadataHeight) {\n\t\t\tchangeEvent.metadataHeight = true;\n\t\t\tsomethingChanged = true;\n\t\t}\n\n\t\tif (newLayout.cellStatusHeight !== this._layoutInfo.cellStatusHeight) {\n\t\t\tchangeEvent.cellStatusHeight = true;\n\t\t\tsomethingChanged = true;\n\t\t}\n\n\t\tif (newLayout.metadataStatusHeight !== this._layoutInfo.metadataStatusHeight) {\n\t\t\tchangeEvent.metadataStatusHeight = true;\n\t\t\tsomethingChanged = true;\n\t\t}\n\n\t\tif (newLayout.outputTotalHeight !== this._layoutInfo.outputTotalHeight) {\n\t\t\tchangeEvent.outputTotalHeight = true;\n\t\t\tsomethingChanged = true;\n\t\t}\n\n\t\tif (newLayout.outputStatusHeight !== this._layoutInfo.outputStatusHeight) {\n\t\t\tchangeEvent.outputStatusHeight = true;\n\t\t\tsomethingChanged = true;\n\t\t}\n\n\t\tif (newLayout.bodyMargin !== this._layoutInfo.bodyMargin) {\n\t\t\tchangeEvent.bodyMargin = true;\n\t\t\tsomethingChanged = true;\n\t\t}\n\n\t\tif (newLayout.outputMetadataHeight !== this._layoutInfo.outputMetadataHeight) {\n\t\t\tchangeEvent.outputMetadataHeight = true;\n\t\t\tsomethingChanged = true;\n\t\t}\n\n\t\tif (newLayout.totalHeight !== this._layoutInfo.totalHeight) {\n\t\t\tchangeEvent.totalHeight = true;\n\t\t\tsomethingChanged = true;\n\t\t}\n\n\t\tif (somethingChanged) {\n\t\t\tthis._layoutInfo = newLayout;\n\t\t\tthis._fireLayoutChangeEvent(changeEvent);\n\t\t}\n\t}\n\n\tgetHeight(lineHeight: number) {\n\t\tif (this._layoutInfo.layoutState === CellLayoutState.Uninitialized) {\n\t\t\tconst editorHeight = this.cellFoldingState === PropertyFoldingState.Collapsed ? 0 : this.computeInputEditorHeight(lineHeight);\n\t\t\treturn this._computeTotalHeight(editorHeight);\n\t\t} else {\n\t\t\treturn this._layoutInfo.totalHeight;\n\t\t}\n\t}\n\n\tprivate _computeTotalHeight(editorHeight: number) {\n\t\tconst totalHeight = editorHeight\n\t\t\t+ this._layoutInfo.editorMargin\n\t\t\t+ this._layoutInfo.metadataHeight\n\t\t\t+ this._layoutInfo.cellStatusHeight\n\t\t\t+ this._layoutInfo.metadataStatusHeight\n\t\t\t+ this._layoutInfo.outputTotalHeight\n\t\t\t+ this._layoutInfo.outputStatusHeight\n\t\t\t+ this._layoutInfo.outputMetadataHeight\n\t\t\t+ this._layoutInfo.bodyMargin;\n\n\t\treturn totalHeight;\n\t}\n\n\tpublic computeInputEditorHeight(lineHeight: number): number {\n\t\tconst lineCount = Math.max(this.original?.textModel.textBuffer.getLineCount() ?? 1, this.modified?.textModel.textBuffer.getLineCount() ?? 1);\n\t\treturn this.diffEditorHeightCalculator.computeHeightFromLines(lineCount);\n\t}\n\n\tprivate _getOutputTotalHeight(rawOutputHeight: number, metadataHeight: number) {\n\t\tif (this.outputFoldingState === PropertyFoldingState.Collapsed) {\n\t\t\treturn 0;\n\t\t}\n\n\t\tif (this.renderOutput) {\n\t\t\tif (this.isOutputEmpty()) {\n\t\t\t\t// single line;\n\t\t\t\treturn 24;\n\t\t\t}\n\t\t\treturn this.getRichOutputTotalHeight() + metadataHeight;\n\t\t} else {\n\t\t\treturn rawOutputHeight;\n\t\t}\n\t}\n\n\tprivate _fireLayoutChangeEvent(state: CellDiffViewModelLayoutChangeEvent) {\n\t\tthis._layoutInfoEmitter.fire(state);\n\t\tthis.editorEventDispatcher.emit([{ type: NotebookDiffViewEventType.CellLayoutChanged, source: this._layoutInfo }]);\n\t}\n\n\tabstract checkIfInputModified(): false | { reason: string | undefined };\n\tabstract checkIfOutputsModified(): false | { reason: string | undefined };\n\tabstract checkMetadataIfModified(): false | { reason: string | undefined };\n\tabstract isOutputEmpty(): boolean;\n\tabstract getRichOutputTotalHeight(): number;\n\tabstract getCellByUri(cellUri: URI): IGenericCellViewModel;\n\tabstract getOutputOffsetInCell(diffSide: DiffSide, index: number): number;\n\tabstract getOutputOffsetInContainer(diffSide: DiffSide, index: number): number;\n\tabstract updateOutputHeight(diffSide: DiffSide, index: number, height: number): void;\n\tabstract getNestedCellViewModel(diffSide: DiffSide): DiffNestedCellViewModel;\n\n\tgetComputedCellContainerWidth(layoutInfo: NotebookLayoutInfo, diffEditor: boolean, fullWidth: boolean) {\n\t\tif (fullWidth) {\n\t\t\treturn layoutInfo.width - 2 * DIFF_CELL_MARGIN + (diffEditor ? DiffEditorWidget.ENTIRE_DIFF_OVERVIEW_WIDTH : 0) - 2;\n\t\t}\n\n\t\treturn (layoutInfo.width - 2 * DIFF_CELL_MARGIN + (diffEditor ? DiffEditorWidget.ENTIRE_DIFF_OVERVIEW_WIDTH : 0)) / 2 - 18 - 2;\n\t}\n\n\tgetOutputEditorViewState(): editorCommon.ICodeEditorViewState | editorCommon.IDiffEditorViewState | null {\n\t\treturn this._outputEditorViewState;\n\t}\n\n\tsaveOutputEditorViewState(viewState: editorCommon.ICodeEditorViewState | editorCommon.IDiffEditorViewState | null) {\n\t\tthis._outputEditorViewState = viewState;\n\t}\n\n\tgetMetadataEditorViewState(): editorCommon.ICodeEditorViewState | editorCommon.IDiffEditorViewState | null {\n\t\treturn this._metadataEditorViewState;\n\t}\n\n\tsaveMetadataEditorViewState(viewState: editorCommon.ICodeEditorViewState | editorCommon.IDiffEditorViewState | null) {\n\t\tthis._metadataEditorViewState = viewState;\n\t}\n\n\tgetSourceEditorViewState(): editorCommon.ICodeEditorViewState | editorCommon.IDiffEditorViewState | null {\n\t\treturn this._sourceEditorViewState;\n\t}\n\n\tsaveSpirceEditorViewState(viewState: editorCommon.ICodeEditorViewState | editorCommon.IDiffEditorViewState | null) {\n\t\tthis._sourceEditorViewState = viewState;\n\t}\n}\n\nexport class SideBySideDiffElementViewModel extends DiffElementCellViewModelBase {\n\tget originalDocument() {\n\t\treturn this.otherDocumentTextModel;\n\t}\n\n\tget modifiedDocument() {\n\t\treturn this.mainDocumentTextModel;\n\t}\n\n\tdeclare readonly original: DiffNestedCellViewModel;\n\tdeclare readonly modified: DiffNestedCellViewModel;\n\toverride readonly type: 'unchanged' | 'modified';\n\n\t/**\n\t * The height of the editor when the unchanged lines are collapsed.\n\t */\n\tprivate editorHeightWithUnchangedLinesCollapsed?: number;\n\tconstructor(\n\t\tmainDocumentTextModel: NotebookTextModel,\n\t\treadonly otherDocumentTextModel: NotebookTextModel,\n\t\toriginal: NotebookCellTextModel,\n\t\tmodified: NotebookCellTextModel,\n\t\ttype: 'unchanged' | 'modified',\n\t\teditorEventDispatcher: NotebookDiffEditorEventDispatcher,\n\t\tinitData: {\n\t\t\tmetadataStatusHeight: number;\n\t\t\toutputStatusHeight: number;\n\t\t\tfontInfo: FontInfo | undefined;\n\t\t},\n\t\tnotebookService: INotebookService,\n\t\tconfigurationService: IConfigurationService,\n\t\tindex: number,\n\t\tdiffEditorHeightCalculator: IDiffEditorHeightCalculatorService\n\t) {\n\t\tsuper(\n\t\t\tmainDocumentTextModel,\n\t\t\toriginal,\n\t\t\tmodified,\n\t\t\ttype,\n\t\t\teditorEventDispatcher,\n\t\t\tinitData,\n\t\t\tnotebookService,\n\t\t\tindex,\n\t\t\tconfigurationService,\n\t\t\tdiffEditorHeightCalculator);\n\n\t\tthis.type = type;\n\n\t\tthis.cellFoldingState = this.modified.textModel.getValue() !== this.original.textModel.getValue() ? PropertyFoldingState.Expanded : PropertyFoldingState.Collapsed;\n\t\tthis.metadataFoldingState = PropertyFoldingState.Collapsed;\n\t\tthis.outputFoldingState = PropertyFoldingState.Collapsed;\n\n\t\tif (this.checkMetadataIfModified()) {\n\t\t\tthis.metadataFoldingState = PropertyFoldingState.Expanded;\n\t\t}\n\n\t\tif (this.checkIfOutputsModified()) {\n\t\t\tthis.outputFoldingState = PropertyFoldingState.Expanded;\n\t\t}\n\n\t\tthis._register(this.original.onDidChangeOutputLayout(() => {\n\t\t\tthis._layout({ recomputeOutput: true });\n\t\t}));\n\n\t\tthis._register(this.modified.onDidChangeOutputLayout(() => {\n\t\t\tthis._layout({ recomputeOutput: true });\n\t\t}));\n\n\t\tthis._register(this.modified.textModel.onDidChangeContent(() => {\n\t\t\tif (mainDocumentTextModel.transientOptions.cellContentMetadata) {\n\t\t\t\tconst cellMetadataKeys = [...Object.keys(mainDocumentTextModel.transientOptions.cellContentMetadata)];\n\t\t\t\tconst modifiedMedataRaw = Object.assign({}, this.modified.metadata);\n\t\t\t\tconst originalCellMetadata = this.original.metadata;\n\t\t\t\tfor (const key of cellMetadataKeys) {\n\t\t\t\t\tif (Object.hasOwn(originalCellMetadata, key)) {\n\t\t\t\t\t\tmodifiedMedataRaw[key] = originalCellMetadata[key];\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tthis.modified.textModel.metadata = modifiedMedataRaw;\n\t\t\t}\n\t\t}));\n\t}\n\n\toverride checkIfInputModified(): false | { reason: string | undefined } {\n\t\tif (this.original.textModel.getTextBufferHash() === this.modified.textModel.getTextBufferHash()) {\n\t\t\treturn false;\n\t\t}\n\t\treturn {\n\t\t\treason: 'Cell content has changed',\n\t\t};\n\t}\n\tcheckIfOutputsModified() {\n\t\tif (this.mainDocumentTextModel.transientOptions.transientOutputs || this.ignoreOutputs) {\n\t\t\treturn false;\n\t\t}\n\n\t\tconst ret = outputsEqual(this.original?.outputs ?? [], this.modified?.outputs ?? []);\n\n\t\tif (ret === OutputComparison.Unchanged) {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn {\n\t\t\treason: ret === OutputComparison.Metadata ? 'Output metadata has changed' : undefined,\n\t\t\tkind: ret\n\t\t};\n\t}\n\n\tcheckMetadataIfModified() {\n\t\tif (this.ignoreMetadata) {\n\t\t\treturn false;\n\t\t}\n\t\tconst modified = hash(getFormattedMetadataJSON(this.mainDocumentTextModel.transientOptions.transientCellMetadata, this.original?.metadata || {}, this.original?.language)) !== hash(getFormattedMetadataJSON(this.mainDocumentTextModel.transientOptions.transientCellMetadata, this.modified?.metadata ?? {}, this.modified?.language));\n\t\tif (modified) {\n\t\t\treturn { reason: undefined };\n\t\t} else {\n\t\t\treturn false;\n\t\t}\n\t}\n\n\tupdateOutputHeight(diffSide: DiffSide, index: number, height: number) {\n\t\tif (diffSide === DiffSide.Original) {\n\t\t\tthis.original.updateOutputHeight(index, height);\n\t\t} else {\n\t\t\tthis.modified.updateOutputHeight(index, height);\n\t\t}\n\t}\n\n\tgetOutputOffsetInContainer(diffSide: DiffSide, index: number) {\n\t\tif (diffSide === DiffSide.Original) {\n\t\t\treturn this.original.getOutputOffset(index);\n\t\t} else {\n\t\t\treturn this.modified.getOutputOffset(index);\n\t\t}\n\t}\n\n\tgetOutputOffsetInCell(diffSide: DiffSide, index: number) {\n\t\tconst offsetInOutputsContainer = this.getOutputOffsetInContainer(diffSide, index);\n\n\t\treturn this._layoutInfo.editorHeight\n\t\t\t+ this._layoutInfo.editorMargin\n\t\t\t+ this._layoutInfo.metadataHeight\n\t\t\t+ this._layoutInfo.cellStatusHeight\n\t\t\t+ this._layoutInfo.metadataStatusHeight\n\t\t\t+ this._layoutInfo.outputStatusHeight\n\t\t\t+ this._layoutInfo.bodyMargin / 2\n\t\t\t+ offsetInOutputsContainer;\n\t}\n\n\tisOutputEmpty() {\n\t\tif (this.mainDocumentTextModel.transientOptions.transientOutputs) {\n\t\t\treturn true;\n\t\t}\n\n\t\tif (this.checkIfOutputsModified()) {\n\t\t\treturn false;\n\t\t}\n\n\t\t// outputs are not changed\n\n\t\treturn (this.original?.outputs || []).length === 0;\n\t}\n\n\tgetRichOutputTotalHeight() {\n\t\treturn Math.max(this.original.getOutputTotalHeight(), this.modified.getOutputTotalHeight());\n\t}\n\n\tgetNestedCellViewModel(diffSide: DiffSide): DiffNestedCellViewModel {\n\t\treturn diffSide === DiffSide.Original ? this.original : this.modified;\n\t}\n\n\tgetCellByUri(cellUri: URI): IGenericCellViewModel {\n\t\tif (cellUri.toString() === this.original.uri.toString()) {\n\t\t\treturn this.original;\n\t\t} else {\n\t\t\treturn this.modified;\n\t\t}\n\t}\n\n\tpublic override computeInputEditorHeight(lineHeight: number): number {\n\t\tif (this.type === 'modified' &&\n\t\t\ttypeof this.editorHeightWithUnchangedLinesCollapsed === 'number' &&\n\t\t\tthis.checkIfInputModified()) {\n\t\t\treturn this.editorHeightWithUnchangedLinesCollapsed;\n\t\t}\n\n\t\treturn super.computeInputEditorHeight(lineHeight);\n\t}\n\n\tprivate async computeModifiedInputEditorHeight() {\n\t\tif (this.checkIfInputModified()) {\n\t\t\tthis.editorHeightWithUnchangedLinesCollapsed = this._layoutInfo.editorHeight = await this.diffEditorHeightCalculator.diffAndComputeHeight(this.original.uri, this.modified.uri);\n\t\t}\n\t}\n\n\tprivate async computeModifiedMetadataEditorHeight() {\n\t\tif (this.checkMetadataIfModified()) {\n\t\t\tconst originalMetadataUri = CellUri.generateCellPropertyUri(this.originalDocument.uri, this.original.handle, Schemas.vscodeNotebookCellMetadata);\n\t\t\tconst modifiedMetadataUri = CellUri.generateCellPropertyUri(this.modifiedDocument.uri, this.modified.handle, Schemas.vscodeNotebookCellMetadata);\n\t\t\tthis._layoutInfo.metadataHeight = await this.diffEditorHeightCalculator.diffAndComputeHeight(originalMetadataUri, modifiedMetadataUri);\n\t\t}\n\t}\n\n\tpublic async computeEditorHeights() {\n\t\tif (this.type === 'unchanged') {\n\t\t\treturn;\n\t\t}\n\n\t\tawait Promise.all([this.computeModifiedInputEditorHeight(), this.computeModifiedMetadataEditorHeight()]);\n\t}\n\n}\n\nexport class SingleSideDiffElementViewModel extends DiffElementCellViewModelBase {\n\tget cellViewModel() {\n\t\treturn this.type === 'insert' ? this.modified! : this.original!;\n\t}\n\n\tget originalDocument() {\n\t\tif (this.type === 'insert') {\n\t\t\treturn this.otherDocumentTextModel;\n\t\t} else {\n\t\t\treturn this.mainDocumentTextModel;\n\t\t}\n\t}\n\n\tget modifiedDocument() {\n\t\tif (this.type === 'insert') {\n\t\t\treturn this.mainDocumentTextModel;\n\t\t} else {\n\t\t\treturn this.otherDocumentTextModel;\n\t\t}\n\t}\n\n\toverride readonly type: 'insert' | 'delete';\n\n\tconstructor(\n\t\tmainDocumentTextModel: NotebookTextModel,\n\t\treadonly otherDocumentTextModel: NotebookTextModel,\n\t\toriginal: NotebookCellTextModel | undefined,\n\t\tmodified: NotebookCellTextModel | undefined,\n\t\ttype: 'insert' | 'delete',\n\t\teditorEventDispatcher: NotebookDiffEditorEventDispatcher,\n\t\tinitData: {\n\t\t\tmetadataStatusHeight: number;\n\t\t\toutputStatusHeight: number;\n\t\t\tfontInfo: FontInfo | undefined;\n\t\t},\n\t\tnotebookService: INotebookService,\n\t\tconfigurationService: IConfigurationService,\n\t\tdiffEditorHeightCalculator: IDiffEditorHeightCalculatorService,\n\t\tindex: number\n\t) {\n\t\tsuper(mainDocumentTextModel, original, modified, type, editorEventDispatcher, initData, notebookService, index, configurationService, diffEditorHeightCalculator);\n\t\tthis.type = type;\n\n\t\tthis._register(this.cellViewModel.onDidChangeOutputLayout(() => {\n\t\t\tthis._layout({ recomputeOutput: true });\n\t\t}));\n\t}\n\n\toverride checkIfInputModified(): false | { reason: string | undefined } {\n\t\treturn {\n\t\t\treason: 'Cell content has changed',\n\t\t};\n\t}\n\n\tgetNestedCellViewModel(diffSide: DiffSide): DiffNestedCellViewModel {\n\t\treturn this.type === 'insert' ? this.modified! : this.original!;\n\t}\n\n\n\tcheckIfOutputsModified(): false | { reason: string | undefined } {\n\t\treturn false;\n\t}\n\n\tcheckMetadataIfModified(): false | { reason: string | undefined } {\n\t\treturn false;\n\t}\n\n\tupdateOutputHeight(diffSide: DiffSide, index: number, height: number) {\n\t\tthis.cellViewModel?.updateOutputHeight(index, height);\n\t}\n\n\tgetOutputOffsetInContainer(diffSide: DiffSide, index: number) {\n\t\treturn this.cellViewModel.getOutputOffset(index);\n\t}\n\n\tgetOutputOffsetInCell(diffSide: DiffSide, index: number) {\n\t\tconst offsetInOutputsContainer = this.cellViewModel.getOutputOffset(index);\n\n\t\treturn this._layoutInfo.editorHeight\n\t\t\t+ this._layoutInfo.editorMargin\n\t\t\t+ this._layoutInfo.metadataHeight\n\t\t\t+ this._layoutInfo.cellStatusHeight\n\t\t\t+ this._layoutInfo.metadataStatusHeight\n\t\t\t+ this._layoutInfo.outputStatusHeight\n\t\t\t+ this._layoutInfo.bodyMargin / 2\n\t\t\t+ offsetInOutputsContainer;\n\t}\n\n\tisOutputEmpty() {\n\t\tif (this.mainDocumentTextModel.transientOptions.transientOutputs) {\n\t\t\treturn true;\n\t\t}\n\n\t\t// outputs are not changed\n\n\t\treturn (this.original?.outputs || this.modified?.outputs || []).length === 0;\n\t}\n\n\tgetRichOutputTotalHeight() {\n\t\treturn this.cellViewModel?.getOutputTotalHeight() ?? 0;\n\t}\n\n\tgetCellByUri(cellUri: URI): IGenericCellViewModel {\n\t\treturn this.cellViewModel;\n\t}\n}\n\nexport const enum OutputComparison {\n\tUnchanged = 0,\n\tMetadata = 1,\n\tOther = 2\n}\n\nexport function outputEqual(a: ICellOutput, b: ICellOutput): OutputComparison {\n\tif (hash(a.metadata) === hash(b.metadata)) {\n\t\treturn OutputComparison.Other;\n\t}\n\n\t// metadata not equal\n\tfor (let j = 0; j < a.outputs.length; j++) {\n\t\tconst aOutputItem = a.outputs[j];\n\t\tconst bOutputItem = b.outputs[j];\n\n\t\tif (aOutputItem.mime !== bOutputItem.mime) {\n\t\t\treturn OutputComparison.Other;\n\t\t}\n\n\t\tif (aOutputItem.data.buffer.length !== bOutputItem.data.buffer.length) {\n\t\t\treturn OutputComparison.Other;\n\t\t}\n\n\t\tfor (let k = 0; k < aOutputItem.data.buffer.length; k++) {\n\t\t\tif (aOutputItem.data.buffer[k] !== bOutputItem.data.buffer[k]) {\n\t\t\t\treturn OutputComparison.Other;\n\t\t\t}\n\t\t}\n\t}\n\n\treturn OutputComparison.Metadata;\n}\n\nfunction outputsEqual(original: ICellOutput[], modified: ICellOutput[]) {\n\tif (original.length !== modified.length) {\n\t\treturn OutputComparison.Other;\n\t}\n\n\tconst len = original.length;\n\tfor (let i = 0; i < len; i++) {\n\t\tconst a = original[i];\n\t\tconst b = modified[i];\n\n\t\tif (hash(a.metadata) !== hash(b.metadata)) {\n\t\t\treturn OutputComparison.Metadata;\n\t\t}\n\n\t\tif (a.outputs.length !== b.outputs.length) {\n\t\t\treturn OutputComparison.Other;\n\t\t}\n\n\t\tfor (let j = 0; j < a.outputs.length; j++) {\n\t\t\tconst aOutputItem = a.outputs[j];\n\t\t\tconst bOutputItem = b.outputs[j];\n\n\t\t\tif (aOutputItem.mime !== bOutputItem.mime) {\n\t\t\t\treturn OutputComparison.Other;\n\t\t\t}\n\n\t\t\tif (aOutputItem.data.buffer.length !== bOutputItem.data.buffer.length) {\n\t\t\t\treturn OutputComparison.Other;\n\t\t\t}\n\n\t\t\tfor (let k = 0; k < aOutputItem.data.buffer.length; k++) {\n\t\t\t\tif (aOutputItem.data.buffer[k] !== bOutputItem.data.buffer[k]) {\n\t\t\t\t\treturn OutputComparison.Other;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\treturn OutputComparison.Unchanged;\n}\n\nexport function getStreamOutputData(outputs: IOutputItemDto[]) {\n\tif (!outputs.length) {\n\t\treturn null;\n\t}\n\n\tconst first = outputs[0];\n\tconst mime = first.mime;\n\tconst sameStream = !outputs.find(op => op.mime !== mime);\n\n\tif (sameStream) {\n\t\treturn outputs.map(opit => opit.data.toString()).join('');\n\t} else {\n\t\treturn null;\n\t}\n}\n\nexport function getFormattedOutputJSON(outputs: IOutputDto[]) {\n\tif (outputs.length === 1) {\n\t\tconst streamOutputData = getStreamOutputData(outputs[0].outputs);\n\t\tif (streamOutputData) {\n\t\t\treturn streamOutputData;\n\t\t}\n\t}\n\n\treturn JSON.stringify(outputs.map(output => {\n\t\treturn ({\n\t\t\tmetadata: output.metadata,\n\t\t\toutputItems: output.outputs.map(opit => ({\n\t\t\t\tmimeType: opit.mime,\n\t\t\t\tdata: opit.data.toString()\n\t\t\t}))\n\t\t});\n\t}), undefined, '\\t');\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Emitter } from '../../../../../base/common/event.js';\nimport { hash } from '../../../../../base/common/hash.js';\nimport { Disposable } from '../../../../../base/common/lifecycle.js';\nimport { URI } from '../../../../../base/common/uri.js';\nimport { DiffEditorWidget } from '../../../../../editor/browser/widget/diffEditor/diffEditorWidget.js';\nimport { FontInfo } from '../../../../../editor/common/config/fontInfo.js';\nimport * as editorCommon from '../../../../../editor/common/editorCommon.js';\nimport { getEditorPadding } from './diffCellEditorOptions.js';\nimport { DiffNestedCellViewModel } from './diffNestedCellViewModel.js';\nimport { NotebookDiffEditorEventDispatcher, NotebookDiffViewEventType } from './eventDispatcher.js';\nimport { CellDiffViewModelLayoutChangeEvent, DIFF_CELL_MARGIN, DiffSide, IDiffElementLayoutInfo } from './notebookDiffEditorBrowser.js';\nimport { CellLayoutState, IGenericCellViewModel } from '../notebookBrowser.js';\nimport { NotebookLayoutInfo } from '../notebookViewEvents.js';\nimport { getFormattedMetadataJSON, NotebookCellTextModel } from '../../common/model/notebookCellTextModel.js';\nimport { NotebookTextModel } from '../../common/model/notebookTextModel.js';\nimport { CellUri, ICellOutput, INotebookTextModel, IOutputDto, IOutputItemDto } from '../../common/notebookCommon.js';\nimport { INotebookService } from '../../common/notebookService.js';\nimport { IConfigurationService } from '../../../../../platform/configuration/common/configuration.js';\nimport { Schemas } from '../../../../../base/common/network.js';\nimport { IDiffEditorHeightCalculatorService } from './editorHeightCalculator.js';\nimport { NotebookDocumentMetadataTextModel } from '../../common/model/notebookMetadataTextModel.js';\n\nconst PropertyHeaderHeight = 25;\n\n// From `.monaco-editor .diff-hidden-lines .center` in src/vs/editor/browser/widget/diffEditor/style.css\nexport const HeightOfHiddenLinesRegionInDiffEditor = 24;\n\nexport const DefaultLineHeight = 17;\n\nexport enum PropertyFoldingState {\n\tExpanded,\n\tCollapsed\n}\n\nexport const OUTPUT_EDITOR_HEIGHT_MAGIC = 1440;\n\ntype ILayoutInfoDelta0 = { [K in keyof IDiffElementLayoutInfo]?: number; };\ninterface ILayoutInfoDelta extends ILayoutInfoDelta0 {\n\trawOutputHeight?: number;\n\trecomputeOutput?: boolean;\n}\n\nexport type IDiffElementViewModelBase = DiffElementCellViewModelBase | DiffElementPlaceholderViewModel | NotebookDocumentMetadataViewModel;\n\nexport abstract class DiffElementViewModelBase extends Disposable {\n\tprotected _layoutInfoEmitter = this._register(new Emitter<CellDiffViewModelLayoutChangeEvent>());\n\tonDidLayoutChange = this._layoutInfoEmitter.event;\n\tabstract renderOutput: boolean;\n\tconstructor(\n\t\tpublic readonly mainDocumentTextModel: INotebookTextModel,\n\t\tpublic readonly editorEventDispatcher: NotebookDiffEditorEventDispatcher,\n\t\tpublic readonly initData: {\n\t\t\tmetadataStatusHeight: number;\n\t\t\toutputStatusHeight: number;\n\t\t\tfontInfo: FontInfo | undefined;\n\t\t}\n\t) {\n\t\tsuper();\n\n\t\tthis._register(this.editorEventDispatcher.onDidChangeLayout(e => this._layoutInfoEmitter.fire({ outerWidth: true })));\n\t}\n\n\tabstract layoutChange(): void;\n\tabstract getHeight(lineHeight: number): number;\n\tabstract get totalHeight(): number;\n}\n\nexport class DiffElementPlaceholderViewModel extends DiffElementViewModelBase {\n\treadonly type: 'placeholder' = 'placeholder';\n\tpublic hiddenCells: DiffElementCellViewModelBase[] = [];\n\tprotected _unfoldHiddenCells = this._register(new Emitter<void>());\n\tonUnfoldHiddenCells = this._unfoldHiddenCells.event;\n\n\tpublic renderOutput: boolean = false;\n\tconstructor(\n\t\tmainDocumentTextModel: INotebookTextModel,\n\t\teditorEventDispatcher: NotebookDiffEditorEventDispatcher,\n\t\tinitData: {\n\t\t\tmetadataStatusHeight: number;\n\t\t\toutputStatusHeight: number;\n\t\t\tfontInfo: FontInfo | undefined;\n\t\t}\n\t) {\n\t\tsuper(mainDocumentTextModel, editorEventDispatcher, initData);\n\n\t}\n\tget totalHeight() {\n\t\treturn 24 + (2 * DIFF_CELL_MARGIN);\n\t}\n\tgetHeight(_: number): number {\n\t\treturn this.totalHeight;\n\t}\n\toverride layoutChange(): void {\n\t\t//\n\t}\n\tshowHiddenCells() {\n\t\tthis._unfoldHiddenCells.fire();\n\t}\n}\n\n\nexport class NotebookDocumentMetadataViewModel extends DiffElementViewModelBase {\n\tpublic readonly originalMetadata: NotebookDocumentMetadataTextModel;\n\tpublic readonly modifiedMetadata: NotebookDocumentMetadataTextModel;\n\tpublic cellFoldingState: PropertyFoldingState;\n\tprotected _layoutInfo!: IDiffElementLayoutInfo;\n\tpublic renderOutput: boolean = false;\n\tset editorHeight(height: number) {\n\t\tthis._layout({ editorHeight: height });\n\t}\n\n\tget editorHeight() {\n\t\tthrow new Error('Use Cell.layoutInfo.editorHeight');\n\t}\n\n\tset editorMargin(margin: number) {\n\t\tthis._layout({ editorMargin: margin });\n\t}\n\n\tget editorMargin() {\n\t\tthrow new Error('Use Cell.layoutInfo.editorMargin');\n\t}\n\tget layoutInfo(): IDiffElementLayoutInfo {\n\t\treturn this._layoutInfo;\n\t}\n\n\tget totalHeight() {\n\t\treturn this.layoutInfo.totalHeight;\n\t}\n\n\tprivate _sourceEditorViewState: editorCommon.ICodeEditorViewState | editorCommon.IDiffEditorViewState | null = null;\n\tconstructor(\n\t\tpublic readonly originalDocumentTextModel: INotebookTextModel,\n\t\tpublic readonly modifiedDocumentTextModel: INotebookTextModel,\n\t\tpublic readonly type: 'unchangedMetadata' | 'modifiedMetadata',\n\t\teditorEventDispatcher: NotebookDiffEditorEventDispatcher,\n\t\tinitData: {\n\t\t\tmetadataStatusHeight: number;\n\t\t\toutputStatusHeight: number;\n\t\t\tfontInfo: FontInfo | undefined;\n\t\t},\n\t\tnotebookService: INotebookService,\n\t\tprivate readonly editorHeightCalculator: IDiffEditorHeightCalculatorService\n\t) {\n\t\tsuper(originalDocumentTextModel, editorEventDispatcher, initData);\n\n\t\tconst cellStatusHeight = PropertyHeaderHeight;\n\t\tthis._layoutInfo = {\n\t\t\twidth: 0,\n\t\t\teditorHeight: 0,\n\t\t\teditorMargin: 0,\n\t\t\tmetadataHeight: 0,\n\t\t\tcellStatusHeight,\n\t\t\tmetadataStatusHeight: 0,\n\t\t\trawOutputHeight: 0,\n\t\t\toutputTotalHeight: 0,\n\t\t\toutputStatusHeight: 0,\n\t\t\toutputMetadataHeight: 0,\n\t\t\tbodyMargin: 32,\n\t\t\ttotalHeight: 82 + cellStatusHeight + 0,\n\t\t\tlayoutState: CellLayoutState.Uninitialized\n\t\t};\n\n\t\tthis.cellFoldingState = type === 'modifiedMetadata' ? PropertyFoldingState.Expanded : PropertyFoldingState.Collapsed;\n\t\tthis.originalMetadata = this._register(new NotebookDocumentMetadataTextModel(originalDocumentTextModel));\n\t\tthis.modifiedMetadata = this._register(new NotebookDocumentMetadataTextModel(modifiedDocumentTextModel));\n\t}\n\n\tpublic async computeHeights() {\n\t\tif (this.type === 'unchangedMetadata') {\n\t\t\tthis.editorHeight = this.editorHeightCalculator.computeHeightFromLines(this.originalMetadata.textBuffer.getLineCount());\n\t\t} else {\n\t\t\tconst original = this.originalMetadata.uri;\n\t\t\tconst modified = this.modifiedMetadata.uri;\n\t\t\tthis.editorHeight = await this.editorHeightCalculator.diffAndComputeHeight(original, modified);\n\t\t}\n\t}\n\n\tlayoutChange() {\n\t\tthis._layout({ recomputeOutput: true });\n\t}\n\n\tprotected _layout(delta: ILayoutInfoDelta) {\n\t\tconst width = delta.width !== undefined ? delta.width : this._layoutInfo.width;\n\t\tconst editorHeight = delta.editorHeight !== undefined ? delta.editorHeight : this._layoutInfo.editorHeight;\n\t\tconst editorMargin = delta.editorMargin !== undefined ? delta.editorMargin : this._layoutInfo.editorMargin;\n\t\tconst cellStatusHeight = delta.cellStatusHeight !== undefined ? delta.cellStatusHeight : this._layoutInfo.cellStatusHeight;\n\t\tconst bodyMargin = delta.bodyMargin !== undefined ? delta.bodyMargin : this._layoutInfo.bodyMargin;\n\n\t\tconst totalHeight = editorHeight\n\t\t\t+ editorMargin\n\t\t\t+ cellStatusHeight\n\t\t\t+ bodyMargin;\n\n\t\tconst newLayout: IDiffElementLayoutInfo = {\n\t\t\twidth: width,\n\t\t\teditorHeight: editorHeight,\n\t\t\teditorMargin: editorMargin,\n\t\t\tmetadataHeight: 0,\n\t\t\tcellStatusHeight,\n\t\t\tmetadataStatusHeight: 0,\n\t\t\toutputTotalHeight: 0,\n\t\t\toutputStatusHeight: 0,\n\t\t\tbodyMargin: bodyMargin,\n\t\t\trawOutputHeight: 0,\n\t\t\toutputMetadataHeight: 0,\n\t\t\ttotalHeight: totalHeight,\n\t\t\tlayoutState: CellLayoutState.Measured\n\t\t};\n\n\t\tlet somethingChanged = false;\n\n\t\tconst changeEvent: CellDiffViewModelLayoutChangeEvent = {};\n\n\t\tif (newLayout.width !== this._layoutInfo.width) {\n\t\t\tchangeEvent.width = true;\n\t\t\tsomethingChanged = true;\n\t\t}\n\n\t\tif (newLayout.editorHeight !== this._layoutInfo.editorHeight) {\n\t\t\tchangeEvent.editorHeight = true;\n\t\t\tsomethingChanged = true;\n\t\t}\n\n\t\tif (newLayout.editorMargin !== this._layoutInfo.editorMargin) {\n\t\t\tchangeEvent.editorMargin = true;\n\t\t\tsomethingChanged = true;\n\t\t}\n\n\t\tif (newLayout.cellStatusHeight !== this._layoutInfo.cellStatusHeight) {\n\t\t\tchangeEvent.cellStatusHeight = true;\n\t\t\tsomethingChanged = true;\n\t\t}\n\n\t\tif (newLayout.bodyMargin !== this._layoutInfo.bodyMargin) {\n\t\t\tchangeEvent.bodyMargin = true;\n\t\t\tsomethingChanged = true;\n\t\t}\n\n\t\tif (newLayout.totalHeight !== this._layoutInfo.totalHeight) {\n\t\t\tchangeEvent.totalHeight = true;\n\t\t\tsomethingChanged = true;\n\t\t}\n\n\t\tif (somethingChanged) {\n\t\t\tthis._layoutInfo = newLayout;\n\t\t\tthis._fireLayoutChangeEvent(changeEvent);\n\t\t}\n\t}\n\n\tgetHeight(lineHeight: number) {\n\t\tif (this._layoutInfo.layoutState === CellLayoutState.Uninitialized) {\n\t\t\tconst editorHeight = this.cellFoldingState === PropertyFoldingState.Collapsed ? 0 : this.computeInputEditorHeight(lineHeight);\n\t\t\treturn this._computeTotalHeight(editorHeight);\n\t\t} else {\n\t\t\treturn this._layoutInfo.totalHeight;\n\t\t}\n\t}\n\n\tprivate _computeTotalHeight(editorHeight: number) {\n\t\tconst totalHeight = editorHeight\n\t\t\t+ this._layoutInfo.editorMargin\n\t\t\t+ this._layoutInfo.metadataHeight\n\t\t\t+ this._layoutInfo.cellStatusHeight\n\t\t\t+ this._layoutInfo.metadataStatusHeight\n\t\t\t+ this._layoutInfo.outputTotalHeight\n\t\t\t+ this._layoutInfo.outputStatusHeight\n\t\t\t+ this._layoutInfo.outputMetadataHeight\n\t\t\t+ this._layoutInfo.bodyMargin;\n\n\t\treturn totalHeight;\n\t}\n\n\tpublic computeInputEditorHeight(_lineHeight: number): number {\n\t\treturn this.editorHeightCalculator.computeHeightFromLines(Math.max(this.originalMetadata.textBuffer.getLineCount(), this.modifiedMetadata.textBuffer.getLineCount()));\n\t}\n\n\tprivate _fireLayoutChangeEvent(state: CellDiffViewModelLayoutChangeEvent) {\n\t\tthis._layoutInfoEmitter.fire(state);\n\t\tthis.editorEventDispatcher.emit([{ type: NotebookDiffViewEventType.CellLayoutChanged, source: this._layoutInfo }]);\n\t}\n\n\tgetComputedCellContainerWidth(layoutInfo: NotebookLayoutInfo, diffEditor: boolean, fullWidth: boolean) {\n\t\tif (fullWidth) {\n\t\t\treturn layoutInfo.width - 2 * DIFF_CELL_MARGIN + (diffEditor ? DiffEditorWidget.ENTIRE_DIFF_OVERVIEW_WIDTH : 0) - 2;\n\t\t}\n\n\t\treturn (layoutInfo.width - 2 * DIFF_CELL_MARGIN + (diffEditor ? DiffEditorWidget.ENTIRE_DIFF_OVERVIEW_WIDTH : 0)) / 2 - 18 - 2;\n\t}\n\n\tgetSourceEditorViewState(): editorCommon.ICodeEditorViewState | editorCommon.IDiffEditorViewState | null {\n\t\treturn this._sourceEditorViewState;\n\t}\n\n\tsaveSpirceEditorViewState(viewState: editorCommon.ICodeEditorViewState | editorCommon.IDiffEditorViewState | null) {\n\t\tthis._sourceEditorViewState = viewState;\n\t}\n}\n\n\nexport abstract class DiffElementCellViewModelBase extends DiffElementViewModelBase {\n\tpublic cellFoldingState: PropertyFoldingState;\n\tpublic metadataFoldingState: PropertyFoldingState;\n\tpublic outputFoldingState: PropertyFoldingState;\n\tprotected _stateChangeEmitter = this._register(new Emitter<{ renderOutput: boolean }>());\n\tonDidStateChange = this._stateChangeEmitter.event;\n\tprotected _layoutInfo!: IDiffElementLayoutInfo;\n\n\tpublic displayIconToHideUnmodifiedCells?: boolean;\n\tprivate _hideUnchangedCells = this._register(new Emitter<void>());\n\tpublic onHideUnchangedCells = this._hideUnchangedCells.event;\n\n\thideUnchangedCells() {\n\t\tthis._hideUnchangedCells.fire();\n\t}\n\tset rawOutputHeight(height: number) {\n\t\tthis._layout({ rawOutputHeight: Math.min(OUTPUT_EDITOR_HEIGHT_MAGIC, height) });\n\t}\n\n\tget rawOutputHeight() {\n\t\tthrow new Error('Use Cell.layoutInfo.rawOutputHeight');\n\t}\n\n\tset outputStatusHeight(height: number) {\n\t\tthis._layout({ outputStatusHeight: height });\n\t}\n\n\tget outputStatusHeight() {\n\t\tthrow new Error('Use Cell.layoutInfo.outputStatusHeight');\n\t}\n\n\tset outputMetadataHeight(height: number) {\n\t\tthis._layout({ outputMetadataHeight: height });\n\t}\n\n\tget outputMetadataHeight() {\n\t\tthrow new Error('Use Cell.layoutInfo.outputStatusHeight');\n\t}\n\n\tset editorHeight(height: number) {\n\t\tthis._layout({ editorHeight: height });\n\t}\n\n\tget editorHeight() {\n\t\tthrow new Error('Use Cell.layoutInfo.editorHeight');\n\t}\n\n\tset editorMargin(margin: number) {\n\t\tthis._layout({ editorMargin: margin });\n\t}\n\n\tget editorMargin() {\n\t\tthrow new Error('Use Cell.layoutInfo.editorMargin');\n\t}\n\n\tset metadataStatusHeight(height: number) {\n\t\tthis._layout({ metadataStatusHeight: height });\n\t}\n\n\tget metadataStatusHeight() {\n\t\tthrow new Error('Use Cell.layoutInfo.outputStatusHeight');\n\t}\n\n\tset metadataHeight(height: number) {\n\t\tthis._layout({ metadataHeight: height });\n\t}\n\n\tget metadataHeight() {\n\t\tthrow new Error('Use Cell.layoutInfo.metadataHeight');\n\t}\n\n\tprivate _renderOutput = true;\n\n\tset renderOutput(value: boolean) {\n\t\tthis._renderOutput = value;\n\t\tthis._layout({ recomputeOutput: true });\n\t\tthis._stateChangeEmitter.fire({ renderOutput: this._renderOutput });\n\t}\n\n\tget renderOutput() {\n\t\treturn this._renderOutput;\n\t}\n\n\tget layoutInfo(): IDiffElementLayoutInfo {\n\t\treturn this._layoutInfo;\n\t}\n\n\tget totalHeight() {\n\t\treturn this.layoutInfo.totalHeight;\n\t}\n\n\tprotected get ignoreOutputs() {\n\t\treturn this.configurationService.getValue<boolean>('notebook.diff.ignoreOutputs') || !!(this.mainDocumentTextModel?.transientOptions.transientOutputs);\n\t}\n\n\tprotected get ignoreMetadata() {\n\t\treturn this.configurationService.getValue<boolean>('notebook.diff.ignoreMetadata');\n\t}\n\n\tprivate _sourceEditorViewState: editorCommon.ICodeEditorViewState | editorCommon.IDiffEditorViewState | null = null;\n\tprivate _outputEditorViewState: editorCommon.ICodeEditorViewState | editorCommon.IDiffEditorViewState | null = null;\n\tprivate _metadataEditorViewState: editorCommon.ICodeEditorViewState | editorCommon.IDiffEditorViewState | null = null;\n\tpublic readonly original: DiffNestedCellViewModel | undefined;\n\n\tpublic readonly modified: DiffNestedCellViewModel | undefined;\n\tconstructor(\n\t\tmainDocumentTextModel: INotebookTextModel,\n\t\toriginal: NotebookCellTextModel | undefined,\n\t\tmodified: NotebookCellTextModel | undefined,\n\t\treadonly type: 'unchanged' | 'insert' | 'delete' | 'modified',\n\t\teditorEventDispatcher: NotebookDiffEditorEventDispatcher,\n\t\tinitData: {\n\t\t\tmetadataStatusHeight: number;\n\t\t\toutputStatusHeight: number;\n\t\t\tfontInfo: FontInfo | undefined;\n\t\t},\n\t\tnotebookService: INotebookService,\n\t\tpublic readonly index: number,\n\t\tprivate readonly configurationService: IConfigurationService,\n\t\tpublic readonly diffEditorHeightCalculator: IDiffEditorHeightCalculatorService\n\t) {\n\t\tsuper(mainDocumentTextModel, editorEventDispatcher, initData);\n\t\tthis.original = original ? this._register(new DiffNestedCellViewModel(original, notebookService)) : undefined;\n\t\tthis.modified = modified ? this._register(new DiffNestedCellViewModel(modified, notebookService)) : undefined;\n\t\tconst editorHeight = this._estimateEditorHeight(initData.fontInfo);\n\t\tconst cellStatusHeight = PropertyHeaderHeight;\n\t\tthis._layoutInfo = {\n\t\t\twidth: 0,\n\t\t\teditorHeight: editorHeight,\n\t\t\teditorMargin: 0,\n\t\t\tmetadataHeight: 0,\n\t\t\tcellStatusHeight,\n\t\t\tmetadataStatusHeight: this.ignoreMetadata ? 0 : PropertyHeaderHeight,\n\t\t\trawOutputHeight: 0,\n\t\t\toutputTotalHeight: 0,\n\t\t\toutputStatusHeight: this.ignoreOutputs ? 0 : PropertyHeaderHeight,\n\t\t\toutputMetadataHeight: 0,\n\t\t\tbodyMargin: 32,\n\t\t\ttotalHeight: 82 + cellStatusHeight + editorHeight,\n\t\t\tlayoutState: CellLayoutState.Uninitialized\n\t\t};\n\n\t\tthis.cellFoldingState = modified?.getTextBufferHash() !== original?.getTextBufferHash() ? PropertyFoldingState.Expanded : PropertyFoldingState.Collapsed;\n\t\tthis.metadataFoldingState = PropertyFoldingState.Collapsed;\n\t\tthis.outputFoldingState = PropertyFoldingState.Collapsed;\n\t}\n\n\tlayoutChange() {\n\t\tthis._layout({ recomputeOutput: true });\n\t}\n\n\tprivate _estimateEditorHeight(fontInfo: FontInfo | undefined) {\n\t\tconst lineHeight = fontInfo?.lineHeight ?? 17;\n\n\t\tswitch (this.type) {\n\t\t\tcase 'unchanged':\n\t\t\tcase 'insert':\n\t\t\t\t{\n\t\t\t\t\tconst lineCount = this.modified!.textModel.textBuffer.getLineCount();\n\t\t\t\t\tconst editorHeight = lineCount * lineHeight + getEditorPadding(lineCount).top + getEditorPadding(lineCount).bottom;\n\t\t\t\t\treturn editorHeight;\n\t\t\t\t}\n\t\t\tcase 'delete':\n\t\t\tcase 'modified':\n\t\t\t\t{\n\t\t\t\t\tconst lineCount = this.original!.textModel.textBuffer.getLineCount();\n\t\t\t\t\tconst editorHeight = lineCount * lineHeight + getEditorPadding(lineCount).top + getEditorPadding(lineCount).bottom;\n\t\t\t\t\treturn editorHeight;\n\t\t\t\t}\n\t\t}\n\t}\n\n\tprotected _layout(delta: ILayoutInfoDelta) {\n\t\tconst width = delta.width !== undefined ? delta.width : this._layoutInfo.width;\n\t\tconst editorHeight = delta.editorHeight !== undefined ? delta.editorHeight : this._layoutInfo.editorHeight;\n\t\tconst editorMargin = delta.editorMargin !== undefined ? delta.editorMargin : this._layoutInfo.editorMargin;\n\t\tconst metadataHeight = delta.metadataHeight !== undefined ? delta.metadataHeight : this._layoutInfo.metadataHeight;\n\t\tconst cellStatusHeight = delta.cellStatusHeight !== undefined ? delta.cellStatusHeight : this._layoutInfo.cellStatusHeight;\n\t\tconst metadataStatusHeight = delta.metadataStatusHeight !== undefined ? delta.metadataStatusHeight : this._layoutInfo.metadataStatusHeight;\n\t\tconst rawOutputHeight = delta.rawOutputHeight !== undefined ? delta.rawOutputHeight : this._layoutInfo.rawOutputHeight;\n\t\tconst outputStatusHeight = delta.outputStatusHeight !== undefined ? delta.outputStatusHeight : this._layoutInfo.outputStatusHeight;\n\t\tconst bodyMargin = delta.bodyMargin !== undefined ? delta.bodyMargin : this._layoutInfo.bodyMargin;\n\t\tconst outputMetadataHeight = delta.outputMetadataHeight !== undefined ? delta.outputMetadataHeight : this._layoutInfo.outputMetadataHeight;\n\t\tconst outputHeight = this.ignoreOutputs ? 0 : (delta.recomputeOutput || delta.rawOutputHeight !== undefined || delta.outputMetadataHeight !== undefined) ? this._getOutputTotalHeight(rawOutputHeight, outputMetadataHeight) : this._layoutInfo.outputTotalHeight;\n\n\t\tconst totalHeight = editorHeight\n\t\t\t+ editorMargin\n\t\t\t+ cellStatusHeight\n\t\t\t+ metadataHeight\n\t\t\t+ metadataStatusHeight\n\t\t\t+ outputHeight\n\t\t\t+ outputStatusHeight\n\t\t\t+ bodyMargin;\n\n\t\tconst newLayout: IDiffElementLayoutInfo = {\n\t\t\twidth: width,\n\t\t\teditorHeight: editorHeight,\n\t\t\teditorMargin: editorMargin,\n\t\t\tmetadataHeight: metadataHeight,\n\t\t\tcellStatusHeight,\n\t\t\tmetadataStatusHeight: metadataStatusHeight,\n\t\t\toutputTotalHeight: outputHeight,\n\t\t\toutputStatusHeight: outputStatusHeight,\n\t\t\tbodyMargin: bodyMargin,\n\t\t\trawOutputHeight: rawOutputHeight,\n\t\t\toutputMetadataHeight: outputMetadataHeight,\n\t\t\ttotalHeight: totalHeight,\n\t\t\tlayoutState: CellLayoutState.Measured\n\t\t};\n\n\t\tlet somethingChanged = false;\n\n\t\tconst changeEvent: CellDiffViewModelLayoutChangeEvent = {};\n\n\t\tif (newLayout.width !== this._layoutInfo.width) {\n\t\t\tchangeEvent.width = true;\n\t\t\tsomethingChanged = true;\n\t\t}\n\n\t\tif (newLayout.editorHeight !== this._layoutInfo.editorHeight) {\n\t\t\tchangeEvent.editorHeight = true;\n\t\t\tsomethingChanged = true;\n\t\t}\n\n\t\tif (newLayout.editorMargin !== this._layoutInfo.editorMargin) {\n\t\t\tchangeEvent.editorMargin = true;\n\t\t\tsomethingChanged = true;\n\t\t}\n\n\t\tif (newLayout.metadataHeight !== this._layoutInfo.metadataHeight) {\n\t\t\tchangeEvent.metadataHeight = true;\n\t\t\tsomethingChanged = true;\n\t\t}\n\n\t\tif (newLayout.cellStatusHeight !== this._layoutInfo.cellStatusHeight) {\n\t\t\tchangeEvent.cellStatusHeight = true;\n\t\t\tsomethingChanged = true;\n\t\t}\n\n\t\tif (newLayout.metadataStatusHeight !== this._layoutInfo.metadataStatusHeight) {\n\t\t\tchangeEvent.metadataStatusHeight = true;\n\t\t\tsomethingChanged = true;\n\t\t}\n\n\t\tif (newLayout.outputTotalHeight !== this._layoutInfo.outputTotalHeight) {\n\t\t\tchangeEvent.outputTotalHeight = true;\n\t\t\tsomethingChanged = true;\n\t\t}\n\n\t\tif (newLayout.outputStatusHeight !== this._layoutInfo.outputStatusHeight) {\n\t\t\tchangeEvent.outputStatusHeight = true;\n\t\t\tsomethingChanged = true;\n\t\t}\n\n\t\tif (newLayout.bodyMargin !== this._layoutInfo.bodyMargin) {\n\t\t\tchangeEvent.bodyMargin = true;\n\t\t\tsomethingChanged = true;\n\t\t}\n\n\t\tif (newLayout.outputMetadataHeight !== this._layoutInfo.outputMetadataHeight) {\n\t\t\tchangeEvent.outputMetadataHeight = true;\n\t\t\tsomethingChanged = true;\n\t\t}\n\n\t\tif (newLayout.totalHeight !== this._layoutInfo.totalHeight) {\n\t\t\tchangeEvent.totalHeight = true;\n\t\t\tsomethingChanged = true;\n\t\t}\n\n\t\tif (somethingChanged) {\n\t\t\tthis._layoutInfo = newLayout;\n\t\t\tthis._fireLayoutChangeEvent(changeEvent);\n\t\t}\n\t}\n\n\tgetHeight(lineHeight: number) {\n\t\tif (this._layoutInfo.layoutState === CellLayoutState.Uninitialized) {\n\t\t\tconst editorHeight = this.cellFoldingState === PropertyFoldingState.Collapsed ? 0 : this.computeInputEditorHeight(lineHeight);\n\t\t\treturn this._computeTotalHeight(editorHeight);\n\t\t} else {\n\t\t\treturn this._layoutInfo.totalHeight;\n\t\t}\n\t}\n\n\tprivate _computeTotalHeight(editorHeight: number) {\n\t\tconst totalHeight = editorHeight\n\t\t\t+ this._layoutInfo.editorMargin\n\t\t\t+ this._layoutInfo.metadataHeight\n\t\t\t+ this._layoutInfo.cellStatusHeight\n\t\t\t+ this._layoutInfo.metadataStatusHeight\n\t\t\t+ this._layoutInfo.outputTotalHeight\n\t\t\t+ this._layoutInfo.outputStatusHeight\n\t\t\t+ this._layoutInfo.outputMetadataHeight\n\t\t\t+ this._layoutInfo.bodyMargin;\n\n\t\treturn totalHeight;\n\t}\n\n\tpublic computeInputEditorHeight(lineHeight: number): number {\n\t\tconst lineCount = Math.max(this.original?.textModel.textBuffer.getLineCount() ?? 1, this.modified?.textModel.textBuffer.getLineCount() ?? 1);\n\t\treturn this.diffEditorHeightCalculator.computeHeightFromLines(lineCount);\n\t}\n\n\tprivate _getOutputTotalHeight(rawOutputHeight: number, metadataHeight: number) {\n\t\tif (this.outputFoldingState === PropertyFoldingState.Collapsed) {\n\t\t\treturn 0;\n\t\t}\n\n\t\tif (this.renderOutput) {\n\t\t\tif (this.isOutputEmpty()) {\n\t\t\t\t// single line;\n\t\t\t\treturn 24;\n\t\t\t}\n\t\t\treturn this.getRichOutputTotalHeight() + metadataHeight;\n\t\t} else {\n\t\t\treturn rawOutputHeight;\n\t\t}\n\t}\n\n\tprivate _fireLayoutChangeEvent(state: CellDiffViewModelLayoutChangeEvent) {\n\t\tthis._layoutInfoEmitter.fire(state);\n\t\tthis.editorEventDispatcher.emit([{ type: NotebookDiffViewEventType.CellLayoutChanged, source: this._layoutInfo }]);\n\t}\n\n\tabstract checkIfInputModified(): false | { reason: string | undefined };\n\tabstract checkIfOutputsModified(): false | { reason: string | undefined };\n\tabstract checkMetadataIfModified(): false | { reason: string | undefined };\n\tabstract isOutputEmpty(): boolean;\n\tabstract getRichOutputTotalHeight(): number;\n\tabstract getCellByUri(cellUri: URI): IGenericCellViewModel;\n\tabstract getOutputOffsetInCell(diffSide: DiffSide, index: number): number;\n\tabstract getOutputOffsetInContainer(diffSide: DiffSide, index: number): number;\n\tabstract updateOutputHeight(diffSide: DiffSide, index: number, height: number): void;\n\tabstract getNestedCellViewModel(diffSide: DiffSide): DiffNestedCellViewModel;\n\n\tgetComputedCellContainerWidth(layoutInfo: NotebookLayoutInfo, diffEditor: boolean, fullWidth: boolean) {\n\t\tif (fullWidth) {\n\t\t\treturn layoutInfo.width - 2 * DIFF_CELL_MARGIN + (diffEditor ? DiffEditorWidget.ENTIRE_DIFF_OVERVIEW_WIDTH : 0) - 2;\n\t\t}\n\n\t\treturn (layoutInfo.width - 2 * DIFF_CELL_MARGIN + (diffEditor ? DiffEditorWidget.ENTIRE_DIFF_OVERVIEW_WIDTH : 0)) / 2 - 18 - 2;\n\t}\n\n\tgetOutputEditorViewState(): editorCommon.ICodeEditorViewState | editorCommon.IDiffEditorViewState | null {\n\t\treturn this._outputEditorViewState;\n\t}\n\n\tsaveOutputEditorViewState(viewState: editorCommon.ICodeEditorViewState | editorCommon.IDiffEditorViewState | null) {\n\t\tthis._outputEditorViewState = viewState;\n\t}\n\n\tgetMetadataEditorViewState(): editorCommon.ICodeEditorViewState | editorCommon.IDiffEditorViewState | null {\n\t\treturn this._metadataEditorViewState;\n\t}\n\n\tsaveMetadataEditorViewState(viewState: editorCommon.ICodeEditorViewState | editorCommon.IDiffEditorViewState | null) {\n\t\tthis._metadataEditorViewState = viewState;\n\t}\n\n\tgetSourceEditorViewState(): editorCommon.ICodeEditorViewState | editorCommon.IDiffEditorViewState | null {\n\t\treturn this._sourceEditorViewState;\n\t}\n\n\tsaveSpirceEditorViewState(viewState: editorCommon.ICodeEditorViewState | editorCommon.IDiffEditorViewState | null) {\n\t\tthis._sourceEditorViewState = viewState;\n\t}\n}\n\nexport class SideBySideDiffElementViewModel extends DiffElementCellViewModelBase {\n\tget originalDocument() {\n\t\treturn this.otherDocumentTextModel;\n\t}\n\n\tget modifiedDocument() {\n\t\treturn this.mainDocumentTextModel;\n\t}\n\n\tdeclare readonly original: DiffNestedCellViewModel;\n\tdeclare readonly modified: DiffNestedCellViewModel;\n\toverride readonly type: 'unchanged' | 'modified';\n\n\t/**\n\t * The height of the editor when the unchanged lines are collapsed.\n\t */\n\tprivate editorHeightWithUnchangedLinesCollapsed?: number;\n\tconstructor(\n\t\tmainDocumentTextModel: NotebookTextModel,\n\t\treadonly otherDocumentTextModel: NotebookTextModel,\n\t\toriginal: NotebookCellTextModel,\n\t\tmodified: NotebookCellTextModel,\n\t\ttype: 'unchanged' | 'modified',\n\t\teditorEventDispatcher: NotebookDiffEditorEventDispatcher,\n\t\tinitData: {\n\t\t\tmetadataStatusHeight: number;\n\t\t\toutputStatusHeight: number;\n\t\t\tfontInfo: FontInfo | undefined;\n\t\t},\n\t\tnotebookService: INotebookService,\n\t\tconfigurationService: IConfigurationService,\n\t\tindex: number,\n\t\tdiffEditorHeightCalculator: IDiffEditorHeightCalculatorService\n\t) {\n\t\tsuper(\n\t\t\tmainDocumentTextModel,\n\t\t\toriginal,\n\t\t\tmodified,\n\t\t\ttype,\n\t\t\teditorEventDispatcher,\n\t\t\tinitData,\n\t\t\tnotebookService,\n\t\t\tindex,\n\t\t\tconfigurationService,\n\t\t\tdiffEditorHeightCalculator);\n\n\t\tthis.type = type;\n\n\t\tthis.cellFoldingState = this.modified.textModel.getValue() !== this.original.textModel.getValue() ? PropertyFoldingState.Expanded : PropertyFoldingState.Collapsed;\n\t\tthis.metadataFoldingState = PropertyFoldingState.Collapsed;\n\t\tthis.outputFoldingState = PropertyFoldingState.Collapsed;\n\n\t\tif (this.checkMetadataIfModified()) {\n\t\t\tthis.metadataFoldingState = PropertyFoldingState.Expanded;\n\t\t}\n\n\t\tif (this.checkIfOutputsModified()) {\n\t\t\tthis.outputFoldingState = PropertyFoldingState.Expanded;\n\t\t}\n\n\t\tthis._register(this.original.onDidChangeOutputLayout(() => {\n\t\t\tthis._layout({ recomputeOutput: true });\n\t\t}));\n\n\t\tthis._register(this.modified.onDidChangeOutputLayout(() => {\n\t\t\tthis._layout({ recomputeOutput: true });\n\t\t}));\n\n\t\tthis._register(this.modified.textModel.onDidChangeContent(() => {\n\t\t\tif (mainDocumentTextModel.transientOptions.cellContentMetadata) {\n\t\t\t\tconst cellMetadataKeys = [...Object.keys(mainDocumentTextModel.transientOptions.cellContentMetadata)];\n\t\t\t\tconst modifiedMedataRaw = Object.assign({}, this.modified.metadata);\n\t\t\t\tconst originalCellMetadata = this.original.metadata;\n\t\t\t\tfor (const key of cellMetadataKeys) {\n\t\t\t\t\tif (Object.hasOwn(originalCellMetadata, key)) {\n\t\t\t\t\t\tmodifiedMedataRaw[key] = originalCellMetadata[key];\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tthis.modified.textModel.metadata = modifiedMedataRaw;\n\t\t\t}\n\t\t}));\n\t}\n\n\toverride checkIfInputModified(): false | { reason: string | undefined } {\n\t\tif (this.original.textModel.getTextBufferHash() === this.modified.textModel.getTextBufferHash()) {\n\t\t\treturn false;\n\t\t}\n\t\treturn {\n\t\t\treason: 'Cell content has changed',\n\t\t};\n\t}\n\tcheckIfOutputsModified() {\n\t\tif (this.mainDocumentTextModel.transientOptions.transientOutputs || this.ignoreOutputs) {\n\t\t\treturn false;\n\t\t}\n\n\t\tconst ret = outputsEqual(this.original?.outputs ?? [], this.modified?.outputs ?? []);\n\n\t\tif (ret === OutputComparison.Unchanged) {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn {\n\t\t\treason: ret === OutputComparison.Metadata ? 'Output metadata has changed' : undefined,\n\t\t\tkind: ret\n\t\t};\n\t}\n\n\tcheckMetadataIfModified() {\n\t\tif (this.ignoreMetadata) {\n\t\t\treturn false;\n\t\t}\n\t\tconst modified = hash(getFormattedMetadataJSON(this.mainDocumentTextModel.transientOptions.transientCellMetadata, this.original?.metadata || {}, this.original?.language)) !== hash(getFormattedMetadataJSON(this.mainDocumentTextModel.transientOptions.transientCellMetadata, this.modified?.metadata ?? {}, this.modified?.language));\n\t\tif (modified) {\n\t\t\treturn { reason: undefined };\n\t\t} else {\n\t\t\treturn false;\n\t\t}\n\t}\n\n\tupdateOutputHeight(diffSide: DiffSide, index: number, height: number) {\n\t\tif (diffSide === DiffSide.Original) {\n\t\t\tthis.original.updateOutputHeight(index, height);\n\t\t} else {\n\t\t\tthis.modified.updateOutputHeight(index, height);\n\t\t}\n\t}\n\n\tgetOutputOffsetInContainer(diffSide: DiffSide, index: number) {\n\t\tif (diffSide === DiffSide.Original) {\n\t\t\treturn this.original.getOutputOffset(index);\n\t\t} else {\n\t\t\treturn this.modified.getOutputOffset(index);\n\t\t}\n\t}\n\n\tgetOutputOffsetInCell(diffSide: DiffSide, index: number) {\n\t\tconst offsetInOutputsContainer = this.getOutputOffsetInContainer(diffSide, index);\n\n\t\treturn this._layoutInfo.editorHeight\n\t\t\t+ this._layoutInfo.editorMargin\n\t\t\t+ this._layoutInfo.metadataHeight\n\t\t\t+ this._layoutInfo.cellStatusHeight\n\t\t\t+ this._layoutInfo.metadataStatusHeight\n\t\t\t+ this._layoutInfo.outputStatusHeight\n\t\t\t+ this._layoutInfo.bodyMargin / 2\n\t\t\t+ offsetInOutputsContainer;\n\t}\n\n\tisOutputEmpty() {\n\t\tif (this.mainDocumentTextModel.transientOptions.transientOutputs) {\n\t\t\treturn true;\n\t\t}\n\n\t\tif (this.checkIfOutputsModified()) {\n\t\t\treturn false;\n\t\t}\n\n\t\t// outputs are not changed\n\n\t\treturn (this.original?.outputs || []).length === 0;\n\t}\n\n\tgetRichOutputTotalHeight() {\n\t\treturn Math.max(this.original.getOutputTotalHeight(), this.modified.getOutputTotalHeight());\n\t}\n\n\tgetNestedCellViewModel(diffSide: DiffSide): DiffNestedCellViewModel {\n\t\treturn diffSide === DiffSide.Original ? this.original : this.modified;\n\t}\n\n\tgetCellByUri(cellUri: URI): IGenericCellViewModel {\n\t\tif (cellUri.toString() === this.original.uri.toString()) {\n\t\t\treturn this.original;\n\t\t} else {\n\t\t\treturn this.modified;\n\t\t}\n\t}\n\n\tpublic override computeInputEditorHeight(lineHeight: number): number {\n\t\tif (this.type === 'modified' &&\n\t\t\ttypeof this.editorHeightWithUnchangedLinesCollapsed === 'number' &&\n\t\t\tthis.checkIfInputModified()) {\n\t\t\treturn this.editorHeightWithUnchangedLinesCollapsed;\n\t\t}\n\n\t\treturn super.computeInputEditorHeight(lineHeight);\n\t}\n\n\tprivate async computeModifiedInputEditorHeight() {\n\t\tif (this.checkIfInputModified()) {\n\t\t\tthis.editorHeightWithUnchangedLinesCollapsed = this._layoutInfo.editorHeight = await this.diffEditorHeightCalculator.diffAndComputeHeight(this.original.uri, this.modified.uri);\n\t\t}\n\t}\n\n\tprivate async computeModifiedMetadataEditorHeight() {\n\t\tif (this.checkMetadataIfModified()) {\n\t\t\tconst originalMetadataUri = CellUri.generateCellPropertyUri(this.originalDocument.uri, this.original.handle, Schemas.vscodeNotebookCellMetadata);\n\t\t\tconst modifiedMetadataUri = CellUri.generateCellPropertyUri(this.modifiedDocument.uri, this.modified.handle, Schemas.vscodeNotebookCellMetadata);\n\t\t\tthis._layoutInfo.metadataHeight = await this.diffEditorHeightCalculator.diffAndComputeHeight(originalMetadataUri, modifiedMetadataUri);\n\t\t}\n\t}\n\n\tpublic async computeEditorHeights() {\n\t\tif (this.type === 'unchanged') {\n\t\t\treturn;\n\t\t}\n\n\t\tawait Promise.all([this.computeModifiedInputEditorHeight(), this.computeModifiedMetadataEditorHeight()]);\n\t}\n\n}\n\nexport class SingleSideDiffElementViewModel extends DiffElementCellViewModelBase {\n\tget cellViewModel() {\n\t\treturn this.type === 'insert' ? this.modified! : this.original!;\n\t}\n\n\tget originalDocument() {\n\t\tif (this.type === 'insert') {\n\t\t\treturn this.otherDocumentTextModel;\n\t\t} else {\n\t\t\treturn this.mainDocumentTextModel;\n\t\t}\n\t}\n\n\tget modifiedDocument() {\n\t\tif (this.type === 'insert') {\n\t\t\treturn this.mainDocumentTextModel;\n\t\t} else {\n\t\t\treturn this.otherDocumentTextModel;\n\t\t}\n\t}\n\n\toverride readonly type: 'insert' | 'delete';\n\n\tconstructor(\n\t\tmainDocumentTextModel: NotebookTextModel,\n\t\treadonly otherDocumentTextModel: NotebookTextModel,\n\t\toriginal: NotebookCellTextModel | undefined,\n\t\tmodified: NotebookCellTextModel | undefined,\n\t\ttype: 'insert' | 'delete',\n\t\teditorEventDispatcher: NotebookDiffEditorEventDispatcher,\n\t\tinitData: {\n\t\t\tmetadataStatusHeight: number;\n\t\t\toutputStatusHeight: number;\n\t\t\tfontInfo: FontInfo | undefined;\n\t\t},\n\t\tnotebookService: INotebookService,\n\t\tconfigurationService: IConfigurationService,\n\t\tdiffEditorHeightCalculator: IDiffEditorHeightCalculatorService,\n\t\tindex: number\n\t) {\n\t\tsuper(mainDocumentTextModel, original, modified, type, editorEventDispatcher, initData, notebookService, index, configurationService, diffEditorHeightCalculator);\n\t\tthis.type = type;\n\n\t\tthis._register(this.cellViewModel.onDidChangeOutputLayout(() => {\n\t\t\tthis._layout({ recomputeOutput: true });\n\t\t}));\n\t}\n\n\toverride checkIfInputModified(): false | { reason: string | undefined } {\n\t\treturn {\n\t\t\treason: 'Cell content has changed',\n\t\t};\n\t}\n\n\tgetNestedCellViewModel(diffSide: DiffSide): DiffNestedCellViewModel {\n\t\treturn this.type === 'insert' ? this.modified! : this.original!;\n\t}\n\n\n\tcheckIfOutputsModified(): false | { reason: string | undefined } {\n\t\treturn false;\n\t}\n\n\tcheckMetadataIfModified(): false | { reason: string | undefined } {\n\t\treturn false;\n\t}\n\n\tupdateOutputHeight(diffSide: DiffSide, index: number, height: number) {\n\t\tthis.cellViewModel?.updateOutputHeight(index, height);\n\t}\n\n\tgetOutputOffsetInContainer(diffSide: DiffSide, index: number) {\n\t\treturn this.cellViewModel.getOutputOffset(index);\n\t}\n\n\tgetOutputOffsetInCell(diffSide: DiffSide, index: number) {\n\t\tconst offsetInOutputsContainer = this.cellViewModel.getOutputOffset(index);\n\n\t\treturn this._layoutInfo.editorHeight\n\t\t\t+ this._layoutInfo.editorMargin\n\t\t\t+ this._layoutInfo.metadataHeight\n\t\t\t+ this._layoutInfo.cellStatusHeight\n\t\t\t+ this._layoutInfo.metadataStatusHeight\n\t\t\t+ this._layoutInfo.outputStatusHeight\n\t\t\t+ this._layoutInfo.bodyMargin / 2\n\t\t\t+ offsetInOutputsContainer;\n\t}\n\n\tisOutputEmpty() {\n\t\tif (this.mainDocumentTextModel.transientOptions.transientOutputs) {\n\t\t\treturn true;\n\t\t}\n\n\t\t// outputs are not changed\n\n\t\treturn (this.original?.outputs || this.modified?.outputs || []).length === 0;\n\t}\n\n\tgetRichOutputTotalHeight() {\n\t\treturn this.cellViewModel?.getOutputTotalHeight() ?? 0;\n\t}\n\n\tgetCellByUri(cellUri: URI): IGenericCellViewModel {\n\t\treturn this.cellViewModel;\n\t}\n}\n\nexport const enum OutputComparison {\n\tUnchanged = 0,\n\tMetadata = 1,\n\tOther = 2\n}\n\nexport function outputEqual(a: ICellOutput, b: ICellOutput): OutputComparison {\n\tif (hash(a.metadata) === hash(b.metadata)) {\n\t\treturn OutputComparison.Other;\n\t}\n\n\t// metadata not equal\n\tfor (let j = 0; j < a.outputs.length; j++) {\n\t\tconst aOutputItem = a.outputs[j];\n\t\tconst bOutputItem = b.outputs[j];\n\n\t\tif (aOutputItem.mime !== bOutputItem.mime) {\n\t\t\treturn OutputComparison.Other;\n\t\t}\n\n\t\tif (aOutputItem.data.buffer.length !== bOutputItem.data.buffer.length) {\n\t\t\treturn OutputComparison.Other;\n\t\t}\n\n\t\tfor (let k = 0; k < aOutputItem.data.buffer.length; k++) {\n\t\t\tif (aOutputItem.data.buffer[k] !== bOutputItem.data.buffer[k]) {\n\t\t\t\treturn OutputComparison.Other;\n\t\t\t}\n\t\t}\n\t}\n\n\treturn OutputComparison.Metadata;\n}\n\nfunction outputsEqual(original: ICellOutput[], modified: ICellOutput[]) {\n\tif (original.length !== modified.length) {\n\t\treturn OutputComparison.Other;\n\t}\n\n\tconst len = original.length;\n\tfor (let i = 0; i < len; i++) {\n\t\tconst a = original[i];\n\t\tconst b = modified[i];\n\n\t\tif (hash(a.metadata) !== hash(b.metadata)) {\n\t\t\treturn OutputComparison.Metadata;\n\t\t}\n\n\t\tif (a.outputs.length !== b.outputs.length) {\n\t\t\treturn OutputComparison.Other;\n\t\t}\n\n\t\tfor (let j = 0; j < a.outputs.length; j++) {\n\t\t\tconst aOutputItem = a.outputs[j];\n\t\t\tconst bOutputItem = b.outputs[j];\n\n\t\t\tif (aOutputItem.mime !== bOutputItem.mime) {\n\t\t\t\treturn OutputComparison.Other;\n\t\t\t}\n\n\t\t\tif (aOutputItem.data.buffer.length !== bOutputItem.data.buffer.length) {\n\t\t\t\treturn OutputComparison.Other;\n\t\t\t}\n\n\t\t\tfor (let k = 0; k < aOutputItem.data.buffer.length; k++) {\n\t\t\t\tif (aOutputItem.data.buffer[k] !== bOutputItem.data.buffer[k]) {\n\t\t\t\t\treturn OutputComparison.Other;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\treturn OutputComparison.Unchanged;\n}\n\nexport function getStreamOutputData(outputs: IOutputItemDto[]) {\n\tif (!outputs.length) {\n\t\treturn null;\n\t}\n\n\tconst first = outputs[0];\n\tconst mime = first.mime;\n\tconst sameStream = !outputs.find(op => op.mime !== mime);\n\n\tif (sameStream) {\n\t\treturn outputs.map(opit => opit.data.toString()).join('');\n\t} else {\n\t\treturn null;\n\t}\n}\n\nexport function getFormattedOutputJSON(outputs: IOutputDto[]) {\n\tif (outputs.length === 1) {\n\t\tconst streamOutputData = getStreamOutputData(outputs[0].outputs);\n\t\tif (streamOutputData) {\n\t\t\treturn streamOutputData;\n\t\t}\n\t}\n\n\treturn JSON.stringify(outputs.map(output => {\n\t\treturn ({\n\t\t\tmetadata: output.metadata,\n\t\t\toutputItems: output.outputs.map(opit => ({\n\t\t\t\tmimeType: opit.mime,\n\t\t\t\tdata: opit.data.toString()\n\t\t\t}))\n\t\t});\n\t}), undefined, '\\t');\n}\n"]}