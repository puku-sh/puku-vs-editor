{"version":3,"sources":["vs/workbench/contrib/notebook/browser/controller/foldingController.ts"],"names":[],"mappings":"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","file":"foldingController.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Disposable, DisposableStore } from '../../../../../base/common/lifecycle.js';\nimport { NOTEBOOK_EDITOR_FOCUSED, NOTEBOOK_IS_ACTIVE_EDITOR } from '../../common/notebookContextKeys.js';\nimport { INotebookEditor, INotebookEditorMouseEvent, INotebookEditorContribution, getNotebookEditorFromEditorPane, CellFoldingState } from '../notebookBrowser.js';\nimport { FoldingModel } from '../viewModel/foldingModel.js'; import { CellKind } from '../../common/notebookCommon.js';\nimport { ICellRange } from '../../common/notebookRange.js';\nimport { registerNotebookContribution } from '../notebookEditorExtensions.js';\nimport { registerAction2, Action2 } from '../../../../../platform/actions/common/actions.js';\nimport { ContextKeyExpr } from '../../../../../platform/contextkey/common/contextkey.js';\nimport { InputFocusedContextKey } from '../../../../../platform/contextkey/common/contextkeys.js';\nimport { KeyCode, KeyMod } from '../../../../../base/common/keyCodes.js';\nimport { KeybindingWeight } from '../../../../../platform/keybinding/common/keybindingsRegistry.js';\nimport { ServicesAccessor } from '../../../../../platform/instantiation/common/instantiation.js';\nimport { IEditorService } from '../../../../services/editor/common/editorService.js';\nimport { NOTEBOOK_ACTIONS_CATEGORY } from './coreActions.js';\nimport { localize, localize2 } from '../../../../../nls.js';\nimport { FoldingRegion } from '../../../../../editor/contrib/folding/browser/foldingRanges.js';\nimport { ICommandMetadata } from '../../../../../platform/commands/common/commands.js';\nimport { NotebookViewModel } from '../viewModel/notebookViewModelImpl.js';\n\nexport class FoldingController extends Disposable implements INotebookEditorContribution {\n\tstatic id: string = 'workbench.notebook.foldingController';\n\n\tprivate _foldingModel: FoldingModel | null = null;\n\tprivate readonly _localStore = this._register(new DisposableStore());\n\n\tconstructor(private readonly _notebookEditor: INotebookEditor) {\n\t\tsuper();\n\n\t\tthis._register(this._notebookEditor.onMouseUp(e => { this.onMouseUp(e); }));\n\n\t\tthis._register(this._notebookEditor.onDidChangeModel(() => {\n\t\t\tthis._localStore.clear();\n\n\t\t\tif (!this._notebookEditor.hasModel()) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis._localStore.add(this._notebookEditor.onDidChangeCellState(e => {\n\t\t\t\tif (e.source.editStateChanged && e.cell.cellKind === CellKind.Markup) {\n\t\t\t\t\tthis._foldingModel?.recompute();\n\t\t\t\t}\n\t\t\t}));\n\n\t\t\tthis._foldingModel = new FoldingModel();\n\t\t\tthis._localStore.add(this._foldingModel);\n\t\t\tthis._foldingModel.attachViewModel(this._notebookEditor.getViewModel());\n\n\t\t\tthis._localStore.add(this._foldingModel.onDidFoldingRegionChanged(() => {\n\t\t\t\tthis._updateEditorFoldingRanges();\n\t\t\t}));\n\t\t}));\n\t}\n\n\tsaveViewState(): ICellRange[] {\n\t\treturn this._foldingModel?.getMemento() || [];\n\t}\n\n\trestoreViewState(state: ICellRange[] | undefined) {\n\t\tthis._foldingModel?.applyMemento(state || []);\n\t\tthis._updateEditorFoldingRanges();\n\t}\n\n\tsetFoldingStateDown(index: number, state: CellFoldingState, levels: number) {\n\t\tconst doCollapse = state === CellFoldingState.Collapsed;\n\t\tconst region = this._foldingModel!.getRegionAtLine(index + 1);\n\t\tconst regions: FoldingRegion[] = [];\n\t\tif (region) {\n\t\t\tif (region.isCollapsed !== doCollapse) {\n\t\t\t\tregions.push(region);\n\t\t\t}\n\t\t\tif (levels > 1) {\n\t\t\t\tconst regionsInside = this._foldingModel!.getRegionsInside(region, (r, level: number) => r.isCollapsed !== doCollapse && level < levels);\n\t\t\t\tregions.push(...regionsInside);\n\t\t\t}\n\t\t}\n\n\t\tregions.forEach(r => this._foldingModel!.setCollapsed(r.regionIndex, state === CellFoldingState.Collapsed));\n\t\tthis._updateEditorFoldingRanges();\n\t}\n\n\tsetFoldingStateUp(index: number, state: CellFoldingState, levels: number) {\n\t\tif (!this._foldingModel) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst regions = this._foldingModel.getAllRegionsAtLine(index + 1, (region, level) => region.isCollapsed !== (state === CellFoldingState.Collapsed) && level <= levels);\n\t\tregions.forEach(r => this._foldingModel!.setCollapsed(r.regionIndex, state === CellFoldingState.Collapsed));\n\t\tthis._updateEditorFoldingRanges();\n\t}\n\n\tprivate _updateEditorFoldingRanges() {\n\t\tif (!this._foldingModel) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this._notebookEditor.hasModel()) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst vm = this._notebookEditor.getViewModel() as NotebookViewModel;\n\n\t\tvm.updateFoldingRanges(this._foldingModel.regions);\n\t\tconst hiddenRanges = vm.getHiddenRanges();\n\t\tthis._notebookEditor.setHiddenAreas(hiddenRanges);\n\t}\n\n\tonMouseUp(e: INotebookEditorMouseEvent) {\n\t\tif (!e.event.target) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this._notebookEditor.hasModel()) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst viewModel = this._notebookEditor.getViewModel() as NotebookViewModel;\n\t\tconst target = e.event.target as HTMLElement;\n\n\t\tif (target.classList.contains('codicon-notebook-collapsed') || target.classList.contains('codicon-notebook-expanded')) {\n\t\t\tconst parent = target.parentElement as HTMLElement;\n\n\t\t\tif (!parent.classList.contains('notebook-folding-indicator')) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// folding icon\n\n\t\t\tconst cellViewModel = e.target;\n\t\t\tconst modelIndex = viewModel.getCellIndex(cellViewModel);\n\t\t\tconst state = viewModel.getFoldingState(modelIndex);\n\n\t\t\tif (state === CellFoldingState.None) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.setFoldingStateUp(modelIndex, state === CellFoldingState.Collapsed ? CellFoldingState.Expanded : CellFoldingState.Collapsed, 1);\n\t\t\tthis._notebookEditor.focusElement(cellViewModel);\n\t\t}\n\n\t\treturn;\n\t}\n\n\trecompute() {\n\t\tthis._foldingModel?.recompute();\n\t}\n}\n\nregisterNotebookContribution(FoldingController.id, FoldingController);\n\n\nconst NOTEBOOK_FOLD_COMMAND_LABEL = localize('fold.cell', \"Fold Cell\");\nconst NOTEBOOK_UNFOLD_COMMAND_LABEL = localize2('unfold.cell', \"Unfold Cell\");\n\nconst FOLDING_COMMAND_ARGS: Pick<ICommandMetadata, 'args'> = {\n\targs: [{\n\t\tisOptional: true,\n\t\tname: 'index',\n\t\tdescription: 'The cell index',\n\t\tschema: {\n\t\t\t'type': 'object',\n\t\t\t'required': ['index', 'direction'],\n\t\t\t'properties': {\n\t\t\t\t'index': {\n\t\t\t\t\t'type': 'number'\n\t\t\t\t},\n\t\t\t\t'direction': {\n\t\t\t\t\t'type': 'string',\n\t\t\t\t\t'enum': ['up', 'down'],\n\t\t\t\t\t'default': 'down'\n\t\t\t\t},\n\t\t\t\t'levels': {\n\t\t\t\t\t'type': 'number',\n\t\t\t\t\t'default': 1\n\t\t\t\t},\n\t\t\t}\n\t\t}\n\t}]\n};\n\nregisterAction2(class extends Action2 {\n\tconstructor() {\n\t\tsuper({\n\t\t\tid: 'notebook.fold',\n\t\t\ttitle: localize2('fold.cell', \"Fold Cell\"),\n\t\t\tcategory: NOTEBOOK_ACTIONS_CATEGORY,\n\t\t\tkeybinding: {\n\t\t\t\twhen: ContextKeyExpr.and(NOTEBOOK_EDITOR_FOCUSED, ContextKeyExpr.not(InputFocusedContextKey)),\n\t\t\t\tprimary: KeyMod.CtrlCmd | KeyMod.Shift | KeyCode.BracketLeft,\n\t\t\t\tmac: {\n\t\t\t\t\tprimary: KeyMod.CtrlCmd | KeyMod.Alt | KeyCode.BracketLeft,\n\t\t\t\t\tsecondary: [KeyCode.LeftArrow],\n\t\t\t\t},\n\t\t\t\tsecondary: [KeyCode.LeftArrow],\n\t\t\t\tweight: KeybindingWeight.WorkbenchContrib\n\t\t\t},\n\t\t\tmetadata: {\n\t\t\t\tdescription: NOTEBOOK_FOLD_COMMAND_LABEL,\n\t\t\t\targs: FOLDING_COMMAND_ARGS.args\n\t\t\t},\n\t\t\tprecondition: NOTEBOOK_IS_ACTIVE_EDITOR,\n\t\t\tf1: true\n\t\t});\n\t}\n\n\tasync run(accessor: ServicesAccessor, args?: { index: number; levels: number; direction: 'up' | 'down' }): Promise<void> {\n\t\tconst editorService = accessor.get(IEditorService);\n\n\t\tconst editor = getNotebookEditorFromEditorPane(editorService.activeEditorPane);\n\t\tif (!editor) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!editor.hasModel()) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst levels = args && args.levels || 1;\n\t\tconst direction = args && args.direction === 'up' ? 'up' : 'down';\n\t\tlet index: number | undefined = undefined;\n\n\t\tif (args) {\n\t\t\tindex = args.index;\n\t\t} else {\n\t\t\tconst activeCell = editor.getActiveCell();\n\t\t\tif (!activeCell) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tindex = editor.getCellIndex(activeCell);\n\t\t}\n\n\t\tconst controller = editor.getContribution<FoldingController>(FoldingController.id);\n\t\tif (index !== undefined) {\n\t\t\tconst targetCell = (index < 0 || index >= editor.getLength()) ? undefined : editor.cellAt(index);\n\t\t\tif (targetCell?.cellKind === CellKind.Code && direction === 'down') {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (direction === 'up') {\n\t\t\t\tcontroller.setFoldingStateUp(index, CellFoldingState.Collapsed, levels);\n\t\t\t} else {\n\t\t\t\tcontroller.setFoldingStateDown(index, CellFoldingState.Collapsed, levels);\n\t\t\t}\n\n\t\t\tconst viewIndex = editor.getViewModel().getNearestVisibleCellIndexUpwards(index);\n\t\t\teditor.focusElement(editor.cellAt(viewIndex));\n\t\t}\n\t}\n});\n\nregisterAction2(class extends Action2 {\n\tconstructor() {\n\t\tsuper({\n\t\t\tid: 'notebook.unfold',\n\t\t\ttitle: NOTEBOOK_UNFOLD_COMMAND_LABEL,\n\t\t\tcategory: NOTEBOOK_ACTIONS_CATEGORY,\n\t\t\tkeybinding: {\n\t\t\t\twhen: ContextKeyExpr.and(NOTEBOOK_EDITOR_FOCUSED, ContextKeyExpr.not(InputFocusedContextKey)),\n\t\t\t\tprimary: KeyMod.CtrlCmd | KeyMod.Shift | KeyCode.BracketRight,\n\t\t\t\tmac: {\n\t\t\t\t\tprimary: KeyMod.CtrlCmd | KeyMod.Alt | KeyCode.BracketRight,\n\t\t\t\t\tsecondary: [KeyCode.RightArrow],\n\t\t\t\t},\n\t\t\t\tsecondary: [KeyCode.RightArrow],\n\t\t\t\tweight: KeybindingWeight.WorkbenchContrib\n\t\t\t},\n\t\t\tmetadata: {\n\t\t\t\tdescription: NOTEBOOK_UNFOLD_COMMAND_LABEL,\n\t\t\t\targs: FOLDING_COMMAND_ARGS.args\n\t\t\t},\n\t\t\tprecondition: NOTEBOOK_IS_ACTIVE_EDITOR,\n\t\t\tf1: true\n\t\t});\n\t}\n\n\tasync run(accessor: ServicesAccessor, args?: { index: number; levels: number; direction: 'up' | 'down' }): Promise<void> {\n\t\tconst editorService = accessor.get(IEditorService);\n\n\t\tconst editor = getNotebookEditorFromEditorPane(editorService.activeEditorPane);\n\t\tif (!editor) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst levels = args && args.levels || 1;\n\t\tconst direction = args && args.direction === 'up' ? 'up' : 'down';\n\t\tlet index: number | undefined = undefined;\n\n\t\tif (args) {\n\t\t\tindex = args.index;\n\t\t} else {\n\t\t\tconst activeCell = editor.getActiveCell();\n\t\t\tif (!activeCell) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tindex = editor.getCellIndex(activeCell);\n\t\t}\n\n\t\tconst controller = editor.getContribution<FoldingController>(FoldingController.id);\n\t\tif (index !== undefined) {\n\t\t\tif (direction === 'up') {\n\t\t\t\tcontroller.setFoldingStateUp(index, CellFoldingState.Expanded, levels);\n\t\t\t} else {\n\t\t\t\tcontroller.setFoldingStateDown(index, CellFoldingState.Expanded, levels);\n\t\t\t}\n\t\t}\n\t}\n});\n"]}