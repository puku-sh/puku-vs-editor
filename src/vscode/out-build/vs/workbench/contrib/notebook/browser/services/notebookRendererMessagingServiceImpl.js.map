{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/contrib/notebook/browser/services/notebookRendererMessagingServiceImpl.ts","vs/workbench/contrib/notebook/browser/services/notebookRendererMessagingServiceImpl.ts"],"names":[],"mappings":"AAAA;;;gGAGgG;;;;;;;;;;AAEhG,OAAO,EAAE,OAAO,EAAE,MAAM,qCAAqC,CAAC;AAC9D,OAAO,EAAE,UAAU,EAAE,MAAM,yCAAyC,CAAC;AAErE,OAAO,EAAE,iBAAiB,EAAE,MAAM,sDAAsD,CAAC;AAIlF,IAAM,gCAAgC,GAAtC,MAAM,gCAAiC,SAAQ,UAAU;IAW/D,YACoB,gBAAoD;QAEvE,KAAK,EAAE,CAAC;QAF4B,qBAAgB,GAAhB,gBAAgB,CAAmB;QAVxE;;;WAGG;QACc,gBAAW,GAAG,IAAI,GAAG,EAAwD,CAAC;QAC9E,oBAAe,GAAG,IAAI,GAAG,EAAmD,CAAC;QAC7E,uBAAkB,GAAG,IAAI,CAAC,SAAS,CAAC,IAAI,OAAO,EAAiB,CAAC,CAAC;QACnE,wBAAmB,GAAG,IAAI,CAAC,kBAAkB,CAAC,KAAK,CAAC;IAMpE,CAAC;IAED,kBAAkB;IACX,cAAc,CAAC,QAA4B,EAAE,UAAkB,EAAE,OAAgB;QACvF,IAAI,QAAQ,KAAK,SAAS,EAAE,CAAC;YAC5B,MAAM,KAAK,GAAG,CAAC,GAAG,IAAI,CAAC,eAAe,CAAC,MAAM,EAAE,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,qBAAqB,EAAE,CAAC,UAAU,EAAE,OAAO,CAAC,CAAC,CAAC;YAC1G,OAAO,OAAO,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;QACvD,CAAC;QAED,OAAO,IAAI,CAAC,eAAe,CAAC,GAAG,CAAC,QAAQ,CAAC,EAAE,qBAAqB,EAAE,CAAC,UAAU,EAAE,OAAO,CAAC,IAAI,OAAO,CAAC,OAAO,CAAC,KAAK,CAAC,CAAC;IACnH,CAAC;IAED,kBAAkB;IACX,OAAO,CAAC,UAAkB;QAChC,IAAI,IAAI,CAAC,WAAW,CAAC,GAAG,CAAC,UAAU,CAAC,EAAE,CAAC;YACtC,OAAO;QACR,CAAC;QAED,MAAM,KAAK,GAAoB,EAAE,CAAC;QAClC,IAAI,CAAC,WAAW,CAAC,GAAG,CAAC,UAAU,EAAE,KAAK,CAAC,CAAC;QAExC,IAAI,CAAC,gBAAgB,CAAC,eAAe,CAAC,cAAc,UAAU,EAAE,CAAC,CAAC,IAAI,CAAC,GAAG,EAAE;YAC3E,KAAK,MAAM,OAAO,IAAI,KAAK,EAAE,CAAC;gBAC7B,IAAI,CAAC,kBAAkB,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;YACvC,CAAC;YAED,IAAI,CAAC,WAAW,CAAC,GAAG,CAAC,UAAU,EAAE,SAAS,CAAC,CAAC;QAC7C,CAAC,CAAC,CAAC;IACJ,CAAC;IAED,kBAAkB;IACX,SAAS,CAAC,QAAgB;QAChC,MAAM,QAAQ,GAAG,IAAI,CAAC,eAAe,CAAC,GAAG,CAAC,QAAQ,CAAC,CAAC;QACpD,IAAI,QAAQ,EAAE,CAAC;YACd,OAAO,QAAQ,CAAC;QACjB,CAAC;QAED,MAAM,SAAS,GAA6B;YAC3C,WAAW,EAAE,CAAC,UAAU,EAAE,OAAO,EAAE,EAAE,CAAC,IAAI,CAAC,WAAW,CAAC,QAAQ,EAAE,UAAU,EAAE,OAAO,CAAC;YACrF,OAAO,EAAE,GAAG,EAAE,CAAC,IAAI,CAAC,eAAe,CAAC,MAAM,CAAC,QAAQ,CAAC;SACpD,CAAC;QAEF,IAAI,CAAC,eAAe,CAAC,GAAG,CAAC,QAAQ,EAAE,SAAS,CAAC,CAAC;QAC9C,OAAO,SAAS,CAAC;IAClB,CAAC;IAEO,WAAW,CAAC,QAAgB,EAAE,UAAkB,EAAE,OAAgB;QACzE,IAAI,CAAC,IAAI,CAAC,WAAW,CAAC,GAAG,CAAC,UAAU,CAAC,EAAE,CAAC;YACvC,IAAI,CAAC,OAAO,CAAC,UAAU,CAAC,CAAC;QAC1B,CAAC;QAED,MAAM,UAAU,GAAG,IAAI,CAAC,WAAW,CAAC,GAAG,CAAC,UAAU,CAAC,CAAC;QACpD,MAAM,MAAM,GAAG,EAAE,UAAU,EAAE,QAAQ,EAAE,OAAO,EAAE,CAAC;QACjD,IAAI,UAAU,KAAK,SAAS,EAAE,CAAC;YAC9B,IAAI,CAAC,kBAAkB,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;QACtC,CAAC;aAAM,CAAC;YACP,UAAU,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;QACzB,CAAC;IACF,CAAC;CACD,CAAA;AA1EY,gCAAgC;IAY1C,WAAA,iBAAiB,CAAA;GAZP,gCAAgC,CA0E5C","file":"notebookRendererMessagingServiceImpl.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Emitter } from '../../../../../base/common/event.js';\nimport { Disposable } from '../../../../../base/common/lifecycle.js';\nimport { INotebookRendererMessagingService, IScopedRendererMessaging } from '../../common/notebookRendererMessagingService.js';\nimport { IExtensionService } from '../../../../services/extensions/common/extensions.js';\n\ntype MessageToSend = { editorId: string; rendererId: string; message: unknown };\n\nexport class NotebookRendererMessagingService extends Disposable implements INotebookRendererMessagingService {\n\tdeclare _serviceBrand: undefined;\n\t/**\n\t * Activation promises. Maps renderer IDs to a queue of messages that should\n\t * be sent once activation finishes, or undefined if activation is complete.\n\t */\n\tprivate readonly activations = new Map<string /* rendererId */, undefined | MessageToSend[]>();\n\tprivate readonly scopedMessaging = new Map</* editorId */ string, IScopedRendererMessaging>();\n\tprivate readonly postMessageEmitter = this._register(new Emitter<MessageToSend>());\n\tpublic readonly onShouldPostMessage = this.postMessageEmitter.event;\n\n\tconstructor(\n\t\t@IExtensionService private readonly extensionService: IExtensionService\n\t) {\n\t\tsuper();\n\t}\n\n\t/** @inheritdoc */\n\tpublic receiveMessage(editorId: string | undefined, rendererId: string, message: unknown): Promise<boolean> {\n\t\tif (editorId === undefined) {\n\t\t\tconst sends = [...this.scopedMessaging.values()].map(e => e.receiveMessageHandler?.(rendererId, message));\n\t\t\treturn Promise.all(sends).then(s => s.some(s => !!s));\n\t\t}\n\n\t\treturn this.scopedMessaging.get(editorId)?.receiveMessageHandler?.(rendererId, message) ?? Promise.resolve(false);\n\t}\n\n\t/** @inheritdoc */\n\tpublic prepare(rendererId: string) {\n\t\tif (this.activations.has(rendererId)) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst queue: MessageToSend[] = [];\n\t\tthis.activations.set(rendererId, queue);\n\n\t\tthis.extensionService.activateByEvent(`onRenderer:${rendererId}`).then(() => {\n\t\t\tfor (const message of queue) {\n\t\t\t\tthis.postMessageEmitter.fire(message);\n\t\t\t}\n\n\t\t\tthis.activations.set(rendererId, undefined);\n\t\t});\n\t}\n\n\t/** @inheritdoc */\n\tpublic getScoped(editorId: string): IScopedRendererMessaging {\n\t\tconst existing = this.scopedMessaging.get(editorId);\n\t\tif (existing) {\n\t\t\treturn existing;\n\t\t}\n\n\t\tconst messaging: IScopedRendererMessaging = {\n\t\t\tpostMessage: (rendererId, message) => this.postMessage(editorId, rendererId, message),\n\t\t\tdispose: () => this.scopedMessaging.delete(editorId),\n\t\t};\n\n\t\tthis.scopedMessaging.set(editorId, messaging);\n\t\treturn messaging;\n\t}\n\n\tprivate postMessage(editorId: string, rendererId: string, message: unknown): void {\n\t\tif (!this.activations.has(rendererId)) {\n\t\t\tthis.prepare(rendererId);\n\t\t}\n\n\t\tconst activation = this.activations.get(rendererId);\n\t\tconst toSend = { rendererId, editorId, message };\n\t\tif (activation === undefined) {\n\t\t\tthis.postMessageEmitter.fire(toSend);\n\t\t} else {\n\t\t\tactivation.push(toSend);\n\t\t}\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Emitter } from '../../../../../base/common/event.js';\nimport { Disposable } from '../../../../../base/common/lifecycle.js';\nimport { INotebookRendererMessagingService, IScopedRendererMessaging } from '../../common/notebookRendererMessagingService.js';\nimport { IExtensionService } from '../../../../services/extensions/common/extensions.js';\n\ntype MessageToSend = { editorId: string; rendererId: string; message: unknown };\n\nexport class NotebookRendererMessagingService extends Disposable implements INotebookRendererMessagingService {\n\tdeclare _serviceBrand: undefined;\n\t/**\n\t * Activation promises. Maps renderer IDs to a queue of messages that should\n\t * be sent once activation finishes, or undefined if activation is complete.\n\t */\n\tprivate readonly activations = new Map<string /* rendererId */, undefined | MessageToSend[]>();\n\tprivate readonly scopedMessaging = new Map</* editorId */ string, IScopedRendererMessaging>();\n\tprivate readonly postMessageEmitter = this._register(new Emitter<MessageToSend>());\n\tpublic readonly onShouldPostMessage = this.postMessageEmitter.event;\n\n\tconstructor(\n\t\t@IExtensionService private readonly extensionService: IExtensionService\n\t) {\n\t\tsuper();\n\t}\n\n\t/** @inheritdoc */\n\tpublic receiveMessage(editorId: string | undefined, rendererId: string, message: unknown): Promise<boolean> {\n\t\tif (editorId === undefined) {\n\t\t\tconst sends = [...this.scopedMessaging.values()].map(e => e.receiveMessageHandler?.(rendererId, message));\n\t\t\treturn Promise.all(sends).then(s => s.some(s => !!s));\n\t\t}\n\n\t\treturn this.scopedMessaging.get(editorId)?.receiveMessageHandler?.(rendererId, message) ?? Promise.resolve(false);\n\t}\n\n\t/** @inheritdoc */\n\tpublic prepare(rendererId: string) {\n\t\tif (this.activations.has(rendererId)) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst queue: MessageToSend[] = [];\n\t\tthis.activations.set(rendererId, queue);\n\n\t\tthis.extensionService.activateByEvent(`onRenderer:${rendererId}`).then(() => {\n\t\t\tfor (const message of queue) {\n\t\t\t\tthis.postMessageEmitter.fire(message);\n\t\t\t}\n\n\t\t\tthis.activations.set(rendererId, undefined);\n\t\t});\n\t}\n\n\t/** @inheritdoc */\n\tpublic getScoped(editorId: string): IScopedRendererMessaging {\n\t\tconst existing = this.scopedMessaging.get(editorId);\n\t\tif (existing) {\n\t\t\treturn existing;\n\t\t}\n\n\t\tconst messaging: IScopedRendererMessaging = {\n\t\t\tpostMessage: (rendererId, message) => this.postMessage(editorId, rendererId, message),\n\t\t\tdispose: () => this.scopedMessaging.delete(editorId),\n\t\t};\n\n\t\tthis.scopedMessaging.set(editorId, messaging);\n\t\treturn messaging;\n\t}\n\n\tprivate postMessage(editorId: string, rendererId: string, message: unknown): void {\n\t\tif (!this.activations.has(rendererId)) {\n\t\t\tthis.prepare(rendererId);\n\t\t}\n\n\t\tconst activation = this.activations.get(rendererId);\n\t\tconst toSend = { rendererId, editorId, message };\n\t\tif (activation === undefined) {\n\t\t\tthis.postMessageEmitter.fire(toSend);\n\t\t} else {\n\t\t\tactivation.push(toSend);\n\t\t}\n\t}\n}\n"]}