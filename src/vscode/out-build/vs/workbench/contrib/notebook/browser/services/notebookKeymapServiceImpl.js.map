{"version":3,"sources":["vs/workbench/contrib/notebook/browser/services/notebookKeymapServiceImpl.ts"],"names":[],"mappings":"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","file":"notebookKeymapServiceImpl.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { onUnexpectedError } from '../../../../../base/common/errors.js';\nimport { Event } from '../../../../../base/common/event.js';\nimport { Disposable } from '../../../../../base/common/lifecycle.js';\nimport { localize } from '../../../../../nls.js';\nimport { IInstantiationService, ServicesAccessor } from '../../../../../platform/instantiation/common/instantiation.js';\nimport { INotificationService, Severity } from '../../../../../platform/notification/common/notification.js';\nimport { getInstalledExtensions, IExtensionStatus } from '../../../extensions/common/extensionsUtils.js';\nimport { INotebookKeymapService } from '../../common/notebookKeymapService.js';\nimport { EnablementState, IWorkbenchExtensionEnablementService } from '../../../../services/extensionManagement/common/extensionManagement.js';\nimport { ILifecycleService } from '../../../../services/lifecycle/common/lifecycle.js';\nimport { IExtensionIdentifier, IExtensionManagementService, InstallOperation } from '../../../../../platform/extensionManagement/common/extensionManagement.js';\nimport { areSameExtensions } from '../../../../../platform/extensionManagement/common/extensionManagementUtil.js';\nimport { IStorageService, StorageScope, StorageTarget } from '../../../../../platform/storage/common/storage.js';\nimport { Memento } from '../../../../common/memento.js';\nimport { distinct } from '../../../../../base/common/arrays.js';\n\nfunction onExtensionChanged(accessor: ServicesAccessor): Event<IExtensionIdentifier[]> {\n\tconst extensionService = accessor.get(IExtensionManagementService);\n\tconst extensionEnablementService = accessor.get(IWorkbenchExtensionEnablementService);\n\tconst onDidInstallExtensions = Event.chain(extensionService.onDidInstallExtensions, $ =>\n\t\t$.filter(e => e.some(({ operation }) => operation === InstallOperation.Install))\n\t\t\t.map(e => e.map(({ identifier }) => identifier))\n\t);\n\treturn Event.debounce<IExtensionIdentifier[], IExtensionIdentifier[]>(Event.any(\n\t\tEvent.any(onDidInstallExtensions, Event.map(extensionService.onDidUninstallExtension, e => [e.identifier])),\n\t\tEvent.map(extensionEnablementService.onEnablementChanged, extensions => extensions.map(e => e.identifier))\n\t), (result: IExtensionIdentifier[] | undefined, identifiers: IExtensionIdentifier[]) => {\n\t\tresult = result || (identifiers.length ? [identifiers[0]] : []);\n\t\tfor (const identifier of identifiers) {\n\t\t\tif (result.some(l => !areSameExtensions(l, identifier))) {\n\t\t\t\tresult.push(identifier);\n\t\t\t}\n\t\t}\n\n\t\treturn result;\n\t});\n}\n\nconst hasRecommendedKeymapKey = 'hasRecommendedKeymap';\n\ninterface NotebookKeymapMemento {\n\t[hasRecommendedKeymapKey]?: boolean;\n}\n\nexport class NotebookKeymapService extends Disposable implements INotebookKeymapService {\n\t_serviceBrand: undefined;\n\n\tprivate notebookKeymapMemento: Memento<NotebookKeymapMemento>;\n\tprivate notebookKeymap: NotebookKeymapMemento;\n\n\tconstructor(\n\t\t@IInstantiationService private readonly instantiationService: IInstantiationService,\n\t\t@IWorkbenchExtensionEnablementService private readonly extensionEnablementService: IWorkbenchExtensionEnablementService,\n\t\t@INotificationService private readonly notificationService: INotificationService,\n\t\t@IStorageService storageService: IStorageService,\n\t\t@ILifecycleService lifecycleService: ILifecycleService,\n\t) {\n\t\tsuper();\n\n\t\tthis.notebookKeymapMemento = new Memento('notebookKeymap', storageService);\n\t\tthis.notebookKeymap = this.notebookKeymapMemento.getMemento(StorageScope.PROFILE, StorageTarget.USER);\n\n\t\tthis._register(lifecycleService.onDidShutdown(() => this.dispose()));\n\t\tthis._register(this.instantiationService.invokeFunction(onExtensionChanged)((identifiers => {\n\t\t\tPromise.all(identifiers.map(identifier => this.checkForOtherKeymaps(identifier)))\n\t\t\t\t.then(undefined, onUnexpectedError);\n\t\t})));\n\t}\n\n\tprivate checkForOtherKeymaps(extensionIdentifier: IExtensionIdentifier): Promise<void> {\n\t\treturn this.instantiationService.invokeFunction(getInstalledExtensions).then(extensions => {\n\t\t\tconst keymaps = extensions.filter(extension => isNotebookKeymapExtension(extension));\n\t\t\tconst extension = keymaps.find(extension => areSameExtensions(extension.identifier, extensionIdentifier));\n\t\t\tif (extension && extension.globallyEnabled) {\n\t\t\t\t// there is already a keymap extension\n\t\t\t\tthis.notebookKeymap[hasRecommendedKeymapKey] = true;\n\t\t\t\tthis.notebookKeymapMemento.saveMemento();\n\t\t\t\tconst otherKeymaps = keymaps.filter(extension => !areSameExtensions(extension.identifier, extensionIdentifier) && extension.globallyEnabled);\n\t\t\t\tif (otherKeymaps.length) {\n\t\t\t\t\treturn this.promptForDisablingOtherKeymaps(extension, otherKeymaps);\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn undefined;\n\t\t});\n\t}\n\n\tprivate promptForDisablingOtherKeymaps(newKeymap: IExtensionStatus, oldKeymaps: IExtensionStatus[]): void {\n\t\tconst onPrompt = (confirmed: boolean) => {\n\t\t\tif (confirmed) {\n\t\t\t\tthis.extensionEnablementService.setEnablement(oldKeymaps.map(keymap => keymap.local), EnablementState.DisabledGlobally);\n\t\t\t}\n\t\t};\n\n\t\tthis.notificationService.prompt(Severity.Info, localize('disableOtherKeymapsConfirmation', \"Disable other keymaps ({0}) to avoid conflicts between keybindings?\", distinct(oldKeymaps.map(k => k.local.manifest.displayName)).map(name => `'${name}'`).join(', ')),\n\t\t\t[{\n\t\t\t\tlabel: localize('yes', \"Yes\"),\n\t\t\t\trun: () => onPrompt(true)\n\t\t\t}, {\n\t\t\t\tlabel: localize('no', \"No\"),\n\t\t\t\trun: () => onPrompt(false)\n\t\t\t}]\n\t\t);\n\t}\n}\n\nexport function isNotebookKeymapExtension(extension: IExtensionStatus): boolean {\n\tif (extension.local.manifest.extensionPack) {\n\t\treturn false;\n\t}\n\n\tconst keywords = extension.local.manifest.keywords;\n\tif (!keywords) {\n\t\treturn false;\n\t}\n\n\treturn keywords.indexOf('notebook-keymap') !== -1;\n}\n"]}