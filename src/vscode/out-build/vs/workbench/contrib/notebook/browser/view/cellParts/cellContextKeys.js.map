{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/contrib/notebook/browser/view/cellParts/cellContextKeys.ts","vs/workbench/contrib/notebook/browser/view/cellParts/cellContextKeys.ts"],"names":[],"mappings":"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","file":"cellContextKeys.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Disposable, DisposableStore } from '../../../../../../base/common/lifecycle.js';\nimport { autorun } from '../../../../../../base/common/observable.js';\nimport { IContextKey, IContextKeyService } from '../../../../../../platform/contextkey/common/contextkey.js';\nimport { IInstantiationService } from '../../../../../../platform/instantiation/common/instantiation.js';\nimport { CellEditState, CellFocusMode, ICellViewModel, INotebookEditorDelegate } from '../../notebookBrowser.js';\nimport { CellViewModelStateChangeEvent } from '../../notebookViewEvents.js';\nimport { CellContentPart } from '../cellPart.js';\nimport { CodeCellViewModel } from '../../viewModel/codeCellViewModel.js';\nimport { MarkupCellViewModel } from '../../viewModel/markupCellViewModel.js';\nimport { NotebookCellExecutionState } from '../../../common/notebookCommon.js';\nimport { NotebookCellExecutionStateContext, NOTEBOOK_CELL_EDITABLE, NOTEBOOK_CELL_EDITOR_FOCUSED, NOTEBOOK_CELL_EXECUTING, NOTEBOOK_CELL_EXECUTION_STATE, NOTEBOOK_CELL_FOCUSED, NOTEBOOK_CELL_HAS_OUTPUTS, NOTEBOOK_CELL_INPUT_COLLAPSED, NOTEBOOK_CELL_LINE_NUMBERS, NOTEBOOK_CELL_MARKDOWN_EDIT_MODE, NOTEBOOK_CELL_OUTPUT_COLLAPSED, NOTEBOOK_CELL_RESOURCE, NOTEBOOK_CELL_TYPE, NOTEBOOK_CELL_HAS_ERROR_DIAGNOSTICS } from '../../../common/notebookContextKeys.js';\nimport { INotebookExecutionStateService, NotebookExecutionType } from '../../../common/notebookExecutionStateService.js';\n\nexport class CellContextKeyPart extends CellContentPart {\n\tprivate cellContextKeyManager: CellContextKeyManager;\n\n\tconstructor(\n\t\tnotebookEditor: INotebookEditorDelegate,\n\t\t@IInstantiationService private readonly instantiationService: IInstantiationService,\n\t) {\n\t\tsuper();\n\n\t\tthis.cellContextKeyManager = this._register(this.instantiationService.createInstance(CellContextKeyManager, notebookEditor, undefined));\n\t}\n\n\toverride didRenderCell(element: ICellViewModel): void {\n\t\tthis.cellContextKeyManager.updateForElement(element);\n\t}\n}\n\nexport class CellContextKeyManager extends Disposable {\n\n\tprivate cellType!: IContextKey<'code' | 'markup'>;\n\tprivate cellEditable!: IContextKey<boolean>;\n\tprivate cellFocused!: IContextKey<boolean>;\n\tprivate cellEditorFocused!: IContextKey<boolean>;\n\tprivate cellRunState!: IContextKey<NotebookCellExecutionStateContext>;\n\tprivate cellExecuting!: IContextKey<boolean>;\n\tprivate cellHasOutputs!: IContextKey<boolean>;\n\tprivate cellContentCollapsed!: IContextKey<boolean>;\n\tprivate cellOutputCollapsed!: IContextKey<boolean>;\n\tprivate cellLineNumbers!: IContextKey<'on' | 'off' | 'inherit'>;\n\tprivate cellResource!: IContextKey<string>;\n\tprivate cellHasErrorDiagnostics!: IContextKey<boolean>;\n\n\tprivate markdownEditMode!: IContextKey<boolean>;\n\n\tprivate readonly elementDisposables = this._register(new DisposableStore());\n\n\tconstructor(\n\t\tprivate readonly notebookEditor: INotebookEditorDelegate,\n\t\tprivate element: ICellViewModel | undefined,\n\t\t@IContextKeyService private readonly _contextKeyService: IContextKeyService,\n\t\t@INotebookExecutionStateService private readonly _notebookExecutionStateService: INotebookExecutionStateService,\n\t) {\n\t\tsuper();\n\n\t\tthis._contextKeyService.bufferChangeEvents(() => {\n\t\t\tthis.cellType = NOTEBOOK_CELL_TYPE.bindTo(this._contextKeyService);\n\t\t\tthis.cellEditable = NOTEBOOK_CELL_EDITABLE.bindTo(this._contextKeyService);\n\t\t\tthis.cellFocused = NOTEBOOK_CELL_FOCUSED.bindTo(this._contextKeyService);\n\t\t\tthis.cellEditorFocused = NOTEBOOK_CELL_EDITOR_FOCUSED.bindTo(this._contextKeyService);\n\t\t\tthis.markdownEditMode = NOTEBOOK_CELL_MARKDOWN_EDIT_MODE.bindTo(this._contextKeyService);\n\t\t\tthis.cellRunState = NOTEBOOK_CELL_EXECUTION_STATE.bindTo(this._contextKeyService);\n\t\t\tthis.cellExecuting = NOTEBOOK_CELL_EXECUTING.bindTo(this._contextKeyService);\n\t\t\tthis.cellHasOutputs = NOTEBOOK_CELL_HAS_OUTPUTS.bindTo(this._contextKeyService);\n\t\t\tthis.cellContentCollapsed = NOTEBOOK_CELL_INPUT_COLLAPSED.bindTo(this._contextKeyService);\n\t\t\tthis.cellOutputCollapsed = NOTEBOOK_CELL_OUTPUT_COLLAPSED.bindTo(this._contextKeyService);\n\t\t\tthis.cellLineNumbers = NOTEBOOK_CELL_LINE_NUMBERS.bindTo(this._contextKeyService);\n\t\t\tthis.cellResource = NOTEBOOK_CELL_RESOURCE.bindTo(this._contextKeyService);\n\t\t\tthis.cellHasErrorDiagnostics = NOTEBOOK_CELL_HAS_ERROR_DIAGNOSTICS.bindTo(this._contextKeyService);\n\n\t\t\tif (element) {\n\t\t\t\tthis.updateForElement(element);\n\t\t\t}\n\t\t});\n\n\t\tthis._register(this._notebookExecutionStateService.onDidChangeExecution(e => {\n\t\t\tif (e.type === NotebookExecutionType.cell && this.element && e.affectsCell(this.element.uri)) {\n\t\t\t\tthis.updateForExecutionState();\n\t\t\t}\n\t\t}));\n\t}\n\n\tpublic updateForElement(element: ICellViewModel | undefined) {\n\t\tthis.elementDisposables.clear();\n\t\tthis.element = element;\n\n\t\tif (!element) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.elementDisposables.add(element.onDidChangeState(e => this.onDidChangeState(e)));\n\n\t\tif (element instanceof CodeCellViewModel) {\n\t\t\tthis.elementDisposables.add(element.onDidChangeOutputs(() => this.updateForOutputs()));\n\t\t\tthis.elementDisposables.add(autorun(reader => {\n\t\t\t\tthis.cellHasErrorDiagnostics.set(!!reader.readObservable(element.executionErrorDiagnostic));\n\t\t\t}));\n\t\t}\n\n\t\tthis.elementDisposables.add(this.notebookEditor.onDidChangeActiveCell(() => this.updateForFocusState()));\n\n\t\tif (this.element instanceof MarkupCellViewModel) {\n\t\t\tthis.cellType.set('markup');\n\t\t} else if (this.element instanceof CodeCellViewModel) {\n\t\t\tthis.cellType.set('code');\n\t\t}\n\n\t\tthis._contextKeyService.bufferChangeEvents(() => {\n\t\t\tthis.updateForFocusState();\n\t\t\tthis.updateForExecutionState();\n\t\t\tthis.updateForEditState();\n\t\t\tthis.updateForCollapseState();\n\t\t\tthis.updateForOutputs();\n\n\t\t\tthis.cellLineNumbers.set(this.element!.lineNumbers);\n\t\t\tthis.cellResource.set(this.element!.uri.toString());\n\t\t});\n\t}\n\n\tprivate onDidChangeState(e: CellViewModelStateChangeEvent) {\n\t\tthis._contextKeyService.bufferChangeEvents(() => {\n\t\t\tif (e.internalMetadataChanged) {\n\t\t\t\tthis.updateForExecutionState();\n\t\t\t}\n\n\t\t\tif (e.editStateChanged) {\n\t\t\t\tthis.updateForEditState();\n\t\t\t}\n\n\t\t\tif (e.focusModeChanged) {\n\t\t\t\tthis.updateForFocusState();\n\t\t\t}\n\n\t\t\tif (e.cellLineNumberChanged) {\n\t\t\t\tthis.cellLineNumbers.set(this.element!.lineNumbers);\n\t\t\t}\n\n\t\t\tif (e.inputCollapsedChanged || e.outputCollapsedChanged) {\n\t\t\t\tthis.updateForCollapseState();\n\t\t\t}\n\t\t});\n\t}\n\n\tprivate updateForFocusState() {\n\t\tif (!this.element) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst activeCell = this.notebookEditor.getActiveCell();\n\t\tthis.cellFocused.set(this.notebookEditor.getActiveCell() === this.element);\n\n\t\tif (activeCell === this.element) {\n\t\t\tthis.cellEditorFocused.set(this.element.focusMode === CellFocusMode.Editor);\n\t\t} else {\n\t\t\tthis.cellEditorFocused.set(false);\n\t\t}\n\n\t}\n\n\tprivate updateForExecutionState() {\n\t\tif (!this.element) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst internalMetadata = this.element.internalMetadata;\n\t\tthis.cellEditable.set(!this.notebookEditor.isReadOnly);\n\n\t\tconst exeState = this._notebookExecutionStateService.getCellExecution(this.element.uri);\n\t\tif (this.element instanceof MarkupCellViewModel) {\n\t\t\tthis.cellRunState.reset();\n\t\t\tthis.cellExecuting.reset();\n\t\t} else if (exeState?.state === NotebookCellExecutionState.Executing) {\n\t\t\tthis.cellRunState.set('executing');\n\t\t\tthis.cellExecuting.set(true);\n\t\t} else if (exeState?.state === NotebookCellExecutionState.Pending || exeState?.state === NotebookCellExecutionState.Unconfirmed) {\n\t\t\tthis.cellRunState.set('pending');\n\t\t\tthis.cellExecuting.set(true);\n\t\t} else if (internalMetadata.lastRunSuccess === true) {\n\t\t\tthis.cellRunState.set('succeeded');\n\t\t\tthis.cellExecuting.set(false);\n\t\t} else if (internalMetadata.lastRunSuccess === false) {\n\t\t\tthis.cellRunState.set('failed');\n\t\t\tthis.cellExecuting.set(false);\n\t\t} else {\n\t\t\tthis.cellRunState.set('idle');\n\t\t\tthis.cellExecuting.set(false);\n\t\t}\n\t}\n\n\tprivate updateForEditState() {\n\t\tif (!this.element) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.element instanceof MarkupCellViewModel) {\n\t\t\tthis.markdownEditMode.set(this.element.getEditState() === CellEditState.Editing);\n\t\t} else {\n\t\t\tthis.markdownEditMode.set(false);\n\t\t}\n\t}\n\n\tprivate updateForCollapseState() {\n\t\tif (!this.element) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.cellContentCollapsed.set(!!this.element.isInputCollapsed);\n\t\tthis.cellOutputCollapsed.set(!!this.element.isOutputCollapsed);\n\t}\n\n\tprivate updateForOutputs() {\n\t\tif (this.element instanceof CodeCellViewModel) {\n\t\t\tthis.cellHasOutputs.set(this.element.outputsViewModels.length > 0);\n\t\t} else {\n\t\t\tthis.cellHasOutputs.set(false);\n\t\t}\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Disposable, DisposableStore } from '../../../../../../base/common/lifecycle.js';\nimport { autorun } from '../../../../../../base/common/observable.js';\nimport { IContextKey, IContextKeyService } from '../../../../../../platform/contextkey/common/contextkey.js';\nimport { IInstantiationService } from '../../../../../../platform/instantiation/common/instantiation.js';\nimport { CellEditState, CellFocusMode, ICellViewModel, INotebookEditorDelegate } from '../../notebookBrowser.js';\nimport { CellViewModelStateChangeEvent } from '../../notebookViewEvents.js';\nimport { CellContentPart } from '../cellPart.js';\nimport { CodeCellViewModel } from '../../viewModel/codeCellViewModel.js';\nimport { MarkupCellViewModel } from '../../viewModel/markupCellViewModel.js';\nimport { NotebookCellExecutionState } from '../../../common/notebookCommon.js';\nimport { NotebookCellExecutionStateContext, NOTEBOOK_CELL_EDITABLE, NOTEBOOK_CELL_EDITOR_FOCUSED, NOTEBOOK_CELL_EXECUTING, NOTEBOOK_CELL_EXECUTION_STATE, NOTEBOOK_CELL_FOCUSED, NOTEBOOK_CELL_HAS_OUTPUTS, NOTEBOOK_CELL_INPUT_COLLAPSED, NOTEBOOK_CELL_LINE_NUMBERS, NOTEBOOK_CELL_MARKDOWN_EDIT_MODE, NOTEBOOK_CELL_OUTPUT_COLLAPSED, NOTEBOOK_CELL_RESOURCE, NOTEBOOK_CELL_TYPE, NOTEBOOK_CELL_HAS_ERROR_DIAGNOSTICS } from '../../../common/notebookContextKeys.js';\nimport { INotebookExecutionStateService, NotebookExecutionType } from '../../../common/notebookExecutionStateService.js';\n\nexport class CellContextKeyPart extends CellContentPart {\n\tprivate cellContextKeyManager: CellContextKeyManager;\n\n\tconstructor(\n\t\tnotebookEditor: INotebookEditorDelegate,\n\t\t@IInstantiationService private readonly instantiationService: IInstantiationService,\n\t) {\n\t\tsuper();\n\n\t\tthis.cellContextKeyManager = this._register(this.instantiationService.createInstance(CellContextKeyManager, notebookEditor, undefined));\n\t}\n\n\toverride didRenderCell(element: ICellViewModel): void {\n\t\tthis.cellContextKeyManager.updateForElement(element);\n\t}\n}\n\nexport class CellContextKeyManager extends Disposable {\n\n\tprivate cellType!: IContextKey<'code' | 'markup'>;\n\tprivate cellEditable!: IContextKey<boolean>;\n\tprivate cellFocused!: IContextKey<boolean>;\n\tprivate cellEditorFocused!: IContextKey<boolean>;\n\tprivate cellRunState!: IContextKey<NotebookCellExecutionStateContext>;\n\tprivate cellExecuting!: IContextKey<boolean>;\n\tprivate cellHasOutputs!: IContextKey<boolean>;\n\tprivate cellContentCollapsed!: IContextKey<boolean>;\n\tprivate cellOutputCollapsed!: IContextKey<boolean>;\n\tprivate cellLineNumbers!: IContextKey<'on' | 'off' | 'inherit'>;\n\tprivate cellResource!: IContextKey<string>;\n\tprivate cellHasErrorDiagnostics!: IContextKey<boolean>;\n\n\tprivate markdownEditMode!: IContextKey<boolean>;\n\n\tprivate readonly elementDisposables = this._register(new DisposableStore());\n\n\tconstructor(\n\t\tprivate readonly notebookEditor: INotebookEditorDelegate,\n\t\tprivate element: ICellViewModel | undefined,\n\t\t@IContextKeyService private readonly _contextKeyService: IContextKeyService,\n\t\t@INotebookExecutionStateService private readonly _notebookExecutionStateService: INotebookExecutionStateService,\n\t) {\n\t\tsuper();\n\n\t\tthis._contextKeyService.bufferChangeEvents(() => {\n\t\t\tthis.cellType = NOTEBOOK_CELL_TYPE.bindTo(this._contextKeyService);\n\t\t\tthis.cellEditable = NOTEBOOK_CELL_EDITABLE.bindTo(this._contextKeyService);\n\t\t\tthis.cellFocused = NOTEBOOK_CELL_FOCUSED.bindTo(this._contextKeyService);\n\t\t\tthis.cellEditorFocused = NOTEBOOK_CELL_EDITOR_FOCUSED.bindTo(this._contextKeyService);\n\t\t\tthis.markdownEditMode = NOTEBOOK_CELL_MARKDOWN_EDIT_MODE.bindTo(this._contextKeyService);\n\t\t\tthis.cellRunState = NOTEBOOK_CELL_EXECUTION_STATE.bindTo(this._contextKeyService);\n\t\t\tthis.cellExecuting = NOTEBOOK_CELL_EXECUTING.bindTo(this._contextKeyService);\n\t\t\tthis.cellHasOutputs = NOTEBOOK_CELL_HAS_OUTPUTS.bindTo(this._contextKeyService);\n\t\t\tthis.cellContentCollapsed = NOTEBOOK_CELL_INPUT_COLLAPSED.bindTo(this._contextKeyService);\n\t\t\tthis.cellOutputCollapsed = NOTEBOOK_CELL_OUTPUT_COLLAPSED.bindTo(this._contextKeyService);\n\t\t\tthis.cellLineNumbers = NOTEBOOK_CELL_LINE_NUMBERS.bindTo(this._contextKeyService);\n\t\t\tthis.cellResource = NOTEBOOK_CELL_RESOURCE.bindTo(this._contextKeyService);\n\t\t\tthis.cellHasErrorDiagnostics = NOTEBOOK_CELL_HAS_ERROR_DIAGNOSTICS.bindTo(this._contextKeyService);\n\n\t\t\tif (element) {\n\t\t\t\tthis.updateForElement(element);\n\t\t\t}\n\t\t});\n\n\t\tthis._register(this._notebookExecutionStateService.onDidChangeExecution(e => {\n\t\t\tif (e.type === NotebookExecutionType.cell && this.element && e.affectsCell(this.element.uri)) {\n\t\t\t\tthis.updateForExecutionState();\n\t\t\t}\n\t\t}));\n\t}\n\n\tpublic updateForElement(element: ICellViewModel | undefined) {\n\t\tthis.elementDisposables.clear();\n\t\tthis.element = element;\n\n\t\tif (!element) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.elementDisposables.add(element.onDidChangeState(e => this.onDidChangeState(e)));\n\n\t\tif (element instanceof CodeCellViewModel) {\n\t\t\tthis.elementDisposables.add(element.onDidChangeOutputs(() => this.updateForOutputs()));\n\t\t\tthis.elementDisposables.add(autorun(reader => {\n\t\t\t\tthis.cellHasErrorDiagnostics.set(!!reader.readObservable(element.executionErrorDiagnostic));\n\t\t\t}));\n\t\t}\n\n\t\tthis.elementDisposables.add(this.notebookEditor.onDidChangeActiveCell(() => this.updateForFocusState()));\n\n\t\tif (this.element instanceof MarkupCellViewModel) {\n\t\t\tthis.cellType.set('markup');\n\t\t} else if (this.element instanceof CodeCellViewModel) {\n\t\t\tthis.cellType.set('code');\n\t\t}\n\n\t\tthis._contextKeyService.bufferChangeEvents(() => {\n\t\t\tthis.updateForFocusState();\n\t\t\tthis.updateForExecutionState();\n\t\t\tthis.updateForEditState();\n\t\t\tthis.updateForCollapseState();\n\t\t\tthis.updateForOutputs();\n\n\t\t\tthis.cellLineNumbers.set(this.element!.lineNumbers);\n\t\t\tthis.cellResource.set(this.element!.uri.toString());\n\t\t});\n\t}\n\n\tprivate onDidChangeState(e: CellViewModelStateChangeEvent) {\n\t\tthis._contextKeyService.bufferChangeEvents(() => {\n\t\t\tif (e.internalMetadataChanged) {\n\t\t\t\tthis.updateForExecutionState();\n\t\t\t}\n\n\t\t\tif (e.editStateChanged) {\n\t\t\t\tthis.updateForEditState();\n\t\t\t}\n\n\t\t\tif (e.focusModeChanged) {\n\t\t\t\tthis.updateForFocusState();\n\t\t\t}\n\n\t\t\tif (e.cellLineNumberChanged) {\n\t\t\t\tthis.cellLineNumbers.set(this.element!.lineNumbers);\n\t\t\t}\n\n\t\t\tif (e.inputCollapsedChanged || e.outputCollapsedChanged) {\n\t\t\t\tthis.updateForCollapseState();\n\t\t\t}\n\t\t});\n\t}\n\n\tprivate updateForFocusState() {\n\t\tif (!this.element) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst activeCell = this.notebookEditor.getActiveCell();\n\t\tthis.cellFocused.set(this.notebookEditor.getActiveCell() === this.element);\n\n\t\tif (activeCell === this.element) {\n\t\t\tthis.cellEditorFocused.set(this.element.focusMode === CellFocusMode.Editor);\n\t\t} else {\n\t\t\tthis.cellEditorFocused.set(false);\n\t\t}\n\n\t}\n\n\tprivate updateForExecutionState() {\n\t\tif (!this.element) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst internalMetadata = this.element.internalMetadata;\n\t\tthis.cellEditable.set(!this.notebookEditor.isReadOnly);\n\n\t\tconst exeState = this._notebookExecutionStateService.getCellExecution(this.element.uri);\n\t\tif (this.element instanceof MarkupCellViewModel) {\n\t\t\tthis.cellRunState.reset();\n\t\t\tthis.cellExecuting.reset();\n\t\t} else if (exeState?.state === NotebookCellExecutionState.Executing) {\n\t\t\tthis.cellRunState.set('executing');\n\t\t\tthis.cellExecuting.set(true);\n\t\t} else if (exeState?.state === NotebookCellExecutionState.Pending || exeState?.state === NotebookCellExecutionState.Unconfirmed) {\n\t\t\tthis.cellRunState.set('pending');\n\t\t\tthis.cellExecuting.set(true);\n\t\t} else if (internalMetadata.lastRunSuccess === true) {\n\t\t\tthis.cellRunState.set('succeeded');\n\t\t\tthis.cellExecuting.set(false);\n\t\t} else if (internalMetadata.lastRunSuccess === false) {\n\t\t\tthis.cellRunState.set('failed');\n\t\t\tthis.cellExecuting.set(false);\n\t\t} else {\n\t\t\tthis.cellRunState.set('idle');\n\t\t\tthis.cellExecuting.set(false);\n\t\t}\n\t}\n\n\tprivate updateForEditState() {\n\t\tif (!this.element) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.element instanceof MarkupCellViewModel) {\n\t\t\tthis.markdownEditMode.set(this.element.getEditState() === CellEditState.Editing);\n\t\t} else {\n\t\t\tthis.markdownEditMode.set(false);\n\t\t}\n\t}\n\n\tprivate updateForCollapseState() {\n\t\tif (!this.element) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.cellContentCollapsed.set(!!this.element.isInputCollapsed);\n\t\tthis.cellOutputCollapsed.set(!!this.element.isOutputCollapsed);\n\t}\n\n\tprivate updateForOutputs() {\n\t\tif (this.element instanceof CodeCellViewModel) {\n\t\t\tthis.cellHasOutputs.set(this.element.outputsViewModels.length > 0);\n\t\t} else {\n\t\t\tthis.cellHasOutputs.set(false);\n\t\t}\n\t}\n}\n"]}