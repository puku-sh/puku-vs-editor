{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/contrib/notebook/browser/view/notebookCellAnchor.ts","vs/workbench/contrib/notebook/browser/view/notebookCellAnchor.ts"],"names":[],"mappings":"AAAA;;;gGAGgG;AAGhG,OAAO,EAAE,aAAa,EAAkB,MAAM,uBAAuB,CAAC;AAEtE,OAAO,EAAE,QAAQ,EAAE,0BAA0B,EAAE,eAAe,EAAE,MAAM,gCAAgC,CAAC;AASvG,MAAM,OAAO,kBAAkB;IAM9B,YACkB,6BAA6D,EAC7D,oBAA2C,EAC3C,WAA+B;QAF/B,kCAA6B,GAA7B,6BAA6B,CAAgC;QAC7D,yBAAoB,GAApB,oBAAoB,CAAuB;QAC3C,gBAAW,GAAX,WAAW,CAAoB;QAPzC,kBAAa,GAAG,KAAK,CAAC;IAQ9B,CAAC;IAEM,YAAY,CAAC,YAAsC,EAAE,YAAoB,EAAE,WAAmB,EAAE,gBAAgC;QACtI,IAAI,YAAY,CAAC,OAAO,CAAC,YAAY,CAAC,CAAC,SAAS,KAAK,aAAa,CAAC,MAAM,EAAE,CAAC;YAC3E,OAAO,IAAI,CAAC;QACb,CAAC;QACD,IAAI,IAAI,CAAC,aAAa,EAAE,CAAC;YACxB,OAAO,KAAK,CAAC;QACd,CAAC;QAED,MAAM,cAAc,GAAG,YAAY,CAAC,UAAU,CAAC,YAAY,CAAC,GAAG,YAAY,CAAC,aAAa,CAAC,YAAY,CAAC,GAAG,WAAW,CAAC;QACtH,MAAM,UAAU,GAAG,YAAY,CAAC,YAAY,GAAG,YAAY,CAAC,YAAY,EAAE,CAAC;QAC3E,MAAM,iBAAiB,GAAG,UAAU,GAAG,cAAc,CAAC;QACtD,MAAM,cAAc,GAAG,IAAI,CAAC,oBAAoB,CAAC,QAAQ,CAAC,eAAe,CAAC,kBAAkB,CAAC,KAAK,MAAM,CAAC;QACzG,MAAM,OAAO,GAAG,WAAW,GAAG,CAAC,CAAC;QAChC,MAAM,UAAU,GAAG,cAAc,IAAI,OAAO,IAAI,CAAC,iBAAiB,CAAC;QAEnE,IAAI,UAAU,EAAE,CAAC;YAChB,IAAI,CAAC,yBAAyB,CAAC,gBAAgB,CAAC,CAAC;YACjD,OAAO,IAAI,CAAC;QACb,CAAC;QAED,OAAO,KAAK,CAAC;IACd,CAAC;IAEM,yBAAyB,CAAC,aAA6B;QAC7D,iEAAiE;QACjE,IAAI,CAAC,IAAI,CAAC,gBAAgB,IAAI,aAAa,CAAC,QAAQ,KAAK,QAAQ,CAAC,IAAI,EAAE,CAAC;YACxE,MAAM,cAAc,GAAG,IAAI,CAAC,6BAA6B,CAAC,gBAAgB,CAAC,aAAa,CAAC,GAAG,CAAC,CAAC;YAC9F,IAAI,cAAc,IAAI,cAAc,CAAC,KAAK,KAAK,0BAA0B,CAAC,SAAS,EAAE,CAAC;gBACrF,IAAI,CAAC,gBAAgB,GAAI,aAAmC,CAAC,kBAAkB,CAAC,GAAG,EAAE;oBACpF,IAAI,CAAC,gBAAgB,EAAE,OAAO,EAAE,CAAC;oBACjC,IAAI,CAAC,gBAAgB,GAAG,SAAS,CAAC;oBAClC,IAAI,CAAC,aAAa,EAAE,OAAO,EAAE,CAAC;oBAC9B,IAAI,CAAC,aAAa,GAAG,KAAK,CAAC;gBAC5B,CAAC,CAAC,CAAC;gBACH,IAAI,CAAC,aAAa,GAAG,IAAI,CAAC,WAAW,CAAC,CAAC,WAAW,EAAE,EAAE;oBACrD,IAAI,WAAW,CAAC,SAAS,GAAG,WAAW,CAAC,YAAY,EAAE,CAAC;wBACtD,IAAI,CAAC,aAAa,GAAG,IAAI,CAAC;wBAC1B,IAAI,CAAC,aAAa,EAAE,OAAO,EAAE,CAAC;oBAC/B,CAAC;gBACF,CAAC,CAAC,CAAC;YACJ,CAAC;QACF,CAAC;IACF,CAAC;IAED,OAAO;QACN,IAAI,CAAC,gBAAgB,EAAE,OAAO,EAAE,CAAC;QACjC,IAAI,CAAC,aAAa,EAAE,OAAO,EAAE,CAAC;IAC/B,CAAC;CACD","file":"notebookCellAnchor.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { IDisposable } from '../../../../../base/common/lifecycle.js';\nimport { CellFocusMode, ICellViewModel } from '../notebookBrowser.js';\nimport { CodeCellViewModel } from '../viewModel/codeCellViewModel.js';\nimport { CellKind, NotebookCellExecutionState, NotebookSetting } from '../../common/notebookCommon.js';\nimport { INotebookExecutionStateService } from '../../common/notebookExecutionStateService.js';\nimport { Event } from '../../../../../base/common/event.js';\nimport { ScrollEvent } from '../../../../../base/common/scrollable.js';\nimport { IConfigurationService } from '../../../../../platform/configuration/common/configuration.js';\nimport { IListView } from '../../../../../base/browser/ui/list/listView.js';\nimport { CellViewModel } from '../viewModel/notebookViewModelImpl.js';\n\n\nexport class NotebookCellAnchor implements IDisposable {\n\n\tprivate stopAnchoring = false;\n\tprivate executionWatcher: IDisposable | undefined;\n\tprivate scrollWatcher: IDisposable | undefined;\n\n\tconstructor(\n\t\tprivate readonly notebookExecutionStateService: INotebookExecutionStateService,\n\t\tprivate readonly configurationService: IConfigurationService,\n\t\tprivate readonly scrollEvent: Event<ScrollEvent>) {\n\t}\n\n\tpublic shouldAnchor(cellListView: IListView<CellViewModel>, focusedIndex: number, heightDelta: number, executingCellUri: ICellViewModel) {\n\t\tif (cellListView.element(focusedIndex).focusMode === CellFocusMode.Editor) {\n\t\t\treturn true;\n\t\t}\n\t\tif (this.stopAnchoring) {\n\t\t\treturn false;\n\t\t}\n\n\t\tconst newFocusBottom = cellListView.elementTop(focusedIndex) + cellListView.elementHeight(focusedIndex) + heightDelta;\n\t\tconst viewBottom = cellListView.renderHeight + cellListView.getScrollTop();\n\t\tconst focusStillVisible = viewBottom > newFocusBottom;\n\t\tconst allowScrolling = this.configurationService.getValue(NotebookSetting.scrollToRevealCell) !== 'none';\n\t\tconst growing = heightDelta > 0;\n\t\tconst autoAnchor = allowScrolling && growing && !focusStillVisible;\n\n\t\tif (autoAnchor) {\n\t\t\tthis.watchAchorDuringExecution(executingCellUri);\n\t\t\treturn true;\n\t\t}\n\n\t\treturn false;\n\t}\n\n\tpublic watchAchorDuringExecution(executingCell: ICellViewModel) {\n\t\t// anchor while the cell is executing unless the user scrolls up.\n\t\tif (!this.executionWatcher && executingCell.cellKind === CellKind.Code) {\n\t\t\tconst executionState = this.notebookExecutionStateService.getCellExecution(executingCell.uri);\n\t\t\tif (executionState && executionState.state === NotebookCellExecutionState.Executing) {\n\t\t\t\tthis.executionWatcher = (executingCell as CodeCellViewModel).onDidStopExecution(() => {\n\t\t\t\t\tthis.executionWatcher?.dispose();\n\t\t\t\t\tthis.executionWatcher = undefined;\n\t\t\t\t\tthis.scrollWatcher?.dispose();\n\t\t\t\t\tthis.stopAnchoring = false;\n\t\t\t\t});\n\t\t\t\tthis.scrollWatcher = this.scrollEvent((scrollEvent) => {\n\t\t\t\t\tif (scrollEvent.scrollTop < scrollEvent.oldScrollTop) {\n\t\t\t\t\t\tthis.stopAnchoring = true;\n\t\t\t\t\t\tthis.scrollWatcher?.dispose();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n\n\tdispose(): void {\n\t\tthis.executionWatcher?.dispose();\n\t\tthis.scrollWatcher?.dispose();\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { IDisposable } from '../../../../../base/common/lifecycle.js';\nimport { CellFocusMode, ICellViewModel } from '../notebookBrowser.js';\nimport { CodeCellViewModel } from '../viewModel/codeCellViewModel.js';\nimport { CellKind, NotebookCellExecutionState, NotebookSetting } from '../../common/notebookCommon.js';\nimport { INotebookExecutionStateService } from '../../common/notebookExecutionStateService.js';\nimport { Event } from '../../../../../base/common/event.js';\nimport { ScrollEvent } from '../../../../../base/common/scrollable.js';\nimport { IConfigurationService } from '../../../../../platform/configuration/common/configuration.js';\nimport { IListView } from '../../../../../base/browser/ui/list/listView.js';\nimport { CellViewModel } from '../viewModel/notebookViewModelImpl.js';\n\n\nexport class NotebookCellAnchor implements IDisposable {\n\n\tprivate stopAnchoring = false;\n\tprivate executionWatcher: IDisposable | undefined;\n\tprivate scrollWatcher: IDisposable | undefined;\n\n\tconstructor(\n\t\tprivate readonly notebookExecutionStateService: INotebookExecutionStateService,\n\t\tprivate readonly configurationService: IConfigurationService,\n\t\tprivate readonly scrollEvent: Event<ScrollEvent>) {\n\t}\n\n\tpublic shouldAnchor(cellListView: IListView<CellViewModel>, focusedIndex: number, heightDelta: number, executingCellUri: ICellViewModel) {\n\t\tif (cellListView.element(focusedIndex).focusMode === CellFocusMode.Editor) {\n\t\t\treturn true;\n\t\t}\n\t\tif (this.stopAnchoring) {\n\t\t\treturn false;\n\t\t}\n\n\t\tconst newFocusBottom = cellListView.elementTop(focusedIndex) + cellListView.elementHeight(focusedIndex) + heightDelta;\n\t\tconst viewBottom = cellListView.renderHeight + cellListView.getScrollTop();\n\t\tconst focusStillVisible = viewBottom > newFocusBottom;\n\t\tconst allowScrolling = this.configurationService.getValue(NotebookSetting.scrollToRevealCell) !== 'none';\n\t\tconst growing = heightDelta > 0;\n\t\tconst autoAnchor = allowScrolling && growing && !focusStillVisible;\n\n\t\tif (autoAnchor) {\n\t\t\tthis.watchAchorDuringExecution(executingCellUri);\n\t\t\treturn true;\n\t\t}\n\n\t\treturn false;\n\t}\n\n\tpublic watchAchorDuringExecution(executingCell: ICellViewModel) {\n\t\t// anchor while the cell is executing unless the user scrolls up.\n\t\tif (!this.executionWatcher && executingCell.cellKind === CellKind.Code) {\n\t\t\tconst executionState = this.notebookExecutionStateService.getCellExecution(executingCell.uri);\n\t\t\tif (executionState && executionState.state === NotebookCellExecutionState.Executing) {\n\t\t\t\tthis.executionWatcher = (executingCell as CodeCellViewModel).onDidStopExecution(() => {\n\t\t\t\t\tthis.executionWatcher?.dispose();\n\t\t\t\t\tthis.executionWatcher = undefined;\n\t\t\t\t\tthis.scrollWatcher?.dispose();\n\t\t\t\t\tthis.stopAnchoring = false;\n\t\t\t\t});\n\t\t\t\tthis.scrollWatcher = this.scrollEvent((scrollEvent) => {\n\t\t\t\t\tif (scrollEvent.scrollTop < scrollEvent.oldScrollTop) {\n\t\t\t\t\t\tthis.stopAnchoring = true;\n\t\t\t\t\t\tthis.scrollWatcher?.dispose();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n\n\tdispose(): void {\n\t\tthis.executionWatcher?.dispose();\n\t\tthis.scrollWatcher?.dispose();\n\t}\n}\n"]}