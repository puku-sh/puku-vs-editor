{"version":3,"sources":["vs/workbench/contrib/notebook/browser/viewParts/notebookViewZones.ts"],"names":[],"mappings":"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","file":"notebookViewZones.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { FastDomNode, createFastDomNode } from '../../../../../base/browser/fastDomNode.js';\nimport { onUnexpectedError } from '../../../../../base/common/errors.js';\nimport { Disposable } from '../../../../../base/common/lifecycle.js';\nimport { ServicesAccessor } from '../../../../../editor/browser/editorExtensions.js';\nimport { localize2 } from '../../../../../nls.js';\nimport { Categories } from '../../../../../platform/action/common/actionCommonCategories.js';\nimport { Action2, registerAction2 } from '../../../../../platform/actions/common/actions.js';\nimport { IsDevelopmentContext } from '../../../../../platform/contextkey/common/contextkeys.js';\nimport { IEditorService } from '../../../../services/editor/common/editorService.js';\nimport { getNotebookEditorFromEditorPane, INotebookViewCellsUpdateEvent, INotebookViewZone, INotebookViewZoneChangeAccessor } from '../notebookBrowser.js';\nimport { NotebookCellListView } from '../view/notebookCellListView.js';\nimport { ICoordinatesConverter } from '../view/notebookRenderingCommon.js';\nimport { CellViewModel } from '../viewModel/notebookViewModelImpl.js';\n\nconst invalidFunc = () => { throw new Error(`Invalid notebook view zone change accessor`); };\n\ninterface IZoneWidget {\n\twhitespaceId: string;\n\tisInHiddenArea: boolean;\n\tzone: INotebookViewZone;\n\tdomNode: FastDomNode<HTMLElement>;\n}\n\nexport class NotebookViewZones extends Disposable {\n\tprivate _zones: { [key: string]: IZoneWidget };\n\tpublic domNode: FastDomNode<HTMLElement>;\n\n\tconstructor(private readonly listView: NotebookCellListView<CellViewModel>, private readonly coordinator: ICoordinatesConverter) {\n\t\tsuper();\n\t\tthis.domNode = createFastDomNode(document.createElement('div'));\n\t\tthis.domNode.setClassName('view-zones');\n\t\tthis.domNode.setPosition('absolute');\n\t\tthis.domNode.setAttribute('role', 'presentation');\n\t\tthis.domNode.setAttribute('aria-hidden', 'true');\n\t\tthis.domNode.setWidth('100%');\n\t\tthis._zones = {};\n\n\t\tthis.listView.containerDomNode.appendChild(this.domNode.domNode);\n\t}\n\n\tchangeViewZones(callback: (changeAccessor: INotebookViewZoneChangeAccessor) => void): boolean {\n\t\tlet zonesHaveChanged = false;\n\t\tconst changeAccessor: INotebookViewZoneChangeAccessor = {\n\t\t\taddZone: (zone: INotebookViewZone): string => {\n\t\t\t\tzonesHaveChanged = true;\n\t\t\t\treturn this._addZone(zone);\n\t\t\t},\n\t\t\tremoveZone: (id: string): void => {\n\t\t\t\tzonesHaveChanged = true;\n\t\t\t\t// TODO: validate if zones have changed layout\n\t\t\t\tthis._removeZone(id);\n\t\t\t},\n\t\t\tlayoutZone: (id: string): void => {\n\t\t\t\tzonesHaveChanged = true;\n\t\t\t\t// TODO: validate if zones have changed layout\n\t\t\t\tthis._layoutZone(id);\n\t\t\t}\n\t\t};\n\n\t\tsafeInvoke1Arg(callback, changeAccessor);\n\n\t\t// Invalidate changeAccessor\n\t\tchangeAccessor.addZone = invalidFunc;\n\t\tchangeAccessor.removeZone = invalidFunc;\n\t\tchangeAccessor.layoutZone = invalidFunc;\n\n\t\treturn zonesHaveChanged;\n\t}\n\n\tgetViewZoneLayoutInfo(viewZoneId: string): { height: number; top: number } | null {\n\t\tconst zoneWidget = this._zones[viewZoneId];\n\t\tif (!zoneWidget) {\n\t\t\treturn null;\n\t\t}\n\t\tconst top = this.listView.getWhitespacePosition(zoneWidget.whitespaceId);\n\t\tconst height = zoneWidget.zone.heightInPx;\n\t\treturn { height: height, top: top };\n\t}\n\n\tonCellsChanged(e: INotebookViewCellsUpdateEvent): void {\n\t\tconst splices = e.splices.slice().reverse();\n\t\tsplices.forEach(splice => {\n\t\t\tconst [start, deleted, newCells] = splice;\n\t\t\tconst fromIndex = start;\n\t\t\tconst toIndex = start + deleted;\n\n\t\t\t// 1, 2, 0\n\t\t\t// delete cell index 1 and 2\n\t\t\t// from index 1, to index 3 (exclusive): [1, 3)\n\t\t\t// if we have whitespace afterModelPosition 3, which is after cell index 2\n\n\t\t\tfor (const id in this._zones) {\n\t\t\t\tconst zone = this._zones[id].zone;\n\n\t\t\t\tconst cellBeforeWhitespaceIndex = zone.afterModelPosition - 1;\n\n\t\t\t\tif (cellBeforeWhitespaceIndex >= fromIndex && cellBeforeWhitespaceIndex < toIndex) {\n\t\t\t\t\t// The cell this whitespace was after has been deleted\n\t\t\t\t\t//  => move whitespace to before first deleted cell\n\t\t\t\t\tzone.afterModelPosition = fromIndex;\n\t\t\t\t\tthis._updateWhitespace(this._zones[id]);\n\t\t\t\t} else if (cellBeforeWhitespaceIndex >= toIndex) {\n\t\t\t\t\t// adjust afterModelPosition for all other cells\n\t\t\t\t\tconst insertLength = newCells.length;\n\t\t\t\t\tconst offset = insertLength - deleted;\n\t\t\t\t\tzone.afterModelPosition += offset;\n\t\t\t\t\tthis._updateWhitespace(this._zones[id]);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\tonHiddenRangesChange() {\n\t\tfor (const id in this._zones) {\n\t\t\tthis._updateWhitespace(this._zones[id]);\n\t\t}\n\t}\n\n\tprivate _updateWhitespace(zone: IZoneWidget) {\n\t\tconst whitespaceId = zone.whitespaceId;\n\t\tconst viewPosition = this.coordinator.convertModelIndexToViewIndex(zone.zone.afterModelPosition);\n\t\tconst isInHiddenArea = this._isInHiddenRanges(zone.zone);\n\t\tzone.isInHiddenArea = isInHiddenArea;\n\t\tthis.listView.changeOneWhitespace(whitespaceId, viewPosition, isInHiddenArea ? 0 : zone.zone.heightInPx);\n\t}\n\n\tlayout() {\n\t\tfor (const id in this._zones) {\n\t\t\tthis._layoutZone(id);\n\t\t}\n\t}\n\n\tprivate _addZone(zone: INotebookViewZone): string {\n\t\tconst viewPosition = this.coordinator.convertModelIndexToViewIndex(zone.afterModelPosition);\n\t\tconst whitespaceId = this.listView.insertWhitespace(viewPosition, zone.heightInPx);\n\t\tconst isInHiddenArea = this._isInHiddenRanges(zone);\n\t\tconst myZone: IZoneWidget = {\n\t\t\twhitespaceId: whitespaceId,\n\t\t\tzone: zone,\n\t\t\tdomNode: createFastDomNode(zone.domNode),\n\t\t\tisInHiddenArea: isInHiddenArea\n\t\t};\n\n\t\tthis._zones[whitespaceId] = myZone;\n\t\tmyZone.domNode.setPosition('absolute');\n\t\tmyZone.domNode.domNode.style.width = '100%';\n\t\tmyZone.domNode.setDisplay('none');\n\t\tmyZone.domNode.setAttribute('notebook-view-zone', whitespaceId);\n\t\tthis.domNode.appendChild(myZone.domNode);\n\t\treturn whitespaceId;\n\t}\n\n\tprivate _removeZone(id: string): void {\n\t\tthis.listView.removeWhitespace(id);\n\t\tconst zoneWidget = this._zones[id];\n\t\tif (zoneWidget) {\n\t\t\t// safely remove the dom node from its parent\n\t\t\ttry {\n\t\t\t\tthis.domNode.removeChild(zoneWidget.domNode);\n\t\t\t} catch {\n\t\t\t\t// ignore the error\n\t\t\t}\n\t\t}\n\n\t\tdelete this._zones[id];\n\t}\n\n\tprivate _layoutZone(id: string): void {\n\t\tconst zoneWidget = this._zones[id];\n\t\tif (!zoneWidget) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._updateWhitespace(this._zones[id]);\n\n\t\tconst isInHiddenArea = this._isInHiddenRanges(zoneWidget.zone);\n\n\t\tif (isInHiddenArea) {\n\t\t\tzoneWidget.domNode.setDisplay('none');\n\t\t} else {\n\t\t\tconst top = this.listView.getWhitespacePosition(zoneWidget.whitespaceId);\n\t\t\tzoneWidget.domNode.setTop(top);\n\t\t\tzoneWidget.domNode.setDisplay('block');\n\t\t\tzoneWidget.domNode.setHeight(zoneWidget.zone.heightInPx);\n\t\t}\n\t}\n\n\tprivate _isInHiddenRanges(zone: INotebookViewZone) {\n\t\t// The view zone is between two cells (zone.afterModelPosition - 1, zone.afterModelPosition)\n\t\tconst afterIndex = zone.afterModelPosition;\n\n\t\t// In notebook, the first cell (markdown cell) in a folding range is always visible, so we need to check the cell after the notebook view zone\n\t\treturn !this.coordinator.modelIndexIsVisible(afterIndex);\n\n\t}\n\n\toverride dispose(): void {\n\t\tsuper.dispose();\n\t\tthis._zones = {};\n\t}\n}\n\nfunction safeInvoke1Arg(func: Function, arg1: any): void {\n\ttry {\n\t\tfunc(arg1);\n\t} catch (e) {\n\t\tonUnexpectedError(e);\n\t}\n}\n\nclass ToggleNotebookViewZoneDeveloperAction extends Action2 {\n\tstatic viewZoneIds: string[] = [];\n\tconstructor() {\n\t\tsuper({\n\t\t\tid: 'notebook.developer.addViewZones',\n\t\t\ttitle: localize2('workbench.notebook.developer.addViewZones', \"Toggle Notebook View Zones\"),\n\t\t\tcategory: Categories.Developer,\n\t\t\tprecondition: IsDevelopmentContext,\n\t\t\tf1: true\n\t\t});\n\t}\n\n\tasync run(accessor: ServicesAccessor): Promise<void> {\n\t\tconst editorService = accessor.get(IEditorService);\n\t\tconst editor = getNotebookEditorFromEditorPane(editorService.activeEditorPane);\n\n\t\tif (!editor) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (ToggleNotebookViewZoneDeveloperAction.viewZoneIds.length > 0) {\n\t\t\t// remove all view zones\n\t\t\teditor.changeViewZones(accessor => {\n\t\t\t\t// remove all view zones in reverse order, to follow how we handle this in the prod code\n\t\t\t\tToggleNotebookViewZoneDeveloperAction.viewZoneIds.reverse().forEach(id => {\n\t\t\t\t\taccessor.removeZone(id);\n\t\t\t\t});\n\t\t\t\tToggleNotebookViewZoneDeveloperAction.viewZoneIds = [];\n\t\t\t});\n\t\t} else {\n\t\t\teditor.changeViewZones(accessor => {\n\t\t\t\tconst cells = editor.getCellsInRange();\n\t\t\t\tif (cells.length === 0) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst viewZoneIds: string[] = [];\n\t\t\t\tfor (let i = 0; i < cells.length; i++) {\n\t\t\t\t\tconst domNode = document.createElement('div');\n\t\t\t\t\tdomNode.innerText = `View Zone ${i}`;\n\t\t\t\t\tdomNode.style.backgroundColor = 'rgba(0, 255, 0, 0.5)';\n\t\t\t\t\tconst viewZoneId = accessor.addZone({\n\t\t\t\t\t\tafterModelPosition: i,\n\t\t\t\t\t\theightInPx: 200,\n\t\t\t\t\t\tdomNode: domNode,\n\t\t\t\t\t});\n\t\t\t\t\tviewZoneIds.push(viewZoneId);\n\t\t\t\t}\n\t\t\t\tToggleNotebookViewZoneDeveloperAction.viewZoneIds = viewZoneIds;\n\t\t\t});\n\t\t}\n\t}\n}\n\nregisterAction2(ToggleNotebookViewZoneDeveloperAction);\n"]}