{"version":3,"sources":["vs/workbench/contrib/notebook/browser/view/renderers/backLayerWebView.ts"],"names":[],"mappings":"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","file":"backLayerWebView.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { getWindow } from '../../../../../../base/browser/dom.js';\nimport { IMouseWheelEvent } from '../../../../../../base/browser/mouseEvent.js';\nimport { CodeWindow } from '../../../../../../base/browser/window.js';\nimport { WorkbenchActionExecutedClassification, WorkbenchActionExecutedEvent } from '../../../../../../base/common/actions.js';\nimport { coalesce } from '../../../../../../base/common/arrays.js';\nimport { DeferredPromise, runWhenGlobalIdle } from '../../../../../../base/common/async.js';\nimport { decodeBase64 } from '../../../../../../base/common/buffer.js';\nimport { Emitter, Event } from '../../../../../../base/common/event.js';\nimport { IDisposable } from '../../../../../../base/common/lifecycle.js';\nimport { getExtensionForMimeType, isTextStreamMime } from '../../../../../../base/common/mime.js';\nimport { FileAccess, Schemas, matchesScheme, matchesSomeScheme } from '../../../../../../base/common/network.js';\nimport { equals } from '../../../../../../base/common/objects.js';\nimport * as osPath from '../../../../../../base/common/path.js';\nimport { isMacintosh, isWeb } from '../../../../../../base/common/platform.js';\nimport { dirname, extname, isEqual, joinPath } from '../../../../../../base/common/resources.js';\nimport { URI } from '../../../../../../base/common/uri.js';\nimport * as UUID from '../../../../../../base/common/uuid.js';\nimport { TokenizationRegistry } from '../../../../../../editor/common/languages.js';\nimport { ILanguageService } from '../../../../../../editor/common/languages/language.js';\nimport { generateTokensCSSForColorMap } from '../../../../../../editor/common/languages/supports/tokenization.js';\nimport { tokenizeToString } from '../../../../../../editor/common/languages/textToHtmlTokenizer.js';\nimport * as nls from '../../../../../../nls.js';\nimport { MenuId } from '../../../../../../platform/actions/common/actions.js';\nimport { IConfigurationService } from '../../../../../../platform/configuration/common/configuration.js';\nimport { IContextKeyService } from '../../../../../../platform/contextkey/common/contextkey.js';\nimport { IContextMenuService } from '../../../../../../platform/contextview/browser/contextView.js';\nimport { IFileDialogService } from '../../../../../../platform/dialogs/common/dialogs.js';\nimport { ITextEditorOptions, ITextEditorSelection } from '../../../../../../platform/editor/common/editor.js';\nimport { IFileService } from '../../../../../../platform/files/common/files.js';\nimport { IOpenerService } from '../../../../../../platform/opener/common/opener.js';\nimport { IStorageService } from '../../../../../../platform/storage/common/storage.js';\nimport { ITelemetryService } from '../../../../../../platform/telemetry/common/telemetry.js';\nimport { editorFindMatch, editorFindMatchHighlight } from '../../../../../../platform/theme/common/colorRegistry.js';\nimport { IThemeService, Themable } from '../../../../../../platform/theme/common/themeService.js';\nimport { IWorkspaceContextService } from '../../../../../../platform/workspace/common/workspace.js';\nimport { IWorkspaceTrustManagementService } from '../../../../../../platform/workspace/common/workspaceTrust.js';\nimport { EditorInput } from '../../../../../common/editor/editorInput.js';\nimport { CellEditState, ICellOutputViewModel, ICellViewModel, ICommonCellInfo, IDisplayOutputLayoutUpdateRequest, IDisplayOutputViewModel, IFocusNotebookCellOptions, IGenericCellViewModel, IInsetRenderOutput, INotebookEditorCreationOptions, INotebookWebviewMessage, RenderOutputType } from '../../notebookBrowser.js';\nimport { NOTEBOOK_WEBVIEW_BOUNDARY } from '../notebookCellList.js';\nimport { preloadsScriptStr } from './webviewPreloads.js';\nimport { transformWebviewThemeVars } from './webviewThemeMapping.js';\nimport { MarkupCellViewModel } from '../../viewModel/markupCellViewModel.js';\nimport { CellUri, ICellOutput, INotebookRendererInfo, RendererMessagingSpec } from '../../../common/notebookCommon.js';\nimport { INotebookKernel } from '../../../common/notebookKernelService.js';\nimport { INotebookLoggingService } from '../../../common/notebookLoggingService.js';\nimport { IScopedRendererMessaging } from '../../../common/notebookRendererMessagingService.js';\nimport { INotebookService } from '../../../common/notebookService.js';\nimport { IWebviewElement, IWebviewService, WebviewContentPurpose, WebviewOriginStore } from '../../../../webview/browser/webview.js';\nimport { WebviewWindowDragMonitor } from '../../../../webview/browser/webviewWindowDragMonitor.js';\nimport { asWebviewUri, webviewGenericCspSource } from '../../../../webview/common/webview.js';\nimport { IEditorGroup, IEditorGroupsService } from '../../../../../services/editor/common/editorGroupsService.js';\nimport { IWorkbenchEnvironmentService } from '../../../../../services/environment/common/environmentService.js';\nimport { IPathService } from '../../../../../services/path/common/pathService.js';\nimport { FromWebviewMessage, IAckOutputHeight, IClickedDataUrlMessage, ICodeBlockHighlightRequest, IContentWidgetTopRequest, IControllerPreload, ICreationContent, ICreationRequestMessage, IFindMatch, IMarkupCellInitialization, RendererMetadata, StaticPreloadMetadata, ToWebviewMessage } from './webviewMessages.js';\nimport { getOutputText, getOutputStreamText, TEXT_BASED_MIMETYPES } from '../../viewModel/cellOutputTextHelper.js';\n\nconst LINE_COLUMN_REGEX = /:([\\d]+)(?::([\\d]+))?$/;\nconst LineQueryRegex = /line=(\\d+)$/;\nconst FRAGMENT_REGEX = /^(.*)#([^#]*)$/;\n\nexport interface ICachedInset<K extends ICommonCellInfo> {\n\toutputId: string;\n\tversionId: number;\n\tcellInfo: K;\n\trenderer?: INotebookRendererInfo;\n\tcachedCreation: ICreationRequestMessage;\n\tinitialized?: boolean;\n}\n\nexport interface IResolvedBackLayerWebview {\n\twebview: IWebviewElement;\n}\n\n/**\n * Notebook Editor Delegate for back layer webview\n */\nexport interface INotebookDelegateForWebview {\n\treadonly creationOptions: INotebookEditorCreationOptions;\n\tgetCellById(cellId: string): IGenericCellViewModel | undefined;\n\tfocusNotebookCell(cell: IGenericCellViewModel, focus: 'editor' | 'container' | 'output', options?: IFocusNotebookCellOptions): Promise<void>;\n\ttoggleNotebookCellSelection(cell: IGenericCellViewModel, selectFromPrevious: boolean): void;\n\tgetCellByInfo(cellInfo: ICommonCellInfo): IGenericCellViewModel;\n\tfocusNextNotebookCell(cell: IGenericCellViewModel, focus: 'editor' | 'container' | 'output'): Promise<void>;\n\tupdateOutputHeight(cellInfo: ICommonCellInfo, output: IDisplayOutputViewModel, height: number, isInit: boolean, source?: string): void;\n\tscheduleOutputHeightAck(cellInfo: ICommonCellInfo, outputId: string, height: number): void;\n\tupdateMarkupCellHeight(cellId: string, height: number, isInit: boolean): void;\n\tsetMarkupCellEditState(cellId: string, editState: CellEditState): void;\n\tdidStartDragMarkupCell(cellId: string, event: { dragOffsetY: number }): void;\n\tdidDragMarkupCell(cellId: string, event: { dragOffsetY: number }): void;\n\tdidDropMarkupCell(cellId: string, event: { dragOffsetY: number; ctrlKey: boolean; altKey: boolean }): void;\n\tdidEndDragMarkupCell(cellId: string): void;\n\tdidResizeOutput(cellId: string): void;\n\tsetScrollTop(scrollTop: number): void;\n\ttriggerScroll(event: IMouseWheelEvent): void;\n\tupdatePerformanceMetadata(cellId: string, executionId: string, duration: number, rendererId: string): void;\n\tdidFocusOutputInputChange(inputFocused: boolean): void;\n}\n\ninterface BacklayerWebviewOptions {\n\treadonly outputNodePadding: number;\n\treadonly outputNodeLeftPadding: number;\n\treadonly previewNodePadding: number;\n\treadonly markdownLeftMargin: number;\n\treadonly leftMargin: number;\n\treadonly rightMargin: number;\n\treadonly runGutter: number;\n\treadonly dragAndDropEnabled: boolean;\n\treadonly fontSize: number;\n\treadonly outputFontSize: number;\n\treadonly fontFamily: string;\n\treadonly outputFontFamily: string;\n\treadonly markupFontSize: number;\n\treadonly markdownLineHeight: number;\n\treadonly outputLineHeight: number;\n\treadonly outputScrolling: boolean;\n\treadonly outputWordWrap: boolean;\n\treadonly outputLineLimit: number;\n\treadonly outputLinkifyFilePaths: boolean;\n\treadonly minimalError: boolean;\n\treadonly markupFontFamily: string;\n}\n\n\nexport class BackLayerWebView<T extends ICommonCellInfo> extends Themable {\n\n\tprivate static _originStore?: WebviewOriginStore;\n\n\tprivate static getOriginStore(storageService: IStorageService): WebviewOriginStore {\n\t\tthis._originStore ??= new WebviewOriginStore('notebook.backlayerWebview.origins', storageService);\n\t\treturn this._originStore;\n\t}\n\n\telement: HTMLElement;\n\twebview: IWebviewElement | undefined = undefined;\n\tinsetMapping: Map<IDisplayOutputViewModel, ICachedInset<T>> = new Map();\n\tpendingWebviewIdleCreationRequest: Map<IDisplayOutputViewModel, IDisposable> = new Map();\n\tpendingWebviewIdleInsetMapping: Map<IDisplayOutputViewModel, ICachedInset<T>> = new Map();\n\tprivate reversedPendingWebviewIdleInsetMapping: Map<string, IDisplayOutputViewModel> = new Map();\n\n\treadonly markupPreviewMapping = new Map<string, IMarkupCellInitialization>();\n\tprivate hiddenInsetMapping: Set<IDisplayOutputViewModel> = new Set();\n\tprivate reversedInsetMapping: Map<string, IDisplayOutputViewModel> = new Map();\n\tprivate localResourceRootsCache: URI[] | undefined = undefined;\n\tprivate readonly _onMessage = this._register(new Emitter<INotebookWebviewMessage>());\n\tprivate readonly _preloadsCache = new Set<string>();\n\tpublic readonly onMessage: Event<INotebookWebviewMessage> = this._onMessage.event;\n\tprivate _disposed = false;\n\tprivate _currentKernel?: INotebookKernel;\n\n\tprivate firstInit = true;\n\tprivate initializeMarkupPromise?: { readonly requestId: string; readonly p: DeferredPromise<void>; readonly isFirstInit: boolean };\n\n\tprivate readonly nonce = UUID.generateUuid();\n\n\tconstructor(\n\t\tpublic notebookEditor: INotebookDelegateForWebview,\n\t\tprivate readonly id: string,\n\t\tpublic readonly notebookViewType: string,\n\t\tpublic readonly documentUri: URI,\n\t\tprivate options: BacklayerWebviewOptions,\n\t\tprivate readonly rendererMessaging: IScopedRendererMessaging | undefined,\n\t\t@IWebviewService private readonly webviewService: IWebviewService,\n\t\t@IOpenerService private readonly openerService: IOpenerService,\n\t\t@INotebookService private readonly notebookService: INotebookService,\n\t\t@IWorkspaceContextService private readonly contextService: IWorkspaceContextService,\n\t\t@IWorkbenchEnvironmentService private readonly environmentService: IWorkbenchEnvironmentService,\n\t\t@IFileDialogService private readonly fileDialogService: IFileDialogService,\n\t\t@IFileService private readonly fileService: IFileService,\n\t\t@IContextMenuService private readonly contextMenuService: IContextMenuService,\n\t\t@IContextKeyService private readonly contextKeyService: IContextKeyService,\n\t\t@IWorkspaceTrustManagementService private readonly workspaceTrustManagementService: IWorkspaceTrustManagementService,\n\t\t@IConfigurationService private readonly configurationService: IConfigurationService,\n\t\t@ILanguageService private readonly languageService: ILanguageService,\n\t\t@IWorkspaceContextService private readonly workspaceContextService: IWorkspaceContextService,\n\t\t@IEditorGroupsService private readonly editorGroupService: IEditorGroupsService,\n\t\t@IStorageService private readonly storageService: IStorageService,\n\t\t@IPathService private readonly pathService: IPathService,\n\t\t@INotebookLoggingService private readonly notebookLogService: INotebookLoggingService,\n\t\t@IThemeService themeService: IThemeService,\n\t\t@ITelemetryService private readonly telemetryService: ITelemetryService\n\t) {\n\t\tsuper(themeService);\n\n\t\tthis._logRendererDebugMessage('Creating backlayer webview for notebook');\n\n\t\tthis.element = document.createElement('div');\n\n\t\tthis.element.style.height = '1400px';\n\t\tthis.element.style.position = 'absolute';\n\n\t\tif (rendererMessaging) {\n\t\t\tthis._register(rendererMessaging);\n\t\t\trendererMessaging.receiveMessageHandler = (rendererId, message) => {\n\t\t\t\tif (!this.webview || this._disposed) {\n\t\t\t\t\treturn Promise.resolve(false);\n\t\t\t\t}\n\n\t\t\t\tthis._sendMessageToWebview({\n\t\t\t\t\t__vscode_notebook_message: true,\n\t\t\t\t\ttype: 'customRendererMessage',\n\t\t\t\t\trendererId: rendererId,\n\t\t\t\t\tmessage: message\n\t\t\t\t});\n\n\t\t\t\treturn Promise.resolve(true);\n\t\t\t};\n\t\t}\n\n\t\tthis._register(workspaceTrustManagementService.onDidChangeTrust(e => {\n\t\t\tconst baseUrl = this.asWebviewUri(this.getNotebookBaseUri(), undefined);\n\t\t\tconst htmlContent = this.generateContent(baseUrl.toString());\n\t\t\tthis.webview?.setHtml(htmlContent);\n\t\t}));\n\n\t\tthis._register(TokenizationRegistry.onDidChange(() => {\n\t\t\tthis._sendMessageToWebview({\n\t\t\t\ttype: 'tokenizedStylesChanged',\n\t\t\t\tcss: getTokenizationCss(),\n\t\t\t});\n\t\t}));\n\t}\n\n\tupdateOptions(options: BacklayerWebviewOptions) {\n\t\tthis.options = options;\n\t\tthis._updateStyles();\n\t\tthis._updateOptions();\n\t}\n\n\tprivate _logRendererDebugMessage(msg: string) {\n\t\tthis.notebookLogService.debug('BacklayerWebview', `${this.documentUri} (${this.id}) - ${msg}`);\n\t}\n\n\tprivate _updateStyles() {\n\t\tthis._sendMessageToWebview({\n\t\t\ttype: 'notebookStyles',\n\t\t\tstyles: this._generateStyles()\n\t\t});\n\t}\n\n\tprivate _updateOptions() {\n\t\tthis._sendMessageToWebview({\n\t\t\ttype: 'notebookOptions',\n\t\t\toptions: {\n\t\t\t\tdragAndDropEnabled: this.options.dragAndDropEnabled\n\t\t\t},\n\t\t\trenderOptions: {\n\t\t\t\tlineLimit: this.options.outputLineLimit,\n\t\t\t\toutputScrolling: this.options.outputScrolling,\n\t\t\t\toutputWordWrap: this.options.outputWordWrap,\n\t\t\t\tlinkifyFilePaths: this.options.outputLinkifyFilePaths,\n\t\t\t\tminimalError: this.options.minimalError\n\t\t\t}\n\t\t});\n\t}\n\n\tprivate _generateStyles() {\n\t\treturn {\n\t\t\t'notebook-output-left-margin': `${this.options.leftMargin + this.options.runGutter}px`,\n\t\t\t'notebook-output-width': `calc(100% - ${this.options.leftMargin + this.options.rightMargin + this.options.runGutter}px)`,\n\t\t\t'notebook-output-node-padding': `${this.options.outputNodePadding}px`,\n\t\t\t'notebook-run-gutter': `${this.options.runGutter}px`,\n\t\t\t'notebook-preview-node-padding': `${this.options.previewNodePadding}px`,\n\t\t\t'notebook-markdown-left-margin': `${this.options.markdownLeftMargin}px`,\n\t\t\t'notebook-output-node-left-padding': `${this.options.outputNodeLeftPadding}px`,\n\t\t\t'notebook-markdown-min-height': `${this.options.previewNodePadding * 2}px`,\n\t\t\t'notebook-markup-font-size': typeof this.options.markupFontSize === 'number' && this.options.markupFontSize > 0 ? `${this.options.markupFontSize}px` : `calc(${this.options.fontSize}px * 1.2)`,\n\t\t\t'notebook-markdown-line-height': typeof this.options.markdownLineHeight === 'number' && this.options.markdownLineHeight > 0 ? `${this.options.markdownLineHeight}px` : `normal`,\n\t\t\t'notebook-cell-output-font-size': `${this.options.outputFontSize || this.options.fontSize}px`,\n\t\t\t'notebook-cell-output-line-height': `${this.options.outputLineHeight}px`,\n\t\t\t'notebook-cell-output-max-height': `${this.options.outputLineHeight * this.options.outputLineLimit + 2}px`,\n\t\t\t'notebook-cell-output-font-family': this.options.outputFontFamily || this.options.fontFamily,\n\t\t\t'notebook-cell-markup-empty-content': nls.localize('notebook.emptyMarkdownPlaceholder', \"Empty markdown cell, double-click or press enter to edit.\"),\n\t\t\t'notebook-cell-renderer-not-found-error': nls.localize({\n\t\t\t\tkey: 'notebook.error.rendererNotFound',\n\t\t\t\tcomment: ['$0 is a placeholder for the mime type']\n\t\t\t}, \"No renderer found for '$0'\"),\n\t\t\t'notebook-cell-renderer-fallbacks-exhausted': nls.localize({\n\t\t\t\tkey: 'notebook.error.rendererFallbacksExhausted',\n\t\t\t\tcomment: ['$0 is a placeholder for the mime type']\n\t\t\t}, \"Could not render content for '$0'\"),\n\t\t\t'notebook-markup-font-family': this.options.markupFontFamily,\n\t\t};\n\t}\n\n\tprivate generateContent(baseUrl: string) {\n\t\tconst renderersData = this.getRendererData();\n\t\tconst preloadsData = this.getStaticPreloadsData();\n\t\tconst renderOptions = {\n\t\t\tlineLimit: this.options.outputLineLimit,\n\t\t\toutputScrolling: this.options.outputScrolling,\n\t\t\toutputWordWrap: this.options.outputWordWrap,\n\t\t\tlinkifyFilePaths: this.options.outputLinkifyFilePaths,\n\t\t\tminimalError: this.options.minimalError\n\t\t};\n\t\tconst preloadScript = preloadsScriptStr(\n\t\t\t{\n\t\t\t\t...this.options,\n\t\t\t\ttokenizationCss: getTokenizationCss(),\n\t\t\t},\n\t\t\t{ dragAndDropEnabled: this.options.dragAndDropEnabled },\n\t\t\trenderOptions,\n\t\t\trenderersData,\n\t\t\tpreloadsData,\n\t\t\tthis.workspaceTrustManagementService.isWorkspaceTrusted(),\n\t\t\tthis.nonce);\n\n\t\tconst enableCsp = this.configurationService.getValue('notebook.experimental.enableCsp');\n\t\tconst currentHighlight = this.getColor(editorFindMatch);\n\t\tconst findMatchHighlight = this.getColor(editorFindMatchHighlight);\n\t\treturn /* html */`\n\t\t<html lang=\"en\">\n\t\t\t<head>\n\t\t\t\t<meta charset=\"UTF-8\">\n\t\t\t\t<base href=\"${baseUrl}/\" />\n\t\t\t\t${enableCsp ?\n\t\t\t\t`<meta http-equiv=\"Content-Security-Policy\" content=\"\n\t\t\t\t\tdefault-src 'none';\n\t\t\t\t\tscript-src ${webviewGenericCspSource} 'unsafe-inline' 'unsafe-eval';\n\t\t\t\t\tstyle-src ${webviewGenericCspSource} 'unsafe-inline';\n\t\t\t\t\timg-src ${webviewGenericCspSource} https: http: data:;\n\t\t\t\t\tfont-src ${webviewGenericCspSource} https:;\n\t\t\t\t\tconnect-src https:;\n\t\t\t\t\tchild-src https: data:;\n\t\t\t\t\">` : ''}\n\t\t\t\t<style nonce=\"${this.nonce}\">\n\t\t\t\t\t::highlight(find-highlight) {\n\t\t\t\t\t\tbackground-color: var(--vscode-editor-findMatchBackground, ${findMatchHighlight});\n\t\t\t\t\t}\n\n\t\t\t\t\t::highlight(current-find-highlight) {\n\t\t\t\t\t\tbackground-color: var(--vscode-editor-findMatchHighlightBackground, ${currentHighlight});\n\t\t\t\t\t}\n\n\t\t\t\t\t#container .cell_container {\n\t\t\t\t\t\twidth: 100%;\n\t\t\t\t\t}\n\n\t\t\t\t\t#container .output_container {\n\t\t\t\t\t\twidth: 100%;\n\t\t\t\t\t}\n\n\t\t\t\t\t#container .cell_container.nb-insertHighlight div.output_container div.output {\n\t\t\t\t\t\tbackground-color: var(--vscode-diffEditor-insertedLineBackground, var(--vscode-diffEditor-insertedTextBackground));\n\t\t\t\t\t}\n\n\t\t\t\t\t#container > div > div > div.output {\n\t\t\t\t\t\tfont-size: var(--notebook-cell-output-font-size);\n\t\t\t\t\t\twidth: var(--notebook-output-width);\n\t\t\t\t\t\tmargin-left: var(--notebook-output-left-margin);\n\t\t\t\t\t\tbackground-color: var(--theme-notebook-output-background);\n\t\t\t\t\t\tpadding-top: var(--notebook-output-node-padding);\n\t\t\t\t\t\tpadding-right: var(--notebook-output-node-padding);\n\t\t\t\t\t\tpadding-bottom: var(--notebook-output-node-padding);\n\t\t\t\t\t\tpadding-left: var(--notebook-output-node-left-padding);\n\t\t\t\t\t\tbox-sizing: border-box;\n\t\t\t\t\t\tborder-top: none;\n\t\t\t\t\t}\n\n\t\t\t\t\t/* markdown */\n\t\t\t\t\t#container div.preview {\n\t\t\t\t\t\twidth: 100%;\n\t\t\t\t\t\tpadding-right: var(--notebook-preview-node-padding);\n\t\t\t\t\t\tpadding-left: var(--notebook-markdown-left-margin);\n\t\t\t\t\t\tpadding-top: var(--notebook-preview-node-padding);\n\t\t\t\t\t\tpadding-bottom: var(--notebook-preview-node-padding);\n\n\t\t\t\t\t\tbox-sizing: border-box;\n\t\t\t\t\t\twhite-space: nowrap;\n\t\t\t\t\t\toverflow: hidden;\n\t\t\t\t\t\twhite-space: initial;\n\n\t\t\t\t\t\tfont-size: var(--notebook-markup-font-size);\n\t\t\t\t\t\tline-height: var(--notebook-markdown-line-height);\n\t\t\t\t\t\tcolor: var(--theme-ui-foreground);\n\t\t\t\t\t\tfont-family: var(--notebook-markup-font-family);\n\t\t\t\t\t}\n\n\t\t\t\t\t#container div.preview.draggable {\n\t\t\t\t\t\tuser-select: none;\n\t\t\t\t\t\t-webkit-user-select: none;\n\t\t\t\t\t\t-ms-user-select: none;\n\t\t\t\t\t\tcursor: grab;\n\t\t\t\t\t}\n\n\t\t\t\t\t#container div.preview.selected {\n\t\t\t\t\t\tbackground: var(--theme-notebook-cell-selected-background);\n\t\t\t\t\t}\n\n\t\t\t\t\t#container div.preview.dragging {\n\t\t\t\t\t\tbackground-color: var(--theme-background);\n\t\t\t\t\t\topacity: 0.5 !important;\n\t\t\t\t\t}\n\n\t\t\t\t\t.monaco-workbench.vs-dark .notebookOverlay .cell.markdown .latex img,\n\t\t\t\t\t.monaco-workbench.vs-dark .notebookOverlay .cell.markdown .latex-block img {\n\t\t\t\t\t\tfilter: brightness(0) invert(1)\n\t\t\t\t\t}\n\n\t\t\t\t\t#container .markup > div.nb-symbolHighlight {\n\t\t\t\t\t\tbackground-color: var(--theme-notebook-symbol-highlight-background);\n\t\t\t\t\t}\n\n\t\t\t\t\t#container .markup > div.nb-insertHighlight {\n\t\t\t\t\t\tbackground-color: var(--vscode-diffEditor-insertedLineBackground, var(--vscode-diffEditor-insertedTextBackground));\n\t\t\t\t\t}\n\n\t\t\t\t\t#container .nb-symbolHighlight .output_container .output {\n\t\t\t\t\t\tbackground-color: var(--theme-notebook-symbol-highlight-background);\n\t\t\t\t\t}\n\n\t\t\t\t\t#container .markup > div.nb-multiCellHighlight {\n\t\t\t\t\t\tbackground-color: var(--theme-notebook-symbol-highlight-background);\n\t\t\t\t\t}\n\n\t\t\t\t\t#container .nb-multiCellHighlight .output_container .output {\n\t\t\t\t\t\tbackground-color: var(--theme-notebook-symbol-highlight-background);\n\t\t\t\t\t}\n\n\t\t\t\t\t#container .nb-chatGenerationHighlight .output_container .output {\n\t\t\t\t\t\tbackground-color: var(--vscode-notebook-selectedCellBackground);\n\t\t\t\t\t}\n\n\t\t\t\t\t#container > div.nb-cellDeleted .output_container {\n\t\t\t\t\t\tbackground-color: var(--theme-notebook-diff-removed-background);\n\t\t\t\t\t}\n\n\t\t\t\t\t#container > div.nb-cellAdded .output_container {\n\t\t\t\t\t\tbackground-color: var(--theme-notebook-diff-inserted-background);\n\t\t\t\t\t}\n\n\t\t\t\t\t#container > div > div:not(.preview) > div {\n\t\t\t\t\t\toverflow-x: auto;\n\t\t\t\t\t}\n\n\t\t\t\t\t#container .no-renderer-error {\n\t\t\t\t\t\tcolor: var(--vscode-editorError-foreground);\n\t\t\t\t\t}\n\n\t\t\t\t\tbody {\n\t\t\t\t\t\tpadding: 0px;\n\t\t\t\t\t\theight: 100%;\n\t\t\t\t\t\twidth: 100%;\n\t\t\t\t\t}\n\n\t\t\t\t\ttable, thead, tr, th, td, tbody {\n\t\t\t\t\t\tborder: none;\n\t\t\t\t\t\tborder-color: transparent;\n\t\t\t\t\t\tborder-spacing: 0;\n\t\t\t\t\t\tborder-collapse: collapse;\n\t\t\t\t\t}\n\n\t\t\t\t\ttable, th, tr {\n\t\t\t\t\t\tvertical-align: middle;\n\t\t\t\t\t\ttext-align: right;\n\t\t\t\t\t}\n\n\t\t\t\t\tthead {\n\t\t\t\t\t\tfont-weight: bold;\n\t\t\t\t\t\tbackground-color: rgba(130, 130, 130, 0.16);\n\t\t\t\t\t}\n\n\t\t\t\t\tth, td {\n\t\t\t\t\t\tpadding: 4px 8px;\n\t\t\t\t\t}\n\n\t\t\t\t\ttr:nth-child(even) {\n\t\t\t\t\t\tbackground-color: rgba(130, 130, 130, 0.08);\n\t\t\t\t\t}\n\n\t\t\t\t\ttbody th {\n\t\t\t\t\t\tfont-weight: normal;\n\t\t\t\t\t}\n\n\t\t\t\t\t.find-match {\n\t\t\t\t\t\tbackground-color: var(--vscode-editor-findMatchHighlightBackground);\n\t\t\t\t\t}\n\n\t\t\t\t\t.current-find-match {\n\t\t\t\t\t\tbackground-color: var(--vscode-editor-findMatchBackground);\n\t\t\t\t\t}\n\n\t\t\t\t\t#_defaultColorPalatte {\n\t\t\t\t\t\tcolor: var(--vscode-editor-findMatchHighlightBackground);\n\t\t\t\t\t\tbackground-color: var(--vscode-editor-findMatchBackground);\n\t\t\t\t\t}\n\t\t\t\t</style>\n\t\t\t</head>\n\t\t\t<body style=\"overflow: hidden;\">\n\t\t\t\t<div id='findStart' tabIndex=-1></div>\n\t\t\t\t<div id='container' class=\"widgetarea\" style=\"position: absolute;width:100%;top: 0px\"></div>\n\t\t\t\t<div id=\"_defaultColorPalatte\"></div>\n\t\t\t\t<script type=\"module\">${preloadScript}</script>\n\t\t\t</body>\n\t\t</html>`;\n\t}\n\n\tprivate getRendererData(): RendererMetadata[] {\n\t\treturn this.notebookService.getRenderers().map((renderer): RendererMetadata => {\n\t\t\tconst entrypoint = {\n\t\t\t\textends: renderer.entrypoint.extends,\n\t\t\t\tpath: this.asWebviewUri(renderer.entrypoint.path, renderer.extensionLocation).toString()\n\t\t\t};\n\t\t\treturn {\n\t\t\t\tid: renderer.id,\n\t\t\t\tentrypoint,\n\t\t\t\tmimeTypes: renderer.mimeTypes,\n\t\t\t\tmessaging: renderer.messaging !== RendererMessagingSpec.Never && !!this.rendererMessaging,\n\t\t\t\tisBuiltin: renderer.isBuiltin\n\t\t\t};\n\t\t});\n\t}\n\n\tprivate getStaticPreloadsData(): StaticPreloadMetadata[] {\n\t\treturn Array.from(this.notebookService.getStaticPreloads(this.notebookViewType), preload => {\n\t\t\treturn { entrypoint: this.asWebviewUri(preload.entrypoint, preload.extensionLocation).toString().toString() };\n\t\t});\n\t}\n\n\tprivate asWebviewUri(uri: URI, fromExtension: URI | undefined) {\n\t\treturn asWebviewUri(uri, fromExtension?.scheme === Schemas.vscodeRemote ? { isRemote: true, authority: fromExtension.authority } : undefined);\n\t}\n\n\tpostKernelMessage(message: any) {\n\t\tthis._sendMessageToWebview({\n\t\t\t__vscode_notebook_message: true,\n\t\t\ttype: 'customKernelMessage',\n\t\t\tmessage,\n\t\t});\n\t}\n\n\tprivate resolveOutputId(id: string): { cellInfo: T; output: ICellOutputViewModel } | undefined {\n\t\tconst output = this.reversedInsetMapping.get(id);\n\t\tif (!output) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst cellInfo = this.insetMapping.get(output)!.cellInfo;\n\t\treturn { cellInfo, output };\n\t}\n\n\tisResolved(): this is IResolvedBackLayerWebview {\n\t\treturn !!this.webview;\n\t}\n\n\tcreateWebview(targetWindow: CodeWindow): Promise<void> {\n\t\tconst baseUrl = this.asWebviewUri(this.getNotebookBaseUri(), undefined);\n\t\tconst htmlContent = this.generateContent(baseUrl.toString());\n\t\treturn this._initialize(htmlContent, targetWindow);\n\t}\n\n\tprivate getNotebookBaseUri() {\n\t\tif (this.documentUri.scheme === Schemas.untitled) {\n\t\t\tconst folder = this.workspaceContextService.getWorkspaceFolder(this.documentUri);\n\t\t\tif (folder) {\n\t\t\t\treturn folder.uri;\n\t\t\t}\n\n\t\t\tconst folders = this.workspaceContextService.getWorkspace().folders;\n\t\t\tif (folders.length) {\n\t\t\t\treturn folders[0].uri;\n\t\t\t}\n\t\t}\n\n\t\treturn dirname(this.documentUri);\n\t}\n\n\tprivate getBuiltinLocalResourceRoots(): URI[] {\n\t\t// Python notebooks assume that requirejs is a global.\n\t\t// For all other notebooks, they need to provide their own loader.\n\t\tif (!this.documentUri.path.toLowerCase().endsWith('.ipynb')) {\n\t\t\treturn [];\n\t\t}\n\n\t\tif (isWeb) {\n\t\t\treturn []; // script is inlined\n\t\t}\n\n\t\treturn [\n\t\t\tdirname(FileAccess.asFileUri('vs/nls.js')),\n\t\t];\n\t}\n\n\tprivate _initialize(content: string, targetWindow: CodeWindow): Promise<void> {\n\t\tif (!getWindow(this.element).document.body.contains(this.element)) {\n\t\t\tthrow new Error('Element is already detached from the DOM tree');\n\t\t}\n\n\t\tthis.webview = this._createInset(this.webviewService, content);\n\t\tthis.webview.mountTo(this.element, targetWindow);\n\t\tthis._register(this.webview);\n\n\t\tthis._register(new WebviewWindowDragMonitor(targetWindow, () => this.webview));\n\n\t\tconst initializePromise = new DeferredPromise<void>();\n\n\t\tthis._register(this.webview.onFatalError(e => {\n\t\t\tinitializePromise.error(new Error(`Could not initialize webview: ${e.message}}`));\n\t\t}));\n\n\t\tthis._register(this.webview.onMessage(async (message) => {\n\t\t\tconst data: FromWebviewMessage | { readonly __vscode_notebook_message: undefined } = message.message;\n\t\t\tif (this._disposed) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (!data.__vscode_notebook_message) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tswitch (data.type) {\n\t\t\t\tcase 'initialized': {\n\t\t\t\t\tinitializePromise.complete();\n\t\t\t\t\tthis.initializeWebViewState();\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tcase 'initializedMarkup': {\n\t\t\t\t\tif (this.initializeMarkupPromise?.requestId === data.requestId) {\n\t\t\t\t\t\tthis.initializeMarkupPromise?.p.complete();\n\t\t\t\t\t\tthis.initializeMarkupPromise = undefined;\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tcase 'dimension': {\n\t\t\t\t\tfor (const update of data.updates) {\n\t\t\t\t\t\tconst height = update.height;\n\t\t\t\t\t\tif (update.isOutput) {\n\t\t\t\t\t\t\tconst resolvedResult = this.resolveOutputId(update.id);\n\t\t\t\t\t\t\tif (resolvedResult) {\n\t\t\t\t\t\t\t\tconst { cellInfo, output } = resolvedResult;\n\t\t\t\t\t\t\t\tthis.notebookEditor.updateOutputHeight(cellInfo, output, height, !!update.init, 'webview#dimension');\n\t\t\t\t\t\t\t\tthis.notebookEditor.scheduleOutputHeightAck(cellInfo, update.id, height);\n\t\t\t\t\t\t\t} else if (update.init) {\n\t\t\t\t\t\t\t\t// might be idle render request's ack\n\t\t\t\t\t\t\t\tconst outputRequest = this.reversedPendingWebviewIdleInsetMapping.get(update.id);\n\t\t\t\t\t\t\t\tif (outputRequest) {\n\t\t\t\t\t\t\t\t\tconst inset = this.pendingWebviewIdleInsetMapping.get(outputRequest)!;\n\n\t\t\t\t\t\t\t\t\t// clear the pending mapping\n\t\t\t\t\t\t\t\t\tthis.pendingWebviewIdleCreationRequest.delete(outputRequest);\n\t\t\t\t\t\t\t\t\tthis.pendingWebviewIdleCreationRequest.delete(outputRequest);\n\n\t\t\t\t\t\t\t\t\tconst cellInfo = inset.cellInfo;\n\t\t\t\t\t\t\t\t\tthis.reversedInsetMapping.set(update.id, outputRequest);\n\t\t\t\t\t\t\t\t\tthis.insetMapping.set(outputRequest, inset);\n\t\t\t\t\t\t\t\t\tthis.notebookEditor.updateOutputHeight(cellInfo, outputRequest, height, !!update.init, 'webview#dimension');\n\t\t\t\t\t\t\t\t\tthis.notebookEditor.scheduleOutputHeightAck(cellInfo, update.id, height);\n\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tthis.reversedPendingWebviewIdleInsetMapping.delete(update.id);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tif (!update.init) {\n\t\t\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tconst output = this.reversedInsetMapping.get(update.id);\n\n\t\t\t\t\t\t\t\tif (!output) {\n\t\t\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tconst inset = this.insetMapping.get(output)!;\n\t\t\t\t\t\t\t\tinset.initialized = true;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tthis.notebookEditor.updateMarkupCellHeight(update.id, height, !!update.init);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tcase 'mouseenter': {\n\t\t\t\t\tconst resolvedResult = this.resolveOutputId(data.id);\n\t\t\t\t\tif (resolvedResult) {\n\t\t\t\t\t\tconst latestCell = this.notebookEditor.getCellByInfo(resolvedResult.cellInfo);\n\t\t\t\t\t\tif (latestCell) {\n\t\t\t\t\t\t\tlatestCell.outputIsHovered = true;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tcase 'mouseleave': {\n\t\t\t\t\tconst resolvedResult = this.resolveOutputId(data.id);\n\t\t\t\t\tif (resolvedResult) {\n\t\t\t\t\t\tconst latestCell = this.notebookEditor.getCellByInfo(resolvedResult.cellInfo);\n\t\t\t\t\t\tif (latestCell) {\n\t\t\t\t\t\t\tlatestCell.outputIsHovered = false;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tcase 'outputFocus': {\n\t\t\t\t\tconst resolvedResult = this.resolveOutputId(data.id);\n\t\t\t\t\tif (resolvedResult) {\n\t\t\t\t\t\tconst latestCell = this.notebookEditor.getCellByInfo(resolvedResult.cellInfo);\n\t\t\t\t\t\tif (latestCell) {\n\t\t\t\t\t\t\tlatestCell.outputIsFocused = true;\n\t\t\t\t\t\t\tthis.notebookEditor.focusNotebookCell(latestCell, 'output', { outputId: resolvedResult.output.model.outputId, skipReveal: true, outputWebviewFocused: true });\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tcase 'outputBlur': {\n\t\t\t\t\tconst resolvedResult = this.resolveOutputId(data.id);\n\t\t\t\t\tif (resolvedResult) {\n\t\t\t\t\t\tconst latestCell = this.notebookEditor.getCellByInfo(resolvedResult.cellInfo);\n\t\t\t\t\t\tif (latestCell) {\n\t\t\t\t\t\t\tlatestCell.outputIsFocused = false;\n\t\t\t\t\t\t\tlatestCell.inputInOutputIsFocused = false;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tcase 'scroll-ack': {\n\t\t\t\t\t// const date = new Date();\n\t\t\t\t\t// const top = data.data.top;\n\t\t\t\t\t// console.log('ack top ', top, ' version: ', data.version, ' - ', date.getMinutes() + ':' + date.getSeconds() + ':' + date.getMilliseconds());\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tcase 'scroll-to-reveal': {\n\t\t\t\t\tthis.notebookEditor.setScrollTop(data.scrollTop - NOTEBOOK_WEBVIEW_BOUNDARY);\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tcase 'did-scroll-wheel': {\n\t\t\t\t\tthis.notebookEditor.triggerScroll({\n\t\t\t\t\t\t...data.payload,\n\t\t\t\t\t\tpreventDefault: () => { },\n\t\t\t\t\t\tstopPropagation: () => { }\n\t\t\t\t\t});\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tcase 'focus-editor': {\n\t\t\t\t\tconst cell = this.notebookEditor.getCellById(data.cellId);\n\t\t\t\t\tif (cell) {\n\t\t\t\t\t\tif (data.focusNext) {\n\t\t\t\t\t\t\tthis.notebookEditor.focusNextNotebookCell(cell, 'editor');\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tawait this.notebookEditor.focusNotebookCell(cell, 'editor');\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tcase 'clicked-data-url': {\n\t\t\t\t\tthis._onDidClickDataLink(data);\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tcase 'clicked-link': {\n\t\t\t\t\tif (matchesScheme(data.href, Schemas.command)) {\n\t\t\t\t\t\tconst uri = URI.parse(data.href);\n\n\t\t\t\t\t\tif (uri.path === 'workbench.action.openLargeOutput') {\n\t\t\t\t\t\t\tconst outputId = uri.query;\n\t\t\t\t\t\t\tconst group = this.editorGroupService.activeGroup;\n\t\t\t\t\t\t\tif (group) {\n\t\t\t\t\t\t\t\tif (group.activeEditor) {\n\t\t\t\t\t\t\t\t\tgroup.pinEditor(group.activeEditor);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tthis.openerService.open(CellUri.generateCellOutputUriWithId(this.documentUri, outputId));\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (uri.path === 'cellOutput.enableScrolling') {\n\t\t\t\t\t\t\tconst outputId = uri.query;\n\t\t\t\t\t\t\tconst cell = this.reversedInsetMapping.get(outputId);\n\n\t\t\t\t\t\t\tif (cell) {\n\t\t\t\t\t\t\t\tthis.telemetryService.publicLog2<WorkbenchActionExecutedEvent, WorkbenchActionExecutedClassification>\n\t\t\t\t\t\t\t\t\t('workbenchActionExecuted', { id: 'notebook.cell.toggleOutputScrolling', from: 'inlineLink' });\n\n\t\t\t\t\t\t\t\tcell.cellViewModel.outputsViewModels.forEach((vm) => {\n\t\t\t\t\t\t\t\t\tif (vm.model.metadata) {\n\t\t\t\t\t\t\t\t\t\tvm.model.metadata['scrollable'] = true;\n\t\t\t\t\t\t\t\t\t\tvm.resetRenderer();\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// We allow a very limited set of commands\n\t\t\t\t\t\tthis.openerService.open(data.href, {\n\t\t\t\t\t\t\tfromUserGesture: true,\n\t\t\t\t\t\t\tfromWorkspace: true,\n\t\t\t\t\t\t\tallowCommands: [\n\t\t\t\t\t\t\t\t'github-issues.authNow',\n\t\t\t\t\t\t\t\t'workbench.extensions.search',\n\t\t\t\t\t\t\t\t'workbench.action.openSettings',\n\t\t\t\t\t\t\t\t'_notebook.selectKernel',\n\t\t\t\t\t\t\t\t// TODO@rebornix explore open output channel with name command\n\t\t\t\t\t\t\t\t'jupyter.viewOutput',\n\t\t\t\t\t\t\t\t'jupyter.createPythonEnvAndSelectController',\n\t\t\t\t\t\t\t],\n\t\t\t\t\t\t});\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (matchesSomeScheme(data.href, Schemas.http, Schemas.https, Schemas.mailto)) {\n\t\t\t\t\t\tthis.openerService.open(data.href, { fromUserGesture: true, fromWorkspace: true });\n\t\t\t\t\t} else if (matchesScheme(data.href, Schemas.vscodeNotebookCell)) {\n\t\t\t\t\t\tconst uri = URI.parse(data.href);\n\t\t\t\t\t\tawait this._handleNotebookCellResource(uri);\n\t\t\t\t\t} else if (!/^[\\w\\-]+:/.test(data.href)) {\n\t\t\t\t\t\t// Uri without scheme, such as a file path\n\t\t\t\t\t\tawait this._handleResourceOpening(tryDecodeURIComponent(data.href));\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// uri with scheme\n\t\t\t\t\t\tif (osPath.isAbsolute(data.href)) {\n\t\t\t\t\t\t\tthis._openUri(URI.file(data.href));\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tthis._openUri(URI.parse(data.href));\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tcase 'customKernelMessage': {\n\t\t\t\t\tthis._onMessage.fire({ message: data.message });\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tcase 'customRendererMessage': {\n\t\t\t\t\tthis.rendererMessaging?.postMessage(data.rendererId, data.message);\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tcase 'clickMarkupCell': {\n\t\t\t\t\tconst cell = this.notebookEditor.getCellById(data.cellId);\n\t\t\t\t\tif (cell) {\n\t\t\t\t\t\tif (data.shiftKey || (isMacintosh ? data.metaKey : data.ctrlKey)) {\n\t\t\t\t\t\t\t// Modify selection\n\t\t\t\t\t\t\tthis.notebookEditor.toggleNotebookCellSelection(cell, /* fromPrevious */ data.shiftKey);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t// Normal click\n\t\t\t\t\t\t\tawait this.notebookEditor.focusNotebookCell(cell, 'container', { skipReveal: true });\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tcase 'contextMenuMarkupCell': {\n\t\t\t\t\tconst cell = this.notebookEditor.getCellById(data.cellId);\n\t\t\t\t\tif (cell) {\n\t\t\t\t\t\t// Focus the cell first\n\t\t\t\t\t\tawait this.notebookEditor.focusNotebookCell(cell, 'container', { skipReveal: true });\n\n\t\t\t\t\t\t// Then show the context menu\n\t\t\t\t\t\tconst webviewRect = this.element.getBoundingClientRect();\n\t\t\t\t\t\tthis.contextMenuService.showContextMenu({\n\t\t\t\t\t\t\tmenuId: MenuId.NotebookCellTitle,\n\t\t\t\t\t\t\tcontextKeyService: this.contextKeyService,\n\t\t\t\t\t\t\tgetAnchor: () => ({\n\t\t\t\t\t\t\t\tx: webviewRect.x + data.clientX,\n\t\t\t\t\t\t\t\ty: webviewRect.y + data.clientY\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tcase 'toggleMarkupPreview': {\n\t\t\t\t\tconst cell = this.notebookEditor.getCellById(data.cellId);\n\t\t\t\t\tif (cell && !this.notebookEditor.creationOptions.isReadOnly) {\n\t\t\t\t\t\tthis.notebookEditor.setMarkupCellEditState(data.cellId, CellEditState.Editing);\n\t\t\t\t\t\tawait this.notebookEditor.focusNotebookCell(cell, 'editor', { skipReveal: true });\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tcase 'mouseEnterMarkupCell': {\n\t\t\t\t\tconst cell = this.notebookEditor.getCellById(data.cellId);\n\t\t\t\t\tif (cell instanceof MarkupCellViewModel) {\n\t\t\t\t\t\tcell.cellIsHovered = true;\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tcase 'mouseLeaveMarkupCell': {\n\t\t\t\t\tconst cell = this.notebookEditor.getCellById(data.cellId);\n\t\t\t\t\tif (cell instanceof MarkupCellViewModel) {\n\t\t\t\t\t\tcell.cellIsHovered = false;\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tcase 'cell-drag-start': {\n\t\t\t\t\tthis.notebookEditor.didStartDragMarkupCell(data.cellId, data);\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tcase 'cell-drag': {\n\t\t\t\t\tthis.notebookEditor.didDragMarkupCell(data.cellId, data);\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tcase 'cell-drop': {\n\t\t\t\t\tthis.notebookEditor.didDropMarkupCell(data.cellId, {\n\t\t\t\t\t\tdragOffsetY: data.dragOffsetY,\n\t\t\t\t\t\tctrlKey: data.ctrlKey,\n\t\t\t\t\t\taltKey: data.altKey,\n\t\t\t\t\t});\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tcase 'cell-drag-end': {\n\t\t\t\t\tthis.notebookEditor.didEndDragMarkupCell(data.cellId);\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tcase 'renderedMarkup': {\n\t\t\t\t\tconst cell = this.notebookEditor.getCellById(data.cellId);\n\t\t\t\t\tif (cell instanceof MarkupCellViewModel) {\n\t\t\t\t\t\tcell.renderedHtml = data.html;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis._handleHighlightCodeBlock(data.codeBlocks);\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tcase 'renderedCellOutput': {\n\t\t\t\t\tthis._handleHighlightCodeBlock(data.codeBlocks);\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tcase 'outputResized': {\n\t\t\t\t\tthis.notebookEditor.didResizeOutput(data.cellId);\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tcase 'getOutputItem': {\n\t\t\t\t\tconst resolvedResult = this.resolveOutputId(data.outputId);\n\t\t\t\t\tconst output = resolvedResult?.output.model.outputs.find(output => output.mime === data.mime);\n\n\t\t\t\t\tthis._sendMessageToWebview({\n\t\t\t\t\t\ttype: 'returnOutputItem',\n\t\t\t\t\t\trequestId: data.requestId,\n\t\t\t\t\t\toutput: output ? { mime: output.mime, valueBytes: output.data.buffer } : undefined,\n\t\t\t\t\t});\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tcase 'logRendererDebugMessage': {\n\t\t\t\t\tthis._logRendererDebugMessage(`${data.message}${data.data ? ' ' + JSON.stringify(data.data, null, 4) : ''}`);\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tcase 'notebookPerformanceMessage': {\n\t\t\t\t\tthis.notebookEditor.updatePerformanceMetadata(data.cellId, data.executionId, data.duration, data.rendererId);\n\t\t\t\t\tif (data.outputSize && data.rendererId === 'vscode.builtin-renderer') {\n\t\t\t\t\t\tthis._sendPerformanceData(data.outputSize, data.duration);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tcase 'outputInputFocus': {\n\t\t\t\t\tconst resolvedResult = this.resolveOutputId(data.id);\n\t\t\t\t\tif (resolvedResult) {\n\t\t\t\t\t\tconst latestCell = this.notebookEditor.getCellByInfo(resolvedResult.cellInfo);\n\t\t\t\t\t\tif (latestCell) {\n\t\t\t\t\t\t\tlatestCell.inputInOutputIsFocused = data.inputFocused;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tthis.notebookEditor.didFocusOutputInputChange(data.inputFocused);\n\t\t\t\t}\n\t\t\t}\n\t\t}));\n\n\t\treturn initializePromise.p;\n\t}\n\n\tprivate _sendPerformanceData(outputSize: number, renderTime: number) {\n\t\ttype NotebookOutputRenderClassification = {\n\t\t\towner: 'amunger';\n\t\t\tcomment: 'Track performance data for output rendering';\n\t\t\toutputSize: { classification: 'SystemMetaData'; purpose: 'FeatureInsight'; comment: 'Size of the output data buffer.'; isMeasurement: true };\n\t\t\trenderTime: { classification: 'SystemMetaData'; purpose: 'FeatureInsight'; comment: 'Time spent rendering output.'; isMeasurement: true };\n\t\t};\n\n\t\ttype NotebookOutputRenderEvent = {\n\t\t\toutputSize: number;\n\t\t\trenderTime: number;\n\t\t};\n\n\t\tconst telemetryData = {\n\t\t\toutputSize,\n\t\t\trenderTime\n\t\t};\n\n\t\tthis.telemetryService.publicLog2<NotebookOutputRenderEvent, NotebookOutputRenderClassification>('NotebookCellOutputRender', telemetryData);\n\t}\n\n\tprivate _handleNotebookCellResource(uri: URI) {\n\t\tconst notebookResource = uri.path.length > 0 ? uri : this.documentUri;\n\n\t\tconst lineMatch = /(?:^|&)line=([^&]+)/.exec(uri.query);\n\t\tlet editorOptions: ITextEditorOptions | undefined = undefined;\n\t\tif (lineMatch) {\n\t\t\tconst parsedLineNumber = parseInt(lineMatch[1], 10);\n\t\t\tif (!isNaN(parsedLineNumber)) {\n\t\t\t\tconst lineNumber = parsedLineNumber;\n\n\t\t\t\teditorOptions = {\n\t\t\t\t\tselection: { startLineNumber: lineNumber, startColumn: 1 }\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\n\t\tconst executionMatch = /(?:^|&)execution_count=([^&]+)/.exec(uri.query);\n\t\tif (executionMatch) {\n\t\t\tconst executionCount = parseInt(executionMatch[1], 10);\n\t\t\tif (!isNaN(executionCount)) {\n\t\t\t\tconst notebookModel = this.notebookService.getNotebookTextModel(notebookResource);\n\t\t\t\t// multiple cells with the same execution count can exist if the kernel is restarted\n\t\t\t\t// so look for the most recently added cell with the matching execution count.\n\t\t\t\t// Somewhat more likely to be correct in notebooks, an much more likely for the interactive window\n\t\t\t\tconst cell = notebookModel?.cells.slice().reverse().find(cell => {\n\t\t\t\t\treturn cell.internalMetadata.executionOrder === executionCount;\n\t\t\t\t});\n\t\t\t\tif (cell?.uri) {\n\t\t\t\t\treturn this.openerService.open(cell.uri, {\n\t\t\t\t\t\tfromUserGesture: true,\n\t\t\t\t\t\tfromWorkspace: true,\n\t\t\t\t\t\teditorOptions: editorOptions\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// URLs built by the jupyter extension put the line query param in the fragment\n\t\t// They also have the cell fragment pre-calculated\n\t\tconst fragmentLineMatch = /\\?line=(\\d+)$/.exec(uri.fragment);\n\t\tif (fragmentLineMatch) {\n\t\t\tconst parsedLineNumber = parseInt(fragmentLineMatch[1], 10);\n\t\t\tif (!isNaN(parsedLineNumber)) {\n\t\t\t\tconst lineNumber = parsedLineNumber + 1;\n\t\t\t\tconst fragment = uri.fragment.substring(0, fragmentLineMatch.index);\n\n\t\t\t\t// open the uri with selection\n\t\t\t\tconst editorOptions: ITextEditorOptions = {\n\t\t\t\t\tselection: { startLineNumber: lineNumber, startColumn: 1, endLineNumber: lineNumber, endColumn: 1 }\n\t\t\t\t};\n\n\t\t\t\treturn this.openerService.open(notebookResource.with({ fragment }), {\n\t\t\t\t\tfromUserGesture: true,\n\t\t\t\t\tfromWorkspace: true,\n\t\t\t\t\teditorOptions: editorOptions\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\treturn this.openerService.open(notebookResource, { fromUserGesture: true, fromWorkspace: true });\n\t}\n\n\tprivate async _handleResourceOpening(href: string) {\n\t\tlet linkToOpen: URI | undefined = undefined;\n\t\tlet fragment: string | undefined = undefined;\n\n\t\t// Separate out the fragment so that the subsequent calls\n\t\t// to URI.joinPath() don't URL encode it. This allows opening\n\t\t// links with both paths and fragments.\n\t\tconst hrefWithFragment = FRAGMENT_REGEX.exec(href);\n\t\tif (hrefWithFragment) {\n\t\t\thref = hrefWithFragment[1];\n\t\t\tfragment = hrefWithFragment[2];\n\t\t}\n\n\t\tif (href.startsWith('/')) {\n\t\t\tlinkToOpen = await this.pathService.fileURI(href);\n\t\t\tconst folders = this.workspaceContextService.getWorkspace().folders;\n\t\t\tif (folders.length) {\n\t\t\t\tlinkToOpen = linkToOpen.with({\n\t\t\t\t\tscheme: folders[0].uri.scheme,\n\t\t\t\t\tauthority: folders[0].uri.authority\n\t\t\t\t});\n\t\t\t}\n\t\t} else if (href.startsWith('~')) {\n\t\t\tconst userHome = await this.pathService.userHome();\n\t\t\tif (userHome) {\n\t\t\t\tlinkToOpen = URI.joinPath(userHome, href.substring(2));\n\t\t\t}\n\t\t} else {\n\t\t\tif (this.documentUri.scheme === Schemas.untitled) {\n\t\t\t\tconst folders = this.workspaceContextService.getWorkspace().folders;\n\t\t\t\tif (!folders.length) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tlinkToOpen = URI.joinPath(folders[0].uri, href);\n\t\t\t} else {\n\t\t\t\t// Resolve relative to notebook document\n\t\t\t\tlinkToOpen = URI.joinPath(dirname(this.documentUri), href);\n\t\t\t}\n\t\t}\n\n\t\tif (linkToOpen) {\n\t\t\t// Re-attach fragment now that we have the full file path.\n\t\t\tif (fragment) {\n\t\t\t\tlinkToOpen = linkToOpen.with({ fragment });\n\t\t\t}\n\t\t\tthis._openUri(linkToOpen);\n\t\t}\n\t}\n\n\tprivate _openUri(uri: URI) {\n\t\tlet lineNumber: number | undefined = undefined;\n\t\tlet column: number | undefined = undefined;\n\t\tconst lineCol = LINE_COLUMN_REGEX.exec(uri.path);\n\t\tif (lineCol) {\n\t\t\turi = uri.with({\n\t\t\t\tpath: uri.path.slice(0, lineCol.index),\n\t\t\t\tfragment: `L${lineCol[0].slice(1)}`\n\t\t\t});\n\t\t\tlineNumber = parseInt(lineCol[1], 10);\n\t\t\tcolumn = parseInt(lineCol[2], 10);\n\t\t}\n\n\t\t//#region error renderer migration, remove once done\n\t\tconst lineMatch = LineQueryRegex.exec(uri.query);\n\t\tif (lineMatch) {\n\t\t\tconst parsedLineNumber = parseInt(lineMatch[1], 10);\n\t\t\tif (!isNaN(parsedLineNumber)) {\n\t\t\t\tlineNumber = parsedLineNumber + 1;\n\t\t\t\tcolumn = 1;\n\t\t\t\turi = uri.with({ fragment: `L${lineNumber}` });\n\t\t\t}\n\t\t}\n\n\t\turi = uri.with({\n\t\t\tquery: null\n\t\t});\n\t\t//#endregion\n\n\t\tlet match: { group: IEditorGroup; editor: EditorInput } | undefined = undefined;\n\n\t\tfor (const group of this.editorGroupService.groups) {\n\t\t\tconst editorInput = group.editors.find(editor => editor.resource && isEqual(editor.resource, uri, true));\n\t\t\tif (editorInput) {\n\t\t\t\tmatch = { group, editor: editorInput };\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\tif (match) {\n\t\t\tconst selection: ITextEditorSelection | undefined = lineNumber !== undefined && column !== undefined ? { startLineNumber: lineNumber, startColumn: column } : undefined;\n\t\t\tconst textEditorOptions: ITextEditorOptions = { selection: selection };\n\t\t\tmatch.group.openEditor(match.editor, selection ? textEditorOptions : undefined);\n\t\t} else {\n\t\t\tthis.openerService.open(uri, { fromUserGesture: true, fromWorkspace: true });\n\t\t}\n\t}\n\n\tprivate _handleHighlightCodeBlock(codeBlocks: ReadonlyArray<ICodeBlockHighlightRequest>) {\n\t\tfor (const { id, value, lang } of codeBlocks) {\n\t\t\t// The language id may be a language aliases (e.g.js instead of javascript)\n\t\t\tconst languageId = this.languageService.getLanguageIdByLanguageName(lang);\n\t\t\tif (!languageId) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\ttokenizeToString(this.languageService, value, languageId).then((html) => {\n\t\t\t\tif (this._disposed) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tthis._sendMessageToWebview({\n\t\t\t\t\ttype: 'tokenizedCodeBlock',\n\t\t\t\t\thtml,\n\t\t\t\t\tcodeBlockId: id\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\t}\n\tprivate async _onDidClickDataLink(event: IClickedDataUrlMessage): Promise<void> {\n\t\tif (typeof event.data !== 'string') {\n\t\t\treturn;\n\t\t}\n\n\t\tconst [splitStart, splitData] = event.data.split(';base64,');\n\t\tif (!splitData || !splitStart) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst defaultDir = extname(this.documentUri) === '.interactive' ?\n\t\t\tthis.workspaceContextService.getWorkspace().folders[0]?.uri ?? await this.fileDialogService.defaultFilePath() :\n\t\t\tdirname(this.documentUri);\n\t\tlet defaultName: string;\n\t\tif (event.downloadName) {\n\t\t\tdefaultName = event.downloadName;\n\t\t} else {\n\t\t\tconst mimeType = splitStart.replace(/^data:/, '');\n\t\t\tconst candidateExtension = mimeType && getExtensionForMimeType(mimeType);\n\t\t\tdefaultName = candidateExtension ? `download${candidateExtension}` : 'download';\n\t\t}\n\n\t\tconst defaultUri = joinPath(defaultDir, defaultName);\n\t\tconst newFileUri = await this.fileDialogService.showSaveDialog({\n\t\t\tdefaultUri\n\t\t});\n\t\tif (!newFileUri) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst buff = decodeBase64(splitData);\n\t\tawait this.fileService.writeFile(newFileUri, buff);\n\t\tawait this.openerService.open(newFileUri);\n\t}\n\n\tprivate _createInset(webviewService: IWebviewService, content: string) {\n\t\tthis.localResourceRootsCache = this._getResourceRootsCache();\n\t\tconst webview = webviewService.createWebviewElement({\n\t\t\torigin: BackLayerWebView.getOriginStore(this.storageService).getOrigin(this.notebookViewType, undefined),\n\t\t\ttitle: nls.localize('webview title', \"Notebook webview content\"),\n\t\t\toptions: {\n\t\t\t\tpurpose: WebviewContentPurpose.NotebookRenderer,\n\t\t\t\tenableFindWidget: false,\n\t\t\t\ttransformCssVariables: transformWebviewThemeVars,\n\t\t\t},\n\t\t\tcontentOptions: {\n\t\t\t\tallowMultipleAPIAcquire: true,\n\t\t\t\tallowScripts: true,\n\t\t\t\tlocalResourceRoots: this.localResourceRootsCache,\n\t\t\t},\n\t\t\textension: undefined,\n\t\t\tprovidedViewType: 'notebook.output'\n\t\t});\n\n\t\twebview.setHtml(content);\n\t\twebview.setContextKeyService(this.contextKeyService);\n\t\treturn webview;\n\t}\n\n\tprivate _getResourceRootsCache(): URI[] {\n\t\tconst workspaceFolders = this.contextService.getWorkspace().folders.map(x => x.uri);\n\t\tconst notebookDir = this.getNotebookBaseUri();\n\t\treturn [\n\t\t\tthis.notebookService.getNotebookProviderResourceRoots(),\n\t\t\tthis.notebookService.getRenderers().map(x => dirname(x.entrypoint.path)),\n\t\t\t...Array.from(this.notebookService.getStaticPreloads(this.notebookViewType), x => [\n\t\t\t\tdirname(x.entrypoint),\n\t\t\t\t...x.localResourceRoots,\n\t\t\t]),\n\t\t\tworkspaceFolders,\n\t\t\tnotebookDir,\n\t\t\tthis.getBuiltinLocalResourceRoots()\n\t\t].flat();\n\t}\n\n\tprivate initializeWebViewState() {\n\t\tthis._preloadsCache.clear();\n\t\tif (this._currentKernel) {\n\t\t\tthis._updatePreloadsFromKernel(this._currentKernel);\n\t\t}\n\n\t\tfor (const [output, inset] of this.insetMapping.entries()) {\n\t\t\tthis._sendMessageToWebview({ ...inset.cachedCreation, initiallyHidden: this.hiddenInsetMapping.has(output) });\n\t\t}\n\n\t\tif (this.initializeMarkupPromise?.isFirstInit) {\n\t\t\t// On first run the contents have already been initialized so we don't need to init them again\n\t\t\t// no op\n\t\t} else {\n\t\t\tconst mdCells = [...this.markupPreviewMapping.values()];\n\t\t\tthis.markupPreviewMapping.clear();\n\t\t\tthis.initializeMarkup(mdCells);\n\t\t}\n\n\t\tthis._updateStyles();\n\t\tthis._updateOptions();\n\t}\n\n\tprivate shouldUpdateInset(cell: IGenericCellViewModel, output: ICellOutputViewModel, cellTop: number, outputOffset: number): boolean {\n\t\tif (this._disposed) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif ('isOutputCollapsed' in cell && (cell as ICellViewModel).isOutputCollapsed) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif (this.hiddenInsetMapping.has(output)) {\n\t\t\treturn true;\n\t\t}\n\n\t\tconst outputCache = this.insetMapping.get(output);\n\t\tif (!outputCache) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif (outputOffset === outputCache.cachedCreation.outputOffset && cellTop === outputCache.cachedCreation.cellTop) {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t}\n\n\tackHeight(updates: readonly IAckOutputHeight[]): void {\n\t\tthis._sendMessageToWebview({\n\t\t\ttype: 'ack-dimension',\n\t\t\tupdates\n\t\t});\n\t}\n\n\tupdateScrollTops(outputRequests: IDisplayOutputLayoutUpdateRequest[], markupPreviews: { id: string; top: number }[]) {\n\t\tif (this._disposed) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst widgets = coalesce(outputRequests.map((request): IContentWidgetTopRequest | undefined => {\n\t\t\tconst outputCache = this.insetMapping.get(request.output);\n\t\t\tif (!outputCache) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (!request.forceDisplay && !this.shouldUpdateInset(request.cell, request.output, request.cellTop, request.outputOffset)) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst id = outputCache.outputId;\n\t\t\toutputCache.cachedCreation.cellTop = request.cellTop;\n\t\t\toutputCache.cachedCreation.outputOffset = request.outputOffset;\n\t\t\tthis.hiddenInsetMapping.delete(request.output);\n\n\t\t\treturn {\n\t\t\t\tcellId: request.cell.id,\n\t\t\t\toutputId: id,\n\t\t\t\tcellTop: request.cellTop,\n\t\t\t\toutputOffset: request.outputOffset,\n\t\t\t\tforceDisplay: request.forceDisplay,\n\t\t\t};\n\t\t}));\n\n\t\tif (!widgets.length && !markupPreviews.length) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._sendMessageToWebview({\n\t\t\ttype: 'view-scroll',\n\t\t\twidgets: widgets,\n\t\t\tmarkupCells: markupPreviews,\n\t\t});\n\t}\n\n\tprivate async createMarkupPreview(initialization: IMarkupCellInitialization) {\n\t\tif (this._disposed) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.markupPreviewMapping.has(initialization.cellId)) {\n\t\t\tconsole.error('Trying to create markup preview that already exists');\n\t\t\treturn;\n\t\t}\n\n\t\tthis.markupPreviewMapping.set(initialization.cellId, initialization);\n\t\tthis._sendMessageToWebview({\n\t\t\ttype: 'createMarkupCell',\n\t\t\tcell: initialization\n\t\t});\n\t}\n\n\tasync showMarkupPreview(newContent: IMarkupCellInitialization) {\n\t\tif (this._disposed) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst entry = this.markupPreviewMapping.get(newContent.cellId);\n\t\tif (!entry) {\n\t\t\treturn this.createMarkupPreview(newContent);\n\t\t}\n\n\t\tconst sameContent = newContent.content === entry.content;\n\t\tconst sameMetadata = (equals(newContent.metadata, entry.metadata));\n\t\tif (!sameContent || !sameMetadata || !entry.visible) {\n\t\t\tthis._sendMessageToWebview({\n\t\t\t\ttype: 'showMarkupCell',\n\t\t\t\tid: newContent.cellId,\n\t\t\t\thandle: newContent.cellHandle,\n\t\t\t\t// If the content has not changed, we still want to make sure the\n\t\t\t\t// preview is visible but don't need to send anything over\n\t\t\t\tcontent: sameContent ? undefined : newContent.content,\n\t\t\t\ttop: newContent.offset,\n\t\t\t\tmetadata: sameMetadata ? undefined : newContent.metadata\n\t\t\t});\n\t\t}\n\t\tentry.metadata = newContent.metadata;\n\t\tentry.content = newContent.content;\n\t\tentry.offset = newContent.offset;\n\t\tentry.visible = true;\n\t}\n\n\tasync hideMarkupPreviews(cellIds: readonly string[]) {\n\t\tif (this._disposed) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst cellsToHide: string[] = [];\n\t\tfor (const cellId of cellIds) {\n\t\t\tconst entry = this.markupPreviewMapping.get(cellId);\n\t\t\tif (entry) {\n\t\t\t\tif (entry.visible) {\n\t\t\t\t\tcellsToHide.push(cellId);\n\t\t\t\t\tentry.visible = false;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (cellsToHide.length) {\n\t\t\tthis._sendMessageToWebview({\n\t\t\t\ttype: 'hideMarkupCells',\n\t\t\t\tids: cellsToHide\n\t\t\t});\n\t\t}\n\t}\n\n\tasync unhideMarkupPreviews(cellIds: readonly string[]) {\n\t\tif (this._disposed) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst toUnhide: string[] = [];\n\t\tfor (const cellId of cellIds) {\n\t\t\tconst entry = this.markupPreviewMapping.get(cellId);\n\t\t\tif (entry) {\n\t\t\t\tif (!entry.visible) {\n\t\t\t\t\tentry.visible = true;\n\t\t\t\t\ttoUnhide.push(cellId);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tconsole.error(`Trying to unhide a preview that does not exist: ${cellId}`);\n\t\t\t}\n\t\t}\n\n\t\tthis._sendMessageToWebview({\n\t\t\ttype: 'unhideMarkupCells',\n\t\t\tids: toUnhide,\n\t\t});\n\t}\n\n\tasync deleteMarkupPreviews(cellIds: readonly string[]) {\n\t\tif (this._disposed) {\n\t\t\treturn;\n\t\t}\n\n\t\tfor (const id of cellIds) {\n\t\t\tif (!this.markupPreviewMapping.has(id)) {\n\t\t\t\tconsole.error(`Trying to delete a preview that does not exist: ${id}`);\n\t\t\t}\n\t\t\tthis.markupPreviewMapping.delete(id);\n\t\t}\n\n\t\tif (cellIds.length) {\n\t\t\tthis._sendMessageToWebview({\n\t\t\t\ttype: 'deleteMarkupCell',\n\t\t\t\tids: cellIds\n\t\t\t});\n\t\t}\n\t}\n\n\tasync updateMarkupPreviewSelections(selectedCellsIds: string[]) {\n\t\tif (this._disposed) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._sendMessageToWebview({\n\t\t\ttype: 'updateSelectedMarkupCells',\n\t\t\tselectedCellIds: selectedCellsIds.filter(id => this.markupPreviewMapping.has(id)),\n\t\t});\n\t}\n\n\tasync initializeMarkup(cells: readonly IMarkupCellInitialization[]): Promise<void> {\n\t\tif (this._disposed) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.initializeMarkupPromise?.p.complete();\n\t\tconst requestId = UUID.generateUuid();\n\t\tthis.initializeMarkupPromise = { p: new DeferredPromise(), requestId, isFirstInit: this.firstInit };\n\n\t\tthis.firstInit = false;\n\n\t\tfor (const cell of cells) {\n\t\t\tthis.markupPreviewMapping.set(cell.cellId, cell);\n\t\t}\n\n\t\tthis._sendMessageToWebview({\n\t\t\ttype: 'initializeMarkup',\n\t\t\tcells,\n\t\t\trequestId,\n\t\t});\n\n\t\treturn this.initializeMarkupPromise.p.p;\n\t}\n\n\t/**\n\t * Validate if cached inset is out of date and require a rerender\n\t * Note that it doesn't account for output content change.\n\t */\n\tprivate _cachedInsetEqual(cachedInset: ICachedInset<T>, content: IInsetRenderOutput) {\n\t\tif (content.type === RenderOutputType.Extension) {\n\t\t\t// Use a new renderer\n\t\t\treturn cachedInset.renderer?.id === content.renderer.id;\n\t\t} else {\n\t\t\t// The new renderer is the default HTML renderer\n\t\t\treturn cachedInset.cachedCreation.type === 'html';\n\t\t}\n\t}\n\n\trequestCreateOutputWhenWebviewIdle(cellInfo: T, content: IInsetRenderOutput, cellTop: number, offset: number) {\n\t\tif (this._disposed) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.insetMapping.has(content.source)) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.pendingWebviewIdleCreationRequest.has(content.source)) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.pendingWebviewIdleInsetMapping.has(content.source)) {\n\t\t\t// handled in renderer process, waiting for webview to process it when idle\n\t\t\treturn;\n\t\t}\n\n\t\tthis.pendingWebviewIdleCreationRequest.set(content.source, runWhenGlobalIdle(() => {\n\t\t\tconst { message, renderer, transfer: transferable } = this._createOutputCreationMessage(cellInfo, content, cellTop, offset, true, true);\n\t\t\tthis._sendMessageToWebview(message, transferable);\n\t\t\tthis.pendingWebviewIdleInsetMapping.set(content.source, { outputId: message.outputId, versionId: content.source.model.versionId, cellInfo: cellInfo, renderer, cachedCreation: message });\n\t\t\tthis.reversedPendingWebviewIdleInsetMapping.set(message.outputId, content.source);\n\t\t\tthis.pendingWebviewIdleCreationRequest.delete(content.source);\n\t\t}));\n\t}\n\n\tcreateOutput(cellInfo: T, content: IInsetRenderOutput, cellTop: number, offset: number): void {\n\t\tif (this._disposed) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst cachedInset = this.insetMapping.get(content.source);\n\n\t\t// we now request to render the output immediately, so we can remove the pending request\n\t\t// dispose the pending request in renderer process if it exists\n\t\tthis.pendingWebviewIdleCreationRequest.get(content.source)?.dispose();\n\t\tthis.pendingWebviewIdleCreationRequest.delete(content.source);\n\n\t\t// if request has already been sent out, we then remove it from the pending mapping\n\t\tthis.pendingWebviewIdleInsetMapping.delete(content.source);\n\t\tif (cachedInset) {\n\t\t\tthis.reversedPendingWebviewIdleInsetMapping.delete(cachedInset.outputId);\n\t\t}\n\n\t\tif (cachedInset && this._cachedInsetEqual(cachedInset, content)) {\n\t\t\tthis.hiddenInsetMapping.delete(content.source);\n\t\t\tthis._sendMessageToWebview({\n\t\t\t\ttype: 'showOutput',\n\t\t\t\tcellId: cachedInset.cellInfo.cellId,\n\t\t\t\toutputId: cachedInset.outputId,\n\t\t\t\tcellTop: cellTop,\n\t\t\t\toutputOffset: offset\n\t\t\t});\n\t\t\treturn;\n\t\t}\n\n\t\t// create new output\n\t\tconst { message, renderer, transfer: transferable } = this._createOutputCreationMessage(cellInfo, content, cellTop, offset, false, false);\n\t\tthis._sendMessageToWebview(message, transferable);\n\t\tthis.insetMapping.set(content.source, { outputId: message.outputId, versionId: content.source.model.versionId, cellInfo: cellInfo, renderer, cachedCreation: message });\n\t\tthis.hiddenInsetMapping.delete(content.source);\n\t\tthis.reversedInsetMapping.set(message.outputId, content.source);\n\t}\n\n\tprivate createMetadata(output: ICellOutput, mimeType: string) {\n\t\tif (mimeType.startsWith('image')) {\n\t\t\tconst buffer = output.outputs.find(out => out.mime === 'text/plain')?.data.buffer;\n\t\t\tif (buffer?.length && buffer?.length > 0) {\n\t\t\t\tconst altText = new TextDecoder().decode(buffer);\n\t\t\t\treturn { ...output.metadata, vscode_altText: altText };\n\t\t\t}\n\t\t}\n\t\treturn output.metadata;\n\t}\n\n\tprivate _createOutputCreationMessage(cellInfo: T, content: IInsetRenderOutput, cellTop: number, offset: number, createOnIdle: boolean, initiallyHidden: boolean): { readonly message: ICreationRequestMessage; readonly renderer: INotebookRendererInfo | undefined; transfer: readonly ArrayBuffer[] } {\n\t\tconst messageBase = {\n\t\t\ttype: 'html',\n\t\t\texecutionId: cellInfo.executionId,\n\t\t\tcellId: cellInfo.cellId,\n\t\t\tcellTop: cellTop,\n\t\t\toutputOffset: offset,\n\t\t\tleft: 0,\n\t\t\trequiredPreloads: [],\n\t\t\tcreateOnIdle: createOnIdle\n\t\t} as const;\n\n\t\tconst transfer: ArrayBuffer[] = [];\n\n\t\tlet message: ICreationRequestMessage;\n\t\tlet renderer: INotebookRendererInfo | undefined;\n\t\tif (content.type === RenderOutputType.Extension) {\n\t\t\tconst output = content.source.model;\n\t\t\trenderer = content.renderer;\n\t\t\tconst first = output.outputs.find(op => op.mime === content.mimeType)!;\n\t\t\tconst metadata = this.createMetadata(output, content.mimeType);\n\t\t\tconst valueBytes = copyBufferIfNeeded(first.data.buffer, transfer);\n\t\t\tmessage = {\n\t\t\t\t...messageBase,\n\t\t\t\toutputId: output.outputId,\n\t\t\t\trendererId: content.renderer.id,\n\t\t\t\tcontent: {\n\t\t\t\t\ttype: RenderOutputType.Extension,\n\t\t\t\t\toutputId: output.outputId,\n\t\t\t\t\tmetadata: metadata,\n\t\t\t\t\toutput: {\n\t\t\t\t\t\tmime: first.mime,\n\t\t\t\t\t\tvalueBytes,\n\t\t\t\t\t},\n\t\t\t\t\tallOutputs: output.outputs.map(output => ({ mime: output.mime })),\n\t\t\t\t},\n\t\t\t\tinitiallyHidden: initiallyHidden\n\t\t\t};\n\t\t} else {\n\t\t\tmessage = {\n\t\t\t\t...messageBase,\n\t\t\t\toutputId: UUID.generateUuid(),\n\t\t\t\tcontent: {\n\t\t\t\t\ttype: content.type,\n\t\t\t\t\thtmlContent: content.htmlContent,\n\t\t\t\t},\n\t\t\t\tinitiallyHidden: initiallyHidden\n\t\t\t};\n\t\t}\n\n\t\treturn {\n\t\t\tmessage,\n\t\t\trenderer,\n\t\t\ttransfer,\n\t\t};\n\t}\n\n\tupdateOutput(cellInfo: T, content: IInsetRenderOutput, cellTop: number, offset: number): void {\n\t\tif (this._disposed) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.insetMapping.has(content.source)) {\n\t\t\tthis.createOutput(cellInfo, content, cellTop, offset);\n\t\t\treturn;\n\t\t}\n\n\t\tconst outputCache = this.insetMapping.get(content.source)!;\n\n\t\tif (outputCache.versionId === content.source.model.versionId) {\n\t\t\t// already sent this output version to the renderer\n\t\t\treturn;\n\t\t}\n\n\t\tthis.hiddenInsetMapping.delete(content.source);\n\t\tlet updatedContent: ICreationContent | undefined = undefined;\n\n\t\tconst transfer: ArrayBuffer[] = [];\n\t\tif (content.type === RenderOutputType.Extension) {\n\t\t\tconst output = content.source.model;\n\t\t\tconst firstBuffer = output.outputs.find(op => op.mime === content.mimeType)!;\n\t\t\tconst appenededData = output.appendedSinceVersion(outputCache.versionId, content.mimeType);\n\t\t\tconst appended = appenededData ? { valueBytes: appenededData.buffer, previousVersion: outputCache.versionId } : undefined;\n\n\t\t\tconst valueBytes = copyBufferIfNeeded(firstBuffer.data.buffer, transfer);\n\t\t\tupdatedContent = {\n\t\t\t\ttype: RenderOutputType.Extension,\n\t\t\t\toutputId: outputCache.outputId,\n\t\t\t\tmetadata: output.metadata,\n\t\t\t\toutput: {\n\t\t\t\t\tmime: content.mimeType,\n\t\t\t\t\tvalueBytes,\n\t\t\t\t\tappended: appended\n\t\t\t\t},\n\t\t\t\tallOutputs: output.outputs.map(output => ({ mime: output.mime }))\n\t\t\t};\n\t\t}\n\n\t\tthis._sendMessageToWebview({\n\t\t\ttype: 'showOutput',\n\t\t\tcellId: outputCache.cellInfo.cellId,\n\t\t\toutputId: outputCache.outputId,\n\t\t\tcellTop: cellTop,\n\t\t\toutputOffset: offset,\n\t\t\tcontent: updatedContent\n\t\t}, transfer);\n\n\t\toutputCache.versionId = content.source.model.versionId;\n\t\treturn;\n\t}\n\n\tasync copyImage(output: ICellOutputViewModel): Promise<void> {\n\t\t// Collect text alternates from the same cell output\n\t\tconst textAlternates: { mimeType: string; content: string }[] = [];\n\t\tconst cellOutput = output.model;\n\n\t\tfor (const outputItem of cellOutput.outputs) {\n\t\t\tif (TEXT_BASED_MIMETYPES.includes(outputItem.mime)) {\n\t\t\t\tconst text = isTextStreamMime(outputItem.mime) ?\n\t\t\t\t\tgetOutputStreamText(output).text :\n\t\t\t\t\tgetOutputText(outputItem.mime, outputItem);\n\t\t\t\ttextAlternates.push({\n\t\t\t\t\tmimeType: outputItem.mime,\n\t\t\t\t\tcontent: text\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tthis._sendMessageToWebview({\n\t\t\ttype: 'copyImage',\n\t\t\toutputId: output.model.outputId,\n\t\t\taltOutputId: output.model.alternativeOutputId,\n\t\t\ttextAlternates: textAlternates.length > 0 ? textAlternates : undefined\n\t\t});\n\t}\n\n\tremoveInsets(outputs: readonly ICellOutputViewModel[]): void {\n\t\tif (this._disposed) {\n\t\t\treturn;\n\t\t}\n\n\t\tfor (const output of outputs) {\n\t\t\tconst outputCache = this.insetMapping.get(output);\n\t\t\tif (!outputCache) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tconst id = outputCache.outputId;\n\n\t\t\tthis._sendMessageToWebview({\n\t\t\t\ttype: 'clearOutput',\n\t\t\t\trendererId: outputCache.cachedCreation.rendererId,\n\t\t\t\tcellUri: outputCache.cellInfo.cellUri.toString(),\n\t\t\t\toutputId: id,\n\t\t\t\tcellId: outputCache.cellInfo.cellId\n\t\t\t});\n\t\t\tthis.insetMapping.delete(output);\n\t\t\tthis.pendingWebviewIdleCreationRequest.get(output)?.dispose();\n\t\t\tthis.pendingWebviewIdleCreationRequest.delete(output);\n\t\t\tthis.pendingWebviewIdleInsetMapping.delete(output);\n\t\t\tthis.reversedPendingWebviewIdleInsetMapping.delete(id);\n\t\t\tthis.reversedInsetMapping.delete(id);\n\t\t}\n\t}\n\n\thideInset(output: ICellOutputViewModel): void {\n\t\tif (this._disposed) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst outputCache = this.insetMapping.get(output);\n\t\tif (!outputCache) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.hiddenInsetMapping.add(output);\n\n\t\tthis._sendMessageToWebview({\n\t\t\ttype: 'hideOutput',\n\t\t\toutputId: outputCache.outputId,\n\t\t\tcellId: outputCache.cellInfo.cellId,\n\t\t});\n\t}\n\n\tfocusWebview() {\n\t\tif (this._disposed) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.webview?.focus();\n\t}\n\n\tselectOutputContents(cell: ICellViewModel) {\n\t\tif (this._disposed) {\n\t\t\treturn;\n\t\t}\n\t\tconst output = cell.outputsViewModels.find(o => o.model.outputId === cell.focusedOutputId);\n\t\tconst outputId = output ? this.insetMapping.get(output)?.outputId : undefined;\n\t\tthis._sendMessageToWebview({\n\t\t\ttype: 'select-output-contents',\n\t\t\tcellOrOutputId: outputId || cell.id\n\t\t});\n\t}\n\n\tselectInputContents(cell: ICellViewModel) {\n\t\tif (this._disposed) {\n\t\t\treturn;\n\t\t}\n\t\tconst output = cell.outputsViewModels.find(o => o.model.outputId === cell.focusedOutputId);\n\t\tconst outputId = output ? this.insetMapping.get(output)?.outputId : undefined;\n\t\tthis._sendMessageToWebview({\n\t\t\ttype: 'select-input-contents',\n\t\t\tcellOrOutputId: outputId || cell.id\n\t\t});\n\t}\n\n\tfocusOutput(cellOrOutputId: string, alternateId: string | undefined, viewFocused: boolean) {\n\t\tif (this._disposed) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!viewFocused) {\n\t\t\tthis.webview?.focus();\n\t\t}\n\n\t\tthis._sendMessageToWebview({\n\t\t\ttype: 'focus-output',\n\t\t\tcellOrOutputId: cellOrOutputId,\n\t\t\talternateId: alternateId\n\t\t});\n\t}\n\n\tblurOutput() {\n\t\tif (this._disposed) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._sendMessageToWebview({\n\t\t\ttype: 'blur-output'\n\t\t});\n\t}\n\n\tasync find(query: string, options: { wholeWord?: boolean; caseSensitive?: boolean; includeMarkup: boolean; includeOutput: boolean; shouldGetSearchPreviewInfo: boolean; ownerID: string; findIds: string[] }): Promise<IFindMatch[]> {\n\t\tif (query === '') {\n\t\t\tthis._sendMessageToWebview({\n\t\t\t\ttype: 'findStop',\n\t\t\t\townerID: options.ownerID\n\t\t\t});\n\t\t\treturn [];\n\t\t}\n\n\t\tconst p = new Promise<IFindMatch[]>(resolve => {\n\t\t\tconst sub = this.webview?.onMessage(e => {\n\t\t\t\tif (e.message.type === 'didFind') {\n\t\t\t\t\tresolve(e.message.matches);\n\t\t\t\t\tsub?.dispose();\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\n\t\tthis._sendMessageToWebview({\n\t\t\ttype: 'find',\n\t\t\tquery: query,\n\t\t\toptions\n\t\t});\n\n\t\tconst ret = await p;\n\t\treturn ret;\n\t}\n\n\tfindStop(ownerID: string) {\n\t\tthis._sendMessageToWebview({\n\t\t\ttype: 'findStop',\n\t\t\townerID\n\t\t});\n\t}\n\n\tasync findHighlightCurrent(index: number, ownerID: string): Promise<number> {\n\t\tconst p = new Promise<number>(resolve => {\n\t\t\tconst sub = this.webview?.onMessage(e => {\n\t\t\t\tif (e.message.type === 'didFindHighlightCurrent') {\n\t\t\t\t\tresolve(e.message.offset);\n\t\t\t\t\tsub?.dispose();\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\n\t\tthis._sendMessageToWebview({\n\t\t\ttype: 'findHighlightCurrent',\n\t\t\tindex,\n\t\t\townerID\n\t\t});\n\n\t\tconst ret = await p;\n\t\treturn ret;\n\t}\n\n\tasync findUnHighlightCurrent(index: number, ownerID: string): Promise<void> {\n\t\tthis._sendMessageToWebview({\n\t\t\ttype: 'findUnHighlightCurrent',\n\t\t\tindex,\n\t\t\townerID\n\t\t});\n\t}\n\n\n\tdeltaCellOutputContainerClassNames(cellId: string, added: string[], removed: string[]) {\n\t\tthis._sendMessageToWebview({\n\t\t\ttype: 'decorations',\n\t\t\tcellId,\n\t\t\taddedClassNames: added,\n\t\t\tremovedClassNames: removed\n\t\t});\n\t}\n\n\tdeltaMarkupPreviewClassNames(cellId: string, added: string[], removed: string[]) {\n\t\tif (this.markupPreviewMapping.get(cellId)) {\n\t\t\tthis._sendMessageToWebview({\n\t\t\t\ttype: 'markupDecorations',\n\t\t\t\tcellId,\n\t\t\t\taddedClassNames: added,\n\t\t\t\tremovedClassNames: removed\n\t\t\t});\n\t\t}\n\t}\n\n\tupdateOutputRenderers() {\n\t\tif (!this.webview) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst renderersData = this.getRendererData();\n\t\tthis.localResourceRootsCache = this._getResourceRootsCache();\n\t\tconst mixedResourceRoots = [\n\t\t\t...(this.localResourceRootsCache || []),\n\t\t\t...(this._currentKernel ? [this._currentKernel.localResourceRoot] : []),\n\t\t];\n\n\t\tthis.webview.localResourcesRoot = mixedResourceRoots;\n\t\tthis._sendMessageToWebview({\n\t\t\ttype: 'updateRenderers',\n\t\t\trendererData: renderersData\n\t\t});\n\t}\n\n\tasync updateKernelPreloads(kernel: INotebookKernel | undefined) {\n\t\tif (this._disposed || kernel === this._currentKernel) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst previousKernel = this._currentKernel;\n\t\tthis._currentKernel = kernel;\n\n\t\tif (previousKernel && previousKernel.preloadUris.length > 0) {\n\t\t\tthis.webview?.reload(); // preloads will be restored after reload\n\t\t} else if (kernel) {\n\t\t\tthis._updatePreloadsFromKernel(kernel);\n\t\t}\n\t}\n\n\tprivate _updatePreloadsFromKernel(kernel: INotebookKernel) {\n\t\tconst resources: IControllerPreload[] = [];\n\t\tfor (const preload of kernel.preloadUris) {\n\t\t\tconst uri = this.environmentService.isExtensionDevelopment && (preload.scheme === 'http' || preload.scheme === 'https')\n\t\t\t\t? preload : this.asWebviewUri(preload, undefined);\n\n\t\t\tif (!this._preloadsCache.has(uri.toString())) {\n\t\t\t\tresources.push({ uri: uri.toString(), originalUri: preload.toString() });\n\t\t\t\tthis._preloadsCache.add(uri.toString());\n\t\t\t}\n\t\t}\n\n\t\tif (!resources.length) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._updatePreloads(resources);\n\t}\n\n\tprivate _updatePreloads(resources: IControllerPreload[]) {\n\t\tif (!this.webview) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst mixedResourceRoots = [\n\t\t\t...(this.localResourceRootsCache || []),\n\t\t\t...(this._currentKernel ? [this._currentKernel.localResourceRoot] : []),\n\t\t];\n\n\t\tthis.webview.localResourcesRoot = mixedResourceRoots;\n\n\t\tthis._sendMessageToWebview({\n\t\t\ttype: 'preload',\n\t\t\tresources: resources,\n\t\t});\n\t}\n\n\tprivate _sendMessageToWebview(message: ToWebviewMessage, transfer?: readonly ArrayBuffer[]) {\n\t\tif (this._disposed) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.webview?.postMessage(message, transfer);\n\t}\n\n\toverride dispose() {\n\t\tthis._disposed = true;\n\t\tthis.webview?.dispose();\n\t\tthis.webview = undefined;\n\t\tthis.notebookEditor = null!;\n\t\tthis.insetMapping.clear();\n\t\tthis.pendingWebviewIdleCreationRequest.clear();\n\t\tsuper.dispose();\n\t}\n}\n\nfunction copyBufferIfNeeded(buffer: Uint8Array, transfer: ArrayBuffer[]): Uint8Array {\n\tif (buffer.byteLength === buffer.buffer.byteLength) {\n\t\t// No copy needed but we can't transfer either\n\t\treturn buffer;\n\t} else {\n\t\t// The buffer is smaller than its backing array buffer.\n\t\t// Create a copy to avoid sending the entire array buffer.\n\t\tconst valueBytes = new Uint8Array(buffer);\n\t\ttransfer.push(valueBytes.buffer);\n\t\treturn valueBytes;\n\t}\n}\n\nfunction getTokenizationCss() {\n\tconst colorMap = TokenizationRegistry.getColorMap();\n\tconst tokenizationCss = colorMap ? generateTokensCSSForColorMap(colorMap) : '';\n\treturn tokenizationCss;\n}\n\nfunction tryDecodeURIComponent(uri: string) {\n\ttry {\n\t\treturn decodeURIComponent(uri);\n\t} catch {\n\t\treturn uri;\n\t}\n}\n"]}