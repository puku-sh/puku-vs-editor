{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/contrib/notebook/test/browser/notebookExecutionStateService.test.ts","vs/workbench/contrib/notebook/test/browser/notebookExecutionStateService.test.ts"],"names":[],"mappings":"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","file":"notebookExecutionStateService.test.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport assert from 'assert';\nimport { AsyncIterableProducer, DeferredPromise } from '../../../../../base/common/async.js';\nimport { CancellationToken } from '../../../../../base/common/cancellation.js';\nimport { Event } from '../../../../../base/common/event.js';\nimport { DisposableStore } from '../../../../../base/common/lifecycle.js';\nimport { URI } from '../../../../../base/common/uri.js';\nimport { mock } from '../../../../../base/test/common/mock.js';\nimport { ensureNoDisposablesAreLeakedInTestSuite } from '../../../../../base/test/common/utils.js';\nimport { PLAINTEXT_LANGUAGE_ID } from '../../../../../editor/common/languages/modesRegistry.js';\nimport { IMenu, IMenuService } from '../../../../../platform/actions/common/actions.js';\nimport { ExtensionIdentifier } from '../../../../../platform/extensions/common/extensions.js';\nimport { TestInstantiationService } from '../../../../../platform/instantiation/test/common/instantiationServiceMock.js';\nimport { insertCellAtIndex } from '../../browser/controller/cellOperations.js';\nimport { NotebookExecutionService } from '../../browser/services/notebookExecutionServiceImpl.js';\nimport { NotebookExecutionStateService } from '../../browser/services/notebookExecutionStateServiceImpl.js';\nimport { NotebookKernelService } from '../../browser/services/notebookKernelServiceImpl.js';\nimport { NotebookViewModel } from '../../browser/viewModel/notebookViewModelImpl.js';\nimport { NotebookTextModel } from '../../common/model/notebookTextModel.js';\nimport { CellEditType, CellKind, CellUri, IOutputDto, NotebookCellMetadata, NotebookExecutionState } from '../../common/notebookCommon.js';\nimport { CellExecutionUpdateType, INotebookExecutionService } from '../../common/notebookExecutionService.js';\nimport { INotebookExecutionStateService, NotebookExecutionType } from '../../common/notebookExecutionStateService.js';\nimport { INotebookKernel, INotebookKernelService, VariablesResult } from '../../common/notebookKernelService.js';\nimport { INotebookLoggingService } from '../../common/notebookLoggingService.js';\nimport { INotebookService } from '../../common/notebookService.js';\nimport { setupInstantiationService, withTestNotebook as _withTestNotebook } from './testNotebookEditor.js';\n\nsuite('NotebookExecutionStateService', () => {\n\n\tlet instantiationService: TestInstantiationService;\n\tlet kernelService: INotebookKernelService;\n\tlet disposables: DisposableStore;\n\tlet testNotebookModel: NotebookTextModel | undefined;\n\n\tteardown(() => {\n\t\tdisposables.dispose();\n\t});\n\n\tensureNoDisposablesAreLeakedInTestSuite();\n\n\tsetup(function () {\n\n\t\tdisposables = new DisposableStore();\n\n\t\tinstantiationService = setupInstantiationService(disposables);\n\n\t\tinstantiationService.stub(INotebookService, new class extends mock<INotebookService>() {\n\t\t\toverride onDidAddNotebookDocument = Event.None;\n\t\t\toverride onWillRemoveNotebookDocument = Event.None;\n\t\t\toverride getNotebookTextModels() { return []; }\n\t\t\toverride getNotebookTextModel(uri: URI): NotebookTextModel | undefined {\n\t\t\t\treturn testNotebookModel;\n\t\t\t}\n\t\t});\n\n\t\tinstantiationService.stub(IMenuService, new class extends mock<IMenuService>() {\n\t\t\toverride createMenu() {\n\t\t\t\treturn new class extends mock<IMenu>() {\n\t\t\t\t\toverride onDidChange = Event.None;\n\t\t\t\t\toverride getActions() { return []; }\n\t\t\t\t\toverride dispose() { }\n\t\t\t\t};\n\t\t\t}\n\t\t});\n\t\tinstantiationService.stub(INotebookLoggingService, new class extends mock<INotebookLoggingService>() {\n\t\t\toverride debug(category: string, output: string): void {\n\t\t\t\t//\n\t\t\t}\n\t\t});\n\n\t\tkernelService = disposables.add(instantiationService.createInstance(NotebookKernelService));\n\t\tinstantiationService.set(INotebookKernelService, kernelService);\n\t\tinstantiationService.set(INotebookExecutionService, disposables.add(instantiationService.createInstance(NotebookExecutionService)));\n\t\tinstantiationService.set(INotebookExecutionStateService, disposables.add(instantiationService.createInstance(NotebookExecutionStateService)));\n\t});\n\n\tasync function withTestNotebook(cells: [string, string, CellKind, IOutputDto[], NotebookCellMetadata][], callback: (viewModel: NotebookViewModel, textModel: NotebookTextModel, disposables: DisposableStore) => void | Promise<void>) {\n\t\treturn _withTestNotebook(cells, (editor, viewModel) => callback(viewModel, viewModel.notebookDocument, disposables));\n\t}\n\n\tfunction testCancelOnDelete(expectedCancels: number, implementsInterrupt: boolean) {\n\t\treturn withTestNotebook([], async (viewModel, _document, disposables) => {\n\t\t\ttestNotebookModel = viewModel.notebookDocument;\n\n\t\t\tlet cancels = 0;\n\t\t\tconst kernel = new class extends TestNotebookKernel {\n\t\t\t\timplementsInterrupt = implementsInterrupt;\n\n\t\t\t\tconstructor() {\n\t\t\t\t\tsuper({ languages: ['javascript'] });\n\t\t\t\t}\n\n\t\t\t\toverride async executeNotebookCellsRequest(): Promise<void> { }\n\n\t\t\t\toverride async cancelNotebookCellExecution(_uri: URI, handles: number[]): Promise<void> {\n\t\t\t\t\tcancels += handles.length;\n\t\t\t\t}\n\t\t\t};\n\t\t\tdisposables.add(kernelService.registerKernel(kernel));\n\t\t\tkernelService.selectKernelForNotebook(kernel, viewModel.notebookDocument);\n\n\t\t\tconst executionStateService: INotebookExecutionStateService = instantiationService.get(INotebookExecutionStateService);\n\n\t\t\t// Should cancel executing and pending cells, when kernel does not implement interrupt\n\t\t\tconst cell = disposables.add(insertCellAtIndex(viewModel, 0, 'var c = 3', 'javascript', CellKind.Code, {}, [], true, true));\n\t\t\tconst cell2 = disposables.add(insertCellAtIndex(viewModel, 1, 'var c = 3', 'javascript', CellKind.Code, {}, [], true, true));\n\t\t\tconst cell3 = disposables.add(insertCellAtIndex(viewModel, 2, 'var c = 3', 'javascript', CellKind.Code, {}, [], true, true));\n\t\t\tinsertCellAtIndex(viewModel, 3, 'var c = 3', 'javascript', CellKind.Code, {}, [], true, true); // Not deleted\n\t\t\tconst exe = executionStateService.createCellExecution(viewModel.uri, cell.handle); // Executing\n\t\t\texe.confirm();\n\t\t\texe.update([{ editType: CellExecutionUpdateType.ExecutionState, executionOrder: 1 }]);\n\t\t\tconst exe2 = executionStateService.createCellExecution(viewModel.uri, cell2.handle); // Pending\n\t\t\texe2.confirm();\n\t\t\texecutionStateService.createCellExecution(viewModel.uri, cell3.handle); // Unconfirmed\n\t\t\tassert.strictEqual(cancels, 0);\n\t\t\tviewModel.notebookDocument.applyEdits([{\n\t\t\t\teditType: CellEditType.Replace, index: 0, count: 3, cells: []\n\t\t\t}], true, undefined, () => undefined, undefined, false);\n\t\t\tassert.strictEqual(cancels, expectedCancels);\n\t\t});\n\n\t}\n\n\t// TODO@roblou Could be a test just for NotebookExecutionListeners, which can be a standalone contribution\n\ttest('cancel execution when cell is deleted', async function () {\n\t\treturn testCancelOnDelete(3, false);\n\t});\n\n\ttest('cancel execution when cell is deleted in interrupt-type kernel', async function () {\n\t\treturn testCancelOnDelete(1, true);\n\t});\n\n\ttest('fires onDidChangeCellExecution when cell is completed while deleted', async function () {\n\t\treturn withTestNotebook([], async (viewModel, _document, disposables) => {\n\t\t\ttestNotebookModel = viewModel.notebookDocument;\n\n\t\t\tconst kernel = new TestNotebookKernel();\n\t\t\tdisposables.add(kernelService.registerKernel(kernel));\n\t\t\tkernelService.selectKernelForNotebook(kernel, viewModel.notebookDocument);\n\n\t\t\tconst executionStateService: INotebookExecutionStateService = instantiationService.get(INotebookExecutionStateService);\n\t\t\tconst cell = insertCellAtIndex(viewModel, 0, 'var c = 3', 'javascript', CellKind.Code, {}, [], true, true);\n\t\t\tconst exe = executionStateService.createCellExecution(viewModel.uri, cell.handle);\n\n\t\t\tlet didFire = false;\n\t\t\tdisposables.add(executionStateService.onDidChangeExecution(e => {\n\t\t\t\tif (e.type === NotebookExecutionType.cell) {\n\t\t\t\t\tdidFire = !e.changed;\n\t\t\t\t}\n\t\t\t}));\n\n\t\t\tviewModel.notebookDocument.applyEdits([{\n\t\t\t\teditType: CellEditType.Replace, index: 0, count: 1, cells: []\n\t\t\t}], true, undefined, () => undefined, undefined, false);\n\t\t\texe.complete({});\n\t\t\tassert.strictEqual(didFire, true);\n\t\t});\n\t});\n\n\ttest('does not fire onDidChangeCellExecution for output updates', async function () {\n\t\treturn withTestNotebook([], async (viewModel, _document, disposables) => {\n\t\t\ttestNotebookModel = viewModel.notebookDocument;\n\n\t\t\tconst kernel = new TestNotebookKernel();\n\t\t\tdisposables.add(kernelService.registerKernel(kernel));\n\t\t\tkernelService.selectKernelForNotebook(kernel, viewModel.notebookDocument);\n\n\t\t\tconst executionStateService: INotebookExecutionStateService = instantiationService.get(INotebookExecutionStateService);\n\t\t\tconst cell = disposables.add(insertCellAtIndex(viewModel, 0, 'var c = 3', 'javascript', CellKind.Code, {}, [], true, true));\n\t\t\tconst exe = executionStateService.createCellExecution(viewModel.uri, cell.handle);\n\n\t\t\tlet didFire = false;\n\t\t\tdisposables.add(executionStateService.onDidChangeExecution(e => {\n\t\t\t\tif (e.type === NotebookExecutionType.cell) {\n\t\t\t\t\tdidFire = true;\n\t\t\t\t}\n\t\t\t}));\n\n\t\t\texe.update([{ editType: CellExecutionUpdateType.OutputItems, items: [], outputId: '1' }]);\n\t\t\tassert.strictEqual(didFire, false);\n\t\t\texe.update([{ editType: CellExecutionUpdateType.ExecutionState, executionOrder: 123 }]);\n\t\t\tassert.strictEqual(didFire, true);\n\t\t\texe.complete({});\n\t\t});\n\t});\n\n\t// #142466\n\ttest('getCellExecution and onDidChangeCellExecution', async function () {\n\t\treturn withTestNotebook([], async (viewModel, _document, disposables) => {\n\t\t\ttestNotebookModel = viewModel.notebookDocument;\n\n\t\t\tconst kernel = new TestNotebookKernel();\n\t\t\tdisposables.add(kernelService.registerKernel(kernel));\n\t\t\tkernelService.selectKernelForNotebook(kernel, viewModel.notebookDocument);\n\n\t\t\tconst executionStateService: INotebookExecutionStateService = instantiationService.get(INotebookExecutionStateService);\n\t\t\tconst cell = disposables.add(insertCellAtIndex(viewModel, 0, 'var c = 3', 'javascript', CellKind.Code, {}, [], true, true));\n\n\t\t\tconst deferred = new DeferredPromise<void>();\n\t\t\tdisposables.add(executionStateService.onDidChangeExecution(e => {\n\t\t\t\tif (e.type === NotebookExecutionType.cell) {\n\t\t\t\t\tconst cellUri = CellUri.generate(e.notebook, e.cellHandle);\n\t\t\t\t\tconst exe = executionStateService.getCellExecution(cellUri);\n\t\t\t\t\tassert.ok(exe);\n\t\t\t\t\tassert.strictEqual(e.notebook.toString(), exe.notebook.toString());\n\t\t\t\t\tassert.strictEqual(e.cellHandle, exe.cellHandle);\n\n\t\t\t\t\tassert.strictEqual(exe.notebook.toString(), e.changed?.notebook.toString());\n\t\t\t\t\tassert.strictEqual(exe.cellHandle, e.changed?.cellHandle);\n\n\t\t\t\t\tdeferred.complete();\n\t\t\t\t}\n\t\t\t}));\n\n\t\t\texecutionStateService.createCellExecution(viewModel.uri, cell.handle);\n\n\t\t\treturn deferred.p;\n\t\t});\n\t});\n\ttest('getExecution and onDidChangeExecution', async function () {\n\t\treturn withTestNotebook([], async (viewModel, _document, disposables) => {\n\t\t\ttestNotebookModel = viewModel.notebookDocument;\n\n\t\t\tconst kernel = new TestNotebookKernel();\n\t\t\tdisposables.add(kernelService.registerKernel(kernel));\n\t\t\tkernelService.selectKernelForNotebook(kernel, viewModel.notebookDocument);\n\n\t\t\tconst eventRaisedWithExecution: boolean[] = [];\n\t\t\tconst executionStateService: INotebookExecutionStateService = instantiationService.get(INotebookExecutionStateService);\n\t\t\texecutionStateService.onDidChangeExecution(e => eventRaisedWithExecution.push(e.type === NotebookExecutionType.notebook && !!e.changed), this, disposables);\n\n\t\t\tconst deferred = new DeferredPromise<void>();\n\t\t\tdisposables.add(executionStateService.onDidChangeExecution(e => {\n\t\t\t\tif (e.type === NotebookExecutionType.notebook) {\n\t\t\t\t\tconst exe = executionStateService.getExecution(viewModel.uri);\n\t\t\t\t\tassert.ok(exe);\n\t\t\t\t\tassert.strictEqual(e.notebook.toString(), exe.notebook.toString());\n\t\t\t\t\tassert.ok(e.affectsNotebook(viewModel.uri));\n\t\t\t\t\tassert.deepStrictEqual(eventRaisedWithExecution, [true]);\n\t\t\t\t\tdeferred.complete();\n\t\t\t\t}\n\t\t\t}));\n\n\t\t\texecutionStateService.createExecution(viewModel.uri);\n\n\t\t\treturn deferred.p;\n\t\t});\n\t});\n\n\ttest('getExecution and onDidChangeExecution 2', async function () {\n\t\treturn withTestNotebook([], async (viewModel, _document, disposables) => {\n\t\t\ttestNotebookModel = viewModel.notebookDocument;\n\n\t\t\tconst kernel = new TestNotebookKernel();\n\t\t\tdisposables.add(kernelService.registerKernel(kernel));\n\t\t\tkernelService.selectKernelForNotebook(kernel, viewModel.notebookDocument);\n\n\t\t\tconst executionStateService: INotebookExecutionStateService = instantiationService.get(INotebookExecutionStateService);\n\n\t\t\tconst deferred = new DeferredPromise<void>();\n\t\t\tconst expectedNotebookEventStates: (NotebookExecutionState | undefined)[] = [NotebookExecutionState.Unconfirmed, NotebookExecutionState.Pending, NotebookExecutionState.Executing, undefined];\n\t\t\texecutionStateService.onDidChangeExecution(e => {\n\t\t\t\tif (e.type === NotebookExecutionType.notebook) {\n\t\t\t\t\tconst expectedState = expectedNotebookEventStates.shift();\n\t\t\t\t\tif (typeof expectedState === 'number') {\n\t\t\t\t\t\tconst exe = executionStateService.getExecution(viewModel.uri);\n\t\t\t\t\t\tassert.ok(exe);\n\t\t\t\t\t\tassert.strictEqual(e.notebook.toString(), exe.notebook.toString());\n\t\t\t\t\t\tassert.strictEqual(e.changed?.state, expectedState);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tassert.ok(e.changed === undefined);\n\t\t\t\t\t}\n\n\t\t\t\t\tassert.ok(e.affectsNotebook(viewModel.uri));\n\t\t\t\t\tif (expectedNotebookEventStates.length === 0) {\n\t\t\t\t\t\tdeferred.complete();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}, this, disposables);\n\n\t\t\tconst execution = executionStateService.createExecution(viewModel.uri);\n\t\t\texecution.confirm();\n\t\t\texecution.begin();\n\t\t\texecution.complete();\n\n\t\t\treturn deferred.p;\n\t\t});\n\t});\n\n\ttest('force-cancel works for Cell Execution', async function () {\n\t\treturn withTestNotebook([], async (viewModel, _document, disposables) => {\n\t\t\ttestNotebookModel = viewModel.notebookDocument;\n\n\t\t\tconst kernel = new TestNotebookKernel();\n\t\t\tdisposables.add(kernelService.registerKernel(kernel));\n\t\t\tkernelService.selectKernelForNotebook(kernel, viewModel.notebookDocument);\n\n\t\t\tconst executionStateService: INotebookExecutionStateService = instantiationService.get(INotebookExecutionStateService);\n\t\t\tconst cell = disposables.add(insertCellAtIndex(viewModel, 0, 'var c = 3', 'javascript', CellKind.Code, {}, [], true, true));\n\t\t\texecutionStateService.createCellExecution(viewModel.uri, cell.handle);\n\t\t\tconst exe = executionStateService.getCellExecution(cell.uri);\n\t\t\tassert.ok(exe);\n\n\t\t\texecutionStateService.forceCancelNotebookExecutions(viewModel.uri);\n\t\t\tconst exe2 = executionStateService.getCellExecution(cell.uri);\n\t\t\tassert.strictEqual(exe2, undefined);\n\t\t});\n\t});\n\ttest('force-cancel works for Notebook Execution', async function () {\n\t\treturn withTestNotebook([], async (viewModel, _document, disposables) => {\n\t\t\ttestNotebookModel = viewModel.notebookDocument;\n\n\t\t\tconst kernel = new TestNotebookKernel();\n\t\t\tdisposables.add(kernelService.registerKernel(kernel));\n\t\t\tkernelService.selectKernelForNotebook(kernel, viewModel.notebookDocument);\n\t\t\tconst eventRaisedWithExecution: boolean[] = [];\n\n\t\t\tconst executionStateService: INotebookExecutionStateService = instantiationService.get(INotebookExecutionStateService);\n\t\t\texecutionStateService.onDidChangeExecution(e => eventRaisedWithExecution.push(e.type === NotebookExecutionType.notebook && !!e.changed), this, disposables);\n\t\t\texecutionStateService.createExecution(viewModel.uri);\n\t\t\tconst exe = executionStateService.getExecution(viewModel.uri);\n\t\t\tassert.ok(exe);\n\t\t\tassert.deepStrictEqual(eventRaisedWithExecution, [true]);\n\n\t\t\texecutionStateService.forceCancelNotebookExecutions(viewModel.uri);\n\t\t\tconst exe2 = executionStateService.getExecution(viewModel.uri);\n\t\t\tassert.deepStrictEqual(eventRaisedWithExecution, [true, false]);\n\t\t\tassert.strictEqual(exe2, undefined);\n\t\t});\n\t});\n\ttest('force-cancel works for Cell and Notebook Execution', async function () {\n\t\treturn withTestNotebook([], async (viewModel, _document, disposables) => {\n\t\t\ttestNotebookModel = viewModel.notebookDocument;\n\n\t\t\tconst kernel = new TestNotebookKernel();\n\t\t\tdisposables.add(kernelService.registerKernel(kernel));\n\t\t\tkernelService.selectKernelForNotebook(kernel, viewModel.notebookDocument);\n\n\t\t\tconst executionStateService: INotebookExecutionStateService = instantiationService.get(INotebookExecutionStateService);\n\t\t\texecutionStateService.createExecution(viewModel.uri);\n\t\t\texecutionStateService.createExecution(viewModel.uri);\n\t\t\tconst cellExe = executionStateService.getExecution(viewModel.uri);\n\t\t\tconst exe = executionStateService.getExecution(viewModel.uri);\n\t\t\tassert.ok(cellExe);\n\t\t\tassert.ok(exe);\n\n\t\t\texecutionStateService.forceCancelNotebookExecutions(viewModel.uri);\n\t\t\tconst cellExe2 = executionStateService.getExecution(viewModel.uri);\n\t\t\tconst exe2 = executionStateService.getExecution(viewModel.uri);\n\t\t\tassert.strictEqual(cellExe2, undefined);\n\t\t\tassert.strictEqual(exe2, undefined);\n\t\t});\n\t});\n});\n\nclass TestNotebookKernel implements INotebookKernel {\n\tid: string = 'test';\n\tlabel: string = '';\n\tviewType = '*';\n\tonDidChange = Event.None;\n\textension: ExtensionIdentifier = new ExtensionIdentifier('test');\n\tlocalResourceRoot: URI = URI.file('/test');\n\tdescription?: string | undefined;\n\tdetail?: string | undefined;\n\tpreloadUris: URI[] = [];\n\tpreloadProvides: string[] = [];\n\tsupportedLanguages: string[] = [];\n\tasync executeNotebookCellsRequest(): Promise<void> { }\n\tasync cancelNotebookCellExecution(uri: URI, cellHandles: number[]): Promise<void> { }\n\tprovideVariables(notebookUri: URI, parentId: number | undefined, kind: 'named' | 'indexed', start: number, token: CancellationToken): AsyncIterableProducer<VariablesResult> {\n\t\treturn AsyncIterableProducer.EMPTY;\n\t}\n\n\tconstructor(opts?: { languages?: string[]; id?: string }) {\n\t\tthis.supportedLanguages = opts?.languages ?? [PLAINTEXT_LANGUAGE_ID];\n\t\tif (opts?.id) {\n\t\t\tthis.id = opts?.id;\n\t\t}\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport assert from 'assert';\nimport { AsyncIterableProducer, DeferredPromise } from '../../../../../base/common/async.js';\nimport { CancellationToken } from '../../../../../base/common/cancellation.js';\nimport { Event } from '../../../../../base/common/event.js';\nimport { DisposableStore } from '../../../../../base/common/lifecycle.js';\nimport { URI } from '../../../../../base/common/uri.js';\nimport { mock } from '../../../../../base/test/common/mock.js';\nimport { ensureNoDisposablesAreLeakedInTestSuite } from '../../../../../base/test/common/utils.js';\nimport { PLAINTEXT_LANGUAGE_ID } from '../../../../../editor/common/languages/modesRegistry.js';\nimport { IMenu, IMenuService } from '../../../../../platform/actions/common/actions.js';\nimport { ExtensionIdentifier } from '../../../../../platform/extensions/common/extensions.js';\nimport { TestInstantiationService } from '../../../../../platform/instantiation/test/common/instantiationServiceMock.js';\nimport { insertCellAtIndex } from '../../browser/controller/cellOperations.js';\nimport { NotebookExecutionService } from '../../browser/services/notebookExecutionServiceImpl.js';\nimport { NotebookExecutionStateService } from '../../browser/services/notebookExecutionStateServiceImpl.js';\nimport { NotebookKernelService } from '../../browser/services/notebookKernelServiceImpl.js';\nimport { NotebookViewModel } from '../../browser/viewModel/notebookViewModelImpl.js';\nimport { NotebookTextModel } from '../../common/model/notebookTextModel.js';\nimport { CellEditType, CellKind, CellUri, IOutputDto, NotebookCellMetadata, NotebookExecutionState } from '../../common/notebookCommon.js';\nimport { CellExecutionUpdateType, INotebookExecutionService } from '../../common/notebookExecutionService.js';\nimport { INotebookExecutionStateService, NotebookExecutionType } from '../../common/notebookExecutionStateService.js';\nimport { INotebookKernel, INotebookKernelService, VariablesResult } from '../../common/notebookKernelService.js';\nimport { INotebookLoggingService } from '../../common/notebookLoggingService.js';\nimport { INotebookService } from '../../common/notebookService.js';\nimport { setupInstantiationService, withTestNotebook as _withTestNotebook } from './testNotebookEditor.js';\n\nsuite('NotebookExecutionStateService', () => {\n\n\tlet instantiationService: TestInstantiationService;\n\tlet kernelService: INotebookKernelService;\n\tlet disposables: DisposableStore;\n\tlet testNotebookModel: NotebookTextModel | undefined;\n\n\tteardown(() => {\n\t\tdisposables.dispose();\n\t});\n\n\tensureNoDisposablesAreLeakedInTestSuite();\n\n\tsetup(function () {\n\n\t\tdisposables = new DisposableStore();\n\n\t\tinstantiationService = setupInstantiationService(disposables);\n\n\t\tinstantiationService.stub(INotebookService, new class extends mock<INotebookService>() {\n\t\t\toverride onDidAddNotebookDocument = Event.None;\n\t\t\toverride onWillRemoveNotebookDocument = Event.None;\n\t\t\toverride getNotebookTextModels() { return []; }\n\t\t\toverride getNotebookTextModel(uri: URI): NotebookTextModel | undefined {\n\t\t\t\treturn testNotebookModel;\n\t\t\t}\n\t\t});\n\n\t\tinstantiationService.stub(IMenuService, new class extends mock<IMenuService>() {\n\t\t\toverride createMenu() {\n\t\t\t\treturn new class extends mock<IMenu>() {\n\t\t\t\t\toverride onDidChange = Event.None;\n\t\t\t\t\toverride getActions() { return []; }\n\t\t\t\t\toverride dispose() { }\n\t\t\t\t};\n\t\t\t}\n\t\t});\n\t\tinstantiationService.stub(INotebookLoggingService, new class extends mock<INotebookLoggingService>() {\n\t\t\toverride debug(category: string, output: string): void {\n\t\t\t\t//\n\t\t\t}\n\t\t});\n\n\t\tkernelService = disposables.add(instantiationService.createInstance(NotebookKernelService));\n\t\tinstantiationService.set(INotebookKernelService, kernelService);\n\t\tinstantiationService.set(INotebookExecutionService, disposables.add(instantiationService.createInstance(NotebookExecutionService)));\n\t\tinstantiationService.set(INotebookExecutionStateService, disposables.add(instantiationService.createInstance(NotebookExecutionStateService)));\n\t});\n\n\tasync function withTestNotebook(cells: [string, string, CellKind, IOutputDto[], NotebookCellMetadata][], callback: (viewModel: NotebookViewModel, textModel: NotebookTextModel, disposables: DisposableStore) => void | Promise<void>) {\n\t\treturn _withTestNotebook(cells, (editor, viewModel) => callback(viewModel, viewModel.notebookDocument, disposables));\n\t}\n\n\tfunction testCancelOnDelete(expectedCancels: number, implementsInterrupt: boolean) {\n\t\treturn withTestNotebook([], async (viewModel, _document, disposables) => {\n\t\t\ttestNotebookModel = viewModel.notebookDocument;\n\n\t\t\tlet cancels = 0;\n\t\t\tconst kernel = new class extends TestNotebookKernel {\n\t\t\t\timplementsInterrupt = implementsInterrupt;\n\n\t\t\t\tconstructor() {\n\t\t\t\t\tsuper({ languages: ['javascript'] });\n\t\t\t\t}\n\n\t\t\t\toverride async executeNotebookCellsRequest(): Promise<void> { }\n\n\t\t\t\toverride async cancelNotebookCellExecution(_uri: URI, handles: number[]): Promise<void> {\n\t\t\t\t\tcancels += handles.length;\n\t\t\t\t}\n\t\t\t};\n\t\t\tdisposables.add(kernelService.registerKernel(kernel));\n\t\t\tkernelService.selectKernelForNotebook(kernel, viewModel.notebookDocument);\n\n\t\t\tconst executionStateService: INotebookExecutionStateService = instantiationService.get(INotebookExecutionStateService);\n\n\t\t\t// Should cancel executing and pending cells, when kernel does not implement interrupt\n\t\t\tconst cell = disposables.add(insertCellAtIndex(viewModel, 0, 'var c = 3', 'javascript', CellKind.Code, {}, [], true, true));\n\t\t\tconst cell2 = disposables.add(insertCellAtIndex(viewModel, 1, 'var c = 3', 'javascript', CellKind.Code, {}, [], true, true));\n\t\t\tconst cell3 = disposables.add(insertCellAtIndex(viewModel, 2, 'var c = 3', 'javascript', CellKind.Code, {}, [], true, true));\n\t\t\tinsertCellAtIndex(viewModel, 3, 'var c = 3', 'javascript', CellKind.Code, {}, [], true, true); // Not deleted\n\t\t\tconst exe = executionStateService.createCellExecution(viewModel.uri, cell.handle); // Executing\n\t\t\texe.confirm();\n\t\t\texe.update([{ editType: CellExecutionUpdateType.ExecutionState, executionOrder: 1 }]);\n\t\t\tconst exe2 = executionStateService.createCellExecution(viewModel.uri, cell2.handle); // Pending\n\t\t\texe2.confirm();\n\t\t\texecutionStateService.createCellExecution(viewModel.uri, cell3.handle); // Unconfirmed\n\t\t\tassert.strictEqual(cancels, 0);\n\t\t\tviewModel.notebookDocument.applyEdits([{\n\t\t\t\teditType: CellEditType.Replace, index: 0, count: 3, cells: []\n\t\t\t}], true, undefined, () => undefined, undefined, false);\n\t\t\tassert.strictEqual(cancels, expectedCancels);\n\t\t});\n\n\t}\n\n\t// TODO@roblou Could be a test just for NotebookExecutionListeners, which can be a standalone contribution\n\ttest('cancel execution when cell is deleted', async function () {\n\t\treturn testCancelOnDelete(3, false);\n\t});\n\n\ttest('cancel execution when cell is deleted in interrupt-type kernel', async function () {\n\t\treturn testCancelOnDelete(1, true);\n\t});\n\n\ttest('fires onDidChangeCellExecution when cell is completed while deleted', async function () {\n\t\treturn withTestNotebook([], async (viewModel, _document, disposables) => {\n\t\t\ttestNotebookModel = viewModel.notebookDocument;\n\n\t\t\tconst kernel = new TestNotebookKernel();\n\t\t\tdisposables.add(kernelService.registerKernel(kernel));\n\t\t\tkernelService.selectKernelForNotebook(kernel, viewModel.notebookDocument);\n\n\t\t\tconst executionStateService: INotebookExecutionStateService = instantiationService.get(INotebookExecutionStateService);\n\t\t\tconst cell = insertCellAtIndex(viewModel, 0, 'var c = 3', 'javascript', CellKind.Code, {}, [], true, true);\n\t\t\tconst exe = executionStateService.createCellExecution(viewModel.uri, cell.handle);\n\n\t\t\tlet didFire = false;\n\t\t\tdisposables.add(executionStateService.onDidChangeExecution(e => {\n\t\t\t\tif (e.type === NotebookExecutionType.cell) {\n\t\t\t\t\tdidFire = !e.changed;\n\t\t\t\t}\n\t\t\t}));\n\n\t\t\tviewModel.notebookDocument.applyEdits([{\n\t\t\t\teditType: CellEditType.Replace, index: 0, count: 1, cells: []\n\t\t\t}], true, undefined, () => undefined, undefined, false);\n\t\t\texe.complete({});\n\t\t\tassert.strictEqual(didFire, true);\n\t\t});\n\t});\n\n\ttest('does not fire onDidChangeCellExecution for output updates', async function () {\n\t\treturn withTestNotebook([], async (viewModel, _document, disposables) => {\n\t\t\ttestNotebookModel = viewModel.notebookDocument;\n\n\t\t\tconst kernel = new TestNotebookKernel();\n\t\t\tdisposables.add(kernelService.registerKernel(kernel));\n\t\t\tkernelService.selectKernelForNotebook(kernel, viewModel.notebookDocument);\n\n\t\t\tconst executionStateService: INotebookExecutionStateService = instantiationService.get(INotebookExecutionStateService);\n\t\t\tconst cell = disposables.add(insertCellAtIndex(viewModel, 0, 'var c = 3', 'javascript', CellKind.Code, {}, [], true, true));\n\t\t\tconst exe = executionStateService.createCellExecution(viewModel.uri, cell.handle);\n\n\t\t\tlet didFire = false;\n\t\t\tdisposables.add(executionStateService.onDidChangeExecution(e => {\n\t\t\t\tif (e.type === NotebookExecutionType.cell) {\n\t\t\t\t\tdidFire = true;\n\t\t\t\t}\n\t\t\t}));\n\n\t\t\texe.update([{ editType: CellExecutionUpdateType.OutputItems, items: [], outputId: '1' }]);\n\t\t\tassert.strictEqual(didFire, false);\n\t\t\texe.update([{ editType: CellExecutionUpdateType.ExecutionState, executionOrder: 123 }]);\n\t\t\tassert.strictEqual(didFire, true);\n\t\t\texe.complete({});\n\t\t});\n\t});\n\n\t// #142466\n\ttest('getCellExecution and onDidChangeCellExecution', async function () {\n\t\treturn withTestNotebook([], async (viewModel, _document, disposables) => {\n\t\t\ttestNotebookModel = viewModel.notebookDocument;\n\n\t\t\tconst kernel = new TestNotebookKernel();\n\t\t\tdisposables.add(kernelService.registerKernel(kernel));\n\t\t\tkernelService.selectKernelForNotebook(kernel, viewModel.notebookDocument);\n\n\t\t\tconst executionStateService: INotebookExecutionStateService = instantiationService.get(INotebookExecutionStateService);\n\t\t\tconst cell = disposables.add(insertCellAtIndex(viewModel, 0, 'var c = 3', 'javascript', CellKind.Code, {}, [], true, true));\n\n\t\t\tconst deferred = new DeferredPromise<void>();\n\t\t\tdisposables.add(executionStateService.onDidChangeExecution(e => {\n\t\t\t\tif (e.type === NotebookExecutionType.cell) {\n\t\t\t\t\tconst cellUri = CellUri.generate(e.notebook, e.cellHandle);\n\t\t\t\t\tconst exe = executionStateService.getCellExecution(cellUri);\n\t\t\t\t\tassert.ok(exe);\n\t\t\t\t\tassert.strictEqual(e.notebook.toString(), exe.notebook.toString());\n\t\t\t\t\tassert.strictEqual(e.cellHandle, exe.cellHandle);\n\n\t\t\t\t\tassert.strictEqual(exe.notebook.toString(), e.changed?.notebook.toString());\n\t\t\t\t\tassert.strictEqual(exe.cellHandle, e.changed?.cellHandle);\n\n\t\t\t\t\tdeferred.complete();\n\t\t\t\t}\n\t\t\t}));\n\n\t\t\texecutionStateService.createCellExecution(viewModel.uri, cell.handle);\n\n\t\t\treturn deferred.p;\n\t\t});\n\t});\n\ttest('getExecution and onDidChangeExecution', async function () {\n\t\treturn withTestNotebook([], async (viewModel, _document, disposables) => {\n\t\t\ttestNotebookModel = viewModel.notebookDocument;\n\n\t\t\tconst kernel = new TestNotebookKernel();\n\t\t\tdisposables.add(kernelService.registerKernel(kernel));\n\t\t\tkernelService.selectKernelForNotebook(kernel, viewModel.notebookDocument);\n\n\t\t\tconst eventRaisedWithExecution: boolean[] = [];\n\t\t\tconst executionStateService: INotebookExecutionStateService = instantiationService.get(INotebookExecutionStateService);\n\t\t\texecutionStateService.onDidChangeExecution(e => eventRaisedWithExecution.push(e.type === NotebookExecutionType.notebook && !!e.changed), this, disposables);\n\n\t\t\tconst deferred = new DeferredPromise<void>();\n\t\t\tdisposables.add(executionStateService.onDidChangeExecution(e => {\n\t\t\t\tif (e.type === NotebookExecutionType.notebook) {\n\t\t\t\t\tconst exe = executionStateService.getExecution(viewModel.uri);\n\t\t\t\t\tassert.ok(exe);\n\t\t\t\t\tassert.strictEqual(e.notebook.toString(), exe.notebook.toString());\n\t\t\t\t\tassert.ok(e.affectsNotebook(viewModel.uri));\n\t\t\t\t\tassert.deepStrictEqual(eventRaisedWithExecution, [true]);\n\t\t\t\t\tdeferred.complete();\n\t\t\t\t}\n\t\t\t}));\n\n\t\t\texecutionStateService.createExecution(viewModel.uri);\n\n\t\t\treturn deferred.p;\n\t\t});\n\t});\n\n\ttest('getExecution and onDidChangeExecution 2', async function () {\n\t\treturn withTestNotebook([], async (viewModel, _document, disposables) => {\n\t\t\ttestNotebookModel = viewModel.notebookDocument;\n\n\t\t\tconst kernel = new TestNotebookKernel();\n\t\t\tdisposables.add(kernelService.registerKernel(kernel));\n\t\t\tkernelService.selectKernelForNotebook(kernel, viewModel.notebookDocument);\n\n\t\t\tconst executionStateService: INotebookExecutionStateService = instantiationService.get(INotebookExecutionStateService);\n\n\t\t\tconst deferred = new DeferredPromise<void>();\n\t\t\tconst expectedNotebookEventStates: (NotebookExecutionState | undefined)[] = [NotebookExecutionState.Unconfirmed, NotebookExecutionState.Pending, NotebookExecutionState.Executing, undefined];\n\t\t\texecutionStateService.onDidChangeExecution(e => {\n\t\t\t\tif (e.type === NotebookExecutionType.notebook) {\n\t\t\t\t\tconst expectedState = expectedNotebookEventStates.shift();\n\t\t\t\t\tif (typeof expectedState === 'number') {\n\t\t\t\t\t\tconst exe = executionStateService.getExecution(viewModel.uri);\n\t\t\t\t\t\tassert.ok(exe);\n\t\t\t\t\t\tassert.strictEqual(e.notebook.toString(), exe.notebook.toString());\n\t\t\t\t\t\tassert.strictEqual(e.changed?.state, expectedState);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tassert.ok(e.changed === undefined);\n\t\t\t\t\t}\n\n\t\t\t\t\tassert.ok(e.affectsNotebook(viewModel.uri));\n\t\t\t\t\tif (expectedNotebookEventStates.length === 0) {\n\t\t\t\t\t\tdeferred.complete();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}, this, disposables);\n\n\t\t\tconst execution = executionStateService.createExecution(viewModel.uri);\n\t\t\texecution.confirm();\n\t\t\texecution.begin();\n\t\t\texecution.complete();\n\n\t\t\treturn deferred.p;\n\t\t});\n\t});\n\n\ttest('force-cancel works for Cell Execution', async function () {\n\t\treturn withTestNotebook([], async (viewModel, _document, disposables) => {\n\t\t\ttestNotebookModel = viewModel.notebookDocument;\n\n\t\t\tconst kernel = new TestNotebookKernel();\n\t\t\tdisposables.add(kernelService.registerKernel(kernel));\n\t\t\tkernelService.selectKernelForNotebook(kernel, viewModel.notebookDocument);\n\n\t\t\tconst executionStateService: INotebookExecutionStateService = instantiationService.get(INotebookExecutionStateService);\n\t\t\tconst cell = disposables.add(insertCellAtIndex(viewModel, 0, 'var c = 3', 'javascript', CellKind.Code, {}, [], true, true));\n\t\t\texecutionStateService.createCellExecution(viewModel.uri, cell.handle);\n\t\t\tconst exe = executionStateService.getCellExecution(cell.uri);\n\t\t\tassert.ok(exe);\n\n\t\t\texecutionStateService.forceCancelNotebookExecutions(viewModel.uri);\n\t\t\tconst exe2 = executionStateService.getCellExecution(cell.uri);\n\t\t\tassert.strictEqual(exe2, undefined);\n\t\t});\n\t});\n\ttest('force-cancel works for Notebook Execution', async function () {\n\t\treturn withTestNotebook([], async (viewModel, _document, disposables) => {\n\t\t\ttestNotebookModel = viewModel.notebookDocument;\n\n\t\t\tconst kernel = new TestNotebookKernel();\n\t\t\tdisposables.add(kernelService.registerKernel(kernel));\n\t\t\tkernelService.selectKernelForNotebook(kernel, viewModel.notebookDocument);\n\t\t\tconst eventRaisedWithExecution: boolean[] = [];\n\n\t\t\tconst executionStateService: INotebookExecutionStateService = instantiationService.get(INotebookExecutionStateService);\n\t\t\texecutionStateService.onDidChangeExecution(e => eventRaisedWithExecution.push(e.type === NotebookExecutionType.notebook && !!e.changed), this, disposables);\n\t\t\texecutionStateService.createExecution(viewModel.uri);\n\t\t\tconst exe = executionStateService.getExecution(viewModel.uri);\n\t\t\tassert.ok(exe);\n\t\t\tassert.deepStrictEqual(eventRaisedWithExecution, [true]);\n\n\t\t\texecutionStateService.forceCancelNotebookExecutions(viewModel.uri);\n\t\t\tconst exe2 = executionStateService.getExecution(viewModel.uri);\n\t\t\tassert.deepStrictEqual(eventRaisedWithExecution, [true, false]);\n\t\t\tassert.strictEqual(exe2, undefined);\n\t\t});\n\t});\n\ttest('force-cancel works for Cell and Notebook Execution', async function () {\n\t\treturn withTestNotebook([], async (viewModel, _document, disposables) => {\n\t\t\ttestNotebookModel = viewModel.notebookDocument;\n\n\t\t\tconst kernel = new TestNotebookKernel();\n\t\t\tdisposables.add(kernelService.registerKernel(kernel));\n\t\t\tkernelService.selectKernelForNotebook(kernel, viewModel.notebookDocument);\n\n\t\t\tconst executionStateService: INotebookExecutionStateService = instantiationService.get(INotebookExecutionStateService);\n\t\t\texecutionStateService.createExecution(viewModel.uri);\n\t\t\texecutionStateService.createExecution(viewModel.uri);\n\t\t\tconst cellExe = executionStateService.getExecution(viewModel.uri);\n\t\t\tconst exe = executionStateService.getExecution(viewModel.uri);\n\t\t\tassert.ok(cellExe);\n\t\t\tassert.ok(exe);\n\n\t\t\texecutionStateService.forceCancelNotebookExecutions(viewModel.uri);\n\t\t\tconst cellExe2 = executionStateService.getExecution(viewModel.uri);\n\t\t\tconst exe2 = executionStateService.getExecution(viewModel.uri);\n\t\t\tassert.strictEqual(cellExe2, undefined);\n\t\t\tassert.strictEqual(exe2, undefined);\n\t\t});\n\t});\n});\n\nclass TestNotebookKernel implements INotebookKernel {\n\tid: string = 'test';\n\tlabel: string = '';\n\tviewType = '*';\n\tonDidChange = Event.None;\n\textension: ExtensionIdentifier = new ExtensionIdentifier('test');\n\tlocalResourceRoot: URI = URI.file('/test');\n\tdescription?: string | undefined;\n\tdetail?: string | undefined;\n\tpreloadUris: URI[] = [];\n\tpreloadProvides: string[] = [];\n\tsupportedLanguages: string[] = [];\n\tasync executeNotebookCellsRequest(): Promise<void> { }\n\tasync cancelNotebookCellExecution(uri: URI, cellHandles: number[]): Promise<void> { }\n\tprovideVariables(notebookUri: URI, parentId: number | undefined, kind: 'named' | 'indexed', start: number, token: CancellationToken): AsyncIterableProducer<VariablesResult> {\n\t\treturn AsyncIterableProducer.EMPTY;\n\t}\n\n\tconstructor(opts?: { languages?: string[]; id?: string }) {\n\t\tthis.supportedLanguages = opts?.languages ?? [PLAINTEXT_LANGUAGE_ID];\n\t\tif (opts?.id) {\n\t\t\tthis.id = opts?.id;\n\t\t}\n\t}\n}\n"]}