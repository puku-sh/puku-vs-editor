{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/contrib/notebook/test/browser/contrib/notebookSymbols.test.ts","vs/workbench/contrib/notebook/test/browser/contrib/notebookSymbols.test.ts"],"names":[],"mappings":"AAAA;;;gGAGgG;AAEhG,OAAO,MAAM,MAAM,QAAQ,CAAC;AAC5B,OAAO,EAAE,iBAAiB,EAAE,MAAM,+CAA+C,CAAC;AAClF,OAAO,EAAE,IAAI,EAAE,MAAM,4CAA4C,CAAC;AAClE,OAAO,EAAE,uCAAuC,EAAE,MAAM,6CAA6C,CAAC;AAItG,OAAO,EAAE,2BAA2B,EAAE,MAAM,2DAA2D,CAAC;AAOxG,KAAK,CAAC,kBAAkB,EAAE;IACzB,uCAAuC,EAAE,CAAC;IAE1C,MAAM,mBAAmB,GAAyC,EAAE,CAAC;IACrE,SAAS,sBAAsB,CAAC,OAA6B,EAAE,WAAW,GAAG,QAAQ;QACpF,mBAAmB,CAAC,WAAW,CAAC,GAAG,OAAO,CAAC;IAC5C,CAAC;IAED,MAAM,gBAAgB,GAAG,IAAI,KAAM,SAAQ,IAAI,EAAkC;QACvE,gBAAgB,KAAK,OAAO,SAAS,CAAC,CAAC,CAAC;KACjD,CAAC;IAEF,MAAM,gBAAgB;QACrB,YAAoB,MAAc;YAAd,WAAM,GAAN,MAAM,CAAQ;QAAI,CAAC;QAEvC,kBAAkB;YACjB,OAAO,mBAAmB,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;QACzC,CAAC;KACD;IACD,MAAM,mBAAmB,GAAG,IAAI,KAAM,SAAQ,IAAI,EAAwB;QAChE,WAAW,CAAC,KAAiB,EAAE,IAAS;YAChD,MAAM,OAAO,GAAG,IAAI,gBAAgB,CAAC,KAAK,CAAC,EAAE,CAA4B,CAAC;YAC1E,OAAO,OAAO,CAAC,OAAO,CAAC,OAAO,CAAC,CAAC;QACjC,CAAC;QACQ,gBAAgB,CAAC,IAAS;YAClC,OAAO,CAAC,CAAC;QACV,CAAC;KACD,CAAC;IACF,MAAM,gBAAgB,GAAG,IAAI,KAAM,SAAQ,IAAI,EAAqB;QAC1D,oBAAoB,CAAC,GAAQ;YACrC,OAAO,OAAO,CAAC,OAAO,CAAC;gBACtB,MAAM,EAAE;oBACP,eAAe,EAAE;wBAChB,EAAE,EAAE,GAAG,CAAC,QAAQ,EAAE;wBAClB,YAAY,KAAK,OAAO,CAAC,CAAC,CAAC,CAAC;qBAC5B;iBACD;gBACD,OAAO,KAAK,CAAC;aAC2B,CAAC,CAAC;QAC5C,CAAC;KACD,CAAC;IAEF,SAAS,mBAAmB,CAAC,UAAkB,CAAC,EAAE,WAAW,GAAG,QAAQ;QACvE,OAAO;YACN,EAAE,EAAE,WAAW;YACf,GAAG,EAAE,EAAE,QAAQ,KAAK,OAAO,WAAW,CAAC,CAAC,CAAC,EAAE;YAC3C,UAAU,EAAE;gBACX,YAAY,KAAK,OAAO,CAAC,CAAC,CAAC,CAAC;aAC5B;YACD,OAAO;gBACN,OAAO,QAAQ,CAAC;YACjB,CAAC;YACD,KAAK,EAAE;gBACN,SAAS,EAAE;oBACV,EAAE,EAAE,WAAW;oBACf,YAAY,KAAK,OAAO,OAAO,CAAC,CAAC,CAAC;iBAClC;aACD;YACD,gBAAgB;gBACf,OAAO,IAAI,CAAC,KAAK,CAAC,SAAoB,CAAC;YACxC,CAAC;SACiB,CAAC;IACrB,CAAC;IAED,IAAI,CAAC,4BAA4B,EAAE;QAClC,sBAAsB,CAAC,CAAC,EAAE,IAAI,EAAE,KAAK,EAAE,KAAK,EAAE,EAAE,EAAE,CAAC,CAAC,CAAC;QACrD,MAAM,YAAY,GAAG,IAAI,2BAA2B,CAAC,gBAAgB,EAAE,mBAAmB,EAAE,gBAAgB,CAAC,CAAC;QAC9G,MAAM,OAAO,GAAG,YAAY,CAAC,iBAAiB,CAAC,mBAAmB,EAAE,EAAE,CAAC,CAAC,CAAC;QAEzE,MAAM,CAAC,KAAK,CAAC,OAAO,CAAC,MAAM,EAAE,CAAC,EAAE,oBAAoB,CAAC,CAAC;QACtD,MAAM,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC,KAAK,EAAE,QAAQ,EAAE,8CAA8C,CAAC,CAAC;IAC1F,CAAC,CAAC,CAAC;IAEH,IAAI,CAAC,0BAA0B,EAAE,KAAK;QACrC,sBAAsB,CAAC,CAAC,EAAE,IAAI,EAAE,MAAM,EAAE,KAAK,EAAE,EAAE,EAAE,EAAE,EAAE,IAAI,EAAE,MAAM,EAAE,KAAK,EAAE,EAAE,EAAE,CAAC,CAAC,CAAC;QACnF,MAAM,YAAY,GAAG,IAAI,2BAA2B,CAAC,gBAAgB,EAAE,mBAAmB,EAAE,gBAAgB,CAAC,CAAC;QAC9G,MAAM,IAAI,GAAG,mBAAmB,EAAE,CAAC;QAEnC,MAAM,YAAY,CAAC,YAAY,CAAC,IAAI,EAAE,iBAAiB,CAAC,IAAI,CAAC,CAAC;QAC9D,MAAM,OAAO,GAAG,YAAY,CAAC,iBAAiB,CAAC,IAAI,EAAE,CAAC,CAAC,CAAC;QAExD,MAAM,CAAC,KAAK,CAAC,OAAO,CAAC,MAAM,EAAE,CAAC,EAAE,iCAAiC,CAAC,CAAC;QACnE,MAAM,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC,KAAK,EAAE,QAAQ,CAAC,CAAC;QACzC,MAAM,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC,KAAK,EAAE,MAAM,CAAC,CAAC;QACvC,kFAAkF;QAClF,MAAM,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC,KAAK,EAAE,CAAC,CAAC,CAAC;QAClC,MAAM,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC,KAAK,EAAE,CAAC,CAAC,CAAC;QAClC,MAAM,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC,KAAK,EAAE,MAAM,CAAC,CAAC;QACvC,MAAM,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC,KAAK,EAAE,CAAC,CAAC,CAAC;QAClC,MAAM,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC,KAAK,EAAE,CAAC,CAAC,CAAC;IACnC,CAAC,CAAC,CAAC;IAEH,IAAI,CAAC,0BAA0B,EAAE,KAAK;QACrC,sBAAsB,CAAC;YACtB,EAAE,IAAI,EAAE,OAAO,EAAE,KAAK,EAAE,EAAE,EAAE,QAAQ,EAAE,CAAC,EAAE,IAAI,EAAE,SAAS,EAAE,KAAK,EAAE,EAAE,EAAE,EAAE,EAAE,IAAI,EAAE,SAAS,EAAE,KAAK,EAAE,EAAE,EAAE,CAAC,EAAE;YACxG,EAAE,IAAI,EAAE,OAAO,EAAE,KAAK,EAAE,EAAE,EAAE,QAAQ,EAAE,CAAC,EAAE,IAAI,EAAE,SAAS,EAAE,KAAK,EAAE,EAAE,EAAE,CAAC,EAAE;SACxE,CAAC,CAAC;QACH,MAAM,YAAY,GAAG,IAAI,2BAA2B,CAAC,gBAAgB,EAAE,mBAAmB,EAAE,gBAAgB,CAAC,CAAC;QAC9G,MAAM,IAAI,GAAG,mBAAmB,EAAE,CAAC;QAEnC,MAAM,YAAY,CAAC,YAAY,CAAC,IAAI,EAAE,iBAAiB,CAAC,IAAI,CAAC,CAAC;QAC9D,MAAM,OAAO,GAAG,YAAY,CAAC,iBAAiB,CAAC,mBAAmB,EAAE,EAAE,CAAC,CAAC,CAAC;QAEzE,MAAM,CAAC,KAAK,CAAC,OAAO,CAAC,MAAM,EAAE,CAAC,EAAE,iCAAiC,CAAC,CAAC;QACnE,MAAM,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC,KAAK,EAAE,QAAQ,CAAC,CAAC;QACzC,MAAM,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC,KAAK,EAAE,OAAO,CAAC,CAAC;QACxC,MAAM,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC,KAAK,EAAE,CAAC,CAAC,CAAC;QAClC,MAAM,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC,KAAK,EAAE,SAAS,CAAC,CAAC;QAC1C,MAAM,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC,KAAK,EAAE,CAAC,CAAC,CAAC;QAClC,MAAM,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC,KAAK,EAAE,SAAS,CAAC,CAAC;QAC1C,MAAM,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC,KAAK,EAAE,CAAC,CAAC,CAAC;QAClC,MAAM,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC,KAAK,EAAE,OAAO,CAAC,CAAC;QACxC,MAAM,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC,KAAK,EAAE,CAAC,CAAC,CAAC;QAClC,MAAM,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC,KAAK,EAAE,SAAS,CAAC,CAAC;QAC1C,MAAM,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC,KAAK,EAAE,CAAC,CAAC,CAAC;IACnC,CAAC,CAAC,CAAC;IAEH,IAAI,CAAC,6BAA6B,EAAE,KAAK;QACxC,sBAAsB,CAAC,CAAC,EAAE,IAAI,EAAE,MAAM,EAAE,KAAK,EAAE,EAAE,EAAE,CAAC,EAAE,IAAI,CAAC,CAAC;QAC5D,sBAAsB,CAAC,CAAC,EAAE,IAAI,EAAE,MAAM,EAAE,KAAK,EAAE,EAAE,EAAE,CAAC,EAAE,IAAI,CAAC,CAAC;QAC5D,MAAM,YAAY,GAAG,IAAI,2BAA2B,CAAC,gBAAgB,EAAE,mBAAmB,EAAE,gBAAgB,CAAC,CAAC;QAE9G,MAAM,KAAK,GAAG,mBAAmB,CAAC,CAAC,EAAE,IAAI,CAAC,CAAC;QAC3C,MAAM,KAAK,GAAG,mBAAmB,CAAC,CAAC,EAAE,IAAI,CAAC,CAAC;QAC3C,MAAM,YAAY,CAAC,YAAY,CAAC,KAAK,EAAE,iBAAiB,CAAC,IAAI,CAAC,CAAC;QAC/D,MAAM,YAAY,CAAC,YAAY,CAAC,KAAK,EAAE,iBAAiB,CAAC,IAAI,CAAC,CAAC;QAE/D,MAAM,QAAQ,GAAG,YAAY,CAAC,iBAAiB,CAAC,mBAAmB,CAAC,CAAC,EAAE,IAAI,CAAC,EAAE,CAAC,CAAC,CAAC;QACjF,MAAM,QAAQ,GAAG,YAAY,CAAC,iBAAiB,CAAC,mBAAmB,CAAC,CAAC,EAAE,IAAI,CAAC,EAAE,CAAC,CAAC,CAAC;QAGjF,MAAM,CAAC,KAAK,CAAC,QAAQ,CAAC,MAAM,EAAE,CAAC,EAAE,iCAAiC,CAAC,CAAC;QACpE,MAAM,CAAC,KAAK,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC,KAAK,EAAE,QAAQ,CAAC,CAAC;QAC1C,MAAM,CAAC,KAAK,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC,KAAK,EAAE,MAAM,CAAC,CAAC;QACxC,MAAM,CAAC,KAAK,CAAC,QAAQ,CAAC,MAAM,EAAE,CAAC,EAAE,iCAAiC,CAAC,CAAC;QACpE,MAAM,CAAC,KAAK,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC,KAAK,EAAE,QAAQ,CAAC,CAAC;QAC1C,MAAM,CAAC,KAAK,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC,KAAK,EAAE,MAAM,CAAC,CAAC;IACzC,CAAC,CAAC,CAAC;AAEJ,CAAC,CAAC,CAAC","file":"notebookSymbols.test.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport assert from 'assert';\nimport { CancellationToken } from '../../../../../../base/common/cancellation.js';\nimport { mock } from '../../../../../../base/test/common/mock.js';\nimport { ensureNoDisposablesAreLeakedInTestSuite } from '../../../../../../base/test/common/utils.js';\nimport { ITextModel } from '../../../../../../editor/common/model.js';\nimport { IOutlineModelService, OutlineModel } from '../../../../../../editor/contrib/documentSymbols/browser/outlineModel.js';\nimport { ICellViewModel } from '../../../browser/notebookBrowser.js';\nimport { NotebookOutlineEntryFactory } from '../../../browser/viewModel/notebookOutlineEntryFactory.js';\nimport { INotebookExecutionStateService } from '../../../common/notebookExecutionStateService.js';\nimport { MockDocumentSymbol } from '../testNotebookEditor.js';\nimport { IResolvedTextEditorModel, ITextModelService } from '../../../../../../editor/common/services/resolverService.js';\nimport { URI } from '../../../../../../base/common/uri.js';\nimport { IReference } from '../../../../../../base/common/lifecycle.js';\n\nsuite('Notebook Symbols', function () {\n\tensureNoDisposablesAreLeakedInTestSuite();\n\n\tconst symbolsPerTextModel: Record<string, MockDocumentSymbol[]> = {};\n\tfunction setSymbolsForTextModel(symbols: MockDocumentSymbol[], textmodelId = 'textId') {\n\t\tsymbolsPerTextModel[textmodelId] = symbols;\n\t}\n\n\tconst executionService = new class extends mock<INotebookExecutionStateService>() {\n\t\toverride getCellExecution() { return undefined; }\n\t};\n\n\tclass OutlineModelStub {\n\t\tconstructor(private textId: string) { }\n\n\t\tgetTopLevelSymbols() {\n\t\t\treturn symbolsPerTextModel[this.textId];\n\t\t}\n\t}\n\tconst outlineModelService = new class extends mock<IOutlineModelService>() {\n\t\toverride getOrCreate(model: ITextModel, arg1: any) {\n\t\t\tconst outline = new OutlineModelStub(model.id) as unknown as OutlineModel;\n\t\t\treturn Promise.resolve(outline);\n\t\t}\n\t\toverride getDebounceValue(arg0: any) {\n\t\t\treturn 0;\n\t\t}\n\t};\n\tconst textModelService = new class extends mock<ITextModelService>() {\n\t\toverride createModelReference(uri: URI) {\n\t\t\treturn Promise.resolve({\n\t\t\t\tobject: {\n\t\t\t\t\ttextEditorModel: {\n\t\t\t\t\t\tid: uri.toString(),\n\t\t\t\t\t\tgetVersionId() { return 1; }\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tdispose() { }\n\t\t\t} as IReference<IResolvedTextEditorModel>);\n\t\t}\n\t};\n\n\tfunction createCellViewModel(version: number = 1, textmodelId = 'textId') {\n\t\treturn {\n\t\t\tid: textmodelId,\n\t\t\turi: { toString() { return textmodelId; } },\n\t\t\ttextBuffer: {\n\t\t\t\tgetLineCount() { return 0; }\n\t\t\t},\n\t\t\tgetText() {\n\t\t\t\treturn '# code';\n\t\t\t},\n\t\t\tmodel: {\n\t\t\t\ttextModel: {\n\t\t\t\t\tid: textmodelId,\n\t\t\t\t\tgetVersionId() { return version; }\n\t\t\t\t}\n\t\t\t},\n\t\t\tresolveTextModel() {\n\t\t\t\treturn this.model.textModel as unknown;\n\t\t\t},\n\t\t} as ICellViewModel;\n\t}\n\n\ttest('Cell without symbols cache', function () {\n\t\tsetSymbolsForTextModel([{ name: 'var', range: {} }]);\n\t\tconst entryFactory = new NotebookOutlineEntryFactory(executionService, outlineModelService, textModelService);\n\t\tconst entries = entryFactory.getOutlineEntries(createCellViewModel(), 0);\n\n\t\tassert.equal(entries.length, 1, 'no entries created');\n\t\tassert.equal(entries[0].label, '# code', 'entry should fall back to first line of cell');\n\t});\n\n\ttest('Cell with simple symbols', async function () {\n\t\tsetSymbolsForTextModel([{ name: 'var1', range: {} }, { name: 'var2', range: {} }]);\n\t\tconst entryFactory = new NotebookOutlineEntryFactory(executionService, outlineModelService, textModelService);\n\t\tconst cell = createCellViewModel();\n\n\t\tawait entryFactory.cacheSymbols(cell, CancellationToken.None);\n\t\tconst entries = entryFactory.getOutlineEntries(cell, 0);\n\n\t\tassert.equal(entries.length, 3, 'wrong number of outline entries');\n\t\tassert.equal(entries[0].label, '# code');\n\t\tassert.equal(entries[1].label, 'var1');\n\t\t// 6 levels for markdown, all code symbols are greater than the max markdown level\n\t\tassert.equal(entries[1].level, 8);\n\t\tassert.equal(entries[1].index, 1);\n\t\tassert.equal(entries[2].label, 'var2');\n\t\tassert.equal(entries[2].level, 8);\n\t\tassert.equal(entries[2].index, 2);\n\t});\n\n\ttest('Cell with nested symbols', async function () {\n\t\tsetSymbolsForTextModel([\n\t\t\t{ name: 'root1', range: {}, children: [{ name: 'nested1', range: {} }, { name: 'nested2', range: {} }] },\n\t\t\t{ name: 'root2', range: {}, children: [{ name: 'nested1', range: {} }] }\n\t\t]);\n\t\tconst entryFactory = new NotebookOutlineEntryFactory(executionService, outlineModelService, textModelService);\n\t\tconst cell = createCellViewModel();\n\n\t\tawait entryFactory.cacheSymbols(cell, CancellationToken.None);\n\t\tconst entries = entryFactory.getOutlineEntries(createCellViewModel(), 0);\n\n\t\tassert.equal(entries.length, 6, 'wrong number of outline entries');\n\t\tassert.equal(entries[0].label, '# code');\n\t\tassert.equal(entries[1].label, 'root1');\n\t\tassert.equal(entries[1].level, 8);\n\t\tassert.equal(entries[2].label, 'nested1');\n\t\tassert.equal(entries[2].level, 9);\n\t\tassert.equal(entries[3].label, 'nested2');\n\t\tassert.equal(entries[3].level, 9);\n\t\tassert.equal(entries[4].label, 'root2');\n\t\tassert.equal(entries[4].level, 8);\n\t\tassert.equal(entries[5].label, 'nested1');\n\t\tassert.equal(entries[5].level, 9);\n\t});\n\n\ttest('Multiple Cells with symbols', async function () {\n\t\tsetSymbolsForTextModel([{ name: 'var1', range: {} }], '$1');\n\t\tsetSymbolsForTextModel([{ name: 'var2', range: {} }], '$2');\n\t\tconst entryFactory = new NotebookOutlineEntryFactory(executionService, outlineModelService, textModelService);\n\n\t\tconst cell1 = createCellViewModel(1, '$1');\n\t\tconst cell2 = createCellViewModel(1, '$2');\n\t\tawait entryFactory.cacheSymbols(cell1, CancellationToken.None);\n\t\tawait entryFactory.cacheSymbols(cell2, CancellationToken.None);\n\n\t\tconst entries1 = entryFactory.getOutlineEntries(createCellViewModel(1, '$1'), 0);\n\t\tconst entries2 = entryFactory.getOutlineEntries(createCellViewModel(1, '$2'), 0);\n\n\n\t\tassert.equal(entries1.length, 2, 'wrong number of outline entries');\n\t\tassert.equal(entries1[0].label, '# code');\n\t\tassert.equal(entries1[1].label, 'var1');\n\t\tassert.equal(entries2.length, 2, 'wrong number of outline entries');\n\t\tassert.equal(entries2[0].label, '# code');\n\t\tassert.equal(entries2[1].label, 'var2');\n\t});\n\n});\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport assert from 'assert';\nimport { CancellationToken } from '../../../../../../base/common/cancellation.js';\nimport { mock } from '../../../../../../base/test/common/mock.js';\nimport { ensureNoDisposablesAreLeakedInTestSuite } from '../../../../../../base/test/common/utils.js';\nimport { ITextModel } from '../../../../../../editor/common/model.js';\nimport { IOutlineModelService, OutlineModel } from '../../../../../../editor/contrib/documentSymbols/browser/outlineModel.js';\nimport { ICellViewModel } from '../../../browser/notebookBrowser.js';\nimport { NotebookOutlineEntryFactory } from '../../../browser/viewModel/notebookOutlineEntryFactory.js';\nimport { INotebookExecutionStateService } from '../../../common/notebookExecutionStateService.js';\nimport { MockDocumentSymbol } from '../testNotebookEditor.js';\nimport { IResolvedTextEditorModel, ITextModelService } from '../../../../../../editor/common/services/resolverService.js';\nimport { URI } from '../../../../../../base/common/uri.js';\nimport { IReference } from '../../../../../../base/common/lifecycle.js';\n\nsuite('Notebook Symbols', function () {\n\tensureNoDisposablesAreLeakedInTestSuite();\n\n\tconst symbolsPerTextModel: Record<string, MockDocumentSymbol[]> = {};\n\tfunction setSymbolsForTextModel(symbols: MockDocumentSymbol[], textmodelId = 'textId') {\n\t\tsymbolsPerTextModel[textmodelId] = symbols;\n\t}\n\n\tconst executionService = new class extends mock<INotebookExecutionStateService>() {\n\t\toverride getCellExecution() { return undefined; }\n\t};\n\n\tclass OutlineModelStub {\n\t\tconstructor(private textId: string) { }\n\n\t\tgetTopLevelSymbols() {\n\t\t\treturn symbolsPerTextModel[this.textId];\n\t\t}\n\t}\n\tconst outlineModelService = new class extends mock<IOutlineModelService>() {\n\t\toverride getOrCreate(model: ITextModel, arg1: any) {\n\t\t\tconst outline = new OutlineModelStub(model.id) as unknown as OutlineModel;\n\t\t\treturn Promise.resolve(outline);\n\t\t}\n\t\toverride getDebounceValue(arg0: any) {\n\t\t\treturn 0;\n\t\t}\n\t};\n\tconst textModelService = new class extends mock<ITextModelService>() {\n\t\toverride createModelReference(uri: URI) {\n\t\t\treturn Promise.resolve({\n\t\t\t\tobject: {\n\t\t\t\t\ttextEditorModel: {\n\t\t\t\t\t\tid: uri.toString(),\n\t\t\t\t\t\tgetVersionId() { return 1; }\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tdispose() { }\n\t\t\t} as IReference<IResolvedTextEditorModel>);\n\t\t}\n\t};\n\n\tfunction createCellViewModel(version: number = 1, textmodelId = 'textId') {\n\t\treturn {\n\t\t\tid: textmodelId,\n\t\t\turi: { toString() { return textmodelId; } },\n\t\t\ttextBuffer: {\n\t\t\t\tgetLineCount() { return 0; }\n\t\t\t},\n\t\t\tgetText() {\n\t\t\t\treturn '# code';\n\t\t\t},\n\t\t\tmodel: {\n\t\t\t\ttextModel: {\n\t\t\t\t\tid: textmodelId,\n\t\t\t\t\tgetVersionId() { return version; }\n\t\t\t\t}\n\t\t\t},\n\t\t\tresolveTextModel() {\n\t\t\t\treturn this.model.textModel as unknown;\n\t\t\t},\n\t\t} as ICellViewModel;\n\t}\n\n\ttest('Cell without symbols cache', function () {\n\t\tsetSymbolsForTextModel([{ name: 'var', range: {} }]);\n\t\tconst entryFactory = new NotebookOutlineEntryFactory(executionService, outlineModelService, textModelService);\n\t\tconst entries = entryFactory.getOutlineEntries(createCellViewModel(), 0);\n\n\t\tassert.equal(entries.length, 1, 'no entries created');\n\t\tassert.equal(entries[0].label, '# code', 'entry should fall back to first line of cell');\n\t});\n\n\ttest('Cell with simple symbols', async function () {\n\t\tsetSymbolsForTextModel([{ name: 'var1', range: {} }, { name: 'var2', range: {} }]);\n\t\tconst entryFactory = new NotebookOutlineEntryFactory(executionService, outlineModelService, textModelService);\n\t\tconst cell = createCellViewModel();\n\n\t\tawait entryFactory.cacheSymbols(cell, CancellationToken.None);\n\t\tconst entries = entryFactory.getOutlineEntries(cell, 0);\n\n\t\tassert.equal(entries.length, 3, 'wrong number of outline entries');\n\t\tassert.equal(entries[0].label, '# code');\n\t\tassert.equal(entries[1].label, 'var1');\n\t\t// 6 levels for markdown, all code symbols are greater than the max markdown level\n\t\tassert.equal(entries[1].level, 8);\n\t\tassert.equal(entries[1].index, 1);\n\t\tassert.equal(entries[2].label, 'var2');\n\t\tassert.equal(entries[2].level, 8);\n\t\tassert.equal(entries[2].index, 2);\n\t});\n\n\ttest('Cell with nested symbols', async function () {\n\t\tsetSymbolsForTextModel([\n\t\t\t{ name: 'root1', range: {}, children: [{ name: 'nested1', range: {} }, { name: 'nested2', range: {} }] },\n\t\t\t{ name: 'root2', range: {}, children: [{ name: 'nested1', range: {} }] }\n\t\t]);\n\t\tconst entryFactory = new NotebookOutlineEntryFactory(executionService, outlineModelService, textModelService);\n\t\tconst cell = createCellViewModel();\n\n\t\tawait entryFactory.cacheSymbols(cell, CancellationToken.None);\n\t\tconst entries = entryFactory.getOutlineEntries(createCellViewModel(), 0);\n\n\t\tassert.equal(entries.length, 6, 'wrong number of outline entries');\n\t\tassert.equal(entries[0].label, '# code');\n\t\tassert.equal(entries[1].label, 'root1');\n\t\tassert.equal(entries[1].level, 8);\n\t\tassert.equal(entries[2].label, 'nested1');\n\t\tassert.equal(entries[2].level, 9);\n\t\tassert.equal(entries[3].label, 'nested2');\n\t\tassert.equal(entries[3].level, 9);\n\t\tassert.equal(entries[4].label, 'root2');\n\t\tassert.equal(entries[4].level, 8);\n\t\tassert.equal(entries[5].label, 'nested1');\n\t\tassert.equal(entries[5].level, 9);\n\t});\n\n\ttest('Multiple Cells with symbols', async function () {\n\t\tsetSymbolsForTextModel([{ name: 'var1', range: {} }], '$1');\n\t\tsetSymbolsForTextModel([{ name: 'var2', range: {} }], '$2');\n\t\tconst entryFactory = new NotebookOutlineEntryFactory(executionService, outlineModelService, textModelService);\n\n\t\tconst cell1 = createCellViewModel(1, '$1');\n\t\tconst cell2 = createCellViewModel(1, '$2');\n\t\tawait entryFactory.cacheSymbols(cell1, CancellationToken.None);\n\t\tawait entryFactory.cacheSymbols(cell2, CancellationToken.None);\n\n\t\tconst entries1 = entryFactory.getOutlineEntries(createCellViewModel(1, '$1'), 0);\n\t\tconst entries2 = entryFactory.getOutlineEntries(createCellViewModel(1, '$2'), 0);\n\n\n\t\tassert.equal(entries1.length, 2, 'wrong number of outline entries');\n\t\tassert.equal(entries1[0].label, '# code');\n\t\tassert.equal(entries1[1].label, 'var1');\n\t\tassert.equal(entries2.length, 2, 'wrong number of outline entries');\n\t\tassert.equal(entries2[0].label, '# code');\n\t\tassert.equal(entries2[1].label, 'var2');\n\t});\n\n});\n"]}