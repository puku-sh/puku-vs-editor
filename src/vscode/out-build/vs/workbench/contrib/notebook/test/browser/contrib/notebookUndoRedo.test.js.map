{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/contrib/notebook/test/browser/contrib/notebookUndoRedo.test.ts","vs/workbench/contrib/notebook/test/browser/contrib/notebookUndoRedo.test.ts"],"names":[],"mappings":"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","file":"notebookUndoRedo.test.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport assert from 'assert';\nimport { ensureNoDisposablesAreLeakedInTestSuite } from '../../../../../../base/test/common/utils.js';\nimport { CellEditType, CellKind, SelectionStateType } from '../../../common/notebookCommon.js';\nimport { createNotebookCellList, withTestNotebook } from '../testNotebookEditor.js';\n\nsuite('Notebook Undo/Redo', () => {\n\tconst disposables = ensureNoDisposablesAreLeakedInTestSuite();\n\n\ttest('Basics', async function () {\n\t\tawait withTestNotebook(\n\t\t\t[\n\t\t\t\t['# header 1', 'markdown', CellKind.Markup, [], {}],\n\t\t\t\t['body', 'markdown', CellKind.Markup, [], {}],\n\t\t\t],\n\t\t\tasync (editor, viewModel, _ds, _accessor) => {\n\t\t\t\tassert.strictEqual(viewModel.length, 2);\n\t\t\t\tassert.strictEqual(viewModel.getVersionId(), 0);\n\t\t\t\tassert.strictEqual(viewModel.getAlternativeId(), '0_0,1;1,1');\n\n\t\t\t\teditor.textModel.applyEdits([{\n\t\t\t\t\teditType: CellEditType.Replace, index: 0, count: 2, cells: []\n\t\t\t\t}], true, undefined, () => undefined, undefined, true);\n\t\t\t\tassert.strictEqual(viewModel.length, 0);\n\t\t\t\tassert.strictEqual(viewModel.getVersionId(), 1);\n\t\t\t\tassert.strictEqual(viewModel.getAlternativeId(), '1_');\n\n\t\t\t\tawait viewModel.undo();\n\t\t\t\tassert.strictEqual(viewModel.length, 2);\n\t\t\t\tassert.strictEqual(viewModel.getVersionId(), 2);\n\t\t\t\tassert.strictEqual(viewModel.getAlternativeId(), '0_0,1;1,1');\n\n\t\t\t\tawait viewModel.redo();\n\t\t\t\tassert.strictEqual(viewModel.length, 0);\n\t\t\t\tassert.strictEqual(viewModel.getVersionId(), 3);\n\t\t\t\tassert.strictEqual(viewModel.getAlternativeId(), '1_');\n\n\t\t\t\teditor.textModel.applyEdits([{\n\t\t\t\t\teditType: CellEditType.Replace, index: 0, count: 0, cells: [\n\t\t\t\t\t\t{ source: '# header 3', language: 'markdown', cellKind: CellKind.Markup, outputs: [], mime: undefined }\n\t\t\t\t\t]\n\t\t\t\t}], true, undefined, () => undefined, undefined, true);\n\t\t\t\tassert.strictEqual(viewModel.getVersionId(), 4);\n\t\t\t\tassert.strictEqual(viewModel.getAlternativeId(), '4_2,1');\n\n\t\t\t\tawait viewModel.undo();\n\t\t\t\tassert.strictEqual(viewModel.getVersionId(), 5);\n\t\t\t\tassert.strictEqual(viewModel.getAlternativeId(), '1_');\n\t\t\t}\n\t\t);\n\t});\n\n\ttest('Invalid replace count should not throw', async function () {\n\t\tawait withTestNotebook(\n\t\t\t[\n\t\t\t\t['# header 1', 'markdown', CellKind.Markup, [], {}],\n\t\t\t\t['body', 'markdown', CellKind.Markup, [], {}],\n\t\t\t],\n\t\t\tasync (editor, _viewModel, _ds, _accessor) => {\n\t\t\t\teditor.textModel.applyEdits([{\n\t\t\t\t\teditType: CellEditType.Replace, index: 0, count: 2, cells: []\n\t\t\t\t}], true, undefined, () => undefined, undefined, true);\n\n\t\t\t\tassert.doesNotThrow(() => {\n\t\t\t\t\teditor.textModel.applyEdits([{\n\t\t\t\t\t\teditType: CellEditType.Replace, index: 0, count: 2, cells: [\n\t\t\t\t\t\t\t{ source: '# header 2', language: 'markdown', cellKind: CellKind.Markup, outputs: [], mime: undefined }\n\t\t\t\t\t\t]\n\t\t\t\t\t}], true, undefined, () => undefined, undefined, true);\n\t\t\t\t});\n\t\t\t}\n\t\t);\n\t});\n\n\ttest('Replace beyond length', async function () {\n\t\tawait withTestNotebook(\n\t\t\t[\n\t\t\t\t['# header 1', 'markdown', CellKind.Markup, [], {}],\n\t\t\t\t['body', 'markdown', CellKind.Markup, [], {}],\n\t\t\t],\n\t\t\tasync (editor, viewModel) => {\n\t\t\t\teditor.textModel.applyEdits([{\n\t\t\t\t\teditType: CellEditType.Replace, index: 1, count: 2, cells: []\n\t\t\t\t}], true, undefined, () => undefined, undefined, true);\n\n\t\t\t\tassert.deepStrictEqual(viewModel.length, 1);\n\t\t\t\tawait viewModel.undo();\n\t\t\t\tassert.deepStrictEqual(viewModel.length, 2);\n\t\t\t}\n\t\t);\n\t});\n\n\ttest('Invalid replace count should not affect undo/redo', async function () {\n\t\tawait withTestNotebook(\n\t\t\t[\n\t\t\t\t['# header 1', 'markdown', CellKind.Markup, [], {}],\n\t\t\t\t['body', 'markdown', CellKind.Markup, [], {}],\n\t\t\t],\n\t\t\tasync (editor, viewModel, _ds, _accessor) => {\n\t\t\t\teditor.textModel.applyEdits([{\n\t\t\t\t\teditType: CellEditType.Replace, index: 0, count: 2, cells: []\n\t\t\t\t}], true, undefined, () => undefined, undefined, true);\n\n\t\t\t\teditor.textModel.applyEdits([{\n\t\t\t\t\teditType: CellEditType.Replace, index: 0, count: 2, cells: [\n\t\t\t\t\t\t{ source: '# header 2', language: 'markdown', cellKind: CellKind.Markup, outputs: [], mime: undefined }\n\t\t\t\t\t]\n\t\t\t\t}], true, undefined, () => undefined, undefined, true);\n\n\t\t\t\tassert.deepStrictEqual(viewModel.length, 1);\n\n\t\t\t\tawait viewModel.undo();\n\t\t\t\tawait viewModel.undo();\n\n\t\t\t\tassert.deepStrictEqual(viewModel.length, 2);\n\t\t\t\teditor.textModel.applyEdits([{\n\t\t\t\t\teditType: CellEditType.Replace, index: 1, count: 2, cells: []\n\t\t\t\t}], true, undefined, () => undefined, undefined, true);\n\t\t\t\tassert.deepStrictEqual(viewModel.length, 1);\n\t\t\t}\n\t\t);\n\t});\n\n\ttest('Focus/selection update', async function () {\n\t\tawait withTestNotebook(\n\t\t\t[\n\t\t\t\t['# header 1', 'markdown', CellKind.Markup, [], {}],\n\t\t\t\t['body', 'markdown', CellKind.Markup, [], {}],\n\t\t\t],\n\t\t\tasync (editor, viewModel, _ds, accessor) => {\n\t\t\t\tconst cellList = createNotebookCellList(accessor, disposables);\n\t\t\t\tcellList.attachViewModel(viewModel);\n\t\t\t\tcellList.setFocus([1]);\n\n\t\t\t\teditor.textModel.applyEdits([{\n\t\t\t\t\teditType: CellEditType.Replace, index: 2, count: 0, cells: [\n\t\t\t\t\t\t{ source: '# header 2', language: 'markdown', cellKind: CellKind.Markup, outputs: [], mime: undefined }\n\t\t\t\t\t]\n\t\t\t\t}], true, { focus: { start: 1, end: 2 }, selections: [{ start: 1, end: 2 }], kind: SelectionStateType.Index }, () => {\n\t\t\t\t\treturn {\n\t\t\t\t\t\tfocus: { start: 2, end: 3 }, selections: [{ start: 2, end: 3 }], kind: SelectionStateType.Index\n\t\t\t\t\t};\n\t\t\t\t}, undefined, true);\n\t\t\t\tassert.strictEqual(viewModel.length, 3);\n\t\t\t\tassert.strictEqual(viewModel.getVersionId(), 1);\n\t\t\t\tassert.deepStrictEqual(cellList.getFocus(), [2]);\n\t\t\t\tassert.deepStrictEqual(cellList.getSelection(), [2]);\n\n\t\t\t\tawait viewModel.undo();\n\t\t\t\tassert.strictEqual(viewModel.length, 2);\n\t\t\t\tassert.strictEqual(viewModel.getVersionId(), 2);\n\t\t\t\tassert.deepStrictEqual(cellList.getFocus(), [1]);\n\t\t\t\tassert.deepStrictEqual(cellList.getSelection(), [1]);\n\n\t\t\t\tawait viewModel.redo();\n\t\t\t\tassert.strictEqual(viewModel.length, 3);\n\t\t\t\tassert.strictEqual(viewModel.getVersionId(), 3);\n\t\t\t\tassert.deepStrictEqual(cellList.getFocus(), [2]);\n\t\t\t\tassert.deepStrictEqual(cellList.getSelection(), [2]);\n\t\t\t}\n\t\t);\n\t});\n\n\ttest('Batch edits', async function () {\n\t\tawait withTestNotebook(\n\t\t\t[\n\t\t\t\t['# header 1', 'markdown', CellKind.Markup, [], {}],\n\t\t\t\t['body', 'markdown', CellKind.Markup, [], {}],\n\t\t\t],\n\t\t\tasync (editor, viewModel, _ds, accessor) => {\n\t\t\t\teditor.textModel.applyEdits([{\n\t\t\t\t\teditType: CellEditType.Replace, index: 2, count: 0, cells: [\n\t\t\t\t\t\t{ source: '# header 2', language: 'markdown', cellKind: CellKind.Markup, outputs: [], mime: undefined }\n\t\t\t\t\t]\n\t\t\t\t}, {\n\t\t\t\t\teditType: CellEditType.Metadata, index: 0, metadata: { inputCollapsed: false }\n\t\t\t\t}], true, undefined, () => undefined, undefined, true);\n\t\t\t\tassert.strictEqual(viewModel.getVersionId(), 1);\n\t\t\t\tassert.deepStrictEqual(viewModel.cellAt(0)?.metadata, { inputCollapsed: false });\n\n\t\t\t\tawait viewModel.undo();\n\t\t\t\tassert.strictEqual(viewModel.length, 2);\n\t\t\t\tassert.strictEqual(viewModel.getVersionId(), 2);\n\t\t\t\tassert.deepStrictEqual(viewModel.cellAt(0)?.metadata, {});\n\n\t\t\t\tawait viewModel.redo();\n\t\t\t\tassert.strictEqual(viewModel.length, 3);\n\t\t\t\tassert.strictEqual(viewModel.getVersionId(), 3);\n\t\t\t\tassert.deepStrictEqual(viewModel.cellAt(0)?.metadata, { inputCollapsed: false });\n\n\t\t\t}\n\t\t);\n\t});\n});\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport assert from 'assert';\nimport { ensureNoDisposablesAreLeakedInTestSuite } from '../../../../../../base/test/common/utils.js';\nimport { CellEditType, CellKind, SelectionStateType } from '../../../common/notebookCommon.js';\nimport { createNotebookCellList, withTestNotebook } from '../testNotebookEditor.js';\n\nsuite('Notebook Undo/Redo', () => {\n\tconst disposables = ensureNoDisposablesAreLeakedInTestSuite();\n\n\ttest('Basics', async function () {\n\t\tawait withTestNotebook(\n\t\t\t[\n\t\t\t\t['# header 1', 'markdown', CellKind.Markup, [], {}],\n\t\t\t\t['body', 'markdown', CellKind.Markup, [], {}],\n\t\t\t],\n\t\t\tasync (editor, viewModel, _ds, _accessor) => {\n\t\t\t\tassert.strictEqual(viewModel.length, 2);\n\t\t\t\tassert.strictEqual(viewModel.getVersionId(), 0);\n\t\t\t\tassert.strictEqual(viewModel.getAlternativeId(), '0_0,1;1,1');\n\n\t\t\t\teditor.textModel.applyEdits([{\n\t\t\t\t\teditType: CellEditType.Replace, index: 0, count: 2, cells: []\n\t\t\t\t}], true, undefined, () => undefined, undefined, true);\n\t\t\t\tassert.strictEqual(viewModel.length, 0);\n\t\t\t\tassert.strictEqual(viewModel.getVersionId(), 1);\n\t\t\t\tassert.strictEqual(viewModel.getAlternativeId(), '1_');\n\n\t\t\t\tawait viewModel.undo();\n\t\t\t\tassert.strictEqual(viewModel.length, 2);\n\t\t\t\tassert.strictEqual(viewModel.getVersionId(), 2);\n\t\t\t\tassert.strictEqual(viewModel.getAlternativeId(), '0_0,1;1,1');\n\n\t\t\t\tawait viewModel.redo();\n\t\t\t\tassert.strictEqual(viewModel.length, 0);\n\t\t\t\tassert.strictEqual(viewModel.getVersionId(), 3);\n\t\t\t\tassert.strictEqual(viewModel.getAlternativeId(), '1_');\n\n\t\t\t\teditor.textModel.applyEdits([{\n\t\t\t\t\teditType: CellEditType.Replace, index: 0, count: 0, cells: [\n\t\t\t\t\t\t{ source: '# header 3', language: 'markdown', cellKind: CellKind.Markup, outputs: [], mime: undefined }\n\t\t\t\t\t]\n\t\t\t\t}], true, undefined, () => undefined, undefined, true);\n\t\t\t\tassert.strictEqual(viewModel.getVersionId(), 4);\n\t\t\t\tassert.strictEqual(viewModel.getAlternativeId(), '4_2,1');\n\n\t\t\t\tawait viewModel.undo();\n\t\t\t\tassert.strictEqual(viewModel.getVersionId(), 5);\n\t\t\t\tassert.strictEqual(viewModel.getAlternativeId(), '1_');\n\t\t\t}\n\t\t);\n\t});\n\n\ttest('Invalid replace count should not throw', async function () {\n\t\tawait withTestNotebook(\n\t\t\t[\n\t\t\t\t['# header 1', 'markdown', CellKind.Markup, [], {}],\n\t\t\t\t['body', 'markdown', CellKind.Markup, [], {}],\n\t\t\t],\n\t\t\tasync (editor, _viewModel, _ds, _accessor) => {\n\t\t\t\teditor.textModel.applyEdits([{\n\t\t\t\t\teditType: CellEditType.Replace, index: 0, count: 2, cells: []\n\t\t\t\t}], true, undefined, () => undefined, undefined, true);\n\n\t\t\t\tassert.doesNotThrow(() => {\n\t\t\t\t\teditor.textModel.applyEdits([{\n\t\t\t\t\t\teditType: CellEditType.Replace, index: 0, count: 2, cells: [\n\t\t\t\t\t\t\t{ source: '# header 2', language: 'markdown', cellKind: CellKind.Markup, outputs: [], mime: undefined }\n\t\t\t\t\t\t]\n\t\t\t\t\t}], true, undefined, () => undefined, undefined, true);\n\t\t\t\t});\n\t\t\t}\n\t\t);\n\t});\n\n\ttest('Replace beyond length', async function () {\n\t\tawait withTestNotebook(\n\t\t\t[\n\t\t\t\t['# header 1', 'markdown', CellKind.Markup, [], {}],\n\t\t\t\t['body', 'markdown', CellKind.Markup, [], {}],\n\t\t\t],\n\t\t\tasync (editor, viewModel) => {\n\t\t\t\teditor.textModel.applyEdits([{\n\t\t\t\t\teditType: CellEditType.Replace, index: 1, count: 2, cells: []\n\t\t\t\t}], true, undefined, () => undefined, undefined, true);\n\n\t\t\t\tassert.deepStrictEqual(viewModel.length, 1);\n\t\t\t\tawait viewModel.undo();\n\t\t\t\tassert.deepStrictEqual(viewModel.length, 2);\n\t\t\t}\n\t\t);\n\t});\n\n\ttest('Invalid replace count should not affect undo/redo', async function () {\n\t\tawait withTestNotebook(\n\t\t\t[\n\t\t\t\t['# header 1', 'markdown', CellKind.Markup, [], {}],\n\t\t\t\t['body', 'markdown', CellKind.Markup, [], {}],\n\t\t\t],\n\t\t\tasync (editor, viewModel, _ds, _accessor) => {\n\t\t\t\teditor.textModel.applyEdits([{\n\t\t\t\t\teditType: CellEditType.Replace, index: 0, count: 2, cells: []\n\t\t\t\t}], true, undefined, () => undefined, undefined, true);\n\n\t\t\t\teditor.textModel.applyEdits([{\n\t\t\t\t\teditType: CellEditType.Replace, index: 0, count: 2, cells: [\n\t\t\t\t\t\t{ source: '# header 2', language: 'markdown', cellKind: CellKind.Markup, outputs: [], mime: undefined }\n\t\t\t\t\t]\n\t\t\t\t}], true, undefined, () => undefined, undefined, true);\n\n\t\t\t\tassert.deepStrictEqual(viewModel.length, 1);\n\n\t\t\t\tawait viewModel.undo();\n\t\t\t\tawait viewModel.undo();\n\n\t\t\t\tassert.deepStrictEqual(viewModel.length, 2);\n\t\t\t\teditor.textModel.applyEdits([{\n\t\t\t\t\teditType: CellEditType.Replace, index: 1, count: 2, cells: []\n\t\t\t\t}], true, undefined, () => undefined, undefined, true);\n\t\t\t\tassert.deepStrictEqual(viewModel.length, 1);\n\t\t\t}\n\t\t);\n\t});\n\n\ttest('Focus/selection update', async function () {\n\t\tawait withTestNotebook(\n\t\t\t[\n\t\t\t\t['# header 1', 'markdown', CellKind.Markup, [], {}],\n\t\t\t\t['body', 'markdown', CellKind.Markup, [], {}],\n\t\t\t],\n\t\t\tasync (editor, viewModel, _ds, accessor) => {\n\t\t\t\tconst cellList = createNotebookCellList(accessor, disposables);\n\t\t\t\tcellList.attachViewModel(viewModel);\n\t\t\t\tcellList.setFocus([1]);\n\n\t\t\t\teditor.textModel.applyEdits([{\n\t\t\t\t\teditType: CellEditType.Replace, index: 2, count: 0, cells: [\n\t\t\t\t\t\t{ source: '# header 2', language: 'markdown', cellKind: CellKind.Markup, outputs: [], mime: undefined }\n\t\t\t\t\t]\n\t\t\t\t}], true, { focus: { start: 1, end: 2 }, selections: [{ start: 1, end: 2 }], kind: SelectionStateType.Index }, () => {\n\t\t\t\t\treturn {\n\t\t\t\t\t\tfocus: { start: 2, end: 3 }, selections: [{ start: 2, end: 3 }], kind: SelectionStateType.Index\n\t\t\t\t\t};\n\t\t\t\t}, undefined, true);\n\t\t\t\tassert.strictEqual(viewModel.length, 3);\n\t\t\t\tassert.strictEqual(viewModel.getVersionId(), 1);\n\t\t\t\tassert.deepStrictEqual(cellList.getFocus(), [2]);\n\t\t\t\tassert.deepStrictEqual(cellList.getSelection(), [2]);\n\n\t\t\t\tawait viewModel.undo();\n\t\t\t\tassert.strictEqual(viewModel.length, 2);\n\t\t\t\tassert.strictEqual(viewModel.getVersionId(), 2);\n\t\t\t\tassert.deepStrictEqual(cellList.getFocus(), [1]);\n\t\t\t\tassert.deepStrictEqual(cellList.getSelection(), [1]);\n\n\t\t\t\tawait viewModel.redo();\n\t\t\t\tassert.strictEqual(viewModel.length, 3);\n\t\t\t\tassert.strictEqual(viewModel.getVersionId(), 3);\n\t\t\t\tassert.deepStrictEqual(cellList.getFocus(), [2]);\n\t\t\t\tassert.deepStrictEqual(cellList.getSelection(), [2]);\n\t\t\t}\n\t\t);\n\t});\n\n\ttest('Batch edits', async function () {\n\t\tawait withTestNotebook(\n\t\t\t[\n\t\t\t\t['# header 1', 'markdown', CellKind.Markup, [], {}],\n\t\t\t\t['body', 'markdown', CellKind.Markup, [], {}],\n\t\t\t],\n\t\t\tasync (editor, viewModel, _ds, accessor) => {\n\t\t\t\teditor.textModel.applyEdits([{\n\t\t\t\t\teditType: CellEditType.Replace, index: 2, count: 0, cells: [\n\t\t\t\t\t\t{ source: '# header 2', language: 'markdown', cellKind: CellKind.Markup, outputs: [], mime: undefined }\n\t\t\t\t\t]\n\t\t\t\t}, {\n\t\t\t\t\teditType: CellEditType.Metadata, index: 0, metadata: { inputCollapsed: false }\n\t\t\t\t}], true, undefined, () => undefined, undefined, true);\n\t\t\t\tassert.strictEqual(viewModel.getVersionId(), 1);\n\t\t\t\tassert.deepStrictEqual(viewModel.cellAt(0)?.metadata, { inputCollapsed: false });\n\n\t\t\t\tawait viewModel.undo();\n\t\t\t\tassert.strictEqual(viewModel.length, 2);\n\t\t\t\tassert.strictEqual(viewModel.getVersionId(), 2);\n\t\t\t\tassert.deepStrictEqual(viewModel.cellAt(0)?.metadata, {});\n\n\t\t\t\tawait viewModel.redo();\n\t\t\t\tassert.strictEqual(viewModel.length, 3);\n\t\t\t\tassert.strictEqual(viewModel.getVersionId(), 3);\n\t\t\t\tassert.deepStrictEqual(viewModel.cellAt(0)?.metadata, { inputCollapsed: false });\n\n\t\t\t}\n\t\t);\n\t});\n});\n"]}