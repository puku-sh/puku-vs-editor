{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/contrib/notebook/test/browser/cellOutput.test.ts","vs/workbench/contrib/notebook/test/browser/cellOutput.test.ts"],"names":[],"mappings":"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","file":"cellOutput.test.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport assert from 'assert';\nimport { VSBuffer } from '../../../../../base/common/buffer.js';\nimport { ensureNoDisposablesAreLeakedInTestSuite } from '../../../../../base/test/common/utils.js';\nimport { CellOutputContainer } from '../../browser/view/cellParts/cellOutput.js';\nimport { CodeCellRenderTemplate } from '../../browser/view/notebookRenderingCommon.js';\nimport { CodeCellViewModel } from '../../browser/viewModel/codeCellViewModel.js';\nimport { CellKind, INotebookRendererInfo, IOutputDto } from '../../common/notebookCommon.js';\nimport { setupInstantiationService, withTestNotebook } from './testNotebookEditor.js';\nimport { FastDomNode } from '../../../../../base/browser/fastDomNode.js';\nimport { DisposableStore } from '../../../../../base/common/lifecycle.js';\nimport { INotebookService } from '../../common/notebookService.js';\nimport { mock } from '../../../../../base/test/common/mock.js';\nimport { IMenu, IMenuService } from '../../../../../platform/actions/common/actions.js';\nimport { Event } from '../../../../../base/common/event.js';\nimport { TestInstantiationService } from '../../../../../platform/instantiation/test/common/instantiationServiceMock.js';\nimport { getAllOutputsText } from '../../browser/viewModel/cellOutputTextHelper.js';\n\nsuite('CellOutput', () => {\n\tconst store = ensureNoDisposablesAreLeakedInTestSuite();\n\tlet instantiationService: TestInstantiationService;\n\tlet outputMenus: IMenu[] = [];\n\n\tsetup(() => {\n\t\toutputMenus = [];\n\t\tinstantiationService = setupInstantiationService(store);\n\t\tinstantiationService.stub(INotebookService, new class extends mock<INotebookService>() {\n\t\t\toverride getOutputMimeTypeInfo(_textModel: any, _kernelProvides: readonly string[] | undefined, output: IOutputDto) {\n\t\t\t\treturn [{\n\t\t\t\t\trendererId: 'plainTextRendererId',\n\t\t\t\t\tmimeType: 'text/plain',\n\t\t\t\t\tisTrusted: true\n\t\t\t\t}, {\n\t\t\t\t\trendererId: 'htmlRendererId',\n\t\t\t\t\tmimeType: 'text/html',\n\t\t\t\t\tisTrusted: true\n\t\t\t\t}, {\n\t\t\t\t\trendererId: 'errorRendererId',\n\t\t\t\t\tmimeType: 'application/vnd.code.notebook.error',\n\t\t\t\t\tisTrusted: true\n\t\t\t\t}, {\n\t\t\t\t\trendererId: 'stderrRendererId',\n\t\t\t\t\tmimeType: 'application/vnd.code.notebook.stderr',\n\t\t\t\t\tisTrusted: true\n\t\t\t\t}, {\n\t\t\t\t\trendererId: 'stdoutRendererId',\n\t\t\t\t\tmimeType: 'application/vnd.code.notebook.stdout',\n\t\t\t\t\tisTrusted: true\n\t\t\t\t}]\n\t\t\t\t\t.filter(info => output.outputs.some(output => output.mime === info.mimeType));\n\t\t\t}\n\t\t\toverride getRendererInfo(): INotebookRendererInfo {\n\t\t\t\treturn {\n\t\t\t\t\tid: 'rendererId',\n\t\t\t\t\tdisplayName: 'Stubbed Renderer',\n\t\t\t\t\textensionId: { _lower: 'id', value: 'id' },\n\t\t\t\t} as INotebookRendererInfo;\n\t\t\t}\n\t\t});\n\t\tinstantiationService.stub(IMenuService, new class extends mock<IMenuService>() {\n\t\t\toverride createMenu() {\n\t\t\t\tconst menu = new class extends mock<IMenu>() {\n\t\t\t\t\toverride onDidChange = Event.None;\n\t\t\t\t\toverride getActions() { return []; }\n\t\t\t\t\toverride dispose() { outputMenus = outputMenus.filter(item => item !== menu); }\n\t\t\t\t};\n\t\t\t\toutputMenus.push(menu);\n\t\t\t\treturn menu;\n\t\t\t}\n\t\t});\n\t});\n\n\ttest('Render cell output items with multiple mime types', async function () {\n\t\tconst outputItem = { data: VSBuffer.fromString('output content'), mime: 'text/plain' };\n\t\tconst htmlOutputItem = { data: VSBuffer.fromString('output content'), mime: 'text/html' };\n\t\tconst output1: IOutputDto = { outputId: 'abc', outputs: [outputItem, htmlOutputItem] };\n\t\tconst output2: IOutputDto = { outputId: 'def', outputs: [outputItem, htmlOutputItem] };\n\n\t\tawait withTestNotebook(\n\t\t\t[\n\t\t\t\t['print(output content)', 'python', CellKind.Code, [output1, output2], {}],\n\t\t\t],\n\t\t\t(editor, viewModel, disposables, accessor) => {\n\n\t\t\t\tconst cell = viewModel.viewCells[0] as CodeCellViewModel;\n\t\t\t\tconst cellTemplate = createCellTemplate(disposables);\n\t\t\t\tconst output = disposables.add(accessor.createInstance(CellOutputContainer, editor, cell, cellTemplate, { limit: 100 }));\n\t\t\t\toutput.render();\n\t\t\t\tcell.outputsViewModels[0].setVisible(true);\n\t\t\t\tassert.strictEqual(outputMenus.length, 1, 'should have 1 output menus');\n\t\t\t\tassert(cellTemplate.outputContainer.domNode.style.display !== 'none', 'output container should be visible');\n\t\t\t\tcell.outputsViewModels[1].setVisible(true);\n\t\t\t\tassert.strictEqual(outputMenus.length, 2, 'should have 2 output menus');\n\t\t\t\tcell.outputsViewModels[1].setVisible(true);\n\t\t\t\tassert.strictEqual(outputMenus.length, 2, 'should still have 2 output menus');\n\t\t\t},\n\t\t\tinstantiationService\n\t\t);\n\t});\n\n\ttest('One of many cell outputs becomes hidden', async function () {\n\t\tconst outputItem = { data: VSBuffer.fromString('output content'), mime: 'text/plain' };\n\t\tconst htmlOutputItem = { data: VSBuffer.fromString('output content'), mime: 'text/html' };\n\t\tconst output1: IOutputDto = { outputId: 'abc', outputs: [outputItem, htmlOutputItem] };\n\t\tconst output2: IOutputDto = { outputId: 'def', outputs: [outputItem, htmlOutputItem] };\n\t\tconst output3: IOutputDto = { outputId: 'ghi', outputs: [outputItem, htmlOutputItem] };\n\n\t\tawait withTestNotebook(\n\t\t\t[\n\t\t\t\t['print(output content)', 'python', CellKind.Code, [output1, output2, output3], {}],\n\t\t\t],\n\t\t\t(editor, viewModel, disposables, accessor) => {\n\n\t\t\t\tconst cell = viewModel.viewCells[0] as CodeCellViewModel;\n\t\t\t\tconst cellTemplate = createCellTemplate(disposables);\n\t\t\t\tconst output = disposables.add(accessor.createInstance(CellOutputContainer, editor, cell, cellTemplate, { limit: 100 }));\n\t\t\t\toutput.render();\n\t\t\t\tcell.outputsViewModels[0].setVisible(true);\n\t\t\t\tcell.outputsViewModels[1].setVisible(true);\n\t\t\t\tcell.outputsViewModels[2].setVisible(true);\n\t\t\t\tcell.outputsViewModels[1].setVisible(false);\n\t\t\t\tassert(cellTemplate.outputContainer.domNode.style.display !== 'none', 'output container should be visible');\n\t\t\t\tassert.strictEqual(outputMenus.length, 2, 'should have 2 output menus');\n\t\t\t},\n\t\t\tinstantiationService\n\t\t);\n\t});\n\n\ttest('get all adjacent stream outputs', async () => {\n\t\tconst stdout = { data: VSBuffer.fromString('stdout'), mime: 'application/vnd.code.notebook.stdout' };\n\t\tconst stderr = { data: VSBuffer.fromString('stderr'), mime: 'application/vnd.code.notebook.stderr' };\n\t\tconst output1: IOutputDto = { outputId: 'abc', outputs: [stdout] };\n\t\tconst output2: IOutputDto = { outputId: 'abc', outputs: [stderr] };\n\n\t\tawait withTestNotebook(\n\t\t\t[\n\t\t\t\t['print(output content)', 'python', CellKind.Code, [output1, output2], {}],\n\t\t\t],\n\t\t\t(_editor, viewModel) => {\n\t\t\t\tconst cell = viewModel.viewCells[0];\n\t\t\t\tconst notebook = viewModel.notebookDocument;\n\t\t\t\tconst result = getAllOutputsText(notebook, cell);\n\n\t\t\t\tassert.strictEqual(result, 'stdoutstderr');\n\t\t\t},\n\t\t\tinstantiationService\n\t\t);\n\t});\n\n\ttest('get all mixed outputs of cell', async () => {\n\t\tconst stdout = { data: VSBuffer.fromString('stdout'), mime: 'application/vnd.code.notebook.stdout' };\n\t\tconst stderr = { data: VSBuffer.fromString('stderr'), mime: 'application/vnd.code.notebook.stderr' };\n\t\tconst plainText = { data: VSBuffer.fromString('output content'), mime: 'text/plain' };\n\t\tconst error = { data: VSBuffer.fromString(`{\"name\":\"Error Name\",\"message\":\"error message\",\"stack\":\"error stack\"}`), mime: 'application/vnd.code.notebook.error' };\n\t\tconst output1: IOutputDto = { outputId: 'abc', outputs: [stdout] };\n\t\tconst output2: IOutputDto = { outputId: 'abc', outputs: [stderr] };\n\t\tconst output3: IOutputDto = { outputId: 'abc', outputs: [plainText] };\n\t\tconst output4: IOutputDto = { outputId: 'abc', outputs: [error] };\n\n\t\tawait withTestNotebook(\n\t\t\t[\n\t\t\t\t['print(output content)', 'python', CellKind.Code, [output1, output2, output3, output4], {}],\n\t\t\t],\n\t\t\t(_editor, viewModel) => {\n\t\t\t\tconst cell = viewModel.viewCells[0];\n\t\t\t\tconst notebook = viewModel.notebookDocument;\n\t\t\t\tconst result = getAllOutputsText(notebook, cell);\n\n\t\t\t\tassert.strictEqual(result,\n\t\t\t\t\t'Cell output 1 of 3\\n' +\n\t\t\t\t\t'stdoutstderr\\n' +\n\t\t\t\t\t'Cell output 2 of 3\\n' +\n\t\t\t\t\t'output content\\n' +\n\t\t\t\t\t'Cell output 3 of 3\\n' +\n\t\t\t\t\t'error stack'\n\t\t\t\t);\n\t\t\t},\n\t\t\tinstantiationService\n\t\t);\n\n\t});\n\n\n});\n\nfunction createCellTemplate(disposables: DisposableStore) {\n\treturn {\n\t\toutputContainer: new FastDomNode(document.createElement('div')),\n\t\toutputShowMoreContainer: new FastDomNode(document.createElement('div')),\n\t\tfocusSinkElement: document.createElement('div'),\n\t\ttemplateDisposables: disposables,\n\t\telementDisposables: disposables,\n\t} as unknown as CodeCellRenderTemplate;\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport assert from 'assert';\nimport { VSBuffer } from '../../../../../base/common/buffer.js';\nimport { ensureNoDisposablesAreLeakedInTestSuite } from '../../../../../base/test/common/utils.js';\nimport { CellOutputContainer } from '../../browser/view/cellParts/cellOutput.js';\nimport { CodeCellRenderTemplate } from '../../browser/view/notebookRenderingCommon.js';\nimport { CodeCellViewModel } from '../../browser/viewModel/codeCellViewModel.js';\nimport { CellKind, INotebookRendererInfo, IOutputDto } from '../../common/notebookCommon.js';\nimport { setupInstantiationService, withTestNotebook } from './testNotebookEditor.js';\nimport { FastDomNode } from '../../../../../base/browser/fastDomNode.js';\nimport { DisposableStore } from '../../../../../base/common/lifecycle.js';\nimport { INotebookService } from '../../common/notebookService.js';\nimport { mock } from '../../../../../base/test/common/mock.js';\nimport { IMenu, IMenuService } from '../../../../../platform/actions/common/actions.js';\nimport { Event } from '../../../../../base/common/event.js';\nimport { TestInstantiationService } from '../../../../../platform/instantiation/test/common/instantiationServiceMock.js';\nimport { getAllOutputsText } from '../../browser/viewModel/cellOutputTextHelper.js';\n\nsuite('CellOutput', () => {\n\tconst store = ensureNoDisposablesAreLeakedInTestSuite();\n\tlet instantiationService: TestInstantiationService;\n\tlet outputMenus: IMenu[] = [];\n\n\tsetup(() => {\n\t\toutputMenus = [];\n\t\tinstantiationService = setupInstantiationService(store);\n\t\tinstantiationService.stub(INotebookService, new class extends mock<INotebookService>() {\n\t\t\toverride getOutputMimeTypeInfo(_textModel: any, _kernelProvides: readonly string[] | undefined, output: IOutputDto) {\n\t\t\t\treturn [{\n\t\t\t\t\trendererId: 'plainTextRendererId',\n\t\t\t\t\tmimeType: 'text/plain',\n\t\t\t\t\tisTrusted: true\n\t\t\t\t}, {\n\t\t\t\t\trendererId: 'htmlRendererId',\n\t\t\t\t\tmimeType: 'text/html',\n\t\t\t\t\tisTrusted: true\n\t\t\t\t}, {\n\t\t\t\t\trendererId: 'errorRendererId',\n\t\t\t\t\tmimeType: 'application/vnd.code.notebook.error',\n\t\t\t\t\tisTrusted: true\n\t\t\t\t}, {\n\t\t\t\t\trendererId: 'stderrRendererId',\n\t\t\t\t\tmimeType: 'application/vnd.code.notebook.stderr',\n\t\t\t\t\tisTrusted: true\n\t\t\t\t}, {\n\t\t\t\t\trendererId: 'stdoutRendererId',\n\t\t\t\t\tmimeType: 'application/vnd.code.notebook.stdout',\n\t\t\t\t\tisTrusted: true\n\t\t\t\t}]\n\t\t\t\t\t.filter(info => output.outputs.some(output => output.mime === info.mimeType));\n\t\t\t}\n\t\t\toverride getRendererInfo(): INotebookRendererInfo {\n\t\t\t\treturn {\n\t\t\t\t\tid: 'rendererId',\n\t\t\t\t\tdisplayName: 'Stubbed Renderer',\n\t\t\t\t\textensionId: { _lower: 'id', value: 'id' },\n\t\t\t\t} as INotebookRendererInfo;\n\t\t\t}\n\t\t});\n\t\tinstantiationService.stub(IMenuService, new class extends mock<IMenuService>() {\n\t\t\toverride createMenu() {\n\t\t\t\tconst menu = new class extends mock<IMenu>() {\n\t\t\t\t\toverride onDidChange = Event.None;\n\t\t\t\t\toverride getActions() { return []; }\n\t\t\t\t\toverride dispose() { outputMenus = outputMenus.filter(item => item !== menu); }\n\t\t\t\t};\n\t\t\t\toutputMenus.push(menu);\n\t\t\t\treturn menu;\n\t\t\t}\n\t\t});\n\t});\n\n\ttest('Render cell output items with multiple mime types', async function () {\n\t\tconst outputItem = { data: VSBuffer.fromString('output content'), mime: 'text/plain' };\n\t\tconst htmlOutputItem = { data: VSBuffer.fromString('output content'), mime: 'text/html' };\n\t\tconst output1: IOutputDto = { outputId: 'abc', outputs: [outputItem, htmlOutputItem] };\n\t\tconst output2: IOutputDto = { outputId: 'def', outputs: [outputItem, htmlOutputItem] };\n\n\t\tawait withTestNotebook(\n\t\t\t[\n\t\t\t\t['print(output content)', 'python', CellKind.Code, [output1, output2], {}],\n\t\t\t],\n\t\t\t(editor, viewModel, disposables, accessor) => {\n\n\t\t\t\tconst cell = viewModel.viewCells[0] as CodeCellViewModel;\n\t\t\t\tconst cellTemplate = createCellTemplate(disposables);\n\t\t\t\tconst output = disposables.add(accessor.createInstance(CellOutputContainer, editor, cell, cellTemplate, { limit: 100 }));\n\t\t\t\toutput.render();\n\t\t\t\tcell.outputsViewModels[0].setVisible(true);\n\t\t\t\tassert.strictEqual(outputMenus.length, 1, 'should have 1 output menus');\n\t\t\t\tassert(cellTemplate.outputContainer.domNode.style.display !== 'none', 'output container should be visible');\n\t\t\t\tcell.outputsViewModels[1].setVisible(true);\n\t\t\t\tassert.strictEqual(outputMenus.length, 2, 'should have 2 output menus');\n\t\t\t\tcell.outputsViewModels[1].setVisible(true);\n\t\t\t\tassert.strictEqual(outputMenus.length, 2, 'should still have 2 output menus');\n\t\t\t},\n\t\t\tinstantiationService\n\t\t);\n\t});\n\n\ttest('One of many cell outputs becomes hidden', async function () {\n\t\tconst outputItem = { data: VSBuffer.fromString('output content'), mime: 'text/plain' };\n\t\tconst htmlOutputItem = { data: VSBuffer.fromString('output content'), mime: 'text/html' };\n\t\tconst output1: IOutputDto = { outputId: 'abc', outputs: [outputItem, htmlOutputItem] };\n\t\tconst output2: IOutputDto = { outputId: 'def', outputs: [outputItem, htmlOutputItem] };\n\t\tconst output3: IOutputDto = { outputId: 'ghi', outputs: [outputItem, htmlOutputItem] };\n\n\t\tawait withTestNotebook(\n\t\t\t[\n\t\t\t\t['print(output content)', 'python', CellKind.Code, [output1, output2, output3], {}],\n\t\t\t],\n\t\t\t(editor, viewModel, disposables, accessor) => {\n\n\t\t\t\tconst cell = viewModel.viewCells[0] as CodeCellViewModel;\n\t\t\t\tconst cellTemplate = createCellTemplate(disposables);\n\t\t\t\tconst output = disposables.add(accessor.createInstance(CellOutputContainer, editor, cell, cellTemplate, { limit: 100 }));\n\t\t\t\toutput.render();\n\t\t\t\tcell.outputsViewModels[0].setVisible(true);\n\t\t\t\tcell.outputsViewModels[1].setVisible(true);\n\t\t\t\tcell.outputsViewModels[2].setVisible(true);\n\t\t\t\tcell.outputsViewModels[1].setVisible(false);\n\t\t\t\tassert(cellTemplate.outputContainer.domNode.style.display !== 'none', 'output container should be visible');\n\t\t\t\tassert.strictEqual(outputMenus.length, 2, 'should have 2 output menus');\n\t\t\t},\n\t\t\tinstantiationService\n\t\t);\n\t});\n\n\ttest('get all adjacent stream outputs', async () => {\n\t\tconst stdout = { data: VSBuffer.fromString('stdout'), mime: 'application/vnd.code.notebook.stdout' };\n\t\tconst stderr = { data: VSBuffer.fromString('stderr'), mime: 'application/vnd.code.notebook.stderr' };\n\t\tconst output1: IOutputDto = { outputId: 'abc', outputs: [stdout] };\n\t\tconst output2: IOutputDto = { outputId: 'abc', outputs: [stderr] };\n\n\t\tawait withTestNotebook(\n\t\t\t[\n\t\t\t\t['print(output content)', 'python', CellKind.Code, [output1, output2], {}],\n\t\t\t],\n\t\t\t(_editor, viewModel) => {\n\t\t\t\tconst cell = viewModel.viewCells[0];\n\t\t\t\tconst notebook = viewModel.notebookDocument;\n\t\t\t\tconst result = getAllOutputsText(notebook, cell);\n\n\t\t\t\tassert.strictEqual(result, 'stdoutstderr');\n\t\t\t},\n\t\t\tinstantiationService\n\t\t);\n\t});\n\n\ttest('get all mixed outputs of cell', async () => {\n\t\tconst stdout = { data: VSBuffer.fromString('stdout'), mime: 'application/vnd.code.notebook.stdout' };\n\t\tconst stderr = { data: VSBuffer.fromString('stderr'), mime: 'application/vnd.code.notebook.stderr' };\n\t\tconst plainText = { data: VSBuffer.fromString('output content'), mime: 'text/plain' };\n\t\tconst error = { data: VSBuffer.fromString(`{\"name\":\"Error Name\",\"message\":\"error message\",\"stack\":\"error stack\"}`), mime: 'application/vnd.code.notebook.error' };\n\t\tconst output1: IOutputDto = { outputId: 'abc', outputs: [stdout] };\n\t\tconst output2: IOutputDto = { outputId: 'abc', outputs: [stderr] };\n\t\tconst output3: IOutputDto = { outputId: 'abc', outputs: [plainText] };\n\t\tconst output4: IOutputDto = { outputId: 'abc', outputs: [error] };\n\n\t\tawait withTestNotebook(\n\t\t\t[\n\t\t\t\t['print(output content)', 'python', CellKind.Code, [output1, output2, output3, output4], {}],\n\t\t\t],\n\t\t\t(_editor, viewModel) => {\n\t\t\t\tconst cell = viewModel.viewCells[0];\n\t\t\t\tconst notebook = viewModel.notebookDocument;\n\t\t\t\tconst result = getAllOutputsText(notebook, cell);\n\n\t\t\t\tassert.strictEqual(result,\n\t\t\t\t\t'Cell output 1 of 3\\n' +\n\t\t\t\t\t'stdoutstderr\\n' +\n\t\t\t\t\t'Cell output 2 of 3\\n' +\n\t\t\t\t\t'output content\\n' +\n\t\t\t\t\t'Cell output 3 of 3\\n' +\n\t\t\t\t\t'error stack'\n\t\t\t\t);\n\t\t\t},\n\t\t\tinstantiationService\n\t\t);\n\n\t});\n\n\n});\n\nfunction createCellTemplate(disposables: DisposableStore) {\n\treturn {\n\t\toutputContainer: new FastDomNode(document.createElement('div')),\n\t\toutputShowMoreContainer: new FastDomNode(document.createElement('div')),\n\t\tfocusSinkElement: document.createElement('div'),\n\t\ttemplateDisposables: disposables,\n\t\telementDisposables: disposables,\n\t} as unknown as CodeCellRenderTemplate;\n}\n"]}