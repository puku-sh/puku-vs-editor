{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/contrib/notebook/test/browser/notebookCellLayoutManager.test.ts","vs/workbench/contrib/notebook/test/browser/notebookCellLayoutManager.test.ts"],"names":[],"mappings":"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","file":"notebookCellLayoutManager.test.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nimport * as assert from 'assert';\nimport { ensureNoDisposablesAreLeakedInTestSuite } from '../../../../../base/test/common/utils.js';\nimport { ICellViewModel } from '../../browser/notebookBrowser.js';\nimport { NotebookCellLayoutManager } from '../../browser/notebookCellLayoutManager.js';\nimport { INotebookCellList } from '../../browser/view/notebookRenderingCommon.js';\nimport { INotebookLoggingService } from '../../common/notebookLoggingService.js';\nimport { NotebookEditorWidget } from '../../browser/notebookEditorWidget.js';\nimport { NotebookViewModel } from '../../browser/viewModel/notebookViewModelImpl.js';\nimport { ICellRange } from '../../common/notebookRange.js';\n\nsuite('NotebookCellLayoutManager', () => {\n\n\tconst store = ensureNoDisposablesAreLeakedInTestSuite();\n\n\tconst mockCellViewModel = () => {\n\t\treturn { handle: 'cell1' } as unknown as ICellViewModel;\n\t};\n\n\tclass MockList implements Pick<INotebookCellList, 'getViewIndex' | 'elementHeight' | 'inRenderingTransaction' | 'updateElementHeight2'> {\n\t\tprivate _height = new Map();\n\t\tgetViewIndex(cell: ICellViewModel) { return this.cells.indexOf(cell) < 0 ? undefined : this.cells.indexOf(cell); }\n\t\telementHeight(cell: ICellViewModel) { return this._height.get(cell) ?? 100; }\n\t\tinRenderingTransaction = false;\n\t\tupdateElementHeight2(cell: ICellViewModel, height: number) { this._height.set(cell, height); }\n\t\tgetViewIndexCalled = false;\n\t\tcells: ICellViewModel[] = [];\n\t}\n\tclass MockLoggingService implements INotebookLoggingService {\n\t\treadonly _serviceBrand: undefined;\n\t\tdebug() { }\n\t\tinfo() { }\n\t\twarn() { }\n\t\terror() { }\n\t\ttrace() { }\n\t}\n\tclass MockNotebookWidget implements Pick<NotebookEditorWidget, 'viewModel' | 'hasEditorFocus' | 'getAbsoluteTopOfElement' | 'getLength' | 'visibleRanges' | 'getDomNode'> {\n\t\tviewModel: NotebookViewModel | undefined = {\n\t\t\thasCell: (cell: ICellViewModel) => true,\n\t\t\tgetCellIndex: () => 0\n\t\t} as unknown as NotebookViewModel;\n\t\thasEditorFocus() { return true; }\n\t\tgetAbsoluteTopOfElement() { return 0; }\n\t\tgetLength() { return 1; }\n\t\tvisibleRanges: ICellRange[] = [{ start: 0, end: 0 }];\n\t\tgetDomNode(): HTMLElement {\n\t\t\treturn {\n\t\t\t\tstyle: {\n\t\t\t\t\theight: '100px'\n\t\t\t\t}\n\t\t\t} as HTMLElement;\n\t\t}\n\t}\n\n\ttest('should update cell height', async () => {\n\t\tconst cell = mockCellViewModel();\n\t\tconst cell2 = mockCellViewModel();\n\t\tconst list = new MockList();\n\t\tlist.cells.push(cell);\n\t\tlist.cells.push(cell2);\n\t\tconst widget = new MockNotebookWidget();\n\t\tconst mgr = store.add(new NotebookCellLayoutManager(widget as unknown as NotebookEditorWidget, list as unknown as INotebookCellList, new MockLoggingService()));\n\t\tmgr.layoutNotebookCell(cell, 200);\n\t\tmgr.layoutNotebookCell(cell2, 200);\n\t\tassert.strictEqual(list.elementHeight(cell), 200);\n\t\tassert.strictEqual(list.elementHeight(cell2), 200);\n\t});\n\n\ttest('should schedule updates if already in a rendering transaction', async () => {\n\t\tconst cell = mockCellViewModel();\n\t\tconst cell2 = mockCellViewModel();\n\t\tconst list = new MockList();\n\t\tlist.inRenderingTransaction = true;\n\t\tlist.cells.push(cell);\n\t\tlist.cells.push(cell2);\n\t\tconst widget = new MockNotebookWidget();\n\t\tconst mgr = store.add(new NotebookCellLayoutManager(widget as unknown as NotebookEditorWidget, list as unknown as INotebookCellList, new MockLoggingService()));\n\n\t\tconst promise = mgr.layoutNotebookCell(cell, 200);\n\t\tmgr.layoutNotebookCell(cell2, 200);\n\t\tassert.strictEqual(list.elementHeight(cell), 100);\n\t\tassert.strictEqual(list.elementHeight(cell2), 100);\n\t\tlist.inRenderingTransaction = false;\n\n\t\tawait promise;\n\n\t\tassert.strictEqual(list.elementHeight(cell), 200);\n\t\tassert.strictEqual(list.elementHeight(cell2), 200);\n\t});\n\n\ttest('should not update if cell is hidden', async () => {\n\t\tconst cell = mockCellViewModel();\n\t\tconst list = new MockList();\n\t\tconst widget = new MockNotebookWidget();\n\t\tconst mgr = store.add(new NotebookCellLayoutManager(widget as unknown as NotebookEditorWidget, list as unknown as INotebookCellList, new MockLoggingService()));\n\t\tawait mgr.layoutNotebookCell(cell, 200);\n\t\tassert.strictEqual(list.elementHeight(cell), 100);\n\t});\n\n\ttest('should not update if height is unchanged', async () => {\n\t\tconst cell = mockCellViewModel();\n\t\tconst list = new MockList();\n\t\tlist.cells.push(cell);\n\t\tconst widget = new MockNotebookWidget();\n\t\tconst mgr = store.add(new NotebookCellLayoutManager(widget as unknown as NotebookEditorWidget, list as unknown as INotebookCellList, new MockLoggingService()));\n\t\tawait mgr.layoutNotebookCell(cell, 100);\n\t\tassert.strictEqual(list.elementHeight(cell), 100);\n\t});\n});\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nimport * as assert from 'assert';\nimport { ensureNoDisposablesAreLeakedInTestSuite } from '../../../../../base/test/common/utils.js';\nimport { ICellViewModel } from '../../browser/notebookBrowser.js';\nimport { NotebookCellLayoutManager } from '../../browser/notebookCellLayoutManager.js';\nimport { INotebookCellList } from '../../browser/view/notebookRenderingCommon.js';\nimport { INotebookLoggingService } from '../../common/notebookLoggingService.js';\nimport { NotebookEditorWidget } from '../../browser/notebookEditorWidget.js';\nimport { NotebookViewModel } from '../../browser/viewModel/notebookViewModelImpl.js';\nimport { ICellRange } from '../../common/notebookRange.js';\n\nsuite('NotebookCellLayoutManager', () => {\n\n\tconst store = ensureNoDisposablesAreLeakedInTestSuite();\n\n\tconst mockCellViewModel = () => {\n\t\treturn { handle: 'cell1' } as unknown as ICellViewModel;\n\t};\n\n\tclass MockList implements Pick<INotebookCellList, 'getViewIndex' | 'elementHeight' | 'inRenderingTransaction' | 'updateElementHeight2'> {\n\t\tprivate _height = new Map();\n\t\tgetViewIndex(cell: ICellViewModel) { return this.cells.indexOf(cell) < 0 ? undefined : this.cells.indexOf(cell); }\n\t\telementHeight(cell: ICellViewModel) { return this._height.get(cell) ?? 100; }\n\t\tinRenderingTransaction = false;\n\t\tupdateElementHeight2(cell: ICellViewModel, height: number) { this._height.set(cell, height); }\n\t\tgetViewIndexCalled = false;\n\t\tcells: ICellViewModel[] = [];\n\t}\n\tclass MockLoggingService implements INotebookLoggingService {\n\t\treadonly _serviceBrand: undefined;\n\t\tdebug() { }\n\t\tinfo() { }\n\t\twarn() { }\n\t\terror() { }\n\t\ttrace() { }\n\t}\n\tclass MockNotebookWidget implements Pick<NotebookEditorWidget, 'viewModel' | 'hasEditorFocus' | 'getAbsoluteTopOfElement' | 'getLength' | 'visibleRanges' | 'getDomNode'> {\n\t\tviewModel: NotebookViewModel | undefined = {\n\t\t\thasCell: (cell: ICellViewModel) => true,\n\t\t\tgetCellIndex: () => 0\n\t\t} as unknown as NotebookViewModel;\n\t\thasEditorFocus() { return true; }\n\t\tgetAbsoluteTopOfElement() { return 0; }\n\t\tgetLength() { return 1; }\n\t\tvisibleRanges: ICellRange[] = [{ start: 0, end: 0 }];\n\t\tgetDomNode(): HTMLElement {\n\t\t\treturn {\n\t\t\t\tstyle: {\n\t\t\t\t\theight: '100px'\n\t\t\t\t}\n\t\t\t} as HTMLElement;\n\t\t}\n\t}\n\n\ttest('should update cell height', async () => {\n\t\tconst cell = mockCellViewModel();\n\t\tconst cell2 = mockCellViewModel();\n\t\tconst list = new MockList();\n\t\tlist.cells.push(cell);\n\t\tlist.cells.push(cell2);\n\t\tconst widget = new MockNotebookWidget();\n\t\tconst mgr = store.add(new NotebookCellLayoutManager(widget as unknown as NotebookEditorWidget, list as unknown as INotebookCellList, new MockLoggingService()));\n\t\tmgr.layoutNotebookCell(cell, 200);\n\t\tmgr.layoutNotebookCell(cell2, 200);\n\t\tassert.strictEqual(list.elementHeight(cell), 200);\n\t\tassert.strictEqual(list.elementHeight(cell2), 200);\n\t});\n\n\ttest('should schedule updates if already in a rendering transaction', async () => {\n\t\tconst cell = mockCellViewModel();\n\t\tconst cell2 = mockCellViewModel();\n\t\tconst list = new MockList();\n\t\tlist.inRenderingTransaction = true;\n\t\tlist.cells.push(cell);\n\t\tlist.cells.push(cell2);\n\t\tconst widget = new MockNotebookWidget();\n\t\tconst mgr = store.add(new NotebookCellLayoutManager(widget as unknown as NotebookEditorWidget, list as unknown as INotebookCellList, new MockLoggingService()));\n\n\t\tconst promise = mgr.layoutNotebookCell(cell, 200);\n\t\tmgr.layoutNotebookCell(cell2, 200);\n\t\tassert.strictEqual(list.elementHeight(cell), 100);\n\t\tassert.strictEqual(list.elementHeight(cell2), 100);\n\t\tlist.inRenderingTransaction = false;\n\n\t\tawait promise;\n\n\t\tassert.strictEqual(list.elementHeight(cell), 200);\n\t\tassert.strictEqual(list.elementHeight(cell2), 200);\n\t});\n\n\ttest('should not update if cell is hidden', async () => {\n\t\tconst cell = mockCellViewModel();\n\t\tconst list = new MockList();\n\t\tconst widget = new MockNotebookWidget();\n\t\tconst mgr = store.add(new NotebookCellLayoutManager(widget as unknown as NotebookEditorWidget, list as unknown as INotebookCellList, new MockLoggingService()));\n\t\tawait mgr.layoutNotebookCell(cell, 200);\n\t\tassert.strictEqual(list.elementHeight(cell), 100);\n\t});\n\n\ttest('should not update if height is unchanged', async () => {\n\t\tconst cell = mockCellViewModel();\n\t\tconst list = new MockList();\n\t\tlist.cells.push(cell);\n\t\tconst widget = new MockNotebookWidget();\n\t\tconst mgr = store.add(new NotebookCellLayoutManager(widget as unknown as NotebookEditorWidget, list as unknown as INotebookCellList, new MockLoggingService()));\n\t\tawait mgr.layoutNotebookCell(cell, 100);\n\t\tassert.strictEqual(list.elementHeight(cell), 100);\n\t});\n});\n"]}