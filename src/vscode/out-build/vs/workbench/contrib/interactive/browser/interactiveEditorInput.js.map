{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/contrib/interactive/browser/interactiveEditorInput.ts","vs/workbench/contrib/interactive/browser/interactiveEditorInput.ts"],"names":[],"mappings":"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","file":"interactiveEditorInput.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Event } from '../../../../base/common/event.js';\nimport { IReference } from '../../../../base/common/lifecycle.js';\nimport * as paths from '../../../../base/common/path.js';\nimport { isEqual, joinPath } from '../../../../base/common/resources.js';\nimport { URI } from '../../../../base/common/uri.js';\nimport { PLAINTEXT_LANGUAGE_ID } from '../../../../editor/common/languages/modesRegistry.js';\nimport { IResolvedTextEditorModel, ITextModelService } from '../../../../editor/common/services/resolverService.js';\nimport { IConfigurationService } from '../../../../platform/configuration/common/configuration.js';\nimport { IFileDialogService } from '../../../../platform/dialogs/common/dialogs.js';\nimport { IInstantiationService } from '../../../../platform/instantiation/common/instantiation.js';\nimport { EditorInputCapabilities, GroupIdentifier, IRevertOptions, ISaveOptions, IUntypedEditorInput } from '../../../common/editor.js';\nimport { EditorInput } from '../../../common/editor/editorInput.js';\nimport { IInteractiveDocumentService } from './interactiveDocumentService.js';\nimport { IInteractiveHistoryService } from './interactiveHistoryService.js';\nimport { IResolvedNotebookEditorModel, NotebookSetting } from '../../notebook/common/notebookCommon.js';\nimport { ICompositeNotebookEditorInput, NotebookEditorInput } from '../../notebook/common/notebookEditorInput.js';\nimport { INotebookService } from '../../notebook/common/notebookService.js';\n\nexport class InteractiveEditorInput extends EditorInput implements ICompositeNotebookEditorInput {\n\tstatic create(instantiationService: IInstantiationService, resource: URI, inputResource: URI, title?: string, language?: string) {\n\t\treturn instantiationService.createInstance(InteractiveEditorInput, resource, inputResource, title, language);\n\t}\n\n\tprivate static windowNames: Record<string, string> = {};\n\n\tstatic setName(notebookUri: URI, title: string | undefined) {\n\t\tif (title) {\n\t\t\tthis.windowNames[notebookUri.path] = title;\n\t\t}\n\t}\n\n\tstatic readonly ID: string = 'workbench.input.interactive';\n\n\tpublic override get editorId(): string {\n\t\treturn 'interactive';\n\t}\n\n\toverride get typeId(): string {\n\t\treturn InteractiveEditorInput.ID;\n\t}\n\n\tprivate name: string;\n\tprivate readonly isScratchpad: boolean;\n\n\tget language() {\n\t\treturn this._inputModelRef?.object.textEditorModel.getLanguageId() ?? this._initLanguage;\n\t}\n\tprivate _initLanguage?: string;\n\n\tprivate _notebookEditorInput: NotebookEditorInput;\n\tget notebookEditorInput() {\n\t\treturn this._notebookEditorInput;\n\t}\n\n\tget editorInputs() {\n\t\treturn [this._notebookEditorInput];\n\t}\n\n\tprivate _resource: URI;\n\n\toverride get resource(): URI {\n\t\treturn this._resource;\n\t}\n\n\tprivate _inputResource: URI;\n\n\tget inputResource() {\n\t\treturn this._inputResource;\n\t}\n\tprivate _inputResolver: Promise<IResolvedNotebookEditorModel | null> | null;\n\tprivate _editorModelReference: IResolvedNotebookEditorModel | null;\n\n\tprivate _inputModelRef: IReference<IResolvedTextEditorModel> | null;\n\n\tget primary(): EditorInput {\n\t\treturn this._notebookEditorInput;\n\t}\n\tprivate _textModelService: ITextModelService;\n\tprivate _interactiveDocumentService: IInteractiveDocumentService;\n\tprivate _historyService: IInteractiveHistoryService;\n\n\n\tconstructor(\n\t\tresource: URI,\n\t\tinputResource: URI,\n\t\ttitle: string | undefined,\n\t\tlanguageId: string | undefined,\n\t\t@IInstantiationService instantiationService: IInstantiationService,\n\t\t@ITextModelService textModelService: ITextModelService,\n\t\t@IInteractiveDocumentService interactiveDocumentService: IInteractiveDocumentService,\n\t\t@IInteractiveHistoryService historyService: IInteractiveHistoryService,\n\t\t@INotebookService private readonly _notebookService: INotebookService,\n\t\t@IFileDialogService private readonly _fileDialogService: IFileDialogService,\n\t\t@IConfigurationService configurationService: IConfigurationService\n\t) {\n\t\tconst input = NotebookEditorInput.getOrCreate(instantiationService, resource, undefined, 'interactive', {});\n\t\tsuper();\n\t\tthis.isScratchpad = configurationService.getValue<boolean>(NotebookSetting.InteractiveWindowPromptToSave) !== true;\n\t\tthis._notebookEditorInput = input;\n\t\tthis._register(this._notebookEditorInput);\n\t\tthis.name = title ?? InteractiveEditorInput.windowNames[resource.path] ?? paths.basename(resource.path, paths.extname(resource.path));\n\t\tthis._initLanguage = languageId;\n\t\tthis._resource = resource;\n\t\tthis._inputResource = inputResource;\n\t\tthis._inputResolver = null;\n\t\tthis._editorModelReference = null;\n\t\tthis._inputModelRef = null;\n\t\tthis._textModelService = textModelService;\n\t\tthis._interactiveDocumentService = interactiveDocumentService;\n\t\tthis._historyService = historyService;\n\n\t\tthis._registerListeners();\n\t}\n\n\tprivate _registerListeners(): void {\n\t\tconst oncePrimaryDisposed = Event.once(this.primary.onWillDispose);\n\t\tthis._register(oncePrimaryDisposed(() => {\n\t\t\tif (!this.isDisposed()) {\n\t\t\t\tthis.dispose();\n\t\t\t}\n\t\t}));\n\n\t\t// Re-emit some events from the primary side to the outside\n\t\tthis._register(this.primary.onDidChangeDirty(() => this._onDidChangeDirty.fire()));\n\t\tthis._register(this.primary.onDidChangeLabel(() => this._onDidChangeLabel.fire()));\n\n\t\t// Re-emit some events from both sides to the outside\n\t\tthis._register(this.primary.onDidChangeCapabilities(() => this._onDidChangeCapabilities.fire()));\n\t}\n\n\toverride get capabilities(): EditorInputCapabilities {\n\t\tconst scratchPad = this.isScratchpad ? EditorInputCapabilities.Scratchpad : 0;\n\n\t\treturn EditorInputCapabilities.Untitled\n\t\t\t| EditorInputCapabilities.Readonly\n\t\t\t| scratchPad;\n\t}\n\n\tprivate async _resolveEditorModel() {\n\t\tif (!this._editorModelReference) {\n\t\t\tthis._editorModelReference = await this._notebookEditorInput.resolve();\n\t\t}\n\n\t\treturn this._editorModelReference;\n\t}\n\n\toverride async resolve(): Promise<IResolvedNotebookEditorModel | null> {\n\t\tif (this._editorModelReference) {\n\t\t\treturn this._editorModelReference;\n\t\t}\n\n\t\tif (this._inputResolver) {\n\t\t\treturn this._inputResolver;\n\t\t}\n\n\t\tthis._inputResolver = this._resolveEditorModel();\n\n\t\treturn this._inputResolver;\n\t}\n\n\tasync resolveInput(language?: string) {\n\t\tif (this._inputModelRef) {\n\t\t\treturn this._inputModelRef.object.textEditorModel;\n\t\t}\n\n\t\tconst resolvedLanguage = language ?? this._initLanguage ?? PLAINTEXT_LANGUAGE_ID;\n\t\tthis._interactiveDocumentService.willCreateInteractiveDocument(this.resource, this.inputResource, resolvedLanguage);\n\t\tthis._inputModelRef = await this._textModelService.createModelReference(this.inputResource);\n\n\t\treturn this._inputModelRef.object.textEditorModel;\n\t}\n\n\toverride async save(group: GroupIdentifier, options?: ISaveOptions): Promise<EditorInput | IUntypedEditorInput | undefined> {\n\t\tif (this._editorModelReference) {\n\n\t\t\tif (this.hasCapability(EditorInputCapabilities.Untitled)) {\n\t\t\t\treturn this.saveAs(group, options);\n\t\t\t} else {\n\t\t\t\tawait this._editorModelReference.save(options);\n\t\t\t}\n\n\t\t\treturn this;\n\t\t}\n\n\t\treturn undefined;\n\t}\n\n\toverride async saveAs(group: GroupIdentifier, options?: ISaveOptions): Promise<IUntypedEditorInput | undefined> {\n\t\tif (!this._editorModelReference) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\tconst provider = this._notebookService.getContributedNotebookType('interactive');\n\n\t\tif (!provider) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\tconst filename = this.getName() + '.ipynb';\n\t\tconst pathCandidate = joinPath(await this._fileDialogService.defaultFilePath(), filename);\n\n\t\tconst target = await this._fileDialogService.pickFileToSave(pathCandidate, options?.availableFileSystems);\n\t\tif (!target) {\n\t\t\treturn undefined; // save cancelled\n\t\t}\n\n\t\tconst saved = await this._editorModelReference.saveAs(target);\n\t\tif (saved && 'resource' in saved && saved.resource) {\n\t\t\tthis._notebookService.getNotebookTextModel(saved.resource)?.dispose();\n\t\t}\n\t\treturn saved;\n\t}\n\n\toverride matches(otherInput: EditorInput | IUntypedEditorInput): boolean {\n\t\tif (super.matches(otherInput)) {\n\t\t\treturn true;\n\t\t}\n\t\tif (otherInput instanceof InteractiveEditorInput) {\n\t\t\treturn isEqual(this.resource, otherInput.resource) && isEqual(this.inputResource, otherInput.inputResource);\n\t\t}\n\t\treturn false;\n\t}\n\n\toverride getName() {\n\t\treturn this.name;\n\t}\n\n\toverride isDirty(): boolean {\n\t\tif (this.isScratchpad) {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn this._editorModelReference?.isDirty() ?? false;\n\t}\n\n\toverride isModified() {\n\t\treturn this._editorModelReference?.isModified() ?? false;\n\t}\n\n\toverride async revert(_group: GroupIdentifier, options?: IRevertOptions): Promise<void> {\n\t\tif (this._editorModelReference && this._editorModelReference.isDirty()) {\n\t\t\tawait this._editorModelReference.revert(options);\n\t\t}\n\t}\n\n\toverride dispose() {\n\t\t// we support closing the interactive window without prompt, so the editor model should not be dirty\n\t\tthis._editorModelReference?.revert({ soft: true });\n\n\t\tthis._notebookEditorInput?.dispose();\n\t\tthis._editorModelReference?.dispose();\n\t\tthis._editorModelReference = null;\n\t\tthis._interactiveDocumentService.willRemoveInteractiveDocument(this.resource, this.inputResource);\n\t\tthis._inputModelRef?.dispose();\n\t\tthis._inputModelRef = null;\n\t\tsuper.dispose();\n\t}\n\n\tget historyService() {\n\t\treturn this._historyService;\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Event } from '../../../../base/common/event.js';\nimport { IReference } from '../../../../base/common/lifecycle.js';\nimport * as paths from '../../../../base/common/path.js';\nimport { isEqual, joinPath } from '../../../../base/common/resources.js';\nimport { URI } from '../../../../base/common/uri.js';\nimport { PLAINTEXT_LANGUAGE_ID } from '../../../../editor/common/languages/modesRegistry.js';\nimport { IResolvedTextEditorModel, ITextModelService } from '../../../../editor/common/services/resolverService.js';\nimport { IConfigurationService } from '../../../../platform/configuration/common/configuration.js';\nimport { IFileDialogService } from '../../../../platform/dialogs/common/dialogs.js';\nimport { IInstantiationService } from '../../../../platform/instantiation/common/instantiation.js';\nimport { EditorInputCapabilities, GroupIdentifier, IRevertOptions, ISaveOptions, IUntypedEditorInput } from '../../../common/editor.js';\nimport { EditorInput } from '../../../common/editor/editorInput.js';\nimport { IInteractiveDocumentService } from './interactiveDocumentService.js';\nimport { IInteractiveHistoryService } from './interactiveHistoryService.js';\nimport { IResolvedNotebookEditorModel, NotebookSetting } from '../../notebook/common/notebookCommon.js';\nimport { ICompositeNotebookEditorInput, NotebookEditorInput } from '../../notebook/common/notebookEditorInput.js';\nimport { INotebookService } from '../../notebook/common/notebookService.js';\n\nexport class InteractiveEditorInput extends EditorInput implements ICompositeNotebookEditorInput {\n\tstatic create(instantiationService: IInstantiationService, resource: URI, inputResource: URI, title?: string, language?: string) {\n\t\treturn instantiationService.createInstance(InteractiveEditorInput, resource, inputResource, title, language);\n\t}\n\n\tprivate static windowNames: Record<string, string> = {};\n\n\tstatic setName(notebookUri: URI, title: string | undefined) {\n\t\tif (title) {\n\t\t\tthis.windowNames[notebookUri.path] = title;\n\t\t}\n\t}\n\n\tstatic readonly ID: string = 'workbench.input.interactive';\n\n\tpublic override get editorId(): string {\n\t\treturn 'interactive';\n\t}\n\n\toverride get typeId(): string {\n\t\treturn InteractiveEditorInput.ID;\n\t}\n\n\tprivate name: string;\n\tprivate readonly isScratchpad: boolean;\n\n\tget language() {\n\t\treturn this._inputModelRef?.object.textEditorModel.getLanguageId() ?? this._initLanguage;\n\t}\n\tprivate _initLanguage?: string;\n\n\tprivate _notebookEditorInput: NotebookEditorInput;\n\tget notebookEditorInput() {\n\t\treturn this._notebookEditorInput;\n\t}\n\n\tget editorInputs() {\n\t\treturn [this._notebookEditorInput];\n\t}\n\n\tprivate _resource: URI;\n\n\toverride get resource(): URI {\n\t\treturn this._resource;\n\t}\n\n\tprivate _inputResource: URI;\n\n\tget inputResource() {\n\t\treturn this._inputResource;\n\t}\n\tprivate _inputResolver: Promise<IResolvedNotebookEditorModel | null> | null;\n\tprivate _editorModelReference: IResolvedNotebookEditorModel | null;\n\n\tprivate _inputModelRef: IReference<IResolvedTextEditorModel> | null;\n\n\tget primary(): EditorInput {\n\t\treturn this._notebookEditorInput;\n\t}\n\tprivate _textModelService: ITextModelService;\n\tprivate _interactiveDocumentService: IInteractiveDocumentService;\n\tprivate _historyService: IInteractiveHistoryService;\n\n\n\tconstructor(\n\t\tresource: URI,\n\t\tinputResource: URI,\n\t\ttitle: string | undefined,\n\t\tlanguageId: string | undefined,\n\t\t@IInstantiationService instantiationService: IInstantiationService,\n\t\t@ITextModelService textModelService: ITextModelService,\n\t\t@IInteractiveDocumentService interactiveDocumentService: IInteractiveDocumentService,\n\t\t@IInteractiveHistoryService historyService: IInteractiveHistoryService,\n\t\t@INotebookService private readonly _notebookService: INotebookService,\n\t\t@IFileDialogService private readonly _fileDialogService: IFileDialogService,\n\t\t@IConfigurationService configurationService: IConfigurationService\n\t) {\n\t\tconst input = NotebookEditorInput.getOrCreate(instantiationService, resource, undefined, 'interactive', {});\n\t\tsuper();\n\t\tthis.isScratchpad = configurationService.getValue<boolean>(NotebookSetting.InteractiveWindowPromptToSave) !== true;\n\t\tthis._notebookEditorInput = input;\n\t\tthis._register(this._notebookEditorInput);\n\t\tthis.name = title ?? InteractiveEditorInput.windowNames[resource.path] ?? paths.basename(resource.path, paths.extname(resource.path));\n\t\tthis._initLanguage = languageId;\n\t\tthis._resource = resource;\n\t\tthis._inputResource = inputResource;\n\t\tthis._inputResolver = null;\n\t\tthis._editorModelReference = null;\n\t\tthis._inputModelRef = null;\n\t\tthis._textModelService = textModelService;\n\t\tthis._interactiveDocumentService = interactiveDocumentService;\n\t\tthis._historyService = historyService;\n\n\t\tthis._registerListeners();\n\t}\n\n\tprivate _registerListeners(): void {\n\t\tconst oncePrimaryDisposed = Event.once(this.primary.onWillDispose);\n\t\tthis._register(oncePrimaryDisposed(() => {\n\t\t\tif (!this.isDisposed()) {\n\t\t\t\tthis.dispose();\n\t\t\t}\n\t\t}));\n\n\t\t// Re-emit some events from the primary side to the outside\n\t\tthis._register(this.primary.onDidChangeDirty(() => this._onDidChangeDirty.fire()));\n\t\tthis._register(this.primary.onDidChangeLabel(() => this._onDidChangeLabel.fire()));\n\n\t\t// Re-emit some events from both sides to the outside\n\t\tthis._register(this.primary.onDidChangeCapabilities(() => this._onDidChangeCapabilities.fire()));\n\t}\n\n\toverride get capabilities(): EditorInputCapabilities {\n\t\tconst scratchPad = this.isScratchpad ? EditorInputCapabilities.Scratchpad : 0;\n\n\t\treturn EditorInputCapabilities.Untitled\n\t\t\t| EditorInputCapabilities.Readonly\n\t\t\t| scratchPad;\n\t}\n\n\tprivate async _resolveEditorModel() {\n\t\tif (!this._editorModelReference) {\n\t\t\tthis._editorModelReference = await this._notebookEditorInput.resolve();\n\t\t}\n\n\t\treturn this._editorModelReference;\n\t}\n\n\toverride async resolve(): Promise<IResolvedNotebookEditorModel | null> {\n\t\tif (this._editorModelReference) {\n\t\t\treturn this._editorModelReference;\n\t\t}\n\n\t\tif (this._inputResolver) {\n\t\t\treturn this._inputResolver;\n\t\t}\n\n\t\tthis._inputResolver = this._resolveEditorModel();\n\n\t\treturn this._inputResolver;\n\t}\n\n\tasync resolveInput(language?: string) {\n\t\tif (this._inputModelRef) {\n\t\t\treturn this._inputModelRef.object.textEditorModel;\n\t\t}\n\n\t\tconst resolvedLanguage = language ?? this._initLanguage ?? PLAINTEXT_LANGUAGE_ID;\n\t\tthis._interactiveDocumentService.willCreateInteractiveDocument(this.resource, this.inputResource, resolvedLanguage);\n\t\tthis._inputModelRef = await this._textModelService.createModelReference(this.inputResource);\n\n\t\treturn this._inputModelRef.object.textEditorModel;\n\t}\n\n\toverride async save(group: GroupIdentifier, options?: ISaveOptions): Promise<EditorInput | IUntypedEditorInput | undefined> {\n\t\tif (this._editorModelReference) {\n\n\t\t\tif (this.hasCapability(EditorInputCapabilities.Untitled)) {\n\t\t\t\treturn this.saveAs(group, options);\n\t\t\t} else {\n\t\t\t\tawait this._editorModelReference.save(options);\n\t\t\t}\n\n\t\t\treturn this;\n\t\t}\n\n\t\treturn undefined;\n\t}\n\n\toverride async saveAs(group: GroupIdentifier, options?: ISaveOptions): Promise<IUntypedEditorInput | undefined> {\n\t\tif (!this._editorModelReference) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\tconst provider = this._notebookService.getContributedNotebookType('interactive');\n\n\t\tif (!provider) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\tconst filename = this.getName() + '.ipynb';\n\t\tconst pathCandidate = joinPath(await this._fileDialogService.defaultFilePath(), filename);\n\n\t\tconst target = await this._fileDialogService.pickFileToSave(pathCandidate, options?.availableFileSystems);\n\t\tif (!target) {\n\t\t\treturn undefined; // save cancelled\n\t\t}\n\n\t\tconst saved = await this._editorModelReference.saveAs(target);\n\t\tif (saved && 'resource' in saved && saved.resource) {\n\t\t\tthis._notebookService.getNotebookTextModel(saved.resource)?.dispose();\n\t\t}\n\t\treturn saved;\n\t}\n\n\toverride matches(otherInput: EditorInput | IUntypedEditorInput): boolean {\n\t\tif (super.matches(otherInput)) {\n\t\t\treturn true;\n\t\t}\n\t\tif (otherInput instanceof InteractiveEditorInput) {\n\t\t\treturn isEqual(this.resource, otherInput.resource) && isEqual(this.inputResource, otherInput.inputResource);\n\t\t}\n\t\treturn false;\n\t}\n\n\toverride getName() {\n\t\treturn this.name;\n\t}\n\n\toverride isDirty(): boolean {\n\t\tif (this.isScratchpad) {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn this._editorModelReference?.isDirty() ?? false;\n\t}\n\n\toverride isModified() {\n\t\treturn this._editorModelReference?.isModified() ?? false;\n\t}\n\n\toverride async revert(_group: GroupIdentifier, options?: IRevertOptions): Promise<void> {\n\t\tif (this._editorModelReference && this._editorModelReference.isDirty()) {\n\t\t\tawait this._editorModelReference.revert(options);\n\t\t}\n\t}\n\n\toverride dispose() {\n\t\t// we support closing the interactive window without prompt, so the editor model should not be dirty\n\t\tthis._editorModelReference?.revert({ soft: true });\n\n\t\tthis._notebookEditorInput?.dispose();\n\t\tthis._editorModelReference?.dispose();\n\t\tthis._editorModelReference = null;\n\t\tthis._interactiveDocumentService.willRemoveInteractiveDocument(this.resource, this.inputResource);\n\t\tthis._inputModelRef?.dispose();\n\t\tthis._inputModelRef = null;\n\t\tsuper.dispose();\n\t}\n\n\tget historyService() {\n\t\treturn this._historyService;\n\t}\n}\n"]}