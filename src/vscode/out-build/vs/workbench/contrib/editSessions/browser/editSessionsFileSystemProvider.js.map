{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/contrib/editSessions/browser/editSessionsFileSystemProvider.ts","vs/workbench/contrib/editSessions/browser/editSessionsFileSystemProvider.ts"],"names":[],"mappings":"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","file":"editSessionsFileSystemProvider.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Disposable, IDisposable } from '../../../../base/common/lifecycle.js';\nimport { Event } from '../../../../base/common/event.js';\nimport { URI } from '../../../../base/common/uri.js';\nimport { FilePermission, FileSystemProviderCapabilities, FileSystemProviderErrorCode, FileType, IFileDeleteOptions, IFileOverwriteOptions, IFileSystemProviderWithFileReadWriteCapability, IStat, IWatchOptions } from '../../../../platform/files/common/files.js';\nimport { ChangeType, decodeEditSessionFileContent, EDIT_SESSIONS_SCHEME, EditSession, IEditSessionsStorageService } from '../common/editSessions.js';\nimport { NotSupportedError } from '../../../../base/common/errors.js';\n\nexport class EditSessionsFileSystemProvider implements IFileSystemProviderWithFileReadWriteCapability {\n\n\tstatic readonly SCHEMA = EDIT_SESSIONS_SCHEME;\n\n\tconstructor(\n\t\t@IEditSessionsStorageService private editSessionsStorageService: IEditSessionsStorageService,\n\t) { }\n\n\treadonly capabilities: FileSystemProviderCapabilities = FileSystemProviderCapabilities.Readonly + FileSystemProviderCapabilities.FileReadWrite;\n\n\tasync readFile(resource: URI): Promise<Uint8Array> {\n\t\tconst match = /(?<ref>[^/]+)\\/(?<folderName>[^/]+)\\/(?<filePath>.*)/.exec(resource.path.substring(1));\n\t\tif (!match?.groups) {\n\t\t\tthrow FileSystemProviderErrorCode.FileNotFound;\n\t\t}\n\t\tconst { ref, folderName, filePath } = match.groups;\n\t\tconst data = await this.editSessionsStorageService.read('editSessions', ref);\n\t\tif (!data) {\n\t\t\tthrow FileSystemProviderErrorCode.FileNotFound;\n\t\t}\n\t\tconst content: EditSession = JSON.parse(data.content);\n\t\tconst change = content.folders.find((f) => f.name === folderName)?.workingChanges.find((change) => change.relativeFilePath === filePath);\n\t\tif (!change || change.type === ChangeType.Deletion) {\n\t\t\tthrow FileSystemProviderErrorCode.FileNotFound;\n\t\t}\n\t\treturn decodeEditSessionFileContent(content.version, change.contents).buffer;\n\t}\n\n\tasync stat(resource: URI): Promise<IStat> {\n\t\tconst content = await this.readFile(resource);\n\t\tconst currentTime = Date.now();\n\t\treturn {\n\t\t\ttype: FileType.File,\n\t\t\tpermissions: FilePermission.Readonly,\n\t\t\tmtime: currentTime,\n\t\t\tctime: currentTime,\n\t\t\tsize: content.byteLength\n\t\t};\n\t}\n\n\t//#region Unsupported file operations\n\treadonly onDidChangeCapabilities = Event.None;\n\treadonly onDidChangeFile = Event.None;\n\n\twatch(resource: URI, opts: IWatchOptions): IDisposable { return Disposable.None; }\n\n\tasync mkdir(resource: URI): Promise<void> { }\n\tasync readdir(resource: URI): Promise<[string, FileType][]> { return []; }\n\n\tasync rename(from: URI, to: URI, opts: IFileOverwriteOptions): Promise<void> { }\n\tasync delete(resource: URI, opts: IFileDeleteOptions): Promise<void> { }\n\n\tasync writeFile() {\n\t\tthrow new NotSupportedError();\n\t}\n\t//#endregion\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Disposable, IDisposable } from '../../../../base/common/lifecycle.js';\nimport { Event } from '../../../../base/common/event.js';\nimport { URI } from '../../../../base/common/uri.js';\nimport { FilePermission, FileSystemProviderCapabilities, FileSystemProviderErrorCode, FileType, IFileDeleteOptions, IFileOverwriteOptions, IFileSystemProviderWithFileReadWriteCapability, IStat, IWatchOptions } from '../../../../platform/files/common/files.js';\nimport { ChangeType, decodeEditSessionFileContent, EDIT_SESSIONS_SCHEME, EditSession, IEditSessionsStorageService } from '../common/editSessions.js';\nimport { NotSupportedError } from '../../../../base/common/errors.js';\n\nexport class EditSessionsFileSystemProvider implements IFileSystemProviderWithFileReadWriteCapability {\n\n\tstatic readonly SCHEMA = EDIT_SESSIONS_SCHEME;\n\n\tconstructor(\n\t\t@IEditSessionsStorageService private editSessionsStorageService: IEditSessionsStorageService,\n\t) { }\n\n\treadonly capabilities: FileSystemProviderCapabilities = FileSystemProviderCapabilities.Readonly + FileSystemProviderCapabilities.FileReadWrite;\n\n\tasync readFile(resource: URI): Promise<Uint8Array> {\n\t\tconst match = /(?<ref>[^/]+)\\/(?<folderName>[^/]+)\\/(?<filePath>.*)/.exec(resource.path.substring(1));\n\t\tif (!match?.groups) {\n\t\t\tthrow FileSystemProviderErrorCode.FileNotFound;\n\t\t}\n\t\tconst { ref, folderName, filePath } = match.groups;\n\t\tconst data = await this.editSessionsStorageService.read('editSessions', ref);\n\t\tif (!data) {\n\t\t\tthrow FileSystemProviderErrorCode.FileNotFound;\n\t\t}\n\t\tconst content: EditSession = JSON.parse(data.content);\n\t\tconst change = content.folders.find((f) => f.name === folderName)?.workingChanges.find((change) => change.relativeFilePath === filePath);\n\t\tif (!change || change.type === ChangeType.Deletion) {\n\t\t\tthrow FileSystemProviderErrorCode.FileNotFound;\n\t\t}\n\t\treturn decodeEditSessionFileContent(content.version, change.contents).buffer;\n\t}\n\n\tasync stat(resource: URI): Promise<IStat> {\n\t\tconst content = await this.readFile(resource);\n\t\tconst currentTime = Date.now();\n\t\treturn {\n\t\t\ttype: FileType.File,\n\t\t\tpermissions: FilePermission.Readonly,\n\t\t\tmtime: currentTime,\n\t\t\tctime: currentTime,\n\t\t\tsize: content.byteLength\n\t\t};\n\t}\n\n\t//#region Unsupported file operations\n\treadonly onDidChangeCapabilities = Event.None;\n\treadonly onDidChangeFile = Event.None;\n\n\twatch(resource: URI, opts: IWatchOptions): IDisposable { return Disposable.None; }\n\n\tasync mkdir(resource: URI): Promise<void> { }\n\tasync readdir(resource: URI): Promise<[string, FileType][]> { return []; }\n\n\tasync rename(from: URI, to: URI, opts: IFileOverwriteOptions): Promise<void> { }\n\tasync delete(resource: URI, opts: IFileDeleteOptions): Promise<void> { }\n\n\tasync writeFile() {\n\t\tthrow new NotSupportedError();\n\t}\n\t//#endregion\n}\n"]}