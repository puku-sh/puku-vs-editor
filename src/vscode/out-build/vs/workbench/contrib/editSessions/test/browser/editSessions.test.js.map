{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/contrib/editSessions/test/browser/editSessions.test.ts","vs/workbench/contrib/editSessions/test/browser/editSessions.test.ts"],"names":[],"mappings":"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","file":"editSessions.test.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { DisposableStore } from '../../../../../base/common/lifecycle.js';\nimport { IFileService } from '../../../../../platform/files/common/files.js';\nimport { FileService } from '../../../../../platform/files/common/fileService.js';\nimport { Schemas } from '../../../../../base/common/network.js';\nimport { InMemoryFileSystemProvider } from '../../../../../platform/files/common/inMemoryFilesystemProvider.js';\nimport { TestInstantiationService } from '../../../../../platform/instantiation/test/common/instantiationServiceMock.js';\nimport { NullLogService } from '../../../../../platform/log/common/log.js';\nimport { EditSessionsContribution } from '../../browser/editSessions.contribution.js';\nimport { ProgressService } from '../../../../services/progress/browser/progressService.js';\nimport { IProgressService } from '../../../../../platform/progress/common/progress.js';\nimport { ISCMService } from '../../../scm/common/scm.js';\nimport { SCMService } from '../../../scm/common/scmService.js';\nimport { TestConfigurationService } from '../../../../../platform/configuration/test/common/testConfigurationService.js';\nimport { IConfigurationService } from '../../../../../platform/configuration/common/configuration.js';\nimport { IWorkspaceContextService, WorkbenchState } from '../../../../../platform/workspace/common/workspace.js';\nimport { mock } from '../../../../../base/test/common/mock.js';\nimport * as sinon from 'sinon';\nimport assert from 'assert';\nimport { ChangeType, FileType, IEditSessionsLogService, IEditSessionsStorageService } from '../../common/editSessions.js';\nimport { URI } from '../../../../../base/common/uri.js';\nimport { joinPath } from '../../../../../base/common/resources.js';\nimport { INotificationService } from '../../../../../platform/notification/common/notification.js';\nimport { TestNotificationService } from '../../../../../platform/notification/test/common/testNotificationService.js';\nimport { TestEnvironmentService } from '../../../../test/browser/workbenchTestServices.js';\nimport { IEnvironmentService } from '../../../../../platform/environment/common/environment.js';\nimport { MockContextKeyService } from '../../../../../platform/keybinding/test/common/mockKeybindingService.js';\nimport { IContextKeyService } from '../../../../../platform/contextkey/common/contextkey.js';\nimport { IThemeService } from '../../../../../platform/theme/common/themeService.js';\nimport { Event } from '../../../../../base/common/event.js';\nimport { IViewDescriptorService } from '../../../../common/views.js';\nimport { ITextModelService } from '../../../../../editor/common/services/resolverService.js';\nimport { ILifecycleService } from '../../../../services/lifecycle/common/lifecycle.js';\nimport { IDialogService, IPrompt } from '../../../../../platform/dialogs/common/dialogs.js';\nimport { IEditorService, ISaveAllEditorsOptions } from '../../../../services/editor/common/editorService.js';\nimport { CancellationToken } from '../../../../../base/common/cancellation.js';\nimport { ITelemetryService } from '../../../../../platform/telemetry/common/telemetry.js';\nimport { NullTelemetryService } from '../../../../../platform/telemetry/common/telemetryUtils.js';\nimport { IRemoteAgentService } from '../../../../services/remote/common/remoteAgentService.js';\nimport { IExtensionService } from '../../../../services/extensions/common/extensions.js';\nimport { IEditSessionIdentityService } from '../../../../../platform/workspace/common/editSessions.js';\nimport { IUserDataProfilesService } from '../../../../../platform/userDataProfile/common/userDataProfile.js';\nimport { IProductService } from '../../../../../platform/product/common/productService.js';\nimport { IStorageService } from '../../../../../platform/storage/common/storage.js';\nimport { TestStorageService } from '../../../../test/common/workbenchTestServices.js';\nimport { IUriIdentityService } from '../../../../../platform/uriIdentity/common/uriIdentity.js';\nimport { UriIdentityService } from '../../../../../platform/uriIdentity/common/uriIdentityService.js';\nimport { IWorkspaceIdentityService, WorkspaceIdentityService } from '../../../../services/workspaces/common/workspaceIdentityService.js';\nimport { ensureNoDisposablesAreLeakedInTestSuite } from '../../../../../base/test/common/utils.js';\n\nconst folderName = 'test-folder';\nconst folderUri = URI.file(`/${folderName}`);\n\nsuite('Edit session sync', () => {\n\n\tlet instantiationService: TestInstantiationService;\n\tlet editSessionsContribution: EditSessionsContribution;\n\tlet fileService: FileService;\n\tlet sandbox: sinon.SinonSandbox;\n\n\tconst disposables = new DisposableStore();\n\n\tsuiteSetup(() => {\n\n\t\tsandbox = sinon.createSandbox();\n\n\t\tinstantiationService = new TestInstantiationService();\n\n\t\t// Set up filesystem\n\t\tconst logService = new NullLogService();\n\t\tfileService = disposables.add(new FileService(logService));\n\t\tconst fileSystemProvider = disposables.add(new InMemoryFileSystemProvider());\n\t\tfileService.registerProvider(Schemas.file, fileSystemProvider);\n\n\t\t// Stub out all services\n\t\tinstantiationService.stub(IEditSessionsLogService, logService);\n\t\tinstantiationService.stub(IFileService, fileService);\n\t\tinstantiationService.stub(ILifecycleService, new class extends mock<ILifecycleService>() {\n\t\t\toverride onWillShutdown = Event.None;\n\t\t});\n\t\tinstantiationService.stub(INotificationService, new TestNotificationService());\n\t\tinstantiationService.stub(IProductService, { 'editSessions.store': { url: 'https://test.com', canSwitch: true, authenticationProviders: {} } });\n\t\tinstantiationService.stub(IStorageService, new TestStorageService());\n\t\tinstantiationService.stub(IUriIdentityService, new UriIdentityService(fileService));\n\t\tinstantiationService.stub(IEditSessionsStorageService, new class extends mock<IEditSessionsStorageService>() {\n\t\t\toverride onDidSignIn = Event.None;\n\t\t\toverride onDidSignOut = Event.None;\n\t\t});\n\t\tinstantiationService.stub(IExtensionService, new class extends mock<IExtensionService>() {\n\t\t\toverride onDidChangeExtensions = Event.None;\n\t\t});\n\t\tinstantiationService.stub(IProgressService, ProgressService);\n\t\tinstantiationService.stub(ISCMService, SCMService);\n\t\tinstantiationService.stub(IEnvironmentService, TestEnvironmentService);\n\t\tinstantiationService.stub(ITelemetryService, NullTelemetryService);\n\t\tinstantiationService.stub(IDialogService, new class extends mock<IDialogService>() {\n\t\t\toverride async prompt(prompt: IPrompt<any>) {\n\t\t\t\tconst result = prompt.buttons?.[0].run({ checkboxChecked: false });\n\t\t\t\treturn { result };\n\t\t\t}\n\t\t\toverride async confirm() {\n\t\t\t\treturn { confirmed: false };\n\t\t\t}\n\t\t});\n\t\tinstantiationService.stub(IRemoteAgentService, new class extends mock<IRemoteAgentService>() {\n\t\t\toverride async getEnvironment() {\n\t\t\t\treturn null;\n\t\t\t}\n\t\t});\n\t\tinstantiationService.stub(IConfigurationService, new TestConfigurationService({ workbench: { experimental: { editSessions: { enabled: true } } } }));\n\t\tinstantiationService.stub(IWorkspaceContextService, new class extends mock<IWorkspaceContextService>() {\n\t\t\toverride getWorkspace() {\n\t\t\t\treturn {\n\t\t\t\t\tid: 'workspace-id',\n\t\t\t\t\tfolders: [{\n\t\t\t\t\t\turi: folderUri,\n\t\t\t\t\t\tname: folderName,\n\t\t\t\t\t\tindex: 0,\n\t\t\t\t\t\ttoResource: (relativePath: string) => joinPath(folderUri, relativePath)\n\t\t\t\t\t}]\n\t\t\t\t};\n\t\t\t}\n\t\t\toverride getWorkbenchState() {\n\t\t\t\treturn WorkbenchState.FOLDER;\n\t\t\t}\n\t\t});\n\n\t\t// Stub repositories\n\t\tinstantiationService.stub(ISCMService, '_repositories', new Map());\n\t\tinstantiationService.stub(IContextKeyService, new MockContextKeyService());\n\t\tinstantiationService.stub(IThemeService, new class extends mock<IThemeService>() {\n\t\t\toverride onDidColorThemeChange = Event.None;\n\t\t\toverride onDidFileIconThemeChange = Event.None;\n\t\t});\n\t\tinstantiationService.stub(IViewDescriptorService, {\n\t\t\tonDidChangeLocation: Event.None\n\t\t});\n\t\tinstantiationService.stub(ITextModelService, new class extends mock<ITextModelService>() {\n\t\t\toverride registerTextModelContentProvider = () => ({ dispose: () => { } });\n\t\t});\n\t\tinstantiationService.stub(IEditorService, new class extends mock<IEditorService>() {\n\t\t\toverride saveAll = async (_options: ISaveAllEditorsOptions) => { return { success: true, editors: [] }; };\n\t\t});\n\t\tinstantiationService.stub(IEditSessionIdentityService, new class extends mock<IEditSessionIdentityService>() {\n\t\t\toverride async getEditSessionIdentifier() {\n\t\t\t\treturn 'test-identity';\n\t\t\t}\n\t\t});\n\t\tinstantiationService.set(IWorkspaceIdentityService, instantiationService.createInstance(WorkspaceIdentityService));\n\t\tinstantiationService.stub(IUserDataProfilesService, new class extends mock<IUserDataProfilesService>() {\n\t\t\toverride defaultProfile = {\n\t\t\t\tid: 'default',\n\t\t\t\tname: 'Default',\n\t\t\t\tisDefault: true,\n\t\t\t\tlocation: URI.file('location'),\n\t\t\t\tglobalStorageHome: URI.file('globalStorageHome'),\n\t\t\t\tsettingsResource: URI.file('settingsResource'),\n\t\t\t\tkeybindingsResource: URI.file('keybindingsResource'),\n\t\t\t\ttasksResource: URI.file('tasksResource'),\n\t\t\t\tmcpResource: URI.file('mcp.json'),\n\t\t\t\tsnippetsHome: URI.file('snippetsHome'),\n\t\t\t\tpromptsHome: URI.file('promptsHome'),\n\t\t\t\textensionsResource: URI.file('extensionsResource'),\n\t\t\t\tcacheHome: URI.file('cacheHome'),\n\t\t\t};\n\t\t});\n\n\t\teditSessionsContribution = instantiationService.createInstance(EditSessionsContribution);\n\t});\n\n\tteardown(() => {\n\t\tsinon.restore();\n\t\tdisposables.clear();\n\t});\n\n\tsuiteTeardown(() => {\n\t\tdisposables.dispose();\n\t});\n\n\ttest('Can apply edit session', async function () {\n\t\tconst fileUri = joinPath(folderUri, 'dir1', 'README.md');\n\t\tconst fileContents = '# readme';\n\t\tconst editSession = {\n\t\t\tversion: 1,\n\t\t\tfolders: [\n\t\t\t\t{\n\t\t\t\t\tname: folderName,\n\t\t\t\t\tworkingChanges: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\trelativeFilePath: 'dir1/README.md',\n\t\t\t\t\t\t\tfileType: FileType.File,\n\t\t\t\t\t\t\tcontents: fileContents,\n\t\t\t\t\t\t\ttype: ChangeType.Addition\n\t\t\t\t\t\t}\n\t\t\t\t\t]\n\t\t\t\t}\n\t\t\t]\n\t\t};\n\n\t\t// Stub sync service to return edit session data\n\t\tconst readStub = sandbox.stub().returns({ content: JSON.stringify(editSession), ref: '0' });\n\t\tinstantiationService.stub(IEditSessionsStorageService, 'read', readStub);\n\n\t\t// Create root folder\n\t\tawait fileService.createFolder(folderUri);\n\n\t\t// Resume edit session\n\t\tawait editSessionsContribution.resumeEditSession();\n\n\t\t// Verify edit session was correctly applied\n\t\tassert.equal((await fileService.readFile(fileUri)).value.toString(), fileContents);\n\t});\n\n\ttest('Edit session not stored if there are no edits', async function () {\n\t\tconst writeStub = sandbox.stub();\n\t\tinstantiationService.stub(IEditSessionsStorageService, 'write', writeStub);\n\n\t\t// Create root folder\n\t\tawait fileService.createFolder(folderUri);\n\n\t\tawait editSessionsContribution.storeEditSession(true, CancellationToken.None);\n\n\t\t// Verify that we did not attempt to write the edit session\n\t\tassert.equal(writeStub.called, false);\n\t});\n\n\tensureNoDisposablesAreLeakedInTestSuite();\n});\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { DisposableStore } from '../../../../../base/common/lifecycle.js';\nimport { IFileService } from '../../../../../platform/files/common/files.js';\nimport { FileService } from '../../../../../platform/files/common/fileService.js';\nimport { Schemas } from '../../../../../base/common/network.js';\nimport { InMemoryFileSystemProvider } from '../../../../../platform/files/common/inMemoryFilesystemProvider.js';\nimport { TestInstantiationService } from '../../../../../platform/instantiation/test/common/instantiationServiceMock.js';\nimport { NullLogService } from '../../../../../platform/log/common/log.js';\nimport { EditSessionsContribution } from '../../browser/editSessions.contribution.js';\nimport { ProgressService } from '../../../../services/progress/browser/progressService.js';\nimport { IProgressService } from '../../../../../platform/progress/common/progress.js';\nimport { ISCMService } from '../../../scm/common/scm.js';\nimport { SCMService } from '../../../scm/common/scmService.js';\nimport { TestConfigurationService } from '../../../../../platform/configuration/test/common/testConfigurationService.js';\nimport { IConfigurationService } from '../../../../../platform/configuration/common/configuration.js';\nimport { IWorkspaceContextService, WorkbenchState } from '../../../../../platform/workspace/common/workspace.js';\nimport { mock } from '../../../../../base/test/common/mock.js';\nimport * as sinon from 'sinon';\nimport assert from 'assert';\nimport { ChangeType, FileType, IEditSessionsLogService, IEditSessionsStorageService } from '../../common/editSessions.js';\nimport { URI } from '../../../../../base/common/uri.js';\nimport { joinPath } from '../../../../../base/common/resources.js';\nimport { INotificationService } from '../../../../../platform/notification/common/notification.js';\nimport { TestNotificationService } from '../../../../../platform/notification/test/common/testNotificationService.js';\nimport { TestEnvironmentService } from '../../../../test/browser/workbenchTestServices.js';\nimport { IEnvironmentService } from '../../../../../platform/environment/common/environment.js';\nimport { MockContextKeyService } from '../../../../../platform/keybinding/test/common/mockKeybindingService.js';\nimport { IContextKeyService } from '../../../../../platform/contextkey/common/contextkey.js';\nimport { IThemeService } from '../../../../../platform/theme/common/themeService.js';\nimport { Event } from '../../../../../base/common/event.js';\nimport { IViewDescriptorService } from '../../../../common/views.js';\nimport { ITextModelService } from '../../../../../editor/common/services/resolverService.js';\nimport { ILifecycleService } from '../../../../services/lifecycle/common/lifecycle.js';\nimport { IDialogService, IPrompt } from '../../../../../platform/dialogs/common/dialogs.js';\nimport { IEditorService, ISaveAllEditorsOptions } from '../../../../services/editor/common/editorService.js';\nimport { CancellationToken } from '../../../../../base/common/cancellation.js';\nimport { ITelemetryService } from '../../../../../platform/telemetry/common/telemetry.js';\nimport { NullTelemetryService } from '../../../../../platform/telemetry/common/telemetryUtils.js';\nimport { IRemoteAgentService } from '../../../../services/remote/common/remoteAgentService.js';\nimport { IExtensionService } from '../../../../services/extensions/common/extensions.js';\nimport { IEditSessionIdentityService } from '../../../../../platform/workspace/common/editSessions.js';\nimport { IUserDataProfilesService } from '../../../../../platform/userDataProfile/common/userDataProfile.js';\nimport { IProductService } from '../../../../../platform/product/common/productService.js';\nimport { IStorageService } from '../../../../../platform/storage/common/storage.js';\nimport { TestStorageService } from '../../../../test/common/workbenchTestServices.js';\nimport { IUriIdentityService } from '../../../../../platform/uriIdentity/common/uriIdentity.js';\nimport { UriIdentityService } from '../../../../../platform/uriIdentity/common/uriIdentityService.js';\nimport { IWorkspaceIdentityService, WorkspaceIdentityService } from '../../../../services/workspaces/common/workspaceIdentityService.js';\nimport { ensureNoDisposablesAreLeakedInTestSuite } from '../../../../../base/test/common/utils.js';\n\nconst folderName = 'test-folder';\nconst folderUri = URI.file(`/${folderName}`);\n\nsuite('Edit session sync', () => {\n\n\tlet instantiationService: TestInstantiationService;\n\tlet editSessionsContribution: EditSessionsContribution;\n\tlet fileService: FileService;\n\tlet sandbox: sinon.SinonSandbox;\n\n\tconst disposables = new DisposableStore();\n\n\tsuiteSetup(() => {\n\n\t\tsandbox = sinon.createSandbox();\n\n\t\tinstantiationService = new TestInstantiationService();\n\n\t\t// Set up filesystem\n\t\tconst logService = new NullLogService();\n\t\tfileService = disposables.add(new FileService(logService));\n\t\tconst fileSystemProvider = disposables.add(new InMemoryFileSystemProvider());\n\t\tfileService.registerProvider(Schemas.file, fileSystemProvider);\n\n\t\t// Stub out all services\n\t\tinstantiationService.stub(IEditSessionsLogService, logService);\n\t\tinstantiationService.stub(IFileService, fileService);\n\t\tinstantiationService.stub(ILifecycleService, new class extends mock<ILifecycleService>() {\n\t\t\toverride onWillShutdown = Event.None;\n\t\t});\n\t\tinstantiationService.stub(INotificationService, new TestNotificationService());\n\t\tinstantiationService.stub(IProductService, { 'editSessions.store': { url: 'https://test.com', canSwitch: true, authenticationProviders: {} } });\n\t\tinstantiationService.stub(IStorageService, new TestStorageService());\n\t\tinstantiationService.stub(IUriIdentityService, new UriIdentityService(fileService));\n\t\tinstantiationService.stub(IEditSessionsStorageService, new class extends mock<IEditSessionsStorageService>() {\n\t\t\toverride onDidSignIn = Event.None;\n\t\t\toverride onDidSignOut = Event.None;\n\t\t});\n\t\tinstantiationService.stub(IExtensionService, new class extends mock<IExtensionService>() {\n\t\t\toverride onDidChangeExtensions = Event.None;\n\t\t});\n\t\tinstantiationService.stub(IProgressService, ProgressService);\n\t\tinstantiationService.stub(ISCMService, SCMService);\n\t\tinstantiationService.stub(IEnvironmentService, TestEnvironmentService);\n\t\tinstantiationService.stub(ITelemetryService, NullTelemetryService);\n\t\tinstantiationService.stub(IDialogService, new class extends mock<IDialogService>() {\n\t\t\toverride async prompt(prompt: IPrompt<any>) {\n\t\t\t\tconst result = prompt.buttons?.[0].run({ checkboxChecked: false });\n\t\t\t\treturn { result };\n\t\t\t}\n\t\t\toverride async confirm() {\n\t\t\t\treturn { confirmed: false };\n\t\t\t}\n\t\t});\n\t\tinstantiationService.stub(IRemoteAgentService, new class extends mock<IRemoteAgentService>() {\n\t\t\toverride async getEnvironment() {\n\t\t\t\treturn null;\n\t\t\t}\n\t\t});\n\t\tinstantiationService.stub(IConfigurationService, new TestConfigurationService({ workbench: { experimental: { editSessions: { enabled: true } } } }));\n\t\tinstantiationService.stub(IWorkspaceContextService, new class extends mock<IWorkspaceContextService>() {\n\t\t\toverride getWorkspace() {\n\t\t\t\treturn {\n\t\t\t\t\tid: 'workspace-id',\n\t\t\t\t\tfolders: [{\n\t\t\t\t\t\turi: folderUri,\n\t\t\t\t\t\tname: folderName,\n\t\t\t\t\t\tindex: 0,\n\t\t\t\t\t\ttoResource: (relativePath: string) => joinPath(folderUri, relativePath)\n\t\t\t\t\t}]\n\t\t\t\t};\n\t\t\t}\n\t\t\toverride getWorkbenchState() {\n\t\t\t\treturn WorkbenchState.FOLDER;\n\t\t\t}\n\t\t});\n\n\t\t// Stub repositories\n\t\tinstantiationService.stub(ISCMService, '_repositories', new Map());\n\t\tinstantiationService.stub(IContextKeyService, new MockContextKeyService());\n\t\tinstantiationService.stub(IThemeService, new class extends mock<IThemeService>() {\n\t\t\toverride onDidColorThemeChange = Event.None;\n\t\t\toverride onDidFileIconThemeChange = Event.None;\n\t\t});\n\t\tinstantiationService.stub(IViewDescriptorService, {\n\t\t\tonDidChangeLocation: Event.None\n\t\t});\n\t\tinstantiationService.stub(ITextModelService, new class extends mock<ITextModelService>() {\n\t\t\toverride registerTextModelContentProvider = () => ({ dispose: () => { } });\n\t\t});\n\t\tinstantiationService.stub(IEditorService, new class extends mock<IEditorService>() {\n\t\t\toverride saveAll = async (_options: ISaveAllEditorsOptions) => { return { success: true, editors: [] }; };\n\t\t});\n\t\tinstantiationService.stub(IEditSessionIdentityService, new class extends mock<IEditSessionIdentityService>() {\n\t\t\toverride async getEditSessionIdentifier() {\n\t\t\t\treturn 'test-identity';\n\t\t\t}\n\t\t});\n\t\tinstantiationService.set(IWorkspaceIdentityService, instantiationService.createInstance(WorkspaceIdentityService));\n\t\tinstantiationService.stub(IUserDataProfilesService, new class extends mock<IUserDataProfilesService>() {\n\t\t\toverride defaultProfile = {\n\t\t\t\tid: 'default',\n\t\t\t\tname: 'Default',\n\t\t\t\tisDefault: true,\n\t\t\t\tlocation: URI.file('location'),\n\t\t\t\tglobalStorageHome: URI.file('globalStorageHome'),\n\t\t\t\tsettingsResource: URI.file('settingsResource'),\n\t\t\t\tkeybindingsResource: URI.file('keybindingsResource'),\n\t\t\t\ttasksResource: URI.file('tasksResource'),\n\t\t\t\tmcpResource: URI.file('mcp.json'),\n\t\t\t\tsnippetsHome: URI.file('snippetsHome'),\n\t\t\t\tpromptsHome: URI.file('promptsHome'),\n\t\t\t\textensionsResource: URI.file('extensionsResource'),\n\t\t\t\tcacheHome: URI.file('cacheHome'),\n\t\t\t};\n\t\t});\n\n\t\teditSessionsContribution = instantiationService.createInstance(EditSessionsContribution);\n\t});\n\n\tteardown(() => {\n\t\tsinon.restore();\n\t\tdisposables.clear();\n\t});\n\n\tsuiteTeardown(() => {\n\t\tdisposables.dispose();\n\t});\n\n\ttest('Can apply edit session', async function () {\n\t\tconst fileUri = joinPath(folderUri, 'dir1', 'README.md');\n\t\tconst fileContents = '# readme';\n\t\tconst editSession = {\n\t\t\tversion: 1,\n\t\t\tfolders: [\n\t\t\t\t{\n\t\t\t\t\tname: folderName,\n\t\t\t\t\tworkingChanges: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\trelativeFilePath: 'dir1/README.md',\n\t\t\t\t\t\t\tfileType: FileType.File,\n\t\t\t\t\t\t\tcontents: fileContents,\n\t\t\t\t\t\t\ttype: ChangeType.Addition\n\t\t\t\t\t\t}\n\t\t\t\t\t]\n\t\t\t\t}\n\t\t\t]\n\t\t};\n\n\t\t// Stub sync service to return edit session data\n\t\tconst readStub = sandbox.stub().returns({ content: JSON.stringify(editSession), ref: '0' });\n\t\tinstantiationService.stub(IEditSessionsStorageService, 'read', readStub);\n\n\t\t// Create root folder\n\t\tawait fileService.createFolder(folderUri);\n\n\t\t// Resume edit session\n\t\tawait editSessionsContribution.resumeEditSession();\n\n\t\t// Verify edit session was correctly applied\n\t\tassert.equal((await fileService.readFile(fileUri)).value.toString(), fileContents);\n\t});\n\n\ttest('Edit session not stored if there are no edits', async function () {\n\t\tconst writeStub = sandbox.stub();\n\t\tinstantiationService.stub(IEditSessionsStorageService, 'write', writeStub);\n\n\t\t// Create root folder\n\t\tawait fileService.createFolder(folderUri);\n\n\t\tawait editSessionsContribution.storeEditSession(true, CancellationToken.None);\n\n\t\t// Verify that we did not attempt to write the edit session\n\t\tassert.equal(writeStub.called, false);\n\t});\n\n\tensureNoDisposablesAreLeakedInTestSuite();\n});\n"]}