{"version":3,"sources":["vs/workbench/contrib/scm/browser/scmHistoryChatContext.ts"],"names":[],"mappings":"AAAA;;;gGAGgG;;;;;;;;;;;AAEhG,OAAO,EAAE,QAAQ,EAAE,MAAM,mCAAmC,CAAC;AAC7D,OAAO,EAAE,gBAAgB,EAAE,MAAM,kCAAkC,CAAC;AAEpE,OAAO,EAAE,OAAO,EAAE,MAAM,qCAAqC,CAAC;AAC9D,OAAO,EAAE,OAAO,EAAE,MAAM,iCAAiC,CAAC;AAC1D,OAAO,EAAE,UAAU,EAAE,MAAM,sCAAsC,CAAC;AAClE,OAAO,EAAE,QAAQ,EAAE,MAAM,sCAAsC,CAAC;AAChE,OAAO,EAAE,SAAS,EAAE,MAAM,sCAAsC,CAAC;AAGjE,OAAO,EAAE,aAAa,EAAE,MAAM,6CAA6C,CAAC;AAC5E,OAAO,EAA6B,iBAAiB,EAAE,MAAM,uDAAuD,CAAC;AACrH,OAAO,EAAE,QAAQ,EAAE,MAAM,oBAAoB,CAAC;AAC9C,OAAO,EAAE,OAAO,EAAE,MAAM,EAAE,eAAe,EAAE,MAAM,gDAAgD,CAAC;AAClG,OAAO,EAAE,iBAAiB,EAAE,MAAM,yCAAyC,CAAC;AAC5E,OAAO,EAAE,qBAAqB,EAAoB,MAAM,4DAA4D,CAAC;AAErH,OAAO,EAAe,kBAAkB,EAAE,MAAM,4BAA4B,CAAC;AAC7E,OAAO,EAAsD,uBAAuB,EAAE,kBAAkB,EAAE,MAAM,8CAA8C,CAAC;AAC/J,OAAO,EAAE,eAAe,EAAE,MAAM,sCAAsC,CAAC;AAEvE,OAAO,EAAE,sBAAsB,EAAE,MAAM,6DAA6D,CAAC;AAErG,OAAO,EAAgB,WAAW,EAAE,eAAe,EAAE,MAAM,kBAAkB,CAAC;AAQ9E,MAAM,UAAU,6BAA6B,CAAC,CAAY;IACzD,IAAI,CAAC,CAAC,CAAC,YAAY,EAAE,KAAK,CAAC,QAAQ,CAAC,iBAAiB,CAAC,gBAAgB,CAAC,EAAE,CAAC;QACzE,OAAO,SAAS,CAAC;IAClB,CAAC;IAED,MAAM,IAAI,GAAG,CAAC,CAAC,YAAY,EAAE,OAAO,CAAC,iBAAiB,CAAC,gBAAgB,CAAC,CAAC;IACzE,IAAI,CAAC,IAAI,EAAE,CAAC;QACX,OAAO,SAAS,CAAC;IAClB,CAAC;IAED,OAAO,IAAI,CAAC,KAAK,CAAC,IAAI,CAAiC,CAAC;AACzD,CAAC;AAEM,IAAM,iCAAiC,GAAvC,MAAM,iCAAkC,SAAQ,UAAU;aAEhD,OAAE,GAAG,0DAAH,AAA6D,CAAC;IAEhF,YAC0B,kBAA2C,EAC7C,oBAA2C,EAC/C,wBAA2C;QAE9D,KAAK,EAAE,CAAC;QACR,IAAI,CAAC,MAAM,CAAC,GAAG,CAAC,kBAAkB,CAAC,uBAAuB,CACzD,oBAAoB,CAAC,cAAc,CAAC,qBAAqB,CAAC,CAAC,CAAC,CAAC;QAE9D,IAAI,CAAC,MAAM,CAAC,GAAG,CAAC,wBAAwB,CAAC,gCAAgC,CACxE,sBAAsB,CAAC,MAAM,EAC7B,oBAAoB,CAAC,cAAc,CAAC,oCAAoC,CAAC,CAAC,CAAC,CAAC;QAE7E,IAAI,CAAC,MAAM,CAAC,GAAG,CAAC,wBAAwB,CAAC,gCAAgC,CACxE,wCAAwC,CAAC,MAAM,EAC/C,oBAAoB,CAAC,cAAc,CAAC,wCAAwC,CAAC,CAAC,CAAC,CAAC;IAClF,CAAC;;AApBW,iCAAiC;IAK3C,WAAA,uBAAuB,CAAA;IACvB,WAAA,qBAAqB,CAAA;IACrB,WAAA,iBAAiB,CAAA;GAPP,iCAAiC,CAqB7C;;AAED,IAAM,qBAAqB,6BAA3B,MAAM,qBAAqB;IAOnB,MAAM,CAAC,YAAY,CAAC,QAAsB,EAAE,WAA4B;QAC9E,MAAM,mBAAmB,GAAG,WAAW,CAAC,SAAS,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC,CAAC,WAAW,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,SAAS,CAAC;QACpG,MAAM,kBAAkB,GAAG,sBAAsB,CAAC,qBAAqB,CAAC,QAAQ,EAAE,WAAW,CAAC,EAAE,EAAE,mBAAmB,EAAE,WAAW,CAAC,SAAS,CAAC,CAAC;QAC9I,MAAM,cAAc,GAAG,KAAK,OAAO,CAAC,IAAI,CAAC,EAAE,UAAU,QAAQ,CAAC,IAAI,WAAW,OAAO,CAAC,SAAS,CAAC,EAAE,UAAU,WAAW,CAAC,SAAS,IAAI,WAAW,CAAC,EAAE,EAAE,CAAC;QAErJ,OAAO;YACN,EAAE,EAAE,WAAW,CAAC,EAAE;YAClB,IAAI,EAAE,cAAc;YACpB,KAAK,EAAE,kBAAkB;YACzB,WAAW,EAAE;gBACZ,GAAG,WAAW;gBACd,UAAU,EAAE,EAAE;aACd;YACD,IAAI,EAAE,gBAAgB;SACiB,CAAC;IAC1C,CAAC;IAED,YACkB,eAAiD;QAAhC,oBAAe,GAAf,eAAe,CAAiB;QAxB1D,SAAI,GAAG,YAAY,CAAC;QACpB,UAAK,GAAG,QAAQ,CAAC,KAA6B,EAAE,IAAmB,CAAC,CAAC;QACrE,SAAI,GAAG,OAAO,CAAC,SAAS,CAAC;QAEjB,aAAQ,GAAG,IAAI,gBAAgB,CAA+B,GAAG,CAAC,CAAC;IAqBhF,CAAC;IAEL,SAAS,CAAC,MAAmB;QAC5B,MAAM,gBAAgB,GAAG,IAAI,CAAC,eAAe,CAAC,gBAAgB,CAAC,GAAG,EAAE,CAAC;QACrE,MAAM,SAAS,GAAG,CAAC,CAAC,MAAM,CAAC,sBAAsB,CAAC,gCAAgC,CAAC;QACnF,OAAO,gBAAgB,EAAE,UAAU,CAAC,QAAQ,CAAC,eAAe,CAAC,GAAG,EAAE,KAAK,SAAS,IAAI,SAAS,CAAC;IAC/F,CAAC;IAED,QAAQ,CAAC,OAAoB;QAC5B,OAAO;YACN,WAAW,EAAE,QAAQ,CAAC,KAAyC,EAAE,IAAiB,CAAC;YACnF,KAAK,EAAE,kBAAkB,CAAC,CAAC,KAAa,EAAE,KAAwB,EAAE,EAAE;gBACrE,MAAM,UAAU,GAAG,KAAK,CAAC,IAAI,EAAE,KAAK,EAAE,CAAC,CAAC,CAAC,KAAK,CAAC,IAAI,EAAE,CAAC,CAAC,CAAC,SAAS,CAAC;gBAClE,MAAM,gBAAgB,GAAG,IAAI,CAAC,eAAe,CAAC,gBAAgB,CAAC,GAAG,EAAE,CAAC;gBACrE,MAAM,eAAe,GAAG,gBAAgB,EAAE,UAAU,CAAC,QAAQ,CAAC,eAAe,CAAC,GAAG,EAAE,CAAC;gBACpF,IAAI,CAAC,gBAAgB,IAAI,CAAC,eAAe,EAAE,CAAC;oBAC3C,OAAO,OAAO,CAAC,OAAO,CAAC,EAAE,CAAC,CAAC;gBAC5B,CAAC;gBAED,MAAM,eAAe,GAAG,QAAQ,CAAC;oBAChC,eAAe,CAAC,cAAc,CAAC,GAAG,EAAE;oBACpC,eAAe,CAAC,oBAAoB,CAAC,GAAG,EAAE;oBAC1C,eAAe,CAAC,kBAAkB,CAAC,GAAG,EAAE;iBACxC,CAAC,CAAC,GAAG,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,CAAC,EAAE,CAAC,CAAC;gBAEtB,OAAO,IAAI,CAAC,QAAQ,CAAC,OAAO,CAAC,GAAG,EAAE;oBACjC,OAAO,eAAe,CAAC,mBAAmB,CAAC,EAAE,eAAe,EAAE,UAAU,EAAE,KAAK,EAAE,GAAG,EAAE,EAAE,KAAK,CAAC;yBAC5F,IAAI,CAAC,YAAY,CAAC,EAAE;wBACpB,IAAI,CAAC,YAAY,EAAE,CAAC;4BACnB,OAAO,EAAE,CAAC;wBACX,CAAC;wBAED,OAAO,YAAY,CAAC,GAAG,CAAC,WAAW,CAAC,EAAE;4BACrC,MAAM,OAAO,GAAG,CAAC,GAAG,WAAW,CAAC,SAAS,IAAI,WAAW,CAAC,EAAE,EAAE,CAAC,CAAC;4BAC/D,IAAI,WAAW,CAAC,MAAM,EAAE,CAAC;gCACxB,OAAO,CAAC,IAAI,CAAC,WAAW,CAAC,MAAM,CAAC,CAAC;4BAClC,CAAC;4BACD,IAAI,WAAW,CAAC,UAAU,EAAE,CAAC;gCAC5B,OAAO,CAAC,IAAI,CAAC,GAAG,WAAW,CAAC,UAAU,CAAC,KAAK,IAAI,QAAQ,CAAC,KAAO,EAAE,IAAS,CAAC,EAAE,CAAC,CAAC;4BACjF,CAAC;4BACD,IAAI,WAAW,CAAC,SAAS,EAAE,CAAC;gCAC3B,OAAO,CAAC,IAAI,CAAC,OAAO,CAAC,WAAW,CAAC,SAAS,EAAE,IAAI,EAAE,IAAI,CAAC,CAAC,CAAC;4BAC1D,CAAC;4BAED,OAAO;gCACN,SAAS,EAAE,SAAS,CAAC,WAAW,CAAC,OAAO,CAAC,SAAS,CAAC;gCACnD,KAAK,EAAE,WAAW,CAAC,OAAO;gCAC1B,MAAM,EAAE,OAAO,CAAC,IAAI,CAAC,KAAK,OAAO,CAAC,iBAAiB,CAAC,EAAE,GAAG,CAAC;gCAC1D,YAAY,EAAE,GAAG,EAAE,CAAC,uBAAqB,CAAC,YAAY,CAAC,gBAAgB,CAAC,UAAU,CAAC,QAAQ,EAAE,WAAW,CAAC;6BACpE,CAAC;wBACxC,CAAC,CAAC,CAAC;oBACJ,CAAC,CAAC,CAAC;gBACL,CAAC,CAAC,CAAC;YACJ,CAAC,CAAC;SACF,CAAC;IACH,CAAC;CACD,CAAA;AAlFK,qBAAqB;IAyBxB,WAAA,eAAe,CAAA;GAzBZ,qBAAqB,CAkF1B;AAED,IAAM,oCAAoC,GAA1C,MAAM,oCAAoC;IACzC,YACiC,aAA4B,EAC9B,WAAwB;QADtB,kBAAa,GAAb,aAAa,CAAe;QAC9B,gBAAW,GAAX,WAAW,CAAa;IACnD,CAAC;IAEL,KAAK,CAAC,kBAAkB,CAAC,QAAa;QACrC,MAAM,SAAS,GAAG,sBAAsB,CAAC,QAAQ,CAAC,QAAQ,CAAC,CAAC;QAC5D,IAAI,CAAC,SAAS,EAAE,CAAC;YAChB,OAAO,IAAI,CAAC;QACb,CAAC;QAED,MAAM,SAAS,GAAG,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAC,QAAQ,CAAC,CAAC;QACxD,IAAI,SAAS,EAAE,CAAC;YACf,OAAO,SAAS,CAAC;QAClB,CAAC;QAED,MAAM,EAAE,YAAY,EAAE,aAAa,EAAE,GAAG,SAAS,CAAC;QAClD,MAAM,UAAU,GAAG,IAAI,CAAC,WAAW,CAAC,aAAa,CAAC,YAAY,CAAC,CAAC;QAChE,MAAM,eAAe,GAAG,UAAU,EAAE,QAAQ,CAAC,eAAe,CAAC,GAAG,EAAE,CAAC;QACnE,IAAI,CAAC,UAAU,IAAI,CAAC,eAAe,EAAE,CAAC;YACrC,OAAO,IAAI,CAAC;QACb,CAAC;QAED,MAAM,kBAAkB,GAAG,MAAM,eAAe,CAAC,6BAA6B,CAAC,aAAa,CAAC,CAAC;QAC9F,IAAI,CAAC,kBAAkB,EAAE,CAAC;YACzB,OAAO,IAAI,CAAC;QACb,CAAC;QAED,OAAO,IAAI,CAAC,aAAa,CAAC,WAAW,CAAC,kBAAkB,EAAE,IAAI,EAAE,QAAQ,EAAE,KAAK,CAAC,CAAC;IAClF,CAAC;CACD,CAAA;AA/BK,oCAAoC;IAEvC,WAAA,aAAa,CAAA;IACb,WAAA,WAAW,CAAA;GAHR,oCAAoC,CA+BzC;AAQM,IAAM,wCAAwC,GAA9C,MAAM,wCAAwC;;aACpC,WAAM,GAAG,+BAAH,AAAkC,CAAC;IACzD,YACiC,aAA4B,EAC9B,WAAwB;QADtB,kBAAa,GAAb,aAAa,CAAe;QAC9B,gBAAW,GAAX,WAAW,CAAa;IACnD,CAAC;IAEL,KAAK,CAAC,kBAAkB,CAAC,QAAa;QACrC,MAAM,SAAS,GAAG,IAAI,CAAC,SAAS,CAAC,QAAQ,CAAC,CAAC;QAC3C,IAAI,CAAC,SAAS,EAAE,CAAC;YAChB,OAAO,IAAI,CAAC;QACb,CAAC;QAED,MAAM,SAAS,GAAG,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAC,QAAQ,CAAC,CAAC;QACxD,IAAI,SAAS,EAAE,CAAC;YACf,OAAO,SAAS,CAAC;QAClB,CAAC;QAED,MAAM,EAAE,YAAY,EAAE,KAAK,EAAE,GAAG,EAAE,GAAG,SAAS,CAAC;QAC/C,MAAM,UAAU,GAAG,IAAI,CAAC,WAAW,CAAC,aAAa,CAAC,YAAY,CAAC,CAAC;QAChE,MAAM,eAAe,GAAG,UAAU,EAAE,QAAQ,CAAC,eAAe,CAAC,GAAG,EAAE,CAAC;QACnE,IAAI,CAAC,UAAU,IAAI,CAAC,eAAe,EAAE,CAAC;YACrC,OAAO,IAAI,CAAC;QACb,CAAC;QAED,MAAM,6BAA6B,GAAG,MAAM,eAAe,CAAC,wCAAwC,CAAC,GAAG,EAAE,KAAK,EAAE,QAAQ,CAAC,IAAI,CAAC,CAAC;QAChI,IAAI,CAAC,6BAA6B,EAAE,CAAC;YACpC,OAAO,IAAI,CAAC;QACb,CAAC;QAED,OAAO,IAAI,CAAC,aAAa,CAAC,WAAW,CAAC,6BAA6B,EAAE,IAAI,EAAE,QAAQ,EAAE,KAAK,CAAC,CAAC;IAC7F,CAAC;IAEO,SAAS,CAAC,GAAQ;QACzB,IAAI,GAAG,CAAC,MAAM,KAAK,0CAAwC,CAAC,MAAM,EAAE,CAAC;YACpE,OAAO,SAAS,CAAC;QAClB,CAAC;QAED,IAAI,KAAyC,CAAC;QAC9C,IAAI,CAAC;YACJ,KAAK,GAAG,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,KAAK,CAAuC,CAAC;QACrE,CAAC;QAAC,OAAO,CAAC,EAAE,CAAC;YACZ,OAAO,SAAS,CAAC;QAClB,CAAC;QAED,IAAI,OAAO,KAAK,KAAK,QAAQ,IAAI,KAAK,KAAK,IAAI,EAAE,CAAC;YACjD,OAAO,SAAS,CAAC;QAClB,CAAC;QAED,MAAM,EAAE,YAAY,EAAE,KAAK,EAAE,GAAG,EAAE,GAAG,KAAK,CAAC;QAC3C,IAAI,OAAO,YAAY,KAAK,QAAQ,IAAI,OAAO,KAAK,KAAK,QAAQ,IAAI,OAAO,GAAG,KAAK,QAAQ,EAAE,CAAC;YAC9F,OAAO,SAAS,CAAC;QAClB,CAAC;QAED,OAAO,EAAE,YAAY,EAAE,KAAK,EAAE,GAAG,EAAE,CAAC;IACrC,CAAC;;AAvDW,wCAAwC;IAGlD,WAAA,aAAa,CAAA;IACb,WAAA,WAAW,CAAA;GAJD,wCAAwC,CAwDpD;;AAED,eAAe,CAAC,KAAM,SAAQ,OAAO;IACpC;QACC,KAAK,CAAC;YACL,EAAE,EAAE,iDAAiD;YACrD,KAAK,EAAE,QAAQ,CAAC,KAAmC,EAAE,IAAa,CAAC;YACnE,EAAE,EAAE,KAAK;YACT,IAAI,EAAE;gBACL,EAAE,EAAE,MAAM,CAAC,qBAAqB;gBAChC,KAAK,EAAE,QAAQ;gBACf,KAAK,EAAE,CAAC;gBACR,IAAI,EAAE,eAAe,CAAC,OAAO;aAC7B;SACD,CAAC,CAAC;IACJ,CAAC;IAEQ,KAAK,CAAC,GAAG,CAAC,QAA0B,EAAE,QAAsB,EAAE,WAA4B;QAClG,MAAM,iBAAiB,GAAG,QAAQ,CAAC,GAAG,CAAC,kBAAkB,CAAC,CAAC;QAC3D,MAAM,MAAM,GAAG,MAAM,iBAAiB,CAAC,YAAY,EAAE,CAAC;QACtD,IAAI,CAAC,QAAQ,IAAI,CAAC,WAAW,IAAI,CAAC,MAAM,EAAE,CAAC;YAC1C,OAAO;QACR,CAAC;QAED,MAAM,CAAC,eAAe,CAAC,UAAU,CAAC,qBAAqB,CAAC,YAAY,CAAC,QAAQ,EAAE,WAAW,CAAC,CAAC,CAAC;IAC9F,CAAC;CACD,CAAC,CAAC;AAEH,eAAe,CAAC,KAAM,SAAQ,OAAO;IACpC;QACC,KAAK,CAAC;YACL,EAAE,EAAE,iDAAiD;YACrD,KAAK,EAAE,QAAQ,CAAC,KAAqC,EAAE,IAAiB,CAAC;YACzE,EAAE,EAAE,KAAK;YACT,IAAI,EAAE;gBACL,EAAE,EAAE,MAAM,CAAC,qBAAqB;gBAChC,KAAK,EAAE,QAAQ;gBACf,KAAK,EAAE,CAAC;gBACR,IAAI,EAAE,eAAe,CAAC,OAAO;aAC7B;SACD,CAAC,CAAC;IACJ,CAAC;IAEQ,KAAK,CAAC,GAAG,CAAC,QAA0B,EAAE,QAAsB,EAAE,WAA4B;QAClG,MAAM,iBAAiB,GAAG,QAAQ,CAAC,GAAG,CAAC,kBAAkB,CAAC,CAAC;QAC3D,MAAM,MAAM,GAAG,MAAM,iBAAiB,CAAC,YAAY,EAAE,CAAC;QACtD,IAAI,CAAC,QAAQ,IAAI,CAAC,WAAW,IAAI,CAAC,MAAM,EAAE,CAAC;YAC1C,OAAO;QACR,CAAC;QAED,MAAM,CAAC,eAAe,CAAC,UAAU,CAAC,qBAAqB,CAAC,YAAY,CAAC,QAAQ,EAAE,WAAW,CAAC,CAAC,CAAC;QAC7F,MAAM,MAAM,CAAC,WAAW,CAAC,qCAAqC,CAAC,CAAC;IACjE,CAAC;CACD,CAAC,CAAC;AAEH,eAAe,CAAC,KAAM,SAAQ,OAAO;IACpC;QACC,KAAK,CAAC;YACL,EAAE,EAAE,uDAAuD;YAC3D,KAAK,EAAE,QAAQ,CAAC,KAAmC,EAAE,IAAa,CAAC;YACnE,EAAE,EAAE,KAAK;YACT,IAAI,EAAE;gBACL,EAAE,EAAE,MAAM,CAAC,2BAA2B;gBACtC,KAAK,EAAE,QAAQ;gBACf,KAAK,EAAE,CAAC;gBACR,IAAI,EAAE,eAAe,CAAC,OAAO;aAC7B;SACD,CAAC,CAAC;IACJ,CAAC;IAEQ,KAAK,CAAC,GAAG,CAAC,QAA0B,EAAE,WAA4B,EAAE,iBAAwC;QACpH,MAAM,iBAAiB,GAAG,QAAQ,CAAC,GAAG,CAAC,kBAAkB,CAAC,CAAC;QAC3D,MAAM,MAAM,GAAG,MAAM,iBAAiB,CAAC,YAAY,EAAE,CAAC;QACtD,IAAI,CAAC,WAAW,IAAI,CAAC,iBAAiB,CAAC,WAAW,IAAI,CAAC,MAAM,EAAE,CAAC;YAC/D,OAAO;QACR,CAAC;QAED,MAAM,CAAC,eAAe,CAAC,UAAU,CAAC;YACjC,EAAE,EAAE,iBAAiB,CAAC,GAAG,CAAC,QAAQ,EAAE;YACpC,IAAI,EAAE,GAAG,QAAQ,CAAC,iBAAiB,CAAC,WAAW,CAAC,EAAE;YAClD,KAAK,EAAE,iBAAiB,CAAC,WAAW;YACpC,WAAW,EAAE,WAAW;YACxB,IAAI,EAAE,sBAAsB;SACiB,CAAC,CAAC;IACjD,CAAC;CACD,CAAC,CAAC","file":"scmHistoryChatContext.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { coalesce } from '../../../../base/common/arrays.js';\nimport { ThrottledDelayer } from '../../../../base/common/async.js';\nimport { CancellationToken } from '../../../../base/common/cancellation.js';\nimport { Codicon } from '../../../../base/common/codicons.js';\nimport { fromNow } from '../../../../base/common/date.js';\nimport { Disposable } from '../../../../base/common/lifecycle.js';\nimport { basename } from '../../../../base/common/resources.js';\nimport { ThemeIcon } from '../../../../base/common/themables.js';\nimport { URI, UriComponents } from '../../../../base/common/uri.js';\nimport { ITextModel } from '../../../../editor/common/model.js';\nimport { IModelService } from '../../../../editor/common/services/model.js';\nimport { ITextModelContentProvider, ITextModelService } from '../../../../editor/common/services/resolverService.js';\nimport { localize } from '../../../../nls.js';\nimport { Action2, MenuId, registerAction2 } from '../../../../platform/actions/common/actions.js';\nimport { CodeDataTransfers } from '../../../../platform/dnd/browser/dnd.js';\nimport { IInstantiationService, ServicesAccessor } from '../../../../platform/instantiation/common/instantiation.js';\nimport { IWorkbenchContribution } from '../../../common/contributions.js';\nimport { IChatWidget, IChatWidgetService } from '../../chat/browser/chat.js';\nimport { IChatContextPickerItem, IChatContextPickerPickItem, IChatContextPickService, picksWithPromiseFn } from '../../chat/browser/chatContextPickService.js';\nimport { ChatContextKeys } from '../../chat/common/chatContextKeys.js';\nimport { ISCMHistoryItemChangeVariableEntry, ISCMHistoryItemVariableEntry } from '../../chat/common/chatVariableEntries.js';\nimport { ScmHistoryItemResolver } from '../../multiDiffEditor/browser/scmMultiDiffSourceResolver.js';\nimport { ISCMHistoryItem, ISCMHistoryItemChange } from '../common/history.js';\nimport { ISCMProvider, ISCMService, ISCMViewService } from '../common/scm.js';\n\nexport interface SCMHistoryItemTransferData {\n\treadonly name: string;\n\treadonly resource: UriComponents;\n\treadonly historyItem: ISCMHistoryItem;\n}\n\nexport function extractSCMHistoryItemDropData(e: DragEvent): SCMHistoryItemTransferData[] | undefined {\n\tif (!e.dataTransfer?.types.includes(CodeDataTransfers.SCM_HISTORY_ITEM)) {\n\t\treturn undefined;\n\t}\n\n\tconst data = e.dataTransfer?.getData(CodeDataTransfers.SCM_HISTORY_ITEM);\n\tif (!data) {\n\t\treturn undefined;\n\t}\n\n\treturn JSON.parse(data) as SCMHistoryItemTransferData[];\n}\n\nexport class SCMHistoryItemContextContribution extends Disposable implements IWorkbenchContribution {\n\n\tstatic readonly ID = 'workbench.contrib.chat.scmHistoryItemContextContribution';\n\n\tconstructor(\n\t\t@IChatContextPickService contextPickService: IChatContextPickService,\n\t\t@IInstantiationService instantiationService: IInstantiationService,\n\t\t@ITextModelService textModelResolverService: ITextModelService\n\t) {\n\t\tsuper();\n\t\tthis._store.add(contextPickService.registerChatContextItem(\n\t\t\tinstantiationService.createInstance(SCMHistoryItemContext)));\n\n\t\tthis._store.add(textModelResolverService.registerTextModelContentProvider(\n\t\t\tScmHistoryItemResolver.scheme,\n\t\t\tinstantiationService.createInstance(SCMHistoryItemContextContentProvider)));\n\n\t\tthis._store.add(textModelResolverService.registerTextModelContentProvider(\n\t\t\tSCMHistoryItemChangeRangeContentProvider.scheme,\n\t\t\tinstantiationService.createInstance(SCMHistoryItemChangeRangeContentProvider)));\n\t}\n}\n\nclass SCMHistoryItemContext implements IChatContextPickerItem {\n\treadonly type = 'pickerPick';\n\treadonly label = localize('chatContext.scmHistoryItems', 'Source Control...');\n\treadonly icon = Codicon.gitCommit;\n\n\tprivate readonly _delayer = new ThrottledDelayer<IChatContextPickerPickItem[]>(200);\n\n\tpublic static asAttachment(provider: ISCMProvider, historyItem: ISCMHistoryItem): ISCMHistoryItemVariableEntry {\n\t\tconst historyItemParentId = historyItem.parentIds.length > 0 ? historyItem.parentIds[0] : undefined;\n\t\tconst multiDiffSourceUri = ScmHistoryItemResolver.getMultiDiffSourceUri(provider, historyItem.id, historyItemParentId, historyItem.displayId);\n\t\tconst attachmentName = `$(${Codicon.repo.id})\\u00A0${provider.name}\\u00A0$(${Codicon.gitCommit.id})\\u00A0${historyItem.displayId ?? historyItem.id}`;\n\n\t\treturn {\n\t\t\tid: historyItem.id,\n\t\t\tname: attachmentName,\n\t\t\tvalue: multiDiffSourceUri,\n\t\t\thistoryItem: {\n\t\t\t\t...historyItem,\n\t\t\t\treferences: []\n\t\t\t},\n\t\t\tkind: 'scmHistoryItem'\n\t\t} satisfies ISCMHistoryItemVariableEntry;\n\t}\n\n\tconstructor(\n\t\t@ISCMViewService private readonly _scmViewService: ISCMViewService\n\t) { }\n\n\tisEnabled(widget: IChatWidget): Promise<boolean> | boolean {\n\t\tconst activeRepository = this._scmViewService.activeRepository.get();\n\t\tconst supported = !!widget.attachmentCapabilities.supportsSourceControlAttachments;\n\t\treturn activeRepository?.repository.provider.historyProvider.get() !== undefined && supported;\n\t}\n\n\tasPicker(_widget: IChatWidget) {\n\t\treturn {\n\t\t\tplaceholder: localize('chatContext.scmHistoryItems.placeholder', 'Select a change'),\n\t\t\tpicks: picksWithPromiseFn((query: string, token: CancellationToken) => {\n\t\t\t\tconst filterText = query.trim() !== '' ? query.trim() : undefined;\n\t\t\t\tconst activeRepository = this._scmViewService.activeRepository.get();\n\t\t\t\tconst historyProvider = activeRepository?.repository.provider.historyProvider.get();\n\t\t\t\tif (!activeRepository || !historyProvider) {\n\t\t\t\t\treturn Promise.resolve([]);\n\t\t\t\t}\n\n\t\t\t\tconst historyItemRefs = coalesce([\n\t\t\t\t\thistoryProvider.historyItemRef.get(),\n\t\t\t\t\thistoryProvider.historyItemRemoteRef.get(),\n\t\t\t\t\thistoryProvider.historyItemBaseRef.get(),\n\t\t\t\t]).map(ref => ref.id);\n\n\t\t\t\treturn this._delayer.trigger(() => {\n\t\t\t\t\treturn historyProvider.provideHistoryItems({ historyItemRefs, filterText, limit: 100 }, token)\n\t\t\t\t\t\t.then(historyItems => {\n\t\t\t\t\t\t\tif (!historyItems) {\n\t\t\t\t\t\t\t\treturn [];\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\treturn historyItems.map(historyItem => {\n\t\t\t\t\t\t\t\tconst details = [`${historyItem.displayId ?? historyItem.id}`];\n\t\t\t\t\t\t\t\tif (historyItem.author) {\n\t\t\t\t\t\t\t\t\tdetails.push(historyItem.author);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tif (historyItem.statistics) {\n\t\t\t\t\t\t\t\t\tdetails.push(`${historyItem.statistics.files} ${localize('files', 'file(s)')}`);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tif (historyItem.timestamp) {\n\t\t\t\t\t\t\t\t\tdetails.push(fromNow(historyItem.timestamp, true, true));\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\t\t\ticonClass: ThemeIcon.asClassName(Codicon.gitCommit),\n\t\t\t\t\t\t\t\t\tlabel: historyItem.subject,\n\t\t\t\t\t\t\t\t\tdetail: details.join(`$(${Codicon.circleSmallFilled.id})`),\n\t\t\t\t\t\t\t\t\tasAttachment: () => SCMHistoryItemContext.asAttachment(activeRepository.repository.provider, historyItem)\n\t\t\t\t\t\t\t\t} satisfies IChatContextPickerPickItem;\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t})\n\t\t};\n\t}\n}\n\nclass SCMHistoryItemContextContentProvider implements ITextModelContentProvider {\n\tconstructor(\n\t\t@IModelService private readonly _modelService: IModelService,\n\t\t@ISCMService private readonly _scmService: ISCMService\n\t) { }\n\n\tasync provideTextContent(resource: URI): Promise<ITextModel | null> {\n\t\tconst uriFields = ScmHistoryItemResolver.parseUri(resource);\n\t\tif (!uriFields) {\n\t\t\treturn null;\n\t\t}\n\n\t\tconst textModel = this._modelService.getModel(resource);\n\t\tif (textModel) {\n\t\t\treturn textModel;\n\t\t}\n\n\t\tconst { repositoryId, historyItemId } = uriFields;\n\t\tconst repository = this._scmService.getRepository(repositoryId);\n\t\tconst historyProvider = repository?.provider.historyProvider.get();\n\t\tif (!repository || !historyProvider) {\n\t\t\treturn null;\n\t\t}\n\n\t\tconst historyItemContext = await historyProvider.resolveHistoryItemChatContext(historyItemId);\n\t\tif (!historyItemContext) {\n\t\t\treturn null;\n\t\t}\n\n\t\treturn this._modelService.createModel(historyItemContext, null, resource, false);\n\t}\n}\n\nexport interface ScmHistoryItemChangeRangeUriFields {\n\treadonly repositoryId: string;\n\treadonly start: string;\n\treadonly end: string;\n}\n\nexport class SCMHistoryItemChangeRangeContentProvider implements ITextModelContentProvider {\n\tstatic readonly scheme = 'scm-history-item-change-range';\n\tconstructor(\n\t\t@IModelService private readonly _modelService: IModelService,\n\t\t@ISCMService private readonly _scmService: ISCMService\n\t) { }\n\n\tasync provideTextContent(resource: URI): Promise<ITextModel | null> {\n\t\tconst uriFields = this._parseUri(resource);\n\t\tif (!uriFields) {\n\t\t\treturn null;\n\t\t}\n\n\t\tconst textModel = this._modelService.getModel(resource);\n\t\tif (textModel) {\n\t\t\treturn textModel;\n\t\t}\n\n\t\tconst { repositoryId, start, end } = uriFields;\n\t\tconst repository = this._scmService.getRepository(repositoryId);\n\t\tconst historyProvider = repository?.provider.historyProvider.get();\n\t\tif (!repository || !historyProvider) {\n\t\t\treturn null;\n\t\t}\n\n\t\tconst historyItemChangeRangeContext = await historyProvider.resolveHistoryItemChangeRangeChatContext(end, start, resource.path);\n\t\tif (!historyItemChangeRangeContext) {\n\t\t\treturn null;\n\t\t}\n\n\t\treturn this._modelService.createModel(historyItemChangeRangeContext, null, resource, false);\n\t}\n\n\tprivate _parseUri(uri: URI): ScmHistoryItemChangeRangeUriFields | undefined {\n\t\tif (uri.scheme !== SCMHistoryItemChangeRangeContentProvider.scheme) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\tlet query: ScmHistoryItemChangeRangeUriFields;\n\t\ttry {\n\t\t\tquery = JSON.parse(uri.query) as ScmHistoryItemChangeRangeUriFields;\n\t\t} catch (e) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\tif (typeof query !== 'object' || query === null) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\tconst { repositoryId, start, end } = query;\n\t\tif (typeof repositoryId !== 'string' || typeof start !== 'string' || typeof end !== 'string') {\n\t\t\treturn undefined;\n\t\t}\n\n\t\treturn { repositoryId, start, end };\n\t}\n}\n\nregisterAction2(class extends Action2 {\n\tconstructor() {\n\t\tsuper({\n\t\t\tid: 'workbench.scm.action.graph.addHistoryItemToChat',\n\t\t\ttitle: localize('chat.action.scmHistoryItemContext', 'Add to Chat'),\n\t\t\tf1: false,\n\t\t\tmenu: {\n\t\t\t\tid: MenuId.SCMHistoryItemContext,\n\t\t\t\tgroup: 'z_chat',\n\t\t\t\torder: 1,\n\t\t\t\twhen: ChatContextKeys.enabled\n\t\t\t}\n\t\t});\n\t}\n\n\toverride async run(accessor: ServicesAccessor, provider: ISCMProvider, historyItem: ISCMHistoryItem): Promise<void> {\n\t\tconst chatWidgetService = accessor.get(IChatWidgetService);\n\t\tconst widget = await chatWidgetService.revealWidget();\n\t\tif (!provider || !historyItem || !widget) {\n\t\t\treturn;\n\t\t}\n\n\t\twidget.attachmentModel.addContext(SCMHistoryItemContext.asAttachment(provider, historyItem));\n\t}\n});\n\nregisterAction2(class extends Action2 {\n\tconstructor() {\n\t\tsuper({\n\t\t\tid: 'workbench.scm.action.graph.summarizeHistoryItem',\n\t\t\ttitle: localize('chat.action.scmHistoryItemSummarize', 'Explain Changes'),\n\t\t\tf1: false,\n\t\t\tmenu: {\n\t\t\t\tid: MenuId.SCMHistoryItemContext,\n\t\t\t\tgroup: 'z_chat',\n\t\t\t\torder: 2,\n\t\t\t\twhen: ChatContextKeys.enabled\n\t\t\t}\n\t\t});\n\t}\n\n\toverride async run(accessor: ServicesAccessor, provider: ISCMProvider, historyItem: ISCMHistoryItem): Promise<void> {\n\t\tconst chatWidgetService = accessor.get(IChatWidgetService);\n\t\tconst widget = await chatWidgetService.revealWidget();\n\t\tif (!provider || !historyItem || !widget) {\n\t\t\treturn;\n\t\t}\n\n\t\twidget.attachmentModel.addContext(SCMHistoryItemContext.asAttachment(provider, historyItem));\n\t\tawait widget.acceptInput('Summarize the attached history item');\n\t}\n});\n\nregisterAction2(class extends Action2 {\n\tconstructor() {\n\t\tsuper({\n\t\t\tid: 'workbench.scm.action.graph.addHistoryItemChangeToChat',\n\t\t\ttitle: localize('chat.action.scmHistoryItemContext', 'Add to Chat'),\n\t\t\tf1: false,\n\t\t\tmenu: {\n\t\t\t\tid: MenuId.SCMHistoryItemChangeContext,\n\t\t\t\tgroup: 'z_chat',\n\t\t\t\torder: 1,\n\t\t\t\twhen: ChatContextKeys.enabled\n\t\t\t}\n\t\t});\n\t}\n\n\toverride async run(accessor: ServicesAccessor, historyItem: ISCMHistoryItem, historyItemChange: ISCMHistoryItemChange): Promise<void> {\n\t\tconst chatWidgetService = accessor.get(IChatWidgetService);\n\t\tconst widget = await chatWidgetService.revealWidget();\n\t\tif (!historyItem || !historyItemChange.modifiedUri || !widget) {\n\t\t\treturn;\n\t\t}\n\n\t\twidget.attachmentModel.addContext({\n\t\t\tid: historyItemChange.uri.toString(),\n\t\t\tname: `${basename(historyItemChange.modifiedUri)}`,\n\t\t\tvalue: historyItemChange.modifiedUri,\n\t\t\thistoryItem: historyItem,\n\t\t\tkind: 'scmHistoryItemChange',\n\t\t} satisfies ISCMHistoryItemChangeVariableEntry);\n\t}\n});\n"]}