{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/contrib/scm/browser/quickDiffModel.ts","vs/workbench/contrib/scm/browser/quickDiffModel.ts"],"names":[],"mappings":"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","file":"quickDiffModel.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { ResourceMap } from '../../../../base/common/map.js';\nimport { createDecorator, IInstantiationService } from '../../../../platform/instantiation/common/instantiation.js';\nimport { EncodingMode, IResolvedTextFileEditorModel, isTextFileEditorModel, ITextFileEditorModel, ITextFileService } from '../../../services/textfile/common/textfiles.js';\nimport { Disposable, DisposableMap, DisposableStore, IReference, ReferenceCollection } from '../../../../base/common/lifecycle.js';\nimport { DiffAlgorithmName, IEditorWorkerService } from '../../../../editor/common/services/editorWorker.js';\nimport { IUriIdentityService } from '../../../../platform/uriIdentity/common/uriIdentity.js';\nimport { URI } from '../../../../base/common/uri.js';\nimport { IChange } from '../../../../editor/common/diff/legacyLinesDiffComputer.js';\nimport { IResolvedTextEditorModel, ITextModelService } from '../../../../editor/common/services/resolverService.js';\nimport { ITextModel, shouldSynchronizeModel } from '../../../../editor/common/model.js';\nimport { compareChanges, getModifiedEndLineNumber, IQuickDiffService, QuickDiff, QuickDiffChange, QuickDiffResult } from '../common/quickDiff.js';\nimport { ThrottledDelayer } from '../../../../base/common/async.js';\nimport { ISCMRepository, ISCMService } from '../common/scm.js';\nimport { sortedDiff, equals } from '../../../../base/common/arrays.js';\nimport { onUnexpectedError } from '../../../../base/common/errors.js';\nimport { Iterable } from '../../../../base/common/iterator.js';\nimport { ISplice } from '../../../../base/common/sequence.js';\nimport { DiffState } from '../../../../editor/browser/widget/diffEditor/diffEditorViewModel.js';\nimport { toLineChanges } from '../../../../editor/browser/widget/diffEditor/diffEditorWidget.js';\nimport { LineRangeMapping } from '../../../../editor/common/diff/rangeMapping.js';\nimport { IDiffEditorModel } from '../../../../editor/common/editorCommon.js';\nimport { IConfigurationService } from '../../../../platform/configuration/common/configuration.js';\nimport { IProgressService, ProgressLocation } from '../../../../platform/progress/common/progress.js';\nimport { IChatEditingService, ModifiedFileEntryState } from '../../chat/common/chatEditingService.js';\nimport { Emitter, Event } from '../../../../base/common/event.js';\nimport { autorun } from '../../../../base/common/observable.js';\n\nexport const IQuickDiffModelService = createDecorator<IQuickDiffModelService>('IQuickDiffModelService');\n\nexport interface QuickDiffModelOptions {\n\treadonly algorithm: DiffAlgorithmName;\n\treadonly maxComputationTimeMs?: number;\n}\n\nconst decoratorQuickDiffModelOptions: QuickDiffModelOptions = {\n\talgorithm: 'advanced',\n\tmaxComputationTimeMs: 1000\n};\n\nexport interface IQuickDiffModelService {\n\t_serviceBrand: undefined;\n\n\t/**\n\t * Returns `undefined` if the editor model is not resolved.\n\t * Model refrence has to be disposed once not needed anymore.\n\t * @param resource\n\t * @param options\n\t */\n\tcreateQuickDiffModelReference(resource: URI, options?: QuickDiffModelOptions): IReference<QuickDiffModel> | undefined;\n}\n\nclass QuickDiffModelReferenceCollection extends ReferenceCollection<QuickDiffModel> {\n\tconstructor(@IInstantiationService private readonly _instantiationService: IInstantiationService) {\n\t\tsuper();\n\t}\n\n\tprotected override createReferencedObject(_key: string, textFileModel: IResolvedTextFileEditorModel, options: QuickDiffModelOptions): QuickDiffModel {\n\t\treturn this._instantiationService.createInstance(QuickDiffModel, textFileModel, options);\n\t}\n\n\tprotected override destroyReferencedObject(_key: string, object: QuickDiffModel): void {\n\t\tobject.dispose();\n\t}\n}\n\nexport class QuickDiffModelService implements IQuickDiffModelService {\n\t_serviceBrand: undefined;\n\n\tprivate readonly _references: QuickDiffModelReferenceCollection;\n\n\tconstructor(\n\t\t@IInstantiationService private readonly instantiationService: IInstantiationService,\n\t\t@ITextFileService private readonly textFileService: ITextFileService,\n\t\t@IUriIdentityService private readonly uriIdentityService: IUriIdentityService\n\t) {\n\t\tthis._references = this.instantiationService.createInstance(QuickDiffModelReferenceCollection);\n\t}\n\n\tcreateQuickDiffModelReference(resource: URI, options: QuickDiffModelOptions = decoratorQuickDiffModelOptions): IReference<QuickDiffModel> | undefined {\n\t\tconst textFileModel = this.textFileService.files.get(resource);\n\t\tif (!textFileModel?.isResolved()) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\tresource = this.uriIdentityService.asCanonicalUri(resource).with({ query: JSON.stringify(options) });\n\t\treturn this._references.acquire(resource.toString(), textFileModel, options);\n\t}\n}\n\nexport class QuickDiffModel extends Disposable {\n\n\tprivate readonly _model: ITextFileEditorModel;\n\tprivate readonly _originalEditorModels = new ResourceMap<IResolvedTextEditorModel>();\n\tprivate readonly _originalEditorModelsDisposables = this._register(new DisposableStore());\n\tget originalTextModels(): Iterable<ITextModel> {\n\t\treturn Iterable.map(this._originalEditorModels.values(), editorModel => editorModel.textEditorModel);\n\t}\n\n\tprivate _disposed = false;\n\tprivate _quickDiffs: QuickDiff[] = [];\n\tprivate _quickDiffsPromise?: Promise<QuickDiff[]>;\n\tprivate _diffDelayer = this._register(new ThrottledDelayer<void>(200));\n\n\tprivate readonly _onDidChange = this._register(new Emitter<{ changes: QuickDiffChange[]; diff: ISplice<QuickDiffChange>[] }>());\n\treadonly onDidChange: Event<{ changes: QuickDiffChange[]; diff: ISplice<QuickDiffChange>[] }> = this._onDidChange.event;\n\n\tprivate _allChanges: QuickDiffChange[] = [];\n\tget allChanges(): QuickDiffChange[] { return this._allChanges; }\n\n\tprivate _changes: QuickDiffChange[] = [];\n\tget changes(): QuickDiffChange[] { return this._changes; }\n\n\t/**\n\t * Map of quick diff name to the index of the change in `this.changes`\n\t */\n\tprivate _quickDiffChanges: Map<string, number[]> = new Map();\n\tget quickDiffChanges(): Map<string, number[]> { return this._quickDiffChanges; }\n\n\tprivate readonly _repositoryDisposables = new DisposableMap<ISCMRepository>();\n\n\tconstructor(\n\t\ttextFileModel: IResolvedTextFileEditorModel,\n\t\tprivate readonly options: QuickDiffModelOptions,\n\t\t@ISCMService private readonly scmService: ISCMService,\n\t\t@IQuickDiffService private readonly quickDiffService: IQuickDiffService,\n\t\t@IEditorWorkerService private readonly editorWorkerService: IEditorWorkerService,\n\t\t@IConfigurationService private readonly configurationService: IConfigurationService,\n\t\t@ITextModelService private readonly textModelResolverService: ITextModelService,\n\t\t@IChatEditingService private readonly _chatEditingService: IChatEditingService,\n\t\t@IProgressService private readonly progressService: IProgressService,\n\t) {\n\t\tsuper();\n\t\tthis._model = textFileModel;\n\n\t\tthis._register(textFileModel.textEditorModel.onDidChangeContent(() => this.triggerDiff()));\n\t\tthis._register(\n\t\t\tEvent.filter(configurationService.onDidChangeConfiguration,\n\t\t\t\te => e.affectsConfiguration('scm.diffDecorationsIgnoreTrimWhitespace') || e.affectsConfiguration('diffEditor.ignoreTrimWhitespace')\n\t\t\t)(this.triggerDiff, this)\n\t\t);\n\t\tthis._register(scmService.onDidAddRepository(this.onDidAddRepository, this));\n\t\tfor (const r of scmService.repositories) {\n\t\t\tthis.onDidAddRepository(r);\n\t\t}\n\n\t\tthis._register(this._model.onDidChangeEncoding(() => {\n\t\t\tthis._diffDelayer.cancel();\n\t\t\tthis._quickDiffs = [];\n\t\t\tthis._originalEditorModels.clear();\n\t\t\tthis._quickDiffsPromise = undefined;\n\t\t\tthis.setChanges([], [], new Map());\n\t\t\tthis.triggerDiff();\n\t\t}));\n\n\t\tthis._register(this.quickDiffService.onDidChangeQuickDiffProviders(() => this.triggerDiff()));\n\n\t\tthis._register(autorun(reader => {\n\t\t\tfor (const session of this._chatEditingService.editingSessionsObs.read(reader)) {\n\t\t\t\treader.store.add(autorun(r => {\n\t\t\t\t\tfor (const entry of session.entries.read(r)) {\n\t\t\t\t\t\tentry.state.read(r); // signal\n\t\t\t\t\t}\n\t\t\t\t\tthis.triggerDiff();\n\t\t\t\t}));\n\t\t\t}\n\t\t}));\n\n\t\tthis.triggerDiff();\n\t}\n\n\tget quickDiffs(): readonly QuickDiff[] {\n\t\treturn this._quickDiffs;\n\t}\n\n\tpublic getQuickDiffResults(): QuickDiffResult[] {\n\t\treturn this._quickDiffs.map(quickDiff => {\n\t\t\tconst changes = this.allChanges\n\t\t\t\t.filter(change => change.providerId === quickDiff.id);\n\n\t\t\treturn {\n\t\t\t\toriginal: quickDiff.originalResource,\n\t\t\t\tmodified: this._model.resource,\n\t\t\t\tchanges: changes.map(change => change.change),\n\t\t\t\tchanges2: changes.map(change => change.change2)\n\t\t\t} satisfies QuickDiffResult;\n\t\t});\n\t}\n\n\tpublic getDiffEditorModel(originalUri: URI): IDiffEditorModel | undefined {\n\t\tconst editorModel = this._originalEditorModels.get(originalUri);\n\t\treturn editorModel ?\n\t\t\t{\n\t\t\t\tmodified: this._model.textEditorModel!,\n\t\t\t\toriginal: editorModel.textEditorModel\n\t\t\t} : undefined;\n\t}\n\n\tprivate onDidAddRepository(repository: ISCMRepository): void {\n\t\tconst disposables = new DisposableStore();\n\n\t\tdisposables.add(repository.provider.onDidChangeResources(this.triggerDiff, this));\n\n\t\tconst onDidRemoveRepository = Event.filter(this.scmService.onDidRemoveRepository, r => r === repository);\n\t\tdisposables.add(onDidRemoveRepository(() => this._repositoryDisposables.deleteAndDispose(repository)));\n\n\t\tthis._repositoryDisposables.set(repository, disposables);\n\n\t\tthis.triggerDiff();\n\t}\n\n\tprivate triggerDiff(): void {\n\t\tif (!this._diffDelayer) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._diffDelayer\n\t\t\t.trigger(async () => {\n\t\t\t\tconst result: { allChanges: QuickDiffChange[]; changes: QuickDiffChange[]; mapChanges: Map<string, number[]> } | null = await this.diff();\n\n\t\t\t\tconst editorModels = Array.from(this._originalEditorModels.values());\n\t\t\t\tif (!result || this._disposed || this._model.isDisposed() || editorModels.some(editorModel => editorModel.isDisposed())) {\n\t\t\t\t\treturn; // disposed\n\t\t\t\t}\n\n\t\t\t\tthis.setChanges(result.allChanges, result.changes, result.mapChanges);\n\t\t\t})\n\t\t\t.catch(err => onUnexpectedError(err));\n\t}\n\n\tprivate setChanges(allChanges: QuickDiffChange[], changes: QuickDiffChange[], mapChanges: Map<string, number[]>): void {\n\t\tconst diff = sortedDiff(this.changes, changes, (a, b) => compareChanges(a.change, b.change));\n\t\tthis._allChanges = allChanges;\n\t\tthis._changes = changes;\n\t\tthis._quickDiffChanges = mapChanges;\n\t\tthis._onDidChange.fire({ changes, diff });\n\t}\n\n\tprivate diff(): Promise<{ allChanges: QuickDiffChange[]; changes: QuickDiffChange[]; mapChanges: Map<string, number[]> } | null> {\n\t\treturn this.progressService.withProgress({ location: ProgressLocation.Scm, delay: 250 }, async () => {\n\t\t\tconst originalURIs = await this.getQuickDiffsPromise();\n\t\t\tif (this._disposed || this._model.isDisposed() || (originalURIs.length === 0)) {\n\t\t\t\t// Disposed\n\t\t\t\treturn Promise.resolve({ allChanges: [], changes: [], mapChanges: new Map() });\n\t\t\t}\n\n\t\t\tconst quickDiffs = originalURIs\n\t\t\t\t.filter(quickDiff => this.editorWorkerService.canComputeDirtyDiff(quickDiff.originalResource, this._model.resource));\n\t\t\tif (quickDiffs.length === 0) {\n\t\t\t\t// All files are too large\n\t\t\t\treturn Promise.resolve({ allChanges: [], changes: [], mapChanges: new Map() });\n\t\t\t}\n\n\t\t\tconst quickDiffPrimary = quickDiffs.find(quickDiff => quickDiff.kind === 'primary');\n\n\t\t\tconst ignoreTrimWhitespaceSetting = this.configurationService.getValue<'true' | 'false' | 'inherit'>('scm.diffDecorationsIgnoreTrimWhitespace');\n\t\t\tconst ignoreTrimWhitespace = ignoreTrimWhitespaceSetting === 'inherit'\n\t\t\t\t? this.configurationService.getValue<boolean>('diffEditor.ignoreTrimWhitespace')\n\t\t\t\t: ignoreTrimWhitespaceSetting !== 'false';\n\n\t\t\tconst diffs: QuickDiffChange[] = [];\n\t\t\tconst secondaryDiffs: QuickDiffChange[] = [];\n\n\t\t\tfor (const quickDiff of quickDiffs) {\n\t\t\t\tconst diff = await this._diff(quickDiff.originalResource, this._model.resource, ignoreTrimWhitespace);\n\t\t\t\tif (diff.changes && diff.changes2 && diff.changes.length === diff.changes2.length) {\n\t\t\t\t\tfor (let index = 0; index < diff.changes.length; index++) {\n\t\t\t\t\t\tconst change2 = diff.changes2[index];\n\n\t\t\t\t\t\t// The secondary diffs are complimentary to the primary diffs, and\n\t\t\t\t\t\t// they can overlap. We need to remove the secondary quick diffs that\n\t\t\t\t\t\t// overlap for the UI, but we need to expose all diffs through the API.\n\t\t\t\t\t\tif (quickDiffPrimary && quickDiff.kind === 'secondary') {\n\t\t\t\t\t\t\t// Check whether the:\n\t\t\t\t\t\t\t// 1. the modified line range is equal\n\t\t\t\t\t\t\t// 2. the original line range length is equal\n\t\t\t\t\t\t\tconst primaryQuickDiffChange = diffs\n\t\t\t\t\t\t\t\t.find(d => d.change2.modified.equals(change2.modified) &&\n\t\t\t\t\t\t\t\t\td.change2.original.length === change2.original.length);\n\n\t\t\t\t\t\t\tif (primaryQuickDiffChange) {\n\t\t\t\t\t\t\t\t// Check whether the original content matches\n\t\t\t\t\t\t\t\tconst primaryModel = this._originalEditorModels.get(quickDiffPrimary.originalResource)?.textEditorModel;\n\t\t\t\t\t\t\t\tconst primaryContent = primaryModel?.getValueInRange(primaryQuickDiffChange.change2.toRangeMapping().originalRange);\n\n\t\t\t\t\t\t\t\tconst secondaryModel = this._originalEditorModels.get(quickDiff.originalResource)?.textEditorModel;\n\t\t\t\t\t\t\t\tconst secondaryContent = secondaryModel?.getValueInRange(change2.toRangeMapping().originalRange);\n\t\t\t\t\t\t\t\tif (primaryContent === secondaryContent) {\n\t\t\t\t\t\t\t\t\tsecondaryDiffs.push({\n\t\t\t\t\t\t\t\t\t\tproviderId: quickDiff.id,\n\t\t\t\t\t\t\t\t\t\toriginal: quickDiff.originalResource,\n\t\t\t\t\t\t\t\t\t\tmodified: this._model.resource,\n\t\t\t\t\t\t\t\t\t\tchange: diff.changes[index],\n\t\t\t\t\t\t\t\t\t\tchange2: diff.changes2[index]\n\t\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tdiffs.push({\n\t\t\t\t\t\t\tproviderId: quickDiff.id,\n\t\t\t\t\t\t\toriginal: quickDiff.originalResource,\n\t\t\t\t\t\t\tmodified: this._model.resource,\n\t\t\t\t\t\t\tchange: diff.changes[index],\n\t\t\t\t\t\t\tchange2: diff.changes2[index]\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tconst diffsSorted = diffs.sort((a, b) => compareChanges(a.change, b.change));\n\t\t\tconst allDiffsSorted = [...diffs, ...secondaryDiffs].sort((a, b) => compareChanges(a.change, b.change));\n\n\t\t\tconst map: Map<string, number[]> = new Map();\n\t\t\tfor (let i = 0; i < diffsSorted.length; i++) {\n\t\t\t\tconst providerId = diffsSorted[i].providerId;\n\t\t\t\tif (!map.has(providerId)) {\n\t\t\t\t\tmap.set(providerId, []);\n\t\t\t\t}\n\t\t\t\tmap.get(providerId)!.push(i);\n\t\t\t}\n\n\t\t\treturn { allChanges: allDiffsSorted, changes: diffsSorted, mapChanges: map };\n\t\t});\n\t}\n\n\tprivate async _diff(original: URI, modified: URI, ignoreTrimWhitespace: boolean): Promise<{ changes: readonly IChange[] | null; changes2: readonly LineRangeMapping[] | null }> {\n\t\tconst maxComputationTimeMs = this.options.maxComputationTimeMs ?? Number.MAX_SAFE_INTEGER;\n\n\t\tconst result = await this.editorWorkerService.computeDiff(original, modified, {\n\t\t\tcomputeMoves: false, ignoreTrimWhitespace, maxComputationTimeMs\n\t\t}, this.options.algorithm);\n\n\t\treturn { changes: result ? toLineChanges(DiffState.fromDiffResult(result)) : null, changes2: result?.changes ?? null };\n\t}\n\n\tprivate getQuickDiffsPromise(): Promise<QuickDiff[]> {\n\t\tif (this._quickDiffsPromise) {\n\t\t\treturn this._quickDiffsPromise;\n\t\t}\n\n\t\tthis._quickDiffsPromise = this.getOriginalResource().then(async (quickDiffs) => {\n\t\t\tif (this._disposed) { // disposed\n\t\t\t\treturn [];\n\t\t\t}\n\n\t\t\tif (quickDiffs.length === 0) {\n\t\t\t\tthis._quickDiffs = [];\n\t\t\t\tthis._originalEditorModels.clear();\n\t\t\t\treturn [];\n\t\t\t}\n\n\t\t\tif (equals(this._quickDiffs, quickDiffs, (a, b) =>\n\t\t\t\ta.id === b.id &&\n\t\t\t\ta.originalResource.toString() === b.originalResource.toString() &&\n\t\t\t\tthis.quickDiffService.isQuickDiffProviderVisible(a.id) === this.quickDiffService.isQuickDiffProviderVisible(b.id))\n\t\t\t) {\n\t\t\t\treturn quickDiffs;\n\t\t\t}\n\n\t\t\tthis._quickDiffs = quickDiffs;\n\n\t\t\tthis._originalEditorModels.clear();\n\t\t\tthis._originalEditorModelsDisposables.clear();\n\t\t\treturn (await Promise.all(quickDiffs.map(async (quickDiff) => {\n\t\t\t\ttry {\n\t\t\t\t\tconst ref = await this.textModelResolverService.createModelReference(quickDiff.originalResource);\n\t\t\t\t\tif (this._disposed) { // disposed\n\t\t\t\t\t\tref.dispose();\n\t\t\t\t\t\treturn [];\n\t\t\t\t\t}\n\n\t\t\t\t\tthis._originalEditorModels.set(quickDiff.originalResource, ref.object);\n\n\t\t\t\t\tif (isTextFileEditorModel(ref.object) && !ref.object.isDirty()) {\n\t\t\t\t\t\tconst encoding = this._model.getEncoding();\n\n\t\t\t\t\t\tif (encoding) {\n\t\t\t\t\t\t\t(ref.object as ITextFileEditorModel).setEncoding(encoding, EncodingMode.Decode);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tthis._originalEditorModelsDisposables.add(ref);\n\t\t\t\t\tthis._originalEditorModelsDisposables.add(ref.object.textEditorModel.onDidChangeContent(() => this.triggerDiff()));\n\n\t\t\t\t\treturn quickDiff;\n\t\t\t\t} catch (error) {\n\t\t\t\t\treturn []; // possibly invalid reference\n\t\t\t\t}\n\t\t\t}))).flat();\n\t\t});\n\n\t\treturn this._quickDiffsPromise.finally(() => {\n\t\t\tthis._quickDiffsPromise = undefined;\n\t\t});\n\t}\n\n\tprivate async getOriginalResource(): Promise<QuickDiff[]> {\n\t\tif (this._disposed) {\n\t\t\treturn Promise.resolve([]);\n\t\t}\n\t\tconst uri = this._model.resource;\n\n\t\t// disable dirty diff when doing chat edits\n\t\tconst isBeingModifiedByChatEdits = this._chatEditingService.editingSessionsObs.get()\n\t\t\t.some(session => session.getEntry(uri)?.state.get() === ModifiedFileEntryState.Modified);\n\t\tif (isBeingModifiedByChatEdits) {\n\t\t\treturn Promise.resolve([]);\n\t\t}\n\n\t\tconst isSynchronized = this._model.textEditorModel ? shouldSynchronizeModel(this._model.textEditorModel) : undefined;\n\t\treturn this.quickDiffService.getQuickDiffs(uri, this._model.getLanguageId(), isSynchronized);\n\t}\n\n\tfindNextClosestChange(lineNumber: number, inclusive = true, providerId?: string): number {\n\t\tconst visibleQuickDiffIds = this.quickDiffs\n\t\t\t.filter(quickDiff => (!providerId || quickDiff.id === providerId) &&\n\t\t\t\tthis.quickDiffService.isQuickDiffProviderVisible(quickDiff.id))\n\t\t\t.map(quickDiff => quickDiff.id);\n\n\t\tif (!inclusive) {\n\t\t\t// Next visible change\n\t\t\tlet nextChangeIndex = this.changes\n\t\t\t\t.findIndex(change => visibleQuickDiffIds.includes(change.providerId) &&\n\t\t\t\t\tchange.change.modifiedStartLineNumber > lineNumber);\n\n\t\t\tif (nextChangeIndex !== -1) {\n\t\t\t\treturn nextChangeIndex;\n\t\t\t}\n\n\t\t\t// First visible change\n\t\t\tnextChangeIndex = this.changes\n\t\t\t\t.findIndex(change => visibleQuickDiffIds.includes(change.providerId));\n\n\t\t\treturn nextChangeIndex !== -1 ? nextChangeIndex : 0;\n\t\t}\n\n\t\tconst primaryQuickDiffId = this.quickDiffs\n\t\t\t.find(quickDiff => quickDiff.kind === 'primary')?.id;\n\n\t\tconst primaryInclusiveChangeIndex = this.changes\n\t\t\t.findIndex(change => change.providerId === primaryQuickDiffId &&\n\t\t\t\tchange.change.modifiedStartLineNumber <= lineNumber &&\n\t\t\t\tgetModifiedEndLineNumber(change.change) >= lineNumber);\n\n\t\tif (primaryInclusiveChangeIndex !== -1) {\n\t\t\treturn primaryInclusiveChangeIndex;\n\t\t}\n\n\t\t// Next visible change\n\t\tlet nextChangeIndex = this.changes\n\t\t\t.findIndex(change => visibleQuickDiffIds.includes(change.providerId) &&\n\t\t\t\tchange.change.modifiedStartLineNumber <= lineNumber &&\n\t\t\t\tgetModifiedEndLineNumber(change.change) >= lineNumber);\n\n\t\tif (nextChangeIndex !== -1) {\n\t\t\treturn nextChangeIndex;\n\t\t}\n\n\t\t// First visible change\n\t\tnextChangeIndex = this.changes\n\t\t\t.findIndex(change => visibleQuickDiffIds.includes(change.providerId));\n\n\t\treturn nextChangeIndex !== -1 ? nextChangeIndex : 0;\n\t}\n\n\tfindPreviousClosestChange(lineNumber: number, inclusive = true, providerId?: string): number {\n\t\tfor (let i = this.changes.length - 1; i >= 0; i--) {\n\t\t\tif (providerId && this.changes[i].providerId !== providerId) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t// Skip quick diffs that are not visible\n\t\t\tconst quickDiff = this.quickDiffs.find(quickDiff => quickDiff.id === this.changes[i].providerId);\n\t\t\tif (!quickDiff || !this.quickDiffService.isQuickDiffProviderVisible(quickDiff.id)) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tconst change = this.changes[i].change;\n\n\t\t\tif (inclusive) {\n\t\t\t\tif (change.modifiedStartLineNumber <= lineNumber) {\n\t\t\t\t\treturn i;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif (getModifiedEndLineNumber(change) < lineNumber) {\n\t\t\t\t\treturn i;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn this.changes.length - 1;\n\t}\n\n\toverride dispose(): void {\n\t\tthis._disposed = true;\n\n\t\tthis._quickDiffs = [];\n\t\tthis._diffDelayer.cancel();\n\t\tthis._originalEditorModels.clear();\n\t\tthis._repositoryDisposables.dispose();\n\n\t\tsuper.dispose();\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { ResourceMap } from '../../../../base/common/map.js';\nimport { createDecorator, IInstantiationService } from '../../../../platform/instantiation/common/instantiation.js';\nimport { EncodingMode, IResolvedTextFileEditorModel, isTextFileEditorModel, ITextFileEditorModel, ITextFileService } from '../../../services/textfile/common/textfiles.js';\nimport { Disposable, DisposableMap, DisposableStore, IReference, ReferenceCollection } from '../../../../base/common/lifecycle.js';\nimport { DiffAlgorithmName, IEditorWorkerService } from '../../../../editor/common/services/editorWorker.js';\nimport { IUriIdentityService } from '../../../../platform/uriIdentity/common/uriIdentity.js';\nimport { URI } from '../../../../base/common/uri.js';\nimport { IChange } from '../../../../editor/common/diff/legacyLinesDiffComputer.js';\nimport { IResolvedTextEditorModel, ITextModelService } from '../../../../editor/common/services/resolverService.js';\nimport { ITextModel, shouldSynchronizeModel } from '../../../../editor/common/model.js';\nimport { compareChanges, getModifiedEndLineNumber, IQuickDiffService, QuickDiff, QuickDiffChange, QuickDiffResult } from '../common/quickDiff.js';\nimport { ThrottledDelayer } from '../../../../base/common/async.js';\nimport { ISCMRepository, ISCMService } from '../common/scm.js';\nimport { sortedDiff, equals } from '../../../../base/common/arrays.js';\nimport { onUnexpectedError } from '../../../../base/common/errors.js';\nimport { Iterable } from '../../../../base/common/iterator.js';\nimport { ISplice } from '../../../../base/common/sequence.js';\nimport { DiffState } from '../../../../editor/browser/widget/diffEditor/diffEditorViewModel.js';\nimport { toLineChanges } from '../../../../editor/browser/widget/diffEditor/diffEditorWidget.js';\nimport { LineRangeMapping } from '../../../../editor/common/diff/rangeMapping.js';\nimport { IDiffEditorModel } from '../../../../editor/common/editorCommon.js';\nimport { IConfigurationService } from '../../../../platform/configuration/common/configuration.js';\nimport { IProgressService, ProgressLocation } from '../../../../platform/progress/common/progress.js';\nimport { IChatEditingService, ModifiedFileEntryState } from '../../chat/common/chatEditingService.js';\nimport { Emitter, Event } from '../../../../base/common/event.js';\nimport { autorun } from '../../../../base/common/observable.js';\n\nexport const IQuickDiffModelService = createDecorator<IQuickDiffModelService>('IQuickDiffModelService');\n\nexport interface QuickDiffModelOptions {\n\treadonly algorithm: DiffAlgorithmName;\n\treadonly maxComputationTimeMs?: number;\n}\n\nconst decoratorQuickDiffModelOptions: QuickDiffModelOptions = {\n\talgorithm: 'advanced',\n\tmaxComputationTimeMs: 1000\n};\n\nexport interface IQuickDiffModelService {\n\t_serviceBrand: undefined;\n\n\t/**\n\t * Returns `undefined` if the editor model is not resolved.\n\t * Model refrence has to be disposed once not needed anymore.\n\t * @param resource\n\t * @param options\n\t */\n\tcreateQuickDiffModelReference(resource: URI, options?: QuickDiffModelOptions): IReference<QuickDiffModel> | undefined;\n}\n\nclass QuickDiffModelReferenceCollection extends ReferenceCollection<QuickDiffModel> {\n\tconstructor(@IInstantiationService private readonly _instantiationService: IInstantiationService) {\n\t\tsuper();\n\t}\n\n\tprotected override createReferencedObject(_key: string, textFileModel: IResolvedTextFileEditorModel, options: QuickDiffModelOptions): QuickDiffModel {\n\t\treturn this._instantiationService.createInstance(QuickDiffModel, textFileModel, options);\n\t}\n\n\tprotected override destroyReferencedObject(_key: string, object: QuickDiffModel): void {\n\t\tobject.dispose();\n\t}\n}\n\nexport class QuickDiffModelService implements IQuickDiffModelService {\n\t_serviceBrand: undefined;\n\n\tprivate readonly _references: QuickDiffModelReferenceCollection;\n\n\tconstructor(\n\t\t@IInstantiationService private readonly instantiationService: IInstantiationService,\n\t\t@ITextFileService private readonly textFileService: ITextFileService,\n\t\t@IUriIdentityService private readonly uriIdentityService: IUriIdentityService\n\t) {\n\t\tthis._references = this.instantiationService.createInstance(QuickDiffModelReferenceCollection);\n\t}\n\n\tcreateQuickDiffModelReference(resource: URI, options: QuickDiffModelOptions = decoratorQuickDiffModelOptions): IReference<QuickDiffModel> | undefined {\n\t\tconst textFileModel = this.textFileService.files.get(resource);\n\t\tif (!textFileModel?.isResolved()) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\tresource = this.uriIdentityService.asCanonicalUri(resource).with({ query: JSON.stringify(options) });\n\t\treturn this._references.acquire(resource.toString(), textFileModel, options);\n\t}\n}\n\nexport class QuickDiffModel extends Disposable {\n\n\tprivate readonly _model: ITextFileEditorModel;\n\tprivate readonly _originalEditorModels = new ResourceMap<IResolvedTextEditorModel>();\n\tprivate readonly _originalEditorModelsDisposables = this._register(new DisposableStore());\n\tget originalTextModels(): Iterable<ITextModel> {\n\t\treturn Iterable.map(this._originalEditorModels.values(), editorModel => editorModel.textEditorModel);\n\t}\n\n\tprivate _disposed = false;\n\tprivate _quickDiffs: QuickDiff[] = [];\n\tprivate _quickDiffsPromise?: Promise<QuickDiff[]>;\n\tprivate _diffDelayer = this._register(new ThrottledDelayer<void>(200));\n\n\tprivate readonly _onDidChange = this._register(new Emitter<{ changes: QuickDiffChange[]; diff: ISplice<QuickDiffChange>[] }>());\n\treadonly onDidChange: Event<{ changes: QuickDiffChange[]; diff: ISplice<QuickDiffChange>[] }> = this._onDidChange.event;\n\n\tprivate _allChanges: QuickDiffChange[] = [];\n\tget allChanges(): QuickDiffChange[] { return this._allChanges; }\n\n\tprivate _changes: QuickDiffChange[] = [];\n\tget changes(): QuickDiffChange[] { return this._changes; }\n\n\t/**\n\t * Map of quick diff name to the index of the change in `this.changes`\n\t */\n\tprivate _quickDiffChanges: Map<string, number[]> = new Map();\n\tget quickDiffChanges(): Map<string, number[]> { return this._quickDiffChanges; }\n\n\tprivate readonly _repositoryDisposables = new DisposableMap<ISCMRepository>();\n\n\tconstructor(\n\t\ttextFileModel: IResolvedTextFileEditorModel,\n\t\tprivate readonly options: QuickDiffModelOptions,\n\t\t@ISCMService private readonly scmService: ISCMService,\n\t\t@IQuickDiffService private readonly quickDiffService: IQuickDiffService,\n\t\t@IEditorWorkerService private readonly editorWorkerService: IEditorWorkerService,\n\t\t@IConfigurationService private readonly configurationService: IConfigurationService,\n\t\t@ITextModelService private readonly textModelResolverService: ITextModelService,\n\t\t@IChatEditingService private readonly _chatEditingService: IChatEditingService,\n\t\t@IProgressService private readonly progressService: IProgressService,\n\t) {\n\t\tsuper();\n\t\tthis._model = textFileModel;\n\n\t\tthis._register(textFileModel.textEditorModel.onDidChangeContent(() => this.triggerDiff()));\n\t\tthis._register(\n\t\t\tEvent.filter(configurationService.onDidChangeConfiguration,\n\t\t\t\te => e.affectsConfiguration('scm.diffDecorationsIgnoreTrimWhitespace') || e.affectsConfiguration('diffEditor.ignoreTrimWhitespace')\n\t\t\t)(this.triggerDiff, this)\n\t\t);\n\t\tthis._register(scmService.onDidAddRepository(this.onDidAddRepository, this));\n\t\tfor (const r of scmService.repositories) {\n\t\t\tthis.onDidAddRepository(r);\n\t\t}\n\n\t\tthis._register(this._model.onDidChangeEncoding(() => {\n\t\t\tthis._diffDelayer.cancel();\n\t\t\tthis._quickDiffs = [];\n\t\t\tthis._originalEditorModels.clear();\n\t\t\tthis._quickDiffsPromise = undefined;\n\t\t\tthis.setChanges([], [], new Map());\n\t\t\tthis.triggerDiff();\n\t\t}));\n\n\t\tthis._register(this.quickDiffService.onDidChangeQuickDiffProviders(() => this.triggerDiff()));\n\n\t\tthis._register(autorun(reader => {\n\t\t\tfor (const session of this._chatEditingService.editingSessionsObs.read(reader)) {\n\t\t\t\treader.store.add(autorun(r => {\n\t\t\t\t\tfor (const entry of session.entries.read(r)) {\n\t\t\t\t\t\tentry.state.read(r); // signal\n\t\t\t\t\t}\n\t\t\t\t\tthis.triggerDiff();\n\t\t\t\t}));\n\t\t\t}\n\t\t}));\n\n\t\tthis.triggerDiff();\n\t}\n\n\tget quickDiffs(): readonly QuickDiff[] {\n\t\treturn this._quickDiffs;\n\t}\n\n\tpublic getQuickDiffResults(): QuickDiffResult[] {\n\t\treturn this._quickDiffs.map(quickDiff => {\n\t\t\tconst changes = this.allChanges\n\t\t\t\t.filter(change => change.providerId === quickDiff.id);\n\n\t\t\treturn {\n\t\t\t\toriginal: quickDiff.originalResource,\n\t\t\t\tmodified: this._model.resource,\n\t\t\t\tchanges: changes.map(change => change.change),\n\t\t\t\tchanges2: changes.map(change => change.change2)\n\t\t\t} satisfies QuickDiffResult;\n\t\t});\n\t}\n\n\tpublic getDiffEditorModel(originalUri: URI): IDiffEditorModel | undefined {\n\t\tconst editorModel = this._originalEditorModels.get(originalUri);\n\t\treturn editorModel ?\n\t\t\t{\n\t\t\t\tmodified: this._model.textEditorModel!,\n\t\t\t\toriginal: editorModel.textEditorModel\n\t\t\t} : undefined;\n\t}\n\n\tprivate onDidAddRepository(repository: ISCMRepository): void {\n\t\tconst disposables = new DisposableStore();\n\n\t\tdisposables.add(repository.provider.onDidChangeResources(this.triggerDiff, this));\n\n\t\tconst onDidRemoveRepository = Event.filter(this.scmService.onDidRemoveRepository, r => r === repository);\n\t\tdisposables.add(onDidRemoveRepository(() => this._repositoryDisposables.deleteAndDispose(repository)));\n\n\t\tthis._repositoryDisposables.set(repository, disposables);\n\n\t\tthis.triggerDiff();\n\t}\n\n\tprivate triggerDiff(): void {\n\t\tif (!this._diffDelayer) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._diffDelayer\n\t\t\t.trigger(async () => {\n\t\t\t\tconst result: { allChanges: QuickDiffChange[]; changes: QuickDiffChange[]; mapChanges: Map<string, number[]> } | null = await this.diff();\n\n\t\t\t\tconst editorModels = Array.from(this._originalEditorModels.values());\n\t\t\t\tif (!result || this._disposed || this._model.isDisposed() || editorModels.some(editorModel => editorModel.isDisposed())) {\n\t\t\t\t\treturn; // disposed\n\t\t\t\t}\n\n\t\t\t\tthis.setChanges(result.allChanges, result.changes, result.mapChanges);\n\t\t\t})\n\t\t\t.catch(err => onUnexpectedError(err));\n\t}\n\n\tprivate setChanges(allChanges: QuickDiffChange[], changes: QuickDiffChange[], mapChanges: Map<string, number[]>): void {\n\t\tconst diff = sortedDiff(this.changes, changes, (a, b) => compareChanges(a.change, b.change));\n\t\tthis._allChanges = allChanges;\n\t\tthis._changes = changes;\n\t\tthis._quickDiffChanges = mapChanges;\n\t\tthis._onDidChange.fire({ changes, diff });\n\t}\n\n\tprivate diff(): Promise<{ allChanges: QuickDiffChange[]; changes: QuickDiffChange[]; mapChanges: Map<string, number[]> } | null> {\n\t\treturn this.progressService.withProgress({ location: ProgressLocation.Scm, delay: 250 }, async () => {\n\t\t\tconst originalURIs = await this.getQuickDiffsPromise();\n\t\t\tif (this._disposed || this._model.isDisposed() || (originalURIs.length === 0)) {\n\t\t\t\t// Disposed\n\t\t\t\treturn Promise.resolve({ allChanges: [], changes: [], mapChanges: new Map() });\n\t\t\t}\n\n\t\t\tconst quickDiffs = originalURIs\n\t\t\t\t.filter(quickDiff => this.editorWorkerService.canComputeDirtyDiff(quickDiff.originalResource, this._model.resource));\n\t\t\tif (quickDiffs.length === 0) {\n\t\t\t\t// All files are too large\n\t\t\t\treturn Promise.resolve({ allChanges: [], changes: [], mapChanges: new Map() });\n\t\t\t}\n\n\t\t\tconst quickDiffPrimary = quickDiffs.find(quickDiff => quickDiff.kind === 'primary');\n\n\t\t\tconst ignoreTrimWhitespaceSetting = this.configurationService.getValue<'true' | 'false' | 'inherit'>('scm.diffDecorationsIgnoreTrimWhitespace');\n\t\t\tconst ignoreTrimWhitespace = ignoreTrimWhitespaceSetting === 'inherit'\n\t\t\t\t? this.configurationService.getValue<boolean>('diffEditor.ignoreTrimWhitespace')\n\t\t\t\t: ignoreTrimWhitespaceSetting !== 'false';\n\n\t\t\tconst diffs: QuickDiffChange[] = [];\n\t\t\tconst secondaryDiffs: QuickDiffChange[] = [];\n\n\t\t\tfor (const quickDiff of quickDiffs) {\n\t\t\t\tconst diff = await this._diff(quickDiff.originalResource, this._model.resource, ignoreTrimWhitespace);\n\t\t\t\tif (diff.changes && diff.changes2 && diff.changes.length === diff.changes2.length) {\n\t\t\t\t\tfor (let index = 0; index < diff.changes.length; index++) {\n\t\t\t\t\t\tconst change2 = diff.changes2[index];\n\n\t\t\t\t\t\t// The secondary diffs are complimentary to the primary diffs, and\n\t\t\t\t\t\t// they can overlap. We need to remove the secondary quick diffs that\n\t\t\t\t\t\t// overlap for the UI, but we need to expose all diffs through the API.\n\t\t\t\t\t\tif (quickDiffPrimary && quickDiff.kind === 'secondary') {\n\t\t\t\t\t\t\t// Check whether the:\n\t\t\t\t\t\t\t// 1. the modified line range is equal\n\t\t\t\t\t\t\t// 2. the original line range length is equal\n\t\t\t\t\t\t\tconst primaryQuickDiffChange = diffs\n\t\t\t\t\t\t\t\t.find(d => d.change2.modified.equals(change2.modified) &&\n\t\t\t\t\t\t\t\t\td.change2.original.length === change2.original.length);\n\n\t\t\t\t\t\t\tif (primaryQuickDiffChange) {\n\t\t\t\t\t\t\t\t// Check whether the original content matches\n\t\t\t\t\t\t\t\tconst primaryModel = this._originalEditorModels.get(quickDiffPrimary.originalResource)?.textEditorModel;\n\t\t\t\t\t\t\t\tconst primaryContent = primaryModel?.getValueInRange(primaryQuickDiffChange.change2.toRangeMapping().originalRange);\n\n\t\t\t\t\t\t\t\tconst secondaryModel = this._originalEditorModels.get(quickDiff.originalResource)?.textEditorModel;\n\t\t\t\t\t\t\t\tconst secondaryContent = secondaryModel?.getValueInRange(change2.toRangeMapping().originalRange);\n\t\t\t\t\t\t\t\tif (primaryContent === secondaryContent) {\n\t\t\t\t\t\t\t\t\tsecondaryDiffs.push({\n\t\t\t\t\t\t\t\t\t\tproviderId: quickDiff.id,\n\t\t\t\t\t\t\t\t\t\toriginal: quickDiff.originalResource,\n\t\t\t\t\t\t\t\t\t\tmodified: this._model.resource,\n\t\t\t\t\t\t\t\t\t\tchange: diff.changes[index],\n\t\t\t\t\t\t\t\t\t\tchange2: diff.changes2[index]\n\t\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tdiffs.push({\n\t\t\t\t\t\t\tproviderId: quickDiff.id,\n\t\t\t\t\t\t\toriginal: quickDiff.originalResource,\n\t\t\t\t\t\t\tmodified: this._model.resource,\n\t\t\t\t\t\t\tchange: diff.changes[index],\n\t\t\t\t\t\t\tchange2: diff.changes2[index]\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tconst diffsSorted = diffs.sort((a, b) => compareChanges(a.change, b.change));\n\t\t\tconst allDiffsSorted = [...diffs, ...secondaryDiffs].sort((a, b) => compareChanges(a.change, b.change));\n\n\t\t\tconst map: Map<string, number[]> = new Map();\n\t\t\tfor (let i = 0; i < diffsSorted.length; i++) {\n\t\t\t\tconst providerId = diffsSorted[i].providerId;\n\t\t\t\tif (!map.has(providerId)) {\n\t\t\t\t\tmap.set(providerId, []);\n\t\t\t\t}\n\t\t\t\tmap.get(providerId)!.push(i);\n\t\t\t}\n\n\t\t\treturn { allChanges: allDiffsSorted, changes: diffsSorted, mapChanges: map };\n\t\t});\n\t}\n\n\tprivate async _diff(original: URI, modified: URI, ignoreTrimWhitespace: boolean): Promise<{ changes: readonly IChange[] | null; changes2: readonly LineRangeMapping[] | null }> {\n\t\tconst maxComputationTimeMs = this.options.maxComputationTimeMs ?? Number.MAX_SAFE_INTEGER;\n\n\t\tconst result = await this.editorWorkerService.computeDiff(original, modified, {\n\t\t\tcomputeMoves: false, ignoreTrimWhitespace, maxComputationTimeMs\n\t\t}, this.options.algorithm);\n\n\t\treturn { changes: result ? toLineChanges(DiffState.fromDiffResult(result)) : null, changes2: result?.changes ?? null };\n\t}\n\n\tprivate getQuickDiffsPromise(): Promise<QuickDiff[]> {\n\t\tif (this._quickDiffsPromise) {\n\t\t\treturn this._quickDiffsPromise;\n\t\t}\n\n\t\tthis._quickDiffsPromise = this.getOriginalResource().then(async (quickDiffs) => {\n\t\t\tif (this._disposed) { // disposed\n\t\t\t\treturn [];\n\t\t\t}\n\n\t\t\tif (quickDiffs.length === 0) {\n\t\t\t\tthis._quickDiffs = [];\n\t\t\t\tthis._originalEditorModels.clear();\n\t\t\t\treturn [];\n\t\t\t}\n\n\t\t\tif (equals(this._quickDiffs, quickDiffs, (a, b) =>\n\t\t\t\ta.id === b.id &&\n\t\t\t\ta.originalResource.toString() === b.originalResource.toString() &&\n\t\t\t\tthis.quickDiffService.isQuickDiffProviderVisible(a.id) === this.quickDiffService.isQuickDiffProviderVisible(b.id))\n\t\t\t) {\n\t\t\t\treturn quickDiffs;\n\t\t\t}\n\n\t\t\tthis._quickDiffs = quickDiffs;\n\n\t\t\tthis._originalEditorModels.clear();\n\t\t\tthis._originalEditorModelsDisposables.clear();\n\t\t\treturn (await Promise.all(quickDiffs.map(async (quickDiff) => {\n\t\t\t\ttry {\n\t\t\t\t\tconst ref = await this.textModelResolverService.createModelReference(quickDiff.originalResource);\n\t\t\t\t\tif (this._disposed) { // disposed\n\t\t\t\t\t\tref.dispose();\n\t\t\t\t\t\treturn [];\n\t\t\t\t\t}\n\n\t\t\t\t\tthis._originalEditorModels.set(quickDiff.originalResource, ref.object);\n\n\t\t\t\t\tif (isTextFileEditorModel(ref.object) && !ref.object.isDirty()) {\n\t\t\t\t\t\tconst encoding = this._model.getEncoding();\n\n\t\t\t\t\t\tif (encoding) {\n\t\t\t\t\t\t\t(ref.object as ITextFileEditorModel).setEncoding(encoding, EncodingMode.Decode);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tthis._originalEditorModelsDisposables.add(ref);\n\t\t\t\t\tthis._originalEditorModelsDisposables.add(ref.object.textEditorModel.onDidChangeContent(() => this.triggerDiff()));\n\n\t\t\t\t\treturn quickDiff;\n\t\t\t\t} catch (error) {\n\t\t\t\t\treturn []; // possibly invalid reference\n\t\t\t\t}\n\t\t\t}))).flat();\n\t\t});\n\n\t\treturn this._quickDiffsPromise.finally(() => {\n\t\t\tthis._quickDiffsPromise = undefined;\n\t\t});\n\t}\n\n\tprivate async getOriginalResource(): Promise<QuickDiff[]> {\n\t\tif (this._disposed) {\n\t\t\treturn Promise.resolve([]);\n\t\t}\n\t\tconst uri = this._model.resource;\n\n\t\t// disable dirty diff when doing chat edits\n\t\tconst isBeingModifiedByChatEdits = this._chatEditingService.editingSessionsObs.get()\n\t\t\t.some(session => session.getEntry(uri)?.state.get() === ModifiedFileEntryState.Modified);\n\t\tif (isBeingModifiedByChatEdits) {\n\t\t\treturn Promise.resolve([]);\n\t\t}\n\n\t\tconst isSynchronized = this._model.textEditorModel ? shouldSynchronizeModel(this._model.textEditorModel) : undefined;\n\t\treturn this.quickDiffService.getQuickDiffs(uri, this._model.getLanguageId(), isSynchronized);\n\t}\n\n\tfindNextClosestChange(lineNumber: number, inclusive = true, providerId?: string): number {\n\t\tconst visibleQuickDiffIds = this.quickDiffs\n\t\t\t.filter(quickDiff => (!providerId || quickDiff.id === providerId) &&\n\t\t\t\tthis.quickDiffService.isQuickDiffProviderVisible(quickDiff.id))\n\t\t\t.map(quickDiff => quickDiff.id);\n\n\t\tif (!inclusive) {\n\t\t\t// Next visible change\n\t\t\tlet nextChangeIndex = this.changes\n\t\t\t\t.findIndex(change => visibleQuickDiffIds.includes(change.providerId) &&\n\t\t\t\t\tchange.change.modifiedStartLineNumber > lineNumber);\n\n\t\t\tif (nextChangeIndex !== -1) {\n\t\t\t\treturn nextChangeIndex;\n\t\t\t}\n\n\t\t\t// First visible change\n\t\t\tnextChangeIndex = this.changes\n\t\t\t\t.findIndex(change => visibleQuickDiffIds.includes(change.providerId));\n\n\t\t\treturn nextChangeIndex !== -1 ? nextChangeIndex : 0;\n\t\t}\n\n\t\tconst primaryQuickDiffId = this.quickDiffs\n\t\t\t.find(quickDiff => quickDiff.kind === 'primary')?.id;\n\n\t\tconst primaryInclusiveChangeIndex = this.changes\n\t\t\t.findIndex(change => change.providerId === primaryQuickDiffId &&\n\t\t\t\tchange.change.modifiedStartLineNumber <= lineNumber &&\n\t\t\t\tgetModifiedEndLineNumber(change.change) >= lineNumber);\n\n\t\tif (primaryInclusiveChangeIndex !== -1) {\n\t\t\treturn primaryInclusiveChangeIndex;\n\t\t}\n\n\t\t// Next visible change\n\t\tlet nextChangeIndex = this.changes\n\t\t\t.findIndex(change => visibleQuickDiffIds.includes(change.providerId) &&\n\t\t\t\tchange.change.modifiedStartLineNumber <= lineNumber &&\n\t\t\t\tgetModifiedEndLineNumber(change.change) >= lineNumber);\n\n\t\tif (nextChangeIndex !== -1) {\n\t\t\treturn nextChangeIndex;\n\t\t}\n\n\t\t// First visible change\n\t\tnextChangeIndex = this.changes\n\t\t\t.findIndex(change => visibleQuickDiffIds.includes(change.providerId));\n\n\t\treturn nextChangeIndex !== -1 ? nextChangeIndex : 0;\n\t}\n\n\tfindPreviousClosestChange(lineNumber: number, inclusive = true, providerId?: string): number {\n\t\tfor (let i = this.changes.length - 1; i >= 0; i--) {\n\t\t\tif (providerId && this.changes[i].providerId !== providerId) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t// Skip quick diffs that are not visible\n\t\t\tconst quickDiff = this.quickDiffs.find(quickDiff => quickDiff.id === this.changes[i].providerId);\n\t\t\tif (!quickDiff || !this.quickDiffService.isQuickDiffProviderVisible(quickDiff.id)) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tconst change = this.changes[i].change;\n\n\t\t\tif (inclusive) {\n\t\t\t\tif (change.modifiedStartLineNumber <= lineNumber) {\n\t\t\t\t\treturn i;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif (getModifiedEndLineNumber(change) < lineNumber) {\n\t\t\t\t\treturn i;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn this.changes.length - 1;\n\t}\n\n\toverride dispose(): void {\n\t\tthis._disposed = true;\n\n\t\tthis._quickDiffs = [];\n\t\tthis._diffDelayer.cancel();\n\t\tthis._originalEditorModels.clear();\n\t\tthis._repositoryDisposables.dispose();\n\n\t\tsuper.dispose();\n\t}\n}\n"]}