{"version":3,"sources":["vs/workbench/contrib/scm/browser/activity.ts"],"names":[],"mappings":"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","file":"activity.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { localize } from '../../../../nls.js';\nimport { basename } from '../../../../base/common/resources.js';\nimport { Disposable, DisposableStore } from '../../../../base/common/lifecycle.js';\nimport { Emitter, Event } from '../../../../base/common/event.js';\nimport { VIEW_PANE_ID, ISCMService, ISCMRepository, ISCMViewService, ISCMProvider } from '../common/scm.js';\nimport { IActivityService, NumberBadge } from '../../../services/activity/common/activity.js';\nimport { IWorkbenchContribution } from '../../../common/contributions.js';\nimport { IContextKey, IContextKeyService, RawContextKey } from '../../../../platform/contextkey/common/contextkey.js';\nimport { IStatusbarEntry, IStatusbarService, StatusbarAlignment as MainThreadStatusBarAlignment } from '../../../services/statusbar/browser/statusbar.js';\nimport { IConfigurationService } from '../../../../platform/configuration/common/configuration.js';\nimport { EditorResourceAccessor } from '../../../common/editor.js';\nimport { IUriIdentityService } from '../../../../platform/uriIdentity/common/uriIdentity.js';\nimport { Iterable } from '../../../../base/common/iterator.js';\nimport { ITitleService } from '../../../services/title/browser/titleService.js';\nimport { IEditorGroupContextKeyProvider, IEditorGroupsService } from '../../../services/editor/common/editorGroupsService.js';\nimport { EditorInput } from '../../../common/editor/editorInput.js';\nimport { getRepositoryResourceCount, getSCMRepositoryIcon, getStatusBarCommandGenericName } from './util.js';\nimport { autorun, derived, IObservable, observableFromEvent } from '../../../../base/common/observable.js';\nimport { observableConfigValue } from '../../../../platform/observable/common/platformObservableUtils.js';\nimport { Command } from '../../../../editor/common/languages.js';\n\nconst ActiveRepositoryContextKeys = {\n\tActiveRepositoryName: new RawContextKey<string>('scmActiveRepositoryName', ''),\n\tActiveRepositoryBranchName: new RawContextKey<string>('scmActiveRepositoryBranchName', ''),\n};\n\nexport class SCMActiveRepositoryController extends Disposable implements IWorkbenchContribution {\n\tprivate readonly _repositories: IObservable<Iterable<ISCMRepository>>;\n\tprivate readonly _activeRepositoryHistoryItemRefName: IObservable<string | undefined>;\n\tprivate readonly _countBadgeConfig: IObservable<'all' | 'focused' | 'off'>;\n\tprivate readonly _countBadgeRepositories: IObservable<readonly { provider: ISCMProvider; resourceCount: IObservable<number> }[]>;\n\tprivate readonly _countBadge: IObservable<number>;\n\n\tprivate _activeRepositoryNameContextKey: IContextKey<string>;\n\tprivate _activeRepositoryBranchNameContextKey: IContextKey<string>;\n\n\tconstructor(\n\t\t@IActivityService private readonly activityService: IActivityService,\n\t\t@IConfigurationService private readonly configurationService: IConfigurationService,\n\t\t@IContextKeyService private readonly contextKeyService: IContextKeyService,\n\t\t@ISCMService private readonly scmService: ISCMService,\n\t\t@ISCMViewService private readonly scmViewService: ISCMViewService,\n\t\t@IStatusbarService private readonly statusbarService: IStatusbarService,\n\t\t@ITitleService private readonly titleService: ITitleService\n\t) {\n\t\tsuper();\n\n\t\tthis._activeRepositoryNameContextKey = ActiveRepositoryContextKeys.ActiveRepositoryName.bindTo(this.contextKeyService);\n\t\tthis._activeRepositoryBranchNameContextKey = ActiveRepositoryContextKeys.ActiveRepositoryBranchName.bindTo(this.contextKeyService);\n\n\t\tthis.titleService.registerVariables([\n\t\t\t{ name: 'activeRepositoryName', contextKey: ActiveRepositoryContextKeys.ActiveRepositoryName.key },\n\t\t\t{ name: 'activeRepositoryBranchName', contextKey: ActiveRepositoryContextKeys.ActiveRepositoryBranchName.key, }\n\t\t]);\n\n\t\tthis._countBadgeConfig = observableConfigValue<'all' | 'focused' | 'off'>('scm.countBadge', 'all', this.configurationService);\n\n\t\tthis._repositories = observableFromEvent(this,\n\t\t\tEvent.any(this.scmService.onDidAddRepository, this.scmService.onDidRemoveRepository),\n\t\t\t() => this.scmService.repositories);\n\n\t\tthis._activeRepositoryHistoryItemRefName = derived(reader => {\n\t\t\tconst activeRepository = this.scmViewService.activeRepository.read(reader);\n\t\t\tconst historyProvider = activeRepository?.repository.provider.historyProvider.read(reader);\n\t\t\tconst historyItemRef = historyProvider?.historyItemRef.read(reader);\n\n\t\t\treturn historyItemRef?.name;\n\t\t});\n\n\t\tthis._countBadgeRepositories = derived(this, reader => {\n\t\t\tswitch (this._countBadgeConfig.read(reader)) {\n\t\t\t\tcase 'all': {\n\t\t\t\t\tconst repositories = this._repositories.read(reader);\n\t\t\t\t\treturn [...Iterable.map(repositories, r => ({ provider: r.provider, resourceCount: this._getRepositoryResourceCount(r) }))];\n\t\t\t\t}\n\t\t\t\tcase 'focused': {\n\t\t\t\t\tconst activeRepository = this.scmViewService.activeRepository.read(reader);\n\t\t\t\t\treturn activeRepository ? [{ provider: activeRepository.repository.provider, resourceCount: this._getRepositoryResourceCount(activeRepository.repository) }] : [];\n\t\t\t\t}\n\t\t\t\tcase 'off':\n\t\t\t\t\treturn [];\n\t\t\t\tdefault:\n\t\t\t\t\tthrow new Error('Invalid countBadge setting');\n\t\t\t}\n\t\t});\n\n\t\tthis._countBadge = derived(this, reader => {\n\t\t\tlet total = 0;\n\n\t\t\tfor (const repository of this._countBadgeRepositories.read(reader)) {\n\t\t\t\tconst count = repository.provider.count?.read(reader);\n\t\t\t\tconst resourceCount = repository.resourceCount.read(reader);\n\n\t\t\t\ttotal = total + (count ?? resourceCount);\n\t\t\t}\n\n\t\t\treturn total;\n\t\t});\n\n\t\tthis._register(autorun(reader => {\n\t\t\tconst countBadge = this._countBadge.read(reader);\n\t\t\tthis._updateActivityCountBadge(countBadge, reader.store);\n\t\t}));\n\n\t\tthis._register(autorun(reader => {\n\t\t\tconst activeRepository = this.scmViewService.activeRepository.read(reader);\n\t\t\tconst commands = activeRepository?.repository.provider.statusBarCommands.read(reader);\n\n\t\t\tthis._updateStatusBar(activeRepository, commands ?? [], reader.store);\n\t\t}));\n\n\t\tthis._register(autorun(reader => {\n\t\t\tconst activeRepository = this.scmViewService.activeRepository.read(reader);\n\t\t\tconst historyItemRefName = this._activeRepositoryHistoryItemRefName.read(reader);\n\n\t\t\tthis._updateActiveRepositoryContextKeys(activeRepository?.repository.provider.name, historyItemRefName);\n\t\t}));\n\t}\n\n\tprivate _getRepositoryResourceCount(repository: ISCMRepository): IObservable<number> {\n\t\treturn observableFromEvent(this, repository.provider.onDidChangeResources, () => /** @description repositoryResourceCount */ getRepositoryResourceCount(repository.provider));\n\t}\n\n\tprivate _updateActivityCountBadge(count: number, store: DisposableStore): void {\n\t\tif (count === 0) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst badge = new NumberBadge(count, num => localize('scmPendingChangesBadge', '{0} pending changes', num));\n\t\tstore.add(this.activityService.showViewActivity(VIEW_PANE_ID, { badge }));\n\t}\n\n\tprivate _updateStatusBar(activeRepository: { repository: ISCMRepository; pinned: boolean } | undefined, commands: readonly Command[], store: DisposableStore): void {\n\t\tif (!activeRepository) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst label = activeRepository.repository.provider.rootUri\n\t\t\t? `${basename(activeRepository.repository.provider.rootUri)} (${activeRepository.repository.provider.label})`\n\t\t\t: activeRepository.repository.provider.label;\n\n\t\tfor (let index = 0; index < commands.length; index++) {\n\t\t\tconst command = commands[index];\n\t\t\tconst tooltip = `${label}${command.tooltip ? ` - ${command.tooltip}` : ''}`;\n\t\t\tconst genericCommandName = getStatusBarCommandGenericName(command);\n\n\t\t\tconst statusbarEntry: IStatusbarEntry = {\n\t\t\t\tname: localize('status.scm', \"Source Control\") + (genericCommandName ? ` ${genericCommandName}` : ''),\n\t\t\t\ttext: command.title,\n\t\t\t\tariaLabel: tooltip,\n\t\t\t\ttooltip,\n\t\t\t\tcommand: command.id ? command : undefined\n\t\t\t};\n\n\t\t\tstore.add(index === 0 ?\n\t\t\t\tthis.statusbarService.addEntry(statusbarEntry, `status.scm.${index}`, MainThreadStatusBarAlignment.LEFT, 10000) :\n\t\t\t\tthis.statusbarService.addEntry(statusbarEntry, `status.scm.${index}`, MainThreadStatusBarAlignment.LEFT, { location: { id: `status.scm.${index - 1}`, priority: 10000 }, alignment: MainThreadStatusBarAlignment.RIGHT, compact: true })\n\t\t\t);\n\t\t}\n\n\t\t// Source control provider status bar entry\n\t\tif (this.scmService.repositoryCount > 1) {\n\t\t\tconst icon = getSCMRepositoryIcon(activeRepository, activeRepository.repository);\n\t\t\tconst repositoryStatusbarEntry: IStatusbarEntry = {\n\t\t\t\tname: localize('status.scm.provider', \"Source Control Provider\"),\n\t\t\t\ttext: `$(${icon.id}) ${activeRepository.repository.provider.name}`,\n\t\t\t\tariaLabel: label,\n\t\t\t\ttooltip: label,\n\t\t\t\tcommand: 'scm.setActiveProvider'\n\t\t\t};\n\n\t\t\tstore.add(this.statusbarService.addEntry(repositoryStatusbarEntry, 'status.scm.provider', MainThreadStatusBarAlignment.LEFT, { location: { id: `status.scm.0`, priority: 10000 }, alignment: MainThreadStatusBarAlignment.LEFT, compact: true }));\n\t\t}\n\t}\n\n\tprivate _updateActiveRepositoryContextKeys(repositoryName: string | undefined, branchName: string | undefined): void {\n\t\tthis._activeRepositoryNameContextKey.set(repositoryName ?? '');\n\t\tthis._activeRepositoryBranchNameContextKey.set(branchName ?? '');\n\t}\n}\n\nexport class SCMActiveResourceContextKeyController extends Disposable implements IWorkbenchContribution {\n\tprivate readonly _repositories: IObservable<Iterable<ISCMRepository>>;\n\n\tprivate readonly _onDidRepositoryChange = new Emitter<void>();\n\n\tconstructor(\n\t\t@IEditorGroupsService editorGroupsService: IEditorGroupsService,\n\t\t@ISCMService private readonly scmService: ISCMService,\n\t\t@IUriIdentityService private readonly uriIdentityService: IUriIdentityService\n\t) {\n\t\tsuper();\n\n\t\tconst activeResourceHasChangesContextKey = new RawContextKey<boolean>('scmActiveResourceHasChanges', false, localize('scmActiveResourceHasChanges', \"Whether the active resource has changes\"));\n\t\tconst activeResourceRepositoryContextKey = new RawContextKey<string | undefined>('scmActiveResourceRepository', undefined, localize('scmActiveResourceRepository', \"The active resource's repository\"));\n\n\t\tthis._repositories = observableFromEvent(this,\n\t\t\tEvent.any(this.scmService.onDidAddRepository, this.scmService.onDidRemoveRepository),\n\t\t\t() => this.scmService.repositories);\n\n\t\tthis._register(autorun((reader) => {\n\t\t\tfor (const repository of this._repositories.read(reader)) {\n\t\t\t\treader.store.add(Event.runAndSubscribe(repository.provider.onDidChangeResources, () => {\n\t\t\t\t\tthis._onDidRepositoryChange.fire();\n\t\t\t\t}));\n\t\t\t}\n\t\t}));\n\n\t\t// Create context key providers which will update the context keys based on each groups active editor\n\t\tconst hasChangesContextKeyProvider: IEditorGroupContextKeyProvider<boolean> = {\n\t\t\tcontextKey: activeResourceHasChangesContextKey,\n\t\t\tgetGroupContextKeyValue: (group) => this._getEditorHasChanges(group.activeEditor),\n\t\t\tonDidChange: this._onDidRepositoryChange.event\n\t\t};\n\n\t\tconst repositoryContextKeyProvider: IEditorGroupContextKeyProvider<string | undefined> = {\n\t\t\tcontextKey: activeResourceRepositoryContextKey,\n\t\t\tgetGroupContextKeyValue: (group) => this._getEditorRepositoryId(group.activeEditor),\n\t\t\tonDidChange: this._onDidRepositoryChange.event\n\t\t};\n\n\t\tthis._store.add(editorGroupsService.registerContextKeyProvider(hasChangesContextKeyProvider));\n\t\tthis._store.add(editorGroupsService.registerContextKeyProvider(repositoryContextKeyProvider));\n\t}\n\n\tprivate _getEditorHasChanges(activeEditor: EditorInput | null): boolean {\n\t\tconst activeResource = EditorResourceAccessor.getOriginalUri(activeEditor);\n\t\tif (!activeResource) {\n\t\t\treturn false;\n\t\t}\n\n\t\tconst activeResourceRepository = this.scmService.getRepository(activeResource);\n\t\tfor (const resourceGroup of activeResourceRepository?.provider.groups ?? []) {\n\t\t\tif (resourceGroup.resources\n\t\t\t\t.some(scmResource =>\n\t\t\t\t\tthis.uriIdentityService.extUri.isEqual(activeResource, scmResource.sourceUri))) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\n\t\treturn false;\n\t}\n\n\tprivate _getEditorRepositoryId(activeEditor: EditorInput | null): string | undefined {\n\t\tconst activeResource = EditorResourceAccessor.getOriginalUri(activeEditor);\n\t\tif (!activeResource) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\tconst activeResourceRepository = this.scmService.getRepository(activeResource);\n\t\treturn activeResourceRepository?.id;\n\t}\n\n\toverride dispose(): void {\n\t\tthis._onDidRepositoryChange.dispose();\n\t\tsuper.dispose();\n\t}\n}\n"]}