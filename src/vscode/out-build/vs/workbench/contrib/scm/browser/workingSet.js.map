{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/contrib/scm/browser/workingSet.ts","vs/workbench/contrib/scm/browser/workingSet.ts"],"names":[],"mappings":"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","file":"workingSet.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Disposable, DisposableMap, DisposableStore } from '../../../../base/common/lifecycle.js';\nimport { autorun, derived, IObservable } from '../../../../base/common/observable.js';\nimport { IConfigurationService } from '../../../../platform/configuration/common/configuration.js';\nimport { observableConfigValue } from '../../../../platform/observable/common/platformObservableUtils.js';\nimport { IStorageService, StorageScope, StorageTarget } from '../../../../platform/storage/common/storage.js';\nimport { IWorkbenchContribution } from '../../../common/contributions.js';\nimport { getProviderKey } from './util.js';\nimport { ISCMRepository, ISCMService } from '../common/scm.js';\nimport { IEditorGroupsService, IEditorWorkingSet } from '../../../services/editor/common/editorGroupsService.js';\nimport { IWorkbenchLayoutService, Parts } from '../../../services/layout/browser/layoutService.js';\n\ntype ISCMSerializedWorkingSet = {\n\treadonly providerKey: string;\n\treadonly currentHistoryItemGroupId: string;\n\treadonly editorWorkingSets: [string, IEditorWorkingSet][];\n};\n\ninterface ISCMRepositoryWorkingSet {\n\treadonly currentHistoryItemGroupId: string;\n\treadonly editorWorkingSets: Map<string, IEditorWorkingSet>;\n}\n\nexport class SCMWorkingSetController extends Disposable implements IWorkbenchContribution {\n\tstatic readonly ID = 'workbench.contrib.scmWorkingSets';\n\n\tprivate _enabledConfig: IObservable<boolean>;\n\tprivate _workingSets!: Map<string, ISCMRepositoryWorkingSet>;\n\n\tprivate readonly _repositoryDisposables = new DisposableMap<ISCMRepository>();\n\n\tconstructor(\n\t\t@IConfigurationService private readonly configurationService: IConfigurationService,\n\t\t@IEditorGroupsService private readonly editorGroupsService: IEditorGroupsService,\n\t\t@ISCMService private readonly scmService: ISCMService,\n\t\t@IStorageService private readonly storageService: IStorageService,\n\t\t@IWorkbenchLayoutService private readonly layoutService: IWorkbenchLayoutService\n\t) {\n\t\tsuper();\n\n\t\tthis._enabledConfig = observableConfigValue<boolean>('scm.workingSets.enabled', false, this.configurationService);\n\n\t\tthis._store.add(autorun(reader => {\n\t\t\tif (!this._enabledConfig.read(reader)) {\n\t\t\t\tthis.storageService.remove('scm.workingSets', StorageScope.WORKSPACE);\n\t\t\t\tthis._repositoryDisposables.clearAndDisposeAll();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis._workingSets = this._loadWorkingSets();\n\n\t\t\tthis.scmService.onDidAddRepository(this._onDidAddRepository, this, reader.store);\n\t\t\tthis.scmService.onDidRemoveRepository(this._onDidRemoveRepository, this, reader.store);\n\n\t\t\tfor (const repository of this.scmService.repositories) {\n\t\t\t\tthis._onDidAddRepository(repository);\n\t\t\t}\n\t\t}));\n\t}\n\n\tprivate _onDidAddRepository(repository: ISCMRepository): void {\n\t\tconst disposables = new DisposableStore();\n\n\t\tconst historyItemRefId = derived(reader => {\n\t\t\tconst historyProvider = repository.provider.historyProvider.read(reader);\n\t\t\tconst historyItemRef = historyProvider?.historyItemRef.read(reader);\n\n\t\t\treturn historyItemRef?.id;\n\t\t});\n\n\t\tdisposables.add(autorun(async reader => {\n\t\t\tconst historyItemRefIdValue = historyItemRefId.read(reader);\n\n\t\t\tif (!historyItemRefIdValue) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst providerKey = getProviderKey(repository.provider);\n\t\t\tconst repositoryWorkingSets = this._workingSets.get(providerKey);\n\n\t\t\tif (!repositoryWorkingSets) {\n\t\t\t\tthis._workingSets.set(providerKey, { currentHistoryItemGroupId: historyItemRefIdValue, editorWorkingSets: new Map() });\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Editors for the current working set are automatically restored\n\t\t\tif (repositoryWorkingSets.currentHistoryItemGroupId === historyItemRefIdValue) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Save the working set\n\t\t\tthis._saveWorkingSet(providerKey, historyItemRefIdValue, repositoryWorkingSets);\n\n\t\t\t// Restore the working set\n\t\t\tawait this._restoreWorkingSet(providerKey, historyItemRefIdValue);\n\t\t}));\n\n\t\tthis._repositoryDisposables.set(repository, disposables);\n\t}\n\n\tprivate _onDidRemoveRepository(repository: ISCMRepository): void {\n\t\tthis._repositoryDisposables.deleteAndDispose(repository);\n\t}\n\n\tprivate _loadWorkingSets(): Map<string, ISCMRepositoryWorkingSet> {\n\t\tconst workingSets = new Map<string, ISCMRepositoryWorkingSet>();\n\t\tconst workingSetsRaw = this.storageService.get('scm.workingSets', StorageScope.WORKSPACE);\n\t\tif (!workingSetsRaw) {\n\t\t\treturn workingSets;\n\t\t}\n\n\t\tfor (const serializedWorkingSet of JSON.parse(workingSetsRaw) as ISCMSerializedWorkingSet[]) {\n\t\t\tworkingSets.set(serializedWorkingSet.providerKey, {\n\t\t\t\tcurrentHistoryItemGroupId: serializedWorkingSet.currentHistoryItemGroupId,\n\t\t\t\teditorWorkingSets: new Map(serializedWorkingSet.editorWorkingSets)\n\t\t\t});\n\t\t}\n\n\t\treturn workingSets;\n\t}\n\n\tprivate _saveWorkingSet(providerKey: string, currentHistoryItemGroupId: string, repositoryWorkingSets: ISCMRepositoryWorkingSet): void {\n\t\tconst previousHistoryItemGroupId = repositoryWorkingSets.currentHistoryItemGroupId;\n\t\tconst editorWorkingSets = repositoryWorkingSets.editorWorkingSets;\n\n\t\tconst editorWorkingSet = this.editorGroupsService.saveWorkingSet(previousHistoryItemGroupId);\n\t\tthis._workingSets.set(providerKey, { currentHistoryItemGroupId, editorWorkingSets: editorWorkingSets.set(previousHistoryItemGroupId, editorWorkingSet) });\n\n\t\t// Save to storage\n\t\tconst workingSets: ISCMSerializedWorkingSet[] = [];\n\t\tfor (const [providerKey, { currentHistoryItemGroupId, editorWorkingSets }] of this._workingSets) {\n\t\t\tworkingSets.push({ providerKey, currentHistoryItemGroupId, editorWorkingSets: [...editorWorkingSets] });\n\t\t}\n\t\tthis.storageService.store('scm.workingSets', JSON.stringify(workingSets), StorageScope.WORKSPACE, StorageTarget.MACHINE);\n\t}\n\n\tprivate async _restoreWorkingSet(providerKey: string, currentHistoryItemGroupId: string): Promise<void> {\n\t\tconst workingSets = this._workingSets.get(providerKey);\n\t\tif (!workingSets) {\n\t\t\treturn;\n\t\t}\n\n\t\tlet editorWorkingSetId: IEditorWorkingSet | 'empty' | undefined = workingSets.editorWorkingSets.get(currentHistoryItemGroupId);\n\t\tif (!editorWorkingSetId && this.configurationService.getValue<'empty' | 'current'>('scm.workingSets.default') === 'empty') {\n\t\t\teditorWorkingSetId = 'empty';\n\t\t}\n\n\t\tif (editorWorkingSetId) {\n\t\t\t// Applying a working set can be the result of a user action that has been\n\t\t\t// initiated from the terminal (ex: switching branches). As such, we want\n\t\t\t// to preserve the focus in the terminal. This does not cover the scenario\n\t\t\t// in which the terminal is in the editor part.\n\t\t\tconst preserveFocus = this.layoutService.hasFocus(Parts.PANEL_PART);\n\n\t\t\tawait this.editorGroupsService.applyWorkingSet(editorWorkingSetId, { preserveFocus });\n\t\t}\n\t}\n\n\toverride dispose(): void {\n\t\tthis._repositoryDisposables.dispose();\n\t\tsuper.dispose();\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Disposable, DisposableMap, DisposableStore } from '../../../../base/common/lifecycle.js';\nimport { autorun, derived, IObservable } from '../../../../base/common/observable.js';\nimport { IConfigurationService } from '../../../../platform/configuration/common/configuration.js';\nimport { observableConfigValue } from '../../../../platform/observable/common/platformObservableUtils.js';\nimport { IStorageService, StorageScope, StorageTarget } from '../../../../platform/storage/common/storage.js';\nimport { IWorkbenchContribution } from '../../../common/contributions.js';\nimport { getProviderKey } from './util.js';\nimport { ISCMRepository, ISCMService } from '../common/scm.js';\nimport { IEditorGroupsService, IEditorWorkingSet } from '../../../services/editor/common/editorGroupsService.js';\nimport { IWorkbenchLayoutService, Parts } from '../../../services/layout/browser/layoutService.js';\n\ntype ISCMSerializedWorkingSet = {\n\treadonly providerKey: string;\n\treadonly currentHistoryItemGroupId: string;\n\treadonly editorWorkingSets: [string, IEditorWorkingSet][];\n};\n\ninterface ISCMRepositoryWorkingSet {\n\treadonly currentHistoryItemGroupId: string;\n\treadonly editorWorkingSets: Map<string, IEditorWorkingSet>;\n}\n\nexport class SCMWorkingSetController extends Disposable implements IWorkbenchContribution {\n\tstatic readonly ID = 'workbench.contrib.scmWorkingSets';\n\n\tprivate _enabledConfig: IObservable<boolean>;\n\tprivate _workingSets!: Map<string, ISCMRepositoryWorkingSet>;\n\n\tprivate readonly _repositoryDisposables = new DisposableMap<ISCMRepository>();\n\n\tconstructor(\n\t\t@IConfigurationService private readonly configurationService: IConfigurationService,\n\t\t@IEditorGroupsService private readonly editorGroupsService: IEditorGroupsService,\n\t\t@ISCMService private readonly scmService: ISCMService,\n\t\t@IStorageService private readonly storageService: IStorageService,\n\t\t@IWorkbenchLayoutService private readonly layoutService: IWorkbenchLayoutService\n\t) {\n\t\tsuper();\n\n\t\tthis._enabledConfig = observableConfigValue<boolean>('scm.workingSets.enabled', false, this.configurationService);\n\n\t\tthis._store.add(autorun(reader => {\n\t\t\tif (!this._enabledConfig.read(reader)) {\n\t\t\t\tthis.storageService.remove('scm.workingSets', StorageScope.WORKSPACE);\n\t\t\t\tthis._repositoryDisposables.clearAndDisposeAll();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis._workingSets = this._loadWorkingSets();\n\n\t\t\tthis.scmService.onDidAddRepository(this._onDidAddRepository, this, reader.store);\n\t\t\tthis.scmService.onDidRemoveRepository(this._onDidRemoveRepository, this, reader.store);\n\n\t\t\tfor (const repository of this.scmService.repositories) {\n\t\t\t\tthis._onDidAddRepository(repository);\n\t\t\t}\n\t\t}));\n\t}\n\n\tprivate _onDidAddRepository(repository: ISCMRepository): void {\n\t\tconst disposables = new DisposableStore();\n\n\t\tconst historyItemRefId = derived(reader => {\n\t\t\tconst historyProvider = repository.provider.historyProvider.read(reader);\n\t\t\tconst historyItemRef = historyProvider?.historyItemRef.read(reader);\n\n\t\t\treturn historyItemRef?.id;\n\t\t});\n\n\t\tdisposables.add(autorun(async reader => {\n\t\t\tconst historyItemRefIdValue = historyItemRefId.read(reader);\n\n\t\t\tif (!historyItemRefIdValue) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst providerKey = getProviderKey(repository.provider);\n\t\t\tconst repositoryWorkingSets = this._workingSets.get(providerKey);\n\n\t\t\tif (!repositoryWorkingSets) {\n\t\t\t\tthis._workingSets.set(providerKey, { currentHistoryItemGroupId: historyItemRefIdValue, editorWorkingSets: new Map() });\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Editors for the current working set are automatically restored\n\t\t\tif (repositoryWorkingSets.currentHistoryItemGroupId === historyItemRefIdValue) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Save the working set\n\t\t\tthis._saveWorkingSet(providerKey, historyItemRefIdValue, repositoryWorkingSets);\n\n\t\t\t// Restore the working set\n\t\t\tawait this._restoreWorkingSet(providerKey, historyItemRefIdValue);\n\t\t}));\n\n\t\tthis._repositoryDisposables.set(repository, disposables);\n\t}\n\n\tprivate _onDidRemoveRepository(repository: ISCMRepository): void {\n\t\tthis._repositoryDisposables.deleteAndDispose(repository);\n\t}\n\n\tprivate _loadWorkingSets(): Map<string, ISCMRepositoryWorkingSet> {\n\t\tconst workingSets = new Map<string, ISCMRepositoryWorkingSet>();\n\t\tconst workingSetsRaw = this.storageService.get('scm.workingSets', StorageScope.WORKSPACE);\n\t\tif (!workingSetsRaw) {\n\t\t\treturn workingSets;\n\t\t}\n\n\t\tfor (const serializedWorkingSet of JSON.parse(workingSetsRaw) as ISCMSerializedWorkingSet[]) {\n\t\t\tworkingSets.set(serializedWorkingSet.providerKey, {\n\t\t\t\tcurrentHistoryItemGroupId: serializedWorkingSet.currentHistoryItemGroupId,\n\t\t\t\teditorWorkingSets: new Map(serializedWorkingSet.editorWorkingSets)\n\t\t\t});\n\t\t}\n\n\t\treturn workingSets;\n\t}\n\n\tprivate _saveWorkingSet(providerKey: string, currentHistoryItemGroupId: string, repositoryWorkingSets: ISCMRepositoryWorkingSet): void {\n\t\tconst previousHistoryItemGroupId = repositoryWorkingSets.currentHistoryItemGroupId;\n\t\tconst editorWorkingSets = repositoryWorkingSets.editorWorkingSets;\n\n\t\tconst editorWorkingSet = this.editorGroupsService.saveWorkingSet(previousHistoryItemGroupId);\n\t\tthis._workingSets.set(providerKey, { currentHistoryItemGroupId, editorWorkingSets: editorWorkingSets.set(previousHistoryItemGroupId, editorWorkingSet) });\n\n\t\t// Save to storage\n\t\tconst workingSets: ISCMSerializedWorkingSet[] = [];\n\t\tfor (const [providerKey, { currentHistoryItemGroupId, editorWorkingSets }] of this._workingSets) {\n\t\t\tworkingSets.push({ providerKey, currentHistoryItemGroupId, editorWorkingSets: [...editorWorkingSets] });\n\t\t}\n\t\tthis.storageService.store('scm.workingSets', JSON.stringify(workingSets), StorageScope.WORKSPACE, StorageTarget.MACHINE);\n\t}\n\n\tprivate async _restoreWorkingSet(providerKey: string, currentHistoryItemGroupId: string): Promise<void> {\n\t\tconst workingSets = this._workingSets.get(providerKey);\n\t\tif (!workingSets) {\n\t\t\treturn;\n\t\t}\n\n\t\tlet editorWorkingSetId: IEditorWorkingSet | 'empty' | undefined = workingSets.editorWorkingSets.get(currentHistoryItemGroupId);\n\t\tif (!editorWorkingSetId && this.configurationService.getValue<'empty' | 'current'>('scm.workingSets.default') === 'empty') {\n\t\t\teditorWorkingSetId = 'empty';\n\t\t}\n\n\t\tif (editorWorkingSetId) {\n\t\t\t// Applying a working set can be the result of a user action that has been\n\t\t\t// initiated from the terminal (ex: switching branches). As such, we want\n\t\t\t// to preserve the focus in the terminal. This does not cover the scenario\n\t\t\t// in which the terminal is in the editor part.\n\t\t\tconst preserveFocus = this.layoutService.hasFocus(Parts.PANEL_PART);\n\n\t\t\tawait this.editorGroupsService.applyWorkingSet(editorWorkingSetId, { preserveFocus });\n\t\t}\n\t}\n\n\toverride dispose(): void {\n\t\tthis._repositoryDisposables.dispose();\n\t\tsuper.dispose();\n\t}\n}\n"]}