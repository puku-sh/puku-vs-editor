{"version":3,"sources":["vs/workbench/contrib/extensions/electron-browser/debugExtensionHostAction.ts"],"names":[],"mappings":"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","file":"debugExtensionHostAction.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Codicon } from '../../../../base/common/codicons.js';\nimport { Disposable } from '../../../../base/common/lifecycle.js';\nimport { randomPort } from '../../../../base/common/ports.js';\nimport * as nls from '../../../../nls.js';\nimport { Categories } from '../../../../platform/action/common/actionCommonCategories.js';\nimport { Action2, MenuId } from '../../../../platform/actions/common/actions.js';\nimport { IDialogService } from '../../../../platform/dialogs/common/dialogs.js';\nimport { IInstantiationService, ServicesAccessor } from '../../../../platform/instantiation/common/instantiation.js';\nimport { INativeHostService } from '../../../../platform/native/common/native.js';\nimport { IProductService } from '../../../../platform/product/common/productService.js';\nimport { IProgressService, ProgressLocation } from '../../../../platform/progress/common/progress.js';\nimport { IStorageService, StorageScope, StorageTarget } from '../../../../platform/storage/common/storage.js';\nimport { ActiveEditorContext } from '../../../common/contextkeys.js';\nimport { IWorkbenchContribution } from '../../../common/contributions.js';\nimport { ExtensionHostKind } from '../../../services/extensions/common/extensionHostKind.js';\nimport { IExtensionService, IExtensionInspectInfo } from '../../../services/extensions/common/extensions.js';\nimport { IHostService } from '../../../services/host/browser/host.js';\nimport { IConfig, IDebugService } from '../../debug/common/debug.js';\nimport { RuntimeExtensionsEditor } from './runtimeExtensionsEditor.js';\nimport { IQuickInputService, IQuickPickItem } from '../../../../platform/quickinput/common/quickInput.js';\n\ninterface IExtensionHostQuickPickItem extends IQuickPickItem {\n\tportInfo: IExtensionInspectInfo;\n}\n\nexport class DebugExtensionHostInDevToolsAction extends Action2 {\n\tconstructor() {\n\t\tsuper({\n\t\t\tid: 'workbench.extensions.action.devtoolsExtensionHost',\n\t\t\ttitle: nls.localize2('openDevToolsForExtensionHost', 'Debug Extension Host In Dev Tools'),\n\t\t\tcategory: Categories.Developer,\n\t\t\tf1: true,\n\t\t\ticon: Codicon.debugStart,\n\t\t});\n\t}\n\n\tasync run(accessor: ServicesAccessor): Promise<void> {\n\t\tconst extensionService = accessor.get(IExtensionService);\n\t\tconst nativeHostService = accessor.get(INativeHostService);\n\t\tconst quickInputService = accessor.get(IQuickInputService);\n\n\t\tconst inspectPorts = await extensionService.getInspectPorts(ExtensionHostKind.LocalProcess, true);\n\n\t\tif (inspectPorts.length === 0) {\n\t\t\tconsole.log('[devtoolsExtensionHost] No extension host inspect ports found.');\n\t\t\treturn;\n\t\t}\n\n\t\tconst items: IExtensionHostQuickPickItem[] = inspectPorts.filter(portInfo => portInfo.devtoolsUrl).map(portInfo => ({\n\t\t\tlabel: portInfo.devtoolsLabel ?? `${portInfo.host}:${portInfo.port}`,\n\t\t\tdetail: `${portInfo.host}:${portInfo.port}`,\n\t\t\tportInfo: portInfo\n\t\t}));\n\n\t\tif (items.length === 1) {\n\t\t\tconst portInfo = items[0].portInfo;\n\t\t\tnativeHostService.openDevToolsWindow(portInfo.devtoolsUrl!);\n\t\t\treturn;\n\t\t}\n\n\t\tconst selected = await quickInputService.pick<IExtensionHostQuickPickItem>(items, {\n\t\t\tplaceHolder: nls.localize('selectExtensionHost', \"Pick extension host\"),\n\t\t\tmatchOnDetail: true,\n\t\t});\n\n\t\tif (selected) {\n\t\t\tconst portInfo = selected.portInfo;\n\t\t\tnativeHostService.openDevToolsWindow(portInfo.devtoolsUrl!);\n\t\t}\n\t}\n}\n\nexport class DebugExtensionHostInNewWindowAction extends Action2 {\n\tconstructor() {\n\t\tsuper({\n\t\t\tid: 'workbench.extensions.action.debugExtensionHost',\n\t\t\ttitle: nls.localize2('debugExtensionHost', \"Debug Extension Host In New Window\"),\n\t\t\tcategory: Categories.Developer,\n\t\t\tf1: true,\n\t\t\ticon: Codicon.debugStart,\n\t\t\tmenu: {\n\t\t\t\tid: MenuId.EditorTitle,\n\t\t\t\twhen: ActiveEditorContext.isEqualTo(RuntimeExtensionsEditor.ID),\n\t\t\t\tgroup: 'navigation',\n\t\t\t}\n\t\t});\n\t}\n\n\trun(accessor: ServicesAccessor): void {\n\t\tconst nativeHostService = accessor.get(INativeHostService);\n\t\tconst dialogService = accessor.get(IDialogService);\n\t\tconst extensionService = accessor.get(IExtensionService);\n\t\tconst productService = accessor.get(IProductService);\n\t\tconst instantiationService = accessor.get(IInstantiationService);\n\t\tconst hostService = accessor.get(IHostService);\n\n\t\textensionService.getInspectPorts(ExtensionHostKind.LocalProcess, false).then(async inspectPorts => {\n\t\t\tif (inspectPorts.length === 0) {\n\t\t\t\tconst res = await dialogService.confirm({\n\t\t\t\t\tmessage: nls.localize('restart1', \"Debug Extensions\"),\n\t\t\t\t\tdetail: nls.localize('restart2', \"In order to debug extensions a restart is required. Do you want to restart '{0}' now?\", productService.nameLong),\n\t\t\t\t\tprimaryButton: nls.localize({ key: 'restart3', comment: ['&& denotes a mnemonic'] }, \"&&Restart\")\n\t\t\t\t});\n\t\t\t\tif (res.confirmed) {\n\t\t\t\t\tawait nativeHostService.relaunch({ addArgs: [`--inspect-extensions=${randomPort()}`] });\n\t\t\t\t}\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (inspectPorts.length > 1) {\n\t\t\t\t// TODO\n\t\t\t\tconsole.warn(`There are multiple extension hosts available for debugging. Picking the first one...`);\n\t\t\t}\n\n\t\t\tconst s = instantiationService.createInstance(Storage);\n\t\t\ts.storeDebugOnNewWindow(inspectPorts[0].port);\n\n\t\t\thostService.openWindow();\n\t\t});\n\t}\n}\n\nclass Storage {\n\tconstructor(@IStorageService private readonly _storageService: IStorageService,) {\n\t}\n\n\tstoreDebugOnNewWindow(targetPort: number) {\n\t\tthis._storageService.store('debugExtensionHost.debugPort', targetPort, StorageScope.APPLICATION, StorageTarget.MACHINE);\n\t}\n\n\tgetAndDeleteDebugPortIfSet(): number | undefined {\n\t\tconst port = this._storageService.getNumber('debugExtensionHost.debugPort', StorageScope.APPLICATION);\n\t\tif (port !== undefined) {\n\t\t\tthis._storageService.remove('debugExtensionHost.debugPort', StorageScope.APPLICATION);\n\t\t}\n\t\treturn port;\n\t}\n}\n\nexport class DebugExtensionsContribution extends Disposable implements IWorkbenchContribution {\n\tconstructor(\n\t\t@IDebugService private readonly _debugService: IDebugService,\n\t\t@IInstantiationService private readonly _instantiationService: IInstantiationService,\n\t\t@IProgressService _progressService: IProgressService,\n\t) {\n\t\tsuper();\n\n\t\tconst storage = this._instantiationService.createInstance(Storage);\n\t\tconst port = storage.getAndDeleteDebugPortIfSet();\n\t\tif (port !== undefined) {\n\t\t\t_progressService.withProgress({\n\t\t\t\tlocation: ProgressLocation.Notification,\n\t\t\t\ttitle: nls.localize('debugExtensionHost.progress', \"Attaching Debugger To Extension Host\"),\n\t\t\t}, async p => {\n\t\t\t\t// eslint-disable-next-line local/code-no-dangerous-type-assertions\n\t\t\t\tawait this._debugService.startDebugging(undefined, {\n\t\t\t\t\ttype: 'node',\n\t\t\t\t\tname: nls.localize('debugExtensionHost.launch.name', \"Attach Extension Host\"),\n\t\t\t\t\trequest: 'attach',\n\t\t\t\t\tport,\n\t\t\t\t\ttrace: true,\n\t\t\t\t\t// resolve source maps everywhere:\n\t\t\t\t\tresolveSourceMapLocations: null,\n\t\t\t\t\t// announces sources eagerly for the loaded scripts view:\n\t\t\t\t\teagerSources: true,\n\t\t\t\t\t// source maps of published VS Code are on the CDN and can take a while to load\n\t\t\t\t\ttimeouts: {\n\t\t\t\t\t\tsourceMapMinPause: 30_000,\n\t\t\t\t\t\tsourceMapCumulativePause: 300_000,\n\t\t\t\t\t},\n\t\t\t\t} as IConfig);\n\t\t\t});\n\t\t}\n\t}\n}\n"]}