{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/contrib/extensions/electron-browser/remoteExtensionsInit.ts","vs/workbench/contrib/extensions/electron-browser/remoteExtensionsInit.ts"],"names":[],"mappings":"AAAA;;;gGAGgG;;;;;;;;;;AAEhG,OAAO,EAAE,iBAAiB,EAAE,MAAM,yCAAyC,CAAC;AAC5E,OAAO,EAAE,qBAAqB,EAAE,MAAM,4DAA4D,CAAC;AACnG,OAAO,EAAE,mBAAmB,EAAE,MAAM,wDAAwD,CAAC;AAC7F,OAAO,EAAE,8CAA8C,EAAE,wBAAwB,EAAE,2BAA2B,EAAwB,MAAM,wEAAwE,CAAC;AACrN,OAAO,EAAE,iBAAiB,EAAE,MAAM,4EAA4E,CAAC;AAC/G,OAAO,EAAE,YAAY,EAAE,MAAM,4CAA4C,CAAC;AAC1E,OAAO,EAAE,qBAAqB,EAAE,MAAM,4DAA4D,CAAC;AACnG,OAAO,EAAE,iBAAiB,EAAE,MAAM,gEAAgE,CAAC;AACnG,OAAO,EAAE,WAAW,EAAE,MAAM,wCAAwC,CAAC;AACrE,OAAO,EAAE,kCAAkC,EAAE,MAAM,8CAA8C,CAAC;AAClG,OAAO,EAAE,+BAA+B,EAAE,MAAM,+DAA+D,CAAC;AAChH,OAAO,EAAE,+BAA+B,EAAE,MAAM,+DAA+D,CAAC;AAChH,OAAO,EAAE,eAAe,EAAE,UAAU,EAA+B,MAAM,gDAAgD,CAAC;AAC1H,OAAO,EAAE,mBAAmB,EAAE,MAAM,wDAAwD,CAAC;AAC7F,OAAO,EAAE,wBAAwB,EAAE,MAAM,gEAAgE,CAAC;AAC1G,OAAO,EAAE,6BAA6B,EAAE,MAAM,4DAA4D,CAAC;AAC3G,OAAO,EAAE,mCAAmC,EAAE,MAAM,+DAA+D,CAAC;AACpH,OAAO,EAAmB,8BAA8B,EAAE,mCAAmC,EAAgB,MAAM,0DAA0D,CAAC;AAC9K,OAAO,EAAE,uBAAuB,EAAE,MAAM,sEAAsE,CAAC;AAE/G,OAAO,EAAE,sBAAsB,EAAE,MAAM,2DAA2D,CAAC;AACnG,OAAO,EAAE,iCAAiC,EAAE,MAAM,qEAAqE,CAAC;AACxH,OAAO,EAAE,mCAAmC,EAAE,MAAM,2EAA2E,CAAC;AAChI,OAAO,EAAE,mBAAmB,EAAE,MAAM,uDAAuD,CAAC;AAC5F,OAAO,EAAE,2BAA2B,EAAE,MAAM,yBAAyB,CAAC;AAE/D,IAAM,mCAAmC,GAAzC,MAAM,mCAAmC;IAC/C,YACuC,kBAAuC,EAC3B,8BAA+D,EACtE,uBAAiD,EACxC,gCAAmE,EACzE,0BAAuD,EACvE,UAAuB,EACb,oBAA2C;QAN7C,uBAAkB,GAAlB,kBAAkB,CAAqB;QAC3B,mCAA8B,GAA9B,8BAA8B,CAAiC;QACtE,4BAAuB,GAAvB,uBAAuB,CAA0B;QACxC,qCAAgC,GAAhC,gCAAgC,CAAmC;QACzE,+BAA0B,GAA1B,0BAA0B,CAA6B;QACvE,eAAU,GAAV,UAAU,CAAa;QACb,yBAAoB,GAApB,oBAAoB,CAAuB;QAEnF,IAAI,CAAC,2CAA2C,EAAE,CAAC;QACnD,IAAI,CAAC,6BAA6B,EAAE,CAAC;IACtC,CAAC;IAEO,KAAK,CAAC,2CAA2C;QACxD,IAAI,CAAC,IAAI,CAAC,kBAAkB,CAAC,aAAa,EAAE,EAAE,CAAC;YAC9C,OAAO;QACR,CAAC;QAED,IAAI,CAAC,IAAI,CAAC,gCAAgC,CAAC,+BAA+B,EAAE,CAAC;YAC5E,IAAI,CAAC,UAAU,CAAC,KAAK,CAAC,iDAAiD,CAAC,CAAC;YACzE,OAAO;QACR,CAAC;QAED,IAAI,CAAC,IAAI,CAAC,gCAAgC,CAAC,8BAA8B,EAAE,CAAC;YAC3E,IAAI,CAAC,UAAU,CAAC,KAAK,CAAC,gDAAgD,CAAC,CAAC;YACxE,OAAO;QACR,CAAC;QAED,MAAM,YAAY,GAAG,IAAI,CAAC,oBAAoB,CAAC,QAAQ,CAAW,kCAAkC,CAAC,CAAC;QACtG,IAAI,CAAC,YAAY,EAAE,MAAM,EAAE,CAAC;YAC3B,OAAO;QACR,CAAC;QAED,MAAM,uBAAuB,GAAG,MAAM,IAAI,CAAC,0BAA0B,CAAC,UAAU,CAAC,IAAI,CAAC,gCAAgC,CAAC,8BAA8B,CAAC,CAAC;QACvJ,MAAM,wBAAwB,GAAG,MAAM,IAAI,CAAC,0BAA0B,CAAC,UAAU,CAAC,IAAI,CAAC,gCAAgC,CAAC,+BAA+B,CAAC,CAAC;QACzJ,MAAM,mBAAmB,GAAG,uBAAuB;aACjD,MAAM,CAAC,GAAG,CAAC,EAAE,CAAC,YAAY,CAAC,IAAI,CAAC,EAAE,CAAC,EAAE,CAAC,iBAAiB,CAAC,GAAG,CAAC,UAAU,EAAE,EAAE,EAAE,EAAE,CAAC,CAAC,CAAC;aACjF,MAAM,CAAC,GAAG,CAAC,EAAE,CAAC,CAAC,wBAAwB,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,CAAC,iBAAiB,CAAC,CAAC,CAAC,UAAU,EAAE,GAAG,CAAC,UAAU,CAAC,CAAC,CAAC,CAAC;QAGtG,IAAI,CAAC,mBAAmB,CAAC,MAAM,EAAE,CAAC;YACjC,OAAO;QACR,CAAC;QAED,MAAM,OAAO,CAAC,UAAU,CAAC,mBAAmB,CAAC,GAAG,CAAC,GAAG,CAAC,EAAE;YACtD,IAAI,CAAC,0BAA0B,CAAC,eAAe,CAAC,GAAG,EAAE,IAAI,CAAC,gCAAgC,CAAC,+BAAgC,EAAE,EAAE,+BAA+B,EAAE,IAAI,EAAE,CAAC,CAAC;QACzK,CAAC,CAAC,CAAC,CAAC;IACL,CAAC;IAEO,KAAK,CAAC,6BAA6B;QAC1C,IAAI,CAAC,IAAI,CAAC,kBAAkB,CAAC,aAAa,EAAE,EAAE,CAAC;YAC9C,OAAO;QACR,CAAC;QAED,MAAM,EAAE,MAAM,EAAE,GAAG,MAAM,IAAI,CAAC,8BAA8B,CAAC,mBAAmB,EAAE,CAAC;QACnF,IAAI,MAAM,CAAC,MAAM,KAAK,CAAC,EAAE,CAAC;YACzB,IAAI,CAAC,UAAU,CAAC,KAAK,CAAC,mCAAmC,CAAC,CAAC;YAC3D,OAAO;QACR,CAAC;QAED,IAAI,CAAC,IAAI,CAAC,gCAAgC,CAAC,+BAA+B,EAAE,CAAC;YAC5E,IAAI,CAAC,UAAU,CAAC,KAAK,CAAC,iDAAiD,CAAC,CAAC;YACzE,OAAO;QACR,CAAC;QAED,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC,eAAe,MAAM,CAAC,MAAM,kCAAkC,CAAC,CAAC;QACrF,MAAM,iBAAiB,GAAG,MAAM,IAAI,CAAC,uBAAuB,CAAC,aAAa,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,EAAE,EAAE,EAAE,EAAE,EAAE,CAAC,CAAC,EAAE,EAAE,EAAE,CAAC,CAAC,EAAE,iBAAiB,CAAC,IAAI,CAAC,CAAC;QACrI,MAAM,oBAAoB,GAA2B,EAAE,CAAC;QACxD,KAAK,MAAM,EAAE,EAAE,EAAE,cAAc,EAAE,IAAI,MAAM,EAAE,CAAC;YAC7C,MAAM,SAAS,GAAG,iBAAiB,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,CAAC,iBAAiB,CAAC,CAAC,CAAC,UAAU,EAAE,EAAE,EAAE,EAAE,CAAC,CAAC,CAAC;YACvF,IAAI,SAAS,EAAE,CAAC;gBACf,oBAAoB,CAAC,IAAI,CAAC;oBACzB,SAAS,EAAE,OAAO,EAAE;wBACnB,GAAG,cAAc;wBACjB,yBAAyB,EAAE,IAAI;qBAC/B;iBACD,CAAC,CAAC;YACJ,CAAC;iBAAM,CAAC;gBACP,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC,6BAA6B,EAAE,2CAA2C,CAAC,CAAC;YAClG,CAAC;QACF,CAAC;QAED,IAAI,oBAAoB,CAAC,MAAM,EAAE,CAAC;YACjC,MAAM,OAAO,CAAC,UAAU,CAAC,oBAAoB,CAAC,GAAG,CAAC,CAAC,CAAC,EAAE,CAAC,IAAI,CAAC,gCAAgC,CAAC,+BAAgC,CAAC,0BAA0B,CAAC,kBAAkB,CAAC,CAAC,CAAC,SAAS,EAAE,CAAC,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC;QACvM,CAAC;IACF,CAAC;CACD,CAAA;AAvFY,mCAAmC;IAE7C,WAAA,mBAAmB,CAAA;IACnB,WAAA,+BAA+B,CAAA;IAC/B,WAAA,wBAAwB,CAAA;IACxB,WAAA,iCAAiC,CAAA;IACjC,WAAA,2BAA2B,CAAA;IAC3B,WAAA,WAAW,CAAA;IACX,WAAA,qBAAqB,CAAA;GARX,mCAAmC,CAuF/C;;AAEM,IAAM,uCAAuC,GAA7C,MAAM,uCAAuC;IACnD,YACqD,gCAAmE,EACrF,cAA+B,EAC3B,kBAAuC,EACvB,kCAAuE,EACrF,oBAA2C,EACrD,UAAuB,EACZ,qBAA6C,EACpC,8BAA+D,EAChE,6BAA6D;QAR1D,qCAAgC,GAAhC,gCAAgC,CAAmC;QACrF,mBAAc,GAAd,cAAc,CAAiB;QAC3B,uBAAkB,GAAlB,kBAAkB,CAAqB;QACvB,uCAAkC,GAAlC,kCAAkC,CAAqC;QACrF,yBAAoB,GAApB,oBAAoB,CAAuB;QACrD,eAAU,GAAV,UAAU,CAAa;QACZ,0BAAqB,GAArB,qBAAqB,CAAwB;QACpC,mCAA8B,GAA9B,8BAA8B,CAAiC;QAChE,kCAA6B,GAA7B,6BAA6B,CAAgC;QAE9G,IAAI,CAAC,0BAA0B,EAAE,CAAC;IACnC,CAAC;IAEO,KAAK,CAAC,0BAA0B;QACvC,MAAM,UAAU,GAAG,IAAI,CAAC,kBAAkB,CAAC,aAAa,EAAE,CAAC;QAC3D,MAAM,8BAA8B,GAAG,IAAI,CAAC,gCAAgC,CAAC,8BAA8B,CAAC;QAC5G,MAAM,+BAA+B,GAAG,IAAI,CAAC,gCAAgC,CAAC,+BAA+B,CAAC;QAC9G,4BAA4B;QAC5B,IAAI,CAAC,UAAU,IAAI,CAAC,+BAA+B,EAAE,CAAC;YACrD,OAAO;QACR,CAAC;QACD,4BAA4B;QAC5B,IAAI,CAAC,8BAA8B,EAAE,CAAC;YACrC,OAAO;QACR,CAAC;QACD,2CAA2C;QAC3C,IAAI,CAAC,IAAI,CAAC,kCAAkC,CAAC,iBAAiB,EAAE,CAAC;YAChE,OAAO;QACR,CAAC;QACD,MAAM,sBAAsB,GAAG,GAAG,UAAU,IAAI,UAAU,CAAC,eAAe,EAAE,CAAC;QAC7E,oCAAoC;QACpC,IAAI,CAAC,IAAI,CAAC,cAAc,CAAC,UAAU,CAAC,sBAAsB,qCAA4B,IAAI,CAAC,EAAE,CAAC;YAC7F,IAAI,CAAC,UAAU,CAAC,KAAK,CAAC,0GAA0G,CAAC,CAAC;YAClI,OAAO;QACR,CAAC;QACD,IAAI,CAAC,cAAc,CAAC,KAAK,CAAC,sBAAsB,EAAE,KAAK,mEAAkD,CAAC;QAC1G,4BAA4B;QAC5B,IAAI,CAAC,IAAI,CAAC,cAAc,CAAC,KAAK,gCAAwB,EAAE,CAAC;YACxD,IAAI,CAAC,UAAU,CAAC,KAAK,CAAC,mFAAmF,CAAC,CAAC;YAC3G,OAAO;QACR,CAAC;QACD,kCAAkC;QAClC,IAAI,CAAC,IAAI,CAAC,6BAA6B,CAAC,SAAS,EAAE,EAAE,CAAC;YACrD,OAAO;QACR,CAAC;QACD,6CAA6C;QAC7C,MAAM,iBAAiB,GAAG,MAAM,IAAI,CAAC,8BAA8B,CAAC,gBAAgB,CAAC,UAAU,CAAC,eAAe,CAAC,CAAC;QACjH,IAAI,CAAC,iBAAiB,CAAC,OAAO,EAAE,qBAAqB,EAAE,CAAC;YACvD,OAAO;QACR,CAAC;QAED,MAAM,QAAQ,GAAG,MAAM,IAAI,CAAC,qBAAqB,CAAC,WAAW,CAAC,iBAAiB,CAAC,OAAO,EAAE,qBAAqB,CAAC,UAAU,CAAC,CAAC;QAC3H,MAAM,OAAO,GAAG,QAAQ,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,EAAE,KAAK,iBAAiB,CAAC,OAAO,EAAE,qBAAqB,EAAE,EAAE,CAAC,CAAC;QAClG,6BAA6B;QAC7B,IAAI,CAAC,OAAO,EAAE,CAAC;YACd,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC,gGAAgG,EAAE,iBAAiB,CAAC,OAAO,CAAC,qBAAqB,CAAC,EAAE,CAAC,CAAC;YAC3K,OAAO;QACR,CAAC;QAED,MAAM,uBAAuB,GAAG,IAAI,CAAC,oBAAoB,CAAC,cAAc,CAAC,uBAAuB,EAAE,IAAI,CAAC,kCAAkC,CAAC,iBAAiB,CAAC,GAAG,CAAC,CAAC;QACjK,uBAAuB,CAAC,YAAY,CAAC,OAAO,CAAC,WAAW,EAAE,iBAAiB,CAAC,OAAO,CAAC,qBAAqB,CAAC,UAAU,CAAC,CAAC;QACtH,MAAM,QAAQ,GAAG,MAAM,uBAAuB,CAAC,YAAY,6CAA0B,IAAI,CAAC,CAAC;QAE3F,MAAM,iBAAiB,GAAG,IAAI,iBAAiB,EAAE,CAAC;QAClD,iBAAiB,CAAC,GAAG,CAAC,2BAA2B,EAAE,+BAA+B,CAAC,0BAA0B,CAAC,CAAC;QAC/G,MAAM,oBAAoB,GAAG,IAAI,CAAC,oBAAoB,CAAC,WAAW,CAAC,iBAAiB,CAAC,CAAC;QACtF,MAAM,8BAA8B,GAAG,oBAAoB,CAAC,cAAc,CAAC,2BAA2B,CAAC,CAAC;QAExG,MAAM,8BAA8B,CAAC,UAAU,CAAC,QAAQ,CAAC,CAAC;IAC3D,CAAC;CACD,CAAA;AAxEY,uCAAuC;IAEjD,WAAA,iCAAiC,CAAA;IACjC,WAAA,eAAe,CAAA;IACf,WAAA,mBAAmB,CAAA;IACnB,WAAA,mCAAmC,CAAA;IACnC,WAAA,qBAAqB,CAAA;IACrB,WAAA,WAAW,CAAA;IACX,WAAA,sBAAsB,CAAA;IACtB,WAAA,+BAA+B,CAAA;IAC/B,WAAA,8BAA8B,CAAA;GAVpB,uCAAuC,CAwEnD;;AAED,IAAM,2BAA2B,GAAjC,MAAM,2BAA4B,SAAQ,6BAA6B;IAEtE,YAC8B,0BAAuD,EAC/C,kCAAuE,EAC9F,WAAyB,EACb,uBAAiD,EACtD,kBAAuC,EAC/C,UAAuB,EACf,kBAAuC,EACjB,uBAAiD,EAC3E,cAA+B,EACM,kCAAuE;QAE7H,KAAK,CAAC,0BAA0B,EAAE,kCAAkC,EAAE,WAAW,EAAE,uBAAuB,EAAE,kBAAkB,EAAE,UAAU,EAAE,cAAc,EAAE,kBAAkB,CAAC,CAAC;QAJrI,4BAAuB,GAAvB,uBAAuB,CAA0B;QAEtC,uCAAkC,GAAlC,kCAAkC,CAAqC;IAG9H,CAAC;IAEkB,KAAK,CAAC,YAAY,CAAC,cAA+B;QACpE,MAAM,gBAAgB,GAAG,MAAM,IAAI,CAAC,eAAe,CAAC,cAAc,CAAC,CAAC;QACpE,IAAI,CAAC,gBAAgB,EAAE,CAAC;YACvB,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC,kEAAkE,CAAC,CAAC;YACzF,OAAO;QACR,CAAC;QACD,MAAM,mBAAmB,GAAG,MAAM,IAAI,CAAC,0BAA0B,CAAC,YAAY,EAAE,CAAC;QACjF,MAAM,EAAE,aAAa,EAAE,GAAG,IAAI,CAAC,eAAe,CAAC,gBAAgB,EAAE,mBAAmB,CAAC,CAAC;QACtF,IAAI,CAAC,aAAa,CAAC,MAAM,EAAE,CAAC;YAC3B,IAAI,CAAC,UAAU,CAAC,KAAK,CAAC,sCAAsC,CAAC,CAAC;YAC9D,OAAO;QACR,CAAC;QACD,MAAM,cAAc,GAAG,MAAM,IAAI,CAAC,0BAA0B,CAAC,iBAAiB,EAAE,CAAC;QACjF,MAAM,mBAAmB,GAAG,MAAM,IAAI,CAAC,uBAAuB,CAAC,aAAa,CAAC,aAAa,EAAE,EAAE,cAAc,EAAE,UAAU,EAAE,IAAI,EAAE,EAAE,iBAAiB,CAAC,IAAI,CAAC,CAAC;QAC1J,IAAI,mBAAmB,CAAC,MAAM,EAAE,CAAC;YAChC,MAAM,OAAO,CAAC,UAAU,CAAC,mBAAmB,CAAC,GAAG,CAAC,KAAK,EAAC,CAAC,EAAC,EAAE;gBAC1D,MAAM,QAAQ,GAAG,MAAM,IAAI,CAAC,uBAAuB,CAAC,WAAW,CAAC,CAAC,EAAE,iBAAiB,CAAC,IAAI,CAAC,CAAC;gBAC3F,IAAI,QAAQ,IAAI,IAAI,CAAC,kCAAkC,CAAC,qBAAqB,CAAC,QAAQ,CAAC,EAAE,CAAC;oBACzF,MAAM,eAAe,GAAG,gBAAgB,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,CAAC,iBAAiB,CAAC,CAAC,CAAC,UAAU,EAAE,CAAC,CAAC,UAAU,CAAC,CAAC,CAAC;oBAClG,MAAM,IAAI,CAAC,0BAA0B,CAAC,kBAAkB,CAAC,CAAC,EAAE,EAAE,wBAAwB,EAAE,eAAe,EAAE,UAAU,EAAE,+BAA+B,EAAE,IAAI,EAAE,OAAO,EAAE,EAAE,CAAC,8CAA8C,CAAC,EAAE,IAAI,EAAE,EAAE,CAAC,CAAC;gBACpO,CAAC;YACF,CAAC,CAAC,CAAC,CAAC;QACL,CAAC;IACF,CAAC;CACD,CAAA;AAzCK,2BAA2B;IAG9B,WAAA,2BAA2B,CAAA;IAC3B,WAAA,mCAAmC,CAAA;IACnC,WAAA,YAAY,CAAA;IACZ,WAAA,wBAAwB,CAAA;IACxB,WAAA,mBAAmB,CAAA;IACnB,WAAA,WAAW,CAAA;IACX,WAAA,mBAAmB,CAAA;IACnB,WAAA,wBAAwB,CAAA;IACxB,WAAA,eAAe,CAAA;IACf,WAAA,mCAAmC,CAAA;GAZhC,2BAA2B,CAyChC","file":"remoteExtensionsInit.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { CancellationToken } from '../../../../base/common/cancellation.js';\nimport { IConfigurationService } from '../../../../platform/configuration/common/configuration.js';\nimport { IEnvironmentService } from '../../../../platform/environment/common/environment.js';\nimport { EXTENSION_INSTALL_SKIP_PUBLISHER_TRUST_CONTEXT, IExtensionGalleryService, IExtensionManagementService, InstallExtensionInfo } from '../../../../platform/extensionManagement/common/extensionManagement.js';\nimport { areSameExtensions } from '../../../../platform/extensionManagement/common/extensionManagementUtil.js';\nimport { IFileService } from '../../../../platform/files/common/files.js';\nimport { IInstantiationService } from '../../../../platform/instantiation/common/instantiation.js';\nimport { ServiceCollection } from '../../../../platform/instantiation/common/serviceCollection.js';\nimport { ILogService } from '../../../../platform/log/common/log.js';\nimport { REMOTE_DEFAULT_IF_LOCAL_EXTENSIONS } from '../../../../platform/remote/common/remote.js';\nimport { IRemoteAuthorityResolverService } from '../../../../platform/remote/common/remoteAuthorityResolver.js';\nimport { IRemoteExtensionsScannerService } from '../../../../platform/remote/common/remoteExtensionsScanner.js';\nimport { IStorageService, IS_NEW_KEY, StorageScope, StorageTarget } from '../../../../platform/storage/common/storage.js';\nimport { IUriIdentityService } from '../../../../platform/uriIdentity/common/uriIdentity.js';\nimport { IUserDataProfilesService } from '../../../../platform/userDataProfile/common/userDataProfile.js';\nimport { AbstractExtensionsInitializer } from '../../../../platform/userDataSync/common/extensionsSync.js';\nimport { IIgnoredExtensionsManagementService } from '../../../../platform/userDataSync/common/ignoredExtensions.js';\nimport { IRemoteUserData, IUserDataSyncEnablementService, IUserDataSyncStoreManagementService, SyncResource } from '../../../../platform/userDataSync/common/userDataSync.js';\nimport { UserDataSyncStoreClient } from '../../../../platform/userDataSync/common/userDataSyncStoreService.js';\nimport { IWorkbenchContribution } from '../../../common/contributions.js';\nimport { IAuthenticationService } from '../../../services/authentication/common/authentication.js';\nimport { IExtensionManagementServerService } from '../../../services/extensionManagement/common/extensionManagement.js';\nimport { IExtensionManifestPropertiesService } from '../../../services/extensions/common/extensionManifestPropertiesService.js';\nimport { IRemoteAgentService } from '../../../services/remote/common/remoteAgentService.js';\nimport { IExtensionsWorkbenchService } from '../common/extensions.js';\n\nexport class InstallRemoteExtensionsContribution implements IWorkbenchContribution {\n\tconstructor(\n\t\t@IRemoteAgentService private readonly remoteAgentService: IRemoteAgentService,\n\t\t@IRemoteExtensionsScannerService private readonly remoteExtensionsScannerService: IRemoteExtensionsScannerService,\n\t\t@IExtensionGalleryService private readonly extensionGalleryService: IExtensionGalleryService,\n\t\t@IExtensionManagementServerService private readonly extensionManagementServerService: IExtensionManagementServerService,\n\t\t@IExtensionsWorkbenchService private readonly extensionsWorkbenchService: IExtensionsWorkbenchService,\n\t\t@ILogService private readonly logService: ILogService,\n\t\t@IConfigurationService private readonly configurationService: IConfigurationService\n\t) {\n\t\tthis.installExtensionsIfInstalledLocallyInRemote();\n\t\tthis.installFailedRemoteExtensions();\n\t}\n\n\tprivate async installExtensionsIfInstalledLocallyInRemote(): Promise<void> {\n\t\tif (!this.remoteAgentService.getConnection()) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.extensionManagementServerService.remoteExtensionManagementServer) {\n\t\t\tthis.logService.error('No remote extension management server available');\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.extensionManagementServerService.localExtensionManagementServer) {\n\t\t\tthis.logService.error('No local extension management server available');\n\t\t\treturn;\n\t\t}\n\n\t\tconst settingValue = this.configurationService.getValue<string[]>(REMOTE_DEFAULT_IF_LOCAL_EXTENSIONS);\n\t\tif (!settingValue?.length) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst alreadyInstalledLocally = await this.extensionsWorkbenchService.queryLocal(this.extensionManagementServerService.localExtensionManagementServer);\n\t\tconst alreadyInstalledRemotely = await this.extensionsWorkbenchService.queryLocal(this.extensionManagementServerService.remoteExtensionManagementServer);\n\t\tconst extensionsToInstall = alreadyInstalledLocally\n\t\t\t.filter(ext => settingValue.some(id => areSameExtensions(ext.identifier, { id })))\n\t\t\t.filter(ext => !alreadyInstalledRemotely.some(e => areSameExtensions(e.identifier, ext.identifier)));\n\n\n\t\tif (!extensionsToInstall.length) {\n\t\t\treturn;\n\t\t}\n\n\t\tawait Promise.allSettled(extensionsToInstall.map(ext => {\n\t\t\tthis.extensionsWorkbenchService.installInServer(ext, this.extensionManagementServerService.remoteExtensionManagementServer!, { donotIncludePackAndDependencies: true });\n\t\t}));\n\t}\n\n\tprivate async installFailedRemoteExtensions(): Promise<void> {\n\t\tif (!this.remoteAgentService.getConnection()) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst { failed } = await this.remoteExtensionsScannerService.whenExtensionsReady();\n\t\tif (failed.length === 0) {\n\t\t\tthis.logService.trace('No extensions relayed from server');\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.extensionManagementServerService.remoteExtensionManagementServer) {\n\t\t\tthis.logService.error('No remote extension management server available');\n\t\t\treturn;\n\t\t}\n\n\t\tthis.logService.info(`Installing '${failed.length}' extensions relayed from server`);\n\t\tconst galleryExtensions = await this.extensionGalleryService.getExtensions(failed.map(({ id }) => ({ id })), CancellationToken.None);\n\t\tconst installExtensionInfo: InstallExtensionInfo[] = [];\n\t\tfor (const { id, installOptions } of failed) {\n\t\t\tconst extension = galleryExtensions.find(e => areSameExtensions(e.identifier, { id }));\n\t\t\tif (extension) {\n\t\t\t\tinstallExtensionInfo.push({\n\t\t\t\t\textension, options: {\n\t\t\t\t\t\t...installOptions,\n\t\t\t\t\t\tdownloadExtensionsLocally: true,\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tthis.logService.warn(`Relayed failed extension '${id}' from server is not found in the gallery`);\n\t\t\t}\n\t\t}\n\n\t\tif (installExtensionInfo.length) {\n\t\t\tawait Promise.allSettled(installExtensionInfo.map(e => this.extensionManagementServerService.remoteExtensionManagementServer!.extensionManagementService.installFromGallery(e.extension, e.options)));\n\t\t}\n\t}\n}\n\nexport class RemoteExtensionsInitializerContribution implements IWorkbenchContribution {\n\tconstructor(\n\t\t@IExtensionManagementServerService private readonly extensionManagementServerService: IExtensionManagementServerService,\n\t\t@IStorageService private readonly storageService: IStorageService,\n\t\t@IRemoteAgentService private readonly remoteAgentService: IRemoteAgentService,\n\t\t@IUserDataSyncStoreManagementService private readonly userDataSyncStoreManagementService: IUserDataSyncStoreManagementService,\n\t\t@IInstantiationService private readonly instantiationService: IInstantiationService,\n\t\t@ILogService private readonly logService: ILogService,\n\t\t@IAuthenticationService private readonly authenticationService: IAuthenticationService,\n\t\t@IRemoteAuthorityResolverService private readonly remoteAuthorityResolverService: IRemoteAuthorityResolverService,\n\t\t@IUserDataSyncEnablementService private readonly userDataSyncEnablementService: IUserDataSyncEnablementService,\n\t) {\n\t\tthis.initializeRemoteExtensions();\n\t}\n\n\tprivate async initializeRemoteExtensions(): Promise<void> {\n\t\tconst connection = this.remoteAgentService.getConnection();\n\t\tconst localExtensionManagementServer = this.extensionManagementServerService.localExtensionManagementServer;\n\t\tconst remoteExtensionManagementServer = this.extensionManagementServerService.remoteExtensionManagementServer;\n\t\t// Skip: Not a remote window\n\t\tif (!connection || !remoteExtensionManagementServer) {\n\t\t\treturn;\n\t\t}\n\t\t// Skip: Not a native window\n\t\tif (!localExtensionManagementServer) {\n\t\t\treturn;\n\t\t}\n\t\t// Skip: No UserdataSyncStore is configured\n\t\tif (!this.userDataSyncStoreManagementService.userDataSyncStore) {\n\t\t\treturn;\n\t\t}\n\t\tconst newRemoteConnectionKey = `${IS_NEW_KEY}.${connection.remoteAuthority}`;\n\t\t// Skip: Not a new remote connection\n\t\tif (!this.storageService.getBoolean(newRemoteConnectionKey, StorageScope.APPLICATION, true)) {\n\t\t\tthis.logService.trace(`Skipping initializing remote extensions because the window with this remote authority was opened before.`);\n\t\t\treturn;\n\t\t}\n\t\tthis.storageService.store(newRemoteConnectionKey, false, StorageScope.APPLICATION, StorageTarget.MACHINE);\n\t\t// Skip: Not a new workspace\n\t\tif (!this.storageService.isNew(StorageScope.WORKSPACE)) {\n\t\t\tthis.logService.trace(`Skipping initializing remote extensions because this workspace was opened before.`);\n\t\t\treturn;\n\t\t}\n\t\t// Skip: Settings Sync is disabled\n\t\tif (!this.userDataSyncEnablementService.isEnabled()) {\n\t\t\treturn;\n\t\t}\n\t\t// Skip: No account is provided to initialize\n\t\tconst resolvedAuthority = await this.remoteAuthorityResolverService.resolveAuthority(connection.remoteAuthority);\n\t\tif (!resolvedAuthority.options?.authenticationSession) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst sessions = await this.authenticationService.getSessions(resolvedAuthority.options?.authenticationSession.providerId);\n\t\tconst session = sessions.find(s => s.id === resolvedAuthority.options?.authenticationSession?.id);\n\t\t// Skip: Session is not found\n\t\tif (!session) {\n\t\t\tthis.logService.info('Skipping initializing remote extensions because the account with given session id is not found', resolvedAuthority.options.authenticationSession.id);\n\t\t\treturn;\n\t\t}\n\n\t\tconst userDataSyncStoreClient = this.instantiationService.createInstance(UserDataSyncStoreClient, this.userDataSyncStoreManagementService.userDataSyncStore.url);\n\t\tuserDataSyncStoreClient.setAuthToken(session.accessToken, resolvedAuthority.options.authenticationSession.providerId);\n\t\tconst userData = await userDataSyncStoreClient.readResource(SyncResource.Extensions, null);\n\n\t\tconst serviceCollection = new ServiceCollection();\n\t\tserviceCollection.set(IExtensionManagementService, remoteExtensionManagementServer.extensionManagementService);\n\t\tconst instantiationService = this.instantiationService.createChild(serviceCollection);\n\t\tconst extensionsToInstallInitializer = instantiationService.createInstance(RemoteExtensionsInitializer);\n\n\t\tawait extensionsToInstallInitializer.initialize(userData);\n\t}\n}\n\nclass RemoteExtensionsInitializer extends AbstractExtensionsInitializer {\n\n\tconstructor(\n\t\t@IExtensionManagementService extensionManagementService: IExtensionManagementService,\n\t\t@IIgnoredExtensionsManagementService ignoredExtensionsManagementService: IIgnoredExtensionsManagementService,\n\t\t@IFileService fileService: IFileService,\n\t\t@IUserDataProfilesService userDataProfilesService: IUserDataProfilesService,\n\t\t@IEnvironmentService environmentService: IEnvironmentService,\n\t\t@ILogService logService: ILogService,\n\t\t@IUriIdentityService uriIdentityService: IUriIdentityService,\n\t\t@IExtensionGalleryService private readonly extensionGalleryService: IExtensionGalleryService,\n\t\t@IStorageService storageService: IStorageService,\n\t\t@IExtensionManifestPropertiesService private readonly extensionManifestPropertiesService: IExtensionManifestPropertiesService,\n\t) {\n\t\tsuper(extensionManagementService, ignoredExtensionsManagementService, fileService, userDataProfilesService, environmentService, logService, storageService, uriIdentityService);\n\t}\n\n\tprotected override async doInitialize(remoteUserData: IRemoteUserData): Promise<void> {\n\t\tconst remoteExtensions = await this.parseExtensions(remoteUserData);\n\t\tif (!remoteExtensions) {\n\t\t\tthis.logService.info('No synced extensions exist while initializing remote extensions.');\n\t\t\treturn;\n\t\t}\n\t\tconst installedExtensions = await this.extensionManagementService.getInstalled();\n\t\tconst { newExtensions } = this.generatePreview(remoteExtensions, installedExtensions);\n\t\tif (!newExtensions.length) {\n\t\t\tthis.logService.trace('No new remote extensions to install.');\n\t\t\treturn;\n\t\t}\n\t\tconst targetPlatform = await this.extensionManagementService.getTargetPlatform();\n\t\tconst extensionsToInstall = await this.extensionGalleryService.getExtensions(newExtensions, { targetPlatform, compatible: true }, CancellationToken.None);\n\t\tif (extensionsToInstall.length) {\n\t\t\tawait Promise.allSettled(extensionsToInstall.map(async e => {\n\t\t\t\tconst manifest = await this.extensionGalleryService.getManifest(e, CancellationToken.None);\n\t\t\t\tif (manifest && this.extensionManifestPropertiesService.canExecuteOnWorkspace(manifest)) {\n\t\t\t\t\tconst syncedExtension = remoteExtensions.find(e => areSameExtensions(e.identifier, e.identifier));\n\t\t\t\t\tawait this.extensionManagementService.installFromGallery(e, { installPreReleaseVersion: syncedExtension?.preRelease, donotIncludePackAndDependencies: true, context: { [EXTENSION_INSTALL_SKIP_PUBLISHER_TRUST_CONTEXT]: true } });\n\t\t\t\t}\n\t\t\t}));\n\t\t}\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { CancellationToken } from '../../../../base/common/cancellation.js';\nimport { IConfigurationService } from '../../../../platform/configuration/common/configuration.js';\nimport { IEnvironmentService } from '../../../../platform/environment/common/environment.js';\nimport { EXTENSION_INSTALL_SKIP_PUBLISHER_TRUST_CONTEXT, IExtensionGalleryService, IExtensionManagementService, InstallExtensionInfo } from '../../../../platform/extensionManagement/common/extensionManagement.js';\nimport { areSameExtensions } from '../../../../platform/extensionManagement/common/extensionManagementUtil.js';\nimport { IFileService } from '../../../../platform/files/common/files.js';\nimport { IInstantiationService } from '../../../../platform/instantiation/common/instantiation.js';\nimport { ServiceCollection } from '../../../../platform/instantiation/common/serviceCollection.js';\nimport { ILogService } from '../../../../platform/log/common/log.js';\nimport { REMOTE_DEFAULT_IF_LOCAL_EXTENSIONS } from '../../../../platform/remote/common/remote.js';\nimport { IRemoteAuthorityResolverService } from '../../../../platform/remote/common/remoteAuthorityResolver.js';\nimport { IRemoteExtensionsScannerService } from '../../../../platform/remote/common/remoteExtensionsScanner.js';\nimport { IStorageService, IS_NEW_KEY, StorageScope, StorageTarget } from '../../../../platform/storage/common/storage.js';\nimport { IUriIdentityService } from '../../../../platform/uriIdentity/common/uriIdentity.js';\nimport { IUserDataProfilesService } from '../../../../platform/userDataProfile/common/userDataProfile.js';\nimport { AbstractExtensionsInitializer } from '../../../../platform/userDataSync/common/extensionsSync.js';\nimport { IIgnoredExtensionsManagementService } from '../../../../platform/userDataSync/common/ignoredExtensions.js';\nimport { IRemoteUserData, IUserDataSyncEnablementService, IUserDataSyncStoreManagementService, SyncResource } from '../../../../platform/userDataSync/common/userDataSync.js';\nimport { UserDataSyncStoreClient } from '../../../../platform/userDataSync/common/userDataSyncStoreService.js';\nimport { IWorkbenchContribution } from '../../../common/contributions.js';\nimport { IAuthenticationService } from '../../../services/authentication/common/authentication.js';\nimport { IExtensionManagementServerService } from '../../../services/extensionManagement/common/extensionManagement.js';\nimport { IExtensionManifestPropertiesService } from '../../../services/extensions/common/extensionManifestPropertiesService.js';\nimport { IRemoteAgentService } from '../../../services/remote/common/remoteAgentService.js';\nimport { IExtensionsWorkbenchService } from '../common/extensions.js';\n\nexport class InstallRemoteExtensionsContribution implements IWorkbenchContribution {\n\tconstructor(\n\t\t@IRemoteAgentService private readonly remoteAgentService: IRemoteAgentService,\n\t\t@IRemoteExtensionsScannerService private readonly remoteExtensionsScannerService: IRemoteExtensionsScannerService,\n\t\t@IExtensionGalleryService private readonly extensionGalleryService: IExtensionGalleryService,\n\t\t@IExtensionManagementServerService private readonly extensionManagementServerService: IExtensionManagementServerService,\n\t\t@IExtensionsWorkbenchService private readonly extensionsWorkbenchService: IExtensionsWorkbenchService,\n\t\t@ILogService private readonly logService: ILogService,\n\t\t@IConfigurationService private readonly configurationService: IConfigurationService\n\t) {\n\t\tthis.installExtensionsIfInstalledLocallyInRemote();\n\t\tthis.installFailedRemoteExtensions();\n\t}\n\n\tprivate async installExtensionsIfInstalledLocallyInRemote(): Promise<void> {\n\t\tif (!this.remoteAgentService.getConnection()) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.extensionManagementServerService.remoteExtensionManagementServer) {\n\t\t\tthis.logService.error('No remote extension management server available');\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.extensionManagementServerService.localExtensionManagementServer) {\n\t\t\tthis.logService.error('No local extension management server available');\n\t\t\treturn;\n\t\t}\n\n\t\tconst settingValue = this.configurationService.getValue<string[]>(REMOTE_DEFAULT_IF_LOCAL_EXTENSIONS);\n\t\tif (!settingValue?.length) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst alreadyInstalledLocally = await this.extensionsWorkbenchService.queryLocal(this.extensionManagementServerService.localExtensionManagementServer);\n\t\tconst alreadyInstalledRemotely = await this.extensionsWorkbenchService.queryLocal(this.extensionManagementServerService.remoteExtensionManagementServer);\n\t\tconst extensionsToInstall = alreadyInstalledLocally\n\t\t\t.filter(ext => settingValue.some(id => areSameExtensions(ext.identifier, { id })))\n\t\t\t.filter(ext => !alreadyInstalledRemotely.some(e => areSameExtensions(e.identifier, ext.identifier)));\n\n\n\t\tif (!extensionsToInstall.length) {\n\t\t\treturn;\n\t\t}\n\n\t\tawait Promise.allSettled(extensionsToInstall.map(ext => {\n\t\t\tthis.extensionsWorkbenchService.installInServer(ext, this.extensionManagementServerService.remoteExtensionManagementServer!, { donotIncludePackAndDependencies: true });\n\t\t}));\n\t}\n\n\tprivate async installFailedRemoteExtensions(): Promise<void> {\n\t\tif (!this.remoteAgentService.getConnection()) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst { failed } = await this.remoteExtensionsScannerService.whenExtensionsReady();\n\t\tif (failed.length === 0) {\n\t\t\tthis.logService.trace('No extensions relayed from server');\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.extensionManagementServerService.remoteExtensionManagementServer) {\n\t\t\tthis.logService.error('No remote extension management server available');\n\t\t\treturn;\n\t\t}\n\n\t\tthis.logService.info(`Installing '${failed.length}' extensions relayed from server`);\n\t\tconst galleryExtensions = await this.extensionGalleryService.getExtensions(failed.map(({ id }) => ({ id })), CancellationToken.None);\n\t\tconst installExtensionInfo: InstallExtensionInfo[] = [];\n\t\tfor (const { id, installOptions } of failed) {\n\t\t\tconst extension = galleryExtensions.find(e => areSameExtensions(e.identifier, { id }));\n\t\t\tif (extension) {\n\t\t\t\tinstallExtensionInfo.push({\n\t\t\t\t\textension, options: {\n\t\t\t\t\t\t...installOptions,\n\t\t\t\t\t\tdownloadExtensionsLocally: true,\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tthis.logService.warn(`Relayed failed extension '${id}' from server is not found in the gallery`);\n\t\t\t}\n\t\t}\n\n\t\tif (installExtensionInfo.length) {\n\t\t\tawait Promise.allSettled(installExtensionInfo.map(e => this.extensionManagementServerService.remoteExtensionManagementServer!.extensionManagementService.installFromGallery(e.extension, e.options)));\n\t\t}\n\t}\n}\n\nexport class RemoteExtensionsInitializerContribution implements IWorkbenchContribution {\n\tconstructor(\n\t\t@IExtensionManagementServerService private readonly extensionManagementServerService: IExtensionManagementServerService,\n\t\t@IStorageService private readonly storageService: IStorageService,\n\t\t@IRemoteAgentService private readonly remoteAgentService: IRemoteAgentService,\n\t\t@IUserDataSyncStoreManagementService private readonly userDataSyncStoreManagementService: IUserDataSyncStoreManagementService,\n\t\t@IInstantiationService private readonly instantiationService: IInstantiationService,\n\t\t@ILogService private readonly logService: ILogService,\n\t\t@IAuthenticationService private readonly authenticationService: IAuthenticationService,\n\t\t@IRemoteAuthorityResolverService private readonly remoteAuthorityResolverService: IRemoteAuthorityResolverService,\n\t\t@IUserDataSyncEnablementService private readonly userDataSyncEnablementService: IUserDataSyncEnablementService,\n\t) {\n\t\tthis.initializeRemoteExtensions();\n\t}\n\n\tprivate async initializeRemoteExtensions(): Promise<void> {\n\t\tconst connection = this.remoteAgentService.getConnection();\n\t\tconst localExtensionManagementServer = this.extensionManagementServerService.localExtensionManagementServer;\n\t\tconst remoteExtensionManagementServer = this.extensionManagementServerService.remoteExtensionManagementServer;\n\t\t// Skip: Not a remote window\n\t\tif (!connection || !remoteExtensionManagementServer) {\n\t\t\treturn;\n\t\t}\n\t\t// Skip: Not a native window\n\t\tif (!localExtensionManagementServer) {\n\t\t\treturn;\n\t\t}\n\t\t// Skip: No UserdataSyncStore is configured\n\t\tif (!this.userDataSyncStoreManagementService.userDataSyncStore) {\n\t\t\treturn;\n\t\t}\n\t\tconst newRemoteConnectionKey = `${IS_NEW_KEY}.${connection.remoteAuthority}`;\n\t\t// Skip: Not a new remote connection\n\t\tif (!this.storageService.getBoolean(newRemoteConnectionKey, StorageScope.APPLICATION, true)) {\n\t\t\tthis.logService.trace(`Skipping initializing remote extensions because the window with this remote authority was opened before.`);\n\t\t\treturn;\n\t\t}\n\t\tthis.storageService.store(newRemoteConnectionKey, false, StorageScope.APPLICATION, StorageTarget.MACHINE);\n\t\t// Skip: Not a new workspace\n\t\tif (!this.storageService.isNew(StorageScope.WORKSPACE)) {\n\t\t\tthis.logService.trace(`Skipping initializing remote extensions because this workspace was opened before.`);\n\t\t\treturn;\n\t\t}\n\t\t// Skip: Settings Sync is disabled\n\t\tif (!this.userDataSyncEnablementService.isEnabled()) {\n\t\t\treturn;\n\t\t}\n\t\t// Skip: No account is provided to initialize\n\t\tconst resolvedAuthority = await this.remoteAuthorityResolverService.resolveAuthority(connection.remoteAuthority);\n\t\tif (!resolvedAuthority.options?.authenticationSession) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst sessions = await this.authenticationService.getSessions(resolvedAuthority.options?.authenticationSession.providerId);\n\t\tconst session = sessions.find(s => s.id === resolvedAuthority.options?.authenticationSession?.id);\n\t\t// Skip: Session is not found\n\t\tif (!session) {\n\t\t\tthis.logService.info('Skipping initializing remote extensions because the account with given session id is not found', resolvedAuthority.options.authenticationSession.id);\n\t\t\treturn;\n\t\t}\n\n\t\tconst userDataSyncStoreClient = this.instantiationService.createInstance(UserDataSyncStoreClient, this.userDataSyncStoreManagementService.userDataSyncStore.url);\n\t\tuserDataSyncStoreClient.setAuthToken(session.accessToken, resolvedAuthority.options.authenticationSession.providerId);\n\t\tconst userData = await userDataSyncStoreClient.readResource(SyncResource.Extensions, null);\n\n\t\tconst serviceCollection = new ServiceCollection();\n\t\tserviceCollection.set(IExtensionManagementService, remoteExtensionManagementServer.extensionManagementService);\n\t\tconst instantiationService = this.instantiationService.createChild(serviceCollection);\n\t\tconst extensionsToInstallInitializer = instantiationService.createInstance(RemoteExtensionsInitializer);\n\n\t\tawait extensionsToInstallInitializer.initialize(userData);\n\t}\n}\n\nclass RemoteExtensionsInitializer extends AbstractExtensionsInitializer {\n\n\tconstructor(\n\t\t@IExtensionManagementService extensionManagementService: IExtensionManagementService,\n\t\t@IIgnoredExtensionsManagementService ignoredExtensionsManagementService: IIgnoredExtensionsManagementService,\n\t\t@IFileService fileService: IFileService,\n\t\t@IUserDataProfilesService userDataProfilesService: IUserDataProfilesService,\n\t\t@IEnvironmentService environmentService: IEnvironmentService,\n\t\t@ILogService logService: ILogService,\n\t\t@IUriIdentityService uriIdentityService: IUriIdentityService,\n\t\t@IExtensionGalleryService private readonly extensionGalleryService: IExtensionGalleryService,\n\t\t@IStorageService storageService: IStorageService,\n\t\t@IExtensionManifestPropertiesService private readonly extensionManifestPropertiesService: IExtensionManifestPropertiesService,\n\t) {\n\t\tsuper(extensionManagementService, ignoredExtensionsManagementService, fileService, userDataProfilesService, environmentService, logService, storageService, uriIdentityService);\n\t}\n\n\tprotected override async doInitialize(remoteUserData: IRemoteUserData): Promise<void> {\n\t\tconst remoteExtensions = await this.parseExtensions(remoteUserData);\n\t\tif (!remoteExtensions) {\n\t\t\tthis.logService.info('No synced extensions exist while initializing remote extensions.');\n\t\t\treturn;\n\t\t}\n\t\tconst installedExtensions = await this.extensionManagementService.getInstalled();\n\t\tconst { newExtensions } = this.generatePreview(remoteExtensions, installedExtensions);\n\t\tif (!newExtensions.length) {\n\t\t\tthis.logService.trace('No new remote extensions to install.');\n\t\t\treturn;\n\t\t}\n\t\tconst targetPlatform = await this.extensionManagementService.getTargetPlatform();\n\t\tconst extensionsToInstall = await this.extensionGalleryService.getExtensions(newExtensions, { targetPlatform, compatible: true }, CancellationToken.None);\n\t\tif (extensionsToInstall.length) {\n\t\t\tawait Promise.allSettled(extensionsToInstall.map(async e => {\n\t\t\t\tconst manifest = await this.extensionGalleryService.getManifest(e, CancellationToken.None);\n\t\t\t\tif (manifest && this.extensionManifestPropertiesService.canExecuteOnWorkspace(manifest)) {\n\t\t\t\t\tconst syncedExtension = remoteExtensions.find(e => areSameExtensions(e.identifier, e.identifier));\n\t\t\t\t\tawait this.extensionManagementService.installFromGallery(e, { installPreReleaseVersion: syncedExtension?.preRelease, donotIncludePackAndDependencies: true, context: { [EXTENSION_INSTALL_SKIP_PUBLISHER_TRUST_CONTEXT]: true } });\n\t\t\t\t}\n\t\t\t}));\n\t\t}\n\t}\n}\n"]}