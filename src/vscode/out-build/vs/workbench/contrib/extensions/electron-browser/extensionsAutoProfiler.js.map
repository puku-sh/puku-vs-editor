{"version":3,"sources":["vs/workbench/contrib/extensions/electron-browser/extensionsAutoProfiler.ts"],"names":[],"mappings":"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","file":"extensionsAutoProfiler.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { timeout } from '../../../../base/common/async.js';\nimport { VSBuffer } from '../../../../base/common/buffer.js';\nimport { CancellationTokenSource } from '../../../../base/common/cancellation.js';\nimport { onUnexpectedError } from '../../../../base/common/errors.js';\nimport { IDisposable } from '../../../../base/common/lifecycle.js';\nimport { Schemas } from '../../../../base/common/network.js';\nimport { joinPath } from '../../../../base/common/resources.js';\nimport { TernarySearchTree } from '../../../../base/common/ternarySearchTree.js';\nimport { URI } from '../../../../base/common/uri.js';\nimport { generateUuid } from '../../../../base/common/uuid.js';\nimport { localize } from '../../../../nls.js';\nimport { IConfigurationService } from '../../../../platform/configuration/common/configuration.js';\nimport { ExtensionIdentifier, ExtensionIdentifierSet, IExtensionDescription } from '../../../../platform/extensions/common/extensions.js';\nimport { IFileService } from '../../../../platform/files/common/files.js';\nimport { IInstantiationService } from '../../../../platform/instantiation/common/instantiation.js';\nimport { ILogService } from '../../../../platform/log/common/log.js';\nimport { INotificationService, NotificationPriority, Severity } from '../../../../platform/notification/common/notification.js';\nimport { IProfileAnalysisWorkerService } from '../../../../platform/profiling/electron-browser/profileAnalysisWorkerService.js';\nimport { ITelemetryService } from '../../../../platform/telemetry/common/telemetry.js';\nimport { IWorkbenchContribution } from '../../../common/contributions.js';\nimport { RuntimeExtensionsInput } from '../common/runtimeExtensionsInput.js';\nimport { createSlowExtensionAction } from './extensionsSlowActions.js';\nimport { IExtensionHostProfileService } from './runtimeExtensionsEditor.js';\nimport { IEditorService } from '../../../services/editor/common/editorService.js';\nimport { INativeWorkbenchEnvironmentService } from '../../../services/environment/electron-browser/environmentService.js';\nimport { ExtensionHostKind } from '../../../services/extensions/common/extensionHostKind.js';\nimport { IExtensionHostProfile, IExtensionService, IResponsiveStateChangeEvent, ProfileSession } from '../../../services/extensions/common/extensions.js';\nimport { ExtensionHostProfiler } from '../../../services/extensions/electron-browser/extensionHostProfiler.js';\nimport { ITimerService } from '../../../services/timer/browser/timerService.js';\n\nexport class ExtensionsAutoProfiler implements IWorkbenchContribution {\n\n\tprivate readonly _blame = new ExtensionIdentifierSet();\n\n\tprivate _session: CancellationTokenSource | undefined;\n\tprivate _unresponsiveListener: IDisposable | undefined;\n\tprivate _perfBaseline: number = -1;\n\n\tconstructor(\n\t\t@IExtensionService private readonly _extensionService: IExtensionService,\n\t\t@IExtensionHostProfileService private readonly _extensionProfileService: IExtensionHostProfileService,\n\t\t@ITelemetryService private readonly _telemetryService: ITelemetryService,\n\t\t@ILogService private readonly _logService: ILogService,\n\t\t@INotificationService private readonly _notificationService: INotificationService,\n\t\t@IEditorService private readonly _editorService: IEditorService,\n\t\t@IInstantiationService private readonly _instantiationService: IInstantiationService,\n\t\t@INativeWorkbenchEnvironmentService private readonly _environmentServie: INativeWorkbenchEnvironmentService,\n\t\t@IProfileAnalysisWorkerService private readonly _profileAnalysisService: IProfileAnalysisWorkerService,\n\t\t@IConfigurationService private readonly _configService: IConfigurationService,\n\t\t@IFileService private readonly _fileService: IFileService,\n\t\t@ITimerService timerService: ITimerService\n\t) {\n\n\t\ttimerService.perfBaseline.then(value => {\n\t\t\tif (value < 0) {\n\t\t\t\treturn; // too slow for profiling\n\t\t\t}\n\t\t\tthis._perfBaseline = value;\n\t\t\tthis._unresponsiveListener = _extensionService.onDidChangeResponsiveChange(this._onDidChangeResponsiveChange, this);\n\t\t});\n\t}\n\n\tdispose(): void {\n\t\tthis._unresponsiveListener?.dispose();\n\t\tthis._session?.dispose(true);\n\t}\n\n\tprivate async _onDidChangeResponsiveChange(event: IResponsiveStateChangeEvent): Promise<void> {\n\t\tif (event.extensionHostKind !== ExtensionHostKind.LocalProcess) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst listener = await event.getInspectListener(true);\n\n\t\tif (!listener) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (event.isResponsive && this._session) {\n\t\t\t// stop profiling when responsive again\n\t\t\tthis._session.cancel();\n\t\t\tthis._logService.info('UNRESPONSIVE extension host: received responsive event and cancelling profiling session');\n\n\n\t\t} else if (!event.isResponsive && !this._session) {\n\t\t\t// start profiling if not yet profiling\n\t\t\tconst cts = new CancellationTokenSource();\n\t\t\tthis._session = cts;\n\n\n\t\t\tlet session: ProfileSession;\n\t\t\ttry {\n\t\t\t\tsession = await this._instantiationService.createInstance(ExtensionHostProfiler, listener.host, listener.port).start();\n\n\t\t\t} catch (err) {\n\t\t\t\tthis._session = undefined;\n\t\t\t\t// fail silent as this is often\n\t\t\t\t// caused by another party being\n\t\t\t\t// connected already\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis._logService.info('UNRESPONSIVE extension host: starting to profile NOW');\n\n\t\t\t// wait 5 seconds or until responsive again\n\t\t\ttry {\n\t\t\t\tawait timeout(5e3, cts.token);\n\t\t\t} catch {\n\t\t\t\t// can throw cancellation error. that is\n\t\t\t\t// OK, we stop profiling and analyse the\n\t\t\t\t// profile anyways\n\t\t\t}\n\n\t\t\ttry {\n\t\t\t\t// stop profiling and analyse results\n\t\t\t\tthis._processCpuProfile(await session.stop());\n\t\t\t} catch (err) {\n\t\t\t\tonUnexpectedError(err);\n\t\t\t} finally {\n\t\t\t\tthis._session = undefined;\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate async _processCpuProfile(profile: IExtensionHostProfile) {\n\n\t\t// get all extensions\n\t\tawait this._extensionService.whenInstalledExtensionsRegistered();\n\n\t\t// send heavy samples iff enabled\n\t\tif (this._configService.getValue('application.experimental.rendererProfiling')) {\n\n\t\t\tconst searchTree = TernarySearchTree.forUris<IExtensionDescription>();\n\t\t\tsearchTree.fill(this._extensionService.extensions.map(e => [e.extensionLocation, e]));\n\n\t\t\tawait this._profileAnalysisService.analyseBottomUp(\n\t\t\t\tprofile.data,\n\t\t\t\turl => searchTree.findSubstr(URI.parse(url))?.identifier.value ?? '<<not-found>>',\n\t\t\t\tthis._perfBaseline,\n\t\t\t\tfalse\n\t\t\t);\n\t\t}\n\n\t\t// analyse profile by extension-category\n\t\tconst categories: [location: URI, id: string][] = this._extensionService.extensions\n\t\t\t.filter(e => e.extensionLocation.scheme === Schemas.file)\n\t\t\t.map(e => [e.extensionLocation, ExtensionIdentifier.toKey(e.identifier)]);\n\n\t\tconst data = await this._profileAnalysisService.analyseByLocation(profile.data, categories);\n\n\t\t//\n\t\tlet overall: number = 0;\n\t\tlet top: string = '';\n\t\tlet topAggregated: number = -1;\n\t\tfor (const [category, aggregated] of data) {\n\t\t\toverall += aggregated;\n\t\t\tif (aggregated > topAggregated) {\n\t\t\t\ttopAggregated = aggregated;\n\t\t\t\ttop = category;\n\t\t\t}\n\t\t}\n\t\tconst topPercentage = topAggregated / (overall / 100);\n\n\t\t// associate extensions to profile node\n\t\tconst extension = await this._extensionService.getExtension(top);\n\t\tif (!extension) {\n\t\t\t// not an extension => idle, gc, self?\n\t\t\treturn;\n\t\t}\n\n\n\t\tconst profilingSessionId = generateUuid();\n\n\t\t// print message to log\n\t\tconst path = joinPath(this._environmentServie.tmpDir, `exthost-${Math.random().toString(16).slice(2, 8)}.cpuprofile`);\n\t\tawait this._fileService.writeFile(path, VSBuffer.fromString(JSON.stringify(profile.data)));\n\t\tthis._logService.warn(`UNRESPONSIVE extension host: '${top}' took ${topPercentage}% of ${topAggregated / 1e3}ms, saved PROFILE here: '${path}'`);\n\n\t\ttype UnresponsiveData = {\n\t\t\tduration: number;\n\t\t\tprofilingSessionId: string;\n\t\t\tdata: string[];\n\t\t\tid: string;\n\t\t};\n\t\ttype UnresponsiveDataClassification = {\n\t\t\towner: 'jrieken';\n\t\t\tcomment: 'Profiling data that was collected while the extension host was unresponsive';\n\t\t\tprofilingSessionId: { classification: 'SystemMetaData'; purpose: 'PerformanceAndHealth'; comment: 'Identifier of a profiling session' };\n\t\t\tduration: { classification: 'SystemMetaData'; purpose: 'PerformanceAndHealth'; comment: 'Duration for which the extension host was unresponsive' };\n\t\t\tdata: { classification: 'SystemMetaData'; purpose: 'PerformanceAndHealth'; comment: 'Extensions ids and core parts that were active while the extension host was frozen' };\n\t\t\tid: { classification: 'SystemMetaData'; purpose: 'PerformanceAndHealth'; comment: 'Top extensions id that took most of the duration' };\n\t\t};\n\t\tthis._telemetryService.publicLog2<UnresponsiveData, UnresponsiveDataClassification>('exthostunresponsive', {\n\t\t\tprofilingSessionId,\n\t\t\tduration: overall,\n\t\t\tdata: data.map(tuple => tuple[0]).flat(),\n\t\t\tid: ExtensionIdentifier.toKey(extension.identifier),\n\t\t});\n\n\n\t\t// add to running extensions view\n\t\tthis._extensionProfileService.setUnresponsiveProfile(extension.identifier, profile);\n\n\t\t// prompt: when really slow/greedy\n\t\tif (!(topPercentage >= 95 && topAggregated >= 5e6)) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst action = await this._instantiationService.invokeFunction(createSlowExtensionAction, extension, profile);\n\n\t\tif (!action) {\n\t\t\t// cannot report issues against this extension...\n\t\t\treturn;\n\t\t}\n\n\t\t// only blame once per extension, don't blame too often\n\t\tif (this._blame.has(extension.identifier) || this._blame.size >= 3) {\n\t\t\treturn;\n\t\t}\n\t\tthis._blame.add(extension.identifier);\n\n\t\t// user-facing message when very bad...\n\t\tthis._notificationService.prompt(\n\t\t\tSeverity.Warning,\n\t\t\tlocalize(\n\t\t\t\t'unresponsive-exthost',\n\t\t\t\t\"The extension '{0}' took a very long time to complete its last operation and it has prevented other extensions from running.\",\n\t\t\t\textension.displayName || extension.name\n\t\t\t),\n\t\t\t[{\n\t\t\t\tlabel: localize('show', 'Show Extensions'),\n\t\t\t\trun: () => this._editorService.openEditor(RuntimeExtensionsInput.instance, { pinned: true })\n\t\t\t},\n\t\t\t\taction\n\t\t\t],\n\t\t\t{ priority: NotificationPriority.SILENT }\n\t\t);\n\t}\n}\n"]}