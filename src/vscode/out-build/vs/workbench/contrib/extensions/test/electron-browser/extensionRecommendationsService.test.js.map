{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/contrib/extensions/test/electron-browser/extensionRecommendationsService.test.ts","vs/workbench/contrib/extensions/test/electron-browser/extensionRecommendationsService.test.ts"],"names":[],"mappings":"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","file":"extensionRecommendationsService.test.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as sinon from 'sinon';\nimport assert from 'assert';\nimport * as uuid from '../../../../../base/common/uuid.js';\nimport {\n\tIExtensionGalleryService, IGalleryExtensionAssets, IGalleryExtension, IExtensionManagementService, IExtensionTipsService, getTargetPlatform,\n} from '../../../../../platform/extensionManagement/common/extensionManagement.js';\nimport { IWorkbenchExtensionEnablementService, IWorkbenchExtensionManagementService } from '../../../../services/extensionManagement/common/extensionManagement.js';\nimport { ExtensionGalleryService } from '../../../../../platform/extensionManagement/common/extensionGalleryService.js';\nimport { TestInstantiationService } from '../../../../../platform/instantiation/test/common/instantiationServiceMock.js';\nimport { Emitter, Event } from '../../../../../base/common/event.js';\nimport { ITelemetryService } from '../../../../../platform/telemetry/common/telemetry.js';\nimport { NullTelemetryService } from '../../../../../platform/telemetry/common/telemetryUtils.js';\nimport { IWorkspaceContextService } from '../../../../../platform/workspace/common/workspace.js';\nimport { TestLifecycleService } from '../../../../test/browser/workbenchTestServices.js';\nimport { TestContextService, TestProductService, TestStorageService } from '../../../../test/common/workbenchTestServices.js';\nimport { TestExtensionTipsService, TestSharedProcessService } from '../../../../test/electron-browser/workbenchTestServices.js';\nimport { TestNotificationService } from '../../../../../platform/notification/test/common/testNotificationService.js';\nimport { IConfigurationService } from '../../../../../platform/configuration/common/configuration.js';\nimport { URI } from '../../../../../base/common/uri.js';\nimport { testWorkspace } from '../../../../../platform/workspace/test/common/testWorkspace.js';\nimport { TestConfigurationService } from '../../../../../platform/configuration/test/common/testConfigurationService.js';\nimport { IPager } from '../../../../../base/common/paging.js';\nimport { getGalleryExtensionId } from '../../../../../platform/extensionManagement/common/extensionManagementUtil.js';\nimport { IEnvironmentService } from '../../../../../platform/environment/common/environment.js';\nimport { ConfigurationKey, IExtensionsWorkbenchService } from '../../common/extensions.js';\nimport { TestExtensionEnablementService } from '../../../../services/extensionManagement/test/browser/extensionEnablementService.test.js';\nimport { IURLService } from '../../../../../platform/url/common/url.js';\nimport { ITextModel } from '../../../../../editor/common/model.js';\nimport { IModelService } from '../../../../../editor/common/services/model.js';\nimport { ILifecycleService } from '../../../../services/lifecycle/common/lifecycle.js';\nimport { INotificationService, Severity, IPromptChoice, IPromptOptions } from '../../../../../platform/notification/common/notification.js';\nimport { NativeURLService } from '../../../../../platform/url/common/urlService.js';\nimport { IStorageService, StorageScope, StorageTarget } from '../../../../../platform/storage/common/storage.js';\nimport { ExtensionType } from '../../../../../platform/extensions/common/extensions.js';\nimport { ISharedProcessService } from '../../../../../platform/ipc/electron-browser/services.js';\nimport { FileService } from '../../../../../platform/files/common/fileService.js';\nimport { NullLogService, ILogService } from '../../../../../platform/log/common/log.js';\nimport { IFileService } from '../../../../../platform/files/common/files.js';\nimport { IProductService } from '../../../../../platform/product/common/productService.js';\nimport { ExtensionRecommendationsService } from '../../browser/extensionRecommendationsService.js';\nimport { NoOpWorkspaceTagsService } from '../../../tags/browser/workspaceTagsService.js';\nimport { IWorkspaceTagsService } from '../../../tags/common/workspaceTags.js';\nimport { ExtensionsWorkbenchService } from '../../browser/extensionsWorkbenchService.js';\nimport { IExtensionService } from '../../../../services/extensions/common/extensions.js';\nimport { IWorkspaceExtensionsConfigService, WorkspaceExtensionsConfigService } from '../../../../services/extensionRecommendations/common/workspaceExtensionsConfig.js';\nimport { IExtensionIgnoredRecommendationsService } from '../../../../services/extensionRecommendations/common/extensionRecommendations.js';\nimport { ExtensionIgnoredRecommendationsService } from '../../../../services/extensionRecommendations/common/extensionIgnoredRecommendationsService.js';\nimport { IExtensionRecommendationNotificationService } from '../../../../../platform/extensionRecommendations/common/extensionRecommendations.js';\nimport { ExtensionRecommendationNotificationService } from '../../browser/extensionRecommendationNotificationService.js';\nimport { IContextKeyService } from '../../../../../platform/contextkey/common/contextkey.js';\nimport { MockContextKeyService } from '../../../../../platform/keybinding/test/common/mockKeybindingService.js';\nimport { InMemoryFileSystemProvider } from '../../../../../platform/files/common/inMemoryFilesystemProvider.js';\nimport { joinPath } from '../../../../../base/common/resources.js';\nimport { VSBuffer } from '../../../../../base/common/buffer.js';\nimport { platform } from '../../../../../base/common/platform.js';\nimport { arch } from '../../../../../base/common/process.js';\nimport { runWithFakedTimers } from '../../../../../base/test/common/timeTravelScheduler.js';\nimport { ensureNoDisposablesAreLeakedInTestSuite } from '../../../../../base/test/common/utils.js';\nimport { DisposableStore } from '../../../../../base/common/lifecycle.js';\nimport { timeout } from '../../../../../base/common/async.js';\nimport { IUpdateService, State } from '../../../../../platform/update/common/update.js';\nimport { IUriIdentityService } from '../../../../../platform/uriIdentity/common/uriIdentity.js';\nimport { UriIdentityService } from '../../../../../platform/uriIdentity/common/uriIdentityService.js';\n\nconst ROOT = URI.file('tests').with({ scheme: 'vscode-tests' });\n\nconst mockExtensionGallery: IGalleryExtension[] = [\n\taGalleryExtension('MockExtension1', {\n\t\tdisplayName: 'Mock Extension 1',\n\t\tversion: '1.5',\n\t\tpublisherId: 'mockPublisher1Id',\n\t\tpublisher: 'mockPublisher1',\n\t\tpublisherDisplayName: 'Mock Publisher 1',\n\t\tdescription: 'Mock Description',\n\t\tinstallCount: 1000,\n\t\trating: 4,\n\t\tratingCount: 100\n\t}, {\n\t\tdependencies: ['pub.1'],\n\t}, {\n\t\tmanifest: { uri: 'uri:manifest', fallbackUri: 'fallback:manifest' },\n\t\treadme: { uri: 'uri:readme', fallbackUri: 'fallback:readme' },\n\t\tchangelog: { uri: 'uri:changelog', fallbackUri: 'fallback:changlog' },\n\t\tdownload: { uri: 'uri:download', fallbackUri: 'fallback:download' },\n\t\ticon: { uri: 'uri:icon', fallbackUri: 'fallback:icon' },\n\t\tlicense: { uri: 'uri:license', fallbackUri: 'fallback:license' },\n\t\trepository: { uri: 'uri:repository', fallbackUri: 'fallback:repository' },\n\t\tsignature: { uri: 'uri:signature', fallbackUri: 'fallback:signature' },\n\t\tcoreTranslations: []\n\t}),\n\taGalleryExtension('MockExtension2', {\n\t\tdisplayName: 'Mock Extension 2',\n\t\tversion: '1.5',\n\t\tpublisherId: 'mockPublisher2Id',\n\t\tpublisher: 'mockPublisher2',\n\t\tpublisherDisplayName: 'Mock Publisher 2',\n\t\tdescription: 'Mock Description',\n\t\tinstallCount: 1000,\n\t\trating: 4,\n\t\tratingCount: 100\n\t}, {\n\t\tdependencies: ['pub.1', 'pub.2'],\n\t}, {\n\t\tmanifest: { uri: 'uri:manifest', fallbackUri: 'fallback:manifest' },\n\t\treadme: { uri: 'uri:readme', fallbackUri: 'fallback:readme' },\n\t\tchangelog: { uri: 'uri:changelog', fallbackUri: 'fallback:changlog' },\n\t\tdownload: { uri: 'uri:download', fallbackUri: 'fallback:download' },\n\t\ticon: { uri: 'uri:icon', fallbackUri: 'fallback:icon' },\n\t\tlicense: { uri: 'uri:license', fallbackUri: 'fallback:license' },\n\t\trepository: { uri: 'uri:repository', fallbackUri: 'fallback:repository' },\n\t\tsignature: { uri: 'uri:signature', fallbackUri: 'fallback:signature' },\n\t\tcoreTranslations: []\n\t})\n];\n\nconst mockExtensionLocal = [\n\t{\n\t\ttype: ExtensionType.User,\n\t\tidentifier: mockExtensionGallery[0].identifier,\n\t\tmanifest: {\n\t\t\tname: mockExtensionGallery[0].name,\n\t\t\tpublisher: mockExtensionGallery[0].publisher,\n\t\t\tversion: mockExtensionGallery[0].version\n\t\t},\n\t\tmetadata: null,\n\t\tpath: 'somepath',\n\t\treadmeUrl: 'some readmeUrl',\n\t\tchangelogUrl: 'some changelogUrl'\n\t},\n\t{\n\t\ttype: ExtensionType.User,\n\t\tidentifier: mockExtensionGallery[1].identifier,\n\t\tmanifest: {\n\t\t\tname: mockExtensionGallery[1].name,\n\t\t\tpublisher: mockExtensionGallery[1].publisher,\n\t\t\tversion: mockExtensionGallery[1].version\n\t\t},\n\t\tmetadata: null,\n\t\tpath: 'somepath',\n\t\treadmeUrl: 'some readmeUrl',\n\t\tchangelogUrl: 'some changelogUrl'\n\t}\n];\n\nconst mockTestData = {\n\trecommendedExtensions: [\n\t\t'mockPublisher1.mockExtension1',\n\t\t'MOCKPUBLISHER2.mockextension2',\n\t\t'badlyformattedextension',\n\t\t'MOCKPUBLISHER2.mockextension2',\n\t\t'unknown.extension'\n\t],\n\tvalidRecommendedExtensions: [\n\t\t'mockPublisher1.mockExtension1',\n\t\t'MOCKPUBLISHER2.mockextension2'\n\t]\n};\n\nfunction aPage<T>(...objects: T[]): IPager<T> {\n\treturn { firstPage: objects, total: objects.length, pageSize: objects.length, getPage: () => null! };\n}\n\nconst noAssets: IGalleryExtensionAssets = {\n\tchangelog: null,\n\tdownload: null!,\n\ticon: null!,\n\tlicense: null,\n\tmanifest: null,\n\treadme: null,\n\trepository: null,\n\tsignature: null,\n\tcoreTranslations: []\n};\n\nfunction aGalleryExtension(name: string, properties: any = {}, galleryExtensionProperties: any = {}, assets: IGalleryExtensionAssets = noAssets): IGalleryExtension {\n\tconst targetPlatform = getTargetPlatform(platform, arch);\n\tconst galleryExtension = <IGalleryExtension>Object.create({ name, publisher: 'pub', version: '1.0.0', allTargetPlatforms: [targetPlatform], properties: {}, assets: {}, ...properties });\n\tgalleryExtension.properties = { ...galleryExtension.properties, dependencies: [], targetPlatform, ...galleryExtensionProperties };\n\tgalleryExtension.assets = { ...galleryExtension.assets, ...assets };\n\tgalleryExtension.identifier = { id: getGalleryExtensionId(galleryExtension.publisher, galleryExtension.name), uuid: uuid.generateUuid() };\n\treturn <IGalleryExtension>galleryExtension;\n}\n\nsuite('ExtensionRecommendationsService Test', () => {\n\tlet disposableStore: DisposableStore;\n\tlet workspaceService: IWorkspaceContextService;\n\tlet instantiationService: TestInstantiationService;\n\tlet testConfigurationService: TestConfigurationService;\n\tlet testObject: ExtensionRecommendationsService;\n\tlet prompted: boolean;\n\tlet promptedEmitter: Emitter<void>;\n\tlet onModelAddedEvent: Emitter<ITextModel>;\n\n\tteardown(async () => {\n\t\tdisposableStore.dispose();\n\t\tawait timeout(0); // allow for async disposables to complete\n\t});\n\n\tensureNoDisposablesAreLeakedInTestSuite();\n\n\tsetup(() => {\n\t\tdisposableStore = new DisposableStore();\n\t\tinstantiationService = disposableStore.add(new TestInstantiationService());\n\t\tpromptedEmitter = disposableStore.add(new Emitter<void>());\n\t\tinstantiationService.stub(IExtensionGalleryService, ExtensionGalleryService);\n\t\tinstantiationService.stub(ISharedProcessService, TestSharedProcessService);\n\t\tinstantiationService.stub(ILifecycleService, disposableStore.add(new TestLifecycleService()));\n\t\ttestConfigurationService = new TestConfigurationService();\n\t\tinstantiationService.stub(IConfigurationService, testConfigurationService);\n\t\tinstantiationService.stub(IProductService, TestProductService);\n\t\tinstantiationService.stub(ILogService, NullLogService);\n\t\tconst fileService = new FileService(instantiationService.get(ILogService));\n\t\tinstantiationService.stub(IFileService, disposableStore.add(fileService));\n\t\tconst fileSystemProvider = disposableStore.add(new InMemoryFileSystemProvider());\n\t\tdisposableStore.add(fileService.registerProvider(ROOT.scheme, fileSystemProvider));\n\t\tinstantiationService.stub(IUriIdentityService, disposableStore.add(new UriIdentityService(instantiationService.get(IFileService))));\n\t\tinstantiationService.stub(INotificationService, new TestNotificationService());\n\t\tinstantiationService.stub(IContextKeyService, new MockContextKeyService());\n\t\tinstantiationService.stub(IWorkbenchExtensionManagementService, {\n\t\t\tonInstallExtension: Event.None,\n\t\t\tonDidInstallExtensions: Event.None,\n\t\t\tonUninstallExtension: Event.None,\n\t\t\tonDidUninstallExtension: Event.None,\n\t\t\tonDidUpdateExtensionMetadata: Event.None,\n\t\t\tonDidChangeProfile: Event.None,\n\t\t\tonProfileAwareDidInstallExtensions: Event.None,\n\t\t\tasync getInstalled() { return []; },\n\t\t\tasync canInstall() { return true; },\n\t\t\tasync getExtensionsControlManifest() { return { malicious: [], deprecated: {}, search: [], publisherMapping: {} }; },\n\t\t\tasync getTargetPlatform() { return getTargetPlatform(platform, arch); },\n\t\t});\n\t\tinstantiationService.stub(IExtensionService, {\n\t\t\tonDidChangeExtensions: Event.None,\n\t\t\textensions: [],\n\t\t\tasync whenInstalledExtensionsRegistered() { return true; }\n\t\t});\n\t\tinstantiationService.stub(IWorkbenchExtensionEnablementService, disposableStore.add(new TestExtensionEnablementService(instantiationService)));\n\t\tinstantiationService.stub(ITelemetryService, NullTelemetryService);\n\t\tinstantiationService.stub(IURLService, NativeURLService);\n\t\tinstantiationService.stub(IWorkspaceTagsService, new NoOpWorkspaceTagsService());\n\t\tinstantiationService.stub(IStorageService, disposableStore.add(new TestStorageService()));\n\t\tinstantiationService.stub(ILogService, new NullLogService());\n\t\tinstantiationService.stub(IProductService, {\n\t\t\textensionRecommendations: {\n\t\t\t\t'ms-python.python': {\n\t\t\t\t\tonFileOpen: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t'pathGlob': '{**/*.py}',\n\t\t\t\t\t\t\timportant: true\n\t\t\t\t\t\t}\n\t\t\t\t\t]\n\t\t\t\t},\n\t\t\t\t'ms-vscode.PowerShell': {\n\t\t\t\t\tonFileOpen: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t'pathGlob': '{**/*.ps,**/*.ps1}',\n\t\t\t\t\t\t\timportant: true\n\t\t\t\t\t\t}\n\t\t\t\t\t]\n\t\t\t\t},\n\t\t\t\t'ms-dotnettools.csharp': {\n\t\t\t\t\tonFileOpen: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t'pathGlob': '{**/*.cs,**/project.json,**/global.json,**/*.csproj,**/*.sln,**/appsettings.json}',\n\t\t\t\t\t\t}\n\t\t\t\t\t]\n\t\t\t\t},\n\t\t\t\t'msjsdiag.debugger-for-chrome': {\n\t\t\t\t\tonFileOpen: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t'pathGlob': '{**/*.ts,**/*.tsx,**/*.js,**/*.jsx,**/*.es6,**/*.mjs,**/*.cjs,**/.babelrc}',\n\t\t\t\t\t\t}\n\t\t\t\t\t]\n\t\t\t\t},\n\t\t\t\t'lukehoban.Go': {\n\t\t\t\t\tonFileOpen: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t'pathGlob': '**/*.go',\n\t\t\t\t\t\t}\n\t\t\t\t\t]\n\t\t\t\t}\n\t\t\t},\n\t\t});\n\n\t\tinstantiationService.stub(IUpdateService, { onStateChange: Event.None, state: State.Uninitialized });\n\t\tinstantiationService.set(IExtensionsWorkbenchService, disposableStore.add(instantiationService.createInstance(ExtensionsWorkbenchService)));\n\t\tinstantiationService.stub(IExtensionTipsService, disposableStore.add(instantiationService.createInstance(TestExtensionTipsService)));\n\n\t\tonModelAddedEvent = new Emitter<ITextModel>();\n\n\t\tinstantiationService.stub(IEnvironmentService, {});\n\t\tinstantiationService.stubPromise(IExtensionManagementService, 'getInstalled', []);\n\t\tinstantiationService.stub(IExtensionGalleryService, 'isEnabled', true);\n\t\tinstantiationService.stubPromise(IExtensionGalleryService, 'query', aPage<IGalleryExtension>(...mockExtensionGallery));\n\t\tinstantiationService.stubPromise(IExtensionGalleryService, 'getExtensions', mockExtensionGallery);\n\n\t\tprompted = false;\n\n\t\tclass TestNotificationService2 extends TestNotificationService {\n\t\t\tpublic override prompt(severity: Severity, message: string, choices: IPromptChoice[], options?: IPromptOptions) {\n\t\t\t\tprompted = true;\n\t\t\t\tpromptedEmitter.fire();\n\t\t\t\treturn super.prompt(severity, message, choices, options);\n\t\t\t}\n\t\t}\n\n\t\tinstantiationService.stub(INotificationService, new TestNotificationService2());\n\n\t\ttestConfigurationService.setUserConfiguration(ConfigurationKey, { ignoreRecommendations: false });\n\t\tinstantiationService.stub(IModelService, <IModelService>{\n\t\t\tgetModels(): any { return []; },\n\t\t\tonModelAdded: onModelAddedEvent.event\n\t\t});\n\t});\n\n\tfunction setUpFolderWorkspace(folderName: string, recommendedExtensions: string[], ignoredRecommendations: string[] = []): Promise<void> {\n\t\treturn setUpFolder(folderName, recommendedExtensions, ignoredRecommendations);\n\t}\n\n\tasync function setUpFolder(folderName: string, recommendedExtensions: string[], ignoredRecommendations: string[] = []): Promise<void> {\n\t\tconst fileService = instantiationService.get(IFileService);\n\t\tconst folderDir = joinPath(ROOT, folderName);\n\t\tconst workspaceSettingsDir = joinPath(folderDir, '.vscode');\n\t\tawait fileService.createFolder(workspaceSettingsDir);\n\t\tconst configPath = joinPath(workspaceSettingsDir, 'extensions.json');\n\t\tawait fileService.writeFile(configPath, VSBuffer.fromString(JSON.stringify({\n\t\t\t'recommendations': recommendedExtensions,\n\t\t\t'unwantedRecommendations': ignoredRecommendations,\n\t\t}, null, '\\t')));\n\n\t\tconst myWorkspace = testWorkspace(folderDir);\n\n\t\tinstantiationService.stub(IFileService, fileService);\n\t\tworkspaceService = new TestContextService(myWorkspace);\n\t\tinstantiationService.stub(IWorkspaceContextService, workspaceService);\n\t\tinstantiationService.stub(IWorkspaceExtensionsConfigService, disposableStore.add(instantiationService.createInstance(WorkspaceExtensionsConfigService)));\n\t\tinstantiationService.stub(IExtensionIgnoredRecommendationsService, disposableStore.add(instantiationService.createInstance(ExtensionIgnoredRecommendationsService)));\n\t\tinstantiationService.stub(IExtensionRecommendationNotificationService, disposableStore.add(instantiationService.createInstance(ExtensionRecommendationNotificationService)));\n\t}\n\n\tfunction testNoPromptForValidRecommendations(recommendations: string[]) {\n\t\treturn setUpFolderWorkspace('myFolder', recommendations).then(() => {\n\t\t\ttestObject = disposableStore.add(instantiationService.createInstance(ExtensionRecommendationsService));\n\t\t\treturn testObject.activationPromise.then(() => {\n\t\t\t\tassert.strictEqual(Object.keys(testObject.getAllRecommendationsWithReason()).length, recommendations.length);\n\t\t\t\tassert.ok(!prompted);\n\t\t\t});\n\t\t});\n\t}\n\n\tfunction testNoPromptOrRecommendationsForValidRecommendations(recommendations: string[]) {\n\t\treturn setUpFolderWorkspace('myFolder', mockTestData.validRecommendedExtensions).then(() => {\n\t\t\ttestObject = disposableStore.add(instantiationService.createInstance(ExtensionRecommendationsService));\n\t\t\tassert.ok(!prompted);\n\n\t\t\treturn testObject.getWorkspaceRecommendations().then(() => {\n\t\t\t\tassert.strictEqual(Object.keys(testObject.getAllRecommendationsWithReason()).length, 0);\n\t\t\t\tassert.ok(!prompted);\n\t\t\t});\n\t\t});\n\t}\n\n\ttest('ExtensionRecommendationsService: No Prompt for valid workspace recommendations when galleryService is absent', () => runWithFakedTimers<void>({ useFakeTimers: true }, async () => {\n\t\tconst galleryQuerySpy = sinon.spy();\n\t\tinstantiationService.stub(IExtensionGalleryService, { query: galleryQuerySpy, isEnabled: () => false });\n\n\t\treturn testNoPromptOrRecommendationsForValidRecommendations(mockTestData.validRecommendedExtensions)\n\t\t\t.then(() => assert.ok(galleryQuerySpy.notCalled));\n\t}));\n\n\ttest('ExtensionRecommendationsService: No Prompt for valid workspace recommendations during extension development', () => runWithFakedTimers<void>({ useFakeTimers: true }, async () => {\n\t\tinstantiationService.stub(IEnvironmentService, { extensionDevelopmentLocationURI: [URI.file('/folder/file')], isExtensionDevelopment: true });\n\t\treturn testNoPromptOrRecommendationsForValidRecommendations(mockTestData.validRecommendedExtensions);\n\t}));\n\n\ttest('ExtensionRecommendationsService: No workspace recommendations or prompts when extensions.json has empty array', () => runWithFakedTimers<void>({ useFakeTimers: true }, async () => {\n\t\treturn testNoPromptForValidRecommendations([]);\n\t}));\n\n\ttest('ExtensionRecommendationsService: Prompt for valid workspace recommendations', () => runWithFakedTimers<void>({ useFakeTimers: true }, async () => {\n\t\tawait setUpFolderWorkspace('myFolder', mockTestData.recommendedExtensions);\n\t\ttestObject = disposableStore.add(instantiationService.createInstance(ExtensionRecommendationsService));\n\n\t\tawait Event.toPromise(promptedEmitter.event);\n\t\tconst recommendations = Object.keys(testObject.getAllRecommendationsWithReason());\n\t\tconst expected = [...mockTestData.validRecommendedExtensions, 'unknown.extension'];\n\t\tassert.strictEqual(recommendations.length, expected.length);\n\t\texpected.forEach(x => {\n\t\t\tassert.strictEqual(recommendations.indexOf(x.toLowerCase()) > -1, true);\n\t\t});\n\t}));\n\n\ttest('ExtensionRecommendationsService: No Prompt for valid workspace recommendations if they are already installed', () => runWithFakedTimers<void>({ useFakeTimers: true }, async () => {\n\t\tinstantiationService.stubPromise(IExtensionManagementService, 'getInstalled', mockExtensionLocal);\n\t\treturn testNoPromptForValidRecommendations(mockTestData.validRecommendedExtensions);\n\t}));\n\n\ttest('ExtensionRecommendationsService: No Prompt for valid workspace recommendations with casing mismatch if they are already installed', () => runWithFakedTimers<void>({ useFakeTimers: true }, async () => {\n\t\tinstantiationService.stubPromise(IExtensionManagementService, 'getInstalled', mockExtensionLocal);\n\t\treturn testNoPromptForValidRecommendations(mockTestData.validRecommendedExtensions.map(x => x.toUpperCase()));\n\t}));\n\n\ttest('ExtensionRecommendationsService: No Prompt for valid workspace recommendations if ignoreRecommendations is set', () => runWithFakedTimers<void>({ useFakeTimers: true }, async () => {\n\t\ttestConfigurationService.setUserConfiguration(ConfigurationKey, { ignoreRecommendations: true });\n\t\treturn testNoPromptForValidRecommendations(mockTestData.validRecommendedExtensions);\n\t}));\n\n\ttest('ExtensionRecommendationsService: No Prompt for valid workspace recommendations if showRecommendationsOnlyOnDemand is set', () => runWithFakedTimers<void>({ useFakeTimers: true }, async () => {\n\t\ttestConfigurationService.setUserConfiguration(ConfigurationKey, { showRecommendationsOnlyOnDemand: true });\n\t\treturn setUpFolderWorkspace('myFolder', mockTestData.validRecommendedExtensions).then(() => {\n\t\t\ttestObject = disposableStore.add(instantiationService.createInstance(ExtensionRecommendationsService));\n\t\t\treturn testObject.activationPromise.then(() => {\n\t\t\t\tassert.ok(!prompted);\n\t\t\t});\n\t\t});\n\t}));\n\n\ttest('ExtensionRecommendationsService: No Prompt for valid workspace recommendations if ignoreRecommendations is set for current workspace', () => runWithFakedTimers<void>({ useFakeTimers: true }, async () => {\n\t\tinstantiationService.get(IStorageService).store('extensionsAssistant/workspaceRecommendationsIgnore', true, StorageScope.WORKSPACE, StorageTarget.MACHINE);\n\t\treturn testNoPromptForValidRecommendations(mockTestData.validRecommendedExtensions);\n\t}));\n\n\ttest('ExtensionRecommendationsService: No Recommendations of globally ignored recommendations', () => runWithFakedTimers<void>({ useFakeTimers: true }, async () => {\n\t\tinstantiationService.get(IStorageService).store('extensionsAssistant/workspaceRecommendationsIgnore', true, StorageScope.WORKSPACE, StorageTarget.MACHINE);\n\t\tinstantiationService.get(IStorageService).store('extensionsAssistant/recommendations', '[\"ms-dotnettools.csharp\", \"ms-python.python\", \"ms-vscode.vscode-typescript-tslint-plugin\"]', StorageScope.PROFILE, StorageTarget.MACHINE);\n\t\tinstantiationService.get(IStorageService).store('extensionsAssistant/ignored_recommendations', '[\"ms-dotnettools.csharp\", \"mockpublisher2.mockextension2\"]', StorageScope.PROFILE, StorageTarget.MACHINE);\n\n\t\treturn setUpFolderWorkspace('myFolder', mockTestData.validRecommendedExtensions).then(() => {\n\t\t\ttestObject = disposableStore.add(instantiationService.createInstance(ExtensionRecommendationsService));\n\t\t\treturn testObject.activationPromise.then(() => {\n\t\t\t\tconst recommendations = testObject.getAllRecommendationsWithReason();\n\t\t\t\tassert.ok(!recommendations['ms-dotnettools.csharp']); // stored recommendation that has been globally ignored\n\t\t\t\tassert.ok(recommendations['ms-python.python']); // stored recommendation\n\t\t\t\tassert.ok(recommendations['mockpublisher1.mockextension1']); // workspace recommendation\n\t\t\t\tassert.ok(!recommendations['mockpublisher2.mockextension2']); // workspace recommendation that has been globally ignored\n\t\t\t});\n\t\t});\n\t}));\n\n\ttest('ExtensionRecommendationsService: No Recommendations of workspace ignored recommendations', () => runWithFakedTimers<void>({ useFakeTimers: true }, async () => {\n\t\tconst ignoredRecommendations = ['ms-dotnettools.csharp', 'mockpublisher2.mockextension2']; // ignore a stored recommendation and a workspace recommendation.\n\t\tconst storedRecommendations = '[\"ms-dotnettools.csharp\", \"ms-python.python\"]';\n\t\tinstantiationService.get(IStorageService).store('extensionsAssistant/workspaceRecommendationsIgnore', true, StorageScope.WORKSPACE, StorageTarget.MACHINE);\n\t\tinstantiationService.get(IStorageService).store('extensionsAssistant/recommendations', storedRecommendations, StorageScope.PROFILE, StorageTarget.MACHINE);\n\n\t\treturn setUpFolderWorkspace('myFolder', mockTestData.validRecommendedExtensions, ignoredRecommendations).then(() => {\n\t\t\ttestObject = disposableStore.add(instantiationService.createInstance(ExtensionRecommendationsService));\n\t\t\treturn testObject.activationPromise.then(() => {\n\t\t\t\tconst recommendations = testObject.getAllRecommendationsWithReason();\n\t\t\t\tassert.ok(!recommendations['ms-dotnettools.csharp']); // stored recommendation that has been workspace ignored\n\t\t\t\tassert.ok(recommendations['ms-python.python']); // stored recommendation\n\t\t\t\tassert.ok(recommendations['mockpublisher1.mockextension1']); // workspace recommendation\n\t\t\t\tassert.ok(!recommendations['mockpublisher2.mockextension2']); // workspace recommendation that has been workspace ignored\n\t\t\t});\n\t\t});\n\t}));\n\n\ttest('ExtensionRecommendationsService: Able to retrieve collection of all ignored recommendations', async () => runWithFakedTimers<void>({ useFakeTimers: true }, async () => {\n\n\t\tconst storageService = instantiationService.get(IStorageService);\n\t\tconst workspaceIgnoredRecommendations = ['ms-dotnettools.csharp']; // ignore a stored recommendation and a workspace recommendation.\n\t\tconst storedRecommendations = '[\"ms-dotnettools.csharp\", \"ms-python.python\"]';\n\t\tconst globallyIgnoredRecommendations = '[\"mockpublisher2.mockextension2\"]'; // ignore a workspace recommendation.\n\t\tstorageService.store('extensionsAssistant/workspaceRecommendationsIgnore', true, StorageScope.WORKSPACE, StorageTarget.MACHINE);\n\t\tstorageService.store('extensionsAssistant/recommendations', storedRecommendations, StorageScope.PROFILE, StorageTarget.MACHINE);\n\t\tstorageService.store('extensionsAssistant/ignored_recommendations', globallyIgnoredRecommendations, StorageScope.PROFILE, StorageTarget.MACHINE);\n\n\t\tawait setUpFolderWorkspace('myFolder', mockTestData.validRecommendedExtensions, workspaceIgnoredRecommendations);\n\t\ttestObject = disposableStore.add(instantiationService.createInstance(ExtensionRecommendationsService));\n\t\tawait testObject.activationPromise;\n\n\t\tconst recommendations = testObject.getAllRecommendationsWithReason();\n\t\tassert.deepStrictEqual(Object.keys(recommendations), ['ms-python.python', 'mockpublisher1.mockextension1']);\n\t}));\n\n\ttest('ExtensionRecommendationsService: Able to dynamically ignore/unignore global recommendations', async () => runWithFakedTimers<void>({ useFakeTimers: true }, async () => {\n\t\tconst storageService = instantiationService.get(IStorageService);\n\n\t\tconst storedRecommendations = '[\"ms-dotnettools.csharp\", \"ms-python.python\"]';\n\t\tconst globallyIgnoredRecommendations = '[\"mockpublisher2.mockextension2\"]'; // ignore a workspace recommendation.\n\t\tstorageService.store('extensionsAssistant/workspaceRecommendationsIgnore', true, StorageScope.WORKSPACE, StorageTarget.MACHINE);\n\t\tstorageService.store('extensionsAssistant/recommendations', storedRecommendations, StorageScope.PROFILE, StorageTarget.MACHINE);\n\t\tstorageService.store('extensionsAssistant/ignored_recommendations', globallyIgnoredRecommendations, StorageScope.PROFILE, StorageTarget.MACHINE);\n\n\t\tawait setUpFolderWorkspace('myFolder', mockTestData.validRecommendedExtensions);\n\t\tconst extensionIgnoredRecommendationsService = instantiationService.get(IExtensionIgnoredRecommendationsService);\n\t\ttestObject = disposableStore.add(instantiationService.createInstance(ExtensionRecommendationsService));\n\t\tawait testObject.activationPromise;\n\n\t\tlet recommendations = testObject.getAllRecommendationsWithReason();\n\t\tassert.ok(recommendations['ms-python.python']);\n\t\tassert.ok(recommendations['mockpublisher1.mockextension1']);\n\t\tassert.ok(!recommendations['mockpublisher2.mockextension2']);\n\n\t\textensionIgnoredRecommendationsService.toggleGlobalIgnoredRecommendation('mockpublisher1.mockextension1', true);\n\n\t\trecommendations = testObject.getAllRecommendationsWithReason();\n\t\tassert.ok(recommendations['ms-python.python']);\n\t\tassert.ok(!recommendations['mockpublisher1.mockextension1']);\n\t\tassert.ok(!recommendations['mockpublisher2.mockextension2']);\n\n\t\textensionIgnoredRecommendationsService.toggleGlobalIgnoredRecommendation('mockpublisher1.mockextension1', false);\n\n\t\trecommendations = testObject.getAllRecommendationsWithReason();\n\t\tassert.ok(recommendations['ms-python.python']);\n\t\tassert.ok(recommendations['mockpublisher1.mockextension1']);\n\t\tassert.ok(!recommendations['mockpublisher2.mockextension2']);\n\t}));\n\n\ttest('test global extensions are modified and recommendation change event is fired when an extension is ignored', async () => runWithFakedTimers<void>({ useFakeTimers: true }, async () => {\n\t\tconst storageService = instantiationService.get(IStorageService);\n\t\tconst changeHandlerTarget = sinon.spy();\n\t\tconst ignoredExtensionId = 'Some.Extension';\n\n\t\tstorageService.store('extensionsAssistant/workspaceRecommendationsIgnore', true, StorageScope.WORKSPACE, StorageTarget.MACHINE);\n\t\tstorageService.store('extensionsAssistant/ignored_recommendations', '[\"ms-vscode.vscode\"]', StorageScope.PROFILE, StorageTarget.MACHINE);\n\n\t\tawait setUpFolderWorkspace('myFolder', []);\n\t\ttestObject = disposableStore.add(instantiationService.createInstance(ExtensionRecommendationsService));\n\t\tconst extensionIgnoredRecommendationsService = instantiationService.get(IExtensionIgnoredRecommendationsService);\n\t\tdisposableStore.add(extensionIgnoredRecommendationsService.onDidChangeGlobalIgnoredRecommendation(changeHandlerTarget));\n\t\textensionIgnoredRecommendationsService.toggleGlobalIgnoredRecommendation(ignoredExtensionId, true);\n\t\tawait testObject.activationPromise;\n\n\t\tassert.ok(changeHandlerTarget.calledOnce);\n\t\tassert.ok(changeHandlerTarget.getCall(0).calledWithMatch({ extensionId: ignoredExtensionId.toLowerCase(), isRecommended: false }));\n\t}));\n\n\ttest('ExtensionRecommendationsService: Get file based recommendations from storage (old format)', () => runWithFakedTimers<void>({ useFakeTimers: true }, async () => {\n\t\tconst storedRecommendations = '[\"ms-dotnettools.csharp\", \"ms-python.python\", \"ms-vscode.vscode-typescript-tslint-plugin\"]';\n\t\tinstantiationService.get(IStorageService).store('extensionsAssistant/recommendations', storedRecommendations, StorageScope.PROFILE, StorageTarget.MACHINE);\n\n\t\treturn setUpFolderWorkspace('myFolder', []).then(() => {\n\t\t\ttestObject = disposableStore.add(instantiationService.createInstance(ExtensionRecommendationsService));\n\t\t\treturn testObject.activationPromise.then(() => {\n\t\t\t\tconst recommendations = testObject.getFileBasedRecommendations();\n\t\t\t\tassert.strictEqual(recommendations.length, 2);\n\t\t\t\tassert.ok(recommendations.some(extensionId => extensionId === 'ms-dotnettools.csharp')); // stored recommendation that exists in product.extensionTips\n\t\t\t\tassert.ok(recommendations.some(extensionId => extensionId === 'ms-python.python')); // stored recommendation that exists in product.extensionImportantTips\n\t\t\t\tassert.ok(recommendations.every(extensionId => extensionId !== 'ms-vscode.vscode-typescript-tslint-plugin')); // stored recommendation that is no longer in neither product.extensionTips nor product.extensionImportantTips\n\t\t\t});\n\t\t});\n\t}));\n\n\ttest('ExtensionRecommendationsService: Get file based recommendations from storage (new format)', async () => {\n\t\tconst milliSecondsInADay = 1000 * 60 * 60 * 24;\n\t\tconst now = Date.now();\n\t\tconst tenDaysOld = 10 * milliSecondsInADay;\n\t\tconst storedRecommendations = `{\"ms-dotnettools.csharp\": ${now}, \"ms-python.python\": ${now}, \"ms-vscode.vscode-typescript-tslint-plugin\": ${now}, \"lukehoban.Go\": ${tenDaysOld}}`;\n\t\tinstantiationService.get(IStorageService).store('extensionsAssistant/recommendations', storedRecommendations, StorageScope.PROFILE, StorageTarget.MACHINE);\n\n\t\tawait setUpFolderWorkspace('myFolder', []);\n\t\ttestObject = disposableStore.add(instantiationService.createInstance(ExtensionRecommendationsService));\n\t\tawait testObject.activationPromise;\n\n\t\tconst recommendations = testObject.getFileBasedRecommendations();\n\t\tassert.strictEqual(recommendations.length, 2);\n\t\tassert.ok(recommendations.some(extensionId => extensionId === 'ms-dotnettools.csharp')); // stored recommendation that exists in product.extensionTips\n\t\tassert.ok(recommendations.some(extensionId => extensionId === 'ms-python.python')); // stored recommendation that exists in product.extensionImportantTips\n\t\tassert.ok(recommendations.every(extensionId => extensionId !== 'ms-vscode.vscode-typescript-tslint-plugin')); // stored recommendation that is no longer in neither product.extensionTips nor product.extensionImportantTips\n\t\tassert.ok(recommendations.every(extensionId => extensionId !== 'lukehoban.Go')); //stored recommendation that is older than a week\n\t});\n});\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as sinon from 'sinon';\nimport assert from 'assert';\nimport * as uuid from '../../../../../base/common/uuid.js';\nimport {\n\tIExtensionGalleryService, IGalleryExtensionAssets, IGalleryExtension, IExtensionManagementService, IExtensionTipsService, getTargetPlatform,\n} from '../../../../../platform/extensionManagement/common/extensionManagement.js';\nimport { IWorkbenchExtensionEnablementService, IWorkbenchExtensionManagementService } from '../../../../services/extensionManagement/common/extensionManagement.js';\nimport { ExtensionGalleryService } from '../../../../../platform/extensionManagement/common/extensionGalleryService.js';\nimport { TestInstantiationService } from '../../../../../platform/instantiation/test/common/instantiationServiceMock.js';\nimport { Emitter, Event } from '../../../../../base/common/event.js';\nimport { ITelemetryService } from '../../../../../platform/telemetry/common/telemetry.js';\nimport { NullTelemetryService } from '../../../../../platform/telemetry/common/telemetryUtils.js';\nimport { IWorkspaceContextService } from '../../../../../platform/workspace/common/workspace.js';\nimport { TestLifecycleService } from '../../../../test/browser/workbenchTestServices.js';\nimport { TestContextService, TestProductService, TestStorageService } from '../../../../test/common/workbenchTestServices.js';\nimport { TestExtensionTipsService, TestSharedProcessService } from '../../../../test/electron-browser/workbenchTestServices.js';\nimport { TestNotificationService } from '../../../../../platform/notification/test/common/testNotificationService.js';\nimport { IConfigurationService } from '../../../../../platform/configuration/common/configuration.js';\nimport { URI } from '../../../../../base/common/uri.js';\nimport { testWorkspace } from '../../../../../platform/workspace/test/common/testWorkspace.js';\nimport { TestConfigurationService } from '../../../../../platform/configuration/test/common/testConfigurationService.js';\nimport { IPager } from '../../../../../base/common/paging.js';\nimport { getGalleryExtensionId } from '../../../../../platform/extensionManagement/common/extensionManagementUtil.js';\nimport { IEnvironmentService } from '../../../../../platform/environment/common/environment.js';\nimport { ConfigurationKey, IExtensionsWorkbenchService } from '../../common/extensions.js';\nimport { TestExtensionEnablementService } from '../../../../services/extensionManagement/test/browser/extensionEnablementService.test.js';\nimport { IURLService } from '../../../../../platform/url/common/url.js';\nimport { ITextModel } from '../../../../../editor/common/model.js';\nimport { IModelService } from '../../../../../editor/common/services/model.js';\nimport { ILifecycleService } from '../../../../services/lifecycle/common/lifecycle.js';\nimport { INotificationService, Severity, IPromptChoice, IPromptOptions } from '../../../../../platform/notification/common/notification.js';\nimport { NativeURLService } from '../../../../../platform/url/common/urlService.js';\nimport { IStorageService, StorageScope, StorageTarget } from '../../../../../platform/storage/common/storage.js';\nimport { ExtensionType } from '../../../../../platform/extensions/common/extensions.js';\nimport { ISharedProcessService } from '../../../../../platform/ipc/electron-browser/services.js';\nimport { FileService } from '../../../../../platform/files/common/fileService.js';\nimport { NullLogService, ILogService } from '../../../../../platform/log/common/log.js';\nimport { IFileService } from '../../../../../platform/files/common/files.js';\nimport { IProductService } from '../../../../../platform/product/common/productService.js';\nimport { ExtensionRecommendationsService } from '../../browser/extensionRecommendationsService.js';\nimport { NoOpWorkspaceTagsService } from '../../../tags/browser/workspaceTagsService.js';\nimport { IWorkspaceTagsService } from '../../../tags/common/workspaceTags.js';\nimport { ExtensionsWorkbenchService } from '../../browser/extensionsWorkbenchService.js';\nimport { IExtensionService } from '../../../../services/extensions/common/extensions.js';\nimport { IWorkspaceExtensionsConfigService, WorkspaceExtensionsConfigService } from '../../../../services/extensionRecommendations/common/workspaceExtensionsConfig.js';\nimport { IExtensionIgnoredRecommendationsService } from '../../../../services/extensionRecommendations/common/extensionRecommendations.js';\nimport { ExtensionIgnoredRecommendationsService } from '../../../../services/extensionRecommendations/common/extensionIgnoredRecommendationsService.js';\nimport { IExtensionRecommendationNotificationService } from '../../../../../platform/extensionRecommendations/common/extensionRecommendations.js';\nimport { ExtensionRecommendationNotificationService } from '../../browser/extensionRecommendationNotificationService.js';\nimport { IContextKeyService } from '../../../../../platform/contextkey/common/contextkey.js';\nimport { MockContextKeyService } from '../../../../../platform/keybinding/test/common/mockKeybindingService.js';\nimport { InMemoryFileSystemProvider } from '../../../../../platform/files/common/inMemoryFilesystemProvider.js';\nimport { joinPath } from '../../../../../base/common/resources.js';\nimport { VSBuffer } from '../../../../../base/common/buffer.js';\nimport { platform } from '../../../../../base/common/platform.js';\nimport { arch } from '../../../../../base/common/process.js';\nimport { runWithFakedTimers } from '../../../../../base/test/common/timeTravelScheduler.js';\nimport { ensureNoDisposablesAreLeakedInTestSuite } from '../../../../../base/test/common/utils.js';\nimport { DisposableStore } from '../../../../../base/common/lifecycle.js';\nimport { timeout } from '../../../../../base/common/async.js';\nimport { IUpdateService, State } from '../../../../../platform/update/common/update.js';\nimport { IUriIdentityService } from '../../../../../platform/uriIdentity/common/uriIdentity.js';\nimport { UriIdentityService } from '../../../../../platform/uriIdentity/common/uriIdentityService.js';\n\nconst ROOT = URI.file('tests').with({ scheme: 'vscode-tests' });\n\nconst mockExtensionGallery: IGalleryExtension[] = [\n\taGalleryExtension('MockExtension1', {\n\t\tdisplayName: 'Mock Extension 1',\n\t\tversion: '1.5',\n\t\tpublisherId: 'mockPublisher1Id',\n\t\tpublisher: 'mockPublisher1',\n\t\tpublisherDisplayName: 'Mock Publisher 1',\n\t\tdescription: 'Mock Description',\n\t\tinstallCount: 1000,\n\t\trating: 4,\n\t\tratingCount: 100\n\t}, {\n\t\tdependencies: ['pub.1'],\n\t}, {\n\t\tmanifest: { uri: 'uri:manifest', fallbackUri: 'fallback:manifest' },\n\t\treadme: { uri: 'uri:readme', fallbackUri: 'fallback:readme' },\n\t\tchangelog: { uri: 'uri:changelog', fallbackUri: 'fallback:changlog' },\n\t\tdownload: { uri: 'uri:download', fallbackUri: 'fallback:download' },\n\t\ticon: { uri: 'uri:icon', fallbackUri: 'fallback:icon' },\n\t\tlicense: { uri: 'uri:license', fallbackUri: 'fallback:license' },\n\t\trepository: { uri: 'uri:repository', fallbackUri: 'fallback:repository' },\n\t\tsignature: { uri: 'uri:signature', fallbackUri: 'fallback:signature' },\n\t\tcoreTranslations: []\n\t}),\n\taGalleryExtension('MockExtension2', {\n\t\tdisplayName: 'Mock Extension 2',\n\t\tversion: '1.5',\n\t\tpublisherId: 'mockPublisher2Id',\n\t\tpublisher: 'mockPublisher2',\n\t\tpublisherDisplayName: 'Mock Publisher 2',\n\t\tdescription: 'Mock Description',\n\t\tinstallCount: 1000,\n\t\trating: 4,\n\t\tratingCount: 100\n\t}, {\n\t\tdependencies: ['pub.1', 'pub.2'],\n\t}, {\n\t\tmanifest: { uri: 'uri:manifest', fallbackUri: 'fallback:manifest' },\n\t\treadme: { uri: 'uri:readme', fallbackUri: 'fallback:readme' },\n\t\tchangelog: { uri: 'uri:changelog', fallbackUri: 'fallback:changlog' },\n\t\tdownload: { uri: 'uri:download', fallbackUri: 'fallback:download' },\n\t\ticon: { uri: 'uri:icon', fallbackUri: 'fallback:icon' },\n\t\tlicense: { uri: 'uri:license', fallbackUri: 'fallback:license' },\n\t\trepository: { uri: 'uri:repository', fallbackUri: 'fallback:repository' },\n\t\tsignature: { uri: 'uri:signature', fallbackUri: 'fallback:signature' },\n\t\tcoreTranslations: []\n\t})\n];\n\nconst mockExtensionLocal = [\n\t{\n\t\ttype: ExtensionType.User,\n\t\tidentifier: mockExtensionGallery[0].identifier,\n\t\tmanifest: {\n\t\t\tname: mockExtensionGallery[0].name,\n\t\t\tpublisher: mockExtensionGallery[0].publisher,\n\t\t\tversion: mockExtensionGallery[0].version\n\t\t},\n\t\tmetadata: null,\n\t\tpath: 'somepath',\n\t\treadmeUrl: 'some readmeUrl',\n\t\tchangelogUrl: 'some changelogUrl'\n\t},\n\t{\n\t\ttype: ExtensionType.User,\n\t\tidentifier: mockExtensionGallery[1].identifier,\n\t\tmanifest: {\n\t\t\tname: mockExtensionGallery[1].name,\n\t\t\tpublisher: mockExtensionGallery[1].publisher,\n\t\t\tversion: mockExtensionGallery[1].version\n\t\t},\n\t\tmetadata: null,\n\t\tpath: 'somepath',\n\t\treadmeUrl: 'some readmeUrl',\n\t\tchangelogUrl: 'some changelogUrl'\n\t}\n];\n\nconst mockTestData = {\n\trecommendedExtensions: [\n\t\t'mockPublisher1.mockExtension1',\n\t\t'MOCKPUBLISHER2.mockextension2',\n\t\t'badlyformattedextension',\n\t\t'MOCKPUBLISHER2.mockextension2',\n\t\t'unknown.extension'\n\t],\n\tvalidRecommendedExtensions: [\n\t\t'mockPublisher1.mockExtension1',\n\t\t'MOCKPUBLISHER2.mockextension2'\n\t]\n};\n\nfunction aPage<T>(...objects: T[]): IPager<T> {\n\treturn { firstPage: objects, total: objects.length, pageSize: objects.length, getPage: () => null! };\n}\n\nconst noAssets: IGalleryExtensionAssets = {\n\tchangelog: null,\n\tdownload: null!,\n\ticon: null!,\n\tlicense: null,\n\tmanifest: null,\n\treadme: null,\n\trepository: null,\n\tsignature: null,\n\tcoreTranslations: []\n};\n\nfunction aGalleryExtension(name: string, properties: any = {}, galleryExtensionProperties: any = {}, assets: IGalleryExtensionAssets = noAssets): IGalleryExtension {\n\tconst targetPlatform = getTargetPlatform(platform, arch);\n\tconst galleryExtension = <IGalleryExtension>Object.create({ name, publisher: 'pub', version: '1.0.0', allTargetPlatforms: [targetPlatform], properties: {}, assets: {}, ...properties });\n\tgalleryExtension.properties = { ...galleryExtension.properties, dependencies: [], targetPlatform, ...galleryExtensionProperties };\n\tgalleryExtension.assets = { ...galleryExtension.assets, ...assets };\n\tgalleryExtension.identifier = { id: getGalleryExtensionId(galleryExtension.publisher, galleryExtension.name), uuid: uuid.generateUuid() };\n\treturn <IGalleryExtension>galleryExtension;\n}\n\nsuite('ExtensionRecommendationsService Test', () => {\n\tlet disposableStore: DisposableStore;\n\tlet workspaceService: IWorkspaceContextService;\n\tlet instantiationService: TestInstantiationService;\n\tlet testConfigurationService: TestConfigurationService;\n\tlet testObject: ExtensionRecommendationsService;\n\tlet prompted: boolean;\n\tlet promptedEmitter: Emitter<void>;\n\tlet onModelAddedEvent: Emitter<ITextModel>;\n\n\tteardown(async () => {\n\t\tdisposableStore.dispose();\n\t\tawait timeout(0); // allow for async disposables to complete\n\t});\n\n\tensureNoDisposablesAreLeakedInTestSuite();\n\n\tsetup(() => {\n\t\tdisposableStore = new DisposableStore();\n\t\tinstantiationService = disposableStore.add(new TestInstantiationService());\n\t\tpromptedEmitter = disposableStore.add(new Emitter<void>());\n\t\tinstantiationService.stub(IExtensionGalleryService, ExtensionGalleryService);\n\t\tinstantiationService.stub(ISharedProcessService, TestSharedProcessService);\n\t\tinstantiationService.stub(ILifecycleService, disposableStore.add(new TestLifecycleService()));\n\t\ttestConfigurationService = new TestConfigurationService();\n\t\tinstantiationService.stub(IConfigurationService, testConfigurationService);\n\t\tinstantiationService.stub(IProductService, TestProductService);\n\t\tinstantiationService.stub(ILogService, NullLogService);\n\t\tconst fileService = new FileService(instantiationService.get(ILogService));\n\t\tinstantiationService.stub(IFileService, disposableStore.add(fileService));\n\t\tconst fileSystemProvider = disposableStore.add(new InMemoryFileSystemProvider());\n\t\tdisposableStore.add(fileService.registerProvider(ROOT.scheme, fileSystemProvider));\n\t\tinstantiationService.stub(IUriIdentityService, disposableStore.add(new UriIdentityService(instantiationService.get(IFileService))));\n\t\tinstantiationService.stub(INotificationService, new TestNotificationService());\n\t\tinstantiationService.stub(IContextKeyService, new MockContextKeyService());\n\t\tinstantiationService.stub(IWorkbenchExtensionManagementService, {\n\t\t\tonInstallExtension: Event.None,\n\t\t\tonDidInstallExtensions: Event.None,\n\t\t\tonUninstallExtension: Event.None,\n\t\t\tonDidUninstallExtension: Event.None,\n\t\t\tonDidUpdateExtensionMetadata: Event.None,\n\t\t\tonDidChangeProfile: Event.None,\n\t\t\tonProfileAwareDidInstallExtensions: Event.None,\n\t\t\tasync getInstalled() { return []; },\n\t\t\tasync canInstall() { return true; },\n\t\t\tasync getExtensionsControlManifest() { return { malicious: [], deprecated: {}, search: [], publisherMapping: {} }; },\n\t\t\tasync getTargetPlatform() { return getTargetPlatform(platform, arch); },\n\t\t});\n\t\tinstantiationService.stub(IExtensionService, {\n\t\t\tonDidChangeExtensions: Event.None,\n\t\t\textensions: [],\n\t\t\tasync whenInstalledExtensionsRegistered() { return true; }\n\t\t});\n\t\tinstantiationService.stub(IWorkbenchExtensionEnablementService, disposableStore.add(new TestExtensionEnablementService(instantiationService)));\n\t\tinstantiationService.stub(ITelemetryService, NullTelemetryService);\n\t\tinstantiationService.stub(IURLService, NativeURLService);\n\t\tinstantiationService.stub(IWorkspaceTagsService, new NoOpWorkspaceTagsService());\n\t\tinstantiationService.stub(IStorageService, disposableStore.add(new TestStorageService()));\n\t\tinstantiationService.stub(ILogService, new NullLogService());\n\t\tinstantiationService.stub(IProductService, {\n\t\t\textensionRecommendations: {\n\t\t\t\t'ms-python.python': {\n\t\t\t\t\tonFileOpen: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t'pathGlob': '{**/*.py}',\n\t\t\t\t\t\t\timportant: true\n\t\t\t\t\t\t}\n\t\t\t\t\t]\n\t\t\t\t},\n\t\t\t\t'ms-vscode.PowerShell': {\n\t\t\t\t\tonFileOpen: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t'pathGlob': '{**/*.ps,**/*.ps1}',\n\t\t\t\t\t\t\timportant: true\n\t\t\t\t\t\t}\n\t\t\t\t\t]\n\t\t\t\t},\n\t\t\t\t'ms-dotnettools.csharp': {\n\t\t\t\t\tonFileOpen: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t'pathGlob': '{**/*.cs,**/project.json,**/global.json,**/*.csproj,**/*.sln,**/appsettings.json}',\n\t\t\t\t\t\t}\n\t\t\t\t\t]\n\t\t\t\t},\n\t\t\t\t'msjsdiag.debugger-for-chrome': {\n\t\t\t\t\tonFileOpen: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t'pathGlob': '{**/*.ts,**/*.tsx,**/*.js,**/*.jsx,**/*.es6,**/*.mjs,**/*.cjs,**/.babelrc}',\n\t\t\t\t\t\t}\n\t\t\t\t\t]\n\t\t\t\t},\n\t\t\t\t'lukehoban.Go': {\n\t\t\t\t\tonFileOpen: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t'pathGlob': '**/*.go',\n\t\t\t\t\t\t}\n\t\t\t\t\t]\n\t\t\t\t}\n\t\t\t},\n\t\t});\n\n\t\tinstantiationService.stub(IUpdateService, { onStateChange: Event.None, state: State.Uninitialized });\n\t\tinstantiationService.set(IExtensionsWorkbenchService, disposableStore.add(instantiationService.createInstance(ExtensionsWorkbenchService)));\n\t\tinstantiationService.stub(IExtensionTipsService, disposableStore.add(instantiationService.createInstance(TestExtensionTipsService)));\n\n\t\tonModelAddedEvent = new Emitter<ITextModel>();\n\n\t\tinstantiationService.stub(IEnvironmentService, {});\n\t\tinstantiationService.stubPromise(IExtensionManagementService, 'getInstalled', []);\n\t\tinstantiationService.stub(IExtensionGalleryService, 'isEnabled', true);\n\t\tinstantiationService.stubPromise(IExtensionGalleryService, 'query', aPage<IGalleryExtension>(...mockExtensionGallery));\n\t\tinstantiationService.stubPromise(IExtensionGalleryService, 'getExtensions', mockExtensionGallery);\n\n\t\tprompted = false;\n\n\t\tclass TestNotificationService2 extends TestNotificationService {\n\t\t\tpublic override prompt(severity: Severity, message: string, choices: IPromptChoice[], options?: IPromptOptions) {\n\t\t\t\tprompted = true;\n\t\t\t\tpromptedEmitter.fire();\n\t\t\t\treturn super.prompt(severity, message, choices, options);\n\t\t\t}\n\t\t}\n\n\t\tinstantiationService.stub(INotificationService, new TestNotificationService2());\n\n\t\ttestConfigurationService.setUserConfiguration(ConfigurationKey, { ignoreRecommendations: false });\n\t\tinstantiationService.stub(IModelService, <IModelService>{\n\t\t\tgetModels(): any { return []; },\n\t\t\tonModelAdded: onModelAddedEvent.event\n\t\t});\n\t});\n\n\tfunction setUpFolderWorkspace(folderName: string, recommendedExtensions: string[], ignoredRecommendations: string[] = []): Promise<void> {\n\t\treturn setUpFolder(folderName, recommendedExtensions, ignoredRecommendations);\n\t}\n\n\tasync function setUpFolder(folderName: string, recommendedExtensions: string[], ignoredRecommendations: string[] = []): Promise<void> {\n\t\tconst fileService = instantiationService.get(IFileService);\n\t\tconst folderDir = joinPath(ROOT, folderName);\n\t\tconst workspaceSettingsDir = joinPath(folderDir, '.vscode');\n\t\tawait fileService.createFolder(workspaceSettingsDir);\n\t\tconst configPath = joinPath(workspaceSettingsDir, 'extensions.json');\n\t\tawait fileService.writeFile(configPath, VSBuffer.fromString(JSON.stringify({\n\t\t\t'recommendations': recommendedExtensions,\n\t\t\t'unwantedRecommendations': ignoredRecommendations,\n\t\t}, null, '\\t')));\n\n\t\tconst myWorkspace = testWorkspace(folderDir);\n\n\t\tinstantiationService.stub(IFileService, fileService);\n\t\tworkspaceService = new TestContextService(myWorkspace);\n\t\tinstantiationService.stub(IWorkspaceContextService, workspaceService);\n\t\tinstantiationService.stub(IWorkspaceExtensionsConfigService, disposableStore.add(instantiationService.createInstance(WorkspaceExtensionsConfigService)));\n\t\tinstantiationService.stub(IExtensionIgnoredRecommendationsService, disposableStore.add(instantiationService.createInstance(ExtensionIgnoredRecommendationsService)));\n\t\tinstantiationService.stub(IExtensionRecommendationNotificationService, disposableStore.add(instantiationService.createInstance(ExtensionRecommendationNotificationService)));\n\t}\n\n\tfunction testNoPromptForValidRecommendations(recommendations: string[]) {\n\t\treturn setUpFolderWorkspace('myFolder', recommendations).then(() => {\n\t\t\ttestObject = disposableStore.add(instantiationService.createInstance(ExtensionRecommendationsService));\n\t\t\treturn testObject.activationPromise.then(() => {\n\t\t\t\tassert.strictEqual(Object.keys(testObject.getAllRecommendationsWithReason()).length, recommendations.length);\n\t\t\t\tassert.ok(!prompted);\n\t\t\t});\n\t\t});\n\t}\n\n\tfunction testNoPromptOrRecommendationsForValidRecommendations(recommendations: string[]) {\n\t\treturn setUpFolderWorkspace('myFolder', mockTestData.validRecommendedExtensions).then(() => {\n\t\t\ttestObject = disposableStore.add(instantiationService.createInstance(ExtensionRecommendationsService));\n\t\t\tassert.ok(!prompted);\n\n\t\t\treturn testObject.getWorkspaceRecommendations().then(() => {\n\t\t\t\tassert.strictEqual(Object.keys(testObject.getAllRecommendationsWithReason()).length, 0);\n\t\t\t\tassert.ok(!prompted);\n\t\t\t});\n\t\t});\n\t}\n\n\ttest('ExtensionRecommendationsService: No Prompt for valid workspace recommendations when galleryService is absent', () => runWithFakedTimers<void>({ useFakeTimers: true }, async () => {\n\t\tconst galleryQuerySpy = sinon.spy();\n\t\tinstantiationService.stub(IExtensionGalleryService, { query: galleryQuerySpy, isEnabled: () => false });\n\n\t\treturn testNoPromptOrRecommendationsForValidRecommendations(mockTestData.validRecommendedExtensions)\n\t\t\t.then(() => assert.ok(galleryQuerySpy.notCalled));\n\t}));\n\n\ttest('ExtensionRecommendationsService: No Prompt for valid workspace recommendations during extension development', () => runWithFakedTimers<void>({ useFakeTimers: true }, async () => {\n\t\tinstantiationService.stub(IEnvironmentService, { extensionDevelopmentLocationURI: [URI.file('/folder/file')], isExtensionDevelopment: true });\n\t\treturn testNoPromptOrRecommendationsForValidRecommendations(mockTestData.validRecommendedExtensions);\n\t}));\n\n\ttest('ExtensionRecommendationsService: No workspace recommendations or prompts when extensions.json has empty array', () => runWithFakedTimers<void>({ useFakeTimers: true }, async () => {\n\t\treturn testNoPromptForValidRecommendations([]);\n\t}));\n\n\ttest('ExtensionRecommendationsService: Prompt for valid workspace recommendations', () => runWithFakedTimers<void>({ useFakeTimers: true }, async () => {\n\t\tawait setUpFolderWorkspace('myFolder', mockTestData.recommendedExtensions);\n\t\ttestObject = disposableStore.add(instantiationService.createInstance(ExtensionRecommendationsService));\n\n\t\tawait Event.toPromise(promptedEmitter.event);\n\t\tconst recommendations = Object.keys(testObject.getAllRecommendationsWithReason());\n\t\tconst expected = [...mockTestData.validRecommendedExtensions, 'unknown.extension'];\n\t\tassert.strictEqual(recommendations.length, expected.length);\n\t\texpected.forEach(x => {\n\t\t\tassert.strictEqual(recommendations.indexOf(x.toLowerCase()) > -1, true);\n\t\t});\n\t}));\n\n\ttest('ExtensionRecommendationsService: No Prompt for valid workspace recommendations if they are already installed', () => runWithFakedTimers<void>({ useFakeTimers: true }, async () => {\n\t\tinstantiationService.stubPromise(IExtensionManagementService, 'getInstalled', mockExtensionLocal);\n\t\treturn testNoPromptForValidRecommendations(mockTestData.validRecommendedExtensions);\n\t}));\n\n\ttest('ExtensionRecommendationsService: No Prompt for valid workspace recommendations with casing mismatch if they are already installed', () => runWithFakedTimers<void>({ useFakeTimers: true }, async () => {\n\t\tinstantiationService.stubPromise(IExtensionManagementService, 'getInstalled', mockExtensionLocal);\n\t\treturn testNoPromptForValidRecommendations(mockTestData.validRecommendedExtensions.map(x => x.toUpperCase()));\n\t}));\n\n\ttest('ExtensionRecommendationsService: No Prompt for valid workspace recommendations if ignoreRecommendations is set', () => runWithFakedTimers<void>({ useFakeTimers: true }, async () => {\n\t\ttestConfigurationService.setUserConfiguration(ConfigurationKey, { ignoreRecommendations: true });\n\t\treturn testNoPromptForValidRecommendations(mockTestData.validRecommendedExtensions);\n\t}));\n\n\ttest('ExtensionRecommendationsService: No Prompt for valid workspace recommendations if showRecommendationsOnlyOnDemand is set', () => runWithFakedTimers<void>({ useFakeTimers: true }, async () => {\n\t\ttestConfigurationService.setUserConfiguration(ConfigurationKey, { showRecommendationsOnlyOnDemand: true });\n\t\treturn setUpFolderWorkspace('myFolder', mockTestData.validRecommendedExtensions).then(() => {\n\t\t\ttestObject = disposableStore.add(instantiationService.createInstance(ExtensionRecommendationsService));\n\t\t\treturn testObject.activationPromise.then(() => {\n\t\t\t\tassert.ok(!prompted);\n\t\t\t});\n\t\t});\n\t}));\n\n\ttest('ExtensionRecommendationsService: No Prompt for valid workspace recommendations if ignoreRecommendations is set for current workspace', () => runWithFakedTimers<void>({ useFakeTimers: true }, async () => {\n\t\tinstantiationService.get(IStorageService).store('extensionsAssistant/workspaceRecommendationsIgnore', true, StorageScope.WORKSPACE, StorageTarget.MACHINE);\n\t\treturn testNoPromptForValidRecommendations(mockTestData.validRecommendedExtensions);\n\t}));\n\n\ttest('ExtensionRecommendationsService: No Recommendations of globally ignored recommendations', () => runWithFakedTimers<void>({ useFakeTimers: true }, async () => {\n\t\tinstantiationService.get(IStorageService).store('extensionsAssistant/workspaceRecommendationsIgnore', true, StorageScope.WORKSPACE, StorageTarget.MACHINE);\n\t\tinstantiationService.get(IStorageService).store('extensionsAssistant/recommendations', '[\"ms-dotnettools.csharp\", \"ms-python.python\", \"ms-vscode.vscode-typescript-tslint-plugin\"]', StorageScope.PROFILE, StorageTarget.MACHINE);\n\t\tinstantiationService.get(IStorageService).store('extensionsAssistant/ignored_recommendations', '[\"ms-dotnettools.csharp\", \"mockpublisher2.mockextension2\"]', StorageScope.PROFILE, StorageTarget.MACHINE);\n\n\t\treturn setUpFolderWorkspace('myFolder', mockTestData.validRecommendedExtensions).then(() => {\n\t\t\ttestObject = disposableStore.add(instantiationService.createInstance(ExtensionRecommendationsService));\n\t\t\treturn testObject.activationPromise.then(() => {\n\t\t\t\tconst recommendations = testObject.getAllRecommendationsWithReason();\n\t\t\t\tassert.ok(!recommendations['ms-dotnettools.csharp']); // stored recommendation that has been globally ignored\n\t\t\t\tassert.ok(recommendations['ms-python.python']); // stored recommendation\n\t\t\t\tassert.ok(recommendations['mockpublisher1.mockextension1']); // workspace recommendation\n\t\t\t\tassert.ok(!recommendations['mockpublisher2.mockextension2']); // workspace recommendation that has been globally ignored\n\t\t\t});\n\t\t});\n\t}));\n\n\ttest('ExtensionRecommendationsService: No Recommendations of workspace ignored recommendations', () => runWithFakedTimers<void>({ useFakeTimers: true }, async () => {\n\t\tconst ignoredRecommendations = ['ms-dotnettools.csharp', 'mockpublisher2.mockextension2']; // ignore a stored recommendation and a workspace recommendation.\n\t\tconst storedRecommendations = '[\"ms-dotnettools.csharp\", \"ms-python.python\"]';\n\t\tinstantiationService.get(IStorageService).store('extensionsAssistant/workspaceRecommendationsIgnore', true, StorageScope.WORKSPACE, StorageTarget.MACHINE);\n\t\tinstantiationService.get(IStorageService).store('extensionsAssistant/recommendations', storedRecommendations, StorageScope.PROFILE, StorageTarget.MACHINE);\n\n\t\treturn setUpFolderWorkspace('myFolder', mockTestData.validRecommendedExtensions, ignoredRecommendations).then(() => {\n\t\t\ttestObject = disposableStore.add(instantiationService.createInstance(ExtensionRecommendationsService));\n\t\t\treturn testObject.activationPromise.then(() => {\n\t\t\t\tconst recommendations = testObject.getAllRecommendationsWithReason();\n\t\t\t\tassert.ok(!recommendations['ms-dotnettools.csharp']); // stored recommendation that has been workspace ignored\n\t\t\t\tassert.ok(recommendations['ms-python.python']); // stored recommendation\n\t\t\t\tassert.ok(recommendations['mockpublisher1.mockextension1']); // workspace recommendation\n\t\t\t\tassert.ok(!recommendations['mockpublisher2.mockextension2']); // workspace recommendation that has been workspace ignored\n\t\t\t});\n\t\t});\n\t}));\n\n\ttest('ExtensionRecommendationsService: Able to retrieve collection of all ignored recommendations', async () => runWithFakedTimers<void>({ useFakeTimers: true }, async () => {\n\n\t\tconst storageService = instantiationService.get(IStorageService);\n\t\tconst workspaceIgnoredRecommendations = ['ms-dotnettools.csharp']; // ignore a stored recommendation and a workspace recommendation.\n\t\tconst storedRecommendations = '[\"ms-dotnettools.csharp\", \"ms-python.python\"]';\n\t\tconst globallyIgnoredRecommendations = '[\"mockpublisher2.mockextension2\"]'; // ignore a workspace recommendation.\n\t\tstorageService.store('extensionsAssistant/workspaceRecommendationsIgnore', true, StorageScope.WORKSPACE, StorageTarget.MACHINE);\n\t\tstorageService.store('extensionsAssistant/recommendations', storedRecommendations, StorageScope.PROFILE, StorageTarget.MACHINE);\n\t\tstorageService.store('extensionsAssistant/ignored_recommendations', globallyIgnoredRecommendations, StorageScope.PROFILE, StorageTarget.MACHINE);\n\n\t\tawait setUpFolderWorkspace('myFolder', mockTestData.validRecommendedExtensions, workspaceIgnoredRecommendations);\n\t\ttestObject = disposableStore.add(instantiationService.createInstance(ExtensionRecommendationsService));\n\t\tawait testObject.activationPromise;\n\n\t\tconst recommendations = testObject.getAllRecommendationsWithReason();\n\t\tassert.deepStrictEqual(Object.keys(recommendations), ['ms-python.python', 'mockpublisher1.mockextension1']);\n\t}));\n\n\ttest('ExtensionRecommendationsService: Able to dynamically ignore/unignore global recommendations', async () => runWithFakedTimers<void>({ useFakeTimers: true }, async () => {\n\t\tconst storageService = instantiationService.get(IStorageService);\n\n\t\tconst storedRecommendations = '[\"ms-dotnettools.csharp\", \"ms-python.python\"]';\n\t\tconst globallyIgnoredRecommendations = '[\"mockpublisher2.mockextension2\"]'; // ignore a workspace recommendation.\n\t\tstorageService.store('extensionsAssistant/workspaceRecommendationsIgnore', true, StorageScope.WORKSPACE, StorageTarget.MACHINE);\n\t\tstorageService.store('extensionsAssistant/recommendations', storedRecommendations, StorageScope.PROFILE, StorageTarget.MACHINE);\n\t\tstorageService.store('extensionsAssistant/ignored_recommendations', globallyIgnoredRecommendations, StorageScope.PROFILE, StorageTarget.MACHINE);\n\n\t\tawait setUpFolderWorkspace('myFolder', mockTestData.validRecommendedExtensions);\n\t\tconst extensionIgnoredRecommendationsService = instantiationService.get(IExtensionIgnoredRecommendationsService);\n\t\ttestObject = disposableStore.add(instantiationService.createInstance(ExtensionRecommendationsService));\n\t\tawait testObject.activationPromise;\n\n\t\tlet recommendations = testObject.getAllRecommendationsWithReason();\n\t\tassert.ok(recommendations['ms-python.python']);\n\t\tassert.ok(recommendations['mockpublisher1.mockextension1']);\n\t\tassert.ok(!recommendations['mockpublisher2.mockextension2']);\n\n\t\textensionIgnoredRecommendationsService.toggleGlobalIgnoredRecommendation('mockpublisher1.mockextension1', true);\n\n\t\trecommendations = testObject.getAllRecommendationsWithReason();\n\t\tassert.ok(recommendations['ms-python.python']);\n\t\tassert.ok(!recommendations['mockpublisher1.mockextension1']);\n\t\tassert.ok(!recommendations['mockpublisher2.mockextension2']);\n\n\t\textensionIgnoredRecommendationsService.toggleGlobalIgnoredRecommendation('mockpublisher1.mockextension1', false);\n\n\t\trecommendations = testObject.getAllRecommendationsWithReason();\n\t\tassert.ok(recommendations['ms-python.python']);\n\t\tassert.ok(recommendations['mockpublisher1.mockextension1']);\n\t\tassert.ok(!recommendations['mockpublisher2.mockextension2']);\n\t}));\n\n\ttest('test global extensions are modified and recommendation change event is fired when an extension is ignored', async () => runWithFakedTimers<void>({ useFakeTimers: true }, async () => {\n\t\tconst storageService = instantiationService.get(IStorageService);\n\t\tconst changeHandlerTarget = sinon.spy();\n\t\tconst ignoredExtensionId = 'Some.Extension';\n\n\t\tstorageService.store('extensionsAssistant/workspaceRecommendationsIgnore', true, StorageScope.WORKSPACE, StorageTarget.MACHINE);\n\t\tstorageService.store('extensionsAssistant/ignored_recommendations', '[\"ms-vscode.vscode\"]', StorageScope.PROFILE, StorageTarget.MACHINE);\n\n\t\tawait setUpFolderWorkspace('myFolder', []);\n\t\ttestObject = disposableStore.add(instantiationService.createInstance(ExtensionRecommendationsService));\n\t\tconst extensionIgnoredRecommendationsService = instantiationService.get(IExtensionIgnoredRecommendationsService);\n\t\tdisposableStore.add(extensionIgnoredRecommendationsService.onDidChangeGlobalIgnoredRecommendation(changeHandlerTarget));\n\t\textensionIgnoredRecommendationsService.toggleGlobalIgnoredRecommendation(ignoredExtensionId, true);\n\t\tawait testObject.activationPromise;\n\n\t\tassert.ok(changeHandlerTarget.calledOnce);\n\t\tassert.ok(changeHandlerTarget.getCall(0).calledWithMatch({ extensionId: ignoredExtensionId.toLowerCase(), isRecommended: false }));\n\t}));\n\n\ttest('ExtensionRecommendationsService: Get file based recommendations from storage (old format)', () => runWithFakedTimers<void>({ useFakeTimers: true }, async () => {\n\t\tconst storedRecommendations = '[\"ms-dotnettools.csharp\", \"ms-python.python\", \"ms-vscode.vscode-typescript-tslint-plugin\"]';\n\t\tinstantiationService.get(IStorageService).store('extensionsAssistant/recommendations', storedRecommendations, StorageScope.PROFILE, StorageTarget.MACHINE);\n\n\t\treturn setUpFolderWorkspace('myFolder', []).then(() => {\n\t\t\ttestObject = disposableStore.add(instantiationService.createInstance(ExtensionRecommendationsService));\n\t\t\treturn testObject.activationPromise.then(() => {\n\t\t\t\tconst recommendations = testObject.getFileBasedRecommendations();\n\t\t\t\tassert.strictEqual(recommendations.length, 2);\n\t\t\t\tassert.ok(recommendations.some(extensionId => extensionId === 'ms-dotnettools.csharp')); // stored recommendation that exists in product.extensionTips\n\t\t\t\tassert.ok(recommendations.some(extensionId => extensionId === 'ms-python.python')); // stored recommendation that exists in product.extensionImportantTips\n\t\t\t\tassert.ok(recommendations.every(extensionId => extensionId !== 'ms-vscode.vscode-typescript-tslint-plugin')); // stored recommendation that is no longer in neither product.extensionTips nor product.extensionImportantTips\n\t\t\t});\n\t\t});\n\t}));\n\n\ttest('ExtensionRecommendationsService: Get file based recommendations from storage (new format)', async () => {\n\t\tconst milliSecondsInADay = 1000 * 60 * 60 * 24;\n\t\tconst now = Date.now();\n\t\tconst tenDaysOld = 10 * milliSecondsInADay;\n\t\tconst storedRecommendations = `{\"ms-dotnettools.csharp\": ${now}, \"ms-python.python\": ${now}, \"ms-vscode.vscode-typescript-tslint-plugin\": ${now}, \"lukehoban.Go\": ${tenDaysOld}}`;\n\t\tinstantiationService.get(IStorageService).store('extensionsAssistant/recommendations', storedRecommendations, StorageScope.PROFILE, StorageTarget.MACHINE);\n\n\t\tawait setUpFolderWorkspace('myFolder', []);\n\t\ttestObject = disposableStore.add(instantiationService.createInstance(ExtensionRecommendationsService));\n\t\tawait testObject.activationPromise;\n\n\t\tconst recommendations = testObject.getFileBasedRecommendations();\n\t\tassert.strictEqual(recommendations.length, 2);\n\t\tassert.ok(recommendations.some(extensionId => extensionId === 'ms-dotnettools.csharp')); // stored recommendation that exists in product.extensionTips\n\t\tassert.ok(recommendations.some(extensionId => extensionId === 'ms-python.python')); // stored recommendation that exists in product.extensionImportantTips\n\t\tassert.ok(recommendations.every(extensionId => extensionId !== 'ms-vscode.vscode-typescript-tslint-plugin')); // stored recommendation that is no longer in neither product.extensionTips nor product.extensionImportantTips\n\t\tassert.ok(recommendations.every(extensionId => extensionId !== 'lukehoban.Go')); //stored recommendation that is older than a week\n\t});\n});\n"]}