{"version":3,"sources":["vs/workbench/contrib/extensions/common/searchExtensionsTool.ts"],"names":[],"mappings":"AAAA;;;gGAGgG;;;;;;;;;;AAGhG,OAAO,EAAE,OAAO,EAAE,MAAM,qCAAqC,CAAC;AAC9D,OAAO,EAAE,SAAS,EAAE,MAAM,sCAAsC,CAAC;AACjE,OAAO,EAAE,QAAQ,EAAE,MAAM,oBAAoB,CAAC;AAE9C,OAAO,EAAE,oBAAoB,EAAE,MAAM,sDAAsD,CAAC;AAC5F,OAAO,EAA2E,cAAc,EAAgB,MAAM,gDAAgD,CAAC;AACvK,OAAO,EAA8B,2BAA2B,EAAE,MAAM,yBAAyB,CAAC;AAElG,MAAM,CAAC,MAAM,sBAAsB,GAAG,kCAAkC,CAAC;AAEzE,MAAM,CAAC,MAAM,wBAAwB,GAAc;IAClD,EAAE,EAAE,sBAAsB;IAC1B,iBAAiB,EAAE,YAAY;IAC/B,4BAA4B,EAAE,CAAC,YAAY,CAAC;IAC5C,IAAI,EAAE,SAAS,CAAC,MAAM,CAAC,OAAO,CAAC,UAAU,CAAC,EAAE,CAAC;IAC7C,WAAW,EAAE,QAAQ,CAAC,IAAkC,EAAE,IAAmB,CAAC;IAC9E,gBAAgB,EAAE,ifAAif;IACngB,eAAe,EAAE,QAAQ,CAAC,IAAsC,EAAE,IAA+B,CAAC;IAClG,MAAM,EAAE,cAAc,CAAC,QAAQ;IAC/B,WAAW,EAAE;QACZ,IAAI,EAAE,QAAQ;QACd,UAAU,EAAE;YACX,QAAQ,EAAE;gBACT,IAAI,EAAE,QAAQ;gBACd,WAAW,EAAE,0CAA0C;gBACvD,IAAI,EAAE,oBAAoB;aAC1B;YACD,QAAQ,EAAE;gBACT,IAAI,EAAE,OAAO;gBACb,KAAK,EAAE;oBACN,IAAI,EAAE,QAAQ;iBACd;gBACD,WAAW,EAAE,4BAA4B;aACzC;YACD,GAAG,EAAE;gBACJ,IAAI,EAAE,OAAO;gBACb,KAAK,EAAE;oBACN,IAAI,EAAE,QAAQ;iBACd;gBACD,WAAW,EAAE,yCAAyC;aACtD;SACD;KACD;CACD,CAAC;AAmBK,IAAM,oBAAoB,GAA1B,MAAM,oBAAoB;IAEhC,YAC+C,yBAAsD;QAAtD,8BAAyB,GAAzB,yBAAyB,CAA6B;IACjG,CAAC;IAEL,KAAK,CAAC,MAAM,CAAC,UAA2B,EAAE,YAAiC,EAAE,SAAuB,EAAE,KAAwB;QAC7H,MAAM,MAAM,GAAG,UAAU,CAAC,UAAyB,CAAC;QACpD,IAAI,CAAC,MAAM,CAAC,QAAQ,EAAE,MAAM,IAAI,CAAC,MAAM,CAAC,QAAQ,IAAI,CAAC,MAAM,CAAC,GAAG,EAAE,MAAM,EAAE,CAAC;YACzE,OAAO;gBACN,OAAO,EAAE,CAAC;wBACT,IAAI,EAAE,MAAM;wBACZ,KAAK,EAAE,QAAQ,CAAC,IAA8B,EAAE,IAA6D,CAAC;qBAC9G,CAAC;aACF,CAAC;QACH,CAAC;QAED,MAAM,aAAa,GAAG,IAAI,GAAG,EAAyB,CAAC;QAEvD,MAAM,YAAY,GAAG,CAAC,UAAwB,EAAE,EAAE;YACjD,KAAK,MAAM,SAAS,IAAI,UAAU,EAAE,CAAC;gBACpC,IAAI,SAAS,CAAC,eAAe,IAAI,SAAS,CAAC,WAAW,EAAE,CAAC;oBACxD,SAAS;gBACV,CAAC;gBACD,aAAa,CAAC,GAAG,CAAC,SAAS,CAAC,UAAU,CAAC,EAAE,CAAC,WAAW,EAAE,EAAE;oBACxD,EAAE,EAAE,SAAS,CAAC,UAAU,CAAC,EAAE;oBAC3B,IAAI,EAAE,SAAS,CAAC,WAAW;oBAC3B,WAAW,EAAE,SAAS,CAAC,WAAW;oBAClC,SAAS,EAAE,SAAS,CAAC,KAAK,qCAA6B;oBACvD,YAAY,EAAE,SAAS,CAAC,YAAY,IAAI,CAAC;oBACzC,MAAM,EAAE,SAAS,CAAC,MAAM,IAAI,CAAC;oBAC7B,UAAU,EAAE,SAAS,CAAC,UAAU,IAAI,EAAE;oBACtC,IAAI,EAAE,SAAS,CAAC,OAAO,EAAE,IAAI,IAAI,EAAE;iBACnC,CAAC,CAAC;YACJ,CAAC;QACF,CAAC,CAAC;QAEF,MAAM,qBAAqB,GAAG,KAAK,EAAE,IAAY,EAAE,EAAE;YACpD,MAAM,UAAU,GAAG,MAAM,IAAI,CAAC,yBAAyB,CAAC,YAAY,CAAC;gBACpE,IAAI;gBACJ,QAAQ,EAAE,EAAE;gBACZ,MAAM,0CAAqB;aAC3B,EAAE,KAAK,CAAC,CAAC;YACV,IAAI,UAAU,CAAC,SAAS,CAAC,MAAM,EAAE,CAAC;gBACjC,YAAY,CAAC,UAAU,CAAC,SAAS,CAAC,CAAC;YACpC,CAAC;QACF,CAAC,CAAC;QAEF,qCAAqC;QACrC,IAAI,MAAM,CAAC,GAAG,EAAE,MAAM,EAAE,CAAC;YACxB,MAAM,UAAU,GAAG,MAAM,IAAI,CAAC,yBAAyB,CAAC,aAAa,CAAC,MAAM,CAAC,GAAG,CAAC,GAAG,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,EAAE,EAAE,EAAE,CAAC,CAAC,EAAE,KAAK,CAAC,CAAC;YAC7G,YAAY,CAAC,UAAU,CAAC,CAAC;QAC1B,CAAC;QAED,IAAI,MAAM,CAAC,QAAQ,EAAE,MAAM,EAAE,CAAC;YAC7B,KAAK,MAAM,OAAO,IAAI,MAAM,CAAC,QAAQ,IAAI,EAAE,EAAE,CAAC;gBAC7C,IAAI,OAAO,KAAK,UAAU,EAAE,CAAC;oBAC5B,MAAM,qBAAqB,CAAC,UAAU,CAAC,CAAC;gBACzC,CAAC;qBAAM,CAAC;oBACP,IAAI,IAAI,GAAG,MAAM,CAAC,QAAQ,CAAC,CAAC,CAAC,aAAa,MAAM,CAAC,QAAQ,GAAG,CAAC,CAAC,CAAC,EAAE,CAAC;oBAClE,IAAI,GAAG,OAAO,CAAC,CAAC,CAAC,GAAG,IAAI,IAAI,OAAO,EAAE,CAAC,IAAI,EAAE,CAAC,CAAC,CAAC,IAAI,CAAC;oBACpD,MAAM,qBAAqB,CAAC,IAAI,CAAC,CAAC;gBACnC,CAAC;YACF,CAAC;QACF,CAAC;aAAM,CAAC;YACP,MAAM,qBAAqB,CAAC,aAAa,MAAM,CAAC,QAAQ,GAAG,CAAC,CAAC;QAC9D,CAAC;QAED,MAAM,MAAM,GAAG,KAAK,CAAC,IAAI,CAAC,aAAa,CAAC,MAAM,EAAE,CAAC,CAAC;QAElD,OAAO;YACN,OAAO,EAAE,CAAC;oBACT,IAAI,EAAE,MAAM;oBACZ,KAAK,EAAE,qCAAqC,IAAI,CAAC,SAAS,CAAC,MAAM,CAAC,kTAAkT;iBACpX,CAAC;YACF,iBAAiB,EAAE;gBAClB,KAAK,EAAE,IAAI,CAAC,SAAS,CAAC,MAAM,CAAC;gBAC7B,MAAM,EAAE,CAAC,EAAE,IAAI,EAAE,OAAO,EAAE,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,IAAI,CAAC,SAAS,CAAC,MAAM,CAAC,GAAG,CAAC,SAAS,CAAC,EAAE,CAAC,SAAS,CAAC,EAAE,CAAC,CAAC,EAAE,CAAC;aACvG;SACD,CAAC;IACH,CAAC;CACD,CAAA;AAjFY,oBAAoB;IAG9B,WAAA,2BAA2B,CAAA;GAHjB,oBAAoB,CAiFhC","file":"searchExtensionsTool.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { CancellationToken } from '../../../../base/common/cancellation.js';\nimport { Codicon } from '../../../../base/common/codicons.js';\nimport { ThemeIcon } from '../../../../base/common/themables.js';\nimport { localize } from '../../../../nls.js';\nimport { SortBy } from '../../../../platform/extensionManagement/common/extensionManagement.js';\nimport { EXTENSION_CATEGORIES } from '../../../../platform/extensions/common/extensions.js';\nimport { CountTokensCallback, IToolData, IToolImpl, IToolInvocation, IToolResult, ToolDataSource, ToolProgress } from '../../chat/common/languageModelToolsService.js';\nimport { ExtensionState, IExtension, IExtensionsWorkbenchService } from '../common/extensions.js';\n\nexport const SearchExtensionsToolId = 'vscode_searchExtensions_internal';\n\nexport const SearchExtensionsToolData: IToolData = {\n\tid: SearchExtensionsToolId,\n\ttoolReferenceName: 'extensions',\n\tlegacyToolReferenceFullNames: ['extensions'],\n\ticon: ThemeIcon.fromId(Codicon.extensions.id),\n\tdisplayName: localize('searchExtensionsTool.displayName', 'Search Extensions'),\n\tmodelDescription: 'This is a tool for browsing Visual Studio Code Extensions Marketplace. It allows the model to search for extensions and retrieve detailed information about them. The model should use this tool whenever it needs to discover extensions or resolve information about known ones. To use the tool, the model has to provide the category of the extensions, relevant search keywords, or known extension IDs. Note that search results may include false positives, so reviewing and filtering is recommended.',\n\tuserDescription: localize('searchExtensionsTool.userDescription', 'Search for VS Code extensions'),\n\tsource: ToolDataSource.Internal,\n\tinputSchema: {\n\t\ttype: 'object',\n\t\tproperties: {\n\t\t\tcategory: {\n\t\t\t\ttype: 'string',\n\t\t\t\tdescription: 'The category of extensions to search for',\n\t\t\t\tenum: EXTENSION_CATEGORIES,\n\t\t\t},\n\t\t\tkeywords: {\n\t\t\t\ttype: 'array',\n\t\t\t\titems: {\n\t\t\t\t\ttype: 'string',\n\t\t\t\t},\n\t\t\t\tdescription: 'The keywords to search for',\n\t\t\t},\n\t\t\tids: {\n\t\t\t\ttype: 'array',\n\t\t\t\titems: {\n\t\t\t\t\ttype: 'string',\n\t\t\t\t},\n\t\t\t\tdescription: 'The ids of the extensions to search for',\n\t\t\t},\n\t\t},\n\t}\n};\n\ntype InputParams = {\n\tcategory?: string;\n\tkeywords?: string;\n\tids?: string[];\n};\n\ntype ExtensionData = {\n\tid: string;\n\tname: string;\n\tdescription: string;\n\tinstalled: boolean;\n\tinstallCount: number;\n\trating: number;\n\tcategories: readonly string[];\n\ttags: readonly string[];\n};\n\nexport class SearchExtensionsTool implements IToolImpl {\n\n\tconstructor(\n\t\t@IExtensionsWorkbenchService private readonly extensionWorkbenchService: IExtensionsWorkbenchService,\n\t) { }\n\n\tasync invoke(invocation: IToolInvocation, _countTokens: CountTokensCallback, _progress: ToolProgress, token: CancellationToken): Promise<IToolResult> {\n\t\tconst params = invocation.parameters as InputParams;\n\t\tif (!params.keywords?.length && !params.category && !params.ids?.length) {\n\t\t\treturn {\n\t\t\t\tcontent: [{\n\t\t\t\t\tkind: 'text',\n\t\t\t\t\tvalue: localize('searchExtensionsTool.noInput', 'Please provide a category or keywords or ids to search for.')\n\t\t\t\t}]\n\t\t\t};\n\t\t}\n\n\t\tconst extensionsMap = new Map<string, ExtensionData>();\n\n\t\tconst addExtension = (extensions: IExtension[]) => {\n\t\t\tfor (const extension of extensions) {\n\t\t\t\tif (extension.deprecationInfo || extension.isMalicious) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\textensionsMap.set(extension.identifier.id.toLowerCase(), {\n\t\t\t\t\tid: extension.identifier.id,\n\t\t\t\t\tname: extension.displayName,\n\t\t\t\t\tdescription: extension.description,\n\t\t\t\t\tinstalled: extension.state === ExtensionState.Installed,\n\t\t\t\t\tinstallCount: extension.installCount ?? 0,\n\t\t\t\t\trating: extension.rating ?? 0,\n\t\t\t\t\tcategories: extension.categories ?? [],\n\t\t\t\t\ttags: extension.gallery?.tags ?? []\n\t\t\t\t});\n\t\t\t}\n\t\t};\n\n\t\tconst queryAndAddExtensions = async (text: string) => {\n\t\t\tconst extensions = await this.extensionWorkbenchService.queryGallery({\n\t\t\t\ttext,\n\t\t\t\tpageSize: 10,\n\t\t\t\tsortBy: SortBy.InstallCount\n\t\t\t}, token);\n\t\t\tif (extensions.firstPage.length) {\n\t\t\t\taddExtension(extensions.firstPage);\n\t\t\t}\n\t\t};\n\n\t\t// Search for extensions by their ids\n\t\tif (params.ids?.length) {\n\t\t\tconst extensions = await this.extensionWorkbenchService.getExtensions(params.ids.map(id => ({ id })), token);\n\t\t\taddExtension(extensions);\n\t\t}\n\n\t\tif (params.keywords?.length) {\n\t\t\tfor (const keyword of params.keywords ?? []) {\n\t\t\t\tif (keyword === 'featured') {\n\t\t\t\t\tawait queryAndAddExtensions('featured');\n\t\t\t\t} else {\n\t\t\t\t\tlet text = params.category ? `category:\"${params.category}\"` : '';\n\t\t\t\t\ttext = keyword ? `${text} ${keyword}`.trim() : text;\n\t\t\t\t\tawait queryAndAddExtensions(text);\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tawait queryAndAddExtensions(`category:\"${params.category}\"`);\n\t\t}\n\n\t\tconst result = Array.from(extensionsMap.values());\n\n\t\treturn {\n\t\t\tcontent: [{\n\t\t\t\tkind: 'text',\n\t\t\t\tvalue: `Here are the list of extensions:\\n${JSON.stringify(result)}\\n. Important: Use the following format to display extensions to the user because there is a renderer available to parse these extensions in this format and display them with all details. So, do not describe about the extensions to the user.\\n\\`\\`\\`vscode-extensions\\nextensionId1,extensionId2\\n\\`\\`\\`\\n.`\n\t\t\t}],\n\t\t\ttoolResultDetails: {\n\t\t\t\tinput: JSON.stringify(params),\n\t\t\t\toutput: [{ type: 'embed', isText: true, value: JSON.stringify(result.map(extension => extension.id)) }]\n\t\t\t}\n\t\t};\n\t}\n}\n"]}