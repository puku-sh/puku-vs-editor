{"version":3,"sources":["vs/workbench/contrib/extensions/browser/extensionsCompletionItemsProvider.ts"],"names":[],"mappings":"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","file":"extensionsCompletionItemsProvider.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { localize } from '../../../../nls.js';\nimport { CancellationToken } from '../../../../base/common/cancellation.js';\nimport { getLocation, parse } from '../../../../base/common/json.js';\nimport { Disposable } from '../../../../base/common/lifecycle.js';\nimport { Position } from '../../../../editor/common/core/position.js';\nimport { ITextModel } from '../../../../editor/common/model.js';\nimport { CompletionContext, CompletionList, CompletionItemKind, CompletionItem } from '../../../../editor/common/languages.js';\nimport { IExtensionManagementService } from '../../../../platform/extensionManagement/common/extensionManagement.js';\nimport { IWorkbenchContribution } from '../../../common/contributions.js';\nimport { Range } from '../../../../editor/common/core/range.js';\nimport { ILanguageFeaturesService } from '../../../../editor/common/services/languageFeatures.js';\n\n\nexport class ExtensionsCompletionItemsProvider extends Disposable implements IWorkbenchContribution {\n\tconstructor(\n\t\t@IExtensionManagementService private readonly extensionManagementService: IExtensionManagementService,\n\t\t@ILanguageFeaturesService languageFeaturesService: ILanguageFeaturesService,\n\t) {\n\t\tsuper();\n\n\t\tthis._register(languageFeaturesService.completionProvider.register({ language: 'jsonc', pattern: '**/settings.json' }, {\n\t\t\t_debugDisplayName: 'extensionsCompletionProvider',\n\t\t\tprovideCompletionItems: async (model: ITextModel, position: Position, _context: CompletionContext, token: CancellationToken): Promise<CompletionList> => {\n\t\t\t\tconst getWordRangeAtPosition = (model: ITextModel, position: Position): Range | null => {\n\t\t\t\t\tconst wordAtPosition = model.getWordAtPosition(position);\n\t\t\t\t\treturn wordAtPosition ? new Range(position.lineNumber, wordAtPosition.startColumn, position.lineNumber, wordAtPosition.endColumn) : null;\n\t\t\t\t};\n\n\t\t\t\tconst location = getLocation(model.getValue(), model.getOffsetAt(position));\n\t\t\t\tconst range = getWordRangeAtPosition(model, position) ?? Range.fromPositions(position, position);\n\n\t\t\t\t// extensions.supportUntrustedWorkspaces\n\t\t\t\tif (location.path[0] === 'extensions.supportUntrustedWorkspaces' && location.path.length === 2 && location.isAtPropertyKey) {\n\t\t\t\t\tlet alreadyConfigured: string[] = [];\n\t\t\t\t\ttry {\n\t\t\t\t\t\talreadyConfigured = Object.keys(parse(model.getValue())['extensions.supportUntrustedWorkspaces']);\n\t\t\t\t\t} catch (e) {/* ignore error */ }\n\n\t\t\t\t\treturn { suggestions: await this.provideSupportUntrustedWorkspacesExtensionProposals(alreadyConfigured, range) };\n\t\t\t\t}\n\n\t\t\t\treturn { suggestions: [] };\n\t\t\t}\n\t\t}));\n\t}\n\n\tprivate async provideSupportUntrustedWorkspacesExtensionProposals(alreadyConfigured: string[], range: Range): Promise<CompletionItem[]> {\n\t\tconst suggestions: CompletionItem[] = [];\n\t\tconst installedExtensions = (await this.extensionManagementService.getInstalled()).filter(e => e.manifest.main);\n\t\tconst proposedExtensions = installedExtensions.filter(e => alreadyConfigured.indexOf(e.identifier.id) === -1);\n\n\t\tif (proposedExtensions.length) {\n\t\t\tsuggestions.push(...proposedExtensions.map(e => {\n\t\t\t\tconst text = `\"${e.identifier.id}\": {\\n\\t\"supported\": true,\\n\\t\"version\": \"${e.manifest.version}\"\\n},`;\n\t\t\t\treturn { label: e.identifier.id, kind: CompletionItemKind.Value, insertText: text, filterText: text, range };\n\t\t\t}));\n\t\t} else {\n\t\t\tconst text = '\"vscode.csharp\": {\\n\\t\"supported\": true,\\n\\t\"version\": \"0.0.0\"\\n},';\n\t\t\tsuggestions.push({ label: localize('exampleExtension', \"Example\"), kind: CompletionItemKind.Value, insertText: text, filterText: text, range });\n\t\t}\n\n\t\treturn suggestions;\n\t}\n}\n"]}