{"version":3,"sources":["vs/workbench/contrib/extensions/browser/workspaceRecommendations.ts"],"names":[],"mappings":"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","file":"workspaceRecommendations.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { EXTENSION_IDENTIFIER_PATTERN } from '../../../../platform/extensionManagement/common/extensionManagement.js';\nimport { distinct, equals } from '../../../../base/common/arrays.js';\nimport { ExtensionRecommendations, ExtensionRecommendation } from './extensionRecommendations.js';\nimport { INotificationService } from '../../../../platform/notification/common/notification.js';\nimport { ExtensionRecommendationReason } from '../../../services/extensionRecommendations/common/extensionRecommendations.js';\nimport { localize } from '../../../../nls.js';\nimport { Emitter } from '../../../../base/common/event.js';\nimport { IExtensionsConfigContent, IWorkspaceExtensionsConfigService } from '../../../services/extensionRecommendations/common/workspaceExtensionsConfig.js';\nimport { IWorkspaceContextService } from '../../../../platform/workspace/common/workspace.js';\nimport { IUriIdentityService } from '../../../../platform/uriIdentity/common/uriIdentity.js';\nimport { FileChangeType, IFileService } from '../../../../platform/files/common/files.js';\nimport { URI } from '../../../../base/common/uri.js';\nimport { RunOnceScheduler } from '../../../../base/common/async.js';\nimport { IWorkbenchExtensionManagementService } from '../../../services/extensionManagement/common/extensionManagement.js';\n\nconst WORKSPACE_EXTENSIONS_FOLDER = '.vscode/extensions';\n\nexport class WorkspaceRecommendations extends ExtensionRecommendations {\n\n\tprivate _recommendations: ExtensionRecommendation[] = [];\n\tget recommendations(): ReadonlyArray<ExtensionRecommendation> { return this._recommendations; }\n\n\tprivate _onDidChangeRecommendations = this._register(new Emitter<void>());\n\treadonly onDidChangeRecommendations = this._onDidChangeRecommendations.event;\n\n\tprivate _ignoredRecommendations: string[] = [];\n\tget ignoredRecommendations(): ReadonlyArray<string> { return this._ignoredRecommendations; }\n\n\tprivate workspaceExtensions: URI[] = [];\n\tprivate readonly onDidChangeWorkspaceExtensionsScheduler: RunOnceScheduler;\n\n\tconstructor(\n\t\t@IWorkspaceExtensionsConfigService private readonly workspaceExtensionsConfigService: IWorkspaceExtensionsConfigService,\n\t\t@IWorkspaceContextService private readonly contextService: IWorkspaceContextService,\n\t\t@IUriIdentityService private readonly uriIdentityService: IUriIdentityService,\n\t\t@IFileService private readonly fileService: IFileService,\n\t\t@IWorkbenchExtensionManagementService private readonly workbenchExtensionManagementService: IWorkbenchExtensionManagementService,\n\t\t@INotificationService private readonly notificationService: INotificationService,\n\t) {\n\t\tsuper();\n\t\tthis.onDidChangeWorkspaceExtensionsScheduler = this._register(new RunOnceScheduler(() => this.onDidChangeWorkspaceExtensionsFolders(), 1000));\n\t}\n\n\tprotected async doActivate(): Promise<void> {\n\t\tthis.workspaceExtensions = await this.fetchWorkspaceExtensions();\n\t\tawait this.fetch();\n\n\t\tthis._register(this.workspaceExtensionsConfigService.onDidChangeExtensionsConfigs(() => this.onDidChangeExtensionsConfigs()));\n\t\tfor (const folder of this.contextService.getWorkspace().folders) {\n\t\t\tthis._register(this.fileService.watch(this.uriIdentityService.extUri.joinPath(folder.uri, WORKSPACE_EXTENSIONS_FOLDER)));\n\t\t}\n\n\t\tthis._register(this.contextService.onDidChangeWorkspaceFolders(() => this.onDidChangeWorkspaceExtensionsScheduler.schedule()));\n\n\t\tthis._register(this.fileService.onDidFilesChange(e => {\n\t\t\tif (this.contextService.getWorkspace().folders.some(folder =>\n\t\t\t\te.affects(this.uriIdentityService.extUri.joinPath(folder.uri, WORKSPACE_EXTENSIONS_FOLDER), FileChangeType.ADDED, FileChangeType.DELETED))\n\t\t\t) {\n\t\t\t\tthis.onDidChangeWorkspaceExtensionsScheduler.schedule();\n\t\t\t}\n\t\t}));\n\t}\n\n\tprivate async onDidChangeWorkspaceExtensionsFolders(): Promise<void> {\n\t\tconst existing = this.workspaceExtensions;\n\t\tthis.workspaceExtensions = await this.fetchWorkspaceExtensions();\n\t\tif (!equals(existing, this.workspaceExtensions, (a, b) => this.uriIdentityService.extUri.isEqual(a, b))) {\n\t\t\tthis.onDidChangeExtensionsConfigs();\n\t\t}\n\t}\n\n\tprivate async fetchWorkspaceExtensions(): Promise<URI[]> {\n\t\tconst workspaceExtensions: URI[] = [];\n\t\tfor (const workspaceFolder of this.contextService.getWorkspace().folders) {\n\t\t\tconst extensionsLocaiton = this.uriIdentityService.extUri.joinPath(workspaceFolder.uri, WORKSPACE_EXTENSIONS_FOLDER);\n\t\t\ttry {\n\t\t\t\tconst stat = await this.fileService.resolve(extensionsLocaiton);\n\t\t\t\tfor (const extension of stat.children ?? []) {\n\t\t\t\t\tif (!extension.isDirectory) {\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\t\tworkspaceExtensions.push(extension.resource);\n\t\t\t\t}\n\t\t\t} catch (error) {\n\t\t\t\t// ignore\n\t\t\t}\n\t\t}\n\t\tif (workspaceExtensions.length) {\n\t\t\tconst resourceExtensions = await this.workbenchExtensionManagementService.getExtensions(workspaceExtensions);\n\t\t\treturn resourceExtensions.map(extension => extension.location);\n\t\t}\n\t\treturn [];\n\t}\n\n\t/**\n\t * Parse all extensions.json files, fetch workspace recommendations, filter out invalid and unwanted ones\n\t */\n\tprivate async fetch(): Promise<void> {\n\n\t\tconst extensionsConfigs = await this.workspaceExtensionsConfigService.getExtensionsConfigs();\n\n\t\tconst { invalidRecommendations, message } = await this.validateExtensions(extensionsConfigs);\n\t\tif (invalidRecommendations.length) {\n\t\t\tthis.notificationService.warn(`The ${invalidRecommendations.length} extension(s) below, in workspace recommendations have issues:\\n${message}`);\n\t\t}\n\n\t\tthis._recommendations = [];\n\t\tthis._ignoredRecommendations = [];\n\n\t\tfor (const extensionsConfig of extensionsConfigs) {\n\t\t\tif (extensionsConfig.unwantedRecommendations) {\n\t\t\t\tfor (const unwantedRecommendation of extensionsConfig.unwantedRecommendations) {\n\t\t\t\t\tif (invalidRecommendations.indexOf(unwantedRecommendation) === -1) {\n\t\t\t\t\t\tthis._ignoredRecommendations.push(unwantedRecommendation);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (extensionsConfig.recommendations) {\n\t\t\t\tfor (const extensionId of extensionsConfig.recommendations) {\n\t\t\t\t\tif (invalidRecommendations.indexOf(extensionId) === -1) {\n\t\t\t\t\t\tthis._recommendations.push({\n\t\t\t\t\t\t\textension: extensionId,\n\t\t\t\t\t\t\treason: {\n\t\t\t\t\t\t\t\treasonId: ExtensionRecommendationReason.Workspace,\n\t\t\t\t\t\t\t\treasonText: localize('workspaceRecommendation', \"This extension is recommended by users of the current workspace.\")\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tfor (const extension of this.workspaceExtensions) {\n\t\t\tthis._recommendations.push({\n\t\t\t\textension,\n\t\t\t\treason: {\n\t\t\t\t\treasonId: ExtensionRecommendationReason.Workspace,\n\t\t\t\t\treasonText: localize('workspaceRecommendation', \"This extension is recommended by users of the current workspace.\")\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\tprivate async validateExtensions(contents: IExtensionsConfigContent[]): Promise<{ validRecommendations: string[]; invalidRecommendations: string[]; message: string }> {\n\n\t\tconst validExtensions: string[] = [];\n\t\tconst invalidExtensions: string[] = [];\n\t\tlet message = '';\n\n\t\tconst allRecommendations = distinct(contents.flatMap(({ recommendations }) => recommendations || []));\n\t\tconst regEx = new RegExp(EXTENSION_IDENTIFIER_PATTERN);\n\t\tfor (const extensionId of allRecommendations) {\n\t\t\tif (regEx.test(extensionId)) {\n\t\t\t\tvalidExtensions.push(extensionId);\n\t\t\t} else {\n\t\t\t\tinvalidExtensions.push(extensionId);\n\t\t\t\tmessage += `${extensionId} (bad format) Expected: <provider>.<name>\\n`;\n\t\t\t}\n\t\t}\n\n\t\treturn { validRecommendations: validExtensions, invalidRecommendations: invalidExtensions, message };\n\t}\n\n\tprivate async onDidChangeExtensionsConfigs(): Promise<void> {\n\t\tawait this.fetch();\n\t\tthis._onDidChangeRecommendations.fire();\n\t}\n\n}\n\n"]}