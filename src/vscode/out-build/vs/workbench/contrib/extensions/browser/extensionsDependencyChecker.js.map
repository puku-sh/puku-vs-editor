{"version":3,"sources":["vs/workbench/contrib/extensions/browser/extensionsDependencyChecker.ts"],"names":[],"mappings":"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","file":"extensionsDependencyChecker.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { IExtensionsWorkbenchService } from '../common/extensions.js';\nimport { IWorkbenchContribution } from '../../../common/contributions.js';\nimport { IExtensionService } from '../../../services/extensions/common/extensions.js';\nimport { CommandsRegistry } from '../../../../platform/commands/common/commands.js';\nimport { MenuRegistry, MenuId } from '../../../../platform/actions/common/actions.js';\nimport { localize } from '../../../../nls.js';\nimport { areSameExtensions } from '../../../../platform/extensionManagement/common/extensionManagementUtil.js';\nimport { INotificationService, Severity } from '../../../../platform/notification/common/notification.js';\nimport { Action } from '../../../../base/common/actions.js';\nimport { IHostService } from '../../../services/host/browser/host.js';\nimport { Disposable } from '../../../../base/common/lifecycle.js';\nimport { CancellationToken } from '../../../../base/common/cancellation.js';\nimport { Promises } from '../../../../base/common/async.js';\n\nexport class ExtensionDependencyChecker extends Disposable implements IWorkbenchContribution {\n\n\tconstructor(\n\t\t@IExtensionService private readonly extensionService: IExtensionService,\n\t\t@IExtensionsWorkbenchService private readonly extensionsWorkbenchService: IExtensionsWorkbenchService,\n\t\t@INotificationService private readonly notificationService: INotificationService,\n\t\t@IHostService private readonly hostService: IHostService\n\t) {\n\t\tsuper();\n\t\tCommandsRegistry.registerCommand('workbench.extensions.installMissingDependencies', () => this.installMissingDependencies());\n\t\tMenuRegistry.appendMenuItem(MenuId.CommandPalette, {\n\t\t\tcommand: {\n\t\t\t\tid: 'workbench.extensions.installMissingDependencies',\n\t\t\t\tcategory: localize('extensions', \"Extensions\"),\n\t\t\t\ttitle: localize('auto install missing deps', \"Install Missing Dependencies\")\n\t\t\t}\n\t\t});\n\t}\n\n\tprivate async getUninstalledMissingDependencies(): Promise<string[]> {\n\t\tconst allMissingDependencies = await this.getAllMissingDependencies();\n\t\tconst localExtensions = await this.extensionsWorkbenchService.queryLocal();\n\t\treturn allMissingDependencies.filter(id => localExtensions.every(l => !areSameExtensions(l.identifier, { id })));\n\t}\n\n\tprivate async getAllMissingDependencies(): Promise<string[]> {\n\t\tawait this.extensionService.whenInstalledExtensionsRegistered();\n\t\tconst runningExtensionsIds: Set<string> = this.extensionService.extensions.reduce((result, r) => { result.add(r.identifier.value.toLowerCase()); return result; }, new Set<string>());\n\t\tconst missingDependencies: Set<string> = new Set<string>();\n\t\tfor (const extension of this.extensionService.extensions) {\n\t\t\tif (extension.extensionDependencies) {\n\t\t\t\textension.extensionDependencies.forEach(dep => {\n\t\t\t\t\tif (!runningExtensionsIds.has(dep.toLowerCase())) {\n\t\t\t\t\t\tmissingDependencies.add(dep);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t\treturn [...missingDependencies.values()];\n\t}\n\n\tprivate async installMissingDependencies(): Promise<void> {\n\t\tconst missingDependencies = await this.getUninstalledMissingDependencies();\n\t\tif (missingDependencies.length) {\n\t\t\tconst extensions = await this.extensionsWorkbenchService.getExtensions(missingDependencies.map(id => ({ id })), CancellationToken.None);\n\t\t\tif (extensions.length) {\n\t\t\t\tawait Promises.settled(extensions.map(extension => this.extensionsWorkbenchService.install(extension)));\n\t\t\t\tthis.notificationService.notify({\n\t\t\t\t\tseverity: Severity.Info,\n\t\t\t\t\tmessage: localize('finished installing missing deps', \"Finished installing missing dependencies. Please reload the window now.\"),\n\t\t\t\t\tactions: {\n\t\t\t\t\t\tprimary: [new Action('realod', localize('reload', \"Reload Window\"), '', true,\n\t\t\t\t\t\t\t() => this.hostService.reload())]\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t} else {\n\t\t\tthis.notificationService.info(localize('no missing deps', \"There are no missing dependencies to install.\"));\n\t\t}\n\t}\n}\n"]}