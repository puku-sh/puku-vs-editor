{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/contrib/themes/browser/themes.test.contribution.ts","vs/workbench/contrib/themes/browser/themes.test.contribution.ts"],"names":[],"mappings":"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","file":"themes.test.contribution.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { URI } from '../../../../base/common/uri.js';\nimport type * as Parser from '@vscode/tree-sitter-wasm';\nimport { ILanguageService } from '../../../../editor/common/languages/language.js';\nimport { CommandsRegistry } from '../../../../platform/commands/common/commands.js';\nimport { IInstantiationService, ServicesAccessor } from '../../../../platform/instantiation/common/instantiation.js';\nimport { IWorkbenchThemeService, IWorkbenchColorTheme } from '../../../services/themes/common/workbenchThemeService.js';\nimport { IEditorService } from '../../../services/editor/common/editorService.js';\nimport { EditorResourceAccessor } from '../../../common/editor.js';\nimport { ITextMateTokenizationService } from '../../../services/textMate/browser/textMateTokenizationFeature.js';\nimport type { IGrammar, StateStack } from 'vscode-textmate';\nimport { TokenizationRegistry } from '../../../../editor/common/languages.js';\nimport { TokenMetadata } from '../../../../editor/common/encodedTokenAttributes.js';\nimport { ThemeRule, findMatchingThemeRule } from '../../../services/textMate/common/TMHelper.js';\nimport { Color } from '../../../../base/common/color.js';\nimport { IFileService } from '../../../../platform/files/common/files.js';\nimport { basename } from '../../../../base/common/resources.js';\nimport { Schemas } from '../../../../base/common/network.js';\nimport { splitLines } from '../../../../base/common/strings.js';\nimport { ColorThemeData, findMetadata } from '../../../services/themes/common/colorThemeData.js';\nimport { IModelService } from '../../../../editor/common/services/model.js';\nimport { Event } from '../../../../base/common/event.js';\nimport { Range } from '../../../../editor/common/core/range.js';\nimport { TreeSitterTree } from '../../../../editor/common/model/tokens/treeSitter/treeSitterTree.js';\nimport { TokenizationTextModelPart } from '../../../../editor/common/model/tokens/tokenizationTextModelPart.js';\nimport { TreeSitterSyntaxTokenBackend } from '../../../../editor/common/model/tokens/treeSitter/treeSitterSyntaxTokenBackend.js';\nimport { TreeSitterTokenizationImpl } from '../../../../editor/common/model/tokens/treeSitter/treeSitterTokenizationImpl.js';\nimport { waitForState } from '../../../../base/common/observable.js';\n\ninterface IToken {\n\tc: string; // token\n\tt: string; // space separated scopes, most general to most specific\n\tr: { [themeName: string]: string | undefined }; // token type: color\n}\n\ninterface IThemedToken {\n\ttext: string;\n\tcolor: Color | null;\n}\n\ninterface IThemesResult {\n\t[themeName: string]: {\n\t\tdocument: ThemeDocument;\n\t\ttokens: IThemedToken[];\n\t};\n}\n\nclass ThemeDocument {\n\tprivate readonly _theme: IWorkbenchColorTheme;\n\tprivate readonly _cache: { [scopes: string]: ThemeRule };\n\tprivate readonly _defaultColor: string;\n\n\tconstructor(theme: IWorkbenchColorTheme) {\n\t\tthis._theme = theme;\n\t\tthis._cache = Object.create(null);\n\t\tthis._defaultColor = '#000000';\n\t\tfor (let i = 0, len = this._theme.tokenColors.length; i < len; i++) {\n\t\t\tconst rule = this._theme.tokenColors[i];\n\t\t\tif (!rule.scope) {\n\t\t\t\tthis._defaultColor = rule.settings.foreground!;\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate _generateExplanation(selector: string, color: Color): string {\n\t\treturn `${selector}: ${Color.Format.CSS.formatHexA(color, true).toUpperCase()}`;\n\t}\n\n\tpublic explainTokenColor(scopes: string, color: Color): string {\n\n\t\tconst matchingRule = this._findMatchingThemeRule(scopes);\n\t\tif (!matchingRule) {\n\t\t\tconst expected = Color.fromHex(this._defaultColor);\n\t\t\t// No matching rule\n\t\t\tif (!color.equals(expected)) {\n\t\t\t\tthrow new Error(`[${this._theme.label}]: Unexpected color ${Color.Format.CSS.formatHexA(color)} for ${scopes}. Expected default ${Color.Format.CSS.formatHexA(expected)}`);\n\t\t\t}\n\t\t\treturn this._generateExplanation('default', color);\n\t\t}\n\n\t\tconst expected = Color.fromHex(matchingRule.settings.foreground!);\n\t\tif (!color.equals(expected)) {\n\t\t\tthrow new Error(`[${this._theme.label}]: Unexpected color ${Color.Format.CSS.formatHexA(color)} for ${scopes}. Expected ${Color.Format.CSS.formatHexA(expected)} coming in from ${matchingRule.rawSelector}`);\n\t\t}\n\t\treturn this._generateExplanation(matchingRule.rawSelector, color);\n\t}\n\n\tprivate _findMatchingThemeRule(scopes: string): ThemeRule {\n\t\tif (!this._cache[scopes]) {\n\t\t\tthis._cache[scopes] = findMatchingThemeRule(this._theme, scopes.split(' '))!;\n\t\t}\n\t\treturn this._cache[scopes];\n\t}\n}\n\nclass Snapper {\n\n\tconstructor(\n\t\t@ILanguageService private readonly languageService: ILanguageService,\n\t\t@IWorkbenchThemeService private readonly themeService: IWorkbenchThemeService,\n\t\t@ITextMateTokenizationService private readonly textMateService: ITextMateTokenizationService,\n\t\t@IModelService private readonly modelService: IModelService,\n\t) {\n\t}\n\n\tprivate _themedTokenize(grammar: IGrammar, lines: string[]): IThemedToken[] {\n\t\tconst colorMap = TokenizationRegistry.getColorMap();\n\t\tlet state: StateStack | null = null;\n\t\tconst result: IThemedToken[] = [];\n\t\tlet resultLen = 0;\n\t\tfor (let i = 0, len = lines.length; i < len; i++) {\n\t\t\tconst line = lines[i];\n\n\t\t\tconst tokenizationResult = grammar.tokenizeLine2(line, state);\n\n\t\t\tfor (let j = 0, lenJ = tokenizationResult.tokens.length >>> 1; j < lenJ; j++) {\n\t\t\t\tconst startOffset = tokenizationResult.tokens[(j << 1)];\n\t\t\t\tconst metadata = tokenizationResult.tokens[(j << 1) + 1];\n\t\t\t\tconst endOffset = j + 1 < lenJ ? tokenizationResult.tokens[((j + 1) << 1)] : line.length;\n\t\t\t\tconst tokenText = line.substring(startOffset, endOffset);\n\n\t\t\t\tconst color = TokenMetadata.getForeground(metadata);\n\n\t\t\t\tresult[resultLen++] = {\n\t\t\t\t\ttext: tokenText,\n\t\t\t\t\tcolor: colorMap![color]\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tstate = tokenizationResult.ruleStack;\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tprivate _themedTokenizeTreeSitter(tokens: IToken[], languageId: string): IThemedToken[] {\n\t\tconst colorMap = TokenizationRegistry.getColorMap();\n\t\tconst result: IThemedToken[] = Array(tokens.length);\n\t\tconst colorThemeData = this.themeService.getColorTheme() as ColorThemeData;\n\t\tfor (let i = 0, len = tokens.length; i < len; i++) {\n\t\t\tconst token = tokens[i];\n\t\t\tconst scopes = token.t.split(' ');\n\t\t\tconst metadata = findMetadata(colorThemeData, scopes, this.languageService.languageIdCodec.encodeLanguageId(languageId), false);\n\t\t\tconst color = TokenMetadata.getForeground(metadata);\n\n\t\t\tresult[i] = {\n\t\t\t\ttext: token.c,\n\t\t\t\tcolor: colorMap![color]\n\t\t\t};\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tprivate _tokenize(grammar: IGrammar, lines: string[]): IToken[] {\n\t\tlet state: StateStack | null = null;\n\t\tconst result: IToken[] = [];\n\t\tlet resultLen = 0;\n\t\tfor (let i = 0, len = lines.length; i < len; i++) {\n\t\t\tconst line = lines[i];\n\n\t\t\tconst tokenizationResult = grammar.tokenizeLine(line, state);\n\t\t\tlet lastScopes: string | null = null;\n\n\t\t\tfor (let j = 0, lenJ = tokenizationResult.tokens.length; j < lenJ; j++) {\n\t\t\t\tconst token = tokenizationResult.tokens[j];\n\t\t\t\tconst tokenText = line.substring(token.startIndex, token.endIndex);\n\t\t\t\tconst tokenScopes = token.scopes.join(' ');\n\n\t\t\t\tif (lastScopes === tokenScopes) {\n\t\t\t\t\tresult[resultLen - 1].c += tokenText;\n\t\t\t\t} else {\n\t\t\t\t\tlastScopes = tokenScopes;\n\t\t\t\t\tresult[resultLen++] = {\n\t\t\t\t\t\tc: tokenText,\n\t\t\t\t\t\tt: tokenScopes,\n\t\t\t\t\t\tr: {\n\t\t\t\t\t\t\tdark_plus: undefined,\n\t\t\t\t\t\t\tlight_plus: undefined,\n\t\t\t\t\t\t\tdark_vs: undefined,\n\t\t\t\t\t\t\tlight_vs: undefined,\n\t\t\t\t\t\t\thc_black: undefined,\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tstate = tokenizationResult.ruleStack;\n\t\t}\n\t\treturn result;\n\t}\n\n\tprivate async _getThemesResult(grammar: IGrammar, lines: string[]): Promise<IThemesResult> {\n\t\tconst currentTheme = this.themeService.getColorTheme();\n\n\t\tconst getThemeName = (id: string) => {\n\t\t\tconst part = 'vscode-theme-defaults-themes-';\n\t\t\tconst startIdx = id.indexOf(part);\n\t\t\tif (startIdx !== -1) {\n\t\t\t\treturn id.substring(startIdx + part.length, id.length - 5);\n\t\t\t}\n\t\t\treturn undefined;\n\t\t};\n\n\t\tconst result: IThemesResult = {};\n\n\t\tconst themeDatas = await this.themeService.getColorThemes();\n\t\tconst defaultThemes = themeDatas.filter(themeData => !!getThemeName(themeData.id));\n\t\tfor (const defaultTheme of defaultThemes) {\n\t\t\tconst themeId = defaultTheme.id;\n\t\t\tconst success = await this.themeService.setColorTheme(themeId, undefined);\n\t\t\tif (success) {\n\t\t\t\tconst themeName = getThemeName(themeId);\n\t\t\t\tresult[themeName!] = {\n\t\t\t\t\tdocument: new ThemeDocument(this.themeService.getColorTheme()),\n\t\t\t\t\ttokens: this._themedTokenize(grammar, lines)\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\t\tawait this.themeService.setColorTheme(currentTheme.id, undefined);\n\t\treturn result;\n\t}\n\n\tprivate async _getTreeSitterThemesResult(tokens: IToken[], languageId: string): Promise<IThemesResult> {\n\t\tconst currentTheme = this.themeService.getColorTheme();\n\n\t\tconst getThemeName = (id: string) => {\n\t\t\tconst part = 'vscode-theme-defaults-themes-';\n\t\t\tconst startIdx = id.indexOf(part);\n\t\t\tif (startIdx !== -1) {\n\t\t\t\treturn id.substring(startIdx + part.length, id.length - 5);\n\t\t\t}\n\t\t\treturn undefined;\n\t\t};\n\n\t\tconst result: IThemesResult = {};\n\n\t\tconst themeDatas = await this.themeService.getColorThemes();\n\t\tconst defaultThemes = themeDatas.filter(themeData => !!getThemeName(themeData.id));\n\t\tfor (const defaultTheme of defaultThemes) {\n\t\t\tconst themeId = defaultTheme.id;\n\t\t\tconst success = await this.themeService.setColorTheme(themeId, undefined);\n\t\t\tif (success) {\n\t\t\t\tconst themeName = getThemeName(themeId);\n\t\t\t\tresult[themeName!] = {\n\t\t\t\t\tdocument: new ThemeDocument(this.themeService.getColorTheme()),\n\t\t\t\t\ttokens: this._themedTokenizeTreeSitter(tokens, languageId)\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\t\tawait this.themeService.setColorTheme(currentTheme.id, undefined);\n\t\treturn result;\n\t}\n\n\n\tprivate _enrichResult(result: IToken[], themesResult: IThemesResult): void {\n\t\tconst index: { [themeName: string]: number } = {};\n\t\tconst themeNames = Object.keys(themesResult);\n\t\tfor (const themeName of themeNames) {\n\t\t\tindex[themeName] = 0;\n\t\t}\n\n\t\tfor (let i = 0, len = result.length; i < len; i++) {\n\t\t\tconst token = result[i];\n\n\t\t\tfor (const themeName of themeNames) {\n\t\t\t\tconst themedToken = themesResult[themeName].tokens[index[themeName]];\n\n\t\t\t\tthemedToken.text = themedToken.text.substr(token.c.length);\n\t\t\t\tif (themedToken.color) {\n\t\t\t\t\ttoken.r[themeName] = themesResult[themeName].document.explainTokenColor(token.t, themedToken.color);\n\t\t\t\t}\n\t\t\t\tif (themedToken.text.length === 0) {\n\t\t\t\t\tindex[themeName]++;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate _moveInjectionCursorToRange(cursor: Parser.TreeCursor, injectionRange: { startIndex: number; endIndex: number }): void {\n\t\tlet continueCursor = cursor.gotoFirstChild();\n\t\t// Get into the first \"real\" child node, as the root nodes can extend outside the range.\n\t\twhile (((cursor.startIndex < injectionRange.startIndex) || (cursor.endIndex > injectionRange.endIndex)) && continueCursor) {\n\t\t\tif (cursor.endIndex < injectionRange.startIndex) {\n\t\t\t\tcontinueCursor = cursor.gotoNextSibling();\n\t\t\t} else {\n\t\t\t\tcontinueCursor = cursor.gotoFirstChild();\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate async _treeSitterTokenize(treeSitterTree: TreeSitterTree, tokenizationModel: TreeSitterTokenizationImpl, languageId: string): Promise<IToken[]> {\n\t\tconst tree = await waitForState(treeSitterTree.tree);\n\t\tif (!tree) {\n\t\t\treturn [];\n\t\t}\n\t\tconst cursor = tree.walk();\n\t\tcursor.gotoFirstChild();\n\t\tlet cursorResult: boolean = true;\n\t\tconst tokens: IToken[] = [];\n\n\t\tconst cursors: { cursor: Parser.TreeCursor; languageId: string; startOffset: number; endOffset: number }[] = [{ cursor, languageId, startOffset: 0, endOffset: treeSitterTree.textModel.getValueLength() }];\n\t\tdo {\n\t\t\tconst current = cursors[cursors.length - 1];\n\t\t\tconst currentCursor = current.cursor;\n\t\t\tconst currentLanguageId = current.languageId;\n\t\t\tconst isOutsideRange: boolean = (currentCursor.currentNode.endIndex > current.endOffset);\n\n\t\t\tif (!isOutsideRange && (currentCursor.currentNode.childCount === 0)) {\n\t\t\t\tconst range = new Range(currentCursor.currentNode.startPosition.row + 1, currentCursor.currentNode.startPosition.column + 1, currentCursor.currentNode.endPosition.row + 1, currentCursor.currentNode.endPosition.column + 1);\n\t\t\t\tconst injection = treeSitterTree.getInjectionTrees(currentCursor.currentNode.startIndex, currentLanguageId);\n\t\t\t\tconst treeSitterRange = injection?.ranges!.find(r => r.startIndex <= currentCursor.currentNode.startIndex && r.endIndex >= currentCursor.currentNode.endIndex);\n\n\t\t\t\tconst injectionTree = injection?.tree.get();\n\t\t\t\tconst injectionLanguageId = injection?.languageId;\n\t\t\t\tif (injectionTree && injectionLanguageId && treeSitterRange && (treeSitterRange.startIndex === currentCursor.currentNode.startIndex)) {\n\t\t\t\t\tconst injectionCursor = injectionTree.walk();\n\t\t\t\t\tthis._moveInjectionCursorToRange(injectionCursor, treeSitterRange);\n\t\t\t\t\tcursors.push({ cursor: injectionCursor, languageId: injectionLanguageId, startOffset: treeSitterRange.startIndex, endOffset: treeSitterRange.endIndex });\n\t\t\t\t\twhile ((currentCursor.endIndex <= treeSitterRange.endIndex) && (currentCursor.gotoNextSibling() || currentCursor.gotoParent())) { }\n\t\t\t\t} else {\n\t\t\t\t\tconst capture = tokenizationModel.captureAtRangeTree(range);\n\t\t\t\t\ttokens.push({\n\t\t\t\t\t\tc: currentCursor.currentNode.text.replace(/\\r/g, ''),\n\t\t\t\t\t\tt: capture?.map(cap => cap.name).join(' ') ?? '',\n\t\t\t\t\t\tr: {\n\t\t\t\t\t\t\tdark_plus: undefined,\n\t\t\t\t\t\t\tlight_plus: undefined,\n\t\t\t\t\t\t\tdark_vs: undefined,\n\t\t\t\t\t\t\tlight_vs: undefined,\n\t\t\t\t\t\t\thc_black: undefined,\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\twhile (!(cursorResult = currentCursor.gotoNextSibling())) {\n\t\t\t\t\t\tif (!(cursorResult = currentCursor.gotoParent())) {\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t} else {\n\t\t\t\tcursorResult = currentCursor.gotoFirstChild();\n\t\t\t}\n\t\t\tif (cursors.length > 1 && ((!cursorResult && currentCursor === cursors[cursors.length - 1].cursor) || isOutsideRange)) {\n\t\t\t\tcurrent.cursor.delete();\n\t\t\t\tcursors.pop();\n\t\t\t\tcursorResult = true;\n\t\t\t}\n\t\t} while (cursorResult);\n\t\tcursor.delete();\n\t\treturn tokens;\n\t}\n\n\tpublic captureSyntaxTokens(fileName: string, content: string): Promise<IToken[]> {\n\t\tconst languageId = this.languageService.guessLanguageIdByFilepathOrFirstLine(URI.file(fileName));\n\t\treturn this.textMateService.createTokenizer(languageId!).then((grammar) => {\n\t\t\tif (!grammar) {\n\t\t\t\treturn [];\n\t\t\t}\n\t\t\tconst lines = splitLines(content);\n\n\t\t\tconst result = this._tokenize(grammar, lines);\n\t\t\treturn this._getThemesResult(grammar, lines).then((themesResult) => {\n\t\t\t\tthis._enrichResult(result, themesResult);\n\t\t\t\treturn result.filter(t => t.c.length > 0);\n\t\t\t});\n\t\t});\n\t}\n\n\tpublic async captureTreeSitterSyntaxTokens(resource: URI, content: string): Promise<IToken[]> {\n\t\tconst languageId = this.languageService.guessLanguageIdByFilepathOrFirstLine(resource);\n\t\tif (!languageId) {\n\t\t\treturn [];\n\t\t}\n\n\t\tconst model = this.modelService.getModel(resource) ?? this.modelService.createModel(content, { languageId, onDidChange: Event.None }, resource);\n\t\tconst tokenizationPart = (model.tokenization as TokenizationTextModelPart).tokens.get();\n\t\tif (!(tokenizationPart instanceof TreeSitterSyntaxTokenBackend)) {\n\t\t\treturn [];\n\t\t}\n\n\t\tconst treeObs = tokenizationPart.tree;\n\t\tconst tokenizationImplObs = tokenizationPart.tokenizationImpl;\n\t\tconst treeSitterTree = treeObs.get() ?? await waitForState(treeObs);\n\t\tconst tokenizationImpl = tokenizationImplObs.get() ?? await waitForState(tokenizationImplObs);\n\t\t// TODO: injections\n\t\tif (!treeSitterTree) {\n\t\t\treturn [];\n\t\t}\n\t\tconst result = (await this._treeSitterTokenize(treeSitterTree, tokenizationImpl, languageId)).filter(t => t.c.length > 0);\n\t\tconst themeTokens = await this._getTreeSitterThemesResult(result, languageId);\n\t\tthis._enrichResult(result, themeTokens);\n\t\treturn result;\n\n\t}\n}\n\nasync function captureTokens(accessor: ServicesAccessor, resource: URI | undefined, treeSitter: boolean = false) {\n\tconst process = (resource: URI) => {\n\t\tconst fileService = accessor.get(IFileService);\n\t\tconst fileName = basename(resource);\n\t\tconst snapper = accessor.get(IInstantiationService).createInstance(Snapper);\n\n\t\treturn fileService.readFile(resource).then(content => {\n\t\t\tif (treeSitter) {\n\t\t\t\treturn snapper.captureTreeSitterSyntaxTokens(resource, content.value.toString());\n\t\t\t} else {\n\t\t\t\treturn snapper.captureSyntaxTokens(fileName, content.value.toString());\n\t\t\t}\n\t\t});\n\t};\n\n\tif (!resource) {\n\t\tconst editorService = accessor.get(IEditorService);\n\t\tconst file = editorService.activeEditor ? EditorResourceAccessor.getCanonicalUri(editorService.activeEditor, { filterByScheme: Schemas.file }) : null;\n\t\tif (file) {\n\t\t\tprocess(file).then(result => {\n\t\t\t\tconsole.log(result);\n\t\t\t});\n\t\t} else {\n\t\t\tconsole.log('No file editor active');\n\t\t}\n\t} else {\n\t\tconst processResult = await process(resource);\n\t\treturn processResult;\n\t}\n\treturn undefined;\n\n}\n\nCommandsRegistry.registerCommand('_workbench.captureSyntaxTokens', function (accessor: ServicesAccessor, resource: URI) {\n\treturn captureTokens(accessor, resource);\n});\n\nCommandsRegistry.registerCommand('_workbench.captureTreeSitterSyntaxTokens', function (accessor: ServicesAccessor, resource?: URI) {\n\t// If no resource is provided, use the active editor's resource\n\t// This is useful for testing the command\n\tif (!resource) {\n\t\tconst editorService = accessor.get(IEditorService);\n\t\tresource = editorService.activeEditor?.resource;\n\t}\n\treturn captureTokens(accessor, resource, true);\n});\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { URI } from '../../../../base/common/uri.js';\nimport type * as Parser from '@vscode/tree-sitter-wasm';\nimport { ILanguageService } from '../../../../editor/common/languages/language.js';\nimport { CommandsRegistry } from '../../../../platform/commands/common/commands.js';\nimport { IInstantiationService, ServicesAccessor } from '../../../../platform/instantiation/common/instantiation.js';\nimport { IWorkbenchThemeService, IWorkbenchColorTheme } from '../../../services/themes/common/workbenchThemeService.js';\nimport { IEditorService } from '../../../services/editor/common/editorService.js';\nimport { EditorResourceAccessor } from '../../../common/editor.js';\nimport { ITextMateTokenizationService } from '../../../services/textMate/browser/textMateTokenizationFeature.js';\nimport type { IGrammar, StateStack } from 'vscode-textmate';\nimport { TokenizationRegistry } from '../../../../editor/common/languages.js';\nimport { TokenMetadata } from '../../../../editor/common/encodedTokenAttributes.js';\nimport { ThemeRule, findMatchingThemeRule } from '../../../services/textMate/common/TMHelper.js';\nimport { Color } from '../../../../base/common/color.js';\nimport { IFileService } from '../../../../platform/files/common/files.js';\nimport { basename } from '../../../../base/common/resources.js';\nimport { Schemas } from '../../../../base/common/network.js';\nimport { splitLines } from '../../../../base/common/strings.js';\nimport { ColorThemeData, findMetadata } from '../../../services/themes/common/colorThemeData.js';\nimport { IModelService } from '../../../../editor/common/services/model.js';\nimport { Event } from '../../../../base/common/event.js';\nimport { Range } from '../../../../editor/common/core/range.js';\nimport { TreeSitterTree } from '../../../../editor/common/model/tokens/treeSitter/treeSitterTree.js';\nimport { TokenizationTextModelPart } from '../../../../editor/common/model/tokens/tokenizationTextModelPart.js';\nimport { TreeSitterSyntaxTokenBackend } from '../../../../editor/common/model/tokens/treeSitter/treeSitterSyntaxTokenBackend.js';\nimport { TreeSitterTokenizationImpl } from '../../../../editor/common/model/tokens/treeSitter/treeSitterTokenizationImpl.js';\nimport { waitForState } from '../../../../base/common/observable.js';\n\ninterface IToken {\n\tc: string; // token\n\tt: string; // space separated scopes, most general to most specific\n\tr: { [themeName: string]: string | undefined }; // token type: color\n}\n\ninterface IThemedToken {\n\ttext: string;\n\tcolor: Color | null;\n}\n\ninterface IThemesResult {\n\t[themeName: string]: {\n\t\tdocument: ThemeDocument;\n\t\ttokens: IThemedToken[];\n\t};\n}\n\nclass ThemeDocument {\n\tprivate readonly _theme: IWorkbenchColorTheme;\n\tprivate readonly _cache: { [scopes: string]: ThemeRule };\n\tprivate readonly _defaultColor: string;\n\n\tconstructor(theme: IWorkbenchColorTheme) {\n\t\tthis._theme = theme;\n\t\tthis._cache = Object.create(null);\n\t\tthis._defaultColor = '#000000';\n\t\tfor (let i = 0, len = this._theme.tokenColors.length; i < len; i++) {\n\t\t\tconst rule = this._theme.tokenColors[i];\n\t\t\tif (!rule.scope) {\n\t\t\t\tthis._defaultColor = rule.settings.foreground!;\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate _generateExplanation(selector: string, color: Color): string {\n\t\treturn `${selector}: ${Color.Format.CSS.formatHexA(color, true).toUpperCase()}`;\n\t}\n\n\tpublic explainTokenColor(scopes: string, color: Color): string {\n\n\t\tconst matchingRule = this._findMatchingThemeRule(scopes);\n\t\tif (!matchingRule) {\n\t\t\tconst expected = Color.fromHex(this._defaultColor);\n\t\t\t// No matching rule\n\t\t\tif (!color.equals(expected)) {\n\t\t\t\tthrow new Error(`[${this._theme.label}]: Unexpected color ${Color.Format.CSS.formatHexA(color)} for ${scopes}. Expected default ${Color.Format.CSS.formatHexA(expected)}`);\n\t\t\t}\n\t\t\treturn this._generateExplanation('default', color);\n\t\t}\n\n\t\tconst expected = Color.fromHex(matchingRule.settings.foreground!);\n\t\tif (!color.equals(expected)) {\n\t\t\tthrow new Error(`[${this._theme.label}]: Unexpected color ${Color.Format.CSS.formatHexA(color)} for ${scopes}. Expected ${Color.Format.CSS.formatHexA(expected)} coming in from ${matchingRule.rawSelector}`);\n\t\t}\n\t\treturn this._generateExplanation(matchingRule.rawSelector, color);\n\t}\n\n\tprivate _findMatchingThemeRule(scopes: string): ThemeRule {\n\t\tif (!this._cache[scopes]) {\n\t\t\tthis._cache[scopes] = findMatchingThemeRule(this._theme, scopes.split(' '))!;\n\t\t}\n\t\treturn this._cache[scopes];\n\t}\n}\n\nclass Snapper {\n\n\tconstructor(\n\t\t@ILanguageService private readonly languageService: ILanguageService,\n\t\t@IWorkbenchThemeService private readonly themeService: IWorkbenchThemeService,\n\t\t@ITextMateTokenizationService private readonly textMateService: ITextMateTokenizationService,\n\t\t@IModelService private readonly modelService: IModelService,\n\t) {\n\t}\n\n\tprivate _themedTokenize(grammar: IGrammar, lines: string[]): IThemedToken[] {\n\t\tconst colorMap = TokenizationRegistry.getColorMap();\n\t\tlet state: StateStack | null = null;\n\t\tconst result: IThemedToken[] = [];\n\t\tlet resultLen = 0;\n\t\tfor (let i = 0, len = lines.length; i < len; i++) {\n\t\t\tconst line = lines[i];\n\n\t\t\tconst tokenizationResult = grammar.tokenizeLine2(line, state);\n\n\t\t\tfor (let j = 0, lenJ = tokenizationResult.tokens.length >>> 1; j < lenJ; j++) {\n\t\t\t\tconst startOffset = tokenizationResult.tokens[(j << 1)];\n\t\t\t\tconst metadata = tokenizationResult.tokens[(j << 1) + 1];\n\t\t\t\tconst endOffset = j + 1 < lenJ ? tokenizationResult.tokens[((j + 1) << 1)] : line.length;\n\t\t\t\tconst tokenText = line.substring(startOffset, endOffset);\n\n\t\t\t\tconst color = TokenMetadata.getForeground(metadata);\n\n\t\t\t\tresult[resultLen++] = {\n\t\t\t\t\ttext: tokenText,\n\t\t\t\t\tcolor: colorMap![color]\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tstate = tokenizationResult.ruleStack;\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tprivate _themedTokenizeTreeSitter(tokens: IToken[], languageId: string): IThemedToken[] {\n\t\tconst colorMap = TokenizationRegistry.getColorMap();\n\t\tconst result: IThemedToken[] = Array(tokens.length);\n\t\tconst colorThemeData = this.themeService.getColorTheme() as ColorThemeData;\n\t\tfor (let i = 0, len = tokens.length; i < len; i++) {\n\t\t\tconst token = tokens[i];\n\t\t\tconst scopes = token.t.split(' ');\n\t\t\tconst metadata = findMetadata(colorThemeData, scopes, this.languageService.languageIdCodec.encodeLanguageId(languageId), false);\n\t\t\tconst color = TokenMetadata.getForeground(metadata);\n\n\t\t\tresult[i] = {\n\t\t\t\ttext: token.c,\n\t\t\t\tcolor: colorMap![color]\n\t\t\t};\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tprivate _tokenize(grammar: IGrammar, lines: string[]): IToken[] {\n\t\tlet state: StateStack | null = null;\n\t\tconst result: IToken[] = [];\n\t\tlet resultLen = 0;\n\t\tfor (let i = 0, len = lines.length; i < len; i++) {\n\t\t\tconst line = lines[i];\n\n\t\t\tconst tokenizationResult = grammar.tokenizeLine(line, state);\n\t\t\tlet lastScopes: string | null = null;\n\n\t\t\tfor (let j = 0, lenJ = tokenizationResult.tokens.length; j < lenJ; j++) {\n\t\t\t\tconst token = tokenizationResult.tokens[j];\n\t\t\t\tconst tokenText = line.substring(token.startIndex, token.endIndex);\n\t\t\t\tconst tokenScopes = token.scopes.join(' ');\n\n\t\t\t\tif (lastScopes === tokenScopes) {\n\t\t\t\t\tresult[resultLen - 1].c += tokenText;\n\t\t\t\t} else {\n\t\t\t\t\tlastScopes = tokenScopes;\n\t\t\t\t\tresult[resultLen++] = {\n\t\t\t\t\t\tc: tokenText,\n\t\t\t\t\t\tt: tokenScopes,\n\t\t\t\t\t\tr: {\n\t\t\t\t\t\t\tdark_plus: undefined,\n\t\t\t\t\t\t\tlight_plus: undefined,\n\t\t\t\t\t\t\tdark_vs: undefined,\n\t\t\t\t\t\t\tlight_vs: undefined,\n\t\t\t\t\t\t\thc_black: undefined,\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tstate = tokenizationResult.ruleStack;\n\t\t}\n\t\treturn result;\n\t}\n\n\tprivate async _getThemesResult(grammar: IGrammar, lines: string[]): Promise<IThemesResult> {\n\t\tconst currentTheme = this.themeService.getColorTheme();\n\n\t\tconst getThemeName = (id: string) => {\n\t\t\tconst part = 'vscode-theme-defaults-themes-';\n\t\t\tconst startIdx = id.indexOf(part);\n\t\t\tif (startIdx !== -1) {\n\t\t\t\treturn id.substring(startIdx + part.length, id.length - 5);\n\t\t\t}\n\t\t\treturn undefined;\n\t\t};\n\n\t\tconst result: IThemesResult = {};\n\n\t\tconst themeDatas = await this.themeService.getColorThemes();\n\t\tconst defaultThemes = themeDatas.filter(themeData => !!getThemeName(themeData.id));\n\t\tfor (const defaultTheme of defaultThemes) {\n\t\t\tconst themeId = defaultTheme.id;\n\t\t\tconst success = await this.themeService.setColorTheme(themeId, undefined);\n\t\t\tif (success) {\n\t\t\t\tconst themeName = getThemeName(themeId);\n\t\t\t\tresult[themeName!] = {\n\t\t\t\t\tdocument: new ThemeDocument(this.themeService.getColorTheme()),\n\t\t\t\t\ttokens: this._themedTokenize(grammar, lines)\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\t\tawait this.themeService.setColorTheme(currentTheme.id, undefined);\n\t\treturn result;\n\t}\n\n\tprivate async _getTreeSitterThemesResult(tokens: IToken[], languageId: string): Promise<IThemesResult> {\n\t\tconst currentTheme = this.themeService.getColorTheme();\n\n\t\tconst getThemeName = (id: string) => {\n\t\t\tconst part = 'vscode-theme-defaults-themes-';\n\t\t\tconst startIdx = id.indexOf(part);\n\t\t\tif (startIdx !== -1) {\n\t\t\t\treturn id.substring(startIdx + part.length, id.length - 5);\n\t\t\t}\n\t\t\treturn undefined;\n\t\t};\n\n\t\tconst result: IThemesResult = {};\n\n\t\tconst themeDatas = await this.themeService.getColorThemes();\n\t\tconst defaultThemes = themeDatas.filter(themeData => !!getThemeName(themeData.id));\n\t\tfor (const defaultTheme of defaultThemes) {\n\t\t\tconst themeId = defaultTheme.id;\n\t\t\tconst success = await this.themeService.setColorTheme(themeId, undefined);\n\t\t\tif (success) {\n\t\t\t\tconst themeName = getThemeName(themeId);\n\t\t\t\tresult[themeName!] = {\n\t\t\t\t\tdocument: new ThemeDocument(this.themeService.getColorTheme()),\n\t\t\t\t\ttokens: this._themedTokenizeTreeSitter(tokens, languageId)\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\t\tawait this.themeService.setColorTheme(currentTheme.id, undefined);\n\t\treturn result;\n\t}\n\n\n\tprivate _enrichResult(result: IToken[], themesResult: IThemesResult): void {\n\t\tconst index: { [themeName: string]: number } = {};\n\t\tconst themeNames = Object.keys(themesResult);\n\t\tfor (const themeName of themeNames) {\n\t\t\tindex[themeName] = 0;\n\t\t}\n\n\t\tfor (let i = 0, len = result.length; i < len; i++) {\n\t\t\tconst token = result[i];\n\n\t\t\tfor (const themeName of themeNames) {\n\t\t\t\tconst themedToken = themesResult[themeName].tokens[index[themeName]];\n\n\t\t\t\tthemedToken.text = themedToken.text.substr(token.c.length);\n\t\t\t\tif (themedToken.color) {\n\t\t\t\t\ttoken.r[themeName] = themesResult[themeName].document.explainTokenColor(token.t, themedToken.color);\n\t\t\t\t}\n\t\t\t\tif (themedToken.text.length === 0) {\n\t\t\t\t\tindex[themeName]++;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate _moveInjectionCursorToRange(cursor: Parser.TreeCursor, injectionRange: { startIndex: number; endIndex: number }): void {\n\t\tlet continueCursor = cursor.gotoFirstChild();\n\t\t// Get into the first \"real\" child node, as the root nodes can extend outside the range.\n\t\twhile (((cursor.startIndex < injectionRange.startIndex) || (cursor.endIndex > injectionRange.endIndex)) && continueCursor) {\n\t\t\tif (cursor.endIndex < injectionRange.startIndex) {\n\t\t\t\tcontinueCursor = cursor.gotoNextSibling();\n\t\t\t} else {\n\t\t\t\tcontinueCursor = cursor.gotoFirstChild();\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate async _treeSitterTokenize(treeSitterTree: TreeSitterTree, tokenizationModel: TreeSitterTokenizationImpl, languageId: string): Promise<IToken[]> {\n\t\tconst tree = await waitForState(treeSitterTree.tree);\n\t\tif (!tree) {\n\t\t\treturn [];\n\t\t}\n\t\tconst cursor = tree.walk();\n\t\tcursor.gotoFirstChild();\n\t\tlet cursorResult: boolean = true;\n\t\tconst tokens: IToken[] = [];\n\n\t\tconst cursors: { cursor: Parser.TreeCursor; languageId: string; startOffset: number; endOffset: number }[] = [{ cursor, languageId, startOffset: 0, endOffset: treeSitterTree.textModel.getValueLength() }];\n\t\tdo {\n\t\t\tconst current = cursors[cursors.length - 1];\n\t\t\tconst currentCursor = current.cursor;\n\t\t\tconst currentLanguageId = current.languageId;\n\t\t\tconst isOutsideRange: boolean = (currentCursor.currentNode.endIndex > current.endOffset);\n\n\t\t\tif (!isOutsideRange && (currentCursor.currentNode.childCount === 0)) {\n\t\t\t\tconst range = new Range(currentCursor.currentNode.startPosition.row + 1, currentCursor.currentNode.startPosition.column + 1, currentCursor.currentNode.endPosition.row + 1, currentCursor.currentNode.endPosition.column + 1);\n\t\t\t\tconst injection = treeSitterTree.getInjectionTrees(currentCursor.currentNode.startIndex, currentLanguageId);\n\t\t\t\tconst treeSitterRange = injection?.ranges!.find(r => r.startIndex <= currentCursor.currentNode.startIndex && r.endIndex >= currentCursor.currentNode.endIndex);\n\n\t\t\t\tconst injectionTree = injection?.tree.get();\n\t\t\t\tconst injectionLanguageId = injection?.languageId;\n\t\t\t\tif (injectionTree && injectionLanguageId && treeSitterRange && (treeSitterRange.startIndex === currentCursor.currentNode.startIndex)) {\n\t\t\t\t\tconst injectionCursor = injectionTree.walk();\n\t\t\t\t\tthis._moveInjectionCursorToRange(injectionCursor, treeSitterRange);\n\t\t\t\t\tcursors.push({ cursor: injectionCursor, languageId: injectionLanguageId, startOffset: treeSitterRange.startIndex, endOffset: treeSitterRange.endIndex });\n\t\t\t\t\twhile ((currentCursor.endIndex <= treeSitterRange.endIndex) && (currentCursor.gotoNextSibling() || currentCursor.gotoParent())) { }\n\t\t\t\t} else {\n\t\t\t\t\tconst capture = tokenizationModel.captureAtRangeTree(range);\n\t\t\t\t\ttokens.push({\n\t\t\t\t\t\tc: currentCursor.currentNode.text.replace(/\\r/g, ''),\n\t\t\t\t\t\tt: capture?.map(cap => cap.name).join(' ') ?? '',\n\t\t\t\t\t\tr: {\n\t\t\t\t\t\t\tdark_plus: undefined,\n\t\t\t\t\t\t\tlight_plus: undefined,\n\t\t\t\t\t\t\tdark_vs: undefined,\n\t\t\t\t\t\t\tlight_vs: undefined,\n\t\t\t\t\t\t\thc_black: undefined,\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\twhile (!(cursorResult = currentCursor.gotoNextSibling())) {\n\t\t\t\t\t\tif (!(cursorResult = currentCursor.gotoParent())) {\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t} else {\n\t\t\t\tcursorResult = currentCursor.gotoFirstChild();\n\t\t\t}\n\t\t\tif (cursors.length > 1 && ((!cursorResult && currentCursor === cursors[cursors.length - 1].cursor) || isOutsideRange)) {\n\t\t\t\tcurrent.cursor.delete();\n\t\t\t\tcursors.pop();\n\t\t\t\tcursorResult = true;\n\t\t\t}\n\t\t} while (cursorResult);\n\t\tcursor.delete();\n\t\treturn tokens;\n\t}\n\n\tpublic captureSyntaxTokens(fileName: string, content: string): Promise<IToken[]> {\n\t\tconst languageId = this.languageService.guessLanguageIdByFilepathOrFirstLine(URI.file(fileName));\n\t\treturn this.textMateService.createTokenizer(languageId!).then((grammar) => {\n\t\t\tif (!grammar) {\n\t\t\t\treturn [];\n\t\t\t}\n\t\t\tconst lines = splitLines(content);\n\n\t\t\tconst result = this._tokenize(grammar, lines);\n\t\t\treturn this._getThemesResult(grammar, lines).then((themesResult) => {\n\t\t\t\tthis._enrichResult(result, themesResult);\n\t\t\t\treturn result.filter(t => t.c.length > 0);\n\t\t\t});\n\t\t});\n\t}\n\n\tpublic async captureTreeSitterSyntaxTokens(resource: URI, content: string): Promise<IToken[]> {\n\t\tconst languageId = this.languageService.guessLanguageIdByFilepathOrFirstLine(resource);\n\t\tif (!languageId) {\n\t\t\treturn [];\n\t\t}\n\n\t\tconst model = this.modelService.getModel(resource) ?? this.modelService.createModel(content, { languageId, onDidChange: Event.None }, resource);\n\t\tconst tokenizationPart = (model.tokenization as TokenizationTextModelPart).tokens.get();\n\t\tif (!(tokenizationPart instanceof TreeSitterSyntaxTokenBackend)) {\n\t\t\treturn [];\n\t\t}\n\n\t\tconst treeObs = tokenizationPart.tree;\n\t\tconst tokenizationImplObs = tokenizationPart.tokenizationImpl;\n\t\tconst treeSitterTree = treeObs.get() ?? await waitForState(treeObs);\n\t\tconst tokenizationImpl = tokenizationImplObs.get() ?? await waitForState(tokenizationImplObs);\n\t\t// TODO: injections\n\t\tif (!treeSitterTree) {\n\t\t\treturn [];\n\t\t}\n\t\tconst result = (await this._treeSitterTokenize(treeSitterTree, tokenizationImpl, languageId)).filter(t => t.c.length > 0);\n\t\tconst themeTokens = await this._getTreeSitterThemesResult(result, languageId);\n\t\tthis._enrichResult(result, themeTokens);\n\t\treturn result;\n\n\t}\n}\n\nasync function captureTokens(accessor: ServicesAccessor, resource: URI | undefined, treeSitter: boolean = false) {\n\tconst process = (resource: URI) => {\n\t\tconst fileService = accessor.get(IFileService);\n\t\tconst fileName = basename(resource);\n\t\tconst snapper = accessor.get(IInstantiationService).createInstance(Snapper);\n\n\t\treturn fileService.readFile(resource).then(content => {\n\t\t\tif (treeSitter) {\n\t\t\t\treturn snapper.captureTreeSitterSyntaxTokens(resource, content.value.toString());\n\t\t\t} else {\n\t\t\t\treturn snapper.captureSyntaxTokens(fileName, content.value.toString());\n\t\t\t}\n\t\t});\n\t};\n\n\tif (!resource) {\n\t\tconst editorService = accessor.get(IEditorService);\n\t\tconst file = editorService.activeEditor ? EditorResourceAccessor.getCanonicalUri(editorService.activeEditor, { filterByScheme: Schemas.file }) : null;\n\t\tif (file) {\n\t\t\tprocess(file).then(result => {\n\t\t\t\tconsole.log(result);\n\t\t\t});\n\t\t} else {\n\t\t\tconsole.log('No file editor active');\n\t\t}\n\t} else {\n\t\tconst processResult = await process(resource);\n\t\treturn processResult;\n\t}\n\treturn undefined;\n\n}\n\nCommandsRegistry.registerCommand('_workbench.captureSyntaxTokens', function (accessor: ServicesAccessor, resource: URI) {\n\treturn captureTokens(accessor, resource);\n});\n\nCommandsRegistry.registerCommand('_workbench.captureTreeSitterSyntaxTokens', function (accessor: ServicesAccessor, resource?: URI) {\n\t// If no resource is provided, use the active editor's resource\n\t// This is useful for testing the command\n\tif (!resource) {\n\t\tconst editorService = accessor.get(IEditorService);\n\t\tresource = editorService.activeEditor?.resource;\n\t}\n\treturn captureTokens(accessor, resource, true);\n});\n"]}