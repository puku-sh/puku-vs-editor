{"version":3,"sources":["vs/workbench/contrib/performance/electron-browser/startupProfiler.ts"],"names":[],"mappings":"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","file":"startupProfiler.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { IWorkbenchContribution } from '../../../common/contributions.js';\nimport { localize } from '../../../../nls.js';\nimport { dirname, basename } from '../../../../base/common/resources.js';\nimport { ITextModelService } from '../../../../editor/common/services/resolverService.js';\nimport { IDialogService } from '../../../../platform/dialogs/common/dialogs.js';\nimport { INativeWorkbenchEnvironmentService } from '../../../services/environment/electron-browser/environmentService.js';\nimport { ILifecycleService, LifecyclePhase } from '../../../services/lifecycle/common/lifecycle.js';\nimport { PerfviewContrib } from '../browser/perfviewEditor.js';\nimport { IExtensionService } from '../../../services/extensions/common/extensions.js';\nimport { IClipboardService } from '../../../../platform/clipboard/common/clipboardService.js';\nimport { URI } from '../../../../base/common/uri.js';\nimport { IOpenerService } from '../../../../platform/opener/common/opener.js';\nimport { INativeHostService } from '../../../../platform/native/common/native.js';\nimport { IProductService } from '../../../../platform/product/common/productService.js';\nimport { IFileService } from '../../../../platform/files/common/files.js';\nimport { ILabelService } from '../../../../platform/label/common/label.js';\n\nexport class StartupProfiler implements IWorkbenchContribution {\n\n\tconstructor(\n\t\t@IDialogService private readonly _dialogService: IDialogService,\n\t\t@INativeWorkbenchEnvironmentService private readonly _environmentService: INativeWorkbenchEnvironmentService,\n\t\t@ITextModelService private readonly _textModelResolverService: ITextModelService,\n\t\t@IClipboardService private readonly _clipboardService: IClipboardService,\n\t\t@ILifecycleService lifecycleService: ILifecycleService,\n\t\t@IExtensionService extensionService: IExtensionService,\n\t\t@IOpenerService private readonly _openerService: IOpenerService,\n\t\t@INativeHostService private readonly _nativeHostService: INativeHostService,\n\t\t@IProductService private readonly _productService: IProductService,\n\t\t@IFileService private readonly _fileService: IFileService,\n\t\t@ILabelService private readonly _labelService: ILabelService,\n\t) {\n\t\t// wait for everything to be ready\n\t\tPromise.all([\n\t\t\tlifecycleService.when(LifecyclePhase.Eventually),\n\t\t\textensionService.whenInstalledExtensionsRegistered()\n\t\t]).then(() => {\n\t\t\tthis._stopProfiling();\n\t\t});\n\t}\n\n\tprivate _stopProfiling(): void {\n\n\t\tif (!this._environmentService.args['prof-startup-prefix']) {\n\t\t\treturn;\n\t\t}\n\t\tconst profileFilenamePrefix = URI.file(this._environmentService.args['prof-startup-prefix']);\n\n\t\tconst dir = dirname(profileFilenamePrefix);\n\t\tconst prefix = basename(profileFilenamePrefix);\n\n\t\tconst removeArgs: string[] = ['--prof-startup'];\n\t\tconst markerFile = this._fileService.readFile(profileFilenamePrefix).then(value => removeArgs.push(...value.toString().split('|')))\n\t\t\t.then(() => this._fileService.del(profileFilenamePrefix, { recursive: true })) // (1) delete the file to tell the main process to stop profiling\n\t\t\t.then(() => new Promise<void>(resolve => { // (2) wait for main that recreates the fail to signal profiling has stopped\n\t\t\t\tconst check = () => {\n\t\t\t\t\tthis._fileService.exists(profileFilenamePrefix).then(exists => {\n\t\t\t\t\t\tif (exists) {\n\t\t\t\t\t\t\tresolve();\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tsetTimeout(check, 500);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t};\n\t\t\t\tcheck();\n\t\t\t}))\n\t\t\t.then(() => this._fileService.del(profileFilenamePrefix, { recursive: true })); // (3) finally delete the file again\n\n\t\tmarkerFile.then(() => {\n\t\t\treturn this._fileService.resolve(dir).then(stat => {\n\t\t\t\treturn (stat.children ? stat.children.filter(value => value.resource.path.includes(prefix)) : []).map(stat => stat.resource);\n\t\t\t});\n\t\t}).then(files => {\n\t\t\tconst profileFiles = files.reduce((prev, cur) => `${prev}${this._labelService.getUriLabel(cur)}\\n`, '\\n');\n\n\t\t\treturn this._dialogService.confirm({\n\t\t\t\ttype: 'info',\n\t\t\t\tmessage: localize('prof.message', \"Successfully created profiles.\"),\n\t\t\t\tdetail: localize('prof.detail', \"Please create an issue and manually attach the following files:\\n{0}\", profileFiles),\n\t\t\t\tprimaryButton: localize({ key: 'prof.restartAndFileIssue', comment: ['&& denotes a mnemonic'] }, \"&&Create Issue and Restart\"),\n\t\t\t\tcancelButton: localize('prof.restart', \"Restart\")\n\t\t\t}).then(res => {\n\t\t\t\tif (res.confirmed) {\n\t\t\t\t\tPromise.all<any>([\n\t\t\t\t\t\tthis._nativeHostService.showItemInFolder(files[0].fsPath),\n\t\t\t\t\t\tthis._createPerfIssue(files.map(file => basename(file)))\n\t\t\t\t\t]).then(() => {\n\t\t\t\t\t\t// keep window stable until restart is selected\n\t\t\t\t\t\treturn this._dialogService.confirm({\n\t\t\t\t\t\t\ttype: 'info',\n\t\t\t\t\t\t\tmessage: localize('prof.thanks', \"Thanks for helping us.\"),\n\t\t\t\t\t\t\tdetail: localize('prof.detail.restart', \"A final restart is required to continue to use '{0}'. Again, thank you for your contribution.\", this._productService.nameLong),\n\t\t\t\t\t\t\tprimaryButton: localize({ key: 'prof.restart.button', comment: ['&& denotes a mnemonic'] }, \"&&Restart\")\n\t\t\t\t\t\t}).then(res => {\n\t\t\t\t\t\t\t// now we are ready to restart\n\t\t\t\t\t\t\tif (res.confirmed) {\n\t\t\t\t\t\t\t\tthis._nativeHostService.relaunch({ removeArgs });\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\n\t\t\t\t} else {\n\t\t\t\t\t// simply restart\n\t\t\t\t\tthis._nativeHostService.relaunch({ removeArgs });\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t}\n\n\tprivate async _createPerfIssue(files: string[]): Promise<void> {\n\t\tconst reportIssueUrl = this._productService.reportIssueUrl;\n\t\tif (!reportIssueUrl) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst contrib = PerfviewContrib.get();\n\t\tconst ref = await this._textModelResolverService.createModelReference(contrib.getInputUri());\n\t\ttry {\n\t\t\tawait this._clipboardService.writeText(ref.object.textEditorModel.getValue());\n\t\t} finally {\n\t\t\tref.dispose();\n\t\t}\n\n\t\tconst body = `\n1. :warning: We have copied additional data to your clipboard. Make sure to **paste** here. :warning:\n1. :warning: Make sure to **attach** these files from your *home*-directory: :warning:\\n${files.map(file => `-\\`${file}\\``).join('\\n')}\n`;\n\n\t\tconst baseUrl = reportIssueUrl;\n\t\tconst queryStringPrefix = baseUrl.indexOf('?') === -1 ? '?' : '&';\n\n\t\tthis._openerService.open(URI.parse(`${baseUrl}${queryStringPrefix}body=${encodeURIComponent(body)}`));\n\t}\n}\n"]}