{"version":3,"sources":["vs/workbench/contrib/performance/browser/performance.contribution.ts"],"names":[],"mappings":"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","file":"performance.contribution.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { localize2 } from '../../../../nls.js';\nimport { registerAction2, Action2 } from '../../../../platform/actions/common/actions.js';\nimport { IInstantiationService, ServicesAccessor } from '../../../../platform/instantiation/common/instantiation.js';\nimport { LifecyclePhase } from '../../../services/lifecycle/common/lifecycle.js';\nimport { Registry } from '../../../../platform/registry/common/platform.js';\nimport { Categories } from '../../../../platform/action/common/actionCommonCategories.js';\nimport { Extensions, IWorkbenchContributionsRegistry, registerWorkbenchContribution2, WorkbenchPhase } from '../../../common/contributions.js';\nimport { EditorExtensions, IEditorSerializer, IEditorFactoryRegistry } from '../../../common/editor.js';\nimport { PerfviewContrib, PerfviewInput } from './perfviewEditor.js';\nimport { IEditorService } from '../../../services/editor/common/editorService.js';\nimport { InstantiationService, Trace } from '../../../../platform/instantiation/common/instantiationService.js';\nimport { EventProfiling } from '../../../../base/common/event.js';\nimport { InputLatencyContrib } from './inputLatencyContrib.js';\nimport { IEnvironmentService } from '../../../../platform/environment/common/environment.js';\nimport { GCBasedDisposableTracker, setDisposableTracker } from '../../../../base/common/lifecycle.js';\n\n// -- startup performance view\n\nregisterWorkbenchContribution2(\n\tPerfviewContrib.ID,\n\tPerfviewContrib,\n\t{ lazy: true }\n);\n\nRegistry.as<IEditorFactoryRegistry>(EditorExtensions.EditorFactory).registerEditorSerializer(\n\tPerfviewInput.Id,\n\tclass implements IEditorSerializer {\n\t\tcanSerialize(): boolean {\n\t\t\treturn true;\n\t\t}\n\t\tserialize(): string {\n\t\t\treturn '';\n\t\t}\n\t\tdeserialize(instantiationService: IInstantiationService): PerfviewInput {\n\t\t\treturn instantiationService.createInstance(PerfviewInput);\n\t\t}\n\t}\n);\n\n\nregisterAction2(class extends Action2 {\n\n\tconstructor() {\n\t\tsuper({\n\t\t\tid: 'perfview.show',\n\t\t\ttitle: localize2('show.label', 'Startup Performance'),\n\t\t\tcategory: Categories.Developer,\n\t\t\tf1: true\n\t\t});\n\t}\n\n\trun(accessor: ServicesAccessor) {\n\t\tconst editorService = accessor.get(IEditorService);\n\t\tconst contrib = PerfviewContrib.get();\n\t\treturn editorService.openEditor(contrib.getEditorInput(), { pinned: true });\n\t}\n});\n\n\nregisterAction2(class PrintServiceCycles extends Action2 {\n\n\tconstructor() {\n\t\tsuper({\n\t\t\tid: 'perf.insta.printAsyncCycles',\n\t\t\ttitle: localize2('cycles', 'Print Service Cycles'),\n\t\t\tcategory: Categories.Developer,\n\t\t\tf1: true\n\t\t});\n\t}\n\n\trun(accessor: ServicesAccessor) {\n\t\tconst instaService = accessor.get(IInstantiationService);\n\t\tif (instaService instanceof InstantiationService) {\n\t\t\tconst cycle = instaService._globalGraph?.findCycleSlow();\n\t\t\tif (cycle) {\n\t\t\t\tconsole.warn(`CYCLE`, cycle);\n\t\t\t} else {\n\t\t\t\tconsole.warn(`YEAH, no more cycles`);\n\t\t\t}\n\t\t}\n\t}\n});\n\nregisterAction2(class PrintServiceTraces extends Action2 {\n\n\tconstructor() {\n\t\tsuper({\n\t\t\tid: 'perf.insta.printTraces',\n\t\t\ttitle: localize2('insta.trace', 'Print Service Traces'),\n\t\t\tcategory: Categories.Developer,\n\t\t\tf1: true\n\t\t});\n\t}\n\n\trun() {\n\t\tif (Trace.all.size === 0) {\n\t\t\tconsole.log('Enable via `instantiationService.ts#_enableAllTracing`');\n\t\t\treturn;\n\t\t}\n\n\t\tfor (const item of Trace.all) {\n\t\t\tconsole.log(item);\n\t\t}\n\t}\n});\n\n\nregisterAction2(class PrintEventProfiling extends Action2 {\n\n\tconstructor() {\n\t\tsuper({\n\t\t\tid: 'perf.event.profiling',\n\t\t\ttitle: localize2('emitter', 'Print Emitter Profiles'),\n\t\t\tcategory: Categories.Developer,\n\t\t\tf1: true\n\t\t});\n\t}\n\n\trun(): void {\n\t\tif (EventProfiling.all.size === 0) {\n\t\t\tconsole.log('USE `EmitterOptions._profName` to enable profiling');\n\t\t\treturn;\n\t\t}\n\t\tfor (const item of EventProfiling.all) {\n\t\t\tconsole.log(`${item.name}: ${item.invocationCount} invocations COST ${item.elapsedOverall}ms, ${item.listenerCount} listeners, avg cost is ${item.durations.reduce((a, b) => a + b, 0) / item.durations.length}ms`);\n\t\t}\n\t}\n});\n\n// -- input latency\n\nRegistry.as<IWorkbenchContributionsRegistry>(Extensions.Workbench).registerWorkbenchContribution(\n\tInputLatencyContrib,\n\tLifecyclePhase.Eventually\n);\n\n\n// -- track leaking disposables, those that get GC'ed before having been disposed\n\n\nclass DisposableTracking {\n\tstatic readonly Id = 'perf.disposableTracking';\n\tconstructor(@IEnvironmentService envService: IEnvironmentService) {\n\t\tif (!envService.isBuilt && !envService.extensionTestsLocationURI) {\n\t\t\tsetDisposableTracker(new GCBasedDisposableTracker());\n\t\t}\n\t}\n}\n\nregisterWorkbenchContribution2(DisposableTracking.Id, DisposableTracking, WorkbenchPhase.Eventually);\n"]}