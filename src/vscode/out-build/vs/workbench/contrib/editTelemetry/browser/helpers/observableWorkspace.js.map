{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/contrib/editTelemetry/browser/helpers/observableWorkspace.ts","vs/workbench/contrib/editTelemetry/browser/helpers/observableWorkspace.ts"],"names":[],"mappings":"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","file":"observableWorkspace.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { IObservableWithChange, derivedHandleChanges, observableValue, runOnChange, IObservable, autorun, derived } from '../../../../../base/common/observable.js';\nimport { URI } from '../../../../../base/common/uri.js';\nimport { StringEdit, StringReplacement } from '../../../../../editor/common/core/edits/stringEdit.js';\nimport { OffsetRange } from '../../../../../editor/common/core/ranges/offsetRange.js';\nimport { StringText } from '../../../../../editor/common/core/text/abstractText.js';\nimport { EditSources, TextModelEditSource } from '../../../../../editor/common/textModelEditSource.js';\n\nexport abstract class ObservableWorkspace {\n\tabstract get documents(): IObservable<readonly IObservableDocument[]>;\n\n\n\tgetFirstOpenDocument(): IObservableDocument | undefined {\n\t\treturn this.documents.get()[0];\n\t}\n\n\tgetDocument(documentId: URI): IObservableDocument | undefined {\n\t\treturn this.documents.get().find(d => d.uri.toString() === documentId.toString());\n\t}\n\n\tprivate _version = 0;\n\n\t/**\n\t * Is fired when any open document changes.\n\t*/\n\tpublic readonly onDidOpenDocumentChange = derivedHandleChanges({\n\t\towner: this,\n\t\tchangeTracker: {\n\t\t\tcreateChangeSummary: () => ({ didChange: false }),\n\t\t\thandleChange: (ctx, changeSummary) => {\n\t\t\t\tif (!ctx.didChange(this.documents)) {\n\t\t\t\t\tchangeSummary.didChange = true; // A document changed\n\t\t\t\t}\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\t}, (reader, changeSummary) => {\n\t\tconst docs = this.documents.read(reader);\n\t\tfor (const d of docs) {\n\t\t\td.value.read(reader); // add dependency\n\t\t}\n\t\tif (changeSummary.didChange) {\n\t\t\tthis._version++; // to force a change\n\t\t}\n\t\treturn this._version;\n\n\t\t// TODO@hediet make this work:\n\t\t/*\n\t\tconst docs = this.openDocuments.read(reader);\n\t\tfor (const d of docs) {\n\t\t\tif (reader.readChangesSinceLastRun(d.value).length > 0) {\n\t\t\t\treader.reportChange(d);\n\t\t\t}\n\t\t}\n\t\treturn undefined;\n\t\t*/\n\t});\n\n\tpublic readonly lastActiveDocument = derived((reader) => {\n\t\tconst obs = observableValue('lastActiveDocument', undefined as IObservableDocument | undefined);\n\t\treader.store.add(autorun((reader) => {\n\t\t\tconst docs = this.documents.read(reader);\n\t\t\tfor (const d of docs) {\n\t\t\t\treader.store.add(runOnChange(d.value, () => {\n\t\t\t\t\tobs.set(d, undefined);\n\t\t\t\t}));\n\t\t\t}\n\t\t}));\n\t\treturn obs;\n\t}).flatten();\n}\n\nexport interface IObservableDocument {\n\treadonly uri: URI;\n\treadonly value: IObservableWithChange<StringText, StringEditWithReason>;\n\n\t/**\n\t * Increases whenever the value changes. Is also used to reference document states from the past.\n\t*/\n\treadonly version: IObservable<number>;\n\treadonly languageId: IObservable<string>;\n}\n\nexport class StringEditWithReason extends StringEdit {\n\tpublic static override replace(range: OffsetRange, newText: string, source: TextModelEditSource = EditSources.unknown({})): StringEditWithReason {\n\t\treturn new StringEditWithReason([new StringReplacement(range, newText)], source);\n\t}\n\n\tconstructor(\n\t\treplacements: StringEdit['replacements'],\n\t\tpublic readonly reason: TextModelEditSource,\n\t) {\n\t\tsuper(replacements);\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { IObservableWithChange, derivedHandleChanges, observableValue, runOnChange, IObservable, autorun, derived } from '../../../../../base/common/observable.js';\nimport { URI } from '../../../../../base/common/uri.js';\nimport { StringEdit, StringReplacement } from '../../../../../editor/common/core/edits/stringEdit.js';\nimport { OffsetRange } from '../../../../../editor/common/core/ranges/offsetRange.js';\nimport { StringText } from '../../../../../editor/common/core/text/abstractText.js';\nimport { EditSources, TextModelEditSource } from '../../../../../editor/common/textModelEditSource.js';\n\nexport abstract class ObservableWorkspace {\n\tabstract get documents(): IObservable<readonly IObservableDocument[]>;\n\n\n\tgetFirstOpenDocument(): IObservableDocument | undefined {\n\t\treturn this.documents.get()[0];\n\t}\n\n\tgetDocument(documentId: URI): IObservableDocument | undefined {\n\t\treturn this.documents.get().find(d => d.uri.toString() === documentId.toString());\n\t}\n\n\tprivate _version = 0;\n\n\t/**\n\t * Is fired when any open document changes.\n\t*/\n\tpublic readonly onDidOpenDocumentChange = derivedHandleChanges({\n\t\towner: this,\n\t\tchangeTracker: {\n\t\t\tcreateChangeSummary: () => ({ didChange: false }),\n\t\t\thandleChange: (ctx, changeSummary) => {\n\t\t\t\tif (!ctx.didChange(this.documents)) {\n\t\t\t\t\tchangeSummary.didChange = true; // A document changed\n\t\t\t\t}\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\t}, (reader, changeSummary) => {\n\t\tconst docs = this.documents.read(reader);\n\t\tfor (const d of docs) {\n\t\t\td.value.read(reader); // add dependency\n\t\t}\n\t\tif (changeSummary.didChange) {\n\t\t\tthis._version++; // to force a change\n\t\t}\n\t\treturn this._version;\n\n\t\t// TODO@hediet make this work:\n\t\t/*\n\t\tconst docs = this.openDocuments.read(reader);\n\t\tfor (const d of docs) {\n\t\t\tif (reader.readChangesSinceLastRun(d.value).length > 0) {\n\t\t\t\treader.reportChange(d);\n\t\t\t}\n\t\t}\n\t\treturn undefined;\n\t\t*/\n\t});\n\n\tpublic readonly lastActiveDocument = derived((reader) => {\n\t\tconst obs = observableValue('lastActiveDocument', undefined as IObservableDocument | undefined);\n\t\treader.store.add(autorun((reader) => {\n\t\t\tconst docs = this.documents.read(reader);\n\t\t\tfor (const d of docs) {\n\t\t\t\treader.store.add(runOnChange(d.value, () => {\n\t\t\t\t\tobs.set(d, undefined);\n\t\t\t\t}));\n\t\t\t}\n\t\t}));\n\t\treturn obs;\n\t}).flatten();\n}\n\nexport interface IObservableDocument {\n\treadonly uri: URI;\n\treadonly value: IObservableWithChange<StringText, StringEditWithReason>;\n\n\t/**\n\t * Increases whenever the value changes. Is also used to reference document states from the past.\n\t*/\n\treadonly version: IObservable<number>;\n\treadonly languageId: IObservable<string>;\n}\n\nexport class StringEditWithReason extends StringEdit {\n\tpublic static override replace(range: OffsetRange, newText: string, source: TextModelEditSource = EditSources.unknown({})): StringEditWithReason {\n\t\treturn new StringEditWithReason([new StringReplacement(range, newText)], source);\n\t}\n\n\tconstructor(\n\t\treplacements: StringEdit['replacements'],\n\t\tpublic readonly reason: TextModelEditSource,\n\t) {\n\t\tsuper(replacements);\n\t}\n}\n"]}