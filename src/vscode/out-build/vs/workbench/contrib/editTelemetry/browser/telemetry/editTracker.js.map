{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/contrib/editTelemetry/browser/telemetry/editTracker.ts","vs/workbench/contrib/editTelemetry/browser/telemetry/editTracker.ts"],"names":[],"mappings":"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","file":"editTracker.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\n\nimport { Disposable } from '../../../../../base/common/lifecycle.js';\nimport { observableSignal, runOnChange, IReader } from '../../../../../base/common/observable.js';\nimport { AnnotatedStringEdit } from '../../../../../editor/common/core/edits/stringEdit.js';\nimport { OffsetRange } from '../../../../../editor/common/core/ranges/offsetRange.js';\nimport { TextModelEditSource } from '../../../../../editor/common/textModelEditSource.js';\nimport { IDocumentWithAnnotatedEdits, EditKeySourceData, EditSource } from '../helpers/documentWithAnnotatedEdits.js';\n\n/**\n * Tracks a single document.\n*/\nexport class DocumentEditSourceTracker<T = void> extends Disposable {\n\tprivate _edits: AnnotatedStringEdit<EditKeySourceData> = AnnotatedStringEdit.empty;\n\tprivate _pendingExternalEdits: AnnotatedStringEdit<EditKeySourceData> = AnnotatedStringEdit.empty;\n\n\tprivate readonly _update = observableSignal(this);\n\tprivate readonly _representativePerKey: Map<string, TextModelEditSource> = new Map();\n\tprivate readonly _sumAddedCharactersPerKey: Map</* key */string, number> = new Map();\n\n\tconstructor(\n\t\tprivate readonly _doc: IDocumentWithAnnotatedEdits,\n\t\tpublic readonly data: T,\n\t) {\n\t\tsuper();\n\n\t\tthis._register(runOnChange(this._doc.value, (_val, _prevVal, edits) => {\n\t\t\tconst eComposed = AnnotatedStringEdit.compose(edits.map(e => e.edit));\n\t\t\tif (eComposed.replacements.every(e => e.data.source.category === 'external')) {\n\t\t\t\tif (this._edits.isEmpty()) {\n\t\t\t\t\t// Ignore initial external edits\n\t\t\t\t} else {\n\t\t\t\t\t// queue pending external edits\n\t\t\t\t\tthis._pendingExternalEdits = this._pendingExternalEdits.compose(eComposed);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif (!this._pendingExternalEdits.isEmpty()) {\n\t\t\t\t\tthis._applyEdit(this._pendingExternalEdits);\n\t\t\t\t\tthis._pendingExternalEdits = AnnotatedStringEdit.empty;\n\t\t\t\t}\n\t\t\t\tthis._applyEdit(eComposed);\n\t\t\t}\n\n\t\t\tthis._update.trigger(undefined);\n\t\t}));\n\t}\n\n\tprivate _applyEdit(e: AnnotatedStringEdit<EditKeySourceData>): void {\n\t\tfor (const r of e.replacements) {\n\t\t\tlet existing = this._sumAddedCharactersPerKey.get(r.data.key);\n\t\t\tif (existing === undefined) {\n\t\t\t\texisting = 0;\n\t\t\t\tthis._representativePerKey.set(r.data.key, r.data.representative);\n\t\t\t}\n\t\t\tconst newCount = existing + r.getNewLength();\n\t\t\tthis._sumAddedCharactersPerKey.set(r.data.key, newCount);\n\t\t}\n\n\t\tthis._edits = this._edits.compose(e);\n\t}\n\n\tasync waitForQueue(): Promise<void> {\n\t\tawait this._doc.waitForQueue();\n\t}\n\n\tpublic getTotalInsertedCharactersCount(key: string): number {\n\t\tconst val = this._sumAddedCharactersPerKey.get(key);\n\t\treturn val ?? 0;\n\t}\n\n\tpublic getAllKeys(): string[] {\n\t\treturn Array.from(this._sumAddedCharactersPerKey.keys());\n\t}\n\n\tpublic getRepresentative(key: string): TextModelEditSource | undefined {\n\t\treturn this._representativePerKey.get(key);\n\t}\n\n\tpublic getTrackedRanges(reader?: IReader): TrackedEdit[] {\n\t\tthis._update.read(reader);\n\t\tconst ranges = this._edits.getNewRanges();\n\t\treturn ranges.map((r, idx) => {\n\t\t\tconst e = this._edits.replacements[idx];\n\t\t\tconst te = new TrackedEdit(e.replaceRange, r, e.data.key, e.data.source, e.data.representative);\n\t\t\treturn te;\n\t\t});\n\t}\n\n\tpublic isEmpty(): boolean {\n\t\treturn this._edits.isEmpty();\n\t}\n\n\tpublic _getDebugVisualization() {\n\t\tconst ranges = this.getTrackedRanges();\n\t\tconst txt = this._doc.value.get().value;\n\n\t\treturn {\n\t\t\t...{ $fileExtension: 'text.w' },\n\t\t\t'value': txt,\n\t\t\t'decorations': ranges.map(r => {\n\t\t\t\treturn {\n\t\t\t\t\trange: [r.range.start, r.range.endExclusive],\n\t\t\t\t\tcolor: r.source.getColor(),\n\t\t\t\t};\n\t\t\t})\n\t\t};\n\t}\n}\n\nexport class TrackedEdit {\n\tconstructor(\n\t\tpublic readonly originalRange: OffsetRange,\n\t\tpublic readonly range: OffsetRange,\n\t\tpublic readonly sourceKey: string,\n\t\tpublic readonly source: EditSource,\n\t\tpublic readonly sourceRepresentative: TextModelEditSource,\n\t) { }\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\n\nimport { Disposable } from '../../../../../base/common/lifecycle.js';\nimport { observableSignal, runOnChange, IReader } from '../../../../../base/common/observable.js';\nimport { AnnotatedStringEdit } from '../../../../../editor/common/core/edits/stringEdit.js';\nimport { OffsetRange } from '../../../../../editor/common/core/ranges/offsetRange.js';\nimport { TextModelEditSource } from '../../../../../editor/common/textModelEditSource.js';\nimport { IDocumentWithAnnotatedEdits, EditKeySourceData, EditSource } from '../helpers/documentWithAnnotatedEdits.js';\n\n/**\n * Tracks a single document.\n*/\nexport class DocumentEditSourceTracker<T = void> extends Disposable {\n\tprivate _edits: AnnotatedStringEdit<EditKeySourceData> = AnnotatedStringEdit.empty;\n\tprivate _pendingExternalEdits: AnnotatedStringEdit<EditKeySourceData> = AnnotatedStringEdit.empty;\n\n\tprivate readonly _update = observableSignal(this);\n\tprivate readonly _representativePerKey: Map<string, TextModelEditSource> = new Map();\n\tprivate readonly _sumAddedCharactersPerKey: Map</* key */string, number> = new Map();\n\n\tconstructor(\n\t\tprivate readonly _doc: IDocumentWithAnnotatedEdits,\n\t\tpublic readonly data: T,\n\t) {\n\t\tsuper();\n\n\t\tthis._register(runOnChange(this._doc.value, (_val, _prevVal, edits) => {\n\t\t\tconst eComposed = AnnotatedStringEdit.compose(edits.map(e => e.edit));\n\t\t\tif (eComposed.replacements.every(e => e.data.source.category === 'external')) {\n\t\t\t\tif (this._edits.isEmpty()) {\n\t\t\t\t\t// Ignore initial external edits\n\t\t\t\t} else {\n\t\t\t\t\t// queue pending external edits\n\t\t\t\t\tthis._pendingExternalEdits = this._pendingExternalEdits.compose(eComposed);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif (!this._pendingExternalEdits.isEmpty()) {\n\t\t\t\t\tthis._applyEdit(this._pendingExternalEdits);\n\t\t\t\t\tthis._pendingExternalEdits = AnnotatedStringEdit.empty;\n\t\t\t\t}\n\t\t\t\tthis._applyEdit(eComposed);\n\t\t\t}\n\n\t\t\tthis._update.trigger(undefined);\n\t\t}));\n\t}\n\n\tprivate _applyEdit(e: AnnotatedStringEdit<EditKeySourceData>): void {\n\t\tfor (const r of e.replacements) {\n\t\t\tlet existing = this._sumAddedCharactersPerKey.get(r.data.key);\n\t\t\tif (existing === undefined) {\n\t\t\t\texisting = 0;\n\t\t\t\tthis._representativePerKey.set(r.data.key, r.data.representative);\n\t\t\t}\n\t\t\tconst newCount = existing + r.getNewLength();\n\t\t\tthis._sumAddedCharactersPerKey.set(r.data.key, newCount);\n\t\t}\n\n\t\tthis._edits = this._edits.compose(e);\n\t}\n\n\tasync waitForQueue(): Promise<void> {\n\t\tawait this._doc.waitForQueue();\n\t}\n\n\tpublic getTotalInsertedCharactersCount(key: string): number {\n\t\tconst val = this._sumAddedCharactersPerKey.get(key);\n\t\treturn val ?? 0;\n\t}\n\n\tpublic getAllKeys(): string[] {\n\t\treturn Array.from(this._sumAddedCharactersPerKey.keys());\n\t}\n\n\tpublic getRepresentative(key: string): TextModelEditSource | undefined {\n\t\treturn this._representativePerKey.get(key);\n\t}\n\n\tpublic getTrackedRanges(reader?: IReader): TrackedEdit[] {\n\t\tthis._update.read(reader);\n\t\tconst ranges = this._edits.getNewRanges();\n\t\treturn ranges.map((r, idx) => {\n\t\t\tconst e = this._edits.replacements[idx];\n\t\t\tconst te = new TrackedEdit(e.replaceRange, r, e.data.key, e.data.source, e.data.representative);\n\t\t\treturn te;\n\t\t});\n\t}\n\n\tpublic isEmpty(): boolean {\n\t\treturn this._edits.isEmpty();\n\t}\n\n\tpublic _getDebugVisualization() {\n\t\tconst ranges = this.getTrackedRanges();\n\t\tconst txt = this._doc.value.get().value;\n\n\t\treturn {\n\t\t\t...{ $fileExtension: 'text.w' },\n\t\t\t'value': txt,\n\t\t\t'decorations': ranges.map(r => {\n\t\t\t\treturn {\n\t\t\t\t\trange: [r.range.start, r.range.endExclusive],\n\t\t\t\t\tcolor: r.source.getColor(),\n\t\t\t\t};\n\t\t\t})\n\t\t};\n\t}\n}\n\nexport class TrackedEdit {\n\tconstructor(\n\t\tpublic readonly originalRange: OffsetRange,\n\t\tpublic readonly range: OffsetRange,\n\t\tpublic readonly sourceKey: string,\n\t\tpublic readonly source: EditSource,\n\t\tpublic readonly sourceRepresentative: TextModelEditSource,\n\t) { }\n}\n"]}