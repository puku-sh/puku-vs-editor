{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/contrib/editTelemetry/browser/telemetry/arcTelemetryReporter.ts","vs/workbench/contrib/editTelemetry/browser/telemetry/arcTelemetryReporter.ts"],"names":[],"mappings":"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","file":"arcTelemetryReporter.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nimport { TimeoutTimer } from '../../../../../base/common/async.js';\nimport { Disposable, toDisposable } from '../../../../../base/common/lifecycle.js';\nimport { IObservableWithChange, IObservable, runOnChange } from '../../../../../base/common/observable.js';\nimport { BaseStringEdit } from '../../../../../editor/common/core/edits/stringEdit.js';\nimport { StringText } from '../../../../../editor/common/core/text/abstractText.js';\nimport { ITelemetryService } from '../../../../../platform/telemetry/common/telemetry.js';\nimport { ArcTracker } from '../../common/arcTracker.js';\nimport type { ScmRepoAdapter } from './scmAdapter.js';\n\nexport class ArcTelemetryReporter extends Disposable {\n\tprivate readonly _arcTracker;\n\tprivate readonly _initialBranchName: string | undefined;\n\n\tprivate readonly _initialLineCounts;\n\n\tconstructor(\n\t\tprivate readonly _timesMs: number[],\n\t\tprivate readonly _documentValueBeforeTrackedEdit: StringText,\n\t\tprivate readonly _document: { value: IObservableWithChange<StringText, { edit: BaseStringEdit }> },\n\t\t// _markedEdits -> document.value\n\t\tprivate readonly _gitRepo: IObservable<ScmRepoAdapter | undefined>,\n\t\tprivate readonly _trackedEdit: BaseStringEdit,\n\t\tprivate readonly _sendTelemetryEvent: (res: ArcTelemetryReporterData) => void,\n\t\tprivate readonly _onBeforeDispose: () => void,\n\t\t@ITelemetryService private readonly _telemetryService: ITelemetryService\n\t) {\n\t\tsuper();\n\n\t\tthis._arcTracker = new ArcTracker(this._documentValueBeforeTrackedEdit, this._trackedEdit);\n\n\t\tthis._store.add(toDisposable(() => {\n\t\t\tthis._onBeforeDispose();\n\t\t}));\n\n\t\tthis._store.add(runOnChange(this._document.value, (_val, _prevVal, changes) => {\n\t\t\tconst edit = BaseStringEdit.composeOrUndefined(changes.map(c => c.edit));\n\t\t\tif (edit) {\n\t\t\t\tthis._arcTracker.handleEdits(edit);\n\t\t\t}\n\t\t}));\n\n\t\tthis._initialLineCounts = this._arcTracker.getLineCountInfo();\n\n\t\tthis._initialBranchName = this._gitRepo.get()?.headBranchNameObs.get();\n\n\t\tfor (let i = 0; i < this._timesMs.length; i++) {\n\t\t\tconst timeMs = this._timesMs[i];\n\n\t\t\tif (timeMs <= 0) {\n\t\t\t\tthis._report(timeMs);\n\t\t\t} else {\n\t\t\t\tthis._reportAfter(timeMs, i === this._timesMs.length - 1 ? () => {\n\t\t\t\t\tthis.dispose();\n\t\t\t\t} : undefined);\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate _reportAfter(timeoutMs: number, cb?: () => void) {\n\t\tconst timer = new TimeoutTimer(() => {\n\t\t\tthis._report(timeoutMs);\n\t\t\ttimer.dispose();\n\t\t\tif (cb) {\n\t\t\t\tcb();\n\t\t\t}\n\t\t}, timeoutMs);\n\t\tthis._store.add(timer);\n\t}\n\n\tprivate _report(timeMs: number): void {\n\t\tconst currentBranch = this._gitRepo.get()?.headBranchNameObs.get();\n\t\tconst didBranchChange = currentBranch !== this._initialBranchName;\n\t\tconst currentLineCounts = this._arcTracker.getLineCountInfo();\n\n\t\tthis._sendTelemetryEvent({\n\t\t\ttelemetryService: this._telemetryService,\n\t\t\ttimeDelayMs: timeMs,\n\t\t\tdidBranchChange,\n\t\t\tarc: this._arcTracker.getAcceptedRestrainedCharactersCount(),\n\t\t\toriginalCharCount: this._arcTracker.getOriginalCharacterCount(),\n\n\t\t\tcurrentLineCount: currentLineCounts.insertedLineCounts,\n\t\t\tcurrentDeletedLineCount: currentLineCounts.deletedLineCounts,\n\t\t\toriginalLineCount: this._initialLineCounts.insertedLineCounts,\n\t\t\toriginalDeletedLineCount: this._initialLineCounts.deletedLineCounts,\n\t\t});\n\t}\n}\n\nexport interface ArcTelemetryReporterData {\n\ttelemetryService: ITelemetryService;\n\ttimeDelayMs: number;\n\tdidBranchChange: boolean;\n\tarc: number;\n\toriginalCharCount: number;\n\n\tcurrentLineCount: number;\n\tcurrentDeletedLineCount: number;\n\toriginalLineCount: number;\n\toriginalDeletedLineCount: number;\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nimport { TimeoutTimer } from '../../../../../base/common/async.js';\nimport { Disposable, toDisposable } from '../../../../../base/common/lifecycle.js';\nimport { IObservableWithChange, IObservable, runOnChange } from '../../../../../base/common/observable.js';\nimport { BaseStringEdit } from '../../../../../editor/common/core/edits/stringEdit.js';\nimport { StringText } from '../../../../../editor/common/core/text/abstractText.js';\nimport { ITelemetryService } from '../../../../../platform/telemetry/common/telemetry.js';\nimport { ArcTracker } from '../../common/arcTracker.js';\nimport type { ScmRepoAdapter } from './scmAdapter.js';\n\nexport class ArcTelemetryReporter extends Disposable {\n\tprivate readonly _arcTracker;\n\tprivate readonly _initialBranchName: string | undefined;\n\n\tprivate readonly _initialLineCounts;\n\n\tconstructor(\n\t\tprivate readonly _timesMs: number[],\n\t\tprivate readonly _documentValueBeforeTrackedEdit: StringText,\n\t\tprivate readonly _document: { value: IObservableWithChange<StringText, { edit: BaseStringEdit }> },\n\t\t// _markedEdits -> document.value\n\t\tprivate readonly _gitRepo: IObservable<ScmRepoAdapter | undefined>,\n\t\tprivate readonly _trackedEdit: BaseStringEdit,\n\t\tprivate readonly _sendTelemetryEvent: (res: ArcTelemetryReporterData) => void,\n\t\tprivate readonly _onBeforeDispose: () => void,\n\t\t@ITelemetryService private readonly _telemetryService: ITelemetryService\n\t) {\n\t\tsuper();\n\n\t\tthis._arcTracker = new ArcTracker(this._documentValueBeforeTrackedEdit, this._trackedEdit);\n\n\t\tthis._store.add(toDisposable(() => {\n\t\t\tthis._onBeforeDispose();\n\t\t}));\n\n\t\tthis._store.add(runOnChange(this._document.value, (_val, _prevVal, changes) => {\n\t\t\tconst edit = BaseStringEdit.composeOrUndefined(changes.map(c => c.edit));\n\t\t\tif (edit) {\n\t\t\t\tthis._arcTracker.handleEdits(edit);\n\t\t\t}\n\t\t}));\n\n\t\tthis._initialLineCounts = this._arcTracker.getLineCountInfo();\n\n\t\tthis._initialBranchName = this._gitRepo.get()?.headBranchNameObs.get();\n\n\t\tfor (let i = 0; i < this._timesMs.length; i++) {\n\t\t\tconst timeMs = this._timesMs[i];\n\n\t\t\tif (timeMs <= 0) {\n\t\t\t\tthis._report(timeMs);\n\t\t\t} else {\n\t\t\t\tthis._reportAfter(timeMs, i === this._timesMs.length - 1 ? () => {\n\t\t\t\t\tthis.dispose();\n\t\t\t\t} : undefined);\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate _reportAfter(timeoutMs: number, cb?: () => void) {\n\t\tconst timer = new TimeoutTimer(() => {\n\t\t\tthis._report(timeoutMs);\n\t\t\ttimer.dispose();\n\t\t\tif (cb) {\n\t\t\t\tcb();\n\t\t\t}\n\t\t}, timeoutMs);\n\t\tthis._store.add(timer);\n\t}\n\n\tprivate _report(timeMs: number): void {\n\t\tconst currentBranch = this._gitRepo.get()?.headBranchNameObs.get();\n\t\tconst didBranchChange = currentBranch !== this._initialBranchName;\n\t\tconst currentLineCounts = this._arcTracker.getLineCountInfo();\n\n\t\tthis._sendTelemetryEvent({\n\t\t\ttelemetryService: this._telemetryService,\n\t\t\ttimeDelayMs: timeMs,\n\t\t\tdidBranchChange,\n\t\t\tarc: this._arcTracker.getAcceptedRestrainedCharactersCount(),\n\t\t\toriginalCharCount: this._arcTracker.getOriginalCharacterCount(),\n\n\t\t\tcurrentLineCount: currentLineCounts.insertedLineCounts,\n\t\t\tcurrentDeletedLineCount: currentLineCounts.deletedLineCounts,\n\t\t\toriginalLineCount: this._initialLineCounts.insertedLineCounts,\n\t\t\toriginalDeletedLineCount: this._initialLineCounts.deletedLineCounts,\n\t\t});\n\t}\n}\n\nexport interface ArcTelemetryReporterData {\n\ttelemetryService: ITelemetryService;\n\ttimeDelayMs: number;\n\tdidBranchChange: boolean;\n\tarc: number;\n\toriginalCharCount: number;\n\n\tcurrentLineCount: number;\n\tcurrentDeletedLineCount: number;\n\toriginalLineCount: number;\n\toriginalDeletedLineCount: number;\n}\n"]}