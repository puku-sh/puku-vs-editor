{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/contrib/editTelemetry/browser/helpers/annotatedDocuments.ts","vs/workbench/contrib/editTelemetry/browser/helpers/annotatedDocuments.ts"],"names":[],"mappings":"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","file":"annotatedDocuments.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Disposable } from '../../../../../base/common/lifecycle.js';\nimport { IObservable, mapObservableArrayCached, derived, derivedObservableWithCache, observableFromEvent, observableSignalFromEvent, IReader } from '../../../../../base/common/observable.js';\nimport { isDefined } from '../../../../../base/common/types.js';\nimport { URI } from '../../../../../base/common/uri.js';\nimport { IInstantiationService } from '../../../../../platform/instantiation/common/instantiation.js';\nimport { EditorResourceAccessor } from '../../../../common/editor.js';\nimport { IEditorGroupsService } from '../../../../services/editor/common/editorGroupsService.js';\nimport { IDocumentWithAnnotatedEdits, EditSourceData, DocumentWithSourceAnnotatedEdits, CombineStreamedChanges, MinimizeEditsProcessor } from './documentWithAnnotatedEdits.js';\nimport { ObservableWorkspace, IObservableDocument } from './observableWorkspace.js';\n\nexport interface IAnnotatedDocuments {\n\treadonly documents: IObservable<readonly AnnotatedDocument[]>;\n}\n\nexport class AnnotatedDocuments extends Disposable implements IAnnotatedDocuments {\n\tpublic readonly documents: IObservable<readonly AnnotatedDocument[]>;\n\tprivate readonly _states;\n\n\tconstructor(\n\t\tprivate readonly _workspace: ObservableWorkspace,\n\t\t@IInstantiationService private readonly _instantiationService: IInstantiationService\n\t) {\n\t\tsuper();\n\n\t\tconst uriVisibilityProvider = this._instantiationService.createInstance(UriVisibilityProvider);\n\n\t\tthis._states = mapObservableArrayCached(this, this._workspace.documents, (doc, store) => {\n\t\t\tconst docIsVisible = derived(reader => uriVisibilityProvider.isVisible(doc.uri, reader));\n\t\t\tconst wasEverVisible = derivedObservableWithCache<boolean>(this, (reader, lastVal) => lastVal || docIsVisible.read(reader));\n\t\t\treturn wasEverVisible.map(v => v ? store.add(this._instantiationService.createInstance(AnnotatedDocument, doc, docIsVisible)) : undefined);\n\t\t});\n\n\t\tthis.documents = this._states.map((vals, reader) => vals.map(v => v.read(reader)).filter(isDefined));\n\n\t\tthis.documents.recomputeInitiallyAndOnChange(this._store);\n\t}\n}\n\nexport class UriVisibilityProvider {\n\tprivate readonly visibleUris: IObservable<Map<string, URI>>;\n\n\tconstructor(\n\t\t@IEditorGroupsService private readonly _editorGroupsService: IEditorGroupsService\n\t) {\n\t\tconst onDidAddGroupSignal = observableSignalFromEvent(this, this._editorGroupsService.onDidAddGroup);\n\t\tconst onDidRemoveGroupSignal = observableSignalFromEvent(this, this._editorGroupsService.onDidRemoveGroup);\n\t\tconst groups = derived(this, reader => {\n\t\t\tonDidAddGroupSignal.read(reader);\n\t\t\tonDidRemoveGroupSignal.read(reader);\n\t\t\treturn this._editorGroupsService.groups;\n\t\t});\n\n\t\tthis.visibleUris = mapObservableArrayCached(this, groups, g => {\n\t\t\tconst editors = observableFromEvent(this, g.onDidModelChange, () => g.editors);\n\t\t\treturn editors.map(e => e.map(editor => EditorResourceAccessor.getCanonicalUri(editor)));\n\t\t}).map((editors, reader) => {\n\t\t\tconst map = new Map<string, URI>();\n\t\t\tfor (const urisObs of editors) {\n\t\t\t\tfor (const uri of urisObs.read(reader)) {\n\t\t\t\t\tif (isDefined(uri)) {\n\t\t\t\t\t\tmap.set(uri.toString(), uri);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn map;\n\t\t});\n\t}\n\n\tpublic isVisible(uri: URI, reader: IReader): boolean {\n\t\treturn this.visibleUris.read(reader).has(uri.toString());\n\t}\n}\n\nexport class AnnotatedDocument extends Disposable {\n\tpublic readonly documentWithAnnotations;\n\n\tconstructor(\n\t\tpublic readonly document: IObservableDocument,\n\t\tpublic readonly isVisible: IObservable<boolean>,\n\t\t@IInstantiationService private readonly _instantiationService: IInstantiationService\n\t) {\n\t\tsuper();\n\n\t\tlet processedDoc: IDocumentWithAnnotatedEdits<EditSourceData> = this._store.add(new DocumentWithSourceAnnotatedEdits(document));\n\t\t// Combine streaming edits into one and make edit smaller\n\t\tprocessedDoc = this._store.add(this._instantiationService.createInstance((CombineStreamedChanges<EditSourceData>), processedDoc));\n\t\t// Remove common suffix and prefix from edits\n\t\tprocessedDoc = this._store.add(new MinimizeEditsProcessor(processedDoc));\n\n\t\tthis.documentWithAnnotations = processedDoc;\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Disposable } from '../../../../../base/common/lifecycle.js';\nimport { IObservable, mapObservableArrayCached, derived, derivedObservableWithCache, observableFromEvent, observableSignalFromEvent, IReader } from '../../../../../base/common/observable.js';\nimport { isDefined } from '../../../../../base/common/types.js';\nimport { URI } from '../../../../../base/common/uri.js';\nimport { IInstantiationService } from '../../../../../platform/instantiation/common/instantiation.js';\nimport { EditorResourceAccessor } from '../../../../common/editor.js';\nimport { IEditorGroupsService } from '../../../../services/editor/common/editorGroupsService.js';\nimport { IDocumentWithAnnotatedEdits, EditSourceData, DocumentWithSourceAnnotatedEdits, CombineStreamedChanges, MinimizeEditsProcessor } from './documentWithAnnotatedEdits.js';\nimport { ObservableWorkspace, IObservableDocument } from './observableWorkspace.js';\n\nexport interface IAnnotatedDocuments {\n\treadonly documents: IObservable<readonly AnnotatedDocument[]>;\n}\n\nexport class AnnotatedDocuments extends Disposable implements IAnnotatedDocuments {\n\tpublic readonly documents: IObservable<readonly AnnotatedDocument[]>;\n\tprivate readonly _states;\n\n\tconstructor(\n\t\tprivate readonly _workspace: ObservableWorkspace,\n\t\t@IInstantiationService private readonly _instantiationService: IInstantiationService\n\t) {\n\t\tsuper();\n\n\t\tconst uriVisibilityProvider = this._instantiationService.createInstance(UriVisibilityProvider);\n\n\t\tthis._states = mapObservableArrayCached(this, this._workspace.documents, (doc, store) => {\n\t\t\tconst docIsVisible = derived(reader => uriVisibilityProvider.isVisible(doc.uri, reader));\n\t\t\tconst wasEverVisible = derivedObservableWithCache<boolean>(this, (reader, lastVal) => lastVal || docIsVisible.read(reader));\n\t\t\treturn wasEverVisible.map(v => v ? store.add(this._instantiationService.createInstance(AnnotatedDocument, doc, docIsVisible)) : undefined);\n\t\t});\n\n\t\tthis.documents = this._states.map((vals, reader) => vals.map(v => v.read(reader)).filter(isDefined));\n\n\t\tthis.documents.recomputeInitiallyAndOnChange(this._store);\n\t}\n}\n\nexport class UriVisibilityProvider {\n\tprivate readonly visibleUris: IObservable<Map<string, URI>>;\n\n\tconstructor(\n\t\t@IEditorGroupsService private readonly _editorGroupsService: IEditorGroupsService\n\t) {\n\t\tconst onDidAddGroupSignal = observableSignalFromEvent(this, this._editorGroupsService.onDidAddGroup);\n\t\tconst onDidRemoveGroupSignal = observableSignalFromEvent(this, this._editorGroupsService.onDidRemoveGroup);\n\t\tconst groups = derived(this, reader => {\n\t\t\tonDidAddGroupSignal.read(reader);\n\t\t\tonDidRemoveGroupSignal.read(reader);\n\t\t\treturn this._editorGroupsService.groups;\n\t\t});\n\n\t\tthis.visibleUris = mapObservableArrayCached(this, groups, g => {\n\t\t\tconst editors = observableFromEvent(this, g.onDidModelChange, () => g.editors);\n\t\t\treturn editors.map(e => e.map(editor => EditorResourceAccessor.getCanonicalUri(editor)));\n\t\t}).map((editors, reader) => {\n\t\t\tconst map = new Map<string, URI>();\n\t\t\tfor (const urisObs of editors) {\n\t\t\t\tfor (const uri of urisObs.read(reader)) {\n\t\t\t\t\tif (isDefined(uri)) {\n\t\t\t\t\t\tmap.set(uri.toString(), uri);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn map;\n\t\t});\n\t}\n\n\tpublic isVisible(uri: URI, reader: IReader): boolean {\n\t\treturn this.visibleUris.read(reader).has(uri.toString());\n\t}\n}\n\nexport class AnnotatedDocument extends Disposable {\n\tpublic readonly documentWithAnnotations;\n\n\tconstructor(\n\t\tpublic readonly document: IObservableDocument,\n\t\tpublic readonly isVisible: IObservable<boolean>,\n\t\t@IInstantiationService private readonly _instantiationService: IInstantiationService\n\t) {\n\t\tsuper();\n\n\t\tlet processedDoc: IDocumentWithAnnotatedEdits<EditSourceData> = this._store.add(new DocumentWithSourceAnnotatedEdits(document));\n\t\t// Combine streaming edits into one and make edit smaller\n\t\tprocessedDoc = this._store.add(this._instantiationService.createInstance((CombineStreamedChanges<EditSourceData>), processedDoc));\n\t\t// Remove common suffix and prefix from edits\n\t\tprocessedDoc = this._store.add(new MinimizeEditsProcessor(processedDoc));\n\n\t\tthis.documentWithAnnotations = processedDoc;\n\t}\n}\n"]}