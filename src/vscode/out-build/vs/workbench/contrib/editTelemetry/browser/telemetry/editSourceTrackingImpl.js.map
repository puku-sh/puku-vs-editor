{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/contrib/editTelemetry/browser/telemetry/editSourceTrackingImpl.ts","vs/workbench/contrib/editTelemetry/browser/telemetry/editSourceTrackingImpl.ts"],"names":[],"mappings":"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","file":"editSourceTrackingImpl.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { reverseOrder, compareBy, numberComparator, sumBy } from '../../../../../base/common/arrays.js';\nimport { IntervalTimer, TimeoutTimer } from '../../../../../base/common/async.js';\nimport { toDisposable, Disposable } from '../../../../../base/common/lifecycle.js';\nimport { mapObservableArrayCached, derived, IObservable, observableSignal, runOnChange, autorun } from '../../../../../base/common/observable.js';\nimport { IInstantiationService } from '../../../../../platform/instantiation/common/instantiation.js';\nimport { ITelemetryService } from '../../../../../platform/telemetry/common/telemetry.js';\nimport { AnnotatedDocument, IAnnotatedDocuments } from '../helpers/annotatedDocuments.js';\nimport { CreateSuggestionIdForChatOrInlineChatCaller, EditTelemetryReportEditArcForChatOrInlineChatSender, EditTelemetryReportInlineEditArcSender } from './arcTelemetrySender.js';\nimport { createDocWithJustReason, EditSource } from '../helpers/documentWithAnnotatedEdits.js';\nimport { DocumentEditSourceTracker, TrackedEdit } from './editTracker.js';\nimport { sumByCategory } from '../helpers/utils.js';\nimport { ScmAdapter, ScmRepoAdapter } from './scmAdapter.js';\nimport { IRandomService } from '../randomService.js';\n\nexport class EditSourceTrackingImpl extends Disposable {\n\tpublic readonly docsState;\n\tprivate readonly _states;\n\n\tconstructor(\n\t\tprivate readonly _statsEnabled: IObservable<boolean>,\n\t\tprivate readonly _annotatedDocuments: IAnnotatedDocuments,\n\t\t@IInstantiationService private readonly _instantiationService: IInstantiationService,\n\t) {\n\t\tsuper();\n\n\t\tconst scmBridge = this._instantiationService.createInstance(ScmAdapter);\n\t\tthis._states = mapObservableArrayCached(this, this._annotatedDocuments.documents, (doc, store) => {\n\t\t\treturn [doc.document, store.add(this._instantiationService.createInstance(TrackedDocumentInfo, doc, scmBridge, this._statsEnabled))] as const;\n\t\t});\n\t\tthis.docsState = this._states.map((entries) => new Map(entries));\n\n\t\tthis.docsState.recomputeInitiallyAndOnChange(this._store);\n\t}\n}\n\nclass TrackedDocumentInfo extends Disposable {\n\tpublic readonly longtermTracker: IObservable<DocumentEditSourceTracker<undefined> | undefined>;\n\tpublic readonly windowedTracker: IObservable<DocumentEditSourceTracker<undefined> | undefined>;\n\n\tprivate readonly _repo: IObservable<ScmRepoAdapter | undefined>;\n\n\tconstructor(\n\t\tprivate readonly _doc: AnnotatedDocument,\n\t\tprivate readonly _scm: ScmAdapter,\n\t\tprivate readonly _statsEnabled: IObservable<boolean>,\n\t\t@IInstantiationService private readonly _instantiationService: IInstantiationService,\n\t\t@ITelemetryService private readonly _telemetryService: ITelemetryService,\n\t\t@IRandomService private readonly _randomService: IRandomService,\n\t) {\n\t\tsuper();\n\n\t\tthis._repo = derived(this, reader => this._scm.getRepo(_doc.document.uri, reader));\n\n\t\tconst docWithJustReason = createDocWithJustReason(_doc.documentWithAnnotations, this._store);\n\n\t\tconst longtermResetSignal = observableSignal('resetSignal');\n\n\t\tlet longtermReason: '10hours' | 'hashChange' | 'branchChange' | 'closed' = 'closed';\n\t\tthis.longtermTracker = derived((reader) => {\n\t\t\tif (!this._statsEnabled.read(reader)) { return undefined; }\n\t\t\tlongtermResetSignal.read(reader);\n\n\t\t\tconst t = reader.store.add(new DocumentEditSourceTracker(docWithJustReason, undefined));\n\t\t\treader.store.add(toDisposable(() => {\n\t\t\t\t// send long term document telemetry\n\t\t\t\tif (!t.isEmpty()) {\n\t\t\t\t\tthis.sendTelemetry('longterm', longtermReason, t);\n\t\t\t\t}\n\t\t\t\tt.dispose();\n\t\t\t}));\n\t\t\treturn t;\n\t\t}).recomputeInitiallyAndOnChange(this._store);\n\n\t\tthis._store.add(new IntervalTimer()).cancelAndSet(() => {\n\t\t\t// Reset after 10 hours\n\t\t\tlongtermReason = '10hours';\n\t\t\tlongtermResetSignal.trigger(undefined);\n\t\t\tlongtermReason = 'closed';\n\t\t}, 10 * 60 * 60 * 1000);\n\n\t\t// Reset on branch change or commit\n\t\tthis._store.add(autorun(reader => {\n\t\t\tconst repo = this._repo.read(reader);\n\t\t\tif (repo) {\n\t\t\t\treader.store.add(runOnChange(repo.headCommitHashObs, () => {\n\t\t\t\t\tlongtermReason = 'hashChange';\n\t\t\t\t\tlongtermResetSignal.trigger(undefined);\n\t\t\t\t\tlongtermReason = 'closed';\n\t\t\t\t}));\n\t\t\t\treader.store.add(runOnChange(repo.headBranchNameObs, () => {\n\t\t\t\t\tlongtermReason = 'branchChange';\n\t\t\t\t\tlongtermResetSignal.trigger(undefined);\n\t\t\t\t\tlongtermReason = 'closed';\n\t\t\t\t}));\n\t\t\t}\n\t\t}));\n\n\t\tthis._store.add(this._instantiationService.createInstance(EditTelemetryReportInlineEditArcSender, _doc.documentWithAnnotations, this._repo));\n\t\tthis._store.add(this._instantiationService.createInstance(EditTelemetryReportEditArcForChatOrInlineChatSender, _doc.documentWithAnnotations, this._repo));\n\t\tthis._store.add(this._instantiationService.createInstance(CreateSuggestionIdForChatOrInlineChatCaller, _doc.documentWithAnnotations));\n\n\t\tconst resetSignal = observableSignal('resetSignal');\n\n\t\tthis.windowedTracker = derived((reader) => {\n\t\t\tif (!this._statsEnabled.read(reader)) { return undefined; }\n\n\t\t\tif (!this._doc.isVisible.read(reader)) {\n\t\t\t\treturn undefined;\n\t\t\t}\n\t\t\tresetSignal.read(reader);\n\n\t\t\treader.store.add(new TimeoutTimer(() => {\n\t\t\t\t// Reset after 5 minutes\n\t\t\t\tresetSignal.trigger(undefined);\n\t\t\t}, 5 * 60 * 1000));\n\n\t\t\tconst t = reader.store.add(new DocumentEditSourceTracker(docWithJustReason, undefined));\n\t\t\treader.store.add(toDisposable(async () => {\n\t\t\t\t// send long term document telemetry\n\t\t\t\tthis.sendTelemetry('5minWindow', 'time', t);\n\t\t\t\tt.dispose();\n\t\t\t}));\n\n\t\t\treturn t;\n\t\t}).recomputeInitiallyAndOnChange(this._store);\n\n\t}\n\n\tasync sendTelemetry(mode: 'longterm' | '5minWindow', trigger: string, t: DocumentEditSourceTracker) {\n\t\tconst ranges = t.getTrackedRanges();\n\t\tconst keys = t.getAllKeys();\n\t\tif (keys.length === 0) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst data = this.getTelemetryData(ranges);\n\n\t\tconst statsUuid = this._randomService.generateUuid();\n\n\t\tconst sums = sumByCategory(ranges, r => r.range.length, r => r.sourceKey);\n\t\tconst entries = Object.entries(sums).filter(([key, value]) => value !== undefined);\n\t\tentries.sort(reverseOrder(compareBy(([key, value]) => value!, numberComparator)));\n\t\tentries.length = mode === 'longterm' ? 30 : 10;\n\n\t\tfor (const key of keys) {\n\t\t\tif (!sums[key]) {\n\t\t\t\tsums[key] = 0;\n\t\t\t}\n\t\t}\n\n\t\tfor (const [key, value] of Object.entries(sums)) {\n\t\t\tif (value === undefined) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tconst repr = t.getRepresentative(key)!;\n\t\t\tconst deltaModifiedCount = t.getTotalInsertedCharactersCount(key);\n\n\t\t\tthis._telemetryService.publicLog2<{\n\t\t\t\tmode: string;\n\t\t\t\tsourceKey: string;\n\n\t\t\t\tsourceKeyCleaned: string;\n\t\t\t\textensionId: string | undefined;\n\t\t\t\textensionVersion: string | undefined;\n\t\t\t\tmodelId: string | undefined;\n\n\t\t\t\ttrigger: string;\n\t\t\t\tlanguageId: string;\n\t\t\t\tstatsUuid: string;\n\t\t\t\tmodifiedCount: number;\n\t\t\t\tdeltaModifiedCount: number;\n\t\t\t\ttotalModifiedCount: number;\n\t\t\t}, {\n\t\t\t\towner: 'hediet';\n\t\t\t\tcomment: 'Provides detailed character count breakdown for individual edit sources (typing, paste, inline completions, NES, etc.) within a session. Reports the top 10-30 sources per session with granular metadata including extension IDs and model IDs for AI edits. Sessions are scoped to either 5-minute windows for visible documents or longer periods ending on branch changes, commits, or 10-hour intervals. This event complements editSources.stats by providing source-specific details. @sentToGitHub';\n\n\t\t\t\tmode: { classification: 'SystemMetaData'; purpose: 'PerformanceAndHealth'; comment: 'Describes the session mode. Is either \\'longterm\\' or \\'5minWindow\\'.' };\n\t\t\t\tsourceKey: { classification: 'SystemMetaData'; purpose: 'FeatureInsight'; comment: 'A description of the source of the edit.' };\n\n\t\t\t\tsourceKeyCleaned: { classification: 'SystemMetaData'; purpose: 'FeatureInsight'; comment: 'The source of the edit with some properties (such as extensionId, extensionVersion and modelId) removed.' };\n\t\t\t\textensionId: { classification: 'SystemMetaData'; purpose: 'FeatureInsight'; comment: 'The extension id.' };\n\t\t\t\textensionVersion: { classification: 'SystemMetaData'; purpose: 'FeatureInsight'; comment: 'The version of the extension.' };\n\t\t\t\tmodelId: { classification: 'SystemMetaData'; purpose: 'FeatureInsight'; comment: 'The LLM id.' };\n\n\t\t\t\tlanguageId: { classification: 'SystemMetaData'; purpose: 'FeatureInsight'; comment: 'The language id of the document.' };\n\t\t\t\tstatsUuid: { classification: 'SystemMetaData'; purpose: 'PerformanceAndHealth'; comment: 'The unique identifier of the session for which stats are reported. The sourceKey is unique in this session.' };\n\n\t\t\t\ttrigger: { classification: 'SystemMetaData'; purpose: 'FeatureInsight'; comment: 'Indicates why the session ended.' };\n\n\t\t\t\tmodifiedCount: { classification: 'SystemMetaData'; purpose: 'PerformanceAndHealth'; comment: 'The number of characters inserted by the given edit source during the session that are still in the text document at the end of the session.'; isMeasurement: true };\n\t\t\t\tdeltaModifiedCount: { classification: 'SystemMetaData'; purpose: 'PerformanceAndHealth'; comment: 'The number of characters inserted by the given edit source during the session.'; isMeasurement: true };\n\t\t\t\ttotalModifiedCount: { classification: 'SystemMetaData'; purpose: 'PerformanceAndHealth'; comment: 'The number of characters inserted by any edit source during the session that are still in the text document at the end of the session.'; isMeasurement: true };\n\n\t\t\t}>('editTelemetry.editSources.details', {\n\t\t\t\tmode,\n\t\t\t\tsourceKey: key,\n\n\t\t\t\tsourceKeyCleaned: repr.toKey(1, { $extensionId: false, $extensionVersion: false, $modelId: false }),\n\t\t\t\textensionId: repr.props.$extensionId,\n\t\t\t\textensionVersion: repr.props.$extensionVersion,\n\t\t\t\tmodelId: repr.props.$modelId,\n\n\t\t\t\ttrigger,\n\t\t\t\tlanguageId: this._doc.document.languageId.get(),\n\t\t\t\tstatsUuid: statsUuid,\n\t\t\t\tmodifiedCount: value,\n\t\t\t\tdeltaModifiedCount: deltaModifiedCount,\n\t\t\t\ttotalModifiedCount: data.totalModifiedCharactersInFinalState,\n\t\t\t});\n\t\t}\n\n\n\t\tconst isTrackedByGit = await data.isTrackedByGit;\n\t\tthis._telemetryService.publicLog2<{\n\t\t\tmode: string;\n\t\t\tlanguageId: string;\n\t\t\tstatsUuid: string;\n\t\t\tnesModifiedCount: number;\n\t\t\tinlineCompletionsCopilotModifiedCount: number;\n\t\t\tinlineCompletionsNESModifiedCount: number;\n\t\t\totherAIModifiedCount: number;\n\t\t\tunknownModifiedCount: number;\n\t\t\tuserModifiedCount: number;\n\t\t\tideModifiedCount: number;\n\t\t\ttotalModifiedCharacters: number;\n\t\t\texternalModifiedCount: number;\n\t\t\tisTrackedByGit: number;\n\t\t}, {\n\t\t\towner: 'hediet';\n\t\t\tcomment: 'Aggregates character counts by edit source category (user typing, AI completions, NES, IDE actions, external changes) for each editing session. Sessions represent units of work and end when documents close, branches change, commits occur, or time limits are reached (5 minutes for visible documents, 10 hours otherwise). Tracks both total characters inserted and characters remaining at session end to measure retention. This high-level summary complements editSources.details which provides granular per-source breakdowns. @sentToGitHub';\n\n\t\t\tmode: { classification: 'SystemMetaData'; purpose: 'PerformanceAndHealth'; comment: 'longterm or 5minWindow' };\n\t\t\tlanguageId: { classification: 'SystemMetaData'; purpose: 'FeatureInsight'; comment: 'The language id of the document.' };\n\t\t\tstatsUuid: { classification: 'SystemMetaData'; purpose: 'PerformanceAndHealth'; comment: 'The unique identifier for the telemetry event.' };\n\n\t\t\tnesModifiedCount: { classification: 'SystemMetaData'; purpose: 'PerformanceAndHealth'; comment: 'Fraction of nes modified characters'; isMeasurement: true };\n\t\t\tinlineCompletionsCopilotModifiedCount: { classification: 'SystemMetaData'; purpose: 'PerformanceAndHealth'; comment: 'Fraction of inline completions copilot modified characters'; isMeasurement: true };\n\t\t\tinlineCompletionsNESModifiedCount: { classification: 'SystemMetaData'; purpose: 'PerformanceAndHealth'; comment: 'Fraction of inline completions nes modified characters'; isMeasurement: true };\n\t\t\totherAIModifiedCount: { classification: 'SystemMetaData'; purpose: 'PerformanceAndHealth'; comment: 'Fraction of other AI modified characters'; isMeasurement: true };\n\t\t\tunknownModifiedCount: { classification: 'SystemMetaData'; purpose: 'PerformanceAndHealth'; comment: 'Fraction of unknown modified characters'; isMeasurement: true };\n\t\t\tuserModifiedCount: { classification: 'SystemMetaData'; purpose: 'PerformanceAndHealth'; comment: 'Fraction of user modified characters'; isMeasurement: true };\n\t\t\tideModifiedCount: { classification: 'SystemMetaData'; purpose: 'PerformanceAndHealth'; comment: 'Fraction of IDE modified characters'; isMeasurement: true };\n\t\t\ttotalModifiedCharacters: { classification: 'SystemMetaData'; purpose: 'PerformanceAndHealth'; comment: 'Total modified characters'; isMeasurement: true };\n\t\t\texternalModifiedCount: { classification: 'SystemMetaData'; purpose: 'PerformanceAndHealth'; comment: 'Fraction of external modified characters'; isMeasurement: true };\n\t\t\tisTrackedByGit: { classification: 'SystemMetaData'; purpose: 'FeatureInsight'; comment: 'Indicates if the document is tracked by git.' };\n\t\t}>('editTelemetry.editSources.stats', {\n\t\t\tmode,\n\t\t\tlanguageId: this._doc.document.languageId.get(),\n\t\t\tstatsUuid: statsUuid,\n\t\t\tnesModifiedCount: data.nesModifiedCount,\n\t\t\tinlineCompletionsCopilotModifiedCount: data.inlineCompletionsCopilotModifiedCount,\n\t\t\tinlineCompletionsNESModifiedCount: data.inlineCompletionsNESModifiedCount,\n\t\t\totherAIModifiedCount: data.otherAIModifiedCount,\n\t\t\tunknownModifiedCount: data.unknownModifiedCount,\n\t\t\tuserModifiedCount: data.userModifiedCount,\n\t\t\tideModifiedCount: data.ideModifiedCount,\n\t\t\ttotalModifiedCharacters: data.totalModifiedCharactersInFinalState,\n\t\t\texternalModifiedCount: data.externalModifiedCount,\n\t\t\tisTrackedByGit: isTrackedByGit ? 1 : 0,\n\t\t});\n\t}\n\n\tgetTelemetryData(ranges: readonly TrackedEdit[]) {\n\t\tconst getEditCategory = (source: EditSource) => {\n\t\t\tif (source.category === 'ai' && source.kind === 'nes') { return 'nes'; }\n\n\t\t\tif (source.category === 'ai' && source.kind === 'completion' && source.extensionId === 'github.copilot') { return 'inlineCompletionsCopilot'; }\n\t\t\tif (source.category === 'ai' && source.kind === 'completion' && source.extensionId === 'github.copilot-chat' && source.providerId === 'completions') { return 'inlineCompletionsCopilot'; }\n\t\t\tif (source.category === 'ai' && source.kind === 'completion' && source.extensionId === 'github.copilot-chat' && source.providerId === 'nes') { return 'inlineCompletionsNES'; }\n\t\t\tif (source.category === 'ai' && source.kind === 'completion') { return 'inlineCompletionsOther'; }\n\n\t\t\tif (source.category === 'ai') { return 'otherAI'; }\n\t\t\tif (source.category === 'user') { return 'user'; }\n\t\t\tif (source.category === 'ide') { return 'ide'; }\n\t\t\tif (source.category === 'external') { return 'external'; }\n\t\t\tif (source.category === 'unknown') { return 'unknown'; }\n\n\t\t\treturn 'unknown';\n\t\t};\n\n\t\tconst sums = sumByCategory(ranges, r => r.range.length, r => getEditCategory(r.source));\n\t\tconst totalModifiedCharactersInFinalState = sumBy(ranges, r => r.range.length);\n\n\t\treturn {\n\t\t\tnesModifiedCount: sums.nes ?? 0,\n\t\t\tinlineCompletionsCopilotModifiedCount: sums.inlineCompletionsCopilot ?? 0,\n\t\t\tinlineCompletionsNESModifiedCount: sums.inlineCompletionsNES ?? 0,\n\t\t\totherAIModifiedCount: sums.otherAI ?? 0,\n\t\t\tuserModifiedCount: sums.user ?? 0,\n\t\t\tideModifiedCount: sums.ide ?? 0,\n\t\t\tunknownModifiedCount: sums.unknown ?? 0,\n\t\t\texternalModifiedCount: sums.external ?? 0,\n\t\t\ttotalModifiedCharactersInFinalState,\n\t\t\tlanguageId: this._doc.document.languageId.get(),\n\t\t\tisTrackedByGit: this._repo.get()?.isIgnored(this._doc.document.uri),\n\t\t};\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { reverseOrder, compareBy, numberComparator, sumBy } from '../../../../../base/common/arrays.js';\nimport { IntervalTimer, TimeoutTimer } from '../../../../../base/common/async.js';\nimport { toDisposable, Disposable } from '../../../../../base/common/lifecycle.js';\nimport { mapObservableArrayCached, derived, IObservable, observableSignal, runOnChange, autorun } from '../../../../../base/common/observable.js';\nimport { IInstantiationService } from '../../../../../platform/instantiation/common/instantiation.js';\nimport { ITelemetryService } from '../../../../../platform/telemetry/common/telemetry.js';\nimport { AnnotatedDocument, IAnnotatedDocuments } from '../helpers/annotatedDocuments.js';\nimport { CreateSuggestionIdForChatOrInlineChatCaller, EditTelemetryReportEditArcForChatOrInlineChatSender, EditTelemetryReportInlineEditArcSender } from './arcTelemetrySender.js';\nimport { createDocWithJustReason, EditSource } from '../helpers/documentWithAnnotatedEdits.js';\nimport { DocumentEditSourceTracker, TrackedEdit } from './editTracker.js';\nimport { sumByCategory } from '../helpers/utils.js';\nimport { ScmAdapter, ScmRepoAdapter } from './scmAdapter.js';\nimport { IRandomService } from '../randomService.js';\n\nexport class EditSourceTrackingImpl extends Disposable {\n\tpublic readonly docsState;\n\tprivate readonly _states;\n\n\tconstructor(\n\t\tprivate readonly _statsEnabled: IObservable<boolean>,\n\t\tprivate readonly _annotatedDocuments: IAnnotatedDocuments,\n\t\t@IInstantiationService private readonly _instantiationService: IInstantiationService,\n\t) {\n\t\tsuper();\n\n\t\tconst scmBridge = this._instantiationService.createInstance(ScmAdapter);\n\t\tthis._states = mapObservableArrayCached(this, this._annotatedDocuments.documents, (doc, store) => {\n\t\t\treturn [doc.document, store.add(this._instantiationService.createInstance(TrackedDocumentInfo, doc, scmBridge, this._statsEnabled))] as const;\n\t\t});\n\t\tthis.docsState = this._states.map((entries) => new Map(entries));\n\n\t\tthis.docsState.recomputeInitiallyAndOnChange(this._store);\n\t}\n}\n\nclass TrackedDocumentInfo extends Disposable {\n\tpublic readonly longtermTracker: IObservable<DocumentEditSourceTracker<undefined> | undefined>;\n\tpublic readonly windowedTracker: IObservable<DocumentEditSourceTracker<undefined> | undefined>;\n\n\tprivate readonly _repo: IObservable<ScmRepoAdapter | undefined>;\n\n\tconstructor(\n\t\tprivate readonly _doc: AnnotatedDocument,\n\t\tprivate readonly _scm: ScmAdapter,\n\t\tprivate readonly _statsEnabled: IObservable<boolean>,\n\t\t@IInstantiationService private readonly _instantiationService: IInstantiationService,\n\t\t@ITelemetryService private readonly _telemetryService: ITelemetryService,\n\t\t@IRandomService private readonly _randomService: IRandomService,\n\t) {\n\t\tsuper();\n\n\t\tthis._repo = derived(this, reader => this._scm.getRepo(_doc.document.uri, reader));\n\n\t\tconst docWithJustReason = createDocWithJustReason(_doc.documentWithAnnotations, this._store);\n\n\t\tconst longtermResetSignal = observableSignal('resetSignal');\n\n\t\tlet longtermReason: '10hours' | 'hashChange' | 'branchChange' | 'closed' = 'closed';\n\t\tthis.longtermTracker = derived((reader) => {\n\t\t\tif (!this._statsEnabled.read(reader)) { return undefined; }\n\t\t\tlongtermResetSignal.read(reader);\n\n\t\t\tconst t = reader.store.add(new DocumentEditSourceTracker(docWithJustReason, undefined));\n\t\t\treader.store.add(toDisposable(() => {\n\t\t\t\t// send long term document telemetry\n\t\t\t\tif (!t.isEmpty()) {\n\t\t\t\t\tthis.sendTelemetry('longterm', longtermReason, t);\n\t\t\t\t}\n\t\t\t\tt.dispose();\n\t\t\t}));\n\t\t\treturn t;\n\t\t}).recomputeInitiallyAndOnChange(this._store);\n\n\t\tthis._store.add(new IntervalTimer()).cancelAndSet(() => {\n\t\t\t// Reset after 10 hours\n\t\t\tlongtermReason = '10hours';\n\t\t\tlongtermResetSignal.trigger(undefined);\n\t\t\tlongtermReason = 'closed';\n\t\t}, 10 * 60 * 60 * 1000);\n\n\t\t// Reset on branch change or commit\n\t\tthis._store.add(autorun(reader => {\n\t\t\tconst repo = this._repo.read(reader);\n\t\t\tif (repo) {\n\t\t\t\treader.store.add(runOnChange(repo.headCommitHashObs, () => {\n\t\t\t\t\tlongtermReason = 'hashChange';\n\t\t\t\t\tlongtermResetSignal.trigger(undefined);\n\t\t\t\t\tlongtermReason = 'closed';\n\t\t\t\t}));\n\t\t\t\treader.store.add(runOnChange(repo.headBranchNameObs, () => {\n\t\t\t\t\tlongtermReason = 'branchChange';\n\t\t\t\t\tlongtermResetSignal.trigger(undefined);\n\t\t\t\t\tlongtermReason = 'closed';\n\t\t\t\t}));\n\t\t\t}\n\t\t}));\n\n\t\tthis._store.add(this._instantiationService.createInstance(EditTelemetryReportInlineEditArcSender, _doc.documentWithAnnotations, this._repo));\n\t\tthis._store.add(this._instantiationService.createInstance(EditTelemetryReportEditArcForChatOrInlineChatSender, _doc.documentWithAnnotations, this._repo));\n\t\tthis._store.add(this._instantiationService.createInstance(CreateSuggestionIdForChatOrInlineChatCaller, _doc.documentWithAnnotations));\n\n\t\tconst resetSignal = observableSignal('resetSignal');\n\n\t\tthis.windowedTracker = derived((reader) => {\n\t\t\tif (!this._statsEnabled.read(reader)) { return undefined; }\n\n\t\t\tif (!this._doc.isVisible.read(reader)) {\n\t\t\t\treturn undefined;\n\t\t\t}\n\t\t\tresetSignal.read(reader);\n\n\t\t\treader.store.add(new TimeoutTimer(() => {\n\t\t\t\t// Reset after 5 minutes\n\t\t\t\tresetSignal.trigger(undefined);\n\t\t\t}, 5 * 60 * 1000));\n\n\t\t\tconst t = reader.store.add(new DocumentEditSourceTracker(docWithJustReason, undefined));\n\t\t\treader.store.add(toDisposable(async () => {\n\t\t\t\t// send long term document telemetry\n\t\t\t\tthis.sendTelemetry('5minWindow', 'time', t);\n\t\t\t\tt.dispose();\n\t\t\t}));\n\n\t\t\treturn t;\n\t\t}).recomputeInitiallyAndOnChange(this._store);\n\n\t}\n\n\tasync sendTelemetry(mode: 'longterm' | '5minWindow', trigger: string, t: DocumentEditSourceTracker) {\n\t\tconst ranges = t.getTrackedRanges();\n\t\tconst keys = t.getAllKeys();\n\t\tif (keys.length === 0) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst data = this.getTelemetryData(ranges);\n\n\t\tconst statsUuid = this._randomService.generateUuid();\n\n\t\tconst sums = sumByCategory(ranges, r => r.range.length, r => r.sourceKey);\n\t\tconst entries = Object.entries(sums).filter(([key, value]) => value !== undefined);\n\t\tentries.sort(reverseOrder(compareBy(([key, value]) => value!, numberComparator)));\n\t\tentries.length = mode === 'longterm' ? 30 : 10;\n\n\t\tfor (const key of keys) {\n\t\t\tif (!sums[key]) {\n\t\t\t\tsums[key] = 0;\n\t\t\t}\n\t\t}\n\n\t\tfor (const [key, value] of Object.entries(sums)) {\n\t\t\tif (value === undefined) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tconst repr = t.getRepresentative(key)!;\n\t\t\tconst deltaModifiedCount = t.getTotalInsertedCharactersCount(key);\n\n\t\t\tthis._telemetryService.publicLog2<{\n\t\t\t\tmode: string;\n\t\t\t\tsourceKey: string;\n\n\t\t\t\tsourceKeyCleaned: string;\n\t\t\t\textensionId: string | undefined;\n\t\t\t\textensionVersion: string | undefined;\n\t\t\t\tmodelId: string | undefined;\n\n\t\t\t\ttrigger: string;\n\t\t\t\tlanguageId: string;\n\t\t\t\tstatsUuid: string;\n\t\t\t\tmodifiedCount: number;\n\t\t\t\tdeltaModifiedCount: number;\n\t\t\t\ttotalModifiedCount: number;\n\t\t\t}, {\n\t\t\t\towner: 'hediet';\n\t\t\t\tcomment: 'Provides detailed character count breakdown for individual edit sources (typing, paste, inline completions, NES, etc.) within a session. Reports the top 10-30 sources per session with granular metadata including extension IDs and model IDs for AI edits. Sessions are scoped to either 5-minute windows for visible documents or longer periods ending on branch changes, commits, or 10-hour intervals. This event complements editSources.stats by providing source-specific details. @sentToGitHub';\n\n\t\t\t\tmode: { classification: 'SystemMetaData'; purpose: 'PerformanceAndHealth'; comment: 'Describes the session mode. Is either \\'longterm\\' or \\'5minWindow\\'.' };\n\t\t\t\tsourceKey: { classification: 'SystemMetaData'; purpose: 'FeatureInsight'; comment: 'A description of the source of the edit.' };\n\n\t\t\t\tsourceKeyCleaned: { classification: 'SystemMetaData'; purpose: 'FeatureInsight'; comment: 'The source of the edit with some properties (such as extensionId, extensionVersion and modelId) removed.' };\n\t\t\t\textensionId: { classification: 'SystemMetaData'; purpose: 'FeatureInsight'; comment: 'The extension id.' };\n\t\t\t\textensionVersion: { classification: 'SystemMetaData'; purpose: 'FeatureInsight'; comment: 'The version of the extension.' };\n\t\t\t\tmodelId: { classification: 'SystemMetaData'; purpose: 'FeatureInsight'; comment: 'The LLM id.' };\n\n\t\t\t\tlanguageId: { classification: 'SystemMetaData'; purpose: 'FeatureInsight'; comment: 'The language id of the document.' };\n\t\t\t\tstatsUuid: { classification: 'SystemMetaData'; purpose: 'PerformanceAndHealth'; comment: 'The unique identifier of the session for which stats are reported. The sourceKey is unique in this session.' };\n\n\t\t\t\ttrigger: { classification: 'SystemMetaData'; purpose: 'FeatureInsight'; comment: 'Indicates why the session ended.' };\n\n\t\t\t\tmodifiedCount: { classification: 'SystemMetaData'; purpose: 'PerformanceAndHealth'; comment: 'The number of characters inserted by the given edit source during the session that are still in the text document at the end of the session.'; isMeasurement: true };\n\t\t\t\tdeltaModifiedCount: { classification: 'SystemMetaData'; purpose: 'PerformanceAndHealth'; comment: 'The number of characters inserted by the given edit source during the session.'; isMeasurement: true };\n\t\t\t\ttotalModifiedCount: { classification: 'SystemMetaData'; purpose: 'PerformanceAndHealth'; comment: 'The number of characters inserted by any edit source during the session that are still in the text document at the end of the session.'; isMeasurement: true };\n\n\t\t\t}>('editTelemetry.editSources.details', {\n\t\t\t\tmode,\n\t\t\t\tsourceKey: key,\n\n\t\t\t\tsourceKeyCleaned: repr.toKey(1, { $extensionId: false, $extensionVersion: false, $modelId: false }),\n\t\t\t\textensionId: repr.props.$extensionId,\n\t\t\t\textensionVersion: repr.props.$extensionVersion,\n\t\t\t\tmodelId: repr.props.$modelId,\n\n\t\t\t\ttrigger,\n\t\t\t\tlanguageId: this._doc.document.languageId.get(),\n\t\t\t\tstatsUuid: statsUuid,\n\t\t\t\tmodifiedCount: value,\n\t\t\t\tdeltaModifiedCount: deltaModifiedCount,\n\t\t\t\ttotalModifiedCount: data.totalModifiedCharactersInFinalState,\n\t\t\t});\n\t\t}\n\n\n\t\tconst isTrackedByGit = await data.isTrackedByGit;\n\t\tthis._telemetryService.publicLog2<{\n\t\t\tmode: string;\n\t\t\tlanguageId: string;\n\t\t\tstatsUuid: string;\n\t\t\tnesModifiedCount: number;\n\t\t\tinlineCompletionsCopilotModifiedCount: number;\n\t\t\tinlineCompletionsNESModifiedCount: number;\n\t\t\totherAIModifiedCount: number;\n\t\t\tunknownModifiedCount: number;\n\t\t\tuserModifiedCount: number;\n\t\t\tideModifiedCount: number;\n\t\t\ttotalModifiedCharacters: number;\n\t\t\texternalModifiedCount: number;\n\t\t\tisTrackedByGit: number;\n\t\t}, {\n\t\t\towner: 'hediet';\n\t\t\tcomment: 'Aggregates character counts by edit source category (user typing, AI completions, NES, IDE actions, external changes) for each editing session. Sessions represent units of work and end when documents close, branches change, commits occur, or time limits are reached (5 minutes for visible documents, 10 hours otherwise). Tracks both total characters inserted and characters remaining at session end to measure retention. This high-level summary complements editSources.details which provides granular per-source breakdowns. @sentToGitHub';\n\n\t\t\tmode: { classification: 'SystemMetaData'; purpose: 'PerformanceAndHealth'; comment: 'longterm or 5minWindow' };\n\t\t\tlanguageId: { classification: 'SystemMetaData'; purpose: 'FeatureInsight'; comment: 'The language id of the document.' };\n\t\t\tstatsUuid: { classification: 'SystemMetaData'; purpose: 'PerformanceAndHealth'; comment: 'The unique identifier for the telemetry event.' };\n\n\t\t\tnesModifiedCount: { classification: 'SystemMetaData'; purpose: 'PerformanceAndHealth'; comment: 'Fraction of nes modified characters'; isMeasurement: true };\n\t\t\tinlineCompletionsCopilotModifiedCount: { classification: 'SystemMetaData'; purpose: 'PerformanceAndHealth'; comment: 'Fraction of inline completions copilot modified characters'; isMeasurement: true };\n\t\t\tinlineCompletionsNESModifiedCount: { classification: 'SystemMetaData'; purpose: 'PerformanceAndHealth'; comment: 'Fraction of inline completions nes modified characters'; isMeasurement: true };\n\t\t\totherAIModifiedCount: { classification: 'SystemMetaData'; purpose: 'PerformanceAndHealth'; comment: 'Fraction of other AI modified characters'; isMeasurement: true };\n\t\t\tunknownModifiedCount: { classification: 'SystemMetaData'; purpose: 'PerformanceAndHealth'; comment: 'Fraction of unknown modified characters'; isMeasurement: true };\n\t\t\tuserModifiedCount: { classification: 'SystemMetaData'; purpose: 'PerformanceAndHealth'; comment: 'Fraction of user modified characters'; isMeasurement: true };\n\t\t\tideModifiedCount: { classification: 'SystemMetaData'; purpose: 'PerformanceAndHealth'; comment: 'Fraction of IDE modified characters'; isMeasurement: true };\n\t\t\ttotalModifiedCharacters: { classification: 'SystemMetaData'; purpose: 'PerformanceAndHealth'; comment: 'Total modified characters'; isMeasurement: true };\n\t\t\texternalModifiedCount: { classification: 'SystemMetaData'; purpose: 'PerformanceAndHealth'; comment: 'Fraction of external modified characters'; isMeasurement: true };\n\t\t\tisTrackedByGit: { classification: 'SystemMetaData'; purpose: 'FeatureInsight'; comment: 'Indicates if the document is tracked by git.' };\n\t\t}>('editTelemetry.editSources.stats', {\n\t\t\tmode,\n\t\t\tlanguageId: this._doc.document.languageId.get(),\n\t\t\tstatsUuid: statsUuid,\n\t\t\tnesModifiedCount: data.nesModifiedCount,\n\t\t\tinlineCompletionsCopilotModifiedCount: data.inlineCompletionsCopilotModifiedCount,\n\t\t\tinlineCompletionsNESModifiedCount: data.inlineCompletionsNESModifiedCount,\n\t\t\totherAIModifiedCount: data.otherAIModifiedCount,\n\t\t\tunknownModifiedCount: data.unknownModifiedCount,\n\t\t\tuserModifiedCount: data.userModifiedCount,\n\t\t\tideModifiedCount: data.ideModifiedCount,\n\t\t\ttotalModifiedCharacters: data.totalModifiedCharactersInFinalState,\n\t\t\texternalModifiedCount: data.externalModifiedCount,\n\t\t\tisTrackedByGit: isTrackedByGit ? 1 : 0,\n\t\t});\n\t}\n\n\tgetTelemetryData(ranges: readonly TrackedEdit[]) {\n\t\tconst getEditCategory = (source: EditSource) => {\n\t\t\tif (source.category === 'ai' && source.kind === 'nes') { return 'nes'; }\n\n\t\t\tif (source.category === 'ai' && source.kind === 'completion' && source.extensionId === 'github.copilot') { return 'inlineCompletionsCopilot'; }\n\t\t\tif (source.category === 'ai' && source.kind === 'completion' && source.extensionId === 'github.copilot-chat' && source.providerId === 'completions') { return 'inlineCompletionsCopilot'; }\n\t\t\tif (source.category === 'ai' && source.kind === 'completion' && source.extensionId === 'github.copilot-chat' && source.providerId === 'nes') { return 'inlineCompletionsNES'; }\n\t\t\tif (source.category === 'ai' && source.kind === 'completion') { return 'inlineCompletionsOther'; }\n\n\t\t\tif (source.category === 'ai') { return 'otherAI'; }\n\t\t\tif (source.category === 'user') { return 'user'; }\n\t\t\tif (source.category === 'ide') { return 'ide'; }\n\t\t\tif (source.category === 'external') { return 'external'; }\n\t\t\tif (source.category === 'unknown') { return 'unknown'; }\n\n\t\t\treturn 'unknown';\n\t\t};\n\n\t\tconst sums = sumByCategory(ranges, r => r.range.length, r => getEditCategory(r.source));\n\t\tconst totalModifiedCharactersInFinalState = sumBy(ranges, r => r.range.length);\n\n\t\treturn {\n\t\t\tnesModifiedCount: sums.nes ?? 0,\n\t\t\tinlineCompletionsCopilotModifiedCount: sums.inlineCompletionsCopilot ?? 0,\n\t\t\tinlineCompletionsNESModifiedCount: sums.inlineCompletionsNES ?? 0,\n\t\t\totherAIModifiedCount: sums.otherAI ?? 0,\n\t\t\tuserModifiedCount: sums.user ?? 0,\n\t\t\tideModifiedCount: sums.ide ?? 0,\n\t\t\tunknownModifiedCount: sums.unknown ?? 0,\n\t\t\texternalModifiedCount: sums.external ?? 0,\n\t\t\ttotalModifiedCharactersInFinalState,\n\t\t\tlanguageId: this._doc.document.languageId.get(),\n\t\t\tisTrackedByGit: this._repo.get()?.isIgnored(this._doc.document.uri),\n\t\t};\n\t}\n}\n"]}