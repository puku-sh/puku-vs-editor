{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/contrib/editTelemetry/browser/telemetry/editSourceTrackingFeature.ts","vs/workbench/contrib/editTelemetry/browser/telemetry/editSourceTrackingFeature.ts"],"names":[],"mappings":"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","file":"editSourceTrackingFeature.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\n\nimport { CachedFunction } from '../../../../../base/common/cache.js';\nimport { MarkdownString } from '../../../../../base/common/htmlContent.js';\nimport { Disposable } from '../../../../../base/common/lifecycle.js';\nimport { autorun, mapObservableArrayCached, derived, IObservable, ISettableObservable, observableValue, derivedWithSetter, observableFromEvent } from '../../../../../base/common/observable.js';\nimport { DynamicCssRules } from '../../../../../editor/browser/editorDom.js';\nimport { observableCodeEditor } from '../../../../../editor/browser/observableCodeEditor.js';\nimport { CodeEditorWidget } from '../../../../../editor/browser/widget/codeEditor/codeEditorWidget.js';\nimport { IModelDeltaDecoration } from '../../../../../editor/common/model.js';\nimport { CommandsRegistry } from '../../../../../platform/commands/common/commands.js';\nimport { IConfigurationService } from '../../../../../platform/configuration/common/configuration.js';\nimport { IInstantiationService } from '../../../../../platform/instantiation/common/instantiation.js';\nimport { ServiceCollection } from '../../../../../platform/instantiation/common/serviceCollection.js';\nimport { observableConfigValue } from '../../../../../platform/observable/common/platformObservableUtils.js';\nimport { ITelemetryService } from '../../../../../platform/telemetry/common/telemetry.js';\nimport { IEditorService } from '../../../../services/editor/common/editorService.js';\nimport { IStatusbarService, StatusbarAlignment } from '../../../../services/statusbar/browser/statusbar.js';\nimport { EditSource } from '../helpers/documentWithAnnotatedEdits.js';\nimport { EditSourceTrackingImpl } from './editSourceTrackingImpl.js';\nimport { IAnnotatedDocuments } from '../helpers/annotatedDocuments.js';\nimport { DataChannelForwardingTelemetryService } from '../../../../../platform/dataChannel/browser/forwardingTelemetryService.js';\nimport { EDIT_TELEMETRY_DETAILS_SETTING_ID, EDIT_TELEMETRY_SHOW_DECORATIONS, EDIT_TELEMETRY_SHOW_STATUS_BAR } from '../settings.js';\nimport { VSCodeWorkspace } from '../helpers/vscodeObservableWorkspace.js';\nimport { IExtensionService } from '../../../../services/extensions/common/extensions.js';\n\nexport class EditTrackingFeature extends Disposable {\n\n\tprivate readonly _editSourceTrackingShowDecorations;\n\tprivate readonly _editSourceTrackingShowStatusBar;\n\tprivate readonly _showStateInMarkdownDoc = 'editTelemetry.showDebugDetails';\n\tprivate readonly _toggleDecorations = 'editTelemetry.toggleDebugDecorations';\n\n\tconstructor(\n\t\tprivate readonly _workspace: VSCodeWorkspace,\n\t\tprivate readonly _annotatedDocuments: IAnnotatedDocuments,\n\t\t@IConfigurationService private readonly _configurationService: IConfigurationService,\n\t\t@IInstantiationService private readonly _instantiationService: IInstantiationService,\n\t\t@IStatusbarService private readonly _statusbarService: IStatusbarService,\n\n\t\t@IEditorService private readonly _editorService: IEditorService,\n\t\t@IExtensionService private readonly _extensionService: IExtensionService,\n\t) {\n\t\tsuper();\n\n\t\tthis._editSourceTrackingShowDecorations = makeSettable(observableConfigValue(EDIT_TELEMETRY_SHOW_DECORATIONS, false, this._configurationService));\n\t\tthis._editSourceTrackingShowStatusBar = observableConfigValue(EDIT_TELEMETRY_SHOW_STATUS_BAR, false, this._configurationService);\n\t\tconst editSourceDetailsEnabled = observableConfigValue(EDIT_TELEMETRY_DETAILS_SETTING_ID, false, this._configurationService);\n\n\t\tconst extensions = observableFromEvent(this._extensionService.onDidChangeExtensions, () => {\n\t\t\treturn this._extensionService.extensions;\n\t\t});\n\t\tconst extensionIds = derived(reader => new Set(extensions.read(reader).map(e => e.id?.toLowerCase())));\n\t\tfunction getExtensionInfoObs(extensionId: string, extensionService: IExtensionService) {\n\t\t\tconst extIdLowerCase = extensionId.toLowerCase();\n\t\t\treturn derived(reader => extensionIds.read(reader).has(extIdLowerCase));\n\t\t}\n\n\t\tconst copilotInstalled = getExtensionInfoObs('GitHub.copilot', this._extensionService);\n\t\tconst copilotChatInstalled = getExtensionInfoObs('GitHub.copilot-chat', this._extensionService);\n\n\t\tconst shouldSendDetails = derived(reader => editSourceDetailsEnabled.read(reader) || !!copilotInstalled.read(reader) || !!copilotChatInstalled.read(reader));\n\n\t\tconst instantiationServiceWithInterceptedTelemetry = this._instantiationService.createChild(new ServiceCollection(\n\t\t\t[ITelemetryService, this._instantiationService.createInstance(DataChannelForwardingTelemetryService)]\n\t\t));\n\t\tconst impl = this._register(instantiationServiceWithInterceptedTelemetry.createInstance(EditSourceTrackingImpl, shouldSendDetails, this._annotatedDocuments));\n\n\t\tthis._register(autorun((reader) => {\n\t\t\tif (!this._editSourceTrackingShowDecorations.read(reader)) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst visibleEditors = observableFromEvent(this, this._editorService.onDidVisibleEditorsChange, () => this._editorService.visibleTextEditorControls);\n\n\t\t\tmapObservableArrayCached(this, visibleEditors, (editor, store) => {\n\t\t\t\tif (editor instanceof CodeEditorWidget) {\n\t\t\t\t\tconst obsEditor = observableCodeEditor(editor);\n\n\t\t\t\t\tconst cssStyles = new DynamicCssRules(editor);\n\t\t\t\t\tconst decorations = new CachedFunction((source: EditSource) => {\n\t\t\t\t\t\tconst r = store.add(cssStyles.createClassNameRef({\n\t\t\t\t\t\t\tbackgroundColor: source.getColor(),\n\t\t\t\t\t\t}));\n\t\t\t\t\t\treturn r.className;\n\t\t\t\t\t});\n\n\t\t\t\t\tstore.add(obsEditor.setDecorations(derived(reader => {\n\t\t\t\t\t\tconst uri = obsEditor.model.read(reader)?.uri;\n\t\t\t\t\t\tif (!uri) { return []; }\n\t\t\t\t\t\tconst doc = this._workspace.getDocument(uri);\n\t\t\t\t\t\tif (!doc) { return []; }\n\t\t\t\t\t\tconst docsState = impl.docsState.read(reader).get(doc);\n\t\t\t\t\t\tif (!docsState) { return []; }\n\n\t\t\t\t\t\tconst ranges = (docsState.longtermTracker.read(reader)?.getTrackedRanges(reader)) ?? [];\n\n\t\t\t\t\t\treturn ranges.map<IModelDeltaDecoration>(r => ({\n\t\t\t\t\t\t\trange: doc.value.read(undefined).getTransformer().getRange(r.range),\n\t\t\t\t\t\t\toptions: {\n\t\t\t\t\t\t\t\tdescription: 'editSourceTracking',\n\t\t\t\t\t\t\t\tinlineClassName: decorations.get(r.source),\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}));\n\t\t\t\t\t})));\n\t\t\t\t}\n\t\t\t}).recomputeInitiallyAndOnChange(reader.store);\n\t\t}));\n\n\t\tthis._register(autorun(reader => {\n\t\t\tif (!this._editSourceTrackingShowStatusBar.read(reader)) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst statusBarItem = reader.store.add(this._statusbarService.addEntry(\n\t\t\t\t{\n\t\t\t\t\tname: '',\n\t\t\t\t\ttext: '',\n\t\t\t\t\tcommand: this._showStateInMarkdownDoc,\n\t\t\t\t\ttooltip: 'Edit Source Tracking',\n\t\t\t\t\tariaLabel: '',\n\t\t\t\t},\n\t\t\t\t'editTelemetry',\n\t\t\t\tStatusbarAlignment.RIGHT,\n\t\t\t\t100\n\t\t\t));\n\n\t\t\tconst sumChangedCharacters = derived(reader => {\n\t\t\t\tconst docs = impl.docsState.read(reader);\n\t\t\t\tlet sum = 0;\n\t\t\t\tfor (const state of docs.values()) {\n\t\t\t\t\tconst t = state.longtermTracker.read(reader);\n\t\t\t\t\tif (!t) { continue; }\n\t\t\t\t\tconst d = state.getTelemetryData(t.getTrackedRanges(reader));\n\t\t\t\t\tsum += d.totalModifiedCharactersInFinalState;\n\t\t\t\t}\n\t\t\t\treturn sum;\n\t\t\t});\n\n\t\t\tconst tooltipMarkdownString = derived(reader => {\n\t\t\t\tconst docs = impl.docsState.read(reader);\n\t\t\t\tconst docsDataInTooltip: string[] = [];\n\t\t\t\tconst editSources: EditSource[] = [];\n\t\t\t\tfor (const [doc, state] of docs) {\n\t\t\t\t\tconst tracker = state.longtermTracker.read(reader);\n\t\t\t\t\tif (!tracker) {\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\t\tconst trackedRanges = tracker.getTrackedRanges(reader);\n\t\t\t\t\tconst data = state.getTelemetryData(trackedRanges);\n\t\t\t\t\tif (data.totalModifiedCharactersInFinalState === 0) {\n\t\t\t\t\t\tcontinue; // Don't include unmodified documents in tooltip\n\t\t\t\t\t}\n\n\t\t\t\t\teditSources.push(...trackedRanges.map(r => r.source));\n\n\t\t\t\t\t// Filter out unmodified properties as these are not interesting to see in the hover\n\t\t\t\t\tconst filteredData = Object.fromEntries(\n\t\t\t\t\t\tObject.entries(data).filter(([_, value]) => !(typeof value === 'number') || value !== 0)\n\t\t\t\t\t);\n\n\t\t\t\t\tdocsDataInTooltip.push([\n\t\t\t\t\t\t`### ${doc.uri.fsPath}`,\n\t\t\t\t\t\t'```json',\n\t\t\t\t\t\tJSON.stringify(filteredData, undefined, '\\t'),\n\t\t\t\t\t\t'```',\n\t\t\t\t\t\t'\\n'\n\t\t\t\t\t].join('\\n'));\n\t\t\t\t}\n\n\t\t\t\tlet tooltipContent: string;\n\t\t\t\tif (docsDataInTooltip.length === 0) {\n\t\t\t\t\ttooltipContent = 'No modified documents';\n\t\t\t\t} else if (docsDataInTooltip.length <= 3) {\n\t\t\t\t\ttooltipContent = docsDataInTooltip.join('\\n\\n');\n\t\t\t\t} else {\n\t\t\t\t\tconst lastThree = docsDataInTooltip.slice(-3);\n\t\t\t\t\ttooltipContent = '...\\n\\n' + lastThree.join('\\n\\n');\n\t\t\t\t}\n\n\t\t\t\tconst agenda = this._createEditSourceAgenda(editSources);\n\n\t\t\t\tconst tooltipWithCommand = new MarkdownString(tooltipContent + '\\n\\n[View Details](command:' + this._showStateInMarkdownDoc + ')');\n\t\t\t\ttooltipWithCommand.appendMarkdown('\\n\\n' + agenda + '\\n\\nToggle decorations: [Click here](command:' + this._toggleDecorations + ')');\n\t\t\t\ttooltipWithCommand.isTrusted = { enabledCommands: [this._toggleDecorations] };\n\t\t\t\ttooltipWithCommand.supportHtml = true;\n\n\t\t\t\treturn tooltipWithCommand;\n\t\t\t});\n\n\t\t\treader.store.add(autorun(reader => {\n\t\t\t\tstatusBarItem.update({\n\t\t\t\t\tname: 'editTelemetry',\n\t\t\t\t\ttext: `$(edit) ${sumChangedCharacters.read(reader)} chars inserted`,\n\t\t\t\t\tariaLabel: `Edit Source Tracking: ${sumChangedCharacters.read(reader)} modified characters`,\n\t\t\t\t\ttooltip: tooltipMarkdownString.read(reader),\n\t\t\t\t\tcommand: this._showStateInMarkdownDoc,\n\t\t\t\t});\n\t\t\t}));\n\n\t\t\treader.store.add(CommandsRegistry.registerCommand(this._toggleDecorations, () => {\n\t\t\t\tthis._editSourceTrackingShowDecorations.set(!this._editSourceTrackingShowDecorations.read(undefined), undefined);\n\t\t\t}));\n\t\t}));\n\t}\n\n\tprivate _createEditSourceAgenda(editSources: EditSource[]): string {\n\t\t// Collect all edit sources from the tracked documents\n\t\tconst editSourcesSeen = new Set<string>();\n\t\tconst editSourceInfo = [];\n\t\tfor (const editSource of editSources) {\n\t\t\tif (!editSourcesSeen.has(editSource.toString())) {\n\t\t\t\teditSourcesSeen.add(editSource.toString());\n\t\t\t\teditSourceInfo.push({ name: editSource.toString(), color: editSource.getColor() });\n\t\t\t}\n\t\t}\n\n\t\tconst agendaItems = editSourceInfo.map(info =>\n\t\t\t`<span style=\"background-color:${info.color};border-radius:3px;\">${info.name}</span>`\n\t\t);\n\n\t\treturn agendaItems.join(' ');\n\t}\n}\n\nfunction makeSettable<T>(obs: IObservable<T>): ISettableObservable<T> {\n\tconst overrideObs = observableValue<T | undefined>('overrideObs', undefined);\n\treturn derivedWithSetter(overrideObs, (reader) => {\n\t\treturn overrideObs.read(reader) ?? obs.read(reader);\n\t}, (value, tx) => {\n\t\toverrideObs.set(value, tx);\n\t});\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\n\nimport { CachedFunction } from '../../../../../base/common/cache.js';\nimport { MarkdownString } from '../../../../../base/common/htmlContent.js';\nimport { Disposable } from '../../../../../base/common/lifecycle.js';\nimport { autorun, mapObservableArrayCached, derived, IObservable, ISettableObservable, observableValue, derivedWithSetter, observableFromEvent } from '../../../../../base/common/observable.js';\nimport { DynamicCssRules } from '../../../../../editor/browser/editorDom.js';\nimport { observableCodeEditor } from '../../../../../editor/browser/observableCodeEditor.js';\nimport { CodeEditorWidget } from '../../../../../editor/browser/widget/codeEditor/codeEditorWidget.js';\nimport { IModelDeltaDecoration } from '../../../../../editor/common/model.js';\nimport { CommandsRegistry } from '../../../../../platform/commands/common/commands.js';\nimport { IConfigurationService } from '../../../../../platform/configuration/common/configuration.js';\nimport { IInstantiationService } from '../../../../../platform/instantiation/common/instantiation.js';\nimport { ServiceCollection } from '../../../../../platform/instantiation/common/serviceCollection.js';\nimport { observableConfigValue } from '../../../../../platform/observable/common/platformObservableUtils.js';\nimport { ITelemetryService } from '../../../../../platform/telemetry/common/telemetry.js';\nimport { IEditorService } from '../../../../services/editor/common/editorService.js';\nimport { IStatusbarService, StatusbarAlignment } from '../../../../services/statusbar/browser/statusbar.js';\nimport { EditSource } from '../helpers/documentWithAnnotatedEdits.js';\nimport { EditSourceTrackingImpl } from './editSourceTrackingImpl.js';\nimport { IAnnotatedDocuments } from '../helpers/annotatedDocuments.js';\nimport { DataChannelForwardingTelemetryService } from '../../../../../platform/dataChannel/browser/forwardingTelemetryService.js';\nimport { EDIT_TELEMETRY_DETAILS_SETTING_ID, EDIT_TELEMETRY_SHOW_DECORATIONS, EDIT_TELEMETRY_SHOW_STATUS_BAR } from '../settings.js';\nimport { VSCodeWorkspace } from '../helpers/vscodeObservableWorkspace.js';\nimport { IExtensionService } from '../../../../services/extensions/common/extensions.js';\n\nexport class EditTrackingFeature extends Disposable {\n\n\tprivate readonly _editSourceTrackingShowDecorations;\n\tprivate readonly _editSourceTrackingShowStatusBar;\n\tprivate readonly _showStateInMarkdownDoc = 'editTelemetry.showDebugDetails';\n\tprivate readonly _toggleDecorations = 'editTelemetry.toggleDebugDecorations';\n\n\tconstructor(\n\t\tprivate readonly _workspace: VSCodeWorkspace,\n\t\tprivate readonly _annotatedDocuments: IAnnotatedDocuments,\n\t\t@IConfigurationService private readonly _configurationService: IConfigurationService,\n\t\t@IInstantiationService private readonly _instantiationService: IInstantiationService,\n\t\t@IStatusbarService private readonly _statusbarService: IStatusbarService,\n\n\t\t@IEditorService private readonly _editorService: IEditorService,\n\t\t@IExtensionService private readonly _extensionService: IExtensionService,\n\t) {\n\t\tsuper();\n\n\t\tthis._editSourceTrackingShowDecorations = makeSettable(observableConfigValue(EDIT_TELEMETRY_SHOW_DECORATIONS, false, this._configurationService));\n\t\tthis._editSourceTrackingShowStatusBar = observableConfigValue(EDIT_TELEMETRY_SHOW_STATUS_BAR, false, this._configurationService);\n\t\tconst editSourceDetailsEnabled = observableConfigValue(EDIT_TELEMETRY_DETAILS_SETTING_ID, false, this._configurationService);\n\n\t\tconst extensions = observableFromEvent(this._extensionService.onDidChangeExtensions, () => {\n\t\t\treturn this._extensionService.extensions;\n\t\t});\n\t\tconst extensionIds = derived(reader => new Set(extensions.read(reader).map(e => e.id?.toLowerCase())));\n\t\tfunction getExtensionInfoObs(extensionId: string, extensionService: IExtensionService) {\n\t\t\tconst extIdLowerCase = extensionId.toLowerCase();\n\t\t\treturn derived(reader => extensionIds.read(reader).has(extIdLowerCase));\n\t\t}\n\n\t\tconst copilotInstalled = getExtensionInfoObs('GitHub.copilot', this._extensionService);\n\t\tconst copilotChatInstalled = getExtensionInfoObs('GitHub.copilot-chat', this._extensionService);\n\n\t\tconst shouldSendDetails = derived(reader => editSourceDetailsEnabled.read(reader) || !!copilotInstalled.read(reader) || !!copilotChatInstalled.read(reader));\n\n\t\tconst instantiationServiceWithInterceptedTelemetry = this._instantiationService.createChild(new ServiceCollection(\n\t\t\t[ITelemetryService, this._instantiationService.createInstance(DataChannelForwardingTelemetryService)]\n\t\t));\n\t\tconst impl = this._register(instantiationServiceWithInterceptedTelemetry.createInstance(EditSourceTrackingImpl, shouldSendDetails, this._annotatedDocuments));\n\n\t\tthis._register(autorun((reader) => {\n\t\t\tif (!this._editSourceTrackingShowDecorations.read(reader)) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst visibleEditors = observableFromEvent(this, this._editorService.onDidVisibleEditorsChange, () => this._editorService.visibleTextEditorControls);\n\n\t\t\tmapObservableArrayCached(this, visibleEditors, (editor, store) => {\n\t\t\t\tif (editor instanceof CodeEditorWidget) {\n\t\t\t\t\tconst obsEditor = observableCodeEditor(editor);\n\n\t\t\t\t\tconst cssStyles = new DynamicCssRules(editor);\n\t\t\t\t\tconst decorations = new CachedFunction((source: EditSource) => {\n\t\t\t\t\t\tconst r = store.add(cssStyles.createClassNameRef({\n\t\t\t\t\t\t\tbackgroundColor: source.getColor(),\n\t\t\t\t\t\t}));\n\t\t\t\t\t\treturn r.className;\n\t\t\t\t\t});\n\n\t\t\t\t\tstore.add(obsEditor.setDecorations(derived(reader => {\n\t\t\t\t\t\tconst uri = obsEditor.model.read(reader)?.uri;\n\t\t\t\t\t\tif (!uri) { return []; }\n\t\t\t\t\t\tconst doc = this._workspace.getDocument(uri);\n\t\t\t\t\t\tif (!doc) { return []; }\n\t\t\t\t\t\tconst docsState = impl.docsState.read(reader).get(doc);\n\t\t\t\t\t\tif (!docsState) { return []; }\n\n\t\t\t\t\t\tconst ranges = (docsState.longtermTracker.read(reader)?.getTrackedRanges(reader)) ?? [];\n\n\t\t\t\t\t\treturn ranges.map<IModelDeltaDecoration>(r => ({\n\t\t\t\t\t\t\trange: doc.value.read(undefined).getTransformer().getRange(r.range),\n\t\t\t\t\t\t\toptions: {\n\t\t\t\t\t\t\t\tdescription: 'editSourceTracking',\n\t\t\t\t\t\t\t\tinlineClassName: decorations.get(r.source),\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}));\n\t\t\t\t\t})));\n\t\t\t\t}\n\t\t\t}).recomputeInitiallyAndOnChange(reader.store);\n\t\t}));\n\n\t\tthis._register(autorun(reader => {\n\t\t\tif (!this._editSourceTrackingShowStatusBar.read(reader)) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst statusBarItem = reader.store.add(this._statusbarService.addEntry(\n\t\t\t\t{\n\t\t\t\t\tname: '',\n\t\t\t\t\ttext: '',\n\t\t\t\t\tcommand: this._showStateInMarkdownDoc,\n\t\t\t\t\ttooltip: 'Edit Source Tracking',\n\t\t\t\t\tariaLabel: '',\n\t\t\t\t},\n\t\t\t\t'editTelemetry',\n\t\t\t\tStatusbarAlignment.RIGHT,\n\t\t\t\t100\n\t\t\t));\n\n\t\t\tconst sumChangedCharacters = derived(reader => {\n\t\t\t\tconst docs = impl.docsState.read(reader);\n\t\t\t\tlet sum = 0;\n\t\t\t\tfor (const state of docs.values()) {\n\t\t\t\t\tconst t = state.longtermTracker.read(reader);\n\t\t\t\t\tif (!t) { continue; }\n\t\t\t\t\tconst d = state.getTelemetryData(t.getTrackedRanges(reader));\n\t\t\t\t\tsum += d.totalModifiedCharactersInFinalState;\n\t\t\t\t}\n\t\t\t\treturn sum;\n\t\t\t});\n\n\t\t\tconst tooltipMarkdownString = derived(reader => {\n\t\t\t\tconst docs = impl.docsState.read(reader);\n\t\t\t\tconst docsDataInTooltip: string[] = [];\n\t\t\t\tconst editSources: EditSource[] = [];\n\t\t\t\tfor (const [doc, state] of docs) {\n\t\t\t\t\tconst tracker = state.longtermTracker.read(reader);\n\t\t\t\t\tif (!tracker) {\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\t\tconst trackedRanges = tracker.getTrackedRanges(reader);\n\t\t\t\t\tconst data = state.getTelemetryData(trackedRanges);\n\t\t\t\t\tif (data.totalModifiedCharactersInFinalState === 0) {\n\t\t\t\t\t\tcontinue; // Don't include unmodified documents in tooltip\n\t\t\t\t\t}\n\n\t\t\t\t\teditSources.push(...trackedRanges.map(r => r.source));\n\n\t\t\t\t\t// Filter out unmodified properties as these are not interesting to see in the hover\n\t\t\t\t\tconst filteredData = Object.fromEntries(\n\t\t\t\t\t\tObject.entries(data).filter(([_, value]) => !(typeof value === 'number') || value !== 0)\n\t\t\t\t\t);\n\n\t\t\t\t\tdocsDataInTooltip.push([\n\t\t\t\t\t\t`### ${doc.uri.fsPath}`,\n\t\t\t\t\t\t'```json',\n\t\t\t\t\t\tJSON.stringify(filteredData, undefined, '\\t'),\n\t\t\t\t\t\t'```',\n\t\t\t\t\t\t'\\n'\n\t\t\t\t\t].join('\\n'));\n\t\t\t\t}\n\n\t\t\t\tlet tooltipContent: string;\n\t\t\t\tif (docsDataInTooltip.length === 0) {\n\t\t\t\t\ttooltipContent = 'No modified documents';\n\t\t\t\t} else if (docsDataInTooltip.length <= 3) {\n\t\t\t\t\ttooltipContent = docsDataInTooltip.join('\\n\\n');\n\t\t\t\t} else {\n\t\t\t\t\tconst lastThree = docsDataInTooltip.slice(-3);\n\t\t\t\t\ttooltipContent = '...\\n\\n' + lastThree.join('\\n\\n');\n\t\t\t\t}\n\n\t\t\t\tconst agenda = this._createEditSourceAgenda(editSources);\n\n\t\t\t\tconst tooltipWithCommand = new MarkdownString(tooltipContent + '\\n\\n[View Details](command:' + this._showStateInMarkdownDoc + ')');\n\t\t\t\ttooltipWithCommand.appendMarkdown('\\n\\n' + agenda + '\\n\\nToggle decorations: [Click here](command:' + this._toggleDecorations + ')');\n\t\t\t\ttooltipWithCommand.isTrusted = { enabledCommands: [this._toggleDecorations] };\n\t\t\t\ttooltipWithCommand.supportHtml = true;\n\n\t\t\t\treturn tooltipWithCommand;\n\t\t\t});\n\n\t\t\treader.store.add(autorun(reader => {\n\t\t\t\tstatusBarItem.update({\n\t\t\t\t\tname: 'editTelemetry',\n\t\t\t\t\ttext: `$(edit) ${sumChangedCharacters.read(reader)} chars inserted`,\n\t\t\t\t\tariaLabel: `Edit Source Tracking: ${sumChangedCharacters.read(reader)} modified characters`,\n\t\t\t\t\ttooltip: tooltipMarkdownString.read(reader),\n\t\t\t\t\tcommand: this._showStateInMarkdownDoc,\n\t\t\t\t});\n\t\t\t}));\n\n\t\t\treader.store.add(CommandsRegistry.registerCommand(this._toggleDecorations, () => {\n\t\t\t\tthis._editSourceTrackingShowDecorations.set(!this._editSourceTrackingShowDecorations.read(undefined), undefined);\n\t\t\t}));\n\t\t}));\n\t}\n\n\tprivate _createEditSourceAgenda(editSources: EditSource[]): string {\n\t\t// Collect all edit sources from the tracked documents\n\t\tconst editSourcesSeen = new Set<string>();\n\t\tconst editSourceInfo = [];\n\t\tfor (const editSource of editSources) {\n\t\t\tif (!editSourcesSeen.has(editSource.toString())) {\n\t\t\t\teditSourcesSeen.add(editSource.toString());\n\t\t\t\teditSourceInfo.push({ name: editSource.toString(), color: editSource.getColor() });\n\t\t\t}\n\t\t}\n\n\t\tconst agendaItems = editSourceInfo.map(info =>\n\t\t\t`<span style=\"background-color:${info.color};border-radius:3px;\">${info.name}</span>`\n\t\t);\n\n\t\treturn agendaItems.join(' ');\n\t}\n}\n\nfunction makeSettable<T>(obs: IObservable<T>): ISettableObservable<T> {\n\tconst overrideObs = observableValue<T | undefined>('overrideObs', undefined);\n\treturn derivedWithSetter(overrideObs, (reader) => {\n\t\treturn overrideObs.read(reader) ?? obs.read(reader);\n\t}, (value, tx) => {\n\t\toverrideObs.set(value, tx);\n\t});\n}\n"]}