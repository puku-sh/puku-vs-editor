{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/contrib/editTelemetry/browser/telemetry/arcTelemetrySender.ts","vs/workbench/contrib/editTelemetry/browser/telemetry/arcTelemetrySender.ts"],"names":[],"mappings":"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","file":"arcTelemetrySender.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { onUnexpectedError } from '../../../../../base/common/errors.js';\nimport { Disposable } from '../../../../../base/common/lifecycle.js';\nimport { IObservable, runOnChange } from '../../../../../base/common/observable.js';\nimport { AnnotatedStringEdit } from '../../../../../editor/common/core/edits/stringEdit.js';\nimport { EditDeltaInfo, EditSuggestionId, ITextModelEditSourceMetadata } from '../../../../../editor/common/textModelEditSource.js';\nimport { IInstantiationService } from '../../../../../platform/instantiation/common/instantiation.js';\nimport { EditSourceData, IDocumentWithAnnotatedEdits, createDocWithJustReason } from '../helpers/documentWithAnnotatedEdits.js';\nimport { IAiEditTelemetryService } from './aiEditTelemetry/aiEditTelemetryService.js';\nimport type { ScmRepoAdapter } from './scmAdapter.js';\nimport { forwardToChannelIf, isCopilotLikeExtension } from '../../../../../platform/dataChannel/browser/forwardingTelemetryService.js';\nimport { ProviderId } from '../../../../../editor/common/languages.js';\nimport { ArcTelemetryReporter } from './arcTelemetryReporter.js';\nimport { IRandomService } from '../randomService.js';\n\nexport class EditTelemetryReportInlineEditArcSender extends Disposable {\n\tconstructor(\n\t\tdocWithAnnotatedEdits: IDocumentWithAnnotatedEdits<EditSourceData>,\n\t\tscmRepoBridge: IObservable<ScmRepoAdapter | undefined>,\n\t\t@IInstantiationService private readonly _instantiationService: IInstantiationService\n\t) {\n\t\tsuper();\n\n\t\tthis._register(runOnChange(docWithAnnotatedEdits.value, (_val, _prev, changes) => {\n\t\t\tconst edit = AnnotatedStringEdit.compose(changes.map(c => c.edit));\n\n\t\t\tif (!edit.replacements.some(r => r.data.editSource.metadata.source === 'inlineCompletionAccept')) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (!edit.replacements.every(r => r.data.editSource.metadata.source === 'inlineCompletionAccept')) {\n\t\t\t\tonUnexpectedError(new Error('ArcTelemetrySender: Not all edits are inline completion accept edits!'));\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (edit.replacements[0].data.editSource.metadata.source !== 'inlineCompletionAccept') {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst data = edit.replacements[0].data.editSource.metadata;\n\n\t\t\tconst docWithJustReason = createDocWithJustReason(docWithAnnotatedEdits, this._store);\n\t\t\tconst reporter = this._store.add(this._instantiationService.createInstance(ArcTelemetryReporter, [0, 30, 120, 300, 600, 900].map(s => s * 1000), _prev, docWithJustReason, scmRepoBridge, edit, res => {\n\t\t\t\tres.telemetryService.publicLog2<{\n\t\t\t\t\textensionId: string;\n\t\t\t\t\textensionVersion: string;\n\t\t\t\t\topportunityId: string;\n\t\t\t\t\tlanguageId: string;\n\t\t\t\t\tdidBranchChange: number;\n\t\t\t\t\ttimeDelayMs: number;\n\n\t\t\t\t\toriginalCharCount: number;\n\t\t\t\t\toriginalLineCount: number;\n\t\t\t\t\toriginalDeletedLineCount: number;\n\t\t\t\t\tarc: number;\n\t\t\t\t\tcurrentLineCount: number;\n\t\t\t\t\tcurrentDeletedLineCount: number;\n\t\t\t\t}, {\n\t\t\t\t\towner: 'hediet';\n\t\t\t\t\tcomment: 'Reports for each accepted inline suggestion (= inline completions + next edit suggestions) the accumulated retained character count after a certain time delay. This event is sent 0s, 30s, 120s, 300s, 600s and 900s after acceptance. @sentToGitHub';\n\n\t\t\t\t\textensionId: { classification: 'SystemMetaData'; purpose: 'FeatureInsight'; comment: 'The extension id which provided this inline suggestion.' };\n\t\t\t\t\textensionVersion: { classification: 'SystemMetaData'; purpose: 'FeatureInsight'; comment: 'The version of the extension.' };\n\t\t\t\t\topportunityId: { classification: 'SystemMetaData'; purpose: 'FeatureInsight'; comment: 'Unique identifier for an opportunity to show an inline suggestion.' };\n\t\t\t\t\tlanguageId: { classification: 'SystemMetaData'; purpose: 'FeatureInsight'; comment: 'The language id of the document.' };\n\n\t\t\t\t\tdidBranchChange: { classification: 'SystemMetaData'; purpose: 'FeatureInsight'; isMeasurement: true; comment: 'Indicates if the branch changed in the meantime. If the branch changed (value is 1); this event should probably be ignored.' };\n\t\t\t\t\ttimeDelayMs: { classification: 'SystemMetaData'; purpose: 'FeatureInsight'; isMeasurement: true; comment: 'The time delay between the user accepting the edit and measuring the survival rate.' };\n\n\t\t\t\t\toriginalCharCount: { classification: 'SystemMetaData'; purpose: 'FeatureInsight'; isMeasurement: true; comment: 'The original character count before any edits.' };\n\t\t\t\t\toriginalLineCount: { classification: 'SystemMetaData'; purpose: 'FeatureInsight'; isMeasurement: true; comment: 'The original line count before any edits.' };\n\t\t\t\t\toriginalDeletedLineCount: { classification: 'SystemMetaData'; purpose: 'FeatureInsight'; isMeasurement: true; comment: 'The original deleted line count before any edits.' };\n\t\t\t\t\tarc: { classification: 'SystemMetaData'; purpose: 'FeatureInsight'; isMeasurement: true; comment: 'The accepted and retained character count.' };\n\t\t\t\t\tcurrentLineCount: { classification: 'SystemMetaData'; purpose: 'FeatureInsight'; isMeasurement: true; comment: 'The current line count after edits.' };\n\t\t\t\t\tcurrentDeletedLineCount: { classification: 'SystemMetaData'; purpose: 'FeatureInsight'; isMeasurement: true; comment: 'The current deleted line count after edits.' };\n\t\t\t\t}>('editTelemetry.reportInlineEditArc', {\n\t\t\t\t\textensionId: data.$extensionId ?? '',\n\t\t\t\t\textensionVersion: data.$extensionVersion ?? '',\n\t\t\t\t\topportunityId: data.$$requestUuid ?? 'unknown',\n\t\t\t\t\tlanguageId: data.$$languageId,\n\t\t\t\t\tdidBranchChange: res.didBranchChange ? 1 : 0,\n\t\t\t\t\ttimeDelayMs: res.timeDelayMs,\n\n\t\t\t\t\toriginalCharCount: res.originalCharCount,\n\t\t\t\t\toriginalLineCount: res.originalLineCount,\n\t\t\t\t\toriginalDeletedLineCount: res.originalDeletedLineCount,\n\t\t\t\t\tarc: res.arc,\n\t\t\t\t\tcurrentLineCount: res.currentLineCount,\n\t\t\t\t\tcurrentDeletedLineCount: res.currentDeletedLineCount,\n\n\t\t\t\t\t...forwardToChannelIf(isCopilotLikeExtension(data.$extensionId)),\n\t\t\t\t});\n\t\t\t}, () => {\n\t\t\t\tthis._store.deleteAndLeak(reporter);\n\t\t\t}));\n\t\t}));\n\t}\n}\n\nexport class CreateSuggestionIdForChatOrInlineChatCaller extends Disposable {\n\tconstructor(\n\t\tdocWithAnnotatedEdits: IDocumentWithAnnotatedEdits<EditSourceData>,\n\t\t@IAiEditTelemetryService private readonly _aiEditTelemetryService: IAiEditTelemetryService,\n\t) {\n\t\tsuper();\n\n\t\tthis._register(runOnChange(docWithAnnotatedEdits.value, (_val, _prev, changes) => {\n\t\t\tconst edit = AnnotatedStringEdit.compose(changes.map(c => c.edit));\n\n\t\t\tconst supportedSource = new Set(['Chat.applyEdits', 'inlineChat.applyEdits'] as ITextModelEditSourceMetadata['source'][]);\n\n\t\t\tif (!edit.replacements.some(r => supportedSource.has(r.data.editSource.metadata.source))) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (!edit.replacements.every(r => supportedSource.has(r.data.editSource.metadata.source))) {\n\t\t\t\tonUnexpectedError(new Error(`ArcTelemetrySender: Not all edits are ${edit.replacements[0].data.editSource.metadata.source}!`));\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tlet applyCodeBlockSuggestionId: EditSuggestionId | undefined = undefined;\n\t\t\tconst data = edit.replacements[0].data.editSource;\n\t\t\tlet feature: 'inlineChat' | 'sideBarChat';\n\t\t\tif (data.metadata.source === 'Chat.applyEdits') {\n\t\t\t\tfeature = 'sideBarChat';\n\t\t\t\tif (data.metadata.$$mode === 'applyCodeBlock') {\n\t\t\t\t\tapplyCodeBlockSuggestionId = data.metadata.$$codeBlockSuggestionId;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tfeature = 'inlineChat';\n\t\t\t}\n\n\t\t\tconst providerId = new ProviderId(data.props.$extensionId, data.props.$extensionVersion, data.props.$providerId);\n\n\t\t\t// TODO@hediet tie this suggestion id to hunks, so acceptance can be correlated.\n\t\t\tthis._aiEditTelemetryService.createSuggestionId({\n\t\t\t\tapplyCodeBlockSuggestionId,\n\t\t\t\tlanguageId: data.props.$$languageId,\n\t\t\t\tpresentation: 'highlightedEdit',\n\t\t\t\tfeature,\n\t\t\t\tsource: providerId,\n\t\t\t\tmodelId: data.props.$modelId,\n\t\t\t\t// eslint-disable-next-line local/code-no-any-casts\n\t\t\t\tmodeId: data.props.$$mode as any,\n\t\t\t\teditDeltaInfo: EditDeltaInfo.fromEdit(edit, _prev),\n\t\t\t});\n\t\t}));\n\t}\n}\n\nexport class EditTelemetryReportEditArcForChatOrInlineChatSender extends Disposable {\n\tconstructor(\n\t\tdocWithAnnotatedEdits: IDocumentWithAnnotatedEdits<EditSourceData>,\n\t\tscmRepoBridge: IObservable<ScmRepoAdapter | undefined>,\n\t\t@IInstantiationService private readonly _instantiationService: IInstantiationService,\n\t\t@IRandomService private readonly _randomService: IRandomService,\n\t) {\n\t\tsuper();\n\n\t\tthis._register(runOnChange(docWithAnnotatedEdits.value, (_val, _prev, changes) => {\n\t\t\tconst edit = AnnotatedStringEdit.compose(changes.map(c => c.edit));\n\n\t\t\tconst supportedSource = new Set(['Chat.applyEdits', 'inlineChat.applyEdits'] as ITextModelEditSourceMetadata['source'][]);\n\n\t\t\tif (!edit.replacements.some(r => supportedSource.has(r.data.editSource.metadata.source))) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (!edit.replacements.every(r => supportedSource.has(r.data.editSource.metadata.source))) {\n\t\t\t\tonUnexpectedError(new Error(`ArcTelemetrySender: Not all edits are ${edit.replacements[0].data.editSource.metadata.source}!`));\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst data = edit.replacements[0].data.editSource;\n\n\t\t\tconst uniqueEditId = this._randomService.generateUuid();\n\n\t\t\tconst docWithJustReason = createDocWithJustReason(docWithAnnotatedEdits, this._store);\n\t\t\tconst reporter = this._store.add(this._instantiationService.createInstance(ArcTelemetryReporter, [0, 60, 300].map(s => s * 1000), _prev, docWithJustReason, scmRepoBridge, edit, res => {\n\t\t\t\tres.telemetryService.publicLog2<{\n\t\t\t\t\tsourceKeyCleaned: string;\n\t\t\t\t\textensionId: string | undefined;\n\t\t\t\t\textensionVersion: string | undefined;\n\t\t\t\t\topportunityId: string | undefined;\n\t\t\t\t\teditSessionId: string | undefined;\n\t\t\t\t\trequestId: string | undefined;\n\t\t\t\t\tmodelId: string | undefined;\n\t\t\t\t\tlanguageId: string | undefined;\n\t\t\t\t\tmode: string | undefined;\n\t\t\t\t\tuniqueEditId: string | undefined;\n\n\t\t\t\t\tdidBranchChange: number;\n\t\t\t\t\ttimeDelayMs: number;\n\n\t\t\t\t\toriginalCharCount: number;\n\t\t\t\t\toriginalLineCount: number;\n\t\t\t\t\toriginalDeletedLineCount: number;\n\t\t\t\t\tarc: number;\n\t\t\t\t\tcurrentLineCount: number;\n\t\t\t\t\tcurrentDeletedLineCount: number;\n\t\t\t\t}, {\n\t\t\t\t\towner: 'hediet';\n\t\t\t\t\tcomment: 'Reports the accepted and retained character count for an inline completion/edit. @sentToGitHub';\n\n\t\t\t\t\tsourceKeyCleaned: { classification: 'SystemMetaData'; purpose: 'FeatureInsight'; comment: 'The key of the edit source.' };\n\t\t\t\t\textensionId: { classification: 'SystemMetaData'; purpose: 'FeatureInsight'; comment: 'The extension id (copilot or copilot-chat); which provided this inline completion.' };\n\t\t\t\t\textensionVersion: { classification: 'SystemMetaData'; purpose: 'FeatureInsight'; comment: 'The version of the extension.' };\n\t\t\t\t\topportunityId: { classification: 'SystemMetaData'; purpose: 'FeatureInsight'; comment: 'Unique identifier for an opportunity to show an inline completion or NES.' };\n\t\t\t\t\teditSessionId: { classification: 'SystemMetaData'; purpose: 'FeatureInsight'; comment: 'The session id.' };\n\t\t\t\t\trequestId: { classification: 'SystemMetaData'; purpose: 'FeatureInsight'; comment: 'The request id.' };\n\t\t\t\t\tmodelId: { classification: 'SystemMetaData'; purpose: 'FeatureInsight'; comment: 'The model id.' };\n\t\t\t\t\tlanguageId: { classification: 'SystemMetaData'; purpose: 'FeatureInsight'; comment: 'The language id of the document.' };\n\t\t\t\t\tmode: { classification: 'SystemMetaData'; purpose: 'FeatureInsight'; comment: 'The mode chat was in.' };\n\t\t\t\t\tuniqueEditId: { classification: 'SystemMetaData'; purpose: 'FeatureInsight'; comment: 'The unique identifier for the edit.' };\n\n\t\t\t\t\tdidBranchChange: { classification: 'SystemMetaData'; purpose: 'FeatureInsight'; isMeasurement: true; comment: 'Indicates if the branch changed in the meantime. If the branch changed (value is 1); this event should probably be ignored.' };\n\t\t\t\t\ttimeDelayMs: { classification: 'SystemMetaData'; purpose: 'FeatureInsight'; isMeasurement: true; comment: 'The time delay between the user accepting the edit and measuring the survival rate.' };\n\n\t\t\t\t\toriginalCharCount: { classification: 'SystemMetaData'; purpose: 'FeatureInsight'; isMeasurement: true; comment: 'The original character count before any edits.' };\n\t\t\t\t\toriginalLineCount: { classification: 'SystemMetaData'; purpose: 'FeatureInsight'; isMeasurement: true; comment: 'The original line count before any edits.' };\n\t\t\t\t\toriginalDeletedLineCount: { classification: 'SystemMetaData'; purpose: 'FeatureInsight'; isMeasurement: true; comment: 'The original deleted line count before any edits.' };\n\t\t\t\t\tarc: { classification: 'SystemMetaData'; purpose: 'FeatureInsight'; isMeasurement: true; comment: 'The accepted and restrained character count.' };\n\t\t\t\t\tcurrentLineCount: { classification: 'SystemMetaData'; purpose: 'FeatureInsight'; isMeasurement: true; comment: 'The current line count after edits.' };\n\t\t\t\t\tcurrentDeletedLineCount: { classification: 'SystemMetaData'; purpose: 'FeatureInsight'; isMeasurement: true; comment: 'The current deleted line count after edits.' };\n\t\t\t\t}>('editTelemetry.reportEditArc', {\n\t\t\t\t\tsourceKeyCleaned: data.toKey(Number.MAX_SAFE_INTEGER, {\n\t\t\t\t\t\t$extensionId: false,\n\t\t\t\t\t\t$extensionVersion: false,\n\t\t\t\t\t\t$$requestUuid: false,\n\t\t\t\t\t\t$$sessionId: false,\n\t\t\t\t\t\t$$requestId: false,\n\t\t\t\t\t\t$$languageId: false,\n\t\t\t\t\t\t$modelId: false,\n\t\t\t\t\t}),\n\t\t\t\t\textensionId: data.props.$extensionId,\n\t\t\t\t\textensionVersion: data.props.$extensionVersion,\n\t\t\t\t\topportunityId: data.props.$$requestUuid,\n\t\t\t\t\teditSessionId: data.props.$$sessionId,\n\t\t\t\t\trequestId: data.props.$$requestId,\n\t\t\t\t\tmodelId: data.props.$modelId,\n\t\t\t\t\tlanguageId: data.props.$$languageId,\n\t\t\t\t\tmode: data.props.$$mode,\n\t\t\t\t\tuniqueEditId,\n\n\t\t\t\t\tdidBranchChange: res.didBranchChange ? 1 : 0,\n\t\t\t\t\ttimeDelayMs: res.timeDelayMs,\n\n\t\t\t\t\toriginalCharCount: res.originalCharCount,\n\t\t\t\t\toriginalLineCount: res.originalLineCount,\n\t\t\t\t\toriginalDeletedLineCount: res.originalDeletedLineCount,\n\t\t\t\t\tarc: res.arc,\n\t\t\t\t\tcurrentLineCount: res.currentLineCount,\n\t\t\t\t\tcurrentDeletedLineCount: res.currentDeletedLineCount,\n\n\t\t\t\t\t...forwardToChannelIf(isCopilotLikeExtension(data.props.$extensionId)),\n\t\t\t\t});\n\t\t\t}, () => {\n\t\t\t\tthis._store.deleteAndLeak(reporter);\n\t\t\t}));\n\t\t}));\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { onUnexpectedError } from '../../../../../base/common/errors.js';\nimport { Disposable } from '../../../../../base/common/lifecycle.js';\nimport { IObservable, runOnChange } from '../../../../../base/common/observable.js';\nimport { AnnotatedStringEdit } from '../../../../../editor/common/core/edits/stringEdit.js';\nimport { EditDeltaInfo, EditSuggestionId, ITextModelEditSourceMetadata } from '../../../../../editor/common/textModelEditSource.js';\nimport { IInstantiationService } from '../../../../../platform/instantiation/common/instantiation.js';\nimport { EditSourceData, IDocumentWithAnnotatedEdits, createDocWithJustReason } from '../helpers/documentWithAnnotatedEdits.js';\nimport { IAiEditTelemetryService } from './aiEditTelemetry/aiEditTelemetryService.js';\nimport type { ScmRepoAdapter } from './scmAdapter.js';\nimport { forwardToChannelIf, isCopilotLikeExtension } from '../../../../../platform/dataChannel/browser/forwardingTelemetryService.js';\nimport { ProviderId } from '../../../../../editor/common/languages.js';\nimport { ArcTelemetryReporter } from './arcTelemetryReporter.js';\nimport { IRandomService } from '../randomService.js';\n\nexport class EditTelemetryReportInlineEditArcSender extends Disposable {\n\tconstructor(\n\t\tdocWithAnnotatedEdits: IDocumentWithAnnotatedEdits<EditSourceData>,\n\t\tscmRepoBridge: IObservable<ScmRepoAdapter | undefined>,\n\t\t@IInstantiationService private readonly _instantiationService: IInstantiationService\n\t) {\n\t\tsuper();\n\n\t\tthis._register(runOnChange(docWithAnnotatedEdits.value, (_val, _prev, changes) => {\n\t\t\tconst edit = AnnotatedStringEdit.compose(changes.map(c => c.edit));\n\n\t\t\tif (!edit.replacements.some(r => r.data.editSource.metadata.source === 'inlineCompletionAccept')) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (!edit.replacements.every(r => r.data.editSource.metadata.source === 'inlineCompletionAccept')) {\n\t\t\t\tonUnexpectedError(new Error('ArcTelemetrySender: Not all edits are inline completion accept edits!'));\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (edit.replacements[0].data.editSource.metadata.source !== 'inlineCompletionAccept') {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst data = edit.replacements[0].data.editSource.metadata;\n\n\t\t\tconst docWithJustReason = createDocWithJustReason(docWithAnnotatedEdits, this._store);\n\t\t\tconst reporter = this._store.add(this._instantiationService.createInstance(ArcTelemetryReporter, [0, 30, 120, 300, 600, 900].map(s => s * 1000), _prev, docWithJustReason, scmRepoBridge, edit, res => {\n\t\t\t\tres.telemetryService.publicLog2<{\n\t\t\t\t\textensionId: string;\n\t\t\t\t\textensionVersion: string;\n\t\t\t\t\topportunityId: string;\n\t\t\t\t\tlanguageId: string;\n\t\t\t\t\tdidBranchChange: number;\n\t\t\t\t\ttimeDelayMs: number;\n\n\t\t\t\t\toriginalCharCount: number;\n\t\t\t\t\toriginalLineCount: number;\n\t\t\t\t\toriginalDeletedLineCount: number;\n\t\t\t\t\tarc: number;\n\t\t\t\t\tcurrentLineCount: number;\n\t\t\t\t\tcurrentDeletedLineCount: number;\n\t\t\t\t}, {\n\t\t\t\t\towner: 'hediet';\n\t\t\t\t\tcomment: 'Reports for each accepted inline suggestion (= inline completions + next edit suggestions) the accumulated retained character count after a certain time delay. This event is sent 0s, 30s, 120s, 300s, 600s and 900s after acceptance. @sentToGitHub';\n\n\t\t\t\t\textensionId: { classification: 'SystemMetaData'; purpose: 'FeatureInsight'; comment: 'The extension id which provided this inline suggestion.' };\n\t\t\t\t\textensionVersion: { classification: 'SystemMetaData'; purpose: 'FeatureInsight'; comment: 'The version of the extension.' };\n\t\t\t\t\topportunityId: { classification: 'SystemMetaData'; purpose: 'FeatureInsight'; comment: 'Unique identifier for an opportunity to show an inline suggestion.' };\n\t\t\t\t\tlanguageId: { classification: 'SystemMetaData'; purpose: 'FeatureInsight'; comment: 'The language id of the document.' };\n\n\t\t\t\t\tdidBranchChange: { classification: 'SystemMetaData'; purpose: 'FeatureInsight'; isMeasurement: true; comment: 'Indicates if the branch changed in the meantime. If the branch changed (value is 1); this event should probably be ignored.' };\n\t\t\t\t\ttimeDelayMs: { classification: 'SystemMetaData'; purpose: 'FeatureInsight'; isMeasurement: true; comment: 'The time delay between the user accepting the edit and measuring the survival rate.' };\n\n\t\t\t\t\toriginalCharCount: { classification: 'SystemMetaData'; purpose: 'FeatureInsight'; isMeasurement: true; comment: 'The original character count before any edits.' };\n\t\t\t\t\toriginalLineCount: { classification: 'SystemMetaData'; purpose: 'FeatureInsight'; isMeasurement: true; comment: 'The original line count before any edits.' };\n\t\t\t\t\toriginalDeletedLineCount: { classification: 'SystemMetaData'; purpose: 'FeatureInsight'; isMeasurement: true; comment: 'The original deleted line count before any edits.' };\n\t\t\t\t\tarc: { classification: 'SystemMetaData'; purpose: 'FeatureInsight'; isMeasurement: true; comment: 'The accepted and retained character count.' };\n\t\t\t\t\tcurrentLineCount: { classification: 'SystemMetaData'; purpose: 'FeatureInsight'; isMeasurement: true; comment: 'The current line count after edits.' };\n\t\t\t\t\tcurrentDeletedLineCount: { classification: 'SystemMetaData'; purpose: 'FeatureInsight'; isMeasurement: true; comment: 'The current deleted line count after edits.' };\n\t\t\t\t}>('editTelemetry.reportInlineEditArc', {\n\t\t\t\t\textensionId: data.$extensionId ?? '',\n\t\t\t\t\textensionVersion: data.$extensionVersion ?? '',\n\t\t\t\t\topportunityId: data.$$requestUuid ?? 'unknown',\n\t\t\t\t\tlanguageId: data.$$languageId,\n\t\t\t\t\tdidBranchChange: res.didBranchChange ? 1 : 0,\n\t\t\t\t\ttimeDelayMs: res.timeDelayMs,\n\n\t\t\t\t\toriginalCharCount: res.originalCharCount,\n\t\t\t\t\toriginalLineCount: res.originalLineCount,\n\t\t\t\t\toriginalDeletedLineCount: res.originalDeletedLineCount,\n\t\t\t\t\tarc: res.arc,\n\t\t\t\t\tcurrentLineCount: res.currentLineCount,\n\t\t\t\t\tcurrentDeletedLineCount: res.currentDeletedLineCount,\n\n\t\t\t\t\t...forwardToChannelIf(isCopilotLikeExtension(data.$extensionId)),\n\t\t\t\t});\n\t\t\t}, () => {\n\t\t\t\tthis._store.deleteAndLeak(reporter);\n\t\t\t}));\n\t\t}));\n\t}\n}\n\nexport class CreateSuggestionIdForChatOrInlineChatCaller extends Disposable {\n\tconstructor(\n\t\tdocWithAnnotatedEdits: IDocumentWithAnnotatedEdits<EditSourceData>,\n\t\t@IAiEditTelemetryService private readonly _aiEditTelemetryService: IAiEditTelemetryService,\n\t) {\n\t\tsuper();\n\n\t\tthis._register(runOnChange(docWithAnnotatedEdits.value, (_val, _prev, changes) => {\n\t\t\tconst edit = AnnotatedStringEdit.compose(changes.map(c => c.edit));\n\n\t\t\tconst supportedSource = new Set(['Chat.applyEdits', 'inlineChat.applyEdits'] as ITextModelEditSourceMetadata['source'][]);\n\n\t\t\tif (!edit.replacements.some(r => supportedSource.has(r.data.editSource.metadata.source))) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (!edit.replacements.every(r => supportedSource.has(r.data.editSource.metadata.source))) {\n\t\t\t\tonUnexpectedError(new Error(`ArcTelemetrySender: Not all edits are ${edit.replacements[0].data.editSource.metadata.source}!`));\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tlet applyCodeBlockSuggestionId: EditSuggestionId | undefined = undefined;\n\t\t\tconst data = edit.replacements[0].data.editSource;\n\t\t\tlet feature: 'inlineChat' | 'sideBarChat';\n\t\t\tif (data.metadata.source === 'Chat.applyEdits') {\n\t\t\t\tfeature = 'sideBarChat';\n\t\t\t\tif (data.metadata.$$mode === 'applyCodeBlock') {\n\t\t\t\t\tapplyCodeBlockSuggestionId = data.metadata.$$codeBlockSuggestionId;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tfeature = 'inlineChat';\n\t\t\t}\n\n\t\t\tconst providerId = new ProviderId(data.props.$extensionId, data.props.$extensionVersion, data.props.$providerId);\n\n\t\t\t// TODO@hediet tie this suggestion id to hunks, so acceptance can be correlated.\n\t\t\tthis._aiEditTelemetryService.createSuggestionId({\n\t\t\t\tapplyCodeBlockSuggestionId,\n\t\t\t\tlanguageId: data.props.$$languageId,\n\t\t\t\tpresentation: 'highlightedEdit',\n\t\t\t\tfeature,\n\t\t\t\tsource: providerId,\n\t\t\t\tmodelId: data.props.$modelId,\n\t\t\t\t// eslint-disable-next-line local/code-no-any-casts\n\t\t\t\tmodeId: data.props.$$mode as any,\n\t\t\t\teditDeltaInfo: EditDeltaInfo.fromEdit(edit, _prev),\n\t\t\t});\n\t\t}));\n\t}\n}\n\nexport class EditTelemetryReportEditArcForChatOrInlineChatSender extends Disposable {\n\tconstructor(\n\t\tdocWithAnnotatedEdits: IDocumentWithAnnotatedEdits<EditSourceData>,\n\t\tscmRepoBridge: IObservable<ScmRepoAdapter | undefined>,\n\t\t@IInstantiationService private readonly _instantiationService: IInstantiationService,\n\t\t@IRandomService private readonly _randomService: IRandomService,\n\t) {\n\t\tsuper();\n\n\t\tthis._register(runOnChange(docWithAnnotatedEdits.value, (_val, _prev, changes) => {\n\t\t\tconst edit = AnnotatedStringEdit.compose(changes.map(c => c.edit));\n\n\t\t\tconst supportedSource = new Set(['Chat.applyEdits', 'inlineChat.applyEdits'] as ITextModelEditSourceMetadata['source'][]);\n\n\t\t\tif (!edit.replacements.some(r => supportedSource.has(r.data.editSource.metadata.source))) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (!edit.replacements.every(r => supportedSource.has(r.data.editSource.metadata.source))) {\n\t\t\t\tonUnexpectedError(new Error(`ArcTelemetrySender: Not all edits are ${edit.replacements[0].data.editSource.metadata.source}!`));\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst data = edit.replacements[0].data.editSource;\n\n\t\t\tconst uniqueEditId = this._randomService.generateUuid();\n\n\t\t\tconst docWithJustReason = createDocWithJustReason(docWithAnnotatedEdits, this._store);\n\t\t\tconst reporter = this._store.add(this._instantiationService.createInstance(ArcTelemetryReporter, [0, 60, 300].map(s => s * 1000), _prev, docWithJustReason, scmRepoBridge, edit, res => {\n\t\t\t\tres.telemetryService.publicLog2<{\n\t\t\t\t\tsourceKeyCleaned: string;\n\t\t\t\t\textensionId: string | undefined;\n\t\t\t\t\textensionVersion: string | undefined;\n\t\t\t\t\topportunityId: string | undefined;\n\t\t\t\t\teditSessionId: string | undefined;\n\t\t\t\t\trequestId: string | undefined;\n\t\t\t\t\tmodelId: string | undefined;\n\t\t\t\t\tlanguageId: string | undefined;\n\t\t\t\t\tmode: string | undefined;\n\t\t\t\t\tuniqueEditId: string | undefined;\n\n\t\t\t\t\tdidBranchChange: number;\n\t\t\t\t\ttimeDelayMs: number;\n\n\t\t\t\t\toriginalCharCount: number;\n\t\t\t\t\toriginalLineCount: number;\n\t\t\t\t\toriginalDeletedLineCount: number;\n\t\t\t\t\tarc: number;\n\t\t\t\t\tcurrentLineCount: number;\n\t\t\t\t\tcurrentDeletedLineCount: number;\n\t\t\t\t}, {\n\t\t\t\t\towner: 'hediet';\n\t\t\t\t\tcomment: 'Reports the accepted and retained character count for an inline completion/edit. @sentToGitHub';\n\n\t\t\t\t\tsourceKeyCleaned: { classification: 'SystemMetaData'; purpose: 'FeatureInsight'; comment: 'The key of the edit source.' };\n\t\t\t\t\textensionId: { classification: 'SystemMetaData'; purpose: 'FeatureInsight'; comment: 'The extension id (copilot or copilot-chat); which provided this inline completion.' };\n\t\t\t\t\textensionVersion: { classification: 'SystemMetaData'; purpose: 'FeatureInsight'; comment: 'The version of the extension.' };\n\t\t\t\t\topportunityId: { classification: 'SystemMetaData'; purpose: 'FeatureInsight'; comment: 'Unique identifier for an opportunity to show an inline completion or NES.' };\n\t\t\t\t\teditSessionId: { classification: 'SystemMetaData'; purpose: 'FeatureInsight'; comment: 'The session id.' };\n\t\t\t\t\trequestId: { classification: 'SystemMetaData'; purpose: 'FeatureInsight'; comment: 'The request id.' };\n\t\t\t\t\tmodelId: { classification: 'SystemMetaData'; purpose: 'FeatureInsight'; comment: 'The model id.' };\n\t\t\t\t\tlanguageId: { classification: 'SystemMetaData'; purpose: 'FeatureInsight'; comment: 'The language id of the document.' };\n\t\t\t\t\tmode: { classification: 'SystemMetaData'; purpose: 'FeatureInsight'; comment: 'The mode chat was in.' };\n\t\t\t\t\tuniqueEditId: { classification: 'SystemMetaData'; purpose: 'FeatureInsight'; comment: 'The unique identifier for the edit.' };\n\n\t\t\t\t\tdidBranchChange: { classification: 'SystemMetaData'; purpose: 'FeatureInsight'; isMeasurement: true; comment: 'Indicates if the branch changed in the meantime. If the branch changed (value is 1); this event should probably be ignored.' };\n\t\t\t\t\ttimeDelayMs: { classification: 'SystemMetaData'; purpose: 'FeatureInsight'; isMeasurement: true; comment: 'The time delay between the user accepting the edit and measuring the survival rate.' };\n\n\t\t\t\t\toriginalCharCount: { classification: 'SystemMetaData'; purpose: 'FeatureInsight'; isMeasurement: true; comment: 'The original character count before any edits.' };\n\t\t\t\t\toriginalLineCount: { classification: 'SystemMetaData'; purpose: 'FeatureInsight'; isMeasurement: true; comment: 'The original line count before any edits.' };\n\t\t\t\t\toriginalDeletedLineCount: { classification: 'SystemMetaData'; purpose: 'FeatureInsight'; isMeasurement: true; comment: 'The original deleted line count before any edits.' };\n\t\t\t\t\tarc: { classification: 'SystemMetaData'; purpose: 'FeatureInsight'; isMeasurement: true; comment: 'The accepted and restrained character count.' };\n\t\t\t\t\tcurrentLineCount: { classification: 'SystemMetaData'; purpose: 'FeatureInsight'; isMeasurement: true; comment: 'The current line count after edits.' };\n\t\t\t\t\tcurrentDeletedLineCount: { classification: 'SystemMetaData'; purpose: 'FeatureInsight'; isMeasurement: true; comment: 'The current deleted line count after edits.' };\n\t\t\t\t}>('editTelemetry.reportEditArc', {\n\t\t\t\t\tsourceKeyCleaned: data.toKey(Number.MAX_SAFE_INTEGER, {\n\t\t\t\t\t\t$extensionId: false,\n\t\t\t\t\t\t$extensionVersion: false,\n\t\t\t\t\t\t$$requestUuid: false,\n\t\t\t\t\t\t$$sessionId: false,\n\t\t\t\t\t\t$$requestId: false,\n\t\t\t\t\t\t$$languageId: false,\n\t\t\t\t\t\t$modelId: false,\n\t\t\t\t\t}),\n\t\t\t\t\textensionId: data.props.$extensionId,\n\t\t\t\t\textensionVersion: data.props.$extensionVersion,\n\t\t\t\t\topportunityId: data.props.$$requestUuid,\n\t\t\t\t\teditSessionId: data.props.$$sessionId,\n\t\t\t\t\trequestId: data.props.$$requestId,\n\t\t\t\t\tmodelId: data.props.$modelId,\n\t\t\t\t\tlanguageId: data.props.$$languageId,\n\t\t\t\t\tmode: data.props.$$mode,\n\t\t\t\t\tuniqueEditId,\n\n\t\t\t\t\tdidBranchChange: res.didBranchChange ? 1 : 0,\n\t\t\t\t\ttimeDelayMs: res.timeDelayMs,\n\n\t\t\t\t\toriginalCharCount: res.originalCharCount,\n\t\t\t\t\toriginalLineCount: res.originalLineCount,\n\t\t\t\t\toriginalDeletedLineCount: res.originalDeletedLineCount,\n\t\t\t\t\tarc: res.arc,\n\t\t\t\t\tcurrentLineCount: res.currentLineCount,\n\t\t\t\t\tcurrentDeletedLineCount: res.currentDeletedLineCount,\n\n\t\t\t\t\t...forwardToChannelIf(isCopilotLikeExtension(data.props.$extensionId)),\n\t\t\t\t});\n\t\t\t}, () => {\n\t\t\t\tthis._store.deleteAndLeak(reporter);\n\t\t\t}));\n\t\t}));\n\t}\n}\n"]}