{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/contrib/editTelemetry/test/node/arcTracker.test.ts","vs/workbench/contrib/editTelemetry/test/node/arcTracker.test.ts"],"names":[],"mappings":"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","file":"arcTracker.test.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport assert from 'assert';\nimport { ensureNoDisposablesAreLeakedInTestSuite } from '../../../../../base/test/common/utils.js';\nimport { StringText } from '../../../../../editor/common/core/text/abstractText.js';\nimport { ArcTracker } from '../../common/arcTracker.js';\nimport { FileAccess } from '../../../../../base/common/network.js';\nimport { readFileSync } from 'fs';\nimport { join, resolve } from '../../../../../base/common/path.js';\nimport { StringEdit, StringReplacement } from '../../../../../editor/common/core/edits/stringEdit.js';\nimport { OffsetRange } from '../../../../../editor/common/core/ranges/offsetRange.js';\nimport { ensureDependenciesAreSet } from '../../../../../editor/common/core/text/positionToOffset.js';\n\nsuite('ArcTracker', () => {\n\tensureNoDisposablesAreLeakedInTestSuite();\n\tensureDependenciesAreSet();\n\n\tconst fixturesOutDir = FileAccess.asFileUri('vs/workbench/contrib/editTelemetry/test/node/data').fsPath;\n\tconst fixturesSrcDir = resolve(fixturesOutDir).replaceAll('\\\\', '/').replace('/out/vs/workbench/', '/src/vs/workbench/');\n\n\tfunction getData(name: string): IEdits {\n\t\tconst path = join(fixturesSrcDir, name + '.edits.w.json');\n\t\tconst src = readFileSync(path, 'utf8');\n\t\treturn JSON.parse(src);\n\t}\n\n\ttest('issue-264048', () => {\n\t\tconst stats = runTestWithData(getData('issue-264048'));\n\t\tassert.deepStrictEqual(stats, ([\n\t\t\t{\n\t\t\t\tarc: 8,\n\t\t\t\tdeletedLineCounts: 1,\n\t\t\t\tinsertedLineCounts: 1\n\t\t\t},\n\t\t\t{\n\t\t\t\tarc: 8,\n\t\t\t\tdeletedLineCounts: 0,\n\t\t\t\tinsertedLineCounts: 1\n\t\t\t},\n\t\t\t{\n\t\t\t\tarc: 8,\n\t\t\t\tdeletedLineCounts: 0,\n\t\t\t\tinsertedLineCounts: 1\n\t\t\t}\n\t\t]));\n\t});\n\n\ttest('line-insert', () => {\n\t\tconst stats = runTestWithData(getData('line-insert'));\n\t\tassert.deepStrictEqual(stats, ([\n\t\t\t{\n\t\t\t\tarc: 7,\n\t\t\t\tdeletedLineCounts: 0,\n\t\t\t\tinsertedLineCounts: 1\n\t\t\t},\n\t\t\t{\n\t\t\t\tarc: 5,\n\t\t\t\tdeletedLineCounts: 0,\n\t\t\t\tinsertedLineCounts: 1\n\t\t\t}\n\t\t]));\n\t});\n\n\ttest('line-modification', () => {\n\t\tconst stats = runTestWithData(getData('line-modification'));\n\t\tassert.deepStrictEqual(stats, ([\n\t\t\t{\n\t\t\t\tarc: 6,\n\t\t\t\tdeletedLineCounts: 1,\n\t\t\t\tinsertedLineCounts: 1\n\t\t\t},\n\t\t\t{\n\t\t\t\tarc: 6,\n\t\t\t\tdeletedLineCounts: 1,\n\t\t\t\tinsertedLineCounts: 1\n\t\t\t},\n\t\t\t{\n\t\t\t\tarc: 0,\n\t\t\t\tdeletedLineCounts: 0,\n\t\t\t\tinsertedLineCounts: 0\n\t\t\t}\n\t\t]));\n\t});\n\n\ttest('multiline-insert', () => {\n\t\tconst stats = runTestWithData(getData('multiline-insert'));\n\t\tassert.deepStrictEqual(stats, ([\n\t\t\t{\n\t\t\t\tarc: 24,\n\t\t\t\tdeletedLineCounts: 0,\n\t\t\t\tinsertedLineCounts: 3\n\t\t\t},\n\t\t\t{\n\t\t\t\tarc: 23,\n\t\t\t\tdeletedLineCounts: 0,\n\t\t\t\tinsertedLineCounts: 2\n\t\t\t}\n\t\t]));\n\t});\n});\n\ninterface IEdits {\n\tinitialText: string;\n\tedits: Array<{\n\t\treplacements: Array<{\n\t\t\tstart: number;\n\t\t\tendEx: number;\n\t\t\ttext: string;\n\t\t}>;\n\t}>;\n}\n\nfunction createStringEditFromJson(editData: IEdits['edits'][0]): StringEdit {\n\tconst replacements = editData.replacements.map(replacement =>\n\t\tnew StringReplacement(\n\t\t\tOffsetRange.ofStartAndLength(replacement.start, replacement.endEx - replacement.start),\n\t\t\treplacement.text\n\t\t)\n\t);\n\treturn new StringEdit(replacements);\n}\n\nfunction runTestWithData(data: IEdits): unknown {\n\tconst edits = data.edits.map(editData => createStringEditFromJson(editData));\n\n\tconst t = new ArcTracker(\n\t\tnew StringText(data.initialText),\n\t\tedits[0]\n\t);\n\n\tconst stats: unknown[] = [];\n\tstats.push(t.getValues());\n\tlet lastLineNumbers = t.getLineCountInfo().insertedLineCounts;\n\tlet lastArc = t.getAcceptedRestrainedCharactersCount();\n\n\tfor (let i = 1; i < edits.length; i++) {\n\t\tt.handleEdits(edits[i]);\n\t\tstats.push(t.getValues());\n\n\t\tconst newLineNumbers = t.getLineCountInfo().insertedLineCounts;\n\t\tassert.ok(newLineNumbers <= lastLineNumbers, `Line numbers must not increase. Last: ${lastLineNumbers}, new: ${newLineNumbers}`);\n\t\tlastLineNumbers = newLineNumbers;\n\n\t\tconst newArc = t.getAcceptedRestrainedCharactersCount();\n\t\tassert.ok(newArc <= lastArc, `ARC must not increase. Last: ${lastArc}, new: ${newArc}`);\n\t\tlastArc = newArc;\n\t}\n\treturn stats;\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport assert from 'assert';\nimport { ensureNoDisposablesAreLeakedInTestSuite } from '../../../../../base/test/common/utils.js';\nimport { StringText } from '../../../../../editor/common/core/text/abstractText.js';\nimport { ArcTracker } from '../../common/arcTracker.js';\nimport { FileAccess } from '../../../../../base/common/network.js';\nimport { readFileSync } from 'fs';\nimport { join, resolve } from '../../../../../base/common/path.js';\nimport { StringEdit, StringReplacement } from '../../../../../editor/common/core/edits/stringEdit.js';\nimport { OffsetRange } from '../../../../../editor/common/core/ranges/offsetRange.js';\nimport { ensureDependenciesAreSet } from '../../../../../editor/common/core/text/positionToOffset.js';\n\nsuite('ArcTracker', () => {\n\tensureNoDisposablesAreLeakedInTestSuite();\n\tensureDependenciesAreSet();\n\n\tconst fixturesOutDir = FileAccess.asFileUri('vs/workbench/contrib/editTelemetry/test/node/data').fsPath;\n\tconst fixturesSrcDir = resolve(fixturesOutDir).replaceAll('\\\\', '/').replace('/out/vs/workbench/', '/src/vs/workbench/');\n\n\tfunction getData(name: string): IEdits {\n\t\tconst path = join(fixturesSrcDir, name + '.edits.w.json');\n\t\tconst src = readFileSync(path, 'utf8');\n\t\treturn JSON.parse(src);\n\t}\n\n\ttest('issue-264048', () => {\n\t\tconst stats = runTestWithData(getData('issue-264048'));\n\t\tassert.deepStrictEqual(stats, ([\n\t\t\t{\n\t\t\t\tarc: 8,\n\t\t\t\tdeletedLineCounts: 1,\n\t\t\t\tinsertedLineCounts: 1\n\t\t\t},\n\t\t\t{\n\t\t\t\tarc: 8,\n\t\t\t\tdeletedLineCounts: 0,\n\t\t\t\tinsertedLineCounts: 1\n\t\t\t},\n\t\t\t{\n\t\t\t\tarc: 8,\n\t\t\t\tdeletedLineCounts: 0,\n\t\t\t\tinsertedLineCounts: 1\n\t\t\t}\n\t\t]));\n\t});\n\n\ttest('line-insert', () => {\n\t\tconst stats = runTestWithData(getData('line-insert'));\n\t\tassert.deepStrictEqual(stats, ([\n\t\t\t{\n\t\t\t\tarc: 7,\n\t\t\t\tdeletedLineCounts: 0,\n\t\t\t\tinsertedLineCounts: 1\n\t\t\t},\n\t\t\t{\n\t\t\t\tarc: 5,\n\t\t\t\tdeletedLineCounts: 0,\n\t\t\t\tinsertedLineCounts: 1\n\t\t\t}\n\t\t]));\n\t});\n\n\ttest('line-modification', () => {\n\t\tconst stats = runTestWithData(getData('line-modification'));\n\t\tassert.deepStrictEqual(stats, ([\n\t\t\t{\n\t\t\t\tarc: 6,\n\t\t\t\tdeletedLineCounts: 1,\n\t\t\t\tinsertedLineCounts: 1\n\t\t\t},\n\t\t\t{\n\t\t\t\tarc: 6,\n\t\t\t\tdeletedLineCounts: 1,\n\t\t\t\tinsertedLineCounts: 1\n\t\t\t},\n\t\t\t{\n\t\t\t\tarc: 0,\n\t\t\t\tdeletedLineCounts: 0,\n\t\t\t\tinsertedLineCounts: 0\n\t\t\t}\n\t\t]));\n\t});\n\n\ttest('multiline-insert', () => {\n\t\tconst stats = runTestWithData(getData('multiline-insert'));\n\t\tassert.deepStrictEqual(stats, ([\n\t\t\t{\n\t\t\t\tarc: 24,\n\t\t\t\tdeletedLineCounts: 0,\n\t\t\t\tinsertedLineCounts: 3\n\t\t\t},\n\t\t\t{\n\t\t\t\tarc: 23,\n\t\t\t\tdeletedLineCounts: 0,\n\t\t\t\tinsertedLineCounts: 2\n\t\t\t}\n\t\t]));\n\t});\n});\n\ninterface IEdits {\n\tinitialText: string;\n\tedits: Array<{\n\t\treplacements: Array<{\n\t\t\tstart: number;\n\t\t\tendEx: number;\n\t\t\ttext: string;\n\t\t}>;\n\t}>;\n}\n\nfunction createStringEditFromJson(editData: IEdits['edits'][0]): StringEdit {\n\tconst replacements = editData.replacements.map(replacement =>\n\t\tnew StringReplacement(\n\t\t\tOffsetRange.ofStartAndLength(replacement.start, replacement.endEx - replacement.start),\n\t\t\treplacement.text\n\t\t)\n\t);\n\treturn new StringEdit(replacements);\n}\n\nfunction runTestWithData(data: IEdits): unknown {\n\tconst edits = data.edits.map(editData => createStringEditFromJson(editData));\n\n\tconst t = new ArcTracker(\n\t\tnew StringText(data.initialText),\n\t\tedits[0]\n\t);\n\n\tconst stats: unknown[] = [];\n\tstats.push(t.getValues());\n\tlet lastLineNumbers = t.getLineCountInfo().insertedLineCounts;\n\tlet lastArc = t.getAcceptedRestrainedCharactersCount();\n\n\tfor (let i = 1; i < edits.length; i++) {\n\t\tt.handleEdits(edits[i]);\n\t\tstats.push(t.getValues());\n\n\t\tconst newLineNumbers = t.getLineCountInfo().insertedLineCounts;\n\t\tassert.ok(newLineNumbers <= lastLineNumbers, `Line numbers must not increase. Last: ${lastLineNumbers}, new: ${newLineNumbers}`);\n\t\tlastLineNumbers = newLineNumbers;\n\n\t\tconst newArc = t.getAcceptedRestrainedCharactersCount();\n\t\tassert.ok(newArc <= lastArc, `ARC must not increase. Last: ${lastArc}, new: ${newArc}`);\n\t\tlastArc = newArc;\n\t}\n\treturn stats;\n}\n"]}