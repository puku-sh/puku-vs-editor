{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/contrib/editTelemetry/test/browser/editTelemetry.test.ts","vs/workbench/contrib/editTelemetry/test/browser/editTelemetry.test.ts"],"names":[],"mappings":"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","file":"editTelemetry.test.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport assert from 'assert';\nimport { Disposable, DisposableStore, toDisposable } from '../../../../../base/common/lifecycle.js';\nimport { constObservable, IObservable, IObservableWithChange, ISettableObservable, ITransaction, observableValue, subtransaction } from '../../../../../base/common/observable.js';\nimport { URI } from '../../../../../base/common/uri.js';\nimport { StringEdit, StringReplacement } from '../../../../../editor/common/core/edits/stringEdit.js';\nimport { OffsetRange } from '../../../../../editor/common/core/ranges/offsetRange.js';\nimport { StringText } from '../../../../../editor/common/core/text/abstractText.js';\nimport { ServiceCollection } from '../../../../../platform/instantiation/common/serviceCollection.js';\nimport { TestInstantiationService } from '../../../../../platform/instantiation/test/common/instantiationServiceMock.js';\nimport { AnnotatedDocument, AnnotatedDocuments, IAnnotatedDocuments, UriVisibilityProvider } from '../../browser/helpers/annotatedDocuments.js';\nimport { IObservableDocument, ObservableWorkspace, StringEditWithReason } from '../../browser/helpers/observableWorkspace.js';\nimport { EditSourceTrackingImpl } from '../../browser/telemetry/editSourceTrackingImpl.js';\nimport { ScmAdapter } from '../../browser/telemetry/scmAdapter.js';\nimport { EditSources } from '../../../../../editor/common/textModelEditSource.js';\nimport { DiffService } from '../../browser/helpers/documentWithAnnotatedEdits.js';\nimport { computeStringDiff } from '../../../../../editor/common/services/editorWebWorker.js';\nimport { runWithFakedTimers } from '../../../../../base/test/common/timeTravelScheduler.js';\nimport { timeout } from '../../../../../base/common/async.js';\nimport { ITelemetryService } from '../../../../../platform/telemetry/common/telemetry.js';\nimport { IAiEditTelemetryService } from '../../browser/telemetry/aiEditTelemetry/aiEditTelemetryService.js';\nimport { Random } from '../../../../../editor/test/common/core/random.js';\nimport { AiEditTelemetryServiceImpl } from '../../browser/telemetry/aiEditTelemetry/aiEditTelemetryServiceImpl.js';\nimport { IRandomService, RandomService } from '../../browser/randomService.js';\nimport { ensureNoDisposablesAreLeakedInTestSuite } from '../../../../../base/test/common/utils.js';\nimport { SyncDescriptor } from '../../../../../platform/instantiation/common/descriptors.js';\n\nsuite('Edit Telemetry', () => {\n\tensureNoDisposablesAreLeakedInTestSuite();\n\n\ttest('1', async () => runWithFakedTimers({}, async () => {\n\t\tconst disposables = new DisposableStore();\n\t\tconst instantiationService = disposables.add(new TestInstantiationService(new ServiceCollection(\n\t\t\t[IAiEditTelemetryService, new SyncDescriptor(AiEditTelemetryServiceImpl)],\n\t\t)));\n\n\t\tconst sentTelemetry: unknown[] = [];\n\t\tinstantiationService.stub(ITelemetryService, {\n\t\t\tpublicLog2(eventName, data) {\n\t\t\t\tsentTelemetry.push(`${formatTime(Date.now())} ${eventName}: ${JSON.stringify(data)}`);\n\t\t\t},\n\t\t});\n\t\tinstantiationService.stubInstance(DiffService, { computeDiff: async (original, modified) => computeStringDiff(original, modified, { maxComputationTimeMs: 500 }, 'advanced') });\n\t\tinstantiationService.stubInstance(ScmAdapter, { getRepo: (uri, reader) => undefined, });\n\t\tinstantiationService.stubInstance(UriVisibilityProvider, { isVisible: (uri, reader) => true, });\n\t\tinstantiationService.stub(IRandomService, new DeterministicRandomService());\n\n\t\tconst w = new MutableObservableWorkspace();\n\t\tconst docs = disposables.add(new AnnotatedDocuments(w, instantiationService));\n\t\tdisposables.add(new EditSourceTrackingImpl(constObservable(true), docs, instantiationService));\n\n\t\tconst d1 = disposables.add(w.createDocument({\n\t\t\turi: URI.parse('file:///a'), initialValue: `\nfunction fib(n) {\n\tif (n <= 1) return n;\n\treturn fib(n - 1) + fib(n - 2);\n}\n`\n\t\t}, undefined));\n\n\t\tawait timeout(10);\n\n\t\tconst chatEdit = EditSources.chatApplyEdits({\n\t\t\tlanguageId: 'plaintext',\n\t\t\tmodelId: undefined,\n\t\t\tcodeBlockSuggestionId: undefined,\n\t\t\textensionId: undefined,\n\t\t\tmode: undefined,\n\t\t\trequestId: undefined,\n\t\t\tsessionId: undefined,\n\t\t});\n\n\t\td1.applyEdit(StringEditWithReason.replace(d1.findRange('≪≫function fib(n) {'), '// Computes the nth fibonacci number\\n', chatEdit));\n\n\t\tawait timeout(5000);\n\n\t\td1.applyEdit(new StringEditWithReason([\n\t\t\tStringReplacement.replace(d1.findRange('≪//≫ Computes'), '/*'),\n\t\t\tStringReplacement.replace(d1.findRange('fibonacci number≪≫'), ' */'),\n\t\t], EditSources.cursor({ kind: 'type' })));\n\n\t\tawait timeout(5000);\n\n\t\td1.applyEdit(StringEditWithReason.replace(d1.findRange('Computes the nth fibonacci number'), 'Berechnet die nte Fibonacci Zahl', chatEdit));\n\n\t\tawait timeout(6 * 60 * 1000);\n\n\t\tassert.deepStrictEqual(sentTelemetry, [\n\t\t\t'00:01:010 editTelemetry.reportEditArc: {\"sourceKeyCleaned\":\"source:Chat.applyEdits\",\"languageId\":\"plaintext\",\"uniqueEditId\":\"8c97b7d8-9adb-4bd8-ac9f-a562704ce40e\",\"didBranchChange\":0,\"timeDelayMs\":0,\"originalCharCount\":37,\"originalLineCount\":1,\"originalDeletedLineCount\":0,\"arc\":37,\"currentLineCount\":1,\"currentDeletedLineCount\":0}',\n\t\t\t'00:01:010 editTelemetry.codeSuggested: {\"eventId\":\"evt-055ed5f5-c723-4ede-ba79-cccd7685c7ad\",\"suggestionId\":\"sgt-f645627a-cacf-477a-9164-ecd6125616a5\",\"presentation\":\"highlightedEdit\",\"feature\":\"sideBarChat\",\"languageId\":\"plaintext\",\"editCharsInserted\":37,\"editCharsDeleted\":0,\"editLinesInserted\":1,\"editLinesDeleted\":0,\"modelId\":{\"isTrustedTelemetryValue\":true}}',\n\t\t\t'00:11:010 editTelemetry.reportEditArc: {\"sourceKeyCleaned\":\"source:Chat.applyEdits\",\"languageId\":\"plaintext\",\"uniqueEditId\":\"1eb8a394-2489-41c2-851b-6a79432fc6bc\",\"didBranchChange\":0,\"timeDelayMs\":0,\"originalCharCount\":19,\"originalLineCount\":1,\"originalDeletedLineCount\":1,\"arc\":19,\"currentLineCount\":1,\"currentDeletedLineCount\":1}',\n\t\t\t'00:11:010 editTelemetry.codeSuggested: {\"eventId\":\"evt-5c9c6fe7-b219-4ff8-aaa7-ab2b355b21c0\",\"suggestionId\":\"sgt-74379122-0452-4e26-9c38-9d62f1e7ae73\",\"presentation\":\"highlightedEdit\",\"feature\":\"sideBarChat\",\"languageId\":\"plaintext\",\"editCharsInserted\":19,\"editCharsDeleted\":20,\"editLinesInserted\":1,\"editLinesDeleted\":1,\"modelId\":{\"isTrustedTelemetryValue\":true}}',\n\t\t\t'01:01:010 editTelemetry.reportEditArc: {\"sourceKeyCleaned\":\"source:Chat.applyEdits\",\"languageId\":\"plaintext\",\"uniqueEditId\":\"8c97b7d8-9adb-4bd8-ac9f-a562704ce40e\",\"didBranchChange\":0,\"timeDelayMs\":60000,\"originalCharCount\":37,\"originalLineCount\":1,\"originalDeletedLineCount\":0,\"arc\":16,\"currentLineCount\":1,\"currentDeletedLineCount\":0}',\n\t\t\t'01:11:010 editTelemetry.reportEditArc: {\"sourceKeyCleaned\":\"source:Chat.applyEdits\",\"languageId\":\"plaintext\",\"uniqueEditId\":\"1eb8a394-2489-41c2-851b-6a79432fc6bc\",\"didBranchChange\":0,\"timeDelayMs\":60000,\"originalCharCount\":19,\"originalLineCount\":1,\"originalDeletedLineCount\":1,\"arc\":19,\"currentLineCount\":1,\"currentDeletedLineCount\":1}',\n\t\t\t'05:00:000 editTelemetry.editSources.details: {\"mode\":\"5minWindow\",\"sourceKey\":\"source:Chat.applyEdits\",\"sourceKeyCleaned\":\"source:Chat.applyEdits\",\"trigger\":\"time\",\"languageId\":\"plaintext\",\"statsUuid\":\"509b5d53-9109-40a2-bdf5-1aa735a229fe\",\"modifiedCount\":35,\"deltaModifiedCount\":56,\"totalModifiedCount\":39}',\n\t\t\t'05:00:000 editTelemetry.editSources.details: {\"mode\":\"5minWindow\",\"sourceKey\":\"source:cursor-kind:type\",\"sourceKeyCleaned\":\"source:cursor-kind:type\",\"trigger\":\"time\",\"languageId\":\"plaintext\",\"statsUuid\":\"509b5d53-9109-40a2-bdf5-1aa735a229fe\",\"modifiedCount\":4,\"deltaModifiedCount\":4,\"totalModifiedCount\":39}',\n\t\t\t'05:00:000 editTelemetry.editSources.stats: {\"mode\":\"5minWindow\",\"languageId\":\"plaintext\",\"statsUuid\":\"509b5d53-9109-40a2-bdf5-1aa735a229fe\",\"nesModifiedCount\":0,\"inlineCompletionsCopilotModifiedCount\":0,\"inlineCompletionsNESModifiedCount\":0,\"otherAIModifiedCount\":35,\"unknownModifiedCount\":0,\"userModifiedCount\":4,\"ideModifiedCount\":0,\"totalModifiedCharacters\":39,\"externalModifiedCount\":0,\"isTrackedByGit\":0}',\n\t\t\t'05:01:010 editTelemetry.reportEditArc: {\"sourceKeyCleaned\":\"source:Chat.applyEdits\",\"languageId\":\"plaintext\",\"uniqueEditId\":\"8c97b7d8-9adb-4bd8-ac9f-a562704ce40e\",\"didBranchChange\":0,\"timeDelayMs\":300000,\"originalCharCount\":37,\"originalLineCount\":1,\"originalDeletedLineCount\":0,\"arc\":16,\"currentLineCount\":1,\"currentDeletedLineCount\":0}',\n\t\t\t'05:11:010 editTelemetry.reportEditArc: {\"sourceKeyCleaned\":\"source:Chat.applyEdits\",\"languageId\":\"plaintext\",\"uniqueEditId\":\"1eb8a394-2489-41c2-851b-6a79432fc6bc\",\"didBranchChange\":0,\"timeDelayMs\":300000,\"originalCharCount\":19,\"originalLineCount\":1,\"originalDeletedLineCount\":1,\"arc\":19,\"currentLineCount\":1,\"currentDeletedLineCount\":1}',\n\t\t]);\n\n\t\tdisposables.dispose();\n\t}));\n});\n\nfunction formatTime(timeMs: number): string {\n\tconst totalMs = Math.floor(timeMs);\n\tconst minutes = Math.floor(totalMs / 60000);\n\tconst seconds = Math.floor((totalMs % 60000) / 1000);\n\tconst ms = totalMs % 1000;\n\tconst str = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}:${ms.toString().padStart(3, '0')}`;\n\treturn str;\n}\n\nclass DeterministicRandomService extends RandomService {\n\tprivate readonly _rand = Random.create(0);\n\n\toverride generateUuid(): string {\n\t\treturn this._rand.nextUuid();\n\t}\n}\n\nexport class FakeAnnotatedDocuments extends Disposable implements IAnnotatedDocuments {\n\tpublic readonly documents: IObservable<readonly AnnotatedDocument[]>;\n\n\tconstructor() {\n\t\tsuper();\n\n\t\tthis.documents = constObservable<readonly AnnotatedDocument[]>([]);\n\t}\n}\n\n/** Can contain \"≪\" and \"≫\" to add context, e.g. e≪l≫ only matches the first l in `hello`. */\ntype SearchString = string;\n\nfunction findOffsetRange(str: string, search: SearchString): OffsetRange {\n\tconst startContextIndex = search.indexOf('≪');\n\tconst endContextIndex = search.indexOf('≫');\n\n\tlet searchStr: string;\n\tlet beforeContext = '';\n\tlet afterContext = '';\n\n\tif (startContextIndex !== -1 && endContextIndex !== -1 && endContextIndex > startContextIndex) {\n\t\tbeforeContext = search.substring(0, startContextIndex);\n\t\tafterContext = search.substring(endContextIndex + 1);\n\t\tsearchStr = search.substring(startContextIndex + 1, endContextIndex);\n\t} else {\n\t\tsearchStr = search;\n\t}\n\n\tconst startIndex = str.indexOf(beforeContext + searchStr + afterContext);\n\tif (startIndex === -1) {\n\t\tthrow new Error(`Could not find context \"${beforeContext}\" + \"${searchStr}\" + \"${afterContext}\" in string \"${str}\"`);\n\t}\n\n\tconst matchStart = startIndex + beforeContext.length;\n\treturn new OffsetRange(matchStart, matchStart + searchStr.length);\n}\n\nexport class MutableObservableWorkspace extends ObservableWorkspace {\n\tprivate readonly _openDocuments = observableValue<readonly IObservableDocument[], { added: readonly IObservableDocument[]; removed: readonly IObservableDocument[] }>(this, []);\n\tpublic readonly documents = this._openDocuments;\n\n\tprivate readonly _documents = new Map</* uri */ string, MutableObservableDocument>();\n\n\tconstructor() {\n\t\tsuper();\n\t}\n\n\t/**\n\t * Dispose to remove.\n\t*/\n\tpublic createDocument(options: { uri: URI; workspaceRoot?: URI; initialValue?: string; initialVersionId?: number; languageId?: string }, tx: ITransaction | undefined = undefined): MutableObservableDocument {\n\t\tassert(!this._documents.has(options.uri.toString()));\n\n\t\tconst document = new MutableObservableDocument(\n\t\t\toptions.uri,\n\t\t\tnew StringText(options.initialValue ?? ''),\n\t\t\t[],\n\t\t\toptions.languageId ?? 'plaintext',\n\t\t\t() => {\n\t\t\t\tthis._documents.delete(options.uri.toString());\n\t\t\t\tconst docs = this._openDocuments.get();\n\t\t\t\tconst filteredDocs = docs.filter(d => d.uri.toString() !== document.uri.toString());\n\t\t\t\tif (filteredDocs.length !== docs.length) {\n\t\t\t\t\tthis._openDocuments.set(filteredDocs, tx, { added: [], removed: [document] });\n\t\t\t\t}\n\t\t\t},\n\t\t\toptions.initialVersionId ?? 0,\n\t\t\toptions.workspaceRoot,\n\t\t);\n\n\t\tthis._documents.set(options.uri.toString(), document);\n\t\tthis._openDocuments.set([...this._openDocuments.get(), document], tx, { added: [document], removed: [] });\n\n\t\treturn document;\n\t}\n\n\tpublic override getDocument(id: URI): MutableObservableDocument | undefined {\n\t\treturn this._documents.get(id.toString());\n\t}\n\n\tpublic clear(): void {\n\t\tthis._openDocuments.set([], undefined, { added: [], removed: this._openDocuments.get() });\n\t\tfor (const doc of this._documents.values()) {\n\t\t\tdoc.dispose();\n\t\t}\n\t\tthis._documents.clear();\n\t}\n}\n\nexport class MutableObservableDocument extends Disposable implements IObservableDocument {\n\tprivate readonly _value: ISettableObservable<StringText, StringEditWithReason>;\n\tpublic get value(): IObservableWithChange<StringText, StringEditWithReason> { return this._value; }\n\n\tprivate readonly _selection: ISettableObservable<readonly OffsetRange[]>;\n\tpublic get selection(): IObservable<readonly OffsetRange[]> { return this._selection; }\n\n\tprivate readonly _visibleRanges: ISettableObservable<readonly OffsetRange[]>;\n\tpublic get visibleRanges(): IObservable<readonly OffsetRange[]> { return this._visibleRanges; }\n\n\tprivate readonly _languageId: ISettableObservable<string>;\n\tpublic get languageId(): IObservable<string> { return this._languageId; }\n\n\tprivate readonly _version: ISettableObservable<number>;\n\tpublic get version(): IObservable<number> { return this._version; }\n\n\tconstructor(\n\t\tpublic readonly uri: URI,\n\t\tvalue: StringText,\n\t\tselection: readonly OffsetRange[],\n\t\tlanguageId: string,\n\t\tonDispose: () => void,\n\t\tversionId: number,\n\t\tpublic readonly workspaceRoot: URI | undefined,\n\t) {\n\t\tsuper();\n\n\t\tthis._value = observableValue(this, value);\n\t\tthis._selection = observableValue(this, selection);\n\t\tthis._visibleRanges = observableValue(this, []);\n\t\tthis._languageId = observableValue(this, languageId);\n\t\tthis._version = observableValue(this, versionId);\n\n\t\tthis._register(toDisposable(onDispose));\n\t}\n\n\tsetSelection(selection: readonly OffsetRange[], tx: ITransaction | undefined = undefined): void {\n\t\tthis._selection.set(selection, tx);\n\t}\n\n\tsetVisibleRange(visibleRanges: readonly OffsetRange[], tx: ITransaction | undefined = undefined): void {\n\t\tthis._visibleRanges.set(visibleRanges, tx);\n\t}\n\n\tapplyEdit(edit: StringEdit | StringEditWithReason, tx: ITransaction | undefined = undefined, newVersion: number | undefined = undefined): void {\n\t\tconst newValue = edit.applyOnText(this.value.get());\n\t\tconst e = edit instanceof StringEditWithReason ? edit : new StringEditWithReason(edit.replacements, EditSources.unknown({}));\n\t\tsubtransaction(tx, tx => {\n\t\t\tthis._value.set(newValue, tx, e);\n\t\t\tthis._version.set(newVersion ?? this._version.get() + 1, tx);\n\t\t});\n\t}\n\n\tupdateSelection(selection: readonly OffsetRange[], tx: ITransaction | undefined = undefined): void {\n\t\tthis._selection.set(selection, tx);\n\t}\n\n\tsetValue(value: StringText, tx: ITransaction | undefined = undefined, newVersion: number | undefined = undefined): void {\n\t\tconst reason = EditSources.unknown({});\n\t\tconst e = new StringEditWithReason([StringReplacement.replace(new OffsetRange(0, this.value.get().value.length), value.value)], reason);\n\t\tsubtransaction(tx, tx => {\n\t\t\tthis._value.set(value, tx, e);\n\t\t\tthis._version.set(newVersion ?? this._version.get() + 1, tx);\n\t\t});\n\t}\n\n\tfindRange(search: SearchString): OffsetRange {\n\t\treturn findOffsetRange(this.value.get().value, search);\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport assert from 'assert';\nimport { Disposable, DisposableStore, toDisposable } from '../../../../../base/common/lifecycle.js';\nimport { constObservable, IObservable, IObservableWithChange, ISettableObservable, ITransaction, observableValue, subtransaction } from '../../../../../base/common/observable.js';\nimport { URI } from '../../../../../base/common/uri.js';\nimport { StringEdit, StringReplacement } from '../../../../../editor/common/core/edits/stringEdit.js';\nimport { OffsetRange } from '../../../../../editor/common/core/ranges/offsetRange.js';\nimport { StringText } from '../../../../../editor/common/core/text/abstractText.js';\nimport { ServiceCollection } from '../../../../../platform/instantiation/common/serviceCollection.js';\nimport { TestInstantiationService } from '../../../../../platform/instantiation/test/common/instantiationServiceMock.js';\nimport { AnnotatedDocument, AnnotatedDocuments, IAnnotatedDocuments, UriVisibilityProvider } from '../../browser/helpers/annotatedDocuments.js';\nimport { IObservableDocument, ObservableWorkspace, StringEditWithReason } from '../../browser/helpers/observableWorkspace.js';\nimport { EditSourceTrackingImpl } from '../../browser/telemetry/editSourceTrackingImpl.js';\nimport { ScmAdapter } from '../../browser/telemetry/scmAdapter.js';\nimport { EditSources } from '../../../../../editor/common/textModelEditSource.js';\nimport { DiffService } from '../../browser/helpers/documentWithAnnotatedEdits.js';\nimport { computeStringDiff } from '../../../../../editor/common/services/editorWebWorker.js';\nimport { runWithFakedTimers } from '../../../../../base/test/common/timeTravelScheduler.js';\nimport { timeout } from '../../../../../base/common/async.js';\nimport { ITelemetryService } from '../../../../../platform/telemetry/common/telemetry.js';\nimport { IAiEditTelemetryService } from '../../browser/telemetry/aiEditTelemetry/aiEditTelemetryService.js';\nimport { Random } from '../../../../../editor/test/common/core/random.js';\nimport { AiEditTelemetryServiceImpl } from '../../browser/telemetry/aiEditTelemetry/aiEditTelemetryServiceImpl.js';\nimport { IRandomService, RandomService } from '../../browser/randomService.js';\nimport { ensureNoDisposablesAreLeakedInTestSuite } from '../../../../../base/test/common/utils.js';\nimport { SyncDescriptor } from '../../../../../platform/instantiation/common/descriptors.js';\n\nsuite('Edit Telemetry', () => {\n\tensureNoDisposablesAreLeakedInTestSuite();\n\n\ttest('1', async () => runWithFakedTimers({}, async () => {\n\t\tconst disposables = new DisposableStore();\n\t\tconst instantiationService = disposables.add(new TestInstantiationService(new ServiceCollection(\n\t\t\t[IAiEditTelemetryService, new SyncDescriptor(AiEditTelemetryServiceImpl)],\n\t\t)));\n\n\t\tconst sentTelemetry: unknown[] = [];\n\t\tinstantiationService.stub(ITelemetryService, {\n\t\t\tpublicLog2(eventName, data) {\n\t\t\t\tsentTelemetry.push(`${formatTime(Date.now())} ${eventName}: ${JSON.stringify(data)}`);\n\t\t\t},\n\t\t});\n\t\tinstantiationService.stubInstance(DiffService, { computeDiff: async (original, modified) => computeStringDiff(original, modified, { maxComputationTimeMs: 500 }, 'advanced') });\n\t\tinstantiationService.stubInstance(ScmAdapter, { getRepo: (uri, reader) => undefined, });\n\t\tinstantiationService.stubInstance(UriVisibilityProvider, { isVisible: (uri, reader) => true, });\n\t\tinstantiationService.stub(IRandomService, new DeterministicRandomService());\n\n\t\tconst w = new MutableObservableWorkspace();\n\t\tconst docs = disposables.add(new AnnotatedDocuments(w, instantiationService));\n\t\tdisposables.add(new EditSourceTrackingImpl(constObservable(true), docs, instantiationService));\n\n\t\tconst d1 = disposables.add(w.createDocument({\n\t\t\turi: URI.parse('file:///a'), initialValue: `\nfunction fib(n) {\n\tif (n <= 1) return n;\n\treturn fib(n - 1) + fib(n - 2);\n}\n`\n\t\t}, undefined));\n\n\t\tawait timeout(10);\n\n\t\tconst chatEdit = EditSources.chatApplyEdits({\n\t\t\tlanguageId: 'plaintext',\n\t\t\tmodelId: undefined,\n\t\t\tcodeBlockSuggestionId: undefined,\n\t\t\textensionId: undefined,\n\t\t\tmode: undefined,\n\t\t\trequestId: undefined,\n\t\t\tsessionId: undefined,\n\t\t});\n\n\t\td1.applyEdit(StringEditWithReason.replace(d1.findRange('≪≫function fib(n) {'), '// Computes the nth fibonacci number\\n', chatEdit));\n\n\t\tawait timeout(5000);\n\n\t\td1.applyEdit(new StringEditWithReason([\n\t\t\tStringReplacement.replace(d1.findRange('≪//≫ Computes'), '/*'),\n\t\t\tStringReplacement.replace(d1.findRange('fibonacci number≪≫'), ' */'),\n\t\t], EditSources.cursor({ kind: 'type' })));\n\n\t\tawait timeout(5000);\n\n\t\td1.applyEdit(StringEditWithReason.replace(d1.findRange('Computes the nth fibonacci number'), 'Berechnet die nte Fibonacci Zahl', chatEdit));\n\n\t\tawait timeout(6 * 60 * 1000);\n\n\t\tassert.deepStrictEqual(sentTelemetry, [\n\t\t\t'00:01:010 editTelemetry.reportEditArc: {\"sourceKeyCleaned\":\"source:Chat.applyEdits\",\"languageId\":\"plaintext\",\"uniqueEditId\":\"8c97b7d8-9adb-4bd8-ac9f-a562704ce40e\",\"didBranchChange\":0,\"timeDelayMs\":0,\"originalCharCount\":37,\"originalLineCount\":1,\"originalDeletedLineCount\":0,\"arc\":37,\"currentLineCount\":1,\"currentDeletedLineCount\":0}',\n\t\t\t'00:01:010 editTelemetry.codeSuggested: {\"eventId\":\"evt-055ed5f5-c723-4ede-ba79-cccd7685c7ad\",\"suggestionId\":\"sgt-f645627a-cacf-477a-9164-ecd6125616a5\",\"presentation\":\"highlightedEdit\",\"feature\":\"sideBarChat\",\"languageId\":\"plaintext\",\"editCharsInserted\":37,\"editCharsDeleted\":0,\"editLinesInserted\":1,\"editLinesDeleted\":0,\"modelId\":{\"isTrustedTelemetryValue\":true}}',\n\t\t\t'00:11:010 editTelemetry.reportEditArc: {\"sourceKeyCleaned\":\"source:Chat.applyEdits\",\"languageId\":\"plaintext\",\"uniqueEditId\":\"1eb8a394-2489-41c2-851b-6a79432fc6bc\",\"didBranchChange\":0,\"timeDelayMs\":0,\"originalCharCount\":19,\"originalLineCount\":1,\"originalDeletedLineCount\":1,\"arc\":19,\"currentLineCount\":1,\"currentDeletedLineCount\":1}',\n\t\t\t'00:11:010 editTelemetry.codeSuggested: {\"eventId\":\"evt-5c9c6fe7-b219-4ff8-aaa7-ab2b355b21c0\",\"suggestionId\":\"sgt-74379122-0452-4e26-9c38-9d62f1e7ae73\",\"presentation\":\"highlightedEdit\",\"feature\":\"sideBarChat\",\"languageId\":\"plaintext\",\"editCharsInserted\":19,\"editCharsDeleted\":20,\"editLinesInserted\":1,\"editLinesDeleted\":1,\"modelId\":{\"isTrustedTelemetryValue\":true}}',\n\t\t\t'01:01:010 editTelemetry.reportEditArc: {\"sourceKeyCleaned\":\"source:Chat.applyEdits\",\"languageId\":\"plaintext\",\"uniqueEditId\":\"8c97b7d8-9adb-4bd8-ac9f-a562704ce40e\",\"didBranchChange\":0,\"timeDelayMs\":60000,\"originalCharCount\":37,\"originalLineCount\":1,\"originalDeletedLineCount\":0,\"arc\":16,\"currentLineCount\":1,\"currentDeletedLineCount\":0}',\n\t\t\t'01:11:010 editTelemetry.reportEditArc: {\"sourceKeyCleaned\":\"source:Chat.applyEdits\",\"languageId\":\"plaintext\",\"uniqueEditId\":\"1eb8a394-2489-41c2-851b-6a79432fc6bc\",\"didBranchChange\":0,\"timeDelayMs\":60000,\"originalCharCount\":19,\"originalLineCount\":1,\"originalDeletedLineCount\":1,\"arc\":19,\"currentLineCount\":1,\"currentDeletedLineCount\":1}',\n\t\t\t'05:00:000 editTelemetry.editSources.details: {\"mode\":\"5minWindow\",\"sourceKey\":\"source:Chat.applyEdits\",\"sourceKeyCleaned\":\"source:Chat.applyEdits\",\"trigger\":\"time\",\"languageId\":\"plaintext\",\"statsUuid\":\"509b5d53-9109-40a2-bdf5-1aa735a229fe\",\"modifiedCount\":35,\"deltaModifiedCount\":56,\"totalModifiedCount\":39}',\n\t\t\t'05:00:000 editTelemetry.editSources.details: {\"mode\":\"5minWindow\",\"sourceKey\":\"source:cursor-kind:type\",\"sourceKeyCleaned\":\"source:cursor-kind:type\",\"trigger\":\"time\",\"languageId\":\"plaintext\",\"statsUuid\":\"509b5d53-9109-40a2-bdf5-1aa735a229fe\",\"modifiedCount\":4,\"deltaModifiedCount\":4,\"totalModifiedCount\":39}',\n\t\t\t'05:00:000 editTelemetry.editSources.stats: {\"mode\":\"5minWindow\",\"languageId\":\"plaintext\",\"statsUuid\":\"509b5d53-9109-40a2-bdf5-1aa735a229fe\",\"nesModifiedCount\":0,\"inlineCompletionsCopilotModifiedCount\":0,\"inlineCompletionsNESModifiedCount\":0,\"otherAIModifiedCount\":35,\"unknownModifiedCount\":0,\"userModifiedCount\":4,\"ideModifiedCount\":0,\"totalModifiedCharacters\":39,\"externalModifiedCount\":0,\"isTrackedByGit\":0}',\n\t\t\t'05:01:010 editTelemetry.reportEditArc: {\"sourceKeyCleaned\":\"source:Chat.applyEdits\",\"languageId\":\"plaintext\",\"uniqueEditId\":\"8c97b7d8-9adb-4bd8-ac9f-a562704ce40e\",\"didBranchChange\":0,\"timeDelayMs\":300000,\"originalCharCount\":37,\"originalLineCount\":1,\"originalDeletedLineCount\":0,\"arc\":16,\"currentLineCount\":1,\"currentDeletedLineCount\":0}',\n\t\t\t'05:11:010 editTelemetry.reportEditArc: {\"sourceKeyCleaned\":\"source:Chat.applyEdits\",\"languageId\":\"plaintext\",\"uniqueEditId\":\"1eb8a394-2489-41c2-851b-6a79432fc6bc\",\"didBranchChange\":0,\"timeDelayMs\":300000,\"originalCharCount\":19,\"originalLineCount\":1,\"originalDeletedLineCount\":1,\"arc\":19,\"currentLineCount\":1,\"currentDeletedLineCount\":1}',\n\t\t]);\n\n\t\tdisposables.dispose();\n\t}));\n});\n\nfunction formatTime(timeMs: number): string {\n\tconst totalMs = Math.floor(timeMs);\n\tconst minutes = Math.floor(totalMs / 60000);\n\tconst seconds = Math.floor((totalMs % 60000) / 1000);\n\tconst ms = totalMs % 1000;\n\tconst str = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}:${ms.toString().padStart(3, '0')}`;\n\treturn str;\n}\n\nclass DeterministicRandomService extends RandomService {\n\tprivate readonly _rand = Random.create(0);\n\n\toverride generateUuid(): string {\n\t\treturn this._rand.nextUuid();\n\t}\n}\n\nexport class FakeAnnotatedDocuments extends Disposable implements IAnnotatedDocuments {\n\tpublic readonly documents: IObservable<readonly AnnotatedDocument[]>;\n\n\tconstructor() {\n\t\tsuper();\n\n\t\tthis.documents = constObservable<readonly AnnotatedDocument[]>([]);\n\t}\n}\n\n/** Can contain \"≪\" and \"≫\" to add context, e.g. e≪l≫ only matches the first l in `hello`. */\ntype SearchString = string;\n\nfunction findOffsetRange(str: string, search: SearchString): OffsetRange {\n\tconst startContextIndex = search.indexOf('≪');\n\tconst endContextIndex = search.indexOf('≫');\n\n\tlet searchStr: string;\n\tlet beforeContext = '';\n\tlet afterContext = '';\n\n\tif (startContextIndex !== -1 && endContextIndex !== -1 && endContextIndex > startContextIndex) {\n\t\tbeforeContext = search.substring(0, startContextIndex);\n\t\tafterContext = search.substring(endContextIndex + 1);\n\t\tsearchStr = search.substring(startContextIndex + 1, endContextIndex);\n\t} else {\n\t\tsearchStr = search;\n\t}\n\n\tconst startIndex = str.indexOf(beforeContext + searchStr + afterContext);\n\tif (startIndex === -1) {\n\t\tthrow new Error(`Could not find context \"${beforeContext}\" + \"${searchStr}\" + \"${afterContext}\" in string \"${str}\"`);\n\t}\n\n\tconst matchStart = startIndex + beforeContext.length;\n\treturn new OffsetRange(matchStart, matchStart + searchStr.length);\n}\n\nexport class MutableObservableWorkspace extends ObservableWorkspace {\n\tprivate readonly _openDocuments = observableValue<readonly IObservableDocument[], { added: readonly IObservableDocument[]; removed: readonly IObservableDocument[] }>(this, []);\n\tpublic readonly documents = this._openDocuments;\n\n\tprivate readonly _documents = new Map</* uri */ string, MutableObservableDocument>();\n\n\tconstructor() {\n\t\tsuper();\n\t}\n\n\t/**\n\t * Dispose to remove.\n\t*/\n\tpublic createDocument(options: { uri: URI; workspaceRoot?: URI; initialValue?: string; initialVersionId?: number; languageId?: string }, tx: ITransaction | undefined = undefined): MutableObservableDocument {\n\t\tassert(!this._documents.has(options.uri.toString()));\n\n\t\tconst document = new MutableObservableDocument(\n\t\t\toptions.uri,\n\t\t\tnew StringText(options.initialValue ?? ''),\n\t\t\t[],\n\t\t\toptions.languageId ?? 'plaintext',\n\t\t\t() => {\n\t\t\t\tthis._documents.delete(options.uri.toString());\n\t\t\t\tconst docs = this._openDocuments.get();\n\t\t\t\tconst filteredDocs = docs.filter(d => d.uri.toString() !== document.uri.toString());\n\t\t\t\tif (filteredDocs.length !== docs.length) {\n\t\t\t\t\tthis._openDocuments.set(filteredDocs, tx, { added: [], removed: [document] });\n\t\t\t\t}\n\t\t\t},\n\t\t\toptions.initialVersionId ?? 0,\n\t\t\toptions.workspaceRoot,\n\t\t);\n\n\t\tthis._documents.set(options.uri.toString(), document);\n\t\tthis._openDocuments.set([...this._openDocuments.get(), document], tx, { added: [document], removed: [] });\n\n\t\treturn document;\n\t}\n\n\tpublic override getDocument(id: URI): MutableObservableDocument | undefined {\n\t\treturn this._documents.get(id.toString());\n\t}\n\n\tpublic clear(): void {\n\t\tthis._openDocuments.set([], undefined, { added: [], removed: this._openDocuments.get() });\n\t\tfor (const doc of this._documents.values()) {\n\t\t\tdoc.dispose();\n\t\t}\n\t\tthis._documents.clear();\n\t}\n}\n\nexport class MutableObservableDocument extends Disposable implements IObservableDocument {\n\tprivate readonly _value: ISettableObservable<StringText, StringEditWithReason>;\n\tpublic get value(): IObservableWithChange<StringText, StringEditWithReason> { return this._value; }\n\n\tprivate readonly _selection: ISettableObservable<readonly OffsetRange[]>;\n\tpublic get selection(): IObservable<readonly OffsetRange[]> { return this._selection; }\n\n\tprivate readonly _visibleRanges: ISettableObservable<readonly OffsetRange[]>;\n\tpublic get visibleRanges(): IObservable<readonly OffsetRange[]> { return this._visibleRanges; }\n\n\tprivate readonly _languageId: ISettableObservable<string>;\n\tpublic get languageId(): IObservable<string> { return this._languageId; }\n\n\tprivate readonly _version: ISettableObservable<number>;\n\tpublic get version(): IObservable<number> { return this._version; }\n\n\tconstructor(\n\t\tpublic readonly uri: URI,\n\t\tvalue: StringText,\n\t\tselection: readonly OffsetRange[],\n\t\tlanguageId: string,\n\t\tonDispose: () => void,\n\t\tversionId: number,\n\t\tpublic readonly workspaceRoot: URI | undefined,\n\t) {\n\t\tsuper();\n\n\t\tthis._value = observableValue(this, value);\n\t\tthis._selection = observableValue(this, selection);\n\t\tthis._visibleRanges = observableValue(this, []);\n\t\tthis._languageId = observableValue(this, languageId);\n\t\tthis._version = observableValue(this, versionId);\n\n\t\tthis._register(toDisposable(onDispose));\n\t}\n\n\tsetSelection(selection: readonly OffsetRange[], tx: ITransaction | undefined = undefined): void {\n\t\tthis._selection.set(selection, tx);\n\t}\n\n\tsetVisibleRange(visibleRanges: readonly OffsetRange[], tx: ITransaction | undefined = undefined): void {\n\t\tthis._visibleRanges.set(visibleRanges, tx);\n\t}\n\n\tapplyEdit(edit: StringEdit | StringEditWithReason, tx: ITransaction | undefined = undefined, newVersion: number | undefined = undefined): void {\n\t\tconst newValue = edit.applyOnText(this.value.get());\n\t\tconst e = edit instanceof StringEditWithReason ? edit : new StringEditWithReason(edit.replacements, EditSources.unknown({}));\n\t\tsubtransaction(tx, tx => {\n\t\t\tthis._value.set(newValue, tx, e);\n\t\t\tthis._version.set(newVersion ?? this._version.get() + 1, tx);\n\t\t});\n\t}\n\n\tupdateSelection(selection: readonly OffsetRange[], tx: ITransaction | undefined = undefined): void {\n\t\tthis._selection.set(selection, tx);\n\t}\n\n\tsetValue(value: StringText, tx: ITransaction | undefined = undefined, newVersion: number | undefined = undefined): void {\n\t\tconst reason = EditSources.unknown({});\n\t\tconst e = new StringEditWithReason([StringReplacement.replace(new OffsetRange(0, this.value.get().value.length), value.value)], reason);\n\t\tsubtransaction(tx, tx => {\n\t\t\tthis._value.set(value, tx, e);\n\t\t\tthis._version.set(newVersion ?? this._version.get() + 1, tx);\n\t\t});\n\t}\n\n\tfindRange(search: SearchString): OffsetRange {\n\t\treturn findOffsetRange(this.value.get().value, search);\n\t}\n}\n"]}