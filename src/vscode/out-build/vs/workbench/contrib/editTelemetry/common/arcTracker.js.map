{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/contrib/editTelemetry/common/arcTracker.ts","vs/workbench/contrib/editTelemetry/common/arcTracker.ts"],"names":[],"mappings":"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","file":"arcTracker.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { sumBy } from '../../../../base/common/arrays.js';\nimport { LineEdit } from '../../../../editor/common/core/edits/lineEdit.js';\nimport { AnnotatedStringEdit, BaseStringEdit, IEditData } from '../../../../editor/common/core/edits/stringEdit.js';\nimport { AbstractText } from '../../../../editor/common/core/text/abstractText.js';\n\n/**\n * The ARC (accepted and retained characters) counts how many characters inserted by the initial suggestion (trackedEdit)\n * stay unmodified after a certain amount of time after acceptance.\n*/\nexport class ArcTracker {\n\tprivate _updatedTrackedEdit: AnnotatedStringEdit<IsTrackedEditData>;\n\tprivate _trackedEdit: BaseStringEdit;\n\n\tconstructor(\n\t\tprivate readonly _valueBeforeTrackedEdit: AbstractText,\n\t\ttrackedEdit: BaseStringEdit,\n\t) {\n\t\tthis._trackedEdit = trackedEdit.removeCommonSuffixPrefix(_valueBeforeTrackedEdit.getValue());\n\t\tthis._updatedTrackedEdit = this._trackedEdit.mapData(() => new IsTrackedEditData(true));\n\t}\n\n\tgetOriginalCharacterCount(): number {\n\t\treturn sumBy(this._trackedEdit.replacements, e => e.getNewLength());\n\t}\n\n\t/**\n\t * edit must apply to _updatedTrackedEdit.apply(_valueBeforeTrackedEdit)\n\t*/\n\thandleEdits(edit: BaseStringEdit): void {\n\t\tconst e = edit.mapData(_d => new IsTrackedEditData(false));\n\t\tconst composedEdit = this._updatedTrackedEdit.compose(e); // (still) applies to _valueBeforeTrackedEdit\n\n\t\t// TODO@hediet improve memory by using:\n\t\t// composedEdit = const onlyTrackedEdit = composedEdit.decomposeSplit(e => !e.data.isTrackedEdit).e2;\n\n\t\tthis._updatedTrackedEdit = composedEdit;\n\t}\n\n\tgetAcceptedRestrainedCharactersCount(): number {\n\t\tconst s = sumBy(this._updatedTrackedEdit.replacements, e => e.data.isTrackedEdit ? e.getNewLength() : 0);\n\t\treturn s;\n\t}\n\n\tgetDebugState(): unknown {\n\t\treturn {\n\t\t\tedits: this._updatedTrackedEdit.replacements.map(e => ({\n\t\t\t\trange: e.replaceRange.toString(),\n\t\t\t\tnewText: e.newText,\n\t\t\t\tisTrackedEdit: e.data.isTrackedEdit,\n\t\t\t}))\n\t\t};\n\t}\n\n\tpublic getLineCountInfo(): { deletedLineCounts: number; insertedLineCounts: number } {\n\t\tconst e = this._updatedTrackedEdit.toStringEdit(r => r.data.isTrackedEdit);\n\t\tconst le = LineEdit.fromStringEdit(e, this._valueBeforeTrackedEdit);\n\t\tconst deletedLineCount = sumBy(le.replacements, r => r.lineRange.length);\n\t\tconst insertedLineCount = sumBy(le.getNewLineRanges(), r => r.length);\n\t\treturn {\n\t\t\tdeletedLineCounts: deletedLineCount,\n\t\t\tinsertedLineCounts: insertedLineCount,\n\t\t};\n\t}\n\n\tpublic getValues(): unknown {\n\t\treturn {\n\t\t\tarc: this.getAcceptedRestrainedCharactersCount(),\n\t\t\t...this.getLineCountInfo(),\n\t\t};\n\t}\n}\n\nexport class IsTrackedEditData implements IEditData<IsTrackedEditData> {\n\tconstructor(\n\t\tpublic readonly isTrackedEdit: boolean\n\t) { }\n\n\tjoin(data: IsTrackedEditData): IsTrackedEditData | undefined {\n\t\tif (this.isTrackedEdit !== data.isTrackedEdit) {\n\t\t\treturn undefined;\n\t\t}\n\t\treturn this;\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { sumBy } from '../../../../base/common/arrays.js';\nimport { LineEdit } from '../../../../editor/common/core/edits/lineEdit.js';\nimport { AnnotatedStringEdit, BaseStringEdit, IEditData } from '../../../../editor/common/core/edits/stringEdit.js';\nimport { AbstractText } from '../../../../editor/common/core/text/abstractText.js';\n\n/**\n * The ARC (accepted and retained characters) counts how many characters inserted by the initial suggestion (trackedEdit)\n * stay unmodified after a certain amount of time after acceptance.\n*/\nexport class ArcTracker {\n\tprivate _updatedTrackedEdit: AnnotatedStringEdit<IsTrackedEditData>;\n\tprivate _trackedEdit: BaseStringEdit;\n\n\tconstructor(\n\t\tprivate readonly _valueBeforeTrackedEdit: AbstractText,\n\t\ttrackedEdit: BaseStringEdit,\n\t) {\n\t\tthis._trackedEdit = trackedEdit.removeCommonSuffixPrefix(_valueBeforeTrackedEdit.getValue());\n\t\tthis._updatedTrackedEdit = this._trackedEdit.mapData(() => new IsTrackedEditData(true));\n\t}\n\n\tgetOriginalCharacterCount(): number {\n\t\treturn sumBy(this._trackedEdit.replacements, e => e.getNewLength());\n\t}\n\n\t/**\n\t * edit must apply to _updatedTrackedEdit.apply(_valueBeforeTrackedEdit)\n\t*/\n\thandleEdits(edit: BaseStringEdit): void {\n\t\tconst e = edit.mapData(_d => new IsTrackedEditData(false));\n\t\tconst composedEdit = this._updatedTrackedEdit.compose(e); // (still) applies to _valueBeforeTrackedEdit\n\n\t\t// TODO@hediet improve memory by using:\n\t\t// composedEdit = const onlyTrackedEdit = composedEdit.decomposeSplit(e => !e.data.isTrackedEdit).e2;\n\n\t\tthis._updatedTrackedEdit = composedEdit;\n\t}\n\n\tgetAcceptedRestrainedCharactersCount(): number {\n\t\tconst s = sumBy(this._updatedTrackedEdit.replacements, e => e.data.isTrackedEdit ? e.getNewLength() : 0);\n\t\treturn s;\n\t}\n\n\tgetDebugState(): unknown {\n\t\treturn {\n\t\t\tedits: this._updatedTrackedEdit.replacements.map(e => ({\n\t\t\t\trange: e.replaceRange.toString(),\n\t\t\t\tnewText: e.newText,\n\t\t\t\tisTrackedEdit: e.data.isTrackedEdit,\n\t\t\t}))\n\t\t};\n\t}\n\n\tpublic getLineCountInfo(): { deletedLineCounts: number; insertedLineCounts: number } {\n\t\tconst e = this._updatedTrackedEdit.toStringEdit(r => r.data.isTrackedEdit);\n\t\tconst le = LineEdit.fromStringEdit(e, this._valueBeforeTrackedEdit);\n\t\tconst deletedLineCount = sumBy(le.replacements, r => r.lineRange.length);\n\t\tconst insertedLineCount = sumBy(le.getNewLineRanges(), r => r.length);\n\t\treturn {\n\t\t\tdeletedLineCounts: deletedLineCount,\n\t\t\tinsertedLineCounts: insertedLineCount,\n\t\t};\n\t}\n\n\tpublic getValues(): unknown {\n\t\treturn {\n\t\t\tarc: this.getAcceptedRestrainedCharactersCount(),\n\t\t\t...this.getLineCountInfo(),\n\t\t};\n\t}\n}\n\nexport class IsTrackedEditData implements IEditData<IsTrackedEditData> {\n\tconstructor(\n\t\tpublic readonly isTrackedEdit: boolean\n\t) { }\n\n\tjoin(data: IsTrackedEditData): IsTrackedEditData | undefined {\n\t\tif (this.isTrackedEdit !== data.isTrackedEdit) {\n\t\t\treturn undefined;\n\t\t}\n\t\treturn this;\n\t}\n}\n"]}