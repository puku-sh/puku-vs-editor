{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/contrib/webviewPanel/browser/webviewWorkbenchService.ts","vs/workbench/contrib/webviewPanel/browser/webviewWorkbenchService.ts"],"names":[],"mappings":"AAAA;;;gGAGgG;;;;;;;;;;AAEhG,OAAO,EAAqB,uBAAuB,EAAE,eAAe,EAAE,MAAM,kCAAkC,CAAC;AAC/G,OAAO,EAAqB,uBAAuB,EAAE,MAAM,yCAAyC,CAAC;AACrG,OAAO,EAAE,OAAO,EAAE,MAAM,uCAAuC,CAAC;AAChE,OAAO,EAAE,mBAAmB,EAAE,MAAM,mCAAmC,CAAC;AACxE,OAAO,EAAE,OAAO,EAAS,MAAM,kCAAkC,CAAC;AAClE,OAAO,EAAE,QAAQ,EAAE,MAAM,qCAAqC,CAAC;AAC/D,OAAO,EAAE,kBAAkB,EAAE,UAAU,EAAe,YAAY,EAAE,MAAM,sCAAsC,CAAC;AACjH,OAAO,EAAE,gBAAgB,EAAE,MAAM,8CAA8C,CAAC;AAChF,OAAO,EAAE,eAAe,EAAE,qBAAqB,EAAE,MAAM,4DAA4D,CAAC;AACpH,OAAO,EAAE,aAAa,EAAE,MAAM,mDAAmD,CAAC;AAElF,OAAO,EAAE,eAAe,EAAE,MAAM,2CAA2C,CAAC;AAE5E,OAAO,EAAgB,oBAAoB,EAAE,MAAM,wDAAwD,CAAC;AAC5G,OAAO,EAAqB,cAAc,EAAmB,MAAM,kDAAkD,CAAC;AACtH,OAAO,EAAmB,eAAe,EAAmB,MAAM,kCAAkC,CAAC;AACrG,OAAO,EAAE,+BAA+B,EAAE,MAAM,oBAAoB,CAAC;AACrE,OAAO,EAAgB,YAAY,EAAwB,MAAM,yBAAyB,CAAC;AAO3F,MAAM,CAAC,MAAM,wBAAwB,GAAG,eAAe,CAA2B,sBAAsB,CAAC,CAAC;AAgF1G,SAAS,SAAS,CAAC,OAAwB,EAAE,OAAqB;IACjE,OAAO,OAAO,CAAC,UAAU,CAAC,OAAO,CAAC,CAAC;AACpC,CAAC;AAEM,IAAM,gCAAgC,GAAtC,MAAM,gCAAiC,SAAQ,YAAY;IAKjE,YACC,IAA0B,EAC1B,OAAwB,EACT,YAA2B,EAChB,wBAAmE;QAE7F,KAAK,CAAC,IAAI,EAAE,OAAO,EAAE,YAAY,CAAC,CAAC;QAFQ,6BAAwB,GAAxB,wBAAwB,CAA0B;QAPtF,cAAS,GAAG,KAAK,CAAC;IAU1B,CAAC;IAEQ,OAAO;QACf,KAAK,CAAC,OAAO,EAAE,CAAC;QAChB,IAAI,CAAC,eAAe,EAAE,MAAM,EAAE,CAAC;QAC/B,IAAI,CAAC,eAAe,GAAG,SAAS,CAAC;IAClC,CAAC;IAGe,AAAM,KAAD,CAAC,OAAO;QAC5B,IAAI,CAAC,IAAI,CAAC,SAAS,EAAE,CAAC;YACrB,IAAI,CAAC,SAAS,GAAG,IAAI,CAAC;YACtB,IAAI,CAAC,eAAe,GAAG,uBAAuB,CAAC,KAAK,CAAC,EAAE,CAAC,IAAI,CAAC,wBAAwB,CAAC,cAAc,CAAC,IAAI,EAAE,KAAK,CAAC,CAAC,CAAC;YACnH,IAAI,CAAC;gBACJ,MAAM,IAAI,CAAC,eAAe,CAAC;YAC5B,CAAC;YAAC,OAAO,CAAC,EAAE,CAAC;gBACZ,IAAI,CAAC,mBAAmB,CAAC,CAAC,CAAC,EAAE,CAAC;oBAC7B,MAAM,CAAC,CAAC;gBACT,CAAC;YACF,CAAC;QACF,CAAC;QACD,OAAO,KAAK,CAAC,OAAO,EAAE,CAAC;IACxB,CAAC;IAEkB,QAAQ,CAAC,KAAuC;QAClE,IAAI,CAAC,KAAK,CAAC,QAAQ,CAAC,KAAK,CAAC,EAAE,CAAC;YAC5B,OAAO;QACR,CAAC;QAED,KAAK,CAAC,SAAS,GAAG,IAAI,CAAC,SAAS,CAAC;QACjC,OAAO,KAAK,CAAC;IACd,CAAC;CACD,CAAA;AAvBsB;IADrB,OAAO;+DAcP;AAlCW,gCAAgC;IAQ1C,WAAA,aAAa,CAAA;IACb,WAAA,wBAAwB,CAAA;GATd,gCAAgC,CA4C5C;;AAGD,MAAM,WAAW;IAAjB;QACS,qBAAgB,GAInB,EAAE,CAAC;IAmCT,CAAC;IAjCO,qBAAqB,CAAC,KAAmB,EAAE,KAAwB;QACzE,MAAM,OAAO,GAAG,IAAI,eAAe,EAAQ,CAAC;QAE5C,MAAM,MAAM,GAAG,GAAG,EAAE;YACnB,MAAM,KAAK,GAAG,IAAI,CAAC,gBAAgB,CAAC,SAAS,CAAC,KAAK,CAAC,EAAE,CAAC,KAAK,KAAK,KAAK,CAAC,KAAK,CAAC,CAAC;YAC9E,IAAI,KAAK,IAAI,CAAC,EAAE,CAAC;gBAChB,IAAI,CAAC,gBAAgB,CAAC,MAAM,CAAC,KAAK,EAAE,CAAC,CAAC,CAAC;YACxC,CAAC;QACF,CAAC,CAAC;QAEF,MAAM,UAAU,GAAG,kBAAkB,CACpC,KAAK,CAAC,OAAO,CAAC,YAAY,CAAC,MAAM,CAAC,EAClC,KAAK,CAAC,uBAAuB,CAAC,GAAG,EAAE;YAClC,MAAM,EAAE,CAAC;YACT,OAAO,CAAC,MAAM,EAAE,CAAC;QAClB,CAAC,CAAC,CACF,CAAC;QAEF,IAAI,CAAC,gBAAgB,CAAC,IAAI,CAAC,EAAE,KAAK,EAAE,OAAO,EAAE,UAAU,EAAE,CAAC,CAAC;QAE3D,OAAO,OAAO,CAAC,CAAC,CAAC;IAClB,CAAC;IAEM,SAAS,CAAC,OAAwB,EAAE,KAAwB;QAClE,MAAM,QAAQ,GAAG,IAAI,CAAC,gBAAgB,CAAC,MAAM,CAAC,CAAC,EAAE,KAAK,EAAE,EAAE,EAAE,CAAC,SAAS,CAAC,OAAO,EAAE,KAAK,CAAC,CAAC,CAAC;QACxF,IAAI,CAAC,gBAAgB,GAAG,IAAI,CAAC,gBAAgB,CAAC,MAAM,CAAC,CAAC,EAAE,KAAK,EAAE,EAAE,EAAE,CAAC,CAAC,SAAS,CAAC,OAAO,EAAE,KAAK,CAAC,CAAC,CAAC;QAEhG,KAAK,MAAM,EAAE,KAAK,EAAE,OAAO,EAAE,OAAO,EAAE,UAAU,EAAE,IAAI,QAAQ,EAAE,CAAC;YAChE,OAAO,CAAC,cAAc,CAAC,KAAK,EAAE,KAAK,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,CAAC,OAAO,CAAC,QAAQ,CAAC,CAAC,CAAC,EAAE,GAAG,CAAC,EAAE,CAAC,OAAO,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,OAAO,CAAC,GAAG,EAAE;gBAC3G,UAAU,CAAC,OAAO,EAAE,CAAC;YACtB,CAAC,CAAC,CAAC;QACJ,CAAC;IACF,CAAC;CACD;AAGM,IAAM,oBAAoB,GAA1B,MAAM,oBAAqB,SAAQ,UAAU;IAMnD,YACuB,mBAAyC,EAC/C,cAA+C,EACxC,qBAA6D,EACnE,eAAiD;QAElE,KAAK,EAAE,CAAC;QAJyB,mBAAc,GAAd,cAAc,CAAgB;QACvB,0BAAqB,GAArB,qBAAqB,CAAuB;QAClD,oBAAe,GAAf,eAAe,CAAiB;QAPlD,cAAS,GAAG,IAAI,GAAG,EAAmB,CAAC;QACvC,iBAAY,GAAG,IAAI,WAAW,EAAE,CAAC;QA6BjC,oCAA+B,GAAG,IAAI,CAAC,SAAS,CAAC,IAAI,OAAO,EAA4B,CAAC,CAAC;QAC3F,mCAA8B,GAAG,IAAI,CAAC,+BAA+B,CAAC,KAAK,CAAC;QApB3F,IAAI,CAAC,SAAS,CAAC,mBAAmB,CAAC,0BAA0B,CAAC;YAC7D,UAAU,EAAE,+BAA+B;YAC3C,uBAAuB,EAAE,CAAC,KAAK,EAAE,EAAE,CAAC,IAAI,CAAC,YAAY,CAAC,KAAK,CAAC,YAAY,CAAC;SACzE,CAAC,CAAC,CAAC;QAEJ,IAAI,CAAC,SAAS,CAAC,cAAc,CAAC,uBAAuB,CAAC,GAAG,EAAE;YAC1D,IAAI,CAAC,mBAAmB,EAAE,CAAC;QAC5B,CAAC,CAAC,CAAC,CAAC;QAEJ,sEAAsE;QACtE,IAAI,CAAC,SAAS,CAAC,eAAe,CAAC,wBAAwB,CAAC,GAAG,EAAE;YAC5D,IAAI,CAAC,mBAAmB,EAAE,CAAC;QAC5B,CAAC,CAAC,CAAC,CAAC;QAEJ,IAAI,CAAC,mBAAmB,EAAE,CAAC;IAC5B,CAAC;IAOO,YAAY,CAAC,KAAyB;QAC7C,IAAI,YAAsC,CAAC;QAC3C,IAAI,KAAK,YAAY,YAAY,EAAE,CAAC;YACnC,YAAY,GAAG,KAAK,CAAC;QACtB,CAAC;aAAM,IAAI,KAAK,YAAY,eAAe,EAAE,CAAC;YAC7C,IAAI,KAAK,CAAC,OAAO,YAAY,YAAY,EAAE,CAAC;gBAC3C,YAAY,GAAG,KAAK,CAAC,OAAO,CAAC;YAC9B,CAAC;iBAAM,IAAI,KAAK,CAAC,SAAS,YAAY,YAAY,EAAE,CAAC;gBACpD,YAAY,GAAG,KAAK,CAAC,SAAS,CAAC;YAChC,CAAC;QACF,CAAC;QAED,OAAO,YAAY,EAAE,OAAO,CAAC,gBAAgB,IAAI,EAAE,CAAC;IACrD,CAAC;IAEO,mBAAmB;QAC1B,MAAM,WAAW,GAAG,IAAI,CAAC,cAAc,CAAC,YAAY,CAAC;QAErD,IAAI,gBAA0C,CAAC;QAC/C,IAAI,WAAW,YAAY,YAAY,EAAE,CAAC;YACzC,gBAAgB,GAAG,WAAW,CAAC;QAChC,CAAC;aAAM,IAAI,WAAW,YAAY,eAAe,EAAE,CAAC;YACnD,IAAI,WAAW,CAAC,OAAO,YAAY,YAAY,IAAI,WAAW,CAAC,OAAO,CAAC,OAAO,KAAK,IAAI,CAAC,eAAe,CAAC,aAAa,EAAE,CAAC;gBACvH,gBAAgB,GAAG,WAAW,CAAC,OAAO,CAAC;YACxC,CAAC;iBAAM,IAAI,WAAW,CAAC,SAAS,YAAY,YAAY,IAAI,WAAW,CAAC,SAAS,CAAC,OAAO,KAAK,IAAI,CAAC,eAAe,CAAC,aAAa,EAAE,CAAC;gBAClI,gBAAgB,GAAG,WAAW,CAAC,SAAS,CAAC;YAC1C,CAAC;QACF,CAAC;QACD,IAAI,gBAAgB,KAAK,IAAI,CAAC,cAAc,EAAE,CAAC;YAC9C,IAAI,CAAC,cAAc,GAAG,gBAAgB,CAAC;YACvC,IAAI,CAAC,+BAA+B,CAAC,IAAI,CAAC,gBAAgB,CAAC,CAAC;QAC7D,CAAC;IACF,CAAC;IAEM,WAAW,CACjB,eAAgC,EAChC,QAAgB,EAChB,KAAa,EACb,QAAkC,EAClC,WAAgC;QAEhC,MAAM,OAAO,GAAG,IAAI,CAAC,eAAe,CAAC,oBAAoB,CAAC,eAAe,CAAC,CAAC;QAC3E,MAAM,YAAY,GAAG,IAAI,CAAC,qBAAqB,CAAC,cAAc,CAAC,YAAY,EAAE,EAAE,QAAQ,EAAE,IAAI,EAAE,KAAK,EAAE,UAAU,EAAE,eAAe,CAAC,gBAAgB,EAAE,QAAQ,EAAE,EAAE,OAAO,CAAC,CAAC;QACzK,IAAI,CAAC,cAAc,CAAC,UAAU,CAAC,YAAY,EAAE;YAC5C,MAAM,EAAE,IAAI;YACZ,aAAa,EAAE,WAAW,CAAC,aAAa;YACxC,gFAAgF;YAChF,8FAA8F;YAC9F,UAAU,EAAE,WAAW,CAAC,aAAa,CAAC,CAAC,CAAC,gBAAgB,CAAC,OAAO,CAAC,CAAC,CAAC,SAAS;SAC5E,EAAE,WAAW,CAAC,KAAK,CAAC,CAAC;QACtB,OAAO,YAAY,CAAC;IACrB,CAAC;IAEM,aAAa,CACnB,OAAqB,EACrB,KAA2E,EAC3E,aAAsB;QAEtB,MAAM,cAAc,GAAG,IAAI,CAAC,4BAA4B,CAAC,OAAO,CAAC,CAAC;QAElE,IAAI,CAAC,cAAc,CAAC,UAAU,CAAC,cAAc,EAAE;YAC9C,aAAa;YACb,gFAAgF;YAChF,8FAA8F;YAC9F,UAAU,EAAE,aAAa,CAAC,CAAC,CAAC,gBAAgB,CAAC,OAAO,CAAC,CAAC,CAAC,SAAS;SAChE,EAAE,KAAK,CAAC,CAAC;IACX,CAAC;IAEO,4BAA4B,CAAC,OAAqB;QACzD,KAAK,MAAM,MAAM,IAAI,IAAI,CAAC,cAAc,CAAC,OAAO,EAAE,CAAC;YAClD,IAAI,MAAM,KAAK,OAAO,EAAE,CAAC;gBACxB,OAAO,MAAM,CAAC;YACf,CAAC;YACD,IAAI,MAAM,YAAY,eAAe,EAAE,CAAC;gBACvC,IAAI,OAAO,KAAK,MAAM,CAAC,OAAO,IAAI,OAAO,KAAK,MAAM,CAAC,SAAS,EAAE,CAAC;oBAChE,OAAO,MAAM,CAAC;gBACf,CAAC;YACF,CAAC;QACF,CAAC;QACD,OAAO,OAAO,CAAC;IAChB,CAAC;IAEM,kBAAkB,CAAC,OAOzB;QACA,MAAM,OAAO,GAAG,IAAI,CAAC,eAAe,CAAC,oBAAoB,CAAC,OAAO,CAAC,eAAe,CAAC,CAAC;QACnF,OAAO,CAAC,KAAK,GAAG,OAAO,CAAC,KAAK,CAAC;QAE9B,MAAM,YAAY,GAAG,IAAI,CAAC,qBAAqB,CAAC,cAAc,CAAC,gCAAgC,EAAE;YAChG,QAAQ,EAAE,OAAO,CAAC,QAAQ;YAC1B,UAAU,EAAE,OAAO,CAAC,eAAe,CAAC,gBAAgB;YACpD,IAAI,EAAE,OAAO,CAAC,KAAK;YACnB,QAAQ,EAAE,OAAO,CAAC,QAAQ;SAC1B,EAAE,OAAO,CAAC,CAAC;QACZ,YAAY,CAAC,QAAQ,GAAG,OAAO,CAAC,QAAQ,CAAC;QAEzC,IAAI,OAAO,OAAO,CAAC,KAAK,KAAK,QAAQ,EAAE,CAAC;YACvC,YAAY,CAAC,WAAW,CAAC,OAAO,CAAC,KAAK,CAAC,CAAC;QACzC,CAAC;QACD,OAAO,YAAY,CAAC;IACrB,CAAC;IAEM,gBAAgB,CAAC,OAAwB;QAC/C,IAAI,CAAC,SAAS,CAAC,GAAG,CAAC,OAAO,CAAC,CAAC;QAE5B,MAAM,GAAG,GAAG,IAAI,uBAAuB,EAAE,CAAC;QAC1C,IAAI,CAAC,YAAY,CAAC,SAAS,CAAC,OAAO,EAAE,GAAG,CAAC,KAAK,CAAC,CAAC;QAEhD,OAAO,YAAY,CAAC,GAAG,EAAE;YACxB,IAAI,CAAC,SAAS,CAAC,MAAM,CAAC,OAAO,CAAC,CAAC;YAC/B,GAAG,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC;QACnB,CAAC,CAAC,CAAC;IACJ,CAAC;IAEM,aAAa,CAAC,OAAqB;QACzC,iGAAiG;QACjG,2DAA2D;QAC3D,IAAI,OAAO,YAAY,gCAAgC,EAAE,CAAC;YACzD,OAAO,IAAI,CAAC;QACb,CAAC;QAED,OAAO,QAAQ,CAAC,IAAI,CAAC,IAAI,CAAC,SAAS,CAAC,MAAM,EAAE,EAAE,OAAO,CAAC,EAAE,CAAC,SAAS,CAAC,OAAO,EAAE,OAAO,CAAC,CAAC,CAAC;IACvF,CAAC;IAEO,KAAK,CAAC,SAAS,CAAC,OAAqB,EAAE,KAAwB;QACtE,KAAK,MAAM,OAAO,IAAI,IAAI,CAAC,SAAS,CAAC,MAAM,EAAE,EAAE,CAAC;YAC/C,IAAI,SAAS,CAAC,OAAO,EAAE,OAAO,CAAC,EAAE,CAAC;gBACjC,MAAM,OAAO,CAAC,cAAc,CAAC,OAAO,EAAE,KAAK,CAAC,CAAC;gBAC7C,OAAO,IAAI,CAAC;YACb,CAAC;QACF,CAAC;QACD,OAAO,KAAK,CAAC;IACd,CAAC;IAEM,KAAK,CAAC,cAAc,CAAC,OAAqB,EAAE,KAAwB;QAC1E,MAAM,SAAS,GAAG,MAAM,IAAI,CAAC,SAAS,CAAC,OAAO,EAAE,KAAK,CAAC,CAAC;QACvD,IAAI,CAAC,SAAS,IAAI,CAAC,KAAK,CAAC,uBAAuB,EAAE,CAAC;YAClD,4FAA4F;YAC5F,OAAO,IAAI,CAAC,YAAY,CAAC,qBAAqB,CAAC,OAAO,EAAE,KAAK,CAAC,CAAC;QAChE,CAAC;IACF,CAAC;CACD,CAAA;AAtLY,oBAAoB;IAO9B,WAAA,oBAAoB,CAAA;IACpB,WAAA,cAAc,CAAA;IACd,WAAA,qBAAqB,CAAA;IACrB,WAAA,eAAe,CAAA;GAVL,oBAAoB,CAsLhC","file":"webviewWorkbenchService.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { CancelablePromise, createCancelablePromise, DeferredPromise } from '../../../../base/common/async.js';\nimport { CancellationToken, CancellationTokenSource } from '../../../../base/common/cancellation.js';\nimport { memoize } from '../../../../base/common/decorators.js';\nimport { isCancellationError } from '../../../../base/common/errors.js';\nimport { Emitter, Event } from '../../../../base/common/event.js';\nimport { Iterable } from '../../../../base/common/iterator.js';\nimport { combinedDisposable, Disposable, IDisposable, toDisposable } from '../../../../base/common/lifecycle.js';\nimport { EditorActivation } from '../../../../platform/editor/common/editor.js';\nimport { createDecorator, IInstantiationService } from '../../../../platform/instantiation/common/instantiation.js';\nimport { IThemeService } from '../../../../platform/theme/common/themeService.js';\nimport { GroupIdentifier } from '../../../common/editor.js';\nimport { DiffEditorInput } from '../../../common/editor/diffEditorInput.js';\nimport { EditorInput } from '../../../common/editor/editorInput.js';\nimport { IEditorGroup, IEditorGroupsService } from '../../../services/editor/common/editorGroupsService.js';\nimport { ACTIVE_GROUP_TYPE, IEditorService, SIDE_GROUP_TYPE } from '../../../services/editor/common/editorService.js';\nimport { IOverlayWebview, IWebviewService, WebviewInitInfo } from '../../webview/browser/webview.js';\nimport { CONTEXT_ACTIVE_WEBVIEW_PANEL_ID } from './webviewEditor.js';\nimport { WebviewIcons, WebviewInput, WebviewInputInitInfo } from './webviewEditorInput.js';\n\nexport interface IWebViewShowOptions {\n\treadonly group?: IEditorGroup | GroupIdentifier | ACTIVE_GROUP_TYPE | SIDE_GROUP_TYPE;\n\treadonly preserveFocus?: boolean;\n}\n\nexport const IWebviewWorkbenchService = createDecorator<IWebviewWorkbenchService>('webviewEditorService');\n\n/**\n * Service responsible for showing and managing webview editors in the workbench.\n */\nexport interface IWebviewWorkbenchService {\n\treadonly _serviceBrand: undefined;\n\n\t/**\n\t * Event fired when focus switches to a different webview editor.\n\t *\n\t * Fires `undefined` if focus switches to a non-webview editor.\n\t */\n\treadonly onDidChangeActiveWebviewEditor: Event<WebviewInput | undefined>;\n\n\t/**\n\t * Create a new webview editor and open it in the workbench.\n\t */\n\topenWebview(\n\t\twebviewInitInfo: WebviewInitInfo,\n\t\tviewType: string,\n\t\ttitle: string,\n\t\ticonPath: WebviewIcons | undefined,\n\t\tshowOptions: IWebViewShowOptions,\n\t): WebviewInput;\n\n\t/**\n\t * Open a webview that is being restored from serialization.\n\t */\n\topenRevivedWebview(options: {\n\t\twebviewInitInfo: WebviewInitInfo;\n\t\tviewType: string;\n\t\ttitle: string;\n\t\ticonPath: WebviewIcons | undefined;\n\t\tstate: any;\n\t\tgroup: number | undefined;\n\t}): WebviewInput;\n\n\t/**\n\t * Reveal an already opened webview editor in the workbench.\n\t */\n\trevealWebview(\n\t\twebview: WebviewInput,\n\t\tgroup: IEditorGroup | GroupIdentifier | ACTIVE_GROUP_TYPE | SIDE_GROUP_TYPE,\n\t\tpreserveFocus: boolean\n\t): void;\n\n\t/**\n\t * Register a new {@link WebviewResolver}.\n\t *\n\t * If there are any webviews awaiting revival that this resolver can handle, they will be resolved by it.\n\t */\n\tregisterResolver(resolver: WebviewResolver): IDisposable;\n\n\t/**\n\t * Check if a webview should be serialized across window reloads.\n\t */\n\tshouldPersist(input: WebviewInput): boolean;\n\n\t/**\n\t * Try to resolve a webview. This will block until a resolver is registered for the webview.\n\t */\n\tresolveWebview(webview: WebviewInput, token: CancellationToken): Promise<void>;\n}\n\n/**\n * Handles filling in the content of webview before it can be shown to the user.\n */\ninterface WebviewResolver {\n\t/**\n\t * Returns true if the resolver can resolve the given webview.\n\t */\n\tcanResolve(webview: WebviewInput): boolean;\n\n\t/**\n\t * Resolves the webview.\n\t */\n\tresolveWebview(webview: WebviewInput, token: CancellationToken): Promise<void>;\n}\n\nfunction canRevive(reviver: WebviewResolver, webview: WebviewInput): boolean {\n\treturn reviver.canResolve(webview);\n}\n\nexport class LazilyResolvedWebviewEditorInput extends WebviewInput {\n\n\tprivate _resolved = false;\n\tprivate _resolvePromise?: CancelablePromise<void>;\n\n\tconstructor(\n\t\tinit: WebviewInputInitInfo,\n\t\twebview: IOverlayWebview,\n\t\t@IThemeService themeService: IThemeService,\n\t\t@IWebviewWorkbenchService private readonly _webviewWorkbenchService: IWebviewWorkbenchService,\n\t) {\n\t\tsuper(init, webview, themeService);\n\t}\n\n\toverride dispose() {\n\t\tsuper.dispose();\n\t\tthis._resolvePromise?.cancel();\n\t\tthis._resolvePromise = undefined;\n\t}\n\n\t@memoize\n\tpublic override async resolve() {\n\t\tif (!this._resolved) {\n\t\t\tthis._resolved = true;\n\t\t\tthis._resolvePromise = createCancelablePromise(token => this._webviewWorkbenchService.resolveWebview(this, token));\n\t\t\ttry {\n\t\t\t\tawait this._resolvePromise;\n\t\t\t} catch (e) {\n\t\t\t\tif (!isCancellationError(e)) {\n\t\t\t\t\tthrow e;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn super.resolve();\n\t}\n\n\tprotected override transfer(other: LazilyResolvedWebviewEditorInput): WebviewInput | undefined {\n\t\tif (!super.transfer(other)) {\n\t\t\treturn;\n\t\t}\n\n\t\tother._resolved = this._resolved;\n\t\treturn other;\n\t}\n}\n\n\nclass RevivalPool {\n\tprivate _awaitingRevival: Array<{\n\t\treadonly input: WebviewInput;\n\t\treadonly promise: DeferredPromise<void>;\n\t\treadonly disposable: IDisposable;\n\t}> = [];\n\n\tpublic enqueueForRestoration(input: WebviewInput, token: CancellationToken): Promise<void> {\n\t\tconst promise = new DeferredPromise<void>();\n\n\t\tconst remove = () => {\n\t\t\tconst index = this._awaitingRevival.findIndex(entry => input === entry.input);\n\t\t\tif (index >= 0) {\n\t\t\t\tthis._awaitingRevival.splice(index, 1);\n\t\t\t}\n\t\t};\n\n\t\tconst disposable = combinedDisposable(\n\t\t\tinput.webview.onDidDispose(remove),\n\t\t\ttoken.onCancellationRequested(() => {\n\t\t\t\tremove();\n\t\t\t\tpromise.cancel();\n\t\t\t}),\n\t\t);\n\n\t\tthis._awaitingRevival.push({ input, promise, disposable });\n\n\t\treturn promise.p;\n\t}\n\n\tpublic reviveFor(reviver: WebviewResolver, token: CancellationToken) {\n\t\tconst toRevive = this._awaitingRevival.filter(({ input }) => canRevive(reviver, input));\n\t\tthis._awaitingRevival = this._awaitingRevival.filter(({ input }) => !canRevive(reviver, input));\n\n\t\tfor (const { input, promise: resolve, disposable } of toRevive) {\n\t\t\treviver.resolveWebview(input, token).then(x => resolve.complete(x), err => resolve.error(err)).finally(() => {\n\t\t\t\tdisposable.dispose();\n\t\t\t});\n\t\t}\n\t}\n}\n\n\nexport class WebviewEditorService extends Disposable implements IWebviewWorkbenchService {\n\tdeclare readonly _serviceBrand: undefined;\n\n\tprivate readonly _revivers = new Set<WebviewResolver>();\n\tprivate readonly _revivalPool = new RevivalPool();\n\n\tconstructor(\n\t\t@IEditorGroupsService editorGroupsService: IEditorGroupsService,\n\t\t@IEditorService private readonly _editorService: IEditorService,\n\t\t@IInstantiationService private readonly _instantiationService: IInstantiationService,\n\t\t@IWebviewService private readonly _webviewService: IWebviewService,\n\t) {\n\t\tsuper();\n\n\t\tthis._register(editorGroupsService.registerContextKeyProvider({\n\t\t\tcontextKey: CONTEXT_ACTIVE_WEBVIEW_PANEL_ID,\n\t\t\tgetGroupContextKeyValue: (group) => this.getWebviewId(group.activeEditor),\n\t\t}));\n\n\t\tthis._register(_editorService.onDidActiveEditorChange(() => {\n\t\t\tthis.updateActiveWebview();\n\t\t}));\n\n\t\t// The user may have switched focus between two sides of a diff editor\n\t\tthis._register(_webviewService.onDidChangeActiveWebview(() => {\n\t\t\tthis.updateActiveWebview();\n\t\t}));\n\n\t\tthis.updateActiveWebview();\n\t}\n\n\tprivate _activeWebview: WebviewInput | undefined;\n\n\tprivate readonly _onDidChangeActiveWebviewEditor = this._register(new Emitter<WebviewInput | undefined>());\n\tpublic readonly onDidChangeActiveWebviewEditor = this._onDidChangeActiveWebviewEditor.event;\n\n\tprivate getWebviewId(input: EditorInput | null): string {\n\t\tlet webviewInput: WebviewInput | undefined;\n\t\tif (input instanceof WebviewInput) {\n\t\t\twebviewInput = input;\n\t\t} else if (input instanceof DiffEditorInput) {\n\t\t\tif (input.primary instanceof WebviewInput) {\n\t\t\t\twebviewInput = input.primary;\n\t\t\t} else if (input.secondary instanceof WebviewInput) {\n\t\t\t\twebviewInput = input.secondary;\n\t\t\t}\n\t\t}\n\n\t\treturn webviewInput?.webview.providedViewType ?? '';\n\t}\n\n\tprivate updateActiveWebview() {\n\t\tconst activeInput = this._editorService.activeEditor;\n\n\t\tlet newActiveWebview: WebviewInput | undefined;\n\t\tif (activeInput instanceof WebviewInput) {\n\t\t\tnewActiveWebview = activeInput;\n\t\t} else if (activeInput instanceof DiffEditorInput) {\n\t\t\tif (activeInput.primary instanceof WebviewInput && activeInput.primary.webview === this._webviewService.activeWebview) {\n\t\t\t\tnewActiveWebview = activeInput.primary;\n\t\t\t} else if (activeInput.secondary instanceof WebviewInput && activeInput.secondary.webview === this._webviewService.activeWebview) {\n\t\t\t\tnewActiveWebview = activeInput.secondary;\n\t\t\t}\n\t\t}\n\t\tif (newActiveWebview !== this._activeWebview) {\n\t\t\tthis._activeWebview = newActiveWebview;\n\t\t\tthis._onDidChangeActiveWebviewEditor.fire(newActiveWebview);\n\t\t}\n\t}\n\n\tpublic openWebview(\n\t\twebviewInitInfo: WebviewInitInfo,\n\t\tviewType: string,\n\t\ttitle: string,\n\t\ticonPath: WebviewIcons | undefined,\n\t\tshowOptions: IWebViewShowOptions,\n\t): WebviewInput {\n\t\tconst webview = this._webviewService.createWebviewOverlay(webviewInitInfo);\n\t\tconst webviewInput = this._instantiationService.createInstance(WebviewInput, { viewType, name: title, providedId: webviewInitInfo.providedViewType, iconPath }, webview);\n\t\tthis._editorService.openEditor(webviewInput, {\n\t\t\tpinned: true,\n\t\t\tpreserveFocus: showOptions.preserveFocus,\n\t\t\t// preserve pre 1.38 behaviour to not make group active when preserveFocus: true\n\t\t\t// but make sure to restore the editor to fix https://github.com/microsoft/vscode/issues/79633\n\t\t\tactivation: showOptions.preserveFocus ? EditorActivation.RESTORE : undefined\n\t\t}, showOptions.group);\n\t\treturn webviewInput;\n\t}\n\n\tpublic revealWebview(\n\t\twebview: WebviewInput,\n\t\tgroup: IEditorGroup | GroupIdentifier | ACTIVE_GROUP_TYPE | SIDE_GROUP_TYPE,\n\t\tpreserveFocus: boolean\n\t): void {\n\t\tconst topLevelEditor = this.findTopLevelEditorForWebview(webview);\n\n\t\tthis._editorService.openEditor(topLevelEditor, {\n\t\t\tpreserveFocus,\n\t\t\t// preserve pre 1.38 behaviour to not make group active when preserveFocus: true\n\t\t\t// but make sure to restore the editor to fix https://github.com/microsoft/vscode/issues/79633\n\t\t\tactivation: preserveFocus ? EditorActivation.RESTORE : undefined\n\t\t}, group);\n\t}\n\n\tprivate findTopLevelEditorForWebview(webview: WebviewInput): EditorInput {\n\t\tfor (const editor of this._editorService.editors) {\n\t\t\tif (editor === webview) {\n\t\t\t\treturn editor;\n\t\t\t}\n\t\t\tif (editor instanceof DiffEditorInput) {\n\t\t\t\tif (webview === editor.primary || webview === editor.secondary) {\n\t\t\t\t\treturn editor;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn webview;\n\t}\n\n\tpublic openRevivedWebview(options: {\n\t\twebviewInitInfo: WebviewInitInfo;\n\t\tviewType: string;\n\t\ttitle: string;\n\t\ticonPath: WebviewIcons | undefined;\n\t\tstate: any;\n\t\tgroup: number | undefined;\n\t}): WebviewInput {\n\t\tconst webview = this._webviewService.createWebviewOverlay(options.webviewInitInfo);\n\t\twebview.state = options.state;\n\n\t\tconst webviewInput = this._instantiationService.createInstance(LazilyResolvedWebviewEditorInput, {\n\t\t\tviewType: options.viewType,\n\t\t\tprovidedId: options.webviewInitInfo.providedViewType,\n\t\t\tname: options.title,\n\t\t\ticonPath: options.iconPath\n\t\t}, webview);\n\t\twebviewInput.iconPath = options.iconPath;\n\n\t\tif (typeof options.group === 'number') {\n\t\t\twebviewInput.updateGroup(options.group);\n\t\t}\n\t\treturn webviewInput;\n\t}\n\n\tpublic registerResolver(reviver: WebviewResolver): IDisposable {\n\t\tthis._revivers.add(reviver);\n\n\t\tconst cts = new CancellationTokenSource();\n\t\tthis._revivalPool.reviveFor(reviver, cts.token);\n\n\t\treturn toDisposable(() => {\n\t\t\tthis._revivers.delete(reviver);\n\t\t\tcts.dispose(true);\n\t\t});\n\t}\n\n\tpublic shouldPersist(webview: WebviewInput): boolean {\n\t\t// Revived webviews may not have an actively registered reviver but we still want to persist them\n\t\t// since a reviver should exist when it is actually needed.\n\t\tif (webview instanceof LazilyResolvedWebviewEditorInput) {\n\t\t\treturn true;\n\t\t}\n\n\t\treturn Iterable.some(this._revivers.values(), reviver => canRevive(reviver, webview));\n\t}\n\n\tprivate async tryRevive(webview: WebviewInput, token: CancellationToken): Promise<boolean> {\n\t\tfor (const reviver of this._revivers.values()) {\n\t\t\tif (canRevive(reviver, webview)) {\n\t\t\t\tawait reviver.resolveWebview(webview, token);\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t}\n\n\tpublic async resolveWebview(webview: WebviewInput, token: CancellationToken): Promise<void> {\n\t\tconst didRevive = await this.tryRevive(webview, token);\n\t\tif (!didRevive && !token.isCancellationRequested) {\n\t\t\t// A reviver may not be registered yet. Put into pool and resolve promise when we can revive\n\t\t\treturn this._revivalPool.enqueueForRestoration(webview, token);\n\t\t}\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { CancelablePromise, createCancelablePromise, DeferredPromise } from '../../../../base/common/async.js';\nimport { CancellationToken, CancellationTokenSource } from '../../../../base/common/cancellation.js';\nimport { memoize } from '../../../../base/common/decorators.js';\nimport { isCancellationError } from '../../../../base/common/errors.js';\nimport { Emitter, Event } from '../../../../base/common/event.js';\nimport { Iterable } from '../../../../base/common/iterator.js';\nimport { combinedDisposable, Disposable, IDisposable, toDisposable } from '../../../../base/common/lifecycle.js';\nimport { EditorActivation } from '../../../../platform/editor/common/editor.js';\nimport { createDecorator, IInstantiationService } from '../../../../platform/instantiation/common/instantiation.js';\nimport { IThemeService } from '../../../../platform/theme/common/themeService.js';\nimport { GroupIdentifier } from '../../../common/editor.js';\nimport { DiffEditorInput } from '../../../common/editor/diffEditorInput.js';\nimport { EditorInput } from '../../../common/editor/editorInput.js';\nimport { IEditorGroup, IEditorGroupsService } from '../../../services/editor/common/editorGroupsService.js';\nimport { ACTIVE_GROUP_TYPE, IEditorService, SIDE_GROUP_TYPE } from '../../../services/editor/common/editorService.js';\nimport { IOverlayWebview, IWebviewService, WebviewInitInfo } from '../../webview/browser/webview.js';\nimport { CONTEXT_ACTIVE_WEBVIEW_PANEL_ID } from './webviewEditor.js';\nimport { WebviewIcons, WebviewInput, WebviewInputInitInfo } from './webviewEditorInput.js';\n\nexport interface IWebViewShowOptions {\n\treadonly group?: IEditorGroup | GroupIdentifier | ACTIVE_GROUP_TYPE | SIDE_GROUP_TYPE;\n\treadonly preserveFocus?: boolean;\n}\n\nexport const IWebviewWorkbenchService = createDecorator<IWebviewWorkbenchService>('webviewEditorService');\n\n/**\n * Service responsible for showing and managing webview editors in the workbench.\n */\nexport interface IWebviewWorkbenchService {\n\treadonly _serviceBrand: undefined;\n\n\t/**\n\t * Event fired when focus switches to a different webview editor.\n\t *\n\t * Fires `undefined` if focus switches to a non-webview editor.\n\t */\n\treadonly onDidChangeActiveWebviewEditor: Event<WebviewInput | undefined>;\n\n\t/**\n\t * Create a new webview editor and open it in the workbench.\n\t */\n\topenWebview(\n\t\twebviewInitInfo: WebviewInitInfo,\n\t\tviewType: string,\n\t\ttitle: string,\n\t\ticonPath: WebviewIcons | undefined,\n\t\tshowOptions: IWebViewShowOptions,\n\t): WebviewInput;\n\n\t/**\n\t * Open a webview that is being restored from serialization.\n\t */\n\topenRevivedWebview(options: {\n\t\twebviewInitInfo: WebviewInitInfo;\n\t\tviewType: string;\n\t\ttitle: string;\n\t\ticonPath: WebviewIcons | undefined;\n\t\tstate: any;\n\t\tgroup: number | undefined;\n\t}): WebviewInput;\n\n\t/**\n\t * Reveal an already opened webview editor in the workbench.\n\t */\n\trevealWebview(\n\t\twebview: WebviewInput,\n\t\tgroup: IEditorGroup | GroupIdentifier | ACTIVE_GROUP_TYPE | SIDE_GROUP_TYPE,\n\t\tpreserveFocus: boolean\n\t): void;\n\n\t/**\n\t * Register a new {@link WebviewResolver}.\n\t *\n\t * If there are any webviews awaiting revival that this resolver can handle, they will be resolved by it.\n\t */\n\tregisterResolver(resolver: WebviewResolver): IDisposable;\n\n\t/**\n\t * Check if a webview should be serialized across window reloads.\n\t */\n\tshouldPersist(input: WebviewInput): boolean;\n\n\t/**\n\t * Try to resolve a webview. This will block until a resolver is registered for the webview.\n\t */\n\tresolveWebview(webview: WebviewInput, token: CancellationToken): Promise<void>;\n}\n\n/**\n * Handles filling in the content of webview before it can be shown to the user.\n */\ninterface WebviewResolver {\n\t/**\n\t * Returns true if the resolver can resolve the given webview.\n\t */\n\tcanResolve(webview: WebviewInput): boolean;\n\n\t/**\n\t * Resolves the webview.\n\t */\n\tresolveWebview(webview: WebviewInput, token: CancellationToken): Promise<void>;\n}\n\nfunction canRevive(reviver: WebviewResolver, webview: WebviewInput): boolean {\n\treturn reviver.canResolve(webview);\n}\n\nexport class LazilyResolvedWebviewEditorInput extends WebviewInput {\n\n\tprivate _resolved = false;\n\tprivate _resolvePromise?: CancelablePromise<void>;\n\n\tconstructor(\n\t\tinit: WebviewInputInitInfo,\n\t\twebview: IOverlayWebview,\n\t\t@IThemeService themeService: IThemeService,\n\t\t@IWebviewWorkbenchService private readonly _webviewWorkbenchService: IWebviewWorkbenchService,\n\t) {\n\t\tsuper(init, webview, themeService);\n\t}\n\n\toverride dispose() {\n\t\tsuper.dispose();\n\t\tthis._resolvePromise?.cancel();\n\t\tthis._resolvePromise = undefined;\n\t}\n\n\t@memoize\n\tpublic override async resolve() {\n\t\tif (!this._resolved) {\n\t\t\tthis._resolved = true;\n\t\t\tthis._resolvePromise = createCancelablePromise(token => this._webviewWorkbenchService.resolveWebview(this, token));\n\t\t\ttry {\n\t\t\t\tawait this._resolvePromise;\n\t\t\t} catch (e) {\n\t\t\t\tif (!isCancellationError(e)) {\n\t\t\t\t\tthrow e;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn super.resolve();\n\t}\n\n\tprotected override transfer(other: LazilyResolvedWebviewEditorInput): WebviewInput | undefined {\n\t\tif (!super.transfer(other)) {\n\t\t\treturn;\n\t\t}\n\n\t\tother._resolved = this._resolved;\n\t\treturn other;\n\t}\n}\n\n\nclass RevivalPool {\n\tprivate _awaitingRevival: Array<{\n\t\treadonly input: WebviewInput;\n\t\treadonly promise: DeferredPromise<void>;\n\t\treadonly disposable: IDisposable;\n\t}> = [];\n\n\tpublic enqueueForRestoration(input: WebviewInput, token: CancellationToken): Promise<void> {\n\t\tconst promise = new DeferredPromise<void>();\n\n\t\tconst remove = () => {\n\t\t\tconst index = this._awaitingRevival.findIndex(entry => input === entry.input);\n\t\t\tif (index >= 0) {\n\t\t\t\tthis._awaitingRevival.splice(index, 1);\n\t\t\t}\n\t\t};\n\n\t\tconst disposable = combinedDisposable(\n\t\t\tinput.webview.onDidDispose(remove),\n\t\t\ttoken.onCancellationRequested(() => {\n\t\t\t\tremove();\n\t\t\t\tpromise.cancel();\n\t\t\t}),\n\t\t);\n\n\t\tthis._awaitingRevival.push({ input, promise, disposable });\n\n\t\treturn promise.p;\n\t}\n\n\tpublic reviveFor(reviver: WebviewResolver, token: CancellationToken) {\n\t\tconst toRevive = this._awaitingRevival.filter(({ input }) => canRevive(reviver, input));\n\t\tthis._awaitingRevival = this._awaitingRevival.filter(({ input }) => !canRevive(reviver, input));\n\n\t\tfor (const { input, promise: resolve, disposable } of toRevive) {\n\t\t\treviver.resolveWebview(input, token).then(x => resolve.complete(x), err => resolve.error(err)).finally(() => {\n\t\t\t\tdisposable.dispose();\n\t\t\t});\n\t\t}\n\t}\n}\n\n\nexport class WebviewEditorService extends Disposable implements IWebviewWorkbenchService {\n\tdeclare readonly _serviceBrand: undefined;\n\n\tprivate readonly _revivers = new Set<WebviewResolver>();\n\tprivate readonly _revivalPool = new RevivalPool();\n\n\tconstructor(\n\t\t@IEditorGroupsService editorGroupsService: IEditorGroupsService,\n\t\t@IEditorService private readonly _editorService: IEditorService,\n\t\t@IInstantiationService private readonly _instantiationService: IInstantiationService,\n\t\t@IWebviewService private readonly _webviewService: IWebviewService,\n\t) {\n\t\tsuper();\n\n\t\tthis._register(editorGroupsService.registerContextKeyProvider({\n\t\t\tcontextKey: CONTEXT_ACTIVE_WEBVIEW_PANEL_ID,\n\t\t\tgetGroupContextKeyValue: (group) => this.getWebviewId(group.activeEditor),\n\t\t}));\n\n\t\tthis._register(_editorService.onDidActiveEditorChange(() => {\n\t\t\tthis.updateActiveWebview();\n\t\t}));\n\n\t\t// The user may have switched focus between two sides of a diff editor\n\t\tthis._register(_webviewService.onDidChangeActiveWebview(() => {\n\t\t\tthis.updateActiveWebview();\n\t\t}));\n\n\t\tthis.updateActiveWebview();\n\t}\n\n\tprivate _activeWebview: WebviewInput | undefined;\n\n\tprivate readonly _onDidChangeActiveWebviewEditor = this._register(new Emitter<WebviewInput | undefined>());\n\tpublic readonly onDidChangeActiveWebviewEditor = this._onDidChangeActiveWebviewEditor.event;\n\n\tprivate getWebviewId(input: EditorInput | null): string {\n\t\tlet webviewInput: WebviewInput | undefined;\n\t\tif (input instanceof WebviewInput) {\n\t\t\twebviewInput = input;\n\t\t} else if (input instanceof DiffEditorInput) {\n\t\t\tif (input.primary instanceof WebviewInput) {\n\t\t\t\twebviewInput = input.primary;\n\t\t\t} else if (input.secondary instanceof WebviewInput) {\n\t\t\t\twebviewInput = input.secondary;\n\t\t\t}\n\t\t}\n\n\t\treturn webviewInput?.webview.providedViewType ?? '';\n\t}\n\n\tprivate updateActiveWebview() {\n\t\tconst activeInput = this._editorService.activeEditor;\n\n\t\tlet newActiveWebview: WebviewInput | undefined;\n\t\tif (activeInput instanceof WebviewInput) {\n\t\t\tnewActiveWebview = activeInput;\n\t\t} else if (activeInput instanceof DiffEditorInput) {\n\t\t\tif (activeInput.primary instanceof WebviewInput && activeInput.primary.webview === this._webviewService.activeWebview) {\n\t\t\t\tnewActiveWebview = activeInput.primary;\n\t\t\t} else if (activeInput.secondary instanceof WebviewInput && activeInput.secondary.webview === this._webviewService.activeWebview) {\n\t\t\t\tnewActiveWebview = activeInput.secondary;\n\t\t\t}\n\t\t}\n\t\tif (newActiveWebview !== this._activeWebview) {\n\t\t\tthis._activeWebview = newActiveWebview;\n\t\t\tthis._onDidChangeActiveWebviewEditor.fire(newActiveWebview);\n\t\t}\n\t}\n\n\tpublic openWebview(\n\t\twebviewInitInfo: WebviewInitInfo,\n\t\tviewType: string,\n\t\ttitle: string,\n\t\ticonPath: WebviewIcons | undefined,\n\t\tshowOptions: IWebViewShowOptions,\n\t): WebviewInput {\n\t\tconst webview = this._webviewService.createWebviewOverlay(webviewInitInfo);\n\t\tconst webviewInput = this._instantiationService.createInstance(WebviewInput, { viewType, name: title, providedId: webviewInitInfo.providedViewType, iconPath }, webview);\n\t\tthis._editorService.openEditor(webviewInput, {\n\t\t\tpinned: true,\n\t\t\tpreserveFocus: showOptions.preserveFocus,\n\t\t\t// preserve pre 1.38 behaviour to not make group active when preserveFocus: true\n\t\t\t// but make sure to restore the editor to fix https://github.com/microsoft/vscode/issues/79633\n\t\t\tactivation: showOptions.preserveFocus ? EditorActivation.RESTORE : undefined\n\t\t}, showOptions.group);\n\t\treturn webviewInput;\n\t}\n\n\tpublic revealWebview(\n\t\twebview: WebviewInput,\n\t\tgroup: IEditorGroup | GroupIdentifier | ACTIVE_GROUP_TYPE | SIDE_GROUP_TYPE,\n\t\tpreserveFocus: boolean\n\t): void {\n\t\tconst topLevelEditor = this.findTopLevelEditorForWebview(webview);\n\n\t\tthis._editorService.openEditor(topLevelEditor, {\n\t\t\tpreserveFocus,\n\t\t\t// preserve pre 1.38 behaviour to not make group active when preserveFocus: true\n\t\t\t// but make sure to restore the editor to fix https://github.com/microsoft/vscode/issues/79633\n\t\t\tactivation: preserveFocus ? EditorActivation.RESTORE : undefined\n\t\t}, group);\n\t}\n\n\tprivate findTopLevelEditorForWebview(webview: WebviewInput): EditorInput {\n\t\tfor (const editor of this._editorService.editors) {\n\t\t\tif (editor === webview) {\n\t\t\t\treturn editor;\n\t\t\t}\n\t\t\tif (editor instanceof DiffEditorInput) {\n\t\t\t\tif (webview === editor.primary || webview === editor.secondary) {\n\t\t\t\t\treturn editor;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn webview;\n\t}\n\n\tpublic openRevivedWebview(options: {\n\t\twebviewInitInfo: WebviewInitInfo;\n\t\tviewType: string;\n\t\ttitle: string;\n\t\ticonPath: WebviewIcons | undefined;\n\t\tstate: any;\n\t\tgroup: number | undefined;\n\t}): WebviewInput {\n\t\tconst webview = this._webviewService.createWebviewOverlay(options.webviewInitInfo);\n\t\twebview.state = options.state;\n\n\t\tconst webviewInput = this._instantiationService.createInstance(LazilyResolvedWebviewEditorInput, {\n\t\t\tviewType: options.viewType,\n\t\t\tprovidedId: options.webviewInitInfo.providedViewType,\n\t\t\tname: options.title,\n\t\t\ticonPath: options.iconPath\n\t\t}, webview);\n\t\twebviewInput.iconPath = options.iconPath;\n\n\t\tif (typeof options.group === 'number') {\n\t\t\twebviewInput.updateGroup(options.group);\n\t\t}\n\t\treturn webviewInput;\n\t}\n\n\tpublic registerResolver(reviver: WebviewResolver): IDisposable {\n\t\tthis._revivers.add(reviver);\n\n\t\tconst cts = new CancellationTokenSource();\n\t\tthis._revivalPool.reviveFor(reviver, cts.token);\n\n\t\treturn toDisposable(() => {\n\t\t\tthis._revivers.delete(reviver);\n\t\t\tcts.dispose(true);\n\t\t});\n\t}\n\n\tpublic shouldPersist(webview: WebviewInput): boolean {\n\t\t// Revived webviews may not have an actively registered reviver but we still want to persist them\n\t\t// since a reviver should exist when it is actually needed.\n\t\tif (webview instanceof LazilyResolvedWebviewEditorInput) {\n\t\t\treturn true;\n\t\t}\n\n\t\treturn Iterable.some(this._revivers.values(), reviver => canRevive(reviver, webview));\n\t}\n\n\tprivate async tryRevive(webview: WebviewInput, token: CancellationToken): Promise<boolean> {\n\t\tfor (const reviver of this._revivers.values()) {\n\t\t\tif (canRevive(reviver, webview)) {\n\t\t\t\tawait reviver.resolveWebview(webview, token);\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t}\n\n\tpublic async resolveWebview(webview: WebviewInput, token: CancellationToken): Promise<void> {\n\t\tconst didRevive = await this.tryRevive(webview, token);\n\t\tif (!didRevive && !token.isCancellationRequested) {\n\t\t\t// A reviver may not be registered yet. Put into pool and resolve promise when we can revive\n\t\t\treturn this._revivalPool.enqueueForRestoration(webview, token);\n\t\t}\n\t}\n}\n"]}