{"version":3,"sources":["vs/workbench/contrib/files/browser/fileImportExport.ts"],"names":[],"mappings":"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","file":"fileImportExport.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { localize } from '../../../../nls.js';\nimport { CancellationToken, CancellationTokenSource } from '../../../../base/common/cancellation.js';\nimport { getFileNamesMessage, IConfirmation, IDialogService, IFileDialogService, IPromptButton } from '../../../../platform/dialogs/common/dialogs.js';\nimport { ByteSize, FileSystemProviderCapabilities, IFileService, IFileStatWithMetadata } from '../../../../platform/files/common/files.js';\nimport { INotificationService, Severity } from '../../../../platform/notification/common/notification.js';\nimport { IProgress, IProgressService, IProgressStep, ProgressLocation } from '../../../../platform/progress/common/progress.js';\nimport { IExplorerService } from './files.js';\nimport { IFilesConfiguration, UndoConfirmLevel, VIEW_ID } from '../common/files.js';\nimport { IEditorService } from '../../../services/editor/common/editorService.js';\nimport { Limiter, Promises, RunOnceWorker } from '../../../../base/common/async.js';\nimport { newWriteableBufferStream, VSBuffer } from '../../../../base/common/buffer.js';\nimport { basename, dirname, joinPath } from '../../../../base/common/resources.js';\nimport { ResourceFileEdit } from '../../../../editor/browser/services/bulkEditService.js';\nimport { ExplorerItem } from '../common/explorerModel.js';\nimport { URI } from '../../../../base/common/uri.js';\nimport { IHostService } from '../../../services/host/browser/host.js';\nimport { IWorkspaceContextService } from '../../../../platform/workspace/common/workspace.js';\nimport { extractEditorsAndFilesDropData } from '../../../../platform/dnd/browser/dnd.js';\nimport { IWorkspaceEditingService } from '../../../services/workspaces/common/workspaceEditing.js';\nimport { isWeb } from '../../../../base/common/platform.js';\nimport { getActiveWindow, isDragEvent, triggerDownload } from '../../../../base/browser/dom.js';\nimport { ILogService } from '../../../../platform/log/common/log.js';\nimport { FileAccess, Schemas } from '../../../../base/common/network.js';\nimport { listenStream } from '../../../../base/common/stream.js';\nimport { DisposableStore, toDisposable } from '../../../../base/common/lifecycle.js';\nimport { createSingleCallFunction } from '../../../../base/common/functional.js';\nimport { coalesce } from '../../../../base/common/arrays.js';\nimport { canceled } from '../../../../base/common/errors.js';\nimport { IConfigurationService } from '../../../../platform/configuration/common/configuration.js';\nimport { WebFileSystemAccess } from '../../../../platform/files/browser/webFileSystemAccess.js';\nimport { IInstantiationService } from '../../../../platform/instantiation/common/instantiation.js';\nimport { IStorageService, StorageScope, StorageTarget } from '../../../../platform/storage/common/storage.js';\n\n//#region Browser File Upload (drag and drop, input element)\n\ninterface IBrowserUploadOperation {\n\tstartTime: number;\n\tprogressScheduler: RunOnceWorker<IProgressStep>;\n\n\tfilesTotal: number;\n\tfilesUploaded: number;\n\n\ttotalBytesUploaded: number;\n}\n\ninterface IWebkitDataTransfer {\n\titems: IWebkitDataTransferItem[];\n}\n\ninterface IWebkitDataTransferItem {\n\twebkitGetAsEntry(): IWebkitDataTransferItemEntry;\n}\n\ninterface IWebkitDataTransferItemEntry {\n\tname: string | undefined;\n\tisFile: boolean;\n\tisDirectory: boolean;\n\n\tfile(resolve: (file: File) => void, reject: () => void): void;\n\tcreateReader(): IWebkitDataTransferItemEntryReader;\n}\n\ninterface IWebkitDataTransferItemEntryReader {\n\treadEntries(resolve: (file: IWebkitDataTransferItemEntry[]) => void, reject: () => void): void;\n}\n\nexport class BrowserFileUpload {\n\n\tprivate static readonly MAX_PARALLEL_UPLOADS = 20;\n\n\tconstructor(\n\t\t@IProgressService private readonly progressService: IProgressService,\n\t\t@IDialogService private readonly dialogService: IDialogService,\n\t\t@IExplorerService private readonly explorerService: IExplorerService,\n\t\t@IEditorService private readonly editorService: IEditorService,\n\t\t@IFileService private readonly fileService: IFileService\n\t) {\n\t}\n\n\tupload(target: ExplorerItem, source: DragEvent | FileList): Promise<void> {\n\t\tconst cts = new CancellationTokenSource();\n\n\t\t// Indicate progress globally\n\t\tconst uploadPromise = this.progressService.withProgress(\n\t\t\t{\n\t\t\t\tlocation: ProgressLocation.Window,\n\t\t\t\tdelay: 800,\n\t\t\t\tcancellable: true,\n\t\t\t\ttitle: localize('uploadingFiles', \"Uploading\")\n\t\t\t},\n\t\t\tasync progress => this.doUpload(target, this.toTransfer(source), progress, cts.token),\n\t\t\t() => cts.dispose(true)\n\t\t);\n\n\t\t// Also indicate progress in the files view\n\t\tthis.progressService.withProgress({ location: VIEW_ID, delay: 500 }, () => uploadPromise);\n\n\t\treturn uploadPromise;\n\t}\n\n\tprivate toTransfer(source: DragEvent | FileList): IWebkitDataTransfer {\n\t\tif (isDragEvent(source)) {\n\t\t\treturn source.dataTransfer as unknown as IWebkitDataTransfer;\n\t\t}\n\n\t\tconst transfer: IWebkitDataTransfer = { items: [] };\n\n\t\t// We want to reuse the same code for uploading from\n\t\t// Drag & Drop as well as input element based upload\n\t\t// so we convert into webkit data transfer when the\n\t\t// input element approach is used (simplified).\n\t\tfor (const file of source) {\n\t\t\ttransfer.items.push({\n\t\t\t\twebkitGetAsEntry: () => {\n\t\t\t\t\treturn {\n\t\t\t\t\t\tname: file.name,\n\t\t\t\t\t\tisDirectory: false,\n\t\t\t\t\t\tisFile: true,\n\t\t\t\t\t\tcreateReader: () => { throw new Error('Unsupported for files'); },\n\t\t\t\t\t\tfile: resolve => resolve(file)\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\treturn transfer;\n\t}\n\n\tprivate async doUpload(target: ExplorerItem, source: IWebkitDataTransfer, progress: IProgress<IProgressStep>, token: CancellationToken): Promise<void> {\n\t\tconst items = source.items;\n\n\t\t// Somehow the items thing is being modified at random, maybe as a security\n\t\t// measure since this is a DND operation. As such, we copy the items into\n\t\t// an array we own as early as possible before using it.\n\t\tconst entries: IWebkitDataTransferItemEntry[] = [];\n\t\tfor (const item of items) {\n\t\t\tentries.push(item.webkitGetAsEntry());\n\t\t}\n\n\t\tconst results: { isFile: boolean; resource: URI }[] = [];\n\t\tconst operation: IBrowserUploadOperation = {\n\t\t\tstartTime: Date.now(),\n\t\t\tprogressScheduler: new RunOnceWorker<IProgressStep>(steps => { progress.report(steps[steps.length - 1]); }, 1000),\n\n\t\t\tfilesTotal: entries.length,\n\t\t\tfilesUploaded: 0,\n\n\t\t\ttotalBytesUploaded: 0\n\t\t};\n\n\t\t// Upload all entries in parallel up to a\n\t\t// certain maximum leveraging the `Limiter`\n\t\tconst uploadLimiter = new Limiter(BrowserFileUpload.MAX_PARALLEL_UPLOADS);\n\t\tawait Promises.settled(entries.map(entry => {\n\t\t\treturn uploadLimiter.queue(async () => {\n\t\t\t\tif (token.isCancellationRequested) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t// Confirm overwrite as needed\n\t\t\t\tif (target && entry.name && target.getChild(entry.name)) {\n\t\t\t\t\tconst { confirmed } = await this.dialogService.confirm(getFileOverwriteConfirm(entry.name));\n\t\t\t\t\tif (!confirmed) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tawait this.explorerService.applyBulkEdit([new ResourceFileEdit(joinPath(target.resource, entry.name), undefined, { recursive: true, folder: target.getChild(entry.name)?.isDirectory })], {\n\t\t\t\t\t\tundoLabel: localize('overwrite', \"Overwrite {0}\", entry.name),\n\t\t\t\t\t\tprogressLabel: localize('overwriting', \"Overwriting {0}\", entry.name),\n\t\t\t\t\t});\n\n\t\t\t\t\tif (token.isCancellationRequested) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Upload entry\n\t\t\t\tconst result = await this.doUploadEntry(entry, target.resource, target, progress, operation, token);\n\t\t\t\tif (result) {\n\t\t\t\t\tresults.push(result);\n\t\t\t\t}\n\t\t\t});\n\t\t}));\n\n\t\toperation.progressScheduler.dispose();\n\n\t\t// Open uploaded file in editor only if we upload just one\n\t\tconst firstUploadedFile = results[0];\n\t\tif (!token.isCancellationRequested && firstUploadedFile?.isFile) {\n\t\t\tawait this.editorService.openEditor({ resource: firstUploadedFile.resource, options: { pinned: true } });\n\t\t}\n\t}\n\n\tprivate async doUploadEntry(entry: IWebkitDataTransferItemEntry, parentResource: URI, target: ExplorerItem | undefined, progress: IProgress<IProgressStep>, operation: IBrowserUploadOperation, token: CancellationToken): Promise<{ isFile: boolean; resource: URI } | undefined> {\n\t\tif (token.isCancellationRequested || !entry.name || (!entry.isFile && !entry.isDirectory)) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\t// Report progress\n\t\tlet fileBytesUploaded = 0;\n\t\tconst reportProgress = (fileSize: number, bytesUploaded: number): void => {\n\t\t\tfileBytesUploaded += bytesUploaded;\n\t\t\toperation.totalBytesUploaded += bytesUploaded;\n\n\t\t\tconst bytesUploadedPerSecond = operation.totalBytesUploaded / ((Date.now() - operation.startTime) / 1000);\n\n\t\t\t// Small file\n\t\t\tlet message: string;\n\t\t\tif (fileSize < ByteSize.MB) {\n\t\t\t\tif (operation.filesTotal === 1) {\n\t\t\t\t\tmessage = `${entry.name}`;\n\t\t\t\t} else {\n\t\t\t\t\tmessage = localize('uploadProgressSmallMany', \"{0} of {1} files ({2}/s)\", operation.filesUploaded, operation.filesTotal, ByteSize.formatSize(bytesUploadedPerSecond));\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Large file\n\t\t\telse {\n\t\t\t\tmessage = localize('uploadProgressLarge', \"{0} ({1} of {2}, {3}/s)\", entry.name, ByteSize.formatSize(fileBytesUploaded), ByteSize.formatSize(fileSize), ByteSize.formatSize(bytesUploadedPerSecond));\n\t\t\t}\n\n\t\t\t// Report progress but limit to update only once per second\n\t\t\toperation.progressScheduler.work({ message });\n\t\t};\n\t\toperation.filesUploaded++;\n\t\treportProgress(0, 0);\n\n\t\t// Handle file upload\n\t\tconst resource = joinPath(parentResource, entry.name);\n\t\tif (entry.isFile) {\n\t\t\tconst file = await new Promise<File>((resolve, reject) => entry.file(resolve, reject));\n\n\t\t\tif (token.isCancellationRequested) {\n\t\t\t\treturn undefined;\n\t\t\t}\n\n\t\t\t// Chrome/Edge/Firefox support stream method, but only use it for\n\t\t\t// larger files to reduce the overhead of the streaming approach\n\t\t\tif (typeof file.stream === 'function' && file.size > ByteSize.MB) {\n\t\t\t\tawait this.doUploadFileBuffered(resource, file, reportProgress, token);\n\t\t\t}\n\n\t\t\t// Fallback to unbuffered upload for other browsers or small files\n\t\t\telse {\n\t\t\t\tawait this.doUploadFileUnbuffered(resource, file, reportProgress);\n\t\t\t}\n\n\t\t\treturn { isFile: true, resource };\n\t\t}\n\n\t\t// Handle folder upload\n\t\telse {\n\n\t\t\t// Create target folder\n\t\t\tawait this.fileService.createFolder(resource);\n\n\t\t\tif (token.isCancellationRequested) {\n\t\t\t\treturn undefined;\n\t\t\t}\n\n\t\t\t// Recursive upload files in this directory\n\t\t\tconst dirReader = entry.createReader();\n\t\t\tconst childEntries: IWebkitDataTransferItemEntry[] = [];\n\t\t\tlet done = false;\n\t\t\tdo {\n\t\t\t\tconst childEntriesChunk = await new Promise<IWebkitDataTransferItemEntry[]>((resolve, reject) => dirReader.readEntries(resolve, reject));\n\t\t\t\tif (childEntriesChunk.length > 0) {\n\t\t\t\t\tchildEntries.push(...childEntriesChunk);\n\t\t\t\t} else {\n\t\t\t\t\tdone = true; // an empty array is a signal that all entries have been read\n\t\t\t\t}\n\t\t\t} while (!done && !token.isCancellationRequested);\n\n\t\t\t// Update operation total based on new counts\n\t\t\toperation.filesTotal += childEntries.length;\n\n\t\t\t// Split up files from folders to upload\n\t\t\tconst folderTarget = target?.getChild(entry.name) || undefined;\n\t\t\tconst fileChildEntries: IWebkitDataTransferItemEntry[] = [];\n\t\t\tconst folderChildEntries: IWebkitDataTransferItemEntry[] = [];\n\t\t\tfor (const childEntry of childEntries) {\n\t\t\t\tif (childEntry.isFile) {\n\t\t\t\t\tfileChildEntries.push(childEntry);\n\t\t\t\t} else if (childEntry.isDirectory) {\n\t\t\t\t\tfolderChildEntries.push(childEntry);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Upload files (up to `MAX_PARALLEL_UPLOADS` in parallel)\n\t\t\tconst fileUploadQueue = new Limiter(BrowserFileUpload.MAX_PARALLEL_UPLOADS);\n\t\t\tawait Promises.settled(fileChildEntries.map(fileChildEntry => {\n\t\t\t\treturn fileUploadQueue.queue(() => this.doUploadEntry(fileChildEntry, resource, folderTarget, progress, operation, token));\n\t\t\t}));\n\n\t\t\t// Upload folders (sequentially give we don't know their sizes)\n\t\t\tfor (const folderChildEntry of folderChildEntries) {\n\t\t\t\tawait this.doUploadEntry(folderChildEntry, resource, folderTarget, progress, operation, token);\n\t\t\t}\n\n\t\t\treturn { isFile: false, resource };\n\t\t}\n\t}\n\n\tprivate async doUploadFileBuffered(resource: URI, file: File, progressReporter: (fileSize: number, bytesUploaded: number) => void, token: CancellationToken): Promise<void> {\n\t\tconst writeableStream = newWriteableBufferStream({\n\t\t\t// Set a highWaterMark to prevent the stream\n\t\t\t// for file upload to produce large buffers\n\t\t\t// in-memory\n\t\t\thighWaterMark: 10\n\t\t});\n\t\tconst writeFilePromise = this.fileService.writeFile(resource, writeableStream);\n\n\t\t// Read the file in chunks using File.stream() web APIs\n\t\ttry {\n\t\t\tconst reader: ReadableStreamDefaultReader<Uint8Array> = file.stream().getReader();\n\n\t\t\tlet res = await reader.read();\n\t\t\twhile (!res.done) {\n\t\t\t\tif (token.isCancellationRequested) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\t// Write buffer into stream but make sure to wait\n\t\t\t\t// in case the `highWaterMark` is reached\n\t\t\t\tconst buffer = VSBuffer.wrap(res.value);\n\t\t\t\tawait writeableStream.write(buffer);\n\n\t\t\t\tif (token.isCancellationRequested) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\t// Report progress\n\t\t\t\tprogressReporter(file.size, buffer.byteLength);\n\n\t\t\t\tres = await reader.read();\n\t\t\t}\n\t\t\twriteableStream.end(undefined);\n\t\t} catch (error) {\n\t\t\twriteableStream.error(error);\n\t\t\twriteableStream.end();\n\t\t}\n\n\t\tif (token.isCancellationRequested) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\t// Wait for file being written to target\n\t\tawait writeFilePromise;\n\t}\n\n\tprivate doUploadFileUnbuffered(resource: URI, file: File, progressReporter: (fileSize: number, bytesUploaded: number) => void): Promise<void> {\n\t\treturn new Promise<void>((resolve, reject) => {\n\t\t\tconst reader = new FileReader();\n\t\t\treader.onload = async event => {\n\t\t\t\ttry {\n\t\t\t\t\tif (event.target?.result instanceof ArrayBuffer) {\n\t\t\t\t\t\tconst buffer = VSBuffer.wrap(new Uint8Array(event.target.result));\n\t\t\t\t\t\tawait this.fileService.writeFile(resource, buffer);\n\n\t\t\t\t\t\t// Report progress\n\t\t\t\t\t\tprogressReporter(file.size, buffer.byteLength);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthrow new Error('Could not read from dropped file.');\n\t\t\t\t\t}\n\n\t\t\t\t\tresolve();\n\t\t\t\t} catch (error) {\n\t\t\t\t\treject(error);\n\t\t\t\t}\n\t\t\t};\n\n\t\t\t// Start reading the file to trigger `onload`\n\t\t\treader.readAsArrayBuffer(file);\n\t\t});\n\t}\n}\n\n//#endregion\n\n//#region External File Import (drag and drop)\n\nexport class ExternalFileImport {\n\n\tconstructor(\n\t\t@IFileService private readonly fileService: IFileService,\n\t\t@IHostService private readonly hostService: IHostService,\n\t\t@IWorkspaceContextService private readonly contextService: IWorkspaceContextService,\n\t\t@IConfigurationService private readonly configurationService: IConfigurationService,\n\t\t@IDialogService private readonly dialogService: IDialogService,\n\t\t@IWorkspaceEditingService private readonly workspaceEditingService: IWorkspaceEditingService,\n\t\t@IExplorerService private readonly explorerService: IExplorerService,\n\t\t@IEditorService private readonly editorService: IEditorService,\n\t\t@IProgressService private readonly progressService: IProgressService,\n\t\t@INotificationService private readonly notificationService: INotificationService,\n\t\t@IInstantiationService private readonly instantiationService: IInstantiationService\n\t) {\n\t}\n\n\tasync import(target: ExplorerItem, source: DragEvent, targetWindow: Window): Promise<void> {\n\t\tconst cts = new CancellationTokenSource();\n\n\t\t// Indicate progress globally\n\t\tconst importPromise = this.progressService.withProgress(\n\t\t\t{\n\t\t\t\tlocation: ProgressLocation.Window,\n\t\t\t\tdelay: 800,\n\t\t\t\tcancellable: true,\n\t\t\t\ttitle: localize('copyingFiles', \"Copying...\")\n\t\t\t},\n\t\t\tasync () => await this.doImport(target, source, targetWindow, cts.token),\n\t\t\t() => cts.dispose(true)\n\t\t);\n\n\t\t// Also indicate progress in the files view\n\t\tthis.progressService.withProgress({ location: VIEW_ID, delay: 500 }, () => importPromise);\n\n\t\treturn importPromise;\n\t}\n\n\tprivate async doImport(target: ExplorerItem, source: DragEvent, targetWindow: Window, token: CancellationToken): Promise<void> {\n\n\t\t// Activate all providers for the resources dropped\n\t\tconst candidateFiles = coalesce((await this.instantiationService.invokeFunction(accessor => extractEditorsAndFilesDropData(accessor, source))).map(editor => editor.resource));\n\t\tawait Promise.all(candidateFiles.map(resource => this.fileService.activateProvider(resource.scheme)));\n\n\t\t// Check for dropped external files to be folders\n\t\tconst files = coalesce(candidateFiles.filter(resource => this.fileService.hasProvider(resource)));\n\t\tconst resolvedFiles = await this.fileService.resolveAll(files.map(file => ({ resource: file })));\n\n\t\tif (token.isCancellationRequested) {\n\t\t\treturn;\n\t\t}\n\n\t\t// Pass focus to window\n\t\tthis.hostService.focus(targetWindow);\n\n\t\t// Handle folders by adding to workspace if we are in workspace context and if dropped on top\n\t\tconst folders = resolvedFiles.filter(resolvedFile => resolvedFile.success && resolvedFile.stat?.isDirectory).map(resolvedFile => ({ uri: resolvedFile.stat!.resource }));\n\t\tif (folders.length > 0 && target.isRoot) {\n\t\t\tenum ImportChoice {\n\t\t\t\tCopy = 1,\n\t\t\t\tAdd = 2\n\t\t\t}\n\n\t\t\tconst buttons: IPromptButton<ImportChoice | undefined>[] = [\n\t\t\t\t{\n\t\t\t\t\tlabel: folders.length > 1 ?\n\t\t\t\t\t\tlocalize('copyFolders', \"&&Copy Folders\") :\n\t\t\t\t\t\tlocalize('copyFolder', \"&&Copy Folder\"),\n\t\t\t\t\trun: () => ImportChoice.Copy\n\t\t\t\t}\n\t\t\t];\n\n\t\t\tlet message: string;\n\n\t\t\t// We only allow to add a folder to the workspace if there is already a workspace folder with that scheme\n\t\t\tconst workspaceFolderSchemas = this.contextService.getWorkspace().folders.map(folder => folder.uri.scheme);\n\t\t\tif (folders.some(folder => workspaceFolderSchemas.indexOf(folder.uri.scheme) >= 0)) {\n\t\t\t\tbuttons.unshift({\n\t\t\t\t\tlabel: folders.length > 1 ?\n\t\t\t\t\t\tlocalize('addFolders', \"&&Add Folders to Workspace\") :\n\t\t\t\t\t\tlocalize('addFolder', \"&&Add Folder to Workspace\"),\n\t\t\t\t\trun: () => ImportChoice.Add\n\t\t\t\t});\n\t\t\t\tmessage = folders.length > 1 ?\n\t\t\t\t\tlocalize('dropFolders', \"Do you want to copy the folders or add the folders to the workspace?\") :\n\t\t\t\t\tlocalize('dropFolder', \"Do you want to copy '{0}' or add '{0}' as a folder to the workspace?\", basename(folders[0].uri));\n\t\t\t} else {\n\t\t\t\tmessage = folders.length > 1 ?\n\t\t\t\t\tlocalize('copyfolders', \"Are you sure to want to copy folders?\") :\n\t\t\t\t\tlocalize('copyfolder', \"Are you sure to want to copy '{0}'?\", basename(folders[0].uri));\n\t\t\t}\n\n\t\t\tconst { result } = await this.dialogService.prompt({\n\t\t\t\ttype: Severity.Info,\n\t\t\t\tmessage,\n\t\t\t\tbuttons,\n\t\t\t\tcancelButton: true\n\t\t\t});\n\n\t\t\t// Add folders\n\t\t\tif (result === ImportChoice.Add) {\n\t\t\t\treturn this.workspaceEditingService.addFolders(folders);\n\t\t\t}\n\n\t\t\t// Copy resources\n\t\t\tif (result === ImportChoice.Copy) {\n\t\t\t\treturn this.importResources(target, files, token);\n\t\t\t}\n\t\t}\n\n\t\t// Handle dropped files (only support FileStat as target)\n\t\telse if (target instanceof ExplorerItem) {\n\t\t\treturn this.importResources(target, files, token);\n\t\t}\n\t}\n\n\tprivate async importResources(target: ExplorerItem, resources: URI[], token: CancellationToken): Promise<void> {\n\t\tif (resources && resources.length > 0) {\n\n\t\t\t// Resolve target to check for name collisions and ask user\n\t\t\tconst targetStat = await this.fileService.resolve(target.resource);\n\n\t\t\tif (token.isCancellationRequested) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Check for name collisions\n\t\t\tconst targetNames = new Set<string>();\n\t\t\tconst caseSensitive = this.fileService.hasCapability(target.resource, FileSystemProviderCapabilities.PathCaseSensitive);\n\t\t\tif (targetStat.children) {\n\t\t\t\ttargetStat.children.forEach(child => {\n\t\t\t\t\ttargetNames.add(caseSensitive ? child.name : child.name.toLowerCase());\n\t\t\t\t});\n\t\t\t}\n\n\n\t\t\tlet inaccessibleFileCount = 0;\n\t\t\tconst resourcesFiltered = coalesce((await Promises.settled(resources.map(async resource => {\n\t\t\t\tconst fileDoesNotExist = !(await this.fileService.exists(resource));\n\t\t\t\tif (fileDoesNotExist) {\n\t\t\t\t\tinaccessibleFileCount++;\n\t\t\t\t\treturn undefined;\n\t\t\t\t}\n\n\t\t\t\tif (targetNames.has(caseSensitive ? basename(resource) : basename(resource).toLowerCase())) {\n\t\t\t\t\tconst confirmationResult = await this.dialogService.confirm(getFileOverwriteConfirm(basename(resource)));\n\t\t\t\t\tif (!confirmationResult.confirmed) {\n\t\t\t\t\t\treturn undefined;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn resource;\n\t\t\t}))));\n\n\t\t\tif (inaccessibleFileCount > 0) {\n\t\t\t\tthis.notificationService.error(inaccessibleFileCount > 1 ? localize('filesInaccessible', \"Some or all of the dropped files could not be accessed for import.\") : localize('fileInaccessible', \"The dropped file could not be accessed for import.\"));\n\t\t\t}\n\n\t\t\t// Copy resources through bulk edit API\n\t\t\tconst resourceFileEdits = resourcesFiltered.map(resource => {\n\t\t\t\tconst sourceFileName = basename(resource);\n\t\t\t\tconst targetFile = joinPath(target.resource, sourceFileName);\n\n\t\t\t\treturn new ResourceFileEdit(resource, targetFile, { overwrite: true, copy: true });\n\t\t\t});\n\n\t\t\tconst undoLevel = this.configurationService.getValue<IFilesConfiguration>().explorer.confirmUndo;\n\t\t\tawait this.explorerService.applyBulkEdit(resourceFileEdits, {\n\t\t\t\tundoLabel: resourcesFiltered.length === 1 ?\n\t\t\t\t\tlocalize({ comment: ['substitution will be the name of the file that was imported'], key: 'importFile' }, \"Import {0}\", basename(resourcesFiltered[0])) :\n\t\t\t\t\tlocalize({ comment: ['substitution will be the number of files that were imported'], key: 'importnFile' }, \"Import {0} resources\", resourcesFiltered.length),\n\t\t\t\tprogressLabel: resourcesFiltered.length === 1 ?\n\t\t\t\t\tlocalize({ comment: ['substitution will be the name of the file that was copied'], key: 'copyingFile' }, \"Copying {0}\", basename(resourcesFiltered[0])) :\n\t\t\t\t\tlocalize({ comment: ['substitution will be the number of files that were copied'], key: 'copyingnFile' }, \"Copying {0} resources\", resourcesFiltered.length),\n\t\t\t\tprogressLocation: ProgressLocation.Window,\n\t\t\t\tconfirmBeforeUndo: undoLevel === UndoConfirmLevel.Verbose || undoLevel === UndoConfirmLevel.Default,\n\t\t\t});\n\n\t\t\t// if we only add one file, just open it directly\n\t\t\tconst autoOpen = this.configurationService.getValue<IFilesConfiguration>().explorer.autoOpenDroppedFile;\n\t\t\tif (autoOpen && resourceFileEdits.length === 1) {\n\t\t\t\tconst item = this.explorerService.findClosest(resourceFileEdits[0].newResource!);\n\t\t\t\tif (item && !item.isDirectory) {\n\t\t\t\t\tthis.editorService.openEditor({ resource: item.resource, options: { pinned: true } });\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n}\n\n//#endregion\n\n//#region Download (web, native)\n\ninterface IDownloadOperation {\n\tstartTime: number;\n\tprogressScheduler: RunOnceWorker<IProgressStep>;\n\n\tfilesTotal: number;\n\tfilesDownloaded: number;\n\n\ttotalBytesDownloaded: number;\n\tfileBytesDownloaded: number;\n}\n\nexport class FileDownload {\n\n\tprivate static readonly LAST_USED_DOWNLOAD_PATH_STORAGE_KEY = 'workbench.explorer.downloadPath';\n\n\tconstructor(\n\t\t@IFileService private readonly fileService: IFileService,\n\t\t@IExplorerService private readonly explorerService: IExplorerService,\n\t\t@IProgressService private readonly progressService: IProgressService,\n\t\t@ILogService private readonly logService: ILogService,\n\t\t@IFileDialogService private readonly fileDialogService: IFileDialogService,\n\t\t@IStorageService private readonly storageService: IStorageService\n\t) {\n\t}\n\n\tdownload(source: ExplorerItem[]): Promise<void> {\n\t\tconst cts = new CancellationTokenSource();\n\n\t\t// Indicate progress globally\n\t\tconst downloadPromise = this.progressService.withProgress(\n\t\t\t{\n\t\t\t\tlocation: ProgressLocation.Window,\n\t\t\t\tdelay: 800,\n\t\t\t\tcancellable: isWeb,\n\t\t\t\ttitle: localize('downloadingFiles', \"Downloading\")\n\t\t\t},\n\t\t\tasync progress => this.doDownload(source, progress, cts),\n\t\t\t() => cts.dispose(true)\n\t\t);\n\n\t\t// Also indicate progress in the files view\n\t\tthis.progressService.withProgress({ location: VIEW_ID, delay: 500 }, () => downloadPromise);\n\n\t\treturn downloadPromise;\n\t}\n\n\tprivate async doDownload(sources: ExplorerItem[], progress: IProgress<IProgressStep>, cts: CancellationTokenSource): Promise<void> {\n\t\tfor (const source of sources) {\n\t\t\tif (cts.token.isCancellationRequested) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Web: use DOM APIs to download files with optional support\n\t\t\t// for folders and large files\n\t\t\tif (isWeb) {\n\t\t\t\tawait this.doDownloadBrowser(source.resource, progress, cts);\n\t\t\t}\n\n\t\t\t// Native: use working copy file service to get at the contents\n\t\t\telse {\n\t\t\t\tawait this.doDownloadNative(source, progress, cts);\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate async doDownloadBrowser(resource: URI, progress: IProgress<IProgressStep>, cts: CancellationTokenSource): Promise<void> {\n\t\tconst stat = await this.fileService.resolve(resource, { resolveMetadata: true });\n\n\t\tif (cts.token.isCancellationRequested) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst maxBlobDownloadSize = 32 * ByteSize.MB; // avoid to download via blob-trick >32MB to avoid memory pressure\n\t\tconst preferFileSystemAccessWebApis = stat.isDirectory || stat.size > maxBlobDownloadSize;\n\n\t\t// Folder: use FS APIs to download files and folders if available and preferred\n\t\tconst activeWindow = getActiveWindow();\n\t\tif (preferFileSystemAccessWebApis && WebFileSystemAccess.supported(activeWindow)) {\n\t\t\ttry {\n\t\t\t\tconst parentFolder: FileSystemDirectoryHandle = await activeWindow.showDirectoryPicker();\n\t\t\t\tconst operation: IDownloadOperation = {\n\t\t\t\t\tstartTime: Date.now(),\n\t\t\t\t\tprogressScheduler: new RunOnceWorker<IProgressStep>(steps => { progress.report(steps[steps.length - 1]); }, 1000),\n\n\t\t\t\t\tfilesTotal: stat.isDirectory ? 0 : 1, // folders increment filesTotal within downloadFolder method\n\t\t\t\t\tfilesDownloaded: 0,\n\n\t\t\t\t\ttotalBytesDownloaded: 0,\n\t\t\t\t\tfileBytesDownloaded: 0\n\t\t\t\t};\n\n\t\t\t\tif (stat.isDirectory) {\n\t\t\t\t\tconst targetFolder = await parentFolder.getDirectoryHandle(stat.name, { create: true });\n\t\t\t\t\tawait this.downloadFolderBrowser(stat, targetFolder, operation, cts.token);\n\t\t\t\t} else {\n\t\t\t\t\tawait this.downloadFileBrowser(parentFolder, stat, operation, cts.token);\n\t\t\t\t}\n\n\t\t\t\toperation.progressScheduler.dispose();\n\t\t\t} catch (error) {\n\t\t\t\tthis.logService.warn(error);\n\t\t\t\tcts.cancel(); // `showDirectoryPicker` will throw an error when the user cancels\n\t\t\t}\n\t\t}\n\n\t\t// File: use traditional download to circumvent browser limitations\n\t\telse if (stat.isFile) {\n\t\t\tlet bufferOrUri: Uint8Array | URI;\n\t\t\ttry {\n\t\t\t\tbufferOrUri = (await this.fileService.readFile(stat.resource, { limits: { size: maxBlobDownloadSize } }, cts.token)).value.buffer;\n\t\t\t} catch (error) {\n\t\t\t\tbufferOrUri = FileAccess.uriToBrowserUri(stat.resource);\n\t\t\t}\n\n\t\t\tif (!cts.token.isCancellationRequested) {\n\t\t\t\ttriggerDownload(bufferOrUri, stat.name);\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate async downloadFileBufferedBrowser(resource: URI, target: FileSystemWritableFileStream, operation: IDownloadOperation, token: CancellationToken): Promise<void> {\n\t\tconst contents = await this.fileService.readFileStream(resource, undefined, token);\n\t\tif (token.isCancellationRequested) {\n\t\t\ttarget.close();\n\t\t\treturn;\n\t\t}\n\n\t\treturn new Promise<void>((resolve, reject) => {\n\t\t\tconst sourceStream = contents.value;\n\n\t\t\tconst disposables = new DisposableStore();\n\t\t\tdisposables.add(toDisposable(() => target.close()));\n\n\t\t\tdisposables.add(createSingleCallFunction(token.onCancellationRequested)(() => {\n\t\t\t\tdisposables.dispose();\n\t\t\t\treject(canceled());\n\t\t\t}));\n\n\t\t\tlistenStream(sourceStream, {\n\t\t\t\tonData: data => {\n\t\t\t\t\ttarget.write(data.buffer as Uint8Array<ArrayBuffer>);\n\t\t\t\t\tthis.reportProgress(contents.name, contents.size, data.byteLength, operation);\n\t\t\t\t},\n\t\t\t\tonError: error => {\n\t\t\t\t\tdisposables.dispose();\n\t\t\t\t\treject(error);\n\t\t\t\t},\n\t\t\t\tonEnd: () => {\n\t\t\t\t\tdisposables.dispose();\n\t\t\t\t\tresolve();\n\t\t\t\t}\n\t\t\t}, token);\n\t\t});\n\t}\n\n\tprivate async downloadFileUnbufferedBrowser(resource: URI, target: FileSystemWritableFileStream, operation: IDownloadOperation, token: CancellationToken): Promise<void> {\n\t\tconst contents = await this.fileService.readFile(resource, undefined, token);\n\t\tif (!token.isCancellationRequested) {\n\t\t\ttarget.write(contents.value.buffer as Uint8Array<ArrayBuffer>);\n\t\t\tthis.reportProgress(contents.name, contents.size, contents.value.byteLength, operation);\n\t\t}\n\n\t\ttarget.close();\n\t}\n\n\tprivate async downloadFileBrowser(targetFolder: FileSystemDirectoryHandle, file: IFileStatWithMetadata, operation: IDownloadOperation, token: CancellationToken): Promise<void> {\n\n\t\t// Report progress\n\t\toperation.filesDownloaded++;\n\t\toperation.fileBytesDownloaded = 0; // reset for this file\n\t\tthis.reportProgress(file.name, 0, 0, operation);\n\n\t\t// Start to download\n\t\tconst targetFile = await targetFolder.getFileHandle(file.name, { create: true });\n\t\tconst targetFileWriter = await targetFile.createWritable();\n\n\t\t// For large files, write buffered using streams\n\t\tif (file.size > ByteSize.MB) {\n\t\t\treturn this.downloadFileBufferedBrowser(file.resource, targetFileWriter, operation, token);\n\t\t}\n\n\t\t// For small files prefer to write unbuffered to reduce overhead\n\t\treturn this.downloadFileUnbufferedBrowser(file.resource, targetFileWriter, operation, token);\n\t}\n\n\tprivate async downloadFolderBrowser(folder: IFileStatWithMetadata, targetFolder: FileSystemDirectoryHandle, operation: IDownloadOperation, token: CancellationToken): Promise<void> {\n\t\tif (folder.children) {\n\t\t\toperation.filesTotal += (folder.children.map(child => child.isFile)).length;\n\n\t\t\tfor (const child of folder.children) {\n\t\t\t\tif (token.isCancellationRequested) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (child.isFile) {\n\t\t\t\t\tawait this.downloadFileBrowser(targetFolder, child, operation, token);\n\t\t\t\t} else {\n\t\t\t\t\tconst childFolder = await targetFolder.getDirectoryHandle(child.name, { create: true });\n\t\t\t\t\tconst resolvedChildFolder = await this.fileService.resolve(child.resource, { resolveMetadata: true });\n\n\t\t\t\t\tawait this.downloadFolderBrowser(resolvedChildFolder, childFolder, operation, token);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate reportProgress(name: string, fileSize: number, bytesDownloaded: number, operation: IDownloadOperation): void {\n\t\toperation.fileBytesDownloaded += bytesDownloaded;\n\t\toperation.totalBytesDownloaded += bytesDownloaded;\n\n\t\tconst bytesDownloadedPerSecond = operation.totalBytesDownloaded / ((Date.now() - operation.startTime) / 1000);\n\n\t\t// Small file\n\t\tlet message: string;\n\t\tif (fileSize < ByteSize.MB) {\n\t\t\tif (operation.filesTotal === 1) {\n\t\t\t\tmessage = name;\n\t\t\t} else {\n\t\t\t\tmessage = localize('downloadProgressSmallMany', \"{0} of {1} files ({2}/s)\", operation.filesDownloaded, operation.filesTotal, ByteSize.formatSize(bytesDownloadedPerSecond));\n\t\t\t}\n\t\t}\n\n\t\t// Large file\n\t\telse {\n\t\t\tmessage = localize('downloadProgressLarge', \"{0} ({1} of {2}, {3}/s)\", name, ByteSize.formatSize(operation.fileBytesDownloaded), ByteSize.formatSize(fileSize), ByteSize.formatSize(bytesDownloadedPerSecond));\n\t\t}\n\n\t\t// Report progress but limit to update only once per second\n\t\toperation.progressScheduler.work({ message });\n\t}\n\n\tprivate async doDownloadNative(explorerItem: ExplorerItem, progress: IProgress<IProgressStep>, cts: CancellationTokenSource): Promise<void> {\n\t\tprogress.report({ message: explorerItem.name });\n\n\t\tlet defaultUri: URI;\n\t\tconst lastUsedDownloadPath = this.storageService.get(FileDownload.LAST_USED_DOWNLOAD_PATH_STORAGE_KEY, StorageScope.APPLICATION);\n\t\tif (lastUsedDownloadPath) {\n\t\t\tdefaultUri = joinPath(URI.file(lastUsedDownloadPath), explorerItem.name);\n\t\t} else {\n\t\t\tdefaultUri = joinPath(\n\t\t\t\texplorerItem.isDirectory ?\n\t\t\t\t\tawait this.fileDialogService.defaultFolderPath(Schemas.file) :\n\t\t\t\t\tawait this.fileDialogService.defaultFilePath(Schemas.file),\n\t\t\t\texplorerItem.name\n\t\t\t);\n\t\t}\n\n\t\tconst destination = await this.fileDialogService.showSaveDialog({\n\t\t\tavailableFileSystems: [Schemas.file],\n\t\t\tsaveLabel: localize('downloadButton', \"Download\"),\n\t\t\ttitle: localize('chooseWhereToDownload', \"Choose Where to Download\"),\n\t\t\tdefaultUri\n\t\t});\n\n\t\tif (destination) {\n\n\t\t\t// Remember as last used download folder\n\t\t\tthis.storageService.store(FileDownload.LAST_USED_DOWNLOAD_PATH_STORAGE_KEY, dirname(destination).fsPath, StorageScope.APPLICATION, StorageTarget.MACHINE);\n\n\t\t\t// Perform download\n\t\t\tawait this.explorerService.applyBulkEdit([new ResourceFileEdit(explorerItem.resource, destination, { overwrite: true, copy: true })], {\n\t\t\t\tundoLabel: localize('downloadBulkEdit', \"Download {0}\", explorerItem.name),\n\t\t\t\tprogressLabel: localize('downloadingBulkEdit', \"Downloading {0}\", explorerItem.name),\n\t\t\t\tprogressLocation: ProgressLocation.Window\n\t\t\t});\n\t\t} else {\n\t\t\tcts.cancel(); // User canceled a download. In case there were multiple files selected we should cancel the remainder of the prompts #86100\n\t\t}\n\t}\n}\n\n//#endregion\n\n//#region Helpers\n\nexport function getFileOverwriteConfirm(name: string): IConfirmation {\n\treturn {\n\t\tmessage: localize('confirmOverwrite', \"A file or folder with the name '{0}' already exists in the destination folder. Do you want to replace it?\", name),\n\t\tdetail: localize('irreversible', \"This action is irreversible!\"),\n\t\tprimaryButton: localize({ key: 'replaceButtonLabel', comment: ['&& denotes a mnemonic'] }, \"&&Replace\"),\n\t\ttype: 'warning'\n\t};\n}\n\nexport function getMultipleFilesOverwriteConfirm(files: URI[]): IConfirmation {\n\tif (files.length > 1) {\n\t\treturn {\n\t\t\tmessage: localize('confirmManyOverwrites', \"The following {0} files and/or folders already exist in the destination folder. Do you want to replace them?\", files.length),\n\t\t\tdetail: getFileNamesMessage(files) + '\\n' + localize('irreversible', \"This action is irreversible!\"),\n\t\t\tprimaryButton: localize({ key: 'replaceButtonLabel', comment: ['&& denotes a mnemonic'] }, \"&&Replace\"),\n\t\t\ttype: 'warning'\n\t\t};\n\t}\n\n\treturn getFileOverwriteConfirm(basename(files[0]));\n}\n\n//#endregion\n"]}