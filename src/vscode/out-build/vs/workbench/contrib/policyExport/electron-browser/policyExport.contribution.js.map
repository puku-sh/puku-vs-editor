{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/contrib/policyExport/electron-browser/policyExport.contribution.ts","vs/workbench/contrib/policyExport/electron-browser/policyExport.contribution.ts"],"names":[],"mappings":"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","file":"policyExport.contribution.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { IWorkbenchContribution, registerWorkbenchContribution2, WorkbenchPhase } from '../../../common/contributions.js';\nimport { Disposable } from '../../../../base/common/lifecycle.js';\nimport { IWorkbenchConfigurationService } from '../../../services/configuration/common/configuration.js';\nimport { IExtensionService } from '../../../services/extensions/common/extensions.js';\nimport { INativeEnvironmentService } from '../../../../platform/environment/common/environment.js';\nimport { ILogService } from '../../../../platform/log/common/log.js';\nimport { INativeHostService } from '../../../../platform/native/common/native.js';\nimport { Registry } from '../../../../platform/registry/common/platform.js';\nimport { Extensions, IConfigurationRegistry } from '../../../../platform/configuration/common/configurationRegistry.js';\nimport { IProgressService, ProgressLocation } from '../../../../platform/progress/common/progress.js';\nimport { IFileService } from '../../../../platform/files/common/files.js';\nimport { URI } from '../../../../base/common/uri.js';\nimport { VSBuffer } from '../../../../base/common/buffer.js';\nimport { PolicyCategory, PolicyCategoryData } from '../../../../base/common/policy.js';\nimport { ExportedPolicyDataDto } from '../common/policyDto.js';\nimport { join } from '../../../../base/common/path.js';\n\nexport class PolicyExportContribution extends Disposable implements IWorkbenchContribution {\n\tstatic readonly ID = 'workbench.contrib.policyExport';\n\tstatic readonly DEFAULT_POLICY_EXPORT_PATH = 'build/lib/policies/policyData.jsonc';\n\n\tconstructor(\n\t\t@INativeEnvironmentService private readonly nativeEnvironmentService: INativeEnvironmentService,\n\t\t@IExtensionService private readonly extensionService: IExtensionService,\n\t\t@IFileService private readonly fileService: IFileService,\n\t\t@IWorkbenchConfigurationService private readonly configurationService: IWorkbenchConfigurationService,\n\t\t@INativeHostService private readonly nativeHostService: INativeHostService,\n\t\t@IProgressService private readonly progressService: IProgressService,\n\t\t@ILogService private readonly logService: ILogService,\n\t) {\n\t\tsuper();\n\n\t\t// Skip for non-development flows\n\t\tif (this.nativeEnvironmentService.isBuilt) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst policyDataPath = this.nativeEnvironmentService.exportPolicyData;\n\t\tif (policyDataPath !== undefined) {\n\t\t\tconst defaultPath = join(this.nativeEnvironmentService.appRoot, PolicyExportContribution.DEFAULT_POLICY_EXPORT_PATH);\n\t\t\tvoid this.exportPolicyDataAndQuit(policyDataPath ? policyDataPath : defaultPath);\n\t\t}\n\t}\n\n\tprivate log(msg: string | undefined, ...args: unknown[]) {\n\t\tthis.logService.info(`[${PolicyExportContribution.ID}]`, msg, ...args);\n\t}\n\n\tprivate async exportPolicyDataAndQuit(policyDataPath: string): Promise<void> {\n\t\ttry {\n\t\t\tawait this.progressService.withProgress({\n\t\t\t\tlocation: ProgressLocation.Notification,\n\t\t\t\ttitle: `Exporting policy data to ${policyDataPath}`\n\t\t\t}, async (_progress) => {\n\t\t\t\tthis.log('Export started. Waiting for configurations to load.');\n\t\t\t\tawait this.extensionService.whenInstalledExtensionsRegistered();\n\t\t\t\tawait this.configurationService.whenRemoteConfigurationLoaded();\n\n\t\t\t\tthis.log('Extensions and configuration loaded.');\n\t\t\t\tconst configurationRegistry = Registry.as<IConfigurationRegistry>(Extensions.Configuration);\n\t\t\t\tconst configurationProperties = {\n\t\t\t\t\t...configurationRegistry.getExcludedConfigurationProperties(),\n\t\t\t\t\t...configurationRegistry.getConfigurationProperties(),\n\t\t\t\t};\n\n\t\t\t\tconst policyData: ExportedPolicyDataDto = {\n\t\t\t\t\tcategories: Object.values(PolicyCategory).map(category => ({\n\t\t\t\t\t\tkey: category,\n\t\t\t\t\t\tname: PolicyCategoryData[category].name\n\t\t\t\t\t})),\n\t\t\t\t\tpolicies: []\n\t\t\t\t};\n\n\t\t\t\tfor (const [key, schema] of Object.entries(configurationProperties)) {\n\t\t\t\t\t// Check for the localization property for now to remain backwards compatible.\n\t\t\t\t\tif (schema.policy?.localization) {\n\t\t\t\t\t\tpolicyData.policies.push({\n\t\t\t\t\t\t\tkey,\n\t\t\t\t\t\t\tname: schema.policy.name,\n\t\t\t\t\t\t\tcategory: schema.policy.category,\n\t\t\t\t\t\t\tminimumVersion: schema.policy.minimumVersion,\n\t\t\t\t\t\t\tlocalization: {\n\t\t\t\t\t\t\t\tdescription: schema.policy.localization.description,\n\t\t\t\t\t\t\t\tenumDescriptions: schema.policy.localization.enumDescriptions,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\ttype: schema.type,\n\t\t\t\t\t\t\tdefault: schema.default,\n\t\t\t\t\t\t\tenum: schema.enum,\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tthis.log(`Discovered ${policyData.policies.length} policies to export.`);\n\n\t\t\t\tconst disclaimerComment = `/** THIS FILE IS AUTOMATICALLY GENERATED USING \\`code --export-policy-data\\`. DO NOT MODIFY IT MANUALLY. **/`;\n\t\t\t\tconst policyDataFileContent = `${disclaimerComment}\\n${JSON.stringify(policyData, null, 4)}\\n`;\n\t\t\t\tawait this.fileService.writeFile(URI.file(policyDataPath), VSBuffer.fromString(policyDataFileContent));\n\t\t\t\tthis.log(`Successfully exported ${policyData.policies.length} policies to ${policyDataPath}.`);\n\t\t\t});\n\n\t\t\tawait this.nativeHostService.exit(0);\n\t\t} catch (error) {\n\t\t\tthis.log('Failed to export policy', error);\n\t\t\tawait this.nativeHostService.exit(1);\n\t\t}\n\t}\n}\n\nregisterWorkbenchContribution2(\n\tPolicyExportContribution.ID,\n\tPolicyExportContribution,\n\tWorkbenchPhase.Eventually,\n);\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { IWorkbenchContribution, registerWorkbenchContribution2, WorkbenchPhase } from '../../../common/contributions.js';\nimport { Disposable } from '../../../../base/common/lifecycle.js';\nimport { IWorkbenchConfigurationService } from '../../../services/configuration/common/configuration.js';\nimport { IExtensionService } from '../../../services/extensions/common/extensions.js';\nimport { INativeEnvironmentService } from '../../../../platform/environment/common/environment.js';\nimport { ILogService } from '../../../../platform/log/common/log.js';\nimport { INativeHostService } from '../../../../platform/native/common/native.js';\nimport { Registry } from '../../../../platform/registry/common/platform.js';\nimport { Extensions, IConfigurationRegistry } from '../../../../platform/configuration/common/configurationRegistry.js';\nimport { IProgressService, ProgressLocation } from '../../../../platform/progress/common/progress.js';\nimport { IFileService } from '../../../../platform/files/common/files.js';\nimport { URI } from '../../../../base/common/uri.js';\nimport { VSBuffer } from '../../../../base/common/buffer.js';\nimport { PolicyCategory, PolicyCategoryData } from '../../../../base/common/policy.js';\nimport { ExportedPolicyDataDto } from '../common/policyDto.js';\nimport { join } from '../../../../base/common/path.js';\n\nexport class PolicyExportContribution extends Disposable implements IWorkbenchContribution {\n\tstatic readonly ID = 'workbench.contrib.policyExport';\n\tstatic readonly DEFAULT_POLICY_EXPORT_PATH = 'build/lib/policies/policyData.jsonc';\n\n\tconstructor(\n\t\t@INativeEnvironmentService private readonly nativeEnvironmentService: INativeEnvironmentService,\n\t\t@IExtensionService private readonly extensionService: IExtensionService,\n\t\t@IFileService private readonly fileService: IFileService,\n\t\t@IWorkbenchConfigurationService private readonly configurationService: IWorkbenchConfigurationService,\n\t\t@INativeHostService private readonly nativeHostService: INativeHostService,\n\t\t@IProgressService private readonly progressService: IProgressService,\n\t\t@ILogService private readonly logService: ILogService,\n\t) {\n\t\tsuper();\n\n\t\t// Skip for non-development flows\n\t\tif (this.nativeEnvironmentService.isBuilt) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst policyDataPath = this.nativeEnvironmentService.exportPolicyData;\n\t\tif (policyDataPath !== undefined) {\n\t\t\tconst defaultPath = join(this.nativeEnvironmentService.appRoot, PolicyExportContribution.DEFAULT_POLICY_EXPORT_PATH);\n\t\t\tvoid this.exportPolicyDataAndQuit(policyDataPath ? policyDataPath : defaultPath);\n\t\t}\n\t}\n\n\tprivate log(msg: string | undefined, ...args: unknown[]) {\n\t\tthis.logService.info(`[${PolicyExportContribution.ID}]`, msg, ...args);\n\t}\n\n\tprivate async exportPolicyDataAndQuit(policyDataPath: string): Promise<void> {\n\t\ttry {\n\t\t\tawait this.progressService.withProgress({\n\t\t\t\tlocation: ProgressLocation.Notification,\n\t\t\t\ttitle: `Exporting policy data to ${policyDataPath}`\n\t\t\t}, async (_progress) => {\n\t\t\t\tthis.log('Export started. Waiting for configurations to load.');\n\t\t\t\tawait this.extensionService.whenInstalledExtensionsRegistered();\n\t\t\t\tawait this.configurationService.whenRemoteConfigurationLoaded();\n\n\t\t\t\tthis.log('Extensions and configuration loaded.');\n\t\t\t\tconst configurationRegistry = Registry.as<IConfigurationRegistry>(Extensions.Configuration);\n\t\t\t\tconst configurationProperties = {\n\t\t\t\t\t...configurationRegistry.getExcludedConfigurationProperties(),\n\t\t\t\t\t...configurationRegistry.getConfigurationProperties(),\n\t\t\t\t};\n\n\t\t\t\tconst policyData: ExportedPolicyDataDto = {\n\t\t\t\t\tcategories: Object.values(PolicyCategory).map(category => ({\n\t\t\t\t\t\tkey: category,\n\t\t\t\t\t\tname: PolicyCategoryData[category].name\n\t\t\t\t\t})),\n\t\t\t\t\tpolicies: []\n\t\t\t\t};\n\n\t\t\t\tfor (const [key, schema] of Object.entries(configurationProperties)) {\n\t\t\t\t\t// Check for the localization property for now to remain backwards compatible.\n\t\t\t\t\tif (schema.policy?.localization) {\n\t\t\t\t\t\tpolicyData.policies.push({\n\t\t\t\t\t\t\tkey,\n\t\t\t\t\t\t\tname: schema.policy.name,\n\t\t\t\t\t\t\tcategory: schema.policy.category,\n\t\t\t\t\t\t\tminimumVersion: schema.policy.minimumVersion,\n\t\t\t\t\t\t\tlocalization: {\n\t\t\t\t\t\t\t\tdescription: schema.policy.localization.description,\n\t\t\t\t\t\t\t\tenumDescriptions: schema.policy.localization.enumDescriptions,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\ttype: schema.type,\n\t\t\t\t\t\t\tdefault: schema.default,\n\t\t\t\t\t\t\tenum: schema.enum,\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tthis.log(`Discovered ${policyData.policies.length} policies to export.`);\n\n\t\t\t\tconst disclaimerComment = `/** THIS FILE IS AUTOMATICALLY GENERATED USING \\`code --export-policy-data\\`. DO NOT MODIFY IT MANUALLY. **/`;\n\t\t\t\tconst policyDataFileContent = `${disclaimerComment}\\n${JSON.stringify(policyData, null, 4)}\\n`;\n\t\t\t\tawait this.fileService.writeFile(URI.file(policyDataPath), VSBuffer.fromString(policyDataFileContent));\n\t\t\t\tthis.log(`Successfully exported ${policyData.policies.length} policies to ${policyDataPath}.`);\n\t\t\t});\n\n\t\t\tawait this.nativeHostService.exit(0);\n\t\t} catch (error) {\n\t\t\tthis.log('Failed to export policy', error);\n\t\t\tawait this.nativeHostService.exit(1);\n\t\t}\n\t}\n}\n\nregisterWorkbenchContribution2(\n\tPolicyExportContribution.ID,\n\tPolicyExportContribution,\n\tWorkbenchPhase.Eventually,\n);\n"]}