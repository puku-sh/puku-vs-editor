{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/contrib/output/browser/outputLinkProvider.ts","vs/workbench/contrib/output/browser/outputLinkProvider.ts"],"names":[],"mappings":"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","file":"outputLinkProvider.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { URI } from '../../../../base/common/uri.js';\nimport { RunOnceScheduler } from '../../../../base/common/async.js';\nimport { IModelService } from '../../../../editor/common/services/model.js';\nimport { ILink } from '../../../../editor/common/languages.js';\nimport { IWorkspaceContextService } from '../../../../platform/workspace/common/workspace.js';\nimport { OUTPUT_MODE_ID, LOG_MODE_ID } from '../../../services/output/common/output.js';\nimport { OutputLinkComputer } from '../common/outputLinkComputer.js';\nimport { IDisposable, dispose, Disposable } from '../../../../base/common/lifecycle.js';\nimport { ILanguageFeaturesService } from '../../../../editor/common/services/languageFeatures.js';\nimport { WebWorkerDescriptor } from '../../../../platform/webWorker/browser/webWorkerDescriptor.js';\nimport { IWebWorkerService } from '../../../../platform/webWorker/browser/webWorkerService.js';\nimport { IWebWorkerClient } from '../../../../base/common/worker/webWorker.js';\nimport { WorkerTextModelSyncClient } from '../../../../editor/common/services/textModelSync/textModelSync.impl.js';\nimport { FileAccess } from '../../../../base/common/network.js';\n\nexport class OutputLinkProvider extends Disposable {\n\n\tprivate static readonly DISPOSE_WORKER_TIME = 3 * 60 * 1000; // dispose worker after 3 minutes of inactivity\n\n\tprivate worker?: OutputLinkWorkerClient;\n\tprivate disposeWorkerScheduler: RunOnceScheduler;\n\tprivate linkProviderRegistration: IDisposable | undefined;\n\n\tconstructor(\n\t\t@IWorkspaceContextService private readonly contextService: IWorkspaceContextService,\n\t\t@IModelService private readonly modelService: IModelService,\n\t\t@ILanguageFeaturesService private readonly languageFeaturesService: ILanguageFeaturesService,\n\t\t@IWebWorkerService private readonly webWorkerService: IWebWorkerService,\n\t) {\n\t\tsuper();\n\n\t\tthis.disposeWorkerScheduler = new RunOnceScheduler(() => this.disposeWorker(), OutputLinkProvider.DISPOSE_WORKER_TIME);\n\n\t\tthis.registerListeners();\n\t\tthis.updateLinkProviderWorker();\n\t}\n\n\tprivate registerListeners(): void {\n\t\tthis._register(this.contextService.onDidChangeWorkspaceFolders(() => this.updateLinkProviderWorker()));\n\t}\n\n\tprivate updateLinkProviderWorker(): void {\n\n\t\t// Setup link provider depending on folders being opened or not\n\t\tconst folders = this.contextService.getWorkspace().folders;\n\t\tif (folders.length > 0) {\n\t\t\tif (!this.linkProviderRegistration) {\n\t\t\t\tthis.linkProviderRegistration = this.languageFeaturesService.linkProvider.register([{ language: OUTPUT_MODE_ID, scheme: '*' }, { language: LOG_MODE_ID, scheme: '*' }], {\n\t\t\t\t\tprovideLinks: async model => {\n\t\t\t\t\t\tconst links = await this.provideLinks(model.uri);\n\n\t\t\t\t\t\treturn links && { links };\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t} else {\n\t\t\tdispose(this.linkProviderRegistration);\n\t\t\tthis.linkProviderRegistration = undefined;\n\t\t}\n\n\t\t// Dispose worker to recreate with folders on next provideLinks request\n\t\tthis.disposeWorker();\n\t\tthis.disposeWorkerScheduler.cancel();\n\t}\n\n\tprivate getOrCreateWorker(): OutputLinkWorkerClient {\n\t\tthis.disposeWorkerScheduler.schedule();\n\n\t\tif (!this.worker) {\n\t\t\tthis.worker = new OutputLinkWorkerClient(this.contextService, this.modelService, this.webWorkerService);\n\t\t}\n\n\t\treturn this.worker;\n\t}\n\n\tprivate async provideLinks(modelUri: URI): Promise<ILink[]> {\n\t\treturn this.getOrCreateWorker().provideLinks(modelUri);\n\t}\n\n\tprivate disposeWorker(): void {\n\t\tif (this.worker) {\n\t\t\tthis.worker.dispose();\n\t\t\tthis.worker = undefined;\n\t\t}\n\t}\n}\n\nclass OutputLinkWorkerClient extends Disposable {\n\tprivate readonly _workerClient: IWebWorkerClient<OutputLinkComputer>;\n\tprivate readonly _workerTextModelSyncClient: WorkerTextModelSyncClient;\n\tprivate readonly _initializeBarrier: Promise<void>;\n\n\tconstructor(\n\t\t@IWorkspaceContextService private readonly contextService: IWorkspaceContextService,\n\t\t@IModelService modelService: IModelService,\n\t\t@IWebWorkerService webWorkerService: IWebWorkerService,\n\t) {\n\t\tsuper();\n\t\tthis._workerClient = this._register(webWorkerService.createWorkerClient<OutputLinkComputer>(\n\t\t\tnew WebWorkerDescriptor({\n\t\t\t\tesmModuleLocation: FileAccess.asBrowserUri('vs/workbench/contrib/output/common/outputLinkComputerMain.js'),\n\t\t\t\tlabel: 'OutputLinkDetectionWorker'\n\t\t\t})\n\t\t));\n\t\tthis._workerTextModelSyncClient = this._register(WorkerTextModelSyncClient.create(this._workerClient, modelService));\n\t\tthis._initializeBarrier = this._ensureWorkspaceFolders();\n\t}\n\n\tprivate async _ensureWorkspaceFolders(): Promise<void> {\n\t\tawait this._workerClient.proxy.$setWorkspaceFolders(this.contextService.getWorkspace().folders.map(folder => folder.uri.toString()));\n\t}\n\n\tpublic async provideLinks(modelUri: URI): Promise<ILink[]> {\n\t\tawait this._initializeBarrier;\n\t\tthis._workerTextModelSyncClient.ensureSyncedResources([modelUri]);\n\t\treturn this._workerClient.proxy.$computeLinks(modelUri.toString());\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { URI } from '../../../../base/common/uri.js';\nimport { RunOnceScheduler } from '../../../../base/common/async.js';\nimport { IModelService } from '../../../../editor/common/services/model.js';\nimport { ILink } from '../../../../editor/common/languages.js';\nimport { IWorkspaceContextService } from '../../../../platform/workspace/common/workspace.js';\nimport { OUTPUT_MODE_ID, LOG_MODE_ID } from '../../../services/output/common/output.js';\nimport { OutputLinkComputer } from '../common/outputLinkComputer.js';\nimport { IDisposable, dispose, Disposable } from '../../../../base/common/lifecycle.js';\nimport { ILanguageFeaturesService } from '../../../../editor/common/services/languageFeatures.js';\nimport { WebWorkerDescriptor } from '../../../../platform/webWorker/browser/webWorkerDescriptor.js';\nimport { IWebWorkerService } from '../../../../platform/webWorker/browser/webWorkerService.js';\nimport { IWebWorkerClient } from '../../../../base/common/worker/webWorker.js';\nimport { WorkerTextModelSyncClient } from '../../../../editor/common/services/textModelSync/textModelSync.impl.js';\nimport { FileAccess } from '../../../../base/common/network.js';\n\nexport class OutputLinkProvider extends Disposable {\n\n\tprivate static readonly DISPOSE_WORKER_TIME = 3 * 60 * 1000; // dispose worker after 3 minutes of inactivity\n\n\tprivate worker?: OutputLinkWorkerClient;\n\tprivate disposeWorkerScheduler: RunOnceScheduler;\n\tprivate linkProviderRegistration: IDisposable | undefined;\n\n\tconstructor(\n\t\t@IWorkspaceContextService private readonly contextService: IWorkspaceContextService,\n\t\t@IModelService private readonly modelService: IModelService,\n\t\t@ILanguageFeaturesService private readonly languageFeaturesService: ILanguageFeaturesService,\n\t\t@IWebWorkerService private readonly webWorkerService: IWebWorkerService,\n\t) {\n\t\tsuper();\n\n\t\tthis.disposeWorkerScheduler = new RunOnceScheduler(() => this.disposeWorker(), OutputLinkProvider.DISPOSE_WORKER_TIME);\n\n\t\tthis.registerListeners();\n\t\tthis.updateLinkProviderWorker();\n\t}\n\n\tprivate registerListeners(): void {\n\t\tthis._register(this.contextService.onDidChangeWorkspaceFolders(() => this.updateLinkProviderWorker()));\n\t}\n\n\tprivate updateLinkProviderWorker(): void {\n\n\t\t// Setup link provider depending on folders being opened or not\n\t\tconst folders = this.contextService.getWorkspace().folders;\n\t\tif (folders.length > 0) {\n\t\t\tif (!this.linkProviderRegistration) {\n\t\t\t\tthis.linkProviderRegistration = this.languageFeaturesService.linkProvider.register([{ language: OUTPUT_MODE_ID, scheme: '*' }, { language: LOG_MODE_ID, scheme: '*' }], {\n\t\t\t\t\tprovideLinks: async model => {\n\t\t\t\t\t\tconst links = await this.provideLinks(model.uri);\n\n\t\t\t\t\t\treturn links && { links };\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t} else {\n\t\t\tdispose(this.linkProviderRegistration);\n\t\t\tthis.linkProviderRegistration = undefined;\n\t\t}\n\n\t\t// Dispose worker to recreate with folders on next provideLinks request\n\t\tthis.disposeWorker();\n\t\tthis.disposeWorkerScheduler.cancel();\n\t}\n\n\tprivate getOrCreateWorker(): OutputLinkWorkerClient {\n\t\tthis.disposeWorkerScheduler.schedule();\n\n\t\tif (!this.worker) {\n\t\t\tthis.worker = new OutputLinkWorkerClient(this.contextService, this.modelService, this.webWorkerService);\n\t\t}\n\n\t\treturn this.worker;\n\t}\n\n\tprivate async provideLinks(modelUri: URI): Promise<ILink[]> {\n\t\treturn this.getOrCreateWorker().provideLinks(modelUri);\n\t}\n\n\tprivate disposeWorker(): void {\n\t\tif (this.worker) {\n\t\t\tthis.worker.dispose();\n\t\t\tthis.worker = undefined;\n\t\t}\n\t}\n}\n\nclass OutputLinkWorkerClient extends Disposable {\n\tprivate readonly _workerClient: IWebWorkerClient<OutputLinkComputer>;\n\tprivate readonly _workerTextModelSyncClient: WorkerTextModelSyncClient;\n\tprivate readonly _initializeBarrier: Promise<void>;\n\n\tconstructor(\n\t\t@IWorkspaceContextService private readonly contextService: IWorkspaceContextService,\n\t\t@IModelService modelService: IModelService,\n\t\t@IWebWorkerService webWorkerService: IWebWorkerService,\n\t) {\n\t\tsuper();\n\t\tthis._workerClient = this._register(webWorkerService.createWorkerClient<OutputLinkComputer>(\n\t\t\tnew WebWorkerDescriptor({\n\t\t\t\tesmModuleLocation: FileAccess.asBrowserUri('vs/workbench/contrib/output/common/outputLinkComputerMain.js'),\n\t\t\t\tlabel: 'OutputLinkDetectionWorker'\n\t\t\t})\n\t\t));\n\t\tthis._workerTextModelSyncClient = this._register(WorkerTextModelSyncClient.create(this._workerClient, modelService));\n\t\tthis._initializeBarrier = this._ensureWorkspaceFolders();\n\t}\n\n\tprivate async _ensureWorkspaceFolders(): Promise<void> {\n\t\tawait this._workerClient.proxy.$setWorkspaceFolders(this.contextService.getWorkspace().folders.map(folder => folder.uri.toString()));\n\t}\n\n\tpublic async provideLinks(modelUri: URI): Promise<ILink[]> {\n\t\tawait this._initializeBarrier;\n\t\tthis._workerTextModelSyncClient.ensureSyncedResources([modelUri]);\n\t\treturn this._workerClient.proxy.$computeLinks(modelUri.toString());\n\t}\n}\n"]}