{"version":3,"sources":["vs/workbench/contrib/customEditor/common/customTextEditorModel.ts"],"names":[],"mappings":"AAAA;;;gGAGgG;;;;;;;;;;;AAEhG,OAAO,EAAE,OAAO,EAAS,MAAM,kCAAkC,CAAC;AAElE,OAAO,EAAE,UAAU,EAAc,MAAM,sCAAsC,CAAC;AAC9E,OAAO,EAAE,QAAQ,EAAE,MAAM,iCAAiC,CAAC;AAC3D,OAAO,EAAE,OAAO,EAAE,MAAM,sCAAsC,CAAC;AAE/D,OAAO,EAA4B,iBAAiB,EAAE,MAAM,uDAAuD,CAAC;AACpH,OAAO,EAAE,QAAQ,EAAE,MAAM,oBAAoB,CAAC;AAE9C,OAAO,EAAE,aAAa,EAAE,MAAM,4CAA4C,CAAC;AAG3E,OAAO,EAAE,iBAAiB,EAAE,MAAM,gEAAgE,CAAC;AACnG,OAAO,EAAwB,gBAAgB,EAA4B,MAAM,gDAAgD,CAAC;AAE3H,IAAM,qBAAqB,6BAA3B,MAAM,qBAAsB,SAAQ,UAAU;IAE7C,MAAM,CAAC,KAAK,CAAC,MAAM,CACzB,oBAA2C,EAC3C,QAAgB,EAChB,QAAa;QAEb,OAAO,oBAAoB,CAAC,cAAc,CAAC,KAAK,EAAC,QAAQ,EAAC,EAAE;YAC3D,MAAM,wBAAwB,GAAG,QAAQ,CAAC,GAAG,CAAC,iBAAiB,CAAC,CAAC;YACjE,MAAM,KAAK,GAAG,MAAM,wBAAwB,CAAC,oBAAoB,CAAC,QAAQ,CAAC,CAAC;YAC5E,OAAO,oBAAoB,CAAC,cAAc,CAAC,uBAAqB,EAAE,QAAQ,EAAE,QAAQ,EAAE,KAAK,CAAC,CAAC;QAC9F,CAAC,CAAC,CAAC;IACJ,CAAC;IAUD,YACiB,QAAgB,EACf,SAAc,EACd,MAA4C,EAC3C,eAAkD,EACrD,aAA6C,EACzC,gBAAmC;QAEtD,KAAK,EAAE,CAAC;QAPQ,aAAQ,GAAR,QAAQ,CAAQ;QACf,cAAS,GAAT,SAAS,CAAK;QACd,WAAM,GAAN,MAAM,CAAsC;QAC1B,oBAAe,GAAf,eAAe,CAAkB;QACpC,kBAAa,GAAb,aAAa,CAAe;QAX5C,yBAAoB,GAAG,IAAI,CAAC,SAAS,CAAC,IAAI,OAAO,EAAQ,CAAC,CAAC;QAC5D,wBAAmB,GAAG,IAAI,CAAC,oBAAoB,CAAC,KAAK,CAAC;QAErD,yBAAoB,GAAG,IAAI,CAAC,SAAS,CAAC,IAAI,OAAO,EAAQ,CAAC,CAAC;QAC5D,wBAAmB,GAAG,IAAI,CAAC,oBAAoB,CAAC,KAAK,CAAC;QA4DrD,sBAAiB,GAAkB,IAAI,CAAC,SAAS,CAAC,IAAI,OAAO,EAAQ,CAAC,CAAC;QAC/E,qBAAgB,GAAgB,IAAI,CAAC,iBAAiB,CAAC,KAAK,CAAC;QAErD,wBAAmB,GAAkB,IAAI,CAAC,SAAS,CAAC,IAAI,OAAO,EAAQ,CAAC,CAAC;QACjF,uBAAkB,GAAgB,IAAI,CAAC,mBAAmB,CAAC,KAAK,CAAC;QApDzE,IAAI,CAAC,SAAS,CAAC,MAAM,CAAC,CAAC;QAEvB,IAAI,CAAC,cAAc,GAAG,IAAI,CAAC,eAAe,CAAC,KAAK,CAAC,GAAG,CAAC,SAAS,CAAC,CAAC;QAChE,IAAI,IAAI,CAAC,cAAc,EAAE,CAAC;YACzB,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,cAAc,CAAC,mBAAmB,CAAC,GAAG,EAAE,CAAC,IAAI,CAAC,oBAAoB,CAAC,IAAI,EAAE,CAAC,CAAC,CAAC;YAChG,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,cAAc,CAAC,mBAAmB,CAAC,GAAG,EAAE,CAAC,IAAI,CAAC,oBAAoB,CAAC,IAAI,EAAE,CAAC,CAAC,CAAC;QACjG,CAAC;QAED,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,eAAe,CAAC,KAAK,CAAC,gBAAgB,CAAC,CAAC,CAAC,EAAE;YAC9D,IAAI,OAAO,CAAC,IAAI,CAAC,QAAQ,EAAE,CAAC,CAAC,QAAQ,CAAC,EAAE,CAAC;gBACxC,IAAI,CAAC,iBAAiB,CAAC,IAAI,EAAE,CAAC;gBAC9B,IAAI,CAAC,mBAAmB,CAAC,IAAI,EAAE,CAAC;YACjC,CAAC;QACF,CAAC,CAAC,CAAC,CAAC;QAEJ,IAAI,CAAC,SAAS,CAAC,gBAAgB,CAAC,UAAU,CAAC,CAAC,CAAC,EAAE;YAC9C,CAAC,CAAC,IAAI,CAAC,IAAI,EAAE,QAAQ,CAAC,IAAoB,EAAE,IAAuF,EAAE,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC;QAClJ,CAAC,CAAC,CAAC,CAAC;IACL,CAAC;IAED,IAAW,QAAQ;QAClB,OAAO,IAAI,CAAC,SAAS,CAAC;IACvB,CAAC;IAED,IAAW,IAAI;QACd,OAAO,QAAQ,CAAC,IAAI,CAAC,aAAa,CAAC,WAAW,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC,CAAC;IACjE,CAAC;IAEM,UAAU;QAChB,OAAO,IAAI,CAAC,MAAM,CAAC,MAAM,CAAC,UAAU,EAAE,CAAC;IACxC,CAAC;IAED,IAAW,QAAQ;QAClB,OAAO,SAAS,CAAC;IAClB,CAAC;IAED,IAAW,UAAU;QACpB,OAAO,IAAI,CAAC,CAAC,4CAA4C;IAC1D,CAAC;IAEM,OAAO;QACb,OAAO,IAAI,CAAC,eAAe,CAAC,OAAO,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;IACpD,CAAC;IAEM,UAAU;QAChB,OAAO,CAAC,CAAC,IAAI,CAAC,cAAc,EAAE,QAAQ,yCAAiC,CAAC;IACzE,CAAC;IAQM,KAAK,CAAC,MAAM,CAAC,OAAwB;QAC3C,OAAO,IAAI,CAAC,eAAe,CAAC,MAAM,CAAC,IAAI,CAAC,QAAQ,EAAE,OAAO,CAAC,CAAC;IAC5D,CAAC;IAEM,gBAAgB,CAAC,OAAsB;QAC7C,OAAO,IAAI,CAAC,eAAe,CAAC,IAAI,CAAC,IAAI,CAAC,QAAQ,EAAE,OAAO,CAAC,CAAC;IAC1D,CAAC;IAEM,KAAK,CAAC,kBAAkB,CAAC,QAAa,EAAE,cAAmB,EAAE,OAAsB;QACzF,OAAO,CAAC,CAAC,MAAM,IAAI,CAAC,eAAe,CAAC,MAAM,CAAC,QAAQ,EAAE,cAAc,EAAE,OAAO,CAAC,CAAC;IAC/E,CAAC;CACD,CAAA;AAjGY,qBAAqB;IA0B/B,WAAA,gBAAgB,CAAA;IAChB,WAAA,aAAa,CAAA;IACb,WAAA,iBAAiB,CAAA;GA5BP,qBAAqB,CAiGjC","file":"customTextEditorModel.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Emitter, Event } from '../../../../base/common/event.js';\nimport { IMarkdownString } from '../../../../base/common/htmlContent.js';\nimport { Disposable, IReference } from '../../../../base/common/lifecycle.js';\nimport { basename } from '../../../../base/common/path.js';\nimport { isEqual } from '../../../../base/common/resources.js';\nimport { URI } from '../../../../base/common/uri.js';\nimport { IResolvedTextEditorModel, ITextModelService } from '../../../../editor/common/services/resolverService.js';\nimport { localize } from '../../../../nls.js';\nimport { IInstantiationService } from '../../../../platform/instantiation/common/instantiation.js';\nimport { ILabelService } from '../../../../platform/label/common/label.js';\nimport { IRevertOptions, ISaveOptions } from '../../../common/editor.js';\nimport { ICustomEditorModel } from './customEditor.js';\nimport { IExtensionService } from '../../../../workbench/services/extensions/common/extensions.js';\nimport { ITextFileEditorModel, ITextFileService, TextFileEditorModelState } from '../../../services/textfile/common/textfiles.js';\n\nexport class CustomTextEditorModel extends Disposable implements ICustomEditorModel {\n\n\tpublic static async create(\n\t\tinstantiationService: IInstantiationService,\n\t\tviewType: string,\n\t\tresource: URI\n\t): Promise<CustomTextEditorModel> {\n\t\treturn instantiationService.invokeFunction(async accessor => {\n\t\t\tconst textModelResolverService = accessor.get(ITextModelService);\n\t\t\tconst model = await textModelResolverService.createModelReference(resource);\n\t\t\treturn instantiationService.createInstance(CustomTextEditorModel, viewType, resource, model);\n\t\t});\n\t}\n\n\tprivate readonly _textFileModel: ITextFileEditorModel | undefined;\n\n\tprivate readonly _onDidChangeOrphaned = this._register(new Emitter<void>());\n\tpublic readonly onDidChangeOrphaned = this._onDidChangeOrphaned.event;\n\n\tprivate readonly _onDidChangeReadonly = this._register(new Emitter<void>());\n\tpublic readonly onDidChangeReadonly = this._onDidChangeReadonly.event;\n\n\tconstructor(\n\t\tpublic readonly viewType: string,\n\t\tprivate readonly _resource: URI,\n\t\tprivate readonly _model: IReference<IResolvedTextEditorModel>,\n\t\t@ITextFileService private readonly textFileService: ITextFileService,\n\t\t@ILabelService private readonly _labelService: ILabelService,\n\t\t@IExtensionService extensionService: IExtensionService,\n\t) {\n\t\tsuper();\n\n\t\tthis._register(_model);\n\n\t\tthis._textFileModel = this.textFileService.files.get(_resource);\n\t\tif (this._textFileModel) {\n\t\t\tthis._register(this._textFileModel.onDidChangeOrphaned(() => this._onDidChangeOrphaned.fire()));\n\t\t\tthis._register(this._textFileModel.onDidChangeReadonly(() => this._onDidChangeReadonly.fire()));\n\t\t}\n\n\t\tthis._register(this.textFileService.files.onDidChangeDirty(e => {\n\t\t\tif (isEqual(this.resource, e.resource)) {\n\t\t\t\tthis._onDidChangeDirty.fire();\n\t\t\t\tthis._onDidChangeContent.fire();\n\t\t\t}\n\t\t}));\n\n\t\tthis._register(extensionService.onWillStop(e => {\n\t\t\te.veto(true, localize('vetoExtHostRestart', \"An extension provided text editor for '{0}' is still open that would close otherwise.\", this.name));\n\t\t}));\n\t}\n\n\tpublic get resource() {\n\t\treturn this._resource;\n\t}\n\n\tpublic get name() {\n\t\treturn basename(this._labelService.getUriLabel(this._resource));\n\t}\n\n\tpublic isReadonly(): boolean | IMarkdownString {\n\t\treturn this._model.object.isReadonly();\n\t}\n\n\tpublic get backupId() {\n\t\treturn undefined;\n\t}\n\n\tpublic get canHotExit() {\n\t\treturn true; // ensured via backups from text file models\n\t}\n\n\tpublic isDirty(): boolean {\n\t\treturn this.textFileService.isDirty(this.resource);\n\t}\n\n\tpublic isOrphaned(): boolean {\n\t\treturn !!this._textFileModel?.hasState(TextFileEditorModelState.ORPHAN);\n\t}\n\n\tprivate readonly _onDidChangeDirty: Emitter<void> = this._register(new Emitter<void>());\n\treadonly onDidChangeDirty: Event<void> = this._onDidChangeDirty.event;\n\n\tprivate readonly _onDidChangeContent: Emitter<void> = this._register(new Emitter<void>());\n\treadonly onDidChangeContent: Event<void> = this._onDidChangeContent.event;\n\n\tpublic async revert(options?: IRevertOptions) {\n\t\treturn this.textFileService.revert(this.resource, options);\n\t}\n\n\tpublic saveCustomEditor(options?: ISaveOptions): Promise<URI | undefined> {\n\t\treturn this.textFileService.save(this.resource, options);\n\t}\n\n\tpublic async saveCustomEditorAs(resource: URI, targetResource: URI, options?: ISaveOptions): Promise<boolean> {\n\t\treturn !!await this.textFileService.saveAs(resource, targetResource, options);\n\t}\n}\n"]}