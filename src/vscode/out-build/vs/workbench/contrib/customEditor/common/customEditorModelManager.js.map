{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/contrib/customEditor/common/customEditorModelManager.ts","vs/workbench/contrib/customEditor/common/customEditorModelManager.ts"],"names":[],"mappings":"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","file":"customEditorModelManager.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { createSingleCallFunction } from '../../../../base/common/functional.js';\nimport { IReference } from '../../../../base/common/lifecycle.js';\nimport { URI } from '../../../../base/common/uri.js';\nimport { ICustomEditorModel, ICustomEditorModelManager } from './customEditor.js';\n\nexport class CustomEditorModelManager implements ICustomEditorModelManager {\n\n\tprivate readonly _references = new Map<string, {\n\t\treadonly viewType: string;\n\t\treadonly model: Promise<ICustomEditorModel>;\n\t\tcounter: number;\n\t}>();\n\n\tpublic async getAllModels(resource: URI): Promise<ICustomEditorModel[]> {\n\t\tconst keyStart = `${resource.toString()}@@@`;\n\t\tconst models = [];\n\t\tfor (const [key, entry] of this._references) {\n\t\t\tif (key.startsWith(keyStart) && entry.model) {\n\t\t\t\tmodels.push(await entry.model);\n\t\t\t}\n\t\t}\n\t\treturn models;\n\t}\n\tpublic async get(resource: URI, viewType: string): Promise<ICustomEditorModel | undefined> {\n\t\tconst key = this.key(resource, viewType);\n\t\tconst entry = this._references.get(key);\n\t\treturn entry?.model;\n\t}\n\n\tpublic tryRetain(resource: URI, viewType: string): Promise<IReference<ICustomEditorModel>> | undefined {\n\t\tconst key = this.key(resource, viewType);\n\n\t\tconst entry = this._references.get(key);\n\t\tif (!entry) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\tentry.counter++;\n\n\t\treturn entry.model.then(model => {\n\t\t\treturn {\n\t\t\t\tobject: model,\n\t\t\t\tdispose: createSingleCallFunction(() => {\n\t\t\t\t\tif (--entry.counter <= 0) {\n\t\t\t\t\t\tentry.model.then(x => x.dispose());\n\t\t\t\t\t\tthis._references.delete(key);\n\t\t\t\t\t}\n\t\t\t\t}),\n\t\t\t};\n\t\t});\n\t}\n\n\tpublic add(resource: URI, viewType: string, model: Promise<ICustomEditorModel>): Promise<IReference<ICustomEditorModel>> {\n\t\tconst key = this.key(resource, viewType);\n\t\tconst existing = this._references.get(key);\n\t\tif (existing) {\n\t\t\tthrow new Error('Model already exists');\n\t\t}\n\n\t\tthis._references.set(key, { viewType, model, counter: 0 });\n\t\treturn this.tryRetain(resource, viewType)!;\n\t}\n\n\tpublic disposeAllModelsForView(viewType: string): void {\n\t\tfor (const [key, value] of this._references) {\n\t\t\tif (value.viewType === viewType) {\n\t\t\t\tvalue.model.then(x => x.dispose());\n\t\t\t\tthis._references.delete(key);\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate key(resource: URI, viewType: string): string {\n\t\treturn `${resource.toString()}@@@${viewType}`;\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { createSingleCallFunction } from '../../../../base/common/functional.js';\nimport { IReference } from '../../../../base/common/lifecycle.js';\nimport { URI } from '../../../../base/common/uri.js';\nimport { ICustomEditorModel, ICustomEditorModelManager } from './customEditor.js';\n\nexport class CustomEditorModelManager implements ICustomEditorModelManager {\n\n\tprivate readonly _references = new Map<string, {\n\t\treadonly viewType: string;\n\t\treadonly model: Promise<ICustomEditorModel>;\n\t\tcounter: number;\n\t}>();\n\n\tpublic async getAllModels(resource: URI): Promise<ICustomEditorModel[]> {\n\t\tconst keyStart = `${resource.toString()}@@@`;\n\t\tconst models = [];\n\t\tfor (const [key, entry] of this._references) {\n\t\t\tif (key.startsWith(keyStart) && entry.model) {\n\t\t\t\tmodels.push(await entry.model);\n\t\t\t}\n\t\t}\n\t\treturn models;\n\t}\n\tpublic async get(resource: URI, viewType: string): Promise<ICustomEditorModel | undefined> {\n\t\tconst key = this.key(resource, viewType);\n\t\tconst entry = this._references.get(key);\n\t\treturn entry?.model;\n\t}\n\n\tpublic tryRetain(resource: URI, viewType: string): Promise<IReference<ICustomEditorModel>> | undefined {\n\t\tconst key = this.key(resource, viewType);\n\n\t\tconst entry = this._references.get(key);\n\t\tif (!entry) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\tentry.counter++;\n\n\t\treturn entry.model.then(model => {\n\t\t\treturn {\n\t\t\t\tobject: model,\n\t\t\t\tdispose: createSingleCallFunction(() => {\n\t\t\t\t\tif (--entry.counter <= 0) {\n\t\t\t\t\t\tentry.model.then(x => x.dispose());\n\t\t\t\t\t\tthis._references.delete(key);\n\t\t\t\t\t}\n\t\t\t\t}),\n\t\t\t};\n\t\t});\n\t}\n\n\tpublic add(resource: URI, viewType: string, model: Promise<ICustomEditorModel>): Promise<IReference<ICustomEditorModel>> {\n\t\tconst key = this.key(resource, viewType);\n\t\tconst existing = this._references.get(key);\n\t\tif (existing) {\n\t\t\tthrow new Error('Model already exists');\n\t\t}\n\n\t\tthis._references.set(key, { viewType, model, counter: 0 });\n\t\treturn this.tryRetain(resource, viewType)!;\n\t}\n\n\tpublic disposeAllModelsForView(viewType: string): void {\n\t\tfor (const [key, value] of this._references) {\n\t\t\tif (value.viewType === viewType) {\n\t\t\t\tvalue.model.then(x => x.dispose());\n\t\t\t\tthis._references.delete(key);\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate key(resource: URI, viewType: string): string {\n\t\treturn `${resource.toString()}@@@${viewType}`;\n\t}\n}\n"]}