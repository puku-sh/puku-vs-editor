{"version":3,"sources":["vs/workbench/contrib/speech/browser/speechService.ts"],"names":[],"mappings":"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","file":"speechService.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { localize } from '../../../../nls.js';\nimport { CancellationToken, CancellationTokenSource } from '../../../../base/common/cancellation.js';\nimport { Emitter, Event } from '../../../../base/common/event.js';\nimport { Disposable, DisposableStore, IDisposable, toDisposable } from '../../../../base/common/lifecycle.js';\nimport { IContextKey, IContextKeyService } from '../../../../platform/contextkey/common/contextkey.js';\nimport { ILogService } from '../../../../platform/log/common/log.js';\nimport { IHostService } from '../../../services/host/browser/host.js';\nimport { DeferredPromise } from '../../../../base/common/async.js';\nimport { ISpeechService, ISpeechProvider, HasSpeechProvider, ISpeechToTextSession, SpeechToTextInProgress, KeywordRecognitionStatus, SpeechToTextStatus, speechLanguageConfigToLanguage, SPEECH_LANGUAGE_CONFIG, ITextToSpeechSession, TextToSpeechInProgress, TextToSpeechStatus } from '../common/speechService.js';\nimport { ITelemetryService } from '../../../../platform/telemetry/common/telemetry.js';\nimport { IConfigurationService } from '../../../../platform/configuration/common/configuration.js';\nimport { ExtensionsRegistry } from '../../../services/extensions/common/extensionsRegistry.js';\nimport { IExtensionService } from '../../../services/extensions/common/extensions.js';\n\nexport interface ISpeechProviderDescriptor {\n\treadonly name: string;\n\treadonly description?: string;\n}\n\nconst speechProvidersExtensionPoint = ExtensionsRegistry.registerExtensionPoint<ISpeechProviderDescriptor[]>({\n\textensionPoint: 'speechProviders',\n\tjsonSchema: {\n\t\tdescription: localize('vscode.extension.contributes.speechProvider', 'Contributes a Speech Provider'),\n\t\ttype: 'array',\n\t\titems: {\n\t\t\tadditionalProperties: false,\n\t\t\ttype: 'object',\n\t\t\tdefaultSnippets: [{ body: { name: '', description: '' } }],\n\t\t\trequired: ['name'],\n\t\t\tproperties: {\n\t\t\t\tname: {\n\t\t\t\t\tdescription: localize('speechProviderName', \"Unique name for this Speech Provider.\"),\n\t\t\t\t\ttype: 'string'\n\t\t\t\t},\n\t\t\t\tdescription: {\n\t\t\t\t\tdescription: localize('speechProviderDescription', \"A description of this Speech Provider, shown in the UI.\"),\n\t\t\t\t\ttype: 'string'\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n});\n\nexport class SpeechService extends Disposable implements ISpeechService {\n\n\treadonly _serviceBrand: undefined;\n\n\tprivate readonly _onDidChangeHasSpeechProvider = this._register(new Emitter<void>());\n\treadonly onDidChangeHasSpeechProvider = this._onDidChangeHasSpeechProvider.event;\n\n\tget hasSpeechProvider() { return this.providerDescriptors.size > 0 || this.providers.size > 0; }\n\n\tprivate readonly providers = new Map<string, ISpeechProvider>();\n\tprivate readonly providerDescriptors = new Map<string, ISpeechProviderDescriptor>();\n\n\tprivate readonly hasSpeechProviderContext: IContextKey<boolean>;\n\n\tconstructor(\n\t\t@ILogService private readonly logService: ILogService,\n\t\t@IContextKeyService contextKeyService: IContextKeyService,\n\t\t@IHostService private readonly hostService: IHostService,\n\t\t@ITelemetryService private readonly telemetryService: ITelemetryService,\n\t\t@IConfigurationService private readonly configurationService: IConfigurationService,\n\t\t@IExtensionService private readonly extensionService: IExtensionService\n\t) {\n\t\tsuper();\n\n\t\tthis.hasSpeechProviderContext = HasSpeechProvider.bindTo(contextKeyService);\n\t\tthis.textToSpeechInProgress = TextToSpeechInProgress.bindTo(contextKeyService);\n\t\tthis.speechToTextInProgress = SpeechToTextInProgress.bindTo(contextKeyService);\n\n\t\tthis.handleAndRegisterSpeechExtensions();\n\t}\n\n\tprivate handleAndRegisterSpeechExtensions(): void {\n\t\tspeechProvidersExtensionPoint.setHandler((extensions, delta) => {\n\t\t\tconst oldHasSpeechProvider = this.hasSpeechProvider;\n\n\t\t\tfor (const extension of delta.removed) {\n\t\t\t\tfor (const descriptor of extension.value) {\n\t\t\t\t\tthis.providerDescriptors.delete(descriptor.name);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfor (const extension of delta.added) {\n\t\t\t\tfor (const descriptor of extension.value) {\n\t\t\t\t\tthis.providerDescriptors.set(descriptor.name, descriptor);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (oldHasSpeechProvider !== this.hasSpeechProvider) {\n\t\t\t\tthis.handleHasSpeechProviderChange();\n\t\t\t}\n\t\t});\n\t}\n\n\tregisterSpeechProvider(identifier: string, provider: ISpeechProvider): IDisposable {\n\t\tif (this.providers.has(identifier)) {\n\t\t\tthrow new Error(`Speech provider with identifier ${identifier} is already registered.`);\n\t\t}\n\n\t\tconst oldHasSpeechProvider = this.hasSpeechProvider;\n\n\t\tthis.providers.set(identifier, provider);\n\n\t\tif (oldHasSpeechProvider !== this.hasSpeechProvider) {\n\t\t\tthis.handleHasSpeechProviderChange();\n\t\t}\n\n\t\treturn toDisposable(() => {\n\t\t\tconst oldHasSpeechProvider = this.hasSpeechProvider;\n\n\t\t\tthis.providers.delete(identifier);\n\n\t\t\tif (oldHasSpeechProvider !== this.hasSpeechProvider) {\n\t\t\t\tthis.handleHasSpeechProviderChange();\n\t\t\t}\n\t\t});\n\t}\n\n\tprivate handleHasSpeechProviderChange(): void {\n\t\tthis.hasSpeechProviderContext.set(this.hasSpeechProvider);\n\n\t\tthis._onDidChangeHasSpeechProvider.fire();\n\t}\n\n\t//#region Speech to Text\n\n\tprivate readonly _onDidStartSpeechToTextSession = this._register(new Emitter<void>());\n\treadonly onDidStartSpeechToTextSession = this._onDidStartSpeechToTextSession.event;\n\n\tprivate readonly _onDidEndSpeechToTextSession = this._register(new Emitter<void>());\n\treadonly onDidEndSpeechToTextSession = this._onDidEndSpeechToTextSession.event;\n\n\tprivate activeSpeechToTextSessions = 0;\n\tget hasActiveSpeechToTextSession() { return this.activeSpeechToTextSessions > 0; }\n\n\tprivate readonly speechToTextInProgress: IContextKey<boolean>;\n\n\tasync createSpeechToTextSession(token: CancellationToken, context: string = 'speech'): Promise<ISpeechToTextSession> {\n\t\tconst provider = await this.getProvider();\n\n\t\tconst language = speechLanguageConfigToLanguage(this.configurationService.getValue<unknown>(SPEECH_LANGUAGE_CONFIG));\n\t\tconst session = provider.createSpeechToTextSession(token, typeof language === 'string' ? { language } : undefined);\n\n\t\tconst sessionStart = Date.now();\n\t\tlet sessionRecognized = false;\n\t\tlet sessionError = false;\n\t\tlet sessionContentLength = 0;\n\n\t\tconst disposables = new DisposableStore();\n\n\t\tconst onSessionStoppedOrCanceled = () => {\n\t\t\tthis.activeSpeechToTextSessions = Math.max(0, this.activeSpeechToTextSessions - 1);\n\t\t\tif (!this.hasActiveSpeechToTextSession) {\n\t\t\t\tthis.speechToTextInProgress.reset();\n\t\t\t}\n\t\t\tthis._onDidEndSpeechToTextSession.fire();\n\n\t\t\ttype SpeechToTextSessionClassification = {\n\t\t\t\towner: 'bpasero';\n\t\t\t\tcomment: 'An event that fires when a speech to text session is created';\n\t\t\t\tcontext: { classification: 'SystemMetaData'; purpose: 'FeatureInsight'; comment: 'Context of the session.' };\n\t\t\t\tsessionDuration: { classification: 'SystemMetaData'; purpose: 'FeatureInsight'; comment: 'Duration of the session.' };\n\t\t\t\tsessionRecognized: { classification: 'SystemMetaData'; purpose: 'FeatureInsight'; comment: 'If speech was recognized.' };\n\t\t\t\tsessionError: { classification: 'SystemMetaData'; purpose: 'FeatureInsight'; comment: 'If speech resulted in error.' };\n\t\t\t\tsessionContentLength: { classification: 'SystemMetaData'; purpose: 'FeatureInsight'; comment: 'Length of the recognized text.' };\n\t\t\t\tsessionLanguage: { classification: 'SystemMetaData'; purpose: 'FeatureInsight'; comment: 'Configured language for the session.' };\n\t\t\t};\n\t\t\ttype SpeechToTextSessionEvent = {\n\t\t\t\tcontext: string;\n\t\t\t\tsessionDuration: number;\n\t\t\t\tsessionRecognized: boolean;\n\t\t\t\tsessionError: boolean;\n\t\t\t\tsessionContentLength: number;\n\t\t\t\tsessionLanguage: string;\n\t\t\t};\n\t\t\tthis.telemetryService.publicLog2<SpeechToTextSessionEvent, SpeechToTextSessionClassification>('speechToTextSession', {\n\t\t\t\tcontext,\n\t\t\t\tsessionDuration: Date.now() - sessionStart,\n\t\t\t\tsessionRecognized,\n\t\t\t\tsessionError,\n\t\t\t\tsessionContentLength,\n\t\t\t\tsessionLanguage: language\n\t\t\t});\n\n\t\t\tdisposables.dispose();\n\t\t};\n\n\t\tdisposables.add(token.onCancellationRequested(() => onSessionStoppedOrCanceled()));\n\t\tif (token.isCancellationRequested) {\n\t\t\tonSessionStoppedOrCanceled();\n\t\t}\n\n\t\tdisposables.add(session.onDidChange(e => {\n\t\t\tswitch (e.status) {\n\t\t\t\tcase SpeechToTextStatus.Started:\n\t\t\t\t\tthis.activeSpeechToTextSessions++;\n\t\t\t\t\tthis.speechToTextInProgress.set(true);\n\t\t\t\t\tthis._onDidStartSpeechToTextSession.fire();\n\t\t\t\t\tbreak;\n\t\t\t\tcase SpeechToTextStatus.Recognizing:\n\t\t\t\t\tsessionRecognized = true;\n\t\t\t\t\tbreak;\n\t\t\t\tcase SpeechToTextStatus.Recognized:\n\t\t\t\t\tif (typeof e.text === 'string') {\n\t\t\t\t\t\tsessionContentLength += e.text.length;\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase SpeechToTextStatus.Stopped:\n\t\t\t\t\tonSessionStoppedOrCanceled();\n\t\t\t\t\tbreak;\n\t\t\t\tcase SpeechToTextStatus.Error:\n\t\t\t\t\tthis.logService.error(`Speech provider error in speech to text session: ${e.text}`);\n\t\t\t\t\tsessionError = true;\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}));\n\n\t\treturn session;\n\t}\n\n\tprivate async getProvider(): Promise<ISpeechProvider> {\n\n\t\t// Send out extension activation to ensure providers can register\n\t\tawait this.extensionService.activateByEvent('onSpeech');\n\n\t\tconst provider = Array.from(this.providers.values()).at(0);\n\t\tif (!provider) {\n\t\t\tthrow new Error(`No Speech provider is registered.`);\n\t\t} else if (this.providers.size > 1) {\n\t\t\tthis.logService.warn(`Multiple speech providers registered. Picking first one: ${provider.metadata.displayName}`);\n\t\t}\n\n\t\treturn provider;\n\t}\n\n\t//#endregion\n\n\t//#region Text to Speech\n\n\tprivate readonly _onDidStartTextToSpeechSession = this._register(new Emitter<void>());\n\treadonly onDidStartTextToSpeechSession = this._onDidStartTextToSpeechSession.event;\n\n\tprivate readonly _onDidEndTextToSpeechSession = this._register(new Emitter<void>());\n\treadonly onDidEndTextToSpeechSession = this._onDidEndTextToSpeechSession.event;\n\n\tprivate activeTextToSpeechSessions = 0;\n\tget hasActiveTextToSpeechSession() { return this.activeTextToSpeechSessions > 0; }\n\n\tprivate readonly textToSpeechInProgress: IContextKey<boolean>;\n\n\tasync createTextToSpeechSession(token: CancellationToken, context: string = 'speech'): Promise<ITextToSpeechSession> {\n\t\tconst provider = await this.getProvider();\n\n\t\tconst language = speechLanguageConfigToLanguage(this.configurationService.getValue<unknown>(SPEECH_LANGUAGE_CONFIG));\n\t\tconst session = provider.createTextToSpeechSession(token, typeof language === 'string' ? { language } : undefined);\n\n\t\tconst sessionStart = Date.now();\n\t\tlet sessionError = false;\n\n\t\tconst disposables = new DisposableStore();\n\n\t\tconst onSessionStoppedOrCanceled = (dispose: boolean) => {\n\t\t\tthis.activeTextToSpeechSessions = Math.max(0, this.activeTextToSpeechSessions - 1);\n\t\t\tif (!this.hasActiveTextToSpeechSession) {\n\t\t\t\tthis.textToSpeechInProgress.reset();\n\t\t\t}\n\t\t\tthis._onDidEndTextToSpeechSession.fire();\n\n\t\t\ttype TextToSpeechSessionClassification = {\n\t\t\t\towner: 'bpasero';\n\t\t\t\tcomment: 'An event that fires when a text to speech session is created';\n\t\t\t\tcontext: { classification: 'SystemMetaData'; purpose: 'FeatureInsight'; comment: 'Context of the session.' };\n\t\t\t\tsessionDuration: { classification: 'SystemMetaData'; purpose: 'FeatureInsight'; comment: 'Duration of the session.' };\n\t\t\t\tsessionError: { classification: 'SystemMetaData'; purpose: 'FeatureInsight'; comment: 'If speech resulted in error.' };\n\t\t\t\tsessionLanguage: { classification: 'SystemMetaData'; purpose: 'FeatureInsight'; comment: 'Configured language for the session.' };\n\t\t\t};\n\t\t\ttype TextToSpeechSessionEvent = {\n\t\t\t\tcontext: string;\n\t\t\t\tsessionDuration: number;\n\t\t\t\tsessionError: boolean;\n\t\t\t\tsessionLanguage: string;\n\t\t\t};\n\t\t\tthis.telemetryService.publicLog2<TextToSpeechSessionEvent, TextToSpeechSessionClassification>('textToSpeechSession', {\n\t\t\t\tcontext,\n\t\t\t\tsessionDuration: Date.now() - sessionStart,\n\t\t\t\tsessionError,\n\t\t\t\tsessionLanguage: language\n\t\t\t});\n\n\t\t\tif (dispose) {\n\t\t\t\tdisposables.dispose();\n\t\t\t}\n\t\t};\n\n\t\tdisposables.add(token.onCancellationRequested(() => onSessionStoppedOrCanceled(true)));\n\t\tif (token.isCancellationRequested) {\n\t\t\tonSessionStoppedOrCanceled(true);\n\t\t}\n\n\t\tdisposables.add(session.onDidChange(e => {\n\t\t\tswitch (e.status) {\n\t\t\t\tcase TextToSpeechStatus.Started:\n\t\t\t\t\tthis.activeTextToSpeechSessions++;\n\t\t\t\t\tthis.textToSpeechInProgress.set(true);\n\t\t\t\t\tthis._onDidStartTextToSpeechSession.fire();\n\t\t\t\t\tbreak;\n\t\t\t\tcase TextToSpeechStatus.Stopped:\n\t\t\t\t\tonSessionStoppedOrCanceled(false);\n\t\t\t\t\tbreak;\n\t\t\t\tcase TextToSpeechStatus.Error:\n\t\t\t\t\tthis.logService.error(`Speech provider error in text to speech session: ${e.text}`);\n\t\t\t\t\tsessionError = true;\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}));\n\n\t\treturn session;\n\t}\n\n\t//#endregion\n\n\t//#region Keyword Recognition\n\n\tprivate readonly _onDidStartKeywordRecognition = this._register(new Emitter<void>());\n\treadonly onDidStartKeywordRecognition = this._onDidStartKeywordRecognition.event;\n\n\tprivate readonly _onDidEndKeywordRecognition = this._register(new Emitter<void>());\n\treadonly onDidEndKeywordRecognition = this._onDidEndKeywordRecognition.event;\n\n\tprivate activeKeywordRecognitionSessions = 0;\n\tget hasActiveKeywordRecognition() { return this.activeKeywordRecognitionSessions > 0; }\n\n\tasync recognizeKeyword(token: CancellationToken): Promise<KeywordRecognitionStatus> {\n\t\tconst result = new DeferredPromise<KeywordRecognitionStatus>();\n\n\t\tconst disposables = new DisposableStore();\n\t\tdisposables.add(token.onCancellationRequested(() => {\n\t\t\tdisposables.dispose();\n\t\t\tresult.complete(KeywordRecognitionStatus.Canceled);\n\t\t}));\n\n\t\tconst recognizeKeywordDisposables = disposables.add(new DisposableStore());\n\t\tlet activeRecognizeKeywordSession: Promise<void> | undefined = undefined;\n\t\tconst recognizeKeyword = () => {\n\t\t\trecognizeKeywordDisposables.clear();\n\n\t\t\tconst cts = new CancellationTokenSource(token);\n\t\t\trecognizeKeywordDisposables.add(toDisposable(() => cts.dispose(true)));\n\t\t\tconst currentRecognizeKeywordSession = activeRecognizeKeywordSession = this.doRecognizeKeyword(cts.token).then(status => {\n\t\t\t\tif (currentRecognizeKeywordSession === activeRecognizeKeywordSession) {\n\t\t\t\t\tresult.complete(status);\n\t\t\t\t}\n\t\t\t}, error => {\n\t\t\t\tif (currentRecognizeKeywordSession === activeRecognizeKeywordSession) {\n\t\t\t\t\tresult.error(error);\n\t\t\t\t}\n\t\t\t});\n\t\t};\n\n\t\tdisposables.add(this.hostService.onDidChangeFocus(focused => {\n\t\t\tif (!focused && activeRecognizeKeywordSession) {\n\t\t\t\trecognizeKeywordDisposables.clear();\n\t\t\t\tactiveRecognizeKeywordSession = undefined;\n\t\t\t} else if (!activeRecognizeKeywordSession) {\n\t\t\t\trecognizeKeyword();\n\t\t\t}\n\t\t}));\n\n\t\tif (this.hostService.hasFocus) {\n\t\t\trecognizeKeyword();\n\t\t}\n\n\t\tlet status: KeywordRecognitionStatus;\n\t\ttry {\n\t\t\tstatus = await result.p;\n\t\t} finally {\n\t\t\tdisposables.dispose();\n\t\t}\n\n\t\ttype KeywordRecognitionClassification = {\n\t\t\towner: 'bpasero';\n\t\t\tcomment: 'An event that fires when a speech keyword detection is started';\n\t\t\tkeywordRecognized: { classification: 'SystemMetaData'; purpose: 'FeatureInsight'; comment: 'If the keyword was recognized.' };\n\t\t};\n\t\ttype KeywordRecognitionEvent = {\n\t\t\tkeywordRecognized: boolean;\n\t\t};\n\t\tthis.telemetryService.publicLog2<KeywordRecognitionEvent, KeywordRecognitionClassification>('keywordRecognition', {\n\t\t\tkeywordRecognized: status === KeywordRecognitionStatus.Recognized\n\t\t});\n\n\t\treturn status;\n\t}\n\n\tprivate async doRecognizeKeyword(token: CancellationToken): Promise<KeywordRecognitionStatus> {\n\t\tconst provider = await this.getProvider();\n\n\t\tconst session = provider.createKeywordRecognitionSession(token);\n\t\tthis.activeKeywordRecognitionSessions++;\n\t\tthis._onDidStartKeywordRecognition.fire();\n\n\t\tconst disposables = new DisposableStore();\n\n\t\tconst onSessionStoppedOrCanceled = () => {\n\t\t\tthis.activeKeywordRecognitionSessions = Math.max(0, this.activeKeywordRecognitionSessions - 1);\n\t\t\tthis._onDidEndKeywordRecognition.fire();\n\n\t\t\tdisposables.dispose();\n\t\t};\n\n\t\tdisposables.add(token.onCancellationRequested(() => onSessionStoppedOrCanceled()));\n\t\tif (token.isCancellationRequested) {\n\t\t\tonSessionStoppedOrCanceled();\n\t\t}\n\n\t\tdisposables.add(session.onDidChange(e => {\n\t\t\tif (e.status === KeywordRecognitionStatus.Stopped) {\n\t\t\t\tonSessionStoppedOrCanceled();\n\t\t\t}\n\t\t}));\n\n\t\ttry {\n\t\t\treturn (await Event.toPromise(session.onDidChange)).status;\n\t\t} finally {\n\t\t\tonSessionStoppedOrCanceled();\n\t\t}\n\t}\n\n\t//#endregion\n}\n"]}