{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/contrib/preferences/common/settingsFilesystemProvider.ts","vs/workbench/contrib/preferences/common/settingsFilesystemProvider.ts"],"names":[],"mappings":"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","file":"settingsFilesystemProvider.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { NotSupportedError } from '../../../../base/common/errors.js';\nimport { IDisposable, Disposable } from '../../../../base/common/lifecycle.js';\nimport { Schemas } from '../../../../base/common/network.js';\nimport { URI } from '../../../../base/common/uri.js';\nimport { FileChangeType, FilePermission, FileSystemProviderCapabilities, FileSystemProviderErrorCode, FileType, IFileChange, IFileDeleteOptions, IFileOverwriteOptions, IFileSystemProviderWithFileReadWriteCapability, IStat, IWatchOptions } from '../../../../platform/files/common/files.js';\nimport { IPreferencesService } from '../../../services/preferences/common/preferences.js';\nimport { Event, Emitter } from '../../../../base/common/event.js';\nimport { Registry } from '../../../../platform/registry/common/platform.js';\nimport * as JSONContributionRegistry from '../../../../platform/jsonschemas/common/jsonContributionRegistry.js';\nimport { VSBuffer } from '../../../../base/common/buffer.js';\nimport { ILogService, LogLevel } from '../../../../platform/log/common/log.js';\nimport { isEqual } from '../../../../base/common/resources.js';\n\nconst schemaRegistry = Registry.as<JSONContributionRegistry.IJSONContributionRegistry>(JSONContributionRegistry.Extensions.JSONContribution);\n\n\nexport class SettingsFileSystemProvider extends Disposable implements IFileSystemProviderWithFileReadWriteCapability {\n\n\tstatic readonly SCHEMA = Schemas.vscode;\n\n\tprotected readonly _onDidChangeFile = this._register(new Emitter<readonly IFileChange[]>());\n\treadonly onDidChangeFile = this._onDidChangeFile.event;\n\n\tprivate static SCHEMA_ASSOCIATIONS = URI.parse(`${Schemas.vscode}://schemas-associations/schemas-associations.json`);\n\n\tconstructor(\n\t\t@IPreferencesService private readonly preferencesService: IPreferencesService,\n\t\t@ILogService private readonly logService: ILogService\n\t) {\n\t\tsuper();\n\t\tthis._register(schemaRegistry.onDidChangeSchema(schemaUri => {\n\t\t\tthis._onDidChangeFile.fire([{ resource: URI.parse(schemaUri), type: FileChangeType.UPDATED }]);\n\t\t}));\n\t\tthis._register(schemaRegistry.onDidChangeSchemaAssociations(() => {\n\t\t\tthis._onDidChangeFile.fire([{ resource: SettingsFileSystemProvider.SCHEMA_ASSOCIATIONS, type: FileChangeType.UPDATED }]);\n\t\t}));\n\t\tthis._register(preferencesService.onDidDefaultSettingsContentChanged(uri => {\n\t\t\tthis._onDidChangeFile.fire([{ resource: uri, type: FileChangeType.UPDATED }]);\n\t\t}));\n\t}\n\n\treadonly capabilities: FileSystemProviderCapabilities = FileSystemProviderCapabilities.Readonly + FileSystemProviderCapabilities.FileReadWrite;\n\n\tasync readFile(uri: URI): Promise<Uint8Array> {\n\t\tif (uri.scheme !== SettingsFileSystemProvider.SCHEMA) {\n\t\t\tthrow new NotSupportedError();\n\t\t}\n\t\tlet content: string | undefined;\n\t\tif (uri.authority === 'schemas') {\n\t\t\tcontent = this.getSchemaContent(uri);\n\t\t} else if (uri.authority === SettingsFileSystemProvider.SCHEMA_ASSOCIATIONS.authority) {\n\t\t\tcontent = JSON.stringify(schemaRegistry.getSchemaAssociations());\n\t\t} else if (uri.authority === 'defaultsettings') {\n\t\t\tcontent = this.preferencesService.getDefaultSettingsContent(uri);\n\t\t}\n\t\tif (content) {\n\t\t\treturn VSBuffer.fromString(content).buffer;\n\t\t}\n\t\tthrow FileSystemProviderErrorCode.FileNotFound;\n\t}\n\n\tasync stat(uri: URI): Promise<IStat> {\n\t\tif (schemaRegistry.hasSchemaContent(uri.toString()) || this.preferencesService.hasDefaultSettingsContent(uri)) {\n\t\t\tconst currentTime = Date.now();\n\t\t\treturn {\n\t\t\t\ttype: FileType.File,\n\t\t\t\tpermissions: FilePermission.Readonly,\n\t\t\t\tmtime: currentTime,\n\t\t\t\tctime: currentTime,\n\t\t\t\tsize: 0\n\t\t\t};\n\t\t}\n\t\tif (isEqual(uri, SettingsFileSystemProvider.SCHEMA_ASSOCIATIONS)) {\n\t\t\tconst currentTime = Date.now();\n\t\t\treturn {\n\t\t\t\ttype: FileType.File,\n\t\t\t\tpermissions: FilePermission.Readonly,\n\t\t\t\tmtime: currentTime,\n\t\t\t\tctime: currentTime,\n\t\t\t\tsize: 0\n\t\t\t};\n\t\t}\n\t\tthrow FileSystemProviderErrorCode.FileNotFound;\n\t}\n\n\treadonly onDidChangeCapabilities = Event.None;\n\n\twatch(resource: URI, opts: IWatchOptions): IDisposable { return Disposable.None; }\n\n\tasync mkdir(resource: URI): Promise<void> { }\n\tasync readdir(resource: URI): Promise<[string, FileType][]> { return []; }\n\n\tasync rename(from: URI, to: URI, opts: IFileOverwriteOptions): Promise<void> { }\n\tasync delete(resource: URI, opts: IFileDeleteOptions): Promise<void> { }\n\n\tasync writeFile() {\n\t\tthrow new NotSupportedError();\n\t}\n\n\tprivate getSchemaContent(uri: URI): string {\n\t\tconst startTime = Date.now();\n\t\tconst content = schemaRegistry.getSchemaContent(uri.toString()) ?? '{}' /* Use empty schema if not yet registered */;\n\t\tconst logLevel = this.logService.getLevel();\n\t\tif (logLevel === LogLevel.Debug || logLevel === LogLevel.Trace) {\n\t\t\tconst endTime = Date.now();\n\t\t\tconst uncompressed = JSON.stringify(schemaRegistry.getSchemaContributions().schemas[uri.toString()]);\n\t\t\tthis.logService.debug(`${uri.toString()}: ${uncompressed.length} -> ${content.length} (${Math.round((uncompressed.length - content.length) / uncompressed.length * 100)}%) Took ${endTime - startTime}ms`);\n\t\t}\n\t\treturn content;\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { NotSupportedError } from '../../../../base/common/errors.js';\nimport { IDisposable, Disposable } from '../../../../base/common/lifecycle.js';\nimport { Schemas } from '../../../../base/common/network.js';\nimport { URI } from '../../../../base/common/uri.js';\nimport { FileChangeType, FilePermission, FileSystemProviderCapabilities, FileSystemProviderErrorCode, FileType, IFileChange, IFileDeleteOptions, IFileOverwriteOptions, IFileSystemProviderWithFileReadWriteCapability, IStat, IWatchOptions } from '../../../../platform/files/common/files.js';\nimport { IPreferencesService } from '../../../services/preferences/common/preferences.js';\nimport { Event, Emitter } from '../../../../base/common/event.js';\nimport { Registry } from '../../../../platform/registry/common/platform.js';\nimport * as JSONContributionRegistry from '../../../../platform/jsonschemas/common/jsonContributionRegistry.js';\nimport { VSBuffer } from '../../../../base/common/buffer.js';\nimport { ILogService, LogLevel } from '../../../../platform/log/common/log.js';\nimport { isEqual } from '../../../../base/common/resources.js';\n\nconst schemaRegistry = Registry.as<JSONContributionRegistry.IJSONContributionRegistry>(JSONContributionRegistry.Extensions.JSONContribution);\n\n\nexport class SettingsFileSystemProvider extends Disposable implements IFileSystemProviderWithFileReadWriteCapability {\n\n\tstatic readonly SCHEMA = Schemas.vscode;\n\n\tprotected readonly _onDidChangeFile = this._register(new Emitter<readonly IFileChange[]>());\n\treadonly onDidChangeFile = this._onDidChangeFile.event;\n\n\tprivate static SCHEMA_ASSOCIATIONS = URI.parse(`${Schemas.vscode}://schemas-associations/schemas-associations.json`);\n\n\tconstructor(\n\t\t@IPreferencesService private readonly preferencesService: IPreferencesService,\n\t\t@ILogService private readonly logService: ILogService\n\t) {\n\t\tsuper();\n\t\tthis._register(schemaRegistry.onDidChangeSchema(schemaUri => {\n\t\t\tthis._onDidChangeFile.fire([{ resource: URI.parse(schemaUri), type: FileChangeType.UPDATED }]);\n\t\t}));\n\t\tthis._register(schemaRegistry.onDidChangeSchemaAssociations(() => {\n\t\t\tthis._onDidChangeFile.fire([{ resource: SettingsFileSystemProvider.SCHEMA_ASSOCIATIONS, type: FileChangeType.UPDATED }]);\n\t\t}));\n\t\tthis._register(preferencesService.onDidDefaultSettingsContentChanged(uri => {\n\t\t\tthis._onDidChangeFile.fire([{ resource: uri, type: FileChangeType.UPDATED }]);\n\t\t}));\n\t}\n\n\treadonly capabilities: FileSystemProviderCapabilities = FileSystemProviderCapabilities.Readonly + FileSystemProviderCapabilities.FileReadWrite;\n\n\tasync readFile(uri: URI): Promise<Uint8Array> {\n\t\tif (uri.scheme !== SettingsFileSystemProvider.SCHEMA) {\n\t\t\tthrow new NotSupportedError();\n\t\t}\n\t\tlet content: string | undefined;\n\t\tif (uri.authority === 'schemas') {\n\t\t\tcontent = this.getSchemaContent(uri);\n\t\t} else if (uri.authority === SettingsFileSystemProvider.SCHEMA_ASSOCIATIONS.authority) {\n\t\t\tcontent = JSON.stringify(schemaRegistry.getSchemaAssociations());\n\t\t} else if (uri.authority === 'defaultsettings') {\n\t\t\tcontent = this.preferencesService.getDefaultSettingsContent(uri);\n\t\t}\n\t\tif (content) {\n\t\t\treturn VSBuffer.fromString(content).buffer;\n\t\t}\n\t\tthrow FileSystemProviderErrorCode.FileNotFound;\n\t}\n\n\tasync stat(uri: URI): Promise<IStat> {\n\t\tif (schemaRegistry.hasSchemaContent(uri.toString()) || this.preferencesService.hasDefaultSettingsContent(uri)) {\n\t\t\tconst currentTime = Date.now();\n\t\t\treturn {\n\t\t\t\ttype: FileType.File,\n\t\t\t\tpermissions: FilePermission.Readonly,\n\t\t\t\tmtime: currentTime,\n\t\t\t\tctime: currentTime,\n\t\t\t\tsize: 0\n\t\t\t};\n\t\t}\n\t\tif (isEqual(uri, SettingsFileSystemProvider.SCHEMA_ASSOCIATIONS)) {\n\t\t\tconst currentTime = Date.now();\n\t\t\treturn {\n\t\t\t\ttype: FileType.File,\n\t\t\t\tpermissions: FilePermission.Readonly,\n\t\t\t\tmtime: currentTime,\n\t\t\t\tctime: currentTime,\n\t\t\t\tsize: 0\n\t\t\t};\n\t\t}\n\t\tthrow FileSystemProviderErrorCode.FileNotFound;\n\t}\n\n\treadonly onDidChangeCapabilities = Event.None;\n\n\twatch(resource: URI, opts: IWatchOptions): IDisposable { return Disposable.None; }\n\n\tasync mkdir(resource: URI): Promise<void> { }\n\tasync readdir(resource: URI): Promise<[string, FileType][]> { return []; }\n\n\tasync rename(from: URI, to: URI, opts: IFileOverwriteOptions): Promise<void> { }\n\tasync delete(resource: URI, opts: IFileDeleteOptions): Promise<void> { }\n\n\tasync writeFile() {\n\t\tthrow new NotSupportedError();\n\t}\n\n\tprivate getSchemaContent(uri: URI): string {\n\t\tconst startTime = Date.now();\n\t\tconst content = schemaRegistry.getSchemaContent(uri.toString()) ?? '{}' /* Use empty schema if not yet registered */;\n\t\tconst logLevel = this.logService.getLevel();\n\t\tif (logLevel === LogLevel.Debug || logLevel === LogLevel.Trace) {\n\t\t\tconst endTime = Date.now();\n\t\t\tconst uncompressed = JSON.stringify(schemaRegistry.getSchemaContributions().schemas[uri.toString()]);\n\t\t\tthis.logService.debug(`${uri.toString()}: ${uncompressed.length} -> ${content.length} (${Math.round((uncompressed.length - content.length) / uncompressed.length * 100)}%) Took ${endTime - startTime}ms`);\n\t\t}\n\t\treturn content;\n\t}\n}\n"]}