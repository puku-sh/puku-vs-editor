{"version":3,"sources":["vs/workbench/contrib/snippets/browser/snippetCompletionProvider.ts"],"names":[],"mappings":"AAAA;;;gGAGgG;;;;;;;;;;AAEhG,OAAO,EAAE,cAAc,EAAE,MAAM,wCAAwC,CAAC;AACxE,OAAO,EAAE,OAAO,EAAE,gBAAgB,EAAE,MAAM,oCAAoC,CAAC;AAC/E,OAAO,EAAE,QAAQ,EAAE,MAAM,4CAA4C,CAAC;AACtE,OAAO,EAAU,KAAK,EAAE,MAAM,yCAAyC,CAAC;AAGxE,OAAO,EAAE,gBAAgB,EAAE,MAAM,iDAAiD,CAAC;AACnF,OAAO,EAAE,aAAa,EAAE,MAAM,6DAA6D,CAAC;AAC5F,OAAO,EAAE,QAAQ,EAAE,MAAM,oBAAoB,CAAC;AAC9C,OAAO,EAAE,gBAAgB,EAAE,MAAM,eAAe,CAAC;AACjD,OAAO,EAAE,OAAO,EAAiB,MAAM,mBAAmB,CAAC;AAC3D,OAAO,EAAE,eAAe,EAAE,MAAM,oCAAoC,CAAC;AACrE,OAAO,EAAE,SAAS,EAAE,MAAM,sCAAsC,CAAC;AACjE,OAAO,EAAE,6BAA6B,EAAE,MAAM,sEAAsE,CAAC;AAErH,OAAO,EAAE,gBAAgB,EAAE,MAAM,kDAAkD,CAAC;AAIpF,MAAM,iBAAiB,GAAG,qBAAqB,CAAC;AAEhD,gBAAgB,CAAC,eAAe,CAAC,iBAAiB,EAAE,CAAC,QAAQ,EAAE,GAAG,IAAI,EAAE,EAAE;IACzE,MAAM,eAAe,GAAG,QAAQ,CAAC,GAAG,CAAC,gBAAgB,CAAC,CAAC;IACvD,MAAM,CAAC,KAAK,CAAC,GAAG,IAAI,CAAC;IACrB,IAAI,KAAK,YAAY,OAAO,EAAE,CAAC;QAC9B,eAAe,CAAC,oBAAoB,CAAC,KAAK,CAAC,CAAC;IAC7C,CAAC;AACF,CAAC,CAAC,CAAC;AAEH,MAAM,OAAO,iBAAiB;IAa7B,YACU,OAAgB,EACzB,KAAmD;QAD1C,YAAO,GAAP,OAAO,CAAS;QAGzB,IAAI,CAAC,KAAK,GAAG,EAAE,KAAK,EAAE,OAAO,CAAC,MAAM,EAAE,WAAW,EAAE,OAAO,CAAC,IAAI,EAAE,CAAC;QAClE,IAAI,CAAC,MAAM,GAAG,QAAQ,CAAC,KAAgB,EAAE,IAAW,EAAE,OAAO,CAAC,WAAW,IAAI,OAAO,CAAC,IAAI,EAAE,OAAO,CAAC,MAAM,CAAC,CAAC;QAC3G,IAAI,CAAC,UAAU,GAAG,OAAO,CAAC,WAAW,CAAC;QACtC,IAAI,CAAC,WAAW,GAAG,OAAO,CAAC,WAAW,CAAC;QACvC,IAAI,CAAC,KAAK,GAAG,KAAK,CAAC;QACnB,IAAI,CAAC,QAAQ,GAAG,GAAG,OAAO,CAAC,aAAa,oCAA4B,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,GAAG,IAAI,OAAO,CAAC,MAAM,EAAE,CAAC;QACrG,IAAI,CAAC,IAAI,sCAA6B,CAAC;QACvC,IAAI,CAAC,eAAe,uDAA+C,CAAC;QACpE,IAAI,CAAC,OAAO,GAAG,EAAE,EAAE,EAAE,iBAAiB,EAAE,KAAK,EAAE,EAAE,EAAE,SAAS,EAAE,CAAC,OAAO,CAAC,EAAE,CAAC;IAC3E,CAAC;IAED,OAAO;QACN,IAAI,CAAC,aAAa,GAAG,IAAI,cAAc,EAAE,CAAC,eAAe,CAAC,EAAE,EAAE,aAAa,CAAC,YAAY,CAAC,IAAI,CAAC,OAAO,CAAC,WAAW,CAAC,CAAC,CAAC;QACpH,OAAO,IAAI,CAAC;IACb,CAAC;IAED,MAAM,CAAC,cAAc,CAAC,CAAoB,EAAE,CAAoB;QAC/D,OAAO,OAAO,CAAC,CAAC,CAAC,KAAK,CAAC,KAAK,EAAE,CAAC,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC;IAC9C,CAAC;CACD;AAQM,IAAM,yBAAyB,GAA/B,MAAM,yBAAyB;IAIrC,YACmB,gBAAmD,EACnD,SAA4C,EAC/B,6BAA6E;QAFzE,qBAAgB,GAAhB,gBAAgB,CAAkB;QAClC,cAAS,GAAT,SAAS,CAAkB;QACd,kCAA6B,GAA7B,6BAA6B,CAA+B;QALpG,sBAAiB,GAAG,oBAAoB,CAAC;QAOjD,EAAE;IACH,CAAC;IAED,KAAK,CAAC,sBAAsB,CAAC,KAAiB,EAAE,QAAkB,EAAE,OAA0B;QAE7F,MAAM,EAAE,GAAG,IAAI,SAAS,EAAE,CAAC;QAE3B,wEAAwE;QACxE,MAAM,IAAI,GAAG,QAAQ,CAAC,UAAU,CAAC;QACjC,MAAM,IAAI,GAAG,KAAK,CAAC,iBAAiB,CAAC,QAAQ,CAAC,IAAI,EAAE,WAAW,EAAE,QAAQ,CAAC,MAAM,EAAE,SAAS,EAAE,QAAQ,CAAC,MAAM,EAAE,IAAI,EAAE,EAAE,EAAE,CAAC;QAEzH,MAAM,cAAc,GAAG,KAAK,CAAC,cAAc,CAAC,QAAQ,CAAC,UAAU,CAAC,CAAC,WAAW,EAAE,CAAC;QAC/E,MAAM,sBAAsB,GAAG,cAAc,CAAC,SAAS,CAAC,CAAC,EAAE,IAAI,CAAC,WAAW,GAAG,IAAI,CAAC,IAAI,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC;QACpG,MAAM,OAAO,GAAG,IAAI,CAAC,wBAAwB,CAAC,KAAK,EAAE,IAAI,EAAE,IAAI,EAAE,sBAAsB,CAAC,CAAC;QAEzF,iEAAiE;QACjE,MAAM,YAAY,GAAG,QAAQ,CAAC,MAAM,GAAG,CAAC,CAAC;QACzC,MAAM,mBAAmB,GAAG,OAAO,CAAC,gBAAgB,EAAE,WAAW,EAAE,IAAI,EAAE,CAAC;QAC1E,MAAM,UAAU,GAAG,IAAI,CAAC,wBAAwB,CAAC,KAAK,EAAE,QAAQ,CAAC,CAAC;QAClE,MAAM,cAAc,GAAG,IAAI,CAAC,6BAA6B,CAAC,wBAAwB,CAAC,UAAU,CAAC,CAAC;QAC/F,MAAM,QAAQ,GAAG,IAAI,GAAG,CAAC,MAAM,IAAI,CAAC,SAAS,CAAC,WAAW,CAAC,UAAU,CAAC,CAAC,CAAC;QACvE,MAAM,WAAW,GAAwB,EAAE,CAAC;QAE5C,KAAK,MAAM,OAAO,IAAI,QAAQ,EAAE,CAAC;YAEhC,IAAI,OAAO,CAAC,WAAW,mDAA2C,IAAI,CAAC,OAAO,CAAC,SAAS,CAAC,UAAU,CAAC,mBAAmB,CAAC,EAAE,CAAC;gBAC1H,kEAAkE;gBAClE,SAAS;YACV,CAAC;YAED,IAAI,SAAuC,CAAC;YAC5C,KAAK,MAAM,MAAM,IAAI,OAAO,EAAE,CAAC;gBAE9B,IAAI,MAAM,CAAC,SAAS,CAAC,KAAK,CAAC,KAAK,CAAC,IAAI,CAAC,OAAO,CAAC,SAAS,CAAC,KAAK,CAAC,KAAK,CAAC,EAAE,CAAC;oBACtE,8EAA8E;oBAC9E,SAAS;gBACV,CAAC;gBAED,IAAI,eAAe,CAAC,MAAM,CAAC,SAAS,EAAE,CAAC,EAAE,MAAM,CAAC,SAAS,CAAC,MAAM,EAAE,OAAO,CAAC,SAAS,EAAE,CAAC,EAAE,OAAO,CAAC,SAAS,CAAC,MAAM,CAAC,EAAE,CAAC;oBACnH,SAAS,GAAG,MAAM,CAAC;oBACnB,MAAM;gBACP,CAAC;YACF,CAAC;YAED,IAAI,CAAC,SAAS,EAAE,CAAC;gBAChB,SAAS;YACV,CAAC;YAED,MAAM,GAAG,GAAG,SAAS,CAAC,WAAW,GAAG,CAAC,CAAC;YAEtC,MAAM,aAAa,GAAG,OAAO,CAAC,SAAS,CAAC,MAAM,GAAG,CAAC,YAAY,GAAG,GAAG,CAAC,CAAC;YACtE,MAAM,kBAAkB,GAAG,gBAAgB,CAAC,cAAc,EAAE,OAAO,CAAC,SAAS,EAAE,YAAY,EAAE,YAAY,GAAG,aAAa,EAAE,YAAY,GAAG,GAAG,CAAC,CAAC;YAC/I,MAAM,aAAa,GAAG,QAAQ,CAAC,IAAI,CAAC,SAAS,EAAE,GAAG,GAAG,CAAC,CAAC,CAAC;YAExD,IAAI,SAAS,GAAG,kBAAkB,KAAK,CAAC,CAAC,CAAC,CAAC,QAAQ,CAAC,MAAM,GAAG,aAAa,CAAC,CAAC,CAAC,QAAQ,CAAC,MAAM,CAAC;YAE7F,8DAA8D;YAC9D,IAAI,YAAY,GAAG,cAAc,CAAC,MAAM,EAAE,CAAC;gBAC1C,MAAM,gBAAgB,GAAG,cAAc,CAAC,mBAAmB,EAAE,CAAC;gBAC9D,MAAM,mCAAmC,GAAG,gBAAgB,CAAC,+BAA+B,CAAC,GAAG,CAAC,cAAc,CAAC,YAAY,CAAC,CAAC,CAAC;gBAC/H,4FAA4F;gBAC5F,IAAI,mCAAmC,EAAE,IAAI,CAAC,CAAC,CAAC,EAAE;gBACjD,yEAAyE;gBACzE,CAAC,CAAC,IAAI,KAAK,cAAc,CAAC,aAAa,CAAC,MAAM,GAAG,CAAC,CAAC;oBACnD,4EAA4E;oBAC5E,OAAO,CAAC,MAAM,CAAC,UAAU,CAAC,CAAC,CAAC,IAAI,CAAC;oBACjC,OAAO,CAAC,MAAM,CAAC,OAAO,CAAC,MAAM,CAAC,MAAM,GAAG,CAAC,CAAC,KAAK,CAAC,CAAC,KAAK,CAAC,EACrD,CAAC;oBACF,2EAA2E;oBAC3E,SAAS,EAAE,CAAC;gBACb,CAAC;YACF,CAAC;YAED,MAAM,OAAO,GAAG,KAAK,CAAC,aAAa,CAAC,EAAE,UAAU,EAAE,IAAI,EAAE,MAAM,EAAE,SAAS,CAAC,WAAW,EAAE,EAAE,EAAE,UAAU,EAAE,IAAI,EAAE,MAAM,EAAE,SAAS,EAAE,CAAC,CAAC;YAClI,MAAM,MAAM,GAAG,OAAO,CAAC,cAAc,CAAC,IAAI,EAAE,QAAQ,CAAC,MAAM,CAAC,CAAC;YAE7D,WAAW,CAAC,IAAI,CAAC,IAAI,iBAAiB,CAAC,OAAO,EAAE,EAAE,OAAO,EAAE,MAAM,EAAE,CAAC,CAAC,CAAC;YACtE,QAAQ,CAAC,MAAM,CAAC,OAAO,CAAC,CAAC;QAC1B,CAAC;QAED,wFAAwF;QACxF,0CAA0C;QAC1C,IAAI,CAAC,mBAAmB,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,cAAc,CAAC,QAAQ,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC,CAAC,sBAAsB,IAAI,CAAC,cAAc,CAAC,cAAc,CAAC,EAAE,CAAC;YACvI,KAAK,MAAM,OAAO,IAAI,QAAQ,EAAE,CAAC;gBAChC,MAAM,MAAM,GAAG,KAAK,CAAC,aAAa,CAAC,QAAQ,CAAC,CAAC;gBAC7C,MAAM,OAAO,GAAG,cAAc,CAAC,OAAO,CAAC,OAAO,CAAC,SAAS,EAAE,YAAY,CAAC,KAAK,YAAY,CAAC,CAAC,CAAC,MAAM,CAAC,cAAc,CAAC,QAAQ,CAAC,UAAU,EAAE,QAAQ,CAAC,MAAM,GAAG,OAAO,CAAC,SAAS,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,MAAM,CAAC;gBAC3L,WAAW,CAAC,IAAI,CAAC,IAAI,iBAAiB,CAAC,OAAO,EAAE,EAAE,OAAO,EAAE,MAAM,EAAE,CAAC,CAAC,CAAC;YACvE,CAAC;QACF,CAAC;QAED,2CAA2C;QAC3C,IAAI,CAAC,qBAAqB,CAAC,WAAW,CAAC,CAAC;QAExC,OAAO;YACN,WAAW;YACX,QAAQ,EAAE,EAAE,CAAC,OAAO,EAAE;SACtB,CAAC;IACH,CAAC;IAEO,qBAAqB,CAAC,WAAgC;QAC7D,WAAW,CAAC,IAAI,CAAC,iBAAiB,CAAC,cAAc,CAAC,CAAC;QACnD,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,WAAW,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE,CAAC;YAC7C,MAAM,IAAI,GAAG,WAAW,CAAC,CAAC,CAAC,CAAC;YAC5B,IAAI,EAAE,GAAG,CAAC,GAAG,CAAC,CAAC;YACf,OAAO,EAAE,GAAG,WAAW,CAAC,MAAM,IAAI,IAAI,CAAC,KAAK,KAAK,WAAW,CAAC,EAAE,CAAC,CAAC,KAAK,EAAE,EAAE,EAAE,EAAE,CAAC;gBAC9E,WAAW,CAAC,EAAE,CAAC,CAAC,KAAK,CAAC,KAAK,GAAG,QAAQ,CAAC,KAA0B,EAAE,IAAU,EAAE,WAAW,CAAC,EAAE,CAAC,CAAC,KAAK,CAAC,KAAK,EAAE,WAAW,CAAC,EAAE,CAAC,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC;YAC3I,CAAC;YACD,IAAI,EAAE,GAAG,CAAC,GAAG,CAAC,EAAE,CAAC;gBAChB,WAAW,CAAC,CAAC,CAAC,CAAC,KAAK,CAAC,KAAK,GAAG,QAAQ,CAAC,KAA0B,EAAE,IAAU,EAAE,WAAW,CAAC,CAAC,CAAC,CAAC,KAAK,CAAC,KAAK,EAAE,WAAW,CAAC,CAAC,CAAC,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC;gBACvI,CAAC,GAAG,EAAE,CAAC;YACR,CAAC;QACF,CAAC;IACF,CAAC;IAED,qBAAqB,CAAC,IAAoB;QACzC,OAAO,CAAC,IAAI,YAAY,iBAAiB,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,OAAO,EAAE,CAAC,CAAC,CAAC,IAAI,CAAC;IACpE,CAAC;IAEO,wBAAwB,CAAC,KAAiB,EAAE,IAAY,EAAE,IAAqB,EAAE,sBAA8B;QACtH,MAAM,MAAM,GAAuB,EAAE,CAAC;QAEtC,KAAK,IAAI,MAAM,GAAG,CAAC,EAAE,MAAM,GAAG,IAAI,CAAC,WAAW,EAAE,MAAM,EAAE,EAAE,CAAC;YAC1D,MAAM,QAAQ,GAAG,KAAK,CAAC,iBAAiB,CAAC,IAAI,QAAQ,CAAC,IAAI,EAAE,MAAM,CAAC,CAAC,CAAC;YACrE,MAAM,CAAC,IAAI,CAAC;gBACX,WAAW,EAAE,MAAM;gBACnB,SAAS,EAAE,sBAAsB,CAAC,SAAS,CAAC,MAAM,GAAG,CAAC,CAAC;gBACvD,MAAM,EAAE,OAAO,CAAC,QAAQ,CAAC;aACzB,CAAC,CAAC;YACH,IAAI,QAAQ,EAAE,CAAC;gBACd,MAAM,GAAG,QAAQ,CAAC,SAAS,CAAC;gBAE5B,wDAAwD;gBACxD,MAAM,CAAC,IAAI,CAAC;oBACX,WAAW,EAAE,QAAQ,CAAC,SAAS;oBAC/B,SAAS,EAAE,sBAAsB,CAAC,SAAS,CAAC,QAAQ,CAAC,SAAS,GAAG,CAAC,CAAC;oBACnE,MAAM,EAAE,KAAK;iBACb,CAAC,CAAC;YACJ,CAAC;QACF,CAAC;QAED,IAAI,IAAI,CAAC,IAAI,CAAC,MAAM,GAAG,CAAC,IAAI,MAAM,CAAC,MAAM,KAAK,CAAC,EAAE,CAAC;YACjD,MAAM,CAAC,IAAI,CAAC;gBACX,WAAW,EAAE,IAAI,CAAC,WAAW;gBAC7B,SAAS,EAAE,sBAAsB,CAAC,SAAS,CAAC,IAAI,CAAC,WAAW,GAAG,CAAC,CAAC;gBACjE,MAAM,EAAE,IAAI;aACZ,CAAC,CAAC;QACJ,CAAC;QAED,OAAO,MAAM,CAAC;IACf,CAAC;IAEO,wBAAwB,CAAC,KAAiB,EAAE,QAAkB;QACrE,qDAAqD;QACrD,qDAAqD;QACrD,iDAAiD;QACjD,KAAK,CAAC,YAAY,CAAC,eAAe,CAAC,QAAQ,CAAC,UAAU,CAAC,CAAC;QACxD,IAAI,UAAU,GAAG,KAAK,CAAC,uBAAuB,CAAC,QAAQ,CAAC,UAAU,EAAE,QAAQ,CAAC,MAAM,CAAC,CAAC;QACrF,IAAI,CAAC,IAAI,CAAC,gBAAgB,CAAC,eAAe,CAAC,UAAU,CAAC,EAAE,CAAC;YACxD,UAAU,GAAG,KAAK,CAAC,aAAa,EAAE,CAAC;QACpC,CAAC;QACD,OAAO,UAAU,CAAC;IACnB,CAAC;CACD,CAAA;AA3KY,yBAAyB;IAKnC,WAAA,gBAAgB,CAAA;IAChB,WAAA,gBAAgB,CAAA;IAChB,WAAA,6BAA6B,CAAA;GAPnB,yBAAyB,CA2KrC","file":"snippetCompletionProvider.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { MarkdownString } from '../../../../base/common/htmlContent.js';\nimport { compare, compareSubstring } from '../../../../base/common/strings.js';\nimport { Position } from '../../../../editor/common/core/position.js';\nimport { IRange, Range } from '../../../../editor/common/core/range.js';\nimport { ITextModel } from '../../../../editor/common/model.js';\nimport { CompletionItem, CompletionItemKind, CompletionItemProvider, CompletionList, CompletionItemInsertTextRule, CompletionContext, CompletionTriggerKind, CompletionItemLabel, Command } from '../../../../editor/common/languages.js';\nimport { ILanguageService } from '../../../../editor/common/languages/language.js';\nimport { SnippetParser } from '../../../../editor/contrib/snippet/browser/snippetParser.js';\nimport { localize } from '../../../../nls.js';\nimport { ISnippetsService } from './snippets.js';\nimport { Snippet, SnippetSource } from './snippetsFile.js';\nimport { isPatternInWord } from '../../../../base/common/filters.js';\nimport { StopWatch } from '../../../../base/common/stopwatch.js';\nimport { ILanguageConfigurationService } from '../../../../editor/common/languages/languageConfigurationRegistry.js';\nimport { ExtensionIdentifier } from '../../../../platform/extensions/common/extensions.js';\nimport { CommandsRegistry } from '../../../../platform/commands/common/commands.js';\nimport { IWordAtPosition } from '../../../../editor/common/core/wordHelper.js';\n\n\nconst markSnippetAsUsed = '_snippet.markAsUsed';\n\nCommandsRegistry.registerCommand(markSnippetAsUsed, (accessor, ...args) => {\n\tconst snippetsService = accessor.get(ISnippetsService);\n\tconst [first] = args;\n\tif (first instanceof Snippet) {\n\t\tsnippetsService.updateUsageTimestamp(first);\n\t}\n});\n\nexport class SnippetCompletion implements CompletionItem {\n\n\tlabel: CompletionItemLabel;\n\tdetail: string;\n\tinsertText: string;\n\tdocumentation?: MarkdownString;\n\trange: IRange | { insert: IRange; replace: IRange };\n\tsortText: string;\n\tkind: CompletionItemKind;\n\tinsertTextRules: CompletionItemInsertTextRule;\n\textensionId?: ExtensionIdentifier;\n\tcommand?: Command;\n\n\tconstructor(\n\t\treadonly snippet: Snippet,\n\t\trange: IRange | { insert: IRange; replace: IRange },\n\t) {\n\t\tthis.label = { label: snippet.prefix, description: snippet.name };\n\t\tthis.detail = localize('detail.snippet', \"{0} ({1})\", snippet.description || snippet.name, snippet.source);\n\t\tthis.insertText = snippet.codeSnippet;\n\t\tthis.extensionId = snippet.extensionId;\n\t\tthis.range = range;\n\t\tthis.sortText = `${snippet.snippetSource === SnippetSource.Extension ? 'z' : 'a'}-${snippet.prefix}`;\n\t\tthis.kind = CompletionItemKind.Snippet;\n\t\tthis.insertTextRules = CompletionItemInsertTextRule.InsertAsSnippet;\n\t\tthis.command = { id: markSnippetAsUsed, title: '', arguments: [snippet] };\n\t}\n\n\tresolve(): this {\n\t\tthis.documentation = new MarkdownString().appendCodeblock('', SnippetParser.asInsertText(this.snippet.codeSnippet));\n\t\treturn this;\n\t}\n\n\tstatic compareByLabel(a: SnippetCompletion, b: SnippetCompletion): number {\n\t\treturn compare(a.label.label, b.label.label);\n\t}\n}\n\ninterface ISnippetPosition {\n\tstartColumn: number;\n\tprefixLow: string;\n\tisWord: boolean;\n}\n\nexport class SnippetCompletionProvider implements CompletionItemProvider {\n\n\treadonly _debugDisplayName = 'snippetCompletions';\n\n\tconstructor(\n\t\t@ILanguageService private readonly _languageService: ILanguageService,\n\t\t@ISnippetsService private readonly _snippets: ISnippetsService,\n\t\t@ILanguageConfigurationService private readonly _languageConfigurationService: ILanguageConfigurationService\n\t) {\n\t\t//\n\t}\n\n\tasync provideCompletionItems(model: ITextModel, position: Position, context: CompletionContext): Promise<CompletionList> {\n\n\t\tconst sw = new StopWatch();\n\n\t\t// compute all snippet anchors: word starts and every non word character\n\t\tconst line = position.lineNumber;\n\t\tconst word = model.getWordAtPosition(position) ?? { startColumn: position.column, endColumn: position.column, word: '' };\n\n\t\tconst lineContentLow = model.getLineContent(position.lineNumber).toLowerCase();\n\t\tconst lineContentWithWordLow = lineContentLow.substring(0, word.startColumn + word.word.length - 1);\n\t\tconst anchors = this._computeSnippetPositions(model, line, word, lineContentWithWordLow);\n\n\t\t// loop over possible snippets and match them against the anchors\n\t\tconst columnOffset = position.column - 1;\n\t\tconst triggerCharacterLow = context.triggerCharacter?.toLowerCase() ?? '';\n\t\tconst languageId = this._getLanguageIdAtPosition(model, position);\n\t\tconst languageConfig = this._languageConfigurationService.getLanguageConfiguration(languageId);\n\t\tconst snippets = new Set(await this._snippets.getSnippets(languageId));\n\t\tconst suggestions: SnippetCompletion[] = [];\n\n\t\tfor (const snippet of snippets) {\n\n\t\t\tif (context.triggerKind === CompletionTriggerKind.TriggerCharacter && !snippet.prefixLow.startsWith(triggerCharacterLow)) {\n\t\t\t\t// strict -> when having trigger characters they must prefix-match\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tlet candidate: ISnippetPosition | undefined;\n\t\t\tfor (const anchor of anchors) {\n\n\t\t\t\tif (anchor.prefixLow.match(/^\\s/) && !snippet.prefixLow.match(/^\\s/)) {\n\t\t\t\t\t// only allow whitespace anchor when snippet prefix starts with whitespace too\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tif (isPatternInWord(anchor.prefixLow, 0, anchor.prefixLow.length, snippet.prefixLow, 0, snippet.prefixLow.length)) {\n\t\t\t\t\tcandidate = anchor;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (!candidate) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tconst pos = candidate.startColumn - 1;\n\n\t\t\tconst prefixRestLen = snippet.prefixLow.length - (columnOffset - pos);\n\t\t\tconst endsWithPrefixRest = compareSubstring(lineContentLow, snippet.prefixLow, columnOffset, columnOffset + prefixRestLen, columnOffset - pos);\n\t\t\tconst startPosition = position.with(undefined, pos + 1);\n\n\t\t\tlet endColumn = endsWithPrefixRest === 0 ? position.column + prefixRestLen : position.column;\n\n\t\t\t// First check if there is anything to the right of the cursor\n\t\t\tif (columnOffset < lineContentLow.length) {\n\t\t\t\tconst autoClosingPairs = languageConfig.getAutoClosingPairs();\n\t\t\t\tconst standardAutoClosingPairConditionals = autoClosingPairs.autoClosingPairsCloseSingleChar.get(lineContentLow[columnOffset]);\n\t\t\t\t// If the character to the right of the cursor is a closing character of an autoclosing pair\n\t\t\t\tif (standardAutoClosingPairConditionals?.some(p =>\n\t\t\t\t\t// and the start position is the opening character of an autoclosing pair\n\t\t\t\t\tp.open === lineContentLow[startPosition.column - 1] &&\n\t\t\t\t\t// and the snippet prefix contains the opening and closing pair at its edges\n\t\t\t\t\tsnippet.prefix.startsWith(p.open) &&\n\t\t\t\t\tsnippet.prefix[snippet.prefix.length - 1] === p.close)\n\t\t\t\t) {\n\t\t\t\t\t// Eat the character that was likely inserted because of auto-closing pairs\n\t\t\t\t\tendColumn++;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tconst replace = Range.fromPositions({ lineNumber: line, column: candidate.startColumn }, { lineNumber: line, column: endColumn });\n\t\t\tconst insert = replace.setEndPosition(line, position.column);\n\n\t\t\tsuggestions.push(new SnippetCompletion(snippet, { replace, insert }));\n\t\t\tsnippets.delete(snippet);\n\t\t}\n\n\t\t// add remaing snippets when the current prefix ends in whitespace or when line is empty\n\t\t// and when not having a trigger character\n\t\tif (!triggerCharacterLow && (/\\s/.test(lineContentLow[position.column - 2]) /*end in whitespace */ || !lineContentLow /*empty line*/)) {\n\t\t\tfor (const snippet of snippets) {\n\t\t\t\tconst insert = Range.fromPositions(position);\n\t\t\t\tconst replace = lineContentLow.indexOf(snippet.prefixLow, columnOffset) === columnOffset ? insert.setEndPosition(position.lineNumber, position.column + snippet.prefixLow.length) : insert;\n\t\t\t\tsuggestions.push(new SnippetCompletion(snippet, { replace, insert }));\n\t\t\t}\n\t\t}\n\n\t\t// dismbiguate suggestions with same labels\n\t\tthis._disambiguateSnippets(suggestions);\n\n\t\treturn {\n\t\t\tsuggestions,\n\t\t\tduration: sw.elapsed()\n\t\t};\n\t}\n\n\tprivate _disambiguateSnippets(suggestions: SnippetCompletion[]) {\n\t\tsuggestions.sort(SnippetCompletion.compareByLabel);\n\t\tfor (let i = 0; i < suggestions.length; i++) {\n\t\t\tconst item = suggestions[i];\n\t\t\tlet to = i + 1;\n\t\t\tfor (; to < suggestions.length && item.label === suggestions[to].label; to++) {\n\t\t\t\tsuggestions[to].label.label = localize('snippetSuggest.longLabel', \"{0}, {1}\", suggestions[to].label.label, suggestions[to].snippet.name);\n\t\t\t}\n\t\t\tif (to > i + 1) {\n\t\t\t\tsuggestions[i].label.label = localize('snippetSuggest.longLabel', \"{0}, {1}\", suggestions[i].label.label, suggestions[i].snippet.name);\n\t\t\t\ti = to;\n\t\t\t}\n\t\t}\n\t}\n\n\tresolveCompletionItem(item: CompletionItem): CompletionItem {\n\t\treturn (item instanceof SnippetCompletion) ? item.resolve() : item;\n\t}\n\n\tprivate _computeSnippetPositions(model: ITextModel, line: number, word: IWordAtPosition, lineContentWithWordLow: string): ISnippetPosition[] {\n\t\tconst result: ISnippetPosition[] = [];\n\n\t\tfor (let column = 1; column < word.startColumn; column++) {\n\t\t\tconst wordInfo = model.getWordAtPosition(new Position(line, column));\n\t\t\tresult.push({\n\t\t\t\tstartColumn: column,\n\t\t\t\tprefixLow: lineContentWithWordLow.substring(column - 1),\n\t\t\t\tisWord: Boolean(wordInfo)\n\t\t\t});\n\t\t\tif (wordInfo) {\n\t\t\t\tcolumn = wordInfo.endColumn;\n\n\t\t\t\t// the character right after a word is an anchor, always\n\t\t\t\tresult.push({\n\t\t\t\t\tstartColumn: wordInfo.endColumn,\n\t\t\t\t\tprefixLow: lineContentWithWordLow.substring(wordInfo.endColumn - 1),\n\t\t\t\t\tisWord: false\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tif (word.word.length > 0 || result.length === 0) {\n\t\t\tresult.push({\n\t\t\t\tstartColumn: word.startColumn,\n\t\t\t\tprefixLow: lineContentWithWordLow.substring(word.startColumn - 1),\n\t\t\t\tisWord: true\n\t\t\t});\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tprivate _getLanguageIdAtPosition(model: ITextModel, position: Position): string {\n\t\t// validate the `languageId` to ensure this is a user\n\t\t// facing language with a name and the chance to have\n\t\t// snippets, else fall back to the outer language\n\t\tmodel.tokenization.tokenizeIfCheap(position.lineNumber);\n\t\tlet languageId = model.getLanguageIdAtPosition(position.lineNumber, position.column);\n\t\tif (!this._languageService.getLanguageName(languageId)) {\n\t\t\tlanguageId = model.getLanguageId();\n\t\t}\n\t\treturn languageId;\n\t}\n}\n"]}