{"version":3,"sources":["vs/workbench/contrib/url/browser/trustedDomainsValidator.ts"],"names":[],"mappings":"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","file":"trustedDomainsValidator.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Schemas, matchesScheme } from '../../../../base/common/network.js';\nimport Severity from '../../../../base/common/severity.js';\nimport { URI } from '../../../../base/common/uri.js';\nimport { localize } from '../../../../nls.js';\nimport { IClipboardService } from '../../../../platform/clipboard/common/clipboardService.js';\nimport { IConfigurationService } from '../../../../platform/configuration/common/configuration.js';\nimport { IDialogService } from '../../../../platform/dialogs/common/dialogs.js';\nimport { IInstantiationService } from '../../../../platform/instantiation/common/instantiation.js';\nimport { IOpenerService, OpenOptions } from '../../../../platform/opener/common/opener.js';\nimport { IProductService } from '../../../../platform/product/common/productService.js';\nimport { IQuickInputService } from '../../../../platform/quickinput/common/quickInput.js';\nimport { IStorageService } from '../../../../platform/storage/common/storage.js';\nimport { ITelemetryService } from '../../../../platform/telemetry/common/telemetry.js';\nimport { IWorkspaceTrustManagementService } from '../../../../platform/workspace/common/workspaceTrust.js';\nimport { IWorkbenchContribution } from '../../../common/contributions.js';\nimport { ITrustedDomainService } from './trustedDomainService.js';\nimport { isURLDomainTrusted } from '../common/trustedDomains.js';\nimport { configureOpenerTrustedDomainsHandler, readStaticTrustedDomains } from './trustedDomains.js';\nimport { IEditorService } from '../../../services/editor/common/editorService.js';\n\nexport class OpenerValidatorContributions implements IWorkbenchContribution {\n\n\tconstructor(\n\t\t@IOpenerService private readonly _openerService: IOpenerService,\n\t\t@IStorageService private readonly _storageService: IStorageService,\n\t\t@IDialogService private readonly _dialogService: IDialogService,\n\t\t@IProductService private readonly _productService: IProductService,\n\t\t@IQuickInputService private readonly _quickInputService: IQuickInputService,\n\t\t@IEditorService private readonly _editorService: IEditorService,\n\t\t@IClipboardService private readonly _clipboardService: IClipboardService,\n\t\t@ITelemetryService private readonly _telemetryService: ITelemetryService,\n\t\t@IInstantiationService private readonly _instantiationService: IInstantiationService,\n\t\t@IConfigurationService private readonly _configurationService: IConfigurationService,\n\t\t@IWorkspaceTrustManagementService private readonly _workspaceTrustService: IWorkspaceTrustManagementService,\n\t\t@ITrustedDomainService private readonly _trustedDomainService: ITrustedDomainService,\n\t) {\n\t\tthis._openerService.registerValidator({ shouldOpen: (uri, options) => this.validateLink(uri, options) });\n\t}\n\n\tasync validateLink(resource: URI | string, openOptions?: OpenOptions): Promise<boolean> {\n\t\tif (!matchesScheme(resource, Schemas.http) && !matchesScheme(resource, Schemas.https)) {\n\t\t\treturn true;\n\t\t}\n\n\t\tif (openOptions?.fromWorkspace && this._workspaceTrustService.isWorkspaceTrusted() && !this._configurationService.getValue('workbench.trustedDomains.promptInTrustedWorkspace')) {\n\t\t\treturn true;\n\t\t}\n\n\t\tconst originalResource = resource;\n\t\tlet resourceUri: URI;\n\t\tif (typeof resource === 'string') {\n\t\t\tresourceUri = URI.parse(resource);\n\t\t} else {\n\t\t\tresourceUri = resource;\n\t\t}\n\n\t\tif (this._trustedDomainService.isValid(resourceUri)) {\n\t\t\treturn true;\n\t\t} else {\n\t\t\tconst { scheme, authority, path, query, fragment } = resourceUri;\n\t\t\tlet formattedLink = `${scheme}://${authority}${path}`;\n\n\t\t\tconst linkTail = `${query ? '?' + query : ''}${fragment ? '#' + fragment : ''}`;\n\n\n\t\t\tconst remainingLength = Math.max(0, 60 - formattedLink.length);\n\t\t\tconst linkTailLengthToKeep = Math.min(Math.max(5, remainingLength), linkTail.length);\n\n\t\t\tif (linkTailLengthToKeep === linkTail.length) {\n\t\t\t\tformattedLink += linkTail;\n\t\t\t} else {\n\t\t\t\t// keep the first char ? or #\n\t\t\t\t// add ... and keep the tail end as much as possible\n\t\t\t\tformattedLink += linkTail.charAt(0) + '...' + linkTail.substring(linkTail.length - linkTailLengthToKeep + 1);\n\t\t\t}\n\n\t\t\tconst { result } = await this._dialogService.prompt<boolean>({\n\t\t\t\ttype: Severity.Info,\n\t\t\t\tmessage: localize(\n\t\t\t\t\t'openExternalLinkAt',\n\t\t\t\t\t'Do you want {0} to open the external website?',\n\t\t\t\t\tthis._productService.nameShort\n\t\t\t\t),\n\t\t\t\tdetail: typeof originalResource === 'string' ? originalResource : formattedLink,\n\t\t\t\tbuttons: [\n\t\t\t\t\t{\n\t\t\t\t\t\tlabel: localize({ key: 'open', comment: ['&& denotes a mnemonic'] }, '&&Open'),\n\t\t\t\t\t\trun: () => true\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tlabel: localize({ key: 'copy', comment: ['&& denotes a mnemonic'] }, '&&Copy'),\n\t\t\t\t\t\trun: () => {\n\t\t\t\t\t\t\tthis._clipboardService.writeText(typeof originalResource === 'string' ? originalResource : resourceUri.toString(true));\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tlabel: localize({ key: 'configureTrustedDomains', comment: ['&& denotes a mnemonic'] }, 'Configure &&Trusted Domains'),\n\t\t\t\t\t\trun: async () => {\n\t\t\t\t\t\t\tconst { trustedDomains, } = this._instantiationService.invokeFunction(readStaticTrustedDomains);\n\t\t\t\t\t\t\tconst domainToOpen = `${scheme}://${authority}`;\n\t\t\t\t\t\t\tconst pickedDomains = await configureOpenerTrustedDomainsHandler(\n\t\t\t\t\t\t\t\ttrustedDomains,\n\t\t\t\t\t\t\t\tdomainToOpen,\n\t\t\t\t\t\t\t\tresourceUri,\n\t\t\t\t\t\t\t\tthis._quickInputService,\n\t\t\t\t\t\t\t\tthis._storageService,\n\t\t\t\t\t\t\t\tthis._editorService,\n\t\t\t\t\t\t\t\tthis._telemetryService,\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t// Trust all domains\n\t\t\t\t\t\t\tif (pickedDomains.indexOf('*') !== -1) {\n\t\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t// Trust current domain\n\t\t\t\t\t\t\tif (isURLDomainTrusted(resourceUri, pickedDomains)) {\n\t\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t],\n\t\t\t\tcancelButton: {\n\t\t\t\t\trun: () => false\n\t\t\t\t}\n\t\t\t});\n\n\t\t\treturn result;\n\t\t}\n\t}\n}\n"]}