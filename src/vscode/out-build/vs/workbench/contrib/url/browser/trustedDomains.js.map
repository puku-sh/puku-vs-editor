{"version":3,"sources":["vs/workbench/contrib/url/browser/trustedDomains.ts"],"names":[],"mappings":"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","file":"trustedDomains.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { URI } from '../../../../base/common/uri.js';\nimport { localize, localize2 } from '../../../../nls.js';\nimport { ServicesAccessor } from '../../../../platform/instantiation/common/instantiation.js';\nimport { IProductService } from '../../../../platform/product/common/productService.js';\nimport { IQuickInputService, IQuickPickItem } from '../../../../platform/quickinput/common/quickInput.js';\nimport { IStorageService, StorageScope, StorageTarget } from '../../../../platform/storage/common/storage.js';\nimport { ITelemetryService } from '../../../../platform/telemetry/common/telemetry.js';\nimport { IEditorService } from '../../../services/editor/common/editorService.js';\nimport { IBrowserWorkbenchEnvironmentService } from '../../../services/environment/browser/environmentService.js';\n\nconst TRUSTED_DOMAINS_URI = URI.parse('trustedDomains:/Trusted Domains');\n\nexport const TRUSTED_DOMAINS_STORAGE_KEY = 'http.linkProtectionTrustedDomains';\nexport const TRUSTED_DOMAINS_CONTENT_STORAGE_KEY = 'http.linkProtectionTrustedDomainsContent';\n\nexport const manageTrustedDomainSettingsCommand = {\n\tid: 'workbench.action.manageTrustedDomain',\n\tdescription: {\n\t\tdescription: localize2('trustedDomain.manageTrustedDomain', 'Manage Trusted Domains'),\n\t\targs: []\n\t},\n\thandler: async (accessor: ServicesAccessor) => {\n\t\tconst editorService = accessor.get(IEditorService);\n\t\teditorService.openEditor({ resource: TRUSTED_DOMAINS_URI, languageId: 'jsonc', options: { pinned: true } });\n\t\treturn;\n\t}\n};\n\ntype ConfigureTrustedDomainsQuickPickItem = IQuickPickItem & ({ id: 'manage' } | { id: 'trust'; toTrust: string });\n\nexport async function configureOpenerTrustedDomainsHandler(\n\ttrustedDomains: string[],\n\tdomainToConfigure: string,\n\tresource: URI,\n\tquickInputService: IQuickInputService,\n\tstorageService: IStorageService,\n\teditorService: IEditorService,\n\ttelemetryService: ITelemetryService,\n) {\n\tconst parsedDomainToConfigure = URI.parse(domainToConfigure);\n\tconst toplevelDomainSegements = parsedDomainToConfigure.authority.split('.');\n\tconst domainEnd = toplevelDomainSegements.slice(toplevelDomainSegements.length - 2).join('.');\n\tconst topLevelDomain = '*.' + domainEnd;\n\tconst options: ConfigureTrustedDomainsQuickPickItem[] = [];\n\n\toptions.push({\n\t\ttype: 'item',\n\t\tlabel: localize('trustedDomain.trustDomain', 'Trust {0}', domainToConfigure),\n\t\tid: 'trust',\n\t\ttoTrust: domainToConfigure,\n\t\tpicked: true\n\t});\n\n\tconst isIP =\n\t\ttoplevelDomainSegements.length === 4 &&\n\t\ttoplevelDomainSegements.every(segment =>\n\t\t\tNumber.isInteger(+segment) || Number.isInteger(+segment.split(':')[0]));\n\n\tif (isIP) {\n\t\tif (parsedDomainToConfigure.authority.includes(':')) {\n\t\t\tconst base = parsedDomainToConfigure.authority.split(':')[0];\n\t\t\toptions.push({\n\t\t\t\ttype: 'item',\n\t\t\t\tlabel: localize('trustedDomain.trustAllPorts', 'Trust {0} on all ports', base),\n\t\t\t\ttoTrust: base + ':*',\n\t\t\t\tid: 'trust'\n\t\t\t});\n\t\t}\n\t} else {\n\t\toptions.push({\n\t\t\ttype: 'item',\n\t\t\tlabel: localize('trustedDomain.trustSubDomain', 'Trust {0} and all its subdomains', domainEnd),\n\t\t\ttoTrust: topLevelDomain,\n\t\t\tid: 'trust'\n\t\t});\n\t}\n\n\toptions.push({\n\t\ttype: 'item',\n\t\tlabel: localize('trustedDomain.trustAllDomains', 'Trust all domains (disables link protection)'),\n\t\ttoTrust: '*',\n\t\tid: 'trust'\n\t});\n\toptions.push({\n\t\ttype: 'item',\n\t\tlabel: localize('trustedDomain.manageTrustedDomains', 'Manage Trusted Domains'),\n\t\tid: 'manage'\n\t});\n\n\tconst pickedResult = await quickInputService.pick<ConfigureTrustedDomainsQuickPickItem>(\n\t\toptions, { activeItem: options[0] }\n\t);\n\n\tif (pickedResult && pickedResult.id) {\n\t\tswitch (pickedResult.id) {\n\t\t\tcase 'manage':\n\t\t\t\tawait editorService.openEditor({\n\t\t\t\t\tresource: TRUSTED_DOMAINS_URI.with({ fragment: resource.toString() }),\n\t\t\t\t\tlanguageId: 'jsonc',\n\t\t\t\t\toptions: { pinned: true }\n\t\t\t\t});\n\t\t\t\treturn trustedDomains;\n\t\t\tcase 'trust': {\n\t\t\t\tconst itemToTrust = pickedResult.toTrust;\n\t\t\t\tif (trustedDomains.indexOf(itemToTrust) === -1) {\n\t\t\t\t\tstorageService.remove(TRUSTED_DOMAINS_CONTENT_STORAGE_KEY, StorageScope.APPLICATION);\n\t\t\t\t\tstorageService.store(\n\t\t\t\t\t\tTRUSTED_DOMAINS_STORAGE_KEY,\n\t\t\t\t\t\tJSON.stringify([...trustedDomains, itemToTrust]),\n\t\t\t\t\t\tStorageScope.APPLICATION,\n\t\t\t\t\t\tStorageTarget.USER\n\t\t\t\t\t);\n\n\t\t\t\t\treturn [...trustedDomains, itemToTrust];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\treturn [];\n}\n\nexport interface IStaticTrustedDomains {\n\treadonly defaultTrustedDomains: string[];\n\treadonly trustedDomains: string[];\n}\n\nexport async function readTrustedDomains(accessor: ServicesAccessor): Promise<IStaticTrustedDomains> {\n\tconst { defaultTrustedDomains, trustedDomains } = readStaticTrustedDomains(accessor);\n\treturn {\n\t\tdefaultTrustedDomains,\n\t\ttrustedDomains,\n\t};\n}\n\nexport function readStaticTrustedDomains(accessor: ServicesAccessor): IStaticTrustedDomains {\n\tconst storageService = accessor.get(IStorageService);\n\tconst productService = accessor.get(IProductService);\n\tconst environmentService = accessor.get(IBrowserWorkbenchEnvironmentService);\n\n\tconst defaultTrustedDomains = [\n\t\t...productService.linkProtectionTrustedDomains ?? [],\n\t\t...environmentService.options?.additionalTrustedDomains ?? []\n\t];\n\n\tlet trustedDomains: string[] = [];\n\ttry {\n\t\tconst trustedDomainsSrc = storageService.get(TRUSTED_DOMAINS_STORAGE_KEY, StorageScope.APPLICATION);\n\t\tif (trustedDomainsSrc) {\n\t\t\ttrustedDomains = JSON.parse(trustedDomainsSrc);\n\t\t}\n\t} catch (err) { }\n\n\treturn {\n\t\tdefaultTrustedDomains,\n\t\ttrustedDomains,\n\t};\n}\n"]}