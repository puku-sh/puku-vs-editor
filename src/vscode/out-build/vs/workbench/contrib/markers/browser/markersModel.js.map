{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/contrib/markers/browser/markersModel.ts","vs/workbench/contrib/markers/browser/markersModel.ts"],"names":[],"mappings":"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","file":"markersModel.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { isNonEmptyArray } from '../../../../base/common/arrays.js';\nimport { Emitter, Event } from '../../../../base/common/event.js';\nimport { IMatch } from '../../../../base/common/filters.js';\nimport { hash } from '../../../../base/common/hash.js';\nimport { ResourceMap } from '../../../../base/common/map.js';\nimport { basename, extUri } from '../../../../base/common/resources.js';\nimport { splitLines } from '../../../../base/common/strings.js';\nimport { URI } from '../../../../base/common/uri.js';\nimport { IRange, Range } from '../../../../editor/common/core/range.js';\nimport { IMarker, IMarkerData, IRelatedInformation, MarkerSeverity } from '../../../../platform/markers/common/markers.js';\nimport { unsupportedSchemas } from '../../../../platform/markers/common/markerService.js';\n\nexport type MarkerElement = ResourceMarkers | Marker | RelatedInformation;\n\nexport function compareMarkersByUri(a: IMarker, b: IMarker) {\n\treturn extUri.compare(a.resource, b.resource);\n}\n\nfunction compareResourceMarkers(a: ResourceMarkers, b: ResourceMarkers): number {\n\tconst [firstMarkerOfA] = a.markers;\n\tconst [firstMarkerOfB] = b.markers;\n\tlet res = 0;\n\tif (firstMarkerOfA && firstMarkerOfB) {\n\t\tres = MarkerSeverity.compare(firstMarkerOfA.marker.severity, firstMarkerOfB.marker.severity);\n\t}\n\tif (res === 0) {\n\t\tres = a.path.localeCompare(b.path) || a.name.localeCompare(b.name);\n\t}\n\treturn res;\n}\n\n\nexport class ResourceMarkers {\n\n\treadonly path: string;\n\n\treadonly name: string;\n\n\tprivate _markersMap = new ResourceMap<Marker[]>();\n\tprivate _cachedMarkers: Marker[] | undefined;\n\tprivate _total: number = 0;\n\n\tconstructor(readonly id: string, readonly resource: URI) {\n\t\tthis.path = this.resource.fsPath;\n\t\tthis.name = basename(this.resource);\n\t}\n\n\tget markers(): readonly Marker[] {\n\t\tif (!this._cachedMarkers) {\n\t\t\tthis._cachedMarkers = [...this._markersMap.values()].flat().sort(ResourceMarkers._compareMarkers);\n\t\t}\n\t\treturn this._cachedMarkers;\n\t}\n\n\thas(uri: URI) {\n\t\treturn this._markersMap.has(uri);\n\t}\n\n\tset(uri: URI, marker: Marker[]) {\n\t\tthis.delete(uri);\n\t\tif (isNonEmptyArray(marker)) {\n\t\t\tthis._markersMap.set(uri, marker);\n\t\t\tthis._total += marker.length;\n\t\t\tthis._cachedMarkers = undefined;\n\t\t}\n\t}\n\n\tdelete(uri: URI) {\n\t\tconst array = this._markersMap.get(uri);\n\t\tif (array) {\n\t\t\tthis._total -= array.length;\n\t\t\tthis._cachedMarkers = undefined;\n\t\t\tthis._markersMap.delete(uri);\n\t\t}\n\t}\n\n\tget total() {\n\t\treturn this._total;\n\t}\n\n\tprivate static _compareMarkers(a: Marker, b: Marker): number {\n\t\treturn MarkerSeverity.compare(a.marker.severity, b.marker.severity)\n\t\t\t|| extUri.compare(a.resource, b.resource)\n\t\t\t|| Range.compareRangesUsingStarts(a.marker, b.marker);\n\t}\n}\n\nexport class Marker {\n\n\tget resource(): URI { return this.marker.resource; }\n\tget range(): IRange { return this.marker; }\n\n\tprivate _lines: string[] | undefined;\n\tget lines(): string[] {\n\t\tif (!this._lines) {\n\t\t\tthis._lines = splitLines(this.marker.message);\n\t\t}\n\t\treturn this._lines;\n\t}\n\n\tconstructor(\n\t\treadonly id: string,\n\t\treadonly marker: IMarker,\n\t\treadonly relatedInformation: RelatedInformation[] = []\n\t) { }\n\n\ttoString(): string {\n\t\treturn JSON.stringify({\n\t\t\t...this.marker,\n\t\t\tresource: this.marker.resource.path,\n\t\t\trelatedInformation: this.relatedInformation.length ? this.relatedInformation.map(r => ({ ...r.raw, resource: r.raw.resource.path })) : undefined\n\t\t}, null, '\\t');\n\t}\n}\n\nexport class MarkerTableItem extends Marker {\n\tconstructor(\n\t\tmarker: Marker,\n\t\treadonly sourceMatches?: IMatch[],\n\t\treadonly codeMatches?: IMatch[],\n\t\treadonly messageMatches?: IMatch[],\n\t\treadonly fileMatches?: IMatch[]\n\t) {\n\t\tsuper(marker.id, marker.marker, marker.relatedInformation);\n\t}\n}\n\nexport class RelatedInformation {\n\n\tconstructor(\n\t\treadonly id: string,\n\t\treadonly marker: IMarker,\n\t\treadonly raw: IRelatedInformation\n\t) { }\n}\n\nexport interface MarkerChangesEvent {\n\treadonly added: Set<ResourceMarkers>;\n\treadonly removed: Set<ResourceMarkers>;\n\treadonly updated: Set<ResourceMarkers>;\n}\n\nexport class MarkersModel {\n\n\tprivate cachedSortedResources: ResourceMarkers[] | undefined = undefined;\n\n\tprivate readonly _onDidChange = new Emitter<MarkerChangesEvent>();\n\treadonly onDidChange: Event<MarkerChangesEvent> = this._onDidChange.event;\n\n\tget resourceMarkers(): ResourceMarkers[] {\n\t\tif (!this.cachedSortedResources) {\n\t\t\tthis.cachedSortedResources = [...this.resourcesByUri.values()].sort(compareResourceMarkers);\n\t\t}\n\t\treturn this.cachedSortedResources;\n\t}\n\n\tprivate resourcesByUri: Map<string, ResourceMarkers>;\n\n\tconstructor() {\n\t\tthis.resourcesByUri = new Map<string, ResourceMarkers>();\n\t}\n\n\treset(): void {\n\t\tconst removed = new Set<ResourceMarkers>();\n\t\tfor (const resourceMarker of this.resourcesByUri.values()) {\n\t\t\tremoved.add(resourceMarker);\n\t\t}\n\t\tthis.resourcesByUri.clear();\n\t\tthis._total = 0;\n\t\tthis._onDidChange.fire({ removed, added: new Set<ResourceMarkers>(), updated: new Set<ResourceMarkers>() });\n\t}\n\n\tprivate _total: number = 0;\n\tget total(): number {\n\t\treturn this._total;\n\t}\n\n\tgetResourceMarkers(resource: URI): ResourceMarkers | null {\n\t\treturn this.resourcesByUri.get(extUri.getComparisonKey(resource, true)) ?? null;\n\t}\n\n\tsetResourceMarkers(resourcesMarkers: [URI, IMarker[]][]): void {\n\t\tconst change: MarkerChangesEvent = { added: new Set(), removed: new Set(), updated: new Set() };\n\t\tfor (const [resource, rawMarkers] of resourcesMarkers) {\n\n\t\t\tif (unsupportedSchemas.has(resource.scheme)) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tconst key = extUri.getComparisonKey(resource, true);\n\t\t\tlet resourceMarkers = this.resourcesByUri.get(key);\n\n\t\t\tif (isNonEmptyArray(rawMarkers)) {\n\t\t\t\t// update, add\n\t\t\t\tif (!resourceMarkers) {\n\t\t\t\t\tconst resourceMarkersId = this.id(resource.toString());\n\t\t\t\t\tresourceMarkers = new ResourceMarkers(resourceMarkersId, resource.with({ fragment: null }));\n\t\t\t\t\tthis.resourcesByUri.set(key, resourceMarkers);\n\t\t\t\t\tchange.added.add(resourceMarkers);\n\t\t\t\t} else {\n\t\t\t\t\tchange.updated.add(resourceMarkers);\n\t\t\t\t}\n\t\t\t\tconst markersCountByKey = new Map<string, number>();\n\t\t\t\tconst markers = rawMarkers.map((rawMarker) => {\n\t\t\t\t\tconst key = IMarkerData.makeKey(rawMarker);\n\t\t\t\t\tconst index = markersCountByKey.get(key) || 0;\n\t\t\t\t\tmarkersCountByKey.set(key, index + 1);\n\n\t\t\t\t\tconst markerId = this.id(resourceMarkers!.id, key, index, rawMarker.resource.toString());\n\n\t\t\t\t\tlet relatedInformation: RelatedInformation[] | undefined = undefined;\n\t\t\t\t\tif (rawMarker.relatedInformation) {\n\t\t\t\t\t\trelatedInformation = rawMarker.relatedInformation.map((r, index) => new RelatedInformation(this.id(markerId, r.resource.toString(), r.startLineNumber, r.startColumn, r.endLineNumber, r.endColumn, index), rawMarker, r));\n\t\t\t\t\t}\n\n\t\t\t\t\treturn new Marker(markerId, rawMarker, relatedInformation);\n\t\t\t\t});\n\n\t\t\t\tthis._total -= resourceMarkers.total;\n\t\t\t\tresourceMarkers.set(resource, markers);\n\t\t\t\tthis._total += resourceMarkers.total;\n\n\t\t\t} else if (resourceMarkers) {\n\t\t\t\t// clear\n\t\t\t\tthis._total -= resourceMarkers.total;\n\t\t\t\tresourceMarkers.delete(resource);\n\t\t\t\tthis._total += resourceMarkers.total;\n\t\t\t\tif (resourceMarkers.total === 0) {\n\t\t\t\t\tthis.resourcesByUri.delete(key);\n\t\t\t\t\tchange.removed.add(resourceMarkers);\n\t\t\t\t} else {\n\t\t\t\t\tchange.updated.add(resourceMarkers);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tthis.cachedSortedResources = undefined;\n\t\tif (change.added.size || change.removed.size || change.updated.size) {\n\t\t\tthis._onDidChange.fire(change);\n\t\t}\n\t}\n\n\tprivate id(...values: (string | number)[]): string {\n\t\treturn `${hash(values)}`;\n\t}\n\n\tdispose(): void {\n\t\tthis._onDidChange.dispose();\n\t\tthis.resourcesByUri.clear();\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { isNonEmptyArray } from '../../../../base/common/arrays.js';\nimport { Emitter, Event } from '../../../../base/common/event.js';\nimport { IMatch } from '../../../../base/common/filters.js';\nimport { hash } from '../../../../base/common/hash.js';\nimport { ResourceMap } from '../../../../base/common/map.js';\nimport { basename, extUri } from '../../../../base/common/resources.js';\nimport { splitLines } from '../../../../base/common/strings.js';\nimport { URI } from '../../../../base/common/uri.js';\nimport { IRange, Range } from '../../../../editor/common/core/range.js';\nimport { IMarker, IMarkerData, IRelatedInformation, MarkerSeverity } from '../../../../platform/markers/common/markers.js';\nimport { unsupportedSchemas } from '../../../../platform/markers/common/markerService.js';\n\nexport type MarkerElement = ResourceMarkers | Marker | RelatedInformation;\n\nexport function compareMarkersByUri(a: IMarker, b: IMarker) {\n\treturn extUri.compare(a.resource, b.resource);\n}\n\nfunction compareResourceMarkers(a: ResourceMarkers, b: ResourceMarkers): number {\n\tconst [firstMarkerOfA] = a.markers;\n\tconst [firstMarkerOfB] = b.markers;\n\tlet res = 0;\n\tif (firstMarkerOfA && firstMarkerOfB) {\n\t\tres = MarkerSeverity.compare(firstMarkerOfA.marker.severity, firstMarkerOfB.marker.severity);\n\t}\n\tif (res === 0) {\n\t\tres = a.path.localeCompare(b.path) || a.name.localeCompare(b.name);\n\t}\n\treturn res;\n}\n\n\nexport class ResourceMarkers {\n\n\treadonly path: string;\n\n\treadonly name: string;\n\n\tprivate _markersMap = new ResourceMap<Marker[]>();\n\tprivate _cachedMarkers: Marker[] | undefined;\n\tprivate _total: number = 0;\n\n\tconstructor(readonly id: string, readonly resource: URI) {\n\t\tthis.path = this.resource.fsPath;\n\t\tthis.name = basename(this.resource);\n\t}\n\n\tget markers(): readonly Marker[] {\n\t\tif (!this._cachedMarkers) {\n\t\t\tthis._cachedMarkers = [...this._markersMap.values()].flat().sort(ResourceMarkers._compareMarkers);\n\t\t}\n\t\treturn this._cachedMarkers;\n\t}\n\n\thas(uri: URI) {\n\t\treturn this._markersMap.has(uri);\n\t}\n\n\tset(uri: URI, marker: Marker[]) {\n\t\tthis.delete(uri);\n\t\tif (isNonEmptyArray(marker)) {\n\t\t\tthis._markersMap.set(uri, marker);\n\t\t\tthis._total += marker.length;\n\t\t\tthis._cachedMarkers = undefined;\n\t\t}\n\t}\n\n\tdelete(uri: URI) {\n\t\tconst array = this._markersMap.get(uri);\n\t\tif (array) {\n\t\t\tthis._total -= array.length;\n\t\t\tthis._cachedMarkers = undefined;\n\t\t\tthis._markersMap.delete(uri);\n\t\t}\n\t}\n\n\tget total() {\n\t\treturn this._total;\n\t}\n\n\tprivate static _compareMarkers(a: Marker, b: Marker): number {\n\t\treturn MarkerSeverity.compare(a.marker.severity, b.marker.severity)\n\t\t\t|| extUri.compare(a.resource, b.resource)\n\t\t\t|| Range.compareRangesUsingStarts(a.marker, b.marker);\n\t}\n}\n\nexport class Marker {\n\n\tget resource(): URI { return this.marker.resource; }\n\tget range(): IRange { return this.marker; }\n\n\tprivate _lines: string[] | undefined;\n\tget lines(): string[] {\n\t\tif (!this._lines) {\n\t\t\tthis._lines = splitLines(this.marker.message);\n\t\t}\n\t\treturn this._lines;\n\t}\n\n\tconstructor(\n\t\treadonly id: string,\n\t\treadonly marker: IMarker,\n\t\treadonly relatedInformation: RelatedInformation[] = []\n\t) { }\n\n\ttoString(): string {\n\t\treturn JSON.stringify({\n\t\t\t...this.marker,\n\t\t\tresource: this.marker.resource.path,\n\t\t\trelatedInformation: this.relatedInformation.length ? this.relatedInformation.map(r => ({ ...r.raw, resource: r.raw.resource.path })) : undefined\n\t\t}, null, '\\t');\n\t}\n}\n\nexport class MarkerTableItem extends Marker {\n\tconstructor(\n\t\tmarker: Marker,\n\t\treadonly sourceMatches?: IMatch[],\n\t\treadonly codeMatches?: IMatch[],\n\t\treadonly messageMatches?: IMatch[],\n\t\treadonly fileMatches?: IMatch[]\n\t) {\n\t\tsuper(marker.id, marker.marker, marker.relatedInformation);\n\t}\n}\n\nexport class RelatedInformation {\n\n\tconstructor(\n\t\treadonly id: string,\n\t\treadonly marker: IMarker,\n\t\treadonly raw: IRelatedInformation\n\t) { }\n}\n\nexport interface MarkerChangesEvent {\n\treadonly added: Set<ResourceMarkers>;\n\treadonly removed: Set<ResourceMarkers>;\n\treadonly updated: Set<ResourceMarkers>;\n}\n\nexport class MarkersModel {\n\n\tprivate cachedSortedResources: ResourceMarkers[] | undefined = undefined;\n\n\tprivate readonly _onDidChange = new Emitter<MarkerChangesEvent>();\n\treadonly onDidChange: Event<MarkerChangesEvent> = this._onDidChange.event;\n\n\tget resourceMarkers(): ResourceMarkers[] {\n\t\tif (!this.cachedSortedResources) {\n\t\t\tthis.cachedSortedResources = [...this.resourcesByUri.values()].sort(compareResourceMarkers);\n\t\t}\n\t\treturn this.cachedSortedResources;\n\t}\n\n\tprivate resourcesByUri: Map<string, ResourceMarkers>;\n\n\tconstructor() {\n\t\tthis.resourcesByUri = new Map<string, ResourceMarkers>();\n\t}\n\n\treset(): void {\n\t\tconst removed = new Set<ResourceMarkers>();\n\t\tfor (const resourceMarker of this.resourcesByUri.values()) {\n\t\t\tremoved.add(resourceMarker);\n\t\t}\n\t\tthis.resourcesByUri.clear();\n\t\tthis._total = 0;\n\t\tthis._onDidChange.fire({ removed, added: new Set<ResourceMarkers>(), updated: new Set<ResourceMarkers>() });\n\t}\n\n\tprivate _total: number = 0;\n\tget total(): number {\n\t\treturn this._total;\n\t}\n\n\tgetResourceMarkers(resource: URI): ResourceMarkers | null {\n\t\treturn this.resourcesByUri.get(extUri.getComparisonKey(resource, true)) ?? null;\n\t}\n\n\tsetResourceMarkers(resourcesMarkers: [URI, IMarker[]][]): void {\n\t\tconst change: MarkerChangesEvent = { added: new Set(), removed: new Set(), updated: new Set() };\n\t\tfor (const [resource, rawMarkers] of resourcesMarkers) {\n\n\t\t\tif (unsupportedSchemas.has(resource.scheme)) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tconst key = extUri.getComparisonKey(resource, true);\n\t\t\tlet resourceMarkers = this.resourcesByUri.get(key);\n\n\t\t\tif (isNonEmptyArray(rawMarkers)) {\n\t\t\t\t// update, add\n\t\t\t\tif (!resourceMarkers) {\n\t\t\t\t\tconst resourceMarkersId = this.id(resource.toString());\n\t\t\t\t\tresourceMarkers = new ResourceMarkers(resourceMarkersId, resource.with({ fragment: null }));\n\t\t\t\t\tthis.resourcesByUri.set(key, resourceMarkers);\n\t\t\t\t\tchange.added.add(resourceMarkers);\n\t\t\t\t} else {\n\t\t\t\t\tchange.updated.add(resourceMarkers);\n\t\t\t\t}\n\t\t\t\tconst markersCountByKey = new Map<string, number>();\n\t\t\t\tconst markers = rawMarkers.map((rawMarker) => {\n\t\t\t\t\tconst key = IMarkerData.makeKey(rawMarker);\n\t\t\t\t\tconst index = markersCountByKey.get(key) || 0;\n\t\t\t\t\tmarkersCountByKey.set(key, index + 1);\n\n\t\t\t\t\tconst markerId = this.id(resourceMarkers!.id, key, index, rawMarker.resource.toString());\n\n\t\t\t\t\tlet relatedInformation: RelatedInformation[] | undefined = undefined;\n\t\t\t\t\tif (rawMarker.relatedInformation) {\n\t\t\t\t\t\trelatedInformation = rawMarker.relatedInformation.map((r, index) => new RelatedInformation(this.id(markerId, r.resource.toString(), r.startLineNumber, r.startColumn, r.endLineNumber, r.endColumn, index), rawMarker, r));\n\t\t\t\t\t}\n\n\t\t\t\t\treturn new Marker(markerId, rawMarker, relatedInformation);\n\t\t\t\t});\n\n\t\t\t\tthis._total -= resourceMarkers.total;\n\t\t\t\tresourceMarkers.set(resource, markers);\n\t\t\t\tthis._total += resourceMarkers.total;\n\n\t\t\t} else if (resourceMarkers) {\n\t\t\t\t// clear\n\t\t\t\tthis._total -= resourceMarkers.total;\n\t\t\t\tresourceMarkers.delete(resource);\n\t\t\t\tthis._total += resourceMarkers.total;\n\t\t\t\tif (resourceMarkers.total === 0) {\n\t\t\t\t\tthis.resourcesByUri.delete(key);\n\t\t\t\t\tchange.removed.add(resourceMarkers);\n\t\t\t\t} else {\n\t\t\t\t\tchange.updated.add(resourceMarkers);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tthis.cachedSortedResources = undefined;\n\t\tif (change.added.size || change.removed.size || change.updated.size) {\n\t\t\tthis._onDidChange.fire(change);\n\t\t}\n\t}\n\n\tprivate id(...values: (string | number)[]): string {\n\t\treturn `${hash(values)}`;\n\t}\n\n\tdispose(): void {\n\t\tthis._onDidChange.dispose();\n\t\tthis.resourcesByUri.clear();\n\t}\n}\n"]}