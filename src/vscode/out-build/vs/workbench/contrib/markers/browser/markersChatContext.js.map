{"version":3,"sources":["vs/workbench/contrib/markers/browser/markersChatContext.ts"],"names":[],"mappings":"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","file":"markersChatContext.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\n\nimport { groupBy } from '../../../../base/common/arrays.js';\nimport { CancellationToken } from '../../../../base/common/cancellation.js';\nimport { Codicon } from '../../../../base/common/codicons.js';\nimport { Disposable } from '../../../../base/common/lifecycle.js';\nimport { extUri } from '../../../../base/common/resources.js';\nimport { localize } from '../../../../nls.js';\nimport { IInstantiationService } from '../../../../platform/instantiation/common/instantiation.js';\nimport { ILabelService } from '../../../../platform/label/common/label.js';\nimport { IMarkerService, MarkerSeverity } from '../../../../platform/markers/common/markers.js';\nimport { IQuickPickSeparator } from '../../../../platform/quickinput/common/quickInput.js';\nimport { EditorResourceAccessor } from '../../../common/editor.js';\nimport { IWorkbenchContribution } from '../../../common/contributions.js';\nimport { IEditorService } from '../../../services/editor/common/editorService.js';\nimport { IChatContextPickerItem, IChatContextPickerPickItem, IChatContextPickService, IChatContextPicker, picksWithPromiseFn } from '../../chat/browser/chatContextPickService.js';\nimport { IDiagnosticVariableEntryFilterData } from '../../chat/common/chatVariableEntries.js';\nimport { IChatWidget } from '../../chat/browser/chat.js';\n\nclass MarkerChatContextPick implements IChatContextPickerItem {\n\n\treadonly type = 'pickerPick';\n\treadonly label = localize('chatContext.diagnstic', 'Problems...');\n\treadonly icon = Codicon.error;\n\treadonly ordinal = -100;\n\n\tconstructor(\n\t\t@IMarkerService private readonly _markerService: IMarkerService,\n\t\t@ILabelService private readonly _labelService: ILabelService,\n\t\t@IEditorService private readonly _editorService: IEditorService,\n\t) { }\n\n\tisEnabled(widget: IChatWidget): Promise<boolean> | boolean {\n\t\treturn !!widget.attachmentCapabilities.supportsProblemAttachments;\n\t}\n\tasPicker(): IChatContextPicker {\n\t\treturn {\n\t\t\tplaceholder: localize('chatContext.diagnstic.placeholder', 'Select a problem to attach'),\n\t\t\tpicks: picksWithPromiseFn(async (query: string, token: CancellationToken) => {\n\t\t\t\treturn this.getPicksForQuery(query);\n\t\t\t})\n\t\t};\n\t}\n\n\t/**\n\t * @internal For testing purposes only\n\t */\n\tgetPicksForQuery(query: string): (IChatContextPickerPickItem | IQuickPickSeparator)[] {\n\t\tconst markers = this._markerService.read({ severities: MarkerSeverity.Error | MarkerSeverity.Warning | MarkerSeverity.Info });\n\t\tconst grouped = groupBy(markers, (a, b) => extUri.compare(a.resource, b.resource));\n\n\t\t// Get the active editor URI for prioritization\n\t\tconst activeEditorUri = EditorResourceAccessor.getCanonicalUri(this._editorService.activeEditor);\n\n\t\t// Sort groups to prioritize active file\n\t\tconst sortedGroups = grouped.sort((groupA, groupB) => {\n\t\t\tconst resourceA = groupA[0].resource;\n\t\t\tconst resourceB = groupB[0].resource;\n\n\t\t\t// If one group is from the active file, prioritize it\n\t\t\tif (activeEditorUri) {\n\t\t\t\tconst isAActiveFile = extUri.isEqual(resourceA, activeEditorUri);\n\t\t\t\tconst isBActiveFile = extUri.isEqual(resourceB, activeEditorUri);\n\n\t\t\t\tif (isAActiveFile && !isBActiveFile) {\n\t\t\t\t\treturn -1; // A comes first\n\t\t\t\t}\n\t\t\t\tif (!isAActiveFile && isBActiveFile) {\n\t\t\t\t\treturn 1; // B comes first\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Otherwise, sort by resource URI as before\n\t\t\treturn extUri.compare(resourceA, resourceB);\n\t\t});\n\n\t\tconst severities = new Set<MarkerSeverity>();\n\t\tconst items: (IChatContextPickerPickItem | IQuickPickSeparator)[] = [];\n\n\t\tlet pickCount = 0;\n\t\tfor (const group of sortedGroups) {\n\t\t\tconst resource = group[0].resource;\n\t\t\tconst isActiveFile = activeEditorUri && extUri.isEqual(resource, activeEditorUri);\n\t\t\tconst fileLabel = this._labelService.getUriLabel(resource, { relative: true });\n\t\t\tconst separatorLabel = isActiveFile ? `${fileLabel} (current file)` : fileLabel;\n\n\t\t\titems.push({ type: 'separator', label: separatorLabel });\n\t\t\tfor (const marker of group) {\n\t\t\t\tpickCount++;\n\t\t\t\tseverities.add(marker.severity);\n\n\t\t\t\titems.push({\n\t\t\t\t\tlabel: marker.message,\n\t\t\t\t\tdescription: localize('markers.panel.at.ln.col.number', \"[Ln {0}, Col {1}]\", '' + marker.startLineNumber, '' + marker.startColumn),\n\t\t\t\t\tasAttachment() {\n\t\t\t\t\t\treturn IDiagnosticVariableEntryFilterData.toEntry(IDiagnosticVariableEntryFilterData.fromMarker(marker));\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\titems.unshift({\n\t\t\tlabel: localize('markers.panel.allErrors', 'All Problems'),\n\t\t\tasAttachment() {\n\t\t\t\treturn IDiagnosticVariableEntryFilterData.toEntry({\n\t\t\t\t\tfilterSeverity: MarkerSeverity.Info\n\t\t\t\t});\n\t\t\t},\n\t\t});\n\n\t\treturn items;\n\t}\n}\n\n\nexport class MarkerChatContextContribution extends Disposable implements IWorkbenchContribution {\n\n\tstatic readonly ID = 'workbench.contrib.chat.markerChatContextContribution';\n\n\tconstructor(\n\t\t@IChatContextPickService contextPickService: IChatContextPickService,\n\t\t@IInstantiationService instantiationService: IInstantiationService,\n\t) {\n\t\tsuper();\n\t\tthis._store.add(contextPickService.registerChatContextItem(instantiationService.createInstance(MarkerChatContextPick)));\n\t}\n}\n"]}