{"version":3,"sources":["vs/workbench/contrib/update/browser/update.ts"],"names":[],"mappings":"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","file":"update.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as nls from '../../../../nls.js';\nimport severity from '../../../../base/common/severity.js';\nimport { Disposable, MutableDisposable } from '../../../../base/common/lifecycle.js';\nimport { URI } from '../../../../base/common/uri.js';\nimport { IActivityService, NumberBadge, IBadge, ProgressBadge } from '../../../services/activity/common/activity.js';\nimport { IInstantiationService, ServicesAccessor } from '../../../../platform/instantiation/common/instantiation.js';\nimport { IOpenerService } from '../../../../platform/opener/common/opener.js';\nimport { IWorkbenchContribution } from '../../../common/contributions.js';\nimport { IStorageService, StorageScope, StorageTarget } from '../../../../platform/storage/common/storage.js';\nimport { IUpdateService, State as UpdateState, StateType, IUpdate, DisablementReason } from '../../../../platform/update/common/update.js';\nimport { INotificationService, NotificationPriority, Severity } from '../../../../platform/notification/common/notification.js';\nimport { IDialogService } from '../../../../platform/dialogs/common/dialogs.js';\nimport { IBrowserWorkbenchEnvironmentService } from '../../../services/environment/browser/environmentService.js';\nimport { ReleaseNotesManager } from './releaseNotesEditor.js';\nimport { isMacintosh, isWeb, isWindows } from '../../../../base/common/platform.js';\nimport { IConfigurationService } from '../../../../platform/configuration/common/configuration.js';\nimport { RawContextKey, IContextKey, IContextKeyService, ContextKeyExpr } from '../../../../platform/contextkey/common/contextkey.js';\nimport { MenuRegistry, MenuId, registerAction2, Action2 } from '../../../../platform/actions/common/actions.js';\nimport { CommandsRegistry } from '../../../../platform/commands/common/commands.js';\nimport { IHostService } from '../../../services/host/browser/host.js';\nimport { IProductService } from '../../../../platform/product/common/productService.js';\nimport { IUserDataSyncEnablementService, IUserDataSyncService, IUserDataSyncStoreManagementService, SyncStatus, UserDataSyncStoreType } from '../../../../platform/userDataSync/common/userDataSync.js';\nimport { IsWebContext } from '../../../../platform/contextkey/common/contextkeys.js';\nimport { Promises } from '../../../../base/common/async.js';\nimport { IUserDataSyncWorkbenchService } from '../../../services/userDataSync/common/userDataSync.js';\nimport { Event } from '../../../../base/common/event.js';\nimport { toAction } from '../../../../base/common/actions.js';\n\nexport const CONTEXT_UPDATE_STATE = new RawContextKey<string>('updateState', StateType.Uninitialized);\nexport const MAJOR_MINOR_UPDATE_AVAILABLE = new RawContextKey<boolean>('majorMinorUpdateAvailable', false);\nexport const RELEASE_NOTES_URL = new RawContextKey<string>('releaseNotesUrl', '');\nexport const DOWNLOAD_URL = new RawContextKey<string>('downloadUrl', '');\n\nlet releaseNotesManager: ReleaseNotesManager | undefined = undefined;\n\nexport function showReleaseNotesInEditor(instantiationService: IInstantiationService, version: string, useCurrentFile: boolean) {\n\tif (!releaseNotesManager) {\n\t\treleaseNotesManager = instantiationService.createInstance(ReleaseNotesManager);\n\t}\n\n\treturn releaseNotesManager.show(version, useCurrentFile);\n}\n\nasync function openLatestReleaseNotesInBrowser(accessor: ServicesAccessor) {\n\tconst openerService = accessor.get(IOpenerService);\n\tconst productService = accessor.get(IProductService);\n\n\tif (productService.releaseNotesUrl) {\n\t\tconst uri = URI.parse(productService.releaseNotesUrl);\n\t\tawait openerService.open(uri);\n\t} else {\n\t\tthrow new Error(nls.localize('update.noReleaseNotesOnline', \"This version of {0} does not have release notes online\", productService.nameLong));\n\t}\n}\n\nasync function showReleaseNotes(accessor: ServicesAccessor, version: string) {\n\tconst instantiationService = accessor.get(IInstantiationService);\n\ttry {\n\t\tawait showReleaseNotesInEditor(instantiationService, version, false);\n\t} catch (err) {\n\t\ttry {\n\t\t\tawait instantiationService.invokeFunction(openLatestReleaseNotesInBrowser);\n\t\t} catch (err2) {\n\t\t\tthrow new Error(`${err.message} and ${err2.message}`);\n\t\t}\n\t}\n}\n\ninterface IVersion {\n\tmajor: number;\n\tminor: number;\n\tpatch: number;\n}\n\nfunction parseVersion(version: string): IVersion | undefined {\n\tconst match = /([0-9]+)\\.([0-9]+)\\.([0-9]+)/.exec(version);\n\n\tif (!match) {\n\t\treturn undefined;\n\t}\n\n\treturn {\n\t\tmajor: parseInt(match[1]),\n\t\tminor: parseInt(match[2]),\n\t\tpatch: parseInt(match[3])\n\t};\n}\n\nfunction isMajorMinorUpdate(before: IVersion, after: IVersion): boolean {\n\treturn before.major < after.major || before.minor < after.minor;\n}\n\nexport class ProductContribution implements IWorkbenchContribution {\n\n\tprivate static readonly KEY = 'releaseNotes/lastVersion';\n\n\tconstructor(\n\t\t@IStorageService storageService: IStorageService,\n\t\t@IInstantiationService instantiationService: IInstantiationService,\n\t\t@INotificationService notificationService: INotificationService,\n\t\t@IBrowserWorkbenchEnvironmentService environmentService: IBrowserWorkbenchEnvironmentService,\n\t\t@IOpenerService openerService: IOpenerService,\n\t\t@IConfigurationService configurationService: IConfigurationService,\n\t\t@IHostService hostService: IHostService,\n\t\t@IProductService productService: IProductService,\n\t\t@IContextKeyService contextKeyService: IContextKeyService,\n\t) {\n\t\tif (productService.releaseNotesUrl) {\n\t\t\tconst releaseNotesUrlKey = RELEASE_NOTES_URL.bindTo(contextKeyService);\n\t\t\treleaseNotesUrlKey.set(productService.releaseNotesUrl);\n\t\t}\n\t\tif (productService.downloadUrl) {\n\t\t\tconst downloadUrlKey = DOWNLOAD_URL.bindTo(contextKeyService);\n\t\t\tdownloadUrlKey.set(productService.downloadUrl);\n\t\t}\n\n\t\tif (isWeb) {\n\t\t\treturn;\n\t\t}\n\n\t\thostService.hadLastFocus().then(async hadLastFocus => {\n\t\t\tif (!hadLastFocus) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst lastVersion = parseVersion(storageService.get(ProductContribution.KEY, StorageScope.APPLICATION, ''));\n\t\t\tconst currentVersion = parseVersion(productService.version);\n\t\t\tconst shouldShowReleaseNotes = configurationService.getValue<boolean>('update.showReleaseNotes');\n\t\t\tconst releaseNotesUrl = productService.releaseNotesUrl;\n\n\t\t\t// was there a major/minor update? if so, open release notes\n\t\t\tif (shouldShowReleaseNotes && !environmentService.skipReleaseNotes && releaseNotesUrl && lastVersion && currentVersion && isMajorMinorUpdate(lastVersion, currentVersion)) {\n\t\t\t\tshowReleaseNotesInEditor(instantiationService, productService.version, false)\n\t\t\t\t\t.then(undefined, () => {\n\t\t\t\t\t\tnotificationService.prompt(\n\t\t\t\t\t\t\tseverity.Info,\n\t\t\t\t\t\t\tnls.localize('read the release notes', \"Welcome to {0} v{1}! Would you like to read the Release Notes?\", productService.nameLong, productService.version),\n\t\t\t\t\t\t\t[{\n\t\t\t\t\t\t\t\tlabel: nls.localize('releaseNotes', \"Release Notes\"),\n\t\t\t\t\t\t\t\trun: () => {\n\t\t\t\t\t\t\t\t\tconst uri = URI.parse(releaseNotesUrl);\n\t\t\t\t\t\t\t\t\topenerService.open(uri);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}],\n\t\t\t\t\t\t\t{ priority: NotificationPriority.OPTIONAL }\n\t\t\t\t\t\t);\n\t\t\t\t\t});\n\t\t\t}\n\n\t\t\tstorageService.store(ProductContribution.KEY, productService.version, StorageScope.APPLICATION, StorageTarget.MACHINE);\n\t\t});\n\t}\n}\n\nexport class UpdateContribution extends Disposable implements IWorkbenchContribution {\n\n\tprivate state: UpdateState;\n\tprivate readonly badgeDisposable = this._register(new MutableDisposable());\n\tprivate updateStateContextKey: IContextKey<string>;\n\tprivate majorMinorUpdateAvailableContextKey: IContextKey<boolean>;\n\n\tconstructor(\n\t\t@IStorageService private readonly storageService: IStorageService,\n\t\t@IInstantiationService private readonly instantiationService: IInstantiationService,\n\t\t@INotificationService private readonly notificationService: INotificationService,\n\t\t@IDialogService private readonly dialogService: IDialogService,\n\t\t@IUpdateService private readonly updateService: IUpdateService,\n\t\t@IActivityService private readonly activityService: IActivityService,\n\t\t@IContextKeyService private readonly contextKeyService: IContextKeyService,\n\t\t@IProductService private readonly productService: IProductService,\n\t\t@IOpenerService private readonly openerService: IOpenerService,\n\t\t@IConfigurationService private readonly configurationService: IConfigurationService,\n\t\t@IHostService private readonly hostService: IHostService\n\t) {\n\t\tsuper();\n\t\tthis.state = updateService.state;\n\t\tthis.updateStateContextKey = CONTEXT_UPDATE_STATE.bindTo(this.contextKeyService);\n\t\tthis.majorMinorUpdateAvailableContextKey = MAJOR_MINOR_UPDATE_AVAILABLE.bindTo(this.contextKeyService);\n\n\t\tthis._register(updateService.onStateChange(this.onUpdateStateChange, this));\n\t\tthis.onUpdateStateChange(this.updateService.state);\n\n\t\t/*\n\t\tThe `update/lastKnownVersion` and `update/updateNotificationTime` storage keys are used in\n\t\tcombination to figure out when to show a message to the user that he should update.\n\n\t\tThis message should appear if the user has received an update notification but hasn't\n\t\tupdated since 5 days.\n\t\t*/\n\n\t\tconst currentVersion = this.productService.commit;\n\t\tconst lastKnownVersion = this.storageService.get('update/lastKnownVersion', StorageScope.APPLICATION);\n\n\t\t// if current version != stored version, clear both fields\n\t\tif (currentVersion !== lastKnownVersion) {\n\t\t\tthis.storageService.remove('update/lastKnownVersion', StorageScope.APPLICATION);\n\t\t\tthis.storageService.remove('update/updateNotificationTime', StorageScope.APPLICATION);\n\t\t}\n\n\t\tthis.registerGlobalActivityActions();\n\t}\n\n\tprivate async onUpdateStateChange(state: UpdateState): Promise<void> {\n\t\tthis.updateStateContextKey.set(state.type);\n\n\t\tswitch (state.type) {\n\t\t\tcase StateType.Disabled:\n\t\t\t\tif (state.reason === DisablementReason.RunningAsAdmin) {\n\t\t\t\t\tthis.notificationService.notify({\n\t\t\t\t\t\tseverity: Severity.Info,\n\t\t\t\t\t\tmessage: nls.localize('update service disabled', \"Updates are disabled because you are running the user-scope installation of {0} as Administrator.\", this.productService.nameLong),\n\t\t\t\t\t\tactions: {\n\t\t\t\t\t\t\tprimary: [\n\t\t\t\t\t\t\t\ttoAction({\n\t\t\t\t\t\t\t\t\tid: '',\n\t\t\t\t\t\t\t\t\tlabel: nls.localize('learn more', \"Learn More\"),\n\t\t\t\t\t\t\t\t\trun: () => this.openerService.open('https://aka.ms/vscode-windows-setup')\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t]\n\t\t\t\t\t\t},\n\t\t\t\t\t\tneverShowAgain: { id: 'no-updates-running-as-admin', }\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tbreak;\n\n\t\t\tcase StateType.Idle:\n\t\t\t\tif (state.error) {\n\t\t\t\t\tthis.onError(state.error);\n\t\t\t\t} else if (this.state.type === StateType.CheckingForUpdates && this.state.explicit && await this.hostService.hadLastFocus()) {\n\t\t\t\t\tthis.onUpdateNotAvailable();\n\t\t\t\t}\n\t\t\t\tbreak;\n\n\t\t\tcase StateType.AvailableForDownload:\n\t\t\t\tthis.onUpdateAvailable(state.update);\n\t\t\t\tbreak;\n\n\t\t\tcase StateType.Downloaded:\n\t\t\t\tthis.onUpdateDownloaded(state.update);\n\t\t\t\tbreak;\n\n\t\t\tcase StateType.Ready: {\n\t\t\t\tconst productVersion = state.update.productVersion;\n\t\t\t\tif (productVersion) {\n\t\t\t\t\tconst currentVersion = parseVersion(this.productService.version);\n\t\t\t\t\tconst nextVersion = parseVersion(productVersion);\n\t\t\t\t\tthis.majorMinorUpdateAvailableContextKey.set(Boolean(currentVersion && nextVersion && isMajorMinorUpdate(currentVersion, nextVersion)));\n\t\t\t\t\tthis.onUpdateReady(state.update);\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\tlet badge: IBadge | undefined = undefined;\n\n\t\tif (state.type === StateType.AvailableForDownload || state.type === StateType.Downloaded || state.type === StateType.Ready) {\n\t\t\tbadge = new NumberBadge(1, () => nls.localize('updateIsReady', \"New {0} update available.\", this.productService.nameShort));\n\t\t} else if (state.type === StateType.CheckingForUpdates) {\n\t\t\tbadge = new ProgressBadge(() => nls.localize('checkingForUpdates', \"Checking for {0} updates...\", this.productService.nameShort));\n\t\t} else if (state.type === StateType.Downloading) {\n\t\t\tbadge = new ProgressBadge(() => nls.localize('downloading', \"Downloading {0} update...\", this.productService.nameShort));\n\t\t} else if (state.type === StateType.Updating) {\n\t\t\tbadge = new ProgressBadge(() => nls.localize('updating', \"Updating {0}...\", this.productService.nameShort));\n\t\t}\n\n\t\tthis.badgeDisposable.clear();\n\n\t\tif (badge) {\n\t\t\tthis.badgeDisposable.value = this.activityService.showGlobalActivity({ badge });\n\t\t}\n\n\t\tthis.state = state;\n\t}\n\n\tprivate onError(error: string): void {\n\t\tif (/The request timed out|The network connection was lost/i.test(error)) {\n\t\t\treturn;\n\t\t}\n\n\t\terror = error.replace(/See https:\\/\\/github\\.com\\/Squirrel\\/Squirrel\\.Mac\\/issues\\/182 for more information/, 'This might mean the application was put on quarantine by macOS. See [this link](https://github.com/microsoft/vscode/issues/7426#issuecomment-425093469) for more information');\n\n\t\tthis.notificationService.notify({\n\t\t\tseverity: Severity.Error,\n\t\t\tmessage: error,\n\t\t\tsource: nls.localize('update service', \"Update Service\"),\n\t\t});\n\t}\n\n\tprivate onUpdateNotAvailable(): void {\n\t\tthis.dialogService.info(nls.localize('noUpdatesAvailable', \"There are currently no updates available.\"));\n\t}\n\n\t// linux\n\tprivate onUpdateAvailable(update: IUpdate): void {\n\t\tif (!this.shouldShowNotification()) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst productVersion = update.productVersion;\n\t\tif (!productVersion) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.notificationService.prompt(\n\t\t\tseverity.Info,\n\t\t\tnls.localize('thereIsUpdateAvailable', \"There is an available update.\"),\n\t\t\t[{\n\t\t\t\tlabel: nls.localize('download update', \"Download Update\"),\n\t\t\t\trun: () => this.updateService.downloadUpdate()\n\t\t\t}, {\n\t\t\t\tlabel: nls.localize('later', \"Later\"),\n\t\t\t\trun: () => { }\n\t\t\t}, {\n\t\t\t\tlabel: nls.localize('releaseNotes', \"Release Notes\"),\n\t\t\t\trun: () => {\n\t\t\t\t\tthis.instantiationService.invokeFunction(accessor => showReleaseNotes(accessor, productVersion));\n\t\t\t\t}\n\t\t\t}],\n\t\t\t{ priority: NotificationPriority.OPTIONAL }\n\t\t);\n\t}\n\n\t// windows fast updates\n\tprivate onUpdateDownloaded(update: IUpdate): void {\n\t\tif (isMacintosh) {\n\t\t\treturn;\n\t\t}\n\t\tif (this.configurationService.getValue('update.enableWindowsBackgroundUpdates') && this.productService.target === 'user') {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.shouldShowNotification()) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst productVersion = update.productVersion;\n\t\tif (!productVersion) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.notificationService.prompt(\n\t\t\tseverity.Info,\n\t\t\tnls.localize('updateAvailable', \"There's an update available: {0} {1}\", this.productService.nameLong, productVersion),\n\t\t\t[{\n\t\t\t\tlabel: nls.localize('installUpdate', \"Install Update\"),\n\t\t\t\trun: () => this.updateService.applyUpdate()\n\t\t\t}, {\n\t\t\t\tlabel: nls.localize('later', \"Later\"),\n\t\t\t\trun: () => { }\n\t\t\t}, {\n\t\t\t\tlabel: nls.localize('releaseNotes', \"Release Notes\"),\n\t\t\t\trun: () => {\n\t\t\t\t\tthis.instantiationService.invokeFunction(accessor => showReleaseNotes(accessor, productVersion));\n\t\t\t\t}\n\t\t\t}],\n\t\t\t{ priority: NotificationPriority.OPTIONAL }\n\t\t);\n\t}\n\n\t// windows and mac\n\tprivate onUpdateReady(update: IUpdate): void {\n\t\tif (!(isWindows && this.productService.target !== 'user') && !this.shouldShowNotification()) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst actions = [{\n\t\t\tlabel: nls.localize('updateNow', \"Update Now\"),\n\t\t\trun: () => this.updateService.quitAndInstall()\n\t\t}, {\n\t\t\tlabel: nls.localize('later', \"Later\"),\n\t\t\trun: () => { }\n\t\t}];\n\n\t\tconst productVersion = update.productVersion;\n\t\tif (productVersion) {\n\t\t\tactions.push({\n\t\t\t\tlabel: nls.localize('releaseNotes', \"Release Notes\"),\n\t\t\t\trun: () => {\n\t\t\t\t\tthis.instantiationService.invokeFunction(accessor => showReleaseNotes(accessor, productVersion));\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\t// windows user fast updates and mac\n\t\tthis.notificationService.prompt(\n\t\t\tseverity.Info,\n\t\t\tnls.localize('updateAvailableAfterRestart', \"Restart {0} to apply the latest update.\", this.productService.nameLong),\n\t\t\tactions,\n\t\t\t{\n\t\t\t\tsticky: true,\n\t\t\t\tpriority: NotificationPriority.OPTIONAL\n\t\t\t}\n\t\t);\n\t}\n\n\tprivate shouldShowNotification(): boolean {\n\t\tconst currentVersion = this.productService.commit;\n\t\tconst currentMillis = new Date().getTime();\n\t\tconst lastKnownVersion = this.storageService.get('update/lastKnownVersion', StorageScope.APPLICATION);\n\n\t\t// if version != stored version, save version and date\n\t\tif (currentVersion !== lastKnownVersion) {\n\t\t\tthis.storageService.store('update/lastKnownVersion', currentVersion, StorageScope.APPLICATION, StorageTarget.MACHINE);\n\t\t\tthis.storageService.store('update/updateNotificationTime', currentMillis, StorageScope.APPLICATION, StorageTarget.MACHINE);\n\t\t}\n\n\t\tconst updateNotificationMillis = this.storageService.getNumber('update/updateNotificationTime', StorageScope.APPLICATION, currentMillis);\n\t\tconst diffDays = (currentMillis - updateNotificationMillis) / (1000 * 60 * 60 * 24);\n\n\t\treturn diffDays > 5;\n\t}\n\n\tprivate registerGlobalActivityActions(): void {\n\t\tCommandsRegistry.registerCommand('update.check', () => this.updateService.checkForUpdates(true));\n\t\tMenuRegistry.appendMenuItem(MenuId.GlobalActivity, {\n\t\t\tgroup: '7_update',\n\t\t\tcommand: {\n\t\t\t\tid: 'update.check',\n\t\t\t\ttitle: nls.localize('checkForUpdates', \"Check for Updates...\")\n\t\t\t},\n\t\t\twhen: CONTEXT_UPDATE_STATE.isEqualTo(StateType.Idle)\n\t\t});\n\n\t\tCommandsRegistry.registerCommand('update.checking', () => { });\n\t\tMenuRegistry.appendMenuItem(MenuId.GlobalActivity, {\n\t\t\tgroup: '7_update',\n\t\t\tcommand: {\n\t\t\t\tid: 'update.checking',\n\t\t\t\ttitle: nls.localize('checkingForUpdates2', \"Checking for Updates...\"),\n\t\t\t\tprecondition: ContextKeyExpr.false()\n\t\t\t},\n\t\t\twhen: CONTEXT_UPDATE_STATE.isEqualTo(StateType.CheckingForUpdates)\n\t\t});\n\n\t\tCommandsRegistry.registerCommand('update.downloadNow', () => this.updateService.downloadUpdate());\n\t\tMenuRegistry.appendMenuItem(MenuId.GlobalActivity, {\n\t\t\tgroup: '7_update',\n\t\t\tcommand: {\n\t\t\t\tid: 'update.downloadNow',\n\t\t\t\ttitle: nls.localize('download update_1', \"Download Update (1)\")\n\t\t\t},\n\t\t\twhen: CONTEXT_UPDATE_STATE.isEqualTo(StateType.AvailableForDownload)\n\t\t});\n\n\t\tCommandsRegistry.registerCommand('update.downloading', () => { });\n\t\tMenuRegistry.appendMenuItem(MenuId.GlobalActivity, {\n\t\t\tgroup: '7_update',\n\t\t\tcommand: {\n\t\t\t\tid: 'update.downloading',\n\t\t\t\ttitle: nls.localize('DownloadingUpdate', \"Downloading Update...\"),\n\t\t\t\tprecondition: ContextKeyExpr.false()\n\t\t\t},\n\t\t\twhen: CONTEXT_UPDATE_STATE.isEqualTo(StateType.Downloading)\n\t\t});\n\n\t\tCommandsRegistry.registerCommand('update.install', () => this.updateService.applyUpdate());\n\t\tMenuRegistry.appendMenuItem(MenuId.GlobalActivity, {\n\t\t\tgroup: '7_update',\n\t\t\tcommand: {\n\t\t\t\tid: 'update.install',\n\t\t\t\ttitle: nls.localize('installUpdate...', \"Install Update... (1)\")\n\t\t\t},\n\t\t\twhen: CONTEXT_UPDATE_STATE.isEqualTo(StateType.Downloaded)\n\t\t});\n\n\t\tCommandsRegistry.registerCommand('update.updating', () => { });\n\t\tMenuRegistry.appendMenuItem(MenuId.GlobalActivity, {\n\t\t\tgroup: '7_update',\n\t\t\tcommand: {\n\t\t\t\tid: 'update.updating',\n\t\t\t\ttitle: nls.localize('installingUpdate', \"Installing Update...\"),\n\t\t\t\tprecondition: ContextKeyExpr.false()\n\t\t\t},\n\t\t\twhen: CONTEXT_UPDATE_STATE.isEqualTo(StateType.Updating)\n\t\t});\n\n\t\tif (this.productService.quality === 'stable') {\n\t\t\tCommandsRegistry.registerCommand('update.showUpdateReleaseNotes', () => {\n\t\t\t\tif (this.updateService.state.type !== StateType.Ready) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst productVersion = this.updateService.state.update.productVersion;\n\t\t\t\tif (productVersion) {\n\t\t\t\t\tthis.instantiationService.invokeFunction(accessor => showReleaseNotes(accessor, productVersion));\n\t\t\t\t}\n\n\t\t\t});\n\t\t\tMenuRegistry.appendMenuItem(MenuId.GlobalActivity, {\n\t\t\t\tgroup: '7_update',\n\t\t\t\torder: 1,\n\t\t\t\tcommand: {\n\t\t\t\t\tid: 'update.showUpdateReleaseNotes',\n\t\t\t\t\ttitle: nls.localize('showUpdateReleaseNotes', \"Show Update Release Notes\")\n\t\t\t\t},\n\t\t\t\twhen: ContextKeyExpr.and(CONTEXT_UPDATE_STATE.isEqualTo(StateType.Ready), MAJOR_MINOR_UPDATE_AVAILABLE)\n\t\t\t});\n\t\t}\n\n\t\tCommandsRegistry.registerCommand('update.restart', () => this.updateService.quitAndInstall());\n\t\tMenuRegistry.appendMenuItem(MenuId.GlobalActivity, {\n\t\t\tgroup: '7_update',\n\t\t\torder: 2,\n\t\t\tcommand: {\n\t\t\t\tid: 'update.restart',\n\t\t\t\ttitle: nls.localize('restartToUpdate', \"Restart to Update (1)\")\n\t\t\t},\n\t\t\twhen: CONTEXT_UPDATE_STATE.isEqualTo(StateType.Ready)\n\t\t});\n\n\t\tCommandsRegistry.registerCommand('_update.state', () => {\n\t\t\treturn this.state;\n\t\t});\n\t}\n}\n\nexport class SwitchProductQualityContribution extends Disposable implements IWorkbenchContribution {\n\n\tconstructor(\n\t\t@IProductService private readonly productService: IProductService,\n\t\t@IBrowserWorkbenchEnvironmentService private readonly environmentService: IBrowserWorkbenchEnvironmentService\n\t) {\n\t\tsuper();\n\n\t\tthis.registerGlobalActivityActions();\n\t}\n\n\tprivate registerGlobalActivityActions(): void {\n\t\tconst quality = this.productService.quality;\n\t\tconst productQualityChangeHandler = this.environmentService.options?.productQualityChangeHandler;\n\t\tif (productQualityChangeHandler && (quality === 'stable' || quality === 'insider')) {\n\t\t\tconst newQuality = quality === 'stable' ? 'insider' : 'stable';\n\t\t\tconst commandId = `update.switchQuality.${newQuality}`;\n\t\t\tconst isSwitchingToInsiders = newQuality === 'insider';\n\t\t\tthis._register(registerAction2(class SwitchQuality extends Action2 {\n\t\t\t\tconstructor() {\n\t\t\t\t\tsuper({\n\t\t\t\t\t\tid: commandId,\n\t\t\t\t\t\ttitle: isSwitchingToInsiders ? nls.localize('switchToInsiders', \"Switch to Insiders Version...\") : nls.localize('switchToStable', \"Switch to Stable Version...\"),\n\t\t\t\t\t\tprecondition: IsWebContext,\n\t\t\t\t\t\tmenu: {\n\t\t\t\t\t\t\tid: MenuId.GlobalActivity,\n\t\t\t\t\t\t\twhen: IsWebContext,\n\t\t\t\t\t\t\tgroup: '7_update',\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tasync run(accessor: ServicesAccessor): Promise<void> {\n\t\t\t\t\tconst dialogService = accessor.get(IDialogService);\n\t\t\t\t\tconst userDataSyncEnablementService = accessor.get(IUserDataSyncEnablementService);\n\t\t\t\t\tconst userDataSyncStoreManagementService = accessor.get(IUserDataSyncStoreManagementService);\n\t\t\t\t\tconst storageService = accessor.get(IStorageService);\n\t\t\t\t\tconst userDataSyncWorkbenchService = accessor.get(IUserDataSyncWorkbenchService);\n\t\t\t\t\tconst userDataSyncService = accessor.get(IUserDataSyncService);\n\t\t\t\t\tconst notificationService = accessor.get(INotificationService);\n\n\t\t\t\t\ttry {\n\t\t\t\t\t\tconst selectSettingsSyncServiceDialogShownKey = 'switchQuality.selectSettingsSyncServiceDialogShown';\n\t\t\t\t\t\tconst userDataSyncStore = userDataSyncStoreManagementService.userDataSyncStore;\n\t\t\t\t\t\tlet userDataSyncStoreType: UserDataSyncStoreType | undefined;\n\t\t\t\t\t\tif (userDataSyncStore && isSwitchingToInsiders && userDataSyncEnablementService.isEnabled()\n\t\t\t\t\t\t\t&& !storageService.getBoolean(selectSettingsSyncServiceDialogShownKey, StorageScope.APPLICATION, false)) {\n\t\t\t\t\t\t\tuserDataSyncStoreType = await this.selectSettingsSyncService(dialogService);\n\t\t\t\t\t\t\tif (!userDataSyncStoreType) {\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tstorageService.store(selectSettingsSyncServiceDialogShownKey, true, StorageScope.APPLICATION, StorageTarget.USER);\n\t\t\t\t\t\t\tif (userDataSyncStoreType === 'stable') {\n\t\t\t\t\t\t\t\t// Update the stable service type in the current window, so that it uses stable service after switched to insiders version (after reload).\n\t\t\t\t\t\t\t\tawait userDataSyncStoreManagementService.switch(userDataSyncStoreType);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tconst res = await dialogService.confirm({\n\t\t\t\t\t\t\ttype: 'info',\n\t\t\t\t\t\t\tmessage: nls.localize('relaunchMessage', \"Changing the version requires a reload to take effect\"),\n\t\t\t\t\t\t\tdetail: newQuality === 'insider' ?\n\t\t\t\t\t\t\t\tnls.localize('relaunchDetailInsiders', \"Press the reload button to switch to the Insiders version of VS Code.\") :\n\t\t\t\t\t\t\t\tnls.localize('relaunchDetailStable', \"Press the reload button to switch to the Stable version of VS Code.\"),\n\t\t\t\t\t\t\tprimaryButton: nls.localize({ key: 'reload', comment: ['&& denotes a mnemonic'] }, \"&&Reload\")\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\tif (res.confirmed) {\n\t\t\t\t\t\t\tconst promises: Promise<unknown>[] = [];\n\n\t\t\t\t\t\t\t// If sync is happening wait until it is finished before reload\n\t\t\t\t\t\t\tif (userDataSyncService.status === SyncStatus.Syncing) {\n\t\t\t\t\t\t\t\tpromises.push(Event.toPromise(Event.filter(userDataSyncService.onDidChangeStatus, status => status !== SyncStatus.Syncing)));\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t// If user chose the sync service then synchronise the store type option in insiders service, so that other clients using insiders service are also updated.\n\t\t\t\t\t\t\tif (isSwitchingToInsiders && userDataSyncStoreType) {\n\t\t\t\t\t\t\t\tpromises.push(userDataSyncWorkbenchService.synchroniseUserDataSyncStoreType());\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tawait Promises.settled(promises);\n\n\t\t\t\t\t\t\tproductQualityChangeHandler(newQuality);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t// Reset\n\t\t\t\t\t\t\tif (userDataSyncStoreType) {\n\t\t\t\t\t\t\t\tstorageService.remove(selectSettingsSyncServiceDialogShownKey, StorageScope.APPLICATION);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t} catch (error) {\n\t\t\t\t\t\tnotificationService.error(error);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tprivate async selectSettingsSyncService(dialogService: IDialogService): Promise<UserDataSyncStoreType | undefined> {\n\t\t\t\t\tconst { result } = await dialogService.prompt<UserDataSyncStoreType>({\n\t\t\t\t\t\ttype: Severity.Info,\n\t\t\t\t\t\tmessage: nls.localize('selectSyncService.message', \"Choose the settings sync service to use after changing the version\"),\n\t\t\t\t\t\tdetail: nls.localize('selectSyncService.detail', \"The Insiders version of VS Code will synchronize your settings, keybindings, extensions, snippets and UI State using separate insiders settings sync service by default.\"),\n\t\t\t\t\t\tbuttons: [\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tlabel: nls.localize({ key: 'use insiders', comment: ['&& denotes a mnemonic'] }, \"&&Insiders\"),\n\t\t\t\t\t\t\t\trun: () => 'insiders'\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tlabel: nls.localize({ key: 'use stable', comment: ['&& denotes a mnemonic'] }, \"&&Stable (current)\"),\n\t\t\t\t\t\t\t\trun: () => 'stable'\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t],\n\t\t\t\t\t\tcancelButton: true\n\t\t\t\t\t});\n\t\t\t\t\treturn result;\n\t\t\t\t}\n\t\t\t}));\n\t\t}\n\t}\n}\n"]}