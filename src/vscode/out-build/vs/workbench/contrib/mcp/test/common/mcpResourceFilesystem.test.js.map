{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/contrib/mcp/test/common/mcpResourceFilesystem.test.ts","vs/workbench/contrib/mcp/test/common/mcpResourceFilesystem.test.ts"],"names":[],"mappings":"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","file":"mcpResourceFilesystem.test.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as assert from 'assert';\nimport { Barrier, timeout } from '../../../../../base/common/async.js';\nimport { URI } from '../../../../../base/common/uri.js';\nimport { ensureNoDisposablesAreLeakedInTestSuite } from '../../../../../base/test/common/utils.js';\nimport { TestConfigurationService } from '../../../../../platform/configuration/test/common/testConfigurationService.js';\nimport { FileChangeType, FileSystemProviderErrorCode, FileType, IFileChange, IFileService, toFileSystemProviderErrorCode } from '../../../../../platform/files/common/files.js';\nimport { ServiceCollection } from '../../../../../platform/instantiation/common/serviceCollection.js';\nimport { TestInstantiationService } from '../../../../../platform/instantiation/test/common/instantiationServiceMock.js';\nimport { ILoggerService, NullLogService } from '../../../../../platform/log/common/log.js';\nimport { IProductService } from '../../../../../platform/product/common/productService.js';\nimport { IStorageService } from '../../../../../platform/storage/common/storage.js';\nimport { ITelemetryService } from '../../../../../platform/telemetry/common/telemetry.js';\nimport { NullTelemetryService } from '../../../../../platform/telemetry/common/telemetryUtils.js';\nimport { IWorkspaceContextService } from '../../../../../platform/workspace/common/workspace.js';\nimport { IWorkbenchEnvironmentService } from '../../../../services/environment/common/environmentService.js';\nimport { TestContextService, TestLoggerService, TestProductService, TestStorageService } from '../../../../test/common/workbenchTestServices.js';\nimport { IMcpRegistry } from '../../common/mcpRegistryTypes.js';\nimport { McpResourceFilesystem } from '../../common/mcpResourceFilesystem.js';\nimport { McpService } from '../../common/mcpService.js';\nimport { IMcpService } from '../../common/mcpTypes.js';\nimport { MCP } from '../../common/modelContextProtocol.js';\nimport { TestMcpMessageTransport, TestMcpRegistry } from './mcpRegistryTypes.js';\n\n\nsuite('Workbench - MCP - ResourceFilesystem', () => {\n\n\tconst ds = ensureNoDisposablesAreLeakedInTestSuite();\n\n\tlet transport: TestMcpMessageTransport;\n\tlet fs: McpResourceFilesystem;\n\n\tsetup(() => {\n\t\tconst services = new ServiceCollection(\n\t\t\t[IFileService, { registerProvider: () => { } }],\n\t\t\t[IStorageService, ds.add(new TestStorageService())],\n\t\t\t[ILoggerService, ds.add(new TestLoggerService())],\n\t\t\t[IWorkspaceContextService, new TestContextService()],\n\t\t\t[IWorkbenchEnvironmentService, {}],\n\t\t\t[ITelemetryService, NullTelemetryService],\n\t\t\t[IProductService, TestProductService],\n\t\t);\n\n\t\tconst parentInsta1 = ds.add(new TestInstantiationService(services));\n\t\tconst registry = new TestMcpRegistry(parentInsta1);\n\n\t\tconst parentInsta2 = ds.add(parentInsta1.createChild(new ServiceCollection([IMcpRegistry, registry])));\n\t\tconst mcpService = ds.add(new McpService(parentInsta2, registry, new NullLogService(), new TestConfigurationService()));\n\t\tmcpService.updateCollectedServers();\n\n\t\tconst instaService = ds.add(parentInsta2.createChild(new ServiceCollection(\n\t\t\t[IMcpRegistry, registry],\n\t\t\t[IMcpService, mcpService],\n\t\t)));\n\n\t\tfs = ds.add(instaService.createInstance(McpResourceFilesystem));\n\n\t\ttransport = ds.add(new TestMcpMessageTransport());\n\t\tregistry.makeTestTransport = () => transport;\n\t});\n\n\ttest('reads a basic file', async () => {\n\t\ttransport.setResponder('resources/read', msg => {\n\t\t\tconst request = msg as { id: string | number; params: { uri: string } };\n\t\t\tassert.strictEqual(request.params.uri, 'custom://hello/world.txt');\n\t\t\treturn {\n\t\t\t\tid: request.id,\n\t\t\t\tjsonrpc: '2.0',\n\t\t\t\tresult: {\n\t\t\t\t\tcontents: [{ uri: request.params.uri, text: 'Hello World' }],\n\t\t\t\t} satisfies MCP.ReadResourceResult\n\t\t\t};\n\t\t});\n\n\t\tconst response = await fs.readFile(URI.parse('mcp-resource://746573742D736572766572/custom/hello/world.txt'));\n\t\tassert.strictEqual(new TextDecoder().decode(response), 'Hello World');\n\t});\n\n\ttest('stat returns file information', async () => {\n\t\ttransport.setResponder('resources/read', msg => {\n\t\t\tconst request = msg as { id: string | number; params: { uri: string } };\n\t\t\tassert.strictEqual(request.params.uri, 'custom://hello/world.txt');\n\t\t\treturn {\n\t\t\t\tid: request.id,\n\t\t\t\tjsonrpc: '2.0',\n\t\t\t\tresult: {\n\t\t\t\t\tcontents: [{ uri: request.params.uri, text: 'Hello World' }],\n\t\t\t\t} satisfies MCP.ReadResourceResult\n\t\t\t};\n\t\t});\n\n\t\tconst fileStats = await fs.stat(URI.parse('mcp-resource://746573742D736572766572/custom/hello/world.txt'));\n\t\tassert.strictEqual(fileStats.type, FileType.File);\n\t\tassert.strictEqual(fileStats.size, 'Hello World'.length);\n\t});\n\n\ttest('stat returns directory information', async () => {\n\t\ttransport.setResponder('resources/read', msg => {\n\t\t\tconst request = msg as { id: string | number; params: { uri: string } };\n\t\t\tassert.strictEqual(request.params.uri, 'custom://hello');\n\t\t\treturn {\n\t\t\t\tid: request.id,\n\t\t\t\tjsonrpc: '2.0',\n\t\t\t\tresult: {\n\t\t\t\t\tcontents: [\n\t\t\t\t\t\t{ uri: 'custom://hello/file1.txt', text: 'File 1' },\n\t\t\t\t\t\t{ uri: 'custom://hello/file2.txt', text: 'File 2' },\n\t\t\t\t\t],\n\t\t\t\t} satisfies MCP.ReadResourceResult\n\t\t\t};\n\t\t});\n\n\t\tconst dirStats = await fs.stat(URI.parse('mcp-resource://746573742D736572766572/custom/hello/'));\n\t\tassert.strictEqual(dirStats.type, FileType.Directory);\n\t\t// Size should be sum of all file contents in the directory\n\t\tassert.strictEqual(dirStats.size, 'File 1'.length + 'File 2'.length);\n\t});\n\n\ttest('stat throws FileNotFound for nonexistent resources', async () => {\n\t\ttransport.setResponder('resources/read', msg => {\n\t\t\tconst request = msg as { id: string | number };\n\t\t\treturn {\n\t\t\t\tid: request.id,\n\t\t\t\tjsonrpc: '2.0',\n\t\t\t\tresult: {\n\t\t\t\t\tcontents: [],\n\t\t\t\t} satisfies MCP.ReadResourceResult\n\t\t\t};\n\t\t});\n\n\t\tawait assert.rejects(\n\t\t\t() => fs.stat(URI.parse('mcp-resource://746573742D736572766572/custom/nonexistent.txt')),\n\t\t\t(err: Error) => toFileSystemProviderErrorCode(err) === FileSystemProviderErrorCode.FileNotFound\n\t\t);\n\t});\n\n\ttest('readdir returns directory contents', async () => {\n\t\ttransport.setResponder('resources/read', msg => {\n\t\t\tconst request = msg as { id: string | number; params: { uri: string } };\n\t\t\tassert.strictEqual(request.params.uri, 'custom://hello/dir');\n\t\t\treturn {\n\t\t\t\tid: request.id,\n\t\t\t\tjsonrpc: '2.0',\n\t\t\t\tresult: {\n\t\t\t\t\tcontents: [\n\t\t\t\t\t\t{ uri: 'custom://hello/dir/file1.txt', text: 'File 1' },\n\t\t\t\t\t\t{ uri: 'custom://hello/dir/file2.txt', text: 'File 2' },\n\t\t\t\t\t\t{ uri: 'custom://hello/dir/subdir/file3.txt', text: 'File 3' },\n\t\t\t\t\t],\n\t\t\t\t} satisfies MCP.ReadResourceResult\n\t\t\t};\n\t\t});\n\n\t\tconst dirEntries = await fs.readdir(URI.parse('mcp-resource://746573742D736572766572/custom/hello/dir/'));\n\t\tassert.deepStrictEqual(dirEntries, [\n\t\t\t['file1.txt', FileType.File],\n\t\t\t['file2.txt', FileType.File],\n\t\t\t['subdir', FileType.Directory],\n\t\t]);\n\t});\n\n\ttest('readdir throws when reading a file as directory', async () => {\n\t\ttransport.setResponder('resources/read', msg => {\n\t\t\tconst request = msg as { id: string | number; params: { uri: string } };\n\t\t\treturn {\n\t\t\t\tid: request.id,\n\t\t\t\tjsonrpc: '2.0',\n\t\t\t\tresult: {\n\t\t\t\t\tcontents: [{ uri: request.params.uri, text: 'This is a file' }],\n\t\t\t\t} satisfies MCP.ReadResourceResult\n\t\t\t};\n\t\t});\n\n\t\tawait assert.rejects(\n\t\t\t() => fs.readdir(URI.parse('mcp-resource://746573742D736572766572/custom/hello/file.txt')),\n\t\t\t(err: Error) => toFileSystemProviderErrorCode(err) === FileSystemProviderErrorCode.FileNotADirectory\n\t\t);\n\t});\n\n\ttest('watch file emits change events', async () => {\n\t\t// Set up the responder for resource reading\n\t\ttransport.setResponder('resources/read', msg => {\n\t\t\tconst request = msg as { id: string | number; params: { uri: string } };\n\t\t\treturn {\n\t\t\t\tid: request.id,\n\t\t\t\tjsonrpc: '2.0',\n\t\t\t\tresult: {\n\t\t\t\t\tcontents: [{ uri: request.params.uri, text: 'File content' }],\n\t\t\t\t} satisfies MCP.ReadResourceResult\n\t\t\t};\n\t\t});\n\n\t\tconst didSubscribe = new Barrier();\n\n\t\t// Set up the responder for resource subscription\n\t\ttransport.setResponder('resources/subscribe', msg => {\n\t\t\tconst request = msg as { id: string | number };\n\t\t\tdidSubscribe.open();\n\t\t\treturn {\n\t\t\t\tid: request.id,\n\t\t\t\tjsonrpc: '2.0',\n\t\t\t\tresult: {},\n\t\t\t};\n\t\t});\n\n\t\tconst uri = URI.parse('mcp-resource://746573742D736572766572/custom/hello/file.txt');\n\t\tconst fileChanges: IFileChange[] = [];\n\n\t\t// Create a listener for file change events\n\t\tconst disposable = fs.onDidChangeFile(events => {\n\t\t\tfileChanges.push(...events);\n\t\t});\n\n\t\t// Start watching the file\n\t\tconst watchDisposable = fs.watch(uri, { excludes: [], recursive: false });\n\n\t\t// Simulate a file update notification from the server\n\t\tawait didSubscribe.wait();\n\t\tawait timeout(10); // wait for listeners to attach\n\n\t\ttransport.simulateReceiveMessage({\n\t\t\tjsonrpc: '2.0',\n\t\t\tmethod: 'notifications/resources/updated',\n\t\t\tparams: {\n\t\t\t\turi: 'custom://hello/file.txt',\n\t\t\t},\n\t\t});\n\t\ttransport.simulateReceiveMessage({\n\t\t\tjsonrpc: '2.0',\n\t\t\tmethod: 'notifications/resources/updated',\n\t\t\tparams: {\n\t\t\t\turi: 'custom://hello/unrelated.txt',\n\t\t\t},\n\t\t});\n\n\t\t// Check that we received a file change event\n\t\tassert.strictEqual(fileChanges.length, 1);\n\t\tassert.strictEqual(fileChanges[0].type, FileChangeType.UPDATED);\n\t\tassert.strictEqual(fileChanges[0].resource.toString(), uri.toString());\n\n\t\t// Clean up\n\t\tdisposable.dispose();\n\t\twatchDisposable.dispose();\n\t});\n\n\ttest('read blob resource', async () => {\n\t\tconst blobBase64 = 'SGVsbG8gV29ybGQgYXMgQmxvYg=='; // \"Hello World as Blob\" in base64\n\n\t\ttransport.setResponder('resources/read', msg => {\n\t\t\tconst params = (msg as { id: string | number; params: { uri: string } });\n\t\t\tassert.strictEqual(params.params.uri, 'custom://hello/blob.bin');\n\t\t\treturn {\n\t\t\t\tid: params.id,\n\t\t\t\tjsonrpc: '2.0',\n\t\t\t\tresult: {\n\t\t\t\t\tcontents: [{ uri: params.params.uri, blob: blobBase64 }],\n\t\t\t\t} satisfies MCP.ReadResourceResult\n\t\t\t};\n\t\t});\n\n\t\tconst response = await fs.readFile(URI.parse('mcp-resource://746573742D736572766572/custom/hello/blob.bin'));\n\t\tassert.strictEqual(new TextDecoder().decode(response), 'Hello World as Blob');\n\t});\n\n\ttest('throws error for write operations', async () => {\n\t\tconst uri = URI.parse('mcp-resource://746573742D736572766572/custom/hello/file.txt');\n\n\t\tawait assert.rejects(\n\t\t\tasync () => fs.writeFile(uri, new Uint8Array(), { create: true, overwrite: true, atomic: false, unlock: false }),\n\t\t\t(err: Error) => toFileSystemProviderErrorCode(err) === FileSystemProviderErrorCode.NoPermissions\n\t\t);\n\n\t\tawait assert.rejects(\n\t\t\tasync () => fs.delete(uri, { recursive: false, useTrash: false, atomic: false }),\n\t\t\t(err: Error) => toFileSystemProviderErrorCode(err) === FileSystemProviderErrorCode.NoPermissions\n\t\t);\n\n\t\tawait assert.rejects(\n\t\t\tasync () => fs.mkdir(uri),\n\t\t\t(err: Error) => toFileSystemProviderErrorCode(err) === FileSystemProviderErrorCode.NoPermissions\n\t\t);\n\n\t\tawait assert.rejects(\n\t\t\tasync () => fs.rename(uri, URI.parse('mcp-resource://746573742D736572766572/custom/hello/newfile.txt'), { overwrite: false }),\n\t\t\t(err: Error) => toFileSystemProviderErrorCode(err) === FileSystemProviderErrorCode.NoPermissions\n\t\t);\n\t});\n});\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as assert from 'assert';\nimport { Barrier, timeout } from '../../../../../base/common/async.js';\nimport { URI } from '../../../../../base/common/uri.js';\nimport { ensureNoDisposablesAreLeakedInTestSuite } from '../../../../../base/test/common/utils.js';\nimport { TestConfigurationService } from '../../../../../platform/configuration/test/common/testConfigurationService.js';\nimport { FileChangeType, FileSystemProviderErrorCode, FileType, IFileChange, IFileService, toFileSystemProviderErrorCode } from '../../../../../platform/files/common/files.js';\nimport { ServiceCollection } from '../../../../../platform/instantiation/common/serviceCollection.js';\nimport { TestInstantiationService } from '../../../../../platform/instantiation/test/common/instantiationServiceMock.js';\nimport { ILoggerService, NullLogService } from '../../../../../platform/log/common/log.js';\nimport { IProductService } from '../../../../../platform/product/common/productService.js';\nimport { IStorageService } from '../../../../../platform/storage/common/storage.js';\nimport { ITelemetryService } from '../../../../../platform/telemetry/common/telemetry.js';\nimport { NullTelemetryService } from '../../../../../platform/telemetry/common/telemetryUtils.js';\nimport { IWorkspaceContextService } from '../../../../../platform/workspace/common/workspace.js';\nimport { IWorkbenchEnvironmentService } from '../../../../services/environment/common/environmentService.js';\nimport { TestContextService, TestLoggerService, TestProductService, TestStorageService } from '../../../../test/common/workbenchTestServices.js';\nimport { IMcpRegistry } from '../../common/mcpRegistryTypes.js';\nimport { McpResourceFilesystem } from '../../common/mcpResourceFilesystem.js';\nimport { McpService } from '../../common/mcpService.js';\nimport { IMcpService } from '../../common/mcpTypes.js';\nimport { MCP } from '../../common/modelContextProtocol.js';\nimport { TestMcpMessageTransport, TestMcpRegistry } from './mcpRegistryTypes.js';\n\n\nsuite('Workbench - MCP - ResourceFilesystem', () => {\n\n\tconst ds = ensureNoDisposablesAreLeakedInTestSuite();\n\n\tlet transport: TestMcpMessageTransport;\n\tlet fs: McpResourceFilesystem;\n\n\tsetup(() => {\n\t\tconst services = new ServiceCollection(\n\t\t\t[IFileService, { registerProvider: () => { } }],\n\t\t\t[IStorageService, ds.add(new TestStorageService())],\n\t\t\t[ILoggerService, ds.add(new TestLoggerService())],\n\t\t\t[IWorkspaceContextService, new TestContextService()],\n\t\t\t[IWorkbenchEnvironmentService, {}],\n\t\t\t[ITelemetryService, NullTelemetryService],\n\t\t\t[IProductService, TestProductService],\n\t\t);\n\n\t\tconst parentInsta1 = ds.add(new TestInstantiationService(services));\n\t\tconst registry = new TestMcpRegistry(parentInsta1);\n\n\t\tconst parentInsta2 = ds.add(parentInsta1.createChild(new ServiceCollection([IMcpRegistry, registry])));\n\t\tconst mcpService = ds.add(new McpService(parentInsta2, registry, new NullLogService(), new TestConfigurationService()));\n\t\tmcpService.updateCollectedServers();\n\n\t\tconst instaService = ds.add(parentInsta2.createChild(new ServiceCollection(\n\t\t\t[IMcpRegistry, registry],\n\t\t\t[IMcpService, mcpService],\n\t\t)));\n\n\t\tfs = ds.add(instaService.createInstance(McpResourceFilesystem));\n\n\t\ttransport = ds.add(new TestMcpMessageTransport());\n\t\tregistry.makeTestTransport = () => transport;\n\t});\n\n\ttest('reads a basic file', async () => {\n\t\ttransport.setResponder('resources/read', msg => {\n\t\t\tconst request = msg as { id: string | number; params: { uri: string } };\n\t\t\tassert.strictEqual(request.params.uri, 'custom://hello/world.txt');\n\t\t\treturn {\n\t\t\t\tid: request.id,\n\t\t\t\tjsonrpc: '2.0',\n\t\t\t\tresult: {\n\t\t\t\t\tcontents: [{ uri: request.params.uri, text: 'Hello World' }],\n\t\t\t\t} satisfies MCP.ReadResourceResult\n\t\t\t};\n\t\t});\n\n\t\tconst response = await fs.readFile(URI.parse('mcp-resource://746573742D736572766572/custom/hello/world.txt'));\n\t\tassert.strictEqual(new TextDecoder().decode(response), 'Hello World');\n\t});\n\n\ttest('stat returns file information', async () => {\n\t\ttransport.setResponder('resources/read', msg => {\n\t\t\tconst request = msg as { id: string | number; params: { uri: string } };\n\t\t\tassert.strictEqual(request.params.uri, 'custom://hello/world.txt');\n\t\t\treturn {\n\t\t\t\tid: request.id,\n\t\t\t\tjsonrpc: '2.0',\n\t\t\t\tresult: {\n\t\t\t\t\tcontents: [{ uri: request.params.uri, text: 'Hello World' }],\n\t\t\t\t} satisfies MCP.ReadResourceResult\n\t\t\t};\n\t\t});\n\n\t\tconst fileStats = await fs.stat(URI.parse('mcp-resource://746573742D736572766572/custom/hello/world.txt'));\n\t\tassert.strictEqual(fileStats.type, FileType.File);\n\t\tassert.strictEqual(fileStats.size, 'Hello World'.length);\n\t});\n\n\ttest('stat returns directory information', async () => {\n\t\ttransport.setResponder('resources/read', msg => {\n\t\t\tconst request = msg as { id: string | number; params: { uri: string } };\n\t\t\tassert.strictEqual(request.params.uri, 'custom://hello');\n\t\t\treturn {\n\t\t\t\tid: request.id,\n\t\t\t\tjsonrpc: '2.0',\n\t\t\t\tresult: {\n\t\t\t\t\tcontents: [\n\t\t\t\t\t\t{ uri: 'custom://hello/file1.txt', text: 'File 1' },\n\t\t\t\t\t\t{ uri: 'custom://hello/file2.txt', text: 'File 2' },\n\t\t\t\t\t],\n\t\t\t\t} satisfies MCP.ReadResourceResult\n\t\t\t};\n\t\t});\n\n\t\tconst dirStats = await fs.stat(URI.parse('mcp-resource://746573742D736572766572/custom/hello/'));\n\t\tassert.strictEqual(dirStats.type, FileType.Directory);\n\t\t// Size should be sum of all file contents in the directory\n\t\tassert.strictEqual(dirStats.size, 'File 1'.length + 'File 2'.length);\n\t});\n\n\ttest('stat throws FileNotFound for nonexistent resources', async () => {\n\t\ttransport.setResponder('resources/read', msg => {\n\t\t\tconst request = msg as { id: string | number };\n\t\t\treturn {\n\t\t\t\tid: request.id,\n\t\t\t\tjsonrpc: '2.0',\n\t\t\t\tresult: {\n\t\t\t\t\tcontents: [],\n\t\t\t\t} satisfies MCP.ReadResourceResult\n\t\t\t};\n\t\t});\n\n\t\tawait assert.rejects(\n\t\t\t() => fs.stat(URI.parse('mcp-resource://746573742D736572766572/custom/nonexistent.txt')),\n\t\t\t(err: Error) => toFileSystemProviderErrorCode(err) === FileSystemProviderErrorCode.FileNotFound\n\t\t);\n\t});\n\n\ttest('readdir returns directory contents', async () => {\n\t\ttransport.setResponder('resources/read', msg => {\n\t\t\tconst request = msg as { id: string | number; params: { uri: string } };\n\t\t\tassert.strictEqual(request.params.uri, 'custom://hello/dir');\n\t\t\treturn {\n\t\t\t\tid: request.id,\n\t\t\t\tjsonrpc: '2.0',\n\t\t\t\tresult: {\n\t\t\t\t\tcontents: [\n\t\t\t\t\t\t{ uri: 'custom://hello/dir/file1.txt', text: 'File 1' },\n\t\t\t\t\t\t{ uri: 'custom://hello/dir/file2.txt', text: 'File 2' },\n\t\t\t\t\t\t{ uri: 'custom://hello/dir/subdir/file3.txt', text: 'File 3' },\n\t\t\t\t\t],\n\t\t\t\t} satisfies MCP.ReadResourceResult\n\t\t\t};\n\t\t});\n\n\t\tconst dirEntries = await fs.readdir(URI.parse('mcp-resource://746573742D736572766572/custom/hello/dir/'));\n\t\tassert.deepStrictEqual(dirEntries, [\n\t\t\t['file1.txt', FileType.File],\n\t\t\t['file2.txt', FileType.File],\n\t\t\t['subdir', FileType.Directory],\n\t\t]);\n\t});\n\n\ttest('readdir throws when reading a file as directory', async () => {\n\t\ttransport.setResponder('resources/read', msg => {\n\t\t\tconst request = msg as { id: string | number; params: { uri: string } };\n\t\t\treturn {\n\t\t\t\tid: request.id,\n\t\t\t\tjsonrpc: '2.0',\n\t\t\t\tresult: {\n\t\t\t\t\tcontents: [{ uri: request.params.uri, text: 'This is a file' }],\n\t\t\t\t} satisfies MCP.ReadResourceResult\n\t\t\t};\n\t\t});\n\n\t\tawait assert.rejects(\n\t\t\t() => fs.readdir(URI.parse('mcp-resource://746573742D736572766572/custom/hello/file.txt')),\n\t\t\t(err: Error) => toFileSystemProviderErrorCode(err) === FileSystemProviderErrorCode.FileNotADirectory\n\t\t);\n\t});\n\n\ttest('watch file emits change events', async () => {\n\t\t// Set up the responder for resource reading\n\t\ttransport.setResponder('resources/read', msg => {\n\t\t\tconst request = msg as { id: string | number; params: { uri: string } };\n\t\t\treturn {\n\t\t\t\tid: request.id,\n\t\t\t\tjsonrpc: '2.0',\n\t\t\t\tresult: {\n\t\t\t\t\tcontents: [{ uri: request.params.uri, text: 'File content' }],\n\t\t\t\t} satisfies MCP.ReadResourceResult\n\t\t\t};\n\t\t});\n\n\t\tconst didSubscribe = new Barrier();\n\n\t\t// Set up the responder for resource subscription\n\t\ttransport.setResponder('resources/subscribe', msg => {\n\t\t\tconst request = msg as { id: string | number };\n\t\t\tdidSubscribe.open();\n\t\t\treturn {\n\t\t\t\tid: request.id,\n\t\t\t\tjsonrpc: '2.0',\n\t\t\t\tresult: {},\n\t\t\t};\n\t\t});\n\n\t\tconst uri = URI.parse('mcp-resource://746573742D736572766572/custom/hello/file.txt');\n\t\tconst fileChanges: IFileChange[] = [];\n\n\t\t// Create a listener for file change events\n\t\tconst disposable = fs.onDidChangeFile(events => {\n\t\t\tfileChanges.push(...events);\n\t\t});\n\n\t\t// Start watching the file\n\t\tconst watchDisposable = fs.watch(uri, { excludes: [], recursive: false });\n\n\t\t// Simulate a file update notification from the server\n\t\tawait didSubscribe.wait();\n\t\tawait timeout(10); // wait for listeners to attach\n\n\t\ttransport.simulateReceiveMessage({\n\t\t\tjsonrpc: '2.0',\n\t\t\tmethod: 'notifications/resources/updated',\n\t\t\tparams: {\n\t\t\t\turi: 'custom://hello/file.txt',\n\t\t\t},\n\t\t});\n\t\ttransport.simulateReceiveMessage({\n\t\t\tjsonrpc: '2.0',\n\t\t\tmethod: 'notifications/resources/updated',\n\t\t\tparams: {\n\t\t\t\turi: 'custom://hello/unrelated.txt',\n\t\t\t},\n\t\t});\n\n\t\t// Check that we received a file change event\n\t\tassert.strictEqual(fileChanges.length, 1);\n\t\tassert.strictEqual(fileChanges[0].type, FileChangeType.UPDATED);\n\t\tassert.strictEqual(fileChanges[0].resource.toString(), uri.toString());\n\n\t\t// Clean up\n\t\tdisposable.dispose();\n\t\twatchDisposable.dispose();\n\t});\n\n\ttest('read blob resource', async () => {\n\t\tconst blobBase64 = 'SGVsbG8gV29ybGQgYXMgQmxvYg=='; // \"Hello World as Blob\" in base64\n\n\t\ttransport.setResponder('resources/read', msg => {\n\t\t\tconst params = (msg as { id: string | number; params: { uri: string } });\n\t\t\tassert.strictEqual(params.params.uri, 'custom://hello/blob.bin');\n\t\t\treturn {\n\t\t\t\tid: params.id,\n\t\t\t\tjsonrpc: '2.0',\n\t\t\t\tresult: {\n\t\t\t\t\tcontents: [{ uri: params.params.uri, blob: blobBase64 }],\n\t\t\t\t} satisfies MCP.ReadResourceResult\n\t\t\t};\n\t\t});\n\n\t\tconst response = await fs.readFile(URI.parse('mcp-resource://746573742D736572766572/custom/hello/blob.bin'));\n\t\tassert.strictEqual(new TextDecoder().decode(response), 'Hello World as Blob');\n\t});\n\n\ttest('throws error for write operations', async () => {\n\t\tconst uri = URI.parse('mcp-resource://746573742D736572766572/custom/hello/file.txt');\n\n\t\tawait assert.rejects(\n\t\t\tasync () => fs.writeFile(uri, new Uint8Array(), { create: true, overwrite: true, atomic: false, unlock: false }),\n\t\t\t(err: Error) => toFileSystemProviderErrorCode(err) === FileSystemProviderErrorCode.NoPermissions\n\t\t);\n\n\t\tawait assert.rejects(\n\t\t\tasync () => fs.delete(uri, { recursive: false, useTrash: false, atomic: false }),\n\t\t\t(err: Error) => toFileSystemProviderErrorCode(err) === FileSystemProviderErrorCode.NoPermissions\n\t\t);\n\n\t\tawait assert.rejects(\n\t\t\tasync () => fs.mkdir(uri),\n\t\t\t(err: Error) => toFileSystemProviderErrorCode(err) === FileSystemProviderErrorCode.NoPermissions\n\t\t);\n\n\t\tawait assert.rejects(\n\t\t\tasync () => fs.rename(uri, URI.parse('mcp-resource://746573742D736572766572/custom/hello/newfile.txt'), { overwrite: false }),\n\t\t\t(err: Error) => toFileSystemProviderErrorCode(err) === FileSystemProviderErrorCode.NoPermissions\n\t\t);\n\t});\n});\n"]}