{"version":3,"sources":["vs/workbench/contrib/mcp/common/discovery/extensionMcpDiscovery.ts"],"names":[],"mappings":"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","file":"extensionMcpDiscovery.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Disposable, DisposableMap } from '../../../../../base/common/lifecycle.js';\nimport { observableValue } from '../../../../../base/common/observable.js';\nimport { isFalsyOrWhitespace } from '../../../../../base/common/strings.js';\nimport { localize } from '../../../../../nls.js';\nimport { ConfigurationTarget } from '../../../../../platform/configuration/common/configuration.js';\nimport { ContextKeyExpr, IContextKeyService } from '../../../../../platform/contextkey/common/contextkey.js';\nimport { IMcpCollectionContribution } from '../../../../../platform/extensions/common/extensions.js';\nimport { IStorageService, StorageScope, StorageTarget } from '../../../../../platform/storage/common/storage.js';\nimport { IExtensionService } from '../../../../services/extensions/common/extensions.js';\nimport * as extensionsRegistry from '../../../../services/extensions/common/extensionsRegistry.js';\nimport { mcpActivationEvent, mcpContributionPoint } from '../mcpConfiguration.js';\nimport { IMcpRegistry } from '../mcpRegistryTypes.js';\nimport { extensionPrefixedIdentifier, McpServerDefinition, McpServerTrust } from '../mcpTypes.js';\nimport { IMcpDiscovery } from './mcpDiscovery.js';\n\nconst cacheKey = 'mcp.extCachedServers';\n\ninterface IServerCacheEntry {\n\treadonly servers: readonly McpServerDefinition.Serialized[];\n}\n\nconst _mcpExtensionPoint = extensionsRegistry.ExtensionsRegistry.registerExtensionPoint(mcpContributionPoint);\n\nconst enum PersistWhen {\n\tCollectionExists,\n\tAlways,\n}\n\nexport class ExtensionMcpDiscovery extends Disposable implements IMcpDiscovery {\n\n\treadonly fromGallery = false;\n\n\tprivate readonly _extensionCollectionIdsToPersist = new Map<string, PersistWhen>();\n\tprivate readonly cachedServers: { [collcetionId: string]: IServerCacheEntry };\n\tprivate readonly _conditionalCollections = this._register(new DisposableMap<string>());\n\n\tconstructor(\n\t\t@IMcpRegistry private readonly _mcpRegistry: IMcpRegistry,\n\t\t@IStorageService storageService: IStorageService,\n\t\t@IExtensionService private readonly _extensionService: IExtensionService,\n\t\t@IContextKeyService private readonly _contextKeyService: IContextKeyService,\n\t) {\n\t\tsuper();\n\t\tthis.cachedServers = storageService.getObject(cacheKey, StorageScope.WORKSPACE, {});\n\n\t\tthis._register(storageService.onWillSaveState(() => {\n\t\t\tlet updated = false;\n\t\t\tfor (const [collectionId, behavior] of this._extensionCollectionIdsToPersist.entries()) {\n\t\t\t\tconst collection = this._mcpRegistry.collections.get().find(c => c.id === collectionId);\n\t\t\t\tlet defs = collection?.serverDefinitions.get();\n\t\t\t\tif (!collection || collection.lazy) {\n\t\t\t\t\tif (behavior === PersistWhen.Always) {\n\t\t\t\t\t\tdefs = [];\n\t\t\t\t\t} else {\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (defs) {\n\t\t\t\t\tupdated = true;\n\t\t\t\t\tthis.cachedServers[collectionId] = { servers: defs.map(McpServerDefinition.toSerialized) };\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (updated) {\n\t\t\t\tstorageService.store(cacheKey, this.cachedServers, StorageScope.WORKSPACE, StorageTarget.MACHINE);\n\t\t\t}\n\t\t}));\n\t}\n\n\tpublic start(): void {\n\t\tconst extensionCollections = this._register(new DisposableMap<string>());\n\t\tthis._register(_mcpExtensionPoint.setHandler((_extensions, delta) => {\n\t\t\tconst { added, removed } = delta;\n\n\t\t\tfor (const collections of removed) {\n\t\t\t\tfor (const coll of collections.value) {\n\t\t\t\t\tconst id = extensionPrefixedIdentifier(collections.description.identifier, coll.id);\n\t\t\t\t\textensionCollections.deleteAndDispose(id);\n\t\t\t\t\tthis._conditionalCollections.deleteAndDispose(id);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfor (const collections of added) {\n\n\t\t\t\tif (!ExtensionMcpDiscovery._validate(collections)) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tfor (const coll of collections.value) {\n\t\t\t\t\tconst id = extensionPrefixedIdentifier(collections.description.identifier, coll.id);\n\t\t\t\t\tthis._extensionCollectionIdsToPersist.set(id, PersistWhen.CollectionExists);\n\n\t\t\t\t\t// Handle conditional collections with 'when' clause\n\t\t\t\t\tif (coll.when) {\n\t\t\t\t\t\tthis._registerConditionalCollection(id, coll, collections, extensionCollections);\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// Register collection immediately if no 'when' clause\n\t\t\t\t\t\tthis._registerCollection(id, coll, collections, extensionCollections);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}));\n\t}\n\n\tprivate _registerCollection(\n\t\tid: string,\n\t\tcoll: IMcpCollectionContribution,\n\t\tcollections: extensionsRegistry.IExtensionPointUser<IMcpCollectionContribution[]>,\n\t\textensionCollections: DisposableMap<string>\n\t) {\n\t\tconst serverDefs = this.cachedServers.hasOwnProperty(id) ? this.cachedServers[id].servers : undefined;\n\t\tconst dispo = this._mcpRegistry.registerCollection({\n\t\t\tid,\n\t\t\tlabel: coll.label,\n\t\t\tremoteAuthority: null,\n\t\t\ttrustBehavior: McpServerTrust.Kind.Trusted,\n\t\t\tscope: StorageScope.WORKSPACE,\n\t\t\tconfigTarget: ConfigurationTarget.USER,\n\t\t\tserverDefinitions: observableValue<McpServerDefinition[]>(this, serverDefs?.map(McpServerDefinition.fromSerialized) || []),\n\t\t\tlazy: {\n\t\t\t\tisCached: !!serverDefs,\n\t\t\t\tload: () => this._activateExtensionServers(coll.id).then(() => {\n\t\t\t\t\t// persist (an empty collection) in case the extension doesn't end up publishing one\n\t\t\t\t\tthis._extensionCollectionIdsToPersist.set(id, PersistWhen.Always);\n\t\t\t\t}),\n\t\t\t\tremoved: () => {\n\t\t\t\t\textensionCollections.deleteAndDispose(id);\n\t\t\t\t\tthis._conditionalCollections.deleteAndDispose(id);\n\t\t\t\t},\n\t\t\t},\n\t\t\tsource: collections.description.identifier\n\t\t});\n\n\t\textensionCollections.set(id, dispo);\n\t}\n\n\tprivate _registerConditionalCollection(\n\t\tid: string,\n\t\tcoll: IMcpCollectionContribution,\n\t\tcollections: extensionsRegistry.IExtensionPointUser<IMcpCollectionContribution[]>,\n\t\textensionCollections: DisposableMap<string>\n\t) {\n\t\tconst whenClause = ContextKeyExpr.deserialize(coll.when!);\n\t\tif (!whenClause) {\n\t\t\t// Invalid when clause, treat as always false\n\t\t\treturn;\n\t\t}\n\n\t\tconst evaluate = () => {\n\t\t\tconst nowSatisfied = this._contextKeyService.contextMatchesRules(whenClause);\n\t\t\tconst isRegistered = extensionCollections.has(id);\n\t\t\tif (nowSatisfied && !isRegistered) {\n\t\t\t\tthis._registerCollection(id, coll, collections, extensionCollections);\n\t\t\t} else if (!nowSatisfied && isRegistered) {\n\t\t\t\textensionCollections.deleteAndDispose(id);\n\t\t\t}\n\t\t};\n\n\t\tconst contextKeyListener = this._contextKeyService.onDidChangeContext(evaluate);\n\t\tevaluate();\n\n\t\t// Store disposable for this conditional collection\n\t\tthis._conditionalCollections.set(id, contextKeyListener);\n\t}\n\n\tprivate async _activateExtensionServers(collectionId: string): Promise<void> {\n\t\tawait this._extensionService.activateByEvent(mcpActivationEvent(collectionId));\n\t\tawait Promise.all(this._mcpRegistry.delegates.get()\n\t\t\t.map(r => r.waitForInitialProviderPromises()));\n\t}\n\n\tprivate static _validate(user: extensionsRegistry.IExtensionPointUser<IMcpCollectionContribution[]>): boolean {\n\n\t\tif (!Array.isArray(user.value)) {\n\t\t\tuser.collector.error(localize('invalidData', \"Expected an array of MCP collections\"));\n\t\t\treturn false;\n\t\t}\n\n\t\tfor (const contribution of user.value) {\n\t\t\tif (typeof contribution.id !== 'string' || isFalsyOrWhitespace(contribution.id)) {\n\t\t\t\tuser.collector.error(localize('invalidId', \"Expected 'id' to be a non-empty string.\"));\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tif (typeof contribution.label !== 'string' || isFalsyOrWhitespace(contribution.label)) {\n\t\t\t\tuser.collector.error(localize('invalidLabel', \"Expected 'label' to be a non-empty string.\"));\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tif (contribution.when !== undefined && (typeof contribution.when !== 'string' || isFalsyOrWhitespace(contribution.when))) {\n\t\t\t\tuser.collector.error(localize('invalidWhen', \"Expected 'when' to be a non-empty string.\"));\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\n\t\treturn true;\n\t}\n}\n"]}