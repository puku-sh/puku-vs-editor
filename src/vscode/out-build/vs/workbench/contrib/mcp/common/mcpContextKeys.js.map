{"version":3,"sources":["vs/workbench/contrib/mcp/common/mcpContextKeys.ts"],"names":[],"mappings":"AAAA;;;gGAGgG;;;;;;;;;;AAGhG,OAAO,EAAE,UAAU,EAAE,MAAM,sCAAsC,CAAC;AAClE,OAAO,EAAE,OAAO,EAAE,MAAM,uCAAuC,CAAC;AAChE,OAAO,EAAE,QAAQ,EAAE,MAAM,oBAAoB,CAAC;AAC9C,OAAO,EAAE,kBAAkB,EAAE,aAAa,EAAE,MAAM,sDAAsD,CAAC;AACzG,OAAO,EAAE,cAAc,EAAE,MAAM,mEAAmE,CAAC;AAEnG,OAAO,EAAE,WAAW,EAAgE,MAAM,eAAe,CAAC;AAG1G,MAAM,KAAW,cAAc,CAa9B;AAbD,WAAiB,cAAc;IAEjB,0BAAW,GAAG,IAAI,aAAa,CAAS,iBAAiB,EAAE,SAAS,EAAE,EAAE,IAAI,EAAE,QAAQ,EAAE,WAAW,EAAE,QAAQ,CAAC,IAA6B,EAAE,IAA2D,CAAC,EAAE,CAAC,CAAC;IAC7M,8BAAe,GAAG,IAAI,aAAa,CAAU,qBAAqB,EAAE,SAAS,EAAE,EAAE,IAAI,EAAE,SAAS,EAAE,WAAW,EAAE,QAAQ,CAAC,IAAiC,EAAE,IAA6D,CAAC,EAAE,CAAC,CAAC;IAC1O;;;;;;OAMG;IACU,mCAAoB,GAAG,IAAI,aAAa,CAAU,0BAA0B,EAAE,SAAS,EAAE,EAAE,IAAI,EAAE,SAAS,EAAE,WAAW,EAAE,QAAQ,CAAC,IAAsC,EAAE,IAA0D,CAAC,EAAE,CAAC,CAAC;IACzO,yBAAU,GAAG,IAAI,aAAa,CAAS,gBAAgB,EAAE,SAAS,EAAE,EAAE,IAAI,EAAE,QAAQ,EAAE,WAAW,EAAE,QAAQ,CAAC,IAA4B,EAAE,IAAyD,CAAC,EAAE,CAAC,CAAC;AACtN,CAAC,EAbgB,cAAc,KAAd,cAAc,QAa9B;AAGM,IAAM,wBAAwB,GAA9B,MAAM,wBAAyB,SAAQ,UAAU;aAEvC,OAAE,GAAG,kCAAH,AAAqC,CAAC;IAExD,YACc,UAAuB,EAChB,iBAAqC;QAEzD,KAAK,EAAE,CAAC;QAER,MAAM,cAAc,GAAG,cAAc,CAAC,WAAW,CAAC,MAAM,CAAC,iBAAiB,CAAC,CAAC;QAC5E,MAAM,aAAa,GAAG,cAAc,CAAC,UAAU,CAAC,MAAM,CAAC,iBAAiB,CAAC,CAAC;QAC1E,MAAM,kBAAkB,GAAG,cAAc,CAAC,eAAe,CAAC,MAAM,CAAC,iBAAiB,CAAC,CAAC;QAEpF,IAAI,CAAC,MAAM,CAAC,GAAG,CAAC,cAAc,CAAC,cAAc,CAAC,oBAAoB,EAAE,iBAAiB,EAAE,CAAC,CAAC,EAAE,CAAC,UAAU,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,eAAe,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,KAAK,0CAAkC,CAAC,CAAC,CAAC,CAAC;QAEtM,IAAI,CAAC,MAAM,CAAC,GAAG,CAAC,OAAO,CAAC,CAAC,CAAC,EAAE;YAC3B,MAAM,OAAO,GAAG,UAAU,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;YAC3C,MAAM,WAAW,GAAG,OAAO,CAAC,GAAG,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC;YACtD,cAAc,CAAC,GAAG,CAAC,OAAO,CAAC,MAAM,CAAC,CAAC;YACnC,aAAa,CAAC,GAAG,CAAC,WAAW,CAAC,MAAM,CAAC,CAAC,KAAK,EAAE,KAAK,EAAE,EAAE,CAAC,KAAK,GAAG,KAAK,CAAC,MAAM,EAAE,CAAC,CAAC,CAAC,CAAC;YACjF,kBAAkB,CAAC,GAAG,CAAC,UAAU,CAAC,mBAAmB,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,KAAK,yCAAiC,IAAI,OAAO,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE;gBACxH,MAAM,SAAS,GAAG,CAAC,CAAC,UAAU,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;gBACvC,OAAO,SAAS,wCAAgC,IAAI,SAAS,yCAAiC,IAAI,SAAS,sDAA8C,CAAC;YAC3J,CAAC,CAAC,CAAC,CAAC;QACL,CAAC,CAAC,CAAC,CAAC;IACL,CAAC;;AA1BW,wBAAwB;IAKlC,WAAA,WAAW,CAAA;IACX,WAAA,kBAAkB,CAAA;GANR,wBAAwB,CA2BpC","file":"mcpContextKeys.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\n\nimport { Disposable } from '../../../../base/common/lifecycle.js';\nimport { autorun } from '../../../../base/common/observable.js';\nimport { localize } from '../../../../nls.js';\nimport { IContextKeyService, RawContextKey } from '../../../../platform/contextkey/common/contextkey.js';\nimport { bindContextKey } from '../../../../platform/observable/common/platformObservableUtils.js';\nimport { IWorkbenchContribution } from '../../../common/contributions.js';\nimport { IMcpService, LazyCollectionState, McpConnectionState, McpServerCacheState } from './mcpTypes.js';\n\n\nexport namespace McpContextKeys {\n\n\texport const serverCount = new RawContextKey<number>('mcp.serverCount', undefined, { type: 'number', description: localize('mcp.serverCount.description', \"Context key that has the number of registered MCP servers\") });\n\texport const hasUnknownTools = new RawContextKey<boolean>('mcp.hasUnknownTools', undefined, { type: 'boolean', description: localize('mcp.hasUnknownTools.description', \"Indicates whether there are MCP servers with unknown tools.\") });\n\t/**\n\t * A context key that indicates whether there are any servers with errors.\n\t *\n\t * @type {boolean}\n\t * @default undefined\n\t * @description This key is used to track the presence of servers with errors in the MCP context.\n\t */\n\texport const hasServersWithErrors = new RawContextKey<boolean>('mcp.hasServersWithErrors', undefined, { type: 'boolean', description: localize('mcp.hasServersWithErrors.description', \"Indicates whether there are any MCP servers with errors.\") });\n\texport const toolsCount = new RawContextKey<number>('mcp.toolsCount', undefined, { type: 'number', description: localize('mcp.toolsCount.description', \"Context key that has the number of registered MCP tools\") });\n}\n\n\nexport class McpContextKeysController extends Disposable implements IWorkbenchContribution {\n\n\tstatic readonly ID = 'workbench.contrib.mcp.contextKey';\n\n\tconstructor(\n\t\t@IMcpService mcpService: IMcpService,\n\t\t@IContextKeyService contextKeyService: IContextKeyService,\n\t) {\n\t\tsuper();\n\n\t\tconst ctxServerCount = McpContextKeys.serverCount.bindTo(contextKeyService);\n\t\tconst ctxToolsCount = McpContextKeys.toolsCount.bindTo(contextKeyService);\n\t\tconst ctxHasUnknownTools = McpContextKeys.hasUnknownTools.bindTo(contextKeyService);\n\n\t\tthis._store.add(bindContextKey(McpContextKeys.hasServersWithErrors, contextKeyService, r => mcpService.servers.read(r).some(c => c.connectionState.read(r).state === McpConnectionState.Kind.Error)));\n\n\t\tthis._store.add(autorun(r => {\n\t\t\tconst servers = mcpService.servers.read(r);\n\t\t\tconst serverTools = servers.map(s => s.tools.read(r));\n\t\t\tctxServerCount.set(servers.length);\n\t\t\tctxToolsCount.set(serverTools.reduce((count, tools) => count + tools.length, 0));\n\t\t\tctxHasUnknownTools.set(mcpService.lazyCollectionState.read(r).state !== LazyCollectionState.AllKnown || servers.some(s => {\n\t\t\t\tconst toolState = s.cacheState.read(r);\n\t\t\t\treturn toolState === McpServerCacheState.Unknown || toolState === McpServerCacheState.Outdated || toolState === McpServerCacheState.RefreshingFromUnknown;\n\t\t\t}));\n\t\t}));\n\t}\n}\n"]}