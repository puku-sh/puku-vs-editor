{"version":3,"sources":["vs/workbench/contrib/mcp/common/mcpRegistry.ts"],"names":[],"mappings":"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","file":"mcpRegistry.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { assertNever } from '../../../../base/common/assert.js';\nimport { Codicon } from '../../../../base/common/codicons.js';\nimport { Emitter } from '../../../../base/common/event.js';\nimport { MarkdownString } from '../../../../base/common/htmlContent.js';\nimport { Iterable } from '../../../../base/common/iterator.js';\nimport { Lazy } from '../../../../base/common/lazy.js';\nimport { Disposable, DisposableStore, IDisposable } from '../../../../base/common/lifecycle.js';\nimport { derived, IObservable, observableValue, autorunSelfDisposable } from '../../../../base/common/observable.js';\nimport { isDefined } from '../../../../base/common/types.js';\nimport { URI } from '../../../../base/common/uri.js';\nimport { localize } from '../../../../nls.js';\nimport { ConfigurationTarget, IConfigurationService } from '../../../../platform/configuration/common/configuration.js';\nimport { IDialogService } from '../../../../platform/dialogs/common/dialogs.js';\nimport { ExtensionIdentifier } from '../../../../platform/extensions/common/extensions.js';\nimport { IInstantiationService } from '../../../../platform/instantiation/common/instantiation.js';\nimport { ILabelService } from '../../../../platform/label/common/label.js';\nimport { ILogService } from '../../../../platform/log/common/log.js';\nimport { mcpAccessConfig, McpAccessValue } from '../../../../platform/mcp/common/mcpManagement.js';\nimport { INotificationService, Severity } from '../../../../platform/notification/common/notification.js';\nimport { observableConfigValue } from '../../../../platform/observable/common/platformObservableUtils.js';\nimport { IQuickInputButton, IQuickInputService, IQuickPickItem } from '../../../../platform/quickinput/common/quickInput.js';\nimport { StorageScope, StorageTarget } from '../../../../platform/storage/common/storage.js';\nimport { IWorkspaceFolderData } from '../../../../platform/workspace/common/workspace.js';\nimport { IConfigurationResolverService } from '../../../services/configurationResolver/common/configurationResolver.js';\nimport { ConfigurationResolverExpression, IResolvedValue } from '../../../services/configurationResolver/common/configurationResolverExpression.js';\nimport { AUX_WINDOW_GROUP, IEditorService } from '../../../services/editor/common/editorService.js';\nimport { IMcpDevModeDebugging } from './mcpDevMode.js';\nimport { McpRegistryInputStorage } from './mcpRegistryInputStorage.js';\nimport { IMcpHostDelegate, IMcpRegistry, IMcpResolveConnectionOptions } from './mcpRegistryTypes.js';\nimport { McpServerConnection } from './mcpServerConnection.js';\nimport { IMcpServerConnection, LazyCollectionState, McpCollectionDefinition, McpDefinitionReference, McpServerDefinition, McpServerLaunch, McpServerTrust, McpStartServerInteraction, UserInteractionRequiredError } from './mcpTypes.js';\n\nconst notTrustedNonce = '__vscode_not_trusted';\n\nexport class McpRegistry extends Disposable implements IMcpRegistry {\n\tdeclare public readonly _serviceBrand: undefined;\n\n\tprivate readonly _collections = observableValue<readonly McpCollectionDefinition[]>('collections', []);\n\tprivate readonly _delegates = observableValue<readonly IMcpHostDelegate[]>('delegates', []);\n\tprivate readonly _mcpAccessValue: IObservable<string>;\n\tpublic readonly collections: IObservable<readonly McpCollectionDefinition[]> = derived(reader => {\n\t\tif (this._mcpAccessValue.read(reader) === McpAccessValue.None) {\n\t\t\treturn [];\n\t\t}\n\t\treturn this._collections.read(reader);\n\t});\n\n\tprivate readonly _workspaceStorage = new Lazy(() => this._register(this._instantiationService.createInstance(McpRegistryInputStorage, StorageScope.WORKSPACE, StorageTarget.USER)));\n\tprivate readonly _profileStorage = new Lazy(() => this._register(this._instantiationService.createInstance(McpRegistryInputStorage, StorageScope.PROFILE, StorageTarget.USER)));\n\n\tprivate readonly _ongoingLazyActivations = observableValue(this, 0);\n\n\tpublic readonly lazyCollectionState = derived(reader => {\n\t\tif (this._mcpAccessValue.read(reader) === McpAccessValue.None) {\n\t\t\treturn { state: LazyCollectionState.AllKnown, collections: [] };\n\t\t}\n\n\t\tif (this._ongoingLazyActivations.read(reader) > 0) {\n\t\t\treturn { state: LazyCollectionState.LoadingUnknown, collections: [] };\n\t\t}\n\t\tconst collections = this._collections.read(reader);\n\t\tconst hasUnknown = collections.some(c => c.lazy && c.lazy.isCached === false);\n\t\treturn hasUnknown ? { state: LazyCollectionState.HasUnknown, collections: collections.filter(c => c.lazy && c.lazy.isCached === false) } : { state: LazyCollectionState.AllKnown, collections: [] };\n\t});\n\n\tpublic get delegates(): IObservable<readonly IMcpHostDelegate[]> {\n\t\treturn this._delegates;\n\t}\n\n\tprivate readonly _onDidChangeInputs = this._register(new Emitter<void>());\n\tpublic readonly onDidChangeInputs = this._onDidChangeInputs.event;\n\n\tconstructor(\n\t\t@IInstantiationService private readonly _instantiationService: IInstantiationService,\n\t\t@IConfigurationResolverService private readonly _configurationResolverService: IConfigurationResolverService,\n\t\t@IDialogService private readonly _dialogService: IDialogService,\n\t\t@INotificationService private readonly _notificationService: INotificationService,\n\t\t@IEditorService private readonly _editorService: IEditorService,\n\t\t@IConfigurationService configurationService: IConfigurationService,\n\t\t@IQuickInputService private readonly _quickInputService: IQuickInputService,\n\t\t@ILabelService private readonly _labelService: ILabelService,\n\t\t@ILogService private readonly _logService: ILogService,\n\t) {\n\t\tsuper();\n\t\tthis._mcpAccessValue = observableConfigValue(mcpAccessConfig, McpAccessValue.All, configurationService);\n\t}\n\n\tpublic registerDelegate(delegate: IMcpHostDelegate): IDisposable {\n\t\tconst delegates = this._delegates.get().slice();\n\t\tdelegates.push(delegate);\n\t\tdelegates.sort((a, b) => b.priority - a.priority);\n\t\tthis._delegates.set(delegates, undefined);\n\n\t\treturn {\n\t\t\tdispose: () => {\n\t\t\t\tconst delegates = this._delegates.get().filter(d => d !== delegate);\n\t\t\t\tthis._delegates.set(delegates, undefined);\n\t\t\t}\n\t\t};\n\t}\n\n\tpublic registerCollection(collection: McpCollectionDefinition): IDisposable {\n\t\tconst currentCollections = this._collections.get();\n\t\tconst toReplace = currentCollections.find(c => c.lazy && c.id === collection.id);\n\n\t\t// Incoming collections replace the \"lazy\" versions. See `ExtensionMcpDiscovery` for an example.\n\t\tif (toReplace) {\n\t\t\tthis._collections.set(currentCollections.map(c => c === toReplace ? collection : c), undefined);\n\t\t} else {\n\t\t\tthis._collections.set([...currentCollections, collection]\n\t\t\t\t.sort((a, b) => (a.presentation?.order || 0) - (b.presentation?.order || 0)), undefined);\n\t\t}\n\n\t\treturn {\n\t\t\tdispose: () => {\n\t\t\t\tconst currentCollections = this._collections.get();\n\t\t\t\tthis._collections.set(currentCollections.filter(c => c !== collection), undefined);\n\t\t\t}\n\t\t};\n\t}\n\n\tpublic getServerDefinition(collectionRef: McpDefinitionReference, definitionRef: McpDefinitionReference): IObservable<{ server: McpServerDefinition | undefined; collection: McpCollectionDefinition | undefined }> {\n\t\tconst collectionObs = this._collections.map(cols => cols.find(c => c.id === collectionRef.id));\n\t\treturn collectionObs.map((collection, reader) => {\n\t\t\tconst server = collection?.serverDefinitions.read(reader).find(s => s.id === definitionRef.id);\n\t\t\treturn { collection, server };\n\t\t});\n\t}\n\n\tpublic async discoverCollections(): Promise<McpCollectionDefinition[]> {\n\t\tconst toDiscover = this._collections.get().filter(c => c.lazy && !c.lazy.isCached);\n\n\t\tthis._ongoingLazyActivations.set(this._ongoingLazyActivations.get() + 1, undefined);\n\t\tawait Promise.all(toDiscover.map(c => c.lazy?.load())).finally(() => {\n\t\t\tthis._ongoingLazyActivations.set(this._ongoingLazyActivations.get() - 1, undefined);\n\t\t});\n\n\t\tconst found: McpCollectionDefinition[] = [];\n\t\tconst current = this._collections.get();\n\t\tfor (const collection of toDiscover) {\n\t\t\tconst rec = current.find(c => c.id === collection.id);\n\t\t\tif (!rec) {\n\t\t\t\t// ignored\n\t\t\t} else if (rec.lazy) {\n\t\t\t\trec.lazy.removed?.(); // did not get replaced by the non-lazy version\n\t\t\t} else {\n\t\t\t\tfound.push(rec);\n\t\t\t}\n\t\t}\n\n\n\t\treturn found;\n\t}\n\n\tprivate _getInputStorage(scope: StorageScope): McpRegistryInputStorage {\n\t\treturn scope === StorageScope.WORKSPACE ? this._workspaceStorage.value : this._profileStorage.value;\n\t}\n\n\tprivate _getInputStorageInConfigTarget(configTarget: ConfigurationTarget): McpRegistryInputStorage {\n\t\treturn this._getInputStorage(\n\t\t\tconfigTarget === ConfigurationTarget.WORKSPACE || configTarget === ConfigurationTarget.WORKSPACE_FOLDER\n\t\t\t\t? StorageScope.WORKSPACE\n\t\t\t\t: StorageScope.PROFILE\n\t\t);\n\t}\n\n\tpublic async clearSavedInputs(scope: StorageScope, inputId?: string) {\n\t\tconst storage = this._getInputStorage(scope);\n\t\tif (inputId) {\n\t\t\tawait storage.clear(inputId);\n\t\t} else {\n\t\t\tstorage.clearAll();\n\t\t}\n\n\t\tthis._onDidChangeInputs.fire();\n\t}\n\n\tpublic async editSavedInput(inputId: string, folderData: IWorkspaceFolderData | undefined, configSection: string, target: ConfigurationTarget): Promise<void> {\n\t\tconst storage = this._getInputStorageInConfigTarget(target);\n\t\tconst expr = ConfigurationResolverExpression.parse(inputId);\n\n\t\tconst stored = await storage.getMap();\n\t\tconst previous = stored[inputId].value;\n\t\tawait this._configurationResolverService.resolveWithInteraction(folderData, expr, configSection, previous ? { [inputId.slice(2, -1)]: previous } : {}, target);\n\t\tawait this._updateStorageWithExpressionInputs(storage, expr);\n\t}\n\n\tpublic async setSavedInput(inputId: string, target: ConfigurationTarget, value: string): Promise<void> {\n\t\tconst storage = this._getInputStorageInConfigTarget(target);\n\t\tconst expr = ConfigurationResolverExpression.parse(inputId);\n\t\tfor (const unresolved of expr.unresolved()) {\n\t\t\texpr.resolve(unresolved, value);\n\t\t\tbreak;\n\t\t}\n\t\tawait this._updateStorageWithExpressionInputs(storage, expr);\n\t}\n\n\tpublic getSavedInputs(scope: StorageScope): Promise<{ [id: string]: IResolvedValue }> {\n\t\treturn this._getInputStorage(scope).getMap();\n\t}\n\n\tprivate async _checkTrust(collection: McpCollectionDefinition, definition: McpServerDefinition, {\n\t\ttrustNonceBearer,\n\t\tinteraction,\n\t\tpromptType = 'only-new',\n\t\tautoTrustChanges = false,\n\t\terrorOnUserInteraction = false,\n\t}: IMcpResolveConnectionOptions) {\n\t\tif (collection.trustBehavior === McpServerTrust.Kind.Trusted) {\n\t\t\tthis._logService.trace(`MCP server ${definition.id} is trusted, no trust prompt needed`);\n\t\t\treturn true;\n\t\t} else if (collection.trustBehavior === McpServerTrust.Kind.TrustedOnNonce) {\n\t\t\tif (definition.cacheNonce === trustNonceBearer.trustedAtNonce) {\n\t\t\t\tthis._logService.trace(`MCP server ${definition.id} is unchanged, no trust prompt needed`);\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tif (autoTrustChanges) {\n\t\t\t\tthis._logService.trace(`MCP server ${definition.id} is was changed but user explicitly executed`);\n\t\t\t\ttrustNonceBearer.trustedAtNonce = definition.cacheNonce;\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tif (trustNonceBearer.trustedAtNonce === notTrustedNonce) {\n\t\t\t\tif (promptType === 'all-untrusted') {\n\t\t\t\t\tif (errorOnUserInteraction) {\n\t\t\t\t\t\tthrow new UserInteractionRequiredError('serverTrust');\n\t\t\t\t\t}\n\t\t\t\t\treturn this._promptForTrust(definition, collection, interaction, trustNonceBearer);\n\t\t\t\t} else {\n\t\t\t\t\tthis._logService.trace(`MCP server ${definition.id} is untrusted, denying trust prompt`);\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (promptType === 'never') {\n\t\t\t\tthis._logService.trace(`MCP server ${definition.id} trust state is unknown, skipping prompt`);\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif (errorOnUserInteraction) {\n\t\t\t\tthrow new UserInteractionRequiredError('serverTrust');\n\t\t\t}\n\n\t\t\tconst didTrust = await this._promptForTrust(definition, collection, interaction, trustNonceBearer);\n\t\t\tif (didTrust) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\tif (didTrust === undefined) {\n\t\t\t\treturn undefined;\n\t\t\t}\n\n\t\t\ttrustNonceBearer.trustedAtNonce = notTrustedNonce;\n\t\t\treturn false;\n\t\t} else {\n\t\t\tassertNever(collection.trustBehavior);\n\t\t}\n\t}\n\n\tprivate async _promptForTrust(definition: McpServerDefinition, collection: McpCollectionDefinition, interaction: McpStartServerInteraction | undefined, trustNonceBearer: { trustedAtNonce: string | undefined }): Promise<boolean> {\n\t\tinteraction ??= new McpStartServerInteraction();\n\t\tinteraction.participants.set(definition.id, { s: 'waiting', definition, collection });\n\n\t\tconst trustedDefinitionIds = await new Promise<string[] | undefined>(resolve => {\n\t\t\tautorunSelfDisposable(reader => {\n\t\t\t\tconst map = interaction.participants.observable.read(reader);\n\t\t\t\tif (Iterable.some(map.values(), p => p.s === 'unknown')) {\n\t\t\t\t\treturn; // wait to gather all calls\n\t\t\t\t}\n\n\t\t\t\treader.dispose();\n\t\t\t\tinteraction.choice ??= this._promptForTrustOpenDialog(\n\t\t\t\t\t[...map.values()].map((v) => v.s === 'waiting' ? v : undefined).filter(isDefined),\n\t\t\t\t);\n\t\t\t\tresolve(interaction.choice);\n\t\t\t});\n\t\t});\n\n\t\tthis._logService.trace(`MCP trusted servers:`, trustedDefinitionIds);\n\n\t\tif (trustedDefinitionIds) {\n\t\t\ttrustNonceBearer.trustedAtNonce = trustedDefinitionIds.includes(definition.id)\n\t\t\t\t? definition.cacheNonce\n\t\t\t\t: notTrustedNonce;\n\t\t}\n\n\t\treturn !!trustedDefinitionIds?.includes(definition.id);\n\t}\n\n\t/**\n\t * Confirms with the user which of the provided definitions should be trusted.\n\t * Returns undefined if the user cancelled the flow, or the list of trusted\n\t * definition IDs otherwise.\n\t */\n\tprotected async _promptForTrustOpenDialog(definitions: { definition: McpServerDefinition; collection: McpCollectionDefinition }[]): Promise<string[] | undefined> {\n\t\tfunction labelFor(r: { definition: McpServerDefinition; collection: McpCollectionDefinition }) {\n\t\t\tconst originURI = r.definition.presentation?.origin?.uri || r.collection.presentation?.origin;\n\t\t\tlet labelWithOrigin = originURI ? `[\\`${r.definition.label}\\`](${originURI})` : '`' + r.definition.label + '`';\n\n\t\t\tif (r.collection.source instanceof ExtensionIdentifier) {\n\t\t\t\tlabelWithOrigin += ` (${localize('trustFromExt', 'from {0}', r.collection.source.value)})`;\n\t\t\t}\n\n\t\t\treturn labelWithOrigin;\n\t\t}\n\n\t\tif (definitions.length === 1) {\n\t\t\tconst def = definitions[0];\n\t\t\tconst originURI = def.definition.presentation?.origin?.uri;\n\n\t\t\tconst { result } = await this._dialogService.prompt(\n\t\t\t\t{\n\t\t\t\t\tmessage: localize('trustTitleWithOrigin', 'Trust and run MCP server {0}?', def.definition.label),\n\t\t\t\t\tcustom: {\n\t\t\t\t\t\ticon: Codicon.shield,\n\t\t\t\t\t\tmarkdownDetails: [{\n\t\t\t\t\t\t\tmarkdown: new MarkdownString(localize('mcp.trust.details', 'The MCP server {0} was updated. MCP servers may add context to your chat session and lead to unexpected behavior. Do you want to trust and run this server?', labelFor(def))),\n\t\t\t\t\t\t\tactionHandler: () => {\n\t\t\t\t\t\t\t\tconst editor = this._editorService.openEditor({ resource: originURI! }, AUX_WINDOW_GROUP);\n\t\t\t\t\t\t\t\treturn editor.then(Boolean);\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t}]\n\t\t\t\t\t},\n\t\t\t\t\tbuttons: [\n\t\t\t\t\t\t{ label: localize('mcp.trust.yes', 'Trust'), run: () => true },\n\t\t\t\t\t\t{ label: localize('mcp.trust.no', 'Do not trust'), run: () => false }\n\t\t\t\t\t],\n\t\t\t\t},\n\t\t\t);\n\n\t\t\treturn result === undefined ? undefined : (result ? [def.definition.id] : []);\n\t\t}\n\n\t\tconst list = definitions.map(d => `- ${labelFor(d)}`).join('\\n');\n\t\tconst { result } = await this._dialogService.prompt(\n\t\t\t{\n\t\t\t\tmessage: localize('trustTitleWithOriginMulti', 'Trust and run {0} MCP servers?', definitions.length),\n\t\t\t\tcustom: {\n\t\t\t\t\ticon: Codicon.shield,\n\t\t\t\t\tmarkdownDetails: [{\n\t\t\t\t\t\tmarkdown: new MarkdownString(localize('mcp.trust.detailsMulti', 'Several updated MCP servers were discovered:\\n\\n{0}\\n\\n MCP servers may add context to your chat session and lead to unexpected behavior. Do you want to trust and run these server?', list)),\n\t\t\t\t\t\tactionHandler: (uri) => {\n\t\t\t\t\t\t\tconst editor = this._editorService.openEditor({ resource: URI.parse(uri) }, AUX_WINDOW_GROUP);\n\t\t\t\t\t\t\treturn editor.then(Boolean);\n\t\t\t\t\t\t},\n\t\t\t\t\t}]\n\t\t\t\t},\n\t\t\t\tbuttons: [\n\t\t\t\t\t{ label: localize('mcp.trust.yes', 'Trust'), run: () => 'all' },\n\t\t\t\t\t{ label: localize('mcp.trust.pick', 'Pick Trusted'), run: () => 'pick' },\n\t\t\t\t\t{ label: localize('mcp.trust.no', 'Do not trust'), run: () => 'none' },\n\t\t\t\t],\n\t\t\t},\n\t\t);\n\n\t\tif (result === undefined) {\n\t\t\treturn undefined;\n\t\t} else if (result === 'all') {\n\t\t\treturn definitions.map(d => d.definition.id);\n\t\t} else if (result === 'none') {\n\t\t\treturn [];\n\t\t}\n\n\t\ttype ActionableButton = IQuickInputButton & { action: () => void };\n\t\tfunction isActionableButton(obj: IQuickInputButton): obj is ActionableButton {\n\t\t\treturn typeof (obj as ActionableButton).action === 'function';\n\t\t}\n\n\t\tconst store = new DisposableStore();\n\t\tconst picker = store.add(this._quickInputService.createQuickPick<IQuickPickItem & { definitonId: string }>({ useSeparators: false }));\n\t\tpicker.canSelectMany = true;\n\t\tpicker.items = definitions.map(({ definition, collection }) => {\n\t\t\tconst buttons: ActionableButton[] = [];\n\t\t\tif (definition.presentation?.origin) {\n\t\t\t\tconst origin = definition.presentation.origin;\n\t\t\t\tbuttons.push({\n\t\t\t\t\ticonClass: 'codicon-go-to-file',\n\t\t\t\t\ttooltip: 'Go to Definition',\n\t\t\t\t\taction: () => this._editorService.openEditor({ resource: origin.uri, options: { selection: origin.range } })\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\ttype: 'item',\n\t\t\t\tlabel: definition.label,\n\t\t\t\tdefinitonId: definition.id,\n\t\t\t\tdescription: collection.source instanceof ExtensionIdentifier\n\t\t\t\t\t? collection.source.value\n\t\t\t\t\t: (definition.presentation?.origin ? this._labelService.getUriLabel(definition.presentation.origin.uri) : undefined),\n\t\t\t\tpicked: false,\n\t\t\t\tbuttons\n\t\t\t};\n\t\t});\n\t\tpicker.placeholder = 'Select MCP servers to trust';\n\t\tpicker.ignoreFocusOut = true;\n\n\t\tstore.add(picker.onDidTriggerItemButton(e => {\n\t\t\tif (isActionableButton(e.button)) {\n\t\t\t\te.button.action();\n\t\t\t}\n\t\t}));\n\n\t\treturn new Promise<string[] | undefined>(resolve => {\n\t\t\tpicker.onDidAccept(() => {\n\t\t\t\tresolve(picker.selectedItems.map(item => item.definitonId));\n\t\t\t\tpicker.hide();\n\t\t\t});\n\t\t\tpicker.onDidHide(() => {\n\t\t\t\tresolve(undefined);\n\t\t\t});\n\t\t\tpicker.show();\n\t\t}).finally(() => store.dispose());\n\t}\n\n\tprivate async _updateStorageWithExpressionInputs(inputStorage: McpRegistryInputStorage, expr: ConfigurationResolverExpression<unknown>): Promise<void> {\n\t\tconst secrets: Record<string, IResolvedValue> = {};\n\t\tconst inputs: Record<string, IResolvedValue> = {};\n\t\tfor (const [replacement, resolved] of expr.resolved()) {\n\t\t\tif (resolved.input?.type === 'promptString' && resolved.input.password) {\n\t\t\t\tsecrets[replacement.id] = resolved;\n\t\t\t} else {\n\t\t\t\tinputs[replacement.id] = resolved;\n\t\t\t}\n\t\t}\n\n\t\tinputStorage.setPlainText(inputs);\n\t\tawait inputStorage.setSecrets(secrets);\n\t\tthis._onDidChangeInputs.fire();\n\t}\n\n\tprivate async _replaceVariablesInLaunch(delegate: IMcpHostDelegate, definition: McpServerDefinition, launch: McpServerLaunch, errorOnUserInteraction?: boolean) {\n\t\tif (!definition.variableReplacement) {\n\t\t\treturn launch;\n\t\t}\n\n\t\tconst { section, target, folder } = definition.variableReplacement;\n\t\tconst inputStorage = this._getInputStorageInConfigTarget(target);\n\t\tconst [previouslyStored, withRemoteFilled] = await Promise.all([\n\t\t\tinputStorage.getMap(),\n\t\t\tdelegate.substituteVariables(definition, launch),\n\t\t]);\n\n\t\t// pre-fill the variables we already resolved to avoid extra prompting\n\t\tconst expr = ConfigurationResolverExpression.parse(withRemoteFilled);\n\t\tfor (const replacement of expr.unresolved()) {\n\t\t\tif (previouslyStored.hasOwnProperty(replacement.id)) {\n\t\t\t\texpr.resolve(replacement, previouslyStored[replacement.id]);\n\t\t\t}\n\t\t}\n\n\t\t// Check if there are still unresolved variables that would require interaction\n\t\tif (errorOnUserInteraction) {\n\t\t\tconst unresolved = Array.from(expr.unresolved());\n\t\t\tif (unresolved.length > 0) {\n\t\t\t\tthrow new UserInteractionRequiredError('variables');\n\t\t\t}\n\t\t}\n\t\t// resolve variables requiring user input\n\t\tawait this._configurationResolverService.resolveWithInteraction(folder, expr, section, undefined, target);\n\n\t\tawait this._updateStorageWithExpressionInputs(inputStorage, expr);\n\n\t\t// resolve other non-interactive variables, returning the final object\n\t\treturn await this._configurationResolverService.resolveAsync(folder, expr);\n\t}\n\n\tpublic async resolveConnection(opts: IMcpResolveConnectionOptions): Promise<IMcpServerConnection | undefined> {\n\t\tconst { collectionRef, definitionRef, interaction, logger, debug } = opts;\n\t\tlet collection = this._collections.get().find(c => c.id === collectionRef.id);\n\t\tif (collection?.lazy) {\n\t\t\tawait collection.lazy.load();\n\t\t\tcollection = this._collections.get().find(c => c.id === collectionRef.id);\n\t\t}\n\n\t\tconst definition = collection?.serverDefinitions.get().find(s => s.id === definitionRef.id);\n\t\tif (!collection || !definition) {\n\t\t\tthrow new Error(`Collection or definition not found for ${collectionRef.id} and ${definitionRef.id}`);\n\t\t}\n\n\t\tconst delegate = this._delegates.get().find(d => d.canStart(collection, definition));\n\t\tif (!delegate) {\n\t\t\tthrow new Error('No delegate found that can handle the connection');\n\t\t}\n\n\t\tconst trusted = await this._checkTrust(collection, definition, opts);\n\t\tinteraction?.participants.set(definition.id, { s: 'resolved' });\n\t\tif (!trusted) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\tlet launch: McpServerLaunch | undefined = definition.launch;\n\t\tif (collection.resolveServerLanch) {\n\t\t\tlaunch = await collection.resolveServerLanch(definition);\n\t\t\tif (!launch) {\n\t\t\t\treturn undefined; // interaction cancelled by user\n\t\t\t}\n\t\t}\n\n\t\ttry {\n\t\t\tlaunch = await this._replaceVariablesInLaunch(delegate, definition, launch, opts.errorOnUserInteraction);\n\n\t\t\tif (definition.devMode && debug) {\n\t\t\t\tlaunch = await this._instantiationService.invokeFunction(accessor => accessor.get(IMcpDevModeDebugging).transform(definition, launch!));\n\t\t\t}\n\t\t} catch (e) {\n\t\t\tif (e instanceof UserInteractionRequiredError) {\n\t\t\t\tthrow e;\n\t\t\t}\n\n\t\t\tthis._notificationService.notify({\n\t\t\t\tseverity: Severity.Error,\n\t\t\t\tmessage: localize('mcp.launchError', 'Error starting {0}: {1}', definition.label, String(e)),\n\t\t\t\tactions: {\n\t\t\t\t\tprimary: collection.presentation?.origin && [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tid: 'mcp.launchError.openConfig',\n\t\t\t\t\t\t\tclass: undefined,\n\t\t\t\t\t\t\tenabled: true,\n\t\t\t\t\t\t\ttooltip: '',\n\t\t\t\t\t\t\tlabel: localize('mcp.launchError.openConfig', 'Open Configuration'),\n\t\t\t\t\t\t\trun: () => this._editorService.openEditor({\n\t\t\t\t\t\t\t\tresource: collection.presentation!.origin,\n\t\t\t\t\t\t\t\toptions: { selection: definition.presentation?.origin?.range }\n\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t}\n\t\t\t\t\t]\n\t\t\t\t}\n\t\t\t});\n\t\t\treturn;\n\t\t}\n\n\t\treturn this._instantiationService.createInstance(\n\t\t\tMcpServerConnection,\n\t\t\tcollection,\n\t\t\tdefinition,\n\t\t\tdelegate,\n\t\t\tlaunch,\n\t\t\tlogger,\n\t\t\topts.errorOnUserInteraction,\n\t\t);\n\t}\n}\n"]}