{"version":3,"sources":["vs/workbench/contrib/mcp/common/mcpLanguageModelToolContribution.ts"],"names":[],"mappings":"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","file":"mcpLanguageModelToolContribution.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { decodeBase64, VSBuffer } from '../../../../base/common/buffer.js';\nimport { CancellationToken } from '../../../../base/common/cancellation.js';\nimport { Codicon } from '../../../../base/common/codicons.js';\nimport { MarkdownString } from '../../../../base/common/htmlContent.js';\nimport { Lazy } from '../../../../base/common/lazy.js';\nimport { Disposable, DisposableMap, DisposableStore, IDisposable, toDisposable } from '../../../../base/common/lifecycle.js';\nimport { equals } from '../../../../base/common/objects.js';\nimport { autorun } from '../../../../base/common/observable.js';\nimport { basename } from '../../../../base/common/resources.js';\nimport { isDefined } from '../../../../base/common/types.js';\nimport { URI } from '../../../../base/common/uri.js';\nimport { localize } from '../../../../nls.js';\nimport { IFileService } from '../../../../platform/files/common/files.js';\nimport { IImageResizeService } from '../../../../platform/imageResize/common/imageResizeService.js';\nimport { IInstantiationService } from '../../../../platform/instantiation/common/instantiation.js';\nimport { IProductService } from '../../../../platform/product/common/productService.js';\nimport { StorageScope } from '../../../../platform/storage/common/storage.js';\nimport { IWorkbenchContribution } from '../../../common/contributions.js';\nimport { ChatResponseResource, getAttachableImageExtension } from '../../chat/common/chatModel.js';\nimport { LanguageModelPartAudience } from '../../chat/common/languageModels.js';\nimport { CountTokensCallback, ILanguageModelToolsService, IPreparedToolInvocation, IToolConfirmationMessages, IToolData, IToolImpl, IToolInvocation, IToolInvocationPreparationContext, IToolResult, IToolResultInputOutputDetails, ToolDataSource, ToolProgress, ToolSet } from '../../chat/common/languageModelToolsService.js';\nimport { IMcpRegistry } from './mcpRegistryTypes.js';\nimport { IMcpServer, IMcpService, IMcpTool, IMcpToolResourceLinkContents, McpResourceURI, McpToolResourceLinkMimeType } from './mcpTypes.js';\nimport { mcpServerToSourceData } from './mcpTypesUtils.js';\n\ninterface ISyncedToolData {\n\ttoolData: IToolData;\n\tstore: DisposableStore;\n}\n\nexport class McpLanguageModelToolContribution extends Disposable implements IWorkbenchContribution {\n\n\tpublic static readonly ID = 'workbench.contrib.mcp.languageModelTools';\n\n\tconstructor(\n\t\t@ILanguageModelToolsService private readonly _toolsService: ILanguageModelToolsService,\n\t\t@IMcpService mcpService: IMcpService,\n\t\t@IInstantiationService private readonly _instantiationService: IInstantiationService,\n\t\t@IMcpRegistry private readonly _mcpRegistry: IMcpRegistry,\n\t) {\n\t\tsuper();\n\n\t\ttype Rec = { source?: ToolDataSource } & IDisposable;\n\n\t\t// Keep tools in sync with the tools service.\n\t\tconst previous = this._register(new DisposableMap<IMcpServer, Rec>());\n\t\tthis._register(autorun(reader => {\n\t\t\tconst servers = mcpService.servers.read(reader);\n\n\t\t\tconst toDelete = new Set(previous.keys());\n\t\t\tfor (const server of servers) {\n\t\t\t\tconst previousRec = previous.get(server);\n\t\t\t\tif (previousRec) {\n\t\t\t\t\ttoDelete.delete(server);\n\t\t\t\t\tif (!previousRec.source || equals(previousRec.source, mcpServerToSourceData(server, reader))) {\n\t\t\t\t\t\tcontinue; // same definition, no need to update\n\t\t\t\t\t}\n\n\t\t\t\t\tpreviousRec.dispose();\n\t\t\t\t}\n\n\t\t\t\tconst store = new DisposableStore();\n\t\t\t\tconst rec: Rec = { dispose: () => store.dispose() };\n\t\t\t\tconst toolSet = new Lazy(() => {\n\t\t\t\t\tconst source = rec.source = mcpServerToSourceData(server);\n\t\t\t\t\tconst toolSet = store.add(this._toolsService.createToolSet(\n\t\t\t\t\t\tsource,\n\t\t\t\t\t\tserver.definition.id, server.definition.label,\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ticon: Codicon.mcp,\n\t\t\t\t\t\t\tdescription: localize('mcp.toolset', \"{0}: All Tools\", server.definition.label)\n\t\t\t\t\t\t}\n\t\t\t\t\t));\n\n\t\t\t\t\treturn { toolSet, source };\n\t\t\t\t});\n\n\t\t\t\tthis._syncTools(server, toolSet, store);\n\t\t\t\tprevious.set(server, rec);\n\t\t\t}\n\n\t\t\tfor (const key of toDelete) {\n\t\t\t\tprevious.deleteAndDispose(key);\n\t\t\t}\n\t\t}));\n\t}\n\n\tprivate _syncTools(server: IMcpServer, collectionData: Lazy<{ toolSet: ToolSet; source: ToolDataSource }>, store: DisposableStore) {\n\t\tconst tools = new Map</* tool ID */string, ISyncedToolData>();\n\n\t\tconst collectionObservable = this._mcpRegistry.collections.map(collections =>\n\t\t\tcollections.find(c => c.id === server.collection.id));\n\n\t\tstore.add(autorun(reader => {\n\t\t\tconst toDelete = new Set(tools.keys());\n\n\t\t\t// toRegister is deferred until deleting tools that moving a tool between\n\t\t\t// servers (or deleting one instance of a multi-instance server) doesn't cause an error.\n\t\t\tconst toRegister: (() => void)[] = [];\n\t\t\tconst registerTool = (tool: IMcpTool, toolData: IToolData, store: DisposableStore) => {\n\t\t\t\tstore.add(this._toolsService.registerTool(toolData, this._instantiationService.createInstance(McpToolImplementation, tool, server)));\n\t\t\t\tstore.add(collectionData.value.toolSet.addTool(toolData));\n\t\t\t};\n\n\t\t\tconst collection = collectionObservable.read(reader);\n\t\t\tfor (const tool of server.tools.read(reader)) {\n\t\t\t\tconst existing = tools.get(tool.id);\n\t\t\t\tconst icons = tool.icons.getUrl(22);\n\t\t\t\tconst toolData: IToolData = {\n\t\t\t\t\tid: tool.id,\n\t\t\t\t\tsource: collectionData.value.source,\n\t\t\t\t\ticon: icons || Codicon.tools,\n\t\t\t\t\t// duplicative: https://github.com/modelcontextprotocol/modelcontextprotocol/pull/813\n\t\t\t\t\tdisplayName: tool.definition.annotations?.title || tool.definition.title || tool.definition.name,\n\t\t\t\t\ttoolReferenceName: tool.referenceName,\n\t\t\t\t\tmodelDescription: tool.definition.description ?? '',\n\t\t\t\t\tuserDescription: tool.definition.description ?? '',\n\t\t\t\t\tinputSchema: tool.definition.inputSchema,\n\t\t\t\t\tcanBeReferencedInPrompt: true,\n\t\t\t\t\talwaysDisplayInputOutput: true,\n\t\t\t\t\tcanRequestPreApproval: !tool.definition.annotations?.readOnlyHint,\n\t\t\t\t\tcanRequestPostApproval: !!tool.definition.annotations?.openWorldHint,\n\t\t\t\t\trunsInWorkspace: collection?.scope === StorageScope.WORKSPACE || !!collection?.remoteAuthority,\n\t\t\t\t\ttags: ['mcp'],\n\t\t\t\t};\n\n\t\t\t\tif (existing) {\n\t\t\t\t\tif (!equals(existing.toolData, toolData)) {\n\t\t\t\t\t\texisting.toolData = toolData;\n\t\t\t\t\t\texisting.store.clear();\n\t\t\t\t\t\t// We need to re-register both the data and implementation, as the\n\t\t\t\t\t\t// implementation is discarded when the data is removed (#245921)\n\t\t\t\t\t\tregisterTool(tool, toolData, existing.store);\n\t\t\t\t\t}\n\t\t\t\t\ttoDelete.delete(tool.id);\n\t\t\t\t} else {\n\t\t\t\t\tconst store = new DisposableStore();\n\t\t\t\t\ttoRegister.push(() => registerTool(tool, toolData, store));\n\t\t\t\t\ttools.set(tool.id, { toolData, store });\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfor (const id of toDelete) {\n\t\t\t\tconst tool = tools.get(id);\n\t\t\t\tif (tool) {\n\t\t\t\t\ttool.store.dispose();\n\t\t\t\t\ttools.delete(id);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfor (const fn of toRegister) {\n\t\t\t\tfn();\n\t\t\t}\n\n\t\t\t// Important: flush tool updates when the server is fully registered so that\n\t\t\t// any consuming (e.g. autostarting) requests have the tools available immediately.\n\t\t\tthis._toolsService.flushToolUpdates();\n\t\t}));\n\n\t\tstore.add(toDisposable(() => {\n\t\t\tfor (const tool of tools.values()) {\n\t\t\t\ttool.store.dispose();\n\t\t\t}\n\t\t}));\n\t}\n}\n\nclass McpToolImplementation implements IToolImpl {\n\tconstructor(\n\t\tprivate readonly _tool: IMcpTool,\n\t\tprivate readonly _server: IMcpServer,\n\t\t@IProductService private readonly _productService: IProductService,\n\t\t@IFileService private readonly _fileService: IFileService,\n\t\t@IImageResizeService private readonly _imageResizeService: IImageResizeService,\n\t) { }\n\n\tasync prepareToolInvocation(context: IToolInvocationPreparationContext): Promise<IPreparedToolInvocation> {\n\t\tconst tool = this._tool;\n\t\tconst server = this._server;\n\n\t\tconst mcpToolWarning = localize(\n\t\t\t'mcp.tool.warning',\n\t\t\t\"Note that MCP servers or malicious conversation content may attempt to misuse '{0}' through tools.\",\n\t\t\tthis._productService.nameShort\n\t\t);\n\n\t\t// duplicative: https://github.com/modelcontextprotocol/modelcontextprotocol/pull/813\n\t\tconst title = tool.definition.annotations?.title || tool.definition.title || ('`' + tool.definition.name + '`');\n\n\t\tconst confirm: IToolConfirmationMessages = {};\n\t\tif (!tool.definition.annotations?.readOnlyHint) {\n\t\t\tconfirm.title = new MarkdownString(localize('msg.title', \"Run {0}\", title));\n\t\t\tconfirm.message = new MarkdownString(tool.definition.description, { supportThemeIcons: true });\n\t\t\tconfirm.disclaimer = mcpToolWarning;\n\t\t\tconfirm.allowAutoConfirm = true;\n\t\t}\n\t\tif (tool.definition.annotations?.openWorldHint) {\n\t\t\tconfirm.confirmResults = true;\n\t\t}\n\n\t\treturn {\n\t\t\tconfirmationMessages: confirm,\n\t\t\tinvocationMessage: new MarkdownString(localize('msg.run', \"Running {0}\", title)),\n\t\t\tpastTenseMessage: new MarkdownString(localize('msg.ran', \"Ran {0} \", title)),\n\t\t\toriginMessage: localize('msg.subtitle', \"{0} (MCP Server)\", server.definition.label),\n\t\t\ttoolSpecificData: {\n\t\t\t\tkind: 'input',\n\t\t\t\trawInput: context.parameters\n\t\t\t}\n\t\t};\n\t}\n\n\tasync invoke(invocation: IToolInvocation, _countTokens: CountTokensCallback, progress: ToolProgress, token: CancellationToken) {\n\n\t\tconst result: IToolResult = {\n\t\t\tcontent: []\n\t\t};\n\n\t\tconst callResult = await this._tool.callWithProgress(invocation.parameters as Record<string, unknown>, progress, { chatRequestId: invocation.chatRequestId, chatSessionId: invocation.context?.sessionId }, token);\n\t\tconst details: IToolResultInputOutputDetails = {\n\t\t\tinput: JSON.stringify(invocation.parameters, undefined, 2),\n\t\t\toutput: [],\n\t\t\tisError: callResult.isError === true,\n\t\t};\n\n\t\tfor (const item of callResult.content) {\n\t\t\tconst audience = item.annotations?.audience?.map(a => {\n\t\t\t\tif (a === 'assistant') {\n\t\t\t\t\treturn LanguageModelPartAudience.Assistant;\n\t\t\t\t} else if (a === 'user') {\n\t\t\t\t\treturn LanguageModelPartAudience.User;\n\t\t\t\t} else {\n\t\t\t\t\treturn undefined;\n\t\t\t\t}\n\t\t\t}).filter(isDefined);\n\n\t\t\t// Explicit user parts get pushed to progress to show in the status UI\n\t\t\tif (audience?.includes(LanguageModelPartAudience.User)) {\n\t\t\t\tif (item.type === 'text') {\n\t\t\t\t\tprogress.report({ message: item.text });\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Rewrite image resources to images so they are inlined nicely\n\t\t\tconst addAsInlineData = async (mimeType: string, value: string, uri?: URI): Promise<VSBuffer | void> => {\n\t\t\t\tdetails.output.push({ type: 'embed', mimeType, value, uri, audience });\n\t\t\t\tif (isForModel) {\n\t\t\t\t\tlet finalData: VSBuffer;\n\t\t\t\t\ttry {\n\t\t\t\t\t\tconst resized = await this._imageResizeService.resizeImage(decodeBase64(value).buffer, mimeType);\n\t\t\t\t\t\tfinalData = VSBuffer.wrap(resized);\n\t\t\t\t\t} catch {\n\t\t\t\t\t\tfinalData = decodeBase64(value);\n\t\t\t\t\t}\n\t\t\t\t\tresult.content.push({ kind: 'data', value: { mimeType, data: finalData }, audience });\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tconst addAsLinkedResource = (uri: URI, mimeType?: string) => {\n\t\t\t\tconst json: IMcpToolResourceLinkContents = { uri, underlyingMimeType: mimeType };\n\t\t\t\tresult.content.push({\n\t\t\t\t\tkind: 'data',\n\t\t\t\t\taudience,\n\t\t\t\t\tvalue: {\n\t\t\t\t\t\tmimeType: McpToolResourceLinkMimeType,\n\t\t\t\t\t\tdata: VSBuffer.fromString(JSON.stringify(json)),\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t};\n\n\t\t\tconst isForModel = !audience || audience.includes(LanguageModelPartAudience.Assistant);\n\t\t\tif (item.type === 'text') {\n\t\t\t\tdetails.output.push({ type: 'embed', isText: true, value: item.text });\n\t\t\t\t// structured content 'represents the result of the tool call', so take\n\t\t\t\t// that in place of any textual description when present.\n\t\t\t\tif (isForModel && !callResult.structuredContent) {\n\t\t\t\t\tresult.content.push({\n\t\t\t\t\t\tkind: 'text',\n\t\t\t\t\t\taudience,\n\t\t\t\t\t\tvalue: item.text\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t} else if (item.type === 'image' || item.type === 'audio') {\n\t\t\t\t// default to some image type if not given to hint\n\t\t\t\tawait addAsInlineData(item.mimeType || 'image/png', item.data);\n\t\t\t} else if (item.type === 'resource_link') {\n\t\t\t\tconst uri = McpResourceURI.fromServer(this._server.definition, item.uri);\n\t\t\t\tdetails.output.push({\n\t\t\t\t\ttype: 'ref',\n\t\t\t\t\turi,\n\t\t\t\t\taudience,\n\t\t\t\t\tmimeType: item.mimeType,\n\t\t\t\t});\n\n\t\t\t\tif (isForModel) {\n\t\t\t\t\tif (item.mimeType && getAttachableImageExtension(item.mimeType)) {\n\t\t\t\t\t\tresult.content.push({\n\t\t\t\t\t\t\tkind: 'data',\n\t\t\t\t\t\t\taudience,\n\t\t\t\t\t\t\tvalue: {\n\t\t\t\t\t\t\t\tmimeType: item.mimeType,\n\t\t\t\t\t\t\t\tdata: await this._fileService.readFile(uri).then(f => f.value).catch(() => VSBuffer.alloc(0)),\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t} else {\n\t\t\t\t\t\taddAsLinkedResource(uri, item.mimeType);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else if (item.type === 'resource') {\n\t\t\t\tconst uri = McpResourceURI.fromServer(this._server.definition, item.resource.uri);\n\t\t\t\tif (item.resource.mimeType && getAttachableImageExtension(item.resource.mimeType) && 'blob' in item.resource) {\n\t\t\t\t\tawait addAsInlineData(item.resource.mimeType, item.resource.blob, uri);\n\t\t\t\t} else {\n\t\t\t\t\tdetails.output.push({\n\t\t\t\t\t\ttype: 'embed',\n\t\t\t\t\t\turi,\n\t\t\t\t\t\tisText: 'text' in item.resource,\n\t\t\t\t\t\tmimeType: item.resource.mimeType,\n\t\t\t\t\t\tvalue: 'blob' in item.resource ? item.resource.blob : item.resource.text,\n\t\t\t\t\t\taudience,\n\t\t\t\t\t\tasResource: true,\n\t\t\t\t\t});\n\n\t\t\t\t\tif (isForModel) {\n\t\t\t\t\t\tconst permalink = invocation.context && ChatResponseResource.createUri(invocation.context.sessionId, invocation.callId, result.content.length, basename(uri));\n\t\t\t\t\t\taddAsLinkedResource(permalink || uri, item.resource.mimeType);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (callResult.structuredContent) {\n\t\t\tdetails.output.push({ type: 'embed', isText: true, value: JSON.stringify(callResult.structuredContent, null, 2), audience: [LanguageModelPartAudience.Assistant] });\n\t\t\tresult.content.push({ kind: 'text', value: JSON.stringify(callResult.structuredContent), audience: [LanguageModelPartAudience.Assistant] });\n\t\t}\n\n\t\tresult.toolResultDetails = details;\n\t\treturn result;\n\t}\n\n}\n"]}