{"version":3,"sources":["vs/workbench/contrib/mcp/common/mcpDevMode.ts"],"names":[],"mappings":"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","file":"mcpDevMode.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { equals as arraysEqual } from '../../../../base/common/arrays.js';\nimport { assertNever } from '../../../../base/common/assert.js';\nimport { Throttler } from '../../../../base/common/async.js';\nimport * as glob from '../../../../base/common/glob.js';\nimport { Disposable } from '../../../../base/common/lifecycle.js';\nimport { equals as objectsEqual } from '../../../../base/common/objects.js';\nimport { autorun, autorunDelta, derivedOpts } from '../../../../base/common/observable.js';\nimport { localize } from '../../../../nls.js';\nimport { ICommandService } from '../../../../platform/commands/common/commands.js';\nimport { IFileService } from '../../../../platform/files/common/files.js';\nimport { createDecorator } from '../../../../platform/instantiation/common/instantiation.js';\nimport { IWorkspaceContextService } from '../../../../platform/workspace/common/workspace.js';\nimport { IConfig, IDebugService, IDebugSessionOptions } from '../../debug/common/debug.js';\nimport { IMcpRegistry } from './mcpRegistryTypes.js';\nimport { IMcpServer, McpServerDefinition, McpServerLaunch, McpServerTransportType } from './mcpTypes.js';\n\nexport class McpDevModeServerAttache extends Disposable {\n\tconstructor(\n\t\tserver: IMcpServer,\n\t\tfwdRef: { lastModeDebugged: boolean },\n\t\t@IMcpRegistry registry: IMcpRegistry,\n\t\t@IFileService fileService: IFileService,\n\t\t@IWorkspaceContextService workspaceContextService: IWorkspaceContextService,\n\t) {\n\t\tsuper();\n\n\t\tconst workspaceFolder = server.readDefinitions().map(({ collection }) => collection?.presentation?.origin &&\n\t\t\tworkspaceContextService.getWorkspaceFolder(collection.presentation?.origin)?.uri);\n\n\t\tconst restart = async () => {\n\t\t\tconst lastDebugged = fwdRef.lastModeDebugged;\n\t\t\tawait server.stop();\n\t\t\tawait server.start({ debug: lastDebugged });\n\t\t};\n\n\t\t// 1. Auto-start the server, restart if entering debug mode\n\t\tlet didAutoStart = false;\n\t\tthis._register(autorun(reader => {\n\t\t\tconst defs = server.readDefinitions().read(reader);\n\t\t\tif (!defs.collection || !defs.server || !defs.server.devMode) {\n\t\t\t\tdidAutoStart = false;\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// don't keep trying to start the server unless it's a new server or devmode is newly turned on\n\t\t\tif (didAutoStart) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst delegates = registry.delegates.read(reader);\n\t\t\tif (!delegates.some(d => d.canStart(defs.collection!, defs.server!))) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tserver.start();\n\t\t\tdidAutoStart = true;\n\t\t}));\n\n\t\tconst debugMode = server.readDefinitions().map(d => !!d.server?.devMode?.debug);\n\t\tthis._register(autorunDelta(debugMode, ({ lastValue, newValue }) => {\n\t\t\tif (!!newValue && !objectsEqual(lastValue, newValue)) {\n\t\t\t\trestart();\n\t\t\t}\n\t\t}));\n\n\t\t// 2. Watch for file changes\n\t\tconst watchObs = derivedOpts<string[] | undefined>({ equalsFn: arraysEqual }, reader => {\n\t\t\tconst def = server.readDefinitions().read(reader);\n\t\t\tconst watch = def.server?.devMode?.watch;\n\t\t\treturn typeof watch === 'string' ? [watch] : watch;\n\t\t});\n\n\t\tconst restartScheduler = this._register(new Throttler());\n\n\t\tthis._register(autorun(reader => {\n\t\t\tconst pattern = watchObs.read(reader);\n\t\t\tconst wf = workspaceFolder.read(reader);\n\t\t\tif (!pattern || !wf) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst includes = pattern.filter(p => !p.startsWith('!'));\n\t\t\tconst excludes = pattern.filter(p => p.startsWith('!')).map(p => p.slice(1));\n\t\t\treader.store.add(fileService.watch(wf, { includes, excludes, recursive: true }));\n\n\t\t\tconst includeParse = includes.map(p => glob.parse({ base: wf.fsPath, pattern: p }));\n\t\t\tconst excludeParse = excludes.map(p => glob.parse({ base: wf.fsPath, pattern: p }));\n\t\t\treader.store.add(fileService.onDidFilesChange(e => {\n\t\t\t\tfor (const change of [e.rawAdded, e.rawDeleted, e.rawUpdated]) {\n\t\t\t\t\tfor (const uri of change) {\n\t\t\t\t\t\tif (includeParse.some(i => i(uri.fsPath)) && !excludeParse.some(e => e(uri.fsPath))) {\n\t\t\t\t\t\t\trestartScheduler.queue(restart);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}));\n\t\t}));\n\t}\n}\n\nexport interface IMcpDevModeDebugging {\n\treadonly _serviceBrand: undefined;\n\n\ttransform(definition: McpServerDefinition, launch: McpServerLaunch): Promise<McpServerLaunch>;\n}\n\nexport const IMcpDevModeDebugging = createDecorator<IMcpDevModeDebugging>('mcpDevModeDebugging');\n\nconst DEBUG_HOST = '127.0.0.1';\n\nexport class McpDevModeDebugging implements IMcpDevModeDebugging {\n\tdeclare readonly _serviceBrand: undefined;\n\n\tconstructor(\n\t\t@IDebugService private readonly _debugService: IDebugService,\n\t\t@ICommandService private readonly _commandService: ICommandService,\n\t) { }\n\n\tpublic async transform(definition: McpServerDefinition, launch: McpServerLaunch): Promise<McpServerLaunch> {\n\t\tif (!definition.devMode?.debug || launch.type !== McpServerTransportType.Stdio) {\n\t\t\treturn launch;\n\t\t}\n\n\t\tconst port = await this.getDebugPort();\n\t\tconst name = `MCP: ${definition.label}`; // for debugging\n\t\tconst options: IDebugSessionOptions = { startedByUser: false, suppressDebugView: true };\n\t\tconst commonConfig: Partial<IConfig> = {\n\t\t\tinternalConsoleOptions: 'neverOpen',\n\t\t\tsuppressMultipleSessionWarning: true,\n\t\t};\n\n\t\tswitch (definition.devMode.debug.type) {\n\t\t\tcase 'node': {\n\t\t\t\tif (!/node[0-9]*$/.test(launch.command)) {\n\t\t\t\t\tthrow new Error(localize('mcp.debug.nodeBinReq', 'MCP server must be launched with the \"node\" executable to enable debugging, but was launched with \"{0}\"', launch.command));\n\t\t\t\t}\n\n\t\t\t\t// We intentionally assert types as the DA has additional properties beyong IConfig\n\t\t\t\t// eslint-disable-next-line local/code-no-dangerous-type-assertions\n\t\t\t\tthis._debugService.startDebugging(undefined, {\n\t\t\t\t\ttype: 'pwa-node',\n\t\t\t\t\trequest: 'attach',\n\t\t\t\t\tname,\n\t\t\t\t\tport,\n\t\t\t\t\thost: DEBUG_HOST,\n\t\t\t\t\ttimeout: 30_000,\n\t\t\t\t\tcontinueOnAttach: true,\n\t\t\t\t\t...commonConfig,\n\t\t\t\t} as IConfig, options);\n\t\t\t\treturn { ...launch, args: [`--inspect-brk=${DEBUG_HOST}:${port}`, ...launch.args] };\n\t\t\t}\n\t\t\tcase 'debugpy': {\n\t\t\t\tif (!/python[0-9.]*$/.test(launch.command)) {\n\t\t\t\t\tthrow new Error(localize('mcp.debug.pythonBinReq', 'MCP server must be launched with the \"python\" executable to enable debugging, but was launched with \"{0}\"', launch.command));\n\t\t\t\t}\n\n\t\t\t\tlet command: string | undefined;\n\t\t\t\tlet args = ['--wait-for-client', '--connect', `${DEBUG_HOST}:${port}`, ...launch.args];\n\t\t\t\tif (definition.devMode.debug.debugpyPath) {\n\t\t\t\t\tcommand = definition.devMode.debug.debugpyPath;\n\t\t\t\t} else {\n\t\t\t\t\ttry {\n\t\t\t\t\t\t// The Python debugger exposes a command to get its bundle debugpy module path.  Use that if it's available.\n\t\t\t\t\t\tconst debugPyPath = await this._commandService.executeCommand<string | undefined>('python.getDebugpyPackagePath');\n\t\t\t\t\t\tif (debugPyPath) {\n\t\t\t\t\t\t\tcommand = launch.command;\n\t\t\t\t\t\t\targs = [debugPyPath, ...args];\n\t\t\t\t\t\t}\n\t\t\t\t\t} catch {\n\t\t\t\t\t\t// ignored, no Python debugger extension installed or an error therein\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (!command) {\n\t\t\t\t\tcommand = 'debugpy';\n\t\t\t\t}\n\n\t\t\t\tawait Promise.race([\n\t\t\t\t\t// eslint-disable-next-line local/code-no-dangerous-type-assertions\n\t\t\t\t\tthis._debugService.startDebugging(undefined, {\n\t\t\t\t\t\ttype: 'debugpy',\n\t\t\t\t\t\tname,\n\t\t\t\t\t\trequest: 'attach',\n\t\t\t\t\t\tlisten: {\n\t\t\t\t\t\t\thost: DEBUG_HOST,\n\t\t\t\t\t\t\tport\n\t\t\t\t\t\t},\n\t\t\t\t\t\t...commonConfig,\n\t\t\t\t\t} as IConfig, options),\n\t\t\t\t\tthis.ensureListeningOnPort(port)\n\t\t\t\t]);\n\n\t\t\t\treturn { ...launch, command, args };\n\t\t\t}\n\t\t\tdefault:\n\t\t\t\tassertNever(definition.devMode.debug, `Unknown debug type ${JSON.stringify(definition.devMode.debug)}`);\n\t\t}\n\t}\n\n\tprotected ensureListeningOnPort(port: number): Promise<void> {\n\t\treturn Promise.resolve();\n\t}\n\n\tprotected getDebugPort() {\n\t\treturn Promise.resolve(9230);\n\t}\n}\n"]}