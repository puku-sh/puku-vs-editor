{"version":3,"sources":["vs/workbench/contrib/mcp/browser/mcpWorkbenchService.ts"],"names":[],"mappings":"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","file":"mcpWorkbenchService.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { CancellationToken } from '../../../../base/common/cancellation.js';\nimport { Emitter, Event } from '../../../../base/common/event.js';\nimport { createCommandUri, IMarkdownString, MarkdownString } from '../../../../base/common/htmlContent.js';\nimport { Disposable } from '../../../../base/common/lifecycle.js';\nimport { Schemas } from '../../../../base/common/network.js';\nimport { basename } from '../../../../base/common/resources.js';\nimport { Mutable } from '../../../../base/common/types.js';\nimport { URI } from '../../../../base/common/uri.js';\nimport { localize } from '../../../../nls.js';\nimport { ConfigurationTarget, IConfigurationService } from '../../../../platform/configuration/common/configuration.js';\nimport { IContextKeyService } from '../../../../platform/contextkey/common/contextkey.js';\nimport { IEditorOptions } from '../../../../platform/editor/common/editor.js';\nimport { IFileService } from '../../../../platform/files/common/files.js';\nimport { IInstantiationService } from '../../../../platform/instantiation/common/instantiation.js';\nimport { ILabelService } from '../../../../platform/label/common/label.js';\nimport { ILogService } from '../../../../platform/log/common/log.js';\nimport { IGalleryMcpServer, IMcpGalleryService, IQueryOptions, IInstallableMcpServer, IGalleryMcpServerConfiguration, mcpAccessConfig, McpAccessValue, IAllowedMcpServersService } from '../../../../platform/mcp/common/mcpManagement.js';\nimport { ITelemetryService } from '../../../../platform/telemetry/common/telemetry.js';\nimport { IMcpServerConfiguration, IMcpServerVariable, IMcpStdioServerConfiguration, McpServerType } from '../../../../platform/mcp/common/mcpPlatformTypes.js';\nimport { IProductService } from '../../../../platform/product/common/productService.js';\nimport { StorageScope } from '../../../../platform/storage/common/storage.js';\nimport { IUriIdentityService } from '../../../../platform/uriIdentity/common/uriIdentity.js';\nimport { IURLService } from '../../../../platform/url/common/url.js';\nimport { IUserDataProfilesService } from '../../../../platform/userDataProfile/common/userDataProfile.js';\nimport { IWorkspaceContextService } from '../../../../platform/workspace/common/workspace.js';\nimport { IWorkbenchContribution } from '../../../common/contributions.js';\nimport { MCP_CONFIGURATION_KEY, WORKSPACE_STANDALONE_CONFIGURATIONS } from '../../../services/configuration/common/configuration.js';\nimport { ACTIVE_GROUP, IEditorService } from '../../../services/editor/common/editorService.js';\nimport { IWorkbenchEnvironmentService } from '../../../services/environment/common/environmentService.js';\nimport { DidUninstallWorkbenchMcpServerEvent, IWorkbenchLocalMcpServer, IWorkbenchMcpManagementService, IWorkbenchMcpServerInstallResult, IWorkbencMcpServerInstallOptions, LocalMcpServerScope, REMOTE_USER_CONFIG_ID, USER_CONFIG_ID, WORKSPACE_CONFIG_ID, WORKSPACE_FOLDER_CONFIG_ID_PREFIX } from '../../../services/mcp/common/mcpWorkbenchManagementService.js';\nimport { IRemoteAgentService } from '../../../services/remote/common/remoteAgentService.js';\nimport { mcpConfigurationSection } from '../common/mcpConfiguration.js';\nimport { McpServerInstallData, McpServerInstallClassification } from '../common/mcpServer.js';\nimport { HasInstalledMcpServersContext, IMcpConfigPath, IMcpService, IMcpWorkbenchService, IWorkbenchMcpServer, McpCollectionSortOrder, McpServerEnablementState, McpServerInstallState, McpServerEnablementStatus, McpServersGalleryStatusContext } from '../common/mcpTypes.js';\nimport { McpServerEditorInput } from './mcpServerEditorInput.js';\nimport { IMcpGalleryManifestService } from '../../../../platform/mcp/common/mcpGalleryManifest.js';\nimport { IIterativePager, IIterativePage } from '../../../../base/common/paging.js';\nimport { IExtensionsWorkbenchService } from '../../extensions/common/extensions.js';\nimport { runOnChange } from '../../../../base/common/observable.js';\nimport Severity from '../../../../base/common/severity.js';\nimport { Queue } from '../../../../base/common/async.js';\n\ninterface IMcpServerStateProvider<T> {\n\t(mcpWorkbenchServer: McpWorkbenchServer): T;\n}\n\nclass McpWorkbenchServer implements IWorkbenchMcpServer {\n\n\tconstructor(\n\t\tprivate installStateProvider: IMcpServerStateProvider<McpServerInstallState>,\n\t\tprivate runtimeStateProvider: IMcpServerStateProvider<McpServerEnablementStatus | undefined>,\n\t\tpublic local: IWorkbenchLocalMcpServer | undefined,\n\t\tpublic gallery: IGalleryMcpServer | undefined,\n\t\tpublic readonly installable: IInstallableMcpServer | undefined,\n\t\t@IMcpGalleryService private readonly mcpGalleryService: IMcpGalleryService,\n\t\t@IFileService private readonly fileService: IFileService,\n\t) {\n\t\tthis.local = local;\n\t}\n\n\tget id(): string {\n\t\treturn this.local?.id ?? this.gallery?.name ?? this.installable?.name ?? this.name;\n\t}\n\n\tget name(): string {\n\t\treturn this.gallery?.name ?? this.local?.name ?? this.installable?.name ?? '';\n\t}\n\n\tget label(): string {\n\t\treturn this.gallery?.displayName ?? this.local?.displayName ?? this.local?.name ?? this.installable?.name ?? '';\n\t}\n\n\tget icon(): {\n\t\treadonly dark: string;\n\t\treadonly light: string;\n\t} | undefined {\n\t\treturn this.gallery?.icon ?? this.local?.icon;\n\t}\n\n\tget installState(): McpServerInstallState {\n\t\treturn this.installStateProvider(this);\n\t}\n\n\tget codicon(): string | undefined {\n\t\treturn this.gallery?.codicon ?? this.local?.codicon;\n\t}\n\n\tget publisherDisplayName(): string | undefined {\n\t\treturn this.gallery?.publisherDisplayName ?? this.local?.publisherDisplayName ?? this.gallery?.publisher ?? this.local?.publisher;\n\t}\n\n\tget publisherUrl(): string | undefined {\n\t\treturn this.gallery?.publisherDomain?.link;\n\t}\n\n\tget description(): string {\n\t\treturn this.gallery?.description ?? this.local?.description ?? '';\n\t}\n\n\tget starsCount(): number {\n\t\treturn this.gallery?.starsCount ?? 0;\n\t}\n\n\tget license(): string | undefined {\n\t\treturn this.gallery?.license;\n\t}\n\n\tget repository(): string | undefined {\n\t\treturn this.gallery?.repositoryUrl;\n\t}\n\n\tget config(): IMcpServerConfiguration | undefined {\n\t\treturn this.local?.config ?? this.installable?.config;\n\t}\n\n\tget runtimeStatus(): McpServerEnablementStatus | undefined {\n\t\treturn this.runtimeStateProvider(this);\n\t}\n\n\tget readmeUrl(): URI | undefined {\n\t\treturn this.local?.readmeUrl ?? (this.gallery?.readmeUrl ? URI.parse(this.gallery.readmeUrl) : undefined);\n\t}\n\n\tasync getReadme(token: CancellationToken): Promise<string> {\n\t\tif (this.local?.readmeUrl) {\n\t\t\tconst content = await this.fileService.readFile(this.local.readmeUrl);\n\t\t\treturn content.value.toString();\n\t\t}\n\n\t\tif (this.gallery?.readme) {\n\t\t\treturn this.gallery.readme;\n\t\t}\n\n\t\tif (this.gallery?.readmeUrl) {\n\t\t\treturn this.mcpGalleryService.getReadme(this.gallery, token);\n\t\t}\n\n\t\treturn Promise.reject(new Error('not available'));\n\t}\n\n\tasync getManifest(token: CancellationToken): Promise<IGalleryMcpServerConfiguration> {\n\t\tif (this.local?.manifest) {\n\t\t\treturn this.local.manifest;\n\t\t}\n\n\t\tif (this.gallery) {\n\t\t\treturn this.gallery.configuration;\n\t\t}\n\n\t\tthrow new Error('No manifest available');\n\t}\n\n}\n\nexport class McpWorkbenchService extends Disposable implements IMcpWorkbenchService {\n\n\t_serviceBrand: undefined;\n\n\tprivate installing: McpWorkbenchServer[] = [];\n\tprivate uninstalling: McpWorkbenchServer[] = [];\n\n\tprivate _local: McpWorkbenchServer[] = [];\n\tget local(): readonly McpWorkbenchServer[] { return [...this._local]; }\n\n\tprivate readonly _onChange = this._register(new Emitter<IWorkbenchMcpServer | undefined>());\n\treadonly onChange = this._onChange.event;\n\n\tprivate readonly _onReset = this._register(new Emitter<void>());\n\treadonly onReset = this._onReset.event;\n\n\tconstructor(\n\t\t@IMcpGalleryManifestService mcpGalleryManifestService: IMcpGalleryManifestService,\n\t\t@IMcpGalleryService private readonly mcpGalleryService: IMcpGalleryService,\n\t\t@IWorkbenchMcpManagementService private readonly mcpManagementService: IWorkbenchMcpManagementService,\n\t\t@IEditorService private readonly editorService: IEditorService,\n\t\t@IUserDataProfilesService private readonly userDataProfilesService: IUserDataProfilesService,\n\t\t@IUriIdentityService private readonly uriIdentityService: IUriIdentityService,\n\t\t@IWorkspaceContextService private readonly workspaceService: IWorkspaceContextService,\n\t\t@IWorkbenchEnvironmentService private readonly environmentService: IWorkbenchEnvironmentService,\n\t\t@ILabelService private readonly labelService: ILabelService,\n\t\t@IProductService private readonly productService: IProductService,\n\t\t@IRemoteAgentService private readonly remoteAgentService: IRemoteAgentService,\n\t\t@IConfigurationService private readonly configurationService: IConfigurationService,\n\t\t@IInstantiationService private readonly instantiationService: IInstantiationService,\n\t\t@ITelemetryService private readonly telemetryService: ITelemetryService,\n\t\t@ILogService private readonly logService: ILogService,\n\t\t@IExtensionsWorkbenchService private readonly extensionsWorkbenchService: IExtensionsWorkbenchService,\n\t\t@IAllowedMcpServersService private readonly allowedMcpServersService: IAllowedMcpServersService,\n\t\t@IMcpService private readonly mcpService: IMcpService,\n\t\t@IURLService urlService: IURLService,\n\t) {\n\t\tsuper();\n\t\tthis._register(this.mcpManagementService.onDidInstallMcpServersInCurrentProfile(e => this.onDidInstallMcpServers(e)));\n\t\tthis._register(this.mcpManagementService.onDidUpdateMcpServersInCurrentProfile(e => this.onDidUpdateMcpServers(e)));\n\t\tthis._register(this.mcpManagementService.onDidUninstallMcpServerInCurrentProfile(e => this.onDidUninstallMcpServer(e)));\n\t\tthis._register(this.mcpManagementService.onDidChangeProfile(e => this.onDidChangeProfile()));\n\t\tthis.queryLocal().then(() => {\n\t\t\tif (this._store.isDisposed) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst queue = this._register(new Queue());\n\t\t\tthis._register(mcpGalleryManifestService.onDidChangeMcpGalleryManifest(e => queue.queue(() => this.syncInstalledMcpServers())));\n\t\t\tqueue.queue(() => this.syncInstalledMcpServers());\n\t\t});\n\t\turlService.registerHandler(this);\n\t\tthis._register(this.configurationService.onDidChangeConfiguration(e => {\n\t\t\tif (e.affectsConfiguration(mcpAccessConfig)) {\n\t\t\t\tthis._onChange.fire(undefined);\n\t\t\t}\n\t\t}));\n\t\tthis._register(this.allowedMcpServersService.onDidChangeAllowedMcpServers(() => {\n\t\t\tthis._local = this.sort(this._local);\n\t\t\tthis._onChange.fire(undefined);\n\t\t}));\n\t\tthis._register(runOnChange(mcpService.servers, () => {\n\t\t\tthis._local = this.sort(this._local);\n\t\t\tthis._onChange.fire(undefined);\n\t\t}));\n\t}\n\n\tprivate async onDidChangeProfile() {\n\t\tawait this.queryLocal();\n\t\tthis._onChange.fire(undefined);\n\t\tthis._onReset.fire();\n\t}\n\n\tprivate areSameMcpServers(a: { name: string; scope: LocalMcpServerScope } | undefined, b: { name: string; scope: LocalMcpServerScope } | undefined): boolean {\n\t\tif (a === b) {\n\t\t\treturn true;\n\t\t}\n\t\tif (!a || !b) {\n\t\t\treturn false;\n\t\t}\n\t\treturn a.name === b.name && a.scope === b.scope;\n\t}\n\n\tprivate onDidUninstallMcpServer(e: DidUninstallWorkbenchMcpServerEvent) {\n\t\tif (e.error) {\n\t\t\treturn;\n\t\t}\n\t\tconst uninstalled = this._local.find(server => this.areSameMcpServers(server.local, e));\n\t\tif (uninstalled) {\n\t\t\tthis._local = this._local.filter(server => server !== uninstalled);\n\t\t\tthis._onChange.fire(uninstalled);\n\t\t}\n\t}\n\n\tprivate onDidInstallMcpServers(e: readonly IWorkbenchMcpServerInstallResult[]) {\n\t\tconst servers: IWorkbenchMcpServer[] = [];\n\t\tfor (const { local, source, name } of e) {\n\t\t\tlet server = this.installing.find(server => server.local && local ? this.areSameMcpServers(server.local, local) : server.name === name);\n\t\t\tthis.installing = server ? this.installing.filter(e => e !== server) : this.installing;\n\t\t\tif (local) {\n\t\t\t\tif (server) {\n\t\t\t\t\tserver.local = local;\n\t\t\t\t} else {\n\t\t\t\t\tserver = this.instantiationService.createInstance(McpWorkbenchServer, e => this.getInstallState(e), e => this.getRuntimeStatus(e), local, source, undefined);\n\t\t\t\t}\n\t\t\t\tif (!local.galleryUrl) {\n\t\t\t\t\tserver.gallery = undefined;\n\t\t\t\t}\n\t\t\t\tthis._local = this._local.filter(server => !this.areSameMcpServers(server.local, local));\n\t\t\t\tthis.addServer(server);\n\t\t\t}\n\t\t\tthis._onChange.fire(server);\n\t\t}\n\t\tif (servers.some(server => server.local?.galleryUrl && !server.gallery)) {\n\t\t\tthis.syncInstalledMcpServers();\n\t\t}\n\t}\n\n\tprivate onDidUpdateMcpServers(e: readonly IWorkbenchMcpServerInstallResult[]) {\n\t\tfor (const result of e) {\n\t\t\tif (!result.local) {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tconst serverIndex = this._local.findIndex(server => this.areSameMcpServers(server.local, result.local));\n\t\t\tlet server: McpWorkbenchServer;\n\t\t\tif (serverIndex !== -1) {\n\t\t\t\tthis._local[serverIndex].local = result.local;\n\t\t\t\tserver = this._local[serverIndex];\n\t\t\t} else {\n\t\t\t\tserver = this.instantiationService.createInstance(McpWorkbenchServer, e => this.getInstallState(e), e => this.getRuntimeStatus(e), result.local, result.source, undefined);\n\t\t\t\tthis.addServer(server);\n\t\t\t}\n\t\t\tthis._onChange.fire(server);\n\t\t}\n\t}\n\n\tprivate fromGallery(gallery: IGalleryMcpServer): IWorkbenchMcpServer | undefined {\n\t\tfor (const local of this._local) {\n\t\t\tif (local.name === gallery.name) {\n\t\t\t\tlocal.gallery = gallery;\n\t\t\t\treturn local;\n\t\t\t}\n\t\t}\n\t\treturn undefined;\n\t}\n\n\tprivate async syncInstalledMcpServers(): Promise<void> {\n\t\tconst infos: { name: string; id?: string }[] = [];\n\n\t\tfor (const installed of this.local) {\n\t\t\tif (installed.local?.source !== 'gallery') {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tif (installed.local.galleryUrl) {\n\t\t\t\tinfos.push({ name: installed.local.name, id: installed.local.galleryId });\n\t\t\t}\n\t\t}\n\n\t\tif (infos.length) {\n\t\t\tconst galleryServers = await this.mcpGalleryService.getMcpServersFromGallery(infos);\n\t\t\tawait this.syncInstalledMcpServersWithGallery(galleryServers);\n\t\t}\n\t}\n\n\tprivate async syncInstalledMcpServersWithGallery(gallery: IGalleryMcpServer[]): Promise<void> {\n\t\tconst galleryMap = new Map<string, IGalleryMcpServer>(gallery.map(server => [server.name, server]));\n\t\tfor (const mcpServer of this.local) {\n\t\t\tif (!mcpServer.local) {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tconst key = mcpServer.local.name;\n\t\t\tconst gallery = key ? galleryMap.get(key) : undefined;\n\n\t\t\tif (!gallery || gallery.galleryUrl !== mcpServer.local.galleryUrl) {\n\t\t\t\tif (mcpServer.gallery) {\n\t\t\t\t\tmcpServer.gallery = undefined;\n\t\t\t\t\tthis._onChange.fire(mcpServer);\n\t\t\t\t}\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tmcpServer.gallery = gallery;\n\t\t\tif (!mcpServer.local.manifest) {\n\t\t\t\tmcpServer.local = await this.mcpManagementService.updateMetadata(mcpServer.local, gallery);\n\t\t\t}\n\t\t\tthis._onChange.fire(mcpServer);\n\t\t}\n\t}\n\n\tasync queryGallery(options?: IQueryOptions, token?: CancellationToken): Promise<IIterativePager<IWorkbenchMcpServer>> {\n\t\tif (!this.mcpGalleryService.isEnabled()) {\n\t\t\treturn {\n\t\t\t\tfirstPage: { items: [], hasMore: false },\n\t\t\t\tgetNextPage: async () => ({ items: [], hasMore: false })\n\t\t\t};\n\t\t}\n\t\tconst pager = await this.mcpGalleryService.query(options, token);\n\n\t\tconst mapPage = (page: IIterativePage<IGalleryMcpServer>): IIterativePage<IWorkbenchMcpServer> => ({\n\t\t\titems: page.items.map(gallery => this.fromGallery(gallery) ?? this.instantiationService.createInstance(McpWorkbenchServer, e => this.getInstallState(e), e => this.getRuntimeStatus(e), undefined, gallery, undefined)),\n\t\t\thasMore: page.hasMore\n\t\t});\n\n\t\treturn {\n\t\t\tfirstPage: mapPage(pager.firstPage),\n\t\t\tgetNextPage: async (ct) => {\n\t\t\t\tconst nextPage = await pager.getNextPage(ct);\n\t\t\t\treturn mapPage(nextPage);\n\t\t\t}\n\t\t};\n\t}\n\n\tasync queryLocal(): Promise<IWorkbenchMcpServer[]> {\n\t\tconst installed = await this.mcpManagementService.getInstalled();\n\t\tthis._local = this.sort(installed.map(i => {\n\t\t\tconst existing = this._local.find(local => local.id === i.id);\n\t\t\tconst local = existing ?? this.instantiationService.createInstance(McpWorkbenchServer, e => this.getInstallState(e), e => this.getRuntimeStatus(e), undefined, undefined, undefined);\n\t\t\tlocal.local = i;\n\t\t\treturn local;\n\t\t}));\n\t\tthis._onChange.fire(undefined);\n\t\treturn [...this.local];\n\t}\n\n\tprivate addServer(server: McpWorkbenchServer): void {\n\t\tthis._local.push(server);\n\t\tthis._local = this.sort(this._local);\n\t}\n\n\tprivate sort(local: McpWorkbenchServer[]): McpWorkbenchServer[] {\n\t\treturn local.sort((a, b) => {\n\t\t\tif (a.name === b.name) {\n\t\t\t\tif (!a.runtimeStatus || a.runtimeStatus.state === McpServerEnablementState.Enabled) {\n\t\t\t\t\treturn -1;\n\t\t\t\t}\n\t\t\t\tif (!b.runtimeStatus || b.runtimeStatus.state === McpServerEnablementState.Enabled) {\n\t\t\t\t\treturn 1;\n\t\t\t\t}\n\t\t\t\treturn 0;\n\t\t\t}\n\t\t\treturn a.name.localeCompare(b.name);\n\t\t});\n\t}\n\n\tgetEnabledLocalMcpServers(): IWorkbenchLocalMcpServer[] {\n\t\tconst result = new Map<string, IWorkbenchLocalMcpServer>();\n\t\tconst userRemote: IWorkbenchLocalMcpServer[] = [];\n\t\tconst workspace: IWorkbenchLocalMcpServer[] = [];\n\n\t\tfor (const server of this.local) {\n\t\t\tconst enablementStatus = this.getEnablementStatus(server);\n\t\t\tif (enablementStatus && enablementStatus.state !== McpServerEnablementState.Enabled) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif (server.local?.scope === LocalMcpServerScope.User) {\n\t\t\t\tresult.set(server.name, server.local);\n\t\t\t} else if (server.local?.scope === LocalMcpServerScope.RemoteUser) {\n\t\t\t\tuserRemote.push(server.local);\n\t\t\t} else if (server.local?.scope === LocalMcpServerScope.Workspace) {\n\t\t\t\tworkspace.push(server.local);\n\t\t\t}\n\t\t}\n\n\t\tfor (const server of userRemote) {\n\t\t\tconst existing = result.get(server.name);\n\t\t\tif (existing) {\n\t\t\t\tthis.logService.warn(localize('overwriting', \"Overwriting mcp server '{0}' from {1} with {2}.\", server.name, server.mcpResource.path, existing.mcpResource.path));\n\t\t\t}\n\t\t\tresult.set(server.name, server);\n\t\t}\n\n\t\tfor (const server of workspace) {\n\t\t\tconst existing = result.get(server.name);\n\t\t\tif (existing) {\n\t\t\t\tthis.logService.warn(localize('overwriting', \"Overwriting mcp server '{0}' from {1} with {2}.\", server.name, server.mcpResource.path, existing.mcpResource.path));\n\t\t\t}\n\t\t\tresult.set(server.name, server);\n\t\t}\n\n\t\treturn [...result.values()];\n\t}\n\n\tcanInstall(mcpServer: IWorkbenchMcpServer): true | IMarkdownString {\n\t\tif (!(mcpServer instanceof McpWorkbenchServer)) {\n\t\t\treturn new MarkdownString().appendText(localize('not an extension', \"The provided object is not an mcp server.\"));\n\t\t}\n\n\t\tif (mcpServer.gallery) {\n\t\t\tconst result = this.mcpManagementService.canInstall(mcpServer.gallery);\n\t\t\tif (result === true) {\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\treturn result;\n\t\t}\n\n\t\tif (mcpServer.installable) {\n\t\t\tconst result = this.mcpManagementService.canInstall(mcpServer.installable);\n\t\t\tif (result === true) {\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\treturn result;\n\t\t}\n\n\n\t\treturn new MarkdownString().appendText(localize('cannot be installed', \"Cannot install the '{0}' MCP Server because it is not available in this setup.\", mcpServer.label));\n\t}\n\n\tasync install(server: IWorkbenchMcpServer, installOptions?: IWorkbencMcpServerInstallOptions): Promise<IWorkbenchMcpServer> {\n\t\tif (!(server instanceof McpWorkbenchServer)) {\n\t\t\tthrow new Error('Invalid server instance');\n\t\t}\n\n\t\tif (server.installable) {\n\t\t\tconst installable = server.installable;\n\t\t\treturn this.doInstall(server, () => this.mcpManagementService.install(installable, installOptions));\n\t\t}\n\n\t\tif (server.gallery) {\n\t\t\tconst gallery = server.gallery;\n\t\t\treturn this.doInstall(server, () => this.mcpManagementService.installFromGallery(gallery, installOptions));\n\t\t}\n\n\t\tthrow new Error('No installable server found');\n\t}\n\n\tasync uninstall(server: IWorkbenchMcpServer): Promise<void> {\n\t\tif (!server.local) {\n\t\t\tthrow new Error('Local server is missing');\n\t\t}\n\t\tawait this.mcpManagementService.uninstall(server.local);\n\t}\n\n\tprivate async doInstall(server: McpWorkbenchServer, installTask: () => Promise<IWorkbenchLocalMcpServer>): Promise<IWorkbenchMcpServer> {\n\t\tconst source = server.gallery ? 'gallery' : 'local';\n\t\tconst serverName = server.name;\n\t\t// Check for inputs in installable config or if it comes from handleURL with inputs\n\t\tconst hasInputs = !!(server.installable?.inputs && server.installable.inputs.length > 0);\n\n\t\tthis.installing.push(server);\n\t\tthis._onChange.fire(server);\n\n\t\ttry {\n\t\t\tawait installTask();\n\t\t\tconst result = await this.waitAndGetInstalledMcpServer(server);\n\n\t\t\t// Track successful installation\n\t\t\tthis.telemetryService.publicLog2<McpServerInstallData, McpServerInstallClassification>('mcp/serverInstall', {\n\t\t\t\tserverName,\n\t\t\t\tsource,\n\t\t\t\tscope: result.local?.scope ?? 'unknown',\n\t\t\t\tsuccess: true,\n\t\t\t\thasInputs\n\t\t\t});\n\n\t\t\treturn result;\n\t\t} catch (error) {\n\t\t\t// Track failed installation\n\t\t\tthis.telemetryService.publicLog2<McpServerInstallData, McpServerInstallClassification>('mcp/serverInstall', {\n\t\t\t\tserverName,\n\t\t\t\tsource,\n\t\t\t\tscope: 'unknown',\n\t\t\t\tsuccess: false,\n\t\t\t\terror: error instanceof Error ? error.message : String(error),\n\t\t\t\thasInputs\n\t\t\t});\n\n\t\t\tthrow error;\n\t\t} finally {\n\t\t\tif (this.installing.includes(server)) {\n\t\t\t\tthis.installing.splice(this.installing.indexOf(server), 1);\n\t\t\t\tthis._onChange.fire(server);\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate async waitAndGetInstalledMcpServer(server: McpWorkbenchServer): Promise<IWorkbenchMcpServer> {\n\t\tlet installed = this.local.find(local => local.name === server.name);\n\t\tif (!installed) {\n\t\t\tawait Event.toPromise(Event.filter(this.onChange, e => !!e && this.local.some(local => local.name === server.name)));\n\t\t}\n\t\tinstalled = this.local.find(local => local.name === server.name);\n\t\tif (!installed) {\n\t\t\t// This should not happen\n\t\t\tthrow new Error('Extension should have been installed');\n\t\t}\n\t\treturn installed;\n\t}\n\n\tgetMcpConfigPath(localMcpServer: IWorkbenchLocalMcpServer): IMcpConfigPath | undefined;\n\tgetMcpConfigPath(mcpResource: URI): Promise<IMcpConfigPath | undefined>;\n\tgetMcpConfigPath(arg: URI | IWorkbenchLocalMcpServer): Promise<IMcpConfigPath | undefined> | IMcpConfigPath | undefined {\n\t\tif (arg instanceof URI) {\n\t\t\tconst mcpResource = arg;\n\t\t\tfor (const profile of this.userDataProfilesService.profiles) {\n\t\t\t\tif (this.uriIdentityService.extUri.isEqual(profile.mcpResource, mcpResource)) {\n\t\t\t\t\treturn this.getUserMcpConfigPath(mcpResource);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn this.remoteAgentService.getEnvironment().then(remoteEnvironment => {\n\t\t\t\tif (remoteEnvironment && this.uriIdentityService.extUri.isEqual(remoteEnvironment.mcpResource, mcpResource)) {\n\t\t\t\t\treturn this.getRemoteMcpConfigPath(mcpResource);\n\t\t\t\t}\n\t\t\t\treturn this.getWorkspaceMcpConfigPath(mcpResource);\n\t\t\t});\n\t\t}\n\n\t\tif (arg.scope === LocalMcpServerScope.User) {\n\t\t\treturn this.getUserMcpConfigPath(arg.mcpResource);\n\t\t}\n\n\t\tif (arg.scope === LocalMcpServerScope.Workspace) {\n\t\t\treturn this.getWorkspaceMcpConfigPath(arg.mcpResource);\n\t\t}\n\n\t\tif (arg.scope === LocalMcpServerScope.RemoteUser) {\n\t\t\treturn this.getRemoteMcpConfigPath(arg.mcpResource);\n\t\t}\n\n\t\treturn undefined;\n\t}\n\n\tprivate getUserMcpConfigPath(mcpResource: URI): IMcpConfigPath {\n\t\treturn {\n\t\t\tid: USER_CONFIG_ID,\n\t\t\tkey: 'userLocalValue',\n\t\t\ttarget: ConfigurationTarget.USER_LOCAL,\n\t\t\tlabel: localize('mcp.configuration.userLocalValue', 'Global in {0}', this.productService.nameShort),\n\t\t\tscope: StorageScope.PROFILE,\n\t\t\torder: McpCollectionSortOrder.User,\n\t\t\turi: mcpResource,\n\t\t\tsection: [],\n\t\t};\n\t}\n\n\tprivate getRemoteMcpConfigPath(mcpResource: URI): IMcpConfigPath {\n\t\treturn {\n\t\t\tid: REMOTE_USER_CONFIG_ID,\n\t\t\tkey: 'userRemoteValue',\n\t\t\ttarget: ConfigurationTarget.USER_REMOTE,\n\t\t\tlabel: this.environmentService.remoteAuthority ? this.labelService.getHostLabel(Schemas.vscodeRemote, this.environmentService.remoteAuthority) : 'Remote',\n\t\t\tscope: StorageScope.PROFILE,\n\t\t\torder: McpCollectionSortOrder.User + McpCollectionSortOrder.RemoteBoost,\n\t\t\tremoteAuthority: this.environmentService.remoteAuthority,\n\t\t\turi: mcpResource,\n\t\t\tsection: [],\n\t\t};\n\t}\n\n\tprivate getWorkspaceMcpConfigPath(mcpResource: URI): IMcpConfigPath | undefined {\n\t\tconst workspace = this.workspaceService.getWorkspace();\n\t\tif (workspace.configuration && this.uriIdentityService.extUri.isEqual(workspace.configuration, mcpResource)) {\n\t\t\treturn {\n\t\t\t\tid: WORKSPACE_CONFIG_ID,\n\t\t\t\tkey: 'workspaceValue',\n\t\t\t\ttarget: ConfigurationTarget.WORKSPACE,\n\t\t\t\tlabel: basename(mcpResource),\n\t\t\t\tscope: StorageScope.WORKSPACE,\n\t\t\t\torder: McpCollectionSortOrder.Workspace,\n\t\t\t\tremoteAuthority: this.environmentService.remoteAuthority,\n\t\t\t\turi: mcpResource,\n\t\t\t\tsection: ['settings', mcpConfigurationSection],\n\t\t\t};\n\t\t}\n\n\t\tconst workspaceFolders = workspace.folders;\n\t\tfor (let index = 0; index < workspaceFolders.length; index++) {\n\t\t\tconst workspaceFolder = workspaceFolders[index];\n\t\t\tif (this.uriIdentityService.extUri.isEqual(this.uriIdentityService.extUri.joinPath(workspaceFolder.uri, WORKSPACE_STANDALONE_CONFIGURATIONS[MCP_CONFIGURATION_KEY]), mcpResource)) {\n\t\t\t\treturn {\n\t\t\t\t\tid: `${WORKSPACE_FOLDER_CONFIG_ID_PREFIX}${index}`,\n\t\t\t\t\tkey: 'workspaceFolderValue',\n\t\t\t\t\ttarget: ConfigurationTarget.WORKSPACE_FOLDER,\n\t\t\t\t\tlabel: `${workspaceFolder.name}/.vscode/mcp.json`,\n\t\t\t\t\tscope: StorageScope.WORKSPACE,\n\t\t\t\t\tremoteAuthority: this.environmentService.remoteAuthority,\n\t\t\t\t\torder: McpCollectionSortOrder.WorkspaceFolder,\n\t\t\t\t\turi: mcpResource,\n\t\t\t\t\tworkspaceFolder,\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\n\t\treturn undefined;\n\t}\n\n\tasync handleURL(uri: URI): Promise<boolean> {\n\t\tif (uri.path === 'mcp/install') {\n\t\t\treturn this.handleMcpInstallUri(uri);\n\t\t}\n\t\tif (uri.path.startsWith('mcp/by-name/')) {\n\t\t\tconst mcpServerName = uri.path.substring('mcp/by-name/'.length);\n\t\t\tif (mcpServerName) {\n\t\t\t\treturn this.handleMcpServerByName(mcpServerName);\n\t\t\t}\n\t\t}\n\t\tif (uri.path.startsWith('mcp/')) {\n\t\t\tconst mcpServerUrl = uri.path.substring(4);\n\t\t\tif (mcpServerUrl) {\n\t\t\t\treturn this.handleMcpServerUrl(`${Schemas.https}://${mcpServerUrl}`);\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t}\n\n\tprivate async handleMcpInstallUri(uri: URI): Promise<boolean> {\n\t\tlet parsed: IMcpServerConfiguration & { name: string; inputs?: IMcpServerVariable[]; gallery?: boolean };\n\t\ttry {\n\t\t\tparsed = JSON.parse(decodeURIComponent(uri.query));\n\t\t} catch (e) {\n\t\t\treturn false;\n\t\t}\n\n\t\ttry {\n\t\t\tconst { name, inputs, gallery, ...config } = parsed;\n\t\t\tif (config.type === undefined) {\n\t\t\t\t(<Mutable<IMcpServerConfiguration>>config).type = (<IMcpStdioServerConfiguration>parsed).command ? McpServerType.LOCAL : McpServerType.REMOTE;\n\t\t\t}\n\t\t\tthis.open(this.instantiationService.createInstance(McpWorkbenchServer, e => this.getInstallState(e), e => this.getRuntimeStatus(e), undefined, undefined, { name, config, inputs }));\n\t\t} catch (e) {\n\t\t\t// ignore\n\t\t}\n\t\treturn true;\n\t}\n\n\tprivate async handleMcpServerUrl(url: string): Promise<boolean> {\n\t\ttry {\n\t\t\tconst gallery = await this.mcpGalleryService.getMcpServer(url);\n\t\t\tif (!gallery) {\n\t\t\t\tthis.logService.info(`MCP server '${url}' not found`);\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\tconst local = this.local.find(e => e.name === gallery.name) ?? this.instantiationService.createInstance(McpWorkbenchServer, e => this.getInstallState(e), e => this.getRuntimeStatus(e), undefined, gallery, undefined);\n\t\t\tthis.open(local);\n\t\t} catch (e) {\n\t\t\t// ignore\n\t\t\tthis.logService.error(e);\n\t\t}\n\t\treturn true;\n\t}\n\n\tprivate async handleMcpServerByName(name: string): Promise<boolean> {\n\t\ttry {\n\t\t\tconst [gallery] = await this.mcpGalleryService.getMcpServersFromGallery([{ name }]);\n\t\t\tif (!gallery) {\n\t\t\t\tthis.logService.info(`MCP server '${name}' not found`);\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\tconst local = this.local.find(e => e.name === gallery.name) ?? this.instantiationService.createInstance(McpWorkbenchServer, e => this.getInstallState(e), e => this.getRuntimeStatus(e), undefined, gallery, undefined);\n\t\t\tthis.open(local);\n\t\t} catch (e) {\n\t\t\t// ignore\n\t\t\tthis.logService.error(e);\n\t\t}\n\t\treturn true;\n\t}\n\n\tasync openSearch(searchValue: string, preserveFoucs?: boolean): Promise<void> {\n\t\tawait this.extensionsWorkbenchService.openSearch(`@mcp ${searchValue}`, preserveFoucs);\n\t}\n\n\tasync open(extension: IWorkbenchMcpServer, options?: IEditorOptions): Promise<void> {\n\t\tawait this.editorService.openEditor(this.instantiationService.createInstance(McpServerEditorInput, extension), options, ACTIVE_GROUP);\n\t}\n\n\tprivate getInstallState(extension: McpWorkbenchServer): McpServerInstallState {\n\t\tif (this.installing.some(i => i.name === extension.name)) {\n\t\t\treturn McpServerInstallState.Installing;\n\t\t}\n\t\tif (this.uninstalling.some(e => e.name === extension.name)) {\n\t\t\treturn McpServerInstallState.Uninstalling;\n\t\t}\n\t\tconst local = this.local.find(e => e === extension);\n\t\treturn local ? McpServerInstallState.Installed : McpServerInstallState.Uninstalled;\n\t}\n\n\tprivate getRuntimeStatus(mcpServer: McpWorkbenchServer): McpServerEnablementStatus | undefined {\n\t\tconst enablementStatus = this.getEnablementStatus(mcpServer);\n\n\t\tif (enablementStatus) {\n\t\t\treturn enablementStatus;\n\t\t}\n\n\t\tif (!this.mcpService.servers.get().find(s => s.definition.id === mcpServer.id)) {\n\t\t\treturn { state: McpServerEnablementState.Disabled };\n\t\t}\n\n\t\treturn undefined;\n\t}\n\n\tprivate getEnablementStatus(mcpServer: McpWorkbenchServer): McpServerEnablementStatus | undefined {\n\t\tif (!mcpServer.local) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\tconst settingsCommandLink = createCommandUri('workbench.action.openSettings', { query: `@id:${mcpAccessConfig}` }).toString();\n\t\tconst accessValue = this.configurationService.getValue(mcpAccessConfig);\n\n\t\tif (accessValue === McpAccessValue.None) {\n\t\t\treturn {\n\t\t\t\tstate: McpServerEnablementState.DisabledByAccess,\n\t\t\t\tmessage: {\n\t\t\t\t\tseverity: Severity.Warning,\n\t\t\t\t\ttext: new MarkdownString(localize('disabled - all not allowed', \"This MCP Server is disabled because MCP servers are configured to be disabled in the Editor. Please check your [settings]({0}).\", settingsCommandLink))\n\t\t\t\t}\n\t\t\t};\n\n\t\t}\n\n\t\tif (accessValue === McpAccessValue.Registry) {\n\t\t\tif (!mcpServer.gallery) {\n\t\t\t\treturn {\n\t\t\t\t\tstate: McpServerEnablementState.DisabledByAccess,\n\t\t\t\t\tmessage: {\n\t\t\t\t\t\tseverity: Severity.Warning,\n\t\t\t\t\t\ttext: new MarkdownString(localize('disabled - some not allowed', \"This MCP Server is disabled because it is configured to be disabled in the Editor. Please check your [settings]({0}).\", settingsCommandLink))\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tconst remoteUrl = mcpServer.local.config.type === McpServerType.REMOTE && mcpServer.local.config.url;\n\t\t\tif (remoteUrl && !mcpServer.gallery.configuration.remotes?.some(remote => remote.url === remoteUrl)) {\n\t\t\t\treturn {\n\t\t\t\t\tstate: McpServerEnablementState.DisabledByAccess,\n\t\t\t\t\tmessage: {\n\t\t\t\t\t\tseverity: Severity.Warning,\n\t\t\t\t\t\ttext: new MarkdownString(localize('disabled - some not allowed', \"This MCP Server is disabled because it is configured to be disabled in the Editor. Please check your [settings]({0}).\", settingsCommandLink))\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\n\t\treturn undefined;\n\t}\n\n}\n\nexport class MCPContextsInitialisation extends Disposable implements IWorkbenchContribution {\n\n\tstatic ID = 'workbench.mcp.contexts.initialisation';\n\n\tconstructor(\n\t\t@IMcpWorkbenchService mcpWorkbenchService: IMcpWorkbenchService,\n\t\t@IMcpGalleryManifestService mcpGalleryManifestService: IMcpGalleryManifestService,\n\t\t@IContextKeyService contextKeyService: IContextKeyService,\n\t) {\n\t\tsuper();\n\n\t\tconst mcpServersGalleryStatus = McpServersGalleryStatusContext.bindTo(contextKeyService);\n\t\tmcpServersGalleryStatus.set(mcpGalleryManifestService.mcpGalleryManifestStatus);\n\t\tthis._register(mcpGalleryManifestService.onDidChangeMcpGalleryManifestStatus(status => mcpServersGalleryStatus.set(status)));\n\n\t\tconst hasInstalledMcpServersContextKey = HasInstalledMcpServersContext.bindTo(contextKeyService);\n\t\tmcpWorkbenchService.queryLocal().finally(() => {\n\t\t\thasInstalledMcpServersContextKey.set(mcpWorkbenchService.local.length > 0);\n\t\t\tthis._register(mcpWorkbenchService.onChange(() => hasInstalledMcpServersContextKey.set(mcpWorkbenchService.local.length > 0)));\n\t\t});\n\t}\n}\n"]}