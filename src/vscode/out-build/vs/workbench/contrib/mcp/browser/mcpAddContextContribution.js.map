{"version":3,"sources":["vs/workbench/contrib/mcp/browser/mcpAddContextContribution.ts"],"names":[],"mappings":"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","file":"mcpAddContextContribution.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { CancellationToken } from '../../../../base/common/cancellation.js';\nimport { Codicon } from '../../../../base/common/codicons.js';\nimport { Disposable, MutableDisposable } from '../../../../base/common/lifecycle.js';\nimport { autorun, derived } from '../../../../base/common/observable.js';\nimport { localize } from '../../../../nls.js';\nimport { IInstantiationService } from '../../../../platform/instantiation/common/instantiation.js';\nimport { IWorkbenchContribution } from '../../../common/contributions.js';\nimport { ChatContextPick, IChatContextPickService } from '../../chat/browser/chatContextPickService.js';\nimport { IMcpService, McpCapability } from '../common/mcpTypes.js';\nimport { McpResourcePickHelper } from './mcpResourceQuickAccess.js';\n\nexport class McpAddContextContribution extends Disposable implements IWorkbenchContribution {\n\tprivate readonly _addContextMenu = this._register(new MutableDisposable());\n\tconstructor(\n\t\t@IChatContextPickService private readonly _chatContextPickService: IChatContextPickService,\n\t\t@IInstantiationService private readonly _instantiationService: IInstantiationService,\n\t\t@IMcpService mcpService: IMcpService\n\t) {\n\t\tsuper();\n\n\t\tconst hasServersWithResources = derived(reader => {\n\t\t\tlet enabled = false;\n\t\t\tfor (const server of mcpService.servers.read(reader)) {\n\t\t\t\tconst cap = server.capabilities.read(undefined);\n\t\t\t\tif (cap === undefined) {\n\t\t\t\t\tenabled = true; // until we know more\n\t\t\t\t} else if (cap & McpCapability.Resources) {\n\t\t\t\t\tenabled = true;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn enabled;\n\t\t});\n\n\t\tthis._register(autorun(reader => {\n\t\t\tconst enabled = hasServersWithResources.read(reader);\n\t\t\tif (enabled && !this._addContextMenu.value) {\n\t\t\t\tthis._registerAddContextMenu();\n\t\t\t} else {\n\t\t\t\tthis._addContextMenu.clear();\n\t\t\t}\n\t\t}));\n\t}\n\n\tprivate _registerAddContextMenu() {\n\t\tthis._addContextMenu.value = this._chatContextPickService.registerChatContextItem({\n\t\t\ttype: 'pickerPick',\n\t\t\tlabel: localize('mcp.addContext', \"MCP Resources...\"),\n\t\t\ticon: Codicon.mcp,\n\t\t\tisEnabled(widget) {\n\t\t\t\treturn !!widget.attachmentCapabilities.supportsMCPAttachments;\n\t\t\t},\n\t\t\tasPicker: () => {\n\t\t\t\tconst helper = this._instantiationService.createInstance(McpResourcePickHelper);\n\t\t\t\treturn {\n\t\t\t\t\tplaceholder: localize('mcp.addContext.placeholder', \"Select MCP Resource...\"),\n\t\t\t\t\tpicks: (_query, token) => this._getResourcePicks(token, helper),\n\t\t\t\t\tgoBack: () => {\n\t\t\t\t\t\treturn helper.navigateBack();\n\t\t\t\t\t},\n\t\t\t\t\tdispose: () => {\n\t\t\t\t\t\thelper.dispose();\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t},\n\t\t});\n\t}\n\n\tprivate _getResourcePicks(token: CancellationToken, helper: McpResourcePickHelper) {\n\t\tconst picksObservable = helper.getPicks(token);\n\n\t\treturn derived(this, reader => {\n\n\t\t\tconst pickItems = picksObservable.read(reader);\n\t\t\tconst picks: ChatContextPick[] = [];\n\n\t\t\tfor (const [server, resources] of pickItems.picks) {\n\t\t\t\tif (resources.length === 0) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tpicks.push(McpResourcePickHelper.sep(server));\n\t\t\t\tfor (const resource of resources) {\n\t\t\t\t\tpicks.push({\n\t\t\t\t\t\t...McpResourcePickHelper.item(resource),\n\t\t\t\t\t\tasAttachment: () => helper.toAttachment(resource, server)\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn { picks, busy: pickItems.isBusy };\n\t\t});\n\t}\n}\n"]}