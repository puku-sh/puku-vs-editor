{"version":3,"sources":["vs/workbench/contrib/mcp/browser/mcpElicitationService.ts"],"names":[],"mappings":"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","file":"mcpElicitationService.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Action } from '../../../../base/common/actions.js';\nimport { assertNever, softAssertNever } from '../../../../base/common/assert.js';\nimport { CancellationToken } from '../../../../base/common/cancellation.js';\nimport { CancellationError } from '../../../../base/common/errors.js';\nimport { MarkdownString } from '../../../../base/common/htmlContent.js';\nimport { DisposableStore } from '../../../../base/common/lifecycle.js';\nimport { autorun } from '../../../../base/common/observable.js';\nimport { isDefined } from '../../../../base/common/types.js';\nimport { URI } from '../../../../base/common/uri.js';\nimport { localize } from '../../../../nls.js';\nimport { INotificationService, Severity } from '../../../../platform/notification/common/notification.js';\nimport { IOpenerService } from '../../../../platform/opener/common/opener.js';\nimport { IQuickInputService, IQuickPick, IQuickPickItem } from '../../../../platform/quickinput/common/quickInput.js';\nimport { ChatElicitationRequestPart } from '../../chat/browser/chatElicitationRequestPart.js';\nimport { ChatModel } from '../../chat/common/chatModel.js';\nimport { ElicitationState, IChatService } from '../../chat/common/chatService.js';\nimport { LocalChatSessionUri } from '../../chat/common/chatUri.js';\nimport { ElicitationKind, ElicitResult, IFormModeElicitResult, IMcpElicitationService, IMcpServer, IMcpToolCallContext, IUrlModeElicitResult, McpConnectionState, MpcResponseError } from '../common/mcpTypes.js';\nimport { mcpServerToSourceData } from '../common/mcpTypesUtils.js';\nimport { MCP } from '../common/modelContextProtocol.js';\n\nconst noneItem: IQuickPickItem = { id: undefined, label: localize('mcp.elicit.enum.none', 'None'), description: localize('mcp.elicit.enum.none.description', 'No selection'), alwaysShow: true };\n\ntype Pre20251125ElicitationParams = Omit<MCP.ElicitRequestFormParams, 'mode'> & { mode?: undefined };\n\nfunction isFormElicitation(params: MCP.ElicitRequest['params'] | Pre20251125ElicitationParams): params is (MCP.ElicitRequestFormParams | Pre20251125ElicitationParams) {\n\treturn params.mode === 'form' || (params.mode === undefined && !!(params as Pre20251125ElicitationParams).requestedSchema);\n}\n\nfunction isUrlElicitation(params: MCP.ElicitRequest['params']): params is MCP.ElicitRequestURLParams {\n\treturn params.mode === 'url';\n}\n\nfunction isLegacyTitledEnumSchema(schema: MCP.PrimitiveSchemaDefinition): schema is MCP.LegacyTitledEnumSchema & { enumNames: string[] } {\n\tconst cast = schema as MCP.LegacyTitledEnumSchema;\n\treturn cast.type === 'string' && Array.isArray(cast.enum) && Array.isArray(cast.enumNames);\n}\n\nfunction isUntitledEnumSchema(schema: MCP.PrimitiveSchemaDefinition): schema is MCP.LegacyTitledEnumSchema | MCP.UntitledSingleSelectEnumSchema {\n\tconst cast = schema as MCP.LegacyTitledEnumSchema | MCP.UntitledSingleSelectEnumSchema;\n\treturn cast.type === 'string' && Array.isArray(cast.enum);\n}\n\nfunction isTitledSingleEnumSchema(schema: MCP.PrimitiveSchemaDefinition): schema is MCP.TitledSingleSelectEnumSchema {\n\tconst cast = schema as MCP.TitledSingleSelectEnumSchema;\n\treturn cast.type === 'string' && Array.isArray(cast.oneOf);\n}\n\nfunction isUntitledMultiEnumSchema(schema: MCP.PrimitiveSchemaDefinition): schema is MCP.UntitledMultiSelectEnumSchema {\n\tconst cast = schema as MCP.UntitledMultiSelectEnumSchema;\n\treturn cast.type === 'array' && !!cast.items?.enum;\n}\n\nfunction isTitledMultiEnumSchema(schema: MCP.PrimitiveSchemaDefinition): schema is MCP.TitledMultiSelectEnumSchema {\n\tconst cast = schema as MCP.TitledMultiSelectEnumSchema;\n\treturn cast.type === 'array' && !!cast.items?.anyOf;\n}\n\nexport class McpElicitationService implements IMcpElicitationService {\n\tdeclare readonly _serviceBrand: undefined;\n\n\tconstructor(\n\t\t@INotificationService private readonly _notificationService: INotificationService,\n\t\t@IQuickInputService private readonly _quickInputService: IQuickInputService,\n\t\t@IChatService private readonly _chatService: IChatService,\n\t\t@IOpenerService private readonly _openerService: IOpenerService,\n\t) { }\n\n\tpublic elicit(server: IMcpServer, context: IMcpToolCallContext | undefined, elicitation: MCP.ElicitRequest['params'], token: CancellationToken): Promise<ElicitResult> {\n\t\tif (isFormElicitation(elicitation)) {\n\t\t\treturn this._elicitForm(server, context, elicitation, token);\n\t\t} else if (isUrlElicitation(elicitation)) {\n\t\t\treturn this._elicitUrl(server, context, elicitation, token);\n\t\t} else {\n\t\t\tsoftAssertNever(elicitation);\n\t\t\treturn Promise.reject(new MpcResponseError('Unsupported elicitation type', MCP.INVALID_PARAMS, undefined));\n\t\t}\n\t}\n\n\tprivate async _elicitForm(server: IMcpServer, context: IMcpToolCallContext | undefined, elicitation: MCP.ElicitRequestFormParams | Pre20251125ElicitationParams, token: CancellationToken): Promise<IFormModeElicitResult> {\n\t\tconst store = new DisposableStore();\n\t\tconst value = await new Promise<MCP.ElicitResult>(resolve => {\n\t\t\tconst chatModel = context?.chatSessionId && this._chatService.getSession(LocalChatSessionUri.forSession(context.chatSessionId));\n\t\t\tif (chatModel instanceof ChatModel) {\n\t\t\t\tconst request = chatModel.getRequests().at(-1);\n\t\t\t\tif (request) {\n\t\t\t\t\tconst part = new ChatElicitationRequestPart(\n\t\t\t\t\t\tlocalize('mcp.elicit.title', 'Request for Input'),\n\t\t\t\t\t\telicitation.message,\n\t\t\t\t\t\tlocalize('msg.subtitle', \"{0} (MCP Server)\", server.definition.label),\n\t\t\t\t\t\tlocalize('mcp.elicit.accept', 'Respond'),\n\t\t\t\t\t\tlocalize('mcp.elicit.reject', 'Cancel'),\n\t\t\t\t\t\tasync () => {\n\t\t\t\t\t\t\tconst p = this._doElicitForm(elicitation, token);\n\t\t\t\t\t\t\tresolve(p);\n\t\t\t\t\t\t\tconst result = await p;\n\t\t\t\t\t\t\tpart.acceptedResult = result.content;\n\t\t\t\t\t\t\treturn result.action === 'accept' ? ElicitationState.Accepted : ElicitationState.Rejected;\n\t\t\t\t\t\t},\n\t\t\t\t\t\t() => {\n\t\t\t\t\t\t\tresolve({ action: 'decline' });\n\t\t\t\t\t\t\treturn Promise.resolve(ElicitationState.Rejected);\n\t\t\t\t\t\t},\n\t\t\t\t\t\tmcpServerToSourceData(server),\n\t\t\t\t\t);\n\t\t\t\t\tchatModel.acceptResponseProgress(request, part);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tconst handle = this._notificationService.notify({\n\t\t\t\t\tmessage: elicitation.message,\n\t\t\t\t\tsource: localize('mcp.elicit.source', 'MCP Server ({0})', server.definition.label),\n\t\t\t\t\tseverity: Severity.Info,\n\t\t\t\t\tactions: {\n\t\t\t\t\t\tprimary: [store.add(new Action('mcp.elicit.give', localize('mcp.elicit.give', 'Respond'), undefined, true, () => resolve(this._doElicitForm(elicitation, token))))],\n\t\t\t\t\t\tsecondary: [store.add(new Action('mcp.elicit.cancel', localize('mcp.elicit.cancel', 'Cancel'), undefined, true, () => resolve({ action: 'decline' })))],\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tstore.add(handle.onDidClose(() => resolve({ action: 'cancel' })));\n\t\t\t\tstore.add(token.onCancellationRequested(() => resolve({ action: 'cancel' })));\n\t\t\t}\n\n\t\t}).finally(() => store.dispose());\n\n\t\treturn { kind: ElicitationKind.Form, value, dispose: () => { } };\n\t}\n\n\tprivate async _elicitUrl(server: IMcpServer, context: IMcpToolCallContext | undefined, elicitation: MCP.ElicitRequestURLParams, token: CancellationToken): Promise<IUrlModeElicitResult> {\n\t\tconst promiseStore = new DisposableStore();\n\n\t\t// We create this ahead of time in case e.g. a user manually opens the URL beforehand\n\t\tconst completePromise = new Promise<void>((resolve, reject) => {\n\t\t\tpromiseStore.add(token.onCancellationRequested(() => reject(new CancellationError())));\n\t\t\tpromiseStore.add(autorun(reader => {\n\t\t\t\tconst cnx = server.connection.read(reader);\n\t\t\t\tconst handler = cnx?.handler.read(reader);\n\t\t\t\tif (handler) {\n\t\t\t\t\treader.store.add(handler.onDidReceiveElicitationCompleteNotification(e => {\n\t\t\t\t\t\tif (e.params.elicitationId === elicitation.elicitationId) {\n\t\t\t\t\t\t\tresolve();\n\t\t\t\t\t\t}\n\t\t\t\t\t}));\n\t\t\t\t} else if (!McpConnectionState.isRunning(server.connectionState.read(reader))) {\n\t\t\t\t\treject(new CancellationError());\n\t\t\t\t}\n\t\t\t}));\n\t\t}).finally(() => promiseStore.dispose());\n\n\t\tconst store = new DisposableStore();\n\t\tconst value = await new Promise<MCP.ElicitResult>(resolve => {\n\t\t\tconst chatModel = context?.chatSessionId && this._chatService.getSession(LocalChatSessionUri.forSession(context.chatSessionId));\n\t\t\tif (chatModel instanceof ChatModel) {\n\t\t\t\tconst request = chatModel.getRequests().at(-1);\n\t\t\t\tif (request) {\n\t\t\t\t\tconst part = new ChatElicitationRequestPart(\n\t\t\t\t\t\tlocalize('mcp.elicit.url.title', 'Authorization Required'),\n\t\t\t\t\t\tnew MarkdownString().appendText(elicitation.message)\n\t\t\t\t\t\t\t.appendMarkdown('\\n\\n' + localize('mcp.elicit.url.instruction', 'Open this URL?'))\n\t\t\t\t\t\t\t.appendCodeblock('', elicitation.url),\n\t\t\t\t\t\tlocalize('msg.subtitle', \"{0} (MCP Server)\", server.definition.label),\n\t\t\t\t\t\tlocalize('mcp.elicit.url.open', 'Open {0}', URI.parse(elicitation.url).authority),\n\t\t\t\t\t\tlocalize('mcp.elicit.reject', 'Cancel'),\n\t\t\t\t\t\tasync () => {\n\t\t\t\t\t\t\tconst result = await this._doElicitUrl(elicitation, token);\n\t\t\t\t\t\t\tresolve(result);\n\t\t\t\t\t\t\tcompletePromise.then(() => part.hide());\n\t\t\t\t\t\t\treturn result.action === 'accept' ? ElicitationState.Accepted : ElicitationState.Rejected;\n\t\t\t\t\t\t},\n\t\t\t\t\t\t() => {\n\t\t\t\t\t\t\tresolve({ action: 'decline' });\n\t\t\t\t\t\t\treturn Promise.resolve(ElicitationState.Rejected);\n\t\t\t\t\t\t},\n\t\t\t\t\t\tmcpServerToSourceData(server),\n\t\t\t\t\t);\n\t\t\t\t\tchatModel.acceptResponseProgress(request, part);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tconst handle = this._notificationService.notify({\n\t\t\t\t\tmessage: elicitation.message + ' ' + localize('mcp.elicit.url.instruction2', 'This will open {0}', elicitation.url),\n\t\t\t\t\tsource: localize('mcp.elicit.source', 'MCP Server ({0})', server.definition.label),\n\t\t\t\t\tseverity: Severity.Info,\n\t\t\t\t\tactions: {\n\t\t\t\t\t\tprimary: [store.add(new Action('mcp.elicit.url.open2', localize('mcp.elicit.url.open2', 'Open URL'), undefined, true, () => resolve(this._doElicitUrl(elicitation, token))))],\n\t\t\t\t\t\tsecondary: [store.add(new Action('mcp.elicit.cancel', localize('mcp.elicit.cancel', 'Cancel'), undefined, true, () => resolve({ action: 'decline' })))],\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tstore.add(handle.onDidClose(() => resolve({ action: 'cancel' })));\n\t\t\t\tstore.add(token.onCancellationRequested(() => resolve({ action: 'cancel' })));\n\t\t\t}\n\t\t}).finally(() => store.dispose());\n\n\t\treturn {\n\t\t\tkind: ElicitationKind.URL,\n\t\t\tvalue,\n\t\t\twait: completePromise,\n\t\t\tdispose: () => promiseStore.dispose(),\n\t\t};\n\t}\n\n\tprivate async _doElicitUrl(elicitation: MCP.ElicitRequestURLParams, token: CancellationToken): Promise<MCP.ElicitResult> {\n\t\tif (token.isCancellationRequested) {\n\t\t\treturn { action: 'cancel' };\n\t\t}\n\n\t\ttry {\n\t\t\tif (await this._openerService.open(elicitation.url, { allowCommands: false })) {\n\t\t\t\treturn { action: 'accept' };\n\t\t\t}\n\t\t} catch {\n\t\t\t// ignored\n\t\t}\n\n\t\treturn { action: 'decline' };\n\t}\n\n\tprivate async _doElicitForm(elicitation: MCP.ElicitRequestFormParams | Pre20251125ElicitationParams, token: CancellationToken): Promise<MCP.ElicitResult> {\n\t\tconst quickPick = this._quickInputService.createQuickPick<IQuickPickItem>();\n\t\tconst store = new DisposableStore();\n\n\t\ttry {\n\t\t\tconst properties = Object.entries(elicitation.requestedSchema.properties);\n\t\t\tconst requiredFields = new Set(elicitation.requestedSchema.required || []);\n\t\t\tconst results: Record<string, string | number | boolean | string[]> = {};\n\t\t\tconst backSnapshots: { value: string; validationMessage?: string }[] = [];\n\n\t\t\tquickPick.title = elicitation.message;\n\t\t\tquickPick.totalSteps = properties.length;\n\t\t\tquickPick.ignoreFocusOut = true;\n\n\t\t\tfor (let i = 0; i < properties.length; i++) {\n\t\t\t\tconst [propertyName, schema] = properties[i];\n\t\t\t\tconst isRequired = requiredFields.has(propertyName);\n\t\t\t\tconst restore = backSnapshots.at(i);\n\n\t\t\t\tstore.clear();\n\t\t\t\tquickPick.step = i + 1;\n\t\t\t\tquickPick.title = schema.title || propertyName;\n\t\t\t\tquickPick.placeholder = this._getFieldPlaceholder(schema, isRequired);\n\t\t\t\tquickPick.value = restore?.value ?? '';\n\t\t\t\tquickPick.validationMessage = '';\n\t\t\t\tquickPick.buttons = i > 0 ? [this._quickInputService.backButton] : [];\n\n\t\t\t\tlet result: { type: 'value'; value: string | number | boolean | undefined | string[] } | { type: 'back' } | { type: 'cancel' };\n\t\t\t\tif (schema.type === 'boolean') {\n\t\t\t\t\tresult = await this._handleEnumField(quickPick, { enum: [{ const: 'true' }, { const: 'false' }], default: schema.default ? String(schema.default) : undefined }, isRequired, store, token);\n\t\t\t\t\tif (result.type === 'value') { result.value = result.value === 'true' ? true : false; }\n\t\t\t\t} else if (isLegacyTitledEnumSchema(schema)) {\n\t\t\t\t\tresult = await this._handleEnumField(quickPick, { enum: schema.enum.map((v, i) => ({ const: v, title: schema.enumNames[i] })), default: schema.default }, isRequired, store, token);\n\t\t\t\t} else if (isUntitledEnumSchema(schema)) {\n\t\t\t\t\tresult = await this._handleEnumField(quickPick, { enum: schema.enum.map(v => ({ const: v })), default: schema.default }, isRequired, store, token);\n\t\t\t\t} else if (isTitledSingleEnumSchema(schema)) {\n\t\t\t\t\tresult = await this._handleEnumField(quickPick, { enum: schema.oneOf, default: schema.default }, isRequired, store, token);\n\t\t\t\t} else if (isTitledMultiEnumSchema(schema)) {\n\t\t\t\t\tresult = await this._handleMultiEnumField(quickPick, { enum: schema.items.anyOf, default: schema.default }, isRequired, store, token);\n\t\t\t\t} else if (isUntitledMultiEnumSchema(schema)) {\n\t\t\t\t\tresult = await this._handleMultiEnumField(quickPick, { enum: schema.items.enum.map(v => ({ const: v })), default: schema.default }, isRequired, store, token);\n\t\t\t\t} else {\n\t\t\t\t\tresult = await this._handleInputField(quickPick, schema, isRequired, store, token);\n\t\t\t\t\tif (result.type === 'value' && (schema.type === 'number' || schema.type === 'integer')) {\n\t\t\t\t\t\tresult.value = Number(result.value);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (result.type === 'back') {\n\t\t\t\t\ti -= 2;\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tif (result.type === 'cancel') {\n\t\t\t\t\treturn { action: 'cancel' };\n\t\t\t\t}\n\n\t\t\t\tbackSnapshots[i] = { value: quickPick.value };\n\n\t\t\t\tif (result.value === undefined) {\n\t\t\t\t\tdelete results[propertyName];\n\t\t\t\t} else {\n\t\t\t\t\tresults[propertyName] = result.value;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\taction: 'accept',\n\t\t\t\tcontent: results,\n\t\t\t};\n\t\t} finally {\n\t\t\tstore.dispose();\n\t\t\tquickPick.dispose();\n\t\t}\n\t}\n\n\tprivate _getFieldPlaceholder(schema: MCP.PrimitiveSchemaDefinition, required: boolean): string {\n\t\tlet placeholder = schema.description || '';\n\t\tif (!required) {\n\t\t\tplaceholder = placeholder ? `${placeholder} (${localize('optional', 'Optional')})` : localize('optional', 'Optional');\n\t\t}\n\t\treturn placeholder;\n\t}\n\n\tprivate async _handleEnumField(\n\t\tquickPick: IQuickPick<IQuickPickItem>,\n\t\tschema: { default?: string; enum: { const: string; title?: string }[] },\n\t\trequired: boolean,\n\t\tstore: DisposableStore,\n\t\ttoken: CancellationToken\n\t) {\n\t\tconst items: IQuickPickItem[] = schema.enum.map(({ const: value, title }) => ({\n\t\t\tid: value,\n\t\t\tlabel: value,\n\t\t\tdescription: title,\n\t\t}));\n\n\t\tif (!required) {\n\t\t\titems.push(noneItem);\n\t\t}\n\n\t\tquickPick.canSelectMany = false;\n\t\tquickPick.items = items;\n\t\tif (schema.default !== undefined) {\n\t\t\tquickPick.activeItems = items.filter(item => item.id === schema.default);\n\t\t}\n\n\t\treturn new Promise<{ type: 'value'; value: string | undefined } | { type: 'back' } | { type: 'cancel' }>(resolve => {\n\t\t\tstore.add(token.onCancellationRequested(() => resolve({ type: 'cancel' })));\n\t\t\tstore.add(quickPick.onDidAccept(() => {\n\t\t\t\tconst selected = quickPick.selectedItems[0];\n\t\t\t\tif (selected) {\n\t\t\t\t\tresolve({ type: 'value', value: selected.id });\n\t\t\t\t}\n\t\t\t}));\n\t\t\tstore.add(quickPick.onDidTriggerButton(() => resolve({ type: 'back' })));\n\t\t\tstore.add(quickPick.onDidHide(() => resolve({ type: 'cancel' })));\n\n\t\t\tquickPick.show();\n\t\t});\n\t}\n\n\tprivate async _handleMultiEnumField(\n\t\tquickPick: IQuickPick<IQuickPickItem>,\n\t\tschema: { default?: string[]; enum: { const: string; title?: string }[] },\n\t\trequired: boolean,\n\t\tstore: DisposableStore,\n\t\ttoken: CancellationToken\n\t) {\n\t\tconst items: IQuickPickItem[] = schema.enum.map(({ const: value, title }) => ({\n\t\t\tid: value,\n\t\t\tlabel: value,\n\t\t\tdescription: title,\n\t\t\tpicked: !!schema.default?.includes(value),\n\t\t\tpickable: true,\n\t\t}));\n\n\t\tif (!required) {\n\t\t\titems.push(noneItem);\n\t\t}\n\n\t\tquickPick.canSelectMany = true;\n\t\tquickPick.items = items;\n\n\t\treturn new Promise<{ type: 'value'; value: string[] | undefined } | { type: 'back' } | { type: 'cancel' }>(resolve => {\n\t\t\tstore.add(token.onCancellationRequested(() => resolve({ type: 'cancel' })));\n\t\t\tstore.add(quickPick.onDidAccept(() => {\n\t\t\t\tconst selected = quickPick.selectedItems[0];\n\t\t\t\tif (selected.id === undefined) {\n\t\t\t\t\tresolve({ type: 'value', value: undefined });\n\t\t\t\t} else {\n\t\t\t\t\tresolve({ type: 'value', value: quickPick.selectedItems.map(i => i.id).filter(isDefined) });\n\t\t\t\t}\n\t\t\t}));\n\t\t\tstore.add(quickPick.onDidTriggerButton(() => resolve({ type: 'back' })));\n\t\t\tstore.add(quickPick.onDidHide(() => resolve({ type: 'cancel' })));\n\n\t\t\tquickPick.show();\n\t\t});\n\t}\n\n\tprivate async _handleInputField(\n\t\tquickPick: IQuickPick<IQuickPickItem>,\n\t\tschema: MCP.NumberSchema | MCP.StringSchema,\n\t\trequired: boolean,\n\t\tstore: DisposableStore,\n\t\ttoken: CancellationToken\n\t) {\n\t\tquickPick.canSelectMany = false;\n\n\t\tconst updateItems = () => {\n\t\t\tconst items: IQuickPickItem[] = [];\n\t\t\tif (quickPick.value) {\n\t\t\t\tconst validation = this._validateInput(quickPick.value, schema);\n\t\t\t\tquickPick.validationMessage = validation.message;\n\t\t\t\tif (validation.isValid) {\n\t\t\t\t\titems.push({ id: '$current', label: `\\u27A4 ${quickPick.value}` });\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tquickPick.validationMessage = '';\n\n\t\t\t\tif (schema.default) {\n\t\t\t\t\titems.push({ id: '$default', label: `${schema.default}`, description: localize('mcp.elicit.useDefault', 'Default value') });\n\t\t\t\t}\n\t\t\t}\n\n\n\t\t\tif (quickPick.validationMessage) {\n\t\t\t\tquickPick.severity = Severity.Warning;\n\t\t\t} else {\n\t\t\t\tquickPick.severity = Severity.Ignore;\n\t\t\t\tif (!required) {\n\t\t\t\t\titems.push(noneItem);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tquickPick.items = items;\n\t\t};\n\n\t\tupdateItems();\n\n\t\treturn new Promise<{ type: 'value'; value: string | undefined } | { type: 'back' } | { type: 'cancel' }>(resolve => {\n\t\t\tif (token.isCancellationRequested) {\n\t\t\t\tresolve({ type: 'cancel' });\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tstore.add(token.onCancellationRequested(() => resolve({ type: 'cancel' })));\n\t\t\tstore.add(quickPick.onDidChangeValue(updateItems));\n\t\t\tstore.add(quickPick.onDidAccept(() => {\n\t\t\t\tconst id = quickPick.selectedItems[0].id;\n\t\t\t\tif (!id) {\n\t\t\t\t\tresolve({ type: 'value', value: undefined });\n\t\t\t\t} else if (id === '$default') {\n\t\t\t\t\tresolve({ type: 'value', value: String(schema.default) });\n\t\t\t\t} else if (!quickPick.validationMessage) {\n\t\t\t\t\tresolve({ type: 'value', value: quickPick.value });\n\t\t\t\t}\n\t\t\t}));\n\t\t\tstore.add(quickPick.onDidTriggerButton(() => resolve({ type: 'back' })));\n\t\t\tstore.add(quickPick.onDidHide(() => resolve({ type: 'cancel' })));\n\n\t\t\tquickPick.show();\n\t\t});\n\t}\n\n\tprivate _validateInput(value: string, schema: MCP.NumberSchema | MCP.StringSchema): { isValid: boolean; message?: string } {\n\t\tswitch (schema.type) {\n\t\t\tcase 'string':\n\t\t\t\treturn this._validateString(value, schema);\n\t\t\tcase 'number':\n\t\t\tcase 'integer':\n\t\t\t\treturn this._validateNumber(value, schema);\n\t\t\tdefault:\n\t\t\t\tassertNever(schema);\n\t\t}\n\t}\n\n\tprivate _validateString(value: string, schema: MCP.StringSchema): { isValid: boolean; parsedValue?: string; message?: string } {\n\t\tif (schema.minLength && value.length < schema.minLength) {\n\t\t\treturn { isValid: false, message: localize('mcp.elicit.validation.minLength', 'Minimum length is {0}', schema.minLength) };\n\t\t}\n\t\tif (schema.maxLength && value.length > schema.maxLength) {\n\t\t\treturn { isValid: false, message: localize('mcp.elicit.validation.maxLength', 'Maximum length is {0}', schema.maxLength) };\n\t\t}\n\t\tif (schema.format) {\n\t\t\tconst formatValid = this._validateStringFormat(value, schema.format);\n\t\t\tif (!formatValid.isValid) {\n\t\t\t\treturn formatValid;\n\t\t\t}\n\t\t}\n\t\treturn { isValid: true, parsedValue: value };\n\t}\n\n\tprivate _validateStringFormat(value: string, format: string): { isValid: boolean; message?: string } {\n\t\tswitch (format) {\n\t\t\tcase 'email':\n\t\t\t\treturn value.includes('@')\n\t\t\t\t\t? { isValid: true }\n\t\t\t\t\t: { isValid: false, message: localize('mcp.elicit.validation.email', 'Please enter a valid email address') };\n\t\t\tcase 'uri':\n\t\t\t\tif (URL.canParse(value)) {\n\t\t\t\t\treturn { isValid: true };\n\t\t\t\t} else {\n\t\t\t\t\treturn { isValid: false, message: localize('mcp.elicit.validation.uri', 'Please enter a valid URI') };\n\t\t\t\t}\n\t\t\tcase 'date': {\n\t\t\t\tconst dateRegex = /^\\d{4}-\\d{2}-\\d{2}$/;\n\t\t\t\tif (!dateRegex.test(value)) {\n\t\t\t\t\treturn { isValid: false, message: localize('mcp.elicit.validation.date', 'Please enter a valid date (YYYY-MM-DD)') };\n\t\t\t\t}\n\t\t\t\tconst date = new Date(value);\n\t\t\t\treturn !isNaN(date.getTime())\n\t\t\t\t\t? { isValid: true }\n\t\t\t\t\t: { isValid: false, message: localize('mcp.elicit.validation.date', 'Please enter a valid date (YYYY-MM-DD)') };\n\t\t\t}\n\t\t\tcase 'date-time': {\n\t\t\t\tconst dateTime = new Date(value);\n\t\t\t\treturn !isNaN(dateTime.getTime())\n\t\t\t\t\t? { isValid: true }\n\t\t\t\t\t: { isValid: false, message: localize('mcp.elicit.validation.dateTime', 'Please enter a valid date-time') };\n\t\t\t}\n\t\t\tdefault:\n\t\t\t\treturn { isValid: true };\n\t\t}\n\t}\n\n\tprivate _validateNumber(value: string, schema: MCP.NumberSchema): { isValid: boolean; parsedValue?: number; message?: string } {\n\t\tconst parsed = Number(value);\n\t\tif (isNaN(parsed)) {\n\t\t\treturn { isValid: false, message: localize('mcp.elicit.validation.number', 'Please enter a valid number') };\n\t\t}\n\t\tif (schema.type === 'integer' && !Number.isInteger(parsed)) {\n\t\t\treturn { isValid: false, message: localize('mcp.elicit.validation.integer', 'Please enter a valid integer') };\n\t\t}\n\t\tif (schema.minimum !== undefined && parsed < schema.minimum) {\n\t\t\treturn { isValid: false, message: localize('mcp.elicit.validation.minimum', 'Minimum value is {0}', schema.minimum) };\n\t\t}\n\t\tif (schema.maximum !== undefined && parsed > schema.maximum) {\n\t\t\treturn { isValid: false, message: localize('mcp.elicit.validation.maximum', 'Maximum value is {0}', schema.maximum) };\n\t\t}\n\t\treturn { isValid: true, parsedValue: parsed };\n\t}\n}\n"]}