{"version":3,"sources":["vs/workbench/contrib/bulkEdit/browser/preview/bulkEditPreview.ts"],"names":[],"mappings":"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","file":"bulkEditPreview.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { ITextModelContentProvider, ITextModelService } from '../../../../../editor/common/services/resolverService.js';\nimport { URI } from '../../../../../base/common/uri.js';\nimport { ILanguageService } from '../../../../../editor/common/languages/language.js';\nimport { IModelService } from '../../../../../editor/common/services/model.js';\nimport { createTextBufferFactoryFromSnapshot } from '../../../../../editor/common/model/textModel.js';\nimport { WorkspaceEditMetadata } from '../../../../../editor/common/languages.js';\nimport { DisposableStore } from '../../../../../base/common/lifecycle.js';\nimport { coalesceInPlace } from '../../../../../base/common/arrays.js';\nimport { Range } from '../../../../../editor/common/core/range.js';\nimport { EditOperation, ISingleEditOperation } from '../../../../../editor/common/core/editOperation.js';\nimport { ServicesAccessor, IInstantiationService } from '../../../../../platform/instantiation/common/instantiation.js';\nimport { IFileService } from '../../../../../platform/files/common/files.js';\nimport { Emitter, Event } from '../../../../../base/common/event.js';\nimport { ConflictDetector } from '../conflicts.js';\nimport { ResourceMap } from '../../../../../base/common/map.js';\nimport { localize } from '../../../../../nls.js';\nimport { extUri } from '../../../../../base/common/resources.js';\nimport { ResourceEdit, ResourceFileEdit, ResourceTextEdit } from '../../../../../editor/browser/services/bulkEditService.js';\nimport { Codicon } from '../../../../../base/common/codicons.js';\nimport { generateUuid } from '../../../../../base/common/uuid.js';\nimport { SnippetParser } from '../../../../../editor/contrib/snippet/browser/snippetParser.js';\nimport { MicrotaskDelay } from '../../../../../base/common/symbols.js';\nimport { Schemas } from '../../../../../base/common/network.js';\n\nexport class CheckedStates<T extends object> {\n\n\tprivate readonly _states = new WeakMap<T, boolean>();\n\tprivate _checkedCount: number = 0;\n\n\tprivate readonly _onDidChange = new Emitter<T>();\n\treadonly onDidChange: Event<T> = this._onDidChange.event;\n\n\tdispose(): void {\n\t\tthis._onDidChange.dispose();\n\t}\n\n\tget checkedCount() {\n\t\treturn this._checkedCount;\n\t}\n\n\tisChecked(obj: T): boolean {\n\t\treturn this._states.get(obj) ?? false;\n\t}\n\n\tupdateChecked(obj: T, value: boolean): void {\n\t\tconst valueNow = this._states.get(obj);\n\t\tif (valueNow === value) {\n\t\t\treturn;\n\t\t}\n\t\tif (valueNow === undefined) {\n\t\t\tif (value) {\n\t\t\t\tthis._checkedCount += 1;\n\t\t\t}\n\t\t} else {\n\t\t\tif (value) {\n\t\t\t\tthis._checkedCount += 1;\n\t\t\t} else {\n\t\t\t\tthis._checkedCount -= 1;\n\t\t\t}\n\t\t}\n\t\tthis._states.set(obj, value);\n\t\tthis._onDidChange.fire(obj);\n\t}\n}\n\nexport class BulkTextEdit {\n\n\tconstructor(\n\t\treadonly parent: BulkFileOperation,\n\t\treadonly textEdit: ResourceTextEdit\n\t) { }\n}\n\nexport const enum BulkFileOperationType {\n\tTextEdit = 1,\n\tCreate = 2,\n\tDelete = 4,\n\tRename = 8,\n}\n\nexport class BulkFileOperation {\n\n\ttype = 0;\n\ttextEdits: BulkTextEdit[] = [];\n\toriginalEdits = new Map<number, ResourceTextEdit | ResourceFileEdit>();\n\tnewUri?: URI;\n\n\tconstructor(\n\t\treadonly uri: URI,\n\t\treadonly parent: BulkFileOperations\n\t) { }\n\n\taddEdit(index: number, type: BulkFileOperationType, edit: ResourceTextEdit | ResourceFileEdit) {\n\t\tthis.type |= type;\n\t\tthis.originalEdits.set(index, edit);\n\t\tif (edit instanceof ResourceTextEdit) {\n\t\t\tthis.textEdits.push(new BulkTextEdit(this, edit));\n\n\t\t} else if (type === BulkFileOperationType.Rename) {\n\t\t\tthis.newUri = edit.newResource;\n\t\t}\n\t}\n\n\tneedsConfirmation(): boolean {\n\t\tfor (const [, edit] of this.originalEdits) {\n\t\t\tif (!this.parent.checked.isChecked(edit)) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t}\n}\n\nexport class BulkCategory {\n\n\tprivate static readonly _defaultMetadata = Object.freeze({\n\t\tlabel: localize('default', \"Other\"),\n\t\ticon: Codicon.symbolFile,\n\t\tneedsConfirmation: false\n\t});\n\n\tstatic keyOf(metadata?: WorkspaceEditMetadata) {\n\t\treturn metadata?.label || '<default>';\n\t}\n\n\treadonly operationByResource = new Map<string, BulkFileOperation>();\n\n\tconstructor(readonly metadata: WorkspaceEditMetadata = BulkCategory._defaultMetadata) { }\n\n\tget fileOperations(): IterableIterator<BulkFileOperation> {\n\t\treturn this.operationByResource.values();\n\t}\n}\n\nexport class BulkFileOperations {\n\n\tstatic async create(accessor: ServicesAccessor, bulkEdit: ResourceEdit[]): Promise<BulkFileOperations> {\n\t\tconst result = accessor.get(IInstantiationService).createInstance(BulkFileOperations, bulkEdit);\n\t\treturn await result._init();\n\t}\n\n\treadonly checked = new CheckedStates<ResourceEdit>();\n\n\treadonly fileOperations: BulkFileOperation[] = [];\n\treadonly categories: BulkCategory[] = [];\n\treadonly conflicts: ConflictDetector;\n\n\tconstructor(\n\t\tprivate readonly _bulkEdit: ResourceEdit[],\n\t\t@IFileService private readonly _fileService: IFileService,\n\t\t@IInstantiationService instaService: IInstantiationService,\n\t) {\n\t\tthis.conflicts = instaService.createInstance(ConflictDetector, _bulkEdit);\n\t}\n\n\tdispose(): void {\n\t\tthis.checked.dispose();\n\t\tthis.conflicts.dispose();\n\t}\n\n\tasync _init() {\n\t\tconst operationByResource = new Map<string, BulkFileOperation>();\n\t\tconst operationByCategory = new Map<string, BulkCategory>();\n\n\t\tconst newToOldUri = new ResourceMap<URI>();\n\n\t\tfor (let idx = 0; idx < this._bulkEdit.length; idx++) {\n\t\t\tconst edit = this._bulkEdit[idx];\n\n\t\t\tlet uri: URI;\n\t\t\tlet type: BulkFileOperationType;\n\n\t\t\t// store inital checked state\n\t\t\tthis.checked.updateChecked(edit, !edit.metadata?.needsConfirmation);\n\n\t\t\tif (edit instanceof ResourceTextEdit) {\n\t\t\t\ttype = BulkFileOperationType.TextEdit;\n\t\t\t\turi = edit.resource;\n\n\t\t\t} else if (edit instanceof ResourceFileEdit) {\n\t\t\t\tif (edit.newResource && edit.oldResource) {\n\t\t\t\t\ttype = BulkFileOperationType.Rename;\n\t\t\t\t\turi = edit.oldResource;\n\t\t\t\t\tif (edit.options?.overwrite === undefined && edit.options?.ignoreIfExists && await this._fileService.exists(uri)) {\n\t\t\t\t\t\t// noop -> \"soft\" rename to something that already exists\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\t\t// map newResource onto oldResource so that text-edit appear for\n\t\t\t\t\t// the same file element\n\t\t\t\t\tnewToOldUri.set(edit.newResource, uri);\n\n\t\t\t\t} else if (edit.oldResource) {\n\t\t\t\t\ttype = BulkFileOperationType.Delete;\n\t\t\t\t\turi = edit.oldResource;\n\t\t\t\t\tif (edit.options?.ignoreIfNotExists && !await this._fileService.exists(uri)) {\n\t\t\t\t\t\t// noop -> \"soft\" delete something that doesn't exist\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\n\t\t\t\t} else if (edit.newResource) {\n\t\t\t\t\ttype = BulkFileOperationType.Create;\n\t\t\t\t\turi = edit.newResource;\n\t\t\t\t\tif (edit.options?.overwrite === undefined && edit.options?.ignoreIfExists && await this._fileService.exists(uri)) {\n\t\t\t\t\t\t// noop -> \"soft\" create something that already exists\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\n\t\t\t\t} else {\n\t\t\t\t\t// invalid edit -> skip\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t} else {\n\t\t\t\t// unsupported edit\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tconst insert = (uri: URI, map: Map<string, BulkFileOperation>) => {\n\t\t\t\tlet key = extUri.getComparisonKey(uri, true);\n\t\t\t\tlet operation = map.get(key);\n\n\t\t\t\t// rename\n\t\t\t\tif (!operation && newToOldUri.has(uri)) {\n\t\t\t\t\turi = newToOldUri.get(uri)!;\n\t\t\t\t\tkey = extUri.getComparisonKey(uri, true);\n\t\t\t\t\toperation = map.get(key);\n\t\t\t\t}\n\n\t\t\t\tif (!operation) {\n\t\t\t\t\toperation = new BulkFileOperation(uri, this);\n\t\t\t\t\tmap.set(key, operation);\n\t\t\t\t}\n\t\t\t\toperation.addEdit(idx, type, edit);\n\t\t\t};\n\n\t\t\tinsert(uri, operationByResource);\n\n\t\t\t// insert into \"this\" category\n\t\t\tconst key = BulkCategory.keyOf(edit.metadata);\n\t\t\tlet category = operationByCategory.get(key);\n\t\t\tif (!category) {\n\t\t\t\tcategory = new BulkCategory(edit.metadata);\n\t\t\t\toperationByCategory.set(key, category);\n\t\t\t}\n\t\t\tinsert(uri, category.operationByResource);\n\t\t}\n\n\t\toperationByResource.forEach(value => this.fileOperations.push(value));\n\t\toperationByCategory.forEach(value => this.categories.push(value));\n\n\t\t// \"correct\" invalid parent-check child states that is\n\t\t// unchecked file edits (rename, create, delete) uncheck\n\t\t// all edits for a file, e.g no text change without rename\n\t\tfor (const file of this.fileOperations) {\n\t\t\tif (file.type !== BulkFileOperationType.TextEdit) {\n\t\t\t\tlet checked = true;\n\t\t\t\tfor (const edit of file.originalEdits.values()) {\n\t\t\t\t\tif (edit instanceof ResourceFileEdit) {\n\t\t\t\t\t\tchecked = checked && this.checked.isChecked(edit);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (!checked) {\n\t\t\t\t\tfor (const edit of file.originalEdits.values()) {\n\t\t\t\t\t\tthis.checked.updateChecked(edit, checked);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// sort (once) categories atop which have unconfirmed edits\n\t\tthis.categories.sort((a, b) => {\n\t\t\tif (a.metadata.needsConfirmation === b.metadata.needsConfirmation) {\n\t\t\t\treturn a.metadata.label.localeCompare(b.metadata.label);\n\t\t\t} else if (a.metadata.needsConfirmation) {\n\t\t\t\treturn -1;\n\t\t\t} else {\n\t\t\t\treturn 1;\n\t\t\t}\n\t\t});\n\n\t\treturn this;\n\t}\n\n\tgetWorkspaceEdit(): ResourceEdit[] {\n\t\tconst result: ResourceEdit[] = [];\n\t\tlet allAccepted = true;\n\n\t\tfor (let i = 0; i < this._bulkEdit.length; i++) {\n\t\t\tconst edit = this._bulkEdit[i];\n\t\t\tif (this.checked.isChecked(edit)) {\n\t\t\t\tresult[i] = edit;\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tallAccepted = false;\n\t\t}\n\n\t\tif (allAccepted) {\n\t\t\treturn this._bulkEdit;\n\t\t}\n\n\t\t// not all edits have been accepted\n\t\tcoalesceInPlace(result);\n\t\treturn result;\n\t}\n\n\tprivate async getFileEditOperation(edit: ResourceFileEdit): Promise<ISingleEditOperation | undefined> {\n\t\tconst content = await edit.options.contents;\n\t\tif (!content) { return undefined; }\n\t\treturn EditOperation.replaceMove(Range.lift({ startLineNumber: 0, startColumn: 0, endLineNumber: Number.MAX_VALUE, endColumn: 0 }), content.toString());\n\t}\n\n\tasync getFileEdits(uri: URI): Promise<ISingleEditOperation[]> {\n\n\t\tfor (const file of this.fileOperations) {\n\t\t\tif (file.uri.toString() === uri.toString()) {\n\n\t\t\t\tconst result: Promise<ISingleEditOperation | undefined>[] = [];\n\t\t\t\tlet ignoreAll = false;\n\n\t\t\t\tfor (const edit of file.originalEdits.values()) {\n\t\t\t\t\tif (edit instanceof ResourceFileEdit) {\n\t\t\t\t\t\tresult.push(this.getFileEditOperation(edit));\n\t\t\t\t\t} else if (edit instanceof ResourceTextEdit) {\n\t\t\t\t\t\tif (this.checked.isChecked(edit)) {\n\t\t\t\t\t\t\tresult.push(Promise.resolve(EditOperation.replaceMove(Range.lift(edit.textEdit.range), !edit.textEdit.insertAsSnippet ? edit.textEdit.text : SnippetParser.asInsertText(edit.textEdit.text))));\n\t\t\t\t\t\t}\n\n\t\t\t\t\t} else if (!this.checked.isChecked(edit)) {\n\t\t\t\t\t\t// UNCHECKED WorkspaceFileEdit disables all text edits\n\t\t\t\t\t\tignoreAll = true;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (ignoreAll) {\n\t\t\t\t\treturn [];\n\t\t\t\t}\n\n\t\t\t\treturn (await Promise.all(result)).filter(r => r !== undefined).sort((a, b) => Range.compareRangesUsingStarts(a.range, b.range));\n\t\t\t}\n\t\t}\n\t\treturn [];\n\t}\n\n\tgetUriOfEdit(edit: ResourceEdit): URI {\n\t\tfor (const file of this.fileOperations) {\n\t\t\tfor (const value of file.originalEdits.values()) {\n\t\t\t\tif (value === edit) {\n\t\t\t\t\treturn file.uri;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tthrow new Error('invalid edit');\n\t}\n}\n\nexport class BulkEditPreviewProvider implements ITextModelContentProvider {\n\n\tprivate static readonly Schema = 'vscode-bulkeditpreview-editor';\n\n\tstatic emptyPreview = URI.from({ scheme: this.Schema, fragment: 'empty' });\n\n\n\tstatic fromPreviewUri(uri: URI): URI {\n\t\treturn URI.parse(uri.query);\n\t}\n\n\tprivate readonly _disposables = new DisposableStore();\n\tprivate readonly _ready: Promise<any>;\n\tprivate readonly _modelPreviewEdits = new Map<string, ISingleEditOperation[]>();\n\tprivate readonly _instanceId = generateUuid();\n\n\tconstructor(\n\t\tprivate readonly _operations: BulkFileOperations,\n\t\t@ILanguageService private readonly _languageService: ILanguageService,\n\t\t@IModelService private readonly _modelService: IModelService,\n\t\t@ITextModelService private readonly _textModelResolverService: ITextModelService\n\t) {\n\t\tthis._disposables.add(this._textModelResolverService.registerTextModelContentProvider(BulkEditPreviewProvider.Schema, this));\n\t\tthis._ready = this._init();\n\t}\n\n\tdispose(): void {\n\t\tthis._disposables.dispose();\n\t}\n\n\tasPreviewUri(uri: URI): URI {\n\t\tconst path = uri.scheme === Schemas.untitled ? `/${uri.path}` : uri.path;\n\t\treturn URI.from({ scheme: BulkEditPreviewProvider.Schema, authority: this._instanceId, path, query: uri.toString() });\n\t}\n\n\tprivate async _init() {\n\t\tfor (const operation of this._operations.fileOperations) {\n\t\t\tawait this._applyTextEditsToPreviewModel(operation.uri);\n\t\t}\n\t\tthis._disposables.add(Event.debounce(this._operations.checked.onDidChange, (_last, e) => e, MicrotaskDelay)(e => {\n\t\t\tconst uri = this._operations.getUriOfEdit(e);\n\t\t\tthis._applyTextEditsToPreviewModel(uri);\n\t\t}));\n\t}\n\n\tprivate async _applyTextEditsToPreviewModel(uri: URI) {\n\t\tconst model = await this._getOrCreatePreviewModel(uri);\n\n\t\t// undo edits that have been done before\n\t\tconst undoEdits = this._modelPreviewEdits.get(model.id);\n\t\tif (undoEdits) {\n\t\t\tmodel.applyEdits(undoEdits);\n\t\t}\n\t\t// apply new edits and keep (future) undo edits\n\t\tconst newEdits = await this._operations.getFileEdits(uri);\n\t\tconst newUndoEdits = model.applyEdits(newEdits, true);\n\t\tthis._modelPreviewEdits.set(model.id, newUndoEdits);\n\t}\n\n\tprivate async _getOrCreatePreviewModel(uri: URI) {\n\t\tconst previewUri = this.asPreviewUri(uri);\n\t\tlet model = this._modelService.getModel(previewUri);\n\t\tif (!model) {\n\t\t\ttry {\n\t\t\t\t// try: copy existing\n\t\t\t\tconst ref = await this._textModelResolverService.createModelReference(uri);\n\t\t\t\tconst sourceModel = ref.object.textEditorModel;\n\t\t\t\tmodel = this._modelService.createModel(\n\t\t\t\t\tcreateTextBufferFactoryFromSnapshot(sourceModel.createSnapshot()),\n\t\t\t\t\tthis._languageService.createById(sourceModel.getLanguageId()),\n\t\t\t\t\tpreviewUri\n\t\t\t\t);\n\t\t\t\tref.dispose();\n\n\t\t\t} catch {\n\t\t\t\t// create NEW model\n\t\t\t\tmodel = this._modelService.createModel(\n\t\t\t\t\t'',\n\t\t\t\t\tthis._languageService.createByFilepathOrFirstLine(previewUri),\n\t\t\t\t\tpreviewUri\n\t\t\t\t);\n\t\t\t}\n\t\t\t// this is a little weird but otherwise editors and other cusomers\n\t\t\t// will dispose my models before they should be disposed...\n\t\t\t// And all of this is off the eventloop to prevent endless recursion\n\t\t\tqueueMicrotask(async () => {\n\t\t\t\tthis._disposables.add(await this._textModelResolverService.createModelReference(model!.uri));\n\t\t\t});\n\t\t}\n\t\treturn model;\n\t}\n\n\tasync provideTextContent(previewUri: URI) {\n\t\tif (previewUri.toString() === BulkEditPreviewProvider.emptyPreview.toString()) {\n\t\t\treturn this._modelService.createModel('', null, previewUri);\n\t\t}\n\t\tawait this._ready;\n\t\treturn this._modelService.getModel(previewUri);\n\t}\n}\n"]}