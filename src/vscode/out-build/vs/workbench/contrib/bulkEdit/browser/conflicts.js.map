{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/contrib/bulkEdit/browser/conflicts.ts","vs/workbench/contrib/bulkEdit/browser/conflicts.ts"],"names":[],"mappings":"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","file":"conflicts.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { IFileService } from '../../../../platform/files/common/files.js';\nimport { URI } from '../../../../base/common/uri.js';\nimport { IModelService } from '../../../../editor/common/services/model.js';\nimport { ResourceMap } from '../../../../base/common/map.js';\nimport { DisposableStore } from '../../../../base/common/lifecycle.js';\nimport { Emitter, Event } from '../../../../base/common/event.js';\nimport { ITextModel } from '../../../../editor/common/model.js';\nimport { ResourceEdit, ResourceFileEdit, ResourceTextEdit } from '../../../../editor/browser/services/bulkEditService.js';\nimport { ResourceNotebookCellEdit } from './bulkCellEdits.js';\nimport { ILogService } from '../../../../platform/log/common/log.js';\n\nexport class ConflictDetector {\n\n\tprivate readonly _conflicts = new ResourceMap<boolean>();\n\tprivate readonly _disposables = new DisposableStore();\n\n\tprivate readonly _onDidConflict = new Emitter<this>();\n\treadonly onDidConflict: Event<this> = this._onDidConflict.event;\n\n\tconstructor(\n\t\tedits: ResourceEdit[],\n\t\t@IFileService fileService: IFileService,\n\t\t@IModelService modelService: IModelService,\n\t\t@ILogService logService: ILogService,\n\t) {\n\n\t\tconst _workspaceEditResources = new ResourceMap<boolean>();\n\n\t\tfor (const edit of edits) {\n\t\t\tif (edit instanceof ResourceTextEdit) {\n\t\t\t\t_workspaceEditResources.set(edit.resource, true);\n\t\t\t\tif (typeof edit.versionId === 'number') {\n\t\t\t\t\tconst model = modelService.getModel(edit.resource);\n\t\t\t\t\tif (model && model.getVersionId() !== edit.versionId) {\n\t\t\t\t\t\tthis._conflicts.set(edit.resource, true);\n\t\t\t\t\t\tthis._onDidConflict.fire(this);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t} else if (edit instanceof ResourceFileEdit) {\n\t\t\t\tif (edit.newResource) {\n\t\t\t\t\t_workspaceEditResources.set(edit.newResource, true);\n\n\t\t\t\t} else if (edit.oldResource) {\n\t\t\t\t\t_workspaceEditResources.set(edit.oldResource, true);\n\t\t\t\t}\n\t\t\t} else if (edit instanceof ResourceNotebookCellEdit) {\n\t\t\t\t_workspaceEditResources.set(edit.resource, true);\n\n\t\t\t} else {\n\t\t\t\tlogService.warn('UNKNOWN edit type', edit);\n\t\t\t}\n\t\t}\n\n\t\t// listen to file changes\n\t\tthis._disposables.add(fileService.onDidFilesChange(e => {\n\n\t\t\tfor (const uri of _workspaceEditResources.keys()) {\n\t\t\t\t// conflict happens when a file that we are working\n\t\t\t\t// on changes on disk. ignore changes for which a model\n\t\t\t\t// exists because we have a better check for models\n\t\t\t\tif (!modelService.getModel(uri) && e.contains(uri)) {\n\t\t\t\t\tthis._conflicts.set(uri, true);\n\t\t\t\t\tthis._onDidConflict.fire(this);\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}));\n\n\t\t// listen to model changes...?\n\t\tconst onDidChangeModel = (model: ITextModel) => {\n\n\t\t\t// conflict\n\t\t\tif (_workspaceEditResources.has(model.uri)) {\n\t\t\t\tthis._conflicts.set(model.uri, true);\n\t\t\t\tthis._onDidConflict.fire(this);\n\t\t\t}\n\t\t};\n\t\tfor (const model of modelService.getModels()) {\n\t\t\tthis._disposables.add(model.onDidChangeContent(() => onDidChangeModel(model)));\n\t\t}\n\t}\n\n\tdispose(): void {\n\t\tthis._disposables.dispose();\n\t\tthis._onDidConflict.dispose();\n\t}\n\n\tlist(): URI[] {\n\t\treturn [...this._conflicts.keys()];\n\t}\n\n\thasConflicts(): boolean {\n\t\treturn this._conflicts.size > 0;\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { IFileService } from '../../../../platform/files/common/files.js';\nimport { URI } from '../../../../base/common/uri.js';\nimport { IModelService } from '../../../../editor/common/services/model.js';\nimport { ResourceMap } from '../../../../base/common/map.js';\nimport { DisposableStore } from '../../../../base/common/lifecycle.js';\nimport { Emitter, Event } from '../../../../base/common/event.js';\nimport { ITextModel } from '../../../../editor/common/model.js';\nimport { ResourceEdit, ResourceFileEdit, ResourceTextEdit } from '../../../../editor/browser/services/bulkEditService.js';\nimport { ResourceNotebookCellEdit } from './bulkCellEdits.js';\nimport { ILogService } from '../../../../platform/log/common/log.js';\n\nexport class ConflictDetector {\n\n\tprivate readonly _conflicts = new ResourceMap<boolean>();\n\tprivate readonly _disposables = new DisposableStore();\n\n\tprivate readonly _onDidConflict = new Emitter<this>();\n\treadonly onDidConflict: Event<this> = this._onDidConflict.event;\n\n\tconstructor(\n\t\tedits: ResourceEdit[],\n\t\t@IFileService fileService: IFileService,\n\t\t@IModelService modelService: IModelService,\n\t\t@ILogService logService: ILogService,\n\t) {\n\n\t\tconst _workspaceEditResources = new ResourceMap<boolean>();\n\n\t\tfor (const edit of edits) {\n\t\t\tif (edit instanceof ResourceTextEdit) {\n\t\t\t\t_workspaceEditResources.set(edit.resource, true);\n\t\t\t\tif (typeof edit.versionId === 'number') {\n\t\t\t\t\tconst model = modelService.getModel(edit.resource);\n\t\t\t\t\tif (model && model.getVersionId() !== edit.versionId) {\n\t\t\t\t\t\tthis._conflicts.set(edit.resource, true);\n\t\t\t\t\t\tthis._onDidConflict.fire(this);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t} else if (edit instanceof ResourceFileEdit) {\n\t\t\t\tif (edit.newResource) {\n\t\t\t\t\t_workspaceEditResources.set(edit.newResource, true);\n\n\t\t\t\t} else if (edit.oldResource) {\n\t\t\t\t\t_workspaceEditResources.set(edit.oldResource, true);\n\t\t\t\t}\n\t\t\t} else if (edit instanceof ResourceNotebookCellEdit) {\n\t\t\t\t_workspaceEditResources.set(edit.resource, true);\n\n\t\t\t} else {\n\t\t\t\tlogService.warn('UNKNOWN edit type', edit);\n\t\t\t}\n\t\t}\n\n\t\t// listen to file changes\n\t\tthis._disposables.add(fileService.onDidFilesChange(e => {\n\n\t\t\tfor (const uri of _workspaceEditResources.keys()) {\n\t\t\t\t// conflict happens when a file that we are working\n\t\t\t\t// on changes on disk. ignore changes for which a model\n\t\t\t\t// exists because we have a better check for models\n\t\t\t\tif (!modelService.getModel(uri) && e.contains(uri)) {\n\t\t\t\t\tthis._conflicts.set(uri, true);\n\t\t\t\t\tthis._onDidConflict.fire(this);\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}));\n\n\t\t// listen to model changes...?\n\t\tconst onDidChangeModel = (model: ITextModel) => {\n\n\t\t\t// conflict\n\t\t\tif (_workspaceEditResources.has(model.uri)) {\n\t\t\t\tthis._conflicts.set(model.uri, true);\n\t\t\t\tthis._onDidConflict.fire(this);\n\t\t\t}\n\t\t};\n\t\tfor (const model of modelService.getModels()) {\n\t\t\tthis._disposables.add(model.onDidChangeContent(() => onDidChangeModel(model)));\n\t\t}\n\t}\n\n\tdispose(): void {\n\t\tthis._disposables.dispose();\n\t\tthis._onDidConflict.dispose();\n\t}\n\n\tlist(): URI[] {\n\t\treturn [...this._conflicts.keys()];\n\t}\n\n\thasConflicts(): boolean {\n\t\treturn this._conflicts.size > 0;\n\t}\n}\n"]}