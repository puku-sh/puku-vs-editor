{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/contrib/bulkEdit/browser/bulkCellEdits.ts","vs/workbench/contrib/bulkEdit/browser/bulkCellEdits.ts"],"names":[],"mappings":"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","file":"bulkCellEdits.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { groupBy } from '../../../../base/common/arrays.js';\nimport { CancellationToken } from '../../../../base/common/cancellation.js';\nimport { compare } from '../../../../base/common/strings.js';\nimport { isObject } from '../../../../base/common/types.js';\nimport { URI } from '../../../../base/common/uri.js';\nimport { ResourceEdit } from '../../../../editor/browser/services/bulkEditService.js';\nimport { WorkspaceEditMetadata } from '../../../../editor/common/languages.js';\nimport { IProgress } from '../../../../platform/progress/common/progress.js';\nimport { UndoRedoGroup, UndoRedoSource } from '../../../../platform/undoRedo/common/undoRedo.js';\nimport { getNotebookEditorFromEditorPane } from '../../notebook/browser/notebookBrowser.js';\nimport { CellUri, ICellPartialMetadataEdit, ICellReplaceEdit, IDocumentMetadataEdit, ISelectionState, IWorkspaceNotebookCellEdit, SelectionStateType } from '../../notebook/common/notebookCommon.js';\nimport { INotebookEditorModelResolverService } from '../../notebook/common/notebookEditorModelResolverService.js';\nimport { IEditorService } from '../../../services/editor/common/editorService.js';\n\nexport class ResourceNotebookCellEdit extends ResourceEdit implements IWorkspaceNotebookCellEdit {\n\n\tstatic is(candidate: any): candidate is IWorkspaceNotebookCellEdit {\n\t\tif (candidate instanceof ResourceNotebookCellEdit) {\n\t\t\treturn true;\n\t\t}\n\t\treturn URI.isUri((<IWorkspaceNotebookCellEdit>candidate).resource)\n\t\t\t&& isObject((<IWorkspaceNotebookCellEdit>candidate).cellEdit);\n\t}\n\n\tstatic lift(edit: IWorkspaceNotebookCellEdit): ResourceNotebookCellEdit {\n\t\tif (edit instanceof ResourceNotebookCellEdit) {\n\t\t\treturn edit;\n\t\t}\n\t\treturn new ResourceNotebookCellEdit(edit.resource, edit.cellEdit, edit.notebookVersionId, edit.metadata);\n\t}\n\n\tconstructor(\n\t\treadonly resource: URI,\n\t\treadonly cellEdit: ICellPartialMetadataEdit | IDocumentMetadataEdit | ICellReplaceEdit,\n\t\treadonly notebookVersionId: number | undefined = undefined,\n\t\tmetadata?: WorkspaceEditMetadata\n\t) {\n\t\tsuper(metadata);\n\t}\n}\n\nexport class BulkCellEdits {\n\n\tconstructor(\n\t\tprivate readonly _undoRedoGroup: UndoRedoGroup,\n\t\tundoRedoSource: UndoRedoSource | undefined,\n\t\tprivate readonly _progress: IProgress<void>,\n\t\tprivate readonly _token: CancellationToken,\n\t\tprivate readonly _edits: ResourceNotebookCellEdit[],\n\t\t@IEditorService private readonly _editorService: IEditorService,\n\t\t@INotebookEditorModelResolverService private readonly _notebookModelService: INotebookEditorModelResolverService,\n\t) {\n\t\tthis._edits = this._edits.map(e => {\n\t\t\tif (e.resource.scheme === CellUri.scheme) {\n\t\t\t\tconst uri = CellUri.parse(e.resource)?.notebook;\n\t\t\t\tif (!uri) {\n\t\t\t\t\tthrow new Error(`Invalid notebook URI: ${e.resource}`);\n\t\t\t\t}\n\n\t\t\t\treturn new ResourceNotebookCellEdit(uri, e.cellEdit, e.notebookVersionId, e.metadata);\n\t\t\t} else {\n\t\t\t\treturn e;\n\t\t\t}\n\t\t});\n\t}\n\n\tasync apply(): Promise<readonly URI[]> {\n\t\tconst resources: URI[] = [];\n\t\tconst editsByNotebook = groupBy(this._edits, (a, b) => compare(a.resource.toString(), b.resource.toString()));\n\n\t\tfor (const group of editsByNotebook) {\n\t\t\tif (this._token.isCancellationRequested) {\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tconst [first] = group;\n\t\t\tconst ref = await this._notebookModelService.resolve(first.resource);\n\n\t\t\t// check state\n\t\t\tif (typeof first.notebookVersionId === 'number' && ref.object.notebook.versionId !== first.notebookVersionId) {\n\t\t\t\tref.dispose();\n\t\t\t\tthrow new Error(`Notebook '${first.resource}' has changed in the meantime`);\n\t\t\t}\n\n\t\t\t// apply edits\n\t\t\tconst edits = group.map(entry => entry.cellEdit);\n\t\t\tconst computeUndo = !ref.object.isReadonly();\n\t\t\tconst editor = getNotebookEditorFromEditorPane(this._editorService.activeEditorPane);\n\t\t\tconst initialSelectionState: ISelectionState | undefined = editor?.textModel?.uri.toString() === ref.object.notebook.uri.toString() ? {\n\t\t\t\tkind: SelectionStateType.Index,\n\t\t\t\tfocus: editor.getFocus(),\n\t\t\t\tselections: editor.getSelections()\n\t\t\t} : undefined;\n\t\t\tref.object.notebook.applyEdits(edits, true, initialSelectionState, () => undefined, this._undoRedoGroup, computeUndo);\n\t\t\tref.dispose();\n\n\t\t\tthis._progress.report(undefined);\n\n\t\t\tresources.push(first.resource);\n\t\t}\n\n\t\treturn resources;\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { groupBy } from '../../../../base/common/arrays.js';\nimport { CancellationToken } from '../../../../base/common/cancellation.js';\nimport { compare } from '../../../../base/common/strings.js';\nimport { isObject } from '../../../../base/common/types.js';\nimport { URI } from '../../../../base/common/uri.js';\nimport { ResourceEdit } from '../../../../editor/browser/services/bulkEditService.js';\nimport { WorkspaceEditMetadata } from '../../../../editor/common/languages.js';\nimport { IProgress } from '../../../../platform/progress/common/progress.js';\nimport { UndoRedoGroup, UndoRedoSource } from '../../../../platform/undoRedo/common/undoRedo.js';\nimport { getNotebookEditorFromEditorPane } from '../../notebook/browser/notebookBrowser.js';\nimport { CellUri, ICellPartialMetadataEdit, ICellReplaceEdit, IDocumentMetadataEdit, ISelectionState, IWorkspaceNotebookCellEdit, SelectionStateType } from '../../notebook/common/notebookCommon.js';\nimport { INotebookEditorModelResolverService } from '../../notebook/common/notebookEditorModelResolverService.js';\nimport { IEditorService } from '../../../services/editor/common/editorService.js';\n\nexport class ResourceNotebookCellEdit extends ResourceEdit implements IWorkspaceNotebookCellEdit {\n\n\tstatic is(candidate: any): candidate is IWorkspaceNotebookCellEdit {\n\t\tif (candidate instanceof ResourceNotebookCellEdit) {\n\t\t\treturn true;\n\t\t}\n\t\treturn URI.isUri((<IWorkspaceNotebookCellEdit>candidate).resource)\n\t\t\t&& isObject((<IWorkspaceNotebookCellEdit>candidate).cellEdit);\n\t}\n\n\tstatic lift(edit: IWorkspaceNotebookCellEdit): ResourceNotebookCellEdit {\n\t\tif (edit instanceof ResourceNotebookCellEdit) {\n\t\t\treturn edit;\n\t\t}\n\t\treturn new ResourceNotebookCellEdit(edit.resource, edit.cellEdit, edit.notebookVersionId, edit.metadata);\n\t}\n\n\tconstructor(\n\t\treadonly resource: URI,\n\t\treadonly cellEdit: ICellPartialMetadataEdit | IDocumentMetadataEdit | ICellReplaceEdit,\n\t\treadonly notebookVersionId: number | undefined = undefined,\n\t\tmetadata?: WorkspaceEditMetadata\n\t) {\n\t\tsuper(metadata);\n\t}\n}\n\nexport class BulkCellEdits {\n\n\tconstructor(\n\t\tprivate readonly _undoRedoGroup: UndoRedoGroup,\n\t\tundoRedoSource: UndoRedoSource | undefined,\n\t\tprivate readonly _progress: IProgress<void>,\n\t\tprivate readonly _token: CancellationToken,\n\t\tprivate readonly _edits: ResourceNotebookCellEdit[],\n\t\t@IEditorService private readonly _editorService: IEditorService,\n\t\t@INotebookEditorModelResolverService private readonly _notebookModelService: INotebookEditorModelResolverService,\n\t) {\n\t\tthis._edits = this._edits.map(e => {\n\t\t\tif (e.resource.scheme === CellUri.scheme) {\n\t\t\t\tconst uri = CellUri.parse(e.resource)?.notebook;\n\t\t\t\tif (!uri) {\n\t\t\t\t\tthrow new Error(`Invalid notebook URI: ${e.resource}`);\n\t\t\t\t}\n\n\t\t\t\treturn new ResourceNotebookCellEdit(uri, e.cellEdit, e.notebookVersionId, e.metadata);\n\t\t\t} else {\n\t\t\t\treturn e;\n\t\t\t}\n\t\t});\n\t}\n\n\tasync apply(): Promise<readonly URI[]> {\n\t\tconst resources: URI[] = [];\n\t\tconst editsByNotebook = groupBy(this._edits, (a, b) => compare(a.resource.toString(), b.resource.toString()));\n\n\t\tfor (const group of editsByNotebook) {\n\t\t\tif (this._token.isCancellationRequested) {\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tconst [first] = group;\n\t\t\tconst ref = await this._notebookModelService.resolve(first.resource);\n\n\t\t\t// check state\n\t\t\tif (typeof first.notebookVersionId === 'number' && ref.object.notebook.versionId !== first.notebookVersionId) {\n\t\t\t\tref.dispose();\n\t\t\t\tthrow new Error(`Notebook '${first.resource}' has changed in the meantime`);\n\t\t\t}\n\n\t\t\t// apply edits\n\t\t\tconst edits = group.map(entry => entry.cellEdit);\n\t\t\tconst computeUndo = !ref.object.isReadonly();\n\t\t\tconst editor = getNotebookEditorFromEditorPane(this._editorService.activeEditorPane);\n\t\t\tconst initialSelectionState: ISelectionState | undefined = editor?.textModel?.uri.toString() === ref.object.notebook.uri.toString() ? {\n\t\t\t\tkind: SelectionStateType.Index,\n\t\t\t\tfocus: editor.getFocus(),\n\t\t\t\tselections: editor.getSelections()\n\t\t\t} : undefined;\n\t\t\tref.object.notebook.applyEdits(edits, true, initialSelectionState, () => undefined, this._undoRedoGroup, computeUndo);\n\t\t\tref.dispose();\n\n\t\t\tthis._progress.report(undefined);\n\n\t\t\tresources.push(first.resource);\n\t\t}\n\n\t\treturn resources;\n\t}\n}\n"]}