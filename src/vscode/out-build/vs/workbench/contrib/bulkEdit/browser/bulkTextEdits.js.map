{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/contrib/bulkEdit/browser/bulkTextEdits.ts","vs/workbench/contrib/bulkEdit/browser/bulkTextEdits.ts"],"names":[],"mappings":"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","file":"bulkTextEdits.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { dispose, IDisposable, IReference } from '../../../../base/common/lifecycle.js';\nimport { URI } from '../../../../base/common/uri.js';\nimport { ICodeEditor } from '../../../../editor/browser/editorBrowser.js';\nimport { EditOperation, ISingleEditOperation } from '../../../../editor/common/core/editOperation.js';\nimport { Range } from '../../../../editor/common/core/range.js';\nimport { Selection } from '../../../../editor/common/core/selection.js';\nimport { EndOfLineSequence, ITextModel } from '../../../../editor/common/model.js';\nimport { ITextModelService, IResolvedTextEditorModel } from '../../../../editor/common/services/resolverService.js';\nimport { IProgress } from '../../../../platform/progress/common/progress.js';\nimport { IEditorWorkerService } from '../../../../editor/common/services/editorWorker.js';\nimport { IUndoRedoService, UndoRedoGroup, UndoRedoSource } from '../../../../platform/undoRedo/common/undoRedo.js';\nimport { SingleModelEditStackElement, MultiModelEditStackElement } from '../../../../editor/common/model/editStack.js';\nimport { ResourceMap } from '../../../../base/common/map.js';\nimport { IModelService } from '../../../../editor/common/services/model.js';\nimport { ResourceTextEdit } from '../../../../editor/browser/services/bulkEditService.js';\nimport { CancellationToken } from '../../../../base/common/cancellation.js';\nimport { SnippetController2 } from '../../../../editor/contrib/snippet/browser/snippetController2.js';\nimport { SnippetParser } from '../../../../editor/contrib/snippet/browser/snippetParser.js';\nimport { ISnippetEdit } from '../../../../editor/contrib/snippet/browser/snippetSession.js';\nimport { TextModelEditSource } from '../../../../editor/common/textModelEditSource.js';\n\ntype ValidationResult = { canApply: true } | { canApply: false; reason: URI };\n\ntype ISingleSnippetEditOperation = ISingleEditOperation & { insertAsSnippet?: boolean; keepWhitespace?: boolean };\n\nclass ModelEditTask implements IDisposable {\n\n\treadonly model: ITextModel;\n\n\tprivate _expectedModelVersionId: number | undefined;\n\tprotected _edits: ISingleSnippetEditOperation[];\n\tprotected _newEol: EndOfLineSequence | undefined;\n\n\tconstructor(private readonly _modelReference: IReference<IResolvedTextEditorModel>) {\n\t\tthis.model = this._modelReference.object.textEditorModel;\n\t\tthis._edits = [];\n\t}\n\n\tdispose() {\n\t\tthis._modelReference.dispose();\n\t}\n\n\tisNoOp() {\n\t\tif (this._edits.length > 0) {\n\t\t\t// contains textual edits\n\t\t\treturn false;\n\t\t}\n\t\tif (this._newEol !== undefined && this._newEol !== this.model.getEndOfLineSequence()) {\n\t\t\t// contains an eol change that is a real change\n\t\t\treturn false;\n\t\t}\n\t\treturn true;\n\t}\n\n\taddEdit(resourceEdit: ResourceTextEdit): void {\n\t\tthis._expectedModelVersionId = resourceEdit.versionId;\n\t\tconst { textEdit } = resourceEdit;\n\n\t\tif (typeof textEdit.eol === 'number') {\n\t\t\t// honor eol-change\n\t\t\tthis._newEol = textEdit.eol;\n\t\t}\n\t\tif (!textEdit.range && !textEdit.text) {\n\t\t\t// lacks both a range and the text\n\t\t\treturn;\n\t\t}\n\t\tif (Range.isEmpty(textEdit.range) && !textEdit.text) {\n\t\t\t// no-op edit (replace empty range with empty text)\n\t\t\treturn;\n\t\t}\n\n\t\t// create edit operation\n\t\tlet range: Range;\n\t\tif (!textEdit.range) {\n\t\t\trange = this.model.getFullModelRange();\n\t\t} else {\n\t\t\trange = Range.lift(textEdit.range);\n\t\t}\n\t\tthis._edits.push({ ...EditOperation.replaceMove(range, textEdit.text), insertAsSnippet: textEdit.insertAsSnippet, keepWhitespace: textEdit.keepWhitespace });\n\t}\n\n\tvalidate(): ValidationResult {\n\t\tif (typeof this._expectedModelVersionId === 'undefined' || this.model.getVersionId() === this._expectedModelVersionId) {\n\t\t\treturn { canApply: true };\n\t\t}\n\t\treturn { canApply: false, reason: this.model.uri };\n\t}\n\n\tgetBeforeCursorState(): Selection[] | null {\n\t\treturn null;\n\t}\n\n\tapply(reason?: TextModelEditSource): void {\n\t\tif (this._edits.length > 0) {\n\t\t\tthis._edits = this._edits\n\t\t\t\t.map(this._transformSnippetStringToInsertText, this) // no editor -> no snippet mode\n\t\t\t\t.sort((a, b) => Range.compareRangesUsingStarts(a.range, b.range));\n\t\t\tthis.model.pushEditOperations(null, this._edits, () => null, undefined, reason);\n\t\t}\n\t\tif (this._newEol !== undefined) {\n\t\t\tthis.model.pushEOL(this._newEol);\n\t\t}\n\t}\n\n\tprotected _transformSnippetStringToInsertText(edit: ISingleSnippetEditOperation): ISingleSnippetEditOperation {\n\t\t// transform a snippet edit (and only those) into a normal text edit\n\t\t// for that we need to parse the snippet and get its actual text, e.g without placeholder\n\t\t// or variable syntaxes\n\t\tif (!edit.insertAsSnippet) {\n\t\t\treturn edit;\n\t\t}\n\t\tif (!edit.text) {\n\t\t\treturn edit;\n\t\t}\n\t\tconst text = SnippetParser.asInsertText(edit.text);\n\t\treturn { ...edit, insertAsSnippet: false, text };\n\t}\n}\n\nclass EditorEditTask extends ModelEditTask {\n\n\tprivate readonly _editor: ICodeEditor;\n\n\tconstructor(modelReference: IReference<IResolvedTextEditorModel>, editor: ICodeEditor) {\n\t\tsuper(modelReference);\n\t\tthis._editor = editor;\n\t}\n\n\toverride getBeforeCursorState(): Selection[] | null {\n\t\treturn this._canUseEditor() ? this._editor.getSelections() : null;\n\t}\n\n\toverride apply(reason?: TextModelEditSource): void {\n\n\t\t// Check that the editor is still for the wanted model. It might have changed in the\n\t\t// meantime and that means we cannot use the editor anymore (instead we perform the edit through the model)\n\t\tif (!this._canUseEditor()) {\n\t\t\tsuper.apply();\n\t\t\treturn;\n\t\t}\n\n\t\tif (this._edits.length > 0) {\n\t\t\tconst snippetCtrl = SnippetController2.get(this._editor);\n\t\t\tif (snippetCtrl && this._edits.some(edit => edit.insertAsSnippet)) {\n\t\t\t\t// some edit is a snippet edit -> use snippet controller and ISnippetEdits\n\t\t\t\tconst snippetEdits: ISnippetEdit[] = [];\n\t\t\t\tfor (const edit of this._edits) {\n\t\t\t\t\tif (edit.range && edit.text !== null) {\n\t\t\t\t\t\tsnippetEdits.push({\n\t\t\t\t\t\t\trange: Range.lift(edit.range),\n\t\t\t\t\t\t\ttemplate: edit.insertAsSnippet ? edit.text : SnippetParser.escape(edit.text),\n\t\t\t\t\t\t\tkeepWhitespace: edit.keepWhitespace\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tsnippetCtrl.apply(snippetEdits, { undoStopBefore: false, undoStopAfter: false });\n\n\t\t\t} else {\n\t\t\t\t// normal edit\n\t\t\t\tthis._edits = this._edits\n\t\t\t\t\t.map(this._transformSnippetStringToInsertText, this) // mixed edits (snippet and normal) -> no snippet mode\n\t\t\t\t\t.sort((a, b) => Range.compareRangesUsingStarts(a.range, b.range));\n\t\t\t\tthis._editor.executeEdits(reason, this._edits);\n\t\t\t}\n\t\t}\n\t\tif (this._newEol !== undefined) {\n\t\t\tif (this._editor.hasModel()) {\n\t\t\t\tthis._editor.getModel().pushEOL(this._newEol);\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate _canUseEditor(): boolean {\n\t\treturn this._editor?.getModel()?.uri.toString() === this.model.uri.toString();\n\t}\n}\n\nexport class BulkTextEdits {\n\n\tprivate readonly _edits = new ResourceMap<ResourceTextEdit[]>();\n\n\tconstructor(\n\t\tprivate readonly _label: string,\n\t\tprivate readonly _code: string,\n\t\tprivate readonly _editor: ICodeEditor | undefined,\n\t\tprivate readonly _undoRedoGroup: UndoRedoGroup,\n\t\tprivate readonly _undoRedoSource: UndoRedoSource | undefined,\n\t\tprivate readonly _progress: IProgress<void>,\n\t\tprivate readonly _token: CancellationToken,\n\t\tedits: ResourceTextEdit[],\n\t\t@IEditorWorkerService private readonly _editorWorker: IEditorWorkerService,\n\t\t@IModelService private readonly _modelService: IModelService,\n\t\t@ITextModelService private readonly _textModelResolverService: ITextModelService,\n\t\t@IUndoRedoService private readonly _undoRedoService: IUndoRedoService\n\t) {\n\n\t\tfor (const edit of edits) {\n\t\t\tlet array = this._edits.get(edit.resource);\n\t\t\tif (!array) {\n\t\t\t\tarray = [];\n\t\t\t\tthis._edits.set(edit.resource, array);\n\t\t\t}\n\t\t\tarray.push(edit);\n\t\t}\n\t}\n\n\tprivate _validateBeforePrepare(): void {\n\t\t// First check if loaded models were not changed in the meantime\n\t\tfor (const array of this._edits.values()) {\n\t\t\tfor (const edit of array) {\n\t\t\t\tif (typeof edit.versionId === 'number') {\n\t\t\t\t\tconst model = this._modelService.getModel(edit.resource);\n\t\t\t\t\tif (model && model.getVersionId() !== edit.versionId) {\n\t\t\t\t\t\t// model changed in the meantime\n\t\t\t\t\t\tthrow new Error(`${model.uri.toString()} has changed in the meantime`);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate async _createEditsTasks(): Promise<ModelEditTask[]> {\n\n\t\tconst tasks: ModelEditTask[] = [];\n\t\tconst promises: Promise<any>[] = [];\n\n\t\tfor (const [key, edits] of this._edits) {\n\t\t\tconst promise = this._textModelResolverService.createModelReference(key).then(async ref => {\n\t\t\t\tlet task: ModelEditTask;\n\t\t\t\tlet makeMinimal = false;\n\t\t\t\tif (this._editor?.getModel()?.uri.toString() === ref.object.textEditorModel.uri.toString()) {\n\t\t\t\t\ttask = new EditorEditTask(ref, this._editor);\n\t\t\t\t\tmakeMinimal = true;\n\t\t\t\t} else {\n\t\t\t\t\ttask = new ModelEditTask(ref);\n\t\t\t\t}\n\t\t\t\ttasks.push(task);\n\n\n\t\t\t\tif (!makeMinimal) {\n\t\t\t\t\tedits.forEach(task.addEdit, task);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t// group edits by type (snippet, metadata, or simple) and make simple groups more minimal\n\n\t\t\t\tconst makeGroupMoreMinimal = async (start: number, end: number) => {\n\t\t\t\t\tconst oldEdits = edits.slice(start, end);\n\t\t\t\t\tconst newEdits = await this._editorWorker.computeMoreMinimalEdits(ref.object.textEditorModel.uri, oldEdits.map(e => e.textEdit), false);\n\t\t\t\t\tif (!newEdits) {\n\t\t\t\t\t\toldEdits.forEach(task.addEdit, task);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tnewEdits.forEach(edit => task.addEdit(new ResourceTextEdit(ref.object.textEditorModel.uri, edit, undefined, undefined)));\n\t\t\t\t\t}\n\t\t\t\t};\n\n\t\t\t\tlet start = 0;\n\t\t\t\tlet i = 0;\n\t\t\t\tfor (; i < edits.length; i++) {\n\t\t\t\t\tif (edits[i].textEdit.insertAsSnippet || edits[i].metadata) {\n\t\t\t\t\t\tawait makeGroupMoreMinimal(start, i); // grouped edits until now\n\t\t\t\t\t\ttask.addEdit(edits[i]); // this edit\n\t\t\t\t\t\tstart = i + 1;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tawait makeGroupMoreMinimal(start, i);\n\n\t\t\t});\n\t\t\tpromises.push(promise);\n\t\t}\n\n\t\tawait Promise.all(promises);\n\t\treturn tasks;\n\t}\n\n\tprivate _validateTasks(tasks: ModelEditTask[]): ValidationResult {\n\t\tfor (const task of tasks) {\n\t\t\tconst result = task.validate();\n\t\t\tif (!result.canApply) {\n\t\t\t\treturn result;\n\t\t\t}\n\t\t}\n\t\treturn { canApply: true };\n\t}\n\n\tasync apply(reason?: TextModelEditSource): Promise<readonly URI[]> {\n\n\t\tthis._validateBeforePrepare();\n\t\tconst tasks = await this._createEditsTasks();\n\n\t\ttry {\n\t\t\tif (this._token.isCancellationRequested) {\n\t\t\t\treturn [];\n\t\t\t}\n\n\t\t\tconst resources: URI[] = [];\n\t\t\tconst validation = this._validateTasks(tasks);\n\t\t\tif (!validation.canApply) {\n\t\t\t\tthrow new Error(`${validation.reason.toString()} has changed in the meantime`);\n\t\t\t}\n\t\t\tif (tasks.length === 1) {\n\t\t\t\t// This edit touches a single model => keep things simple\n\t\t\t\tconst task = tasks[0];\n\t\t\t\tif (!task.isNoOp()) {\n\t\t\t\t\tconst singleModelEditStackElement = new SingleModelEditStackElement(this._label, this._code, task.model, task.getBeforeCursorState());\n\t\t\t\t\tthis._undoRedoService.pushElement(singleModelEditStackElement, this._undoRedoGroup, this._undoRedoSource);\n\t\t\t\t\ttask.apply(reason);\n\t\t\t\t\tsingleModelEditStackElement.close();\n\t\t\t\t\tresources.push(task.model.uri);\n\t\t\t\t}\n\t\t\t\tthis._progress.report(undefined);\n\t\t\t} else {\n\t\t\t\t// prepare multi model undo element\n\t\t\t\tconst multiModelEditStackElement = new MultiModelEditStackElement(\n\t\t\t\t\tthis._label,\n\t\t\t\t\tthis._code,\n\t\t\t\t\ttasks.map(t => new SingleModelEditStackElement(this._label, this._code, t.model, t.getBeforeCursorState()))\n\t\t\t\t);\n\t\t\t\tthis._undoRedoService.pushElement(multiModelEditStackElement, this._undoRedoGroup, this._undoRedoSource);\n\t\t\t\tfor (const task of tasks) {\n\t\t\t\t\ttask.apply();\n\t\t\t\t\tthis._progress.report(undefined);\n\t\t\t\t\tresources.push(task.model.uri);\n\t\t\t\t}\n\t\t\t\tmultiModelEditStackElement.close();\n\t\t\t}\n\n\t\t\treturn resources;\n\n\t\t} finally {\n\t\t\tdispose(tasks);\n\t\t}\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { dispose, IDisposable, IReference } from '../../../../base/common/lifecycle.js';\nimport { URI } from '../../../../base/common/uri.js';\nimport { ICodeEditor } from '../../../../editor/browser/editorBrowser.js';\nimport { EditOperation, ISingleEditOperation } from '../../../../editor/common/core/editOperation.js';\nimport { Range } from '../../../../editor/common/core/range.js';\nimport { Selection } from '../../../../editor/common/core/selection.js';\nimport { EndOfLineSequence, ITextModel } from '../../../../editor/common/model.js';\nimport { ITextModelService, IResolvedTextEditorModel } from '../../../../editor/common/services/resolverService.js';\nimport { IProgress } from '../../../../platform/progress/common/progress.js';\nimport { IEditorWorkerService } from '../../../../editor/common/services/editorWorker.js';\nimport { IUndoRedoService, UndoRedoGroup, UndoRedoSource } from '../../../../platform/undoRedo/common/undoRedo.js';\nimport { SingleModelEditStackElement, MultiModelEditStackElement } from '../../../../editor/common/model/editStack.js';\nimport { ResourceMap } from '../../../../base/common/map.js';\nimport { IModelService } from '../../../../editor/common/services/model.js';\nimport { ResourceTextEdit } from '../../../../editor/browser/services/bulkEditService.js';\nimport { CancellationToken } from '../../../../base/common/cancellation.js';\nimport { SnippetController2 } from '../../../../editor/contrib/snippet/browser/snippetController2.js';\nimport { SnippetParser } from '../../../../editor/contrib/snippet/browser/snippetParser.js';\nimport { ISnippetEdit } from '../../../../editor/contrib/snippet/browser/snippetSession.js';\nimport { TextModelEditSource } from '../../../../editor/common/textModelEditSource.js';\n\ntype ValidationResult = { canApply: true } | { canApply: false; reason: URI };\n\ntype ISingleSnippetEditOperation = ISingleEditOperation & { insertAsSnippet?: boolean; keepWhitespace?: boolean };\n\nclass ModelEditTask implements IDisposable {\n\n\treadonly model: ITextModel;\n\n\tprivate _expectedModelVersionId: number | undefined;\n\tprotected _edits: ISingleSnippetEditOperation[];\n\tprotected _newEol: EndOfLineSequence | undefined;\n\n\tconstructor(private readonly _modelReference: IReference<IResolvedTextEditorModel>) {\n\t\tthis.model = this._modelReference.object.textEditorModel;\n\t\tthis._edits = [];\n\t}\n\n\tdispose() {\n\t\tthis._modelReference.dispose();\n\t}\n\n\tisNoOp() {\n\t\tif (this._edits.length > 0) {\n\t\t\t// contains textual edits\n\t\t\treturn false;\n\t\t}\n\t\tif (this._newEol !== undefined && this._newEol !== this.model.getEndOfLineSequence()) {\n\t\t\t// contains an eol change that is a real change\n\t\t\treturn false;\n\t\t}\n\t\treturn true;\n\t}\n\n\taddEdit(resourceEdit: ResourceTextEdit): void {\n\t\tthis._expectedModelVersionId = resourceEdit.versionId;\n\t\tconst { textEdit } = resourceEdit;\n\n\t\tif (typeof textEdit.eol === 'number') {\n\t\t\t// honor eol-change\n\t\t\tthis._newEol = textEdit.eol;\n\t\t}\n\t\tif (!textEdit.range && !textEdit.text) {\n\t\t\t// lacks both a range and the text\n\t\t\treturn;\n\t\t}\n\t\tif (Range.isEmpty(textEdit.range) && !textEdit.text) {\n\t\t\t// no-op edit (replace empty range with empty text)\n\t\t\treturn;\n\t\t}\n\n\t\t// create edit operation\n\t\tlet range: Range;\n\t\tif (!textEdit.range) {\n\t\t\trange = this.model.getFullModelRange();\n\t\t} else {\n\t\t\trange = Range.lift(textEdit.range);\n\t\t}\n\t\tthis._edits.push({ ...EditOperation.replaceMove(range, textEdit.text), insertAsSnippet: textEdit.insertAsSnippet, keepWhitespace: textEdit.keepWhitespace });\n\t}\n\n\tvalidate(): ValidationResult {\n\t\tif (typeof this._expectedModelVersionId === 'undefined' || this.model.getVersionId() === this._expectedModelVersionId) {\n\t\t\treturn { canApply: true };\n\t\t}\n\t\treturn { canApply: false, reason: this.model.uri };\n\t}\n\n\tgetBeforeCursorState(): Selection[] | null {\n\t\treturn null;\n\t}\n\n\tapply(reason?: TextModelEditSource): void {\n\t\tif (this._edits.length > 0) {\n\t\t\tthis._edits = this._edits\n\t\t\t\t.map(this._transformSnippetStringToInsertText, this) // no editor -> no snippet mode\n\t\t\t\t.sort((a, b) => Range.compareRangesUsingStarts(a.range, b.range));\n\t\t\tthis.model.pushEditOperations(null, this._edits, () => null, undefined, reason);\n\t\t}\n\t\tif (this._newEol !== undefined) {\n\t\t\tthis.model.pushEOL(this._newEol);\n\t\t}\n\t}\n\n\tprotected _transformSnippetStringToInsertText(edit: ISingleSnippetEditOperation): ISingleSnippetEditOperation {\n\t\t// transform a snippet edit (and only those) into a normal text edit\n\t\t// for that we need to parse the snippet and get its actual text, e.g without placeholder\n\t\t// or variable syntaxes\n\t\tif (!edit.insertAsSnippet) {\n\t\t\treturn edit;\n\t\t}\n\t\tif (!edit.text) {\n\t\t\treturn edit;\n\t\t}\n\t\tconst text = SnippetParser.asInsertText(edit.text);\n\t\treturn { ...edit, insertAsSnippet: false, text };\n\t}\n}\n\nclass EditorEditTask extends ModelEditTask {\n\n\tprivate readonly _editor: ICodeEditor;\n\n\tconstructor(modelReference: IReference<IResolvedTextEditorModel>, editor: ICodeEditor) {\n\t\tsuper(modelReference);\n\t\tthis._editor = editor;\n\t}\n\n\toverride getBeforeCursorState(): Selection[] | null {\n\t\treturn this._canUseEditor() ? this._editor.getSelections() : null;\n\t}\n\n\toverride apply(reason?: TextModelEditSource): void {\n\n\t\t// Check that the editor is still for the wanted model. It might have changed in the\n\t\t// meantime and that means we cannot use the editor anymore (instead we perform the edit through the model)\n\t\tif (!this._canUseEditor()) {\n\t\t\tsuper.apply();\n\t\t\treturn;\n\t\t}\n\n\t\tif (this._edits.length > 0) {\n\t\t\tconst snippetCtrl = SnippetController2.get(this._editor);\n\t\t\tif (snippetCtrl && this._edits.some(edit => edit.insertAsSnippet)) {\n\t\t\t\t// some edit is a snippet edit -> use snippet controller and ISnippetEdits\n\t\t\t\tconst snippetEdits: ISnippetEdit[] = [];\n\t\t\t\tfor (const edit of this._edits) {\n\t\t\t\t\tif (edit.range && edit.text !== null) {\n\t\t\t\t\t\tsnippetEdits.push({\n\t\t\t\t\t\t\trange: Range.lift(edit.range),\n\t\t\t\t\t\t\ttemplate: edit.insertAsSnippet ? edit.text : SnippetParser.escape(edit.text),\n\t\t\t\t\t\t\tkeepWhitespace: edit.keepWhitespace\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tsnippetCtrl.apply(snippetEdits, { undoStopBefore: false, undoStopAfter: false });\n\n\t\t\t} else {\n\t\t\t\t// normal edit\n\t\t\t\tthis._edits = this._edits\n\t\t\t\t\t.map(this._transformSnippetStringToInsertText, this) // mixed edits (snippet and normal) -> no snippet mode\n\t\t\t\t\t.sort((a, b) => Range.compareRangesUsingStarts(a.range, b.range));\n\t\t\t\tthis._editor.executeEdits(reason, this._edits);\n\t\t\t}\n\t\t}\n\t\tif (this._newEol !== undefined) {\n\t\t\tif (this._editor.hasModel()) {\n\t\t\t\tthis._editor.getModel().pushEOL(this._newEol);\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate _canUseEditor(): boolean {\n\t\treturn this._editor?.getModel()?.uri.toString() === this.model.uri.toString();\n\t}\n}\n\nexport class BulkTextEdits {\n\n\tprivate readonly _edits = new ResourceMap<ResourceTextEdit[]>();\n\n\tconstructor(\n\t\tprivate readonly _label: string,\n\t\tprivate readonly _code: string,\n\t\tprivate readonly _editor: ICodeEditor | undefined,\n\t\tprivate readonly _undoRedoGroup: UndoRedoGroup,\n\t\tprivate readonly _undoRedoSource: UndoRedoSource | undefined,\n\t\tprivate readonly _progress: IProgress<void>,\n\t\tprivate readonly _token: CancellationToken,\n\t\tedits: ResourceTextEdit[],\n\t\t@IEditorWorkerService private readonly _editorWorker: IEditorWorkerService,\n\t\t@IModelService private readonly _modelService: IModelService,\n\t\t@ITextModelService private readonly _textModelResolverService: ITextModelService,\n\t\t@IUndoRedoService private readonly _undoRedoService: IUndoRedoService\n\t) {\n\n\t\tfor (const edit of edits) {\n\t\t\tlet array = this._edits.get(edit.resource);\n\t\t\tif (!array) {\n\t\t\t\tarray = [];\n\t\t\t\tthis._edits.set(edit.resource, array);\n\t\t\t}\n\t\t\tarray.push(edit);\n\t\t}\n\t}\n\n\tprivate _validateBeforePrepare(): void {\n\t\t// First check if loaded models were not changed in the meantime\n\t\tfor (const array of this._edits.values()) {\n\t\t\tfor (const edit of array) {\n\t\t\t\tif (typeof edit.versionId === 'number') {\n\t\t\t\t\tconst model = this._modelService.getModel(edit.resource);\n\t\t\t\t\tif (model && model.getVersionId() !== edit.versionId) {\n\t\t\t\t\t\t// model changed in the meantime\n\t\t\t\t\t\tthrow new Error(`${model.uri.toString()} has changed in the meantime`);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate async _createEditsTasks(): Promise<ModelEditTask[]> {\n\n\t\tconst tasks: ModelEditTask[] = [];\n\t\tconst promises: Promise<any>[] = [];\n\n\t\tfor (const [key, edits] of this._edits) {\n\t\t\tconst promise = this._textModelResolverService.createModelReference(key).then(async ref => {\n\t\t\t\tlet task: ModelEditTask;\n\t\t\t\tlet makeMinimal = false;\n\t\t\t\tif (this._editor?.getModel()?.uri.toString() === ref.object.textEditorModel.uri.toString()) {\n\t\t\t\t\ttask = new EditorEditTask(ref, this._editor);\n\t\t\t\t\tmakeMinimal = true;\n\t\t\t\t} else {\n\t\t\t\t\ttask = new ModelEditTask(ref);\n\t\t\t\t}\n\t\t\t\ttasks.push(task);\n\n\n\t\t\t\tif (!makeMinimal) {\n\t\t\t\t\tedits.forEach(task.addEdit, task);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t// group edits by type (snippet, metadata, or simple) and make simple groups more minimal\n\n\t\t\t\tconst makeGroupMoreMinimal = async (start: number, end: number) => {\n\t\t\t\t\tconst oldEdits = edits.slice(start, end);\n\t\t\t\t\tconst newEdits = await this._editorWorker.computeMoreMinimalEdits(ref.object.textEditorModel.uri, oldEdits.map(e => e.textEdit), false);\n\t\t\t\t\tif (!newEdits) {\n\t\t\t\t\t\toldEdits.forEach(task.addEdit, task);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tnewEdits.forEach(edit => task.addEdit(new ResourceTextEdit(ref.object.textEditorModel.uri, edit, undefined, undefined)));\n\t\t\t\t\t}\n\t\t\t\t};\n\n\t\t\t\tlet start = 0;\n\t\t\t\tlet i = 0;\n\t\t\t\tfor (; i < edits.length; i++) {\n\t\t\t\t\tif (edits[i].textEdit.insertAsSnippet || edits[i].metadata) {\n\t\t\t\t\t\tawait makeGroupMoreMinimal(start, i); // grouped edits until now\n\t\t\t\t\t\ttask.addEdit(edits[i]); // this edit\n\t\t\t\t\t\tstart = i + 1;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tawait makeGroupMoreMinimal(start, i);\n\n\t\t\t});\n\t\t\tpromises.push(promise);\n\t\t}\n\n\t\tawait Promise.all(promises);\n\t\treturn tasks;\n\t}\n\n\tprivate _validateTasks(tasks: ModelEditTask[]): ValidationResult {\n\t\tfor (const task of tasks) {\n\t\t\tconst result = task.validate();\n\t\t\tif (!result.canApply) {\n\t\t\t\treturn result;\n\t\t\t}\n\t\t}\n\t\treturn { canApply: true };\n\t}\n\n\tasync apply(reason?: TextModelEditSource): Promise<readonly URI[]> {\n\n\t\tthis._validateBeforePrepare();\n\t\tconst tasks = await this._createEditsTasks();\n\n\t\ttry {\n\t\t\tif (this._token.isCancellationRequested) {\n\t\t\t\treturn [];\n\t\t\t}\n\n\t\t\tconst resources: URI[] = [];\n\t\t\tconst validation = this._validateTasks(tasks);\n\t\t\tif (!validation.canApply) {\n\t\t\t\tthrow new Error(`${validation.reason.toString()} has changed in the meantime`);\n\t\t\t}\n\t\t\tif (tasks.length === 1) {\n\t\t\t\t// This edit touches a single model => keep things simple\n\t\t\t\tconst task = tasks[0];\n\t\t\t\tif (!task.isNoOp()) {\n\t\t\t\t\tconst singleModelEditStackElement = new SingleModelEditStackElement(this._label, this._code, task.model, task.getBeforeCursorState());\n\t\t\t\t\tthis._undoRedoService.pushElement(singleModelEditStackElement, this._undoRedoGroup, this._undoRedoSource);\n\t\t\t\t\ttask.apply(reason);\n\t\t\t\t\tsingleModelEditStackElement.close();\n\t\t\t\t\tresources.push(task.model.uri);\n\t\t\t\t}\n\t\t\t\tthis._progress.report(undefined);\n\t\t\t} else {\n\t\t\t\t// prepare multi model undo element\n\t\t\t\tconst multiModelEditStackElement = new MultiModelEditStackElement(\n\t\t\t\t\tthis._label,\n\t\t\t\t\tthis._code,\n\t\t\t\t\ttasks.map(t => new SingleModelEditStackElement(this._label, this._code, t.model, t.getBeforeCursorState()))\n\t\t\t\t);\n\t\t\t\tthis._undoRedoService.pushElement(multiModelEditStackElement, this._undoRedoGroup, this._undoRedoSource);\n\t\t\t\tfor (const task of tasks) {\n\t\t\t\t\ttask.apply();\n\t\t\t\t\tthis._progress.report(undefined);\n\t\t\t\t\tresources.push(task.model.uri);\n\t\t\t\t}\n\t\t\t\tmultiModelEditStackElement.close();\n\t\t\t}\n\n\t\t\treturn resources;\n\n\t\t} finally {\n\t\t\tdispose(tasks);\n\t\t}\n\t}\n}\n"]}