{"version":3,"sources":["vs/workbench/contrib/terminalContrib/chat/browser/terminalChatWidget.ts"],"names":[],"mappings":"AAAA;;;gGAGgG;;;;;;;;;;AAGhG,OAAO,EAAE,SAAS,EAAE,eAAe,EAAiB,UAAU,EAAE,MAAM,oCAAoC,CAAC;AAC3G,OAAO,EAAqB,uBAAuB,EAAE,eAAe,EAAE,MAAM,qCAAqC,CAAC;AAClH,OAAO,EAAE,uBAAuB,EAAE,MAAM,4CAA4C,CAAC;AACrF,OAAO,EAAE,OAAO,EAAE,KAAK,EAAE,MAAM,qCAAqC,CAAC;AACrE,OAAO,EAAE,UAAU,EAAE,eAAe,EAAE,iBAAiB,EAAE,YAAY,EAAE,MAAM,yCAAyC,CAAC;AACvH,OAAO,EAAE,OAAO,EAAE,eAAe,EAAoB,MAAM,0CAA0C,CAAC;AACtG,OAAO,EAAE,cAAc,EAAE,MAAM,uCAAuC,CAAC;AACvE,OAAO,EAAE,QAAQ,EAAE,MAAM,uBAAuB,CAAC;AACjD,OAAO,EAAE,MAAM,EAAE,MAAM,mDAAmD,CAAC;AAC3E,OAAO,EAAe,kBAAkB,EAAE,MAAM,yDAAyD,CAAC;AAC1G,OAAO,EAAE,qBAAqB,EAAE,MAAM,+DAA+D,CAAC;AACtG,OAAO,EAAE,eAAe,EAA+B,MAAM,mDAAmD,CAAC;AACjH,OAAO,EAA2B,kBAAkB,EAAE,MAAM,+BAA+B,CAAC;AAC5F,OAAO,EAAE,iBAAiB,EAAE,MAAM,oCAAoC,CAAC;AACvE,OAAO,EAAiC,4BAA4B,EAAE,MAAM,mCAAmC,CAAC;AAChH,OAAO,EAAE,QAAQ,EAAE,MAAM,mCAAmC,CAAC;AAC7D,OAAO,EAAiB,YAAY,EAAE,MAAM,qCAAqC,CAAC;AAClF,OAAO,EAAE,iBAAiB,EAAE,MAAM,mCAAmC,CAAC;AACtE,OAAO,EAAE,gBAAgB,EAAE,MAAM,iDAAiD,CAAC;AACnF,OAAO,EAAE,iCAAiC,EAAE,MAAM,0CAA0C,CAAC;AAE7F,OAAO,EAAE,gCAAgC,EAAE,MAAM,gEAAgE,CAAC;AAClH,OAAO,gCAAgC,CAAC;AACxC,OAAO,EAAE,4CAA4C,EAAE,gCAAgC,EAAyB,uBAAuB,EAAE,MAAM,mBAAmB,CAAC;AAEnK,IAAW,SASV;AATD,WAAW,SAAS;IACnB,kEAAqB,CAAA;IACrB,8DAAmB,CAAA;IACnB,0FAA0F;IAC1F,0DAAiB,CAAA;IACjB,4CAA4C;IAC5C,qDAAe,CAAA;IACf,qFAAqF;IACrF,8FAAoC,CAAA;AACrC,CAAC,EATU,SAAS,KAAT,SAAS,QASnB;AAED,IAAW,OASV;AATD,WAAW,OAAO;IACjB,qCAAQ,CAAA;IACR,uDAAsB,CAAA;IACtB,uDAAsB,CAAA;IACtB,qDAAqB,CAAA;IACrB,uDAAsB,CAAA;IACtB,oDAAoB,CAAA;IACpB,oDAAoB,CAAA;IACpB,oDAAoB,CAAA;AACrB,CAAC,EATU,OAAO,KAAP,OAAO,QASjB;AAEM,IAAM,kBAAkB,GAAxB,MAAM,kBAAmB,SAAQ,UAAU;IAQjD,IAAW,gBAAgB,KAAuB,OAAO,IAAI,CAAC,iBAAiB,CAAC,CAAC,CAAC;IAgBlF,IAAI,mBAAmB;QACtB,OAAO,IAAI,CAAC,oBAAoB,CAAC;IAClC,CAAC;IAcD,YACkB,gBAA6B,EAC7B,SAA4B,EAC5B,MAAkD,EAC/C,iBAAqC,EAC3C,YAA2C,EACxC,eAAiD,EAC3C,oBAA2C,EAC/C,iBAAqD,EACpD,kBAAuD;QAE3E,KAAK,EAAE,CAAC;QAVS,qBAAgB,GAAhB,gBAAgB,CAAa;QAC7B,cAAS,GAAT,SAAS,CAAmB;QAC5B,WAAM,GAAN,MAAM,CAA4C;QAEpC,iBAAY,GAAZ,YAAY,CAAc;QACvB,oBAAe,GAAf,eAAe,CAAiB;QAE9B,sBAAiB,GAAjB,iBAAiB,CAAmB;QACnC,uBAAkB,GAAlB,kBAAkB,CAAoB;QA7C3D,eAAU,GAAG,IAAI,CAAC,SAAS,CAAC,IAAI,OAAO,EAAQ,CAAC,CAAC;QACzD,cAAS,GAAG,IAAI,CAAC,UAAU,CAAC,KAAK,CAAC;QAcnC,cAAS,GAAG,IAAI,CAAC,MAAM,CAAC,GAAG,CAAC,IAAI,OAAO,EAAW,CAAC,CAAC;QAEpD,yBAAoB,GAAG,iCAAiC,CAAC;QAOzD,uBAAkB,GAAG,UAAU,CAAC;QAEvB,WAAM,GAAiC,IAAI,CAAC,SAAS,CAAC,IAAI,iBAAiB,EAAE,CAAC,CAAC;QAO/E,uBAAkB,GAAG,eAAe,CAAC,IAAI,EAAE,KAAK,CAAC,CAAC;QAC1D,sBAAiB,GAAyB,IAAI,CAAC,kBAAkB,CAAC;QAe1E,IAAI,CAAC,kBAAkB,GAAG,uBAAuB,CAAC,OAAO,CAAC,MAAM,CAAC,iBAAiB,CAAC,CAAC;QACpF,IAAI,CAAC,kBAAkB,GAAG,uBAAuB,CAAC,OAAO,CAAC,MAAM,CAAC,iBAAiB,CAAC,CAAC;QACpF,IAAI,CAAC,wBAAwB,GAAG,uBAAuB,CAAC,aAAa,CAAC,MAAM,CAAC,iBAAiB,CAAC,CAAC;QAChG,IAAI,CAAC,oCAAoC,GAAG,uBAAuB,CAAC,yBAAyB,CAAC,MAAM,CAAC,iBAAiB,CAAC,CAAC;QACxH,IAAI,CAAC,6CAA6C,GAAG,uBAAuB,CAAC,kCAAkC,CAAC,MAAM,CAAC,iBAAiB,CAAC,CAAC;QAE1I,IAAI,CAAC,UAAU,GAAG,QAAQ,CAAC,aAAa,CAAC,KAAK,CAAC,CAAC;QAChD,IAAI,CAAC,UAAU,CAAC,SAAS,CAAC,GAAG,CAAC,sBAAsB,CAAC,CAAC;QACtD,IAAI,CAAC,gBAAgB,CAAC,WAAW,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC;QAEnD,IAAI,CAAC,iBAAiB,GAAG,oBAAoB,CAAC,cAAc,CAC3D,gBAAgB,EAChB;YACC,QAAQ,EAAE,iBAAiB,CAAC,QAAQ;YACpC,WAAW,EAAE,GAAG,EAAE;gBACjB,iEAAiE;gBACjE,OAAO,SAAS,CAAC;YAClB,CAAC;SACD,EACD;YACC,YAAY,EAAE;gBACb,IAAI,EAAE,gCAAgC;gBACtC,OAAO,EAAE;oBACR,oBAAoB,EAAE,MAAM,CAAC,EAAE,CAAC,CAAC;wBAChC,SAAS,EAAE,MAAM,CAAC,EAAE,2FAAuC;wBAC3D,QAAQ,EAAE,MAAM,CAAC,EAAE,2FAAuC;wBAC1D,WAAW,EAAE,MAAM,CAAC,EAAE,uFAAqC,IAAI,MAAM,CAAC,EAAE,iGAA0C;qBAClH,CAAC;iBACF;aACD;YACD,eAAe,EAAE,iCAAiC;YAClD,qBAAqB,EAAE;gBACtB,KAAK,EAAE;oBACN,eAAe,EAAE,sBAAsB;oBACvC,cAAc,EAAE,MAAM,CAAC,WAAW;oBAClC,gBAAgB,EAAE,4CAA4C;iBAC9D;gBACD,WAAW,EAAE,QAAQ,CAAC,GAAG;aACzB;SACD,CACD,CAAC;QACF,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,iBAAiB,CAAC,UAAU,CAAC,oBAAoB,CAAC,GAAG,EAAE,CAAC,IAAI,CAAC,cAAc,EAAE,CAAC,CAAC,CAAC;QACpG,IAAI,CAAC,SAAS,CAAC,KAAK,CAAC,GAAG,CACvB,IAAI,CAAC,iBAAiB,CAAC,iBAAiB,EACxC,IAAI,CAAC,SAAS,CAAC,mBAAmB,EAClC,IAAI,CAAC,iBAAiB,CAAC,UAAU,CAAC,wBAAwB,EAC1D,KAAK,CAAC,QAAQ,CAAC,IAAI,CAAC,MAAM,CAAC,GAAG,CAAC,YAAY,EAAE,GAAG,EAAE,CAAC,KAAK,CAAC,EAAE,cAAc,CAAC,CAC1E,CAAC,GAAG,EAAE,CAAC,IAAI,CAAC,SAAS,EAAE,CAAC,CAAC,CAAC;QAE3B,MAAM,QAAQ,GAAG,IAAI,cAAc,CAAC,GAAG,EAAE,CAAC,IAAI,CAAC,SAAS,EAAE,CAAC,CAAC;QAC5D,QAAQ,CAAC,OAAO,CAAC,IAAI,CAAC,gBAAgB,CAAC,CAAC;QACxC,IAAI,CAAC,SAAS,CAAC,YAAY,CAAC,GAAG,EAAE,CAAC,QAAQ,CAAC,UAAU,EAAE,CAAC,CAAC,CAAC;QAE1D,IAAI,CAAC,iBAAiB,EAAE,CAAC;QACzB,IAAI,CAAC,UAAU,CAAC,WAAW,CAAC,IAAI,CAAC,iBAAiB,CAAC,OAAO,CAAC,CAAC;QAE5D,IAAI,CAAC,aAAa,GAAG,IAAI,CAAC,SAAS,CAAC,UAAU,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC,CAAC;QACjE,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,aAAa,CAAC,UAAU,CAAC,GAAG,EAAE,CAAC,IAAI,CAAC,kBAAkB,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;QACvF,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,aAAa,CAAC,SAAS,CAAC,GAAG,EAAE,CAAC,IAAI,CAAC,kBAAkB,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC;QAEvF,IAAI,CAAC,SAAS,CAAC,OAAO,CAAC,CAAC,CAAC,EAAE;YAC1B,MAAM,MAAM,GAAG,IAAI,CAAC,iBAAiB,CAAC,iBAAiB,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;YAChE,IAAI,CAAC,UAAU,CAAC,SAAS,CAAC,MAAM,CAAC,MAAM,EAAE,MAAM,CAAC,CAAC;YAEjD,IAAI,CAAC,iBAAiB,CAAC,YAAY,CAAC,CAAC,CAAC,IAAI,CAAC,iBAAiB,CAAC,eAAe,CAAC,CAAC;YAE9E,IAAI,MAAM,IAAI,CAAC,IAAI,CAAC,iBAAiB,CAAC,eAAe,EAAE,CAAC;gBACvD,IAAI,CAAC,oCAAoC,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC;gBACrD,IAAI,CAAC,6CAA6C,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC;YAC/D,CAAC;iBAAM,CAAC;gBACP,OAAO,CAAC,GAAG,CAAC;oBACX,IAAI,CAAC,iBAAiB,CAAC,gBAAgB,CAAC,CAAC,CAAC;oBAC1C,IAAI,CAAC,iBAAiB,CAAC,gBAAgB,CAAC,CAAC,CAAC;iBAC1C,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,cAAc,EAAE,eAAe,CAAC,EAAE,EAAE;oBAC7C,IAAI,CAAC,oCAAoC,CAAC,GAAG,CAAC,CAAC,CAAC,cAAc,CAAC,CAAC;oBAChE,IAAI,CAAC,6CAA6C,CAAC,GAAG,CAAC,CAAC,CAAC,eAAe,CAAC,CAAC;oBAC1E,IAAI,CAAC,iBAAiB,CAAC,aAAa,CAAC,IAAI,CAAC,CAAC;gBAC5C,CAAC,CAAC,CAAC;YACJ,CAAC;QACF,CAAC,CAAC,CAAC,CAAC;QAEJ,IAAI,CAAC,IAAI,EAAE,CAAC;IACb,CAAC;IAIO,SAAS;QAChB,IAAI,IAAI,CAAC,UAAU,EAAE,CAAC;YACrB,IAAI,CAAC,SAAS,EAAE,CAAC;QAClB,CAAC;IACF,CAAC;IAEO,SAAS;QAChB,MAAM,YAAY,GAAG,IAAI,CAAC,MAAM,CAAC,GAAI,CAAC,OAAO,CAAC;QAC9C,IAAI,CAAC,YAAY,EAAE,CAAC;YACnB,OAAO;QACR,CAAC;QAED,MAAM,KAAK,GAAG,eAAe,EAAE,CAAC,gBAAgB,CAAC,YAAY,CAAC,CAAC;QAE/D,kBAAkB;QAClB,MAAM,gBAAgB,GAAG,QAAQ,CAAC,KAAK,CAAC,WAAW,CAAC,CAAC;QACrD,MAAM,KAAK,GAAG,YAAY,CAAC,WAAW,GAAG,gBAAgB,kCAAyB,CAAC;QACnF,IAAI,KAAK,KAAK,CAAC,EAAE,CAAC;YACjB,OAAO;QACR,CAAC;QAED,mBAAmB;QACnB,MAAM,sBAAsB,GAAG,IAAI,CAAC,0BAA0B,EAAE,CAAC;QACjE,MAAM,+BAA+B,GAAG,CAAC,sBAAsB,IAAI,CAAC,CAAC,qDAA0C,CAAC;QAChH,MAAM,MAAM,GAAG,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,GAAG,gCAAsB,IAAI,CAAC,iBAAiB,CAAC,aAAa,EAAE,+BAA+B,CAAC,EAAE,IAAI,CAAC,iBAAiB,CAAC,SAAS,CAAC,CAAC;QAChK,IAAI,MAAM,KAAK,CAAC,EAAE,CAAC;YAClB,OAAO;QACR,CAAC;QAED,SAAS;QACT,IAAI,CAAC,UAAU,GAAG,IAAI,SAAS,CAAC,KAAK,EAAE,MAAM,CAAC,CAAC;QAC/C,IAAI,CAAC,iBAAiB,CAAC,MAAM,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC;QAC/C,IAAI,CAAC,iBAAiB,CAAC,OAAO,CAAC,KAAK,CAAC,WAAW,GAAG,GAAG,gBAAgB,IAAI,CAAC;QAC3E,IAAI,CAAC,4BAA4B,EAAE,CAAC;IACrC,CAAC;IAEO,iBAAiB;QACxB,MAAM,YAAY,GAAG,IAAI,CAAC,iBAAiB,CAAC,eAAe,CAAC,iBAAiB,CAAC,QAAQ,CAAC,CAAC;QACxF,IAAI,CAAC,gBAAgB,CAAC,WAAW,GAAG,YAAY,EAAE,WAAW,IAAI,QAAQ,CAAC,KAAkB,EAAE,IAAoB,CAAC,CAAC;IACrH,CAAC;IAED,KAAK,CAAC,MAAM;QACX,MAAM,IAAI,CAAC,cAAc,EAAE,CAAC;QAC5B,IAAI,CAAC,SAAS,EAAE,CAAC;QACjB,IAAI,CAAC,UAAU,CAAC,SAAS,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC;QACzC,IAAI,CAAC,kBAAkB,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC;QAClC,IAAI,CAAC,iBAAiB,EAAE,CAAC;QACzB,IAAI,CAAC,iBAAiB,CAAC,KAAK,EAAE,CAAC;QAC/B,IAAI,CAAC,SAAS,CAAC,cAAc,EAAE,CAAC;IACjC,CAAC;IAEO,qBAAqB;QAC5B,MAAM,IAAI,GAAG,IAAI,CAAC,SAAS,CAAC,KAAK,EAAE,OAAO,EAAE,CAAC;QAC7C,IAAI,CAAC,IAAI,EAAE,UAAU,EAAE,CAAC;YACvB,OAAO;QACR,CAAC;QACD,MAAM,qBAAqB,GAAG,IAAI,CAAC,0BAA0B,EAAE,IAAI,CAAC,CAAC;QACrE,MAAM,UAAU,GAAG,IAAI,CAAC,UAAU,GAAG,IAAI,CAAC,UAAU,CAAC;QACrD,MAAM,UAAU,GAAG,qBAAqB,GAAG,CAAC,IAAI,CAAC,SAAS,CAAC,IAAI,GAAG,UAAU,CAAC,CAAC;QAC9E,MAAM,OAAO,GAAG,CAAC,IAAI,CAAC,SAAS,CAAC,KAAK,EAAE,GAAG,CAAC,MAAM,CAAC,MAAM,CAAC,OAAO,IAAI,CAAC,CAAC,GAAG,CAAC,CAAC;QAC3E,OAAO,UAAU,GAAG,OAAO,GAAG,UAAU,CAAC;IAC1C,CAAC;IAEO,4BAA4B;QACnC,MAAM,GAAG,GAAG,IAAI,CAAC,qBAAqB,EAAE,CAAC;QACzC,IAAI,CAAC,GAAG,EAAE,CAAC;YACV,OAAO;QACR,CAAC;QACD,IAAI,CAAC,UAAU,CAAC,KAAK,CAAC,GAAG,GAAG,GAAG,GAAG,IAAI,CAAC;QACvC,MAAM,sBAAsB,GAAG,IAAI,CAAC,0BAA0B,EAAE,CAAC;QACjE,IAAI,CAAC,sBAAsB,EAAE,CAAC;YAC7B,OAAO;QACR,CAAC;QAED,MAAM,+BAA+B,GAAG,sBAAsB,qDAA0C,CAAC;QACzG,MAAM,MAAM,GAAG,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,GAAG,gCAAsB,IAAI,CAAC,iBAAiB,CAAC,aAAa,EAAE,+BAA+B,CAAC,EAAE,IAAI,CAAC,iBAAiB,CAAC,SAAS,CAAC,CAAC;QAChK,IAAI,GAAG,GAAG,sBAAsB,GAAG,MAAM,IAAI,sBAAsB,GAAG,MAAM,GAAG,CAAC,EAAE,CAAC;YAClF,IAAI,CAAC,0BAA0B,CAAC,GAAG,GAAG,CAAC,sBAAsB,GAAG,MAAM,CAAC,CAAC,CAAC;QAC1E,CAAC;aAAM,CAAC;YACP,IAAI,CAAC,0BAA0B,CAAC,SAAS,CAAC,CAAC;QAC5C,CAAC;IACF,CAAC;IAEO,0BAA0B;QACjC,OAAO,IAAI,CAAC,gBAAgB,CAAC,YAAY,CAAC;IAC3C,CAAC;IAED,IAAI;QACH,IAAI,CAAC,UAAU,CAAC,SAAS,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC;QACtC,IAAI,CAAC,iBAAiB,CAAC,KAAK,EAAE,CAAC;QAC/B,IAAI,CAAC,iBAAiB,EAAE,CAAC;QACzB,IAAI,CAAC,iBAAiB,CAAC,aAAa,CAAC,KAAK,CAAC,CAAC;QAC5C,IAAI,CAAC,kBAAkB,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC;QACnC,IAAI,CAAC,iBAAiB,CAAC,KAAK,GAAG,EAAE,CAAC;QAClC,IAAI,CAAC,SAAS,CAAC,KAAK,EAAE,CAAC;QACvB,IAAI,CAAC,0BAA0B,CAAC,SAAS,CAAC,CAAC;QAC3C,IAAI,CAAC,UAAU,CAAC,IAAI,EAAE,CAAC;IACxB,CAAC;IACO,0BAA0B,CAAC,MAA0B;QAC5D,IAAI,MAAM,KAAK,SAAS,IAAI,IAAI,CAAC,UAAU,CAAC,SAAS,CAAC,QAAQ,CAAC,MAAM,CAAC,EAAE,CAAC;YACxE,IAAI,CAAC,gBAAgB,CAAC,KAAK,CAAC,QAAQ,GAAG,EAAE,CAAC;YAC1C,IAAI,CAAC,gBAAgB,CAAC,KAAK,CAAC,MAAM,GAAG,EAAE,CAAC;YACxC,gCAAgC,CAAC,GAAG,CAAC,IAAI,CAAC,SAAS,CAAC,EAAE,UAAU,EAAE,CAAC;QACpE,CAAC;aAAM,CAAC;YACP,IAAI,CAAC,gBAAgB,CAAC,KAAK,CAAC,QAAQ,GAAG,UAAU,CAAC;YAClD,IAAI,CAAC,gBAAgB,CAAC,KAAK,CAAC,MAAM,GAAG,GAAG,MAAM,IAAI,CAAC;YACnD,gCAAgC,CAAC,GAAG,CAAC,IAAI,CAAC,SAAS,CAAC,EAAE,QAAQ,EAAE,CAAC;QAClE,CAAC;IACF,CAAC;IACD,KAAK;QACJ,IAAI,CAAC,gBAAgB,CAAC,KAAK,EAAE,CAAC;IAC/B,CAAC;IACD,QAAQ;QACP,OAAO,IAAI,CAAC,iBAAiB,CAAC,QAAQ,EAAE,CAAC;IAC1C,CAAC;IAED,QAAQ,CAAC,KAAc;QACtB,IAAI,CAAC,iBAAiB,CAAC,KAAK,GAAG,KAAK,IAAI,EAAE,CAAC;IAC5C,CAAC;IAED,KAAK,CAAC,aAAa,CAAC,aAAsB;QACzC,MAAM,IAAI,GAAG,MAAM,IAAI,CAAC,gBAAgB,CAAC,gBAAgB,CAAC,CAAC,CAAC,CAAC;QAC7D,IAAI,CAAC,IAAI,EAAE,CAAC;YACX,OAAO;QACR,CAAC;QACD,MAAM,KAAK,GAAG,IAAI,CAAC,QAAQ,EAAE,CAAC;QAC9B,IAAI,CAAC,SAAS,CAAC,UAAU,CAAC,KAAK,EAAE,aAAa,CAAC,CAAC;QAChD,IAAI,CAAC,KAAK,EAAE,CAAC;IACd,CAAC;IAED,IAAW,YAAY;QACtB,OAAO,IAAI,CAAC,aAAa,CAAC;IAC3B,CAAC;IAEO,KAAK,CAAC,cAAc;QAC3B,IAAI,CAAC,YAAY,GAAG,uBAAuB,CAAO,KAAK,EAAC,KAAK,EAAC,EAAE;YAC/D,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,KAAK,EAAE,CAAC;gBACxB,IAAI,CAAC,MAAM,CAAC,KAAK,GAAG,IAAI,CAAC,YAAY,CAAC,YAAY,CAAC,iBAAiB,CAAC,QAAQ,EAAE,KAAK,CAAC,CAAC;gBACtF,MAAM,KAAK,GAAG,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC;gBAChC,IAAI,KAAK,EAAE,CAAC;oBACX,IAAI,CAAC,iBAAiB,CAAC,YAAY,CAAC,KAAK,CAAC,CAAC;oBAC3C,IAAI,CAAC,iBAAiB,EAAE,CAAC;gBAC1B,CAAC;gBACD,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,KAAK,EAAE,CAAC;oBACxB,MAAM,IAAI,KAAK,CAAC,8BAA8B,CAAC,CAAC;gBACjD,CAAC;YACF,CAAC;QACF,CAAC,CAAC,CAAC;QACH,IAAI,CAAC,SAAS,CAAC,YAAY,CAAC,GAAG,EAAE,CAAC,IAAI,CAAC,YAAY,EAAE,MAAM,EAAE,CAAC,CAAC,CAAC;IACjE,CAAC;IAEO,cAAc;QACrB,MAAM,SAAS,GAAG,IAAI,CAAC,iBAAiB,CAAC,UAAU,CAAC,YAAY,EAAE,CAAC;QACnE,IAAI,SAAS,EAAE,CAAC;YACf,IAAI,CAAC,eAAe,CAAC,KAAK,CAAC,IAAI,CAAC,oBAAoB,EAAE,IAAI,CAAC,SAAS,CAAC,SAAS,CAAC,2DAA2C,CAAC;QAC5H,CAAC;IACF,CAAC;IAED,KAAK;QACJ,IAAI,CAAC,MAAM,EAAE,CAAC;QACd,IAAI,CAAC,MAAM,CAAC,KAAK,EAAE,CAAC;QACpB,IAAI,CAAC,oCAAoC,CAAC,KAAK,EAAE,CAAC;QAClD,IAAI,CAAC,wBAAwB,CAAC,KAAK,EAAE,CAAC;QACtC,IAAI,CAAC,IAAI,EAAE,CAAC;QACZ,IAAI,CAAC,QAAQ,CAAC,SAAS,CAAC,CAAC;IAC1B,CAAC;IAED,KAAK,CAAC,WAAW,CAAC,KAAc,EAAE,OAAiC;QAClE,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,KAAK,EAAE,CAAC;YACxB,MAAM,IAAI,CAAC,MAAM,EAAE,CAAC;QACrB,CAAC;QACD,IAAI,CAAC,SAAS,CAAC,IAAI,8BAAqB,CAAC;QACzC,MAAM,SAAS,GAAG,IAAI,CAAC,iBAAiB,CAAC,KAAK,CAAC;QAC/C,IAAI,CAAC,SAAS,EAAE,CAAC;YAChB,OAAO;QACR,CAAC;QACD,IAAI,CAAC,iBAAiB,EAAE,MAAM,EAAE,CAAC;QACjC,IAAI,CAAC,iBAAiB,GAAG,IAAI,uBAAuB,EAAE,CAAC;QACvD,MAAM,KAAK,GAAG,IAAI,eAAe,EAAE,CAAC;QACpC,IAAI,CAAC,wBAAwB,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC;QACxC,MAAM,QAAQ,GAAG,MAAM,IAAI,CAAC,iBAAiB,CAAC,UAAU,CAAC,WAAW,CAAC,SAAS,EAAE,EAAE,YAAY,EAAE,OAAO,EAAE,YAAY,EAAE,CAAC,CAAC;QACzH,IAAI,CAAC,iBAAiB,GAAG,QAAQ,EAAE,SAAS,CAAC;QAC7C,MAAM,eAAe,GAAG,IAAI,eAAe,EAAkC,CAAC;QAC9E,IAAI,CAAC;YACJ,IAAI,CAAC,wBAAwB,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC;YACxC,IAAI,QAAQ,EAAE,CAAC;gBACd,KAAK,CAAC,GAAG,CAAC,QAAQ,CAAC,WAAW,CAAC,KAAK,IAAI,EAAE;oBACzC,IAAI,QAAQ,CAAC,UAAU,EAAE,CAAC;wBACzB,IAAI,CAAC,wBAAwB,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC;wBACzC,eAAe,CAAC,QAAQ,CAAC,SAAS,CAAC,CAAC;wBACpC,OAAO;oBACR,CAAC;oBACD,IAAI,QAAQ,CAAC,UAAU,EAAE,CAAC;wBACzB,IAAI,CAAC,wBAAwB,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC;wBACzC,IAAI,CAAC,wBAAwB,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC;wBACzC,MAAM,cAAc,GAAG,MAAM,IAAI,CAAC,iBAAiB,CAAC,gBAAgB,CAAC,CAAC,CAAC,CAAC;wBACxE,MAAM,eAAe,GAAG,MAAM,IAAI,CAAC,iBAAiB,CAAC,gBAAgB,CAAC,CAAC,CAAC,CAAC;wBACzE,IAAI,CAAC,oCAAoC,CAAC,GAAG,CAAC,CAAC,CAAC,cAAc,CAAC,CAAC;wBAChE,IAAI,CAAC,6CAA6C,CAAC,GAAG,CAAC,CAAC,CAAC,eAAe,CAAC,CAAC;wBAC1E,IAAI,CAAC,iBAAiB,CAAC,aAAa,CAAC,IAAI,CAAC,CAAC;wBAC3C,eAAe,CAAC,QAAQ,CAAC,QAAQ,CAAC,CAAC;oBACpC,CAAC;gBACF,CAAC,CAAC,CAAC,CAAC;YACL,CAAC;YACD,MAAM,eAAe,CAAC,CAAC,CAAC;YACxB,IAAI,CAAC,oBAAoB,GAAG,QAAQ,EAAE,QAAQ,CAAC,WAAW,EAAE,CAAC;YAC7D,OAAO,QAAQ,CAAC;QACjB,CAAC;QAAC,MAAM,CAAC;YACR,IAAI,CAAC,oBAAoB,GAAG,SAAS,CAAC;YACtC,OAAO;QACR,CAAC;gBAAS,CAAC;YACV,KAAK,CAAC,OAAO,EAAE,CAAC;QACjB,CAAC;IACF,CAAC;IAED,MAAM;QACL,IAAI,CAAC,YAAY,EAAE,MAAM,EAAE,CAAC;QAC5B,IAAI,CAAC,YAAY,GAAG,SAAS,CAAC;QAC9B,IAAI,CAAC,iBAAiB,EAAE,MAAM,EAAE,CAAC;QACjC,IAAI,CAAC,wBAAwB,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC;QACzC,MAAM,KAAK,GAAG,IAAI,CAAC,iBAAiB,CAAC,YAAY,EAAE,CAAC;QACpD,IAAI,CAAC,KAAK,EAAE,eAAe,EAAE,CAAC;YAC7B,OAAO;QACR,CAAC;QACD,IAAI,CAAC,YAAY,CAAC,8BAA8B,CAAC,KAAK,EAAE,eAAe,CAAC,CAAC;IAC1E,CAAC;IAED,KAAK,CAAC,UAAU;QACf,MAAM,MAAM,GAAG,MAAM,IAAI,CAAC,kBAAkB,CAAC,YAAY,EAAE,CAAC;QAC5D,MAAM,cAAc,GAAG,IAAI,CAAC,iBAAiB,CAAC,UAAU,CAAC,SAAS,EAAE,KAAK,CAAC,WAAW,EAAE,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,EAAE,KAAK,IAAI,CAAC,iBAAiB,CAAC,CAAC;QACnI,IAAI,CAAC,MAAM,IAAI,CAAC,cAAc,EAAE,QAAQ,EAAE,CAAC;YAC1C,OAAO;QACR,CAAC;QAED,MAAM,OAAO,GAAoB,EAAE,CAAC;QACpC,KAAK,MAAM,IAAI,IAAI,cAAc,CAAC,QAAQ,CAAC,QAAQ,CAAC,KAAK,EAAE,CAAC;YAC3D,IAAI,IAAI,CAAC,IAAI,KAAK,eAAe,EAAE,CAAC;gBACnC,KAAK,MAAM,KAAK,IAAI,IAAI,CAAC,KAAK,EAAE,CAAC;oBAChC,OAAO,CAAC,IAAI,CAAC;wBACZ,IAAI,EAAE,UAAU;wBAChB,KAAK,EAAE,KAAK;wBACZ,GAAG,EAAE,IAAI,CAAC,GAAG;qBACb,CAAC,CAAC;gBACJ,CAAC;YACF,CAAC;iBAAM,IAAI,IAAI,CAAC,IAAI,KAAK,mBAAmB,EAAE,CAAC;gBAC9C,KAAK,MAAM,KAAK,IAAI,IAAI,CAAC,KAAK,EAAE,CAAC;oBAChC,IAAI,4BAA4B,CAAC,KAAK,CAAC,EAAE,CAAC;wBACzC,OAAO,CAAC,IAAI,CAAC;4BACZ,IAAI,EAAE,UAAU;4BAChB,KAAK,EAAE,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,IAAI,CAAC;4BAC7B,GAAG,EAAE,KAAK,CAAC,CAAC,CAAC,CAAC,GAAG;yBACjB,CAAC,CAAC;oBACJ,CAAC;yBAAM,CAAC;wBACP,OAAO,CAAC,IAAI,CAAC;4BACZ,IAAI,EAAE,cAAc;4BACpB,KAAK,EAAE,KAAK;4BACZ,GAAG,EAAE,IAAI,CAAC,GAAG;yBACb,CAAC,CAAC;oBACJ,CAAC;gBACF,CAAC;YACF,CAAC;iBAAM,CAAC;gBACP,OAAO,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;YACpB,CAAC;QACF,CAAC;QAED,IAAI,CAAC,YAAY,CAAC,kBAAkB,CAAC,MAAO,CAAC,SAAU,CAAC,eAAe,EACtE,IAAI,IAAI,CAAC,kBAAkB,IAAI,cAAc,CAAC,OAAO,CAAC,IAAI,EAAE,EAC5D,cAAc,CAAC,YAAY,EAC3B,cAAc,CAAC,OAAO,EACtB;YACC,OAAO;YACP,MAAM,EAAE,cAAc,CAAC,QAAS,CAAC,MAAM;YACvC,SAAS,EAAE,cAAc,CAAC,QAAS,CAAC,SAAS;SAC7C,CAAC,CAAC;QACJ,MAAM,CAAC,iBAAiB,EAAE,CAAC;QAC3B,IAAI,CAAC,IAAI,EAAE,CAAC;IACb,CAAC;CACD,CAAA;AAhaY,kBAAkB;IA4C5B,WAAA,kBAAkB,CAAA;IAClB,WAAA,YAAY,CAAA;IACZ,WAAA,eAAe,CAAA;IACf,WAAA,qBAAqB,CAAA;IACrB,WAAA,iBAAiB,CAAA;IACjB,WAAA,kBAAkB,CAAA;GAjDR,kBAAkB,CAga9B","file":"terminalChatWidget.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport type { Terminal as RawXtermTerminal } from '@xterm/xterm';\nimport { Dimension, getActiveWindow, IFocusTracker, trackFocus } from '../../../../../base/browser/dom.js';\nimport { CancelablePromise, createCancelablePromise, DeferredPromise } from '../../../../../base/common/async.js';\nimport { CancellationTokenSource } from '../../../../../base/common/cancellation.js';\nimport { Emitter, Event } from '../../../../../base/common/event.js';\nimport { Disposable, DisposableStore, MutableDisposable, toDisposable } from '../../../../../base/common/lifecycle.js';\nimport { autorun, observableValue, type IObservable } from '../../../../../base/common/observable.js';\nimport { MicrotaskDelay } from '../../../../../base/common/symbols.js';\nimport { localize } from '../../../../../nls.js';\nimport { MenuId } from '../../../../../platform/actions/common/actions.js';\nimport { IContextKey, IContextKeyService } from '../../../../../platform/contextkey/common/contextkey.js';\nimport { IInstantiationService } from '../../../../../platform/instantiation/common/instantiation.js';\nimport { IStorageService, StorageScope, StorageTarget } from '../../../../../platform/storage/common/storage.js';\nimport { IChatAcceptInputOptions, IChatWidgetService } from '../../../chat/browser/chat.js';\nimport { IChatAgentService } from '../../../chat/common/chatAgents.js';\nimport { ChatModel, IChatResponseModel, isCellTextEditOperationArray } from '../../../chat/common/chatModel.js';\nimport { ChatMode } from '../../../chat/common/chatModes.js';\nimport { IChatProgress, IChatService } from '../../../chat/common/chatService.js';\nimport { ChatAgentLocation } from '../../../chat/common/constants.js';\nimport { InlineChatWidget } from '../../../inlineChat/browser/inlineChatWidget.js';\nimport { MENU_INLINE_CHAT_WIDGET_SECONDARY } from '../../../inlineChat/common/inlineChat.js';\nimport { ITerminalInstance, type IXtermTerminal } from '../../../terminal/browser/terminal.js';\nimport { TerminalStickyScrollContribution } from '../../stickyScroll/browser/terminalStickyScrollContribution.js';\nimport './media/terminalChatWidget.css';\nimport { MENU_TERMINAL_CHAT_WIDGET_INPUT_SIDE_TOOLBAR, MENU_TERMINAL_CHAT_WIDGET_STATUS, TerminalChatCommandId, TerminalChatContextKeys } from './terminalChat.js';\n\nconst enum Constants {\n\tHorizontalMargin = 10,\n\tVerticalMargin = 30,\n\t/** The right padding of the widget, this should align exactly with that in the editor. */\n\tRightPadding = 12,\n\t/** The max allowed height of the widget. */\n\tMaxHeight = 480,\n\t/** The max allowed height of the widget as a percentage of the terminal viewport. */\n\tMaxHeightPercentageOfViewport = 0.75,\n}\n\nconst enum Message {\n\tNone = 0,\n\tAcceptSession = 1 << 0,\n\tCancelSession = 1 << 1,\n\tPauseSession = 1 << 2,\n\tCancelRequest = 1 << 3,\n\tCancelInput = 1 << 4,\n\tAcceptInput = 1 << 5,\n\tReturnInput = 1 << 6,\n}\n\nexport class TerminalChatWidget extends Disposable {\n\n\tprivate readonly _container: HTMLElement;\n\n\tprivate readonly _onDidHide = this._register(new Emitter<void>());\n\treadonly onDidHide = this._onDidHide.event;\n\n\tprivate readonly _inlineChatWidget: InlineChatWidget;\n\tpublic get inlineChatWidget(): InlineChatWidget { return this._inlineChatWidget; }\n\n\tprivate readonly _focusTracker: IFocusTracker;\n\n\tprivate readonly _focusedContextKey: IContextKey<boolean>;\n\tprivate readonly _visibleContextKey: IContextKey<boolean>;\n\n\tprivate readonly _requestActiveContextKey: IContextKey<boolean>;\n\tprivate readonly _responseContainsCodeBlockContextKey: IContextKey<boolean>;\n\tprivate readonly _responseContainsMulitpleCodeBlocksContextKey: IContextKey<boolean>;\n\n\tprivate _messages = this._store.add(new Emitter<Message>());\n\n\tprivate _viewStateStorageKey = 'terminal-inline-chat-view-state';\n\n\tprivate _lastResponseContent: string | undefined;\n\tget lastResponseContent(): string | undefined {\n\t\treturn this._lastResponseContent;\n\t}\n\n\tprivate _terminalAgentName = 'terminal';\n\n\tprivate readonly _model: MutableDisposable<ChatModel> = this._register(new MutableDisposable());\n\n\tprivate _sessionCtor: CancelablePromise<void> | undefined;\n\n\tprivate _currentRequestId: string | undefined;\n\tprivate _activeRequestCts?: CancellationTokenSource;\n\n\tprivate readonly _requestInProgress = observableValue(this, false);\n\treadonly requestInProgress: IObservable<boolean> = this._requestInProgress;\n\n\tconstructor(\n\t\tprivate readonly _terminalElement: HTMLElement,\n\t\tprivate readonly _instance: ITerminalInstance,\n\t\tprivate readonly _xterm: IXtermTerminal & { raw: RawXtermTerminal },\n\t\t@IContextKeyService contextKeyService: IContextKeyService,\n\t\t@IChatService private readonly _chatService: IChatService,\n\t\t@IStorageService private readonly _storageService: IStorageService,\n\t\t@IInstantiationService instantiationService: IInstantiationService,\n\t\t@IChatAgentService private readonly _chatAgentService: IChatAgentService,\n\t\t@IChatWidgetService private readonly _chatWidgetService: IChatWidgetService,\n\t) {\n\t\tsuper();\n\n\t\tthis._focusedContextKey = TerminalChatContextKeys.focused.bindTo(contextKeyService);\n\t\tthis._visibleContextKey = TerminalChatContextKeys.visible.bindTo(contextKeyService);\n\t\tthis._requestActiveContextKey = TerminalChatContextKeys.requestActive.bindTo(contextKeyService);\n\t\tthis._responseContainsCodeBlockContextKey = TerminalChatContextKeys.responseContainsCodeBlock.bindTo(contextKeyService);\n\t\tthis._responseContainsMulitpleCodeBlocksContextKey = TerminalChatContextKeys.responseContainsMultipleCodeBlocks.bindTo(contextKeyService);\n\n\t\tthis._container = document.createElement('div');\n\t\tthis._container.classList.add('terminal-inline-chat');\n\t\tthis._terminalElement.appendChild(this._container);\n\n\t\tthis._inlineChatWidget = instantiationService.createInstance(\n\t\t\tInlineChatWidget,\n\t\t\t{\n\t\t\t\tlocation: ChatAgentLocation.Terminal,\n\t\t\t\tresolveData: () => {\n\t\t\t\t\t// TODO@meganrogge return something that identifies this terminal\n\t\t\t\t\treturn undefined;\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\tstatusMenuId: {\n\t\t\t\t\tmenu: MENU_TERMINAL_CHAT_WIDGET_STATUS,\n\t\t\t\t\toptions: {\n\t\t\t\t\t\tbuttonConfigProvider: action => ({\n\t\t\t\t\t\t\tshowLabel: action.id !== TerminalChatCommandId.RerunRequest,\n\t\t\t\t\t\t\tshowIcon: action.id === TerminalChatCommandId.RerunRequest,\n\t\t\t\t\t\t\tisSecondary: action.id !== TerminalChatCommandId.RunCommand && action.id !== TerminalChatCommandId.RunFirstCommand\n\t\t\t\t\t\t})\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tsecondaryMenuId: MENU_INLINE_CHAT_WIDGET_SECONDARY,\n\t\t\t\tchatWidgetViewOptions: {\n\t\t\t\t\tmenus: {\n\t\t\t\t\t\ttelemetrySource: 'terminal-inline-chat',\n\t\t\t\t\t\texecuteToolbar: MenuId.ChatExecute,\n\t\t\t\t\t\tinputSideToolbar: MENU_TERMINAL_CHAT_WIDGET_INPUT_SIDE_TOOLBAR,\n\t\t\t\t\t},\n\t\t\t\t\tdefaultMode: ChatMode.Ask\n\t\t\t\t}\n\t\t\t},\n\t\t);\n\t\tthis._register(this._inlineChatWidget.chatWidget.onDidChangeViewModel(() => this._saveViewState()));\n\t\tthis._register(Event.any(\n\t\t\tthis._inlineChatWidget.onDidChangeHeight,\n\t\t\tthis._instance.onDimensionsChanged,\n\t\t\tthis._inlineChatWidget.chatWidget.onDidChangeContentHeight,\n\t\t\tEvent.debounce(this._xterm.raw.onCursorMove, () => void 0, MicrotaskDelay),\n\t\t)(() => this._relayout()));\n\n\t\tconst observer = new ResizeObserver(() => this._relayout());\n\t\tobserver.observe(this._terminalElement);\n\t\tthis._register(toDisposable(() => observer.disconnect()));\n\n\t\tthis._resetPlaceholder();\n\t\tthis._container.appendChild(this._inlineChatWidget.domNode);\n\n\t\tthis._focusTracker = this._register(trackFocus(this._container));\n\t\tthis._register(this._focusTracker.onDidFocus(() => this._focusedContextKey.set(true)));\n\t\tthis._register(this._focusTracker.onDidBlur(() => this._focusedContextKey.set(false)));\n\n\t\tthis._register(autorun(r => {\n\t\t\tconst isBusy = this._inlineChatWidget.requestInProgress.read(r);\n\t\t\tthis._container.classList.toggle('busy', isBusy);\n\n\t\t\tthis._inlineChatWidget.toggleStatus(!!this._inlineChatWidget.responseContent);\n\n\t\t\tif (isBusy || !this._inlineChatWidget.responseContent) {\n\t\t\t\tthis._responseContainsCodeBlockContextKey.set(false);\n\t\t\t\tthis._responseContainsMulitpleCodeBlocksContextKey.set(false);\n\t\t\t} else {\n\t\t\t\tPromise.all([\n\t\t\t\t\tthis._inlineChatWidget.getCodeBlockInfo(0),\n\t\t\t\t\tthis._inlineChatWidget.getCodeBlockInfo(1)\n\t\t\t\t]).then(([firstCodeBlock, secondCodeBlock]) => {\n\t\t\t\t\tthis._responseContainsCodeBlockContextKey.set(!!firstCodeBlock);\n\t\t\t\t\tthis._responseContainsMulitpleCodeBlocksContextKey.set(!!secondCodeBlock);\n\t\t\t\t\tthis._inlineChatWidget.updateToolbar(true);\n\t\t\t\t});\n\t\t\t}\n\t\t}));\n\n\t\tthis.hide();\n\t}\n\n\tprivate _dimension?: Dimension;\n\n\tprivate _relayout() {\n\t\tif (this._dimension) {\n\t\t\tthis._doLayout();\n\t\t}\n\t}\n\n\tprivate _doLayout() {\n\t\tconst xtermElement = this._xterm.raw!.element;\n\t\tif (!xtermElement) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst style = getActiveWindow().getComputedStyle(xtermElement);\n\n\t\t// Calculate width\n\t\tconst xtermLeftPadding = parseInt(style.paddingLeft);\n\t\tconst width = xtermElement.clientWidth - xtermLeftPadding - Constants.RightPadding;\n\t\tif (width === 0) {\n\t\t\treturn;\n\t\t}\n\n\t\t// Calculate height\n\t\tconst terminalViewportHeight = this._getTerminalViewportHeight();\n\t\tconst widgetAllowedPercentBasedHeight = (terminalViewportHeight ?? 0) * Constants.MaxHeightPercentageOfViewport;\n\t\tconst height = Math.max(Math.min(Constants.MaxHeight, this._inlineChatWidget.contentHeight, widgetAllowedPercentBasedHeight), this._inlineChatWidget.minHeight);\n\t\tif (height === 0) {\n\t\t\treturn;\n\t\t}\n\n\t\t// Layout\n\t\tthis._dimension = new Dimension(width, height);\n\t\tthis._inlineChatWidget.layout(this._dimension);\n\t\tthis._inlineChatWidget.domNode.style.paddingLeft = `${xtermLeftPadding}px`;\n\t\tthis._updateXtermViewportPosition();\n\t}\n\n\tprivate _resetPlaceholder() {\n\t\tconst defaultAgent = this._chatAgentService.getDefaultAgent(ChatAgentLocation.Terminal);\n\t\tthis.inlineChatWidget.placeholder = defaultAgent?.description ?? localize('askAboutCommands', 'Ask about commands');\n\t}\n\n\tasync reveal(): Promise<void> {\n\t\tawait this._createSession();\n\t\tthis._doLayout();\n\t\tthis._container.classList.remove('hide');\n\t\tthis._visibleContextKey.set(true);\n\t\tthis._resetPlaceholder();\n\t\tthis._inlineChatWidget.focus();\n\t\tthis._instance.scrollToBottom();\n\t}\n\n\tprivate _getTerminalCursorTop(): number | undefined {\n\t\tconst font = this._instance.xterm?.getFont();\n\t\tif (!font?.charHeight) {\n\t\t\treturn;\n\t\t}\n\t\tconst terminalWrapperHeight = this._getTerminalViewportHeight() ?? 0;\n\t\tconst cellHeight = font.charHeight * font.lineHeight;\n\t\tconst topPadding = terminalWrapperHeight - (this._instance.rows * cellHeight);\n\t\tconst cursorY = (this._instance.xterm?.raw.buffer.active.cursorY ?? 0) + 1;\n\t\treturn topPadding + cursorY * cellHeight;\n\t}\n\n\tprivate _updateXtermViewportPosition(): void {\n\t\tconst top = this._getTerminalCursorTop();\n\t\tif (!top) {\n\t\t\treturn;\n\t\t}\n\t\tthis._container.style.top = `${top}px`;\n\t\tconst terminalViewportHeight = this._getTerminalViewportHeight();\n\t\tif (!terminalViewportHeight) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst widgetAllowedPercentBasedHeight = terminalViewportHeight * Constants.MaxHeightPercentageOfViewport;\n\t\tconst height = Math.max(Math.min(Constants.MaxHeight, this._inlineChatWidget.contentHeight, widgetAllowedPercentBasedHeight), this._inlineChatWidget.minHeight);\n\t\tif (top > terminalViewportHeight - height && terminalViewportHeight - height > 0) {\n\t\t\tthis._setTerminalViewportOffset(top - (terminalViewportHeight - height));\n\t\t} else {\n\t\t\tthis._setTerminalViewportOffset(undefined);\n\t\t}\n\t}\n\n\tprivate _getTerminalViewportHeight(): number | undefined {\n\t\treturn this._terminalElement.clientHeight;\n\t}\n\n\thide(): void {\n\t\tthis._container.classList.add('hide');\n\t\tthis._inlineChatWidget.reset();\n\t\tthis._resetPlaceholder();\n\t\tthis._inlineChatWidget.updateToolbar(false);\n\t\tthis._visibleContextKey.set(false);\n\t\tthis._inlineChatWidget.value = '';\n\t\tthis._instance.focus();\n\t\tthis._setTerminalViewportOffset(undefined);\n\t\tthis._onDidHide.fire();\n\t}\n\tprivate _setTerminalViewportOffset(offset: number | undefined) {\n\t\tif (offset === undefined || this._container.classList.contains('hide')) {\n\t\t\tthis._terminalElement.style.position = '';\n\t\t\tthis._terminalElement.style.bottom = '';\n\t\t\tTerminalStickyScrollContribution.get(this._instance)?.hideUnlock();\n\t\t} else {\n\t\t\tthis._terminalElement.style.position = 'relative';\n\t\t\tthis._terminalElement.style.bottom = `${offset}px`;\n\t\t\tTerminalStickyScrollContribution.get(this._instance)?.hideLock();\n\t\t}\n\t}\n\tfocus(): void {\n\t\tthis.inlineChatWidget.focus();\n\t}\n\thasFocus(): boolean {\n\t\treturn this._inlineChatWidget.hasFocus();\n\t}\n\n\tsetValue(value?: string) {\n\t\tthis._inlineChatWidget.value = value ?? '';\n\t}\n\n\tasync acceptCommand(shouldExecute: boolean): Promise<void> {\n\t\tconst code = await this.inlineChatWidget.getCodeBlockInfo(0);\n\t\tif (!code) {\n\t\t\treturn;\n\t\t}\n\t\tconst value = code.getValue();\n\t\tthis._instance.runCommand(value, shouldExecute);\n\t\tthis.clear();\n\t}\n\n\tpublic get focusTracker(): IFocusTracker {\n\t\treturn this._focusTracker;\n\t}\n\n\tprivate async _createSession(): Promise<void> {\n\t\tthis._sessionCtor = createCancelablePromise<void>(async token => {\n\t\t\tif (!this._model.value) {\n\t\t\t\tthis._model.value = this._chatService.startSession(ChatAgentLocation.Terminal, token);\n\t\t\t\tconst model = this._model.value;\n\t\t\t\tif (model) {\n\t\t\t\t\tthis._inlineChatWidget.setChatModel(model);\n\t\t\t\t\tthis._resetPlaceholder();\n\t\t\t\t}\n\t\t\t\tif (!this._model.value) {\n\t\t\t\t\tthrow new Error('Failed to start chat session');\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\tthis._register(toDisposable(() => this._sessionCtor?.cancel()));\n\t}\n\n\tprivate _saveViewState() {\n\t\tconst viewState = this._inlineChatWidget.chatWidget.getViewState();\n\t\tif (viewState) {\n\t\t\tthis._storageService.store(this._viewStateStorageKey, JSON.stringify(viewState), StorageScope.PROFILE, StorageTarget.USER);\n\t\t}\n\t}\n\n\tclear(): void {\n\t\tthis.cancel();\n\t\tthis._model.clear();\n\t\tthis._responseContainsCodeBlockContextKey.reset();\n\t\tthis._requestActiveContextKey.reset();\n\t\tthis.hide();\n\t\tthis.setValue(undefined);\n\t}\n\n\tasync acceptInput(query?: string, options?: IChatAcceptInputOptions): Promise<IChatResponseModel | undefined> {\n\t\tif (!this._model.value) {\n\t\t\tawait this.reveal();\n\t\t}\n\t\tthis._messages.fire(Message.AcceptInput);\n\t\tconst lastInput = this._inlineChatWidget.value;\n\t\tif (!lastInput) {\n\t\t\treturn;\n\t\t}\n\t\tthis._activeRequestCts?.cancel();\n\t\tthis._activeRequestCts = new CancellationTokenSource();\n\t\tconst store = new DisposableStore();\n\t\tthis._requestActiveContextKey.set(true);\n\t\tconst response = await this._inlineChatWidget.chatWidget.acceptInput(lastInput, { isVoiceInput: options?.isVoiceInput });\n\t\tthis._currentRequestId = response?.requestId;\n\t\tconst responsePromise = new DeferredPromise<IChatResponseModel | undefined>();\n\t\ttry {\n\t\t\tthis._requestActiveContextKey.set(true);\n\t\t\tif (response) {\n\t\t\t\tstore.add(response.onDidChange(async () => {\n\t\t\t\t\tif (response.isCanceled) {\n\t\t\t\t\t\tthis._requestActiveContextKey.set(false);\n\t\t\t\t\t\tresponsePromise.complete(undefined);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tif (response.isComplete) {\n\t\t\t\t\t\tthis._requestActiveContextKey.set(false);\n\t\t\t\t\t\tthis._requestActiveContextKey.set(false);\n\t\t\t\t\t\tconst firstCodeBlock = await this._inlineChatWidget.getCodeBlockInfo(0);\n\t\t\t\t\t\tconst secondCodeBlock = await this._inlineChatWidget.getCodeBlockInfo(1);\n\t\t\t\t\t\tthis._responseContainsCodeBlockContextKey.set(!!firstCodeBlock);\n\t\t\t\t\t\tthis._responseContainsMulitpleCodeBlocksContextKey.set(!!secondCodeBlock);\n\t\t\t\t\t\tthis._inlineChatWidget.updateToolbar(true);\n\t\t\t\t\t\tresponsePromise.complete(response);\n\t\t\t\t\t}\n\t\t\t\t}));\n\t\t\t}\n\t\t\tawait responsePromise.p;\n\t\t\tthis._lastResponseContent = response?.response.getMarkdown();\n\t\t\treturn response;\n\t\t} catch {\n\t\t\tthis._lastResponseContent = undefined;\n\t\t\treturn;\n\t\t} finally {\n\t\t\tstore.dispose();\n\t\t}\n\t}\n\n\tcancel(): void {\n\t\tthis._sessionCtor?.cancel();\n\t\tthis._sessionCtor = undefined;\n\t\tthis._activeRequestCts?.cancel();\n\t\tthis._requestActiveContextKey.set(false);\n\t\tconst model = this._inlineChatWidget.getChatModel();\n\t\tif (!model?.sessionResource) {\n\t\t\treturn;\n\t\t}\n\t\tthis._chatService.cancelCurrentRequestForSession(model?.sessionResource);\n\t}\n\n\tasync viewInChat(): Promise<void> {\n\t\tconst widget = await this._chatWidgetService.revealWidget();\n\t\tconst currentRequest = this._inlineChatWidget.chatWidget.viewModel?.model.getRequests().find(r => r.id === this._currentRequestId);\n\t\tif (!widget || !currentRequest?.response) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst message: IChatProgress[] = [];\n\t\tfor (const item of currentRequest.response.response.value) {\n\t\t\tif (item.kind === 'textEditGroup') {\n\t\t\t\tfor (const group of item.edits) {\n\t\t\t\t\tmessage.push({\n\t\t\t\t\t\tkind: 'textEdit',\n\t\t\t\t\t\tedits: group,\n\t\t\t\t\t\turi: item.uri\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t} else if (item.kind === 'notebookEditGroup') {\n\t\t\t\tfor (const group of item.edits) {\n\t\t\t\t\tif (isCellTextEditOperationArray(group)) {\n\t\t\t\t\t\tmessage.push({\n\t\t\t\t\t\t\tkind: 'textEdit',\n\t\t\t\t\t\t\tedits: group.map(e => e.edit),\n\t\t\t\t\t\t\turi: group[0].uri\n\t\t\t\t\t\t});\n\t\t\t\t\t} else {\n\t\t\t\t\t\tmessage.push({\n\t\t\t\t\t\t\tkind: 'notebookEdit',\n\t\t\t\t\t\t\tedits: group,\n\t\t\t\t\t\t\turi: item.uri\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tmessage.push(item);\n\t\t\t}\n\t\t}\n\n\t\tthis._chatService.addCompleteRequest(widget!.viewModel!.sessionResource,\n\t\t\t`@${this._terminalAgentName} ${currentRequest.message.text}`,\n\t\t\tcurrentRequest.variableData,\n\t\t\tcurrentRequest.attempt,\n\t\t\t{\n\t\t\t\tmessage,\n\t\t\t\tresult: currentRequest.response!.result,\n\t\t\t\tfollowups: currentRequest.response!.followups\n\t\t\t});\n\t\twidget.focusResponseItem();\n\t\tthis.hide();\n\t}\n}\n"]}