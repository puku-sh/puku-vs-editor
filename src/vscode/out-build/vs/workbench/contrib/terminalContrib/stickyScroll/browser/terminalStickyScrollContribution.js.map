{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/contrib/terminalContrib/stickyScroll/browser/terminalStickyScrollContribution.ts","vs/workbench/contrib/terminalContrib/stickyScroll/browser/terminalStickyScrollContribution.ts"],"names":[],"mappings":"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","file":"terminalStickyScrollContribution.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport type { Terminal as RawXtermTerminal } from '@xterm/xterm';\nimport { Event } from '../../../../../base/common/event.js';\nimport { Disposable, MutableDisposable } from '../../../../../base/common/lifecycle.js';\nimport { IConfigurationService } from '../../../../../platform/configuration/common/configuration.js';\nimport { IContextKeyService } from '../../../../../platform/contextkey/common/contextkey.js';\nimport { IInstantiationService } from '../../../../../platform/instantiation/common/instantiation.js';\nimport { IKeybindingService } from '../../../../../platform/keybinding/common/keybinding.js';\nimport { TerminalCapability } from '../../../../../platform/terminal/common/capabilities/capabilities.js';\nimport { ITerminalContribution, ITerminalInstance, IXtermTerminal } from '../../../terminal/browser/terminal.js';\nimport type { ITerminalContributionContext } from '../../../terminal/browser/terminalExtensions.js';\nimport { TerminalInstance, TerminalInstanceColorProvider } from '../../../terminal/browser/terminalInstance.js';\nimport { TerminalStickyScrollSettingId } from '../common/terminalStickyScrollConfiguration.js';\nimport './media/stickyScroll.css';\nimport { TerminalStickyScrollOverlay } from './terminalStickyScrollOverlay.js';\n\nexport class TerminalStickyScrollContribution extends Disposable implements ITerminalContribution {\n\tstatic readonly ID = 'terminal.stickyScroll';\n\n\tstatic get(instance: ITerminalInstance): TerminalStickyScrollContribution | null {\n\t\treturn instance.getContribution<TerminalStickyScrollContribution>(TerminalStickyScrollContribution.ID);\n\t}\n\n\tprivate _xterm?: IXtermTerminal & { raw: RawXtermTerminal };\n\n\tprivate readonly _overlay = this._register(new MutableDisposable<TerminalStickyScrollOverlay>());\n\n\tprivate readonly _enableListeners = this._register(new MutableDisposable());\n\tprivate readonly _disableListeners = this._register(new MutableDisposable());\n\tprivate readonly _richCommandDetectionListeners = this._register(new MutableDisposable());\n\n\tconstructor(\n\t\tprivate readonly _ctx: ITerminalContributionContext,\n\t\t@IConfigurationService private readonly _configurationService: IConfigurationService,\n\t\t@IContextKeyService private readonly _contextKeyService: IContextKeyService,\n\t\t@IInstantiationService private readonly _instantiationService: IInstantiationService,\n\t\t@IKeybindingService private readonly _keybindingService: IKeybindingService,\n\t) {\n\t\tsuper();\n\n\t\tthis._register(Event.runAndSubscribe(this._configurationService.onDidChangeConfiguration, e => {\n\t\t\tif (!e || e.affectsConfiguration(TerminalStickyScrollSettingId.Enabled)) {\n\t\t\t\tthis._refreshState();\n\t\t\t}\n\t\t}));\n\t}\n\n\txtermReady(xterm: IXtermTerminal & { raw: RawXtermTerminal }): void {\n\t\tthis._xterm = xterm;\n\t\tthis._refreshState();\n\t}\n\n\txtermOpen(xterm: IXtermTerminal & { raw: RawXtermTerminal }): void {\n\t\tthis._refreshState();\n\t}\n\n\thideLock() {\n\t\tthis._overlay.value?.lockHide();\n\t}\n\n\thideUnlock() {\n\t\tthis._overlay.value?.unlockHide();\n\t}\n\n\tprivate _refreshState(): void {\n\t\tif (this._overlay.value) {\n\t\t\tthis._tryDisable();\n\t\t} else {\n\t\t\tthis._tryEnable();\n\t\t}\n\n\t\tif (this._overlay.value) {\n\t\t\tthis._enableListeners.clear();\n\t\t\tif (!this._disableListeners.value) {\n\t\t\t\tthis._disableListeners.value = this._ctx.instance.capabilities.onDidRemoveCapability(e => {\n\t\t\t\t\tif (e.id === TerminalCapability.CommandDetection) {\n\t\t\t\t\t\tthis._refreshState();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t} else {\n\t\t\tthis._disableListeners.clear();\n\t\t\tif (!this._enableListeners.value) {\n\t\t\t\tthis._enableListeners.value = this._ctx.instance.capabilities.onDidAddCapability(e => {\n\t\t\t\t\tif (e.id === TerminalCapability.CommandDetection) {\n\t\t\t\t\t\tthis._refreshState();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate _tryEnable(): void {\n\t\tconst capability = this._ctx.instance.capabilities.get(TerminalCapability.CommandDetection);\n\t\tif (this._shouldBeEnabled()) {\n\t\t\tconst xtermCtorEventually = TerminalInstance.getXtermConstructor(this._keybindingService, this._contextKeyService);\n\t\t\tthis._overlay.value = this._instantiationService.createInstance(\n\t\t\t\tTerminalStickyScrollOverlay,\n\t\t\t\tthis._ctx.instance,\n\t\t\t\tthis._xterm!,\n\t\t\t\tthis._instantiationService.createInstance(TerminalInstanceColorProvider, this._ctx.instance.targetRef),\n\t\t\t\tcapability!,\n\t\t\t\txtermCtorEventually\n\t\t\t);\n\t\t\tthis._richCommandDetectionListeners.clear();\n\t\t} else if (capability && !capability.hasRichCommandDetection) {\n\t\t\tthis._richCommandDetectionListeners.value = capability.onSetRichCommandDetection(() => {\n\t\t\t\tthis._refreshState();\n\t\t\t});\n\t\t} else {\n\t\t\t// No or Rich shell integration does not need listener\n\t\t\tthis._richCommandDetectionListeners.clear();\n\t\t}\n\t}\n\n\tprivate _tryDisable(): void {\n\t\tif (!this._shouldBeEnabled()) {\n\t\t\tthis._overlay.clear();\n\t\t\tthis._richCommandDetectionListeners.clear();\n\t\t}\n\t}\n\n\tprivate _shouldBeEnabled(): boolean {\n\t\tconst capability = this._ctx.instance.capabilities.get(TerminalCapability.CommandDetection);\n\t\tconst result = !!(this._configurationService.getValue(TerminalStickyScrollSettingId.Enabled) && capability && capability.hasRichCommandDetection && this._xterm?.raw?.element);\n\t\treturn result;\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport type { Terminal as RawXtermTerminal } from '@xterm/xterm';\nimport { Event } from '../../../../../base/common/event.js';\nimport { Disposable, MutableDisposable } from '../../../../../base/common/lifecycle.js';\nimport { IConfigurationService } from '../../../../../platform/configuration/common/configuration.js';\nimport { IContextKeyService } from '../../../../../platform/contextkey/common/contextkey.js';\nimport { IInstantiationService } from '../../../../../platform/instantiation/common/instantiation.js';\nimport { IKeybindingService } from '../../../../../platform/keybinding/common/keybinding.js';\nimport { TerminalCapability } from '../../../../../platform/terminal/common/capabilities/capabilities.js';\nimport { ITerminalContribution, ITerminalInstance, IXtermTerminal } from '../../../terminal/browser/terminal.js';\nimport type { ITerminalContributionContext } from '../../../terminal/browser/terminalExtensions.js';\nimport { TerminalInstance, TerminalInstanceColorProvider } from '../../../terminal/browser/terminalInstance.js';\nimport { TerminalStickyScrollSettingId } from '../common/terminalStickyScrollConfiguration.js';\nimport './media/stickyScroll.css';\nimport { TerminalStickyScrollOverlay } from './terminalStickyScrollOverlay.js';\n\nexport class TerminalStickyScrollContribution extends Disposable implements ITerminalContribution {\n\tstatic readonly ID = 'terminal.stickyScroll';\n\n\tstatic get(instance: ITerminalInstance): TerminalStickyScrollContribution | null {\n\t\treturn instance.getContribution<TerminalStickyScrollContribution>(TerminalStickyScrollContribution.ID);\n\t}\n\n\tprivate _xterm?: IXtermTerminal & { raw: RawXtermTerminal };\n\n\tprivate readonly _overlay = this._register(new MutableDisposable<TerminalStickyScrollOverlay>());\n\n\tprivate readonly _enableListeners = this._register(new MutableDisposable());\n\tprivate readonly _disableListeners = this._register(new MutableDisposable());\n\tprivate readonly _richCommandDetectionListeners = this._register(new MutableDisposable());\n\n\tconstructor(\n\t\tprivate readonly _ctx: ITerminalContributionContext,\n\t\t@IConfigurationService private readonly _configurationService: IConfigurationService,\n\t\t@IContextKeyService private readonly _contextKeyService: IContextKeyService,\n\t\t@IInstantiationService private readonly _instantiationService: IInstantiationService,\n\t\t@IKeybindingService private readonly _keybindingService: IKeybindingService,\n\t) {\n\t\tsuper();\n\n\t\tthis._register(Event.runAndSubscribe(this._configurationService.onDidChangeConfiguration, e => {\n\t\t\tif (!e || e.affectsConfiguration(TerminalStickyScrollSettingId.Enabled)) {\n\t\t\t\tthis._refreshState();\n\t\t\t}\n\t\t}));\n\t}\n\n\txtermReady(xterm: IXtermTerminal & { raw: RawXtermTerminal }): void {\n\t\tthis._xterm = xterm;\n\t\tthis._refreshState();\n\t}\n\n\txtermOpen(xterm: IXtermTerminal & { raw: RawXtermTerminal }): void {\n\t\tthis._refreshState();\n\t}\n\n\thideLock() {\n\t\tthis._overlay.value?.lockHide();\n\t}\n\n\thideUnlock() {\n\t\tthis._overlay.value?.unlockHide();\n\t}\n\n\tprivate _refreshState(): void {\n\t\tif (this._overlay.value) {\n\t\t\tthis._tryDisable();\n\t\t} else {\n\t\t\tthis._tryEnable();\n\t\t}\n\n\t\tif (this._overlay.value) {\n\t\t\tthis._enableListeners.clear();\n\t\t\tif (!this._disableListeners.value) {\n\t\t\t\tthis._disableListeners.value = this._ctx.instance.capabilities.onDidRemoveCapability(e => {\n\t\t\t\t\tif (e.id === TerminalCapability.CommandDetection) {\n\t\t\t\t\t\tthis._refreshState();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t} else {\n\t\t\tthis._disableListeners.clear();\n\t\t\tif (!this._enableListeners.value) {\n\t\t\t\tthis._enableListeners.value = this._ctx.instance.capabilities.onDidAddCapability(e => {\n\t\t\t\t\tif (e.id === TerminalCapability.CommandDetection) {\n\t\t\t\t\t\tthis._refreshState();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate _tryEnable(): void {\n\t\tconst capability = this._ctx.instance.capabilities.get(TerminalCapability.CommandDetection);\n\t\tif (this._shouldBeEnabled()) {\n\t\t\tconst xtermCtorEventually = TerminalInstance.getXtermConstructor(this._keybindingService, this._contextKeyService);\n\t\t\tthis._overlay.value = this._instantiationService.createInstance(\n\t\t\t\tTerminalStickyScrollOverlay,\n\t\t\t\tthis._ctx.instance,\n\t\t\t\tthis._xterm!,\n\t\t\t\tthis._instantiationService.createInstance(TerminalInstanceColorProvider, this._ctx.instance.targetRef),\n\t\t\t\tcapability!,\n\t\t\t\txtermCtorEventually\n\t\t\t);\n\t\t\tthis._richCommandDetectionListeners.clear();\n\t\t} else if (capability && !capability.hasRichCommandDetection) {\n\t\t\tthis._richCommandDetectionListeners.value = capability.onSetRichCommandDetection(() => {\n\t\t\t\tthis._refreshState();\n\t\t\t});\n\t\t} else {\n\t\t\t// No or Rich shell integration does not need listener\n\t\t\tthis._richCommandDetectionListeners.clear();\n\t\t}\n\t}\n\n\tprivate _tryDisable(): void {\n\t\tif (!this._shouldBeEnabled()) {\n\t\t\tthis._overlay.clear();\n\t\t\tthis._richCommandDetectionListeners.clear();\n\t\t}\n\t}\n\n\tprivate _shouldBeEnabled(): boolean {\n\t\tconst capability = this._ctx.instance.capabilities.get(TerminalCapability.CommandDetection);\n\t\tconst result = !!(this._configurationService.getValue(TerminalStickyScrollSettingId.Enabled) && capability && capability.hasRichCommandDetection && this._xterm?.raw?.element);\n\t\treturn result;\n\t}\n}\n"]}