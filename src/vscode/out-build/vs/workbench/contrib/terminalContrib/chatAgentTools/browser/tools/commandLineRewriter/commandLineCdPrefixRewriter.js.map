{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/contrib/terminalContrib/chatAgentTools/browser/tools/commandLineRewriter/commandLineCdPrefixRewriter.ts","vs/workbench/contrib/terminalContrib/chatAgentTools/browser/tools/commandLineRewriter/commandLineCdPrefixRewriter.ts"],"names":[],"mappings":"AAAA;;;gGAGgG;AAEhG,OAAO,EAAE,UAAU,EAAE,MAAM,+CAA+C,CAAC;AAE3E,OAAO,EAAE,YAAY,EAAE,MAAM,+BAA+B,CAAC;AAG7D,MAAM,OAAO,2BAA4B,SAAQ,UAAU;IAC1D,OAAO,CAAC,OAAoC;QAC3C,IAAI,CAAC,OAAO,CAAC,GAAG,EAAE,CAAC;YAClB,OAAO,SAAS,CAAC;QAClB,CAAC;QAED,MAAM,MAAM,GAAG,YAAY,CAAC,OAAO,CAAC,KAAK,EAAE,OAAO,CAAC,EAAE,CAAC,CAAC;QAEvD,wFAAwF;QACxF,0FAA0F;QAC1F,gFAAgF;QAChF,MAAM,aAAa,GAAG,OAAO,CAAC,WAAW,CAAC,KAAK,CAC9C,MAAM;YACL,CAAC,CAAC,qFAAqF;YACvF,CAAC,CAAC,wCAAwC,CAC3C,CAAC;QACF,MAAM,KAAK,GAAG,aAAa,EAAE,MAAM,EAAE,GAAG,CAAC;QACzC,MAAM,QAAQ,GAAG,aAAa,EAAE,MAAM,EAAE,MAAM,CAAC;QAC/C,IAAI,KAAK,IAAI,QAAQ,EAAE,CAAC;YACvB,gCAAgC;YAChC,IAAI,SAAS,GAAG,KAAK,CAAC;YACtB,IAAI,SAAS,CAAC,UAAU,CAAC,GAAG,CAAC,IAAI,SAAS,CAAC,QAAQ,CAAC,GAAG,CAAC,EAAE,CAAC;gBAC1D,SAAS,GAAG,SAAS,CAAC,KAAK,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC;YACpC,CAAC;YACD,6BAA6B;YAC7B,SAAS,GAAG,SAAS,CAAC,OAAO,CAAC,aAAa,EAAE,EAAE,CAAC,CAAC;YACjD,IAAI,SAAS,GAAG,OAAO,CAAC,GAAG,CAAC,MAAM,CAAC,OAAO,CAAC,aAAa,EAAE,EAAE,CAAC,CAAC;YAC9D,yCAAyC;YACzC,IAAI,OAAO,CAAC,EAAE,oCAA4B,EAAE,CAAC;gBAC5C,SAAS,GAAG,SAAS,CAAC,WAAW,EAAE,CAAC;gBACpC,SAAS,GAAG,SAAS,CAAC,WAAW,EAAE,CAAC;YACrC,CAAC;YACD,IAAI,SAAS,KAAK,SAAS,EAAE,CAAC;gBAC7B,OAAO,EAAE,SAAS,EAAE,QAAQ,EAAE,SAAS,EAAE,8BAA8B,EAAE,CAAC;YAC3E,CAAC;QACF,CAAC;QACD,OAAO,SAAS,CAAC;IAClB,CAAC;CACD","file":"commandLineCdPrefixRewriter.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Disposable } from '../../../../../../../base/common/lifecycle.js';\nimport { OperatingSystem } from '../../../../../../../base/common/platform.js';\nimport { isPowerShell } from '../../runInTerminalHelpers.js';\nimport type { ICommandLineRewriter, ICommandLineRewriterOptions, ICommandLineRewriterResult } from './commandLineRewriter.js';\n\nexport class CommandLineCdPrefixRewriter extends Disposable implements ICommandLineRewriter {\n\trewrite(options: ICommandLineRewriterOptions): ICommandLineRewriterResult | undefined {\n\t\tif (!options.cwd) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\tconst isPwsh = isPowerShell(options.shell, options.os);\n\n\t\t// Re-write the command if it starts with `cd <dir> && <suffix>` or `cd <dir>; <suffix>`\n\t\t// to just `<suffix>` if the directory matches the current terminal's cwd. This simplifies\n\t\t// the result in the chat by removing redundancies that some models like to add.\n\t\tconst cdPrefixMatch = options.commandLine.match(\n\t\t\tisPwsh\n\t\t\t\t? /^(?:cd(?: \\/d)?|Set-Location(?: -Path)?) (?<dir>[^\\s]+) ?(?:&&|;)\\s+(?<suffix>.+)$/i\n\t\t\t\t: /^cd (?<dir>[^\\s]+) &&\\s+(?<suffix>.+)$/\n\t\t);\n\t\tconst cdDir = cdPrefixMatch?.groups?.dir;\n\t\tconst cdSuffix = cdPrefixMatch?.groups?.suffix;\n\t\tif (cdDir && cdSuffix) {\n\t\t\t// Remove any surrounding quotes\n\t\t\tlet cdDirPath = cdDir;\n\t\t\tif (cdDirPath.startsWith('\"') && cdDirPath.endsWith('\"')) {\n\t\t\t\tcdDirPath = cdDirPath.slice(1, -1);\n\t\t\t}\n\t\t\t// Normalize trailing slashes\n\t\t\tcdDirPath = cdDirPath.replace(/(?:[\\\\\\/])$/, '');\n\t\t\tlet cwdFsPath = options.cwd.fsPath.replace(/(?:[\\\\\\/])$/, '');\n\t\t\t// Case-insensitive comparison on Windows\n\t\t\tif (options.os === OperatingSystem.Windows) {\n\t\t\t\tcdDirPath = cdDirPath.toLowerCase();\n\t\t\t\tcwdFsPath = cwdFsPath.toLowerCase();\n\t\t\t}\n\t\t\tif (cdDirPath === cwdFsPath) {\n\t\t\t\treturn { rewritten: cdSuffix, reasoning: 'Removed redundant cd command' };\n\t\t\t}\n\t\t}\n\t\treturn undefined;\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Disposable } from '../../../../../../../base/common/lifecycle.js';\nimport { OperatingSystem } from '../../../../../../../base/common/platform.js';\nimport { isPowerShell } from '../../runInTerminalHelpers.js';\nimport type { ICommandLineRewriter, ICommandLineRewriterOptions, ICommandLineRewriterResult } from './commandLineRewriter.js';\n\nexport class CommandLineCdPrefixRewriter extends Disposable implements ICommandLineRewriter {\n\trewrite(options: ICommandLineRewriterOptions): ICommandLineRewriterResult | undefined {\n\t\tif (!options.cwd) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\tconst isPwsh = isPowerShell(options.shell, options.os);\n\n\t\t// Re-write the command if it starts with `cd <dir> && <suffix>` or `cd <dir>; <suffix>`\n\t\t// to just `<suffix>` if the directory matches the current terminal's cwd. This simplifies\n\t\t// the result in the chat by removing redundancies that some models like to add.\n\t\tconst cdPrefixMatch = options.commandLine.match(\n\t\t\tisPwsh\n\t\t\t\t? /^(?:cd(?: \\/d)?|Set-Location(?: -Path)?) (?<dir>[^\\s]+) ?(?:&&|;)\\s+(?<suffix>.+)$/i\n\t\t\t\t: /^cd (?<dir>[^\\s]+) &&\\s+(?<suffix>.+)$/\n\t\t);\n\t\tconst cdDir = cdPrefixMatch?.groups?.dir;\n\t\tconst cdSuffix = cdPrefixMatch?.groups?.suffix;\n\t\tif (cdDir && cdSuffix) {\n\t\t\t// Remove any surrounding quotes\n\t\t\tlet cdDirPath = cdDir;\n\t\t\tif (cdDirPath.startsWith('\"') && cdDirPath.endsWith('\"')) {\n\t\t\t\tcdDirPath = cdDirPath.slice(1, -1);\n\t\t\t}\n\t\t\t// Normalize trailing slashes\n\t\t\tcdDirPath = cdDirPath.replace(/(?:[\\\\\\/])$/, '');\n\t\t\tlet cwdFsPath = options.cwd.fsPath.replace(/(?:[\\\\\\/])$/, '');\n\t\t\t// Case-insensitive comparison on Windows\n\t\t\tif (options.os === OperatingSystem.Windows) {\n\t\t\t\tcdDirPath = cdDirPath.toLowerCase();\n\t\t\t\tcwdFsPath = cwdFsPath.toLowerCase();\n\t\t\t}\n\t\t\tif (cdDirPath === cwdFsPath) {\n\t\t\t\treturn { rewritten: cdSuffix, reasoning: 'Removed redundant cd command' };\n\t\t\t}\n\t\t}\n\t\treturn undefined;\n\t}\n}\n"]}