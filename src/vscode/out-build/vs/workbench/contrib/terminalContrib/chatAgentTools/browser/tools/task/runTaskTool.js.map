{"version":3,"sources":["vs/workbench/contrib/terminalContrib/chatAgentTools/browser/tools/task/runTaskTool.ts"],"names":[],"mappings":"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","file":"runTaskTool.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { timeout } from '../../../../../../../base/common/async.js';\nimport { CancellationToken } from '../../../../../../../base/common/cancellation.js';\nimport { localize } from '../../../../../../../nls.js';\nimport { ITelemetryService } from '../../../../../../../platform/telemetry/common/telemetry.js';\nimport { CountTokensCallback, IPreparedToolInvocation, IToolData, IToolImpl, IToolInvocation, IToolInvocationPreparationContext, IToolResult, ToolDataSource, ToolProgress } from '../../../../../chat/common/languageModelToolsService.js';\nimport { ITaskService, ITaskSummary, Task, TasksAvailableContext } from '../../../../../tasks/common/taskService.js';\nimport { TaskRunSource } from '../../../../../tasks/common/tasks.js';\nimport { ITerminalService } from '../../../../../terminal/browser/terminal.js';\nimport { collectTerminalResults, getTaskDefinition, getTaskForTool, resolveDependencyTasks, tasksMatch } from '../../taskHelpers.js';\nimport { MarkdownString } from '../../../../../../../base/common/htmlContent.js';\nimport { IConfigurationService } from '../../../../../../../platform/configuration/common/configuration.js';\nimport { Codicon } from '../../../../../../../base/common/codicons.js';\nimport { toolResultDetailsFromResponse, toolResultMessageFromResponse } from './taskHelpers.js';\nimport { IInstantiationService } from '../../../../../../../platform/instantiation/common/instantiation.js';\nimport { DisposableStore } from '../../../../../../../base/common/lifecycle.js';\nimport { TaskToolClassification, TaskToolEvent } from './taskToolsTelemetry.js';\n\ninterface IRunTaskToolInput extends IToolInvocation {\n\tid: string;\n\tworkspaceFolder: string;\n}\n\nexport class RunTaskTool implements IToolImpl {\n\n\tconstructor(\n\t\t@ITaskService private readonly _tasksService: ITaskService,\n\t\t@ITelemetryService private readonly _telemetryService: ITelemetryService,\n\t\t@ITerminalService private readonly _terminalService: ITerminalService,\n\t\t@IConfigurationService private readonly _configurationService: IConfigurationService,\n\t\t@IInstantiationService private readonly _instantiationService: IInstantiationService\n\t) { }\n\n\tasync invoke(invocation: IToolInvocation, _countTokens: CountTokensCallback, _progress: ToolProgress, token: CancellationToken): Promise<IToolResult> {\n\t\tconst args = invocation.parameters as IRunTaskToolInput;\n\n\t\tif (!invocation.context) {\n\t\t\treturn { content: [{ kind: 'text', value: `No invocation context` }], toolResultMessage: `No invocation context` };\n\t\t}\n\n\t\tconst taskDefinition = getTaskDefinition(args.id);\n\t\tconst task = await getTaskForTool(args.id, taskDefinition, args.workspaceFolder, this._configurationService, this._tasksService, true);\n\t\tif (!task) {\n\t\t\treturn { content: [{ kind: 'text', value: `Task not found: ${args.id}` }], toolResultMessage: new MarkdownString(localize('chat.taskNotFound', 'Task not found: `{0}`', args.id)) };\n\t\t}\n\t\tconst taskLabel = task._label;\n\t\tconst activeTasks = await this._tasksService.getActiveTasks();\n\t\tif (activeTasks.includes(task)) {\n\t\t\treturn { content: [{ kind: 'text', value: `The task ${taskLabel} is already running.` }], toolResultMessage: new MarkdownString(localize('chat.taskAlreadyRunning', 'The task `{0}` is already running.', taskLabel)) };\n\t\t}\n\n\t\tconst raceResult = await Promise.race([this._tasksService.run(task, undefined, TaskRunSource.ChatAgent), timeout(3000)]);\n\t\tconst result: ITaskSummary | undefined = raceResult && typeof raceResult === 'object' ? raceResult as ITaskSummary : undefined;\n\n\t\tconst dependencyTasks = await resolveDependencyTasks(task, args.workspaceFolder, this._configurationService, this._tasksService);\n\t\tconst resources = this._tasksService.getTerminalsForTasks(dependencyTasks ?? task);\n\t\tif (!resources || resources.length === 0) {\n\t\t\treturn { content: [{ kind: 'text', value: `Task started but no terminal was found for: ${taskLabel}` }], toolResultMessage: new MarkdownString(localize('chat.noTerminal', 'Task started but no terminal was found for: `{0}`', taskLabel)) };\n\t\t}\n\t\tconst terminals = this._terminalService.instances.filter(t => resources.some(r => r.path === t.resource.path && r.scheme === t.resource.scheme));\n\t\tif (terminals.length === 0) {\n\t\t\treturn { content: [{ kind: 'text', value: `Task started but no terminal was found for: ${taskLabel}` }], toolResultMessage: new MarkdownString(localize('chat.noTerminal', 'Task started but no terminal was found for: `{0}`', taskLabel)) };\n\t\t}\n\n\t\tconst store = new DisposableStore();\n\t\tconst terminalResults = await collectTerminalResults(\n\t\t\tterminals,\n\t\t\ttask,\n\t\t\tthis._instantiationService,\n\t\t\tinvocation.context!,\n\t\t\t_progress,\n\t\t\ttoken,\n\t\t\tstore,\n\t\t\t(terminalTask) => this._isTaskActive(terminalTask),\n\t\t\tdependencyTasks,\n\t\t\tthis._tasksService\n\t\t);\n\t\tstore.dispose();\n\t\tfor (const r of terminalResults) {\n\t\t\tthis._telemetryService.publicLog2?.<TaskToolEvent, TaskToolClassification>('copilotChat.runTaskTool.run', {\n\t\t\t\ttaskId: args.id,\n\t\t\t\tbufferLength: r.output.length ?? 0,\n\t\t\t\tpollDurationMs: r.pollDurationMs ?? 0,\n\t\t\t\tinputToolManualAcceptCount: r.inputToolManualAcceptCount ?? 0,\n\t\t\t\tinputToolManualRejectCount: r.inputToolManualRejectCount ?? 0,\n\t\t\t\tinputToolManualChars: r.inputToolManualChars ?? 0,\n\t\t\t\tinputToolManualShownCount: r.inputToolManualShownCount ?? 0,\n\t\t\t\tinputToolFreeFormInputShownCount: r.inputToolFreeFormInputShownCount ?? 0,\n\t\t\t\tinputToolFreeFormInputCount: r.inputToolFreeFormInputCount ?? 0\n\t\t\t});\n\t\t}\n\n\t\tconst details = terminalResults.map(r => `Terminal: ${r.name}\\nOutput:\\n${r.output}`);\n\t\tconst uniqueDetails = Array.from(new Set(details)).join('\\n\\n');\n\t\tconst toolResultDetails = toolResultDetailsFromResponse(terminalResults);\n\t\tconst toolResultMessage = toolResultMessageFromResponse(result, taskLabel, toolResultDetails, terminalResults);\n\n\t\treturn {\n\t\t\tcontent: [{ kind: 'text', value: uniqueDetails }],\n\t\t\ttoolResultMessage,\n\t\t\ttoolResultDetails\n\t\t};\n\t}\n\n\tprivate async _isTaskActive(task: Task): Promise<boolean> {\n\t\tconst busyTasks = await this._tasksService.getBusyTasks();\n\t\treturn busyTasks?.some(t => tasksMatch(t, task)) ?? false;\n\t}\n\n\tasync prepareToolInvocation(context: IToolInvocationPreparationContext, token: CancellationToken): Promise<IPreparedToolInvocation | undefined> {\n\t\tconst args = context.parameters as IRunTaskToolInput;\n\t\tconst taskDefinition = getTaskDefinition(args.id);\n\n\t\tconst task = await getTaskForTool(args.id, taskDefinition, args.workspaceFolder, this._configurationService, this._tasksService, true);\n\t\tif (!task) {\n\t\t\treturn { invocationMessage: new MarkdownString(localize('chat.taskNotFound', 'Task not found: `{0}`', args.id)) };\n\t\t}\n\t\tconst taskLabel = task._label;\n\t\tconst activeTasks = await this._tasksService.getActiveTasks();\n\t\tif (task && activeTasks.includes(task)) {\n\t\t\treturn { invocationMessage: new MarkdownString(localize('chat.taskAlreadyActive', 'The task is already running.')) };\n\t\t}\n\n\t\tif (await this._isTaskActive(task)) {\n\t\t\treturn {\n\t\t\t\tinvocationMessage: new MarkdownString(localize('chat.taskIsAlreadyRunning', '`{0}` is already running.', taskLabel)),\n\t\t\t\tpastTenseMessage: new MarkdownString(localize('chat.taskWasAlreadyRunning', '`{0}` was already running.', taskLabel)),\n\t\t\t\tconfirmationMessages: undefined\n\t\t\t};\n\t\t}\n\n\t\treturn {\n\t\t\tinvocationMessage: new MarkdownString(localize('chat.runningTask', 'Running `{0}`', taskLabel)),\n\t\t\tpastTenseMessage: new MarkdownString(task?.configurationProperties.isBackground\n\t\t\t\t? localize('chat.startedTask', 'Started `{0}`', taskLabel)\n\t\t\t\t: localize('chat.ranTask', 'Ran `{0}`', taskLabel)),\n\t\t\tconfirmationMessages: task\n\t\t\t\t? { title: localize('chat.allowTaskRunTitle', 'Allow task run?'), message: localize('chat.allowTaskRunMsg', 'Allow to run the task `{0}`?', taskLabel) }\n\t\t\t\t: undefined\n\t\t};\n\t}\n}\n\nexport const RunTaskToolData: IToolData = {\n\tid: 'run_task',\n\ttoolReferenceName: 'runTask',\n\tlegacyToolReferenceFullNames: ['runTasks/runTask'],\n\tdisplayName: localize('runInTerminalTool.displayName', 'Run Task'),\n\tmodelDescription: 'Runs a VS Code task.\\n\\n- If you see that an appropriate task exists for building or running code, prefer to use this tool to run the task instead of using the run_in_terminal tool.\\n- Make sure that any appropriate build or watch task is running before trying to run tests or execute code.\\n- If the user asks to run a task, use this tool to do so.',\n\tuserDescription: localize('runInTerminalTool.userDescription', 'Run tasks in the workspace'),\n\ticon: Codicon.tools,\n\tsource: ToolDataSource.Internal,\n\twhen: TasksAvailableContext,\n\tinputSchema: {\n\t\t'type': 'object',\n\t\t'properties': {\n\t\t\t'workspaceFolder': {\n\t\t\t\t'type': 'string',\n\t\t\t\t'description': 'The workspace folder path containing the task'\n\t\t\t},\n\t\t\t'id': {\n\t\t\t\t'type': 'string',\n\t\t\t\t'description': 'The task ID to run.'\n\t\t\t}\n\t\t},\n\t\t'required': [\n\t\t\t'workspaceFolder',\n\t\t\t'id'\n\t\t]\n\t}\n};\n"]}