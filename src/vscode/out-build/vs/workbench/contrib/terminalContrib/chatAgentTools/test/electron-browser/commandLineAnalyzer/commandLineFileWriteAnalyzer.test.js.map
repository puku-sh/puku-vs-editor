{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/contrib/terminalContrib/chatAgentTools/test/electron-browser/commandLineAnalyzer/commandLineFileWriteAnalyzer.test.ts","vs/workbench/contrib/terminalContrib/chatAgentTools/test/electron-browser/commandLineAnalyzer/commandLineFileWriteAnalyzer.test.ts"],"names":[],"mappings":"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","file":"commandLineFileWriteAnalyzer.test.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { strictEqual } from 'assert';\nimport { Schemas } from '../../../../../../../base/common/network.js';\nimport { isWindows, OperatingSystem } from '../../../../../../../base/common/platform.js';\nimport { URI } from '../../../../../../../base/common/uri.js';\nimport { ensureNoDisposablesAreLeakedInTestSuite } from '../../../../../../../base/test/common/utils.js';\nimport { ITreeSitterLibraryService } from '../../../../../../../editor/common/services/treeSitter/treeSitterLibraryService.js';\nimport { TestConfigurationService } from '../../../../../../../platform/configuration/test/common/testConfigurationService.js';\nimport { FileService } from '../../../../../../../platform/files/common/fileService.js';\nimport type { TestInstantiationService } from '../../../../../../../platform/instantiation/test/common/instantiationServiceMock.js';\nimport { NullLogService } from '../../../../../../../platform/log/common/log.js';\nimport { IWorkspaceContextService, toWorkspaceFolder } from '../../../../../../../platform/workspace/common/workspace.js';\nimport { Workspace } from '../../../../../../../platform/workspace/test/common/testWorkspace.js';\nimport { TreeSitterLibraryService } from '../../../../../../services/treeSitter/browser/treeSitterLibraryService.js';\nimport { workbenchInstantiationService } from '../../../../../../test/browser/workbenchTestServices.js';\nimport { TestContextService } from '../../../../../../test/common/workbenchTestServices.js';\nimport { TestIPCFileSystemProvider } from '../../../../../../test/electron-browser/workbenchTestServices.js';\nimport type { ICommandLineAnalyzerOptions } from '../../../browser/tools/commandLineAnalyzer/commandLineAnalyzer.js';\nimport { CommandLineFileWriteAnalyzer } from '../../../browser/tools/commandLineAnalyzer/commandLineFileWriteAnalyzer.js';\nimport { TreeSitterCommandParser, TreeSitterCommandParserLanguage } from '../../../browser/treeSitterCommandParser.js';\nimport { TerminalChatAgentToolsSettingId } from '../../../common/terminalChatAgentToolsConfiguration.js';\n\nsuite('CommandLineFileWriteAnalyzer', () => {\n\tconst store = ensureNoDisposablesAreLeakedInTestSuite();\n\n\tlet instantiationService: TestInstantiationService;\n\tlet parser: TreeSitterCommandParser;\n\tlet analyzer: CommandLineFileWriteAnalyzer;\n\tlet configurationService: TestConfigurationService;\n\tlet workspaceContextService: TestContextService;\n\n\tconst mockLog = (..._args: unknown[]) => { };\n\n\tsetup(() => {\n\t\tconst fileService = store.add(new FileService(new NullLogService()));\n\t\tconst fileSystemProvider = new TestIPCFileSystemProvider();\n\t\tstore.add(fileService.registerProvider(Schemas.file, fileSystemProvider));\n\n\t\tconfigurationService = new TestConfigurationService();\n\t\tworkspaceContextService = new TestContextService();\n\n\t\tinstantiationService = workbenchInstantiationService({\n\t\t\tfileService: () => fileService,\n\t\t\tconfigurationService: () => configurationService\n\t\t}, store);\n\n\t\tinstantiationService.stub(IWorkspaceContextService, workspaceContextService);\n\n\t\tconst treeSitterLibraryService = store.add(instantiationService.createInstance(TreeSitterLibraryService));\n\t\ttreeSitterLibraryService.isTest = true;\n\t\tinstantiationService.stub(ITreeSitterLibraryService, treeSitterLibraryService);\n\n\t\tparser = store.add(instantiationService.createInstance(TreeSitterCommandParser));\n\n\t\tanalyzer = store.add(instantiationService.createInstance(\n\t\t\tCommandLineFileWriteAnalyzer,\n\t\t\tparser,\n\t\t\tmockLog\n\t\t));\n\t});\n\n\t(isWindows ? suite.skip : suite)('bash', () => {\n\t\tconst cwd = URI.file('/workspace/project');\n\n\t\tasync function t(commandLine: string, blockDetectedFileWrites: 'never' | 'outsideWorkspace' | 'all', expectedAutoApprove: boolean, expectedDisclaimers: number = 0, workspaceFolders: URI[] = [cwd]) {\n\t\t\tconfigurationService.setUserConfiguration(TerminalChatAgentToolsSettingId.BlockDetectedFileWrites, blockDetectedFileWrites);\n\n\t\t\t// Setup workspace folders\n\t\t\tconst workspace = new Workspace('test', workspaceFolders.map(uri => toWorkspaceFolder(uri)));\n\t\t\tworkspaceContextService.setWorkspace(workspace);\n\n\t\t\tconst options: ICommandLineAnalyzerOptions = {\n\t\t\t\tcommandLine,\n\t\t\t\tcwd,\n\t\t\t\tshell: 'bash',\n\t\t\t\tos: OperatingSystem.Linux,\n\t\t\t\ttreeSitterLanguage: TreeSitterCommandParserLanguage.Bash,\n\t\t\t\tterminalToolSessionId: 'test',\n\t\t\t\tchatSessionId: 'test',\n\t\t\t};\n\n\t\t\tconst result = await analyzer.analyze(options);\n\t\t\tstrictEqual(result.isAutoApproveAllowed, expectedAutoApprove, `Expected auto approve to be ${expectedAutoApprove} for: ${commandLine}`);\n\t\t\tstrictEqual((result.disclaimers || []).length, expectedDisclaimers, `Expected ${expectedDisclaimers} disclaimers for: ${commandLine}`);\n\t\t}\n\n\t\tsuite('blockDetectedFileWrites: never', () => {\n\t\t\ttest('relative path - simple output redirection', () => t('echo hello > file.txt', 'never', true, 1));\n\t\t\ttest('relative path - append redirection', () => t('echo hello >> file.txt', 'never', true, 1));\n\t\t\ttest('relative paths - multiple redirections', () => t('echo hello > file1.txt && echo world > file2.txt', 'never', true, 1));\n\t\t\ttest('relative path - error redirection', () => t('cat missing.txt 2> error.log', 'never', true, 1));\n\t\t\ttest('no redirections', () => t('echo hello', 'never', true, 0));\n\t\t\ttest('absolute path - /dev/null allowed with never', () => t('echo hello > /dev/null', 'never', true, 1));\n\t\t});\n\n\t\tsuite('blockDetectedFileWrites: outsideWorkspace', () => {\n\t\t\t// Relative paths (joined with cwd)\n\t\t\ttest('relative path - file in workspace root - allow', () => t('echo hello > file.txt', 'outsideWorkspace', true, 1));\n\t\t\ttest('relative path - file in subdirectory - allow', () => t('echo hello > subdir/file.txt', 'outsideWorkspace', true, 1));\n\t\t\ttest('relative path - parent directory - block', () => t('echo hello > ../file.txt', 'outsideWorkspace', false, 1));\n\t\t\ttest('relative path - grandparent directory - block', () => t('echo hello > ../../file.txt', 'outsideWorkspace', false, 1));\n\n\t\t\t// Absolute paths (parsed as-is)\n\t\t\ttest('absolute path - /tmp - block', () => t('echo hello > /tmp/file.txt', 'outsideWorkspace', false, 1));\n\t\t\ttest('absolute path - /etc - block', () => t('echo hello > /etc/config.txt', 'outsideWorkspace', false, 1));\n\t\t\ttest('absolute path - /home - block', () => t('echo hello > /home/user/file.txt', 'outsideWorkspace', false, 1));\n\t\t\ttest('absolute path - root - block', () => t('echo hello > /file.txt', 'outsideWorkspace', false, 1));\n\t\t\ttest('absolute path - /dev/null - allow (null device)', () => t('echo hello > /dev/null', 'outsideWorkspace', true, 1));\n\n\t\t\t// Special cases\n\t\t\ttest('no workspace folders - block', () => t('echo hello > file.txt', 'outsideWorkspace', false, 1, []));\n\t\t\ttest('no workspace folders - /dev/null allowed', () => t('echo hello > /dev/null', 'outsideWorkspace', true, 1, []));\n\t\t\ttest('no redirections - allow', () => t('echo hello', 'outsideWorkspace', true, 0));\n\t\t\ttest('variable in filename - block', () => t('echo hello > $HOME/file.txt', 'outsideWorkspace', false, 1));\n\t\t\ttest('command substitution - block', () => t('echo hello > $(pwd)/file.txt', 'outsideWorkspace', false, 1));\n\t\t\ttest('brace expansion - block', () => t('echo hello > {a,b}.txt', 'outsideWorkspace', false, 1));\n\t\t});\n\n\t\tsuite('blockDetectedFileWrites: all', () => {\n\t\t\ttest('inside workspace - block', () => t('echo hello > file.txt', 'all', false, 1));\n\t\t\ttest('outside workspace - block', () => t('echo hello > /tmp/file.txt', 'all', false, 1));\n\t\t\ttest('no redirections - allow', () => t('echo hello', 'all', true, 0));\n\t\t\ttest('multiple inside workspace - block', () => t('echo hello > file1.txt && echo world > file2.txt', 'all', false, 1));\n\t\t});\n\n\t\tsuite('complex scenarios', () => {\n\t\t\ttest('pipeline with redirection inside workspace', () => t('cat file.txt | grep \"test\" > output.txt', 'outsideWorkspace', true, 1));\n\t\t\ttest('multiple redirections mixed inside/outside', () => t('echo hello > file.txt && echo world > /tmp/file.txt', 'outsideWorkspace', false, 1));\n\t\t\ttest('here-document', () => t('cat > file.txt << EOF\\nhello\\nEOF', 'outsideWorkspace', true, 1));\n\t\t\ttest('error output to /dev/null - allow', () => t('cat missing.txt 2> /dev/null', 'outsideWorkspace', true, 1));\n\t\t});\n\n\t\tsuite('no cwd provided', () => {\n\t\t\tasync function tNoCwd(commandLine: string, blockDetectedFileWrites: 'never' | 'outsideWorkspace' | 'all', expectedAutoApprove: boolean, expectedDisclaimers: number = 0) {\n\t\t\t\tconfigurationService.setUserConfiguration(TerminalChatAgentToolsSettingId.BlockDetectedFileWrites, blockDetectedFileWrites);\n\n\t\t\t\tconst workspace = new Workspace('test', [toWorkspaceFolder(cwd)]);\n\t\t\t\tworkspaceContextService.setWorkspace(workspace);\n\n\t\t\t\tconst options: ICommandLineAnalyzerOptions = {\n\t\t\t\t\tcommandLine,\n\t\t\t\t\tcwd: undefined,\n\t\t\t\t\tshell: 'bash',\n\t\t\t\t\tos: OperatingSystem.Linux,\n\t\t\t\t\ttreeSitterLanguage: TreeSitterCommandParserLanguage.Bash,\n\t\t\t\t\tterminalToolSessionId: 'test',\n\t\t\t\t\tchatSessionId: 'test',\n\t\t\t\t};\n\n\t\t\t\tconst result = await analyzer.analyze(options);\n\t\t\t\tstrictEqual(result.isAutoApproveAllowed, expectedAutoApprove, `Expected auto approve to be ${expectedAutoApprove} for: ${commandLine}`);\n\t\t\t\tstrictEqual((result.disclaimers || []).length, expectedDisclaimers, `Expected ${expectedDisclaimers} disclaimers for: ${commandLine}`);\n\t\t\t}\n\n\t\t\t// When cwd is undefined, relative paths remain as strings and are blocked\n\t\t\ttest('relative path - never setting - allow', () => tNoCwd('echo hello > file.txt', 'never', true, 1));\n\t\t\ttest('relative path - outsideWorkspace setting - block (unknown cwd)', () => tNoCwd('echo hello > file.txt', 'outsideWorkspace', false, 1));\n\t\t\ttest('relative path - all setting - block', () => tNoCwd('echo hello > file.txt', 'all', false, 1));\n\n\t\t\t// Absolute paths are converted to URIs and checked normally\n\t\t\ttest('absolute path inside workspace - outsideWorkspace setting - allow', () => tNoCwd('echo hello > /workspace/project/file.txt', 'outsideWorkspace', true, 1));\n\t\t\ttest('absolute path outside workspace - outsideWorkspace setting - block', () => tNoCwd('echo hello > /tmp/file.txt', 'outsideWorkspace', false, 1));\n\t\t\ttest('absolute path - all setting - block', () => tNoCwd('echo hello > /tmp/file.txt', 'all', false, 1));\n\t\t});\n\t});\n\n\t(isWindows ? suite : suite.skip)('pwsh', () => {\n\t\tconst cwd = URI.file('C:/workspace/project');\n\n\t\tasync function t(commandLine: string, blockDetectedFileWrites: 'never' | 'outsideWorkspace' | 'all', expectedAutoApprove: boolean, expectedDisclaimers: number = 0, workspaceFolders: URI[] = [cwd]) {\n\t\t\tconfigurationService.setUserConfiguration(TerminalChatAgentToolsSettingId.BlockDetectedFileWrites, blockDetectedFileWrites);\n\n\t\t\t// Setup workspace folders\n\t\t\tconst workspace = new Workspace('test', workspaceFolders.map(uri => toWorkspaceFolder(uri)));\n\t\t\tworkspaceContextService.setWorkspace(workspace);\n\n\t\t\tconst options: ICommandLineAnalyzerOptions = {\n\t\t\t\tcommandLine,\n\t\t\t\tcwd,\n\t\t\t\tshell: 'pwsh',\n\t\t\t\tos: OperatingSystem.Windows,\n\t\t\t\ttreeSitterLanguage: TreeSitterCommandParserLanguage.PowerShell,\n\t\t\t\tterminalToolSessionId: 'test',\n\t\t\t\tchatSessionId: 'test',\n\t\t\t};\n\n\t\t\tconst result = await analyzer.analyze(options);\n\t\t\tstrictEqual(result.isAutoApproveAllowed, expectedAutoApprove, `Expected auto approve to be ${expectedAutoApprove} for: ${commandLine}`);\n\t\t\tstrictEqual((result.disclaimers || []).length, expectedDisclaimers, `Expected ${expectedDisclaimers} disclaimers for: ${commandLine}`);\n\t\t}\n\n\t\tsuite('blockDetectedFileWrites: never', () => {\n\t\t\ttest('simple output redirection', () => t('Write-Host \"hello\" > file.txt', 'never', true, 1));\n\t\t\ttest('append redirection', () => t('Write-Host \"hello\" >> file.txt', 'never', true, 1));\n\t\t\ttest('multiple redirections', () => t('Write-Host \"hello\" > file1.txt ; Write-Host \"world\" > file2.txt', 'never', true, 1));\n\t\t\ttest('error redirection', () => t('Get-Content missing.txt 2> error.log', 'never', true, 1));\n\t\t\ttest('no redirections', () => t('Write-Host \"hello\"', 'never', true, 0));\n\t\t});\n\n\t\tsuite('blockDetectedFileWrites: outsideWorkspace', () => {\n\t\t\t// Relative paths (joined with cwd)\n\t\t\ttest('relative path - file in workspace root - allow', () => t('Write-Host \"hello\" > file.txt', 'outsideWorkspace', true, 1));\n\t\t\ttest('relative path - file in subdirectory - allow', () => t('Write-Host \"hello\" > subdir\\\\file.txt', 'outsideWorkspace', true, 1));\n\t\t\ttest('relative path - parent directory - block', () => t('Write-Host \"hello\" > ..\\\\file.txt', 'outsideWorkspace', false, 1));\n\t\t\ttest('relative path - grandparent directory - block', () => t('Write-Host \"hello\" > ..\\\\..\\\\file.txt', 'outsideWorkspace', false, 1));\n\n\t\t\t// Absolute paths - Windows drive letters (parsed as-is)\n\t\t\ttest('absolute path - C: drive - block', () => t('Write-Host \"hello\" > C:\\\\temp\\\\file.txt', 'outsideWorkspace', false, 1));\n\t\t\ttest('absolute path - D: drive - block', () => t('Write-Host \"hello\" > D:\\\\data\\\\config.txt', 'outsideWorkspace', false, 1));\n\t\t\ttest('absolute path - different drive than workspace - block', () => t('Write-Host \"hello\" > E:\\\\external\\\\file.txt', 'outsideWorkspace', false, 1));\n\n\t\t\t// Absolute paths - UNC paths\n\t\t\ttest('absolute path - UNC path - block', () => t('Write-Host \"hello\" > \\\\\\\\server\\\\share\\\\file.txt', 'outsideWorkspace', false, 1));\n\n\t\t\t// Special cases\n\t\t\ttest('no workspace folders - block', () => t('Write-Host \"hello\" > file.txt', 'outsideWorkspace', false, 1, []));\n\t\t\ttest('no redirections - allow', () => t('Write-Host \"hello\"', 'outsideWorkspace', true, 0));\n\t\t\ttest('variable in filename - block', () => t('Write-Host \"hello\" > $env:TEMP\\\\file.txt', 'outsideWorkspace', false, 1));\n\t\t\ttest('subexpression - block', () => t('Write-Host \"hello\" > $(Get-Date).log', 'outsideWorkspace', false, 1));\n\t\t});\n\n\t\tsuite('blockDetectedFileWrites: all', () => {\n\t\t\ttest('inside workspace - block', () => t('Write-Host \"hello\" > file.txt', 'all', false, 1));\n\t\t\ttest('outside workspace - block', () => t('Write-Host \"hello\" > C:\\\\temp\\\\file.txt', 'all', false, 1));\n\t\t\ttest('no redirections - allow', () => t('Write-Host \"hello\"', 'all', true, 0));\n\t\t\ttest('multiple inside workspace - block', () => t('Write-Host \"hello\" > file1.txt ; Write-Host \"world\" > file2.txt', 'all', false, 1));\n\t\t});\n\n\t\tsuite('complex scenarios', () => {\n\t\t\ttest('pipeline with redirection inside workspace', () => t('Get-Process | Where-Object {$_.CPU -gt 100} > processes.txt', 'outsideWorkspace', true, 1));\n\t\t\ttest('multiple redirections mixed inside/outside', () => t('Write-Host \"hello\" > file.txt ; Write-Host \"world\" > C:\\\\temp\\\\file.txt', 'outsideWorkspace', false, 1));\n\t\t\ttest('all streams redirection', () => t('Get-Process *> all.log', 'outsideWorkspace', true, 1));\n\t\t\ttest('multiple stream redirections', () => t('Get-Content missing.txt > output.txt 2> error.txt 3> warning.txt', 'outsideWorkspace', true, 1));\n\t\t});\n\n\t\tsuite('edge cases', () => {\n\t\t\ttest('redirection to $null (PowerShell null device) - allow', () => t('Write-Host \"hello\" > $null', 'outsideWorkspace', true, 1));\n\t\t\ttest('relative path with backslashes - allow', () => t('Write-Host \"hello\" > server\\\\share\\\\file.txt', 'outsideWorkspace', true, 1));\n\t\t\ttest('quoted filename inside workspace - allow', () => t('Write-Host \"hello\" > \"file with spaces.txt\"', 'outsideWorkspace', true, 1));\n\t\t\ttest('forward slashes on Windows (relative) - allow', () => t('Write-Host \"hello\" > subdir/file.txt', 'outsideWorkspace', true, 1));\n\t\t});\n\t});\n\n\tsuite('disclaimer messages', () => {\n\t\tconst cwd = URI.file('/workspace/project');\n\n\t\tasync function checkDisclaimer(commandLine: string, blockDetectedFileWrites: 'never' | 'outsideWorkspace' | 'all', expectedContains: string) {\n\t\t\tconfigurationService.setUserConfiguration(TerminalChatAgentToolsSettingId.BlockDetectedFileWrites, blockDetectedFileWrites);\n\n\t\t\tconst workspace = new Workspace('test', [toWorkspaceFolder(cwd)]);\n\t\t\tworkspaceContextService.setWorkspace(workspace);\n\n\t\t\tconst options: ICommandLineAnalyzerOptions = {\n\t\t\t\tcommandLine,\n\t\t\t\tcwd,\n\t\t\t\tshell: 'bash',\n\t\t\t\tos: OperatingSystem.Linux,\n\t\t\t\ttreeSitterLanguage: TreeSitterCommandParserLanguage.Bash,\n\t\t\t\tterminalToolSessionId: 'test',\n\t\t\t\tchatSessionId: 'test',\n\t\t\t};\n\n\t\t\tconst result = await analyzer.analyze(options);\n\t\t\tconst disclaimers = result.disclaimers || [];\n\t\t\tstrictEqual(disclaimers.length > 0, true, 'Expected at least one disclaimer');\n\t\t\tconst combinedDisclaimers = disclaimers.join(' ');\n\t\t\tstrictEqual(combinedDisclaimers.includes(expectedContains), true, `Expected disclaimer to contain \"${expectedContains}\" but got: ${combinedDisclaimers}`);\n\t\t}\n\n\t\ttest('blocked disclaimer - absolute path outside workspace', () => checkDisclaimer('echo hello > /tmp/file.txt', 'outsideWorkspace', 'cannot be auto approved'));\n\t\ttest('allowed disclaimer - relative path inside workspace', () => checkDisclaimer('echo hello > file.txt', 'outsideWorkspace', 'File write operations detected'));\n\t\ttest('blocked disclaimer - all setting blocks everything', () => checkDisclaimer('echo hello > file.txt', 'all', 'cannot be auto approved'));\n\t});\n\n\tsuite('multiple workspace folders', () => {\n\t\tconst workspace1 = URI.file('/workspace/project1');\n\t\tconst workspace2 = URI.file('/workspace/project2');\n\n\t\tasync function t(cwd: URI, commandLine: string, expectedAutoApprove: boolean, expectedDisclaimers: number = 0) {\n\t\t\tconfigurationService.setUserConfiguration(TerminalChatAgentToolsSettingId.BlockDetectedFileWrites, 'outsideWorkspace');\n\n\t\t\tconst workspace = new Workspace('test', [workspace1, workspace2].map(uri => toWorkspaceFolder(uri)));\n\t\t\tworkspaceContextService.setWorkspace(workspace);\n\n\t\t\tconst options: ICommandLineAnalyzerOptions = {\n\t\t\t\tcommandLine,\n\t\t\t\tcwd,\n\t\t\t\tshell: 'bash',\n\t\t\t\tos: OperatingSystem.Linux,\n\t\t\t\ttreeSitterLanguage: TreeSitterCommandParserLanguage.Bash,\n\t\t\t\tterminalToolSessionId: 'test',\n\t\t\t\tchatSessionId: 'test',\n\t\t\t};\n\n\t\t\tconst result = await analyzer.analyze(options);\n\t\t\tstrictEqual(result.isAutoApproveAllowed, expectedAutoApprove, `Expected auto approve to be ${expectedAutoApprove} for: ${commandLine}`);\n\t\t\tstrictEqual((result.disclaimers || []).length, expectedDisclaimers, `Expected ${expectedDisclaimers} disclaimers for: ${commandLine}`);\n\t\t}\n\n\t\ttest('relative path in same workspace - allow', () => t(workspace1, 'echo hello > file.txt', true, 1));\n\t\ttest('absolute path to other workspace - allow', () => t(workspace1, 'echo hello > /workspace/project2/file.txt', true, 1));\n\t\ttest('absolute path outside all workspaces - block', () => t(workspace1, 'echo hello > /tmp/file.txt', false, 1));\n\t\ttest('relative path to parent of workspace - block', () => t(workspace1, 'echo hello > ../file.txt', false, 1));\n\t});\n\n\tsuite('uri schemes', () => {\n\t\tasync function t(cwdScheme: string, filePath: string, expectedAutoApprove: boolean) {\n\t\t\tconfigurationService.setUserConfiguration(TerminalChatAgentToolsSettingId.BlockDetectedFileWrites, 'outsideWorkspace');\n\n\t\t\tconst cwd = URI.from({ scheme: cwdScheme, path: '/workspace/project' });\n\t\t\tconst workspace = new Workspace('test', [toWorkspaceFolder(cwd)]);\n\t\t\tworkspaceContextService.setWorkspace(workspace);\n\n\t\t\tconst options: ICommandLineAnalyzerOptions = {\n\t\t\t\tcommandLine: `echo hello > ${filePath}`,\n\t\t\t\tcwd,\n\t\t\t\tshell: 'bash',\n\t\t\t\tos: OperatingSystem.Linux,\n\t\t\t\ttreeSitterLanguage: TreeSitterCommandParserLanguage.Bash,\n\t\t\t\tterminalToolSessionId: 'test',\n\t\t\t\tchatSessionId: 'test',\n\t\t\t};\n\n\t\t\tconst result = await analyzer.analyze(options);\n\t\t\tstrictEqual(result.isAutoApproveAllowed, expectedAutoApprove);\n\t\t}\n\n\t\ttest('file scheme - relative path inside workspace', () => t('file', 'file.txt', true));\n\t\ttest('vscode-remote scheme - relative path inside workspace', () => t('vscode-remote', 'file.txt', true));\n\t\ttest('vscode-remote scheme - absolute path outside workspace', () => t('vscode-remote', '/tmp/file.txt', false));\n\t});\n});\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { strictEqual } from 'assert';\nimport { Schemas } from '../../../../../../../base/common/network.js';\nimport { isWindows, OperatingSystem } from '../../../../../../../base/common/platform.js';\nimport { URI } from '../../../../../../../base/common/uri.js';\nimport { ensureNoDisposablesAreLeakedInTestSuite } from '../../../../../../../base/test/common/utils.js';\nimport { ITreeSitterLibraryService } from '../../../../../../../editor/common/services/treeSitter/treeSitterLibraryService.js';\nimport { TestConfigurationService } from '../../../../../../../platform/configuration/test/common/testConfigurationService.js';\nimport { FileService } from '../../../../../../../platform/files/common/fileService.js';\nimport type { TestInstantiationService } from '../../../../../../../platform/instantiation/test/common/instantiationServiceMock.js';\nimport { NullLogService } from '../../../../../../../platform/log/common/log.js';\nimport { IWorkspaceContextService, toWorkspaceFolder } from '../../../../../../../platform/workspace/common/workspace.js';\nimport { Workspace } from '../../../../../../../platform/workspace/test/common/testWorkspace.js';\nimport { TreeSitterLibraryService } from '../../../../../../services/treeSitter/browser/treeSitterLibraryService.js';\nimport { workbenchInstantiationService } from '../../../../../../test/browser/workbenchTestServices.js';\nimport { TestContextService } from '../../../../../../test/common/workbenchTestServices.js';\nimport { TestIPCFileSystemProvider } from '../../../../../../test/electron-browser/workbenchTestServices.js';\nimport type { ICommandLineAnalyzerOptions } from '../../../browser/tools/commandLineAnalyzer/commandLineAnalyzer.js';\nimport { CommandLineFileWriteAnalyzer } from '../../../browser/tools/commandLineAnalyzer/commandLineFileWriteAnalyzer.js';\nimport { TreeSitterCommandParser, TreeSitterCommandParserLanguage } from '../../../browser/treeSitterCommandParser.js';\nimport { TerminalChatAgentToolsSettingId } from '../../../common/terminalChatAgentToolsConfiguration.js';\n\nsuite('CommandLineFileWriteAnalyzer', () => {\n\tconst store = ensureNoDisposablesAreLeakedInTestSuite();\n\n\tlet instantiationService: TestInstantiationService;\n\tlet parser: TreeSitterCommandParser;\n\tlet analyzer: CommandLineFileWriteAnalyzer;\n\tlet configurationService: TestConfigurationService;\n\tlet workspaceContextService: TestContextService;\n\n\tconst mockLog = (..._args: unknown[]) => { };\n\n\tsetup(() => {\n\t\tconst fileService = store.add(new FileService(new NullLogService()));\n\t\tconst fileSystemProvider = new TestIPCFileSystemProvider();\n\t\tstore.add(fileService.registerProvider(Schemas.file, fileSystemProvider));\n\n\t\tconfigurationService = new TestConfigurationService();\n\t\tworkspaceContextService = new TestContextService();\n\n\t\tinstantiationService = workbenchInstantiationService({\n\t\t\tfileService: () => fileService,\n\t\t\tconfigurationService: () => configurationService\n\t\t}, store);\n\n\t\tinstantiationService.stub(IWorkspaceContextService, workspaceContextService);\n\n\t\tconst treeSitterLibraryService = store.add(instantiationService.createInstance(TreeSitterLibraryService));\n\t\ttreeSitterLibraryService.isTest = true;\n\t\tinstantiationService.stub(ITreeSitterLibraryService, treeSitterLibraryService);\n\n\t\tparser = store.add(instantiationService.createInstance(TreeSitterCommandParser));\n\n\t\tanalyzer = store.add(instantiationService.createInstance(\n\t\t\tCommandLineFileWriteAnalyzer,\n\t\t\tparser,\n\t\t\tmockLog\n\t\t));\n\t});\n\n\t(isWindows ? suite.skip : suite)('bash', () => {\n\t\tconst cwd = URI.file('/workspace/project');\n\n\t\tasync function t(commandLine: string, blockDetectedFileWrites: 'never' | 'outsideWorkspace' | 'all', expectedAutoApprove: boolean, expectedDisclaimers: number = 0, workspaceFolders: URI[] = [cwd]) {\n\t\t\tconfigurationService.setUserConfiguration(TerminalChatAgentToolsSettingId.BlockDetectedFileWrites, blockDetectedFileWrites);\n\n\t\t\t// Setup workspace folders\n\t\t\tconst workspace = new Workspace('test', workspaceFolders.map(uri => toWorkspaceFolder(uri)));\n\t\t\tworkspaceContextService.setWorkspace(workspace);\n\n\t\t\tconst options: ICommandLineAnalyzerOptions = {\n\t\t\t\tcommandLine,\n\t\t\t\tcwd,\n\t\t\t\tshell: 'bash',\n\t\t\t\tos: OperatingSystem.Linux,\n\t\t\t\ttreeSitterLanguage: TreeSitterCommandParserLanguage.Bash,\n\t\t\t\tterminalToolSessionId: 'test',\n\t\t\t\tchatSessionId: 'test',\n\t\t\t};\n\n\t\t\tconst result = await analyzer.analyze(options);\n\t\t\tstrictEqual(result.isAutoApproveAllowed, expectedAutoApprove, `Expected auto approve to be ${expectedAutoApprove} for: ${commandLine}`);\n\t\t\tstrictEqual((result.disclaimers || []).length, expectedDisclaimers, `Expected ${expectedDisclaimers} disclaimers for: ${commandLine}`);\n\t\t}\n\n\t\tsuite('blockDetectedFileWrites: never', () => {\n\t\t\ttest('relative path - simple output redirection', () => t('echo hello > file.txt', 'never', true, 1));\n\t\t\ttest('relative path - append redirection', () => t('echo hello >> file.txt', 'never', true, 1));\n\t\t\ttest('relative paths - multiple redirections', () => t('echo hello > file1.txt && echo world > file2.txt', 'never', true, 1));\n\t\t\ttest('relative path - error redirection', () => t('cat missing.txt 2> error.log', 'never', true, 1));\n\t\t\ttest('no redirections', () => t('echo hello', 'never', true, 0));\n\t\t\ttest('absolute path - /dev/null allowed with never', () => t('echo hello > /dev/null', 'never', true, 1));\n\t\t});\n\n\t\tsuite('blockDetectedFileWrites: outsideWorkspace', () => {\n\t\t\t// Relative paths (joined with cwd)\n\t\t\ttest('relative path - file in workspace root - allow', () => t('echo hello > file.txt', 'outsideWorkspace', true, 1));\n\t\t\ttest('relative path - file in subdirectory - allow', () => t('echo hello > subdir/file.txt', 'outsideWorkspace', true, 1));\n\t\t\ttest('relative path - parent directory - block', () => t('echo hello > ../file.txt', 'outsideWorkspace', false, 1));\n\t\t\ttest('relative path - grandparent directory - block', () => t('echo hello > ../../file.txt', 'outsideWorkspace', false, 1));\n\n\t\t\t// Absolute paths (parsed as-is)\n\t\t\ttest('absolute path - /tmp - block', () => t('echo hello > /tmp/file.txt', 'outsideWorkspace', false, 1));\n\t\t\ttest('absolute path - /etc - block', () => t('echo hello > /etc/config.txt', 'outsideWorkspace', false, 1));\n\t\t\ttest('absolute path - /home - block', () => t('echo hello > /home/user/file.txt', 'outsideWorkspace', false, 1));\n\t\t\ttest('absolute path - root - block', () => t('echo hello > /file.txt', 'outsideWorkspace', false, 1));\n\t\t\ttest('absolute path - /dev/null - allow (null device)', () => t('echo hello > /dev/null', 'outsideWorkspace', true, 1));\n\n\t\t\t// Special cases\n\t\t\ttest('no workspace folders - block', () => t('echo hello > file.txt', 'outsideWorkspace', false, 1, []));\n\t\t\ttest('no workspace folders - /dev/null allowed', () => t('echo hello > /dev/null', 'outsideWorkspace', true, 1, []));\n\t\t\ttest('no redirections - allow', () => t('echo hello', 'outsideWorkspace', true, 0));\n\t\t\ttest('variable in filename - block', () => t('echo hello > $HOME/file.txt', 'outsideWorkspace', false, 1));\n\t\t\ttest('command substitution - block', () => t('echo hello > $(pwd)/file.txt', 'outsideWorkspace', false, 1));\n\t\t\ttest('brace expansion - block', () => t('echo hello > {a,b}.txt', 'outsideWorkspace', false, 1));\n\t\t});\n\n\t\tsuite('blockDetectedFileWrites: all', () => {\n\t\t\ttest('inside workspace - block', () => t('echo hello > file.txt', 'all', false, 1));\n\t\t\ttest('outside workspace - block', () => t('echo hello > /tmp/file.txt', 'all', false, 1));\n\t\t\ttest('no redirections - allow', () => t('echo hello', 'all', true, 0));\n\t\t\ttest('multiple inside workspace - block', () => t('echo hello > file1.txt && echo world > file2.txt', 'all', false, 1));\n\t\t});\n\n\t\tsuite('complex scenarios', () => {\n\t\t\ttest('pipeline with redirection inside workspace', () => t('cat file.txt | grep \"test\" > output.txt', 'outsideWorkspace', true, 1));\n\t\t\ttest('multiple redirections mixed inside/outside', () => t('echo hello > file.txt && echo world > /tmp/file.txt', 'outsideWorkspace', false, 1));\n\t\t\ttest('here-document', () => t('cat > file.txt << EOF\\nhello\\nEOF', 'outsideWorkspace', true, 1));\n\t\t\ttest('error output to /dev/null - allow', () => t('cat missing.txt 2> /dev/null', 'outsideWorkspace', true, 1));\n\t\t});\n\n\t\tsuite('no cwd provided', () => {\n\t\t\tasync function tNoCwd(commandLine: string, blockDetectedFileWrites: 'never' | 'outsideWorkspace' | 'all', expectedAutoApprove: boolean, expectedDisclaimers: number = 0) {\n\t\t\t\tconfigurationService.setUserConfiguration(TerminalChatAgentToolsSettingId.BlockDetectedFileWrites, blockDetectedFileWrites);\n\n\t\t\t\tconst workspace = new Workspace('test', [toWorkspaceFolder(cwd)]);\n\t\t\t\tworkspaceContextService.setWorkspace(workspace);\n\n\t\t\t\tconst options: ICommandLineAnalyzerOptions = {\n\t\t\t\t\tcommandLine,\n\t\t\t\t\tcwd: undefined,\n\t\t\t\t\tshell: 'bash',\n\t\t\t\t\tos: OperatingSystem.Linux,\n\t\t\t\t\ttreeSitterLanguage: TreeSitterCommandParserLanguage.Bash,\n\t\t\t\t\tterminalToolSessionId: 'test',\n\t\t\t\t\tchatSessionId: 'test',\n\t\t\t\t};\n\n\t\t\t\tconst result = await analyzer.analyze(options);\n\t\t\t\tstrictEqual(result.isAutoApproveAllowed, expectedAutoApprove, `Expected auto approve to be ${expectedAutoApprove} for: ${commandLine}`);\n\t\t\t\tstrictEqual((result.disclaimers || []).length, expectedDisclaimers, `Expected ${expectedDisclaimers} disclaimers for: ${commandLine}`);\n\t\t\t}\n\n\t\t\t// When cwd is undefined, relative paths remain as strings and are blocked\n\t\t\ttest('relative path - never setting - allow', () => tNoCwd('echo hello > file.txt', 'never', true, 1));\n\t\t\ttest('relative path - outsideWorkspace setting - block (unknown cwd)', () => tNoCwd('echo hello > file.txt', 'outsideWorkspace', false, 1));\n\t\t\ttest('relative path - all setting - block', () => tNoCwd('echo hello > file.txt', 'all', false, 1));\n\n\t\t\t// Absolute paths are converted to URIs and checked normally\n\t\t\ttest('absolute path inside workspace - outsideWorkspace setting - allow', () => tNoCwd('echo hello > /workspace/project/file.txt', 'outsideWorkspace', true, 1));\n\t\t\ttest('absolute path outside workspace - outsideWorkspace setting - block', () => tNoCwd('echo hello > /tmp/file.txt', 'outsideWorkspace', false, 1));\n\t\t\ttest('absolute path - all setting - block', () => tNoCwd('echo hello > /tmp/file.txt', 'all', false, 1));\n\t\t});\n\t});\n\n\t(isWindows ? suite : suite.skip)('pwsh', () => {\n\t\tconst cwd = URI.file('C:/workspace/project');\n\n\t\tasync function t(commandLine: string, blockDetectedFileWrites: 'never' | 'outsideWorkspace' | 'all', expectedAutoApprove: boolean, expectedDisclaimers: number = 0, workspaceFolders: URI[] = [cwd]) {\n\t\t\tconfigurationService.setUserConfiguration(TerminalChatAgentToolsSettingId.BlockDetectedFileWrites, blockDetectedFileWrites);\n\n\t\t\t// Setup workspace folders\n\t\t\tconst workspace = new Workspace('test', workspaceFolders.map(uri => toWorkspaceFolder(uri)));\n\t\t\tworkspaceContextService.setWorkspace(workspace);\n\n\t\t\tconst options: ICommandLineAnalyzerOptions = {\n\t\t\t\tcommandLine,\n\t\t\t\tcwd,\n\t\t\t\tshell: 'pwsh',\n\t\t\t\tos: OperatingSystem.Windows,\n\t\t\t\ttreeSitterLanguage: TreeSitterCommandParserLanguage.PowerShell,\n\t\t\t\tterminalToolSessionId: 'test',\n\t\t\t\tchatSessionId: 'test',\n\t\t\t};\n\n\t\t\tconst result = await analyzer.analyze(options);\n\t\t\tstrictEqual(result.isAutoApproveAllowed, expectedAutoApprove, `Expected auto approve to be ${expectedAutoApprove} for: ${commandLine}`);\n\t\t\tstrictEqual((result.disclaimers || []).length, expectedDisclaimers, `Expected ${expectedDisclaimers} disclaimers for: ${commandLine}`);\n\t\t}\n\n\t\tsuite('blockDetectedFileWrites: never', () => {\n\t\t\ttest('simple output redirection', () => t('Write-Host \"hello\" > file.txt', 'never', true, 1));\n\t\t\ttest('append redirection', () => t('Write-Host \"hello\" >> file.txt', 'never', true, 1));\n\t\t\ttest('multiple redirections', () => t('Write-Host \"hello\" > file1.txt ; Write-Host \"world\" > file2.txt', 'never', true, 1));\n\t\t\ttest('error redirection', () => t('Get-Content missing.txt 2> error.log', 'never', true, 1));\n\t\t\ttest('no redirections', () => t('Write-Host \"hello\"', 'never', true, 0));\n\t\t});\n\n\t\tsuite('blockDetectedFileWrites: outsideWorkspace', () => {\n\t\t\t// Relative paths (joined with cwd)\n\t\t\ttest('relative path - file in workspace root - allow', () => t('Write-Host \"hello\" > file.txt', 'outsideWorkspace', true, 1));\n\t\t\ttest('relative path - file in subdirectory - allow', () => t('Write-Host \"hello\" > subdir\\\\file.txt', 'outsideWorkspace', true, 1));\n\t\t\ttest('relative path - parent directory - block', () => t('Write-Host \"hello\" > ..\\\\file.txt', 'outsideWorkspace', false, 1));\n\t\t\ttest('relative path - grandparent directory - block', () => t('Write-Host \"hello\" > ..\\\\..\\\\file.txt', 'outsideWorkspace', false, 1));\n\n\t\t\t// Absolute paths - Windows drive letters (parsed as-is)\n\t\t\ttest('absolute path - C: drive - block', () => t('Write-Host \"hello\" > C:\\\\temp\\\\file.txt', 'outsideWorkspace', false, 1));\n\t\t\ttest('absolute path - D: drive - block', () => t('Write-Host \"hello\" > D:\\\\data\\\\config.txt', 'outsideWorkspace', false, 1));\n\t\t\ttest('absolute path - different drive than workspace - block', () => t('Write-Host \"hello\" > E:\\\\external\\\\file.txt', 'outsideWorkspace', false, 1));\n\n\t\t\t// Absolute paths - UNC paths\n\t\t\ttest('absolute path - UNC path - block', () => t('Write-Host \"hello\" > \\\\\\\\server\\\\share\\\\file.txt', 'outsideWorkspace', false, 1));\n\n\t\t\t// Special cases\n\t\t\ttest('no workspace folders - block', () => t('Write-Host \"hello\" > file.txt', 'outsideWorkspace', false, 1, []));\n\t\t\ttest('no redirections - allow', () => t('Write-Host \"hello\"', 'outsideWorkspace', true, 0));\n\t\t\ttest('variable in filename - block', () => t('Write-Host \"hello\" > $env:TEMP\\\\file.txt', 'outsideWorkspace', false, 1));\n\t\t\ttest('subexpression - block', () => t('Write-Host \"hello\" > $(Get-Date).log', 'outsideWorkspace', false, 1));\n\t\t});\n\n\t\tsuite('blockDetectedFileWrites: all', () => {\n\t\t\ttest('inside workspace - block', () => t('Write-Host \"hello\" > file.txt', 'all', false, 1));\n\t\t\ttest('outside workspace - block', () => t('Write-Host \"hello\" > C:\\\\temp\\\\file.txt', 'all', false, 1));\n\t\t\ttest('no redirections - allow', () => t('Write-Host \"hello\"', 'all', true, 0));\n\t\t\ttest('multiple inside workspace - block', () => t('Write-Host \"hello\" > file1.txt ; Write-Host \"world\" > file2.txt', 'all', false, 1));\n\t\t});\n\n\t\tsuite('complex scenarios', () => {\n\t\t\ttest('pipeline with redirection inside workspace', () => t('Get-Process | Where-Object {$_.CPU -gt 100} > processes.txt', 'outsideWorkspace', true, 1));\n\t\t\ttest('multiple redirections mixed inside/outside', () => t('Write-Host \"hello\" > file.txt ; Write-Host \"world\" > C:\\\\temp\\\\file.txt', 'outsideWorkspace', false, 1));\n\t\t\ttest('all streams redirection', () => t('Get-Process *> all.log', 'outsideWorkspace', true, 1));\n\t\t\ttest('multiple stream redirections', () => t('Get-Content missing.txt > output.txt 2> error.txt 3> warning.txt', 'outsideWorkspace', true, 1));\n\t\t});\n\n\t\tsuite('edge cases', () => {\n\t\t\ttest('redirection to $null (PowerShell null device) - allow', () => t('Write-Host \"hello\" > $null', 'outsideWorkspace', true, 1));\n\t\t\ttest('relative path with backslashes - allow', () => t('Write-Host \"hello\" > server\\\\share\\\\file.txt', 'outsideWorkspace', true, 1));\n\t\t\ttest('quoted filename inside workspace - allow', () => t('Write-Host \"hello\" > \"file with spaces.txt\"', 'outsideWorkspace', true, 1));\n\t\t\ttest('forward slashes on Windows (relative) - allow', () => t('Write-Host \"hello\" > subdir/file.txt', 'outsideWorkspace', true, 1));\n\t\t});\n\t});\n\n\tsuite('disclaimer messages', () => {\n\t\tconst cwd = URI.file('/workspace/project');\n\n\t\tasync function checkDisclaimer(commandLine: string, blockDetectedFileWrites: 'never' | 'outsideWorkspace' | 'all', expectedContains: string) {\n\t\t\tconfigurationService.setUserConfiguration(TerminalChatAgentToolsSettingId.BlockDetectedFileWrites, blockDetectedFileWrites);\n\n\t\t\tconst workspace = new Workspace('test', [toWorkspaceFolder(cwd)]);\n\t\t\tworkspaceContextService.setWorkspace(workspace);\n\n\t\t\tconst options: ICommandLineAnalyzerOptions = {\n\t\t\t\tcommandLine,\n\t\t\t\tcwd,\n\t\t\t\tshell: 'bash',\n\t\t\t\tos: OperatingSystem.Linux,\n\t\t\t\ttreeSitterLanguage: TreeSitterCommandParserLanguage.Bash,\n\t\t\t\tterminalToolSessionId: 'test',\n\t\t\t\tchatSessionId: 'test',\n\t\t\t};\n\n\t\t\tconst result = await analyzer.analyze(options);\n\t\t\tconst disclaimers = result.disclaimers || [];\n\t\t\tstrictEqual(disclaimers.length > 0, true, 'Expected at least one disclaimer');\n\t\t\tconst combinedDisclaimers = disclaimers.join(' ');\n\t\t\tstrictEqual(combinedDisclaimers.includes(expectedContains), true, `Expected disclaimer to contain \"${expectedContains}\" but got: ${combinedDisclaimers}`);\n\t\t}\n\n\t\ttest('blocked disclaimer - absolute path outside workspace', () => checkDisclaimer('echo hello > /tmp/file.txt', 'outsideWorkspace', 'cannot be auto approved'));\n\t\ttest('allowed disclaimer - relative path inside workspace', () => checkDisclaimer('echo hello > file.txt', 'outsideWorkspace', 'File write operations detected'));\n\t\ttest('blocked disclaimer - all setting blocks everything', () => checkDisclaimer('echo hello > file.txt', 'all', 'cannot be auto approved'));\n\t});\n\n\tsuite('multiple workspace folders', () => {\n\t\tconst workspace1 = URI.file('/workspace/project1');\n\t\tconst workspace2 = URI.file('/workspace/project2');\n\n\t\tasync function t(cwd: URI, commandLine: string, expectedAutoApprove: boolean, expectedDisclaimers: number = 0) {\n\t\t\tconfigurationService.setUserConfiguration(TerminalChatAgentToolsSettingId.BlockDetectedFileWrites, 'outsideWorkspace');\n\n\t\t\tconst workspace = new Workspace('test', [workspace1, workspace2].map(uri => toWorkspaceFolder(uri)));\n\t\t\tworkspaceContextService.setWorkspace(workspace);\n\n\t\t\tconst options: ICommandLineAnalyzerOptions = {\n\t\t\t\tcommandLine,\n\t\t\t\tcwd,\n\t\t\t\tshell: 'bash',\n\t\t\t\tos: OperatingSystem.Linux,\n\t\t\t\ttreeSitterLanguage: TreeSitterCommandParserLanguage.Bash,\n\t\t\t\tterminalToolSessionId: 'test',\n\t\t\t\tchatSessionId: 'test',\n\t\t\t};\n\n\t\t\tconst result = await analyzer.analyze(options);\n\t\t\tstrictEqual(result.isAutoApproveAllowed, expectedAutoApprove, `Expected auto approve to be ${expectedAutoApprove} for: ${commandLine}`);\n\t\t\tstrictEqual((result.disclaimers || []).length, expectedDisclaimers, `Expected ${expectedDisclaimers} disclaimers for: ${commandLine}`);\n\t\t}\n\n\t\ttest('relative path in same workspace - allow', () => t(workspace1, 'echo hello > file.txt', true, 1));\n\t\ttest('absolute path to other workspace - allow', () => t(workspace1, 'echo hello > /workspace/project2/file.txt', true, 1));\n\t\ttest('absolute path outside all workspaces - block', () => t(workspace1, 'echo hello > /tmp/file.txt', false, 1));\n\t\ttest('relative path to parent of workspace - block', () => t(workspace1, 'echo hello > ../file.txt', false, 1));\n\t});\n\n\tsuite('uri schemes', () => {\n\t\tasync function t(cwdScheme: string, filePath: string, expectedAutoApprove: boolean) {\n\t\t\tconfigurationService.setUserConfiguration(TerminalChatAgentToolsSettingId.BlockDetectedFileWrites, 'outsideWorkspace');\n\n\t\t\tconst cwd = URI.from({ scheme: cwdScheme, path: '/workspace/project' });\n\t\t\tconst workspace = new Workspace('test', [toWorkspaceFolder(cwd)]);\n\t\t\tworkspaceContextService.setWorkspace(workspace);\n\n\t\t\tconst options: ICommandLineAnalyzerOptions = {\n\t\t\t\tcommandLine: `echo hello > ${filePath}`,\n\t\t\t\tcwd,\n\t\t\t\tshell: 'bash',\n\t\t\t\tos: OperatingSystem.Linux,\n\t\t\t\ttreeSitterLanguage: TreeSitterCommandParserLanguage.Bash,\n\t\t\t\tterminalToolSessionId: 'test',\n\t\t\t\tchatSessionId: 'test',\n\t\t\t};\n\n\t\t\tconst result = await analyzer.analyze(options);\n\t\t\tstrictEqual(result.isAutoApproveAllowed, expectedAutoApprove);\n\t\t}\n\n\t\ttest('file scheme - relative path inside workspace', () => t('file', 'file.txt', true));\n\t\ttest('vscode-remote scheme - relative path inside workspace', () => t('vscode-remote', 'file.txt', true));\n\t\ttest('vscode-remote scheme - absolute path outside workspace', () => t('vscode-remote', '/tmp/file.txt', false));\n\t});\n});\n"]}