{"version":3,"sources":["vs/workbench/contrib/terminalContrib/chatAgentTools/browser/tools/task/getTaskOutputTool.ts"],"names":[],"mappings":"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","file":"getTaskOutputTool.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport type { CancellationToken } from '../../../../../../../base/common/cancellation.js';\nimport { MarkdownString } from '../../../../../../../base/common/htmlContent.js';\nimport { Disposable, DisposableStore } from '../../../../../../../base/common/lifecycle.js';\nimport { localize } from '../../../../../../../nls.js';\nimport { IConfigurationService } from '../../../../../../../platform/configuration/common/configuration.js';\nimport { IInstantiationService } from '../../../../../../../platform/instantiation/common/instantiation.js';\nimport { ITelemetryService } from '../../../../../../../platform/telemetry/common/telemetry.js';\nimport { ToolDataSource, type CountTokensCallback, type IPreparedToolInvocation, type IToolData, type IToolImpl, type IToolInvocation, type IToolInvocationPreparationContext, type IToolResult, type ToolProgress } from '../../../../../chat/common/languageModelToolsService.js';\nimport { ITaskService, Task, TasksAvailableContext } from '../../../../../tasks/common/taskService.js';\nimport { ITerminalService } from '../../../../../terminal/browser/terminal.js';\nimport { collectTerminalResults, getTaskDefinition, getTaskForTool, resolveDependencyTasks, tasksMatch } from '../../taskHelpers.js';\nimport { toolResultDetailsFromResponse, toolResultMessageFromResponse } from './taskHelpers.js';\nimport { TaskToolEvent, TaskToolClassification } from './taskToolsTelemetry.js';\n\nexport const GetTaskOutputToolData: IToolData = {\n\tid: 'get_task_output',\n\ttoolReferenceName: 'getTaskOutput',\n\tlegacyToolReferenceFullNames: ['runTasks/getTaskOutput'],\n\tdisplayName: localize('getTaskOutputTool.displayName', 'Get Task Output'),\n\tmodelDescription: 'Get the output of a task',\n\tsource: ToolDataSource.Internal,\n\twhen: TasksAvailableContext,\n\tinputSchema: {\n\t\ttype: 'object',\n\t\tproperties: {\n\t\t\tid: {\n\t\t\t\ttype: 'string',\n\t\t\t\tdescription: 'The task ID for which to get the output.'\n\t\t\t},\n\t\t\tworkspaceFolder: {\n\t\t\t\ttype: 'string',\n\t\t\t\tdescription: 'The workspace folder path containing the task'\n\t\t\t},\n\t\t},\n\t\trequired: [\n\t\t\t'id',\n\t\t\t'workspaceFolder'\n\t\t]\n\t}\n};\n\nexport interface IGetTaskOutputInputParams {\n\tid: string;\n\tworkspaceFolder: string;\n}\n\nexport class GetTaskOutputTool extends Disposable implements IToolImpl {\n\tconstructor(\n\t\t@ITaskService private readonly _tasksService: ITaskService,\n\t\t@ITerminalService private readonly _terminalService: ITerminalService,\n\t\t@IConfigurationService private readonly _configurationService: IConfigurationService,\n\t\t@IInstantiationService private readonly _instantiationService: IInstantiationService,\n\t\t@ITelemetryService private readonly _telemetryService: ITelemetryService\n\t) {\n\t\tsuper();\n\t}\n\tasync prepareToolInvocation(context: IToolInvocationPreparationContext, token: CancellationToken): Promise<IPreparedToolInvocation | undefined> {\n\t\tconst args = context.parameters as IGetTaskOutputInputParams;\n\n\t\tconst taskDefinition = getTaskDefinition(args.id);\n\t\tconst task = await getTaskForTool(args.id, taskDefinition, args.workspaceFolder, this._configurationService, this._tasksService, true);\n\t\tif (!task) {\n\t\t\treturn { invocationMessage: new MarkdownString(localize('copilotChat.taskNotFound', 'Task not found: `{0}`', args.id)) };\n\t\t}\n\t\tconst taskLabel = task._label;\n\t\tconst activeTasks = await this._tasksService.getActiveTasks();\n\t\tif (activeTasks.includes(task)) {\n\t\t\treturn { invocationMessage: new MarkdownString(localize('copilotChat.taskAlreadyRunning', 'The task `{0}` is already running.', taskLabel)) };\n\t\t}\n\n\t\treturn {\n\t\t\tinvocationMessage: new MarkdownString(localize('copilotChat.checkingTerminalOutput', 'Checking output for task `{0}`', taskLabel)),\n\t\t\tpastTenseMessage: new MarkdownString(localize('copilotChat.checkedTerminalOutput', 'Checked output for task `{0}`', taskLabel)),\n\t\t};\n\t}\n\n\tasync invoke(invocation: IToolInvocation, _countTokens: CountTokensCallback, _progress: ToolProgress, token: CancellationToken): Promise<IToolResult> {\n\t\tconst args = invocation.parameters as IGetTaskOutputInputParams;\n\t\tconst taskDefinition = getTaskDefinition(args.id);\n\t\tconst task = await getTaskForTool(args.id, taskDefinition, args.workspaceFolder, this._configurationService, this._tasksService, true);\n\t\tif (!task) {\n\t\t\treturn { content: [{ kind: 'text', value: `Task not found: ${args.id}` }], toolResultMessage: new MarkdownString(localize('copilotChat.taskNotFound', 'Task not found: `{0}`', args.id)) };\n\t\t}\n\n\t\tconst dependencyTasks = await resolveDependencyTasks(task, args.workspaceFolder, this._configurationService, this._tasksService);\n\t\tconst resources = this._tasksService.getTerminalsForTasks(dependencyTasks ?? task);\n\t\tconst taskLabel = task._label;\n\t\tconst terminals = resources?.map(resource => this._terminalService.instances.find(t => t.resource.path === resource?.path && t.resource.scheme === resource.scheme)).filter(t => !!t);\n\t\tif (!terminals || terminals.length === 0) {\n\t\t\treturn { content: [{ kind: 'text', value: `Terminal not found for task ${taskLabel}` }], toolResultMessage: new MarkdownString(localize('copilotChat.terminalNotFound', 'Terminal not found for task `{0}`', taskLabel)) };\n\t\t}\n\t\tconst store = new DisposableStore();\n\t\tconst terminalResults = await collectTerminalResults(\n\t\t\tterminals,\n\t\t\ttask,\n\t\t\tthis._instantiationService,\n\t\t\tinvocation.context!,\n\t\t\t_progress,\n\t\t\ttoken,\n\t\t\tstore,\n\t\t\t(terminalTask) => this._isTaskActive(terminalTask),\n\t\t\tdependencyTasks,\n\t\t\tthis._tasksService\n\t\t);\n\t\tstore.dispose();\n\t\tfor (const r of terminalResults) {\n\t\t\tthis._telemetryService.publicLog2?.<TaskToolEvent, TaskToolClassification>('copilotChat.getTaskOutputTool.get', {\n\t\t\t\ttaskId: args.id,\n\t\t\t\tbufferLength: r.output.length ?? 0,\n\t\t\t\tpollDurationMs: r.pollDurationMs ?? 0,\n\t\t\t\tinputToolManualAcceptCount: r.inputToolManualAcceptCount ?? 0,\n\t\t\t\tinputToolManualRejectCount: r.inputToolManualRejectCount ?? 0,\n\t\t\t\tinputToolManualChars: r.inputToolManualChars ?? 0,\n\t\t\t\tinputToolManualShownCount: r.inputToolManualShownCount ?? 0,\n\t\t\t\tinputToolFreeFormInputCount: r.inputToolFreeFormInputCount ?? 0,\n\t\t\t\tinputToolFreeFormInputShownCount: r.inputToolFreeFormInputShownCount ?? 0\n\t\t\t});\n\t\t}\n\t\tconst details = terminalResults.map(r => `Terminal: ${r.name}\\nOutput:\\n${r.output}`);\n\t\tconst uniqueDetails = Array.from(new Set(details)).join('\\n\\n');\n\t\tconst toolResultDetails = toolResultDetailsFromResponse(terminalResults);\n\t\tconst toolResultMessage = toolResultMessageFromResponse(undefined, taskLabel, toolResultDetails, terminalResults, true);\n\n\t\treturn {\n\t\t\tcontent: [{ kind: 'text', value: uniqueDetails }],\n\t\t\ttoolResultMessage,\n\t\t\ttoolResultDetails\n\t\t};\n\t}\n\tprivate async _isTaskActive(task: Task): Promise<boolean> {\n\t\tconst busyTasks = await this._tasksService.getBusyTasks();\n\t\treturn busyTasks?.some(t => tasksMatch(t, task)) ?? false;\n\t}\n}\n"]}