{"version":3,"sources":["vs/workbench/contrib/terminalContrib/chatAgentTools/browser/tools/task/createAndRunTaskTool.ts"],"names":[],"mappings":"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","file":"createAndRunTaskTool.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { timeout } from '../../../../../../../base/common/async.js';\nimport { CancellationToken } from '../../../../../../../base/common/cancellation.js';\nimport { localize } from '../../../../../../../nls.js';\nimport { ITelemetryService } from '../../../../../../../platform/telemetry/common/telemetry.js';\nimport { CountTokensCallback, IPreparedToolInvocation, IToolData, IToolImpl, IToolInvocation, IToolInvocationPreparationContext, IToolResult, ToolDataSource, ToolProgress } from '../../../../../chat/common/languageModelToolsService.js';\nimport { ITaskService, ITaskSummary, Task } from '../../../../../tasks/common/taskService.js';\nimport { TaskRunSource } from '../../../../../tasks/common/tasks.js';\nimport { ITerminalInstance, ITerminalService } from '../../../../../terminal/browser/terminal.js';\nimport { collectTerminalResults, IConfiguredTask, resolveDependencyTasks, tasksMatch } from '../../taskHelpers.js';\nimport { MarkdownString } from '../../../../../../../base/common/htmlContent.js';\nimport { URI } from '../../../../../../../base/common/uri.js';\nimport { IFileService } from '../../../../../../../platform/files/common/files.js';\nimport { VSBuffer } from '../../../../../../../base/common/buffer.js';\nimport { IConfigurationService } from '../../../../../../../platform/configuration/common/configuration.js';\nimport { toolResultDetailsFromResponse, toolResultMessageFromResponse } from './taskHelpers.js';\nimport { IInstantiationService } from '../../../../../../../platform/instantiation/common/instantiation.js';\nimport { DisposableStore } from '../../../../../../../base/common/lifecycle.js';\nimport { TaskToolEvent, TaskToolClassification } from './taskToolsTelemetry.js';\n\ninterface ICreateAndRunTaskToolInput {\n\tworkspaceFolder: string;\n\ttask: {\n\t\tlabel: string;\n\t\ttype: string;\n\t\tcommand: string;\n\t\targs?: string[];\n\t\tisBackground?: boolean;\n\t\tproblemMatcher?: string[];\n\t\tgroup?: string;\n\t};\n}\n\nexport class CreateAndRunTaskTool implements IToolImpl {\n\n\tconstructor(\n\t\t@ITaskService private readonly _tasksService: ITaskService,\n\t\t@ITelemetryService private readonly _telemetryService: ITelemetryService,\n\t\t@ITerminalService private readonly _terminalService: ITerminalService,\n\t\t@IFileService private readonly _fileService: IFileService,\n\t\t@IConfigurationService private readonly _configurationService: IConfigurationService,\n\t\t@IInstantiationService private readonly _instantiationService: IInstantiationService\n\t) { }\n\n\tasync invoke(invocation: IToolInvocation, _countTokens: CountTokensCallback, _progress: ToolProgress, token: CancellationToken): Promise<IToolResult> {\n\t\tconst args = invocation.parameters as ICreateAndRunTaskToolInput;\n\n\t\tif (!invocation.context) {\n\t\t\treturn { content: [{ kind: 'text', value: `No invocation context` }], toolResultMessage: `No invocation context` };\n\t\t}\n\n\t\tconst tasksJsonUri = URI.file(args.workspaceFolder).with({ path: `${args.workspaceFolder}/.vscode/tasks.json` });\n\t\tconst exists = await this._fileService.exists(tasksJsonUri);\n\n\t\tconst newTask: IConfiguredTask = {\n\t\t\tlabel: args.task.label,\n\t\t\ttype: args.task.type,\n\t\t\tcommand: args.task.command,\n\t\t\targs: args.task.args,\n\t\t\tisBackground: args.task.isBackground,\n\t\t\tproblemMatcher: args.task.problemMatcher,\n\t\t\tgroup: args.task.group\n\t\t};\n\n\t\tconst tasksJsonContent = JSON.stringify({\n\t\t\tversion: '2.0.0',\n\t\t\ttasks: [newTask]\n\t\t}, null, '\\t');\n\t\tif (!exists) {\n\t\t\tawait this._fileService.createFile(tasksJsonUri, VSBuffer.fromString(tasksJsonContent), { overwrite: true });\n\t\t\t_progress.report({ message: 'Created tasks.json file' });\n\t\t} else {\n\t\t\t// add to the existing tasks.json file\n\t\t\tconst content = await this._fileService.readFile(tasksJsonUri);\n\t\t\tconst tasksJson = JSON.parse(content.value.toString());\n\t\t\ttasksJson.tasks.push(newTask);\n\t\t\tawait this._fileService.writeFile(tasksJsonUri, VSBuffer.fromString(JSON.stringify(tasksJson, null, '\\t')));\n\t\t\t_progress.report({ message: 'Updated tasks.json file' });\n\t\t}\n\t\t_progress.report({ message: new MarkdownString(localize('copilotChat.fetchingTask', 'Resolving the task')) });\n\n\t\tlet task: Task | undefined;\n\t\tconst start = Date.now();\n\t\twhile (Date.now() - start < 5000 && !token.isCancellationRequested) {\n\t\t\ttask = (await this._tasksService.tasks())?.find(t => t._label === args.task.label);\n\t\t\tif (task) {\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tawait timeout(100);\n\t\t}\n\t\tif (!task) {\n\t\t\treturn { content: [{ kind: 'text', value: `Task not found: ${args.task.label}` }], toolResultMessage: new MarkdownString(localize('copilotChat.taskNotFound', 'Task not found: `{0}`', args.task.label)) };\n\t\t}\n\n\t\t_progress.report({ message: new MarkdownString(localize('copilotChat.runningTask', 'Running task `{0}`', args.task.label)) });\n\t\tconst raceResult = await Promise.race([this._tasksService.run(task, undefined, TaskRunSource.ChatAgent), timeout(3000)]);\n\t\tconst result: ITaskSummary | undefined = raceResult && typeof raceResult === 'object' ? raceResult as ITaskSummary : undefined;\n\n\t\tconst dependencyTasks = await resolveDependencyTasks(task, args.workspaceFolder, this._configurationService, this._tasksService);\n\t\tconst resources = this._tasksService.getTerminalsForTasks(dependencyTasks ?? task);\n\t\tconst terminals = resources?.map(resource => this._terminalService.instances.find(t => t.resource.path === resource?.path && t.resource.scheme === resource.scheme)).filter(Boolean) as ITerminalInstance[];\n\t\tif (!terminals || terminals.length === 0) {\n\t\t\treturn { content: [{ kind: 'text', value: `Task started but no terminal was found for: ${args.task.label}` }], toolResultMessage: new MarkdownString(localize('copilotChat.noTerminal', 'Task started but no terminal was found for: `{0}`', args.task.label)) };\n\t\t}\n\t\tconst store = new DisposableStore();\n\t\tconst terminalResults = await collectTerminalResults(\n\t\t\tterminals,\n\t\t\ttask,\n\t\t\tthis._instantiationService,\n\t\t\tinvocation.context!,\n\t\t\t_progress,\n\t\t\ttoken,\n\t\t\tstore,\n\t\t\t(terminalTask) => this._isTaskActive(terminalTask),\n\t\t\tdependencyTasks,\n\t\t\tthis._tasksService\n\t\t);\n\t\tstore.dispose();\n\t\tfor (const r of terminalResults) {\n\t\t\tthis._telemetryService.publicLog2?.<TaskToolEvent, TaskToolClassification>('copilotChat.runTaskTool.createAndRunTask', {\n\t\t\t\ttaskId: args.task.label,\n\t\t\t\tbufferLength: r.output.length ?? 0,\n\t\t\t\tpollDurationMs: r.pollDurationMs ?? 0,\n\t\t\t\tinputToolManualAcceptCount: r.inputToolManualAcceptCount ?? 0,\n\t\t\t\tinputToolManualRejectCount: r.inputToolManualRejectCount ?? 0,\n\t\t\t\tinputToolManualChars: r.inputToolManualChars ?? 0,\n\t\t\t\tinputToolManualShownCount: r.inputToolManualShownCount ?? 0,\n\t\t\t\tinputToolFreeFormInputCount: r.inputToolFreeFormInputCount ?? 0,\n\t\t\t\tinputToolFreeFormInputShownCount: r.inputToolFreeFormInputShownCount ?? 0\n\t\t\t});\n\t\t}\n\n\t\tconst details = terminalResults.map(r => `Terminal: ${r.name}\\nOutput:\\n${r.output}`);\n\t\tconst uniqueDetails = Array.from(new Set(details)).join('\\n\\n');\n\t\tconst toolResultDetails = toolResultDetailsFromResponse(terminalResults);\n\t\tconst toolResultMessage = toolResultMessageFromResponse(result, args.task.label, toolResultDetails, terminalResults);\n\t\treturn {\n\t\t\tcontent: [{ kind: 'text', value: uniqueDetails }],\n\t\t\ttoolResultMessage,\n\t\t\ttoolResultDetails\n\t\t};\n\t}\n\n\tprivate async _isTaskActive(task: Task): Promise<boolean> {\n\t\tconst busyTasks = await this._tasksService.getBusyTasks();\n\t\treturn busyTasks?.some(t => tasksMatch(t, task)) ?? false;\n\t}\n\n\tasync prepareToolInvocation(context: IToolInvocationPreparationContext, token: CancellationToken): Promise<IPreparedToolInvocation | undefined> {\n\t\tconst args = context.parameters as ICreateAndRunTaskToolInput;\n\t\tconst task = args.task;\n\n\t\tconst allTasks = await this._tasksService.tasks();\n\t\tif (allTasks?.find(t => t._label === task.label)) {\n\t\t\treturn {\n\t\t\t\tinvocationMessage: new MarkdownString(localize('taskExists', 'Task `{0}` already exists.', task.label)),\n\t\t\t\tpastTenseMessage: new MarkdownString(localize('taskExistsPast', 'Task `{0}` already exists.', task.label)),\n\t\t\t\tconfirmationMessages: undefined\n\t\t\t};\n\t\t}\n\n\t\tconst activeTasks = await this._tasksService.getActiveTasks();\n\t\tif (activeTasks.find(t => t._label === task.label)) {\n\t\t\treturn {\n\t\t\t\tinvocationMessage: new MarkdownString(localize('alreadyRunning', 'Task \\`{0}\\` is already running.', task.label)),\n\t\t\t\tpastTenseMessage: new MarkdownString(localize('alreadyRunning', 'Task \\`{0}\\` is already running.', task.label)),\n\t\t\t\tconfirmationMessages: undefined\n\t\t\t};\n\t\t}\n\n\t\treturn {\n\t\t\tinvocationMessage: new MarkdownString(localize('createdTask', 'Created task \\`{0}\\`', task.label)),\n\t\t\tpastTenseMessage: new MarkdownString(localize('createdTaskPast', 'Created task \\`{0}\\`', task.label)),\n\t\t\tconfirmationMessages: {\n\t\t\t\ttitle: localize('allowTaskCreationExecution', 'Allow task creation and execution?'),\n\t\t\t\tmessage: new MarkdownString(\n\t\t\t\t\tlocalize(\n\t\t\t\t\t\t'createTask',\n\t\t\t\t\t\t'A task \\`{0}\\` with command \\`{1}\\`{2} will be created.',\n\t\t\t\t\t\ttask.label,\n\t\t\t\t\t\ttask.command,\n\t\t\t\t\t\ttask.args?.length ? ` and args \\`${task.args.join(' ')}\\`` : ''\n\t\t\t\t\t)\n\t\t\t\t)\n\t\t\t}\n\t\t};\n\t}\n}\n\nexport const CreateAndRunTaskToolData: IToolData = {\n\tid: 'create_and_run_task',\n\ttoolReferenceName: 'createAndRunTask',\n\tlegacyToolReferenceFullNames: ['runTasks/createAndRunTask'],\n\tdisplayName: localize('createAndRunTask.displayName', 'Create and run Task'),\n\tmodelDescription: 'Creates and runs a build, run, or custom task for the workspace by generating or adding to a tasks.json file based on the project structure (such as package.json or README.md). If the user asks to build, run, launch and they have no tasks.json file, use this tool. If they ask to create or add a task, use this tool.',\n\tuserDescription: localize('createAndRunTask.userDescription', \"Create and run a task in the workspace\"),\n\tsource: ToolDataSource.Internal,\n\tinputSchema: {\n\t\t'type': 'object',\n\t\t'properties': {\n\t\t\t'workspaceFolder': {\n\t\t\t\t'type': 'string',\n\t\t\t\t'description': 'The absolute path of the workspace folder where the tasks.json file will be created.'\n\t\t\t},\n\t\t\t'task': {\n\t\t\t\t'type': 'object',\n\t\t\t\t'description': 'The task to add to the new tasks.json file.',\n\t\t\t\t'properties': {\n\t\t\t\t\t'label': {\n\t\t\t\t\t\t'type': 'string',\n\t\t\t\t\t\t'description': 'The label of the task.'\n\t\t\t\t\t},\n\t\t\t\t\t'type': {\n\t\t\t\t\t\t'type': 'string',\n\t\t\t\t\t\t'description': `The type of the task. The only supported value is 'shell'.`,\n\t\t\t\t\t\t'enum': [\n\t\t\t\t\t\t\t'shell'\n\t\t\t\t\t\t]\n\t\t\t\t\t},\n\t\t\t\t\t'command': {\n\t\t\t\t\t\t'type': 'string',\n\t\t\t\t\t\t'description': 'The shell command to run for the task. Use this to specify commands for building or running the application.'\n\t\t\t\t\t},\n\t\t\t\t\t'args': {\n\t\t\t\t\t\t'type': 'array',\n\t\t\t\t\t\t'description': 'The arguments to pass to the command.',\n\t\t\t\t\t\t'items': {\n\t\t\t\t\t\t\t'type': 'string'\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\t'isBackground': {\n\t\t\t\t\t\t'type': 'boolean',\n\t\t\t\t\t\t'description': 'Whether the task runs in the background without blocking the UI or other tasks. Set to true for long-running processes like watch tasks or servers that should continue executing without requiring user attention. When false, the task will block the terminal until completion.'\n\t\t\t\t\t},\n\t\t\t\t\t'problemMatcher': {\n\t\t\t\t\t\t'type': 'array',\n\t\t\t\t\t\t'description': `The problem matcher to use to parse task output for errors and warnings. Can be a predefined matcher like '$tsc' (TypeScript), '$eslint - stylish', '$gcc', etc., or a custom pattern defined in tasks.json. This helps VS Code display errors in the Problems panel and enables quick navigation to error locations.`,\n\t\t\t\t\t\t'items': {\n\t\t\t\t\t\t\t'type': 'string'\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\t'group': {\n\t\t\t\t\t\t'type': 'string',\n\t\t\t\t\t\t'description': 'The group to which the task belongs.'\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t'required': [\n\t\t\t\t\t'label',\n\t\t\t\t\t'type',\n\t\t\t\t\t'command'\n\t\t\t\t]\n\t\t\t}\n\t\t},\n\t\t'required': [\n\t\t\t'task',\n\t\t\t'workspaceFolder'\n\t\t]\n\t},\n};\n"]}