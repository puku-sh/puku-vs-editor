{"version":3,"sources":["vs/workbench/contrib/terminalContrib/chatAgentTools/browser/tools/runInTerminalTool.ts"],"names":[],"mappings":"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","file":"runInTerminalTool.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport type { IMarker as IXtermMarker } from '@xterm/xterm';\nimport { timeout } from '../../../../../../base/common/async.js';\nimport { CancellationToken } from '../../../../../../base/common/cancellation.js';\nimport { Codicon } from '../../../../../../base/common/codicons.js';\nimport { CancellationError } from '../../../../../../base/common/errors.js';\nimport { Event } from '../../../../../../base/common/event.js';\nimport { MarkdownString, type IMarkdownString } from '../../../../../../base/common/htmlContent.js';\nimport { Disposable, DisposableStore } from '../../../../../../base/common/lifecycle.js';\nimport { basename } from '../../../../../../base/common/path.js';\nimport { OperatingSystem, OS } from '../../../../../../base/common/platform.js';\nimport { count } from '../../../../../../base/common/strings.js';\nimport { generateUuid } from '../../../../../../base/common/uuid.js';\nimport { localize } from '../../../../../../nls.js';\nimport { IConfigurationService } from '../../../../../../platform/configuration/common/configuration.js';\nimport { IInstantiationService, type ServicesAccessor } from '../../../../../../platform/instantiation/common/instantiation.js';\nimport { IStorageService, StorageScope, StorageTarget } from '../../../../../../platform/storage/common/storage.js';\nimport { TerminalCapability } from '../../../../../../platform/terminal/common/capabilities/capabilities.js';\nimport { ITerminalLogService, ITerminalProfile } from '../../../../../../platform/terminal/common/terminal.js';\nimport { IRemoteAgentService } from '../../../../../services/remote/common/remoteAgentService.js';\nimport { TerminalToolConfirmationStorageKeys } from '../../../../chat/browser/chatContentParts/toolInvocationParts/chatTerminalToolConfirmationSubPart.js';\nimport { IChatService, type IChatTerminalToolInvocationData } from '../../../../chat/common/chatService.js';\nimport { CountTokensCallback, ILanguageModelToolsService, IPreparedToolInvocation, IToolData, IToolImpl, IToolInvocation, IToolInvocationPreparationContext, IToolResult, ToolDataSource, ToolInvocationPresentation, ToolProgress } from '../../../../chat/common/languageModelToolsService.js';\nimport { ITerminalChatService, ITerminalService, type ITerminalInstance } from '../../../../terminal/browser/terminal.js';\nimport type { XtermTerminal } from '../../../../terminal/browser/xterm/xtermTerminal.js';\nimport { ITerminalProfileResolverService } from '../../../../terminal/common/terminal.js';\nimport { TerminalChatAgentToolsSettingId } from '../../common/terminalChatAgentToolsConfiguration.js';\nimport { getRecommendedToolsOverRunInTerminal } from '../alternativeRecommendation.js';\nimport { BasicExecuteStrategy } from '../executeStrategy/basicExecuteStrategy.js';\nimport type { ITerminalExecuteStrategy } from '../executeStrategy/executeStrategy.js';\nimport { NoneExecuteStrategy } from '../executeStrategy/noneExecuteStrategy.js';\nimport { RichExecuteStrategy } from '../executeStrategy/richExecuteStrategy.js';\nimport { getOutput } from '../outputHelpers.js';\nimport { isFish, isPowerShell, isWindowsPowerShell, isZsh } from '../runInTerminalHelpers.js';\nimport { RunInTerminalToolTelemetry } from '../runInTerminalToolTelemetry.js';\nimport { ShellIntegrationQuality, ToolTerminalCreator, type IToolTerminal } from '../toolTerminalCreator.js';\nimport { TreeSitterCommandParser, TreeSitterCommandParserLanguage } from '../treeSitterCommandParser.js';\nimport { type ICommandLineAnalyzer, type ICommandLineAnalyzerOptions } from './commandLineAnalyzer/commandLineAnalyzer.js';\nimport { CommandLineAutoApproveAnalyzer } from './commandLineAnalyzer/commandLineAutoApproveAnalyzer.js';\nimport { CommandLineFileWriteAnalyzer } from './commandLineAnalyzer/commandLineFileWriteAnalyzer.js';\nimport { OutputMonitor } from './monitoring/outputMonitor.js';\nimport { IPollingResult, OutputMonitorState } from './monitoring/types.js';\nimport { LocalChatSessionUri } from '../../../../chat/common/chatUri.js';\nimport type { ICommandLineRewriter } from './commandLineRewriter/commandLineRewriter.js';\nimport { CommandLineCdPrefixRewriter } from './commandLineRewriter/commandLineCdPrefixRewriter.js';\nimport { CommandLinePwshChainOperatorRewriter } from './commandLineRewriter/commandLinePwshChainOperatorRewriter.js';\nimport { IWorkspaceContextService } from '../../../../../../platform/workspace/common/workspace.js';\nimport { IHistoryService } from '../../../../../services/history/common/history.js';\nimport { TerminalCommandArtifactCollector } from './terminalCommandArtifactCollector.js';\nimport { isNumber, isString } from '../../../../../../base/common/types.js';\nimport { ChatConfiguration } from '../../../../chat/common/constants.js';\n\n// #region Tool data\n\nconst TOOL_REFERENCE_NAME = 'runInTerminal';\nconst LEGACY_TOOL_REFERENCE_FULL_NAMES = ['runCommands/runInTerminal'];\n\nfunction createPowerShellModelDescription(shell: string): string {\n\tconst isWinPwsh = isWindowsPowerShell(shell);\n\treturn [\n\t\t`This tool allows you to execute ${isWinPwsh ? 'Windows PowerShell 5.1' : 'PowerShell'} commands in a persistent terminal session, preserving environment variables, working directory, and other context across multiple commands.`,\n\t\t'',\n\t\t'Command Execution:',\n\t\t// IMPORTANT: PowerShell 5 does not support `&&` so always re-write them to `;`. Note that\n\t\t// the behavior of `&&` differs a little from `;` but in general it's fine\n\t\tisWinPwsh ? '- Use semicolons ; to chain commands on one line, NEVER use && even when asked explicitly' : '- Prefer ; when chaining commands on one line',\n\t\t'- Prefer pipelines | for object-based data flow',\n\t\t'- Never create a sub-shell (eg. powershell -c \"command\") unless explicitly asked',\n\t\t'',\n\t\t'Directory Management:',\n\t\t'- Must use absolute paths to avoid navigation issues',\n\t\t'- Use $PWD or Get-Location for current directory',\n\t\t'- Use Push-Location/Pop-Location for directory stack',\n\t\t'',\n\t\t'Program Execution:',\n\t\t'- Supports .NET, Python, Node.js, and other executables',\n\t\t'- Install modules via Install-Module, Install-Package',\n\t\t'- Use Get-Command to verify cmdlet/function availability',\n\t\t'',\n\t\t'Background Processes:',\n\t\t'- For long-running tasks (e.g., servers), set isBackground=true',\n\t\t'- Returns a terminal ID for checking status and runtime later',\n\t\t'- Use Start-Job for background PowerShell jobs',\n\t\t'',\n\t\t'Output Management:',\n\t\t'- Output is automatically truncated if longer than 60KB to prevent context overflow',\n\t\t'- Use Select-Object, Where-Object, Format-Table to filter output',\n\t\t'- Use -First/-Last parameters to limit results',\n\t\t'- For pager commands, add | Out-String or | Format-List',\n\t\t'',\n\t\t'Best Practices:',\n\t\t'- Use proper cmdlet names instead of aliases in scripts',\n\t\t'- Quote paths with spaces: \"C:\\\\Path With Spaces\"',\n\t\t'- Prefer PowerShell cmdlets over external commands when available',\n\t\t'- Prefer idiomatic PowerShell like Get-ChildItem instead of dir or ls for file listings',\n\t\t'- Use Test-Path to check file/directory existence',\n\t\t'- Be specific with Select-Object properties to avoid excessive output'\n\t].join('\\n');\n}\n\nconst genericDescription = `\nCommand Execution:\n- Use && to chain simple commands on one line\n- Prefer pipelines | over temporary files for data flow\n- Never create a sub-shell (eg. bash -c \"command\") unless explicitly asked\n\nDirectory Management:\n- Must use absolute paths to avoid navigation issues\n- Use $PWD for current directory references\n- Consider using pushd/popd for directory stack management\n- Supports directory shortcuts like ~ and -\n\nProgram Execution:\n- Supports Python, Node.js, and other executables\n- Install packages via package managers (brew, apt, etc.)\n- Use which or command -v to verify command availability\n\nBackground Processes:\n- For long-running tasks (e.g., servers), set isBackground=true\n- Returns a terminal ID for checking status and runtime later\n\nOutput Management:\n- Output is automatically truncated if longer than 60KB to prevent context overflow\n- Use head, tail, grep, awk to filter and limit output size\n- For pager commands, disable paging: git --no-pager or add | cat\n- Use wc -l to count lines before displaying large outputs\n\nBest Practices:\n- Quote variables: \"$var\" instead of $var to handle spaces\n- Use find with -exec or xargs for file operations\n- Be specific with commands to avoid excessive output`;\n\nfunction createBashModelDescription(): string {\n\treturn [\n\t\t'This tool allows you to execute shell commands in a persistent bash terminal session, preserving environment variables, working directory, and other context across multiple commands.',\n\t\tgenericDescription,\n\t\t'- Use [[ ]] for conditional tests instead of [ ]',\n\t\t'- Prefer $() over backticks for command substitution',\n\t\t'- Use set -e at start of complex commands to exit on errors'\n\t].join('\\n');\n}\n\nfunction createZshModelDescription(): string {\n\treturn [\n\t\t'This tool allows you to execute shell commands in a persistent zsh terminal session, preserving environment variables, working directory, and other context across multiple commands.',\n\t\tgenericDescription,\n\t\t'- Use type to check command type (builtin, function, alias)',\n\t\t'- Use jobs, fg, bg for job control',\n\t\t'- Use [[ ]] for conditional tests instead of [ ]',\n\t\t'- Prefer $() over backticks for command substitution',\n\t\t'- Use setopt errexit for strict error handling',\n\t\t'- Take advantage of zsh globbing features (**, extended globs)'\n\t].join('\\n');\n}\n\nfunction createFishModelDescription(): string {\n\treturn [\n\t\t'This tool allows you to execute shell commands in a persistent fish terminal session, preserving environment variables, working directory, and other context across multiple commands.',\n\t\tgenericDescription,\n\t\t'- Use type to check command type (builtin, function, alias)',\n\t\t'- Use jobs, fg, bg for job control',\n\t\t'- Use test expressions for conditionals (no [[ ]] syntax)',\n\t\t'- Prefer command substitution with () syntax',\n\t\t'- Variables are arrays by default, use $var[1] for first element',\n\t\t'- Use set -e for strict error handling',\n\t\t'- Take advantage of fish\\'s autosuggestions and completions'\n\t].join('\\n');\n}\n\nexport async function createRunInTerminalToolData(\n\taccessor: ServicesAccessor\n): Promise<IToolData> {\n\tconst instantiationService = accessor.get(IInstantiationService);\n\n\tconst profileFetcher = instantiationService.createInstance(TerminalProfileFetcher);\n\tconst shell = await profileFetcher.getCopilotShell();\n\tconst os = await profileFetcher.osBackend;\n\n\tlet modelDescription: string;\n\tif (shell && os && isPowerShell(shell, os)) {\n\t\tmodelDescription = createPowerShellModelDescription(shell);\n\t} else if (shell && os && isZsh(shell, os)) {\n\t\tmodelDescription = createZshModelDescription();\n\t} else if (shell && os && isFish(shell, os)) {\n\t\tmodelDescription = createFishModelDescription();\n\t} else {\n\t\tmodelDescription = createBashModelDescription();\n\t}\n\n\treturn {\n\t\tid: 'run_in_terminal',\n\t\ttoolReferenceName: TOOL_REFERENCE_NAME,\n\t\tlegacyToolReferenceFullNames: LEGACY_TOOL_REFERENCE_FULL_NAMES,\n\t\tdisplayName: localize('runInTerminalTool.displayName', 'Run in Terminal'),\n\t\tmodelDescription,\n\t\tuserDescription: localize('runInTerminalTool.userDescription', 'Run commands in the terminal'),\n\t\tsource: ToolDataSource.Internal,\n\t\ticon: Codicon.terminal,\n\t\tinputSchema: {\n\t\t\ttype: 'object',\n\t\t\tproperties: {\n\t\t\t\tcommand: {\n\t\t\t\t\ttype: 'string',\n\t\t\t\t\tdescription: 'The command to run in the terminal.'\n\t\t\t\t},\n\t\t\t\texplanation: {\n\t\t\t\t\ttype: 'string',\n\t\t\t\t\tdescription: 'A one-sentence description of what the command does. This will be shown to the user before the command is run.'\n\t\t\t\t},\n\t\t\t\tisBackground: {\n\t\t\t\t\ttype: 'boolean',\n\t\t\t\t\tdescription: 'Whether the command starts a background process. If true, the command will run in the background and you will not see the output. If false, the tool call will block on the command finishing, and then you will get the output. Examples of background processes: building in watch mode, starting a server. You can check the output of a background process later on by using get_terminal_output.'\n\t\t\t\t},\n\t\t\t},\n\t\t\trequired: [\n\t\t\t\t'command',\n\t\t\t\t'explanation',\n\t\t\t\t'isBackground',\n\t\t\t]\n\t\t}\n\t};\n}\n\n// #endregion\n\n// #region Tool implementation\n\nconst enum TerminalToolStorageKeysInternal {\n\tTerminalSession = 'chat.terminalSessions'\n}\n\ninterface IStoredTerminalAssociation {\n\tsessionId: string;\n\tid: string;\n\tshellIntegrationQuality: ShellIntegrationQuality;\n\tisBackground?: boolean;\n}\n\nexport interface IRunInTerminalInputParams {\n\tcommand: string;\n\texplanation: string;\n\tisBackground: boolean;\n}\n\n/**\n * A set of characters to ignore when reporting telemetry\n */\nconst telemetryIgnoredSequences = [\n\t'\\x1b[I', // Focus in\n\t'\\x1b[O', // Focus out\n];\n\n\nexport class RunInTerminalTool extends Disposable implements IToolImpl {\n\n\tprivate readonly _terminalToolCreator: ToolTerminalCreator;\n\tprivate readonly _treeSitterCommandParser: TreeSitterCommandParser;\n\tprivate readonly _telemetry: RunInTerminalToolTelemetry;\n\tprivate readonly _commandArtifactCollector: TerminalCommandArtifactCollector;\n\tprotected readonly _profileFetcher: TerminalProfileFetcher;\n\n\tprivate readonly _commandLineRewriters: ICommandLineRewriter[];\n\tprivate readonly _commandLineAnalyzers: ICommandLineAnalyzer[];\n\n\tprotected readonly _sessionTerminalAssociations: Map<string, IToolTerminal> = new Map();\n\n\t// Immutable window state\n\tprotected readonly _osBackend: Promise<OperatingSystem>;\n\n\tprivate static readonly _backgroundExecutions = new Map<string, BackgroundTerminalExecution>();\n\tpublic static getBackgroundOutput(id: string): string {\n\t\tconst backgroundExecution = RunInTerminalTool._backgroundExecutions.get(id);\n\t\tif (!backgroundExecution) {\n\t\t\tthrow new Error('Invalid terminal ID');\n\t\t}\n\t\treturn backgroundExecution.getOutput();\n\t}\n\n\tconstructor(\n\t\t@IChatService private readonly _chatService: IChatService,\n\t\t@IConfigurationService private readonly _configurationService: IConfigurationService,\n\t\t@IHistoryService private readonly _historyService: IHistoryService,\n\t\t@IInstantiationService private readonly _instantiationService: IInstantiationService,\n\t\t@ILanguageModelToolsService private readonly _languageModelToolsService: ILanguageModelToolsService,\n\t\t@IRemoteAgentService private readonly _remoteAgentService: IRemoteAgentService,\n\t\t@IStorageService private readonly _storageService: IStorageService,\n\t\t@ITerminalChatService private readonly _terminalChatService: ITerminalChatService,\n\t\t@ITerminalLogService private readonly _logService: ITerminalLogService,\n\t\t@ITerminalService private readonly _terminalService: ITerminalService,\n\t\t@IWorkspaceContextService private readonly _workspaceContextService: IWorkspaceContextService,\n\t) {\n\t\tsuper();\n\n\t\tthis._osBackend = this._remoteAgentService.getEnvironment().then(remoteEnv => remoteEnv?.os ?? OS);\n\n\t\tthis._terminalToolCreator = this._instantiationService.createInstance(ToolTerminalCreator);\n\t\tthis._treeSitterCommandParser = this._register(this._instantiationService.createInstance(TreeSitterCommandParser));\n\t\tthis._telemetry = this._instantiationService.createInstance(RunInTerminalToolTelemetry);\n\t\tthis._commandArtifactCollector = this._instantiationService.createInstance(TerminalCommandArtifactCollector);\n\t\tthis._profileFetcher = this._instantiationService.createInstance(TerminalProfileFetcher);\n\n\t\tthis._commandLineRewriters = [\n\t\t\tthis._register(this._instantiationService.createInstance(CommandLineCdPrefixRewriter)),\n\t\t\tthis._register(this._instantiationService.createInstance(CommandLinePwshChainOperatorRewriter, this._treeSitterCommandParser)),\n\t\t];\n\t\tthis._commandLineAnalyzers = [\n\t\t\tthis._register(this._instantiationService.createInstance(CommandLineFileWriteAnalyzer, this._treeSitterCommandParser, (message, args) => this._logService.info(`RunInTerminalTool#CommandLineFileWriteAnalyzer: ${message}`, args))),\n\t\t\tthis._register(this._instantiationService.createInstance(CommandLineAutoApproveAnalyzer, this._treeSitterCommandParser, this._telemetry, (message, args) => this._logService.info(`RunInTerminalTool#CommandLineAutoApproveAnalyzer: ${message}`, args))),\n\t\t];\n\n\t\t// Clear out warning accepted state if the setting is disabled\n\t\tthis._register(Event.runAndSubscribe(this._configurationService.onDidChangeConfiguration, e => {\n\t\t\tif (!e || e.affectsConfiguration(TerminalChatAgentToolsSettingId.EnableAutoApprove)) {\n\t\t\t\tif (this._configurationService.getValue(TerminalChatAgentToolsSettingId.EnableAutoApprove) !== true) {\n\t\t\t\t\tthis._storageService.remove(TerminalToolConfirmationStorageKeys.TerminalAutoApproveWarningAccepted, StorageScope.APPLICATION);\n\t\t\t\t}\n\t\t\t}\n\t\t}));\n\n\t\t// Restore terminal associations from storage\n\t\tthis._restoreTerminalAssociations();\n\t\tthis._register(this._terminalService.onDidDisposeInstance(e => {\n\t\t\tfor (const [sessionId, toolTerminal] of this._sessionTerminalAssociations.entries()) {\n\t\t\t\tif (e === toolTerminal.instance) {\n\t\t\t\t\tthis._sessionTerminalAssociations.delete(sessionId);\n\t\t\t\t}\n\t\t\t}\n\t\t}));\n\n\t\t// Listen for chat session disposal to clean up associated terminals\n\t\tthis._register(this._chatService.onDidDisposeSession(e => {\n\t\t\tconst localSessionId = LocalChatSessionUri.parseLocalSessionId(e.sessionResource);\n\t\t\tif (localSessionId) {\n\t\t\t\tthis._cleanupSessionTerminals(localSessionId);\n\t\t\t}\n\t\t}));\n\t}\n\n\tasync prepareToolInvocation(context: IToolInvocationPreparationContext, token: CancellationToken): Promise<IPreparedToolInvocation | undefined> {\n\t\tconst args = context.parameters as IRunInTerminalInputParams;\n\n\t\tconst instance = context.chatSessionId ? this._sessionTerminalAssociations.get(context.chatSessionId)?.instance : undefined;\n\t\tconst [os, shell, cwd] = await Promise.all([\n\t\t\tthis._osBackend,\n\t\t\tthis._profileFetcher.getCopilotShell(),\n\t\t\t(async () => {\n\t\t\t\tlet cwd = await instance?.getCwdResource();\n\t\t\t\tif (!cwd) {\n\t\t\t\t\tconst activeWorkspaceRootUri = this._historyService.getLastActiveWorkspaceRoot();\n\t\t\t\t\tconst workspaceFolder = activeWorkspaceRootUri ? this._workspaceContextService.getWorkspaceFolder(activeWorkspaceRootUri) ?? undefined : undefined;\n\t\t\t\t\tcwd = workspaceFolder?.uri;\n\t\t\t\t}\n\t\t\t\treturn cwd;\n\t\t\t})()\n\t\t]);\n\t\tconst language = os === OperatingSystem.Windows ? 'pwsh' : 'sh';\n\n\t\tconst terminalToolSessionId = generateUuid();\n\t\t// Generate a custom command ID to link the command between renderer and pty host\n\t\tconst terminalCommandId = `tool-${generateUuid()}`;\n\n\t\tlet rewrittenCommand: string | undefined = args.command;\n\t\tfor (const rewriter of this._commandLineRewriters) {\n\t\t\tconst rewriteResult = await rewriter.rewrite({\n\t\t\t\tcommandLine: rewrittenCommand,\n\t\t\t\tcwd,\n\t\t\t\tshell,\n\t\t\t\tos\n\t\t\t});\n\t\t\tif (rewriteResult) {\n\t\t\t\trewrittenCommand = rewriteResult.rewritten;\n\t\t\t\tthis._logService.info(`RunInTerminalTool: Command rewritten by ${rewriter.constructor.name}: ${rewriteResult.reasoning}`);\n\t\t\t}\n\t\t}\n\n\t\tconst toolSpecificData: IChatTerminalToolInvocationData = {\n\t\t\tkind: 'terminal',\n\t\t\tterminalToolSessionId,\n\t\t\tterminalCommandId,\n\t\t\tcommandLine: {\n\t\t\t\toriginal: args.command,\n\t\t\t\ttoolEdited: rewrittenCommand === args.command ? undefined : rewrittenCommand\n\t\t\t},\n\t\t\tlanguage,\n\t\t};\n\n\t\t// HACK: Exit early if there's an alternative recommendation, this is a little hacky but\n\t\t// it's the current mechanism for re-routing terminal tool calls to something else.\n\t\tconst alternativeRecommendation = getRecommendedToolsOverRunInTerminal(args.command, this._languageModelToolsService);\n\t\tif (alternativeRecommendation) {\n\t\t\ttoolSpecificData.alternativeRecommendation = alternativeRecommendation;\n\t\t\treturn {\n\t\t\t\tconfirmationMessages: undefined,\n\t\t\t\tpresentation: ToolInvocationPresentation.Hidden,\n\t\t\t\ttoolSpecificData,\n\t\t\t};\n\t\t}\n\n\t\t// Determine auto approval, this happens even when auto approve is off to that reasoning\n\t\t// can be reviewed in the terminal channel. It also allows gauging the effective set of\n\t\t// commands that would be auto approved if it were enabled.\n\t\tconst commandLine = rewrittenCommand ?? args.command;\n\n\t\tconst isEligibleForAutoApproval = () => {\n\t\t\tconst config = this._configurationService.getValue<Record<string, boolean>>(ChatConfiguration.EligibleForAutoApproval);\n\t\t\tif (config && typeof config === 'object') {\n\t\t\t\tif (Object.prototype.hasOwnProperty.call(config, TOOL_REFERENCE_NAME)) {\n\t\t\t\t\treturn config[TOOL_REFERENCE_NAME];\n\t\t\t\t}\n\t\t\t\tfor (const legacyName of LEGACY_TOOL_REFERENCE_FULL_NAMES) {\n\t\t\t\t\tif (Object.prototype.hasOwnProperty.call(config, legacyName)) {\n\t\t\t\t\t\treturn config[legacyName];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\t// Default\n\t\t\treturn true;\n\t\t};\n\t\tconst isAutoApproveEnabled = this._configurationService.getValue(TerminalChatAgentToolsSettingId.EnableAutoApprove) === true;\n\t\tconst isAutoApproveWarningAccepted = this._storageService.getBoolean(TerminalToolConfirmationStorageKeys.TerminalAutoApproveWarningAccepted, StorageScope.APPLICATION, false);\n\t\tconst isAutoApproveAllowed = isEligibleForAutoApproval() && isAutoApproveEnabled && isAutoApproveWarningAccepted;\n\n\t\tconst commandLineAnalyzerOptions: ICommandLineAnalyzerOptions = {\n\t\t\tcommandLine,\n\t\t\tcwd,\n\t\t\tos,\n\t\t\tshell,\n\t\t\ttreeSitterLanguage: isPowerShell(shell, os) ? TreeSitterCommandParserLanguage.PowerShell : TreeSitterCommandParserLanguage.Bash,\n\t\t\tterminalToolSessionId,\n\t\t\tchatSessionId: context.chatSessionId,\n\t\t};\n\t\tconst commandLineAnalyzerResults = await Promise.all(this._commandLineAnalyzers.map(e => e.analyze(commandLineAnalyzerOptions)));\n\n\t\tconst disclaimersRaw = commandLineAnalyzerResults.filter(e => e.disclaimers).flatMap(e => e.disclaimers);\n\t\tlet disclaimer: IMarkdownString | undefined;\n\t\tif (disclaimersRaw.length > 0) {\n\t\t\tdisclaimer = new MarkdownString(`$(${Codicon.info.id}) ` + disclaimersRaw.join(' '), { supportThemeIcons: true });\n\t\t}\n\n\t\tconst analyzersIsAutoApproveAllowed = commandLineAnalyzerResults.every(e => e.isAutoApproveAllowed);\n\t\tconst customActions = isEligibleForAutoApproval() && analyzersIsAutoApproveAllowed ? commandLineAnalyzerResults.map(e => e.customActions ?? []).flat() : undefined;\n\n\t\tlet shellType = basename(shell, '.exe');\n\t\tif (shellType === 'powershell') {\n\t\t\tshellType = 'pwsh';\n\t\t}\n\n\t\tconst isFinalAutoApproved = (\n\t\t\t// Is the setting enabled and the user has opted-in\n\t\t\tisAutoApproveAllowed &&\n\t\t\t// Does at least one analyzer auto approve\n\t\t\tcommandLineAnalyzerResults.some(e => e.isAutoApproved) &&\n\t\t\t// No analyzer denies auto approval\n\t\t\tcommandLineAnalyzerResults.every(e => e.isAutoApproved !== false) &&\n\t\t\t// All analyzers allow auto approval\n\t\t\tanalyzersIsAutoApproveAllowed\n\t\t);\n\n\t\tif (isFinalAutoApproved) {\n\t\t\ttoolSpecificData.autoApproveInfo = commandLineAnalyzerResults.find(e => e.autoApproveInfo)?.autoApproveInfo;\n\t\t}\n\n\t\tconst confirmationMessages = isFinalAutoApproved ? undefined : {\n\t\t\ttitle: args.isBackground\n\t\t\t\t? localize('runInTerminal.background', \"Run `{0}` command? (background terminal)\", shellType)\n\t\t\t\t: localize('runInTerminal', \"Run `{0}` command?\", shellType),\n\t\t\tmessage: new MarkdownString(args.explanation),\n\t\t\tdisclaimer,\n\t\t\tterminalCustomActions: customActions,\n\t\t};\n\n\t\treturn {\n\t\t\tconfirmationMessages,\n\t\t\ttoolSpecificData,\n\t\t};\n\t}\n\n\tasync invoke(invocation: IToolInvocation, _countTokens: CountTokensCallback, _progress: ToolProgress, token: CancellationToken): Promise<IToolResult> {\n\t\tconst toolSpecificData = invocation.toolSpecificData as IChatTerminalToolInvocationData | undefined;\n\t\tif (!toolSpecificData) {\n\t\t\tthrow new Error('toolSpecificData must be provided for this tool');\n\t\t}\n\t\tconst commandId = toolSpecificData.terminalCommandId;\n\t\tif (toolSpecificData.alternativeRecommendation) {\n\t\t\treturn {\n\t\t\t\tcontent: [{\n\t\t\t\t\tkind: 'text',\n\t\t\t\t\tvalue: toolSpecificData.alternativeRecommendation\n\t\t\t\t}]\n\t\t\t};\n\t\t}\n\n\t\tconst args = invocation.parameters as IRunInTerminalInputParams;\n\t\tthis._logService.debug(`RunInTerminalTool: Invoking with options ${JSON.stringify(args)}`);\n\t\tlet toolResultMessage: string | undefined;\n\n\t\tconst chatSessionId = invocation.context?.sessionId ?? 'no-chat-session';\n\t\tconst command = toolSpecificData.commandLine.userEdited ?? toolSpecificData.commandLine.toolEdited ?? toolSpecificData.commandLine.original;\n\t\tconst didUserEditCommand = (\n\t\t\ttoolSpecificData.commandLine.userEdited !== undefined &&\n\t\t\ttoolSpecificData.commandLine.userEdited !== toolSpecificData.commandLine.original\n\t\t);\n\t\tconst didToolEditCommand = (\n\t\t\t!didUserEditCommand &&\n\t\t\ttoolSpecificData.commandLine.toolEdited !== undefined &&\n\t\t\ttoolSpecificData.commandLine.toolEdited !== toolSpecificData.commandLine.original\n\t\t);\n\n\t\tif (token.isCancellationRequested) {\n\t\t\tthrow new CancellationError();\n\t\t}\n\n\t\tlet error: string | undefined;\n\t\tconst isNewSession = !args.isBackground && !this._sessionTerminalAssociations.has(chatSessionId);\n\n\t\tconst timingStart = Date.now();\n\t\tconst termId = generateUuid();\n\t\tconst terminalToolSessionId = (toolSpecificData as IChatTerminalToolInvocationData).terminalToolSessionId;\n\n\t\tconst store = new DisposableStore();\n\n\t\tthis._logService.debug(`RunInTerminalTool: Creating ${args.isBackground ? 'background' : 'foreground'} terminal. termId=${termId}, chatSessionId=${chatSessionId}`);\n\t\tconst toolTerminal = await (args.isBackground\n\t\t\t? this._initBackgroundTerminal(chatSessionId, termId, terminalToolSessionId, token)\n\t\t\t: this._initForegroundTerminal(chatSessionId, termId, terminalToolSessionId, token));\n\n\t\tthis._handleTerminalVisibility(toolTerminal);\n\n\t\tconst timingConnectMs = Date.now() - timingStart;\n\n\t\tconst xterm = await toolTerminal.instance.xtermReadyPromise;\n\t\tif (!xterm) {\n\t\t\tthrow new Error('Instance was disposed before xterm.js was ready');\n\t\t}\n\n\t\tconst commandDetection = toolTerminal.instance.capabilities.get(TerminalCapability.CommandDetection);\n\n\t\tlet inputUserChars = 0;\n\t\tlet inputUserSigint = false;\n\t\tstore.add(xterm.raw.onData(data => {\n\t\t\tif (!telemetryIgnoredSequences.includes(data)) {\n\t\t\t\tinputUserChars += data.length;\n\t\t\t}\n\t\t\tinputUserSigint ||= data === '\\x03';\n\t\t}));\n\n\t\tlet outputMonitor: OutputMonitor | undefined;\n\t\tif (args.isBackground) {\n\t\t\tlet pollingResult: IPollingResult & { pollDurationMs: number } | undefined;\n\t\t\ttry {\n\t\t\t\tthis._logService.debug(`RunInTerminalTool: Starting background execution \\`${command}\\``);\n\t\t\t\tconst execution = new BackgroundTerminalExecution(toolTerminal.instance, xterm, command, chatSessionId, commandId);\n\t\t\t\tRunInTerminalTool._backgroundExecutions.set(termId, execution);\n\n\t\t\t\toutputMonitor = store.add(this._instantiationService.createInstance(OutputMonitor, execution, undefined, invocation.context!, token, command));\n\t\t\t\tawait Event.toPromise(outputMonitor.onDidFinishCommand);\n\t\t\t\tconst pollingResult = outputMonitor.pollingResult;\n\n\t\t\t\tif (token.isCancellationRequested) {\n\t\t\t\t\tthrow new CancellationError();\n\t\t\t\t}\n\n\t\t\t\tawait this._commandArtifactCollector.capture(toolSpecificData, toolTerminal.instance, commandId, pollingResult?.output);\n\t\t\t\tconst state = toolSpecificData.terminalCommandState ?? {};\n\t\t\t\tstate.timestamp = state.timestamp ?? timingStart;\n\t\t\t\ttoolSpecificData.terminalCommandState = state;\n\n\t\t\t\tlet resultText = (\n\t\t\t\t\tdidUserEditCommand\n\t\t\t\t\t\t? `Note: The user manually edited the command to \\`${command}\\`, and that command is now running in terminal with ID=${termId}`\n\t\t\t\t\t\t: didToolEditCommand\n\t\t\t\t\t\t\t? `Note: The tool simplified the command to \\`${command}\\`, and that command is now running in terminal with ID=${termId}`\n\t\t\t\t\t\t\t: `Command is running in terminal with ID=${termId}`\n\t\t\t\t);\n\t\t\t\tif (pollingResult && pollingResult.modelOutputEvalResponse) {\n\t\t\t\t\tresultText += `\\n\\ The command became idle with output:\\n${pollingResult.modelOutputEvalResponse}`;\n\t\t\t\t} else if (pollingResult) {\n\t\t\t\t\tresultText += `\\n\\ The command is still running, with output:\\n${pollingResult.output}`;\n\t\t\t\t}\n\n\t\t\t\treturn {\n\t\t\t\t\ttoolMetadata: {\n\t\t\t\t\t\texitCode: undefined // Background processes don't have immediate exit codes\n\t\t\t\t\t},\n\t\t\t\t\tcontent: [{\n\t\t\t\t\t\tkind: 'text',\n\t\t\t\t\t\tvalue: resultText,\n\t\t\t\t\t}],\n\t\t\t\t};\n\t\t\t} catch (e) {\n\t\t\t\tif (termId) {\n\t\t\t\t\tRunInTerminalTool._backgroundExecutions.get(termId)?.dispose();\n\t\t\t\t\tRunInTerminalTool._backgroundExecutions.delete(termId);\n\t\t\t\t}\n\t\t\t\terror = e instanceof CancellationError ? 'canceled' : 'unexpectedException';\n\t\t\t\tthrow e;\n\t\t\t} finally {\n\t\t\t\tstore.dispose();\n\t\t\t\tthis._logService.debug(`RunInTerminalTool: Finished polling \\`${pollingResult?.output.length}\\` lines of output in \\`${pollingResult?.pollDurationMs}\\``);\n\t\t\t\tconst timingExecuteMs = Date.now() - timingStart;\n\t\t\t\tthis._telemetry.logInvoke(toolTerminal.instance, {\n\t\t\t\t\tterminalToolSessionId: toolSpecificData.terminalToolSessionId,\n\t\t\t\t\tdidUserEditCommand,\n\t\t\t\t\tdidToolEditCommand,\n\t\t\t\t\tshellIntegrationQuality: toolTerminal.shellIntegrationQuality,\n\t\t\t\t\tisBackground: true,\n\t\t\t\t\terror,\n\t\t\t\t\texitCode: undefined,\n\t\t\t\t\tisNewSession: true,\n\t\t\t\t\ttimingExecuteMs,\n\t\t\t\t\ttimingConnectMs,\n\t\t\t\t\tterminalExecutionIdleBeforeTimeout: pollingResult?.state === OutputMonitorState.Idle,\n\t\t\t\t\toutputLineCount: pollingResult?.output ? count(pollingResult.output, '\\n') : 0,\n\t\t\t\t\tpollDurationMs: pollingResult?.pollDurationMs,\n\t\t\t\t\tinputUserChars,\n\t\t\t\t\tinputUserSigint,\n\t\t\t\t\tinputToolManualAcceptCount: outputMonitor?.outputMonitorTelemetryCounters.inputToolManualAcceptCount,\n\t\t\t\t\tinputToolManualRejectCount: outputMonitor?.outputMonitorTelemetryCounters.inputToolManualRejectCount,\n\t\t\t\t\tinputToolManualChars: outputMonitor?.outputMonitorTelemetryCounters.inputToolManualChars,\n\t\t\t\t\tinputToolAutoAcceptCount: outputMonitor?.outputMonitorTelemetryCounters.inputToolAutoAcceptCount,\n\t\t\t\t\tinputToolAutoChars: outputMonitor?.outputMonitorTelemetryCounters.inputToolAutoChars,\n\t\t\t\t\tinputToolManualShownCount: outputMonitor?.outputMonitorTelemetryCounters.inputToolManualShownCount,\n\t\t\t\t\tinputToolFreeFormInputCount: outputMonitor?.outputMonitorTelemetryCounters.inputToolFreeFormInputCount,\n\t\t\t\t\tinputToolFreeFormInputShownCount: outputMonitor?.outputMonitorTelemetryCounters.inputToolFreeFormInputShownCount\n\t\t\t\t});\n\t\t\t}\n\t\t} else {\n\t\t\tlet terminalResult = '';\n\n\t\t\tlet outputLineCount = -1;\n\t\t\tlet exitCode: number | undefined;\n\t\t\ttry {\n\t\t\t\tlet strategy: ITerminalExecuteStrategy;\n\t\t\t\tswitch (toolTerminal.shellIntegrationQuality) {\n\t\t\t\t\tcase ShellIntegrationQuality.None: {\n\t\t\t\t\t\tstrategy = this._instantiationService.createInstance(NoneExecuteStrategy, toolTerminal.instance, () => toolTerminal.receivedUserInput ?? false);\n\t\t\t\t\t\ttoolResultMessage = '$(info) Enable [shell integration](https://code.visualstudio.com/docs/terminal/shell-integration) to improve command detection';\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\tcase ShellIntegrationQuality.Basic: {\n\t\t\t\t\t\tstrategy = this._instantiationService.createInstance(BasicExecuteStrategy, toolTerminal.instance, () => toolTerminal.receivedUserInput ?? false, commandDetection!);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\tcase ShellIntegrationQuality.Rich: {\n\t\t\t\t\t\tstrategy = this._instantiationService.createInstance(RichExecuteStrategy, toolTerminal.instance, commandDetection!);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tthis._logService.debug(`RunInTerminalTool: Using \\`${strategy.type}\\` execute strategy for command \\`${command}\\``);\n\t\t\t\tstore.add(strategy.onDidCreateStartMarker(startMarker => {\n\t\t\t\t\tif (!outputMonitor) {\n\t\t\t\t\t\toutputMonitor = store.add(this._instantiationService.createInstance(OutputMonitor, { instance: toolTerminal.instance, sessionId: invocation.context?.sessionId, getOutput: (marker?: IXtermMarker) => getOutput(toolTerminal.instance, marker ?? startMarker) }, undefined, invocation.context, token, command));\n\t\t\t\t\t}\n\t\t\t\t}));\n\t\t\t\tconst executeResult = await strategy.execute(command, token, commandId);\n\t\t\t\t// Reset user input state after command execution completes\n\t\t\t\ttoolTerminal.receivedUserInput = false;\n\t\t\t\tif (token.isCancellationRequested) {\n\t\t\t\t\tthrow new CancellationError();\n\t\t\t\t}\n\n\t\t\t\tawait this._commandArtifactCollector.capture(toolSpecificData, toolTerminal.instance, commandId, executeResult.output);\n\t\t\t\t{\n\t\t\t\t\tconst state = toolSpecificData.terminalCommandState ?? {};\n\t\t\t\t\tstate.timestamp = state.timestamp ?? timingStart;\n\t\t\t\t\tif (executeResult.exitCode !== undefined) {\n\t\t\t\t\t\tstate.exitCode = executeResult.exitCode;\n\t\t\t\t\t\tif (state.timestamp !== undefined) {\n\t\t\t\t\t\t\tstate.duration = state.duration ?? Math.max(0, Date.now() - state.timestamp);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\ttoolSpecificData.terminalCommandState = state;\n\t\t\t\t}\n\n\t\t\t\tthis._logService.debug(`RunInTerminalTool: Finished \\`${strategy.type}\\` execute strategy with exitCode \\`${executeResult.exitCode}\\`, result.length \\`${executeResult.output?.length}\\`, error \\`${executeResult.error}\\``);\n\t\t\t\toutputLineCount = executeResult.output === undefined ? 0 : count(executeResult.output.trim(), '\\n') + 1;\n\t\t\t\texitCode = executeResult.exitCode;\n\t\t\t\terror = executeResult.error;\n\n\t\t\t\tconst resultArr: string[] = [];\n\t\t\t\tif (executeResult.output !== undefined) {\n\t\t\t\t\tresultArr.push(executeResult.output);\n\t\t\t\t}\n\t\t\t\tif (executeResult.additionalInformation) {\n\t\t\t\t\tresultArr.push(executeResult.additionalInformation);\n\t\t\t\t}\n\t\t\t\tterminalResult = resultArr.join('\\n\\n');\n\n\t\t\t} catch (e) {\n\t\t\t\tthis._logService.debug(`RunInTerminalTool: Threw exception`);\n\t\t\t\ttoolTerminal.instance.dispose();\n\t\t\t\terror = e instanceof CancellationError ? 'canceled' : 'unexpectedException';\n\t\t\t\tthrow e;\n\t\t\t} finally {\n\t\t\t\tstore.dispose();\n\t\t\t\tconst timingExecuteMs = Date.now() - timingStart;\n\t\t\t\tthis._telemetry.logInvoke(toolTerminal.instance, {\n\t\t\t\t\tterminalToolSessionId: toolSpecificData.terminalToolSessionId,\n\t\t\t\t\tdidUserEditCommand,\n\t\t\t\t\tdidToolEditCommand,\n\t\t\t\t\tisBackground: false,\n\t\t\t\t\tshellIntegrationQuality: toolTerminal.shellIntegrationQuality,\n\t\t\t\t\terror,\n\t\t\t\t\tisNewSession,\n\t\t\t\t\toutputLineCount,\n\t\t\t\t\texitCode,\n\t\t\t\t\ttimingExecuteMs,\n\t\t\t\t\ttimingConnectMs,\n\t\t\t\t\tinputUserChars,\n\t\t\t\t\tinputUserSigint,\n\t\t\t\t\tterminalExecutionIdleBeforeTimeout: undefined,\n\t\t\t\t\tpollDurationMs: undefined,\n\t\t\t\t\tinputToolManualAcceptCount: outputMonitor?.outputMonitorTelemetryCounters?.inputToolManualAcceptCount,\n\t\t\t\t\tinputToolManualRejectCount: outputMonitor?.outputMonitorTelemetryCounters?.inputToolManualRejectCount,\n\t\t\t\t\tinputToolManualChars: outputMonitor?.outputMonitorTelemetryCounters?.inputToolManualChars,\n\t\t\t\t\tinputToolAutoAcceptCount: outputMonitor?.outputMonitorTelemetryCounters?.inputToolAutoAcceptCount,\n\t\t\t\t\tinputToolAutoChars: outputMonitor?.outputMonitorTelemetryCounters?.inputToolAutoChars,\n\t\t\t\t\tinputToolManualShownCount: outputMonitor?.outputMonitorTelemetryCounters?.inputToolManualShownCount,\n\t\t\t\t\tinputToolFreeFormInputCount: outputMonitor?.outputMonitorTelemetryCounters?.inputToolFreeFormInputCount,\n\t\t\t\t\tinputToolFreeFormInputShownCount: outputMonitor?.outputMonitorTelemetryCounters?.inputToolFreeFormInputShownCount\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tconst resultText: string[] = [];\n\t\t\tif (didUserEditCommand) {\n\t\t\t\tresultText.push(`Note: The user manually edited the command to \\`${command}\\`, and this is the output of running that command instead:\\n`);\n\t\t\t} else if (didToolEditCommand) {\n\t\t\t\tresultText.push(`Note: The tool simplified the command to \\`${command}\\`, and this is the output of running that command instead:\\n`);\n\t\t\t}\n\t\t\tresultText.push(terminalResult);\n\n\t\t\treturn {\n\t\t\t\ttoolResultMessage,\n\t\t\t\ttoolMetadata: {\n\t\t\t\t\texitCode: exitCode\n\t\t\t\t},\n\t\t\t\tcontent: [{\n\t\t\t\t\tkind: 'text',\n\t\t\t\t\tvalue: resultText.join(''),\n\t\t\t\t}]\n\t\t\t};\n\t\t}\n\t}\n\n\tprivate _handleTerminalVisibility(toolTerminal: IToolTerminal) {\n\t\tif (this._configurationService.getValue(TerminalChatAgentToolsSettingId.OutputLocation) === 'terminal') {\n\t\t\tthis._terminalService.setActiveInstance(toolTerminal.instance);\n\t\t\tthis._terminalService.revealTerminal(toolTerminal.instance, true);\n\t\t}\n\t}\n\n\t// #region Terminal init\n\n\tprivate async _initBackgroundTerminal(chatSessionId: string, termId: string, terminalToolSessionId: string | undefined, token: CancellationToken): Promise<IToolTerminal> {\n\t\tthis._logService.debug(`RunInTerminalTool: Creating background terminal with ID=${termId}`);\n\t\tconst profile = await this._profileFetcher.getCopilotProfile();\n\t\tconst toolTerminal = await this._terminalToolCreator.createTerminal(profile, token);\n\t\tthis._terminalChatService.registerTerminalInstanceWithToolSession(terminalToolSessionId, toolTerminal.instance);\n\t\tthis._terminalChatService.registerTerminalInstanceWithChatSession(chatSessionId, toolTerminal.instance);\n\t\tthis._registerInputListener(toolTerminal);\n\t\tthis._sessionTerminalAssociations.set(chatSessionId, toolTerminal);\n\t\tif (token.isCancellationRequested) {\n\t\t\ttoolTerminal.instance.dispose();\n\t\t\tthrow new CancellationError();\n\t\t}\n\t\tawait this._setupProcessIdAssociation(toolTerminal, chatSessionId, termId, true);\n\t\treturn toolTerminal;\n\t}\n\n\tprivate async _initForegroundTerminal(chatSessionId: string, termId: string, terminalToolSessionId: string | undefined, token: CancellationToken): Promise<IToolTerminal> {\n\t\tconst cachedTerminal = this._sessionTerminalAssociations.get(chatSessionId);\n\t\tif (cachedTerminal) {\n\t\t\tthis._logService.debug(`RunInTerminalTool: Using cached foreground terminal with session ID \\`${chatSessionId}\\``);\n\t\t\tthis._terminalToolCreator.refreshShellIntegrationQuality(cachedTerminal);\n\t\t\tthis._terminalChatService.registerTerminalInstanceWithToolSession(terminalToolSessionId, cachedTerminal.instance);\n\t\t\treturn cachedTerminal;\n\t\t}\n\t\tconst profile = await this._profileFetcher.getCopilotProfile();\n\t\tconst toolTerminal = await this._terminalToolCreator.createTerminal(profile, token);\n\t\tthis._terminalChatService.registerTerminalInstanceWithToolSession(terminalToolSessionId, toolTerminal.instance);\n\t\tthis._terminalChatService.registerTerminalInstanceWithChatSession(chatSessionId, toolTerminal.instance);\n\t\tthis._registerInputListener(toolTerminal);\n\t\tthis._sessionTerminalAssociations.set(chatSessionId, toolTerminal);\n\t\tif (token.isCancellationRequested) {\n\t\t\ttoolTerminal.instance.dispose();\n\t\t\tthrow new CancellationError();\n\t\t}\n\t\tawait this._setupProcessIdAssociation(toolTerminal, chatSessionId, termId, false);\n\t\treturn toolTerminal;\n\t}\n\n\tprivate _registerInputListener(toolTerminal: IToolTerminal): void {\n\t\tconst disposable = toolTerminal.instance.onData(data => {\n\t\t\tif (!telemetryIgnoredSequences.includes(data)) {\n\t\t\t\ttoolTerminal.receivedUserInput = data.length > 0;\n\t\t\t}\n\t\t});\n\t\tthis._register(toolTerminal.instance.onDisposed(() => disposable.dispose()));\n\t}\n\n\n\t// #endregion\n\n\t// #region Session management\n\n\tprivate _restoreTerminalAssociations(): void {\n\t\tconst storedAssociations = this._storageService.get(TerminalToolStorageKeysInternal.TerminalSession, StorageScope.WORKSPACE, '{}');\n\t\ttry {\n\t\t\tconst associations: Record<number, IStoredTerminalAssociation> = JSON.parse(storedAssociations);\n\n\t\t\t// Find existing terminals and associate them with sessions\n\t\t\tfor (const instance of this._terminalService.instances) {\n\t\t\t\tif (instance.processId) {\n\t\t\t\t\tconst association = associations[instance.processId];\n\t\t\t\t\tif (association) {\n\t\t\t\t\t\tthis._logService.debug(`RunInTerminalTool: Restored terminal association for PID ${instance.processId}, session ${association.sessionId}`);\n\t\t\t\t\t\tconst toolTerminal: IToolTerminal = {\n\t\t\t\t\t\t\tinstance,\n\t\t\t\t\t\t\tshellIntegrationQuality: association.shellIntegrationQuality\n\t\t\t\t\t\t};\n\t\t\t\t\t\tthis._sessionTerminalAssociations.set(association.sessionId, toolTerminal);\n\t\t\t\t\t\tthis._terminalChatService.registerTerminalInstanceWithChatSession(association.sessionId, instance);\n\n\t\t\t\t\t\t// Listen for terminal disposal to clean up storage\n\t\t\t\t\t\tthis._register(instance.onDisposed(() => {\n\t\t\t\t\t\t\tthis._removeProcessIdAssociation(instance.processId!);\n\t\t\t\t\t\t}));\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t} catch (error) {\n\t\t\tthis._logService.debug(`RunInTerminalTool: Failed to restore terminal associations: ${error}`);\n\t\t}\n\t}\n\n\tprivate async _setupProcessIdAssociation(toolTerminal: IToolTerminal, chatSessionId: string, termId: string, isBackground: boolean) {\n\t\tawait this._associateProcessIdWithSession(toolTerminal.instance, chatSessionId, termId, toolTerminal.shellIntegrationQuality, isBackground);\n\t\tthis._register(toolTerminal.instance.onDisposed(() => {\n\t\t\tif (toolTerminal!.instance.processId) {\n\t\t\t\tthis._removeProcessIdAssociation(toolTerminal!.instance.processId);\n\t\t\t}\n\t\t}));\n\t}\n\n\tprivate async _associateProcessIdWithSession(terminal: ITerminalInstance, sessionId: string, id: string, shellIntegrationQuality: ShellIntegrationQuality, isBackground?: boolean): Promise<void> {\n\t\ttry {\n\t\t\t// Wait for process ID with timeout\n\t\t\tconst pid = await Promise.race([\n\t\t\t\tterminal.processReady.then(() => terminal.processId),\n\t\t\t\ttimeout(5000).then(() => { throw new Error('Timeout'); })\n\t\t\t]);\n\n\t\t\tif (isNumber(pid)) {\n\t\t\t\tconst storedAssociations = this._storageService.get(TerminalToolStorageKeysInternal.TerminalSession, StorageScope.WORKSPACE, '{}');\n\t\t\t\tconst associations: Record<number, IStoredTerminalAssociation> = JSON.parse(storedAssociations);\n\n\t\t\t\tconst existingAssociation = associations[pid] || {};\n\t\t\t\tassociations[pid] = {\n\t\t\t\t\t...existingAssociation,\n\t\t\t\t\tsessionId,\n\t\t\t\t\tshellIntegrationQuality,\n\t\t\t\t\tid,\n\t\t\t\t\tisBackground\n\t\t\t\t};\n\n\t\t\t\tthis._storageService.store(TerminalToolStorageKeysInternal.TerminalSession, JSON.stringify(associations), StorageScope.WORKSPACE, StorageTarget.USER);\n\t\t\t\tthis._logService.debug(`RunInTerminalTool: Associated terminal PID ${pid} with session ${sessionId}`);\n\t\t\t}\n\t\t} catch (error) {\n\t\t\tthis._logService.debug(`RunInTerminalTool: Failed to associate terminal with session: ${error}`);\n\t\t}\n\t}\n\n\tprivate async _removeProcessIdAssociation(pid: number): Promise<void> {\n\t\ttry {\n\t\t\tconst storedAssociations = this._storageService.get(TerminalToolStorageKeysInternal.TerminalSession, StorageScope.WORKSPACE, '{}');\n\t\t\tconst associations: Record<number, IStoredTerminalAssociation> = JSON.parse(storedAssociations);\n\n\t\t\tif (associations[pid]) {\n\t\t\t\tdelete associations[pid];\n\t\t\t\tthis._storageService.store(TerminalToolStorageKeysInternal.TerminalSession, JSON.stringify(associations), StorageScope.WORKSPACE, StorageTarget.USER);\n\t\t\t\tthis._logService.debug(`RunInTerminalTool: Removed terminal association for PID ${pid}`);\n\t\t\t}\n\t\t} catch (error) {\n\t\t\tthis._logService.debug(`RunInTerminalTool: Failed to remove terminal association: ${error}`);\n\t\t}\n\t}\n\n\tprivate _cleanupSessionTerminals(sessionId: string): void {\n\t\tconst toolTerminal = this._sessionTerminalAssociations.get(sessionId);\n\t\tif (toolTerminal) {\n\t\t\tthis._logService.debug(`RunInTerminalTool: Cleaning up terminal for disposed chat session ${sessionId}`);\n\n\t\t\tthis._sessionTerminalAssociations.delete(sessionId);\n\t\t\ttoolTerminal.instance.dispose();\n\n\t\t\t// Clean up any background executions associated with this session\n\t\t\tconst terminalToRemove: string[] = [];\n\t\t\tfor (const [termId, execution] of RunInTerminalTool._backgroundExecutions.entries()) {\n\t\t\t\tif (execution.instance === toolTerminal.instance) {\n\t\t\t\t\texecution.dispose();\n\t\t\t\t\tterminalToRemove.push(termId);\n\t\t\t\t}\n\t\t\t}\n\t\t\tfor (const termId of terminalToRemove) {\n\t\t\t\tRunInTerminalTool._backgroundExecutions.delete(termId);\n\t\t\t}\n\t\t}\n\t}\n\n\t// #endregion\n}\n\nclass BackgroundTerminalExecution extends Disposable {\n\tprivate _startMarker?: IXtermMarker;\n\n\tconstructor(\n\t\treadonly instance: ITerminalInstance,\n\t\tprivate readonly _xterm: XtermTerminal,\n\t\tprivate readonly _commandLine: string,\n\t\treadonly sessionId: string,\n\t\tcommandId?: string\n\t) {\n\t\tsuper();\n\n\t\tthis._startMarker = this._register(this._xterm.raw.registerMarker());\n\t\tthis.instance.runCommand(this._commandLine, true, commandId);\n\t}\n\tgetOutput(marker?: IXtermMarker): string {\n\t\treturn getOutput(this.instance, marker ?? this._startMarker);\n\t}\n}\n\nexport class TerminalProfileFetcher {\n\n\treadonly osBackend: Promise<OperatingSystem>;\n\n\tconstructor(\n\t\t@IConfigurationService private readonly _configurationService: IConfigurationService,\n\t\t@ITerminalProfileResolverService private readonly _terminalProfileResolverService: ITerminalProfileResolverService,\n\t\t@IRemoteAgentService private readonly _remoteAgentService: IRemoteAgentService,\n\t) {\n\t\tthis.osBackend = this._remoteAgentService.getEnvironment().then(remoteEnv => remoteEnv?.os ?? OS);\n\t}\n\n\tasync getCopilotProfile(): Promise<ITerminalProfile> {\n\t\tconst os = await this.osBackend;\n\n\t\t// Check for chat agent terminal profile first\n\t\tconst customChatAgentProfile = this._getChatTerminalProfile(os);\n\t\tif (customChatAgentProfile) {\n\t\t\treturn customChatAgentProfile;\n\t\t}\n\n\t\t// When setting is null, use the previous behavior\n\t\tconst defaultProfile = await this._terminalProfileResolverService.getDefaultProfile({\n\t\t\tos,\n\t\t\tremoteAuthority: this._remoteAgentService.getConnection()?.remoteAuthority\n\t\t});\n\n\t\t// Force pwsh over cmd as cmd doesn't have shell integration\n\t\tif (basename(defaultProfile.path) === 'cmd.exe') {\n\t\t\treturn {\n\t\t\t\t...defaultProfile,\n\t\t\t\tpath: 'C:\\\\WINDOWS\\\\System32\\\\WindowsPowerShell\\\\v1.0\\\\powershell.exe',\n\t\t\t\tprofileName: 'PowerShell'\n\t\t\t};\n\t\t}\n\n\t\t// Setting icon: undefined allows the system to use the default AI terminal icon (not overridden or removed)\n\t\treturn { ...defaultProfile, icon: undefined };\n\t}\n\n\tasync getCopilotShell(): Promise<string> {\n\t\treturn (await this.getCopilotProfile()).path;\n\t}\n\n\tprivate _getChatTerminalProfile(os: OperatingSystem): ITerminalProfile | undefined {\n\t\tlet profileSetting: string;\n\t\tswitch (os) {\n\t\t\tcase OperatingSystem.Windows:\n\t\t\t\tprofileSetting = TerminalChatAgentToolsSettingId.TerminalProfileWindows;\n\t\t\t\tbreak;\n\t\t\tcase OperatingSystem.Macintosh:\n\t\t\t\tprofileSetting = TerminalChatAgentToolsSettingId.TerminalProfileMacOs;\n\t\t\t\tbreak;\n\t\t\tcase OperatingSystem.Linux:\n\t\t\tdefault:\n\t\t\t\tprofileSetting = TerminalChatAgentToolsSettingId.TerminalProfileLinux;\n\t\t\t\tbreak;\n\t\t}\n\n\t\tconst profile = this._configurationService.getValue(profileSetting);\n\t\tif (this._isValidChatAgentTerminalProfile(profile)) {\n\t\t\treturn profile;\n\t\t}\n\n\t\treturn undefined;\n\t}\n\n\tprivate _isValidChatAgentTerminalProfile(profile: unknown): profile is ITerminalProfile {\n\t\tif (profile === null || profile === undefined || typeof profile !== 'object') {\n\t\t\treturn false;\n\t\t}\n\t\tif ('path' in profile && isString((profile as { path: unknown }).path)) {\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n}\n\n// #endregion\n"]}