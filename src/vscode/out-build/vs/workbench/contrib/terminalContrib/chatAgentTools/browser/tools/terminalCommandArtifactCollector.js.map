{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/contrib/terminalContrib/chatAgentTools/browser/tools/terminalCommandArtifactCollector.ts","vs/workbench/contrib/terminalContrib/chatAgentTools/browser/tools/terminalCommandArtifactCollector.ts"],"names":[],"mappings":"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","file":"terminalCommandArtifactCollector.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { URI } from '../../../../../../base/common/uri.js';\nimport { IChatTerminalToolInvocationData } from '../../../../chat/common/chatService.js';\nimport { CHAT_TERMINAL_OUTPUT_MAX_PREVIEW_LINES } from '../../../../chat/common/constants.js';\nimport { ITerminalInstance } from '../../../../terminal/browser/terminal.js';\nimport { TerminalCapability } from '../../../../../../platform/terminal/common/capabilities/capabilities.js';\nimport { ITerminalLogService } from '../../../../../../platform/terminal/common/terminal.js';\n\nexport class TerminalCommandArtifactCollector {\n\tconstructor(\n\t\t@ITerminalLogService private readonly _logService: ITerminalLogService,\n\t) { }\n\n\tasync capture(\n\t\ttoolSpecificData: IChatTerminalToolInvocationData,\n\t\tinstance: ITerminalInstance,\n\t\tcommandId: string | undefined,\n\t\tfallbackOutput?: string\n\t): Promise<void> {\n\t\tif (commandId) {\n\t\t\ttry {\n\t\t\t\ttoolSpecificData.terminalCommandUri = this._createTerminalCommandUri(instance, commandId);\n\t\t\t} catch (error) {\n\t\t\t\tthis._logService.warn(`RunInTerminalTool: Failed to create terminal command URI for ${commandId}`, error);\n\t\t\t}\n\n\t\t\tconst serialized = await this._tryGetSerializedCommandOutput(toolSpecificData, instance, commandId);\n\t\t\tif (serialized) {\n\t\t\t\ttoolSpecificData.terminalCommandOutput = { text: serialized.text, truncated: serialized.truncated };\n\t\t\t\ttoolSpecificData.terminalCommandState = {\n\t\t\t\t\texitCode: serialized.exitCode,\n\t\t\t\t\ttimestamp: serialized.timestamp,\n\t\t\t\t\tduration: serialized.duration\n\t\t\t\t};\n\t\t\t\tthis._applyTheme(toolSpecificData, instance);\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tif (fallbackOutput !== undefined) {\n\t\t\tconst normalized = fallbackOutput.replace(/\\r\\n/g, '\\n');\n\t\t\ttoolSpecificData.terminalCommandOutput = { text: normalized, truncated: false };\n\t\t\tthis._applyTheme(toolSpecificData, instance);\n\t\t}\n\t}\n\n\tprivate _applyTheme(toolSpecificData: IChatTerminalToolInvocationData, instance: ITerminalInstance): void {\n\t\tconst theme = instance.xterm?.getXtermTheme();\n\t\tif (theme) {\n\t\t\ttoolSpecificData.terminalTheme = { background: theme.background, foreground: theme.foreground };\n\t\t}\n\t}\n\n\tprivate _createTerminalCommandUri(instance: ITerminalInstance, commandId: string): URI {\n\t\tconst params = new URLSearchParams(instance.resource.query);\n\t\tparams.set('command', commandId);\n\t\treturn instance.resource.with({ query: params.toString() });\n\t}\n\n\tprivate async _tryGetSerializedCommandOutput(toolSpecificData: IChatTerminalToolInvocationData, instance: ITerminalInstance, commandId: string): Promise<{ text: string; truncated?: boolean; exitCode?: number; timestamp?: number; duration?: number } | undefined> {\n\t\tconst commandDetection = instance.capabilities.get(TerminalCapability.CommandDetection);\n\t\tconst command = commandDetection?.commands.find(c => c.id === commandId);\n\n\t\tif (!command?.endMarker) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\tconst xterm = await instance.xtermReadyPromise;\n\t\tif (!xterm) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\ttry {\n\t\t\tconst result = await xterm.getCommandOutputAsHtml(command, CHAT_TERMINAL_OUTPUT_MAX_PREVIEW_LINES);\n\t\t\treturn {\n\t\t\t\ttext: result.text,\n\t\t\t\ttruncated: result.truncated,\n\t\t\t\texitCode: command.exitCode,\n\t\t\t\ttimestamp: command.timestamp,\n\t\t\t\tduration: command.duration\n\t\t\t};\n\t\t} catch (error) {\n\t\t\tthis._logService.warn(`RunInTerminalTool: Failed to serialize command output for ${commandId}`, error);\n\t\t\treturn undefined;\n\t\t}\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { URI } from '../../../../../../base/common/uri.js';\nimport { IChatTerminalToolInvocationData } from '../../../../chat/common/chatService.js';\nimport { CHAT_TERMINAL_OUTPUT_MAX_PREVIEW_LINES } from '../../../../chat/common/constants.js';\nimport { ITerminalInstance } from '../../../../terminal/browser/terminal.js';\nimport { TerminalCapability } from '../../../../../../platform/terminal/common/capabilities/capabilities.js';\nimport { ITerminalLogService } from '../../../../../../platform/terminal/common/terminal.js';\n\nexport class TerminalCommandArtifactCollector {\n\tconstructor(\n\t\t@ITerminalLogService private readonly _logService: ITerminalLogService,\n\t) { }\n\n\tasync capture(\n\t\ttoolSpecificData: IChatTerminalToolInvocationData,\n\t\tinstance: ITerminalInstance,\n\t\tcommandId: string | undefined,\n\t\tfallbackOutput?: string\n\t): Promise<void> {\n\t\tif (commandId) {\n\t\t\ttry {\n\t\t\t\ttoolSpecificData.terminalCommandUri = this._createTerminalCommandUri(instance, commandId);\n\t\t\t} catch (error) {\n\t\t\t\tthis._logService.warn(`RunInTerminalTool: Failed to create terminal command URI for ${commandId}`, error);\n\t\t\t}\n\n\t\t\tconst serialized = await this._tryGetSerializedCommandOutput(toolSpecificData, instance, commandId);\n\t\t\tif (serialized) {\n\t\t\t\ttoolSpecificData.terminalCommandOutput = { text: serialized.text, truncated: serialized.truncated };\n\t\t\t\ttoolSpecificData.terminalCommandState = {\n\t\t\t\t\texitCode: serialized.exitCode,\n\t\t\t\t\ttimestamp: serialized.timestamp,\n\t\t\t\t\tduration: serialized.duration\n\t\t\t\t};\n\t\t\t\tthis._applyTheme(toolSpecificData, instance);\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tif (fallbackOutput !== undefined) {\n\t\t\tconst normalized = fallbackOutput.replace(/\\r\\n/g, '\\n');\n\t\t\ttoolSpecificData.terminalCommandOutput = { text: normalized, truncated: false };\n\t\t\tthis._applyTheme(toolSpecificData, instance);\n\t\t}\n\t}\n\n\tprivate _applyTheme(toolSpecificData: IChatTerminalToolInvocationData, instance: ITerminalInstance): void {\n\t\tconst theme = instance.xterm?.getXtermTheme();\n\t\tif (theme) {\n\t\t\ttoolSpecificData.terminalTheme = { background: theme.background, foreground: theme.foreground };\n\t\t}\n\t}\n\n\tprivate _createTerminalCommandUri(instance: ITerminalInstance, commandId: string): URI {\n\t\tconst params = new URLSearchParams(instance.resource.query);\n\t\tparams.set('command', commandId);\n\t\treturn instance.resource.with({ query: params.toString() });\n\t}\n\n\tprivate async _tryGetSerializedCommandOutput(toolSpecificData: IChatTerminalToolInvocationData, instance: ITerminalInstance, commandId: string): Promise<{ text: string; truncated?: boolean; exitCode?: number; timestamp?: number; duration?: number } | undefined> {\n\t\tconst commandDetection = instance.capabilities.get(TerminalCapability.CommandDetection);\n\t\tconst command = commandDetection?.commands.find(c => c.id === commandId);\n\n\t\tif (!command?.endMarker) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\tconst xterm = await instance.xtermReadyPromise;\n\t\tif (!xterm) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\ttry {\n\t\t\tconst result = await xterm.getCommandOutputAsHtml(command, CHAT_TERMINAL_OUTPUT_MAX_PREVIEW_LINES);\n\t\t\treturn {\n\t\t\t\ttext: result.text,\n\t\t\t\ttruncated: result.truncated,\n\t\t\t\texitCode: command.exitCode,\n\t\t\t\ttimestamp: command.timestamp,\n\t\t\t\tduration: command.duration\n\t\t\t};\n\t\t} catch (error) {\n\t\t\tthis._logService.warn(`RunInTerminalTool: Failed to serialize command output for ${commandId}`, error);\n\t\t\treturn undefined;\n\t\t}\n\t}\n}\n"]}