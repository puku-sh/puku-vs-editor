{"version":3,"sources":["vs/workbench/contrib/terminalContrib/clipboard/browser/terminal.clipboard.contribution.ts"],"names":[],"mappings":"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","file":"terminal.clipboard.contribution.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport type { Terminal as RawXtermTerminal } from '@xterm/xterm';\nimport { Disposable, toDisposable, type IDisposable } from '../../../../../base/common/lifecycle.js';\nimport { IClipboardService } from '../../../../../platform/clipboard/common/clipboardService.js';\nimport { IInstantiationService } from '../../../../../platform/instantiation/common/instantiation.js';\nimport { IDetachedTerminalInstance, ITerminalConfigurationService, ITerminalContribution, ITerminalInstance, type IXtermTerminal } from '../../../terminal/browser/terminal.js';\nimport { registerTerminalContribution, type IDetachedCompatibleTerminalContributionContext, type ITerminalContributionContext } from '../../../terminal/browser/terminalExtensions.js';\nimport { shouldPasteTerminalText } from './terminalClipboard.js';\nimport { Emitter } from '../../../../../base/common/event.js';\nimport { BrowserFeatures } from '../../../../../base/browser/canIUse.js';\nimport { TerminalCapability, type ITerminalCommand } from '../../../../../platform/terminal/common/capabilities/capabilities.js';\nimport { IConfigurationService } from '../../../../../platform/configuration/common/configuration.js';\nimport { TerminalSettingId } from '../../../../../platform/terminal/common/terminal.js';\nimport { isLinux, isMacintosh } from '../../../../../base/common/platform.js';\nimport { INotificationService } from '../../../../../platform/notification/common/notification.js';\nimport { registerActiveInstanceAction, registerActiveXtermAction } from '../../../terminal/browser/terminalActions.js';\nimport { TerminalCommandId } from '../../../terminal/common/terminal.js';\nimport { localize2 } from '../../../../../nls.js';\nimport { ContextKeyExpr } from '../../../../../platform/contextkey/common/contextkey.js';\nimport { TerminalContextKeys } from '../../../terminal/common/terminalContextKey.js';\nimport { KeyCode, KeyMod } from '../../../../../base/common/keyCodes.js';\nimport { KeybindingWeight } from '../../../../../platform/keybinding/common/keybindingsRegistry.js';\nimport { terminalStrings } from '../../../terminal/common/terminalStrings.js';\nimport { isString } from '../../../../../base/common/types.js';\n\n// #region Terminal Contributions\n\nexport class TerminalClipboardContribution extends Disposable implements ITerminalContribution {\n\tstatic readonly ID = 'terminal.clipboard';\n\n\tstatic get(instance: ITerminalInstance | IDetachedTerminalInstance): TerminalClipboardContribution | null {\n\t\treturn instance.getContribution<TerminalClipboardContribution>(TerminalClipboardContribution.ID);\n\t}\n\n\tprivate _xterm: IXtermTerminal & { raw: RawXtermTerminal } | undefined;\n\n\tprivate _overrideCopySelection: boolean | undefined = undefined;\n\n\tprivate readonly _onWillPaste = this._register(new Emitter<string>());\n\treadonly onWillPaste = this._onWillPaste.event;\n\tprivate readonly _onDidPaste = this._register(new Emitter<string>());\n\treadonly onDidPaste = this._onDidPaste.event;\n\n\tconstructor(\n\t\tprivate readonly _ctx: ITerminalContributionContext | IDetachedCompatibleTerminalContributionContext,\n\t\t@IClipboardService private readonly _clipboardService: IClipboardService,\n\t\t@IConfigurationService private readonly _configurationService: IConfigurationService,\n\t\t@IInstantiationService private readonly _instantiationService: IInstantiationService,\n\t\t@INotificationService private readonly _notificationService: INotificationService,\n\t\t@ITerminalConfigurationService private readonly _terminalConfigurationService: ITerminalConfigurationService,\n\t) {\n\t\tsuper();\n\t}\n\n\txtermReady(xterm: IXtermTerminal & { raw: RawXtermTerminal }): void {\n\t\tthis._xterm = xterm;\n\t\t// TODO: This should be a different event on xterm, copying html should not share the requesting run command event\n\t\tthis._register(xterm.onDidRequestCopyAsHtml(e => this.copySelection(true, e.command)));\n\t\tthis._register(xterm.raw.onSelectionChange(async () => {\n\t\t\tif (this._configurationService.getValue(TerminalSettingId.CopyOnSelection)) {\n\t\t\t\tif (this._overrideCopySelection === false) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tif (this._ctx.instance.hasSelection()) {\n\t\t\t\t\tawait this.copySelection();\n\t\t\t\t}\n\t\t\t}\n\t\t}));\n\t}\n\n\tasync copySelection(asHtml?: boolean, command?: ITerminalCommand): Promise<void> {\n\t\t// TODO: Confirm this is fine that it's no longer awaiting xterm promise\n\t\tthis._xterm?.copySelection(asHtml, command);\n\t}\n\n\t/**\n\t * Focuses and pastes the contents of the clipboard into the terminal instance.\n\t */\n\tasync paste(): Promise<void> {\n\t\tawait this._paste(await this._clipboardService.readText());\n\t}\n\n\t/**\n\t * Focuses and pastes the contents of the selection clipboard into the terminal instance.\n\t */\n\tasync pasteSelection(): Promise<void> {\n\t\tawait this._paste(await this._clipboardService.readText('selection'));\n\t}\n\n\tprivate async _paste(value: string): Promise<void> {\n\t\tif (!this._xterm) {\n\t\t\treturn;\n\t\t}\n\n\t\tlet currentText = value;\n\t\tconst shouldPasteText = await this._instantiationService.invokeFunction(shouldPasteTerminalText, currentText, this._xterm?.raw.modes.bracketedPasteMode);\n\t\tif (!shouldPasteText) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (typeof shouldPasteText === 'object') {\n\t\t\tcurrentText = shouldPasteText.modifiedText;\n\t\t}\n\n\t\tthis._ctx.instance.focus();\n\n\t\tthis._onWillPaste.fire(currentText);\n\t\tthis._xterm.raw.paste(currentText);\n\t\tthis._onDidPaste.fire(currentText);\n\t}\n\n\tasync handleMouseEvent(event: MouseEvent): Promise<{ handled: boolean } | void> {\n\t\tswitch (event.button) {\n\t\t\tcase 1: { // Middle click\n\t\t\t\tif (this._terminalConfigurationService.config.middleClickBehavior === 'paste') {\n\t\t\t\t\tthis.paste();\n\t\t\t\t\treturn { handled: true };\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcase 2: { // Right click\n\t\t\t\t// Ignore shift click as it forces the context menu\n\t\t\t\tif (event.shiftKey) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tconst rightClickBehavior = this._terminalConfigurationService.config.rightClickBehavior;\n\t\t\t\tif (rightClickBehavior !== 'copyPaste' && rightClickBehavior !== 'paste') {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tif (rightClickBehavior === 'copyPaste' && this._ctx.instance.hasSelection()) {\n\t\t\t\t\tawait this.copySelection();\n\t\t\t\t\tthis._ctx.instance.clearSelection();\n\t\t\t\t} else {\n\t\t\t\t\tif (BrowserFeatures.clipboard.readText) {\n\t\t\t\t\t\tthis.paste();\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis._notificationService.info(`This browser doesn't support the clipboard.readText API needed to trigger a paste, try ${isMacintosh ? 'âŒ˜' : 'Ctrl'}+V instead.`);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t// Clear selection after all click event bubbling is finished on Mac to prevent\n\t\t\t\t// right-click selecting a word which is seemed cannot be disabled. There is a\n\t\t\t\t// flicker when pasting but this appears to give the best experience if the\n\t\t\t\t// setting is enabled.\n\t\t\t\tif (isMacintosh) {\n\t\t\t\t\tsetTimeout(() => this._ctx.instance.clearSelection(), 0);\n\t\t\t\t}\n\t\t\t\treturn { handled: true };\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Override the copy on selection feature with a custom value.\n\t * @param value Whether to enable copySelection.\n\t */\n\toverrideCopyOnSelection(value: boolean): IDisposable {\n\t\tif (this._overrideCopySelection !== undefined) {\n\t\t\tthrow new Error('Cannot set a copy on selection override multiple times');\n\t\t}\n\t\tthis._overrideCopySelection = value;\n\t\treturn toDisposable(() => this._overrideCopySelection = undefined);\n\t}\n}\n\nregisterTerminalContribution(TerminalClipboardContribution.ID, TerminalClipboardContribution, false);\n\n// #endregion\n\n// #region Actions\n\nconst terminalAvailableWhenClause = ContextKeyExpr.or(TerminalContextKeys.processSupported, TerminalContextKeys.terminalHasBeenCreated);\n\n// TODO: Move these commands into this terminalContrib/\nregisterActiveInstanceAction({\n\tid: TerminalCommandId.CopyLastCommand,\n\ttitle: localize2('workbench.action.terminal.copyLastCommand', \"Copy Last Command\"),\n\tprecondition: terminalAvailableWhenClause,\n\trun: async (instance, c, accessor) => {\n\t\tconst clipboardService = accessor.get(IClipboardService);\n\t\tconst commands = instance.capabilities.get(TerminalCapability.CommandDetection)?.commands;\n\t\tif (!commands || commands.length === 0) {\n\t\t\treturn;\n\t\t}\n\t\tconst command = commands[commands.length - 1];\n\t\tif (!command.command) {\n\t\t\treturn;\n\t\t}\n\t\tawait clipboardService.writeText(command.command);\n\t}\n});\n\nregisterActiveInstanceAction({\n\tid: TerminalCommandId.CopyLastCommandOutput,\n\ttitle: localize2('workbench.action.terminal.copyLastCommandOutput', \"Copy Last Command Output\"),\n\tprecondition: terminalAvailableWhenClause,\n\trun: async (instance, c, accessor) => {\n\t\tconst clipboardService = accessor.get(IClipboardService);\n\t\tconst commands = instance.capabilities.get(TerminalCapability.CommandDetection)?.commands;\n\t\tif (!commands || commands.length === 0) {\n\t\t\treturn;\n\t\t}\n\t\tconst command = commands[commands.length - 1];\n\t\tif (!command?.hasOutput()) {\n\t\t\treturn;\n\t\t}\n\t\tconst output = command.getOutput();\n\t\tif (isString(output)) {\n\t\t\tawait clipboardService.writeText(output);\n\t\t}\n\t}\n});\n\nregisterActiveInstanceAction({\n\tid: TerminalCommandId.CopyLastCommandAndLastCommandOutput,\n\ttitle: localize2('workbench.action.terminal.copyLastCommandAndOutput', \"Copy Last Command and Output\"),\n\tprecondition: terminalAvailableWhenClause,\n\trun: async (instance, c, accessor) => {\n\t\tconst clipboardService = accessor.get(IClipboardService);\n\t\tconst commands = instance.capabilities.get(TerminalCapability.CommandDetection)?.commands;\n\t\tif (!commands || commands.length === 0) {\n\t\t\treturn;\n\t\t}\n\t\tconst command = commands[commands.length - 1];\n\t\tif (!command?.hasOutput()) {\n\t\t\treturn;\n\t\t}\n\t\tconst output = command.getOutput();\n\t\tif (isString(output)) {\n\t\t\tawait clipboardService.writeText(`${command.command !== '' ? command.command + '\\n' : ''}${output}`);\n\t\t}\n\t}\n});\n\n// Some commands depend on platform features\nif (BrowserFeatures.clipboard.writeText) {\n\tregisterActiveXtermAction({\n\t\tid: TerminalCommandId.CopySelection,\n\t\ttitle: localize2('workbench.action.terminal.copySelection', 'Copy Selection'),\n\t\t// TODO: Why is copy still showing up when text isn't selected?\n\t\tprecondition: ContextKeyExpr.or(TerminalContextKeys.textSelectedInFocused, ContextKeyExpr.and(terminalAvailableWhenClause, TerminalContextKeys.textSelected)),\n\t\tkeybinding: [{\n\t\t\tprimary: KeyMod.CtrlCmd | KeyMod.Shift | KeyCode.KeyC,\n\t\t\tmac: { primary: KeyMod.CtrlCmd | KeyCode.KeyC },\n\t\t\tweight: KeybindingWeight.WorkbenchContrib,\n\t\t\twhen: ContextKeyExpr.or(\n\t\t\t\tContextKeyExpr.and(TerminalContextKeys.textSelected, TerminalContextKeys.focus),\n\t\t\t\tTerminalContextKeys.textSelectedInFocused,\n\t\t\t)\n\t\t}],\n\t\trun: (activeInstance) => activeInstance.copySelection()\n\t});\n\n\tregisterActiveXtermAction({\n\t\tid: TerminalCommandId.CopyAndClearSelection,\n\t\ttitle: localize2('workbench.action.terminal.copyAndClearSelection', 'Copy and Clear Selection'),\n\t\tprecondition: ContextKeyExpr.or(TerminalContextKeys.textSelectedInFocused, ContextKeyExpr.and(terminalAvailableWhenClause, TerminalContextKeys.textSelected)),\n\t\tkeybinding: [{\n\t\t\twin: { primary: KeyMod.CtrlCmd | KeyCode.KeyC },\n\t\t\tweight: KeybindingWeight.WorkbenchContrib,\n\t\t\twhen: ContextKeyExpr.or(\n\t\t\t\tContextKeyExpr.and(TerminalContextKeys.textSelected, TerminalContextKeys.focus),\n\t\t\t\tTerminalContextKeys.textSelectedInFocused,\n\t\t\t)\n\t\t}],\n\t\trun: async (xterm) => {\n\t\t\tawait xterm.copySelection();\n\t\t\txterm.clearSelection();\n\t\t}\n\t});\n\n\tregisterActiveXtermAction({\n\t\tid: TerminalCommandId.CopySelectionAsHtml,\n\t\ttitle: localize2('workbench.action.terminal.copySelectionAsHtml', 'Copy Selection as HTML'),\n\t\tf1: true,\n\t\tcategory: terminalStrings.actionCategory,\n\t\tprecondition: ContextKeyExpr.or(TerminalContextKeys.textSelectedInFocused, ContextKeyExpr.and(terminalAvailableWhenClause, TerminalContextKeys.textSelected)),\n\t\trun: (xterm) => xterm.copySelection(true)\n\t});\n}\n\nif (BrowserFeatures.clipboard.readText) {\n\tregisterActiveInstanceAction({\n\t\tid: TerminalCommandId.Paste,\n\t\ttitle: localize2('workbench.action.terminal.paste', 'Paste into Active Terminal'),\n\t\tprecondition: terminalAvailableWhenClause,\n\t\tkeybinding: [{\n\t\t\tprimary: KeyMod.CtrlCmd | KeyCode.KeyV,\n\t\t\twin: { primary: KeyMod.CtrlCmd | KeyCode.KeyV, secondary: [KeyMod.CtrlCmd | KeyMod.Shift | KeyCode.KeyV] },\n\t\t\tlinux: { primary: KeyMod.CtrlCmd | KeyMod.Shift | KeyCode.KeyV },\n\t\t\tweight: KeybindingWeight.WorkbenchContrib,\n\t\t\twhen: TerminalContextKeys.focus\n\t\t}],\n\t\trun: (activeInstance) => TerminalClipboardContribution.get(activeInstance)?.paste()\n\t});\n}\n\nif (BrowserFeatures.clipboard.readText && isLinux) {\n\tregisterActiveInstanceAction({\n\t\tid: TerminalCommandId.PasteSelection,\n\t\ttitle: localize2('workbench.action.terminal.pasteSelection', 'Paste Selection into Active Terminal'),\n\t\tprecondition: terminalAvailableWhenClause,\n\t\tkeybinding: [{\n\t\t\tlinux: { primary: KeyMod.Shift | KeyCode.Insert },\n\t\t\tweight: KeybindingWeight.WorkbenchContrib,\n\t\t\twhen: TerminalContextKeys.focus\n\t\t}],\n\t\trun: (activeInstance) => TerminalClipboardContribution.get(activeInstance)?.pasteSelection()\n\t});\n}\n\n// #endregion\n"]}