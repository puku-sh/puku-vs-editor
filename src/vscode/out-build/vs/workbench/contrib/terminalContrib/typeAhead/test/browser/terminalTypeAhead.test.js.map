{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/contrib/terminalContrib/typeAhead/test/browser/terminalTypeAhead.test.ts","vs/workbench/contrib/terminalContrib/typeAhead/test/browser/terminalTypeAhead.test.ts"],"names":[],"mappings":"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","file":"terminalTypeAhead.test.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport assert from 'assert';\nimport type { IBuffer, Terminal } from '@xterm/xterm';\nimport { SinonStub, stub, useFakeTimers } from 'sinon';\nimport { Emitter } from '../../../../../../base/common/event.js';\nimport { CharPredictState, IPrediction, PredictionStats, TypeAheadAddon } from '../../browser/terminalTypeAheadAddon.js';\nimport { IBeforeProcessDataEvent, ITerminalProcessManager } from '../../../../terminal/common/terminal.js';\nimport { ITelemetryService } from '../../../../../../platform/telemetry/common/telemetry.js';\nimport { TestConfigurationService } from '../../../../../../platform/configuration/test/common/testConfigurationService.js';\nimport { ensureNoDisposablesAreLeakedInTestSuite } from '../../../../../../base/test/common/utils.js';\nimport { DisposableStore } from '../../../../../../base/common/lifecycle.js';\nimport { DEFAULT_LOCAL_ECHO_EXCLUDE, type ITerminalTypeAheadConfiguration } from '../../common/terminalTypeAheadConfiguration.js';\nimport { isString } from '../../../../../../base/common/types.js';\n\nconst CSI = `\\x1b[`;\n\nconst enum CursorMoveDirection {\n\tBack = 'D',\n\tForwards = 'C',\n}\n\nsuite('Workbench - Terminal Typeahead', () => {\n\tconst ds = ensureNoDisposablesAreLeakedInTestSuite();\n\n\tsuite('PredictionStats', () => {\n\t\tlet stats: PredictionStats;\n\t\tlet add: Emitter<IPrediction>;\n\t\tlet succeed: Emitter<IPrediction>;\n\t\tlet fail: Emitter<IPrediction>;\n\n\t\tsetup(() => {\n\t\t\tadd = ds.add(new Emitter<IPrediction>());\n\t\t\tsucceed = ds.add(new Emitter<IPrediction>());\n\t\t\tfail = ds.add(new Emitter<IPrediction>());\n\n\t\t\t// eslint-disable-next-line local/code-no-any-casts\n\t\t\tstats = ds.add(new PredictionStats({\n\t\t\t\tonPredictionAdded: add.event,\n\t\t\t\tonPredictionSucceeded: succeed.event,\n\t\t\t\tonPredictionFailed: fail.event,\n\t\t\t} as any));\n\t\t});\n\n\t\ttest('creates sane data', () => {\n\t\t\tconst stubs = createPredictionStubs(5);\n\t\t\tconst clock = useFakeTimers();\n\t\t\ttry {\n\t\t\t\tfor (const s of stubs) { add.fire(s); }\n\n\t\t\t\tfor (let i = 0; i < stubs.length; i++) {\n\t\t\t\t\tclock.tick(100);\n\t\t\t\t\t(i % 2 ? fail : succeed).fire(stubs[i]);\n\t\t\t\t}\n\n\t\t\t\tassert.strictEqual(stats.accuracy, 3 / 5);\n\t\t\t\tassert.strictEqual(stats.sampleSize, 5);\n\t\t\t\tassert.deepStrictEqual(stats.latency, {\n\t\t\t\t\tcount: 3,\n\t\t\t\t\tmin: 100,\n\t\t\t\t\tmax: 500,\n\t\t\t\t\tmedian: 300\n\t\t\t\t});\n\t\t\t} finally {\n\t\t\t\tclock.restore();\n\t\t\t}\n\t\t});\n\n\t\ttest('circular buffer', () => {\n\t\t\tconst bufferSize = 24;\n\t\t\tconst stubs = createPredictionStubs(bufferSize * 2);\n\n\t\t\tfor (const s of stubs.slice(0, bufferSize)) { add.fire(s); succeed.fire(s); }\n\t\t\tassert.strictEqual(stats.accuracy, 1);\n\n\t\t\tfor (const s of stubs.slice(bufferSize, bufferSize * 3 / 2)) { add.fire(s); fail.fire(s); }\n\t\t\tassert.strictEqual(stats.accuracy, 0.5);\n\n\t\t\tfor (const s of stubs.slice(bufferSize * 3 / 2)) { add.fire(s); fail.fire(s); }\n\t\t\tassert.strictEqual(stats.accuracy, 0);\n\t\t});\n\t});\n\n\tsuite('timeline', () => {\n\t\tlet onBeforeProcessData: Emitter<IBeforeProcessDataEvent>;\n\t\tlet publicLog: SinonStub;\n\t\tlet config: ITerminalTypeAheadConfiguration;\n\t\tlet addon: TestTypeAheadAddon;\n\n\t\tconst predictedHelloo = [\n\t\t\t`${CSI}?25l`, // hide cursor\n\t\t\t`${CSI}2;7H`, // move cursor\n\t\t\t'o', // new character\n\t\t\t`${CSI}2;8H`, // place cursor back at end of line\n\t\t\t`${CSI}?25h`, // show cursor\n\t\t].join('');\n\n\t\tconst expectProcessed = (input: string, output: string) => {\n\t\t\tconst evt = { data: input };\n\t\t\tonBeforeProcessData.fire(evt);\n\t\t\tassert.strictEqual(JSON.stringify(evt.data), JSON.stringify(output));\n\t\t};\n\n\t\tsetup(() => {\n\t\t\tonBeforeProcessData = ds.add(new Emitter<IBeforeProcessDataEvent>());\n\t\t\tconfig = upcastPartial<ITerminalTypeAheadConfiguration>({\n\t\t\t\tlocalEchoStyle: 'italic',\n\t\t\t\tlocalEchoLatencyThreshold: 0,\n\t\t\t\tlocalEchoExcludePrograms: DEFAULT_LOCAL_ECHO_EXCLUDE,\n\t\t\t});\n\t\t\tpublicLog = stub();\n\t\t\taddon = new TestTypeAheadAddon(\n\t\t\t\tupcastPartial<ITerminalProcessManager>({ onBeforeProcessData: onBeforeProcessData.event }),\n\t\t\t\tnew TestConfigurationService({ terminal: { integrated: { ...config } } }),\n\t\t\t\tupcastPartial<ITelemetryService>({ publicLog })\n\t\t\t);\n\t\t\taddon.unlockMakingPredictions();\n\t\t});\n\n\t\tteardown(() => {\n\t\t\taddon.dispose();\n\t\t});\n\n\t\ttest('predicts a single character', () => {\n\t\t\tconst t = ds.add(createMockTerminal({ lines: ['hello|'] }));\n\t\t\taddon.activate(t.terminal);\n\t\t\tt.onData('o');\n\t\t\tt.expectWritten(`${CSI}3mo${CSI}23m`);\n\t\t});\n\n\t\ttest('validates character prediction', () => {\n\t\t\tconst t = ds.add(createMockTerminal({ lines: ['hello|'] }));\n\t\t\taddon.activate(t.terminal);\n\t\t\tt.onData('o');\n\t\t\texpectProcessed('o', predictedHelloo);\n\t\t\tassert.strictEqual(addon.stats?.accuracy, 1);\n\t\t});\n\n\t\ttest('validates zsh prediction (#112842)', () => {\n\t\t\tconst t = ds.add(createMockTerminal({ lines: ['hello|'] }));\n\t\t\taddon.activate(t.terminal);\n\t\t\tt.onData('o');\n\t\t\texpectProcessed('o', predictedHelloo);\n\n\t\t\tt.onData('x');\n\t\t\texpectProcessed('\\box', [\n\t\t\t\t`${CSI}?25l`, // hide cursor\n\t\t\t\t`${CSI}2;8H`, // move cursor\n\t\t\t\t'\\box', // new data\n\t\t\t\t`${CSI}2;9H`, // place cursor back at end of line\n\t\t\t\t`${CSI}?25h`, // show cursor\n\t\t\t].join(''));\n\t\t\tassert.strictEqual(addon.stats?.accuracy, 1);\n\t\t});\n\n\t\ttest('does not validate zsh prediction on differing lookbehindn (#112842)', () => {\n\t\t\tconst t = ds.add(createMockTerminal({ lines: ['hello|'] }));\n\t\t\taddon.activate(t.terminal);\n\t\t\tt.onData('o');\n\t\t\texpectProcessed('o', predictedHelloo);\n\n\t\t\tt.onData('x');\n\t\t\texpectProcessed('\\bqx', [\n\t\t\t\t`${CSI}?25l`, // hide cursor\n\t\t\t\t`${CSI}2;8H`, // move cursor cursor\n\t\t\t\t`${CSI}X`, // delete character\n\t\t\t\t`${CSI}0m`, // reset style\n\t\t\t\t'\\bqx', // new data\n\t\t\t\t`${CSI}?25h`, // show cursor\n\t\t\t].join(''));\n\t\t\tassert.strictEqual(addon.stats?.accuracy, 0.5);\n\t\t});\n\n\t\ttest('rolls back character prediction', () => {\n\t\t\tconst t = ds.add(createMockTerminal({ lines: ['hello|'] }));\n\t\t\taddon.activate(t.terminal);\n\t\t\tt.onData('o');\n\n\t\t\texpectProcessed('q', [\n\t\t\t\t`${CSI}?25l`, // hide cursor\n\t\t\t\t`${CSI}2;7H`, // move cursor cursor\n\t\t\t\t`${CSI}X`, // delete character\n\t\t\t\t`${CSI}0m`, // reset style\n\t\t\t\t'q', // new character\n\t\t\t\t`${CSI}?25h`, // show cursor\n\t\t\t].join(''));\n\t\t\tassert.strictEqual(addon.stats?.accuracy, 0);\n\t\t});\n\n\t\ttest('handles left arrow when we hit the boundary', () => {\n\t\t\tconst t = ds.add(createMockTerminal({ lines: ['|'] }));\n\t\t\taddon.activate(t.terminal);\n\t\t\taddon.unlockNavigating();\n\n\t\t\tconst cursorXBefore = addon.physicalCursor(t.terminal.buffer.active)?.x!;\n\t\t\tt.onData(`${CSI}${CursorMoveDirection.Back}`);\n\t\t\tt.expectWritten('');\n\n\t\t\t// Trigger rollback because we don't expect this data\n\t\t\tonBeforeProcessData.fire({ data: 'xy' });\n\n\t\t\tassert.strictEqual(\n\t\t\t\taddon.physicalCursor(t.terminal.buffer.active)?.x,\n\t\t\t\t// The cursor should not have changed because we've hit the\n\t\t\t\t// boundary (start of prompt)\n\t\t\t\tcursorXBefore);\n\t\t});\n\n\t\ttest('handles right arrow when we hit the boundary', () => {\n\t\t\tconst t = ds.add(createMockTerminal({ lines: ['|'] }));\n\t\t\taddon.activate(t.terminal);\n\t\t\taddon.unlockNavigating();\n\n\t\t\tconst cursorXBefore = addon.physicalCursor(t.terminal.buffer.active)?.x!;\n\t\t\tt.onData(`${CSI}${CursorMoveDirection.Forwards}`);\n\t\t\tt.expectWritten('');\n\n\t\t\t// Trigger rollback because we don't expect this data\n\t\t\tonBeforeProcessData.fire({ data: 'xy' });\n\n\t\t\tassert.strictEqual(\n\t\t\t\taddon.physicalCursor(t.terminal.buffer.active)?.x,\n\t\t\t\t// The cursor should not have changed because we've hit the\n\t\t\t\t// boundary (end of prompt)\n\t\t\t\tcursorXBefore);\n\t\t});\n\n\t\ttest('internal cursor state is reset when all predictions are undone', () => {\n\t\t\tconst t = ds.add(createMockTerminal({ lines: ['|'] }));\n\t\t\taddon.activate(t.terminal);\n\t\t\taddon.unlockNavigating();\n\n\t\t\tconst cursorXBefore = addon.physicalCursor(t.terminal.buffer.active)?.x!;\n\t\t\tt.onData(`${CSI}${CursorMoveDirection.Back}`);\n\t\t\tt.expectWritten('');\n\t\t\taddon.undoAllPredictions();\n\n\t\t\tassert.strictEqual(\n\t\t\t\taddon.physicalCursor(t.terminal.buffer.active)?.x,\n\t\t\t\t// The cursor should not have changed because we've hit the\n\t\t\t\t// boundary (start of prompt)\n\t\t\t\tcursorXBefore);\n\t\t});\n\n\t\ttest('restores cursor graphics mode', () => {\n\t\t\tconst t = ds.add(createMockTerminal({\n\t\t\t\tlines: ['hello|'],\n\t\t\t\tcursorAttrs: { isAttributeDefault: false, isBold: true, isFgPalette: true, getFgColor: 1 },\n\t\t\t}));\n\t\t\taddon.activate(t.terminal);\n\t\t\tt.onData('o');\n\n\t\t\texpectProcessed('q', [\n\t\t\t\t`${CSI}?25l`, // hide cursor\n\t\t\t\t`${CSI}2;7H`, // move cursor cursor\n\t\t\t\t`${CSI}X`, // delete character\n\t\t\t\t`${CSI}1;38;5;1m`, // reset style\n\t\t\t\t'q', // new character\n\t\t\t\t`${CSI}?25h`, // show cursor\n\t\t\t].join(''));\n\t\t\tassert.strictEqual(addon.stats?.accuracy, 0);\n\t\t});\n\n\t\ttest('validates against and applies graphics mode on predicted', () => {\n\t\t\tconst t = ds.add(createMockTerminal({ lines: ['hello|'] }));\n\t\t\taddon.activate(t.terminal);\n\t\t\tt.onData('o');\n\t\t\texpectProcessed(`${CSI}4mo`, [\n\t\t\t\t`${CSI}?25l`, // hide cursor\n\t\t\t\t`${CSI}2;7H`, // move cursor\n\t\t\t\t`${CSI}4m`, // new PTY's style\n\t\t\t\t'o', // new character\n\t\t\t\t`${CSI}2;8H`, // place cursor back at end of line\n\t\t\t\t`${CSI}?25h`, // show cursor\n\t\t\t].join(''));\n\t\t\tassert.strictEqual(addon.stats?.accuracy, 1);\n\t\t});\n\n\t\ttest('ignores cursor hides or shows', () => {\n\t\t\tconst t = ds.add(createMockTerminal({ lines: ['hello|'] }));\n\t\t\taddon.activate(t.terminal);\n\t\t\tt.onData('o');\n\t\t\texpectProcessed(`${CSI}?25lo${CSI}?25h`, [\n\t\t\t\t`${CSI}?25l`, // hide cursor from PTY\n\t\t\t\t`${CSI}?25l`, // hide cursor\n\t\t\t\t`${CSI}2;7H`, // move cursor\n\t\t\t\t'o', // new character\n\t\t\t\t`${CSI}?25h`, // show cursor from PTY\n\t\t\t\t`${CSI}2;8H`, // place cursor back at end of line\n\t\t\t\t`${CSI}?25h`, // show cursor\n\t\t\t].join(''));\n\t\t\tassert.strictEqual(addon.stats?.accuracy, 1);\n\t\t});\n\n\t\ttest('matches backspace at EOL (bash style)', () => {\n\t\t\tconst t = ds.add(createMockTerminal({ lines: ['hello|'] }));\n\t\t\taddon.activate(t.terminal);\n\t\t\tt.onData('\\x7F');\n\t\t\texpectProcessed(`\\b${CSI}K`, `\\b${CSI}K`);\n\t\t\tassert.strictEqual(addon.stats?.accuracy, 1);\n\t\t});\n\n\t\ttest('matches backspace at EOL (zsh style)', () => {\n\t\t\tconst t = ds.add(createMockTerminal({ lines: ['hello|'] }));\n\t\t\taddon.activate(t.terminal);\n\t\t\tt.onData('\\x7F');\n\t\t\texpectProcessed('\\b \\b', '\\b \\b');\n\t\t\tassert.strictEqual(addon.stats?.accuracy, 1);\n\t\t});\n\n\t\ttest('gradually matches backspace', () => {\n\t\t\tconst t = ds.add(createMockTerminal({ lines: ['hello|'] }));\n\t\t\taddon.activate(t.terminal);\n\t\t\tt.onData('\\x7F');\n\t\t\texpectProcessed('\\b', '');\n\t\t\texpectProcessed(' \\b', '\\b \\b');\n\t\t\tassert.strictEqual(addon.stats?.accuracy, 1);\n\t\t});\n\n\t\ttest('restores old character after invalid backspace', () => {\n\t\t\tconst t = ds.add(createMockTerminal({ lines: ['hel|lo'] }));\n\t\t\taddon.activate(t.terminal);\n\t\t\taddon.unlockNavigating();\n\t\t\tt.onData('\\x7F');\n\t\t\tt.expectWritten(`${CSI}2;4H${CSI}X`);\n\t\t\texpectProcessed('x', `${CSI}?25l${CSI}0ml${CSI}2;5H${CSI}0mx${CSI}?25h`);\n\t\t\tassert.strictEqual(addon.stats?.accuracy, 0);\n\t\t});\n\n\t\ttest('waits for validation before deleting to left of cursor', () => {\n\t\t\tconst t = ds.add(createMockTerminal({ lines: ['hello|'] }));\n\t\t\taddon.activate(t.terminal);\n\n\t\t\t// initially should not backspace (until the server confirms it)\n\t\t\tt.onData('\\x7F');\n\t\t\tt.expectWritten('');\n\t\t\texpectProcessed('\\b \\b', '\\b \\b');\n\t\t\tt.cursor.x--;\n\n\t\t\t// enter input on the column...\n\t\t\tt.onData('o');\n\t\t\tonBeforeProcessData.fire({ data: 'o' });\n\t\t\tt.cursor.x++;\n\t\t\tt.clearWritten();\n\n\t\t\t// now that the column is 'unlocked', we should be able to predict backspace on it\n\t\t\tt.onData('\\x7F');\n\t\t\tt.expectWritten(`${CSI}2;6H${CSI}X`);\n\t\t});\n\n\t\ttest('waits for first valid prediction on a line', () => {\n\t\t\tconst t = ds.add(createMockTerminal({ lines: ['hello|'] }));\n\t\t\taddon.lockMakingPredictions();\n\t\t\taddon.activate(t.terminal);\n\n\t\t\tt.onData('o');\n\t\t\tt.expectWritten('');\n\t\t\texpectProcessed('o', 'o');\n\n\t\t\tt.onData('o');\n\t\t\tt.expectWritten(`${CSI}3mo${CSI}23m`);\n\t\t});\n\n\t\ttest('disables on title change', () => {\n\t\t\tconst t = ds.add(createMockTerminal({ lines: ['hello|'] }));\n\t\t\taddon.activate(t.terminal);\n\n\t\t\taddon.reevaluateNow();\n\t\t\tassert.strictEqual(addon.isShowing, true, 'expected to show initially');\n\n\t\t\tt.onTitleChange.fire('foo - VIM.exe');\n\t\t\taddon.reevaluateNow();\n\t\t\tassert.strictEqual(addon.isShowing, false, 'expected to hide when vim is open');\n\n\t\t\tt.onTitleChange.fire('foo - git.exe');\n\t\t\taddon.reevaluateNow();\n\t\t\tassert.strictEqual(addon.isShowing, true, 'expected to show again after vim closed');\n\t\t});\n\n\t\ttest('adds line wrap prediction even if behind a boundary', () => {\n\t\t\tconst t = ds.add(createMockTerminal({ lines: ['hello|'] }));\n\t\t\taddon.lockMakingPredictions();\n\t\t\taddon.activate(t.terminal);\n\n\t\t\tt.onData('hi'.repeat(50));\n\t\t\tt.expectWritten('');\n\t\t\texpectProcessed('hi', [\n\t\t\t\t`${CSI}?25l`, // hide cursor\n\t\t\t\t'hi', // this greeting characters\n\t\t\t\t...new Array(36).fill(`${CSI}3mh${CSI}23m${CSI}3mi${CSI}23m`), // rest of the greetings that fit on this line\n\t\t\t\t`${CSI}2;81H`, // move to end of line\n\t\t\t\t`${CSI}?25h`\n\t\t\t].join(''));\n\t\t});\n\t});\n});\n\nclass TestTypeAheadAddon extends TypeAheadAddon {\n\tunlockMakingPredictions() {\n\t\tthis._lastRow = { y: 1, startingX: 100, endingX: 100, charState: CharPredictState.Validated };\n\t}\n\n\tlockMakingPredictions() {\n\t\tthis._lastRow = undefined;\n\t}\n\n\tunlockNavigating() {\n\t\tthis._lastRow = { y: 1, startingX: 1, endingX: 1, charState: CharPredictState.Validated };\n\t}\n\n\treevaluateNow() {\n\t\tthis._reevaluatePredictorStateNow(this.stats!, this._timeline!);\n\t}\n\n\tget isShowing() {\n\t\treturn !!this._timeline?.isShowingPredictions;\n\t}\n\n\tundoAllPredictions() {\n\t\tthis._timeline?.undoAllPredictions();\n\t}\n\n\tphysicalCursor(buffer: IBuffer) {\n\t\treturn this._timeline?.physicalCursor(buffer);\n\t}\n\n\ttentativeCursor(buffer: IBuffer) {\n\t\treturn this._timeline?.tentativeCursor(buffer);\n\t}\n}\n\nfunction upcastPartial<T>(v: Partial<T>): T {\n\treturn v as T;\n}\n\nfunction createPredictionStubs(n: number) {\n\treturn new Array(n).fill(0).map(stubPrediction);\n}\n\nfunction stubPrediction(): IPrediction {\n\treturn {\n\t\tapply: () => '',\n\t\trollback: () => '',\n\t\tmatches: () => 0,\n\t\trollForwards: () => '',\n\t};\n}\n\nfunction createMockTerminal({ lines, cursorAttrs }: {\n\tlines: string[];\n\tcursorAttrs?: any;\n}) {\n\tconst ds = new DisposableStore();\n\tconst written: string[] = [];\n\tconst cursor = { y: 1, x: 1 };\n\tconst onTitleChange = ds.add(new Emitter<string>());\n\tconst onData = ds.add(new Emitter<string>());\n\tconst csiEmitter = ds.add(new Emitter<number[]>());\n\n\tfor (let y = 0; y < lines.length; y++) {\n\t\tconst line = lines[y];\n\t\tif (line.includes('|')) {\n\t\t\tcursor.y = y + 1;\n\t\t\tcursor.x = line.indexOf('|') + 1;\n\t\t\tlines[y] = line.replace('|', ''); // CodeQL [SM02383] replacing the first occurrence is intended\n\t\t\tbreak;\n\t\t}\n\t}\n\n\treturn {\n\t\twritten,\n\t\tcursor,\n\t\texpectWritten: (s: string) => {\n\t\t\tassert.strictEqual(JSON.stringify(written.join('')), JSON.stringify(s));\n\t\t\twritten.splice(0, written.length);\n\t\t},\n\t\tclearWritten: () => written.splice(0, written.length),\n\t\tonData: (s: string) => onData.fire(s),\n\t\tcsiEmitter,\n\t\tonTitleChange,\n\t\tdispose: () => ds.dispose(),\n\t\tterminal: {\n\t\t\tcols: 80,\n\t\t\trows: 5,\n\t\t\tonResize: new Emitter<void>().event,\n\t\t\tonData: onData.event,\n\t\t\tonTitleChange: onTitleChange.event,\n\t\t\tparser: {\n\t\t\t\tregisterCsiHandler(_: unknown, callback: () => void) {\n\t\t\t\t\tds.add(csiEmitter.event(callback));\n\t\t\t\t},\n\t\t\t},\n\t\t\twrite(line: string) {\n\t\t\t\twritten.push(line);\n\t\t\t},\n\t\t\t_core: {\n\t\t\t\t_inputHandler: {\n\t\t\t\t\t_curAttrData: mockCell('', cursorAttrs)\n\t\t\t\t},\n\t\t\t\twriteSync() {\n\n\t\t\t\t}\n\t\t\t},\n\t\t\tbuffer: {\n\t\t\t\tactive: {\n\t\t\t\t\ttype: 'normal',\n\t\t\t\t\tbaseY: 0,\n\t\t\t\t\tget cursorY() { return cursor.y; },\n\t\t\t\t\tget cursorX() { return cursor.x; },\n\t\t\t\t\tgetLine(y: number) {\n\t\t\t\t\t\tconst s = lines[y - 1] || '';\n\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\tlength: s.length,\n\t\t\t\t\t\t\tgetCell: (x: number) => mockCell(s[x - 1] || ''),\n\t\t\t\t\t\t\ttranslateToString: (trim: boolean, start = 0, end = s.length) => {\n\t\t\t\t\t\t\t\tconst out = s.slice(start, end);\n\t\t\t\t\t\t\t\treturn trim ? out.trimRight() : out;\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t};\n\t\t\t\t\t},\n\t\t\t\t}\n\t\t\t}\n\t\t} as unknown as Terminal\n\t};\n}\n\nfunction mockCell(char: string, attrs: { [key: string]: unknown } = {}) {\n\treturn new Proxy({}, {\n\t\tget(_, prop) {\n\t\t\tif (isString(prop) && attrs.hasOwnProperty(prop)) {\n\t\t\t\treturn () => attrs[prop];\n\t\t\t}\n\n\t\t\tswitch (prop) {\n\t\t\t\tcase 'getWidth':\n\t\t\t\t\treturn () => 1;\n\t\t\t\tcase 'getChars':\n\t\t\t\t\treturn () => char;\n\t\t\t\tcase 'getCode':\n\t\t\t\t\treturn () => char.charCodeAt(0) || 0;\n\t\t\t\tcase 'isAttributeDefault':\n\t\t\t\t\treturn () => true;\n\t\t\t\tdefault:\n\t\t\t\t\treturn String(prop).startsWith('is') ? (() => false) : (() => 0);\n\t\t\t}\n\t\t},\n\t});\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport assert from 'assert';\nimport type { IBuffer, Terminal } from '@xterm/xterm';\nimport { SinonStub, stub, useFakeTimers } from 'sinon';\nimport { Emitter } from '../../../../../../base/common/event.js';\nimport { CharPredictState, IPrediction, PredictionStats, TypeAheadAddon } from '../../browser/terminalTypeAheadAddon.js';\nimport { IBeforeProcessDataEvent, ITerminalProcessManager } from '../../../../terminal/common/terminal.js';\nimport { ITelemetryService } from '../../../../../../platform/telemetry/common/telemetry.js';\nimport { TestConfigurationService } from '../../../../../../platform/configuration/test/common/testConfigurationService.js';\nimport { ensureNoDisposablesAreLeakedInTestSuite } from '../../../../../../base/test/common/utils.js';\nimport { DisposableStore } from '../../../../../../base/common/lifecycle.js';\nimport { DEFAULT_LOCAL_ECHO_EXCLUDE, type ITerminalTypeAheadConfiguration } from '../../common/terminalTypeAheadConfiguration.js';\nimport { isString } from '../../../../../../base/common/types.js';\n\nconst CSI = `\\x1b[`;\n\nconst enum CursorMoveDirection {\n\tBack = 'D',\n\tForwards = 'C',\n}\n\nsuite('Workbench - Terminal Typeahead', () => {\n\tconst ds = ensureNoDisposablesAreLeakedInTestSuite();\n\n\tsuite('PredictionStats', () => {\n\t\tlet stats: PredictionStats;\n\t\tlet add: Emitter<IPrediction>;\n\t\tlet succeed: Emitter<IPrediction>;\n\t\tlet fail: Emitter<IPrediction>;\n\n\t\tsetup(() => {\n\t\t\tadd = ds.add(new Emitter<IPrediction>());\n\t\t\tsucceed = ds.add(new Emitter<IPrediction>());\n\t\t\tfail = ds.add(new Emitter<IPrediction>());\n\n\t\t\t// eslint-disable-next-line local/code-no-any-casts\n\t\t\tstats = ds.add(new PredictionStats({\n\t\t\t\tonPredictionAdded: add.event,\n\t\t\t\tonPredictionSucceeded: succeed.event,\n\t\t\t\tonPredictionFailed: fail.event,\n\t\t\t} as any));\n\t\t});\n\n\t\ttest('creates sane data', () => {\n\t\t\tconst stubs = createPredictionStubs(5);\n\t\t\tconst clock = useFakeTimers();\n\t\t\ttry {\n\t\t\t\tfor (const s of stubs) { add.fire(s); }\n\n\t\t\t\tfor (let i = 0; i < stubs.length; i++) {\n\t\t\t\t\tclock.tick(100);\n\t\t\t\t\t(i % 2 ? fail : succeed).fire(stubs[i]);\n\t\t\t\t}\n\n\t\t\t\tassert.strictEqual(stats.accuracy, 3 / 5);\n\t\t\t\tassert.strictEqual(stats.sampleSize, 5);\n\t\t\t\tassert.deepStrictEqual(stats.latency, {\n\t\t\t\t\tcount: 3,\n\t\t\t\t\tmin: 100,\n\t\t\t\t\tmax: 500,\n\t\t\t\t\tmedian: 300\n\t\t\t\t});\n\t\t\t} finally {\n\t\t\t\tclock.restore();\n\t\t\t}\n\t\t});\n\n\t\ttest('circular buffer', () => {\n\t\t\tconst bufferSize = 24;\n\t\t\tconst stubs = createPredictionStubs(bufferSize * 2);\n\n\t\t\tfor (const s of stubs.slice(0, bufferSize)) { add.fire(s); succeed.fire(s); }\n\t\t\tassert.strictEqual(stats.accuracy, 1);\n\n\t\t\tfor (const s of stubs.slice(bufferSize, bufferSize * 3 / 2)) { add.fire(s); fail.fire(s); }\n\t\t\tassert.strictEqual(stats.accuracy, 0.5);\n\n\t\t\tfor (const s of stubs.slice(bufferSize * 3 / 2)) { add.fire(s); fail.fire(s); }\n\t\t\tassert.strictEqual(stats.accuracy, 0);\n\t\t});\n\t});\n\n\tsuite('timeline', () => {\n\t\tlet onBeforeProcessData: Emitter<IBeforeProcessDataEvent>;\n\t\tlet publicLog: SinonStub;\n\t\tlet config: ITerminalTypeAheadConfiguration;\n\t\tlet addon: TestTypeAheadAddon;\n\n\t\tconst predictedHelloo = [\n\t\t\t`${CSI}?25l`, // hide cursor\n\t\t\t`${CSI}2;7H`, // move cursor\n\t\t\t'o', // new character\n\t\t\t`${CSI}2;8H`, // place cursor back at end of line\n\t\t\t`${CSI}?25h`, // show cursor\n\t\t].join('');\n\n\t\tconst expectProcessed = (input: string, output: string) => {\n\t\t\tconst evt = { data: input };\n\t\t\tonBeforeProcessData.fire(evt);\n\t\t\tassert.strictEqual(JSON.stringify(evt.data), JSON.stringify(output));\n\t\t};\n\n\t\tsetup(() => {\n\t\t\tonBeforeProcessData = ds.add(new Emitter<IBeforeProcessDataEvent>());\n\t\t\tconfig = upcastPartial<ITerminalTypeAheadConfiguration>({\n\t\t\t\tlocalEchoStyle: 'italic',\n\t\t\t\tlocalEchoLatencyThreshold: 0,\n\t\t\t\tlocalEchoExcludePrograms: DEFAULT_LOCAL_ECHO_EXCLUDE,\n\t\t\t});\n\t\t\tpublicLog = stub();\n\t\t\taddon = new TestTypeAheadAddon(\n\t\t\t\tupcastPartial<ITerminalProcessManager>({ onBeforeProcessData: onBeforeProcessData.event }),\n\t\t\t\tnew TestConfigurationService({ terminal: { integrated: { ...config } } }),\n\t\t\t\tupcastPartial<ITelemetryService>({ publicLog })\n\t\t\t);\n\t\t\taddon.unlockMakingPredictions();\n\t\t});\n\n\t\tteardown(() => {\n\t\t\taddon.dispose();\n\t\t});\n\n\t\ttest('predicts a single character', () => {\n\t\t\tconst t = ds.add(createMockTerminal({ lines: ['hello|'] }));\n\t\t\taddon.activate(t.terminal);\n\t\t\tt.onData('o');\n\t\t\tt.expectWritten(`${CSI}3mo${CSI}23m`);\n\t\t});\n\n\t\ttest('validates character prediction', () => {\n\t\t\tconst t = ds.add(createMockTerminal({ lines: ['hello|'] }));\n\t\t\taddon.activate(t.terminal);\n\t\t\tt.onData('o');\n\t\t\texpectProcessed('o', predictedHelloo);\n\t\t\tassert.strictEqual(addon.stats?.accuracy, 1);\n\t\t});\n\n\t\ttest('validates zsh prediction (#112842)', () => {\n\t\t\tconst t = ds.add(createMockTerminal({ lines: ['hello|'] }));\n\t\t\taddon.activate(t.terminal);\n\t\t\tt.onData('o');\n\t\t\texpectProcessed('o', predictedHelloo);\n\n\t\t\tt.onData('x');\n\t\t\texpectProcessed('\\box', [\n\t\t\t\t`${CSI}?25l`, // hide cursor\n\t\t\t\t`${CSI}2;8H`, // move cursor\n\t\t\t\t'\\box', // new data\n\t\t\t\t`${CSI}2;9H`, // place cursor back at end of line\n\t\t\t\t`${CSI}?25h`, // show cursor\n\t\t\t].join(''));\n\t\t\tassert.strictEqual(addon.stats?.accuracy, 1);\n\t\t});\n\n\t\ttest('does not validate zsh prediction on differing lookbehindn (#112842)', () => {\n\t\t\tconst t = ds.add(createMockTerminal({ lines: ['hello|'] }));\n\t\t\taddon.activate(t.terminal);\n\t\t\tt.onData('o');\n\t\t\texpectProcessed('o', predictedHelloo);\n\n\t\t\tt.onData('x');\n\t\t\texpectProcessed('\\bqx', [\n\t\t\t\t`${CSI}?25l`, // hide cursor\n\t\t\t\t`${CSI}2;8H`, // move cursor cursor\n\t\t\t\t`${CSI}X`, // delete character\n\t\t\t\t`${CSI}0m`, // reset style\n\t\t\t\t'\\bqx', // new data\n\t\t\t\t`${CSI}?25h`, // show cursor\n\t\t\t].join(''));\n\t\t\tassert.strictEqual(addon.stats?.accuracy, 0.5);\n\t\t});\n\n\t\ttest('rolls back character prediction', () => {\n\t\t\tconst t = ds.add(createMockTerminal({ lines: ['hello|'] }));\n\t\t\taddon.activate(t.terminal);\n\t\t\tt.onData('o');\n\n\t\t\texpectProcessed('q', [\n\t\t\t\t`${CSI}?25l`, // hide cursor\n\t\t\t\t`${CSI}2;7H`, // move cursor cursor\n\t\t\t\t`${CSI}X`, // delete character\n\t\t\t\t`${CSI}0m`, // reset style\n\t\t\t\t'q', // new character\n\t\t\t\t`${CSI}?25h`, // show cursor\n\t\t\t].join(''));\n\t\t\tassert.strictEqual(addon.stats?.accuracy, 0);\n\t\t});\n\n\t\ttest('handles left arrow when we hit the boundary', () => {\n\t\t\tconst t = ds.add(createMockTerminal({ lines: ['|'] }));\n\t\t\taddon.activate(t.terminal);\n\t\t\taddon.unlockNavigating();\n\n\t\t\tconst cursorXBefore = addon.physicalCursor(t.terminal.buffer.active)?.x!;\n\t\t\tt.onData(`${CSI}${CursorMoveDirection.Back}`);\n\t\t\tt.expectWritten('');\n\n\t\t\t// Trigger rollback because we don't expect this data\n\t\t\tonBeforeProcessData.fire({ data: 'xy' });\n\n\t\t\tassert.strictEqual(\n\t\t\t\taddon.physicalCursor(t.terminal.buffer.active)?.x,\n\t\t\t\t// The cursor should not have changed because we've hit the\n\t\t\t\t// boundary (start of prompt)\n\t\t\t\tcursorXBefore);\n\t\t});\n\n\t\ttest('handles right arrow when we hit the boundary', () => {\n\t\t\tconst t = ds.add(createMockTerminal({ lines: ['|'] }));\n\t\t\taddon.activate(t.terminal);\n\t\t\taddon.unlockNavigating();\n\n\t\t\tconst cursorXBefore = addon.physicalCursor(t.terminal.buffer.active)?.x!;\n\t\t\tt.onData(`${CSI}${CursorMoveDirection.Forwards}`);\n\t\t\tt.expectWritten('');\n\n\t\t\t// Trigger rollback because we don't expect this data\n\t\t\tonBeforeProcessData.fire({ data: 'xy' });\n\n\t\t\tassert.strictEqual(\n\t\t\t\taddon.physicalCursor(t.terminal.buffer.active)?.x,\n\t\t\t\t// The cursor should not have changed because we've hit the\n\t\t\t\t// boundary (end of prompt)\n\t\t\t\tcursorXBefore);\n\t\t});\n\n\t\ttest('internal cursor state is reset when all predictions are undone', () => {\n\t\t\tconst t = ds.add(createMockTerminal({ lines: ['|'] }));\n\t\t\taddon.activate(t.terminal);\n\t\t\taddon.unlockNavigating();\n\n\t\t\tconst cursorXBefore = addon.physicalCursor(t.terminal.buffer.active)?.x!;\n\t\t\tt.onData(`${CSI}${CursorMoveDirection.Back}`);\n\t\t\tt.expectWritten('');\n\t\t\taddon.undoAllPredictions();\n\n\t\t\tassert.strictEqual(\n\t\t\t\taddon.physicalCursor(t.terminal.buffer.active)?.x,\n\t\t\t\t// The cursor should not have changed because we've hit the\n\t\t\t\t// boundary (start of prompt)\n\t\t\t\tcursorXBefore);\n\t\t});\n\n\t\ttest('restores cursor graphics mode', () => {\n\t\t\tconst t = ds.add(createMockTerminal({\n\t\t\t\tlines: ['hello|'],\n\t\t\t\tcursorAttrs: { isAttributeDefault: false, isBold: true, isFgPalette: true, getFgColor: 1 },\n\t\t\t}));\n\t\t\taddon.activate(t.terminal);\n\t\t\tt.onData('o');\n\n\t\t\texpectProcessed('q', [\n\t\t\t\t`${CSI}?25l`, // hide cursor\n\t\t\t\t`${CSI}2;7H`, // move cursor cursor\n\t\t\t\t`${CSI}X`, // delete character\n\t\t\t\t`${CSI}1;38;5;1m`, // reset style\n\t\t\t\t'q', // new character\n\t\t\t\t`${CSI}?25h`, // show cursor\n\t\t\t].join(''));\n\t\t\tassert.strictEqual(addon.stats?.accuracy, 0);\n\t\t});\n\n\t\ttest('validates against and applies graphics mode on predicted', () => {\n\t\t\tconst t = ds.add(createMockTerminal({ lines: ['hello|'] }));\n\t\t\taddon.activate(t.terminal);\n\t\t\tt.onData('o');\n\t\t\texpectProcessed(`${CSI}4mo`, [\n\t\t\t\t`${CSI}?25l`, // hide cursor\n\t\t\t\t`${CSI}2;7H`, // move cursor\n\t\t\t\t`${CSI}4m`, // new PTY's style\n\t\t\t\t'o', // new character\n\t\t\t\t`${CSI}2;8H`, // place cursor back at end of line\n\t\t\t\t`${CSI}?25h`, // show cursor\n\t\t\t].join(''));\n\t\t\tassert.strictEqual(addon.stats?.accuracy, 1);\n\t\t});\n\n\t\ttest('ignores cursor hides or shows', () => {\n\t\t\tconst t = ds.add(createMockTerminal({ lines: ['hello|'] }));\n\t\t\taddon.activate(t.terminal);\n\t\t\tt.onData('o');\n\t\t\texpectProcessed(`${CSI}?25lo${CSI}?25h`, [\n\t\t\t\t`${CSI}?25l`, // hide cursor from PTY\n\t\t\t\t`${CSI}?25l`, // hide cursor\n\t\t\t\t`${CSI}2;7H`, // move cursor\n\t\t\t\t'o', // new character\n\t\t\t\t`${CSI}?25h`, // show cursor from PTY\n\t\t\t\t`${CSI}2;8H`, // place cursor back at end of line\n\t\t\t\t`${CSI}?25h`, // show cursor\n\t\t\t].join(''));\n\t\t\tassert.strictEqual(addon.stats?.accuracy, 1);\n\t\t});\n\n\t\ttest('matches backspace at EOL (bash style)', () => {\n\t\t\tconst t = ds.add(createMockTerminal({ lines: ['hello|'] }));\n\t\t\taddon.activate(t.terminal);\n\t\t\tt.onData('\\x7F');\n\t\t\texpectProcessed(`\\b${CSI}K`, `\\b${CSI}K`);\n\t\t\tassert.strictEqual(addon.stats?.accuracy, 1);\n\t\t});\n\n\t\ttest('matches backspace at EOL (zsh style)', () => {\n\t\t\tconst t = ds.add(createMockTerminal({ lines: ['hello|'] }));\n\t\t\taddon.activate(t.terminal);\n\t\t\tt.onData('\\x7F');\n\t\t\texpectProcessed('\\b \\b', '\\b \\b');\n\t\t\tassert.strictEqual(addon.stats?.accuracy, 1);\n\t\t});\n\n\t\ttest('gradually matches backspace', () => {\n\t\t\tconst t = ds.add(createMockTerminal({ lines: ['hello|'] }));\n\t\t\taddon.activate(t.terminal);\n\t\t\tt.onData('\\x7F');\n\t\t\texpectProcessed('\\b', '');\n\t\t\texpectProcessed(' \\b', '\\b \\b');\n\t\t\tassert.strictEqual(addon.stats?.accuracy, 1);\n\t\t});\n\n\t\ttest('restores old character after invalid backspace', () => {\n\t\t\tconst t = ds.add(createMockTerminal({ lines: ['hel|lo'] }));\n\t\t\taddon.activate(t.terminal);\n\t\t\taddon.unlockNavigating();\n\t\t\tt.onData('\\x7F');\n\t\t\tt.expectWritten(`${CSI}2;4H${CSI}X`);\n\t\t\texpectProcessed('x', `${CSI}?25l${CSI}0ml${CSI}2;5H${CSI}0mx${CSI}?25h`);\n\t\t\tassert.strictEqual(addon.stats?.accuracy, 0);\n\t\t});\n\n\t\ttest('waits for validation before deleting to left of cursor', () => {\n\t\t\tconst t = ds.add(createMockTerminal({ lines: ['hello|'] }));\n\t\t\taddon.activate(t.terminal);\n\n\t\t\t// initially should not backspace (until the server confirms it)\n\t\t\tt.onData('\\x7F');\n\t\t\tt.expectWritten('');\n\t\t\texpectProcessed('\\b \\b', '\\b \\b');\n\t\t\tt.cursor.x--;\n\n\t\t\t// enter input on the column...\n\t\t\tt.onData('o');\n\t\t\tonBeforeProcessData.fire({ data: 'o' });\n\t\t\tt.cursor.x++;\n\t\t\tt.clearWritten();\n\n\t\t\t// now that the column is 'unlocked', we should be able to predict backspace on it\n\t\t\tt.onData('\\x7F');\n\t\t\tt.expectWritten(`${CSI}2;6H${CSI}X`);\n\t\t});\n\n\t\ttest('waits for first valid prediction on a line', () => {\n\t\t\tconst t = ds.add(createMockTerminal({ lines: ['hello|'] }));\n\t\t\taddon.lockMakingPredictions();\n\t\t\taddon.activate(t.terminal);\n\n\t\t\tt.onData('o');\n\t\t\tt.expectWritten('');\n\t\t\texpectProcessed('o', 'o');\n\n\t\t\tt.onData('o');\n\t\t\tt.expectWritten(`${CSI}3mo${CSI}23m`);\n\t\t});\n\n\t\ttest('disables on title change', () => {\n\t\t\tconst t = ds.add(createMockTerminal({ lines: ['hello|'] }));\n\t\t\taddon.activate(t.terminal);\n\n\t\t\taddon.reevaluateNow();\n\t\t\tassert.strictEqual(addon.isShowing, true, 'expected to show initially');\n\n\t\t\tt.onTitleChange.fire('foo - VIM.exe');\n\t\t\taddon.reevaluateNow();\n\t\t\tassert.strictEqual(addon.isShowing, false, 'expected to hide when vim is open');\n\n\t\t\tt.onTitleChange.fire('foo - git.exe');\n\t\t\taddon.reevaluateNow();\n\t\t\tassert.strictEqual(addon.isShowing, true, 'expected to show again after vim closed');\n\t\t});\n\n\t\ttest('adds line wrap prediction even if behind a boundary', () => {\n\t\t\tconst t = ds.add(createMockTerminal({ lines: ['hello|'] }));\n\t\t\taddon.lockMakingPredictions();\n\t\t\taddon.activate(t.terminal);\n\n\t\t\tt.onData('hi'.repeat(50));\n\t\t\tt.expectWritten('');\n\t\t\texpectProcessed('hi', [\n\t\t\t\t`${CSI}?25l`, // hide cursor\n\t\t\t\t'hi', // this greeting characters\n\t\t\t\t...new Array(36).fill(`${CSI}3mh${CSI}23m${CSI}3mi${CSI}23m`), // rest of the greetings that fit on this line\n\t\t\t\t`${CSI}2;81H`, // move to end of line\n\t\t\t\t`${CSI}?25h`\n\t\t\t].join(''));\n\t\t});\n\t});\n});\n\nclass TestTypeAheadAddon extends TypeAheadAddon {\n\tunlockMakingPredictions() {\n\t\tthis._lastRow = { y: 1, startingX: 100, endingX: 100, charState: CharPredictState.Validated };\n\t}\n\n\tlockMakingPredictions() {\n\t\tthis._lastRow = undefined;\n\t}\n\n\tunlockNavigating() {\n\t\tthis._lastRow = { y: 1, startingX: 1, endingX: 1, charState: CharPredictState.Validated };\n\t}\n\n\treevaluateNow() {\n\t\tthis._reevaluatePredictorStateNow(this.stats!, this._timeline!);\n\t}\n\n\tget isShowing() {\n\t\treturn !!this._timeline?.isShowingPredictions;\n\t}\n\n\tundoAllPredictions() {\n\t\tthis._timeline?.undoAllPredictions();\n\t}\n\n\tphysicalCursor(buffer: IBuffer) {\n\t\treturn this._timeline?.physicalCursor(buffer);\n\t}\n\n\ttentativeCursor(buffer: IBuffer) {\n\t\treturn this._timeline?.tentativeCursor(buffer);\n\t}\n}\n\nfunction upcastPartial<T>(v: Partial<T>): T {\n\treturn v as T;\n}\n\nfunction createPredictionStubs(n: number) {\n\treturn new Array(n).fill(0).map(stubPrediction);\n}\n\nfunction stubPrediction(): IPrediction {\n\treturn {\n\t\tapply: () => '',\n\t\trollback: () => '',\n\t\tmatches: () => 0,\n\t\trollForwards: () => '',\n\t};\n}\n\nfunction createMockTerminal({ lines, cursorAttrs }: {\n\tlines: string[];\n\tcursorAttrs?: any;\n}) {\n\tconst ds = new DisposableStore();\n\tconst written: string[] = [];\n\tconst cursor = { y: 1, x: 1 };\n\tconst onTitleChange = ds.add(new Emitter<string>());\n\tconst onData = ds.add(new Emitter<string>());\n\tconst csiEmitter = ds.add(new Emitter<number[]>());\n\n\tfor (let y = 0; y < lines.length; y++) {\n\t\tconst line = lines[y];\n\t\tif (line.includes('|')) {\n\t\t\tcursor.y = y + 1;\n\t\t\tcursor.x = line.indexOf('|') + 1;\n\t\t\tlines[y] = line.replace('|', ''); // CodeQL [SM02383] replacing the first occurrence is intended\n\t\t\tbreak;\n\t\t}\n\t}\n\n\treturn {\n\t\twritten,\n\t\tcursor,\n\t\texpectWritten: (s: string) => {\n\t\t\tassert.strictEqual(JSON.stringify(written.join('')), JSON.stringify(s));\n\t\t\twritten.splice(0, written.length);\n\t\t},\n\t\tclearWritten: () => written.splice(0, written.length),\n\t\tonData: (s: string) => onData.fire(s),\n\t\tcsiEmitter,\n\t\tonTitleChange,\n\t\tdispose: () => ds.dispose(),\n\t\tterminal: {\n\t\t\tcols: 80,\n\t\t\trows: 5,\n\t\t\tonResize: new Emitter<void>().event,\n\t\t\tonData: onData.event,\n\t\t\tonTitleChange: onTitleChange.event,\n\t\t\tparser: {\n\t\t\t\tregisterCsiHandler(_: unknown, callback: () => void) {\n\t\t\t\t\tds.add(csiEmitter.event(callback));\n\t\t\t\t},\n\t\t\t},\n\t\t\twrite(line: string) {\n\t\t\t\twritten.push(line);\n\t\t\t},\n\t\t\t_core: {\n\t\t\t\t_inputHandler: {\n\t\t\t\t\t_curAttrData: mockCell('', cursorAttrs)\n\t\t\t\t},\n\t\t\t\twriteSync() {\n\n\t\t\t\t}\n\t\t\t},\n\t\t\tbuffer: {\n\t\t\t\tactive: {\n\t\t\t\t\ttype: 'normal',\n\t\t\t\t\tbaseY: 0,\n\t\t\t\t\tget cursorY() { return cursor.y; },\n\t\t\t\t\tget cursorX() { return cursor.x; },\n\t\t\t\t\tgetLine(y: number) {\n\t\t\t\t\t\tconst s = lines[y - 1] || '';\n\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\tlength: s.length,\n\t\t\t\t\t\t\tgetCell: (x: number) => mockCell(s[x - 1] || ''),\n\t\t\t\t\t\t\ttranslateToString: (trim: boolean, start = 0, end = s.length) => {\n\t\t\t\t\t\t\t\tconst out = s.slice(start, end);\n\t\t\t\t\t\t\t\treturn trim ? out.trimRight() : out;\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t};\n\t\t\t\t\t},\n\t\t\t\t}\n\t\t\t}\n\t\t} as unknown as Terminal\n\t};\n}\n\nfunction mockCell(char: string, attrs: { [key: string]: unknown } = {}) {\n\treturn new Proxy({}, {\n\t\tget(_, prop) {\n\t\t\tif (isString(prop) && attrs.hasOwnProperty(prop)) {\n\t\t\t\treturn () => attrs[prop];\n\t\t\t}\n\n\t\t\tswitch (prop) {\n\t\t\t\tcase 'getWidth':\n\t\t\t\t\treturn () => 1;\n\t\t\t\tcase 'getChars':\n\t\t\t\t\treturn () => char;\n\t\t\t\tcase 'getCode':\n\t\t\t\t\treturn () => char.charCodeAt(0) || 0;\n\t\t\t\tcase 'isAttributeDefault':\n\t\t\t\t\treturn () => true;\n\t\t\t\tdefault:\n\t\t\t\t\treturn String(prop).startsWith('is') ? (() => false) : (() => 0);\n\t\t\t}\n\t\t},\n\t});\n}\n"]}