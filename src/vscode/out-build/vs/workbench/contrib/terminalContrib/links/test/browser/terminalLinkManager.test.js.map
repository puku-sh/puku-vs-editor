{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/contrib/terminalContrib/links/test/browser/terminalLinkManager.test.ts","vs/workbench/contrib/terminalContrib/links/test/browser/terminalLinkManager.test.ts"],"names":[],"mappings":"AAAA;;;gGAGgG;AAEhG,OAAO,EAAE,eAAe,EAAE,WAAW,EAAE,MAAM,QAAQ,CAAC;AACtD,OAAO,EAAE,MAAM,EAAE,MAAM,yCAAyC,CAAC;AAEjE,OAAO,EAAE,qBAAqB,EAAE,MAAM,kEAAkE,CAAC;AACzG,OAAO,EAAE,wBAAwB,EAAE,MAAM,kFAAkF,CAAC;AAC5H,OAAO,EAAE,kBAAkB,EAAE,MAAM,sEAAsE,CAAC;AAC1G,OAAO,EAAE,mBAAmB,EAAE,MAAM,+DAA+D,CAAC;AACpG,OAAO,EAAE,wBAAwB,EAAE,MAAM,kFAAkF,CAAC;AAC5H,OAAO,EAAE,WAAW,EAAE,cAAc,EAAE,MAAM,8CAA8C,CAAC;AAC3F,OAAO,EAAE,eAAe,EAAE,MAAM,sDAAsD,CAAC;AACvF,OAAO,EAAE,aAAa,EAAE,MAAM,yDAAyD,CAAC;AACxF,OAAO,EAAE,gBAAgB,EAAE,MAAM,kEAAkE,CAAC;AACpG,OAAO,EAAE,sBAAsB,EAAE,MAAM,gCAAgC,CAAC;AACxE,OAAO,EAAkB,mBAAmB,EAAE,MAAM,sCAAsC,CAAC;AAG3F,OAAO,EAAE,yBAAyB,EAAE,MAAM,+DAA+D,CAAC;AAC1G,OAAO,EAAE,kBAAkB,EAAE,MAAM,qDAAqD,CAAC;AAEzF,OAAO,EAAE,oBAAoB,EAAE,MAAM,uCAAuC,CAAC;AAC7E,OAAO,EAAE,mBAAmB,EAAE,MAAM,2BAA2B,CAAC;AAChE,OAAO,EAAE,uCAAuC,EAAE,MAAM,6CAA6C,CAAC;AAEtG,MAAM,qBAAqB,GAAoC;IAC9D,UAAU,EAAE,WAAW;IACvB,UAAU,EAAE,QAAQ;IACpB,cAAc,EAAE,QAAQ;IACxB,eAAe,EAAE,KAAK;IACtB,UAAU,EAAE,IAAI;IAChB,qBAAqB,EAAE,CAAC;IACxB,2BAA2B,EAAE,CAAC;IAC9B,cAAc,EAAE,IAAI;IACpB,cAAc,EAAE,mBAAmB;CACnC,CAAC;AAEF,MAAM,eAAgB,SAAQ,mBAAmB;IAE7B,KAAK,CAAC,gBAAgB,CAAC,CAAS,EAAE,IAAkC;QACtF,QAAQ,IAAI,EAAE,CAAC;YACd,KAAK,MAAM;gBACV,OAAO,IAAI,CAAC,MAAM,EAAE,SAAS,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,MAAM,EAAE,SAAS,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,SAAS,CAAC;YAChF,KAAK,KAAK;gBACT,OAAO,IAAI,CAAC,MAAM,EAAE,QAAQ,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,MAAM,EAAE,QAAQ,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,SAAS,CAAC;YAC9E,KAAK,WAAW;gBACf,OAAO,IAAI,CAAC,MAAM,EAAE,SAAS,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,MAAM,EAAE,SAAS,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,SAAS,CAAC;QACjF,CAAC;IACF,CAAC;IACD,QAAQ,CAAC,KAAqB;QAC7B,IAAI,CAAC,MAAM,GAAG,KAAK,CAAC;IACrB,CAAC;CACD;AAED,KAAK,CAAC,qBAAqB,EAAE,GAAG,EAAE;IACjC,MAAM,KAAK,GAAG,uCAAuC,EAAE,CAAC;IAExD,IAAI,oBAA8C,CAAC;IACnD,IAAI,oBAA8C,CAAC;IACnD,IAAI,YAA8B,CAAC;IACnC,IAAI,qBAAgD,CAAC;IACrD,IAAI,KAAe,CAAC;IACpB,IAAI,WAA4B,CAAC;IAEjC,KAAK,CAAC,KAAK,IAAI,EAAE;QAChB,oBAAoB,GAAG,IAAI,wBAAwB,CAAC;YACnD,MAAM,EAAE;gBACP,qBAAqB,EAAE,CAAC;gBACxB,2BAA2B,EAAE,CAAC;aACH;YAC5B,QAAQ,EAAE;gBACT,UAAU,EAAE,qBAAqB;aACjC;SACD,CAAC,CAAC;QACH,YAAY,GAAG,IAAI,gBAAgB,EAAE,CAAC;QACtC,qBAAqB,GAAG,IAAI,yBAAyB,EAAE,CAAC;QAExD,oBAAoB,GAAG,KAAK,CAAC,GAAG,CAAC,IAAI,wBAAwB,EAAE,CAAC,CAAC;QACjE,oBAAoB,CAAC,IAAI,CAAC,mBAAmB,EAAE,KAAK,CAAC,GAAG,CAAC,oBAAoB,CAAC,cAAc,CAAC,kBAAkB,CAAC,CAAC,CAAC,CAAC;QACnH,oBAAoB,CAAC,IAAI,CAAC,qBAAqB,EAAE,oBAAoB,CAAC,CAAC;QACvE,oBAAoB,CAAC,IAAI,CAAC,WAAW,EAAE,IAAI,cAAc,EAAE,CAAC,CAAC;QAC7D,oBAAoB,CAAC,IAAI,CAAC,eAAe,EAAE,KAAK,CAAC,GAAG,CAAC,IAAI,kBAAkB,EAAE,CAAC,CAAC,CAAC;QAChF,oBAAoB,CAAC,IAAI,CAAC,aAAa,EAAE,YAAY,CAAC,CAAC;QACvD,oBAAoB,CAAC,IAAI,CAAC,sBAAsB,EAAE,qBAAqB,CAAC,CAAC;QAEzE,MAAM,YAAY,GAAG,CAAC,MAAM,mBAAmB,CAAgC,cAAc,EAAE,cAAc,CAAC,CAAC,CAAC,QAAQ,CAAC;QACzH,KAAK,GAAG,KAAK,CAAC,GAAG,CAAC,IAAI,YAAY,CAAC,EAAE,gBAAgB,EAAE,IAAI,EAAE,IAAI,EAAE,EAAE,EAAE,IAAI,EAAE,EAAE,EAAE,CAAC,CAAC,CAAC;QACpF,WAAW,GAAG,KAAK,CAAC,GAAG,CAAC,oBAAoB,CAAC,cAAc,CAAC,eAAe,EAAE,KAAK,EAAE,aAAa,CAA0B;YAC1H,IAAI,UAAU;gBACb,OAAO,EAAE,CAAC;YACX,CAAC;YACD,mDAAmD;SACnD,CAAC,EAAE;YACH,GAAG,CAA+B,UAAa;gBAC9C,OAAO,SAAS,CAAC;YAClB,CAAC;SAC2C,EAAE,oBAAoB,CAAC,cAAc,CAAC,oBAAoB,CAAC,CAAC,CAAC,CAAC;IAC5G,CAAC,CAAC,CAAC;IAEH,KAAK,CAAC,8BAA8B,EAAE,GAAG,EAAE;QAC1C,IAAI,CAAC,qEAAqE,EAAE,GAAG,EAAE;YAChF,WAAW,CAAC,sBAAsB,GAAG,KAAK,IAAI,EAAE,CAAC,SAAS,CAAC;YAC3D,WAAW,CAAC,OAAO,EAAE,CAAC;YACtB,WAAW,CAAC,sBAAsB,GAAG,KAAK,IAAI,EAAE,CAAC,SAAS,CAAC;QAC5D,CAAC,CAAC,CAAC;IACJ,CAAC,CAAC,CAAC;IAEH,KAAK,CAAC,+BAA+B,EAAE,GAAG,EAAE;QAC3C,IAAI,CAAC,wBAAwB,EAAE,KAAK,IAAI,EAAE;YACzC,MAAM,KAAK,GAAG,MAAM,WAAW,CAAC,QAAQ,EAAE,CAAC;YAC3C,MAAM,CAAC,KAAK,CAAC,QAAQ,CAAC,QAAQ,EAAE,EAAE,CAAC,CAAC;YACpC,MAAM,CAAC,KAAK,CAAC,QAAQ,CAAC,SAAS,EAAE,EAAE,CAAC,CAAC;YACrC,MAAM,CAAC,KAAK,CAAC,QAAQ,CAAC,SAAS,EAAE,EAAE,CAAC,CAAC;YACrC,MAAM,OAAO,GAAG,MAAM,WAAW,CAAC,cAAc,CAAC,KAAK,CAAC,CAAC;YACxD,WAAW,CAAC,OAAO,EAAE,SAAS,CAAC,CAAC;YAChC,MAAM,QAAQ,GAAG,MAAM,WAAW,CAAC,cAAc,CAAC,WAAW,CAAC,CAAC;YAC/D,WAAW,CAAC,QAAQ,EAAE,SAAS,CAAC,CAAC;QAClC,CAAC,CAAC,CAAC;QACH,IAAI,CAAC,mCAAmC,EAAE,KAAK,IAAI,EAAE;YACpD,MAAM,KAAK,GAAG;gBACb,KAAK,EAAE;oBACN,KAAK,EAAE,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,EAAE,GAAG,EAAE,EAAE,CAAC,EAAE,EAAE,EAAE,CAAC,EAAE,CAAC,EAAE;iBAC3C;gBACD,IAAI,EAAE,YAAY;gBAClB,QAAQ,EAAE,GAAG,EAAE,CAAC,OAAO,CAAC,OAAO,CAAC,EAAE,CAAC;aACnC,CAAC;YACF,MAAM,KAAK,GAAG;gBACb,KAAK,EAAE;oBACN,KAAK,EAAE,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,EAAE,GAAG,EAAE,EAAE,CAAC,EAAE,EAAE,EAAE,CAAC,EAAE,CAAC,EAAE;iBAC3C;gBACD,IAAI,EAAE,YAAY;gBAClB,QAAQ,EAAE,GAAG,EAAE,CAAC,OAAO,CAAC,OAAO,CAAC,EAAE,CAAC;aACnC,CAAC;YACF,WAAW,CAAC,QAAQ,CAAC,EAAE,SAAS,EAAE,CAAC,KAAK,EAAE,KAAK,CAAC,EAAE,CAAC,CAAC;YACpD,MAAM,KAAK,GAAG,MAAM,WAAW,CAAC,QAAQ,EAAE,CAAC;YAC3C,eAAe,CAAC,KAAK,CAAC,QAAQ,CAAC,SAAS,EAAE,CAAC,CAAC,CAAC,CAAC,IAAI,EAAE,KAAK,CAAC,IAAI,CAAC,CAAC;YAChE,eAAe,CAAC,KAAK,CAAC,QAAQ,CAAC,SAAS,EAAE,CAAC,CAAC,CAAC,CAAC,IAAI,EAAE,KAAK,CAAC,IAAI,CAAC,CAAC;YAChE,MAAM,OAAO,GAAG,MAAM,WAAW,CAAC,cAAc,CAAC,KAAK,CAAC,CAAC;YACxD,WAAW,CAAC,OAAO,EAAE,SAAS,CAAC,CAAC;YAChC,MAAM,QAAQ,GAAG,MAAM,WAAW,CAAC,cAAc,CAAC,WAAW,CAAC,CAAC;YAC/D,WAAW,CAAC,QAAQ,EAAE,SAAS,CAAC,CAAC;QAClC,CAAC,CAAC,CAAC;QACH,IAAI,CAAC,kCAAkC,EAAE,KAAK,IAAI,EAAE;YACnD,MAAM,KAAK,GAAG;gBACb,KAAK,EAAE,EAAE,KAAK,EAAE,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,EAAE,GAAG,EAAE,EAAE,CAAC,EAAE,EAAE,EAAE,CAAC,EAAE,CAAC,EAAE,EAAE;gBACtD,IAAI,EAAE,sCAAsC;gBAC5C,QAAQ,EAAE,GAAG,EAAE,CAAC,OAAO,CAAC,OAAO,CAAC,EAAE,CAAC;aACnC,CAAC;YACF,MAAM,KAAK,GAAG;gBACb,KAAK,EAAE,EAAE,KAAK,EAAE,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,EAAE,GAAG,EAAE,EAAE,CAAC,EAAE,EAAE,EAAE,CAAC,EAAE,CAAC,EAAE,EAAE;gBACtD,IAAI,EAAE,sCAAsC;gBAC5C,QAAQ,EAAE,GAAG,EAAE,CAAC,OAAO,CAAC,OAAO,CAAC,EAAE,CAAC;aACnC,CAAC;YACF,WAAW,CAAC,QAAQ,CAAC,EAAE,QAAQ,EAAE,CAAC,KAAK,EAAE,KAAK,CAAC,EAAE,CAAC,CAAC;YACnD,MAAM,KAAK,GAAG,MAAM,WAAW,CAAC,QAAQ,EAAE,CAAC;YAC3C,eAAe,CAAC,KAAK,CAAC,QAAQ,CAAC,QAAQ,EAAE,CAAC,CAAC,CAAC,CAAC,IAAI,EAAE,KAAK,CAAC,IAAI,CAAC,CAAC;YAC/D,eAAe,CAAC,KAAK,CAAC,QAAQ,CAAC,QAAQ,EAAE,CAAC,CAAC,CAAC,CAAC,IAAI,EAAE,KAAK,CAAC,IAAI,CAAC,CAAC;YAC/D,MAAM,OAAO,GAAG,MAAM,WAAW,CAAC,cAAc,CAAC,KAAK,CAAC,CAAC;YACxD,WAAW,CAAC,OAAO,EAAE,KAAK,CAAC,CAAC;YAC5B,MAAM,QAAQ,GAAG,MAAM,WAAW,CAAC,cAAc,CAAC,WAAW,CAAC,CAAC;YAC/D,WAAW,CAAC,QAAQ,EAAE,SAAS,CAAC,CAAC;QAClC,CAAC,CAAC,CAAC;QACH,IAAI,CAAC,mCAAmC,EAAE,KAAK,IAAI,EAAE;YACpD,MAAM,KAAK,GAAG;gBACb,KAAK,EAAE,EAAE,KAAK,EAAE,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,EAAE,GAAG,EAAE,EAAE,CAAC,EAAE,EAAE,EAAE,CAAC,EAAE,CAAC,EAAE,EAAE;gBACtD,IAAI,EAAE,kCAAkC;gBACxC,QAAQ,EAAE,GAAG,EAAE,CAAC,OAAO,CAAC,OAAO,CAAC,EAAE,CAAC;aACnC,CAAC;YACF,MAAM,KAAK,GAAG;gBACb,KAAK,EAAE,EAAE,KAAK,EAAE,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,EAAE,GAAG,EAAE,EAAE,CAAC,EAAE,EAAE,EAAE,CAAC,EAAE,CAAC,EAAE,EAAE;gBACtD,IAAI,EAAE,kCAAkC;gBACxC,QAAQ,EAAE,GAAG,EAAE,CAAC,OAAO,CAAC,OAAO,CAAC,EAAE,CAAC;aACnC,CAAC;YACF,WAAW,CAAC,QAAQ,CAAC,EAAE,SAAS,EAAE,CAAC,KAAK,EAAE,KAAK,CAAC,EAAE,CAAC,CAAC;YACpD,MAAM,KAAK,GAAG,MAAM,WAAW,CAAC,QAAQ,EAAE,CAAC;YAC3C,eAAe,CAAC,KAAK,CAAC,QAAQ,CAAC,SAAS,EAAE,CAAC,CAAC,CAAC,CAAC,IAAI,EAAE,KAAK,CAAC,IAAI,CAAC,CAAC;YAChE,eAAe,CAAC,KAAK,CAAC,QAAQ,CAAC,SAAS,EAAE,CAAC,CAAC,CAAC,CAAC,IAAI,EAAE,KAAK,CAAC,IAAI,CAAC,CAAC;YAChE,MAAM,OAAO,GAAG,MAAM,WAAW,CAAC,cAAc,CAAC,KAAK,CAAC,CAAC;YACxD,WAAW,CAAC,OAAO,EAAE,SAAS,CAAC,CAAC;YAChC,WAAW,CAAC,QAAQ,CAAC,EAAE,SAAS,EAAE,CAAC,KAAK,CAAC,EAAE,CAAC,CAAC;YAC7C,MAAM,QAAQ,GAAG,MAAM,WAAW,CAAC,cAAc,CAAC,WAAW,CAAC,CAAC;YAC/D,WAAW,CAAC,QAAQ,EAAE,KAAK,CAAC,CAAC;QAC9B,CAAC,CAAC,CAAC;IACJ,CAAC,CAAC,CAAC;AACJ,CAAC,CAAC,CAAC;AACH,SAAS,aAAa,CAAI,CAAa;IACtC,OAAO,CAAM,CAAC;AACf,CAAC","file":"terminalLinkManager.test.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { deepStrictEqual, strictEqual } from 'assert';\nimport { equals } from '../../../../../../base/common/arrays.js';\nimport { IEditorOptions } from '../../../../../../editor/common/config/editorOptions.js';\nimport { IConfigurationService } from '../../../../../../platform/configuration/common/configuration.js';\nimport { TestConfigurationService } from '../../../../../../platform/configuration/test/common/testConfigurationService.js';\nimport { ContextMenuService } from '../../../../../../platform/contextview/browser/contextMenuService.js';\nimport { IContextMenuService } from '../../../../../../platform/contextview/browser/contextView.js';\nimport { TestInstantiationService } from '../../../../../../platform/instantiation/test/common/instantiationServiceMock.js';\nimport { ILogService, NullLogService } from '../../../../../../platform/log/common/log.js';\nimport { IStorageService } from '../../../../../../platform/storage/common/storage.js';\nimport { IThemeService } from '../../../../../../platform/theme/common/themeService.js';\nimport { TestThemeService } from '../../../../../../platform/theme/test/common/testThemeService.js';\nimport { IViewDescriptorService } from '../../../../../common/views.js';\nimport { IDetectedLinks, TerminalLinkManager } from '../../browser/terminalLinkManager.js';\nimport { ITerminalCapabilityImplMap, ITerminalCapabilityStore, TerminalCapability } from '../../../../../../platform/terminal/common/capabilities/capabilities.js';\nimport { ITerminalConfiguration, ITerminalProcessManager } from '../../../../terminal/common/terminal.js';\nimport { TestViewDescriptorService } from '../../../../terminal/test/browser/xterm/xtermTerminal.test.js';\nimport { TestStorageService } from '../../../../../test/common/workbenchTestServices.js';\nimport type { ILink, Terminal } from '@xterm/xterm';\nimport { TerminalLinkResolver } from '../../browser/terminalLinkResolver.js';\nimport { importAMDNodeModule } from '../../../../../../amdX.js';\nimport { ensureNoDisposablesAreLeakedInTestSuite } from '../../../../../../base/test/common/utils.js';\n\nconst defaultTerminalConfig: Partial<ITerminalConfiguration> = {\n\tfontFamily: 'monospace',\n\tfontWeight: 'normal',\n\tfontWeightBold: 'normal',\n\tgpuAcceleration: 'off',\n\tscrollback: 1000,\n\tfastScrollSensitivity: 2,\n\tmouseWheelScrollSensitivity: 1,\n\tunicodeVersion: '11',\n\twordSeparators: ' ()[]{}\\',\"`─‘’“”'\n};\n\nclass TestLinkManager extends TerminalLinkManager {\n\tprivate _links: IDetectedLinks | undefined;\n\tprotected override async _getLinksForType(y: number, type: 'word' | 'url' | 'localFile'): Promise<ILink[] | undefined> {\n\t\tswitch (type) {\n\t\t\tcase 'word':\n\t\t\t\treturn this._links?.wordLinks?.[y] ? [this._links?.wordLinks?.[y]] : undefined;\n\t\t\tcase 'url':\n\t\t\t\treturn this._links?.webLinks?.[y] ? [this._links?.webLinks?.[y]] : undefined;\n\t\t\tcase 'localFile':\n\t\t\t\treturn this._links?.fileLinks?.[y] ? [this._links?.fileLinks?.[y]] : undefined;\n\t\t}\n\t}\n\tsetLinks(links: IDetectedLinks): void {\n\t\tthis._links = links;\n\t}\n}\n\nsuite('TerminalLinkManager', () => {\n\tconst store = ensureNoDisposablesAreLeakedInTestSuite();\n\n\tlet instantiationService: TestInstantiationService;\n\tlet configurationService: TestConfigurationService;\n\tlet themeService: TestThemeService;\n\tlet viewDescriptorService: TestViewDescriptorService;\n\tlet xterm: Terminal;\n\tlet linkManager: TestLinkManager;\n\n\tsetup(async () => {\n\t\tconfigurationService = new TestConfigurationService({\n\t\t\teditor: {\n\t\t\t\tfastScrollSensitivity: 2,\n\t\t\t\tmouseWheelScrollSensitivity: 1\n\t\t\t} as Partial<IEditorOptions>,\n\t\t\tterminal: {\n\t\t\t\tintegrated: defaultTerminalConfig\n\t\t\t}\n\t\t});\n\t\tthemeService = new TestThemeService();\n\t\tviewDescriptorService = new TestViewDescriptorService();\n\n\t\tinstantiationService = store.add(new TestInstantiationService());\n\t\tinstantiationService.stub(IContextMenuService, store.add(instantiationService.createInstance(ContextMenuService)));\n\t\tinstantiationService.stub(IConfigurationService, configurationService);\n\t\tinstantiationService.stub(ILogService, new NullLogService());\n\t\tinstantiationService.stub(IStorageService, store.add(new TestStorageService()));\n\t\tinstantiationService.stub(IThemeService, themeService);\n\t\tinstantiationService.stub(IViewDescriptorService, viewDescriptorService);\n\n\t\tconst TerminalCtor = (await importAMDNodeModule<typeof import('@xterm/xterm')>('@xterm/xterm', 'lib/xterm.js')).Terminal;\n\t\txterm = store.add(new TerminalCtor({ allowProposedApi: true, cols: 80, rows: 30 }));\n\t\tlinkManager = store.add(instantiationService.createInstance(TestLinkManager, xterm, upcastPartial<ITerminalProcessManager>({\n\t\t\tget initialCwd() {\n\t\t\t\treturn '';\n\t\t\t}\n\t\t\t// eslint-disable-next-line local/code-no-any-casts\n\t\t}), {\n\t\t\tget<T extends TerminalCapability>(capability: T): ITerminalCapabilityImplMap[T] | undefined {\n\t\t\t\treturn undefined;\n\t\t\t}\n\t\t} as Partial<ITerminalCapabilityStore> as any, instantiationService.createInstance(TerminalLinkResolver)));\n\t});\n\n\tsuite('registerExternalLinkProvider', () => {\n\t\ttest('should not leak disposables if the link manager is already disposed', () => {\n\t\t\tlinkManager.externalProvideLinksCb = async () => undefined;\n\t\t\tlinkManager.dispose();\n\t\t\tlinkManager.externalProvideLinksCb = async () => undefined;\n\t\t});\n\t});\n\n\tsuite('getLinks and open recent link', () => {\n\t\ttest('should return no links', async () => {\n\t\t\tconst links = await linkManager.getLinks();\n\t\t\tequals(links.viewport.webLinks, []);\n\t\t\tequals(links.viewport.wordLinks, []);\n\t\t\tequals(links.viewport.fileLinks, []);\n\t\t\tconst webLink = await linkManager.openRecentLink('url');\n\t\t\tstrictEqual(webLink, undefined);\n\t\t\tconst fileLink = await linkManager.openRecentLink('localFile');\n\t\t\tstrictEqual(fileLink, undefined);\n\t\t});\n\t\ttest('should return word links in order', async () => {\n\t\t\tconst link1 = {\n\t\t\t\trange: {\n\t\t\t\t\tstart: { x: 1, y: 1 }, end: { x: 14, y: 1 }\n\t\t\t\t},\n\t\t\t\ttext: '1_我是学生.txt',\n\t\t\t\tactivate: () => Promise.resolve('')\n\t\t\t};\n\t\t\tconst link2 = {\n\t\t\t\trange: {\n\t\t\t\t\tstart: { x: 1, y: 1 }, end: { x: 14, y: 1 }\n\t\t\t\t},\n\t\t\t\ttext: '2_我是学生.txt',\n\t\t\t\tactivate: () => Promise.resolve('')\n\t\t\t};\n\t\t\tlinkManager.setLinks({ wordLinks: [link1, link2] });\n\t\t\tconst links = await linkManager.getLinks();\n\t\t\tdeepStrictEqual(links.viewport.wordLinks?.[0].text, link2.text);\n\t\t\tdeepStrictEqual(links.viewport.wordLinks?.[1].text, link1.text);\n\t\t\tconst webLink = await linkManager.openRecentLink('url');\n\t\t\tstrictEqual(webLink, undefined);\n\t\t\tconst fileLink = await linkManager.openRecentLink('localFile');\n\t\t\tstrictEqual(fileLink, undefined);\n\t\t});\n\t\ttest('should return web links in order', async () => {\n\t\t\tconst link1 = {\n\t\t\t\trange: { start: { x: 5, y: 1 }, end: { x: 40, y: 1 } },\n\t\t\t\ttext: 'https://foo.bar/[this is foo site 1]',\n\t\t\t\tactivate: () => Promise.resolve('')\n\t\t\t};\n\t\t\tconst link2 = {\n\t\t\t\trange: { start: { x: 5, y: 2 }, end: { x: 40, y: 2 } },\n\t\t\t\ttext: 'https://foo.bar/[this is foo site 2]',\n\t\t\t\tactivate: () => Promise.resolve('')\n\t\t\t};\n\t\t\tlinkManager.setLinks({ webLinks: [link1, link2] });\n\t\t\tconst links = await linkManager.getLinks();\n\t\t\tdeepStrictEqual(links.viewport.webLinks?.[0].text, link2.text);\n\t\t\tdeepStrictEqual(links.viewport.webLinks?.[1].text, link1.text);\n\t\t\tconst webLink = await linkManager.openRecentLink('url');\n\t\t\tstrictEqual(webLink, link2);\n\t\t\tconst fileLink = await linkManager.openRecentLink('localFile');\n\t\t\tstrictEqual(fileLink, undefined);\n\t\t});\n\t\ttest('should return file links in order', async () => {\n\t\t\tconst link1 = {\n\t\t\t\trange: { start: { x: 1, y: 1 }, end: { x: 32, y: 1 } },\n\t\t\t\ttext: 'file:///C:/users/test/file_1.txt',\n\t\t\t\tactivate: () => Promise.resolve('')\n\t\t\t};\n\t\t\tconst link2 = {\n\t\t\t\trange: { start: { x: 1, y: 2 }, end: { x: 32, y: 2 } },\n\t\t\t\ttext: 'file:///C:/users/test/file_2.txt',\n\t\t\t\tactivate: () => Promise.resolve('')\n\t\t\t};\n\t\t\tlinkManager.setLinks({ fileLinks: [link1, link2] });\n\t\t\tconst links = await linkManager.getLinks();\n\t\t\tdeepStrictEqual(links.viewport.fileLinks?.[0].text, link2.text);\n\t\t\tdeepStrictEqual(links.viewport.fileLinks?.[1].text, link1.text);\n\t\t\tconst webLink = await linkManager.openRecentLink('url');\n\t\t\tstrictEqual(webLink, undefined);\n\t\t\tlinkManager.setLinks({ fileLinks: [link2] });\n\t\t\tconst fileLink = await linkManager.openRecentLink('localFile');\n\t\t\tstrictEqual(fileLink, link2);\n\t\t});\n\t});\n});\nfunction upcastPartial<T>(v: Partial<T>): T {\n\treturn v as T;\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { deepStrictEqual, strictEqual } from 'assert';\nimport { equals } from '../../../../../../base/common/arrays.js';\nimport { IEditorOptions } from '../../../../../../editor/common/config/editorOptions.js';\nimport { IConfigurationService } from '../../../../../../platform/configuration/common/configuration.js';\nimport { TestConfigurationService } from '../../../../../../platform/configuration/test/common/testConfigurationService.js';\nimport { ContextMenuService } from '../../../../../../platform/contextview/browser/contextMenuService.js';\nimport { IContextMenuService } from '../../../../../../platform/contextview/browser/contextView.js';\nimport { TestInstantiationService } from '../../../../../../platform/instantiation/test/common/instantiationServiceMock.js';\nimport { ILogService, NullLogService } from '../../../../../../platform/log/common/log.js';\nimport { IStorageService } from '../../../../../../platform/storage/common/storage.js';\nimport { IThemeService } from '../../../../../../platform/theme/common/themeService.js';\nimport { TestThemeService } from '../../../../../../platform/theme/test/common/testThemeService.js';\nimport { IViewDescriptorService } from '../../../../../common/views.js';\nimport { IDetectedLinks, TerminalLinkManager } from '../../browser/terminalLinkManager.js';\nimport { ITerminalCapabilityImplMap, ITerminalCapabilityStore, TerminalCapability } from '../../../../../../platform/terminal/common/capabilities/capabilities.js';\nimport { ITerminalConfiguration, ITerminalProcessManager } from '../../../../terminal/common/terminal.js';\nimport { TestViewDescriptorService } from '../../../../terminal/test/browser/xterm/xtermTerminal.test.js';\nimport { TestStorageService } from '../../../../../test/common/workbenchTestServices.js';\nimport type { ILink, Terminal } from '@xterm/xterm';\nimport { TerminalLinkResolver } from '../../browser/terminalLinkResolver.js';\nimport { importAMDNodeModule } from '../../../../../../amdX.js';\nimport { ensureNoDisposablesAreLeakedInTestSuite } from '../../../../../../base/test/common/utils.js';\n\nconst defaultTerminalConfig: Partial<ITerminalConfiguration> = {\n\tfontFamily: 'monospace',\n\tfontWeight: 'normal',\n\tfontWeightBold: 'normal',\n\tgpuAcceleration: 'off',\n\tscrollback: 1000,\n\tfastScrollSensitivity: 2,\n\tmouseWheelScrollSensitivity: 1,\n\tunicodeVersion: '11',\n\twordSeparators: ' ()[]{}\\',\"`─‘’“”'\n};\n\nclass TestLinkManager extends TerminalLinkManager {\n\tprivate _links: IDetectedLinks | undefined;\n\tprotected override async _getLinksForType(y: number, type: 'word' | 'url' | 'localFile'): Promise<ILink[] | undefined> {\n\t\tswitch (type) {\n\t\t\tcase 'word':\n\t\t\t\treturn this._links?.wordLinks?.[y] ? [this._links?.wordLinks?.[y]] : undefined;\n\t\t\tcase 'url':\n\t\t\t\treturn this._links?.webLinks?.[y] ? [this._links?.webLinks?.[y]] : undefined;\n\t\t\tcase 'localFile':\n\t\t\t\treturn this._links?.fileLinks?.[y] ? [this._links?.fileLinks?.[y]] : undefined;\n\t\t}\n\t}\n\tsetLinks(links: IDetectedLinks): void {\n\t\tthis._links = links;\n\t}\n}\n\nsuite('TerminalLinkManager', () => {\n\tconst store = ensureNoDisposablesAreLeakedInTestSuite();\n\n\tlet instantiationService: TestInstantiationService;\n\tlet configurationService: TestConfigurationService;\n\tlet themeService: TestThemeService;\n\tlet viewDescriptorService: TestViewDescriptorService;\n\tlet xterm: Terminal;\n\tlet linkManager: TestLinkManager;\n\n\tsetup(async () => {\n\t\tconfigurationService = new TestConfigurationService({\n\t\t\teditor: {\n\t\t\t\tfastScrollSensitivity: 2,\n\t\t\t\tmouseWheelScrollSensitivity: 1\n\t\t\t} as Partial<IEditorOptions>,\n\t\t\tterminal: {\n\t\t\t\tintegrated: defaultTerminalConfig\n\t\t\t}\n\t\t});\n\t\tthemeService = new TestThemeService();\n\t\tviewDescriptorService = new TestViewDescriptorService();\n\n\t\tinstantiationService = store.add(new TestInstantiationService());\n\t\tinstantiationService.stub(IContextMenuService, store.add(instantiationService.createInstance(ContextMenuService)));\n\t\tinstantiationService.stub(IConfigurationService, configurationService);\n\t\tinstantiationService.stub(ILogService, new NullLogService());\n\t\tinstantiationService.stub(IStorageService, store.add(new TestStorageService()));\n\t\tinstantiationService.stub(IThemeService, themeService);\n\t\tinstantiationService.stub(IViewDescriptorService, viewDescriptorService);\n\n\t\tconst TerminalCtor = (await importAMDNodeModule<typeof import('@xterm/xterm')>('@xterm/xterm', 'lib/xterm.js')).Terminal;\n\t\txterm = store.add(new TerminalCtor({ allowProposedApi: true, cols: 80, rows: 30 }));\n\t\tlinkManager = store.add(instantiationService.createInstance(TestLinkManager, xterm, upcastPartial<ITerminalProcessManager>({\n\t\t\tget initialCwd() {\n\t\t\t\treturn '';\n\t\t\t}\n\t\t\t// eslint-disable-next-line local/code-no-any-casts\n\t\t}), {\n\t\t\tget<T extends TerminalCapability>(capability: T): ITerminalCapabilityImplMap[T] | undefined {\n\t\t\t\treturn undefined;\n\t\t\t}\n\t\t} as Partial<ITerminalCapabilityStore> as any, instantiationService.createInstance(TerminalLinkResolver)));\n\t});\n\n\tsuite('registerExternalLinkProvider', () => {\n\t\ttest('should not leak disposables if the link manager is already disposed', () => {\n\t\t\tlinkManager.externalProvideLinksCb = async () => undefined;\n\t\t\tlinkManager.dispose();\n\t\t\tlinkManager.externalProvideLinksCb = async () => undefined;\n\t\t});\n\t});\n\n\tsuite('getLinks and open recent link', () => {\n\t\ttest('should return no links', async () => {\n\t\t\tconst links = await linkManager.getLinks();\n\t\t\tequals(links.viewport.webLinks, []);\n\t\t\tequals(links.viewport.wordLinks, []);\n\t\t\tequals(links.viewport.fileLinks, []);\n\t\t\tconst webLink = await linkManager.openRecentLink('url');\n\t\t\tstrictEqual(webLink, undefined);\n\t\t\tconst fileLink = await linkManager.openRecentLink('localFile');\n\t\t\tstrictEqual(fileLink, undefined);\n\t\t});\n\t\ttest('should return word links in order', async () => {\n\t\t\tconst link1 = {\n\t\t\t\trange: {\n\t\t\t\t\tstart: { x: 1, y: 1 }, end: { x: 14, y: 1 }\n\t\t\t\t},\n\t\t\t\ttext: '1_我是学生.txt',\n\t\t\t\tactivate: () => Promise.resolve('')\n\t\t\t};\n\t\t\tconst link2 = {\n\t\t\t\trange: {\n\t\t\t\t\tstart: { x: 1, y: 1 }, end: { x: 14, y: 1 }\n\t\t\t\t},\n\t\t\t\ttext: '2_我是学生.txt',\n\t\t\t\tactivate: () => Promise.resolve('')\n\t\t\t};\n\t\t\tlinkManager.setLinks({ wordLinks: [link1, link2] });\n\t\t\tconst links = await linkManager.getLinks();\n\t\t\tdeepStrictEqual(links.viewport.wordLinks?.[0].text, link2.text);\n\t\t\tdeepStrictEqual(links.viewport.wordLinks?.[1].text, link1.text);\n\t\t\tconst webLink = await linkManager.openRecentLink('url');\n\t\t\tstrictEqual(webLink, undefined);\n\t\t\tconst fileLink = await linkManager.openRecentLink('localFile');\n\t\t\tstrictEqual(fileLink, undefined);\n\t\t});\n\t\ttest('should return web links in order', async () => {\n\t\t\tconst link1 = {\n\t\t\t\trange: { start: { x: 5, y: 1 }, end: { x: 40, y: 1 } },\n\t\t\t\ttext: 'https://foo.bar/[this is foo site 1]',\n\t\t\t\tactivate: () => Promise.resolve('')\n\t\t\t};\n\t\t\tconst link2 = {\n\t\t\t\trange: { start: { x: 5, y: 2 }, end: { x: 40, y: 2 } },\n\t\t\t\ttext: 'https://foo.bar/[this is foo site 2]',\n\t\t\t\tactivate: () => Promise.resolve('')\n\t\t\t};\n\t\t\tlinkManager.setLinks({ webLinks: [link1, link2] });\n\t\t\tconst links = await linkManager.getLinks();\n\t\t\tdeepStrictEqual(links.viewport.webLinks?.[0].text, link2.text);\n\t\t\tdeepStrictEqual(links.viewport.webLinks?.[1].text, link1.text);\n\t\t\tconst webLink = await linkManager.openRecentLink('url');\n\t\t\tstrictEqual(webLink, link2);\n\t\t\tconst fileLink = await linkManager.openRecentLink('localFile');\n\t\t\tstrictEqual(fileLink, undefined);\n\t\t});\n\t\ttest('should return file links in order', async () => {\n\t\t\tconst link1 = {\n\t\t\t\trange: { start: { x: 1, y: 1 }, end: { x: 32, y: 1 } },\n\t\t\t\ttext: 'file:///C:/users/test/file_1.txt',\n\t\t\t\tactivate: () => Promise.resolve('')\n\t\t\t};\n\t\t\tconst link2 = {\n\t\t\t\trange: { start: { x: 1, y: 2 }, end: { x: 32, y: 2 } },\n\t\t\t\ttext: 'file:///C:/users/test/file_2.txt',\n\t\t\t\tactivate: () => Promise.resolve('')\n\t\t\t};\n\t\t\tlinkManager.setLinks({ fileLinks: [link1, link2] });\n\t\t\tconst links = await linkManager.getLinks();\n\t\t\tdeepStrictEqual(links.viewport.fileLinks?.[0].text, link2.text);\n\t\t\tdeepStrictEqual(links.viewport.fileLinks?.[1].text, link1.text);\n\t\t\tconst webLink = await linkManager.openRecentLink('url');\n\t\t\tstrictEqual(webLink, undefined);\n\t\t\tlinkManager.setLinks({ fileLinks: [link2] });\n\t\t\tconst fileLink = await linkManager.openRecentLink('localFile');\n\t\t\tstrictEqual(fileLink, link2);\n\t\t});\n\t});\n});\nfunction upcastPartial<T>(v: Partial<T>): T {\n\treturn v as T;\n}\n"]}