{"version":3,"sources":["vs/workbench/contrib/terminalContrib/links/browser/terminalLinkDetectorAdapter.ts"],"names":[],"mappings":"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","file":"terminalLinkDetectorAdapter.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Emitter } from '../../../../../base/common/event.js';\nimport { Disposable, DisposableStore } from '../../../../../base/common/lifecycle.js';\nimport { localize } from '../../../../../nls.js';\nimport { IInstantiationService } from '../../../../../platform/instantiation/common/instantiation.js';\nimport { ITerminalLinkDetector, ITerminalSimpleLink, TerminalBuiltinLinkType, TerminalLinkType } from './links.js';\nimport { TerminalLink } from './terminalLink.js';\nimport { XtermLinkMatcherHandler } from './terminalLinkManager.js';\nimport type { IBufferLine, ILink, ILinkProvider, IViewportRange } from '@xterm/xterm';\n\nexport interface IActivateLinkEvent {\n\tlink: ITerminalSimpleLink;\n\tevent?: MouseEvent;\n}\n\nexport interface IShowHoverEvent {\n\tlink: TerminalLink;\n\tviewportRange: IViewportRange;\n\tmodifierDownCallback?: () => void;\n\tmodifierUpCallback?: () => void;\n}\n\n/**\n * Wrap a link detector object so it can be used in xterm.js\n */\nexport class TerminalLinkDetectorAdapter extends Disposable implements ILinkProvider {\n\tprivate readonly _activeLinksStore = this._register(new DisposableStore());\n\n\tprivate readonly _onDidActivateLink = this._register(new Emitter<IActivateLinkEvent>());\n\treadonly onDidActivateLink = this._onDidActivateLink.event;\n\tprivate readonly _onDidShowHover = this._register(new Emitter<IShowHoverEvent>());\n\treadonly onDidShowHover = this._onDidShowHover.event;\n\n\tconstructor(\n\t\tprivate readonly _detector: ITerminalLinkDetector,\n\t\t@IInstantiationService private readonly _instantiationService: IInstantiationService,\n\t) {\n\t\tsuper();\n\t}\n\n\tprivate _activeProvideLinkRequests: Map<number, Promise<TerminalLink[]>> = new Map();\n\tasync provideLinks(bufferLineNumber: number, callback: (links: ILink[] | undefined) => void) {\n\t\tlet activeRequest = this._activeProvideLinkRequests.get(bufferLineNumber);\n\t\tif (activeRequest) {\n\t\t\tconst links = await activeRequest;\n\t\t\tcallback(links);\n\t\t\treturn;\n\t\t}\n\t\tthis._activeLinksStore.clear();\n\t\tactiveRequest = this._provideLinks(bufferLineNumber);\n\t\tthis._activeProvideLinkRequests.set(bufferLineNumber, activeRequest);\n\t\tconst links = await activeRequest;\n\t\tthis._activeProvideLinkRequests.delete(bufferLineNumber);\n\t\tcallback(links);\n\t}\n\n\tprivate async _provideLinks(bufferLineNumber: number): Promise<TerminalLink[]> {\n\t\t// Dispose of all old links if new links are provided, links are only cached for the current line\n\t\tconst links: TerminalLink[] = [];\n\n\t\tlet startLine = bufferLineNumber - 1;\n\t\tlet endLine = startLine;\n\n\t\tconst lines: IBufferLine[] = [\n\t\t\tthis._detector.xterm.buffer.active.getLine(startLine)!\n\t\t];\n\n\t\t// Cap the maximum context on either side of the line being provided, by taking the context\n\t\t// around the line being provided for this ensures the line the pointer is on will have\n\t\t// links provided.\n\t\tconst maxCharacterContext = Math.max(this._detector.maxLinkLength, this._detector.xterm.cols);\n\t\tconst maxLineContext = Math.ceil(maxCharacterContext / this._detector.xterm.cols);\n\t\tconst minStartLine = Math.max(startLine - maxLineContext, 0);\n\t\tconst maxEndLine = Math.min(endLine + maxLineContext, this._detector.xterm.buffer.active.length);\n\n\t\twhile (startLine >= minStartLine && this._detector.xterm.buffer.active.getLine(startLine)?.isWrapped) {\n\t\t\tlines.unshift(this._detector.xterm.buffer.active.getLine(startLine - 1)!);\n\t\t\tstartLine--;\n\t\t}\n\n\t\twhile (endLine < maxEndLine && this._detector.xterm.buffer.active.getLine(endLine + 1)?.isWrapped) {\n\t\t\tlines.push(this._detector.xterm.buffer.active.getLine(endLine + 1)!);\n\t\t\tendLine++;\n\t\t}\n\n\t\tconst detectedLinks = await this._detector.detect(lines, startLine, endLine);\n\t\tfor (const link of detectedLinks) {\n\t\t\tconst terminalLink = this._createTerminalLink(link, async (event) => this._onDidActivateLink.fire({ link, event }));\n\t\t\tlinks.push(terminalLink);\n\t\t\tthis._activeLinksStore.add(terminalLink);\n\t\t}\n\n\t\treturn links;\n\t}\n\n\tprivate _createTerminalLink(l: ITerminalSimpleLink, activateCallback: XtermLinkMatcherHandler): TerminalLink {\n\t\t// Remove trailing colon if there is one so the link is more useful\n\t\tif (!l.disableTrimColon && l.text.length > 0 && l.text.charAt(l.text.length - 1) === ':') {\n\t\t\tl.text = l.text.slice(0, -1);\n\t\t\tl.bufferRange.end.x--;\n\t\t}\n\t\treturn this._instantiationService.createInstance(TerminalLink,\n\t\t\tthis._detector.xterm,\n\t\t\tl.bufferRange,\n\t\t\tl.text,\n\t\t\tl.uri,\n\t\t\tl.parsedLink,\n\t\t\tl.actions,\n\t\t\tthis._detector.xterm.buffer.active.viewportY,\n\t\t\tactivateCallback,\n\t\t\t(link, viewportRange, modifierDownCallback, modifierUpCallback) => this._onDidShowHover.fire({\n\t\t\t\tlink,\n\t\t\t\tviewportRange,\n\t\t\t\tmodifierDownCallback,\n\t\t\t\tmodifierUpCallback\n\t\t\t}),\n\t\t\tl.type !== TerminalBuiltinLinkType.Search, // Only search is low confidence\n\t\t\tl.label || this._getLabel(l.type),\n\t\t\tl.type\n\t\t);\n\t}\n\n\tprivate _getLabel(type: TerminalLinkType): string {\n\t\tswitch (type) {\n\t\t\tcase TerminalBuiltinLinkType.Search: return localize('searchWorkspace', 'Search workspace');\n\t\t\tcase TerminalBuiltinLinkType.LocalFile: return localize('openFile', 'Open file in editor');\n\t\t\tcase TerminalBuiltinLinkType.LocalFolderInWorkspace: return localize('focusFolder', 'Focus folder in explorer');\n\t\t\tcase TerminalBuiltinLinkType.LocalFolderOutsideWorkspace: return localize('openFolder', 'Open folder in new window');\n\t\t\tcase TerminalBuiltinLinkType.Url:\n\t\t\tdefault:\n\t\t\t\treturn localize('followLink', 'Follow link');\n\t\t}\n\t}\n}\n"]}