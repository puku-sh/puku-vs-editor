{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/contrib/terminalContrib/links/browser/terminalUriLinkDetector.ts","vs/workbench/contrib/terminalContrib/links/browser/terminalUriLinkDetector.ts"],"names":[],"mappings":"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","file":"terminalUriLinkDetector.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Schemas } from '../../../../../base/common/network.js';\nimport { URI } from '../../../../../base/common/uri.js';\nimport { ILinkComputerTarget, LinkComputer } from '../../../../../editor/common/languages/linkComputer.js';\nimport { IUriIdentityService } from '../../../../../platform/uriIdentity/common/uriIdentity.js';\nimport { IWorkspaceContextService } from '../../../../../platform/workspace/common/workspace.js';\nimport { ITerminalLinkDetector, ITerminalLinkResolver, ITerminalSimpleLink, TerminalBuiltinLinkType } from './links.js';\nimport { convertLinkRangeToBuffer, getXtermLineContent } from './terminalLinkHelpers.js';\nimport { getTerminalLinkType } from './terminalLocalLinkDetector.js';\nimport { ITerminalProcessManager } from '../../../terminal/common/terminal.js';\nimport type { IBufferLine, Terminal } from '@xterm/xterm';\nimport { ITerminalBackend, ITerminalLogService } from '../../../../../platform/terminal/common/terminal.js';\nimport { isString } from '../../../../../base/common/types.js';\n\nconst enum Constants {\n\t/**\n\t * The maximum number of links in a line to resolve against the file system. This limit is put\n\t * in place to avoid sending excessive data when remote connections are in place.\n\t */\n\tMaxResolvedLinksInLine = 10\n}\n\nexport class TerminalUriLinkDetector implements ITerminalLinkDetector {\n\tstatic id = 'uri';\n\n\t// 2048 is the maximum URL length\n\treadonly maxLinkLength = 2048;\n\n\tconstructor(\n\t\treadonly xterm: Terminal,\n\t\tprivate readonly _processManager: Pick<ITerminalProcessManager, 'initialCwd' | 'os' | 'remoteAuthority' | 'userHome'> & { backend?: Pick<ITerminalBackend, 'getWslPath'> },\n\t\tprivate readonly _linkResolver: ITerminalLinkResolver,\n\t\t@ITerminalLogService private readonly _logService: ITerminalLogService,\n\t\t@IUriIdentityService private readonly _uriIdentityService: IUriIdentityService,\n\t\t@IWorkspaceContextService private readonly _workspaceContextService: IWorkspaceContextService\n\t) {\n\t}\n\n\tasync detect(lines: IBufferLine[], startLine: number, endLine: number): Promise<ITerminalSimpleLink[]> {\n\t\tconst links: ITerminalSimpleLink[] = [];\n\n\t\tconst linkComputerTarget = new TerminalLinkAdapter(this.xterm, startLine, endLine);\n\t\tconst computedLinks = LinkComputer.computeLinks(linkComputerTarget);\n\n\t\tlet resolvedLinkCount = 0;\n\t\tthis._logService.trace('terminalUriLinkDetector#detect computedLinks', computedLinks);\n\t\tfor (const computedLink of computedLinks) {\n\t\t\tconst bufferRange = convertLinkRangeToBuffer(lines, this.xterm.cols, computedLink.range, startLine);\n\n\t\t\t// Check if the link is within the mouse position\n\t\t\tconst uri = computedLink.url\n\t\t\t\t? (isString(computedLink.url) ? URI.parse(this._excludeLineAndColSuffix(computedLink.url)) : computedLink.url)\n\t\t\t\t: undefined;\n\n\t\t\tif (!uri) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tconst text = computedLink.url?.toString() || '';\n\n\t\t\t// Don't try resolve any links of excessive length\n\t\t\tif (text.length > this.maxLinkLength) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t// Handle non-file scheme links\n\t\t\tif (uri.scheme !== Schemas.file) {\n\t\t\t\tlinks.push({\n\t\t\t\t\ttext,\n\t\t\t\t\turi,\n\t\t\t\t\tbufferRange,\n\t\t\t\t\ttype: TerminalBuiltinLinkType.Url\n\t\t\t\t});\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t// Filter out URI with unrecognized authorities\n\t\t\tif (uri.authority.length !== 2 && uri.authority.endsWith(':')) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t// As a fallback URI, treat the authority as local to the workspace. This is required\n\t\t\t// for `ls --hyperlink` support for example which includes the hostname in the URI like\n\t\t\t// `file://Some-Hostname/mnt/c/foo/bar`.\n\t\t\tconst uriCandidates: URI[] = [uri];\n\t\t\tif (uri.authority.length > 0) {\n\t\t\t\turiCandidates.push(URI.from({ ...uri, authority: undefined }));\n\t\t\t}\n\n\t\t\t// Iterate over all candidates, pushing the candidate on the first that's verified\n\t\t\tthis._logService.trace('terminalUriLinkDetector#detect uriCandidates', uriCandidates);\n\t\t\tfor (const uriCandidate of uriCandidates) {\n\t\t\t\tconst linkStat = await this._linkResolver.resolveLink(this._processManager, text, uriCandidate);\n\n\t\t\t\t// Create the link if validated\n\t\t\t\tif (linkStat) {\n\t\t\t\t\tconst type = getTerminalLinkType(uriCandidate, linkStat.isDirectory, this._uriIdentityService, this._workspaceContextService);\n\t\t\t\t\tconst simpleLink: ITerminalSimpleLink = {\n\t\t\t\t\t\t// Use computedLink.url if it's a string to retain the line/col suffix\n\t\t\t\t\t\ttext: isString(computedLink.url) ? computedLink.url : linkStat.link,\n\t\t\t\t\t\turi: uriCandidate,\n\t\t\t\t\t\tbufferRange,\n\t\t\t\t\t\ttype\n\t\t\t\t\t};\n\t\t\t\t\tthis._logService.trace('terminalUriLinkDetector#detect verified link', simpleLink);\n\t\t\t\t\tlinks.push(simpleLink);\n\t\t\t\t\tresolvedLinkCount++;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Stop early if too many links exist in the line\n\t\t\tif (++resolvedLinkCount >= Constants.MaxResolvedLinksInLine) {\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\treturn links;\n\t}\n\n\tprivate _excludeLineAndColSuffix(path: string): string {\n\t\treturn path.replace(/:\\d+(:\\d+)?$/, '');\n\t}\n}\n\nclass TerminalLinkAdapter implements ILinkComputerTarget {\n\tconstructor(\n\t\tprivate _xterm: Terminal,\n\t\tprivate _lineStart: number,\n\t\tprivate _lineEnd: number\n\t) { }\n\n\tgetLineCount(): number {\n\t\treturn 1;\n\t}\n\n\tgetLineContent(): string {\n\t\treturn getXtermLineContent(this._xterm.buffer.active, this._lineStart, this._lineEnd, this._xterm.cols);\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Schemas } from '../../../../../base/common/network.js';\nimport { URI } from '../../../../../base/common/uri.js';\nimport { ILinkComputerTarget, LinkComputer } from '../../../../../editor/common/languages/linkComputer.js';\nimport { IUriIdentityService } from '../../../../../platform/uriIdentity/common/uriIdentity.js';\nimport { IWorkspaceContextService } from '../../../../../platform/workspace/common/workspace.js';\nimport { ITerminalLinkDetector, ITerminalLinkResolver, ITerminalSimpleLink, TerminalBuiltinLinkType } from './links.js';\nimport { convertLinkRangeToBuffer, getXtermLineContent } from './terminalLinkHelpers.js';\nimport { getTerminalLinkType } from './terminalLocalLinkDetector.js';\nimport { ITerminalProcessManager } from '../../../terminal/common/terminal.js';\nimport type { IBufferLine, Terminal } from '@xterm/xterm';\nimport { ITerminalBackend, ITerminalLogService } from '../../../../../platform/terminal/common/terminal.js';\nimport { isString } from '../../../../../base/common/types.js';\n\nconst enum Constants {\n\t/**\n\t * The maximum number of links in a line to resolve against the file system. This limit is put\n\t * in place to avoid sending excessive data when remote connections are in place.\n\t */\n\tMaxResolvedLinksInLine = 10\n}\n\nexport class TerminalUriLinkDetector implements ITerminalLinkDetector {\n\tstatic id = 'uri';\n\n\t// 2048 is the maximum URL length\n\treadonly maxLinkLength = 2048;\n\n\tconstructor(\n\t\treadonly xterm: Terminal,\n\t\tprivate readonly _processManager: Pick<ITerminalProcessManager, 'initialCwd' | 'os' | 'remoteAuthority' | 'userHome'> & { backend?: Pick<ITerminalBackend, 'getWslPath'> },\n\t\tprivate readonly _linkResolver: ITerminalLinkResolver,\n\t\t@ITerminalLogService private readonly _logService: ITerminalLogService,\n\t\t@IUriIdentityService private readonly _uriIdentityService: IUriIdentityService,\n\t\t@IWorkspaceContextService private readonly _workspaceContextService: IWorkspaceContextService\n\t) {\n\t}\n\n\tasync detect(lines: IBufferLine[], startLine: number, endLine: number): Promise<ITerminalSimpleLink[]> {\n\t\tconst links: ITerminalSimpleLink[] = [];\n\n\t\tconst linkComputerTarget = new TerminalLinkAdapter(this.xterm, startLine, endLine);\n\t\tconst computedLinks = LinkComputer.computeLinks(linkComputerTarget);\n\n\t\tlet resolvedLinkCount = 0;\n\t\tthis._logService.trace('terminalUriLinkDetector#detect computedLinks', computedLinks);\n\t\tfor (const computedLink of computedLinks) {\n\t\t\tconst bufferRange = convertLinkRangeToBuffer(lines, this.xterm.cols, computedLink.range, startLine);\n\n\t\t\t// Check if the link is within the mouse position\n\t\t\tconst uri = computedLink.url\n\t\t\t\t? (isString(computedLink.url) ? URI.parse(this._excludeLineAndColSuffix(computedLink.url)) : computedLink.url)\n\t\t\t\t: undefined;\n\n\t\t\tif (!uri) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tconst text = computedLink.url?.toString() || '';\n\n\t\t\t// Don't try resolve any links of excessive length\n\t\t\tif (text.length > this.maxLinkLength) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t// Handle non-file scheme links\n\t\t\tif (uri.scheme !== Schemas.file) {\n\t\t\t\tlinks.push({\n\t\t\t\t\ttext,\n\t\t\t\t\turi,\n\t\t\t\t\tbufferRange,\n\t\t\t\t\ttype: TerminalBuiltinLinkType.Url\n\t\t\t\t});\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t// Filter out URI with unrecognized authorities\n\t\t\tif (uri.authority.length !== 2 && uri.authority.endsWith(':')) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t// As a fallback URI, treat the authority as local to the workspace. This is required\n\t\t\t// for `ls --hyperlink` support for example which includes the hostname in the URI like\n\t\t\t// `file://Some-Hostname/mnt/c/foo/bar`.\n\t\t\tconst uriCandidates: URI[] = [uri];\n\t\t\tif (uri.authority.length > 0) {\n\t\t\t\turiCandidates.push(URI.from({ ...uri, authority: undefined }));\n\t\t\t}\n\n\t\t\t// Iterate over all candidates, pushing the candidate on the first that's verified\n\t\t\tthis._logService.trace('terminalUriLinkDetector#detect uriCandidates', uriCandidates);\n\t\t\tfor (const uriCandidate of uriCandidates) {\n\t\t\t\tconst linkStat = await this._linkResolver.resolveLink(this._processManager, text, uriCandidate);\n\n\t\t\t\t// Create the link if validated\n\t\t\t\tif (linkStat) {\n\t\t\t\t\tconst type = getTerminalLinkType(uriCandidate, linkStat.isDirectory, this._uriIdentityService, this._workspaceContextService);\n\t\t\t\t\tconst simpleLink: ITerminalSimpleLink = {\n\t\t\t\t\t\t// Use computedLink.url if it's a string to retain the line/col suffix\n\t\t\t\t\t\ttext: isString(computedLink.url) ? computedLink.url : linkStat.link,\n\t\t\t\t\t\turi: uriCandidate,\n\t\t\t\t\t\tbufferRange,\n\t\t\t\t\t\ttype\n\t\t\t\t\t};\n\t\t\t\t\tthis._logService.trace('terminalUriLinkDetector#detect verified link', simpleLink);\n\t\t\t\t\tlinks.push(simpleLink);\n\t\t\t\t\tresolvedLinkCount++;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Stop early if too many links exist in the line\n\t\t\tif (++resolvedLinkCount >= Constants.MaxResolvedLinksInLine) {\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\treturn links;\n\t}\n\n\tprivate _excludeLineAndColSuffix(path: string): string {\n\t\treturn path.replace(/:\\d+(:\\d+)?$/, '');\n\t}\n}\n\nclass TerminalLinkAdapter implements ILinkComputerTarget {\n\tconstructor(\n\t\tprivate _xterm: Terminal,\n\t\tprivate _lineStart: number,\n\t\tprivate _lineEnd: number\n\t) { }\n\n\tgetLineCount(): number {\n\t\treturn 1;\n\t}\n\n\tgetLineContent(): string {\n\t\treturn getXtermLineContent(this._xterm.buffer.active, this._lineStart, this._lineEnd, this._xterm.cols);\n\t}\n}\n"]}