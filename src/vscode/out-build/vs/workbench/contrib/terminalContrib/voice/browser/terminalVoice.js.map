{"version":3,"sources":["vs/workbench/contrib/terminalContrib/voice/browser/terminalVoice.ts"],"names":[],"mappings":"AAAA;;;gGAGgG;;;;;;;;;;;AAEhG,OAAO,EAAE,gBAAgB,EAAE,MAAM,qCAAqC,CAAC;AACvE,OAAO,EAAE,uBAAuB,EAAE,MAAM,4CAA4C,CAAC;AACrF,OAAO,EAAE,OAAO,EAAE,MAAM,wCAAwC,CAAC;AACjE,OAAO,EAAE,UAAU,EAAE,eAAe,EAAE,YAAY,EAAE,MAAM,yCAAyC,CAAC;AACpG,OAAO,EAAE,SAAS,EAAE,MAAM,yCAAyC,CAAC;AACpE,OAAO,EAAE,QAAQ,EAAE,MAAM,qCAAqC,CAAC;AAC/D,OAAO,EAAE,QAAQ,EAAE,MAAM,uBAAuB,CAAC;AACjD,OAAO,EAAE,qBAAqB,EAAE,MAAM,+DAA+D,CAAC;AACtG,OAAO,EAAe,kBAAkB,EAAE,MAAM,yDAAyD,CAAC;AAE1G,OAAO,EAAE,oBAAoB,EAAE,MAAM,8DAA8D,CAAC;AACpG,OAAO,EAAE,cAAc,EAAmD,kBAAkB,EAAE,MAAM,yCAAyC,CAAC;AAE9I,OAAO,EAAE,KAAK,EAAE,MAAM,6CAA6C,CAAC;AACpE,OAAO,EAAE,gBAAgB,EAAE,MAAM,uCAAuC,CAAC;AACzE,OAAO,EAAE,mBAAmB,EAAE,MAAM,gDAAgD,CAAC;AAGrF,MAAM,SAAS,GAA8B;IAC5C,WAAW,EAAE,GAAG;IAChB,WAAW,EAAE,GAAG;IAChB,QAAQ,EAAE,GAAG;IACb,QAAQ,EAAE,GAAG;IACb,SAAS,EAAE,GAAG;IACd,SAAS,EAAE,GAAG;IACd,UAAU,EAAE,GAAG;IACf,UAAU,EAAE,GAAG;IACf,MAAM,EAAE,GAAG;IACX,MAAM,EAAE,GAAG;IACX,QAAQ,EAAE,GAAG;IACb,QAAQ,EAAE,GAAG;IACb,aAAa,EAAE,GAAG;IAClB,aAAa,EAAE,GAAG;IAClB,OAAO,EAAE,GAAG;IACZ,OAAO,EAAE,GAAG;IACZ,WAAW,EAAE,IAAI;IACjB,WAAW,EAAE,IAAI;IACjB,KAAK,EAAE,GAAG;IACV,KAAK,EAAE,GAAG;IACV,QAAQ,EAAE,GAAG;IACb,QAAQ,EAAE,GAAG;IACb,OAAO,EAAE,IAAI;IACb,OAAO,EAAE,IAAI;IACb,cAAc,EAAE,GAAG;IACnB,cAAc,EAAE,GAAG;CACnB,CAAC;AAEK,IAAM,oBAAoB,GAA1B,MAAM,oBAAqB,SAAQ,UAAU;;aAMpC,cAAS,GAAqC,SAArC,AAA8C,CAAC;IAGvE,MAAM,CAAC,WAAW,CAAC,oBAA2C;QAC7D,IAAI,CAAC,sBAAoB,CAAC,SAAS,EAAE,CAAC;YACrC,sBAAoB,CAAC,SAAS,GAAG,oBAAoB,CAAC,cAAc,CAAC,sBAAoB,CAAC,CAAC;QAC5F,CAAC;QAED,OAAO,sBAAoB,CAAC,SAAS,CAAC;IACvC,CAAC;IAGD,YACiB,cAA+C,EAC7C,gBAAmD,EAC9C,qBAA6D,EAChE,iBAAqC;QAEzD,KAAK,EAAE,CAAC;QALyB,mBAAc,GAAd,cAAc,CAAgB;QAC5B,qBAAgB,GAAhB,gBAAgB,CAAkB;QAC7B,0BAAqB,GAArB,qBAAqB,CAAuB;QApB7E,WAAM,GAAW,EAAE,CAAC;QAwB3B,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,gBAAgB,CAAC,yBAAyB,CAAC,GAAG,EAAE,CAAC,IAAI,CAAC,IAAI,EAAE,CAAC,CAAC,CAAC;QACnF,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,gBAAgB,CAAC,oBAAoB,CAAC,GAAG,EAAE,CAAC,IAAI,CAAC,IAAI,EAAE,CAAC,CAAC,CAAC;QAC9E,IAAI,CAAC,YAAY,GAAG,IAAI,CAAC,SAAS,CAAC,IAAI,eAAe,EAAE,CAAC,CAAC;QAC1D,IAAI,CAAC,4BAA4B,GAAG,mBAAmB,CAAC,2BAA2B,CAAC,MAAM,CAAC,iBAAiB,CAAC,CAAC;IAC/G,CAAC;IAED,KAAK,CAAC,KAAK;QACV,IAAI,CAAC,IAAI,EAAE,CAAC;QACZ,IAAI,YAAY,GAAG,IAAI,CAAC,qBAAqB,CAAC,QAAQ,qFAAmD,CAAC;QAC1G,IAAI,CAAC,QAAQ,CAAC,YAAY,CAAC,IAAI,YAAY,GAAG,CAAC,EAAE,CAAC;YACjD,YAAY,GAAG,oBAAoB,CAAC;QACrC,CAAC;QACD,IAAI,CAAC,6BAA6B,GAAG,IAAI,CAAC,YAAY,CAAC,GAAG,CAAC,IAAI,gBAAgB,CAAC,GAAG,EAAE;YACpF,IAAI,CAAC,SAAS,EAAE,CAAC;YACjB,IAAI,CAAC,IAAI,EAAE,CAAC;QACb,CAAC,EAAE,YAAY,CAAC,CAAC,CAAC;QAClB,IAAI,CAAC,wBAAwB,GAAG,IAAI,uBAAuB,EAAE,CAAC;QAC9D,IAAI,CAAC,SAAS,CAAC,YAAY,CAAC,GAAG,EAAE,CAAC,IAAI,CAAC,wBAAwB,EAAE,OAAO,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;QACjF,MAAM,OAAO,GAAG,MAAM,IAAI,CAAC,cAAc,CAAC,yBAAyB,CAAC,IAAI,CAAC,wBAAwB,EAAE,KAAK,EAAE,UAAU,CAAC,CAAC;QAEtH,IAAI,CAAC,YAAY,CAAC,GAAG,CAAC,OAAO,CAAC,WAAW,CAAC,CAAC,CAAC,EAAE,EAAE;YAC/C,IAAI,IAAI,CAAC,wBAAwB,EAAE,KAAK,CAAC,uBAAuB,EAAE,CAAC;gBAClE,OAAO;YACR,CAAC;YACD,QAAQ,CAAC,CAAC,MAAM,EAAE,CAAC;gBAClB,KAAK,kBAAkB,CAAC,OAAO;oBAC9B,IAAI,CAAC,4BAA4B,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC;oBAC5C,IAAI,CAAC,IAAI,CAAC,WAAW,EAAE,CAAC;wBACvB,IAAI,CAAC,iBAAiB,EAAE,CAAC;oBAC1B,CAAC;oBACD,MAAM;gBACP,KAAK,kBAAkB,CAAC,WAAW,CAAC,CAAC,CAAC;oBACrC,IAAI,CAAC,YAAY,CAAC,CAAC,CAAC,CAAC;oBACrB,IAAI,CAAC,gBAAgB,CAAC,CAAC,CAAC,CAAC;oBACzB,IAAI,CAAC,iBAAiB,EAAE,CAAC;oBACzB,IAAI,YAAY,GAAG,CAAC,EAAE,CAAC;wBACtB,IAAI,CAAC,6BAA8B,CAAC,MAAM,EAAE,CAAC;oBAC9C,CAAC;oBACD,MAAM;gBACP,CAAC;gBACD,KAAK,kBAAkB,CAAC,UAAU;oBACjC,IAAI,CAAC,YAAY,CAAC,CAAC,CAAC,CAAC;oBACrB,IAAI,YAAY,GAAG,CAAC,EAAE,CAAC;wBACtB,IAAI,CAAC,6BAA8B,CAAC,QAAQ,EAAE,CAAC;oBAChD,CAAC;oBACD,MAAM;gBACP,KAAK,kBAAkB,CAAC,OAAO;oBAC9B,IAAI,CAAC,IAAI,EAAE,CAAC;oBACZ,MAAM;YACR,CAAC;QACF,CAAC,CAAC,CAAC,CAAC;IACL,CAAC;IACD,IAAI,CAAC,IAAc;QAClB,IAAI,CAAC,YAAY,EAAE,CAAC;QACpB,IAAI,IAAI,EAAE,CAAC;YACV,IAAI,CAAC,6BAA8B,CAAC,MAAM,EAAE,CAAC;YAC7C,IAAI,CAAC,SAAS,EAAE,CAAC;QAClB,CAAC;QACD,IAAI,CAAC,UAAU,GAAG,SAAS,CAAC;QAC5B,IAAI,CAAC,WAAW,EAAE,OAAO,EAAE,CAAC;QAC5B,IAAI,CAAC,WAAW,GAAG,SAAS,CAAC;QAC7B,IAAI,CAAC,OAAO,EAAE,OAAO,EAAE,CAAC;QACxB,IAAI,CAAC,OAAO,GAAG,SAAS,CAAC;QACzB,IAAI,CAAC,gBAAgB,GAAG,SAAS,CAAC;QAClC,IAAI,CAAC,wBAAwB,EAAE,MAAM,EAAE,CAAC;QACxC,IAAI,CAAC,YAAY,CAAC,KAAK,EAAE,CAAC;QAC1B,IAAI,CAAC,MAAM,GAAG,EAAE,CAAC;QACjB,IAAI,CAAC,4BAA4B,CAAC,KAAK,EAAE,CAAC;IAC3C,CAAC;IAEO,SAAS;QAChB,IAAI,CAAC,gBAAgB,CAAC,cAAc,EAAE,QAAQ,CAAC,IAAI,CAAC,MAAM,EAAE,KAAK,CAAC,CAAC;QACnE,KAAK,CAAC,QAAQ,CAAC,KAA2B,EAAE,IAAc,EAAE,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC;IAC3E,CAAC;IAEO,YAAY,CAAC,CAAqB;QACzC,IAAI,CAAC,CAAC,IAAI,EAAE,CAAC;YACZ,IAAI,KAAK,GAAG,CAAC,CAAC,IAAI,CAAC,UAAU,CAAC,UAAU,EAAE,EAAE,CAAC,CAAC;YAC9C,KAAK,MAAM,MAAM,IAAI,MAAM,CAAC,OAAO,CAAC,SAAS,CAAC,EAAE,CAAC;gBAChD,KAAK,GAAG,KAAK,CAAC,OAAO,CAAC,IAAI,MAAM,CAAC,KAAK,GAAG,MAAM,CAAC,CAAC,CAAC,GAAG,KAAK,CAAC,EAAE,MAAM,CAAC,CAAC,CAAC,CAAC,CAAC;YACzE,CAAC;YACD,IAAI,CAAC,MAAM,GAAG,GAAG,GAAG,KAAK,CAAC;QAC3B,CAAC;IACF,CAAC;IAEO,iBAAiB;QACxB,MAAM,cAAc,GAAG,IAAI,CAAC,gBAAgB,CAAC,cAAc,CAAC;QAC5D,MAAM,KAAK,GAAG,cAAc,EAAE,KAAK,EAAE,GAAG,CAAC;QACzC,IAAI,CAAC,KAAK,EAAE,CAAC;YACZ,OAAO;QACR,CAAC;QACD,MAAM,WAAW,GAAG,KAAK,CAAC,MAAM,CAAC,MAAM,CAAC,OAAO,KAAK,CAAC,CAAC;QAEtD,yEAAyE;QACzE,MAAM,WAAW,GAAG,IAAI,CAAC,MAAM,CAAC,MAAM,CAAC;QACvC,MAAM,SAAS,GAAG,KAAK,CAAC,MAAM,CAAC,MAAM,CAAC,OAAO,GAAG,WAAW,CAAC;QAE5D,IAAI,CAAC,OAAO,GAAG,cAAc,CAAC,cAAc,CAAC,WAAW,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;QACnE,IAAI,CAAC,IAAI,CAAC,OAAO,EAAE,CAAC;YACnB,OAAO;QACR,CAAC;QACD,IAAI,CAAC,WAAW,GAAG,KAAK,CAAC,kBAAkB,CAAC;YAC3C,MAAM,EAAE,IAAI,CAAC,OAAO;YACpB,KAAK,EAAE,KAAK;YACZ,CAAC,EAAE,SAAS;SACZ,CAAC,CAAC;QACH,IAAI,CAAC,IAAI,CAAC,WAAW,EAAE,CAAC;YACvB,IAAI,CAAC,OAAO,CAAC,OAAO,EAAE,CAAC;YACvB,IAAI,CAAC,OAAO,GAAG,SAAS,CAAC;YACzB,OAAO;QACR,CAAC;QACD,IAAI,CAAC,WAAW,CAAC,QAAQ,CAAC,CAAC,CAAc,EAAE,EAAE;YAC5C,CAAC,CAAC,SAAS,CAAC,GAAG,CAAC,GAAG,SAAS,CAAC,gBAAgB,CAAC,OAAO,CAAC,SAAS,CAAC,EAAE,gBAAgB,EAAE,WAAW,CAAC,CAAC;YACjG,CAAC,CAAC,KAAK,CAAC,SAAS,GAAG,WAAW,CAAC,CAAC,CAAC,uBAAuB,CAAC,CAAC,CAAC,uBAAuB,CAAC;QACrF,CAAC,CAAC,CAAC;IACJ,CAAC;IAEO,iBAAiB;QACxB,iEAAiE;QACjE,IAAI,CAAC,WAAW,EAAE,OAAO,EAAE,CAAC;QAC5B,IAAI,CAAC,OAAO,EAAE,OAAO,EAAE,CAAC;QACxB,IAAI,CAAC,WAAW,GAAG,SAAS,CAAC;QAC7B,IAAI,CAAC,OAAO,GAAG,SAAS,CAAC;QACzB,IAAI,CAAC,iBAAiB,EAAE,CAAC;IAC1B,CAAC;IAEO,YAAY;QACnB,IAAI,CAAC,WAAW,EAAE,OAAO,EAAE,SAAS,CAAC,MAAM,CAAC,WAAW,CAAC,CAAC;IAC1D,CAAC;IAEO,gBAAgB,CAAC,CAAqB;QAC7C,IAAI,CAAC,UAAU,EAAE,OAAO,EAAE,CAAC;QAC3B,MAAM,IAAI,GAAG,CAAC,CAAC,IAAI,CAAC;QACpB,IAAI,CAAC,IAAI,EAAE,CAAC;YACX,OAAO;QACR,CAAC;QACD,MAAM,cAAc,GAAG,IAAI,CAAC,gBAAgB,CAAC,cAAc,CAAC;QAC5D,MAAM,KAAK,GAAG,cAAc,EAAE,KAAK,EAAE,GAAG,CAAC;QACzC,IAAI,CAAC,KAAK,EAAE,CAAC;YACZ,OAAO;QACR,CAAC;QACD,IAAI,CAAC,gBAAgB,GAAG,cAAc,CAAC,cAAc,EAAE,CAAC;QACxD,IAAI,CAAC,IAAI,CAAC,gBAAgB,EAAE,CAAC;YAC5B,OAAO;QACR,CAAC;QACD,IAAI,CAAC,YAAY,CAAC,GAAG,CAAC,IAAI,CAAC,gBAAgB,CAAC,CAAC;QAC7C,MAAM,WAAW,GAAG,KAAK,CAAC,MAAM,CAAC,MAAM,CAAC,OAAO,KAAK,CAAC,CAAC;QACtD,IAAI,CAAC,UAAU,GAAG,KAAK,CAAC,kBAAkB,CAAC;YAC1C,MAAM,EAAE,IAAI,CAAC,gBAAgB;YAC7B,KAAK,EAAE,KAAK;YACZ,CAAC,EAAE,WAAW,CAAC,CAAC,CAAC,KAAK,CAAC,MAAM,CAAC,MAAM,CAAC,OAAO,GAAG,CAAC,CAAC,CAAC,CAAC,KAAK,CAAC,MAAM,CAAC,MAAM,CAAC,OAAO,GAAG,CAAC;SAClF,CAAC,CAAC;QACH,IAAI,IAAI,CAAC,UAAU,EAAE,CAAC;YACrB,IAAI,CAAC,YAAY,CAAC,GAAG,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC;QACxC,CAAC;QACD,IAAI,CAAC,UAAU,EAAE,QAAQ,CAAC,CAAC,CAAc,EAAE,EAAE;YAC5C,CAAC,CAAC,SAAS,CAAC,GAAG,CAAC,8BAA8B,CAAC,CAAC;YAChD,CAAC,CAAC,WAAW,GAAG,IAAI,CAAC;YACrB,CAAC,CAAC,KAAK,CAAC,KAAK,GAAG,CAAC,KAAK,CAAC,IAAI,GAAG,KAAK,CAAC,MAAM,CAAC,MAAM,CAAC,OAAO,CAAC,GAAG,KAAK,CAAC,IAAI,GAAG,GAAG,GAAG,GAAG,CAAC;QACrF,CAAC,CAAC,CAAC;IACJ,CAAC;;AAzLW,oBAAoB;IAmB9B,WAAA,cAAc,CAAA;IACd,WAAA,gBAAgB,CAAA;IAChB,WAAA,qBAAqB,CAAA;IACrB,WAAA,kBAAkB,CAAA;GAtBR,oBAAoB,CA0LhC","file":"terminalVoice.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { RunOnceScheduler } from '../../../../../base/common/async.js';\nimport { CancellationTokenSource } from '../../../../../base/common/cancellation.js';\nimport { Codicon } from '../../../../../base/common/codicons.js';\nimport { Disposable, DisposableStore, toDisposable } from '../../../../../base/common/lifecycle.js';\nimport { ThemeIcon } from '../../../../../base/common/themables.js';\nimport { isNumber } from '../../../../../base/common/types.js';\nimport { localize } from '../../../../../nls.js';\nimport { IConfigurationService } from '../../../../../platform/configuration/common/configuration.js';\nimport { IContextKey, IContextKeyService } from '../../../../../platform/contextkey/common/contextkey.js';\nimport { IInstantiationService } from '../../../../../platform/instantiation/common/instantiation.js';\nimport { SpeechTimeoutDefault } from '../../../accessibility/browser/accessibilityConfiguration.js';\nimport { ISpeechService, AccessibilityVoiceSettingId, ISpeechToTextEvent, SpeechToTextStatus } from '../../../speech/common/speechService.js';\nimport type { IMarker, IDecoration } from '@xterm/xterm';\nimport { alert } from '../../../../../base/browser/ui/aria/aria.js';\nimport { ITerminalService } from '../../../terminal/browser/terminal.js';\nimport { TerminalContextKeys } from '../../../terminal/common/terminalContextKey.js';\n\n\nconst symbolMap: { [key: string]: string } = {\n\t'Ampersand': '&',\n\t'ampersand': '&',\n\t'Dollar': '$',\n\t'dollar': '$',\n\t'Percent': '%',\n\t'percent': '%',\n\t'Asterisk': '*',\n\t'asterisk': '*',\n\t'Plus': '+',\n\t'plus': '+',\n\t'Equals': '=',\n\t'equals': '=',\n\t'Exclamation': '!',\n\t'exclamation': '!',\n\t'Slash': '/',\n\t'slash': '/',\n\t'Backslash': '\\\\',\n\t'backslash': '\\\\',\n\t'Dot': '.',\n\t'dot': '.',\n\t'Period': '.',\n\t'period': '.',\n\t'Quote': '\\'',\n\t'quote': '\\'',\n\t'double quote': '\"',\n\t'Double quote': '\"',\n};\n\nexport class TerminalVoiceSession extends Disposable {\n\tprivate _input: string = '';\n\tprivate _ghostText: IDecoration | undefined;\n\tprivate _decoration: IDecoration | undefined;\n\tprivate _marker: IMarker | undefined;\n\tprivate _ghostTextMarker: IMarker | undefined;\n\tprivate static _instance: TerminalVoiceSession | undefined = undefined;\n\tprivate _acceptTranscriptionScheduler: RunOnceScheduler | undefined;\n\tprivate readonly _terminalDictationInProgress: IContextKey<boolean>;\n\tstatic getInstance(instantiationService: IInstantiationService): TerminalVoiceSession {\n\t\tif (!TerminalVoiceSession._instance) {\n\t\t\tTerminalVoiceSession._instance = instantiationService.createInstance(TerminalVoiceSession);\n\t\t}\n\n\t\treturn TerminalVoiceSession._instance;\n\t}\n\tprivate _cancellationTokenSource: CancellationTokenSource | undefined;\n\tprivate readonly _disposables: DisposableStore;\n\tconstructor(\n\t\t@ISpeechService private readonly _speechService: ISpeechService,\n\t\t@ITerminalService private readonly _terminalService: ITerminalService,\n\t\t@IConfigurationService private readonly _configurationService: IConfigurationService,\n\t\t@IContextKeyService contextKeyService: IContextKeyService,\n\t) {\n\t\tsuper();\n\t\tthis._register(this._terminalService.onDidChangeActiveInstance(() => this.stop()));\n\t\tthis._register(this._terminalService.onDidDisposeInstance(() => this.stop()));\n\t\tthis._disposables = this._register(new DisposableStore());\n\t\tthis._terminalDictationInProgress = TerminalContextKeys.terminalDictationInProgress.bindTo(contextKeyService);\n\t}\n\n\tasync start(): Promise<void> {\n\t\tthis.stop();\n\t\tlet voiceTimeout = this._configurationService.getValue<number>(AccessibilityVoiceSettingId.SpeechTimeout);\n\t\tif (!isNumber(voiceTimeout) || voiceTimeout < 0) {\n\t\t\tvoiceTimeout = SpeechTimeoutDefault;\n\t\t}\n\t\tthis._acceptTranscriptionScheduler = this._disposables.add(new RunOnceScheduler(() => {\n\t\t\tthis._sendText();\n\t\t\tthis.stop();\n\t\t}, voiceTimeout));\n\t\tthis._cancellationTokenSource = new CancellationTokenSource();\n\t\tthis._register(toDisposable(() => this._cancellationTokenSource?.dispose(true)));\n\t\tconst session = await this._speechService.createSpeechToTextSession(this._cancellationTokenSource?.token, 'terminal');\n\n\t\tthis._disposables.add(session.onDidChange((e) => {\n\t\t\tif (this._cancellationTokenSource?.token.isCancellationRequested) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tswitch (e.status) {\n\t\t\t\tcase SpeechToTextStatus.Started:\n\t\t\t\t\tthis._terminalDictationInProgress.set(true);\n\t\t\t\t\tif (!this._decoration) {\n\t\t\t\t\t\tthis._createDecoration();\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase SpeechToTextStatus.Recognizing: {\n\t\t\t\t\tthis._updateInput(e);\n\t\t\t\t\tthis._renderGhostText(e);\n\t\t\t\t\tthis._updateDecoration();\n\t\t\t\t\tif (voiceTimeout > 0) {\n\t\t\t\t\t\tthis._acceptTranscriptionScheduler!.cancel();\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tcase SpeechToTextStatus.Recognized:\n\t\t\t\t\tthis._updateInput(e);\n\t\t\t\t\tif (voiceTimeout > 0) {\n\t\t\t\t\t\tthis._acceptTranscriptionScheduler!.schedule();\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase SpeechToTextStatus.Stopped:\n\t\t\t\t\tthis.stop();\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}));\n\t}\n\tstop(send?: boolean): void {\n\t\tthis._setInactive();\n\t\tif (send) {\n\t\t\tthis._acceptTranscriptionScheduler!.cancel();\n\t\t\tthis._sendText();\n\t\t}\n\t\tthis._ghostText = undefined;\n\t\tthis._decoration?.dispose();\n\t\tthis._decoration = undefined;\n\t\tthis._marker?.dispose();\n\t\tthis._marker = undefined;\n\t\tthis._ghostTextMarker = undefined;\n\t\tthis._cancellationTokenSource?.cancel();\n\t\tthis._disposables.clear();\n\t\tthis._input = '';\n\t\tthis._terminalDictationInProgress.reset();\n\t}\n\n\tprivate _sendText(): void {\n\t\tthis._terminalService.activeInstance?.sendText(this._input, false);\n\t\talert(localize('terminalVoiceTextInserted', '{0} inserted', this._input));\n\t}\n\n\tprivate _updateInput(e: ISpeechToTextEvent): void {\n\t\tif (e.text) {\n\t\t\tlet input = e.text.replaceAll(/[.,?;!]/g, '');\n\t\t\tfor (const symbol of Object.entries(symbolMap)) {\n\t\t\t\tinput = input.replace(new RegExp('\\\\b' + symbol[0] + '\\\\b'), symbol[1]);\n\t\t\t}\n\t\t\tthis._input = ' ' + input;\n\t\t}\n\t}\n\n\tprivate _createDecoration(): void {\n\t\tconst activeInstance = this._terminalService.activeInstance;\n\t\tconst xterm = activeInstance?.xterm?.raw;\n\t\tif (!xterm) {\n\t\t\treturn;\n\t\t}\n\t\tconst onFirstLine = xterm.buffer.active.cursorY === 0;\n\n\t\t// Calculate x position based on current cursor position and input length\n\t\tconst inputLength = this._input.length;\n\t\tconst xPosition = xterm.buffer.active.cursorX + inputLength;\n\n\t\tthis._marker = activeInstance.registerMarker(onFirstLine ? 0 : -1);\n\t\tif (!this._marker) {\n\t\t\treturn;\n\t\t}\n\t\tthis._decoration = xterm.registerDecoration({\n\t\t\tmarker: this._marker,\n\t\t\tlayer: 'top',\n\t\t\tx: xPosition,\n\t\t});\n\t\tif (!this._decoration) {\n\t\t\tthis._marker.dispose();\n\t\t\tthis._marker = undefined;\n\t\t\treturn;\n\t\t}\n\t\tthis._decoration.onRender((e: HTMLElement) => {\n\t\t\te.classList.add(...ThemeIcon.asClassNameArray(Codicon.micFilled), 'terminal-voice', 'recording');\n\t\t\te.style.transform = onFirstLine ? 'translate(10px, -2px)' : 'translate(-6px, -5px)';\n\t\t});\n\t}\n\n\tprivate _updateDecoration(): void {\n\t\t// Dispose the old decoration and recreate it at the new position\n\t\tthis._decoration?.dispose();\n\t\tthis._marker?.dispose();\n\t\tthis._decoration = undefined;\n\t\tthis._marker = undefined;\n\t\tthis._createDecoration();\n\t}\n\n\tprivate _setInactive(): void {\n\t\tthis._decoration?.element?.classList.remove('recording');\n\t}\n\n\tprivate _renderGhostText(e: ISpeechToTextEvent): void {\n\t\tthis._ghostText?.dispose();\n\t\tconst text = e.text;\n\t\tif (!text) {\n\t\t\treturn;\n\t\t}\n\t\tconst activeInstance = this._terminalService.activeInstance;\n\t\tconst xterm = activeInstance?.xterm?.raw;\n\t\tif (!xterm) {\n\t\t\treturn;\n\t\t}\n\t\tthis._ghostTextMarker = activeInstance.registerMarker();\n\t\tif (!this._ghostTextMarker) {\n\t\t\treturn;\n\t\t}\n\t\tthis._disposables.add(this._ghostTextMarker);\n\t\tconst onFirstLine = xterm.buffer.active.cursorY === 0;\n\t\tthis._ghostText = xterm.registerDecoration({\n\t\t\tmarker: this._ghostTextMarker,\n\t\t\tlayer: 'top',\n\t\t\tx: onFirstLine ? xterm.buffer.active.cursorX + 4 : xterm.buffer.active.cursorX + 1,\n\t\t});\n\t\tif (this._ghostText) {\n\t\t\tthis._disposables.add(this._ghostText);\n\t\t}\n\t\tthis._ghostText?.onRender((e: HTMLElement) => {\n\t\t\te.classList.add('terminal-voice-progress-text');\n\t\t\te.textContent = text;\n\t\t\te.style.width = (xterm.cols - xterm.buffer.active.cursorX) / xterm.cols * 100 + '%';\n\t\t});\n\t}\n}\n"]}