{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/contrib/terminalContrib/suggest/test/browser/lspTerminalModelContentProvider.test.ts","vs/workbench/contrib/terminalContrib/suggest/test/browser/lspTerminalModelContentProvider.test.ts"],"names":[],"mappings":"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","file":"lspTerminalModelContentProvider.test.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { TestInstantiationService } from '../../../../../../platform/instantiation/test/common/instantiationServiceMock.js';\nimport { ITextModelService } from '../../../../../../editor/common/services/resolverService.js';\nimport { IModelService } from '../../../../../../editor/common/services/model.js';\nimport { ITextModel } from '../../../../../../editor/common/model.js';\nimport { createTerminalLanguageVirtualUri, LspTerminalModelContentProvider } from '../../browser/lspTerminalModelContentProvider.js';\nimport * as sinon from 'sinon';\nimport assert from 'assert';\nimport { URI } from '../../../../../../base/common/uri.js';\nimport { TerminalCapabilityStore } from '../../../../../../platform/terminal/common/capabilities/terminalCapabilityStore.js';\nimport { IMarkerService } from '../../../../../../platform/markers/common/markers.js';\nimport { ILanguageService } from '../../../../../../editor/common/languages/language.js';\nimport { GeneralShellType } from '../../../../../../platform/terminal/common/terminal.js';\nimport { ITerminalCapabilityStore } from '../../../../../../platform/terminal/common/capabilities/capabilities.js';\nimport { ensureNoDisposablesAreLeakedInTestSuite } from '../../../../../../base/test/common/utils.js';\nimport { Schemas } from '../../../../../../base/common/network.js';\nimport { VSCODE_LSP_TERMINAL_PROMPT_TRACKER } from '../../browser/lspTerminalUtil.js';\n\nsuite('LspTerminalModelContentProvider', () => {\n\tconst store = ensureNoDisposablesAreLeakedInTestSuite();\n\n\tlet instantiationService: TestInstantiationService;\n\tlet capabilityStore: ITerminalCapabilityStore;\n\tlet textModelService: ITextModelService;\n\tlet modelService: IModelService;\n\tlet mockTextModel: ITextModel;\n\tlet lspTerminalModelContentProvider: LspTerminalModelContentProvider;\n\tlet virtualTerminalDocumentUri: URI;\n\tlet setValueSpy: sinon.SinonStub;\n\tlet getValueSpy: sinon.SinonStub;\n\n\tsetup(async () => {\n\t\tinstantiationService = store.add(new TestInstantiationService());\n\t\tcapabilityStore = store.add(new TerminalCapabilityStore());\n\t\tvirtualTerminalDocumentUri = URI.from({ scheme: 'vscodeTerminal', path: '/terminal1.py' });\n\n\t\t// Create stubs for the mock text model methods\n\t\tsetValueSpy = sinon.stub();\n\t\tgetValueSpy = sinon.stub();\n\n\t\tmockTextModel = {\n\t\t\tsetValue: setValueSpy,\n\t\t\tgetValue: getValueSpy,\n\t\t\tdispose: sinon.stub(),\n\t\t\tisDisposed: sinon.stub().returns(false)\n\t\t} as unknown as ITextModel;\n\n\t\t// Create a stub for modelService.getModel\n\t\tmodelService = {} as IModelService;\n\t\tmodelService.getModel = sinon.stub().callsFake((uri: URI) => {\n\t\t\treturn uri.toString() === virtualTerminalDocumentUri.toString() ? mockTextModel : null;\n\t\t});\n\n\t\t// Create stub services for instantiation service\n\t\ttextModelService = {} as ITextModelService;\n\t\ttextModelService.registerTextModelContentProvider = sinon.stub().returns({ dispose: sinon.stub() });\n\n\t\tconst markerService = {} as IMarkerService;\n\t\tmarkerService.installResourceFilter = sinon.stub().returns({ dispose: sinon.stub() });\n\n\t\tconst languageService = {} as ILanguageService;\n\n\t\t// Set up the services in the instantiation service\n\t\tinstantiationService.stub(IModelService, modelService);\n\t\tinstantiationService.stub(ITextModelService, textModelService);\n\t\tinstantiationService.stub(IMarkerService, markerService);\n\t\tinstantiationService.stub(ILanguageService, languageService);\n\n\t\t// Create the provider instance\n\t\tlspTerminalModelContentProvider = store.add(instantiationService.createInstance(\n\t\t\tLspTerminalModelContentProvider,\n\t\t\tcapabilityStore,\n\t\t\t1,\n\t\t\tvirtualTerminalDocumentUri,\n\t\t\tGeneralShellType.Python\n\t\t));\n\t});\n\n\tteardown(() => {\n\t\tsinon.restore();\n\t\tlspTerminalModelContentProvider?.dispose();\n\t});\n\n\tsuite('setContent', () => {\n\n\t\ttest('should add delimiter when setting content on empty document', () => {\n\t\t\tgetValueSpy.returns('');\n\n\t\t\tlspTerminalModelContentProvider.setContent('print(\"hello\")');\n\n\t\t\tassert.strictEqual(setValueSpy.calledOnce, true);\n\t\t\tassert.strictEqual(setValueSpy.args[0][0], VSCODE_LSP_TERMINAL_PROMPT_TRACKER);\n\t\t});\n\n\t\ttest('should update content with delimiter when document already has content', () => {\n\t\t\tconst existingContent = 'previous content\\n' + VSCODE_LSP_TERMINAL_PROMPT_TRACKER;\n\t\t\tgetValueSpy.returns(existingContent);\n\n\t\t\tlspTerminalModelContentProvider.setContent('print(\"hello\")');\n\n\t\t\tassert.strictEqual(setValueSpy.calledOnce, true);\n\t\t\tconst expectedContent = 'previous content\\n\\nprint(\"hello\")\\n' + VSCODE_LSP_TERMINAL_PROMPT_TRACKER;\n\t\t\tassert.strictEqual(setValueSpy.args[0][0], expectedContent);\n\t\t});\n\n\t\ttest('should sanitize content when delimiter is in the middle of existing content', () => {\n\t\t\t// Simulating a corrupted state where the delimiter is in the middle\n\t\t\tconst existingContent = 'previous content\\n' + VSCODE_LSP_TERMINAL_PROMPT_TRACKER + 'some extra text';\n\t\t\tgetValueSpy.returns(existingContent);\n\n\t\t\tlspTerminalModelContentProvider.setContent('print(\"hello\")');\n\n\t\t\tassert.strictEqual(setValueSpy.calledOnce, true);\n\t\t\tconst expectedContent = 'previous content\\n\\nprint(\"hello\")\\n' + VSCODE_LSP_TERMINAL_PROMPT_TRACKER;\n\t\t\tassert.strictEqual(setValueSpy.args[0][0], expectedContent);\n\t\t});\n\n\t\ttest('Mac, Linux - createTerminalLanguageVirtualUri should return the correct URI', () => {\n\t\t\tconst expectedUri = URI.from({ scheme: Schemas.vscodeTerminal, path: '/terminal1.py' });\n\t\t\tconst actualUri = createTerminalLanguageVirtualUri(1, 'py');\n\t\t\tassert.strictEqual(actualUri.toString(), expectedUri.toString());\n\t\t});\n\t});\n});\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { TestInstantiationService } from '../../../../../../platform/instantiation/test/common/instantiationServiceMock.js';\nimport { ITextModelService } from '../../../../../../editor/common/services/resolverService.js';\nimport { IModelService } from '../../../../../../editor/common/services/model.js';\nimport { ITextModel } from '../../../../../../editor/common/model.js';\nimport { createTerminalLanguageVirtualUri, LspTerminalModelContentProvider } from '../../browser/lspTerminalModelContentProvider.js';\nimport * as sinon from 'sinon';\nimport assert from 'assert';\nimport { URI } from '../../../../../../base/common/uri.js';\nimport { TerminalCapabilityStore } from '../../../../../../platform/terminal/common/capabilities/terminalCapabilityStore.js';\nimport { IMarkerService } from '../../../../../../platform/markers/common/markers.js';\nimport { ILanguageService } from '../../../../../../editor/common/languages/language.js';\nimport { GeneralShellType } from '../../../../../../platform/terminal/common/terminal.js';\nimport { ITerminalCapabilityStore } from '../../../../../../platform/terminal/common/capabilities/capabilities.js';\nimport { ensureNoDisposablesAreLeakedInTestSuite } from '../../../../../../base/test/common/utils.js';\nimport { Schemas } from '../../../../../../base/common/network.js';\nimport { VSCODE_LSP_TERMINAL_PROMPT_TRACKER } from '../../browser/lspTerminalUtil.js';\n\nsuite('LspTerminalModelContentProvider', () => {\n\tconst store = ensureNoDisposablesAreLeakedInTestSuite();\n\n\tlet instantiationService: TestInstantiationService;\n\tlet capabilityStore: ITerminalCapabilityStore;\n\tlet textModelService: ITextModelService;\n\tlet modelService: IModelService;\n\tlet mockTextModel: ITextModel;\n\tlet lspTerminalModelContentProvider: LspTerminalModelContentProvider;\n\tlet virtualTerminalDocumentUri: URI;\n\tlet setValueSpy: sinon.SinonStub;\n\tlet getValueSpy: sinon.SinonStub;\n\n\tsetup(async () => {\n\t\tinstantiationService = store.add(new TestInstantiationService());\n\t\tcapabilityStore = store.add(new TerminalCapabilityStore());\n\t\tvirtualTerminalDocumentUri = URI.from({ scheme: 'vscodeTerminal', path: '/terminal1.py' });\n\n\t\t// Create stubs for the mock text model methods\n\t\tsetValueSpy = sinon.stub();\n\t\tgetValueSpy = sinon.stub();\n\n\t\tmockTextModel = {\n\t\t\tsetValue: setValueSpy,\n\t\t\tgetValue: getValueSpy,\n\t\t\tdispose: sinon.stub(),\n\t\t\tisDisposed: sinon.stub().returns(false)\n\t\t} as unknown as ITextModel;\n\n\t\t// Create a stub for modelService.getModel\n\t\tmodelService = {} as IModelService;\n\t\tmodelService.getModel = sinon.stub().callsFake((uri: URI) => {\n\t\t\treturn uri.toString() === virtualTerminalDocumentUri.toString() ? mockTextModel : null;\n\t\t});\n\n\t\t// Create stub services for instantiation service\n\t\ttextModelService = {} as ITextModelService;\n\t\ttextModelService.registerTextModelContentProvider = sinon.stub().returns({ dispose: sinon.stub() });\n\n\t\tconst markerService = {} as IMarkerService;\n\t\tmarkerService.installResourceFilter = sinon.stub().returns({ dispose: sinon.stub() });\n\n\t\tconst languageService = {} as ILanguageService;\n\n\t\t// Set up the services in the instantiation service\n\t\tinstantiationService.stub(IModelService, modelService);\n\t\tinstantiationService.stub(ITextModelService, textModelService);\n\t\tinstantiationService.stub(IMarkerService, markerService);\n\t\tinstantiationService.stub(ILanguageService, languageService);\n\n\t\t// Create the provider instance\n\t\tlspTerminalModelContentProvider = store.add(instantiationService.createInstance(\n\t\t\tLspTerminalModelContentProvider,\n\t\t\tcapabilityStore,\n\t\t\t1,\n\t\t\tvirtualTerminalDocumentUri,\n\t\t\tGeneralShellType.Python\n\t\t));\n\t});\n\n\tteardown(() => {\n\t\tsinon.restore();\n\t\tlspTerminalModelContentProvider?.dispose();\n\t});\n\n\tsuite('setContent', () => {\n\n\t\ttest('should add delimiter when setting content on empty document', () => {\n\t\t\tgetValueSpy.returns('');\n\n\t\t\tlspTerminalModelContentProvider.setContent('print(\"hello\")');\n\n\t\t\tassert.strictEqual(setValueSpy.calledOnce, true);\n\t\t\tassert.strictEqual(setValueSpy.args[0][0], VSCODE_LSP_TERMINAL_PROMPT_TRACKER);\n\t\t});\n\n\t\ttest('should update content with delimiter when document already has content', () => {\n\t\t\tconst existingContent = 'previous content\\n' + VSCODE_LSP_TERMINAL_PROMPT_TRACKER;\n\t\t\tgetValueSpy.returns(existingContent);\n\n\t\t\tlspTerminalModelContentProvider.setContent('print(\"hello\")');\n\n\t\t\tassert.strictEqual(setValueSpy.calledOnce, true);\n\t\t\tconst expectedContent = 'previous content\\n\\nprint(\"hello\")\\n' + VSCODE_LSP_TERMINAL_PROMPT_TRACKER;\n\t\t\tassert.strictEqual(setValueSpy.args[0][0], expectedContent);\n\t\t});\n\n\t\ttest('should sanitize content when delimiter is in the middle of existing content', () => {\n\t\t\t// Simulating a corrupted state where the delimiter is in the middle\n\t\t\tconst existingContent = 'previous content\\n' + VSCODE_LSP_TERMINAL_PROMPT_TRACKER + 'some extra text';\n\t\t\tgetValueSpy.returns(existingContent);\n\n\t\t\tlspTerminalModelContentProvider.setContent('print(\"hello\")');\n\n\t\t\tassert.strictEqual(setValueSpy.calledOnce, true);\n\t\t\tconst expectedContent = 'previous content\\n\\nprint(\"hello\")\\n' + VSCODE_LSP_TERMINAL_PROMPT_TRACKER;\n\t\t\tassert.strictEqual(setValueSpy.args[0][0], expectedContent);\n\t\t});\n\n\t\ttest('Mac, Linux - createTerminalLanguageVirtualUri should return the correct URI', () => {\n\t\t\tconst expectedUri = URI.from({ scheme: Schemas.vscodeTerminal, path: '/terminal1.py' });\n\t\t\tconst actualUri = createTerminalLanguageVirtualUri(1, 'py');\n\t\t\tassert.strictEqual(actualUri.toString(), expectedUri.toString());\n\t\t});\n\t});\n});\n"]}