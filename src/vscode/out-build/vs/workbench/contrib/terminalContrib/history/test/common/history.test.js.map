{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/contrib/terminalContrib/history/test/common/history.test.ts","vs/workbench/contrib/terminalContrib/history/test/common/history.test.ts"],"names":[],"mappings":"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","file":"history.test.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { deepStrictEqual, strictEqual, ok } from 'assert';\nimport { VSBuffer } from '../../../../../../base/common/buffer.js';\nimport { Schemas } from '../../../../../../base/common/network.js';\nimport { join } from '../../../../../../base/common/path.js';\nimport { isWindows, OperatingSystem } from '../../../../../../base/common/platform.js';\nimport { env } from '../../../../../../base/common/process.js';\nimport { URI } from '../../../../../../base/common/uri.js';\nimport { ensureNoDisposablesAreLeakedInTestSuite } from '../../../../../../base/test/common/utils.js';\nimport { IConfigurationService } from '../../../../../../platform/configuration/common/configuration.js';\nimport { TestConfigurationService } from '../../../../../../platform/configuration/test/common/testConfigurationService.js';\nimport { IFileService } from '../../../../../../platform/files/common/files.js';\nimport { TestInstantiationService } from '../../../../../../platform/instantiation/test/common/instantiationServiceMock.js';\nimport { IRemoteAgentEnvironment } from '../../../../../../platform/remote/common/remoteAgentEnvironment.js';\nimport { IStorageService } from '../../../../../../platform/storage/common/storage.js';\nimport { IRemoteAgentConnection, IRemoteAgentService } from '../../../../../services/remote/common/remoteAgentService.js';\nimport { TestStorageService } from '../../../../../test/common/workbenchTestServices.js';\nimport { fetchBashHistory, fetchFishHistory, fetchPwshHistory, fetchZshHistory, sanitizeFishHistoryCmd, TerminalPersistedHistory, type ITerminalPersistedHistory } from '../../common/history.js';\n\nfunction getConfig(limit: number) {\n\treturn {\n\t\tterminal: {\n\t\t\tintegrated: {\n\t\t\t\tshellIntegration: {\n\t\t\t\t\thistory: limit\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t};\n}\n\nconst expectedCommands = [\n\t'single line command',\n\t'git commit -m \"A wrapped line in pwsh history\\n\\nSome commit description\\n\\nFixes #xyz\"',\n\t'git status',\n\t'two \"\\nline\"'\n];\n\nsuite('Terminal history', () => {\n\tconst store = ensureNoDisposablesAreLeakedInTestSuite();\n\n\tsuite('TerminalPersistedHistory', () => {\n\t\tlet history: ITerminalPersistedHistory<number>;\n\t\tlet instantiationService: TestInstantiationService;\n\t\tlet configurationService: TestConfigurationService;\n\n\t\tsetup(() => {\n\t\t\tconfigurationService = new TestConfigurationService(getConfig(5));\n\t\t\tinstantiationService = store.add(new TestInstantiationService());\n\t\t\tinstantiationService.set(IConfigurationService, configurationService);\n\t\t\tinstantiationService.set(IStorageService, store.add(new TestStorageService()));\n\n\t\t\thistory = store.add(instantiationService.createInstance(TerminalPersistedHistory<number>, 'test'));\n\t\t});\n\n\t\tteardown(() => {\n\t\t\tinstantiationService.dispose();\n\t\t});\n\n\t\ttest('should support adding items to the cache and respect LRU', () => {\n\t\t\thistory.add('foo', 1);\n\t\t\tdeepStrictEqual(Array.from(history.entries), [\n\t\t\t\t['foo', 1]\n\t\t\t]);\n\t\t\thistory.add('bar', 2);\n\t\t\tdeepStrictEqual(Array.from(history.entries), [\n\t\t\t\t['foo', 1],\n\t\t\t\t['bar', 2]\n\t\t\t]);\n\t\t\thistory.add('foo', 1);\n\t\t\tdeepStrictEqual(Array.from(history.entries), [\n\t\t\t\t['bar', 2],\n\t\t\t\t['foo', 1]\n\t\t\t]);\n\t\t});\n\n\t\ttest('should support removing specific items', () => {\n\t\t\thistory.add('1', 1);\n\t\t\thistory.add('2', 2);\n\t\t\thistory.add('3', 3);\n\t\t\thistory.add('4', 4);\n\t\t\thistory.add('5', 5);\n\t\t\tstrictEqual(Array.from(history.entries).length, 5);\n\t\t\thistory.add('6', 6);\n\t\t\tstrictEqual(Array.from(history.entries).length, 5);\n\t\t});\n\n\t\ttest('should limit the number of entries based on config', () => {\n\t\t\thistory.add('1', 1);\n\t\t\thistory.add('2', 2);\n\t\t\thistory.add('3', 3);\n\t\t\thistory.add('4', 4);\n\t\t\thistory.add('5', 5);\n\t\t\tstrictEqual(Array.from(history.entries).length, 5);\n\t\t\thistory.add('6', 6);\n\t\t\tstrictEqual(Array.from(history.entries).length, 5);\n\t\t\tconfigurationService.setUserConfiguration('terminal', getConfig(2).terminal);\n\t\t\t// eslint-disable-next-line local/code-no-any-casts\n\t\t\tconfigurationService.onDidChangeConfigurationEmitter.fire({ affectsConfiguration: () => true } as any);\n\t\t\tstrictEqual(Array.from(history.entries).length, 2);\n\t\t\thistory.add('7', 7);\n\t\t\tstrictEqual(Array.from(history.entries).length, 2);\n\t\t\tconfigurationService.setUserConfiguration('terminal', getConfig(3).terminal);\n\t\t\t// eslint-disable-next-line local/code-no-any-casts\n\t\t\tconfigurationService.onDidChangeConfigurationEmitter.fire({ affectsConfiguration: () => true } as any);\n\t\t\tstrictEqual(Array.from(history.entries).length, 2);\n\t\t\thistory.add('8', 8);\n\t\t\tstrictEqual(Array.from(history.entries).length, 3);\n\t\t\thistory.add('9', 9);\n\t\t\tstrictEqual(Array.from(history.entries).length, 3);\n\t\t});\n\n\t\ttest('should reload from storage service after recreation', () => {\n\t\t\thistory.add('1', 1);\n\t\t\thistory.add('2', 2);\n\t\t\thistory.add('3', 3);\n\t\t\tstrictEqual(Array.from(history.entries).length, 3);\n\t\t\tconst history2 = store.add(instantiationService.createInstance(TerminalPersistedHistory, 'test'));\n\t\t\tstrictEqual(Array.from(history2.entries).length, 3);\n\t\t});\n\t});\n\tsuite('fetchBashHistory', () => {\n\t\tlet fileScheme: string;\n\t\tlet filePath: string;\n\t\tconst fileContent: string = [\n\t\t\t'single line command',\n\t\t\t'git commit -m \"A wrapped line in pwsh history',\n\t\t\t'',\n\t\t\t'Some commit description',\n\t\t\t'',\n\t\t\t'Fixes #xyz\"',\n\t\t\t'git status',\n\t\t\t'two \"',\n\t\t\t'line\"'\n\t\t].join('\\n');\n\n\t\tlet instantiationService: TestInstantiationService;\n\t\tlet remoteConnection: Pick<IRemoteAgentConnection, 'remoteAuthority'> | null = null;\n\t\tlet remoteEnvironment: Pick<IRemoteAgentEnvironment, 'os'> | null = null;\n\n\t\tsetup(() => {\n\t\t\tinstantiationService = new TestInstantiationService();\n\t\t\tinstantiationService.stub(IFileService, {\n\t\t\t\tasync readFile(resource: URI) {\n\t\t\t\t\tconst expected = URI.from({ scheme: fileScheme, path: filePath });\n\t\t\t\t\tstrictEqual(resource.scheme, expected.scheme);\n\t\t\t\t\tstrictEqual(resource.path, expected.path);\n\t\t\t\t\treturn { value: VSBuffer.fromString(fileContent) };\n\t\t\t\t}\n\t\t\t} as Pick<IFileService, 'readFile'>);\n\t\t\tinstantiationService.stub(IRemoteAgentService, {\n\t\t\t\tasync getEnvironment() { return remoteEnvironment; },\n\t\t\t\tgetConnection() { return remoteConnection; }\n\t\t\t} as Pick<IRemoteAgentService, 'getConnection' | 'getEnvironment'>);\n\t\t});\n\n\t\tteardown(() => {\n\t\t\tinstantiationService.dispose();\n\t\t});\n\n\t\tif (!isWindows) {\n\t\t\tsuite('local', () => {\n\t\t\t\tlet originalEnvValues: { HOME: string | undefined };\n\t\t\t\tsetup(() => {\n\t\t\t\t\toriginalEnvValues = { HOME: env['HOME'] };\n\t\t\t\t\tenv['HOME'] = '/home/user';\n\t\t\t\t\tremoteConnection = { remoteAuthority: 'some-remote' };\n\t\t\t\t\tfileScheme = Schemas.vscodeRemote;\n\t\t\t\t\tfilePath = '/home/user/.bash_history';\n\t\t\t\t});\n\t\t\t\tteardown(() => {\n\t\t\t\t\tif (originalEnvValues['HOME'] === undefined) {\n\t\t\t\t\t\tdelete env['HOME'];\n\t\t\t\t\t} else {\n\t\t\t\t\t\tenv['HOME'] = originalEnvValues['HOME'];\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\ttest('current OS', async () => {\n\t\t\t\t\tfilePath = '/home/user/.bash_history';\n\t\t\t\t\tdeepStrictEqual((await instantiationService.invokeFunction(fetchBashHistory))!.commands, expectedCommands);\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\t\tsuite('remote', () => {\n\t\t\tlet originalEnvValues: { HOME: string | undefined };\n\t\t\tsetup(() => {\n\t\t\t\toriginalEnvValues = { HOME: env['HOME'] };\n\t\t\t\tenv['HOME'] = '/home/user';\n\t\t\t\tremoteConnection = { remoteAuthority: 'some-remote' };\n\t\t\t\tfileScheme = Schemas.vscodeRemote;\n\t\t\t\tfilePath = '/home/user/.bash_history';\n\t\t\t});\n\t\t\tteardown(() => {\n\t\t\t\tif (originalEnvValues['HOME'] === undefined) {\n\t\t\t\t\tdelete env['HOME'];\n\t\t\t\t} else {\n\t\t\t\t\tenv['HOME'] = originalEnvValues['HOME'];\n\t\t\t\t}\n\t\t\t});\n\t\t\ttest('Windows', async () => {\n\t\t\t\tremoteEnvironment = { os: OperatingSystem.Windows };\n\t\t\t\tstrictEqual(await instantiationService.invokeFunction(fetchBashHistory), undefined);\n\t\t\t});\n\t\t\ttest('macOS', async () => {\n\t\t\t\tremoteEnvironment = { os: OperatingSystem.Macintosh };\n\t\t\t\tdeepStrictEqual((await instantiationService.invokeFunction(fetchBashHistory))!.commands, expectedCommands);\n\t\t\t});\n\t\t\ttest('Linux', async () => {\n\t\t\t\tremoteEnvironment = { os: OperatingSystem.Linux };\n\t\t\t\tdeepStrictEqual((await instantiationService.invokeFunction(fetchBashHistory))!.commands, expectedCommands);\n\t\t\t});\n\t\t});\n\t});\n\tsuite('fetchZshHistory', () => {\n\t\tlet fileScheme: string;\n\t\tlet filePath: string;\n\t\tconst fileContentType = [\n\t\t\t{\n\t\t\t\ttype: 'simple',\n\t\t\t\tcontent: [\n\t\t\t\t\t'single line command',\n\t\t\t\t\t'git commit -m \"A wrapped line in pwsh history\\\\',\n\t\t\t\t\t'\\\\',\n\t\t\t\t\t'Some commit description\\\\',\n\t\t\t\t\t'\\\\',\n\t\t\t\t\t'Fixes #xyz\"',\n\t\t\t\t\t'git status',\n\t\t\t\t\t'two \"\\\\',\n\t\t\t\t\t'line\"'\n\t\t\t\t].join('\\n')\n\t\t\t},\n\t\t\t{\n\t\t\t\ttype: 'extended',\n\t\t\t\tcontent: [\n\t\t\t\t\t': 1655252330:0;single line command',\n\t\t\t\t\t': 1655252330:0;git commit -m \"A wrapped line in pwsh history\\\\',\n\t\t\t\t\t'\\\\',\n\t\t\t\t\t'Some commit description\\\\',\n\t\t\t\t\t'\\\\',\n\t\t\t\t\t'Fixes #xyz\"',\n\t\t\t\t\t': 1655252330:0;git status',\n\t\t\t\t\t': 1655252330:0;two \"\\\\',\n\t\t\t\t\t'line\"'\n\t\t\t\t].join('\\n')\n\t\t\t},\n\t\t];\n\n\t\tlet instantiationService: TestInstantiationService;\n\t\tlet remoteConnection: Pick<IRemoteAgentConnection, 'remoteAuthority'> | null = null;\n\t\tlet remoteEnvironment: Pick<IRemoteAgentEnvironment, 'os'> | null = null;\n\n\t\tfor (const { type, content } of fileContentType) {\n\t\t\tsuite(type, () => {\n\t\t\t\tsetup(() => {\n\t\t\t\t\tinstantiationService = new TestInstantiationService();\n\t\t\t\t\tinstantiationService.stub(IFileService, {\n\t\t\t\t\t\tasync readFile(resource: URI) {\n\t\t\t\t\t\t\tconst expected = URI.from({ scheme: fileScheme, path: filePath });\n\t\t\t\t\t\t\tstrictEqual(resource.scheme, expected.scheme);\n\t\t\t\t\t\t\tstrictEqual(resource.path, expected.path);\n\t\t\t\t\t\t\treturn { value: VSBuffer.fromString(content) };\n\t\t\t\t\t\t}\n\t\t\t\t\t} as Pick<IFileService, 'readFile'>);\n\t\t\t\t\tinstantiationService.stub(IRemoteAgentService, {\n\t\t\t\t\t\tasync getEnvironment() { return remoteEnvironment; },\n\t\t\t\t\t\tgetConnection() { return remoteConnection; }\n\t\t\t\t\t} as Pick<IRemoteAgentService, 'getConnection' | 'getEnvironment'>);\n\t\t\t\t});\n\n\t\t\t\tteardown(() => {\n\t\t\t\t\tinstantiationService.dispose();\n\t\t\t\t});\n\n\t\t\t\tif (!isWindows) {\n\t\t\t\t\tsuite('local', () => {\n\t\t\t\t\t\tlet originalEnvValues: { HOME: string | undefined };\n\t\t\t\t\t\tsetup(() => {\n\t\t\t\t\t\t\toriginalEnvValues = { HOME: env['HOME'] };\n\t\t\t\t\t\t\tenv['HOME'] = '/home/user';\n\t\t\t\t\t\t\tremoteConnection = { remoteAuthority: 'some-remote' };\n\t\t\t\t\t\t\tfileScheme = Schemas.vscodeRemote;\n\t\t\t\t\t\t\tfilePath = '/home/user/.bash_history';\n\t\t\t\t\t\t});\n\t\t\t\t\t\tteardown(() => {\n\t\t\t\t\t\t\tif (originalEnvValues['HOME'] === undefined) {\n\t\t\t\t\t\t\t\tdelete env['HOME'];\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tenv['HOME'] = originalEnvValues['HOME'];\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t\ttest('current OS', async () => {\n\t\t\t\t\t\t\tfilePath = '/home/user/.zsh_history';\n\t\t\t\t\t\t\tdeepStrictEqual((await instantiationService.invokeFunction(fetchZshHistory))!.commands, expectedCommands);\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tsuite('remote', () => {\n\t\t\t\t\tlet originalEnvValues: { HOME: string | undefined };\n\t\t\t\t\tsetup(() => {\n\t\t\t\t\t\toriginalEnvValues = { HOME: env['HOME'] };\n\t\t\t\t\t\tenv['HOME'] = '/home/user';\n\t\t\t\t\t\tremoteConnection = { remoteAuthority: 'some-remote' };\n\t\t\t\t\t\tfileScheme = Schemas.vscodeRemote;\n\t\t\t\t\t\tfilePath = '/home/user/.zsh_history';\n\t\t\t\t\t});\n\t\t\t\t\tteardown(() => {\n\t\t\t\t\t\tif (originalEnvValues['HOME'] === undefined) {\n\t\t\t\t\t\t\tdelete env['HOME'];\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tenv['HOME'] = originalEnvValues['HOME'];\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\ttest('Windows', async () => {\n\t\t\t\t\t\tremoteEnvironment = { os: OperatingSystem.Windows };\n\t\t\t\t\t\tstrictEqual(await instantiationService.invokeFunction(fetchZshHistory), undefined);\n\t\t\t\t\t});\n\t\t\t\t\ttest('macOS', async () => {\n\t\t\t\t\t\tremoteEnvironment = { os: OperatingSystem.Macintosh };\n\t\t\t\t\t\tdeepStrictEqual((await instantiationService.invokeFunction(fetchZshHistory))!.commands, expectedCommands);\n\t\t\t\t\t});\n\t\t\t\t\ttest('Linux', async () => {\n\t\t\t\t\t\tremoteEnvironment = { os: OperatingSystem.Linux };\n\t\t\t\t\t\tdeepStrictEqual((await instantiationService.invokeFunction(fetchZshHistory))!.commands, expectedCommands);\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\t});\n\tsuite('fetchPwshHistory', () => {\n\t\tlet fileScheme: string;\n\t\tlet filePath: string;\n\t\tconst fileContent: string = [\n\t\t\t'single line command',\n\t\t\t'git commit -m \"A wrapped line in pwsh history`',\n\t\t\t'`',\n\t\t\t'Some commit description`',\n\t\t\t'`',\n\t\t\t'Fixes #xyz\"',\n\t\t\t'git status',\n\t\t\t'two \"`',\n\t\t\t'line\"'\n\t\t].join('\\n');\n\n\t\tlet instantiationService: TestInstantiationService;\n\t\tlet remoteConnection: Pick<IRemoteAgentConnection, 'remoteAuthority'> | null = null;\n\t\tlet remoteEnvironment: Pick<IRemoteAgentEnvironment, 'os'> | null = null;\n\n\t\tsetup(() => {\n\t\t\tinstantiationService = new TestInstantiationService();\n\t\t\tinstantiationService.stub(IFileService, {\n\t\t\t\tasync readFile(resource: URI) {\n\t\t\t\t\tconst expected = URI.from({\n\t\t\t\t\t\tscheme: fileScheme,\n\t\t\t\t\t\tauthority: remoteConnection?.remoteAuthority,\n\t\t\t\t\t\tpath: URI.file(filePath).path\n\t\t\t\t\t});\n\t\t\t\t\t// Sanitize the encoded `/` chars as they don't impact behavior\n\t\t\t\t\tstrictEqual(resource.toString().replaceAll('%5C', '/'), expected.toString().replaceAll('%5C', '/'));\n\t\t\t\t\treturn { value: VSBuffer.fromString(fileContent) };\n\t\t\t\t}\n\t\t\t} as Pick<IFileService, 'readFile'>);\n\t\t\tinstantiationService.stub(IRemoteAgentService, {\n\t\t\t\tasync getEnvironment() { return remoteEnvironment; },\n\t\t\t\tgetConnection() { return remoteConnection; }\n\t\t\t} as Pick<IRemoteAgentService, 'getConnection' | 'getEnvironment'>);\n\t\t});\n\n\t\tteardown(() => {\n\t\t\tinstantiationService.dispose();\n\t\t});\n\n\t\tsuite('local', () => {\n\t\t\tlet originalEnvValues: { HOME: string | undefined; APPDATA: string | undefined };\n\t\t\tsetup(() => {\n\t\t\t\toriginalEnvValues = { HOME: env['HOME'], APPDATA: env['APPDATA'] };\n\t\t\t\tenv['HOME'] = '/home/user';\n\t\t\t\tenv['APPDATA'] = 'C:\\\\AppData';\n\t\t\t\tremoteConnection = { remoteAuthority: 'some-remote' };\n\t\t\t\tfileScheme = Schemas.vscodeRemote;\n\t\t\t\tfilePath = '/home/user/.zsh_history';\n\t\t\t\toriginalEnvValues = { HOME: env['HOME'], APPDATA: env['APPDATA'] };\n\t\t\t});\n\t\t\tteardown(() => {\n\t\t\t\tif (originalEnvValues['HOME'] === undefined) {\n\t\t\t\t\tdelete env['HOME'];\n\t\t\t\t} else {\n\t\t\t\t\tenv['HOME'] = originalEnvValues['HOME'];\n\t\t\t\t}\n\t\t\t\tif (originalEnvValues['APPDATA'] === undefined) {\n\t\t\t\t\tdelete env['APPDATA'];\n\t\t\t\t} else {\n\t\t\t\t\tenv['APPDATA'] = originalEnvValues['APPDATA'];\n\t\t\t\t}\n\t\t\t});\n\t\t\ttest('current OS', async () => {\n\t\t\t\tif (isWindows) {\n\t\t\t\t\tfilePath = join(env['APPDATA']!, 'Microsoft\\\\Windows\\\\PowerShell\\\\PSReadLine\\\\ConsoleHost_history.txt');\n\t\t\t\t} else {\n\t\t\t\t\tfilePath = join(env['HOME']!, '.local/share/powershell/PSReadline/ConsoleHost_history.txt');\n\t\t\t\t}\n\t\t\t\tdeepStrictEqual((await instantiationService.invokeFunction(fetchPwshHistory))!.commands, expectedCommands);\n\t\t\t});\n\t\t});\n\t\tsuite('remote', () => {\n\t\t\tlet originalEnvValues: { HOME: string | undefined; APPDATA: string | undefined };\n\t\t\tsetup(() => {\n\t\t\t\tremoteConnection = { remoteAuthority: 'some-remote' };\n\t\t\t\tfileScheme = Schemas.vscodeRemote;\n\t\t\t\toriginalEnvValues = { HOME: env['HOME'], APPDATA: env['APPDATA'] };\n\t\t\t});\n\t\t\tteardown(() => {\n\t\t\t\tif (originalEnvValues['HOME'] === undefined) {\n\t\t\t\t\tdelete env['HOME'];\n\t\t\t\t} else {\n\t\t\t\t\tenv['HOME'] = originalEnvValues['HOME'];\n\t\t\t\t}\n\t\t\t\tif (originalEnvValues['APPDATA'] === undefined) {\n\t\t\t\t\tdelete env['APPDATA'];\n\t\t\t\t} else {\n\t\t\t\t\tenv['APPDATA'] = originalEnvValues['APPDATA'];\n\t\t\t\t}\n\t\t\t});\n\t\t\ttest('Windows', async () => {\n\t\t\t\tremoteEnvironment = { os: OperatingSystem.Windows };\n\t\t\t\tenv['APPDATA'] = 'C:\\\\AppData';\n\t\t\t\tfilePath = 'C:\\\\AppData\\\\Microsoft\\\\Windows\\\\PowerShell\\\\PSReadLine\\\\ConsoleHost_history.txt';\n\t\t\t\tdeepStrictEqual((await instantiationService.invokeFunction(fetchPwshHistory))!.commands, expectedCommands);\n\t\t\t});\n\t\t\ttest('macOS', async () => {\n\t\t\t\tremoteEnvironment = { os: OperatingSystem.Macintosh };\n\t\t\t\tenv['HOME'] = '/home/user';\n\t\t\t\tfilePath = '/home/user/.local/share/powershell/PSReadline/ConsoleHost_history.txt';\n\t\t\t\tdeepStrictEqual((await instantiationService.invokeFunction(fetchPwshHistory))!.commands, expectedCommands);\n\t\t\t});\n\t\t\ttest('Linux', async () => {\n\t\t\t\tremoteEnvironment = { os: OperatingSystem.Linux };\n\t\t\t\tenv['HOME'] = '/home/user';\n\t\t\t\tfilePath = '/home/user/.local/share/powershell/PSReadline/ConsoleHost_history.txt';\n\t\t\t\tdeepStrictEqual((await instantiationService.invokeFunction(fetchPwshHistory))!.commands, expectedCommands);\n\t\t\t});\n\t\t});\n\t});\n\tsuite('fetchFishHistory', () => {\n\t\tlet fileScheme: string;\n\t\tlet filePath: string;\n\t\tconst fileContent: string = [\n\t\t\t'- cmd: single line command',\n\t\t\t'  when: 1650000000',\n\t\t\t'- cmd: git commit -m \"A wrapped line in pwsh history\\\\n\\\\nSome commit description\\\\n\\\\nFixes #xyz\"',\n\t\t\t'  when: 1650000010',\n\t\t\t'- cmd: git status',\n\t\t\t'  when: 1650000020',\n\t\t\t'- cmd: two \"\\\\nline\"',\n\t\t\t'  when: 1650000030',\n\t\t].join('\\n');\n\n\t\tlet instantiationService: TestInstantiationService;\n\t\tlet remoteConnection: Pick<IRemoteAgentConnection, 'remoteAuthority'> | null = null;\n\t\tlet remoteEnvironment: Pick<IRemoteAgentEnvironment, 'os'> | null = null;\n\n\t\tsetup(() => {\n\t\t\tinstantiationService = new TestInstantiationService();\n\t\t\tinstantiationService.stub(IFileService, {\n\t\t\t\tasync readFile(resource: URI) {\n\t\t\t\t\tconst expected = URI.from({ scheme: fileScheme, path: filePath });\n\t\t\t\t\tstrictEqual(resource.scheme, expected.scheme);\n\t\t\t\t\tstrictEqual(resource.path, expected.path);\n\t\t\t\t\treturn { value: VSBuffer.fromString(fileContent) };\n\t\t\t\t}\n\t\t\t} as Pick<IFileService, 'readFile'>);\n\t\t\tinstantiationService.stub(IRemoteAgentService, {\n\t\t\t\tasync getEnvironment() { return remoteEnvironment; },\n\t\t\t\tgetConnection() { return remoteConnection; }\n\t\t\t} as Pick<IRemoteAgentService, 'getConnection' | 'getEnvironment'>);\n\t\t});\n\n\t\tteardown(() => {\n\t\t\tinstantiationService.dispose();\n\t\t});\n\n\t\tif (!isWindows) {\n\t\t\tsuite('local', () => {\n\t\t\t\tlet originalEnvValues: { HOME: string | undefined };\n\t\t\t\tsetup(() => {\n\t\t\t\t\toriginalEnvValues = { HOME: env['HOME'] };\n\t\t\t\t\tenv['HOME'] = '/home/user';\n\t\t\t\t\tremoteConnection = { remoteAuthority: 'some-remote' };\n\t\t\t\t\tfileScheme = Schemas.vscodeRemote;\n\t\t\t\t\tfilePath = '/home/user/.local/share/fish/fish_history';\n\t\t\t\t});\n\t\t\t\tteardown(() => {\n\t\t\t\t\tif (originalEnvValues['HOME'] === undefined) {\n\t\t\t\t\t\tdelete env['HOME'];\n\t\t\t\t\t} else {\n\t\t\t\t\t\tenv['HOME'] = originalEnvValues['HOME'];\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\ttest('current OS', async () => {\n\t\t\t\t\tfilePath = '/home/user/.local/share/fish/fish_history';\n\t\t\t\t\tdeepStrictEqual((await instantiationService.invokeFunction(fetchFishHistory))!.commands, expectedCommands);\n\t\t\t\t});\n\t\t\t});\n\n\t\t\tsuite('local (overriden path)', () => {\n\t\t\t\tlet originalEnvValues: { XDG_DATA_HOME: string | undefined };\n\t\t\t\tsetup(() => {\n\t\t\t\t\toriginalEnvValues = { XDG_DATA_HOME: env['XDG_DATA_HOME'] };\n\t\t\t\t\tenv['XDG_DATA_HOME'] = '/home/user/data-home';\n\t\t\t\t\tremoteConnection = { remoteAuthority: 'some-remote' };\n\t\t\t\t\tfileScheme = Schemas.vscodeRemote;\n\t\t\t\t\tfilePath = '/home/user/data-home/fish/fish_history';\n\t\t\t\t});\n\t\t\t\tteardown(() => {\n\t\t\t\t\tif (originalEnvValues['XDG_DATA_HOME'] === undefined) {\n\t\t\t\t\t\tdelete env['XDG_DATA_HOME'];\n\t\t\t\t\t} else {\n\t\t\t\t\t\tenv['XDG_DATA_HOME'] = originalEnvValues['XDG_DATA_HOME'];\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\ttest('current OS', async () => {\n\t\t\t\t\tfilePath = '/home/user/data-home/fish/fish_history';\n\t\t\t\t\tdeepStrictEqual((await instantiationService.invokeFunction(fetchFishHistory))!.commands, expectedCommands);\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\t\tsuite('remote', () => {\n\t\t\tlet originalEnvValues: { HOME: string | undefined };\n\t\t\tsetup(() => {\n\t\t\t\toriginalEnvValues = { HOME: env['HOME'] };\n\t\t\t\tenv['HOME'] = '/home/user';\n\t\t\t\tremoteConnection = { remoteAuthority: 'some-remote' };\n\t\t\t\tfileScheme = Schemas.vscodeRemote;\n\t\t\t\tfilePath = '/home/user/.local/share/fish/fish_history';\n\t\t\t});\n\t\t\tteardown(() => {\n\t\t\t\tif (originalEnvValues['HOME'] === undefined) {\n\t\t\t\t\tdelete env['HOME'];\n\t\t\t\t} else {\n\t\t\t\t\tenv['HOME'] = originalEnvValues['HOME'];\n\t\t\t\t}\n\t\t\t});\n\t\t\ttest('Windows', async () => {\n\t\t\t\tremoteEnvironment = { os: OperatingSystem.Windows };\n\t\t\t\tstrictEqual(await instantiationService.invokeFunction(fetchFishHistory), undefined);\n\t\t\t});\n\t\t\ttest('macOS', async () => {\n\t\t\t\tremoteEnvironment = { os: OperatingSystem.Macintosh };\n\t\t\t\tdeepStrictEqual((await instantiationService.invokeFunction(fetchFishHistory))!.commands, expectedCommands);\n\t\t\t});\n\t\t\ttest('Linux', async () => {\n\t\t\t\tremoteEnvironment = { os: OperatingSystem.Linux };\n\t\t\t\tdeepStrictEqual((await instantiationService.invokeFunction(fetchFishHistory))!.commands, expectedCommands);\n\t\t\t});\n\t\t});\n\n\t\tsuite('remote (overriden path)', () => {\n\t\t\tlet originalEnvValues: { XDG_DATA_HOME: string | undefined };\n\t\t\tsetup(() => {\n\t\t\t\toriginalEnvValues = { XDG_DATA_HOME: env['XDG_DATA_HOME'] };\n\t\t\t\tenv['XDG_DATA_HOME'] = '/home/user/data-home';\n\t\t\t\tremoteConnection = { remoteAuthority: 'some-remote' };\n\t\t\t\tfileScheme = Schemas.vscodeRemote;\n\t\t\t\tfilePath = '/home/user/data-home/fish/fish_history';\n\t\t\t});\n\t\t\tteardown(() => {\n\t\t\t\tif (originalEnvValues['XDG_DATA_HOME'] === undefined) {\n\t\t\t\t\tdelete env['XDG_DATA_HOME'];\n\t\t\t\t} else {\n\t\t\t\t\tenv['XDG_DATA_HOME'] = originalEnvValues['XDG_DATA_HOME'];\n\t\t\t\t}\n\t\t\t});\n\t\t\ttest('Windows', async () => {\n\t\t\t\tremoteEnvironment = { os: OperatingSystem.Windows };\n\t\t\t\tstrictEqual(await instantiationService.invokeFunction(fetchFishHistory), undefined);\n\t\t\t});\n\t\t\ttest('macOS', async () => {\n\t\t\t\tremoteEnvironment = { os: OperatingSystem.Macintosh };\n\t\t\t\tdeepStrictEqual((await instantiationService.invokeFunction(fetchFishHistory))!.commands, expectedCommands);\n\t\t\t});\n\t\t\ttest('Linux', async () => {\n\t\t\t\tremoteEnvironment = { os: OperatingSystem.Linux };\n\t\t\t\tdeepStrictEqual((await instantiationService.invokeFunction(fetchFishHistory))!.commands, expectedCommands);\n\t\t\t});\n\t\t});\n\n\t\tsuite('sanitizeFishHistoryCmd', () => {\n\t\t\ttest('valid new-lines', () => {\n\t\t\t\t/**\n\t\t\t\t * Valid new-lines have odd number of leading backslashes: \\n, \\\\\\n, \\\\\\\\\\n\n\t\t\t\t */\n\t\t\t\tconst cases = [\n\t\t\t\t\t'\\\\n',\n\t\t\t\t\t'\\\\n at start',\n\t\t\t\t\t'some \\\\n in the middle',\n\t\t\t\t\t'at the end \\\\n',\n\t\t\t\t\t'\\\\\\\\\\\\n',\n\t\t\t\t\t'\\\\\\\\\\\\n valid at start',\n\t\t\t\t\t'valid \\\\\\\\\\\\n in the middle',\n\t\t\t\t\t'valid in the end \\\\\\\\\\\\n',\n\t\t\t\t\t'\\\\\\\\\\\\\\\\\\\\n',\n\t\t\t\t\t'\\\\\\\\\\\\\\\\\\\\n valid at start',\n\t\t\t\t\t'valid \\\\\\\\\\\\\\\\\\\\n in the middle',\n\t\t\t\t\t'valid in the end \\\\\\\\\\\\\\\\\\\\n',\n\t\t\t\t\t'mixed valid \\\\r\\\\n',\n\t\t\t\t\t'mixed valid \\\\\\\\\\\\r\\\\n',\n\t\t\t\t\t'mixed valid \\\\r\\\\\\\\\\\\n',\n\t\t\t\t];\n\n\t\t\t\tfor (const x of cases) {\n\t\t\t\t\tok(sanitizeFishHistoryCmd(x).includes('\\n'));\n\t\t\t\t}\n\t\t\t});\n\n\t\t\ttest('invalid new-lines', () => {\n\t\t\t\t/**\n\t\t\t\t * Invalid new-lines have even number of leading backslashes: \\\\n, \\\\\\\\n, \\\\\\\\\\\\n\n\t\t\t\t */\n\t\t\t\tconst cases = [\n\t\t\t\t\t'\\\\\\\\n',\n\t\t\t\t\t'\\\\\\\\n invalid at start',\n\t\t\t\t\t'invalid \\\\\\\\n in the middle',\n\t\t\t\t\t'invalid in the end \\\\\\\\n',\n\t\t\t\t\t'\\\\\\\\\\\\\\\\n',\n\t\t\t\t\t'\\\\\\\\\\\\\\\\n invalid at start',\n\t\t\t\t\t'invalid \\\\\\\\\\\\\\\\n in the middle',\n\t\t\t\t\t'invalid in the end \\\\\\\\\\\\\\\\n',\n\t\t\t\t\t'mixed invalid \\\\r\\\\\\\\n',\n\t\t\t\t\t'mixed invalid \\\\r\\\\\\\\\\\\\\\\n',\n\t\t\t\t\t'echo \"\\\\\\\\n\"',\n\t\t\t\t];\n\n\t\t\t\tfor (const x of cases) {\n\t\t\t\t\tok(!sanitizeFishHistoryCmd(x).includes('\\n'));\n\t\t\t\t}\n\t\t\t});\n\n\t\t});\n\t});\n});\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { deepStrictEqual, strictEqual, ok } from 'assert';\nimport { VSBuffer } from '../../../../../../base/common/buffer.js';\nimport { Schemas } from '../../../../../../base/common/network.js';\nimport { join } from '../../../../../../base/common/path.js';\nimport { isWindows, OperatingSystem } from '../../../../../../base/common/platform.js';\nimport { env } from '../../../../../../base/common/process.js';\nimport { URI } from '../../../../../../base/common/uri.js';\nimport { ensureNoDisposablesAreLeakedInTestSuite } from '../../../../../../base/test/common/utils.js';\nimport { IConfigurationService } from '../../../../../../platform/configuration/common/configuration.js';\nimport { TestConfigurationService } from '../../../../../../platform/configuration/test/common/testConfigurationService.js';\nimport { IFileService } from '../../../../../../platform/files/common/files.js';\nimport { TestInstantiationService } from '../../../../../../platform/instantiation/test/common/instantiationServiceMock.js';\nimport { IRemoteAgentEnvironment } from '../../../../../../platform/remote/common/remoteAgentEnvironment.js';\nimport { IStorageService } from '../../../../../../platform/storage/common/storage.js';\nimport { IRemoteAgentConnection, IRemoteAgentService } from '../../../../../services/remote/common/remoteAgentService.js';\nimport { TestStorageService } from '../../../../../test/common/workbenchTestServices.js';\nimport { fetchBashHistory, fetchFishHistory, fetchPwshHistory, fetchZshHistory, sanitizeFishHistoryCmd, TerminalPersistedHistory, type ITerminalPersistedHistory } from '../../common/history.js';\n\nfunction getConfig(limit: number) {\n\treturn {\n\t\tterminal: {\n\t\t\tintegrated: {\n\t\t\t\tshellIntegration: {\n\t\t\t\t\thistory: limit\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t};\n}\n\nconst expectedCommands = [\n\t'single line command',\n\t'git commit -m \"A wrapped line in pwsh history\\n\\nSome commit description\\n\\nFixes #xyz\"',\n\t'git status',\n\t'two \"\\nline\"'\n];\n\nsuite('Terminal history', () => {\n\tconst store = ensureNoDisposablesAreLeakedInTestSuite();\n\n\tsuite('TerminalPersistedHistory', () => {\n\t\tlet history: ITerminalPersistedHistory<number>;\n\t\tlet instantiationService: TestInstantiationService;\n\t\tlet configurationService: TestConfigurationService;\n\n\t\tsetup(() => {\n\t\t\tconfigurationService = new TestConfigurationService(getConfig(5));\n\t\t\tinstantiationService = store.add(new TestInstantiationService());\n\t\t\tinstantiationService.set(IConfigurationService, configurationService);\n\t\t\tinstantiationService.set(IStorageService, store.add(new TestStorageService()));\n\n\t\t\thistory = store.add(instantiationService.createInstance(TerminalPersistedHistory<number>, 'test'));\n\t\t});\n\n\t\tteardown(() => {\n\t\t\tinstantiationService.dispose();\n\t\t});\n\n\t\ttest('should support adding items to the cache and respect LRU', () => {\n\t\t\thistory.add('foo', 1);\n\t\t\tdeepStrictEqual(Array.from(history.entries), [\n\t\t\t\t['foo', 1]\n\t\t\t]);\n\t\t\thistory.add('bar', 2);\n\t\t\tdeepStrictEqual(Array.from(history.entries), [\n\t\t\t\t['foo', 1],\n\t\t\t\t['bar', 2]\n\t\t\t]);\n\t\t\thistory.add('foo', 1);\n\t\t\tdeepStrictEqual(Array.from(history.entries), [\n\t\t\t\t['bar', 2],\n\t\t\t\t['foo', 1]\n\t\t\t]);\n\t\t});\n\n\t\ttest('should support removing specific items', () => {\n\t\t\thistory.add('1', 1);\n\t\t\thistory.add('2', 2);\n\t\t\thistory.add('3', 3);\n\t\t\thistory.add('4', 4);\n\t\t\thistory.add('5', 5);\n\t\t\tstrictEqual(Array.from(history.entries).length, 5);\n\t\t\thistory.add('6', 6);\n\t\t\tstrictEqual(Array.from(history.entries).length, 5);\n\t\t});\n\n\t\ttest('should limit the number of entries based on config', () => {\n\t\t\thistory.add('1', 1);\n\t\t\thistory.add('2', 2);\n\t\t\thistory.add('3', 3);\n\t\t\thistory.add('4', 4);\n\t\t\thistory.add('5', 5);\n\t\t\tstrictEqual(Array.from(history.entries).length, 5);\n\t\t\thistory.add('6', 6);\n\t\t\tstrictEqual(Array.from(history.entries).length, 5);\n\t\t\tconfigurationService.setUserConfiguration('terminal', getConfig(2).terminal);\n\t\t\t// eslint-disable-next-line local/code-no-any-casts\n\t\t\tconfigurationService.onDidChangeConfigurationEmitter.fire({ affectsConfiguration: () => true } as any);\n\t\t\tstrictEqual(Array.from(history.entries).length, 2);\n\t\t\thistory.add('7', 7);\n\t\t\tstrictEqual(Array.from(history.entries).length, 2);\n\t\t\tconfigurationService.setUserConfiguration('terminal', getConfig(3).terminal);\n\t\t\t// eslint-disable-next-line local/code-no-any-casts\n\t\t\tconfigurationService.onDidChangeConfigurationEmitter.fire({ affectsConfiguration: () => true } as any);\n\t\t\tstrictEqual(Array.from(history.entries).length, 2);\n\t\t\thistory.add('8', 8);\n\t\t\tstrictEqual(Array.from(history.entries).length, 3);\n\t\t\thistory.add('9', 9);\n\t\t\tstrictEqual(Array.from(history.entries).length, 3);\n\t\t});\n\n\t\ttest('should reload from storage service after recreation', () => {\n\t\t\thistory.add('1', 1);\n\t\t\thistory.add('2', 2);\n\t\t\thistory.add('3', 3);\n\t\t\tstrictEqual(Array.from(history.entries).length, 3);\n\t\t\tconst history2 = store.add(instantiationService.createInstance(TerminalPersistedHistory, 'test'));\n\t\t\tstrictEqual(Array.from(history2.entries).length, 3);\n\t\t});\n\t});\n\tsuite('fetchBashHistory', () => {\n\t\tlet fileScheme: string;\n\t\tlet filePath: string;\n\t\tconst fileContent: string = [\n\t\t\t'single line command',\n\t\t\t'git commit -m \"A wrapped line in pwsh history',\n\t\t\t'',\n\t\t\t'Some commit description',\n\t\t\t'',\n\t\t\t'Fixes #xyz\"',\n\t\t\t'git status',\n\t\t\t'two \"',\n\t\t\t'line\"'\n\t\t].join('\\n');\n\n\t\tlet instantiationService: TestInstantiationService;\n\t\tlet remoteConnection: Pick<IRemoteAgentConnection, 'remoteAuthority'> | null = null;\n\t\tlet remoteEnvironment: Pick<IRemoteAgentEnvironment, 'os'> | null = null;\n\n\t\tsetup(() => {\n\t\t\tinstantiationService = new TestInstantiationService();\n\t\t\tinstantiationService.stub(IFileService, {\n\t\t\t\tasync readFile(resource: URI) {\n\t\t\t\t\tconst expected = URI.from({ scheme: fileScheme, path: filePath });\n\t\t\t\t\tstrictEqual(resource.scheme, expected.scheme);\n\t\t\t\t\tstrictEqual(resource.path, expected.path);\n\t\t\t\t\treturn { value: VSBuffer.fromString(fileContent) };\n\t\t\t\t}\n\t\t\t} as Pick<IFileService, 'readFile'>);\n\t\t\tinstantiationService.stub(IRemoteAgentService, {\n\t\t\t\tasync getEnvironment() { return remoteEnvironment; },\n\t\t\t\tgetConnection() { return remoteConnection; }\n\t\t\t} as Pick<IRemoteAgentService, 'getConnection' | 'getEnvironment'>);\n\t\t});\n\n\t\tteardown(() => {\n\t\t\tinstantiationService.dispose();\n\t\t});\n\n\t\tif (!isWindows) {\n\t\t\tsuite('local', () => {\n\t\t\t\tlet originalEnvValues: { HOME: string | undefined };\n\t\t\t\tsetup(() => {\n\t\t\t\t\toriginalEnvValues = { HOME: env['HOME'] };\n\t\t\t\t\tenv['HOME'] = '/home/user';\n\t\t\t\t\tremoteConnection = { remoteAuthority: 'some-remote' };\n\t\t\t\t\tfileScheme = Schemas.vscodeRemote;\n\t\t\t\t\tfilePath = '/home/user/.bash_history';\n\t\t\t\t});\n\t\t\t\tteardown(() => {\n\t\t\t\t\tif (originalEnvValues['HOME'] === undefined) {\n\t\t\t\t\t\tdelete env['HOME'];\n\t\t\t\t\t} else {\n\t\t\t\t\t\tenv['HOME'] = originalEnvValues['HOME'];\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\ttest('current OS', async () => {\n\t\t\t\t\tfilePath = '/home/user/.bash_history';\n\t\t\t\t\tdeepStrictEqual((await instantiationService.invokeFunction(fetchBashHistory))!.commands, expectedCommands);\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\t\tsuite('remote', () => {\n\t\t\tlet originalEnvValues: { HOME: string | undefined };\n\t\t\tsetup(() => {\n\t\t\t\toriginalEnvValues = { HOME: env['HOME'] };\n\t\t\t\tenv['HOME'] = '/home/user';\n\t\t\t\tremoteConnection = { remoteAuthority: 'some-remote' };\n\t\t\t\tfileScheme = Schemas.vscodeRemote;\n\t\t\t\tfilePath = '/home/user/.bash_history';\n\t\t\t});\n\t\t\tteardown(() => {\n\t\t\t\tif (originalEnvValues['HOME'] === undefined) {\n\t\t\t\t\tdelete env['HOME'];\n\t\t\t\t} else {\n\t\t\t\t\tenv['HOME'] = originalEnvValues['HOME'];\n\t\t\t\t}\n\t\t\t});\n\t\t\ttest('Windows', async () => {\n\t\t\t\tremoteEnvironment = { os: OperatingSystem.Windows };\n\t\t\t\tstrictEqual(await instantiationService.invokeFunction(fetchBashHistory), undefined);\n\t\t\t});\n\t\t\ttest('macOS', async () => {\n\t\t\t\tremoteEnvironment = { os: OperatingSystem.Macintosh };\n\t\t\t\tdeepStrictEqual((await instantiationService.invokeFunction(fetchBashHistory))!.commands, expectedCommands);\n\t\t\t});\n\t\t\ttest('Linux', async () => {\n\t\t\t\tremoteEnvironment = { os: OperatingSystem.Linux };\n\t\t\t\tdeepStrictEqual((await instantiationService.invokeFunction(fetchBashHistory))!.commands, expectedCommands);\n\t\t\t});\n\t\t});\n\t});\n\tsuite('fetchZshHistory', () => {\n\t\tlet fileScheme: string;\n\t\tlet filePath: string;\n\t\tconst fileContentType = [\n\t\t\t{\n\t\t\t\ttype: 'simple',\n\t\t\t\tcontent: [\n\t\t\t\t\t'single line command',\n\t\t\t\t\t'git commit -m \"A wrapped line in pwsh history\\\\',\n\t\t\t\t\t'\\\\',\n\t\t\t\t\t'Some commit description\\\\',\n\t\t\t\t\t'\\\\',\n\t\t\t\t\t'Fixes #xyz\"',\n\t\t\t\t\t'git status',\n\t\t\t\t\t'two \"\\\\',\n\t\t\t\t\t'line\"'\n\t\t\t\t].join('\\n')\n\t\t\t},\n\t\t\t{\n\t\t\t\ttype: 'extended',\n\t\t\t\tcontent: [\n\t\t\t\t\t': 1655252330:0;single line command',\n\t\t\t\t\t': 1655252330:0;git commit -m \"A wrapped line in pwsh history\\\\',\n\t\t\t\t\t'\\\\',\n\t\t\t\t\t'Some commit description\\\\',\n\t\t\t\t\t'\\\\',\n\t\t\t\t\t'Fixes #xyz\"',\n\t\t\t\t\t': 1655252330:0;git status',\n\t\t\t\t\t': 1655252330:0;two \"\\\\',\n\t\t\t\t\t'line\"'\n\t\t\t\t].join('\\n')\n\t\t\t},\n\t\t];\n\n\t\tlet instantiationService: TestInstantiationService;\n\t\tlet remoteConnection: Pick<IRemoteAgentConnection, 'remoteAuthority'> | null = null;\n\t\tlet remoteEnvironment: Pick<IRemoteAgentEnvironment, 'os'> | null = null;\n\n\t\tfor (const { type, content } of fileContentType) {\n\t\t\tsuite(type, () => {\n\t\t\t\tsetup(() => {\n\t\t\t\t\tinstantiationService = new TestInstantiationService();\n\t\t\t\t\tinstantiationService.stub(IFileService, {\n\t\t\t\t\t\tasync readFile(resource: URI) {\n\t\t\t\t\t\t\tconst expected = URI.from({ scheme: fileScheme, path: filePath });\n\t\t\t\t\t\t\tstrictEqual(resource.scheme, expected.scheme);\n\t\t\t\t\t\t\tstrictEqual(resource.path, expected.path);\n\t\t\t\t\t\t\treturn { value: VSBuffer.fromString(content) };\n\t\t\t\t\t\t}\n\t\t\t\t\t} as Pick<IFileService, 'readFile'>);\n\t\t\t\t\tinstantiationService.stub(IRemoteAgentService, {\n\t\t\t\t\t\tasync getEnvironment() { return remoteEnvironment; },\n\t\t\t\t\t\tgetConnection() { return remoteConnection; }\n\t\t\t\t\t} as Pick<IRemoteAgentService, 'getConnection' | 'getEnvironment'>);\n\t\t\t\t});\n\n\t\t\t\tteardown(() => {\n\t\t\t\t\tinstantiationService.dispose();\n\t\t\t\t});\n\n\t\t\t\tif (!isWindows) {\n\t\t\t\t\tsuite('local', () => {\n\t\t\t\t\t\tlet originalEnvValues: { HOME: string | undefined };\n\t\t\t\t\t\tsetup(() => {\n\t\t\t\t\t\t\toriginalEnvValues = { HOME: env['HOME'] };\n\t\t\t\t\t\t\tenv['HOME'] = '/home/user';\n\t\t\t\t\t\t\tremoteConnection = { remoteAuthority: 'some-remote' };\n\t\t\t\t\t\t\tfileScheme = Schemas.vscodeRemote;\n\t\t\t\t\t\t\tfilePath = '/home/user/.bash_history';\n\t\t\t\t\t\t});\n\t\t\t\t\t\tteardown(() => {\n\t\t\t\t\t\t\tif (originalEnvValues['HOME'] === undefined) {\n\t\t\t\t\t\t\t\tdelete env['HOME'];\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tenv['HOME'] = originalEnvValues['HOME'];\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t\ttest('current OS', async () => {\n\t\t\t\t\t\t\tfilePath = '/home/user/.zsh_history';\n\t\t\t\t\t\t\tdeepStrictEqual((await instantiationService.invokeFunction(fetchZshHistory))!.commands, expectedCommands);\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tsuite('remote', () => {\n\t\t\t\t\tlet originalEnvValues: { HOME: string | undefined };\n\t\t\t\t\tsetup(() => {\n\t\t\t\t\t\toriginalEnvValues = { HOME: env['HOME'] };\n\t\t\t\t\t\tenv['HOME'] = '/home/user';\n\t\t\t\t\t\tremoteConnection = { remoteAuthority: 'some-remote' };\n\t\t\t\t\t\tfileScheme = Schemas.vscodeRemote;\n\t\t\t\t\t\tfilePath = '/home/user/.zsh_history';\n\t\t\t\t\t});\n\t\t\t\t\tteardown(() => {\n\t\t\t\t\t\tif (originalEnvValues['HOME'] === undefined) {\n\t\t\t\t\t\t\tdelete env['HOME'];\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tenv['HOME'] = originalEnvValues['HOME'];\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\ttest('Windows', async () => {\n\t\t\t\t\t\tremoteEnvironment = { os: OperatingSystem.Windows };\n\t\t\t\t\t\tstrictEqual(await instantiationService.invokeFunction(fetchZshHistory), undefined);\n\t\t\t\t\t});\n\t\t\t\t\ttest('macOS', async () => {\n\t\t\t\t\t\tremoteEnvironment = { os: OperatingSystem.Macintosh };\n\t\t\t\t\t\tdeepStrictEqual((await instantiationService.invokeFunction(fetchZshHistory))!.commands, expectedCommands);\n\t\t\t\t\t});\n\t\t\t\t\ttest('Linux', async () => {\n\t\t\t\t\t\tremoteEnvironment = { os: OperatingSystem.Linux };\n\t\t\t\t\t\tdeepStrictEqual((await instantiationService.invokeFunction(fetchZshHistory))!.commands, expectedCommands);\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\t});\n\tsuite('fetchPwshHistory', () => {\n\t\tlet fileScheme: string;\n\t\tlet filePath: string;\n\t\tconst fileContent: string = [\n\t\t\t'single line command',\n\t\t\t'git commit -m \"A wrapped line in pwsh history`',\n\t\t\t'`',\n\t\t\t'Some commit description`',\n\t\t\t'`',\n\t\t\t'Fixes #xyz\"',\n\t\t\t'git status',\n\t\t\t'two \"`',\n\t\t\t'line\"'\n\t\t].join('\\n');\n\n\t\tlet instantiationService: TestInstantiationService;\n\t\tlet remoteConnection: Pick<IRemoteAgentConnection, 'remoteAuthority'> | null = null;\n\t\tlet remoteEnvironment: Pick<IRemoteAgentEnvironment, 'os'> | null = null;\n\n\t\tsetup(() => {\n\t\t\tinstantiationService = new TestInstantiationService();\n\t\t\tinstantiationService.stub(IFileService, {\n\t\t\t\tasync readFile(resource: URI) {\n\t\t\t\t\tconst expected = URI.from({\n\t\t\t\t\t\tscheme: fileScheme,\n\t\t\t\t\t\tauthority: remoteConnection?.remoteAuthority,\n\t\t\t\t\t\tpath: URI.file(filePath).path\n\t\t\t\t\t});\n\t\t\t\t\t// Sanitize the encoded `/` chars as they don't impact behavior\n\t\t\t\t\tstrictEqual(resource.toString().replaceAll('%5C', '/'), expected.toString().replaceAll('%5C', '/'));\n\t\t\t\t\treturn { value: VSBuffer.fromString(fileContent) };\n\t\t\t\t}\n\t\t\t} as Pick<IFileService, 'readFile'>);\n\t\t\tinstantiationService.stub(IRemoteAgentService, {\n\t\t\t\tasync getEnvironment() { return remoteEnvironment; },\n\t\t\t\tgetConnection() { return remoteConnection; }\n\t\t\t} as Pick<IRemoteAgentService, 'getConnection' | 'getEnvironment'>);\n\t\t});\n\n\t\tteardown(() => {\n\t\t\tinstantiationService.dispose();\n\t\t});\n\n\t\tsuite('local', () => {\n\t\t\tlet originalEnvValues: { HOME: string | undefined; APPDATA: string | undefined };\n\t\t\tsetup(() => {\n\t\t\t\toriginalEnvValues = { HOME: env['HOME'], APPDATA: env['APPDATA'] };\n\t\t\t\tenv['HOME'] = '/home/user';\n\t\t\t\tenv['APPDATA'] = 'C:\\\\AppData';\n\t\t\t\tremoteConnection = { remoteAuthority: 'some-remote' };\n\t\t\t\tfileScheme = Schemas.vscodeRemote;\n\t\t\t\tfilePath = '/home/user/.zsh_history';\n\t\t\t\toriginalEnvValues = { HOME: env['HOME'], APPDATA: env['APPDATA'] };\n\t\t\t});\n\t\t\tteardown(() => {\n\t\t\t\tif (originalEnvValues['HOME'] === undefined) {\n\t\t\t\t\tdelete env['HOME'];\n\t\t\t\t} else {\n\t\t\t\t\tenv['HOME'] = originalEnvValues['HOME'];\n\t\t\t\t}\n\t\t\t\tif (originalEnvValues['APPDATA'] === undefined) {\n\t\t\t\t\tdelete env['APPDATA'];\n\t\t\t\t} else {\n\t\t\t\t\tenv['APPDATA'] = originalEnvValues['APPDATA'];\n\t\t\t\t}\n\t\t\t});\n\t\t\ttest('current OS', async () => {\n\t\t\t\tif (isWindows) {\n\t\t\t\t\tfilePath = join(env['APPDATA']!, 'Microsoft\\\\Windows\\\\PowerShell\\\\PSReadLine\\\\ConsoleHost_history.txt');\n\t\t\t\t} else {\n\t\t\t\t\tfilePath = join(env['HOME']!, '.local/share/powershell/PSReadline/ConsoleHost_history.txt');\n\t\t\t\t}\n\t\t\t\tdeepStrictEqual((await instantiationService.invokeFunction(fetchPwshHistory))!.commands, expectedCommands);\n\t\t\t});\n\t\t});\n\t\tsuite('remote', () => {\n\t\t\tlet originalEnvValues: { HOME: string | undefined; APPDATA: string | undefined };\n\t\t\tsetup(() => {\n\t\t\t\tremoteConnection = { remoteAuthority: 'some-remote' };\n\t\t\t\tfileScheme = Schemas.vscodeRemote;\n\t\t\t\toriginalEnvValues = { HOME: env['HOME'], APPDATA: env['APPDATA'] };\n\t\t\t});\n\t\t\tteardown(() => {\n\t\t\t\tif (originalEnvValues['HOME'] === undefined) {\n\t\t\t\t\tdelete env['HOME'];\n\t\t\t\t} else {\n\t\t\t\t\tenv['HOME'] = originalEnvValues['HOME'];\n\t\t\t\t}\n\t\t\t\tif (originalEnvValues['APPDATA'] === undefined) {\n\t\t\t\t\tdelete env['APPDATA'];\n\t\t\t\t} else {\n\t\t\t\t\tenv['APPDATA'] = originalEnvValues['APPDATA'];\n\t\t\t\t}\n\t\t\t});\n\t\t\ttest('Windows', async () => {\n\t\t\t\tremoteEnvironment = { os: OperatingSystem.Windows };\n\t\t\t\tenv['APPDATA'] = 'C:\\\\AppData';\n\t\t\t\tfilePath = 'C:\\\\AppData\\\\Microsoft\\\\Windows\\\\PowerShell\\\\PSReadLine\\\\ConsoleHost_history.txt';\n\t\t\t\tdeepStrictEqual((await instantiationService.invokeFunction(fetchPwshHistory))!.commands, expectedCommands);\n\t\t\t});\n\t\t\ttest('macOS', async () => {\n\t\t\t\tremoteEnvironment = { os: OperatingSystem.Macintosh };\n\t\t\t\tenv['HOME'] = '/home/user';\n\t\t\t\tfilePath = '/home/user/.local/share/powershell/PSReadline/ConsoleHost_history.txt';\n\t\t\t\tdeepStrictEqual((await instantiationService.invokeFunction(fetchPwshHistory))!.commands, expectedCommands);\n\t\t\t});\n\t\t\ttest('Linux', async () => {\n\t\t\t\tremoteEnvironment = { os: OperatingSystem.Linux };\n\t\t\t\tenv['HOME'] = '/home/user';\n\t\t\t\tfilePath = '/home/user/.local/share/powershell/PSReadline/ConsoleHost_history.txt';\n\t\t\t\tdeepStrictEqual((await instantiationService.invokeFunction(fetchPwshHistory))!.commands, expectedCommands);\n\t\t\t});\n\t\t});\n\t});\n\tsuite('fetchFishHistory', () => {\n\t\tlet fileScheme: string;\n\t\tlet filePath: string;\n\t\tconst fileContent: string = [\n\t\t\t'- cmd: single line command',\n\t\t\t'  when: 1650000000',\n\t\t\t'- cmd: git commit -m \"A wrapped line in pwsh history\\\\n\\\\nSome commit description\\\\n\\\\nFixes #xyz\"',\n\t\t\t'  when: 1650000010',\n\t\t\t'- cmd: git status',\n\t\t\t'  when: 1650000020',\n\t\t\t'- cmd: two \"\\\\nline\"',\n\t\t\t'  when: 1650000030',\n\t\t].join('\\n');\n\n\t\tlet instantiationService: TestInstantiationService;\n\t\tlet remoteConnection: Pick<IRemoteAgentConnection, 'remoteAuthority'> | null = null;\n\t\tlet remoteEnvironment: Pick<IRemoteAgentEnvironment, 'os'> | null = null;\n\n\t\tsetup(() => {\n\t\t\tinstantiationService = new TestInstantiationService();\n\t\t\tinstantiationService.stub(IFileService, {\n\t\t\t\tasync readFile(resource: URI) {\n\t\t\t\t\tconst expected = URI.from({ scheme: fileScheme, path: filePath });\n\t\t\t\t\tstrictEqual(resource.scheme, expected.scheme);\n\t\t\t\t\tstrictEqual(resource.path, expected.path);\n\t\t\t\t\treturn { value: VSBuffer.fromString(fileContent) };\n\t\t\t\t}\n\t\t\t} as Pick<IFileService, 'readFile'>);\n\t\t\tinstantiationService.stub(IRemoteAgentService, {\n\t\t\t\tasync getEnvironment() { return remoteEnvironment; },\n\t\t\t\tgetConnection() { return remoteConnection; }\n\t\t\t} as Pick<IRemoteAgentService, 'getConnection' | 'getEnvironment'>);\n\t\t});\n\n\t\tteardown(() => {\n\t\t\tinstantiationService.dispose();\n\t\t});\n\n\t\tif (!isWindows) {\n\t\t\tsuite('local', () => {\n\t\t\t\tlet originalEnvValues: { HOME: string | undefined };\n\t\t\t\tsetup(() => {\n\t\t\t\t\toriginalEnvValues = { HOME: env['HOME'] };\n\t\t\t\t\tenv['HOME'] = '/home/user';\n\t\t\t\t\tremoteConnection = { remoteAuthority: 'some-remote' };\n\t\t\t\t\tfileScheme = Schemas.vscodeRemote;\n\t\t\t\t\tfilePath = '/home/user/.local/share/fish/fish_history';\n\t\t\t\t});\n\t\t\t\tteardown(() => {\n\t\t\t\t\tif (originalEnvValues['HOME'] === undefined) {\n\t\t\t\t\t\tdelete env['HOME'];\n\t\t\t\t\t} else {\n\t\t\t\t\t\tenv['HOME'] = originalEnvValues['HOME'];\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\ttest('current OS', async () => {\n\t\t\t\t\tfilePath = '/home/user/.local/share/fish/fish_history';\n\t\t\t\t\tdeepStrictEqual((await instantiationService.invokeFunction(fetchFishHistory))!.commands, expectedCommands);\n\t\t\t\t});\n\t\t\t});\n\n\t\t\tsuite('local (overriden path)', () => {\n\t\t\t\tlet originalEnvValues: { XDG_DATA_HOME: string | undefined };\n\t\t\t\tsetup(() => {\n\t\t\t\t\toriginalEnvValues = { XDG_DATA_HOME: env['XDG_DATA_HOME'] };\n\t\t\t\t\tenv['XDG_DATA_HOME'] = '/home/user/data-home';\n\t\t\t\t\tremoteConnection = { remoteAuthority: 'some-remote' };\n\t\t\t\t\tfileScheme = Schemas.vscodeRemote;\n\t\t\t\t\tfilePath = '/home/user/data-home/fish/fish_history';\n\t\t\t\t});\n\t\t\t\tteardown(() => {\n\t\t\t\t\tif (originalEnvValues['XDG_DATA_HOME'] === undefined) {\n\t\t\t\t\t\tdelete env['XDG_DATA_HOME'];\n\t\t\t\t\t} else {\n\t\t\t\t\t\tenv['XDG_DATA_HOME'] = originalEnvValues['XDG_DATA_HOME'];\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\ttest('current OS', async () => {\n\t\t\t\t\tfilePath = '/home/user/data-home/fish/fish_history';\n\t\t\t\t\tdeepStrictEqual((await instantiationService.invokeFunction(fetchFishHistory))!.commands, expectedCommands);\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\t\tsuite('remote', () => {\n\t\t\tlet originalEnvValues: { HOME: string | undefined };\n\t\t\tsetup(() => {\n\t\t\t\toriginalEnvValues = { HOME: env['HOME'] };\n\t\t\t\tenv['HOME'] = '/home/user';\n\t\t\t\tremoteConnection = { remoteAuthority: 'some-remote' };\n\t\t\t\tfileScheme = Schemas.vscodeRemote;\n\t\t\t\tfilePath = '/home/user/.local/share/fish/fish_history';\n\t\t\t});\n\t\t\tteardown(() => {\n\t\t\t\tif (originalEnvValues['HOME'] === undefined) {\n\t\t\t\t\tdelete env['HOME'];\n\t\t\t\t} else {\n\t\t\t\t\tenv['HOME'] = originalEnvValues['HOME'];\n\t\t\t\t}\n\t\t\t});\n\t\t\ttest('Windows', async () => {\n\t\t\t\tremoteEnvironment = { os: OperatingSystem.Windows };\n\t\t\t\tstrictEqual(await instantiationService.invokeFunction(fetchFishHistory), undefined);\n\t\t\t});\n\t\t\ttest('macOS', async () => {\n\t\t\t\tremoteEnvironment = { os: OperatingSystem.Macintosh };\n\t\t\t\tdeepStrictEqual((await instantiationService.invokeFunction(fetchFishHistory))!.commands, expectedCommands);\n\t\t\t});\n\t\t\ttest('Linux', async () => {\n\t\t\t\tremoteEnvironment = { os: OperatingSystem.Linux };\n\t\t\t\tdeepStrictEqual((await instantiationService.invokeFunction(fetchFishHistory))!.commands, expectedCommands);\n\t\t\t});\n\t\t});\n\n\t\tsuite('remote (overriden path)', () => {\n\t\t\tlet originalEnvValues: { XDG_DATA_HOME: string | undefined };\n\t\t\tsetup(() => {\n\t\t\t\toriginalEnvValues = { XDG_DATA_HOME: env['XDG_DATA_HOME'] };\n\t\t\t\tenv['XDG_DATA_HOME'] = '/home/user/data-home';\n\t\t\t\tremoteConnection = { remoteAuthority: 'some-remote' };\n\t\t\t\tfileScheme = Schemas.vscodeRemote;\n\t\t\t\tfilePath = '/home/user/data-home/fish/fish_history';\n\t\t\t});\n\t\t\tteardown(() => {\n\t\t\t\tif (originalEnvValues['XDG_DATA_HOME'] === undefined) {\n\t\t\t\t\tdelete env['XDG_DATA_HOME'];\n\t\t\t\t} else {\n\t\t\t\t\tenv['XDG_DATA_HOME'] = originalEnvValues['XDG_DATA_HOME'];\n\t\t\t\t}\n\t\t\t});\n\t\t\ttest('Windows', async () => {\n\t\t\t\tremoteEnvironment = { os: OperatingSystem.Windows };\n\t\t\t\tstrictEqual(await instantiationService.invokeFunction(fetchFishHistory), undefined);\n\t\t\t});\n\t\t\ttest('macOS', async () => {\n\t\t\t\tremoteEnvironment = { os: OperatingSystem.Macintosh };\n\t\t\t\tdeepStrictEqual((await instantiationService.invokeFunction(fetchFishHistory))!.commands, expectedCommands);\n\t\t\t});\n\t\t\ttest('Linux', async () => {\n\t\t\t\tremoteEnvironment = { os: OperatingSystem.Linux };\n\t\t\t\tdeepStrictEqual((await instantiationService.invokeFunction(fetchFishHistory))!.commands, expectedCommands);\n\t\t\t});\n\t\t});\n\n\t\tsuite('sanitizeFishHistoryCmd', () => {\n\t\t\ttest('valid new-lines', () => {\n\t\t\t\t/**\n\t\t\t\t * Valid new-lines have odd number of leading backslashes: \\n, \\\\\\n, \\\\\\\\\\n\n\t\t\t\t */\n\t\t\t\tconst cases = [\n\t\t\t\t\t'\\\\n',\n\t\t\t\t\t'\\\\n at start',\n\t\t\t\t\t'some \\\\n in the middle',\n\t\t\t\t\t'at the end \\\\n',\n\t\t\t\t\t'\\\\\\\\\\\\n',\n\t\t\t\t\t'\\\\\\\\\\\\n valid at start',\n\t\t\t\t\t'valid \\\\\\\\\\\\n in the middle',\n\t\t\t\t\t'valid in the end \\\\\\\\\\\\n',\n\t\t\t\t\t'\\\\\\\\\\\\\\\\\\\\n',\n\t\t\t\t\t'\\\\\\\\\\\\\\\\\\\\n valid at start',\n\t\t\t\t\t'valid \\\\\\\\\\\\\\\\\\\\n in the middle',\n\t\t\t\t\t'valid in the end \\\\\\\\\\\\\\\\\\\\n',\n\t\t\t\t\t'mixed valid \\\\r\\\\n',\n\t\t\t\t\t'mixed valid \\\\\\\\\\\\r\\\\n',\n\t\t\t\t\t'mixed valid \\\\r\\\\\\\\\\\\n',\n\t\t\t\t];\n\n\t\t\t\tfor (const x of cases) {\n\t\t\t\t\tok(sanitizeFishHistoryCmd(x).includes('\\n'));\n\t\t\t\t}\n\t\t\t});\n\n\t\t\ttest('invalid new-lines', () => {\n\t\t\t\t/**\n\t\t\t\t * Invalid new-lines have even number of leading backslashes: \\\\n, \\\\\\\\n, \\\\\\\\\\\\n\n\t\t\t\t */\n\t\t\t\tconst cases = [\n\t\t\t\t\t'\\\\\\\\n',\n\t\t\t\t\t'\\\\\\\\n invalid at start',\n\t\t\t\t\t'invalid \\\\\\\\n in the middle',\n\t\t\t\t\t'invalid in the end \\\\\\\\n',\n\t\t\t\t\t'\\\\\\\\\\\\\\\\n',\n\t\t\t\t\t'\\\\\\\\\\\\\\\\n invalid at start',\n\t\t\t\t\t'invalid \\\\\\\\\\\\\\\\n in the middle',\n\t\t\t\t\t'invalid in the end \\\\\\\\\\\\\\\\n',\n\t\t\t\t\t'mixed invalid \\\\r\\\\\\\\n',\n\t\t\t\t\t'mixed invalid \\\\r\\\\\\\\\\\\\\\\n',\n\t\t\t\t\t'echo \"\\\\\\\\n\"',\n\t\t\t\t];\n\n\t\t\t\tfor (const x of cases) {\n\t\t\t\t\tok(!sanitizeFishHistoryCmd(x).includes('\\n'));\n\t\t\t\t}\n\t\t\t});\n\n\t\t});\n\t});\n});\n"]}