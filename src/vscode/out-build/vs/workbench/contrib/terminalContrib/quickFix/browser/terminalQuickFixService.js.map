{"version":3,"sources":["vs/workbench/contrib/terminalContrib/quickFix/browser/terminalQuickFixService.ts"],"names":[],"mappings":"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","file":"terminalQuickFixService.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Emitter } from '../../../../../base/common/event.js';\nimport { IDisposable, toDisposable } from '../../../../../base/common/lifecycle.js';\nimport { localize } from '../../../../../nls.js';\nimport { ITerminalCommandSelector } from '../../../../../platform/terminal/common/terminal.js';\nimport { ITerminalQuickFixService, ITerminalQuickFixProvider, ITerminalQuickFixProviderSelector } from './quickFix.js';\nimport { isProposedApiEnabled } from '../../../../services/extensions/common/extensions.js';\nimport { ExtensionsRegistry } from '../../../../services/extensions/common/extensionsRegistry.js';\n\nexport class TerminalQuickFixService implements ITerminalQuickFixService {\n\tdeclare _serviceBrand: undefined;\n\n\tprivate _selectors: Map<string, ITerminalCommandSelector> = new Map();\n\n\tprivate _providers: Map<string, ITerminalQuickFixProvider> = new Map();\n\tget providers(): Map<string, ITerminalQuickFixProvider> { return this._providers; }\n\n\tprivate _pendingProviders: Map<string, ITerminalQuickFixProvider> = new Map();\n\n\tprivate readonly _onDidRegisterProvider = new Emitter<ITerminalQuickFixProviderSelector>();\n\treadonly onDidRegisterProvider = this._onDidRegisterProvider.event;\n\tprivate readonly _onDidRegisterCommandSelector = new Emitter<ITerminalCommandSelector>();\n\treadonly onDidRegisterCommandSelector = this._onDidRegisterCommandSelector.event;\n\tprivate readonly _onDidUnregisterProvider = new Emitter<string>();\n\treadonly onDidUnregisterProvider = this._onDidUnregisterProvider.event;\n\n\treadonly extensionQuickFixes: Promise<Array<ITerminalCommandSelector>>;\n\n\tconstructor() {\n\t\tthis.extensionQuickFixes = new Promise((r) => quickFixExtensionPoint.setHandler(fixes => {\n\t\t\tr(fixes.filter(c => isProposedApiEnabled(c.description, 'terminalQuickFixProvider')).map(c => {\n\t\t\t\tif (!c.value) {\n\t\t\t\t\treturn [];\n\t\t\t\t}\n\t\t\t\treturn c.value.map(fix => { return { ...fix, extensionIdentifier: c.description.identifier.value }; });\n\t\t\t}).flat());\n\t\t}));\n\t\tthis.extensionQuickFixes.then(selectors => {\n\t\t\tfor (const selector of selectors) {\n\t\t\t\tthis.registerCommandSelector(selector);\n\t\t\t}\n\t\t});\n\t}\n\n\tregisterCommandSelector(selector: ITerminalCommandSelector): void {\n\t\tthis._selectors.set(selector.id, selector);\n\t\tthis._onDidRegisterCommandSelector.fire(selector);\n\n\t\t// Check if there's a pending provider for this selector\n\t\tconst pendingProvider = this._pendingProviders.get(selector.id);\n\t\tif (pendingProvider) {\n\t\t\tthis._pendingProviders.delete(selector.id);\n\t\t\tthis._providers.set(selector.id, pendingProvider);\n\t\t\tthis._onDidRegisterProvider.fire({ selector, provider: pendingProvider });\n\t\t}\n\t}\n\n\tregisterQuickFixProvider(id: string, provider: ITerminalQuickFixProvider): IDisposable {\n\t\t// This is more complicated than it looks like it should be because we need to return an\n\t\t// IDisposable synchronously but we must await ITerminalContributionService.quickFixes\n\t\t// asynchronously before actually registering the provider.\n\t\tlet disposed = false;\n\t\tthis.extensionQuickFixes.then(() => {\n\t\t\tif (disposed) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst selector = this._selectors.get(id);\n\t\t\tif (selector) {\n\t\t\t\t// Selector is already available, register immediately\n\t\t\t\tthis._providers.set(id, provider);\n\t\t\t\tthis._onDidRegisterProvider.fire({ selector, provider });\n\t\t\t} else {\n\t\t\t\t// Selector not yet available, store provider as pending\n\t\t\t\tthis._pendingProviders.set(id, provider);\n\t\t\t}\n\t\t});\n\t\treturn toDisposable(() => {\n\t\t\tdisposed = true;\n\t\t\tthis._providers.delete(id);\n\t\t\tthis._pendingProviders.delete(id);\n\t\t\tconst selector = this._selectors.get(id);\n\t\t\tif (selector) {\n\t\t\t\tthis._selectors.delete(id);\n\t\t\t\tthis._onDidUnregisterProvider.fire(selector.id);\n\t\t\t}\n\t\t});\n\t}\n}\n\nconst quickFixExtensionPoint = ExtensionsRegistry.registerExtensionPoint<ITerminalCommandSelector[]>({\n\textensionPoint: 'terminalQuickFixes',\n\tdefaultExtensionKind: ['workspace'],\n\tactivationEventsGenerator: function* (terminalQuickFixes: readonly ITerminalCommandSelector[]) {\n\t\tfor (const quickFixContrib of terminalQuickFixes ?? []) {\n\t\t\tyield `onTerminalQuickFixRequest:${quickFixContrib.id}`;\n\t\t}\n\t},\n\tjsonSchema: {\n\t\tdescription: localize('vscode.extension.contributes.terminalQuickFixes', 'Contributes terminal quick fixes.'),\n\t\ttype: 'array',\n\t\titems: {\n\t\t\ttype: 'object',\n\t\t\tadditionalProperties: false,\n\t\t\trequired: ['id', 'commandLineMatcher', 'outputMatcher', 'commandExitResult'],\n\t\t\tdefaultSnippets: [{\n\t\t\t\tbody: {\n\t\t\t\t\tid: '$1',\n\t\t\t\t\tcommandLineMatcher: '$2',\n\t\t\t\t\toutputMatcher: '$3',\n\t\t\t\t\texitStatus: '$4'\n\t\t\t\t}\n\t\t\t}],\n\t\t\tproperties: {\n\t\t\t\tid: {\n\t\t\t\t\tdescription: localize('vscode.extension.contributes.terminalQuickFixes.id', \"The ID of the quick fix provider\"),\n\t\t\t\t\ttype: 'string',\n\t\t\t\t},\n\t\t\t\tcommandLineMatcher: {\n\t\t\t\t\tdescription: localize('vscode.extension.contributes.terminalQuickFixes.commandLineMatcher', \"A regular expression or string to test the command line against\"),\n\t\t\t\t\ttype: 'string',\n\t\t\t\t},\n\t\t\t\toutputMatcher: {\n\t\t\t\t\tmarkdownDescription: localize('vscode.extension.contributes.terminalQuickFixes.outputMatcher', \"A regular expression or string to match a single line of the output against, which provides groups to be referenced in terminalCommand and uri.\\n\\nFor example:\\n\\n `lineMatcher: /git push --set-upstream origin (?<branchName>[^\\s]+)/;`\\n\\n`terminalCommand: 'git push --set-upstream origin ${group:branchName}';`\\n\"),\n\t\t\t\t\ttype: 'object',\n\t\t\t\t\trequired: ['lineMatcher', 'anchor', 'offset', 'length'],\n\t\t\t\t\tproperties: {\n\t\t\t\t\t\tlineMatcher: {\n\t\t\t\t\t\t\tdescription: 'A regular expression or string to test the command line against',\n\t\t\t\t\t\t\ttype: 'string'\n\t\t\t\t\t\t},\n\t\t\t\t\t\tanchor: {\n\t\t\t\t\t\t\tdescription: 'Where the search should begin in the buffer',\n\t\t\t\t\t\t\tenum: ['top', 'bottom']\n\t\t\t\t\t\t},\n\t\t\t\t\t\toffset: {\n\t\t\t\t\t\t\tdescription: 'The number of lines vertically from the anchor in the buffer to start matching against',\n\t\t\t\t\t\t\ttype: 'number'\n\t\t\t\t\t\t},\n\t\t\t\t\t\tlength: {\n\t\t\t\t\t\t\tdescription: 'The number of rows to match against, this should be as small as possible for performance reasons',\n\t\t\t\t\t\t\ttype: 'number'\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tcommandExitResult: {\n\t\t\t\t\tdescription: localize('vscode.extension.contributes.terminalQuickFixes.commandExitResult', \"The command exit result to match on\"),\n\t\t\t\t\tenum: ['success', 'error'],\n\t\t\t\t\tenumDescriptions: [\n\t\t\t\t\t\t'The command exited with an exit code of zero.',\n\t\t\t\t\t\t'The command exited with a non-zero exit code.'\n\t\t\t\t\t]\n\t\t\t\t},\n\t\t\t\tkind: {\n\t\t\t\t\tdescription: localize('vscode.extension.contributes.terminalQuickFixes.kind', \"The kind of the resulting quick fix. This changes how the quick fix is presented. Defaults to {0}.\", '`\"fix\"`'),\n\t\t\t\t\tenum: ['default', 'explain'],\n\t\t\t\t\tenumDescriptions: [\n\t\t\t\t\t\t'A high confidence quick fix.',\n\t\t\t\t\t\t'An explanation of the problem.'\n\t\t\t\t\t]\n\t\t\t\t}\n\t\t\t},\n\t\t}\n\t},\n});\n"]}