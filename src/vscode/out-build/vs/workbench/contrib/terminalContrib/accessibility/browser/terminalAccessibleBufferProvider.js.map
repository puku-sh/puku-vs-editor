{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/contrib/terminalContrib/accessibility/browser/terminalAccessibleBufferProvider.ts","vs/workbench/contrib/terminalContrib/accessibility/browser/terminalAccessibleBufferProvider.ts"],"names":[],"mappings":"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","file":"terminalAccessibleBufferProvider.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Emitter } from '../../../../../base/common/event.js';\nimport { Disposable } from '../../../../../base/common/lifecycle.js';\nimport { IAccessibleViewContentProvider, AccessibleViewProviderId, IAccessibleViewOptions, AccessibleViewType, IAccessibleViewSymbol } from '../../../../../platform/accessibility/browser/accessibleView.js';\nimport { IConfigurationService } from '../../../../../platform/configuration/common/configuration.js';\nimport { TerminalCapability, ITerminalCommand } from '../../../../../platform/terminal/common/capabilities/capabilities.js';\nimport { ICurrentPartialCommand, isFullTerminalCommand } from '../../../../../platform/terminal/common/capabilities/commandDetection/terminalCommand.js';\nimport { AccessibilityVerbositySettingId } from '../../../accessibility/browser/accessibilityConfiguration.js';\nimport { ITerminalInstance, ITerminalService } from '../../../terminal/browser/terminal.js';\nimport { BufferContentTracker } from './bufferContentTracker.js';\nimport { TerminalAccessibilitySettingId } from '../common/terminalAccessibilityConfiguration.js';\n\nexport class TerminalAccessibleBufferProvider extends Disposable implements IAccessibleViewContentProvider {\n\treadonly id = AccessibleViewProviderId.Terminal;\n\treadonly options: IAccessibleViewOptions = { type: AccessibleViewType.View, language: 'terminal', id: AccessibleViewProviderId.Terminal };\n\treadonly verbositySettingKey = AccessibilityVerbositySettingId.Terminal;\n\n\tprivate _focusedInstance: ITerminalInstance | undefined;\n\n\tprivate readonly _onDidRequestClearProvider = new Emitter<AccessibleViewProviderId>();\n\treadonly onDidRequestClearLastProvider = this._onDidRequestClearProvider.event;\n\n\tconstructor(\n\t\tprivate readonly _instance: Pick<ITerminalInstance, 'onDidExecuteText' | 'focus' | 'shellType' | 'capabilities' | 'onDidRequestFocus' | 'resource' | 'onDisposed'>,\n\t\tprivate _bufferTracker: BufferContentTracker,\n\t\tcustomHelp: () => string,\n\t\t@IConfigurationService configurationService: IConfigurationService,\n\t\t@ITerminalService terminalService: ITerminalService,\n\t) {\n\t\tsuper();\n\t\tthis.options.customHelp = customHelp;\n\t\tthis.options.position = configurationService.getValue(TerminalAccessibilitySettingId.AccessibleViewPreserveCursorPosition) ? 'initial-bottom' : 'bottom';\n\t\tthis._register(this._instance.onDisposed(() => this._onDidRequestClearProvider.fire(AccessibleViewProviderId.Terminal)));\n\t\tthis._register(configurationService.onDidChangeConfiguration(e => {\n\t\t\tif (e.affectsConfiguration(TerminalAccessibilitySettingId.AccessibleViewPreserveCursorPosition)) {\n\t\t\t\tthis.options.position = configurationService.getValue(TerminalAccessibilitySettingId.AccessibleViewPreserveCursorPosition) ? 'initial-bottom' : 'bottom';\n\t\t\t}\n\t\t}));\n\t\tthis._focusedInstance = terminalService.activeInstance;\n\t\tthis._register(terminalService.onDidChangeActiveInstance(() => {\n\t\t\tif (terminalService.activeInstance && this._focusedInstance?.instanceId !== terminalService.activeInstance?.instanceId) {\n\t\t\t\tthis._onDidRequestClearProvider.fire(AccessibleViewProviderId.Terminal);\n\t\t\t\tthis._focusedInstance = terminalService.activeInstance;\n\t\t\t}\n\t\t}));\n\t}\n\n\tonClose() {\n\t\tthis._instance.focus();\n\t}\n\n\tprovideContent(): string {\n\t\tthis._bufferTracker.update();\n\t\treturn this._bufferTracker.lines.join('\\n');\n\t}\n\n\tgetSymbols(): IAccessibleViewSymbol[] {\n\t\tconst commands = this._getCommandsWithEditorLine() ?? [];\n\t\tconst symbols: IAccessibleViewSymbol[] = [];\n\t\tfor (const command of commands) {\n\t\t\tconst label = command.command.command;\n\t\t\tif (label) {\n\t\t\t\tsymbols.push({\n\t\t\t\t\tlabel,\n\t\t\t\t\tlineNumber: command.lineNumber\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t\treturn symbols;\n\t}\n\n\tprivate _getCommandsWithEditorLine(): ICommandWithEditorLine[] | undefined {\n\t\tconst capability = this._instance.capabilities.get(TerminalCapability.CommandDetection);\n\t\tconst commands = capability?.commands;\n\t\tconst currentCommand = capability?.currentCommand;\n\t\tif (!commands?.length) {\n\t\t\treturn;\n\t\t}\n\t\tconst result: ICommandWithEditorLine[] = [];\n\t\tfor (const command of commands) {\n\t\t\tconst lineNumber = this._getEditorLineForCommand(command);\n\t\t\tif (lineNumber === undefined) {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tresult.push({ command, lineNumber, exitCode: command.exitCode });\n\t\t}\n\t\tif (currentCommand) {\n\t\t\tconst lineNumber = this._getEditorLineForCommand(currentCommand);\n\t\t\tif (lineNumber !== undefined) {\n\t\t\t\tresult.push({ command: currentCommand, lineNumber });\n\t\t\t}\n\t\t}\n\t\treturn result;\n\t}\n\tprivate _getEditorLineForCommand(command: ITerminalCommand | ICurrentPartialCommand): number | undefined {\n\t\tlet line: number | undefined;\n\t\tif (isFullTerminalCommand(command)) {\n\t\t\tline = command.marker?.line;\n\t\t} else {\n\t\t\tline = command.commandStartMarker?.line;\n\t\t}\n\t\tif (line === undefined || line < 0) {\n\t\t\treturn;\n\t\t}\n\t\tline = this._bufferTracker.bufferToEditorLineMapping.get(line);\n\t\tif (line === undefined) {\n\t\t\treturn;\n\t\t}\n\t\treturn line + 1;\n\t}\n}\nexport interface ICommandWithEditorLine { command: ITerminalCommand | ICurrentPartialCommand; lineNumber: number; exitCode?: number }\n\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Emitter } from '../../../../../base/common/event.js';\nimport { Disposable } from '../../../../../base/common/lifecycle.js';\nimport { IAccessibleViewContentProvider, AccessibleViewProviderId, IAccessibleViewOptions, AccessibleViewType, IAccessibleViewSymbol } from '../../../../../platform/accessibility/browser/accessibleView.js';\nimport { IConfigurationService } from '../../../../../platform/configuration/common/configuration.js';\nimport { TerminalCapability, ITerminalCommand } from '../../../../../platform/terminal/common/capabilities/capabilities.js';\nimport { ICurrentPartialCommand, isFullTerminalCommand } from '../../../../../platform/terminal/common/capabilities/commandDetection/terminalCommand.js';\nimport { AccessibilityVerbositySettingId } from '../../../accessibility/browser/accessibilityConfiguration.js';\nimport { ITerminalInstance, ITerminalService } from '../../../terminal/browser/terminal.js';\nimport { BufferContentTracker } from './bufferContentTracker.js';\nimport { TerminalAccessibilitySettingId } from '../common/terminalAccessibilityConfiguration.js';\n\nexport class TerminalAccessibleBufferProvider extends Disposable implements IAccessibleViewContentProvider {\n\treadonly id = AccessibleViewProviderId.Terminal;\n\treadonly options: IAccessibleViewOptions = { type: AccessibleViewType.View, language: 'terminal', id: AccessibleViewProviderId.Terminal };\n\treadonly verbositySettingKey = AccessibilityVerbositySettingId.Terminal;\n\n\tprivate _focusedInstance: ITerminalInstance | undefined;\n\n\tprivate readonly _onDidRequestClearProvider = new Emitter<AccessibleViewProviderId>();\n\treadonly onDidRequestClearLastProvider = this._onDidRequestClearProvider.event;\n\n\tconstructor(\n\t\tprivate readonly _instance: Pick<ITerminalInstance, 'onDidExecuteText' | 'focus' | 'shellType' | 'capabilities' | 'onDidRequestFocus' | 'resource' | 'onDisposed'>,\n\t\tprivate _bufferTracker: BufferContentTracker,\n\t\tcustomHelp: () => string,\n\t\t@IConfigurationService configurationService: IConfigurationService,\n\t\t@ITerminalService terminalService: ITerminalService,\n\t) {\n\t\tsuper();\n\t\tthis.options.customHelp = customHelp;\n\t\tthis.options.position = configurationService.getValue(TerminalAccessibilitySettingId.AccessibleViewPreserveCursorPosition) ? 'initial-bottom' : 'bottom';\n\t\tthis._register(this._instance.onDisposed(() => this._onDidRequestClearProvider.fire(AccessibleViewProviderId.Terminal)));\n\t\tthis._register(configurationService.onDidChangeConfiguration(e => {\n\t\t\tif (e.affectsConfiguration(TerminalAccessibilitySettingId.AccessibleViewPreserveCursorPosition)) {\n\t\t\t\tthis.options.position = configurationService.getValue(TerminalAccessibilitySettingId.AccessibleViewPreserveCursorPosition) ? 'initial-bottom' : 'bottom';\n\t\t\t}\n\t\t}));\n\t\tthis._focusedInstance = terminalService.activeInstance;\n\t\tthis._register(terminalService.onDidChangeActiveInstance(() => {\n\t\t\tif (terminalService.activeInstance && this._focusedInstance?.instanceId !== terminalService.activeInstance?.instanceId) {\n\t\t\t\tthis._onDidRequestClearProvider.fire(AccessibleViewProviderId.Terminal);\n\t\t\t\tthis._focusedInstance = terminalService.activeInstance;\n\t\t\t}\n\t\t}));\n\t}\n\n\tonClose() {\n\t\tthis._instance.focus();\n\t}\n\n\tprovideContent(): string {\n\t\tthis._bufferTracker.update();\n\t\treturn this._bufferTracker.lines.join('\\n');\n\t}\n\n\tgetSymbols(): IAccessibleViewSymbol[] {\n\t\tconst commands = this._getCommandsWithEditorLine() ?? [];\n\t\tconst symbols: IAccessibleViewSymbol[] = [];\n\t\tfor (const command of commands) {\n\t\t\tconst label = command.command.command;\n\t\t\tif (label) {\n\t\t\t\tsymbols.push({\n\t\t\t\t\tlabel,\n\t\t\t\t\tlineNumber: command.lineNumber\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t\treturn symbols;\n\t}\n\n\tprivate _getCommandsWithEditorLine(): ICommandWithEditorLine[] | undefined {\n\t\tconst capability = this._instance.capabilities.get(TerminalCapability.CommandDetection);\n\t\tconst commands = capability?.commands;\n\t\tconst currentCommand = capability?.currentCommand;\n\t\tif (!commands?.length) {\n\t\t\treturn;\n\t\t}\n\t\tconst result: ICommandWithEditorLine[] = [];\n\t\tfor (const command of commands) {\n\t\t\tconst lineNumber = this._getEditorLineForCommand(command);\n\t\t\tif (lineNumber === undefined) {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tresult.push({ command, lineNumber, exitCode: command.exitCode });\n\t\t}\n\t\tif (currentCommand) {\n\t\t\tconst lineNumber = this._getEditorLineForCommand(currentCommand);\n\t\t\tif (lineNumber !== undefined) {\n\t\t\t\tresult.push({ command: currentCommand, lineNumber });\n\t\t\t}\n\t\t}\n\t\treturn result;\n\t}\n\tprivate _getEditorLineForCommand(command: ITerminalCommand | ICurrentPartialCommand): number | undefined {\n\t\tlet line: number | undefined;\n\t\tif (isFullTerminalCommand(command)) {\n\t\t\tline = command.marker?.line;\n\t\t} else {\n\t\t\tline = command.commandStartMarker?.line;\n\t\t}\n\t\tif (line === undefined || line < 0) {\n\t\t\treturn;\n\t\t}\n\t\tline = this._bufferTracker.bufferToEditorLineMapping.get(line);\n\t\tif (line === undefined) {\n\t\t\treturn;\n\t\t}\n\t\treturn line + 1;\n\t}\n}\nexport interface ICommandWithEditorLine { command: ITerminalCommand | ICurrentPartialCommand; lineNumber: number; exitCode?: number }\n\n"]}