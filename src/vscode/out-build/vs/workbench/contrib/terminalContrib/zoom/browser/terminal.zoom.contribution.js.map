{"version":3,"sources":["vs/workbench/contrib/terminalContrib/zoom/browser/terminal.zoom.contribution.ts"],"names":[],"mappings":"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","file":"terminal.zoom.contribution.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport type { Terminal as RawXtermTerminal } from '@xterm/xterm';\nimport { Event } from '../../../../../base/common/event.js';\nimport { IMouseWheelEvent } from '../../../../../base/browser/mouseEvent.js';\nimport { MouseWheelClassifier } from '../../../../../base/browser/ui/scrollbar/scrollableElement.js';\nimport { Disposable, MutableDisposable, toDisposable } from '../../../../../base/common/lifecycle.js';\nimport { isMacintosh } from '../../../../../base/common/platform.js';\nimport { TerminalSettingId } from '../../../../../platform/terminal/common/terminal.js';\nimport { IDetachedTerminalInstance, ITerminalContribution, ITerminalInstance, IXtermTerminal } from '../../../terminal/browser/terminal.js';\nimport { registerTerminalContribution, type IDetachedCompatibleTerminalContributionContext, type ITerminalContributionContext } from '../../../terminal/browser/terminalExtensions.js';\nimport { IConfigurationService } from '../../../../../platform/configuration/common/configuration.js';\nimport { registerTerminalAction } from '../../../terminal/browser/terminalActions.js';\nimport { localize2 } from '../../../../../nls.js';\nimport { isNumber } from '../../../../../base/common/types.js';\nimport { defaultTerminalFontSize } from '../../../terminal/common/terminalConfiguration.js';\nimport { TerminalZoomCommandId, TerminalZoomSettingId } from '../common/terminal.zoom.js';\n\nclass TerminalMouseWheelZoomContribution extends Disposable implements ITerminalContribution {\n\tstatic readonly ID = 'terminal.mouseWheelZoom';\n\n\t/**\n\t * Currently focused find widget. This is used to track action context since\n\t * 'active terminals' are only tracked for non-detached terminal instanecs.\n\t */\n\tstatic activeFindWidget?: TerminalMouseWheelZoomContribution;\n\n\tstatic get(instance: ITerminalInstance | IDetachedTerminalInstance): TerminalMouseWheelZoomContribution | null {\n\t\treturn instance.getContribution<TerminalMouseWheelZoomContribution>(TerminalMouseWheelZoomContribution.ID);\n\t}\n\n\tprivate readonly _listener = this._register(new MutableDisposable());\n\n\tconstructor(\n\t\t_ctx: ITerminalContributionContext | IDetachedCompatibleTerminalContributionContext,\n\t\t@IConfigurationService private readonly _configurationService: IConfigurationService,\n\t) {\n\t\tsuper();\n\t}\n\n\txtermOpen(xterm: IXtermTerminal & { raw: RawXtermTerminal }): void {\n\t\tthis._register(Event.runAndSubscribe(this._configurationService.onDidChangeConfiguration, e => {\n\t\t\tif (!e || e.affectsConfiguration(TerminalZoomSettingId.MouseWheelZoom)) {\n\t\t\t\tif (!!this._configurationService.getValue(TerminalZoomSettingId.MouseWheelZoom)) {\n\t\t\t\t\tthis._setupMouseWheelZoomListener(xterm.raw);\n\t\t\t\t} else {\n\t\t\t\t\tthis._listener.clear();\n\t\t\t\t}\n\t\t\t}\n\t\t}));\n\t}\n\n\tprivate _getConfigFontSize(): number {\n\t\treturn this._configurationService.getValue(TerminalSettingId.FontSize);\n\t}\n\n\tprivate _clampFontSize(fontSize: number): number {\n\t\treturn clampTerminalFontSize(fontSize);\n\t}\n\n\tprivate _setupMouseWheelZoomListener(raw: RawXtermTerminal) {\n\t\t// This is essentially a copy of what we do in the editor, just we modify font size directly\n\t\t// as there is no separate zoom level concept in the terminal\n\t\tconst classifier = MouseWheelClassifier.INSTANCE;\n\n\t\tlet prevMouseWheelTime = 0;\n\t\tlet gestureStartFontSize = this._getConfigFontSize();\n\t\tlet gestureHasZoomModifiers = false;\n\t\tlet gestureAccumulatedDelta = 0;\n\n\t\traw.attachCustomWheelEventHandler((browserEvent: WheelEvent) => {\n\t\t\tfunction isWheelEvent(e: MouseEvent): e is IMouseWheelEvent {\n\t\t\t\treturn 'wheelDelta' in e && 'wheelDeltaX' in e && 'wheelDeltaY' in e;\n\t\t\t}\n\t\t\tif (isWheelEvent(browserEvent)) {\n\t\t\t\tif (classifier.isPhysicalMouseWheel()) {\n\t\t\t\t\tif (this._hasMouseWheelZoomModifiers(browserEvent)) {\n\t\t\t\t\t\tconst delta = browserEvent.deltaY > 0 ? -1 : 1;\n\t\t\t\t\t\tconst newFontSize = this._clampFontSize(this._getConfigFontSize() + delta);\n\t\t\t\t\t\tthis._configurationService.updateValue(TerminalSettingId.FontSize, newFontSize);\n\t\t\t\t\t\t// EditorZoom.setZoomLevel(zoomLevel + delta);\n\t\t\t\t\t\tbrowserEvent.preventDefault();\n\t\t\t\t\t\tbrowserEvent.stopPropagation();\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\t// we consider mousewheel events that occur within 50ms of each other to be part of the same gesture\n\t\t\t\t\t// we don't want to consider mouse wheel events where ctrl/cmd is pressed during the inertia phase\n\t\t\t\t\t// we also want to accumulate deltaY values from the same gesture and use that to set the zoom level\n\t\t\t\t\tif (Date.now() - prevMouseWheelTime > 50) {\n\t\t\t\t\t\t// reset if more than 50ms have passed\n\t\t\t\t\t\tgestureStartFontSize = this._getConfigFontSize();\n\t\t\t\t\t\tgestureHasZoomModifiers = this._hasMouseWheelZoomModifiers(browserEvent);\n\t\t\t\t\t\tgestureAccumulatedDelta = 0;\n\t\t\t\t\t}\n\n\t\t\t\t\tprevMouseWheelTime = Date.now();\n\t\t\t\t\tgestureAccumulatedDelta += browserEvent.deltaY;\n\n\t\t\t\t\tif (gestureHasZoomModifiers) {\n\t\t\t\t\t\tconst deltaAbs = Math.ceil(Math.abs(gestureAccumulatedDelta / 5));\n\t\t\t\t\t\tconst deltaDirection = gestureAccumulatedDelta > 0 ? -1 : 1;\n\t\t\t\t\t\tconst delta = deltaAbs * deltaDirection;\n\t\t\t\t\t\tconst newFontSize = this._clampFontSize(gestureStartFontSize + delta);\n\t\t\t\t\t\tthis._configurationService.updateValue(TerminalSettingId.FontSize, newFontSize);\n\t\t\t\t\t\tgestureAccumulatedDelta += browserEvent.deltaY;\n\t\t\t\t\t\tbrowserEvent.preventDefault();\n\t\t\t\t\t\tbrowserEvent.stopPropagation();\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn true;\n\t\t});\n\t\tthis._listener.value = toDisposable(() => raw.attachCustomWheelEventHandler(() => true));\n\t}\n\n\tprivate _hasMouseWheelZoomModifiers(browserEvent: IMouseWheelEvent): boolean {\n\t\treturn (\n\t\t\tisMacintosh\n\t\t\t\t// on macOS we support cmd + two fingers scroll (`metaKey` set)\n\t\t\t\t// and also the two fingers pinch gesture (`ctrKey` set)\n\t\t\t\t? ((browserEvent.metaKey || browserEvent.ctrlKey) && !browserEvent.shiftKey && !browserEvent.altKey)\n\t\t\t\t: (browserEvent.ctrlKey && !browserEvent.metaKey && !browserEvent.shiftKey && !browserEvent.altKey)\n\t\t);\n\t}\n}\n\nregisterTerminalContribution(TerminalMouseWheelZoomContribution.ID, TerminalMouseWheelZoomContribution, true);\n\nregisterTerminalAction({\n\tid: TerminalZoomCommandId.FontZoomIn,\n\ttitle: localize2('fontZoomIn', 'Increase Font Size'),\n\trun: async (c, accessor) => {\n\t\tconst configurationService = accessor.get(IConfigurationService);\n\t\tconst value = configurationService.getValue(TerminalSettingId.FontSize);\n\t\tif (isNumber(value)) {\n\t\t\tconst newFontSize = clampTerminalFontSize(value + 1);\n\t\t\tawait configurationService.updateValue(TerminalSettingId.FontSize, newFontSize);\n\t\t}\n\t}\n});\n\nregisterTerminalAction({\n\tid: TerminalZoomCommandId.FontZoomOut,\n\ttitle: localize2('fontZoomOut', 'Decrease Font Size'),\n\trun: async (c, accessor) => {\n\t\tconst configurationService = accessor.get(IConfigurationService);\n\t\tconst value = configurationService.getValue(TerminalSettingId.FontSize);\n\t\tif (isNumber(value)) {\n\t\t\tconst newFontSize = clampTerminalFontSize(value - 1);\n\t\t\tawait configurationService.updateValue(TerminalSettingId.FontSize, newFontSize);\n\t\t}\n\t}\n});\n\nregisterTerminalAction({\n\tid: TerminalZoomCommandId.FontZoomReset,\n\ttitle: localize2('fontZoomReset', 'Reset Font Size'),\n\trun: async (c, accessor) => {\n\t\tconst configurationService = accessor.get(IConfigurationService);\n\t\tawait configurationService.updateValue(TerminalSettingId.FontSize, defaultTerminalFontSize);\n\t}\n});\n\nexport function clampTerminalFontSize(fontSize: number): number {\n\treturn Math.max(6, Math.min(100, fontSize));\n}\n"]}