{"version":3,"sources":["vs/workbench/contrib/surveys/browser/nps.contribution.ts"],"names":[],"mappings":"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","file":"nps.contribution.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as nls from '../../../../nls.js';\nimport { language } from '../../../../base/common/platform.js';\nimport { IWorkbenchContributionsRegistry, IWorkbenchContribution, Extensions as WorkbenchExtensions } from '../../../common/contributions.js';\nimport { Registry } from '../../../../platform/registry/common/platform.js';\nimport { ITelemetryService } from '../../../../platform/telemetry/common/telemetry.js';\nimport { IStorageService, StorageScope, StorageTarget } from '../../../../platform/storage/common/storage.js';\nimport { IProductService } from '../../../../platform/product/common/productService.js';\nimport { LifecyclePhase } from '../../../services/lifecycle/common/lifecycle.js';\nimport { Severity, INotificationService, NotificationPriority } from '../../../../platform/notification/common/notification.js';\nimport { IOpenerService } from '../../../../platform/opener/common/opener.js';\nimport { URI } from '../../../../base/common/uri.js';\nimport { platform } from '../../../../base/common/process.js';\nimport { IConfigurationService } from '../../../../platform/configuration/common/configuration.js';\n\nconst PROBABILITY = 0.15;\nconst SESSION_COUNT_KEY = 'nps/sessionCount';\nconst LAST_SESSION_DATE_KEY = 'nps/lastSessionDate';\nconst SKIP_VERSION_KEY = 'nps/skipVersion';\nconst IS_CANDIDATE_KEY = 'nps/isCandidate';\n\nclass NPSContribution implements IWorkbenchContribution {\n\n\tconstructor(\n\t\t@IStorageService storageService: IStorageService,\n\t\t@INotificationService notificationService: INotificationService,\n\t\t@ITelemetryService telemetryService: ITelemetryService,\n\t\t@IOpenerService openerService: IOpenerService,\n\t\t@IProductService productService: IProductService,\n\t\t@IConfigurationService configurationService: IConfigurationService\n\t) {\n\t\tif (!productService.npsSurveyUrl || !configurationService.getValue<boolean>('telemetry.feedback.enabled')) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst skipVersion = storageService.get(SKIP_VERSION_KEY, StorageScope.APPLICATION, '');\n\t\tif (skipVersion) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst date = new Date().toDateString();\n\t\tconst lastSessionDate = storageService.get(LAST_SESSION_DATE_KEY, StorageScope.APPLICATION, new Date(0).toDateString());\n\n\t\tif (date === lastSessionDate) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst sessionCount = (storageService.getNumber(SESSION_COUNT_KEY, StorageScope.APPLICATION, 0) || 0) + 1;\n\t\tstorageService.store(LAST_SESSION_DATE_KEY, date, StorageScope.APPLICATION, StorageTarget.USER);\n\t\tstorageService.store(SESSION_COUNT_KEY, sessionCount, StorageScope.APPLICATION, StorageTarget.USER);\n\n\t\tif (sessionCount < 9) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst isCandidate = storageService.getBoolean(IS_CANDIDATE_KEY, StorageScope.APPLICATION, false)\n\t\t\t|| Math.random() < PROBABILITY;\n\n\t\tstorageService.store(IS_CANDIDATE_KEY, isCandidate, StorageScope.APPLICATION, StorageTarget.USER);\n\n\t\tif (!isCandidate) {\n\t\t\tstorageService.store(SKIP_VERSION_KEY, productService.version, StorageScope.APPLICATION, StorageTarget.USER);\n\t\t\treturn;\n\t\t}\n\n\t\tnotificationService.prompt(\n\t\t\tSeverity.Info,\n\t\t\tnls.localize('surveyQuestion', \"Do you mind taking a quick feedback survey?\"),\n\t\t\t[{\n\t\t\t\tlabel: nls.localize('takeSurvey', \"Take Survey\"),\n\t\t\t\trun: () => {\n\t\t\t\t\topenerService.open(URI.parse(`${productService.npsSurveyUrl}?o=${encodeURIComponent(platform)}&v=${encodeURIComponent(productService.version)}&m=${encodeURIComponent(telemetryService.machineId)}`));\n\t\t\t\t\tstorageService.store(IS_CANDIDATE_KEY, false, StorageScope.APPLICATION, StorageTarget.USER);\n\t\t\t\t\tstorageService.store(SKIP_VERSION_KEY, productService.version, StorageScope.APPLICATION, StorageTarget.USER);\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\tlabel: nls.localize('remindLater', \"Remind Me Later\"),\n\t\t\t\trun: () => storageService.store(SESSION_COUNT_KEY, sessionCount - 3, StorageScope.APPLICATION, StorageTarget.USER)\n\t\t\t}, {\n\t\t\t\tlabel: nls.localize('neverAgain', \"Don't Show Again\"),\n\t\t\t\trun: () => {\n\t\t\t\t\tstorageService.store(IS_CANDIDATE_KEY, false, StorageScope.APPLICATION, StorageTarget.USER);\n\t\t\t\t\tstorageService.store(SKIP_VERSION_KEY, productService.version, StorageScope.APPLICATION, StorageTarget.USER);\n\t\t\t\t}\n\t\t\t}],\n\t\t\t{ priority: NotificationPriority.URGENT }\n\t\t);\n\t}\n}\n\nif (language === 'en') {\n\tconst workbenchRegistry = Registry.as<IWorkbenchContributionsRegistry>(WorkbenchExtensions.Workbench);\n\tworkbenchRegistry.registerWorkbenchContribution(NPSContribution, LifecyclePhase.Restored);\n}\n"]}