{"version":3,"sources":["vs/workbench/contrib/surveys/browser/languageSurveys.contribution.ts"],"names":[],"mappings":"AAAA;;;gGAGgG;;;;;;;;;;AAEhG,OAAO,EAAE,QAAQ,EAAE,MAAM,oBAAoB,CAAC;AAC9C,OAAO,EAAE,QAAQ,EAAE,MAAM,qCAAqC,CAAC;AAC/D,OAAO,EAAE,gBAAgB,EAAE,MAAM,iDAAiD,CAAC;AACnF,OAAO,EAA2D,UAAU,IAAI,mBAAmB,EAAE,MAAM,kCAAkC,CAAC;AAC9I,OAAO,EAAE,QAAQ,EAAE,MAAM,kDAAkD,CAAC;AAC5E,OAAO,EAAE,iBAAiB,EAAE,MAAM,oDAAoD,CAAC;AACvF,OAAO,EAAE,eAAe,EAA+B,MAAM,gDAAgD,CAAC;AAC9G,OAAO,EAAE,eAAe,EAAE,MAAM,uDAAuD,CAAC;AAGxF,OAAO,EAAE,QAAQ,EAAE,oBAAoB,EAAE,oBAAoB,EAAE,MAAM,0DAA0D,CAAC;AAChI,OAAO,EAAE,gBAAgB,EAAwB,MAAM,gDAAgD,CAAC;AACxG,OAAO,EAAE,cAAc,EAAE,MAAM,8CAA8C,CAAC;AAC9E,OAAO,EAAE,GAAG,EAAE,MAAM,gCAAgC,CAAC;AACrD,OAAO,EAAE,QAAQ,EAAE,MAAM,oCAAoC,CAAC;AAC9D,OAAO,EAAE,aAAa,EAAE,MAAM,kCAAkC,CAAC;AACjE,OAAO,EAAE,UAAU,EAAE,MAAM,sCAAsC,CAAC;AAClE,OAAO,EAAE,iBAAiB,EAAE,MAAM,mDAAmD,CAAC;AAEtF,MAAM,cAAe,SAAQ,UAAU;IAEtC,YACC,IAAiB,EACjB,cAA+B,EAC/B,mBAAyC,EACzC,gBAAmC,EACnC,eAAiC,EACjC,eAAiC,EACjC,aAA6B,EAC7B,cAA+B;QAE/B,KAAK,EAAE,CAAC;QAER,MAAM,iBAAiB,GAAG,GAAG,IAAI,CAAC,QAAQ,eAAe,CAAC;QAC1D,MAAM,qBAAqB,GAAG,GAAG,IAAI,CAAC,QAAQ,kBAAkB,CAAC;QACjE,MAAM,gBAAgB,GAAG,GAAG,IAAI,CAAC,QAAQ,cAAc,CAAC;QACxD,MAAM,gBAAgB,GAAG,GAAG,IAAI,CAAC,QAAQ,cAAc,CAAC;QACxD,MAAM,yBAAyB,GAAG,GAAG,IAAI,CAAC,QAAQ,cAAc,CAAC;QACjE,MAAM,wBAAwB,GAAG,GAAG,IAAI,CAAC,QAAQ,aAAa,CAAC;QAE/D,MAAM,WAAW,GAAG,cAAc,CAAC,GAAG,CAAC,gBAAgB,qCAA4B,EAAE,CAAC,CAAC;QACvF,IAAI,WAAW,EAAE,CAAC;YACjB,OAAO;QACR,CAAC;QAED,MAAM,IAAI,GAAG,IAAI,IAAI,EAAE,CAAC,YAAY,EAAE,CAAC;QAEvC,IAAI,cAAc,CAAC,SAAS,CAAC,yBAAyB,qCAA4B,CAAC,CAAC,GAAG,IAAI,CAAC,SAAS,EAAE,CAAC;YAEvG,sDAAsD;YACtD,MAAM,mBAAmB,GAAG,IAAI,CAAC,SAAS,CAAC,IAAI,aAAa,CAAuB,MAAM,CAAC,EAAE;gBAC3F,MAAM,CAAC,OAAO,CAAC,CAAC,CAAC,EAAE;oBAClB,IAAI,CAAC,CAAC,aAAa,EAAE,KAAK,IAAI,CAAC,UAAU,IAAI,IAAI,KAAK,cAAc,CAAC,GAAG,CAAC,wBAAwB,oCAA2B,EAAE,CAAC;wBAC9H,MAAM,WAAW,GAAG,cAAc,CAAC,SAAS,CAAC,yBAAyB,qCAA4B,CAAC,CAAC,GAAG,CAAC,CAAC;wBACzG,cAAc,CAAC,KAAK,CAAC,yBAAyB,EAAE,WAAW,gEAA+C,CAAC;wBAC3G,cAAc,CAAC,KAAK,CAAC,wBAAwB,EAAE,IAAI,gEAA+C,CAAC;oBACpG,CAAC;gBACF,CAAC,CAAC,CAAC;YACJ,CAAC,EAAE,GAAG,CAAC,CAAC,CAAC;YAET,IAAI,CAAC,SAAS,CAAC,eAAe,CAAC,KAAK,CAAC,SAAS,CAAC,CAAC,CAAC,EAAE,CAAC,mBAAmB,CAAC,IAAI,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC;QACzF,CAAC;QAED,MAAM,eAAe,GAAG,cAAc,CAAC,GAAG,CAAC,qBAAqB,qCAA4B,IAAI,IAAI,CAAC,CAAC,CAAC,CAAC,YAAY,EAAE,CAAC,CAAC;QACxH,IAAI,IAAI,KAAK,eAAe,EAAE,CAAC;YAC9B,OAAO;QACR,CAAC;QAED,MAAM,YAAY,GAAG,cAAc,CAAC,SAAS,CAAC,iBAAiB,qCAA4B,CAAC,CAAC,GAAG,CAAC,CAAC;QAClG,cAAc,CAAC,KAAK,CAAC,qBAAqB,EAAE,IAAI,gEAA+C,CAAC;QAChG,cAAc,CAAC,KAAK,CAAC,iBAAiB,EAAE,YAAY,gEAA+C,CAAC;QAEpG,IAAI,YAAY,GAAG,CAAC,EAAE,CAAC;YACtB,OAAO;QACR,CAAC;QAED,IAAI,cAAc,CAAC,SAAS,CAAC,yBAAyB,qCAA4B,CAAC,CAAC,GAAG,IAAI,CAAC,SAAS,EAAE,CAAC;YACvG,OAAO;QACR,CAAC;QAED,MAAM,WAAW,GAAG,cAAc,CAAC,UAAU,CAAC,gBAAgB,qCAA4B,KAAK,CAAC;eAC5F,IAAI,CAAC,MAAM,EAAE,GAAG,IAAI,CAAC,eAAe,CAAC;QAEzC,cAAc,CAAC,KAAK,CAAC,gBAAgB,EAAE,WAAW,gEAA+C,CAAC;QAElG,IAAI,CAAC,WAAW,EAAE,CAAC;YAClB,cAAc,CAAC,KAAK,CAAC,gBAAgB,EAAE,cAAc,CAAC,OAAO,gEAA+C,CAAC;YAC7G,OAAO;QACR,CAAC;QAED,mBAAmB,CAAC,MAAM,CACzB,QAAQ,CAAC,IAAI,EACb,QAAQ,CAAC,KAAQ,EAAE,IAAqC,EAAE,eAAe,CAAC,eAAe,CAAC,IAAI,CAAC,UAAU,CAAC,IAAI,IAAI,CAAC,UAAU,CAAC,EAC9H,CAAC;gBACA,KAAK,EAAE,QAAQ,CAAC,KAAiB,EAAE,IAAmB,CAAC;gBACvD,GAAG,EAAE,GAAG,EAAE;oBACT,gBAAgB,CAAC,SAAS,CAAC,GAAG,IAAI,CAAC,QAAQ,yBAAyB,CAAC,CAAC;oBACtE,aAAa,CAAC,IAAI,CAAC,GAAG,CAAC,KAAK,CAAC,GAAG,IAAI,CAAC,SAAS,MAAM,kBAAkB,CAAC,QAAQ,CAAC,MAAM,kBAAkB,CAAC,cAAc,CAAC,OAAO,CAAC,MAAM,kBAAkB,CAAC,gBAAgB,CAAC,SAAS,CAAC,EAAE,CAAC,CAAC,CAAC;oBACzL,cAAc,CAAC,KAAK,CAAC,gBAAgB,EAAE,KAAK,gEAA+C,CAAC;oBAC5F,cAAc,CAAC,KAAK,CAAC,gBAAgB,EAAE,cAAc,CAAC,OAAO,gEAA+C,CAAC;gBAC9G,CAAC;aACD,EAAE;gBACF,KAAK,EAAE,QAAQ,CAAC,KAAa,EAAE,IAAiB,CAAC;gBACjD,GAAG,EAAE,GAAG,EAAE;oBACT,gBAAgB,CAAC,SAAS,CAAC,GAAG,IAAI,CAAC,QAAQ,uBAAuB,CAAC,CAAC;oBACpE,cAAc,CAAC,KAAK,CAAC,iBAAiB,EAAE,YAAY,GAAG,CAAC,gEAA+C,CAAC;gBACzG,CAAC;aACD,EAAE;gBACF,KAAK,EAAE,QAAQ,CAAC,KAAY,EAAE,IAAkB,CAAC;gBACjD,WAAW,EAAE,IAAI;gBACjB,GAAG,EAAE,GAAG,EAAE;oBACT,gBAAgB,CAAC,SAAS,CAAC,GAAG,IAAI,CAAC,QAAQ,uBAAuB,CAAC,CAAC;oBACpE,cAAc,CAAC,KAAK,CAAC,gBAAgB,EAAE,KAAK,gEAA+C,CAAC;oBAC5F,cAAc,CAAC,KAAK,CAAC,gBAAgB,EAAE,cAAc,CAAC,OAAO,gEAA+C,CAAC;gBAC9G,CAAC;aACD,CAAC,EACF,EAAE,QAAQ,EAAE,oBAAoB,CAAC,QAAQ,EAAE,CAC3C,CAAC;IACH,CAAC;CACD;AAED,IAAM,2BAA2B,GAAjC,MAAM,2BAA2B;IAEhC,YACmC,cAA+B,EAC1B,mBAAyC,EAC5C,gBAAmC,EACpC,eAAiC,EACnC,aAA6B,EAC5B,cAA+B,EAC9B,eAAiC,EAChC,gBAAmC;QAPrC,mBAAc,GAAd,cAAc,CAAiB;QAC1B,wBAAmB,GAAnB,mBAAmB,CAAsB;QAC5C,qBAAgB,GAAhB,gBAAgB,CAAmB;QACpC,oBAAe,GAAf,eAAe,CAAkB;QACnC,kBAAa,GAAb,aAAa,CAAgB;QAC5B,mBAAc,GAAd,cAAc,CAAiB;QAC9B,oBAAe,GAAf,eAAe,CAAkB;QAChC,qBAAgB,GAAhB,gBAAgB,CAAmB;QAEvE,IAAI,CAAC,aAAa,EAAE,CAAC;IACtB,CAAC;IAEO,KAAK,CAAC,aAAa;QAC1B,IAAI,CAAC,IAAI,CAAC,cAAc,CAAC,OAAO,EAAE,CAAC;YAClC,OAAO;QACR,CAAC;QAED,6CAA6C;QAC7C,yCAAyC;QACzC,+DAA+D;QAC/D,MAAM,IAAI,CAAC,gBAAgB,CAAC,iCAAiC,EAAE,CAAC;QAEhE,iBAAiB;QACjB,IAAI,CAAC,cAAc,CAAC,OAAO;aACzB,MAAM,CAAC,UAAU,CAAC,EAAE,CAAC,UAAU,CAAC,QAAQ,IAAI,UAAU,CAAC,SAAS,IAAI,UAAU,CAAC,UAAU,IAAI,UAAU,CAAC,SAAS,IAAI,UAAU,CAAC,eAAe,CAAC;aAChJ,GAAG,CAAC,UAAU,CAAC,EAAE,CAAC,IAAI,cAAc,CAAC,UAAU,EAAE,IAAI,CAAC,cAAc,EAAE,IAAI,CAAC,mBAAmB,EAAE,IAAI,CAAC,gBAAgB,EAAE,IAAI,CAAC,eAAe,EAAE,IAAI,CAAC,eAAe,EAAE,IAAI,CAAC,aAAa,EAAE,IAAI,CAAC,cAAc,CAAC,CAAC,CAAC;IAChN,CAAC;CACD,CAAA;AA9BK,2BAA2B;IAG9B,WAAA,eAAe,CAAA;IACf,WAAA,oBAAoB,CAAA;IACpB,WAAA,iBAAiB,CAAA;IACjB,WAAA,gBAAgB,CAAA;IAChB,WAAA,cAAc,CAAA;IACd,WAAA,eAAe,CAAA;IACf,WAAA,gBAAgB,CAAA;IAChB,WAAA,iBAAiB,CAAA;GAVd,2BAA2B,CA8BhC;AAED,IAAI,QAAQ,KAAK,IAAI,EAAE,CAAC;IACvB,MAAM,iBAAiB,GAAG,QAAQ,CAAC,EAAE,CAAkC,mBAAmB,CAAC,SAAS,CAAC,CAAC;IACtG,iBAAiB,CAAC,6BAA6B,CAAC,2BAA2B,kCAA0B,CAAC;AACvG,CAAC","file":"languageSurveys.contribution.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { localize } from '../../../../nls.js';\nimport { language } from '../../../../base/common/platform.js';\nimport { ILanguageService } from '../../../../editor/common/languages/language.js';\nimport { IWorkbenchContributionsRegistry, IWorkbenchContribution, Extensions as WorkbenchExtensions } from '../../../common/contributions.js';\nimport { Registry } from '../../../../platform/registry/common/platform.js';\nimport { ITelemetryService } from '../../../../platform/telemetry/common/telemetry.js';\nimport { IStorageService, StorageScope, StorageTarget } from '../../../../platform/storage/common/storage.js';\nimport { IProductService } from '../../../../platform/product/common/productService.js';\nimport { ISurveyData } from '../../../../base/common/product.js';\nimport { LifecyclePhase } from '../../../services/lifecycle/common/lifecycle.js';\nimport { Severity, INotificationService, NotificationPriority } from '../../../../platform/notification/common/notification.js';\nimport { ITextFileService, ITextFileEditorModel } from '../../../services/textfile/common/textfiles.js';\nimport { IOpenerService } from '../../../../platform/opener/common/opener.js';\nimport { URI } from '../../../../base/common/uri.js';\nimport { platform } from '../../../../base/common/process.js';\nimport { RunOnceWorker } from '../../../../base/common/async.js';\nimport { Disposable } from '../../../../base/common/lifecycle.js';\nimport { IExtensionService } from '../../../services/extensions/common/extensions.js';\n\nclass LanguageSurvey extends Disposable {\n\n\tconstructor(\n\t\tdata: ISurveyData,\n\t\tstorageService: IStorageService,\n\t\tnotificationService: INotificationService,\n\t\ttelemetryService: ITelemetryService,\n\t\tlanguageService: ILanguageService,\n\t\ttextFileService: ITextFileService,\n\t\topenerService: IOpenerService,\n\t\tproductService: IProductService\n\t) {\n\t\tsuper();\n\n\t\tconst SESSION_COUNT_KEY = `${data.surveyId}.sessionCount`;\n\t\tconst LAST_SESSION_DATE_KEY = `${data.surveyId}.lastSessionDate`;\n\t\tconst SKIP_VERSION_KEY = `${data.surveyId}.skipVersion`;\n\t\tconst IS_CANDIDATE_KEY = `${data.surveyId}.isCandidate`;\n\t\tconst EDITED_LANGUAGE_COUNT_KEY = `${data.surveyId}.editedCount`;\n\t\tconst EDITED_LANGUAGE_DATE_KEY = `${data.surveyId}.editedDate`;\n\n\t\tconst skipVersion = storageService.get(SKIP_VERSION_KEY, StorageScope.APPLICATION, '');\n\t\tif (skipVersion) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst date = new Date().toDateString();\n\n\t\tif (storageService.getNumber(EDITED_LANGUAGE_COUNT_KEY, StorageScope.APPLICATION, 0) < data.editCount) {\n\n\t\t\t// Process model-save event every 250ms to reduce load\n\t\t\tconst onModelsSavedWorker = this._register(new RunOnceWorker<ITextFileEditorModel>(models => {\n\t\t\t\tmodels.forEach(m => {\n\t\t\t\t\tif (m.getLanguageId() === data.languageId && date !== storageService.get(EDITED_LANGUAGE_DATE_KEY, StorageScope.APPLICATION)) {\n\t\t\t\t\t\tconst editedCount = storageService.getNumber(EDITED_LANGUAGE_COUNT_KEY, StorageScope.APPLICATION, 0) + 1;\n\t\t\t\t\t\tstorageService.store(EDITED_LANGUAGE_COUNT_KEY, editedCount, StorageScope.APPLICATION, StorageTarget.USER);\n\t\t\t\t\t\tstorageService.store(EDITED_LANGUAGE_DATE_KEY, date, StorageScope.APPLICATION, StorageTarget.USER);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}, 250));\n\n\t\t\tthis._register(textFileService.files.onDidSave(e => onModelsSavedWorker.work(e.model)));\n\t\t}\n\n\t\tconst lastSessionDate = storageService.get(LAST_SESSION_DATE_KEY, StorageScope.APPLICATION, new Date(0).toDateString());\n\t\tif (date === lastSessionDate) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst sessionCount = storageService.getNumber(SESSION_COUNT_KEY, StorageScope.APPLICATION, 0) + 1;\n\t\tstorageService.store(LAST_SESSION_DATE_KEY, date, StorageScope.APPLICATION, StorageTarget.USER);\n\t\tstorageService.store(SESSION_COUNT_KEY, sessionCount, StorageScope.APPLICATION, StorageTarget.USER);\n\n\t\tif (sessionCount < 9) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (storageService.getNumber(EDITED_LANGUAGE_COUNT_KEY, StorageScope.APPLICATION, 0) < data.editCount) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst isCandidate = storageService.getBoolean(IS_CANDIDATE_KEY, StorageScope.APPLICATION, false)\n\t\t\t|| Math.random() < data.userProbability;\n\n\t\tstorageService.store(IS_CANDIDATE_KEY, isCandidate, StorageScope.APPLICATION, StorageTarget.USER);\n\n\t\tif (!isCandidate) {\n\t\t\tstorageService.store(SKIP_VERSION_KEY, productService.version, StorageScope.APPLICATION, StorageTarget.USER);\n\t\t\treturn;\n\t\t}\n\n\t\tnotificationService.prompt(\n\t\t\tSeverity.Info,\n\t\t\tlocalize('helpUs', \"Help us improve our support for {0}\", languageService.getLanguageName(data.languageId) ?? data.languageId),\n\t\t\t[{\n\t\t\t\tlabel: localize('takeShortSurvey', \"Take Short Survey\"),\n\t\t\t\trun: () => {\n\t\t\t\t\ttelemetryService.publicLog(`${data.surveyId}.survey/takeShortSurvey`);\n\t\t\t\t\topenerService.open(URI.parse(`${data.surveyUrl}?o=${encodeURIComponent(platform)}&v=${encodeURIComponent(productService.version)}&m=${encodeURIComponent(telemetryService.machineId)}`));\n\t\t\t\t\tstorageService.store(IS_CANDIDATE_KEY, false, StorageScope.APPLICATION, StorageTarget.USER);\n\t\t\t\t\tstorageService.store(SKIP_VERSION_KEY, productService.version, StorageScope.APPLICATION, StorageTarget.USER);\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\tlabel: localize('remindLater', \"Remind Me Later\"),\n\t\t\t\trun: () => {\n\t\t\t\t\ttelemetryService.publicLog(`${data.surveyId}.survey/remindMeLater`);\n\t\t\t\t\tstorageService.store(SESSION_COUNT_KEY, sessionCount - 3, StorageScope.APPLICATION, StorageTarget.USER);\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\tlabel: localize('neverAgain', \"Don't Show Again\"),\n\t\t\t\tisSecondary: true,\n\t\t\t\trun: () => {\n\t\t\t\t\ttelemetryService.publicLog(`${data.surveyId}.survey/dontShowAgain`);\n\t\t\t\t\tstorageService.store(IS_CANDIDATE_KEY, false, StorageScope.APPLICATION, StorageTarget.USER);\n\t\t\t\t\tstorageService.store(SKIP_VERSION_KEY, productService.version, StorageScope.APPLICATION, StorageTarget.USER);\n\t\t\t\t}\n\t\t\t}],\n\t\t\t{ priority: NotificationPriority.OPTIONAL }\n\t\t);\n\t}\n}\n\nclass LanguageSurveysContribution implements IWorkbenchContribution {\n\n\tconstructor(\n\t\t@IStorageService private readonly storageService: IStorageService,\n\t\t@INotificationService private readonly notificationService: INotificationService,\n\t\t@ITelemetryService private readonly telemetryService: ITelemetryService,\n\t\t@ITextFileService private readonly textFileService: ITextFileService,\n\t\t@IOpenerService private readonly openerService: IOpenerService,\n\t\t@IProductService private readonly productService: IProductService,\n\t\t@ILanguageService private readonly languageService: ILanguageService,\n\t\t@IExtensionService private readonly extensionService: IExtensionService\n\t) {\n\t\tthis.handleSurveys();\n\t}\n\n\tprivate async handleSurveys() {\n\t\tif (!this.productService.surveys) {\n\t\t\treturn;\n\t\t}\n\n\t\t// Make sure to wait for installed extensions\n\t\t// being registered to show notifications\n\t\t// properly (https://github.com/microsoft/vscode/issues/121216)\n\t\tawait this.extensionService.whenInstalledExtensionsRegistered();\n\n\t\t// Handle surveys\n\t\tthis.productService.surveys\n\t\t\t.filter(surveyData => surveyData.surveyId && surveyData.editCount && surveyData.languageId && surveyData.surveyUrl && surveyData.userProbability)\n\t\t\t.map(surveyData => new LanguageSurvey(surveyData, this.storageService, this.notificationService, this.telemetryService, this.languageService, this.textFileService, this.openerService, this.productService));\n\t}\n}\n\nif (language === 'en') {\n\tconst workbenchRegistry = Registry.as<IWorkbenchContributionsRegistry>(WorkbenchExtensions.Workbench);\n\tworkbenchRegistry.registerWorkbenchContribution(LanguageSurveysContribution, LifecyclePhase.Restored);\n}\n"]}