{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/contrib/comments/browser/commentsAccessibleView.ts","vs/workbench/contrib/comments/browser/commentsAccessibleView.ts"],"names":[],"mappings":"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","file":"commentsAccessibleView.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Disposable } from '../../../../base/common/lifecycle.js';\nimport { MarshalledId } from '../../../../base/common/marshallingIds.js';\nimport { ServicesAccessor } from '../../../../editor/browser/editorExtensions.js';\nimport { AccessibleViewProviderId, AccessibleViewType, IAccessibleViewContentProvider } from '../../../../platform/accessibility/browser/accessibleView.js';\nimport { IAccessibleViewImplementation } from '../../../../platform/accessibility/browser/accessibleViewRegistry.js';\nimport { IMenuService } from '../../../../platform/actions/common/actions.js';\nimport { IContextKeyService } from '../../../../platform/contextkey/common/contextkey.js';\nimport { AccessibilityVerbositySettingId } from '../../accessibility/browser/accessibilityConfiguration.js';\nimport { COMMENTS_VIEW_ID, CommentsMenus } from './commentsTreeViewer.js';\nimport { CommentsPanel, CONTEXT_KEY_COMMENT_FOCUSED } from './commentsView.js';\nimport { IViewsService } from '../../../services/views/common/viewsService.js';\nimport { ICommentService } from './commentService.js';\nimport { CommentContextKeys } from '../common/commentContextKeys.js';\nimport { moveToNextCommentInThread as findNextCommentInThread, revealCommentThread } from './commentsController.js';\nimport { IEditorService } from '../../../services/editor/common/editorService.js';\nimport { IUriIdentityService } from '../../../../platform/uriIdentity/common/uriIdentity.js';\nimport { isCodeEditor } from '../../../../editor/browser/editorBrowser.js';\nimport { URI } from '../../../../base/common/uri.js';\nimport { CommentThread, Comment } from '../../../../editor/common/languages.js';\nimport { IRange } from '../../../../editor/common/core/range.js';\nimport { IAction } from '../../../../base/common/actions.js';\n\nexport class CommentsAccessibleView extends Disposable implements IAccessibleViewImplementation {\n\treadonly priority = 90;\n\treadonly name = 'comment';\n\treadonly when = CONTEXT_KEY_COMMENT_FOCUSED;\n\treadonly type = AccessibleViewType.View;\n\tgetProvider(accessor: ServicesAccessor) {\n\t\tconst contextKeyService = accessor.get(IContextKeyService);\n\t\tconst viewsService = accessor.get(IViewsService);\n\t\tconst menuService = accessor.get(IMenuService);\n\t\tconst commentsView = viewsService.getActiveViewWithId<CommentsPanel>(COMMENTS_VIEW_ID);\n\t\tconst focusedCommentNode = commentsView?.focusedCommentNode;\n\n\t\tif (!commentsView || !focusedCommentNode) {\n\t\t\treturn;\n\t\t}\n\t\tconst menus = this._register(new CommentsMenus(menuService));\n\t\tmenus.setContextKeyService(contextKeyService);\n\n\t\treturn new CommentsAccessibleContentProvider(commentsView, focusedCommentNode, menus);\n\t}\n\tconstructor() {\n\t\tsuper();\n\t}\n}\n\n\nexport class CommentThreadAccessibleView extends Disposable implements IAccessibleViewImplementation {\n\treadonly priority = 85;\n\treadonly name = 'commentThread';\n\treadonly when = CommentContextKeys.commentFocused;\n\treadonly type = AccessibleViewType.View;\n\tgetProvider(accessor: ServicesAccessor) {\n\t\tconst commentService = accessor.get(ICommentService);\n\t\tconst editorService = accessor.get(IEditorService);\n\t\tconst uriIdentityService = accessor.get(IUriIdentityService);\n\t\tconst threads = commentService.commentsModel.hasCommentThreads();\n\t\tif (!threads) {\n\t\t\treturn;\n\t\t}\n\t\treturn new CommentsThreadWidgetAccessibleContentProvider(commentService, editorService, uriIdentityService);\n\t}\n\tconstructor() {\n\t\tsuper();\n\t}\n}\n\n\nclass CommentsAccessibleContentProvider extends Disposable implements IAccessibleViewContentProvider {\n\tpublic readonly actions: IAction[];\n\tconstructor(\n\t\tprivate readonly _commentsView: CommentsPanel,\n\t\tprivate readonly _focusedCommentNode: any,\n\t\tprivate readonly _menus: CommentsMenus,\n\t) {\n\t\tsuper();\n\n\t\tthis.actions = [...this._menus.getResourceContextActions(this._focusedCommentNode)].filter(i => i.enabled).map(action => {\n\t\t\treturn {\n\t\t\t\t...action,\n\t\t\t\trun: () => {\n\t\t\t\t\tthis._commentsView.focus();\n\t\t\t\t\taction.run({\n\t\t\t\t\t\tthread: this._focusedCommentNode.thread,\n\t\t\t\t\t\t$mid: MarshalledId.CommentThread,\n\t\t\t\t\t\tcommentControlHandle: this._focusedCommentNode.controllerHandle,\n\t\t\t\t\t\tcommentThreadHandle: this._focusedCommentNode.threadHandle,\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t};\n\t\t});\n\t}\n\treadonly id = AccessibleViewProviderId.Comments;\n\treadonly verbositySettingKey = AccessibilityVerbositySettingId.Comments;\n\treadonly options = { type: AccessibleViewType.View };\n\n\tprovideContent(): string {\n\t\tconst commentNode = this._commentsView.focusedCommentNode;\n\t\tconst content = this._commentsView.focusedCommentInfo?.toString();\n\t\tif (!commentNode || !content) {\n\t\t\tthrow new Error('Comment tree is focused but no comment is selected');\n\t\t}\n\t\treturn content;\n\t}\n\tonClose(): void {\n\t\tthis._commentsView.focus();\n\t}\n\tprovideNextContent(): string | undefined {\n\t\tthis._commentsView.focusNextNode();\n\t\treturn this.provideContent();\n\t}\n\tprovidePreviousContent(): string | undefined {\n\t\tthis._commentsView.focusPreviousNode();\n\t\treturn this.provideContent();\n\t}\n}\n\nclass CommentsThreadWidgetAccessibleContentProvider extends Disposable implements IAccessibleViewContentProvider {\n\treadonly id = AccessibleViewProviderId.CommentThread;\n\treadonly verbositySettingKey = AccessibilityVerbositySettingId.Comments;\n\treadonly options = { type: AccessibleViewType.View };\n\tprivate _activeCommentInfo: { thread: CommentThread<IRange>; comment?: Comment } | undefined;\n\tconstructor(@ICommentService private readonly _commentService: ICommentService,\n\t\t@IEditorService private readonly _editorService: IEditorService,\n\t\t@IUriIdentityService private readonly _uriIdentityService: IUriIdentityService,\n\t) {\n\t\tsuper();\n\t}\n\n\tprivate get activeCommentInfo(): { thread: CommentThread<IRange>; comment?: Comment } | undefined {\n\t\tif (!this._activeCommentInfo && this._commentService.lastActiveCommentcontroller) {\n\t\t\tthis._activeCommentInfo = this._commentService.lastActiveCommentcontroller.activeComment;\n\t\t}\n\t\treturn this._activeCommentInfo;\n\t}\n\n\tprovideContent(): string {\n\t\tif (!this.activeCommentInfo) {\n\t\t\tthrow new Error('No current comment thread');\n\t\t}\n\t\tconst comment = this.activeCommentInfo.comment?.body;\n\t\tconst commentLabel = typeof comment === 'string' ? comment : comment?.value ?? '';\n\t\tconst resource = this.activeCommentInfo.thread.resource;\n\t\tconst range = this.activeCommentInfo.thread.range;\n\t\tlet contentLabel = '';\n\t\tif (resource && range) {\n\t\t\tconst editor = this._editorService.findEditors(URI.parse(resource)) || [];\n\t\t\tconst codeEditor = this._editorService.activeEditorPane?.getControl();\n\t\t\tif (editor?.length && isCodeEditor(codeEditor)) {\n\t\t\t\tconst content = codeEditor.getModel()?.getValueInRange(range);\n\t\t\t\tif (content) {\n\t\t\t\t\tcontentLabel = '\\nCorresponding code: \\n' + content;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn commentLabel + contentLabel;\n\t}\n\tonClose(): void {\n\t\tconst lastComment = this._activeCommentInfo;\n\t\tthis._activeCommentInfo = undefined;\n\t\tif (lastComment) {\n\t\t\trevealCommentThread(this._commentService, this._editorService, this._uriIdentityService, lastComment.thread, lastComment.comment);\n\t\t}\n\t}\n\tprovideNextContent(): string | undefined {\n\t\tconst newCommentInfo = findNextCommentInThread(this._activeCommentInfo, 'next');\n\t\tif (newCommentInfo) {\n\t\t\tthis._activeCommentInfo = newCommentInfo;\n\t\t\treturn this.provideContent();\n\t\t}\n\t\treturn undefined;\n\t}\n\tprovidePreviousContent(): string | undefined {\n\t\tconst newCommentInfo = findNextCommentInThread(this._activeCommentInfo, 'previous');\n\t\tif (newCommentInfo) {\n\t\t\tthis._activeCommentInfo = newCommentInfo;\n\t\t\treturn this.provideContent();\n\t\t}\n\t\treturn undefined;\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Disposable } from '../../../../base/common/lifecycle.js';\nimport { MarshalledId } from '../../../../base/common/marshallingIds.js';\nimport { ServicesAccessor } from '../../../../editor/browser/editorExtensions.js';\nimport { AccessibleViewProviderId, AccessibleViewType, IAccessibleViewContentProvider } from '../../../../platform/accessibility/browser/accessibleView.js';\nimport { IAccessibleViewImplementation } from '../../../../platform/accessibility/browser/accessibleViewRegistry.js';\nimport { IMenuService } from '../../../../platform/actions/common/actions.js';\nimport { IContextKeyService } from '../../../../platform/contextkey/common/contextkey.js';\nimport { AccessibilityVerbositySettingId } from '../../accessibility/browser/accessibilityConfiguration.js';\nimport { COMMENTS_VIEW_ID, CommentsMenus } from './commentsTreeViewer.js';\nimport { CommentsPanel, CONTEXT_KEY_COMMENT_FOCUSED } from './commentsView.js';\nimport { IViewsService } from '../../../services/views/common/viewsService.js';\nimport { ICommentService } from './commentService.js';\nimport { CommentContextKeys } from '../common/commentContextKeys.js';\nimport { moveToNextCommentInThread as findNextCommentInThread, revealCommentThread } from './commentsController.js';\nimport { IEditorService } from '../../../services/editor/common/editorService.js';\nimport { IUriIdentityService } from '../../../../platform/uriIdentity/common/uriIdentity.js';\nimport { isCodeEditor } from '../../../../editor/browser/editorBrowser.js';\nimport { URI } from '../../../../base/common/uri.js';\nimport { CommentThread, Comment } from '../../../../editor/common/languages.js';\nimport { IRange } from '../../../../editor/common/core/range.js';\nimport { IAction } from '../../../../base/common/actions.js';\n\nexport class CommentsAccessibleView extends Disposable implements IAccessibleViewImplementation {\n\treadonly priority = 90;\n\treadonly name = 'comment';\n\treadonly when = CONTEXT_KEY_COMMENT_FOCUSED;\n\treadonly type = AccessibleViewType.View;\n\tgetProvider(accessor: ServicesAccessor) {\n\t\tconst contextKeyService = accessor.get(IContextKeyService);\n\t\tconst viewsService = accessor.get(IViewsService);\n\t\tconst menuService = accessor.get(IMenuService);\n\t\tconst commentsView = viewsService.getActiveViewWithId<CommentsPanel>(COMMENTS_VIEW_ID);\n\t\tconst focusedCommentNode = commentsView?.focusedCommentNode;\n\n\t\tif (!commentsView || !focusedCommentNode) {\n\t\t\treturn;\n\t\t}\n\t\tconst menus = this._register(new CommentsMenus(menuService));\n\t\tmenus.setContextKeyService(contextKeyService);\n\n\t\treturn new CommentsAccessibleContentProvider(commentsView, focusedCommentNode, menus);\n\t}\n\tconstructor() {\n\t\tsuper();\n\t}\n}\n\n\nexport class CommentThreadAccessibleView extends Disposable implements IAccessibleViewImplementation {\n\treadonly priority = 85;\n\treadonly name = 'commentThread';\n\treadonly when = CommentContextKeys.commentFocused;\n\treadonly type = AccessibleViewType.View;\n\tgetProvider(accessor: ServicesAccessor) {\n\t\tconst commentService = accessor.get(ICommentService);\n\t\tconst editorService = accessor.get(IEditorService);\n\t\tconst uriIdentityService = accessor.get(IUriIdentityService);\n\t\tconst threads = commentService.commentsModel.hasCommentThreads();\n\t\tif (!threads) {\n\t\t\treturn;\n\t\t}\n\t\treturn new CommentsThreadWidgetAccessibleContentProvider(commentService, editorService, uriIdentityService);\n\t}\n\tconstructor() {\n\t\tsuper();\n\t}\n}\n\n\nclass CommentsAccessibleContentProvider extends Disposable implements IAccessibleViewContentProvider {\n\tpublic readonly actions: IAction[];\n\tconstructor(\n\t\tprivate readonly _commentsView: CommentsPanel,\n\t\tprivate readonly _focusedCommentNode: any,\n\t\tprivate readonly _menus: CommentsMenus,\n\t) {\n\t\tsuper();\n\n\t\tthis.actions = [...this._menus.getResourceContextActions(this._focusedCommentNode)].filter(i => i.enabled).map(action => {\n\t\t\treturn {\n\t\t\t\t...action,\n\t\t\t\trun: () => {\n\t\t\t\t\tthis._commentsView.focus();\n\t\t\t\t\taction.run({\n\t\t\t\t\t\tthread: this._focusedCommentNode.thread,\n\t\t\t\t\t\t$mid: MarshalledId.CommentThread,\n\t\t\t\t\t\tcommentControlHandle: this._focusedCommentNode.controllerHandle,\n\t\t\t\t\t\tcommentThreadHandle: this._focusedCommentNode.threadHandle,\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t};\n\t\t});\n\t}\n\treadonly id = AccessibleViewProviderId.Comments;\n\treadonly verbositySettingKey = AccessibilityVerbositySettingId.Comments;\n\treadonly options = { type: AccessibleViewType.View };\n\n\tprovideContent(): string {\n\t\tconst commentNode = this._commentsView.focusedCommentNode;\n\t\tconst content = this._commentsView.focusedCommentInfo?.toString();\n\t\tif (!commentNode || !content) {\n\t\t\tthrow new Error('Comment tree is focused but no comment is selected');\n\t\t}\n\t\treturn content;\n\t}\n\tonClose(): void {\n\t\tthis._commentsView.focus();\n\t}\n\tprovideNextContent(): string | undefined {\n\t\tthis._commentsView.focusNextNode();\n\t\treturn this.provideContent();\n\t}\n\tprovidePreviousContent(): string | undefined {\n\t\tthis._commentsView.focusPreviousNode();\n\t\treturn this.provideContent();\n\t}\n}\n\nclass CommentsThreadWidgetAccessibleContentProvider extends Disposable implements IAccessibleViewContentProvider {\n\treadonly id = AccessibleViewProviderId.CommentThread;\n\treadonly verbositySettingKey = AccessibilityVerbositySettingId.Comments;\n\treadonly options = { type: AccessibleViewType.View };\n\tprivate _activeCommentInfo: { thread: CommentThread<IRange>; comment?: Comment } | undefined;\n\tconstructor(@ICommentService private readonly _commentService: ICommentService,\n\t\t@IEditorService private readonly _editorService: IEditorService,\n\t\t@IUriIdentityService private readonly _uriIdentityService: IUriIdentityService,\n\t) {\n\t\tsuper();\n\t}\n\n\tprivate get activeCommentInfo(): { thread: CommentThread<IRange>; comment?: Comment } | undefined {\n\t\tif (!this._activeCommentInfo && this._commentService.lastActiveCommentcontroller) {\n\t\t\tthis._activeCommentInfo = this._commentService.lastActiveCommentcontroller.activeComment;\n\t\t}\n\t\treturn this._activeCommentInfo;\n\t}\n\n\tprovideContent(): string {\n\t\tif (!this.activeCommentInfo) {\n\t\t\tthrow new Error('No current comment thread');\n\t\t}\n\t\tconst comment = this.activeCommentInfo.comment?.body;\n\t\tconst commentLabel = typeof comment === 'string' ? comment : comment?.value ?? '';\n\t\tconst resource = this.activeCommentInfo.thread.resource;\n\t\tconst range = this.activeCommentInfo.thread.range;\n\t\tlet contentLabel = '';\n\t\tif (resource && range) {\n\t\t\tconst editor = this._editorService.findEditors(URI.parse(resource)) || [];\n\t\t\tconst codeEditor = this._editorService.activeEditorPane?.getControl();\n\t\t\tif (editor?.length && isCodeEditor(codeEditor)) {\n\t\t\t\tconst content = codeEditor.getModel()?.getValueInRange(range);\n\t\t\t\tif (content) {\n\t\t\t\t\tcontentLabel = '\\nCorresponding code: \\n' + content;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn commentLabel + contentLabel;\n\t}\n\tonClose(): void {\n\t\tconst lastComment = this._activeCommentInfo;\n\t\tthis._activeCommentInfo = undefined;\n\t\tif (lastComment) {\n\t\t\trevealCommentThread(this._commentService, this._editorService, this._uriIdentityService, lastComment.thread, lastComment.comment);\n\t\t}\n\t}\n\tprovideNextContent(): string | undefined {\n\t\tconst newCommentInfo = findNextCommentInThread(this._activeCommentInfo, 'next');\n\t\tif (newCommentInfo) {\n\t\t\tthis._activeCommentInfo = newCommentInfo;\n\t\t\treturn this.provideContent();\n\t\t}\n\t\treturn undefined;\n\t}\n\tprovidePreviousContent(): string | undefined {\n\t\tconst newCommentInfo = findNextCommentInThread(this._activeCommentInfo, 'previous');\n\t\tif (newCommentInfo) {\n\t\t\tthis._activeCommentInfo = newCommentInfo;\n\t\t\treturn this.provideContent();\n\t\t}\n\t\treturn undefined;\n\t}\n}\n"]}