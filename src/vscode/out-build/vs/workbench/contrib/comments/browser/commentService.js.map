{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/contrib/comments/browser/commentService.ts","vs/workbench/contrib/comments/browser/commentService.ts"],"names":[],"mappings":"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","file":"commentService.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { CommentThreadChangedEvent, CommentInfo, Comment, CommentReaction, CommentingRanges, CommentThread, CommentOptions, PendingCommentThread, CommentingRangeResourceHint } from '../../../../editor/common/languages.js';\nimport { createDecorator, IInstantiationService } from '../../../../platform/instantiation/common/instantiation.js';\nimport { Event, Emitter } from '../../../../base/common/event.js';\nimport { Disposable, DisposableStore, IDisposable } from '../../../../base/common/lifecycle.js';\nimport { URI, UriComponents } from '../../../../base/common/uri.js';\nimport { Range, IRange } from '../../../../editor/common/core/range.js';\nimport { CancellationToken } from '../../../../base/common/cancellation.js';\nimport { ICommentThreadChangedEvent } from '../common/commentModel.js';\nimport { CommentMenus } from './commentMenus.js';\nimport { ICellRange } from '../../notebook/common/notebookRange.js';\nimport { IWorkbenchLayoutService } from '../../../services/layout/browser/layoutService.js';\nimport { IConfigurationService } from '../../../../platform/configuration/common/configuration.js';\nimport { COMMENTS_SECTION, ICommentsConfiguration } from '../common/commentsConfiguration.js';\nimport { IContextKey, IContextKeyService } from '../../../../platform/contextkey/common/contextkey.js';\nimport { IStorageService, StorageScope, StorageTarget } from '../../../../platform/storage/common/storage.js';\nimport { CommentContextKeys } from '../common/commentContextKeys.js';\nimport { ILogService } from '../../../../platform/log/common/log.js';\nimport { CommentsModel, ICommentsModel } from './commentsModel.js';\nimport { IModelService } from '../../../../editor/common/services/model.js';\nimport { Schemas } from '../../../../base/common/network.js';\n\nexport const ICommentService = createDecorator<ICommentService>('commentService');\n\ninterface IResourceCommentThreadEvent {\n\tresource: URI;\n\tcommentInfos: ICommentInfo[];\n}\n\nexport interface ICommentInfo<T = IRange> extends CommentInfo<T> {\n\tuniqueOwner: string;\n\tlabel?: string;\n}\n\nexport interface INotebookCommentInfo {\n\textensionId?: string;\n\tthreads: CommentThread<ICellRange>[];\n\tuniqueOwner: string;\n\tlabel?: string;\n}\n\nexport interface IWorkspaceCommentThreadsEvent {\n\townerId: string;\n\townerLabel: string;\n\tcommentThreads: CommentThread[];\n}\n\nexport interface INotebookCommentThreadChangedEvent extends CommentThreadChangedEvent<ICellRange> {\n\tuniqueOwner: string;\n}\n\nexport interface ICommentController {\n\tid: string;\n\tlabel: string;\n\tfeatures: {\n\t\treactionGroup?: CommentReaction[];\n\t\treactionHandler?: boolean;\n\t\toptions?: CommentOptions;\n\t};\n\toptions?: CommentOptions;\n\tcontextValue?: string;\n\towner: string;\n\tactiveComment: { thread: CommentThread; comment?: Comment } | undefined;\n\tcreateCommentThreadTemplate(resource: UriComponents, range: IRange | undefined, editorId?: string): Promise<void>;\n\tupdateCommentThreadTemplate(threadHandle: number, range: IRange): Promise<void>;\n\tdeleteCommentThreadMain(commentThreadId: string): void;\n\ttoggleReaction(uri: URI, thread: CommentThread, comment: Comment, reaction: CommentReaction, token: CancellationToken): Promise<void>;\n\tgetDocumentComments(resource: URI, token: CancellationToken): Promise<ICommentInfo<IRange>>;\n\tgetNotebookComments(resource: URI, token: CancellationToken): Promise<INotebookCommentInfo>;\n\tsetActiveCommentAndThread(commentInfo: { thread: CommentThread; comment?: Comment } | undefined): Promise<void>;\n}\n\nexport interface IContinueOnCommentProvider {\n\tprovideContinueOnComments(): PendingCommentThread[];\n}\n\nexport interface ICommentService {\n\treadonly _serviceBrand: undefined;\n\treadonly onDidSetResourceCommentInfos: Event<IResourceCommentThreadEvent>;\n\treadonly onDidSetAllCommentThreads: Event<IWorkspaceCommentThreadsEvent>;\n\treadonly onDidUpdateCommentThreads: Event<ICommentThreadChangedEvent>;\n\treadonly onDidUpdateNotebookCommentThreads: Event<INotebookCommentThreadChangedEvent>;\n\treadonly onDidChangeActiveEditingCommentThread: Event<CommentThread | null>;\n\treadonly onDidChangeCurrentCommentThread: Event<CommentThread | undefined>;\n\treadonly onDidUpdateCommentingRanges: Event<{ uniqueOwner: string }>;\n\treadonly onDidChangeActiveCommentingRange: Event<{ range: Range; commentingRangesInfo: CommentingRanges }>;\n\treadonly onDidSetDataProvider: Event<void>;\n\treadonly onDidDeleteDataProvider: Event<string | undefined>;\n\treadonly onDidChangeCommentingEnabled: Event<boolean>;\n\treadonly onResourceHasCommentingRanges: Event<void>;\n\treadonly isCommentingEnabled: boolean;\n\treadonly commentsModel: ICommentsModel;\n\treadonly lastActiveCommentcontroller: ICommentController | undefined;\n\tsetDocumentComments(resource: URI, commentInfos: ICommentInfo[]): void;\n\tsetWorkspaceComments(uniqueOwner: string, commentsByResource: CommentThread<IRange | ICellRange>[]): void;\n\tremoveWorkspaceComments(uniqueOwner: string): void;\n\tregisterCommentController(uniqueOwner: string, commentControl: ICommentController): void;\n\tunregisterCommentController(uniqueOwner?: string): void;\n\tgetCommentController(uniqueOwner: string): ICommentController | undefined;\n\tcreateCommentThreadTemplate(uniqueOwner: string, resource: URI, range: Range | undefined, editorId?: string): Promise<void>;\n\tupdateCommentThreadTemplate(uniqueOwner: string, threadHandle: number, range: Range): Promise<void>;\n\tgetCommentMenus(uniqueOwner: string): CommentMenus;\n\tupdateComments(ownerId: string, event: CommentThreadChangedEvent<IRange>): void;\n\tupdateNotebookComments(ownerId: string, event: CommentThreadChangedEvent<ICellRange>): void;\n\tdisposeCommentThread(ownerId: string, threadId: string): void;\n\tgetDocumentComments(resource: URI): Promise<(ICommentInfo | null)[]>;\n\tgetNotebookComments(resource: URI): Promise<(INotebookCommentInfo | null)[]>;\n\tupdateCommentingRanges(ownerId: string, resourceHints?: CommentingRangeResourceHint): void;\n\thasReactionHandler(uniqueOwner: string): boolean;\n\ttoggleReaction(uniqueOwner: string, resource: URI, thread: CommentThread<IRange | ICellRange>, comment: Comment, reaction: CommentReaction): Promise<void>;\n\tsetActiveEditingCommentThread(commentThread: CommentThread<IRange | ICellRange> | null): void;\n\tsetCurrentCommentThread(commentThread: CommentThread<IRange | ICellRange> | undefined): void;\n\tsetActiveCommentAndThread(uniqueOwner: string, commentInfo: { thread: CommentThread<IRange | ICellRange>; comment?: Comment } | undefined): Promise<void>;\n\tenableCommenting(enable: boolean): void;\n\tregisterContinueOnCommentProvider(provider: IContinueOnCommentProvider): IDisposable;\n\tremoveContinueOnComment(pendingComment: { range: IRange | undefined; uri: URI; uniqueOwner: string; isReply?: boolean }): PendingCommentThread | undefined;\n\tresourceHasCommentingRanges(resource: URI): boolean;\n}\n\nconst CONTINUE_ON_COMMENTS = 'comments.continueOnComments';\n\nexport class CommentService extends Disposable implements ICommentService {\n\tdeclare readonly _serviceBrand: undefined;\n\n\tprivate readonly _onDidSetDataProvider: Emitter<void> = this._register(new Emitter<void>());\n\treadonly onDidSetDataProvider: Event<void> = this._onDidSetDataProvider.event;\n\n\tprivate readonly _onDidDeleteDataProvider: Emitter<string | undefined> = this._register(new Emitter<string | undefined>());\n\treadonly onDidDeleteDataProvider: Event<string | undefined> = this._onDidDeleteDataProvider.event;\n\n\tprivate readonly _onDidSetResourceCommentInfos: Emitter<IResourceCommentThreadEvent> = this._register(new Emitter<IResourceCommentThreadEvent>());\n\treadonly onDidSetResourceCommentInfos: Event<IResourceCommentThreadEvent> = this._onDidSetResourceCommentInfos.event;\n\n\tprivate readonly _onDidSetAllCommentThreads: Emitter<IWorkspaceCommentThreadsEvent> = this._register(new Emitter<IWorkspaceCommentThreadsEvent>());\n\treadonly onDidSetAllCommentThreads: Event<IWorkspaceCommentThreadsEvent> = this._onDidSetAllCommentThreads.event;\n\n\tprivate readonly _onDidUpdateCommentThreads: Emitter<ICommentThreadChangedEvent> = this._register(new Emitter<ICommentThreadChangedEvent>());\n\treadonly onDidUpdateCommentThreads: Event<ICommentThreadChangedEvent> = this._onDidUpdateCommentThreads.event;\n\n\tprivate readonly _onDidUpdateNotebookCommentThreads: Emitter<INotebookCommentThreadChangedEvent> = this._register(new Emitter<INotebookCommentThreadChangedEvent>());\n\treadonly onDidUpdateNotebookCommentThreads: Event<INotebookCommentThreadChangedEvent> = this._onDidUpdateNotebookCommentThreads.event;\n\n\tprivate readonly _onDidUpdateCommentingRanges: Emitter<{ uniqueOwner: string }> = this._register(new Emitter<{ uniqueOwner: string }>());\n\treadonly onDidUpdateCommentingRanges: Event<{ uniqueOwner: string }> = this._onDidUpdateCommentingRanges.event;\n\n\tprivate readonly _onDidChangeActiveEditingCommentThread = this._register(new Emitter<CommentThread | null>());\n\treadonly onDidChangeActiveEditingCommentThread = this._onDidChangeActiveEditingCommentThread.event;\n\n\tprivate readonly _onDidChangeCurrentCommentThread = this._register(new Emitter<CommentThread | undefined>());\n\treadonly onDidChangeCurrentCommentThread = this._onDidChangeCurrentCommentThread.event;\n\n\tprivate readonly _onDidChangeCommentingEnabled = this._register(new Emitter<boolean>());\n\treadonly onDidChangeCommentingEnabled = this._onDidChangeCommentingEnabled.event;\n\n\tprivate readonly _onResourceHasCommentingRanges = this._register(new Emitter<void>());\n\treadonly onResourceHasCommentingRanges = this._onResourceHasCommentingRanges.event;\n\n\tprivate readonly _onDidChangeActiveCommentingRange: Emitter<{\n\t\trange: Range; commentingRangesInfo:\n\t\tCommentingRanges;\n\t}> = this._register(new Emitter<{\n\t\trange: Range; commentingRangesInfo:\n\t\tCommentingRanges;\n\t}>());\n\treadonly onDidChangeActiveCommentingRange: Event<{ range: Range; commentingRangesInfo: CommentingRanges }> = this._onDidChangeActiveCommentingRange.event;\n\n\tprivate _commentControls = new Map<string, ICommentController>();\n\tprivate _commentMenus = new Map<string, CommentMenus>();\n\tprivate _isCommentingEnabled: boolean = true;\n\tprivate _workspaceHasCommenting: IContextKey<boolean>;\n\tprivate _commentingEnabled: IContextKey<boolean>;\n\n\tprivate _continueOnComments = new Map<string, PendingCommentThread[]>(); // uniqueOwner -> PendingCommentThread[]\n\tprivate _continueOnCommentProviders = new Set<IContinueOnCommentProvider>();\n\n\tprivate readonly _commentsModel: CommentsModel = this._register(new CommentsModel());\n\tpublic readonly commentsModel: ICommentsModel = this._commentsModel;\n\n\tprivate _commentingRangeResources = new Set<string>(); // URIs\n\tprivate _commentingRangeResourceHintSchemes = new Set<string>(); // schemes\n\n\tconstructor(\n\t\t@IInstantiationService protected readonly instantiationService: IInstantiationService,\n\t\t@IWorkbenchLayoutService private readonly layoutService: IWorkbenchLayoutService,\n\t\t@IConfigurationService private readonly configurationService: IConfigurationService,\n\t\t@IContextKeyService contextKeyService: IContextKeyService,\n\t\t@IStorageService private readonly storageService: IStorageService,\n\t\t@ILogService private readonly logService: ILogService,\n\t\t@IModelService private readonly modelService: IModelService\n\t) {\n\t\tsuper();\n\t\tthis._handleConfiguration();\n\t\tthis._handleZenMode();\n\t\tthis._workspaceHasCommenting = CommentContextKeys.WorkspaceHasCommenting.bindTo(contextKeyService);\n\t\tthis._commentingEnabled = CommentContextKeys.commentingEnabled.bindTo(contextKeyService);\n\t\tconst storageListener = this._register(new DisposableStore());\n\n\t\tconst storageEvent = Event.debounce(this.storageService.onDidChangeValue(StorageScope.WORKSPACE, CONTINUE_ON_COMMENTS, storageListener), (last, event) => last?.external ? last : event, 500);\n\t\tstorageListener.add(storageEvent(v => {\n\t\t\tif (!v.external) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst commentsToRestore: PendingCommentThread[] | undefined = this.storageService.getObject(CONTINUE_ON_COMMENTS, StorageScope.WORKSPACE);\n\t\t\tif (!commentsToRestore) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis.logService.debug(`Comments: URIs of continue on comments from storage ${commentsToRestore.map(thread => thread.uri.toString()).join(', ')}.`);\n\t\t\tconst changedOwners = this._addContinueOnComments(commentsToRestore, this._continueOnComments);\n\t\t\tfor (const uniqueOwner of changedOwners) {\n\t\t\t\tconst control = this._commentControls.get(uniqueOwner);\n\t\t\t\tif (!control) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tconst evt: ICommentThreadChangedEvent = {\n\t\t\t\t\tuniqueOwner: uniqueOwner,\n\t\t\t\t\towner: control.owner,\n\t\t\t\t\townerLabel: control.label,\n\t\t\t\t\tpending: this._continueOnComments.get(uniqueOwner) || [],\n\t\t\t\t\tadded: [],\n\t\t\t\t\tremoved: [],\n\t\t\t\t\tchanged: []\n\t\t\t\t};\n\t\t\t\tthis.updateModelThreads(evt);\n\t\t\t}\n\t\t}));\n\t\tthis._register(storageService.onWillSaveState(() => {\n\t\t\tconst map: Map<string, PendingCommentThread[]> = new Map();\n\t\t\tfor (const provider of this._continueOnCommentProviders) {\n\t\t\t\tconst pendingComments = provider.provideContinueOnComments();\n\t\t\t\tthis._addContinueOnComments(pendingComments, map);\n\t\t\t}\n\t\t\tthis._saveContinueOnComments(map);\n\t\t}));\n\n\t\tthis._register(this.modelService.onModelAdded(model => {\n\t\t\t// Excluded schemes\n\t\t\tif ((model.uri.scheme === Schemas.vscodeSourceControl)) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t// Allows comment providers to cause their commenting ranges to be prefetched by opening text documents in the background.\n\t\t\tif (!this._commentingRangeResources.has(model.uri.toString())) {\n\t\t\t\tthis.getDocumentComments(model.uri);\n\t\t\t}\n\t\t}));\n\t}\n\n\tprivate _updateResourcesWithCommentingRanges(resource: URI, commentInfos: (ICommentInfo | null)[]) {\n\t\tlet addedResources = false;\n\t\tfor (const comments of commentInfos) {\n\t\t\tif (comments && (comments.commentingRanges.ranges.length > 0 || comments.threads.length > 0)) {\n\t\t\t\tthis._commentingRangeResources.add(resource.toString());\n\t\t\t\taddedResources = true;\n\t\t\t}\n\t\t}\n\t\tif (addedResources) {\n\t\t\tthis._onResourceHasCommentingRanges.fire();\n\t\t}\n\t}\n\n\tprivate _handleConfiguration() {\n\t\tthis._isCommentingEnabled = this._defaultCommentingEnablement;\n\t\tthis._register(this.configurationService.onDidChangeConfiguration(e => {\n\t\t\tif (e.affectsConfiguration('comments.visible')) {\n\t\t\t\tthis.enableCommenting(this._defaultCommentingEnablement);\n\t\t\t}\n\t\t}));\n\t}\n\n\tprivate _handleZenMode() {\n\t\tlet preZenModeValue: boolean = this._isCommentingEnabled;\n\t\tthis._register(this.layoutService.onDidChangeZenMode(e => {\n\t\t\tif (e) {\n\t\t\t\tpreZenModeValue = this._isCommentingEnabled;\n\t\t\t\tthis.enableCommenting(false);\n\t\t\t} else {\n\t\t\t\tthis.enableCommenting(preZenModeValue);\n\t\t\t}\n\t\t}));\n\t}\n\n\tprivate get _defaultCommentingEnablement(): boolean {\n\t\treturn !!this.configurationService.getValue<ICommentsConfiguration | undefined>(COMMENTS_SECTION)?.visible;\n\t}\n\n\tget isCommentingEnabled(): boolean {\n\t\treturn this._isCommentingEnabled;\n\t}\n\n\tenableCommenting(enable: boolean): void {\n\t\tif (enable !== this._isCommentingEnabled) {\n\t\t\tthis._isCommentingEnabled = enable;\n\t\t\tthis._commentingEnabled.set(enable);\n\t\t\tthis._onDidChangeCommentingEnabled.fire(enable);\n\t\t}\n\t}\n\n\t/**\n\t * The current comment thread is the thread that has focus or is being hovered.\n\t * @param commentThread\n\t */\n\tsetCurrentCommentThread(commentThread: CommentThread | undefined) {\n\t\tthis._onDidChangeCurrentCommentThread.fire(commentThread);\n\t}\n\n\t/**\n\t * The active comment thread is the thread that is currently being edited.\n\t * @param commentThread\n\t */\n\tsetActiveEditingCommentThread(commentThread: CommentThread | null) {\n\t\tthis._onDidChangeActiveEditingCommentThread.fire(commentThread);\n\t}\n\n\tget lastActiveCommentcontroller() {\n\t\treturn this._lastActiveCommentController;\n\t}\n\n\tprivate _lastActiveCommentController: ICommentController | undefined;\n\tasync setActiveCommentAndThread(uniqueOwner: string, commentInfo: { thread: CommentThread<IRange>; comment?: Comment } | undefined) {\n\t\tconst commentController = this._commentControls.get(uniqueOwner);\n\n\t\tif (!commentController) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (commentController !== this._lastActiveCommentController) {\n\t\t\tawait this._lastActiveCommentController?.setActiveCommentAndThread(undefined);\n\t\t}\n\t\tthis._lastActiveCommentController = commentController;\n\t\treturn commentController.setActiveCommentAndThread(commentInfo);\n\t}\n\n\tsetDocumentComments(resource: URI, commentInfos: ICommentInfo[]): void {\n\t\tthis._onDidSetResourceCommentInfos.fire({ resource, commentInfos });\n\t}\n\n\tprivate setModelThreads(ownerId: string, owner: string, ownerLabel: string, commentThreads: CommentThread<IRange>[]) {\n\t\tthis._commentsModel.setCommentThreads(ownerId, owner, ownerLabel, commentThreads);\n\t\tthis._onDidSetAllCommentThreads.fire({ ownerId, ownerLabel, commentThreads });\n\t}\n\n\tprivate updateModelThreads(event: ICommentThreadChangedEvent) {\n\t\tthis._commentsModel.updateCommentThreads(event);\n\t\tthis._onDidUpdateCommentThreads.fire(event);\n\t}\n\n\tsetWorkspaceComments(uniqueOwner: string, commentsByResource: CommentThread[]): void {\n\n\t\tif (commentsByResource.length) {\n\t\t\tthis._workspaceHasCommenting.set(true);\n\t\t}\n\t\tconst control = this._commentControls.get(uniqueOwner);\n\t\tif (control) {\n\t\t\tthis.setModelThreads(uniqueOwner, control.owner, control.label, commentsByResource);\n\t\t}\n\t}\n\n\tremoveWorkspaceComments(uniqueOwner: string): void {\n\t\tconst control = this._commentControls.get(uniqueOwner);\n\t\tif (control) {\n\t\t\tthis.setModelThreads(uniqueOwner, control.owner, control.label, []);\n\t\t}\n\t}\n\n\tregisterCommentController(uniqueOwner: string, commentControl: ICommentController): void {\n\t\tthis._commentControls.set(uniqueOwner, commentControl);\n\t\tthis._onDidSetDataProvider.fire();\n\t}\n\n\tunregisterCommentController(uniqueOwner?: string): void {\n\t\tif (uniqueOwner) {\n\t\t\tthis._commentControls.delete(uniqueOwner);\n\t\t} else {\n\t\t\tthis._commentControls.clear();\n\t\t}\n\t\tthis._commentsModel.deleteCommentsByOwner(uniqueOwner);\n\t\tthis._onDidDeleteDataProvider.fire(uniqueOwner);\n\t}\n\n\tgetCommentController(uniqueOwner: string): ICommentController | undefined {\n\t\treturn this._commentControls.get(uniqueOwner);\n\t}\n\n\tasync createCommentThreadTemplate(uniqueOwner: string, resource: URI, range: Range | undefined, editorId?: string): Promise<void> {\n\t\tconst commentController = this._commentControls.get(uniqueOwner);\n\n\t\tif (!commentController) {\n\t\t\treturn;\n\t\t}\n\n\t\treturn commentController.createCommentThreadTemplate(resource, range, editorId);\n\t}\n\n\tasync updateCommentThreadTemplate(uniqueOwner: string, threadHandle: number, range: Range) {\n\t\tconst commentController = this._commentControls.get(uniqueOwner);\n\n\t\tif (!commentController) {\n\t\t\treturn;\n\t\t}\n\n\t\tawait commentController.updateCommentThreadTemplate(threadHandle, range);\n\t}\n\n\tdisposeCommentThread(uniqueOwner: string, threadId: string) {\n\t\tconst controller = this.getCommentController(uniqueOwner);\n\t\tcontroller?.deleteCommentThreadMain(threadId);\n\t}\n\n\tgetCommentMenus(uniqueOwner: string): CommentMenus {\n\t\tif (this._commentMenus.get(uniqueOwner)) {\n\t\t\treturn this._commentMenus.get(uniqueOwner)!;\n\t\t}\n\n\t\tconst menu = this.instantiationService.createInstance(CommentMenus);\n\t\tthis._commentMenus.set(uniqueOwner, menu);\n\t\treturn menu;\n\t}\n\n\tupdateComments(ownerId: string, event: CommentThreadChangedEvent<IRange>): void {\n\t\tconst control = this._commentControls.get(ownerId);\n\t\tif (control) {\n\t\t\tconst evt: ICommentThreadChangedEvent = Object.assign({}, event, { uniqueOwner: ownerId, ownerLabel: control.label, owner: control.owner });\n\t\t\tthis.updateModelThreads(evt);\n\t\t}\n\t}\n\n\tupdateNotebookComments(ownerId: string, event: CommentThreadChangedEvent<ICellRange>): void {\n\t\tconst evt: INotebookCommentThreadChangedEvent = Object.assign({}, event, { uniqueOwner: ownerId });\n\t\tthis._onDidUpdateNotebookCommentThreads.fire(evt);\n\t}\n\n\tupdateCommentingRanges(ownerId: string, resourceHints?: CommentingRangeResourceHint) {\n\t\tif (resourceHints?.schemes && resourceHints.schemes.length > 0) {\n\t\t\tfor (const scheme of resourceHints.schemes) {\n\t\t\t\tthis._commentingRangeResourceHintSchemes.add(scheme);\n\t\t\t}\n\t\t}\n\t\tthis._workspaceHasCommenting.set(true);\n\t\tthis._onDidUpdateCommentingRanges.fire({ uniqueOwner: ownerId });\n\t}\n\n\tasync toggleReaction(uniqueOwner: string, resource: URI, thread: CommentThread, comment: Comment, reaction: CommentReaction): Promise<void> {\n\t\tconst commentController = this._commentControls.get(uniqueOwner);\n\n\t\tif (commentController) {\n\t\t\treturn commentController.toggleReaction(resource, thread, comment, reaction, CancellationToken.None);\n\t\t} else {\n\t\t\tthrow new Error('Not supported');\n\t\t}\n\t}\n\n\thasReactionHandler(uniqueOwner: string): boolean {\n\t\tconst commentProvider = this._commentControls.get(uniqueOwner);\n\n\t\tif (commentProvider) {\n\t\t\treturn !!commentProvider.features.reactionHandler;\n\t\t}\n\n\t\treturn false;\n\t}\n\n\tasync getDocumentComments(resource: URI): Promise<(ICommentInfo | null)[]> {\n\t\tconst commentControlResult: Promise<ICommentInfo | null>[] = [];\n\n\t\tfor (const control of this._commentControls.values()) {\n\t\t\tcommentControlResult.push(control.getDocumentComments(resource, CancellationToken.None)\n\t\t\t\t.then(documentComments => {\n\t\t\t\t\t// Check that there aren't any continue on comments in the provided comments\n\t\t\t\t\t// This can happen because continue on comments are stored separately from local un-submitted comments.\n\t\t\t\t\tfor (const documentCommentThread of documentComments.threads) {\n\t\t\t\t\t\tif (documentCommentThread.comments?.length === 0 && documentCommentThread.range) {\n\t\t\t\t\t\t\tthis.removeContinueOnComment({ range: documentCommentThread.range, uri: resource, uniqueOwner: documentComments.uniqueOwner });\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tconst pendingComments = this._continueOnComments.get(documentComments.uniqueOwner);\n\t\t\t\t\tdocumentComments.pendingCommentThreads = pendingComments?.filter(pendingComment => pendingComment.uri.toString() === resource.toString());\n\t\t\t\t\treturn documentComments;\n\t\t\t\t})\n\t\t\t\t.catch(_ => {\n\t\t\t\t\treturn null;\n\t\t\t\t}));\n\t\t}\n\n\t\tconst commentInfos = await Promise.all(commentControlResult);\n\t\tthis._updateResourcesWithCommentingRanges(resource, commentInfos);\n\t\treturn commentInfos;\n\t}\n\n\tasync getNotebookComments(resource: URI): Promise<(INotebookCommentInfo | null)[]> {\n\t\tconst commentControlResult: Promise<INotebookCommentInfo | null>[] = [];\n\n\t\tthis._commentControls.forEach(control => {\n\t\t\tcommentControlResult.push(control.getNotebookComments(resource, CancellationToken.None)\n\t\t\t\t.catch(_ => {\n\t\t\t\t\treturn null;\n\t\t\t\t}));\n\t\t});\n\n\t\treturn Promise.all(commentControlResult);\n\t}\n\n\tregisterContinueOnCommentProvider(provider: IContinueOnCommentProvider): IDisposable {\n\t\tthis._continueOnCommentProviders.add(provider);\n\t\treturn {\n\t\t\tdispose: () => {\n\t\t\t\tthis._continueOnCommentProviders.delete(provider);\n\t\t\t}\n\t\t};\n\t}\n\n\tprivate _saveContinueOnComments(map: Map<string, PendingCommentThread[]>) {\n\t\tconst commentsToSave: PendingCommentThread[] = [];\n\t\tfor (const pendingComments of map.values()) {\n\t\t\tcommentsToSave.push(...pendingComments);\n\t\t}\n\t\tthis.logService.debug(`Comments: URIs of continue on comments to add to storage ${commentsToSave.map(thread => thread.uri.toString()).join(', ')}.`);\n\t\tthis.storageService.store(CONTINUE_ON_COMMENTS, commentsToSave, StorageScope.WORKSPACE, StorageTarget.USER);\n\t}\n\n\tremoveContinueOnComment(pendingComment: { range: IRange; uri: URI; uniqueOwner: string; isReply?: boolean }): PendingCommentThread | undefined {\n\t\tconst pendingComments = this._continueOnComments.get(pendingComment.uniqueOwner);\n\t\tif (pendingComments) {\n\t\t\tconst commentIndex = pendingComments.findIndex(comment => comment.uri.toString() === pendingComment.uri.toString() && Range.equalsRange(comment.range, pendingComment.range) && (pendingComment.isReply === undefined || comment.isReply === pendingComment.isReply));\n\t\t\tif (commentIndex > -1) {\n\t\t\t\treturn pendingComments.splice(commentIndex, 1)[0];\n\t\t\t}\n\t\t}\n\t\treturn undefined;\n\t}\n\n\tprivate _addContinueOnComments(pendingComments: PendingCommentThread[], map: Map<string, PendingCommentThread[]>): Set<string> {\n\t\tconst changedOwners = new Set<string>();\n\t\tfor (const pendingComment of pendingComments) {\n\t\t\tif (!map.has(pendingComment.uniqueOwner)) {\n\t\t\t\tmap.set(pendingComment.uniqueOwner, [pendingComment]);\n\t\t\t\tchangedOwners.add(pendingComment.uniqueOwner);\n\t\t\t} else {\n\t\t\t\tconst commentsForOwner = map.get(pendingComment.uniqueOwner)!;\n\t\t\t\tif (commentsForOwner.every(comment => (comment.uri.toString() !== pendingComment.uri.toString()) || !Range.equalsRange(comment.range, pendingComment.range))) {\n\t\t\t\t\tcommentsForOwner.push(pendingComment);\n\t\t\t\t\tchangedOwners.add(pendingComment.uniqueOwner);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn changedOwners;\n\t}\n\n\tresourceHasCommentingRanges(resource: URI): boolean {\n\t\treturn this._commentingRangeResourceHintSchemes.has(resource.scheme) || this._commentingRangeResources.has(resource.toString());\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { CommentThreadChangedEvent, CommentInfo, Comment, CommentReaction, CommentingRanges, CommentThread, CommentOptions, PendingCommentThread, CommentingRangeResourceHint } from '../../../../editor/common/languages.js';\nimport { createDecorator, IInstantiationService } from '../../../../platform/instantiation/common/instantiation.js';\nimport { Event, Emitter } from '../../../../base/common/event.js';\nimport { Disposable, DisposableStore, IDisposable } from '../../../../base/common/lifecycle.js';\nimport { URI, UriComponents } from '../../../../base/common/uri.js';\nimport { Range, IRange } from '../../../../editor/common/core/range.js';\nimport { CancellationToken } from '../../../../base/common/cancellation.js';\nimport { ICommentThreadChangedEvent } from '../common/commentModel.js';\nimport { CommentMenus } from './commentMenus.js';\nimport { ICellRange } from '../../notebook/common/notebookRange.js';\nimport { IWorkbenchLayoutService } from '../../../services/layout/browser/layoutService.js';\nimport { IConfigurationService } from '../../../../platform/configuration/common/configuration.js';\nimport { COMMENTS_SECTION, ICommentsConfiguration } from '../common/commentsConfiguration.js';\nimport { IContextKey, IContextKeyService } from '../../../../platform/contextkey/common/contextkey.js';\nimport { IStorageService, StorageScope, StorageTarget } from '../../../../platform/storage/common/storage.js';\nimport { CommentContextKeys } from '../common/commentContextKeys.js';\nimport { ILogService } from '../../../../platform/log/common/log.js';\nimport { CommentsModel, ICommentsModel } from './commentsModel.js';\nimport { IModelService } from '../../../../editor/common/services/model.js';\nimport { Schemas } from '../../../../base/common/network.js';\n\nexport const ICommentService = createDecorator<ICommentService>('commentService');\n\ninterface IResourceCommentThreadEvent {\n\tresource: URI;\n\tcommentInfos: ICommentInfo[];\n}\n\nexport interface ICommentInfo<T = IRange> extends CommentInfo<T> {\n\tuniqueOwner: string;\n\tlabel?: string;\n}\n\nexport interface INotebookCommentInfo {\n\textensionId?: string;\n\tthreads: CommentThread<ICellRange>[];\n\tuniqueOwner: string;\n\tlabel?: string;\n}\n\nexport interface IWorkspaceCommentThreadsEvent {\n\townerId: string;\n\townerLabel: string;\n\tcommentThreads: CommentThread[];\n}\n\nexport interface INotebookCommentThreadChangedEvent extends CommentThreadChangedEvent<ICellRange> {\n\tuniqueOwner: string;\n}\n\nexport interface ICommentController {\n\tid: string;\n\tlabel: string;\n\tfeatures: {\n\t\treactionGroup?: CommentReaction[];\n\t\treactionHandler?: boolean;\n\t\toptions?: CommentOptions;\n\t};\n\toptions?: CommentOptions;\n\tcontextValue?: string;\n\towner: string;\n\tactiveComment: { thread: CommentThread; comment?: Comment } | undefined;\n\tcreateCommentThreadTemplate(resource: UriComponents, range: IRange | undefined, editorId?: string): Promise<void>;\n\tupdateCommentThreadTemplate(threadHandle: number, range: IRange): Promise<void>;\n\tdeleteCommentThreadMain(commentThreadId: string): void;\n\ttoggleReaction(uri: URI, thread: CommentThread, comment: Comment, reaction: CommentReaction, token: CancellationToken): Promise<void>;\n\tgetDocumentComments(resource: URI, token: CancellationToken): Promise<ICommentInfo<IRange>>;\n\tgetNotebookComments(resource: URI, token: CancellationToken): Promise<INotebookCommentInfo>;\n\tsetActiveCommentAndThread(commentInfo: { thread: CommentThread; comment?: Comment } | undefined): Promise<void>;\n}\n\nexport interface IContinueOnCommentProvider {\n\tprovideContinueOnComments(): PendingCommentThread[];\n}\n\nexport interface ICommentService {\n\treadonly _serviceBrand: undefined;\n\treadonly onDidSetResourceCommentInfos: Event<IResourceCommentThreadEvent>;\n\treadonly onDidSetAllCommentThreads: Event<IWorkspaceCommentThreadsEvent>;\n\treadonly onDidUpdateCommentThreads: Event<ICommentThreadChangedEvent>;\n\treadonly onDidUpdateNotebookCommentThreads: Event<INotebookCommentThreadChangedEvent>;\n\treadonly onDidChangeActiveEditingCommentThread: Event<CommentThread | null>;\n\treadonly onDidChangeCurrentCommentThread: Event<CommentThread | undefined>;\n\treadonly onDidUpdateCommentingRanges: Event<{ uniqueOwner: string }>;\n\treadonly onDidChangeActiveCommentingRange: Event<{ range: Range; commentingRangesInfo: CommentingRanges }>;\n\treadonly onDidSetDataProvider: Event<void>;\n\treadonly onDidDeleteDataProvider: Event<string | undefined>;\n\treadonly onDidChangeCommentingEnabled: Event<boolean>;\n\treadonly onResourceHasCommentingRanges: Event<void>;\n\treadonly isCommentingEnabled: boolean;\n\treadonly commentsModel: ICommentsModel;\n\treadonly lastActiveCommentcontroller: ICommentController | undefined;\n\tsetDocumentComments(resource: URI, commentInfos: ICommentInfo[]): void;\n\tsetWorkspaceComments(uniqueOwner: string, commentsByResource: CommentThread<IRange | ICellRange>[]): void;\n\tremoveWorkspaceComments(uniqueOwner: string): void;\n\tregisterCommentController(uniqueOwner: string, commentControl: ICommentController): void;\n\tunregisterCommentController(uniqueOwner?: string): void;\n\tgetCommentController(uniqueOwner: string): ICommentController | undefined;\n\tcreateCommentThreadTemplate(uniqueOwner: string, resource: URI, range: Range | undefined, editorId?: string): Promise<void>;\n\tupdateCommentThreadTemplate(uniqueOwner: string, threadHandle: number, range: Range): Promise<void>;\n\tgetCommentMenus(uniqueOwner: string): CommentMenus;\n\tupdateComments(ownerId: string, event: CommentThreadChangedEvent<IRange>): void;\n\tupdateNotebookComments(ownerId: string, event: CommentThreadChangedEvent<ICellRange>): void;\n\tdisposeCommentThread(ownerId: string, threadId: string): void;\n\tgetDocumentComments(resource: URI): Promise<(ICommentInfo | null)[]>;\n\tgetNotebookComments(resource: URI): Promise<(INotebookCommentInfo | null)[]>;\n\tupdateCommentingRanges(ownerId: string, resourceHints?: CommentingRangeResourceHint): void;\n\thasReactionHandler(uniqueOwner: string): boolean;\n\ttoggleReaction(uniqueOwner: string, resource: URI, thread: CommentThread<IRange | ICellRange>, comment: Comment, reaction: CommentReaction): Promise<void>;\n\tsetActiveEditingCommentThread(commentThread: CommentThread<IRange | ICellRange> | null): void;\n\tsetCurrentCommentThread(commentThread: CommentThread<IRange | ICellRange> | undefined): void;\n\tsetActiveCommentAndThread(uniqueOwner: string, commentInfo: { thread: CommentThread<IRange | ICellRange>; comment?: Comment } | undefined): Promise<void>;\n\tenableCommenting(enable: boolean): void;\n\tregisterContinueOnCommentProvider(provider: IContinueOnCommentProvider): IDisposable;\n\tremoveContinueOnComment(pendingComment: { range: IRange | undefined; uri: URI; uniqueOwner: string; isReply?: boolean }): PendingCommentThread | undefined;\n\tresourceHasCommentingRanges(resource: URI): boolean;\n}\n\nconst CONTINUE_ON_COMMENTS = 'comments.continueOnComments';\n\nexport class CommentService extends Disposable implements ICommentService {\n\tdeclare readonly _serviceBrand: undefined;\n\n\tprivate readonly _onDidSetDataProvider: Emitter<void> = this._register(new Emitter<void>());\n\treadonly onDidSetDataProvider: Event<void> = this._onDidSetDataProvider.event;\n\n\tprivate readonly _onDidDeleteDataProvider: Emitter<string | undefined> = this._register(new Emitter<string | undefined>());\n\treadonly onDidDeleteDataProvider: Event<string | undefined> = this._onDidDeleteDataProvider.event;\n\n\tprivate readonly _onDidSetResourceCommentInfos: Emitter<IResourceCommentThreadEvent> = this._register(new Emitter<IResourceCommentThreadEvent>());\n\treadonly onDidSetResourceCommentInfos: Event<IResourceCommentThreadEvent> = this._onDidSetResourceCommentInfos.event;\n\n\tprivate readonly _onDidSetAllCommentThreads: Emitter<IWorkspaceCommentThreadsEvent> = this._register(new Emitter<IWorkspaceCommentThreadsEvent>());\n\treadonly onDidSetAllCommentThreads: Event<IWorkspaceCommentThreadsEvent> = this._onDidSetAllCommentThreads.event;\n\n\tprivate readonly _onDidUpdateCommentThreads: Emitter<ICommentThreadChangedEvent> = this._register(new Emitter<ICommentThreadChangedEvent>());\n\treadonly onDidUpdateCommentThreads: Event<ICommentThreadChangedEvent> = this._onDidUpdateCommentThreads.event;\n\n\tprivate readonly _onDidUpdateNotebookCommentThreads: Emitter<INotebookCommentThreadChangedEvent> = this._register(new Emitter<INotebookCommentThreadChangedEvent>());\n\treadonly onDidUpdateNotebookCommentThreads: Event<INotebookCommentThreadChangedEvent> = this._onDidUpdateNotebookCommentThreads.event;\n\n\tprivate readonly _onDidUpdateCommentingRanges: Emitter<{ uniqueOwner: string }> = this._register(new Emitter<{ uniqueOwner: string }>());\n\treadonly onDidUpdateCommentingRanges: Event<{ uniqueOwner: string }> = this._onDidUpdateCommentingRanges.event;\n\n\tprivate readonly _onDidChangeActiveEditingCommentThread = this._register(new Emitter<CommentThread | null>());\n\treadonly onDidChangeActiveEditingCommentThread = this._onDidChangeActiveEditingCommentThread.event;\n\n\tprivate readonly _onDidChangeCurrentCommentThread = this._register(new Emitter<CommentThread | undefined>());\n\treadonly onDidChangeCurrentCommentThread = this._onDidChangeCurrentCommentThread.event;\n\n\tprivate readonly _onDidChangeCommentingEnabled = this._register(new Emitter<boolean>());\n\treadonly onDidChangeCommentingEnabled = this._onDidChangeCommentingEnabled.event;\n\n\tprivate readonly _onResourceHasCommentingRanges = this._register(new Emitter<void>());\n\treadonly onResourceHasCommentingRanges = this._onResourceHasCommentingRanges.event;\n\n\tprivate readonly _onDidChangeActiveCommentingRange: Emitter<{\n\t\trange: Range; commentingRangesInfo:\n\t\tCommentingRanges;\n\t}> = this._register(new Emitter<{\n\t\trange: Range; commentingRangesInfo:\n\t\tCommentingRanges;\n\t}>());\n\treadonly onDidChangeActiveCommentingRange: Event<{ range: Range; commentingRangesInfo: CommentingRanges }> = this._onDidChangeActiveCommentingRange.event;\n\n\tprivate _commentControls = new Map<string, ICommentController>();\n\tprivate _commentMenus = new Map<string, CommentMenus>();\n\tprivate _isCommentingEnabled: boolean = true;\n\tprivate _workspaceHasCommenting: IContextKey<boolean>;\n\tprivate _commentingEnabled: IContextKey<boolean>;\n\n\tprivate _continueOnComments = new Map<string, PendingCommentThread[]>(); // uniqueOwner -> PendingCommentThread[]\n\tprivate _continueOnCommentProviders = new Set<IContinueOnCommentProvider>();\n\n\tprivate readonly _commentsModel: CommentsModel = this._register(new CommentsModel());\n\tpublic readonly commentsModel: ICommentsModel = this._commentsModel;\n\n\tprivate _commentingRangeResources = new Set<string>(); // URIs\n\tprivate _commentingRangeResourceHintSchemes = new Set<string>(); // schemes\n\n\tconstructor(\n\t\t@IInstantiationService protected readonly instantiationService: IInstantiationService,\n\t\t@IWorkbenchLayoutService private readonly layoutService: IWorkbenchLayoutService,\n\t\t@IConfigurationService private readonly configurationService: IConfigurationService,\n\t\t@IContextKeyService contextKeyService: IContextKeyService,\n\t\t@IStorageService private readonly storageService: IStorageService,\n\t\t@ILogService private readonly logService: ILogService,\n\t\t@IModelService private readonly modelService: IModelService\n\t) {\n\t\tsuper();\n\t\tthis._handleConfiguration();\n\t\tthis._handleZenMode();\n\t\tthis._workspaceHasCommenting = CommentContextKeys.WorkspaceHasCommenting.bindTo(contextKeyService);\n\t\tthis._commentingEnabled = CommentContextKeys.commentingEnabled.bindTo(contextKeyService);\n\t\tconst storageListener = this._register(new DisposableStore());\n\n\t\tconst storageEvent = Event.debounce(this.storageService.onDidChangeValue(StorageScope.WORKSPACE, CONTINUE_ON_COMMENTS, storageListener), (last, event) => last?.external ? last : event, 500);\n\t\tstorageListener.add(storageEvent(v => {\n\t\t\tif (!v.external) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst commentsToRestore: PendingCommentThread[] | undefined = this.storageService.getObject(CONTINUE_ON_COMMENTS, StorageScope.WORKSPACE);\n\t\t\tif (!commentsToRestore) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis.logService.debug(`Comments: URIs of continue on comments from storage ${commentsToRestore.map(thread => thread.uri.toString()).join(', ')}.`);\n\t\t\tconst changedOwners = this._addContinueOnComments(commentsToRestore, this._continueOnComments);\n\t\t\tfor (const uniqueOwner of changedOwners) {\n\t\t\t\tconst control = this._commentControls.get(uniqueOwner);\n\t\t\t\tif (!control) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tconst evt: ICommentThreadChangedEvent = {\n\t\t\t\t\tuniqueOwner: uniqueOwner,\n\t\t\t\t\towner: control.owner,\n\t\t\t\t\townerLabel: control.label,\n\t\t\t\t\tpending: this._continueOnComments.get(uniqueOwner) || [],\n\t\t\t\t\tadded: [],\n\t\t\t\t\tremoved: [],\n\t\t\t\t\tchanged: []\n\t\t\t\t};\n\t\t\t\tthis.updateModelThreads(evt);\n\t\t\t}\n\t\t}));\n\t\tthis._register(storageService.onWillSaveState(() => {\n\t\t\tconst map: Map<string, PendingCommentThread[]> = new Map();\n\t\t\tfor (const provider of this._continueOnCommentProviders) {\n\t\t\t\tconst pendingComments = provider.provideContinueOnComments();\n\t\t\t\tthis._addContinueOnComments(pendingComments, map);\n\t\t\t}\n\t\t\tthis._saveContinueOnComments(map);\n\t\t}));\n\n\t\tthis._register(this.modelService.onModelAdded(model => {\n\t\t\t// Excluded schemes\n\t\t\tif ((model.uri.scheme === Schemas.vscodeSourceControl)) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t// Allows comment providers to cause their commenting ranges to be prefetched by opening text documents in the background.\n\t\t\tif (!this._commentingRangeResources.has(model.uri.toString())) {\n\t\t\t\tthis.getDocumentComments(model.uri);\n\t\t\t}\n\t\t}));\n\t}\n\n\tprivate _updateResourcesWithCommentingRanges(resource: URI, commentInfos: (ICommentInfo | null)[]) {\n\t\tlet addedResources = false;\n\t\tfor (const comments of commentInfos) {\n\t\t\tif (comments && (comments.commentingRanges.ranges.length > 0 || comments.threads.length > 0)) {\n\t\t\t\tthis._commentingRangeResources.add(resource.toString());\n\t\t\t\taddedResources = true;\n\t\t\t}\n\t\t}\n\t\tif (addedResources) {\n\t\t\tthis._onResourceHasCommentingRanges.fire();\n\t\t}\n\t}\n\n\tprivate _handleConfiguration() {\n\t\tthis._isCommentingEnabled = this._defaultCommentingEnablement;\n\t\tthis._register(this.configurationService.onDidChangeConfiguration(e => {\n\t\t\tif (e.affectsConfiguration('comments.visible')) {\n\t\t\t\tthis.enableCommenting(this._defaultCommentingEnablement);\n\t\t\t}\n\t\t}));\n\t}\n\n\tprivate _handleZenMode() {\n\t\tlet preZenModeValue: boolean = this._isCommentingEnabled;\n\t\tthis._register(this.layoutService.onDidChangeZenMode(e => {\n\t\t\tif (e) {\n\t\t\t\tpreZenModeValue = this._isCommentingEnabled;\n\t\t\t\tthis.enableCommenting(false);\n\t\t\t} else {\n\t\t\t\tthis.enableCommenting(preZenModeValue);\n\t\t\t}\n\t\t}));\n\t}\n\n\tprivate get _defaultCommentingEnablement(): boolean {\n\t\treturn !!this.configurationService.getValue<ICommentsConfiguration | undefined>(COMMENTS_SECTION)?.visible;\n\t}\n\n\tget isCommentingEnabled(): boolean {\n\t\treturn this._isCommentingEnabled;\n\t}\n\n\tenableCommenting(enable: boolean): void {\n\t\tif (enable !== this._isCommentingEnabled) {\n\t\t\tthis._isCommentingEnabled = enable;\n\t\t\tthis._commentingEnabled.set(enable);\n\t\t\tthis._onDidChangeCommentingEnabled.fire(enable);\n\t\t}\n\t}\n\n\t/**\n\t * The current comment thread is the thread that has focus or is being hovered.\n\t * @param commentThread\n\t */\n\tsetCurrentCommentThread(commentThread: CommentThread | undefined) {\n\t\tthis._onDidChangeCurrentCommentThread.fire(commentThread);\n\t}\n\n\t/**\n\t * The active comment thread is the thread that is currently being edited.\n\t * @param commentThread\n\t */\n\tsetActiveEditingCommentThread(commentThread: CommentThread | null) {\n\t\tthis._onDidChangeActiveEditingCommentThread.fire(commentThread);\n\t}\n\n\tget lastActiveCommentcontroller() {\n\t\treturn this._lastActiveCommentController;\n\t}\n\n\tprivate _lastActiveCommentController: ICommentController | undefined;\n\tasync setActiveCommentAndThread(uniqueOwner: string, commentInfo: { thread: CommentThread<IRange>; comment?: Comment } | undefined) {\n\t\tconst commentController = this._commentControls.get(uniqueOwner);\n\n\t\tif (!commentController) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (commentController !== this._lastActiveCommentController) {\n\t\t\tawait this._lastActiveCommentController?.setActiveCommentAndThread(undefined);\n\t\t}\n\t\tthis._lastActiveCommentController = commentController;\n\t\treturn commentController.setActiveCommentAndThread(commentInfo);\n\t}\n\n\tsetDocumentComments(resource: URI, commentInfos: ICommentInfo[]): void {\n\t\tthis._onDidSetResourceCommentInfos.fire({ resource, commentInfos });\n\t}\n\n\tprivate setModelThreads(ownerId: string, owner: string, ownerLabel: string, commentThreads: CommentThread<IRange>[]) {\n\t\tthis._commentsModel.setCommentThreads(ownerId, owner, ownerLabel, commentThreads);\n\t\tthis._onDidSetAllCommentThreads.fire({ ownerId, ownerLabel, commentThreads });\n\t}\n\n\tprivate updateModelThreads(event: ICommentThreadChangedEvent) {\n\t\tthis._commentsModel.updateCommentThreads(event);\n\t\tthis._onDidUpdateCommentThreads.fire(event);\n\t}\n\n\tsetWorkspaceComments(uniqueOwner: string, commentsByResource: CommentThread[]): void {\n\n\t\tif (commentsByResource.length) {\n\t\t\tthis._workspaceHasCommenting.set(true);\n\t\t}\n\t\tconst control = this._commentControls.get(uniqueOwner);\n\t\tif (control) {\n\t\t\tthis.setModelThreads(uniqueOwner, control.owner, control.label, commentsByResource);\n\t\t}\n\t}\n\n\tremoveWorkspaceComments(uniqueOwner: string): void {\n\t\tconst control = this._commentControls.get(uniqueOwner);\n\t\tif (control) {\n\t\t\tthis.setModelThreads(uniqueOwner, control.owner, control.label, []);\n\t\t}\n\t}\n\n\tregisterCommentController(uniqueOwner: string, commentControl: ICommentController): void {\n\t\tthis._commentControls.set(uniqueOwner, commentControl);\n\t\tthis._onDidSetDataProvider.fire();\n\t}\n\n\tunregisterCommentController(uniqueOwner?: string): void {\n\t\tif (uniqueOwner) {\n\t\t\tthis._commentControls.delete(uniqueOwner);\n\t\t} else {\n\t\t\tthis._commentControls.clear();\n\t\t}\n\t\tthis._commentsModel.deleteCommentsByOwner(uniqueOwner);\n\t\tthis._onDidDeleteDataProvider.fire(uniqueOwner);\n\t}\n\n\tgetCommentController(uniqueOwner: string): ICommentController | undefined {\n\t\treturn this._commentControls.get(uniqueOwner);\n\t}\n\n\tasync createCommentThreadTemplate(uniqueOwner: string, resource: URI, range: Range | undefined, editorId?: string): Promise<void> {\n\t\tconst commentController = this._commentControls.get(uniqueOwner);\n\n\t\tif (!commentController) {\n\t\t\treturn;\n\t\t}\n\n\t\treturn commentController.createCommentThreadTemplate(resource, range, editorId);\n\t}\n\n\tasync updateCommentThreadTemplate(uniqueOwner: string, threadHandle: number, range: Range) {\n\t\tconst commentController = this._commentControls.get(uniqueOwner);\n\n\t\tif (!commentController) {\n\t\t\treturn;\n\t\t}\n\n\t\tawait commentController.updateCommentThreadTemplate(threadHandle, range);\n\t}\n\n\tdisposeCommentThread(uniqueOwner: string, threadId: string) {\n\t\tconst controller = this.getCommentController(uniqueOwner);\n\t\tcontroller?.deleteCommentThreadMain(threadId);\n\t}\n\n\tgetCommentMenus(uniqueOwner: string): CommentMenus {\n\t\tif (this._commentMenus.get(uniqueOwner)) {\n\t\t\treturn this._commentMenus.get(uniqueOwner)!;\n\t\t}\n\n\t\tconst menu = this.instantiationService.createInstance(CommentMenus);\n\t\tthis._commentMenus.set(uniqueOwner, menu);\n\t\treturn menu;\n\t}\n\n\tupdateComments(ownerId: string, event: CommentThreadChangedEvent<IRange>): void {\n\t\tconst control = this._commentControls.get(ownerId);\n\t\tif (control) {\n\t\t\tconst evt: ICommentThreadChangedEvent = Object.assign({}, event, { uniqueOwner: ownerId, ownerLabel: control.label, owner: control.owner });\n\t\t\tthis.updateModelThreads(evt);\n\t\t}\n\t}\n\n\tupdateNotebookComments(ownerId: string, event: CommentThreadChangedEvent<ICellRange>): void {\n\t\tconst evt: INotebookCommentThreadChangedEvent = Object.assign({}, event, { uniqueOwner: ownerId });\n\t\tthis._onDidUpdateNotebookCommentThreads.fire(evt);\n\t}\n\n\tupdateCommentingRanges(ownerId: string, resourceHints?: CommentingRangeResourceHint) {\n\t\tif (resourceHints?.schemes && resourceHints.schemes.length > 0) {\n\t\t\tfor (const scheme of resourceHints.schemes) {\n\t\t\t\tthis._commentingRangeResourceHintSchemes.add(scheme);\n\t\t\t}\n\t\t}\n\t\tthis._workspaceHasCommenting.set(true);\n\t\tthis._onDidUpdateCommentingRanges.fire({ uniqueOwner: ownerId });\n\t}\n\n\tasync toggleReaction(uniqueOwner: string, resource: URI, thread: CommentThread, comment: Comment, reaction: CommentReaction): Promise<void> {\n\t\tconst commentController = this._commentControls.get(uniqueOwner);\n\n\t\tif (commentController) {\n\t\t\treturn commentController.toggleReaction(resource, thread, comment, reaction, CancellationToken.None);\n\t\t} else {\n\t\t\tthrow new Error('Not supported');\n\t\t}\n\t}\n\n\thasReactionHandler(uniqueOwner: string): boolean {\n\t\tconst commentProvider = this._commentControls.get(uniqueOwner);\n\n\t\tif (commentProvider) {\n\t\t\treturn !!commentProvider.features.reactionHandler;\n\t\t}\n\n\t\treturn false;\n\t}\n\n\tasync getDocumentComments(resource: URI): Promise<(ICommentInfo | null)[]> {\n\t\tconst commentControlResult: Promise<ICommentInfo | null>[] = [];\n\n\t\tfor (const control of this._commentControls.values()) {\n\t\t\tcommentControlResult.push(control.getDocumentComments(resource, CancellationToken.None)\n\t\t\t\t.then(documentComments => {\n\t\t\t\t\t// Check that there aren't any continue on comments in the provided comments\n\t\t\t\t\t// This can happen because continue on comments are stored separately from local un-submitted comments.\n\t\t\t\t\tfor (const documentCommentThread of documentComments.threads) {\n\t\t\t\t\t\tif (documentCommentThread.comments?.length === 0 && documentCommentThread.range) {\n\t\t\t\t\t\t\tthis.removeContinueOnComment({ range: documentCommentThread.range, uri: resource, uniqueOwner: documentComments.uniqueOwner });\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tconst pendingComments = this._continueOnComments.get(documentComments.uniqueOwner);\n\t\t\t\t\tdocumentComments.pendingCommentThreads = pendingComments?.filter(pendingComment => pendingComment.uri.toString() === resource.toString());\n\t\t\t\t\treturn documentComments;\n\t\t\t\t})\n\t\t\t\t.catch(_ => {\n\t\t\t\t\treturn null;\n\t\t\t\t}));\n\t\t}\n\n\t\tconst commentInfos = await Promise.all(commentControlResult);\n\t\tthis._updateResourcesWithCommentingRanges(resource, commentInfos);\n\t\treturn commentInfos;\n\t}\n\n\tasync getNotebookComments(resource: URI): Promise<(INotebookCommentInfo | null)[]> {\n\t\tconst commentControlResult: Promise<INotebookCommentInfo | null>[] = [];\n\n\t\tthis._commentControls.forEach(control => {\n\t\t\tcommentControlResult.push(control.getNotebookComments(resource, CancellationToken.None)\n\t\t\t\t.catch(_ => {\n\t\t\t\t\treturn null;\n\t\t\t\t}));\n\t\t});\n\n\t\treturn Promise.all(commentControlResult);\n\t}\n\n\tregisterContinueOnCommentProvider(provider: IContinueOnCommentProvider): IDisposable {\n\t\tthis._continueOnCommentProviders.add(provider);\n\t\treturn {\n\t\t\tdispose: () => {\n\t\t\t\tthis._continueOnCommentProviders.delete(provider);\n\t\t\t}\n\t\t};\n\t}\n\n\tprivate _saveContinueOnComments(map: Map<string, PendingCommentThread[]>) {\n\t\tconst commentsToSave: PendingCommentThread[] = [];\n\t\tfor (const pendingComments of map.values()) {\n\t\t\tcommentsToSave.push(...pendingComments);\n\t\t}\n\t\tthis.logService.debug(`Comments: URIs of continue on comments to add to storage ${commentsToSave.map(thread => thread.uri.toString()).join(', ')}.`);\n\t\tthis.storageService.store(CONTINUE_ON_COMMENTS, commentsToSave, StorageScope.WORKSPACE, StorageTarget.USER);\n\t}\n\n\tremoveContinueOnComment(pendingComment: { range: IRange; uri: URI; uniqueOwner: string; isReply?: boolean }): PendingCommentThread | undefined {\n\t\tconst pendingComments = this._continueOnComments.get(pendingComment.uniqueOwner);\n\t\tif (pendingComments) {\n\t\t\tconst commentIndex = pendingComments.findIndex(comment => comment.uri.toString() === pendingComment.uri.toString() && Range.equalsRange(comment.range, pendingComment.range) && (pendingComment.isReply === undefined || comment.isReply === pendingComment.isReply));\n\t\t\tif (commentIndex > -1) {\n\t\t\t\treturn pendingComments.splice(commentIndex, 1)[0];\n\t\t\t}\n\t\t}\n\t\treturn undefined;\n\t}\n\n\tprivate _addContinueOnComments(pendingComments: PendingCommentThread[], map: Map<string, PendingCommentThread[]>): Set<string> {\n\t\tconst changedOwners = new Set<string>();\n\t\tfor (const pendingComment of pendingComments) {\n\t\t\tif (!map.has(pendingComment.uniqueOwner)) {\n\t\t\t\tmap.set(pendingComment.uniqueOwner, [pendingComment]);\n\t\t\t\tchangedOwners.add(pendingComment.uniqueOwner);\n\t\t\t} else {\n\t\t\t\tconst commentsForOwner = map.get(pendingComment.uniqueOwner)!;\n\t\t\t\tif (commentsForOwner.every(comment => (comment.uri.toString() !== pendingComment.uri.toString()) || !Range.equalsRange(comment.range, pendingComment.range))) {\n\t\t\t\t\tcommentsForOwner.push(pendingComment);\n\t\t\t\t\tchangedOwners.add(pendingComment.uniqueOwner);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn changedOwners;\n\t}\n\n\tresourceHasCommentingRanges(resource: URI): boolean {\n\t\treturn this._commentingRangeResourceHintSchemes.has(resource.scheme) || this._commentingRangeResources.has(resource.toString());\n\t}\n}\n"]}