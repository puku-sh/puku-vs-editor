{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/contrib/comments/browser/simpleCommentEditor.ts","vs/workbench/contrib/comments/browser/simpleCommentEditor.ts"],"names":[],"mappings":"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","file":"simpleCommentEditor.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { EditorOption, IEditorOptions } from '../../../../editor/common/config/editorOptions.js';\nimport { EditorAction, EditorContributionInstantiation, EditorExtensionsRegistry, IEditorContributionDescription } from '../../../../editor/browser/editorExtensions.js';\nimport { ICodeEditorService } from '../../../../editor/browser/services/codeEditorService.js';\nimport { CodeEditorWidget, ICodeEditorWidgetOptions } from '../../../../editor/browser/widget/codeEditor/codeEditorWidget.js';\nimport { IContextKeyService, RawContextKey, IContextKey } from '../../../../platform/contextkey/common/contextkey.js';\nimport { IInstantiationService } from '../../../../platform/instantiation/common/instantiation.js';\nimport { ICommandService } from '../../../../platform/commands/common/commands.js';\n\n// Allowed Editor Contributions:\nimport { MenuPreventer } from '../../codeEditor/browser/menuPreventer.js';\nimport { EditorDictation } from '../../codeEditor/browser/dictation/editorDictation.js';\nimport { ContextMenuController } from '../../../../editor/contrib/contextmenu/browser/contextmenu.js';\nimport { SuggestController } from '../../../../editor/contrib/suggest/browser/suggestController.js';\nimport { SnippetController2 } from '../../../../editor/contrib/snippet/browser/snippetController2.js';\nimport { TabCompletionController } from '../../snippets/browser/tabCompletion.js';\nimport { IThemeService } from '../../../../platform/theme/common/themeService.js';\nimport { INotificationService } from '../../../../platform/notification/common/notification.js';\nimport { IAccessibilityService } from '../../../../platform/accessibility/common/accessibility.js';\nimport { ICommentThreadWidget } from '../common/commentThreadWidget.js';\nimport { CommentContextKeys } from '../common/commentContextKeys.js';\nimport { ILanguageConfigurationService } from '../../../../editor/common/languages/languageConfigurationRegistry.js';\nimport { ILanguageFeaturesService } from '../../../../editor/common/services/languageFeatures.js';\nimport { IConfigurationService } from '../../../../platform/configuration/common/configuration.js';\nimport { ICodeEditor } from '../../../../editor/browser/editorBrowser.js';\nimport { clamp } from '../../../../base/common/numbers.js';\nimport { CopyPasteController } from '../../../../editor/contrib/dropOrPasteInto/browser/copyPasteController.js';\nimport { CodeActionController } from '../../../../editor/contrib/codeAction/browser/codeActionController.js';\nimport { DropIntoEditorController } from '../../../../editor/contrib/dropOrPasteInto/browser/dropIntoEditorController.js';\nimport { InlineCompletionsController } from '../../../../editor/contrib/inlineCompletions/browser/controller/inlineCompletionsController.js';\nimport { LinkDetector } from '../../../../editor/contrib/links/browser/links.js';\nimport { MessageController } from '../../../../editor/contrib/message/browser/messageController.js';\nimport { SelectionClipboardContributionID } from '../../codeEditor/browser/selectionClipboard.js';\nimport { MenuId } from '../../../../platform/actions/common/actions.js';\nimport { ContentHoverController } from '../../../../editor/contrib/hover/browser/contentHoverController.js';\nimport { GlyphHoverController } from '../../../../editor/contrib/hover/browser/glyphHoverController.js';\nimport { PlaceholderTextContribution } from '../../../../editor/contrib/placeholderText/browser/placeholderTextContribution.js';\n\nexport const ctxCommentEditorFocused = new RawContextKey<boolean>('commentEditorFocused', false);\nexport const MIN_EDITOR_HEIGHT = 5 * 18;\nexport const MAX_EDITOR_HEIGHT = 25 * 18;\n\nexport interface LayoutableEditor {\n\tgetLayoutInfo(): { height: number };\n}\n\nexport class SimpleCommentEditor extends CodeEditorWidget {\n\tprivate _parentThread: ICommentThreadWidget;\n\tprivate _commentEditorFocused: IContextKey<boolean>;\n\tprivate _commentEditorEmpty: IContextKey<boolean>;\n\n\tconstructor(\n\t\tdomElement: HTMLElement,\n\t\toptions: IEditorOptions,\n\t\tscopedContextKeyService: IContextKeyService,\n\t\tparentThread: ICommentThreadWidget,\n\t\t@IInstantiationService instantiationService: IInstantiationService,\n\t\t@ICodeEditorService codeEditorService: ICodeEditorService,\n\t\t@ICommandService commandService: ICommandService,\n\t\t@IThemeService themeService: IThemeService,\n\t\t@INotificationService notificationService: INotificationService,\n\t\t@IAccessibilityService accessibilityService: IAccessibilityService,\n\t\t@ILanguageConfigurationService languageConfigurationService: ILanguageConfigurationService,\n\t\t@ILanguageFeaturesService languageFeaturesService: ILanguageFeaturesService,\n\t) {\n\t\tconst codeEditorWidgetOptions: ICodeEditorWidgetOptions = {\n\t\t\tcontributions: <IEditorContributionDescription[]>[\n\t\t\t\t{ id: MenuPreventer.ID, ctor: MenuPreventer, instantiation: EditorContributionInstantiation.BeforeFirstInteraction },\n\t\t\t\t{ id: ContextMenuController.ID, ctor: ContextMenuController, instantiation: EditorContributionInstantiation.BeforeFirstInteraction },\n\t\t\t\t{ id: SuggestController.ID, ctor: SuggestController, instantiation: EditorContributionInstantiation.Eager },\n\t\t\t\t{ id: SnippetController2.ID, ctor: SnippetController2, instantiation: EditorContributionInstantiation.Lazy },\n\t\t\t\t{ id: TabCompletionController.ID, ctor: TabCompletionController, instantiation: EditorContributionInstantiation.Eager }, // eager because it needs to define a context key\n\t\t\t\t{ id: EditorDictation.ID, ctor: EditorDictation, instantiation: EditorContributionInstantiation.Lazy },\n\t\t\t\t...EditorExtensionsRegistry.getSomeEditorContributions([\n\t\t\t\t\tCopyPasteController.ID,\n\t\t\t\t\tDropIntoEditorController.ID,\n\t\t\t\t\tLinkDetector.ID,\n\t\t\t\t\tMessageController.ID,\n\t\t\t\t\tContentHoverController.ID,\n\t\t\t\t\tGlyphHoverController.ID,\n\t\t\t\t\tSelectionClipboardContributionID,\n\t\t\t\t\tInlineCompletionsController.ID,\n\t\t\t\t\tCodeActionController.ID,\n\t\t\t\t\tPlaceholderTextContribution.ID\n\t\t\t\t])\n\t\t\t],\n\t\t\tcontextMenuId: MenuId.SimpleEditorContext\n\t\t};\n\n\t\tsuper(domElement, options, codeEditorWidgetOptions, instantiationService, codeEditorService, commandService, scopedContextKeyService, themeService, notificationService, accessibilityService, languageConfigurationService, languageFeaturesService);\n\n\t\tthis._commentEditorFocused = ctxCommentEditorFocused.bindTo(scopedContextKeyService);\n\t\tthis._commentEditorEmpty = CommentContextKeys.commentIsEmpty.bindTo(scopedContextKeyService);\n\t\tthis._commentEditorEmpty.set(!this.getModel()?.getValueLength());\n\t\tthis._parentThread = parentThread;\n\n\t\tthis._register(this.onDidFocusEditorWidget(_ => this._commentEditorFocused.set(true)));\n\n\t\tthis._register(this.onDidChangeModelContent(e => this._commentEditorEmpty.set(!this.getModel()?.getValueLength())));\n\t\tthis._register(this.onDidBlurEditorWidget(_ => this._commentEditorFocused.reset()));\n\t}\n\n\tgetParentThread(): ICommentThreadWidget {\n\t\treturn this._parentThread;\n\t}\n\n\tprotected _getActions(): Iterable<EditorAction> {\n\t\treturn EditorExtensionsRegistry.getEditorActions();\n\t}\n\n\tpublic override updateOptions(newOptions: Readonly<IEditorOptions> | undefined): void {\n\t\tconst withLineNumberRemoved: Readonly<IEditorOptions> = { ...newOptions, lineNumbers: 'off' };\n\t\tsuper.updateOptions(withLineNumberRemoved);\n\t}\n\n\tpublic static getEditorOptions(configurationService: IConfigurationService): IEditorOptions {\n\t\treturn {\n\t\t\twordWrap: 'on',\n\t\t\tglyphMargin: false,\n\t\t\tlineNumbers: 'off',\n\t\t\tfolding: false,\n\t\t\tselectOnLineNumbers: false,\n\t\t\tscrollbar: {\n\t\t\t\tvertical: 'visible',\n\t\t\t\tverticalScrollbarSize: 14,\n\t\t\t\thorizontal: 'auto',\n\t\t\t\tuseShadows: true,\n\t\t\t\tverticalHasArrows: false,\n\t\t\t\thorizontalHasArrows: false,\n\t\t\t\talwaysConsumeMouseWheel: false\n\t\t\t},\n\t\t\toverviewRulerLanes: 2,\n\t\t\tlineDecorationsWidth: 0,\n\t\t\tscrollBeyondLastLine: false,\n\t\t\trenderLineHighlight: 'none',\n\t\t\tfixedOverflowWidgets: true,\n\t\t\tacceptSuggestionOnEnter: 'smart',\n\t\t\tminimap: {\n\t\t\t\tenabled: false\n\t\t\t},\n\t\t\tdropIntoEditor: { enabled: true },\n\t\t\tautoClosingBrackets: configurationService.getValue('editor.autoClosingBrackets'),\n\t\t\tquickSuggestions: false,\n\t\t\taccessibilitySupport: configurationService.getValue<'auto' | 'off' | 'on'>('editor.accessibilitySupport'),\n\t\t\tfontFamily: configurationService.getValue('editor.fontFamily'),\n\t\t\tfontSize: configurationService.getValue('editor.fontSize'),\n\t\t\tallowVariableLineHeights: false\n\t\t};\n\t}\n}\n\nexport function calculateEditorHeight(parentEditor: LayoutableEditor, editor: ICodeEditor, currentHeight: number): number {\n\tconst layoutInfo = editor.getLayoutInfo();\n\tconst lineHeight = editor.getOption(EditorOption.lineHeight);\n\tconst contentHeight = (editor._getViewModel()?.getLineCount()! * lineHeight); // Can't just call getContentHeight() because it returns an incorrect, large, value when the editor is first created.\n\tif ((contentHeight > layoutInfo.height) ||\n\t\t(contentHeight < layoutInfo.height && currentHeight > MIN_EDITOR_HEIGHT)) {\n\t\tconst linesToAdd = Math.ceil((contentHeight - layoutInfo.height) / lineHeight);\n\t\tconst proposedHeight = layoutInfo.height + (lineHeight * linesToAdd);\n\t\treturn clamp(proposedHeight, MIN_EDITOR_HEIGHT, clamp(parentEditor.getLayoutInfo().height - 90, MIN_EDITOR_HEIGHT, MAX_EDITOR_HEIGHT));\n\t}\n\treturn currentHeight;\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { EditorOption, IEditorOptions } from '../../../../editor/common/config/editorOptions.js';\nimport { EditorAction, EditorContributionInstantiation, EditorExtensionsRegistry, IEditorContributionDescription } from '../../../../editor/browser/editorExtensions.js';\nimport { ICodeEditorService } from '../../../../editor/browser/services/codeEditorService.js';\nimport { CodeEditorWidget, ICodeEditorWidgetOptions } from '../../../../editor/browser/widget/codeEditor/codeEditorWidget.js';\nimport { IContextKeyService, RawContextKey, IContextKey } from '../../../../platform/contextkey/common/contextkey.js';\nimport { IInstantiationService } from '../../../../platform/instantiation/common/instantiation.js';\nimport { ICommandService } from '../../../../platform/commands/common/commands.js';\n\n// Allowed Editor Contributions:\nimport { MenuPreventer } from '../../codeEditor/browser/menuPreventer.js';\nimport { EditorDictation } from '../../codeEditor/browser/dictation/editorDictation.js';\nimport { ContextMenuController } from '../../../../editor/contrib/contextmenu/browser/contextmenu.js';\nimport { SuggestController } from '../../../../editor/contrib/suggest/browser/suggestController.js';\nimport { SnippetController2 } from '../../../../editor/contrib/snippet/browser/snippetController2.js';\nimport { TabCompletionController } from '../../snippets/browser/tabCompletion.js';\nimport { IThemeService } from '../../../../platform/theme/common/themeService.js';\nimport { INotificationService } from '../../../../platform/notification/common/notification.js';\nimport { IAccessibilityService } from '../../../../platform/accessibility/common/accessibility.js';\nimport { ICommentThreadWidget } from '../common/commentThreadWidget.js';\nimport { CommentContextKeys } from '../common/commentContextKeys.js';\nimport { ILanguageConfigurationService } from '../../../../editor/common/languages/languageConfigurationRegistry.js';\nimport { ILanguageFeaturesService } from '../../../../editor/common/services/languageFeatures.js';\nimport { IConfigurationService } from '../../../../platform/configuration/common/configuration.js';\nimport { ICodeEditor } from '../../../../editor/browser/editorBrowser.js';\nimport { clamp } from '../../../../base/common/numbers.js';\nimport { CopyPasteController } from '../../../../editor/contrib/dropOrPasteInto/browser/copyPasteController.js';\nimport { CodeActionController } from '../../../../editor/contrib/codeAction/browser/codeActionController.js';\nimport { DropIntoEditorController } from '../../../../editor/contrib/dropOrPasteInto/browser/dropIntoEditorController.js';\nimport { InlineCompletionsController } from '../../../../editor/contrib/inlineCompletions/browser/controller/inlineCompletionsController.js';\nimport { LinkDetector } from '../../../../editor/contrib/links/browser/links.js';\nimport { MessageController } from '../../../../editor/contrib/message/browser/messageController.js';\nimport { SelectionClipboardContributionID } from '../../codeEditor/browser/selectionClipboard.js';\nimport { MenuId } from '../../../../platform/actions/common/actions.js';\nimport { ContentHoverController } from '../../../../editor/contrib/hover/browser/contentHoverController.js';\nimport { GlyphHoverController } from '../../../../editor/contrib/hover/browser/glyphHoverController.js';\nimport { PlaceholderTextContribution } from '../../../../editor/contrib/placeholderText/browser/placeholderTextContribution.js';\n\nexport const ctxCommentEditorFocused = new RawContextKey<boolean>('commentEditorFocused', false);\nexport const MIN_EDITOR_HEIGHT = 5 * 18;\nexport const MAX_EDITOR_HEIGHT = 25 * 18;\n\nexport interface LayoutableEditor {\n\tgetLayoutInfo(): { height: number };\n}\n\nexport class SimpleCommentEditor extends CodeEditorWidget {\n\tprivate _parentThread: ICommentThreadWidget;\n\tprivate _commentEditorFocused: IContextKey<boolean>;\n\tprivate _commentEditorEmpty: IContextKey<boolean>;\n\n\tconstructor(\n\t\tdomElement: HTMLElement,\n\t\toptions: IEditorOptions,\n\t\tscopedContextKeyService: IContextKeyService,\n\t\tparentThread: ICommentThreadWidget,\n\t\t@IInstantiationService instantiationService: IInstantiationService,\n\t\t@ICodeEditorService codeEditorService: ICodeEditorService,\n\t\t@ICommandService commandService: ICommandService,\n\t\t@IThemeService themeService: IThemeService,\n\t\t@INotificationService notificationService: INotificationService,\n\t\t@IAccessibilityService accessibilityService: IAccessibilityService,\n\t\t@ILanguageConfigurationService languageConfigurationService: ILanguageConfigurationService,\n\t\t@ILanguageFeaturesService languageFeaturesService: ILanguageFeaturesService,\n\t) {\n\t\tconst codeEditorWidgetOptions: ICodeEditorWidgetOptions = {\n\t\t\tcontributions: <IEditorContributionDescription[]>[\n\t\t\t\t{ id: MenuPreventer.ID, ctor: MenuPreventer, instantiation: EditorContributionInstantiation.BeforeFirstInteraction },\n\t\t\t\t{ id: ContextMenuController.ID, ctor: ContextMenuController, instantiation: EditorContributionInstantiation.BeforeFirstInteraction },\n\t\t\t\t{ id: SuggestController.ID, ctor: SuggestController, instantiation: EditorContributionInstantiation.Eager },\n\t\t\t\t{ id: SnippetController2.ID, ctor: SnippetController2, instantiation: EditorContributionInstantiation.Lazy },\n\t\t\t\t{ id: TabCompletionController.ID, ctor: TabCompletionController, instantiation: EditorContributionInstantiation.Eager }, // eager because it needs to define a context key\n\t\t\t\t{ id: EditorDictation.ID, ctor: EditorDictation, instantiation: EditorContributionInstantiation.Lazy },\n\t\t\t\t...EditorExtensionsRegistry.getSomeEditorContributions([\n\t\t\t\t\tCopyPasteController.ID,\n\t\t\t\t\tDropIntoEditorController.ID,\n\t\t\t\t\tLinkDetector.ID,\n\t\t\t\t\tMessageController.ID,\n\t\t\t\t\tContentHoverController.ID,\n\t\t\t\t\tGlyphHoverController.ID,\n\t\t\t\t\tSelectionClipboardContributionID,\n\t\t\t\t\tInlineCompletionsController.ID,\n\t\t\t\t\tCodeActionController.ID,\n\t\t\t\t\tPlaceholderTextContribution.ID\n\t\t\t\t])\n\t\t\t],\n\t\t\tcontextMenuId: MenuId.SimpleEditorContext\n\t\t};\n\n\t\tsuper(domElement, options, codeEditorWidgetOptions, instantiationService, codeEditorService, commandService, scopedContextKeyService, themeService, notificationService, accessibilityService, languageConfigurationService, languageFeaturesService);\n\n\t\tthis._commentEditorFocused = ctxCommentEditorFocused.bindTo(scopedContextKeyService);\n\t\tthis._commentEditorEmpty = CommentContextKeys.commentIsEmpty.bindTo(scopedContextKeyService);\n\t\tthis._commentEditorEmpty.set(!this.getModel()?.getValueLength());\n\t\tthis._parentThread = parentThread;\n\n\t\tthis._register(this.onDidFocusEditorWidget(_ => this._commentEditorFocused.set(true)));\n\n\t\tthis._register(this.onDidChangeModelContent(e => this._commentEditorEmpty.set(!this.getModel()?.getValueLength())));\n\t\tthis._register(this.onDidBlurEditorWidget(_ => this._commentEditorFocused.reset()));\n\t}\n\n\tgetParentThread(): ICommentThreadWidget {\n\t\treturn this._parentThread;\n\t}\n\n\tprotected _getActions(): Iterable<EditorAction> {\n\t\treturn EditorExtensionsRegistry.getEditorActions();\n\t}\n\n\tpublic override updateOptions(newOptions: Readonly<IEditorOptions> | undefined): void {\n\t\tconst withLineNumberRemoved: Readonly<IEditorOptions> = { ...newOptions, lineNumbers: 'off' };\n\t\tsuper.updateOptions(withLineNumberRemoved);\n\t}\n\n\tpublic static getEditorOptions(configurationService: IConfigurationService): IEditorOptions {\n\t\treturn {\n\t\t\twordWrap: 'on',\n\t\t\tglyphMargin: false,\n\t\t\tlineNumbers: 'off',\n\t\t\tfolding: false,\n\t\t\tselectOnLineNumbers: false,\n\t\t\tscrollbar: {\n\t\t\t\tvertical: 'visible',\n\t\t\t\tverticalScrollbarSize: 14,\n\t\t\t\thorizontal: 'auto',\n\t\t\t\tuseShadows: true,\n\t\t\t\tverticalHasArrows: false,\n\t\t\t\thorizontalHasArrows: false,\n\t\t\t\talwaysConsumeMouseWheel: false\n\t\t\t},\n\t\t\toverviewRulerLanes: 2,\n\t\t\tlineDecorationsWidth: 0,\n\t\t\tscrollBeyondLastLine: false,\n\t\t\trenderLineHighlight: 'none',\n\t\t\tfixedOverflowWidgets: true,\n\t\t\tacceptSuggestionOnEnter: 'smart',\n\t\t\tminimap: {\n\t\t\t\tenabled: false\n\t\t\t},\n\t\t\tdropIntoEditor: { enabled: true },\n\t\t\tautoClosingBrackets: configurationService.getValue('editor.autoClosingBrackets'),\n\t\t\tquickSuggestions: false,\n\t\t\taccessibilitySupport: configurationService.getValue<'auto' | 'off' | 'on'>('editor.accessibilitySupport'),\n\t\t\tfontFamily: configurationService.getValue('editor.fontFamily'),\n\t\t\tfontSize: configurationService.getValue('editor.fontSize'),\n\t\t\tallowVariableLineHeights: false\n\t\t};\n\t}\n}\n\nexport function calculateEditorHeight(parentEditor: LayoutableEditor, editor: ICodeEditor, currentHeight: number): number {\n\tconst layoutInfo = editor.getLayoutInfo();\n\tconst lineHeight = editor.getOption(EditorOption.lineHeight);\n\tconst contentHeight = (editor._getViewModel()?.getLineCount()! * lineHeight); // Can't just call getContentHeight() because it returns an incorrect, large, value when the editor is first created.\n\tif ((contentHeight > layoutInfo.height) ||\n\t\t(contentHeight < layoutInfo.height && currentHeight > MIN_EDITOR_HEIGHT)) {\n\t\tconst linesToAdd = Math.ceil((contentHeight - layoutInfo.height) / lineHeight);\n\t\tconst proposedHeight = layoutInfo.height + (lineHeight * linesToAdd);\n\t\treturn clamp(proposedHeight, MIN_EDITOR_HEIGHT, clamp(parentEditor.getLayoutInfo().height - 90, MIN_EDITOR_HEIGHT, MAX_EDITOR_HEIGHT));\n\t}\n\treturn currentHeight;\n}\n"]}