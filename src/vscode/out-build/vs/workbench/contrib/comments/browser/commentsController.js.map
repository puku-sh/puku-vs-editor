{"version":3,"sources":["vs/workbench/contrib/comments/browser/commentsController.ts"],"names":[],"mappings":"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","file":"commentsController.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Action, IAction } from '../../../../base/common/actions.js';\nimport { coalesce } from '../../../../base/common/arrays.js';\nimport { findFirstIdxMonotonousOrArrLen } from '../../../../base/common/arraysFind.js';\nimport { CancelablePromise, createCancelablePromise, Delayer } from '../../../../base/common/async.js';\nimport { onUnexpectedError } from '../../../../base/common/errors.js';\nimport { DisposableStore, dispose, IDisposable } from '../../../../base/common/lifecycle.js';\nimport './media/review.css';\nimport { ICodeEditor, IEditorMouseEvent, isCodeEditor, isDiffEditor } from '../../../../editor/browser/editorBrowser.js';\nimport { ICodeEditorService } from '../../../../editor/browser/services/codeEditorService.js';\nimport { IRange, Range } from '../../../../editor/common/core/range.js';\nimport { EditorType, IDiffEditor, IEditor, IEditorContribution, IModelChangedEvent } from '../../../../editor/common/editorCommon.js';\nimport { IModelDecorationOptions, IModelDeltaDecoration } from '../../../../editor/common/model.js';\nimport { ModelDecorationOptions, TextModel } from '../../../../editor/common/model/textModel.js';\nimport * as languages from '../../../../editor/common/languages.js';\nimport * as nls from '../../../../nls.js';\nimport { IContextMenuService } from '../../../../platform/contextview/browser/contextView.js';\nimport { IInstantiationService } from '../../../../platform/instantiation/common/instantiation.js';\nimport { IQuickInputService, IQuickPickItem, QuickPickInput } from '../../../../platform/quickinput/common/quickInput.js';\nimport { CommentGlyphWidget } from './commentGlyphWidget.js';\nimport { ICommentInfo, ICommentService } from './commentService.js';\nimport { CommentWidgetFocus, isMouseUpEventDragFromMouseDown, parseMouseDownInfoFromEvent, ReviewZoneWidget } from './commentThreadZoneWidget.js';\nimport { ACTIVE_GROUP, IEditorService, SIDE_GROUP } from '../../../services/editor/common/editorService.js';\nimport { EmbeddedCodeEditorWidget } from '../../../../editor/browser/widget/codeEditor/embeddedCodeEditorWidget.js';\nimport { EditorOption } from '../../../../editor/common/config/editorOptions.js';\nimport { IViewsService } from '../../../services/views/common/viewsService.js';\nimport { COMMENTS_VIEW_ID } from './commentsTreeViewer.js';\nimport { IConfigurationService } from '../../../../platform/configuration/common/configuration.js';\nimport { COMMENTS_SECTION, ICommentsConfiguration } from '../common/commentsConfiguration.js';\nimport { COMMENTEDITOR_DECORATION_KEY } from './commentReply.js';\nimport { Emitter } from '../../../../base/common/event.js';\nimport { IContextKey, IContextKeyService } from '../../../../platform/contextkey/common/contextkey.js';\nimport { Position } from '../../../../editor/common/core/position.js';\nimport { CommentThreadRangeDecorator } from './commentThreadRangeDecorator.js';\nimport { ICursorSelectionChangedEvent } from '../../../../editor/common/cursorEvents.js';\nimport { CommentsPanel } from './commentsView.js';\nimport { status } from '../../../../base/browser/ui/aria/aria.js';\nimport { CommentContextKeys } from '../common/commentContextKeys.js';\nimport { AccessibilityVerbositySettingId } from '../../accessibility/browser/accessibilityConfiguration.js';\nimport { AccessibilityCommandId } from '../../accessibility/common/accessibilityCommands.js';\nimport { IKeybindingService } from '../../../../platform/keybinding/common/keybinding.js';\nimport { IAccessibilityService } from '../../../../platform/accessibility/common/accessibility.js';\nimport { URI } from '../../../../base/common/uri.js';\nimport { IUriIdentityService } from '../../../../platform/uriIdentity/common/uriIdentity.js';\nimport { threadHasMeaningfulComments } from './commentsModel.js';\nimport { INotificationService } from '../../../../platform/notification/common/notification.js';\n\nexport const ID = 'editor.contrib.review';\n\ninterface CommentRangeAction {\n\townerId: string;\n\textensionId: string | undefined;\n\tlabel: string | undefined;\n\tcommentingRangesInfo: languages.CommentingRanges;\n}\n\ninterface MergedCommentRangeActions {\n\trange?: Range;\n\taction: CommentRangeAction;\n}\n\nclass CommentingRangeDecoration implements IModelDeltaDecoration {\n\tprivate _decorationId: string | undefined;\n\tprivate _startLineNumber: number;\n\tprivate _endLineNumber: number;\n\n\tpublic get id(): string | undefined {\n\t\treturn this._decorationId;\n\t}\n\n\tpublic set id(id: string | undefined) {\n\t\tthis._decorationId = id;\n\t}\n\n\tpublic get range(): IRange {\n\t\treturn {\n\t\t\tstartLineNumber: this._startLineNumber, startColumn: 1,\n\t\t\tendLineNumber: this._endLineNumber, endColumn: 1\n\t\t};\n\t}\n\n\tconstructor(private _editor: ICodeEditor, private _ownerId: string, private _extensionId: string | undefined, private _label: string | undefined, private _range: IRange, public readonly options: ModelDecorationOptions, private commentingRangesInfo: languages.CommentingRanges, public readonly isHover: boolean = false) {\n\t\tthis._startLineNumber = _range.startLineNumber;\n\t\tthis._endLineNumber = _range.endLineNumber;\n\t}\n\n\tpublic getCommentAction(): CommentRangeAction {\n\t\treturn {\n\t\t\textensionId: this._extensionId,\n\t\t\tlabel: this._label,\n\t\t\townerId: this._ownerId,\n\t\t\tcommentingRangesInfo: this.commentingRangesInfo\n\t\t};\n\t}\n\n\tpublic getOriginalRange() {\n\t\treturn this._range;\n\t}\n\n\tpublic getActiveRange() {\n\t\treturn this.id ? this._editor.getModel()!.getDecorationRange(this.id) : undefined;\n\t}\n}\n\nclass CommentingRangeDecorator {\n\tpublic static description = 'commenting-range-decorator';\n\tprivate decorationOptions: ModelDecorationOptions;\n\tprivate hoverDecorationOptions: ModelDecorationOptions;\n\tprivate multilineDecorationOptions: ModelDecorationOptions;\n\tprivate commentingRangeDecorations: CommentingRangeDecoration[] = [];\n\tprivate decorationIds: string[] = [];\n\tprivate _editor: ICodeEditor | undefined;\n\tprivate _infos: ICommentInfo[] | undefined;\n\tprivate _lastHover: number = -1;\n\tprivate _lastSelection: Range | undefined;\n\tprivate _lastSelectionCursor: number | undefined;\n\tprivate _onDidChangeDecorationsCount: Emitter<number> = new Emitter();\n\tpublic readonly onDidChangeDecorationsCount = this._onDidChangeDecorationsCount.event;\n\n\tconstructor() {\n\t\tconst decorationOptions: IModelDecorationOptions = {\n\t\t\tdescription: CommentingRangeDecorator.description,\n\t\t\tisWholeLine: true,\n\t\t\tlinesDecorationsClassName: 'comment-range-glyph comment-diff-added'\n\t\t};\n\n\t\tthis.decorationOptions = ModelDecorationOptions.createDynamic(decorationOptions);\n\n\t\tconst hoverDecorationOptions: IModelDecorationOptions = {\n\t\t\tdescription: CommentingRangeDecorator.description,\n\t\t\tisWholeLine: true,\n\t\t\tlinesDecorationsClassName: `comment-range-glyph line-hover`\n\t\t};\n\n\t\tthis.hoverDecorationOptions = ModelDecorationOptions.createDynamic(hoverDecorationOptions);\n\n\t\tconst multilineDecorationOptions: IModelDecorationOptions = {\n\t\t\tdescription: CommentingRangeDecorator.description,\n\t\t\tisWholeLine: true,\n\t\t\tlinesDecorationsClassName: `comment-range-glyph multiline-add`\n\t\t};\n\n\t\tthis.multilineDecorationOptions = ModelDecorationOptions.createDynamic(multilineDecorationOptions);\n\t}\n\n\tpublic updateHover(hoverLine?: number) {\n\t\tif (this._editor && this._infos && (hoverLine !== this._lastHover)) {\n\t\t\tthis._doUpdate(this._editor, this._infos, hoverLine);\n\t\t}\n\t\tthis._lastHover = hoverLine ?? -1;\n\t}\n\n\tpublic updateSelection(cursorLine: number, range: Range = new Range(0, 0, 0, 0)) {\n\t\tthis._lastSelection = range.isEmpty() ? undefined : range;\n\t\tthis._lastSelectionCursor = range.isEmpty() ? undefined : cursorLine;\n\t\t// Some scenarios:\n\t\t// Selection is made. Emphasis should show on the drag/selection end location.\n\t\t// Selection is made, then user clicks elsewhere. We should still show the decoration.\n\t\tif (this._editor && this._infos) {\n\t\t\tthis._doUpdate(this._editor, this._infos, cursorLine, range);\n\t\t}\n\t}\n\n\tpublic update(editor: ICodeEditor | undefined, commentInfos: ICommentInfo[], cursorLine?: number, range?: Range) {\n\t\tif (editor) {\n\t\t\tthis._editor = editor;\n\t\t\tthis._infos = commentInfos;\n\t\t\tthis._doUpdate(editor, commentInfos, cursorLine, range);\n\t\t}\n\t}\n\n\tprivate _lineHasThread(editor: ICodeEditor, lineRange: Range) {\n\t\treturn editor.getDecorationsInRange(lineRange)?.find(decoration => decoration.options.description === CommentGlyphWidget.description);\n\t}\n\n\tprivate _doUpdate(editor: ICodeEditor, commentInfos: ICommentInfo[], emphasisLine: number = -1, selectionRange: Range | undefined = this._lastSelection) {\n\t\tconst model = editor.getModel();\n\t\tif (!model) {\n\t\t\treturn;\n\t\t}\n\n\t\t// If there's still a selection, use that.\n\t\temphasisLine = this._lastSelectionCursor ?? emphasisLine;\n\n\t\tconst commentingRangeDecorations: CommentingRangeDecoration[] = [];\n\t\tfor (const info of commentInfos) {\n\t\t\tinfo.commentingRanges.ranges.forEach(range => {\n\t\t\t\tconst rangeObject = new Range(range.startLineNumber, range.startColumn, range.endLineNumber, range.endColumn);\n\t\t\t\tlet intersectingSelectionRange = selectionRange ? rangeObject.intersectRanges(selectionRange) : undefined;\n\t\t\t\tif ((selectionRange && (emphasisLine >= 0) && intersectingSelectionRange)\n\t\t\t\t\t// If there's only one selection line, then just drop into the else if and show an emphasis line.\n\t\t\t\t\t&& !((intersectingSelectionRange.startLineNumber === intersectingSelectionRange.endLineNumber)\n\t\t\t\t\t\t&& (emphasisLine === intersectingSelectionRange.startLineNumber))) {\n\t\t\t\t\t// The emphasisLine should be within the commenting range, even if the selection range stretches\n\t\t\t\t\t// outside of the commenting range.\n\t\t\t\t\t// Clip the emphasis and selection ranges to the commenting range\n\t\t\t\t\tlet intersectingEmphasisRange: Range;\n\t\t\t\t\tif (emphasisLine <= intersectingSelectionRange.startLineNumber) {\n\t\t\t\t\t\tintersectingEmphasisRange = intersectingSelectionRange.collapseToStart();\n\t\t\t\t\t\tintersectingSelectionRange = new Range(intersectingSelectionRange.startLineNumber + 1, 1, intersectingSelectionRange.endLineNumber, 1);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tintersectingEmphasisRange = new Range(intersectingSelectionRange.endLineNumber, 1, intersectingSelectionRange.endLineNumber, 1);\n\t\t\t\t\t\tintersectingSelectionRange = new Range(intersectingSelectionRange.startLineNumber, 1, intersectingSelectionRange.endLineNumber - 1, 1);\n\t\t\t\t\t}\n\t\t\t\t\tcommentingRangeDecorations.push(new CommentingRangeDecoration(editor, info.uniqueOwner, info.extensionId, info.label, intersectingSelectionRange, this.multilineDecorationOptions, info.commentingRanges, true));\n\n\t\t\t\t\tif (!this._lineHasThread(editor, intersectingEmphasisRange)) {\n\t\t\t\t\t\tcommentingRangeDecorations.push(new CommentingRangeDecoration(editor, info.uniqueOwner, info.extensionId, info.label, intersectingEmphasisRange, this.hoverDecorationOptions, info.commentingRanges, true));\n\t\t\t\t\t}\n\n\t\t\t\t\tconst beforeRangeEndLine = Math.min(intersectingEmphasisRange.startLineNumber, intersectingSelectionRange.startLineNumber) - 1;\n\t\t\t\t\tconst hasBeforeRange = rangeObject.startLineNumber <= beforeRangeEndLine;\n\t\t\t\t\tconst afterRangeStartLine = Math.max(intersectingEmphasisRange.endLineNumber, intersectingSelectionRange.endLineNumber) + 1;\n\t\t\t\t\tconst hasAfterRange = rangeObject.endLineNumber >= afterRangeStartLine;\n\t\t\t\t\tif (hasBeforeRange) {\n\t\t\t\t\t\tconst beforeRange = new Range(range.startLineNumber, 1, beforeRangeEndLine, 1);\n\t\t\t\t\t\tcommentingRangeDecorations.push(new CommentingRangeDecoration(editor, info.uniqueOwner, info.extensionId, info.label, beforeRange, this.decorationOptions, info.commentingRanges, true));\n\t\t\t\t\t}\n\t\t\t\t\tif (hasAfterRange) {\n\t\t\t\t\t\tconst afterRange = new Range(afterRangeStartLine, 1, range.endLineNumber, 1);\n\t\t\t\t\t\tcommentingRangeDecorations.push(new CommentingRangeDecoration(editor, info.uniqueOwner, info.extensionId, info.label, afterRange, this.decorationOptions, info.commentingRanges, true));\n\t\t\t\t\t}\n\t\t\t\t} else if ((rangeObject.startLineNumber <= emphasisLine) && (emphasisLine <= rangeObject.endLineNumber)) {\n\t\t\t\t\tif (rangeObject.startLineNumber < emphasisLine) {\n\t\t\t\t\t\tconst beforeRange = new Range(range.startLineNumber, 1, emphasisLine - 1, 1);\n\t\t\t\t\t\tcommentingRangeDecorations.push(new CommentingRangeDecoration(editor, info.uniqueOwner, info.extensionId, info.label, beforeRange, this.decorationOptions, info.commentingRanges, true));\n\t\t\t\t\t}\n\t\t\t\t\tconst emphasisRange = new Range(emphasisLine, 1, emphasisLine, 1);\n\t\t\t\t\tif (!this._lineHasThread(editor, emphasisRange)) {\n\t\t\t\t\t\tcommentingRangeDecorations.push(new CommentingRangeDecoration(editor, info.uniqueOwner, info.extensionId, info.label, emphasisRange, this.hoverDecorationOptions, info.commentingRanges, true));\n\t\t\t\t\t}\n\t\t\t\t\tif (emphasisLine < rangeObject.endLineNumber) {\n\t\t\t\t\t\tconst afterRange = new Range(emphasisLine + 1, 1, range.endLineNumber, 1);\n\t\t\t\t\t\tcommentingRangeDecorations.push(new CommentingRangeDecoration(editor, info.uniqueOwner, info.extensionId, info.label, afterRange, this.decorationOptions, info.commentingRanges, true));\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tcommentingRangeDecorations.push(new CommentingRangeDecoration(editor, info.uniqueOwner, info.extensionId, info.label, range, this.decorationOptions, info.commentingRanges));\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\teditor.changeDecorations((accessor) => {\n\t\t\tthis.decorationIds = accessor.deltaDecorations(this.decorationIds, commentingRangeDecorations);\n\t\t\tcommentingRangeDecorations.forEach((decoration, index) => decoration.id = this.decorationIds[index]);\n\t\t});\n\n\t\tconst rangesDifference = this.commentingRangeDecorations.length - commentingRangeDecorations.length;\n\t\tthis.commentingRangeDecorations = commentingRangeDecorations;\n\t\tif (rangesDifference) {\n\t\t\tthis._onDidChangeDecorationsCount.fire(this.commentingRangeDecorations.length);\n\t\t}\n\t}\n\n\tprivate areRangesIntersectingOrTouchingByLine(a: Range, b: Range) {\n\t\t// Check if `a` is before `b`\n\t\tif (a.endLineNumber < (b.startLineNumber - 1)) {\n\t\t\treturn false;\n\t\t}\n\n\t\t// Check if `b` is before `a`\n\t\tif ((b.endLineNumber + 1) < a.startLineNumber) {\n\t\t\treturn false;\n\t\t}\n\n\t\t// These ranges must intersect\n\t\treturn true;\n\t}\n\n\tpublic getMatchedCommentAction(commentRange: Range | undefined): MergedCommentRangeActions[] {\n\t\tif (commentRange === undefined) {\n\t\t\tconst foundInfos = this._infos?.filter(info => info.commentingRanges.fileComments);\n\t\t\tif (foundInfos) {\n\t\t\t\treturn foundInfos.map(foundInfo => {\n\t\t\t\t\treturn {\n\t\t\t\t\t\taction: {\n\t\t\t\t\t\t\townerId: foundInfo.uniqueOwner,\n\t\t\t\t\t\t\textensionId: foundInfo.extensionId,\n\t\t\t\t\t\t\tlabel: foundInfo.label,\n\t\t\t\t\t\t\tcommentingRangesInfo: foundInfo.commentingRanges\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\t\t\t\t});\n\t\t\t}\n\t\t\treturn [];\n\t\t}\n\n\t\t// keys is ownerId\n\t\tconst foundHoverActions = new Map<string, { range: Range; action: CommentRangeAction }>();\n\t\tfor (const decoration of this.commentingRangeDecorations) {\n\t\t\tconst range = decoration.getActiveRange();\n\t\t\tif (range && this.areRangesIntersectingOrTouchingByLine(range, commentRange)) {\n\t\t\t\t// We can have several commenting ranges that match from the same uniqueOwner because of how\n\t\t\t\t// the line hover and selection decoration is done.\n\t\t\t\t// The ranges must be merged so that we can see if the new commentRange fits within them.\n\t\t\t\tconst action = decoration.getCommentAction();\n\t\t\t\tconst alreadyFoundInfo = foundHoverActions.get(action.ownerId);\n\t\t\t\tif (alreadyFoundInfo?.action.commentingRangesInfo === action.commentingRangesInfo) {\n\t\t\t\t\t// Merge ranges.\n\t\t\t\t\tconst newRange = new Range(\n\t\t\t\t\t\trange.startLineNumber < alreadyFoundInfo.range.startLineNumber ? range.startLineNumber : alreadyFoundInfo.range.startLineNumber,\n\t\t\t\t\t\trange.startColumn < alreadyFoundInfo.range.startColumn ? range.startColumn : alreadyFoundInfo.range.startColumn,\n\t\t\t\t\t\trange.endLineNumber > alreadyFoundInfo.range.endLineNumber ? range.endLineNumber : alreadyFoundInfo.range.endLineNumber,\n\t\t\t\t\t\trange.endColumn > alreadyFoundInfo.range.endColumn ? range.endColumn : alreadyFoundInfo.range.endColumn\n\t\t\t\t\t);\n\t\t\t\t\tfoundHoverActions.set(action.ownerId, { range: newRange, action });\n\t\t\t\t} else {\n\t\t\t\t\tfoundHoverActions.set(action.ownerId, { range, action });\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tconst seenOwners = new Set<string>();\n\t\treturn Array.from(foundHoverActions.values()).filter(action => {\n\t\t\tif (seenOwners.has(action.action.ownerId)) {\n\t\t\t\treturn false;\n\t\t\t} else {\n\t\t\t\tseenOwners.add(action.action.ownerId);\n\t\t\t\treturn true;\n\t\t\t}\n\t\t});\n\t}\n\n\tpublic getNearestCommentingRange(findPosition: Position, reverse?: boolean): Range | undefined {\n\t\tlet findPositionContainedWithin: Range | undefined;\n\t\tlet decorations: CommentingRangeDecoration[];\n\t\tif (reverse) {\n\t\t\tdecorations = [];\n\t\t\tfor (let i = this.commentingRangeDecorations.length - 1; i >= 0; i--) {\n\t\t\t\tdecorations.push(this.commentingRangeDecorations[i]);\n\t\t\t}\n\t\t} else {\n\t\t\tdecorations = this.commentingRangeDecorations;\n\t\t}\n\t\tfor (const decoration of decorations) {\n\t\t\tconst range = decoration.getActiveRange();\n\t\t\tif (!range) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif (findPositionContainedWithin && this.areRangesIntersectingOrTouchingByLine(range, findPositionContainedWithin)) {\n\t\t\t\tfindPositionContainedWithin = Range.plusRange(findPositionContainedWithin, range);\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif (range.startLineNumber <= findPosition.lineNumber && findPosition.lineNumber <= range.endLineNumber) {\n\t\t\t\tfindPositionContainedWithin = new Range(range.startLineNumber, range.startColumn, range.endLineNumber, range.endColumn);\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif (!reverse && range.endLineNumber < findPosition.lineNumber) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif (reverse && range.startLineNumber > findPosition.lineNumber) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\treturn range;\n\t\t}\n\t\treturn (decorations.length > 0 ? (decorations[0].getActiveRange() ?? undefined) : undefined);\n\t}\n\n\tpublic dispose(): void {\n\t\tthis.commentingRangeDecorations = [];\n\t}\n}\n\n/**\n* Navigate to the next or previous comment in the current thread.\n* @param type\n*/\nexport function moveToNextCommentInThread(commentInfo: { thread: languages.CommentThread<IRange>; comment?: languages.Comment } | undefined, type: 'next' | 'previous') {\n\tif (!commentInfo?.comment || !commentInfo?.thread?.comments) {\n\t\treturn;\n\t}\n\tconst currentIndex = commentInfo.thread.comments?.indexOf(commentInfo.comment);\n\tif (currentIndex === undefined || currentIndex < 0) {\n\t\treturn;\n\t}\n\tif (type === 'previous' && currentIndex === 0) {\n\t\treturn;\n\t}\n\tif (type === 'next' && currentIndex === commentInfo.thread.comments.length - 1) {\n\t\treturn;\n\t}\n\tconst comment = commentInfo.thread.comments?.[type === 'previous' ? currentIndex - 1 : currentIndex + 1];\n\tif (!comment) {\n\t\treturn;\n\t}\n\treturn {\n\t\t...commentInfo,\n\t\tcomment,\n\t};\n}\n\nexport function revealCommentThread(commentService: ICommentService, editorService: IEditorService, uriIdentityService: IUriIdentityService,\n\tcommentThread: languages.CommentThread<IRange>, comment: languages.Comment | undefined, focusReply?: boolean, pinned?: boolean, preserveFocus?: boolean, sideBySide?: boolean): void {\n\tif (!commentThread.resource) {\n\t\treturn;\n\t}\n\tif (!commentService.isCommentingEnabled) {\n\t\tcommentService.enableCommenting(true);\n\t}\n\n\tconst range = commentThread.range;\n\tconst focus = focusReply ? CommentWidgetFocus.Editor : (preserveFocus ? CommentWidgetFocus.None : CommentWidgetFocus.Widget);\n\n\tconst activeEditor = editorService.activeTextEditorControl;\n\t// If the active editor is a diff editor where one of the sides has the comment,\n\t// then we try to reveal the comment in the diff editor.\n\tconst currentActiveResources: IEditor[] = isDiffEditor(activeEditor) ? [activeEditor.getOriginalEditor(), activeEditor.getModifiedEditor()]\n\t\t: (activeEditor ? [activeEditor] : []);\n\tconst threadToReveal = commentThread.threadId;\n\tconst commentToReveal = comment?.uniqueIdInThread;\n\tconst resource = URI.parse(commentThread.resource);\n\n\tfor (const editor of currentActiveResources) {\n\t\tconst model = editor.getModel();\n\t\tif ((model instanceof TextModel) && uriIdentityService.extUri.isEqual(resource, model.uri)) {\n\n\t\t\tif (threadToReveal && isCodeEditor(editor)) {\n\t\t\t\tconst controller = CommentController.get(editor);\n\t\t\t\tcontroller?.revealCommentThread(threadToReveal, commentToReveal, true, focus);\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\t}\n\n\teditorService.openEditor({\n\t\tresource,\n\t\toptions: {\n\t\t\tpinned: pinned,\n\t\t\tpreserveFocus: preserveFocus,\n\t\t\tselection: range ?? new Range(1, 1, 1, 1)\n\t\t}\n\t}, sideBySide ? SIDE_GROUP : ACTIVE_GROUP).then(editor => {\n\t\tif (editor) {\n\t\t\tconst control = editor.getControl();\n\t\t\tif (threadToReveal && isCodeEditor(control)) {\n\t\t\t\tconst controller = CommentController.get(control);\n\t\t\t\tcontroller?.revealCommentThread(threadToReveal, commentToReveal, true, focus);\n\t\t\t}\n\t\t}\n\t});\n}\n\nexport class CommentController implements IEditorContribution {\n\tprivate readonly globalToDispose = new DisposableStore();\n\tprivate readonly localToDispose = new DisposableStore();\n\tprivate editor: ICodeEditor | undefined;\n\tprivate _commentWidgets: ReviewZoneWidget[];\n\tprivate _commentInfos: ICommentInfo[];\n\tprivate _commentingRangeDecorator!: CommentingRangeDecorator;\n\tprivate _commentThreadRangeDecorator!: CommentThreadRangeDecorator;\n\tprivate mouseDownInfo: { lineNumber: number } | null = null;\n\tprivate _commentingRangeSpaceReserved = false;\n\tprivate _commentingRangeAmountReserved = 0;\n\tprivate _computePromise: CancelablePromise<Array<ICommentInfo | null>> | null;\n\tprivate _computeAndSetPromise: Promise<void> | undefined;\n\tprivate _addInProgress!: boolean;\n\tprivate _emptyThreadsToAddQueue: [Range | undefined, IEditorMouseEvent | undefined][] = [];\n\tprivate _computeCommentingRangeScheduler!: Delayer<Array<ICommentInfo | null>> | null;\n\tprivate _pendingNewCommentCache: { [key: string]: { [key: string]: languages.PendingComment } };\n\tprivate _pendingEditsCache: { [key: string]: { [key: string]: { [key: number]: languages.PendingComment } } }; // uniqueOwner -> threadId -> uniqueIdInThread -> pending comment\n\tprivate _inProcessContinueOnComments: Map<string, languages.PendingCommentThread[]> = new Map();\n\tprivate _editorDisposables: IDisposable[] = [];\n\tprivate _activeCursorHasCommentingRange: IContextKey<boolean>;\n\tprivate _activeCursorHasComment: IContextKey<boolean>;\n\tprivate _activeEditorHasCommentingRange: IContextKey<boolean>;\n\tprivate _hasRespondedToEditorChange: boolean = false;\n\n\tconstructor(\n\t\teditor: ICodeEditor,\n\t\t@ICommentService private readonly commentService: ICommentService,\n\t\t@IInstantiationService private readonly instantiationService: IInstantiationService,\n\t\t@ICodeEditorService private readonly codeEditorService: ICodeEditorService,\n\t\t@IContextMenuService private readonly contextMenuService: IContextMenuService,\n\t\t@IQuickInputService private readonly quickInputService: IQuickInputService,\n\t\t@IViewsService private readonly viewsService: IViewsService,\n\t\t@IConfigurationService private readonly configurationService: IConfigurationService,\n\t\t@IContextKeyService contextKeyService: IContextKeyService,\n\t\t@IEditorService private readonly editorService: IEditorService,\n\t\t@IKeybindingService private readonly keybindingService: IKeybindingService,\n\t\t@IAccessibilityService private readonly accessibilityService: IAccessibilityService,\n\t\t@INotificationService private readonly notificationService: INotificationService\n\t) {\n\t\tthis._commentInfos = [];\n\t\tthis._commentWidgets = [];\n\t\tthis._pendingNewCommentCache = {};\n\t\tthis._pendingEditsCache = {};\n\t\tthis._computePromise = null;\n\t\tthis._activeCursorHasCommentingRange = CommentContextKeys.activeCursorHasCommentingRange.bindTo(contextKeyService);\n\t\tthis._activeCursorHasComment = CommentContextKeys.activeCursorHasComment.bindTo(contextKeyService);\n\t\tthis._activeEditorHasCommentingRange = CommentContextKeys.activeEditorHasCommentingRange.bindTo(contextKeyService);\n\n\t\tif (editor instanceof EmbeddedCodeEditorWidget) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.editor = editor;\n\n\t\tthis._commentingRangeDecorator = new CommentingRangeDecorator();\n\t\tthis.globalToDispose.add(this._commentingRangeDecorator.onDidChangeDecorationsCount(count => {\n\t\t\tif (count === 0) {\n\t\t\t\tthis.clearEditorListeners();\n\t\t\t} else if (this._editorDisposables.length === 0) {\n\t\t\t\tthis.registerEditorListeners();\n\t\t\t}\n\t\t}));\n\n\t\tthis.globalToDispose.add(this._commentThreadRangeDecorator = new CommentThreadRangeDecorator(this.commentService));\n\n\t\tthis.globalToDispose.add(this.commentService.onDidDeleteDataProvider(ownerId => {\n\t\t\tif (ownerId) {\n\t\t\t\tdelete this._pendingNewCommentCache[ownerId];\n\t\t\t\tdelete this._pendingEditsCache[ownerId];\n\t\t\t} else {\n\t\t\t\tthis._pendingNewCommentCache = {};\n\t\t\t\tthis._pendingEditsCache = {};\n\t\t\t}\n\t\t\tthis.beginCompute();\n\t\t}));\n\t\tthis.globalToDispose.add(this.commentService.onDidSetDataProvider(_ => this.beginComputeAndHandleEditorChange()));\n\t\tthis.globalToDispose.add(this.commentService.onDidUpdateCommentingRanges(_ => this.beginComputeAndHandleEditorChange()));\n\n\t\tthis.globalToDispose.add(this.commentService.onDidSetResourceCommentInfos(async e => {\n\t\t\tconst editorURI = this.editor && this.editor.hasModel() && this.editor.getModel().uri;\n\t\t\tif (editorURI && editorURI.toString() === e.resource.toString()) {\n\t\t\t\tawait this.setComments(e.commentInfos.filter(commentInfo => commentInfo !== null));\n\t\t\t}\n\t\t}));\n\n\t\tthis.globalToDispose.add(this.commentService.onDidChangeCommentingEnabled(e => {\n\t\t\tif (e) {\n\t\t\t\tthis.registerEditorListeners();\n\t\t\t\tthis.beginCompute();\n\t\t\t} else {\n\t\t\t\tthis.tryUpdateReservedSpace();\n\t\t\t\tthis.clearEditorListeners();\n\t\t\t\tthis._commentingRangeDecorator.update(this.editor, []);\n\t\t\t\tthis._commentThreadRangeDecorator.update(this.editor, []);\n\t\t\t\tdispose(this._commentWidgets);\n\t\t\t\tthis._commentWidgets = [];\n\t\t\t}\n\t\t}));\n\n\t\tthis.globalToDispose.add(this.editor.onWillChangeModel(e => this.onWillChangeModel(e)));\n\t\tthis.globalToDispose.add(this.editor.onDidChangeModel(_ => this.onModelChanged()));\n\t\tthis.globalToDispose.add(this.configurationService.onDidChangeConfiguration(e => {\n\t\t\tif (e.affectsConfiguration('diffEditor.renderSideBySide')) {\n\t\t\t\tthis.beginCompute();\n\t\t\t}\n\t\t}));\n\n\t\tthis.onModelChanged();\n\t\tthis.codeEditorService.registerDecorationType('comment-controller', COMMENTEDITOR_DECORATION_KEY, {});\n\t\tthis.globalToDispose.add(\n\t\t\tthis.commentService.registerContinueOnCommentProvider({\n\t\t\t\tprovideContinueOnComments: () => {\n\t\t\t\t\tconst pendingComments: languages.PendingCommentThread[] = [];\n\t\t\t\t\tif (this._commentWidgets) {\n\t\t\t\t\t\tfor (const zone of this._commentWidgets) {\n\t\t\t\t\t\t\tconst zonePendingComments = zone.getPendingComments();\n\t\t\t\t\t\t\tconst pendingNewComment = zonePendingComments.newComment;\n\t\t\t\t\t\t\tif (!pendingNewComment) {\n\t\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tlet lastCommentBody;\n\t\t\t\t\t\t\tif (zone.commentThread.comments && zone.commentThread.comments.length) {\n\t\t\t\t\t\t\t\tconst lastComment = zone.commentThread.comments[zone.commentThread.comments.length - 1];\n\t\t\t\t\t\t\t\tif (typeof lastComment.body === 'string') {\n\t\t\t\t\t\t\t\t\tlastCommentBody = lastComment.body;\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tlastCommentBody = lastComment.body.value;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (pendingNewComment.body !== lastCommentBody) {\n\t\t\t\t\t\t\t\tpendingComments.push({\n\t\t\t\t\t\t\t\t\tuniqueOwner: zone.uniqueOwner,\n\t\t\t\t\t\t\t\t\turi: zone.editor.getModel()!.uri,\n\t\t\t\t\t\t\t\t\trange: zone.commentThread.range,\n\t\t\t\t\t\t\t\t\tcomment: pendingNewComment,\n\t\t\t\t\t\t\t\t\tisReply: (zone.commentThread.comments !== undefined) && (zone.commentThread.comments.length > 0)\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\treturn pendingComments;\n\t\t\t\t}\n\t\t\t})\n\t\t);\n\n\t}\n\n\tprivate registerEditorListeners() {\n\t\tthis._editorDisposables = [];\n\t\tif (!this.editor) {\n\t\t\treturn;\n\t\t}\n\t\tthis._editorDisposables.push(this.editor.onMouseMove(e => this.onEditorMouseMove(e)));\n\t\tthis._editorDisposables.push(this.editor.onMouseLeave(() => this.onEditorMouseLeave()));\n\t\tthis._editorDisposables.push(this.editor.onDidChangeCursorPosition(e => this.onEditorChangeCursorPosition(e.position)));\n\t\tthis._editorDisposables.push(this.editor.onDidFocusEditorWidget(() => this.onEditorChangeCursorPosition(this.editor?.getPosition() ?? null)));\n\t\tthis._editorDisposables.push(this.editor.onDidChangeCursorSelection(e => this.onEditorChangeCursorSelection(e)));\n\t\tthis._editorDisposables.push(this.editor.onDidBlurEditorWidget(() => this.onEditorChangeCursorSelection()));\n\t}\n\n\tprivate clearEditorListeners() {\n\t\tdispose(this._editorDisposables);\n\t\tthis._editorDisposables = [];\n\t}\n\n\tprivate onEditorMouseLeave() {\n\t\tthis._commentingRangeDecorator.updateHover();\n\t}\n\n\tprivate onEditorMouseMove(e: IEditorMouseEvent): void {\n\t\tconst position = e.target.position?.lineNumber;\n\t\tif (e.event.leftButton.valueOf() && position && this.mouseDownInfo) {\n\t\t\tthis._commentingRangeDecorator.updateSelection(position, new Range(this.mouseDownInfo.lineNumber, 1, position, 1));\n\t\t} else {\n\t\t\tthis._commentingRangeDecorator.updateHover(position);\n\t\t}\n\t}\n\n\tprivate onEditorChangeCursorSelection(e?: ICursorSelectionChangedEvent): void {\n\t\tconst position = this.editor?.getPosition()?.lineNumber;\n\t\tif (position) {\n\t\t\tthis._commentingRangeDecorator.updateSelection(position, e?.selection);\n\t\t}\n\t}\n\n\tprivate onEditorChangeCursorPosition(e: Position | null) {\n\t\tif (!e) {\n\t\t\treturn;\n\t\t}\n\t\tconst range = Range.fromPositions(e, { column: -1, lineNumber: e.lineNumber });\n\t\tconst decorations = this.editor?.getDecorationsInRange(range);\n\t\tlet hasCommentingRange = false;\n\t\tif (decorations) {\n\t\t\tfor (const decoration of decorations) {\n\t\t\t\tif (decoration.options.description === CommentGlyphWidget.description) {\n\t\t\t\t\t// We don't allow multiple comments on the same line.\n\t\t\t\t\thasCommentingRange = false;\n\t\t\t\t\tbreak;\n\t\t\t\t} else if (decoration.options.description === CommentingRangeDecorator.description) {\n\t\t\t\t\thasCommentingRange = true;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tthis._activeCursorHasCommentingRange.set(hasCommentingRange);\n\t\tthis._activeCursorHasComment.set(this.getCommentsAtLine(range).length > 0);\n\t}\n\n\tprivate isEditorInlineOriginal(testEditor: ICodeEditor): boolean {\n\t\tif (this.configurationService.getValue<boolean>('diffEditor.renderSideBySide')) {\n\t\t\treturn false;\n\t\t}\n\n\t\tconst foundEditor = this.editorService.visibleTextEditorControls.find(editor => {\n\t\t\tif (editor.getEditorType() === EditorType.IDiffEditor) {\n\t\t\t\tconst diffEditor = editor as IDiffEditor;\n\t\t\t\treturn diffEditor.getOriginalEditor() === testEditor;\n\t\t\t}\n\t\t\treturn false;\n\t\t});\n\t\treturn !!foundEditor;\n\t}\n\n\tprivate beginCompute(): Promise<void> {\n\t\tthis._computePromise = createCancelablePromise(token => {\n\t\t\tconst editorURI = this.editor && this.editor.hasModel() && this.editor.getModel().uri;\n\n\t\t\tif (editorURI) {\n\t\t\t\treturn this.commentService.getDocumentComments(editorURI);\n\t\t\t}\n\n\t\t\treturn Promise.resolve([]);\n\t\t});\n\n\t\tthis._computeAndSetPromise = this._computePromise.then(async commentInfos => {\n\t\t\tawait this.setComments(coalesce(commentInfos));\n\t\t\tthis._computePromise = null;\n\t\t}, error => console.log(error));\n\t\tthis._computePromise.then(() => this._computeAndSetPromise = undefined);\n\t\treturn this._computeAndSetPromise;\n\t}\n\n\tprivate beginComputeCommentingRanges() {\n\t\tif (this._computeCommentingRangeScheduler) {\n\t\t\tthis._computeCommentingRangeScheduler.trigger(() => {\n\t\t\t\tconst editorURI = this.editor && this.editor.hasModel() && this.editor.getModel().uri;\n\n\t\t\t\tif (editorURI) {\n\t\t\t\t\treturn this.commentService.getDocumentComments(editorURI);\n\t\t\t\t}\n\n\t\t\t\treturn Promise.resolve([]);\n\t\t\t}).then(commentInfos => {\n\t\t\t\tif (this.commentService.isCommentingEnabled) {\n\t\t\t\t\tconst meaningfulCommentInfos = coalesce(commentInfos);\n\t\t\t\t\tthis._commentingRangeDecorator.update(this.editor, meaningfulCommentInfos, this.editor?.getPosition()?.lineNumber, this.editor?.getSelection() ?? undefined);\n\t\t\t\t}\n\t\t\t}, (err) => {\n\t\t\t\tonUnexpectedError(err);\n\t\t\t\treturn null;\n\t\t\t});\n\t\t}\n\t}\n\n\tpublic static get(editor: ICodeEditor): CommentController | null {\n\t\treturn editor.getContribution<CommentController>(ID);\n\t}\n\n\tpublic revealCommentThread(threadId: string, commentUniqueId: number | undefined, fetchOnceIfNotExist: boolean, focus: CommentWidgetFocus): void {\n\t\tconst commentThreadWidget = this._commentWidgets.filter(widget => widget.commentThread.threadId === threadId);\n\t\tif (commentThreadWidget.length === 1) {\n\t\t\tcommentThreadWidget[0].reveal(commentUniqueId, focus);\n\t\t} else if (fetchOnceIfNotExist) {\n\t\t\tif (this._computeAndSetPromise) {\n\t\t\t\tthis._computeAndSetPromise.then(_ => {\n\t\t\t\t\tthis.revealCommentThread(threadId, commentUniqueId, false, focus);\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tthis.beginCompute().then(_ => {\n\t\t\t\t\tthis.revealCommentThread(threadId, commentUniqueId, false, focus);\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n\n\tpublic collapseAll(): void {\n\t\tfor (const widget of this._commentWidgets) {\n\t\t\twidget.collapse(true);\n\t\t}\n\t}\n\n\tpublic expandAll(): void {\n\t\tfor (const widget of this._commentWidgets) {\n\t\t\twidget.expand();\n\t\t}\n\t}\n\n\tpublic expandUnresolved(): void {\n\t\tfor (const widget of this._commentWidgets) {\n\t\t\tif (widget.commentThread.state === languages.CommentThreadState.Unresolved) {\n\t\t\t\twidget.expand();\n\t\t\t}\n\t\t}\n\t}\n\n\tpublic nextCommentThread(focusThread: boolean): void {\n\t\tthis._findNearestCommentThread(focusThread);\n\t}\n\n\tprivate _findNearestCommentThread(focusThread: boolean, reverse?: boolean): void {\n\t\tif (!this._commentWidgets.length || !this.editor?.hasModel()) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst after = reverse ? this.editor.getSelection().getStartPosition() : this.editor.getSelection().getEndPosition();\n\t\tconst sortedWidgets = this._commentWidgets.sort((a, b) => {\n\t\t\tif (reverse) {\n\t\t\t\tconst temp = a;\n\t\t\t\ta = b;\n\t\t\t\tb = temp;\n\t\t\t}\n\t\t\tif (a.commentThread.range === undefined) {\n\t\t\t\treturn -1;\n\t\t\t}\n\t\t\tif (b.commentThread.range === undefined) {\n\t\t\t\treturn 1;\n\t\t\t}\n\t\t\tif (a.commentThread.range.startLineNumber < b.commentThread.range.startLineNumber) {\n\t\t\t\treturn -1;\n\t\t\t}\n\n\t\t\tif (a.commentThread.range.startLineNumber > b.commentThread.range.startLineNumber) {\n\t\t\t\treturn 1;\n\t\t\t}\n\n\t\t\tif (a.commentThread.range.startColumn < b.commentThread.range.startColumn) {\n\t\t\t\treturn -1;\n\t\t\t}\n\n\t\t\tif (a.commentThread.range.startColumn > b.commentThread.range.startColumn) {\n\t\t\t\treturn 1;\n\t\t\t}\n\n\t\t\treturn 0;\n\t\t});\n\n\t\tconst idx = findFirstIdxMonotonousOrArrLen(sortedWidgets, widget => {\n\t\t\tconst lineValueOne = reverse ? after.lineNumber : (widget.commentThread.range?.startLineNumber ?? 0);\n\t\t\tconst lineValueTwo = reverse ? (widget.commentThread.range?.startLineNumber ?? 0) : after.lineNumber;\n\t\t\tconst columnValueOne = reverse ? after.column : (widget.commentThread.range?.startColumn ?? 0);\n\t\t\tconst columnValueTwo = reverse ? (widget.commentThread.range?.startColumn ?? 0) : after.column;\n\t\t\tif (lineValueOne > lineValueTwo) {\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tif (lineValueOne < lineValueTwo) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif (columnValueOne > columnValueTwo) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\treturn false;\n\t\t});\n\n\t\tconst nextWidget: ReviewZoneWidget | undefined = sortedWidgets[idx];\n\t\tif (nextWidget !== undefined) {\n\t\t\tthis.editor.setSelection(nextWidget.commentThread.range ?? new Range(1, 1, 1, 1));\n\t\t\tnextWidget.reveal(undefined, focusThread ? CommentWidgetFocus.Widget : CommentWidgetFocus.None);\n\t\t}\n\t}\n\n\tpublic previousCommentThread(focusThread: boolean): void {\n\t\tthis._findNearestCommentThread(focusThread, true);\n\t}\n\n\tprivate _findNearestCommentingRange(reverse?: boolean): void {\n\t\tif (!this.editor?.hasModel()) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst after = this.editor.getSelection().getEndPosition();\n\t\tconst range = this._commentingRangeDecorator.getNearestCommentingRange(after, reverse);\n\t\tif (range) {\n\t\t\tconst position = reverse ? range.getEndPosition() : range.getStartPosition();\n\t\t\tthis.editor.setPosition(position);\n\t\t\tthis.editor.revealLineInCenterIfOutsideViewport(position.lineNumber);\n\t\t}\n\t\tif (this.accessibilityService.isScreenReaderOptimized()) {\n\t\t\tconst commentRangeStart = range?.getStartPosition().lineNumber;\n\t\t\tconst commentRangeEnd = range?.getEndPosition().lineNumber;\n\t\t\tif (commentRangeStart && commentRangeEnd) {\n\t\t\t\tconst oneLine = commentRangeStart === commentRangeEnd;\n\t\t\t\toneLine ? status(nls.localize('commentRange', \"Line {0}\", commentRangeStart)) : status(nls.localize('commentRangeStart', \"Lines {0} to {1}\", commentRangeStart, commentRangeEnd));\n\t\t\t}\n\t\t}\n\t}\n\n\tpublic nextCommentingRange(): void {\n\t\tthis._findNearestCommentingRange();\n\t}\n\n\tpublic previousCommentingRange(): void {\n\t\tthis._findNearestCommentingRange(true);\n\t}\n\n\tpublic dispose(): void {\n\t\tthis.globalToDispose.dispose();\n\t\tthis.localToDispose.dispose();\n\t\tdispose(this._editorDisposables);\n\t\tdispose(this._commentWidgets);\n\n\t\tthis.editor = null!; // Strict null override - nulling out in dispose\n\t}\n\n\tprivate onWillChangeModel(e: IModelChangedEvent): void {\n\t\tif (e.newModelUrl) {\n\t\t\tthis.tryUpdateReservedSpace(e.newModelUrl);\n\t\t}\n\t}\n\n\tprivate async handleCommentAdded(editorId: string | undefined, uniqueOwner: string, thread: languages.AddedCommentThread): Promise<void> {\n\t\tconst matchedZones = this._commentWidgets.filter(zoneWidget => zoneWidget.uniqueOwner === uniqueOwner && zoneWidget.commentThread.threadId === thread.threadId);\n\t\tif (matchedZones.length) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst matchedNewCommentThreadZones = this._commentWidgets.filter(zoneWidget => zoneWidget.uniqueOwner === uniqueOwner && zoneWidget.commentThread.commentThreadHandle === -1 && Range.equalsRange(zoneWidget.commentThread.range, thread.range));\n\n\t\tif (matchedNewCommentThreadZones.length) {\n\t\t\tmatchedNewCommentThreadZones[0].update(thread);\n\t\t\treturn;\n\t\t}\n\n\t\tconst continueOnCommentIndex = this._inProcessContinueOnComments.get(uniqueOwner)?.findIndex(pending => {\n\t\t\tif (pending.range === undefined) {\n\t\t\t\treturn thread.range === undefined;\n\t\t\t} else {\n\t\t\t\treturn Range.lift(pending.range).equalsRange(thread.range);\n\t\t\t}\n\t\t});\n\t\tlet continueOnCommentText: string | undefined;\n\t\tif ((continueOnCommentIndex !== undefined) && continueOnCommentIndex >= 0) {\n\t\t\tcontinueOnCommentText = this._inProcessContinueOnComments.get(uniqueOwner)?.splice(continueOnCommentIndex, 1)[0].comment.body;\n\t\t}\n\n\t\tconst pendingCommentText = (this._pendingNewCommentCache[uniqueOwner] && this._pendingNewCommentCache[uniqueOwner][thread.threadId])\n\t\t\t?? continueOnCommentText;\n\t\tconst pendingEdits = this._pendingEditsCache[uniqueOwner] && this._pendingEditsCache[uniqueOwner][thread.threadId];\n\t\tconst shouldReveal = thread.canReply && thread.isTemplate && (!thread.comments || (thread.comments.length === 0)) && (!thread.editorId || (thread.editorId === editorId));\n\t\tawait this.displayCommentThread(uniqueOwner, thread, shouldReveal, pendingCommentText, pendingEdits);\n\t\tthis._commentInfos.filter(info => info.uniqueOwner === uniqueOwner)[0].threads.push(thread);\n\t\tthis.tryUpdateReservedSpace();\n\t}\n\n\tpublic onModelChanged(): void {\n\t\tthis.localToDispose.clear();\n\t\tthis.tryUpdateReservedSpace();\n\n\t\tthis.removeCommentWidgetsAndStoreCache();\n\t\tif (!this.editor) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._hasRespondedToEditorChange = false;\n\n\t\tthis.localToDispose.add(this.editor.onMouseDown(e => this.onEditorMouseDown(e)));\n\t\tthis.localToDispose.add(this.editor.onMouseUp(e => this.onEditorMouseUp(e)));\n\t\tif (this._editorDisposables.length) {\n\t\t\tthis.clearEditorListeners();\n\t\t\tthis.registerEditorListeners();\n\t\t}\n\n\t\tthis._computeCommentingRangeScheduler = new Delayer<ICommentInfo[]>(200);\n\t\tthis.localToDispose.add({\n\t\t\tdispose: () => {\n\t\t\t\tthis._computeCommentingRangeScheduler?.cancel();\n\t\t\t\tthis._computeCommentingRangeScheduler = null;\n\t\t\t}\n\t\t});\n\t\tthis.localToDispose.add(this.editor.onDidChangeModelContent(async () => {\n\t\t\tthis.beginComputeCommentingRanges();\n\t\t}));\n\t\tthis.localToDispose.add(this.commentService.onDidUpdateCommentThreads(async e => {\n\t\t\tconst editorURI = this.editor && this.editor.hasModel() && this.editor.getModel().uri;\n\t\t\tif (!editorURI || !this.commentService.isCommentingEnabled) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (this._computePromise) {\n\t\t\t\tawait this._computePromise;\n\t\t\t}\n\n\t\t\tconst commentInfo = this._commentInfos.filter(info => info.uniqueOwner === e.uniqueOwner);\n\t\t\tif (!commentInfo || !commentInfo.length) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst added = e.added.filter(thread => thread.resource && thread.resource === editorURI.toString());\n\t\t\tconst removed = e.removed.filter(thread => thread.resource && thread.resource === editorURI.toString());\n\t\t\tconst changed = e.changed.filter(thread => thread.resource && thread.resource === editorURI.toString());\n\t\t\tconst pending = e.pending.filter(pending => pending.uri.toString() === editorURI.toString());\n\n\t\t\tremoved.forEach(thread => {\n\t\t\t\tconst matchedZones = this._commentWidgets.filter(zoneWidget => zoneWidget.uniqueOwner === e.uniqueOwner && zoneWidget.commentThread.threadId === thread.threadId && zoneWidget.commentThread.threadId !== '');\n\t\t\t\tif (matchedZones.length) {\n\t\t\t\t\tconst matchedZone = matchedZones[0];\n\t\t\t\t\tconst index = this._commentWidgets.indexOf(matchedZone);\n\t\t\t\t\tthis._commentWidgets.splice(index, 1);\n\t\t\t\t\tmatchedZone.dispose();\n\t\t\t\t}\n\t\t\t\tconst infosThreads = this._commentInfos.filter(info => info.uniqueOwner === e.uniqueOwner)[0].threads;\n\t\t\t\tfor (let i = 0; i < infosThreads.length; i++) {\n\t\t\t\t\tif (infosThreads[i] === thread) {\n\t\t\t\t\t\tinfosThreads.splice(i, 1);\n\t\t\t\t\t\ti--;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tfor (const thread of changed) {\n\t\t\t\tconst matchedZones = this._commentWidgets.filter(zoneWidget => zoneWidget.uniqueOwner === e.uniqueOwner && zoneWidget.commentThread.threadId === thread.threadId);\n\t\t\t\tif (matchedZones.length) {\n\t\t\t\t\tconst matchedZone = matchedZones[0];\n\t\t\t\t\tmatchedZone.update(thread);\n\t\t\t\t\tthis.openCommentsView(thread);\n\t\t\t\t}\n\t\t\t}\n\t\t\tconst editorId = this.editor?.getId();\n\t\t\tfor (const thread of added) {\n\t\t\t\tawait this.handleCommentAdded(editorId, e.uniqueOwner, thread);\n\t\t\t}\n\n\t\t\tfor (const thread of pending) {\n\t\t\t\tawait this.resumePendingComment(editorURI, thread);\n\t\t\t}\n\t\t\tthis._commentThreadRangeDecorator.update(this.editor, commentInfo);\n\t\t}));\n\n\t\tthis.beginComputeAndHandleEditorChange();\n\t}\n\n\tprivate async resumePendingComment(editorURI: URI, thread: languages.PendingCommentThread) {\n\t\tconst matchedZones = this._commentWidgets.filter(zoneWidget => zoneWidget.uniqueOwner === thread.uniqueOwner && Range.lift(zoneWidget.commentThread.range)?.equalsRange(thread.range));\n\t\tif (thread.isReply && matchedZones.length) {\n\t\t\tthis.commentService.removeContinueOnComment({ uniqueOwner: thread.uniqueOwner, uri: editorURI, range: thread.range, isReply: true });\n\t\t\tmatchedZones[0].setPendingComment(thread.comment);\n\t\t} else if (matchedZones.length) {\n\t\t\tthis.commentService.removeContinueOnComment({ uniqueOwner: thread.uniqueOwner, uri: editorURI, range: thread.range, isReply: false });\n\t\t\tconst existingPendingComment = matchedZones[0].getPendingComments().newComment;\n\t\t\t// We need to try to reconcile the existing pending comment with the incoming pending comment\n\t\t\tlet pendingComment: languages.PendingComment;\n\t\t\tif (!existingPendingComment || thread.comment.body.includes(existingPendingComment.body)) {\n\t\t\t\tpendingComment = thread.comment;\n\t\t\t} else if (existingPendingComment.body.includes(thread.comment.body)) {\n\t\t\t\tpendingComment = existingPendingComment;\n\t\t\t} else {\n\t\t\t\tpendingComment = { body: `${existingPendingComment}\\n${thread.comment.body}`, cursor: thread.comment.cursor };\n\t\t\t}\n\t\t\tmatchedZones[0].setPendingComment(pendingComment);\n\t\t} else if (!thread.isReply) {\n\t\t\tconst threadStillAvailable = this.commentService.removeContinueOnComment({ uniqueOwner: thread.uniqueOwner, uri: editorURI, range: thread.range, isReply: false });\n\t\t\tif (!threadStillAvailable) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (!this._inProcessContinueOnComments.has(thread.uniqueOwner)) {\n\t\t\t\tthis._inProcessContinueOnComments.set(thread.uniqueOwner, []);\n\t\t\t}\n\t\t\tthis._inProcessContinueOnComments.get(thread.uniqueOwner)?.push(thread);\n\t\t\tawait this.commentService.createCommentThreadTemplate(thread.uniqueOwner, thread.uri, thread.range ? Range.lift(thread.range) : undefined);\n\t\t}\n\t}\n\n\tprivate beginComputeAndHandleEditorChange(): void {\n\t\tthis.beginCompute().then(() => {\n\t\t\tif (!this._hasRespondedToEditorChange) {\n\t\t\t\tif (this._commentInfos.some(commentInfo => commentInfo.commentingRanges.ranges.length > 0 || commentInfo.commentingRanges.fileComments)) {\n\t\t\t\t\tthis._hasRespondedToEditorChange = true;\n\t\t\t\t\tconst verbose = this.configurationService.getValue(AccessibilityVerbositySettingId.Comments);\n\t\t\t\t\tif (verbose) {\n\t\t\t\t\t\tconst keybinding = this.keybindingService.lookupKeybinding(AccessibilityCommandId.OpenAccessibilityHelp)?.getAriaLabel();\n\t\t\t\t\t\tif (keybinding) {\n\t\t\t\t\t\t\tstatus(nls.localize('hasCommentRangesKb', \"Editor has commenting ranges, run the command Open Accessibility Help ({0}), for more information.\", keybinding));\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tstatus(nls.localize('hasCommentRangesNoKb', \"Editor has commenting ranges, run the command Open Accessibility Help, which is currently not triggerable via keybinding, for more information.\"));\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tstatus(nls.localize('hasCommentRanges', \"Editor has commenting ranges.\"));\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\tprivate async openCommentsView(thread: languages.CommentThread) {\n\t\tif (thread.comments && (thread.comments.length > 0) && threadHasMeaningfulComments(thread)) {\n\t\t\tconst openViewState = this.configurationService.getValue<ICommentsConfiguration>(COMMENTS_SECTION).openView;\n\t\t\tif (openViewState === 'file') {\n\t\t\t\treturn this.viewsService.openView(COMMENTS_VIEW_ID);\n\t\t\t} else if (openViewState === 'firstFile' || (openViewState === 'firstFileUnresolved' && thread.state === languages.CommentThreadState.Unresolved)) {\n\t\t\t\tconst hasShownView = this.viewsService.getViewWithId<CommentsPanel>(COMMENTS_VIEW_ID)?.hasRendered;\n\t\t\t\tif (!hasShownView) {\n\t\t\t\t\treturn this.viewsService.openView(COMMENTS_VIEW_ID);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn undefined;\n\t}\n\n\tprivate async displayCommentThread(uniqueOwner: string, thread: languages.CommentThread, shouldReveal: boolean, pendingComment: languages.PendingComment | undefined, pendingEdits: { [key: number]: languages.PendingComment } | undefined): Promise<void> {\n\t\tconst editor = this.editor?.getModel();\n\t\tif (!editor) {\n\t\t\treturn;\n\t\t}\n\t\tif (!this.editor || this.isEditorInlineOriginal(this.editor)) {\n\t\t\treturn;\n\t\t}\n\n\t\tlet continueOnCommentReply: languages.PendingCommentThread | undefined;\n\t\tif (thread.range && !pendingComment) {\n\t\t\tcontinueOnCommentReply = this.commentService.removeContinueOnComment({ uniqueOwner, uri: editor.uri, range: thread.range, isReply: true });\n\t\t}\n\t\tconst zoneWidget = this.instantiationService.createInstance(ReviewZoneWidget, this.editor, uniqueOwner, thread, pendingComment ?? continueOnCommentReply?.comment, pendingEdits);\n\t\tawait zoneWidget.display(thread.range, shouldReveal);\n\t\tthis._commentWidgets.push(zoneWidget);\n\t\tthis.openCommentsView(thread);\n\t}\n\n\tprivate onEditorMouseDown(e: IEditorMouseEvent): void {\n\t\tthis.mouseDownInfo = (e.target.element?.className.indexOf('comment-range-glyph') ?? -1) >= 0 ? parseMouseDownInfoFromEvent(e) : null;\n\t}\n\n\tprivate onEditorMouseUp(e: IEditorMouseEvent): void {\n\t\tconst matchedLineNumber = isMouseUpEventDragFromMouseDown(this.mouseDownInfo, e);\n\t\tthis.mouseDownInfo = null;\n\n\t\tif (!this.editor || matchedLineNumber === null || !e.target.element) {\n\t\t\treturn;\n\t\t}\n\t\tconst mouseUpIsOnDecorator = (e.target.element.className.indexOf('comment-range-glyph') >= 0);\n\n\t\tconst lineNumber = e.target.position!.lineNumber;\n\t\tlet range: Range | undefined;\n\t\tlet selection: Range | null | undefined;\n\t\t// Check for drag along gutter decoration\n\t\tif ((matchedLineNumber !== lineNumber)) {\n\t\t\tif (matchedLineNumber > lineNumber) {\n\t\t\t\tselection = new Range(matchedLineNumber, this.editor.getModel()!.getLineLength(matchedLineNumber) + 1, lineNumber, 1);\n\t\t\t} else {\n\t\t\t\tselection = new Range(matchedLineNumber, 1, lineNumber, this.editor.getModel()!.getLineLength(lineNumber) + 1);\n\t\t\t}\n\t\t} else if (mouseUpIsOnDecorator) {\n\t\t\tselection = this.editor.getSelection();\n\t\t}\n\n\t\t// Check for selection at line number.\n\t\tif (selection && (selection.startLineNumber <= lineNumber) && (lineNumber <= selection.endLineNumber)) {\n\t\t\trange = selection;\n\t\t\tthis.editor.setSelection(new Range(selection.endLineNumber, 1, selection.endLineNumber, 1));\n\t\t} else if (mouseUpIsOnDecorator) {\n\t\t\trange = new Range(lineNumber, 1, lineNumber, 1);\n\t\t}\n\n\t\tif (range) {\n\t\t\tthis.addOrToggleCommentAtLine(range, e);\n\t\t}\n\t}\n\n\tpublic getCommentsAtLine(commentRange: Range | undefined): ReviewZoneWidget[] {\n\t\treturn this._commentWidgets.filter(widget => widget.getGlyphPosition() === (commentRange ? commentRange.endLineNumber : 0));\n\t}\n\n\tpublic async addOrToggleCommentAtLine(commentRange: Range | undefined, e: IEditorMouseEvent | undefined): Promise<void> {\n\t\t// If an add is already in progress, queue the next add and process it after the current one finishes to\n\t\t// prevent empty comment threads from being added to the same line.\n\t\tif (!this._addInProgress) {\n\t\t\tthis._addInProgress = true;\n\t\t\t// The widget's position is undefined until the widget has been displayed, so rely on the glyph position instead\n\t\t\tconst existingCommentsAtLine = this.getCommentsAtLine(commentRange);\n\t\t\tif (existingCommentsAtLine.length) {\n\t\t\t\tconst allExpanded = existingCommentsAtLine.every(widget => widget.expanded);\n\t\t\t\texistingCommentsAtLine.forEach(allExpanded ? widget => widget.collapse(true) : widget => widget.expand(true));\n\t\t\t\tthis.processNextThreadToAdd();\n\t\t\t\treturn;\n\t\t\t} else {\n\t\t\t\tthis.addCommentAtLine(commentRange, e);\n\t\t\t}\n\t\t} else {\n\t\t\tthis._emptyThreadsToAddQueue.push([commentRange, e]);\n\t\t}\n\t}\n\n\tprivate processNextThreadToAdd(): void {\n\t\tthis._addInProgress = false;\n\t\tconst info = this._emptyThreadsToAddQueue.shift();\n\t\tif (info) {\n\t\t\tthis.addOrToggleCommentAtLine(info[0], info[1]);\n\t\t}\n\t}\n\n\tprivate clipUserRangeToCommentRange(userRange: Range, commentRange: Range): Range {\n\t\tif (userRange.startLineNumber < commentRange.startLineNumber) {\n\t\t\tuserRange = new Range(commentRange.startLineNumber, commentRange.startColumn, userRange.endLineNumber, userRange.endColumn);\n\t\t}\n\t\tif (userRange.endLineNumber > commentRange.endLineNumber) {\n\t\t\tuserRange = new Range(userRange.startLineNumber, userRange.startColumn, commentRange.endLineNumber, commentRange.endColumn);\n\t\t}\n\t\treturn userRange;\n\t}\n\n\tpublic addCommentAtLine(range: Range | undefined, e: IEditorMouseEvent | undefined): Promise<void> {\n\t\tconst newCommentInfos = this._commentingRangeDecorator.getMatchedCommentAction(range);\n\t\tif (!newCommentInfos.length || !this.editor?.hasModel()) {\n\t\t\tthis._addInProgress = false;\n\t\t\tif (!newCommentInfos.length) {\n\t\t\t\tif (range) {\n\t\t\t\t\tthis.notificationService.error(nls.localize('comments.addCommand.error', \"The cursor must be within a commenting range to add a comment.\"));\n\t\t\t\t} else {\n\t\t\t\t\tthis.notificationService.error(nls.localize('comments.addFileCommentCommand.error', \"File comments are not allowed on this file.\"));\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn Promise.resolve();\n\t\t}\n\n\t\tif (newCommentInfos.length > 1) {\n\t\t\tif (e && range) {\n\t\t\t\tthis.contextMenuService.showContextMenu({\n\t\t\t\t\tgetAnchor: () => e.event,\n\t\t\t\t\tgetActions: () => this.getContextMenuActions(newCommentInfos, range),\n\t\t\t\t\tgetActionsContext: () => newCommentInfos.length ? newCommentInfos[0] : undefined,\n\t\t\t\t\tonHide: () => { this._addInProgress = false; }\n\t\t\t\t});\n\n\t\t\t\treturn Promise.resolve();\n\t\t\t} else {\n\t\t\t\tconst picks = this.getCommentProvidersQuickPicks(newCommentInfos);\n\t\t\t\treturn this.quickInputService.pick(picks, { placeHolder: nls.localize('pickCommentService', \"Select Comment Provider\"), matchOnDescription: true }).then(pick => {\n\t\t\t\t\tif (!pick) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tconst commentInfos = newCommentInfos.filter(info => info.action.ownerId === pick.id);\n\n\t\t\t\t\tif (commentInfos.length) {\n\t\t\t\t\t\tconst { ownerId } = commentInfos[0].action;\n\t\t\t\t\t\tconst clippedRange = range && commentInfos[0].range ? this.clipUserRangeToCommentRange(range, commentInfos[0].range) : range;\n\t\t\t\t\t\tthis.addCommentAtLine2(clippedRange, ownerId);\n\t\t\t\t\t}\n\t\t\t\t}).then(() => {\n\t\t\t\t\tthis._addInProgress = false;\n\t\t\t\t});\n\t\t\t}\n\t\t} else {\n\t\t\tconst { ownerId } = newCommentInfos[0].action;\n\t\t\tconst clippedRange = range && newCommentInfos[0].range ? this.clipUserRangeToCommentRange(range, newCommentInfos[0].range) : range;\n\t\t\tthis.addCommentAtLine2(clippedRange, ownerId);\n\t\t}\n\n\t\treturn Promise.resolve();\n\t}\n\n\tprivate getCommentProvidersQuickPicks(commentInfos: MergedCommentRangeActions[]) {\n\t\tconst picks: QuickPickInput[] = commentInfos.map((commentInfo) => {\n\t\t\tconst { ownerId, extensionId, label } = commentInfo.action;\n\n\t\t\treturn {\n\t\t\t\tlabel: label ?? extensionId ?? ownerId,\n\t\t\t\tid: ownerId\n\t\t\t} satisfies IQuickPickItem;\n\t\t});\n\n\t\treturn picks;\n\t}\n\n\tprivate getContextMenuActions(commentInfos: MergedCommentRangeActions[], commentRange: Range): IAction[] {\n\t\tconst actions: IAction[] = [];\n\n\t\tcommentInfos.forEach(commentInfo => {\n\t\t\tconst { ownerId, extensionId, label } = commentInfo.action;\n\n\t\t\tactions.push(new Action(\n\t\t\t\t'addCommentThread',\n\t\t\t\t`${label || extensionId}`,\n\t\t\t\tundefined,\n\t\t\t\ttrue,\n\t\t\t\t() => {\n\t\t\t\t\tconst clippedRange = commentInfo.range ? this.clipUserRangeToCommentRange(commentRange, commentInfo.range) : commentRange;\n\t\t\t\t\tthis.addCommentAtLine2(clippedRange, ownerId);\n\t\t\t\t\treturn Promise.resolve();\n\t\t\t\t}\n\t\t\t));\n\t\t});\n\t\treturn actions;\n\t}\n\n\tpublic addCommentAtLine2(range: Range | undefined, ownerId: string) {\n\t\tif (!this.editor) {\n\t\t\treturn;\n\t\t}\n\t\tthis.commentService.createCommentThreadTemplate(ownerId, this.editor.getModel()!.uri, range, this.editor.getId());\n\t\tthis.processNextThreadToAdd();\n\t\treturn;\n\t}\n\n\tprivate getExistingCommentEditorOptions(editor: ICodeEditor) {\n\t\tconst lineDecorationsWidth: number = editor.getOption(EditorOption.lineDecorationsWidth);\n\t\tlet extraEditorClassName: string[] = [];\n\t\tconst configuredExtraClassName = editor.getRawOptions().extraEditorClassName;\n\t\tif (configuredExtraClassName) {\n\t\t\textraEditorClassName = configuredExtraClassName.split(' ');\n\t\t}\n\t\treturn { lineDecorationsWidth, extraEditorClassName };\n\t}\n\n\tprivate getWithoutCommentsEditorOptions(editor: ICodeEditor, extraEditorClassName: string[], startingLineDecorationsWidth: number) {\n\t\tlet lineDecorationsWidth = startingLineDecorationsWidth;\n\t\tconst inlineCommentPos = extraEditorClassName.findIndex(name => name === 'inline-comment');\n\t\tif (inlineCommentPos >= 0) {\n\t\t\textraEditorClassName.splice(inlineCommentPos, 1);\n\t\t}\n\n\t\tconst options = editor.getOptions();\n\t\tif (options.get(EditorOption.folding) && options.get(EditorOption.showFoldingControls) !== 'never') {\n\t\t\tlineDecorationsWidth += 11; // 11 comes from https://github.com/microsoft/vscode/blob/94ee5f58619d59170983f453fe78f156c0cc73a3/src/vs/workbench/contrib/comments/browser/media/review.css#L485\n\t\t}\n\t\tlineDecorationsWidth -= 24;\n\t\treturn { extraEditorClassName, lineDecorationsWidth };\n\t}\n\n\tprivate getWithCommentsLineDecorationWidth(editor: ICodeEditor, startingLineDecorationsWidth: number) {\n\t\tlet lineDecorationsWidth = startingLineDecorationsWidth;\n\t\tconst options = editor.getOptions();\n\t\tif (options.get(EditorOption.folding) && options.get(EditorOption.showFoldingControls) !== 'never') {\n\t\t\tlineDecorationsWidth -= 11;\n\t\t}\n\t\tlineDecorationsWidth += 24;\n\t\tthis._commentingRangeAmountReserved = lineDecorationsWidth;\n\t\treturn this._commentingRangeAmountReserved;\n\t}\n\n\tprivate getWithCommentsEditorOptions(editor: ICodeEditor, extraEditorClassName: string[], startingLineDecorationsWidth: number) {\n\t\textraEditorClassName.push('inline-comment');\n\t\treturn { lineDecorationsWidth: this.getWithCommentsLineDecorationWidth(editor, startingLineDecorationsWidth), extraEditorClassName };\n\t}\n\n\tprivate updateEditorLayoutOptions(editor: ICodeEditor, extraEditorClassName: string[], lineDecorationsWidth: number) {\n\t\teditor.updateOptions({\n\t\t\textraEditorClassName: extraEditorClassName.join(' '),\n\t\t\tlineDecorationsWidth: lineDecorationsWidth\n\t\t});\n\t}\n\n\tprivate ensureCommentingRangeReservedAmount(editor: ICodeEditor) {\n\t\tconst existing = this.getExistingCommentEditorOptions(editor);\n\t\tif (existing.lineDecorationsWidth !== this._commentingRangeAmountReserved) {\n\t\t\teditor.updateOptions({\n\t\t\t\tlineDecorationsWidth: this.getWithCommentsLineDecorationWidth(editor, existing.lineDecorationsWidth)\n\t\t\t});\n\t\t}\n\t}\n\n\tprivate tryUpdateReservedSpace(uri?: URI) {\n\t\tif (!this.editor) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst hasCommentsOrRangesInInfo = this._commentInfos.some(info => {\n\t\t\tconst hasRanges = Boolean(info.commentingRanges && (Array.isArray(info.commentingRanges) ? info.commentingRanges : info.commentingRanges.ranges).length);\n\t\t\treturn hasRanges || (info.threads.length > 0);\n\t\t});\n\t\turi = uri ?? this.editor.getModel()?.uri;\n\t\tconst resourceHasCommentingRanges = uri ? this.commentService.resourceHasCommentingRanges(uri) : false;\n\n\t\tconst hasCommentsOrRanges = hasCommentsOrRangesInInfo || resourceHasCommentingRanges;\n\n\t\tif (hasCommentsOrRanges && this.commentService.isCommentingEnabled) {\n\t\t\tif (!this._commentingRangeSpaceReserved) {\n\t\t\t\tthis._commentingRangeSpaceReserved = true;\n\t\t\t\tconst { lineDecorationsWidth, extraEditorClassName } = this.getExistingCommentEditorOptions(this.editor);\n\t\t\t\tconst newOptions = this.getWithCommentsEditorOptions(this.editor, extraEditorClassName, lineDecorationsWidth);\n\t\t\t\tthis.updateEditorLayoutOptions(this.editor, newOptions.extraEditorClassName, newOptions.lineDecorationsWidth);\n\t\t\t} else {\n\t\t\t\tthis.ensureCommentingRangeReservedAmount(this.editor);\n\t\t\t}\n\t\t} else if ((!hasCommentsOrRanges || !this.commentService.isCommentingEnabled) && this._commentingRangeSpaceReserved) {\n\t\t\tthis._commentingRangeSpaceReserved = false;\n\t\t\tconst { lineDecorationsWidth, extraEditorClassName } = this.getExistingCommentEditorOptions(this.editor);\n\t\t\tconst newOptions = this.getWithoutCommentsEditorOptions(this.editor, extraEditorClassName, lineDecorationsWidth);\n\t\t\tthis.updateEditorLayoutOptions(this.editor, newOptions.extraEditorClassName, newOptions.lineDecorationsWidth);\n\t\t}\n\t}\n\n\tprivate async setComments(commentInfos: ICommentInfo[]): Promise<void> {\n\t\tif (!this.editor || !this.commentService.isCommentingEnabled) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._commentInfos = commentInfos;\n\t\tthis.tryUpdateReservedSpace();\n\t\t// create viewzones\n\t\tthis.removeCommentWidgetsAndStoreCache();\n\n\t\tlet hasCommentingRanges = false;\n\t\tfor (const info of this._commentInfos) {\n\t\t\tif (!hasCommentingRanges && (info.commentingRanges.ranges.length > 0 || info.commentingRanges.fileComments)) {\n\t\t\t\thasCommentingRanges = true;\n\t\t\t}\n\n\t\t\tconst providerCacheStore = this._pendingNewCommentCache[info.uniqueOwner];\n\t\t\tconst providerEditsCacheStore = this._pendingEditsCache[info.uniqueOwner];\n\t\t\tinfo.threads = info.threads.filter(thread => !thread.isDisposed);\n\t\t\tfor (const thread of info.threads) {\n\t\t\t\tlet pendingComment: languages.PendingComment | undefined = undefined;\n\t\t\t\tif (providerCacheStore) {\n\t\t\t\t\tpendingComment = providerCacheStore[thread.threadId];\n\t\t\t\t}\n\n\t\t\t\tlet pendingEdits: { [key: number]: languages.PendingComment } | undefined = undefined;\n\t\t\t\tif (providerEditsCacheStore) {\n\t\t\t\t\tpendingEdits = providerEditsCacheStore[thread.threadId];\n\t\t\t\t}\n\n\t\t\t\tawait this.displayCommentThread(info.uniqueOwner, thread, false, pendingComment, pendingEdits);\n\t\t\t}\n\t\t\tfor (const thread of info.pendingCommentThreads ?? []) {\n\t\t\t\tthis.resumePendingComment(this.editor.getModel()!.uri, thread);\n\t\t\t}\n\t\t}\n\n\t\tthis._commentingRangeDecorator.update(this.editor, this._commentInfos);\n\t\tthis._commentThreadRangeDecorator.update(this.editor, this._commentInfos);\n\n\t\tif (hasCommentingRanges) {\n\t\t\tthis._activeEditorHasCommentingRange.set(true);\n\t\t} else {\n\t\t\tthis._activeEditorHasCommentingRange.set(false);\n\t\t}\n\t}\n\n\tpublic collapseAndFocusRange(threadId: string): void {\n\t\tthis._commentWidgets?.find(widget => widget.commentThread.threadId === threadId)?.collapseAndFocusRange();\n\t}\n\n\tprivate removeCommentWidgetsAndStoreCache() {\n\t\tif (this._commentWidgets) {\n\t\t\tthis._commentWidgets.forEach(zone => {\n\t\t\t\tconst pendingComments = zone.getPendingComments();\n\t\t\t\tconst pendingNewComment = pendingComments.newComment;\n\t\t\t\tconst providerNewCommentCacheStore = this._pendingNewCommentCache[zone.uniqueOwner];\n\n\t\t\t\tlet lastCommentBody;\n\t\t\t\tif (zone.commentThread.comments && zone.commentThread.comments.length) {\n\t\t\t\t\tconst lastComment = zone.commentThread.comments[zone.commentThread.comments.length - 1];\n\t\t\t\t\tif (typeof lastComment.body === 'string') {\n\t\t\t\t\t\tlastCommentBody = lastComment.body;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tlastCommentBody = lastComment.body.value;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (pendingNewComment && (pendingNewComment.body !== lastCommentBody)) {\n\t\t\t\t\tif (!providerNewCommentCacheStore) {\n\t\t\t\t\t\tthis._pendingNewCommentCache[zone.uniqueOwner] = {};\n\t\t\t\t\t}\n\n\t\t\t\t\tthis._pendingNewCommentCache[zone.uniqueOwner][zone.commentThread.threadId] = pendingNewComment;\n\t\t\t\t} else {\n\t\t\t\t\tif (providerNewCommentCacheStore) {\n\t\t\t\t\t\tdelete providerNewCommentCacheStore[zone.commentThread.threadId];\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tconst pendingEdits = pendingComments.edits;\n\t\t\t\tconst providerEditsCacheStore = this._pendingEditsCache[zone.uniqueOwner];\n\t\t\t\tif (Object.keys(pendingEdits).length > 0) {\n\t\t\t\t\tif (!providerEditsCacheStore) {\n\t\t\t\t\t\tthis._pendingEditsCache[zone.uniqueOwner] = {};\n\t\t\t\t\t}\n\t\t\t\t\tthis._pendingEditsCache[zone.uniqueOwner][zone.commentThread.threadId] = pendingEdits;\n\t\t\t\t} else if (providerEditsCacheStore) {\n\t\t\t\t\tdelete providerEditsCacheStore[zone.commentThread.threadId];\n\t\t\t\t}\n\n\t\t\t\tzone.dispose();\n\t\t\t});\n\t\t}\n\n\t\tthis._commentWidgets = [];\n\t}\n}\n"]}