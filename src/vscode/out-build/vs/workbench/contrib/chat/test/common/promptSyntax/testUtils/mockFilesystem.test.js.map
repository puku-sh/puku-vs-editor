{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/contrib/chat/test/common/promptSyntax/testUtils/mockFilesystem.test.ts","vs/workbench/contrib/chat/test/common/promptSyntax/testUtils/mockFilesystem.test.ts"],"names":[],"mappings":"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","file":"mockFilesystem.test.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport assert from 'assert';\nimport { mockFiles, MockFilesystem } from './mockFilesystem.js';\nimport { URI } from '../../../../../../../base/common/uri.js';\nimport { Schemas } from '../../../../../../../base/common/network.js';\nimport { assertDefined } from '../../../../../../../base/common/types.js';\nimport { FileService } from '../../../../../../../platform/files/common/fileService.js';\nimport { ILogService, NullLogService } from '../../../../../../../platform/log/common/log.js';\nimport { IFileService, IFileStat } from '../../../../../../../platform/files/common/files.js';\nimport { ensureNoDisposablesAreLeakedInTestSuite } from '../../../../../../../base/test/common/utils.js';\nimport { InMemoryFileSystemProvider } from '../../../../../../../platform/files/common/inMemoryFilesystemProvider.js';\nimport { TestInstantiationService } from '../../../../../../../platform/instantiation/test/common/instantiationServiceMock.js';\n\n/**\n * Base attribute for an expected filesystem node (a file or a folder).\n */\ninterface IExpectedFilesystemNode extends Pick<\n\tIFileStat,\n\t'resource' | 'name' | 'isFile' | 'isDirectory' | 'isSymbolicLink'\n> { }\n\n/**\n * Represents an expected `file` info.\n */\ninterface IExpectedFile extends IExpectedFilesystemNode {\n\t/**\n\t * Expected file contents.\n\t */\n\tcontents: string;\n}\n\n/**\n * Represents an expected `folder` info.\n */\ninterface IExpectedFolder extends IExpectedFilesystemNode {\n\t/**\n\t * Expected folder children.\n\t */\n\tchildren: (IExpectedFolder | IExpectedFile)[];\n}\n\n/**\n * Validates that file at {@link filePath} has expected attributes.\n */\nasync function validateFile(\n\tfilePath: string,\n\texpectedFile: IExpectedFile,\n\tfileService: IFileService,\n) {\n\tlet readFile: IFileStat | undefined;\n\ttry {\n\t\treadFile = await fileService.resolve(URI.file(filePath));\n\t} catch (error) {\n\t\tthrow new Error(`Failed to read file '${filePath}': ${error}.`);\n\t}\n\n\tassert.strictEqual(\n\t\treadFile.name,\n\t\texpectedFile.name,\n\t\t`File '${filePath}' must have correct 'name'.`,\n\t);\n\n\tassert.deepStrictEqual(\n\t\treadFile.resource,\n\t\texpectedFile.resource,\n\t\t`File '${filePath}' must have correct 'URI'.`,\n\t);\n\n\tassert.strictEqual(\n\t\treadFile.isFile,\n\t\texpectedFile.isFile,\n\t\t`File '${filePath}' must have correct 'isFile' value.`,\n\t);\n\n\tassert.strictEqual(\n\t\treadFile.isDirectory,\n\t\texpectedFile.isDirectory,\n\t\t`File '${filePath}' must have correct 'isDirectory' value.`,\n\t);\n\n\tassert.strictEqual(\n\t\treadFile.isSymbolicLink,\n\t\texpectedFile.isSymbolicLink,\n\t\t`File '${filePath}' must have correct 'isSymbolicLink' value.`,\n\t);\n\n\tassert.strictEqual(\n\t\treadFile.children,\n\t\tundefined,\n\t\t`File '${filePath}' must not have children.`,\n\t);\n\n\tconst fileContents = await fileService.readFile(readFile.resource);\n\tassert.strictEqual(\n\t\tfileContents.value.toString(),\n\t\texpectedFile.contents,\n\t\t`File '${expectedFile.resource.fsPath}' must have correct contents.`,\n\t);\n}\n\n/**\n * Validates that folder at {@link folderPath} has expected attributes.\n */\nasync function validateFolder(\n\tfolderPath: string,\n\texpectedFolder: IExpectedFolder,\n\tfileService: IFileService,\n): Promise<void> {\n\tlet readFolder: IFileStat | undefined;\n\ttry {\n\t\treadFolder = await fileService.resolve(URI.file(folderPath));\n\t} catch (error) {\n\t\tthrow new Error(`Failed to read folder '${folderPath}': ${error}.`);\n\t}\n\n\tassert.strictEqual(\n\t\treadFolder.name,\n\t\texpectedFolder.name,\n\t\t`Folder '${folderPath}' must have correct 'name'.`,\n\t);\n\n\tassert.deepStrictEqual(\n\t\treadFolder.resource,\n\t\texpectedFolder.resource,\n\t\t`Folder '${folderPath}' must have correct 'URI'.`,\n\t);\n\n\tassert.strictEqual(\n\t\treadFolder.isFile,\n\t\texpectedFolder.isFile,\n\t\t`Folder '${folderPath}' must have correct 'isFile' value.`,\n\t);\n\n\tassert.strictEqual(\n\t\treadFolder.isDirectory,\n\t\texpectedFolder.isDirectory,\n\t\t`Folder '${folderPath}' must have correct 'isDirectory' value.`,\n\t);\n\n\tassert.strictEqual(\n\t\treadFolder.isSymbolicLink,\n\t\texpectedFolder.isSymbolicLink,\n\t\t`Folder '${folderPath}' must have correct 'isSymbolicLink' value.`,\n\t);\n\n\tassertDefined(\n\t\treadFolder.children,\n\t\t`Folder '${folderPath}' must have children.`,\n\t);\n\n\tassert.strictEqual(\n\t\treadFolder.children.length,\n\t\texpectedFolder.children.length,\n\t\t`Folder '${folderPath}' must have correct number of children.`,\n\t);\n\n\tfor (const expectedChild of expectedFolder.children) {\n\t\tconst childPath = URI.joinPath(expectedFolder.resource, expectedChild.name).fsPath;\n\n\t\tif ('children' in expectedChild) {\n\t\t\tawait validateFolder(\n\t\t\t\tchildPath,\n\t\t\t\texpectedChild,\n\t\t\t\tfileService,\n\t\t\t);\n\n\t\t\tcontinue;\n\t\t}\n\n\t\tawait validateFile(\n\t\t\tchildPath,\n\t\t\texpectedChild,\n\t\t\tfileService,\n\t\t);\n\t}\n}\n\nsuite('MockFilesystem', () => {\n\tconst disposables = ensureNoDisposablesAreLeakedInTestSuite();\n\n\tlet instantiationService: TestInstantiationService;\n\tlet fileService: IFileService;\n\tsetup(async () => {\n\t\tinstantiationService = disposables.add(new TestInstantiationService());\n\t\tinstantiationService.stub(ILogService, new NullLogService());\n\n\t\tfileService = disposables.add(instantiationService.createInstance(FileService));\n\t\tconst fileSystemProvider = disposables.add(new InMemoryFileSystemProvider());\n\t\tdisposables.add(fileService.registerProvider(Schemas.file, fileSystemProvider));\n\n\t\tinstantiationService.stub(IFileService, fileService);\n\t});\n\n\ttest('mocks file structure using new simplified format', async () => {\n\t\tconst mockFilesystem = instantiationService.createInstance(MockFilesystem, [\n\t\t\t{\n\t\t\t\tpath: '/root/folder/file.txt',\n\t\t\t\tcontents: ['contents']\n\t\t\t},\n\t\t\t{\n\t\t\t\tpath: '/root/folder/Subfolder/test.ts',\n\t\t\t\tcontents: ['other contents']\n\t\t\t},\n\t\t\t{\n\t\t\t\tpath: '/root/folder/Subfolder/file.test.ts',\n\t\t\t\tcontents: ['hello test']\n\t\t\t},\n\t\t\t{\n\t\t\t\tpath: '/root/folder/Subfolder/.file-2.TEST.ts',\n\t\t\t\tcontents: ['test hello']\n\t\t\t}\n\t\t]);\n\n\t\tawait mockFilesystem.mock();\n\n\t\t/**\n\t\t * Validate files and folders next.\n\t\t */\n\n\t\tawait validateFolder(\n\t\t\t'/root/folder',\n\t\t\t{\n\t\t\t\tresource: URI.file('/root/folder'),\n\t\t\t\tname: 'folder',\n\t\t\t\tisFile: false,\n\t\t\t\tisDirectory: true,\n\t\t\t\tisSymbolicLink: false,\n\t\t\t\tchildren: [\n\t\t\t\t\t{\n\t\t\t\t\t\tresource: URI.file('/root/folder/file.txt'),\n\t\t\t\t\t\tname: 'file.txt',\n\t\t\t\t\t\tisFile: true,\n\t\t\t\t\t\tisDirectory: false,\n\t\t\t\t\t\tisSymbolicLink: false,\n\t\t\t\t\t\tcontents: 'contents',\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tresource: URI.file('/root/folder/Subfolder'),\n\t\t\t\t\t\tname: 'Subfolder',\n\t\t\t\t\t\tisFile: false,\n\t\t\t\t\t\tisDirectory: true,\n\t\t\t\t\t\tisSymbolicLink: false,\n\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tresource: URI.file('/root/folder/Subfolder/test.ts'),\n\t\t\t\t\t\t\t\tname: 'test.ts',\n\t\t\t\t\t\t\t\tisFile: true,\n\t\t\t\t\t\t\t\tisDirectory: false,\n\t\t\t\t\t\t\t\tisSymbolicLink: false,\n\t\t\t\t\t\t\t\tcontents: 'other contents',\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tresource: URI.file('/root/folder/Subfolder/file.test.ts'),\n\t\t\t\t\t\t\t\tname: 'file.test.ts',\n\t\t\t\t\t\t\t\tisFile: true,\n\t\t\t\t\t\t\t\tisDirectory: false,\n\t\t\t\t\t\t\t\tisSymbolicLink: false,\n\t\t\t\t\t\t\t\tcontents: 'hello test',\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tresource: URI.file('/root/folder/Subfolder/.file-2.TEST.ts'),\n\t\t\t\t\t\t\t\tname: '.file-2.TEST.ts',\n\t\t\t\t\t\t\t\tisFile: true,\n\t\t\t\t\t\t\t\tisDirectory: false,\n\t\t\t\t\t\t\t\tisSymbolicLink: false,\n\t\t\t\t\t\t\t\tcontents: 'test hello',\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t],\n\t\t\t\t\t}\n\t\t\t\t],\n\t\t\t},\n\t\t\tfileService,\n\t\t);\n\t});\n\n\ttest('can be created using static factory method', async () => {\n\t\tawait mockFiles(fileService, [\n\t\t\t{\n\t\t\t\tpath: '/simple/test.txt',\n\t\t\t\tcontents: ['line 1', 'line 2', 'line 3']\n\t\t\t}\n\t\t]);\n\n\t\tawait validateFile(\n\t\t\t'/simple/test.txt',\n\t\t\t{\n\t\t\t\tresource: URI.file('/simple/test.txt'),\n\t\t\t\tname: 'test.txt',\n\t\t\t\tisFile: true,\n\t\t\t\tisDirectory: false,\n\t\t\t\tisSymbolicLink: false,\n\t\t\t\tcontents: 'line 1\\nline 2\\nline 3',\n\t\t\t},\n\t\t\tfileService,\n\t\t);\n\t});\n});\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport assert from 'assert';\nimport { mockFiles, MockFilesystem } from './mockFilesystem.js';\nimport { URI } from '../../../../../../../base/common/uri.js';\nimport { Schemas } from '../../../../../../../base/common/network.js';\nimport { assertDefined } from '../../../../../../../base/common/types.js';\nimport { FileService } from '../../../../../../../platform/files/common/fileService.js';\nimport { ILogService, NullLogService } from '../../../../../../../platform/log/common/log.js';\nimport { IFileService, IFileStat } from '../../../../../../../platform/files/common/files.js';\nimport { ensureNoDisposablesAreLeakedInTestSuite } from '../../../../../../../base/test/common/utils.js';\nimport { InMemoryFileSystemProvider } from '../../../../../../../platform/files/common/inMemoryFilesystemProvider.js';\nimport { TestInstantiationService } from '../../../../../../../platform/instantiation/test/common/instantiationServiceMock.js';\n\n/**\n * Base attribute for an expected filesystem node (a file or a folder).\n */\ninterface IExpectedFilesystemNode extends Pick<\n\tIFileStat,\n\t'resource' | 'name' | 'isFile' | 'isDirectory' | 'isSymbolicLink'\n> { }\n\n/**\n * Represents an expected `file` info.\n */\ninterface IExpectedFile extends IExpectedFilesystemNode {\n\t/**\n\t * Expected file contents.\n\t */\n\tcontents: string;\n}\n\n/**\n * Represents an expected `folder` info.\n */\ninterface IExpectedFolder extends IExpectedFilesystemNode {\n\t/**\n\t * Expected folder children.\n\t */\n\tchildren: (IExpectedFolder | IExpectedFile)[];\n}\n\n/**\n * Validates that file at {@link filePath} has expected attributes.\n */\nasync function validateFile(\n\tfilePath: string,\n\texpectedFile: IExpectedFile,\n\tfileService: IFileService,\n) {\n\tlet readFile: IFileStat | undefined;\n\ttry {\n\t\treadFile = await fileService.resolve(URI.file(filePath));\n\t} catch (error) {\n\t\tthrow new Error(`Failed to read file '${filePath}': ${error}.`);\n\t}\n\n\tassert.strictEqual(\n\t\treadFile.name,\n\t\texpectedFile.name,\n\t\t`File '${filePath}' must have correct 'name'.`,\n\t);\n\n\tassert.deepStrictEqual(\n\t\treadFile.resource,\n\t\texpectedFile.resource,\n\t\t`File '${filePath}' must have correct 'URI'.`,\n\t);\n\n\tassert.strictEqual(\n\t\treadFile.isFile,\n\t\texpectedFile.isFile,\n\t\t`File '${filePath}' must have correct 'isFile' value.`,\n\t);\n\n\tassert.strictEqual(\n\t\treadFile.isDirectory,\n\t\texpectedFile.isDirectory,\n\t\t`File '${filePath}' must have correct 'isDirectory' value.`,\n\t);\n\n\tassert.strictEqual(\n\t\treadFile.isSymbolicLink,\n\t\texpectedFile.isSymbolicLink,\n\t\t`File '${filePath}' must have correct 'isSymbolicLink' value.`,\n\t);\n\n\tassert.strictEqual(\n\t\treadFile.children,\n\t\tundefined,\n\t\t`File '${filePath}' must not have children.`,\n\t);\n\n\tconst fileContents = await fileService.readFile(readFile.resource);\n\tassert.strictEqual(\n\t\tfileContents.value.toString(),\n\t\texpectedFile.contents,\n\t\t`File '${expectedFile.resource.fsPath}' must have correct contents.`,\n\t);\n}\n\n/**\n * Validates that folder at {@link folderPath} has expected attributes.\n */\nasync function validateFolder(\n\tfolderPath: string,\n\texpectedFolder: IExpectedFolder,\n\tfileService: IFileService,\n): Promise<void> {\n\tlet readFolder: IFileStat | undefined;\n\ttry {\n\t\treadFolder = await fileService.resolve(URI.file(folderPath));\n\t} catch (error) {\n\t\tthrow new Error(`Failed to read folder '${folderPath}': ${error}.`);\n\t}\n\n\tassert.strictEqual(\n\t\treadFolder.name,\n\t\texpectedFolder.name,\n\t\t`Folder '${folderPath}' must have correct 'name'.`,\n\t);\n\n\tassert.deepStrictEqual(\n\t\treadFolder.resource,\n\t\texpectedFolder.resource,\n\t\t`Folder '${folderPath}' must have correct 'URI'.`,\n\t);\n\n\tassert.strictEqual(\n\t\treadFolder.isFile,\n\t\texpectedFolder.isFile,\n\t\t`Folder '${folderPath}' must have correct 'isFile' value.`,\n\t);\n\n\tassert.strictEqual(\n\t\treadFolder.isDirectory,\n\t\texpectedFolder.isDirectory,\n\t\t`Folder '${folderPath}' must have correct 'isDirectory' value.`,\n\t);\n\n\tassert.strictEqual(\n\t\treadFolder.isSymbolicLink,\n\t\texpectedFolder.isSymbolicLink,\n\t\t`Folder '${folderPath}' must have correct 'isSymbolicLink' value.`,\n\t);\n\n\tassertDefined(\n\t\treadFolder.children,\n\t\t`Folder '${folderPath}' must have children.`,\n\t);\n\n\tassert.strictEqual(\n\t\treadFolder.children.length,\n\t\texpectedFolder.children.length,\n\t\t`Folder '${folderPath}' must have correct number of children.`,\n\t);\n\n\tfor (const expectedChild of expectedFolder.children) {\n\t\tconst childPath = URI.joinPath(expectedFolder.resource, expectedChild.name).fsPath;\n\n\t\tif ('children' in expectedChild) {\n\t\t\tawait validateFolder(\n\t\t\t\tchildPath,\n\t\t\t\texpectedChild,\n\t\t\t\tfileService,\n\t\t\t);\n\n\t\t\tcontinue;\n\t\t}\n\n\t\tawait validateFile(\n\t\t\tchildPath,\n\t\t\texpectedChild,\n\t\t\tfileService,\n\t\t);\n\t}\n}\n\nsuite('MockFilesystem', () => {\n\tconst disposables = ensureNoDisposablesAreLeakedInTestSuite();\n\n\tlet instantiationService: TestInstantiationService;\n\tlet fileService: IFileService;\n\tsetup(async () => {\n\t\tinstantiationService = disposables.add(new TestInstantiationService());\n\t\tinstantiationService.stub(ILogService, new NullLogService());\n\n\t\tfileService = disposables.add(instantiationService.createInstance(FileService));\n\t\tconst fileSystemProvider = disposables.add(new InMemoryFileSystemProvider());\n\t\tdisposables.add(fileService.registerProvider(Schemas.file, fileSystemProvider));\n\n\t\tinstantiationService.stub(IFileService, fileService);\n\t});\n\n\ttest('mocks file structure using new simplified format', async () => {\n\t\tconst mockFilesystem = instantiationService.createInstance(MockFilesystem, [\n\t\t\t{\n\t\t\t\tpath: '/root/folder/file.txt',\n\t\t\t\tcontents: ['contents']\n\t\t\t},\n\t\t\t{\n\t\t\t\tpath: '/root/folder/Subfolder/test.ts',\n\t\t\t\tcontents: ['other contents']\n\t\t\t},\n\t\t\t{\n\t\t\t\tpath: '/root/folder/Subfolder/file.test.ts',\n\t\t\t\tcontents: ['hello test']\n\t\t\t},\n\t\t\t{\n\t\t\t\tpath: '/root/folder/Subfolder/.file-2.TEST.ts',\n\t\t\t\tcontents: ['test hello']\n\t\t\t}\n\t\t]);\n\n\t\tawait mockFilesystem.mock();\n\n\t\t/**\n\t\t * Validate files and folders next.\n\t\t */\n\n\t\tawait validateFolder(\n\t\t\t'/root/folder',\n\t\t\t{\n\t\t\t\tresource: URI.file('/root/folder'),\n\t\t\t\tname: 'folder',\n\t\t\t\tisFile: false,\n\t\t\t\tisDirectory: true,\n\t\t\t\tisSymbolicLink: false,\n\t\t\t\tchildren: [\n\t\t\t\t\t{\n\t\t\t\t\t\tresource: URI.file('/root/folder/file.txt'),\n\t\t\t\t\t\tname: 'file.txt',\n\t\t\t\t\t\tisFile: true,\n\t\t\t\t\t\tisDirectory: false,\n\t\t\t\t\t\tisSymbolicLink: false,\n\t\t\t\t\t\tcontents: 'contents',\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tresource: URI.file('/root/folder/Subfolder'),\n\t\t\t\t\t\tname: 'Subfolder',\n\t\t\t\t\t\tisFile: false,\n\t\t\t\t\t\tisDirectory: true,\n\t\t\t\t\t\tisSymbolicLink: false,\n\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tresource: URI.file('/root/folder/Subfolder/test.ts'),\n\t\t\t\t\t\t\t\tname: 'test.ts',\n\t\t\t\t\t\t\t\tisFile: true,\n\t\t\t\t\t\t\t\tisDirectory: false,\n\t\t\t\t\t\t\t\tisSymbolicLink: false,\n\t\t\t\t\t\t\t\tcontents: 'other contents',\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tresource: URI.file('/root/folder/Subfolder/file.test.ts'),\n\t\t\t\t\t\t\t\tname: 'file.test.ts',\n\t\t\t\t\t\t\t\tisFile: true,\n\t\t\t\t\t\t\t\tisDirectory: false,\n\t\t\t\t\t\t\t\tisSymbolicLink: false,\n\t\t\t\t\t\t\t\tcontents: 'hello test',\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tresource: URI.file('/root/folder/Subfolder/.file-2.TEST.ts'),\n\t\t\t\t\t\t\t\tname: '.file-2.TEST.ts',\n\t\t\t\t\t\t\t\tisFile: true,\n\t\t\t\t\t\t\t\tisDirectory: false,\n\t\t\t\t\t\t\t\tisSymbolicLink: false,\n\t\t\t\t\t\t\t\tcontents: 'test hello',\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t],\n\t\t\t\t\t}\n\t\t\t\t],\n\t\t\t},\n\t\t\tfileService,\n\t\t);\n\t});\n\n\ttest('can be created using static factory method', async () => {\n\t\tawait mockFiles(fileService, [\n\t\t\t{\n\t\t\t\tpath: '/simple/test.txt',\n\t\t\t\tcontents: ['line 1', 'line 2', 'line 3']\n\t\t\t}\n\t\t]);\n\n\t\tawait validateFile(\n\t\t\t'/simple/test.txt',\n\t\t\t{\n\t\t\t\tresource: URI.file('/simple/test.txt'),\n\t\t\t\tname: 'test.txt',\n\t\t\t\tisFile: true,\n\t\t\t\tisDirectory: false,\n\t\t\t\tisSymbolicLink: false,\n\t\t\t\tcontents: 'line 1\\nline 2\\nline 3',\n\t\t\t},\n\t\t\tfileService,\n\t\t);\n\t});\n});\n"]}