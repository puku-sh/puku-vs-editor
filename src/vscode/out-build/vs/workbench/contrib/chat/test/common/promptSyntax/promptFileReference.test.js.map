{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/contrib/chat/test/common/promptSyntax/promptFileReference.test.ts","vs/workbench/contrib/chat/test/common/promptSyntax/promptFileReference.test.ts"],"names":[],"mappings":"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","file":"promptFileReference.test.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport assert from 'assert';\nimport { Disposable } from '../../../../../../base/common/lifecycle.js';\nimport { URI } from '../../../../../../base/common/uri.js';\nimport { ensureNoDisposablesAreLeakedInTestSuite } from '../../../../../../base/test/common/utils.js';\nimport { Range } from '../../../../../../editor/common/core/range.js';\nimport { ILanguageService } from '../../../../../../editor/common/languages/language.js';\nimport { IModelService } from '../../../../../../editor/common/services/model.js';\nimport { IConfigurationService } from '../../../../../../platform/configuration/common/configuration.js';\nimport { ConfigurationService } from '../../../../../../platform/configuration/common/configurationService.js';\nimport { IFileService } from '../../../../../../platform/files/common/files.js';\nimport { FileService } from '../../../../../../platform/files/common/fileService.js';\nimport { InMemoryFileSystemProvider } from '../../../../../../platform/files/common/inMemoryFilesystemProvider.js';\nimport { IInstantiationService } from '../../../../../../platform/instantiation/common/instantiation.js';\nimport { TestInstantiationService } from '../../../../../../platform/instantiation/test/common/instantiationServiceMock.js';\nimport { ILogService, NullLogService } from '../../../../../../platform/log/common/log.js';\nimport { NullPolicyService } from '../../../../../../platform/policy/common/policy.js';\nimport { ChatModeKind } from '../../../common/constants.js';\nimport { getPromptFileType } from '../../../common/promptSyntax/config/promptFileLocations.js';\nimport { PromptsType } from '../../../common/promptSyntax/promptTypes.js';\nimport { IMockFolder, MockFilesystem } from './testUtils/mockFilesystem.js';\nimport { IBodyFileReference, PromptFileParser } from '../../../common/promptSyntax/promptFileParser.js';\n\n/**\n * Represents a file reference with an expected\n * error condition value for testing purposes.\n */\nclass ExpectedReference {\n\t/**\n\t * URI component of the expected reference.\n\t */\n\tpublic readonly uri: URI;\n\n\tconstructor(\n\t\tdirname: URI,\n\t\tpublic readonly ref: IBodyFileReference,\n\t) {\n\t\tthis.uri = (ref.content.startsWith('/'))\n\t\t\t? URI.file(ref.content)\n\t\t\t: URI.joinPath(dirname, ref.content);\n\t}\n\n\t/**\n\t * Range of the underlying file reference token.\n\t */\n\tpublic get range(): Range {\n\t\treturn this.ref.range;\n\t}\n\n\t/**\n\t * String representation of the expected reference.\n\t */\n\tpublic toString(): string {\n\t\treturn `file-prompt:${this.uri.path}`;\n\t}\n}\n\nfunction toUri(filePath: string): URI {\n\treturn URI.parse('testFs://' + filePath);\n}\n\n/**\n * A reusable test utility to test the `PromptFileReference` class.\n */\nclass TestPromptFileReference extends Disposable {\n\tconstructor(\n\t\tprivate readonly fileStructure: IMockFolder[],\n\t\tprivate readonly rootFileUri: URI,\n\t\tprivate readonly expectedReferences: ExpectedReference[],\n\t\t@IFileService private readonly fileService: IFileService,\n\t\t@IInstantiationService private readonly instantiationService: IInstantiationService,\n\t) {\n\t\tsuper();\n\n\t\t// create in-memory file system\n\t\tconst fileSystemProvider = this._register(new InMemoryFileSystemProvider());\n\t\tthis._register(this.fileService.registerProvider('testFs', fileSystemProvider));\n\t}\n\n\t/**\n\t * Run the test.\n\t */\n\tpublic async run(): Promise<any> {\n\t\t// create the files structure on the disk\n\t\tconst mockFs = this.instantiationService.createInstance(MockFilesystem, this.fileStructure);\n\t\tawait mockFs.mock(toUri('/'));\n\n\t\tconst content = await this.fileService.readFile(this.rootFileUri);\n\n\t\tconst ast = new PromptFileParser().parse(this.rootFileUri, content.value.toString());\n\t\tassert(ast.body, 'Prompt file must have a body');\n\n\t\t// resolve the root file reference including all nested references\n\t\tconst resolvedReferences = ast.body.fileReferences ?? [];\n\n\t\tfor (let i = 0; i < this.expectedReferences.length; i++) {\n\t\t\tconst expectedReference = this.expectedReferences[i];\n\t\t\tconst resolvedReference = resolvedReferences[i];\n\n\t\t\tconst resolvedUri = ast.body.resolveFilePath(resolvedReference.content);\n\n\t\t\tassert.equal(resolvedUri?.fsPath, expectedReference.uri.fsPath);\n\t\t\tassert.deepStrictEqual(resolvedReference.range, expectedReference.range);\n\t\t}\n\n\t\tassert.strictEqual(\n\t\t\tresolvedReferences.length,\n\t\t\tthis.expectedReferences.length,\n\t\t\t[\n\t\t\t\t`\\nExpected(${this.expectedReferences.length}): [\\n ${this.expectedReferences.join('\\n ')}\\n]`,\n\t\t\t\t`Received(${resolvedReferences.length}): [\\n ${resolvedReferences.join('\\n ')}\\n]`,\n\t\t\t].join('\\n'),\n\t\t);\n\n\t\tconst result: any = {};\n\t\tresult.promptType = getPromptFileType(this.rootFileUri);\n\t\tif (ast.header) {\n\t\t\tfor (const key of ['tools', 'model', 'agent', 'applyTo', 'description'] as const) {\n\t\t\t\tif (ast.header[key]) {\n\t\t\t\t\tresult[key] = ast.header[key];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tawait mockFs.delete();\n\n\t\treturn result;\n\t}\n}\n\n/**\n * Create expected file reference for testing purposes.\n *\n * Note! This utility also use for `markdown links` at the moment.\n *\n * @param filePath The expected path of the file reference (without the `#file:` prefix).\n * @param lineNumber The expected line number of the file reference.\n * @param startColumnNumber The expected start column number of the file reference.\n */\nfunction createFileReference(filePath: string, lineNumber: number, startColumnNumber: number): IBodyFileReference {\n\tconst range = new Range(\n\t\tlineNumber,\n\t\tstartColumnNumber + '#file:'.length,\n\t\tlineNumber,\n\t\tstartColumnNumber + '#file:'.length + filePath.length,\n\t);\n\n\treturn {\n\t\trange,\n\t\tcontent: filePath,\n\t\tisMarkdownLink: false,\n\t};\n}\n\nfunction createMarkdownReference(lineNumber: number, startColumnNumber: number, firstSeg: string, secondSeg: string): IBodyFileReference {\n\tconst range = new Range(\n\t\tlineNumber,\n\t\tstartColumnNumber + firstSeg.length + 1,\n\t\tlineNumber,\n\t\tstartColumnNumber + firstSeg.length + secondSeg.length - 1,\n\t);\n\n\treturn {\n\t\trange,\n\t\tcontent: secondSeg.substring(1, secondSeg.length - 1),\n\t\tisMarkdownLink: true,\n\t};\n}\n\nsuite('PromptFileReference', function () {\n\tconst testDisposables = ensureNoDisposablesAreLeakedInTestSuite();\n\n\tlet instantiationService: TestInstantiationService;\n\tsetup(async () => {\n\t\tconst nullPolicyService = new NullPolicyService();\n\t\tconst nullLogService = testDisposables.add(new NullLogService());\n\t\tconst nullFileService = testDisposables.add(new FileService(nullLogService));\n\t\tconst nullConfigService = testDisposables.add(new ConfigurationService(\n\t\t\tURI.file('/config.json'),\n\t\t\tnullFileService,\n\t\t\tnullPolicyService,\n\t\t\tnullLogService,\n\t\t));\n\t\tinstantiationService = testDisposables.add(new TestInstantiationService());\n\n\t\tinstantiationService.stub(IFileService, nullFileService);\n\t\tinstantiationService.stub(ILogService, nullLogService);\n\t\tinstantiationService.stub(IConfigurationService, nullConfigService);\n\t\tinstantiationService.stub(IModelService, { getModel() { return null; } });\n\t\tinstantiationService.stub(ILanguageService, {\n\t\t\tguessLanguageIdByFilepathOrFirstLine(uri: URI) {\n\t\t\t\treturn getPromptFileType(uri) ?? null;\n\t\t\t}\n\t\t});\n\t});\n\n\ttest('resolves nested file references', async function () {\n\t\tconst rootFolderName = 'resolves-nested-file-references';\n\t\tconst rootFolder = `/${rootFolderName}`;\n\t\tconst rootUri = toUri(rootFolder);\n\n\t\tconst test = testDisposables.add(instantiationService.createInstance(TestPromptFileReference,\n\t\t\t/**\n\t\t\t * The file structure to be created on the disk for the test.\n\t\t\t */\n\t\t\t[{\n\t\t\t\tname: rootFolderName,\n\t\t\t\tchildren: [\n\t\t\t\t\t{\n\t\t\t\t\t\tname: 'file1.prompt.md',\n\t\t\t\t\t\tcontents: '## Some Header\\nsome contents\\n ',\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tname: 'file2.prompt.md',\n\t\t\t\t\t\tcontents: '## Files\\n\\t- this file #file:folder1/file3.prompt.md \\n\\t- also this [file4.prompt.md](./folder1/some-other-folder/file4.prompt.md) please!\\n ',\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tname: 'folder1',\n\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tname: 'file3.prompt.md',\n\t\t\t\t\t\t\t\tcontents: `\\n[](./some-other-folder/non-existing-folder)\\n\\t- some seemingly random #file:${rootFolder}/folder1/some-other-folder/yetAnotherFolder五/another-file.prompt.md contents\\n some more\\t content`,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tname: 'some-other-folder',\n\t\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\tname: 'file4.prompt.md',\n\t\t\t\t\t\t\t\t\t\tcontents: 'this file has a non-existing #file:./some-non-existing/file.prompt.md\\t\\treference\\n\\n\\nand some\\n non-prompt #file:./some-non-prompt-file.md\\t\\t \\t[](../../folder1/)\\t',\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\tname: 'file.txt',\n\t\t\t\t\t\t\t\t\t\tcontents: 'contents of a non-prompt-snippet file',\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\tname: 'yetAnotherFolder五',\n\t\t\t\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\t\tname: 'another-file.prompt.md',\n\t\t\t\t\t\t\t\t\t\t\t\tcontents: `[caption](${rootFolder}/folder1/some-other-folder)\\nanother-file.prompt.md contents\\t [#file:file.txt](../file.txt)`,\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\t\tname: 'one_more_file_just_in_case.prompt.md',\n\t\t\t\t\t\t\t\t\t\t\t\tcontents: 'one_more_file_just_in_case.prompt.md contents',\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t],\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t}],\n\t\t\t/**\n\t\t\t * The root file path to start the resolve process from.\n\t\t\t */\n\t\t\ttoUri(`/${rootFolderName}/file2.prompt.md`),\n\t\t\t/**\n\t\t\t * The expected references to be resolved.\n\t\t\t */\n\t\t\t[\n\t\t\t\tnew ExpectedReference(\n\t\t\t\t\trootUri,\n\t\t\t\t\tcreateFileReference('folder1/file3.prompt.md', 2, 14),\n\t\t\t\t),\n\t\t\t\tnew ExpectedReference(\n\t\t\t\t\trootUri,\n\t\t\t\t\tcreateMarkdownReference(\n\t\t\t\t\t\t3, 14,\n\t\t\t\t\t\t'[file4.prompt.md]', '(./folder1/some-other-folder/file4.prompt.md)',\n\t\t\t\t\t),\n\t\t\t\t),\n\t\t\t]\n\t\t));\n\n\t\tawait test.run();\n\t});\n\n\n\tsuite('metadata', () => {\n\t\ttest('tools', async function () {\n\t\t\tconst rootFolderName = 'resolves-nested-file-references';\n\t\t\tconst rootFolder = `/${rootFolderName}`;\n\t\t\tconst rootUri = toUri(rootFolder);\n\n\t\t\tconst test = testDisposables.add(instantiationService.createInstance(TestPromptFileReference,\n\t\t\t\t/**\n\t\t\t\t * The file structure to be created on the disk for the test.\n\t\t\t\t */\n\t\t\t\t[{\n\t\t\t\t\tname: rootFolderName,\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tname: 'file1.prompt.md',\n\t\t\t\t\t\t\tcontents: [\n\t\t\t\t\t\t\t\t'## Some Header',\n\t\t\t\t\t\t\t\t'some contents',\n\t\t\t\t\t\t\t\t' ',\n\t\t\t\t\t\t\t],\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tname: 'file2.prompt.md',\n\t\t\t\t\t\t\tcontents: [\n\t\t\t\t\t\t\t\t'---',\n\t\t\t\t\t\t\t\t'description: \\'Root prompt description.\\'',\n\t\t\t\t\t\t\t\t'tools: [\\'my-tool1\\']',\n\t\t\t\t\t\t\t\t'agent: \"agent\" ',\n\t\t\t\t\t\t\t\t'---',\n\t\t\t\t\t\t\t\t'## Files',\n\t\t\t\t\t\t\t\t'\\t- this file #file:folder1/file3.prompt.md ',\n\t\t\t\t\t\t\t\t'\\t- also this [file4.prompt.md](./folder1/some-other-folder/file4.prompt.md) please!',\n\t\t\t\t\t\t\t\t' ',\n\t\t\t\t\t\t\t],\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tname: 'folder1',\n\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tname: 'file3.prompt.md',\n\t\t\t\t\t\t\t\t\tcontents: [\n\t\t\t\t\t\t\t\t\t\t'---',\n\t\t\t\t\t\t\t\t\t\t'tools: [ false, \\'my-tool1\\' , ]',\n\t\t\t\t\t\t\t\t\t\t'---',\n\t\t\t\t\t\t\t\t\t\t'',\n\t\t\t\t\t\t\t\t\t\t'[](./some-other-folder/non-existing-folder)',\n\t\t\t\t\t\t\t\t\t\t`\\t- some seemingly random #file:${rootFolder}/folder1/some-other-folder/yetAnotherFolder五/another-file.prompt.md contents`,\n\t\t\t\t\t\t\t\t\t\t' some more\\t content',\n\t\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tname: 'some-other-folder',\n\t\t\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\tname: 'file4.prompt.md',\n\t\t\t\t\t\t\t\t\t\t\tcontents: [\n\t\t\t\t\t\t\t\t\t\t\t\t'---',\n\t\t\t\t\t\t\t\t\t\t\t\t'tools: [\\'my-tool1\\', \"my-tool2\", true, , ]',\n\t\t\t\t\t\t\t\t\t\t\t\t'something: true',\n\t\t\t\t\t\t\t\t\t\t\t\t'agent: \\'ask\\'\\t',\n\t\t\t\t\t\t\t\t\t\t\t\t'---',\n\t\t\t\t\t\t\t\t\t\t\t\t'this file has a non-existing #file:./some-non-existing/file.prompt.md\\t\\treference',\n\t\t\t\t\t\t\t\t\t\t\t\t'',\n\t\t\t\t\t\t\t\t\t\t\t\t'',\n\t\t\t\t\t\t\t\t\t\t\t\t'and some',\n\t\t\t\t\t\t\t\t\t\t\t\t' non-prompt #file:./some-non-prompt-file.md\\t\\t \\t[](../../folder1/)\\t',\n\t\t\t\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\tname: 'file.txt',\n\t\t\t\t\t\t\t\t\t\t\tcontents: 'contents of a non-prompt-snippet file',\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\tname: 'yetAnotherFolder五',\n\t\t\t\t\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\t\t\tname: 'another-file.prompt.md',\n\t\t\t\t\t\t\t\t\t\t\t\t\tcontents: [\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t'---',\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t'tools: [\\'my-tool3\\', false, \"my-tool2\" ]',\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t'---',\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t`[](${rootFolder}/folder1/some-other-folder)`,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t'another-file.prompt.md contents\\t [#file:file.txt](../file.txt)',\n\t\t\t\t\t\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\t\t\tname: 'one_more_file_just_in_case.prompt.md',\n\t\t\t\t\t\t\t\t\t\t\t\t\tcontents: 'one_more_file_just_in_case.prompt.md contents',\n\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t],\n\t\t\t\t\t\t},\n\t\t\t\t\t],\n\t\t\t\t}],\n\t\t\t\t/**\n\t\t\t\t * The root file path to start the resolve process from.\n\t\t\t\t */\n\t\t\t\ttoUri(`/${rootFolderName}/file2.prompt.md`),\n\t\t\t\t/**\n\t\t\t\t * The expected references to be resolved.\n\t\t\t\t */\n\t\t\t\t[\n\t\t\t\t\tnew ExpectedReference(\n\t\t\t\t\t\trootUri,\n\t\t\t\t\t\tcreateFileReference('folder1/file3.prompt.md', 7, 14),\n\t\t\t\t\t),\n\t\t\t\t\tnew ExpectedReference(\n\t\t\t\t\t\trootUri,\n\t\t\t\t\t\tcreateMarkdownReference(\n\t\t\t\t\t\t\t8, 14,\n\t\t\t\t\t\t\t'[file4.prompt.md]', '(./folder1/some-other-folder/file4.prompt.md)',\n\t\t\t\t\t\t),\n\t\t\t\t\t),\n\t\t\t\t]\n\t\t\t));\n\n\t\t\tconst metadata = await test.run();\n\n\t\t\tassert.deepStrictEqual(\n\t\t\t\tmetadata,\n\t\t\t\t{\n\t\t\t\t\tpromptType: PromptsType.prompt,\n\t\t\t\t\tagent: 'agent',\n\t\t\t\t\tdescription: 'Root prompt description.',\n\t\t\t\t\ttools: ['my-tool1'],\n\t\t\t\t},\n\t\t\t\t'Must have correct metadata.',\n\t\t\t);\n\n\t\t});\n\n\t\tsuite('applyTo', () => {\n\t\t\ttest('prompt language', async function () {\n\t\t\t\tconst rootFolderName = 'resolves-nested-file-references';\n\t\t\t\tconst rootFolder = `/${rootFolderName}`;\n\t\t\t\tconst rootUri = toUri(rootFolder);\n\n\t\t\t\tconst test = testDisposables.add(instantiationService.createInstance(TestPromptFileReference,\n\t\t\t\t\t/**\n\t\t\t\t\t * The file structure to be created on the disk for the test.\n\t\t\t\t\t */\n\t\t\t\t\t[{\n\t\t\t\t\t\tname: rootFolderName,\n\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tname: 'file1.prompt.md',\n\t\t\t\t\t\t\t\tcontents: [\n\t\t\t\t\t\t\t\t\t'## Some Header',\n\t\t\t\t\t\t\t\t\t'some contents',\n\t\t\t\t\t\t\t\t\t' ',\n\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tname: 'file2.prompt.md',\n\t\t\t\t\t\t\t\tcontents: [\n\t\t\t\t\t\t\t\t\t'---',\n\t\t\t\t\t\t\t\t\t'applyTo: \\'**/*\\'',\n\t\t\t\t\t\t\t\t\t'tools: [ false, \\'my-tool12\\' , ]',\n\t\t\t\t\t\t\t\t\t'description: \\'Description of my prompt.\\'',\n\t\t\t\t\t\t\t\t\t'---',\n\t\t\t\t\t\t\t\t\t'## Files',\n\t\t\t\t\t\t\t\t\t'\\t- this file #file:folder1/file3.prompt.md ',\n\t\t\t\t\t\t\t\t\t'\\t- also this [file4.prompt.md](./folder1/some-other-folder/file4.prompt.md) please!',\n\t\t\t\t\t\t\t\t\t' ',\n\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tname: 'folder1',\n\t\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\tname: 'file3.prompt.md',\n\t\t\t\t\t\t\t\t\t\tcontents: [\n\t\t\t\t\t\t\t\t\t\t\t'---',\n\t\t\t\t\t\t\t\t\t\t\t'tools: [ false, \\'my-tool1\\' , ]',\n\t\t\t\t\t\t\t\t\t\t\t'---',\n\t\t\t\t\t\t\t\t\t\t\t' some more\\t content',\n\t\t\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\tname: 'some-other-folder',\n\t\t\t\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\t\tname: 'file4.prompt.md',\n\t\t\t\t\t\t\t\t\t\t\t\tcontents: [\n\t\t\t\t\t\t\t\t\t\t\t\t\t'---',\n\t\t\t\t\t\t\t\t\t\t\t\t\t'tools: [\\'my-tool1\\', \"my-tool2\", true, , \\'my-tool3\\' , ]',\n\t\t\t\t\t\t\t\t\t\t\t\t\t'something: true',\n\t\t\t\t\t\t\t\t\t\t\t\t\t'agent: \\'agent\\'\\t',\n\t\t\t\t\t\t\t\t\t\t\t\t\t'---',\n\t\t\t\t\t\t\t\t\t\t\t\t\t'',\n\t\t\t\t\t\t\t\t\t\t\t\t\t'',\n\t\t\t\t\t\t\t\t\t\t\t\t\t'and some more content',\n\t\t\t\t\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t],\n\t\t\t\t\t}],\n\t\t\t\t\t/**\n\t\t\t\t\t * The root file path to start the resolve process from.\n\t\t\t\t\t */\n\t\t\t\t\ttoUri(`/${rootFolderName}/file2.prompt.md`),\n\t\t\t\t\t/**\n\t\t\t\t\t * The expected references to be resolved.\n\t\t\t\t\t */\n\t\t\t\t\t[\n\t\t\t\t\t\tnew ExpectedReference(\n\t\t\t\t\t\t\trootUri,\n\t\t\t\t\t\t\tcreateFileReference('folder1/file3.prompt.md', 7, 14),\n\t\t\t\t\t\t),\n\t\t\t\t\t\tnew ExpectedReference(\n\t\t\t\t\t\t\trootUri,\n\t\t\t\t\t\t\tcreateMarkdownReference(\n\t\t\t\t\t\t\t\t8, 14,\n\t\t\t\t\t\t\t\t'[file4.prompt.md]', '(./folder1/some-other-folder/file4.prompt.md)',\n\t\t\t\t\t\t\t),\n\t\t\t\t\t\t),\n\t\t\t\t\t]\n\t\t\t\t));\n\n\t\t\t\tconst metadata = await test.run();\n\n\t\t\t\tassert.deepStrictEqual(\n\t\t\t\t\tmetadata,\n\t\t\t\t\t{\n\t\t\t\t\t\tpromptType: PromptsType.prompt,\n\t\t\t\t\t\tdescription: 'Description of my prompt.',\n\t\t\t\t\t\ttools: ['my-tool12'],\n\t\t\t\t\t\tapplyTo: '**/*',\n\t\t\t\t\t},\n\t\t\t\t\t'Must have correct metadata.',\n\t\t\t\t);\n\n\t\t\t});\n\n\n\t\t\ttest('instructions language', async function () {\n\t\t\t\tconst rootFolderName = 'resolves-nested-file-references';\n\t\t\t\tconst rootFolder = `/${rootFolderName}`;\n\t\t\t\tconst rootUri = toUri(rootFolder);\n\n\t\t\t\tconst test = testDisposables.add(instantiationService.createInstance(TestPromptFileReference,\n\t\t\t\t\t/**\n\t\t\t\t\t * The file structure to be created on the disk for the test.\n\t\t\t\t\t */\n\t\t\t\t\t[{\n\t\t\t\t\t\tname: rootFolderName,\n\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tname: 'file1.prompt.md',\n\t\t\t\t\t\t\t\tcontents: [\n\t\t\t\t\t\t\t\t\t'## Some Header',\n\t\t\t\t\t\t\t\t\t'some contents',\n\t\t\t\t\t\t\t\t\t' ',\n\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tname: 'file2.instructions.md',\n\t\t\t\t\t\t\t\tcontents: [\n\t\t\t\t\t\t\t\t\t'---',\n\t\t\t\t\t\t\t\t\t'applyTo: \\'**/*\\'',\n\t\t\t\t\t\t\t\t\t'tools: [ false, \\'my-tool12\\' , ]',\n\t\t\t\t\t\t\t\t\t'description: \\'Description of my instructions file.\\'',\n\t\t\t\t\t\t\t\t\t'---',\n\t\t\t\t\t\t\t\t\t'## Files',\n\t\t\t\t\t\t\t\t\t'\\t- this file #file:folder1/file3.prompt.md ',\n\t\t\t\t\t\t\t\t\t'\\t- also this [file4.prompt.md](./folder1/some-other-folder/file4.prompt.md) please!',\n\t\t\t\t\t\t\t\t\t' ',\n\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tname: 'folder1',\n\t\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\tname: 'file3.prompt.md',\n\t\t\t\t\t\t\t\t\t\tcontents: [\n\t\t\t\t\t\t\t\t\t\t\t'---',\n\t\t\t\t\t\t\t\t\t\t\t'tools: [ false, \\'my-tool1\\' , ]',\n\t\t\t\t\t\t\t\t\t\t\t'---',\n\t\t\t\t\t\t\t\t\t\t\t' some more\\t content',\n\t\t\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\tname: 'some-other-folder',\n\t\t\t\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\t\tname: 'file4.prompt.md',\n\t\t\t\t\t\t\t\t\t\t\t\tcontents: [\n\t\t\t\t\t\t\t\t\t\t\t\t\t'---',\n\t\t\t\t\t\t\t\t\t\t\t\t\t'tools: [\\'my-tool1\\', \"my-tool2\", true, , \\'my-tool3\\' , ]',\n\t\t\t\t\t\t\t\t\t\t\t\t\t'something: true',\n\t\t\t\t\t\t\t\t\t\t\t\t\t'agent: \\'agent\\'\\t',\n\t\t\t\t\t\t\t\t\t\t\t\t\t'---',\n\t\t\t\t\t\t\t\t\t\t\t\t\t'',\n\t\t\t\t\t\t\t\t\t\t\t\t\t'',\n\t\t\t\t\t\t\t\t\t\t\t\t\t'and some more content',\n\t\t\t\t\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t],\n\t\t\t\t\t}],\n\t\t\t\t\t/**\n\t\t\t\t\t * The root file path to start the resolve process from.\n\t\t\t\t\t */\n\t\t\t\t\ttoUri(`/${rootFolderName}/file2.instructions.md`),\n\t\t\t\t\t/**\n\t\t\t\t\t * The expected references to be resolved.\n\t\t\t\t\t */\n\t\t\t\t\t[\n\t\t\t\t\t\tnew ExpectedReference(\n\t\t\t\t\t\t\trootUri,\n\t\t\t\t\t\t\tcreateFileReference('folder1/file3.prompt.md', 7, 14),\n\t\t\t\t\t\t),\n\t\t\t\t\t\tnew ExpectedReference(\n\t\t\t\t\t\t\trootUri,\n\t\t\t\t\t\t\tcreateMarkdownReference(\n\t\t\t\t\t\t\t\t8, 14,\n\t\t\t\t\t\t\t\t'[file4.prompt.md]', '(./folder1/some-other-folder/file4.prompt.md)',\n\t\t\t\t\t\t\t),\n\t\t\t\t\t\t),\n\t\t\t\t\t]\n\t\t\t\t));\n\n\t\t\t\tconst metadata = await test.run();\n\n\t\t\t\tassert.deepStrictEqual(\n\t\t\t\t\tmetadata,\n\t\t\t\t\t{\n\t\t\t\t\t\tpromptType: PromptsType.instructions,\n\t\t\t\t\t\tapplyTo: '**/*',\n\t\t\t\t\t\tdescription: 'Description of my instructions file.',\n\t\t\t\t\t\ttools: ['my-tool12'],\n\t\t\t\t\t},\n\t\t\t\t\t'Must have correct metadata.',\n\t\t\t\t);\n\t\t\t});\n\t\t});\n\n\t\tsuite('tools and agent compatibility', () => {\n\t\t\ttest('ask agent', async function () {\n\t\t\t\tconst rootFolderName = 'resolves-nested-file-references';\n\t\t\t\tconst rootFolder = `/${rootFolderName}`;\n\t\t\t\tconst rootUri = toUri(rootFolder);\n\n\t\t\t\tconst test = testDisposables.add(instantiationService.createInstance(TestPromptFileReference,\n\t\t\t\t\t/**\n\t\t\t\t\t * The file structure to be created on the disk for the test.\n\t\t\t\t\t */\n\t\t\t\t\t[{\n\t\t\t\t\t\tname: rootFolderName,\n\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tname: 'file1.prompt.md',\n\t\t\t\t\t\t\t\tcontents: [\n\t\t\t\t\t\t\t\t\t'## Some Header',\n\t\t\t\t\t\t\t\t\t'some contents',\n\t\t\t\t\t\t\t\t\t' ',\n\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tname: 'file2.prompt.md',\n\t\t\t\t\t\t\t\tcontents: [\n\t\t\t\t\t\t\t\t\t'---',\n\t\t\t\t\t\t\t\t\t'description: \\'Description of my prompt.\\'',\n\t\t\t\t\t\t\t\t\t'agent: \"ask\" ',\n\t\t\t\t\t\t\t\t\t'---',\n\t\t\t\t\t\t\t\t\t'## Files',\n\t\t\t\t\t\t\t\t\t'\\t- this file #file:folder1/file3.prompt.md ',\n\t\t\t\t\t\t\t\t\t'\\t- also this [file4.prompt.md](./folder1/some-other-folder/file4.prompt.md) please!',\n\t\t\t\t\t\t\t\t\t' ',\n\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tname: 'folder1',\n\t\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\tname: 'file3.prompt.md',\n\t\t\t\t\t\t\t\t\t\tcontents: [\n\t\t\t\t\t\t\t\t\t\t\t'---',\n\t\t\t\t\t\t\t\t\t\t\t'tools: [ false, \\'my-tool1\\' , ]',\n\t\t\t\t\t\t\t\t\t\t\t'agent: \\'agent\\'\\t',\n\t\t\t\t\t\t\t\t\t\t\t'---',\n\t\t\t\t\t\t\t\t\t\t\t' some more\\t content',\n\t\t\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\tname: 'some-other-folder',\n\t\t\t\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\t\tname: 'file4.prompt.md',\n\t\t\t\t\t\t\t\t\t\t\t\tcontents: [\n\t\t\t\t\t\t\t\t\t\t\t\t\t'---',\n\t\t\t\t\t\t\t\t\t\t\t\t\t'tools: [\\'my-tool1\\', \"my-tool2\", true, , ]',\n\t\t\t\t\t\t\t\t\t\t\t\t\t'something: true',\n\t\t\t\t\t\t\t\t\t\t\t\t\t'agent: \\'ask\\'\\t',\n\t\t\t\t\t\t\t\t\t\t\t\t\t'---',\n\t\t\t\t\t\t\t\t\t\t\t\t\t'',\n\t\t\t\t\t\t\t\t\t\t\t\t\t'',\n\t\t\t\t\t\t\t\t\t\t\t\t\t'and some more content',\n\t\t\t\t\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t],\n\t\t\t\t\t}],\n\t\t\t\t\t/**\n\t\t\t\t\t * The root file path to start the resolve process from.\n\t\t\t\t\t */\n\t\t\t\t\ttoUri(`/${rootFolderName}/file2.prompt.md`),\n\t\t\t\t\t/**\n\t\t\t\t\t * The expected references to be resolved.\n\t\t\t\t\t */\n\t\t\t\t\t[\n\t\t\t\t\t\tnew ExpectedReference(\n\t\t\t\t\t\t\trootUri,\n\t\t\t\t\t\t\tcreateFileReference('folder1/file3.prompt.md', 6, 14),\n\t\t\t\t\t\t),\n\t\t\t\t\t\tnew ExpectedReference(\n\t\t\t\t\t\t\trootUri,\n\t\t\t\t\t\t\tcreateMarkdownReference(\n\t\t\t\t\t\t\t\t7, 14,\n\t\t\t\t\t\t\t\t'[file4.prompt.md]', '(./folder1/some-other-folder/file4.prompt.md)',\n\t\t\t\t\t\t\t),\n\t\t\t\t\t\t),\n\t\t\t\t\t]\n\t\t\t\t));\n\n\t\t\t\tconst metadata = await test.run();\n\n\t\t\t\tassert.deepStrictEqual(\n\t\t\t\t\tmetadata,\n\t\t\t\t\t{\n\t\t\t\t\t\tpromptType: PromptsType.prompt,\n\t\t\t\t\t\tagent: ChatModeKind.Ask,\n\t\t\t\t\t\tdescription: 'Description of my prompt.',\n\t\t\t\t\t},\n\t\t\t\t\t'Must have correct metadata.',\n\t\t\t\t);\n\t\t\t});\n\n\t\t\ttest('edit agent', async function () {\n\t\t\t\tconst rootFolderName = 'resolves-nested-file-references';\n\t\t\t\tconst rootFolder = `/${rootFolderName}`;\n\t\t\t\tconst rootUri = toUri(rootFolder);\n\n\t\t\t\tconst test = testDisposables.add(instantiationService.createInstance(TestPromptFileReference,\n\t\t\t\t\t/**\n\t\t\t\t\t * The file structure to be created on the disk for the test.\n\t\t\t\t\t */\n\t\t\t\t\t[{\n\t\t\t\t\t\tname: rootFolderName,\n\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tname: 'file1.prompt.md',\n\t\t\t\t\t\t\t\tcontents: [\n\t\t\t\t\t\t\t\t\t'## Some Header',\n\t\t\t\t\t\t\t\t\t'some contents',\n\t\t\t\t\t\t\t\t\t' ',\n\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tname: 'file2.prompt.md',\n\t\t\t\t\t\t\t\tcontents: [\n\t\t\t\t\t\t\t\t\t'---',\n\t\t\t\t\t\t\t\t\t'description: \\'Description of my prompt.\\'',\n\t\t\t\t\t\t\t\t\t'agent:\\t\\t\"edit\"\\t\\t',\n\t\t\t\t\t\t\t\t\t'---',\n\t\t\t\t\t\t\t\t\t'## Files',\n\t\t\t\t\t\t\t\t\t'\\t- this file #file:folder1/file3.prompt.md ',\n\t\t\t\t\t\t\t\t\t'\\t- also this [file4.prompt.md](./folder1/some-other-folder/file4.prompt.md) please!',\n\t\t\t\t\t\t\t\t\t' ',\n\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tname: 'folder1',\n\t\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\tname: 'file3.prompt.md',\n\t\t\t\t\t\t\t\t\t\tcontents: [\n\t\t\t\t\t\t\t\t\t\t\t'---',\n\t\t\t\t\t\t\t\t\t\t\t'tools: [ false, \\'my-tool1\\' , ]',\n\t\t\t\t\t\t\t\t\t\t\t'---',\n\t\t\t\t\t\t\t\t\t\t\t' some more\\t content',\n\t\t\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\tname: 'some-other-folder',\n\t\t\t\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\t\tname: 'file4.prompt.md',\n\t\t\t\t\t\t\t\t\t\t\t\tcontents: [\n\t\t\t\t\t\t\t\t\t\t\t\t\t'---',\n\t\t\t\t\t\t\t\t\t\t\t\t\t'tools: [\\'my-tool1\\', \"my-tool2\", true, , ]',\n\t\t\t\t\t\t\t\t\t\t\t\t\t'something: true',\n\t\t\t\t\t\t\t\t\t\t\t\t\t'agent: \\'agent\\'\\t',\n\t\t\t\t\t\t\t\t\t\t\t\t\t'---',\n\t\t\t\t\t\t\t\t\t\t\t\t\t'',\n\t\t\t\t\t\t\t\t\t\t\t\t\t'',\n\t\t\t\t\t\t\t\t\t\t\t\t\t'and some more content',\n\t\t\t\t\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t],\n\t\t\t\t\t}],\n\t\t\t\t\t/**\n\t\t\t\t\t * The root file path to start the resolve process from.\n\t\t\t\t\t */\n\t\t\t\t\ttoUri(`/${rootFolderName}/file2.prompt.md`),\n\t\t\t\t\t/**\n\t\t\t\t\t * The expected references to be resolved.\n\t\t\t\t\t */\n\t\t\t\t\t[\n\t\t\t\t\t\tnew ExpectedReference(\n\t\t\t\t\t\t\trootUri,\n\t\t\t\t\t\t\tcreateFileReference('folder1/file3.prompt.md', 6, 14),\n\t\t\t\t\t\t),\n\t\t\t\t\t\tnew ExpectedReference(\n\t\t\t\t\t\t\trootUri,\n\t\t\t\t\t\t\tcreateMarkdownReference(\n\t\t\t\t\t\t\t\t7, 14,\n\t\t\t\t\t\t\t\t'[file4.prompt.md]', '(./folder1/some-other-folder/file4.prompt.md)',\n\t\t\t\t\t\t\t),\n\t\t\t\t\t\t),\n\t\t\t\t\t]\n\t\t\t\t));\n\n\t\t\t\tconst metadata = await test.run();\n\n\t\t\t\tassert.deepStrictEqual(\n\t\t\t\t\tmetadata,\n\t\t\t\t\t{\n\t\t\t\t\t\tpromptType: PromptsType.prompt,\n\t\t\t\t\t\tagent: ChatModeKind.Edit,\n\t\t\t\t\t\tdescription: 'Description of my prompt.',\n\t\t\t\t\t},\n\t\t\t\t\t'Must have correct metadata.',\n\t\t\t\t);\n\n\t\t\t});\n\n\t\t\ttest('agent', async function () {\n\t\t\t\tconst rootFolderName = 'resolves-nested-file-references';\n\t\t\t\tconst rootFolder = `/${rootFolderName}`;\n\t\t\t\tconst rootUri = toUri(rootFolder);\n\n\t\t\t\tconst test = testDisposables.add(instantiationService.createInstance(TestPromptFileReference,\n\t\t\t\t\t/**\n\t\t\t\t\t * The file structure to be created on the disk for the test.\n\t\t\t\t\t */\n\t\t\t\t\t[{\n\t\t\t\t\t\tname: rootFolderName,\n\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tname: 'file1.prompt.md',\n\t\t\t\t\t\t\t\tcontents: [\n\t\t\t\t\t\t\t\t\t'## Some Header',\n\t\t\t\t\t\t\t\t\t'some contents',\n\t\t\t\t\t\t\t\t\t' ',\n\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tname: 'file2.prompt.md',\n\t\t\t\t\t\t\t\tcontents: [\n\t\t\t\t\t\t\t\t\t'---',\n\t\t\t\t\t\t\t\t\t'description: \\'Description of my prompt.\\'',\n\t\t\t\t\t\t\t\t\t'agent: \\t\\t \"agent\" \\t\\t ',\n\t\t\t\t\t\t\t\t\t'---',\n\t\t\t\t\t\t\t\t\t'## Files',\n\t\t\t\t\t\t\t\t\t'\\t- this file #file:folder1/file3.prompt.md ',\n\t\t\t\t\t\t\t\t\t'\\t- also this [file4.prompt.md](./folder1/some-other-folder/file4.prompt.md) please!',\n\t\t\t\t\t\t\t\t\t' ',\n\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tname: 'folder1',\n\t\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\tname: 'file3.prompt.md',\n\t\t\t\t\t\t\t\t\t\tcontents: [\n\t\t\t\t\t\t\t\t\t\t\t'---',\n\t\t\t\t\t\t\t\t\t\t\t'tools: [ false, \\'my-tool1\\' , ]',\n\t\t\t\t\t\t\t\t\t\t\t'---',\n\t\t\t\t\t\t\t\t\t\t\t' some more\\t content',\n\t\t\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\tname: 'some-other-folder',\n\t\t\t\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\t\tname: 'file4.prompt.md',\n\t\t\t\t\t\t\t\t\t\t\t\tcontents: [\n\t\t\t\t\t\t\t\t\t\t\t\t\t'---',\n\t\t\t\t\t\t\t\t\t\t\t\t\t'tools: [\\'my-tool1\\', \"my-tool2\", true, , \\'my-tool3\\' , ]',\n\t\t\t\t\t\t\t\t\t\t\t\t\t'something: true',\n\t\t\t\t\t\t\t\t\t\t\t\t\t'agent: \\'agent\\'\\t',\n\t\t\t\t\t\t\t\t\t\t\t\t\t'---',\n\t\t\t\t\t\t\t\t\t\t\t\t\t'',\n\t\t\t\t\t\t\t\t\t\t\t\t\t'',\n\t\t\t\t\t\t\t\t\t\t\t\t\t'and some more content',\n\t\t\t\t\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t],\n\t\t\t\t\t}],\n\t\t\t\t\t/**\n\t\t\t\t\t * The root file path to start the resolve process from.\n\t\t\t\t\t */\n\t\t\t\t\ttoUri(`/${rootFolderName}/file2.prompt.md`),\n\t\t\t\t\t/**\n\t\t\t\t\t * The expected references to be resolved.\n\t\t\t\t\t */\n\t\t\t\t\t[\n\t\t\t\t\t\tnew ExpectedReference(\n\t\t\t\t\t\t\trootUri,\n\t\t\t\t\t\t\tcreateFileReference('folder1/file3.prompt.md', 6, 14),\n\t\t\t\t\t\t),\n\t\t\t\t\t\tnew ExpectedReference(\n\t\t\t\t\t\t\trootUri,\n\t\t\t\t\t\t\tcreateMarkdownReference(\n\t\t\t\t\t\t\t\t7, 14,\n\t\t\t\t\t\t\t\t'[file4.prompt.md]', '(./folder1/some-other-folder/file4.prompt.md)',\n\t\t\t\t\t\t\t),\n\t\t\t\t\t\t),\n\t\t\t\t\t]\n\t\t\t\t));\n\n\t\t\t\tconst metadata = await test.run();\n\n\t\t\t\tassert.deepStrictEqual(\n\t\t\t\t\tmetadata,\n\t\t\t\t\t{\n\t\t\t\t\t\tpromptType: PromptsType.prompt,\n\t\t\t\t\t\tagent: ChatModeKind.Agent,\n\t\t\t\t\t\tdescription: 'Description of my prompt.',\n\t\t\t\t\t},\n\t\t\t\t\t'Must have correct metadata.',\n\t\t\t\t);\n\n\t\t\t});\n\n\t\t\ttest('no agent', async function () {\n\t\t\t\tconst rootFolderName = 'resolves-nested-file-references';\n\t\t\t\tconst rootFolder = `/${rootFolderName}`;\n\t\t\t\tconst rootUri = toUri(rootFolder);\n\n\t\t\t\tconst test = testDisposables.add(instantiationService.createInstance(TestPromptFileReference,\n\t\t\t\t\t/**\n\t\t\t\t\t * The file structure to be created on the disk for the test.\n\t\t\t\t\t */\n\t\t\t\t\t[{\n\t\t\t\t\t\tname: rootFolderName,\n\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tname: 'file1.prompt.md',\n\t\t\t\t\t\t\t\tcontents: [\n\t\t\t\t\t\t\t\t\t'## Some Header',\n\t\t\t\t\t\t\t\t\t'some contents',\n\t\t\t\t\t\t\t\t\t' ',\n\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tname: 'file2.prompt.md',\n\t\t\t\t\t\t\t\tcontents: [\n\t\t\t\t\t\t\t\t\t'---',\n\t\t\t\t\t\t\t\t\t'tools: [ false, \\'my-tool12\\' , ]',\n\t\t\t\t\t\t\t\t\t'description: \\'Description of the prompt file.\\'',\n\t\t\t\t\t\t\t\t\t'---',\n\t\t\t\t\t\t\t\t\t'## Files',\n\t\t\t\t\t\t\t\t\t'\\t- this file #file:folder1/file3.prompt.md ',\n\t\t\t\t\t\t\t\t\t'\\t- also this [file4.prompt.md](./folder1/some-other-folder/file4.prompt.md) please!',\n\t\t\t\t\t\t\t\t\t' ',\n\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tname: 'folder1',\n\t\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\tname: 'file3.prompt.md',\n\t\t\t\t\t\t\t\t\t\tcontents: [\n\t\t\t\t\t\t\t\t\t\t\t'---',\n\t\t\t\t\t\t\t\t\t\t\t'tools: [ false, \\'my-tool1\\' , ]',\n\t\t\t\t\t\t\t\t\t\t\t'---',\n\t\t\t\t\t\t\t\t\t\t\t' some more\\t content',\n\t\t\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\tname: 'some-other-folder',\n\t\t\t\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\t\tname: 'file4.prompt.md',\n\t\t\t\t\t\t\t\t\t\t\t\tcontents: [\n\t\t\t\t\t\t\t\t\t\t\t\t\t'---',\n\t\t\t\t\t\t\t\t\t\t\t\t\t'tools: [\\'my-tool1\\', \"my-tool2\", true, , \\'my-tool3\\' , ]',\n\t\t\t\t\t\t\t\t\t\t\t\t\t'something: true',\n\t\t\t\t\t\t\t\t\t\t\t\t\t'agent: \\'agent\\'\\t',\n\t\t\t\t\t\t\t\t\t\t\t\t\t'---',\n\t\t\t\t\t\t\t\t\t\t\t\t\t'',\n\t\t\t\t\t\t\t\t\t\t\t\t\t'',\n\t\t\t\t\t\t\t\t\t\t\t\t\t'and some more content',\n\t\t\t\t\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t],\n\t\t\t\t\t}],\n\t\t\t\t\t/**\n\t\t\t\t\t * The root file path to start the resolve process from.\n\t\t\t\t\t */\n\t\t\t\t\ttoUri(`/${rootFolderName}/file2.prompt.md`),\n\t\t\t\t\t/**\n\t\t\t\t\t * The expected references to be resolved.\n\t\t\t\t\t */\n\t\t\t\t\t[\n\t\t\t\t\t\tnew ExpectedReference(\n\t\t\t\t\t\t\trootUri,\n\t\t\t\t\t\t\tcreateFileReference('folder1/file3.prompt.md', 6, 14),\n\t\t\t\t\t\t),\n\t\t\t\t\t\tnew ExpectedReference(\n\t\t\t\t\t\t\trootUri,\n\t\t\t\t\t\t\tcreateMarkdownReference(\n\t\t\t\t\t\t\t\t7, 14,\n\t\t\t\t\t\t\t\t'[file4.prompt.md]', '(./folder1/some-other-folder/file4.prompt.md)',\n\t\t\t\t\t\t\t),\n\t\t\t\t\t\t),\n\t\t\t\t\t]\n\t\t\t\t));\n\n\t\t\t\tconst metadata = await test.run();\n\n\t\t\t\tassert.deepStrictEqual(\n\t\t\t\t\tmetadata,\n\t\t\t\t\t{\n\t\t\t\t\t\tpromptType: PromptsType.prompt,\n\t\t\t\t\t\ttools: ['my-tool12'],\n\t\t\t\t\t\tdescription: 'Description of the prompt file.',\n\t\t\t\t\t},\n\t\t\t\t\t'Must have correct metadata.',\n\t\t\t\t);\n\n\t\t\t});\n\t\t});\n\t});\n});\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport assert from 'assert';\nimport { Disposable } from '../../../../../../base/common/lifecycle.js';\nimport { URI } from '../../../../../../base/common/uri.js';\nimport { ensureNoDisposablesAreLeakedInTestSuite } from '../../../../../../base/test/common/utils.js';\nimport { Range } from '../../../../../../editor/common/core/range.js';\nimport { ILanguageService } from '../../../../../../editor/common/languages/language.js';\nimport { IModelService } from '../../../../../../editor/common/services/model.js';\nimport { IConfigurationService } from '../../../../../../platform/configuration/common/configuration.js';\nimport { ConfigurationService } from '../../../../../../platform/configuration/common/configurationService.js';\nimport { IFileService } from '../../../../../../platform/files/common/files.js';\nimport { FileService } from '../../../../../../platform/files/common/fileService.js';\nimport { InMemoryFileSystemProvider } from '../../../../../../platform/files/common/inMemoryFilesystemProvider.js';\nimport { IInstantiationService } from '../../../../../../platform/instantiation/common/instantiation.js';\nimport { TestInstantiationService } from '../../../../../../platform/instantiation/test/common/instantiationServiceMock.js';\nimport { ILogService, NullLogService } from '../../../../../../platform/log/common/log.js';\nimport { NullPolicyService } from '../../../../../../platform/policy/common/policy.js';\nimport { ChatModeKind } from '../../../common/constants.js';\nimport { getPromptFileType } from '../../../common/promptSyntax/config/promptFileLocations.js';\nimport { PromptsType } from '../../../common/promptSyntax/promptTypes.js';\nimport { IMockFolder, MockFilesystem } from './testUtils/mockFilesystem.js';\nimport { IBodyFileReference, PromptFileParser } from '../../../common/promptSyntax/promptFileParser.js';\n\n/**\n * Represents a file reference with an expected\n * error condition value for testing purposes.\n */\nclass ExpectedReference {\n\t/**\n\t * URI component of the expected reference.\n\t */\n\tpublic readonly uri: URI;\n\n\tconstructor(\n\t\tdirname: URI,\n\t\tpublic readonly ref: IBodyFileReference,\n\t) {\n\t\tthis.uri = (ref.content.startsWith('/'))\n\t\t\t? URI.file(ref.content)\n\t\t\t: URI.joinPath(dirname, ref.content);\n\t}\n\n\t/**\n\t * Range of the underlying file reference token.\n\t */\n\tpublic get range(): Range {\n\t\treturn this.ref.range;\n\t}\n\n\t/**\n\t * String representation of the expected reference.\n\t */\n\tpublic toString(): string {\n\t\treturn `file-prompt:${this.uri.path}`;\n\t}\n}\n\nfunction toUri(filePath: string): URI {\n\treturn URI.parse('testFs://' + filePath);\n}\n\n/**\n * A reusable test utility to test the `PromptFileReference` class.\n */\nclass TestPromptFileReference extends Disposable {\n\tconstructor(\n\t\tprivate readonly fileStructure: IMockFolder[],\n\t\tprivate readonly rootFileUri: URI,\n\t\tprivate readonly expectedReferences: ExpectedReference[],\n\t\t@IFileService private readonly fileService: IFileService,\n\t\t@IInstantiationService private readonly instantiationService: IInstantiationService,\n\t) {\n\t\tsuper();\n\n\t\t// create in-memory file system\n\t\tconst fileSystemProvider = this._register(new InMemoryFileSystemProvider());\n\t\tthis._register(this.fileService.registerProvider('testFs', fileSystemProvider));\n\t}\n\n\t/**\n\t * Run the test.\n\t */\n\tpublic async run(): Promise<any> {\n\t\t// create the files structure on the disk\n\t\tconst mockFs = this.instantiationService.createInstance(MockFilesystem, this.fileStructure);\n\t\tawait mockFs.mock(toUri('/'));\n\n\t\tconst content = await this.fileService.readFile(this.rootFileUri);\n\n\t\tconst ast = new PromptFileParser().parse(this.rootFileUri, content.value.toString());\n\t\tassert(ast.body, 'Prompt file must have a body');\n\n\t\t// resolve the root file reference including all nested references\n\t\tconst resolvedReferences = ast.body.fileReferences ?? [];\n\n\t\tfor (let i = 0; i < this.expectedReferences.length; i++) {\n\t\t\tconst expectedReference = this.expectedReferences[i];\n\t\t\tconst resolvedReference = resolvedReferences[i];\n\n\t\t\tconst resolvedUri = ast.body.resolveFilePath(resolvedReference.content);\n\n\t\t\tassert.equal(resolvedUri?.fsPath, expectedReference.uri.fsPath);\n\t\t\tassert.deepStrictEqual(resolvedReference.range, expectedReference.range);\n\t\t}\n\n\t\tassert.strictEqual(\n\t\t\tresolvedReferences.length,\n\t\t\tthis.expectedReferences.length,\n\t\t\t[\n\t\t\t\t`\\nExpected(${this.expectedReferences.length}): [\\n ${this.expectedReferences.join('\\n ')}\\n]`,\n\t\t\t\t`Received(${resolvedReferences.length}): [\\n ${resolvedReferences.join('\\n ')}\\n]`,\n\t\t\t].join('\\n'),\n\t\t);\n\n\t\tconst result: any = {};\n\t\tresult.promptType = getPromptFileType(this.rootFileUri);\n\t\tif (ast.header) {\n\t\t\tfor (const key of ['tools', 'model', 'agent', 'applyTo', 'description'] as const) {\n\t\t\t\tif (ast.header[key]) {\n\t\t\t\t\tresult[key] = ast.header[key];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tawait mockFs.delete();\n\n\t\treturn result;\n\t}\n}\n\n/**\n * Create expected file reference for testing purposes.\n *\n * Note! This utility also use for `markdown links` at the moment.\n *\n * @param filePath The expected path of the file reference (without the `#file:` prefix).\n * @param lineNumber The expected line number of the file reference.\n * @param startColumnNumber The expected start column number of the file reference.\n */\nfunction createFileReference(filePath: string, lineNumber: number, startColumnNumber: number): IBodyFileReference {\n\tconst range = new Range(\n\t\tlineNumber,\n\t\tstartColumnNumber + '#file:'.length,\n\t\tlineNumber,\n\t\tstartColumnNumber + '#file:'.length + filePath.length,\n\t);\n\n\treturn {\n\t\trange,\n\t\tcontent: filePath,\n\t\tisMarkdownLink: false,\n\t};\n}\n\nfunction createMarkdownReference(lineNumber: number, startColumnNumber: number, firstSeg: string, secondSeg: string): IBodyFileReference {\n\tconst range = new Range(\n\t\tlineNumber,\n\t\tstartColumnNumber + firstSeg.length + 1,\n\t\tlineNumber,\n\t\tstartColumnNumber + firstSeg.length + secondSeg.length - 1,\n\t);\n\n\treturn {\n\t\trange,\n\t\tcontent: secondSeg.substring(1, secondSeg.length - 1),\n\t\tisMarkdownLink: true,\n\t};\n}\n\nsuite('PromptFileReference', function () {\n\tconst testDisposables = ensureNoDisposablesAreLeakedInTestSuite();\n\n\tlet instantiationService: TestInstantiationService;\n\tsetup(async () => {\n\t\tconst nullPolicyService = new NullPolicyService();\n\t\tconst nullLogService = testDisposables.add(new NullLogService());\n\t\tconst nullFileService = testDisposables.add(new FileService(nullLogService));\n\t\tconst nullConfigService = testDisposables.add(new ConfigurationService(\n\t\t\tURI.file('/config.json'),\n\t\t\tnullFileService,\n\t\t\tnullPolicyService,\n\t\t\tnullLogService,\n\t\t));\n\t\tinstantiationService = testDisposables.add(new TestInstantiationService());\n\n\t\tinstantiationService.stub(IFileService, nullFileService);\n\t\tinstantiationService.stub(ILogService, nullLogService);\n\t\tinstantiationService.stub(IConfigurationService, nullConfigService);\n\t\tinstantiationService.stub(IModelService, { getModel() { return null; } });\n\t\tinstantiationService.stub(ILanguageService, {\n\t\t\tguessLanguageIdByFilepathOrFirstLine(uri: URI) {\n\t\t\t\treturn getPromptFileType(uri) ?? null;\n\t\t\t}\n\t\t});\n\t});\n\n\ttest('resolves nested file references', async function () {\n\t\tconst rootFolderName = 'resolves-nested-file-references';\n\t\tconst rootFolder = `/${rootFolderName}`;\n\t\tconst rootUri = toUri(rootFolder);\n\n\t\tconst test = testDisposables.add(instantiationService.createInstance(TestPromptFileReference,\n\t\t\t/**\n\t\t\t * The file structure to be created on the disk for the test.\n\t\t\t */\n\t\t\t[{\n\t\t\t\tname: rootFolderName,\n\t\t\t\tchildren: [\n\t\t\t\t\t{\n\t\t\t\t\t\tname: 'file1.prompt.md',\n\t\t\t\t\t\tcontents: '## Some Header\\nsome contents\\n ',\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tname: 'file2.prompt.md',\n\t\t\t\t\t\tcontents: '## Files\\n\\t- this file #file:folder1/file3.prompt.md \\n\\t- also this [file4.prompt.md](./folder1/some-other-folder/file4.prompt.md) please!\\n ',\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tname: 'folder1',\n\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tname: 'file3.prompt.md',\n\t\t\t\t\t\t\t\tcontents: `\\n[](./some-other-folder/non-existing-folder)\\n\\t- some seemingly random #file:${rootFolder}/folder1/some-other-folder/yetAnotherFolder五/another-file.prompt.md contents\\n some more\\t content`,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tname: 'some-other-folder',\n\t\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\tname: 'file4.prompt.md',\n\t\t\t\t\t\t\t\t\t\tcontents: 'this file has a non-existing #file:./some-non-existing/file.prompt.md\\t\\treference\\n\\n\\nand some\\n non-prompt #file:./some-non-prompt-file.md\\t\\t \\t[](../../folder1/)\\t',\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\tname: 'file.txt',\n\t\t\t\t\t\t\t\t\t\tcontents: 'contents of a non-prompt-snippet file',\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\tname: 'yetAnotherFolder五',\n\t\t\t\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\t\tname: 'another-file.prompt.md',\n\t\t\t\t\t\t\t\t\t\t\t\tcontents: `[caption](${rootFolder}/folder1/some-other-folder)\\nanother-file.prompt.md contents\\t [#file:file.txt](../file.txt)`,\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\t\tname: 'one_more_file_just_in_case.prompt.md',\n\t\t\t\t\t\t\t\t\t\t\t\tcontents: 'one_more_file_just_in_case.prompt.md contents',\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t],\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t}],\n\t\t\t/**\n\t\t\t * The root file path to start the resolve process from.\n\t\t\t */\n\t\t\ttoUri(`/${rootFolderName}/file2.prompt.md`),\n\t\t\t/**\n\t\t\t * The expected references to be resolved.\n\t\t\t */\n\t\t\t[\n\t\t\t\tnew ExpectedReference(\n\t\t\t\t\trootUri,\n\t\t\t\t\tcreateFileReference('folder1/file3.prompt.md', 2, 14),\n\t\t\t\t),\n\t\t\t\tnew ExpectedReference(\n\t\t\t\t\trootUri,\n\t\t\t\t\tcreateMarkdownReference(\n\t\t\t\t\t\t3, 14,\n\t\t\t\t\t\t'[file4.prompt.md]', '(./folder1/some-other-folder/file4.prompt.md)',\n\t\t\t\t\t),\n\t\t\t\t),\n\t\t\t]\n\t\t));\n\n\t\tawait test.run();\n\t});\n\n\n\tsuite('metadata', () => {\n\t\ttest('tools', async function () {\n\t\t\tconst rootFolderName = 'resolves-nested-file-references';\n\t\t\tconst rootFolder = `/${rootFolderName}`;\n\t\t\tconst rootUri = toUri(rootFolder);\n\n\t\t\tconst test = testDisposables.add(instantiationService.createInstance(TestPromptFileReference,\n\t\t\t\t/**\n\t\t\t\t * The file structure to be created on the disk for the test.\n\t\t\t\t */\n\t\t\t\t[{\n\t\t\t\t\tname: rootFolderName,\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tname: 'file1.prompt.md',\n\t\t\t\t\t\t\tcontents: [\n\t\t\t\t\t\t\t\t'## Some Header',\n\t\t\t\t\t\t\t\t'some contents',\n\t\t\t\t\t\t\t\t' ',\n\t\t\t\t\t\t\t],\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tname: 'file2.prompt.md',\n\t\t\t\t\t\t\tcontents: [\n\t\t\t\t\t\t\t\t'---',\n\t\t\t\t\t\t\t\t'description: \\'Root prompt description.\\'',\n\t\t\t\t\t\t\t\t'tools: [\\'my-tool1\\']',\n\t\t\t\t\t\t\t\t'agent: \"agent\" ',\n\t\t\t\t\t\t\t\t'---',\n\t\t\t\t\t\t\t\t'## Files',\n\t\t\t\t\t\t\t\t'\\t- this file #file:folder1/file3.prompt.md ',\n\t\t\t\t\t\t\t\t'\\t- also this [file4.prompt.md](./folder1/some-other-folder/file4.prompt.md) please!',\n\t\t\t\t\t\t\t\t' ',\n\t\t\t\t\t\t\t],\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tname: 'folder1',\n\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tname: 'file3.prompt.md',\n\t\t\t\t\t\t\t\t\tcontents: [\n\t\t\t\t\t\t\t\t\t\t'---',\n\t\t\t\t\t\t\t\t\t\t'tools: [ false, \\'my-tool1\\' , ]',\n\t\t\t\t\t\t\t\t\t\t'---',\n\t\t\t\t\t\t\t\t\t\t'',\n\t\t\t\t\t\t\t\t\t\t'[](./some-other-folder/non-existing-folder)',\n\t\t\t\t\t\t\t\t\t\t`\\t- some seemingly random #file:${rootFolder}/folder1/some-other-folder/yetAnotherFolder五/another-file.prompt.md contents`,\n\t\t\t\t\t\t\t\t\t\t' some more\\t content',\n\t\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tname: 'some-other-folder',\n\t\t\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\tname: 'file4.prompt.md',\n\t\t\t\t\t\t\t\t\t\t\tcontents: [\n\t\t\t\t\t\t\t\t\t\t\t\t'---',\n\t\t\t\t\t\t\t\t\t\t\t\t'tools: [\\'my-tool1\\', \"my-tool2\", true, , ]',\n\t\t\t\t\t\t\t\t\t\t\t\t'something: true',\n\t\t\t\t\t\t\t\t\t\t\t\t'agent: \\'ask\\'\\t',\n\t\t\t\t\t\t\t\t\t\t\t\t'---',\n\t\t\t\t\t\t\t\t\t\t\t\t'this file has a non-existing #file:./some-non-existing/file.prompt.md\\t\\treference',\n\t\t\t\t\t\t\t\t\t\t\t\t'',\n\t\t\t\t\t\t\t\t\t\t\t\t'',\n\t\t\t\t\t\t\t\t\t\t\t\t'and some',\n\t\t\t\t\t\t\t\t\t\t\t\t' non-prompt #file:./some-non-prompt-file.md\\t\\t \\t[](../../folder1/)\\t',\n\t\t\t\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\tname: 'file.txt',\n\t\t\t\t\t\t\t\t\t\t\tcontents: 'contents of a non-prompt-snippet file',\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\tname: 'yetAnotherFolder五',\n\t\t\t\t\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\t\t\tname: 'another-file.prompt.md',\n\t\t\t\t\t\t\t\t\t\t\t\t\tcontents: [\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t'---',\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t'tools: [\\'my-tool3\\', false, \"my-tool2\" ]',\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t'---',\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t`[](${rootFolder}/folder1/some-other-folder)`,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t'another-file.prompt.md contents\\t [#file:file.txt](../file.txt)',\n\t\t\t\t\t\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\t\t\tname: 'one_more_file_just_in_case.prompt.md',\n\t\t\t\t\t\t\t\t\t\t\t\t\tcontents: 'one_more_file_just_in_case.prompt.md contents',\n\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t],\n\t\t\t\t\t\t},\n\t\t\t\t\t],\n\t\t\t\t}],\n\t\t\t\t/**\n\t\t\t\t * The root file path to start the resolve process from.\n\t\t\t\t */\n\t\t\t\ttoUri(`/${rootFolderName}/file2.prompt.md`),\n\t\t\t\t/**\n\t\t\t\t * The expected references to be resolved.\n\t\t\t\t */\n\t\t\t\t[\n\t\t\t\t\tnew ExpectedReference(\n\t\t\t\t\t\trootUri,\n\t\t\t\t\t\tcreateFileReference('folder1/file3.prompt.md', 7, 14),\n\t\t\t\t\t),\n\t\t\t\t\tnew ExpectedReference(\n\t\t\t\t\t\trootUri,\n\t\t\t\t\t\tcreateMarkdownReference(\n\t\t\t\t\t\t\t8, 14,\n\t\t\t\t\t\t\t'[file4.prompt.md]', '(./folder1/some-other-folder/file4.prompt.md)',\n\t\t\t\t\t\t),\n\t\t\t\t\t),\n\t\t\t\t]\n\t\t\t));\n\n\t\t\tconst metadata = await test.run();\n\n\t\t\tassert.deepStrictEqual(\n\t\t\t\tmetadata,\n\t\t\t\t{\n\t\t\t\t\tpromptType: PromptsType.prompt,\n\t\t\t\t\tagent: 'agent',\n\t\t\t\t\tdescription: 'Root prompt description.',\n\t\t\t\t\ttools: ['my-tool1'],\n\t\t\t\t},\n\t\t\t\t'Must have correct metadata.',\n\t\t\t);\n\n\t\t});\n\n\t\tsuite('applyTo', () => {\n\t\t\ttest('prompt language', async function () {\n\t\t\t\tconst rootFolderName = 'resolves-nested-file-references';\n\t\t\t\tconst rootFolder = `/${rootFolderName}`;\n\t\t\t\tconst rootUri = toUri(rootFolder);\n\n\t\t\t\tconst test = testDisposables.add(instantiationService.createInstance(TestPromptFileReference,\n\t\t\t\t\t/**\n\t\t\t\t\t * The file structure to be created on the disk for the test.\n\t\t\t\t\t */\n\t\t\t\t\t[{\n\t\t\t\t\t\tname: rootFolderName,\n\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tname: 'file1.prompt.md',\n\t\t\t\t\t\t\t\tcontents: [\n\t\t\t\t\t\t\t\t\t'## Some Header',\n\t\t\t\t\t\t\t\t\t'some contents',\n\t\t\t\t\t\t\t\t\t' ',\n\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tname: 'file2.prompt.md',\n\t\t\t\t\t\t\t\tcontents: [\n\t\t\t\t\t\t\t\t\t'---',\n\t\t\t\t\t\t\t\t\t'applyTo: \\'**/*\\'',\n\t\t\t\t\t\t\t\t\t'tools: [ false, \\'my-tool12\\' , ]',\n\t\t\t\t\t\t\t\t\t'description: \\'Description of my prompt.\\'',\n\t\t\t\t\t\t\t\t\t'---',\n\t\t\t\t\t\t\t\t\t'## Files',\n\t\t\t\t\t\t\t\t\t'\\t- this file #file:folder1/file3.prompt.md ',\n\t\t\t\t\t\t\t\t\t'\\t- also this [file4.prompt.md](./folder1/some-other-folder/file4.prompt.md) please!',\n\t\t\t\t\t\t\t\t\t' ',\n\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tname: 'folder1',\n\t\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\tname: 'file3.prompt.md',\n\t\t\t\t\t\t\t\t\t\tcontents: [\n\t\t\t\t\t\t\t\t\t\t\t'---',\n\t\t\t\t\t\t\t\t\t\t\t'tools: [ false, \\'my-tool1\\' , ]',\n\t\t\t\t\t\t\t\t\t\t\t'---',\n\t\t\t\t\t\t\t\t\t\t\t' some more\\t content',\n\t\t\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\tname: 'some-other-folder',\n\t\t\t\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\t\tname: 'file4.prompt.md',\n\t\t\t\t\t\t\t\t\t\t\t\tcontents: [\n\t\t\t\t\t\t\t\t\t\t\t\t\t'---',\n\t\t\t\t\t\t\t\t\t\t\t\t\t'tools: [\\'my-tool1\\', \"my-tool2\", true, , \\'my-tool3\\' , ]',\n\t\t\t\t\t\t\t\t\t\t\t\t\t'something: true',\n\t\t\t\t\t\t\t\t\t\t\t\t\t'agent: \\'agent\\'\\t',\n\t\t\t\t\t\t\t\t\t\t\t\t\t'---',\n\t\t\t\t\t\t\t\t\t\t\t\t\t'',\n\t\t\t\t\t\t\t\t\t\t\t\t\t'',\n\t\t\t\t\t\t\t\t\t\t\t\t\t'and some more content',\n\t\t\t\t\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t],\n\t\t\t\t\t}],\n\t\t\t\t\t/**\n\t\t\t\t\t * The root file path to start the resolve process from.\n\t\t\t\t\t */\n\t\t\t\t\ttoUri(`/${rootFolderName}/file2.prompt.md`),\n\t\t\t\t\t/**\n\t\t\t\t\t * The expected references to be resolved.\n\t\t\t\t\t */\n\t\t\t\t\t[\n\t\t\t\t\t\tnew ExpectedReference(\n\t\t\t\t\t\t\trootUri,\n\t\t\t\t\t\t\tcreateFileReference('folder1/file3.prompt.md', 7, 14),\n\t\t\t\t\t\t),\n\t\t\t\t\t\tnew ExpectedReference(\n\t\t\t\t\t\t\trootUri,\n\t\t\t\t\t\t\tcreateMarkdownReference(\n\t\t\t\t\t\t\t\t8, 14,\n\t\t\t\t\t\t\t\t'[file4.prompt.md]', '(./folder1/some-other-folder/file4.prompt.md)',\n\t\t\t\t\t\t\t),\n\t\t\t\t\t\t),\n\t\t\t\t\t]\n\t\t\t\t));\n\n\t\t\t\tconst metadata = await test.run();\n\n\t\t\t\tassert.deepStrictEqual(\n\t\t\t\t\tmetadata,\n\t\t\t\t\t{\n\t\t\t\t\t\tpromptType: PromptsType.prompt,\n\t\t\t\t\t\tdescription: 'Description of my prompt.',\n\t\t\t\t\t\ttools: ['my-tool12'],\n\t\t\t\t\t\tapplyTo: '**/*',\n\t\t\t\t\t},\n\t\t\t\t\t'Must have correct metadata.',\n\t\t\t\t);\n\n\t\t\t});\n\n\n\t\t\ttest('instructions language', async function () {\n\t\t\t\tconst rootFolderName = 'resolves-nested-file-references';\n\t\t\t\tconst rootFolder = `/${rootFolderName}`;\n\t\t\t\tconst rootUri = toUri(rootFolder);\n\n\t\t\t\tconst test = testDisposables.add(instantiationService.createInstance(TestPromptFileReference,\n\t\t\t\t\t/**\n\t\t\t\t\t * The file structure to be created on the disk for the test.\n\t\t\t\t\t */\n\t\t\t\t\t[{\n\t\t\t\t\t\tname: rootFolderName,\n\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tname: 'file1.prompt.md',\n\t\t\t\t\t\t\t\tcontents: [\n\t\t\t\t\t\t\t\t\t'## Some Header',\n\t\t\t\t\t\t\t\t\t'some contents',\n\t\t\t\t\t\t\t\t\t' ',\n\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tname: 'file2.instructions.md',\n\t\t\t\t\t\t\t\tcontents: [\n\t\t\t\t\t\t\t\t\t'---',\n\t\t\t\t\t\t\t\t\t'applyTo: \\'**/*\\'',\n\t\t\t\t\t\t\t\t\t'tools: [ false, \\'my-tool12\\' , ]',\n\t\t\t\t\t\t\t\t\t'description: \\'Description of my instructions file.\\'',\n\t\t\t\t\t\t\t\t\t'---',\n\t\t\t\t\t\t\t\t\t'## Files',\n\t\t\t\t\t\t\t\t\t'\\t- this file #file:folder1/file3.prompt.md ',\n\t\t\t\t\t\t\t\t\t'\\t- also this [file4.prompt.md](./folder1/some-other-folder/file4.prompt.md) please!',\n\t\t\t\t\t\t\t\t\t' ',\n\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tname: 'folder1',\n\t\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\tname: 'file3.prompt.md',\n\t\t\t\t\t\t\t\t\t\tcontents: [\n\t\t\t\t\t\t\t\t\t\t\t'---',\n\t\t\t\t\t\t\t\t\t\t\t'tools: [ false, \\'my-tool1\\' , ]',\n\t\t\t\t\t\t\t\t\t\t\t'---',\n\t\t\t\t\t\t\t\t\t\t\t' some more\\t content',\n\t\t\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\tname: 'some-other-folder',\n\t\t\t\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\t\tname: 'file4.prompt.md',\n\t\t\t\t\t\t\t\t\t\t\t\tcontents: [\n\t\t\t\t\t\t\t\t\t\t\t\t\t'---',\n\t\t\t\t\t\t\t\t\t\t\t\t\t'tools: [\\'my-tool1\\', \"my-tool2\", true, , \\'my-tool3\\' , ]',\n\t\t\t\t\t\t\t\t\t\t\t\t\t'something: true',\n\t\t\t\t\t\t\t\t\t\t\t\t\t'agent: \\'agent\\'\\t',\n\t\t\t\t\t\t\t\t\t\t\t\t\t'---',\n\t\t\t\t\t\t\t\t\t\t\t\t\t'',\n\t\t\t\t\t\t\t\t\t\t\t\t\t'',\n\t\t\t\t\t\t\t\t\t\t\t\t\t'and some more content',\n\t\t\t\t\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t],\n\t\t\t\t\t}],\n\t\t\t\t\t/**\n\t\t\t\t\t * The root file path to start the resolve process from.\n\t\t\t\t\t */\n\t\t\t\t\ttoUri(`/${rootFolderName}/file2.instructions.md`),\n\t\t\t\t\t/**\n\t\t\t\t\t * The expected references to be resolved.\n\t\t\t\t\t */\n\t\t\t\t\t[\n\t\t\t\t\t\tnew ExpectedReference(\n\t\t\t\t\t\t\trootUri,\n\t\t\t\t\t\t\tcreateFileReference('folder1/file3.prompt.md', 7, 14),\n\t\t\t\t\t\t),\n\t\t\t\t\t\tnew ExpectedReference(\n\t\t\t\t\t\t\trootUri,\n\t\t\t\t\t\t\tcreateMarkdownReference(\n\t\t\t\t\t\t\t\t8, 14,\n\t\t\t\t\t\t\t\t'[file4.prompt.md]', '(./folder1/some-other-folder/file4.prompt.md)',\n\t\t\t\t\t\t\t),\n\t\t\t\t\t\t),\n\t\t\t\t\t]\n\t\t\t\t));\n\n\t\t\t\tconst metadata = await test.run();\n\n\t\t\t\tassert.deepStrictEqual(\n\t\t\t\t\tmetadata,\n\t\t\t\t\t{\n\t\t\t\t\t\tpromptType: PromptsType.instructions,\n\t\t\t\t\t\tapplyTo: '**/*',\n\t\t\t\t\t\tdescription: 'Description of my instructions file.',\n\t\t\t\t\t\ttools: ['my-tool12'],\n\t\t\t\t\t},\n\t\t\t\t\t'Must have correct metadata.',\n\t\t\t\t);\n\t\t\t});\n\t\t});\n\n\t\tsuite('tools and agent compatibility', () => {\n\t\t\ttest('ask agent', async function () {\n\t\t\t\tconst rootFolderName = 'resolves-nested-file-references';\n\t\t\t\tconst rootFolder = `/${rootFolderName}`;\n\t\t\t\tconst rootUri = toUri(rootFolder);\n\n\t\t\t\tconst test = testDisposables.add(instantiationService.createInstance(TestPromptFileReference,\n\t\t\t\t\t/**\n\t\t\t\t\t * The file structure to be created on the disk for the test.\n\t\t\t\t\t */\n\t\t\t\t\t[{\n\t\t\t\t\t\tname: rootFolderName,\n\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tname: 'file1.prompt.md',\n\t\t\t\t\t\t\t\tcontents: [\n\t\t\t\t\t\t\t\t\t'## Some Header',\n\t\t\t\t\t\t\t\t\t'some contents',\n\t\t\t\t\t\t\t\t\t' ',\n\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tname: 'file2.prompt.md',\n\t\t\t\t\t\t\t\tcontents: [\n\t\t\t\t\t\t\t\t\t'---',\n\t\t\t\t\t\t\t\t\t'description: \\'Description of my prompt.\\'',\n\t\t\t\t\t\t\t\t\t'agent: \"ask\" ',\n\t\t\t\t\t\t\t\t\t'---',\n\t\t\t\t\t\t\t\t\t'## Files',\n\t\t\t\t\t\t\t\t\t'\\t- this file #file:folder1/file3.prompt.md ',\n\t\t\t\t\t\t\t\t\t'\\t- also this [file4.prompt.md](./folder1/some-other-folder/file4.prompt.md) please!',\n\t\t\t\t\t\t\t\t\t' ',\n\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tname: 'folder1',\n\t\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\tname: 'file3.prompt.md',\n\t\t\t\t\t\t\t\t\t\tcontents: [\n\t\t\t\t\t\t\t\t\t\t\t'---',\n\t\t\t\t\t\t\t\t\t\t\t'tools: [ false, \\'my-tool1\\' , ]',\n\t\t\t\t\t\t\t\t\t\t\t'agent: \\'agent\\'\\t',\n\t\t\t\t\t\t\t\t\t\t\t'---',\n\t\t\t\t\t\t\t\t\t\t\t' some more\\t content',\n\t\t\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\tname: 'some-other-folder',\n\t\t\t\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\t\tname: 'file4.prompt.md',\n\t\t\t\t\t\t\t\t\t\t\t\tcontents: [\n\t\t\t\t\t\t\t\t\t\t\t\t\t'---',\n\t\t\t\t\t\t\t\t\t\t\t\t\t'tools: [\\'my-tool1\\', \"my-tool2\", true, , ]',\n\t\t\t\t\t\t\t\t\t\t\t\t\t'something: true',\n\t\t\t\t\t\t\t\t\t\t\t\t\t'agent: \\'ask\\'\\t',\n\t\t\t\t\t\t\t\t\t\t\t\t\t'---',\n\t\t\t\t\t\t\t\t\t\t\t\t\t'',\n\t\t\t\t\t\t\t\t\t\t\t\t\t'',\n\t\t\t\t\t\t\t\t\t\t\t\t\t'and some more content',\n\t\t\t\t\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t],\n\t\t\t\t\t}],\n\t\t\t\t\t/**\n\t\t\t\t\t * The root file path to start the resolve process from.\n\t\t\t\t\t */\n\t\t\t\t\ttoUri(`/${rootFolderName}/file2.prompt.md`),\n\t\t\t\t\t/**\n\t\t\t\t\t * The expected references to be resolved.\n\t\t\t\t\t */\n\t\t\t\t\t[\n\t\t\t\t\t\tnew ExpectedReference(\n\t\t\t\t\t\t\trootUri,\n\t\t\t\t\t\t\tcreateFileReference('folder1/file3.prompt.md', 6, 14),\n\t\t\t\t\t\t),\n\t\t\t\t\t\tnew ExpectedReference(\n\t\t\t\t\t\t\trootUri,\n\t\t\t\t\t\t\tcreateMarkdownReference(\n\t\t\t\t\t\t\t\t7, 14,\n\t\t\t\t\t\t\t\t'[file4.prompt.md]', '(./folder1/some-other-folder/file4.prompt.md)',\n\t\t\t\t\t\t\t),\n\t\t\t\t\t\t),\n\t\t\t\t\t]\n\t\t\t\t));\n\n\t\t\t\tconst metadata = await test.run();\n\n\t\t\t\tassert.deepStrictEqual(\n\t\t\t\t\tmetadata,\n\t\t\t\t\t{\n\t\t\t\t\t\tpromptType: PromptsType.prompt,\n\t\t\t\t\t\tagent: ChatModeKind.Ask,\n\t\t\t\t\t\tdescription: 'Description of my prompt.',\n\t\t\t\t\t},\n\t\t\t\t\t'Must have correct metadata.',\n\t\t\t\t);\n\t\t\t});\n\n\t\t\ttest('edit agent', async function () {\n\t\t\t\tconst rootFolderName = 'resolves-nested-file-references';\n\t\t\t\tconst rootFolder = `/${rootFolderName}`;\n\t\t\t\tconst rootUri = toUri(rootFolder);\n\n\t\t\t\tconst test = testDisposables.add(instantiationService.createInstance(TestPromptFileReference,\n\t\t\t\t\t/**\n\t\t\t\t\t * The file structure to be created on the disk for the test.\n\t\t\t\t\t */\n\t\t\t\t\t[{\n\t\t\t\t\t\tname: rootFolderName,\n\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tname: 'file1.prompt.md',\n\t\t\t\t\t\t\t\tcontents: [\n\t\t\t\t\t\t\t\t\t'## Some Header',\n\t\t\t\t\t\t\t\t\t'some contents',\n\t\t\t\t\t\t\t\t\t' ',\n\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tname: 'file2.prompt.md',\n\t\t\t\t\t\t\t\tcontents: [\n\t\t\t\t\t\t\t\t\t'---',\n\t\t\t\t\t\t\t\t\t'description: \\'Description of my prompt.\\'',\n\t\t\t\t\t\t\t\t\t'agent:\\t\\t\"edit\"\\t\\t',\n\t\t\t\t\t\t\t\t\t'---',\n\t\t\t\t\t\t\t\t\t'## Files',\n\t\t\t\t\t\t\t\t\t'\\t- this file #file:folder1/file3.prompt.md ',\n\t\t\t\t\t\t\t\t\t'\\t- also this [file4.prompt.md](./folder1/some-other-folder/file4.prompt.md) please!',\n\t\t\t\t\t\t\t\t\t' ',\n\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tname: 'folder1',\n\t\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\tname: 'file3.prompt.md',\n\t\t\t\t\t\t\t\t\t\tcontents: [\n\t\t\t\t\t\t\t\t\t\t\t'---',\n\t\t\t\t\t\t\t\t\t\t\t'tools: [ false, \\'my-tool1\\' , ]',\n\t\t\t\t\t\t\t\t\t\t\t'---',\n\t\t\t\t\t\t\t\t\t\t\t' some more\\t content',\n\t\t\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\tname: 'some-other-folder',\n\t\t\t\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\t\tname: 'file4.prompt.md',\n\t\t\t\t\t\t\t\t\t\t\t\tcontents: [\n\t\t\t\t\t\t\t\t\t\t\t\t\t'---',\n\t\t\t\t\t\t\t\t\t\t\t\t\t'tools: [\\'my-tool1\\', \"my-tool2\", true, , ]',\n\t\t\t\t\t\t\t\t\t\t\t\t\t'something: true',\n\t\t\t\t\t\t\t\t\t\t\t\t\t'agent: \\'agent\\'\\t',\n\t\t\t\t\t\t\t\t\t\t\t\t\t'---',\n\t\t\t\t\t\t\t\t\t\t\t\t\t'',\n\t\t\t\t\t\t\t\t\t\t\t\t\t'',\n\t\t\t\t\t\t\t\t\t\t\t\t\t'and some more content',\n\t\t\t\t\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t],\n\t\t\t\t\t}],\n\t\t\t\t\t/**\n\t\t\t\t\t * The root file path to start the resolve process from.\n\t\t\t\t\t */\n\t\t\t\t\ttoUri(`/${rootFolderName}/file2.prompt.md`),\n\t\t\t\t\t/**\n\t\t\t\t\t * The expected references to be resolved.\n\t\t\t\t\t */\n\t\t\t\t\t[\n\t\t\t\t\t\tnew ExpectedReference(\n\t\t\t\t\t\t\trootUri,\n\t\t\t\t\t\t\tcreateFileReference('folder1/file3.prompt.md', 6, 14),\n\t\t\t\t\t\t),\n\t\t\t\t\t\tnew ExpectedReference(\n\t\t\t\t\t\t\trootUri,\n\t\t\t\t\t\t\tcreateMarkdownReference(\n\t\t\t\t\t\t\t\t7, 14,\n\t\t\t\t\t\t\t\t'[file4.prompt.md]', '(./folder1/some-other-folder/file4.prompt.md)',\n\t\t\t\t\t\t\t),\n\t\t\t\t\t\t),\n\t\t\t\t\t]\n\t\t\t\t));\n\n\t\t\t\tconst metadata = await test.run();\n\n\t\t\t\tassert.deepStrictEqual(\n\t\t\t\t\tmetadata,\n\t\t\t\t\t{\n\t\t\t\t\t\tpromptType: PromptsType.prompt,\n\t\t\t\t\t\tagent: ChatModeKind.Edit,\n\t\t\t\t\t\tdescription: 'Description of my prompt.',\n\t\t\t\t\t},\n\t\t\t\t\t'Must have correct metadata.',\n\t\t\t\t);\n\n\t\t\t});\n\n\t\t\ttest('agent', async function () {\n\t\t\t\tconst rootFolderName = 'resolves-nested-file-references';\n\t\t\t\tconst rootFolder = `/${rootFolderName}`;\n\t\t\t\tconst rootUri = toUri(rootFolder);\n\n\t\t\t\tconst test = testDisposables.add(instantiationService.createInstance(TestPromptFileReference,\n\t\t\t\t\t/**\n\t\t\t\t\t * The file structure to be created on the disk for the test.\n\t\t\t\t\t */\n\t\t\t\t\t[{\n\t\t\t\t\t\tname: rootFolderName,\n\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tname: 'file1.prompt.md',\n\t\t\t\t\t\t\t\tcontents: [\n\t\t\t\t\t\t\t\t\t'## Some Header',\n\t\t\t\t\t\t\t\t\t'some contents',\n\t\t\t\t\t\t\t\t\t' ',\n\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tname: 'file2.prompt.md',\n\t\t\t\t\t\t\t\tcontents: [\n\t\t\t\t\t\t\t\t\t'---',\n\t\t\t\t\t\t\t\t\t'description: \\'Description of my prompt.\\'',\n\t\t\t\t\t\t\t\t\t'agent: \\t\\t \"agent\" \\t\\t ',\n\t\t\t\t\t\t\t\t\t'---',\n\t\t\t\t\t\t\t\t\t'## Files',\n\t\t\t\t\t\t\t\t\t'\\t- this file #file:folder1/file3.prompt.md ',\n\t\t\t\t\t\t\t\t\t'\\t- also this [file4.prompt.md](./folder1/some-other-folder/file4.prompt.md) please!',\n\t\t\t\t\t\t\t\t\t' ',\n\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tname: 'folder1',\n\t\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\tname: 'file3.prompt.md',\n\t\t\t\t\t\t\t\t\t\tcontents: [\n\t\t\t\t\t\t\t\t\t\t\t'---',\n\t\t\t\t\t\t\t\t\t\t\t'tools: [ false, \\'my-tool1\\' , ]',\n\t\t\t\t\t\t\t\t\t\t\t'---',\n\t\t\t\t\t\t\t\t\t\t\t' some more\\t content',\n\t\t\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\tname: 'some-other-folder',\n\t\t\t\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\t\tname: 'file4.prompt.md',\n\t\t\t\t\t\t\t\t\t\t\t\tcontents: [\n\t\t\t\t\t\t\t\t\t\t\t\t\t'---',\n\t\t\t\t\t\t\t\t\t\t\t\t\t'tools: [\\'my-tool1\\', \"my-tool2\", true, , \\'my-tool3\\' , ]',\n\t\t\t\t\t\t\t\t\t\t\t\t\t'something: true',\n\t\t\t\t\t\t\t\t\t\t\t\t\t'agent: \\'agent\\'\\t',\n\t\t\t\t\t\t\t\t\t\t\t\t\t'---',\n\t\t\t\t\t\t\t\t\t\t\t\t\t'',\n\t\t\t\t\t\t\t\t\t\t\t\t\t'',\n\t\t\t\t\t\t\t\t\t\t\t\t\t'and some more content',\n\t\t\t\t\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t],\n\t\t\t\t\t}],\n\t\t\t\t\t/**\n\t\t\t\t\t * The root file path to start the resolve process from.\n\t\t\t\t\t */\n\t\t\t\t\ttoUri(`/${rootFolderName}/file2.prompt.md`),\n\t\t\t\t\t/**\n\t\t\t\t\t * The expected references to be resolved.\n\t\t\t\t\t */\n\t\t\t\t\t[\n\t\t\t\t\t\tnew ExpectedReference(\n\t\t\t\t\t\t\trootUri,\n\t\t\t\t\t\t\tcreateFileReference('folder1/file3.prompt.md', 6, 14),\n\t\t\t\t\t\t),\n\t\t\t\t\t\tnew ExpectedReference(\n\t\t\t\t\t\t\trootUri,\n\t\t\t\t\t\t\tcreateMarkdownReference(\n\t\t\t\t\t\t\t\t7, 14,\n\t\t\t\t\t\t\t\t'[file4.prompt.md]', '(./folder1/some-other-folder/file4.prompt.md)',\n\t\t\t\t\t\t\t),\n\t\t\t\t\t\t),\n\t\t\t\t\t]\n\t\t\t\t));\n\n\t\t\t\tconst metadata = await test.run();\n\n\t\t\t\tassert.deepStrictEqual(\n\t\t\t\t\tmetadata,\n\t\t\t\t\t{\n\t\t\t\t\t\tpromptType: PromptsType.prompt,\n\t\t\t\t\t\tagent: ChatModeKind.Agent,\n\t\t\t\t\t\tdescription: 'Description of my prompt.',\n\t\t\t\t\t},\n\t\t\t\t\t'Must have correct metadata.',\n\t\t\t\t);\n\n\t\t\t});\n\n\t\t\ttest('no agent', async function () {\n\t\t\t\tconst rootFolderName = 'resolves-nested-file-references';\n\t\t\t\tconst rootFolder = `/${rootFolderName}`;\n\t\t\t\tconst rootUri = toUri(rootFolder);\n\n\t\t\t\tconst test = testDisposables.add(instantiationService.createInstance(TestPromptFileReference,\n\t\t\t\t\t/**\n\t\t\t\t\t * The file structure to be created on the disk for the test.\n\t\t\t\t\t */\n\t\t\t\t\t[{\n\t\t\t\t\t\tname: rootFolderName,\n\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tname: 'file1.prompt.md',\n\t\t\t\t\t\t\t\tcontents: [\n\t\t\t\t\t\t\t\t\t'## Some Header',\n\t\t\t\t\t\t\t\t\t'some contents',\n\t\t\t\t\t\t\t\t\t' ',\n\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tname: 'file2.prompt.md',\n\t\t\t\t\t\t\t\tcontents: [\n\t\t\t\t\t\t\t\t\t'---',\n\t\t\t\t\t\t\t\t\t'tools: [ false, \\'my-tool12\\' , ]',\n\t\t\t\t\t\t\t\t\t'description: \\'Description of the prompt file.\\'',\n\t\t\t\t\t\t\t\t\t'---',\n\t\t\t\t\t\t\t\t\t'## Files',\n\t\t\t\t\t\t\t\t\t'\\t- this file #file:folder1/file3.prompt.md ',\n\t\t\t\t\t\t\t\t\t'\\t- also this [file4.prompt.md](./folder1/some-other-folder/file4.prompt.md) please!',\n\t\t\t\t\t\t\t\t\t' ',\n\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tname: 'folder1',\n\t\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\tname: 'file3.prompt.md',\n\t\t\t\t\t\t\t\t\t\tcontents: [\n\t\t\t\t\t\t\t\t\t\t\t'---',\n\t\t\t\t\t\t\t\t\t\t\t'tools: [ false, \\'my-tool1\\' , ]',\n\t\t\t\t\t\t\t\t\t\t\t'---',\n\t\t\t\t\t\t\t\t\t\t\t' some more\\t content',\n\t\t\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\tname: 'some-other-folder',\n\t\t\t\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\t\tname: 'file4.prompt.md',\n\t\t\t\t\t\t\t\t\t\t\t\tcontents: [\n\t\t\t\t\t\t\t\t\t\t\t\t\t'---',\n\t\t\t\t\t\t\t\t\t\t\t\t\t'tools: [\\'my-tool1\\', \"my-tool2\", true, , \\'my-tool3\\' , ]',\n\t\t\t\t\t\t\t\t\t\t\t\t\t'something: true',\n\t\t\t\t\t\t\t\t\t\t\t\t\t'agent: \\'agent\\'\\t',\n\t\t\t\t\t\t\t\t\t\t\t\t\t'---',\n\t\t\t\t\t\t\t\t\t\t\t\t\t'',\n\t\t\t\t\t\t\t\t\t\t\t\t\t'',\n\t\t\t\t\t\t\t\t\t\t\t\t\t'and some more content',\n\t\t\t\t\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t],\n\t\t\t\t\t}],\n\t\t\t\t\t/**\n\t\t\t\t\t * The root file path to start the resolve process from.\n\t\t\t\t\t */\n\t\t\t\t\ttoUri(`/${rootFolderName}/file2.prompt.md`),\n\t\t\t\t\t/**\n\t\t\t\t\t * The expected references to be resolved.\n\t\t\t\t\t */\n\t\t\t\t\t[\n\t\t\t\t\t\tnew ExpectedReference(\n\t\t\t\t\t\t\trootUri,\n\t\t\t\t\t\t\tcreateFileReference('folder1/file3.prompt.md', 6, 14),\n\t\t\t\t\t\t),\n\t\t\t\t\t\tnew ExpectedReference(\n\t\t\t\t\t\t\trootUri,\n\t\t\t\t\t\t\tcreateMarkdownReference(\n\t\t\t\t\t\t\t\t7, 14,\n\t\t\t\t\t\t\t\t'[file4.prompt.md]', '(./folder1/some-other-folder/file4.prompt.md)',\n\t\t\t\t\t\t\t),\n\t\t\t\t\t\t),\n\t\t\t\t\t]\n\t\t\t\t));\n\n\t\t\t\tconst metadata = await test.run();\n\n\t\t\t\tassert.deepStrictEqual(\n\t\t\t\t\tmetadata,\n\t\t\t\t\t{\n\t\t\t\t\t\tpromptType: PromptsType.prompt,\n\t\t\t\t\t\ttools: ['my-tool12'],\n\t\t\t\t\t\tdescription: 'Description of the prompt file.',\n\t\t\t\t\t},\n\t\t\t\t\t'Must have correct metadata.',\n\t\t\t\t);\n\n\t\t\t});\n\t\t});\n\t});\n});\n"]}