{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/contrib/chat/test/common/promptSyntax/service/promptsService.test.ts","vs/workbench/contrib/chat/test/common/promptSyntax/service/promptsService.test.ts"],"names":[],"mappings":"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","file":"promptsService.test.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport assert from 'assert';\nimport * as sinon from 'sinon';\nimport { CancellationToken } from '../../../../../../../base/common/cancellation.js';\nimport { ResourceSet } from '../../../../../../../base/common/map.js';\nimport { Schemas } from '../../../../../../../base/common/network.js';\nimport { URI } from '../../../../../../../base/common/uri.js';\nimport { ensureNoDisposablesAreLeakedInTestSuite } from '../../../../../../../base/test/common/utils.js';\nimport { Range } from '../../../../../../../editor/common/core/range.js';\nimport { ILanguageService } from '../../../../../../../editor/common/languages/language.js';\nimport { IModelService } from '../../../../../../../editor/common/services/model.js';\nimport { ModelService } from '../../../../../../../editor/common/services/modelService.js';\nimport { IConfigurationService } from '../../../../../../../platform/configuration/common/configuration.js';\nimport { TestConfigurationService } from '../../../../../../../platform/configuration/test/common/testConfigurationService.js';\nimport { IExtensionDescription } from '../../../../../../../platform/extensions/common/extensions.js';\nimport { IFileService } from '../../../../../../../platform/files/common/files.js';\nimport { FileService } from '../../../../../../../platform/files/common/fileService.js';\nimport { InMemoryFileSystemProvider } from '../../../../../../../platform/files/common/inMemoryFilesystemProvider.js';\nimport { TestInstantiationService } from '../../../../../../../platform/instantiation/test/common/instantiationServiceMock.js';\nimport { ILabelService } from '../../../../../../../platform/label/common/label.js';\nimport { ILogService, NullLogService } from '../../../../../../../platform/log/common/log.js';\nimport { ITelemetryService } from '../../../../../../../platform/telemetry/common/telemetry.js';\nimport { NullTelemetryService } from '../../../../../../../platform/telemetry/common/telemetryUtils.js';\nimport { IWorkspaceContextService } from '../../../../../../../platform/workspace/common/workspace.js';\nimport { testWorkspace } from '../../../../../../../platform/workspace/test/common/testWorkspace.js';\nimport { IWorkbenchEnvironmentService } from '../../../../../../services/environment/common/environmentService.js';\nimport { IFilesConfigurationService } from '../../../../../../services/filesConfiguration/common/filesConfigurationService.js';\nimport { IUserDataProfileService } from '../../../../../../services/userDataProfile/common/userDataProfile.js';\nimport { TestContextService, TestUserDataProfileService } from '../../../../../../test/common/workbenchTestServices.js';\nimport { ChatRequestVariableSet, isPromptFileVariableEntry, toFileVariableEntry } from '../../../../common/chatVariableEntries.js';\nimport { ComputeAutomaticInstructions, newInstructionsCollectionEvent } from '../../../../common/promptSyntax/computeAutomaticInstructions.js';\nimport { PromptsConfig } from '../../../../common/promptSyntax/config/config.js';\nimport { INSTRUCTION_FILE_EXTENSION, INSTRUCTIONS_DEFAULT_SOURCE_FOLDER, LEGACY_MODE_DEFAULT_SOURCE_FOLDER, PROMPT_DEFAULT_SOURCE_FOLDER, PROMPT_FILE_EXTENSION } from '../../../../common/promptSyntax/config/promptFileLocations.js';\nimport { INSTRUCTIONS_LANGUAGE_ID, PROMPT_LANGUAGE_ID, PromptsType } from '../../../../common/promptSyntax/promptTypes.js';\nimport { ICustomAgent, IPromptsService, PromptsStorage } from '../../../../common/promptSyntax/service/promptsService.js';\nimport { PromptsService } from '../../../../common/promptSyntax/service/promptsServiceImpl.js';\nimport { mockFiles } from '../testUtils/mockFilesystem.js';\nimport { InMemoryStorageService, IStorageService } from '../../../../../../../platform/storage/common/storage.js';\nimport { IPathService } from '../../../../../../services/path/common/pathService.js';\nimport { ISearchService } from '../../../../../../services/search/common/search.js';\n\nsuite('PromptsService', () => {\n\tconst disposables = ensureNoDisposablesAreLeakedInTestSuite();\n\n\tlet service: IPromptsService;\n\tlet instaService: TestInstantiationService;\n\tlet workspaceContextService: TestContextService;\n\tlet testConfigService: TestConfigurationService;\n\tlet fileService: IFileService;\n\n\tsetup(async () => {\n\t\tinstaService = disposables.add(new TestInstantiationService());\n\t\tinstaService.stub(ILogService, new NullLogService());\n\n\t\tworkspaceContextService = new TestContextService();\n\t\tinstaService.stub(IWorkspaceContextService, workspaceContextService);\n\n\t\ttestConfigService = new TestConfigurationService();\n\t\ttestConfigService.setUserConfiguration(PromptsConfig.USE_COPILOT_INSTRUCTION_FILES, true);\n\t\ttestConfigService.setUserConfiguration(PromptsConfig.USE_AGENT_MD, true);\n\t\ttestConfigService.setUserConfiguration(PromptsConfig.USE_NESTED_AGENT_MD, false);\n\t\ttestConfigService.setUserConfiguration(PromptsConfig.INSTRUCTIONS_LOCATION_KEY, { [INSTRUCTIONS_DEFAULT_SOURCE_FOLDER]: true });\n\t\ttestConfigService.setUserConfiguration(PromptsConfig.PROMPT_LOCATIONS_KEY, { [PROMPT_DEFAULT_SOURCE_FOLDER]: true });\n\t\ttestConfigService.setUserConfiguration(PromptsConfig.MODE_LOCATION_KEY, { [LEGACY_MODE_DEFAULT_SOURCE_FOLDER]: true });\n\n\t\tinstaService.stub(IConfigurationService, testConfigService);\n\t\tinstaService.stub(IWorkbenchEnvironmentService, {});\n\t\tinstaService.stub(IUserDataProfileService, new TestUserDataProfileService());\n\t\tinstaService.stub(ITelemetryService, NullTelemetryService);\n\t\tinstaService.stub(IStorageService, InMemoryStorageService);\n\n\t\tfileService = disposables.add(instaService.createInstance(FileService));\n\t\tinstaService.stub(IFileService, fileService);\n\n\t\tconst modelService = disposables.add(instaService.createInstance(ModelService));\n\t\tinstaService.stub(IModelService, modelService);\n\t\tinstaService.stub(ILanguageService, {\n\t\t\tguessLanguageIdByFilepathOrFirstLine(uri: URI) {\n\t\t\t\tif (uri.path.endsWith(PROMPT_FILE_EXTENSION)) {\n\t\t\t\t\treturn PROMPT_LANGUAGE_ID;\n\t\t\t\t}\n\n\t\t\t\tif (uri.path.endsWith(INSTRUCTION_FILE_EXTENSION)) {\n\t\t\t\t\treturn INSTRUCTIONS_LANGUAGE_ID;\n\t\t\t\t}\n\n\t\t\t\treturn 'plaintext';\n\t\t\t}\n\t\t});\n\t\tinstaService.stub(ILabelService, { getUriLabel: (uri: URI) => uri.path });\n\n\t\tconst fileSystemProvider = disposables.add(new InMemoryFileSystemProvider());\n\t\tdisposables.add(fileService.registerProvider(Schemas.file, fileSystemProvider));\n\n\t\tinstaService.stub(IFilesConfigurationService, { updateReadonly: () => Promise.resolve() });\n\n\t\tconst pathService = {\n\t\t\tuserHome: (): URI | Promise<URI> => {\n\t\t\t\treturn Promise.resolve(URI.file('/home/user'));\n\t\t\t},\n\t\t} as IPathService;\n\t\tinstaService.stub(IPathService, pathService);\n\n\t\tinstaService.stub(ISearchService, {});\n\n\t\tservice = disposables.add(instaService.createInstance(PromptsService));\n\t\tinstaService.stub(IPromptsService, service);\n\t});\n\n\tsuite('parse', () => {\n\t\ttest('explicit', async function () {\n\t\t\tconst rootFolderName = 'resolves-nested-file-references';\n\t\t\tconst rootFolder = `/${rootFolderName}`;\n\n\t\t\tconst rootFileName = 'file2.prompt.md';\n\n\t\t\tconst rootFolderUri = URI.file(rootFolder);\n\n\t\t\tworkspaceContextService.setWorkspace(testWorkspace(rootFolderUri));\n\n\t\t\tconst rootFileUri = URI.joinPath(rootFolderUri, rootFileName);\n\n\t\t\tawait mockFiles(fileService, [\n\t\t\t\t{\n\t\t\t\t\tpath: `${rootFolder}/file1.prompt.md`,\n\t\t\t\t\tcontents: [\n\t\t\t\t\t\t'## Some Header',\n\t\t\t\t\t\t'some contents',\n\t\t\t\t\t\t' ',\n\t\t\t\t\t],\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tpath: `${rootFolder}/${rootFileName}`,\n\t\t\t\t\tcontents: [\n\t\t\t\t\t\t'---',\n\t\t\t\t\t\t'description: \\'Root prompt description.\\'',\n\t\t\t\t\t\t'tools: [\\'my-tool1\\', , true]',\n\t\t\t\t\t\t'agent: \"agent\" ',\n\t\t\t\t\t\t'---',\n\t\t\t\t\t\t'## Files',\n\t\t\t\t\t\t'\\t- this file #file:folder1/file3.prompt.md ',\n\t\t\t\t\t\t'\\t- also this [file4.prompt.md](./folder1/some-other-folder/file4.prompt.md) please!',\n\t\t\t\t\t\t'## Vars',\n\t\t\t\t\t\t'\\t- #tool:my-tool',\n\t\t\t\t\t\t'\\t- #tool:my-other-tool',\n\t\t\t\t\t\t' ',\n\t\t\t\t\t],\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tpath: `${rootFolder}/folder1/file3.prompt.md`,\n\t\t\t\t\tcontents: [\n\t\t\t\t\t\t'---',\n\t\t\t\t\t\t'tools: [ false, \\'my-tool1\\' , ]',\n\t\t\t\t\t\t'agent: \\'edit\\'',\n\t\t\t\t\t\t'---',\n\t\t\t\t\t\t'',\n\t\t\t\t\t\t'[](./some-other-folder/non-existing-folder)',\n\t\t\t\t\t\t`\\t- some seemingly random #file:${rootFolder}/folder1/some-other-folder/yetAnotherFolder五/another-file.instructions.md contents`,\n\t\t\t\t\t\t' some more\\t content',\n\t\t\t\t\t],\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tpath: `${rootFolder}/folder1/some-other-folder/file4.prompt.md`,\n\t\t\t\t\tcontents: [\n\t\t\t\t\t\t'---',\n\t\t\t\t\t\t'tools: [\\'my-tool1\\', \"my-tool2\", true, , ]',\n\t\t\t\t\t\t'something: true',\n\t\t\t\t\t\t'agent: \\'ask\\'\\t',\n\t\t\t\t\t\t'description: \"File 4 splendid description.\"',\n\t\t\t\t\t\t'---',\n\t\t\t\t\t\t'this file has a non-existing #file:./some-non-existing/file.prompt.md\\t\\treference',\n\t\t\t\t\t\t'',\n\t\t\t\t\t\t'',\n\t\t\t\t\t\t'and some',\n\t\t\t\t\t\t' non-prompt #file:./some-non-prompt-file.md\\t\\t \\t[](../../folder1/)\\t',\n\t\t\t\t\t],\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tpath: `${rootFolder}/folder1/some-other-folder/file.txt`,\n\t\t\t\t\tcontents: [\n\t\t\t\t\t\t'---',\n\t\t\t\t\t\t'description: \"Non-prompt file description\".',\n\t\t\t\t\t\t'tools: [\"my-tool-24\"]',\n\t\t\t\t\t\t'---',\n\t\t\t\t\t],\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tpath: `${rootFolder}/folder1/some-other-folder/yetAnotherFolder五/another-file.instructions.md`,\n\t\t\t\t\tcontents: [\n\t\t\t\t\t\t'---',\n\t\t\t\t\t\t'description: \"Another file description.\"',\n\t\t\t\t\t\t'tools: [\\'my-tool3\\', false, \"my-tool2\" ]',\n\t\t\t\t\t\t'applyTo: \"**/*.tsx\"',\n\t\t\t\t\t\t'---',\n\t\t\t\t\t\t`[](${rootFolder}/folder1/some-other-folder)`,\n\t\t\t\t\t\t'another-file.instructions.md contents\\t [#file:file.txt](../file.txt)',\n\t\t\t\t\t],\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tpath: `${rootFolder}/folder1/some-other-folder/yetAnotherFolder五/one_more_file_just_in_case.prompt.md`,\n\t\t\t\t\tcontents: ['one_more_file_just_in_case.prompt.md contents'],\n\t\t\t\t},\n\t\t\t]);\n\n\t\t\tconst file3 = URI.joinPath(rootFolderUri, 'folder1/file3.prompt.md');\n\t\t\tconst file4 = URI.joinPath(rootFolderUri, 'folder1/some-other-folder/file4.prompt.md');\n\t\t\tconst someOtherFolder = URI.joinPath(rootFolderUri, '/folder1/some-other-folder');\n\t\t\tconst someOtherFolderFile = URI.joinPath(rootFolderUri, '/folder1/some-other-folder/file.txt');\n\t\t\tconst nonExistingFolder = URI.joinPath(rootFolderUri, 'folder1/some-other-folder/non-existing-folder');\n\t\t\tconst yetAnotherFile = URI.joinPath(rootFolderUri, 'folder1/some-other-folder/yetAnotherFolder五/another-file.instructions.md');\n\n\n\t\t\tconst result1 = await service.parseNew(rootFileUri, CancellationToken.None);\n\t\t\tassert.deepEqual(result1.uri, rootFileUri);\n\t\t\tassert.deepEqual(result1.header?.description, 'Root prompt description.');\n\t\t\tassert.deepEqual(result1.header?.tools, ['my-tool1']);\n\t\t\tassert.deepEqual(result1.header?.agent, 'agent');\n\t\t\tassert.ok(result1.body);\n\t\t\tassert.deepEqual(\n\t\t\t\tresult1.body.fileReferences.map(r => result1.body?.resolveFilePath(r.content)),\n\t\t\t\t[file3, file4],\n\t\t\t);\n\t\t\tassert.deepEqual(\n\t\t\t\tresult1.body.variableReferences,\n\t\t\t\t[\n\t\t\t\t\t{ name: 'my-tool', range: new Range(10, 10, 10, 17), offset: 240 },\n\t\t\t\t\t{ name: 'my-other-tool', range: new Range(11, 10, 11, 23), offset: 257 },\n\t\t\t\t]\n\t\t\t);\n\n\t\t\tconst result2 = await service.parseNew(file3, CancellationToken.None);\n\t\t\tassert.deepEqual(result2.uri, file3);\n\t\t\tassert.deepEqual(result2.header?.agent, 'edit');\n\t\t\tassert.ok(result2.body);\n\t\t\tassert.deepEqual(\n\t\t\t\tresult2.body.fileReferences.map(r => result2.body?.resolveFilePath(r.content)),\n\t\t\t\t[nonExistingFolder, yetAnotherFile],\n\t\t\t);\n\n\t\t\tconst result3 = await service.parseNew(yetAnotherFile, CancellationToken.None);\n\t\t\tassert.deepEqual(result3.uri, yetAnotherFile);\n\t\t\tassert.deepEqual(result3.header?.description, 'Another file description.');\n\t\t\tassert.deepEqual(result3.header?.applyTo, '**/*.tsx');\n\t\t\tassert.ok(result3.body);\n\t\t\tassert.deepEqual(\n\t\t\t\tresult3.body.fileReferences.map(r => result3.body?.resolveFilePath(r.content)),\n\t\t\t\t[someOtherFolder, someOtherFolderFile],\n\t\t\t);\n\t\t\tassert.deepEqual(result3.body.variableReferences, []);\n\n\t\t\tconst result4 = await service.parseNew(file4, CancellationToken.None);\n\t\t\tassert.deepEqual(result4.uri, file4);\n\t\t\tassert.deepEqual(result4.header?.description, 'File 4 splendid description.');\n\t\t\tassert.ok(result4.body);\n\t\t\tassert.deepEqual(\n\t\t\t\tresult4.body.fileReferences.map(r => result4.body?.resolveFilePath(r.content)),\n\t\t\t\t[\n\t\t\t\t\tURI.joinPath(rootFolderUri, '/folder1/some-other-folder/some-non-existing/file.prompt.md'),\n\t\t\t\t\tURI.joinPath(rootFolderUri, '/folder1/some-other-folder/some-non-prompt-file.md'),\n\t\t\t\t\tURI.joinPath(rootFolderUri, '/folder1/'),\n\t\t\t\t],\n\t\t\t);\n\t\t\tassert.deepEqual(result4.body.variableReferences, []);\n\t\t});\n\t});\n\n\tsuite('findInstructionFilesFor', () => {\n\t\tteardown(() => {\n\t\t\tsinon.restore();\n\t\t});\n\n\t\ttest('finds correct instruction files', async () => {\n\t\t\tconst rootFolderName = 'finds-instruction-files';\n\t\t\tconst rootFolder = `/${rootFolderName}`;\n\t\t\tconst rootFolderUri = URI.file(rootFolder);\n\n\t\t\tworkspaceContextService.setWorkspace(testWorkspace(rootFolderUri));\n\n\t\t\tconst userPromptsFolderName = '/tmp/user-data/prompts';\n\t\t\tconst userPromptsFolderUri = URI.file(userPromptsFolderName);\n\n\t\t\tsinon.stub(service, 'listPromptFiles')\n\t\t\t\t.returns(Promise.resolve([\n\t\t\t\t\t// local instructions\n\t\t\t\t\t{\n\t\t\t\t\t\turi: URI.joinPath(rootFolderUri, '.github/prompts/file1.instructions.md'),\n\t\t\t\t\t\tstorage: PromptsStorage.local,\n\t\t\t\t\t\ttype: PromptsType.instructions,\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\turi: URI.joinPath(rootFolderUri, '.github/prompts/file2.instructions.md'),\n\t\t\t\t\t\tstorage: PromptsStorage.local,\n\t\t\t\t\t\ttype: PromptsType.instructions,\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\turi: URI.joinPath(rootFolderUri, '.github/prompts/file3.instructions.md'),\n\t\t\t\t\t\tstorage: PromptsStorage.local,\n\t\t\t\t\t\ttype: PromptsType.instructions,\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\turi: URI.joinPath(rootFolderUri, '.github/prompts/file4.instructions.md'),\n\t\t\t\t\t\tstorage: PromptsStorage.local,\n\t\t\t\t\t\ttype: PromptsType.instructions,\n\t\t\t\t\t},\n\t\t\t\t\t// user instructions\n\t\t\t\t\t{\n\t\t\t\t\t\turi: URI.joinPath(userPromptsFolderUri, 'file10.instructions.md'),\n\t\t\t\t\t\tstorage: PromptsStorage.user,\n\t\t\t\t\t\ttype: PromptsType.instructions,\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\turi: URI.joinPath(userPromptsFolderUri, 'file11.instructions.md'),\n\t\t\t\t\t\tstorage: PromptsStorage.user,\n\t\t\t\t\t\ttype: PromptsType.instructions,\n\t\t\t\t\t},\n\t\t\t\t]));\n\n\t\t\t// mock current workspace file structure\n\t\t\tawait mockFiles(fileService, [\n\t\t\t\t{\n\t\t\t\t\tpath: `${rootFolder}/file1.prompt.md`,\n\t\t\t\t\tcontents: [\n\t\t\t\t\t\t'## Some Header',\n\t\t\t\t\t\t'some contents',\n\t\t\t\t\t\t' ',\n\t\t\t\t\t]\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tpath: `${rootFolder}/.github/prompts/file1.instructions.md`,\n\t\t\t\t\tcontents: [\n\t\t\t\t\t\t'---',\n\t\t\t\t\t\t'description: \\'Instructions file 1.\\'',\n\t\t\t\t\t\t'applyTo: \"**/*.tsx\"',\n\t\t\t\t\t\t'---',\n\t\t\t\t\t\t'Some instructions 1 contents.',\n\t\t\t\t\t]\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tpath: `${rootFolder}/.github/prompts/file2.instructions.md`,\n\t\t\t\t\tcontents: [\n\t\t\t\t\t\t'---',\n\t\t\t\t\t\t'description: \\'Instructions file 2.\\'',\n\t\t\t\t\t\t'applyTo: \"**/folder1/*.tsx\"',\n\t\t\t\t\t\t'---',\n\t\t\t\t\t\t'Some instructions 2 contents.',\n\t\t\t\t\t]\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tpath: `${rootFolder}/.github/prompts/file3.instructions.md`,\n\t\t\t\t\tcontents: [\n\t\t\t\t\t\t'---',\n\t\t\t\t\t\t'description: \\'Instructions file 3.\\'',\n\t\t\t\t\t\t'applyTo: \"**/folder2/*.tsx\"',\n\t\t\t\t\t\t'---',\n\t\t\t\t\t\t'Some instructions 3 contents.',\n\t\t\t\t\t]\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tpath: `${rootFolder}/.github/prompts/file4.instructions.md`,\n\t\t\t\t\tcontents: [\n\t\t\t\t\t\t'---',\n\t\t\t\t\t\t'description: \\'Instructions file 4.\\'',\n\t\t\t\t\t\t'applyTo: \"src/build/*.tsx\"',\n\t\t\t\t\t\t'---',\n\t\t\t\t\t\t'Some instructions 4 contents.',\n\t\t\t\t\t]\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tpath: `${rootFolder}/.github/prompts/file5.prompt.md`,\n\t\t\t\t\tcontents: [\n\t\t\t\t\t\t'---',\n\t\t\t\t\t\t'description: \\'Prompt file 5.\\'',\n\t\t\t\t\t\t'---',\n\t\t\t\t\t\t'Some prompt 5 contents.',\n\t\t\t\t\t]\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tpath: `${rootFolder}/folder1/main.tsx`,\n\t\t\t\t\tcontents: [\n\t\t\t\t\t\t'console.log(\"Haalou!\")'\n\t\t\t\t\t]\n\t\t\t\t}\n\t\t\t]);\n\n\t\t\t// mock user data instructions\n\t\t\tawait mockFiles(fileService, [\n\t\t\t\t{\n\t\t\t\t\tpath: `${userPromptsFolderName}/file10.instructions.md`,\n\t\t\t\t\tcontents: [\n\t\t\t\t\t\t'---',\n\t\t\t\t\t\t'description: \\'Instructions file 10.\\'',\n\t\t\t\t\t\t'applyTo: \"**/folder1/*.tsx\"',\n\t\t\t\t\t\t'---',\n\t\t\t\t\t\t'Some instructions 10 contents.',\n\t\t\t\t\t]\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tpath: `${userPromptsFolderName}/file11.instructions.md`,\n\t\t\t\t\tcontents: [\n\t\t\t\t\t\t'---',\n\t\t\t\t\t\t'description: \\'Instructions file 11.\\'',\n\t\t\t\t\t\t'applyTo: \"**/folder1/*.py\"',\n\t\t\t\t\t\t'---',\n\t\t\t\t\t\t'Some instructions 11 contents.',\n\t\t\t\t\t]\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tpath: `${userPromptsFolderName}/file12.prompt.md`,\n\t\t\t\t\tcontents: [\n\t\t\t\t\t\t'---',\n\t\t\t\t\t\t'description: \\'Prompt file 12.\\'',\n\t\t\t\t\t\t'---',\n\t\t\t\t\t\t'Some prompt 12 contents.',\n\t\t\t\t\t]\n\t\t\t\t}\n\t\t\t]);\n\n\t\t\tconst instructionFiles = await service.listPromptFiles(PromptsType.instructions, CancellationToken.None);\n\t\t\tconst contextComputer = instaService.createInstance(ComputeAutomaticInstructions, undefined);\n\t\t\tconst context = {\n\t\t\t\tfiles: new ResourceSet([\n\t\t\t\t\tURI.joinPath(rootFolderUri, 'folder1/main.tsx'),\n\t\t\t\t]),\n\t\t\t\tinstructions: new ResourceSet(),\n\t\t\t};\n\t\t\tconst result = new ChatRequestVariableSet();\n\n\t\t\tawait contextComputer.addApplyingInstructions(instructionFiles, context, result, newInstructionsCollectionEvent(), CancellationToken.None);\n\n\t\t\tassert.deepStrictEqual(\n\t\t\t\tresult.asArray().map(i => isPromptFileVariableEntry(i) ? i.value.path : undefined),\n\t\t\t\t[\n\t\t\t\t\t// local instructions\n\t\t\t\t\tURI.joinPath(rootFolderUri, '.github/prompts/file1.instructions.md').path,\n\t\t\t\t\tURI.joinPath(rootFolderUri, '.github/prompts/file2.instructions.md').path,\n\t\t\t\t\t// user instructions\n\t\t\t\t\tURI.joinPath(userPromptsFolderUri, 'file10.instructions.md').path,\n\t\t\t\t],\n\t\t\t\t'Must find correct instruction files.',\n\t\t\t);\n\t\t});\n\n\t\ttest('does not have duplicates', async () => {\n\t\t\tconst rootFolderName = 'finds-instruction-files-without-duplicates';\n\t\t\tconst rootFolder = `/${rootFolderName}`;\n\t\t\tconst rootFolderUri = URI.file(rootFolder);\n\n\t\t\tworkspaceContextService.setWorkspace(testWorkspace(rootFolderUri));\n\n\t\t\tconst userPromptsFolderName = '/tmp/user-data/prompts';\n\t\t\tconst userPromptsFolderUri = URI.file(userPromptsFolderName);\n\n\t\t\tsinon.stub(service, 'listPromptFiles')\n\t\t\t\t.returns(Promise.resolve([\n\t\t\t\t\t// local instructions\n\t\t\t\t\t{\n\t\t\t\t\t\turi: URI.joinPath(rootFolderUri, '.github/prompts/file1.instructions.md'),\n\t\t\t\t\t\tstorage: PromptsStorage.local,\n\t\t\t\t\t\ttype: PromptsType.instructions,\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\turi: URI.joinPath(rootFolderUri, '.github/prompts/file2.instructions.md'),\n\t\t\t\t\t\tstorage: PromptsStorage.local,\n\t\t\t\t\t\ttype: PromptsType.instructions,\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\turi: URI.joinPath(rootFolderUri, '.github/prompts/file3.instructions.md'),\n\t\t\t\t\t\tstorage: PromptsStorage.local,\n\t\t\t\t\t\ttype: PromptsType.instructions,\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\turi: URI.joinPath(rootFolderUri, '.github/prompts/file4.instructions.md'),\n\t\t\t\t\t\tstorage: PromptsStorage.local,\n\t\t\t\t\t\ttype: PromptsType.instructions,\n\t\t\t\t\t},\n\t\t\t\t\t// user instructions\n\t\t\t\t\t{\n\t\t\t\t\t\turi: URI.joinPath(userPromptsFolderUri, 'file10.instructions.md'),\n\t\t\t\t\t\tstorage: PromptsStorage.user,\n\t\t\t\t\t\ttype: PromptsType.instructions,\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\turi: URI.joinPath(userPromptsFolderUri, 'file11.instructions.md'),\n\t\t\t\t\t\tstorage: PromptsStorage.user,\n\t\t\t\t\t\ttype: PromptsType.instructions,\n\t\t\t\t\t},\n\t\t\t\t]));\n\n\t\t\t// mock current workspace file structure\n\t\t\tawait mockFiles(fileService, [\n\t\t\t\t{\n\t\t\t\t\tpath: `${rootFolder}/file1.prompt.md`,\n\t\t\t\t\tcontents: [\n\t\t\t\t\t\t'## Some Header',\n\t\t\t\t\t\t'some contents',\n\t\t\t\t\t\t' ',\n\t\t\t\t\t]\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tpath: `${rootFolder}/.github/prompts/file1.instructions.md`,\n\t\t\t\t\tcontents: [\n\t\t\t\t\t\t'---',\n\t\t\t\t\t\t'description: \\'Instructions file 1.\\'',\n\t\t\t\t\t\t'applyTo: \"**/*.tsx\"',\n\t\t\t\t\t\t'---',\n\t\t\t\t\t\t'Some instructions 1 contents.',\n\t\t\t\t\t]\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tpath: `${rootFolder}/.github/prompts/file2.instructions.md`,\n\t\t\t\t\tcontents: [\n\t\t\t\t\t\t'---',\n\t\t\t\t\t\t'description: \\'Instructions file 2.\\'',\n\t\t\t\t\t\t'applyTo: \"**/folder1/*.tsx\"',\n\t\t\t\t\t\t'---',\n\t\t\t\t\t\t'Some instructions 2 contents. [](./file1.instructions.md)',\n\t\t\t\t\t]\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tpath: `${rootFolder}/.github/prompts/file3.instructions.md`,\n\t\t\t\t\tcontents: [\n\t\t\t\t\t\t'---',\n\t\t\t\t\t\t'description: \\'Instructions file 3.\\'',\n\t\t\t\t\t\t'applyTo: \"**/folder2/*.tsx\"',\n\t\t\t\t\t\t'---',\n\t\t\t\t\t\t'Some instructions 3 contents.',\n\t\t\t\t\t]\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tpath: `${rootFolder}/.github/prompts/file4.instructions.md`,\n\t\t\t\t\tcontents: [\n\t\t\t\t\t\t'---',\n\t\t\t\t\t\t'description: \\'Instructions file 4.\\'',\n\t\t\t\t\t\t'applyTo: \"src/build/*.tsx\"',\n\t\t\t\t\t\t'---',\n\t\t\t\t\t\t'[](./file3.instructions.md) Some instructions 4 contents.',\n\t\t\t\t\t]\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tpath: `${rootFolder}/.github/prompts/file5.prompt.md`,\n\t\t\t\t\tcontents: [\n\t\t\t\t\t\t'---',\n\t\t\t\t\t\t'description: \\'Prompt file 5.\\'',\n\t\t\t\t\t\t'---',\n\t\t\t\t\t\t'Some prompt 5 contents.',\n\t\t\t\t\t]\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tpath: `${rootFolder}/folder1/main.tsx`,\n\t\t\t\t\tcontents: [\n\t\t\t\t\t\t'console.log(\"Haalou!\")'\n\t\t\t\t\t]\n\t\t\t\t}\n\t\t\t]);\n\n\t\t\t// mock user data instructions\n\t\t\tawait mockFiles(fileService, [\n\t\t\t\t{\n\t\t\t\t\tpath: `${userPromptsFolderName}/file10.instructions.md`,\n\t\t\t\t\tcontents: [\n\t\t\t\t\t\t'---',\n\t\t\t\t\t\t'description: \\'Instructions file 10.\\'',\n\t\t\t\t\t\t'applyTo: \"**/folder1/*.tsx\"',\n\t\t\t\t\t\t'---',\n\t\t\t\t\t\t'Some instructions 10 contents.',\n\t\t\t\t\t]\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tpath: `${userPromptsFolderName}/file11.instructions.md`,\n\t\t\t\t\tcontents: [\n\t\t\t\t\t\t'---',\n\t\t\t\t\t\t'description: \\'Instructions file 11.\\'',\n\t\t\t\t\t\t'applyTo: \"**/folder1/*.py\"',\n\t\t\t\t\t\t'---',\n\t\t\t\t\t\t'Some instructions 11 contents.',\n\t\t\t\t\t]\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tpath: `${userPromptsFolderName}/file12.prompt.md`,\n\t\t\t\t\tcontents: [\n\t\t\t\t\t\t'---',\n\t\t\t\t\t\t'description: \\'Prompt file 12.\\'',\n\t\t\t\t\t\t'---',\n\t\t\t\t\t\t'Some prompt 12 contents.',\n\t\t\t\t\t]\n\t\t\t\t}\n\t\t\t]);\n\n\t\t\tconst instructionFiles = await service.listPromptFiles(PromptsType.instructions, CancellationToken.None);\n\t\t\tconst contextComputer = instaService.createInstance(ComputeAutomaticInstructions, undefined);\n\t\t\tconst context = {\n\t\t\t\tfiles: new ResourceSet([\n\t\t\t\t\tURI.joinPath(rootFolderUri, 'folder1/main.tsx'),\n\t\t\t\t\tURI.joinPath(rootFolderUri, 'folder1/index.tsx'),\n\t\t\t\t\tURI.joinPath(rootFolderUri, 'folder1/constants.tsx'),\n\t\t\t\t]),\n\t\t\t\tinstructions: new ResourceSet(),\n\t\t\t};\n\n\t\t\tconst result = new ChatRequestVariableSet();\n\t\t\tawait contextComputer.addApplyingInstructions(instructionFiles, context, result, newInstructionsCollectionEvent(), CancellationToken.None);\n\n\t\t\tassert.deepStrictEqual(\n\t\t\t\tresult.asArray().map(i => isPromptFileVariableEntry(i) ? i.value.path : undefined),\n\t\t\t\t[\n\t\t\t\t\t// local instructions\n\t\t\t\t\tURI.joinPath(rootFolderUri, '.github/prompts/file1.instructions.md').path,\n\t\t\t\t\tURI.joinPath(rootFolderUri, '.github/prompts/file2.instructions.md').path,\n\t\t\t\t\t// user instructions\n\t\t\t\t\tURI.joinPath(userPromptsFolderUri, 'file10.instructions.md').path,\n\t\t\t\t],\n\t\t\t\t'Must find correct instruction files.',\n\t\t\t);\n\t\t});\n\n\t\ttest('copilot-instructions and AGENTS.md', async () => {\n\t\t\tconst rootFolderName = 'copilot-instructions-and-agents';\n\t\t\tconst rootFolder = `/${rootFolderName}`;\n\t\t\tconst rootFolderUri = URI.file(rootFolder);\n\n\t\t\tworkspaceContextService.setWorkspace(testWorkspace(rootFolderUri));\n\n\t\t\t// mock current workspace file structure\n\t\t\tawait mockFiles(fileService, [\n\t\t\t\t{\n\t\t\t\t\tpath: `${rootFolder}/codestyle.md`,\n\t\t\t\t\tcontents: [\n\t\t\t\t\t\t'Can you see this?',\n\t\t\t\t\t]\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tpath: `${rootFolder}/AGENTS.md`,\n\t\t\t\t\tcontents: [\n\t\t\t\t\t\t'What about this?',\n\t\t\t\t\t]\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tpath: `${rootFolder}/README.md`,\n\t\t\t\t\tcontents: [\n\t\t\t\t\t\t'Thats my project?',\n\t\t\t\t\t]\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tpath: `${rootFolder}/.github/copilot-instructions.md`,\n\t\t\t\t\tcontents: [\n\t\t\t\t\t\t'Be nice and friendly. Also look at instructions at #file:../codestyle.md and [more-codestyle.md](./more-codestyle.md).',\n\t\t\t\t\t]\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tpath: `${rootFolder}/.github/more-codestyle.md`,\n\t\t\t\t\tcontents: [\n\t\t\t\t\t\t'I like it clean.',\n\t\t\t\t\t]\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tpath: `${rootFolder}/folder1/AGENTS.md`,\n\t\t\t\t\tcontents: [\n\t\t\t\t\t\t'An AGENTS.md file in another repo'\n\t\t\t\t\t]\n\t\t\t\t}\n\t\t\t]);\n\n\n\t\t\tconst contextComputer = instaService.createInstance(ComputeAutomaticInstructions, undefined);\n\t\t\tconst context = new ChatRequestVariableSet();\n\t\t\tcontext.add(toFileVariableEntry(URI.joinPath(rootFolderUri, 'README.md')));\n\n\t\t\tawait contextComputer.collect(context, CancellationToken.None);\n\n\t\t\tassert.deepStrictEqual(\n\t\t\t\tcontext.asArray().map(i => isPromptFileVariableEntry(i) ? i.value.path : undefined).filter(e => !!e).sort(),\n\t\t\t\t[\n\t\t\t\t\tURI.joinPath(rootFolderUri, '.github/copilot-instructions.md').path,\n\t\t\t\t\tURI.joinPath(rootFolderUri, '.github/more-codestyle.md').path,\n\t\t\t\t\tURI.joinPath(rootFolderUri, 'AGENTS.md').path,\n\t\t\t\t\tURI.joinPath(rootFolderUri, 'codestyle.md').path,\n\t\t\t\t].sort(),\n\t\t\t\t'Must find correct instruction files.',\n\t\t\t);\n\t\t});\n\t});\n\n\tsuite('getCustomAgents', () => {\n\t\tteardown(() => {\n\t\t\tsinon.restore();\n\t\t});\n\n\n\t\ttest('header with handOffs', async () => {\n\t\t\tconst rootFolderName = 'custom-agents-with-handoffs';\n\t\t\tconst rootFolder = `/${rootFolderName}`;\n\t\t\tconst rootFolderUri = URI.file(rootFolder);\n\n\t\t\tworkspaceContextService.setWorkspace(testWorkspace(rootFolderUri));\n\n\t\t\tawait mockFiles(fileService, [\n\t\t\t\t{\n\t\t\t\t\tpath: `${rootFolder}/.github/agents/agent1.agent.md`,\n\t\t\t\t\tcontents: [\n\t\t\t\t\t\t'---',\n\t\t\t\t\t\t'description: \\'Agent file 1.\\'',\n\t\t\t\t\t\t'handoffs: [ { agent: \"Edit\", label: \"Do it\", prompt: \"Do it now\" } ]',\n\t\t\t\t\t\t'---',\n\t\t\t\t\t]\n\t\t\t\t}\n\t\t\t]);\n\n\t\t\tconst result = (await service.getCustomAgents(CancellationToken.None)).map(agent => ({ ...agent, uri: URI.from(agent.uri) }));\n\t\t\tconst expected: ICustomAgent[] = [\n\t\t\t\t{\n\t\t\t\t\tname: 'agent1',\n\t\t\t\t\tdescription: 'Agent file 1.',\n\t\t\t\t\thandOffs: [{ agent: 'Edit', label: 'Do it', prompt: 'Do it now', send: undefined }],\n\t\t\t\t\tagentInstructions: {\n\t\t\t\t\t\tcontent: '',\n\t\t\t\t\t\ttoolReferences: [],\n\t\t\t\t\t\tmetadata: undefined\n\t\t\t\t\t},\n\t\t\t\t\tmodel: undefined,\n\t\t\t\t\targumentHint: undefined,\n\t\t\t\t\ttools: undefined,\n\t\t\t\t\ttarget: undefined,\n\t\t\t\t\turi: URI.joinPath(rootFolderUri, '.github/agents/agent1.agent.md'),\n\t\t\t\t\tsource: { storage: PromptsStorage.local }\n\t\t\t\t},\n\t\t\t];\n\n\t\t\tassert.deepEqual(\n\t\t\t\tresult,\n\t\t\t\texpected,\n\t\t\t\t'Must get custom agents.',\n\t\t\t);\n\t\t});\n\n\t\ttest('body with tool references', async () => {\n\t\t\tconst rootFolderName = 'custom-agents';\n\t\t\tconst rootFolder = `/${rootFolderName}`;\n\t\t\tconst rootFolderUri = URI.file(rootFolder);\n\n\t\t\tworkspaceContextService.setWorkspace(testWorkspace(rootFolderUri));\n\n\t\t\t// mock current workspace file structure\n\t\t\tawait mockFiles(fileService, [\n\t\t\t\t{\n\t\t\t\t\tpath: `${rootFolder}/.github/agents/agent1.agent.md`,\n\t\t\t\t\tcontents: [\n\t\t\t\t\t\t'---',\n\t\t\t\t\t\t'description: \\'Agent file 1.\\'',\n\t\t\t\t\t\t'tools: [ tool1, tool2 ]',\n\t\t\t\t\t\t'---',\n\t\t\t\t\t\t'Do it with #tool:tool1',\n\t\t\t\t\t]\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tpath: `${rootFolder}/.github/agents/agent2.agent.md`,\n\t\t\t\t\tcontents: [\n\t\t\t\t\t\t'First use #tool:tool2\\nThen use #tool:tool1',\n\t\t\t\t\t]\n\t\t\t\t}\n\t\t\t]);\n\n\t\t\tconst result = (await service.getCustomAgents(CancellationToken.None)).map(agent => ({ ...agent, uri: URI.from(agent.uri) }));\n\t\t\tconst expected: ICustomAgent[] = [\n\t\t\t\t{\n\t\t\t\t\tname: 'agent1',\n\t\t\t\t\tdescription: 'Agent file 1.',\n\t\t\t\t\ttools: ['tool1', 'tool2'],\n\t\t\t\t\tagentInstructions: {\n\t\t\t\t\t\tcontent: 'Do it with #tool:tool1',\n\t\t\t\t\t\ttoolReferences: [{ name: 'tool1', range: { start: 11, endExclusive: 17 } }],\n\t\t\t\t\t\tmetadata: undefined\n\t\t\t\t\t},\n\t\t\t\t\thandOffs: undefined,\n\t\t\t\t\tmodel: undefined,\n\t\t\t\t\targumentHint: undefined,\n\t\t\t\t\ttarget: undefined,\n\t\t\t\t\turi: URI.joinPath(rootFolderUri, '.github/agents/agent1.agent.md'),\n\t\t\t\t\tsource: { storage: PromptsStorage.local },\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tname: 'agent2',\n\t\t\t\t\tagentInstructions: {\n\t\t\t\t\t\tcontent: 'First use #tool:tool2\\nThen use #tool:tool1',\n\t\t\t\t\t\ttoolReferences: [\n\t\t\t\t\t\t\t{ name: 'tool1', range: { start: 31, endExclusive: 37 } },\n\t\t\t\t\t\t\t{ name: 'tool2', range: { start: 10, endExclusive: 16 } }\n\t\t\t\t\t\t],\n\t\t\t\t\t\tmetadata: undefined\n\t\t\t\t\t},\n\t\t\t\t\turi: URI.joinPath(rootFolderUri, '.github/agents/agent2.agent.md'),\n\t\t\t\t\tsource: { storage: PromptsStorage.local },\n\t\t\t\t}\n\t\t\t];\n\n\t\t\tassert.deepEqual(\n\t\t\t\tresult,\n\t\t\t\texpected,\n\t\t\t\t'Must get custom agents.',\n\t\t\t);\n\t\t});\n\n\t\ttest('header with argumentHint', async () => {\n\t\t\tconst rootFolderName = 'custom-agents-with-argument-hint';\n\t\t\tconst rootFolder = `/${rootFolderName}`;\n\t\t\tconst rootFolderUri = URI.file(rootFolder);\n\n\t\t\tworkspaceContextService.setWorkspace(testWorkspace(rootFolderUri));\n\n\t\t\tawait mockFiles(fileService, [\n\t\t\t\t{\n\t\t\t\t\tpath: `${rootFolder}/.github/agents/agent1.agent.md`,\n\t\t\t\t\tcontents: [\n\t\t\t\t\t\t'---',\n\t\t\t\t\t\t'description: \\'Code review agent.\\'',\n\t\t\t\t\t\t'argument-hint: \\'Provide file path or code snippet to review\\'',\n\t\t\t\t\t\t'tools: [ code-analyzer, linter ]',\n\t\t\t\t\t\t'---',\n\t\t\t\t\t\t'I will help review your code for best practices.',\n\t\t\t\t\t]\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tpath: `${rootFolder}/.github/agents/agent2.agent.md`,\n\t\t\t\t\tcontents: [\n\t\t\t\t\t\t'---',\n\t\t\t\t\t\t'description: \\'Documentation generator.\\'',\n\t\t\t\t\t\t'argument-hint: \\'Specify function or class name to document\\'',\n\t\t\t\t\t\t'---',\n\t\t\t\t\t\t'I generate comprehensive documentation.',\n\t\t\t\t\t]\n\t\t\t\t}\n\t\t\t]);\n\n\t\t\tconst result = (await service.getCustomAgents(CancellationToken.None)).map(agent => ({ ...agent, uri: URI.from(agent.uri) }));\n\t\t\tconst expected: ICustomAgent[] = [\n\t\t\t\t{\n\t\t\t\t\tname: 'agent1',\n\t\t\t\t\tdescription: 'Code review agent.',\n\t\t\t\t\targumentHint: 'Provide file path or code snippet to review',\n\t\t\t\t\ttools: ['code-analyzer', 'linter'],\n\t\t\t\t\tagentInstructions: {\n\t\t\t\t\t\tcontent: 'I will help review your code for best practices.',\n\t\t\t\t\t\ttoolReferences: [],\n\t\t\t\t\t\tmetadata: undefined\n\t\t\t\t\t},\n\t\t\t\t\thandOffs: undefined,\n\t\t\t\t\tmodel: undefined,\n\t\t\t\t\ttarget: undefined,\n\t\t\t\t\turi: URI.joinPath(rootFolderUri, '.github/agents/agent1.agent.md'),\n\t\t\t\t\tsource: { storage: PromptsStorage.local }\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tname: 'agent2',\n\t\t\t\t\tdescription: 'Documentation generator.',\n\t\t\t\t\targumentHint: 'Specify function or class name to document',\n\t\t\t\t\tagentInstructions: {\n\t\t\t\t\t\tcontent: 'I generate comprehensive documentation.',\n\t\t\t\t\t\ttoolReferences: [],\n\t\t\t\t\t\tmetadata: undefined\n\t\t\t\t\t},\n\t\t\t\t\thandOffs: undefined,\n\t\t\t\t\tmodel: undefined,\n\t\t\t\t\ttools: undefined,\n\t\t\t\t\ttarget: undefined,\n\t\t\t\t\turi: URI.joinPath(rootFolderUri, '.github/agents/agent2.agent.md'),\n\t\t\t\t\tsource: { storage: PromptsStorage.local }\n\t\t\t\t},\n\t\t\t];\n\n\t\t\tassert.deepEqual(\n\t\t\t\tresult,\n\t\t\t\texpected,\n\t\t\t\t'Must get custom agents with argumentHint.',\n\t\t\t);\n\t\t});\n\n\t\ttest('header with target', async () => {\n\t\t\tconst rootFolderName = 'custom-agents-with-target';\n\t\t\tconst rootFolder = `/${rootFolderName}`;\n\t\t\tconst rootFolderUri = URI.file(rootFolder);\n\n\t\t\tworkspaceContextService.setWorkspace(testWorkspace(rootFolderUri));\n\n\t\t\tawait mockFiles(fileService, [\n\t\t\t\t{\n\t\t\t\t\tpath: `${rootFolder}/.github/agents/github-agent.agent.md`,\n\t\t\t\t\tcontents: [\n\t\t\t\t\t\t'---',\n\t\t\t\t\t\t'description: \\'GitHub Copilot specialized agent.\\'',\n\t\t\t\t\t\t'target: \\'github-copilot\\'',\n\t\t\t\t\t\t'tools: [ github-api, code-search ]',\n\t\t\t\t\t\t'---',\n\t\t\t\t\t\t'I am optimized for GitHub Copilot workflows.',\n\t\t\t\t\t]\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tpath: `${rootFolder}/.github/agents/vscode-agent.agent.md`,\n\t\t\t\t\tcontents: [\n\t\t\t\t\t\t'---',\n\t\t\t\t\t\t'description: \\'VS Code specialized agent.\\'',\n\t\t\t\t\t\t'target: \\'vscode\\'',\n\t\t\t\t\t\t'model: \\'gpt-4\\'',\n\t\t\t\t\t\t'---',\n\t\t\t\t\t\t'I am specialized for VS Code editor tasks.',\n\t\t\t\t\t]\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tpath: `${rootFolder}/.github/agents/generic-agent.agent.md`,\n\t\t\t\t\tcontents: [\n\t\t\t\t\t\t'---',\n\t\t\t\t\t\t'description: \\'Generic agent without target.\\'',\n\t\t\t\t\t\t'---',\n\t\t\t\t\t\t'I work everywhere.',\n\t\t\t\t\t]\n\t\t\t\t}\n\t\t\t]);\n\n\t\t\tconst result = (await service.getCustomAgents(CancellationToken.None)).map(agent => ({ ...agent, uri: URI.from(agent.uri) }));\n\t\t\tconst expected: ICustomAgent[] = [\n\t\t\t\t{\n\t\t\t\t\tname: 'github-agent',\n\t\t\t\t\tdescription: 'GitHub Copilot specialized agent.',\n\t\t\t\t\ttarget: 'github-copilot',\n\t\t\t\t\ttools: ['github-api', 'code-search'],\n\t\t\t\t\tagentInstructions: {\n\t\t\t\t\t\tcontent: 'I am optimized for GitHub Copilot workflows.',\n\t\t\t\t\t\ttoolReferences: [],\n\t\t\t\t\t\tmetadata: undefined\n\t\t\t\t\t},\n\t\t\t\t\thandOffs: undefined,\n\t\t\t\t\tmodel: undefined,\n\t\t\t\t\targumentHint: undefined,\n\t\t\t\t\turi: URI.joinPath(rootFolderUri, '.github/agents/github-agent.agent.md'),\n\t\t\t\t\tsource: { storage: PromptsStorage.local }\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tname: 'vscode-agent',\n\t\t\t\t\tdescription: 'VS Code specialized agent.',\n\t\t\t\t\ttarget: 'vscode',\n\t\t\t\t\tmodel: 'gpt-4',\n\t\t\t\t\tagentInstructions: {\n\t\t\t\t\t\tcontent: 'I am specialized for VS Code editor tasks.',\n\t\t\t\t\t\ttoolReferences: [],\n\t\t\t\t\t\tmetadata: undefined\n\t\t\t\t\t},\n\t\t\t\t\thandOffs: undefined,\n\t\t\t\t\targumentHint: undefined,\n\t\t\t\t\ttools: undefined,\n\t\t\t\t\turi: URI.joinPath(rootFolderUri, '.github/agents/vscode-agent.agent.md'),\n\t\t\t\t\tsource: { storage: PromptsStorage.local }\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tname: 'generic-agent',\n\t\t\t\t\tdescription: 'Generic agent without target.',\n\t\t\t\t\tagentInstructions: {\n\t\t\t\t\t\tcontent: 'I work everywhere.',\n\t\t\t\t\t\ttoolReferences: [],\n\t\t\t\t\t\tmetadata: undefined\n\t\t\t\t\t},\n\t\t\t\t\thandOffs: undefined,\n\t\t\t\t\tmodel: undefined,\n\t\t\t\t\targumentHint: undefined,\n\t\t\t\t\ttools: undefined,\n\t\t\t\t\ttarget: undefined,\n\t\t\t\t\turi: URI.joinPath(rootFolderUri, '.github/agents/generic-agent.agent.md'),\n\t\t\t\t\tsource: { storage: PromptsStorage.local }\n\t\t\t\t},\n\t\t\t];\n\n\t\t\tassert.deepEqual(\n\t\t\t\tresult,\n\t\t\t\texpected,\n\t\t\t\t'Must get custom agents with target attribute.',\n\t\t\t);\n\t\t});\n\n\t\ttest('agents with .md extension (no .agent.md)', async () => {\n\t\t\tconst rootFolderName = 'custom-agents-md-extension';\n\t\t\tconst rootFolder = `/${rootFolderName}`;\n\t\t\tconst rootFolderUri = URI.file(rootFolder);\n\n\t\t\tworkspaceContextService.setWorkspace(testWorkspace(rootFolderUri));\n\n\t\t\tawait mockFiles(fileService, [\n\t\t\t\t{\n\t\t\t\t\tpath: `${rootFolder}/.github/agents/demonstrate.md`,\n\t\t\t\t\tcontents: [\n\t\t\t\t\t\t'---',\n\t\t\t\t\t\t'description: \\'Demonstrate agent.\\'',\n\t\t\t\t\t\t'tools: [ demo-tool ]',\n\t\t\t\t\t\t'---',\n\t\t\t\t\t\t'This is a demonstration agent using .md extension.',\n\t\t\t\t\t]\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tpath: `${rootFolder}/.github/agents/test.md`,\n\t\t\t\t\tcontents: [\n\t\t\t\t\t\t'Test agent without header.',\n\t\t\t\t\t]\n\t\t\t\t}\n\t\t\t]);\n\n\t\t\tconst result = (await service.getCustomAgents(CancellationToken.None)).map(agent => ({ ...agent, uri: URI.from(agent.uri) }));\n\t\t\tconst expected: ICustomAgent[] = [\n\t\t\t\t{\n\t\t\t\t\tname: 'demonstrate',\n\t\t\t\t\tdescription: 'Demonstrate agent.',\n\t\t\t\t\ttools: ['demo-tool'],\n\t\t\t\t\tagentInstructions: {\n\t\t\t\t\t\tcontent: 'This is a demonstration agent using .md extension.',\n\t\t\t\t\t\ttoolReferences: [],\n\t\t\t\t\t\tmetadata: undefined\n\t\t\t\t\t},\n\t\t\t\t\thandOffs: undefined,\n\t\t\t\t\tmodel: undefined,\n\t\t\t\t\targumentHint: undefined,\n\t\t\t\t\ttarget: undefined,\n\t\t\t\t\turi: URI.joinPath(rootFolderUri, '.github/agents/demonstrate.md'),\n\t\t\t\t\tsource: { storage: PromptsStorage.local },\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tname: 'test',\n\t\t\t\t\tagentInstructions: {\n\t\t\t\t\t\tcontent: 'Test agent without header.',\n\t\t\t\t\t\ttoolReferences: [],\n\t\t\t\t\t\tmetadata: undefined\n\t\t\t\t\t},\n\t\t\t\t\turi: URI.joinPath(rootFolderUri, '.github/agents/test.md'),\n\t\t\t\t\tsource: { storage: PromptsStorage.local },\n\t\t\t\t}\n\t\t\t];\n\n\t\t\tassert.deepEqual(\n\t\t\t\tresult,\n\t\t\t\texpected,\n\t\t\t\t'Must get custom agents with .md extension from .github/agents/ folder.',\n\t\t\t);\n\t\t});\n\t});\n\n\tsuite('listPromptFiles - extensions', () => {\n\n\t\ttest('Contributed prompt file', async () => {\n\t\t\tconst uri = URI.parse('file://extensions/my-extension/textMate.instructions.md');\n\t\t\tconst extension = {} as IExtensionDescription;\n\t\t\tconst registered = service.registerContributedFile(PromptsType.instructions,\n\t\t\t\t'TextMate Instructions',\n\t\t\t\t'Instructions to follow when authoring TextMate grammars',\n\t\t\t\turi,\n\t\t\t\textension\n\t\t\t);\n\n\t\t\tconst actual = await service.listPromptFiles(PromptsType.instructions, CancellationToken.None);\n\t\t\tassert.strictEqual(actual.length, 1);\n\t\t\tassert.strictEqual(actual[0].uri.toString(), uri.toString());\n\t\t\tassert.strictEqual(actual[0].name, 'TextMate Instructions');\n\t\t\tassert.strictEqual(actual[0].storage, PromptsStorage.extension);\n\t\t\tassert.strictEqual(actual[0].type, PromptsType.instructions);\n\t\t\tregistered.dispose();\n\t\t});\n\t});\n\n\tsuite('findClaudeSkills', () => {\n\t\tteardown(() => {\n\t\t\tsinon.restore();\n\t\t});\n\n\t\ttest('should return undefined when USE_CLAUDE_SKILLS is disabled', async () => {\n\t\t\ttestConfigService.setUserConfiguration(PromptsConfig.USE_CLAUDE_SKILLS, false);\n\n\t\t\tconst result = await service.findClaudeSkills(CancellationToken.None);\n\t\t\tassert.strictEqual(result, undefined);\n\t\t});\n\n\t\ttest('should find Claude skills in workspace and user home', async () => {\n\t\t\ttestConfigService.setUserConfiguration(PromptsConfig.USE_CLAUDE_SKILLS, true);\n\n\t\t\tconst rootFolderName = 'claude-skills-test';\n\t\t\tconst rootFolder = `/${rootFolderName}`;\n\t\t\tconst rootFolderUri = URI.file(rootFolder);\n\n\t\t\tworkspaceContextService.setWorkspace(testWorkspace(rootFolderUri));\n\n\t\t\t// Create mock filesystem with skills\n\t\t\tawait mockFiles(fileService, [\n\t\t\t\t{\n\t\t\t\t\tpath: `${rootFolder}/.claude/skills/project-skill-1/SKILL.md`,\n\t\t\t\t\tcontents: [\n\t\t\t\t\t\t'---',\n\t\t\t\t\t\t'name: \"Project Skill 1\"',\n\t\t\t\t\t\t'description: \"A project skill for testing\"',\n\t\t\t\t\t\t'---',\n\t\t\t\t\t\t'This is project skill 1 content',\n\t\t\t\t\t],\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tpath: `${rootFolder}/.claude/skills/project-skill-2/SKILL.md`,\n\t\t\t\t\tcontents: [\n\t\t\t\t\t\t'---',\n\t\t\t\t\t\t'description: \"Invalid skill, no name\"',\n\t\t\t\t\t\t'---',\n\t\t\t\t\t\t'This is project skill 2 content',\n\t\t\t\t\t],\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tpath: `${rootFolder}/.claude/skills/not-a-skill-dir/README.md`,\n\t\t\t\t\tcontents: ['This is not a skill'],\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tpath: '/home/user/.claude/skills/personal-skill-1/SKILL.md',\n\t\t\t\t\tcontents: [\n\t\t\t\t\t\t'---',\n\t\t\t\t\t\t'name: \"Personal Skill 1\"',\n\t\t\t\t\t\t'description: \"A personal skill for testing\"',\n\t\t\t\t\t\t'---',\n\t\t\t\t\t\t'This is personal skill 1 content',\n\t\t\t\t\t],\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tpath: '/home/user/.claude/skills/not-a-skill/other-file.md',\n\t\t\t\t\tcontents: ['Not a skill file'],\n\t\t\t\t},\n\t\t\t]);\n\n\t\t\tconst result = await service.findClaudeSkills(CancellationToken.None);\n\n\t\t\tassert.ok(result, 'Should return results when Claude skills are enabled');\n\t\t\tassert.strictEqual(result.length, 2, 'Should find 2 skills total');\n\n\t\t\t// Check project skills\n\t\t\tconst projectSkills = result.filter(skill => skill.type === 'project');\n\t\t\tassert.strictEqual(projectSkills.length, 1, 'Should find 1 project skill');\n\n\t\t\tconst projectSkill1 = projectSkills.find(skill => skill.name === 'Project Skill 1');\n\t\t\tassert.ok(projectSkill1, 'Should find project skill 1');\n\t\t\tassert.strictEqual(projectSkill1.description, 'A project skill for testing');\n\t\t\tassert.strictEqual(projectSkill1.uri.path, `${rootFolder}/.claude/skills/project-skill-1/SKILL.md`);\n\n\t\t\t// Check personal skills\n\t\t\tconst personalSkills = result.filter(skill => skill.type === 'personal');\n\t\t\tassert.strictEqual(personalSkills.length, 1, 'Should find 1 personal skill');\n\n\t\t\tconst personalSkill1 = personalSkills[0];\n\t\t\tassert.strictEqual(personalSkill1.name, 'Personal Skill 1');\n\t\t\tassert.strictEqual(personalSkill1.description, 'A personal skill for testing');\n\t\t\tassert.strictEqual(personalSkill1.uri.path, '/home/user/.claude/skills/personal-skill-1/SKILL.md');\n\t\t});\n\n\t\ttest('should handle parsing errors gracefully', async () => {\n\t\t\ttestConfigService.setUserConfiguration(PromptsConfig.USE_CLAUDE_SKILLS, true);\n\n\t\t\tconst rootFolderName = 'claude-skills-error-test';\n\t\t\tconst rootFolder = `/${rootFolderName}`;\n\t\t\tconst rootFolderUri = URI.file(rootFolder);\n\n\t\t\tworkspaceContextService.setWorkspace(testWorkspace(rootFolderUri));\n\n\t\t\t// Create mock filesystem with malformed skill file\n\t\t\tawait mockFiles(fileService, [\n\t\t\t\t{\n\t\t\t\t\tpath: `${rootFolder}/.claude/skills/valid-skill/SKILL.md`,\n\t\t\t\t\tcontents: [\n\t\t\t\t\t\t'---',\n\t\t\t\t\t\t'name: \"Valid Skill\"',\n\t\t\t\t\t\t'description: \"A valid skill\"',\n\t\t\t\t\t\t'---',\n\t\t\t\t\t\t'Valid skill content',\n\t\t\t\t\t],\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tpath: `${rootFolder}/.claude/skills/invalid-skill/SKILL.md`,\n\t\t\t\t\tcontents: [\n\t\t\t\t\t\t'---',\n\t\t\t\t\t\t'invalid yaml: [unclosed',\n\t\t\t\t\t\t'---',\n\t\t\t\t\t\t'Invalid skill content',\n\t\t\t\t\t],\n\t\t\t\t},\n\t\t\t]);\n\n\t\t\tconst result = await service.findClaudeSkills(CancellationToken.None);\n\n\t\t\t// Should still return the valid skill, even if one has parsing errors\n\t\t\tassert.ok(result, 'Should return results even with parsing errors');\n\t\t\tassert.strictEqual(result.length, 1, 'Should find 1 valid skill');\n\t\t\tassert.strictEqual(result[0].name, 'Valid Skill');\n\t\t\tassert.strictEqual(result[0].type, 'project');\n\t\t});\n\n\t\ttest('should return empty array when no skills found', async () => {\n\t\t\ttestConfigService.setUserConfiguration(PromptsConfig.USE_CLAUDE_SKILLS, true);\n\n\t\t\tconst rootFolderName = 'empty-workspace';\n\t\t\tconst rootFolder = `/${rootFolderName}`;\n\t\t\tconst rootFolderUri = URI.file(rootFolder);\n\n\t\t\tworkspaceContextService.setWorkspace(testWorkspace(rootFolderUri));\n\n\t\t\t// Create empty mock filesystem\n\t\t\tawait mockFiles(fileService, []);\n\n\t\t\tconst result = await service.findClaudeSkills(CancellationToken.None);\n\n\t\t\tassert.ok(result, 'Should return results array');\n\t\t\tassert.strictEqual(result.length, 0, 'Should find no skills');\n\t\t});\n\t});\n});\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport assert from 'assert';\nimport * as sinon from 'sinon';\nimport { CancellationToken } from '../../../../../../../base/common/cancellation.js';\nimport { ResourceSet } from '../../../../../../../base/common/map.js';\nimport { Schemas } from '../../../../../../../base/common/network.js';\nimport { URI } from '../../../../../../../base/common/uri.js';\nimport { ensureNoDisposablesAreLeakedInTestSuite } from '../../../../../../../base/test/common/utils.js';\nimport { Range } from '../../../../../../../editor/common/core/range.js';\nimport { ILanguageService } from '../../../../../../../editor/common/languages/language.js';\nimport { IModelService } from '../../../../../../../editor/common/services/model.js';\nimport { ModelService } from '../../../../../../../editor/common/services/modelService.js';\nimport { IConfigurationService } from '../../../../../../../platform/configuration/common/configuration.js';\nimport { TestConfigurationService } from '../../../../../../../platform/configuration/test/common/testConfigurationService.js';\nimport { IExtensionDescription } from '../../../../../../../platform/extensions/common/extensions.js';\nimport { IFileService } from '../../../../../../../platform/files/common/files.js';\nimport { FileService } from '../../../../../../../platform/files/common/fileService.js';\nimport { InMemoryFileSystemProvider } from '../../../../../../../platform/files/common/inMemoryFilesystemProvider.js';\nimport { TestInstantiationService } from '../../../../../../../platform/instantiation/test/common/instantiationServiceMock.js';\nimport { ILabelService } from '../../../../../../../platform/label/common/label.js';\nimport { ILogService, NullLogService } from '../../../../../../../platform/log/common/log.js';\nimport { ITelemetryService } from '../../../../../../../platform/telemetry/common/telemetry.js';\nimport { NullTelemetryService } from '../../../../../../../platform/telemetry/common/telemetryUtils.js';\nimport { IWorkspaceContextService } from '../../../../../../../platform/workspace/common/workspace.js';\nimport { testWorkspace } from '../../../../../../../platform/workspace/test/common/testWorkspace.js';\nimport { IWorkbenchEnvironmentService } from '../../../../../../services/environment/common/environmentService.js';\nimport { IFilesConfigurationService } from '../../../../../../services/filesConfiguration/common/filesConfigurationService.js';\nimport { IUserDataProfileService } from '../../../../../../services/userDataProfile/common/userDataProfile.js';\nimport { TestContextService, TestUserDataProfileService } from '../../../../../../test/common/workbenchTestServices.js';\nimport { ChatRequestVariableSet, isPromptFileVariableEntry, toFileVariableEntry } from '../../../../common/chatVariableEntries.js';\nimport { ComputeAutomaticInstructions, newInstructionsCollectionEvent } from '../../../../common/promptSyntax/computeAutomaticInstructions.js';\nimport { PromptsConfig } from '../../../../common/promptSyntax/config/config.js';\nimport { INSTRUCTION_FILE_EXTENSION, INSTRUCTIONS_DEFAULT_SOURCE_FOLDER, LEGACY_MODE_DEFAULT_SOURCE_FOLDER, PROMPT_DEFAULT_SOURCE_FOLDER, PROMPT_FILE_EXTENSION } from '../../../../common/promptSyntax/config/promptFileLocations.js';\nimport { INSTRUCTIONS_LANGUAGE_ID, PROMPT_LANGUAGE_ID, PromptsType } from '../../../../common/promptSyntax/promptTypes.js';\nimport { ICustomAgent, IPromptsService, PromptsStorage } from '../../../../common/promptSyntax/service/promptsService.js';\nimport { PromptsService } from '../../../../common/promptSyntax/service/promptsServiceImpl.js';\nimport { mockFiles } from '../testUtils/mockFilesystem.js';\nimport { InMemoryStorageService, IStorageService } from '../../../../../../../platform/storage/common/storage.js';\nimport { IPathService } from '../../../../../../services/path/common/pathService.js';\nimport { ISearchService } from '../../../../../../services/search/common/search.js';\n\nsuite('PromptsService', () => {\n\tconst disposables = ensureNoDisposablesAreLeakedInTestSuite();\n\n\tlet service: IPromptsService;\n\tlet instaService: TestInstantiationService;\n\tlet workspaceContextService: TestContextService;\n\tlet testConfigService: TestConfigurationService;\n\tlet fileService: IFileService;\n\n\tsetup(async () => {\n\t\tinstaService = disposables.add(new TestInstantiationService());\n\t\tinstaService.stub(ILogService, new NullLogService());\n\n\t\tworkspaceContextService = new TestContextService();\n\t\tinstaService.stub(IWorkspaceContextService, workspaceContextService);\n\n\t\ttestConfigService = new TestConfigurationService();\n\t\ttestConfigService.setUserConfiguration(PromptsConfig.USE_COPILOT_INSTRUCTION_FILES, true);\n\t\ttestConfigService.setUserConfiguration(PromptsConfig.USE_AGENT_MD, true);\n\t\ttestConfigService.setUserConfiguration(PromptsConfig.USE_NESTED_AGENT_MD, false);\n\t\ttestConfigService.setUserConfiguration(PromptsConfig.INSTRUCTIONS_LOCATION_KEY, { [INSTRUCTIONS_DEFAULT_SOURCE_FOLDER]: true });\n\t\ttestConfigService.setUserConfiguration(PromptsConfig.PROMPT_LOCATIONS_KEY, { [PROMPT_DEFAULT_SOURCE_FOLDER]: true });\n\t\ttestConfigService.setUserConfiguration(PromptsConfig.MODE_LOCATION_KEY, { [LEGACY_MODE_DEFAULT_SOURCE_FOLDER]: true });\n\n\t\tinstaService.stub(IConfigurationService, testConfigService);\n\t\tinstaService.stub(IWorkbenchEnvironmentService, {});\n\t\tinstaService.stub(IUserDataProfileService, new TestUserDataProfileService());\n\t\tinstaService.stub(ITelemetryService, NullTelemetryService);\n\t\tinstaService.stub(IStorageService, InMemoryStorageService);\n\n\t\tfileService = disposables.add(instaService.createInstance(FileService));\n\t\tinstaService.stub(IFileService, fileService);\n\n\t\tconst modelService = disposables.add(instaService.createInstance(ModelService));\n\t\tinstaService.stub(IModelService, modelService);\n\t\tinstaService.stub(ILanguageService, {\n\t\t\tguessLanguageIdByFilepathOrFirstLine(uri: URI) {\n\t\t\t\tif (uri.path.endsWith(PROMPT_FILE_EXTENSION)) {\n\t\t\t\t\treturn PROMPT_LANGUAGE_ID;\n\t\t\t\t}\n\n\t\t\t\tif (uri.path.endsWith(INSTRUCTION_FILE_EXTENSION)) {\n\t\t\t\t\treturn INSTRUCTIONS_LANGUAGE_ID;\n\t\t\t\t}\n\n\t\t\t\treturn 'plaintext';\n\t\t\t}\n\t\t});\n\t\tinstaService.stub(ILabelService, { getUriLabel: (uri: URI) => uri.path });\n\n\t\tconst fileSystemProvider = disposables.add(new InMemoryFileSystemProvider());\n\t\tdisposables.add(fileService.registerProvider(Schemas.file, fileSystemProvider));\n\n\t\tinstaService.stub(IFilesConfigurationService, { updateReadonly: () => Promise.resolve() });\n\n\t\tconst pathService = {\n\t\t\tuserHome: (): URI | Promise<URI> => {\n\t\t\t\treturn Promise.resolve(URI.file('/home/user'));\n\t\t\t},\n\t\t} as IPathService;\n\t\tinstaService.stub(IPathService, pathService);\n\n\t\tinstaService.stub(ISearchService, {});\n\n\t\tservice = disposables.add(instaService.createInstance(PromptsService));\n\t\tinstaService.stub(IPromptsService, service);\n\t});\n\n\tsuite('parse', () => {\n\t\ttest('explicit', async function () {\n\t\t\tconst rootFolderName = 'resolves-nested-file-references';\n\t\t\tconst rootFolder = `/${rootFolderName}`;\n\n\t\t\tconst rootFileName = 'file2.prompt.md';\n\n\t\t\tconst rootFolderUri = URI.file(rootFolder);\n\n\t\t\tworkspaceContextService.setWorkspace(testWorkspace(rootFolderUri));\n\n\t\t\tconst rootFileUri = URI.joinPath(rootFolderUri, rootFileName);\n\n\t\t\tawait mockFiles(fileService, [\n\t\t\t\t{\n\t\t\t\t\tpath: `${rootFolder}/file1.prompt.md`,\n\t\t\t\t\tcontents: [\n\t\t\t\t\t\t'## Some Header',\n\t\t\t\t\t\t'some contents',\n\t\t\t\t\t\t' ',\n\t\t\t\t\t],\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tpath: `${rootFolder}/${rootFileName}`,\n\t\t\t\t\tcontents: [\n\t\t\t\t\t\t'---',\n\t\t\t\t\t\t'description: \\'Root prompt description.\\'',\n\t\t\t\t\t\t'tools: [\\'my-tool1\\', , true]',\n\t\t\t\t\t\t'agent: \"agent\" ',\n\t\t\t\t\t\t'---',\n\t\t\t\t\t\t'## Files',\n\t\t\t\t\t\t'\\t- this file #file:folder1/file3.prompt.md ',\n\t\t\t\t\t\t'\\t- also this [file4.prompt.md](./folder1/some-other-folder/file4.prompt.md) please!',\n\t\t\t\t\t\t'## Vars',\n\t\t\t\t\t\t'\\t- #tool:my-tool',\n\t\t\t\t\t\t'\\t- #tool:my-other-tool',\n\t\t\t\t\t\t' ',\n\t\t\t\t\t],\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tpath: `${rootFolder}/folder1/file3.prompt.md`,\n\t\t\t\t\tcontents: [\n\t\t\t\t\t\t'---',\n\t\t\t\t\t\t'tools: [ false, \\'my-tool1\\' , ]',\n\t\t\t\t\t\t'agent: \\'edit\\'',\n\t\t\t\t\t\t'---',\n\t\t\t\t\t\t'',\n\t\t\t\t\t\t'[](./some-other-folder/non-existing-folder)',\n\t\t\t\t\t\t`\\t- some seemingly random #file:${rootFolder}/folder1/some-other-folder/yetAnotherFolder五/another-file.instructions.md contents`,\n\t\t\t\t\t\t' some more\\t content',\n\t\t\t\t\t],\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tpath: `${rootFolder}/folder1/some-other-folder/file4.prompt.md`,\n\t\t\t\t\tcontents: [\n\t\t\t\t\t\t'---',\n\t\t\t\t\t\t'tools: [\\'my-tool1\\', \"my-tool2\", true, , ]',\n\t\t\t\t\t\t'something: true',\n\t\t\t\t\t\t'agent: \\'ask\\'\\t',\n\t\t\t\t\t\t'description: \"File 4 splendid description.\"',\n\t\t\t\t\t\t'---',\n\t\t\t\t\t\t'this file has a non-existing #file:./some-non-existing/file.prompt.md\\t\\treference',\n\t\t\t\t\t\t'',\n\t\t\t\t\t\t'',\n\t\t\t\t\t\t'and some',\n\t\t\t\t\t\t' non-prompt #file:./some-non-prompt-file.md\\t\\t \\t[](../../folder1/)\\t',\n\t\t\t\t\t],\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tpath: `${rootFolder}/folder1/some-other-folder/file.txt`,\n\t\t\t\t\tcontents: [\n\t\t\t\t\t\t'---',\n\t\t\t\t\t\t'description: \"Non-prompt file description\".',\n\t\t\t\t\t\t'tools: [\"my-tool-24\"]',\n\t\t\t\t\t\t'---',\n\t\t\t\t\t],\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tpath: `${rootFolder}/folder1/some-other-folder/yetAnotherFolder五/another-file.instructions.md`,\n\t\t\t\t\tcontents: [\n\t\t\t\t\t\t'---',\n\t\t\t\t\t\t'description: \"Another file description.\"',\n\t\t\t\t\t\t'tools: [\\'my-tool3\\', false, \"my-tool2\" ]',\n\t\t\t\t\t\t'applyTo: \"**/*.tsx\"',\n\t\t\t\t\t\t'---',\n\t\t\t\t\t\t`[](${rootFolder}/folder1/some-other-folder)`,\n\t\t\t\t\t\t'another-file.instructions.md contents\\t [#file:file.txt](../file.txt)',\n\t\t\t\t\t],\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tpath: `${rootFolder}/folder1/some-other-folder/yetAnotherFolder五/one_more_file_just_in_case.prompt.md`,\n\t\t\t\t\tcontents: ['one_more_file_just_in_case.prompt.md contents'],\n\t\t\t\t},\n\t\t\t]);\n\n\t\t\tconst file3 = URI.joinPath(rootFolderUri, 'folder1/file3.prompt.md');\n\t\t\tconst file4 = URI.joinPath(rootFolderUri, 'folder1/some-other-folder/file4.prompt.md');\n\t\t\tconst someOtherFolder = URI.joinPath(rootFolderUri, '/folder1/some-other-folder');\n\t\t\tconst someOtherFolderFile = URI.joinPath(rootFolderUri, '/folder1/some-other-folder/file.txt');\n\t\t\tconst nonExistingFolder = URI.joinPath(rootFolderUri, 'folder1/some-other-folder/non-existing-folder');\n\t\t\tconst yetAnotherFile = URI.joinPath(rootFolderUri, 'folder1/some-other-folder/yetAnotherFolder五/another-file.instructions.md');\n\n\n\t\t\tconst result1 = await service.parseNew(rootFileUri, CancellationToken.None);\n\t\t\tassert.deepEqual(result1.uri, rootFileUri);\n\t\t\tassert.deepEqual(result1.header?.description, 'Root prompt description.');\n\t\t\tassert.deepEqual(result1.header?.tools, ['my-tool1']);\n\t\t\tassert.deepEqual(result1.header?.agent, 'agent');\n\t\t\tassert.ok(result1.body);\n\t\t\tassert.deepEqual(\n\t\t\t\tresult1.body.fileReferences.map(r => result1.body?.resolveFilePath(r.content)),\n\t\t\t\t[file3, file4],\n\t\t\t);\n\t\t\tassert.deepEqual(\n\t\t\t\tresult1.body.variableReferences,\n\t\t\t\t[\n\t\t\t\t\t{ name: 'my-tool', range: new Range(10, 10, 10, 17), offset: 240 },\n\t\t\t\t\t{ name: 'my-other-tool', range: new Range(11, 10, 11, 23), offset: 257 },\n\t\t\t\t]\n\t\t\t);\n\n\t\t\tconst result2 = await service.parseNew(file3, CancellationToken.None);\n\t\t\tassert.deepEqual(result2.uri, file3);\n\t\t\tassert.deepEqual(result2.header?.agent, 'edit');\n\t\t\tassert.ok(result2.body);\n\t\t\tassert.deepEqual(\n\t\t\t\tresult2.body.fileReferences.map(r => result2.body?.resolveFilePath(r.content)),\n\t\t\t\t[nonExistingFolder, yetAnotherFile],\n\t\t\t);\n\n\t\t\tconst result3 = await service.parseNew(yetAnotherFile, CancellationToken.None);\n\t\t\tassert.deepEqual(result3.uri, yetAnotherFile);\n\t\t\tassert.deepEqual(result3.header?.description, 'Another file description.');\n\t\t\tassert.deepEqual(result3.header?.applyTo, '**/*.tsx');\n\t\t\tassert.ok(result3.body);\n\t\t\tassert.deepEqual(\n\t\t\t\tresult3.body.fileReferences.map(r => result3.body?.resolveFilePath(r.content)),\n\t\t\t\t[someOtherFolder, someOtherFolderFile],\n\t\t\t);\n\t\t\tassert.deepEqual(result3.body.variableReferences, []);\n\n\t\t\tconst result4 = await service.parseNew(file4, CancellationToken.None);\n\t\t\tassert.deepEqual(result4.uri, file4);\n\t\t\tassert.deepEqual(result4.header?.description, 'File 4 splendid description.');\n\t\t\tassert.ok(result4.body);\n\t\t\tassert.deepEqual(\n\t\t\t\tresult4.body.fileReferences.map(r => result4.body?.resolveFilePath(r.content)),\n\t\t\t\t[\n\t\t\t\t\tURI.joinPath(rootFolderUri, '/folder1/some-other-folder/some-non-existing/file.prompt.md'),\n\t\t\t\t\tURI.joinPath(rootFolderUri, '/folder1/some-other-folder/some-non-prompt-file.md'),\n\t\t\t\t\tURI.joinPath(rootFolderUri, '/folder1/'),\n\t\t\t\t],\n\t\t\t);\n\t\t\tassert.deepEqual(result4.body.variableReferences, []);\n\t\t});\n\t});\n\n\tsuite('findInstructionFilesFor', () => {\n\t\tteardown(() => {\n\t\t\tsinon.restore();\n\t\t});\n\n\t\ttest('finds correct instruction files', async () => {\n\t\t\tconst rootFolderName = 'finds-instruction-files';\n\t\t\tconst rootFolder = `/${rootFolderName}`;\n\t\t\tconst rootFolderUri = URI.file(rootFolder);\n\n\t\t\tworkspaceContextService.setWorkspace(testWorkspace(rootFolderUri));\n\n\t\t\tconst userPromptsFolderName = '/tmp/user-data/prompts';\n\t\t\tconst userPromptsFolderUri = URI.file(userPromptsFolderName);\n\n\t\t\tsinon.stub(service, 'listPromptFiles')\n\t\t\t\t.returns(Promise.resolve([\n\t\t\t\t\t// local instructions\n\t\t\t\t\t{\n\t\t\t\t\t\turi: URI.joinPath(rootFolderUri, '.github/prompts/file1.instructions.md'),\n\t\t\t\t\t\tstorage: PromptsStorage.local,\n\t\t\t\t\t\ttype: PromptsType.instructions,\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\turi: URI.joinPath(rootFolderUri, '.github/prompts/file2.instructions.md'),\n\t\t\t\t\t\tstorage: PromptsStorage.local,\n\t\t\t\t\t\ttype: PromptsType.instructions,\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\turi: URI.joinPath(rootFolderUri, '.github/prompts/file3.instructions.md'),\n\t\t\t\t\t\tstorage: PromptsStorage.local,\n\t\t\t\t\t\ttype: PromptsType.instructions,\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\turi: URI.joinPath(rootFolderUri, '.github/prompts/file4.instructions.md'),\n\t\t\t\t\t\tstorage: PromptsStorage.local,\n\t\t\t\t\t\ttype: PromptsType.instructions,\n\t\t\t\t\t},\n\t\t\t\t\t// user instructions\n\t\t\t\t\t{\n\t\t\t\t\t\turi: URI.joinPath(userPromptsFolderUri, 'file10.instructions.md'),\n\t\t\t\t\t\tstorage: PromptsStorage.user,\n\t\t\t\t\t\ttype: PromptsType.instructions,\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\turi: URI.joinPath(userPromptsFolderUri, 'file11.instructions.md'),\n\t\t\t\t\t\tstorage: PromptsStorage.user,\n\t\t\t\t\t\ttype: PromptsType.instructions,\n\t\t\t\t\t},\n\t\t\t\t]));\n\n\t\t\t// mock current workspace file structure\n\t\t\tawait mockFiles(fileService, [\n\t\t\t\t{\n\t\t\t\t\tpath: `${rootFolder}/file1.prompt.md`,\n\t\t\t\t\tcontents: [\n\t\t\t\t\t\t'## Some Header',\n\t\t\t\t\t\t'some contents',\n\t\t\t\t\t\t' ',\n\t\t\t\t\t]\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tpath: `${rootFolder}/.github/prompts/file1.instructions.md`,\n\t\t\t\t\tcontents: [\n\t\t\t\t\t\t'---',\n\t\t\t\t\t\t'description: \\'Instructions file 1.\\'',\n\t\t\t\t\t\t'applyTo: \"**/*.tsx\"',\n\t\t\t\t\t\t'---',\n\t\t\t\t\t\t'Some instructions 1 contents.',\n\t\t\t\t\t]\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tpath: `${rootFolder}/.github/prompts/file2.instructions.md`,\n\t\t\t\t\tcontents: [\n\t\t\t\t\t\t'---',\n\t\t\t\t\t\t'description: \\'Instructions file 2.\\'',\n\t\t\t\t\t\t'applyTo: \"**/folder1/*.tsx\"',\n\t\t\t\t\t\t'---',\n\t\t\t\t\t\t'Some instructions 2 contents.',\n\t\t\t\t\t]\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tpath: `${rootFolder}/.github/prompts/file3.instructions.md`,\n\t\t\t\t\tcontents: [\n\t\t\t\t\t\t'---',\n\t\t\t\t\t\t'description: \\'Instructions file 3.\\'',\n\t\t\t\t\t\t'applyTo: \"**/folder2/*.tsx\"',\n\t\t\t\t\t\t'---',\n\t\t\t\t\t\t'Some instructions 3 contents.',\n\t\t\t\t\t]\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tpath: `${rootFolder}/.github/prompts/file4.instructions.md`,\n\t\t\t\t\tcontents: [\n\t\t\t\t\t\t'---',\n\t\t\t\t\t\t'description: \\'Instructions file 4.\\'',\n\t\t\t\t\t\t'applyTo: \"src/build/*.tsx\"',\n\t\t\t\t\t\t'---',\n\t\t\t\t\t\t'Some instructions 4 contents.',\n\t\t\t\t\t]\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tpath: `${rootFolder}/.github/prompts/file5.prompt.md`,\n\t\t\t\t\tcontents: [\n\t\t\t\t\t\t'---',\n\t\t\t\t\t\t'description: \\'Prompt file 5.\\'',\n\t\t\t\t\t\t'---',\n\t\t\t\t\t\t'Some prompt 5 contents.',\n\t\t\t\t\t]\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tpath: `${rootFolder}/folder1/main.tsx`,\n\t\t\t\t\tcontents: [\n\t\t\t\t\t\t'console.log(\"Haalou!\")'\n\t\t\t\t\t]\n\t\t\t\t}\n\t\t\t]);\n\n\t\t\t// mock user data instructions\n\t\t\tawait mockFiles(fileService, [\n\t\t\t\t{\n\t\t\t\t\tpath: `${userPromptsFolderName}/file10.instructions.md`,\n\t\t\t\t\tcontents: [\n\t\t\t\t\t\t'---',\n\t\t\t\t\t\t'description: \\'Instructions file 10.\\'',\n\t\t\t\t\t\t'applyTo: \"**/folder1/*.tsx\"',\n\t\t\t\t\t\t'---',\n\t\t\t\t\t\t'Some instructions 10 contents.',\n\t\t\t\t\t]\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tpath: `${userPromptsFolderName}/file11.instructions.md`,\n\t\t\t\t\tcontents: [\n\t\t\t\t\t\t'---',\n\t\t\t\t\t\t'description: \\'Instructions file 11.\\'',\n\t\t\t\t\t\t'applyTo: \"**/folder1/*.py\"',\n\t\t\t\t\t\t'---',\n\t\t\t\t\t\t'Some instructions 11 contents.',\n\t\t\t\t\t]\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tpath: `${userPromptsFolderName}/file12.prompt.md`,\n\t\t\t\t\tcontents: [\n\t\t\t\t\t\t'---',\n\t\t\t\t\t\t'description: \\'Prompt file 12.\\'',\n\t\t\t\t\t\t'---',\n\t\t\t\t\t\t'Some prompt 12 contents.',\n\t\t\t\t\t]\n\t\t\t\t}\n\t\t\t]);\n\n\t\t\tconst instructionFiles = await service.listPromptFiles(PromptsType.instructions, CancellationToken.None);\n\t\t\tconst contextComputer = instaService.createInstance(ComputeAutomaticInstructions, undefined);\n\t\t\tconst context = {\n\t\t\t\tfiles: new ResourceSet([\n\t\t\t\t\tURI.joinPath(rootFolderUri, 'folder1/main.tsx'),\n\t\t\t\t]),\n\t\t\t\tinstructions: new ResourceSet(),\n\t\t\t};\n\t\t\tconst result = new ChatRequestVariableSet();\n\n\t\t\tawait contextComputer.addApplyingInstructions(instructionFiles, context, result, newInstructionsCollectionEvent(), CancellationToken.None);\n\n\t\t\tassert.deepStrictEqual(\n\t\t\t\tresult.asArray().map(i => isPromptFileVariableEntry(i) ? i.value.path : undefined),\n\t\t\t\t[\n\t\t\t\t\t// local instructions\n\t\t\t\t\tURI.joinPath(rootFolderUri, '.github/prompts/file1.instructions.md').path,\n\t\t\t\t\tURI.joinPath(rootFolderUri, '.github/prompts/file2.instructions.md').path,\n\t\t\t\t\t// user instructions\n\t\t\t\t\tURI.joinPath(userPromptsFolderUri, 'file10.instructions.md').path,\n\t\t\t\t],\n\t\t\t\t'Must find correct instruction files.',\n\t\t\t);\n\t\t});\n\n\t\ttest('does not have duplicates', async () => {\n\t\t\tconst rootFolderName = 'finds-instruction-files-without-duplicates';\n\t\t\tconst rootFolder = `/${rootFolderName}`;\n\t\t\tconst rootFolderUri = URI.file(rootFolder);\n\n\t\t\tworkspaceContextService.setWorkspace(testWorkspace(rootFolderUri));\n\n\t\t\tconst userPromptsFolderName = '/tmp/user-data/prompts';\n\t\t\tconst userPromptsFolderUri = URI.file(userPromptsFolderName);\n\n\t\t\tsinon.stub(service, 'listPromptFiles')\n\t\t\t\t.returns(Promise.resolve([\n\t\t\t\t\t// local instructions\n\t\t\t\t\t{\n\t\t\t\t\t\turi: URI.joinPath(rootFolderUri, '.github/prompts/file1.instructions.md'),\n\t\t\t\t\t\tstorage: PromptsStorage.local,\n\t\t\t\t\t\ttype: PromptsType.instructions,\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\turi: URI.joinPath(rootFolderUri, '.github/prompts/file2.instructions.md'),\n\t\t\t\t\t\tstorage: PromptsStorage.local,\n\t\t\t\t\t\ttype: PromptsType.instructions,\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\turi: URI.joinPath(rootFolderUri, '.github/prompts/file3.instructions.md'),\n\t\t\t\t\t\tstorage: PromptsStorage.local,\n\t\t\t\t\t\ttype: PromptsType.instructions,\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\turi: URI.joinPath(rootFolderUri, '.github/prompts/file4.instructions.md'),\n\t\t\t\t\t\tstorage: PromptsStorage.local,\n\t\t\t\t\t\ttype: PromptsType.instructions,\n\t\t\t\t\t},\n\t\t\t\t\t// user instructions\n\t\t\t\t\t{\n\t\t\t\t\t\turi: URI.joinPath(userPromptsFolderUri, 'file10.instructions.md'),\n\t\t\t\t\t\tstorage: PromptsStorage.user,\n\t\t\t\t\t\ttype: PromptsType.instructions,\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\turi: URI.joinPath(userPromptsFolderUri, 'file11.instructions.md'),\n\t\t\t\t\t\tstorage: PromptsStorage.user,\n\t\t\t\t\t\ttype: PromptsType.instructions,\n\t\t\t\t\t},\n\t\t\t\t]));\n\n\t\t\t// mock current workspace file structure\n\t\t\tawait mockFiles(fileService, [\n\t\t\t\t{\n\t\t\t\t\tpath: `${rootFolder}/file1.prompt.md`,\n\t\t\t\t\tcontents: [\n\t\t\t\t\t\t'## Some Header',\n\t\t\t\t\t\t'some contents',\n\t\t\t\t\t\t' ',\n\t\t\t\t\t]\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tpath: `${rootFolder}/.github/prompts/file1.instructions.md`,\n\t\t\t\t\tcontents: [\n\t\t\t\t\t\t'---',\n\t\t\t\t\t\t'description: \\'Instructions file 1.\\'',\n\t\t\t\t\t\t'applyTo: \"**/*.tsx\"',\n\t\t\t\t\t\t'---',\n\t\t\t\t\t\t'Some instructions 1 contents.',\n\t\t\t\t\t]\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tpath: `${rootFolder}/.github/prompts/file2.instructions.md`,\n\t\t\t\t\tcontents: [\n\t\t\t\t\t\t'---',\n\t\t\t\t\t\t'description: \\'Instructions file 2.\\'',\n\t\t\t\t\t\t'applyTo: \"**/folder1/*.tsx\"',\n\t\t\t\t\t\t'---',\n\t\t\t\t\t\t'Some instructions 2 contents. [](./file1.instructions.md)',\n\t\t\t\t\t]\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tpath: `${rootFolder}/.github/prompts/file3.instructions.md`,\n\t\t\t\t\tcontents: [\n\t\t\t\t\t\t'---',\n\t\t\t\t\t\t'description: \\'Instructions file 3.\\'',\n\t\t\t\t\t\t'applyTo: \"**/folder2/*.tsx\"',\n\t\t\t\t\t\t'---',\n\t\t\t\t\t\t'Some instructions 3 contents.',\n\t\t\t\t\t]\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tpath: `${rootFolder}/.github/prompts/file4.instructions.md`,\n\t\t\t\t\tcontents: [\n\t\t\t\t\t\t'---',\n\t\t\t\t\t\t'description: \\'Instructions file 4.\\'',\n\t\t\t\t\t\t'applyTo: \"src/build/*.tsx\"',\n\t\t\t\t\t\t'---',\n\t\t\t\t\t\t'[](./file3.instructions.md) Some instructions 4 contents.',\n\t\t\t\t\t]\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tpath: `${rootFolder}/.github/prompts/file5.prompt.md`,\n\t\t\t\t\tcontents: [\n\t\t\t\t\t\t'---',\n\t\t\t\t\t\t'description: \\'Prompt file 5.\\'',\n\t\t\t\t\t\t'---',\n\t\t\t\t\t\t'Some prompt 5 contents.',\n\t\t\t\t\t]\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tpath: `${rootFolder}/folder1/main.tsx`,\n\t\t\t\t\tcontents: [\n\t\t\t\t\t\t'console.log(\"Haalou!\")'\n\t\t\t\t\t]\n\t\t\t\t}\n\t\t\t]);\n\n\t\t\t// mock user data instructions\n\t\t\tawait mockFiles(fileService, [\n\t\t\t\t{\n\t\t\t\t\tpath: `${userPromptsFolderName}/file10.instructions.md`,\n\t\t\t\t\tcontents: [\n\t\t\t\t\t\t'---',\n\t\t\t\t\t\t'description: \\'Instructions file 10.\\'',\n\t\t\t\t\t\t'applyTo: \"**/folder1/*.tsx\"',\n\t\t\t\t\t\t'---',\n\t\t\t\t\t\t'Some instructions 10 contents.',\n\t\t\t\t\t]\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tpath: `${userPromptsFolderName}/file11.instructions.md`,\n\t\t\t\t\tcontents: [\n\t\t\t\t\t\t'---',\n\t\t\t\t\t\t'description: \\'Instructions file 11.\\'',\n\t\t\t\t\t\t'applyTo: \"**/folder1/*.py\"',\n\t\t\t\t\t\t'---',\n\t\t\t\t\t\t'Some instructions 11 contents.',\n\t\t\t\t\t]\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tpath: `${userPromptsFolderName}/file12.prompt.md`,\n\t\t\t\t\tcontents: [\n\t\t\t\t\t\t'---',\n\t\t\t\t\t\t'description: \\'Prompt file 12.\\'',\n\t\t\t\t\t\t'---',\n\t\t\t\t\t\t'Some prompt 12 contents.',\n\t\t\t\t\t]\n\t\t\t\t}\n\t\t\t]);\n\n\t\t\tconst instructionFiles = await service.listPromptFiles(PromptsType.instructions, CancellationToken.None);\n\t\t\tconst contextComputer = instaService.createInstance(ComputeAutomaticInstructions, undefined);\n\t\t\tconst context = {\n\t\t\t\tfiles: new ResourceSet([\n\t\t\t\t\tURI.joinPath(rootFolderUri, 'folder1/main.tsx'),\n\t\t\t\t\tURI.joinPath(rootFolderUri, 'folder1/index.tsx'),\n\t\t\t\t\tURI.joinPath(rootFolderUri, 'folder1/constants.tsx'),\n\t\t\t\t]),\n\t\t\t\tinstructions: new ResourceSet(),\n\t\t\t};\n\n\t\t\tconst result = new ChatRequestVariableSet();\n\t\t\tawait contextComputer.addApplyingInstructions(instructionFiles, context, result, newInstructionsCollectionEvent(), CancellationToken.None);\n\n\t\t\tassert.deepStrictEqual(\n\t\t\t\tresult.asArray().map(i => isPromptFileVariableEntry(i) ? i.value.path : undefined),\n\t\t\t\t[\n\t\t\t\t\t// local instructions\n\t\t\t\t\tURI.joinPath(rootFolderUri, '.github/prompts/file1.instructions.md').path,\n\t\t\t\t\tURI.joinPath(rootFolderUri, '.github/prompts/file2.instructions.md').path,\n\t\t\t\t\t// user instructions\n\t\t\t\t\tURI.joinPath(userPromptsFolderUri, 'file10.instructions.md').path,\n\t\t\t\t],\n\t\t\t\t'Must find correct instruction files.',\n\t\t\t);\n\t\t});\n\n\t\ttest('copilot-instructions and AGENTS.md', async () => {\n\t\t\tconst rootFolderName = 'copilot-instructions-and-agents';\n\t\t\tconst rootFolder = `/${rootFolderName}`;\n\t\t\tconst rootFolderUri = URI.file(rootFolder);\n\n\t\t\tworkspaceContextService.setWorkspace(testWorkspace(rootFolderUri));\n\n\t\t\t// mock current workspace file structure\n\t\t\tawait mockFiles(fileService, [\n\t\t\t\t{\n\t\t\t\t\tpath: `${rootFolder}/codestyle.md`,\n\t\t\t\t\tcontents: [\n\t\t\t\t\t\t'Can you see this?',\n\t\t\t\t\t]\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tpath: `${rootFolder}/AGENTS.md`,\n\t\t\t\t\tcontents: [\n\t\t\t\t\t\t'What about this?',\n\t\t\t\t\t]\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tpath: `${rootFolder}/README.md`,\n\t\t\t\t\tcontents: [\n\t\t\t\t\t\t'Thats my project?',\n\t\t\t\t\t]\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tpath: `${rootFolder}/.github/copilot-instructions.md`,\n\t\t\t\t\tcontents: [\n\t\t\t\t\t\t'Be nice and friendly. Also look at instructions at #file:../codestyle.md and [more-codestyle.md](./more-codestyle.md).',\n\t\t\t\t\t]\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tpath: `${rootFolder}/.github/more-codestyle.md`,\n\t\t\t\t\tcontents: [\n\t\t\t\t\t\t'I like it clean.',\n\t\t\t\t\t]\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tpath: `${rootFolder}/folder1/AGENTS.md`,\n\t\t\t\t\tcontents: [\n\t\t\t\t\t\t'An AGENTS.md file in another repo'\n\t\t\t\t\t]\n\t\t\t\t}\n\t\t\t]);\n\n\n\t\t\tconst contextComputer = instaService.createInstance(ComputeAutomaticInstructions, undefined);\n\t\t\tconst context = new ChatRequestVariableSet();\n\t\t\tcontext.add(toFileVariableEntry(URI.joinPath(rootFolderUri, 'README.md')));\n\n\t\t\tawait contextComputer.collect(context, CancellationToken.None);\n\n\t\t\tassert.deepStrictEqual(\n\t\t\t\tcontext.asArray().map(i => isPromptFileVariableEntry(i) ? i.value.path : undefined).filter(e => !!e).sort(),\n\t\t\t\t[\n\t\t\t\t\tURI.joinPath(rootFolderUri, '.github/copilot-instructions.md').path,\n\t\t\t\t\tURI.joinPath(rootFolderUri, '.github/more-codestyle.md').path,\n\t\t\t\t\tURI.joinPath(rootFolderUri, 'AGENTS.md').path,\n\t\t\t\t\tURI.joinPath(rootFolderUri, 'codestyle.md').path,\n\t\t\t\t].sort(),\n\t\t\t\t'Must find correct instruction files.',\n\t\t\t);\n\t\t});\n\t});\n\n\tsuite('getCustomAgents', () => {\n\t\tteardown(() => {\n\t\t\tsinon.restore();\n\t\t});\n\n\n\t\ttest('header with handOffs', async () => {\n\t\t\tconst rootFolderName = 'custom-agents-with-handoffs';\n\t\t\tconst rootFolder = `/${rootFolderName}`;\n\t\t\tconst rootFolderUri = URI.file(rootFolder);\n\n\t\t\tworkspaceContextService.setWorkspace(testWorkspace(rootFolderUri));\n\n\t\t\tawait mockFiles(fileService, [\n\t\t\t\t{\n\t\t\t\t\tpath: `${rootFolder}/.github/agents/agent1.agent.md`,\n\t\t\t\t\tcontents: [\n\t\t\t\t\t\t'---',\n\t\t\t\t\t\t'description: \\'Agent file 1.\\'',\n\t\t\t\t\t\t'handoffs: [ { agent: \"Edit\", label: \"Do it\", prompt: \"Do it now\" } ]',\n\t\t\t\t\t\t'---',\n\t\t\t\t\t]\n\t\t\t\t}\n\t\t\t]);\n\n\t\t\tconst result = (await service.getCustomAgents(CancellationToken.None)).map(agent => ({ ...agent, uri: URI.from(agent.uri) }));\n\t\t\tconst expected: ICustomAgent[] = [\n\t\t\t\t{\n\t\t\t\t\tname: 'agent1',\n\t\t\t\t\tdescription: 'Agent file 1.',\n\t\t\t\t\thandOffs: [{ agent: 'Edit', label: 'Do it', prompt: 'Do it now', send: undefined }],\n\t\t\t\t\tagentInstructions: {\n\t\t\t\t\t\tcontent: '',\n\t\t\t\t\t\ttoolReferences: [],\n\t\t\t\t\t\tmetadata: undefined\n\t\t\t\t\t},\n\t\t\t\t\tmodel: undefined,\n\t\t\t\t\targumentHint: undefined,\n\t\t\t\t\ttools: undefined,\n\t\t\t\t\ttarget: undefined,\n\t\t\t\t\turi: URI.joinPath(rootFolderUri, '.github/agents/agent1.agent.md'),\n\t\t\t\t\tsource: { storage: PromptsStorage.local }\n\t\t\t\t},\n\t\t\t];\n\n\t\t\tassert.deepEqual(\n\t\t\t\tresult,\n\t\t\t\texpected,\n\t\t\t\t'Must get custom agents.',\n\t\t\t);\n\t\t});\n\n\t\ttest('body with tool references', async () => {\n\t\t\tconst rootFolderName = 'custom-agents';\n\t\t\tconst rootFolder = `/${rootFolderName}`;\n\t\t\tconst rootFolderUri = URI.file(rootFolder);\n\n\t\t\tworkspaceContextService.setWorkspace(testWorkspace(rootFolderUri));\n\n\t\t\t// mock current workspace file structure\n\t\t\tawait mockFiles(fileService, [\n\t\t\t\t{\n\t\t\t\t\tpath: `${rootFolder}/.github/agents/agent1.agent.md`,\n\t\t\t\t\tcontents: [\n\t\t\t\t\t\t'---',\n\t\t\t\t\t\t'description: \\'Agent file 1.\\'',\n\t\t\t\t\t\t'tools: [ tool1, tool2 ]',\n\t\t\t\t\t\t'---',\n\t\t\t\t\t\t'Do it with #tool:tool1',\n\t\t\t\t\t]\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tpath: `${rootFolder}/.github/agents/agent2.agent.md`,\n\t\t\t\t\tcontents: [\n\t\t\t\t\t\t'First use #tool:tool2\\nThen use #tool:tool1',\n\t\t\t\t\t]\n\t\t\t\t}\n\t\t\t]);\n\n\t\t\tconst result = (await service.getCustomAgents(CancellationToken.None)).map(agent => ({ ...agent, uri: URI.from(agent.uri) }));\n\t\t\tconst expected: ICustomAgent[] = [\n\t\t\t\t{\n\t\t\t\t\tname: 'agent1',\n\t\t\t\t\tdescription: 'Agent file 1.',\n\t\t\t\t\ttools: ['tool1', 'tool2'],\n\t\t\t\t\tagentInstructions: {\n\t\t\t\t\t\tcontent: 'Do it with #tool:tool1',\n\t\t\t\t\t\ttoolReferences: [{ name: 'tool1', range: { start: 11, endExclusive: 17 } }],\n\t\t\t\t\t\tmetadata: undefined\n\t\t\t\t\t},\n\t\t\t\t\thandOffs: undefined,\n\t\t\t\t\tmodel: undefined,\n\t\t\t\t\targumentHint: undefined,\n\t\t\t\t\ttarget: undefined,\n\t\t\t\t\turi: URI.joinPath(rootFolderUri, '.github/agents/agent1.agent.md'),\n\t\t\t\t\tsource: { storage: PromptsStorage.local },\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tname: 'agent2',\n\t\t\t\t\tagentInstructions: {\n\t\t\t\t\t\tcontent: 'First use #tool:tool2\\nThen use #tool:tool1',\n\t\t\t\t\t\ttoolReferences: [\n\t\t\t\t\t\t\t{ name: 'tool1', range: { start: 31, endExclusive: 37 } },\n\t\t\t\t\t\t\t{ name: 'tool2', range: { start: 10, endExclusive: 16 } }\n\t\t\t\t\t\t],\n\t\t\t\t\t\tmetadata: undefined\n\t\t\t\t\t},\n\t\t\t\t\turi: URI.joinPath(rootFolderUri, '.github/agents/agent2.agent.md'),\n\t\t\t\t\tsource: { storage: PromptsStorage.local },\n\t\t\t\t}\n\t\t\t];\n\n\t\t\tassert.deepEqual(\n\t\t\t\tresult,\n\t\t\t\texpected,\n\t\t\t\t'Must get custom agents.',\n\t\t\t);\n\t\t});\n\n\t\ttest('header with argumentHint', async () => {\n\t\t\tconst rootFolderName = 'custom-agents-with-argument-hint';\n\t\t\tconst rootFolder = `/${rootFolderName}`;\n\t\t\tconst rootFolderUri = URI.file(rootFolder);\n\n\t\t\tworkspaceContextService.setWorkspace(testWorkspace(rootFolderUri));\n\n\t\t\tawait mockFiles(fileService, [\n\t\t\t\t{\n\t\t\t\t\tpath: `${rootFolder}/.github/agents/agent1.agent.md`,\n\t\t\t\t\tcontents: [\n\t\t\t\t\t\t'---',\n\t\t\t\t\t\t'description: \\'Code review agent.\\'',\n\t\t\t\t\t\t'argument-hint: \\'Provide file path or code snippet to review\\'',\n\t\t\t\t\t\t'tools: [ code-analyzer, linter ]',\n\t\t\t\t\t\t'---',\n\t\t\t\t\t\t'I will help review your code for best practices.',\n\t\t\t\t\t]\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tpath: `${rootFolder}/.github/agents/agent2.agent.md`,\n\t\t\t\t\tcontents: [\n\t\t\t\t\t\t'---',\n\t\t\t\t\t\t'description: \\'Documentation generator.\\'',\n\t\t\t\t\t\t'argument-hint: \\'Specify function or class name to document\\'',\n\t\t\t\t\t\t'---',\n\t\t\t\t\t\t'I generate comprehensive documentation.',\n\t\t\t\t\t]\n\t\t\t\t}\n\t\t\t]);\n\n\t\t\tconst result = (await service.getCustomAgents(CancellationToken.None)).map(agent => ({ ...agent, uri: URI.from(agent.uri) }));\n\t\t\tconst expected: ICustomAgent[] = [\n\t\t\t\t{\n\t\t\t\t\tname: 'agent1',\n\t\t\t\t\tdescription: 'Code review agent.',\n\t\t\t\t\targumentHint: 'Provide file path or code snippet to review',\n\t\t\t\t\ttools: ['code-analyzer', 'linter'],\n\t\t\t\t\tagentInstructions: {\n\t\t\t\t\t\tcontent: 'I will help review your code for best practices.',\n\t\t\t\t\t\ttoolReferences: [],\n\t\t\t\t\t\tmetadata: undefined\n\t\t\t\t\t},\n\t\t\t\t\thandOffs: undefined,\n\t\t\t\t\tmodel: undefined,\n\t\t\t\t\ttarget: undefined,\n\t\t\t\t\turi: URI.joinPath(rootFolderUri, '.github/agents/agent1.agent.md'),\n\t\t\t\t\tsource: { storage: PromptsStorage.local }\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tname: 'agent2',\n\t\t\t\t\tdescription: 'Documentation generator.',\n\t\t\t\t\targumentHint: 'Specify function or class name to document',\n\t\t\t\t\tagentInstructions: {\n\t\t\t\t\t\tcontent: 'I generate comprehensive documentation.',\n\t\t\t\t\t\ttoolReferences: [],\n\t\t\t\t\t\tmetadata: undefined\n\t\t\t\t\t},\n\t\t\t\t\thandOffs: undefined,\n\t\t\t\t\tmodel: undefined,\n\t\t\t\t\ttools: undefined,\n\t\t\t\t\ttarget: undefined,\n\t\t\t\t\turi: URI.joinPath(rootFolderUri, '.github/agents/agent2.agent.md'),\n\t\t\t\t\tsource: { storage: PromptsStorage.local }\n\t\t\t\t},\n\t\t\t];\n\n\t\t\tassert.deepEqual(\n\t\t\t\tresult,\n\t\t\t\texpected,\n\t\t\t\t'Must get custom agents with argumentHint.',\n\t\t\t);\n\t\t});\n\n\t\ttest('header with target', async () => {\n\t\t\tconst rootFolderName = 'custom-agents-with-target';\n\t\t\tconst rootFolder = `/${rootFolderName}`;\n\t\t\tconst rootFolderUri = URI.file(rootFolder);\n\n\t\t\tworkspaceContextService.setWorkspace(testWorkspace(rootFolderUri));\n\n\t\t\tawait mockFiles(fileService, [\n\t\t\t\t{\n\t\t\t\t\tpath: `${rootFolder}/.github/agents/github-agent.agent.md`,\n\t\t\t\t\tcontents: [\n\t\t\t\t\t\t'---',\n\t\t\t\t\t\t'description: \\'GitHub Copilot specialized agent.\\'',\n\t\t\t\t\t\t'target: \\'github-copilot\\'',\n\t\t\t\t\t\t'tools: [ github-api, code-search ]',\n\t\t\t\t\t\t'---',\n\t\t\t\t\t\t'I am optimized for GitHub Copilot workflows.',\n\t\t\t\t\t]\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tpath: `${rootFolder}/.github/agents/vscode-agent.agent.md`,\n\t\t\t\t\tcontents: [\n\t\t\t\t\t\t'---',\n\t\t\t\t\t\t'description: \\'VS Code specialized agent.\\'',\n\t\t\t\t\t\t'target: \\'vscode\\'',\n\t\t\t\t\t\t'model: \\'gpt-4\\'',\n\t\t\t\t\t\t'---',\n\t\t\t\t\t\t'I am specialized for VS Code editor tasks.',\n\t\t\t\t\t]\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tpath: `${rootFolder}/.github/agents/generic-agent.agent.md`,\n\t\t\t\t\tcontents: [\n\t\t\t\t\t\t'---',\n\t\t\t\t\t\t'description: \\'Generic agent without target.\\'',\n\t\t\t\t\t\t'---',\n\t\t\t\t\t\t'I work everywhere.',\n\t\t\t\t\t]\n\t\t\t\t}\n\t\t\t]);\n\n\t\t\tconst result = (await service.getCustomAgents(CancellationToken.None)).map(agent => ({ ...agent, uri: URI.from(agent.uri) }));\n\t\t\tconst expected: ICustomAgent[] = [\n\t\t\t\t{\n\t\t\t\t\tname: 'github-agent',\n\t\t\t\t\tdescription: 'GitHub Copilot specialized agent.',\n\t\t\t\t\ttarget: 'github-copilot',\n\t\t\t\t\ttools: ['github-api', 'code-search'],\n\t\t\t\t\tagentInstructions: {\n\t\t\t\t\t\tcontent: 'I am optimized for GitHub Copilot workflows.',\n\t\t\t\t\t\ttoolReferences: [],\n\t\t\t\t\t\tmetadata: undefined\n\t\t\t\t\t},\n\t\t\t\t\thandOffs: undefined,\n\t\t\t\t\tmodel: undefined,\n\t\t\t\t\targumentHint: undefined,\n\t\t\t\t\turi: URI.joinPath(rootFolderUri, '.github/agents/github-agent.agent.md'),\n\t\t\t\t\tsource: { storage: PromptsStorage.local }\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tname: 'vscode-agent',\n\t\t\t\t\tdescription: 'VS Code specialized agent.',\n\t\t\t\t\ttarget: 'vscode',\n\t\t\t\t\tmodel: 'gpt-4',\n\t\t\t\t\tagentInstructions: {\n\t\t\t\t\t\tcontent: 'I am specialized for VS Code editor tasks.',\n\t\t\t\t\t\ttoolReferences: [],\n\t\t\t\t\t\tmetadata: undefined\n\t\t\t\t\t},\n\t\t\t\t\thandOffs: undefined,\n\t\t\t\t\targumentHint: undefined,\n\t\t\t\t\ttools: undefined,\n\t\t\t\t\turi: URI.joinPath(rootFolderUri, '.github/agents/vscode-agent.agent.md'),\n\t\t\t\t\tsource: { storage: PromptsStorage.local }\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tname: 'generic-agent',\n\t\t\t\t\tdescription: 'Generic agent without target.',\n\t\t\t\t\tagentInstructions: {\n\t\t\t\t\t\tcontent: 'I work everywhere.',\n\t\t\t\t\t\ttoolReferences: [],\n\t\t\t\t\t\tmetadata: undefined\n\t\t\t\t\t},\n\t\t\t\t\thandOffs: undefined,\n\t\t\t\t\tmodel: undefined,\n\t\t\t\t\targumentHint: undefined,\n\t\t\t\t\ttools: undefined,\n\t\t\t\t\ttarget: undefined,\n\t\t\t\t\turi: URI.joinPath(rootFolderUri, '.github/agents/generic-agent.agent.md'),\n\t\t\t\t\tsource: { storage: PromptsStorage.local }\n\t\t\t\t},\n\t\t\t];\n\n\t\t\tassert.deepEqual(\n\t\t\t\tresult,\n\t\t\t\texpected,\n\t\t\t\t'Must get custom agents with target attribute.',\n\t\t\t);\n\t\t});\n\n\t\ttest('agents with .md extension (no .agent.md)', async () => {\n\t\t\tconst rootFolderName = 'custom-agents-md-extension';\n\t\t\tconst rootFolder = `/${rootFolderName}`;\n\t\t\tconst rootFolderUri = URI.file(rootFolder);\n\n\t\t\tworkspaceContextService.setWorkspace(testWorkspace(rootFolderUri));\n\n\t\t\tawait mockFiles(fileService, [\n\t\t\t\t{\n\t\t\t\t\tpath: `${rootFolder}/.github/agents/demonstrate.md`,\n\t\t\t\t\tcontents: [\n\t\t\t\t\t\t'---',\n\t\t\t\t\t\t'description: \\'Demonstrate agent.\\'',\n\t\t\t\t\t\t'tools: [ demo-tool ]',\n\t\t\t\t\t\t'---',\n\t\t\t\t\t\t'This is a demonstration agent using .md extension.',\n\t\t\t\t\t]\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tpath: `${rootFolder}/.github/agents/test.md`,\n\t\t\t\t\tcontents: [\n\t\t\t\t\t\t'Test agent without header.',\n\t\t\t\t\t]\n\t\t\t\t}\n\t\t\t]);\n\n\t\t\tconst result = (await service.getCustomAgents(CancellationToken.None)).map(agent => ({ ...agent, uri: URI.from(agent.uri) }));\n\t\t\tconst expected: ICustomAgent[] = [\n\t\t\t\t{\n\t\t\t\t\tname: 'demonstrate',\n\t\t\t\t\tdescription: 'Demonstrate agent.',\n\t\t\t\t\ttools: ['demo-tool'],\n\t\t\t\t\tagentInstructions: {\n\t\t\t\t\t\tcontent: 'This is a demonstration agent using .md extension.',\n\t\t\t\t\t\ttoolReferences: [],\n\t\t\t\t\t\tmetadata: undefined\n\t\t\t\t\t},\n\t\t\t\t\thandOffs: undefined,\n\t\t\t\t\tmodel: undefined,\n\t\t\t\t\targumentHint: undefined,\n\t\t\t\t\ttarget: undefined,\n\t\t\t\t\turi: URI.joinPath(rootFolderUri, '.github/agents/demonstrate.md'),\n\t\t\t\t\tsource: { storage: PromptsStorage.local },\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tname: 'test',\n\t\t\t\t\tagentInstructions: {\n\t\t\t\t\t\tcontent: 'Test agent without header.',\n\t\t\t\t\t\ttoolReferences: [],\n\t\t\t\t\t\tmetadata: undefined\n\t\t\t\t\t},\n\t\t\t\t\turi: URI.joinPath(rootFolderUri, '.github/agents/test.md'),\n\t\t\t\t\tsource: { storage: PromptsStorage.local },\n\t\t\t\t}\n\t\t\t];\n\n\t\t\tassert.deepEqual(\n\t\t\t\tresult,\n\t\t\t\texpected,\n\t\t\t\t'Must get custom agents with .md extension from .github/agents/ folder.',\n\t\t\t);\n\t\t});\n\t});\n\n\tsuite('listPromptFiles - extensions', () => {\n\n\t\ttest('Contributed prompt file', async () => {\n\t\t\tconst uri = URI.parse('file://extensions/my-extension/textMate.instructions.md');\n\t\t\tconst extension = {} as IExtensionDescription;\n\t\t\tconst registered = service.registerContributedFile(PromptsType.instructions,\n\t\t\t\t'TextMate Instructions',\n\t\t\t\t'Instructions to follow when authoring TextMate grammars',\n\t\t\t\turi,\n\t\t\t\textension\n\t\t\t);\n\n\t\t\tconst actual = await service.listPromptFiles(PromptsType.instructions, CancellationToken.None);\n\t\t\tassert.strictEqual(actual.length, 1);\n\t\t\tassert.strictEqual(actual[0].uri.toString(), uri.toString());\n\t\t\tassert.strictEqual(actual[0].name, 'TextMate Instructions');\n\t\t\tassert.strictEqual(actual[0].storage, PromptsStorage.extension);\n\t\t\tassert.strictEqual(actual[0].type, PromptsType.instructions);\n\t\t\tregistered.dispose();\n\t\t});\n\t});\n\n\tsuite('findClaudeSkills', () => {\n\t\tteardown(() => {\n\t\t\tsinon.restore();\n\t\t});\n\n\t\ttest('should return undefined when USE_CLAUDE_SKILLS is disabled', async () => {\n\t\t\ttestConfigService.setUserConfiguration(PromptsConfig.USE_CLAUDE_SKILLS, false);\n\n\t\t\tconst result = await service.findClaudeSkills(CancellationToken.None);\n\t\t\tassert.strictEqual(result, undefined);\n\t\t});\n\n\t\ttest('should find Claude skills in workspace and user home', async () => {\n\t\t\ttestConfigService.setUserConfiguration(PromptsConfig.USE_CLAUDE_SKILLS, true);\n\n\t\t\tconst rootFolderName = 'claude-skills-test';\n\t\t\tconst rootFolder = `/${rootFolderName}`;\n\t\t\tconst rootFolderUri = URI.file(rootFolder);\n\n\t\t\tworkspaceContextService.setWorkspace(testWorkspace(rootFolderUri));\n\n\t\t\t// Create mock filesystem with skills\n\t\t\tawait mockFiles(fileService, [\n\t\t\t\t{\n\t\t\t\t\tpath: `${rootFolder}/.claude/skills/project-skill-1/SKILL.md`,\n\t\t\t\t\tcontents: [\n\t\t\t\t\t\t'---',\n\t\t\t\t\t\t'name: \"Project Skill 1\"',\n\t\t\t\t\t\t'description: \"A project skill for testing\"',\n\t\t\t\t\t\t'---',\n\t\t\t\t\t\t'This is project skill 1 content',\n\t\t\t\t\t],\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tpath: `${rootFolder}/.claude/skills/project-skill-2/SKILL.md`,\n\t\t\t\t\tcontents: [\n\t\t\t\t\t\t'---',\n\t\t\t\t\t\t'description: \"Invalid skill, no name\"',\n\t\t\t\t\t\t'---',\n\t\t\t\t\t\t'This is project skill 2 content',\n\t\t\t\t\t],\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tpath: `${rootFolder}/.claude/skills/not-a-skill-dir/README.md`,\n\t\t\t\t\tcontents: ['This is not a skill'],\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tpath: '/home/user/.claude/skills/personal-skill-1/SKILL.md',\n\t\t\t\t\tcontents: [\n\t\t\t\t\t\t'---',\n\t\t\t\t\t\t'name: \"Personal Skill 1\"',\n\t\t\t\t\t\t'description: \"A personal skill for testing\"',\n\t\t\t\t\t\t'---',\n\t\t\t\t\t\t'This is personal skill 1 content',\n\t\t\t\t\t],\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tpath: '/home/user/.claude/skills/not-a-skill/other-file.md',\n\t\t\t\t\tcontents: ['Not a skill file'],\n\t\t\t\t},\n\t\t\t]);\n\n\t\t\tconst result = await service.findClaudeSkills(CancellationToken.None);\n\n\t\t\tassert.ok(result, 'Should return results when Claude skills are enabled');\n\t\t\tassert.strictEqual(result.length, 2, 'Should find 2 skills total');\n\n\t\t\t// Check project skills\n\t\t\tconst projectSkills = result.filter(skill => skill.type === 'project');\n\t\t\tassert.strictEqual(projectSkills.length, 1, 'Should find 1 project skill');\n\n\t\t\tconst projectSkill1 = projectSkills.find(skill => skill.name === 'Project Skill 1');\n\t\t\tassert.ok(projectSkill1, 'Should find project skill 1');\n\t\t\tassert.strictEqual(projectSkill1.description, 'A project skill for testing');\n\t\t\tassert.strictEqual(projectSkill1.uri.path, `${rootFolder}/.claude/skills/project-skill-1/SKILL.md`);\n\n\t\t\t// Check personal skills\n\t\t\tconst personalSkills = result.filter(skill => skill.type === 'personal');\n\t\t\tassert.strictEqual(personalSkills.length, 1, 'Should find 1 personal skill');\n\n\t\t\tconst personalSkill1 = personalSkills[0];\n\t\t\tassert.strictEqual(personalSkill1.name, 'Personal Skill 1');\n\t\t\tassert.strictEqual(personalSkill1.description, 'A personal skill for testing');\n\t\t\tassert.strictEqual(personalSkill1.uri.path, '/home/user/.claude/skills/personal-skill-1/SKILL.md');\n\t\t});\n\n\t\ttest('should handle parsing errors gracefully', async () => {\n\t\t\ttestConfigService.setUserConfiguration(PromptsConfig.USE_CLAUDE_SKILLS, true);\n\n\t\t\tconst rootFolderName = 'claude-skills-error-test';\n\t\t\tconst rootFolder = `/${rootFolderName}`;\n\t\t\tconst rootFolderUri = URI.file(rootFolder);\n\n\t\t\tworkspaceContextService.setWorkspace(testWorkspace(rootFolderUri));\n\n\t\t\t// Create mock filesystem with malformed skill file\n\t\t\tawait mockFiles(fileService, [\n\t\t\t\t{\n\t\t\t\t\tpath: `${rootFolder}/.claude/skills/valid-skill/SKILL.md`,\n\t\t\t\t\tcontents: [\n\t\t\t\t\t\t'---',\n\t\t\t\t\t\t'name: \"Valid Skill\"',\n\t\t\t\t\t\t'description: \"A valid skill\"',\n\t\t\t\t\t\t'---',\n\t\t\t\t\t\t'Valid skill content',\n\t\t\t\t\t],\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tpath: `${rootFolder}/.claude/skills/invalid-skill/SKILL.md`,\n\t\t\t\t\tcontents: [\n\t\t\t\t\t\t'---',\n\t\t\t\t\t\t'invalid yaml: [unclosed',\n\t\t\t\t\t\t'---',\n\t\t\t\t\t\t'Invalid skill content',\n\t\t\t\t\t],\n\t\t\t\t},\n\t\t\t]);\n\n\t\t\tconst result = await service.findClaudeSkills(CancellationToken.None);\n\n\t\t\t// Should still return the valid skill, even if one has parsing errors\n\t\t\tassert.ok(result, 'Should return results even with parsing errors');\n\t\t\tassert.strictEqual(result.length, 1, 'Should find 1 valid skill');\n\t\t\tassert.strictEqual(result[0].name, 'Valid Skill');\n\t\t\tassert.strictEqual(result[0].type, 'project');\n\t\t});\n\n\t\ttest('should return empty array when no skills found', async () => {\n\t\t\ttestConfigService.setUserConfiguration(PromptsConfig.USE_CLAUDE_SKILLS, true);\n\n\t\t\tconst rootFolderName = 'empty-workspace';\n\t\t\tconst rootFolder = `/${rootFolderName}`;\n\t\t\tconst rootFolderUri = URI.file(rootFolder);\n\n\t\t\tworkspaceContextService.setWorkspace(testWorkspace(rootFolderUri));\n\n\t\t\t// Create empty mock filesystem\n\t\t\tawait mockFiles(fileService, []);\n\n\t\t\tconst result = await service.findClaudeSkills(CancellationToken.None);\n\n\t\t\tassert.ok(result, 'Should return results array');\n\t\t\tassert.strictEqual(result.length, 0, 'Should find no skills');\n\t\t});\n\t});\n});\n"]}