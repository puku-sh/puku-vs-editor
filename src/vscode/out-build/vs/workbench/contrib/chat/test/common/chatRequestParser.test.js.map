{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/contrib/chat/test/common/chatRequestParser.test.ts","vs/workbench/contrib/chat/test/common/chatRequestParser.test.ts"],"names":[],"mappings":"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","file":"chatRequestParser.test.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { mockObject } from '../../../../../base/test/common/mock.js';\nimport { assertSnapshot } from '../../../../../base/test/common/snapshot.js';\nimport { ensureNoDisposablesAreLeakedInTestSuite } from '../../../../../base/test/common/utils.js';\nimport { IContextKeyService } from '../../../../../platform/contextkey/common/contextkey.js';\nimport { TestInstantiationService } from '../../../../../platform/instantiation/test/common/instantiationServiceMock.js';\nimport { MockContextKeyService } from '../../../../../platform/keybinding/test/common/mockKeybindingService.js';\nimport { ILogService, NullLogService } from '../../../../../platform/log/common/log.js';\nimport { IStorageService } from '../../../../../platform/storage/common/storage.js';\nimport { IExtensionService, nullExtensionDescription } from '../../../../services/extensions/common/extensions.js';\nimport { TestExtensionService, TestStorageService } from '../../../../test/common/workbenchTestServices.js';\nimport { ChatAgentService, IChatAgentCommand, IChatAgentData, IChatAgentService } from '../../common/chatAgents.js';\nimport { ChatRequestParser } from '../../common/chatRequestParser.js';\nimport { IChatService } from '../../common/chatService.js';\nimport { IChatSlashCommandService } from '../../common/chatSlashCommands.js';\nimport { LocalChatSessionUri } from '../../common/chatUri.js';\nimport { IChatVariablesService } from '../../common/chatVariables.js';\nimport { ChatAgentLocation, ChatModeKind } from '../../common/constants.js';\nimport { IToolData, ToolDataSource, ToolSet } from '../../common/languageModelToolsService.js';\nimport { IPromptsService } from '../../common/promptSyntax/service/promptsService.js';\nimport { MockChatService } from './mockChatService.js';\nimport { MockChatVariablesService } from './mockChatVariables.js';\nimport { MockPromptsService } from './mockPromptsService.js';\n\nconst testSessionUri = LocalChatSessionUri.forSession('test-session');\n\nsuite('ChatRequestParser', () => {\n\tconst testDisposables = ensureNoDisposablesAreLeakedInTestSuite();\n\n\tlet instantiationService: TestInstantiationService;\n\tlet parser: ChatRequestParser;\n\n\tlet variableService: MockChatVariablesService;\n\tsetup(async () => {\n\t\tinstantiationService = testDisposables.add(new TestInstantiationService());\n\t\tinstantiationService.stub(IStorageService, testDisposables.add(new TestStorageService()));\n\t\tinstantiationService.stub(ILogService, new NullLogService());\n\t\tinstantiationService.stub(IExtensionService, new TestExtensionService());\n\t\tinstantiationService.stub(IChatService, new MockChatService());\n\t\tinstantiationService.stub(IContextKeyService, new MockContextKeyService());\n\t\tinstantiationService.stub(IChatAgentService, testDisposables.add(instantiationService.createInstance(ChatAgentService)));\n\t\tinstantiationService.stub(IPromptsService, testDisposables.add(new MockPromptsService()));\n\n\t\tvariableService = new MockChatVariablesService();\n\t\tinstantiationService.stub(IChatVariablesService, variableService);\n\t});\n\n\ttest('plain text', async () => {\n\t\tparser = instantiationService.createInstance(ChatRequestParser);\n\t\tconst result = parser.parseChatRequest(testSessionUri, 'test');\n\t\tawait assertSnapshot(result);\n\t});\n\n\ttest('plain text with newlines', async () => {\n\t\tparser = instantiationService.createInstance(ChatRequestParser);\n\t\tconst text = 'line 1\\nline 2\\r\\nline 3';\n\t\tconst result = parser.parseChatRequest(testSessionUri, text);\n\t\tawait assertSnapshot(result);\n\t});\n\n\ttest('slash in text', async () => {\n\t\tparser = instantiationService.createInstance(ChatRequestParser);\n\t\tconst text = 'can we add a new file for an Express router to handle the / route';\n\t\tconst result = parser.parseChatRequest(testSessionUri, text);\n\t\tawait assertSnapshot(result);\n\t});\n\n\ttest('slash command', async () => {\n\t\tconst slashCommandService = mockObject<IChatSlashCommandService>()({});\n\t\tslashCommandService.getCommands.returns([{ command: 'fix' }]);\n\t\t// eslint-disable-next-line local/code-no-any-casts\n\t\tinstantiationService.stub(IChatSlashCommandService, slashCommandService as any);\n\n\t\tparser = instantiationService.createInstance(ChatRequestParser);\n\t\tconst text = '/fix this';\n\t\tconst result = parser.parseChatRequest(testSessionUri, text);\n\t\tawait assertSnapshot(result);\n\t});\n\n\ttest('invalid slash command', async () => {\n\t\tconst slashCommandService = mockObject<IChatSlashCommandService>()({});\n\t\tslashCommandService.getCommands.returns([{ command: 'fix' }]);\n\t\t// eslint-disable-next-line local/code-no-any-casts\n\t\tinstantiationService.stub(IChatSlashCommandService, slashCommandService as any);\n\n\t\tparser = instantiationService.createInstance(ChatRequestParser);\n\t\tconst text = '/explain this';\n\t\tconst result = parser.parseChatRequest(testSessionUri, text);\n\t\tawait assertSnapshot(result);\n\t});\n\n\ttest('multiple slash commands', async () => {\n\t\tconst slashCommandService = mockObject<IChatSlashCommandService>()({});\n\t\tslashCommandService.getCommands.returns([{ command: 'fix' }]);\n\t\t// eslint-disable-next-line local/code-no-any-casts\n\t\tinstantiationService.stub(IChatSlashCommandService, slashCommandService as any);\n\n\t\tparser = instantiationService.createInstance(ChatRequestParser);\n\t\tconst text = '/fix /fix';\n\t\tconst result = parser.parseChatRequest(testSessionUri, text);\n\t\tawait assertSnapshot(result);\n\t});\n\n\ttest('slash command not first', async () => {\n\t\tconst slashCommandService = mockObject<IChatSlashCommandService>()({});\n\t\tslashCommandService.getCommands.returns([{ command: 'fix' }]);\n\t\t// eslint-disable-next-line local/code-no-any-casts\n\t\tinstantiationService.stub(IChatSlashCommandService, slashCommandService as any);\n\n\t\tparser = instantiationService.createInstance(ChatRequestParser);\n\t\tconst text = 'Hello /fix';\n\t\tconst result = parser.parseChatRequest(testSessionUri, text);\n\t\tawait assertSnapshot(result);\n\t});\n\n\ttest('slash command after whitespace', async () => {\n\t\tconst slashCommandService = mockObject<IChatSlashCommandService>()({});\n\t\tslashCommandService.getCommands.returns([{ command: 'fix' }]);\n\t\t// eslint-disable-next-line local/code-no-any-casts\n\t\tinstantiationService.stub(IChatSlashCommandService, slashCommandService as any);\n\n\t\tparser = instantiationService.createInstance(ChatRequestParser);\n\t\tconst text = '    /fix';\n\t\tconst result = parser.parseChatRequest(testSessionUri, text);\n\t\tawait assertSnapshot(result);\n\t});\n\n\ttest('prompt slash command', async () => {\n\t\tconst slashCommandService = mockObject<IChatSlashCommandService>()({});\n\t\tslashCommandService.getCommands.returns([{ command: 'fix' }]);\n\t\t// eslint-disable-next-line local/code-no-any-casts\n\t\tinstantiationService.stub(IChatSlashCommandService, slashCommandService as any);\n\n\t\tconst promptSlashCommandService = mockObject<IPromptsService>()({});\n\t\tpromptSlashCommandService.isValidSlashCommandName.callsFake((command: string) => {\n\t\t\treturn !!command.match(/^[\\w_\\-\\.]+$/);\n\t\t});\n\t\t// eslint-disable-next-line local/code-no-any-casts\n\t\tinstantiationService.stub(IPromptsService, promptSlashCommandService as any);\n\n\t\tparser = instantiationService.createInstance(ChatRequestParser);\n\t\tconst text = '    /prompt';\n\t\tconst result = parser.parseChatRequest(testSessionUri, text);\n\t\tawait assertSnapshot(result);\n\t});\n\n\ttest('prompt slash command after text', async () => {\n\t\tconst slashCommandService = mockObject<IChatSlashCommandService>()({});\n\t\tslashCommandService.getCommands.returns([{ command: 'fix' }]);\n\t\t// eslint-disable-next-line local/code-no-any-casts\n\t\tinstantiationService.stub(IChatSlashCommandService, slashCommandService as any);\n\n\t\tconst promptSlashCommandService = mockObject<IPromptsService>()({});\n\t\tpromptSlashCommandService.isValidSlashCommandName.callsFake((command: string) => {\n\t\t\treturn !!command.match(/^[\\w_\\-\\.]+$/);\n\t\t});\n\t\t// eslint-disable-next-line local/code-no-any-casts\n\t\tinstantiationService.stub(IPromptsService, promptSlashCommandService as any);\n\n\t\tparser = instantiationService.createInstance(ChatRequestParser);\n\t\tconst text = 'handle the / route and the request of /search-option';\n\t\tconst result = parser.parseChatRequest(testSessionUri, text);\n\t\tawait assertSnapshot(result);\n\t});\n\n\ttest('prompt slash command after slash', async () => {\n\t\tconst slashCommandService = mockObject<IChatSlashCommandService>()({});\n\t\tslashCommandService.getCommands.returns([{ command: 'fix' }]);\n\t\t// eslint-disable-next-line local/code-no-any-casts\n\t\tinstantiationService.stub(IChatSlashCommandService, slashCommandService as any);\n\n\t\tconst promptSlashCommandService = mockObject<IPromptsService>()({});\n\t\tpromptSlashCommandService.isValidSlashCommandName.callsFake((command: string) => {\n\t\t\treturn !!command.match(/^[\\w_\\-\\.]+$/);\n\n\t\t});\n\t\t// eslint-disable-next-line local/code-no-any-casts\n\t\tinstantiationService.stub(IPromptsService, promptSlashCommandService as any);\n\n\t\tparser = instantiationService.createInstance(ChatRequestParser);\n\t\tconst text = '/ route and the request of /search-option';\n\t\tconst result = parser.parseChatRequest(testSessionUri, text);\n\t\tawait assertSnapshot(result);\n\t});\n\n\ttest('prompt slash command with numbers', async () => {\n\t\tconst slashCommandService = mockObject<IChatSlashCommandService>()({});\n\t\tslashCommandService.getCommands.returns([{ command: 'fix' }]);\n\t\t// eslint-disable-next-line local/code-no-any-casts\n\t\tinstantiationService.stub(IChatSlashCommandService, slashCommandService as any);\n\n\t\tconst promptSlashCommandService = mockObject<IPromptsService>()({});\n\t\tpromptSlashCommandService.isValidSlashCommandName.callsFake((command: string) => {\n\t\t\treturn !!command.match(/^[\\w_\\-\\.]+$/);\n\t\t});\n\t\t// eslint-disable-next-line local/code-no-any-casts\n\t\tinstantiationService.stub(IPromptsService, promptSlashCommandService as any);\n\n\t\tparser = instantiationService.createInstance(ChatRequestParser);\n\t\tconst text = '/001-sample this is a test';\n\t\tconst result = parser.parseChatRequest(testSessionUri, text);\n\t\tawait assertSnapshot(result);\n\t});\n\n\t// test('variables', async () => {\n\t// \tvarService.hasVariable.returns(true);\n\t// \tvarService.getVariable.returns({ id: 'copilot.selection' });\n\n\t// \tparser = instantiationService.createInstance(ChatRequestParser);\n\t// \tconst text = 'What does #selection mean?';\n\t// \tconst result = parser.parseChatRequest(testSessionUri, text);\n\t// \tawait assertSnapshot(result);\n\t// });\n\n\t// test('variable with question mark', async () => {\n\t// \tvarService.hasVariable.returns(true);\n\t// \tvarService.getVariable.returns({ id: 'copilot.selection' });\n\n\t// \tparser = instantiationService.createInstance(ChatRequestParser);\n\t// \tconst text = 'What is #selection?';\n\t// \tconst result = parser.parseChatRequest(testSessionUri, text);\n\t// \tawait assertSnapshot(result);\n\t// });\n\n\t// test('invalid variables', async () => {\n\t// \tvarService.hasVariable.returns(false);\n\n\t// \tparser = instantiationService.createInstance(ChatRequestParser);\n\t// \tconst text = 'What does #selection mean?';\n\t// \tconst result = parser.parseChatRequest(testSessionUri, text);\n\t// \tawait assertSnapshot(result);\n\t// });\n\n\tconst getAgentWithSlashCommands = (slashCommands: IChatAgentCommand[]) => {\n\t\treturn { id: 'agent', name: 'agent', extensionId: nullExtensionDescription.identifier, extensionVersion: undefined, publisherDisplayName: '', extensionDisplayName: '', extensionPublisherId: '', locations: [ChatAgentLocation.Chat], modes: [ChatModeKind.Ask], metadata: {}, slashCommands, disambiguation: [] } satisfies IChatAgentData;\n\t};\n\n\ttest('agent with subcommand after text', async () => {\n\t\tconst agentsService = mockObject<IChatAgentService>()({});\n\t\tagentsService.getAgentsByName.returns([getAgentWithSlashCommands([{ name: 'subCommand', description: '' }])]);\n\t\t// eslint-disable-next-line local/code-no-any-casts\n\t\tinstantiationService.stub(IChatAgentService, agentsService as any);\n\n\t\tparser = instantiationService.createInstance(ChatRequestParser);\n\t\tconst result = parser.parseChatRequest(testSessionUri, '@agent Please do /subCommand thanks');\n\t\tawait assertSnapshot(result);\n\t});\n\n\ttest('agents, subCommand', async () => {\n\t\tconst agentsService = mockObject<IChatAgentService>()({});\n\t\tagentsService.getAgentsByName.returns([getAgentWithSlashCommands([{ name: 'subCommand', description: '' }])]);\n\t\t// eslint-disable-next-line local/code-no-any-casts\n\t\tinstantiationService.stub(IChatAgentService, agentsService as any);\n\n\t\tparser = instantiationService.createInstance(ChatRequestParser);\n\t\tconst result = parser.parseChatRequest(testSessionUri, '@agent /subCommand Please do thanks');\n\t\tawait assertSnapshot(result);\n\t});\n\n\ttest('agent but edit mode', async () => {\n\t\tconst agentsService = mockObject<IChatAgentService>()({});\n\t\tagentsService.getAgentsByName.returns([getAgentWithSlashCommands([])]);\n\t\t// eslint-disable-next-line local/code-no-any-casts\n\t\tinstantiationService.stub(IChatAgentService, agentsService as any);\n\n\t\tparser = instantiationService.createInstance(ChatRequestParser);\n\t\tconst result = parser.parseChatRequest(testSessionUri, '@agent hello', undefined, { mode: ChatModeKind.Edit });\n\t\tawait assertSnapshot(result);\n\t});\n\n\ttest('agent with question mark', async () => {\n\t\tconst agentsService = mockObject<IChatAgentService>()({});\n\t\tagentsService.getAgentsByName.returns([getAgentWithSlashCommands([{ name: 'subCommand', description: '' }])]);\n\t\t// eslint-disable-next-line local/code-no-any-casts\n\t\tinstantiationService.stub(IChatAgentService, agentsService as any);\n\n\t\tparser = instantiationService.createInstance(ChatRequestParser);\n\t\tconst result = parser.parseChatRequest(testSessionUri, '@agent? Are you there');\n\t\tawait assertSnapshot(result);\n\t});\n\n\ttest('agent and subcommand with leading whitespace', async () => {\n\t\tconst agentsService = mockObject<IChatAgentService>()({});\n\t\tagentsService.getAgentsByName.returns([getAgentWithSlashCommands([{ name: 'subCommand', description: '' }])]);\n\t\t// eslint-disable-next-line local/code-no-any-casts\n\t\tinstantiationService.stub(IChatAgentService, agentsService as any);\n\n\t\tparser = instantiationService.createInstance(ChatRequestParser);\n\t\tconst result = parser.parseChatRequest(testSessionUri, '    \\r\\n\\t   @agent \\r\\n\\t   /subCommand Thanks');\n\t\tawait assertSnapshot(result);\n\t});\n\n\ttest('agent and subcommand after newline', async () => {\n\t\tconst agentsService = mockObject<IChatAgentService>()({});\n\t\tagentsService.getAgentsByName.returns([getAgentWithSlashCommands([{ name: 'subCommand', description: '' }])]);\n\t\t// eslint-disable-next-line local/code-no-any-casts\n\t\tinstantiationService.stub(IChatAgentService, agentsService as any);\n\n\t\tparser = instantiationService.createInstance(ChatRequestParser);\n\t\tconst result = parser.parseChatRequest(testSessionUri, '    \\n@agent\\n/subCommand Thanks');\n\t\tawait assertSnapshot(result);\n\t});\n\n\ttest('agent not first', async () => {\n\t\tconst agentsService = mockObject<IChatAgentService>()({});\n\t\tagentsService.getAgentsByName.returns([getAgentWithSlashCommands([{ name: 'subCommand', description: '' }])]);\n\t\t// eslint-disable-next-line local/code-no-any-casts\n\t\tinstantiationService.stub(IChatAgentService, agentsService as any);\n\n\t\tparser = instantiationService.createInstance(ChatRequestParser);\n\t\tconst result = parser.parseChatRequest(testSessionUri, 'Hello Mr. @agent');\n\t\tawait assertSnapshot(result);\n\t});\n\n\ttest('agents and tools and multiline', async () => {\n\t\tconst agentsService = mockObject<IChatAgentService>()({});\n\t\tagentsService.getAgentsByName.returns([getAgentWithSlashCommands([{ name: 'subCommand', description: '' }])]);\n\t\t// eslint-disable-next-line local/code-no-any-casts\n\t\tinstantiationService.stub(IChatAgentService, agentsService as any);\n\n\t\tvariableService.setSelectedToolAndToolSets(testSessionUri, new Map([\n\t\t\t[{ id: 'get_selection', toolReferenceName: 'selection', canBeReferencedInPrompt: true, displayName: '', modelDescription: '', source: ToolDataSource.Internal }, true],\n\t\t\t[{ id: 'get_debugConsole', toolReferenceName: 'debugConsole', canBeReferencedInPrompt: true, displayName: '', modelDescription: '', source: ToolDataSource.Internal }, true]\n\t\t] satisfies [IToolData | ToolSet, boolean][]));\n\n\t\tparser = instantiationService.createInstance(ChatRequestParser);\n\t\tconst result = parser.parseChatRequest(testSessionUri, '@agent /subCommand \\nPlease do with #selection\\nand #debugConsole');\n\t\tawait assertSnapshot(result);\n\t});\n\n\ttest('agents and tools and multiline, part2', async () => {\n\t\tconst agentsService = mockObject<IChatAgentService>()({});\n\t\tagentsService.getAgentsByName.returns([getAgentWithSlashCommands([{ name: 'subCommand', description: '' }])]);\n\t\t// eslint-disable-next-line local/code-no-any-casts\n\t\tinstantiationService.stub(IChatAgentService, agentsService as any);\n\n\t\tvariableService.setSelectedToolAndToolSets(testSessionUri, new Map([\n\t\t\t[{ id: 'get_selection', toolReferenceName: 'selection', canBeReferencedInPrompt: true, displayName: '', modelDescription: '', source: ToolDataSource.Internal }, true],\n\t\t\t[{ id: 'get_debugConsole', toolReferenceName: 'debugConsole', canBeReferencedInPrompt: true, displayName: '', modelDescription: '', source: ToolDataSource.Internal }, true]\n\t\t] satisfies [IToolData | ToolSet, boolean][]));\n\n\t\tparser = instantiationService.createInstance(ChatRequestParser);\n\t\tconst result = parser.parseChatRequest(testSessionUri, '@agent Please \\ndo /subCommand with #selection\\nand #debugConsole');\n\t\tawait assertSnapshot(result);\n\t});\n});\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { mockObject } from '../../../../../base/test/common/mock.js';\nimport { assertSnapshot } from '../../../../../base/test/common/snapshot.js';\nimport { ensureNoDisposablesAreLeakedInTestSuite } from '../../../../../base/test/common/utils.js';\nimport { IContextKeyService } from '../../../../../platform/contextkey/common/contextkey.js';\nimport { TestInstantiationService } from '../../../../../platform/instantiation/test/common/instantiationServiceMock.js';\nimport { MockContextKeyService } from '../../../../../platform/keybinding/test/common/mockKeybindingService.js';\nimport { ILogService, NullLogService } from '../../../../../platform/log/common/log.js';\nimport { IStorageService } from '../../../../../platform/storage/common/storage.js';\nimport { IExtensionService, nullExtensionDescription } from '../../../../services/extensions/common/extensions.js';\nimport { TestExtensionService, TestStorageService } from '../../../../test/common/workbenchTestServices.js';\nimport { ChatAgentService, IChatAgentCommand, IChatAgentData, IChatAgentService } from '../../common/chatAgents.js';\nimport { ChatRequestParser } from '../../common/chatRequestParser.js';\nimport { IChatService } from '../../common/chatService.js';\nimport { IChatSlashCommandService } from '../../common/chatSlashCommands.js';\nimport { LocalChatSessionUri } from '../../common/chatUri.js';\nimport { IChatVariablesService } from '../../common/chatVariables.js';\nimport { ChatAgentLocation, ChatModeKind } from '../../common/constants.js';\nimport { IToolData, ToolDataSource, ToolSet } from '../../common/languageModelToolsService.js';\nimport { IPromptsService } from '../../common/promptSyntax/service/promptsService.js';\nimport { MockChatService } from './mockChatService.js';\nimport { MockChatVariablesService } from './mockChatVariables.js';\nimport { MockPromptsService } from './mockPromptsService.js';\n\nconst testSessionUri = LocalChatSessionUri.forSession('test-session');\n\nsuite('ChatRequestParser', () => {\n\tconst testDisposables = ensureNoDisposablesAreLeakedInTestSuite();\n\n\tlet instantiationService: TestInstantiationService;\n\tlet parser: ChatRequestParser;\n\n\tlet variableService: MockChatVariablesService;\n\tsetup(async () => {\n\t\tinstantiationService = testDisposables.add(new TestInstantiationService());\n\t\tinstantiationService.stub(IStorageService, testDisposables.add(new TestStorageService()));\n\t\tinstantiationService.stub(ILogService, new NullLogService());\n\t\tinstantiationService.stub(IExtensionService, new TestExtensionService());\n\t\tinstantiationService.stub(IChatService, new MockChatService());\n\t\tinstantiationService.stub(IContextKeyService, new MockContextKeyService());\n\t\tinstantiationService.stub(IChatAgentService, testDisposables.add(instantiationService.createInstance(ChatAgentService)));\n\t\tinstantiationService.stub(IPromptsService, testDisposables.add(new MockPromptsService()));\n\n\t\tvariableService = new MockChatVariablesService();\n\t\tinstantiationService.stub(IChatVariablesService, variableService);\n\t});\n\n\ttest('plain text', async () => {\n\t\tparser = instantiationService.createInstance(ChatRequestParser);\n\t\tconst result = parser.parseChatRequest(testSessionUri, 'test');\n\t\tawait assertSnapshot(result);\n\t});\n\n\ttest('plain text with newlines', async () => {\n\t\tparser = instantiationService.createInstance(ChatRequestParser);\n\t\tconst text = 'line 1\\nline 2\\r\\nline 3';\n\t\tconst result = parser.parseChatRequest(testSessionUri, text);\n\t\tawait assertSnapshot(result);\n\t});\n\n\ttest('slash in text', async () => {\n\t\tparser = instantiationService.createInstance(ChatRequestParser);\n\t\tconst text = 'can we add a new file for an Express router to handle the / route';\n\t\tconst result = parser.parseChatRequest(testSessionUri, text);\n\t\tawait assertSnapshot(result);\n\t});\n\n\ttest('slash command', async () => {\n\t\tconst slashCommandService = mockObject<IChatSlashCommandService>()({});\n\t\tslashCommandService.getCommands.returns([{ command: 'fix' }]);\n\t\t// eslint-disable-next-line local/code-no-any-casts\n\t\tinstantiationService.stub(IChatSlashCommandService, slashCommandService as any);\n\n\t\tparser = instantiationService.createInstance(ChatRequestParser);\n\t\tconst text = '/fix this';\n\t\tconst result = parser.parseChatRequest(testSessionUri, text);\n\t\tawait assertSnapshot(result);\n\t});\n\n\ttest('invalid slash command', async () => {\n\t\tconst slashCommandService = mockObject<IChatSlashCommandService>()({});\n\t\tslashCommandService.getCommands.returns([{ command: 'fix' }]);\n\t\t// eslint-disable-next-line local/code-no-any-casts\n\t\tinstantiationService.stub(IChatSlashCommandService, slashCommandService as any);\n\n\t\tparser = instantiationService.createInstance(ChatRequestParser);\n\t\tconst text = '/explain this';\n\t\tconst result = parser.parseChatRequest(testSessionUri, text);\n\t\tawait assertSnapshot(result);\n\t});\n\n\ttest('multiple slash commands', async () => {\n\t\tconst slashCommandService = mockObject<IChatSlashCommandService>()({});\n\t\tslashCommandService.getCommands.returns([{ command: 'fix' }]);\n\t\t// eslint-disable-next-line local/code-no-any-casts\n\t\tinstantiationService.stub(IChatSlashCommandService, slashCommandService as any);\n\n\t\tparser = instantiationService.createInstance(ChatRequestParser);\n\t\tconst text = '/fix /fix';\n\t\tconst result = parser.parseChatRequest(testSessionUri, text);\n\t\tawait assertSnapshot(result);\n\t});\n\n\ttest('slash command not first', async () => {\n\t\tconst slashCommandService = mockObject<IChatSlashCommandService>()({});\n\t\tslashCommandService.getCommands.returns([{ command: 'fix' }]);\n\t\t// eslint-disable-next-line local/code-no-any-casts\n\t\tinstantiationService.stub(IChatSlashCommandService, slashCommandService as any);\n\n\t\tparser = instantiationService.createInstance(ChatRequestParser);\n\t\tconst text = 'Hello /fix';\n\t\tconst result = parser.parseChatRequest(testSessionUri, text);\n\t\tawait assertSnapshot(result);\n\t});\n\n\ttest('slash command after whitespace', async () => {\n\t\tconst slashCommandService = mockObject<IChatSlashCommandService>()({});\n\t\tslashCommandService.getCommands.returns([{ command: 'fix' }]);\n\t\t// eslint-disable-next-line local/code-no-any-casts\n\t\tinstantiationService.stub(IChatSlashCommandService, slashCommandService as any);\n\n\t\tparser = instantiationService.createInstance(ChatRequestParser);\n\t\tconst text = '    /fix';\n\t\tconst result = parser.parseChatRequest(testSessionUri, text);\n\t\tawait assertSnapshot(result);\n\t});\n\n\ttest('prompt slash command', async () => {\n\t\tconst slashCommandService = mockObject<IChatSlashCommandService>()({});\n\t\tslashCommandService.getCommands.returns([{ command: 'fix' }]);\n\t\t// eslint-disable-next-line local/code-no-any-casts\n\t\tinstantiationService.stub(IChatSlashCommandService, slashCommandService as any);\n\n\t\tconst promptSlashCommandService = mockObject<IPromptsService>()({});\n\t\tpromptSlashCommandService.isValidSlashCommandName.callsFake((command: string) => {\n\t\t\treturn !!command.match(/^[\\w_\\-\\.]+$/);\n\t\t});\n\t\t// eslint-disable-next-line local/code-no-any-casts\n\t\tinstantiationService.stub(IPromptsService, promptSlashCommandService as any);\n\n\t\tparser = instantiationService.createInstance(ChatRequestParser);\n\t\tconst text = '    /prompt';\n\t\tconst result = parser.parseChatRequest(testSessionUri, text);\n\t\tawait assertSnapshot(result);\n\t});\n\n\ttest('prompt slash command after text', async () => {\n\t\tconst slashCommandService = mockObject<IChatSlashCommandService>()({});\n\t\tslashCommandService.getCommands.returns([{ command: 'fix' }]);\n\t\t// eslint-disable-next-line local/code-no-any-casts\n\t\tinstantiationService.stub(IChatSlashCommandService, slashCommandService as any);\n\n\t\tconst promptSlashCommandService = mockObject<IPromptsService>()({});\n\t\tpromptSlashCommandService.isValidSlashCommandName.callsFake((command: string) => {\n\t\t\treturn !!command.match(/^[\\w_\\-\\.]+$/);\n\t\t});\n\t\t// eslint-disable-next-line local/code-no-any-casts\n\t\tinstantiationService.stub(IPromptsService, promptSlashCommandService as any);\n\n\t\tparser = instantiationService.createInstance(ChatRequestParser);\n\t\tconst text = 'handle the / route and the request of /search-option';\n\t\tconst result = parser.parseChatRequest(testSessionUri, text);\n\t\tawait assertSnapshot(result);\n\t});\n\n\ttest('prompt slash command after slash', async () => {\n\t\tconst slashCommandService = mockObject<IChatSlashCommandService>()({});\n\t\tslashCommandService.getCommands.returns([{ command: 'fix' }]);\n\t\t// eslint-disable-next-line local/code-no-any-casts\n\t\tinstantiationService.stub(IChatSlashCommandService, slashCommandService as any);\n\n\t\tconst promptSlashCommandService = mockObject<IPromptsService>()({});\n\t\tpromptSlashCommandService.isValidSlashCommandName.callsFake((command: string) => {\n\t\t\treturn !!command.match(/^[\\w_\\-\\.]+$/);\n\n\t\t});\n\t\t// eslint-disable-next-line local/code-no-any-casts\n\t\tinstantiationService.stub(IPromptsService, promptSlashCommandService as any);\n\n\t\tparser = instantiationService.createInstance(ChatRequestParser);\n\t\tconst text = '/ route and the request of /search-option';\n\t\tconst result = parser.parseChatRequest(testSessionUri, text);\n\t\tawait assertSnapshot(result);\n\t});\n\n\ttest('prompt slash command with numbers', async () => {\n\t\tconst slashCommandService = mockObject<IChatSlashCommandService>()({});\n\t\tslashCommandService.getCommands.returns([{ command: 'fix' }]);\n\t\t// eslint-disable-next-line local/code-no-any-casts\n\t\tinstantiationService.stub(IChatSlashCommandService, slashCommandService as any);\n\n\t\tconst promptSlashCommandService = mockObject<IPromptsService>()({});\n\t\tpromptSlashCommandService.isValidSlashCommandName.callsFake((command: string) => {\n\t\t\treturn !!command.match(/^[\\w_\\-\\.]+$/);\n\t\t});\n\t\t// eslint-disable-next-line local/code-no-any-casts\n\t\tinstantiationService.stub(IPromptsService, promptSlashCommandService as any);\n\n\t\tparser = instantiationService.createInstance(ChatRequestParser);\n\t\tconst text = '/001-sample this is a test';\n\t\tconst result = parser.parseChatRequest(testSessionUri, text);\n\t\tawait assertSnapshot(result);\n\t});\n\n\t// test('variables', async () => {\n\t// \tvarService.hasVariable.returns(true);\n\t// \tvarService.getVariable.returns({ id: 'copilot.selection' });\n\n\t// \tparser = instantiationService.createInstance(ChatRequestParser);\n\t// \tconst text = 'What does #selection mean?';\n\t// \tconst result = parser.parseChatRequest(testSessionUri, text);\n\t// \tawait assertSnapshot(result);\n\t// });\n\n\t// test('variable with question mark', async () => {\n\t// \tvarService.hasVariable.returns(true);\n\t// \tvarService.getVariable.returns({ id: 'copilot.selection' });\n\n\t// \tparser = instantiationService.createInstance(ChatRequestParser);\n\t// \tconst text = 'What is #selection?';\n\t// \tconst result = parser.parseChatRequest(testSessionUri, text);\n\t// \tawait assertSnapshot(result);\n\t// });\n\n\t// test('invalid variables', async () => {\n\t// \tvarService.hasVariable.returns(false);\n\n\t// \tparser = instantiationService.createInstance(ChatRequestParser);\n\t// \tconst text = 'What does #selection mean?';\n\t// \tconst result = parser.parseChatRequest(testSessionUri, text);\n\t// \tawait assertSnapshot(result);\n\t// });\n\n\tconst getAgentWithSlashCommands = (slashCommands: IChatAgentCommand[]) => {\n\t\treturn { id: 'agent', name: 'agent', extensionId: nullExtensionDescription.identifier, extensionVersion: undefined, publisherDisplayName: '', extensionDisplayName: '', extensionPublisherId: '', locations: [ChatAgentLocation.Chat], modes: [ChatModeKind.Ask], metadata: {}, slashCommands, disambiguation: [] } satisfies IChatAgentData;\n\t};\n\n\ttest('agent with subcommand after text', async () => {\n\t\tconst agentsService = mockObject<IChatAgentService>()({});\n\t\tagentsService.getAgentsByName.returns([getAgentWithSlashCommands([{ name: 'subCommand', description: '' }])]);\n\t\t// eslint-disable-next-line local/code-no-any-casts\n\t\tinstantiationService.stub(IChatAgentService, agentsService as any);\n\n\t\tparser = instantiationService.createInstance(ChatRequestParser);\n\t\tconst result = parser.parseChatRequest(testSessionUri, '@agent Please do /subCommand thanks');\n\t\tawait assertSnapshot(result);\n\t});\n\n\ttest('agents, subCommand', async () => {\n\t\tconst agentsService = mockObject<IChatAgentService>()({});\n\t\tagentsService.getAgentsByName.returns([getAgentWithSlashCommands([{ name: 'subCommand', description: '' }])]);\n\t\t// eslint-disable-next-line local/code-no-any-casts\n\t\tinstantiationService.stub(IChatAgentService, agentsService as any);\n\n\t\tparser = instantiationService.createInstance(ChatRequestParser);\n\t\tconst result = parser.parseChatRequest(testSessionUri, '@agent /subCommand Please do thanks');\n\t\tawait assertSnapshot(result);\n\t});\n\n\ttest('agent but edit mode', async () => {\n\t\tconst agentsService = mockObject<IChatAgentService>()({});\n\t\tagentsService.getAgentsByName.returns([getAgentWithSlashCommands([])]);\n\t\t// eslint-disable-next-line local/code-no-any-casts\n\t\tinstantiationService.stub(IChatAgentService, agentsService as any);\n\n\t\tparser = instantiationService.createInstance(ChatRequestParser);\n\t\tconst result = parser.parseChatRequest(testSessionUri, '@agent hello', undefined, { mode: ChatModeKind.Edit });\n\t\tawait assertSnapshot(result);\n\t});\n\n\ttest('agent with question mark', async () => {\n\t\tconst agentsService = mockObject<IChatAgentService>()({});\n\t\tagentsService.getAgentsByName.returns([getAgentWithSlashCommands([{ name: 'subCommand', description: '' }])]);\n\t\t// eslint-disable-next-line local/code-no-any-casts\n\t\tinstantiationService.stub(IChatAgentService, agentsService as any);\n\n\t\tparser = instantiationService.createInstance(ChatRequestParser);\n\t\tconst result = parser.parseChatRequest(testSessionUri, '@agent? Are you there');\n\t\tawait assertSnapshot(result);\n\t});\n\n\ttest('agent and subcommand with leading whitespace', async () => {\n\t\tconst agentsService = mockObject<IChatAgentService>()({});\n\t\tagentsService.getAgentsByName.returns([getAgentWithSlashCommands([{ name: 'subCommand', description: '' }])]);\n\t\t// eslint-disable-next-line local/code-no-any-casts\n\t\tinstantiationService.stub(IChatAgentService, agentsService as any);\n\n\t\tparser = instantiationService.createInstance(ChatRequestParser);\n\t\tconst result = parser.parseChatRequest(testSessionUri, '    \\r\\n\\t   @agent \\r\\n\\t   /subCommand Thanks');\n\t\tawait assertSnapshot(result);\n\t});\n\n\ttest('agent and subcommand after newline', async () => {\n\t\tconst agentsService = mockObject<IChatAgentService>()({});\n\t\tagentsService.getAgentsByName.returns([getAgentWithSlashCommands([{ name: 'subCommand', description: '' }])]);\n\t\t// eslint-disable-next-line local/code-no-any-casts\n\t\tinstantiationService.stub(IChatAgentService, agentsService as any);\n\n\t\tparser = instantiationService.createInstance(ChatRequestParser);\n\t\tconst result = parser.parseChatRequest(testSessionUri, '    \\n@agent\\n/subCommand Thanks');\n\t\tawait assertSnapshot(result);\n\t});\n\n\ttest('agent not first', async () => {\n\t\tconst agentsService = mockObject<IChatAgentService>()({});\n\t\tagentsService.getAgentsByName.returns([getAgentWithSlashCommands([{ name: 'subCommand', description: '' }])]);\n\t\t// eslint-disable-next-line local/code-no-any-casts\n\t\tinstantiationService.stub(IChatAgentService, agentsService as any);\n\n\t\tparser = instantiationService.createInstance(ChatRequestParser);\n\t\tconst result = parser.parseChatRequest(testSessionUri, 'Hello Mr. @agent');\n\t\tawait assertSnapshot(result);\n\t});\n\n\ttest('agents and tools and multiline', async () => {\n\t\tconst agentsService = mockObject<IChatAgentService>()({});\n\t\tagentsService.getAgentsByName.returns([getAgentWithSlashCommands([{ name: 'subCommand', description: '' }])]);\n\t\t// eslint-disable-next-line local/code-no-any-casts\n\t\tinstantiationService.stub(IChatAgentService, agentsService as any);\n\n\t\tvariableService.setSelectedToolAndToolSets(testSessionUri, new Map([\n\t\t\t[{ id: 'get_selection', toolReferenceName: 'selection', canBeReferencedInPrompt: true, displayName: '', modelDescription: '', source: ToolDataSource.Internal }, true],\n\t\t\t[{ id: 'get_debugConsole', toolReferenceName: 'debugConsole', canBeReferencedInPrompt: true, displayName: '', modelDescription: '', source: ToolDataSource.Internal }, true]\n\t\t] satisfies [IToolData | ToolSet, boolean][]));\n\n\t\tparser = instantiationService.createInstance(ChatRequestParser);\n\t\tconst result = parser.parseChatRequest(testSessionUri, '@agent /subCommand \\nPlease do with #selection\\nand #debugConsole');\n\t\tawait assertSnapshot(result);\n\t});\n\n\ttest('agents and tools and multiline, part2', async () => {\n\t\tconst agentsService = mockObject<IChatAgentService>()({});\n\t\tagentsService.getAgentsByName.returns([getAgentWithSlashCommands([{ name: 'subCommand', description: '' }])]);\n\t\t// eslint-disable-next-line local/code-no-any-casts\n\t\tinstantiationService.stub(IChatAgentService, agentsService as any);\n\n\t\tvariableService.setSelectedToolAndToolSets(testSessionUri, new Map([\n\t\t\t[{ id: 'get_selection', toolReferenceName: 'selection', canBeReferencedInPrompt: true, displayName: '', modelDescription: '', source: ToolDataSource.Internal }, true],\n\t\t\t[{ id: 'get_debugConsole', toolReferenceName: 'debugConsole', canBeReferencedInPrompt: true, displayName: '', modelDescription: '', source: ToolDataSource.Internal }, true]\n\t\t] satisfies [IToolData | ToolSet, boolean][]));\n\n\t\tparser = instantiationService.createInstance(ChatRequestParser);\n\t\tconst result = parser.parseChatRequest(testSessionUri, '@agent Please \\ndo /subCommand with #selection\\nand #debugConsole');\n\t\tawait assertSnapshot(result);\n\t});\n});\n"]}