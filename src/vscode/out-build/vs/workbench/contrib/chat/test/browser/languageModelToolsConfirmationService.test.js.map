{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/contrib/chat/test/browser/languageModelToolsConfirmationService.test.ts","vs/workbench/contrib/chat/test/browser/languageModelToolsConfirmationService.test.ts"],"names":[],"mappings":"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","file":"languageModelToolsConfirmationService.test.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as assert from 'assert';\nimport { ensureNoDisposablesAreLeakedInTestSuite } from '../../../../../base/test/common/utils.js';\nimport { TestInstantiationService } from '../../../../../platform/instantiation/test/common/instantiationServiceMock.js';\nimport { IStorageService, InMemoryStorageService } from '../../../../../platform/storage/common/storage.js';\nimport { LanguageModelToolsConfirmationService } from '../../browser/languageModelToolsConfirmationService.js';\nimport { ToolConfirmKind } from '../../common/chatService.js';\nimport { ILanguageModelToolConfirmationActions, ILanguageModelToolConfirmationContribution, ILanguageModelToolConfirmationRef } from '../../common/languageModelToolsConfirmationService.js';\nimport { ToolDataSource } from '../../common/languageModelToolsService.js';\n\nsuite('LanguageModelToolsConfirmationService', () => {\n\tconst store = ensureNoDisposablesAreLeakedInTestSuite();\n\n\tlet service: LanguageModelToolsConfirmationService;\n\tlet instantiationService: TestInstantiationService;\n\n\tsetup(() => {\n\t\tinstantiationService = store.add(new TestInstantiationService());\n\t\tinstantiationService.stub(IStorageService, store.add(new InMemoryStorageService()));\n\n\t\tservice = store.add(instantiationService.createInstance(LanguageModelToolsConfirmationService));\n\t});\n\n\tfunction createToolRef(toolId: string, source: ToolDataSource = ToolDataSource.Internal, parameters: unknown = {}): ILanguageModelToolConfirmationRef {\n\t\treturn { toolId, source, parameters };\n\t}\n\n\tfunction createMcpToolRef(toolId: string, definitionId: string, serverLabel: string, parameters: unknown = {}): ILanguageModelToolConfirmationRef {\n\t\treturn {\n\t\t\ttoolId,\n\t\t\tsource: {\n\t\t\t\ttype: 'mcp',\n\t\t\t\tlabel: serverLabel,\n\t\t\t\tserverLabel,\n\t\t\t\tinstructions: undefined,\n\t\t\t\tcollectionId: 'testCollection',\n\t\t\t\tdefinitionId\n\t\t\t},\n\t\t\tparameters\n\t\t};\n\t}\n\n\ttest('getPreConfirmAction returns undefined by default', () => {\n\t\tconst ref = createToolRef('testTool');\n\t\tconst result = service.getPreConfirmAction(ref);\n\t\tassert.strictEqual(result, undefined);\n\t});\n\n\ttest('getPostConfirmAction returns undefined by default', () => {\n\t\tconst ref = createToolRef('testTool');\n\t\tconst result = service.getPostConfirmAction(ref);\n\t\tassert.strictEqual(result, undefined);\n\t});\n\n\ttest('getPreConfirmActions returns default tool-level actions', () => {\n\t\tconst ref = createToolRef('testTool');\n\t\tconst actions = service.getPreConfirmActions(ref);\n\n\t\tassert.ok(actions.length >= 3);\n\t\tassert.ok(actions.some(a => a.label.includes('Session')));\n\t\tassert.ok(actions.some(a => a.label.includes('Workspace')));\n\t\tassert.ok(actions.some(a => a.label.includes('Always Allow')));\n\t});\n\n\ttest('getPostConfirmActions returns default tool-level actions', () => {\n\t\tconst ref = createToolRef('testTool');\n\t\tconst actions = service.getPostConfirmActions(ref);\n\n\t\tassert.ok(actions.length >= 3);\n\t\tassert.ok(actions.some(a => a.label.includes('Session')));\n\t\tassert.ok(actions.some(a => a.label.includes('Workspace')));\n\t\tassert.ok(actions.some(a => a.label.includes('Always Allow')));\n\t});\n\n\ttest('getPreConfirmActions includes server-level actions for MCP tools', () => {\n\t\tconst ref = createMcpToolRef('mcpTool', 'serverId', 'Test Server');\n\t\tconst actions = service.getPreConfirmActions(ref);\n\n\t\tassert.ok(actions.some(a => a.label.includes('Test Server') && a.label.includes('Session')));\n\t\tassert.ok(actions.some(a => a.label.includes('Test Server') && a.label.includes('Workspace')));\n\t\tassert.ok(actions.some(a => a.label.includes('Test Server') && a.label.includes('Always Allow')));\n\t});\n\n\ttest('getPostConfirmActions includes server-level actions for MCP tools', () => {\n\t\tconst ref = createMcpToolRef('mcpTool', 'serverId', 'Test Server');\n\t\tconst actions = service.getPostConfirmActions(ref);\n\n\t\tassert.ok(actions.some(a => a.label.includes('Test Server') && a.label.includes('Session')));\n\t\tassert.ok(actions.some(a => a.label.includes('Test Server') && a.label.includes('Workspace')));\n\t\tassert.ok(actions.some(a => a.label.includes('Test Server') && a.label.includes('Always Allow')));\n\t});\n\n\ttest('pre-execution session confirmation works', async () => {\n\t\tconst ref = createToolRef('testTool');\n\t\tconst actions = service.getPreConfirmActions(ref);\n\t\tconst sessionAction = actions.find(a => a.label.includes('Session') && !a.label.includes('Server'));\n\n\t\tassert.ok(sessionAction);\n\t\tawait sessionAction.select();\n\n\t\tconst result = service.getPreConfirmAction(ref);\n\t\tassert.deepStrictEqual(result, { type: ToolConfirmKind.LmServicePerTool, scope: 'session' });\n\t});\n\n\ttest('pre-execution workspace confirmation works', async () => {\n\t\tconst ref = createToolRef('testTool');\n\t\tconst actions = service.getPreConfirmActions(ref);\n\t\tconst workspaceAction = actions.find(a => a.label.includes('Workspace') && !a.label.includes('Server'));\n\n\t\tassert.ok(workspaceAction);\n\t\tawait workspaceAction.select();\n\n\t\tconst result = service.getPreConfirmAction(ref);\n\t\tassert.deepStrictEqual(result, { type: ToolConfirmKind.LmServicePerTool, scope: 'workspace' });\n\t});\n\n\ttest('pre-execution profile confirmation works', async () => {\n\t\tconst ref = createToolRef('testTool');\n\t\tconst actions = service.getPreConfirmActions(ref);\n\t\tconst profileAction = actions.find(a => a.label.includes('Always Allow') && !a.label.includes('Server'));\n\n\t\tassert.ok(profileAction);\n\t\tawait profileAction.select();\n\n\t\tconst result = service.getPreConfirmAction(ref);\n\t\tassert.deepStrictEqual(result, { type: ToolConfirmKind.LmServicePerTool, scope: 'profile' });\n\t});\n\n\ttest('post-execution session confirmation works', async () => {\n\t\tconst ref = createToolRef('testTool');\n\t\tconst actions = service.getPostConfirmActions(ref);\n\t\tconst sessionAction = actions.find(a => a.label.includes('Session') && !a.label.includes('Server'));\n\n\t\tassert.ok(sessionAction);\n\t\tawait sessionAction.select();\n\n\t\tconst result = service.getPostConfirmAction(ref);\n\t\tassert.deepStrictEqual(result, { type: ToolConfirmKind.LmServicePerTool, scope: 'session' });\n\t});\n\n\ttest('post-execution workspace confirmation works', async () => {\n\t\tconst ref = createToolRef('testTool');\n\t\tconst actions = service.getPostConfirmActions(ref);\n\t\tconst workspaceAction = actions.find(a => a.label.includes('Workspace') && !a.label.includes('Server'));\n\n\t\tassert.ok(workspaceAction);\n\t\tawait workspaceAction.select();\n\n\t\tconst result = service.getPostConfirmAction(ref);\n\t\tassert.deepStrictEqual(result, { type: ToolConfirmKind.LmServicePerTool, scope: 'workspace' });\n\t});\n\n\ttest('post-execution profile confirmation works', async () => {\n\t\tconst ref = createToolRef('testTool');\n\t\tconst actions = service.getPostConfirmActions(ref);\n\t\tconst profileAction = actions.find(a => a.label.includes('Always Allow') && !a.label.includes('Server'));\n\n\t\tassert.ok(profileAction);\n\t\tawait profileAction.select();\n\n\t\tconst result = service.getPostConfirmAction(ref);\n\t\tassert.deepStrictEqual(result, { type: ToolConfirmKind.LmServicePerTool, scope: 'profile' });\n\t});\n\n\ttest('MCP server-level pre-execution session confirmation works', async () => {\n\t\tconst ref = createMcpToolRef('mcpTool', 'serverId', 'Test Server');\n\t\tconst actions = service.getPreConfirmActions(ref);\n\t\tconst serverAction = actions.find(a => a.label.includes('Test Server') && a.label.includes('Session'));\n\n\t\tassert.ok(serverAction);\n\t\tawait serverAction.select();\n\n\t\tconst result = service.getPreConfirmAction(ref);\n\t\tassert.deepStrictEqual(result, { type: ToolConfirmKind.LmServicePerTool, scope: 'session' });\n\t});\n\n\ttest('MCP server-level pre-execution workspace confirmation works', async () => {\n\t\tconst ref = createMcpToolRef('mcpTool', 'serverId', 'Test Server');\n\t\tconst actions = service.getPreConfirmActions(ref);\n\t\tconst serverAction = actions.find(a => a.label.includes('Test Server') && a.label.includes('Workspace'));\n\n\t\tassert.ok(serverAction);\n\t\tawait serverAction.select();\n\n\t\tconst result = service.getPreConfirmAction(ref);\n\t\tassert.deepStrictEqual(result, { type: ToolConfirmKind.LmServicePerTool, scope: 'workspace' });\n\t});\n\n\ttest('MCP server-level pre-execution profile confirmation works', async () => {\n\t\tconst ref = createMcpToolRef('mcpTool', 'serverId', 'Test Server');\n\t\tconst actions = service.getPreConfirmActions(ref);\n\t\tconst serverAction = actions.find(a => a.label.includes('Test Server') && a.label.includes('Always Allow'));\n\n\t\tassert.ok(serverAction);\n\t\tawait serverAction.select();\n\n\t\tconst result = service.getPreConfirmAction(ref);\n\t\tassert.deepStrictEqual(result, { type: ToolConfirmKind.LmServicePerTool, scope: 'profile' });\n\t});\n\n\ttest('MCP server-level post-execution session confirmation works', async () => {\n\t\tconst ref = createMcpToolRef('mcpTool', 'serverId', 'Test Server');\n\t\tconst actions = service.getPostConfirmActions(ref);\n\t\tconst serverAction = actions.find(a => a.label.includes('Test Server') && a.label.includes('Session'));\n\n\t\tassert.ok(serverAction);\n\t\tawait serverAction.select();\n\n\t\tconst result = service.getPostConfirmAction(ref);\n\t\tassert.deepStrictEqual(result, { type: ToolConfirmKind.LmServicePerTool, scope: 'session' });\n\t});\n\n\ttest('MCP server-level confirmation applies to all tools from that server', async () => {\n\t\tconst ref1 = createMcpToolRef('mcpTool1', 'serverId', 'Test Server');\n\t\tconst ref2 = createMcpToolRef('mcpTool2', 'serverId', 'Test Server');\n\n\t\tconst actions = service.getPreConfirmActions(ref1);\n\t\tconst serverAction = actions.find(a => a.label.includes('Test Server') && a.label.includes('Session'));\n\n\t\tassert.ok(serverAction);\n\t\tawait serverAction.select();\n\n\t\tconst result1 = service.getPreConfirmAction(ref1);\n\t\tconst result2 = service.getPreConfirmAction(ref2);\n\n\t\tassert.deepStrictEqual(result1, { type: ToolConfirmKind.LmServicePerTool, scope: 'session' });\n\t\tassert.deepStrictEqual(result2, { type: ToolConfirmKind.LmServicePerTool, scope: 'session' });\n\t});\n\n\ttest('tool-level confirmation takes precedence over server-level confirmation', async () => {\n\t\tconst ref = createMcpToolRef('mcpTool', 'serverId', 'Test Server');\n\n\t\t// Set server-level confirmation\n\t\tconst serverActions = service.getPreConfirmActions(ref);\n\t\tconst serverAction = serverActions.find(a => a.label.includes('Test Server') && a.label.includes('Session'));\n\t\tassert.ok(serverAction);\n\t\tawait serverAction.select();\n\n\t\t// Set tool-level confirmation to a different scope\n\t\tconst toolActions = service.getPreConfirmActions(ref);\n\t\tconst toolAction = toolActions.find(a => !a.label.includes('Test Server') && a.label.includes('Workspace'));\n\t\tassert.ok(toolAction);\n\t\tawait toolAction.select();\n\n\t\t// Tool-level should take precedence\n\t\tconst result = service.getPreConfirmAction(ref);\n\t\tassert.deepStrictEqual(result, { type: ToolConfirmKind.LmServicePerTool, scope: 'workspace' });\n\t});\n\n\ttest('registerConfirmationContribution allows custom pre-confirm actions', () => {\n\t\tconst contribution: ILanguageModelToolConfirmationContribution = {\n\t\t\tgetPreConfirmAction: (ref) => {\n\t\t\t\treturn { type: ToolConfirmKind.UserAction };\n\t\t\t}\n\t\t};\n\n\t\tstore.add(service.registerConfirmationContribution('customTool', contribution));\n\n\t\tconst ref = createToolRef('customTool');\n\t\tconst result = service.getPreConfirmAction(ref);\n\n\t\tassert.ok(result);\n\t\tassert.strictEqual(result.type, ToolConfirmKind.UserAction);\n\t});\n\n\ttest('registerConfirmationContribution allows custom post-confirm actions', () => {\n\t\tconst contribution: ILanguageModelToolConfirmationContribution = {\n\t\t\tgetPostConfirmAction: (ref) => {\n\t\t\t\treturn { type: ToolConfirmKind.UserAction };\n\t\t\t}\n\t\t};\n\n\t\tstore.add(service.registerConfirmationContribution('customTool', contribution));\n\n\t\tconst ref = createToolRef('customTool');\n\t\tconst result = service.getPostConfirmAction(ref);\n\n\t\tassert.ok(result);\n\t\tassert.strictEqual(result.type, ToolConfirmKind.UserAction);\n\t});\n\n\ttest('registerConfirmationContribution allows custom pre-confirm action list', () => {\n\t\tconst customActions: ILanguageModelToolConfirmationActions[] = [\n\t\t\t{\n\t\t\t\tlabel: 'Custom Action 1',\n\t\t\t\tselect: async () => true\n\t\t\t},\n\t\t\t{\n\t\t\t\tlabel: 'Custom Action 2',\n\t\t\t\tselect: async () => true\n\t\t\t}\n\t\t];\n\n\t\tconst contribution: ILanguageModelToolConfirmationContribution = {\n\t\t\tgetPreConfirmActions: (ref) => customActions\n\t\t};\n\n\t\tstore.add(service.registerConfirmationContribution('customTool', contribution));\n\n\t\tconst ref = createToolRef('customTool');\n\t\tconst actions = service.getPreConfirmActions(ref);\n\n\t\t// Should include both custom actions and default actions\n\t\tassert.ok(actions.some(a => a.label === 'Custom Action 1'));\n\t\tassert.ok(actions.some(a => a.label === 'Custom Action 2'));\n\t\tassert.ok(actions.some(a => a.label.includes('Session')));\n\t});\n\n\ttest('registerConfirmationContribution with canUseDefaultApprovals=false only shows custom actions', () => {\n\t\tconst customActions: ILanguageModelToolConfirmationActions[] = [\n\t\t\t{\n\t\t\t\tlabel: 'Custom Action Only',\n\t\t\t\tselect: async () => true\n\t\t\t}\n\t\t];\n\n\t\tconst contribution: ILanguageModelToolConfirmationContribution = {\n\t\t\tcanUseDefaultApprovals: false,\n\t\t\tgetPreConfirmActions: (ref) => customActions\n\t\t};\n\n\t\tstore.add(service.registerConfirmationContribution('customTool', contribution));\n\n\t\tconst ref = createToolRef('customTool');\n\t\tconst actions = service.getPreConfirmActions(ref);\n\n\t\tassert.strictEqual(actions.length, 1);\n\t\tassert.strictEqual(actions[0].label, 'Custom Action Only');\n\t});\n\n\ttest('contribution getPreConfirmAction takes precedence over default stores', () => {\n\t\tconst contribution: ILanguageModelToolConfirmationContribution = {\n\t\t\tgetPreConfirmAction: (ref) => {\n\t\t\t\treturn { type: ToolConfirmKind.UserAction };\n\t\t\t}\n\t\t};\n\n\t\tstore.add(service.registerConfirmationContribution('customTool', contribution));\n\n\t\t// Contribution should take precedence even without setting default\n\t\tconst ref = createToolRef('customTool');\n\t\tconst result = service.getPreConfirmAction(ref);\n\t\tassert.ok(result);\n\t\tassert.strictEqual(result.type, ToolConfirmKind.UserAction);\n\t});\n\n\ttest('contribution with canUseDefaultApprovals=false prevents default store checks', () => {\n\t\tconst contribution: ILanguageModelToolConfirmationContribution = {\n\t\t\tcanUseDefaultApprovals: false,\n\t\t\tgetPreConfirmAction: () => undefined\n\t\t};\n\n\t\tstore.add(service.registerConfirmationContribution('customTool', contribution));\n\n\t\tconst ref = createToolRef('customTool');\n\t\tconst actions = service.getPreConfirmActions(ref);\n\n\t\t// Should have no actions since canUseDefaultApprovals is false\n\t\tassert.strictEqual(actions.length, 0);\n\t});\n\n\ttest('resetToolAutoConfirmation clears all confirmations', async () => {\n\t\tconst ref1 = createToolRef('tool1');\n\t\tconst ref2 = createMcpToolRef('mcpTool', 'serverId', 'Test Server');\n\n\t\t// Set some confirmations\n\t\tconst actions1 = service.getPreConfirmActions(ref1);\n\t\tconst sessionAction1 = actions1.find(a => a.label.includes('Session') && !a.label.includes('Server'));\n\t\tassert.ok(sessionAction1);\n\t\tawait sessionAction1.select();\n\n\t\tconst actions2 = service.getPreConfirmActions(ref2);\n\t\tconst serverAction = actions2.find(a => a.label.includes('Test Server') && a.label.includes('Session'));\n\t\tassert.ok(serverAction);\n\t\tawait serverAction.select();\n\n\t\t// Verify they're set\n\t\tassert.ok(service.getPreConfirmAction(ref1));\n\t\tassert.ok(service.getPreConfirmAction(ref2));\n\n\t\t// Reset\n\t\tservice.resetToolAutoConfirmation();\n\n\t\t// Verify they're cleared\n\t\tassert.strictEqual(service.getPreConfirmAction(ref1), undefined);\n\t\tassert.strictEqual(service.getPreConfirmAction(ref2), undefined);\n\t});\n\n\ttest('resetToolAutoConfirmation calls contribution reset', () => {\n\t\tlet resetCalled = false;\n\t\tconst contribution: ILanguageModelToolConfirmationContribution = {\n\t\t\treset: () => {\n\t\t\t\tresetCalled = true;\n\t\t\t}\n\t\t};\n\n\t\tstore.add(service.registerConfirmationContribution('customTool', contribution));\n\n\t\tservice.resetToolAutoConfirmation();\n\n\t\tassert.strictEqual(resetCalled, true);\n\t});\n\n\ttest('disposing contribution registration removes it', () => {\n\t\tconst contribution: ILanguageModelToolConfirmationContribution = {\n\t\t\tgetPreConfirmAction: (ref) => {\n\t\t\t\treturn { type: ToolConfirmKind.UserAction };\n\t\t\t}\n\t\t};\n\n\t\tconst disposable = service.registerConfirmationContribution('customTool', contribution);\n\n\t\tconst ref = createToolRef('customTool');\n\t\tlet result = service.getPreConfirmAction(ref);\n\t\tassert.ok(result);\n\t\tassert.strictEqual(result.type, ToolConfirmKind.UserAction);\n\n\t\tdisposable.dispose();\n\n\t\tresult = service.getPreConfirmAction(ref);\n\t\tassert.strictEqual(result, undefined);\n\t});\n\n\ttest('different tools have independent confirmations', async () => {\n\t\tconst ref1 = createToolRef('tool1');\n\t\tconst ref2 = createToolRef('tool2');\n\n\t\t// Set session for tool1\n\t\tconst actions1 = service.getPreConfirmActions(ref1);\n\t\tconst sessionAction = actions1.find(a => a.label.includes('Session') && !a.label.includes('Server'));\n\t\tassert.ok(sessionAction);\n\t\tawait sessionAction.select();\n\n\t\t// Set workspace for tool2\n\t\tconst actions2 = service.getPreConfirmActions(ref2);\n\t\tconst workspaceAction = actions2.find(a => a.label.includes('Workspace') && !a.label.includes('Server'));\n\t\tassert.ok(workspaceAction);\n\t\tawait workspaceAction.select();\n\n\t\t// Verify they're independent\n\t\tconst result1 = service.getPreConfirmAction(ref1);\n\t\tconst result2 = service.getPreConfirmAction(ref2);\n\n\t\tassert.deepStrictEqual(result1, { type: ToolConfirmKind.LmServicePerTool, scope: 'session' });\n\t\tassert.deepStrictEqual(result2, { type: ToolConfirmKind.LmServicePerTool, scope: 'workspace' });\n\t});\n\n\ttest('pre and post execution confirmations are independent', async () => {\n\t\tconst ref = createToolRef('testTool');\n\n\t\t// Set pre-execution to session\n\t\tconst preActions = service.getPreConfirmActions(ref);\n\t\tconst preSessionAction = preActions.find(a => a.label.includes('Session') && !a.label.includes('Server'));\n\t\tassert.ok(preSessionAction);\n\t\tawait preSessionAction.select();\n\n\t\t// Set post-execution to workspace\n\t\tconst postActions = service.getPostConfirmActions(ref);\n\t\tconst postWorkspaceAction = postActions.find(a => a.label.includes('Workspace') && !a.label.includes('Server'));\n\t\tassert.ok(postWorkspaceAction);\n\t\tawait postWorkspaceAction.select();\n\n\t\t// Verify they're independent\n\t\tconst preResult = service.getPreConfirmAction(ref);\n\t\tconst postResult = service.getPostConfirmAction(ref);\n\n\t\tassert.deepStrictEqual(preResult, { type: ToolConfirmKind.LmServicePerTool, scope: 'session' });\n\t\tassert.deepStrictEqual(postResult, { type: ToolConfirmKind.LmServicePerTool, scope: 'workspace' });\n\t});\n\n\ttest('different MCP servers have independent confirmations', async () => {\n\t\tconst ref1 = createMcpToolRef('tool1', 'server1', 'Server 1');\n\t\tconst ref2 = createMcpToolRef('tool2', 'server2', 'Server 2');\n\n\t\t// Set server1 to session\n\t\tconst actions1 = service.getPreConfirmActions(ref1);\n\t\tconst serverAction1 = actions1.find(a => a.label.includes('Server 1') && a.label.includes('Session'));\n\t\tassert.ok(serverAction1);\n\t\tawait serverAction1.select();\n\n\t\t// Set server2 to workspace\n\t\tconst actions2 = service.getPreConfirmActions(ref2);\n\t\tconst serverAction2 = actions2.find(a => a.label.includes('Server 2') && a.label.includes('Workspace'));\n\t\tassert.ok(serverAction2);\n\t\tawait serverAction2.select();\n\n\t\t// Verify they're independent\n\t\tconst result1 = service.getPreConfirmAction(ref1);\n\t\tconst result2 = service.getPreConfirmAction(ref2);\n\n\t\tassert.deepStrictEqual(result1, { type: ToolConfirmKind.LmServicePerTool, scope: 'session' });\n\t\tassert.deepStrictEqual(result2, { type: ToolConfirmKind.LmServicePerTool, scope: 'workspace' });\n\t});\n\n\ttest('actions return true when select is called', async () => {\n\t\tconst ref = createToolRef('testTool');\n\t\tconst actions = service.getPreConfirmActions(ref);\n\n\t\tfor (const action of actions) {\n\t\t\tconst result = await action.select();\n\t\t\tassert.strictEqual(result, true);\n\t\t}\n\t});\n\n\ttest('session confirmations are stored in memory only', async () => {\n\t\tconst ref = createToolRef('testTool');\n\t\tconst actions = service.getPreConfirmActions(ref);\n\t\tconst sessionAction = actions.find(a => a.label.includes('Session') && !a.label.includes('Server'));\n\n\t\tassert.ok(sessionAction);\n\t\tawait sessionAction.select();\n\n\t\t// Verify it's set\n\t\tconst result = service.getPreConfirmAction(ref);\n\t\tassert.deepStrictEqual(result, { type: ToolConfirmKind.LmServicePerTool, scope: 'session' });\n\n\t\t// Create new service instance (simulating restart)\n\t\tconst newService = store.add(instantiationService.createInstance(LanguageModelToolsConfirmationService));\n\n\t\t// Session confirmation should not persist\n\t\tconst newResult = newService.getPreConfirmAction(ref);\n\t\tassert.strictEqual(newResult, undefined);\n\t});\n});\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as assert from 'assert';\nimport { ensureNoDisposablesAreLeakedInTestSuite } from '../../../../../base/test/common/utils.js';\nimport { TestInstantiationService } from '../../../../../platform/instantiation/test/common/instantiationServiceMock.js';\nimport { IStorageService, InMemoryStorageService } from '../../../../../platform/storage/common/storage.js';\nimport { LanguageModelToolsConfirmationService } from '../../browser/languageModelToolsConfirmationService.js';\nimport { ToolConfirmKind } from '../../common/chatService.js';\nimport { ILanguageModelToolConfirmationActions, ILanguageModelToolConfirmationContribution, ILanguageModelToolConfirmationRef } from '../../common/languageModelToolsConfirmationService.js';\nimport { ToolDataSource } from '../../common/languageModelToolsService.js';\n\nsuite('LanguageModelToolsConfirmationService', () => {\n\tconst store = ensureNoDisposablesAreLeakedInTestSuite();\n\n\tlet service: LanguageModelToolsConfirmationService;\n\tlet instantiationService: TestInstantiationService;\n\n\tsetup(() => {\n\t\tinstantiationService = store.add(new TestInstantiationService());\n\t\tinstantiationService.stub(IStorageService, store.add(new InMemoryStorageService()));\n\n\t\tservice = store.add(instantiationService.createInstance(LanguageModelToolsConfirmationService));\n\t});\n\n\tfunction createToolRef(toolId: string, source: ToolDataSource = ToolDataSource.Internal, parameters: unknown = {}): ILanguageModelToolConfirmationRef {\n\t\treturn { toolId, source, parameters };\n\t}\n\n\tfunction createMcpToolRef(toolId: string, definitionId: string, serverLabel: string, parameters: unknown = {}): ILanguageModelToolConfirmationRef {\n\t\treturn {\n\t\t\ttoolId,\n\t\t\tsource: {\n\t\t\t\ttype: 'mcp',\n\t\t\t\tlabel: serverLabel,\n\t\t\t\tserverLabel,\n\t\t\t\tinstructions: undefined,\n\t\t\t\tcollectionId: 'testCollection',\n\t\t\t\tdefinitionId\n\t\t\t},\n\t\t\tparameters\n\t\t};\n\t}\n\n\ttest('getPreConfirmAction returns undefined by default', () => {\n\t\tconst ref = createToolRef('testTool');\n\t\tconst result = service.getPreConfirmAction(ref);\n\t\tassert.strictEqual(result, undefined);\n\t});\n\n\ttest('getPostConfirmAction returns undefined by default', () => {\n\t\tconst ref = createToolRef('testTool');\n\t\tconst result = service.getPostConfirmAction(ref);\n\t\tassert.strictEqual(result, undefined);\n\t});\n\n\ttest('getPreConfirmActions returns default tool-level actions', () => {\n\t\tconst ref = createToolRef('testTool');\n\t\tconst actions = service.getPreConfirmActions(ref);\n\n\t\tassert.ok(actions.length >= 3);\n\t\tassert.ok(actions.some(a => a.label.includes('Session')));\n\t\tassert.ok(actions.some(a => a.label.includes('Workspace')));\n\t\tassert.ok(actions.some(a => a.label.includes('Always Allow')));\n\t});\n\n\ttest('getPostConfirmActions returns default tool-level actions', () => {\n\t\tconst ref = createToolRef('testTool');\n\t\tconst actions = service.getPostConfirmActions(ref);\n\n\t\tassert.ok(actions.length >= 3);\n\t\tassert.ok(actions.some(a => a.label.includes('Session')));\n\t\tassert.ok(actions.some(a => a.label.includes('Workspace')));\n\t\tassert.ok(actions.some(a => a.label.includes('Always Allow')));\n\t});\n\n\ttest('getPreConfirmActions includes server-level actions for MCP tools', () => {\n\t\tconst ref = createMcpToolRef('mcpTool', 'serverId', 'Test Server');\n\t\tconst actions = service.getPreConfirmActions(ref);\n\n\t\tassert.ok(actions.some(a => a.label.includes('Test Server') && a.label.includes('Session')));\n\t\tassert.ok(actions.some(a => a.label.includes('Test Server') && a.label.includes('Workspace')));\n\t\tassert.ok(actions.some(a => a.label.includes('Test Server') && a.label.includes('Always Allow')));\n\t});\n\n\ttest('getPostConfirmActions includes server-level actions for MCP tools', () => {\n\t\tconst ref = createMcpToolRef('mcpTool', 'serverId', 'Test Server');\n\t\tconst actions = service.getPostConfirmActions(ref);\n\n\t\tassert.ok(actions.some(a => a.label.includes('Test Server') && a.label.includes('Session')));\n\t\tassert.ok(actions.some(a => a.label.includes('Test Server') && a.label.includes('Workspace')));\n\t\tassert.ok(actions.some(a => a.label.includes('Test Server') && a.label.includes('Always Allow')));\n\t});\n\n\ttest('pre-execution session confirmation works', async () => {\n\t\tconst ref = createToolRef('testTool');\n\t\tconst actions = service.getPreConfirmActions(ref);\n\t\tconst sessionAction = actions.find(a => a.label.includes('Session') && !a.label.includes('Server'));\n\n\t\tassert.ok(sessionAction);\n\t\tawait sessionAction.select();\n\n\t\tconst result = service.getPreConfirmAction(ref);\n\t\tassert.deepStrictEqual(result, { type: ToolConfirmKind.LmServicePerTool, scope: 'session' });\n\t});\n\n\ttest('pre-execution workspace confirmation works', async () => {\n\t\tconst ref = createToolRef('testTool');\n\t\tconst actions = service.getPreConfirmActions(ref);\n\t\tconst workspaceAction = actions.find(a => a.label.includes('Workspace') && !a.label.includes('Server'));\n\n\t\tassert.ok(workspaceAction);\n\t\tawait workspaceAction.select();\n\n\t\tconst result = service.getPreConfirmAction(ref);\n\t\tassert.deepStrictEqual(result, { type: ToolConfirmKind.LmServicePerTool, scope: 'workspace' });\n\t});\n\n\ttest('pre-execution profile confirmation works', async () => {\n\t\tconst ref = createToolRef('testTool');\n\t\tconst actions = service.getPreConfirmActions(ref);\n\t\tconst profileAction = actions.find(a => a.label.includes('Always Allow') && !a.label.includes('Server'));\n\n\t\tassert.ok(profileAction);\n\t\tawait profileAction.select();\n\n\t\tconst result = service.getPreConfirmAction(ref);\n\t\tassert.deepStrictEqual(result, { type: ToolConfirmKind.LmServicePerTool, scope: 'profile' });\n\t});\n\n\ttest('post-execution session confirmation works', async () => {\n\t\tconst ref = createToolRef('testTool');\n\t\tconst actions = service.getPostConfirmActions(ref);\n\t\tconst sessionAction = actions.find(a => a.label.includes('Session') && !a.label.includes('Server'));\n\n\t\tassert.ok(sessionAction);\n\t\tawait sessionAction.select();\n\n\t\tconst result = service.getPostConfirmAction(ref);\n\t\tassert.deepStrictEqual(result, { type: ToolConfirmKind.LmServicePerTool, scope: 'session' });\n\t});\n\n\ttest('post-execution workspace confirmation works', async () => {\n\t\tconst ref = createToolRef('testTool');\n\t\tconst actions = service.getPostConfirmActions(ref);\n\t\tconst workspaceAction = actions.find(a => a.label.includes('Workspace') && !a.label.includes('Server'));\n\n\t\tassert.ok(workspaceAction);\n\t\tawait workspaceAction.select();\n\n\t\tconst result = service.getPostConfirmAction(ref);\n\t\tassert.deepStrictEqual(result, { type: ToolConfirmKind.LmServicePerTool, scope: 'workspace' });\n\t});\n\n\ttest('post-execution profile confirmation works', async () => {\n\t\tconst ref = createToolRef('testTool');\n\t\tconst actions = service.getPostConfirmActions(ref);\n\t\tconst profileAction = actions.find(a => a.label.includes('Always Allow') && !a.label.includes('Server'));\n\n\t\tassert.ok(profileAction);\n\t\tawait profileAction.select();\n\n\t\tconst result = service.getPostConfirmAction(ref);\n\t\tassert.deepStrictEqual(result, { type: ToolConfirmKind.LmServicePerTool, scope: 'profile' });\n\t});\n\n\ttest('MCP server-level pre-execution session confirmation works', async () => {\n\t\tconst ref = createMcpToolRef('mcpTool', 'serverId', 'Test Server');\n\t\tconst actions = service.getPreConfirmActions(ref);\n\t\tconst serverAction = actions.find(a => a.label.includes('Test Server') && a.label.includes('Session'));\n\n\t\tassert.ok(serverAction);\n\t\tawait serverAction.select();\n\n\t\tconst result = service.getPreConfirmAction(ref);\n\t\tassert.deepStrictEqual(result, { type: ToolConfirmKind.LmServicePerTool, scope: 'session' });\n\t});\n\n\ttest('MCP server-level pre-execution workspace confirmation works', async () => {\n\t\tconst ref = createMcpToolRef('mcpTool', 'serverId', 'Test Server');\n\t\tconst actions = service.getPreConfirmActions(ref);\n\t\tconst serverAction = actions.find(a => a.label.includes('Test Server') && a.label.includes('Workspace'));\n\n\t\tassert.ok(serverAction);\n\t\tawait serverAction.select();\n\n\t\tconst result = service.getPreConfirmAction(ref);\n\t\tassert.deepStrictEqual(result, { type: ToolConfirmKind.LmServicePerTool, scope: 'workspace' });\n\t});\n\n\ttest('MCP server-level pre-execution profile confirmation works', async () => {\n\t\tconst ref = createMcpToolRef('mcpTool', 'serverId', 'Test Server');\n\t\tconst actions = service.getPreConfirmActions(ref);\n\t\tconst serverAction = actions.find(a => a.label.includes('Test Server') && a.label.includes('Always Allow'));\n\n\t\tassert.ok(serverAction);\n\t\tawait serverAction.select();\n\n\t\tconst result = service.getPreConfirmAction(ref);\n\t\tassert.deepStrictEqual(result, { type: ToolConfirmKind.LmServicePerTool, scope: 'profile' });\n\t});\n\n\ttest('MCP server-level post-execution session confirmation works', async () => {\n\t\tconst ref = createMcpToolRef('mcpTool', 'serverId', 'Test Server');\n\t\tconst actions = service.getPostConfirmActions(ref);\n\t\tconst serverAction = actions.find(a => a.label.includes('Test Server') && a.label.includes('Session'));\n\n\t\tassert.ok(serverAction);\n\t\tawait serverAction.select();\n\n\t\tconst result = service.getPostConfirmAction(ref);\n\t\tassert.deepStrictEqual(result, { type: ToolConfirmKind.LmServicePerTool, scope: 'session' });\n\t});\n\n\ttest('MCP server-level confirmation applies to all tools from that server', async () => {\n\t\tconst ref1 = createMcpToolRef('mcpTool1', 'serverId', 'Test Server');\n\t\tconst ref2 = createMcpToolRef('mcpTool2', 'serverId', 'Test Server');\n\n\t\tconst actions = service.getPreConfirmActions(ref1);\n\t\tconst serverAction = actions.find(a => a.label.includes('Test Server') && a.label.includes('Session'));\n\n\t\tassert.ok(serverAction);\n\t\tawait serverAction.select();\n\n\t\tconst result1 = service.getPreConfirmAction(ref1);\n\t\tconst result2 = service.getPreConfirmAction(ref2);\n\n\t\tassert.deepStrictEqual(result1, { type: ToolConfirmKind.LmServicePerTool, scope: 'session' });\n\t\tassert.deepStrictEqual(result2, { type: ToolConfirmKind.LmServicePerTool, scope: 'session' });\n\t});\n\n\ttest('tool-level confirmation takes precedence over server-level confirmation', async () => {\n\t\tconst ref = createMcpToolRef('mcpTool', 'serverId', 'Test Server');\n\n\t\t// Set server-level confirmation\n\t\tconst serverActions = service.getPreConfirmActions(ref);\n\t\tconst serverAction = serverActions.find(a => a.label.includes('Test Server') && a.label.includes('Session'));\n\t\tassert.ok(serverAction);\n\t\tawait serverAction.select();\n\n\t\t// Set tool-level confirmation to a different scope\n\t\tconst toolActions = service.getPreConfirmActions(ref);\n\t\tconst toolAction = toolActions.find(a => !a.label.includes('Test Server') && a.label.includes('Workspace'));\n\t\tassert.ok(toolAction);\n\t\tawait toolAction.select();\n\n\t\t// Tool-level should take precedence\n\t\tconst result = service.getPreConfirmAction(ref);\n\t\tassert.deepStrictEqual(result, { type: ToolConfirmKind.LmServicePerTool, scope: 'workspace' });\n\t});\n\n\ttest('registerConfirmationContribution allows custom pre-confirm actions', () => {\n\t\tconst contribution: ILanguageModelToolConfirmationContribution = {\n\t\t\tgetPreConfirmAction: (ref) => {\n\t\t\t\treturn { type: ToolConfirmKind.UserAction };\n\t\t\t}\n\t\t};\n\n\t\tstore.add(service.registerConfirmationContribution('customTool', contribution));\n\n\t\tconst ref = createToolRef('customTool');\n\t\tconst result = service.getPreConfirmAction(ref);\n\n\t\tassert.ok(result);\n\t\tassert.strictEqual(result.type, ToolConfirmKind.UserAction);\n\t});\n\n\ttest('registerConfirmationContribution allows custom post-confirm actions', () => {\n\t\tconst contribution: ILanguageModelToolConfirmationContribution = {\n\t\t\tgetPostConfirmAction: (ref) => {\n\t\t\t\treturn { type: ToolConfirmKind.UserAction };\n\t\t\t}\n\t\t};\n\n\t\tstore.add(service.registerConfirmationContribution('customTool', contribution));\n\n\t\tconst ref = createToolRef('customTool');\n\t\tconst result = service.getPostConfirmAction(ref);\n\n\t\tassert.ok(result);\n\t\tassert.strictEqual(result.type, ToolConfirmKind.UserAction);\n\t});\n\n\ttest('registerConfirmationContribution allows custom pre-confirm action list', () => {\n\t\tconst customActions: ILanguageModelToolConfirmationActions[] = [\n\t\t\t{\n\t\t\t\tlabel: 'Custom Action 1',\n\t\t\t\tselect: async () => true\n\t\t\t},\n\t\t\t{\n\t\t\t\tlabel: 'Custom Action 2',\n\t\t\t\tselect: async () => true\n\t\t\t}\n\t\t];\n\n\t\tconst contribution: ILanguageModelToolConfirmationContribution = {\n\t\t\tgetPreConfirmActions: (ref) => customActions\n\t\t};\n\n\t\tstore.add(service.registerConfirmationContribution('customTool', contribution));\n\n\t\tconst ref = createToolRef('customTool');\n\t\tconst actions = service.getPreConfirmActions(ref);\n\n\t\t// Should include both custom actions and default actions\n\t\tassert.ok(actions.some(a => a.label === 'Custom Action 1'));\n\t\tassert.ok(actions.some(a => a.label === 'Custom Action 2'));\n\t\tassert.ok(actions.some(a => a.label.includes('Session')));\n\t});\n\n\ttest('registerConfirmationContribution with canUseDefaultApprovals=false only shows custom actions', () => {\n\t\tconst customActions: ILanguageModelToolConfirmationActions[] = [\n\t\t\t{\n\t\t\t\tlabel: 'Custom Action Only',\n\t\t\t\tselect: async () => true\n\t\t\t}\n\t\t];\n\n\t\tconst contribution: ILanguageModelToolConfirmationContribution = {\n\t\t\tcanUseDefaultApprovals: false,\n\t\t\tgetPreConfirmActions: (ref) => customActions\n\t\t};\n\n\t\tstore.add(service.registerConfirmationContribution('customTool', contribution));\n\n\t\tconst ref = createToolRef('customTool');\n\t\tconst actions = service.getPreConfirmActions(ref);\n\n\t\tassert.strictEqual(actions.length, 1);\n\t\tassert.strictEqual(actions[0].label, 'Custom Action Only');\n\t});\n\n\ttest('contribution getPreConfirmAction takes precedence over default stores', () => {\n\t\tconst contribution: ILanguageModelToolConfirmationContribution = {\n\t\t\tgetPreConfirmAction: (ref) => {\n\t\t\t\treturn { type: ToolConfirmKind.UserAction };\n\t\t\t}\n\t\t};\n\n\t\tstore.add(service.registerConfirmationContribution('customTool', contribution));\n\n\t\t// Contribution should take precedence even without setting default\n\t\tconst ref = createToolRef('customTool');\n\t\tconst result = service.getPreConfirmAction(ref);\n\t\tassert.ok(result);\n\t\tassert.strictEqual(result.type, ToolConfirmKind.UserAction);\n\t});\n\n\ttest('contribution with canUseDefaultApprovals=false prevents default store checks', () => {\n\t\tconst contribution: ILanguageModelToolConfirmationContribution = {\n\t\t\tcanUseDefaultApprovals: false,\n\t\t\tgetPreConfirmAction: () => undefined\n\t\t};\n\n\t\tstore.add(service.registerConfirmationContribution('customTool', contribution));\n\n\t\tconst ref = createToolRef('customTool');\n\t\tconst actions = service.getPreConfirmActions(ref);\n\n\t\t// Should have no actions since canUseDefaultApprovals is false\n\t\tassert.strictEqual(actions.length, 0);\n\t});\n\n\ttest('resetToolAutoConfirmation clears all confirmations', async () => {\n\t\tconst ref1 = createToolRef('tool1');\n\t\tconst ref2 = createMcpToolRef('mcpTool', 'serverId', 'Test Server');\n\n\t\t// Set some confirmations\n\t\tconst actions1 = service.getPreConfirmActions(ref1);\n\t\tconst sessionAction1 = actions1.find(a => a.label.includes('Session') && !a.label.includes('Server'));\n\t\tassert.ok(sessionAction1);\n\t\tawait sessionAction1.select();\n\n\t\tconst actions2 = service.getPreConfirmActions(ref2);\n\t\tconst serverAction = actions2.find(a => a.label.includes('Test Server') && a.label.includes('Session'));\n\t\tassert.ok(serverAction);\n\t\tawait serverAction.select();\n\n\t\t// Verify they're set\n\t\tassert.ok(service.getPreConfirmAction(ref1));\n\t\tassert.ok(service.getPreConfirmAction(ref2));\n\n\t\t// Reset\n\t\tservice.resetToolAutoConfirmation();\n\n\t\t// Verify they're cleared\n\t\tassert.strictEqual(service.getPreConfirmAction(ref1), undefined);\n\t\tassert.strictEqual(service.getPreConfirmAction(ref2), undefined);\n\t});\n\n\ttest('resetToolAutoConfirmation calls contribution reset', () => {\n\t\tlet resetCalled = false;\n\t\tconst contribution: ILanguageModelToolConfirmationContribution = {\n\t\t\treset: () => {\n\t\t\t\tresetCalled = true;\n\t\t\t}\n\t\t};\n\n\t\tstore.add(service.registerConfirmationContribution('customTool', contribution));\n\n\t\tservice.resetToolAutoConfirmation();\n\n\t\tassert.strictEqual(resetCalled, true);\n\t});\n\n\ttest('disposing contribution registration removes it', () => {\n\t\tconst contribution: ILanguageModelToolConfirmationContribution = {\n\t\t\tgetPreConfirmAction: (ref) => {\n\t\t\t\treturn { type: ToolConfirmKind.UserAction };\n\t\t\t}\n\t\t};\n\n\t\tconst disposable = service.registerConfirmationContribution('customTool', contribution);\n\n\t\tconst ref = createToolRef('customTool');\n\t\tlet result = service.getPreConfirmAction(ref);\n\t\tassert.ok(result);\n\t\tassert.strictEqual(result.type, ToolConfirmKind.UserAction);\n\n\t\tdisposable.dispose();\n\n\t\tresult = service.getPreConfirmAction(ref);\n\t\tassert.strictEqual(result, undefined);\n\t});\n\n\ttest('different tools have independent confirmations', async () => {\n\t\tconst ref1 = createToolRef('tool1');\n\t\tconst ref2 = createToolRef('tool2');\n\n\t\t// Set session for tool1\n\t\tconst actions1 = service.getPreConfirmActions(ref1);\n\t\tconst sessionAction = actions1.find(a => a.label.includes('Session') && !a.label.includes('Server'));\n\t\tassert.ok(sessionAction);\n\t\tawait sessionAction.select();\n\n\t\t// Set workspace for tool2\n\t\tconst actions2 = service.getPreConfirmActions(ref2);\n\t\tconst workspaceAction = actions2.find(a => a.label.includes('Workspace') && !a.label.includes('Server'));\n\t\tassert.ok(workspaceAction);\n\t\tawait workspaceAction.select();\n\n\t\t// Verify they're independent\n\t\tconst result1 = service.getPreConfirmAction(ref1);\n\t\tconst result2 = service.getPreConfirmAction(ref2);\n\n\t\tassert.deepStrictEqual(result1, { type: ToolConfirmKind.LmServicePerTool, scope: 'session' });\n\t\tassert.deepStrictEqual(result2, { type: ToolConfirmKind.LmServicePerTool, scope: 'workspace' });\n\t});\n\n\ttest('pre and post execution confirmations are independent', async () => {\n\t\tconst ref = createToolRef('testTool');\n\n\t\t// Set pre-execution to session\n\t\tconst preActions = service.getPreConfirmActions(ref);\n\t\tconst preSessionAction = preActions.find(a => a.label.includes('Session') && !a.label.includes('Server'));\n\t\tassert.ok(preSessionAction);\n\t\tawait preSessionAction.select();\n\n\t\t// Set post-execution to workspace\n\t\tconst postActions = service.getPostConfirmActions(ref);\n\t\tconst postWorkspaceAction = postActions.find(a => a.label.includes('Workspace') && !a.label.includes('Server'));\n\t\tassert.ok(postWorkspaceAction);\n\t\tawait postWorkspaceAction.select();\n\n\t\t// Verify they're independent\n\t\tconst preResult = service.getPreConfirmAction(ref);\n\t\tconst postResult = service.getPostConfirmAction(ref);\n\n\t\tassert.deepStrictEqual(preResult, { type: ToolConfirmKind.LmServicePerTool, scope: 'session' });\n\t\tassert.deepStrictEqual(postResult, { type: ToolConfirmKind.LmServicePerTool, scope: 'workspace' });\n\t});\n\n\ttest('different MCP servers have independent confirmations', async () => {\n\t\tconst ref1 = createMcpToolRef('tool1', 'server1', 'Server 1');\n\t\tconst ref2 = createMcpToolRef('tool2', 'server2', 'Server 2');\n\n\t\t// Set server1 to session\n\t\tconst actions1 = service.getPreConfirmActions(ref1);\n\t\tconst serverAction1 = actions1.find(a => a.label.includes('Server 1') && a.label.includes('Session'));\n\t\tassert.ok(serverAction1);\n\t\tawait serverAction1.select();\n\n\t\t// Set server2 to workspace\n\t\tconst actions2 = service.getPreConfirmActions(ref2);\n\t\tconst serverAction2 = actions2.find(a => a.label.includes('Server 2') && a.label.includes('Workspace'));\n\t\tassert.ok(serverAction2);\n\t\tawait serverAction2.select();\n\n\t\t// Verify they're independent\n\t\tconst result1 = service.getPreConfirmAction(ref1);\n\t\tconst result2 = service.getPreConfirmAction(ref2);\n\n\t\tassert.deepStrictEqual(result1, { type: ToolConfirmKind.LmServicePerTool, scope: 'session' });\n\t\tassert.deepStrictEqual(result2, { type: ToolConfirmKind.LmServicePerTool, scope: 'workspace' });\n\t});\n\n\ttest('actions return true when select is called', async () => {\n\t\tconst ref = createToolRef('testTool');\n\t\tconst actions = service.getPreConfirmActions(ref);\n\n\t\tfor (const action of actions) {\n\t\t\tconst result = await action.select();\n\t\t\tassert.strictEqual(result, true);\n\t\t}\n\t});\n\n\ttest('session confirmations are stored in memory only', async () => {\n\t\tconst ref = createToolRef('testTool');\n\t\tconst actions = service.getPreConfirmActions(ref);\n\t\tconst sessionAction = actions.find(a => a.label.includes('Session') && !a.label.includes('Server'));\n\n\t\tassert.ok(sessionAction);\n\t\tawait sessionAction.select();\n\n\t\t// Verify it's set\n\t\tconst result = service.getPreConfirmAction(ref);\n\t\tassert.deepStrictEqual(result, { type: ToolConfirmKind.LmServicePerTool, scope: 'session' });\n\n\t\t// Create new service instance (simulating restart)\n\t\tconst newService = store.add(instantiationService.createInstance(LanguageModelToolsConfirmationService));\n\n\t\t// Session confirmation should not persist\n\t\tconst newResult = newService.getPreConfirmAction(ref);\n\t\tassert.strictEqual(newResult, undefined);\n\t});\n});\n"]}