{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/contrib/chat/test/common/chatModel.test.ts","vs/workbench/contrib/chat/test/common/chatModel.test.ts"],"names":[],"mappings":"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","file":"chatModel.test.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport assert from 'assert';\nimport * as sinon from 'sinon';\nimport { MarkdownString } from '../../../../../base/common/htmlContent.js';\nimport { observableValue } from '../../../../../base/common/observable.js';\nimport { URI } from '../../../../../base/common/uri.js';\nimport { assertSnapshot } from '../../../../../base/test/common/snapshot.js';\nimport { ensureNoDisposablesAreLeakedInTestSuite } from '../../../../../base/test/common/utils.js';\nimport { Range } from '../../../../../editor/common/core/range.js';\nimport { OffsetRange } from '../../../../../editor/common/core/ranges/offsetRange.js';\nimport { IConfigurationService } from '../../../../../platform/configuration/common/configuration.js';\nimport { TestConfigurationService } from '../../../../../platform/configuration/test/common/testConfigurationService.js';\nimport { IContextKeyService } from '../../../../../platform/contextkey/common/contextkey.js';\nimport { TestInstantiationService } from '../../../../../platform/instantiation/test/common/instantiationServiceMock.js';\nimport { MockContextKeyService } from '../../../../../platform/keybinding/test/common/mockKeybindingService.js';\nimport { ILogService, NullLogService } from '../../../../../platform/log/common/log.js';\nimport { IStorageService } from '../../../../../platform/storage/common/storage.js';\nimport { IExtensionService } from '../../../../services/extensions/common/extensions.js';\nimport { TestExtensionService, TestStorageService } from '../../../../test/common/workbenchTestServices.js';\nimport { ChatAgentService, IChatAgentService } from '../../common/chatAgents.js';\nimport { ChatModel, ISerializableChatData1, ISerializableChatData2, ISerializableChatData3, normalizeSerializableChatData, Response } from '../../common/chatModel.js';\nimport { ChatRequestTextPart } from '../../common/chatParserTypes.js';\nimport { IChatToolInvocation } from '../../common/chatService.js';\nimport { ChatAgentLocation } from '../../common/constants.js';\n\nsuite('ChatModel', () => {\n\tconst testDisposables = ensureNoDisposablesAreLeakedInTestSuite();\n\n\tlet instantiationService: TestInstantiationService;\n\n\tsetup(async () => {\n\t\tinstantiationService = testDisposables.add(new TestInstantiationService());\n\t\tinstantiationService.stub(IStorageService, testDisposables.add(new TestStorageService()));\n\t\tinstantiationService.stub(ILogService, new NullLogService());\n\t\tinstantiationService.stub(IExtensionService, new TestExtensionService());\n\t\tinstantiationService.stub(IContextKeyService, new MockContextKeyService());\n\t\tinstantiationService.stub(IChatAgentService, testDisposables.add(instantiationService.createInstance(ChatAgentService)));\n\t\tinstantiationService.stub(IConfigurationService, new TestConfigurationService());\n\t});\n\n\ttest('removeRequest', async () => {\n\t\tconst model = testDisposables.add(instantiationService.createInstance(ChatModel, undefined, { initialLocation: ChatAgentLocation.Chat, canUseTools: true }));\n\n\t\tconst text = 'hello';\n\t\tmodel.addRequest({ text, parts: [new ChatRequestTextPart(new OffsetRange(0, text.length), new Range(1, text.length, 1, text.length), text)] }, { variables: [] }, 0);\n\t\tconst requests = model.getRequests();\n\t\tassert.strictEqual(requests.length, 1);\n\n\t\tmodel.removeRequest(requests[0].id);\n\t\tassert.strictEqual(model.getRequests().length, 0);\n\t});\n\n\ttest('adoptRequest', async function () {\n\t\tconst model1 = testDisposables.add(instantiationService.createInstance(ChatModel, undefined, { initialLocation: ChatAgentLocation.EditorInline, canUseTools: true }));\n\t\tconst model2 = testDisposables.add(instantiationService.createInstance(ChatModel, undefined, { initialLocation: ChatAgentLocation.Chat, canUseTools: true }));\n\n\t\tconst text = 'hello';\n\t\tconst request1 = model1.addRequest({ text, parts: [new ChatRequestTextPart(new OffsetRange(0, text.length), new Range(1, text.length, 1, text.length), text)] }, { variables: [] }, 0);\n\n\t\tassert.strictEqual(model1.getRequests().length, 1);\n\t\tassert.strictEqual(model2.getRequests().length, 0);\n\t\tassert.ok(request1.session === model1);\n\t\tassert.ok(request1.response?.session === model1);\n\n\t\tmodel2.adoptRequest(request1);\n\n\t\tassert.strictEqual(model1.getRequests().length, 0);\n\t\tassert.strictEqual(model2.getRequests().length, 1);\n\t\tassert.ok(request1.session === model2);\n\t\tassert.ok(request1.response?.session === model2);\n\n\t\tmodel2.acceptResponseProgress(request1, { content: new MarkdownString('Hello'), kind: 'markdownContent' });\n\n\t\tassert.strictEqual(request1.response.response.toString(), 'Hello');\n\t});\n\n\ttest('addCompleteRequest', async function () {\n\t\tconst model1 = testDisposables.add(instantiationService.createInstance(ChatModel, undefined, { initialLocation: ChatAgentLocation.Chat, canUseTools: true }));\n\n\t\tconst text = 'hello';\n\t\tconst request1 = model1.addRequest({ text, parts: [new ChatRequestTextPart(new OffsetRange(0, text.length), new Range(1, text.length, 1, text.length), text)] }, { variables: [] }, 0, undefined, undefined, undefined, undefined, undefined, undefined, true);\n\n\t\tassert.strictEqual(request1.isCompleteAddedRequest, true);\n\t\tassert.strictEqual(request1.response!.isCompleteAddedRequest, true);\n\t\tassert.strictEqual(request1.shouldBeRemovedOnSend, undefined);\n\t\tassert.strictEqual(request1.response!.shouldBeRemovedOnSend, undefined);\n\t});\n});\n\nsuite('Response', () => {\n\tconst store = ensureNoDisposablesAreLeakedInTestSuite();\n\n\ttest('mergeable markdown', async () => {\n\t\tconst response = store.add(new Response([]));\n\t\tresponse.updateContent({ content: new MarkdownString('markdown1'), kind: 'markdownContent' });\n\t\tresponse.updateContent({ content: new MarkdownString('markdown2'), kind: 'markdownContent' });\n\t\tawait assertSnapshot(response.value);\n\n\t\tassert.strictEqual(response.toString(), 'markdown1markdown2');\n\t});\n\n\ttest('not mergeable markdown', async () => {\n\t\tconst response = store.add(new Response([]));\n\t\tconst md1 = new MarkdownString('markdown1');\n\t\tmd1.supportHtml = true;\n\t\tresponse.updateContent({ content: md1, kind: 'markdownContent' });\n\t\tresponse.updateContent({ content: new MarkdownString('markdown2'), kind: 'markdownContent' });\n\t\tawait assertSnapshot(response.value);\n\t});\n\n\ttest('inline reference', async () => {\n\t\tconst response = store.add(new Response([]));\n\t\tresponse.updateContent({ content: new MarkdownString('text before '), kind: 'markdownContent' });\n\t\tresponse.updateContent({ inlineReference: URI.parse('https://microsoft.com/'), kind: 'inlineReference' });\n\t\tresponse.updateContent({ content: new MarkdownString(' text after'), kind: 'markdownContent' });\n\t\tawait assertSnapshot(response.value);\n\n\t\tassert.strictEqual(response.toString(), 'text before https://microsoft.com/ text after');\n\n\t});\n\n\ttest('consolidated edit summary', async () => {\n\t\tconst response = store.add(new Response([]));\n\t\tresponse.updateContent({ content: new MarkdownString('Some content before edits'), kind: 'markdownContent' });\n\t\tresponse.updateContent({ kind: 'textEditGroup', uri: URI.parse('file:///file1.ts'), edits: [], state: undefined, done: true });\n\t\tresponse.updateContent({ kind: 'textEditGroup', uri: URI.parse('file:///file2.ts'), edits: [], state: undefined, done: true });\n\t\tresponse.updateContent({ content: new MarkdownString('Some content after edits'), kind: 'markdownContent' });\n\n\t\t// Should have single \"Made changes.\" at the end instead of multiple entries\n\t\tconst responseString = response.toString();\n\t\tconst madeChangesCount = (responseString.match(/Made changes\\./g) || []).length;\n\t\tassert.strictEqual(madeChangesCount, 1, 'Should have exactly one \"Made changes.\" message');\n\t\tassert.ok(responseString.includes('Some content before edits'), 'Should include content before edits');\n\t\tassert.ok(responseString.includes('Some content after edits'), 'Should include content after edits');\n\t\tassert.ok(responseString.endsWith('Made changes.'), 'Should end with \"Made changes.\"');\n\t});\n\n\ttest('no edit summary when no edits', async () => {\n\t\tconst response = store.add(new Response([]));\n\t\tresponse.updateContent({ content: new MarkdownString('Some content'), kind: 'markdownContent' });\n\t\tresponse.updateContent({ content: new MarkdownString('More content'), kind: 'markdownContent' });\n\n\t\t// Should not have \"Made changes.\" when there are no edit groups\n\t\tconst responseString = response.toString();\n\t\tassert.ok(!responseString.includes('Made changes.'), 'Should not include \"Made changes.\" when no edits present');\n\t\tassert.strictEqual(responseString, 'Some contentMore content');\n\t});\n\n\ttest('consolidated edit summary with clear operation', async () => {\n\t\tconst response = store.add(new Response([]));\n\t\tresponse.updateContent({ content: new MarkdownString('Initial content'), kind: 'markdownContent' });\n\t\tresponse.updateContent({ kind: 'textEditGroup', uri: URI.parse('file:///file1.ts'), edits: [], state: undefined, done: true });\n\t\tresponse.updateContent({ kind: 'clearToPreviousToolInvocation', reason: 1 });\n\t\tresponse.updateContent({ content: new MarkdownString('Content after clear'), kind: 'markdownContent' });\n\t\tresponse.updateContent({ kind: 'textEditGroup', uri: URI.parse('file:///file2.ts'), edits: [], state: undefined, done: true });\n\n\t\t// Should only show \"Made changes.\" for edits after the clear operation\n\t\tconst responseString = response.toString();\n\t\tconst madeChangesCount = (responseString.match(/Made changes\\./g) || []).length;\n\t\tassert.strictEqual(madeChangesCount, 1, 'Should have exactly one \"Made changes.\" message after clear');\n\t\tassert.ok(responseString.includes('Content after clear'), 'Should include content after clear');\n\t\tassert.ok(!responseString.includes('Initial content'), 'Should not include content before clear');\n\t\tassert.ok(responseString.endsWith('Made changes.'), 'Should end with \"Made changes.\"');\n\t});\n});\n\nsuite('normalizeSerializableChatData', () => {\n\tensureNoDisposablesAreLeakedInTestSuite();\n\n\ttest('v1', () => {\n\t\tconst v1Data: ISerializableChatData1 = {\n\t\t\tcreationDate: Date.now(),\n\t\t\tinitialLocation: undefined,\n\t\t\tisImported: false,\n\t\t\trequests: [],\n\t\t\tresponderAvatarIconUri: undefined,\n\t\t\tresponderUsername: 'bot',\n\t\t\tsessionId: 'session1',\n\t\t};\n\n\t\tconst newData = normalizeSerializableChatData(v1Data);\n\t\tassert.strictEqual(newData.creationDate, v1Data.creationDate);\n\t\tassert.strictEqual(newData.lastMessageDate, v1Data.creationDate);\n\t\tassert.strictEqual(newData.version, 3);\n\t\tassert.ok('customTitle' in newData);\n\t});\n\n\ttest('v2', () => {\n\t\tconst v2Data: ISerializableChatData2 = {\n\t\t\tversion: 2,\n\t\t\tcreationDate: 100,\n\t\t\tlastMessageDate: Date.now(),\n\t\t\tinitialLocation: undefined,\n\t\t\tisImported: false,\n\t\t\trequests: [],\n\t\t\tresponderAvatarIconUri: undefined,\n\t\t\tresponderUsername: 'bot',\n\t\t\tsessionId: 'session1',\n\t\t\tcomputedTitle: 'computed title'\n\t\t};\n\n\t\tconst newData = normalizeSerializableChatData(v2Data);\n\t\tassert.strictEqual(newData.version, 3);\n\t\tassert.strictEqual(newData.creationDate, v2Data.creationDate);\n\t\tassert.strictEqual(newData.lastMessageDate, v2Data.lastMessageDate);\n\t\tassert.strictEqual(newData.customTitle, v2Data.computedTitle);\n\t});\n\n\ttest('old bad data', () => {\n\t\tconst v1Data: ISerializableChatData1 = {\n\t\t\t// Testing the scenario where these are missing\n\t\t\tsessionId: undefined!,\n\t\t\tcreationDate: undefined!,\n\n\t\t\tinitialLocation: undefined,\n\t\t\tisImported: false,\n\t\t\trequests: [],\n\t\t\tresponderAvatarIconUri: undefined,\n\t\t\tresponderUsername: 'bot',\n\t\t};\n\n\t\tconst newData = normalizeSerializableChatData(v1Data);\n\t\tassert.strictEqual(newData.version, 3);\n\t\tassert.ok(newData.creationDate > 0);\n\t\tassert.ok(newData.lastMessageDate > 0);\n\t\tassert.ok(newData.sessionId);\n\t});\n\n\ttest('v3 with bug', () => {\n\t\tconst v3Data: ISerializableChatData3 = {\n\t\t\t// Test case where old data was wrongly normalized and these fields were missing\n\t\t\tcreationDate: undefined!,\n\t\t\tlastMessageDate: undefined!,\n\n\t\t\tversion: 3,\n\t\t\tinitialLocation: undefined,\n\t\t\tisImported: false,\n\t\t\trequests: [],\n\t\t\tresponderAvatarIconUri: undefined,\n\t\t\tresponderUsername: 'bot',\n\t\t\tsessionId: 'session1',\n\t\t\tcustomTitle: 'computed title'\n\t\t};\n\n\t\tconst newData = normalizeSerializableChatData(v3Data);\n\t\tassert.strictEqual(newData.version, 3);\n\t\tassert.ok(newData.creationDate > 0);\n\t\tassert.ok(newData.lastMessageDate > 0);\n\t\tassert.ok(newData.sessionId);\n\t});\n});\n\nsuite('ChatResponseModel', () => {\n\tconst testDisposables = ensureNoDisposablesAreLeakedInTestSuite();\n\n\tlet instantiationService: TestInstantiationService;\n\n\tsetup(async () => {\n\t\tinstantiationService = testDisposables.add(new TestInstantiationService());\n\t\tinstantiationService.stub(IStorageService, testDisposables.add(new TestStorageService()));\n\t\tinstantiationService.stub(ILogService, new NullLogService());\n\t\tinstantiationService.stub(IExtensionService, new TestExtensionService());\n\t\tinstantiationService.stub(IContextKeyService, new MockContextKeyService());\n\t\tinstantiationService.stub(IChatAgentService, testDisposables.add(instantiationService.createInstance(ChatAgentService)));\n\t\tinstantiationService.stub(IConfigurationService, new TestConfigurationService());\n\t});\n\n\ttest('timestamp and confirmationAdjustedTimestamp', async () => {\n\t\tconst clock = sinon.useFakeTimers();\n\t\ttry {\n\t\t\tconst model = testDisposables.add(instantiationService.createInstance(ChatModel, undefined, { initialLocation: ChatAgentLocation.Chat, canUseTools: true }));\n\t\t\tconst start = Date.now();\n\n\t\t\tconst text = 'hello';\n\t\t\tconst request = model.addRequest({ text, parts: [new ChatRequestTextPart(new OffsetRange(0, text.length), new Range(1, text.length, 1, text.length), text)] }, { variables: [] }, 0);\n\t\t\tconst response = request.response!;\n\n\t\t\tassert.strictEqual(response.timestamp, start);\n\t\t\tassert.strictEqual(response.confirmationAdjustedTimestamp.get(), start);\n\n\t\t\t// Advance time, no pending confirmation\n\t\t\tclock.tick(1000);\n\t\t\tassert.strictEqual(response.confirmationAdjustedTimestamp.get(), start);\n\n\t\t\t// Add pending confirmation via tool invocation\n\t\t\tconst toolState = observableValue<any>('state', { type: 0 /* IChatToolInvocation.StateKind.WaitingForConfirmation */ });\n\t\t\tconst toolInvocation = {\n\t\t\t\tkind: 'toolInvocation',\n\t\t\t\tinvocationMessage: 'calling tool',\n\t\t\t\tstate: toolState\n\t\t\t} as Partial<IChatToolInvocation> as IChatToolInvocation;\n\n\t\t\tmodel.acceptResponseProgress(request, toolInvocation);\n\n\t\t\t// Advance time while pending\n\t\t\tclock.tick(2000);\n\t\t\t// Timestamp should still be start (it includes the wait time while waiting)\n\t\t\tassert.strictEqual(response.confirmationAdjustedTimestamp.get(), start);\n\n\t\t\t// Resolve confirmation\n\t\t\ttoolState.set({ type: 3 /* IChatToolInvocation.StateKind.Completed */ }, undefined);\n\n\t\t\t// Now adjusted timestamp should reflect the wait time\n\t\t\t// The wait time was 2000ms.\n\t\t\t// confirmationAdjustedTimestamp = start + waitTime = start + 2000\n\t\t\tassert.strictEqual(response.confirmationAdjustedTimestamp.get(), start + 2000);\n\n\t\t\t// Advance time again\n\t\t\tclock.tick(1000);\n\t\t\tassert.strictEqual(response.confirmationAdjustedTimestamp.get(), start + 2000);\n\n\t\t} finally {\n\t\t\tclock.restore();\n\t\t}\n\t});\n});\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport assert from 'assert';\nimport * as sinon from 'sinon';\nimport { MarkdownString } from '../../../../../base/common/htmlContent.js';\nimport { observableValue } from '../../../../../base/common/observable.js';\nimport { URI } from '../../../../../base/common/uri.js';\nimport { assertSnapshot } from '../../../../../base/test/common/snapshot.js';\nimport { ensureNoDisposablesAreLeakedInTestSuite } from '../../../../../base/test/common/utils.js';\nimport { Range } from '../../../../../editor/common/core/range.js';\nimport { OffsetRange } from '../../../../../editor/common/core/ranges/offsetRange.js';\nimport { IConfigurationService } from '../../../../../platform/configuration/common/configuration.js';\nimport { TestConfigurationService } from '../../../../../platform/configuration/test/common/testConfigurationService.js';\nimport { IContextKeyService } from '../../../../../platform/contextkey/common/contextkey.js';\nimport { TestInstantiationService } from '../../../../../platform/instantiation/test/common/instantiationServiceMock.js';\nimport { MockContextKeyService } from '../../../../../platform/keybinding/test/common/mockKeybindingService.js';\nimport { ILogService, NullLogService } from '../../../../../platform/log/common/log.js';\nimport { IStorageService } from '../../../../../platform/storage/common/storage.js';\nimport { IExtensionService } from '../../../../services/extensions/common/extensions.js';\nimport { TestExtensionService, TestStorageService } from '../../../../test/common/workbenchTestServices.js';\nimport { ChatAgentService, IChatAgentService } from '../../common/chatAgents.js';\nimport { ChatModel, ISerializableChatData1, ISerializableChatData2, ISerializableChatData3, normalizeSerializableChatData, Response } from '../../common/chatModel.js';\nimport { ChatRequestTextPart } from '../../common/chatParserTypes.js';\nimport { IChatToolInvocation } from '../../common/chatService.js';\nimport { ChatAgentLocation } from '../../common/constants.js';\n\nsuite('ChatModel', () => {\n\tconst testDisposables = ensureNoDisposablesAreLeakedInTestSuite();\n\n\tlet instantiationService: TestInstantiationService;\n\n\tsetup(async () => {\n\t\tinstantiationService = testDisposables.add(new TestInstantiationService());\n\t\tinstantiationService.stub(IStorageService, testDisposables.add(new TestStorageService()));\n\t\tinstantiationService.stub(ILogService, new NullLogService());\n\t\tinstantiationService.stub(IExtensionService, new TestExtensionService());\n\t\tinstantiationService.stub(IContextKeyService, new MockContextKeyService());\n\t\tinstantiationService.stub(IChatAgentService, testDisposables.add(instantiationService.createInstance(ChatAgentService)));\n\t\tinstantiationService.stub(IConfigurationService, new TestConfigurationService());\n\t});\n\n\ttest('removeRequest', async () => {\n\t\tconst model = testDisposables.add(instantiationService.createInstance(ChatModel, undefined, { initialLocation: ChatAgentLocation.Chat, canUseTools: true }));\n\n\t\tconst text = 'hello';\n\t\tmodel.addRequest({ text, parts: [new ChatRequestTextPart(new OffsetRange(0, text.length), new Range(1, text.length, 1, text.length), text)] }, { variables: [] }, 0);\n\t\tconst requests = model.getRequests();\n\t\tassert.strictEqual(requests.length, 1);\n\n\t\tmodel.removeRequest(requests[0].id);\n\t\tassert.strictEqual(model.getRequests().length, 0);\n\t});\n\n\ttest('adoptRequest', async function () {\n\t\tconst model1 = testDisposables.add(instantiationService.createInstance(ChatModel, undefined, { initialLocation: ChatAgentLocation.EditorInline, canUseTools: true }));\n\t\tconst model2 = testDisposables.add(instantiationService.createInstance(ChatModel, undefined, { initialLocation: ChatAgentLocation.Chat, canUseTools: true }));\n\n\t\tconst text = 'hello';\n\t\tconst request1 = model1.addRequest({ text, parts: [new ChatRequestTextPart(new OffsetRange(0, text.length), new Range(1, text.length, 1, text.length), text)] }, { variables: [] }, 0);\n\n\t\tassert.strictEqual(model1.getRequests().length, 1);\n\t\tassert.strictEqual(model2.getRequests().length, 0);\n\t\tassert.ok(request1.session === model1);\n\t\tassert.ok(request1.response?.session === model1);\n\n\t\tmodel2.adoptRequest(request1);\n\n\t\tassert.strictEqual(model1.getRequests().length, 0);\n\t\tassert.strictEqual(model2.getRequests().length, 1);\n\t\tassert.ok(request1.session === model2);\n\t\tassert.ok(request1.response?.session === model2);\n\n\t\tmodel2.acceptResponseProgress(request1, { content: new MarkdownString('Hello'), kind: 'markdownContent' });\n\n\t\tassert.strictEqual(request1.response.response.toString(), 'Hello');\n\t});\n\n\ttest('addCompleteRequest', async function () {\n\t\tconst model1 = testDisposables.add(instantiationService.createInstance(ChatModel, undefined, { initialLocation: ChatAgentLocation.Chat, canUseTools: true }));\n\n\t\tconst text = 'hello';\n\t\tconst request1 = model1.addRequest({ text, parts: [new ChatRequestTextPart(new OffsetRange(0, text.length), new Range(1, text.length, 1, text.length), text)] }, { variables: [] }, 0, undefined, undefined, undefined, undefined, undefined, undefined, true);\n\n\t\tassert.strictEqual(request1.isCompleteAddedRequest, true);\n\t\tassert.strictEqual(request1.response!.isCompleteAddedRequest, true);\n\t\tassert.strictEqual(request1.shouldBeRemovedOnSend, undefined);\n\t\tassert.strictEqual(request1.response!.shouldBeRemovedOnSend, undefined);\n\t});\n});\n\nsuite('Response', () => {\n\tconst store = ensureNoDisposablesAreLeakedInTestSuite();\n\n\ttest('mergeable markdown', async () => {\n\t\tconst response = store.add(new Response([]));\n\t\tresponse.updateContent({ content: new MarkdownString('markdown1'), kind: 'markdownContent' });\n\t\tresponse.updateContent({ content: new MarkdownString('markdown2'), kind: 'markdownContent' });\n\t\tawait assertSnapshot(response.value);\n\n\t\tassert.strictEqual(response.toString(), 'markdown1markdown2');\n\t});\n\n\ttest('not mergeable markdown', async () => {\n\t\tconst response = store.add(new Response([]));\n\t\tconst md1 = new MarkdownString('markdown1');\n\t\tmd1.supportHtml = true;\n\t\tresponse.updateContent({ content: md1, kind: 'markdownContent' });\n\t\tresponse.updateContent({ content: new MarkdownString('markdown2'), kind: 'markdownContent' });\n\t\tawait assertSnapshot(response.value);\n\t});\n\n\ttest('inline reference', async () => {\n\t\tconst response = store.add(new Response([]));\n\t\tresponse.updateContent({ content: new MarkdownString('text before '), kind: 'markdownContent' });\n\t\tresponse.updateContent({ inlineReference: URI.parse('https://microsoft.com/'), kind: 'inlineReference' });\n\t\tresponse.updateContent({ content: new MarkdownString(' text after'), kind: 'markdownContent' });\n\t\tawait assertSnapshot(response.value);\n\n\t\tassert.strictEqual(response.toString(), 'text before https://microsoft.com/ text after');\n\n\t});\n\n\ttest('consolidated edit summary', async () => {\n\t\tconst response = store.add(new Response([]));\n\t\tresponse.updateContent({ content: new MarkdownString('Some content before edits'), kind: 'markdownContent' });\n\t\tresponse.updateContent({ kind: 'textEditGroup', uri: URI.parse('file:///file1.ts'), edits: [], state: undefined, done: true });\n\t\tresponse.updateContent({ kind: 'textEditGroup', uri: URI.parse('file:///file2.ts'), edits: [], state: undefined, done: true });\n\t\tresponse.updateContent({ content: new MarkdownString('Some content after edits'), kind: 'markdownContent' });\n\n\t\t// Should have single \"Made changes.\" at the end instead of multiple entries\n\t\tconst responseString = response.toString();\n\t\tconst madeChangesCount = (responseString.match(/Made changes\\./g) || []).length;\n\t\tassert.strictEqual(madeChangesCount, 1, 'Should have exactly one \"Made changes.\" message');\n\t\tassert.ok(responseString.includes('Some content before edits'), 'Should include content before edits');\n\t\tassert.ok(responseString.includes('Some content after edits'), 'Should include content after edits');\n\t\tassert.ok(responseString.endsWith('Made changes.'), 'Should end with \"Made changes.\"');\n\t});\n\n\ttest('no edit summary when no edits', async () => {\n\t\tconst response = store.add(new Response([]));\n\t\tresponse.updateContent({ content: new MarkdownString('Some content'), kind: 'markdownContent' });\n\t\tresponse.updateContent({ content: new MarkdownString('More content'), kind: 'markdownContent' });\n\n\t\t// Should not have \"Made changes.\" when there are no edit groups\n\t\tconst responseString = response.toString();\n\t\tassert.ok(!responseString.includes('Made changes.'), 'Should not include \"Made changes.\" when no edits present');\n\t\tassert.strictEqual(responseString, 'Some contentMore content');\n\t});\n\n\ttest('consolidated edit summary with clear operation', async () => {\n\t\tconst response = store.add(new Response([]));\n\t\tresponse.updateContent({ content: new MarkdownString('Initial content'), kind: 'markdownContent' });\n\t\tresponse.updateContent({ kind: 'textEditGroup', uri: URI.parse('file:///file1.ts'), edits: [], state: undefined, done: true });\n\t\tresponse.updateContent({ kind: 'clearToPreviousToolInvocation', reason: 1 });\n\t\tresponse.updateContent({ content: new MarkdownString('Content after clear'), kind: 'markdownContent' });\n\t\tresponse.updateContent({ kind: 'textEditGroup', uri: URI.parse('file:///file2.ts'), edits: [], state: undefined, done: true });\n\n\t\t// Should only show \"Made changes.\" for edits after the clear operation\n\t\tconst responseString = response.toString();\n\t\tconst madeChangesCount = (responseString.match(/Made changes\\./g) || []).length;\n\t\tassert.strictEqual(madeChangesCount, 1, 'Should have exactly one \"Made changes.\" message after clear');\n\t\tassert.ok(responseString.includes('Content after clear'), 'Should include content after clear');\n\t\tassert.ok(!responseString.includes('Initial content'), 'Should not include content before clear');\n\t\tassert.ok(responseString.endsWith('Made changes.'), 'Should end with \"Made changes.\"');\n\t});\n});\n\nsuite('normalizeSerializableChatData', () => {\n\tensureNoDisposablesAreLeakedInTestSuite();\n\n\ttest('v1', () => {\n\t\tconst v1Data: ISerializableChatData1 = {\n\t\t\tcreationDate: Date.now(),\n\t\t\tinitialLocation: undefined,\n\t\t\tisImported: false,\n\t\t\trequests: [],\n\t\t\tresponderAvatarIconUri: undefined,\n\t\t\tresponderUsername: 'bot',\n\t\t\tsessionId: 'session1',\n\t\t};\n\n\t\tconst newData = normalizeSerializableChatData(v1Data);\n\t\tassert.strictEqual(newData.creationDate, v1Data.creationDate);\n\t\tassert.strictEqual(newData.lastMessageDate, v1Data.creationDate);\n\t\tassert.strictEqual(newData.version, 3);\n\t\tassert.ok('customTitle' in newData);\n\t});\n\n\ttest('v2', () => {\n\t\tconst v2Data: ISerializableChatData2 = {\n\t\t\tversion: 2,\n\t\t\tcreationDate: 100,\n\t\t\tlastMessageDate: Date.now(),\n\t\t\tinitialLocation: undefined,\n\t\t\tisImported: false,\n\t\t\trequests: [],\n\t\t\tresponderAvatarIconUri: undefined,\n\t\t\tresponderUsername: 'bot',\n\t\t\tsessionId: 'session1',\n\t\t\tcomputedTitle: 'computed title'\n\t\t};\n\n\t\tconst newData = normalizeSerializableChatData(v2Data);\n\t\tassert.strictEqual(newData.version, 3);\n\t\tassert.strictEqual(newData.creationDate, v2Data.creationDate);\n\t\tassert.strictEqual(newData.lastMessageDate, v2Data.lastMessageDate);\n\t\tassert.strictEqual(newData.customTitle, v2Data.computedTitle);\n\t});\n\n\ttest('old bad data', () => {\n\t\tconst v1Data: ISerializableChatData1 = {\n\t\t\t// Testing the scenario where these are missing\n\t\t\tsessionId: undefined!,\n\t\t\tcreationDate: undefined!,\n\n\t\t\tinitialLocation: undefined,\n\t\t\tisImported: false,\n\t\t\trequests: [],\n\t\t\tresponderAvatarIconUri: undefined,\n\t\t\tresponderUsername: 'bot',\n\t\t};\n\n\t\tconst newData = normalizeSerializableChatData(v1Data);\n\t\tassert.strictEqual(newData.version, 3);\n\t\tassert.ok(newData.creationDate > 0);\n\t\tassert.ok(newData.lastMessageDate > 0);\n\t\tassert.ok(newData.sessionId);\n\t});\n\n\ttest('v3 with bug', () => {\n\t\tconst v3Data: ISerializableChatData3 = {\n\t\t\t// Test case where old data was wrongly normalized and these fields were missing\n\t\t\tcreationDate: undefined!,\n\t\t\tlastMessageDate: undefined!,\n\n\t\t\tversion: 3,\n\t\t\tinitialLocation: undefined,\n\t\t\tisImported: false,\n\t\t\trequests: [],\n\t\t\tresponderAvatarIconUri: undefined,\n\t\t\tresponderUsername: 'bot',\n\t\t\tsessionId: 'session1',\n\t\t\tcustomTitle: 'computed title'\n\t\t};\n\n\t\tconst newData = normalizeSerializableChatData(v3Data);\n\t\tassert.strictEqual(newData.version, 3);\n\t\tassert.ok(newData.creationDate > 0);\n\t\tassert.ok(newData.lastMessageDate > 0);\n\t\tassert.ok(newData.sessionId);\n\t});\n});\n\nsuite('ChatResponseModel', () => {\n\tconst testDisposables = ensureNoDisposablesAreLeakedInTestSuite();\n\n\tlet instantiationService: TestInstantiationService;\n\n\tsetup(async () => {\n\t\tinstantiationService = testDisposables.add(new TestInstantiationService());\n\t\tinstantiationService.stub(IStorageService, testDisposables.add(new TestStorageService()));\n\t\tinstantiationService.stub(ILogService, new NullLogService());\n\t\tinstantiationService.stub(IExtensionService, new TestExtensionService());\n\t\tinstantiationService.stub(IContextKeyService, new MockContextKeyService());\n\t\tinstantiationService.stub(IChatAgentService, testDisposables.add(instantiationService.createInstance(ChatAgentService)));\n\t\tinstantiationService.stub(IConfigurationService, new TestConfigurationService());\n\t});\n\n\ttest('timestamp and confirmationAdjustedTimestamp', async () => {\n\t\tconst clock = sinon.useFakeTimers();\n\t\ttry {\n\t\t\tconst model = testDisposables.add(instantiationService.createInstance(ChatModel, undefined, { initialLocation: ChatAgentLocation.Chat, canUseTools: true }));\n\t\t\tconst start = Date.now();\n\n\t\t\tconst text = 'hello';\n\t\t\tconst request = model.addRequest({ text, parts: [new ChatRequestTextPart(new OffsetRange(0, text.length), new Range(1, text.length, 1, text.length), text)] }, { variables: [] }, 0);\n\t\t\tconst response = request.response!;\n\n\t\t\tassert.strictEqual(response.timestamp, start);\n\t\t\tassert.strictEqual(response.confirmationAdjustedTimestamp.get(), start);\n\n\t\t\t// Advance time, no pending confirmation\n\t\t\tclock.tick(1000);\n\t\t\tassert.strictEqual(response.confirmationAdjustedTimestamp.get(), start);\n\n\t\t\t// Add pending confirmation via tool invocation\n\t\t\tconst toolState = observableValue<any>('state', { type: 0 /* IChatToolInvocation.StateKind.WaitingForConfirmation */ });\n\t\t\tconst toolInvocation = {\n\t\t\t\tkind: 'toolInvocation',\n\t\t\t\tinvocationMessage: 'calling tool',\n\t\t\t\tstate: toolState\n\t\t\t} as Partial<IChatToolInvocation> as IChatToolInvocation;\n\n\t\t\tmodel.acceptResponseProgress(request, toolInvocation);\n\n\t\t\t// Advance time while pending\n\t\t\tclock.tick(2000);\n\t\t\t// Timestamp should still be start (it includes the wait time while waiting)\n\t\t\tassert.strictEqual(response.confirmationAdjustedTimestamp.get(), start);\n\n\t\t\t// Resolve confirmation\n\t\t\ttoolState.set({ type: 3 /* IChatToolInvocation.StateKind.Completed */ }, undefined);\n\n\t\t\t// Now adjusted timestamp should reflect the wait time\n\t\t\t// The wait time was 2000ms.\n\t\t\t// confirmationAdjustedTimestamp = start + waitTime = start + 2000\n\t\t\tassert.strictEqual(response.confirmationAdjustedTimestamp.get(), start + 2000);\n\n\t\t\t// Advance time again\n\t\t\tclock.tick(1000);\n\t\t\tassert.strictEqual(response.confirmationAdjustedTimestamp.get(), start + 2000);\n\n\t\t} finally {\n\t\t\tclock.restore();\n\t\t}\n\t});\n});\n"]}