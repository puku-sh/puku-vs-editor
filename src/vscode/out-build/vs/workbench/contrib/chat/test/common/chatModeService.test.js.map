{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/contrib/chat/test/common/chatModeService.test.ts","vs/workbench/contrib/chat/test/common/chatModeService.test.ts"],"names":[],"mappings":"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","file":"chatModeService.test.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport assert from 'assert';\nimport { timeout } from '../../../../../base/common/async.js';\nimport { Emitter } from '../../../../../base/common/event.js';\nimport { URI } from '../../../../../base/common/uri.js';\nimport { ensureNoDisposablesAreLeakedInTestSuite } from '../../../../../base/test/common/utils.js';\nimport { IContextKeyService } from '../../../../../platform/contextkey/common/contextkey.js';\nimport { TestInstantiationService } from '../../../../../platform/instantiation/test/common/instantiationServiceMock.js';\nimport { MockContextKeyService } from '../../../../../platform/keybinding/test/common/mockKeybindingService.js';\nimport { ILogService, NullLogService } from '../../../../../platform/log/common/log.js';\nimport { IStorageService } from '../../../../../platform/storage/common/storage.js';\nimport { TestStorageService } from '../../../../test/common/workbenchTestServices.js';\nimport { IChatAgentService } from '../../common/chatAgents.js';\nimport { ChatMode, ChatModeService } from '../../common/chatModes.js';\nimport { ChatModeKind } from '../../common/constants.js';\nimport { IAgentSource, ICustomAgent, IPromptsService, PromptsStorage } from '../../common/promptSyntax/service/promptsService.js';\nimport { MockPromptsService } from './mockPromptsService.js';\n\nclass TestChatAgentService implements Partial<IChatAgentService> {\n\t_serviceBrand: undefined;\n\n\tprivate _hasToolsAgent = true;\n\tprivate readonly _onDidChangeAgents = new Emitter<any>();\n\n\tget hasToolsAgent(): boolean {\n\t\treturn this._hasToolsAgent;\n\t}\n\n\tsetHasToolsAgent(value: boolean): void {\n\t\tthis._hasToolsAgent = value;\n\t\tthis._onDidChangeAgents.fire(undefined);\n\t}\n\n\treadonly onDidChangeAgents = this._onDidChangeAgents.event;\n}\n\nsuite('ChatModeService', () => {\n\tconst testDisposables = ensureNoDisposablesAreLeakedInTestSuite();\n\n\tconst workspaceSource: IAgentSource = { storage: PromptsStorage.local };\n\n\tlet instantiationService: TestInstantiationService;\n\tlet promptsService: MockPromptsService;\n\tlet chatAgentService: TestChatAgentService;\n\tlet storageService: TestStorageService;\n\tlet chatModeService: ChatModeService;\n\n\tsetup(async () => {\n\t\tinstantiationService = testDisposables.add(new TestInstantiationService());\n\t\tpromptsService = new MockPromptsService();\n\t\tchatAgentService = new TestChatAgentService();\n\t\tstorageService = testDisposables.add(new TestStorageService());\n\n\t\tinstantiationService.stub(IPromptsService, promptsService);\n\t\tinstantiationService.stub(IChatAgentService, chatAgentService);\n\t\tinstantiationService.stub(IStorageService, storageService);\n\t\tinstantiationService.stub(ILogService, new NullLogService());\n\t\tinstantiationService.stub(IContextKeyService, new MockContextKeyService());\n\n\t\tchatModeService = testDisposables.add(instantiationService.createInstance(ChatModeService));\n\t});\n\n\ttest('should return builtin modes', () => {\n\t\tconst modes = chatModeService.getModes();\n\n\t\tassert.strictEqual(modes.builtin.length, 3);\n\t\tassert.strictEqual(modes.custom.length, 0);\n\n\t\t// Check that Ask mode is always present\n\t\tconst askMode = modes.builtin.find(mode => mode.id === ChatModeKind.Ask);\n\t\tassert.ok(askMode);\n\t\tassert.strictEqual(askMode.label.get(), 'Ask');\n\t\tassert.strictEqual(askMode.name.get(), 'ask');\n\t\tassert.strictEqual(askMode.kind, ChatModeKind.Ask);\n\t});\n\n\ttest('should adjust builtin modes based on tools agent availability', () => {\n\t\t// With tools agent\n\t\tchatAgentService.setHasToolsAgent(true);\n\t\tlet agents = chatModeService.getModes();\n\t\tassert.ok(agents.builtin.find(agent => agent.id === ChatModeKind.Agent));\n\n\t\t// Without tools agent - Agent mode should not be present\n\t\tchatAgentService.setHasToolsAgent(false);\n\t\tagents = chatModeService.getModes();\n\t\tassert.strictEqual(agents.builtin.find(agent => agent.id === ChatModeKind.Agent), undefined);\n\n\t\t// But Ask and Edit modes should always be present\n\t\tassert.ok(agents.builtin.find(agent => agent.id === ChatModeKind.Ask));\n\t\tassert.ok(agents.builtin.find(agent => agent.id === ChatModeKind.Edit));\n\t});\n\n\ttest('should find builtin modes by id', () => {\n\t\tconst agentMode = chatModeService.findModeById(ChatModeKind.Agent);\n\t\tassert.ok(agentMode);\n\t\tassert.strictEqual(agentMode.id, ChatMode.Agent.id);\n\t\tassert.strictEqual(agentMode.kind, ChatModeKind.Agent);\n\t});\n\n\ttest('should return undefined for non-existent mode', () => {\n\t\tconst mode = chatModeService.findModeById('non-existent-mode');\n\t\tassert.strictEqual(mode, undefined);\n\t});\n\n\ttest('should handle custom modes from prompts service', async () => {\n\t\tconst customMode: ICustomAgent = {\n\t\t\turi: URI.parse('file:///test/custom-mode.md'),\n\t\t\tname: 'Test Mode',\n\t\t\tdescription: 'A test custom mode',\n\t\t\ttools: ['tool1', 'tool2'],\n\t\t\tagentInstructions: { content: 'Custom mode body', toolReferences: [] },\n\t\t\tsource: workspaceSource\n\t\t};\n\n\t\tpromptsService.setCustomModes([customMode]);\n\n\t\t// Wait for the service to refresh\n\t\tawait timeout(0);\n\n\t\tconst modes = chatModeService.getModes();\n\t\tassert.strictEqual(modes.custom.length, 1);\n\n\t\tconst testMode = modes.custom[0];\n\t\tassert.strictEqual(testMode.id, customMode.uri.toString());\n\t\tassert.strictEqual(testMode.name.get(), customMode.name);\n\t\tassert.strictEqual(testMode.label.get(), customMode.name);\n\t\tassert.strictEqual(testMode.description.get(), customMode.description);\n\t\tassert.strictEqual(testMode.kind, ChatModeKind.Agent);\n\t\tassert.deepStrictEqual(testMode.customTools?.get(), customMode.tools);\n\t\tassert.deepStrictEqual(testMode.modeInstructions?.get(), customMode.agentInstructions);\n\t\tassert.deepStrictEqual(testMode.handOffs?.get(), customMode.handOffs);\n\t\tassert.strictEqual(testMode.uri?.get().toString(), customMode.uri.toString());\n\t\tassert.deepStrictEqual(testMode.source, workspaceSource);\n\t});\n\n\ttest('should fire change event when custom modes are updated', async () => {\n\t\tlet eventFired = false;\n\t\ttestDisposables.add(chatModeService.onDidChangeChatModes(() => {\n\t\t\teventFired = true;\n\t\t}));\n\n\t\tconst customMode: ICustomAgent = {\n\t\t\turi: URI.parse('file:///test/custom-mode.md'),\n\t\t\tname: 'Test Mode',\n\t\t\tdescription: 'A test custom mode',\n\t\t\ttools: [],\n\t\t\tagentInstructions: { content: 'Custom mode body', toolReferences: [] },\n\t\t\tsource: workspaceSource,\n\t\t};\n\n\t\tpromptsService.setCustomModes([customMode]);\n\n\t\t// Wait for the event to fire\n\t\tawait timeout(0);\n\n\t\tassert.ok(eventFired);\n\t});\n\n\ttest('should find custom modes by id', async () => {\n\t\tconst customMode: ICustomAgent = {\n\t\t\turi: URI.parse('file:///test/findable-mode.md'),\n\t\t\tname: 'Findable Mode',\n\t\t\tdescription: 'A findable custom mode',\n\t\t\ttools: [],\n\t\t\tagentInstructions: { content: 'Findable mode body', toolReferences: [] },\n\t\t\tsource: workspaceSource,\n\t\t};\n\n\t\tpromptsService.setCustomModes([customMode]);\n\n\t\t// Wait for the service to refresh\n\t\tawait timeout(0);\n\n\t\tconst foundMode = chatModeService.findModeById(customMode.uri.toString());\n\t\tassert.ok(foundMode);\n\t\tassert.strictEqual(foundMode.id, customMode.uri.toString());\n\t\tassert.strictEqual(foundMode.name.get(), customMode.name);\n\t\tassert.strictEqual(foundMode.label.get(), customMode.name);\n\t});\n\n\ttest('should update existing custom mode instances when data changes', async () => {\n\t\tconst uri = URI.parse('file:///test/updateable-mode.md');\n\t\tconst initialMode: ICustomAgent = {\n\t\t\turi,\n\t\t\tname: 'Initial Mode',\n\t\t\tdescription: 'Initial description',\n\t\t\ttools: ['tool1'],\n\t\t\tagentInstructions: { content: 'Initial body', toolReferences: [] },\n\t\t\tmodel: 'gpt-4',\n\t\t\tsource: workspaceSource,\n\t\t};\n\n\t\tpromptsService.setCustomModes([initialMode]);\n\t\tawait timeout(0);\n\n\t\tconst initialModes = chatModeService.getModes();\n\t\tconst initialCustomMode = initialModes.custom[0];\n\t\tassert.strictEqual(initialCustomMode.description.get(), 'Initial description');\n\n\t\t// Update the mode data\n\t\tconst updatedMode: ICustomAgent = {\n\t\t\t...initialMode,\n\t\t\tdescription: 'Updated description',\n\t\t\ttools: ['tool1', 'tool2'],\n\t\t\tagentInstructions: { content: 'Updated body', toolReferences: [] },\n\t\t\tmodel: 'Updated model'\n\t\t};\n\n\t\tpromptsService.setCustomModes([updatedMode]);\n\t\tawait timeout(0);\n\n\t\tconst updatedModes = chatModeService.getModes();\n\t\tconst updatedCustomMode = updatedModes.custom[0];\n\n\t\t// The instance should be the same (reused)\n\t\tassert.strictEqual(initialCustomMode, updatedCustomMode);\n\n\t\t// But the observable properties should be updated\n\t\tassert.strictEqual(updatedCustomMode.description.get(), 'Updated description');\n\t\tassert.deepStrictEqual(updatedCustomMode.customTools?.get(), ['tool1', 'tool2']);\n\t\tassert.deepStrictEqual(updatedCustomMode.modeInstructions?.get(), { content: 'Updated body', toolReferences: [] });\n\t\tassert.strictEqual(updatedCustomMode.model?.get(), 'Updated model');\n\t\tassert.deepStrictEqual(updatedCustomMode.source, workspaceSource);\n\t});\n\n\ttest('should remove custom modes that no longer exist', async () => {\n\t\tconst mode1: ICustomAgent = {\n\t\t\turi: URI.parse('file:///test/mode1.md'),\n\t\t\tname: 'Mode 1',\n\t\t\tdescription: 'First mode',\n\t\t\ttools: [],\n\t\t\tagentInstructions: { content: 'Mode 1 body', toolReferences: [] },\n\t\t\tsource: workspaceSource,\n\t\t};\n\n\t\tconst mode2: ICustomAgent = {\n\t\t\turi: URI.parse('file:///test/mode2.md'),\n\t\t\tname: 'Mode 2',\n\t\t\tdescription: 'Second mode',\n\t\t\ttools: [],\n\t\t\tagentInstructions: { content: 'Mode 2 body', toolReferences: [] },\n\t\t\tsource: workspaceSource,\n\t\t};\n\n\t\t// Add both modes\n\t\tpromptsService.setCustomModes([mode1, mode2]);\n\t\tawait timeout(0);\n\n\t\tlet modes = chatModeService.getModes();\n\t\tassert.strictEqual(modes.custom.length, 2);\n\n\t\t// Remove one mode\n\t\tpromptsService.setCustomModes([mode1]);\n\t\tawait timeout(0);\n\n\t\tmodes = chatModeService.getModes();\n\t\tassert.strictEqual(modes.custom.length, 1);\n\t\tassert.strictEqual(modes.custom[0].id, mode1.uri.toString());\n\t});\n});\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport assert from 'assert';\nimport { timeout } from '../../../../../base/common/async.js';\nimport { Emitter } from '../../../../../base/common/event.js';\nimport { URI } from '../../../../../base/common/uri.js';\nimport { ensureNoDisposablesAreLeakedInTestSuite } from '../../../../../base/test/common/utils.js';\nimport { IContextKeyService } from '../../../../../platform/contextkey/common/contextkey.js';\nimport { TestInstantiationService } from '../../../../../platform/instantiation/test/common/instantiationServiceMock.js';\nimport { MockContextKeyService } from '../../../../../platform/keybinding/test/common/mockKeybindingService.js';\nimport { ILogService, NullLogService } from '../../../../../platform/log/common/log.js';\nimport { IStorageService } from '../../../../../platform/storage/common/storage.js';\nimport { TestStorageService } from '../../../../test/common/workbenchTestServices.js';\nimport { IChatAgentService } from '../../common/chatAgents.js';\nimport { ChatMode, ChatModeService } from '../../common/chatModes.js';\nimport { ChatModeKind } from '../../common/constants.js';\nimport { IAgentSource, ICustomAgent, IPromptsService, PromptsStorage } from '../../common/promptSyntax/service/promptsService.js';\nimport { MockPromptsService } from './mockPromptsService.js';\n\nclass TestChatAgentService implements Partial<IChatAgentService> {\n\t_serviceBrand: undefined;\n\n\tprivate _hasToolsAgent = true;\n\tprivate readonly _onDidChangeAgents = new Emitter<any>();\n\n\tget hasToolsAgent(): boolean {\n\t\treturn this._hasToolsAgent;\n\t}\n\n\tsetHasToolsAgent(value: boolean): void {\n\t\tthis._hasToolsAgent = value;\n\t\tthis._onDidChangeAgents.fire(undefined);\n\t}\n\n\treadonly onDidChangeAgents = this._onDidChangeAgents.event;\n}\n\nsuite('ChatModeService', () => {\n\tconst testDisposables = ensureNoDisposablesAreLeakedInTestSuite();\n\n\tconst workspaceSource: IAgentSource = { storage: PromptsStorage.local };\n\n\tlet instantiationService: TestInstantiationService;\n\tlet promptsService: MockPromptsService;\n\tlet chatAgentService: TestChatAgentService;\n\tlet storageService: TestStorageService;\n\tlet chatModeService: ChatModeService;\n\n\tsetup(async () => {\n\t\tinstantiationService = testDisposables.add(new TestInstantiationService());\n\t\tpromptsService = new MockPromptsService();\n\t\tchatAgentService = new TestChatAgentService();\n\t\tstorageService = testDisposables.add(new TestStorageService());\n\n\t\tinstantiationService.stub(IPromptsService, promptsService);\n\t\tinstantiationService.stub(IChatAgentService, chatAgentService);\n\t\tinstantiationService.stub(IStorageService, storageService);\n\t\tinstantiationService.stub(ILogService, new NullLogService());\n\t\tinstantiationService.stub(IContextKeyService, new MockContextKeyService());\n\n\t\tchatModeService = testDisposables.add(instantiationService.createInstance(ChatModeService));\n\t});\n\n\ttest('should return builtin modes', () => {\n\t\tconst modes = chatModeService.getModes();\n\n\t\tassert.strictEqual(modes.builtin.length, 3);\n\t\tassert.strictEqual(modes.custom.length, 0);\n\n\t\t// Check that Ask mode is always present\n\t\tconst askMode = modes.builtin.find(mode => mode.id === ChatModeKind.Ask);\n\t\tassert.ok(askMode);\n\t\tassert.strictEqual(askMode.label.get(), 'Ask');\n\t\tassert.strictEqual(askMode.name.get(), 'ask');\n\t\tassert.strictEqual(askMode.kind, ChatModeKind.Ask);\n\t});\n\n\ttest('should adjust builtin modes based on tools agent availability', () => {\n\t\t// With tools agent\n\t\tchatAgentService.setHasToolsAgent(true);\n\t\tlet agents = chatModeService.getModes();\n\t\tassert.ok(agents.builtin.find(agent => agent.id === ChatModeKind.Agent));\n\n\t\t// Without tools agent - Agent mode should not be present\n\t\tchatAgentService.setHasToolsAgent(false);\n\t\tagents = chatModeService.getModes();\n\t\tassert.strictEqual(agents.builtin.find(agent => agent.id === ChatModeKind.Agent), undefined);\n\n\t\t// But Ask and Edit modes should always be present\n\t\tassert.ok(agents.builtin.find(agent => agent.id === ChatModeKind.Ask));\n\t\tassert.ok(agents.builtin.find(agent => agent.id === ChatModeKind.Edit));\n\t});\n\n\ttest('should find builtin modes by id', () => {\n\t\tconst agentMode = chatModeService.findModeById(ChatModeKind.Agent);\n\t\tassert.ok(agentMode);\n\t\tassert.strictEqual(agentMode.id, ChatMode.Agent.id);\n\t\tassert.strictEqual(agentMode.kind, ChatModeKind.Agent);\n\t});\n\n\ttest('should return undefined for non-existent mode', () => {\n\t\tconst mode = chatModeService.findModeById('non-existent-mode');\n\t\tassert.strictEqual(mode, undefined);\n\t});\n\n\ttest('should handle custom modes from prompts service', async () => {\n\t\tconst customMode: ICustomAgent = {\n\t\t\turi: URI.parse('file:///test/custom-mode.md'),\n\t\t\tname: 'Test Mode',\n\t\t\tdescription: 'A test custom mode',\n\t\t\ttools: ['tool1', 'tool2'],\n\t\t\tagentInstructions: { content: 'Custom mode body', toolReferences: [] },\n\t\t\tsource: workspaceSource\n\t\t};\n\n\t\tpromptsService.setCustomModes([customMode]);\n\n\t\t// Wait for the service to refresh\n\t\tawait timeout(0);\n\n\t\tconst modes = chatModeService.getModes();\n\t\tassert.strictEqual(modes.custom.length, 1);\n\n\t\tconst testMode = modes.custom[0];\n\t\tassert.strictEqual(testMode.id, customMode.uri.toString());\n\t\tassert.strictEqual(testMode.name.get(), customMode.name);\n\t\tassert.strictEqual(testMode.label.get(), customMode.name);\n\t\tassert.strictEqual(testMode.description.get(), customMode.description);\n\t\tassert.strictEqual(testMode.kind, ChatModeKind.Agent);\n\t\tassert.deepStrictEqual(testMode.customTools?.get(), customMode.tools);\n\t\tassert.deepStrictEqual(testMode.modeInstructions?.get(), customMode.agentInstructions);\n\t\tassert.deepStrictEqual(testMode.handOffs?.get(), customMode.handOffs);\n\t\tassert.strictEqual(testMode.uri?.get().toString(), customMode.uri.toString());\n\t\tassert.deepStrictEqual(testMode.source, workspaceSource);\n\t});\n\n\ttest('should fire change event when custom modes are updated', async () => {\n\t\tlet eventFired = false;\n\t\ttestDisposables.add(chatModeService.onDidChangeChatModes(() => {\n\t\t\teventFired = true;\n\t\t}));\n\n\t\tconst customMode: ICustomAgent = {\n\t\t\turi: URI.parse('file:///test/custom-mode.md'),\n\t\t\tname: 'Test Mode',\n\t\t\tdescription: 'A test custom mode',\n\t\t\ttools: [],\n\t\t\tagentInstructions: { content: 'Custom mode body', toolReferences: [] },\n\t\t\tsource: workspaceSource,\n\t\t};\n\n\t\tpromptsService.setCustomModes([customMode]);\n\n\t\t// Wait for the event to fire\n\t\tawait timeout(0);\n\n\t\tassert.ok(eventFired);\n\t});\n\n\ttest('should find custom modes by id', async () => {\n\t\tconst customMode: ICustomAgent = {\n\t\t\turi: URI.parse('file:///test/findable-mode.md'),\n\t\t\tname: 'Findable Mode',\n\t\t\tdescription: 'A findable custom mode',\n\t\t\ttools: [],\n\t\t\tagentInstructions: { content: 'Findable mode body', toolReferences: [] },\n\t\t\tsource: workspaceSource,\n\t\t};\n\n\t\tpromptsService.setCustomModes([customMode]);\n\n\t\t// Wait for the service to refresh\n\t\tawait timeout(0);\n\n\t\tconst foundMode = chatModeService.findModeById(customMode.uri.toString());\n\t\tassert.ok(foundMode);\n\t\tassert.strictEqual(foundMode.id, customMode.uri.toString());\n\t\tassert.strictEqual(foundMode.name.get(), customMode.name);\n\t\tassert.strictEqual(foundMode.label.get(), customMode.name);\n\t});\n\n\ttest('should update existing custom mode instances when data changes', async () => {\n\t\tconst uri = URI.parse('file:///test/updateable-mode.md');\n\t\tconst initialMode: ICustomAgent = {\n\t\t\turi,\n\t\t\tname: 'Initial Mode',\n\t\t\tdescription: 'Initial description',\n\t\t\ttools: ['tool1'],\n\t\t\tagentInstructions: { content: 'Initial body', toolReferences: [] },\n\t\t\tmodel: 'gpt-4',\n\t\t\tsource: workspaceSource,\n\t\t};\n\n\t\tpromptsService.setCustomModes([initialMode]);\n\t\tawait timeout(0);\n\n\t\tconst initialModes = chatModeService.getModes();\n\t\tconst initialCustomMode = initialModes.custom[0];\n\t\tassert.strictEqual(initialCustomMode.description.get(), 'Initial description');\n\n\t\t// Update the mode data\n\t\tconst updatedMode: ICustomAgent = {\n\t\t\t...initialMode,\n\t\t\tdescription: 'Updated description',\n\t\t\ttools: ['tool1', 'tool2'],\n\t\t\tagentInstructions: { content: 'Updated body', toolReferences: [] },\n\t\t\tmodel: 'Updated model'\n\t\t};\n\n\t\tpromptsService.setCustomModes([updatedMode]);\n\t\tawait timeout(0);\n\n\t\tconst updatedModes = chatModeService.getModes();\n\t\tconst updatedCustomMode = updatedModes.custom[0];\n\n\t\t// The instance should be the same (reused)\n\t\tassert.strictEqual(initialCustomMode, updatedCustomMode);\n\n\t\t// But the observable properties should be updated\n\t\tassert.strictEqual(updatedCustomMode.description.get(), 'Updated description');\n\t\tassert.deepStrictEqual(updatedCustomMode.customTools?.get(), ['tool1', 'tool2']);\n\t\tassert.deepStrictEqual(updatedCustomMode.modeInstructions?.get(), { content: 'Updated body', toolReferences: [] });\n\t\tassert.strictEqual(updatedCustomMode.model?.get(), 'Updated model');\n\t\tassert.deepStrictEqual(updatedCustomMode.source, workspaceSource);\n\t});\n\n\ttest('should remove custom modes that no longer exist', async () => {\n\t\tconst mode1: ICustomAgent = {\n\t\t\turi: URI.parse('file:///test/mode1.md'),\n\t\t\tname: 'Mode 1',\n\t\t\tdescription: 'First mode',\n\t\t\ttools: [],\n\t\t\tagentInstructions: { content: 'Mode 1 body', toolReferences: [] },\n\t\t\tsource: workspaceSource,\n\t\t};\n\n\t\tconst mode2: ICustomAgent = {\n\t\t\turi: URI.parse('file:///test/mode2.md'),\n\t\t\tname: 'Mode 2',\n\t\t\tdescription: 'Second mode',\n\t\t\ttools: [],\n\t\t\tagentInstructions: { content: 'Mode 2 body', toolReferences: [] },\n\t\t\tsource: workspaceSource,\n\t\t};\n\n\t\t// Add both modes\n\t\tpromptsService.setCustomModes([mode1, mode2]);\n\t\tawait timeout(0);\n\n\t\tlet modes = chatModeService.getModes();\n\t\tassert.strictEqual(modes.custom.length, 2);\n\n\t\t// Remove one mode\n\t\tpromptsService.setCustomModes([mode1]);\n\t\tawait timeout(0);\n\n\t\tmodes = chatModeService.getModes();\n\t\tassert.strictEqual(modes.custom.length, 1);\n\t\tassert.strictEqual(modes.custom[0].id, mode1.uri.toString());\n\t});\n});\n"]}