{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/contrib/chat/browser/chatAttachmentModel.ts","vs/workbench/contrib/chat/browser/chatAttachmentModel.ts"],"names":[],"mappings":"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","file":"chatAttachmentModel.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { URI } from '../../../../base/common/uri.js';\nimport { Emitter } from '../../../../base/common/event.js';\nimport { basename } from '../../../../base/common/resources.js';\nimport { IRange } from '../../../../editor/common/core/range.js';\nimport { Disposable } from '../../../../base/common/lifecycle.js';\nimport { IChatRequestFileEntry, IChatRequestVariableEntry, isPromptFileVariableEntry } from '../common/chatVariableEntries.js';\nimport { IFileService } from '../../../../platform/files/common/files.js';\nimport { ISharedWebContentExtractorService } from '../../../../platform/webContentExtractor/common/webContentExtractor.js';\nimport { Schemas } from '../../../../base/common/network.js';\nimport { IChatAttachmentResolveService } from './chatAttachmentResolveService.js';\nimport { CancellationToken } from '../../../../base/common/cancellation.js';\nimport { equals } from '../../../../base/common/objects.js';\nimport { Iterable } from '../../../../base/common/iterator.js';\n\nexport interface IChatAttachmentChangeEvent {\n\treadonly deleted: readonly string[];\n\treadonly added: readonly IChatRequestVariableEntry[];\n\treadonly updated: readonly IChatRequestVariableEntry[];\n}\n\nexport class ChatAttachmentModel extends Disposable {\n\n\tprivate readonly _attachments = new Map<string, IChatRequestVariableEntry>();\n\n\tprivate _onDidChange = this._register(new Emitter<IChatAttachmentChangeEvent>());\n\treadonly onDidChange = this._onDidChange.event;\n\n\tconstructor(\n\t\t@IFileService private readonly fileService: IFileService,\n\t\t@ISharedWebContentExtractorService private readonly webContentExtractorService: ISharedWebContentExtractorService,\n\t\t@IChatAttachmentResolveService private readonly chatAttachmentResolveService: IChatAttachmentResolveService,\n\t) {\n\t\tsuper();\n\t}\n\n\tget attachments(): ReadonlyArray<IChatRequestVariableEntry> {\n\t\treturn Array.from(this._attachments.values());\n\t}\n\n\tget size(): number {\n\t\treturn this._attachments.size;\n\t}\n\n\tget fileAttachments(): URI[] {\n\t\treturn this.attachments.filter(file => file.kind === 'file' && URI.isUri(file.value))\n\t\t\t.map(file => file.value as URI);\n\t}\n\n\tgetAttachmentIDs() {\n\t\treturn new Set(this._attachments.keys());\n\t}\n\n\tasync addFile(uri: URI, range?: IRange) {\n\t\tif (/\\.(png|jpe?g|gif|bmp|webp)$/i.test(uri.path)) {\n\t\t\tconst context = await this.asImageVariableEntry(uri);\n\t\t\tif (context) {\n\t\t\t\tthis.addContext(context);\n\t\t\t}\n\t\t\treturn;\n\t\t} else {\n\t\t\tthis.addContext(this.asFileVariableEntry(uri, range));\n\t\t}\n\t}\n\n\taddFolder(uri: URI) {\n\t\tthis.addContext({\n\t\t\tkind: 'directory',\n\t\t\tvalue: uri,\n\t\t\tid: uri.toString(),\n\t\t\tname: basename(uri),\n\t\t});\n\t}\n\n\tclear(clearStickyAttachments: boolean = false): void {\n\t\tif (clearStickyAttachments) {\n\t\t\tconst deleted = Array.from(this._attachments.keys());\n\t\t\tthis._attachments.clear();\n\t\t\tthis._onDidChange.fire({ deleted, added: [], updated: [] });\n\t\t} else {\n\t\t\tconst deleted: string[] = [];\n\t\t\tconst allIds = Array.from(this._attachments.keys());\n\t\t\tfor (const id of allIds) {\n\t\t\t\tconst entry = this._attachments.get(id);\n\t\t\t\tif (entry && !isPromptFileVariableEntry(entry)) {\n\t\t\t\t\tthis._attachments.delete(id);\n\t\t\t\t\tdeleted.push(id);\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis._onDidChange.fire({ deleted, added: [], updated: [] });\n\t\t}\n\t}\n\n\taddContext(...attachments: IChatRequestVariableEntry[]) {\n\t\tattachments = attachments.filter(attachment => !this._attachments.has(attachment.id));\n\t\tthis.updateContext(Iterable.empty(), attachments);\n\t}\n\n\tclearAndSetContext(...attachments: IChatRequestVariableEntry[]) {\n\t\tthis.updateContext(Array.from(this._attachments.keys()), attachments);\n\t}\n\n\tdelete(...variableEntryIds: string[]) {\n\t\tthis.updateContext(variableEntryIds, Iterable.empty());\n\t}\n\n\tupdateContext(toDelete: Iterable<string>, upsert: Iterable<IChatRequestVariableEntry>) {\n\t\tconst deleted: string[] = [];\n\t\tconst added: IChatRequestVariableEntry[] = [];\n\t\tconst updated: IChatRequestVariableEntry[] = [];\n\n\t\tfor (const id of toDelete) {\n\t\t\tconst item = this._attachments.get(id);\n\t\t\tif (item) {\n\t\t\t\tthis._attachments.delete(id);\n\t\t\t\tdeleted.push(id);\n\t\t\t}\n\t\t}\n\n\t\tfor (const item of upsert) {\n\t\t\tconst oldItem = this._attachments.get(item.id);\n\t\t\tif (!oldItem) {\n\t\t\t\tthis._attachments.set(item.id, item);\n\t\t\t\tadded.push(item);\n\t\t\t} else if (!equals(oldItem, item)) {\n\t\t\t\tthis._attachments.set(item.id, item);\n\t\t\t\tupdated.push(item);\n\t\t\t}\n\t\t}\n\n\t\tif (deleted.length > 0 || added.length > 0 || updated.length > 0) {\n\t\t\tthis._onDidChange.fire({ deleted, added, updated });\n\t\t}\n\t}\n\n\t// ---- create utils\n\n\tasFileVariableEntry(uri: URI, range?: IRange): IChatRequestFileEntry {\n\t\treturn {\n\t\t\tkind: 'file',\n\t\t\tvalue: range ? { uri, range } : uri,\n\t\t\tid: uri.toString() + (range?.toString() ?? ''),\n\t\t\tname: basename(uri),\n\t\t};\n\t}\n\n\t// Gets an image variable for a given URI, which may be a file or a web URL\n\tasync asImageVariableEntry(uri: URI): Promise<IChatRequestVariableEntry | undefined> {\n\t\tif (uri.scheme === Schemas.file && await this.fileService.canHandleResource(uri)) {\n\t\t\treturn await this.chatAttachmentResolveService.resolveImageEditorAttachContext(uri);\n\t\t} else if (uri.scheme === Schemas.http || uri.scheme === Schemas.https) {\n\t\t\tconst extractedImages = await this.webContentExtractorService.readImage(uri, CancellationToken.None);\n\t\t\tif (extractedImages) {\n\t\t\t\treturn await this.chatAttachmentResolveService.resolveImageEditorAttachContext(uri, extractedImages);\n\t\t\t}\n\t\t}\n\n\t\treturn undefined;\n\t}\n\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { URI } from '../../../../base/common/uri.js';\nimport { Emitter } from '../../../../base/common/event.js';\nimport { basename } from '../../../../base/common/resources.js';\nimport { IRange } from '../../../../editor/common/core/range.js';\nimport { Disposable } from '../../../../base/common/lifecycle.js';\nimport { IChatRequestFileEntry, IChatRequestVariableEntry, isPromptFileVariableEntry } from '../common/chatVariableEntries.js';\nimport { IFileService } from '../../../../platform/files/common/files.js';\nimport { ISharedWebContentExtractorService } from '../../../../platform/webContentExtractor/common/webContentExtractor.js';\nimport { Schemas } from '../../../../base/common/network.js';\nimport { IChatAttachmentResolveService } from './chatAttachmentResolveService.js';\nimport { CancellationToken } from '../../../../base/common/cancellation.js';\nimport { equals } from '../../../../base/common/objects.js';\nimport { Iterable } from '../../../../base/common/iterator.js';\n\nexport interface IChatAttachmentChangeEvent {\n\treadonly deleted: readonly string[];\n\treadonly added: readonly IChatRequestVariableEntry[];\n\treadonly updated: readonly IChatRequestVariableEntry[];\n}\n\nexport class ChatAttachmentModel extends Disposable {\n\n\tprivate readonly _attachments = new Map<string, IChatRequestVariableEntry>();\n\n\tprivate _onDidChange = this._register(new Emitter<IChatAttachmentChangeEvent>());\n\treadonly onDidChange = this._onDidChange.event;\n\n\tconstructor(\n\t\t@IFileService private readonly fileService: IFileService,\n\t\t@ISharedWebContentExtractorService private readonly webContentExtractorService: ISharedWebContentExtractorService,\n\t\t@IChatAttachmentResolveService private readonly chatAttachmentResolveService: IChatAttachmentResolveService,\n\t) {\n\t\tsuper();\n\t}\n\n\tget attachments(): ReadonlyArray<IChatRequestVariableEntry> {\n\t\treturn Array.from(this._attachments.values());\n\t}\n\n\tget size(): number {\n\t\treturn this._attachments.size;\n\t}\n\n\tget fileAttachments(): URI[] {\n\t\treturn this.attachments.filter(file => file.kind === 'file' && URI.isUri(file.value))\n\t\t\t.map(file => file.value as URI);\n\t}\n\n\tgetAttachmentIDs() {\n\t\treturn new Set(this._attachments.keys());\n\t}\n\n\tasync addFile(uri: URI, range?: IRange) {\n\t\tif (/\\.(png|jpe?g|gif|bmp|webp)$/i.test(uri.path)) {\n\t\t\tconst context = await this.asImageVariableEntry(uri);\n\t\t\tif (context) {\n\t\t\t\tthis.addContext(context);\n\t\t\t}\n\t\t\treturn;\n\t\t} else {\n\t\t\tthis.addContext(this.asFileVariableEntry(uri, range));\n\t\t}\n\t}\n\n\taddFolder(uri: URI) {\n\t\tthis.addContext({\n\t\t\tkind: 'directory',\n\t\t\tvalue: uri,\n\t\t\tid: uri.toString(),\n\t\t\tname: basename(uri),\n\t\t});\n\t}\n\n\tclear(clearStickyAttachments: boolean = false): void {\n\t\tif (clearStickyAttachments) {\n\t\t\tconst deleted = Array.from(this._attachments.keys());\n\t\t\tthis._attachments.clear();\n\t\t\tthis._onDidChange.fire({ deleted, added: [], updated: [] });\n\t\t} else {\n\t\t\tconst deleted: string[] = [];\n\t\t\tconst allIds = Array.from(this._attachments.keys());\n\t\t\tfor (const id of allIds) {\n\t\t\t\tconst entry = this._attachments.get(id);\n\t\t\t\tif (entry && !isPromptFileVariableEntry(entry)) {\n\t\t\t\t\tthis._attachments.delete(id);\n\t\t\t\t\tdeleted.push(id);\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis._onDidChange.fire({ deleted, added: [], updated: [] });\n\t\t}\n\t}\n\n\taddContext(...attachments: IChatRequestVariableEntry[]) {\n\t\tattachments = attachments.filter(attachment => !this._attachments.has(attachment.id));\n\t\tthis.updateContext(Iterable.empty(), attachments);\n\t}\n\n\tclearAndSetContext(...attachments: IChatRequestVariableEntry[]) {\n\t\tthis.updateContext(Array.from(this._attachments.keys()), attachments);\n\t}\n\n\tdelete(...variableEntryIds: string[]) {\n\t\tthis.updateContext(variableEntryIds, Iterable.empty());\n\t}\n\n\tupdateContext(toDelete: Iterable<string>, upsert: Iterable<IChatRequestVariableEntry>) {\n\t\tconst deleted: string[] = [];\n\t\tconst added: IChatRequestVariableEntry[] = [];\n\t\tconst updated: IChatRequestVariableEntry[] = [];\n\n\t\tfor (const id of toDelete) {\n\t\t\tconst item = this._attachments.get(id);\n\t\t\tif (item) {\n\t\t\t\tthis._attachments.delete(id);\n\t\t\t\tdeleted.push(id);\n\t\t\t}\n\t\t}\n\n\t\tfor (const item of upsert) {\n\t\t\tconst oldItem = this._attachments.get(item.id);\n\t\t\tif (!oldItem) {\n\t\t\t\tthis._attachments.set(item.id, item);\n\t\t\t\tadded.push(item);\n\t\t\t} else if (!equals(oldItem, item)) {\n\t\t\t\tthis._attachments.set(item.id, item);\n\t\t\t\tupdated.push(item);\n\t\t\t}\n\t\t}\n\n\t\tif (deleted.length > 0 || added.length > 0 || updated.length > 0) {\n\t\t\tthis._onDidChange.fire({ deleted, added, updated });\n\t\t}\n\t}\n\n\t// ---- create utils\n\n\tasFileVariableEntry(uri: URI, range?: IRange): IChatRequestFileEntry {\n\t\treturn {\n\t\t\tkind: 'file',\n\t\t\tvalue: range ? { uri, range } : uri,\n\t\t\tid: uri.toString() + (range?.toString() ?? ''),\n\t\t\tname: basename(uri),\n\t\t};\n\t}\n\n\t// Gets an image variable for a given URI, which may be a file or a web URL\n\tasync asImageVariableEntry(uri: URI): Promise<IChatRequestVariableEntry | undefined> {\n\t\tif (uri.scheme === Schemas.file && await this.fileService.canHandleResource(uri)) {\n\t\t\treturn await this.chatAttachmentResolveService.resolveImageEditorAttachContext(uri);\n\t\t} else if (uri.scheme === Schemas.http || uri.scheme === Schemas.https) {\n\t\t\tconst extractedImages = await this.webContentExtractorService.readImage(uri, CancellationToken.None);\n\t\t\tif (extractedImages) {\n\t\t\t\treturn await this.chatAttachmentResolveService.resolveImageEditorAttachContext(uri, extractedImages);\n\t\t\t}\n\t\t}\n\n\t\treturn undefined;\n\t}\n\n}\n"]}