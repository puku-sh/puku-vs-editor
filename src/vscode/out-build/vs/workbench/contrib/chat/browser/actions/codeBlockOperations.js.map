{"version":3,"sources":["vs/workbench/contrib/chat/browser/actions/codeBlockOperations.ts"],"names":[],"mappings":"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","file":"codeBlockOperations.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nimport { AsyncIterableObject } from '../../../../../base/common/async.js';\nimport { VSBuffer } from '../../../../../base/common/buffer.js';\nimport { CancellationToken, CancellationTokenSource } from '../../../../../base/common/cancellation.js';\nimport { CharCode } from '../../../../../base/common/charCode.js';\nimport { isCancellationError } from '../../../../../base/common/errors.js';\nimport { isEqual } from '../../../../../base/common/resources.js';\nimport * as strings from '../../../../../base/common/strings.js';\nimport { URI } from '../../../../../base/common/uri.js';\nimport { getCodeEditor, IActiveCodeEditor } from '../../../../../editor/browser/editorBrowser.js';\nimport { IBulkEditService, ResourceTextEdit } from '../../../../../editor/browser/services/bulkEditService.js';\nimport { ICodeEditorService } from '../../../../../editor/browser/services/codeEditorService.js';\nimport { Range } from '../../../../../editor/common/core/range.js';\nimport { TextEdit } from '../../../../../editor/common/languages.js';\nimport { ILanguageService } from '../../../../../editor/common/languages/language.js';\nimport { ITextModel } from '../../../../../editor/common/model.js';\nimport { EditDeltaInfo, EditSuggestionId } from '../../../../../editor/common/textModelEditSource.js';\nimport { localize } from '../../../../../nls.js';\nimport { IDialogService } from '../../../../../platform/dialogs/common/dialogs.js';\nimport { IFileService } from '../../../../../platform/files/common/files.js';\nimport { IInstantiationService } from '../../../../../platform/instantiation/common/instantiation.js';\nimport { ILabelService } from '../../../../../platform/label/common/label.js';\nimport { ILogService } from '../../../../../platform/log/common/log.js';\nimport { IProgressService, ProgressLocation } from '../../../../../platform/progress/common/progress.js';\nimport { IQuickInputService } from '../../../../../platform/quickinput/common/quickInput.js';\nimport { IEditorService } from '../../../../services/editor/common/editorService.js';\nimport { ITextFileService } from '../../../../services/textfile/common/textfiles.js';\nimport { IAiEditTelemetryService } from '../../../editTelemetry/browser/telemetry/aiEditTelemetry/aiEditTelemetryService.js';\nimport { reviewEdits, reviewNotebookEdits } from '../../../inlineChat/browser/inlineChatController.js';\nimport { insertCell } from '../../../notebook/browser/controller/cellOperations.js';\nimport { IActiveNotebookEditor, INotebookEditor } from '../../../notebook/browser/notebookBrowser.js';\nimport { CellKind, ICellEditOperation, NOTEBOOK_EDITOR_ID } from '../../../notebook/common/notebookCommon.js';\nimport { INotebookService } from '../../../notebook/common/notebookService.js';\nimport { ICodeMapperCodeBlock, ICodeMapperRequest, ICodeMapperResponse, ICodeMapperService } from '../../common/chatCodeMapperService.js';\nimport { ChatUserAction, IChatService } from '../../common/chatService.js';\nimport { chatSessionResourceToId } from '../../common/chatUri.js';\nimport { IChatRequestViewModel, isRequestVM, isResponseVM } from '../../common/chatViewModel.js';\nimport { ICodeBlockActionContext } from '../codeBlockPart.js';\n\nexport class InsertCodeBlockOperation {\n\tconstructor(\n\t\t@IEditorService private readonly editorService: IEditorService,\n\t\t@ITextFileService private readonly textFileService: ITextFileService,\n\t\t@IBulkEditService private readonly bulkEditService: IBulkEditService,\n\t\t@ICodeEditorService private readonly codeEditorService: ICodeEditorService,\n\t\t@IChatService private readonly chatService: IChatService,\n\t\t@ILanguageService private readonly languageService: ILanguageService,\n\t\t@IDialogService private readonly dialogService: IDialogService,\n\t\t@IAiEditTelemetryService private readonly aiEditTelemetryService: IAiEditTelemetryService,\n\t) {\n\t}\n\n\tpublic async run(context: ICodeBlockActionContext) {\n\t\tconst activeEditorControl = getEditableActiveCodeEditor(this.editorService);\n\t\tif (activeEditorControl) {\n\t\t\tawait this.handleTextEditor(activeEditorControl, context);\n\t\t} else {\n\t\t\tconst activeNotebookEditor = getActiveNotebookEditor(this.editorService);\n\t\t\tif (activeNotebookEditor) {\n\t\t\t\tawait this.handleNotebookEditor(activeNotebookEditor, context);\n\t\t\t} else {\n\t\t\t\tthis.notify(localize('insertCodeBlock.noActiveEditor', \"To insert the code block, open a code editor or notebook editor and set the cursor at the location where to insert the code block.\"));\n\t\t\t}\n\t\t}\n\n\t\tif (isResponseVM(context.element)) {\n\t\t\tconst requestId = context.element.requestId;\n\t\t\tconst request = context.element.session.getItems().find(item => item.id === requestId && isRequestVM(item)) as IChatRequestViewModel | undefined;\n\t\t\tnotifyUserAction(this.chatService, context, {\n\t\t\t\tkind: 'insert',\n\t\t\t\tcodeBlockIndex: context.codeBlockIndex,\n\t\t\t\ttotalCharacters: context.code.length,\n\t\t\t\ttotalLines: context.code.split('\\n').length,\n\t\t\t\tlanguageId: context.languageId,\n\t\t\t\tmodelId: request?.modelId ?? '',\n\t\t\t});\n\n\t\t\tconst codeBlockInfo = context.element.model.codeBlockInfos?.at(context.codeBlockIndex);\n\n\t\t\tthis.aiEditTelemetryService.handleCodeAccepted({\n\t\t\t\tacceptanceMethod: 'insertAtCursor',\n\t\t\t\tsuggestionId: codeBlockInfo?.suggestionId,\n\t\t\t\teditDeltaInfo: EditDeltaInfo.fromText(context.code),\n\t\t\t\tfeature: 'sideBarChat',\n\t\t\t\tlanguageId: context.languageId,\n\t\t\t\tmodeId: context.element.model.request?.modeInfo?.modeId,\n\t\t\t\tmodelId: request?.modelId,\n\t\t\t\tpresentation: 'codeBlock',\n\t\t\t\tapplyCodeBlockSuggestionId: undefined,\n\t\t\t\tsource: undefined,\n\t\t\t});\n\t\t}\n\t}\n\n\tprivate async handleNotebookEditor(notebookEditor: IActiveNotebookEditor, codeBlockContext: ICodeBlockActionContext): Promise<boolean> {\n\t\tif (notebookEditor.isReadOnly) {\n\t\t\tthis.notify(localize('insertCodeBlock.readonlyNotebook', \"Cannot insert the code block to read-only notebook editor.\"));\n\t\t\treturn false;\n\t\t}\n\t\tconst focusRange = notebookEditor.getFocus();\n\t\tconst next = Math.max(focusRange.end - 1, 0);\n\t\tinsertCell(this.languageService, notebookEditor, next, CellKind.Code, 'below', codeBlockContext.code, true);\n\t\treturn true;\n\t}\n\n\tprivate async handleTextEditor(codeEditor: IActiveCodeEditor, codeBlockContext: ICodeBlockActionContext): Promise<boolean> {\n\t\tconst activeModel = codeEditor.getModel();\n\t\tif (isReadOnly(activeModel, this.textFileService)) {\n\t\t\tthis.notify(localize('insertCodeBlock.readonly', \"Cannot insert the code block to read-only code editor.\"));\n\t\t\treturn false;\n\t\t}\n\n\t\tconst range = codeEditor.getSelection() ?? new Range(activeModel.getLineCount(), 1, activeModel.getLineCount(), 1);\n\t\tconst text = reindent(codeBlockContext.code, activeModel, range.startLineNumber);\n\n\t\tconst edits = [new ResourceTextEdit(activeModel.uri, { range, text })];\n\t\tawait this.bulkEditService.apply(edits);\n\t\tthis.codeEditorService.listCodeEditors().find(editor => editor.getModel()?.uri.toString() === activeModel.uri.toString())?.focus();\n\t\treturn true;\n\t}\n\n\tprivate notify(message: string) {\n\t\t//this.notificationService.notify({ severity: Severity.Info, message });\n\t\tthis.dialogService.info(message);\n\t}\n}\n\ntype IComputeEditsResult = { readonly editsProposed: boolean; readonly codeMapper?: string };\n\nexport class ApplyCodeBlockOperation {\n\n\tconstructor(\n\t\t@IEditorService private readonly editorService: IEditorService,\n\t\t@ITextFileService private readonly textFileService: ITextFileService,\n\t\t@IChatService private readonly chatService: IChatService,\n\t\t@IFileService private readonly fileService: IFileService,\n\t\t@IDialogService private readonly dialogService: IDialogService,\n\t\t@ILogService private readonly logService: ILogService,\n\t\t@ICodeMapperService private readonly codeMapperService: ICodeMapperService,\n\t\t@IProgressService private readonly progressService: IProgressService,\n\t\t@IQuickInputService private readonly quickInputService: IQuickInputService,\n\t\t@ILabelService private readonly labelService: ILabelService,\n\t\t@IInstantiationService private readonly instantiationService: IInstantiationService,\n\t\t@INotebookService private readonly notebookService: INotebookService,\n\t) {\n\t}\n\n\tpublic async run(context: ICodeBlockActionContext): Promise<void> {\n\t\tlet activeEditorControl = getEditableActiveCodeEditor(this.editorService);\n\n\t\tconst codemapperUri = await this.evaluateURIToUse(context.codemapperUri, activeEditorControl);\n\t\tif (!codemapperUri) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (codemapperUri && !isEqual(activeEditorControl?.getModel().uri, codemapperUri) && !this.notebookService.hasSupportedNotebooks(codemapperUri)) {\n\t\t\t// reveal the target file\n\t\t\ttry {\n\t\t\t\tconst editorPane = await this.editorService.openEditor({ resource: codemapperUri });\n\t\t\t\tconst codeEditor = getCodeEditor(editorPane?.getControl());\n\t\t\t\tif (codeEditor && codeEditor.hasModel()) {\n\t\t\t\t\tthis.tryToRevealCodeBlock(codeEditor, context.code);\n\t\t\t\t\tactiveEditorControl = codeEditor;\n\t\t\t\t} else {\n\t\t\t\t\tthis.notify(localize('applyCodeBlock.errorOpeningFile', \"Failed to open {0} in a code editor.\", codemapperUri.toString()));\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t} catch (e) {\n\t\t\t\tthis.logService.info('[ApplyCodeBlockOperation] error opening code mapper file', codemapperUri, e);\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tlet codeBlockSuggestionId: EditSuggestionId | undefined = undefined;\n\n\t\tif (isResponseVM(context.element)) {\n\t\t\tconst codeBlockInfo = context.element.model.codeBlockInfos?.at(context.codeBlockIndex);\n\t\t\tif (codeBlockInfo) {\n\t\t\t\tcodeBlockSuggestionId = codeBlockInfo.suggestionId;\n\t\t\t}\n\t\t}\n\n\t\tlet result: IComputeEditsResult | undefined = undefined;\n\n\t\tif (activeEditorControl && !this.notebookService.hasSupportedNotebooks(codemapperUri)) {\n\t\t\tresult = await this.handleTextEditor(activeEditorControl, context.chatSessionResource, context.code, codeBlockSuggestionId);\n\t\t} else {\n\t\t\tconst activeNotebookEditor = getActiveNotebookEditor(this.editorService);\n\t\t\tif (activeNotebookEditor) {\n\t\t\t\tresult = await this.handleNotebookEditor(activeNotebookEditor, context.chatSessionResource, context.code);\n\t\t\t} else {\n\t\t\t\tthis.notify(localize('applyCodeBlock.noActiveEditor', \"To apply this code block, open a code or notebook editor.\"));\n\t\t\t}\n\t\t}\n\n\t\tif (isResponseVM(context.element)) {\n\t\t\tconst requestId = context.element.requestId;\n\t\t\tconst request = context.element.session.getItems().find(item => item.id === requestId && isRequestVM(item)) as IChatRequestViewModel | undefined;\n\t\t\tnotifyUserAction(this.chatService, context, {\n\t\t\t\tkind: 'apply',\n\t\t\t\tcodeBlockIndex: context.codeBlockIndex,\n\t\t\t\ttotalCharacters: context.code.length,\n\t\t\t\tcodeMapper: result?.codeMapper,\n\t\t\t\teditsProposed: !!result?.editsProposed,\n\t\t\t\ttotalLines: context.code.split('\\n').length,\n\t\t\t\tmodelId: request?.modelId ?? '',\n\t\t\t\tlanguageId: context.languageId,\n\t\t\t});\n\t\t}\n\t}\n\n\tprivate async evaluateURIToUse(resource: URI | undefined, activeEditorControl: IActiveCodeEditor | undefined): Promise<URI | undefined> {\n\t\tif (resource && await this.fileService.exists(resource)) {\n\t\t\treturn resource;\n\t\t}\n\n\t\tconst activeEditorOption = activeEditorControl?.getModel().uri ? { label: localize('activeEditor', \"Active editor '{0}'\", this.labelService.getUriLabel(activeEditorControl.getModel().uri, { relative: true })), id: 'activeEditor' } : undefined;\n\t\tconst untitledEditorOption = { label: localize('newUntitledFile', \"New untitled editor\"), id: 'newUntitledFile' };\n\n\t\tconst options = [];\n\t\tif (resource) {\n\t\t\t// code block had an URI, but it doesn't exist\n\t\t\toptions.push({ label: localize('createFile', \"New file '{0}'\", this.labelService.getUriLabel(resource, { relative: true })), id: 'createFile' });\n\t\t\toptions.push(untitledEditorOption);\n\t\t\tif (activeEditorOption) {\n\t\t\t\toptions.push(activeEditorOption);\n\t\t\t}\n\t\t} else {\n\t\t\t// code block had no URI\n\t\t\tif (activeEditorOption) {\n\t\t\t\toptions.push(activeEditorOption);\n\t\t\t}\n\t\t\toptions.push(untitledEditorOption);\n\t\t}\n\n\t\tconst selected = options.length > 1 ? await this.quickInputService.pick(options, { placeHolder: localize('selectOption', \"Select where to apply the code block\") }) : options[0];\n\t\tif (selected) {\n\t\t\tswitch (selected.id) {\n\t\t\t\tcase 'createFile':\n\t\t\t\t\tif (resource) {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tawait this.fileService.writeFile(resource, VSBuffer.fromString(''));\n\t\t\t\t\t\t} catch (error) {\n\t\t\t\t\t\t\tthis.notify(localize('applyCodeBlock.fileWriteError', \"Failed to create file: {0}\", error.message));\n\t\t\t\t\t\t\treturn URI.from({ scheme: 'untitled', path: resource.path });\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\treturn resource;\n\t\t\t\tcase 'newUntitledFile':\n\t\t\t\t\treturn URI.from({ scheme: 'untitled', path: resource ? resource.path : 'Untitled-1' });\n\t\t\t\tcase 'activeEditor':\n\t\t\t\t\treturn activeEditorControl?.getModel().uri;\n\t\t\t}\n\t\t}\n\t\treturn undefined;\n\t}\n\n\tprivate async handleNotebookEditor(notebookEditor: IActiveNotebookEditor, chatSessionResource: URI | undefined, code: string): Promise<IComputeEditsResult | undefined> {\n\t\tif (notebookEditor.isReadOnly) {\n\t\t\tthis.notify(localize('applyCodeBlock.readonlyNotebook', \"Cannot apply code block to read-only notebook editor.\"));\n\t\t\treturn undefined;\n\t\t}\n\t\tconst uri = notebookEditor.textModel.uri;\n\t\tconst codeBlock = { code, resource: uri, markdownBeforeBlock: undefined };\n\t\tconst codeMapper = this.codeMapperService.providers[0]?.displayName;\n\t\tif (!codeMapper) {\n\t\t\tthis.notify(localize('applyCodeBlock.noCodeMapper', \"No code mapper available.\"));\n\t\t\treturn undefined;\n\t\t}\n\t\tlet editsProposed = false;\n\t\tconst cancellationTokenSource = new CancellationTokenSource();\n\t\ttry {\n\t\t\tconst iterable = await this.progressService.withProgress<AsyncIterable<[URI, TextEdit[]] | ICellEditOperation[]>>(\n\t\t\t\t{ location: ProgressLocation.Notification, delay: 500, sticky: true, cancellable: true },\n\t\t\t\tasync progress => {\n\t\t\t\t\tprogress.report({ message: localize('applyCodeBlock.progress', \"Applying code block using {0}...\", codeMapper) });\n\t\t\t\t\tconst editsIterable = this.getNotebookEdits(codeBlock, chatSessionResource, cancellationTokenSource.token);\n\t\t\t\t\treturn await this.waitForFirstElement(editsIterable);\n\t\t\t\t},\n\t\t\t\t() => cancellationTokenSource.cancel()\n\t\t\t);\n\t\t\teditsProposed = await this.applyNotebookEditsWithInlinePreview(iterable, uri, cancellationTokenSource);\n\t\t} catch (e) {\n\t\t\tif (!isCancellationError(e)) {\n\t\t\t\tthis.notify(localize('applyCodeBlock.error', \"Failed to apply code block: {0}\", e.message));\n\t\t\t}\n\t\t} finally {\n\t\t\tcancellationTokenSource.dispose();\n\t\t}\n\n\t\treturn {\n\t\t\teditsProposed,\n\t\t\tcodeMapper\n\t\t};\n\t}\n\n\tprivate async handleTextEditor(codeEditor: IActiveCodeEditor, chatSessionResource: URI | undefined, code: string, applyCodeBlockSuggestionId: EditSuggestionId | undefined): Promise<IComputeEditsResult | undefined> {\n\t\tconst activeModel = codeEditor.getModel();\n\t\tif (isReadOnly(activeModel, this.textFileService)) {\n\t\t\tthis.notify(localize('applyCodeBlock.readonly', \"Cannot apply code block to read-only file.\"));\n\t\t\treturn undefined;\n\t\t}\n\n\t\tconst codeBlock = { code, resource: activeModel.uri, chatSessionResource, markdownBeforeBlock: undefined };\n\n\t\tconst codeMapper = this.codeMapperService.providers[0]?.displayName;\n\t\tif (!codeMapper) {\n\t\t\tthis.notify(localize('applyCodeBlock.noCodeMapper', \"No code mapper available.\"));\n\t\t\treturn undefined;\n\t\t}\n\t\tlet editsProposed = false;\n\t\tconst cancellationTokenSource = new CancellationTokenSource();\n\t\ttry {\n\t\t\tconst iterable = await this.progressService.withProgress<AsyncIterable<TextEdit[]>>(\n\t\t\t\t{ location: ProgressLocation.Notification, delay: 500, sticky: true, cancellable: true },\n\t\t\t\tasync progress => {\n\t\t\t\t\tprogress.report({ message: localize('applyCodeBlock.progress', \"Applying code block using {0}...\", codeMapper) });\n\t\t\t\t\tconst editsIterable = this.getTextEdits(codeBlock, chatSessionResource, cancellationTokenSource.token);\n\t\t\t\t\treturn await this.waitForFirstElement(editsIterable);\n\t\t\t\t},\n\t\t\t\t() => cancellationTokenSource.cancel()\n\t\t\t);\n\t\t\teditsProposed = await this.applyWithInlinePreview(iterable, codeEditor, cancellationTokenSource, applyCodeBlockSuggestionId);\n\t\t} catch (e) {\n\t\t\tif (!isCancellationError(e)) {\n\t\t\t\tthis.notify(localize('applyCodeBlock.error', \"Failed to apply code block: {0}\", e.message));\n\t\t\t}\n\t\t} finally {\n\t\t\tcancellationTokenSource.dispose();\n\t\t}\n\n\t\treturn {\n\t\t\teditsProposed,\n\t\t\tcodeMapper\n\t\t};\n\t}\n\n\tprivate getTextEdits(codeBlock: ICodeMapperCodeBlock, chatSessionResource: URI | undefined, token: CancellationToken): AsyncIterable<TextEdit[]> {\n\t\treturn new AsyncIterableObject<TextEdit[]>(async executor => {\n\t\t\tconst request: ICodeMapperRequest = {\n\t\t\t\tcodeBlocks: [codeBlock],\n\t\t\t\tchatSessionId: chatSessionResource && chatSessionResourceToId(chatSessionResource),\n\t\t\t};\n\t\t\tconst response: ICodeMapperResponse = {\n\t\t\t\ttextEdit: (target: URI, edit: TextEdit[]) => {\n\t\t\t\t\texecutor.emitOne(edit);\n\t\t\t\t},\n\t\t\t\tnotebookEdit(_resource, _edit) {\n\t\t\t\t\t//\n\t\t\t\t},\n\t\t\t};\n\t\t\tconst result = await this.codeMapperService.mapCode(request, response, token);\n\t\t\tif (result?.errorMessage) {\n\t\t\t\texecutor.reject(new Error(result.errorMessage));\n\t\t\t}\n\t\t});\n\t}\n\n\tprivate getNotebookEdits(codeBlock: ICodeMapperCodeBlock, chatSessionResource: URI | undefined, token: CancellationToken): AsyncIterable<[URI, TextEdit[]] | ICellEditOperation[]> {\n\t\treturn new AsyncIterableObject<[URI, TextEdit[]] | ICellEditOperation[]>(async executor => {\n\t\t\tconst request: ICodeMapperRequest = {\n\t\t\t\tcodeBlocks: [codeBlock],\n\t\t\t\tchatSessionId: chatSessionResource && chatSessionResourceToId(chatSessionResource),\n\t\t\t\tlocation: 'panel'\n\t\t\t};\n\t\t\tconst response: ICodeMapperResponse = {\n\t\t\t\ttextEdit: (target: URI, edits: TextEdit[]) => {\n\t\t\t\t\texecutor.emitOne([target, edits]);\n\t\t\t\t},\n\t\t\t\tnotebookEdit(_resource, edit) {\n\t\t\t\t\texecutor.emitOne(edit);\n\t\t\t\t},\n\t\t\t};\n\t\t\tconst result = await this.codeMapperService.mapCode(request, response, token);\n\t\t\tif (result?.errorMessage) {\n\t\t\t\texecutor.reject(new Error(result.errorMessage));\n\t\t\t}\n\t\t});\n\t}\n\n\tprivate async waitForFirstElement<T>(iterable: AsyncIterable<T>): Promise<AsyncIterable<T>> {\n\t\tconst iterator = iterable[Symbol.asyncIterator]();\n\t\tlet result = await iterator.next();\n\n\t\tif (result.done) {\n\t\t\treturn {\n\t\t\t\tasync *[Symbol.asyncIterator]() {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\n\t\treturn {\n\t\t\tasync *[Symbol.asyncIterator]() {\n\t\t\t\twhile (!result.done) {\n\t\t\t\t\tyield result.value;\n\t\t\t\t\tresult = await iterator.next();\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t}\n\n\tprivate async applyWithInlinePreview(edits: AsyncIterable<TextEdit[]>, codeEditor: IActiveCodeEditor, tokenSource: CancellationTokenSource, applyCodeBlockSuggestionId: EditSuggestionId | undefined): Promise<boolean> {\n\t\treturn this.instantiationService.invokeFunction(reviewEdits, codeEditor, edits, tokenSource.token, applyCodeBlockSuggestionId);\n\t}\n\n\tprivate async applyNotebookEditsWithInlinePreview(edits: AsyncIterable<[URI, TextEdit[]] | ICellEditOperation[]>, uri: URI, tokenSource: CancellationTokenSource): Promise<boolean> {\n\t\treturn this.instantiationService.invokeFunction(reviewNotebookEdits, uri, edits, tokenSource.token);\n\t}\n\n\tprivate tryToRevealCodeBlock(codeEditor: IActiveCodeEditor, codeBlock: string): void {\n\t\tconst match = codeBlock.match(/(\\S[^\\n]*)\\n/); // substring that starts with a non-whitespace character and ends with a newline\n\t\tif (match && match[1].length > 10) {\n\t\t\tconst findMatch = codeEditor.getModel().findNextMatch(match[1], { lineNumber: 1, column: 1 }, false, false, null, false);\n\t\t\tif (findMatch) {\n\t\t\t\tcodeEditor.revealRangeInCenter(findMatch.range);\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate notify(message: string) {\n\t\t//this.notificationService.notify({ severity: Severity.Info, message });\n\t\tthis.dialogService.info(message);\n\t}\n\n}\n\nfunction notifyUserAction(chatService: IChatService, context: ICodeBlockActionContext, action: ChatUserAction) {\n\tif (isResponseVM(context.element)) {\n\t\tchatService.notifyUserAction({\n\t\t\tagentId: context.element.agent?.id,\n\t\t\tcommand: context.element.slashCommand?.name,\n\t\t\tsessionResource: context.element.sessionResource,\n\t\t\trequestId: context.element.requestId,\n\t\t\tresult: context.element.result,\n\t\t\taction\n\t\t});\n\t}\n}\n\nfunction getActiveNotebookEditor(editorService: IEditorService): IActiveNotebookEditor | undefined {\n\tconst activeEditorPane = editorService.activeEditorPane;\n\tif (activeEditorPane?.getId() === NOTEBOOK_EDITOR_ID) {\n\t\tconst notebookEditor = activeEditorPane.getControl() as INotebookEditor;\n\t\tif (notebookEditor.hasModel()) {\n\t\t\treturn notebookEditor;\n\t\t}\n\t}\n\treturn undefined;\n}\n\nfunction getEditableActiveCodeEditor(editorService: IEditorService): IActiveCodeEditor | undefined {\n\tconst activeCodeEditorInNotebook = getActiveNotebookEditor(editorService)?.activeCodeEditor;\n\tif (activeCodeEditorInNotebook && activeCodeEditorInNotebook.hasTextFocus() && activeCodeEditorInNotebook.hasModel()) {\n\t\treturn activeCodeEditorInNotebook;\n\t}\n\n\tlet codeEditor = getCodeEditor(editorService.activeTextEditorControl);\n\tif (!codeEditor) {\n\t\tfor (const editor of editorService.visibleTextEditorControls) {\n\t\t\tcodeEditor = getCodeEditor(editor);\n\t\t\tif (codeEditor) {\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\n\tif (!codeEditor || !codeEditor.hasModel()) {\n\t\treturn undefined;\n\t}\n\treturn codeEditor;\n}\n\nfunction isReadOnly(model: ITextModel, textFileService: ITextFileService): boolean {\n\t// Check if model is editable, currently only support untitled and text file\n\tconst activeTextModel = textFileService.files.get(model.uri) ?? textFileService.untitled.get(model.uri);\n\treturn !!activeTextModel?.isReadonly();\n}\n\nfunction reindent(codeBlockContent: string, model: ITextModel, seletionStartLine: number): string {\n\tconst newContent = strings.splitLines(codeBlockContent);\n\tif (newContent.length === 0) {\n\t\treturn codeBlockContent;\n\t}\n\n\tconst formattingOptions = model.getFormattingOptions();\n\tconst codeIndentLevel = computeIndentation(model.getLineContent(seletionStartLine), formattingOptions.tabSize).level;\n\n\tconst indents = newContent.map(line => computeIndentation(line, formattingOptions.tabSize));\n\n\t// find the smallest indent level in the code block\n\tconst newContentIndentLevel = indents.reduce<number>((min, indent, index) => {\n\t\tif (indent.length !== newContent[index].length) { // ignore empty lines\n\t\t\treturn Math.min(indent.level, min);\n\t\t}\n\t\treturn min;\n\t}, Number.MAX_VALUE);\n\n\tif (newContentIndentLevel === Number.MAX_VALUE || newContentIndentLevel === codeIndentLevel) {\n\t\t// all lines are empty or the indent is already correct\n\t\treturn codeBlockContent;\n\t}\n\tconst newLines = [];\n\tfor (let i = 0; i < newContent.length; i++) {\n\t\tconst { level, length } = indents[i];\n\t\tconst newLevel = Math.max(0, codeIndentLevel + level - newContentIndentLevel);\n\t\tconst newIndentation = formattingOptions.insertSpaces ? ' '.repeat(formattingOptions.tabSize * newLevel) : '\\t'.repeat(newLevel);\n\t\tnewLines.push(newIndentation + newContent[i].substring(length));\n\t}\n\treturn newLines.join('\\n');\n}\n\n/**\n * Returns:\n *  - level: the line's the ident level in tabs\n *  - length: the number of characters of the leading whitespace\n */\nexport function computeIndentation(line: string, tabSize: number): { level: number; length: number } {\n\tlet nSpaces = 0;\n\tlet level = 0;\n\tlet i = 0;\n\tlet length = 0;\n\tconst len = line.length;\n\twhile (i < len) {\n\t\tconst chCode = line.charCodeAt(i);\n\t\tif (chCode === CharCode.Space) {\n\t\t\tnSpaces++;\n\t\t\tif (nSpaces === tabSize) {\n\t\t\t\tlevel++;\n\t\t\t\tnSpaces = 0;\n\t\t\t\tlength = i + 1;\n\t\t\t}\n\t\t} else if (chCode === CharCode.Tab) {\n\t\t\tlevel++;\n\t\t\tnSpaces = 0;\n\t\t\tlength = i + 1;\n\t\t} else {\n\t\t\tbreak;\n\t\t}\n\t\ti++;\n\t}\n\treturn { level, length };\n}\n"]}