{"version":3,"sources":["vs/workbench/contrib/chat/browser/actions/chatCopyActions.ts"],"names":[],"mappings":"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","file":"chatCopyActions.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as dom from '../../../../../base/browser/dom.js';\nimport { ServicesAccessor } from '../../../../../editor/browser/editorExtensions.js';\nimport { localize2 } from '../../../../../nls.js';\nimport { Action2, MenuId, registerAction2 } from '../../../../../platform/actions/common/actions.js';\nimport { IClipboardService } from '../../../../../platform/clipboard/common/clipboardService.js';\nimport { CHAT_CATEGORY, stringifyItem } from './chatActions.js';\nimport { ChatTreeItem, IChatWidgetService } from '../chat.js';\nimport { ChatContextKeys } from '../../common/chatContextKeys.js';\nimport { IChatRequestViewModel, IChatResponseViewModel, isChatTreeItem, isRequestVM, isResponseVM } from '../../common/chatViewModel.js';\nimport { katexContainerClassName, katexContainerLatexAttributeName } from '../../../markdown/common/markedKatexExtension.js';\n\nexport function registerChatCopyActions() {\n\tregisterAction2(class CopyAllAction extends Action2 {\n\t\tconstructor() {\n\t\t\tsuper({\n\t\t\t\tid: 'workbench.action.chat.copyAll',\n\t\t\t\ttitle: localize2('interactive.copyAll.label', \"Copy All\"),\n\t\t\t\tf1: false,\n\t\t\t\tcategory: CHAT_CATEGORY,\n\t\t\t\tmenu: {\n\t\t\t\t\tid: MenuId.ChatContext,\n\t\t\t\t\twhen: ChatContextKeys.responseIsFiltered.negate(),\n\t\t\t\t\tgroup: 'copy',\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\trun(accessor: ServicesAccessor, ...args: unknown[]) {\n\t\t\tconst clipboardService = accessor.get(IClipboardService);\n\t\t\tconst chatWidgetService = accessor.get(IChatWidgetService);\n\t\t\tconst widget = chatWidgetService.lastFocusedWidget;\n\t\t\tif (widget) {\n\t\t\t\tconst viewModel = widget.viewModel;\n\t\t\t\tconst sessionAsText = viewModel?.getItems()\n\t\t\t\t\t.filter((item): item is (IChatRequestViewModel | IChatResponseViewModel) => isRequestVM(item) || (isResponseVM(item) && !item.errorDetails?.responseIsFiltered))\n\t\t\t\t\t.map(item => stringifyItem(item))\n\t\t\t\t\t.join('\\n\\n');\n\t\t\t\tif (sessionAsText) {\n\t\t\t\t\tclipboardService.writeText(sessionAsText);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t});\n\n\tregisterAction2(class CopyItemAction extends Action2 {\n\t\tconstructor() {\n\t\t\tsuper({\n\t\t\t\tid: 'workbench.action.chat.copyItem',\n\t\t\t\ttitle: localize2('interactive.copyItem.label', \"Copy\"),\n\t\t\t\tf1: false,\n\t\t\t\tcategory: CHAT_CATEGORY,\n\t\t\t\tmenu: {\n\t\t\t\t\tid: MenuId.ChatContext,\n\t\t\t\t\twhen: ChatContextKeys.responseIsFiltered.negate(),\n\t\t\t\t\tgroup: 'copy',\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tasync run(accessor: ServicesAccessor, ...args: unknown[]) {\n\t\t\tconst chatWidgetService = accessor.get(IChatWidgetService);\n\t\t\tconst clipboardService = accessor.get(IClipboardService);\n\n\t\t\tconst widget = chatWidgetService.lastFocusedWidget;\n\t\t\tlet item = args[0] as ChatTreeItem | undefined;\n\t\t\tif (!isChatTreeItem(item)) {\n\t\t\t\titem = widget?.getFocus();\n\t\t\t\tif (!item) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// If there is a text selection, and focus is inside the widget, copy the selected text.\n\t\t\t// Otherwise, context menu with no selection -> copy the full item\n\t\t\tconst nativeSelection = dom.getActiveWindow().getSelection();\n\t\t\tconst selectedText = nativeSelection?.toString();\n\t\t\tif (widget && selectedText && selectedText.length > 0 && dom.isAncestor(dom.getActiveElement(), widget.domNode)) {\n\t\t\t\tawait clipboardService.writeText(selectedText);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst text = stringifyItem(item, false);\n\t\t\tawait clipboardService.writeText(text);\n\t\t}\n\t});\n\n\tregisterAction2(class CopyKatexMathSourceAction extends Action2 {\n\t\tconstructor() {\n\t\t\tsuper({\n\t\t\t\tid: 'workbench.action.chat.copyKatexMathSource',\n\t\t\t\ttitle: localize2('chat.copyKatexMathSource.label', \"Copy Math Source\"),\n\t\t\t\tf1: false,\n\t\t\t\tcategory: CHAT_CATEGORY,\n\t\t\t\tmenu: {\n\t\t\t\t\tid: MenuId.ChatContext,\n\t\t\t\t\tgroup: 'copy',\n\t\t\t\t\twhen: ChatContextKeys.isKatexMathElement,\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tasync run(accessor: ServicesAccessor, ...args: unknown[]) {\n\t\t\tconst chatWidgetService = accessor.get(IChatWidgetService);\n\t\t\tconst clipboardService = accessor.get(IClipboardService);\n\n\t\t\tconst widget = chatWidgetService.lastFocusedWidget;\n\t\t\tlet item = args[0] as ChatTreeItem | undefined;\n\t\t\tif (!isChatTreeItem(item)) {\n\t\t\t\titem = widget?.getFocus();\n\t\t\t\tif (!item) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Try to find a KaTeX element from the selection or active element\n\t\t\tlet selectedElement: Node | null = null;\n\n\t\t\t// If there is a selection, and focus is inside the widget, extract the inner KaTeX element.\n\t\t\tconst activeElement = dom.getActiveElement();\n\t\t\tconst nativeSelection = dom.getActiveWindow().getSelection();\n\t\t\tif (widget && nativeSelection && nativeSelection.rangeCount > 0 && dom.isAncestor(activeElement, widget.domNode)) {\n\t\t\t\tconst range = nativeSelection.getRangeAt(0);\n\t\t\t\tselectedElement = range.commonAncestorContainer;\n\n\t\t\t\t// If it's a text node, get its parent element\n\t\t\t\tif (selectedElement.nodeType === Node.TEXT_NODE) {\n\t\t\t\t\tselectedElement = selectedElement.parentElement;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Otherwise, fallback to querying from the active element\n\t\t\tif (!selectedElement) {\n\t\t\t\t// eslint-disable-next-line no-restricted-syntax\n\t\t\t\tselectedElement = activeElement?.querySelector(`.${katexContainerClassName}`) ?? null;\n\t\t\t}\n\n\t\t\t// Extract the LaTeX source from the annotation element\n\t\t\tconst katexElement = dom.isHTMLElement(selectedElement) ? selectedElement.closest(`.${katexContainerClassName}`) : null;\n\t\t\tconst latexSource = katexElement?.getAttribute(katexContainerLatexAttributeName) || '';\n\t\t\tif (latexSource) {\n\t\t\t\tawait clipboardService.writeText(latexSource);\n\t\t\t}\n\t\t}\n\t});\n}\n"]}