{"version":3,"sources":["vs/workbench/contrib/chat/browser/chatContentParts/chatToolOutputContentSubPart.ts"],"names":[],"mappings":"AAAA;;;gGAGgG;;;;;;;;;;AAEhG,OAAO,KAAK,GAAG,MAAM,oCAAoC,CAAC;AAC1D,OAAO,EAAE,OAAO,EAAE,MAAM,wCAAwC,CAAC;AACjE,OAAO,EAAE,OAAO,EAAE,MAAM,qCAAqC,CAAC;AAC9D,OAAO,EAAE,UAAU,EAAE,MAAM,yCAAyC,CAAC;AACrE,OAAO,EAAE,QAAQ,EAAE,QAAQ,EAAE,MAAM,yCAAyC,CAAC;AAE7E,OAAO,EAAE,YAAY,EAAE,MAAM,oCAAoC,CAAC;AAClE,OAAO,EAAE,QAAQ,EAAE,SAAS,EAAE,MAAM,uBAAuB,CAAC;AAC5D,OAAO,EAAE,oBAAoB,EAAE,MAAM,oDAAoD,CAAC;AAC1F,OAAO,EAAE,OAAO,EAAE,MAAM,EAAE,eAAe,EAAE,MAAM,mDAAmD,CAAC;AACrG,OAAO,EAAE,eAAe,EAAE,MAAM,qDAAqD,CAAC;AACtF,OAAO,EAAE,kBAAkB,EAAE,MAAM,yDAAyD,CAAC;AAC7F,OAAO,EAAE,mBAAmB,EAAE,MAAM,4DAA4D,CAAC;AACjG,OAAO,EAAE,kBAAkB,EAAE,MAAM,mDAAmD,CAAC;AACvF,OAAO,EAAE,YAAY,EAAE,MAAM,+CAA+C,CAAC;AAC7E,OAAO,EAAE,qBAAqB,EAAoB,MAAM,+DAA+D,CAAC;AACxH,OAAO,EAAE,aAAa,EAAE,MAAM,+CAA+C,CAAC;AAC9E,OAAO,EAAE,oBAAoB,EAAE,MAAM,6DAA6D,CAAC;AACnG,OAAO,EAAE,gBAAgB,EAAoB,MAAM,qDAAqD,CAAC;AACzG,OAAO,EAAE,wBAAwB,EAAE,MAAM,uDAAuD,CAAC;AACjG,OAAO,EAAE,6BAA6B,EAAE,MAAM,yCAAyC,CAAC;AACxF,OAAO,EAAE,2BAA2B,EAAE,MAAM,2BAA2B,CAAC;AAIxE,OAAO,EAAE,0BAA0B,EAAE,MAAM,iCAAiC,CAAC;AAK7E;;;GAGG;AACI,IAAM,4BAA4B,GAAlC,MAAM,4BAA6B,SAAQ,UAAU;IAU3D,YACkB,OAAsC,EACtC,KAA8B,EAC3B,iBAAsD,EACnD,qBAA6D,EAC/D,mBAAyD,EAChE,YAA2C;QAEzD,KAAK,EAAE,CAAC;QAPS,YAAO,GAAP,OAAO,CAA+B;QACtC,UAAK,GAAL,KAAK,CAAyB;QACV,sBAAiB,GAAjB,iBAAiB,CAAoB;QAClC,0BAAqB,GAArB,qBAAqB,CAAuB;QAC9C,wBAAmB,GAAnB,mBAAmB,CAAqB;QAC/C,iBAAY,GAAZ,YAAY,CAAc;QAfzC,uBAAkB,GAAG,IAAI,CAAC,SAAS,CAAC,IAAI,OAAO,EAAQ,CAAC,CAAC;QAC1D,sBAAiB,GAAG,IAAI,CAAC,kBAAkB,CAAC,KAAK,CAAC;QAE1D,kBAAa,GAAW,CAAC,CAAC;QACjB,sBAAiB,GAA0C,EAAE,CAAC;QAGtE,eAAU,GAAyB,EAAE,CAAC;QAW9C,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC,oBAAoB,EAAE,CAAC;QAC3C,IAAI,CAAC,aAAa,GAAG,OAAO,CAAC,YAAY,EAAE,CAAC;IAC7C,CAAC;IAEO,oBAAoB;QAC3B,MAAM,SAAS,GAAG,GAAG,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC;QAE/B,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,IAAI,CAAC,KAAK,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE,CAAC;YAC5C,MAAM,IAAI,GAAG,IAAI,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC;YAC3B,IAAI,IAAI,CAAC,IAAI,KAAK,MAAM,EAAE,CAAC;gBAC1B,IAAI,CAAC,YAAY,CAAC,IAAI,EAAE,SAAS,CAAC,CAAC;gBACnC,SAAS;YACV,CAAC;YAED,MAAM,KAAK,GAAiC,EAAE,CAAC;YAC/C,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,IAAI,CAAC,KAAK,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE,CAAC;gBAC5C,MAAM,IAAI,GAAG,IAAI,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC;gBAC3B,IAAI,IAAI,CAAC,IAAI,KAAK,MAAM,EAAE,CAAC;oBAC1B,MAAM;gBACP,CAAC;gBACD,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;YAClB,CAAC;YAED,IAAI,CAAC,gBAAgB,CAAC,KAAK,EAAE,SAAS,CAAC,CAAC;YACxC,CAAC,IAAI,KAAK,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC,+BAA+B;QACvD,CAAC;QAED,OAAO,SAAS,CAAC;IAClB,CAAC;IAEO,gBAAgB,CAAC,KAAmC,EAAE,SAAsB;QACnF,MAAM,EAAE,GAAG,GAAG,CAAC,CAAC,CAAC,qCAAqC,EAAE;YACvD,GAAG,CAAC,CAAC,CAAC,2CAA2C,CAAC;YAClD,GAAG,CAAC,CAAC,CAAC,+CAA+C,CAAC;SACtD,CAAC,CAAC;QAEH,IAAI,CAAC,mBAAmB,CAAC,KAAK,EAAE,EAAE,CAAC,KAAK,EAAE,EAAE,CAAC,OAAO,CAAC,CAAC,IAAI,CAAC,GAAG,EAAE,CAAC,IAAI,CAAC,kBAAkB,CAAC,IAAI,EAAE,CAAC,CAAC;QAEjG,SAAS,CAAC,WAAW,CAAC,EAAE,CAAC,IAAI,CAAC,CAAC;QAC/B,OAAO,EAAE,CAAC,IAAI,CAAC;IAChB,CAAC;IAEO,KAAK,CAAC,mBAAmB,CAAC,KAAmC,EAAE,cAA2B,EAAE,gBAA6B;QAChI,MAAM,OAAO,GAAG,MAAM,OAAO,CAAC,GAAG,CAAC,KAAK,CAAC,GAAG,CAAC,KAAK,EAAE,IAAI,EAAsC,EAAE;YAC9F,IAAI,IAAI,CAAC,QAAQ,IAAI,2BAA2B,CAAC,IAAI,CAAC,QAAQ,CAAC,EAAE,CAAC;gBACjE,MAAM,KAAK,GAAG,IAAI,CAAC,KAAK,IAAI,MAAM,IAAI,CAAC,YAAY,CAAC,QAAQ,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,KAAK,CAAC,MAAM,EAAE,GAAG,EAAE,CAAC,SAAS,CAAC,CAAC;gBAClH,OAAO,EAAE,IAAI,EAAE,OAAO,EAAE,EAAE,EAAE,YAAY,EAAE,EAAE,IAAI,EAAE,QAAQ,CAAC,IAAI,CAAC,GAAG,CAAC,EAAE,KAAK,EAAE,QAAQ,EAAE,IAAI,CAAC,QAAQ,EAAE,KAAK,EAAE,KAAK,EAAE,UAAU,EAAE,CAAC,EAAE,IAAI,EAAE,WAAW,EAAE,SAAS,EAAE,IAAI,CAAC,GAAG,EAAE,CAAC,EAAE,CAAC;YAChL,CAAC;iBAAM,CAAC;gBACP,OAAO,EAAE,IAAI,EAAE,MAAM,EAAE,EAAE,EAAE,YAAY,EAAE,EAAE,IAAI,EAAE,QAAQ,CAAC,IAAI,CAAC,GAAG,CAAC,EAAE,QAAQ,EAAE,IAAI,CAAC,GAAG,CAAC,IAAI,EAAE,KAAK,EAAE,IAAI,CAAC,GAAG,EAAE,CAAC;YACjH,CAAC;QACF,CAAC,CAAC,CAAC,CAAC;QAEJ,MAAM,WAAW,GAAG,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,qBAAqB,CAAC,cAAc,CAC3E,0BAA0B,EAC1B;YACC,SAAS,EAAE,OAAO;YAClB,KAAK,EAAE,CAAC;YACR,iBAAiB,EAAE,SAAS;YAC5B,OAAO,EAAE,SAAS;SAClB,CACD,CAAC,CAAC;QAEH,WAAW,CAAC,kBAAkB,GAAG,CAAC,UAAU,EAAE,KAAK,EAAE,EAAE;YACtD,MAAM,KAAK,GAAG,OAAO,CAAC,OAAO,CAAC,UAAU,CAAC,CAAC;YAC1C,MAAM,IAAI,GAAG,KAAK,CAAC,KAAK,CAAC,CAAC;YAC1B,IAAI,IAAI,EAAE,CAAC;gBACV,KAAK,CAAC,cAAc,EAAE,CAAC;gBACvB,KAAK,CAAC,eAAe,EAAE,CAAC;gBAExB,IAAI,CAAC,mBAAmB,CAAC,eAAe,CAAC;oBACxC,MAAM,EAAE,MAAM,CAAC,6BAA6B;oBAC5C,iBAAiB,EAAE,EAAE,iBAAiB,EAAE,IAAI,EAAE;oBAC9C,SAAS,EAAE,GAAG,EAAE,CAAC,CAAC,EAAE,CAAC,EAAE,KAAK,CAAC,KAAK,EAAE,CAAC,EAAE,KAAK,CAAC,KAAK,EAAE,CAAC;oBACrD,iBAAiB,EAAE,GAAG,EAAE,CAAC,CAAC,EAAE,KAAK,EAAE,CAAC,IAAI,CAAC,EAAmD,CAAA;iBAC5F,CAAC,CAAC;YACJ,CAAC;QACF,CAAC,CAAC;QAEF,cAAc,CAAC,WAAW,CAAC,WAAW,CAAC,OAAQ,CAAC,CAAC;QAEjD,MAAM,OAAO,GAAG,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,qBAAqB,CAAC,cAAc,CAAC,oBAAoB,EAAE,gBAAgB,EAAE,MAAM,CAAC,6BAA6B,EAAE;YACtJ,WAAW,EAAE;gBACZ,iBAAiB,EAAE,IAAI;aACvB;SACD,CAAC,CAAC,CAAC;QACJ,OAAO,CAAC,OAAO,GAAG,EAAE,KAAK,EAAkD,CAAC;IAC7E,CAAC;IAEO,YAAY,CAAC,IAAgC,EAAE,SAAsB;QAC5E,MAAM,IAAI,GAAmB;YAC5B,UAAU,EAAE,IAAI,CAAC,UAAU;YAC3B,SAAS,EAAE,OAAO,CAAC,OAAO,CAAC,IAAI,CAAC,SAAS,CAAC;YAC1C,cAAc,EAAE,IAAI,CAAC,aAAa,CAAC,cAAc;YACjD,kBAAkB,EAAE,CAAC;YACrB,OAAO,EAAE,IAAI,CAAC,OAAO,CAAC,OAAO;YAC7B,uBAAuB,EAAE,IAAI,CAAC,iBAAiB;YAC/C,aAAa,EAAE,IAAI,CAAC,OAAO;YAC3B,mBAAmB,EAAE,IAAI,CAAC,OAAO,CAAC,OAAO,CAAC,eAAe;SACzD,CAAC;QACF,MAAM,eAAe,GAAG,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,OAAO,CAAC,UAAU,CAAC,GAAG,EAAE,CAAC,CAAC;QACtE,eAAe,CAAC,MAAM,CAAC,MAAM,CAAC,IAAI,EAAE,IAAI,CAAC,aAAa,IAAI,GAAG,CAAC,CAAC;QAC/D,IAAI,CAAC,SAAS,CAAC,eAAe,CAAC,MAAM,CAAC,wBAAwB,CAAC,GAAG,EAAE,CAAC,IAAI,CAAC,kBAAkB,CAAC,IAAI,EAAE,CAAC,CAAC,CAAC;QACtG,SAAS,CAAC,WAAW,CAAC,eAAe,CAAC,MAAM,CAAC,OAAO,CAAC,CAAC;QACtD,IAAI,CAAC,iBAAiB,CAAC,IAAI,CAAC,eAAe,CAAC,CAAC;QAC7C,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC,IAAI,CAAC,aAAa,CAAC,CAAC;IAC1C,CAAC;IAED,MAAM,CAAC,KAAa;QACnB,IAAI,CAAC,aAAa,GAAG,KAAK,CAAC;QAC3B,IAAI,CAAC,iBAAiB,CAAC,OAAO,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,MAAM,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC,CAAC;IAC7D,CAAC;CACD,CAAA;AAlIY,4BAA4B;IAatC,WAAA,kBAAkB,CAAA;IAClB,WAAA,qBAAqB,CAAA;IACrB,WAAA,mBAAmB,CAAA;IACnB,WAAA,YAAY,CAAA;GAhBF,4BAA4B,CAkIxC;;AAQD,MAAM,mBAAoB,SAAQ,OAAO;aACjB,OAAE,GAAG,sBAAsB,CAAC;IACnD;QACC,KAAK,CAAC;YACL,EAAE,EAAE,mBAAmB,CAAC,EAAE;YAC1B,KAAK,EAAE,SAAS,CAAC,IAAoB,EAAE,YAAY,CAAC;YACpD,IAAI,EAAE,OAAO,CAAC,aAAa;YAC3B,IAAI,EAAE,CAAC;oBACN,EAAE,EAAE,MAAM,CAAC,6BAA6B;oBACxC,KAAK,EAAE,YAAY;oBACnB,KAAK,EAAE,CAAC;iBACR,EAAE;oBACF,EAAE,EAAE,MAAM,CAAC,6BAA6B;iBACxC,CAAC;SACF,CAAC,CAAC;IACJ,CAAC;IAED,KAAK,CAAC,GAAG,CAAC,QAA0B,EAAE,OAA8C;QACnF,MAAM,UAAU,GAAG,QAAQ,CAAC,GAAG,CAAC,kBAAkB,CAAC,CAAC;QACpD,MAAM,WAAW,GAAG,QAAQ,CAAC,GAAG,CAAC,YAAY,CAAC,CAAC;QAC/C,MAAM,mBAAmB,GAAG,QAAQ,CAAC,GAAG,CAAC,oBAAoB,CAAC,CAAC;QAC/D,MAAM,eAAe,GAAG,QAAQ,CAAC,GAAG,CAAC,gBAAgB,CAAC,CAAC;QACvD,MAAM,uBAAuB,GAAG,QAAQ,CAAC,GAAG,CAAC,wBAAwB,CAAC,CAAC;QACvE,MAAM,cAAc,GAAG,QAAQ,CAAC,GAAG,CAAC,eAAe,CAAC,CAAC;QACrD,MAAM,YAAY,GAAG,QAAQ,CAAC,GAAG,CAAC,aAAa,CAAC,CAAC;QACjD,MAAM,eAAe,GAAG,MAAM,UAAU,CAAC,eAAe,EAAE,CAAC;QAE3D,MAAM,QAAQ,GAAG,KAAK,EAAE,IAAgC,EAAE,QAAiB,EAAE,GAAQ,EAAE,EAAE;YACxF,MAAM,MAAM,GAAG,QAAQ,CAAC,CAAC,CAAC,QAAQ,CAAC,GAAG,EAAE,QAAQ,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC;YAClE,IAAI,CAAC;gBACJ,IAAI,IAAI,CAAC,IAAI,KAAK,MAAM,EAAE,CAAC;oBAC1B,MAAM,WAAW,CAAC,IAAI,CAAC,IAAI,CAAC,GAAG,EAAE,MAAM,EAAE,IAAI,CAAC,CAAC;gBAChD,CAAC;qBAAM,CAAC;oBACP,yDAAyD;oBACzD,MAAM,QAAQ,GAAG,MAAM,WAAW,CAAC,QAAQ,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;oBACtD,MAAM,WAAW,CAAC,SAAS,CAAC,MAAM,EAAE,QAAQ,CAAC,KAAK,CAAC,CAAC;gBACrD,CAAC;YACF,CAAC;YAAC,OAAO,CAAC,EAAE,CAAC;gBACZ,mBAAmB,CAAC,KAAK,CAAC,QAAQ,CAAC,IAA0B,EAAE,IAAyB,EAAE,QAAQ,CAAC,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC;YACnH,CAAC;QACF,CAAC,CAAC;QAEF,MAAM,YAAY,GAAG,KAAK,EAAE,UAAe,EAAE,IAA6B,EAAE,EAAE;YAC7E,MAAM,eAAe,CAAC,YAAY,CAAC;gBAClC,QAAQ,wCAA+B;gBACvC,KAAK,EAAE,KAAK;gBACZ,KAAK,EAAE,QAAQ,CAAC,IAA6B,EAAE,IAAqB,CAAC;aACrE,EAAE,KAAK,EAAC,MAAM,EAAC,EAAE;gBACjB,KAAK,MAAM,IAAI,IAAI,IAAI,EAAE,CAAC;oBACzB,MAAM,IAAI,EAAE,CAAC;oBACb,MAAM,CAAC,MAAM,CAAC,EAAE,SAAS,EAAE,CAAC,EAAE,KAAK,EAAE,IAAI,CAAC,MAAM,EAAE,CAAC,CAAC;gBACrD,CAAC;YACF,CAAC,CAAC,CAAC;YAEH,IAAI,uBAAuB,CAAC,iBAAiB,CAAC,UAAU,CAAC,EAAE,CAAC;gBAC3D,cAAc,CAAC,cAAc,CAAC,6BAA6B,EAAE,UAAU,CAAC,CAAC;YAC1E,CAAC;iBAAM,CAAC;gBACP,mBAAmB,CAAC,IAAI,CAAC,QAAQ,CAAC,IAA2B,EAAE,IAAwB,EAAE,YAAY,CAAC,WAAW,CAAC,UAAU,CAAC,CAAC,CAAC,CAAC;YACjI,CAAC;QACF,CAAC,CAAC;QAEF,IAAI,OAAO,CAAC,KAAK,CAAC,MAAM,KAAK,CAAC,EAAE,CAAC;YAChC,MAAM,IAAI,GAAG,OAAO,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC;YAC9B,MAAM,GAAG,GAAG,MAAM,UAAU,CAAC,cAAc,CAAC,QAAQ,CAAC,eAAe,EAAE,QAAQ,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC;YAC3F,IAAI,CAAC,GAAG,EAAE,CAAC;gBACV,OAAO;YACR,CAAC;YACD,MAAM,YAAY,CAAC,GAAG,EAAE,CAAC,GAAG,EAAE,CAAC,QAAQ,CAAC,IAAI,EAAE,KAAK,EAAE,GAAG,CAAC,CAAC,CAAC,CAAC;QAC7D,CAAC;aAAM,CAAC;YACP,MAAM,IAAI,GAAG,MAAM,UAAU,CAAC,cAAc,CAAC;gBAC5C,KAAK,EAAE,QAAQ,CAAC,IAA0B,EAAE,IAA+B,CAAC;gBAC5E,cAAc,EAAE,KAAK;gBACrB,gBAAgB,EAAE,IAAI;gBACtB,aAAa,EAAE,KAAK;gBACpB,UAAU,EAAE,uBAAuB,CAAC,YAAY,EAAE,CAAC,OAAO,CAAC,CAAC,CAAC,EAAE,GAAG;aAClE,CAAC,CAAC;YAEH,IAAI,CAAC,IAAI,EAAE,MAAM,EAAE,CAAC;gBACnB,OAAO;YACR,CAAC;YAED,MAAM,YAAY,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,OAAO,CAAC,KAAK,CAAC,GAAG,CAAC,IAAI,CAAC,EAAE,CAAC,GAAG,EAAE,CAAC,QAAQ,CAAC,IAAI,EAAE,IAAI,EAAE,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;QAC7F,CAAC;IACF,CAAC;;AAGF,eAAe,CAAC,mBAAmB,CAAC,CAAC","file":"chatToolOutputContentSubPart.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as dom from '../../../../../base/browser/dom.js';\nimport { Codicon } from '../../../../../base/common/codicons.js';\nimport { Emitter } from '../../../../../base/common/event.js';\nimport { Disposable } from '../../../../../base/common/lifecycle.js';\nimport { basename, joinPath } from '../../../../../base/common/resources.js';\nimport { URI } from '../../../../../base/common/uri.js';\nimport { generateUuid } from '../../../../../base/common/uuid.js';\nimport { localize, localize2 } from '../../../../../nls.js';\nimport { MenuWorkbenchToolBar } from '../../../../../platform/actions/browser/toolbar.js';\nimport { Action2, MenuId, registerAction2 } from '../../../../../platform/actions/common/actions.js';\nimport { ICommandService } from '../../../../../platform/commands/common/commands.js';\nimport { IContextKeyService } from '../../../../../platform/contextkey/common/contextkey.js';\nimport { IContextMenuService } from '../../../../../platform/contextview/browser/contextView.js';\nimport { IFileDialogService } from '../../../../../platform/dialogs/common/dialogs.js';\nimport { IFileService } from '../../../../../platform/files/common/files.js';\nimport { IInstantiationService, ServicesAccessor } from '../../../../../platform/instantiation/common/instantiation.js';\nimport { ILabelService } from '../../../../../platform/label/common/label.js';\nimport { INotificationService } from '../../../../../platform/notification/common/notification.js';\nimport { IProgressService, ProgressLocation } from '../../../../../platform/progress/common/progress.js';\nimport { IWorkspaceContextService } from '../../../../../platform/workspace/common/workspace.js';\nimport { REVEAL_IN_EXPLORER_COMMAND_ID } from '../../../files/browser/fileConstants.js';\nimport { getAttachableImageExtension } from '../../common/chatModel.js';\nimport { IChatRequestVariableEntry } from '../../common/chatVariableEntries.js';\nimport { IChatCodeBlockInfo } from '../chat.js';\nimport { CodeBlockPart, ICodeBlockData } from '../codeBlockPart.js';\nimport { ChatAttachmentsContentPart } from './chatAttachmentsContentPart.js';\nimport { IDisposableReference } from './chatCollections.js';\nimport { IChatContentPartRenderContext } from './chatContentParts.js';\nimport { ChatCollapsibleIOPart, IChatCollapsibleIOCodePart, IChatCollapsibleIODataPart } from './chatToolInputOutputContentPart.js';\n\n/**\n * A reusable component for rendering tool output consisting of code blocks and/or resources.\n * This is used by both ChatCollapsibleInputOutputContentPart and ChatToolPostExecuteConfirmationPart.\n */\nexport class ChatToolOutputContentSubPart extends Disposable {\n\tprivate readonly _onDidChangeHeight = this._register(new Emitter<void>());\n\tpublic readonly onDidChangeHeight = this._onDidChangeHeight.event;\n\n\tprivate _currentWidth: number = 0;\n\tprivate readonly _editorReferences: IDisposableReference<CodeBlockPart>[] = [];\n\tpublic readonly domNode: HTMLElement;\n\n\treadonly codeblocks: IChatCodeBlockInfo[] = [];\n\n\tconstructor(\n\t\tprivate readonly context: IChatContentPartRenderContext,\n\t\tprivate readonly parts: ChatCollapsibleIOPart[],\n\t\t@IContextKeyService private readonly contextKeyService: IContextKeyService,\n\t\t@IInstantiationService private readonly _instantiationService: IInstantiationService,\n\t\t@IContextMenuService private readonly _contextMenuService: IContextMenuService,\n\t\t@IFileService private readonly _fileService: IFileService,\n\t) {\n\t\tsuper();\n\t\tthis.domNode = this.createOutputContents();\n\t\tthis._currentWidth = context.currentWidth();\n\t}\n\n\tprivate createOutputContents(): HTMLElement {\n\t\tconst container = dom.$('div');\n\n\t\tfor (let i = 0; i < this.parts.length; i++) {\n\t\t\tconst part = this.parts[i];\n\t\t\tif (part.kind === 'code') {\n\t\t\t\tthis.addCodeBlock(part, container);\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tconst group: IChatCollapsibleIODataPart[] = [];\n\t\t\tfor (let k = i; k < this.parts.length; k++) {\n\t\t\t\tconst part = this.parts[k];\n\t\t\t\tif (part.kind !== 'data') {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tgroup.push(part);\n\t\t\t}\n\n\t\t\tthis.addResourceGroup(group, container);\n\t\t\ti += group.length - 1; // Skip the parts we just added\n\t\t}\n\n\t\treturn container;\n\t}\n\n\tprivate addResourceGroup(parts: IChatCollapsibleIODataPart[], container: HTMLElement) {\n\t\tconst el = dom.h('.chat-collapsible-io-resource-group', [\n\t\t\tdom.h('.chat-collapsible-io-resource-items@items'),\n\t\t\tdom.h('.chat-collapsible-io-resource-actions@actions'),\n\t\t]);\n\n\t\tthis.fillInResourceGroup(parts, el.items, el.actions).then(() => this._onDidChangeHeight.fire());\n\n\t\tcontainer.appendChild(el.root);\n\t\treturn el.root;\n\t}\n\n\tprivate async fillInResourceGroup(parts: IChatCollapsibleIODataPart[], itemsContainer: HTMLElement, actionsContainer: HTMLElement) {\n\t\tconst entries = await Promise.all(parts.map(async (part): Promise<IChatRequestVariableEntry> => {\n\t\t\tif (part.mimeType && getAttachableImageExtension(part.mimeType)) {\n\t\t\t\tconst value = part.value ?? await this._fileService.readFile(part.uri).then(f => f.value.buffer, () => undefined);\n\t\t\t\treturn { kind: 'image', id: generateUuid(), name: basename(part.uri), value, mimeType: part.mimeType, isURL: false, references: [{ kind: 'reference', reference: part.uri }] };\n\t\t\t} else {\n\t\t\t\treturn { kind: 'file', id: generateUuid(), name: basename(part.uri), fullName: part.uri.path, value: part.uri };\n\t\t\t}\n\t\t}));\n\n\t\tconst attachments = this._register(this._instantiationService.createInstance(\n\t\t\tChatAttachmentsContentPart,\n\t\t\t{\n\t\t\t\tvariables: entries,\n\t\t\t\tlimit: 5,\n\t\t\t\tcontentReferences: undefined,\n\t\t\t\tdomNode: undefined\n\t\t\t}\n\t\t));\n\n\t\tattachments.contextMenuHandler = (attachment, event) => {\n\t\t\tconst index = entries.indexOf(attachment);\n\t\t\tconst part = parts[index];\n\t\t\tif (part) {\n\t\t\t\tevent.preventDefault();\n\t\t\t\tevent.stopPropagation();\n\n\t\t\t\tthis._contextMenuService.showContextMenu({\n\t\t\t\t\tmenuId: MenuId.ChatToolOutputResourceContext,\n\t\t\t\t\tmenuActionOptions: { shouldForwardArgs: true },\n\t\t\t\t\tgetAnchor: () => ({ x: event.pageX, y: event.pageY }),\n\t\t\t\t\tgetActionsContext: () => ({ parts: [part] } satisfies IChatToolOutputResourceToolbarContext),\n\t\t\t\t});\n\t\t\t}\n\t\t};\n\n\t\titemsContainer.appendChild(attachments.domNode!);\n\n\t\tconst toolbar = this._register(this._instantiationService.createInstance(MenuWorkbenchToolBar, actionsContainer, MenuId.ChatToolOutputResourceToolbar, {\n\t\t\tmenuOptions: {\n\t\t\t\tshouldForwardArgs: true,\n\t\t\t},\n\t\t}));\n\t\ttoolbar.context = { parts } satisfies IChatToolOutputResourceToolbarContext;\n\t}\n\n\tprivate addCodeBlock(part: IChatCollapsibleIOCodePart, container: HTMLElement) {\n\t\tconst data: ICodeBlockData = {\n\t\t\tlanguageId: part.languageId,\n\t\t\ttextModel: Promise.resolve(part.textModel),\n\t\t\tcodeBlockIndex: part.codeBlockInfo.codeBlockIndex,\n\t\t\tcodeBlockPartIndex: 0,\n\t\t\telement: this.context.element,\n\t\t\tparentContextKeyService: this.contextKeyService,\n\t\t\trenderOptions: part.options,\n\t\t\tchatSessionResource: this.context.element.sessionResource,\n\t\t};\n\t\tconst editorReference = this._register(this.context.editorPool.get());\n\t\teditorReference.object.render(data, this._currentWidth || 300);\n\t\tthis._register(editorReference.object.onDidChangeContentHeight(() => this._onDidChangeHeight.fire()));\n\t\tcontainer.appendChild(editorReference.object.element);\n\t\tthis._editorReferences.push(editorReference);\n\t\tthis.codeblocks.push(part.codeBlockInfo);\n\t}\n\n\tlayout(width: number): void {\n\t\tthis._currentWidth = width;\n\t\tthis._editorReferences.forEach(r => r.object.layout(width));\n\t}\n}\n\ninterface IChatToolOutputResourceToolbarContext {\n\tparts: IChatCollapsibleIODataPart[];\n}\n\n\n\nclass SaveResourcesAction extends Action2 {\n\tpublic static readonly ID = 'chat.toolOutput.save';\n\tconstructor() {\n\t\tsuper({\n\t\t\tid: SaveResourcesAction.ID,\n\t\t\ttitle: localize2('chat.saveResources', \"Save As...\"),\n\t\t\ticon: Codicon.cloudDownload,\n\t\t\tmenu: [{\n\t\t\t\tid: MenuId.ChatToolOutputResourceToolbar,\n\t\t\t\tgroup: 'navigation',\n\t\t\t\torder: 1\n\t\t\t}, {\n\t\t\t\tid: MenuId.ChatToolOutputResourceContext,\n\t\t\t}]\n\t\t});\n\t}\n\n\tasync run(accessor: ServicesAccessor, context: IChatToolOutputResourceToolbarContext) {\n\t\tconst fileDialog = accessor.get(IFileDialogService);\n\t\tconst fileService = accessor.get(IFileService);\n\t\tconst notificationService = accessor.get(INotificationService);\n\t\tconst progressService = accessor.get(IProgressService);\n\t\tconst workspaceContextService = accessor.get(IWorkspaceContextService);\n\t\tconst commandService = accessor.get(ICommandService);\n\t\tconst labelService = accessor.get(ILabelService);\n\t\tconst defaultFilepath = await fileDialog.defaultFilePath();\n\n\t\tconst savePart = async (part: IChatCollapsibleIODataPart, isFolder: boolean, uri: URI) => {\n\t\t\tconst target = isFolder ? joinPath(uri, basename(part.uri)) : uri;\n\t\t\ttry {\n\t\t\t\tif (part.kind === 'data') {\n\t\t\t\t\tawait fileService.copy(part.uri, target, true);\n\t\t\t\t} else {\n\t\t\t\t\t// MCP doesn't support streaming data, so no sense trying\n\t\t\t\t\tconst contents = await fileService.readFile(part.uri);\n\t\t\t\t\tawait fileService.writeFile(target, contents.value);\n\t\t\t\t}\n\t\t\t} catch (e) {\n\t\t\t\tnotificationService.error(localize('chat.saveResources.error', \"Failed to save {0}: {1}\", basename(part.uri), e));\n\t\t\t}\n\t\t};\n\n\t\tconst withProgress = async (thenReveal: URI, todo: (() => Promise<void>)[]) => {\n\t\t\tawait progressService.withProgress({\n\t\t\t\tlocation: ProgressLocation.Notification,\n\t\t\t\tdelay: 5_000,\n\t\t\t\ttitle: localize('chat.saveResources.progress', \"Saving resources...\"),\n\t\t\t}, async report => {\n\t\t\t\tfor (const task of todo) {\n\t\t\t\t\tawait task();\n\t\t\t\t\treport.report({ increment: 1, total: todo.length });\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif (workspaceContextService.isInsideWorkspace(thenReveal)) {\n\t\t\t\tcommandService.executeCommand(REVEAL_IN_EXPLORER_COMMAND_ID, thenReveal);\n\t\t\t} else {\n\t\t\t\tnotificationService.info(localize('chat.saveResources.reveal', \"Saved resources to {0}\", labelService.getUriLabel(thenReveal)));\n\t\t\t}\n\t\t};\n\n\t\tif (context.parts.length === 1) {\n\t\t\tconst part = context.parts[0];\n\t\t\tconst uri = await fileDialog.pickFileToSave(joinPath(defaultFilepath, basename(part.uri)));\n\t\t\tif (!uri) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tawait withProgress(uri, [() => savePart(part, false, uri)]);\n\t\t} else {\n\t\t\tconst uris = await fileDialog.showOpenDialog({\n\t\t\t\ttitle: localize('chat.saveResources.title', \"Pick folder to save resources\"),\n\t\t\t\tcanSelectFiles: false,\n\t\t\t\tcanSelectFolders: true,\n\t\t\t\tcanSelectMany: false,\n\t\t\t\tdefaultUri: workspaceContextService.getWorkspace().folders[0]?.uri,\n\t\t\t});\n\n\t\t\tif (!uris?.length) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tawait withProgress(uris[0], context.parts.map(part => () => savePart(part, true, uris[0])));\n\t\t}\n\t}\n}\n\nregisterAction2(SaveResourcesAction);\n"]}