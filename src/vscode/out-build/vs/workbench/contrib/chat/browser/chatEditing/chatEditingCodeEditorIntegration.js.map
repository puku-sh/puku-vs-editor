{"version":3,"sources":["vs/workbench/contrib/chat/browser/chatEditing/chatEditingCodeEditorIntegration.ts"],"names":[],"mappings":"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","file":"chatEditingCodeEditorIntegration.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport '../media/chatEditorController.css';\n\nimport { getTotalWidth } from '../../../../../base/browser/dom.js';\nimport { Event } from '../../../../../base/common/event.js';\nimport { DisposableStore, dispose, IDisposable, toDisposable } from '../../../../../base/common/lifecycle.js';\nimport { autorun, constObservable, derived, IObservable, observableFromEvent, observableValue } from '../../../../../base/common/observable.js';\nimport { basename, isEqual } from '../../../../../base/common/resources.js';\nimport { themeColorFromId } from '../../../../../base/common/themables.js';\nimport { ICodeEditor, IOverlayWidget, IOverlayWidgetPosition, IOverlayWidgetPositionCoordinates, IViewZone, MouseTargetType } from '../../../../../editor/browser/editorBrowser.js';\nimport { observableCodeEditor } from '../../../../../editor/browser/observableCodeEditor.js';\nimport { AccessibleDiffViewer, IAccessibleDiffViewerModel } from '../../../../../editor/browser/widget/diffEditor/components/accessibleDiffViewer.js';\nimport { LineSource, renderLines, RenderOptions } from '../../../../../editor/browser/widget/diffEditor/components/diffEditorViewZones/renderLines.js';\nimport { diffAddDecoration, diffDeleteDecoration, diffWholeLineAddDecoration } from '../../../../../editor/browser/widget/diffEditor/registrations.contribution.js';\nimport { EditorOption, IEditorOptions } from '../../../../../editor/common/config/editorOptions.js';\nimport { Position } from '../../../../../editor/common/core/position.js';\nimport { Range } from '../../../../../editor/common/core/range.js';\nimport { LineRange } from '../../../../../editor/common/core/ranges/lineRange.js';\nimport { Selection } from '../../../../../editor/common/core/selection.js';\nimport { IDocumentDiff } from '../../../../../editor/common/diff/documentDiffProvider.js';\nimport { DetailedLineRangeMapping } from '../../../../../editor/common/diff/rangeMapping.js';\nimport { IEditorDecorationsCollection } from '../../../../../editor/common/editorCommon.js';\nimport { IModelDeltaDecoration, ITextModel, MinimapPosition, OverviewRulerLane, TrackedRangeStickiness } from '../../../../../editor/common/model.js';\nimport { ModelDecorationOptions } from '../../../../../editor/common/model/textModel.js';\nimport { InlineDecoration, InlineDecorationType } from '../../../../../editor/common/viewModel/inlineDecorations.js';\nimport { localize } from '../../../../../nls.js';\nimport { AccessibilitySignal, IAccessibilitySignalService } from '../../../../../platform/accessibilitySignal/browser/accessibilitySignalService.js';\nimport { HiddenItemStrategy, MenuWorkbenchToolBar } from '../../../../../platform/actions/browser/toolbar.js';\nimport { MenuId } from '../../../../../platform/actions/common/actions.js';\nimport { TextEditorSelectionRevealType } from '../../../../../platform/editor/common/editor.js';\nimport { IInstantiationService } from '../../../../../platform/instantiation/common/instantiation.js';\nimport { EditorsOrder, IEditorIdentifier, isDiffEditorInput } from '../../../../common/editor.js';\nimport { IEditorService } from '../../../../services/editor/common/editorService.js';\nimport { minimapGutterAddedBackground, minimapGutterDeletedBackground, minimapGutterModifiedBackground, overviewRulerAddedForeground, overviewRulerDeletedForeground, overviewRulerModifiedForeground } from '../../../scm/common/quickDiff.js';\nimport { IModifiedFileEntry, IModifiedFileEntryChangeHunk, IModifiedFileEntryEditorIntegration, ModifiedFileEntryState } from '../../common/chatEditingService.js';\nimport { isTextDiffEditorForEntry } from './chatEditing.js';\nimport { ActionViewItem } from '../../../../../base/browser/ui/actionbar/actionViewItems.js';\nimport { IContextKeyService } from '../../../../../platform/contextkey/common/contextkey.js';\nimport { ctxCursorInChangeRange } from './chatEditingEditorContextKeys.js';\nimport { LinkedList } from '../../../../../base/common/linkedList.js';\n\nexport interface IDocumentDiff2 extends IDocumentDiff {\n\n\toriginalModel: ITextModel;\n\tmodifiedModel: ITextModel;\n\n\tkeep(changes: DetailedLineRangeMapping): Promise<boolean>;\n\tundo(changes: DetailedLineRangeMapping): Promise<boolean>;\n}\n\nclass ObjectPool<T extends IDisposable> {\n\n\tprivate readonly _free = new LinkedList<T>();\n\n\tdispose(): void {\n\t\tdispose(this._free);\n\t}\n\n\tget(): T | undefined {\n\t\treturn this._free.shift();\n\t}\n\n\tputBack(obj: T): void {\n\t\tthis._free.push(obj);\n\t}\n\n\tget free(): Iterable<T> {\n\t\treturn this._free;\n\t}\n}\n\nexport class ChatEditingCodeEditorIntegration implements IModifiedFileEntryEditorIntegration {\n\n\tprivate static readonly _diffLineDecorationData = ModelDecorationOptions.register({ description: 'diff-line-decoration' });\n\n\tprivate readonly _currentIndex = observableValue(this, -1);\n\treadonly currentIndex: IObservable<number> = this._currentIndex;\n\tprivate readonly _store = new DisposableStore();\n\n\tprivate readonly _diffLineDecorations: IEditorDecorationsCollection;\n\tprivate readonly _diffVisualDecorations: IEditorDecorationsCollection;\n\tprivate readonly _diffHunksRenderStore = this._store.add(new DisposableStore());\n\tprivate readonly _diffHunkWidgetPool = this._store.add(new ObjectPool<DiffHunkWidget>());\n\tprivate readonly _diffHunkWidgets: DiffHunkWidget[] = [];\n\tprivate _viewZones: string[] = [];\n\n\tprivate readonly _accessibleDiffViewVisible = observableValue<boolean>(this, false);\n\n\tconstructor(\n\t\tprivate readonly _entry: IModifiedFileEntry,\n\t\tprivate readonly _editor: ICodeEditor,\n\t\tdocumentDiffInfo: IObservable<IDocumentDiff2>,\n\t\trenderDiffImmediately: boolean,\n\t\t@IEditorService private readonly _editorService: IEditorService,\n\t\t@IAccessibilitySignalService private readonly _accessibilitySignalsService: IAccessibilitySignalService,\n\t\t@IContextKeyService contextKeyService: IContextKeyService,\n\t\t@IInstantiationService instantiationService: IInstantiationService,\n\t) {\n\t\tthis._diffLineDecorations = _editor.createDecorationsCollection();\n\t\tconst codeEditorObs = observableCodeEditor(_editor);\n\n\t\tthis._diffLineDecorations = this._editor.createDecorationsCollection(); // tracks the line range w/o visuals (used for navigate)\n\t\tthis._diffVisualDecorations = this._editor.createDecorationsCollection(); // tracks the real diff with character level inserts\n\n\t\tconst enabledObs = derived(r => {\n\t\t\tif (!isEqual(codeEditorObs.model.read(r)?.uri, documentDiffInfo.read(r).modifiedModel.uri)) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tif (this._editor.getOption(EditorOption.inDiffEditor) && !instantiationService.invokeFunction(isTextDiffEditorForEntry, _entry, this._editor)) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\treturn true;\n\t\t});\n\n\n\t\t// update decorations\n\t\tthis._store.add(autorun(r => {\n\n\t\t\tif (!enabledObs.read(r)) {\n\t\t\t\tthis._diffLineDecorations.clear();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst data: IModelDeltaDecoration[] = [];\n\t\t\tconst diff = documentDiffInfo.read(r);\n\t\t\tfor (const diffEntry of diff.changes) {\n\t\t\t\tdata.push({\n\t\t\t\t\trange: diffEntry.modified.toInclusiveRange() ?? new Range(diffEntry.modified.startLineNumber, 1, diffEntry.modified.startLineNumber, Number.MAX_SAFE_INTEGER),\n\t\t\t\t\toptions: ChatEditingCodeEditorIntegration._diffLineDecorationData\n\t\t\t\t});\n\t\t\t}\n\t\t\tthis._diffLineDecorations.set(data);\n\t\t}));\n\n\t\t// INIT current index when: enabled, not streaming anymore, once per request, and when having changes\n\t\tlet lastModifyingRequestId: string | undefined;\n\t\tthis._store.add(autorun(r => {\n\n\t\t\tif (enabledObs.read(r)\n\t\t\t\t&& !_entry.isCurrentlyBeingModifiedBy.read(r)\n\t\t\t\t&& lastModifyingRequestId !== _entry.lastModifyingRequestId\n\t\t\t\t&& !documentDiffInfo.read(r).identical\n\t\t\t) {\n\t\t\t\tlastModifyingRequestId = _entry.lastModifyingRequestId;\n\t\t\t\tconst position = _editor.getPosition() ?? new Position(1, 1);\n\t\t\t\tconst ranges = this._diffLineDecorations.getRanges();\n\t\t\t\tlet initialIndex = ranges.findIndex(r => r.containsPosition(position));\n\t\t\t\tif (initialIndex < 0) {\n\t\t\t\t\tinitialIndex = 0;\n\t\t\t\t\tfor (; initialIndex < ranges.length - 1; initialIndex++) {\n\t\t\t\t\t\tconst range = ranges[initialIndex];\n\t\t\t\t\t\tif (range.endLineNumber >= position.lineNumber) {\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tthis._currentIndex.set(initialIndex, undefined);\n\t\t\t\t_editor.revealRange(ranges[initialIndex]);\n\t\t\t}\n\t\t}));\n\n\t\t// render diff decorations\n\t\tthis._store.add(autorun(r => {\n\n\t\t\tif (!enabledObs.read(r)) {\n\t\t\t\tthis._clearDiffRendering();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// done: render diff\n\t\t\tif (!_entry.isCurrentlyBeingModifiedBy.read(r) || renderDiffImmediately) {\n\t\t\t\tconst isDiffEditor = this._editor.getOption(EditorOption.inDiffEditor);\n\n\t\t\t\tcodeEditorObs.getOption(EditorOption.fontInfo).read(r);\n\t\t\t\tcodeEditorObs.getOption(EditorOption.lineHeight).read(r);\n\n\t\t\t\tconst reviewMode = _entry.reviewMode.read(r);\n\t\t\t\tconst diff = documentDiffInfo.read(r);\n\t\t\t\tthis._updateDiffRendering(diff, reviewMode, isDiffEditor);\n\t\t\t}\n\t\t}));\n\n\t\tconst _ctxCursorInChangeRange = ctxCursorInChangeRange.bindTo(contextKeyService);\n\n\t\t// accessibility: signals while cursor changes\n\t\t// ctx: cursor in change range\n\t\tthis._store.add(autorun(r => {\n\t\t\tconst position = codeEditorObs.positions.read(r)?.at(0);\n\t\t\tif (!position || !enabledObs.read(r)) {\n\t\t\t\t_ctxCursorInChangeRange.reset();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst diff = documentDiffInfo.read(r);\n\t\t\tconst changeAtCursor = diff.changes.find(m => m.modified.contains(position.lineNumber) || m.modified.isEmpty && m.modified.startLineNumber === position.lineNumber);\n\n\t\t\t_ctxCursorInChangeRange.set(!!changeAtCursor);\n\n\t\t\tif (changeAtCursor) {\n\t\t\t\tlet signal: AccessibilitySignal;\n\t\t\t\tif (changeAtCursor.modified.isEmpty) {\n\t\t\t\t\tsignal = AccessibilitySignal.diffLineDeleted;\n\t\t\t\t} else if (changeAtCursor.original.isEmpty) {\n\t\t\t\t\tsignal = AccessibilitySignal.diffLineInserted;\n\t\t\t\t} else {\n\t\t\t\t\tsignal = AccessibilitySignal.diffLineModified;\n\t\t\t\t}\n\t\t\t\tthis._accessibilitySignalsService.playSignal(signal, { source: 'chatEditingEditor.cursorPositionChanged' });\n\t\t\t}\n\t\t}));\n\n\t\t// accessibility: diff view\n\t\tthis._store.add(autorun(r => {\n\n\t\t\tconst visible = this._accessibleDiffViewVisible.read(r);\n\n\t\t\tif (!visible || !enabledObs.read(r)) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst accessibleDiffWidget = new AccessibleDiffViewContainer();\n\t\t\t_editor.addOverlayWidget(accessibleDiffWidget);\n\t\t\tr.store.add(toDisposable(() => _editor.removeOverlayWidget(accessibleDiffWidget)));\n\n\t\t\tr.store.add(instantiationService.createInstance(\n\t\t\t\tAccessibleDiffViewer,\n\t\t\t\taccessibleDiffWidget.getDomNode(),\n\t\t\t\tenabledObs,\n\t\t\t\t(visible, tx) => this._accessibleDiffViewVisible.set(visible, tx),\n\t\t\t\tconstObservable(true),\n\t\t\t\tcodeEditorObs.layoutInfo.map((v, r) => v.width),\n\t\t\t\tcodeEditorObs.layoutInfo.map((v, r) => v.height),\n\t\t\t\tdocumentDiffInfo.map(diff => diff.changes.slice()),\n\t\t\t\tinstantiationService.createInstance(AccessibleDiffViewerModel, documentDiffInfo, _editor),\n\t\t\t));\n\t\t}));\n\n\n\t\t// ---- readonly while streaming\n\n\t\tlet actualOptions: IEditorOptions | undefined;\n\n\t\tconst restoreActualOptions = () => {\n\t\t\tif (actualOptions !== undefined) {\n\t\t\t\tthis._editor.updateOptions(actualOptions);\n\t\t\t\tactualOptions = undefined;\n\t\t\t}\n\t\t};\n\n\t\tthis._store.add(toDisposable(restoreActualOptions));\n\n\t\tconst renderAsBeingModified = derived(this, r => {\n\t\t\treturn enabledObs.read(r) && Boolean(_entry.isCurrentlyBeingModifiedBy.read(r));\n\t\t});\n\n\t\tthis._store.add(autorun(r => {\n\t\t\tconst value = renderAsBeingModified.read(r);\n\t\t\tif (value) {\n\n\t\t\t\tactualOptions ??= {\n\t\t\t\t\treadOnly: this._editor.getOption(EditorOption.readOnly),\n\t\t\t\t\tstickyScroll: this._editor.getOption(EditorOption.stickyScroll),\n\t\t\t\t\tcodeLens: this._editor.getOption(EditorOption.codeLens),\n\t\t\t\t\tguides: this._editor.getOption(EditorOption.guides)\n\t\t\t\t};\n\n\t\t\t\tthis._editor.updateOptions({\n\t\t\t\t\treadOnly: true,\n\t\t\t\t\tstickyScroll: { enabled: false },\n\t\t\t\t\tcodeLens: false,\n\t\t\t\t\tguides: { indentation: false, bracketPairs: false }\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\trestoreActualOptions();\n\t\t\t}\n\t\t}));\n\t}\n\n\tdispose(): void {\n\t\tthis._clear();\n\t\tthis._store.dispose();\n\t}\n\n\tprivate _clear() {\n\t\tthis._diffLineDecorations.clear();\n\t\tthis._clearDiffRendering();\n\t\tthis._currentIndex.set(-1, undefined);\n\t}\n\n\t// ---- diff rendering logic\n\n\tprivate _clearDiffRendering() {\n\t\tthis._editor.changeViewZones((viewZoneChangeAccessor) => {\n\t\t\tfor (const id of this._viewZones) {\n\t\t\t\tviewZoneChangeAccessor.removeZone(id);\n\t\t\t}\n\t\t});\n\t\tthis._viewZones = [];\n\t\tthis._diffHunksRenderStore.clear();\n\t\tfor (const widget of this._diffHunkWidgetPool.free) {\n\t\t\twidget.remove();\n\t\t}\n\t\tthis._diffVisualDecorations.clear();\n\t}\n\n\tprivate _updateDiffRendering(diff: IDocumentDiff2, reviewMode: boolean, diffMode: boolean): void {\n\n\t\tconst chatDiffAddDecoration = ModelDecorationOptions.createDynamic({\n\t\t\t...diffAddDecoration,\n\t\t\tstickiness: TrackedRangeStickiness.NeverGrowsWhenTypingAtEdges\n\t\t});\n\t\tconst chatDiffWholeLineAddDecoration = ModelDecorationOptions.createDynamic({\n\t\t\t...diffWholeLineAddDecoration,\n\t\t\tstickiness: TrackedRangeStickiness.NeverGrowsWhenTypingAtEdges,\n\t\t});\n\t\tconst createOverviewDecoration = (overviewRulerColor: string, minimapColor: string) => {\n\t\t\treturn ModelDecorationOptions.createDynamic({\n\t\t\t\tdescription: 'chat-editing-decoration',\n\t\t\t\toverviewRuler: { color: themeColorFromId(overviewRulerColor), position: OverviewRulerLane.Left },\n\t\t\t\tminimap: { color: themeColorFromId(minimapColor), position: MinimapPosition.Gutter },\n\t\t\t});\n\t\t};\n\t\tconst modifiedDecoration = createOverviewDecoration(overviewRulerModifiedForeground, minimapGutterModifiedBackground);\n\t\tconst addedDecoration = createOverviewDecoration(overviewRulerAddedForeground, minimapGutterAddedBackground);\n\t\tconst deletedDecoration = createOverviewDecoration(overviewRulerDeletedForeground, minimapGutterDeletedBackground);\n\n\t\tthis._diffHunksRenderStore.clear();\n\t\tthis._diffHunkWidgets.length = 0;\n\t\tconst diffHunkDecorations: IModelDeltaDecoration[] = [];\n\n\t\tthis._editor.changeViewZones((viewZoneChangeAccessor) => {\n\t\t\tfor (const id of this._viewZones) {\n\t\t\t\tviewZoneChangeAccessor.removeZone(id);\n\t\t\t}\n\t\t\tthis._viewZones = [];\n\t\t\tconst modifiedVisualDecorations: IModelDeltaDecoration[] = [];\n\t\t\tconst mightContainNonBasicASCII = diff.originalModel.mightContainNonBasicASCII();\n\t\t\tconst mightContainRTL = diff.originalModel.mightContainRTL();\n\t\t\tconst renderOptions = RenderOptions.fromEditor(this._editor);\n\t\t\tconst editorLineCount = this._editor.getModel()?.getLineCount();\n\n\t\t\tfor (const diffEntry of diff.changes) {\n\n\t\t\t\tconst originalRange = diffEntry.original;\n\t\t\t\tdiff.originalModel.tokenization.forceTokenization(Math.max(1, originalRange.endLineNumberExclusive - 1));\n\t\t\t\tconst source = new LineSource(\n\t\t\t\t\toriginalRange.mapToLineArray(l => diff.originalModel.tokenization.getLineTokens(l)),\n\t\t\t\t\t[],\n\t\t\t\t\tmightContainNonBasicASCII,\n\t\t\t\t\tmightContainRTL,\n\t\t\t\t);\n\t\t\t\tconst decorations: InlineDecoration[] = [];\n\n\t\t\t\tif (reviewMode) {\n\t\t\t\t\tfor (const i of diffEntry.innerChanges || []) {\n\t\t\t\t\t\tdecorations.push(new InlineDecoration(\n\t\t\t\t\t\t\ti.originalRange.delta(-(diffEntry.original.startLineNumber - 1)),\n\t\t\t\t\t\t\tdiffDeleteDecoration.className!,\n\t\t\t\t\t\t\tInlineDecorationType.Regular\n\t\t\t\t\t\t));\n\n\t\t\t\t\t\t// If the original range is empty, the start line number is 1 and the new range spans the entire file, don't draw an Added decoration\n\t\t\t\t\t\tif (!(i.originalRange.isEmpty() && i.originalRange.startLineNumber === 1 && i.modifiedRange.endLineNumber === editorLineCount) && !i.modifiedRange.isEmpty()) {\n\t\t\t\t\t\t\tmodifiedVisualDecorations.push({\n\t\t\t\t\t\t\t\trange: i.modifiedRange, options: chatDiffAddDecoration\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Render an added decoration but don't also render a deleted decoration for newly inserted content at the start of the file\n\t\t\t\t// Note, this is a workaround for the `LineRange.isEmpty()` in diffEntry.original being `false` for newly inserted content\n\t\t\t\tconst isCreatedContent = decorations.length === 1 && decorations[0].range.isEmpty() && diffEntry.original.startLineNumber === 1;\n\n\t\t\t\tif (!diffEntry.modified.isEmpty) {\n\t\t\t\t\tmodifiedVisualDecorations.push({\n\t\t\t\t\t\trange: diffEntry.modified.toInclusiveRange()!,\n\t\t\t\t\t\toptions: chatDiffWholeLineAddDecoration\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tif (diffEntry.original.isEmpty) {\n\t\t\t\t\t// insertion\n\t\t\t\t\tmodifiedVisualDecorations.push({\n\t\t\t\t\t\trange: diffEntry.modified.toInclusiveRange()!,\n\t\t\t\t\t\toptions: addedDecoration\n\t\t\t\t\t});\n\t\t\t\t} else if (diffEntry.modified.isEmpty) {\n\t\t\t\t\t// deletion\n\t\t\t\t\tmodifiedVisualDecorations.push({\n\t\t\t\t\t\trange: new Range(diffEntry.modified.startLineNumber - 1, 1, diffEntry.modified.startLineNumber, 1),\n\t\t\t\t\t\toptions: deletedDecoration\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\t// modification\n\t\t\t\t\tmodifiedVisualDecorations.push({\n\t\t\t\t\t\trange: diffEntry.modified.toInclusiveRange()!,\n\t\t\t\t\t\toptions: modifiedDecoration\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tlet extraLines = 0;\n\t\t\t\tif (reviewMode && !diffMode) {\n\t\t\t\t\tconst domNode = document.createElement('div');\n\t\t\t\t\tdomNode.className = 'chat-editing-original-zone view-lines line-delete monaco-mouse-cursor-text';\n\t\t\t\t\tconst result = renderLines(source, renderOptions, decorations, domNode);\n\t\t\t\t\textraLines = result.heightInLines;\n\t\t\t\t\tif (!isCreatedContent) {\n\n\t\t\t\t\t\tconst viewZoneData: IViewZone = {\n\t\t\t\t\t\t\tafterLineNumber: diffEntry.modified.startLineNumber - 1,\n\t\t\t\t\t\t\theightInLines: result.heightInLines,\n\t\t\t\t\t\t\tdomNode,\n\t\t\t\t\t\t\tordinal: 50000 + 2 // more than https://github.com/microsoft/vscode/blob/bf52a5cfb2c75a7327c9adeaefbddc06d529dcad/src/vs/workbench/contrib/inlineChat/browser/inlineChatZoneWidget.ts#L42\n\t\t\t\t\t\t};\n\n\t\t\t\t\t\tthis._viewZones.push(viewZoneChangeAccessor.addZone(viewZoneData));\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (reviewMode || diffMode) {\n\n\t\t\t\t\t// Add content widget for each diff change\n\t\t\t\t\tlet widget = this._diffHunkWidgetPool.get();\n\t\t\t\t\tif (!widget) {\n\t\t\t\t\t\t// make a new one\n\t\t\t\t\t\twidget = this._editor.invokeWithinContext(accessor => {\n\t\t\t\t\t\t\tconst instaService = accessor.get(IInstantiationService);\n\t\t\t\t\t\t\treturn instaService.createInstance(DiffHunkWidget, this._editor, diff, diffEntry, this._editor.getModel()!.getVersionId(), isCreatedContent ? 0 : extraLines);\n\t\t\t\t\t\t});\n\t\t\t\t\t} else {\n\t\t\t\t\t\twidget.update(diff, diffEntry, this._editor.getModel()!.getVersionId(), isCreatedContent ? 0 : extraLines);\n\t\t\t\t\t}\n\t\t\t\t\tthis._diffHunksRenderStore.add(toDisposable(() => {\n\t\t\t\t\t\tthis._diffHunkWidgetPool.putBack(widget);\n\t\t\t\t\t}));\n\n\t\t\t\t\twidget.layout(diffEntry.modified.startLineNumber);\n\n\t\t\t\t\tthis._diffHunkWidgets.push(widget);\n\t\t\t\t\tdiffHunkDecorations.push({\n\t\t\t\t\t\trange: diffEntry.modified.toInclusiveRange() ?? new Range(diffEntry.modified.startLineNumber, 1, diffEntry.modified.startLineNumber, Number.MAX_SAFE_INTEGER),\n\t\t\t\t\t\toptions: {\n\t\t\t\t\t\t\tdescription: 'diff-hunk-widget',\n\t\t\t\t\t\t\tstickiness: TrackedRangeStickiness.AlwaysGrowsWhenTypingAtEdges\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis._diffVisualDecorations.set(!diffMode ? modifiedVisualDecorations : []);\n\t\t});\n\n\t\tconst diffHunkDecoCollection = this._editor.createDecorationsCollection(diffHunkDecorations);\n\n\t\tthis._diffHunksRenderStore.add(toDisposable(() => {\n\t\t\tdiffHunkDecoCollection.clear();\n\t\t}));\n\n\t\t// HIDE pooled widgets that are not used\n\t\tfor (const extraWidget of this._diffHunkWidgetPool.free) {\n\t\t\textraWidget.remove();\n\t\t}\n\n\t\tconst positionObs = observableFromEvent(this._editor.onDidChangeCursorPosition, _ => this._editor.getPosition());\n\n\t\tconst activeWidgetIdx = derived(r => {\n\t\t\tconst position = positionObs.read(r);\n\t\t\tif (!position) {\n\t\t\t\treturn -1;\n\t\t\t}\n\t\t\tconst idx = diffHunkDecoCollection.getRanges().findIndex(r => r.containsPosition(position));\n\t\t\treturn idx;\n\t\t});\n\t\tconst toggleWidget = (activeWidget: DiffHunkWidget | undefined) => {\n\t\t\tconst positionIdx = activeWidgetIdx.get();\n\t\t\tfor (let i = 0; i < this._diffHunkWidgets.length; i++) {\n\t\t\t\tconst widget = this._diffHunkWidgets[i];\n\t\t\t\twidget.toggle(widget === activeWidget || i === positionIdx);\n\t\t\t}\n\t\t};\n\n\t\tthis._diffHunksRenderStore.add(autorun(r => {\n\t\t\t// reveal when cursor inside\n\t\t\tconst idx = activeWidgetIdx.read(r);\n\t\t\tconst widget = this._diffHunkWidgets[idx];\n\t\t\ttoggleWidget(widget);\n\t\t}));\n\n\n\t\tthis._diffHunksRenderStore.add(this._editor.onMouseUp(e => {\n\t\t\t// set approximate position when clicking on view zone\n\t\t\tif (e.target.type === MouseTargetType.CONTENT_VIEW_ZONE) {\n\t\t\t\tconst zone = e.target.detail;\n\t\t\t\tconst idx = this._viewZones.findIndex(id => id === zone.viewZoneId);\n\t\t\t\tif (idx >= 0) {\n\t\t\t\t\tthis._editor.setPosition(e.target.position);\n\t\t\t\t\tthis._editor.focus();\n\t\t\t\t}\n\t\t\t}\n\t\t}));\n\n\t\tthis._diffHunksRenderStore.add(this._editor.onMouseMove(e => {\n\n\t\t\t// reveal when hovering over\n\t\t\tif (e.target.type === MouseTargetType.OVERLAY_WIDGET) {\n\t\t\t\tconst id = e.target.detail;\n\t\t\t\tconst widget = this._diffHunkWidgets.find(w => w.getId() === id);\n\t\t\t\ttoggleWidget(widget);\n\n\t\t\t} else if (e.target.type === MouseTargetType.CONTENT_VIEW_ZONE) {\n\t\t\t\tconst zone = e.target.detail;\n\t\t\t\tconst idx = this._viewZones.findIndex(id => id === zone.viewZoneId);\n\t\t\t\ttoggleWidget(this._diffHunkWidgets[idx]);\n\n\t\t\t} else if (e.target.position) {\n\t\t\t\tconst { position } = e.target;\n\t\t\t\tconst idx = diffHunkDecoCollection.getRanges().findIndex(r => r.containsPosition(position));\n\t\t\t\ttoggleWidget(this._diffHunkWidgets[idx]);\n\n\t\t\t} else {\n\t\t\t\ttoggleWidget(undefined);\n\t\t\t}\n\t\t}));\n\n\t\tthis._diffHunksRenderStore.add(Event.any(this._editor.onDidScrollChange, this._editor.onDidLayoutChange)(() => {\n\t\t\tfor (let i = 0; i < this._diffHunkWidgets.length; i++) {\n\t\t\t\tconst widget = this._diffHunkWidgets[i];\n\t\t\t\tconst range = diffHunkDecoCollection.getRange(i);\n\t\t\t\tif (range) {\n\t\t\t\t\twidget.layout(range?.startLineNumber);\n\t\t\t\t} else {\n\t\t\t\t\twidget.dispose();\n\t\t\t\t}\n\t\t\t}\n\t\t}));\n\t}\n\n\tenableAccessibleDiffView(): void {\n\t\tthis._accessibleDiffViewVisible.set(true, undefined);\n\t}\n\n\t// ---- navigation logic\n\n\treveal(firstOrLast: boolean, preserveFocus?: boolean): void {\n\n\t\tconst decorations = this._diffLineDecorations\n\t\t\t.getRanges()\n\t\t\t.sort((a, b) => Range.compareRangesUsingStarts(a, b));\n\n\t\tconst index = firstOrLast ? 0 : decorations.length - 1;\n\t\tconst range = decorations.at(index);\n\t\tif (range) {\n\t\t\tthis._editor.setPosition(range.getStartPosition());\n\t\t\tthis._editor.revealRange(range);\n\t\t\tif (!preserveFocus) {\n\t\t\t\tthis._editor.focus();\n\t\t\t}\n\t\t\tthis._currentIndex.set(index, undefined);\n\t\t}\n\t}\n\n\tnext(wrap: boolean): boolean {\n\t\treturn this._reveal(true, !wrap);\n\t}\n\n\tprevious(wrap: boolean): boolean {\n\t\treturn this._reveal(false, !wrap);\n\t}\n\n\tprivate _reveal(next: boolean, strict: boolean) {\n\n\t\tconst position = this._editor.getPosition();\n\t\tif (!position) {\n\t\t\tthis._currentIndex.set(-1, undefined);\n\t\t\treturn false;\n\t\t}\n\n\t\tconst decorations = this._diffLineDecorations\n\t\t\t.getRanges()\n\t\t\t.sort((a, b) => Range.compareRangesUsingStarts(a, b));\n\n\t\tif (decorations.length === 0) {\n\t\t\tthis._currentIndex.set(-1, undefined);\n\t\t\treturn false;\n\t\t}\n\n\t\tlet newIndex: number = -1;\n\t\tfor (let i = 0; i < decorations.length; i++) {\n\t\t\tconst range = decorations[i];\n\t\t\tif (range.containsPosition(position)) {\n\t\t\t\tnewIndex = i + (next ? 1 : -1);\n\t\t\t\tbreak;\n\t\t\t} else if (Position.isBefore(position, range.getStartPosition())) {\n\t\t\t\tnewIndex = next ? i : i - 1;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\tif (strict && (newIndex < 0 || newIndex >= decorations.length)) {\n\t\t\t// NO change\n\t\t\treturn false;\n\t\t}\n\n\t\tnewIndex = (newIndex + decorations.length) % decorations.length;\n\n\t\tthis._currentIndex.set(newIndex, undefined);\n\n\t\tconst targetRange = decorations[newIndex];\n\t\tconst targetPosition = next ? targetRange.getStartPosition() : targetRange.getEndPosition();\n\t\tthis._editor.setPosition(targetPosition);\n\t\tthis._editor.revealPositionInCenter(targetRange.getStartPosition().delta(-1));\n\t\tthis._editor.focus();\n\n\t\treturn true;\n\t}\n\n\t// --- hunks\n\n\tprivate _findClosestWidget(): DiffHunkWidget | undefined {\n\t\tif (!this._editor.hasModel()) {\n\t\t\treturn undefined;\n\t\t}\n\t\tconst lineRelativeTop = this._editor.getTopForLineNumber(this._editor.getPosition().lineNumber) - this._editor.getScrollTop();\n\t\tlet closestWidget: DiffHunkWidget | undefined;\n\t\tlet closestDistance = Number.MAX_VALUE;\n\n\t\tfor (const widget of this._diffHunkWidgets) {\n\t\t\tconst widgetTop = (<IOverlayWidgetPositionCoordinates | undefined>widget.getPosition()?.preference)?.top;\n\t\t\tif (widgetTop !== undefined) {\n\t\t\t\tconst distance = Math.abs(widgetTop - lineRelativeTop);\n\t\t\t\tif (distance < closestDistance) {\n\t\t\t\t\tclosestDistance = distance;\n\t\t\t\t\tclosestWidget = widget;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn closestWidget;\n\t}\n\n\tasync rejectNearestChange(closestWidget?: IModifiedFileEntryChangeHunk): Promise<void> {\n\t\tclosestWidget = closestWidget ?? this._findClosestWidget();\n\t\tif (closestWidget instanceof DiffHunkWidget) {\n\t\t\tawait closestWidget.reject();\n\t\t\tthis.next(true);\n\t\t}\n\t}\n\n\tasync acceptNearestChange(closestWidget?: IModifiedFileEntryChangeHunk): Promise<void> {\n\t\tclosestWidget = closestWidget ?? this._findClosestWidget();\n\t\tif (closestWidget instanceof DiffHunkWidget) {\n\t\t\tawait closestWidget.accept();\n\t\t\tthis.next(true);\n\t\t}\n\t}\n\n\tasync toggleDiff(widget: IModifiedFileEntryChangeHunk | undefined, show?: boolean): Promise<void> {\n\t\tif (!this._editor.hasModel()) {\n\t\t\treturn;\n\t\t}\n\n\t\tlet selection = this._editor.getSelection();\n\t\tif (widget instanceof DiffHunkWidget) {\n\t\t\tconst lineNumber = widget.getStartLineNumber();\n\t\t\tconst position = lineNumber ? new Position(lineNumber, 1) : undefined;\n\t\t\tif (position && !selection.containsPosition(position)) {\n\t\t\t\tselection = Selection.fromPositions(position);\n\t\t\t}\n\t\t}\n\n\t\tconst isDiffEditor = this._editor.getOption(EditorOption.inDiffEditor);\n\n\t\t// Use the 'show' argument to control the diff state if provided\n\t\tif (show !== undefined ? show : !isDiffEditor) {\n\t\t\t// Open DIFF editor\n\t\t\tconst diffEditor = await this._editorService.openEditor({\n\t\t\t\toriginal: { resource: this._entry.originalURI },\n\t\t\t\tmodified: { resource: this._entry.modifiedURI },\n\t\t\t\toptions: { selection },\n\t\t\t\tlabel: localize('diff.generic', '{0} (changes from chat)', basename(this._entry.modifiedURI))\n\t\t\t});\n\n\t\t\tif (diffEditor && diffEditor.input) {\n\t\t\t\tdiffEditor.getControl()?.setSelection(selection);\n\t\t\t\tconst d = autorun(r => {\n\t\t\t\t\tconst state = this._entry.state.read(r);\n\t\t\t\t\tif (state === ModifiedFileEntryState.Accepted || state === ModifiedFileEntryState.Rejected) {\n\t\t\t\t\t\td.dispose();\n\t\t\t\t\t\tconst editorIdents: IEditorIdentifier[] = [];\n\t\t\t\t\t\tfor (const candidate of this._editorService.getEditors(EditorsOrder.MOST_RECENTLY_ACTIVE)) {\n\t\t\t\t\t\t\tif (isDiffEditorInput(candidate.editor)\n\t\t\t\t\t\t\t\t&& isEqual(candidate.editor.original.resource, this._entry.originalURI)\n\t\t\t\t\t\t\t\t&& isEqual(candidate.editor.modified.resource, this._entry.modifiedURI)\n\t\t\t\t\t\t\t) {\n\t\t\t\t\t\t\t\teditorIdents.push(candidate);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tthis._editorService.closeEditors(editorIdents);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t} else {\n\t\t\t// Open normal editor\n\t\t\tawait this._editorService.openEditor({\n\t\t\t\tresource: this._entry.modifiedURI,\n\t\t\t\toptions: {\n\t\t\t\t\tselection,\n\t\t\t\t\tselectionRevealType: TextEditorSelectionRevealType.NearTopIfOutsideViewport\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n}\n\nclass DiffHunkWidget implements IOverlayWidget, IModifiedFileEntryChangeHunk {\n\n\tprivate static _idPool = 0;\n\tprivate readonly _id: string = `diff-change-widget-${DiffHunkWidget._idPool++}`;\n\n\tprivate readonly _domNode: HTMLElement;\n\tprivate readonly _store = new DisposableStore();\n\tprivate _position: IOverlayWidgetPosition | undefined;\n\tprivate _lastStartLineNumber: number | undefined;\n\tprivate _removed: boolean = false;\n\n\tconstructor(\n\t\tprivate readonly _editor: ICodeEditor,\n\t\tprivate _diffInfo: IDocumentDiff2,\n\t\tprivate _change: DetailedLineRangeMapping,\n\t\tprivate _versionId: number,\n\t\tprivate _lineDelta: number,\n\t\t@IInstantiationService instaService: IInstantiationService,\n\t) {\n\t\tthis._domNode = document.createElement('div');\n\t\tthis._domNode.className = 'chat-diff-change-content-widget';\n\n\t\tconst toolbar = instaService.createInstance(MenuWorkbenchToolBar, this._domNode, MenuId.ChatEditingEditorHunk, {\n\t\t\ttelemetrySource: 'chatEditingEditorHunk',\n\t\t\thiddenItemStrategy: HiddenItemStrategy.NoHide,\n\t\t\ttoolbarOptions: { primaryGroup: () => true, },\n\t\t\tmenuOptions: {\n\t\t\t\trenderShortTitle: true,\n\t\t\t\targ: this,\n\t\t\t},\n\t\t\tactionViewItemProvider: (action, options) => {\n\t\t\t\tif (!action.class) {\n\t\t\t\t\treturn new class extends ActionViewItem {\n\t\t\t\t\t\tconstructor() {\n\t\t\t\t\t\t\tsuper(undefined, action, { ...options, keybindingNotRenderedWithLabel: true /* hide keybinding for actions without icon */, icon: false, label: true });\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t\treturn undefined;\n\t\t\t}\n\t\t});\n\n\t\tthis._store.add(toolbar);\n\t\tthis._store.add(toolbar.actionRunner.onWillRun(_ => _editor.focus()));\n\t\tthis._editor.addOverlayWidget(this);\n\t}\n\n\tupdate(diffInfo: IDocumentDiff2, change: DetailedLineRangeMapping, versionId: number, lineDelta: number): void {\n\t\tthis._diffInfo = diffInfo;\n\t\tthis._change = change;\n\t\tthis._versionId = versionId;\n\t\tthis._lineDelta = lineDelta;\n\t}\n\n\tdispose(): void {\n\t\tthis._store.dispose();\n\t\tthis._editor.removeOverlayWidget(this);\n\t\tthis._removed = true;\n\t}\n\n\tgetId(): string {\n\t\treturn this._id;\n\t}\n\n\tlayout(startLineNumber: number): void {\n\n\t\tconst lineHeight = this._editor.getOption(EditorOption.lineHeight);\n\t\tconst { contentLeft, contentWidth, verticalScrollbarWidth } = this._editor.getLayoutInfo();\n\t\tconst scrollTop = this._editor.getScrollTop();\n\n\t\tthis._position = {\n\t\t\tstackOrdinal: 1,\n\t\t\tpreference: {\n\t\t\t\ttop: this._editor.getTopForLineNumber(startLineNumber) - scrollTop - (lineHeight * this._lineDelta),\n\t\t\t\tleft: contentLeft + contentWidth - (2 * verticalScrollbarWidth + getTotalWidth(this._domNode))\n\t\t\t}\n\t\t};\n\n\t\tif (this._removed) {\n\t\t\tthis._removed = false;\n\t\t\tthis._editor.addOverlayWidget(this);\n\t\t} else {\n\t\t\tthis._editor.layoutOverlayWidget(this);\n\t\t}\n\t\tthis._lastStartLineNumber = startLineNumber;\n\t}\n\n\tremove(): void {\n\t\tthis._editor.removeOverlayWidget(this);\n\t\tthis._removed = true;\n\t}\n\n\ttoggle(show: boolean) {\n\t\tthis._domNode.classList.toggle('hover', show);\n\t\tif (this._lastStartLineNumber) {\n\t\t\tthis.layout(this._lastStartLineNumber);\n\t\t}\n\t}\n\n\tgetDomNode(): HTMLElement {\n\t\treturn this._domNode;\n\t}\n\n\tgetPosition(): IOverlayWidgetPosition | null {\n\t\treturn this._position ?? null;\n\t}\n\n\tgetStartLineNumber(): number | undefined {\n\t\treturn this._lastStartLineNumber;\n\t}\n\n\t// ---\n\n\tasync reject(): Promise<boolean> {\n\t\tif (this._versionId !== this._editor.getModel()?.getVersionId()) {\n\t\t\treturn false;\n\t\t}\n\t\treturn await this._diffInfo.undo(this._change);\n\t}\n\n\tasync accept(): Promise<boolean> {\n\t\tif (this._versionId !== this._editor.getModel()?.getVersionId()) {\n\t\t\treturn false;\n\t\t}\n\t\treturn this._diffInfo.keep(this._change);\n\t}\n}\n\n\nclass AccessibleDiffViewContainer implements IOverlayWidget {\n\n\tprivate readonly _domNode: HTMLElement;\n\n\tconstructor() {\n\t\tthis._domNode = document.createElement('div');\n\t\tthis._domNode.className = 'accessible-diff-view';\n\t\tthis._domNode.style.width = '100%';\n\t\tthis._domNode.style.position = 'absolute';\n\t}\n\n\tgetId(): string {\n\t\treturn 'chatEdits.accessibleDiffView';\n\t}\n\n\tgetDomNode(): HTMLElement {\n\t\treturn this._domNode;\n\t}\n\n\tgetPosition(): IOverlayWidgetPosition | null {\n\t\treturn {\n\t\t\tpreference: { top: 0, left: 0 },\n\t\t\tstackOrdinal: 1\n\t\t};\n\t}\n}\n\nclass AccessibleDiffViewerModel implements IAccessibleDiffViewerModel {\n\tconstructor(\n\t\tprivate readonly _documentDiffInfo: IObservable<IDocumentDiff2>,\n\t\tprivate readonly _editor: ICodeEditor,\n\t) { }\n\n\tgetOriginalModel() {\n\t\treturn this._documentDiffInfo.get().originalModel;\n\t}\n\n\tgetOriginalOptions() {\n\t\treturn this._editor.getOptions();\n\t}\n\n\toriginalReveal(range: Range) {\n\t\tconst changes = this._documentDiffInfo.get().changes;\n\t\tconst idx = changes.findIndex(value => value.original.intersect(LineRange.fromRange(range)));\n\t\tif (idx >= 0) {\n\t\t\trange = changes[idx].modified.toInclusiveRange() ?? range;\n\t\t}\n\t\tthis.modifiedReveal(range);\n\t}\n\n\tgetModifiedModel() {\n\t\treturn this._editor.getModel()!;\n\t}\n\n\tgetModifiedOptions() {\n\t\treturn this._editor.getOptions();\n\t}\n\n\tmodifiedReveal(range: Range) {\n\t\tif (range) {\n\t\t\tthis._editor.revealRange(range);\n\t\t\tthis._editor.setSelection(range);\n\t\t}\n\t\tthis._editor.focus();\n\t}\n\n\tmodifiedSetSelection(range: Range) {\n\t\tthis._editor.setSelection(range);\n\t}\n\n\tmodifiedFocus() {\n\t\tthis._editor.focus();\n\t}\n\n\tgetModifiedPosition() {\n\t\treturn this._editor.getPosition() ?? undefined;\n\t}\n}\n"]}