{"version":3,"sources":["vs/workbench/contrib/chat/browser/attachments/implicitContextAttachment.ts"],"names":[],"mappings":"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","file":"implicitContextAttachment.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as dom from '../../../../../base/browser/dom.js';\nimport { StandardKeyboardEvent } from '../../../../../base/browser/keyboardEvent.js';\nimport { StandardMouseEvent } from '../../../../../base/browser/mouseEvent.js';\nimport { Button } from '../../../../../base/browser/ui/button/button.js';\nimport { getDefaultHoverDelegate } from '../../../../../base/browser/ui/hover/hoverDelegateFactory.js';\nimport { Codicon } from '../../../../../base/common/codicons.js';\nimport { KeyCode } from '../../../../../base/common/keyCodes.js';\nimport { Disposable, DisposableStore } from '../../../../../base/common/lifecycle.js';\nimport { Schemas } from '../../../../../base/common/network.js';\nimport { basename, dirname } from '../../../../../base/common/resources.js';\nimport { URI } from '../../../../../base/common/uri.js';\nimport { Location } from '../../../../../editor/common/languages.js';\nimport { ILanguageService } from '../../../../../editor/common/languages/language.js';\nimport { IModelService } from '../../../../../editor/common/services/model.js';\nimport { localize } from '../../../../../nls.js';\nimport { getFlatContextMenuActions } from '../../../../../platform/actions/browser/menuEntryActionViewItem.js';\nimport { IMenuService, MenuId } from '../../../../../platform/actions/common/actions.js';\nimport { IConfigurationService } from '../../../../../platform/configuration/common/configuration.js';\nimport { IContextKeyService } from '../../../../../platform/contextkey/common/contextkey.js';\nimport { IContextMenuService } from '../../../../../platform/contextview/browser/contextView.js';\nimport { FileKind, IFileService } from '../../../../../platform/files/common/files.js';\nimport { IHoverService } from '../../../../../platform/hover/browser/hover.js';\nimport { ILabelService } from '../../../../../platform/label/common/label.js';\nimport { IResourceLabel, ResourceLabels } from '../../../../browser/labels.js';\nimport { ResourceContextKey } from '../../../../common/contextkeys.js';\nimport { IChatRequestImplicitVariableEntry, IChatRequestStringVariableEntry, isStringImplicitContextValue } from '../../common/chatVariableEntries.js';\nimport { IChatWidgetService } from '../chat.js';\nimport { ChatAttachmentModel } from '../chatAttachmentModel.js';\nimport { IChatContextService } from '../chatContextService.js';\n\nexport class ImplicitContextAttachmentWidget extends Disposable {\n\tpublic readonly domNode: HTMLElement;\n\n\tprivate readonly renderDisposables = this._register(new DisposableStore());\n\n\tconstructor(\n\t\tprivate readonly attachment: IChatRequestImplicitVariableEntry,\n\t\tprivate readonly resourceLabels: ResourceLabels,\n\t\tprivate readonly attachmentModel: ChatAttachmentModel,\n\t\t@IContextKeyService private readonly contextKeyService: IContextKeyService,\n\t\t@IContextMenuService private readonly contextMenuService: IContextMenuService,\n\t\t@ILabelService private readonly labelService: ILabelService,\n\t\t@IMenuService private readonly menuService: IMenuService,\n\t\t@IFileService private readonly fileService: IFileService,\n\t\t@ILanguageService private readonly languageService: ILanguageService,\n\t\t@IModelService private readonly modelService: IModelService,\n\t\t@IHoverService private readonly hoverService: IHoverService,\n\t\t@IChatWidgetService private readonly chatWidgetService: IChatWidgetService,\n\t\t@IConfigurationService private readonly configService: IConfigurationService,\n\t\t@IChatContextService private readonly chatContextService: IChatContextService,\n\t) {\n\t\tsuper();\n\n\t\tthis.domNode = dom.$('.chat-attached-context-attachment.show-file-icons.implicit');\n\t\tthis.render();\n\t}\n\n\tprivate render() {\n\t\tdom.clearNode(this.domNode);\n\t\tthis.renderDisposables.clear();\n\n\t\tthis.domNode.classList.toggle('disabled', !this.attachment.enabled);\n\t\tconst label = this.resourceLabels.create(this.domNode, { supportIcons: true });\n\t\tconst file: URI | undefined = this.attachment.uri;\n\t\tconst attachmentTypeName = file?.scheme === Schemas.vscodeNotebookCell ? localize('cell.lowercase', \"cell\") : localize('file.lowercase', \"file\");\n\n\t\tlet title: string;\n\t\tif (isStringImplicitContextValue(this.attachment.value)) {\n\t\t\ttitle = this.renderString(label);\n\t\t} else {\n\t\t\ttitle = this.renderResource(this.attachment.value, label);\n\t\t}\n\n\t\tconst isSuggestedEnabled = this.configService.getValue('chat.implicitContext.suggestedContext');\n\t\tthis._register(this.hoverService.setupManagedHover(getDefaultHoverDelegate('element'), this.domNode, title));\n\n\n\t\tif (isSuggestedEnabled) {\n\t\t\tif (!this.attachment.isSelection) {\n\t\t\t\tconst buttonMsg = this.attachment.enabled ? localize('disable', \"Disable current {0} context\", attachmentTypeName) : '';\n\t\t\t\tconst toggleButton = this.renderDisposables.add(new Button(this.domNode, { supportIcons: true, title: buttonMsg }));\n\t\t\t\ttoggleButton.icon = this.attachment.enabled ? Codicon.x : Codicon.plus;\n\t\t\t\tthis.renderDisposables.add(toggleButton.onDidClick(async (e) => {\n\t\t\t\t\te.stopPropagation();\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\tif (!this.attachment.enabled) {\n\t\t\t\t\t\tawait this.convertToRegularAttachment();\n\t\t\t\t\t}\n\t\t\t\t\tthis.attachment.enabled = false;\n\t\t\t\t}));\n\t\t\t}\n\n\t\t\tif (!this.attachment.enabled && this.attachment.isSelection) {\n\t\t\t\tthis.domNode.classList.remove('disabled');\n\t\t\t}\n\n\t\t\tthis.renderDisposables.add(dom.addDisposableListener(this.domNode, dom.EventType.CLICK, async (e) => {\n\t\t\t\tif (!this.attachment.enabled && !this.attachment.isSelection) {\n\t\t\t\t\tawait this.convertToRegularAttachment();\n\t\t\t\t}\n\t\t\t}));\n\n\t\t\tthis.renderDisposables.add(dom.addDisposableListener(this.domNode, dom.EventType.KEY_DOWN, async (e) => {\n\t\t\t\tconst event = new StandardKeyboardEvent(e);\n\t\t\t\tif (event.equals(KeyCode.Enter) || event.equals(KeyCode.Space)) {\n\t\t\t\t\tif (!this.attachment.enabled && !this.attachment.isSelection) {\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\tawait this.convertToRegularAttachment();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}));\n\t\t} else {\n\t\t\tconst buttonMsg = this.attachment.enabled ? localize('disable', \"Disable current {0} context\", attachmentTypeName) : localize('enable', \"Enable current {0} context\", attachmentTypeName);\n\t\t\tconst toggleButton = this.renderDisposables.add(new Button(this.domNode, { supportIcons: true, title: buttonMsg }));\n\t\t\ttoggleButton.icon = this.attachment.enabled ? Codicon.eye : Codicon.eyeClosed;\n\t\t\tthis.renderDisposables.add(toggleButton.onDidClick((e) => {\n\t\t\t\te.stopPropagation(); // prevent it from triggering the click handler on the parent immediately after rerendering\n\t\t\t\tthis.attachment.enabled = !this.attachment.enabled;\n\t\t\t}));\n\t\t}\n\n\t\t// Context menu\n\t\tconst scopedContextKeyService = this.renderDisposables.add(this.contextKeyService.createScoped(this.domNode));\n\n\t\tconst resourceContextKey = this.renderDisposables.add(new ResourceContextKey(scopedContextKeyService, this.fileService, this.languageService, this.modelService));\n\t\tresourceContextKey.set(file);\n\n\t\tthis.renderDisposables.add(dom.addDisposableListener(this.domNode, dom.EventType.CONTEXT_MENU, async domEvent => {\n\t\t\tconst event = new StandardMouseEvent(dom.getWindow(domEvent), domEvent);\n\t\t\tdom.EventHelper.stop(domEvent, true);\n\n\t\t\tthis.contextMenuService.showContextMenu({\n\t\t\t\tcontextKeyService: scopedContextKeyService,\n\t\t\t\tgetAnchor: () => event,\n\t\t\t\tgetActions: () => {\n\t\t\t\t\tconst menu = this.menuService.getMenuActions(MenuId.ChatInputResourceAttachmentContext, scopedContextKeyService, { arg: file });\n\t\t\t\t\treturn getFlatContextMenuActions(menu);\n\t\t\t\t},\n\t\t\t});\n\t\t}));\n\t}\n\n\tprivate renderString(resourceLabel: IResourceLabel): string {\n\t\tconst label = this.attachment.name;\n\t\tconst icon = this.attachment.icon;\n\t\tconst title = localize('openFile', \"Current file context\");\n\t\tresourceLabel.setLabel(label, undefined, { iconPath: icon, title });\n\t\treturn title;\n\t}\n\n\tprivate renderResource(attachmentValue: Location | URI | undefined, label: IResourceLabel): string {\n\t\tconst file = URI.isUri(attachmentValue) ? attachmentValue : attachmentValue!.uri;\n\t\tconst range = URI.isUri(attachmentValue) || !this.attachment.isSelection ? undefined : attachmentValue!.range;\n\n\t\tconst attachmentTypeName = file.scheme === Schemas.vscodeNotebookCell ? localize('cell.lowercase', \"cell\") : localize('file.lowercase', \"file\");\n\n\t\tconst fileBasename = basename(file);\n\t\tconst fileDirname = dirname(file);\n\t\tconst friendlyName = `${fileBasename} ${fileDirname}`;\n\t\tconst ariaLabel = range ? localize('chat.fileAttachmentWithRange', \"Attached {0}, {1}, line {2} to line {3}\", attachmentTypeName, friendlyName, range.startLineNumber, range.endLineNumber) : localize('chat.fileAttachment', \"Attached {0}, {1}\", attachmentTypeName, friendlyName);\n\n\t\tconst uriLabel = this.labelService.getUriLabel(file, { relative: true });\n\t\tconst currentFile = localize('openEditor', \"Current {0} context\", attachmentTypeName);\n\t\tconst inactive = localize('enableHint', \"Enable current {0} context\", attachmentTypeName);\n\t\tconst currentFileHint = this.attachment.enabled || this.attachment.isSelection ? currentFile : inactive;\n\t\tconst title = `${currentFileHint}\\n${uriLabel}`;\n\n\t\tlabel.setFile(file, {\n\t\t\tfileKind: FileKind.FILE,\n\t\t\thidePath: true,\n\t\t\trange,\n\t\t\ttitle\n\t\t});\n\t\tthis.domNode.ariaLabel = ariaLabel;\n\t\tthis.domNode.tabIndex = 0;\n\n\t\treturn title;\n\t}\n\n\tprivate async convertToRegularAttachment(): Promise<void> {\n\t\tif (!this.attachment.value) {\n\t\t\treturn;\n\t\t}\n\t\tif (isStringImplicitContextValue(this.attachment.value)) {\n\t\t\tif (this.attachment.value.value === undefined) {\n\t\t\t\tawait this.chatContextService.resolveChatContext(this.attachment.value);\n\t\t\t}\n\t\t\tconst context: IChatRequestStringVariableEntry = {\n\t\t\t\tkind: 'string',\n\t\t\t\tvalue: this.attachment.value.value,\n\t\t\t\tid: this.attachment.id,\n\t\t\t\tname: this.attachment.name,\n\t\t\t\ticon: this.attachment.value.icon,\n\t\t\t\tmodelDescription: this.attachment.value.modelDescription,\n\t\t\t\turi: this.attachment.value.uri\n\t\t\t};\n\t\t\tthis.attachmentModel.addContext(context);\n\t\t} else {\n\t\t\tconst file = URI.isUri(this.attachment.value) ? this.attachment.value : this.attachment.value.uri;\n\t\t\tthis.attachmentModel.addFile(file);\n\t\t}\n\t\tthis.chatWidgetService.lastFocusedWidget?.focusInput();\n\t}\n}\n"]}