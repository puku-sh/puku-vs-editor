{"version":3,"sources":["vs/workbench/contrib/chat/browser/chatContentParts/chatTextEditContentPart.ts"],"names":[],"mappings":"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","file":"chatTextEditContentPart.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as dom from '../../../../../base/browser/dom.js';\nimport { CancellationTokenSource } from '../../../../../base/common/cancellation.js';\nimport { Emitter, Event } from '../../../../../base/common/event.js';\nimport { Disposable, IDisposable, IReference, RefCountedDisposable, toDisposable } from '../../../../../base/common/lifecycle.js';\nimport { Schemas } from '../../../../../base/common/network.js';\nimport { isEqual } from '../../../../../base/common/resources.js';\nimport { assertType } from '../../../../../base/common/types.js';\nimport { URI } from '../../../../../base/common/uri.js';\nimport { generateUuid } from '../../../../../base/common/uuid.js';\nimport { ISingleEditOperation } from '../../../../../editor/common/core/editOperation.js';\nimport { TextEdit } from '../../../../../editor/common/languages.js';\nimport { createTextBufferFactoryFromSnapshot } from '../../../../../editor/common/model/textModel.js';\nimport { IModelService } from '../../../../../editor/common/services/model.js';\nimport { DefaultModelSHA1Computer } from '../../../../../editor/common/services/modelService.js';\nimport { IResolvedTextEditorModel, ITextModelService } from '../../../../../editor/common/services/resolverService.js';\nimport { localize } from '../../../../../nls.js';\nimport { InstantiationType, registerSingleton } from '../../../../../platform/instantiation/common/extensions.js';\nimport { createDecorator } from '../../../../../platform/instantiation/common/instantiation.js';\nimport { IChatProgressRenderableResponseContent, IChatTextEditGroup } from '../../common/chatModel.js';\nimport { IChatService } from '../../common/chatService.js';\nimport { IChatResponseViewModel, isResponseVM } from '../../common/chatViewModel.js';\nimport { IChatListItemRendererOptions } from '../chat.js';\nimport { CodeCompareBlockPart, ICodeCompareBlockData, ICodeCompareBlockDiffData } from '../codeBlockPart.js';\nimport { IDisposableReference } from './chatCollections.js';\nimport { DiffEditorPool } from './chatContentCodePools.js';\nimport { IChatContentPart, IChatContentPartRenderContext } from './chatContentParts.js';\n\nconst $ = dom.$;\n\nconst ICodeCompareModelService = createDecorator<ICodeCompareModelService>('ICodeCompareModelService');\n\ninterface ICodeCompareModelService {\n\t_serviceBrand: undefined;\n\tcreateModel(response: IChatResponseViewModel, chatTextEdit: IChatTextEditGroup): Promise<IReference<{ originalSha1: string; original: IResolvedTextEditorModel; modified: IResolvedTextEditorModel }>>;\n}\n\nexport class ChatTextEditContentPart extends Disposable implements IChatContentPart {\n\tpublic readonly domNode: HTMLElement;\n\tprivate readonly comparePart: IDisposableReference<CodeCompareBlockPart> | undefined;\n\n\tprivate readonly _onDidChangeHeight = this._register(new Emitter<void>());\n\tpublic readonly onDidChangeHeight = this._onDidChangeHeight.event;\n\n\tconstructor(\n\t\tchatTextEdit: IChatTextEditGroup,\n\t\tcontext: IChatContentPartRenderContext,\n\t\trendererOptions: IChatListItemRendererOptions,\n\t\tdiffEditorPool: DiffEditorPool,\n\t\tcurrentWidth: number,\n\t\t@ICodeCompareModelService private readonly codeCompareModelService: ICodeCompareModelService\n\t) {\n\t\tsuper();\n\t\tconst element = context.element;\n\n\t\tassertType(isResponseVM(element));\n\n\t\t// TODO@jrieken move this into the CompareCodeBlock and properly say what kind of changes happen\n\t\tif (rendererOptions.renderTextEditsAsSummary?.(chatTextEdit.uri)) {\n\t\t\tif (element.response.value.every(item => item.kind === 'textEditGroup')) {\n\t\t\t\tthis.domNode = $('.interactive-edits-summary', undefined, !element.isComplete\n\t\t\t\t\t? ''\n\t\t\t\t\t: element.isCanceled\n\t\t\t\t\t\t? localize('edits0', \"Making changes was aborted.\")\n\t\t\t\t\t\t: localize('editsSummary', \"Made changes.\"));\n\t\t\t} else {\n\t\t\t\tthis.domNode = $('div');\n\t\t\t}\n\n\t\t\t// TODO@roblourens this case is now handled outside this Part in ChatListRenderer, but can it be cleaned up?\n\t\t\t// return;\n\t\t} else {\n\n\n\t\t\tconst cts = new CancellationTokenSource();\n\n\t\t\tlet isDisposed = false;\n\t\t\tthis._register(toDisposable(() => {\n\t\t\t\tisDisposed = true;\n\t\t\t\tcts.dispose(true);\n\t\t\t}));\n\n\t\t\tthis.comparePart = this._register(diffEditorPool.get());\n\n\t\t\t// Attach this after updating text/layout of the editor, so it should only be fired when the size updates later (horizontal scrollbar, wrapping)\n\t\t\t// not during a renderElement OR a progressive render (when we will be firing this event anyway at the end of the render)\n\t\t\tthis._register(this.comparePart.object.onDidChangeContentHeight(() => {\n\t\t\t\tthis._onDidChangeHeight.fire();\n\t\t\t}));\n\n\t\t\tconst data: ICodeCompareBlockData = {\n\t\t\t\telement,\n\t\t\t\tedit: chatTextEdit,\n\t\t\t\tdiffData: (async () => {\n\n\t\t\t\t\tconst ref = await this.codeCompareModelService.createModel(element, chatTextEdit);\n\n\t\t\t\t\tif (isDisposed) {\n\t\t\t\t\t\tref.dispose();\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis._register(ref);\n\n\t\t\t\t\treturn {\n\t\t\t\t\t\tmodified: ref.object.modified.textEditorModel,\n\t\t\t\t\t\toriginal: ref.object.original.textEditorModel,\n\t\t\t\t\t\toriginalSha1: ref.object.originalSha1\n\t\t\t\t\t} satisfies ICodeCompareBlockDiffData;\n\t\t\t\t})()\n\t\t\t};\n\t\t\tthis.comparePart.object.render(data, currentWidth, cts.token);\n\n\t\t\tthis.domNode = this.comparePart.object.element;\n\t\t}\n\t}\n\n\tlayout(width: number): void {\n\t\tthis.comparePart?.object.layout(width);\n\t}\n\n\thasSameContent(other: IChatProgressRenderableResponseContent): boolean {\n\t\t// No other change allowed for this content type\n\t\treturn other.kind === 'textEditGroup';\n\t}\n\n\taddDisposable(disposable: IDisposable): void {\n\t\tthis._register(disposable);\n\t}\n}\n\nclass CodeCompareModelService implements ICodeCompareModelService {\n\n\tdeclare readonly _serviceBrand: undefined;\n\n\tconstructor(\n\t\t@ITextModelService private readonly textModelService: ITextModelService,\n\t\t@IModelService private readonly modelService: IModelService,\n\t\t@IChatService private readonly chatService: IChatService,\n\t) { }\n\n\tasync createModel(element: IChatResponseViewModel, chatTextEdit: IChatTextEditGroup): Promise<IReference<{ originalSha1: string; original: IResolvedTextEditorModel; modified: IResolvedTextEditorModel }>> {\n\n\t\tconst original = await this.textModelService.createModelReference(chatTextEdit.uri);\n\n\t\tconst modified = await this.textModelService.createModelReference((this.modelService.createModel(\n\t\t\tcreateTextBufferFactoryFromSnapshot(original.object.textEditorModel.createSnapshot()),\n\t\t\t{ languageId: original.object.textEditorModel.getLanguageId(), onDidChange: Event.None },\n\t\t\tURI.from({ scheme: Schemas.vscodeChatCodeBlock, path: chatTextEdit.uri.path, query: generateUuid() }),\n\t\t\tfalse\n\t\t)).uri);\n\n\t\tconst d = new RefCountedDisposable(toDisposable(() => {\n\t\t\toriginal.dispose();\n\t\t\tmodified.dispose();\n\t\t}));\n\n\t\t// compute the sha1 of the original model\n\t\tlet originalSha1: string = '';\n\t\tif (chatTextEdit.state) {\n\t\t\toriginalSha1 = chatTextEdit.state.sha1;\n\t\t} else {\n\t\t\tconst sha1 = new DefaultModelSHA1Computer();\n\t\t\tif (sha1.canComputeSHA1(original.object.textEditorModel)) {\n\t\t\t\toriginalSha1 = sha1.computeSHA1(original.object.textEditorModel);\n\t\t\t\tchatTextEdit.state = { sha1: originalSha1, applied: 0 };\n\t\t\t}\n\t\t}\n\n\t\t// apply edits to the \"modified\" model\n\t\tconst chatModel = this.chatService.getSession(element.sessionResource)!;\n\t\tconst editGroups: ISingleEditOperation[][] = [];\n\t\tfor (const request of chatModel.getRequests()) {\n\t\t\tif (!request.response) {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tfor (const item of request.response.response.value) {\n\t\t\t\tif (item.kind !== 'textEditGroup' || item.state?.applied || !isEqual(item.uri, chatTextEdit.uri)) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tfor (const group of item.edits) {\n\t\t\t\t\tconst edits = group.map(TextEdit.asEditOperation);\n\t\t\t\t\teditGroups.push(edits);\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (request.response === element.model) {\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\tfor (const edits of editGroups) {\n\t\t\tmodified.object.textEditorModel.pushEditOperations(null, edits, () => null);\n\t\t}\n\n\t\t// self-acquire a reference to diff models for a short while\n\t\t// because streaming usually means we will be using the original-model\n\t\t// repeatedly and thereby also should reuse the modified-model and just\n\t\t// update it with more edits\n\t\td.acquire();\n\t\tsetTimeout(() => d.release(), 5000);\n\n\t\treturn {\n\t\t\tobject: {\n\t\t\t\toriginalSha1,\n\t\t\t\toriginal: original.object,\n\t\t\t\tmodified: modified.object\n\t\t\t},\n\t\t\tdispose() {\n\t\t\t\td.release();\n\t\t\t},\n\t\t};\n\t}\n}\n\nregisterSingleton(ICodeCompareModelService, CodeCompareModelService, InstantiationType.Delayed);\n"]}