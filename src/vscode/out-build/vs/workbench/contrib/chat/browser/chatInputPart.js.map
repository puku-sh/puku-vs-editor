{"version":3,"sources":["vs/workbench/contrib/chat/browser/chatInputPart.ts"],"names":[],"mappings":"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","file":"chatInputPart.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as dom from '../../../../base/browser/dom.js';\nimport { addDisposableListener } from '../../../../base/browser/dom.js';\nimport { DEFAULT_FONT_FAMILY } from '../../../../base/browser/fonts.js';\nimport { IHistoryNavigationWidget } from '../../../../base/browser/history.js';\nimport { hasModifierKeys, StandardKeyboardEvent } from '../../../../base/browser/keyboardEvent.js';\nimport { ActionViewItem, IActionViewItemOptions } from '../../../../base/browser/ui/actionbar/actionViewItems.js';\nimport * as aria from '../../../../base/browser/ui/aria/aria.js';\nimport { Button, ButtonWithIcon } from '../../../../base/browser/ui/button/button.js';\nimport { createInstantHoverDelegate, getDefaultHoverDelegate } from '../../../../base/browser/ui/hover/hoverDelegateFactory.js';\nimport { renderLabelWithIcons } from '../../../../base/browser/ui/iconLabel/iconLabels.js';\nimport { IAction } from '../../../../base/common/actions.js';\nimport { equals as arraysEqual } from '../../../../base/common/arrays.js';\nimport { DeferredPromise, RunOnceScheduler } from '../../../../base/common/async.js';\nimport { CancellationToken } from '../../../../base/common/cancellation.js';\nimport { Codicon } from '../../../../base/common/codicons.js';\nimport { Emitter, Event } from '../../../../base/common/event.js';\nimport { HistoryNavigator2 } from '../../../../base/common/history.js';\nimport { Iterable } from '../../../../base/common/iterator.js';\nimport { KeyCode } from '../../../../base/common/keyCodes.js';\nimport { Lazy } from '../../../../base/common/lazy.js';\nimport { Disposable, DisposableStore, IDisposable, MutableDisposable, toDisposable } from '../../../../base/common/lifecycle.js';\nimport { ResourceSet } from '../../../../base/common/map.js';\nimport { Schemas } from '../../../../base/common/network.js';\nimport { autorun, derived, derivedOpts, IObservable, ISettableObservable, observableValue } from '../../../../base/common/observable.js';\nimport { isMacintosh } from '../../../../base/common/platform.js';\nimport { isEqual } from '../../../../base/common/resources.js';\nimport { ScrollbarVisibility } from '../../../../base/common/scrollable.js';\nimport { assertType } from '../../../../base/common/types.js';\nimport { URI } from '../../../../base/common/uri.js';\nimport { IEditorConstructionOptions } from '../../../../editor/browser/config/editorConfiguration.js';\nimport { EditorExtensionsRegistry } from '../../../../editor/browser/editorExtensions.js';\nimport { CodeEditorWidget } from '../../../../editor/browser/widget/codeEditor/codeEditorWidget.js';\nimport { EditorOptions, IEditorOptions } from '../../../../editor/common/config/editorOptions.js';\nimport { IDimension } from '../../../../editor/common/core/2d/dimension.js';\nimport { IPosition } from '../../../../editor/common/core/position.js';\nimport { isLocation } from '../../../../editor/common/languages.js';\nimport { ITextModel } from '../../../../editor/common/model.js';\nimport { IModelService } from '../../../../editor/common/services/model.js';\nimport { ITextModelService } from '../../../../editor/common/services/resolverService.js';\nimport { CopyPasteController } from '../../../../editor/contrib/dropOrPasteInto/browser/copyPasteController.js';\nimport { DropIntoEditorController } from '../../../../editor/contrib/dropOrPasteInto/browser/dropIntoEditorController.js';\nimport { ContentHoverController } from '../../../../editor/contrib/hover/browser/contentHoverController.js';\nimport { GlyphHoverController } from '../../../../editor/contrib/hover/browser/glyphHoverController.js';\nimport { LinkDetector } from '../../../../editor/contrib/links/browser/links.js';\nimport { SuggestController } from '../../../../editor/contrib/suggest/browser/suggestController.js';\nimport { localize } from '../../../../nls.js';\nimport { IAccessibilityService } from '../../../../platform/accessibility/common/accessibility.js';\nimport { MenuWorkbenchButtonBar } from '../../../../platform/actions/browser/buttonbar.js';\nimport { HiddenItemStrategy, MenuWorkbenchToolBar } from '../../../../platform/actions/browser/toolbar.js';\nimport { MenuId, MenuItemAction } from '../../../../platform/actions/common/actions.js';\nimport { IConfigurationService } from '../../../../platform/configuration/common/configuration.js';\nimport { IContextKey, IContextKeyService } from '../../../../platform/contextkey/common/contextkey.js';\nimport { IFileService } from '../../../../platform/files/common/files.js';\nimport { registerAndCreateHistoryNavigationContext } from '../../../../platform/history/browser/contextScopedHistoryWidget.js';\nimport { IInstantiationService } from '../../../../platform/instantiation/common/instantiation.js';\nimport { ServiceCollection } from '../../../../platform/instantiation/common/serviceCollection.js';\nimport { IKeybindingService } from '../../../../platform/keybinding/common/keybinding.js';\nimport { ILabelService } from '../../../../platform/label/common/label.js';\nimport { WorkbenchList } from '../../../../platform/list/browser/listService.js';\nimport { ILogService } from '../../../../platform/log/common/log.js';\nimport { IStorageService, StorageScope, StorageTarget } from '../../../../platform/storage/common/storage.js';\nimport { IThemeService } from '../../../../platform/theme/common/themeService.js';\nimport { ISharedWebContentExtractorService } from '../../../../platform/webContentExtractor/common/webContentExtractor.js';\nimport { ResourceLabels } from '../../../browser/labels.js';\nimport { IWorkbenchAssignmentService } from '../../../services/assignment/common/assignmentService.js';\nimport { IChatEntitlementService } from '../../../services/chat/common/chatEntitlementService.js';\nimport { ACTIVE_GROUP, IEditorService, SIDE_GROUP } from '../../../services/editor/common/editorService.js';\nimport { AccessibilityVerbositySettingId } from '../../accessibility/browser/accessibilityConfiguration.js';\nimport { AccessibilityCommandId } from '../../accessibility/common/accessibilityCommands.js';\nimport { getSimpleCodeEditorWidgetOptions, getSimpleEditorOptions, setupSimpleEditorSelectionStyling } from '../../codeEditor/browser/simpleEditorOptions.js';\nimport { IChatAgentService } from '../common/chatAgents.js';\nimport { ChatContextKeys } from '../common/chatContextKeys.js';\nimport { IChatEditingSession, IModifiedFileEntry, ModifiedFileEntryState } from '../common/chatEditingService.js';\nimport { IChatModelInputState, IChatRequestModeInfo, IInputModel } from '../common/chatModel.js';\nimport { ChatMode, IChatMode, IChatModeService } from '../common/chatModes.js';\nimport { IChatFollowup, IChatService } from '../common/chatService.js';\nimport { IChatSessionProviderOptionItem, IChatSessionsService } from '../common/chatSessionsService.js';\nimport { ChatRequestVariableSet, IChatRequestVariableEntry, isElementVariableEntry, isImageVariableEntry, isNotebookOutputVariableEntry, isPasteVariableEntry, isPromptFileVariableEntry, isPromptTextVariableEntry, isSCMHistoryItemChangeRangeVariableEntry, isSCMHistoryItemChangeVariableEntry, isSCMHistoryItemVariableEntry, isStringVariableEntry } from '../common/chatVariableEntries.js';\nimport { IChatResponseViewModel } from '../common/chatViewModel.js';\nimport { ChatInputHistoryMaxEntries, IChatWidgetHistoryService } from '../common/chatWidgetHistoryService.js';\nimport { ChatAgentLocation, ChatConfiguration, ChatModeKind, validateChatMode } from '../common/constants.js';\nimport { ILanguageModelChatMetadata, ILanguageModelChatMetadataAndIdentifier, ILanguageModelsService } from '../common/languageModels.js';\nimport { ILanguageModelToolsService } from '../common/languageModelToolsService.js';\nimport { ChatContinueInSessionActionItem, ContinueChatInSessionAction } from './actions/chatContinueInAction.js';\nimport { ChatOpenModelPickerActionId, ChatSessionPrimaryPickerAction, ChatSubmitAction, IChatExecuteActionContext, OpenModePickerAction } from './actions/chatExecuteActions.js';\nimport { ImplicitContextAttachmentWidget } from './attachments/implicitContextAttachment.js';\nimport { IChatWidget } from './chat.js';\nimport { ChatAttachmentModel } from './chatAttachmentModel.js';\nimport { DefaultChatAttachmentWidget, ElementChatAttachmentWidget, FileAttachmentWidget, ImageAttachmentWidget, NotebookCellOutputChatAttachmentWidget, PasteAttachmentWidget, PromptFileAttachmentWidget, PromptTextAttachmentWidget, SCMHistoryItemAttachmentWidget, SCMHistoryItemChangeAttachmentWidget, SCMHistoryItemChangeRangeAttachmentWidget, TerminalCommandAttachmentWidget, ToolSetOrToolItemAttachmentWidget } from './chatAttachmentWidgets.js';\nimport { IDisposableReference } from './chatContentParts/chatCollections.js';\nimport { CollapsibleListPool, IChatCollapsibleListItem } from './chatContentParts/chatReferencesContentPart.js';\nimport { ChatTodoListWidget } from './chatContentParts/chatTodoListWidget.js';\nimport { IChatContextService } from './chatContextService.js';\nimport { ChatDragAndDrop } from './chatDragAndDrop.js';\nimport { ChatEditingShowChangesAction, ViewPreviousEditsAction } from './chatEditing/chatEditingActions.js';\nimport { ChatFollowups } from './chatFollowups.js';\nimport { ChatSelectedTools } from './chatSelectedTools.js';\nimport { ChatSessionPickerActionItem, IChatSessionPickerDelegate } from './chatSessions/chatSessionPickerActionItem.js';\nimport { ChatImplicitContext } from './contrib/chatImplicitContext.js';\nimport { ChatRelatedFiles } from './contrib/chatInputRelatedFilesContrib.js';\nimport { resizeImage } from './imageUtils.js';\nimport { IModelPickerDelegate, ModelPickerActionItem } from './modelPicker/modelPickerActionItem.js';\nimport { IModePickerDelegate, ModePickerActionItem } from './modelPicker/modePickerActionItem.js';\n\nconst $ = dom.$;\n\nconst INPUT_EDITOR_MAX_HEIGHT = 250;\n\nexport interface IChatInputStyles {\n\toverlayBackground: string;\n\tlistForeground: string;\n\tlistBackground: string;\n}\n\nexport interface IChatInputPartOptions {\n\tdefaultMode?: IChatMode;\n\trenderFollowups: boolean;\n\trenderStyle?: 'compact';\n\trenderInputToolbarBelowInput: boolean;\n\tmenus: {\n\t\texecuteToolbar: MenuId;\n\t\ttelemetrySource: string;\n\t\tinputSideToolbar?: MenuId;\n\t};\n\teditorOverflowWidgetsDomNode?: HTMLElement;\n\trenderWorkingSet: boolean;\n\tenableImplicitContext?: boolean;\n\tsupportsChangingModes?: boolean;\n\tdndContainer?: HTMLElement;\n\twidgetViewKindTag: string;\n}\n\nexport interface IWorkingSetEntry {\n\turi: URI;\n}\n\nexport class ChatInputPart extends Disposable implements IHistoryNavigationWidget {\n\tprivate static _counter = 0;\n\n\tprivate _workingSetCollapsed = true;\n\tprivate readonly _chatInputTodoListWidget = this._register(new MutableDisposable<ChatTodoListWidget>());\n\tprivate readonly _chatEditingTodosDisposables = this._register(new DisposableStore());\n\tprivate _lastEditingSessionResource: URI | undefined;\n\n\tprivate _onDidLoadInputState: Emitter<void> = this._register(new Emitter());\n\treadonly onDidLoadInputState: Event<void> = this._onDidLoadInputState.event;\n\n\tprivate _onDidChangeHeight = this._register(new Emitter<void>());\n\treadonly onDidChangeHeight: Event<void> = this._onDidChangeHeight.event;\n\n\tprivate _onDidFocus = this._register(new Emitter<void>());\n\treadonly onDidFocus: Event<void> = this._onDidFocus.event;\n\n\tprivate _onDidBlur = this._register(new Emitter<void>());\n\treadonly onDidBlur: Event<void> = this._onDidBlur.event;\n\n\tprivate _onDidChangeContext = this._register(new Emitter<{ removed?: IChatRequestVariableEntry[]; added?: IChatRequestVariableEntry[] }>());\n\treadonly onDidChangeContext: Event<{ removed?: IChatRequestVariableEntry[]; added?: IChatRequestVariableEntry[] }> = this._onDidChangeContext.event;\n\n\tprivate _onDidAcceptFollowup = this._register(new Emitter<{ followup: IChatFollowup; response: IChatResponseViewModel | undefined }>());\n\treadonly onDidAcceptFollowup: Event<{ followup: IChatFollowup; response: IChatResponseViewModel | undefined }> = this._onDidAcceptFollowup.event;\n\n\tprivate _onDidClickOverlay = this._register(new Emitter<void>());\n\treadonly onDidClickOverlay: Event<void> = this._onDidClickOverlay.event;\n\n\tprivate readonly _attachmentModel: ChatAttachmentModel;\n\tprivate _widget?: IChatWidget;\n\tpublic get attachmentModel(): ChatAttachmentModel {\n\t\treturn this._attachmentModel;\n\t}\n\n\treadonly selectedToolsModel: ChatSelectedTools;\n\n\tpublic getAttachedContext(sessionResource: URI) {\n\t\tconst contextArr = new ChatRequestVariableSet();\n\t\tcontextArr.add(...this.attachmentModel.attachments, ...this.chatContextService.getWorkspaceContextItems());\n\t\treturn contextArr;\n\t}\n\n\tpublic getAttachedAndImplicitContext(sessionResource: URI): ChatRequestVariableSet {\n\n\t\tconst contextArr = this.getAttachedContext(sessionResource);\n\n\t\tif ((this.implicitContext?.enabled && this.implicitContext?.value) || (this.implicitContext && !URI.isUri(this.implicitContext.value) && this.configurationService.getValue<boolean>('chat.implicitContext.suggestedContext'))) {\n\t\t\tconst implicitChatVariables = this.implicitContext.toBaseEntries();\n\t\t\tcontextArr.add(...implicitChatVariables);\n\t\t}\n\t\treturn contextArr;\n\t}\n\n\tprivate _indexOfLastAttachedContextDeletedWithKeyboard: number = -1;\n\tprivate _indexOfLastOpenedContext: number = -1;\n\n\tprivate _implicitContext: ChatImplicitContext | undefined;\n\tpublic get implicitContext(): ChatImplicitContext | undefined {\n\t\treturn this._implicitContext;\n\t}\n\n\tprivate _relatedFiles: ChatRelatedFiles | undefined;\n\tpublic get relatedFiles(): ChatRelatedFiles | undefined {\n\t\treturn this._relatedFiles;\n\t}\n\n\tprivate _hasFileAttachmentContextKey: IContextKey<boolean>;\n\n\tprivate readonly _onDidChangeVisibility = this._register(new Emitter<boolean>());\n\tprivate readonly _contextResourceLabels: ResourceLabels;\n\n\tprivate readonly inputEditorMaxHeight: number;\n\tprivate inputEditorHeight: number = 0;\n\tprivate container!: HTMLElement;\n\n\tprivate inputSideToolbarContainer?: HTMLElement;\n\n\tprivate followupsContainer!: HTMLElement;\n\tprivate readonly followupsDisposables: DisposableStore = this._register(new DisposableStore());\n\n\tprivate attachmentsContainer!: HTMLElement;\n\n\tprivate chatInputOverlay!: HTMLElement;\n\tprivate readonly overlayClickListener: MutableDisposable<IDisposable> = this._register(new MutableDisposable<IDisposable>());\n\n\tprivate attachedContextContainer!: HTMLElement;\n\tprivate readonly attachedContextDisposables: MutableDisposable<DisposableStore> = this._register(new MutableDisposable<DisposableStore>());\n\n\tprivate relatedFilesContainer!: HTMLElement;\n\n\tprivate chatEditingSessionWidgetContainer!: HTMLElement;\n\tprivate chatInputTodoListWidgetContainer!: HTMLElement;\n\n\tprivate _inputPartHeight: number = 0;\n\tget inputPartHeight() {\n\t\treturn this._inputPartHeight;\n\t}\n\n\tprivate _followupsHeight: number = 0;\n\tget followupsHeight() {\n\t\treturn this._followupsHeight;\n\t}\n\n\tprivate _editSessionWidgetHeight: number = 0;\n\tget editSessionWidgetHeight() {\n\t\treturn this._editSessionWidgetHeight;\n\t}\n\n\tget todoListWidgetHeight() {\n\t\treturn this.chatInputTodoListWidgetContainer.offsetHeight;\n\t}\n\n\tget attachmentsHeight() {\n\t\treturn this.attachmentsContainer.offsetHeight + (this.attachmentsContainer.checkVisibility() ? 6 : 0);\n\t}\n\n\tprivate _inputEditor!: CodeEditorWidget;\n\tprivate _inputEditorElement!: HTMLElement;\n\n\t// Reference to the input model for syncing input state\n\tprivate _inputModel: IInputModel | undefined;\n\n\t// Disposables for model observation\n\tprivate readonly _modelSyncDisposables = this._register(new DisposableStore());\n\n\t// Flag to prevent circular updates between view and model\n\tprivate _isSyncingToOrFromInputModel = false;\n\n\t// Debounced scheduler for syncing text changes\n\tprivate readonly _syncTextDebounced: RunOnceScheduler;\n\n\tprivate executeToolbar!: MenuWorkbenchToolBar;\n\tprivate inputActionsToolbar!: MenuWorkbenchToolBar;\n\n\tprivate addFilesToolbar: MenuWorkbenchToolBar | undefined;\n\tprivate addFilesButton: AddFilesButton | undefined;\n\n\tget inputEditor() {\n\t\treturn this._inputEditor;\n\t}\n\n\treadonly dnd: ChatDragAndDrop;\n\n\tprivate history: HistoryNavigator2<IChatModelInputState>;\n\tprivate historyNavigationBackwardsEnablement!: IContextKey<boolean>;\n\tprivate historyNavigationForewardsEnablement!: IContextKey<boolean>;\n\tprivate inputModel: ITextModel | undefined;\n\tprivate inputEditorHasText: IContextKey<boolean>;\n\tprivate chatCursorAtTop: IContextKey<boolean>;\n\tprivate inputEditorHasFocus: IContextKey<boolean>;\n\tprivate currentlyEditingInputKey!: IContextKey<boolean>;\n\tprivate chatModeKindKey: IContextKey<ChatModeKind>;\n\tprivate withinEditSessionKey: IContextKey<boolean>;\n\tprivate filePartOfEditSessionKey: IContextKey<boolean>;\n\tprivate chatSessionHasOptions: IContextKey<boolean>;\n\tprivate modelWidget: ModelPickerActionItem | undefined;\n\tprivate modeWidget: ModePickerActionItem | undefined;\n\tprivate chatSessionPickerWidgets: Map<string, ChatSessionPickerActionItem> = new Map();\n\tprivate chatSessionPickerContainer: HTMLElement | undefined;\n\tprivate _lastSessionPickerAction: MenuItemAction | undefined;\n\tprivate readonly _waitForPersistedLanguageModel: MutableDisposable<IDisposable> = this._register(new MutableDisposable<IDisposable>());\n\tprivate _onDidChangeCurrentLanguageModel: Emitter<ILanguageModelChatMetadataAndIdentifier> = this._register(new Emitter<ILanguageModelChatMetadataAndIdentifier>());\n\tprivate readonly _chatSessionOptionEmitters: Map<string, Emitter<IChatSessionProviderOptionItem>> = new Map();\n\n\tprivate _currentLanguageModel: ILanguageModelChatMetadataAndIdentifier | undefined;\n\n\tget currentLanguageModel() {\n\t\treturn this._currentLanguageModel?.identifier;\n\t}\n\n\tget selectedLanguageModel(): ILanguageModelChatMetadataAndIdentifier | undefined {\n\t\treturn this._currentLanguageModel;\n\t}\n\n\tprivate _onDidChangeCurrentChatMode: Emitter<void> = this._register(new Emitter<void>());\n\treadonly onDidChangeCurrentChatMode: Event<void> = this._onDidChangeCurrentChatMode.event;\n\n\tprivate readonly _currentModeObservable: ISettableObservable<IChatMode>;\n\n\tpublic get currentModeKind(): ChatModeKind {\n\t\tconst mode = this._currentModeObservable.get();\n\t\treturn mode.kind === ChatModeKind.Agent && !this.agentService.hasToolsAgent ?\n\t\t\tChatModeKind.Edit :\n\t\t\tmode.kind;\n\t}\n\n\tpublic get currentModeObs(): IObservable<IChatMode> {\n\t\treturn this._currentModeObservable;\n\t}\n\n\tpublic get currentModeInfo(): IChatRequestModeInfo {\n\t\tconst mode = this._currentModeObservable.get();\n\t\tconst modeId: 'ask' | 'agent' | 'edit' | 'custom' | undefined = mode.isBuiltin ? this.currentModeKind : 'custom';\n\n\t\tconst modeInstructions = mode.modeInstructions?.get();\n\t\treturn {\n\t\t\tkind: this.currentModeKind,\n\t\t\tisBuiltin: mode.isBuiltin,\n\t\t\tmodeInstructions: modeInstructions ? {\n\t\t\t\tname: mode.name.get(),\n\t\t\t\tcontent: modeInstructions.content,\n\t\t\t\ttoolReferences: this.toolService.toToolReferences(modeInstructions.toolReferences),\n\t\t\t\tmetadata: modeInstructions.metadata,\n\t\t\t} : undefined,\n\t\t\tmodeId: modeId,\n\t\t\tapplyCodeBlockSuggestionId: undefined,\n\t\t};\n\t}\n\n\tprivate cachedDimensions: dom.Dimension | undefined;\n\tprivate cachedExecuteToolbarWidth: number | undefined;\n\tprivate cachedInputToolbarWidth: number | undefined;\n\n\treadonly inputUri: URI = URI.parse(`${Schemas.vscodeChatInput}:input-${ChatInputPart._counter++}`);\n\n\tprivate _workingSetLinesAddedSpan = new Lazy(() => dom.$('.working-set-lines-added'));\n\tprivate _workingSetLinesRemovedSpan = new Lazy(() => dom.$('.working-set-lines-removed'));\n\n\tprivate readonly _chatEditsActionsDisposables: DisposableStore = this._register(new DisposableStore());\n\tprivate readonly _chatEditsDisposables: DisposableStore = this._register(new DisposableStore());\n\tprivate readonly _renderingChatEdits = this._register(new MutableDisposable());\n\n\tprivate _chatEditsListPool: CollapsibleListPool;\n\tprivate _chatEditList: IDisposableReference<WorkbenchList<IChatCollapsibleListItem>> | undefined;\n\tget selectedElements(): URI[] {\n\t\tconst edits = [];\n\t\tconst editsList = this._chatEditList?.object;\n\t\tconst selectedElements = editsList?.getSelectedElements() ?? [];\n\t\tfor (const element of selectedElements) {\n\t\t\tif (element.kind === 'reference' && URI.isUri(element.reference)) {\n\t\t\t\tedits.push(element.reference);\n\t\t\t}\n\t\t}\n\t\treturn edits;\n\t}\n\n\tprivate _attemptedWorkingSetEntriesCount: number = 0;\n\t/**\n\t * The number of working set entries that the user actually wanted to attach.\n\t * This is less than or equal to {@link ChatInputPart.chatEditWorkingSetFiles}.\n\t */\n\tpublic get attemptedWorkingSetEntriesCount() {\n\t\treturn this._attemptedWorkingSetEntriesCount;\n\t}\n\n\t/**\n\t * Number consumers holding the 'generating' lock.\n\t */\n\tprivate _generating?: { rc: number; defer: DeferredPromise<void> };\n\n\tconstructor(\n\t\t// private readonly editorOptions: ChatEditorOptions, // TODO this should be used\n\t\tprivate readonly location: ChatAgentLocation,\n\t\tprivate readonly options: IChatInputPartOptions,\n\t\tstyles: IChatInputStyles,\n\t\tprivate readonly inline: boolean,\n\t\t@IChatWidgetHistoryService private readonly historyService: IChatWidgetHistoryService,\n\t\t@IModelService private readonly modelService: IModelService,\n\t\t@IInstantiationService private readonly instantiationService: IInstantiationService,\n\t\t@IContextKeyService private readonly contextKeyService: IContextKeyService,\n\t\t@IConfigurationService private readonly configurationService: IConfigurationService,\n\t\t@IKeybindingService private readonly keybindingService: IKeybindingService,\n\t\t@IAccessibilityService private readonly accessibilityService: IAccessibilityService,\n\t\t@ILanguageModelsService private readonly languageModelsService: ILanguageModelsService,\n\t\t@ILogService private readonly logService: ILogService,\n\t\t@IFileService private readonly fileService: IFileService,\n\t\t@IEditorService private readonly editorService: IEditorService,\n\t\t@IThemeService private readonly themeService: IThemeService,\n\t\t@ITextModelService private readonly textModelResolverService: ITextModelService,\n\t\t@IStorageService private readonly storageService: IStorageService,\n\t\t@ILabelService private readonly labelService: ILabelService,\n\t\t@IChatAgentService private readonly agentService: IChatAgentService,\n\t\t@ISharedWebContentExtractorService private readonly sharedWebExtracterService: ISharedWebContentExtractorService,\n\t\t@IWorkbenchAssignmentService private readonly experimentService: IWorkbenchAssignmentService,\n\t\t@IChatEntitlementService private readonly entitlementService: IChatEntitlementService,\n\t\t@IChatModeService private readonly chatModeService: IChatModeService,\n\t\t@ILanguageModelToolsService private readonly toolService: ILanguageModelToolsService,\n\t\t@IChatService private readonly chatService: IChatService,\n\t\t@IChatSessionsService private readonly chatSessionsService: IChatSessionsService,\n\t\t@IChatContextService private readonly chatContextService: IChatContextService,\n\t) {\n\t\tsuper();\n\n\t\t// Initialize debounced text sync scheduler\n\t\tthis._syncTextDebounced = this._register(new RunOnceScheduler(() => this._syncInputStateToModel(), 150));\n\n\t\tthis._contextResourceLabels = this._register(this.instantiationService.createInstance(ResourceLabels, { onDidChangeVisibility: this._onDidChangeVisibility.event }));\n\t\tthis._currentModeObservable = observableValue<IChatMode>('currentMode', this.options.defaultMode ?? ChatMode.Agent);\n\t\tthis._register(this.editorService.onDidActiveEditorChange(() => {\n\t\t\tthis._indexOfLastOpenedContext = -1;\n\t\t\tthis.refreshChatSessionPickers();\n\t\t}));\n\n\t\tthis._attachmentModel = this._register(this.instantiationService.createInstance(ChatAttachmentModel));\n\t\tthis._register(this._attachmentModel.onDidChange(() => this._syncInputStateToModel()));\n\t\tthis.selectedToolsModel = this._register(this.instantiationService.createInstance(ChatSelectedTools, this.currentModeObs));\n\t\tthis.dnd = this._register(this.instantiationService.createInstance(ChatDragAndDrop, this._attachmentModel, styles));\n\n\t\tthis.inputEditorMaxHeight = this.options.renderStyle === 'compact' ? INPUT_EDITOR_MAX_HEIGHT / 3 : INPUT_EDITOR_MAX_HEIGHT;\n\n\t\tthis.inputEditorHasText = ChatContextKeys.inputHasText.bindTo(contextKeyService);\n\t\tthis.chatCursorAtTop = ChatContextKeys.inputCursorAtTop.bindTo(contextKeyService);\n\t\tthis.inputEditorHasFocus = ChatContextKeys.inputHasFocus.bindTo(contextKeyService);\n\t\tthis.chatModeKindKey = ChatContextKeys.chatModeKind.bindTo(contextKeyService);\n\t\tthis.withinEditSessionKey = ChatContextKeys.withinEditSessionDiff.bindTo(contextKeyService);\n\t\tthis.filePartOfEditSessionKey = ChatContextKeys.filePartOfEditSession.bindTo(contextKeyService);\n\t\tthis.chatSessionHasOptions = ChatContextKeys.chatSessionHasModels.bindTo(contextKeyService);\n\n\t\tconst chatToolCount = ChatContextKeys.chatToolCount.bindTo(contextKeyService);\n\n\t\tthis._register(autorun(reader => {\n\t\t\tlet count = 0;\n\t\t\tconst userSelectedTools = this.selectedToolsModel.userSelectedTools.read(reader);\n\t\t\tfor (const key in userSelectedTools) {\n\t\t\t\tif (userSelectedTools[key] === true) {\n\t\t\t\t\tcount++;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tchatToolCount.set(count);\n\t\t}));\n\n\t\tthis.history = this.loadHistory();\n\t\tthis._register(this.historyService.onDidClearHistory(() => this.history = new HistoryNavigator2<IChatModelInputState>([this.getCurrentInputState()], ChatInputHistoryMaxEntries, historyKeyFn)));\n\n\t\tthis._register(this.configurationService.onDidChangeConfiguration(e => {\n\t\t\tconst newOptions: IEditorOptions = {};\n\t\t\tif (e.affectsConfiguration(AccessibilityVerbositySettingId.Chat)) {\n\t\t\t\tnewOptions.ariaLabel = this._getAriaLabel();\n\t\t\t}\n\t\t\tif (e.affectsConfiguration('editor.wordSegmenterLocales')) {\n\t\t\t\tnewOptions.wordSegmenterLocales = this.configurationService.getValue<string | string[]>('editor.wordSegmenterLocales');\n\t\t\t}\n\t\t\tif (e.affectsConfiguration('editor.autoClosingBrackets')) {\n\t\t\t\tnewOptions.autoClosingBrackets = this.configurationService.getValue('editor.autoClosingBrackets');\n\t\t\t}\n\t\t\tif (e.affectsConfiguration('editor.autoClosingQuotes')) {\n\t\t\t\tnewOptions.autoClosingQuotes = this.configurationService.getValue('editor.autoClosingQuotes');\n\t\t\t}\n\t\t\tif (e.affectsConfiguration('editor.autoSurround')) {\n\t\t\t\tnewOptions.autoSurround = this.configurationService.getValue('editor.autoSurround');\n\t\t\t}\n\n\t\t\tthis.inputEditor.updateOptions(newOptions);\n\t\t}));\n\n\t\tthis._chatEditsListPool = this._register(this.instantiationService.createInstance(CollapsibleListPool, this._onDidChangeVisibility.event, MenuId.ChatEditingWidgetModifiedFilesToolbar, { verticalScrollMode: ScrollbarVisibility.Visible }));\n\n\t\tthis._hasFileAttachmentContextKey = ChatContextKeys.hasFileAttachments.bindTo(contextKeyService);\n\n\t\tthis.initSelectedModel();\n\n\t\tthis._register(this.languageModelsService.onDidChangeLanguageModels((vendor) => {\n\t\t\t// Remove vendor from cache since the models changed and what is stored is no longer valid\n\t\t\t// TODO @lramos15 - The cache should be less confusing since we have the LM Service cache + the view cache interacting weirdly\n\t\t\tthis.storageService.store(\n\t\t\t\t'chat.cachedLanguageModels',\n\t\t\t\tthis.storageService.getObject<ILanguageModelChatMetadataAndIdentifier[]>('chat.cachedLanguageModels', StorageScope.APPLICATION, []).filter(m => !m.identifier.startsWith(vendor)),\n\t\t\t\tStorageScope.APPLICATION,\n\t\t\t\tStorageTarget.MACHINE\n\t\t\t);\n\n\t\t\t// We've changed models and the current one is no longer available. Select a new one\n\t\t\tconst selectedModel = this._currentLanguageModel ? this.getModels().find(m => m.identifier === this._currentLanguageModel?.identifier) : undefined;\n\t\t\tconst selectedModelNotAvailable = this._currentLanguageModel && (!selectedModel?.metadata.isUserSelectable);\n\t\t\tif (!this.currentLanguageModel || selectedModelNotAvailable) {\n\t\t\t\tthis.setCurrentLanguageModelToDefault();\n\t\t\t}\n\t\t}));\n\n\t\tthis._register(this.onDidChangeCurrentChatMode(() => {\n\t\t\tthis.accessibilityService.alert(this._currentModeObservable.get().label.get());\n\t\t\tif (this._inputEditor) {\n\t\t\t\tthis._inputEditor.updateOptions({ ariaLabel: this._getAriaLabel() });\n\t\t\t}\n\n\t\t\tif (this.implicitContext && this.configurationService.getValue<boolean>('chat.implicitContext.suggestedContext')) {\n\t\t\t\tthis.implicitContext.enabled = this._currentModeObservable.get() !== ChatMode.Agent;\n\t\t\t}\n\t\t}));\n\t\tthis._register(this._onDidChangeCurrentLanguageModel.event(() => {\n\t\t\tif (this._currentLanguageModel?.metadata.name) {\n\t\t\t\tthis.accessibilityService.alert(this._currentLanguageModel.metadata.name);\n\t\t\t}\n\t\t\tthis._inputEditor?.updateOptions({ ariaLabel: this._getAriaLabel() });\n\t\t}));\n\t\tthis._register(this.chatModeService.onDidChangeChatModes(() => this.validateCurrentChatMode()));\n\t\tthis._register(autorun(r => {\n\t\t\tconst mode = this._currentModeObservable.read(r);\n\t\t\tconst model = mode.model?.read(r);\n\t\t\tif (model) {\n\t\t\t\tthis.switchModelByQualifiedName(model);\n\t\t\t}\n\t\t}));\n\t}\n\n\tpublic setIsWithinEditSession(inInsideDiff: boolean, isFilePartOfEditSession: boolean) {\n\t\tthis.withinEditSessionKey.set(inInsideDiff);\n\t\tthis.filePartOfEditSessionKey.set(isFilePartOfEditSession);\n\t}\n\n\tprivate getSelectedModelStorageKey(): string {\n\t\treturn `chat.currentLanguageModel.${this.location}`;\n\t}\n\n\tprivate getSelectedModelIsDefaultStorageKey(): string {\n\t\treturn `chat.currentLanguageModel.${this.location}.isDefault`;\n\t}\n\n\tprivate initSelectedModel() {\n\t\tconst persistedSelection = this.storageService.get(this.getSelectedModelStorageKey(), StorageScope.APPLICATION);\n\t\tconst persistedAsDefault = this.storageService.getBoolean(this.getSelectedModelIsDefaultStorageKey(), StorageScope.APPLICATION, persistedSelection === 'copilot/gpt-4.1');\n\n\t\tif (persistedSelection) {\n\t\t\tconst model = this.getModels().find(m => m.identifier === persistedSelection);\n\t\t\tif (model) {\n\t\t\t\t// Only restore the model if it wasn't the default at the time of storing or it is now the default\n\t\t\t\tif (!persistedAsDefault || model.metadata.isDefault) {\n\t\t\t\t\tthis.setCurrentLanguageModel(model);\n\t\t\t\t\tthis.checkModelSupported();\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tthis._waitForPersistedLanguageModel.value = this.languageModelsService.onDidChangeLanguageModels(e => {\n\t\t\t\t\tconst persistedModel = this.languageModelsService.lookupLanguageModel(persistedSelection);\n\t\t\t\t\tif (persistedModel) {\n\t\t\t\t\t\tthis._waitForPersistedLanguageModel.clear();\n\n\t\t\t\t\t\t// Only restore the model if it wasn't the default at the time of storing or it is now the default\n\t\t\t\t\t\tif (!persistedAsDefault || persistedModel.isDefault) {\n\t\t\t\t\t\t\tif (persistedModel.isUserSelectable) {\n\t\t\t\t\t\t\t\tthis.setCurrentLanguageModel({ metadata: persistedModel, identifier: persistedSelection });\n\t\t\t\t\t\t\t\tthis.checkModelSupported();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.setCurrentLanguageModelToDefault();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tthis._register(this._onDidChangeCurrentChatMode.event(() => {\n\t\t\tthis.checkModelSupported();\n\t\t}));\n\t\tthis._register(this.configurationService.onDidChangeConfiguration(e => {\n\t\t\tif (e.affectsConfiguration(ChatConfiguration.Edits2Enabled)) {\n\t\t\t\tthis.checkModelSupported();\n\t\t\t}\n\t\t}));\n\t}\n\n\tpublic setEditing(enabled: boolean) {\n\t\tthis.currentlyEditingInputKey?.set(enabled);\n\t}\n\n\tpublic switchModel(modelMetadata: Pick<ILanguageModelChatMetadata, 'vendor' | 'id' | 'family'>) {\n\t\tconst models = this.getModels();\n\t\tconst model = models.find(m => m.metadata.vendor === modelMetadata.vendor && m.metadata.id === modelMetadata.id && m.metadata.family === modelMetadata.family);\n\t\tif (model) {\n\t\t\tthis.setCurrentLanguageModel(model);\n\t\t}\n\t}\n\n\tpublic switchModelByQualifiedName(qualifiedModelName: string): boolean {\n\t\tconst models = this.getModels();\n\t\tconst model = models.find(m => ILanguageModelChatMetadata.matchesQualifiedName(qualifiedModelName, m.metadata));\n\t\tif (model) {\n\t\t\tthis.setCurrentLanguageModel(model);\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tpublic switchToNextModel(): void {\n\t\tconst models = this.getModels();\n\t\tif (models.length > 0) {\n\t\t\tconst currentIndex = models.findIndex(model => model.identifier === this._currentLanguageModel?.identifier);\n\t\t\tconst nextIndex = (currentIndex + 1) % models.length;\n\t\t\tthis.setCurrentLanguageModel(models[nextIndex]);\n\t\t}\n\t}\n\n\tpublic openModelPicker(): void {\n\t\tthis.modelWidget?.show();\n\t}\n\n\tpublic openModePicker(): void {\n\t\tthis.modeWidget?.show();\n\t}\n\n\tpublic openChatSessionPicker(): void {\n\t\t// Open the first available picker widget\n\t\tconst firstWidget = this.chatSessionPickerWidgets?.values()?.next().value;\n\t\tfirstWidget?.show();\n\t}\n\n\t/**\n\t * Create picker widgets for all option groups available for the current session type.\n\t */\n\tprivate createChatSessionPickerWidgets(action: MenuItemAction): ChatSessionPickerActionItem[] {\n\t\tthis._lastSessionPickerAction = action;\n\n\t\t// Helper to resolve chat session context\n\t\tconst resolveChatSessionContext = () => {\n\t\t\tconst sessionResource = this._widget?.viewModel?.model.sessionResource;\n\t\t\tif (!sessionResource) {\n\t\t\t\treturn undefined;\n\t\t\t}\n\t\t\treturn this.chatService.getChatSessionFromInternalUri(sessionResource);\n\t\t};\n\n\t\t// Get all option groups for the current session type\n\t\tconst ctx = resolveChatSessionContext();\n\t\tconst optionGroups = ctx ? this.chatSessionsService.getOptionGroupsForSessionType(ctx.chatSessionType) : undefined;\n\t\tif (!optionGroups || optionGroups.length === 0) {\n\t\t\treturn [];\n\t\t}\n\n\t\t// Clear existing widgets\n\t\tthis.disposeSessionPickerWidgets();\n\n\t\t// Create a widget for each option group in effect for this specific session\n\t\tconst widgets: ChatSessionPickerActionItem[] = [];\n\t\tfor (const optionGroup of optionGroups) {\n\t\t\tif (!ctx) {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tif (!this.chatSessionsService.getSessionOption(ctx.chatSessionResource, optionGroup.id)) {\n\t\t\t\t// This session does not have a value to contribute for this option group\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tconst initialItem = this.getCurrentOptionForGroup(optionGroup.id);\n\t\t\tconst initialState = { group: optionGroup, item: initialItem };\n\n\t\t\t// Create delegate for this option group\n\t\t\tconst itemDelegate: IChatSessionPickerDelegate = {\n\t\t\t\tgetCurrentOption: () => this.getCurrentOptionForGroup(optionGroup.id),\n\t\t\t\tonDidChangeOption: this.getOrCreateOptionEmitter(optionGroup.id).event,\n\t\t\t\tsetOption: (option: IChatSessionProviderOptionItem) => {\n\t\t\t\t\tconst ctx = resolveChatSessionContext();\n\t\t\t\t\tif (!ctx) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tthis.getOrCreateOptionEmitter(optionGroup.id).fire(option);\n\t\t\t\t\tthis.chatSessionsService.notifySessionOptionsChange(\n\t\t\t\t\t\tctx.chatSessionResource,\n\t\t\t\t\t\t[{ optionId: optionGroup.id, value: option.id }]\n\t\t\t\t\t).catch(err => this.logService.error(`Failed to notify extension of ${optionGroup.id} change:`, err));\n\t\t\t\t},\n\t\t\t\tgetAllOptions: () => {\n\t\t\t\t\tconst ctx = resolveChatSessionContext();\n\t\t\t\t\tif (!ctx) {\n\t\t\t\t\t\treturn [];\n\t\t\t\t\t}\n\t\t\t\t\tconst groups = this.chatSessionsService.getOptionGroupsForSessionType(ctx.chatSessionType);\n\t\t\t\t\tconst group = groups?.find(g => g.id === optionGroup.id);\n\t\t\t\t\treturn group?.items ?? [];\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tconst widget = this.instantiationService.createInstance(ChatSessionPickerActionItem, action, initialState, itemDelegate);\n\t\t\tthis.chatSessionPickerWidgets.set(optionGroup.id, widget);\n\t\t\twidgets.push(widget);\n\t\t}\n\n\t\treturn widgets;\n\t}\n\n\t/**\n\t * Set the input model reference for syncing input state\n\t */\n\tsetInputModel(model: IInputModel | undefined): void {\n\t\tthis._inputModel = model;\n\t\tthis._modelSyncDisposables.clear();\n\n\t\tif (!model) {\n\t\t\treturn;\n\t\t}\n\n\t\t// Observe changes from model and sync to view\n\t\tthis._modelSyncDisposables.add(autorun(reader => {\n\t\t\tconst state = model.state.read(reader);\n\t\t\tthis._syncFromModel(state);\n\t\t}));\n\t}\n\n\t/**\n\t * Sync from model to view (when model state changes)\n\t */\n\tprivate _syncFromModel(state: IChatModelInputState | undefined): void {\n\t\t// Prevent circular updates\n\t\tif (this._isSyncingToOrFromInputModel) {\n\t\t\treturn;\n\t\t}\n\n\t\ttry {\n\t\t\tthis._isSyncingToOrFromInputModel = true;\n\n\t\t\t// Sync mode\n\t\t\tif (state) {\n\t\t\t\tconst currentMode = this._currentModeObservable.get();\n\t\t\t\tif (currentMode.id !== state.mode.id) {\n\t\t\t\t\tthis.setChatMode(state.mode.id, false);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Sync selected model\n\t\t\tif (state?.selectedModel) {\n\t\t\t\tif (!this._currentLanguageModel || this._currentLanguageModel.identifier !== state.selectedModel.identifier) {\n\t\t\t\t\tthis.setCurrentLanguageModel(state.selectedModel);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Sync attachments\n\t\t\tconst currentAttachments = this._attachmentModel.attachments;\n\t\t\tif (!state) {\n\t\t\t\tthis._attachmentModel.clear();\n\t\t\t} else if (!arraysEqual(currentAttachments, state.attachments)) {\n\t\t\t\tthis._attachmentModel.clearAndSetContext(...state.attachments);\n\t\t\t}\n\n\t\t\t// Sync input text\n\t\t\tif (this._inputEditor) {\n\t\t\t\tthis._inputEditor.setValue(state?.inputText || '');\n\t\t\t\tif (state?.selections.length) {\n\t\t\t\t\tthis._inputEditor.setSelections(state.selections);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (state) {\n\t\t\t\tthis._widget?.contribs.forEach(contrib => {\n\t\t\t\t\tcontrib.setInputState?.(state.contrib);\n\t\t\t\t});\n\t\t\t}\n\t\t} finally {\n\t\t\tthis._isSyncingToOrFromInputModel = false;\n\t\t}\n\t}\n\n\t/**\n\t * Sync current input state to the input model\n\t */\n\tprivate _syncInputStateToModel(): void {\n\t\tif (!this._inputModel || this._isSyncingToOrFromInputModel) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._isSyncingToOrFromInputModel = true;\n\t\tthis._inputModel.setState(this.getCurrentInputState());\n\t\tthis._isSyncingToOrFromInputModel = false;\n\t}\n\n\tpublic setCurrentLanguageModel(model: ILanguageModelChatMetadataAndIdentifier) {\n\t\tthis._currentLanguageModel = model;\n\n\t\tif (this.cachedDimensions) {\n\t\t\t// For quick chat and editor chat, relayout because the input may need to shrink to accomodate the model name\n\t\t\tthis.layout(this.cachedDimensions.height, this.cachedDimensions.width);\n\t\t}\n\n\t\t// Store as global user preference (session-specific state is in the model's inputModel)\n\t\tthis.storageService.store(this.getSelectedModelStorageKey(), model.identifier, StorageScope.APPLICATION, StorageTarget.USER);\n\t\tthis.storageService.store(this.getSelectedModelIsDefaultStorageKey(), !!model.metadata.isDefault, StorageScope.APPLICATION, StorageTarget.USER);\n\n\t\tthis._onDidChangeCurrentLanguageModel.fire(model);\n\n\t\t// Sync to model\n\t\tthis._syncInputStateToModel();\n\t}\n\n\tprivate checkModelSupported(): void {\n\t\tif (this._currentLanguageModel && !this.modelSupportedForDefaultAgent(this._currentLanguageModel)) {\n\t\t\tthis.setCurrentLanguageModelToDefault();\n\t\t}\n\t}\n\n\t/**\n\t * By ID- prefer this method\n\t */\n\tsetChatMode(mode: ChatModeKind | string, storeSelection = true): void {\n\t\tif (!this.options.supportsChangingModes) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst mode2 = this.chatModeService.findModeById(mode) ??\n\t\t\tthis.chatModeService.findModeById(ChatModeKind.Agent) ??\n\t\t\tChatMode.Ask;\n\t\tthis.setChatMode2(mode2, storeSelection);\n\t}\n\n\tprivate setChatMode2(mode: IChatMode, storeSelection = true): void {\n\t\tif (!this.options.supportsChangingModes) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._currentModeObservable.set(mode, undefined);\n\t\tthis.chatModeKindKey.set(mode.kind);\n\t\tthis._onDidChangeCurrentChatMode.fire();\n\n\t\t// Sync to model (mode is now persisted in the model's input state)\n\t\tthis._syncInputStateToModel();\n\t}\n\n\tprivate modelSupportedForDefaultAgent(model: ILanguageModelChatMetadataAndIdentifier): boolean {\n\t\t// Probably this logic could live in configuration on the agent, or somewhere else, if it gets more complex\n\t\tif (this.currentModeKind === ChatModeKind.Agent || (this.currentModeKind === ChatModeKind.Edit && this.configurationService.getValue(ChatConfiguration.Edits2Enabled))) {\n\t\t\treturn ILanguageModelChatMetadata.suitableForAgentMode(model.metadata);\n\t\t}\n\n\t\treturn true;\n\t}\n\n\tprivate getModels(): ILanguageModelChatMetadataAndIdentifier[] {\n\t\tconst cachedModels = this.storageService.getObject<ILanguageModelChatMetadataAndIdentifier[]>('chat.cachedLanguageModels', StorageScope.APPLICATION, []);\n\t\tlet models = this.languageModelsService.getLanguageModelIds()\n\t\t\t.map(modelId => ({ identifier: modelId, metadata: this.languageModelsService.lookupLanguageModel(modelId)! }));\n\t\tif (models.length === 0 || models.some(m => m.metadata.isDefault) === false) {\n\t\t\tmodels = cachedModels;\n\t\t} else {\n\t\t\tthis.storageService.store('chat.cachedLanguageModels', models, StorageScope.APPLICATION, StorageTarget.MACHINE);\n\t\t}\n\t\tmodels.sort((a, b) => a.metadata.name.localeCompare(b.metadata.name));\n\t\treturn models.filter(entry => entry.metadata?.isUserSelectable && this.modelSupportedForDefaultAgent(entry));\n\t}\n\n\tprivate setCurrentLanguageModelToDefault() {\n\t\tconst allModels = this.getModels();\n\t\tconst defaultModel = allModels.find(m => m.metadata.isDefault) || allModels.find(m => m.metadata.isUserSelectable);\n\t\tif (defaultModel) {\n\t\t\tthis.setCurrentLanguageModel(defaultModel);\n\t\t}\n\t}\n\n\tprivate loadHistory(): HistoryNavigator2<IChatModelInputState> {\n\t\tconst history = this.historyService.getHistory(this.location);\n\t\tif (history.length === 0) {\n\t\t\thistory.push(this.getCurrentInputState());\n\t\t}\n\n\t\treturn new HistoryNavigator2(history, 50, historyKeyFn);\n\t}\n\n\t/**\n\t * Get the current input state for history\n\t */\n\tpublic getCurrentInputState(): IChatModelInputState {\n\t\tconst mode = this._currentModeObservable.get();\n\t\tconst state: IChatModelInputState = {\n\t\t\tinputText: this._inputEditor?.getValue() ?? '',\n\t\t\tattachments: this._attachmentModel.attachments,\n\t\t\tmode: {\n\t\t\t\tid: mode.id,\n\t\t\t\tkind: mode.kind\n\t\t\t},\n\t\t\tselectedModel: this._currentLanguageModel,\n\t\t\tselections: this._inputEditor?.getSelections() || [],\n\t\t\tcontrib: {},\n\t\t};\n\n\t\tfor (const contrib of this._widget?.contribs || Iterable.empty()) {\n\t\t\tcontrib.getInputState?.(state.contrib);\n\t\t}\n\n\t\treturn state;\n\t}\n\n\tprivate _getAriaLabel(): string {\n\t\tconst verbose = this.configurationService.getValue<boolean>(AccessibilityVerbositySettingId.Chat);\n\t\tlet kbLabel;\n\t\tif (verbose) {\n\t\t\tkbLabel = this.keybindingService.lookupKeybinding(AccessibilityCommandId.OpenAccessibilityHelp)?.getLabel();\n\t\t}\n\t\tconst mode = this._currentModeObservable.get();\n\n\t\t// Include model information if available\n\t\tconst modelName = this._currentLanguageModel?.metadata.name;\n\t\tconst modelInfo = modelName ? localize('chatInput.model', \", {0}. \", modelName) : '';\n\n\t\tlet modeLabel = '';\n\t\tif (!mode.isBuiltin) {\n\t\t\tconst mode = this.currentModeObs.get();\n\t\t\tmodeLabel = localize('chatInput.mode.custom', \"({0}), {1}\", mode.label.get(), mode.description.get());\n\t\t} else {\n\t\t\tswitch (this.currentModeKind) {\n\t\t\t\tcase ChatModeKind.Agent:\n\t\t\t\t\tmodeLabel = localize('chatInput.mode.agent', \"(Agent), edit files in your workspace.\");\n\t\t\t\t\tbreak;\n\t\t\t\tcase ChatModeKind.Edit:\n\t\t\t\t\tmodeLabel = localize('chatInput.mode.edit', \"(Edit), edit files in your workspace.\");\n\t\t\t\t\tbreak;\n\t\t\t\tcase ChatModeKind.Ask:\n\t\t\t\tdefault:\n\t\t\t\t\tmodeLabel = localize('chatInput.mode.ask', \"(Ask), ask questions or type / for topics.\");\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\tif (verbose) {\n\t\t\treturn kbLabel\n\t\t\t\t? localize('actions.chat.accessibiltyHelp', \"Chat Input {0}{1} Press Enter to send out the request. Use {2} for Chat Accessibility Help.\", modeLabel, modelInfo, kbLabel)\n\t\t\t\t: localize('chatInput.accessibilityHelpNoKb', \"Chat Input {0}{1} Press Enter to send out the request. Use the Chat Accessibility Help command for more information.\", modeLabel, modelInfo);\n\t\t} else {\n\t\t\treturn localize('chatInput.accessibilityHelp', \"Chat Input {0}{1}.\", modeLabel, modelInfo);\n\t\t}\n\t}\n\n\tprivate validateCurrentChatMode() {\n\t\tconst currentMode = this._currentModeObservable.get();\n\t\tconst validMode = this.chatModeService.findModeById(currentMode.id);\n\t\tif (!validMode) {\n\t\t\tthis.setChatMode(ChatModeKind.Agent);\n\t\t\treturn;\n\t\t}\n\t}\n\n\tinitForNewChatModel(state: IChatModelInputState | undefined, chatSessionIsEmpty: boolean): void {\n\t\tthis.history = this.loadHistory();\n\n\t\t// Note: With the new input model architecture, the state is synced automatically\n\t\t// from the model via _syncFromModel when setInputModel is called.\n\t\t// We only need to handle history here.\n\t\tthis.history.add(state ?? this.getCurrentInputState());\n\n\t\tthis.selectedToolsModel.resetSessionEnablementState();\n\n\t\t// TODO@roblourens This is for an experiment which will be obsolete in a month or two and can then be removed.\n\t\tif (chatSessionIsEmpty) {\n\t\t\tconst storageKey = this.getDefaultModeExperimentStorageKey();\n\t\t\tconst hasSetDefaultMode = this.storageService.getBoolean(storageKey, StorageScope.WORKSPACE, false);\n\t\t\tif (!hasSetDefaultMode) {\n\t\t\t\tconst isAnonymous = this.entitlementService.anonymous;\n\t\t\t\tthis.experimentService.getTreatment('chat.defaultMode')\n\t\t\t\t\t.then((defaultModeTreatment => {\n\t\t\t\t\t\tif (isAnonymous) {\n\t\t\t\t\t\t\t// be deterministic for anonymous users\n\t\t\t\t\t\t\t// to support agentic flows with default\n\t\t\t\t\t\t\t// model.\n\t\t\t\t\t\t\tdefaultModeTreatment = ChatModeKind.Agent;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (typeof defaultModeTreatment === 'string') {\n\t\t\t\t\t\t\tthis.storageService.store(storageKey, true, StorageScope.WORKSPACE, StorageTarget.MACHINE);\n\t\t\t\t\t\t\tconst defaultMode = validateChatMode(defaultModeTreatment);\n\t\t\t\t\t\t\tif (defaultMode) {\n\t\t\t\t\t\t\t\tthis.logService.trace(`Applying default mode from experiment: ${defaultMode}`);\n\t\t\t\t\t\t\t\tthis.setChatMode(defaultMode, false);\n\t\t\t\t\t\t\t\tthis.checkModelSupported();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}));\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate getDefaultModeExperimentStorageKey(): string {\n\t\tconst tag = this.options.widgetViewKindTag;\n\t\treturn `chat.${tag}.hasSetDefaultModeByExperiment`;\n\t}\n\n\tlogInputHistory(): void {\n\t\tconst historyStr = [...this.history].map(entry => JSON.stringify(entry)).join('\\n');\n\t\tthis.logService.info(`[${this.location}] Chat input history:`, historyStr);\n\t}\n\n\tsetVisible(visible: boolean): void {\n\t\tthis._onDidChangeVisibility.fire(visible);\n\t}\n\n\t/** If consumers are busy generating the chat input, returns the promise resolved when they finish */\n\tget generating() {\n\t\treturn this._generating?.defer.p;\n\t}\n\n\t/** Disables the input submissions buttons until the disposable is disposed. */\n\tstartGenerating(): IDisposable {\n\t\tthis.logService.trace('ChatWidget#startGenerating');\n\t\tif (this._generating) {\n\t\t\tthis._generating.rc++;\n\t\t} else {\n\t\t\tthis._generating = { rc: 1, defer: new DeferredPromise<void>() };\n\t\t}\n\n\t\treturn toDisposable(() => {\n\t\t\tthis.logService.trace('ChatWidget#doneGenerating');\n\t\t\tif (this._generating && !--this._generating.rc) {\n\t\t\t\tthis._generating.defer.complete();\n\t\t\t\tthis._generating = undefined;\n\t\t\t}\n\t\t});\n\t}\n\n\tget element(): HTMLElement {\n\t\treturn this.container;\n\t}\n\n\tprivate isStateEmpty(state: IChatModelInputState): boolean {\n\t\treturn state.inputText.trim().length === 0 && state.attachments.length === 0;\n\t}\n\n\tasync showPreviousValue(): Promise<void> {\n\t\tconst inputState = this.getCurrentInputState();\n\t\tthis.saveCurrentValue(inputState);\n\n\t\tconst current = this.history.current();\n\t\tif (current.inputText !== inputState.inputText && !this.isStateEmpty(inputState)) {\n\t\t\tthis.saveCurrentValue(inputState);\n\t\t\tthis.history.resetCursor();\n\t\t}\n\n\t\tthis.navigateHistory(true);\n\t}\n\n\tasync showNextValue(): Promise<void> {\n\t\tconst inputState = this.getCurrentInputState();\n\t\tif (this.history.isAtEnd()) {\n\t\t\treturn;\n\t\t} else {\n\t\t\tconst current = this.history.current();\n\t\t\tif (current.inputText !== inputState.inputText) {\n\t\t\t\tthis.saveCurrentValue(inputState);\n\t\t\t\tthis.history.resetCursor();\n\t\t\t}\n\t\t}\n\n\t\tthis.navigateHistory(false);\n\t}\n\n\tprivate async navigateHistory(previous: boolean): Promise<void> {\n\t\tconst historyEntry = previous ?\n\t\t\tthis.history.previous() : this.history.next();\n\n\t\tlet historyAttachments = historyEntry.attachments ?? [];\n\n\t\t// Check for images in history to restore the value.\n\t\tif (historyAttachments.length > 0) {\n\t\t\thistoryAttachments = (await Promise.all(historyAttachments.map(async (attachment) => {\n\t\t\t\tif (isImageVariableEntry(attachment) && attachment.references?.length && URI.isUri(attachment.references[0].reference)) {\n\t\t\t\t\tconst currReference = attachment.references[0].reference;\n\t\t\t\t\ttry {\n\t\t\t\t\t\tconst imageBinary = currReference.toString(true).startsWith('http') ? await this.sharedWebExtracterService.readImage(currReference, CancellationToken.None) : (await this.fileService.readFile(currReference)).value;\n\t\t\t\t\t\tif (!imageBinary) {\n\t\t\t\t\t\t\treturn undefined;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tconst newAttachment = { ...attachment };\n\t\t\t\t\t\tnewAttachment.value = (isImageVariableEntry(attachment) && attachment.isPasted) ? imageBinary.buffer : await resizeImage(imageBinary.buffer); // if pasted image, we do not need to resize.\n\t\t\t\t\t\treturn newAttachment;\n\t\t\t\t\t} catch (err) {\n\t\t\t\t\t\tthis.logService.error('Failed to fetch and reference.', err);\n\t\t\t\t\t\treturn undefined;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn attachment;\n\t\t\t}))).filter(attachment => attachment !== undefined);\n\t\t}\n\n\t\tthis._attachmentModel.clearAndSetContext(...historyAttachments);\n\n\t\taria.status(historyEntry.inputText);\n\t\tthis.setValue(historyEntry.inputText, true);\n\t\tthis._widget?.contribs.forEach(contrib => {\n\t\t\tcontrib.setInputState?.(historyEntry.contrib);\n\t\t});\n\t\tthis._onDidLoadInputState.fire();\n\n\t\tconst model = this._inputEditor.getModel();\n\t\tif (!model) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (previous) {\n\t\t\t// When navigating to previous history, always position cursor at the start (line 1, column 1)\n\t\t\t// This ensures that pressing up again will continue to navigate history\n\t\t\tthis._inputEditor.setPosition({ lineNumber: 1, column: 1 });\n\t\t} else {\n\t\t\tthis._inputEditor.setPosition(getLastPosition(model));\n\t\t}\n\t}\n\n\tsetValue(value: string, transient: boolean): void {\n\t\tthis.inputEditor.setValue(value);\n\t\t// always leave cursor at the end\n\t\tconst model = this.inputEditor.getModel();\n\t\tif (model) {\n\t\t\tthis.inputEditor.setPosition(getLastPosition(model));\n\t\t}\n\n\t\tif (!transient) {\n\t\t\tthis.saveCurrentValue(this.getCurrentInputState());\n\t\t}\n\t}\n\n\tprivate saveCurrentValue(inputState: IChatModelInputState): void {\n\t\tthis.history.replaceLast(inputState);\n\t}\n\n\tfocus() {\n\t\tthis._inputEditor.focus();\n\t}\n\n\thasFocus(): boolean {\n\t\treturn this._inputEditor.hasWidgetFocus();\n\t}\n\n\t/**\n\t * Reset the input and update history.\n\t * @param userQuery If provided, this will be added to the history. Followups and programmatic queries should not be passed.\n\t */\n\tasync acceptInput(isUserQuery?: boolean): Promise<void> {\n\t\tif (isUserQuery) {\n\t\t\tconst userQuery = this.getCurrentInputState();\n\t\t\tthis.history.replaceLast(userQuery);\n\t\t\tthis.history.add({ ...this.getCurrentInputState(), inputText: '', attachments: [], selections: [] });\n\t\t}\n\n\t\t// Clear attached context, fire event to clear input state, and clear the input editor\n\t\tthis.attachmentModel.clear();\n\t\tthis._onDidLoadInputState.fire();\n\t\tif (this.accessibilityService.isScreenReaderOptimized() && isMacintosh) {\n\t\t\tthis._acceptInputForVoiceover();\n\t\t} else {\n\t\t\tthis._inputEditor.focus();\n\t\t\tthis._inputEditor.setValue('');\n\t\t}\n\t}\n\n\tvalidateAgentMode(): void {\n\t\tif (!this.agentService.hasToolsAgent && this._currentModeObservable.get().kind === ChatModeKind.Agent) {\n\t\t\tthis.setChatMode(ChatModeKind.Edit);\n\t\t}\n\t}\n\n\tprivate _acceptInputForVoiceover(): void {\n\t\tconst domNode = this._inputEditor.getDomNode();\n\t\tif (!domNode) {\n\t\t\treturn;\n\t\t}\n\t\t// Remove the input editor from the DOM temporarily to prevent VoiceOver\n\t\t// from reading the cleared text (the request) to the user.\n\t\tdomNode.remove();\n\t\tthis._inputEditor.setValue('');\n\t\tthis._inputEditorElement.appendChild(domNode);\n\t\tthis._inputEditor.focus();\n\t}\n\n\tprivate _handleAttachedContextChange() {\n\t\tthis._hasFileAttachmentContextKey.set(Boolean(this._attachmentModel.attachments.find(a => a.kind === 'file')));\n\t\tthis.renderAttachedContext();\n\t}\n\n\tprivate getOrCreateOptionEmitter(optionGroupId: string): Emitter<IChatSessionProviderOptionItem> {\n\t\tlet emitter = this._chatSessionOptionEmitters.get(optionGroupId);\n\t\tif (!emitter) {\n\t\t\temitter = this._register(new Emitter<IChatSessionProviderOptionItem>());\n\t\t\tthis._chatSessionOptionEmitters.set(optionGroupId, emitter);\n\t\t}\n\t\treturn emitter;\n\t}\n\n\t/**\n\t * Refresh all registered option groups for the current chat session.\n\t * Fires events for each option group with their current selection.\n\t */\n\tprivate refreshChatSessionPickers(): void {\n\t\tconst sessionResource = this._widget?.viewModel?.model.sessionResource;\n\t\tconst hideAll = () => {\n\t\t\tthis.chatSessionHasOptions.set(false);\n\t\t\tthis.hideAllSessionPickerWidgets();\n\t\t};\n\n\t\tif (!sessionResource) {\n\t\t\treturn hideAll();\n\t\t}\n\t\tconst ctx = this.chatService.getChatSessionFromInternalUri(sessionResource);\n\t\tif (!ctx) {\n\t\t\treturn hideAll();\n\t\t}\n\t\tconst optionGroups = this.chatSessionsService.getOptionGroupsForSessionType(ctx.chatSessionType);\n\t\tif (!optionGroups || optionGroups.length === 0) {\n\t\t\treturn hideAll();\n\t\t}\n\n\t\tif (!this.chatSessionsService.hasAnySessionOptions(ctx.chatSessionResource)) {\n\t\t\treturn hideAll();\n\t\t}\n\n\t\tthis.chatSessionHasOptions.set(true);\n\n\t\tconst currentWidgetGroupIds = new Set(this.chatSessionPickerWidgets.keys());\n\t\tconst requiredGroupIds = new Set(optionGroups.map(g => g.id));\n\n\t\tconst needsRecreation =\n\t\t\tcurrentWidgetGroupIds.size !== requiredGroupIds.size ||\n\t\t\t!Array.from(requiredGroupIds).every(id => currentWidgetGroupIds.has(id));\n\n\t\tif (needsRecreation && this._lastSessionPickerAction && this.chatSessionPickerContainer) {\n\t\t\tconst widgets = this.createChatSessionPickerWidgets(this._lastSessionPickerAction);\n\t\t\tdom.clearNode(this.chatSessionPickerContainer);\n\t\t\tfor (const widget of widgets) {\n\t\t\t\tconst container = dom.$('.action-item.chat-sessionPicker-item');\n\t\t\t\twidget.render(container);\n\t\t\t\tthis.chatSessionPickerContainer.appendChild(container);\n\t\t\t}\n\t\t}\n\n\t\tif (this.chatSessionPickerContainer) {\n\t\t\tthis.chatSessionPickerContainer.style.display = '';\n\t\t}\n\n\t\tfor (const [optionGroupId] of this.chatSessionPickerWidgets.entries()) {\n\t\t\tconst currentOption = this.chatSessionsService.getSessionOption(ctx.chatSessionResource, optionGroupId);\n\t\t\tif (currentOption) {\n\t\t\t\tconst optionGroup = optionGroups.find(g => g.id === optionGroupId);\n\t\t\t\tif (optionGroup) {\n\t\t\t\t\tconst item = optionGroup.items.find(m => m.id === currentOption);\n\t\t\t\t\tif (item) {\n\t\t\t\t\t\tthis.getOrCreateOptionEmitter(optionGroupId).fire(item);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate hideAllSessionPickerWidgets(): void {\n\t\tif (this.chatSessionPickerContainer) {\n\t\t\tthis.chatSessionPickerContainer.style.display = 'none';\n\t\t}\n\t}\n\n\tprivate disposeSessionPickerWidgets(): void {\n\t\tfor (const widget of this.chatSessionPickerWidgets.values()) {\n\t\t\twidget.dispose();\n\t\t}\n\t\tthis.chatSessionPickerWidgets.clear();\n\t}\n\n\t/**\n\t * Get the current option for a specific option group.\n\t * If no option is currently set, initializes with the first item as default.\n\t */\n\tprivate getCurrentOptionForGroup(optionGroupId: string): IChatSessionProviderOptionItem | undefined {\n\t\tconst sessionResource = this._widget?.viewModel?.model.sessionResource;\n\t\tif (!sessionResource) {\n\t\t\treturn;\n\t\t}\n\t\tconst ctx = this.chatService.getChatSessionFromInternalUri(sessionResource);\n\t\tif (!ctx) {\n\t\t\treturn;\n\t\t}\n\t\tconst optionGroups = this.chatSessionsService.getOptionGroupsForSessionType(ctx.chatSessionType);\n\t\tconst optionGroup = optionGroups?.find(g => g.id === optionGroupId);\n\t\tif (!optionGroup || optionGroup.items.length === 0) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst currentOptionValue = this.chatSessionsService.getSessionOption(ctx.chatSessionResource, optionGroupId);\n\t\tif (!currentOptionValue) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (typeof currentOptionValue === 'string') {\n\t\t\treturn optionGroup.items.find(m => m.id === currentOptionValue);\n\t\t} else {\n\t\t\treturn currentOptionValue as IChatSessionProviderOptionItem;\n\t\t}\n\n\t}\n\n\trender(container: HTMLElement, initialValue: string, widget: IChatWidget) {\n\t\tthis._widget = widget;\n\n\t\tlet elements;\n\t\tif (this.options.renderStyle === 'compact') {\n\t\t\telements = dom.h('.interactive-input-part', [\n\t\t\t\tdom.h('.interactive-input-and-edit-session', [\n\t\t\t\t\tdom.h('.chat-todo-list-widget-container@chatInputTodoListWidgetContainer'),\n\t\t\t\t\tdom.h('.chat-editing-session@chatEditingSessionWidgetContainer'),\n\t\t\t\t\tdom.h('.interactive-input-and-side-toolbar@inputAndSideToolbar', [\n\t\t\t\t\t\tdom.h('.chat-input-container@inputContainer', [\n\t\t\t\t\t\t\tdom.h('.chat-editor-container@editorContainer'),\n\t\t\t\t\t\t\tdom.h('.chat-input-toolbars@inputToolbars'),\n\t\t\t\t\t\t]),\n\t\t\t\t\t]),\n\t\t\t\t\tdom.h('.chat-attachments-container@attachmentsContainer', [\n\t\t\t\t\t\tdom.h('.chat-attachment-toolbar@attachmentToolbar'),\n\t\t\t\t\t\tdom.h('.chat-attached-context@attachedContextContainer'),\n\t\t\t\t\t\tdom.h('.chat-related-files@relatedFilesContainer'),\n\t\t\t\t\t]),\n\t\t\t\t\tdom.h('.interactive-input-followups@followupsContainer'),\n\t\t\t\t])\n\t\t\t]);\n\t\t} else {\n\t\t\telements = dom.h('.interactive-input-part', [\n\t\t\t\tdom.h('.interactive-input-followups@followupsContainer'),\n\t\t\t\tdom.h('.chat-todo-list-widget-container@chatInputTodoListWidgetContainer'),\n\t\t\t\tdom.h('.chat-editing-session@chatEditingSessionWidgetContainer'),\n\t\t\t\tdom.h('.interactive-input-and-side-toolbar@inputAndSideToolbar', [\n\t\t\t\t\tdom.h('.chat-input-container@inputContainer', [\n\t\t\t\t\t\tdom.h('.chat-attachments-container@attachmentsContainer', [\n\t\t\t\t\t\t\tdom.h('.chat-attachment-toolbar@attachmentToolbar'),\n\t\t\t\t\t\t\tdom.h('.chat-related-files@relatedFilesContainer'),\n\t\t\t\t\t\t\tdom.h('.chat-attached-context@attachedContextContainer'),\n\t\t\t\t\t\t]),\n\t\t\t\t\t\tdom.h('.chat-editor-container@editorContainer'),\n\t\t\t\t\t\tdom.h('.chat-input-toolbars@inputToolbars'),\n\t\t\t\t\t]),\n\t\t\t\t]),\n\t\t\t]);\n\t\t}\n\t\tthis.container = elements.root;\n\t\tthis.chatInputOverlay = dom.$('.chat-input-overlay');\n\t\tcontainer.append(this.container);\n\t\tthis.container.append(this.chatInputOverlay);\n\t\tthis.container.classList.toggle('compact', this.options.renderStyle === 'compact');\n\t\tthis.followupsContainer = elements.followupsContainer;\n\t\tconst inputAndSideToolbar = elements.inputAndSideToolbar; // The chat input and toolbar to the right\n\t\tconst inputContainer = elements.inputContainer; // The chat editor, attachments, and toolbars\n\t\tconst editorContainer = elements.editorContainer;\n\t\tthis.attachmentsContainer = elements.attachmentsContainer;\n\t\tthis.attachedContextContainer = elements.attachedContextContainer;\n\t\tthis.relatedFilesContainer = elements.relatedFilesContainer;\n\t\tconst toolbarsContainer = elements.inputToolbars;\n\t\tconst attachmentToolbarContainer = elements.attachmentToolbar;\n\t\tthis.chatEditingSessionWidgetContainer = elements.chatEditingSessionWidgetContainer;\n\t\tthis.chatInputTodoListWidgetContainer = elements.chatInputTodoListWidgetContainer;\n\n\t\tif (this.options.enableImplicitContext) {\n\t\t\tthis._implicitContext = this._register(\n\t\t\t\tthis.instantiationService.createInstance(ChatImplicitContext),\n\t\t\t);\n\n\t\t\tthis._register(this._implicitContext.onDidChangeValue(() => {\n\t\t\t\tthis._indexOfLastAttachedContextDeletedWithKeyboard = -1;\n\t\t\t\tthis._handleAttachedContextChange();\n\t\t\t}));\n\t\t}\n\n\t\tthis.renderAttachedContext();\n\t\tthis._register(this._attachmentModel.onDidChange((e) => {\n\t\t\tif (e.added.length > 0) {\n\t\t\t\tthis._indexOfLastAttachedContextDeletedWithKeyboard = -1;\n\t\t\t}\n\t\t\tthis._handleAttachedContextChange();\n\t\t}));\n\n\t\tthis.renderChatEditingSessionState(null);\n\n\t\tif (this.options.renderWorkingSet) {\n\t\t\tthis._relatedFiles = this._register(new ChatRelatedFiles());\n\t\t\tthis._register(this._relatedFiles.onDidChange(() => this.renderChatRelatedFiles()));\n\t\t}\n\t\tthis.renderChatRelatedFiles();\n\n\t\tthis.dnd.addOverlay(this.options.dndContainer ?? container, this.options.dndContainer ?? container);\n\n\t\tconst inputScopedContextKeyService = this._register(this.contextKeyService.createScoped(inputContainer));\n\t\tChatContextKeys.inChatInput.bindTo(inputScopedContextKeyService).set(true);\n\t\tthis.currentlyEditingInputKey = ChatContextKeys.currentlyEditingInput.bindTo(inputScopedContextKeyService);\n\t\tconst scopedInstantiationService = this._register(this.instantiationService.createChild(new ServiceCollection([IContextKeyService, inputScopedContextKeyService])));\n\n\t\tconst { historyNavigationBackwardsEnablement, historyNavigationForwardsEnablement } = this._register(registerAndCreateHistoryNavigationContext(inputScopedContextKeyService, this));\n\t\tthis.historyNavigationBackwardsEnablement = historyNavigationBackwardsEnablement;\n\t\tthis.historyNavigationForewardsEnablement = historyNavigationForwardsEnablement;\n\n\t\tconst options: IEditorConstructionOptions = getSimpleEditorOptions(this.configurationService);\n\t\toptions.overflowWidgetsDomNode = this.options.editorOverflowWidgetsDomNode;\n\t\toptions.pasteAs = EditorOptions.pasteAs.defaultValue;\n\t\toptions.readOnly = false;\n\t\toptions.ariaLabel = this._getAriaLabel();\n\t\toptions.fontFamily = DEFAULT_FONT_FAMILY;\n\t\toptions.fontSize = 13;\n\t\toptions.lineHeight = 20;\n\t\toptions.padding = this.options.renderStyle === 'compact' ? { top: 2, bottom: 2 } : { top: 8, bottom: 8 };\n\t\toptions.cursorWidth = 1;\n\t\toptions.wrappingStrategy = 'advanced';\n\t\toptions.bracketPairColorization = { enabled: false };\n\t\t// Respect user's editor settings for auto-closing and auto-surrounding behavior\n\t\toptions.autoClosingBrackets = this.configurationService.getValue('editor.autoClosingBrackets');\n\t\toptions.autoClosingQuotes = this.configurationService.getValue('editor.autoClosingQuotes');\n\t\toptions.autoSurround = this.configurationService.getValue('editor.autoSurround');\n\t\toptions.suggest = {\n\t\t\tshowIcons: true,\n\t\t\tshowSnippets: false,\n\t\t\tshowWords: true,\n\t\t\tshowStatusBar: false,\n\t\t\tinsertMode: 'insert',\n\t\t};\n\t\toptions.scrollbar = { ...(options.scrollbar ?? {}), vertical: 'hidden' };\n\t\toptions.stickyScroll = { enabled: false };\n\n\t\tthis._inputEditorElement = dom.append(editorContainer, $(chatInputEditorContainerSelector));\n\t\tconst editorOptions = getSimpleCodeEditorWidgetOptions();\n\t\teditorOptions.contributions?.push(...EditorExtensionsRegistry.getSomeEditorContributions([ContentHoverController.ID, GlyphHoverController.ID, DropIntoEditorController.ID, CopyPasteController.ID, LinkDetector.ID]));\n\t\tthis._inputEditor = this._register(scopedInstantiationService.createInstance(CodeEditorWidget, this._inputEditorElement, options, editorOptions));\n\n\t\tSuggestController.get(this._inputEditor)?.forceRenderingAbove();\n\t\toptions.overflowWidgetsDomNode?.classList.add('hideSuggestTextIcons');\n\t\tthis._inputEditorElement.classList.add('hideSuggestTextIcons');\n\n\t\t// Prevent Enter key from creating new lines - but respect user's custom keybindings\n\t\t// Only prevent default behavior if ChatSubmitAction is bound to Enter AND its precondition is met\n\t\tthis._register(this._inputEditor.onKeyDown((e) => {\n\t\t\tif (e.keyCode === KeyCode.Enter && !hasModifierKeys(e)) {\n\t\t\t\t// Check if ChatSubmitAction has a keybinding for plain Enter in the current context\n\t\t\t\t// This respects user's custom keybindings that disable the submit action\n\t\t\t\tfor (const keybinding of this.keybindingService.lookupKeybindings(ChatSubmitAction.ID)) {\n\t\t\t\t\tconst chords = keybinding.getDispatchChords();\n\t\t\t\t\tconst isPlainEnter = chords.length === 1 && chords[0] === '[Enter]';\n\t\t\t\t\tif (isPlainEnter) {\n\t\t\t\t\t\t// Do NOT call stopPropagation() so the keybinding service can still process this event\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}));\n\n\t\tthis._register(this._inputEditor.onDidChangeModelContent(() => {\n\t\t\tconst currentHeight = Math.min(this._inputEditor.getContentHeight(), this.inputEditorMaxHeight);\n\t\t\tif (currentHeight !== this.inputEditorHeight) {\n\t\t\t\tthis.inputEditorHeight = currentHeight;\n\t\t\t\tthis._onDidChangeHeight.fire();\n\t\t\t}\n\n\t\t\tconst model = this._inputEditor.getModel();\n\t\t\tconst inputHasText = !!model && model.getValue().trim().length > 0;\n\t\t\tthis.inputEditorHasText.set(inputHasText);\n\n\t\t\t// Debounced sync to model for text changes\n\t\t\tthis._syncTextDebounced.schedule();\n\t\t}));\n\t\tthis._register(this._inputEditor.onDidContentSizeChange(e => {\n\t\t\tif (e.contentHeightChanged) {\n\t\t\t\tthis.inputEditorHeight = !this.inline ? e.contentHeight : this.inputEditorHeight;\n\t\t\t\tthis._onDidChangeHeight.fire();\n\t\t\t}\n\t\t}));\n\t\tthis._register(this._inputEditor.onDidFocusEditorText(() => {\n\t\t\tthis.inputEditorHasFocus.set(true);\n\t\t\tthis._onDidFocus.fire();\n\t\t\tinputContainer.classList.toggle('focused', true);\n\t\t}));\n\t\tthis._register(this._inputEditor.onDidBlurEditorText(() => {\n\t\t\tthis.inputEditorHasFocus.set(false);\n\t\t\tinputContainer.classList.toggle('focused', false);\n\n\t\t\tthis._onDidBlur.fire();\n\t\t}));\n\t\tthis._register(this._inputEditor.onDidBlurEditorWidget(() => {\n\t\t\tCopyPasteController.get(this._inputEditor)?.clearWidgets();\n\t\t\tDropIntoEditorController.get(this._inputEditor)?.clearWidgets();\n\t\t}));\n\n\t\tconst hoverDelegate = this._register(createInstantHoverDelegate());\n\n\t\tthis._register(dom.addStandardDisposableListener(toolbarsContainer, dom.EventType.CLICK, e => this.inputEditor.focus()));\n\t\tthis._register(dom.addStandardDisposableListener(this.attachmentsContainer, dom.EventType.CLICK, e => this.inputEditor.focus()));\n\t\tthis.inputActionsToolbar = this._register(this.instantiationService.createInstance(MenuWorkbenchToolBar, this.options.renderInputToolbarBelowInput ? this.attachmentsContainer : toolbarsContainer, MenuId.ChatInput, {\n\t\t\ttelemetrySource: this.options.menus.telemetrySource,\n\t\t\tmenuOptions: { shouldForwardArgs: true },\n\t\t\thiddenItemStrategy: HiddenItemStrategy.NoHide,\n\t\t\thoverDelegate,\n\t\t\tactionViewItemProvider: (action, options) => {\n\t\t\t\tif (action.id === ChatOpenModelPickerActionId && action instanceof MenuItemAction) {\n\t\t\t\t\tif (!this._currentLanguageModel) {\n\t\t\t\t\t\tthis.setCurrentLanguageModelToDefault();\n\t\t\t\t\t}\n\n\t\t\t\t\tconst itemDelegate: IModelPickerDelegate = {\n\t\t\t\t\t\tgetCurrentModel: () => this._currentLanguageModel,\n\t\t\t\t\t\tonDidChangeModel: this._onDidChangeCurrentLanguageModel.event,\n\t\t\t\t\t\tsetModel: (model: ILanguageModelChatMetadataAndIdentifier) => {\n\t\t\t\t\t\t\tthis._waitForPersistedLanguageModel.clear();\n\t\t\t\t\t\t\tthis.setCurrentLanguageModel(model);\n\t\t\t\t\t\t\tthis.renderAttachedContext();\n\t\t\t\t\t\t},\n\t\t\t\t\t\tgetModels: () => this.getModels()\n\t\t\t\t\t};\n\t\t\t\t\treturn this.modelWidget = this.instantiationService.createInstance(ModelPickerActionItem, action, this._currentLanguageModel, undefined, itemDelegate);\n\t\t\t\t} else if (action.id === OpenModePickerAction.ID && action instanceof MenuItemAction) {\n\t\t\t\t\tconst delegate: IModePickerDelegate = {\n\t\t\t\t\t\tcurrentMode: this._currentModeObservable,\n\t\t\t\t\t\tsessionResource: () => this._widget?.viewModel?.sessionResource,\n\t\t\t\t\t};\n\t\t\t\t\treturn this.modeWidget = this.instantiationService.createInstance(ModePickerActionItem, action, delegate);\n\t\t\t\t} else if (action.id === ChatSessionPrimaryPickerAction.ID && action instanceof MenuItemAction) {\n\t\t\t\t\t// Create all pickers and return a container action view item\n\t\t\t\t\tconst widgets = this.createChatSessionPickerWidgets(action);\n\t\t\t\t\tif (widgets.length === 0) {\n\t\t\t\t\t\treturn undefined;\n\t\t\t\t\t}\n\t\t\t\t\t// Create a container to hold all picker widgets\n\t\t\t\t\treturn this.instantiationService.createInstance(ChatSessionPickersContainerActionItem, action, widgets);\n\t\t\t\t}\n\t\t\t\treturn undefined;\n\t\t\t}\n\t\t}));\n\t\tthis.inputActionsToolbar.getElement().classList.add('chat-input-toolbar');\n\t\tthis.inputActionsToolbar.context = { widget } satisfies IChatExecuteActionContext;\n\t\tthis._register(this.inputActionsToolbar.onDidChangeMenuItems(() => {\n\t\t\t// Update container reference for the pickers\n\t\t\tconst toolbarElement = this.inputActionsToolbar.getElement();\n\t\t\t// eslint-disable-next-line no-restricted-syntax\n\t\t\tconst container = toolbarElement.querySelector('.chat-sessionPicker-container');\n\t\t\tthis.chatSessionPickerContainer = container as HTMLElement | undefined;\n\n\t\t\tif (this.cachedDimensions && typeof this.cachedInputToolbarWidth === 'number' && this.cachedInputToolbarWidth !== this.inputActionsToolbar.getItemsWidth()) {\n\t\t\t\tthis.layout(this.cachedDimensions.height, this.cachedDimensions.width);\n\t\t\t}\n\t\t}));\n\t\tthis.executeToolbar = this._register(this.instantiationService.createInstance(MenuWorkbenchToolBar, toolbarsContainer, this.options.menus.executeToolbar, {\n\t\t\ttelemetrySource: this.options.menus.telemetrySource,\n\t\t\tmenuOptions: {\n\t\t\t\tshouldForwardArgs: true\n\t\t\t},\n\t\t\thoverDelegate,\n\t\t\thiddenItemStrategy: HiddenItemStrategy.NoHide,\n\t\t\tactionViewItemProvider: (action, options) => {\n\t\t\t\tif (action.id === ContinueChatInSessionAction.ID && action instanceof MenuItemAction) {\n\t\t\t\t\treturn this.instantiationService.createInstance(ChatContinueInSessionActionItem, action);\n\t\t\t\t}\n\t\t\t\treturn undefined;\n\t\t\t}\n\t\t}));\n\t\tthis.executeToolbar.getElement().classList.add('chat-execute-toolbar');\n\t\tthis.executeToolbar.context = { widget } satisfies IChatExecuteActionContext;\n\t\tthis._register(this.executeToolbar.onDidChangeMenuItems(() => {\n\t\t\tif (this.cachedDimensions && typeof this.cachedExecuteToolbarWidth === 'number' && this.cachedExecuteToolbarWidth !== this.executeToolbar.getItemsWidth()) {\n\t\t\t\tthis.layout(this.cachedDimensions.height, this.cachedDimensions.width);\n\t\t\t}\n\t\t}));\n\t\tif (this.options.menus.inputSideToolbar) {\n\t\t\tconst toolbarSide = this._register(this.instantiationService.createInstance(MenuWorkbenchToolBar, inputAndSideToolbar, this.options.menus.inputSideToolbar, {\n\t\t\t\ttelemetrySource: this.options.menus.telemetrySource,\n\t\t\t\tmenuOptions: {\n\t\t\t\t\tshouldForwardArgs: true\n\t\t\t\t},\n\t\t\t\thoverDelegate\n\t\t\t}));\n\t\t\tthis.inputSideToolbarContainer = toolbarSide.getElement();\n\t\t\ttoolbarSide.getElement().classList.add('chat-side-toolbar');\n\t\t\ttoolbarSide.context = { widget } satisfies IChatExecuteActionContext;\n\t\t}\n\n\t\tlet inputModel = this.modelService.getModel(this.inputUri);\n\t\tif (!inputModel) {\n\t\t\tinputModel = this.modelService.createModel('', null, this.inputUri, true);\n\t\t}\n\n\t\tthis.textModelResolverService.createModelReference(this.inputUri).then(ref => {\n\t\t\t// make sure to hold a reference so that the model doesn't get disposed by the text model service\n\t\t\tif (this._store.isDisposed) {\n\t\t\t\tref.dispose();\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis._register(ref);\n\t\t});\n\n\t\tthis.inputModel = inputModel;\n\t\tthis.inputModel.updateOptions({ bracketColorizationOptions: { enabled: false, independentColorPoolPerBracketType: false } });\n\t\tthis._inputEditor.setModel(this.inputModel);\n\t\tif (initialValue) {\n\t\t\tthis.inputModel.setValue(initialValue);\n\t\t\tconst lineNumber = this.inputModel.getLineCount();\n\t\t\tthis._inputEditor.setPosition({ lineNumber, column: this.inputModel.getLineMaxColumn(lineNumber) });\n\t\t}\n\n\t\tconst onDidChangeCursorPosition = () => {\n\t\t\tconst model = this._inputEditor.getModel();\n\t\t\tif (!model) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst position = this._inputEditor.getPosition();\n\t\t\tif (!position) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst atTop = position.lineNumber === 1 && position.column === 1;\n\t\t\tthis.chatCursorAtTop.set(atTop);\n\n\t\t\tthis.historyNavigationBackwardsEnablement.set(atTop);\n\t\t\tthis.historyNavigationForewardsEnablement.set(position.equals(getLastPosition(model)));\n\n\t\t\t// Sync cursor and selection to model\n\t\t\tthis._syncInputStateToModel();\n\t\t};\n\t\tthis._register(this._inputEditor.onDidChangeCursorPosition(e => onDidChangeCursorPosition()));\n\t\tonDidChangeCursorPosition();\n\n\t\tthis._register(this.themeService.onDidFileIconThemeChange(() => {\n\t\t\tthis.renderAttachedContext();\n\t\t}));\n\n\t\tthis.addFilesToolbar = this._register(this.instantiationService.createInstance(MenuWorkbenchToolBar, attachmentToolbarContainer, MenuId.ChatInputAttachmentToolbar, {\n\t\t\ttelemetrySource: this.options.menus.telemetrySource,\n\t\t\tlabel: true,\n\t\t\tmenuOptions: { shouldForwardArgs: true, renderShortTitle: true },\n\t\t\thiddenItemStrategy: HiddenItemStrategy.NoHide,\n\t\t\thoverDelegate,\n\t\t\tactionViewItemProvider: (action, options) => {\n\t\t\t\tif (action.id === 'workbench.action.chat.attachContext') {\n\t\t\t\t\tconst viewItem = this.instantiationService.createInstance(AddFilesButton, this._attachmentModel, action, options);\n\t\t\t\t\tviewItem.setShowLabel(this._attachmentModel.size === 0 && !this.hasImplicitContextBlock());\n\t\t\t\t\tthis.addFilesButton = viewItem;\n\t\t\t\t\treturn this.addFilesButton;\n\t\t\t\t}\n\t\t\t\treturn undefined;\n\t\t\t}\n\t\t}));\n\t\tthis.addFilesToolbar.context = { widget, placeholder: localize('chatAttachFiles', 'Search for files and context to add to your request') };\n\t\tthis._register(this.addFilesToolbar.onDidChangeMenuItems(() => {\n\t\t\tif (this.cachedDimensions) {\n\t\t\t\tthis._onDidChangeHeight.fire();\n\t\t\t}\n\t\t}));\n\t}\n\n\tpublic toggleChatInputOverlay(editing: boolean): void {\n\t\tthis.chatInputOverlay.classList.toggle('disabled', editing);\n\t\tif (editing) {\n\t\t\tthis.overlayClickListener.value = dom.addStandardDisposableListener(this.chatInputOverlay, dom.EventType.CLICK, e => {\n\t\t\t\te.preventDefault();\n\t\t\t\te.stopPropagation();\n\t\t\t\tthis._onDidClickOverlay.fire();\n\t\t\t});\n\t\t} else {\n\t\t\tthis.overlayClickListener.clear();\n\t\t}\n\t}\n\n\tpublic renderAttachedContext() {\n\t\tconst container = this.attachedContextContainer;\n\t\t// Note- can't measure attachedContextContainer, because it has `display: contents`, so measure the parent to check for height changes\n\t\tconst oldHeight = this.attachmentsContainer.offsetHeight;\n\t\tconst store = new DisposableStore();\n\t\tthis.attachedContextDisposables.value = store;\n\n\t\tdom.clearNode(container);\n\n\t\tstore.add(dom.addStandardDisposableListener(this.attachmentsContainer, dom.EventType.KEY_DOWN, (e: StandardKeyboardEvent) => {\n\t\t\tthis.handleAttachmentNavigation(e);\n\t\t}));\n\n\t\tconst attachments = [...this.attachmentModel.attachments.entries()];\n\t\tconst hasAttachments = Boolean(attachments.length) || Boolean(this.implicitContext?.value);\n\t\tdom.setVisibility(Boolean(this.options.renderInputToolbarBelowInput || hasAttachments || (this.addFilesToolbar && !this.addFilesToolbar.isEmpty())), this.attachmentsContainer);\n\t\tdom.setVisibility(hasAttachments, this.attachedContextContainer);\n\t\tif (!attachments.length) {\n\t\t\tthis._indexOfLastAttachedContextDeletedWithKeyboard = -1;\n\t\t\tthis._indexOfLastOpenedContext = -1;\n\t\t}\n\n\t\tconst isSuggestedEnabled = this.configurationService.getValue<boolean>('chat.implicitContext.suggestedContext');\n\n\t\tif (this.implicitContext?.value && !isSuggestedEnabled) {\n\t\t\tconst implicitPart = store.add(this.instantiationService.createInstance(ImplicitContextAttachmentWidget, this.implicitContext, this._contextResourceLabels, this.attachmentModel));\n\t\t\tcontainer.appendChild(implicitPart.domNode);\n\t\t}\n\n\t\tfor (const [index, attachment] of attachments) {\n\t\t\tconst resource = URI.isUri(attachment.value) ? attachment.value : isLocation(attachment.value) ? attachment.value.uri : undefined;\n\t\t\tconst range = isLocation(attachment.value) ? attachment.value.range : undefined;\n\t\t\tconst shouldFocusClearButton = index === Math.min(this._indexOfLastAttachedContextDeletedWithKeyboard, this.attachmentModel.size - 1) && this._indexOfLastAttachedContextDeletedWithKeyboard > -1;\n\n\t\t\tlet attachmentWidget;\n\t\t\tconst options = { shouldFocusClearButton, supportsDeletion: true };\n\t\t\tif (attachment.kind === 'tool' || attachment.kind === 'toolset') {\n\t\t\t\tattachmentWidget = this.instantiationService.createInstance(ToolSetOrToolItemAttachmentWidget, attachment, this._currentLanguageModel, options, container, this._contextResourceLabels);\n\t\t\t} else if (resource && isNotebookOutputVariableEntry(attachment)) {\n\t\t\t\tattachmentWidget = this.instantiationService.createInstance(NotebookCellOutputChatAttachmentWidget, resource, attachment, this._currentLanguageModel, options, container, this._contextResourceLabels);\n\t\t\t} else if (isPromptFileVariableEntry(attachment)) {\n\t\t\t\tattachmentWidget = this.instantiationService.createInstance(PromptFileAttachmentWidget, attachment, this._currentLanguageModel, options, container, this._contextResourceLabels);\n\t\t\t} else if (isPromptTextVariableEntry(attachment)) {\n\t\t\t\tattachmentWidget = this.instantiationService.createInstance(PromptTextAttachmentWidget, attachment, undefined, options, container, this._contextResourceLabels);\n\t\t\t} else if (resource && (attachment.kind === 'file' || attachment.kind === 'directory')) {\n\t\t\t\tattachmentWidget = this.instantiationService.createInstance(FileAttachmentWidget, resource, range, attachment, undefined, this._currentLanguageModel, options, container, this._contextResourceLabels);\n\t\t\t} else if (attachment.kind === 'terminalCommand') {\n\t\t\t\tattachmentWidget = this.instantiationService.createInstance(TerminalCommandAttachmentWidget, attachment, this._currentLanguageModel, options, container, this._contextResourceLabels);\n\t\t\t} else if (isImageVariableEntry(attachment)) {\n\t\t\t\tattachmentWidget = this.instantiationService.createInstance(ImageAttachmentWidget, resource, attachment, this._currentLanguageModel, options, container, this._contextResourceLabels);\n\t\t\t} else if (isElementVariableEntry(attachment)) {\n\t\t\t\tattachmentWidget = this.instantiationService.createInstance(ElementChatAttachmentWidget, attachment, this._currentLanguageModel, options, container, this._contextResourceLabels);\n\t\t\t} else if (isPasteVariableEntry(attachment)) {\n\t\t\t\tattachmentWidget = this.instantiationService.createInstance(PasteAttachmentWidget, attachment, this._currentLanguageModel, options, container, this._contextResourceLabels);\n\t\t\t} else if (isSCMHistoryItemVariableEntry(attachment)) {\n\t\t\t\tattachmentWidget = this.instantiationService.createInstance(SCMHistoryItemAttachmentWidget, attachment, this._currentLanguageModel, options, container, this._contextResourceLabels);\n\t\t\t} else if (isSCMHistoryItemChangeVariableEntry(attachment)) {\n\t\t\t\tattachmentWidget = this.instantiationService.createInstance(SCMHistoryItemChangeAttachmentWidget, attachment, this._currentLanguageModel, options, container, this._contextResourceLabels);\n\t\t\t} else if (isSCMHistoryItemChangeRangeVariableEntry(attachment)) {\n\t\t\t\tattachmentWidget = this.instantiationService.createInstance(SCMHistoryItemChangeRangeAttachmentWidget, attachment, this._currentLanguageModel, options, container, this._contextResourceLabels);\n\t\t\t} else {\n\t\t\t\tattachmentWidget = this.instantiationService.createInstance(DefaultChatAttachmentWidget, resource, range, attachment, undefined, this._currentLanguageModel, options, container, this._contextResourceLabels);\n\t\t\t}\n\n\t\t\tif (shouldFocusClearButton) {\n\t\t\t\tattachmentWidget.element.focus();\n\t\t\t}\n\n\t\t\tif (index === Math.min(this._indexOfLastOpenedContext, this.attachmentModel.size - 1)) {\n\t\t\t\tattachmentWidget.element.focus();\n\t\t\t}\n\n\t\t\tstore.add(attachmentWidget);\n\t\t\tstore.add(attachmentWidget.onDidDelete(e => {\n\t\t\t\tthis.handleAttachmentDeletion(e, index, attachment);\n\t\t\t}));\n\n\t\t\tstore.add(attachmentWidget.onDidOpen(e => {\n\t\t\t\tthis.handleAttachmentOpen(index, attachment);\n\t\t\t}));\n\t\t}\n\n\t\tconst implicitValue = this.implicitContext?.value;\n\n\t\tif (isSuggestedEnabled && implicitValue) {\n\t\t\tconst targetUri: URI | undefined = this.implicitContext.uri;\n\n\t\t\tconst currentlyAttached = attachments.some(([, attachment]) => {\n\t\t\t\tlet uri: URI | undefined;\n\t\t\t\tif (URI.isUri(attachment.value)) {\n\t\t\t\t\turi = attachment.value;\n\t\t\t\t} else if (isStringVariableEntry(attachment)) {\n\t\t\t\t\turi = attachment.uri;\n\t\t\t\t}\n\t\t\t\treturn uri && isEqual(uri, targetUri);\n\t\t\t});\n\n\t\t\tconst shouldShowImplicit = !isLocation(implicitValue) ? !currentlyAttached : implicitValue.range;\n\t\t\tif (shouldShowImplicit) {\n\t\t\t\tconst implicitPart = store.add(this.instantiationService.createInstance(ImplicitContextAttachmentWidget, this.implicitContext, this._contextResourceLabels, this._attachmentModel));\n\t\t\t\tcontainer.appendChild(implicitPart.domNode);\n\t\t\t}\n\t\t}\n\n\t\tif (oldHeight !== this.attachmentsContainer.offsetHeight) {\n\t\t\tthis._onDidChangeHeight.fire();\n\t\t}\n\n\t\tthis.addFilesButton?.setShowLabel(this._attachmentModel.size === 0 && !this.hasImplicitContextBlock());\n\n\t\tthis._indexOfLastOpenedContext = -1;\n\t}\n\n\tprivate hasImplicitContextBlock(): boolean {\n\t\tconst implicit = this.implicitContext?.value;\n\t\tif (!implicit) {\n\t\t\treturn false;\n\t\t}\n\t\tconst isSuggestedEnabled = this.configurationService.getValue<boolean>('chat.implicitContext.suggestedContext');\n\t\tif (!isSuggestedEnabled) {\n\t\t\treturn true;\n\t\t}\n\n\t\t// TODO @justschen: merge this with above showing implicit logic\n\t\tconst isUri = URI.isUri(implicit);\n\t\tif (isUri || isLocation(implicit)) {\n\t\t\tconst targetUri = isUri ? implicit : implicit.uri;\n\t\t\tconst attachments = [...this._attachmentModel.attachments.entries()];\n\t\t\tconst currentlyAttached = attachments.some(([, a]) => URI.isUri(a.value) && isEqual(a.value, targetUri));\n\t\t\tconst shouldShowImplicit = isUri ? !currentlyAttached : implicit.range;\n\t\t\treturn !!shouldShowImplicit;\n\t\t}\n\t\treturn false;\n\t}\n\n\tprivate handleAttachmentDeletion(e: KeyboardEvent | unknown, index: number, attachment: IChatRequestVariableEntry) {\n\t\t// Set focus to the next attached context item if deletion was triggered by a keystroke (vs a mouse click)\n\t\tif (dom.isKeyboardEvent(e)) {\n\t\t\tthis._indexOfLastAttachedContextDeletedWithKeyboard = index;\n\t\t}\n\n\t\tthis._attachmentModel.delete(attachment.id);\n\n\n\t\tif (this.configurationService.getValue<boolean>('chat.implicitContext.enableImplicitContext')) {\n\t\t\t// if currently opened file is deleted, do not show implicit context\n\t\t\tconst implicitValue = URI.isUri(this.implicitContext?.value) && URI.isUri(attachment.value) && isEqual(this.implicitContext.value, attachment.value);\n\n\t\t\tif (this.implicitContext?.isFile && implicitValue) {\n\t\t\t\tthis.implicitContext.enabled = false;\n\t\t\t}\n\t\t}\n\n\t\tif (this._attachmentModel.size === 0) {\n\t\t\tthis.focus();\n\t\t}\n\n\t\tthis._onDidChangeContext.fire({ removed: [attachment] });\n\t\tthis.renderAttachedContext();\n\t}\n\n\tprivate handleAttachmentOpen(index: number, attachment: IChatRequestVariableEntry): void {\n\t\tthis._indexOfLastOpenedContext = index;\n\t\tthis._indexOfLastAttachedContextDeletedWithKeyboard = -1;\n\n\t\tif (this._attachmentModel.size === 0) {\n\t\t\tthis.focus();\n\t\t}\n\t}\n\n\tprivate handleAttachmentNavigation(e: StandardKeyboardEvent): void {\n\t\tif (!e.equals(KeyCode.LeftArrow) && !e.equals(KeyCode.RightArrow)) {\n\t\t\treturn;\n\t\t}\n\n\t\t// eslint-disable-next-line no-restricted-syntax\n\t\tconst toolbar = this.addFilesToolbar?.getElement().querySelector('.action-label');\n\t\tif (!toolbar) {\n\t\t\treturn;\n\t\t}\n\n\t\t// eslint-disable-next-line no-restricted-syntax\n\t\tconst attachments = Array.from(this.attachedContextContainer.querySelectorAll('.chat-attached-context-attachment'));\n\t\tif (!attachments.length) {\n\t\t\treturn;\n\t\t}\n\n\t\tattachments.unshift(toolbar);\n\n\t\tconst activeElement = dom.getWindow(this.attachmentsContainer).document.activeElement;\n\t\tconst currentIndex = attachments.findIndex(attachment => attachment === activeElement);\n\t\tlet newIndex = currentIndex;\n\n\t\tif (e.equals(KeyCode.LeftArrow)) {\n\t\t\tnewIndex = currentIndex > 0 ? currentIndex - 1 : attachments.length - 1;\n\t\t} else if (e.equals(KeyCode.RightArrow)) {\n\t\t\tnewIndex = currentIndex < attachments.length - 1 ? currentIndex + 1 : 0;\n\t\t}\n\n\t\tif (newIndex !== -1) {\n\t\t\tconst nextElement = attachments[newIndex] as HTMLElement;\n\t\t\tnextElement.focus();\n\t\t\te.preventDefault();\n\t\t\te.stopPropagation();\n\t\t}\n\t}\n\n\tasync renderChatTodoListWidget(chatSessionResource: URI) {\n\n\t\tconst isTodoWidgetEnabled = this.configurationService.getValue<boolean>(ChatConfiguration.TodosShowWidget) !== false;\n\t\tif (!isTodoWidgetEnabled) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this._chatInputTodoListWidget.value) {\n\t\t\tconst widget = this._chatEditingTodosDisposables.add(this.instantiationService.createInstance(ChatTodoListWidget));\n\t\t\tthis._chatInputTodoListWidget.value = widget;\n\n\t\t\t// Add the widget's DOM node to the dedicated todo list container\n\t\t\tdom.clearNode(this.chatInputTodoListWidgetContainer);\n\t\t\tdom.append(this.chatInputTodoListWidgetContainer, widget.domNode);\n\n\t\t\t// Listen to height changes\n\t\t\tthis._chatEditingTodosDisposables.add(widget.onDidChangeHeight(() => {\n\t\t\t\tthis._onDidChangeHeight.fire();\n\t\t\t}));\n\t\t}\n\n\t\tthis._chatInputTodoListWidget.value.render(chatSessionResource);\n\t}\n\n\tclearTodoListWidget(sessionResource: URI | undefined, force: boolean): void {\n\t\tthis._chatInputTodoListWidget.value?.clear(sessionResource, force);\n\t}\n\n\trenderChatEditingSessionState(chatEditingSession: IChatEditingSession | null) {\n\t\tdom.setVisibility(Boolean(chatEditingSession), this.chatEditingSessionWidgetContainer);\n\n\t\tif (chatEditingSession) {\n\t\t\tif (!isEqual(chatEditingSession.chatSessionResource, this._lastEditingSessionResource)) {\n\t\t\t\tthis._workingSetCollapsed = true;\n\t\t\t}\n\t\t\tthis._lastEditingSessionResource = chatEditingSession.chatSessionResource;\n\t\t}\n\n\t\tconst modifiedEntries = derivedOpts<IModifiedFileEntry[]>({ equalsFn: arraysEqual }, r => {\n\t\t\treturn chatEditingSession?.entries.read(r).filter(entry => entry.state.read(r) === ModifiedFileEntryState.Modified) || [];\n\t\t});\n\n\t\tconst listEntries = derived((reader): IChatCollapsibleListItem[] => {\n\t\t\tconst seenEntries = new ResourceSet();\n\t\t\tconst entries: IChatCollapsibleListItem[] = [];\n\t\t\tfor (const entry of modifiedEntries.read(reader)) {\n\t\t\t\tif (entry.state.read(reader) !== ModifiedFileEntryState.Modified) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tif (!seenEntries.has(entry.modifiedURI)) {\n\t\t\t\t\tseenEntries.add(entry.modifiedURI);\n\t\t\t\t\tconst linesAdded = entry.linesAdded?.read(reader);\n\t\t\t\t\tconst linesRemoved = entry.linesRemoved?.read(reader);\n\t\t\t\t\tentries.push({\n\t\t\t\t\t\treference: entry.modifiedURI,\n\t\t\t\t\t\tstate: ModifiedFileEntryState.Modified,\n\t\t\t\t\t\tkind: 'reference',\n\t\t\t\t\t\toptions: {\n\t\t\t\t\t\t\tstatus: undefined,\n\t\t\t\t\t\t\tdiffMeta: { added: linesAdded ?? 0, removed: linesRemoved ?? 0 }\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tentries.sort((a, b) => {\n\t\t\t\tif (a.kind === 'reference' && b.kind === 'reference') {\n\t\t\t\t\tif (a.state === b.state || a.state === undefined || b.state === undefined) {\n\t\t\t\t\t\treturn a.reference.toString().localeCompare(b.reference.toString());\n\t\t\t\t\t}\n\t\t\t\t\treturn a.state - b.state;\n\t\t\t\t}\n\t\t\t\treturn 0;\n\t\t\t});\n\n\t\t\treturn entries;\n\t\t});\n\n\t\tconst shouldRender = listEntries.map(r => r.length > 0);\n\n\t\tthis._renderingChatEdits.value = autorun(reader => {\n\t\t\tif (this.options.renderWorkingSet && shouldRender.read(reader)) {\n\t\t\t\tthis.renderChatEditingSessionWithEntries(\n\t\t\t\t\treader.store,\n\t\t\t\t\tchatEditingSession!,\n\t\t\t\t\tmodifiedEntries,\n\t\t\t\t\tlistEntries,\n\t\t\t\t);\n\t\t\t} else {\n\t\t\t\tdom.clearNode(this.chatEditingSessionWidgetContainer);\n\t\t\t\tthis._chatEditsDisposables.clear();\n\t\t\t\tthis._chatEditList = undefined;\n\t\t\t}\n\t\t});\n\t}\n\n\tprivate renderChatEditingSessionWithEntries(\n\t\tstore: DisposableStore,\n\t\tchatEditingSession: IChatEditingSession,\n\t\tmodifiedEntries: IObservable<IModifiedFileEntry[]>,\n\t\tlistEntries: IObservable<IChatCollapsibleListItem[]>,\n\t) {\n\t\t// Summary of number of files changed\n\t\t// eslint-disable-next-line no-restricted-syntax\n\t\tconst innerContainer = this.chatEditingSessionWidgetContainer.querySelector('.chat-editing-session-container.show-file-icons') as HTMLElement ?? dom.append(this.chatEditingSessionWidgetContainer, $('.chat-editing-session-container.show-file-icons'));\n\n\t\t// eslint-disable-next-line no-restricted-syntax\n\t\tconst overviewRegion = innerContainer.querySelector('.chat-editing-session-overview') as HTMLElement ?? dom.append(innerContainer, $('.chat-editing-session-overview'));\n\t\t// eslint-disable-next-line no-restricted-syntax\n\t\tconst overviewTitle = overviewRegion.querySelector('.working-set-title') as HTMLElement ?? dom.append(overviewRegion, $('.working-set-title'));\n\n\t\t// Clear out the previous actions (if any)\n\t\tthis._chatEditsActionsDisposables.clear();\n\n\t\t// Chat editing session actions\n\t\t// eslint-disable-next-line no-restricted-syntax\n\t\tconst actionsContainer = overviewRegion.querySelector('.chat-editing-session-actions') as HTMLElement ?? dom.append(overviewRegion, $('.chat-editing-session-actions'));\n\n\t\tthis._chatEditsActionsDisposables.add(this.instantiationService.createInstance(MenuWorkbenchButtonBar, actionsContainer, MenuId.ChatEditingWidgetToolbar, {\n\t\t\ttelemetrySource: this.options.menus.telemetrySource,\n\t\t\tmenuOptions: {\n\t\t\t\targ: { sessionResource: chatEditingSession.chatSessionResource },\n\t\t\t},\n\t\t\tbuttonConfigProvider: (action) => {\n\t\t\t\tif (action.id === ChatEditingShowChangesAction.ID || action.id === ViewPreviousEditsAction.Id) {\n\t\t\t\t\treturn { showIcon: true, showLabel: false, isSecondary: true };\n\t\t\t\t}\n\t\t\t\treturn undefined;\n\t\t\t}\n\t\t}));\n\n\t\tif (!chatEditingSession) {\n\t\t\treturn;\n\t\t}\n\n\t\t// Working set\n\t\t// eslint-disable-next-line no-restricted-syntax\n\t\tconst workingSetContainer = innerContainer.querySelector('.chat-editing-session-list') as HTMLElement ?? dom.append(innerContainer, $('.chat-editing-session-list'));\n\n\t\tconst button = this._chatEditsActionsDisposables.add(new ButtonWithIcon(overviewTitle, {\n\t\t\tsupportIcons: true,\n\t\t\tsecondary: true,\n\t\t\tariaLabel: localize('chatEditingSession.toggleWorkingSet', 'Toggle changed files.'),\n\t\t}));\n\n\n\n\t\tstore.add(autorun(reader => {\n\t\t\tlet added = 0;\n\t\t\tlet removed = 0;\n\t\t\tconst entries = modifiedEntries.read(reader);\n\t\t\tfor (const entry of entries) {\n\t\t\t\tif (entry.linesAdded && entry.linesRemoved) {\n\t\t\t\t\tadded += entry.linesAdded.read(reader);\n\t\t\t\t\tremoved += entry.linesRemoved.read(reader);\n\t\t\t\t}\n\t\t\t}\n\t\t\tconst baseLabel = entries.length === 1 ? localize('chatEditingSession.oneFile.1', '1 file changed') : localize('chatEditingSession.manyFiles.1', '{0} files changed', entries.length);\n\t\t\tbutton.label = baseLabel;\n\n\t\t\tthis._workingSetLinesAddedSpan.value.textContent = `+${added}`;\n\t\t\tthis._workingSetLinesRemovedSpan.value.textContent = `-${removed}`;\n\t\t\tbutton.element.setAttribute('aria-label', localize('chatEditingSession.ariaLabelWithCounts', '{0}, {1} lines added, {2} lines removed', baseLabel, added, removed));\n\n\t\t\tconst shouldShowEditingSession = added > 0 || removed > 0;\n\t\t\tdom.setVisibility(shouldShowEditingSession, this.chatEditingSessionWidgetContainer);\n\t\t\tif (!shouldShowEditingSession) {\n\t\t\t\tthis._onDidChangeHeight.fire();\n\t\t\t}\n\t\t}));\n\n\t\tconst countsContainer = dom.$('.working-set-line-counts');\n\t\tbutton.element.appendChild(countsContainer);\n\t\tcountsContainer.appendChild(this._workingSetLinesAddedSpan.value);\n\t\tcountsContainer.appendChild(this._workingSetLinesRemovedSpan.value);\n\n\t\tconst applyCollapseState = () => {\n\t\t\tbutton.icon = this._workingSetCollapsed ? Codicon.chevronRight : Codicon.chevronDown;\n\t\t\tworkingSetContainer.classList.toggle('collapsed', this._workingSetCollapsed);\n\t\t\tthis._onDidChangeHeight.fire();\n\t\t};\n\n\t\tconst toggleWorkingSet = () => {\n\t\t\tthis._workingSetCollapsed = !this._workingSetCollapsed;\n\t\t\tapplyCollapseState();\n\t\t};\n\n\t\tthis._chatEditsActionsDisposables.add(button.onDidClick(() => { toggleWorkingSet(); }));\n\t\tthis._chatEditsActionsDisposables.add(addDisposableListener(overviewRegion, 'click', e => {\n\t\t\tif (e.defaultPrevented) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst target = e.target as HTMLElement;\n\t\t\tif (target.closest('.monaco-button')) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\ttoggleWorkingSet();\n\t\t}));\n\n\t\tapplyCollapseState();\n\n\t\tif (!this._chatEditList) {\n\t\t\tthis._chatEditList = this._chatEditsListPool.get();\n\t\t\tconst list = this._chatEditList.object;\n\t\t\tthis._chatEditsDisposables.add(this._chatEditList);\n\t\t\tthis._chatEditsDisposables.add(list.onDidFocus(() => {\n\t\t\t\tthis._onDidFocus.fire();\n\t\t\t}));\n\t\t\tthis._chatEditsDisposables.add(list.onDidOpen(async (e) => {\n\t\t\t\tif (e.element?.kind === 'reference' && URI.isUri(e.element.reference)) {\n\t\t\t\t\tconst modifiedFileUri = e.element.reference;\n\n\t\t\t\t\tconst entry = chatEditingSession.getEntry(modifiedFileUri);\n\n\t\t\t\t\tconst pane = await this.editorService.openEditor({\n\t\t\t\t\t\tresource: modifiedFileUri,\n\t\t\t\t\t\toptions: e.editorOptions\n\t\t\t\t\t}, e.sideBySide ? SIDE_GROUP : ACTIVE_GROUP);\n\n\t\t\t\t\tif (pane) {\n\t\t\t\t\t\tentry?.getEditorIntegration(pane).reveal(true, e.editorOptions.preserveFocus);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}));\n\t\t\tthis._chatEditsDisposables.add(addDisposableListener(list.getHTMLElement(), 'click', e => {\n\t\t\t\tif (!this.hasFocus()) {\n\t\t\t\t\tthis._onDidFocus.fire();\n\t\t\t\t}\n\t\t\t}, true));\n\t\t\tdom.append(workingSetContainer, list.getHTMLElement());\n\t\t\tdom.append(innerContainer, workingSetContainer);\n\t\t}\n\n\t\tstore.add(autorun(reader => {\n\t\t\tconst entries = listEntries.read(reader);\n\t\t\tconst maxItemsShown = 6;\n\t\t\tconst itemsShown = Math.min(entries.length, maxItemsShown);\n\t\t\tconst height = itemsShown * 22;\n\t\t\tconst list = this._chatEditList!.object;\n\t\t\tlist.layout(height);\n\t\t\tlist.getHTMLElement().style.height = `${height}px`;\n\t\t\tlist.splice(0, list.length, entries);\n\t\t\tthis._onDidChangeHeight.fire();\n\t\t}));\n\t}\n\n\tasync renderChatRelatedFiles() {\n\t\tconst anchor = this.relatedFilesContainer;\n\t\tdom.clearNode(anchor);\n\t\tconst shouldRender = this.configurationService.getValue('chat.renderRelatedFiles');\n\t\tdom.setVisibility(Boolean(this.relatedFiles?.value.length && shouldRender), anchor);\n\t\tif (!shouldRender || !this.relatedFiles?.value.length) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst hoverDelegate = getDefaultHoverDelegate('element');\n\t\tfor (const { uri, description } of this.relatedFiles.value) {\n\t\t\tconst uriLabel = this._chatEditsActionsDisposables.add(new Button(anchor, {\n\t\t\t\tsupportIcons: true,\n\t\t\t\tsecondary: true,\n\t\t\t\thoverDelegate\n\t\t\t}));\n\t\t\turiLabel.label = this.labelService.getUriBasenameLabel(uri);\n\t\t\turiLabel.element.classList.add('monaco-icon-label');\n\t\t\turiLabel.element.title = localize('suggeste.title', \"{0} - {1}\", this.labelService.getUriLabel(uri, { relative: true }), description ?? '');\n\n\t\t\tthis._chatEditsActionsDisposables.add(uriLabel.onDidClick(async () => {\n\t\t\t\tgroup.remove(); // REMOVE asap\n\t\t\t\tawait this._attachmentModel.addFile(uri);\n\t\t\t\tthis.relatedFiles?.remove(uri);\n\t\t\t}));\n\n\t\t\tconst addButton = this._chatEditsActionsDisposables.add(new Button(anchor, {\n\t\t\t\tsupportIcons: false,\n\t\t\t\tsecondary: true,\n\t\t\t\thoverDelegate,\n\t\t\t\tariaLabel: localize('chatEditingSession.addSuggestion', 'Add suggestion {0}', this.labelService.getUriLabel(uri, { relative: true })),\n\t\t\t}));\n\t\t\taddButton.icon = Codicon.add;\n\t\t\taddButton.setTitle(localize('chatEditingSession.addSuggested', 'Add suggestion'));\n\t\t\tthis._chatEditsActionsDisposables.add(addButton.onDidClick(async () => {\n\t\t\t\tgroup.remove(); // REMOVE asap\n\t\t\t\tawait this._attachmentModel.addFile(uri);\n\t\t\t\tthis.relatedFiles?.remove(uri);\n\t\t\t}));\n\n\t\t\tconst sep = document.createElement('div');\n\t\t\tsep.classList.add('separator');\n\n\t\t\tconst group = document.createElement('span');\n\t\t\tgroup.classList.add('monaco-button-dropdown', 'sidebyside-button');\n\t\t\tgroup.appendChild(addButton.element);\n\t\t\tgroup.appendChild(sep);\n\t\t\tgroup.appendChild(uriLabel.element);\n\t\t\tdom.append(anchor, group);\n\n\t\t\tthis._chatEditsActionsDisposables.add(toDisposable(() => {\n\t\t\t\tgroup.remove();\n\t\t\t}));\n\t\t}\n\t\tthis._onDidChangeHeight.fire();\n\t}\n\n\tasync renderFollowups(items: IChatFollowup[] | undefined, response: IChatResponseViewModel | undefined): Promise<void> {\n\t\tif (!this.options.renderFollowups) {\n\t\t\treturn;\n\t\t}\n\t\tthis.followupsDisposables.clear();\n\t\tdom.clearNode(this.followupsContainer);\n\n\t\tif (items && items.length > 0) {\n\t\t\tthis.followupsDisposables.add(this.instantiationService.createInstance<typeof ChatFollowups<IChatFollowup>, ChatFollowups<IChatFollowup>>(ChatFollowups, this.followupsContainer, items, this.location, undefined, followup => this._onDidAcceptFollowup.fire({ followup, response })));\n\t\t}\n\t\tthis._onDidChangeHeight.fire();\n\t}\n\n\tget contentHeight(): number {\n\t\tconst data = this.getLayoutData();\n\t\treturn data.followupsHeight + data.inputPartEditorHeight + data.inputPartVerticalPadding + data.inputEditorBorder + data.attachmentsHeight + data.toolbarsHeight + data.chatEditingStateHeight + data.todoListWidgetContainerHeight;\n\t}\n\n\tlayout(height: number, width: number) {\n\t\tthis.cachedDimensions = new dom.Dimension(width, height);\n\n\t\treturn this._layout(height, width);\n\t}\n\n\tprivate previousInputEditorDimension: IDimension | undefined;\n\tprivate _layout(height: number, width: number, allowRecurse = true): void {\n\t\tconst data = this.getLayoutData();\n\t\tconst inputEditorHeight = Math.min(data.inputPartEditorHeight, height - data.followupsHeight - data.attachmentsHeight - data.inputPartVerticalPadding - data.toolbarsHeight - data.chatEditingStateHeight - data.todoListWidgetContainerHeight);\n\n\t\tconst followupsWidth = width - data.inputPartHorizontalPadding;\n\t\tthis.followupsContainer.style.width = `${followupsWidth}px`;\n\n\t\tthis._inputPartHeight = data.inputPartVerticalPadding + data.followupsHeight + inputEditorHeight + data.inputEditorBorder + data.attachmentsHeight + data.toolbarsHeight + data.chatEditingStateHeight + data.todoListWidgetContainerHeight;\n\t\tthis._followupsHeight = data.followupsHeight;\n\t\tthis._editSessionWidgetHeight = data.chatEditingStateHeight;\n\n\t\tconst initialEditorScrollWidth = this._inputEditor.getScrollWidth();\n\t\tconst newEditorWidth = width - data.inputPartHorizontalPadding - data.editorBorder - data.inputPartHorizontalPaddingInside - data.toolbarsWidth - data.sideToolbarWidth;\n\t\tconst newDimension = { width: newEditorWidth, height: inputEditorHeight };\n\t\tif (!this.previousInputEditorDimension || (this.previousInputEditorDimension.width !== newDimension.width || this.previousInputEditorDimension.height !== newDimension.height)) {\n\t\t\t// This layout call has side-effects that are hard to understand. eg if we are calling this inside a onDidChangeContent handler, this can trigger the next onDidChangeContent handler\n\t\t\t// to be invoked, and we have a lot of these on this editor. Only doing a layout this when the editor size has actually changed makes it much easier to follow.\n\t\t\tthis._inputEditor.layout(newDimension);\n\t\t\tthis.previousInputEditorDimension = newDimension;\n\t\t}\n\n\t\tif (allowRecurse && initialEditorScrollWidth < 10) {\n\t\t\t// This is probably the initial layout. Now that the editor is layed out with its correct width, it should report the correct contentHeight\n\t\t\treturn this._layout(height, width, false);\n\t\t}\n\t}\n\n\tprivate getLayoutData() {\n\n\t\t// ###########################################################################\n\t\t// #                                                                         #\n\t\t// #    CHANGING THIS METHOD HAS RENDERING IMPLICATIONS FOR THE CHAT VIEW    #\n\t\t// #    IF YOU MAKE CHANGES HERE, PLEASE TEST THE CHAT VIEW THOROUGHLY:      #\n\t\t// #    - produce various chat responses                                     #\n\t\t// #    - click the response to get a focus outline                          #\n\t\t// #    - ensure the outline is not cut off at the bottom                    #\n\t\t// #                                                                         #\n\t\t// ###########################################################################\n\n\t\tconst executeToolbarWidth = this.cachedExecuteToolbarWidth = this.executeToolbar.getItemsWidth();\n\t\tconst inputToolbarWidth = this.cachedInputToolbarWidth = this.inputActionsToolbar.getItemsWidth();\n\t\tconst inputSideToolbarWidth = this.inputSideToolbarContainer ? dom.getTotalWidth(this.inputSideToolbarContainer) : 0;\n\t\tconst executeToolbarPadding = (this.executeToolbar.getItemsLength() - 1) * 4;\n\t\tconst inputToolbarPadding = this.inputActionsToolbar.getItemsLength() ? (this.inputActionsToolbar.getItemsLength() - 1) * 4 : 0;\n\t\treturn {\n\t\t\tinputEditorBorder: 2,\n\t\t\tfollowupsHeight: this.followupsContainer.offsetHeight,\n\t\t\tinputPartEditorHeight: Math.min(this._inputEditor.getContentHeight(), this.inputEditorMaxHeight),\n\t\t\tinputPartHorizontalPadding: this.options.renderStyle === 'compact' ? 16 : 32,\n\t\t\tinputPartVerticalPadding: this.options.renderStyle === 'compact' ? 12 : (16 /* entire part */ + 6 /* input container */ + (2 * 4) /* flex gap: todo|edits|input */),\n\t\t\tattachmentsHeight: this.attachmentsHeight,\n\t\t\teditorBorder: 2,\n\t\t\tinputPartHorizontalPaddingInside: 12,\n\t\t\ttoolbarsWidth: this.options.renderStyle === 'compact' ? executeToolbarWidth + executeToolbarPadding + (this.options.renderInputToolbarBelowInput ? 0 : inputToolbarWidth + inputToolbarPadding) : 0,\n\t\t\ttoolbarsHeight: this.options.renderStyle === 'compact' ? 0 : 22,\n\t\t\tchatEditingStateHeight: this.chatEditingSessionWidgetContainer.offsetHeight,\n\t\t\tsideToolbarWidth: inputSideToolbarWidth > 0 ? inputSideToolbarWidth + 4 /*gap*/ : 0,\n\t\t\ttodoListWidgetContainerHeight: this.chatInputTodoListWidgetContainer.offsetHeight,\n\t\t};\n\t}\n\n\tsaveState(): void {\n\t\tif (this.history.isAtEnd()) {\n\t\t\tthis.saveCurrentValue(this.getCurrentInputState());\n\t\t}\n\n\t\tconst inputHistory = [...this.history];\n\t\tthis.historyService.saveHistory(this.location, inputHistory);\n\t}\n}\n\nconst historyKeyFn = (entry: IChatModelInputState) => JSON.stringify({ ...entry, mode: { ...entry.mode }, selectedModel: undefined });\n\nfunction getLastPosition(model: ITextModel): IPosition {\n\treturn { lineNumber: model.getLineCount(), column: model.getLineLength(model.getLineCount()) + 1 };\n}\n\nconst chatInputEditorContainerSelector = '.interactive-input-editor';\nsetupSimpleEditorSelectionStyling(chatInputEditorContainerSelector);\n\nclass ChatSessionPickersContainerActionItem extends ActionViewItem {\n\tconstructor(\n\t\taction: IAction,\n\t\tprivate readonly widgets: ChatSessionPickerActionItem[],\n\t\toptions?: IActionViewItemOptions\n\t) {\n\t\tsuper(null, action, options ?? {});\n\t}\n\n\toverride render(container: HTMLElement): void {\n\t\tcontainer.classList.add('chat-sessionPicker-container');\n\t\tfor (const widget of this.widgets) {\n\t\t\tconst itemContainer = dom.$('.action-item.chat-sessionPicker-item');\n\t\t\twidget.render(itemContainer);\n\t\t\tcontainer.appendChild(itemContainer);\n\t\t}\n\t}\n\n\toverride dispose(): void {\n\t\tfor (const widget of this.widgets) {\n\t\t\twidget.dispose();\n\t\t}\n\t\tsuper.dispose();\n\t}\n}\n\nclass AddFilesButton extends ActionViewItem {\n\tprivate showLabel: boolean | undefined;\n\n\tconstructor(context: unknown, action: IAction, options: IActionViewItemOptions) {\n\t\tsuper(context, action, {\n\t\t\t...options,\n\t\t\ticon: false,\n\t\t\tlabel: true,\n\t\t\tkeybindingNotRenderedWithLabel: true,\n\t\t});\n\t}\n\n\tpublic setShowLabel(show: boolean): void {\n\t\tthis.showLabel = show;\n\t\tthis.updateLabel();\n\t}\n\n\toverride render(container: HTMLElement): void {\n\t\tcontainer.classList.add('chat-attachment-button');\n\t\tsuper.render(container);\n\t\tthis.updateLabel();\n\t}\n\n\tprotected override updateLabel(): void {\n\t\tif (!this.label) {\n\t\t\treturn;\n\t\t}\n\t\tassertType(this.label);\n\t\tthis.label.classList.toggle('has-label', this.showLabel);\n\t\tconst message = this.showLabel ? `$(attach) ${this.action.label}` : `$(attach)`;\n\t\tdom.reset(this.label, ...renderLabelWithIcons(message));\n\t}\n}\n"]}