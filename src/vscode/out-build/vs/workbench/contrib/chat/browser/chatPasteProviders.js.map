{"version":3,"sources":["vs/workbench/contrib/chat/browser/chatPasteProviders.ts"],"names":[],"mappings":"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","file":"chatPasteProviders.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nimport { CancellationToken } from '../../../../base/common/cancellation.js';\nimport { Codicon } from '../../../../base/common/codicons.js';\nimport { createStringDataTransferItem, IDataTransferItem, IReadonlyVSDataTransfer, VSDataTransfer } from '../../../../base/common/dataTransfer.js';\nimport { HierarchicalKind } from '../../../../base/common/hierarchicalKind.js';\nimport { Disposable } from '../../../../base/common/lifecycle.js';\nimport { revive } from '../../../../base/common/marshalling.js';\nimport { Mimes } from '../../../../base/common/mime.js';\nimport { Schemas } from '../../../../base/common/network.js';\nimport { basename, joinPath } from '../../../../base/common/resources.js';\nimport { URI, UriComponents } from '../../../../base/common/uri.js';\nimport { IRange } from '../../../../editor/common/core/range.js';\nimport { DocumentPasteContext, DocumentPasteEdit, DocumentPasteEditProvider, DocumentPasteEditsSession } from '../../../../editor/common/languages.js';\nimport { ITextModel } from '../../../../editor/common/model.js';\nimport { ILanguageFeaturesService } from '../../../../editor/common/services/languageFeatures.js';\nimport { IModelService } from '../../../../editor/common/services/model.js';\nimport { localize } from '../../../../nls.js';\nimport { IEnvironmentService } from '../../../../platform/environment/common/environment.js';\nimport { IFileService } from '../../../../platform/files/common/files.js';\nimport { IInstantiationService } from '../../../../platform/instantiation/common/instantiation.js';\nimport { ILogService } from '../../../../platform/log/common/log.js';\nimport { IExtensionService, isProposedApiEnabled } from '../../../services/extensions/common/extensions.js';\nimport { IChatRequestPasteVariableEntry, IChatRequestVariableEntry } from '../common/chatVariableEntries.js';\nimport { IChatVariablesService, IDynamicVariable } from '../common/chatVariables.js';\nimport { IChatWidgetService } from './chat.js';\nimport { ChatDynamicVariableModel } from './contrib/chatDynamicVariables.js';\nimport { cleanupOldImages, createFileForMedia, resizeImage } from './imageUtils.js';\n\nconst COPY_MIME_TYPES = 'application/vnd.code.additional-editor-data';\n\ninterface SerializedCopyData {\n\treadonly uri: UriComponents;\n\treadonly range: IRange;\n}\n\nexport class PasteImageProvider implements DocumentPasteEditProvider {\n\tprivate readonly imagesFolder: URI;\n\n\tpublic readonly kind = new HierarchicalKind('chat.attach.image');\n\tpublic readonly providedPasteEditKinds = [this.kind];\n\n\tpublic readonly copyMimeTypes = [];\n\tpublic readonly pasteMimeTypes = ['image/*'];\n\n\tconstructor(\n\t\tprivate readonly chatWidgetService: IChatWidgetService,\n\t\tprivate readonly extensionService: IExtensionService,\n\t\t@IFileService private readonly fileService: IFileService,\n\t\t@IEnvironmentService private readonly environmentService: IEnvironmentService,\n\t\t@ILogService private readonly logService: ILogService,\n\t) {\n\t\tthis.imagesFolder = joinPath(this.environmentService.workspaceStorageHome, 'vscode-chat-images');\n\t\tcleanupOldImages(this.fileService, this.logService, this.imagesFolder,);\n\t}\n\n\tasync provideDocumentPasteEdits(model: ITextModel, ranges: readonly IRange[], dataTransfer: IReadonlyVSDataTransfer, context: DocumentPasteContext, token: CancellationToken): Promise<DocumentPasteEditsSession | undefined> {\n\t\tif (!this.extensionService.extensions.some(ext => isProposedApiEnabled(ext, 'chatReferenceBinaryData'))) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst supportedMimeTypes = [\n\t\t\t'image/png',\n\t\t\t'image/jpeg',\n\t\t\t'image/jpg',\n\t\t\t'image/bmp',\n\t\t\t'image/gif',\n\t\t\t'image/tiff'\n\t\t];\n\n\t\tlet mimeType: string | undefined;\n\t\tlet imageItem: IDataTransferItem | undefined;\n\n\t\t// Find the first matching image type in the dataTransfer\n\t\tfor (const type of supportedMimeTypes) {\n\t\t\timageItem = dataTransfer.get(type);\n\t\t\tif (imageItem) {\n\t\t\t\tmimeType = type;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\tif (!imageItem || !mimeType) {\n\t\t\treturn;\n\t\t}\n\t\tconst currClipboard = await imageItem.asFile()?.data();\n\t\tif (token.isCancellationRequested || !currClipboard) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst widget = this.chatWidgetService.getWidgetByInputUri(model.uri);\n\t\tif (!widget) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst attachedVariables = widget.attachmentModel.attachments;\n\t\tconst displayName = localize('pastedImageName', 'Pasted Image');\n\t\tlet tempDisplayName = displayName;\n\n\t\tfor (let appendValue = 2; attachedVariables.some(attachment => attachment.name === tempDisplayName); appendValue++) {\n\t\t\ttempDisplayName = `${displayName} ${appendValue}`;\n\t\t}\n\n\t\tconst fileReference = await createFileForMedia(this.fileService, this.imagesFolder, currClipboard, mimeType);\n\t\tif (token.isCancellationRequested || !fileReference) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst scaledImageData = await resizeImage(currClipboard);\n\t\tif (token.isCancellationRequested || !scaledImageData) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst scaledImageContext = await getImageAttachContext(scaledImageData, mimeType, token, tempDisplayName, fileReference);\n\t\tif (token.isCancellationRequested || !scaledImageContext) {\n\t\t\treturn;\n\t\t}\n\n\t\t// Make sure to attach only new contexts\n\t\tconst currentContextIds = widget.attachmentModel.getAttachmentIDs();\n\t\tif (currentContextIds.has(scaledImageContext.id)) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst edit = createCustomPasteEdit(model, [scaledImageContext], mimeType, this.kind, localize('pastedImageAttachment', 'Pasted Image Attachment'), this.chatWidgetService);\n\t\treturn createEditSession(edit);\n\t}\n}\n\nasync function getImageAttachContext(data: Uint8Array, mimeType: string, token: CancellationToken, displayName: string, resource: URI): Promise<IChatRequestVariableEntry | undefined> {\n\tconst imageHash = await imageToHash(data);\n\tif (token.isCancellationRequested) {\n\t\treturn undefined;\n\t}\n\n\treturn {\n\t\tkind: 'image',\n\t\tvalue: data,\n\t\tid: imageHash,\n\t\tname: displayName,\n\t\ticon: Codicon.fileMedia,\n\t\tmimeType,\n\t\tisPasted: true,\n\t\treferences: [{ reference: resource, kind: 'reference' }]\n\t};\n}\n\nexport async function imageToHash(data: Uint8Array): Promise<string> {\n\tconst hashBuffer = await crypto.subtle.digest('SHA-256', data);\n\tconst hashArray = Array.from(new Uint8Array(hashBuffer));\n\treturn hashArray.map(b => b.toString(16).padStart(2, '0')).join('');\n}\n\nexport function isImage(array: Uint8Array): boolean {\n\tif (array.length < 4) {\n\t\treturn false;\n\t}\n\n\t// Magic numbers (identification bytes) for various image formats\n\tconst identifier: { [key: string]: number[] } = {\n\t\tpng: [0x89, 0x50, 0x4E, 0x47, 0x0D, 0x0A, 0x1A, 0x0A],\n\t\tjpeg: [0xFF, 0xD8, 0xFF],\n\t\tbmp: [0x42, 0x4D],\n\t\tgif: [0x47, 0x49, 0x46, 0x38],\n\t\ttiff: [0x49, 0x49, 0x2A, 0x00]\n\t};\n\n\treturn Object.values(identifier).some((signature) =>\n\t\tsignature.every((byte, index) => array[index] === byte)\n\t);\n}\n\nexport class CopyTextProvider implements DocumentPasteEditProvider {\n\tpublic readonly providedPasteEditKinds = [];\n\tpublic readonly copyMimeTypes = [COPY_MIME_TYPES];\n\tpublic readonly pasteMimeTypes = [];\n\n\tasync prepareDocumentPaste(model: ITextModel, ranges: readonly IRange[], dataTransfer: IReadonlyVSDataTransfer, token: CancellationToken): Promise<undefined | IReadonlyVSDataTransfer> {\n\t\tif (model.uri.scheme === Schemas.vscodeChatInput) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst customDataTransfer = new VSDataTransfer();\n\t\tconst data: SerializedCopyData = { range: ranges[0], uri: model.uri.toJSON() };\n\t\tcustomDataTransfer.append(COPY_MIME_TYPES, createStringDataTransferItem(JSON.stringify(data)));\n\t\treturn customDataTransfer;\n\t}\n}\n\nclass CopyAttachmentsProvider implements DocumentPasteEditProvider {\n\n\tstatic ATTACHMENT_MIME_TYPE = 'application/vnd.chat.attachment+json';\n\n\tpublic readonly kind = new HierarchicalKind('chat.attach.attachments');\n\tpublic readonly providedPasteEditKinds = [this.kind];\n\n\tpublic readonly copyMimeTypes = [CopyAttachmentsProvider.ATTACHMENT_MIME_TYPE];\n\tpublic readonly pasteMimeTypes = [CopyAttachmentsProvider.ATTACHMENT_MIME_TYPE];\n\n\tconstructor(\n\t\t@IChatWidgetService private readonly chatWidgetService: IChatWidgetService,\n\t\t@IChatVariablesService private readonly chatVariableService: IChatVariablesService\n\t) { }\n\n\tasync prepareDocumentPaste(model: ITextModel, _ranges: readonly IRange[], _dataTransfer: IReadonlyVSDataTransfer, _token: CancellationToken): Promise<undefined | IReadonlyVSDataTransfer> {\n\n\t\tconst widget = this.chatWidgetService.getWidgetByInputUri(model.uri);\n\t\tif (!widget || !widget.viewModel) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\tconst attachments = widget.attachmentModel.attachments;\n\t\tconst dynamicVariables = this.chatVariableService.getDynamicVariables(widget.viewModel.sessionResource);\n\n\t\tif (attachments.length === 0 && dynamicVariables.length === 0) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\tconst result = new VSDataTransfer();\n\t\tresult.append(CopyAttachmentsProvider.ATTACHMENT_MIME_TYPE, createStringDataTransferItem(JSON.stringify({ attachments, dynamicVariables })));\n\t\treturn result;\n\t}\n\n\tasync provideDocumentPasteEdits(model: ITextModel, _ranges: readonly IRange[], dataTransfer: IReadonlyVSDataTransfer, _context: DocumentPasteContext, token: CancellationToken): Promise<DocumentPasteEditsSession | undefined> {\n\n\t\tconst widget = this.chatWidgetService.getWidgetByInputUri(model.uri);\n\t\tif (!widget || !widget.viewModel) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\tconst chatDynamicVariable = widget.getContrib<ChatDynamicVariableModel>(ChatDynamicVariableModel.ID);\n\t\tif (!chatDynamicVariable) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\tconst text = dataTransfer.get(Mimes.text);\n\t\tconst data = dataTransfer.get(CopyAttachmentsProvider.ATTACHMENT_MIME_TYPE);\n\t\tconst rawData = await data?.asString();\n\t\tconst textdata = await text?.asString();\n\n\t\tif (textdata === undefined || rawData === undefined) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (token.isCancellationRequested) {\n\t\t\treturn;\n\t\t}\n\n\t\tlet pastedData: { attachments: IChatRequestVariableEntry[]; dynamicVariables: IDynamicVariable[] } | undefined;\n\t\ttry {\n\t\t\tpastedData = revive(JSON.parse(rawData));\n\t\t} catch {\n\t\t\t//\n\t\t}\n\n\t\tif (!Array.isArray(pastedData?.attachments) && !Array.isArray(pastedData?.dynamicVariables)) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst edit: DocumentPasteEdit = {\n\t\t\tinsertText: textdata,\n\t\t\ttitle: localize('pastedChatAttachments', 'Insert Prompt & Attachments'),\n\t\t\tkind: this.kind,\n\t\t\thandledMimeType: CopyAttachmentsProvider.ATTACHMENT_MIME_TYPE,\n\t\t\tadditionalEdit: {\n\t\t\t\tedits: []\n\t\t\t}\n\t\t};\n\n\t\tedit.additionalEdit?.edits.push({\n\t\t\tresource: model.uri,\n\t\t\tredo: () => {\n\t\t\t\twidget.attachmentModel.addContext(...pastedData.attachments);\n\t\t\t\tfor (const dynamicVariable of pastedData.dynamicVariables) {\n\t\t\t\t\tchatDynamicVariable?.addReference(dynamicVariable);\n\t\t\t\t}\n\t\t\t\twidget.refreshParsedInput();\n\t\t\t},\n\t\t\tundo: () => {\n\t\t\t\twidget.attachmentModel.delete(...pastedData.attachments.map(c => c.id));\n\t\t\t\twidget.refreshParsedInput();\n\t\t\t}\n\t\t});\n\n\t\treturn createEditSession(edit);\n\t}\n}\n\nexport class PasteTextProvider implements DocumentPasteEditProvider {\n\n\tpublic readonly kind = new HierarchicalKind('chat.attach.text');\n\tpublic readonly providedPasteEditKinds = [this.kind];\n\n\tpublic readonly copyMimeTypes = [];\n\tpublic readonly pasteMimeTypes = [COPY_MIME_TYPES];\n\n\tconstructor(\n\t\tprivate readonly chatWidgetService: IChatWidgetService,\n\t\tprivate readonly modelService: IModelService\n\t) { }\n\n\tasync provideDocumentPasteEdits(model: ITextModel, ranges: readonly IRange[], dataTransfer: IReadonlyVSDataTransfer, _context: DocumentPasteContext, token: CancellationToken): Promise<DocumentPasteEditsSession | undefined> {\n\t\tif (model.uri.scheme !== Schemas.vscodeChatInput) {\n\t\t\treturn;\n\t\t}\n\t\tconst text = dataTransfer.get(Mimes.text);\n\t\tconst editorData = dataTransfer.get('vscode-editor-data');\n\t\tconst additionalEditorData = dataTransfer.get(COPY_MIME_TYPES);\n\n\t\tif (!editorData || !text || !additionalEditorData) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst textdata = await text.asString();\n\t\tconst metadata = JSON.parse(await editorData.asString());\n\t\tconst additionalData: SerializedCopyData = JSON.parse(await additionalEditorData.asString());\n\n\t\tconst widget = this.chatWidgetService.getWidgetByInputUri(model.uri);\n\t\tif (!widget) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst start = additionalData.range.startLineNumber;\n\t\tconst end = additionalData.range.endLineNumber;\n\t\tif (start === end) {\n\t\t\tconst textModel = this.modelService.getModel(URI.revive(additionalData.uri));\n\t\t\tif (!textModel) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// If copied line text data is the entire line content, then we can paste it as a code attachment. Otherwise, we ignore and use default paste provider.\n\t\t\tconst lineContent = textModel.getLineContent(start);\n\t\t\tif (lineContent !== textdata) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tconst copiedContext = getCopiedContext(textdata, URI.revive(additionalData.uri), metadata.mode, additionalData.range);\n\n\t\tif (token.isCancellationRequested || !copiedContext) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst currentContextIds = widget.attachmentModel.getAttachmentIDs();\n\t\tif (currentContextIds.has(copiedContext.id)) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst edit = createCustomPasteEdit(model, [copiedContext], Mimes.text, this.kind, localize('pastedCodeAttachment', 'Pasted Code Attachment'), this.chatWidgetService);\n\t\tedit.yieldTo = [{ kind: HierarchicalKind.Empty.append('text', 'plain') }];\n\t\treturn createEditSession(edit);\n\t}\n}\n\nfunction getCopiedContext(code: string, file: URI, language: string, range: IRange): IChatRequestPasteVariableEntry {\n\tconst fileName = basename(file);\n\tconst start = range.startLineNumber;\n\tconst end = range.endLineNumber;\n\tconst resultText = `Copied Selection of Code: \\n\\n\\n From the file: ${fileName} From lines ${start} to ${end} \\n \\`\\`\\`${code}\\`\\`\\``;\n\tconst pastedLines = start === end ? localize('pastedAttachment.oneLine', '1 line') : localize('pastedAttachment.multipleLines', '{0} lines', end + 1 - start);\n\treturn {\n\t\tkind: 'paste',\n\t\tvalue: resultText,\n\t\tid: `${fileName}${start}${end}${range.startColumn}${range.endColumn}`,\n\t\tname: `${fileName} ${pastedLines}`,\n\t\ticon: Codicon.code,\n\t\tpastedLines,\n\t\tlanguage,\n\t\tfileName: file.toString(),\n\t\tcopiedFrom: {\n\t\t\turi: file,\n\t\t\trange\n\t\t},\n\t\tcode,\n\t\treferences: [{\n\t\t\treference: file,\n\t\t\tkind: 'reference'\n\t\t}]\n\t};\n}\n\nfunction createCustomPasteEdit(model: ITextModel, context: IChatRequestVariableEntry[], handledMimeType: string, kind: HierarchicalKind, title: string, chatWidgetService: IChatWidgetService): DocumentPasteEdit {\n\n\tconst label = context.length === 1\n\t\t? context[0].name\n\t\t: localize('pastedAttachment.multiple', '{0} and {1} more', context[0].name, context.length - 1);\n\n\tconst customEdit = {\n\t\tresource: model.uri,\n\t\tvariable: context,\n\t\tundo: () => {\n\t\t\tconst widget = chatWidgetService.getWidgetByInputUri(model.uri);\n\t\t\tif (!widget) {\n\t\t\t\tthrow new Error('No widget found for undo');\n\t\t\t}\n\t\t\twidget.attachmentModel.delete(...context.map(c => c.id));\n\t\t},\n\t\tredo: () => {\n\t\t\tconst widget = chatWidgetService.getWidgetByInputUri(model.uri);\n\t\t\tif (!widget) {\n\t\t\t\tthrow new Error('No widget found for redo');\n\t\t\t}\n\t\t\twidget.attachmentModel.addContext(...context);\n\t\t},\n\t\tmetadata: {\n\t\t\tneedsConfirmation: false,\n\t\t\tlabel\n\t\t}\n\t};\n\n\treturn {\n\t\tinsertText: '',\n\t\ttitle,\n\t\tkind,\n\t\thandledMimeType,\n\t\tadditionalEdit: {\n\t\t\tedits: [customEdit],\n\t\t}\n\t};\n}\n\nfunction createEditSession(edit: DocumentPasteEdit): DocumentPasteEditsSession {\n\treturn {\n\t\tedits: [edit],\n\t\tdispose: () => { },\n\t};\n}\n\nexport class ChatPasteProvidersFeature extends Disposable {\n\tconstructor(\n\t\t@IInstantiationService instaService: IInstantiationService,\n\t\t@ILanguageFeaturesService languageFeaturesService: ILanguageFeaturesService,\n\t\t@IChatWidgetService chatWidgetService: IChatWidgetService,\n\t\t@IExtensionService extensionService: IExtensionService,\n\t\t@IFileService fileService: IFileService,\n\t\t@IModelService modelService: IModelService,\n\t\t@IEnvironmentService environmentService: IEnvironmentService,\n\t\t@ILogService logService: ILogService,\n\t) {\n\t\tsuper();\n\t\tthis._register(languageFeaturesService.documentPasteEditProvider.register({ scheme: Schemas.vscodeChatInput, pattern: '*', hasAccessToAllModels: true }, instaService.createInstance(CopyAttachmentsProvider)));\n\t\tthis._register(languageFeaturesService.documentPasteEditProvider.register({ scheme: Schemas.vscodeChatInput, pattern: '*', hasAccessToAllModels: true }, new PasteImageProvider(chatWidgetService, extensionService, fileService, environmentService, logService)));\n\t\tthis._register(languageFeaturesService.documentPasteEditProvider.register({ scheme: Schemas.vscodeChatInput, pattern: '*', hasAccessToAllModels: true }, new PasteTextProvider(chatWidgetService, modelService)));\n\t\tthis._register(languageFeaturesService.documentPasteEditProvider.register('*', new CopyTextProvider()));\n\t\tthis._register(languageFeaturesService.documentPasteEditProvider.register('*', new CopyTextProvider()));\n\t}\n}\n"]}