{"version":3,"sources":["vs/workbench/contrib/chat/browser/chatAttachmentResolveService.ts"],"names":[],"mappings":"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","file":"chatAttachmentResolveService.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { VSBuffer } from '../../../../base/common/buffer.js';\nimport { Codicon } from '../../../../base/common/codicons.js';\nimport { basename } from '../../../../base/common/resources.js';\nimport { ThemeIcon } from '../../../../base/common/themables.js';\nimport { URI } from '../../../../base/common/uri.js';\nimport { IRange } from '../../../../editor/common/core/range.js';\nimport { SymbolKinds } from '../../../../editor/common/languages.js';\nimport { ITextModelService } from '../../../../editor/common/services/resolverService.js';\nimport { localize } from '../../../../nls.js';\nimport { IDialogService } from '../../../../platform/dialogs/common/dialogs.js';\nimport { IDraggedResourceEditorInput, MarkerTransferData, DocumentSymbolTransferData, NotebookCellOutputTransferData } from '../../../../platform/dnd/browser/dnd.js';\nimport { IFileService } from '../../../../platform/files/common/files.js';\nimport { createDecorator } from '../../../../platform/instantiation/common/instantiation.js';\nimport { MarkerSeverity } from '../../../../platform/markers/common/markers.js';\nimport { isUntitledResourceEditorInput } from '../../../common/editor.js';\nimport { EditorInput } from '../../../common/editor/editorInput.js';\nimport { IEditorService } from '../../../services/editor/common/editorService.js';\nimport { IExtensionService, isProposedApiEnabled } from '../../../services/extensions/common/extensions.js';\nimport { UntitledTextEditorInput } from '../../../services/untitled/common/untitledTextEditorInput.js';\nimport { createNotebookOutputVariableEntry, NOTEBOOK_CELL_OUTPUT_MIME_TYPE_LIST_FOR_CHAT_CONST } from '../../notebook/browser/contrib/chat/notebookChatUtils.js';\nimport { getOutputViewModelFromId } from '../../notebook/browser/controller/cellOutputActions.js';\nimport { getNotebookEditorFromEditorPane } from '../../notebook/browser/notebookBrowser.js';\nimport { SCMHistoryItemTransferData } from '../../scm/browser/scmHistoryChatContext.js';\nimport { CHAT_ATTACHABLE_IMAGE_MIME_TYPES, getAttachableImageExtension } from '../common/chatModel.js';\nimport { IChatRequestVariableEntry, OmittedState, IDiagnosticVariableEntry, IDiagnosticVariableEntryFilterData, ISymbolVariableEntry, toPromptFileVariableEntry, PromptFileVariableKind, ISCMHistoryItemVariableEntry } from '../common/chatVariableEntries.js';\nimport { getPromptsTypeForLanguageId, PromptsType } from '../common/promptSyntax/promptTypes.js';\nimport { imageToHash } from './chatPasteProviders.js';\nimport { resizeImage } from './imageUtils.js';\n\nexport const IChatAttachmentResolveService = createDecorator<IChatAttachmentResolveService>('IChatAttachmentResolveService');\n\nexport interface IChatAttachmentResolveService {\n\t_serviceBrand: undefined;\n\n\tresolveEditorAttachContext(editor: EditorInput | IDraggedResourceEditorInput): Promise<IChatRequestVariableEntry | undefined>;\n\tresolveUntitledEditorAttachContext(editor: IDraggedResourceEditorInput): Promise<IChatRequestVariableEntry | undefined>;\n\tresolveResourceAttachContext(resource: URI, isDirectory: boolean): Promise<IChatRequestVariableEntry | undefined>;\n\n\tresolveImageEditorAttachContext(resource: URI, data?: VSBuffer, mimeType?: string): Promise<IChatRequestVariableEntry | undefined>;\n\tresolveImageAttachContext(images: ImageTransferData[]): Promise<IChatRequestVariableEntry[]>;\n\tresolveMarkerAttachContext(markers: MarkerTransferData[]): IDiagnosticVariableEntry[];\n\tresolveSymbolsAttachContext(symbols: DocumentSymbolTransferData[]): ISymbolVariableEntry[];\n\tresolveNotebookOutputAttachContext(data: NotebookCellOutputTransferData): IChatRequestVariableEntry[];\n\tresolveSourceControlHistoryItemAttachContext(data: SCMHistoryItemTransferData[]): ISCMHistoryItemVariableEntry[];\n}\n\nexport class ChatAttachmentResolveService implements IChatAttachmentResolveService {\n\t_serviceBrand: undefined;\n\n\tconstructor(\n\t\t@IFileService private fileService: IFileService,\n\t\t@IEditorService private editorService: IEditorService,\n\t\t@ITextModelService private textModelService: ITextModelService,\n\t\t@IExtensionService private extensionService: IExtensionService,\n\t\t@IDialogService private dialogService: IDialogService\n\t) { }\n\n\t// --- EDITORS ---\n\n\tpublic async resolveEditorAttachContext(editor: EditorInput | IDraggedResourceEditorInput): Promise<IChatRequestVariableEntry | undefined> {\n\t\t// untitled editor\n\t\tif (isUntitledResourceEditorInput(editor)) {\n\t\t\treturn await this.resolveUntitledEditorAttachContext(editor);\n\t\t}\n\n\t\tif (!editor.resource) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\tlet stat;\n\t\ttry {\n\t\t\tstat = await this.fileService.stat(editor.resource);\n\t\t} catch {\n\t\t\treturn undefined;\n\t\t}\n\n\t\tif (!stat.isDirectory && !stat.isFile) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\tconst imageContext = await this.resolveImageEditorAttachContext(editor.resource);\n\t\tif (imageContext) {\n\t\t\treturn this.extensionService.extensions.some(ext => isProposedApiEnabled(ext, 'chatReferenceBinaryData')) ? imageContext : undefined;\n\t\t}\n\n\t\treturn await this.resolveResourceAttachContext(editor.resource, stat.isDirectory);\n\t}\n\n\tpublic async resolveUntitledEditorAttachContext(editor: IDraggedResourceEditorInput): Promise<IChatRequestVariableEntry | undefined> {\n\t\t// If the resource is known, we can use it directly\n\t\tif (editor.resource) {\n\t\t\treturn await this.resolveResourceAttachContext(editor.resource, false);\n\t\t}\n\n\t\t// Otherwise, we need to check if the contents are already open in another editor\n\t\tconst openUntitledEditors = this.editorService.editors.filter(editor => editor instanceof UntitledTextEditorInput) as UntitledTextEditorInput[];\n\t\tfor (const canidate of openUntitledEditors) {\n\t\t\tconst model = await canidate.resolve();\n\t\t\tconst contents = model.textEditorModel?.getValue();\n\t\t\tif (contents === editor.contents) {\n\t\t\t\treturn await this.resolveResourceAttachContext(canidate.resource, false);\n\t\t\t}\n\t\t}\n\n\t\treturn undefined;\n\t}\n\n\tpublic async resolveResourceAttachContext(resource: URI, isDirectory: boolean): Promise<IChatRequestVariableEntry | undefined> {\n\t\tlet omittedState = OmittedState.NotOmitted;\n\n\t\tif (!isDirectory) {\n\n\t\t\tlet languageId: string | undefined;\n\t\t\ttry {\n\t\t\t\tconst createdModel = await this.textModelService.createModelReference(resource);\n\t\t\t\tlanguageId = createdModel.object.getLanguageId();\n\t\t\t\tcreatedModel.dispose();\n\t\t\t} catch {\n\t\t\t\tomittedState = OmittedState.Full;\n\t\t\t}\n\n\t\t\tif (/\\.(svg)$/i.test(resource.path)) {\n\t\t\t\tomittedState = OmittedState.Full;\n\t\t\t}\n\t\t\tif (languageId) {\n\t\t\t\tconst promptsType = getPromptsTypeForLanguageId(languageId);\n\t\t\t\tif (promptsType === PromptsType.prompt) {\n\t\t\t\t\treturn toPromptFileVariableEntry(resource, PromptFileVariableKind.PromptFile);\n\t\t\t\t} else if (promptsType === PromptsType.instructions) {\n\t\t\t\t\treturn toPromptFileVariableEntry(resource, PromptFileVariableKind.Instruction);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn {\n\t\t\tkind: isDirectory ? 'directory' : 'file',\n\t\t\tvalue: resource,\n\t\t\tid: resource.toString(),\n\t\t\tname: basename(resource),\n\t\t\tomittedState\n\t\t};\n\t}\n\n\t// --- IMAGES ---\n\n\tpublic async resolveImageEditorAttachContext(resource: URI, data?: VSBuffer, mimeType?: string): Promise<IChatRequestVariableEntry | undefined> {\n\t\tif (!resource) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\tif (mimeType) {\n\t\t\tif (!getAttachableImageExtension(mimeType)) {\n\t\t\t\treturn undefined;\n\t\t\t}\n\t\t} else {\n\t\t\tconst match = SUPPORTED_IMAGE_EXTENSIONS_REGEX.exec(resource.path);\n\t\t\tif (!match) {\n\t\t\t\treturn undefined;\n\t\t\t}\n\n\t\t\tmimeType = getMimeTypeFromPath(match);\n\t\t}\n\t\tconst fileName = basename(resource);\n\n\t\tlet dataBuffer: VSBuffer | undefined;\n\t\tif (data) {\n\t\t\tdataBuffer = data;\n\t\t} else {\n\n\t\t\tlet stat;\n\t\t\ttry {\n\t\t\t\tstat = await this.fileService.stat(resource);\n\t\t\t} catch {\n\t\t\t\treturn undefined;\n\t\t\t}\n\n\t\t\tconst readFile = await this.fileService.readFile(resource);\n\n\t\t\tif (stat.size > 30 * 1024 * 1024) { // 30 MB\n\t\t\t\tthis.dialogService.error(localize('imageTooLarge', 'Image is too large'), localize('imageTooLargeMessage', 'The image {0} is too large to be attached.', fileName));\n\t\t\t\tthrow new Error('Image is too large');\n\t\t\t}\n\n\t\t\tdataBuffer = readFile.value;\n\t\t}\n\n\t\tconst isPartiallyOmitted = /\\.gif$/i.test(resource.path);\n\t\tconst imageFileContext = await this.resolveImageAttachContext([{\n\t\t\tid: resource.toString(),\n\t\t\tname: fileName,\n\t\t\tdata: dataBuffer.buffer,\n\t\t\ticon: Codicon.fileMedia,\n\t\t\tresource: resource,\n\t\t\tmimeType: mimeType,\n\t\t\tomittedState: isPartiallyOmitted ? OmittedState.Partial : OmittedState.NotOmitted\n\t\t}]);\n\n\t\treturn imageFileContext[0];\n\t}\n\n\tpublic resolveImageAttachContext(images: ImageTransferData[]): Promise<IChatRequestVariableEntry[]> {\n\t\treturn Promise.all(images.map(async image => ({\n\t\t\tid: image.id || await imageToHash(image.data),\n\t\t\tname: image.name,\n\t\t\tfullName: image.resource ? image.resource.path : undefined,\n\t\t\tvalue: await resizeImage(image.data, image.mimeType),\n\t\t\ticon: image.icon,\n\t\t\tkind: 'image',\n\t\t\tisFile: false,\n\t\t\tisDirectory: false,\n\t\t\tomittedState: image.omittedState || OmittedState.NotOmitted,\n\t\t\treferences: image.resource ? [{ reference: image.resource, kind: 'reference' }] : []\n\t\t})));\n\t}\n\n\t// --- MARKERS ---\n\n\tpublic resolveMarkerAttachContext(markers: MarkerTransferData[]): IDiagnosticVariableEntry[] {\n\t\treturn markers.map((marker): IDiagnosticVariableEntry => {\n\t\t\tlet filter: IDiagnosticVariableEntryFilterData;\n\t\t\tif (!('severity' in marker)) {\n\t\t\t\tfilter = { filterUri: URI.revive(marker.uri), filterSeverity: MarkerSeverity.Warning };\n\t\t\t} else {\n\t\t\t\tfilter = IDiagnosticVariableEntryFilterData.fromMarker(marker);\n\t\t\t}\n\n\t\t\treturn IDiagnosticVariableEntryFilterData.toEntry(filter);\n\t\t});\n\t}\n\n\t// --- SYMBOLS ---\n\n\tpublic resolveSymbolsAttachContext(symbols: DocumentSymbolTransferData[]): ISymbolVariableEntry[] {\n\t\treturn symbols.map(symbol => {\n\t\t\tconst resource = URI.file(symbol.fsPath);\n\t\t\treturn {\n\t\t\t\tkind: 'symbol',\n\t\t\t\tid: symbolId(resource, symbol.range),\n\t\t\t\tvalue: { uri: resource, range: symbol.range },\n\t\t\t\tsymbolKind: symbol.kind,\n\t\t\t\ticon: SymbolKinds.toIcon(symbol.kind),\n\t\t\t\tfullName: symbol.name,\n\t\t\t\tname: symbol.name,\n\t\t\t};\n\t\t});\n\t}\n\n\t// --- NOTEBOOKS ---\n\n\tpublic resolveNotebookOutputAttachContext(data: NotebookCellOutputTransferData): IChatRequestVariableEntry[] {\n\t\tconst notebookEditor = getNotebookEditorFromEditorPane(this.editorService.activeEditorPane);\n\t\tif (!notebookEditor) {\n\t\t\treturn [];\n\t\t}\n\n\t\tconst outputViewModel = getOutputViewModelFromId(data.outputId, notebookEditor);\n\t\tif (!outputViewModel) {\n\t\t\treturn [];\n\t\t}\n\n\t\tconst mimeType = outputViewModel.pickedMimeType?.mimeType;\n\t\tif (mimeType && NOTEBOOK_CELL_OUTPUT_MIME_TYPE_LIST_FOR_CHAT_CONST.includes(mimeType)) {\n\n\t\t\tconst entry = createNotebookOutputVariableEntry(outputViewModel, mimeType, notebookEditor);\n\t\t\tif (!entry) {\n\t\t\t\treturn [];\n\t\t\t}\n\n\t\t\treturn [entry];\n\t\t}\n\n\t\treturn [];\n\t}\n\n\t// --- SOURCE CONTROL ---\n\n\tpublic resolveSourceControlHistoryItemAttachContext(data: SCMHistoryItemTransferData[]): ISCMHistoryItemVariableEntry[] {\n\t\treturn data.map(d => ({\n\t\t\tid: d.historyItem.id,\n\t\t\tname: d.name,\n\t\t\tvalue: URI.revive(d.resource),\n\t\t\thistoryItem: {\n\t\t\t\t...d.historyItem,\n\t\t\t\treferences: []\n\t\t\t},\n\t\t\tkind: 'scmHistoryItem'\n\t\t} satisfies ISCMHistoryItemVariableEntry));\n\t}\n}\n\nfunction symbolId(resource: URI, range?: IRange): string {\n\tlet rangePart = '';\n\tif (range) {\n\t\trangePart = `:${range.startLineNumber}`;\n\t\tif (range.startLineNumber !== range.endLineNumber) {\n\t\t\trangePart += `-${range.endLineNumber}`;\n\t\t}\n\t}\n\treturn resource.fsPath + rangePart;\n}\n\nexport type ImageTransferData = {\n\tdata: Uint8Array;\n\tname: string;\n\ticon?: ThemeIcon;\n\tresource?: URI;\n\tid?: string;\n\tmimeType?: string;\n\tomittedState?: OmittedState;\n};\nconst SUPPORTED_IMAGE_EXTENSIONS_REGEX = new RegExp(`\\\\.(${Object.keys(CHAT_ATTACHABLE_IMAGE_MIME_TYPES).join('|')})$`, 'i');\n\nfunction getMimeTypeFromPath(match: RegExpExecArray): string | undefined {\n\tconst ext = match[1].toLowerCase();\n\treturn CHAT_ATTACHABLE_IMAGE_MIME_TYPES[ext];\n}\n\n"]}