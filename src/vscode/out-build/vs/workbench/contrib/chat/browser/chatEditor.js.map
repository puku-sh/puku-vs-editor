{"version":3,"sources":["vs/workbench/contrib/chat/browser/chatEditor.ts"],"names":[],"mappings":"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","file":"chatEditor.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as dom from '../../../../base/browser/dom.js';\nimport { renderIcon } from '../../../../base/browser/ui/iconLabel/iconLabels.js';\nimport { raceCancellationError } from '../../../../base/common/async.js';\nimport { CancellationToken } from '../../../../base/common/cancellation.js';\nimport { Codicon } from '../../../../base/common/codicons.js';\nimport { ThemeIcon } from '../../../../base/common/themables.js';\nimport * as nls from '../../../../nls.js';\nimport { IContextKeyService, IScopedContextKeyService } from '../../../../platform/contextkey/common/contextkey.js';\nimport { IEditorOptions } from '../../../../platform/editor/common/editor.js';\nimport { IInstantiationService } from '../../../../platform/instantiation/common/instantiation.js';\nimport { ServiceCollection } from '../../../../platform/instantiation/common/serviceCollection.js';\nimport { IStorageService } from '../../../../platform/storage/common/storage.js';\nimport { ITelemetryService } from '../../../../platform/telemetry/common/telemetry.js';\nimport { editorBackground, editorForeground, inputBackground } from '../../../../platform/theme/common/colorRegistry.js';\nimport { IThemeService } from '../../../../platform/theme/common/themeService.js';\nimport { EditorPane } from '../../../browser/parts/editor/editorPane.js';\nimport { IEditorOpenContext } from '../../../common/editor.js';\nimport { EDITOR_DRAG_AND_DROP_BACKGROUND } from '../../../common/theme.js';\nimport { IEditorGroup } from '../../../services/editor/common/editorGroupsService.js';\nimport { ChatContextKeys } from '../common/chatContextKeys.js';\nimport { IChatModel, IChatModelInputState, IExportableChatData, ISerializableChatData } from '../common/chatModel.js';\nimport { IChatService } from '../common/chatService.js';\nimport { IChatSessionsService, localChatSessionType } from '../common/chatSessionsService.js';\nimport { ChatAgentLocation, ChatModeKind } from '../common/constants.js';\nimport { clearChatEditor } from './actions/chatClear.js';\nimport { ChatEditorInput } from './chatEditorInput.js';\nimport { ChatWidget } from './chatWidget.js';\n\nexport interface IChatEditorOptions extends IEditorOptions {\n\t/**\n\t * Input state of the model when the editor is opened. Currently needed since\n\t * new sessions are not persisted but may go away with\n\t * https://github.com/microsoft/vscode/pull/278476 as input state is stored on the model.\n\t */\n\tmodelInputState?: IChatModelInputState;\n\ttarget?: { data: IExportableChatData | ISerializableChatData };\n\ttitle?: {\n\t\tpreferred?: string;\n\t\tfallback?: string;\n\t};\n\tignoreInView?: boolean;\n}\n\nexport class ChatEditor extends EditorPane {\n\tprivate _widget!: ChatWidget;\n\tpublic get widget(): ChatWidget {\n\t\treturn this._widget;\n\t}\n\tprivate _scopedContextKeyService!: IScopedContextKeyService;\n\toverride get scopedContextKeyService() {\n\t\treturn this._scopedContextKeyService;\n\t}\n\n\tprivate dimension = new dom.Dimension(0, 0);\n\tprivate _loadingContainer: HTMLElement | undefined;\n\tprivate _editorContainer: HTMLElement | undefined;\n\n\tconstructor(\n\t\tgroup: IEditorGroup,\n\t\t@ITelemetryService telemetryService: ITelemetryService,\n\t\t@IThemeService themeService: IThemeService,\n\t\t@IInstantiationService private readonly instantiationService: IInstantiationService,\n\t\t@IStorageService storageService: IStorageService,\n\t\t@IChatSessionsService private readonly chatSessionsService: IChatSessionsService,\n\t\t@IContextKeyService private readonly contextKeyService: IContextKeyService,\n\t\t@IChatService private readonly chatService: IChatService,\n\t) {\n\t\tsuper(ChatEditorInput.EditorID, group, telemetryService, themeService, storageService);\n\t}\n\n\tprivate async clear() {\n\t\tif (this.input) {\n\t\t\treturn this.instantiationService.invokeFunction(clearChatEditor, this.input as ChatEditorInput);\n\t\t}\n\t}\n\n\tprotected override createEditor(parent: HTMLElement): void {\n\t\tthis._editorContainer = parent;\n\t\t// Ensure the container has position relative for the loading overlay\n\t\tparent.classList.add('chat-editor-relative');\n\t\tthis._scopedContextKeyService = this._register(this.contextKeyService.createScoped(parent));\n\t\tconst scopedInstantiationService = this._register(this.instantiationService.createChild(new ServiceCollection([IContextKeyService, this.scopedContextKeyService])));\n\t\tChatContextKeys.inChatEditor.bindTo(this._scopedContextKeyService).set(true);\n\n\t\tthis._widget = this._register(\n\t\t\tscopedInstantiationService.createInstance(\n\t\t\t\tChatWidget,\n\t\t\t\tChatAgentLocation.Chat,\n\t\t\t\tundefined,\n\t\t\t\t{\n\t\t\t\t\tautoScroll: mode => mode !== ChatModeKind.Ask,\n\t\t\t\t\trenderFollowups: true,\n\t\t\t\t\tsupportsFileReferences: true,\n\t\t\t\t\tclear: () => this.clear(),\n\t\t\t\t\trendererOptions: {\n\t\t\t\t\t\trenderTextEditsAsSummary: (uri) => {\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t},\n\t\t\t\t\t\treferencesExpandedWhenEmptyResponse: false,\n\t\t\t\t\t\tprogressMessageAtBottomOfResponse: mode => mode !== ChatModeKind.Ask,\n\t\t\t\t\t},\n\t\t\t\t\tenableImplicitContext: true,\n\t\t\t\t\tenableWorkingSet: 'explicit',\n\t\t\t\t\tsupportsChangingModes: true,\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tlistForeground: editorForeground,\n\t\t\t\t\tlistBackground: editorBackground,\n\t\t\t\t\toverlayBackground: EDITOR_DRAG_AND_DROP_BACKGROUND,\n\t\t\t\t\tinputEditorBackground: inputBackground,\n\t\t\t\t\tresultEditorBackground: editorBackground\n\t\t\t\t}));\n\t\tthis.widget.render(parent);\n\t\tthis.widget.setVisible(true);\n\t}\n\n\tprotected override setEditorVisible(visible: boolean): void {\n\t\tsuper.setEditorVisible(visible);\n\n\t\tthis.widget?.setVisible(visible);\n\n\t\tif (visible && this.widget) {\n\t\t\tthis.widget.layout(this.dimension.height, this.dimension.width);\n\t\t}\n\t}\n\n\tpublic override focus(): void {\n\t\tsuper.focus();\n\n\t\tthis.widget?.focusInput();\n\t}\n\n\toverride clearInput(): void {\n\t\tthis.saveState();\n\t\tsuper.clearInput();\n\t}\n\n\tprivate showLoadingInChatWidget(message: string): void {\n\t\tif (!this._editorContainer) {\n\t\t\treturn;\n\t\t}\n\n\t\t// If already showing, just update text\n\t\tif (this._loadingContainer) {\n\t\t\t// eslint-disable-next-line no-restricted-syntax\n\t\t\tconst existingText = this._loadingContainer.querySelector('.chat-loading-content span');\n\t\t\tif (existingText) {\n\t\t\t\texistingText.textContent = message;\n\t\t\t\treturn; // aria-live will announce the text change\n\t\t\t}\n\t\t\tthis.hideLoadingInChatWidget(); // unexpected structure\n\t\t}\n\n\t\t// Mark container busy for assistive technologies\n\t\tthis._editorContainer.setAttribute('aria-busy', 'true');\n\n\t\tthis._loadingContainer = dom.append(this._editorContainer, dom.$('.chat-loading-overlay'));\n\t\t// Accessibility: announce loading state politely without stealing focus\n\t\tthis._loadingContainer.setAttribute('role', 'status');\n\t\tthis._loadingContainer.setAttribute('aria-live', 'polite');\n\t\t// Rely on live region text content instead of aria-label to avoid duplicate announcements\n\t\tthis._loadingContainer.tabIndex = -1; // ensure it isn't focusable\n\t\tconst loadingContent = dom.append(this._loadingContainer, dom.$('.chat-loading-content'));\n\t\tconst spinner = renderIcon(ThemeIcon.modify(Codicon.loading, 'spin'));\n\t\tspinner.setAttribute('aria-hidden', 'true');\n\t\tloadingContent.appendChild(spinner);\n\t\tconst text = dom.append(loadingContent, dom.$('span'));\n\t\ttext.textContent = message;\n\t}\n\n\tprivate hideLoadingInChatWidget(): void {\n\t\tif (this._loadingContainer) {\n\t\t\tthis._loadingContainer.remove();\n\t\t\tthis._loadingContainer = undefined;\n\t\t}\n\t\tif (this._editorContainer) {\n\t\t\tthis._editorContainer.removeAttribute('aria-busy');\n\t\t}\n\t}\n\n\toverride async setInput(input: ChatEditorInput, options: IChatEditorOptions | undefined, context: IEditorOpenContext, token: CancellationToken): Promise<void> {\n\t\t// Show loading indicator early for non-local sessions to prevent layout shifts\n\t\tlet isContributedChatSession = false;\n\t\tconst chatSessionType = input.getSessionType();\n\t\tif (chatSessionType !== localChatSessionType) {\n\t\t\tconst loadingMessage = nls.localize('chatEditor.loadingSession', \"Loading...\");\n\t\t\tthis.showLoadingInChatWidget(loadingMessage);\n\t\t}\n\n\t\tawait super.setInput(input, options, context, token);\n\t\tif (token.isCancellationRequested) {\n\t\t\tthis.hideLoadingInChatWidget();\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.widget) {\n\t\t\tthrow new Error('ChatEditor lifecycle issue: no editor widget');\n\t\t}\n\n\t\tif (chatSessionType !== localChatSessionType) {\n\t\t\ttry {\n\t\t\t\tawait raceCancellationError(this.chatSessionsService.canResolveChatSession(input.resource), token);\n\t\t\t\tconst contributions = this.chatSessionsService.getAllChatSessionContributions();\n\t\t\t\tconst contribution = contributions.find(c => c.type === chatSessionType);\n\t\t\t\tif (contribution) {\n\t\t\t\t\tthis.widget.lockToCodingAgent(contribution.name, contribution.displayName, contribution.type);\n\t\t\t\t\tisContributedChatSession = true;\n\t\t\t\t} else {\n\t\t\t\t\tthis.widget.unlockFromCodingAgent();\n\t\t\t\t}\n\t\t\t} catch (error) {\n\t\t\t\tthis.hideLoadingInChatWidget();\n\t\t\t\tthrow error;\n\t\t\t}\n\t\t} else {\n\t\t\tthis.widget.unlockFromCodingAgent();\n\t\t}\n\n\t\ttry {\n\t\t\tconst editorModel = await raceCancellationError(input.resolve(), token);\n\n\t\t\tif (!editorModel) {\n\t\t\t\tthrow new Error(`Failed to get model for chat editor. resource: ${input.sessionResource}`);\n\t\t\t}\n\n\t\t\t// Hide loading state before updating model\n\t\t\tif (chatSessionType !== localChatSessionType) {\n\t\t\t\tthis.hideLoadingInChatWidget();\n\t\t\t}\n\n\t\t\tif (options?.modelInputState) {\n\t\t\t\teditorModel.model.inputModel.setState(options.modelInputState);\n\t\t\t}\n\n\t\t\tthis.updateModel(editorModel.model);\n\n\t\t\tif (isContributedChatSession && options?.title?.preferred && input.sessionResource) {\n\t\t\t\tthis.chatService.setChatSessionTitle(input.sessionResource, options.title.preferred);\n\t\t\t}\n\t\t} catch (error) {\n\t\t\tthis.hideLoadingInChatWidget();\n\t\t\tthrow error;\n\t\t}\n\t}\n\n\tprivate updateModel(model: IChatModel): void {\n\t\tthis.widget.setModel(model);\n\t}\n\n\toverride layout(dimension: dom.Dimension, position?: dom.IDomPosition | undefined): void {\n\t\tthis.dimension = dimension;\n\t\tif (this.widget) {\n\t\t\tthis.widget.layout(dimension.height, dimension.width);\n\t\t}\n\t}\n}\n"]}