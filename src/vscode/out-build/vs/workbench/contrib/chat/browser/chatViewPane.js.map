{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/contrib/chat/browser/chatViewPane.ts","vs/workbench/contrib/chat/browser/chatViewPane.ts"],"names":[],"mappings":"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","file":"chatViewPane.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { $, getWindow } from '../../../../base/browser/dom.js';\nimport { CancellationToken } from '../../../../base/common/cancellation.js';\nimport { DisposableStore } from '../../../../base/common/lifecycle.js';\nimport { MarshalledId } from '../../../../base/common/marshallingIds.js';\nimport { autorun, IReader } from '../../../../base/common/observable.js';\nimport { URI } from '../../../../base/common/uri.js';\nimport { IConfigurationService } from '../../../../platform/configuration/common/configuration.js';\nimport { IContextKeyService } from '../../../../platform/contextkey/common/contextkey.js';\nimport { IContextMenuService } from '../../../../platform/contextview/browser/contextView.js';\nimport { IHoverService } from '../../../../platform/hover/browser/hover.js';\nimport { IInstantiationService } from '../../../../platform/instantiation/common/instantiation.js';\nimport { ServiceCollection } from '../../../../platform/instantiation/common/serviceCollection.js';\nimport { IKeybindingService } from '../../../../platform/keybinding/common/keybinding.js';\nimport { ILayoutService } from '../../../../platform/layout/browser/layoutService.js';\nimport { ILogService } from '../../../../platform/log/common/log.js';\nimport { IOpenerService } from '../../../../platform/opener/common/opener.js';\nimport { IStorageService, StorageScope, StorageTarget } from '../../../../platform/storage/common/storage.js';\nimport { ITelemetryService } from '../../../../platform/telemetry/common/telemetry.js';\nimport { editorBackground } from '../../../../platform/theme/common/colorRegistry.js';\nimport { IThemeService } from '../../../../platform/theme/common/themeService.js';\nimport { IViewPaneOptions, ViewPane } from '../../../browser/parts/views/viewPane.js';\nimport { Memento } from '../../../common/memento.js';\nimport { SIDE_BAR_FOREGROUND } from '../../../common/theme.js';\nimport { IViewDescriptorService, ViewContainerLocation } from '../../../common/views.js';\nimport { IChatViewTitleActionContext } from '../common/chatActions.js';\nimport { IChatAgentService } from '../common/chatAgents.js';\nimport { ChatContextKeys } from '../common/chatContextKeys.js';\nimport { IChatModel, IChatModelInputState } from '../common/chatModel.js';\nimport { CHAT_PROVIDER_ID } from '../common/chatParticipantContribTypes.js';\nimport { IChatService } from '../common/chatService.js';\nimport { IChatSessionsExtensionPoint, IChatSessionsService, localChatSessionType } from '../common/chatSessionsService.js';\nimport { LocalChatSessionUri } from '../common/chatUri.js';\nimport { ChatAgentLocation, ChatModeKind } from '../common/constants.js';\nimport { ChatWidget } from './chatWidget.js';\nimport { ChatViewWelcomeController, IViewWelcomeDelegate } from './viewsWelcome/chatViewWelcomeController.js';\n\ninterface IViewPaneState extends Partial<IChatModelInputState> {\n\tsessionId?: string;\n\thasMigratedCurrentSession?: boolean;\n}\n\nexport const CHAT_SIDEBAR_PANEL_ID = 'workbench.panel.chat';\nexport class ChatViewPane extends ViewPane implements IViewWelcomeDelegate {\n\tprivate _widget!: ChatWidget;\n\tget widget(): ChatWidget { return this._widget; }\n\n\tprivate readonly modelDisposables = this._register(new DisposableStore());\n\tprivate memento: Memento<IViewPaneState>;\n\tprivate readonly viewState: IViewPaneState;\n\n\tprivate _restoringSession: Promise<void> | undefined;\n\n\tconstructor(\n\t\tprivate readonly chatOptions: { location: ChatAgentLocation.Chat },\n\t\toptions: IViewPaneOptions,\n\t\t@IKeybindingService keybindingService: IKeybindingService,\n\t\t@IContextMenuService contextMenuService: IContextMenuService,\n\t\t@IConfigurationService configurationService: IConfigurationService,\n\t\t@IContextKeyService contextKeyService: IContextKeyService,\n\t\t@IViewDescriptorService viewDescriptorService: IViewDescriptorService,\n\t\t@IInstantiationService instantiationService: IInstantiationService,\n\t\t@IOpenerService openerService: IOpenerService,\n\t\t@IThemeService themeService: IThemeService,\n\t\t@IHoverService hoverService: IHoverService,\n\t\t@IStorageService private readonly storageService: IStorageService,\n\t\t@IChatService private readonly chatService: IChatService,\n\t\t@IChatAgentService private readonly chatAgentService: IChatAgentService,\n\t\t@ILogService private readonly logService: ILogService,\n\t\t@ILayoutService private readonly layoutService: ILayoutService,\n\t\t@IChatSessionsService private readonly chatSessionsService: IChatSessionsService,\n\t\t@ITelemetryService private readonly telemetryService: ITelemetryService,\n\t) {\n\t\tsuper(options, keybindingService, contextMenuService, configurationService, contextKeyService, viewDescriptorService, instantiationService, openerService, themeService, hoverService);\n\n\t\t// View state for the ViewPane is currently global per-provider basically, but some other strictly per-model state will require a separate memento.\n\t\tthis.memento = new Memento('interactive-session-view-' + CHAT_PROVIDER_ID, this.storageService);\n\t\tthis.viewState = this.memento.getMemento(StorageScope.WORKSPACE, StorageTarget.MACHINE);\n\n\t\tif (this.chatOptions.location === ChatAgentLocation.Chat && !this.viewState.hasMigratedCurrentSession) {\n\t\t\tconst editsMemento = new Memento<IViewPaneState>('interactive-session-view-' + CHAT_PROVIDER_ID + `-edits`, this.storageService);\n\t\t\tconst lastEditsState = editsMemento.getMemento(StorageScope.WORKSPACE, StorageTarget.MACHINE);\n\t\t\tif (lastEditsState.sessionId) {\n\t\t\t\tthis.logService.trace(`ChatViewPane: last edits session was ${lastEditsState.sessionId}`);\n\t\t\t\tif (!this.chatService.isPersistedSessionEmpty(LocalChatSessionUri.forSession(lastEditsState.sessionId))) {\n\t\t\t\t\tthis.logService.info(`ChatViewPane: migrating ${lastEditsState.sessionId} to unified view`);\n\t\t\t\t\tthis.viewState.sessionId = lastEditsState.sessionId;\n\t\t\t\t\t// Migrate old inputValue to new inputText, and old chatMode to new mode structure\n\t\t\t\t\tif (lastEditsState.inputText) {\n\t\t\t\t\t\tthis.viewState.inputText = lastEditsState.inputText;\n\t\t\t\t\t}\n\t\t\t\t\tif (lastEditsState.mode) {\n\t\t\t\t\t\tthis.viewState.mode = lastEditsState.mode;\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// Default to Edit mode for migrated edits sessions\n\t\t\t\t\t\tthis.viewState.mode = { id: ChatModeKind.Edit, kind: ChatModeKind.Edit };\n\t\t\t\t\t}\n\t\t\t\t\tthis.viewState.hasMigratedCurrentSession = true;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tthis._register(this.chatAgentService.onDidChangeAgents(() => {\n\t\t\tif (this.chatAgentService.getDefaultAgent(this.chatOptions?.location)) {\n\t\t\t\tif (!this._widget?.viewModel && !this._restoringSession) {\n\t\t\t\t\tconst info = this.getTransferredOrPersistedSessionInfo();\n\t\t\t\t\tthis._restoringSession =\n\t\t\t\t\t\t(info.sessionId ? this.chatService.getOrRestoreSession(LocalChatSessionUri.forSession(info.sessionId)) : Promise.resolve(undefined)).then(async model => {\n\t\t\t\t\t\t\tif (!this._widget) {\n\t\t\t\t\t\t\t\t// renderBody has not been called yet\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t// The widget may be hidden at this point, because welcome views were allowed. Use setVisible to\n\t\t\t\t\t\t\t// avoid doing a render while the widget is hidden. This is changing the condition in `shouldShowWelcome`\n\t\t\t\t\t\t\t// so it should fire onDidChangeViewWelcomeState.\n\t\t\t\t\t\t\tconst wasVisible = this._widget.visible;\n\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\tthis._widget.setVisible(false);\n\t\t\t\t\t\t\t\tif (info.inputState && model) {\n\t\t\t\t\t\t\t\t\tmodel.inputModel.setState(info.inputState);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tawait this.updateModel(model);\n\t\t\t\t\t\t\t} finally {\n\t\t\t\t\t\t\t\tthis.widget.setVisible(wasVisible);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\tthis._restoringSession.finally(() => this._restoringSession = undefined);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis._onDidChangeViewWelcomeState.fire();\n\t\t}));\n\n\t\t// Location context key\n\t\tChatContextKeys.panelLocation.bindTo(contextKeyService).set(viewDescriptorService.getViewLocationById(options.id) ?? ViewContainerLocation.AuxiliaryBar);\n\t}\n\n\toverride getActionsContext(): IChatViewTitleActionContext | undefined {\n\t\treturn this.widget?.viewModel ? {\n\t\t\tsessionResource: this.widget.viewModel.sessionResource,\n\t\t\t$mid: MarshalledId.ChatViewContext\n\t\t} : undefined;\n\t}\n\n\tprivate async updateModel(model?: IChatModel | undefined) {\n\t\tthis.modelDisposables.clear();\n\n\t\tmodel = model ?? (this.chatService.transferredSessionData?.sessionId && this.chatService.transferredSessionData?.location === this.chatOptions.location\n\t\t\t? await this.chatService.getOrRestoreSession(LocalChatSessionUri.forSession(this.chatService.transferredSessionData.sessionId))\n\t\t\t: this.chatService.startSession(this.chatOptions.location, CancellationToken.None));\n\t\tif (!model) {\n\t\t\tthrow new Error('Could not start chat session');\n\t\t}\n\n\t\tthis.viewState.sessionId = model.sessionId;\n\t\tthis._widget.setModel(model);\n\n\t\t// Update the toolbar context with new sessionId\n\t\tthis.updateActions();\n\n\t\treturn model;\n\t}\n\n\toverride shouldShowWelcome(): boolean {\n\t\tconst noPersistedSessions = !this.chatService.hasSessions();\n\t\tconst hasCoreAgent = this.chatAgentService.getAgents().some(agent => agent.isCore && agent.locations.includes(this.chatOptions.location));\n\t\tconst hasDefaultAgent = this.chatAgentService.getDefaultAgent(this.chatOptions.location) !== undefined; // only false when Hide AI Features has run and unregistered the setup agents\n\t\tconst shouldShow = !hasCoreAgent && (!hasDefaultAgent || !this._widget?.viewModel && noPersistedSessions);\n\t\tthis.logService.trace(`ChatViewPane#shouldShowWelcome(${this.chatOptions.location}) = ${shouldShow}: hasCoreAgent=${hasCoreAgent} hasDefaultAgent=${hasDefaultAgent} || noViewModel=${!this._widget?.viewModel} && noPersistedSessions=${noPersistedSessions}`);\n\t\treturn !!shouldShow;\n\t}\n\n\tprivate getTransferredOrPersistedSessionInfo(): { sessionId?: string; inputState?: IChatModelInputState; mode?: ChatModeKind } {\n\t\tif (this.chatService.transferredSessionData?.location === this.chatOptions.location) {\n\t\t\tconst sessionId = this.chatService.transferredSessionData.sessionId;\n\t\t\treturn {\n\t\t\t\tsessionId,\n\t\t\t\tinputState: this.chatService.transferredSessionData.inputState,\n\t\t\t};\n\t\t} else {\n\t\t\treturn { sessionId: this.viewState.sessionId };\n\t\t}\n\t}\n\n\tprotected override async renderBody(parent: HTMLElement): Promise<void> {\n\t\tsuper.renderBody(parent);\n\n\n\t\ttype ChatViewPaneOpenedClassification = {\n\t\t\towner: 'sbatten';\n\t\t\tcomment: 'Event fired when the chat view pane is opened';\n\t\t};\n\n\t\tthis.telemetryService.publicLog2<{}, ChatViewPaneOpenedClassification>('chatViewPaneOpened');\n\n\t\tconst welcomeController = this._register(this.instantiationService.createInstance(ChatViewWelcomeController, parent, this, this.chatOptions.location));\n\t\tconst scopedInstantiationService = this._register(this.instantiationService.createChild(new ServiceCollection([IContextKeyService, this.scopedContextKeyService])));\n\t\tconst locationBasedColors = this.getLocationBasedColors();\n\t\tconst editorOverflowNode = this.layoutService.getContainer(getWindow(parent)).appendChild($('.chat-editor-overflow.monaco-editor'));\n\t\tthis._register({ dispose: () => editorOverflowNode.remove() });\n\n\t\tthis._widget = this._register(scopedInstantiationService.createInstance(\n\t\t\tChatWidget,\n\t\t\tthis.chatOptions.location,\n\t\t\t{ viewId: this.id },\n\t\t\t{\n\t\t\t\tautoScroll: mode => mode !== ChatModeKind.Ask,\n\t\t\t\trenderFollowups: this.chatOptions.location === ChatAgentLocation.Chat,\n\t\t\t\tsupportsFileReferences: true,\n\t\t\t\tclear: () => this.clear(),\n\t\t\t\trendererOptions: {\n\t\t\t\t\trenderTextEditsAsSummary: (uri) => {\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t},\n\t\t\t\t\treferencesExpandedWhenEmptyResponse: false,\n\t\t\t\t\tprogressMessageAtBottomOfResponse: mode => mode !== ChatModeKind.Ask,\n\t\t\t\t},\n\t\t\t\teditorOverflowWidgetsDomNode: editorOverflowNode,\n\t\t\t\tenableImplicitContext: this.chatOptions.location === ChatAgentLocation.Chat,\n\t\t\t\tenableWorkingSet: 'explicit',\n\t\t\t\tsupportsChangingModes: true,\n\t\t\t},\n\t\t\t{\n\t\t\t\tlistForeground: SIDE_BAR_FOREGROUND,\n\t\t\t\tlistBackground: locationBasedColors.background,\n\t\t\t\toverlayBackground: locationBasedColors.overlayBackground,\n\t\t\t\tinputEditorBackground: locationBasedColors.background,\n\t\t\t\tresultEditorBackground: editorBackground,\n\t\t\t}));\n\t\tthis._widget.render(parent);\n\n\t\tconst updateWidgetVisibility = (r?: IReader) => {\n\t\t\tthis._widget.setVisible(this.isBodyVisible() && !welcomeController.isShowingWelcome.read(r));\n\t\t};\n\t\tthis._register(this.onDidChangeBodyVisibility(() => {\n\t\t\tupdateWidgetVisibility();\n\t\t}));\n\t\tthis._register(autorun(r => {\n\t\t\tupdateWidgetVisibility(r);\n\t\t}));\n\n\t\tconst info = this.getTransferredOrPersistedSessionInfo();\n\t\tconst model = info.sessionId ? await this.chatService.getOrRestoreSession(LocalChatSessionUri.forSession(info.sessionId)) : undefined;\n\n\t\tif (model && info.inputState) {\n\t\t\tmodel.inputModel.setState(info.inputState);\n\t\t}\n\t\tawait this.updateModel(model);\n\t}\n\n\tacceptInput(query?: string): void {\n\t\tthis._widget.acceptInput(query);\n\t}\n\n\tprivate async clear(): Promise<void> {\n\t\tif (this.widget.viewModel) {\n\t\t\tawait this.chatService.clearSession(this.widget.viewModel.sessionResource);\n\t\t}\n\n\t\t// Grab the widget's latest view state because it will be loaded back into the widget\n\t\tthis.updateViewState();\n\t\tawait this.updateModel(undefined);\n\n\t\t// Update the toolbar context with new sessionId\n\t\tthis.updateActions();\n\t}\n\n\tasync loadSession(sessionId: URI): Promise<IChatModel | undefined> {\n\t\tif (this.widget.viewModel) {\n\t\t\tawait this.chatService.clearSession(this.widget.viewModel.sessionResource);\n\t\t}\n\n\t\t// Handle locking for contributed chat sessions\n\t\t// TODO: Is this logic still correct with sessions from different schemes?\n\t\tconst local = LocalChatSessionUri.parseLocalSessionId(sessionId);\n\t\tif (local) {\n\t\t\tawait this.chatSessionsService.canResolveChatSession(sessionId);\n\t\t\tconst contributions = this.chatSessionsService.getAllChatSessionContributions();\n\t\t\tconst contribution = contributions.find((c: IChatSessionsExtensionPoint) => c.type === localChatSessionType);\n\t\t\tif (contribution) {\n\t\t\t\tthis.widget.lockToCodingAgent(contribution.name, contribution.displayName, contribution.type);\n\t\t\t}\n\t\t}\n\n\t\tconst newModel = await this.chatService.loadSessionForResource(sessionId, ChatAgentLocation.Chat, CancellationToken.None);\n\t\treturn this.updateModel(newModel);\n\t}\n\n\tfocusInput(): void {\n\t\tthis._widget.focusInput();\n\t}\n\n\toverride focus(): void {\n\t\tsuper.focus();\n\t\tthis._widget.focusInput();\n\t}\n\n\tprotected override layoutBody(height: number, width: number): void {\n\t\tsuper.layoutBody(height, width);\n\t\tthis._widget.layout(height, width);\n\t}\n\n\toverride saveState(): void {\n\t\t// Don't do saveState when no widget, or no viewModel in which case the state has not yet been restored -\n\t\t// in that case the default state would overwrite the real state\n\t\tif (this._widget?.viewModel) {\n\t\t\tthis._widget.saveState();\n\n\t\t\tthis.updateViewState();\n\t\t\tthis.memento.saveMemento();\n\t\t}\n\n\t\tsuper.saveState();\n\t}\n\n\tprivate updateViewState(viewState?: IChatModelInputState): void {\n\t\tconst newViewState = viewState ?? this._widget.getViewState();\n\t\tif (newViewState) {\n\t\t\tfor (const [key, value] of Object.entries(newViewState)) {\n\t\t\t\t// Assign all props to the memento so they get saved\n\t\t\t\t(this.viewState as Record<string, unknown>)[key] = value;\n\t\t\t}\n\t\t}\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { $, getWindow } from '../../../../base/browser/dom.js';\nimport { CancellationToken } from '../../../../base/common/cancellation.js';\nimport { DisposableStore } from '../../../../base/common/lifecycle.js';\nimport { MarshalledId } from '../../../../base/common/marshallingIds.js';\nimport { autorun, IReader } from '../../../../base/common/observable.js';\nimport { URI } from '../../../../base/common/uri.js';\nimport { IConfigurationService } from '../../../../platform/configuration/common/configuration.js';\nimport { IContextKeyService } from '../../../../platform/contextkey/common/contextkey.js';\nimport { IContextMenuService } from '../../../../platform/contextview/browser/contextView.js';\nimport { IHoverService } from '../../../../platform/hover/browser/hover.js';\nimport { IInstantiationService } from '../../../../platform/instantiation/common/instantiation.js';\nimport { ServiceCollection } from '../../../../platform/instantiation/common/serviceCollection.js';\nimport { IKeybindingService } from '../../../../platform/keybinding/common/keybinding.js';\nimport { ILayoutService } from '../../../../platform/layout/browser/layoutService.js';\nimport { ILogService } from '../../../../platform/log/common/log.js';\nimport { IOpenerService } from '../../../../platform/opener/common/opener.js';\nimport { IStorageService, StorageScope, StorageTarget } from '../../../../platform/storage/common/storage.js';\nimport { ITelemetryService } from '../../../../platform/telemetry/common/telemetry.js';\nimport { editorBackground } from '../../../../platform/theme/common/colorRegistry.js';\nimport { IThemeService } from '../../../../platform/theme/common/themeService.js';\nimport { IViewPaneOptions, ViewPane } from '../../../browser/parts/views/viewPane.js';\nimport { Memento } from '../../../common/memento.js';\nimport { SIDE_BAR_FOREGROUND } from '../../../common/theme.js';\nimport { IViewDescriptorService, ViewContainerLocation } from '../../../common/views.js';\nimport { IChatViewTitleActionContext } from '../common/chatActions.js';\nimport { IChatAgentService } from '../common/chatAgents.js';\nimport { ChatContextKeys } from '../common/chatContextKeys.js';\nimport { IChatModel, IChatModelInputState } from '../common/chatModel.js';\nimport { CHAT_PROVIDER_ID } from '../common/chatParticipantContribTypes.js';\nimport { IChatService } from '../common/chatService.js';\nimport { IChatSessionsExtensionPoint, IChatSessionsService, localChatSessionType } from '../common/chatSessionsService.js';\nimport { LocalChatSessionUri } from '../common/chatUri.js';\nimport { ChatAgentLocation, ChatModeKind } from '../common/constants.js';\nimport { ChatWidget } from './chatWidget.js';\nimport { ChatViewWelcomeController, IViewWelcomeDelegate } from './viewsWelcome/chatViewWelcomeController.js';\n\ninterface IViewPaneState extends Partial<IChatModelInputState> {\n\tsessionId?: string;\n\thasMigratedCurrentSession?: boolean;\n}\n\nexport const CHAT_SIDEBAR_PANEL_ID = 'workbench.panel.chat';\nexport class ChatViewPane extends ViewPane implements IViewWelcomeDelegate {\n\tprivate _widget!: ChatWidget;\n\tget widget(): ChatWidget { return this._widget; }\n\n\tprivate readonly modelDisposables = this._register(new DisposableStore());\n\tprivate memento: Memento<IViewPaneState>;\n\tprivate readonly viewState: IViewPaneState;\n\n\tprivate _restoringSession: Promise<void> | undefined;\n\n\tconstructor(\n\t\tprivate readonly chatOptions: { location: ChatAgentLocation.Chat },\n\t\toptions: IViewPaneOptions,\n\t\t@IKeybindingService keybindingService: IKeybindingService,\n\t\t@IContextMenuService contextMenuService: IContextMenuService,\n\t\t@IConfigurationService configurationService: IConfigurationService,\n\t\t@IContextKeyService contextKeyService: IContextKeyService,\n\t\t@IViewDescriptorService viewDescriptorService: IViewDescriptorService,\n\t\t@IInstantiationService instantiationService: IInstantiationService,\n\t\t@IOpenerService openerService: IOpenerService,\n\t\t@IThemeService themeService: IThemeService,\n\t\t@IHoverService hoverService: IHoverService,\n\t\t@IStorageService private readonly storageService: IStorageService,\n\t\t@IChatService private readonly chatService: IChatService,\n\t\t@IChatAgentService private readonly chatAgentService: IChatAgentService,\n\t\t@ILogService private readonly logService: ILogService,\n\t\t@ILayoutService private readonly layoutService: ILayoutService,\n\t\t@IChatSessionsService private readonly chatSessionsService: IChatSessionsService,\n\t\t@ITelemetryService private readonly telemetryService: ITelemetryService,\n\t) {\n\t\tsuper(options, keybindingService, contextMenuService, configurationService, contextKeyService, viewDescriptorService, instantiationService, openerService, themeService, hoverService);\n\n\t\t// View state for the ViewPane is currently global per-provider basically, but some other strictly per-model state will require a separate memento.\n\t\tthis.memento = new Memento('interactive-session-view-' + CHAT_PROVIDER_ID, this.storageService);\n\t\tthis.viewState = this.memento.getMemento(StorageScope.WORKSPACE, StorageTarget.MACHINE);\n\n\t\tif (this.chatOptions.location === ChatAgentLocation.Chat && !this.viewState.hasMigratedCurrentSession) {\n\t\t\tconst editsMemento = new Memento<IViewPaneState>('interactive-session-view-' + CHAT_PROVIDER_ID + `-edits`, this.storageService);\n\t\t\tconst lastEditsState = editsMemento.getMemento(StorageScope.WORKSPACE, StorageTarget.MACHINE);\n\t\t\tif (lastEditsState.sessionId) {\n\t\t\t\tthis.logService.trace(`ChatViewPane: last edits session was ${lastEditsState.sessionId}`);\n\t\t\t\tif (!this.chatService.isPersistedSessionEmpty(LocalChatSessionUri.forSession(lastEditsState.sessionId))) {\n\t\t\t\t\tthis.logService.info(`ChatViewPane: migrating ${lastEditsState.sessionId} to unified view`);\n\t\t\t\t\tthis.viewState.sessionId = lastEditsState.sessionId;\n\t\t\t\t\t// Migrate old inputValue to new inputText, and old chatMode to new mode structure\n\t\t\t\t\tif (lastEditsState.inputText) {\n\t\t\t\t\t\tthis.viewState.inputText = lastEditsState.inputText;\n\t\t\t\t\t}\n\t\t\t\t\tif (lastEditsState.mode) {\n\t\t\t\t\t\tthis.viewState.mode = lastEditsState.mode;\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// Default to Edit mode for migrated edits sessions\n\t\t\t\t\t\tthis.viewState.mode = { id: ChatModeKind.Edit, kind: ChatModeKind.Edit };\n\t\t\t\t\t}\n\t\t\t\t\tthis.viewState.hasMigratedCurrentSession = true;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tthis._register(this.chatAgentService.onDidChangeAgents(() => {\n\t\t\tif (this.chatAgentService.getDefaultAgent(this.chatOptions?.location)) {\n\t\t\t\tif (!this._widget?.viewModel && !this._restoringSession) {\n\t\t\t\t\tconst info = this.getTransferredOrPersistedSessionInfo();\n\t\t\t\t\tthis._restoringSession =\n\t\t\t\t\t\t(info.sessionId ? this.chatService.getOrRestoreSession(LocalChatSessionUri.forSession(info.sessionId)) : Promise.resolve(undefined)).then(async model => {\n\t\t\t\t\t\t\tif (!this._widget) {\n\t\t\t\t\t\t\t\t// renderBody has not been called yet\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t// The widget may be hidden at this point, because welcome views were allowed. Use setVisible to\n\t\t\t\t\t\t\t// avoid doing a render while the widget is hidden. This is changing the condition in `shouldShowWelcome`\n\t\t\t\t\t\t\t// so it should fire onDidChangeViewWelcomeState.\n\t\t\t\t\t\t\tconst wasVisible = this._widget.visible;\n\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\tthis._widget.setVisible(false);\n\t\t\t\t\t\t\t\tif (info.inputState && model) {\n\t\t\t\t\t\t\t\t\tmodel.inputModel.setState(info.inputState);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tawait this.updateModel(model);\n\t\t\t\t\t\t\t} finally {\n\t\t\t\t\t\t\t\tthis.widget.setVisible(wasVisible);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\tthis._restoringSession.finally(() => this._restoringSession = undefined);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis._onDidChangeViewWelcomeState.fire();\n\t\t}));\n\n\t\t// Location context key\n\t\tChatContextKeys.panelLocation.bindTo(contextKeyService).set(viewDescriptorService.getViewLocationById(options.id) ?? ViewContainerLocation.AuxiliaryBar);\n\t}\n\n\toverride getActionsContext(): IChatViewTitleActionContext | undefined {\n\t\treturn this.widget?.viewModel ? {\n\t\t\tsessionResource: this.widget.viewModel.sessionResource,\n\t\t\t$mid: MarshalledId.ChatViewContext\n\t\t} : undefined;\n\t}\n\n\tprivate async updateModel(model?: IChatModel | undefined) {\n\t\tthis.modelDisposables.clear();\n\n\t\tmodel = model ?? (this.chatService.transferredSessionData?.sessionId && this.chatService.transferredSessionData?.location === this.chatOptions.location\n\t\t\t? await this.chatService.getOrRestoreSession(LocalChatSessionUri.forSession(this.chatService.transferredSessionData.sessionId))\n\t\t\t: this.chatService.startSession(this.chatOptions.location, CancellationToken.None));\n\t\tif (!model) {\n\t\t\tthrow new Error('Could not start chat session');\n\t\t}\n\n\t\tthis.viewState.sessionId = model.sessionId;\n\t\tthis._widget.setModel(model);\n\n\t\t// Update the toolbar context with new sessionId\n\t\tthis.updateActions();\n\n\t\treturn model;\n\t}\n\n\toverride shouldShowWelcome(): boolean {\n\t\tconst noPersistedSessions = !this.chatService.hasSessions();\n\t\tconst hasCoreAgent = this.chatAgentService.getAgents().some(agent => agent.isCore && agent.locations.includes(this.chatOptions.location));\n\t\tconst hasDefaultAgent = this.chatAgentService.getDefaultAgent(this.chatOptions.location) !== undefined; // only false when Hide AI Features has run and unregistered the setup agents\n\t\tconst shouldShow = !hasCoreAgent && (!hasDefaultAgent || !this._widget?.viewModel && noPersistedSessions);\n\t\tthis.logService.trace(`ChatViewPane#shouldShowWelcome(${this.chatOptions.location}) = ${shouldShow}: hasCoreAgent=${hasCoreAgent} hasDefaultAgent=${hasDefaultAgent} || noViewModel=${!this._widget?.viewModel} && noPersistedSessions=${noPersistedSessions}`);\n\t\treturn !!shouldShow;\n\t}\n\n\tprivate getTransferredOrPersistedSessionInfo(): { sessionId?: string; inputState?: IChatModelInputState; mode?: ChatModeKind } {\n\t\tif (this.chatService.transferredSessionData?.location === this.chatOptions.location) {\n\t\t\tconst sessionId = this.chatService.transferredSessionData.sessionId;\n\t\t\treturn {\n\t\t\t\tsessionId,\n\t\t\t\tinputState: this.chatService.transferredSessionData.inputState,\n\t\t\t};\n\t\t} else {\n\t\t\treturn { sessionId: this.viewState.sessionId };\n\t\t}\n\t}\n\n\tprotected override async renderBody(parent: HTMLElement): Promise<void> {\n\t\tsuper.renderBody(parent);\n\n\n\t\ttype ChatViewPaneOpenedClassification = {\n\t\t\towner: 'sbatten';\n\t\t\tcomment: 'Event fired when the chat view pane is opened';\n\t\t};\n\n\t\tthis.telemetryService.publicLog2<{}, ChatViewPaneOpenedClassification>('chatViewPaneOpened');\n\n\t\tconst welcomeController = this._register(this.instantiationService.createInstance(ChatViewWelcomeController, parent, this, this.chatOptions.location));\n\t\tconst scopedInstantiationService = this._register(this.instantiationService.createChild(new ServiceCollection([IContextKeyService, this.scopedContextKeyService])));\n\t\tconst locationBasedColors = this.getLocationBasedColors();\n\t\tconst editorOverflowNode = this.layoutService.getContainer(getWindow(parent)).appendChild($('.chat-editor-overflow.monaco-editor'));\n\t\tthis._register({ dispose: () => editorOverflowNode.remove() });\n\n\t\tthis._widget = this._register(scopedInstantiationService.createInstance(\n\t\t\tChatWidget,\n\t\t\tthis.chatOptions.location,\n\t\t\t{ viewId: this.id },\n\t\t\t{\n\t\t\t\tautoScroll: mode => mode !== ChatModeKind.Ask,\n\t\t\t\trenderFollowups: this.chatOptions.location === ChatAgentLocation.Chat,\n\t\t\t\tsupportsFileReferences: true,\n\t\t\t\tclear: () => this.clear(),\n\t\t\t\trendererOptions: {\n\t\t\t\t\trenderTextEditsAsSummary: (uri) => {\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t},\n\t\t\t\t\treferencesExpandedWhenEmptyResponse: false,\n\t\t\t\t\tprogressMessageAtBottomOfResponse: mode => mode !== ChatModeKind.Ask,\n\t\t\t\t},\n\t\t\t\teditorOverflowWidgetsDomNode: editorOverflowNode,\n\t\t\t\tenableImplicitContext: this.chatOptions.location === ChatAgentLocation.Chat,\n\t\t\t\tenableWorkingSet: 'explicit',\n\t\t\t\tsupportsChangingModes: true,\n\t\t\t},\n\t\t\t{\n\t\t\t\tlistForeground: SIDE_BAR_FOREGROUND,\n\t\t\t\tlistBackground: locationBasedColors.background,\n\t\t\t\toverlayBackground: locationBasedColors.overlayBackground,\n\t\t\t\tinputEditorBackground: locationBasedColors.background,\n\t\t\t\tresultEditorBackground: editorBackground,\n\t\t\t}));\n\t\tthis._widget.render(parent);\n\n\t\tconst updateWidgetVisibility = (r?: IReader) => {\n\t\t\tthis._widget.setVisible(this.isBodyVisible() && !welcomeController.isShowingWelcome.read(r));\n\t\t};\n\t\tthis._register(this.onDidChangeBodyVisibility(() => {\n\t\t\tupdateWidgetVisibility();\n\t\t}));\n\t\tthis._register(autorun(r => {\n\t\t\tupdateWidgetVisibility(r);\n\t\t}));\n\n\t\tconst info = this.getTransferredOrPersistedSessionInfo();\n\t\tconst model = info.sessionId ? await this.chatService.getOrRestoreSession(LocalChatSessionUri.forSession(info.sessionId)) : undefined;\n\n\t\tif (model && info.inputState) {\n\t\t\tmodel.inputModel.setState(info.inputState);\n\t\t}\n\t\tawait this.updateModel(model);\n\t}\n\n\tacceptInput(query?: string): void {\n\t\tthis._widget.acceptInput(query);\n\t}\n\n\tprivate async clear(): Promise<void> {\n\t\tif (this.widget.viewModel) {\n\t\t\tawait this.chatService.clearSession(this.widget.viewModel.sessionResource);\n\t\t}\n\n\t\t// Grab the widget's latest view state because it will be loaded back into the widget\n\t\tthis.updateViewState();\n\t\tawait this.updateModel(undefined);\n\n\t\t// Update the toolbar context with new sessionId\n\t\tthis.updateActions();\n\t}\n\n\tasync loadSession(sessionId: URI): Promise<IChatModel | undefined> {\n\t\tif (this.widget.viewModel) {\n\t\t\tawait this.chatService.clearSession(this.widget.viewModel.sessionResource);\n\t\t}\n\n\t\t// Handle locking for contributed chat sessions\n\t\t// TODO: Is this logic still correct with sessions from different schemes?\n\t\tconst local = LocalChatSessionUri.parseLocalSessionId(sessionId);\n\t\tif (local) {\n\t\t\tawait this.chatSessionsService.canResolveChatSession(sessionId);\n\t\t\tconst contributions = this.chatSessionsService.getAllChatSessionContributions();\n\t\t\tconst contribution = contributions.find((c: IChatSessionsExtensionPoint) => c.type === localChatSessionType);\n\t\t\tif (contribution) {\n\t\t\t\tthis.widget.lockToCodingAgent(contribution.name, contribution.displayName, contribution.type);\n\t\t\t}\n\t\t}\n\n\t\tconst newModel = await this.chatService.loadSessionForResource(sessionId, ChatAgentLocation.Chat, CancellationToken.None);\n\t\treturn this.updateModel(newModel);\n\t}\n\n\tfocusInput(): void {\n\t\tthis._widget.focusInput();\n\t}\n\n\toverride focus(): void {\n\t\tsuper.focus();\n\t\tthis._widget.focusInput();\n\t}\n\n\tprotected override layoutBody(height: number, width: number): void {\n\t\tsuper.layoutBody(height, width);\n\t\tthis._widget.layout(height, width);\n\t}\n\n\toverride saveState(): void {\n\t\t// Don't do saveState when no widget, or no viewModel in which case the state has not yet been restored -\n\t\t// in that case the default state would overwrite the real state\n\t\tif (this._widget?.viewModel) {\n\t\t\tthis._widget.saveState();\n\n\t\t\tthis.updateViewState();\n\t\t\tthis.memento.saveMemento();\n\t\t}\n\n\t\tsuper.saveState();\n\t}\n\n\tprivate updateViewState(viewState?: IChatModelInputState): void {\n\t\tconst newViewState = viewState ?? this._widget.getViewState();\n\t\tif (newViewState) {\n\t\t\tfor (const [key, value] of Object.entries(newViewState)) {\n\t\t\t\t// Assign all props to the memento so they get saved\n\t\t\t\t(this.viewState as Record<string, unknown>)[key] = value;\n\t\t\t}\n\t\t}\n\t}\n}\n"]}