{"version":3,"sources":["vs/workbench/contrib/chat/browser/chatEditing/chatEditingServiceImpl.ts"],"names":[],"mappings":"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","file":"chatEditingServiceImpl.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { coalesce, compareBy, delta } from '../../../../../base/common/arrays.js';\nimport { CancellationToken } from '../../../../../base/common/cancellation.js';\nimport { Codicon } from '../../../../../base/common/codicons.js';\nimport { groupBy } from '../../../../../base/common/collections.js';\nimport { ErrorNoTelemetry } from '../../../../../base/common/errors.js';\nimport { Emitter, Event } from '../../../../../base/common/event.js';\nimport { Iterable } from '../../../../../base/common/iterator.js';\nimport { Disposable, DisposableStore, dispose, IDisposable, toDisposable } from '../../../../../base/common/lifecycle.js';\nimport { LinkedList } from '../../../../../base/common/linkedList.js';\nimport { ResourceMap } from '../../../../../base/common/map.js';\nimport { Schemas } from '../../../../../base/common/network.js';\nimport { derived, IObservable, observableValueOpts, runOnChange, ValueWithChangeEventFromObservable } from '../../../../../base/common/observable.js';\nimport { isEqual } from '../../../../../base/common/resources.js';\nimport { compare } from '../../../../../base/common/strings.js';\nimport { ThemeIcon } from '../../../../../base/common/themables.js';\nimport { assertType } from '../../../../../base/common/types.js';\nimport { URI } from '../../../../../base/common/uri.js';\nimport { TextEdit } from '../../../../../editor/common/languages.js';\nimport { ITextModelService } from '../../../../../editor/common/services/resolverService.js';\nimport { localize } from '../../../../../nls.js';\nimport { IConfigurationService } from '../../../../../platform/configuration/common/configuration.js';\nimport { IContextKeyService } from '../../../../../platform/contextkey/common/contextkey.js';\nimport { IFileService } from '../../../../../platform/files/common/files.js';\nimport { IInstantiationService } from '../../../../../platform/instantiation/common/instantiation.js';\nimport { ILogService } from '../../../../../platform/log/common/log.js';\nimport { IProductService } from '../../../../../platform/product/common/productService.js';\nimport { IStorageService } from '../../../../../platform/storage/common/storage.js';\nimport { IDecorationData, IDecorationsProvider, IDecorationsService } from '../../../../services/decorations/common/decorations.js';\nimport { IEditorService } from '../../../../services/editor/common/editorService.js';\nimport { IExtensionService } from '../../../../services/extensions/common/extensions.js';\nimport { ILifecycleService } from '../../../../services/lifecycle/common/lifecycle.js';\nimport { IMultiDiffSourceResolver, IMultiDiffSourceResolverService, IResolvedMultiDiffSource, MultiDiffEditorItem } from '../../../multiDiffEditor/browser/multiDiffSourceResolverService.js';\nimport { CellUri, ICellEditOperation } from '../../../notebook/common/notebookCommon.js';\nimport { INotebookService } from '../../../notebook/common/notebookService.js';\nimport { CHAT_EDITING_MULTI_DIFF_SOURCE_RESOLVER_SCHEME, chatEditingAgentSupportsReadonlyReferencesContextKey, chatEditingResourceContextKey, ChatEditingSessionState, IChatEditingService, IChatEditingSession, IChatRelatedFile, IChatRelatedFilesProvider, IModifiedFileEntry, inChatEditingSessionContextKey, IStreamingEdits, ModifiedFileEntryState, parseChatMultiDiffUri } from '../../common/chatEditingService.js';\nimport { ChatModel, ICellTextEditOperation, IChatResponseModel, isCellTextEditOperationArray } from '../../common/chatModel.js';\nimport { IChatService } from '../../common/chatService.js';\nimport { ChatEditorInput } from '../chatEditorInput.js';\nimport { AbstractChatEditingModifiedFileEntry } from './chatEditingModifiedFileEntry.js';\nimport { ChatEditingSession } from './chatEditingSession.js';\nimport { ChatEditingSnapshotTextModelContentProvider, ChatEditingTextModelContentProvider } from './chatEditingTextModelContentProviders.js';\n\nexport class ChatEditingService extends Disposable implements IChatEditingService {\n\n\t_serviceBrand: undefined;\n\n\n\tprivate readonly _sessionsObs = observableValueOpts<LinkedList<ChatEditingSession>>({ equalsFn: (a, b) => false }, new LinkedList());\n\n\treadonly editingSessionsObs: IObservable<readonly IChatEditingSession[]> = derived(r => {\n\t\tconst result = Array.from(this._sessionsObs.read(r));\n\t\treturn result;\n\t});\n\n\tprivate _chatRelatedFilesProviders = new Map<number, IChatRelatedFilesProvider>();\n\n\tconstructor(\n\t\t@IInstantiationService private readonly _instantiationService: IInstantiationService,\n\t\t@IMultiDiffSourceResolverService multiDiffSourceResolverService: IMultiDiffSourceResolverService,\n\t\t@ITextModelService textModelService: ITextModelService,\n\t\t@IContextKeyService contextKeyService: IContextKeyService,\n\t\t@IChatService private readonly _chatService: IChatService,\n\t\t@IEditorService private readonly _editorService: IEditorService,\n\t\t@IDecorationsService decorationsService: IDecorationsService,\n\t\t@IFileService private readonly _fileService: IFileService,\n\t\t@ILifecycleService private readonly lifecycleService: ILifecycleService,\n\t\t@IStorageService storageService: IStorageService,\n\t\t@ILogService logService: ILogService,\n\t\t@IExtensionService extensionService: IExtensionService,\n\t\t@IProductService productService: IProductService,\n\t\t@INotebookService private readonly notebookService: INotebookService,\n\t\t@IConfigurationService private readonly _configurationService: IConfigurationService,\n\t) {\n\t\tsuper();\n\t\tthis._register(decorationsService.registerDecorationsProvider(_instantiationService.createInstance(ChatDecorationsProvider, this.editingSessionsObs)));\n\t\tthis._register(multiDiffSourceResolverService.registerResolver(_instantiationService.createInstance(ChatEditingMultiDiffSourceResolver, this.editingSessionsObs)));\n\n\t\t// TODO@jrieken\n\t\t// some ugly casting so that this service can pass itself as argument instad as service dependeny\n\t\t// eslint-disable-next-line local/code-no-any-casts\n\t\tthis._register(textModelService.registerTextModelContentProvider(ChatEditingTextModelContentProvider.scheme, _instantiationService.createInstance(ChatEditingTextModelContentProvider as any, this)));\n\t\t// eslint-disable-next-line local/code-no-any-casts\n\t\tthis._register(textModelService.registerTextModelContentProvider(Schemas.chatEditingSnapshotScheme, _instantiationService.createInstance(ChatEditingSnapshotTextModelContentProvider as any, this)));\n\n\t\tthis._register(this._chatService.onDidDisposeSession((e) => {\n\t\t\tif (e.reason === 'cleared') {\n\t\t\t\tthis.getEditingSession(e.sessionResource)?.stop();\n\t\t\t}\n\t\t}));\n\n\t\t// todo@connor4312: temporary until chatReadonlyPromptReference proposal is finalized\n\t\tconst readonlyEnabledContextKey = chatEditingAgentSupportsReadonlyReferencesContextKey.bindTo(contextKeyService);\n\t\tconst setReadonlyFilesEnabled = () => {\n\t\t\tconst enabled = productService.quality !== 'stable' && extensionService.extensions.some(e => e.enabledApiProposals?.includes('chatReadonlyPromptReference'));\n\t\t\treadonlyEnabledContextKey.set(enabled);\n\t\t};\n\t\tsetReadonlyFilesEnabled();\n\t\tthis._register(extensionService.onDidRegisterExtensions(setReadonlyFilesEnabled));\n\t\tthis._register(extensionService.onDidChangeExtensions(setReadonlyFilesEnabled));\n\n\n\t\tlet storageTask: Promise<any> | undefined;\n\n\t\tthis._register(storageService.onWillSaveState(() => {\n\t\t\tconst tasks: Promise<any>[] = [];\n\n\t\t\tfor (const session of this.editingSessionsObs.get()) {\n\t\t\t\tif (!session.isGlobalEditingSession) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\ttasks.push((session as ChatEditingSession).storeState());\n\t\t\t}\n\n\t\t\tstorageTask = Promise.resolve(storageTask)\n\t\t\t\t.then(() => Promise.all(tasks))\n\t\t\t\t.finally(() => storageTask = undefined);\n\t\t}));\n\n\t\tthis._register(this.lifecycleService.onWillShutdown(e => {\n\t\t\tif (!storageTask) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\te.join(storageTask, {\n\t\t\t\tid: 'join.chatEditingSession',\n\t\t\t\tlabel: localize('join.chatEditingSession', \"Saving chat edits history\")\n\t\t\t});\n\t\t}));\n\t}\n\n\toverride dispose(): void {\n\t\tdispose(this._sessionsObs.get());\n\t\tsuper.dispose();\n\t}\n\n\tstartOrContinueGlobalEditingSession(chatModel: ChatModel): IChatEditingSession {\n\t\treturn this.getEditingSession(chatModel.sessionResource) || this.createEditingSession(chatModel, true);\n\t}\n\n\tprivate _lookupEntry(uri: URI): AbstractChatEditingModifiedFileEntry | undefined {\n\n\t\tfor (const item of Iterable.concat(this.editingSessionsObs.get())) {\n\t\t\tconst candidate = item.getEntry(uri);\n\t\t\tif (candidate instanceof AbstractChatEditingModifiedFileEntry) {\n\t\t\t\t// make sure to ref-count this object\n\t\t\t\treturn candidate.acquire();\n\t\t\t}\n\t\t}\n\t\treturn undefined;\n\t}\n\n\tgetEditingSession(chatSessionResource: URI): IChatEditingSession | undefined {\n\t\treturn this.editingSessionsObs.get()\n\t\t\t.find(candidate => isEqual(candidate.chatSessionResource, chatSessionResource));\n\t}\n\n\tcreateEditingSession(chatModel: ChatModel, global: boolean = false): IChatEditingSession {\n\t\treturn this._createEditingSession(chatModel, global, undefined);\n\t}\n\n\ttransferEditingSession(chatModel: ChatModel, session: IChatEditingSession): IChatEditingSession {\n\t\treturn this._createEditingSession(chatModel, session.isGlobalEditingSession, session);\n\t}\n\n\tprivate _createEditingSession(chatModel: ChatModel, global: boolean, initFrom: IChatEditingSession | undefined): IChatEditingSession {\n\n\t\tassertType(this.getEditingSession(chatModel.sessionResource) === undefined, 'CANNOT have more than one editing session per chat session');\n\n\t\tconst session = this._instantiationService.createInstance(ChatEditingSession, chatModel.sessionResource, global, this._lookupEntry.bind(this), initFrom);\n\n\t\tconst list = this._sessionsObs.get();\n\t\tconst removeSession = list.unshift(session);\n\n\t\tconst store = new DisposableStore();\n\t\tthis._store.add(store);\n\n\t\tstore.add(this.installAutoApplyObserver(session, chatModel));\n\n\t\tstore.add(session.onDidDispose(e => {\n\t\t\tremoveSession();\n\t\t\tthis._sessionsObs.set(list, undefined);\n\t\t\tthis._store.delete(store);\n\t\t}));\n\n\t\tthis._sessionsObs.set(list, undefined);\n\n\t\treturn session;\n\t}\n\n\tprivate installAutoApplyObserver(session: ChatEditingSession, chatModel: ChatModel): IDisposable {\n\t\tif (!chatModel) {\n\t\t\tthrow new ErrorNoTelemetry(`Edit session was created for a non-existing chat session: ${session.chatSessionResource}`);\n\t\t}\n\n\t\tconst observerDisposables = new DisposableStore();\n\n\t\tobserverDisposables.add(chatModel.onDidChange(async e => {\n\t\t\tif (e.kind !== 'addRequest') {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tsession.createSnapshot(e.request.id, undefined);\n\t\t\tconst responseModel = e.request.response;\n\t\t\tif (responseModel) {\n\t\t\t\tthis.observerEditsInResponse(e.request.id, responseModel, session, observerDisposables);\n\t\t\t}\n\t\t}));\n\t\tobserverDisposables.add(chatModel.onDidDispose(() => observerDisposables.dispose()));\n\t\treturn observerDisposables;\n\t}\n\n\tprivate observerEditsInResponse(requestId: string, responseModel: IChatResponseModel, session: ChatEditingSession, observerDisposables: DisposableStore) {\n\t\t// Sparse array: the indicies are indexes of `responseModel.response.value`\n\t\t// that are edit groups, and then this tracks the edit application for\n\t\t// each of them. Note that text edit groups can be updated\n\t\t// multiple times during the process of response streaming.\n\t\tconst editsSeen: ({ seen: number; streaming: IStreamingEdits } | undefined)[] = [];\n\n\t\tlet editorDidChange = false;\n\t\tconst editorListener = Event.once(this._editorService.onDidActiveEditorChange)(() => {\n\t\t\teditorDidChange = true;\n\t\t});\n\t\tconst editorOpenPromises = new ResourceMap<Promise<void>>();\n\t\tconst openChatEditedFiles = this._configurationService.getValue('accessibility.openChatEditedFiles');\n\n\t\tconst ensureEditorOpen = (partUri: URI) => {\n\t\t\tconst uri = CellUri.parse(partUri)?.notebook ?? partUri;\n\t\t\tif (editorOpenPromises.has(uri)) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\teditorOpenPromises.set(uri, (async () => {\n\t\t\t\tif (this.notebookService.getNotebookTextModel(uri) || uri.scheme === Schemas.untitled || await this._fileService.exists(uri).catch(() => false)) {\n\t\t\t\t\tconst activeUri = this._editorService.activeEditorPane?.input.resource;\n\t\t\t\t\tconst inactive = editorDidChange\n\t\t\t\t\t\t|| this._editorService.activeEditorPane?.input instanceof ChatEditorInput && isEqual(this._editorService.activeEditorPane.input.sessionResource, session.chatSessionResource)\n\t\t\t\t\t\t|| Boolean(activeUri && session.entries.get().find(entry => isEqual(activeUri, entry.modifiedURI)));\n\n\t\t\t\t\tthis._editorService.openEditor({ resource: uri, options: { inactive, preserveFocus: true, pinned: true } });\n\t\t\t\t}\n\t\t\t})());\n\t\t};\n\n\t\tconst onResponseComplete = () => {\n\t\t\tfor (const remaining of editsSeen) {\n\t\t\t\tremaining?.streaming.complete();\n\t\t\t}\n\n\t\t\teditsSeen.length = 0;\n\t\t\teditorOpenPromises.clear();\n\t\t\teditorListener.dispose();\n\t\t};\n\n\t\tconst handleResponseParts = async () => {\n\t\t\tif (responseModel.isCanceled) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tlet undoStop: undefined | string;\n\t\t\tfor (let i = 0; i < responseModel.response.value.length; i++) {\n\t\t\t\tconst part = responseModel.response.value[i];\n\n\t\t\t\tif (part.kind === 'undoStop') {\n\t\t\t\t\tundoStop = part.id;\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tif (part.kind !== 'textEditGroup' && part.kind !== 'notebookEditGroup') {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\t// Skip external edits - they're already applied on disk\n\t\t\t\tif (part.isExternalEdit) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tif (openChatEditedFiles) {\n\t\t\t\t\tensureEditorOpen(part.uri);\n\t\t\t\t}\n\n\t\t\t\t// get new edits and start editing session\n\t\t\t\tlet entry = editsSeen[i];\n\t\t\t\tif (!entry) {\n\t\t\t\t\tentry = { seen: 0, streaming: session.startStreamingEdits(CellUri.parse(part.uri)?.notebook ?? part.uri, responseModel, undoStop) };\n\t\t\t\t\teditsSeen[i] = entry;\n\t\t\t\t}\n\n\t\t\t\tconst isFirst = entry.seen === 0;\n\t\t\t\tconst newEdits = part.edits.slice(entry.seen);\n\t\t\t\tentry.seen = part.edits.length;\n\n\t\t\t\tif (newEdits.length > 0 || isFirst) {\n\t\t\t\t\tfor (let i = 0; i < newEdits.length; i++) {\n\t\t\t\t\t\tconst edit = newEdits[i];\n\t\t\t\t\t\tconst done = part.done ? i === newEdits.length - 1 : false;\n\n\t\t\t\t\t\tif (isTextEditOperationArray(edit)) {\n\t\t\t\t\t\t\tentry.streaming.pushText(edit, done);\n\t\t\t\t\t\t} else if (isCellTextEditOperationArray(edit)) {\n\t\t\t\t\t\t\tfor (const edits of Object.values(groupBy(edit, e => e.uri.toString()))) {\n\t\t\t\t\t\t\t\tif (edits) {\n\t\t\t\t\t\t\t\t\tentry.streaming.pushNotebookCellText(edits[0].uri, edits.map(e => e.edit), done);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tentry.streaming.pushNotebook(edit, done);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (part.done) {\n\t\t\t\t\tentry.streaming.complete();\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\tif (responseModel.isComplete) {\n\t\t\thandleResponseParts().then(() => {\n\t\t\t\tonResponseComplete();\n\t\t\t});\n\t\t} else {\n\t\t\tconst disposable = observerDisposables.add(responseModel.onDidChange(e2 => {\n\t\t\t\tif (e2.reason === 'undoStop') {\n\t\t\t\t\tsession.createSnapshot(requestId, e2.id);\n\t\t\t\t} else {\n\t\t\t\t\thandleResponseParts().then(() => {\n\t\t\t\t\t\tif (responseModel.isComplete) {\n\t\t\t\t\t\t\tonResponseComplete();\n\t\t\t\t\t\t\tobserverDisposables.delete(disposable);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}));\n\t\t}\n\t}\n\n\thasRelatedFilesProviders(): boolean {\n\t\treturn this._chatRelatedFilesProviders.size > 0;\n\t}\n\n\tregisterRelatedFilesProvider(handle: number, provider: IChatRelatedFilesProvider): IDisposable {\n\t\tthis._chatRelatedFilesProviders.set(handle, provider);\n\t\treturn toDisposable(() => {\n\t\t\tthis._chatRelatedFilesProviders.delete(handle);\n\t\t});\n\t}\n\n\tasync getRelatedFiles(chatSessionResource: URI, prompt: string, files: URI[], token: CancellationToken): Promise<{ group: string; files: IChatRelatedFile[] }[] | undefined> {\n\t\tconst providers = Array.from(this._chatRelatedFilesProviders.values());\n\t\tconst result = await Promise.all(providers.map(async provider => {\n\t\t\ttry {\n\t\t\t\tconst relatedFiles = await provider.provideRelatedFiles({ prompt, files }, token);\n\t\t\t\tif (relatedFiles?.length) {\n\t\t\t\t\treturn { group: provider.description, files: relatedFiles };\n\t\t\t\t}\n\t\t\t\treturn undefined;\n\t\t\t} catch (e) {\n\t\t\t\treturn undefined;\n\t\t\t}\n\t\t}));\n\n\t\treturn coalesce(result);\n\t}\n}\n\n/**\n * Emits an event containing the added or removed elements of the observable.\n */\nfunction observeArrayChanges<T>(obs: IObservable<T[]>, compare: (a: T, b: T) => number, store: DisposableStore): Event<T[]> {\n\tconst emitter = store.add(new Emitter<T[]>());\n\tstore.add(runOnChange(obs, (newArr, oldArr) => {\n\t\tconst change = delta(oldArr || [], newArr, compare);\n\t\tconst changedElements = ([] as T[]).concat(change.added).concat(change.removed);\n\t\temitter.fire(changedElements);\n\t}));\n\treturn emitter.event;\n}\n\nclass ChatDecorationsProvider extends Disposable implements IDecorationsProvider {\n\n\treadonly label: string = localize('chat', \"Chat Editing\");\n\n\tprivate readonly _currentEntries = derived<readonly IModifiedFileEntry[]>(this, (r) => {\n\t\tconst sessions = this._sessions.read(r);\n\t\tif (!sessions) {\n\t\t\treturn [];\n\t\t}\n\t\tconst result: IModifiedFileEntry[] = [];\n\t\tfor (const session of sessions) {\n\t\t\tif (session.state.read(r) !== ChatEditingSessionState.Disposed) {\n\t\t\t\tconst entries = session.entries.read(r);\n\t\t\t\tresult.push(...entries);\n\t\t\t}\n\t\t}\n\t\treturn result;\n\t});\n\n\tprivate readonly _currentlyEditingUris = derived<URI[]>(this, (r) => {\n\t\tconst uri = this._currentEntries.read(r);\n\t\treturn uri.filter(entry => entry.isCurrentlyBeingModifiedBy.read(r)).map(entry => entry.modifiedURI);\n\t});\n\n\tprivate readonly _modifiedUris = derived<URI[]>(this, (r) => {\n\t\tconst uri = this._currentEntries.read(r);\n\t\treturn uri.filter(entry => !entry.isCurrentlyBeingModifiedBy.read(r) && entry.state.read(r) === ModifiedFileEntryState.Modified).map(entry => entry.modifiedURI);\n\t});\n\n\treadonly onDidChange: Event<URI[]>;\n\n\tconstructor(\n\t\tprivate readonly _sessions: IObservable<readonly IChatEditingSession[]>\n\t) {\n\t\tsuper();\n\t\tthis.onDidChange = Event.any(\n\t\t\tobserveArrayChanges(this._currentlyEditingUris, compareBy(uri => uri.toString(), compare), this._store),\n\t\t\tobserveArrayChanges(this._modifiedUris, compareBy(uri => uri.toString(), compare), this._store),\n\t\t);\n\t}\n\n\tprovideDecorations(uri: URI, _token: CancellationToken): IDecorationData | undefined {\n\t\tconst isCurrentlyBeingModified = this._currentlyEditingUris.get().some(e => e.toString() === uri.toString());\n\t\tif (isCurrentlyBeingModified) {\n\t\t\treturn {\n\t\t\t\tweight: 1000,\n\t\t\t\tletter: ThemeIcon.modify(Codicon.loading, 'spin'),\n\t\t\t\tbubble: false\n\t\t\t};\n\t\t}\n\t\tconst isModified = this._modifiedUris.get().some(e => e.toString() === uri.toString());\n\t\tif (isModified) {\n\t\t\treturn {\n\t\t\t\tweight: 1000,\n\t\t\t\tletter: Codicon.diffModified,\n\t\t\t\ttooltip: localize('chatEditing.modified2', \"Pending changes from chat\"),\n\t\t\t\tbubble: true\n\t\t\t};\n\t\t}\n\t\treturn undefined;\n\t}\n}\n\nexport class ChatEditingMultiDiffSourceResolver implements IMultiDiffSourceResolver {\n\n\tconstructor(\n\t\tprivate readonly _editingSessionsObs: IObservable<readonly IChatEditingSession[]>,\n\t\t@IInstantiationService private readonly _instantiationService: IInstantiationService,\n\t) { }\n\n\tcanHandleUri(uri: URI): boolean {\n\t\treturn uri.scheme === CHAT_EDITING_MULTI_DIFF_SOURCE_RESOLVER_SCHEME;\n\t}\n\n\tasync resolveDiffSource(uri: URI): Promise<IResolvedMultiDiffSource> {\n\n\t\tconst parsed = parseChatMultiDiffUri(uri);\n\t\tconst thisSession = derived(this, r => {\n\t\t\treturn this._editingSessionsObs.read(r).find(candidate => isEqual(candidate.chatSessionResource, parsed.chatSessionResource));\n\t\t});\n\n\t\treturn this._instantiationService.createInstance(ChatEditingMultiDiffSource, thisSession, parsed.showPreviousChanges);\n\t}\n}\n\nclass ChatEditingMultiDiffSource implements IResolvedMultiDiffSource {\n\tprivate readonly _resources = derived<readonly MultiDiffEditorItem[]>(this, (reader) => {\n\t\tconst currentSession = this._currentSession.read(reader);\n\t\tif (!currentSession) {\n\t\t\treturn [];\n\t\t}\n\t\tconst entries = currentSession.entries.read(reader);\n\t\treturn entries.map((entry) => {\n\t\t\tif (this._showPreviousChanges) {\n\t\t\t\tconst entryDiffObs = currentSession.getEntryDiffBetweenStops(entry.modifiedURI, undefined, undefined);\n\t\t\t\tconst entryDiff = entryDiffObs?.read(reader);\n\t\t\t\tif (entryDiff) {\n\t\t\t\t\treturn new MultiDiffEditorItem(\n\t\t\t\t\t\tentryDiff.originalURI,\n\t\t\t\t\t\tentryDiff.modifiedURI,\n\t\t\t\t\t\tundefined,\n\t\t\t\t\t\tundefined,\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t[chatEditingResourceContextKey.key]: entry.entryId,\n\t\t\t\t\t\t},\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn new MultiDiffEditorItem(\n\t\t\t\tentry.originalURI,\n\t\t\t\tentry.modifiedURI,\n\t\t\t\tundefined,\n\t\t\t\tundefined,\n\t\t\t\t{\n\t\t\t\t\t[chatEditingResourceContextKey.key]: entry.entryId,\n\t\t\t\t\t// [inChatEditingSessionContextKey.key]: true\n\t\t\t\t},\n\t\t\t);\n\t\t});\n\t});\n\treadonly resources = new ValueWithChangeEventFromObservable(this._resources);\n\n\treadonly contextKeys = {\n\t\t[inChatEditingSessionContextKey.key]: true\n\t};\n\n\tconstructor(\n\t\tprivate readonly _currentSession: IObservable<IChatEditingSession | undefined>,\n\t\tprivate readonly _showPreviousChanges: boolean\n\t) { }\n}\n\nfunction isTextEditOperationArray(value: TextEdit[] | ICellTextEditOperation[] | ICellEditOperation[]): value is TextEdit[] {\n\treturn value.some(e => TextEdit.isTextEdit(e));\n}\n"]}