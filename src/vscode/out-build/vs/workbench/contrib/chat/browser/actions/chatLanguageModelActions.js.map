{"version":3,"sources":["vs/workbench/contrib/chat/browser/actions/chatLanguageModelActions.ts"],"names":[],"mappings":"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","file":"chatLanguageModelActions.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Action2, MenuId, registerAction2 } from '../../../../../platform/actions/common/actions.js';\nimport { ServicesAccessor } from '../../../../../platform/instantiation/common/instantiation.js';\nimport { IQuickInputService, IQuickPickItem, QuickPickInput } from '../../../../../platform/quickinput/common/quickInput.js';\nimport { ILanguageModelsService } from '../../common/languageModels.js';\nimport { IAuthenticationAccessService } from '../../../../services/authentication/browser/authenticationAccessService.js';\nimport { localize, localize2 } from '../../../../../nls.js';\nimport { AllowedExtension, INTERNAL_AUTH_PROVIDER_PREFIX } from '../../../../services/authentication/common/authentication.js';\nimport { IDialogService } from '../../../../../platform/dialogs/common/dialogs.js';\nimport { CHAT_CATEGORY } from './chatActions.js';\nimport { IExtensionService } from '../../../../services/extensions/common/extensions.js';\nimport { IExtensionsWorkbenchService } from '../../../extensions/common/extensions.js';\nimport { IProductService } from '../../../../../platform/product/common/productService.js';\nimport { Codicon } from '../../../../../base/common/codicons.js';\nimport { ThemeIcon } from '../../../../../base/common/themables.js';\nimport { ChatContextKeys } from '../../common/chatContextKeys.js';\nimport { ManageModelsAction } from './manageModelsActions.js';\n\nclass ManageLanguageModelAuthenticationAction extends Action2 {\n\tstatic readonly ID = 'workbench.action.chat.manageLanguageModelAuthentication';\n\n\tconstructor() {\n\t\tsuper({\n\t\t\tid: ManageLanguageModelAuthenticationAction.ID,\n\t\t\ttitle: localize2('manageLanguageModelAuthentication', 'Manage Language Model Access...'),\n\t\t\tcategory: CHAT_CATEGORY,\n\t\t\tprecondition: ChatContextKeys.enabled,\n\t\t\tmenu: [{\n\t\t\t\tid: MenuId.AccountsContext,\n\t\t\t\torder: 100,\n\t\t\t}],\n\t\t\tf1: true\n\t\t});\n\t}\n\n\tasync run(accessor: ServicesAccessor): Promise<void> {\n\t\tconst quickInputService = accessor.get(IQuickInputService);\n\t\tconst languageModelsService = accessor.get(ILanguageModelsService);\n\t\tconst authenticationAccessService = accessor.get(IAuthenticationAccessService);\n\t\tconst dialogService = accessor.get(IDialogService);\n\t\tconst extensionService = accessor.get(IExtensionService);\n\t\tconst extensionsWorkbenchService = accessor.get(IExtensionsWorkbenchService);\n\t\tconst productService = accessor.get(IProductService);\n\n\t\t// Get all registered language models\n\t\tconst modelIds = languageModelsService.getLanguageModelIds();\n\n\t\t// Group models by owning extension and collect all allowed extensions\n\t\tconst extensionAuth = new Map<string, AllowedExtension[]>();\n\n\t\tconst ownerToAccountLabel = new Map<string, string>();\n\t\tfor (const modelId of modelIds) {\n\t\t\tconst model = languageModelsService.lookupLanguageModel(modelId);\n\t\t\tif (!model?.auth) {\n\t\t\t\tcontinue; // Skip if model is not found\n\t\t\t}\n\t\t\tconst ownerId = model.extension.value;\n\t\t\tif (extensionAuth.has(ownerId)) {\n\t\t\t\t// If the owner already exists, just continue\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t// Get allowed extensions for this model's auth provider\n\t\t\ttry {\n\t\t\t\t// Use providerLabel as the providerId and accountLabel (or default)\n\t\t\t\tconst providerId = INTERNAL_AUTH_PROVIDER_PREFIX + ownerId;\n\t\t\t\tconst accountLabel = model.auth.accountLabel || 'Language Models';\n\t\t\t\townerToAccountLabel.set(ownerId, accountLabel);\n\t\t\t\tconst allowedExtensions = authenticationAccessService.readAllowedExtensions(\n\t\t\t\t\tproviderId,\n\t\t\t\t\taccountLabel\n\t\t\t\t).filter(ext => !ext.trusted); // Filter out trusted extensions because those should not be modified\n\n\t\t\t\tif (productService.trustedExtensionAuthAccess && !Array.isArray(productService.trustedExtensionAuthAccess)) {\n\t\t\t\t\tconst trustedExtensions = productService.trustedExtensionAuthAccess[providerId];\n\t\t\t\t\t// If the provider is trusted, add all trusted extensions to the allowed list\n\t\t\t\t\tfor (const ext of trustedExtensions) {\n\t\t\t\t\t\tconst index = allowedExtensions.findIndex(a => a.id === ext);\n\t\t\t\t\t\tif (index !== -1) {\n\t\t\t\t\t\t\tallowedExtensions.splice(index, 1);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tconst extension = await extensionService.getExtension(ext);\n\t\t\t\t\t\tif (!extension) {\n\t\t\t\t\t\t\tcontinue; // Skip if the extension is not found\n\t\t\t\t\t\t}\n\t\t\t\t\t\tallowedExtensions.push({\n\t\t\t\t\t\t\tid: ext,\n\t\t\t\t\t\t\tname: extension.displayName || extension.name,\n\t\t\t\t\t\t\tallowed: true, // Assume trusted extensions are allowed by default\n\t\t\t\t\t\t\ttrusted: true // Mark as trusted\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Only grab extensions that are gettable from the extension service\n\t\t\t\tconst filteredExtensions = new Array<AllowedExtension>();\n\t\t\t\tfor (const ext of allowedExtensions) {\n\t\t\t\t\tif (await extensionService.getExtension(ext.id)) {\n\t\t\t\t\t\tfilteredExtensions.push(ext);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\textensionAuth.set(ownerId, filteredExtensions);\n\t\t\t\t// Add all allowed extensions to the set for this owner\n\t\t\t} catch (error) {\n\t\t\t\t// Handle error by ensuring the owner is in the map\n\t\t\t\tif (!extensionAuth.has(ownerId)) {\n\t\t\t\t\textensionAuth.set(ownerId, []);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (extensionAuth.size === 0) {\n\t\t\tdialogService.prompt({\n\t\t\t\ttype: 'info',\n\t\t\t\tmessage: localize('noLanguageModels', 'No language models requiring authentication found.'),\n\t\t\t\tdetail: localize('noLanguageModelsDetail', 'There are currently no language models that require authentication.')\n\t\t\t});\n\t\t\treturn;\n\t\t}\n\n\t\tconst items: QuickPickInput<IQuickPickItem & { extension?: AllowedExtension; ownerId?: string }>[] = [];\n\t\t// Create QuickPick items grouped by owner extension\n\t\tfor (const [ownerId, allowedExtensions] of extensionAuth) {\n\t\t\tconst extension = await extensionService.getExtension(ownerId);\n\t\t\tif (!extension) {\n\t\t\t\t// If the extension is not found, skip it\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\t// Add separator for the owning extension\n\t\t\titems.push({\n\t\t\t\ttype: 'separator',\n\t\t\t\tid: ownerId,\n\t\t\t\tlabel: localize('extensionOwner', '{0}', extension.displayName || extension.name),\n\t\t\t\tbuttons: [{\n\t\t\t\t\ticonClass: ThemeIcon.asClassName(Codicon.info),\n\t\t\t\t\ttooltip: localize('openExtension', 'Open Extension'),\n\t\t\t\t}]\n\t\t\t});\n\n\t\t\t// Add allowed extensions as checkboxes (visual representation)\n\t\t\tlet addedTrustedSeparator = false;\n\t\t\tif (allowedExtensions.length > 0) {\n\t\t\t\tfor (const allowedExt of allowedExtensions) {\n\t\t\t\t\tif (allowedExt.trusted && !addedTrustedSeparator) {\n\t\t\t\t\t\titems.push({\n\t\t\t\t\t\t\ttype: 'separator',\n\t\t\t\t\t\t\tlabel: localize('trustedExtension', 'Trusted by Microsoft'),\n\t\t\t\t\t\t});\n\t\t\t\t\t\taddedTrustedSeparator = true;\n\t\t\t\t\t}\n\t\t\t\t\titems.push({\n\t\t\t\t\t\tlabel: allowedExt.name,\n\t\t\t\t\t\townerId,\n\t\t\t\t\t\tid: allowedExt.id,\n\t\t\t\t\t\tpicked: allowedExt.allowed ?? false,\n\t\t\t\t\t\textension: allowedExt,\n\t\t\t\t\t\tdisabled: allowedExt.trusted, // Don't allow toggling trusted extensions\n\t\t\t\t\t\tbuttons: [{\n\t\t\t\t\t\t\ticonClass: ThemeIcon.asClassName(Codicon.info),\n\t\t\t\t\t\t\ttooltip: localize('openExtension', 'Open Extension'),\n\t\t\t\t\t\t}]\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\titems.push({\n\t\t\t\t\tlabel: localize('noAllowedExtensions', 'No extensions have access'),\n\t\t\t\t\tdescription: localize('noAccessDescription', 'No extensions are currently allowed to use models from {0}', ownerId),\n\t\t\t\t\tpickable: false\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\t// Show the QuickPick\n\t\tconst result = await quickInputService.pick(\n\t\t\titems,\n\t\t\t{\n\t\t\t\tcanPickMany: true,\n\t\t\t\tsortByLabel: true,\n\t\t\t\tonDidTriggerSeparatorButton(context) {\n\t\t\t\t\t// Handle separator button clicks\n\t\t\t\t\tconst extId = context.separator.id;\n\t\t\t\t\tif (extId) {\n\t\t\t\t\t\t// Open the extension in the editor\n\t\t\t\t\t\tvoid extensionsWorkbenchService.open(extId);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tonDidTriggerItemButton(context) {\n\t\t\t\t\t// Handle item button clicks\n\t\t\t\t\tconst extId = context.item.id;\n\t\t\t\t\tif (extId) {\n\t\t\t\t\t\t// Open the extension in the editor\n\t\t\t\t\t\tvoid extensionsWorkbenchService.open(extId);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\ttitle: localize('languageModelAuthTitle', 'Manage Language Model Access'),\n\t\t\t\tplaceHolder: localize('languageModelAuthPlaceholder', 'Choose which extensions can access language models'),\n\t\t\t}\n\t\t);\n\t\tif (!result) {\n\t\t\treturn;\n\t\t}\n\n\t\tfor (const [ownerId, allowedExtensions] of extensionAuth) {\n\t\t\t// diff with result to find out which extensions are allowed or not\n\t\t\t// but we need to only look at the result items that have the ownerId\n\t\t\tconst allowedSet = new Set(result\n\t\t\t\t.filter(item => item.ownerId === ownerId)\n\t\t\t\t// only save items that are not trusted automatically\n\t\t\t\t.filter(item => !item.extension?.trusted)\n\t\t\t\t.map(item => item.id!));\n\n\t\t\tfor (const allowedExt of allowedExtensions) {\n\t\t\t\tallowedExt.allowed = allowedSet.has(allowedExt.id);\n\t\t\t}\n\n\t\t\tauthenticationAccessService.updateAllowedExtensions(\n\t\t\t\tINTERNAL_AUTH_PROVIDER_PREFIX + ownerId,\n\t\t\t\townerToAccountLabel.get(ownerId) || 'Language Models',\n\t\t\t\tallowedExtensions\n\t\t\t);\n\t\t}\n\n\t}\n}\n\nexport function registerLanguageModelActions() {\n\tregisterAction2(ManageLanguageModelAuthenticationAction);\n\tregisterAction2(ManageModelsAction);\n}\n"]}