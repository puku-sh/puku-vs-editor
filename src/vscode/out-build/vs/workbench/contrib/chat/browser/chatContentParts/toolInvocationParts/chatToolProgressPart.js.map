{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/contrib/chat/browser/chatContentParts/toolInvocationParts/chatToolProgressPart.ts","vs/workbench/contrib/chat/browser/chatContentParts/toolInvocationParts/chatToolProgressPart.ts"],"names":[],"mappings":"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","file":"chatToolProgressPart.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as dom from '../../../../../../base/browser/dom.js';\nimport { status } from '../../../../../../base/browser/ui/aria/aria.js';\nimport { IMarkdownString, MarkdownString } from '../../../../../../base/common/htmlContent.js';\nimport { autorun } from '../../../../../../base/common/observable.js';\nimport { IMarkdownRenderer } from '../../../../../../platform/markdown/browser/markdownRenderer.js';\nimport { IConfigurationService } from '../../../../../../platform/configuration/common/configuration.js';\nimport { IInstantiationService } from '../../../../../../platform/instantiation/common/instantiation.js';\nimport { IChatProgressMessage, IChatToolInvocation, IChatToolInvocationSerialized, ToolConfirmKind } from '../../../common/chatService.js';\nimport { AccessibilityWorkbenchSettingId } from '../../../../accessibility/browser/accessibilityConfiguration.js';\nimport { IChatCodeBlockInfo } from '../../chat.js';\nimport { IChatContentPartRenderContext } from '../chatContentParts.js';\nimport { ChatProgressContentPart } from '../chatProgressContentPart.js';\nimport { BaseChatToolInvocationSubPart } from './chatToolInvocationSubPart.js';\n\nexport class ChatToolProgressSubPart extends BaseChatToolInvocationSubPart {\n\tpublic readonly domNode: HTMLElement;\n\n\tpublic override readonly codeblocks: IChatCodeBlockInfo[] = [];\n\n\tconstructor(\n\t\ttoolInvocation: IChatToolInvocation | IChatToolInvocationSerialized,\n\t\tprivate readonly context: IChatContentPartRenderContext,\n\t\tprivate readonly renderer: IMarkdownRenderer,\n\t\tprivate readonly announcedToolProgressKeys: Set<string> | undefined,\n\t\t@IInstantiationService private readonly instantiationService: IInstantiationService,\n\t\t@IConfigurationService private readonly configurationService: IConfigurationService,\n\t) {\n\t\tsuper(toolInvocation);\n\n\t\tthis.domNode = this.createProgressPart();\n\t}\n\n\tprivate createProgressPart(): HTMLElement {\n\t\tif (IChatToolInvocation.isComplete(this.toolInvocation) && this.toolIsConfirmed && this.toolInvocation.pastTenseMessage) {\n\t\t\tconst key = this.getAnnouncementKey('complete');\n\t\t\tconst completionContent = this.toolInvocation.pastTenseMessage ?? this.toolInvocation.invocationMessage;\n\t\t\tconst shouldAnnounce = this.toolInvocation.kind === 'toolInvocation' && this.hasMeaningfulContent(completionContent) ? this.computeShouldAnnounce(key) : false;\n\t\t\tconst part = this.renderProgressContent(completionContent, shouldAnnounce);\n\t\t\tthis._register(part);\n\t\t\treturn part.domNode;\n\t\t} else {\n\t\t\tconst container = document.createElement('div');\n\t\t\tconst progressObservable = this.toolInvocation.kind === 'toolInvocation' ? this.toolInvocation.state.map((s, r) => s.type === IChatToolInvocation.StateKind.Executing ? s.progress.read(r) : undefined) : undefined;\n\t\t\tthis._register(autorun(reader => {\n\t\t\t\tconst progress = progressObservable?.read(reader);\n\t\t\t\tconst key = this.getAnnouncementKey('progress');\n\t\t\t\tconst progressContent = progress?.message ?? this.toolInvocation.invocationMessage;\n\t\t\t\tconst shouldAnnounce = this.toolInvocation.kind === 'toolInvocation' && this.hasMeaningfulContent(progressContent) ? this.computeShouldAnnounce(key) : false;\n\t\t\t\tconst part = reader.store.add(this.renderProgressContent(progressContent, shouldAnnounce));\n\t\t\t\tdom.reset(container, part.domNode);\n\t\t\t}));\n\t\t\treturn container;\n\t\t}\n\t}\n\n\tprivate get toolIsConfirmed() {\n\t\tconst c = IChatToolInvocation.executionConfirmedOrDenied(this.toolInvocation);\n\t\treturn !!c && c.type !== ToolConfirmKind.Denied;\n\t}\n\n\tprivate renderProgressContent(content: IMarkdownString | string, shouldAnnounce: boolean) {\n\t\tif (typeof content === 'string') {\n\t\t\tcontent = new MarkdownString().appendText(content);\n\t\t}\n\n\t\tconst progressMessage: IChatProgressMessage = {\n\t\t\tkind: 'progressMessage',\n\t\t\tcontent\n\t\t};\n\n\t\tif (shouldAnnounce) {\n\t\t\tthis.provideScreenReaderStatus(content);\n\t\t}\n\n\t\treturn this.instantiationService.createInstance(ChatProgressContentPart, progressMessage, this.renderer, this.context, undefined, true, this.getIcon(), this.toolInvocation);\n\t}\n\n\tprivate getAnnouncementKey(kind: 'progress' | 'complete'): string {\n\t\treturn `${kind}:${this.toolInvocation.toolCallId}`;\n\t}\n\n\tprivate computeShouldAnnounce(key: string): boolean {\n\t\tif (!this.announcedToolProgressKeys) {\n\t\t\treturn false;\n\t\t}\n\t\tif (!this.configurationService.getValue(AccessibilityWorkbenchSettingId.VerboseChatProgressUpdates)) {\n\t\t\treturn false;\n\t\t}\n\t\tif (this.announcedToolProgressKeys.has(key)) {\n\t\t\treturn false;\n\t\t}\n\t\tthis.announcedToolProgressKeys.add(key);\n\t\treturn true;\n\t}\n\n\tprivate provideScreenReaderStatus(content: IMarkdownString | string): void {\n\t\tconst message = typeof content === 'string' ? content : content.value;\n\t\tstatus(message);\n\t}\n\n\tprivate hasMeaningfulContent(content: IMarkdownString | string | undefined): boolean {\n\t\tif (!content) {\n\t\t\treturn false;\n\t\t}\n\n\t\tconst text = typeof content === 'string' ? content : content.value;\n\t\treturn text.trim().length > 0;\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as dom from '../../../../../../base/browser/dom.js';\nimport { status } from '../../../../../../base/browser/ui/aria/aria.js';\nimport { IMarkdownString, MarkdownString } from '../../../../../../base/common/htmlContent.js';\nimport { autorun } from '../../../../../../base/common/observable.js';\nimport { IMarkdownRenderer } from '../../../../../../platform/markdown/browser/markdownRenderer.js';\nimport { IConfigurationService } from '../../../../../../platform/configuration/common/configuration.js';\nimport { IInstantiationService } from '../../../../../../platform/instantiation/common/instantiation.js';\nimport { IChatProgressMessage, IChatToolInvocation, IChatToolInvocationSerialized, ToolConfirmKind } from '../../../common/chatService.js';\nimport { AccessibilityWorkbenchSettingId } from '../../../../accessibility/browser/accessibilityConfiguration.js';\nimport { IChatCodeBlockInfo } from '../../chat.js';\nimport { IChatContentPartRenderContext } from '../chatContentParts.js';\nimport { ChatProgressContentPart } from '../chatProgressContentPart.js';\nimport { BaseChatToolInvocationSubPart } from './chatToolInvocationSubPart.js';\n\nexport class ChatToolProgressSubPart extends BaseChatToolInvocationSubPart {\n\tpublic readonly domNode: HTMLElement;\n\n\tpublic override readonly codeblocks: IChatCodeBlockInfo[] = [];\n\n\tconstructor(\n\t\ttoolInvocation: IChatToolInvocation | IChatToolInvocationSerialized,\n\t\tprivate readonly context: IChatContentPartRenderContext,\n\t\tprivate readonly renderer: IMarkdownRenderer,\n\t\tprivate readonly announcedToolProgressKeys: Set<string> | undefined,\n\t\t@IInstantiationService private readonly instantiationService: IInstantiationService,\n\t\t@IConfigurationService private readonly configurationService: IConfigurationService,\n\t) {\n\t\tsuper(toolInvocation);\n\n\t\tthis.domNode = this.createProgressPart();\n\t}\n\n\tprivate createProgressPart(): HTMLElement {\n\t\tif (IChatToolInvocation.isComplete(this.toolInvocation) && this.toolIsConfirmed && this.toolInvocation.pastTenseMessage) {\n\t\t\tconst key = this.getAnnouncementKey('complete');\n\t\t\tconst completionContent = this.toolInvocation.pastTenseMessage ?? this.toolInvocation.invocationMessage;\n\t\t\tconst shouldAnnounce = this.toolInvocation.kind === 'toolInvocation' && this.hasMeaningfulContent(completionContent) ? this.computeShouldAnnounce(key) : false;\n\t\t\tconst part = this.renderProgressContent(completionContent, shouldAnnounce);\n\t\t\tthis._register(part);\n\t\t\treturn part.domNode;\n\t\t} else {\n\t\t\tconst container = document.createElement('div');\n\t\t\tconst progressObservable = this.toolInvocation.kind === 'toolInvocation' ? this.toolInvocation.state.map((s, r) => s.type === IChatToolInvocation.StateKind.Executing ? s.progress.read(r) : undefined) : undefined;\n\t\t\tthis._register(autorun(reader => {\n\t\t\t\tconst progress = progressObservable?.read(reader);\n\t\t\t\tconst key = this.getAnnouncementKey('progress');\n\t\t\t\tconst progressContent = progress?.message ?? this.toolInvocation.invocationMessage;\n\t\t\t\tconst shouldAnnounce = this.toolInvocation.kind === 'toolInvocation' && this.hasMeaningfulContent(progressContent) ? this.computeShouldAnnounce(key) : false;\n\t\t\t\tconst part = reader.store.add(this.renderProgressContent(progressContent, shouldAnnounce));\n\t\t\t\tdom.reset(container, part.domNode);\n\t\t\t}));\n\t\t\treturn container;\n\t\t}\n\t}\n\n\tprivate get toolIsConfirmed() {\n\t\tconst c = IChatToolInvocation.executionConfirmedOrDenied(this.toolInvocation);\n\t\treturn !!c && c.type !== ToolConfirmKind.Denied;\n\t}\n\n\tprivate renderProgressContent(content: IMarkdownString | string, shouldAnnounce: boolean) {\n\t\tif (typeof content === 'string') {\n\t\t\tcontent = new MarkdownString().appendText(content);\n\t\t}\n\n\t\tconst progressMessage: IChatProgressMessage = {\n\t\t\tkind: 'progressMessage',\n\t\t\tcontent\n\t\t};\n\n\t\tif (shouldAnnounce) {\n\t\t\tthis.provideScreenReaderStatus(content);\n\t\t}\n\n\t\treturn this.instantiationService.createInstance(ChatProgressContentPart, progressMessage, this.renderer, this.context, undefined, true, this.getIcon(), this.toolInvocation);\n\t}\n\n\tprivate getAnnouncementKey(kind: 'progress' | 'complete'): string {\n\t\treturn `${kind}:${this.toolInvocation.toolCallId}`;\n\t}\n\n\tprivate computeShouldAnnounce(key: string): boolean {\n\t\tif (!this.announcedToolProgressKeys) {\n\t\t\treturn false;\n\t\t}\n\t\tif (!this.configurationService.getValue(AccessibilityWorkbenchSettingId.VerboseChatProgressUpdates)) {\n\t\t\treturn false;\n\t\t}\n\t\tif (this.announcedToolProgressKeys.has(key)) {\n\t\t\treturn false;\n\t\t}\n\t\tthis.announcedToolProgressKeys.add(key);\n\t\treturn true;\n\t}\n\n\tprivate provideScreenReaderStatus(content: IMarkdownString | string): void {\n\t\tconst message = typeof content === 'string' ? content : content.value;\n\t\tstatus(message);\n\t}\n\n\tprivate hasMeaningfulContent(content: IMarkdownString | string | undefined): boolean {\n\t\tif (!content) {\n\t\t\treturn false;\n\t\t}\n\n\t\tconst text = typeof content === 'string' ? content : content.value;\n\t\treturn text.trim().length > 0;\n\t}\n}\n"]}