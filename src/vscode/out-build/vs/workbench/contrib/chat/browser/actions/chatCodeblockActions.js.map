{"version":3,"sources":["vs/workbench/contrib/chat/browser/actions/chatCodeblockActions.ts"],"names":[],"mappings":"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","file":"chatCodeblockActions.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { AsyncIterableObject } from '../../../../../base/common/async.js';\nimport { CancellationToken } from '../../../../../base/common/cancellation.js';\nimport { Codicon } from '../../../../../base/common/codicons.js';\nimport { KeyCode, KeyMod } from '../../../../../base/common/keyCodes.js';\nimport { Disposable, markAsSingleton } from '../../../../../base/common/lifecycle.js';\nimport { ICodeEditor } from '../../../../../editor/browser/editorBrowser.js';\nimport { ServicesAccessor } from '../../../../../editor/browser/editorExtensions.js';\nimport { ICodeEditorService } from '../../../../../editor/browser/services/codeEditorService.js';\nimport { EditorContextKeys } from '../../../../../editor/common/editorContextKeys.js';\nimport { CopyAction } from '../../../../../editor/contrib/clipboard/browser/clipboard.js';\nimport { localize, localize2 } from '../../../../../nls.js';\nimport { IActionViewItemService } from '../../../../../platform/actions/browser/actionViewItemService.js';\nimport { MenuEntryActionViewItem } from '../../../../../platform/actions/browser/menuEntryActionViewItem.js';\nimport { Action2, MenuId, MenuItemAction, registerAction2 } from '../../../../../platform/actions/common/actions.js';\nimport { IClipboardService } from '../../../../../platform/clipboard/common/clipboardService.js';\nimport { ContextKeyExpr } from '../../../../../platform/contextkey/common/contextkey.js';\nimport { IInstantiationService } from '../../../../../platform/instantiation/common/instantiation.js';\nimport { KeybindingWeight } from '../../../../../platform/keybinding/common/keybindingsRegistry.js';\nimport { ILabelService } from '../../../../../platform/label/common/label.js';\nimport { TerminalLocation } from '../../../../../platform/terminal/common/terminal.js';\nimport { IWorkbenchContribution } from '../../../../common/contributions.js';\nimport { IUntitledTextResourceEditorInput } from '../../../../common/editor.js';\nimport { IEditorService } from '../../../../services/editor/common/editorService.js';\nimport { accessibleViewInCodeBlock } from '../../../accessibility/browser/accessibilityConfiguration.js';\nimport { IAiEditTelemetryService } from '../../../editTelemetry/browser/telemetry/aiEditTelemetry/aiEditTelemetryService.js';\nimport { EditDeltaInfo } from '../../../../../editor/common/textModelEditSource.js';\nimport { reviewEdits } from '../../../inlineChat/browser/inlineChatController.js';\nimport { ITerminalEditorService, ITerminalGroupService, ITerminalService } from '../../../terminal/browser/terminal.js';\nimport { ChatContextKeys } from '../../common/chatContextKeys.js';\nimport { ChatCopyKind, IChatService } from '../../common/chatService.js';\nimport { IChatRequestViewModel, IChatResponseViewModel, isRequestVM, isResponseVM } from '../../common/chatViewModel.js';\nimport { ChatAgentLocation } from '../../common/constants.js';\nimport { IChatCodeBlockContextProviderService, IChatWidgetService } from '../chat.js';\nimport { DefaultChatTextEditor, ICodeBlockActionContext, ICodeCompareBlockActionContext } from '../codeBlockPart.js';\nimport { CHAT_CATEGORY } from './chatActions.js';\nimport { ApplyCodeBlockOperation, InsertCodeBlockOperation } from './codeBlockOperations.js';\n\nconst shellLangIds = [\n\t'fish',\n\t'ps1',\n\t'pwsh',\n\t'powershell',\n\t'sh',\n\t'shellscript',\n\t'zsh'\n];\n\nexport interface IChatCodeBlockActionContext extends ICodeBlockActionContext {\n\telement: IChatResponseViewModel;\n}\n\nexport function isCodeBlockActionContext(thing: unknown): thing is ICodeBlockActionContext {\n\treturn typeof thing === 'object' && thing !== null && 'code' in thing && 'element' in thing;\n}\n\nexport function isCodeCompareBlockActionContext(thing: unknown): thing is ICodeCompareBlockActionContext {\n\treturn typeof thing === 'object' && thing !== null && 'element' in thing;\n}\n\nfunction isResponseFiltered(context: ICodeBlockActionContext) {\n\treturn isResponseVM(context.element) && context.element.errorDetails?.responseIsFiltered;\n}\n\nabstract class ChatCodeBlockAction extends Action2 {\n\trun(accessor: ServicesAccessor, ...args: unknown[]) {\n\t\tlet context = args[0];\n\t\tif (!isCodeBlockActionContext(context)) {\n\t\t\tconst codeEditorService = accessor.get(ICodeEditorService);\n\t\t\tconst editor = codeEditorService.getFocusedCodeEditor() || codeEditorService.getActiveCodeEditor();\n\t\t\tif (!editor) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tcontext = getContextFromEditor(editor, accessor);\n\t\t\tif (!isCodeBlockActionContext(context)) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\treturn this.runWithContext(accessor, context);\n\t}\n\n\tabstract runWithContext(accessor: ServicesAccessor, context: ICodeBlockActionContext): any;\n}\n\nconst APPLY_IN_EDITOR_ID = 'workbench.action.chat.applyInEditor';\n\nexport class CodeBlockActionRendering extends Disposable implements IWorkbenchContribution {\n\n\tstatic readonly ID = 'chat.codeBlockActionRendering';\n\n\tconstructor(\n\t\t@IActionViewItemService actionViewItemService: IActionViewItemService,\n\t\t@IInstantiationService instantiationService: IInstantiationService,\n\t\t@ILabelService labelService: ILabelService,\n\t) {\n\t\tsuper();\n\n\t\tconst disposable = actionViewItemService.register(MenuId.ChatCodeBlock, APPLY_IN_EDITOR_ID, (action, options) => {\n\t\t\tif (!(action instanceof MenuItemAction)) {\n\t\t\t\treturn undefined;\n\t\t\t}\n\t\t\treturn instantiationService.createInstance(class extends MenuEntryActionViewItem {\n\t\t\t\tprotected override getTooltip(): string {\n\t\t\t\t\tconst context = this._context;\n\t\t\t\t\tif (isCodeBlockActionContext(context) && context.codemapperUri) {\n\t\t\t\t\t\tconst label = labelService.getUriLabel(context.codemapperUri, { relative: true });\n\t\t\t\t\t\treturn localize('interactive.applyInEditorWithURL.label', \"Apply to {0}\", label);\n\t\t\t\t\t}\n\t\t\t\t\treturn super.getTooltip();\n\t\t\t\t}\n\t\t\t\toverride setActionContext(newContext: unknown): void {\n\t\t\t\t\tsuper.setActionContext(newContext);\n\t\t\t\t\tthis.updateTooltip();\n\t\t\t\t}\n\t\t\t}, action, undefined);\n\t\t});\n\n\t\t// Reduces flicker a bit on reload/restart\n\t\tmarkAsSingleton(disposable);\n\t}\n}\n\nexport function registerChatCodeBlockActions() {\n\tregisterAction2(class CopyCodeBlockAction extends Action2 {\n\t\tconstructor() {\n\t\t\tsuper({\n\t\t\t\tid: 'workbench.action.chat.copyCodeBlock',\n\t\t\t\ttitle: localize2('interactive.copyCodeBlock.label', \"Copy\"),\n\t\t\t\tf1: false,\n\t\t\t\tcategory: CHAT_CATEGORY,\n\t\t\t\ticon: Codicon.copy,\n\t\t\t\tmenu: {\n\t\t\t\t\tid: MenuId.ChatCodeBlock,\n\t\t\t\t\tgroup: 'navigation',\n\t\t\t\t\torder: 30\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\trun(accessor: ServicesAccessor, ...args: unknown[]) {\n\t\t\tconst context = args[0];\n\t\t\tif (!isCodeBlockActionContext(context) || isResponseFiltered(context)) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst clipboardService = accessor.get(IClipboardService);\n\t\t\tconst aiEditTelemetryService = accessor.get(IAiEditTelemetryService);\n\t\t\tclipboardService.writeText(context.code);\n\n\t\t\tif (isResponseVM(context.element)) {\n\t\t\t\tconst chatService = accessor.get(IChatService);\n\t\t\t\tconst requestId = context.element.requestId;\n\t\t\t\tconst request = context.element.session.getItems().find(item => item.id === requestId && isRequestVM(item)) as IChatRequestViewModel | undefined;\n\t\t\t\tchatService.notifyUserAction({\n\t\t\t\t\tagentId: context.element.agent?.id,\n\t\t\t\t\tcommand: context.element.slashCommand?.name,\n\t\t\t\t\tsessionResource: context.element.sessionResource,\n\t\t\t\t\trequestId: context.element.requestId,\n\t\t\t\t\tresult: context.element.result,\n\t\t\t\t\taction: {\n\t\t\t\t\t\tkind: 'copy',\n\t\t\t\t\t\tcodeBlockIndex: context.codeBlockIndex,\n\t\t\t\t\t\tcopyKind: ChatCopyKind.Toolbar,\n\t\t\t\t\t\tcopiedCharacters: context.code.length,\n\t\t\t\t\t\ttotalCharacters: context.code.length,\n\t\t\t\t\t\tcopiedText: context.code,\n\t\t\t\t\t\tcopiedLines: context.code.split('\\n').length,\n\t\t\t\t\t\tlanguageId: context.languageId,\n\t\t\t\t\t\ttotalLines: context.code.split('\\n').length,\n\t\t\t\t\t\tmodelId: request?.modelId ?? ''\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tconst codeBlockInfo = context.element.model.codeBlockInfos?.at(context.codeBlockIndex);\n\t\t\t\taiEditTelemetryService.handleCodeAccepted({\n\t\t\t\t\tacceptanceMethod: 'copyButton',\n\t\t\t\t\tsuggestionId: codeBlockInfo?.suggestionId,\n\t\t\t\t\teditDeltaInfo: EditDeltaInfo.fromText(context.code),\n\t\t\t\t\tfeature: 'sideBarChat',\n\t\t\t\t\tlanguageId: context.languageId,\n\t\t\t\t\tmodeId: context.element.model.request?.modeInfo?.modeId,\n\t\t\t\t\tmodelId: request?.modelId,\n\t\t\t\t\tpresentation: 'codeBlock',\n\t\t\t\t\tapplyCodeBlockSuggestionId: undefined,\n\t\t\t\t\tsource: undefined,\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t});\n\n\tCopyAction?.addImplementation(50000, 'chat-codeblock', (accessor) => {\n\t\t// get active code editor\n\t\tconst editor = accessor.get(ICodeEditorService).getFocusedCodeEditor();\n\t\tif (!editor) {\n\t\t\treturn false;\n\t\t}\n\n\t\tconst editorModel = editor.getModel();\n\t\tif (!editorModel) {\n\t\t\treturn false;\n\t\t}\n\n\t\tconst context = getContextFromEditor(editor, accessor);\n\t\tif (!context) {\n\t\t\treturn false;\n\t\t}\n\n\t\tconst noSelection = editor.getSelections()?.length === 1 && editor.getSelection()?.isEmpty();\n\t\tconst copiedText = noSelection ?\n\t\t\teditorModel.getValue() :\n\t\t\teditor.getSelections()?.reduce((acc, selection) => acc + editorModel.getValueInRange(selection), '') ?? '';\n\t\tconst totalCharacters = editorModel.getValueLength();\n\n\t\t// Report copy to extensions\n\t\tconst chatService = accessor.get(IChatService);\n\t\tconst aiEditTelemetryService = accessor.get(IAiEditTelemetryService);\n\t\tconst element = context.element as IChatResponseViewModel | undefined;\n\t\tif (isResponseVM(element)) {\n\t\t\tconst requestId = element.requestId;\n\t\t\tconst request = element.session.getItems().find(item => item.id === requestId && isRequestVM(item)) as IChatRequestViewModel | undefined;\n\t\t\tchatService.notifyUserAction({\n\t\t\t\tagentId: element.agent?.id,\n\t\t\t\tcommand: element.slashCommand?.name,\n\t\t\t\tsessionResource: element.sessionResource,\n\t\t\t\trequestId: element.requestId,\n\t\t\t\tresult: element.result,\n\t\t\t\taction: {\n\t\t\t\t\tkind: 'copy',\n\t\t\t\t\tcodeBlockIndex: context.codeBlockIndex,\n\t\t\t\t\tcopyKind: ChatCopyKind.Action,\n\t\t\t\t\tcopiedText,\n\t\t\t\t\tcopiedCharacters: copiedText.length,\n\t\t\t\t\ttotalCharacters,\n\t\t\t\t\tlanguageId: context.languageId,\n\t\t\t\t\ttotalLines: context.code.split('\\n').length,\n\t\t\t\t\tcopiedLines: copiedText.split('\\n').length,\n\t\t\t\t\tmodelId: request?.modelId ?? ''\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tconst codeBlockInfo = element.model.codeBlockInfos?.at(context.codeBlockIndex);\n\t\t\taiEditTelemetryService.handleCodeAccepted({\n\t\t\t\tacceptanceMethod: 'copyManual',\n\t\t\t\tsuggestionId: codeBlockInfo?.suggestionId,\n\t\t\t\teditDeltaInfo: EditDeltaInfo.fromText(copiedText),\n\t\t\t\tfeature: 'sideBarChat',\n\t\t\t\tlanguageId: context.languageId,\n\t\t\t\tmodeId: element.model.request?.modeInfo?.modeId,\n\t\t\t\tmodelId: request?.modelId,\n\t\t\t\tpresentation: 'codeBlock',\n\t\t\t\tapplyCodeBlockSuggestionId: undefined,\n\t\t\t\tsource: undefined,\n\t\t\t});\n\t\t}\n\n\t\t// Copy full cell if no selection, otherwise fall back on normal editor implementation\n\t\tif (noSelection) {\n\t\t\taccessor.get(IClipboardService).writeText(context.code);\n\t\t\treturn true;\n\t\t}\n\n\t\treturn false;\n\t});\n\n\tregisterAction2(class SmartApplyInEditorAction extends ChatCodeBlockAction {\n\n\t\tprivate operation: ApplyCodeBlockOperation | undefined;\n\n\t\tconstructor() {\n\t\t\tsuper({\n\t\t\t\tid: APPLY_IN_EDITOR_ID,\n\t\t\t\ttitle: localize2('interactive.applyInEditor.label', \"Apply in Editor\"),\n\t\t\t\tprecondition: ChatContextKeys.enabled,\n\t\t\t\tf1: true,\n\t\t\t\tcategory: CHAT_CATEGORY,\n\t\t\t\ticon: Codicon.gitPullRequestGoToChanges,\n\n\t\t\t\tmenu: [\n\t\t\t\t\t{\n\t\t\t\t\t\tid: MenuId.ChatCodeBlock,\n\t\t\t\t\t\tgroup: 'navigation',\n\t\t\t\t\t\twhen: ContextKeyExpr.and(\n\t\t\t\t\t\t\t...shellLangIds.map(e => ContextKeyExpr.notEquals(EditorContextKeys.languageId.key, e))\n\t\t\t\t\t\t),\n\t\t\t\t\t\torder: 10\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tid: MenuId.ChatCodeBlock,\n\t\t\t\t\t\twhen: ContextKeyExpr.or(\n\t\t\t\t\t\t\t...shellLangIds.map(e => ContextKeyExpr.equals(EditorContextKeys.languageId.key, e))\n\t\t\t\t\t\t)\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t\tkeybinding: {\n\t\t\t\t\twhen: ContextKeyExpr.or(ContextKeyExpr.and(ChatContextKeys.inChatSession, ChatContextKeys.inChatInput.negate()), accessibleViewInCodeBlock),\n\t\t\t\t\tprimary: KeyMod.CtrlCmd | KeyCode.Enter,\n\t\t\t\t\tmac: { primary: KeyMod.WinCtrl | KeyCode.Enter },\n\t\t\t\t\tweight: KeybindingWeight.ExternalExtension + 1\n\t\t\t\t},\n\t\t\t});\n\t\t}\n\n\t\toverride runWithContext(accessor: ServicesAccessor, context: ICodeBlockActionContext) {\n\t\t\tif (!this.operation) {\n\t\t\t\tthis.operation = accessor.get(IInstantiationService).createInstance(ApplyCodeBlockOperation);\n\t\t\t}\n\t\t\treturn this.operation.run(context);\n\t\t}\n\t});\n\n\tregisterAction2(class InsertAtCursorAction extends ChatCodeBlockAction {\n\t\tconstructor() {\n\t\t\tsuper({\n\t\t\t\tid: 'workbench.action.chat.insertCodeBlock',\n\t\t\t\ttitle: localize2('interactive.insertCodeBlock.label', \"Insert At Cursor\"),\n\t\t\t\tprecondition: ChatContextKeys.enabled,\n\t\t\t\tf1: true,\n\t\t\t\tcategory: CHAT_CATEGORY,\n\t\t\t\ticon: Codicon.insert,\n\t\t\t\tmenu: [{\n\t\t\t\t\tid: MenuId.ChatCodeBlock,\n\t\t\t\t\tgroup: 'navigation',\n\t\t\t\t\twhen: ContextKeyExpr.and(ChatContextKeys.inChatSession, ChatContextKeys.location.notEqualsTo(ChatAgentLocation.Terminal)),\n\t\t\t\t\torder: 20\n\t\t\t\t}, {\n\t\t\t\t\tid: MenuId.ChatCodeBlock,\n\t\t\t\t\tgroup: 'navigation',\n\t\t\t\t\twhen: ContextKeyExpr.and(ChatContextKeys.inChatSession, ChatContextKeys.location.isEqualTo(ChatAgentLocation.Terminal)),\n\t\t\t\t\tisHiddenByDefault: true,\n\t\t\t\t\torder: 20\n\t\t\t\t}],\n\t\t\t\tkeybinding: {\n\t\t\t\t\twhen: ContextKeyExpr.or(ContextKeyExpr.and(ChatContextKeys.inChatSession, ChatContextKeys.inChatInput.negate()), accessibleViewInCodeBlock),\n\t\t\t\t\tprimary: KeyMod.CtrlCmd | KeyCode.Enter,\n\t\t\t\t\tmac: { primary: KeyMod.WinCtrl | KeyCode.Enter },\n\t\t\t\t\tweight: KeybindingWeight.ExternalExtension + 1\n\t\t\t\t},\n\t\t\t});\n\t\t}\n\n\t\toverride runWithContext(accessor: ServicesAccessor, context: ICodeBlockActionContext) {\n\t\t\tconst operation = accessor.get(IInstantiationService).createInstance(InsertCodeBlockOperation);\n\t\t\treturn operation.run(context);\n\t\t}\n\t});\n\n\tregisterAction2(class InsertIntoNewFileAction extends ChatCodeBlockAction {\n\t\tconstructor() {\n\t\t\tsuper({\n\t\t\t\tid: 'workbench.action.chat.insertIntoNewFile',\n\t\t\t\ttitle: localize2('interactive.insertIntoNewFile.label', \"Insert into New File\"),\n\t\t\t\tprecondition: ChatContextKeys.enabled,\n\t\t\t\tf1: true,\n\t\t\t\tcategory: CHAT_CATEGORY,\n\t\t\t\ticon: Codicon.newFile,\n\t\t\t\tmenu: {\n\t\t\t\t\tid: MenuId.ChatCodeBlock,\n\t\t\t\t\tgroup: 'navigation',\n\t\t\t\t\tisHiddenByDefault: true,\n\t\t\t\t\torder: 40,\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\toverride async runWithContext(accessor: ServicesAccessor, context: ICodeBlockActionContext) {\n\t\t\tif (isResponseFiltered(context)) {\n\t\t\t\t// When run from command palette\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst editorService = accessor.get(IEditorService);\n\t\t\tconst chatService = accessor.get(IChatService);\n\t\t\tconst aiEditTelemetryService = accessor.get(IAiEditTelemetryService);\n\n\t\t\teditorService.openEditor({ contents: context.code, languageId: context.languageId, resource: undefined } satisfies IUntitledTextResourceEditorInput);\n\n\t\t\tif (isResponseVM(context.element)) {\n\t\t\t\tconst requestId = context.element.requestId;\n\t\t\t\tconst request = context.element.session.getItems().find(item => item.id === requestId && isRequestVM(item)) as IChatRequestViewModel | undefined;\n\t\t\t\tchatService.notifyUserAction({\n\t\t\t\t\tagentId: context.element.agent?.id,\n\t\t\t\t\tcommand: context.element.slashCommand?.name,\n\t\t\t\t\tsessionResource: context.element.sessionResource,\n\t\t\t\t\trequestId: context.element.requestId,\n\t\t\t\t\tresult: context.element.result,\n\t\t\t\t\taction: {\n\t\t\t\t\t\tkind: 'insert',\n\t\t\t\t\t\tcodeBlockIndex: context.codeBlockIndex,\n\t\t\t\t\t\ttotalCharacters: context.code.length,\n\t\t\t\t\t\tnewFile: true,\n\t\t\t\t\t\ttotalLines: context.code.split('\\n').length,\n\t\t\t\t\t\tlanguageId: context.languageId,\n\t\t\t\t\t\tmodelId: request?.modelId ?? ''\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tconst codeBlockInfo = context.element.model.codeBlockInfos?.at(context.codeBlockIndex);\n\n\t\t\t\taiEditTelemetryService.handleCodeAccepted({\n\t\t\t\t\tacceptanceMethod: 'insertInNewFile',\n\t\t\t\t\tsuggestionId: codeBlockInfo?.suggestionId,\n\t\t\t\t\teditDeltaInfo: EditDeltaInfo.fromText(context.code),\n\t\t\t\t\tfeature: 'sideBarChat',\n\t\t\t\t\tlanguageId: context.languageId,\n\t\t\t\t\tmodeId: context.element.model.request?.modeInfo?.modeId,\n\t\t\t\t\tmodelId: request?.modelId,\n\t\t\t\t\tpresentation: 'codeBlock',\n\t\t\t\t\tapplyCodeBlockSuggestionId: undefined,\n\t\t\t\t\tsource: undefined,\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t});\n\n\tregisterAction2(class RunInTerminalAction extends ChatCodeBlockAction {\n\t\tconstructor() {\n\t\t\tsuper({\n\t\t\t\tid: 'workbench.action.chat.runInTerminal',\n\t\t\t\ttitle: localize2('interactive.runInTerminal.label', \"Insert into Terminal\"),\n\t\t\t\tprecondition: ChatContextKeys.enabled,\n\t\t\t\tf1: true,\n\t\t\t\tcategory: CHAT_CATEGORY,\n\t\t\t\ticon: Codicon.terminal,\n\t\t\t\tmenu: [{\n\t\t\t\t\tid: MenuId.ChatCodeBlock,\n\t\t\t\t\tgroup: 'navigation',\n\t\t\t\t\twhen: ContextKeyExpr.and(\n\t\t\t\t\t\tChatContextKeys.inChatSession,\n\t\t\t\t\t\tContextKeyExpr.or(...shellLangIds.map(e => ContextKeyExpr.equals(EditorContextKeys.languageId.key, e)))\n\t\t\t\t\t),\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tid: MenuId.ChatCodeBlock,\n\t\t\t\t\tgroup: 'navigation',\n\t\t\t\t\tisHiddenByDefault: true,\n\t\t\t\t\twhen: ContextKeyExpr.and(\n\t\t\t\t\t\tChatContextKeys.inChatSession,\n\t\t\t\t\t\t...shellLangIds.map(e => ContextKeyExpr.notEquals(EditorContextKeys.languageId.key, e))\n\t\t\t\t\t)\n\t\t\t\t}],\n\t\t\t\tkeybinding: [{\n\t\t\t\t\tprimary: KeyMod.CtrlCmd | KeyMod.Alt | KeyCode.Enter,\n\t\t\t\t\tmac: {\n\t\t\t\t\t\tprimary: KeyMod.WinCtrl | KeyMod.Alt | KeyCode.Enter\n\t\t\t\t\t},\n\t\t\t\t\tweight: KeybindingWeight.EditorContrib,\n\t\t\t\t\twhen: ContextKeyExpr.or(ChatContextKeys.inChatSession, accessibleViewInCodeBlock),\n\t\t\t\t}]\n\t\t\t});\n\t\t}\n\n\t\toverride async runWithContext(accessor: ServicesAccessor, context: ICodeBlockActionContext) {\n\t\t\tif (isResponseFiltered(context)) {\n\t\t\t\t// When run from command palette\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst chatService = accessor.get(IChatService);\n\t\t\tconst terminalService = accessor.get(ITerminalService);\n\t\t\tconst editorService = accessor.get(IEditorService);\n\t\t\tconst terminalEditorService = accessor.get(ITerminalEditorService);\n\t\t\tconst terminalGroupService = accessor.get(ITerminalGroupService);\n\n\t\t\tlet terminal = await terminalService.getActiveOrCreateInstance();\n\n\t\t\t// isFeatureTerminal = debug terminal or task terminal\n\t\t\tconst unusableTerminal = terminal.xterm?.isStdinDisabled || terminal.shellLaunchConfig.isFeatureTerminal;\n\t\t\tterminal = unusableTerminal ? await terminalService.createTerminal() : terminal;\n\n\t\t\tterminalService.setActiveInstance(terminal);\n\t\t\tawait terminal.focusWhenReady(true);\n\t\t\tif (terminal.target === TerminalLocation.Editor) {\n\t\t\t\tconst existingEditors = editorService.findEditors(terminal.resource);\n\t\t\t\tterminalEditorService.openEditor(terminal, { viewColumn: existingEditors?.[0].groupId });\n\t\t\t} else {\n\t\t\t\tterminalGroupService.showPanel(true);\n\t\t\t}\n\n\t\t\tterminal.runCommand(context.code, false);\n\n\t\t\tif (isResponseVM(context.element)) {\n\t\t\t\tchatService.notifyUserAction({\n\t\t\t\t\tagentId: context.element.agent?.id,\n\t\t\t\t\tcommand: context.element.slashCommand?.name,\n\t\t\t\t\tsessionResource: context.element.sessionResource,\n\t\t\t\t\trequestId: context.element.requestId,\n\t\t\t\t\tresult: context.element.result,\n\t\t\t\t\taction: {\n\t\t\t\t\t\tkind: 'runInTerminal',\n\t\t\t\t\t\tcodeBlockIndex: context.codeBlockIndex,\n\t\t\t\t\t\tlanguageId: context.languageId,\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t});\n\n\tfunction navigateCodeBlocks(accessor: ServicesAccessor, reverse?: boolean): void {\n\t\tconst codeEditorService = accessor.get(ICodeEditorService);\n\t\tconst chatWidgetService = accessor.get(IChatWidgetService);\n\t\tconst widget = chatWidgetService.lastFocusedWidget;\n\t\tif (!widget) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst editor = codeEditorService.getFocusedCodeEditor();\n\t\tconst editorUri = editor?.getModel()?.uri;\n\t\tconst curCodeBlockInfo = editorUri ? widget.getCodeBlockInfoForEditor(editorUri) : undefined;\n\t\tconst focused = !widget.inputEditor.hasWidgetFocus() && widget.getFocus();\n\t\tconst focusedResponse = isResponseVM(focused) ? focused : undefined;\n\n\t\tconst elementId = curCodeBlockInfo?.elementId;\n\t\tconst element = elementId ? widget.viewModel?.getItems().find(item => item.id === elementId) : undefined;\n\t\tconst currentResponse = element ??\n\t\t\t(focusedResponse ?? widget.viewModel?.getItems().reverse().find((item): item is IChatResponseViewModel => isResponseVM(item)));\n\t\tif (!currentResponse || !isResponseVM(currentResponse)) {\n\t\t\treturn;\n\t\t}\n\n\t\twidget.reveal(currentResponse);\n\t\tconst responseCodeblocks = widget.getCodeBlockInfosForResponse(currentResponse);\n\t\tconst focusIdx = curCodeBlockInfo ?\n\t\t\t(curCodeBlockInfo.codeBlockIndex + (reverse ? -1 : 1) + responseCodeblocks.length) % responseCodeblocks.length :\n\t\t\treverse ? responseCodeblocks.length - 1 : 0;\n\n\t\tresponseCodeblocks[focusIdx]?.focus();\n\t}\n\n\tregisterAction2(class NextCodeBlockAction extends Action2 {\n\t\tconstructor() {\n\t\t\tsuper({\n\t\t\t\tid: 'workbench.action.chat.nextCodeBlock',\n\t\t\t\ttitle: localize2('interactive.nextCodeBlock.label', \"Next Code Block\"),\n\t\t\t\tkeybinding: {\n\t\t\t\t\tprimary: KeyMod.CtrlCmd | KeyMod.Alt | KeyCode.PageDown,\n\t\t\t\t\tmac: { primary: KeyMod.CtrlCmd | KeyMod.Alt | KeyCode.PageDown, },\n\t\t\t\t\tweight: KeybindingWeight.WorkbenchContrib,\n\t\t\t\t\twhen: ChatContextKeys.inChatSession,\n\t\t\t\t},\n\t\t\t\tprecondition: ChatContextKeys.enabled,\n\t\t\t\tf1: true,\n\t\t\t\tcategory: CHAT_CATEGORY,\n\t\t\t});\n\t\t}\n\n\t\trun(accessor: ServicesAccessor, ...args: unknown[]) {\n\t\t\tnavigateCodeBlocks(accessor);\n\t\t}\n\t});\n\n\tregisterAction2(class PreviousCodeBlockAction extends Action2 {\n\t\tconstructor() {\n\t\t\tsuper({\n\t\t\t\tid: 'workbench.action.chat.previousCodeBlock',\n\t\t\t\ttitle: localize2('interactive.previousCodeBlock.label', \"Previous Code Block\"),\n\t\t\t\tkeybinding: {\n\t\t\t\t\tprimary: KeyMod.CtrlCmd | KeyMod.Alt | KeyCode.PageUp,\n\t\t\t\t\tmac: { primary: KeyMod.CtrlCmd | KeyMod.Alt | KeyCode.PageUp, },\n\t\t\t\t\tweight: KeybindingWeight.WorkbenchContrib,\n\t\t\t\t\twhen: ChatContextKeys.inChatSession,\n\t\t\t\t},\n\t\t\t\tprecondition: ChatContextKeys.enabled,\n\t\t\t\tf1: true,\n\t\t\t\tcategory: CHAT_CATEGORY,\n\t\t\t});\n\t\t}\n\n\t\trun(accessor: ServicesAccessor, ...args: unknown[]) {\n\t\t\tnavigateCodeBlocks(accessor, true);\n\t\t}\n\t});\n}\n\nfunction getContextFromEditor(editor: ICodeEditor, accessor: ServicesAccessor): ICodeBlockActionContext | undefined {\n\tconst chatWidgetService = accessor.get(IChatWidgetService);\n\tconst chatCodeBlockContextProviderService = accessor.get(IChatCodeBlockContextProviderService);\n\tconst model = editor.getModel();\n\tif (!model) {\n\t\treturn;\n\t}\n\n\tconst widget = chatWidgetService.lastFocusedWidget;\n\tconst codeBlockInfo = widget?.getCodeBlockInfoForEditor(model.uri);\n\tif (!codeBlockInfo) {\n\t\tfor (const provider of chatCodeBlockContextProviderService.providers) {\n\t\t\tconst context = provider.getCodeBlockContext(editor);\n\t\t\tif (context) {\n\t\t\t\treturn context;\n\t\t\t}\n\t\t}\n\t\treturn;\n\t}\n\n\tconst element = widget?.viewModel?.getItems().find(item => item.id === codeBlockInfo.elementId);\n\treturn {\n\t\telement,\n\t\tcodeBlockIndex: codeBlockInfo.codeBlockIndex,\n\t\tcode: editor.getValue(),\n\t\tlanguageId: editor.getModel()!.getLanguageId(),\n\t\tcodemapperUri: codeBlockInfo.codemapperUri,\n\t\tchatSessionResource: codeBlockInfo.chatSessionResource,\n\t};\n}\n\nexport function registerChatCodeCompareBlockActions() {\n\n\tabstract class ChatCompareCodeBlockAction extends Action2 {\n\t\trun(accessor: ServicesAccessor, ...args: unknown[]) {\n\t\t\tconst context = args[0];\n\t\t\tif (!isCodeCompareBlockActionContext(context)) {\n\t\t\t\treturn;\n\t\t\t\t// TODO@jrieken derive context\n\t\t\t}\n\n\t\t\treturn this.runWithContext(accessor, context);\n\t\t}\n\n\t\tabstract runWithContext(accessor: ServicesAccessor, context: ICodeCompareBlockActionContext): any;\n\t}\n\n\tregisterAction2(class ApplyEditsCompareBlockAction extends ChatCompareCodeBlockAction {\n\t\tconstructor() {\n\t\t\tsuper({\n\t\t\t\tid: 'workbench.action.chat.applyCompareEdits',\n\t\t\t\ttitle: localize2('interactive.compare.apply', \"Apply Edits\"),\n\t\t\t\tf1: false,\n\t\t\t\tcategory: CHAT_CATEGORY,\n\t\t\t\ticon: Codicon.gitPullRequestGoToChanges,\n\t\t\t\tprecondition: ContextKeyExpr.and(EditorContextKeys.hasChanges, ChatContextKeys.editApplied.negate()),\n\t\t\t\tmenu: {\n\t\t\t\t\tid: MenuId.ChatCompareBlock,\n\t\t\t\t\tgroup: 'navigation',\n\t\t\t\t\torder: 1,\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tasync runWithContext(accessor: ServicesAccessor, context: ICodeCompareBlockActionContext): Promise<any> {\n\n\t\t\tconst instaService = accessor.get(IInstantiationService);\n\t\t\tconst editorService = accessor.get(ICodeEditorService);\n\n\t\t\tconst item = context.edit;\n\t\t\tconst response = context.element;\n\n\t\t\tif (item.state?.applied) {\n\t\t\t\t// already applied\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif (!response.response.value.includes(item)) {\n\t\t\t\t// bogous item\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tconst firstEdit = item.edits[0]?.[0];\n\t\t\tif (!firstEdit) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tconst textEdits = AsyncIterableObject.fromArray(item.edits);\n\n\t\t\tconst editorToApply = await editorService.openCodeEditor({ resource: item.uri }, null);\n\t\t\tif (editorToApply) {\n\t\t\t\teditorToApply.revealLineInCenterIfOutsideViewport(firstEdit.range.startLineNumber);\n\t\t\t\tinstaService.invokeFunction(reviewEdits, editorToApply, textEdits, CancellationToken.None, undefined);\n\t\t\t\tresponse.setEditApplied(item, 1);\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\treturn false;\n\t\t}\n\t});\n\n\tregisterAction2(class DiscardEditsCompareBlockAction extends ChatCompareCodeBlockAction {\n\t\tconstructor() {\n\t\t\tsuper({\n\t\t\t\tid: 'workbench.action.chat.discardCompareEdits',\n\t\t\t\ttitle: localize2('interactive.compare.discard', \"Discard Edits\"),\n\t\t\t\tf1: false,\n\t\t\t\tcategory: CHAT_CATEGORY,\n\t\t\t\ticon: Codicon.trash,\n\t\t\t\tprecondition: ContextKeyExpr.and(EditorContextKeys.hasChanges, ChatContextKeys.editApplied.negate()),\n\t\t\t\tmenu: {\n\t\t\t\t\tid: MenuId.ChatCompareBlock,\n\t\t\t\t\tgroup: 'navigation',\n\t\t\t\t\torder: 2,\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tasync runWithContext(accessor: ServicesAccessor, context: ICodeCompareBlockActionContext): Promise<any> {\n\t\t\tconst instaService = accessor.get(IInstantiationService);\n\t\t\tconst editor = instaService.createInstance(DefaultChatTextEditor);\n\t\t\teditor.discard(context.element, context.edit);\n\t\t}\n\t});\n}\n"]}