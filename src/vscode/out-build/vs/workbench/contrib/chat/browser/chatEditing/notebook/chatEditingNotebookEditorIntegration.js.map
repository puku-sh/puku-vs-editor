{"version":3,"sources":["vs/workbench/contrib/chat/browser/chatEditing/notebook/chatEditingNotebookEditorIntegration.ts"],"names":[],"mappings":"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","file":"chatEditingNotebookEditorIntegration.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { ActionViewItem } from '../../../../../../base/browser/ui/actionbar/actionViewItems.js';\nimport { Disposable, IDisposable, toDisposable } from '../../../../../../base/common/lifecycle.js';\nimport { autorun, debouncedObservable, IObservable, ISettableObservable, observableFromEvent, observableValue } from '../../../../../../base/common/observable.js';\nimport { basename } from '../../../../../../base/common/resources.js';\nimport { assertType } from '../../../../../../base/common/types.js';\nimport { Range } from '../../../../../../editor/common/core/range.js';\nimport { LineRange } from '../../../../../../editor/common/core/ranges/lineRange.js';\nimport { nullDocumentDiff } from '../../../../../../editor/common/diff/documentDiffProvider.js';\nimport { PrefixSumComputer } from '../../../../../../editor/common/model/prefixSumComputer.js';\nimport { localize } from '../../../../../../nls.js';\nimport { AccessibilitySignal, IAccessibilitySignalService } from '../../../../../../platform/accessibilitySignal/browser/accessibilitySignalService.js';\nimport { MenuId } from '../../../../../../platform/actions/common/actions.js';\nimport { IInstantiationService } from '../../../../../../platform/instantiation/common/instantiation.js';\nimport { ILogService } from '../../../../../../platform/log/common/log.js';\nimport { IEditorPane, IResourceDiffEditorInput } from '../../../../../common/editor.js';\nimport { IEditorService } from '../../../../../services/editor/common/editorService.js';\nimport { NotebookDeletedCellDecorator } from '../../../../notebook/browser/diff/inlineDiff/notebookDeletedCellDecorator.js';\nimport { NotebookInsertedCellDecorator } from '../../../../notebook/browser/diff/inlineDiff/notebookInsertedCellDecorator.js';\nimport { NotebookModifiedCellDecorator } from '../../../../notebook/browser/diff/inlineDiff/notebookModifiedCellDecorator.js';\nimport { INotebookTextDiffEditor } from '../../../../notebook/browser/diff/notebookDiffEditorBrowser.js';\nimport { CellEditState, getNotebookEditorFromEditorPane, ICellViewModel, INotebookEditor } from '../../../../notebook/browser/notebookBrowser.js';\nimport { INotebookEditorService } from '../../../../notebook/browser/services/notebookEditorService.js';\nimport { NotebookCellTextModel } from '../../../../notebook/common/model/notebookCellTextModel.js';\nimport { NotebookTextModel } from '../../../../notebook/common/model/notebookTextModel.js';\nimport { CellKind } from '../../../../notebook/common/notebookCommon.js';\nimport { IModifiedFileEntryChangeHunk, IModifiedFileEntryEditorIntegration } from '../../../common/chatEditingService.js';\nimport { ChatEditingCodeEditorIntegration, IDocumentDiff2 } from '../chatEditingCodeEditorIntegration.js';\nimport { ChatEditingModifiedNotebookEntry } from '../chatEditingModifiedNotebookEntry.js';\nimport { countChanges, ICellDiffInfo, sortCellChanges } from './notebookCellChanges.js';\nimport { OverlayToolbarDecorator } from './overlayToolbarDecorator.js';\n\nexport class ChatEditingNotebookEditorIntegration extends Disposable implements IModifiedFileEntryEditorIntegration {\n\tprivate integration: ChatEditingNotebookEditorWidgetIntegration;\n\tprivate notebookEditor: INotebookEditor;\n\tconstructor(\n\t\t_entry: ChatEditingModifiedNotebookEntry,\n\t\teditor: IEditorPane,\n\t\tnotebookModel: NotebookTextModel,\n\t\toriginalModel: NotebookTextModel,\n\t\tcellChanges: IObservable<ICellDiffInfo[]>,\n\t\t@IInstantiationService private readonly instantiationService: IInstantiationService,\n\t) {\n\t\tsuper();\n\n\t\tconst notebookEditor = getNotebookEditorFromEditorPane(editor);\n\t\tassertType(notebookEditor);\n\t\tthis.notebookEditor = notebookEditor;\n\t\tthis.integration = this.instantiationService.createInstance(ChatEditingNotebookEditorWidgetIntegration, _entry, notebookEditor, notebookModel, originalModel, cellChanges);\n\t\tthis._register(editor.onDidChangeControl(() => {\n\t\t\tconst notebookEditor = getNotebookEditorFromEditorPane(editor);\n\t\t\tif (notebookEditor && notebookEditor !== this.notebookEditor) {\n\t\t\t\tthis.notebookEditor = notebookEditor;\n\t\t\t\tthis.integration.dispose();\n\t\t\t\tthis.integration = this.instantiationService.createInstance(ChatEditingNotebookEditorWidgetIntegration, _entry, notebookEditor, notebookModel, originalModel, cellChanges);\n\t\t\t}\n\t\t}));\n\t}\n\tpublic get currentIndex(): IObservable<number> {\n\t\treturn this.integration.currentIndex;\n\t}\n\treveal(firstOrLast: boolean): void {\n\t\treturn this.integration.reveal(firstOrLast);\n\t}\n\tnext(wrap: boolean): boolean {\n\t\treturn this.integration.next(wrap);\n\t}\n\tprevious(wrap: boolean): boolean {\n\t\treturn this.integration.previous(wrap);\n\t}\n\tenableAccessibleDiffView(): void {\n\t\tthis.integration.enableAccessibleDiffView();\n\t}\n\tacceptNearestChange(change: IModifiedFileEntryChangeHunk | undefined): Promise<void> {\n\t\treturn this.integration.acceptNearestChange(change);\n\t}\n\trejectNearestChange(change: IModifiedFileEntryChangeHunk | undefined): Promise<void> {\n\t\treturn this.integration.rejectNearestChange(change);\n\t}\n\ttoggleDiff(change: IModifiedFileEntryChangeHunk | undefined, show?: boolean): Promise<void> {\n\t\treturn this.integration.toggleDiff(change, show);\n\t}\n\n\tpublic override dispose(): void {\n\t\tthis.integration.dispose();\n\t\tsuper.dispose();\n\t}\n}\n\nclass ChatEditingNotebookEditorWidgetIntegration extends Disposable implements IModifiedFileEntryEditorIntegration {\n\tprivate readonly _currentIndex = observableValue(this, -1);\n\treadonly currentIndex: IObservable<number> = this._currentIndex;\n\n\tprivate deletedCellDecorator: NotebookDeletedCellDecorator | undefined;\n\tprivate insertedCellDecorator: NotebookInsertedCellDecorator | undefined;\n\tprivate modifiedCellDecorator: NotebookModifiedCellDecorator | undefined;\n\tprivate overlayToolbarDecorator: OverlayToolbarDecorator | undefined;\n\n\tprivate readonly cellEditorIntegrations = new Map<NotebookCellTextModel, { integration: ChatEditingCodeEditorIntegration; diff: ISettableObservable<IDocumentDiff2> }>();\n\n\tprivate readonly markdownEditState = observableValue<string>(this, '');\n\n\tprivate markupCellListeners = new Map<number, IDisposable>();\n\n\tprivate sortedCellChanges: ICellDiffInfo[] = [];\n\tprivate changeIndexComputer: PrefixSumComputer = new PrefixSumComputer(new Uint32Array(0));\n\n\tconstructor(\n\t\tprivate readonly _entry: ChatEditingModifiedNotebookEntry,\n\t\tprivate readonly notebookEditor: INotebookEditor,\n\t\tprivate readonly notebookModel: NotebookTextModel,\n\t\toriginalModel: NotebookTextModel,\n\t\tprivate readonly cellChanges: IObservable<ICellDiffInfo[]>,\n\t\t@IInstantiationService private readonly instantiationService: IInstantiationService,\n\t\t@IEditorService private readonly _editorService: IEditorService,\n\t\t@INotebookEditorService notebookEditorService: INotebookEditorService,\n\t\t@IAccessibilitySignalService private readonly accessibilitySignalService: IAccessibilitySignalService,\n\t\t@ILogService private readonly logService: ILogService,\n\t) {\n\t\tsuper();\n\n\t\tconst onDidChangeVisibleRanges = debouncedObservable(observableFromEvent(notebookEditor.onDidChangeVisibleRanges, () => notebookEditor.visibleRanges), 50);\n\n\t\tthis._register(toDisposable(() => {\n\t\t\tthis.markupCellListeners.forEach((v) => v.dispose());\n\t\t}));\n\n\t\tlet originalReadonly: boolean | undefined = undefined;\n\t\tconst shouldBeReadonly = _entry.isCurrentlyBeingModifiedBy.map(value => !!value);\n\t\tthis._register(autorun(r => {\n\t\t\tconst isReadOnly = shouldBeReadonly.read(r);\n\t\t\tconst notebookEditor = notebookEditorService.retrieveExistingWidgetFromURI(_entry.modifiedURI)?.value;\n\t\t\tif (!notebookEditor) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (isReadOnly) {\n\t\t\t\toriginalReadonly ??= notebookEditor.isReadOnly;\n\t\t\t\tnotebookEditor.setOptions({ isReadOnly: true });\n\t\t\t} else if (originalReadonly === false) {\n\t\t\t\tnotebookEditor.setOptions({ isReadOnly: false });\n\t\t\t\t// Ensure all cells area editable.\n\t\t\t\t// We make use of chatEditingCodeEditorIntegration to handle cell diffing and navigation.\n\t\t\t\t// However that also makes the cell read-only. We need to ensure that the cell is editable.\n\t\t\t\t// E.g. first we make notebook readonly (in here), then cells end up being readonly because notebook is readonly.\n\t\t\t\t// Then chatEditingCodeEditorIntegration makes cells readonly and keeps track of the original readonly state.\n\t\t\t\t// However the cell is already readonly because the notebook is readonly.\n\t\t\t\t// So when we restore the notebook to editable (in here), the cell is made editable again.\n\t\t\t\t// But when chatEditingCodeEditorIntegration attempts to restore, it will restore the original readonly state.\n\t\t\t\t// & from the perpspective of chatEditingCodeEditorIntegration, the cell was readonly & should continue to be readonly.\n\t\t\t\t// To get around this, we wait for a few ms before restoring the original readonly state for each cell.\n\t\t\t\tconst timeout = setTimeout(() => {\n\t\t\t\t\tnotebookEditor.setOptions({ isReadOnly: true });\n\t\t\t\t\tnotebookEditor.setOptions({ isReadOnly: false });\n\t\t\t\t\tdisposable.dispose();\n\t\t\t\t}, 100);\n\t\t\t\tconst disposable = toDisposable(() => clearTimeout(timeout));\n\t\t\t\tr.store.add(disposable);\n\t\t\t}\n\t\t}));\n\n\t\t// INIT when not streaming nor diffing the response anymore, once per request, and when having changes\n\t\tlet lastModifyingRequestId: string | undefined;\n\t\tthis._store.add(autorun(r => {\n\n\t\t\tif (!_entry.isCurrentlyBeingModifiedBy.read(r)\n\t\t\t\t&& !_entry.isProcessingResponse.read(r)\n\t\t\t\t&& lastModifyingRequestId !== _entry.lastModifyingRequestId\n\t\t\t\t&& cellChanges.read(r).some(c => c.type !== 'unchanged' && !c.diff.read(r).identical)\n\t\t\t) {\n\t\t\t\tlastModifyingRequestId = _entry.lastModifyingRequestId;\n\t\t\t\t// Check if any of the changes are visible, if not, reveal the first change.\n\t\t\t\tconst visibleChange = this.sortedCellChanges.find(c => {\n\t\t\t\t\tif (c.type === 'unchanged') {\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t\tconst index = c.modifiedCellIndex ?? c.originalCellIndex;\n\t\t\t\t\treturn this.notebookEditor.visibleRanges.some(range => index >= range.start && index < range.end);\n\t\t\t\t});\n\n\t\t\t\tif (!visibleChange) {\n\t\t\t\t\tthis.reveal(true);\n\t\t\t\t}\n\t\t\t}\n\t\t}));\n\n\t\tthis._register(autorun(r => {\n\t\t\tthis.sortedCellChanges = sortCellChanges(cellChanges.read(r));\n\t\t\tconst indexes: number[] = [];\n\t\t\tfor (const change of this.sortedCellChanges) {\n\t\t\t\tindexes.push(change.type === 'insert' || change.type === 'delete' ? 1\n\t\t\t\t\t: change.type === 'modified' ? change.diff.read(r).changes.length\n\t\t\t\t\t\t: 0);\n\t\t\t}\n\n\t\t\tthis.changeIndexComputer = new PrefixSumComputer(new Uint32Array(indexes));\n\t\t\tif (this.changeIndexComputer.getTotalSum() === 0) {\n\t\t\t\tthis.revertMarkupCellState();\n\t\t\t}\n\t\t}));\n\n\t\t// Build cell integrations (responsible for navigating changes within a cell and decorating cell text changes)\n\t\tthis._register(autorun(r => {\n\t\t\tif (this.notebookEditor.textModel !== this.notebookModel) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst sortedCellChanges = sortCellChanges(cellChanges.read(r));\n\n\t\t\tconst changes = sortedCellChanges.filter(c => c.type !== 'delete');\n\t\t\tonDidChangeVisibleRanges.read(r);\n\t\t\tif (!changes.length) {\n\t\t\t\tthis.cellEditorIntegrations.forEach(({ diff }) => {\n\t\t\t\t\tdiff.set({ ...diff.read(undefined), ...nullDocumentDiff }, undefined);\n\t\t\t\t});\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis.markdownEditState.read(r);\n\n\t\t\tconst validCells = new Set<NotebookCellTextModel>();\n\t\t\tchanges.forEach((change) => {\n\t\t\t\tif (change.modifiedCellIndex === undefined || change.modifiedCellIndex >= notebookModel.cells.length) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tconst cell = notebookModel.cells[change.modifiedCellIndex];\n\t\t\t\tconst editor = notebookEditor.codeEditors.find(([vm,]) => vm.handle === notebookModel.cells[change.modifiedCellIndex].handle)?.[1];\n\t\t\t\tconst modifiedModel = change.modifiedModel.promiseResult.read(r)?.data;\n\t\t\t\tconst originalModel = change.originalModel.promiseResult.read(r)?.data;\n\t\t\t\tif (!cell || !originalModel || !modifiedModel) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tif (cell.cellKind === CellKind.Markup && !this.markupCellListeners.has(cell.handle)) {\n\t\t\t\t\tconst cellModel = this.notebookEditor.getViewModel()?.viewCells.find(c => c.handle === cell.handle);\n\t\t\t\t\tif (cellModel) {\n\t\t\t\t\t\tconst listener = cellModel.onDidChangeState((e) => {\n\t\t\t\t\t\t\tif (e.editStateChanged) {\n\t\t\t\t\t\t\t\tsetTimeout(() => this.markdownEditState.set(cellModel.handle + '-' + cellModel.getEditState(), undefined), 0);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t\tthis.markupCellListeners.set(cell.handle, listener);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (!editor) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tconst diff = {\n\t\t\t\t\t...change.diff.read(r),\n\t\t\t\t\tmodifiedModel,\n\t\t\t\t\toriginalModel,\n\t\t\t\t\tkeep: change.keep,\n\t\t\t\t\tundo: change.undo\n\t\t\t\t} satisfies IDocumentDiff2;\n\t\t\t\tvalidCells.add(cell);\n\t\t\t\tconst currentDiff = this.cellEditorIntegrations.get(cell);\n\t\t\t\tif (currentDiff) {\n\t\t\t\t\t// Do not unnecessarily trigger a change event\n\t\t\t\t\tif (!areDocumentDiff2Equal(currentDiff.diff.read(undefined), diff)) {\n\t\t\t\t\t\tcurrentDiff.diff.set(diff, undefined);\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tconst diff2 = observableValue(`diff${cell.handle}`, diff);\n\t\t\t\t\tconst integration = this.instantiationService.createInstance(ChatEditingCodeEditorIntegration, _entry, editor, diff2, true);\n\t\t\t\t\tthis.cellEditorIntegrations.set(cell, { integration, diff: diff2 });\n\t\t\t\t\tthis._register(integration);\n\t\t\t\t\tthis._register(editor.onDidDispose(() => {\n\t\t\t\t\t\tthis.cellEditorIntegrations.get(cell)?.integration.dispose();\n\t\t\t\t\t\tthis.cellEditorIntegrations.delete(cell);\n\t\t\t\t\t}));\n\t\t\t\t\tthis._register(editor.onDidChangeModel(() => {\n\t\t\t\t\t\tif (editor.getModel() !== cell.textModel) {\n\t\t\t\t\t\t\tthis.cellEditorIntegrations.get(cell)?.integration.dispose();\n\t\t\t\t\t\t\tthis.cellEditorIntegrations.delete(cell);\n\t\t\t\t\t\t}\n\t\t\t\t\t}));\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t// Dispose old integrations as the editors are no longer valid.\n\t\t\tthis.cellEditorIntegrations.forEach((v, cell) => {\n\t\t\t\tif (!validCells.has(cell)) {\n\t\t\t\t\tv.integration.dispose();\n\t\t\t\t\tthis.cellEditorIntegrations.delete(cell);\n\t\t\t\t}\n\t\t\t});\n\t\t}));\n\n\t\tconst cellsAreVisible = onDidChangeVisibleRanges.map(v => v.length > 0);\n\t\tconst debouncedChanges = debouncedObservable(cellChanges, 10);\n\t\tthis._register(autorun(r => {\n\t\t\tif (this.notebookEditor.textModel !== this.notebookModel || !cellsAreVisible.read(r) || !this.notebookEditor.getViewModel()) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t// We can have inserted cells that have been accepted, in those cases we do not want any decorators on them.\n\t\t\tconst changes = debouncedChanges.read(r).filter(c => c.type === 'insert' ? !c.diff.read(r).identical : true);\n\t\t\tconst modifiedChanges = changes.filter(c => c.type === 'modified');\n\n\t\t\tthis.createDecorators();\n\t\t\t// If all cells are just inserts, then no need to show any decorations.\n\t\t\tif (changes.every(c => c.type === 'insert')) {\n\t\t\t\tthis.insertedCellDecorator?.apply([]);\n\t\t\t\tthis.modifiedCellDecorator?.apply([]);\n\t\t\t\tthis.deletedCellDecorator?.apply([], originalModel);\n\t\t\t\tthis.overlayToolbarDecorator?.decorate([]);\n\t\t\t} else {\n\t\t\t\tthis.insertedCellDecorator?.apply(changes);\n\t\t\t\tthis.modifiedCellDecorator?.apply(modifiedChanges);\n\t\t\t\tthis.deletedCellDecorator?.apply(changes, originalModel);\n\t\t\t\tthis.overlayToolbarDecorator?.decorate(changes.filter(c => c.type === 'insert' || c.type === 'modified'));\n\t\t\t}\n\t\t}));\n\t}\n\n\tprivate getCurrentChange() {\n\t\tconst currentIndex = Math.min(this._currentIndex.get(), this.changeIndexComputer.getTotalSum() - 1);\n\t\tconst index = this.changeIndexComputer.getIndexOf(currentIndex);\n\t\tconst change = this.sortedCellChanges[index.index];\n\n\t\treturn change ? { change, index: index.remainder } : undefined;\n\t}\n\n\tprivate updateCurrentIndex(change: ICellDiffInfo, indexInCell: number = 0) {\n\t\tconst index = this.sortedCellChanges.indexOf(change);\n\t\tconst changeIndex = this.changeIndexComputer.getPrefixSum(index - 1);\n\t\tconst currentIndex = Math.min(changeIndex + indexInCell, this.changeIndexComputer.getTotalSum() - 1);\n\t\tthis._currentIndex.set(currentIndex, undefined);\n\t}\n\n\tprivate createDecorators() {\n\t\tconst cellChanges = this.cellChanges.get();\n\t\tconst accessibilitySignalService = this.accessibilitySignalService;\n\n\t\tthis.insertedCellDecorator ??= this._register(this.instantiationService.createInstance(NotebookInsertedCellDecorator, this.notebookEditor));\n\t\tthis.modifiedCellDecorator ??= this._register(this.instantiationService.createInstance(NotebookModifiedCellDecorator, this.notebookEditor));\n\t\tthis.overlayToolbarDecorator ??= this._register(this.instantiationService.createInstance(OverlayToolbarDecorator, this.notebookEditor, this.notebookModel));\n\n\t\tif (this.deletedCellDecorator) {\n\t\t\tthis._store.delete(this.deletedCellDecorator);\n\t\t\tthis.deletedCellDecorator.dispose();\n\t\t}\n\t\tthis.deletedCellDecorator = this._register(this.instantiationService.createInstance(NotebookDeletedCellDecorator, this.notebookEditor, {\n\t\t\tclassName: 'chat-diff-change-content-widget',\n\t\t\ttelemetrySource: 'chatEditingNotebookHunk',\n\t\t\tmenuId: MenuId.ChatEditingEditorHunk,\n\t\t\tactionViewItemProvider: (action, options) => {\n\t\t\t\tif (!action.class) {\n\t\t\t\t\treturn new class extends ActionViewItem {\n\t\t\t\t\t\tconstructor() {\n\t\t\t\t\t\t\tsuper(undefined, action, { ...options, keybindingNotRenderedWithLabel: true /* hide keybinding for actions without icon */, icon: false, label: true });\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t\treturn undefined;\n\t\t\t},\n\t\t\targFactory: (deletedCellIndex: number) => {\n\t\t\t\treturn {\n\t\t\t\t\taccept() {\n\t\t\t\t\t\tconst entry = cellChanges.find(c => c.type === 'delete' && c.originalCellIndex === deletedCellIndex);\n\t\t\t\t\t\tif (entry) {\n\t\t\t\t\t\t\treturn entry.keep(entry.diff.get().changes[0]);\n\t\t\t\t\t\t}\n\t\t\t\t\t\taccessibilitySignalService.playSignal(AccessibilitySignal.editsKept, { allowManyInParallel: true });\n\t\t\t\t\t\treturn Promise.resolve(true);\n\t\t\t\t\t},\n\t\t\t\t\treject() {\n\t\t\t\t\t\tconst entry = cellChanges.find(c => c.type === 'delete' && c.originalCellIndex === deletedCellIndex);\n\t\t\t\t\t\tif (entry) {\n\t\t\t\t\t\t\treturn entry.undo(entry.diff.get().changes[0]);\n\t\t\t\t\t\t}\n\t\t\t\t\t\taccessibilitySignalService.playSignal(AccessibilitySignal.editsUndone, { allowManyInParallel: true });\n\t\t\t\t\t\treturn Promise.resolve(true);\n\t\t\t\t\t},\n\t\t\t\t} satisfies IModifiedFileEntryChangeHunk;\n\t\t\t}\n\t\t}));\n\t}\n\n\tgetCell(modifiedCellIndex: number) {\n\t\tconst cell = this.notebookModel.cells[modifiedCellIndex];\n\t\tconst integration = this.cellEditorIntegrations.get(cell)?.integration;\n\t\treturn integration;\n\t}\n\n\treveal(firstOrLast: boolean): void {\n\t\tconst changes = this.sortedCellChanges.filter(c => c.type !== 'unchanged');\n\t\tif (!changes.length) {\n\t\t\treturn;\n\t\t}\n\t\tconst change = firstOrLast ? changes[0] : changes[changes.length - 1];\n\t\tthis._revealFirstOrLast(change, firstOrLast);\n\t}\n\n\tprivate _revealFirstOrLast(change: ICellDiffInfo, firstOrLast: boolean = true) {\n\t\tswitch (change.type) {\n\t\t\tcase 'insert':\n\t\t\tcase 'modified':\n\t\t\t\t{\n\t\t\t\t\tthis.blur(this.getCurrentChange()?.change);\n\t\t\t\t\tconst index = firstOrLast || change.type === 'insert' ? 0 : change.diff.get().changes.length - 1;\n\t\t\t\t\treturn this._revealChange(change, index);\n\t\t\t\t}\n\t\t\tcase 'delete':\n\t\t\t\tthis.blur(this.getCurrentChange()?.change);\n\t\t\t\t// reveal the deleted cell decorator\n\t\t\t\tthis.deletedCellDecorator?.reveal(change.originalCellIndex);\n\t\t\t\tthis.updateCurrentIndex(change);\n\t\t\t\treturn true;\n\t\t\tdefault:\n\t\t\t\tbreak;\n\t\t}\n\n\t\treturn false;\n\t}\n\n\tprivate _revealChange(change: ICellDiffInfo, indexInCell: number) {\n\t\tswitch (change.type) {\n\t\t\tcase 'insert':\n\t\t\tcase 'modified':\n\t\t\t\t{\n\t\t\t\t\tconst textChange = change.diff.get().changes[indexInCell];\n\t\t\t\t\tconst cellViewModel = this.getCellViewModel(change);\n\t\t\t\t\tif (cellViewModel) {\n\t\t\t\t\t\tthis.updateCurrentIndex(change, indexInCell);\n\t\t\t\t\t\tthis.revealChangeInView(cellViewModel, textChange?.modified, change)\n\t\t\t\t\t\t\t.catch(err => { this.logService.warn(`Error revealing change in view: ${err}`); });\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\tcase 'delete':\n\t\t\t\tthis.updateCurrentIndex(change);\n\t\t\t\t// reveal the deleted cell decorator\n\t\t\t\tthis.deletedCellDecorator?.reveal(change.originalCellIndex);\n\t\t\t\treturn true;\n\t\t\tdefault:\n\t\t\t\tbreak;\n\t\t}\n\n\t\treturn false;\n\t}\n\n\tprivate getCellViewModel(change: ICellDiffInfo) {\n\t\tif (change.type === 'delete' || change.modifiedCellIndex === undefined || change.modifiedCellIndex >= this.notebookModel.cells.length) {\n\t\t\treturn undefined;\n\t\t}\n\t\tconst cell = this.notebookModel.cells[change.modifiedCellIndex];\n\t\tconst cellViewModel = this.notebookEditor.getViewModel()?.viewCells.find(c => c.handle === cell.handle);\n\t\treturn cellViewModel;\n\t}\n\n\tprivate async revealChangeInView(cell: ICellViewModel, lines: LineRange | undefined, change: ICellDiffInfo): Promise<void> {\n\t\tconst targetLines = lines ?? new LineRange(0, 0);\n\t\tif (change.type === 'modified' && cell.cellKind === CellKind.Markup && cell.getEditState() === CellEditState.Preview) {\n\t\t\tcell.updateEditState(CellEditState.Editing, 'chatEditNavigation');\n\t\t}\n\n\t\tconst focusTarget = cell.cellKind === CellKind.Code || change.type === 'modified' ? 'editor' : 'container';\n\t\tawait this.notebookEditor.focusNotebookCell(cell, focusTarget, { focusEditorLine: targetLines.startLineNumber });\n\t\tawait this.notebookEditor.revealRangeInCenterAsync(cell, new Range(targetLines.startLineNumber, 0, targetLines.endLineNumberExclusive, 0));\n\t}\n\n\tprivate revertMarkupCellState() {\n\t\tfor (const change of this.sortedCellChanges) {\n\t\t\tconst cellViewModel = this.getCellViewModel(change);\n\t\t\tif (cellViewModel?.cellKind === CellKind.Markup && cellViewModel.getEditState() === CellEditState.Editing &&\n\t\t\t\t(cellViewModel.editStateSource === 'chatEditNavigation' || cellViewModel.editStateSource === 'chatEdit')) {\n\t\t\t\tcellViewModel.updateEditState(CellEditState.Preview, 'chatEdit');\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate blur(change: ICellDiffInfo | undefined) {\n\t\tif (!change) {\n\t\t\treturn;\n\t\t}\n\t\tconst cellViewModel = this.getCellViewModel(change);\n\t\tif (cellViewModel?.cellKind === CellKind.Markup && cellViewModel.getEditState() === CellEditState.Editing && cellViewModel.editStateSource === 'chatEditNavigation') {\n\t\t\tcellViewModel.updateEditState(CellEditState.Preview, 'chatEditNavigation');\n\t\t}\n\t}\n\n\tnext(wrap: boolean): boolean {\n\t\tconst changes = this.sortedCellChanges.filter(c => c.type !== 'unchanged');\n\t\tconst currentChange = this.getCurrentChange();\n\t\tif (!currentChange) {\n\t\t\tconst firstChange = changes[0];\n\n\t\t\tif (firstChange) {\n\t\t\t\treturn this._revealFirstOrLast(firstChange);\n\t\t\t}\n\n\t\t\treturn false;\n\t\t}\n\n\t\t// go to next\n\t\t// first check if we are at the end of the current change\n\t\tswitch (currentChange.change.type) {\n\t\t\tcase 'modified':\n\t\t\t\t{\n\t\t\t\t\tconst cellIntegration = this.getCell(currentChange.change.modifiedCellIndex);\n\t\t\t\t\tif (cellIntegration) {\n\t\t\t\t\t\tif (cellIntegration.next(false)) {\n\t\t\t\t\t\t\tthis.updateCurrentIndex(currentChange.change, cellIntegration.currentIndex.get());\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tconst isLastChangeInCell = currentChange.index >= lastChangeIndex(currentChange.change);\n\t\t\t\t\tconst index = isLastChangeInCell ? 0 : currentChange.index + 1;\n\t\t\t\t\tconst change = isLastChangeInCell ? changes[changes.indexOf(currentChange.change) + 1] : currentChange.change;\n\n\t\t\t\t\tif (change) {\n\t\t\t\t\t\tif (isLastChangeInCell) {\n\t\t\t\t\t\t\tthis.blur(currentChange.change);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (this._revealChange(change, index)) {\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 'insert':\n\t\t\tcase 'delete':\n\t\t\t\t{\n\t\t\t\t\tthis.blur(currentChange.change);\n\t\t\t\t\t// go to next change directly\n\t\t\t\t\tconst nextChange = changes[changes.indexOf(currentChange.change) + 1];\n\t\t\t\t\tif (nextChange && this._revealFirstOrLast(nextChange, true)) {\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tbreak;\n\t\t}\n\n\t\tif (wrap) {\n\t\t\tconst firstChange = changes[0];\n\t\t\tif (firstChange) {\n\t\t\t\treturn this._revealFirstOrLast(firstChange, true);\n\t\t\t}\n\t\t}\n\n\t\treturn false;\n\t}\n\n\tprevious(wrap: boolean): boolean {\n\t\tconst changes = this.sortedCellChanges.filter(c => c.type !== 'unchanged');\n\t\tconst currentChange = this.getCurrentChange();\n\t\tif (!currentChange) {\n\t\t\tconst lastChange = changes[changes.length - 1];\n\t\t\tif (lastChange) {\n\t\t\t\treturn this._revealFirstOrLast(lastChange, false);\n\t\t\t}\n\n\t\t\treturn false;\n\t\t}\n\n\t\t// go to previous\n\t\t// first check if we are at the start of the current change\n\t\tswitch (currentChange.change.type) {\n\t\t\tcase 'modified':\n\t\t\t\t{\n\t\t\t\t\tconst cellIntegration = this.getCell(currentChange.change.modifiedCellIndex);\n\t\t\t\t\tif (cellIntegration) {\n\t\t\t\t\t\tif (cellIntegration.previous(false)) {\n\t\t\t\t\t\t\tthis.updateCurrentIndex(currentChange.change, cellIntegration.currentIndex.get());\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tconst isFirstChangeInCell = currentChange.index <= 0;\n\t\t\t\t\tconst change = isFirstChangeInCell ? changes[changes.indexOf(currentChange.change) - 1] : currentChange.change;\n\n\t\t\t\t\tif (change) {\n\t\t\t\t\t\tconst index = isFirstChangeInCell ? lastChangeIndex(change) : currentChange.index - 1;\n\t\t\t\t\t\tif (isFirstChangeInCell) {\n\t\t\t\t\t\t\tthis.blur(currentChange.change);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (this._revealChange(change, index)) {\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 'insert':\n\t\t\tcase 'delete':\n\t\t\t\t{\n\t\t\t\t\tthis.blur(currentChange.change);\n\t\t\t\t\t// go to previous change directly\n\t\t\t\t\tconst prevChange = changes[changes.indexOf(currentChange.change) - 1];\n\t\t\t\t\tif (prevChange && this._revealFirstOrLast(prevChange, false)) {\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tbreak;\n\t\t}\n\n\t\tif (wrap) {\n\t\t\tconst lastChange = changes[changes.length - 1];\n\t\t\tif (lastChange) {\n\t\t\t\treturn this._revealFirstOrLast(lastChange, false);\n\t\t\t}\n\t\t}\n\n\t\treturn false;\n\t}\n\n\tenableAccessibleDiffView(): void {\n\t\tconst cell = this.notebookEditor.getActiveCell()?.model;\n\t\tif (cell) {\n\t\t\tconst integration = this.cellEditorIntegrations.get(cell)?.integration;\n\t\t\tintegration?.enableAccessibleDiffView();\n\t\t}\n\t}\n\n\tprivate getfocusedIntegration(): ChatEditingCodeEditorIntegration | undefined {\n\t\tconst first = this.notebookEditor.getSelectionViewModels()[0];\n\t\tif (first) {\n\t\t\treturn this.cellEditorIntegrations.get(first.model)?.integration;\n\t\t}\n\t\treturn undefined;\n\t}\n\n\tasync acceptNearestChange(hunk: IModifiedFileEntryChangeHunk | undefined): Promise<void> {\n\t\tif (hunk) {\n\t\t\tawait hunk.accept();\n\t\t} else {\n\t\t\tconst current = this.getCurrentChange();\n\t\t\tconst focused = this.getfocusedIntegration();\n\t\t\t// delete changes can't be focused\n\t\t\tif (current && !focused || current?.change.type === 'delete') {\n\t\t\t\tcurrent.change.keep(current?.change.diff.get().changes[current.index]);\n\t\t\t} else if (focused) {\n\t\t\t\tawait focused.acceptNearestChange();\n\t\t\t}\n\n\t\t\tthis._currentIndex.set(this._currentIndex.get() - 1, undefined);\n\t\t\tthis.next(true);\n\t\t}\n\t}\n\n\tasync rejectNearestChange(hunk: IModifiedFileEntryChangeHunk | undefined): Promise<void> {\n\t\tif (hunk) {\n\t\t\tawait hunk.reject();\n\t\t} else {\n\t\t\tconst current = this.getCurrentChange();\n\t\t\tconst focused = this.getfocusedIntegration();\n\t\t\t// delete changes can't be focused\n\t\t\tif (current && !focused || current?.change.type === 'delete') {\n\t\t\t\tcurrent.change.undo(current.change.diff.get().changes[current.index]);\n\t\t\t} else if (focused) {\n\t\t\t\tawait focused.rejectNearestChange();\n\t\t\t}\n\n\t\t\tthis._currentIndex.set(this._currentIndex.get() - 1, undefined);\n\t\t\tthis.next(true);\n\t\t}\n\n\t}\n\tasync toggleDiff(_change: IModifiedFileEntryChangeHunk | undefined, _show?: boolean): Promise<void> {\n\t\tconst diffInput: IResourceDiffEditorInput = {\n\t\t\toriginal: { resource: this._entry.originalURI },\n\t\t\tmodified: { resource: this._entry.modifiedURI },\n\t\t\tlabel: localize('diff.generic', '{0} (changes from chat)', basename(this._entry.modifiedURI))\n\t\t};\n\t\tawait this._editorService.openEditor(diffInput);\n\n\t}\n}\n\nexport class ChatEditingNotebookDiffEditorIntegration extends Disposable implements IModifiedFileEntryEditorIntegration {\n\tprivate readonly _currentIndex = observableValue(this, -1);\n\treadonly currentIndex: IObservable<number> = this._currentIndex;\n\n\tconstructor(\n\t\tprivate readonly notebookDiffEditor: INotebookTextDiffEditor,\n\t\tprivate readonly cellChanges: IObservable<ICellDiffInfo[]>\n\t) {\n\t\tsuper();\n\n\t\tthis._store.add(autorun(r => {\n\t\t\tconst index = notebookDiffEditor.currentChangedIndex.read(r);\n\t\t\tconst numberOfCellChanges = cellChanges.read(r).filter(c => !c.diff.read(r).identical);\n\t\t\tif (numberOfCellChanges.length && index >= 0 && index < numberOfCellChanges.length) {\n\t\t\t\t// Notebook Diff editor only supports navigating through changes to cells.\n\t\t\t\t// However in chat we take changes to lines in the cells into account.\n\t\t\t\t// So if we're on the second cell and first cell has 3 changes, then we're on the 4th change.\n\t\t\t\tconst changesSoFar = countChanges(numberOfCellChanges.slice(0, index + 1));\n\t\t\t\tthis._currentIndex.set(changesSoFar - 1, undefined);\n\t\t\t} else {\n\t\t\t\tthis._currentIndex.set(-1, undefined);\n\t\t\t}\n\t\t}));\n\t}\n\n\treveal(firstOrLast: boolean): void {\n\t\tconst changes = sortCellChanges(this.cellChanges.get().filter(c => c.type !== 'unchanged'));\n\t\tif (!changes.length) {\n\t\t\treturn undefined;\n\t\t}\n\t\tif (firstOrLast) {\n\t\t\tthis.notebookDiffEditor.firstChange();\n\t\t} else {\n\t\t\tthis.notebookDiffEditor.lastChange();\n\t\t}\n\t}\n\n\tnext(_wrap: boolean): boolean {\n\t\tconst changes = this.cellChanges.get().filter(c => !c.diff.get().identical).length;\n\t\tif (this.notebookDiffEditor.currentChangedIndex.get() === changes - 1) {\n\t\t\treturn false;\n\t\t}\n\t\tthis.notebookDiffEditor.nextChange();\n\t\treturn true;\n\t}\n\n\tprevious(_wrap: boolean): boolean {\n\t\tconst changes = this.cellChanges.get().filter(c => !c.diff.get().identical).length;\n\t\tif (this.notebookDiffEditor.currentChangedIndex.get() === changes - 1) {\n\t\t\treturn false;\n\t\t}\n\t\tthis.notebookDiffEditor.nextChange();\n\t\treturn true;\n\t}\n\n\tenableAccessibleDiffView(): void {\n\t\t//\n\t}\n\tasync acceptNearestChange(change: IModifiedFileEntryChangeHunk): Promise<void> {\n\t\tawait change.accept();\n\t\tthis.next(true);\n\t}\n\tasync rejectNearestChange(change: IModifiedFileEntryChangeHunk): Promise<void> {\n\t\tawait change.reject();\n\t\tthis.next(true);\n\t}\n\tasync toggleDiff(_change: IModifiedFileEntryChangeHunk | undefined, _show?: boolean): Promise<void> {\n\t\t//\n\t}\n}\n\nfunction areDocumentDiff2Equal(diff1: IDocumentDiff2, diff2: IDocumentDiff2): boolean {\n\tif (diff1.changes !== diff2.changes) {\n\t\treturn false;\n\t}\n\tif (diff1.identical !== diff2.identical) {\n\t\treturn false;\n\t}\n\tif (diff1.moves !== diff2.moves) {\n\t\treturn false;\n\t}\n\tif (diff1.originalModel !== diff2.originalModel) {\n\t\treturn false;\n\t}\n\tif (diff1.modifiedModel !== diff2.modifiedModel) {\n\t\treturn false;\n\t}\n\tif (diff1.keep !== diff2.keep) {\n\t\treturn false;\n\t}\n\tif (diff1.undo !== diff2.undo) {\n\t\treturn false;\n\t}\n\tif (diff1.quitEarly !== diff2.quitEarly) {\n\t\treturn false;\n\t}\n\treturn true;\n}\n\nfunction lastChangeIndex(change: ICellDiffInfo): number {\n\tif (change.type === 'modified') {\n\t\treturn change.diff.get().changes.length - 1;\n\t}\n\treturn 0;\n}\n"]}