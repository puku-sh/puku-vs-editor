{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/contrib/chat/browser/chatMarkdownDecorationsRenderer.ts","vs/workbench/contrib/chat/browser/chatMarkdownDecorationsRenderer.ts"],"names":[],"mappings":"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","file":"chatMarkdownDecorationsRenderer.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as dom from '../../../../base/browser/dom.js';\nimport { Button } from '../../../../base/browser/ui/button/button.js';\nimport { getDefaultHoverDelegate } from '../../../../base/browser/ui/hover/hoverDelegateFactory.js';\nimport { toErrorMessage } from '../../../../base/common/errorMessage.js';\nimport { Lazy } from '../../../../base/common/lazy.js';\nimport { DisposableStore, IDisposable } from '../../../../base/common/lifecycle.js';\nimport { URI } from '../../../../base/common/uri.js';\nimport { ICommandService } from '../../../../platform/commands/common/commands.js';\nimport { IHoverService } from '../../../../platform/hover/browser/hover.js';\nimport { IInstantiationService, ServicesAccessor } from '../../../../platform/instantiation/common/instantiation.js';\nimport { IKeybindingService } from '../../../../platform/keybinding/common/keybinding.js';\nimport { ILabelService } from '../../../../platform/label/common/label.js';\nimport { ILogService } from '../../../../platform/log/common/log.js';\nimport { asCssVariable } from '../../../../platform/theme/common/colorUtils.js';\nimport { contentRefUrl } from '../common/annotations.js';\nimport { getFullyQualifiedId, IChatAgentCommand, IChatAgentData, IChatAgentNameService, IChatAgentService } from '../common/chatAgents.js';\nimport { chatSlashCommandBackground, chatSlashCommandForeground } from '../common/chatColors.js';\nimport { chatAgentLeader, ChatRequestAgentPart, ChatRequestAgentSubcommandPart, ChatRequestDynamicVariablePart, ChatRequestSlashCommandPart, ChatRequestSlashPromptPart, ChatRequestTextPart, ChatRequestToolPart, chatSubcommandLeader, IParsedChatRequest, IParsedChatRequestPart } from '../common/chatParserTypes.js';\nimport { IChatMarkdownContent, IChatService } from '../common/chatService.js';\nimport { ILanguageModelToolsService } from '../common/languageModelToolsService.js';\nimport { IChatWidgetService } from './chat.js';\nimport { ChatAgentHover, getChatAgentHoverOptions } from './chatAgentHover.js';\nimport { IChatMarkdownAnchorService } from './chatContentParts/chatMarkdownAnchorService.js';\nimport { InlineAnchorWidget } from './chatInlineAnchorWidget.js';\nimport './media/chatInlineAnchorWidget.css';\n\n/** For rendering slash commands, variables */\nconst decorationRefUrl = `http://_vscodedecoration_`;\n\n/** For rendering agent decorations with hover */\nconst agentRefUrl = `http://_chatagent_`;\n\n/** For rendering agent decorations with hover */\nconst agentSlashRefUrl = `http://_chatslash_`;\n\nexport function agentToMarkdown(agent: IChatAgentData, isClickable: boolean, accessor: ServicesAccessor): string {\n\tconst chatAgentNameService = accessor.get(IChatAgentNameService);\n\tconst chatAgentService = accessor.get(IChatAgentService);\n\n\tconst isAllowed = chatAgentNameService.getAgentNameRestriction(agent);\n\tlet name = `${isAllowed ? agent.name : getFullyQualifiedId(agent)}`;\n\tconst isDupe = isAllowed && chatAgentService.agentHasDupeName(agent.id);\n\tif (isDupe) {\n\t\tname += ` (${agent.publisherDisplayName})`;\n\t}\n\n\tconst args: IAgentWidgetArgs = { agentId: agent.id, name, isClickable };\n\treturn `[${agent.name}](${agentRefUrl}?${encodeURIComponent(JSON.stringify(args))})`;\n}\n\ninterface IAgentWidgetArgs {\n\tagentId: string;\n\tname: string;\n\tisClickable?: boolean;\n}\n\nexport function agentSlashCommandToMarkdown(agent: IChatAgentData, command: IChatAgentCommand): string {\n\tconst text = `${chatSubcommandLeader}${command.name}`;\n\tconst args: ISlashCommandWidgetArgs = { agentId: agent.id, command: command.name };\n\treturn `[${text}](${agentSlashRefUrl}?${encodeURIComponent(JSON.stringify(args))})`;\n}\n\ninterface ISlashCommandWidgetArgs {\n\tagentId: string;\n\tcommand: string;\n}\n\nexport interface IDecorationWidgetArgs {\n\ttitle?: string;\n}\n\nexport class ChatMarkdownDecorationsRenderer {\n\n\tconstructor(\n\t\t@IKeybindingService private readonly keybindingService: IKeybindingService,\n\t\t@ILogService private readonly logService: ILogService,\n\t\t@IChatAgentService private readonly chatAgentService: IChatAgentService,\n\t\t@IInstantiationService private readonly instantiationService: IInstantiationService,\n\t\t@IHoverService private readonly hoverService: IHoverService,\n\t\t@IChatService private readonly chatService: IChatService,\n\t\t@IChatWidgetService private readonly chatWidgetService: IChatWidgetService,\n\t\t@ICommandService private readonly commandService: ICommandService,\n\t\t@ILabelService private readonly labelService: ILabelService,\n\t\t@ILanguageModelToolsService private readonly toolsService: ILanguageModelToolsService,\n\t\t@IChatMarkdownAnchorService private readonly chatMarkdownAnchorService: IChatMarkdownAnchorService,\n\t) { }\n\n\tconvertParsedRequestToMarkdown(parsedRequest: IParsedChatRequest): string {\n\t\tlet result = '';\n\t\tfor (const part of parsedRequest.parts) {\n\t\t\tif (part instanceof ChatRequestTextPart) {\n\t\t\t\tresult += part.text;\n\t\t\t} else if (part instanceof ChatRequestAgentPart) {\n\t\t\t\tresult += this.instantiationService.invokeFunction(accessor => agentToMarkdown(part.agent, false, accessor));\n\t\t\t} else {\n\t\t\t\tresult += this.genericDecorationToMarkdown(part);\n\t\t\t}\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tprivate genericDecorationToMarkdown(part: IParsedChatRequestPart): string {\n\t\tconst uri = part instanceof ChatRequestDynamicVariablePart && part.data instanceof URI ?\n\t\t\tpart.data :\n\t\t\tundefined;\n\t\tconst title = uri ? this.labelService.getUriLabel(uri, { relative: true }) :\n\t\t\tpart instanceof ChatRequestSlashCommandPart ? part.slashCommand.detail :\n\t\t\t\tpart instanceof ChatRequestAgentSubcommandPart ? part.command.description :\n\t\t\t\t\tpart instanceof ChatRequestSlashPromptPart ? part.name :\n\t\t\t\t\t\tpart instanceof ChatRequestToolPart ? (this.toolsService.getTool(part.toolId)?.userDescription) :\n\t\t\t\t\t\t\t'';\n\n\t\tconst args: IDecorationWidgetArgs = { title };\n\t\tconst text = part.text;\n\t\treturn `[${text}](${decorationRefUrl}?${encodeURIComponent(JSON.stringify(args))})`;\n\t}\n\n\twalkTreeAndAnnotateReferenceLinks(content: IChatMarkdownContent, element: HTMLElement): IDisposable {\n\t\tconst store = new DisposableStore();\n\t\t// eslint-disable-next-line no-restricted-syntax\n\t\telement.querySelectorAll('a').forEach(a => {\n\t\t\tconst href = a.getAttribute('data-href');\n\t\t\tif (href) {\n\t\t\t\tif (href.startsWith(agentRefUrl)) {\n\t\t\t\t\tlet args: IAgentWidgetArgs | undefined;\n\t\t\t\t\ttry {\n\t\t\t\t\t\targs = JSON.parse(decodeURIComponent(href.slice(agentRefUrl.length + 1)));\n\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\tthis.logService.error('Invalid chat widget render data JSON', toErrorMessage(e));\n\t\t\t\t\t}\n\n\t\t\t\t\tif (args) {\n\t\t\t\t\t\ta.replaceWith(this.renderAgentWidget(args, store));\n\t\t\t\t\t}\n\t\t\t\t} else if (href.startsWith(agentSlashRefUrl)) {\n\t\t\t\t\tlet args: ISlashCommandWidgetArgs | undefined;\n\t\t\t\t\ttry {\n\t\t\t\t\t\targs = JSON.parse(decodeURIComponent(href.slice(agentRefUrl.length + 1)));\n\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\tthis.logService.error('Invalid chat slash command render data JSON', toErrorMessage(e));\n\t\t\t\t\t}\n\n\t\t\t\t\tif (args) {\n\t\t\t\t\t\ta.replaceWith(this.renderSlashCommandWidget(a.textContent!, args, store));\n\t\t\t\t\t}\n\t\t\t\t} else if (href.startsWith(decorationRefUrl)) {\n\t\t\t\t\tlet args: IDecorationWidgetArgs | undefined;\n\t\t\t\t\ttry {\n\t\t\t\t\t\targs = JSON.parse(decodeURIComponent(href.slice(decorationRefUrl.length + 1)));\n\t\t\t\t\t} catch (e) { }\n\n\t\t\t\t\ta.replaceWith(this.renderResourceWidget(a.textContent!, args, store));\n\t\t\t\t} else if (href.startsWith(contentRefUrl)) {\n\t\t\t\t\tthis.renderFileWidget(content, href, a, store);\n\t\t\t\t} else if (href.startsWith('command:')) {\n\t\t\t\t\tthis.injectKeybindingHint(a, href, this.keybindingService);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\treturn store;\n\t}\n\n\tprivate renderAgentWidget(args: IAgentWidgetArgs, store: DisposableStore): HTMLElement {\n\t\tconst nameWithLeader = `${chatAgentLeader}${args.name}`;\n\t\tlet container: HTMLElement;\n\t\tif (args.isClickable) {\n\t\t\tcontainer = dom.$('span.chat-agent-widget');\n\t\t\tconst button = store.add(new Button(container, {\n\t\t\t\tbuttonBackground: asCssVariable(chatSlashCommandBackground),\n\t\t\t\tbuttonForeground: asCssVariable(chatSlashCommandForeground),\n\t\t\t\tbuttonHoverBackground: undefined\n\t\t\t}));\n\t\t\tbutton.label = nameWithLeader;\n\t\t\tstore.add(button.onDidClick(() => {\n\t\t\t\tconst agent = this.chatAgentService.getAgent(args.agentId);\n\t\t\t\tconst widget = this.chatWidgetService.lastFocusedWidget;\n\t\t\t\tif (!widget || !agent) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tthis.chatService.sendRequest(widget.viewModel!.sessionResource, agent.metadata.sampleRequest ?? '',\n\t\t\t\t\t{\n\t\t\t\t\t\tlocation: widget.location,\n\t\t\t\t\t\tagentId: agent.id,\n\t\t\t\t\t\tuserSelectedModelId: widget.input.currentLanguageModel,\n\t\t\t\t\t\tmodeInfo: widget.input.currentModeInfo\n\t\t\t\t\t});\n\t\t\t}));\n\t\t} else {\n\t\t\tcontainer = this.renderResourceWidget(nameWithLeader, undefined, store);\n\t\t}\n\n\t\tconst agent = this.chatAgentService.getAgent(args.agentId);\n\t\tconst hover: Lazy<ChatAgentHover> = new Lazy(() => store.add(this.instantiationService.createInstance(ChatAgentHover)));\n\t\tstore.add(this.hoverService.setupManagedHover(getDefaultHoverDelegate('element'), container, () => {\n\t\t\thover.value.setAgent(args.agentId);\n\t\t\treturn hover.value.domNode;\n\t\t}, agent && getChatAgentHoverOptions(() => agent, this.commandService)));\n\t\treturn container;\n\t}\n\n\tprivate renderSlashCommandWidget(name: string, args: ISlashCommandWidgetArgs, store: DisposableStore): HTMLElement {\n\t\tconst container = dom.$('span.chat-agent-widget.chat-command-widget');\n\t\tconst agent = this.chatAgentService.getAgent(args.agentId);\n\t\tconst button = store.add(new Button(container, {\n\t\t\tbuttonBackground: asCssVariable(chatSlashCommandBackground),\n\t\t\tbuttonForeground: asCssVariable(chatSlashCommandForeground),\n\t\t\tbuttonHoverBackground: undefined\n\t\t}));\n\t\tbutton.label = name;\n\t\tstore.add(button.onDidClick(() => {\n\t\t\tconst widget = this.chatWidgetService.lastFocusedWidget;\n\t\t\tif (!widget || !agent) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst command = agent.slashCommands.find(c => c.name === args.command);\n\t\t\tthis.chatService.sendRequest(widget.viewModel!.sessionResource, command?.sampleRequest ?? '', {\n\t\t\t\tlocation: widget.location,\n\t\t\t\tagentId: agent.id,\n\t\t\t\tslashCommand: args.command,\n\t\t\t\tuserSelectedModelId: widget.input.currentLanguageModel,\n\t\t\t\tmodeInfo: widget.input.currentModeInfo\n\t\t\t});\n\t\t}));\n\n\t\treturn container;\n\t}\n\n\tprivate renderFileWidget(content: IChatMarkdownContent, href: string, a: HTMLAnchorElement, store: DisposableStore): void {\n\t\t// TODO this can be a nicer FileLabel widget with an icon. Do a simple link for now.\n\t\tconst fullUri = URI.parse(href);\n\n\t\tconst data = content.inlineReferences?.[fullUri.path.slice(1)];\n\t\tif (!data) {\n\t\t\tthis.logService.error('Invalid chat widget render data JSON');\n\t\t\treturn;\n\t\t}\n\n\t\tconst inlineAnchor = store.add(this.instantiationService.createInstance(InlineAnchorWidget, a, data));\n\t\tstore.add(this.chatMarkdownAnchorService.register(inlineAnchor));\n\t}\n\n\tprivate renderResourceWidget(name: string, args: IDecorationWidgetArgs | undefined, store: DisposableStore): HTMLElement {\n\t\tconst container = dom.$('span.chat-resource-widget');\n\t\tconst alias = dom.$('span', undefined, name);\n\t\tif (args?.title) {\n\t\t\tstore.add(this.hoverService.setupManagedHover(getDefaultHoverDelegate('element'), container, args.title));\n\t\t}\n\n\t\tcontainer.appendChild(alias);\n\t\treturn container;\n\t}\n\n\n\tprivate injectKeybindingHint(a: HTMLAnchorElement, href: string, keybindingService: IKeybindingService): void {\n\t\tconst command = href.match(/command:([^\\)]+)/)?.[1];\n\t\tif (command) {\n\t\t\tconst kb = keybindingService.lookupKeybinding(command);\n\t\t\tif (kb) {\n\t\t\t\tconst keybinding = kb.getLabel();\n\t\t\t\tif (keybinding) {\n\t\t\t\t\ta.textContent = `${a.textContent} (${keybinding})`;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as dom from '../../../../base/browser/dom.js';\nimport { Button } from '../../../../base/browser/ui/button/button.js';\nimport { getDefaultHoverDelegate } from '../../../../base/browser/ui/hover/hoverDelegateFactory.js';\nimport { toErrorMessage } from '../../../../base/common/errorMessage.js';\nimport { Lazy } from '../../../../base/common/lazy.js';\nimport { DisposableStore, IDisposable } from '../../../../base/common/lifecycle.js';\nimport { URI } from '../../../../base/common/uri.js';\nimport { ICommandService } from '../../../../platform/commands/common/commands.js';\nimport { IHoverService } from '../../../../platform/hover/browser/hover.js';\nimport { IInstantiationService, ServicesAccessor } from '../../../../platform/instantiation/common/instantiation.js';\nimport { IKeybindingService } from '../../../../platform/keybinding/common/keybinding.js';\nimport { ILabelService } from '../../../../platform/label/common/label.js';\nimport { ILogService } from '../../../../platform/log/common/log.js';\nimport { asCssVariable } from '../../../../platform/theme/common/colorUtils.js';\nimport { contentRefUrl } from '../common/annotations.js';\nimport { getFullyQualifiedId, IChatAgentCommand, IChatAgentData, IChatAgentNameService, IChatAgentService } from '../common/chatAgents.js';\nimport { chatSlashCommandBackground, chatSlashCommandForeground } from '../common/chatColors.js';\nimport { chatAgentLeader, ChatRequestAgentPart, ChatRequestAgentSubcommandPart, ChatRequestDynamicVariablePart, ChatRequestSlashCommandPart, ChatRequestSlashPromptPart, ChatRequestTextPart, ChatRequestToolPart, chatSubcommandLeader, IParsedChatRequest, IParsedChatRequestPart } from '../common/chatParserTypes.js';\nimport { IChatMarkdownContent, IChatService } from '../common/chatService.js';\nimport { ILanguageModelToolsService } from '../common/languageModelToolsService.js';\nimport { IChatWidgetService } from './chat.js';\nimport { ChatAgentHover, getChatAgentHoverOptions } from './chatAgentHover.js';\nimport { IChatMarkdownAnchorService } from './chatContentParts/chatMarkdownAnchorService.js';\nimport { InlineAnchorWidget } from './chatInlineAnchorWidget.js';\nimport './media/chatInlineAnchorWidget.css';\n\n/** For rendering slash commands, variables */\nconst decorationRefUrl = `http://_vscodedecoration_`;\n\n/** For rendering agent decorations with hover */\nconst agentRefUrl = `http://_chatagent_`;\n\n/** For rendering agent decorations with hover */\nconst agentSlashRefUrl = `http://_chatslash_`;\n\nexport function agentToMarkdown(agent: IChatAgentData, isClickable: boolean, accessor: ServicesAccessor): string {\n\tconst chatAgentNameService = accessor.get(IChatAgentNameService);\n\tconst chatAgentService = accessor.get(IChatAgentService);\n\n\tconst isAllowed = chatAgentNameService.getAgentNameRestriction(agent);\n\tlet name = `${isAllowed ? agent.name : getFullyQualifiedId(agent)}`;\n\tconst isDupe = isAllowed && chatAgentService.agentHasDupeName(agent.id);\n\tif (isDupe) {\n\t\tname += ` (${agent.publisherDisplayName})`;\n\t}\n\n\tconst args: IAgentWidgetArgs = { agentId: agent.id, name, isClickable };\n\treturn `[${agent.name}](${agentRefUrl}?${encodeURIComponent(JSON.stringify(args))})`;\n}\n\ninterface IAgentWidgetArgs {\n\tagentId: string;\n\tname: string;\n\tisClickable?: boolean;\n}\n\nexport function agentSlashCommandToMarkdown(agent: IChatAgentData, command: IChatAgentCommand): string {\n\tconst text = `${chatSubcommandLeader}${command.name}`;\n\tconst args: ISlashCommandWidgetArgs = { agentId: agent.id, command: command.name };\n\treturn `[${text}](${agentSlashRefUrl}?${encodeURIComponent(JSON.stringify(args))})`;\n}\n\ninterface ISlashCommandWidgetArgs {\n\tagentId: string;\n\tcommand: string;\n}\n\nexport interface IDecorationWidgetArgs {\n\ttitle?: string;\n}\n\nexport class ChatMarkdownDecorationsRenderer {\n\n\tconstructor(\n\t\t@IKeybindingService private readonly keybindingService: IKeybindingService,\n\t\t@ILogService private readonly logService: ILogService,\n\t\t@IChatAgentService private readonly chatAgentService: IChatAgentService,\n\t\t@IInstantiationService private readonly instantiationService: IInstantiationService,\n\t\t@IHoverService private readonly hoverService: IHoverService,\n\t\t@IChatService private readonly chatService: IChatService,\n\t\t@IChatWidgetService private readonly chatWidgetService: IChatWidgetService,\n\t\t@ICommandService private readonly commandService: ICommandService,\n\t\t@ILabelService private readonly labelService: ILabelService,\n\t\t@ILanguageModelToolsService private readonly toolsService: ILanguageModelToolsService,\n\t\t@IChatMarkdownAnchorService private readonly chatMarkdownAnchorService: IChatMarkdownAnchorService,\n\t) { }\n\n\tconvertParsedRequestToMarkdown(parsedRequest: IParsedChatRequest): string {\n\t\tlet result = '';\n\t\tfor (const part of parsedRequest.parts) {\n\t\t\tif (part instanceof ChatRequestTextPart) {\n\t\t\t\tresult += part.text;\n\t\t\t} else if (part instanceof ChatRequestAgentPart) {\n\t\t\t\tresult += this.instantiationService.invokeFunction(accessor => agentToMarkdown(part.agent, false, accessor));\n\t\t\t} else {\n\t\t\t\tresult += this.genericDecorationToMarkdown(part);\n\t\t\t}\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tprivate genericDecorationToMarkdown(part: IParsedChatRequestPart): string {\n\t\tconst uri = part instanceof ChatRequestDynamicVariablePart && part.data instanceof URI ?\n\t\t\tpart.data :\n\t\t\tundefined;\n\t\tconst title = uri ? this.labelService.getUriLabel(uri, { relative: true }) :\n\t\t\tpart instanceof ChatRequestSlashCommandPart ? part.slashCommand.detail :\n\t\t\t\tpart instanceof ChatRequestAgentSubcommandPart ? part.command.description :\n\t\t\t\t\tpart instanceof ChatRequestSlashPromptPart ? part.name :\n\t\t\t\t\t\tpart instanceof ChatRequestToolPart ? (this.toolsService.getTool(part.toolId)?.userDescription) :\n\t\t\t\t\t\t\t'';\n\n\t\tconst args: IDecorationWidgetArgs = { title };\n\t\tconst text = part.text;\n\t\treturn `[${text}](${decorationRefUrl}?${encodeURIComponent(JSON.stringify(args))})`;\n\t}\n\n\twalkTreeAndAnnotateReferenceLinks(content: IChatMarkdownContent, element: HTMLElement): IDisposable {\n\t\tconst store = new DisposableStore();\n\t\t// eslint-disable-next-line no-restricted-syntax\n\t\telement.querySelectorAll('a').forEach(a => {\n\t\t\tconst href = a.getAttribute('data-href');\n\t\t\tif (href) {\n\t\t\t\tif (href.startsWith(agentRefUrl)) {\n\t\t\t\t\tlet args: IAgentWidgetArgs | undefined;\n\t\t\t\t\ttry {\n\t\t\t\t\t\targs = JSON.parse(decodeURIComponent(href.slice(agentRefUrl.length + 1)));\n\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\tthis.logService.error('Invalid chat widget render data JSON', toErrorMessage(e));\n\t\t\t\t\t}\n\n\t\t\t\t\tif (args) {\n\t\t\t\t\t\ta.replaceWith(this.renderAgentWidget(args, store));\n\t\t\t\t\t}\n\t\t\t\t} else if (href.startsWith(agentSlashRefUrl)) {\n\t\t\t\t\tlet args: ISlashCommandWidgetArgs | undefined;\n\t\t\t\t\ttry {\n\t\t\t\t\t\targs = JSON.parse(decodeURIComponent(href.slice(agentRefUrl.length + 1)));\n\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\tthis.logService.error('Invalid chat slash command render data JSON', toErrorMessage(e));\n\t\t\t\t\t}\n\n\t\t\t\t\tif (args) {\n\t\t\t\t\t\ta.replaceWith(this.renderSlashCommandWidget(a.textContent!, args, store));\n\t\t\t\t\t}\n\t\t\t\t} else if (href.startsWith(decorationRefUrl)) {\n\t\t\t\t\tlet args: IDecorationWidgetArgs | undefined;\n\t\t\t\t\ttry {\n\t\t\t\t\t\targs = JSON.parse(decodeURIComponent(href.slice(decorationRefUrl.length + 1)));\n\t\t\t\t\t} catch (e) { }\n\n\t\t\t\t\ta.replaceWith(this.renderResourceWidget(a.textContent!, args, store));\n\t\t\t\t} else if (href.startsWith(contentRefUrl)) {\n\t\t\t\t\tthis.renderFileWidget(content, href, a, store);\n\t\t\t\t} else if (href.startsWith('command:')) {\n\t\t\t\t\tthis.injectKeybindingHint(a, href, this.keybindingService);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\treturn store;\n\t}\n\n\tprivate renderAgentWidget(args: IAgentWidgetArgs, store: DisposableStore): HTMLElement {\n\t\tconst nameWithLeader = `${chatAgentLeader}${args.name}`;\n\t\tlet container: HTMLElement;\n\t\tif (args.isClickable) {\n\t\t\tcontainer = dom.$('span.chat-agent-widget');\n\t\t\tconst button = store.add(new Button(container, {\n\t\t\t\tbuttonBackground: asCssVariable(chatSlashCommandBackground),\n\t\t\t\tbuttonForeground: asCssVariable(chatSlashCommandForeground),\n\t\t\t\tbuttonHoverBackground: undefined\n\t\t\t}));\n\t\t\tbutton.label = nameWithLeader;\n\t\t\tstore.add(button.onDidClick(() => {\n\t\t\t\tconst agent = this.chatAgentService.getAgent(args.agentId);\n\t\t\t\tconst widget = this.chatWidgetService.lastFocusedWidget;\n\t\t\t\tif (!widget || !agent) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tthis.chatService.sendRequest(widget.viewModel!.sessionResource, agent.metadata.sampleRequest ?? '',\n\t\t\t\t\t{\n\t\t\t\t\t\tlocation: widget.location,\n\t\t\t\t\t\tagentId: agent.id,\n\t\t\t\t\t\tuserSelectedModelId: widget.input.currentLanguageModel,\n\t\t\t\t\t\tmodeInfo: widget.input.currentModeInfo\n\t\t\t\t\t});\n\t\t\t}));\n\t\t} else {\n\t\t\tcontainer = this.renderResourceWidget(nameWithLeader, undefined, store);\n\t\t}\n\n\t\tconst agent = this.chatAgentService.getAgent(args.agentId);\n\t\tconst hover: Lazy<ChatAgentHover> = new Lazy(() => store.add(this.instantiationService.createInstance(ChatAgentHover)));\n\t\tstore.add(this.hoverService.setupManagedHover(getDefaultHoverDelegate('element'), container, () => {\n\t\t\thover.value.setAgent(args.agentId);\n\t\t\treturn hover.value.domNode;\n\t\t}, agent && getChatAgentHoverOptions(() => agent, this.commandService)));\n\t\treturn container;\n\t}\n\n\tprivate renderSlashCommandWidget(name: string, args: ISlashCommandWidgetArgs, store: DisposableStore): HTMLElement {\n\t\tconst container = dom.$('span.chat-agent-widget.chat-command-widget');\n\t\tconst agent = this.chatAgentService.getAgent(args.agentId);\n\t\tconst button = store.add(new Button(container, {\n\t\t\tbuttonBackground: asCssVariable(chatSlashCommandBackground),\n\t\t\tbuttonForeground: asCssVariable(chatSlashCommandForeground),\n\t\t\tbuttonHoverBackground: undefined\n\t\t}));\n\t\tbutton.label = name;\n\t\tstore.add(button.onDidClick(() => {\n\t\t\tconst widget = this.chatWidgetService.lastFocusedWidget;\n\t\t\tif (!widget || !agent) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst command = agent.slashCommands.find(c => c.name === args.command);\n\t\t\tthis.chatService.sendRequest(widget.viewModel!.sessionResource, command?.sampleRequest ?? '', {\n\t\t\t\tlocation: widget.location,\n\t\t\t\tagentId: agent.id,\n\t\t\t\tslashCommand: args.command,\n\t\t\t\tuserSelectedModelId: widget.input.currentLanguageModel,\n\t\t\t\tmodeInfo: widget.input.currentModeInfo\n\t\t\t});\n\t\t}));\n\n\t\treturn container;\n\t}\n\n\tprivate renderFileWidget(content: IChatMarkdownContent, href: string, a: HTMLAnchorElement, store: DisposableStore): void {\n\t\t// TODO this can be a nicer FileLabel widget with an icon. Do a simple link for now.\n\t\tconst fullUri = URI.parse(href);\n\n\t\tconst data = content.inlineReferences?.[fullUri.path.slice(1)];\n\t\tif (!data) {\n\t\t\tthis.logService.error('Invalid chat widget render data JSON');\n\t\t\treturn;\n\t\t}\n\n\t\tconst inlineAnchor = store.add(this.instantiationService.createInstance(InlineAnchorWidget, a, data));\n\t\tstore.add(this.chatMarkdownAnchorService.register(inlineAnchor));\n\t}\n\n\tprivate renderResourceWidget(name: string, args: IDecorationWidgetArgs | undefined, store: DisposableStore): HTMLElement {\n\t\tconst container = dom.$('span.chat-resource-widget');\n\t\tconst alias = dom.$('span', undefined, name);\n\t\tif (args?.title) {\n\t\t\tstore.add(this.hoverService.setupManagedHover(getDefaultHoverDelegate('element'), container, args.title));\n\t\t}\n\n\t\tcontainer.appendChild(alias);\n\t\treturn container;\n\t}\n\n\n\tprivate injectKeybindingHint(a: HTMLAnchorElement, href: string, keybindingService: IKeybindingService): void {\n\t\tconst command = href.match(/command:([^\\)]+)/)?.[1];\n\t\tif (command) {\n\t\t\tconst kb = keybindingService.lookupKeybinding(command);\n\t\t\tif (kb) {\n\t\t\t\tconst keybinding = kb.getLabel();\n\t\t\t\tif (keybinding) {\n\t\t\t\t\ta.textContent = `${a.textContent} (${keybinding})`;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n}\n"]}