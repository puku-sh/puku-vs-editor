{"version":3,"sources":["vs/workbench/contrib/chat/browser/chatSetup.ts"],"names":[],"mappings":"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","file":"chatSetup.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport './media/chatSetup.css';\nimport { $ } from '../../../../base/browser/dom.js';\nimport { IButton } from '../../../../base/browser/ui/button/button.js';\nimport { Dialog, DialogContentsAlignment } from '../../../../base/browser/ui/dialog/dialog.js';\nimport { WorkbenchActionExecutedClassification, WorkbenchActionExecutedEvent } from '../../../../base/common/actions.js';\nimport { timeout } from '../../../../base/common/async.js';\nimport { CancellationToken } from '../../../../base/common/cancellation.js';\nimport { Codicon } from '../../../../base/common/codicons.js';\nimport { toErrorMessage } from '../../../../base/common/errorMessage.js';\nimport { isCancellationError } from '../../../../base/common/errors.js';\nimport { Emitter, Event } from '../../../../base/common/event.js';\nimport { MarkdownString } from '../../../../base/common/htmlContent.js';\nimport { Lazy } from '../../../../base/common/lazy.js';\nimport { Disposable, DisposableStore, IDisposable, markAsSingleton, MutableDisposable } from '../../../../base/common/lifecycle.js';\nimport Severity from '../../../../base/common/severity.js';\nimport { StopWatch } from '../../../../base/common/stopwatch.js';\nimport { equalsIgnoreCase } from '../../../../base/common/strings.js';\nimport { isObject } from '../../../../base/common/types.js';\nimport { URI } from '../../../../base/common/uri.js';\nimport { ServicesAccessor } from '../../../../editor/browser/editorExtensions.js';\nimport { IMarkdownRendererService } from '../../../../platform/markdown/browser/markdownRenderer.js';\nimport { localize, localize2 } from '../../../../nls.js';\nimport { Action2, MenuId, MenuRegistry, registerAction2 } from '../../../../platform/actions/common/actions.js';\nimport { CommandsRegistry, ICommandService } from '../../../../platform/commands/common/commands.js';\nimport { ConfigurationTarget, IConfigurationService } from '../../../../platform/configuration/common/configuration.js';\nimport { Extensions as ConfigurationExtensions, IConfigurationRegistry } from '../../../../platform/configuration/common/configurationRegistry.js';\nimport { ContextKeyExpr, IContextKeyService } from '../../../../platform/contextkey/common/contextkey.js';\nimport { createWorkbenchDialogOptions } from '../../../../platform/dialogs/browser/dialog.js';\nimport { IDialogService } from '../../../../platform/dialogs/common/dialogs.js';\nimport { ExtensionIdentifier } from '../../../../platform/extensions/common/extensions.js';\nimport { IInstantiationService } from '../../../../platform/instantiation/common/instantiation.js';\nimport { IKeybindingService } from '../../../../platform/keybinding/common/keybinding.js';\nimport { ILayoutService } from '../../../../platform/layout/browser/layoutService.js';\nimport { ILogService } from '../../../../platform/log/common/log.js';\nimport { IOpenerService } from '../../../../platform/opener/common/opener.js';\nimport product from '../../../../platform/product/common/product.js';\nimport { IProductService } from '../../../../platform/product/common/productService.js';\nimport { IProgressService, ProgressLocation } from '../../../../platform/progress/common/progress.js';\nimport { IQuickInputService } from '../../../../platform/quickinput/common/quickInput.js';\nimport { Registry } from '../../../../platform/registry/common/platform.js';\nimport { ITelemetryService, TelemetryLevel } from '../../../../platform/telemetry/common/telemetry.js';\nimport { IWorkspaceTrustManagementService, IWorkspaceTrustRequestService } from '../../../../platform/workspace/common/workspaceTrust.js';\nimport { IWorkbenchContribution } from '../../../common/contributions.js';\nimport { IViewDescriptorService, ViewContainerLocation } from '../../../common/views.js';\nimport { IActivityService, ProgressBadge } from '../../../services/activity/common/activity.js';\nimport { AuthenticationSession, IAuthenticationService } from '../../../services/authentication/common/authentication.js';\nimport { IWorkbenchEnvironmentService } from '../../../services/environment/common/environmentService.js';\nimport { EnablementState, IWorkbenchExtensionEnablementService } from '../../../services/extensionManagement/common/extensionManagement.js';\nimport { ExtensionUrlHandlerOverrideRegistry } from '../../../services/extensions/browser/extensionUrlHandler.js';\nimport { IExtensionService, nullExtensionDescription } from '../../../services/extensions/common/extensions.js';\nimport { IHostService } from '../../../services/host/browser/host.js';\nimport { IWorkbenchLayoutService, Parts } from '../../../services/layout/browser/layoutService.js';\nimport { ILifecycleService } from '../../../services/lifecycle/common/lifecycle.js';\nimport { IPreferencesService } from '../../../services/preferences/common/preferences.js';\nimport { CountTokensCallback, ILanguageModelToolsService, IPreparedToolInvocation, IToolData, IToolImpl, IToolInvocation, IToolResult, ToolDataSource, ToolProgress } from '../../chat/common/languageModelToolsService.js';\nimport { IExtension, IExtensionsWorkbenchService } from '../../extensions/common/extensions.js';\nimport { IChatAgentImplementation, IChatAgentRequest, IChatAgentResult, IChatAgentService } from '../common/chatAgents.js';\nimport { ChatContextKeys } from '../common/chatContextKeys.js';\nimport { ChatEntitlement, ChatEntitlementContext, ChatEntitlementRequests, ChatEntitlementService, IChatEntitlementService, isProUser } from '../../../services/chat/common/chatEntitlementService.js';\nimport { ChatModel, ChatRequestModel, IChatRequestModel, IChatRequestVariableData } from '../common/chatModel.js';\nimport { ChatMode, IChatModeService } from '../common/chatModes.js';\nimport { ChatRequestAgentPart, ChatRequestToolPart } from '../common/chatParserTypes.js';\nimport { IChatProgress, IChatService } from '../common/chatService.js';\nimport { IChatRequestToolEntry } from '../common/chatVariableEntries.js';\nimport { ChatAgentLocation, ChatConfiguration, ChatModeKind } from '../common/constants.js';\nimport { ILanguageModelsService } from '../common/languageModels.js';\nimport { CHAT_CATEGORY, CHAT_OPEN_ACTION_ID, CHAT_SETUP_ACTION_ID, CHAT_SETUP_SUPPORT_ANONYMOUS_ACTION_ID } from './actions/chatActions.js';\nimport { ChatViewId, IChatWidgetService } from './chat.js';\nimport { CHAT_SIDEBAR_PANEL_ID } from './chatViewPane.js';\nimport { IEnvironmentService } from '../../../../platform/environment/common/environment.js';\nimport { chatViewsWelcomeRegistry } from './viewsWelcome/chatViewsWelcome.js';\nimport { ILanguageFeaturesService } from '../../../../editor/common/services/languageFeatures.js';\nimport { CodeAction, CodeActionList, Command, NewSymbolName, NewSymbolNameTriggerKind } from '../../../../editor/common/languages.js';\nimport { ITextModel } from '../../../../editor/common/model.js';\nimport { IRange, Range } from '../../../../editor/common/core/range.js';\nimport { ISelection, Selection } from '../../../../editor/common/core/selection.js';\nimport { ResourceMap } from '../../../../base/common/map.js';\nimport { CodeActionKind } from '../../../../editor/contrib/codeAction/common/types.js';\nimport { ACTION_START as INLINE_CHAT_START } from '../../inlineChat/common/inlineChat.js';\nimport { IPosition } from '../../../../editor/common/core/position.js';\nimport { IMarker, IMarkerService, MarkerSeverity } from '../../../../platform/markers/common/markers.js';\nimport { EditorContextKeys } from '../../../../editor/common/editorContextKeys.js';\nimport { ICodeEditorService } from '../../../../editor/browser/services/codeEditorService.js';\nimport { IPukuAuthService } from '../../../services/chat/common/pukuAuthService.js';\n\nconst defaultChat = {\n\textensionId: product.defaultChatAgent?.extensionId ?? '',\n\tchatExtensionId: product.defaultChatAgent?.chatExtensionId ?? '',\n\tpublicCodeMatchesUrl: product.defaultChatAgent?.publicCodeMatchesUrl ?? '',\n\tmanageOveragesUrl: product.defaultChatAgent?.manageOverageUrl ?? '',\n\tupgradePlanUrl: product.defaultChatAgent?.upgradePlanUrl ?? '',\n\tprovider: product.defaultChatAgent?.provider ?? { default: { id: '', name: '' }, enterprise: { id: '', name: '' }, apple: { id: '', name: '' }, google: { id: '', name: '' } },\n\tproviderUriSetting: product.defaultChatAgent?.providerUriSetting ?? '',\n\tmanageSettingsUrl: product.defaultChatAgent?.manageSettingsUrl ?? '',\n\tcompletionsAdvancedSetting: product.defaultChatAgent?.completionsAdvancedSetting ?? '',\n\tcompletionsRefreshTokenCommand: product.defaultChatAgent?.completionsRefreshTokenCommand ?? '',\n\tchatRefreshTokenCommand: product.defaultChatAgent?.chatRefreshTokenCommand ?? '',\n\ttermsStatementUrl: product.defaultChatAgent?.termsStatementUrl ?? '',\n\tprivacyStatementUrl: product.defaultChatAgent?.privacyStatementUrl ?? ''\n};\n\nenum ChatSetupAnonymous {\n\tDisabled = 0,\n\tEnabledWithDialog = 1,\n\tEnabledWithoutDialog = 2\n}\n\n//#region Contribution\n\nconst ToolsAgentContextKey = ContextKeyExpr.and(\n\tContextKeyExpr.equals(`config.${ChatConfiguration.AgentEnabled}`, true),\n\tContextKeyExpr.not(`previewFeaturesDisabled`) // Set by extension\n);\n\nclass SetupAgent extends Disposable implements IChatAgentImplementation {\n\n\tstatic registerDefaultAgents(instantiationService: IInstantiationService, location: ChatAgentLocation, mode: ChatModeKind | undefined, context: ChatEntitlementContext, controller: Lazy<ChatSetupController>): { agent: SetupAgent; disposable: IDisposable } {\n\t\treturn instantiationService.invokeFunction(accessor => {\n\t\t\tconst chatAgentService = accessor.get(IChatAgentService);\n\n\t\t\tlet id: string;\n\t\t\tlet description = ChatMode.Ask.description.get();\n\t\t\tswitch (location) {\n\t\t\t\tcase ChatAgentLocation.Chat:\n\t\t\t\t\tif (mode === ChatModeKind.Ask) {\n\t\t\t\t\t\tid = 'setup.chat';\n\t\t\t\t\t} else if (mode === ChatModeKind.Edit) {\n\t\t\t\t\t\tid = 'setup.edits';\n\t\t\t\t\t\tdescription = ChatMode.Edit.description.get();\n\t\t\t\t\t} else {\n\t\t\t\t\t\tid = 'setup.agent';\n\t\t\t\t\t\tdescription = ChatMode.Agent.description.get();\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase ChatAgentLocation.Terminal:\n\t\t\t\t\tid = 'setup.terminal';\n\t\t\t\t\tbreak;\n\t\t\t\tcase ChatAgentLocation.EditorInline:\n\t\t\t\t\tid = 'setup.editor';\n\t\t\t\t\tbreak;\n\t\t\t\tcase ChatAgentLocation.Notebook:\n\t\t\t\t\tid = 'setup.notebook';\n\t\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\treturn SetupAgent.doRegisterAgent(instantiationService, chatAgentService, id, `${defaultChat.provider.default.name} Copilot` /* Do NOT change, this hides the username altogether in Chat */, true, description, location, mode, context, controller);\n\t\t});\n\t}\n\n\tstatic registerBuiltInAgents(instantiationService: IInstantiationService, context: ChatEntitlementContext, controller: Lazy<ChatSetupController>): IDisposable {\n\t\treturn instantiationService.invokeFunction(accessor => {\n\t\t\tconst chatAgentService = accessor.get(IChatAgentService);\n\n\t\t\tconst disposables = new DisposableStore();\n\n\t\t\t// Register VSCode agent\n\t\t\tconst { disposable: vscodeDisposable } = SetupAgent.doRegisterAgent(instantiationService, chatAgentService, 'setup.vscode', 'vscode', false, localize2('vscodeAgentDescription', \"Ask questions about VS Code\").value, ChatAgentLocation.Chat, undefined, context, controller);\n\t\t\tdisposables.add(vscodeDisposable);\n\n\t\t\t// Register workspace agent\n\t\t\tconst { disposable: workspaceDisposable } = SetupAgent.doRegisterAgent(instantiationService, chatAgentService, 'setup.workspace', 'workspace', false, localize2('workspaceAgentDescription', \"Ask about your workspace\").value, ChatAgentLocation.Chat, undefined, context, controller);\n\t\t\tdisposables.add(workspaceDisposable);\n\n\t\t\t// Register terminal agent\n\t\t\tconst { disposable: terminalDisposable } = SetupAgent.doRegisterAgent(instantiationService, chatAgentService, 'setup.terminal.agent', 'terminal', false, localize2('terminalAgentDescription', \"Ask how to do something in the terminal\").value, ChatAgentLocation.Chat, undefined, context, controller);\n\t\t\tdisposables.add(terminalDisposable);\n\n\t\t\t// Register tools\n\t\t\tdisposables.add(SetupTool.registerTool(instantiationService, {\n\t\t\t\tid: 'setup_tools_createNewWorkspace',\n\t\t\t\tsource: ToolDataSource.Internal,\n\t\t\t\ticon: Codicon.newFolder,\n\t\t\t\tdisplayName: localize('setupToolDisplayName', \"New Workspace\"),\n\t\t\t\tmodelDescription: 'Scaffold a new workspace in VS Code',\n\t\t\t\tuserDescription: localize('setupToolsDescription', \"Scaffold a new workspace in VS Code\"),\n\t\t\t\tcanBeReferencedInPrompt: true,\n\t\t\t\ttoolReferenceName: 'new',\n\t\t\t\twhen: ContextKeyExpr.true(),\n\t\t\t}));\n\n\t\t\treturn disposables;\n\t\t});\n\t}\n\n\tprivate static doRegisterAgent(instantiationService: IInstantiationService, chatAgentService: IChatAgentService, id: string, name: string, isDefault: boolean, description: string, location: ChatAgentLocation, mode: ChatModeKind | undefined, context: ChatEntitlementContext, controller: Lazy<ChatSetupController>): { agent: SetupAgent; disposable: IDisposable } {\n\t\tconst disposables = new DisposableStore();\n\t\tdisposables.add(chatAgentService.registerAgent(id, {\n\t\t\tid,\n\t\t\tname,\n\t\t\tisDefault,\n\t\t\tisCore: true,\n\t\t\tmodes: mode ? [mode] : [ChatModeKind.Ask],\n\t\t\twhen: mode === ChatModeKind.Agent ? ToolsAgentContextKey?.serialize() : undefined,\n\t\t\tslashCommands: [],\n\t\t\tdisambiguation: [],\n\t\t\tlocations: [location],\n\t\t\tmetadata: { helpTextPrefix: SetupAgent.SETUP_NEEDED_MESSAGE },\n\t\t\tdescription,\n\t\t\textensionId: nullExtensionDescription.identifier,\n\t\t\textensionVersion: undefined,\n\t\t\textensionDisplayName: nullExtensionDescription.name,\n\t\t\textensionPublisherId: nullExtensionDescription.publisher\n\t\t}));\n\n\t\tconst agent = disposables.add(instantiationService.createInstance(SetupAgent, context, controller, location));\n\t\tdisposables.add(chatAgentService.registerAgentImplementation(id, agent));\n\t\tif (mode === ChatModeKind.Agent) {\n\t\t\tchatAgentService.updateAgent(id, { themeIcon: Codicon.tools });\n\t\t}\n\n\t\treturn { agent, disposable: disposables };\n\t}\n\n\tprivate static readonly SETUP_NEEDED_MESSAGE = new MarkdownString(localize('settingUpCopilotNeeded', \"You need to set up Puku AI and be signed in to use Chat.\"));\n\tprivate static readonly TRUST_NEEDED_MESSAGE = new MarkdownString(localize('trustNeeded', \"You need to trust this workspace to use Chat.\"));\n\n\tprivate readonly _onUnresolvableError = this._register(new Emitter<void>());\n\treadonly onUnresolvableError = this._onUnresolvableError.event;\n\n\tprivate readonly pendingForwardedRequests = new ResourceMap<Promise<void>>();\n\n\tconstructor(\n\t\tprivate readonly context: ChatEntitlementContext,\n\t\tprivate readonly controller: Lazy<ChatSetupController>,\n\t\tprivate readonly location: ChatAgentLocation,\n\t\t@IInstantiationService private readonly instantiationService: IInstantiationService,\n\t\t@ILogService private readonly logService: ILogService,\n\t\t@IConfigurationService private readonly configurationService: IConfigurationService,\n\t\t@ITelemetryService private readonly telemetryService: ITelemetryService,\n\t\t@IWorkbenchEnvironmentService private readonly environmentService: IWorkbenchEnvironmentService,\n\t\t@IWorkspaceTrustManagementService private readonly workspaceTrustManagementService: IWorkspaceTrustManagementService,\n\t\t@IChatEntitlementService private readonly chatEntitlementService: IChatEntitlementService,\n\t) {\n\t\tsuper();\n\t}\n\n\tasync invoke(request: IChatAgentRequest, progress: (parts: IChatProgress[]) => void): Promise<IChatAgentResult> {\n\t\treturn this.instantiationService.invokeFunction(async accessor /* using accessor for lazy loading */ => {\n\t\t\tconst chatService = accessor.get(IChatService);\n\t\t\tconst languageModelsService = accessor.get(ILanguageModelsService);\n\t\t\tconst chatWidgetService = accessor.get(IChatWidgetService);\n\t\t\tconst chatAgentService = accessor.get(IChatAgentService);\n\t\t\tconst languageModelToolsService = accessor.get(ILanguageModelToolsService);\n\n\t\t\treturn this.doInvoke(request, part => progress([part]), chatService, languageModelsService, chatWidgetService, chatAgentService, languageModelToolsService);\n\t\t});\n\t}\n\n\tprivate async doInvoke(request: IChatAgentRequest, progress: (part: IChatProgress) => void, chatService: IChatService, languageModelsService: ILanguageModelsService, chatWidgetService: IChatWidgetService, chatAgentService: IChatAgentService, languageModelToolsService: ILanguageModelToolsService): Promise<IChatAgentResult> {\n\t\tif (\n\t\t\t!this.context.state.installed ||\t\t\t\t\t\t\t\t\t// Extension not installed: run setup to install\n\t\t\tthis.context.state.disabled ||\t\t\t\t\t\t\t\t\t\t// Extension disabled: run setup to enable\n\t\t\tthis.context.state.untrusted ||\t\t\t\t\t\t\t\t\t\t// Workspace untrusted: run setup to ask for trust\n\t\t\tthis.context.state.entitlement === ChatEntitlement.Available ||\t\t// Entitlement available: run setup to sign up\n\t\t\t(\n\t\t\t\tthis.context.state.entitlement === ChatEntitlement.Unknown &&\t// Entitlement unknown: run setup to sign in / sign up\n\t\t\t\t!this.chatEntitlementService.anonymous\t\t\t\t\t\t\t// unless anonymous access is enabled\n\t\t\t)\n\t\t) {\n\t\t\treturn this.doInvokeWithSetup(request, progress, chatService, languageModelsService, chatWidgetService, chatAgentService, languageModelToolsService);\n\t\t}\n\n\t\treturn this.doInvokeWithoutSetup(request, progress, chatService, languageModelsService, chatWidgetService, chatAgentService, languageModelToolsService);\n\t}\n\n\tprivate async doInvokeWithoutSetup(request: IChatAgentRequest, progress: (part: IChatProgress) => void, chatService: IChatService, languageModelsService: ILanguageModelsService, chatWidgetService: IChatWidgetService, chatAgentService: IChatAgentService, languageModelToolsService: ILanguageModelToolsService): Promise<IChatAgentResult> {\n\t\tconst requestModel = chatWidgetService.getWidgetBySessionResource(request.sessionResource)?.viewModel?.model.getRequests().at(-1);\n\t\tif (!requestModel) {\n\t\t\tthis.logService.error('[chat setup] Request model not found, cannot redispatch request.');\n\t\t\treturn {}; // this should not happen\n\t\t}\n\n\t\tprogress({\n\t\t\tkind: 'progressMessage',\n\t\t\tcontent: new MarkdownString(localize('waitingChat', \"Getting chat ready...\")),\n\t\t});\n\n\t\tawait this.forwardRequestToChat(requestModel, progress, chatService, languageModelsService, chatAgentService, chatWidgetService, languageModelToolsService);\n\n\t\treturn {};\n\t}\n\n\tprivate async forwardRequestToChat(requestModel: IChatRequestModel, progress: (part: IChatProgress) => void, chatService: IChatService, languageModelsService: ILanguageModelsService, chatAgentService: IChatAgentService, chatWidgetService: IChatWidgetService, languageModelToolsService: ILanguageModelToolsService): Promise<void> {\n\t\ttry {\n\t\t\tawait this.doForwardRequestToChat(requestModel, progress, chatService, languageModelsService, chatAgentService, chatWidgetService, languageModelToolsService);\n\t\t} catch (error) {\n\t\t\tprogress({\n\t\t\t\tkind: 'warning',\n\t\t\t\tcontent: new MarkdownString(localize('copilotUnavailableWarning', \"Failed to get a response. Please try again.\"))\n\t\t\t});\n\t\t}\n\t}\n\n\tprivate async doForwardRequestToChat(requestModel: IChatRequestModel, progress: (part: IChatProgress) => void, chatService: IChatService, languageModelsService: ILanguageModelsService, chatAgentService: IChatAgentService, chatWidgetService: IChatWidgetService, languageModelToolsService: ILanguageModelToolsService): Promise<void> {\n\t\tif (this.pendingForwardedRequests.has(requestModel.session.sessionResource)) {\n\t\t\tthrow new Error('Request already in progress');\n\t\t}\n\n\t\tconst forwardRequest = this.doForwardRequestToChatWhenReady(requestModel, progress, chatService, languageModelsService, chatAgentService, chatWidgetService, languageModelToolsService);\n\t\tthis.pendingForwardedRequests.set(requestModel.session.sessionResource, forwardRequest);\n\n\t\ttry {\n\t\t\tawait forwardRequest;\n\t\t} finally {\n\t\t\tthis.pendingForwardedRequests.delete(requestModel.session.sessionResource);\n\t\t}\n\t}\n\n\tprivate async doForwardRequestToChatWhenReady(requestModel: IChatRequestModel, progress: (part: IChatProgress) => void, chatService: IChatService, languageModelsService: ILanguageModelsService, chatAgentService: IChatAgentService, chatWidgetService: IChatWidgetService, languageModelToolsService: ILanguageModelToolsService): Promise<void> {\n\t\tconst widget = chatWidgetService.getWidgetBySessionResource(requestModel.session.sessionResource);\n\t\tconst modeInfo = widget?.input.currentModeInfo;\n\n\t\t// We need a signal to know when we can resend the request to\n\t\t// Chat. Waiting for the registration of the agent is not\n\t\t// enough, we also need a language/tools model to be available.\n\n\t\tlet agentReady = false;\n\t\tlet languageModelReady = false;\n\t\tlet toolsModelReady = false;\n\n\t\tconst whenAgentReady = this.whenAgentReady(chatAgentService, modeInfo?.kind)?.then(() => agentReady = true);\n\t\tconst whenLanguageModelReady = this.whenLanguageModelReady(languageModelsService, requestModel.modelId)?.then(() => languageModelReady = true);\n\t\tconst whenToolsModelReady = this.whenToolsModelReady(languageModelToolsService, requestModel)?.then(() => toolsModelReady = true);\n\n\t\tif (whenLanguageModelReady instanceof Promise || whenAgentReady instanceof Promise || whenToolsModelReady instanceof Promise) {\n\t\t\tconst timeoutHandle = setTimeout(() => {\n\t\t\t\tprogress({\n\t\t\t\t\tkind: 'progressMessage',\n\t\t\t\t\tcontent: new MarkdownString(localize('waitingChat2', \"Chat is almost ready...\")),\n\t\t\t\t});\n\t\t\t}, 10000);\n\n\t\t\ttry {\n\t\t\t\tconst ready = await Promise.race([\n\t\t\t\t\ttimeout(this.environmentService.remoteAuthority ? 60000 /* increase for remote scenarios */ : 20000).then(() => 'timedout'),\n\t\t\t\t\tthis.whenDefaultAgentActivated(chatService),\n\t\t\t\t\tPromise.allSettled([whenLanguageModelReady, whenAgentReady, whenToolsModelReady])\n\t\t\t\t]);\n\n\t\t\t\tif (ready === 'timedout') {\n\t\t\t\t\tlet warningMessage: string;\n\t\t\t\t\tif (this.chatEntitlementService.anonymous) {\n\t\t\t\t\t\twarningMessage = localize('chatTookLongWarningAnonymous', \"Chat took too long to get ready. Please ensure that the extension `{0}` is installed and enabled.\", defaultChat.chatExtensionId);\n\t\t\t\t\t} else {\n\t\t\t\t\t\twarningMessage = localize('chatTookLongWarning', \"Chat took too long to get ready. Please ensure you are signed in to {0} and that the extension `{1}` is installed and enabled.\", defaultChat.provider.default.name, defaultChat.chatExtensionId);\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.logService.warn(warningMessage, {\n\t\t\t\t\t\tagentReady: whenAgentReady ? agentReady : undefined,\n\t\t\t\t\t\tlanguageModelReady: whenLanguageModelReady ? languageModelReady : undefined,\n\t\t\t\t\t\ttoolsModelReady: whenToolsModelReady ? toolsModelReady : undefined\n\t\t\t\t\t});\n\n\t\t\t\t\tprogress({\n\t\t\t\t\t\tkind: 'warning',\n\t\t\t\t\t\tcontent: new MarkdownString(warningMessage)\n\t\t\t\t\t});\n\n\t\t\t\t\t// This means Chat is unhealthy and we cannot retry the\n\t\t\t\t\t// request. Signal this to the outside via an event.\n\t\t\t\t\tthis._onUnresolvableError.fire();\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t} finally {\n\t\t\t\tclearTimeout(timeoutHandle);\n\t\t\t}\n\t\t}\n\n\t\tawait chatService.resendRequest(requestModel, {\n\t\t\t...widget?.getModeRequestOptions(),\n\t\t\tmodeInfo,\n\t\t\tuserSelectedModelId: widget?.input.currentLanguageModel\n\t\t});\n\t}\n\n\tprivate whenLanguageModelReady(languageModelsService: ILanguageModelsService, modelId: string | undefined): Promise<unknown> | void {\n\t\tconst hasModelForRequest = () => {\n\t\t\tif (modelId) {\n\t\t\t\treturn !!languageModelsService.lookupLanguageModel(modelId);\n\t\t\t}\n\n\t\t\tfor (const id of languageModelsService.getLanguageModelIds()) {\n\t\t\t\tconst model = languageModelsService.lookupLanguageModel(id);\n\t\t\t\tif (model?.isDefault) {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn false;\n\t\t};\n\n\t\tif (hasModelForRequest()) {\n\t\t\treturn;\n\t\t}\n\n\t\treturn Event.toPromise(Event.filter(languageModelsService.onDidChangeLanguageModels, () => hasModelForRequest()));\n\t}\n\n\tprivate whenToolsModelReady(languageModelToolsService: ILanguageModelToolsService, requestModel: IChatRequestModel): Promise<unknown> | void {\n\t\tconst needsToolsModel = requestModel.message.parts.some(part => part instanceof ChatRequestToolPart);\n\t\tif (!needsToolsModel) {\n\t\t\treturn; // No tools in this request, no need to check\n\t\t}\n\n\t\t// check that tools other than setup. and internal tools are registered.\n\t\tfor (const tool of languageModelToolsService.getTools()) {\n\t\t\tif (tool.id.startsWith('copilot_')) {\n\t\t\t\treturn; // we have tools!\n\t\t\t}\n\t\t}\n\n\t\treturn Event.toPromise(Event.filter(languageModelToolsService.onDidChangeTools, () => {\n\t\t\tfor (const tool of languageModelToolsService.getTools()) {\n\t\t\t\tif (tool.id.startsWith('copilot_')) {\n\t\t\t\t\treturn true; // we have tools!\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn false; // no external tools found\n\t\t}));\n\t}\n\n\tprivate whenAgentReady(chatAgentService: IChatAgentService, mode: ChatModeKind | undefined): Promise<unknown> | void {\n\t\tconst defaultAgent = chatAgentService.getDefaultAgent(this.location, mode);\n\t\tif (defaultAgent && !defaultAgent.isCore) {\n\t\t\treturn; // we have a default agent from an extension!\n\t\t}\n\n\t\treturn Event.toPromise(Event.filter(chatAgentService.onDidChangeAgents, () => {\n\t\t\tconst defaultAgent = chatAgentService.getDefaultAgent(this.location, mode);\n\t\t\treturn Boolean(defaultAgent && !defaultAgent.isCore);\n\t\t}));\n\t}\n\n\tprivate async whenDefaultAgentActivated(chatService: IChatService): Promise<void> {\n\t\ttry {\n\t\t\tawait chatService.activateDefaultAgent(this.location);\n\t\t} catch (error) {\n\t\t\tthis.logService.error(error);\n\t\t}\n\t}\n\n\tprivate async doInvokeWithSetup(request: IChatAgentRequest, progress: (part: IChatProgress) => void, chatService: IChatService, languageModelsService: ILanguageModelsService, chatWidgetService: IChatWidgetService, chatAgentService: IChatAgentService, languageModelToolsService: ILanguageModelToolsService): Promise<IChatAgentResult> {\n\t\tthis.telemetryService.publicLog2<WorkbenchActionExecutedEvent, WorkbenchActionExecutedClassification>('workbenchActionExecuted', { id: CHAT_SETUP_ACTION_ID, from: 'chat' });\n\n\t\tconst widget = chatWidgetService.getWidgetBySessionResource(request.sessionResource);\n\t\tconst requestModel = widget?.viewModel?.model.getRequests().at(-1);\n\n\t\tconst setupListener = Event.runAndSubscribe(this.controller.value.onDidChange, (() => {\n\t\t\tswitch (this.controller.value.step) {\n\t\t\t\tcase ChatSetupStep.SigningIn:\n\t\t\t\t\tprogress({\n\t\t\t\t\t\tkind: 'progressMessage',\n\t\t\t\t\t\tcontent: new MarkdownString(localize('setupChatSignIn2', \"Signing in to {0}...\", ChatEntitlementRequests.providerId(this.configurationService) === defaultChat.provider.enterprise.id ? defaultChat.provider.enterprise.name : defaultChat.provider.default.name)),\n\t\t\t\t\t});\n\t\t\t\t\tbreak;\n\t\t\t\tcase ChatSetupStep.Installing:\n\t\t\t\t\tprogress({\n\t\t\t\t\t\tkind: 'progressMessage',\n\t\t\t\t\t\tcontent: new MarkdownString(localize('installingChat', \"Getting chat ready...\")),\n\t\t\t\t\t});\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}));\n\n\t\tlet result: IChatSetupResult | undefined = undefined;\n\t\ttry {\n\t\t\tresult = await ChatSetup.getInstance(this.instantiationService, this.context, this.controller).run({\n\t\t\t\tdisableChatViewReveal: true, \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// we are already in a chat context\n\t\t\t\tforceAnonymous: this.chatEntitlementService.anonymous ? ChatSetupAnonymous.EnabledWithoutDialog : undefined\t// only enable anonymous selectively\n\t\t\t});\n\t\t} catch (error) {\n\t\t\tthis.logService.error(`[chat setup] Error during setup: ${toErrorMessage(error)}`);\n\t\t} finally {\n\t\t\tsetupListener.dispose();\n\t\t}\n\n\t\t// User has agreed to run the setup\n\t\tif (typeof result?.success === 'boolean') {\n\t\t\tif (result.success) {\n\t\t\t\tif (result.dialogSkipped) {\n\t\t\t\t\tawait widget?.clear(); // make room for the Chat welcome experience\n\t\t\t\t} else if (requestModel) {\n\t\t\t\t\tlet newRequest = this.replaceAgentInRequestModel(requestModel, chatAgentService); \t// Replace agent part with the actual Chat agent...\n\t\t\t\t\tnewRequest = this.replaceToolInRequestModel(newRequest); \t\t\t\t\t\t\t// ...then replace any tool parts with the actual Chat tools\n\n\t\t\t\t\tawait this.forwardRequestToChat(newRequest, progress, chatService, languageModelsService, chatAgentService, chatWidgetService, languageModelToolsService);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tprogress({\n\t\t\t\t\tkind: 'warning',\n\t\t\t\t\tcontent: new MarkdownString(localize('chatSetupError', \"Chat setup failed.\"))\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\t// User has cancelled the setup\n\t\telse {\n\t\t\tprogress({\n\t\t\t\tkind: 'markdownContent',\n\t\t\t\tcontent: this.workspaceTrustManagementService.isWorkspaceTrusted() ? SetupAgent.SETUP_NEEDED_MESSAGE : SetupAgent.TRUST_NEEDED_MESSAGE\n\t\t\t});\n\t\t}\n\n\t\treturn {};\n\t}\n\n\tprivate replaceAgentInRequestModel(requestModel: IChatRequestModel, chatAgentService: IChatAgentService): IChatRequestModel {\n\t\tconst agentPart = requestModel.message.parts.find((r): r is ChatRequestAgentPart => r instanceof ChatRequestAgentPart);\n\t\tif (!agentPart) {\n\t\t\treturn requestModel;\n\t\t}\n\n\t\tconst agentId = agentPart.agent.id.replace(/setup\\./, `${defaultChat.extensionId}.`.toLowerCase());\n\t\tconst githubAgent = chatAgentService.getAgent(agentId);\n\t\tif (!githubAgent) {\n\t\t\treturn requestModel;\n\t\t}\n\n\t\tconst newAgentPart = new ChatRequestAgentPart(agentPart.range, agentPart.editorRange, githubAgent);\n\n\t\treturn new ChatRequestModel({\n\t\t\tsession: requestModel.session as ChatModel,\n\t\t\tmessage: {\n\t\t\t\tparts: requestModel.message.parts.map(part => {\n\t\t\t\t\tif (part instanceof ChatRequestAgentPart) {\n\t\t\t\t\t\treturn newAgentPart;\n\t\t\t\t\t}\n\t\t\t\t\treturn part;\n\t\t\t\t}),\n\t\t\t\ttext: requestModel.message.text\n\t\t\t},\n\t\t\tvariableData: requestModel.variableData,\n\t\t\ttimestamp: Date.now(),\n\t\t\tattempt: requestModel.attempt,\n\t\t\tmodeInfo: requestModel.modeInfo,\n\t\t\tconfirmation: requestModel.confirmation,\n\t\t\tlocationData: requestModel.locationData,\n\t\t\tattachedContext: requestModel.attachedContext,\n\t\t\tisCompleteAddedRequest: requestModel.isCompleteAddedRequest,\n\t\t});\n\t}\n\n\tprivate replaceToolInRequestModel(requestModel: IChatRequestModel): IChatRequestModel {\n\t\tconst toolPart = requestModel.message.parts.find((r): r is ChatRequestToolPart => r instanceof ChatRequestToolPart);\n\t\tif (!toolPart) {\n\t\t\treturn requestModel;\n\t\t}\n\n\t\tconst toolId = toolPart.toolId.replace(/setup.tools\\./, `copilot_`.toLowerCase());\n\t\tconst newToolPart = new ChatRequestToolPart(\n\t\t\ttoolPart.range,\n\t\t\ttoolPart.editorRange,\n\t\t\ttoolPart.toolName,\n\t\t\ttoolId,\n\t\t\ttoolPart.displayName,\n\t\t\ttoolPart.icon\n\t\t);\n\n\t\tconst chatRequestToolEntry: IChatRequestToolEntry = {\n\t\t\tid: toolId,\n\t\t\tname: 'new',\n\t\t\trange: toolPart.range,\n\t\t\tkind: 'tool',\n\t\t\tvalue: undefined\n\t\t};\n\n\t\tconst variableData: IChatRequestVariableData = {\n\t\t\tvariables: [chatRequestToolEntry]\n\t\t};\n\n\t\treturn new ChatRequestModel({\n\t\t\tsession: requestModel.session as ChatModel,\n\t\t\tmessage: {\n\t\t\t\tparts: requestModel.message.parts.map(part => {\n\t\t\t\t\tif (part instanceof ChatRequestToolPart) {\n\t\t\t\t\t\treturn newToolPart;\n\t\t\t\t\t}\n\t\t\t\t\treturn part;\n\t\t\t\t}),\n\t\t\t\ttext: requestModel.message.text\n\t\t\t},\n\t\t\tvariableData: variableData,\n\t\t\ttimestamp: Date.now(),\n\t\t\tattempt: requestModel.attempt,\n\t\t\tmodeInfo: requestModel.modeInfo,\n\t\t\tconfirmation: requestModel.confirmation,\n\t\t\tlocationData: requestModel.locationData,\n\t\t\tattachedContext: [chatRequestToolEntry],\n\t\t\tisCompleteAddedRequest: requestModel.isCompleteAddedRequest,\n\t\t});\n\t}\n}\n\n\nclass SetupTool implements IToolImpl {\n\n\tstatic registerTool(instantiationService: IInstantiationService, toolData: IToolData): IDisposable {\n\t\treturn instantiationService.invokeFunction(accessor => {\n\t\t\tconst toolService = accessor.get(ILanguageModelToolsService);\n\n\t\t\tconst tool = instantiationService.createInstance(SetupTool);\n\t\t\treturn toolService.registerTool(toolData, tool);\n\t\t});\n\t}\n\n\tasync invoke(invocation: IToolInvocation, countTokens: CountTokensCallback, progress: ToolProgress, token: CancellationToken): Promise<IToolResult> {\n\t\tconst result: IToolResult = {\n\t\t\tcontent: [\n\t\t\t\t{\n\t\t\t\t\tkind: 'text',\n\t\t\t\t\tvalue: ''\n\t\t\t\t}\n\t\t\t]\n\t\t};\n\n\t\treturn result;\n\t}\n\n\tasync prepareToolInvocation?(parameters: unknown, token: CancellationToken): Promise<IPreparedToolInvocation | undefined> {\n\t\treturn undefined;\n\t}\n}\n\nclass AINewSymbolNamesProvider {\n\n\tstatic registerProvider(instantiationService: IInstantiationService, context: ChatEntitlementContext, controller: Lazy<ChatSetupController>): IDisposable {\n\t\treturn instantiationService.invokeFunction(accessor => {\n\t\t\tconst languageFeaturesService = accessor.get(ILanguageFeaturesService);\n\n\t\t\tconst provider = instantiationService.createInstance(AINewSymbolNamesProvider, context, controller);\n\t\t\treturn languageFeaturesService.newSymbolNamesProvider.register('*', provider);\n\t\t});\n\t}\n\n\tconstructor(\n\t\tprivate readonly context: ChatEntitlementContext,\n\t\tprivate readonly controller: Lazy<ChatSetupController>,\n\t\t@IInstantiationService private readonly instantiationService: IInstantiationService,\n\t\t@IChatEntitlementService private readonly chatEntitlementService: IChatEntitlementService,\n\t) {\n\t}\n\n\tasync provideNewSymbolNames(model: ITextModel, range: IRange, triggerKind: NewSymbolNameTriggerKind, token: CancellationToken): Promise<NewSymbolName[] | undefined> {\n\t\tawait this.instantiationService.invokeFunction(accessor => {\n\t\t\treturn ChatSetup.getInstance(this.instantiationService, this.context, this.controller).run({\n\t\t\t\tforceAnonymous: this.chatEntitlementService.anonymous ? ChatSetupAnonymous.EnabledWithDialog : undefined\n\t\t\t});\n\t\t});\n\n\t\treturn [];\n\t}\n}\n\nclass ChatCodeActionsProvider {\n\n\tstatic registerProvider(instantiationService: IInstantiationService): IDisposable {\n\t\treturn instantiationService.invokeFunction(accessor => {\n\t\t\tconst languageFeaturesService = accessor.get(ILanguageFeaturesService);\n\n\t\t\tconst provider = instantiationService.createInstance(ChatCodeActionsProvider);\n\t\t\treturn languageFeaturesService.codeActionProvider.register('*', provider);\n\t\t});\n\t}\n\n\tconstructor(\n\t\t@IMarkerService private readonly markerService: IMarkerService,\n\t) {\n\t}\n\n\tasync provideCodeActions(model: ITextModel, range: Range | Selection): Promise<CodeActionList | undefined> {\n\t\tconst actions: CodeAction[] = [];\n\n\t\t// \"Generate\" if the line is whitespace only\n\t\t// \"Modify\" if there is a selection\n\t\tlet generateOrModifyTitle: string | undefined;\n\t\tlet generateOrModifyCommand: Command | undefined;\n\t\tif (range.isEmpty()) {\n\t\t\tconst textAtLine = model.getLineContent(range.startLineNumber);\n\t\t\tif (/^\\s*$/.test(textAtLine)) {\n\t\t\t\tgenerateOrModifyTitle = localize('generate', \"Generate\");\n\t\t\t\tgenerateOrModifyCommand = AICodeActionsHelper.generate(range);\n\t\t\t}\n\t\t} else {\n\t\t\tconst textInSelection = model.getValueInRange(range);\n\t\t\tif (!/^\\s*$/.test(textInSelection)) {\n\t\t\t\tgenerateOrModifyTitle = localize('modify', \"Modify\");\n\t\t\t\tgenerateOrModifyCommand = AICodeActionsHelper.modify(range);\n\t\t\t}\n\t\t}\n\n\t\tif (generateOrModifyTitle && generateOrModifyCommand) {\n\t\t\tactions.push({\n\t\t\t\tkind: CodeActionKind.RefactorRewrite.append('copilot').value,\n\t\t\t\tisAI: true,\n\t\t\t\ttitle: generateOrModifyTitle,\n\t\t\t\tcommand: generateOrModifyCommand,\n\t\t\t});\n\t\t}\n\n\t\tconst markers = AICodeActionsHelper.warningOrErrorMarkersAtRange(this.markerService, model.uri, range);\n\t\tif (markers.length > 0) {\n\n\t\t\t// \"Fix\" if there are diagnostics in the range\n\t\t\tactions.push({\n\t\t\t\tkind: CodeActionKind.QuickFix.append('copilot').value,\n\t\t\t\tisAI: true,\n\t\t\t\tdiagnostics: markers,\n\t\t\t\ttitle: localize('fix', \"Fix\"),\n\t\t\t\tcommand: AICodeActionsHelper.fixMarkers(markers, range)\n\t\t\t});\n\n\t\t\t// \"Explain\" if there are diagnostics in the range\n\t\t\tactions.push({\n\t\t\t\tkind: CodeActionKind.QuickFix.append('explain').append('copilot').value,\n\t\t\t\tisAI: true,\n\t\t\t\tdiagnostics: markers,\n\t\t\t\ttitle: localize('explain', \"Explain\"),\n\t\t\t\tcommand: AICodeActionsHelper.explainMarkers(markers)\n\t\t\t});\n\t\t}\n\n\t\treturn {\n\t\t\tactions,\n\t\t\tdispose() { }\n\t\t};\n\t}\n}\n\nclass AICodeActionsHelper {\n\n\tstatic warningOrErrorMarkersAtRange(markerService: IMarkerService, resource: URI, range: Range | Selection): IMarker[] {\n\t\treturn markerService\n\t\t\t.read({ resource, severities: MarkerSeverity.Error | MarkerSeverity.Warning })\n\t\t\t.filter(marker => range.startLineNumber <= marker.endLineNumber && range.endLineNumber >= marker.startLineNumber);\n\t}\n\n\tstatic modify(range: Range): Command {\n\t\treturn {\n\t\t\tid: INLINE_CHAT_START,\n\t\t\ttitle: localize('modify', \"Modify\"),\n\t\t\targuments: [\n\t\t\t\t{\n\t\t\t\t\tinitialSelection: this.rangeToSelection(range),\n\t\t\t\t\tinitialRange: range,\n\t\t\t\t\tposition: range.getStartPosition()\n\t\t\t\t} satisfies { initialSelection: ISelection; initialRange: IRange; position: IPosition }\n\t\t\t]\n\t\t};\n\t}\n\n\tstatic generate(range: Range): Command {\n\t\treturn {\n\t\t\tid: INLINE_CHAT_START,\n\t\t\ttitle: localize('generate', \"Generate\"),\n\t\t\targuments: [\n\t\t\t\t{\n\t\t\t\t\tinitialSelection: this.rangeToSelection(range),\n\t\t\t\t\tinitialRange: range,\n\t\t\t\t\tposition: range.getStartPosition()\n\t\t\t\t} satisfies { initialSelection: ISelection; initialRange: IRange; position: IPosition }\n\t\t\t]\n\t\t};\n\t}\n\n\tprivate static rangeToSelection(range: Range): ISelection {\n\t\treturn new Selection(range.startLineNumber, range.startColumn, range.endLineNumber, range.endColumn);\n\t}\n\n\tstatic explainMarkers(markers: IMarker[]): Command {\n\t\treturn {\n\t\t\tid: CHAT_OPEN_ACTION_ID,\n\t\t\ttitle: localize('explain', \"Explain\"),\n\t\t\targuments: [\n\t\t\t\t{\n\t\t\t\t\tquery: `@workspace /explain ${markers.map(marker => marker.message).join(', ')}`\n\t\t\t\t} satisfies { query: string }\n\t\t\t]\n\t\t};\n\t}\n\n\tstatic fixMarkers(markers: IMarker[], range: Range): Command {\n\t\treturn {\n\t\t\tid: INLINE_CHAT_START,\n\t\t\ttitle: localize('fix', \"Fix\"),\n\t\t\targuments: [\n\t\t\t\t{\n\t\t\t\t\tmessage: `/fix ${markers.map(marker => marker.message).join(', ')}`,\n\t\t\t\t\tautoSend: true,\n\t\t\t\t\tinitialSelection: this.rangeToSelection(range),\n\t\t\t\t\tinitialRange: range,\n\t\t\t\t\tposition: range.getStartPosition()\n\t\t\t\t} satisfies { message: string; autoSend: boolean; initialSelection: ISelection; initialRange: IRange; position: IPosition }\n\t\t\t]\n\t\t};\n\t}\n}\n\nenum ChatSetupStrategy {\n\tCanceled = 0,\n\tDefaultSetup = 1,\n\tSetupWithoutEnterpriseProvider = 2,\n\tSetupWithEnterpriseProvider = 3,\n\tSetupWithGoogleProvider = 4,\n\tSetupWithAppleProvider = 5,\n\tSetupWithGitHubProvider = 6\n}\n\ntype ChatSetupResultValue = boolean /* success */ | undefined /* canceled */;\n\ninterface IChatSetupResult {\n\treadonly success: ChatSetupResultValue;\n\treadonly dialogSkipped: boolean;\n}\n\nclass ChatSetup {\n\n\tprivate static instance: ChatSetup | undefined = undefined;\n\tstatic getInstance(instantiationService: IInstantiationService, context: ChatEntitlementContext, controller: Lazy<ChatSetupController>): ChatSetup {\n\t\tlet instance = ChatSetup.instance;\n\t\tif (!instance) {\n\t\t\tinstance = ChatSetup.instance = instantiationService.invokeFunction(accessor => {\n\t\t\t\treturn new ChatSetup(context, controller, accessor.get(ITelemetryService), accessor.get(IWorkbenchLayoutService), accessor.get(IKeybindingService), accessor.get(IChatEntitlementService) as ChatEntitlementService, accessor.get(ILogService), accessor.get(IConfigurationService), accessor.get(IChatWidgetService), accessor.get(IWorkspaceTrustRequestService), accessor.get(IMarkdownRendererService));\n\t\t\t});\n\t\t}\n\n\t\treturn instance;\n\t}\n\n\tprivate pendingRun: Promise<IChatSetupResult> | undefined = undefined;\n\n\tprivate skipDialogOnce = false;\n\n\tprivate constructor(\n\t\tprivate readonly context: ChatEntitlementContext,\n\t\tprivate readonly controller: Lazy<ChatSetupController>,\n\t\t@ITelemetryService private readonly telemetryService: ITelemetryService,\n\t\t@ILayoutService private readonly layoutService: IWorkbenchLayoutService,\n\t\t@IKeybindingService private readonly keybindingService: IKeybindingService,\n\t\t@IChatEntitlementService private readonly chatEntitlementService: ChatEntitlementService,\n\t\t@ILogService private readonly logService: ILogService,\n\t\t@IConfigurationService private readonly configurationService: IConfigurationService,\n\t\t@IChatWidgetService private readonly widgetService: IChatWidgetService,\n\t\t@IWorkspaceTrustRequestService private readonly workspaceTrustRequestService: IWorkspaceTrustRequestService,\n\t\t@IMarkdownRendererService private readonly markdownRendererService: IMarkdownRendererService,\n\t) { }\n\n\tskipDialog(): void {\n\t\tthis.skipDialogOnce = true;\n\t}\n\n\tasync run(options?: { disableChatViewReveal?: boolean; forceSignInDialog?: boolean; additionalScopes?: readonly string[]; forceAnonymous?: ChatSetupAnonymous }): Promise<IChatSetupResult> {\n\t\tif (this.pendingRun) {\n\t\t\treturn this.pendingRun;\n\t\t}\n\n\t\tthis.pendingRun = this.doRun(options);\n\n\t\ttry {\n\t\t\treturn await this.pendingRun;\n\t\t} finally {\n\t\t\tthis.pendingRun = undefined;\n\t\t}\n\t}\n\n\tprivate async doRun(options?: { disableChatViewReveal?: boolean; forceSignInDialog?: boolean; additionalScopes?: readonly string[]; forceAnonymous?: ChatSetupAnonymous }): Promise<IChatSetupResult> {\n\t\tthis.context.update({ later: false });\n\n\t\tconst dialogSkipped = this.skipDialogOnce;\n\t\tthis.skipDialogOnce = false;\n\n\t\tconst trusted = await this.workspaceTrustRequestService.requestWorkspaceTrust({\n\t\t\tmessage: localize('chatWorkspaceTrust', \"AI features are currently only supported in trusted workspaces.\")\n\t\t});\n\t\tif (!trusted) {\n\t\t\tthis.context.update({ later: true });\n\t\t\tthis.telemetryService.publicLog2<InstallChatEvent, InstallChatClassification>('commandCenter.chatInstall', { installResult: 'failedNotTrusted', installDuration: 0, signUpErrorCode: undefined, provider: undefined });\n\n\t\t\treturn { dialogSkipped, success: undefined /* canceled */ };\n\t\t}\n\n\t\tlet setupStrategy: ChatSetupStrategy;\n\t\tif (!options?.forceSignInDialog && (dialogSkipped || isProUser(this.chatEntitlementService.entitlement) || this.chatEntitlementService.entitlement === ChatEntitlement.Free)) {\n\t\t\tsetupStrategy = ChatSetupStrategy.DefaultSetup; // existing pro/free users setup without a dialog\n\t\t} else if (options?.forceAnonymous === ChatSetupAnonymous.EnabledWithoutDialog) {\n\t\t\tsetupStrategy = ChatSetupStrategy.DefaultSetup; // anonymous setup without a dialog\n\t\t} else {\n\t\t\tsetupStrategy = await this.showDialog(options);\n\t\t}\n\n\t\tif (setupStrategy === ChatSetupStrategy.DefaultSetup && ChatEntitlementRequests.providerId(this.configurationService) === defaultChat.provider.enterprise.id) {\n\t\t\tsetupStrategy = ChatSetupStrategy.SetupWithEnterpriseProvider; // users with a configured provider go through provider setup\n\t\t}\n\n\t\tif (setupStrategy !== ChatSetupStrategy.Canceled && !options?.disableChatViewReveal) {\n\t\t\t// Show the chat view now to better indicate progress\n\t\t\t// while installing the extension or returning from sign in\n\t\t\tthis.widgetService.revealWidget();\n\t\t}\n\n\t\tlet success: ChatSetupResultValue = undefined;\n\t\ttry {\n\t\t\tswitch (setupStrategy) {\n\t\t\t\tcase ChatSetupStrategy.SetupWithEnterpriseProvider:\n\t\t\t\t\tsuccess = await this.controller.value.setupWithProvider({ useEnterpriseProvider: true, useSocialProvider: undefined, additionalScopes: options?.additionalScopes, forceAnonymous: options?.forceAnonymous });\n\t\t\t\t\tbreak;\n\t\t\t\tcase ChatSetupStrategy.SetupWithoutEnterpriseProvider:\n\t\t\t\t\tsuccess = await this.controller.value.setupWithProvider({ useEnterpriseProvider: false, useSocialProvider: undefined, additionalScopes: options?.additionalScopes, forceAnonymous: options?.forceAnonymous });\n\t\t\t\t\tbreak;\n\t\t\t\tcase ChatSetupStrategy.SetupWithAppleProvider:\n\t\t\t\t\tsuccess = await this.controller.value.setupWithProvider({ useEnterpriseProvider: false, useSocialProvider: 'apple', additionalScopes: options?.additionalScopes, forceAnonymous: options?.forceAnonymous });\n\t\t\t\t\tbreak;\n\t\t\t\tcase ChatSetupStrategy.SetupWithGoogleProvider:\n\t\t\t\t\tsuccess = await this.controller.value.setupWithProvider({ useEnterpriseProvider: false, useSocialProvider: 'google', additionalScopes: options?.additionalScopes, forceAnonymous: options?.forceAnonymous });\n\t\t\t\t\tbreak;\n\t\t\t\tcase ChatSetupStrategy.SetupWithGitHubProvider:\n\t\t\t\t\t// Reserved for future use when Puku API supports GitHub OAuth\n\t\t\t\t\tthis.logService.info('[chat setup] GitHub sign-in not yet supported');\n\t\t\t\t\tsuccess = false;\n\t\t\t\t\tbreak;\n\t\t\t\tcase ChatSetupStrategy.DefaultSetup:\n\t\t\t\t\tsuccess = await this.controller.value.setup({ ...options, forceAnonymous: options?.forceAnonymous });\n\t\t\t\t\tbreak;\n\t\t\t\tcase ChatSetupStrategy.Canceled:\n\t\t\t\t\tthis.context.update({ later: true });\n\t\t\t\t\tthis.telemetryService.publicLog2<InstallChatEvent, InstallChatClassification>('commandCenter.chatInstall', { installResult: 'failedMaybeLater', installDuration: 0, signUpErrorCode: undefined, provider: undefined });\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t} catch (error) {\n\t\t\tthis.logService.error(`[chat setup] Error during setup: ${toErrorMessage(error)}`);\n\t\t\tsuccess = false;\n\t\t}\n\n\t\treturn { success, dialogSkipped };\n\t}\n\n\tprivate async showDialog(options?: { forceSignInDialog?: boolean; forceAnonymous?: ChatSetupAnonymous }): Promise<ChatSetupStrategy> {\n\t\tconst disposables = new DisposableStore();\n\n\t\tconst buttons = this.getButtons(options);\n\n\t\tconst dialog = disposables.add(new Dialog(\n\t\t\tthis.layoutService.activeContainer,\n\t\t\tthis.getDialogTitle(options),\n\t\t\tbuttons.map(button => button[0]),\n\t\t\tcreateWorkbenchDialogOptions({\n\t\t\t\ttype: 'none',\n\t\t\t\textraClasses: ['chat-setup-dialog'],\n\t\t\t\tdetail: ' ', // workaround allowing us to render the message in large\n\t\t\t\ticon: Codicon.sparkle,\n\t\t\t\talignment: DialogContentsAlignment.Vertical,\n\t\t\t\tcancelId: buttons.length - 1,\n\t\t\t\tdisableCloseButton: true,\n\t\t\t\trenderFooter: footer => footer.appendChild(this.createDialogFooter(disposables, options)),\n\t\t\t\tbuttonOptions: buttons.map(button => button[2])\n\t\t\t}, this.keybindingService, this.layoutService)\n\t\t));\n\n\t\tconst { button } = await dialog.show();\n\t\tdisposables.dispose();\n\n\t\treturn buttons[button]?.[1] ?? ChatSetupStrategy.Canceled;\n\t}\n\n\tprivate getButtons(options?: { forceSignInDialog?: boolean; forceAnonymous?: ChatSetupAnonymous }): Array<[string, ChatSetupStrategy, { styleButton?: (button: IButton) => void } | undefined]> {\n\t\ttype ContinueWithButton = [string, ChatSetupStrategy, { styleButton?: (button: IButton) => void } | undefined];\n\t\tconst styleButton = (...classes: string[]) => ({ styleButton: (button: IButton) => button.element.classList.add(...classes) });\n\n\t\tlet buttons: Array<ContinueWithButton>;\n\t\tif (!options?.forceAnonymous && (this.context.state.entitlement === ChatEntitlement.Unknown || options?.forceSignInDialog)) {\n\t\t\t// Puku Editor: Show Google sign-in button only (GitHub will be added when Puku API supports it)\n\t\t\tconst googleProviderButton: ContinueWithButton = [localize('signInWithGoogle', \"Sign in with Google\"), ChatSetupStrategy.SetupWithGoogleProvider, styleButton('continue-button', 'google')];\n\n\t\t\tbuttons = [googleProviderButton];\n\t\t} else {\n\t\t\tbuttons = [[localize('setupAIButton', \"Use AI Features\"), ChatSetupStrategy.DefaultSetup, undefined]];\n\t\t}\n\n\t\tbuttons.push([localize('skipForNow', \"Skip for now\"), ChatSetupStrategy.Canceled, styleButton('link-button', 'skip-button')]);\n\n\t\treturn buttons;\n\t}\n\n\tprivate getDialogTitle(options?: { forceSignInDialog?: boolean; forceAnonymous?: ChatSetupAnonymous }): string {\n\t\tif (this.chatEntitlementService.anonymous) {\n\t\t\tif (options?.forceAnonymous) {\n\t\t\t\treturn localize('startUsing', \"Start using AI Features\");\n\t\t\t} else {\n\t\t\t\treturn localize('enableMore', \"Enable more AI features\");\n\t\t\t}\n\t\t}\n\n\t\tif (this.context.state.entitlement === ChatEntitlement.Unknown || options?.forceSignInDialog) {\n\t\t\treturn localize('signIn', \"Sign in to use AI Features\");\n\t\t}\n\n\t\treturn localize('startUsing', \"Start using AI Features\");\n\t}\n\n\tprivate createDialogFooter(disposables: DisposableStore, options?: { forceAnonymous?: ChatSetupAnonymous }): HTMLElement {\n\t\tconst element = $('.chat-setup-dialog-footer');\n\n\n\t\tlet footer: string;\n\t\tif (options?.forceAnonymous || this.telemetryService.telemetryLevel === TelemetryLevel.NONE) {\n\t\t\tfooter = localize({ key: 'settingsAnonymous', comment: ['{Locked=\"[\"}', '{Locked=\"]({1})\"}', '{Locked=\"]({2})\"}'] }, \"By continuing, you agree to {0}'s [Terms]({1}) and [Privacy Statement]({2}).\", defaultChat.provider.default.name, defaultChat.termsStatementUrl, defaultChat.privacyStatementUrl);\n\t\t} else {\n\t\t\tfooter = localize({ key: 'settings', comment: ['{Locked=\"[\"}', '{Locked=\"]({1})\"}', '{Locked=\"]({2})\"}', '{Locked=\"]({4})\"}', '{Locked=\"]({5})\"}'] }, \"By continuing, you agree to {0}'s [Terms]({1}) and [Privacy Statement]({2}). {3} Copilot may show [public code]({4}) suggestions and use your data to improve the product. You can change these [settings]({5}) anytime.\", defaultChat.provider.default.name, defaultChat.termsStatementUrl, defaultChat.privacyStatementUrl, defaultChat.provider.default.name, defaultChat.publicCodeMatchesUrl, defaultChat.manageSettingsUrl);\n\t\t}\n\t\telement.appendChild($('p', undefined, disposables.add(this.markdownRendererService.render(new MarkdownString(footer, { isTrusted: true }))).element));\n\n\t\treturn element;\n\t}\n}\n\nexport class ChatSetupContribution extends Disposable implements IWorkbenchContribution {\n\n\tstatic readonly ID = 'workbench.contrib.chatSetup';\n\n\tconstructor(\n\t\t@IProductService private readonly productService: IProductService,\n\t\t@IInstantiationService private readonly instantiationService: IInstantiationService,\n\t\t@ICommandService private readonly commandService: ICommandService,\n\t\t@ITelemetryService private readonly telemetryService: ITelemetryService,\n\t\t@IChatEntitlementService chatEntitlementService: ChatEntitlementService,\n\t\t@IChatModeService private readonly chatModeService: IChatModeService,\n\t\t@ILogService private readonly logService: ILogService,\n\t\t@IContextKeyService private readonly contextKeyService: IContextKeyService,\n\t\t@IWorkbenchExtensionEnablementService private readonly extensionEnablementService: IWorkbenchExtensionEnablementService,\n\t\t@IExtensionsWorkbenchService private readonly extensionsWorkbenchService: IExtensionsWorkbenchService,\n\t\t@IExtensionService private readonly extensionService: IExtensionService,\n\t\t@IEnvironmentService private readonly environmentService: IEnvironmentService,\n\t\t@IConfigurationService private readonly configurationService: IConfigurationService,\n\t) {\n\t\tsuper();\n\n\t\tconst context = chatEntitlementService.context?.value;\n\t\tconst requests = chatEntitlementService.requests?.value;\n\t\tif (!context || !requests) {\n\t\t\treturn; // disabled\n\t\t}\n\n\t\tconst controller = new Lazy(() => this._register(this.instantiationService.createInstance(ChatSetupController, context, requests)));\n\n\t\tthis.registerSetupAgents(context, controller);\n\t\tthis.registerActions(context, requests, controller);\n\t\tthis.registerUrlLinkHandler();\n\t\tthis.checkExtensionInstallation(context);\n\t}\n\n\tprivate registerSetupAgents(context: ChatEntitlementContext, controller: Lazy<ChatSetupController>): void {\n\t\tif (this.configurationService.getValue<boolean>('chat.experimental.disableCoreAgents')) {\n\t\t\treturn; // TODO@bpasero eventually remove this when we figured out extension activation issues\n\t\t}\n\n\t\tconst defaultAgentDisposables = markAsSingleton(new MutableDisposable()); // prevents flicker on window reload\n\t\tconst vscodeAgentDisposables = markAsSingleton(new MutableDisposable());\n\n\t\tconst renameProviderDisposables = markAsSingleton(new MutableDisposable());\n\t\tconst codeActionsProviderDisposables = markAsSingleton(new MutableDisposable());\n\n\t\tconst updateRegistration = () => {\n\n\t\t\t// Agent + Tools\n\t\t\t{\n\t\t\t\tif (!context.state.hidden && !context.state.disabled) {\n\n\t\t\t\t\t// Default Agents (always, even if installed to allow for speedy requests right on startup)\n\t\t\t\t\tif (!defaultAgentDisposables.value) {\n\t\t\t\t\t\tconst disposables = defaultAgentDisposables.value = new DisposableStore();\n\n\t\t\t\t\t\t// Panel Agents\n\t\t\t\t\t\tconst panelAgentDisposables = disposables.add(new DisposableStore());\n\t\t\t\t\t\tfor (const mode of [ChatModeKind.Ask, ChatModeKind.Edit, ChatModeKind.Agent]) {\n\t\t\t\t\t\t\tconst { agent, disposable } = SetupAgent.registerDefaultAgents(this.instantiationService, ChatAgentLocation.Chat, mode, context, controller);\n\t\t\t\t\t\t\tpanelAgentDisposables.add(disposable);\n\t\t\t\t\t\t\tpanelAgentDisposables.add(agent.onUnresolvableError(() => {\n\t\t\t\t\t\t\t\tconst panelAgentHasGuidance = chatViewsWelcomeRegistry.get().some(descriptor => this.contextKeyService.contextMatchesRules(descriptor.when));\n\t\t\t\t\t\t\t\tif (panelAgentHasGuidance) {\n\t\t\t\t\t\t\t\t\t// An unresolvable error from our agent registrations means that\n\t\t\t\t\t\t\t\t\t// Chat is unhealthy for some reason. We clear our panel\n\t\t\t\t\t\t\t\t\t// registration to give Chat a chance to show a custom message\n\t\t\t\t\t\t\t\t\t// to the user from the views and stop pretending as if there was\n\t\t\t\t\t\t\t\t\t// a functional agent.\n\t\t\t\t\t\t\t\t\tthis.logService.error('[chat setup] Unresolvable error from Chat agent registration, clearing registration.');\n\t\t\t\t\t\t\t\t\tpanelAgentDisposables.dispose();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}));\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Inline Agents\n\t\t\t\t\t\tdisposables.add(SetupAgent.registerDefaultAgents(this.instantiationService, ChatAgentLocation.Terminal, undefined, context, controller).disposable);\n\t\t\t\t\t\tdisposables.add(SetupAgent.registerDefaultAgents(this.instantiationService, ChatAgentLocation.Notebook, undefined, context, controller).disposable);\n\t\t\t\t\t\tdisposables.add(SetupAgent.registerDefaultAgents(this.instantiationService, ChatAgentLocation.EditorInline, undefined, context, controller).disposable);\n\t\t\t\t\t}\n\n\t\t\t\t\t// Built-In Agent + Tool (unless installed, signed-in and enabled)\n\t\t\t\t\tif ((!context.state.installed || context.state.entitlement === ChatEntitlement.Unknown || context.state.entitlement === ChatEntitlement.Unresolved) && !vscodeAgentDisposables.value) {\n\t\t\t\t\t\tconst disposables = vscodeAgentDisposables.value = new DisposableStore();\n\t\t\t\t\t\tdisposables.add(SetupAgent.registerBuiltInAgents(this.instantiationService, context, controller));\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tdefaultAgentDisposables.clear();\n\t\t\t\t\tvscodeAgentDisposables.clear();\n\t\t\t\t}\n\n\t\t\t\tif (context.state.installed && !context.state.disabled) {\n\t\t\t\t\tvscodeAgentDisposables.clear(); // we need to do this to prevent showing duplicate agent/tool entries in the list\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Rename Provider\n\t\t\t{\n\t\t\t\tif (!context.state.installed && !context.state.hidden && !context.state.disabled) {\n\t\t\t\t\tif (!renameProviderDisposables.value) {\n\t\t\t\t\t\trenameProviderDisposables.value = AINewSymbolNamesProvider.registerProvider(this.instantiationService, context, controller);\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\trenameProviderDisposables.clear();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Code Actions Provider\n\t\t\t{\n\t\t\t\tif (!context.state.installed && !context.state.hidden && !context.state.disabled) {\n\t\t\t\t\tif (!codeActionsProviderDisposables.value) {\n\t\t\t\t\t\tcodeActionsProviderDisposables.value = ChatCodeActionsProvider.registerProvider(this.instantiationService);\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tcodeActionsProviderDisposables.clear();\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\tthis._register(Event.runAndSubscribe(context.onDidChange, () => updateRegistration()));\n\t}\n\n\tprivate registerActions(context: ChatEntitlementContext, requests: ChatEntitlementRequests, controller: Lazy<ChatSetupController>): void {\n\n\t\t//#region Global Chat Setup Actions\n\n\t\tclass ChatSetupTriggerAction extends Action2 {\n\n\t\t\tstatic CHAT_SETUP_ACTION_LABEL = localize2('triggerChatSetup', \"Use AI Features with Copilot for free...\");\n\n\t\t\tconstructor() {\n\t\t\t\tsuper({\n\t\t\t\t\tid: CHAT_SETUP_ACTION_ID,\n\t\t\t\t\ttitle: ChatSetupTriggerAction.CHAT_SETUP_ACTION_LABEL,\n\t\t\t\t\tcategory: CHAT_CATEGORY,\n\t\t\t\t\tf1: true,\n\t\t\t\t\tprecondition: ContextKeyExpr.or(\n\t\t\t\t\t\tChatContextKeys.Setup.hidden,\n\t\t\t\t\t\tChatContextKeys.Setup.disabled,\n\t\t\t\t\t\tChatContextKeys.Setup.untrusted,\n\t\t\t\t\t\tChatContextKeys.Setup.installed.negate(),\n\t\t\t\t\t\tChatContextKeys.Entitlement.canSignUp\n\t\t\t\t\t)\n\t\t\t\t});\n\t\t\t}\n\n\t\t\toverride async run(accessor: ServicesAccessor, mode?: ChatModeKind | string, options?: { forceSignInDialog?: boolean; additionalScopes?: readonly string[]; forceAnonymous?: ChatSetupAnonymous }): Promise<boolean> {\n\t\t\t\tconst widgetService = accessor.get(IChatWidgetService);\n\t\t\t\tconst instantiationService = accessor.get(IInstantiationService);\n\t\t\t\tconst dialogService = accessor.get(IDialogService);\n\t\t\t\tconst commandService = accessor.get(ICommandService);\n\t\t\t\tconst lifecycleService = accessor.get(ILifecycleService);\n\t\t\t\tconst configurationService = accessor.get(IConfigurationService);\n\n\t\t\t\tawait context.update({ hidden: false });\n\t\t\t\tconfigurationService.updateValue(ChatTeardownContribution.CHAT_DISABLED_CONFIGURATION_KEY, false);\n\n\t\t\t\tif (mode) {\n\t\t\t\t\tconst chatWidget = await widgetService.revealWidget();\n\t\t\t\t\tchatWidget?.input.setChatMode(mode);\n\t\t\t\t}\n\n\t\t\t\tconst setup = ChatSetup.getInstance(instantiationService, context, controller);\n\t\t\t\tconst { success } = await setup.run(options);\n\t\t\t\tif (success === false && !lifecycleService.willShutdown) {\n\t\t\t\t\tconst { confirmed } = await dialogService.confirm({\n\t\t\t\t\t\ttype: Severity.Error,\n\t\t\t\t\t\tmessage: localize('setupErrorDialog', \"Chat setup failed. Would you like to try again?\"),\n\t\t\t\t\t\tprimaryButton: localize('retry', \"Retry\"),\n\t\t\t\t\t});\n\n\t\t\t\t\tif (confirmed) {\n\t\t\t\t\t\treturn Boolean(await commandService.executeCommand(CHAT_SETUP_ACTION_ID, mode, options));\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn Boolean(success);\n\t\t\t}\n\t\t}\n\n\t\tclass ChatSetupTriggerSupportAnonymousAction extends Action2 {\n\n\t\t\tconstructor() {\n\t\t\t\tsuper({\n\t\t\t\t\tid: CHAT_SETUP_SUPPORT_ANONYMOUS_ACTION_ID,\n\t\t\t\t\ttitle: ChatSetupTriggerAction.CHAT_SETUP_ACTION_LABEL\n\t\t\t\t});\n\t\t\t}\n\n\t\t\toverride async run(accessor: ServicesAccessor): Promise<unknown> {\n\t\t\t\tconst commandService = accessor.get(ICommandService);\n\t\t\t\tconst telemetryService = accessor.get(ITelemetryService);\n\t\t\t\tconst chatEntitlementService = accessor.get(IChatEntitlementService);\n\n\t\t\t\ttelemetryService.publicLog2<WorkbenchActionExecutedEvent, WorkbenchActionExecutedClassification>('workbenchActionExecuted', { id: CHAT_SETUP_ACTION_ID, from: 'api' });\n\n\t\t\t\treturn commandService.executeCommand(CHAT_SETUP_ACTION_ID, undefined, {\n\t\t\t\t\tforceAnonymous: chatEntitlementService.anonymous ? ChatSetupAnonymous.EnabledWithDialog : undefined\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tclass ChatSetupTriggerForceSignInDialogAction extends Action2 {\n\n\t\t\tconstructor() {\n\t\t\t\tsuper({\n\t\t\t\t\tid: 'workbench.action.chat.triggerSetupForceSignIn',\n\t\t\t\t\ttitle: localize2('forceSignIn', \"Sign in to use AI features\")\n\t\t\t\t});\n\t\t\t}\n\n\t\t\toverride async run(accessor: ServicesAccessor): Promise<unknown> {\n\t\t\t\tconst commandService = accessor.get(ICommandService);\n\t\t\t\tconst telemetryService = accessor.get(ITelemetryService);\n\n\t\t\t\ttelemetryService.publicLog2<WorkbenchActionExecutedEvent, WorkbenchActionExecutedClassification>('workbenchActionExecuted', { id: CHAT_SETUP_ACTION_ID, from: 'api' });\n\n\t\t\t\treturn commandService.executeCommand(CHAT_SETUP_ACTION_ID, undefined, { forceSignInDialog: true });\n\t\t\t}\n\t\t}\n\n\t\tclass ChatSetupTriggerAnonymousWithoutDialogAction extends Action2 {\n\n\t\t\tconstructor() {\n\t\t\t\tsuper({\n\t\t\t\t\tid: 'workbench.action.chat.triggerSetupAnonymousWithoutDialog',\n\t\t\t\t\ttitle: ChatSetupTriggerAction.CHAT_SETUP_ACTION_LABEL\n\t\t\t\t});\n\t\t\t}\n\n\t\t\toverride async run(accessor: ServicesAccessor): Promise<unknown> {\n\t\t\t\tconst commandService = accessor.get(ICommandService);\n\t\t\t\tconst telemetryService = accessor.get(ITelemetryService);\n\n\t\t\t\ttelemetryService.publicLog2<WorkbenchActionExecutedEvent, WorkbenchActionExecutedClassification>('workbenchActionExecuted', { id: CHAT_SETUP_ACTION_ID, from: 'api' });\n\n\t\t\t\treturn commandService.executeCommand(CHAT_SETUP_ACTION_ID, undefined, { forceAnonymous: ChatSetupAnonymous.EnabledWithoutDialog });\n\t\t\t}\n\t\t}\n\n\t\tclass ChatSetupFromAccountsAction extends Action2 {\n\n\t\t\tconstructor() {\n\t\t\t\tsuper({\n\t\t\t\t\tid: 'workbench.action.chat.triggerSetupFromAccounts',\n\t\t\t\t\ttitle: localize2('triggerChatSetupFromAccounts', \"Sign in to use AI features...\"),\n\t\t\t\t\tmenu: {\n\t\t\t\t\t\tid: MenuId.AccountsContext,\n\t\t\t\t\t\tgroup: '2_copilot',\n\t\t\t\t\t\twhen: ContextKeyExpr.and(\n\t\t\t\t\t\t\tChatContextKeys.Setup.hidden.negate(),\n\t\t\t\t\t\t\tChatContextKeys.Setup.installed.negate(),\n\t\t\t\t\t\t\tChatContextKeys.Entitlement.signedOut\n\t\t\t\t\t\t)\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\n\t\t\toverride async run(accessor: ServicesAccessor): Promise<void> {\n\t\t\t\tconst commandService = accessor.get(ICommandService);\n\t\t\t\tconst telemetryService = accessor.get(ITelemetryService);\n\n\t\t\t\ttelemetryService.publicLog2<WorkbenchActionExecutedEvent, WorkbenchActionExecutedClassification>('workbenchActionExecuted', { id: CHAT_SETUP_ACTION_ID, from: 'accounts' });\n\n\t\t\t\treturn commandService.executeCommand(CHAT_SETUP_ACTION_ID);\n\t\t\t}\n\t\t}\n\n\t\tconst windowFocusListener = this._register(new MutableDisposable());\n\t\tclass UpgradePlanAction extends Action2 {\n\t\t\tconstructor() {\n\t\t\t\tsuper({\n\t\t\t\t\tid: 'workbench.action.chat.upgradePlan',\n\t\t\t\t\ttitle: localize2('managePlan', \"Upgrade to Puku AI Pro\"),\n\t\t\t\t\tcategory: localize2('chat.category', 'Chat'),\n\t\t\t\t\tf1: true,\n\t\t\t\t\tprecondition: ContextKeyExpr.and(\n\t\t\t\t\t\tChatContextKeys.Setup.hidden.negate(),\n\t\t\t\t\t\tContextKeyExpr.or(\n\t\t\t\t\t\t\tChatContextKeys.Entitlement.canSignUp,\n\t\t\t\t\t\t\tChatContextKeys.Entitlement.planFree\n\t\t\t\t\t\t)\n\t\t\t\t\t),\n\t\t\t\t\tmenu: {\n\t\t\t\t\t\tid: MenuId.ChatTitleBarMenu,\n\t\t\t\t\t\tgroup: 'a_first',\n\t\t\t\t\t\torder: 1,\n\t\t\t\t\t\twhen: ContextKeyExpr.and(\n\t\t\t\t\t\t\tChatContextKeys.Entitlement.planFree,\n\t\t\t\t\t\t\tContextKeyExpr.or(\n\t\t\t\t\t\t\t\tChatContextKeys.chatQuotaExceeded,\n\t\t\t\t\t\t\t\tChatContextKeys.completionsQuotaExceeded\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t)\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\n\t\t\toverride async run(accessor: ServicesAccessor): Promise<void> {\n\t\t\t\tconst openerService = accessor.get(IOpenerService);\n\t\t\t\tconst hostService = accessor.get(IHostService);\n\t\t\t\tconst commandService = accessor.get(ICommandService);\n\n\t\t\t\topenerService.open(URI.parse(defaultChat.upgradePlanUrl));\n\n\t\t\t\tconst entitlement = context.state.entitlement;\n\t\t\t\tif (!isProUser(entitlement)) {\n\t\t\t\t\t// If the user is not yet Pro, we listen to window focus to refresh the token\n\t\t\t\t\t// when the user has come back to the window assuming the user signed up.\n\t\t\t\t\twindowFocusListener.value = hostService.onDidChangeFocus(focus => this.onWindowFocus(focus, commandService));\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tprivate async onWindowFocus(focus: boolean, commandService: ICommandService): Promise<void> {\n\t\t\t\tif (focus) {\n\t\t\t\t\twindowFocusListener.clear();\n\n\t\t\t\t\tconst entitlements = await requests.forceResolveEntitlement(undefined);\n\t\t\t\t\tif (entitlements?.entitlement && isProUser(entitlements?.entitlement)) {\n\t\t\t\t\t\trefreshTokens(commandService);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tclass EnableOveragesAction extends Action2 {\n\t\t\tconstructor() {\n\t\t\t\tsuper({\n\t\t\t\t\tid: 'workbench.action.chat.manageOverages',\n\t\t\t\t\ttitle: localize2('manageOverages', \"Manage Puku AI Overages\"),\n\t\t\t\t\tcategory: localize2('chat.category', 'Chat'),\n\t\t\t\t\tf1: true,\n\t\t\t\t\tprecondition: ContextKeyExpr.and(\n\t\t\t\t\t\tChatContextKeys.Setup.hidden.negate(),\n\t\t\t\t\t\tContextKeyExpr.or(\n\t\t\t\t\t\t\tChatContextKeys.Entitlement.planPro,\n\t\t\t\t\t\t\tChatContextKeys.Entitlement.planProPlus,\n\t\t\t\t\t\t)\n\t\t\t\t\t),\n\t\t\t\t\tmenu: {\n\t\t\t\t\t\tid: MenuId.ChatTitleBarMenu,\n\t\t\t\t\t\tgroup: 'a_first',\n\t\t\t\t\t\torder: 1,\n\t\t\t\t\t\twhen: ContextKeyExpr.and(\n\t\t\t\t\t\t\tContextKeyExpr.or(\n\t\t\t\t\t\t\t\tChatContextKeys.Entitlement.planPro,\n\t\t\t\t\t\t\t\tChatContextKeys.Entitlement.planProPlus,\n\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\tContextKeyExpr.or(\n\t\t\t\t\t\t\t\tChatContextKeys.chatQuotaExceeded,\n\t\t\t\t\t\t\t\tChatContextKeys.completionsQuotaExceeded\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t)\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\n\t\t\toverride async run(accessor: ServicesAccessor): Promise<void> {\n\t\t\t\tconst openerService = accessor.get(IOpenerService);\n\t\t\t\topenerService.open(URI.parse(defaultChat.manageOveragesUrl));\n\t\t\t}\n\t\t}\n\n\t\tregisterAction2(ChatSetupTriggerAction);\n\t\tregisterAction2(ChatSetupTriggerForceSignInDialogAction);\n\t\tregisterAction2(ChatSetupFromAccountsAction);\n\t\tregisterAction2(ChatSetupTriggerAnonymousWithoutDialogAction);\n\t\tregisterAction2(ChatSetupTriggerSupportAnonymousAction);\n\t\tregisterAction2(UpgradePlanAction);\n\t\tregisterAction2(EnableOveragesAction);\n\n\t\t// Puku Editor: Register puku.signIn command to trigger sign-in dialog\n\t\tCommandsRegistry.registerCommand('puku.signIn', async (accessor: ServicesAccessor) => {\n\t\t\tconst commandService = accessor.get(ICommandService);\n\t\t\tconst telemetryService = accessor.get(ITelemetryService);\n\t\t\ttelemetryService.publicLog2<WorkbenchActionExecutedEvent, WorkbenchActionExecutedClassification>('workbenchActionExecuted', { id: 'puku.signIn', from: 'status-bar' });\n\t\t\treturn commandService.executeCommand(CHAT_SETUP_ACTION_ID, undefined, { forceSignInDialog: true });\n\t\t});\n\n\t\t// Puku Editor: Internal commands to bridge VS Code layer auth with extension layer\n\t\tCommandsRegistry.registerCommand('_puku.getSessionToken', async (accessor: ServicesAccessor) => {\n\t\t\tconst pukuAuthService = accessor.get(IPukuAuthService);\n\t\t\tconst token = pukuAuthService.getSessionToken();\n\t\t\treturn token ? { token } : undefined;\n\t\t});\n\n\t\tCommandsRegistry.registerCommand('_puku.getUserInfo', async (accessor: ServicesAccessor) => {\n\t\t\tconst pukuAuthService = accessor.get(IPukuAuthService);\n\t\t\treturn pukuAuthService.session?.user;\n\t\t});\n\n\t\tCommandsRegistry.registerCommand('_puku.isAuthenticated', async (accessor: ServicesAccessor) => {\n\t\t\tconst pukuAuthService = accessor.get(IPukuAuthService);\n\t\t\treturn pukuAuthService.isAuthenticated();\n\t\t});\n\n\t\tCommandsRegistry.registerCommand('_puku.signIn', async (accessor: ServicesAccessor) => {\n\t\t\tconst pukuAuthService = accessor.get(IPukuAuthService);\n\t\t\treturn pukuAuthService.signInWithGoogle();\n\t\t});\n\n\t\t//#endregion\n\n\t\t//#region Editor Context Menu\n\n\t\t// TODO@bpasero remove these when Chat extension is built-in\n\t\t{\n\t\t\tfunction registerGenerateCodeCommand(coreCommand: 'chat.internal.explain' | 'chat.internal.fix' | 'chat.internal.review' | 'chat.internal.generateDocs' | 'chat.internal.generateTests', actualCommand: string): void {\n\n\t\t\t\tCommandsRegistry.registerCommand(coreCommand, async accessor => {\n\t\t\t\t\tconst commandService = accessor.get(ICommandService);\n\t\t\t\t\tconst codeEditorService = accessor.get(ICodeEditorService);\n\t\t\t\t\tconst markerService = accessor.get(IMarkerService);\n\n\t\t\t\t\tswitch (coreCommand) {\n\t\t\t\t\t\tcase 'chat.internal.explain':\n\t\t\t\t\t\tcase 'chat.internal.fix': {\n\t\t\t\t\t\t\tconst textEditor = codeEditorService.getActiveCodeEditor();\n\t\t\t\t\t\t\tconst uri = textEditor?.getModel()?.uri;\n\t\t\t\t\t\t\tconst range = textEditor?.getSelection();\n\t\t\t\t\t\t\tif (!uri || !range) {\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tconst markers = AICodeActionsHelper.warningOrErrorMarkersAtRange(markerService, uri, range);\n\n\t\t\t\t\t\t\tconst actualCommand = coreCommand === 'chat.internal.explain'\n\t\t\t\t\t\t\t\t? AICodeActionsHelper.explainMarkers(markers)\n\t\t\t\t\t\t\t\t: AICodeActionsHelper.fixMarkers(markers, range);\n\n\t\t\t\t\t\t\tawait commandService.executeCommand(actualCommand.id, ...(actualCommand.arguments ?? []));\n\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tcase 'chat.internal.review':\n\t\t\t\t\t\tcase 'chat.internal.generateDocs':\n\t\t\t\t\t\tcase 'chat.internal.generateTests': {\n\t\t\t\t\t\t\tconst result = await commandService.executeCommand(CHAT_SETUP_SUPPORT_ANONYMOUS_ACTION_ID);\n\t\t\t\t\t\t\tif (result) {\n\t\t\t\t\t\t\t\tawait commandService.executeCommand(actualCommand);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t\tregisterGenerateCodeCommand('chat.internal.explain', 'github.copilot.chat.explain');\n\t\t\tregisterGenerateCodeCommand('chat.internal.fix', 'github.copilot.chat.fix');\n\t\t\tregisterGenerateCodeCommand('chat.internal.review', 'github.copilot.chat.review');\n\t\t\tregisterGenerateCodeCommand('chat.internal.generateDocs', 'github.copilot.chat.generateDocs');\n\t\t\tregisterGenerateCodeCommand('chat.internal.generateTests', 'github.copilot.chat.generateTests');\n\n\t\t\tconst internalGenerateCodeContext = ContextKeyExpr.and(\n\t\t\t\tChatContextKeys.Setup.hidden.negate(),\n\t\t\t\tChatContextKeys.Setup.disabled.negate(),\n\t\t\t\tChatContextKeys.Setup.installed.negate(),\n\t\t\t);\n\n\t\t\tMenuRegistry.appendMenuItem(MenuId.EditorContext, {\n\t\t\t\tcommand: {\n\t\t\t\t\tid: 'chat.internal.explain',\n\t\t\t\t\ttitle: localize('explain', \"Explain\"),\n\t\t\t\t},\n\t\t\t\tgroup: '1_chat',\n\t\t\t\torder: 4,\n\t\t\t\twhen: internalGenerateCodeContext\n\t\t\t});\n\n\t\t\tMenuRegistry.appendMenuItem(MenuId.ChatTextEditorMenu, {\n\t\t\t\tcommand: {\n\t\t\t\t\tid: 'chat.internal.fix',\n\t\t\t\t\ttitle: localize('fix', \"Fix\"),\n\t\t\t\t},\n\t\t\t\tgroup: '1_action',\n\t\t\t\torder: 1,\n\t\t\t\twhen: ContextKeyExpr.and(\n\t\t\t\t\tinternalGenerateCodeContext,\n\t\t\t\t\tEditorContextKeys.readOnly.negate()\n\t\t\t\t)\n\t\t\t});\n\n\t\t\tMenuRegistry.appendMenuItem(MenuId.ChatTextEditorMenu, {\n\t\t\t\tcommand: {\n\t\t\t\t\tid: 'chat.internal.review',\n\t\t\t\t\ttitle: localize('review', \"Code Review\"),\n\t\t\t\t},\n\t\t\t\tgroup: '1_action',\n\t\t\t\torder: 2,\n\t\t\t\twhen: internalGenerateCodeContext\n\t\t\t});\n\n\t\t\tMenuRegistry.appendMenuItem(MenuId.ChatTextEditorMenu, {\n\t\t\t\tcommand: {\n\t\t\t\t\tid: 'chat.internal.generateDocs',\n\t\t\t\t\ttitle: localize('generateDocs', \"Generate Docs\"),\n\t\t\t\t},\n\t\t\t\tgroup: '2_generate',\n\t\t\t\torder: 1,\n\t\t\t\twhen: ContextKeyExpr.and(\n\t\t\t\t\tinternalGenerateCodeContext,\n\t\t\t\t\tEditorContextKeys.readOnly.negate()\n\t\t\t\t)\n\t\t\t});\n\n\t\t\tMenuRegistry.appendMenuItem(MenuId.ChatTextEditorMenu, {\n\t\t\t\tcommand: {\n\t\t\t\t\tid: 'chat.internal.generateTests',\n\t\t\t\t\ttitle: localize('generateTests', \"Generate Tests\"),\n\t\t\t\t},\n\t\t\t\tgroup: '2_generate',\n\t\t\t\torder: 2,\n\t\t\t\twhen: ContextKeyExpr.and(\n\t\t\t\t\tinternalGenerateCodeContext,\n\t\t\t\t\tEditorContextKeys.readOnly.negate()\n\t\t\t\t)\n\t\t\t});\n\t\t}\n\t}\n\n\tprivate registerUrlLinkHandler(): void {\n\t\tthis._register(ExtensionUrlHandlerOverrideRegistry.registerHandler({\n\t\t\tcanHandleURL: url => {\n\t\t\t\treturn url.scheme === this.productService.urlProtocol && equalsIgnoreCase(url.authority, defaultChat.chatExtensionId);\n\t\t\t},\n\t\t\thandleURL: async url => {\n\t\t\t\tconst params = new URLSearchParams(url.query);\n\t\t\t\tthis.telemetryService.publicLog2<WorkbenchActionExecutedEvent, WorkbenchActionExecutedClassification>('workbenchActionExecuted', { id: CHAT_SETUP_ACTION_ID, from: 'url', detail: params.get('referrer') ?? undefined });\n\n\t\t\t\tconst agentParam = params.get('agent') ?? params.get('mode');\n\t\t\t\tif (agentParam) {\n\t\t\t\t\tconst agents = this.chatModeService.getModes();\n\t\t\t\t\tconst allAgents = [...agents.builtin, ...agents.custom];\n\n\t\t\t\t\t// check if the given param is a valid mode ID\n\t\t\t\t\tlet foundAgent = allAgents.find(agent => agent.id === agentParam);\n\t\t\t\t\tif (!foundAgent) {\n\t\t\t\t\t\t// if not, check if the given param is a valid mode name, note the parameter as name is case insensitive\n\t\t\t\t\t\tconst nameLower = agentParam.toLowerCase();\n\t\t\t\t\t\tfoundAgent = allAgents.find(agent => agent.name.get().toLowerCase() === nameLower);\n\t\t\t\t\t}\n\t\t\t\t\t// execute the command to change the mode in panel, note that the command only supports mode IDs, not names\n\t\t\t\t\tawait this.commandService.executeCommand(CHAT_SETUP_ACTION_ID, foundAgent?.id);\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}));\n\t}\n\n\tprivate async checkExtensionInstallation(context: ChatEntitlementContext): Promise<void> {\n\n\t\t// When developing extensions, await registration and then check\n\t\tif (this.environmentService.isExtensionDevelopment) {\n\t\t\tawait this.extensionService.whenInstalledExtensionsRegistered();\n\t\t\tif (this.extensionService.extensions.find(ext => ExtensionIdentifier.equals(ext.identifier, defaultChat.chatExtensionId))) {\n\t\t\t\tcontext.update({ installed: true, disabled: false, untrusted: false });\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\t// Await extensions to be ready to be queried\n\t\tawait this.extensionsWorkbenchService.queryLocal();\n\n\t\t// Listen to extensions change and process extensions once\n\t\tthis._register(Event.runAndSubscribe<IExtension | undefined>(this.extensionsWorkbenchService.onChange, e => {\n\t\t\tif (e && !ExtensionIdentifier.equals(e.identifier.id, defaultChat.chatExtensionId)) {\n\t\t\t\treturn; // unrelated event\n\t\t\t}\n\n\t\t\tconst defaultChatExtension = this.extensionsWorkbenchService.local.find(value => ExtensionIdentifier.equals(value.identifier.id, defaultChat.chatExtensionId));\n\t\t\tconst installed = !!defaultChatExtension?.local;\n\n\t\t\tlet disabled: boolean;\n\t\t\tlet untrusted = false;\n\t\t\tif (installed) {\n\t\t\t\tdisabled = !this.extensionEnablementService.isEnabled(defaultChatExtension.local);\n\t\t\t\tif (disabled) {\n\t\t\t\t\tconst state = this.extensionEnablementService.getEnablementState(defaultChatExtension.local);\n\t\t\t\t\tif (state === EnablementState.DisabledByTrustRequirement) {\n\t\t\t\t\t\tdisabled = false; // not disabled by user choice but\n\t\t\t\t\t\tuntrusted = true; // by missing workspace trust\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tdisabled = false;\n\t\t\t}\n\n\t\t\tcontext.update({ installed, disabled, untrusted });\n\t\t}));\n\t}\n}\n\nexport class ChatTeardownContribution extends Disposable implements IWorkbenchContribution {\n\n\tstatic readonly ID = 'workbench.contrib.chatTeardown';\n\n\tstatic readonly CHAT_DISABLED_CONFIGURATION_KEY = 'chat.disableAIFeatures';\n\n\tconstructor(\n\t\t@IChatEntitlementService chatEntitlementService: ChatEntitlementService,\n\t\t@IConfigurationService private readonly configurationService: IConfigurationService,\n\t\t@IExtensionsWorkbenchService private readonly extensionsWorkbenchService: IExtensionsWorkbenchService,\n\t\t@IWorkbenchExtensionEnablementService private readonly extensionEnablementService: IWorkbenchExtensionEnablementService,\n\t\t@IViewDescriptorService private readonly viewDescriptorService: IViewDescriptorService,\n\t\t@IWorkbenchLayoutService private readonly layoutService: IWorkbenchLayoutService\n\t) {\n\t\tsuper();\n\n\t\tconst context = chatEntitlementService.context?.value;\n\t\tif (!context) {\n\t\t\treturn; // disabled\n\t\t}\n\n\t\tthis.registerListeners();\n\t\tthis.registerActions();\n\n\t\tthis.handleChatDisabled(false);\n\t}\n\n\tprivate handleChatDisabled(fromEvent: boolean): void {\n\t\tconst chatDisabled = this.configurationService.inspect(ChatTeardownContribution.CHAT_DISABLED_CONFIGURATION_KEY);\n\t\tif (chatDisabled.value === true) {\n\t\t\tthis.maybeEnableOrDisableExtension(typeof chatDisabled.workspaceValue === 'boolean' ? EnablementState.DisabledWorkspace : EnablementState.DisabledGlobally);\n\t\t\tif (fromEvent) {\n\t\t\t\tthis.maybeHideAuxiliaryBar();\n\t\t\t}\n\t\t} else if (chatDisabled.value === false && fromEvent /* do not enable extensions unless its an explicit settings change */) {\n\t\t\tthis.maybeEnableOrDisableExtension(typeof chatDisabled.workspaceValue === 'boolean' ? EnablementState.EnabledWorkspace : EnablementState.EnabledGlobally);\n\t\t}\n\t}\n\n\tprivate async registerListeners(): Promise<void> {\n\n\t\t// Configuration changes\n\t\tthis._register(this.configurationService.onDidChangeConfiguration(e => {\n\t\t\tif (!e.affectsConfiguration(ChatTeardownContribution.CHAT_DISABLED_CONFIGURATION_KEY)) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.handleChatDisabled(true);\n\t\t}));\n\n\t\t// Extension installation\n\t\tawait this.extensionsWorkbenchService.queryLocal();\n\t\tthis._register(this.extensionsWorkbenchService.onChange(e => {\n\t\t\tif (e && !ExtensionIdentifier.equals(e.identifier.id, defaultChat.chatExtensionId)) {\n\t\t\t\treturn; // unrelated event\n\t\t\t}\n\n\t\t\tconst defaultChatExtension = this.extensionsWorkbenchService.local.find(value => ExtensionIdentifier.equals(value.identifier.id, defaultChat.chatExtensionId));\n\t\t\tif (defaultChatExtension?.local && this.extensionEnablementService.isEnabled(defaultChatExtension.local)) {\n\t\t\t\tthis.configurationService.updateValue(ChatTeardownContribution.CHAT_DISABLED_CONFIGURATION_KEY, false);\n\t\t\t}\n\t\t}));\n\t}\n\n\tprivate async maybeEnableOrDisableExtension(state: EnablementState.EnabledGlobally | EnablementState.EnabledWorkspace | EnablementState.DisabledGlobally | EnablementState.DisabledWorkspace): Promise<void> {\n\t\tconst defaultChatExtension = this.extensionsWorkbenchService.local.find(value => ExtensionIdentifier.equals(value.identifier.id, defaultChat.chatExtensionId));\n\t\tif (!defaultChatExtension) {\n\t\t\treturn;\n\t\t}\n\n\t\tawait this.extensionsWorkbenchService.setEnablement([defaultChatExtension], state);\n\t\tawait this.extensionsWorkbenchService.updateRunningExtensions(state === EnablementState.EnabledGlobally || state === EnablementState.EnabledWorkspace ? localize('restartExtensionHost.reason.enable', \"Enabling AI features\") : localize('restartExtensionHost.reason.disable', \"Disabling AI features\"));\n\t}\n\n\tprivate maybeHideAuxiliaryBar(): void {\n\t\tconst activeContainers = this.viewDescriptorService.getViewContainersByLocation(ViewContainerLocation.AuxiliaryBar).filter(\n\t\t\tcontainer => this.viewDescriptorService.getViewContainerModel(container).activeViewDescriptors.length > 0\n\t\t);\n\t\tif (\n\t\t\t(activeContainers.length === 0) ||  \t\t\t\t\t\t\t\t\t\t\t\t\t// chat view is already gone but we know it was there before\n\t\t\t(activeContainers.length === 1 && activeContainers.at(0)?.id === CHAT_SIDEBAR_PANEL_ID) // chat view is the only view which is going to go away\n\t\t) {\n\t\t\tthis.layoutService.setPartHidden(true, Parts.AUXILIARYBAR_PART); // hide if there are no views in the secondary sidebar\n\t\t}\n\t}\n\n\tprivate registerActions(): void {\n\n\t\tclass ChatSetupHideAction extends Action2 {\n\n\t\t\tstatic readonly ID = 'workbench.action.chat.hideSetup';\n\t\t\tstatic readonly TITLE = localize2('hideChatSetup', \"Learn How to Hide AI Features\");\n\n\t\t\tconstructor() {\n\t\t\t\tsuper({\n\t\t\t\t\tid: ChatSetupHideAction.ID,\n\t\t\t\t\ttitle: ChatSetupHideAction.TITLE,\n\t\t\t\t\tf1: true,\n\t\t\t\t\tcategory: CHAT_CATEGORY,\n\t\t\t\t\tprecondition: ChatContextKeys.Setup.hidden.negate(),\n\t\t\t\t\tmenu: {\n\t\t\t\t\t\tid: MenuId.ChatTitleBarMenu,\n\t\t\t\t\t\tgroup: 'z_hide',\n\t\t\t\t\t\torder: 1,\n\t\t\t\t\t\twhen: ChatContextKeys.Setup.installed.negate()\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\n\t\t\toverride async run(accessor: ServicesAccessor): Promise<void> {\n\t\t\t\tconst preferencesService = accessor.get(IPreferencesService);\n\n\t\t\t\tpreferencesService.openSettings({ jsonEditor: false, query: `@id:${ChatTeardownContribution.CHAT_DISABLED_CONFIGURATION_KEY}` });\n\t\t\t}\n\t\t}\n\n\t\tregisterAction2(ChatSetupHideAction);\n\t}\n}\n\n//#endregion\n\n//#region Setup Controller\n\ntype InstallChatClassification = {\n\towner: 'bpasero';\n\tcomment: 'Provides insight into chat installation.';\n\tinstallResult: { classification: 'SystemMetaData'; purpose: 'FeatureInsight'; comment: 'Whether the extension was installed successfully, cancelled or failed to install.' };\n\tinstallDuration: { classification: 'SystemMetaData'; purpose: 'FeatureInsight'; comment: 'The duration it took to install the extension.' };\n\tsignUpErrorCode: { classification: 'SystemMetaData'; purpose: 'FeatureInsight'; comment: 'The error code in case of an error signing up.' };\n\tprovider: { classification: 'SystemMetaData'; purpose: 'FeatureInsight'; comment: 'The provider used for the chat installation.' };\n};\ntype InstallChatEvent = {\n\tinstallResult: 'installed' | 'alreadyInstalled' | 'cancelled' | 'failedInstall' | 'failedNotSignedIn' | 'failedSignUp' | 'failedNotTrusted' | 'failedNoSession' | 'failedMaybeLater' | 'failedEnterpriseSetup';\n\tinstallDuration: number;\n\tsignUpErrorCode: number | undefined;\n\tprovider: string | undefined;\n};\n\nenum ChatSetupStep {\n\tInitial = 1,\n\tSigningIn,\n\tInstalling\n}\n\ninterface IChatSetupControllerOptions {\n\treadonly forceSignIn?: boolean;\n\treadonly useSocialProvider?: string;\n\treadonly useEnterpriseProvider?: boolean;\n\treadonly additionalScopes?: readonly string[];\n\treadonly forceAnonymous?: ChatSetupAnonymous;\n}\n\nclass ChatSetupController extends Disposable {\n\n\tprivate readonly _onDidChange = this._register(new Emitter<void>());\n\treadonly onDidChange = this._onDidChange.event;\n\n\tprivate _step = ChatSetupStep.Initial;\n\tget step(): ChatSetupStep { return this._step; }\n\n\tconstructor(\n\t\tprivate readonly context: ChatEntitlementContext,\n\t\tprivate readonly requests: ChatEntitlementRequests,\n\t\t@ITelemetryService private readonly telemetryService: ITelemetryService,\n\t\t@IAuthenticationService private readonly authenticationService: IAuthenticationService,\n\t\t@IExtensionsWorkbenchService private readonly _extensionsWorkbenchService: IExtensionsWorkbenchService,\n\t\t@IProductService private readonly _productService: IProductService,\n\t\t@ILogService private readonly logService: ILogService,\n\t\t@IProgressService private readonly progressService: IProgressService,\n\t\t@IActivityService private readonly activityService: IActivityService,\n\t\t@ICommandService private readonly commandService: ICommandService,\n\t\t@IDialogService private readonly dialogService: IDialogService,\n\t\t@IConfigurationService private readonly configurationService: IConfigurationService,\n\t\t@ILifecycleService private readonly lifecycleService: ILifecycleService,\n\t\t@IQuickInputService private readonly quickInputService: IQuickInputService,\n\t) {\n\t\tsuper();\n\n\t\tthis.registerListeners();\n\t}\n\n\tprivate registerListeners(): void {\n\t\tthis._register(this.context.onDidChange(() => this._onDidChange.fire()));\n\t}\n\n\tprivate setStep(step: ChatSetupStep): void {\n\t\tif (this._step === step) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._step = step;\n\t\tthis._onDidChange.fire();\n\t}\n\n\tasync setup(options: IChatSetupControllerOptions = {}): Promise<ChatSetupResultValue> {\n\t\tconst watch = new StopWatch(false);\n\t\tconst title = localize('setupChatProgress', \"Getting chat ready...\");\n\t\tconst badge = this.activityService.showViewContainerActivity(CHAT_SIDEBAR_PANEL_ID, {\n\t\t\tbadge: new ProgressBadge(() => title),\n\t\t});\n\n\t\ttry {\n\t\t\treturn await this.progressService.withProgress({\n\t\t\t\tlocation: ProgressLocation.Window,\n\t\t\t\tcommand: CHAT_OPEN_ACTION_ID,\n\t\t\t\ttitle,\n\t\t\t}, () => this.doSetup(options, watch));\n\t\t} finally {\n\t\t\tbadge.dispose();\n\t\t}\n\t}\n\n\tprivate async doSetup(options: IChatSetupControllerOptions, watch: StopWatch): Promise<ChatSetupResultValue> {\n\t\tthis.context.suspend();  // reduces flicker\n\n\t\tlet success: ChatSetupResultValue = false;\n\t\ttry {\n\t\t\tconst providerId = ChatEntitlementRequests.providerId(this.configurationService);\n\t\t\tlet session: AuthenticationSession | undefined;\n\t\t\tlet entitlement: ChatEntitlement | undefined;\n\n\t\t\tlet signIn: boolean;\n\t\t\tif (options.forceSignIn) {\n\t\t\t\tsignIn = true; // forced to sign in\n\t\t\t} else if (this.context.state.entitlement === ChatEntitlement.Unknown) {\n\t\t\t\tif (options.forceAnonymous) {\n\t\t\t\t\tsignIn = false; // forced to anonymous without sign in\n\t\t\t\t} else {\n\t\t\t\t\tsignIn = true; // sign in since we are signed out\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tsignIn = false; // already signed in\n\t\t\t}\n\n\t\t\tif (signIn) {\n\t\t\t\tthis.setStep(ChatSetupStep.SigningIn);\n\t\t\t\tconst result = await this.signIn(options);\n\t\t\t\tif (!result.session) {\n\t\t\t\t\tthis.doInstall(); // still install the extension in the background to remind the user to sign-in eventually\n\n\t\t\t\t\tconst provider = options.useSocialProvider ?? (options.useEnterpriseProvider ? defaultChat.provider.enterprise.id : defaultChat.provider.default.id);\n\t\t\t\t\tthis.telemetryService.publicLog2<InstallChatEvent, InstallChatClassification>('commandCenter.chatInstall', { installResult: 'failedNotSignedIn', installDuration: watch.elapsed(), signUpErrorCode: undefined, provider });\n\t\t\t\t\treturn undefined; // treat as cancelled because signing in already triggers an error dialog\n\t\t\t\t}\n\n\t\t\t\tsession = result.session;\n\t\t\t\tentitlement = result.entitlement;\n\t\t\t}\n\n\t\t\t// Await Install\n\t\t\tthis.setStep(ChatSetupStep.Installing);\n\t\t\tsuccess = await this.install(session, entitlement ?? this.context.state.entitlement, providerId, watch, options);\n\t\t} finally {\n\t\t\tthis.setStep(ChatSetupStep.Initial);\n\t\t\tthis.context.resume();\n\t\t}\n\n\t\treturn success;\n\t}\n\n\tprivate async signIn(options: IChatSetupControllerOptions): Promise<{ session: AuthenticationSession | undefined; entitlement: ChatEntitlement | undefined }> {\n\t\tlet session: AuthenticationSession | undefined;\n\t\tlet entitlements;\n\t\ttry {\n\t\t\t({ session, entitlements } = await this.requests.signIn(options));\n\t\t} catch (e) {\n\t\t\tthis.logService.error(`[chat setup] signIn: error ${e}`);\n\t\t}\n\n\t\tif (!session && !this.lifecycleService.willShutdown) {\n\t\t\tconst { confirmed } = await this.dialogService.confirm({\n\t\t\t\ttype: Severity.Error,\n\t\t\t\tmessage: localize('unknownSignInError', \"Failed to sign in to {0}. Would you like to try again?\", ChatEntitlementRequests.providerId(this.configurationService) === defaultChat.provider.enterprise.id ? defaultChat.provider.enterprise.name : defaultChat.provider.default.name),\n\t\t\t\tdetail: localize('unknownSignInErrorDetail', \"You must be signed in to use AI features.\"),\n\t\t\t\tprimaryButton: localize('retry', \"Retry\")\n\t\t\t});\n\n\t\t\tif (confirmed) {\n\t\t\t\treturn this.signIn(options);\n\t\t\t}\n\t\t}\n\n\t\treturn { session, entitlement: entitlements?.entitlement };\n\t}\n\n\tprivate async install(session: AuthenticationSession | undefined, entitlement: ChatEntitlement, providerId: string, watch: StopWatch, options: IChatSetupControllerOptions): Promise<ChatSetupResultValue> {\n\t\tconst wasRunning = this.context.state.installed && !this.context.state.disabled;\n\t\tlet signUpResult: boolean | { errorCode: number } | undefined = undefined;\n\n\t\tlet provider: string;\n\t\tif (options.forceAnonymous && entitlement === ChatEntitlement.Unknown) {\n\t\t\tprovider = 'anonymous';\n\t\t} else {\n\t\t\tprovider = options.useSocialProvider ?? (options.useEnterpriseProvider ? defaultChat.provider.enterprise.id : defaultChat.provider.default.id);\n\t\t}\n\n\t\tlet sessions = session ? [session] : undefined;\n\t\ttry {\n\t\t\tif (\n\t\t\t\t!options.forceAnonymous &&\t\t\t\t\t\t// User is not asking for anonymous access\n\t\t\t\tentitlement !== ChatEntitlement.Free &&\t\t\t// User is not signed up to Puku Free\n\t\t\t\t!isProUser(entitlement) &&\t\t\t\t\t\t// User is not signed up for a Copilot subscription\n\t\t\t\tentitlement !== ChatEntitlement.Unavailable\t\t// User is eligible for Puku Free\n\t\t\t) {\n\t\t\t\tif (!sessions) {\n\t\t\t\t\ttry {\n\t\t\t\t\t\t// Consider all sessions for the provider to be suitable for signing up\n\t\t\t\t\t\tconst existingSessions = await this.authenticationService.getSessions(providerId);\n\t\t\t\t\t\tsessions = existingSessions.length > 0 ? [...existingSessions] : undefined;\n\t\t\t\t\t} catch (error) {\n\t\t\t\t\t\t// ignore - errors can throw if a provider is not registered\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!sessions || sessions.length === 0) {\n\t\t\t\t\t\tthis.telemetryService.publicLog2<InstallChatEvent, InstallChatClassification>('commandCenter.chatInstall', { installResult: 'failedNoSession', installDuration: watch.elapsed(), signUpErrorCode: undefined, provider });\n\t\t\t\t\t\treturn false; // unexpected\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tsignUpResult = await this.requests.signUpFree(sessions);\n\n\t\t\t\tif (typeof signUpResult !== 'boolean' /* error */) {\n\t\t\t\t\tthis.telemetryService.publicLog2<InstallChatEvent, InstallChatClassification>('commandCenter.chatInstall', { installResult: 'failedSignUp', installDuration: watch.elapsed(), signUpErrorCode: signUpResult.errorCode, provider });\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tawait this.doInstallWithRetry();\n\t\t} catch (error) {\n\t\t\tthis.logService.error(`[chat setup] install: error ${error}`);\n\t\t\tthis.telemetryService.publicLog2<InstallChatEvent, InstallChatClassification>('commandCenter.chatInstall', { installResult: isCancellationError(error) ? 'cancelled' : 'failedInstall', installDuration: watch.elapsed(), signUpErrorCode: undefined, provider });\n\t\t\treturn false;\n\t\t}\n\n\t\tif (typeof signUpResult === 'boolean' /* not an error case */ || typeof signUpResult === 'undefined' /* already signed up */) {\n\t\t\tthis.telemetryService.publicLog2<InstallChatEvent, InstallChatClassification>('commandCenter.chatInstall', { installResult: wasRunning && !signUpResult ? 'alreadyInstalled' : 'installed', installDuration: watch.elapsed(), signUpErrorCode: undefined, provider });\n\t\t}\n\n\t\tif (wasRunning) {\n\t\t\t// We always trigger refresh of tokens to help the user\n\t\t\t// get out of authentication issues that can happen when\n\t\t\t// for example the sign-up ran after the extension tried\n\t\t\t// to use the authentication information to mint a token\n\t\t\trefreshTokens(this.commandService);\n\t\t}\n\n\t\treturn true;\n\t}\n\n\tprivate async doInstallWithRetry(): Promise<void> {\n\t\tlet error: Error | undefined;\n\t\ttry {\n\t\t\tawait this.doInstall();\n\t\t} catch (e) {\n\t\t\tthis.logService.error(`[chat setup] install: error ${error}`);\n\t\t\terror = e;\n\t\t}\n\n\t\tif (error) {\n\t\t\tif (!this.lifecycleService.willShutdown) {\n\t\t\t\tconst { confirmed } = await this.dialogService.confirm({\n\t\t\t\t\ttype: Severity.Error,\n\t\t\t\t\tmessage: localize('unknownSetupError', \"An error occurred while setting up chat. Would you like to try again?\"),\n\t\t\t\t\tdetail: error && !isCancellationError(error) ? toErrorMessage(error) : undefined,\n\t\t\t\t\tprimaryButton: localize('retry', \"Retry\")\n\t\t\t\t});\n\n\t\t\t\tif (confirmed) {\n\t\t\t\t\treturn this.doInstallWithRetry();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthrow error;\n\t\t}\n\t}\n\n\tprivate async doInstall(): Promise<void> {\n\t\t// Skip extension installation for Puku - extension is loaded via development mode\n\t\t// The Puku extension (Puku.puku-editor) is not available in marketplace\n\t\tthis.logService.info('[chat setup] Skipping extension installation - Puku extension is loaded in development mode');\n\n\t\t// Keep references to prevent unused variable errors\n\t\tvoid this._extensionsWorkbenchService;\n\t\tvoid this._productService;\n\t\tvoid ChatViewId;\n\t\treturn;\n\t}\n\n\tasync setupWithProvider(options: IChatSetupControllerOptions): Promise<ChatSetupResultValue> {\n\t\tconst registry = Registry.as<IConfigurationRegistry>(ConfigurationExtensions.Configuration);\n\t\tregistry.registerConfiguration({\n\t\t\t'id': 'copilot.setup',\n\t\t\t'type': 'object',\n\t\t\t'properties': {\n\t\t\t\t[defaultChat.completionsAdvancedSetting]: {\n\t\t\t\t\t'type': 'object',\n\t\t\t\t\t'properties': {\n\t\t\t\t\t\t'authProvider': {\n\t\t\t\t\t\t\t'type': 'string'\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t[defaultChat.providerUriSetting]: {\n\t\t\t\t\t'type': 'string'\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tif (options.useEnterpriseProvider) {\n\t\t\tconst success = await this.handleEnterpriseInstance();\n\t\t\tif (!success) {\n\t\t\t\tthis.telemetryService.publicLog2<InstallChatEvent, InstallChatClassification>('commandCenter.chatInstall', { installResult: 'failedEnterpriseSetup', installDuration: 0, signUpErrorCode: undefined, provider: undefined });\n\t\t\t\treturn success; // not properly configured, abort\n\t\t\t}\n\t\t}\n\n\t\tlet existingAdvancedSetting = this.configurationService.inspect(defaultChat.completionsAdvancedSetting).user?.value;\n\t\tif (!isObject(existingAdvancedSetting)) {\n\t\t\texistingAdvancedSetting = {};\n\t\t}\n\n\t\tif (options.useEnterpriseProvider) {\n\t\t\tawait this.configurationService.updateValue(`${defaultChat.completionsAdvancedSetting}`, {\n\t\t\t\t...existingAdvancedSetting,\n\t\t\t\t'authProvider': defaultChat.provider.enterprise.id\n\t\t\t}, ConfigurationTarget.USER);\n\t\t} else {\n\t\t\tawait this.configurationService.updateValue(`${defaultChat.completionsAdvancedSetting}`, Object.keys(existingAdvancedSetting).length > 0 ? {\n\t\t\t\t...existingAdvancedSetting,\n\t\t\t\t'authProvider': undefined\n\t\t\t} : undefined, ConfigurationTarget.USER);\n\t\t}\n\n\t\treturn this.setup({ ...options, forceSignIn: true });\n\t}\n\n\tprivate async handleEnterpriseInstance(): Promise<ChatSetupResultValue> {\n\t\tconst domainRegEx = /^[a-zA-Z\\-_]+$/;\n\t\tconst fullUriRegEx = /^(https:\\/\\/)?([a-zA-Z0-9-]+\\.)*[a-zA-Z0-9-]+\\.ghe\\.com\\/?$/;\n\n\t\tconst uri = this.configurationService.getValue<string>(defaultChat.providerUriSetting);\n\t\tif (typeof uri === 'string' && fullUriRegEx.test(uri)) {\n\t\t\treturn true; // already setup with a valid URI\n\t\t}\n\n\t\tlet isSingleWord = false;\n\t\tconst result = await this.quickInputService.input({\n\t\t\tprompt: localize('enterpriseInstance', \"What is your {0} instance?\", defaultChat.provider.enterprise.name),\n\t\t\tplaceHolder: localize('enterpriseInstancePlaceholder', 'i.e. \"octocat\" or \"https://octocat.ghe.com\"...'),\n\t\t\tignoreFocusLost: true,\n\t\t\tvalue: uri,\n\t\t\tvalidateInput: async value => {\n\t\t\t\tisSingleWord = false;\n\t\t\t\tif (!value) {\n\t\t\t\t\treturn undefined;\n\t\t\t\t}\n\n\t\t\t\tif (domainRegEx.test(value)) {\n\t\t\t\t\tisSingleWord = true;\n\t\t\t\t\treturn {\n\t\t\t\t\t\tcontent: localize('willResolveTo', \"Will resolve to {0}\", `https://${value}.ghe.com`),\n\t\t\t\t\t\tseverity: Severity.Info\n\t\t\t\t\t};\n\t\t\t\t} if (!fullUriRegEx.test(value)) {\n\t\t\t\t\treturn {\n\t\t\t\t\t\tcontent: localize('invalidEnterpriseInstance', 'You must enter a valid {0} instance (i.e. \"octocat\" or \"https://octocat.ghe.com\")', defaultChat.provider.enterprise.name),\n\t\t\t\t\t\tseverity: Severity.Error\n\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\treturn undefined;\n\t\t\t}\n\t\t});\n\n\t\tif (!result) {\n\t\t\treturn undefined; // canceled\n\t\t}\n\n\t\tlet resolvedUri = result;\n\t\tif (isSingleWord) {\n\t\t\tresolvedUri = `https://${resolvedUri}.ghe.com`;\n\t\t} else {\n\t\t\tconst normalizedUri = result.toLowerCase();\n\t\t\tconst hasHttps = normalizedUri.startsWith('https://');\n\t\t\tif (!hasHttps) {\n\t\t\t\tresolvedUri = `https://${result}`;\n\t\t\t}\n\t\t}\n\n\t\tawait this.configurationService.updateValue(defaultChat.providerUriSetting, resolvedUri, ConfigurationTarget.USER);\n\n\t\treturn true;\n\t}\n}\n\n//#endregion\n\nfunction refreshTokens(commandService: ICommandService): void {\n\t// ugly, but we need to signal to the extension that entitlements changed\n\tcommandService.executeCommand(defaultChat.completionsRefreshTokenCommand);\n\tcommandService.executeCommand(defaultChat.chatRefreshTokenCommand);\n}\n"]}