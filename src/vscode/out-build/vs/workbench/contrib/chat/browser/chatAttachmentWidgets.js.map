{"version":3,"sources":["vs/workbench/contrib/chat/browser/chatAttachmentWidgets.ts"],"names":[],"mappings":"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","file":"chatAttachmentWidgets.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as dom from '../../../../base/browser/dom.js';\nimport { $ } from '../../../../base/browser/dom.js';\nimport { StandardKeyboardEvent } from '../../../../base/browser/keyboardEvent.js';\nimport { StandardMouseEvent } from '../../../../base/browser/mouseEvent.js';\nimport { Button } from '../../../../base/browser/ui/button/button.js';\nimport { HoverStyle, type IHoverLifecycleOptions, type IHoverOptions } from '../../../../base/browser/ui/hover/hover.js';\nimport { createInstantHoverDelegate } from '../../../../base/browser/ui/hover/hoverDelegateFactory.js';\nimport { HoverPosition } from '../../../../base/browser/ui/hover/hoverWidget.js';\nimport { Codicon } from '../../../../base/common/codicons.js';\nimport * as event from '../../../../base/common/event.js';\nimport { MarkdownString } from '../../../../base/common/htmlContent.js';\nimport { Iterable } from '../../../../base/common/iterator.js';\nimport { KeyCode } from '../../../../base/common/keyCodes.js';\nimport { Disposable, DisposableStore, IDisposable } from '../../../../base/common/lifecycle.js';\nimport { Schemas } from '../../../../base/common/network.js';\nimport { basename, dirname } from '../../../../base/common/path.js';\nimport { ThemeIcon } from '../../../../base/common/themables.js';\nimport { URI } from '../../../../base/common/uri.js';\nimport { IRange } from '../../../../editor/common/core/range.js';\nimport { EditorContextKeys } from '../../../../editor/common/editorContextKeys.js';\nimport { LanguageFeatureRegistry } from '../../../../editor/common/languageFeatureRegistry.js';\nimport { Location, SymbolKind } from '../../../../editor/common/languages.js';\nimport { ILanguageService } from '../../../../editor/common/languages/language.js';\nimport { ILanguageFeaturesService } from '../../../../editor/common/services/languageFeatures.js';\nimport { IModelService } from '../../../../editor/common/services/model.js';\nimport { ITextModelService } from '../../../../editor/common/services/resolverService.js';\nimport { localize } from '../../../../nls.js';\nimport { getFlatContextMenuActions } from '../../../../platform/actions/browser/menuEntryActionViewItem.js';\nimport { IMenuService, MenuId } from '../../../../platform/actions/common/actions.js';\nimport { ICommandService } from '../../../../platform/commands/common/commands.js';\nimport { IContextKey, IContextKeyService, IScopedContextKeyService, RawContextKey } from '../../../../platform/contextkey/common/contextkey.js';\nimport { IContextMenuService } from '../../../../platform/contextview/browser/contextView.js';\nimport { fillInSymbolsDragData } from '../../../../platform/dnd/browser/dnd.js';\nimport { IOpenEditorOptions, registerOpenEditorListeners } from '../../../../platform/editor/browser/editor.js';\nimport { ITextEditorOptions } from '../../../../platform/editor/common/editor.js';\nimport { FileKind, IFileService } from '../../../../platform/files/common/files.js';\nimport { IHoverService } from '../../../../platform/hover/browser/hover.js';\nimport { IInstantiationService, ServicesAccessor } from '../../../../platform/instantiation/common/instantiation.js';\nimport { ILabelService } from '../../../../platform/label/common/label.js';\nimport { IOpenerService, OpenInternalOptions } from '../../../../platform/opener/common/opener.js';\nimport { FolderThemeIcon, IThemeService } from '../../../../platform/theme/common/themeService.js';\nimport { fillEditorsDragData } from '../../../browser/dnd.js';\nimport { IFileLabelOptions, IResourceLabel, ResourceLabels } from '../../../browser/labels.js';\nimport { ResourceContextKey } from '../../../common/contextkeys.js';\nimport { IEditorService, SIDE_GROUP } from '../../../services/editor/common/editorService.js';\nimport { IPreferencesService } from '../../../services/preferences/common/preferences.js';\nimport { revealInSideBarCommand } from '../../files/browser/fileActions.contribution.js';\nimport { CellUri } from '../../notebook/common/notebookCommon.js';\nimport { INotebookService } from '../../notebook/common/notebookService.js';\nimport { getHistoryItemEditorTitle } from '../../scm/browser/util.js';\nimport { ITerminalService } from '../../terminal/browser/terminal.js';\nimport { IChatContentReference } from '../common/chatService.js';\nimport { IChatRequestPasteVariableEntry, IChatRequestVariableEntry, IElementVariableEntry, INotebookOutputVariableEntry, IPromptFileVariableEntry, IPromptTextVariableEntry, ISCMHistoryItemVariableEntry, OmittedState, PromptFileVariableKind, ChatRequestToolReferenceEntry, ISCMHistoryItemChangeVariableEntry, ISCMHistoryItemChangeRangeVariableEntry, ITerminalVariableEntry } from '../common/chatVariableEntries.js';\nimport { ILanguageModelChatMetadataAndIdentifier, ILanguageModelsService } from '../common/languageModels.js';\nimport { ILanguageModelToolsService, ToolSet } from '../common/languageModelToolsService.js';\nimport { getCleanPromptName } from '../common/promptSyntax/config/promptFileLocations.js';\n\nconst commonHoverOptions: Partial<IHoverOptions> = {\n\tstyle: HoverStyle.Pointer,\n\tposition: {\n\t\thoverPosition: HoverPosition.BELOW\n\t},\n\ttrapFocus: true,\n};\nconst commonHoverLifecycleOptions: IHoverLifecycleOptions = {\n\tgroupId: 'chat-attachments',\n};\n\nabstract class AbstractChatAttachmentWidget extends Disposable {\n\tpublic readonly element: HTMLElement;\n\tpublic readonly label: IResourceLabel;\n\n\tprivate readonly _onDidDelete: event.Emitter<Event> = this._register(new event.Emitter<Event>());\n\tget onDidDelete(): event.Event<Event> {\n\t\treturn this._onDidDelete.event;\n\t}\n\n\tprivate readonly _onDidOpen: event.Emitter<void> = this._register(new event.Emitter<void>());\n\tget onDidOpen(): event.Event<void> {\n\t\treturn this._onDidOpen.event;\n\t}\n\n\tconstructor(\n\t\tprotected readonly attachment: IChatRequestVariableEntry,\n\t\tprivate readonly options: { shouldFocusClearButton: boolean; supportsDeletion: boolean },\n\t\tcontainer: HTMLElement,\n\t\tcontextResourceLabels: ResourceLabels,\n\t\tprotected readonly currentLanguageModel: ILanguageModelChatMetadataAndIdentifier | undefined,\n\t\t@ICommandService protected readonly commandService: ICommandService,\n\t\t@IOpenerService protected readonly openerService: IOpenerService,\n\t\t@ITerminalService protected readonly terminalService?: ITerminalService,\n\t) {\n\t\tsuper();\n\t\tthis.element = dom.append(container, $('.chat-attached-context-attachment.show-file-icons'));\n\t\tthis.label = contextResourceLabels.create(this.element, { supportIcons: true, hoverTargetOverride: this.element });\n\t\tthis._register(this.label);\n\t\tthis.element.tabIndex = 0;\n\t\tthis.element.role = 'button';\n\n\t\t// Add middle-click support for removal\n\t\tthis._register(dom.addDisposableListener(this.element, dom.EventType.AUXCLICK, (e: MouseEvent) => {\n\t\t\tif (e.button === 1 /* Middle Button */ && this.options.supportsDeletion && !this.attachment.range) {\n\t\t\t\te.preventDefault();\n\t\t\t\te.stopPropagation();\n\t\t\t\tthis._onDidDelete.fire(e);\n\t\t\t}\n\t\t}));\n\t}\n\n\tprotected modelSupportsVision() {\n\t\treturn modelSupportsVision(this.currentLanguageModel);\n\t}\n\n\tprotected attachClearButton() {\n\n\t\tif (this.attachment.range || !this.options.supportsDeletion) {\n\t\t\t// no clear button for attachments with ranges because range means\n\t\t\t// referenced from prompt\n\t\t\treturn;\n\t\t}\n\n\t\tconst clearButton = new Button(this.element, {\n\t\t\tsupportIcons: true,\n\t\t\thoverDelegate: createInstantHoverDelegate(),\n\t\t\ttitle: localize('chat.attachment.clearButton', \"Remove from context\")\n\t\t});\n\t\tclearButton.element.tabIndex = -1;\n\t\tclearButton.icon = Codicon.close;\n\t\tthis._register(clearButton);\n\t\tthis._register(event.Event.once(clearButton.onDidClick)((e) => {\n\t\t\tthis._onDidDelete.fire(e);\n\t\t}));\n\t\tthis._register(dom.addStandardDisposableListener(this.element, dom.EventType.KEY_DOWN, e => {\n\t\t\tif (e.keyCode === KeyCode.Backspace || e.keyCode === KeyCode.Delete) {\n\t\t\t\tthis._onDidDelete.fire(e.browserEvent);\n\t\t\t}\n\t\t}));\n\t}\n\n\tprotected addResourceOpenHandlers(resource: URI, range: IRange | undefined): void {\n\t\tthis.element.style.cursor = 'pointer';\n\n\t\tthis._register(registerOpenEditorListeners(this.element, async options => {\n\t\t\tif (this.attachment.kind === 'directory') {\n\t\t\t\tawait this.openResource(resource, options, true);\n\t\t\t} else {\n\t\t\t\tawait this.openResource(resource, options, false, range);\n\t\t\t}\n\t\t}));\n\t}\n\n\tprotected async openResource(resource: URI, options: Partial<IOpenEditorOptions>, isDirectory: true): Promise<void>;\n\tprotected async openResource(resource: URI, options: Partial<IOpenEditorOptions>, isDirectory: false, range: IRange | undefined): Promise<void>;\n\tprotected async openResource(resource: URI, openOptions: Partial<IOpenEditorOptions>, isDirectory?: boolean, range?: IRange): Promise<void> {\n\t\tif (isDirectory) {\n\t\t\t// Reveal Directory in explorer\n\t\t\tthis.commandService.executeCommand(revealInSideBarCommand.id, resource);\n\t\t\treturn;\n\t\t}\n\n\t\tif (resource.scheme === Schemas.vscodeTerminal) {\n\t\t\tthis.terminalService?.openResource(resource);\n\t\t\treturn;\n\t\t}\n\n\t\t// Open file in editor\n\t\tconst openTextEditorOptions: ITextEditorOptions | undefined = range ? { selection: range } : undefined;\n\t\tconst options: OpenInternalOptions = {\n\t\t\tfromUserGesture: true,\n\t\t\topenToSide: openOptions.openToSide,\n\t\t\teditorOptions: {\n\t\t\t\t...openTextEditorOptions,\n\t\t\t\t...openOptions.editorOptions\n\t\t\t},\n\t\t};\n\n\t\tawait this.openerService.open(resource, options);\n\t\tthis._onDidOpen.fire();\n\t\tthis.element.focus();\n\t}\n}\n\nfunction modelSupportsVision(currentLanguageModel: ILanguageModelChatMetadataAndIdentifier | undefined) {\n\treturn currentLanguageModel?.metadata.capabilities?.vision ?? false;\n}\n\nexport class FileAttachmentWidget extends AbstractChatAttachmentWidget {\n\n\tconstructor(\n\t\tresource: URI,\n\t\trange: IRange | undefined,\n\t\tattachment: IChatRequestVariableEntry,\n\t\tcorrespondingContentReference: IChatContentReference | undefined,\n\t\tcurrentLanguageModel: ILanguageModelChatMetadataAndIdentifier | undefined,\n\t\toptions: { shouldFocusClearButton: boolean; supportsDeletion: boolean },\n\t\tcontainer: HTMLElement,\n\t\tcontextResourceLabels: ResourceLabels,\n\t\t@ICommandService commandService: ICommandService,\n\t\t@IOpenerService openerService: IOpenerService,\n\t\t@IThemeService private readonly themeService: IThemeService,\n\t\t@IHoverService private readonly hoverService: IHoverService,\n\t\t@ILanguageModelsService private readonly languageModelsService: ILanguageModelsService,\n\t\t@IInstantiationService private readonly instantiationService: IInstantiationService,\n\t) {\n\t\tsuper(attachment, options, container, contextResourceLabels, currentLanguageModel, commandService, openerService);\n\n\t\tconst fileBasename = basename(resource.path);\n\t\tconst fileDirname = dirname(resource.path);\n\t\tconst friendlyName = `${fileBasename} ${fileDirname}`;\n\t\tlet ariaLabel = range ? localize('chat.fileAttachmentWithRange', \"Attached file, {0}, line {1} to line {2}\", friendlyName, range.startLineNumber, range.endLineNumber) : localize('chat.fileAttachment', \"Attached file, {0}\", friendlyName);\n\n\t\tif (attachment.omittedState === OmittedState.Full) {\n\t\t\tariaLabel = localize('chat.omittedFileAttachment', \"Omitted this file: {0}\", attachment.name);\n\t\t\tthis.renderOmittedWarning(friendlyName, ariaLabel);\n\t\t} else {\n\t\t\tconst fileOptions: IFileLabelOptions = { hidePath: true, title: correspondingContentReference?.options?.status?.description };\n\t\t\tthis.label.setFile(resource, attachment.kind === 'file' ? {\n\t\t\t\t...fileOptions,\n\t\t\t\tfileKind: FileKind.FILE,\n\t\t\t\trange,\n\t\t\t} : {\n\t\t\t\t...fileOptions,\n\t\t\t\tfileKind: FileKind.FOLDER,\n\t\t\t\ticon: !this.themeService.getFileIconTheme().hasFolderIcons ? FolderThemeIcon : undefined\n\t\t\t});\n\t\t}\n\n\t\tthis.element.ariaLabel = ariaLabel;\n\n\t\tthis.instantiationService.invokeFunction(accessor => {\n\t\t\tthis._register(hookUpResourceAttachmentDragAndContextMenu(accessor, this.element, resource));\n\t\t});\n\t\tthis.addResourceOpenHandlers(resource, range);\n\n\t\tthis.attachClearButton();\n\t}\n\n\tprivate renderOmittedWarning(friendlyName: string, ariaLabel: string) {\n\t\tconst pillIcon = dom.$('div.chat-attached-context-pill', {}, dom.$('span.codicon.codicon-warning'));\n\t\tconst textLabel = dom.$('span.chat-attached-context-custom-text', {}, friendlyName);\n\t\tthis.element.appendChild(pillIcon);\n\t\tthis.element.appendChild(textLabel);\n\n\t\tconst hoverElement = dom.$('div.chat-attached-context-hover');\n\t\thoverElement.setAttribute('aria-label', ariaLabel);\n\t\tthis.element.classList.add('warning');\n\n\t\thoverElement.textContent = localize('chat.fileAttachmentHover', \"{0} does not support this file type.\", this.currentLanguageModel ? this.languageModelsService.lookupLanguageModel(this.currentLanguageModel.identifier)?.name : this.currentLanguageModel ?? 'This model');\n\t\tthis._register(this.hoverService.setupDelayedHover(this.element, {\n\t\t\t...commonHoverOptions,\n\t\t\tcontent: hoverElement,\n\t\t}, commonHoverLifecycleOptions));\n\t}\n}\n\n\nexport class TerminalCommandAttachmentWidget extends AbstractChatAttachmentWidget {\n\n\tconstructor(\n\t\tattachment: ITerminalVariableEntry,\n\t\tcurrentLanguageModel: ILanguageModelChatMetadataAndIdentifier | undefined,\n\t\toptions: { shouldFocusClearButton: boolean; supportsDeletion: boolean },\n\t\tcontainer: HTMLElement,\n\t\tcontextResourceLabels: ResourceLabels,\n\t\t@ICommandService commandService: ICommandService,\n\t\t@IOpenerService openerService: IOpenerService,\n\t\t@IHoverService private readonly hoverService: IHoverService,\n\t\t@ITerminalService protected override readonly terminalService: ITerminalService,\n\t) {\n\t\tsuper(attachment, options, container, contextResourceLabels, currentLanguageModel, commandService, openerService, terminalService);\n\n\t\tconst ariaLabel = localize('chat.terminalCommand', \"Terminal command, {0}\", attachment.command);\n\t\tconst clickHandler = () => this.openResource(attachment.resource, { editorOptions: { preserveFocus: true } }, false, undefined);\n\n\t\tthis._register(createTerminalCommandElements(this.element, attachment, ariaLabel, this.hoverService, clickHandler));\n\n\t\tthis._register(dom.addDisposableListener(this.element, dom.EventType.KEY_DOWN, async (e: KeyboardEvent) => {\n\t\t\tconst event = new StandardKeyboardEvent(e);\n\t\t\tif (event.equals(KeyCode.Enter) || event.equals(KeyCode.Space)) {\n\t\t\t\tdom.EventHelper.stop(e, true);\n\t\t\t\tawait clickHandler();\n\t\t\t}\n\t\t}));\n\n\t\tthis.attachClearButton();\n\t}\n}\n\nconst enum TerminalConstants {\n\tMaxAttachmentOutputLineCount = 5,\n\tMaxAttachmentOutputLineLength = 80,\n}\n\nfunction createTerminalCommandElements(\n\telement: HTMLElement,\n\tattachment: ITerminalVariableEntry,\n\tariaLabel: string,\n\thoverService: IHoverService,\n\tclickHandler: () => Promise<void>\n): IDisposable {\n\tconst disposable = new DisposableStore();\n\telement.ariaLabel = ariaLabel;\n\telement.style.cursor = 'pointer';\n\n\tconst terminalIconSpan = dom.$('span');\n\tterminalIconSpan.classList.add(...ThemeIcon.asClassNameArray(Codicon.terminal));\n\tconst pillIcon = dom.$('div.chat-attached-context-pill', {}, terminalIconSpan);\n\tconst textLabel = dom.$('span.chat-attached-context-custom-text', {}, attachment.command);\n\telement.appendChild(pillIcon);\n\telement.appendChild(textLabel);\n\n\tdisposable.add(dom.addDisposableListener(element, dom.EventType.CLICK, e => {\n\t\te.preventDefault();\n\t\te.stopPropagation();\n\t\tclickHandler();\n\t}));\n\n\tconst hoverElement = dom.$('div.chat-attached-context-hover');\n\thoverElement.setAttribute('aria-label', ariaLabel);\n\n\tconst commandTitle = dom.$('div', {}, typeof attachment.exitCode === 'number'\n\t\t? localize('chat.terminalCommandHoverCommandTitleExit', \"Command: {0}, exit code: {1}\", attachment.command, attachment.exitCode)\n\t\t: localize('chat.terminalCommandHoverCommandTitle', \"Command\"));\n\tcommandTitle.classList.add('attachment-additional-info');\n\tconst commandBlock = dom.$('pre.chat-terminal-command-block');\n\thoverElement.append(commandTitle, commandBlock);\n\n\tif (attachment.output && attachment.output.trim().length > 0) {\n\t\tconst outputTitle = dom.$('div', {}, localize('chat.terminalCommandHoverOutputTitle', \"Output:\"));\n\t\toutputTitle.classList.add('attachment-additional-info');\n\t\tconst outputBlock = dom.$('pre.chat-terminal-command-output');\n\t\tconst fullOutputLines = attachment.output.split('\\n');\n\t\tconst hoverOutputLines = [];\n\t\tfor (const line of fullOutputLines) {\n\t\t\tif (hoverOutputLines.length >= TerminalConstants.MaxAttachmentOutputLineCount) {\n\t\t\t\thoverOutputLines.push('...');\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tconst trimmed = line.trim();\n\t\t\tif (trimmed.length === 0) {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tif (trimmed.length > TerminalConstants.MaxAttachmentOutputLineLength) {\n\t\t\t\thoverOutputLines.push(`${trimmed.slice(0, TerminalConstants.MaxAttachmentOutputLineLength)}...`);\n\t\t\t} else {\n\t\t\t\thoverOutputLines.push(trimmed);\n\t\t\t}\n\t\t}\n\t\toutputBlock.textContent = hoverOutputLines.join('\\n');\n\t\thoverElement.append(outputTitle, outputBlock);\n\t}\n\n\tconst hint = dom.$('div', {}, localize('chat.terminalCommandHoverHint', \"Click to focus this command in the terminal.\"));\n\thint.classList.add('attachment-additional-info');\n\thoverElement.appendChild(hint);\n\n\tdisposable.add(hoverService.setupDelayedHover(element, {\n\t\t...commonHoverOptions,\n\t\tcontent: hoverElement,\n\t}, commonHoverLifecycleOptions));\n\n\treturn disposable;\n}\n\nexport class ImageAttachmentWidget extends AbstractChatAttachmentWidget {\n\n\tconstructor(\n\t\tresource: URI | undefined,\n\t\tattachment: IChatRequestVariableEntry,\n\t\tcurrentLanguageModel: ILanguageModelChatMetadataAndIdentifier | undefined,\n\t\toptions: { shouldFocusClearButton: boolean; supportsDeletion: boolean },\n\t\tcontainer: HTMLElement,\n\t\tcontextResourceLabels: ResourceLabels,\n\t\t@ICommandService commandService: ICommandService,\n\t\t@IOpenerService openerService: IOpenerService,\n\t\t@IHoverService private readonly hoverService: IHoverService,\n\t\t@ILanguageModelsService private readonly languageModelsService: ILanguageModelsService,\n\t\t@IInstantiationService instantiationService: IInstantiationService,\n\t\t@ILabelService private readonly labelService: ILabelService,\n\t) {\n\t\tsuper(attachment, options, container, contextResourceLabels, currentLanguageModel, commandService, openerService);\n\n\t\tlet ariaLabel: string;\n\t\tif (attachment.omittedState === OmittedState.Full) {\n\t\t\tariaLabel = localize('chat.omittedImageAttachment', \"Omitted this image: {0}\", attachment.name);\n\t\t} else if (attachment.omittedState === OmittedState.Partial) {\n\t\t\tariaLabel = localize('chat.partiallyOmittedImageAttachment', \"Partially omitted this image: {0}\", attachment.name);\n\t\t} else {\n\t\t\tariaLabel = localize('chat.imageAttachment', \"Attached image, {0}\", attachment.name);\n\t\t}\n\n\t\tconst ref = attachment.references?.[0]?.reference;\n\t\tresource = ref && URI.isUri(ref) ? ref : undefined;\n\t\tconst clickHandler = async () => {\n\t\t\tif (resource) {\n\t\t\t\tawait this.openResource(resource, { editorOptions: { preserveFocus: true } }, false, undefined);\n\t\t\t}\n\t\t};\n\n\t\tconst currentLanguageModelName = this.currentLanguageModel ? this.languageModelsService.lookupLanguageModel(this.currentLanguageModel.identifier)?.name ?? this.currentLanguageModel.identifier : 'Current model';\n\n\t\tconst fullName = resource ? this.labelService.getUriLabel(resource) : (attachment.fullName || attachment.name);\n\t\tthis._register(createImageElements(resource, attachment.name, fullName, this.element, attachment.value as Uint8Array, this.hoverService, ariaLabel, currentLanguageModelName, clickHandler, this.currentLanguageModel, attachment.omittedState));\n\n\t\tif (resource) {\n\t\t\tthis.addResourceOpenHandlers(resource, undefined);\n\t\t\tinstantiationService.invokeFunction(accessor => {\n\t\t\t\tthis._register(hookUpResourceAttachmentDragAndContextMenu(accessor, this.element, resource));\n\t\t\t});\n\t\t}\n\n\t\tthis.attachClearButton();\n\t}\n}\n\nfunction createImageElements(resource: URI | undefined, name: string, fullName: string,\n\telement: HTMLElement,\n\tbuffer: ArrayBuffer | Uint8Array,\n\thoverService: IHoverService, ariaLabel: string,\n\tcurrentLanguageModelName: string | undefined,\n\tclickHandler: () => void,\n\tcurrentLanguageModel?: ILanguageModelChatMetadataAndIdentifier,\n\tomittedState?: OmittedState): IDisposable {\n\n\tconst disposable = new DisposableStore();\n\tif (omittedState === OmittedState.Partial) {\n\t\telement.classList.add('partial-warning');\n\t}\n\n\telement.ariaLabel = ariaLabel;\n\telement.style.position = 'relative';\n\n\tif (resource) {\n\t\telement.style.cursor = 'pointer';\n\t\tdisposable.add(dom.addDisposableListener(element, 'click', clickHandler));\n\t}\n\tconst supportsVision = modelSupportsVision(currentLanguageModel);\n\tconst pillIcon = dom.$('div.chat-attached-context-pill', {}, dom.$(supportsVision ? 'span.codicon.codicon-file-media' : 'span.codicon.codicon-warning'));\n\tconst textLabel = dom.$('span.chat-attached-context-custom-text', {}, name);\n\telement.appendChild(pillIcon);\n\telement.appendChild(textLabel);\n\n\tconst hoverElement = dom.$('div.chat-attached-context-hover');\n\thoverElement.setAttribute('aria-label', ariaLabel);\n\n\tif ((!supportsVision && currentLanguageModel) || omittedState === OmittedState.Full) {\n\t\telement.classList.add('warning');\n\t\thoverElement.textContent = localize('chat.imageAttachmentHover', \"{0} does not support images.\", currentLanguageModelName ?? 'This model');\n\t\tdisposable.add(hoverService.setupDelayedHover(element, {\n\t\t\tcontent: hoverElement,\n\t\t\tstyle: HoverStyle.Pointer,\n\t\t}));\n\t} else {\n\t\tdisposable.add(hoverService.setupDelayedHover(element, {\n\t\t\tcontent: hoverElement,\n\t\t\tstyle: HoverStyle.Pointer,\n\t\t}));\n\n\t\tconst blob = new Blob([buffer as Uint8Array<ArrayBuffer>], { type: 'image/png' });\n\t\tconst url = URL.createObjectURL(blob);\n\t\tconst pillImg = dom.$('img.chat-attached-context-pill-image', { src: url, alt: '' });\n\t\tconst pill = dom.$('div.chat-attached-context-pill', {}, pillImg);\n\n\t\t// eslint-disable-next-line no-restricted-syntax\n\t\tconst existingPill = element.querySelector('.chat-attached-context-pill');\n\t\tif (existingPill) {\n\t\t\texistingPill.replaceWith(pill);\n\t\t}\n\n\t\tconst hoverImage = dom.$('img.chat-attached-context-image', { src: url, alt: '' });\n\t\tconst imageContainer = dom.$('div.chat-attached-context-image-container', {}, hoverImage);\n\t\thoverElement.appendChild(imageContainer);\n\n\t\tif (resource) {\n\t\t\tconst urlContainer = dom.$('a.chat-attached-context-url', {}, omittedState === OmittedState.Partial ? localize('chat.imageAttachmentWarning', \"This GIF was partially omitted - current frame will be sent.\") : fullName);\n\t\t\tconst separator = dom.$('div.chat-attached-context-url-separator');\n\t\t\tdisposable.add(dom.addDisposableListener(urlContainer, 'click', () => clickHandler()));\n\t\t\thoverElement.append(separator, urlContainer);\n\t\t}\n\n\t\thoverImage.onload = () => { URL.revokeObjectURL(url); };\n\t\thoverImage.onerror = () => {\n\t\t\t// reset to original icon on error or invalid image\n\t\t\tconst pillIcon = dom.$('div.chat-attached-context-pill', {}, dom.$('span.codicon.codicon-file-media'));\n\t\t\tconst pill = dom.$('div.chat-attached-context-pill', {}, pillIcon);\n\t\t\t// eslint-disable-next-line no-restricted-syntax\n\t\t\tconst existingPill = element.querySelector('.chat-attached-context-pill');\n\t\t\tif (existingPill) {\n\t\t\t\texistingPill.replaceWith(pill);\n\t\t\t}\n\t\t};\n\t}\n\treturn disposable;\n}\n\nexport class PasteAttachmentWidget extends AbstractChatAttachmentWidget {\n\n\tconstructor(\n\t\tattachment: IChatRequestPasteVariableEntry,\n\t\tcurrentLanguageModel: ILanguageModelChatMetadataAndIdentifier | undefined,\n\t\toptions: { shouldFocusClearButton: boolean; supportsDeletion: boolean },\n\t\tcontainer: HTMLElement,\n\t\tcontextResourceLabels: ResourceLabels,\n\t\t@ICommandService commandService: ICommandService,\n\t\t@IOpenerService openerService: IOpenerService,\n\t\t@IHoverService private readonly hoverService: IHoverService,\n\t\t@IInstantiationService private readonly instantiationService: IInstantiationService,\n\t) {\n\t\tsuper(attachment, options, container, contextResourceLabels, currentLanguageModel, commandService, openerService);\n\n\t\tconst ariaLabel = localize('chat.attachment', \"Attached context, {0}\", attachment.name);\n\t\tthis.element.ariaLabel = ariaLabel;\n\n\t\tconst classNames = ['file-icon', `${attachment.language}-lang-file-icon`];\n\t\tlet resource: URI | undefined;\n\t\tlet range: IRange | undefined;\n\n\t\tif (attachment.copiedFrom) {\n\t\t\tresource = attachment.copiedFrom.uri;\n\t\t\trange = attachment.copiedFrom.range;\n\t\t\tconst filename = basename(resource.path);\n\t\t\tthis.label.setLabel(filename, undefined, { extraClasses: classNames });\n\t\t} else {\n\t\t\tthis.label.setLabel(attachment.fileName, undefined, { extraClasses: classNames });\n\t\t}\n\t\tthis.element.appendChild(dom.$('span.attachment-additional-info', {}, `Pasted ${attachment.pastedLines}`));\n\n\t\tthis.element.style.position = 'relative';\n\n\t\tconst sourceUri = attachment.copiedFrom?.uri;\n\t\tconst hoverContent = new MarkdownString(`${sourceUri ? this.instantiationService.invokeFunction(accessor => accessor.get(ILabelService).getUriLabel(sourceUri, { relative: true })) : attachment.fileName}\\n\\n---\\n\\n\\`\\`\\`${attachment.language}\\n\\n${attachment.code}\\n\\`\\`\\``);\n\t\tthis._register(this.hoverService.setupDelayedHover(this.element, {\n\t\t\t...commonHoverOptions,\n\t\t\tcontent: hoverContent,\n\t\t}, commonHoverLifecycleOptions));\n\n\t\tconst copiedFromResource = attachment.copiedFrom?.uri;\n\t\tif (copiedFromResource) {\n\t\t\tthis._register(this.instantiationService.invokeFunction(hookUpResourceAttachmentDragAndContextMenu, this.element, copiedFromResource));\n\t\t\tthis.addResourceOpenHandlers(copiedFromResource, range);\n\t\t}\n\n\t\tthis.attachClearButton();\n\t}\n}\n\nexport class DefaultChatAttachmentWidget extends AbstractChatAttachmentWidget {\n\tconstructor(\n\t\tresource: URI | undefined,\n\t\trange: IRange | undefined,\n\t\tattachment: IChatRequestVariableEntry,\n\t\tcorrespondingContentReference: IChatContentReference | undefined,\n\t\tcurrentLanguageModel: ILanguageModelChatMetadataAndIdentifier | undefined,\n\t\toptions: { shouldFocusClearButton: boolean; supportsDeletion: boolean },\n\t\tcontainer: HTMLElement,\n\t\tcontextResourceLabels: ResourceLabels,\n\t\t@ICommandService commandService: ICommandService,\n\t\t@IOpenerService openerService: IOpenerService,\n\t\t@IContextKeyService private readonly contextKeyService: IContextKeyService,\n\t\t@IInstantiationService private readonly instantiationService: IInstantiationService,\n\t) {\n\t\tsuper(attachment, options, container, contextResourceLabels, currentLanguageModel, commandService, openerService);\n\n\t\tconst attachmentLabel = attachment.fullName ?? attachment.name;\n\t\tconst withIcon = attachment.icon?.id ? `$(${attachment.icon.id})\\u00A0${attachmentLabel}` : attachmentLabel;\n\t\tthis.label.setLabel(withIcon, correspondingContentReference?.options?.status?.description);\n\t\tthis.element.ariaLabel = localize('chat.attachment', \"Attached context, {0}\", attachment.name);\n\n\t\tif (attachment.kind === 'diagnostic') {\n\t\t\tif (attachment.filterUri) {\n\t\t\t\tresource = attachment.filterUri ? URI.revive(attachment.filterUri) : undefined;\n\t\t\t\trange = attachment.filterRange;\n\t\t\t} else {\n\t\t\t\tthis.element.style.cursor = 'pointer';\n\t\t\t\tthis._register(dom.addDisposableListener(this.element, dom.EventType.CLICK, () => {\n\t\t\t\t\tthis.commandService.executeCommand('workbench.panel.markers.view.focus');\n\t\t\t\t}));\n\t\t\t}\n\t\t}\n\n\t\tif (attachment.kind === 'symbol') {\n\t\t\tconst scopedContextKeyService = this._register(this.contextKeyService.createScoped(this.element));\n\t\t\tthis._register(this.instantiationService.invokeFunction(hookUpSymbolAttachmentDragAndContextMenu, this.element, scopedContextKeyService, { ...attachment, kind: attachment.symbolKind }, MenuId.ChatInputSymbolAttachmentContext));\n\t\t}\n\n\t\tif (resource) {\n\t\t\tthis.addResourceOpenHandlers(resource, range);\n\t\t}\n\n\t\tthis.attachClearButton();\n\t}\n}\n\nexport class PromptFileAttachmentWidget extends AbstractChatAttachmentWidget {\n\n\tprivate hintElement: HTMLElement;\n\n\tconstructor(\n\t\tattachment: IPromptFileVariableEntry,\n\t\tcurrentLanguageModel: ILanguageModelChatMetadataAndIdentifier | undefined,\n\t\toptions: { shouldFocusClearButton: boolean; supportsDeletion: boolean },\n\t\tcontainer: HTMLElement,\n\t\tcontextResourceLabels: ResourceLabels,\n\t\t@ICommandService commandService: ICommandService,\n\t\t@IOpenerService openerService: IOpenerService,\n\t\t@ILabelService private readonly labelService: ILabelService,\n\t\t@IInstantiationService private readonly instantiationService: IInstantiationService,\n\t) {\n\t\tsuper(attachment, options, container, contextResourceLabels, currentLanguageModel, commandService, openerService);\n\n\n\t\tthis.hintElement = dom.append(this.element, dom.$('span.prompt-type'));\n\n\t\tthis.updateLabel(attachment);\n\n\t\tthis.instantiationService.invokeFunction(accessor => {\n\t\t\tthis._register(hookUpResourceAttachmentDragAndContextMenu(accessor, this.element, attachment.value));\n\t\t});\n\t\tthis.addResourceOpenHandlers(attachment.value, undefined);\n\n\t\tthis.attachClearButton();\n\t}\n\n\tprivate updateLabel(attachment: IPromptFileVariableEntry) {\n\t\tconst resource = attachment.value;\n\t\tconst fileBasename = basename(resource.path);\n\t\tconst fileDirname = dirname(resource.path);\n\t\tconst friendlyName = `${fileBasename} ${fileDirname}`;\n\t\tconst isPrompt = attachment.id.startsWith(PromptFileVariableKind.PromptFile);\n\t\tconst ariaLabel = isPrompt\n\t\t\t? localize('chat.promptAttachment', \"Prompt file, {0}\", friendlyName)\n\t\t\t: localize('chat.instructionsAttachment', \"Instructions attachment, {0}\", friendlyName);\n\t\tconst typeLabel = isPrompt\n\t\t\t? localize('prompt', \"Prompt\")\n\t\t\t: localize('instructions', \"Instructions\");\n\n\t\tconst title = this.labelService.getUriLabel(resource) + (attachment.originLabel ? `\\n${attachment.originLabel}` : '');\n\n\t\t//const { topError } = this.promptFile;\n\t\tthis.element.classList.remove('warning', 'error');\n\n\t\t// if there are some errors/warning during the process of resolving\n\t\t// attachment references (including all the nested child references),\n\t\t// add the issue details in the hover title for the attachment, one\n\t\t// error/warning at a time because there is a limited space available\n\t\t// if (topError) {\n\t\t// \tconst { errorSubject: subject } = topError;\n\t\t// \tconst isError = (subject === 'root');\n\t\t// \tthis.element.classList.add((isError) ? 'error' : 'warning');\n\n\t\t// \tconst severity = (isError)\n\t\t// \t\t? localize('error', \"Error\")\n\t\t// \t\t: localize('warning', \"Warning\");\n\n\t\t// \ttitle += `\\n[${severity}]: ${topError.localizedMessage}`;\n\t\t// }\n\n\t\tconst fileWithoutExtension = getCleanPromptName(resource);\n\t\tthis.label.setFile(URI.file(fileWithoutExtension), {\n\t\t\tfileKind: FileKind.FILE,\n\t\t\thidePath: true,\n\t\t\trange: undefined,\n\t\t\ttitle,\n\t\t\ticon: ThemeIcon.fromId(Codicon.bookmark.id),\n\t\t\textraClasses: [],\n\t\t});\n\n\t\tthis.hintElement.innerText = typeLabel;\n\n\n\t\tthis.element.ariaLabel = ariaLabel;\n\t}\n}\n\nexport class PromptTextAttachmentWidget extends AbstractChatAttachmentWidget {\n\n\tconstructor(\n\t\tattachment: IPromptTextVariableEntry,\n\t\tcurrentLanguageModel: ILanguageModelChatMetadataAndIdentifier | undefined,\n\t\toptions: { shouldFocusClearButton: boolean; supportsDeletion: boolean },\n\t\tcontainer: HTMLElement,\n\t\tcontextResourceLabels: ResourceLabels,\n\t\t@ICommandService commandService: ICommandService,\n\t\t@IOpenerService openerService: IOpenerService,\n\t\t@IPreferencesService preferencesService: IPreferencesService,\n\t\t@IHoverService hoverService: IHoverService\n\t) {\n\t\tsuper(attachment, options, container, contextResourceLabels, currentLanguageModel, commandService, openerService);\n\n\t\tif (attachment.settingId) {\n\t\t\tconst openSettings = () => preferencesService.openSettings({ jsonEditor: false, query: `@id:${attachment.settingId}` });\n\n\t\t\tthis.element.style.cursor = 'pointer';\n\t\t\tthis._register(dom.addDisposableListener(this.element, dom.EventType.CLICK, async (e: MouseEvent) => {\n\t\t\t\tdom.EventHelper.stop(e, true);\n\t\t\t\topenSettings();\n\t\t\t}));\n\n\t\t\tthis._register(dom.addDisposableListener(this.element, dom.EventType.KEY_DOWN, async (e: KeyboardEvent) => {\n\t\t\t\tconst event = new StandardKeyboardEvent(e);\n\t\t\t\tif (event.equals(KeyCode.Enter) || event.equals(KeyCode.Space)) {\n\t\t\t\t\tdom.EventHelper.stop(e, true);\n\t\t\t\t\topenSettings();\n\t\t\t\t}\n\t\t\t}));\n\t\t}\n\t\tthis.label.setLabel(localize('instructions.label', 'Additional Instructions'), undefined, undefined);\n\n\t\tthis._register(hoverService.setupDelayedHover(this.element, {\n\t\t\t...commonHoverOptions,\n\t\t\tcontent: attachment.value,\n\t\t}, commonHoverLifecycleOptions));\n\t}\n}\n\n\nexport class ToolSetOrToolItemAttachmentWidget extends AbstractChatAttachmentWidget {\n\tconstructor(\n\t\tattachment: ChatRequestToolReferenceEntry,\n\t\tcurrentLanguageModel: ILanguageModelChatMetadataAndIdentifier | undefined,\n\t\toptions: { shouldFocusClearButton: boolean; supportsDeletion: boolean },\n\t\tcontainer: HTMLElement,\n\t\tcontextResourceLabels: ResourceLabels,\n\t\t@ILanguageModelToolsService toolsService: ILanguageModelToolsService,\n\t\t@ICommandService commandService: ICommandService,\n\t\t@IOpenerService openerService: IOpenerService,\n\t\t@IHoverService hoverService: IHoverService\n\t) {\n\t\tsuper(attachment, options, container, contextResourceLabels, currentLanguageModel, commandService, openerService);\n\n\n\t\tconst toolOrToolSet = Iterable.find(toolsService.getTools(), tool => tool.id === attachment.id) ?? Iterable.find(toolsService.toolSets.get(), toolSet => toolSet.id === attachment.id);\n\n\t\tlet name = attachment.name;\n\t\tconst icon = attachment.icon ?? Codicon.tools;\n\n\t\tif (toolOrToolSet instanceof ToolSet) {\n\t\t\tname = toolOrToolSet.referenceName;\n\t\t} else if (toolOrToolSet) {\n\t\t\tname = toolOrToolSet.toolReferenceName ?? name;\n\t\t}\n\n\t\tthis.label.setLabel(`$(${icon.id})\\u00A0${name}`, undefined);\n\n\t\tthis.element.style.cursor = 'pointer';\n\t\tthis.element.ariaLabel = localize('chat.attachment', \"Attached context, {0}\", name);\n\n\t\tlet hoverContent: string | undefined;\n\n\t\tif (toolOrToolSet instanceof ToolSet) {\n\t\t\thoverContent = localize('toolset', \"{0} - {1}\", toolOrToolSet.description ?? toolOrToolSet.referenceName, toolOrToolSet.source.label);\n\t\t} else if (toolOrToolSet) {\n\t\t\thoverContent = localize('tool', \"{0} - {1}\", toolOrToolSet.userDescription ?? toolOrToolSet.modelDescription, toolOrToolSet.source.label);\n\t\t}\n\n\t\tif (hoverContent) {\n\t\t\tthis._register(hoverService.setupDelayedHover(this.element, {\n\t\t\t\t...commonHoverOptions,\n\t\t\t\tcontent: hoverContent,\n\t\t\t}, commonHoverLifecycleOptions));\n\t\t}\n\n\t\tthis.attachClearButton();\n\t}\n\n\n}\n\nexport class NotebookCellOutputChatAttachmentWidget extends AbstractChatAttachmentWidget {\n\tconstructor(\n\t\tresource: URI,\n\t\tattachment: INotebookOutputVariableEntry,\n\t\tcurrentLanguageModel: ILanguageModelChatMetadataAndIdentifier | undefined,\n\t\toptions: { shouldFocusClearButton: boolean; supportsDeletion: boolean },\n\t\tcontainer: HTMLElement,\n\t\tcontextResourceLabels: ResourceLabels,\n\t\t@ICommandService commandService: ICommandService,\n\t\t@IOpenerService openerService: IOpenerService,\n\t\t@IHoverService private readonly hoverService: IHoverService,\n\t\t@ILanguageModelsService private readonly languageModelsService: ILanguageModelsService,\n\t\t@INotebookService private readonly notebookService: INotebookService,\n\t\t@IInstantiationService private readonly instantiationService: IInstantiationService,\n\t) {\n\t\tsuper(attachment, options, container, contextResourceLabels, currentLanguageModel, commandService, openerService);\n\n\t\tswitch (attachment.mimeType) {\n\t\t\tcase 'application/vnd.code.notebook.error': {\n\t\t\t\tthis.renderErrorOutput(resource, attachment);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcase 'image/png':\n\t\t\tcase 'image/jpeg':\n\t\t\tcase 'image/svg': {\n\t\t\t\tthis.renderImageOutput(resource, attachment);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tdefault: {\n\t\t\t\tthis.renderGenericOutput(resource, attachment);\n\t\t\t}\n\t\t}\n\n\t\tthis.instantiationService.invokeFunction(accessor => {\n\t\t\tthis._register(hookUpResourceAttachmentDragAndContextMenu(accessor, this.element, resource));\n\t\t});\n\t\tthis.addResourceOpenHandlers(resource, undefined);\n\t\tthis.attachClearButton();\n\t}\n\tgetAriaLabel(attachment: INotebookOutputVariableEntry): string {\n\t\treturn localize('chat.NotebookImageAttachment', \"Attached Notebook output, {0}\", attachment.name);\n\t}\n\tprivate renderErrorOutput(resource: URI, attachment: INotebookOutputVariableEntry) {\n\t\tconst attachmentLabel = attachment.name;\n\t\tconst withIcon = attachment.icon?.id ? `$(${attachment.icon.id})\\u00A0${attachmentLabel}` : attachmentLabel;\n\t\tconst buffer = this.getOutputItem(resource, attachment)?.data.buffer ?? new Uint8Array();\n\t\tlet title: string | undefined = undefined;\n\t\ttry {\n\t\t\tconst error = JSON.parse(new TextDecoder().decode(buffer)) as Error;\n\t\t\tif (error.name && error.message) {\n\t\t\t\ttitle = `${error.name}: ${error.message}`;\n\t\t\t}\n\t\t} catch {\n\t\t\t//\n\t\t}\n\t\tthis.label.setLabel(withIcon, undefined, { title });\n\t\tthis.element.ariaLabel = this.getAriaLabel(attachment);\n\t}\n\tprivate renderGenericOutput(resource: URI, attachment: INotebookOutputVariableEntry) {\n\t\tthis.element.ariaLabel = this.getAriaLabel(attachment);\n\t\tthis.label.setFile(resource, { hidePath: true, icon: ThemeIcon.fromId('output') });\n\t}\n\tprivate renderImageOutput(resource: URI, attachment: INotebookOutputVariableEntry) {\n\t\tlet ariaLabel: string;\n\t\tif (attachment.omittedState === OmittedState.Full) {\n\t\t\tariaLabel = localize('chat.omittedNotebookImageAttachment', \"Omitted this Notebook ouput: {0}\", attachment.name);\n\t\t} else if (attachment.omittedState === OmittedState.Partial) {\n\t\t\tariaLabel = localize('chat.partiallyOmittedNotebookImageAttachment', \"Partially omitted this Notebook output: {0}\", attachment.name);\n\t\t} else {\n\t\t\tariaLabel = this.getAriaLabel(attachment);\n\t\t}\n\n\t\tconst clickHandler = async () => await this.openResource(resource, { editorOptions: { preserveFocus: true } }, false, undefined);\n\t\tconst currentLanguageModelName = this.currentLanguageModel ? this.languageModelsService.lookupLanguageModel(this.currentLanguageModel.identifier)?.name ?? this.currentLanguageModel.identifier : undefined;\n\t\tconst buffer = this.getOutputItem(resource, attachment)?.data.buffer ?? new Uint8Array();\n\t\tthis._register(createImageElements(resource, attachment.name, attachment.name, this.element, buffer, this.hoverService, ariaLabel, currentLanguageModelName, clickHandler, this.currentLanguageModel, attachment.omittedState));\n\t}\n\n\tprivate getOutputItem(resource: URI, attachment: INotebookOutputVariableEntry) {\n\t\tconst parsedInfo = CellUri.parseCellOutputUri(resource);\n\t\tif (!parsedInfo || typeof parsedInfo.cellHandle !== 'number' || typeof parsedInfo.outputIndex !== 'number') {\n\t\t\treturn undefined;\n\t\t}\n\t\tconst notebook = this.notebookService.getNotebookTextModel(parsedInfo.notebook);\n\t\tif (!notebook) {\n\t\t\treturn undefined;\n\t\t}\n\t\tconst cell = notebook.cells.find(c => c.handle === parsedInfo.cellHandle);\n\t\tif (!cell) {\n\t\t\treturn undefined;\n\t\t}\n\t\tconst output = cell.outputs.length > parsedInfo.outputIndex ? cell.outputs[parsedInfo.outputIndex] : undefined;\n\t\treturn output?.outputs.find(o => o.mime === attachment.mimeType);\n\t}\n\n}\n\nexport class ElementChatAttachmentWidget extends AbstractChatAttachmentWidget {\n\tconstructor(\n\t\tattachment: IElementVariableEntry,\n\t\tcurrentLanguageModel: ILanguageModelChatMetadataAndIdentifier | undefined,\n\t\toptions: { shouldFocusClearButton: boolean; supportsDeletion: boolean },\n\t\tcontainer: HTMLElement,\n\t\tcontextResourceLabels: ResourceLabels,\n\t\t@ICommandService commandService: ICommandService,\n\t\t@IOpenerService openerService: IOpenerService,\n\t\t@IEditorService editorService: IEditorService,\n\t) {\n\t\tsuper(attachment, options, container, contextResourceLabels, currentLanguageModel, commandService, openerService);\n\n\t\tconst ariaLabel = localize('chat.elementAttachment', \"Attached element, {0}\", attachment.name);\n\t\tthis.element.ariaLabel = ariaLabel;\n\n\t\tthis.element.style.position = 'relative';\n\t\tthis.element.style.cursor = 'pointer';\n\t\tconst attachmentLabel = attachment.name;\n\t\tconst withIcon = attachment.icon?.id ? `$(${attachment.icon.id})\\u00A0${attachmentLabel}` : attachmentLabel;\n\t\tthis.label.setLabel(withIcon, undefined, { title: localize('chat.clickToViewContents', \"Click to view the contents of: {0}\", attachmentLabel) });\n\n\t\tthis._register(dom.addDisposableListener(this.element, dom.EventType.CLICK, async () => {\n\t\t\tconst content = attachment.value?.toString() || '';\n\t\t\tawait editorService.openEditor({\n\t\t\t\tresource: undefined,\n\t\t\t\tcontents: content,\n\t\t\t\toptions: {\n\t\t\t\t\tpinned: true\n\t\t\t\t}\n\t\t\t});\n\t\t}));\n\n\t\tthis.attachClearButton();\n\t}\n}\n\nexport class SCMHistoryItemAttachmentWidget extends AbstractChatAttachmentWidget {\n\tconstructor(\n\t\tattachment: ISCMHistoryItemVariableEntry,\n\t\tcurrentLanguageModel: ILanguageModelChatMetadataAndIdentifier | undefined,\n\t\toptions: { shouldFocusClearButton: boolean; supportsDeletion: boolean },\n\t\tcontainer: HTMLElement,\n\t\tcontextResourceLabels: ResourceLabels,\n\t\t@ICommandService commandService: ICommandService,\n\t\t@IHoverService hoverService: IHoverService,\n\t\t@IOpenerService openerService: IOpenerService,\n\t\t@IThemeService themeService: IThemeService\n\t) {\n\t\tsuper(attachment, options, container, contextResourceLabels, currentLanguageModel, commandService, openerService);\n\n\t\tthis.label.setLabel(attachment.name, undefined);\n\n\t\tthis.element.style.cursor = 'pointer';\n\t\tthis.element.ariaLabel = localize('chat.attachment', \"Attached context, {0}\", attachment.name);\n\n\t\tconst historyItem = attachment.historyItem;\n\t\tconst hoverContent = historyItem.tooltip ?? historyItem.message;\n\t\tthis._store.add(hoverService.setupDelayedHover(this.element, {\n\t\t\t...commonHoverOptions,\n\t\t\tcontent: hoverContent,\n\t\t}, commonHoverLifecycleOptions));\n\n\t\tthis._store.add(dom.addDisposableListener(this.element, dom.EventType.CLICK, (e: MouseEvent) => {\n\t\t\tdom.EventHelper.stop(e, true);\n\t\t\tthis._openAttachment(attachment);\n\t\t}));\n\n\t\tthis._store.add(dom.addDisposableListener(this.element, dom.EventType.KEY_DOWN, (e: KeyboardEvent) => {\n\t\t\tconst event = new StandardKeyboardEvent(e);\n\t\t\tif (event.equals(KeyCode.Enter) || event.equals(KeyCode.Space)) {\n\t\t\t\tdom.EventHelper.stop(e, true);\n\t\t\t\tthis._openAttachment(attachment);\n\t\t\t}\n\t\t}));\n\n\t\tthis.attachClearButton();\n\t}\n\n\tprivate async _openAttachment(attachment: ISCMHistoryItemVariableEntry): Promise<void> {\n\t\tawait this.commandService.executeCommand('_workbench.openMultiDiffEditor', {\n\t\t\ttitle: getHistoryItemEditorTitle(attachment.historyItem), multiDiffSourceUri: attachment.value\n\t\t});\n\t}\n}\n\nexport class SCMHistoryItemChangeAttachmentWidget extends AbstractChatAttachmentWidget {\n\tconstructor(\n\t\tattachment: ISCMHistoryItemChangeVariableEntry,\n\t\tcurrentLanguageModel: ILanguageModelChatMetadataAndIdentifier | undefined,\n\t\toptions: { shouldFocusClearButton: boolean; supportsDeletion: boolean },\n\t\tcontainer: HTMLElement,\n\t\tcontextResourceLabels: ResourceLabels,\n\t\t@ICommandService commandService: ICommandService,\n\t\t@IHoverService hoverService: IHoverService,\n\t\t@IOpenerService openerService: IOpenerService,\n\t\t@IThemeService themeService: IThemeService,\n\t\t@IEditorService private readonly editorService: IEditorService,\n\t) {\n\t\tsuper(attachment, options, container, contextResourceLabels, currentLanguageModel, commandService, openerService);\n\n\t\tconst nameSuffix = `\\u00A0$(${Codicon.gitCommit.id})${attachment.historyItem.displayId ?? attachment.historyItem.id}`;\n\t\tthis.label.setFile(attachment.value, { fileKind: FileKind.FILE, hidePath: true, nameSuffix });\n\n\t\tthis.element.ariaLabel = localize('chat.attachment', \"Attached context, {0}\", attachment.name);\n\n\t\tconst historyItem = attachment.historyItem;\n\t\tconst hoverContent = historyItem.tooltip ?? historyItem.message;\n\t\tthis._store.add(hoverService.setupDelayedHover(this.element, {\n\t\t\t...commonHoverOptions,\n\t\t\tcontent: hoverContent,\n\t\t}, commonHoverLifecycleOptions));\n\n\t\tthis.addResourceOpenHandlers(attachment.value, undefined);\n\t\tthis.attachClearButton();\n\t}\n\n\tprotected override async openResource(resource: URI, options: IOpenEditorOptions, isDirectory: true): Promise<void>;\n\tprotected override async openResource(resource: URI, options: IOpenEditorOptions, isDirectory: false, range: IRange | undefined): Promise<void>;\n\tprotected override async openResource(resource: URI, options: IOpenEditorOptions, isDirectory?: boolean, range?: IRange): Promise<void> {\n\t\tconst attachment = this.attachment as ISCMHistoryItemChangeVariableEntry;\n\t\tconst historyItem = attachment.historyItem;\n\n\t\tawait this.editorService.openEditor({\n\t\t\tresource,\n\t\t\tlabel: `${basename(resource.path)} (${historyItem.displayId ?? historyItem.id})`,\n\t\t\toptions: { ...options.editorOptions }\n\t\t}, options.openToSide ? SIDE_GROUP : undefined);\n\t}\n}\n\nexport class SCMHistoryItemChangeRangeAttachmentWidget extends AbstractChatAttachmentWidget {\n\tconstructor(\n\t\tattachment: ISCMHistoryItemChangeRangeVariableEntry,\n\t\tcurrentLanguageModel: ILanguageModelChatMetadataAndIdentifier | undefined,\n\t\toptions: { shouldFocusClearButton: boolean; supportsDeletion: boolean },\n\t\tcontainer: HTMLElement,\n\t\tcontextResourceLabels: ResourceLabels,\n\t\t@ICommandService commandService: ICommandService,\n\t\t@IOpenerService openerService: IOpenerService,\n\t\t@IEditorService private readonly editorService: IEditorService,\n\t) {\n\t\tsuper(attachment, options, container, contextResourceLabels, currentLanguageModel, commandService, openerService);\n\n\t\tconst historyItemStartId = attachment.historyItemChangeStart.historyItem.displayId ?? attachment.historyItemChangeStart.historyItem.id;\n\t\tconst historyItemEndId = attachment.historyItemChangeEnd.historyItem.displayId ?? attachment.historyItemChangeEnd.historyItem.id;\n\n\t\tconst nameSuffix = `\\u00A0$(${Codicon.gitCommit.id})${historyItemStartId}..${historyItemEndId}`;\n\t\tthis.label.setFile(attachment.value, { fileKind: FileKind.FILE, hidePath: true, nameSuffix });\n\n\t\tthis.element.ariaLabel = localize('chat.attachment', \"Attached context, {0}\", attachment.name);\n\n\t\tthis.addResourceOpenHandlers(attachment.value, undefined);\n\t\tthis.attachClearButton();\n\t}\n\n\tprotected override async openResource(resource: URI, options: IOpenEditorOptions, isDirectory: true): Promise<void>;\n\tprotected override async openResource(resource: URI, options: IOpenEditorOptions, isDirectory: false, range: IRange | undefined): Promise<void>;\n\tprotected override async openResource(resource: URI, options: IOpenEditorOptions, isDirectory?: boolean, range?: IRange): Promise<void> {\n\t\tconst attachment = this.attachment as ISCMHistoryItemChangeRangeVariableEntry;\n\t\tconst historyItemChangeStart = attachment.historyItemChangeStart;\n\t\tconst historyItemChangeEnd = attachment.historyItemChangeEnd;\n\n\t\tconst originalUriTitle = `${basename(historyItemChangeStart.uri.fsPath)} (${historyItemChangeStart.historyItem.displayId ?? historyItemChangeStart.historyItem.id})`;\n\t\tconst modifiedUriTitle = `${basename(historyItemChangeEnd.uri.fsPath)} (${historyItemChangeEnd.historyItem.displayId ?? historyItemChangeEnd.historyItem.id})`;\n\n\t\tawait this.editorService.openEditor({\n\t\t\toriginal: { resource: historyItemChangeStart.uri },\n\t\t\tmodified: { resource: historyItemChangeEnd.uri },\n\t\t\tlabel: `${originalUriTitle}  ${modifiedUriTitle}`,\n\t\t\toptions: { ...options.editorOptions }\n\t\t}, options.openToSide ? SIDE_GROUP : undefined);\n\t}\n}\n\nexport function hookUpResourceAttachmentDragAndContextMenu(accessor: ServicesAccessor, widget: HTMLElement, resource: URI): IDisposable {\n\tconst contextKeyService = accessor.get(IContextKeyService);\n\tconst instantiationService = accessor.get(IInstantiationService);\n\n\tconst store = new DisposableStore();\n\n\t// Context\n\tconst scopedContextKeyService = store.add(contextKeyService.createScoped(widget));\n\tstore.add(setResourceContext(accessor, scopedContextKeyService, resource));\n\n\t// Drag and drop\n\twidget.draggable = true;\n\tstore.add(dom.addDisposableListener(widget, 'dragstart', e => {\n\t\tinstantiationService.invokeFunction(accessor => fillEditorsDragData(accessor, [resource], e));\n\t\te.dataTransfer?.setDragImage(widget, 0, 0);\n\t}));\n\n\t// Context menu\n\tstore.add(addBasicContextMenu(accessor, widget, scopedContextKeyService, MenuId.ChatInputResourceAttachmentContext, resource));\n\n\treturn store;\n}\n\nexport function hookUpSymbolAttachmentDragAndContextMenu(accessor: ServicesAccessor, widget: HTMLElement, scopedContextKeyService: IScopedContextKeyService, attachment: { name: string; value: Location; kind: SymbolKind }, contextMenuId: MenuId): IDisposable {\n\tconst instantiationService = accessor.get(IInstantiationService);\n\tconst languageFeaturesService = accessor.get(ILanguageFeaturesService);\n\tconst textModelService = accessor.get(ITextModelService);\n\n\tconst store = new DisposableStore();\n\n\t// Context\n\tstore.add(setResourceContext(accessor, scopedContextKeyService, attachment.value.uri));\n\n\tconst chatResourceContext = chatAttachmentResourceContextKey.bindTo(scopedContextKeyService);\n\tchatResourceContext.set(attachment.value.uri.toString());\n\n\t// Drag and drop\n\twidget.draggable = true;\n\tstore.add(dom.addDisposableListener(widget, 'dragstart', e => {\n\t\tinstantiationService.invokeFunction(accessor => fillEditorsDragData(accessor, [{ resource: attachment.value.uri, selection: attachment.value.range }], e));\n\n\t\tfillInSymbolsDragData([{\n\t\t\tfsPath: attachment.value.uri.fsPath,\n\t\t\trange: attachment.value.range,\n\t\t\tname: attachment.name,\n\t\t\tkind: attachment.kind,\n\t\t}], e);\n\n\t\te.dataTransfer?.setDragImage(widget, 0, 0);\n\t}));\n\n\t// Context menu\n\tconst providerContexts: ReadonlyArray<[IContextKey<boolean>, LanguageFeatureRegistry<unknown>]> = [\n\t\t[EditorContextKeys.hasDefinitionProvider.bindTo(scopedContextKeyService), languageFeaturesService.definitionProvider],\n\t\t[EditorContextKeys.hasReferenceProvider.bindTo(scopedContextKeyService), languageFeaturesService.referenceProvider],\n\t\t[EditorContextKeys.hasImplementationProvider.bindTo(scopedContextKeyService), languageFeaturesService.implementationProvider],\n\t\t[EditorContextKeys.hasTypeDefinitionProvider.bindTo(scopedContextKeyService), languageFeaturesService.typeDefinitionProvider],\n\t];\n\n\tconst updateContextKeys = async () => {\n\t\tconst modelRef = await textModelService.createModelReference(attachment.value.uri);\n\t\ttry {\n\t\t\tconst model = modelRef.object.textEditorModel;\n\t\t\tfor (const [contextKey, registry] of providerContexts) {\n\t\t\t\tcontextKey.set(registry.has(model));\n\t\t\t}\n\t\t} finally {\n\t\t\tmodelRef.dispose();\n\t\t}\n\t};\n\tstore.add(addBasicContextMenu(accessor, widget, scopedContextKeyService, contextMenuId, attachment.value, updateContextKeys));\n\n\treturn store;\n}\n\nfunction setResourceContext(accessor: ServicesAccessor, scopedContextKeyService: IScopedContextKeyService, resource: URI) {\n\tconst fileService = accessor.get(IFileService);\n\tconst languageService = accessor.get(ILanguageService);\n\tconst modelService = accessor.get(IModelService);\n\n\tconst resourceContextKey = new ResourceContextKey(scopedContextKeyService, fileService, languageService, modelService);\n\tresourceContextKey.set(resource);\n\treturn resourceContextKey;\n}\n\nfunction addBasicContextMenu(accessor: ServicesAccessor, widget: HTMLElement, scopedContextKeyService: IScopedContextKeyService, menuId: MenuId, arg: any, updateContextKeys?: () => Promise<void>): IDisposable {\n\tconst contextMenuService = accessor.get(IContextMenuService);\n\tconst menuService = accessor.get(IMenuService);\n\n\treturn dom.addDisposableListener(widget, dom.EventType.CONTEXT_MENU, async domEvent => {\n\t\tconst event = new StandardMouseEvent(dom.getWindow(domEvent), domEvent);\n\t\tdom.EventHelper.stop(domEvent, true);\n\n\t\ttry {\n\t\t\tawait updateContextKeys?.();\n\t\t} catch (e) {\n\t\t\tconsole.error(e);\n\t\t}\n\n\t\tcontextMenuService.showContextMenu({\n\t\t\tcontextKeyService: scopedContextKeyService,\n\t\t\tgetAnchor: () => event,\n\t\t\tgetActions: () => {\n\t\t\t\tconst menu = menuService.getMenuActions(menuId, scopedContextKeyService, { arg });\n\t\t\t\treturn getFlatContextMenuActions(menu);\n\t\t\t},\n\t\t});\n\t});\n}\n\nexport const chatAttachmentResourceContextKey = new RawContextKey<string>('chatAttachmentResource', undefined, { type: 'URI', description: localize('resource', \"The full value of the chat attachment resource, including scheme and path\") });\n"]}