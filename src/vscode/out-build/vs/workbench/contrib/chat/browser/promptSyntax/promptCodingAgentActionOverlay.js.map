{"version":3,"sources":["vs/workbench/contrib/chat/browser/promptSyntax/promptCodingAgentActionOverlay.ts"],"names":[],"mappings":"AAAA;;;gGAGgG;;;;;;;;;;;AAEhG,OAAO,EAAE,UAAU,EAAE,MAAM,yCAAyC,CAAC;AAErE,OAAO,EAAE,eAAe,EAAE,MAAM,qDAAqD,CAAC;AACtF,OAAO,EAAE,kBAAkB,EAAE,MAAM,yDAAyD,CAAC;AAC7F,OAAO,EAAE,eAAe,EAAE,MAAM,iCAAiC,CAAC;AAClE,OAAO,EAAE,0BAA0B,EAAE,MAAM,iEAAiE,CAAC;AAC7G,OAAO,EAAE,QAAQ,EAAE,MAAM,uBAAuB,CAAC;AACjD,OAAO,EAAE,MAAM,EAAE,MAAM,iDAAiD,CAAC;AACzE,OAAO,EAAE,kBAAkB,EAAE,MAAM,0CAA0C,CAAC;AAC9E,OAAO,EAAE,CAAC,EAAE,MAAM,oCAAoC,CAAC;AACvD,OAAO,EAAE,eAAe,EAAE,MAAM,qDAAqD,CAAC;AACtF,OAAO,EAAE,iBAAiB,EAAE,MAAM,4CAA4C,CAAC;AAExE,IAAM,oCAAoC,GAA1C,MAAM,oCAAqC,SAAQ,UAAU;;aAE3C,OAAE,GAAG,gCAAH,AAAmC,CAAC;IAM9D,YACkB,OAAoB,EACpB,eAAiD,EAC9C,kBAAuD,EAC/C,yBAAsE,EACjF,eAAiD;QAElE,KAAK,EAAE,CAAC;QANS,YAAO,GAAP,OAAO,CAAa;QACH,oBAAe,GAAf,eAAe,CAAiB;QAC7B,uBAAkB,GAAlB,kBAAkB,CAAoB;QAC9B,8BAAyB,GAAzB,yBAAyB,CAA4B;QAChE,oBAAe,GAAf,eAAe,CAAiB;QAP3D,eAAU,GAAY,KAAK,CAAC;QAWnC,IAAI,CAAC,QAAQ,GAAG,CAAC,CAAC,qCAAqC,CAAC,CAAC;QAEzD,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC,SAAS,CAAC,IAAI,MAAM,CAAC,IAAI,CAAC,QAAQ,EAAE;YACvD,YAAY,EAAE,IAAI;YAClB,KAAK,EAAE,QAAQ,CAAC,IAA0B,EAAE,IAA0C,CAAC;SACvF,CAAC,CAAC,CAAC;QAEJ,IAAI,CAAC,OAAO,CAAC,OAAO,CAAC,KAAK,CAAC,UAAU,GAAG,iCAAiC,CAAC;QAC1E,IAAI,CAAC,OAAO,CAAC,OAAO,CAAC,KAAK,CAAC,KAAK,GAAG,iCAAiC,CAAC;QACrE,IAAI,CAAC,OAAO,CAAC,KAAK,GAAG,QAAQ,CAAC,IAA0B,EAAE,IAAmC,EAAE,iBAAiB,CAAC,CAAC;QAElH,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,OAAO,CAAC,UAAU,CAAC,KAAK,IAAI,EAAE;YACjD,MAAM,IAAI,CAAC,QAAQ,EAAE,CAAC;QACvB,CAAC,CAAC,CAAC,CAAC;QACJ,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,kBAAkB,CAAC,kBAAkB,CAAC,GAAG,EAAE;YAC9D,IAAI,CAAC,iBAAiB,EAAE,CAAC;QAC1B,CAAC,CAAC,CAAC,CAAC;QACJ,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,OAAO,CAAC,gBAAgB,CAAC,GAAG,EAAE;YACjD,IAAI,CAAC,iBAAiB,EAAE,CAAC;QAC1B,CAAC,CAAC,CAAC,CAAC;QACJ,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,OAAO,CAAC,iBAAiB,CAAC,GAAG,EAAE;YAClD,IAAI,IAAI,CAAC,UAAU,EAAE,CAAC;gBACrB,IAAI,CAAC,OAAO,CAAC,mBAAmB,CAAC,IAAI,CAAC,CAAC;YACxC,CAAC;QACF,CAAC,CAAC,CAAC,CAAC;QAEJ,qBAAqB;QACrB,IAAI,CAAC,iBAAiB,EAAE,CAAC;IAC1B,CAAC;IAED,KAAK;QACJ,OAAO,sCAAoC,CAAC,EAAE,CAAC;IAChD,CAAC;IAED,UAAU;QACT,OAAO,IAAI,CAAC,QAAQ,CAAC;IACtB,CAAC;IAED,WAAW;QACV,IAAI,CAAC,IAAI,CAAC,UAAU,EAAE,CAAC;YACtB,OAAO,IAAI,CAAC;QACb,CAAC;QAED,OAAO;YACN,UAAU,6DAAqD;SAC/D,CAAC;IACH,CAAC;IAEO,iBAAiB;QACxB,MAAM,wCAAwC,GAAG,eAAe,CAAC,wCAAwC,CAAC,QAAQ,CAAC,IAAI,CAAC,kBAAkB,CAAC,CAAC;QAC5I,MAAM,oBAAoB,GAAG,eAAe,CAAC,oBAAoB,CAAC,QAAQ,CAAC,IAAI,CAAC,kBAAkB,CAAC,CAAC;QACpG,MAAM,KAAK,GAAG,IAAI,CAAC,OAAO,CAAC,QAAQ,EAAE,CAAC;QACtC,MAAM,YAAY,GAAG,KAAK,EAAE,aAAa,EAAE,KAAK,kBAAkB,CAAC;QACnE,MAAM,eAAe,GAAG,CAAC,CAAC,CAAC,YAAY,IAAI,wCAAwC,IAAI,oBAAoB,CAAC,CAAC;QAE7G,IAAI,eAAe,KAAK,IAAI,CAAC,UAAU,EAAE,CAAC;YACzC,IAAI,CAAC,UAAU,GAAG,eAAe,CAAC;YAClC,IAAI,IAAI,CAAC,UAAU,EAAE,CAAC;gBACrB,IAAI,CAAC,OAAO,CAAC,gBAAgB,CAAC,IAAI,CAAC,CAAC;YACrC,CAAC;iBAAM,CAAC;gBACP,IAAI,CAAC,OAAO,CAAC,mBAAmB,CAAC,IAAI,CAAC,CAAC;YACxC,CAAC;QACF,CAAC;IACF,CAAC;IAEO,KAAK,CAAC,QAAQ;QACrB,MAAM,KAAK,GAAG,IAAI,CAAC,OAAO,CAAC,QAAQ,EAAE,CAAC;QACtC,IAAI,CAAC,KAAK,EAAE,CAAC;YACZ,OAAO;QACR,CAAC;QAED,IAAI,CAAC,OAAO,CAAC,OAAO,GAAG,KAAK,CAAC;QAC7B,IAAI,CAAC;YACJ,MAAM,aAAa,GAAG,KAAK,CAAC,QAAQ,EAAE,CAAC;YACvC,MAAM,UAAU,GAAG,MAAM,IAAI,CAAC,eAAe,CAAC,yBAAyB,CAAC,KAAK,CAAC,GAAG,EAAE,iBAAiB,CAAC,IAAI,CAAC,CAAC;YAE3G,MAAM,MAAM,GAAG,IAAI,CAAC,yBAAyB,CAAC,kBAAkB,EAAE,CAAC;YACnE,MAAM,KAAK,GAAG,MAAM,CAAC,CAAC,CAAC,CAAC,CAAC,gCAAgC;YACzD,IAAI,CAAC,KAAK,EAAE,CAAC;gBACZ,OAAO;YACR,CAAC;YAED,MAAM,IAAI,CAAC,eAAe,CAAC,cAAc,CAAC,KAAK,CAAC,OAAO,EAAE;gBACxD,UAAU,EAAE,UAAU;gBACtB,OAAO,EAAE,aAAa;gBACtB,MAAM,EAAE,QAAQ;aAChB,CAAC,CAAC;QACJ,CAAC;gBAAS,CAAC;YACV,IAAI,CAAC,OAAO,CAAC,OAAO,GAAG,IAAI,CAAC;QAC7B,CAAC;IACF,CAAC;IAEQ,OAAO;QACf,IAAI,IAAI,CAAC,UAAU,EAAE,CAAC;YACrB,IAAI,CAAC,OAAO,CAAC,mBAAmB,CAAC,IAAI,CAAC,CAAC;QACxC,CAAC;QACD,KAAK,CAAC,OAAO,EAAE,CAAC;IACjB,CAAC;;AAlHW,oCAAoC;IAU9C,WAAA,eAAe,CAAA;IACf,WAAA,kBAAkB,CAAA;IAClB,WAAA,0BAA0B,CAAA;IAC1B,WAAA,eAAe,CAAA;GAbL,oCAAoC,CAmHhD","file":"promptCodingAgentActionOverlay.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Disposable } from '../../../../../base/common/lifecycle.js';\nimport { ICodeEditor, IOverlayWidget, IOverlayWidgetPosition, OverlayWidgetPositionPreference } from '../../../../../editor/browser/editorBrowser.js';\nimport { ICommandService } from '../../../../../platform/commands/common/commands.js';\nimport { IContextKeyService } from '../../../../../platform/contextkey/common/contextkey.js';\nimport { ChatContextKeys } from '../../common/chatContextKeys.js';\nimport { IRemoteCodingAgentsService } from '../../../remoteCodingAgents/common/remoteCodingAgentsService.js';\nimport { localize } from '../../../../../nls.js';\nimport { Button } from '../../../../../base/browser/ui/button/button.js';\nimport { PROMPT_LANGUAGE_ID } from '../../common/promptSyntax/promptTypes.js';\nimport { $ } from '../../../../../base/browser/dom.js';\nimport { IPromptsService } from '../../common/promptSyntax/service/promptsService.js';\nimport { CancellationToken } from '../../../../../base/common/cancellation.js';\n\nexport class PromptCodingAgentActionOverlayWidget extends Disposable implements IOverlayWidget {\n\n\tprivate static readonly ID = 'promptCodingAgentActionOverlay';\n\n\tprivate readonly _domNode: HTMLElement;\n\tprivate readonly _button: Button;\n\tprivate _isVisible: boolean = false;\n\n\tconstructor(\n\t\tprivate readonly _editor: ICodeEditor,\n\t\t@ICommandService private readonly _commandService: ICommandService,\n\t\t@IContextKeyService private readonly _contextKeyService: IContextKeyService,\n\t\t@IRemoteCodingAgentsService private readonly _remoteCodingAgentService: IRemoteCodingAgentsService,\n\t\t@IPromptsService private readonly _promptsService: IPromptsService,\n\t) {\n\t\tsuper();\n\n\t\tthis._domNode = $('.prompt-coding-agent-action-overlay');\n\n\t\tthis._button = this._register(new Button(this._domNode, {\n\t\t\tsupportIcons: true,\n\t\t\ttitle: localize('runPromptWithCodingAgent', \"Run prompt file in a remote coding agent\")\n\t\t}));\n\n\t\tthis._button.element.style.background = 'var(--vscode-button-background)';\n\t\tthis._button.element.style.color = 'var(--vscode-button-foreground)';\n\t\tthis._button.label = localize('runWithCodingAgent.label', \"{0} Delegate to Puku coding agent\", '$(cloud-upload)');\n\n\t\tthis._register(this._button.onDidClick(async () => {\n\t\t\tawait this._execute();\n\t\t}));\n\t\tthis._register(this._contextKeyService.onDidChangeContext(() => {\n\t\t\tthis._updateVisibility();\n\t\t}));\n\t\tthis._register(this._editor.onDidChangeModel(() => {\n\t\t\tthis._updateVisibility();\n\t\t}));\n\t\tthis._register(this._editor.onDidLayoutChange(() => {\n\t\t\tif (this._isVisible) {\n\t\t\t\tthis._editor.layoutOverlayWidget(this);\n\t\t\t}\n\t\t}));\n\n\t\t// initial visibility\n\t\tthis._updateVisibility();\n\t}\n\n\tgetId(): string {\n\t\treturn PromptCodingAgentActionOverlayWidget.ID;\n\t}\n\n\tgetDomNode(): HTMLElement {\n\t\treturn this._domNode;\n\t}\n\n\tgetPosition(): IOverlayWidgetPosition | null {\n\t\tif (!this._isVisible) {\n\t\t\treturn null;\n\t\t}\n\n\t\treturn {\n\t\t\tpreference: OverlayWidgetPositionPreference.BOTTOM_RIGHT_CORNER,\n\t\t};\n\t}\n\n\tprivate _updateVisibility(): void {\n\t\tconst enableRemoteCodingAgentPromptFileOverlay = ChatContextKeys.enableRemoteCodingAgentPromptFileOverlay.getValue(this._contextKeyService);\n\t\tconst hasRemoteCodingAgent = ChatContextKeys.hasRemoteCodingAgent.getValue(this._contextKeyService);\n\t\tconst model = this._editor.getModel();\n\t\tconst isPromptFile = model?.getLanguageId() === PROMPT_LANGUAGE_ID;\n\t\tconst shouldBeVisible = !!(isPromptFile && enableRemoteCodingAgentPromptFileOverlay && hasRemoteCodingAgent);\n\n\t\tif (shouldBeVisible !== this._isVisible) {\n\t\t\tthis._isVisible = shouldBeVisible;\n\t\t\tif (this._isVisible) {\n\t\t\t\tthis._editor.addOverlayWidget(this);\n\t\t\t} else {\n\t\t\t\tthis._editor.removeOverlayWidget(this);\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate async _execute(): Promise<void> {\n\t\tconst model = this._editor.getModel();\n\t\tif (!model) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._button.enabled = false;\n\t\ttry {\n\t\t\tconst promptContent = model.getValue();\n\t\t\tconst promptName = await this._promptsService.getPromptSlashCommandName(model.uri, CancellationToken.None);\n\n\t\t\tconst agents = this._remoteCodingAgentService.getAvailableAgents();\n\t\t\tconst agent = agents[0]; // Use the first available agent\n\t\t\tif (!agent) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tawait this._commandService.executeCommand(agent.command, {\n\t\t\t\tuserPrompt: promptName,\n\t\t\t\tsummary: promptContent,\n\t\t\t\tsource: 'prompt',\n\t\t\t});\n\t\t} finally {\n\t\t\tthis._button.enabled = true;\n\t\t}\n\t}\n\n\toverride dispose(): void {\n\t\tif (this._isVisible) {\n\t\t\tthis._editor.removeOverlayWidget(this);\n\t\t}\n\t\tsuper.dispose();\n\t}\n}\n"]}