{"version":3,"sources":["vs/workbench/contrib/chat/browser/chatManagement/chatUsageWidget.ts"],"names":[],"mappings":"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","file":"chatUsageWidget.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport './media/chatUsageWidget.css';\nimport { Disposable } from '../../../../../base/common/lifecycle.js';\nimport { Emitter } from '../../../../../base/common/event.js';\nimport * as DOM from '../../../../../base/browser/dom.js';\nimport { localize } from '../../../../../nls.js';\nimport { IChatEntitlementService, IQuotaSnapshot } from '../../../../services/chat/common/chatEntitlementService.js';\nimport { language } from '../../../../../base/common/platform.js';\nimport { safeIntl } from '../../../../../base/common/date.js';\n\nconst $ = DOM.$;\n\nexport class ChatUsageWidget extends Disposable {\n\n\tprivate readonly _onDidChangeContentHeight = new Emitter<number>();\n\treadonly onDidChangeContentHeight = this._onDidChangeContentHeight.event;\n\n\treadonly element: HTMLElement;\n\tprivate usageSection!: HTMLElement;\n\n\tprivate readonly dateFormatter = safeIntl.DateTimeFormat(language, { year: 'numeric', month: 'long', day: 'numeric' });\n\tprivate readonly dateTimeFormatter = safeIntl.DateTimeFormat(language, { year: 'numeric', month: 'long', day: 'numeric', hour: 'numeric', minute: 'numeric' });\n\n\tconstructor(\n\t\t@IChatEntitlementService private readonly chatEntitlementService: IChatEntitlementService\n\t) {\n\t\tsuper();\n\n\t\tthis.element = DOM.$('.chat-usage-widget');\n\t\tthis.create(this.element);\n\t\tthis.render();\n\n\t\t// Update when quotas or entitlements change\n\t\tthis._register(this.chatEntitlementService.onDidChangeQuotaRemaining(() => this.render()));\n\t\tthis._register(this.chatEntitlementService.onDidChangeEntitlement(() => this.render()));\n\t}\n\n\tprivate create(container: HTMLElement): void {\n\t\t// Content container\n\t\tthis.usageSection = DOM.append(container, $('.copilot-usage-section'));\n\t}\n\n\tprivate render(): void {\n\t\tDOM.clearNode(this.usageSection);\n\n\t\tconst { chat: chatQuota, completions: completionsQuota, premiumChat: premiumChatQuota, resetDate, resetDateHasTime } = this.chatEntitlementService.quotas;\n\n\t\t// Anonymous Indicator - show limited quotas\n\t\tif (this.chatEntitlementService.anonymous && this.chatEntitlementService.sentiment.installed && !completionsQuota && !chatQuota && !premiumChatQuota) {\n\t\t\tthis.renderLimitedQuotaItem(this.usageSection, localize('completionsLabel', 'Inline Suggestions'));\n\t\t\tthis.renderLimitedQuotaItem(this.usageSection, localize('chatsLabel', 'Chat messages'));\n\t\t}\n\t\t// Puku Usage section - show detailed breakdown of all quotas\n\t\telse if (completionsQuota || chatQuota || premiumChatQuota) {\n\t\t\t// Inline Suggestions\n\t\t\tif (completionsQuota) {\n\t\t\t\tthis.renderQuotaItem(this.usageSection, localize('plan.inlineSuggestions', 'Inline Suggestions'), completionsQuota);\n\t\t\t}\n\n\t\t\t// Chat messages\n\t\t\tif (chatQuota) {\n\t\t\t\tthis.renderQuotaItem(this.usageSection, localize('plan.chatMessages', 'Chat messages'), chatQuota);\n\t\t\t}\n\n\t\t\t// Premium requests\n\t\t\tif (premiumChatQuota) {\n\t\t\t\tthis.renderQuotaItem(this.usageSection, localize('plan.premiumRequests', 'Premium requests'), premiumChatQuota);\n\n\t\t\t\t// Additional overage message\n\t\t\t\tif (premiumChatQuota.overageEnabled) {\n\t\t\t\t\tconst overageMessage = DOM.append(this.usageSection, $('.overage-message'));\n\t\t\t\t\toverageMessage.textContent = localize('plan.additionalPaidEnabled', 'Additional paid premium requests enabled.');\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Reset date\n\t\t\tif (resetDate) {\n\t\t\t\tconst resetText = DOM.append(this.usageSection, $('.allowance-resets'));\n\t\t\t\tresetText.textContent = localize('plan.allowanceResets', 'Allowance resets {0}.', resetDateHasTime ? this.dateTimeFormatter.value.format(new Date(resetDate)) : this.dateFormatter.value.format(new Date(resetDate)));\n\t\t\t}\n\t\t}\n\n\t\t// Emit height change\n\t\tconst height = this.element.offsetHeight || 400;\n\t\tthis._onDidChangeContentHeight.fire(height);\n\t}\n\n\tprivate renderQuotaItem(container: HTMLElement, label: string, quota: IQuotaSnapshot): void {\n\t\tconst quotaItem = DOM.append(container, $('.quota-item'));\n\n\t\tconst quotaItemHeader = DOM.append(quotaItem, $('.quota-item-header'));\n\t\tconst quotaItemLabel = DOM.append(quotaItemHeader, $('.quota-item-label'));\n\t\tquotaItemLabel.textContent = label;\n\n\t\tconst quotaItemValue = DOM.append(quotaItemHeader, $('.quota-item-value'));\n\t\tif (quota.unlimited) {\n\t\t\tquotaItemValue.textContent = localize('plan.included', 'Included');\n\t\t} else {\n\t\t\tquotaItemValue.textContent = localize('plan.included', 'Included');\n\t\t}\n\n\t\t// Progress bar - using same structure as chat status\n\t\tconst progressBarContainer = DOM.append(quotaItem, $('.quota-bar'));\n\t\tconst progressBar = DOM.append(progressBarContainer, $('.quota-bit'));\n\t\tconst percentageUsed = this.getQuotaPercentageUsed(quota);\n\t\tprogressBar.style.width = percentageUsed + '%';\n\n\t\t// Apply warning/error classes based on usage\n\t\tif (percentageUsed >= 90) {\n\t\t\tquotaItem.classList.add('error');\n\t\t} else if (percentageUsed >= 75) {\n\t\t\tquotaItem.classList.add('warning');\n\t\t}\n\t}\n\n\tprivate getQuotaPercentageUsed(quota: IQuotaSnapshot): number {\n\t\tif (quota.unlimited) {\n\t\t\treturn 0;\n\t\t}\n\t\treturn Math.max(0, 100 - quota.percentRemaining);\n\t}\n\n\tprivate renderLimitedQuotaItem(container: HTMLElement, label: string): void {\n\t\tconst quotaItem = DOM.append(container, $('.quota-item'));\n\n\t\tconst quotaItemHeader = DOM.append(quotaItem, $('.quota-item-header'));\n\t\tconst quotaItemLabel = DOM.append(quotaItemHeader, $('.quota-item-label'));\n\t\tquotaItemLabel.textContent = label;\n\n\t\tconst quotaItemValue = DOM.append(quotaItemHeader, $('.quota-item-value'));\n\t\tquotaItemValue.textContent = localize('quotaLimited', 'Limited');\n\n\t\t// Progress bar - using same structure as chat status\n\t\tconst progressBarContainer = DOM.append(quotaItem, $('.quota-bar'));\n\t\tDOM.append(progressBarContainer, $('.quota-bit'));\n\t}\n}\n"]}