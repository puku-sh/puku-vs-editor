{"version":3,"sources":["vs/workbench/contrib/chat/browser/promptSyntax/promptUrlHandler.ts"],"names":[],"mappings":"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","file":"promptUrlHandler.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { streamToBuffer, VSBuffer } from '../../../../../base/common/buffer.js';\nimport { CancellationToken } from '../../../../../base/common/cancellation.js';\nimport { Disposable } from '../../../../../base/common/lifecycle.js';\nimport { URI } from '../../../../../base/common/uri.js';\nimport { IFileService } from '../../../../../platform/files/common/files.js';\nimport { IInstantiationService } from '../../../../../platform/instantiation/common/instantiation.js';\nimport { INotificationService } from '../../../../../platform/notification/common/notification.js';\nimport { IOpenerService } from '../../../../../platform/opener/common/opener.js';\nimport { IRequestService } from '../../../../../platform/request/common/request.js';\nimport { IURLHandler, IURLService } from '../../../../../platform/url/common/url.js';\nimport { IWorkbenchContribution } from '../../../../common/contributions.js';\nimport { askForPromptFileName } from './pickers/askForPromptName.js';\nimport { askForPromptSourceFolder } from './pickers/askForPromptSourceFolder.js';\nimport { getCleanPromptName } from '../../common/promptSyntax/config/promptFileLocations.js';\nimport { PromptsType } from '../../common/promptSyntax/promptTypes.js';\nimport { ILogService } from '../../../../../platform/log/common/log.js';\nimport { localize } from '../../../../../nls.js';\nimport { IDialogService } from '../../../../../platform/dialogs/common/dialogs.js';\nimport { Schemas } from '../../../../../base/common/network.js';\nimport { MarkdownString } from '../../../../../base/common/htmlContent.js';\nimport { IHostService } from '../../../../services/host/browser/host.js';\nimport { mainWindow } from '../../../../../base/browser/window.js';\n\n// example URL: code-oss:chat-prompt/install?url=https://gist.githubusercontent.com/aeschli/43fe78babd5635f062aef0195a476aad/raw/dfd71f60058a4dd25f584b55de3e20f5fd580e63/filterEvenNumbers.prompt.md\n\nexport class PromptUrlHandler extends Disposable implements IWorkbenchContribution, IURLHandler {\n\n\tstatic readonly ID = 'workbench.contrib.promptUrlHandler';\n\n\tconstructor(\n\t\t@IURLService urlService: IURLService,\n\t\t@INotificationService private readonly notificationService: INotificationService,\n\t\t@IRequestService private readonly requestService: IRequestService,\n\t\t@IInstantiationService private readonly instantiationService: IInstantiationService,\n\t\t@IFileService private readonly fileService: IFileService,\n\t\t@IOpenerService private readonly openerService: IOpenerService,\n\t\t@ILogService private readonly logService: ILogService,\n\t\t@IDialogService private readonly dialogService: IDialogService,\n\n\t\t@IHostService private readonly hostService: IHostService,\n\t) {\n\t\tsuper();\n\t\tthis._register(urlService.registerHandler(this));\n\t}\n\n\tasync handleURL(uri: URI): Promise<boolean> {\n\t\tlet promptType: PromptsType | undefined;\n\t\tswitch (uri.path) {\n\t\t\tcase 'chat-prompt/install':\n\t\t\t\tpromptType = PromptsType.prompt;\n\t\t\t\tbreak;\n\t\t\tcase 'chat-instructions/install':\n\t\t\t\tpromptType = PromptsType.instructions;\n\t\t\t\tbreak;\n\t\t\tcase 'chat-mode/install':\n\t\t\tcase 'chat-agent/install':\n\t\t\t\tpromptType = PromptsType.agent;\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\treturn false;\n\t\t}\n\n\t\ttry {\n\t\t\tconst query = decodeURIComponent(uri.query);\n\t\t\tif (!query || !query.startsWith('url=')) {\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tconst urlString = query.substring(4);\n\t\t\tconst url = URI.parse(urlString);\n\t\t\tif (url.scheme !== Schemas.https && url.scheme !== Schemas.http) {\n\t\t\t\tthis.logService.error(`[PromptUrlHandler] Invalid URL: ${urlString}`);\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tawait this.hostService.focus(mainWindow);\n\n\t\t\tif (await this.shouldBlockInstall(promptType, url)) {\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tconst result = await this.requestService.request({ type: 'GET', url: urlString }, CancellationToken.None);\n\t\t\tif (result.res.statusCode !== 200) {\n\t\t\t\tthis.logService.error(`[PromptUrlHandler] Failed to fetch URL: ${urlString}`);\n\t\t\t\tthis.notificationService.error(localize('failed', 'Failed to fetch URL: {0}', urlString));\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tconst responseData = (await streamToBuffer(result.stream)).toString();\n\n\t\t\tconst newFolder = await this.instantiationService.invokeFunction(askForPromptSourceFolder, promptType);\n\t\t\tif (!newFolder) {\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tconst newName = await this.instantiationService.invokeFunction(askForPromptFileName, promptType, newFolder.uri, getCleanPromptName(url));\n\t\t\tif (!newName) {\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tconst promptUri = URI.joinPath(newFolder.uri, newName);\n\n\t\t\tawait this.fileService.createFolder(newFolder.uri);\n\t\t\tawait this.fileService.createFile(promptUri, VSBuffer.fromString(responseData));\n\n\t\t\tawait this.openerService.open(promptUri);\n\t\t\treturn true;\n\n\t\t} catch (error) {\n\t\t\tthis.logService.error(`Error handling prompt URL ${uri.toString()}`, error);\n\t\t\treturn true;\n\t\t}\n\t}\n\n\tprivate async shouldBlockInstall(promptType: PromptsType, url: URI): Promise<boolean> {\n\t\tlet uriLabel = url.toString();\n\t\tif (uriLabel.length > 50) {\n\t\t\turiLabel = `${uriLabel.substring(0, 35)}...${uriLabel.substring(uriLabel.length - 15)}`;\n\t\t}\n\n\t\tconst detail = new MarkdownString('', { supportHtml: true });\n\t\tdetail.appendMarkdown(localize('confirmOpenDetail2', \"This will access {0}.\\n\\n\", `[${uriLabel}](${url.toString()})`));\n\t\tdetail.appendMarkdown(localize('confirmOpenDetail3', \"If you did not initiate this request, it may represent an attempted attack on your system. Unless you took an explicit action to initiate this request, you should press 'No'\"));\n\n\t\tlet message: string;\n\t\tswitch (promptType) {\n\t\t\tcase PromptsType.prompt:\n\t\t\t\tmessage = localize('confirmInstallPrompt', \"An external application wants to create a prompt file with content from a URL. Do you want to continue by selecting a destination folder and name?\");\n\t\t\t\tbreak;\n\t\t\tcase PromptsType.instructions:\n\t\t\t\tmessage = localize('confirmInstallInstructions', \"An external application wants to create an instructions file with content from a URL. Do you want to continue by selecting a destination folder and name?\");\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tmessage = localize('confirmInstallAgent', \"An external application wants to create a custom agent with content from a URL. Do you want to continue by selecting a destination folder and name?\");\n\t\t\t\tbreak;\n\t\t}\n\n\t\tconst { confirmed } = await this.dialogService.confirm({\n\t\t\ttype: 'warning',\n\t\t\tprimaryButton: localize({ key: 'yesButton', comment: ['&& denotes a mnemonic'] }, \"&&Yes\"),\n\t\t\tcancelButton: localize('noButton', \"No\"),\n\t\t\tmessage,\n\t\t\tcustom: {\n\t\t\t\tmarkdownDetails: [{\n\t\t\t\t\tmarkdown: detail\n\t\t\t\t}]\n\t\t\t}\n\t\t});\n\n\t\treturn !confirmed;\n\n\t}\n}\n"]}