{"version":3,"sources":["vs/workbench/contrib/chat/browser/chatEditing/chatEditingEditorContextKeys.ts"],"names":[],"mappings":"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","file":"chatEditingEditorContextKeys.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nimport { Event } from '../../../../../base/common/event.js';\nimport { DisposableMap, DisposableStore } from '../../../../../base/common/lifecycle.js';\nimport { autorun, constObservable, derived, IObservable, observableFromEvent } from '../../../../../base/common/observable.js';\nimport { URI } from '../../../../../base/common/uri.js';\nimport { localize } from '../../../../../nls.js';\nimport { IContextKey, RawContextKey } from '../../../../../platform/contextkey/common/contextkey.js';\nimport { IInstantiationService } from '../../../../../platform/instantiation/common/instantiation.js';\nimport { IWorkbenchContribution } from '../../../../common/contributions.js';\nimport { EditorResourceAccessor, SideBySideEditor } from '../../../../common/editor.js';\nimport { IEditorGroup, IEditorGroupsService } from '../../../../services/editor/common/editorGroupsService.js';\nimport { IInlineChatSessionService } from '../../../inlineChat/browser/inlineChatSessionService.js';\nimport { IChatEditingService, IChatEditingSession, IModifiedFileEntry, ModifiedFileEntryState } from '../../common/chatEditingService.js';\nimport { IChatService } from '../../common/chatService.js';\n\nexport const ctxIsGlobalEditingSession = new RawContextKey<boolean>('chatEdits.isGlobalEditingSession', undefined, localize('chat.ctxEditSessionIsGlobal', \"The current editor is part of the global edit session\"));\nexport const ctxHasEditorModification = new RawContextKey<boolean>('chatEdits.hasEditorModifications', undefined, localize('chat.hasEditorModifications', \"The current editor contains chat modifications\"));\nexport const ctxIsCurrentlyBeingModified = new RawContextKey<boolean>('chatEdits.isCurrentlyBeingModified', undefined, localize('chat.isCurrentlyBeingModified', \"The current editor is currently being modified\"));\nexport const ctxReviewModeEnabled = new RawContextKey<boolean>('chatEdits.isReviewModeEnabled', true, localize('chat.ctxReviewModeEnabled', \"Review mode for chat changes is enabled\"));\nexport const ctxHasRequestInProgress = new RawContextKey<boolean>('chatEdits.isRequestInProgress', false, localize('chat.ctxHasRequestInProgress', \"The current editor shows a file from an edit session which is still in progress\"));\nexport const ctxRequestCount = new RawContextKey<number>('chatEdits.requestCount', 0, localize('chatEdits.requestCount', \"The number of turns the editing session in this editor has\"));\nexport const ctxCursorInChangeRange = new RawContextKey<boolean>('chatEdits.cursorInChangeRange', false, localize('chat.ctxCursorInChangeRange', \"The cursor is inside a change range made by chat editing.\"));\n\nexport class ChatEditingEditorContextKeys implements IWorkbenchContribution {\n\n\tstatic readonly ID = 'chat.edits.editorContextKeys';\n\n\tprivate readonly _store = new DisposableStore();\n\n\tconstructor(\n\t\t@IInstantiationService instaService: IInstantiationService,\n\t\t@IEditorGroupsService editorGroupsService: IEditorGroupsService,\n\t) {\n\n\t\tconst editorGroupCtx = this._store.add(new DisposableMap<IEditorGroup>());\n\n\t\tconst editorGroups = observableFromEvent(\n\t\t\tthis,\n\t\t\tEvent.any(editorGroupsService.onDidAddGroup, editorGroupsService.onDidRemoveGroup),\n\t\t\t() => editorGroupsService.groups);\n\n\n\t\tthis._store.add(autorun(r => {\n\n\t\t\tconst toDispose = new Set(editorGroupCtx.keys());\n\n\t\t\tfor (const group of editorGroups.read(r)) {\n\n\t\t\t\ttoDispose.delete(group);\n\n\t\t\t\tif (editorGroupCtx.has(group)) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\teditorGroupCtx.set(group, instaService.createInstance(ContextKeyGroup, group));\n\t\t\t}\n\n\t\t\tfor (const item of toDispose) {\n\t\t\t\teditorGroupCtx.deleteAndDispose(item);\n\t\t\t}\n\t\t}));\n\t}\n\n\tdispose(): void {\n\t\tthis._store.dispose();\n\t}\n}\n\n\nclass ContextKeyGroup {\n\n\tprivate readonly _ctxIsGlobalEditingSession: IContextKey<boolean>;\n\tprivate readonly _ctxHasEditorModification: IContextKey<boolean>;\n\tprivate readonly _ctxHasRequestInProgress: IContextKey<boolean>;\n\tprivate readonly _ctxReviewModeEnabled: IContextKey<boolean>;\n\tprivate readonly _ctxIsCurrentlyBeingModified: IContextKey<boolean>;\n\tprivate readonly _ctxRequestCount: IContextKey<number>;\n\n\tprivate readonly _store = new DisposableStore();\n\n\tconstructor(\n\t\tgroup: IEditorGroup,\n\t\t@IInlineChatSessionService inlineChatSessionService: IInlineChatSessionService,\n\t\t@IChatEditingService chatEditingService: IChatEditingService,\n\t\t@IChatService chatService: IChatService,\n\t) {\n\t\tthis._ctxIsGlobalEditingSession = ctxIsGlobalEditingSession.bindTo(group.scopedContextKeyService);\n\t\tthis._ctxHasEditorModification = ctxHasEditorModification.bindTo(group.scopedContextKeyService);\n\t\tthis._ctxIsCurrentlyBeingModified = ctxIsCurrentlyBeingModified.bindTo(group.scopedContextKeyService);\n\t\tthis._ctxHasRequestInProgress = ctxHasRequestInProgress.bindTo(group.scopedContextKeyService);\n\t\tthis._ctxReviewModeEnabled = ctxReviewModeEnabled.bindTo(group.scopedContextKeyService);\n\t\tthis._ctxRequestCount = ctxRequestCount.bindTo(group.scopedContextKeyService);\n\n\t\tconst editorObs = observableFromEvent(this, group.onDidModelChange, () => group.activeEditor);\n\t\tconst tupleObs = derived(r => {\n\t\t\tconst editor = editorObs.read(r);\n\t\t\tconst uri = EditorResourceAccessor.getOriginalUri(editor, { supportSideBySide: SideBySideEditor.PRIMARY });\n\n\t\t\tif (!uri) {\n\t\t\t\tthis._reset();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\treturn new ObservableEditorSession(uri, chatEditingService, inlineChatSessionService).value.read(r);\n\t\t});\n\n\t\tthis._store.add(autorun(r => {\n\t\t\tconst tuple = tupleObs.read(r);\n\t\t\tif (!tuple) {\n\t\t\t\tthis._reset();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst { session, entry } = tuple;\n\n\t\t\tconst chatModel = chatService.getSession(session.chatSessionResource);\n\n\t\t\tthis._ctxHasEditorModification.set(entry?.state.read(r) === ModifiedFileEntryState.Modified);\n\t\t\tthis._ctxIsGlobalEditingSession.set(session.isGlobalEditingSession);\n\t\t\tthis._ctxReviewModeEnabled.set(entry ? entry.reviewMode.read(r) : false);\n\t\t\tthis._ctxHasRequestInProgress.set(chatModel?.requestInProgress.read(r) ?? false);\n\t\t\tthis._ctxIsCurrentlyBeingModified.set(!!entry?.isCurrentlyBeingModifiedBy.read(r));\n\n\t\t\t// number of requests\n\t\t\tconst requestCount = chatModel\n\t\t\t\t? observableFromEvent(this, chatModel.onDidChange, () => chatModel.getRequests().length)\n\t\t\t\t: constObservable(0);\n\n\t\t\tthis._ctxRequestCount.set(requestCount.read(r));\n\t\t}));\n\t}\n\n\tprivate _reset(): void {\n\t\tthis._ctxIsGlobalEditingSession.reset();\n\t\tthis._ctxHasEditorModification.reset();\n\t\tthis._ctxHasRequestInProgress.reset();\n\t\tthis._ctxReviewModeEnabled.reset();\n\t\tthis._ctxRequestCount.reset();\n\t}\n\n\tdispose(): void {\n\t\tthis._store.dispose();\n\t\tthis._reset();\n\t}\n}\n\nexport class ObservableEditorSession {\n\n\treadonly value: IObservable<undefined | { session: IChatEditingSession; entry: IModifiedFileEntry | undefined; isInlineChat: boolean }>;\n\n\tconstructor(\n\t\turi: URI,\n\t\t@IChatEditingService chatEditingService: IChatEditingService,\n\t\t@IInlineChatSessionService inlineChatService: IInlineChatSessionService\n\t) {\n\n\t\tconst inlineSessionObs = observableFromEvent(this, inlineChatService.onDidChangeSessions, () => inlineChatService.getSession2(uri));\n\n\t\tconst sessionObs = chatEditingService.editingSessionsObs.map((value, r) => {\n\t\t\tfor (const session of value) {\n\t\t\t\tconst entry = session.readEntry(uri, r);\n\t\t\t\tif (entry) {\n\t\t\t\t\treturn { session, entry, isInlineChat: false };\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn undefined;\n\t\t});\n\n\t\tthis.value = derived(r => {\n\n\t\t\tconst inlineSession = inlineSessionObs.read(r);\n\n\t\t\tif (inlineSession) {\n\t\t\t\treturn { session: inlineSession.editingSession, entry: inlineSession.editingSession.readEntry(uri, r), isInlineChat: true };\n\t\t\t}\n\n\t\t\treturn sessionObs.read(r);\n\t\t});\n\t}\n}\n"]}