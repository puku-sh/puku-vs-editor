{"version":3,"sources":["vs/workbench/contrib/chat/browser/chatWidget.ts"],"names":[],"mappings":"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","file":"chatWidget.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as dom from '../../../../base/browser/dom.js';\nimport { IMouseWheelEvent, StandardMouseEvent } from '../../../../base/browser/mouseEvent.js';\nimport { Button } from '../../../../base/browser/ui/button/button.js';\nimport { IHoverOptions } from '../../../../base/browser/ui/hover/hover.js';\nimport { HoverPosition } from '../../../../base/browser/ui/hover/hoverWidget.js';\nimport { IListRenderer, IListVirtualDelegate } from '../../../../base/browser/ui/list/list.js';\nimport { ITreeContextMenuEvent, ITreeElement } from '../../../../base/browser/ui/tree/tree.js';\nimport { disposableTimeout, RunOnceScheduler, timeout } from '../../../../base/common/async.js';\nimport { CancellationToken } from '../../../../base/common/cancellation.js';\nimport { Codicon } from '../../../../base/common/codicons.js';\nimport { fromNow, fromNowByDay } from '../../../../base/common/date.js';\nimport { toErrorMessage } from '../../../../base/common/errorMessage.js';\nimport { Emitter, Event } from '../../../../base/common/event.js';\nimport { FuzzyScore } from '../../../../base/common/filters.js';\nimport { IMarkdownString, MarkdownString } from '../../../../base/common/htmlContent.js';\nimport { Iterable } from '../../../../base/common/iterator.js';\nimport { KeyCode } from '../../../../base/common/keyCodes.js';\nimport { Disposable, DisposableStore, IDisposable, MutableDisposable, thenIfNotDisposed } from '../../../../base/common/lifecycle.js';\nimport { ResourceSet } from '../../../../base/common/map.js';\nimport { Schemas } from '../../../../base/common/network.js';\nimport { filter } from '../../../../base/common/objects.js';\nimport { autorun, observableFromEvent, observableValue } from '../../../../base/common/observable.js';\nimport { basename, extUri, isEqual } from '../../../../base/common/resources.js';\nimport { MicrotaskDelay } from '../../../../base/common/symbols.js';\nimport { isDefined } from '../../../../base/common/types.js';\nimport { URI } from '../../../../base/common/uri.js';\nimport { ICodeEditor } from '../../../../editor/browser/editorBrowser.js';\nimport { ICodeEditorService } from '../../../../editor/browser/services/codeEditorService.js';\nimport { OffsetRange } from '../../../../editor/common/core/ranges/offsetRange.js';\nimport { localize } from '../../../../nls.js';\nimport { MenuId } from '../../../../platform/actions/common/actions.js';\nimport { ICommandService } from '../../../../platform/commands/common/commands.js';\nimport { IConfigurationService } from '../../../../platform/configuration/common/configuration.js';\nimport { ContextKeyExpr, IContextKey, IContextKeyService } from '../../../../platform/contextkey/common/contextkey.js';\nimport { IContextMenuService } from '../../../../platform/contextview/browser/contextView.js';\nimport { ITextResourceEditorInput } from '../../../../platform/editor/common/editor.js';\nimport { IHoverService, WorkbenchHoverDelegate } from '../../../../platform/hover/browser/hover.js';\nimport { IInstantiationService } from '../../../../platform/instantiation/common/instantiation.js';\nimport { ServiceCollection } from '../../../../platform/instantiation/common/serviceCollection.js';\nimport { WorkbenchList, WorkbenchObjectTree } from '../../../../platform/list/browser/listService.js';\nimport { ILogService } from '../../../../platform/log/common/log.js';\nimport { bindContextKey } from '../../../../platform/observable/common/platformObservableUtils.js';\nimport product from '../../../../platform/product/common/product.js';\nimport { ITelemetryService } from '../../../../platform/telemetry/common/telemetry.js';\nimport { buttonSecondaryBackground, buttonSecondaryForeground, buttonSecondaryHoverBackground } from '../../../../platform/theme/common/colorRegistry.js';\nimport { asCssVariable } from '../../../../platform/theme/common/colorUtils.js';\nimport { IThemeService } from '../../../../platform/theme/common/themeService.js';\nimport { IWorkspaceContextService, WorkbenchState } from '../../../../platform/workspace/common/workspace.js';\nimport { EditorResourceAccessor } from '../../../../workbench/common/editor.js';\nimport { IEditorService } from '../../../../workbench/services/editor/common/editorService.js';\nimport { ViewContainerLocation } from '../../../common/views.js';\nimport { IChatEntitlementService } from '../../../services/chat/common/chatEntitlementService.js';\nimport { IWorkbenchLayoutService, Position } from '../../../services/layout/browser/layoutService.js';\nimport { ILifecycleService } from '../../../services/lifecycle/common/lifecycle.js';\nimport { IViewsService } from '../../../services/views/common/viewsService.js';\nimport { katexContainerClassName } from '../../markdown/common/markedKatexExtension.js';\nimport { checkModeOption } from '../common/chat.js';\nimport { IChatAgentAttachmentCapabilities, IChatAgentCommand, IChatAgentData, IChatAgentService } from '../common/chatAgents.js';\nimport { ChatContextKeys } from '../common/chatContextKeys.js';\nimport { applyingChatEditsFailedContextKey, decidedChatEditingResourceContextKey, hasAppliedChatEditsContextKey, hasUndecidedChatEditingResourceContextKey, IChatEditingService, IChatEditingSession, inChatEditingSessionContextKey, ModifiedFileEntryState } from '../common/chatEditingService.js';\nimport { IChatLayoutService } from '../common/chatLayoutService.js';\nimport { IChatModel, IChatModelInputState, IChatResponseModel } from '../common/chatModel.js';\nimport { ChatMode, IChatModeService } from '../common/chatModes.js';\nimport { chatAgentLeader, ChatRequestAgentPart, ChatRequestDynamicVariablePart, ChatRequestSlashPromptPart, ChatRequestToolPart, ChatRequestToolSetPart, chatSubcommandLeader, formatChatQuestion, IParsedChatRequest } from '../common/chatParserTypes.js';\nimport { ChatRequestParser } from '../common/chatRequestParser.js';\nimport { IChatLocationData, IChatSendRequestOptions, IChatService } from '../common/chatService.js';\nimport { IChatSessionsService } from '../common/chatSessionsService.js';\nimport { IChatSlashCommandService } from '../common/chatSlashCommands.js';\nimport { IChatTodoListService } from '../common/chatTodoListService.js';\nimport { ChatRequestVariableSet, IChatRequestVariableEntry, isPromptFileVariableEntry, isPromptTextVariableEntry, PromptFileVariableKind, toPromptFileVariableEntry } from '../common/chatVariableEntries.js';\nimport { ChatViewModel, IChatRequestViewModel, IChatResponseViewModel, isRequestVM, isResponseVM } from '../common/chatViewModel.js';\nimport { CodeBlockModelCollection } from '../common/codeBlockModelCollection.js';\nimport { ChatAgentLocation, ChatConfiguration, ChatModeKind } from '../common/constants.js';\nimport { ILanguageModelToolsService, IToolData, ToolSet } from '../common/languageModelToolsService.js';\nimport { ComputeAutomaticInstructions } from '../common/promptSyntax/computeAutomaticInstructions.js';\nimport { PromptsConfig } from '../common/promptSyntax/config/config.js';\nimport { IHandOff, PromptHeader, Target } from '../common/promptSyntax/promptFileParser.js';\nimport { IPromptsService } from '../common/promptSyntax/service/promptsService.js';\nimport { handleModeSwitch } from './actions/chatActions.js';\nimport { ChatTreeItem, ChatViewId, IChatAcceptInputOptions, IChatAccessibilityService, IChatCodeBlockInfo, IChatFileTreeInfo, IChatListItemRendererOptions, IChatWidget, IChatWidgetService, IChatWidgetViewContext, IChatWidgetViewOptions, isIChatResourceViewContext, isIChatViewViewContext } from './chat.js';\nimport { ChatAccessibilityProvider } from './chatAccessibilityProvider.js';\nimport { ChatAttachmentModel } from './chatAttachmentModel.js';\nimport { ChatSuggestNextWidget } from './chatContentParts/chatSuggestNextWidget.js';\nimport { ChatInputPart, IChatInputPartOptions, IChatInputStyles } from './chatInputPart.js';\nimport { ChatListDelegate, ChatListItemRenderer, IChatListItemTemplate, IChatRendererDelegate } from './chatListRenderer.js';\nimport { ChatEditorOptions } from './chatOptions.js';\nimport { ChatViewPane } from './chatViewPane.js';\nimport './media/chat.css';\nimport './media/chatAgentHover.css';\nimport './media/chatViewWelcome.css';\nimport { ChatViewWelcomePart, IChatSuggestedPrompts, IChatViewWelcomeContent } from './viewsWelcome/chatViewWelcomeController.js';\n\nconst $ = dom.$;\n\nconst defaultChat = {\n\tprovider: product.defaultChatAgent?.provider ?? { default: { id: '', name: '' }, enterprise: { id: '', name: '' }, apple: { id: '', name: '' }, google: { id: '', name: '' } },\n\ttermsStatementUrl: product.defaultChatAgent?.termsStatementUrl ?? '',\n\tprivacyStatementUrl: product.defaultChatAgent?.privacyStatementUrl ?? ''\n};\n\nexport interface IChatWidgetStyles extends IChatInputStyles {\n\tinputEditorBackground: string;\n\tresultEditorBackground: string;\n}\n\nexport interface IChatWidgetContrib extends IDisposable {\n\treadonly id: string;\n\n\t/**\n\t * A piece of state which is related to the input editor of the chat widget.\n\t * Takes in the `contrib` object that will be saved in the {@link IChatModelInputState}.\n\t */\n\tgetInputState?(contrib: Record<string, unknown>): void;\n\n\t/**\n\t * Called with the result of getInputState when navigating input history.\n\t */\n\tsetInputState?(contrib: Readonly<Record<string, unknown>>): void;\n}\n\ninterface IChatRequestInputOptions {\n\tinput: string;\n\tattachedContext: ChatRequestVariableSet;\n}\n\nexport interface IChatWidgetLocationOptions {\n\tlocation: ChatAgentLocation;\n\tresolveData?(): IChatLocationData | undefined;\n}\n\nexport function isQuickChat(widget: IChatWidget): boolean {\n\treturn isIChatResourceViewContext(widget.viewContext) && Boolean(widget.viewContext.isQuickChat);\n}\n\nexport function isInlineChat(widget: IChatWidget): boolean {\n\treturn isIChatResourceViewContext(widget.viewContext) && Boolean(widget.viewContext.isInlineChat);\n}\n\ninterface IChatHistoryListItem {\n\treadonly sessionResource: URI;\n\treadonly title: string;\n\treadonly lastMessageDate: number;\n\treadonly isActive: boolean;\n}\n\ntype ChatHandoffClickEvent = {\n\tfromAgent: string;\n\ttoAgent: string;\n\thasPrompt: boolean;\n\tautoSend: boolean;\n};\n\ntype ChatHandoffClickClassification = {\n\towner: 'digitarald';\n\tcomment: 'Event fired when a user clicks on a handoff prompt in the chat suggest-next widget';\n\tfromAgent: { classification: 'SystemMetaData'; purpose: 'FeatureInsight'; comment: 'The agent/mode the user was in before clicking the handoff' };\n\ttoAgent: { classification: 'SystemMetaData'; purpose: 'FeatureInsight'; comment: 'The agent/mode specified in the handoff' };\n\thasPrompt: { classification: 'SystemMetaData'; purpose: 'FeatureInsight'; isMeasurement: true; comment: 'Whether the handoff includes a prompt' };\n\tautoSend: { classification: 'SystemMetaData'; purpose: 'FeatureInsight'; isMeasurement: true; comment: 'Whether the handoff automatically submits the request' };\n};\n\ntype ChatHandoffWidgetShownEvent = {\n\tagent: string;\n\thandoffCount: number;\n};\n\ntype ChatHandoffWidgetShownClassification = {\n\towner: 'digitarald';\n\tcomment: 'Event fired when the suggest-next widget is shown with handoff prompts';\n\tagent: { classification: 'SystemMetaData'; purpose: 'FeatureInsight'; comment: 'The current agent/mode that has handoffs defined' };\n\thandoffCount: { classification: 'SystemMetaData'; purpose: 'FeatureInsight'; isMeasurement: true; comment: 'Number of handoff options shown to the user' };\n};\n\nclass ChatHistoryListDelegate implements IListVirtualDelegate<IChatHistoryListItem> {\n\tgetHeight(element: IChatHistoryListItem): number {\n\t\treturn 22;\n\t}\n\n\tgetTemplateId(element: IChatHistoryListItem): string {\n\t\treturn 'chatHistoryItem';\n\t}\n}\n\ninterface IChatHistoryTemplate {\n\tcontainer: HTMLElement;\n\ttitle: HTMLElement;\n\tdate: HTMLElement;\n\tdisposables: DisposableStore;\n}\n\nclass ChatHistoryHoverDelegate extends WorkbenchHoverDelegate {\n\tconstructor(\n\t\tprivate readonly getViewContainerLocation: () => ViewContainerLocation,\n\t\t@IWorkbenchLayoutService private readonly layoutService: IWorkbenchLayoutService,\n\t\t@IConfigurationService configurationService: IConfigurationService,\n\t\t@IHoverService hoverService: IHoverService,\n\t) {\n\t\tsuper('element', {\n\t\t\tinstantHover: true\n\t\t}, () => this.getHoverOptions(), configurationService, hoverService);\n\t}\n\n\tprivate getHoverOptions(): Partial<IHoverOptions> {\n\t\tconst sideBarPosition = this.layoutService.getSideBarPosition();\n\t\tconst viewContainerLocation = this.getViewContainerLocation();\n\n\t\tlet hoverPosition: HoverPosition;\n\t\tif (viewContainerLocation === ViewContainerLocation.Sidebar) {\n\t\t\thoverPosition = sideBarPosition === Position.LEFT ? HoverPosition.RIGHT : HoverPosition.LEFT;\n\t\t} else if (viewContainerLocation === ViewContainerLocation.AuxiliaryBar) {\n\t\t\thoverPosition = sideBarPosition === Position.LEFT ? HoverPosition.LEFT : HoverPosition.RIGHT;\n\t\t} else {\n\t\t\thoverPosition = HoverPosition.RIGHT;\n\t\t}\n\n\t\treturn { additionalClasses: ['chat-history-item-hover'], position: { hoverPosition, forcePosition: true } };\n\t}\n}\n\nclass ChatHistoryListRenderer implements IListRenderer<IChatHistoryListItem, IChatHistoryTemplate> {\n\treadonly templateId = 'chatHistoryItem';\n\n\tconstructor(\n\t\tprivate readonly onDidClickItem: (item: IChatHistoryListItem) => void,\n\t\tprivate readonly formatHistoryTimestamp: (timestamp: number, todayMidnightMs: number) => string,\n\t\tprivate readonly todayMidnightMs: number\n\t) { }\n\n\trenderTemplate(container: HTMLElement): IChatHistoryTemplate {\n\t\tconst disposables = new DisposableStore();\n\n\t\tcontainer.classList.add('chat-welcome-history-item');\n\t\tconst title = dom.append(container, $('.chat-welcome-history-title'));\n\t\tconst date = dom.append(container, $('.chat-welcome-history-date'));\n\n\t\tcontainer.tabIndex = 0;\n\t\tcontainer.setAttribute('role', 'button');\n\n\t\treturn { container, title, date, disposables };\n\t}\n\n\trenderElement(element: IChatHistoryListItem, index: number, templateData: IChatHistoryTemplate): void {\n\t\tconst { container, title, date, disposables } = templateData;\n\n\t\tdisposables.clear();\n\n\t\ttitle.textContent = element.title;\n\t\tdate.textContent = this.formatHistoryTimestamp(element.lastMessageDate, this.todayMidnightMs);\n\t\tcontainer.setAttribute('aria-label', element.title);\n\n\t\tdisposables.add(dom.addDisposableListener(container, dom.EventType.CLICK, () => {\n\t\t\tthis.onDidClickItem(element);\n\t\t}));\n\n\t\tdisposables.add(dom.addStandardDisposableListener(container, dom.EventType.KEY_DOWN, e => {\n\t\t\tif (e.equals(KeyCode.Enter) || e.equals(KeyCode.Space)) {\n\t\t\t\te.preventDefault();\n\t\t\t\te.stopPropagation();\n\t\t\t\tthis.onDidClickItem(element);\n\t\t\t}\n\t\t}));\n\t}\n\n\tdisposeTemplate(templateData: IChatHistoryTemplate): void {\n\t\ttemplateData.disposables.dispose();\n\t}\n}\n\nconst supportsAllAttachments: Required<IChatAgentAttachmentCapabilities> = {\n\tsupportsFileAttachments: true,\n\tsupportsToolAttachments: true,\n\tsupportsMCPAttachments: true,\n\tsupportsImageAttachments: true,\n\tsupportsSearchResultAttachments: true,\n\tsupportsInstructionAttachments: true,\n\tsupportsSourceControlAttachments: true,\n\tsupportsProblemAttachments: true,\n\tsupportsSymbolAttachments: true,\n\tsupportsTerminalAttachments: true,\n};\n\nexport class ChatWidget extends Disposable implements IChatWidget {\n\t// eslint-disable-next-line @typescript-eslint/no-explicit-any\n\tpublic static readonly CONTRIBS: { new(...args: [IChatWidget, ...any]): IChatWidgetContrib }[] = [];\n\n\tprivate readonly _onDidSubmitAgent = this._register(new Emitter<{ agent: IChatAgentData; slashCommand?: IChatAgentCommand }>());\n\tpublic readonly onDidSubmitAgent = this._onDidSubmitAgent.event;\n\n\tprivate _onDidChangeAgent = this._register(new Emitter<{ agent: IChatAgentData; slashCommand?: IChatAgentCommand }>());\n\treadonly onDidChangeAgent = this._onDidChangeAgent.event;\n\n\tprivate _onDidFocus = this._register(new Emitter<void>());\n\treadonly onDidFocus = this._onDidFocus.event;\n\n\tprivate _onDidChangeViewModel = this._register(new Emitter<void>());\n\treadonly onDidChangeViewModel = this._onDidChangeViewModel.event;\n\n\tprivate _onDidScroll = this._register(new Emitter<void>());\n\treadonly onDidScroll = this._onDidScroll.event;\n\n\tprivate _onDidAcceptInput = this._register(new Emitter<void>());\n\treadonly onDidAcceptInput = this._onDidAcceptInput.event;\n\n\tprivate _onDidHide = this._register(new Emitter<void>());\n\treadonly onDidHide = this._onDidHide.event;\n\n\tprivate _onDidShow = this._register(new Emitter<void>());\n\treadonly onDidShow = this._onDidShow.event;\n\n\tprivate _onDidChangeParsedInput = this._register(new Emitter<void>());\n\treadonly onDidChangeParsedInput = this._onDidChangeParsedInput.event;\n\n\tprivate readonly _onWillMaybeChangeHeight = new Emitter<void>();\n\treadonly onWillMaybeChangeHeight: Event<void> = this._onWillMaybeChangeHeight.event;\n\n\tprivate _onDidChangeHeight = this._register(new Emitter<number>());\n\treadonly onDidChangeHeight = this._onDidChangeHeight.event;\n\n\tprivate readonly _onDidChangeContentHeight = new Emitter<void>();\n\treadonly onDidChangeContentHeight: Event<void> = this._onDidChangeContentHeight.event;\n\n\tpublic contribs: ReadonlyArray<IChatWidgetContrib> = [];\n\n\tprivate tree!: WorkbenchObjectTree<ChatTreeItem, FuzzyScore>;\n\tprivate renderer!: ChatListItemRenderer;\n\tprivate readonly _codeBlockModelCollection: CodeBlockModelCollection;\n\tprivate lastItem: ChatTreeItem | undefined;\n\n\tprivate readonly inputPartDisposable: MutableDisposable<ChatInputPart> = this._register(new MutableDisposable());\n\tprivate readonly inlineInputPartDisposable: MutableDisposable<ChatInputPart> = this._register(new MutableDisposable());\n\tprivate readonly timeoutDisposable: MutableDisposable<IDisposable> = this._register(new MutableDisposable());\n\tprivate inputContainer!: HTMLElement;\n\tprivate focusedInputDOM!: HTMLElement;\n\tprivate editorOptions!: ChatEditorOptions;\n\n\tprivate recentlyRestoredCheckpoint: boolean = false;\n\n\tprivate settingChangeCounter = 0;\n\n\tprivate listContainer!: HTMLElement;\n\tprivate container!: HTMLElement;\n\tprivate historyListContainer!: HTMLElement;\n\tget domNode() {\n\t\treturn this.container;\n\t}\n\n\tprivate welcomeMessageContainer!: HTMLElement;\n\tprivate readonly welcomePart: MutableDisposable<ChatViewWelcomePart> = this._register(new MutableDisposable());\n\tprivate readonly welcomeContextMenuDisposable: MutableDisposable<IDisposable> = this._register(new MutableDisposable());\n\n\tprivate readonly historyViewStore = this._register(new DisposableStore());\n\tprivate readonly chatSuggestNextWidget: ChatSuggestNextWidget;\n\tprivate historyList: WorkbenchList<IChatHistoryListItem> | undefined;\n\n\tprivate bodyDimension: dom.Dimension | undefined;\n\tprivate visibleChangeCount = 0;\n\tprivate requestInProgress: IContextKey<boolean>;\n\tprivate agentInInput: IContextKey<boolean>;\n\tprivate inEmptyStateWithHistoryEnabledKey: IContextKey<boolean>;\n\tprivate currentRequest: Promise<void> | undefined;\n\n\tprivate _visible = false;\n\tpublic get visible() {\n\t\treturn this._visible;\n\t}\n\n\tprivate previousTreeScrollHeight: number = 0;\n\n\t/**\n\t * Whether the list is scroll-locked to the bottom. Initialize to true so that we can scroll to the bottom on first render.\n\t * The initial render leads to a lot of `onDidChangeTreeContentHeight` as the renderer works out the real heights of rows.\n\t*/\n\tprivate scrollLock = true;\n\n\tprivate _instructionFilesCheckPromise: Promise<boolean> | undefined;\n\tprivate _instructionFilesExist: boolean | undefined;\n\n\tprivate readonly viewModelDisposables = this._register(new DisposableStore());\n\tprivate _viewModel: ChatViewModel | undefined;\n\n\t// Welcome view rendering scheduler to prevent reentrant calls\n\tprivate _welcomeRenderScheduler: RunOnceScheduler;\n\n\t// Coding agent locking state\n\tprivate _lockedAgent?: {\n\t\tid: string;\n\t\tname: string;\n\t\tprefix: string;\n\t\tdisplayName: string;\n\t};\n\tprivate readonly _lockedToCodingAgentContextKey: IContextKey<boolean>;\n\tprivate readonly _agentSupportsAttachmentsContextKey: IContextKey<boolean>;\n\tprivate _attachmentCapabilities: IChatAgentAttachmentCapabilities = supportsAllAttachments;\n\n\t// Cache for prompt file descriptions to avoid async calls during rendering\n\tprivate readonly promptDescriptionsCache = new Map<string, string>();\n\tprivate readonly promptUriCache = new Map<string, URI>();\n\tprivate _isLoadingPromptDescriptions = false;\n\n\tprivate _mostRecentlyFocusedItemIndex: number = -1;\n\n\tprivate set viewModel(viewModel: ChatViewModel | undefined) {\n\t\tif (this._viewModel === viewModel) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.viewModelDisposables.clear();\n\n\t\tthis._viewModel = viewModel;\n\t\tif (viewModel) {\n\t\t\tthis.viewModelDisposables.add(viewModel);\n\t\t\tthis.logService.debug('ChatWidget#setViewModel: have viewModel');\n\t\t} else {\n\t\t\tthis.logService.debug('ChatWidget#setViewModel: no viewModel');\n\t\t}\n\n\t\tthis._onDidChangeViewModel.fire();\n\t}\n\n\tget viewModel() {\n\t\treturn this._viewModel;\n\t}\n\n\tprivate readonly _editingSession = observableValue<IChatEditingSession | undefined>(this, undefined);\n\n\tprivate parsedChatRequest: IParsedChatRequest | undefined;\n\tget parsedInput() {\n\t\tif (this.parsedChatRequest === undefined) {\n\t\t\tif (!this.viewModel) {\n\t\t\t\treturn { text: '', parts: [] };\n\t\t\t}\n\n\t\t\tthis.parsedChatRequest = this.instantiationService.createInstance(ChatRequestParser)\n\t\t\t\t.parseChatRequest(this.viewModel.sessionResource, this.getInput(), this.location, {\n\t\t\t\t\tselectedAgent: this._lastSelectedAgent,\n\t\t\t\t\tmode: this.input.currentModeKind,\n\t\t\t\t\tforcedAgent: this._lockedAgent?.id ? this.chatAgentService.getAgent(this._lockedAgent.id) : undefined\n\t\t\t\t});\n\t\t\tthis._onDidChangeParsedInput.fire();\n\t\t}\n\n\t\treturn this.parsedChatRequest;\n\t}\n\n\tget scopedContextKeyService(): IContextKeyService {\n\t\treturn this.contextKeyService;\n\t}\n\n\tprivate readonly _location: IChatWidgetLocationOptions;\n\tget location() {\n\t\treturn this._location.location;\n\t}\n\n\treadonly viewContext: IChatWidgetViewContext;\n\n\tget supportsChangingModes(): boolean {\n\t\treturn !!this.viewOptions.supportsChangingModes;\n\t}\n\n\tget chatDisclaimer(): string {\n\t\treturn localize('chatDisclaimer', \"AI responses may be inaccurate.\");\n\t}\n\n\tget locationData() {\n\t\treturn this._location.resolveData?.();\n\t}\n\n\tconstructor(\n\t\tlocation: ChatAgentLocation | IChatWidgetLocationOptions,\n\t\t_viewContext: IChatWidgetViewContext | undefined,\n\t\tprivate readonly viewOptions: IChatWidgetViewOptions,\n\t\tprivate readonly styles: IChatWidgetStyles,\n\t\t@ICodeEditorService private readonly codeEditorService: ICodeEditorService,\n\t\t@IEditorService private readonly editorService: IEditorService,\n\t\t@IConfigurationService private readonly configurationService: IConfigurationService,\n\t\t@IContextKeyService private readonly contextKeyService: IContextKeyService,\n\t\t@IInstantiationService private readonly instantiationService: IInstantiationService,\n\t\t@IChatService private readonly chatService: IChatService,\n\t\t@IChatAgentService private readonly chatAgentService: IChatAgentService,\n\t\t@IChatWidgetService private readonly chatWidgetService: IChatWidgetService,\n\t\t@IContextMenuService private readonly contextMenuService: IContextMenuService,\n\t\t@IChatAccessibilityService private readonly chatAccessibilityService: IChatAccessibilityService,\n\t\t@ILogService private readonly logService: ILogService,\n\t\t@IThemeService private readonly themeService: IThemeService,\n\t\t@IChatSlashCommandService private readonly chatSlashCommandService: IChatSlashCommandService,\n\t\t@IChatEditingService chatEditingService: IChatEditingService,\n\t\t@ITelemetryService private readonly telemetryService: ITelemetryService,\n\t\t@IPromptsService private readonly promptsService: IPromptsService,\n\t\t@ILanguageModelToolsService private readonly toolsService: ILanguageModelToolsService,\n\t\t@IChatModeService private readonly chatModeService: IChatModeService,\n\t\t@IChatLayoutService private readonly chatLayoutService: IChatLayoutService,\n\t\t@IChatEntitlementService private readonly chatEntitlementService: IChatEntitlementService,\n\t\t@ICommandService private readonly commandService: ICommandService,\n\t\t@IHoverService private readonly hoverService: IHoverService,\n\t\t@IChatSessionsService private readonly chatSessionsService: IChatSessionsService,\n\t\t@IChatTodoListService private readonly chatTodoListService: IChatTodoListService,\n\t\t@IWorkspaceContextService private readonly contextService: IWorkspaceContextService,\n\t\t@ILifecycleService private readonly lifecycleService: ILifecycleService\n\t) {\n\t\tsuper();\n\t\tthis._lockedToCodingAgentContextKey = ChatContextKeys.lockedToCodingAgent.bindTo(this.contextKeyService);\n\t\tthis._agentSupportsAttachmentsContextKey = ChatContextKeys.agentSupportsAttachments.bindTo(this.contextKeyService);\n\n\t\tthis.viewContext = _viewContext ?? {};\n\n\t\tconst viewModelObs = observableFromEvent(this, this.onDidChangeViewModel, () => this.viewModel);\n\n\t\tif (typeof location === 'object') {\n\t\t\tthis._location = location;\n\t\t} else {\n\t\t\tthis._location = { location };\n\t\t}\n\n\t\tChatContextKeys.inChatSession.bindTo(contextKeyService).set(true);\n\t\tChatContextKeys.location.bindTo(contextKeyService).set(this._location.location);\n\t\tChatContextKeys.inQuickChat.bindTo(contextKeyService).set(isQuickChat(this));\n\t\tthis.agentInInput = ChatContextKeys.inputHasAgent.bindTo(contextKeyService);\n\t\tthis.requestInProgress = ChatContextKeys.requestInProgress.bindTo(contextKeyService);\n\n\t\t// Context key for when empty state history is enabled and in empty state\n\t\tthis.inEmptyStateWithHistoryEnabledKey = ChatContextKeys.inEmptyStateWithHistoryEnabled.bindTo(contextKeyService);\n\t\tthis._welcomeRenderScheduler = this._register(new RunOnceScheduler(() => this.renderWelcomeViewContentIfNeeded(), 0));\n\t\tthis._register(this.configurationService.onDidChangeConfiguration(e => {\n\t\t\tif (e.affectsConfiguration(ChatConfiguration.EmptyStateHistoryEnabled)) {\n\t\t\t\tthis.updateEmptyStateWithHistoryContext();\n\t\t\t\tthis._welcomeRenderScheduler.schedule();\n\t\t\t}\n\t\t}));\n\t\tthis.updateEmptyStateWithHistoryContext();\n\n\t\t// Update welcome view content when `anonymous` condition changes\n\t\tthis._register(this.chatEntitlementService.onDidChangeAnonymous(() => this._welcomeRenderScheduler.schedule()));\n\n\t\tthis._register(bindContextKey(decidedChatEditingResourceContextKey, contextKeyService, (reader) => {\n\t\t\tconst currentSession = this._editingSession.read(reader);\n\t\t\tif (!currentSession) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst entries = currentSession.entries.read(reader);\n\t\t\tconst decidedEntries = entries.filter(entry => entry.state.read(reader) !== ModifiedFileEntryState.Modified);\n\t\t\treturn decidedEntries.map(entry => entry.entryId);\n\t\t}));\n\t\tthis._register(bindContextKey(hasUndecidedChatEditingResourceContextKey, contextKeyService, (reader) => {\n\t\t\tconst currentSession = this._editingSession.read(reader);\n\t\t\tconst entries = currentSession?.entries.read(reader) ?? []; // using currentSession here\n\t\t\tconst decidedEntries = entries.filter(entry => entry.state.read(reader) === ModifiedFileEntryState.Modified);\n\t\t\treturn decidedEntries.length > 0;\n\t\t}));\n\t\tthis._register(bindContextKey(hasAppliedChatEditsContextKey, contextKeyService, (reader) => {\n\t\t\tconst currentSession = this._editingSession.read(reader);\n\t\t\tif (!currentSession) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tconst entries = currentSession.entries.read(reader);\n\t\t\treturn entries.length > 0;\n\t\t}));\n\t\tthis._register(bindContextKey(inChatEditingSessionContextKey, contextKeyService, (reader) => {\n\t\t\treturn this._editingSession.read(reader) !== null;\n\t\t}));\n\t\tthis._register(bindContextKey(ChatContextKeys.chatEditingCanUndo, contextKeyService, (r) => {\n\t\t\treturn this._editingSession.read(r)?.canUndo.read(r) || false;\n\t\t}));\n\t\tthis._register(bindContextKey(ChatContextKeys.chatEditingCanRedo, contextKeyService, (r) => {\n\t\t\treturn this._editingSession.read(r)?.canRedo.read(r) || false;\n\t\t}));\n\t\tthis._register(bindContextKey(applyingChatEditsFailedContextKey, contextKeyService, (r) => {\n\t\t\tconst chatModel = viewModelObs.read(r)?.model;\n\t\t\tconst editingSession = this._editingSession.read(r);\n\t\t\tif (!editingSession || !chatModel) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tconst lastResponse = observableFromEvent(this, chatModel.onDidChange, () => chatModel.getRequests().at(-1)?.response).read(r);\n\t\t\treturn lastResponse?.result?.errorDetails && !lastResponse?.result?.errorDetails.responseIsIncomplete;\n\t\t}));\n\n\t\tthis._codeBlockModelCollection = this._register(instantiationService.createInstance(CodeBlockModelCollection, undefined));\n\t\tthis.chatSuggestNextWidget = this._register(this.instantiationService.createInstance(ChatSuggestNextWidget));\n\n\t\tthis._register(this.configurationService.onDidChangeConfiguration((e) => {\n\t\t\tif (e.affectsConfiguration('chat.renderRelatedFiles')) {\n\t\t\t\tthis.input.renderChatRelatedFiles();\n\t\t\t}\n\n\t\t\tif (e.affectsConfiguration(ChatConfiguration.EditRequests) || e.affectsConfiguration(ChatConfiguration.CheckpointsEnabled)) {\n\t\t\t\tthis.settingChangeCounter++;\n\t\t\t\tthis.onDidChangeItems();\n\t\t\t}\n\t\t}));\n\n\t\tthis._register(autorun(r => {\n\n\t\t\tconst viewModel = viewModelObs.read(r);\n\t\t\tconst sessions = chatEditingService.editingSessionsObs.read(r);\n\n\t\t\tconst session = sessions.find(candidate => isEqual(candidate.chatSessionResource, viewModel?.sessionResource));\n\t\t\tthis._editingSession.set(undefined, undefined);\n\t\t\tthis.renderChatEditingSessionState(); // this is necessary to make sure we dispose previous buttons, etc.\n\n\t\t\tif (!session) {\n\t\t\t\t// none or for a different chat widget\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst entries = session.entries.read(r);\n\t\t\tfor (const entry of entries) {\n\t\t\t\tentry.state.read(r); // SIGNAL\n\t\t\t}\n\n\t\t\tthis._editingSession.set(session, undefined);\n\n\t\t\tr.store.add(session.onDidDispose(() => {\n\t\t\t\tthis._editingSession.set(undefined, undefined);\n\t\t\t\tthis.renderChatEditingSessionState();\n\t\t\t}));\n\t\t\tr.store.add(this.onDidChangeParsedInput(() => {\n\t\t\t\tthis.renderChatEditingSessionState();\n\t\t\t}));\n\t\t\tr.store.add(this.inputEditor.onDidChangeModelContent(() => {\n\t\t\t\tif (this.getInput() === '') {\n\t\t\t\t\tthis.refreshParsedInput();\n\t\t\t\t\tthis.renderChatEditingSessionState();\n\t\t\t\t}\n\t\t\t}));\n\t\t\tthis.renderChatEditingSessionState();\n\t\t}));\n\n\t\tthis._register(codeEditorService.registerCodeEditorOpenHandler(async (input: ITextResourceEditorInput, _source: ICodeEditor | null, _sideBySide?: boolean): Promise<ICodeEditor | null> => {\n\t\t\tconst resource = input.resource;\n\t\t\tif (resource.scheme !== Schemas.vscodeChatCodeBlock) {\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tconst responseId = resource.path.split('/').at(1);\n\t\t\tif (!responseId) {\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tconst item = this.viewModel?.getItems().find(item => item.id === responseId);\n\t\t\tif (!item) {\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\t// TODO: needs to reveal the chat view\n\n\t\t\tthis.reveal(item);\n\n\t\t\tawait timeout(0); // wait for list to actually render\n\n\t\t\tfor (const codeBlockPart of this.renderer.editorsInUse()) {\n\t\t\t\tif (extUri.isEqual(codeBlockPart.uri, resource, true)) {\n\t\t\t\t\tconst editor = codeBlockPart.editor;\n\n\t\t\t\t\tlet relativeTop = 0;\n\t\t\t\t\tconst editorDomNode = editor.getDomNode();\n\t\t\t\t\tif (editorDomNode) {\n\t\t\t\t\t\tconst row = dom.findParentWithClass(editorDomNode, 'monaco-list-row');\n\t\t\t\t\t\tif (row) {\n\t\t\t\t\t\t\trelativeTop = dom.getTopLeftOffset(editorDomNode).top - dom.getTopLeftOffset(row).top;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif (input.options?.selection) {\n\t\t\t\t\t\tconst editorSelectionTopOffset = editor.getTopForPosition(input.options.selection.startLineNumber, input.options.selection.startColumn);\n\t\t\t\t\t\trelativeTop += editorSelectionTopOffset;\n\n\t\t\t\t\t\teditor.focus();\n\t\t\t\t\t\teditor.setSelection({\n\t\t\t\t\t\t\tstartLineNumber: input.options.selection.startLineNumber,\n\t\t\t\t\t\t\tstartColumn: input.options.selection.startColumn,\n\t\t\t\t\t\t\tendLineNumber: input.options.selection.endLineNumber ?? input.options.selection.startLineNumber,\n\t\t\t\t\t\t\tendColumn: input.options.selection.endColumn ?? input.options.selection.startColumn\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.reveal(item, relativeTop);\n\n\t\t\t\t\treturn editor;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn null;\n\t\t}));\n\n\t\tthis._register(this.onDidChangeParsedInput(() => this.updateChatInputContext()));\n\n\t\tthis._register(this.chatTodoListService.onDidUpdateTodos((sessionResource) => {\n\t\t\tif (isEqual(this.viewModel?.sessionResource, sessionResource)) {\n\t\t\t\tthis.inputPart.renderChatTodoListWidget(sessionResource);\n\t\t\t}\n\t\t}));\n\t}\n\n\tprivate _lastSelectedAgent: IChatAgentData | undefined;\n\tset lastSelectedAgent(agent: IChatAgentData | undefined) {\n\t\tthis.parsedChatRequest = undefined;\n\t\tthis._lastSelectedAgent = agent;\n\t\tthis._updateAgentCapabilitiesContextKeys(agent);\n\t\tthis._onDidChangeParsedInput.fire();\n\t}\n\n\tget lastSelectedAgent(): IChatAgentData | undefined {\n\t\treturn this._lastSelectedAgent;\n\t}\n\n\tprivate _updateAgentCapabilitiesContextKeys(agent: IChatAgentData | undefined): void {\n\t\t// Check if the agent has capabilities defined directly\n\t\tconst capabilities = agent?.capabilities ?? (this._lockedAgent ? this.chatSessionsService.getCapabilitiesForSessionType(this._lockedAgent.id) : undefined);\n\t\tthis._attachmentCapabilities = capabilities ?? supportsAllAttachments;\n\n\t\tconst supportsAttachments = Object.keys(filter(this._attachmentCapabilities, (key, value) => value === true)).length > 0;\n\t\tthis._agentSupportsAttachmentsContextKey.set(supportsAttachments);\n\t}\n\n\tget supportsFileReferences(): boolean {\n\t\treturn !!this.viewOptions.supportsFileReferences;\n\t}\n\n\tget attachmentCapabilities(): IChatAgentAttachmentCapabilities {\n\t\treturn this._attachmentCapabilities;\n\t}\n\n\tget input(): ChatInputPart {\n\t\treturn this.viewModel?.editing && this.configurationService.getValue<string>('chat.editRequests') !== 'input' ? this.inlineInputPart : this.inputPart;\n\t}\n\n\tprivate get inputPart(): ChatInputPart {\n\t\treturn this.inputPartDisposable.value!;\n\t}\n\n\tprivate get inlineInputPart(): ChatInputPart {\n\t\treturn this.inlineInputPartDisposable.value!;\n\t}\n\n\tget inputEditor(): ICodeEditor {\n\t\treturn this.input.inputEditor;\n\t}\n\n\tget contentHeight(): number {\n\t\treturn this.input.contentHeight + this.tree.contentHeight + this.chatSuggestNextWidget.height;\n\t}\n\n\tget attachmentModel(): ChatAttachmentModel {\n\t\treturn this.input.attachmentModel;\n\t}\n\n\trender(parent: HTMLElement): void {\n\t\tconst viewId = isIChatViewViewContext(this.viewContext) ? this.viewContext.viewId : undefined;\n\t\tthis.editorOptions = this._register(this.instantiationService.createInstance(ChatEditorOptions, viewId, this.styles.listForeground, this.styles.inputEditorBackground, this.styles.resultEditorBackground));\n\t\tconst renderInputOnTop = this.viewOptions.renderInputOnTop ?? false;\n\t\tconst renderFollowups = this.viewOptions.renderFollowups ?? !renderInputOnTop;\n\t\tconst renderStyle = this.viewOptions.renderStyle;\n\t\tconst renderInputToolbarBelowInput = this.viewOptions.renderInputToolbarBelowInput ?? false;\n\n\t\tthis.container = dom.append(parent, $('.interactive-session'));\n\t\tthis.welcomeMessageContainer = dom.append(this.container, $('.chat-welcome-view-container', { style: 'display: none' }));\n\t\tthis._register(dom.addStandardDisposableListener(this.welcomeMessageContainer, dom.EventType.CLICK, () => this.focusInput()));\n\n\t\tthis._register(this.chatSuggestNextWidget.onDidChangeHeight(() => {\n\t\t\tif (this.bodyDimension) {\n\t\t\t\tthis.layout(this.bodyDimension.height, this.bodyDimension.width);\n\t\t\t}\n\t\t}));\n\t\tthis._register(this.chatSuggestNextWidget.onDidSelectPrompt(({ handoff }) => {\n\t\t\tthis.handleNextPromptSelection(handoff);\n\t\t}));\n\n\t\tif (renderInputOnTop) {\n\t\t\tthis.createInput(this.container, { renderFollowups, renderStyle, renderInputToolbarBelowInput });\n\t\t\tthis.listContainer = dom.append(this.container, $(`.interactive-list`));\n\t\t} else {\n\t\t\tthis.listContainer = dom.append(this.container, $(`.interactive-list`));\n\t\t\tdom.append(this.container, this.chatSuggestNextWidget.domNode);\n\t\t\tthis.createInput(this.container, { renderFollowups, renderStyle, renderInputToolbarBelowInput });\n\t\t}\n\n\t\tthis._welcomeRenderScheduler.schedule();\n\t\tthis.createList(this.listContainer, { editable: !isInlineChat(this) && !isQuickChat(this), ...this.viewOptions.rendererOptions, renderStyle });\n\n\t\tconst scrollDownButton = this._register(new Button(this.listContainer, {\n\t\t\tsupportIcons: true,\n\t\t\tbuttonBackground: asCssVariable(buttonSecondaryBackground),\n\t\t\tbuttonForeground: asCssVariable(buttonSecondaryForeground),\n\t\t\tbuttonHoverBackground: asCssVariable(buttonSecondaryHoverBackground),\n\t\t}));\n\t\tscrollDownButton.element.classList.add('chat-scroll-down');\n\t\tscrollDownButton.label = `$(${Codicon.chevronDown.id})`;\n\t\tscrollDownButton.setTitle(localize('scrollDownButtonLabel', \"Scroll down\"));\n\t\tthis._register(scrollDownButton.onDidClick(() => {\n\t\t\tthis.scrollLock = true;\n\t\t\tthis.scrollToEnd();\n\t\t}));\n\n\t\t// Update the font family and size\n\t\tthis._register(autorun(reader => {\n\t\t\tconst fontFamily = this.chatLayoutService.fontFamily.read(reader);\n\t\t\tconst fontSize = this.chatLayoutService.fontSize.read(reader);\n\n\t\t\tthis.container.style.setProperty('--vscode-chat-font-family', fontFamily);\n\t\t\tthis.container.style.fontSize = `${fontSize}px`;\n\n\t\t\tthis.tree.rerender();\n\t\t}));\n\n\t\tthis._register(this.editorOptions.onDidChange(() => this.onDidStyleChange()));\n\t\tthis.onDidStyleChange();\n\n\t\t// Do initial render\n\t\tif (this.viewModel) {\n\t\t\tthis.onDidChangeItems();\n\t\t\tthis.scrollToEnd();\n\t\t}\n\n\t\tthis.contribs = ChatWidget.CONTRIBS.map(contrib => {\n\t\t\ttry {\n\t\t\t\treturn this._register(this.instantiationService.createInstance(contrib, this));\n\t\t\t} catch (err) {\n\t\t\t\tthis.logService.error('Failed to instantiate chat widget contrib', toErrorMessage(err));\n\t\t\t\treturn undefined;\n\t\t\t}\n\t\t}).filter(isDefined);\n\n\t\tthis._register(this.chatWidgetService.register(this));\n\n\t\tconst parsedInput = observableFromEvent(this.onDidChangeParsedInput, () => this.parsedInput);\n\t\tthis._register(autorun(r => {\n\t\t\tconst input = parsedInput.read(r);\n\n\t\t\tconst newPromptAttachments = new Map<string, IChatRequestVariableEntry>();\n\t\t\tconst oldPromptAttachments = new Set<string>();\n\n\t\t\t// get all attachments, know those that are prompt-referenced\n\t\t\tfor (const attachment of this.attachmentModel.attachments) {\n\t\t\t\tif (attachment.range) {\n\t\t\t\t\toldPromptAttachments.add(attachment.id);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// update/insert prompt-referenced attachments\n\t\t\tfor (const part of input.parts) {\n\t\t\t\tif (part instanceof ChatRequestToolPart || part instanceof ChatRequestToolSetPart || part instanceof ChatRequestDynamicVariablePart) {\n\t\t\t\t\tconst entry = part.toVariableEntry();\n\t\t\t\t\tnewPromptAttachments.set(entry.id, entry);\n\t\t\t\t\toldPromptAttachments.delete(entry.id);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis.attachmentModel.updateContext(oldPromptAttachments, newPromptAttachments.values());\n\t\t}));\n\n\t\tif (!this.focusedInputDOM) {\n\t\t\tthis.focusedInputDOM = this.container.appendChild(dom.$('.focused-input-dom'));\n\t\t}\n\t}\n\n\tprivate scrollToEnd() {\n\t\tif (this.lastItem) {\n\t\t\tconst offset = Math.max(this.lastItem.currentRenderedHeight ?? 0, 1e6);\n\t\t\tthis.tree.reveal(this.lastItem, offset);\n\t\t}\n\t}\n\n\tfocusInput(): void {\n\t\tthis.input.focus();\n\n\t\t// Sometimes focusing the input part is not possible,\n\t\t// but we'd like to be the last focused chat widget,\n\t\t// so we emit an optimistic onDidFocus event nonetheless.\n\t\tthis._onDidFocus.fire();\n\t}\n\n\thasInputFocus(): boolean {\n\t\treturn this.input.hasFocus();\n\t}\n\n\trefreshParsedInput() {\n\t\tif (!this.viewModel) {\n\t\t\treturn;\n\t\t}\n\t\tthis.parsedChatRequest = this.instantiationService.createInstance(ChatRequestParser).parseChatRequest(this.viewModel.sessionResource, this.getInput(), this.location, { selectedAgent: this._lastSelectedAgent, mode: this.input.currentModeKind });\n\t\tthis._onDidChangeParsedInput.fire();\n\t}\n\n\tgetSibling(item: ChatTreeItem, type: 'next' | 'previous'): ChatTreeItem | undefined {\n\t\tif (!isResponseVM(item)) {\n\t\t\treturn;\n\t\t}\n\t\tconst items = this.viewModel?.getItems();\n\t\tif (!items) {\n\t\t\treturn;\n\t\t}\n\t\tconst responseItems = items.filter(i => isResponseVM(i));\n\t\tconst targetIndex = responseItems.indexOf(item);\n\t\tif (targetIndex === undefined) {\n\t\t\treturn;\n\t\t}\n\t\tconst indexToFocus = type === 'next' ? targetIndex + 1 : targetIndex - 1;\n\t\tif (indexToFocus < 0 || indexToFocus > responseItems.length - 1) {\n\t\t\treturn;\n\t\t}\n\t\treturn responseItems[indexToFocus];\n\t}\n\n\tasync clear(): Promise<void> {\n\t\tthis.logService.debug('ChatWidget#clear');\n\t\tif (this._dynamicMessageLayoutData) {\n\t\t\tthis._dynamicMessageLayoutData.enabled = true;\n\t\t}\n\n\t\tif (this.viewModel) {\n\t\t\tthis.viewModel.resetInputPlaceholder();\n\t\t}\n\t\tif (this._lockedAgent) {\n\t\t\tthis.lockToCodingAgent(this._lockedAgent.name, this._lockedAgent.displayName, this._lockedAgent.id);\n\t\t} else {\n\t\t\tthis.unlockFromCodingAgent();\n\t\t}\n\n\t\tthis.inputPart.clearTodoListWidget(this.viewModel?.sessionResource, true);\n\t\tthis.chatSuggestNextWidget.hide();\n\t\tawait this.viewOptions.clear?.();\n\t}\n\n\tprivate onDidChangeItems(skipDynamicLayout?: boolean) {\n\t\t// Update context key when items change\n\t\tthis.updateEmptyStateWithHistoryContext();\n\n\t\tif (this._visible || !this.viewModel) {\n\t\t\tconst treeItems = (this.viewModel?.getItems() ?? [])\n\t\t\t\t.map((item): ITreeElement<ChatTreeItem> => {\n\t\t\t\t\treturn {\n\t\t\t\t\t\telement: item,\n\t\t\t\t\t\tcollapsed: false,\n\t\t\t\t\t\tcollapsible: false\n\t\t\t\t\t};\n\t\t\t\t});\n\n\n\t\t\tif (treeItems.length > 0) {\n\t\t\t\tthis.updateChatViewVisibility();\n\t\t\t} else {\n\t\t\t\tthis._welcomeRenderScheduler.schedule();\n\t\t\t}\n\n\t\t\tthis._onWillMaybeChangeHeight.fire();\n\n\t\t\tthis.lastItem = treeItems.at(-1)?.element;\n\t\t\tChatContextKeys.lastItemId.bindTo(this.contextKeyService).set(this.lastItem ? [this.lastItem.id] : []);\n\t\t\tthis.tree.setChildren(null, treeItems, {\n\t\t\t\tdiffIdentityProvider: {\n\t\t\t\t\tgetId: (element) => {\n\t\t\t\t\t\treturn element.dataId +\n\t\t\t\t\t\t\t// Ensure re-rendering an element once slash commands are loaded, so the colorization can be applied.\n\t\t\t\t\t\t\t`${(isRequestVM(element)) /* && !!this.lastSlashCommands ? '_scLoaded' : '' */}` +\n\t\t\t\t\t\t\t// If a response is in the process of progressive rendering, we need to ensure that it will\n\t\t\t\t\t\t\t// be re-rendered so progressive rendering is restarted, even if the model wasn't updated.\n\t\t\t\t\t\t\t`${isResponseVM(element) && element.renderData ? `_${this.visibleChangeCount}` : ''}` +\n\t\t\t\t\t\t\t// Re-render once content references are loaded\n\t\t\t\t\t\t\t(isResponseVM(element) ? `_${element.contentReferences.length}` : '') +\n\t\t\t\t\t\t\t// Re-render if element becomes hidden due to undo/redo\n\t\t\t\t\t\t\t`_${element.shouldBeRemovedOnSend ? `${element.shouldBeRemovedOnSend.afterUndoStop || '1'}` : '0'}` +\n\t\t\t\t\t\t\t// Re-render if element becomes enabled/disabled due to checkpointing\n\t\t\t\t\t\t\t`_${element.shouldBeBlocked ? '1' : '0'}` +\n\t\t\t\t\t\t\t// Re-render if we have an element currently being edited\n\t\t\t\t\t\t\t`_${this.viewModel?.editing ? '1' : '0'}` +\n\t\t\t\t\t\t\t// Re-render if we have an element currently being checkpointed\n\t\t\t\t\t\t\t`_${this.viewModel?.model.checkpoint ? '1' : '0'}` +\n\t\t\t\t\t\t\t// Re-render all if invoked by setting change\n\t\t\t\t\t\t\t`_setting${this.settingChangeCounter || '0'}` +\n\t\t\t\t\t\t\t// Rerender request if we got new content references in the response\n\t\t\t\t\t\t\t// since this may change how we render the corresponding attachments in the request\n\t\t\t\t\t\t\t(isRequestVM(element) && element.contentReferences ? `_${element.contentReferences?.length}` : '');\n\t\t\t\t\t},\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif (!skipDynamicLayout && this._dynamicMessageLayoutData) {\n\t\t\t\tthis.layoutDynamicChatTreeItemMode();\n\t\t\t}\n\n\t\t\tthis.renderFollowups();\n\t\t}\n\t}\n\n\t/**\n\t * Updates the DOM visibility of welcome view and chat list immediately\n\t * @internal\n\t */\n\tprivate updateChatViewVisibility(): void {\n\t\tif (!this.viewModel) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst numItems = this.viewModel.getItems().length;\n\t\tdom.setVisibility(numItems === 0, this.welcomeMessageContainer);\n\t\tdom.setVisibility(numItems !== 0, this.listContainer);\n\t}\n\n\t/**\n\t * Renders the welcome view content when needed.\n\t *\n\t * Note: Do not call this method directly. Instead, use `this._welcomeRenderScheduler.schedule()`\n\t * to ensure proper debouncing and avoid potential cyclic calls\n\t * @internal\n\t */\n\tprivate renderWelcomeViewContentIfNeeded() {\n\t\tif (this.viewOptions.renderStyle === 'compact' || this.viewOptions.renderStyle === 'minimal' || this.lifecycleService.willShutdown) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst numItems = this.viewModel?.getItems().length ?? 0;\n\t\tif (!numItems) {\n\t\t\tconst defaultAgent = this.chatAgentService.getDefaultAgent(this.location, this.input.currentModeKind);\n\t\t\tlet additionalMessage: string | IMarkdownString | undefined;\n\t\t\tif (this.chatEntitlementService.anonymous && !this.chatEntitlementService.sentiment.installed) {\n\t\t\t\tadditionalMessage = new MarkdownString(localize({ key: 'settings', comment: ['{Locked=\"]({2})\"}', '{Locked=\"]({3})\"}'] }, \"By continuing with {0} Copilot, you agree to {1}'s [Terms]({2}) and [Privacy Statement]({3}).\", defaultChat.provider.default.name, defaultChat.provider.default.name, defaultChat.termsStatementUrl, defaultChat.privacyStatementUrl), { isTrusted: true });\n\t\t\t} else {\n\t\t\t\tadditionalMessage = defaultAgent?.metadata.additionalWelcomeMessage;\n\t\t\t}\n\t\t\tif (!additionalMessage && !this._lockedAgent) {\n\t\t\t\tadditionalMessage = this._getGenerateInstructionsMessage();\n\t\t\t}\n\t\t\tconst welcomeContent = this.getWelcomeViewContent(additionalMessage);\n\t\t\tif (!this.welcomePart.value || this.welcomePart.value.needsRerender(welcomeContent)) {\n\t\t\t\tthis.historyViewStore.clear();\n\t\t\t\tdom.clearNode(this.welcomeMessageContainer);\n\n\t\t\t\t// Reset history list reference when clearing welcome view\n\t\t\t\tthis.historyList = undefined;\n\n\t\t\t\t// Optional: recent chat history above welcome content when enabled\n\t\t\t\tconst showHistory = this.configurationService.getValue<boolean>(ChatConfiguration.EmptyStateHistoryEnabled);\n\t\t\t\tif (showHistory && !this._lockedAgent) {\n\t\t\t\t\tthis.renderWelcomeHistorySection();\n\t\t\t\t}\n\t\t\t\tthis.welcomePart.value = this.instantiationService.createInstance(\n\t\t\t\t\tChatViewWelcomePart,\n\t\t\t\t\twelcomeContent,\n\t\t\t\t\t{\n\t\t\t\t\t\tlocation: this.location,\n\t\t\t\t\t\tisWidgetAgentWelcomeViewContent: this.input?.currentModeKind === ChatModeKind.Agent\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t\tdom.append(this.welcomeMessageContainer, this.welcomePart.value.element);\n\n\t\t\t\t// Add right-click context menu to the entire welcome container\n\t\t\t\tthis.welcomeContextMenuDisposable.value = dom.addDisposableListener(this.welcomeMessageContainer, dom.EventType.CONTEXT_MENU, (e) => {\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\te.stopPropagation();\n\t\t\t\t\tthis.contextMenuService.showContextMenu({\n\t\t\t\t\t\tmenuId: MenuId.ChatWelcomeContext,\n\t\t\t\t\t\tcontextKeyService: this.contextKeyService,\n\t\t\t\t\t\tgetAnchor: () => new StandardMouseEvent(dom.getWindow(this.welcomeMessageContainer), e)\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tthis.updateChatViewVisibility();\n\n\t\tif (numItems === 0) {\n\t\t\tthis.refreshHistoryList();\n\t\t}\n\t}\n\n\tprivate updateEmptyStateWithHistoryContext(): void {\n\t\tconst historyEnabled = this.configurationService.getValue<boolean>(ChatConfiguration.EmptyStateHistoryEnabled);\n\t\tconst numItems = this.viewModel?.getItems().length ?? 0;\n\t\tconst shouldHideButtons = historyEnabled && numItems === 0;\n\t\tthis.inEmptyStateWithHistoryEnabledKey.set(shouldHideButtons);\n\t}\n\n\tprivate async renderWelcomeHistorySection(): Promise<void> {\n\t\ttry {\n\t\t\tconst historyRoot = dom.append(this.welcomeMessageContainer, $('.chat-welcome-history-root'));\n\t\t\tconst container = dom.append(historyRoot, $('.chat-welcome-history'));\n\n\t\t\tconst initialHistoryItems = await this.computeHistoryItems();\n\t\t\tif (initialHistoryItems.length === 0) {\n\t\t\t\thistoryRoot.remove();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.historyListContainer = dom.append(container, $('.chat-welcome-history-list'));\n\t\t\tthis.welcomeMessageContainer.classList.toggle('has-chat-history', initialHistoryItems.length > 0);\n\n\t\t\t// Compute today's midnight once for label decisions\n\t\t\tconst todayMidnight = new Date();\n\t\t\ttodayMidnight.setHours(0, 0, 0, 0);\n\t\t\tconst todayMidnightMs = todayMidnight.getTime();\n\n\t\t\t// Create hover delegate for proper tooltip positioning\n\t\t\tconst getViewContainerLocation = () => {\n\t\t\t\tconst panelLocation = this.contextKeyService.getContextKeyValue<ViewContainerLocation>('chatPanelLocation');\n\t\t\t\treturn panelLocation ?? ViewContainerLocation.AuxiliaryBar;\n\t\t\t};\n\t\t\tconst hoverDelegate = this.instantiationService.createInstance(ChatHistoryHoverDelegate, getViewContainerLocation);\n\n\t\t\tif (!this.historyList) {\n\t\t\t\tconst delegate = new ChatHistoryListDelegate();\n\n\t\t\t\tconst renderer = this.instantiationService.createInstance(\n\t\t\t\t\tChatHistoryListRenderer,\n\t\t\t\t\tasync (item) => await this.openHistorySession(item.sessionResource),\n\t\t\t\t\t(timestamp, todayMs) => this.formatHistoryTimestamp(timestamp, todayMs),\n\t\t\t\t\ttodayMidnightMs\n\t\t\t\t);\n\t\t\t\tthis.historyList = this._register(this.instantiationService.createInstance(\n\t\t\t\t\tWorkbenchList<IChatHistoryListItem>,\n\t\t\t\t\t'ChatHistoryList',\n\t\t\t\t\tthis.historyListContainer,\n\t\t\t\t\tdelegate,\n\t\t\t\t\t[renderer],\n\t\t\t\t\t{\n\t\t\t\t\t\thorizontalScrolling: false,\n\t\t\t\t\t\tkeyboardSupport: true,\n\t\t\t\t\t\tmouseSupport: true,\n\t\t\t\t\t\tmultipleSelectionSupport: false,\n\t\t\t\t\t\toverrideStyles: {\n\t\t\t\t\t\t\tlistBackground: this.styles.listBackground\n\t\t\t\t\t\t},\n\t\t\t\t\t\taccessibilityProvider: {\n\t\t\t\t\t\t\tgetAriaLabel: (item: IChatHistoryListItem) => item.title,\n\t\t\t\t\t\t\tgetWidgetAriaLabel: () => localize('chat.history.list', 'Chat History')\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t));\n\t\t\t\tthis.historyList.getHTMLElement().tabIndex = -1;\n\t\t\t} else {\n\t\t\t\tconst currentHistoryList = this.historyList.getHTMLElement();\n\t\t\t\tif (currentHistoryList && currentHistoryList.parentElement !== this.historyListContainer) {\n\t\t\t\t\tthis.historyListContainer.appendChild(currentHistoryList);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis.renderHistoryItems(initialHistoryItems);\n\n\t\t\t// Add \"Chat history...\" link at the end\n\t\t\tconst previousChatsLink = dom.append(container, $('.chat-welcome-history-more'));\n\t\t\tpreviousChatsLink.textContent = localize('chat.history.showMore', 'Chat history...');\n\t\t\tpreviousChatsLink.setAttribute('role', 'button');\n\t\t\tpreviousChatsLink.setAttribute('tabindex', '0');\n\t\t\tpreviousChatsLink.setAttribute('aria-label', localize('chat.history.showMoreAriaLabel', 'Open chat history'));\n\n\t\t\t// Add hover tooltip for the link at the end of the list\n\t\t\tconst hoverContent = localize('chat.history.showMoreHover', 'Show chat history...');\n\t\t\tthis._register(this.hoverService.setupManagedHover(hoverDelegate, previousChatsLink, hoverContent));\n\n\t\t\tthis._register(dom.addDisposableListener(previousChatsLink, dom.EventType.CLICK, (e) => {\n\t\t\t\te.preventDefault();\n\t\t\t\te.stopPropagation();\n\t\t\t\tthis.commandService.executeCommand('workbench.action.chat.history');\n\t\t\t}));\n\t\t\tthis._register(dom.addDisposableListener(previousChatsLink, dom.EventType.KEY_DOWN, (e) => {\n\t\t\t\tif (e.key === 'Enter' || e.key === ' ') {\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\tthis.commandService.executeCommand('workbench.action.chat.history');\n\t\t\t\t}\n\t\t\t}));\n\t\t} catch (err) {\n\t\t\tthis.logService.error('Failed to render welcome history', err);\n\t\t}\n\t}\n\n\tprivate async computeHistoryItems(): Promise<IChatHistoryListItem[]> {\n\t\ttry {\n\t\t\tconst items = await this.chatService.getLocalSessionHistory();\n\t\t\treturn items\n\t\t\t\t.filter(i => !i.isActive)\n\t\t\t\t.sort((a, b) => (b.lastMessageDate ?? 0) - (a.lastMessageDate ?? 0))\n\t\t\t\t.slice(0, 3)\n\t\t\t\t.map((item): IChatHistoryListItem => ({\n\t\t\t\t\tsessionResource: item.sessionResource,\n\t\t\t\t\ttitle: item.title,\n\t\t\t\t\tlastMessageDate: typeof item.lastMessageDate === 'number' ? item.lastMessageDate : Date.now(),\n\t\t\t\t\tisActive: item.isActive\n\t\t\t\t}));\n\t\t} catch (err) {\n\t\t\tthis.logService.error('Failed to compute chat history items', err);\n\t\t\treturn [];\n\t\t}\n\t}\n\n\tprivate renderHistoryItems(historyItems: IChatHistoryListItem[]): void {\n\t\tif (!this.historyList) {\n\t\t\treturn;\n\t\t}\n\t\tconst listHeight = historyItems.length * 22;\n\t\tif (this.historyListContainer) {\n\t\t\tthis.historyListContainer.style.height = `${listHeight}px`;\n\t\t\tthis.historyListContainer.style.minHeight = `${listHeight}px`;\n\t\t}\n\t\tthis.historyList.splice(0, this.historyList.length, historyItems);\n\t\tthis.historyList.layout(undefined, listHeight);\n\t}\n\n\tprivate formatHistoryTimestamp(last: number, todayMidnightMs: number): string {\n\t\tif (last > todayMidnightMs) {\n\t\t\tconst diffMs = Date.now() - last;\n\t\t\tconst minMs = 60 * 1000;\n\t\t\tconst adjusted = diffMs < minMs ? Date.now() - minMs : last;\n\t\t\treturn fromNow(adjusted, true, true);\n\t\t}\n\t\treturn fromNowByDay(last, true, true);\n\t}\n\n\tprivate async openHistorySession(sessionResource: URI): Promise<void> {\n\t\ttry {\n\t\t\tconst viewsService = this.instantiationService.invokeFunction(accessor => accessor.get(IViewsService));\n\t\t\tconst chatView = await viewsService.openView<ChatViewPane>(ChatViewId);\n\t\t\tawait chatView?.loadSession(sessionResource);\n\t\t} catch (e) {\n\t\t\tthis.logService.error('Failed to open chat session from history', e);\n\t\t}\n\t}\n\n\tprivate async refreshHistoryList(): Promise<void> {\n\t\tconst numItems = this.viewModel?.getItems().length ?? 0;\n\t\t// Only refresh history list when in empty state (welcome view) and history list exists\n\t\tif (numItems !== 0 || !this.historyList) {\n\t\t\treturn;\n\t\t}\n\t\tconst historyItems = await this.computeHistoryItems();\n\t\tthis.renderHistoryItems(historyItems);\n\t}\n\n\tprivate _getGenerateInstructionsMessage(): IMarkdownString {\n\t\t// Start checking for instruction files immediately if not already done\n\t\tif (!this._instructionFilesCheckPromise) {\n\t\t\tthis._instructionFilesCheckPromise = this._checkForAgentInstructionFiles();\n\t\t\t// Use VS Code's idiomatic pattern for disposal-safe promise callbacks\n\t\t\tthis._register(thenIfNotDisposed(this._instructionFilesCheckPromise, hasFiles => {\n\t\t\t\tthis._instructionFilesExist = hasFiles;\n\t\t\t\t// Only re-render if the current view still doesn't have items and we're showing the welcome message\n\t\t\t\tconst hasViewModelItems = this.viewModel?.getItems().length ?? 0;\n\t\t\t\tif (hasViewModelItems === 0) {\n\t\t\t\t\tthis._welcomeRenderScheduler.schedule();\n\t\t\t\t}\n\t\t\t}));\n\t\t}\n\n\t\t// If we already know the result, use it\n\t\tif (this._instructionFilesExist === true) {\n\t\t\t// Don't show generate instructions message if files exist\n\t\t\treturn new MarkdownString('');\n\t\t} else if (this._instructionFilesExist === false) {\n\t\t\t// Show generate instructions message if no files exist\n\t\t\tconst generateInstructionsCommand = 'workbench.action.chat.generateInstructions';\n\t\t\treturn new MarkdownString(localize(\n\t\t\t\t'chatWidget.instructions',\n\t\t\t\t\"[Generate Agent Instructions]({0}) to onboard AI onto your codebase.\",\n\t\t\t\t`command:${generateInstructionsCommand}`\n\t\t\t), { isTrusted: { enabledCommands: [generateInstructionsCommand] } });\n\t\t}\n\n\t\t// While checking, don't show the generate instructions message\n\t\treturn new MarkdownString('');\n\t}\n\n\t/**\n\t * Checks if any agent instruction files (.github/copilot-instructions.md or AGENTS.md) exist in the workspace.\n\t * Used to determine whether to show the \"Generate Agent Instructions\" hint.\n\t *\n\t * @returns true if instruction files exist OR if instruction features are disabled (to hide the hint)\n\t */\n\tprivate async _checkForAgentInstructionFiles(): Promise<boolean> {\n\t\ttry {\n\t\t\tconst useCopilotInstructionsFiles = this.configurationService.getValue(PromptsConfig.USE_COPILOT_INSTRUCTION_FILES);\n\t\t\tconst useAgentMd = this.configurationService.getValue(PromptsConfig.USE_AGENT_MD);\n\t\t\tif (!useCopilotInstructionsFiles && !useAgentMd) {\n\t\t\t\t// If both settings are disabled, return true to hide the hint (since the features aren't enabled)\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\treturn (\n\t\t\t\t(await this.promptsService.listCopilotInstructionsMDs(CancellationToken.None)).length > 0 ||\n\t\t\t\t// Note: only checking for AGENTS.md files at the root folder, not ones in subfolders.\n\t\t\t\t(await this.promptsService.listAgentMDs(CancellationToken.None, false)).length > 0\n\t\t\t);\n\t\t} catch (error) {\n\t\t\t// On error, assume no instruction files exist to be safe\n\t\t\tthis.logService.warn('[ChatWidget] Error checking for instruction files:', error);\n\t\t\treturn false;\n\t\t}\n\t}\n\n\tprivate getWelcomeViewContent(additionalMessage: string | IMarkdownString | undefined): IChatViewWelcomeContent {\n\t\tif (this.isLockedToCodingAgent) {\n\t\t\t// Check for provider-specific customizations from chat sessions service\n\t\t\tconst providerIcon = this._lockedAgent ? this.chatSessionsService.getIconForSessionType(this._lockedAgent.id) : undefined;\n\t\t\tconst providerTitle = this._lockedAgent ? this.chatSessionsService.getWelcomeTitleForSessionType(this._lockedAgent.id) : undefined;\n\t\t\tconst providerMessage = this._lockedAgent ? this.chatSessionsService.getWelcomeMessageForSessionType(this._lockedAgent.id) : undefined;\n\n\t\t\t// Fallback to default messages if provider doesn't specify\n\t\t\tconst message = providerMessage\n\t\t\t\t? new MarkdownString(providerMessage)\n\t\t\t\t: (this._lockedAgent?.prefix === '@copilot '\n\t\t\t\t\t? new MarkdownString(localize('copilotCodingAgentMessage', \"This chat session will be forwarded to the {0} [coding agent]({1}) where work is completed in the background. \", this._lockedAgent.prefix, 'https://aka.ms/coding-agent-docs') + this.chatDisclaimer, { isTrusted: true })\n\t\t\t\t\t: new MarkdownString(localize('genericCodingAgentMessage', \"This chat session will be forwarded to the {0} coding agent where work is completed in the background. \", this._lockedAgent?.prefix) + this.chatDisclaimer));\n\n\t\t\treturn {\n\t\t\t\ttitle: providerTitle ?? localize('codingAgentTitle', \"Delegate to {0}\", this._lockedAgent?.prefix),\n\t\t\t\tmessage,\n\t\t\t\ticon: providerIcon ?? Codicon.sendToRemoteAgent,\n\t\t\t\tadditionalMessage,\n\t\t\t\tuseLargeIcon: !!providerIcon,\n\t\t\t};\n\t\t}\n\n\t\tlet title: string;\n\t\tif (this.input.currentModeKind === ChatModeKind.Ask) {\n\t\t\ttitle = localize('chatDescription', \"Ask about your code\");\n\t\t} else if (this.input.currentModeKind === ChatModeKind.Edit) {\n\t\t\ttitle = localize('editsTitle', \"Edit in context\");\n\t\t} else {\n\t\t\ttitle = localize('agentTitle', \"Build with Agent\");\n\t\t}\n\n\t\treturn {\n\t\t\ttitle,\n\t\t\tmessage: new MarkdownString(this.chatDisclaimer),\n\t\t\ticon: Codicon.chatSparkle,\n\t\t\tadditionalMessage,\n\t\t\tsuggestedPrompts: this.getPromptFileSuggestions()\n\t\t};\n\t}\n\n\tprivate getPromptFileSuggestions(): IChatSuggestedPrompts[] {\n\n\t\t// Use predefined suggestions for new users\n\t\tif (!this.chatEntitlementService.sentiment.installed) {\n\t\t\tconst isEmpty = this.contextService.getWorkbenchState() === WorkbenchState.EMPTY;\n\t\t\tif (isEmpty) {\n\t\t\t\treturn [\n\t\t\t\t\t{\n\t\t\t\t\t\ticon: Codicon.vscode,\n\t\t\t\t\t\tlabel: localize('chatWidget.suggestedPrompts.gettingStarted', \"Ask @vscode\"),\n\t\t\t\t\t\tprompt: localize('chatWidget.suggestedPrompts.gettingStartedPrompt', \"@vscode How do I change the theme to light mode?\"),\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\ticon: Codicon.newFolder,\n\t\t\t\t\t\tlabel: localize('chatWidget.suggestedPrompts.newProject', \"Create Project\"),\n\t\t\t\t\t\tprompt: localize('chatWidget.suggestedPrompts.newProjectPrompt', \"Create a #new Hello World project in TypeScript\"),\n\t\t\t\t\t}\n\t\t\t\t];\n\t\t\t} else {\n\t\t\t\treturn [\n\t\t\t\t\t{\n\t\t\t\t\t\ticon: Codicon.debugAlt,\n\t\t\t\t\t\tlabel: localize('chatWidget.suggestedPrompts.buildWorkspace', \"Build Workspace\"),\n\t\t\t\t\t\tprompt: localize('chatWidget.suggestedPrompts.buildWorkspacePrompt', \"How do I build this workspace?\"),\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\ticon: Codicon.gear,\n\t\t\t\t\t\tlabel: localize('chatWidget.suggestedPrompts.findConfig', \"Show Config\"),\n\t\t\t\t\t\tprompt: localize('chatWidget.suggestedPrompts.findConfigPrompt', \"Where is the configuration for this project defined?\"),\n\t\t\t\t\t}\n\t\t\t\t];\n\t\t\t}\n\t\t}\n\n\t\t// Get the current workspace folder context if available\n\t\tconst activeEditor = this.editorService.activeEditor;\n\t\tconst resource = activeEditor ? EditorResourceAccessor.getOriginalUri(activeEditor) : undefined;\n\n\t\t// Get the prompt file suggestions configuration\n\t\tconst suggestions = PromptsConfig.getPromptFilesRecommendationsValue(this.configurationService, resource);\n\t\tif (!suggestions) {\n\t\t\treturn [];\n\t\t}\n\n\t\tconst result: IChatSuggestedPrompts[] = [];\n\t\tconst promptsToLoad: string[] = [];\n\n\t\t// First, collect all prompts that need loading (regardless of shouldInclude)\n\t\tfor (const [promptName] of Object.entries(suggestions)) {\n\t\t\tconst description = this.promptDescriptionsCache.get(promptName);\n\t\t\tif (description === undefined) {\n\t\t\t\tpromptsToLoad.push(promptName);\n\t\t\t}\n\t\t}\n\n\t\t// If we have prompts to load, load them asynchronously and don't return anything yet\n\t\t// But only if we're not already loading to prevent infinite loop\n\t\tif (promptsToLoad.length > 0 && !this._isLoadingPromptDescriptions) {\n\t\t\tthis.loadPromptDescriptions(promptsToLoad);\n\t\t\treturn [];\n\t\t}\n\n\t\t// Now process the suggestions with loaded descriptions\n\t\tconst promptsWithScores: { promptName: string; condition: boolean | string; score: number }[] = [];\n\n\t\tfor (const [promptName, condition] of Object.entries(suggestions)) {\n\t\t\tlet score = 0;\n\n\t\t\t// Handle boolean conditions\n\t\t\tif (typeof condition === 'boolean') {\n\t\t\t\tscore = condition ? 1 : 0;\n\t\t\t}\n\t\t\t// Handle when clause conditions\n\t\t\telse if (typeof condition === 'string') {\n\t\t\t\ttry {\n\t\t\t\t\tconst whenClause = ContextKeyExpr.deserialize(condition);\n\t\t\t\t\tif (whenClause) {\n\t\t\t\t\t\t// Test against all open code editors\n\t\t\t\t\t\tconst allEditors = this.codeEditorService.listCodeEditors();\n\n\t\t\t\t\t\tif (allEditors.length > 0) {\n\t\t\t\t\t\t\t// Count how many editors match the when clause\n\t\t\t\t\t\t\tscore = allEditors.reduce((count, editor) => {\n\t\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\t\tconst editorContext = this.contextKeyService.getContext(editor.getDomNode());\n\t\t\t\t\t\t\t\t\treturn count + (whenClause.evaluate(editorContext) ? 1 : 0);\n\t\t\t\t\t\t\t\t} catch (error) {\n\t\t\t\t\t\t\t\t\t// Log error for this specific editor but continue with others\n\t\t\t\t\t\t\t\t\tthis.logService.warn('Failed to evaluate when clause for editor:', error);\n\t\t\t\t\t\t\t\t\treturn count;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}, 0);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t// Fallback to global context if no editors are open\n\t\t\t\t\t\t\tscore = this.contextKeyService.contextMatchesRules(whenClause) ? 1 : 0;\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tscore = 0;\n\t\t\t\t\t}\n\t\t\t\t} catch (error) {\n\t\t\t\t\t// Log the error but don't fail completely\n\t\t\t\t\tthis.logService.warn('Failed to parse when clause for prompt file suggestion:', condition, error);\n\t\t\t\t\tscore = 0;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (score > 0) {\n\t\t\t\tpromptsWithScores.push({ promptName, condition, score });\n\t\t\t}\n\t\t}\n\n\t\t// Sort by score (descending) and take top 5\n\t\tpromptsWithScores.sort((a, b) => b.score - a.score);\n\t\tconst topPrompts = promptsWithScores.slice(0, 5);\n\n\t\t// Build the final result array\n\t\tfor (const { promptName } of topPrompts) {\n\t\t\tconst description = this.promptDescriptionsCache.get(promptName);\n\t\t\tconst commandLabel = localize('chatWidget.promptFile.commandLabel', \"{0}\", promptName);\n\t\t\tconst uri = this.promptUriCache.get(promptName);\n\t\t\tconst descriptionText = description?.trim() ? description : undefined;\n\t\t\tresult.push({\n\t\t\t\ticon: Codicon.run,\n\t\t\t\tlabel: commandLabel,\n\t\t\t\tdescription: descriptionText,\n\t\t\t\tprompt: `/${promptName} `,\n\t\t\t\turi: uri\n\t\t\t});\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tprivate async loadPromptDescriptions(promptNames: string[]): Promise<void> {\n\t\t// Don't start loading if the widget is being disposed\n\t\tif (this._store.isDisposed) {\n\t\t\treturn;\n\t\t}\n\n\t\t// Set loading guard to prevent infinite loop\n\t\tthis._isLoadingPromptDescriptions = true;\n\t\ttry {\n\t\t\t// Get all available prompt files with their metadata\n\t\t\tconst promptCommands = await this.promptsService.getPromptSlashCommands(CancellationToken.None);\n\n\t\t\tlet cacheUpdated = false;\n\t\t\t// Load descriptions only for the specified prompts\n\t\t\tfor (const promptCommand of promptCommands) {\n\t\t\t\tif (promptNames.includes(promptCommand.name)) {\n\t\t\t\t\tconst description = promptCommand.description;\n\t\t\t\t\tif (description) {\n\t\t\t\t\t\tthis.promptDescriptionsCache.set(promptCommand.name, description);\n\t\t\t\t\t\tcacheUpdated = true;\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// Set empty string to indicate we've checked this prompt\n\t\t\t\t\t\tthis.promptDescriptionsCache.set(promptCommand.name, '');\n\t\t\t\t\t\tcacheUpdated = true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Fire event to trigger a re-render of the welcome view only if cache was updated\n\t\t\tif (cacheUpdated) {\n\t\t\t\tthis._welcomeRenderScheduler.schedule();\n\t\t\t}\n\t\t} catch (error) {\n\t\t\tthis.logService.warn('Failed to load specific prompt descriptions:', error);\n\t\t} finally {\n\t\t\t// Always clear the loading guard, even on error\n\t\t\tthis._isLoadingPromptDescriptions = false;\n\t\t}\n\t}\n\n\tprivate async renderChatEditingSessionState() {\n\t\tif (!this.input) {\n\t\t\treturn;\n\t\t}\n\t\tthis.input.renderChatEditingSessionState(this._editingSession.get() ?? null);\n\n\t\tif (this.bodyDimension) {\n\t\t\tthis.layout(this.bodyDimension.height, this.bodyDimension.width);\n\t\t}\n\t}\n\n\tprivate async renderFollowups(): Promise<void> {\n\t\tif (this.lastItem && isResponseVM(this.lastItem) && this.lastItem.isComplete && this.input.currentModeKind === ChatModeKind.Ask) {\n\t\t\tthis.input.renderFollowups(this.lastItem.replyFollowups, this.lastItem);\n\t\t} else {\n\t\t\tthis.input.renderFollowups(undefined, undefined);\n\t\t}\n\n\t\tif (this.bodyDimension) {\n\t\t\tthis.layout(this.bodyDimension.height, this.bodyDimension.width);\n\t\t}\n\t}\n\n\tprivate renderChatSuggestNextWidget(): void {\n\t\tif (this.lifecycleService.willShutdown) {\n\t\t\treturn;\n\t\t}\n\n\t\t// Skip rendering in coding agent sessions\n\t\tif (this.isLockedToCodingAgent) {\n\t\t\tthis.chatSuggestNextWidget.hide();\n\t\t\treturn;\n\t\t}\n\n\t\tconst items = this.viewModel?.getItems() ?? [];\n\t\tif (!items.length) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst lastItem = items[items.length - 1];\n\t\tconst lastResponseComplete = lastItem && isResponseVM(lastItem) && lastItem.isComplete;\n\t\tif (!lastResponseComplete) {\n\t\t\treturn;\n\t\t}\n\t\t// Get the currently selected mode directly from the observable\n\t\t// Note: We use currentModeObs instead of currentModeKind because currentModeKind returns\n\t\t// the ChatModeKind enum (e.g., 'agent'), which doesn't distinguish between custom modes.\n\t\t// Custom modes all have kind='agent' but different IDs.\n\t\tconst currentMode = this.input.currentModeObs.get();\n\t\tconst handoffs = currentMode?.handOffs?.get();\n\n\t\t// Only show if: mode has handoffs AND chat has content AND not quick chat\n\t\tconst shouldShow = currentMode && handoffs && handoffs.length > 0;\n\n\t\tif (shouldShow) {\n\t\t\t// Log telemetry only when widget transitions from hidden to visible\n\t\t\tconst wasHidden = this.chatSuggestNextWidget.domNode.style.display === 'none';\n\t\t\tthis.chatSuggestNextWidget.render(currentMode);\n\n\t\t\tif (wasHidden) {\n\t\t\t\tthis.telemetryService.publicLog2<ChatHandoffWidgetShownEvent, ChatHandoffWidgetShownClassification>('chat.handoffWidgetShown', {\n\t\t\t\t\tagent: currentMode.id,\n\t\t\t\t\thandoffCount: handoffs.length\n\t\t\t\t});\n\t\t\t}\n\t\t} else {\n\t\t\tthis.chatSuggestNextWidget.hide();\n\t\t}\n\n\t\t// Trigger layout update\n\t\tif (this.bodyDimension) {\n\t\t\tthis.layout(this.bodyDimension.height, this.bodyDimension.width);\n\t\t}\n\t}\n\n\tprivate handleNextPromptSelection(handoff: IHandOff): void {\n\t\t// Hide the widget after selection\n\t\tthis.chatSuggestNextWidget.hide();\n\n\t\t// Log telemetry\n\t\tconst currentMode = this.input.currentModeObs.get();\n\t\tconst fromAgent = currentMode?.id ?? '';\n\t\tthis.telemetryService.publicLog2<ChatHandoffClickEvent, ChatHandoffClickClassification>('chat.handoffClicked', {\n\t\t\tfromAgent: fromAgent,\n\t\t\ttoAgent: handoff.agent || '',\n\t\t\thasPrompt: Boolean(handoff.prompt),\n\t\t\tautoSend: Boolean(handoff.send)\n\t\t});\n\n\t\t// Switch to the specified agent/mode if provided\n\t\tif (handoff.agent) {\n\t\t\tthis._switchToAgentByName(handoff.agent);\n\t\t}\n\t\t// Insert the handoff prompt into the input\n\t\tthis.input.setValue(handoff.prompt, false);\n\t\tthis.input.focus();\n\n\t\t// Auto-submit if send flag is true\n\t\tif (handoff.send) {\n\t\t\tthis.acceptInput();\n\t\t}\n\t}\n\n\tsetVisible(visible: boolean): void {\n\t\tconst wasVisible = this._visible;\n\t\tthis._visible = visible;\n\t\tthis.visibleChangeCount++;\n\t\tthis.renderer.setVisible(visible);\n\t\tthis.input.setVisible(visible);\n\n\t\tif (visible) {\n\t\t\tif (!wasVisible) {\n\t\t\t\tthis.timeoutDisposable.value = disposableTimeout(() => {\n\t\t\t\t\t// Progressive rendering paused while hidden, so start it up again.\n\t\t\t\t\t// Do it after a timeout because the container is not visible yet (it should be but offsetHeight returns 0 here)\n\t\t\t\t\tif (this._visible) {\n\t\t\t\t\t\tthis.onDidChangeItems(true);\n\t\t\t\t\t}\n\t\t\t\t}, 0);\n\n\t\t\t\tdom.scheduleAtNextAnimationFrame(dom.getWindow(this.listContainer), () => {\n\t\t\t\t\tthis._onDidShow.fire();\n\t\t\t\t});\n\t\t\t}\n\t\t} else if (wasVisible) {\n\t\t\tthis._onDidHide.fire();\n\t\t}\n\t}\n\n\tprivate createList(listContainer: HTMLElement, options: IChatListItemRendererOptions): void {\n\t\tconst scopedInstantiationService = this._register(this.instantiationService.createChild(new ServiceCollection([IContextKeyService, this.contextKeyService])));\n\t\tconst delegate = scopedInstantiationService.createInstance(ChatListDelegate, this.viewOptions.defaultElementHeight ?? 200);\n\t\tconst rendererDelegate: IChatRendererDelegate = {\n\t\t\tgetListLength: () => this.tree.getNode(null).visibleChildrenCount,\n\t\t\tonDidScroll: this.onDidScroll,\n\t\t\tcontainer: listContainer,\n\t\t\tcurrentChatMode: () => this.input.currentModeKind,\n\t\t};\n\n\t\t// Create a dom element to hold UI from editor widgets embedded in chat messages\n\t\tconst overflowWidgetsContainer = document.createElement('div');\n\t\toverflowWidgetsContainer.classList.add('chat-overflow-widget-container', 'monaco-editor');\n\t\tlistContainer.append(overflowWidgetsContainer);\n\n\t\tthis.renderer = this._register(scopedInstantiationService.createInstance(\n\t\t\tChatListItemRenderer,\n\t\t\tthis.editorOptions,\n\t\t\toptions,\n\t\t\trendererDelegate,\n\t\t\tthis._codeBlockModelCollection,\n\t\t\toverflowWidgetsContainer,\n\t\t\tthis.viewModel,\n\t\t));\n\n\t\tthis._register(this.renderer.onDidClickRequest(async item => {\n\t\t\tthis.clickedRequest(item);\n\t\t}));\n\n\t\tthis._register(this.renderer.onDidRerender(item => {\n\t\t\tif (isRequestVM(item.currentElement) && this.configurationService.getValue<string>('chat.editRequests') !== 'input') {\n\t\t\t\tif (!item.rowContainer.contains(this.inputContainer)) {\n\t\t\t\t\titem.rowContainer.appendChild(this.inputContainer);\n\t\t\t\t}\n\t\t\t\tthis.input.focus();\n\t\t\t}\n\t\t}));\n\n\t\tthis._register(this.renderer.onDidDispose((item) => {\n\t\t\tthis.focusedInputDOM.appendChild(this.inputContainer);\n\t\t\tthis.input.focus();\n\t\t}));\n\n\t\tthis._register(this.renderer.onDidFocusOutside(() => {\n\t\t\tthis.finishedEditing();\n\t\t}));\n\n\t\tthis._register(this.renderer.onDidClickFollowup(item => {\n\t\t\t// is this used anymore?\n\t\t\tthis.acceptInput(item.message);\n\t\t}));\n\t\tthis._register(this.renderer.onDidClickRerunWithAgentOrCommandDetection(e => {\n\t\t\tconst request = this.chatService.getSession(e.sessionResource)?.getRequests().find(candidate => candidate.id === e.requestId);\n\t\t\tif (request) {\n\t\t\t\tconst options: IChatSendRequestOptions = {\n\t\t\t\t\tnoCommandDetection: true,\n\t\t\t\t\tattempt: request.attempt + 1,\n\t\t\t\t\tlocation: this.location,\n\t\t\t\t\tuserSelectedModelId: this.input.currentLanguageModel,\n\t\t\t\t\tmodeInfo: this.input.currentModeInfo,\n\t\t\t\t};\n\t\t\t\tthis.chatService.resendRequest(request, options).catch(e => this.logService.error('FAILED to rerun request', e));\n\t\t\t}\n\t\t}));\n\n\t\tthis.tree = this._register(scopedInstantiationService.createInstance(\n\t\t\tWorkbenchObjectTree<ChatTreeItem, FuzzyScore>,\n\t\t\t'Chat',\n\t\t\tlistContainer,\n\t\t\tdelegate,\n\t\t\t[this.renderer],\n\t\t\t{\n\t\t\t\tidentityProvider: { getId: (e: ChatTreeItem) => e.id },\n\t\t\t\thorizontalScrolling: false,\n\t\t\t\talwaysConsumeMouseWheel: false,\n\t\t\t\tsupportDynamicHeights: true,\n\t\t\t\thideTwistiesOfChildlessElements: true,\n\t\t\t\taccessibilityProvider: this.instantiationService.createInstance(ChatAccessibilityProvider),\n\t\t\t\tkeyboardNavigationLabelProvider: { getKeyboardNavigationLabel: (e: ChatTreeItem) => isRequestVM(e) ? e.message : isResponseVM(e) ? e.response.value : '' }, // TODO\n\t\t\t\tsetRowLineHeight: false,\n\t\t\t\tfilter: this.viewOptions.filter ? { filter: this.viewOptions.filter.bind(this.viewOptions), } : undefined,\n\t\t\t\tscrollToActiveElement: true,\n\t\t\t\toverrideStyles: {\n\t\t\t\t\tlistFocusBackground: this.styles.listBackground,\n\t\t\t\t\tlistInactiveFocusBackground: this.styles.listBackground,\n\t\t\t\t\tlistActiveSelectionBackground: this.styles.listBackground,\n\t\t\t\t\tlistFocusAndSelectionBackground: this.styles.listBackground,\n\t\t\t\t\tlistInactiveSelectionBackground: this.styles.listBackground,\n\t\t\t\t\tlistHoverBackground: this.styles.listBackground,\n\t\t\t\t\tlistBackground: this.styles.listBackground,\n\t\t\t\t\tlistFocusForeground: this.styles.listForeground,\n\t\t\t\t\tlistHoverForeground: this.styles.listForeground,\n\t\t\t\t\tlistInactiveFocusForeground: this.styles.listForeground,\n\t\t\t\t\tlistInactiveSelectionForeground: this.styles.listForeground,\n\t\t\t\t\tlistActiveSelectionForeground: this.styles.listForeground,\n\t\t\t\t\tlistFocusAndSelectionForeground: this.styles.listForeground,\n\t\t\t\t\tlistActiveSelectionIconForeground: undefined,\n\t\t\t\t\tlistInactiveSelectionIconForeground: undefined,\n\t\t\t\t}\n\t\t\t}));\n\n\t\tthis._register(this.tree.onDidChangeFocus(() => {\n\t\t\tconst focused = this.tree.getFocus();\n\t\t\tif (focused && focused.length > 0) {\n\t\t\t\tconst focusedItem = focused[0];\n\t\t\t\tconst items = this.tree.getNode(null).children;\n\t\t\t\tconst idx = items.findIndex(i => i.element === focusedItem);\n\t\t\t\tif (idx !== -1) {\n\t\t\t\t\tthis._mostRecentlyFocusedItemIndex = idx;\n\t\t\t\t}\n\t\t\t}\n\t\t}));\n\t\tthis._register(this.tree.onContextMenu(e => this.onContextMenu(e)));\n\n\t\tthis._register(this.tree.onDidChangeContentHeight(() => {\n\t\t\tthis.onDidChangeTreeContentHeight();\n\t\t}));\n\t\tthis._register(this.renderer.onDidChangeItemHeight(e => {\n\t\t\tif (this.tree.hasElement(e.element) && this.visible) {\n\t\t\t\tthis.tree.updateElementHeight(e.element, e.height);\n\t\t\t}\n\t\t}));\n\t\tthis._register(this.tree.onDidFocus(() => {\n\t\t\tthis._onDidFocus.fire();\n\t\t}));\n\t\tthis._register(this.tree.onDidScroll(() => {\n\t\t\tthis._onDidScroll.fire();\n\n\t\t\tconst isScrolledDown = this.tree.scrollTop >= this.tree.scrollHeight - this.tree.renderHeight - 2;\n\t\t\tthis.container.classList.toggle('show-scroll-down', !isScrolledDown && !this.scrollLock);\n\t\t}));\n\t}\n\n\tstartEditing(requestId: string): void {\n\t\tconst editedRequest = this.renderer.getTemplateDataForRequestId(requestId);\n\t\tif (editedRequest) {\n\t\t\tthis.clickedRequest(editedRequest);\n\t\t}\n\t}\n\n\tprivate clickedRequest(item: IChatListItemTemplate) {\n\n\t\tconst currentElement = item.currentElement;\n\t\tif (isRequestVM(currentElement) && !this.viewModel?.editing) {\n\n\t\t\tconst requests = this.viewModel?.model.getRequests();\n\t\t\tif (!requests || !this.viewModel?.sessionResource) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// this will only ever be true if we restored a checkpoint\n\t\t\tif (this.viewModel?.model.checkpoint) {\n\t\t\t\tthis.recentlyRestoredCheckpoint = true;\n\t\t\t}\n\n\t\t\tthis.viewModel?.model.setCheckpoint(currentElement.id);\n\n\t\t\t// set contexts and request to false\n\t\t\tconst currentContext: IChatRequestVariableEntry[] = [];\n\t\t\tfor (let i = requests.length - 1; i >= 0; i -= 1) {\n\t\t\t\tconst request = requests[i];\n\t\t\t\tif (request.id === currentElement.id) {\n\t\t\t\t\trequest.shouldBeBlocked = false; // unblocking just this request.\n\t\t\t\t\tif (request.attachedContext) {\n\t\t\t\t\t\tconst context = request.attachedContext.filter(entry => !(isPromptFileVariableEntry(entry) || isPromptTextVariableEntry(entry)) || !entry.automaticallyAdded);\n\t\t\t\t\t\tcurrentContext.push(...context);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// set states\n\t\t\tthis.viewModel?.setEditing(currentElement);\n\t\t\tif (item?.contextKeyService) {\n\t\t\t\tChatContextKeys.currentlyEditing.bindTo(item.contextKeyService).set(true);\n\t\t\t}\n\n\t\t\tconst isInput = this.configurationService.getValue<string>('chat.editRequests') === 'input';\n\t\t\tthis.inputPart?.setEditing(!!this.viewModel?.editing && isInput);\n\n\t\t\tif (!isInput) {\n\t\t\t\tconst rowContainer = item.rowContainer;\n\t\t\t\tthis.inputContainer = dom.$('.chat-edit-input-container');\n\t\t\t\trowContainer.appendChild(this.inputContainer);\n\t\t\t\tthis.createInput(this.inputContainer);\n\t\t\t\tthis.input.setChatMode(this.inputPart.currentModeKind);\n\t\t\t} else {\n\t\t\t\tthis.inputPart.element.classList.add('editing');\n\t\t\t}\n\n\t\t\tthis.inputPart.toggleChatInputOverlay(!isInput);\n\t\t\tif (currentContext.length > 0) {\n\t\t\t\tthis.input.attachmentModel.addContext(...currentContext);\n\t\t\t}\n\n\n\t\t\t// rerenders\n\t\t\tthis.inputPart.dnd.setDisabledOverlay(!isInput);\n\t\t\tthis.input.renderAttachedContext();\n\t\t\tthis.input.setValue(currentElement.messageText, false);\n\t\t\tthis.renderer.updateItemHeightOnRender(currentElement, item);\n\t\t\tthis.onDidChangeItems();\n\t\t\tthis.input.inputEditor.focus();\n\n\t\t\tthis._register(this.inputPart.onDidClickOverlay(() => {\n\t\t\t\tif (this.viewModel?.editing && this.configurationService.getValue<string>('chat.editRequests') !== 'input') {\n\t\t\t\t\tthis.finishedEditing();\n\t\t\t\t}\n\t\t\t}));\n\n\t\t\t// listeners\n\t\t\tif (!isInput) {\n\t\t\t\tthis._register(this.inlineInputPart.inputEditor.onDidChangeModelContent(() => {\n\t\t\t\t\tthis.scrollToCurrentItem(currentElement);\n\t\t\t\t}));\n\n\t\t\t\tthis._register(this.inlineInputPart.inputEditor.onDidChangeCursorSelection((e) => {\n\t\t\t\t\tthis.scrollToCurrentItem(currentElement);\n\t\t\t\t}));\n\t\t\t}\n\t\t}\n\n\t\ttype StartRequestEvent = { editRequestType: string };\n\n\t\ttype StartRequestEventClassification = {\n\t\t\towner: 'justschen';\n\t\t\tcomment: 'Event used to gain insights into when edits are being pressed.';\n\t\t\teditRequestType: { classification: 'SystemMetaData'; purpose: 'FeatureInsight'; comment: 'Current entry point for editing a request.' };\n\t\t};\n\n\t\tthis.telemetryService.publicLog2<StartRequestEvent, StartRequestEventClassification>('chat.startEditingRequests', {\n\t\t\teditRequestType: this.configurationService.getValue<string>('chat.editRequests'),\n\t\t});\n\t}\n\n\tfinishedEditing(completedEdit?: boolean): void {\n\t\t// reset states\n\t\tconst editedRequest = this.renderer.getTemplateDataForRequestId(this.viewModel?.editing?.id);\n\t\tif (this.recentlyRestoredCheckpoint) {\n\t\t\tthis.recentlyRestoredCheckpoint = false;\n\t\t} else {\n\t\t\tthis.viewModel?.model.setCheckpoint(undefined);\n\t\t}\n\t\tthis.inputPart.dnd.setDisabledOverlay(false);\n\t\tif (editedRequest?.contextKeyService) {\n\t\t\tChatContextKeys.currentlyEditing.bindTo(editedRequest.contextKeyService).set(false);\n\t\t}\n\n\t\tconst isInput = this.configurationService.getValue<string>('chat.editRequests') === 'input';\n\n\t\tif (!isInput) {\n\t\t\tthis.inputPart.setChatMode(this.input.currentModeKind);\n\t\t\tconst currentModel = this.input.selectedLanguageModel;\n\t\t\tif (currentModel) {\n\t\t\t\tthis.inputPart.switchModel(currentModel.metadata);\n\t\t\t}\n\n\t\t\tthis.inputPart?.toggleChatInputOverlay(false);\n\t\t\ttry {\n\t\t\t\tif (editedRequest?.rowContainer?.contains(this.inputContainer)) {\n\t\t\t\t\teditedRequest.rowContainer.removeChild(this.inputContainer);\n\t\t\t\t} else if (this.inputContainer.parentElement) {\n\t\t\t\t\tthis.inputContainer.parentElement.removeChild(this.inputContainer);\n\t\t\t\t}\n\t\t\t} catch (e) {\n\t\t\t\tthis.logService.error('Error occurred while finishing editing:', e);\n\t\t\t}\n\t\t\tthis.inputContainer = dom.$('.empty-chat-state');\n\n\t\t\t// only dispose if we know the input is not the bottom input object.\n\t\t\tthis.input.dispose();\n\t\t}\n\n\t\tif (isInput) {\n\t\t\tthis.inputPart.element.classList.remove('editing');\n\t\t}\n\t\tthis.viewModel?.setEditing(undefined);\n\n\t\tthis.inputPart?.setEditing(!!this.viewModel?.editing && isInput);\n\n\t\tthis.onDidChangeItems();\n\t\tif (editedRequest?.currentElement) {\n\t\t\tthis.renderer.updateItemHeightOnRender(editedRequest.currentElement, editedRequest);\n\t\t}\n\n\t\ttype CancelRequestEditEvent = {\n\t\t\teditRequestType: string;\n\t\t\teditCanceled: boolean;\n\t\t};\n\n\t\ttype CancelRequestEventEditClassification = {\n\t\t\towner: 'justschen';\n\t\t\teditRequestType: { classification: 'SystemMetaData'; purpose: 'FeatureInsight'; comment: 'Current entry point for editing a request.' };\n\t\t\teditCanceled: { classification: 'SystemMetaData'; purpose: 'FeatureInsight'; comment: 'Indicates whether the edit was canceled.' };\n\t\t\tcomment: 'Event used to gain insights into when edits are being canceled.';\n\t\t};\n\n\t\tthis.telemetryService.publicLog2<CancelRequestEditEvent, CancelRequestEventEditClassification>('chat.editRequestsFinished', {\n\t\t\teditRequestType: this.configurationService.getValue<string>('chat.editRequests'),\n\t\t\teditCanceled: !completedEdit\n\t\t});\n\n\t\tthis.inputPart.focus();\n\t}\n\n\tprivate scrollToCurrentItem(currentElement: IChatRequestViewModel): void {\n\t\tif (this.viewModel?.editing && currentElement) {\n\t\t\tconst element = currentElement;\n\t\t\tif (!this.tree.hasElement(element)) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst relativeTop = this.tree.getRelativeTop(element);\n\t\t\tif (relativeTop === null || relativeTop < 0 || relativeTop > 1) {\n\t\t\t\tthis.tree.reveal(element, 0);\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate onContextMenu(e: ITreeContextMenuEvent<ChatTreeItem | null>): void {\n\t\te.browserEvent.preventDefault();\n\t\te.browserEvent.stopPropagation();\n\n\t\tconst selected = e.element;\n\n\t\t// Check if the context menu was opened on a KaTeX element\n\t\tconst target = e.browserEvent.target as HTMLElement;\n\t\tconst isKatexElement = target.closest(`.${katexContainerClassName}`) !== null;\n\n\t\tconst scopedContextKeyService = this.contextKeyService.createOverlay([\n\t\t\t[ChatContextKeys.responseIsFiltered.key, isResponseVM(selected) && !!selected.errorDetails?.responseIsFiltered],\n\t\t\t[ChatContextKeys.isKatexMathElement.key, isKatexElement]\n\t\t]);\n\t\tthis.contextMenuService.showContextMenu({\n\t\t\tmenuId: MenuId.ChatContext,\n\t\t\tmenuActionOptions: { shouldForwardArgs: true },\n\t\t\tcontextKeyService: scopedContextKeyService,\n\t\t\tgetAnchor: () => e.anchor,\n\t\t\tgetActionsContext: () => selected,\n\t\t});\n\t}\n\n\tprivate onDidChangeTreeContentHeight(): void {\n\t\t// If the list was previously scrolled all the way down, ensure it stays scrolled down, if scroll lock is on\n\t\tif (this.tree.scrollHeight !== this.previousTreeScrollHeight) {\n\t\t\tconst lastItem = this.viewModel?.getItems().at(-1);\n\t\t\tconst lastResponseIsRendering = isResponseVM(lastItem) && lastItem.renderData;\n\t\t\tif (!lastResponseIsRendering || this.scrollLock) {\n\t\t\t\t// Due to rounding, the scrollTop + renderHeight will not exactly match the scrollHeight.\n\t\t\t\t// Consider the tree to be scrolled all the way down if it is within 2px of the bottom.\n\t\t\t\tconst lastElementWasVisible = this.tree.scrollTop + this.tree.renderHeight >= this.previousTreeScrollHeight - 2;\n\t\t\t\tif (lastElementWasVisible) {\n\t\t\t\t\tdom.scheduleAtNextAnimationFrame(dom.getWindow(this.listContainer), () => {\n\t\t\t\t\t\t// Can't set scrollTop during this event listener, the list might overwrite the change\n\n\t\t\t\t\t\tthis.scrollToEnd();\n\t\t\t\t\t}, 0);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// TODO@roblourens add `show-scroll-down` class when button should show\n\t\t// Show the button when content height changes, the list is not fully scrolled down, and (the latest response is currently rendering OR I haven't yet scrolled all the way down since the last response)\n\t\t// So for example it would not reappear if I scroll up and delete a message\n\n\t\tthis.previousTreeScrollHeight = this.tree.scrollHeight;\n\t\tthis._onDidChangeContentHeight.fire();\n\t}\n\n\tprivate getWidgetViewKindTag(): string {\n\t\tif (!this.viewContext) {\n\t\t\treturn 'editor';\n\t\t} else if (isIChatViewViewContext(this.viewContext)) {\n\t\t\treturn 'view';\n\t\t} else {\n\t\t\treturn 'quick';\n\t\t}\n\t}\n\n\tprivate createInput(container: HTMLElement, options?: { renderFollowups: boolean; renderStyle?: 'compact' | 'minimal'; renderInputToolbarBelowInput?: boolean }): void {\n\t\tconst commonConfig: IChatInputPartOptions = {\n\t\t\trenderFollowups: options?.renderFollowups ?? true,\n\t\t\trenderStyle: options?.renderStyle === 'minimal' ? 'compact' : options?.renderStyle,\n\t\t\trenderInputToolbarBelowInput: options?.renderInputToolbarBelowInput ?? false,\n\t\t\tmenus: {\n\t\t\t\texecuteToolbar: MenuId.ChatExecute,\n\t\t\t\ttelemetrySource: 'chatWidget',\n\t\t\t\t...this.viewOptions.menus\n\t\t\t},\n\t\t\teditorOverflowWidgetsDomNode: this.viewOptions.editorOverflowWidgetsDomNode,\n\t\t\tenableImplicitContext: this.viewOptions.enableImplicitContext,\n\t\t\trenderWorkingSet: this.viewOptions.enableWorkingSet === 'explicit',\n\t\t\tsupportsChangingModes: this.viewOptions.supportsChangingModes,\n\t\t\tdndContainer: this.viewOptions.dndContainer,\n\t\t\twidgetViewKindTag: this.getWidgetViewKindTag(),\n\t\t\tdefaultMode: this.viewOptions.defaultMode\n\t\t};\n\n\t\tif (this.viewModel?.editing) {\n\t\t\tconst editedRequest = this.renderer.getTemplateDataForRequestId(this.viewModel?.editing?.id);\n\t\t\tconst scopedInstantiationService = this._register(this.instantiationService.createChild(new ServiceCollection([IContextKeyService, editedRequest?.contextKeyService])));\n\t\t\tthis.inlineInputPartDisposable.value = scopedInstantiationService.createInstance(ChatInputPart,\n\t\t\t\tthis.location,\n\t\t\t\tcommonConfig,\n\t\t\t\tthis.styles,\n\t\t\t\ttrue\n\t\t\t);\n\t\t} else {\n\t\t\tthis.inputPartDisposable.value = this.instantiationService.createInstance(ChatInputPart,\n\t\t\t\tthis.location,\n\t\t\t\tcommonConfig,\n\t\t\t\tthis.styles,\n\t\t\t\tfalse\n\t\t\t);\n\t\t}\n\n\t\tthis.input.render(container, '', this);\n\n\t\tthis._register(this.input.onDidLoadInputState(() => {\n\t\t\tthis.refreshParsedInput();\n\t\t}));\n\t\tthis._register(this.input.onDidFocus(() => this._onDidFocus.fire()));\n\t\tthis._register(this.input.onDidAcceptFollowup(e => {\n\t\t\tif (!this.viewModel) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tlet msg = '';\n\t\t\tif (e.followup.agentId && e.followup.agentId !== this.chatAgentService.getDefaultAgent(this.location, this.input.currentModeKind)?.id) {\n\t\t\t\tconst agent = this.chatAgentService.getAgent(e.followup.agentId);\n\t\t\t\tif (!agent) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tthis.lastSelectedAgent = agent;\n\t\t\t\tmsg = `${chatAgentLeader}${agent.name} `;\n\t\t\t\tif (e.followup.subCommand) {\n\t\t\t\t\tmsg += `${chatSubcommandLeader}${e.followup.subCommand} `;\n\t\t\t\t}\n\t\t\t} else if (!e.followup.agentId && e.followup.subCommand && this.chatSlashCommandService.hasCommand(e.followup.subCommand)) {\n\t\t\t\tmsg = `${chatSubcommandLeader}${e.followup.subCommand} `;\n\t\t\t}\n\n\t\t\tmsg += e.followup.message;\n\t\t\tthis.acceptInput(msg);\n\n\t\t\tif (!e.response) {\n\t\t\t\t// Followups can be shown by the welcome message, then there is no response associated.\n\t\t\t\t// At some point we probably want telemetry for these too.\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.chatService.notifyUserAction({\n\t\t\t\tsessionResource: this.viewModel.sessionResource,\n\t\t\t\trequestId: e.response.requestId,\n\t\t\t\tagentId: e.response.agent?.id,\n\t\t\t\tcommand: e.response.slashCommand?.name,\n\t\t\t\tresult: e.response.result,\n\t\t\t\taction: {\n\t\t\t\t\tkind: 'followUp',\n\t\t\t\t\tfollowup: e.followup\n\t\t\t\t},\n\t\t\t});\n\t\t}));\n\t\tthis._register(this.input.onDidChangeHeight(() => {\n\t\t\tconst editedRequest = this.renderer.getTemplateDataForRequestId(this.viewModel?.editing?.id);\n\t\t\tif (isRequestVM(editedRequest?.currentElement) && this.viewModel?.editing) {\n\t\t\t\tthis.renderer.updateItemHeightOnRender(editedRequest?.currentElement, editedRequest);\n\t\t\t}\n\n\t\t\tif (this.bodyDimension) {\n\t\t\t\tthis.layout(this.bodyDimension.height, this.bodyDimension.width);\n\t\t\t}\n\n\t\t\tthis._onDidChangeContentHeight.fire();\n\t\t}));\n\t\tthis._register(this.inputEditor.onDidChangeModelContent(() => {\n\t\t\tthis.parsedChatRequest = undefined;\n\t\t\tthis.updateChatInputContext();\n\t\t}));\n\t\tthis._register(this.chatAgentService.onDidChangeAgents(() => {\n\t\t\tthis.parsedChatRequest = undefined;\n\t\t\t// Tools agent loads -> welcome content changes\n\t\t\tthis._welcomeRenderScheduler.schedule();\n\t\t}));\n\t\tthis._register(this.input.onDidChangeCurrentChatMode(() => {\n\t\t\tthis._welcomeRenderScheduler.schedule();\n\t\t\tthis.refreshParsedInput();\n\t\t\tthis.renderFollowups();\n\t\t\tthis.renderChatSuggestNextWidget();\n\t\t}));\n\n\t\tthis._register(autorun(r => {\n\t\t\tconst toolSetIds = new Set<string>();\n\t\t\tconst toolIds = new Set<string>();\n\t\t\tfor (const [entry, enabled] of this.input.selectedToolsModel.entriesMap.read(r)) {\n\t\t\t\tif (enabled) {\n\t\t\t\t\tif (entry instanceof ToolSet) {\n\t\t\t\t\t\ttoolSetIds.add(entry.id);\n\t\t\t\t\t} else {\n\t\t\t\t\t\ttoolIds.add(entry.id);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tconst disabledTools = this.input.attachmentModel.attachments\n\t\t\t\t.filter(a => a.kind === 'tool' && !toolIds.has(a.id) || a.kind === 'toolset' && !toolSetIds.has(a.id))\n\t\t\t\t.map(a => a.id);\n\n\t\t\tthis.input.attachmentModel.updateContext(disabledTools, Iterable.empty());\n\t\t\tthis.refreshParsedInput();\n\t\t}));\n\t}\n\n\tprivate onDidStyleChange(): void {\n\t\tthis.container.style.setProperty('--vscode-interactive-result-editor-background-color', this.editorOptions.configuration.resultEditor.backgroundColor?.toString() ?? '');\n\t\tthis.container.style.setProperty('--vscode-interactive-session-foreground', this.editorOptions.configuration.foreground?.toString() ?? '');\n\t\tthis.container.style.setProperty('--vscode-chat-list-background', this.themeService.getColorTheme().getColor(this.styles.listBackground)?.toString() ?? '');\n\t}\n\n\n\tsetModel(model: IChatModel): void {\n\t\tif (!this.container) {\n\t\t\tthrow new Error('Call render() before setModel()');\n\t\t}\n\n\t\tif (isEqual(model.sessionResource, this.viewModel?.sessionResource)) {\n\t\t\treturn;\n\t\t}\n\t\tthis.inputPart.clearTodoListWidget(model.sessionResource, false);\n\t\tthis.chatSuggestNextWidget.hide();\n\n\t\tif (this.historyList) {\n\t\t\tthis.historyList.setFocus([]);\n\t\t\tthis.historyList.setSelection([]);\n\t\t}\n\n\t\t// Clear history view state when switching sessions to ensure fresh rendering\n\t\tthis.historyViewStore.clear();\n\n\t\tthis._codeBlockModelCollection.clear();\n\n\t\tthis.container.setAttribute('data-session-id', model.sessionId);\n\t\tthis.viewModel = this.instantiationService.createInstance(ChatViewModel, model, this._codeBlockModelCollection);\n\n\t\t// Pass input model reference to input part for state syncing\n\t\tthis.inputPart.setInputModel(model.inputModel);\n\n\t\tif (this._lockedAgent) {\n\t\t\tlet placeholder = this.chatSessionsService.getInputPlaceholderForSessionType(this._lockedAgent.id);\n\t\t\tif (!placeholder) {\n\t\t\t\tplaceholder = localize('chat.input.placeholder.lockedToAgent', \"Chat with {0}\", this._lockedAgent.id);\n\t\t\t}\n\t\t\tthis.viewModel.setInputPlaceholder(placeholder);\n\t\t\tthis.inputEditor.updateOptions({ placeholder });\n\t\t} else if (this.viewModel.inputPlaceholder) {\n\t\t\tthis.inputEditor.updateOptions({ placeholder: this.viewModel.inputPlaceholder });\n\t\t}\n\n\t\tconst renderImmediately = this.configurationService.getValue<boolean>('chat.experimental.renderMarkdownImmediately');\n\t\tconst delay = renderImmediately ? MicrotaskDelay : 0;\n\t\tthis.viewModelDisposables.add(Event.runAndSubscribe(Event.accumulate(this.viewModel.onDidChange, delay), (events => {\n\t\t\tif (!this.viewModel) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.requestInProgress.set(this.viewModel.model.requestInProgress.get());\n\n\t\t\t// Update the editor's placeholder text when it changes in the view model\n\t\t\tif (events?.some(e => e?.kind === 'changePlaceholder')) {\n\t\t\t\tthis.inputEditor.updateOptions({ placeholder: this.viewModel.inputPlaceholder });\n\t\t\t}\n\n\t\t\tthis.onDidChangeItems();\n\t\t\tif (events?.some(e => e?.kind === 'addRequest') && this.visible) {\n\t\t\t\tthis.scrollToEnd();\n\t\t\t}\n\t\t})));\n\t\tthis.viewModelDisposables.add(autorun(reader => {\n\t\t\tthis._editingSession.read(reader); // re-render when the session changes\n\t\t\tthis.renderChatEditingSessionState();\n\t\t}));\n\t\tthis.viewModelDisposables.add(this.viewModel.onDidDisposeModel(() => {\n\t\t\t// Ensure that view state is saved here, because we will load it again when a new model is assigned\n\t\t\tthis.input.saveState();\n\t\t\tif (this.viewModel?.editing) {\n\t\t\t\tthis.finishedEditing();\n\t\t\t}\n\t\t\t// Disposes the viewmodel and listeners\n\t\t\tthis.viewModel = undefined;\n\t\t\tthis.onDidChangeItems();\n\t\t}));\n\t\tconst inputState = model.inputModel.state.get();\n\t\tthis.input.initForNewChatModel(inputState, model.getRequests().length === 0);\n\n\t\tthis.refreshParsedInput();\n\t\tthis.viewModelDisposables.add(model.onDidChange((e) => {\n\t\t\tif (e.kind === 'setAgent') {\n\t\t\t\tthis._onDidChangeAgent.fire({ agent: e.agent, slashCommand: e.command });\n\t\t\t\t// Update capabilities context keys when agent changes\n\t\t\t\tthis._updateAgentCapabilitiesContextKeys(e.agent);\n\t\t\t}\n\t\t\tif (e.kind === 'addRequest') {\n\t\t\t\tthis.inputPart.clearTodoListWidget(this.viewModel?.sessionResource, false);\n\t\t\t}\n\t\t\t// Hide widget on request removal\n\t\t\tif (e.kind === 'removeRequest') {\n\t\t\t\tthis.inputPart.clearTodoListWidget(this.viewModel?.sessionResource, true);\n\t\t\t\tthis.chatSuggestNextWidget.hide();\n\t\t\t}\n\t\t\t// Show next steps widget when response completes (not when request starts)\n\t\t\tif (e.kind === 'completedRequest') {\n\t\t\t\tconst lastRequest = this.viewModel?.model.getRequests().at(-1);\n\t\t\t\tconst wasCancelled = lastRequest?.response?.isCanceled ?? false;\n\t\t\t\tif (wasCancelled) {\n\t\t\t\t\t// Clear todo list when request is cancelled\n\t\t\t\t\tthis.inputPart.clearTodoListWidget(this.viewModel?.sessionResource, true);\n\t\t\t\t}\n\t\t\t\t// Only show if response wasn't canceled\n\t\t\t\tthis.renderChatSuggestNextWidget();\n\t\t\t}\n\t\t}));\n\n\t\tif (this.tree && this.visible) {\n\t\t\tthis.onDidChangeItems();\n\t\t\tthis.scrollToEnd();\n\t\t}\n\n\t\tthis.renderer.updateViewModel(this.viewModel);\n\t\tthis.updateChatInputContext();\n\t\tthis.input.renderChatTodoListWidget(this.viewModel.sessionResource);\n\t}\n\n\tgetFocus(): ChatTreeItem | undefined {\n\t\treturn this.tree.getFocus()[0] ?? undefined;\n\t}\n\n\treveal(item: ChatTreeItem, relativeTop?: number): void {\n\t\tthis.tree.reveal(item, relativeTop);\n\t}\n\n\tfocus(item: ChatTreeItem): void {\n\t\tconst items = this.tree.getNode(null).children;\n\t\tconst node = items.find(i => i.element?.id === item.id);\n\t\tif (!node) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._mostRecentlyFocusedItemIndex = items.indexOf(node);\n\t\tthis.tree.setFocus([node.element]);\n\t\tthis.tree.domFocus();\n\t}\n\n\trefilter() {\n\t\tthis.tree.refilter();\n\t}\n\n\tsetInputPlaceholder(placeholder: string): void {\n\t\tthis.viewModel?.setInputPlaceholder(placeholder);\n\t}\n\n\tresetInputPlaceholder(): void {\n\t\tthis.viewModel?.resetInputPlaceholder();\n\t}\n\n\tsetInput(value = ''): void {\n\t\tthis.input.setValue(value, false);\n\t\tthis.refreshParsedInput();\n\t}\n\n\tgetInput(): string {\n\t\treturn this.input.inputEditor.getValue();\n\t}\n\n\tgetContrib<T extends IChatWidgetContrib>(id: string): T | undefined {\n\t\treturn this.contribs.find(c => c.id === id) as T | undefined;\n\t}\n\n\t// Coding agent locking methods\n\tpublic lockToCodingAgent(name: string, displayName: string, agentId: string): void {\n\t\tthis._lockedAgent = {\n\t\t\tid: agentId,\n\t\t\tname,\n\t\t\tprefix: `@${name} `,\n\t\t\tdisplayName\n\t\t};\n\t\tthis._lockedToCodingAgentContextKey.set(true);\n\t\tthis._welcomeRenderScheduler.schedule();\n\t\t// Update capabilities for the locked agent\n\t\tconst agent = this.chatAgentService.getAgent(agentId);\n\t\tthis._updateAgentCapabilitiesContextKeys(agent);\n\t\tthis.renderer.updateOptions({ restorable: false, editable: false, noFooter: true, progressMessageAtBottomOfResponse: true });\n\t\tthis.tree.rerender();\n\t}\n\n\tpublic unlockFromCodingAgent(): void {\n\t\t// Clear all state related to locking\n\t\tthis._lockedAgent = undefined;\n\t\tthis._lockedToCodingAgentContextKey.set(false);\n\t\tthis._updateAgentCapabilitiesContextKeys(undefined);\n\n\t\t// Explicitly update the DOM to reflect unlocked state\n\t\tthis._welcomeRenderScheduler.schedule();\n\n\t\t// Reset to default placeholder\n\t\tif (this.viewModel) {\n\t\t\tthis.viewModel.resetInputPlaceholder();\n\t\t}\n\t\tthis.inputEditor.updateOptions({ placeholder: undefined });\n\t\tthis.renderer.updateOptions({ restorable: true, editable: true, noFooter: false, progressMessageAtBottomOfResponse: mode => mode !== ChatModeKind.Ask });\n\t\tthis.tree.rerender();\n\t}\n\n\tpublic get isLockedToCodingAgent(): boolean {\n\t\treturn !!this._lockedAgent;\n\t}\n\n\tpublic get lockedAgentId(): string | undefined {\n\t\treturn this._lockedAgent?.id;\n\t}\n\n\tlogInputHistory(): void {\n\t\tthis.input.logInputHistory();\n\t}\n\n\tasync acceptInput(query?: string, options?: IChatAcceptInputOptions): Promise<IChatResponseModel | undefined> {\n\t\treturn this._acceptInput(query ? { query } : undefined, options);\n\t}\n\n\tasync rerunLastRequest(): Promise<void> {\n\t\tif (!this.viewModel) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst sessionResource = this.viewModel.sessionResource;\n\t\tconst lastRequest = this.chatService.getSession(sessionResource)?.getRequests().at(-1);\n\t\tif (!lastRequest) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst options: IChatSendRequestOptions = {\n\t\t\tattempt: lastRequest.attempt + 1,\n\t\t\tlocation: this.location,\n\t\t\tuserSelectedModelId: this.input.currentLanguageModel\n\t\t};\n\t\treturn await this.chatService.resendRequest(lastRequest, options);\n\t}\n\n\tprivate async _applyPromptFileIfSet(requestInput: IChatRequestInputOptions): Promise<void> {\n\t\t// first check if the input has a prompt slash command\n\t\tconst agentSlashPromptPart = this.parsedInput.parts.find((r): r is ChatRequestSlashPromptPart => r instanceof ChatRequestSlashPromptPart);\n\t\tif (!agentSlashPromptPart) {\n\t\t\treturn;\n\t\t}\n\n\t\t// need to resolve the slash command to get the prompt file\n\t\tconst slashCommand = await this.promptsService.resolvePromptSlashCommand(agentSlashPromptPart.name, CancellationToken.None);\n\t\tif (!slashCommand) {\n\t\t\treturn;\n\t\t}\n\t\tconst parseResult = slashCommand.parsedPromptFile;\n\t\t// add the prompt file to the context\n\t\tconst refs = parseResult.body?.variableReferences.map(({ name, offset }) => ({ name, range: new OffsetRange(offset, offset + name.length + 1) })) ?? [];\n\t\tconst toolReferences = this.toolsService.toToolReferences(refs);\n\t\trequestInput.attachedContext.insertFirst(toPromptFileVariableEntry(parseResult.uri, PromptFileVariableKind.PromptFile, undefined, true, toolReferences));\n\n\t\t// remove the slash command from the input\n\t\trequestInput.input = this.parsedInput.parts.filter(part => !(part instanceof ChatRequestSlashPromptPart)).map(part => part.text).join('').trim();\n\n\t\tconst input = requestInput.input.trim();\n\t\trequestInput.input = `Follow instructions in [${basename(parseResult.uri)}](${parseResult.uri.toString()}).`;\n\t\tif (input) {\n\t\t\t// if the input is not empty, append it to the prompt\n\t\t\trequestInput.input += `\\n${input}`;\n\t\t}\n\t\tif (parseResult.header) {\n\t\t\tawait this._applyPromptMetadata(parseResult.header, requestInput);\n\t\t}\n\t}\n\n\tprivate async _acceptInput(query: { query: string } | undefined, options?: IChatAcceptInputOptions): Promise<IChatResponseModel | undefined> {\n\t\tif (this.viewModel?.model.requestInProgress.get()) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!query && this.input.generating) {\n\t\t\t// if the user submits the input and generation finishes quickly, just submit it for them\n\t\t\tconst generatingAutoSubmitWindow = 500;\n\t\t\tconst start = Date.now();\n\t\t\tawait this.input.generating;\n\t\t\tif (Date.now() - start > generatingAutoSubmitWindow) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\twhile (!this._viewModel && !this._store.isDisposed) {\n\t\t\tawait Event.toPromise(this.onDidChangeViewModel, this._store);\n\t\t}\n\n\t\tif (!this.viewModel) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._onDidAcceptInput.fire();\n\t\tthis.scrollLock = this.isLockedToCodingAgent || !!checkModeOption(this.input.currentModeKind, this.viewOptions.autoScroll);\n\n\t\tconst editorValue = this.getInput();\n\t\tconst requestId = this.chatAccessibilityService.acceptRequest();\n\t\tconst requestInputs: IChatRequestInputOptions = {\n\t\t\tinput: !query ? editorValue : query.query,\n\t\t\tattachedContext: options?.enableImplicitContext === false ? this.input.getAttachedContext(this.viewModel.sessionResource) : this.input.getAttachedAndImplicitContext(this.viewModel.sessionResource),\n\t\t};\n\n\t\tconst isUserQuery = !query;\n\n\t\tif (this.viewModel?.editing) {\n\t\t\tthis.finishedEditing(true);\n\t\t\tthis.viewModel.model?.setCheckpoint(undefined);\n\t\t}\n\n\t\t// process the prompt command\n\t\tawait this._applyPromptFileIfSet(requestInputs);\n\t\tawait this._autoAttachInstructions(requestInputs);\n\n\t\tif (this.viewOptions.enableWorkingSet !== undefined && this.input.currentModeKind === ChatModeKind.Edit && !this.chatService.edits2Enabled) {\n\t\t\tconst uniqueWorkingSetEntries = new ResourceSet(); // NOTE: this is used for bookkeeping so the UI can avoid rendering references in the UI that are already shown in the working set\n\t\t\tconst editingSessionAttachedContext: ChatRequestVariableSet = requestInputs.attachedContext;\n\n\t\t\t// Collect file variables from previous requests before sending the request\n\t\t\tconst previousRequests = this.viewModel.model.getRequests();\n\t\t\tfor (const request of previousRequests) {\n\t\t\t\tfor (const variable of request.variableData.variables) {\n\t\t\t\t\tif (URI.isUri(variable.value) && variable.kind === 'file') {\n\t\t\t\t\t\tconst uri = variable.value;\n\t\t\t\t\t\tif (!uniqueWorkingSetEntries.has(uri)) {\n\t\t\t\t\t\t\teditingSessionAttachedContext.add(variable);\n\t\t\t\t\t\t\tuniqueWorkingSetEntries.add(variable.value);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\trequestInputs.attachedContext = editingSessionAttachedContext;\n\n\t\t\ttype ChatEditingWorkingSetClassification = {\n\t\t\t\towner: 'joyceerhl';\n\t\t\t\tcomment: 'Information about the working set size in a chat editing request';\n\t\t\t\toriginalSize: { classification: 'SystemMetaData'; purpose: 'FeatureInsight'; comment: 'The number of files that the user tried to attach in their editing request.' };\n\t\t\t\tactualSize: { classification: 'SystemMetaData'; purpose: 'FeatureInsight'; comment: 'The number of files that were actually sent in their editing request.' };\n\t\t\t};\n\t\t\ttype ChatEditingWorkingSetEvent = {\n\t\t\t\toriginalSize: number;\n\t\t\t\tactualSize: number;\n\t\t\t};\n\t\t\tthis.telemetryService.publicLog2<ChatEditingWorkingSetEvent, ChatEditingWorkingSetClassification>('chatEditing/workingSetSize', { originalSize: uniqueWorkingSetEntries.size, actualSize: uniqueWorkingSetEntries.size });\n\t\t}\n\n\t\tthis.chatService.cancelCurrentRequestForSession(this.viewModel.sessionResource);\n\t\tif (this.currentRequest) {\n\t\t\t// We have to wait the current request to be properly cancelled so that it has a chance to update the model with its result metadata.\n\t\t\t// This is awkward, it's basically a limitation of the chat provider-based agent.\n\t\t\tawait Promise.race([this.currentRequest, timeout(1000)]);\n\t\t}\n\n\t\tthis.input.validateAgentMode();\n\n\t\tif (this.viewModel.model.checkpoint) {\n\t\t\tconst requests = this.viewModel.model.getRequests();\n\t\t\tfor (let i = requests.length - 1; i >= 0; i -= 1) {\n\t\t\t\tconst request = requests[i];\n\t\t\t\tif (request.shouldBeBlocked) {\n\t\t\t\t\tthis.chatService.removeRequest(this.viewModel.sessionResource, request.id);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tconst result = await this.chatService.sendRequest(this.viewModel.sessionResource, requestInputs.input, {\n\t\t\tuserSelectedModelId: this.input.currentLanguageModel,\n\t\t\tlocation: this.location,\n\t\t\tlocationData: this._location.resolveData?.(),\n\t\t\tparserContext: { selectedAgent: this._lastSelectedAgent, mode: this.input.currentModeKind },\n\t\t\tattachedContext: requestInputs.attachedContext.asArray(),\n\t\t\tnoCommandDetection: options?.noCommandDetection,\n\t\t\t...this.getModeRequestOptions(),\n\t\t\tmodeInfo: this.input.currentModeInfo,\n\t\t\tagentIdSilent: this._lockedAgent?.id,\n\t\t});\n\n\t\tif (!result) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.input.acceptInput(isUserQuery);\n\t\tthis._onDidSubmitAgent.fire({ agent: result.agent, slashCommand: result.slashCommand });\n\t\tthis.currentRequest = result.responseCompletePromise.then(() => {\n\t\t\tconst responses = this.viewModel?.getItems().filter(isResponseVM);\n\t\t\tconst lastResponse = responses?.[responses.length - 1];\n\t\t\tthis.chatAccessibilityService.acceptResponse(this, this.container, lastResponse, requestId, options?.isVoiceInput);\n\t\t\tif (lastResponse?.result?.nextQuestion) {\n\t\t\t\tconst { prompt, participant, command } = lastResponse.result.nextQuestion;\n\t\t\t\tconst question = formatChatQuestion(this.chatAgentService, this.location, prompt, participant, command);\n\t\t\t\tif (question) {\n\t\t\t\t\tthis.input.setValue(question, false);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis.currentRequest = undefined;\n\t\t});\n\n\t\treturn result.responseCreatedPromise;\n\t}\n\n\tgetModeRequestOptions(): Partial<IChatSendRequestOptions> {\n\t\treturn {\n\t\t\tmodeInfo: this.input.currentModeInfo,\n\t\t\tuserSelectedTools: this.input.selectedToolsModel.userSelectedTools,\n\t\t};\n\t}\n\n\tgetCodeBlockInfosForResponse(response: IChatResponseViewModel): IChatCodeBlockInfo[] {\n\t\treturn this.renderer.getCodeBlockInfosForResponse(response);\n\t}\n\n\tgetCodeBlockInfoForEditor(uri: URI): IChatCodeBlockInfo | undefined {\n\t\treturn this.renderer.getCodeBlockInfoForEditor(uri);\n\t}\n\n\tgetFileTreeInfosForResponse(response: IChatResponseViewModel): IChatFileTreeInfo[] {\n\t\treturn this.renderer.getFileTreeInfosForResponse(response);\n\t}\n\n\tgetLastFocusedFileTreeForResponse(response: IChatResponseViewModel): IChatFileTreeInfo | undefined {\n\t\treturn this.renderer.getLastFocusedFileTreeForResponse(response);\n\t}\n\n\tfocusResponseItem(lastFocused?: boolean): void {\n\t\tif (!this.viewModel) {\n\t\t\treturn;\n\t\t}\n\t\tconst items = this.tree.getNode(null).children;\n\t\tlet item;\n\t\tif (lastFocused) {\n\t\t\titem = items[this._mostRecentlyFocusedItemIndex] ?? items[items.length - 1];\n\t\t} else {\n\t\t\titem = items[items.length - 1];\n\t\t}\n\t\tif (!item) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.tree.setFocus([item.element]);\n\t\tthis.tree.domFocus();\n\t}\n\n\tlayout(height: number, width: number): void {\n\t\twidth = Math.min(width, this.viewOptions.renderStyle === 'minimal' ? width : 950); // no min width of inline chat\n\t\tconst heightUpdated = this.bodyDimension && this.bodyDimension.height !== height;\n\t\tthis.bodyDimension = new dom.Dimension(width, height);\n\n\t\tconst layoutHeight = this._dynamicMessageLayoutData?.enabled ? this._dynamicMessageLayoutData.maxHeight : height;\n\t\tif (this.viewModel?.editing) {\n\t\t\tthis.inlineInputPart?.layout(layoutHeight, width);\n\t\t}\n\n\t\tthis.inputPart.layout(layoutHeight, width);\n\n\t\tconst inputHeight = this.inputPart.inputPartHeight;\n\t\tconst chatSuggestNextWidgetHeight = this.chatSuggestNextWidget.height;\n\t\tconst lastElementVisible = this.tree.scrollTop + this.tree.renderHeight >= this.tree.scrollHeight - 2;\n\t\tconst lastItem = this.viewModel?.getItems().at(-1);\n\n\t\tconst contentHeight = Math.max(0, height - inputHeight - chatSuggestNextWidgetHeight);\n\t\tif (this.viewOptions.renderStyle === 'compact' || this.viewOptions.renderStyle === 'minimal') {\n\t\t\tthis.listContainer.style.removeProperty('--chat-current-response-min-height');\n\t\t} else {\n\t\t\tthis.listContainer.style.setProperty('--chat-current-response-min-height', contentHeight * .75 + 'px');\n\t\t\tif (heightUpdated && lastItem && this.visible) {\n\t\t\t\tthis.tree.updateElementHeight(lastItem, undefined);\n\t\t\t}\n\t\t}\n\t\tthis.tree.layout(contentHeight, width);\n\n\t\t// Push the welcome message down so it doesn't change position\n\t\t// when followups, attachments, working set, todo list, or suggest next widget appear\n\t\tlet welcomeOffset = 100;\n\t\tif (this.viewOptions.renderFollowups) {\n\t\t\twelcomeOffset = Math.max(welcomeOffset - this.input.followupsHeight, 0);\n\t\t}\n\t\tif (this.viewOptions.enableWorkingSet) {\n\t\t\twelcomeOffset = Math.max(welcomeOffset - this.input.editSessionWidgetHeight, 0);\n\t\t}\n\t\twelcomeOffset = Math.max(welcomeOffset - this.input.todoListWidgetHeight, 0);\n\t\twelcomeOffset = Math.max(welcomeOffset - this.input.attachmentsHeight, 0);\n\t\tthis.welcomeMessageContainer.style.height = `${contentHeight - welcomeOffset}px`;\n\t\tthis.welcomeMessageContainer.style.paddingBottom = `${welcomeOffset}px`;\n\n\t\tthis.renderer.layout(width);\n\n\t\tconst lastResponseIsRendering = isResponseVM(lastItem) && lastItem.renderData;\n\t\tif (lastElementVisible && (!lastResponseIsRendering || checkModeOption(this.input.currentModeKind, this.viewOptions.autoScroll))) {\n\t\t\tthis.scrollToEnd();\n\t\t}\n\t\tthis.listContainer.style.height = `${contentHeight}px`;\n\n\t\tthis._onDidChangeHeight.fire(height);\n\t}\n\n\tprivate _dynamicMessageLayoutData?: { numOfMessages: number; maxHeight: number; enabled: boolean };\n\n\t// An alternative to layout, this allows you to specify the number of ChatTreeItems\n\t// you want to show, and the max height of the container. It will then layout the\n\t// tree to show that many items.\n\t// TODO@TylerLeonhardt: This could use some refactoring to make it clear which layout strategy is being used\n\tsetDynamicChatTreeItemLayout(numOfChatTreeItems: number, maxHeight: number) {\n\t\tthis._dynamicMessageLayoutData = { numOfMessages: numOfChatTreeItems, maxHeight, enabled: true };\n\t\tthis._register(this.renderer.onDidChangeItemHeight(() => this.layoutDynamicChatTreeItemMode()));\n\n\t\tconst mutableDisposable = this._register(new MutableDisposable());\n\t\tthis._register(this.tree.onDidScroll((e) => {\n\t\t\t// TODO@TylerLeonhardt this should probably just be disposed when this is disabled\n\t\t\t// and then set up again when it is enabled again\n\t\t\tif (!this._dynamicMessageLayoutData?.enabled) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tmutableDisposable.value = dom.scheduleAtNextAnimationFrame(dom.getWindow(this.listContainer), () => {\n\t\t\t\tif (!e.scrollTopChanged || e.heightChanged || e.scrollHeightChanged) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tconst renderHeight = e.height;\n\t\t\t\tconst diff = e.scrollHeight - renderHeight - e.scrollTop;\n\t\t\t\tif (diff === 0) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst possibleMaxHeight = (this._dynamicMessageLayoutData?.maxHeight ?? maxHeight);\n\t\t\t\tconst width = this.bodyDimension?.width ?? this.container.offsetWidth;\n\t\t\t\tthis.input.layout(possibleMaxHeight, width);\n\t\t\t\tconst inputPartHeight = this.input.inputPartHeight;\n\t\t\t\tconst chatSuggestNextWidgetHeight = this.chatSuggestNextWidget.height;\n\t\t\t\tconst newHeight = Math.min(renderHeight + diff, possibleMaxHeight - inputPartHeight - chatSuggestNextWidgetHeight);\n\t\t\t\tthis.layout(newHeight + inputPartHeight + chatSuggestNextWidgetHeight, width);\n\t\t\t});\n\t\t}));\n\t}\n\n\tupdateDynamicChatTreeItemLayout(numOfChatTreeItems: number, maxHeight: number) {\n\t\tthis._dynamicMessageLayoutData = { numOfMessages: numOfChatTreeItems, maxHeight, enabled: true };\n\t\tlet hasChanged = false;\n\t\tlet height = this.bodyDimension!.height;\n\t\tlet width = this.bodyDimension!.width;\n\t\tif (maxHeight < this.bodyDimension!.height) {\n\t\t\theight = maxHeight;\n\t\t\thasChanged = true;\n\t\t}\n\t\tconst containerWidth = this.container.offsetWidth;\n\t\tif (this.bodyDimension?.width !== containerWidth) {\n\t\t\twidth = containerWidth;\n\t\t\thasChanged = true;\n\t\t}\n\t\tif (hasChanged) {\n\t\t\tthis.layout(height, width);\n\t\t}\n\t}\n\n\tget isDynamicChatTreeItemLayoutEnabled(): boolean {\n\t\treturn this._dynamicMessageLayoutData?.enabled ?? false;\n\t}\n\n\tset isDynamicChatTreeItemLayoutEnabled(value: boolean) {\n\t\tif (!this._dynamicMessageLayoutData) {\n\t\t\treturn;\n\t\t}\n\t\tthis._dynamicMessageLayoutData.enabled = value;\n\t}\n\n\tlayoutDynamicChatTreeItemMode(): void {\n\t\tif (!this.viewModel || !this._dynamicMessageLayoutData?.enabled) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst width = this.bodyDimension?.width ?? this.container.offsetWidth;\n\t\tthis.input.layout(this._dynamicMessageLayoutData.maxHeight, width);\n\t\tconst inputHeight = this.input.inputPartHeight;\n\t\tconst chatSuggestNextWidgetHeight = this.chatSuggestNextWidget.height;\n\n\t\tconst totalMessages = this.viewModel.getItems();\n\t\t// grab the last N messages\n\t\tconst messages = totalMessages.slice(-this._dynamicMessageLayoutData.numOfMessages);\n\n\t\tconst needsRerender = messages.some(m => m.currentRenderedHeight === undefined);\n\t\tconst listHeight = needsRerender\n\t\t\t? this._dynamicMessageLayoutData.maxHeight\n\t\t\t: messages.reduce((acc, message) => acc + message.currentRenderedHeight!, 0);\n\n\t\tthis.layout(\n\t\t\tMath.min(\n\t\t\t\t// we add an additional 18px in order to show that there is scrollable content\n\t\t\t\tinputHeight + chatSuggestNextWidgetHeight + listHeight + (totalMessages.length > 2 ? 18 : 0),\n\t\t\t\tthis._dynamicMessageLayoutData.maxHeight\n\t\t\t),\n\t\t\twidth\n\t\t);\n\n\t\tif (needsRerender || !listHeight) {\n\t\t\tthis.scrollToEnd();\n\t\t}\n\t}\n\n\tsaveState(): void {\n\t\tthis.input.saveState();\n\t}\n\n\tgetViewState(): IChatModelInputState | undefined {\n\t\treturn this.input.getCurrentInputState();\n\t}\n\n\tprivate updateChatInputContext() {\n\t\tconst currentAgent = this.parsedInput.parts.find(part => part instanceof ChatRequestAgentPart);\n\t\tthis.agentInInput.set(!!currentAgent);\n\t}\n\n\tprivate async _switchToAgentByName(agentName: string): Promise<void> {\n\t\tconst currentAgent = this.input.currentModeObs.get();\n\n\t\t// switch to appropriate agent if needed\n\t\tif (agentName !== currentAgent.name.get()) {\n\t\t\t// Find the mode object to get its kind\n\t\t\tconst agent = this.chatModeService.findModeByName(agentName);\n\t\t\tif (agent) {\n\t\t\t\tif (currentAgent.kind !== agent.kind) {\n\t\t\t\t\tconst chatModeCheck = await this.instantiationService.invokeFunction(handleModeSwitch, currentAgent.kind, agent.kind, this.viewModel?.model.getRequests().length ?? 0, this.viewModel?.model.editingSession);\n\t\t\t\t\tif (!chatModeCheck) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (chatModeCheck.needToClearSession) {\n\t\t\t\t\t\tawait this.clear();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tthis.input.setChatMode(agent.id);\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate async _applyPromptMetadata({ agent, tools, model }: PromptHeader, requestInput: IChatRequestInputOptions): Promise<void> {\n\n\t\tif (tools !== undefined && !agent && this.input.currentModeKind !== ChatModeKind.Agent) {\n\t\t\tagent = ChatMode.Agent.name.get();\n\t\t}\n\t\t// switch to appropriate agent if needed\n\t\tif (agent) {\n\t\t\tthis._switchToAgentByName(agent);\n\t\t}\n\n\t\t// if not tools to enable are present, we are done\n\t\tif (tools !== undefined && this.input.currentModeKind === ChatModeKind.Agent) {\n\t\t\tconst enablementMap = this.toolsService.toToolAndToolSetEnablementMap(tools, Target.VSCode);\n\t\t\tthis.input.selectedToolsModel.set(enablementMap, true);\n\t\t}\n\n\t\tif (model !== undefined) {\n\t\t\tthis.input.switchModelByQualifiedName(model);\n\t\t}\n\t}\n\n\t/**\n\t * Adds additional instructions to the context\n\t * - instructions that have a 'applyTo' pattern that matches the current input\n\t * - instructions referenced in the copilot settings 'copilot-instructions'\n\t * - instructions referenced in an already included instruction file\n\t */\n\tprivate async _autoAttachInstructions({ attachedContext }: IChatRequestInputOptions): Promise<void> {\n\t\tthis.logService.debug(`ChatWidget#_autoAttachInstructions: prompt files are always enabled`);\n\n\t\tconst computer = this.instantiationService.createInstance(ComputeAutomaticInstructions, this._getReadTool());\n\t\tawait computer.collect(attachedContext, CancellationToken.None);\n\t}\n\n\tprivate _getReadTool(): IToolData | undefined {\n\t\tif (this.input.currentModeKind !== ChatModeKind.Agent) {\n\t\t\treturn undefined;\n\t\t}\n\t\tconst readFileTool = this.toolsService.getToolByName('readFile');\n\t\tif (!readFileTool || !this.input.selectedToolsModel.userSelectedTools.get()[readFileTool.id]) {\n\t\t\treturn undefined;\n\t\t}\n\t\treturn readFileTool;\n\t}\n\n\tdelegateScrollFromMouseWheelEvent(browserEvent: IMouseWheelEvent): void {\n\t\tthis.tree.delegateScrollFromMouseWheelEvent(browserEvent);\n\t}\n}\n"]}