{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/contrib/chat/browser/chatSessions/common.ts","vs/workbench/contrib/chat/browser/chatSessions/common.ts"],"names":[],"mappings":"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","file":"common.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { fromNow } from '../../../../../base/common/date.js';\nimport { Schemas } from '../../../../../base/common/network.js';\nimport { isEqual } from '../../../../../base/common/resources.js';\nimport { URI } from '../../../../../base/common/uri.js';\nimport { EditorInput } from '../../../../common/editor/editorInput.js';\nimport { IEditorGroup, IEditorGroupsService } from '../../../../services/editor/common/editorGroupsService.js';\nimport { ChatContextKeys } from '../../common/chatContextKeys.js';\nimport { IChatService } from '../../common/chatService.js';\nimport { IChatSessionItem, IChatSessionItemProvider, localChatSessionType } from '../../common/chatSessionsService.js';\nimport { IChatWidgetService } from '../chat.js';\nimport { ChatEditorInput } from '../chatEditorInput.js';\n\n\nexport const NEW_CHAT_SESSION_ACTION_ID = 'workbench.action.chat.openNewSessionEditor';\n\nexport type ChatSessionItemWithProvider = IChatSessionItem & {\n\treadonly provider: IChatSessionItemProvider;\n\trelativeTime?: string;\n\trelativeTimeFullWord?: string;\n\thideRelativeTime?: boolean;\n};\n\nexport function isChatSession(schemes: readonly string[], editor?: EditorInput): boolean {\n\tif (!(editor instanceof ChatEditorInput)) {\n\t\treturn false;\n\t}\n\n\tif (!schemes.includes(editor.resource?.scheme) && editor.resource?.scheme !== Schemas.vscodeLocalChatSession && editor.resource?.scheme !== Schemas.vscodeChatEditor) {\n\t\treturn false;\n\t}\n\n\tif (editor.options.ignoreInView) {\n\t\treturn false;\n\t}\n\n\treturn true;\n}\n\n/**\n * Find existing chat editors that have the same session URI (for external providers)\n */\nexport function findExistingChatEditorByUri(sessionUri: URI, editorGroupsService: IEditorGroupsService): { editor: ChatEditorInput; group: IEditorGroup } | undefined {\n\tfor (const group of editorGroupsService.groups) {\n\t\tfor (const editor of group.editors) {\n\t\t\tif (editor instanceof ChatEditorInput && isEqual(editor.sessionResource, sessionUri)) {\n\t\t\t\treturn { editor, group };\n\t\t\t}\n\t\t}\n\t}\n\treturn undefined;\n}\n\n// Helper function to update relative time for chat sessions (similar to timeline)\nfunction updateRelativeTime(item: ChatSessionItemWithProvider, lastRelativeTime: string | undefined): string | undefined {\n\tif (item.timing?.startTime) {\n\t\titem.relativeTime = fromNow(item.timing.startTime);\n\t\titem.relativeTimeFullWord = fromNow(item.timing.startTime, false, true);\n\t\tif (lastRelativeTime === undefined || item.relativeTime !== lastRelativeTime) {\n\t\t\tlastRelativeTime = item.relativeTime;\n\t\t\titem.hideRelativeTime = false;\n\t\t} else {\n\t\t\titem.hideRelativeTime = true;\n\t\t}\n\t} else {\n\t\t// Clear timestamp properties if no timestamp\n\t\titem.relativeTime = undefined;\n\t\titem.relativeTimeFullWord = undefined;\n\t\titem.hideRelativeTime = false;\n\t}\n\n\treturn lastRelativeTime;\n}\n\n// Helper function to extract timestamp from session item\nexport function extractTimestamp(item: IChatSessionItem): number | undefined {\n\t// Use timing.startTime if available from the API\n\tif (item.timing?.startTime) {\n\t\treturn item.timing.startTime;\n\t}\n\n\t// For other items, timestamp might already be set\n\tif ('timestamp' in item) {\n\t\t// eslint-disable-next-line local/code-no-any-casts\n\t\treturn (item as any).timestamp;\n\t}\n\n\treturn undefined;\n}\n\n// Helper function to sort sessions by timestamp (newest first)\nfunction sortSessionsByTimestamp(sessions: ChatSessionItemWithProvider[]): void {\n\tsessions.sort((a, b) => {\n\t\tconst aTime = a.timing?.startTime ?? 0;\n\t\tconst bTime = b.timing?.startTime ?? 0;\n\t\treturn bTime - aTime; // newest first\n\t});\n}\n\n// Helper function to apply time grouping to a list of sessions\nfunction applyTimeGrouping(sessions: ChatSessionItemWithProvider[]): void {\n\tlet lastRelativeTime: string | undefined;\n\tsessions.forEach(session => {\n\t\tlastRelativeTime = updateRelativeTime(session, lastRelativeTime);\n\t});\n}\n\n// Helper function to process session items with timestamps, sorting, and grouping\nexport function processSessionsWithTimeGrouping(sessions: ChatSessionItemWithProvider[]): ChatSessionItemWithProvider[] {\n\tconst sessionsTemp = [...sessions];\n\t// Only process if we have sessions with timestamps\n\tif (sessions.some(session => session.timing?.startTime !== undefined)) {\n\t\tsortSessionsByTimestamp(sessionsTemp);\n\t\tapplyTimeGrouping(sessionsTemp);\n\t}\n\treturn sessionsTemp;\n}\n\n// Helper function to create context overlay for session items\nexport function getSessionItemContextOverlay(\n\tsession: IChatSessionItem,\n\tprovider?: IChatSessionItemProvider,\n\tchatWidgetService?: IChatWidgetService,\n\tchatService?: IChatService,\n\teditorGroupsService?: IEditorGroupsService\n): [string, any][] {\n\tconst overlay: [string, any][] = [];\n\tif (provider) {\n\t\toverlay.push([ChatContextKeys.sessionType.key, provider.chatSessionType]);\n\t}\n\n\t// Mark history items\n\toverlay.push([ChatContextKeys.isArchivedItem.key, session.archived]);\n\n\t// Mark active sessions - check if session is currently open in editor or widget\n\tlet isActiveSession = false;\n\n\tif (!session.archived && provider?.chatSessionType === localChatSessionType) {\n\t\t// Local non-history sessions are always active\n\t\tisActiveSession = true;\n\t} else if (session.archived && chatWidgetService && chatService && editorGroupsService) {\n\t\t// Check if session is open in a chat widget\n\t\tconst widget = chatWidgetService.getWidgetBySessionResource(session.resource);\n\t\tif (widget) {\n\t\t\tisActiveSession = true;\n\t\t} else {\n\t\t\t// Check if session is open in any editor\n\t\t\tisActiveSession = !!findExistingChatEditorByUri(session.resource, editorGroupsService);\n\t\t}\n\t}\n\n\toverlay.push([ChatContextKeys.isActiveSession.key, isActiveSession]);\n\n\treturn overlay;\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { fromNow } from '../../../../../base/common/date.js';\nimport { Schemas } from '../../../../../base/common/network.js';\nimport { isEqual } from '../../../../../base/common/resources.js';\nimport { URI } from '../../../../../base/common/uri.js';\nimport { EditorInput } from '../../../../common/editor/editorInput.js';\nimport { IEditorGroup, IEditorGroupsService } from '../../../../services/editor/common/editorGroupsService.js';\nimport { ChatContextKeys } from '../../common/chatContextKeys.js';\nimport { IChatService } from '../../common/chatService.js';\nimport { IChatSessionItem, IChatSessionItemProvider, localChatSessionType } from '../../common/chatSessionsService.js';\nimport { IChatWidgetService } from '../chat.js';\nimport { ChatEditorInput } from '../chatEditorInput.js';\n\n\nexport const NEW_CHAT_SESSION_ACTION_ID = 'workbench.action.chat.openNewSessionEditor';\n\nexport type ChatSessionItemWithProvider = IChatSessionItem & {\n\treadonly provider: IChatSessionItemProvider;\n\trelativeTime?: string;\n\trelativeTimeFullWord?: string;\n\thideRelativeTime?: boolean;\n};\n\nexport function isChatSession(schemes: readonly string[], editor?: EditorInput): boolean {\n\tif (!(editor instanceof ChatEditorInput)) {\n\t\treturn false;\n\t}\n\n\tif (!schemes.includes(editor.resource?.scheme) && editor.resource?.scheme !== Schemas.vscodeLocalChatSession && editor.resource?.scheme !== Schemas.vscodeChatEditor) {\n\t\treturn false;\n\t}\n\n\tif (editor.options.ignoreInView) {\n\t\treturn false;\n\t}\n\n\treturn true;\n}\n\n/**\n * Find existing chat editors that have the same session URI (for external providers)\n */\nexport function findExistingChatEditorByUri(sessionUri: URI, editorGroupsService: IEditorGroupsService): { editor: ChatEditorInput; group: IEditorGroup } | undefined {\n\tfor (const group of editorGroupsService.groups) {\n\t\tfor (const editor of group.editors) {\n\t\t\tif (editor instanceof ChatEditorInput && isEqual(editor.sessionResource, sessionUri)) {\n\t\t\t\treturn { editor, group };\n\t\t\t}\n\t\t}\n\t}\n\treturn undefined;\n}\n\n// Helper function to update relative time for chat sessions (similar to timeline)\nfunction updateRelativeTime(item: ChatSessionItemWithProvider, lastRelativeTime: string | undefined): string | undefined {\n\tif (item.timing?.startTime) {\n\t\titem.relativeTime = fromNow(item.timing.startTime);\n\t\titem.relativeTimeFullWord = fromNow(item.timing.startTime, false, true);\n\t\tif (lastRelativeTime === undefined || item.relativeTime !== lastRelativeTime) {\n\t\t\tlastRelativeTime = item.relativeTime;\n\t\t\titem.hideRelativeTime = false;\n\t\t} else {\n\t\t\titem.hideRelativeTime = true;\n\t\t}\n\t} else {\n\t\t// Clear timestamp properties if no timestamp\n\t\titem.relativeTime = undefined;\n\t\titem.relativeTimeFullWord = undefined;\n\t\titem.hideRelativeTime = false;\n\t}\n\n\treturn lastRelativeTime;\n}\n\n// Helper function to extract timestamp from session item\nexport function extractTimestamp(item: IChatSessionItem): number | undefined {\n\t// Use timing.startTime if available from the API\n\tif (item.timing?.startTime) {\n\t\treturn item.timing.startTime;\n\t}\n\n\t// For other items, timestamp might already be set\n\tif ('timestamp' in item) {\n\t\t// eslint-disable-next-line local/code-no-any-casts\n\t\treturn (item as any).timestamp;\n\t}\n\n\treturn undefined;\n}\n\n// Helper function to sort sessions by timestamp (newest first)\nfunction sortSessionsByTimestamp(sessions: ChatSessionItemWithProvider[]): void {\n\tsessions.sort((a, b) => {\n\t\tconst aTime = a.timing?.startTime ?? 0;\n\t\tconst bTime = b.timing?.startTime ?? 0;\n\t\treturn bTime - aTime; // newest first\n\t});\n}\n\n// Helper function to apply time grouping to a list of sessions\nfunction applyTimeGrouping(sessions: ChatSessionItemWithProvider[]): void {\n\tlet lastRelativeTime: string | undefined;\n\tsessions.forEach(session => {\n\t\tlastRelativeTime = updateRelativeTime(session, lastRelativeTime);\n\t});\n}\n\n// Helper function to process session items with timestamps, sorting, and grouping\nexport function processSessionsWithTimeGrouping(sessions: ChatSessionItemWithProvider[]): ChatSessionItemWithProvider[] {\n\tconst sessionsTemp = [...sessions];\n\t// Only process if we have sessions with timestamps\n\tif (sessions.some(session => session.timing?.startTime !== undefined)) {\n\t\tsortSessionsByTimestamp(sessionsTemp);\n\t\tapplyTimeGrouping(sessionsTemp);\n\t}\n\treturn sessionsTemp;\n}\n\n// Helper function to create context overlay for session items\nexport function getSessionItemContextOverlay(\n\tsession: IChatSessionItem,\n\tprovider?: IChatSessionItemProvider,\n\tchatWidgetService?: IChatWidgetService,\n\tchatService?: IChatService,\n\teditorGroupsService?: IEditorGroupsService\n): [string, any][] {\n\tconst overlay: [string, any][] = [];\n\tif (provider) {\n\t\toverlay.push([ChatContextKeys.sessionType.key, provider.chatSessionType]);\n\t}\n\n\t// Mark history items\n\toverlay.push([ChatContextKeys.isArchivedItem.key, session.archived]);\n\n\t// Mark active sessions - check if session is currently open in editor or widget\n\tlet isActiveSession = false;\n\n\tif (!session.archived && provider?.chatSessionType === localChatSessionType) {\n\t\t// Local non-history sessions are always active\n\t\tisActiveSession = true;\n\t} else if (session.archived && chatWidgetService && chatService && editorGroupsService) {\n\t\t// Check if session is open in a chat widget\n\t\tconst widget = chatWidgetService.getWidgetBySessionResource(session.resource);\n\t\tif (widget) {\n\t\t\tisActiveSession = true;\n\t\t} else {\n\t\t\t// Check if session is open in any editor\n\t\t\tisActiveSession = !!findExistingChatEditorByUri(session.resource, editorGroupsService);\n\t\t}\n\t}\n\n\toverlay.push([ChatContextKeys.isActiveSession.key, isActiveSession]);\n\n\treturn overlay;\n}\n"]}