{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/contrib/chat/browser/contrib/chatImplicitContext.ts","vs/workbench/contrib/chat/browser/contrib/chatImplicitContext.ts"],"names":[],"mappings":"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","file":"chatImplicitContext.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { CancellationTokenSource } from '../../../../../base/common/cancellation.js';\nimport { Emitter, Event } from '../../../../../base/common/event.js';\nimport { Disposable, DisposableStore, MutableDisposable } from '../../../../../base/common/lifecycle.js';\nimport { Schemas } from '../../../../../base/common/network.js';\nimport { autorun } from '../../../../../base/common/observable.js';\nimport { basename, isEqual } from '../../../../../base/common/resources.js';\nimport { ThemeIcon } from '../../../../../base/common/themables.js';\nimport { URI } from '../../../../../base/common/uri.js';\nimport { getCodeEditor, ICodeEditor } from '../../../../../editor/browser/editorBrowser.js';\nimport { ICodeEditorService } from '../../../../../editor/browser/services/codeEditorService.js';\nimport { Location } from '../../../../../editor/common/languages.js';\nimport { IConfigurationService } from '../../../../../platform/configuration/common/configuration.js';\nimport { IWorkbenchContribution } from '../../../../common/contributions.js';\nimport { EditorsOrder } from '../../../../common/editor.js';\nimport { IEditorService } from '../../../../services/editor/common/editorService.js';\nimport { getNotebookEditorFromEditorPane, INotebookEditor } from '../../../notebook/browser/notebookBrowser.js';\nimport { WebviewEditor } from '../../../webviewPanel/browser/webviewEditor.js';\nimport { WebviewInput } from '../../../webviewPanel/browser/webviewEditorInput.js';\nimport { IChatEditingService } from '../../common/chatEditingService.js';\nimport { IChatService } from '../../common/chatService.js';\nimport { IChatRequestImplicitVariableEntry, IChatRequestVariableEntry, isStringImplicitContextValue, StringChatContextValue } from '../../common/chatVariableEntries.js';\nimport { ChatAgentLocation } from '../../common/constants.js';\nimport { ILanguageModelIgnoredFilesService } from '../../common/ignoredFiles.js';\nimport { getPromptsTypeForLanguageId } from '../../common/promptSyntax/promptTypes.js';\nimport { IChatWidget, IChatWidgetService } from '../chat.js';\nimport { IChatContextService } from '../chatContextService.js';\n\nexport class ChatImplicitContextContribution extends Disposable implements IWorkbenchContribution {\n\tstatic readonly ID = 'chat.implicitContext';\n\n\tprivate readonly _currentCancelTokenSource: MutableDisposable<CancellationTokenSource>;\n\n\tprivate _implicitContextEnablement: { [mode: string]: string };\n\n\tconstructor(\n\t\t@ICodeEditorService private readonly codeEditorService: ICodeEditorService,\n\t\t@IEditorService private readonly editorService: IEditorService,\n\t\t@IChatWidgetService private readonly chatWidgetService: IChatWidgetService,\n\t\t@IChatService private readonly chatService: IChatService,\n\t\t@IChatEditingService private readonly chatEditingService: IChatEditingService,\n\t\t@IConfigurationService private readonly configurationService: IConfigurationService,\n\t\t@ILanguageModelIgnoredFilesService private readonly ignoredFilesService: ILanguageModelIgnoredFilesService,\n\t\t@IChatContextService private readonly chatContextService: IChatContextService\n\t) {\n\t\tsuper();\n\t\tthis._currentCancelTokenSource = this._register(new MutableDisposable<CancellationTokenSource>());\n\t\tthis._implicitContextEnablement = this.configurationService.getValue<{ [mode: string]: string }>('chat.implicitContext.enabled');\n\n\t\tconst activeEditorDisposables = this._register(new DisposableStore());\n\n\t\tthis._register(Event.runAndSubscribe(\n\t\t\teditorService.onDidActiveEditorChange,\n\t\t\t(() => {\n\t\t\t\tactiveEditorDisposables.clear();\n\t\t\t\tconst codeEditor = this.findActiveCodeEditor();\n\t\t\t\tif (codeEditor) {\n\t\t\t\t\tactiveEditorDisposables.add(Event.debounce(\n\t\t\t\t\t\tEvent.any(\n\t\t\t\t\t\t\tcodeEditor.onDidChangeModel,\n\t\t\t\t\t\t\tcodeEditor.onDidChangeModelLanguage,\n\t\t\t\t\t\t\tcodeEditor.onDidChangeCursorSelection,\n\t\t\t\t\t\t\tcodeEditor.onDidScrollChange),\n\t\t\t\t\t\t() => undefined,\n\t\t\t\t\t\t500)(() => this.updateImplicitContext()));\n\t\t\t\t}\n\n\t\t\t\tconst notebookEditor = this.findActiveNotebookEditor();\n\t\t\t\tif (notebookEditor) {\n\t\t\t\t\tconst activeCellDisposables = activeEditorDisposables.add(new DisposableStore());\n\t\t\t\t\tactiveEditorDisposables.add(notebookEditor.onDidChangeActiveCell(() => {\n\t\t\t\t\t\tactiveCellDisposables.clear();\n\t\t\t\t\t\tconst codeEditor = this.codeEditorService.getActiveCodeEditor();\n\t\t\t\t\t\tif (codeEditor && codeEditor.getModel()?.uri.scheme === Schemas.vscodeNotebookCell) {\n\t\t\t\t\t\t\tactiveCellDisposables.add(Event.debounce(\n\t\t\t\t\t\t\t\tEvent.any(\n\t\t\t\t\t\t\t\t\tcodeEditor.onDidChangeModel,\n\t\t\t\t\t\t\t\t\tcodeEditor.onDidChangeCursorSelection,\n\t\t\t\t\t\t\t\t\tcodeEditor.onDidScrollChange),\n\t\t\t\t\t\t\t\t() => undefined,\n\t\t\t\t\t\t\t\t500)(() => this.updateImplicitContext()));\n\t\t\t\t\t\t}\n\t\t\t\t\t}));\n\n\t\t\t\t\tactiveEditorDisposables.add(Event.debounce(\n\t\t\t\t\t\tEvent.any(\n\t\t\t\t\t\t\tnotebookEditor.onDidChangeModel,\n\t\t\t\t\t\t\tnotebookEditor.onDidChangeActiveCell\n\t\t\t\t\t\t),\n\t\t\t\t\t\t() => undefined,\n\t\t\t\t\t\t500)(() => this.updateImplicitContext()));\n\t\t\t\t}\n\t\t\t\tconst webviewEditor = this.findActiveWebviewEditor();\n\t\t\t\tif (webviewEditor) {\n\t\t\t\t\tactiveEditorDisposables.add(Event.debounce((webviewEditor.input as WebviewInput).webview.onMessage, () => undefined, 500)(() => {\n\t\t\t\t\t\tthis.updateImplicitContext();\n\t\t\t\t\t}));\n\t\t\t\t}\n\n\t\t\t\tthis.updateImplicitContext();\n\t\t\t})));\n\t\tthis._register(autorun((reader) => {\n\t\t\tthis.chatEditingService.editingSessionsObs.read(reader);\n\t\t\tthis.updateImplicitContext();\n\t\t}));\n\t\tthis._register(this.configurationService.onDidChangeConfiguration(e => {\n\t\t\tif (e.affectsConfiguration('chat.implicitContext.enabled')) {\n\t\t\t\tthis._implicitContextEnablement = this.configurationService.getValue<{ [mode: string]: string }>('chat.implicitContext.enabled');\n\t\t\t\tthis.updateImplicitContext();\n\t\t\t}\n\t\t}));\n\t\tthis._register(this.chatService.onDidSubmitRequest(({ chatSessionResource }) => {\n\t\t\tconst widget = this.chatWidgetService.getWidgetBySessionResource(chatSessionResource);\n\t\t\tif (!widget?.input.implicitContext) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (this._implicitContextEnablement[widget.location] === 'first' && widget.viewModel?.getItems().length !== 0) {\n\t\t\t\twidget.input.implicitContext.setValue(undefined, false, undefined);\n\t\t\t}\n\t\t}));\n\t\tthis._register(this.chatWidgetService.onDidAddWidget(async (widget) => {\n\t\t\tawait this.updateImplicitContext(widget);\n\t\t}));\n\t}\n\n\tprivate findActiveCodeEditor(): ICodeEditor | undefined {\n\t\tconst codeEditor = this.codeEditorService.getActiveCodeEditor();\n\t\tif (codeEditor) {\n\t\t\tconst model = codeEditor.getModel();\n\t\t\tif (model?.uri.scheme === Schemas.vscodeNotebookCell) {\n\t\t\t\treturn undefined;\n\t\t\t}\n\n\t\t\tif (model) {\n\t\t\t\treturn codeEditor;\n\t\t\t}\n\t\t}\n\t\tfor (const codeOrDiffEditor of this.editorService.getVisibleTextEditorControls(EditorsOrder.MOST_RECENTLY_ACTIVE)) {\n\t\t\tconst codeEditor = getCodeEditor(codeOrDiffEditor);\n\t\t\tif (!codeEditor) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tconst model = codeEditor.getModel();\n\t\t\tif (model) {\n\t\t\t\treturn codeEditor;\n\t\t\t}\n\t\t}\n\t\treturn undefined;\n\t}\n\n\tprivate findActiveWebviewEditor(): WebviewEditor | undefined {\n\t\tconst activeEditorPane = this.editorService.activeEditorPane;\n\t\tif (activeEditorPane?.input instanceof WebviewInput) {\n\t\t\treturn activeEditorPane as WebviewEditor;\n\t\t}\n\t\treturn undefined;\n\t}\n\n\tprivate findActiveNotebookEditor(): INotebookEditor | undefined {\n\t\treturn getNotebookEditorFromEditorPane(this.editorService.activeEditorPane);\n\t}\n\n\tprivate async updateImplicitContext(updateWidget?: IChatWidget): Promise<void> {\n\t\tconst cancelTokenSource = this._currentCancelTokenSource.value = new CancellationTokenSource();\n\t\tconst codeEditor = this.findActiveCodeEditor();\n\t\tconst model = codeEditor?.getModel();\n\t\tconst selection = codeEditor?.getSelection();\n\t\tlet newValue: Location | URI | StringChatContextValue | undefined;\n\t\tlet isSelection = false;\n\n\t\tlet languageId: string | undefined;\n\t\tif (model) {\n\t\t\tlanguageId = model.getLanguageId();\n\t\t\tif (selection && !selection.isEmpty()) {\n\t\t\t\tnewValue = { uri: model.uri, range: selection } satisfies Location;\n\t\t\t\tisSelection = true;\n\t\t\t} else {\n\t\t\t\tif (this.configurationService.getValue('chat.implicitContext.suggestedContext')) {\n\t\t\t\t\tnewValue = model.uri;\n\t\t\t\t} else {\n\t\t\t\t\tconst visibleRanges = codeEditor?.getVisibleRanges();\n\t\t\t\t\tif (visibleRanges && visibleRanges.length > 0) {\n\t\t\t\t\t\t// Merge visible ranges. Maybe the reference value could actually be an array of Locations?\n\t\t\t\t\t\t// Something like a Location with an array of Ranges?\n\t\t\t\t\t\tlet range = visibleRanges[0];\n\t\t\t\t\t\tvisibleRanges.slice(1).forEach(r => {\n\t\t\t\t\t\t\trange = range.plusRange(r);\n\t\t\t\t\t\t});\n\t\t\t\t\t\tnewValue = { uri: model.uri, range } satisfies Location;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tnewValue = model.uri;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tconst notebookEditor = this.findActiveNotebookEditor();\n\t\tif (notebookEditor) {\n\t\t\tconst activeCell = notebookEditor.getActiveCell();\n\t\t\tif (activeCell) {\n\t\t\t\tconst codeEditor = this.codeEditorService.getActiveCodeEditor();\n\t\t\t\tconst selection = codeEditor?.getSelection();\n\t\t\t\tconst visibleRanges = codeEditor?.getVisibleRanges() || [];\n\t\t\t\tnewValue = activeCell.uri;\n\t\t\t\tif (isEqual(codeEditor?.getModel()?.uri, activeCell.uri)) {\n\t\t\t\t\tif (selection && !selection.isEmpty()) {\n\t\t\t\t\t\tnewValue = { uri: activeCell.uri, range: selection } satisfies Location;\n\t\t\t\t\t\tisSelection = true;\n\t\t\t\t\t} else if (visibleRanges.length > 0) {\n\t\t\t\t\t\t// Merge visible ranges. Maybe the reference value could actually be an array of Locations?\n\t\t\t\t\t\t// Something like a Location with an array of Ranges?\n\t\t\t\t\t\tlet range = visibleRanges[0];\n\t\t\t\t\t\tvisibleRanges.slice(1).forEach(r => {\n\t\t\t\t\t\t\trange = range.plusRange(r);\n\t\t\t\t\t\t});\n\t\t\t\t\t\tnewValue = { uri: activeCell.uri, range } satisfies Location;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tnewValue = notebookEditor.textModel?.uri;\n\t\t\t}\n\t\t}\n\n\t\tconst webviewEditor = this.findActiveWebviewEditor();\n\t\tif (webviewEditor?.input?.resource) {\n\t\t\tconst webviewContext = await this.chatContextService.contextForResource(webviewEditor.input.resource);\n\t\t\tif (webviewContext) {\n\t\t\t\tnewValue = webviewContext;\n\t\t\t}\n\t\t}\n\n\t\tconst uri = newValue instanceof URI ? newValue : (isStringImplicitContextValue(newValue) ? undefined : newValue?.uri);\n\t\tif (uri && (\n\t\t\tawait this.ignoredFilesService.fileIsIgnored(uri, cancelTokenSource.token) ||\n\t\t\turi.path.endsWith('.copilotmd'))\n\t\t) {\n\t\t\tnewValue = undefined;\n\t\t}\n\n\t\tif (cancelTokenSource.token.isCancellationRequested) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst isPromptFile = languageId && getPromptsTypeForLanguageId(languageId) !== undefined;\n\n\t\tconst widgets = updateWidget ? [updateWidget] : [...this.chatWidgetService.getWidgetsByLocations(ChatAgentLocation.Chat), ...this.chatWidgetService.getWidgetsByLocations(ChatAgentLocation.EditorInline)];\n\t\tfor (const widget of widgets) {\n\t\t\tif (!widget.input.implicitContext) {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tconst setting = this._implicitContextEnablement[widget.location];\n\t\t\tconst isFirstInteraction = widget.viewModel?.getItems().length === 0;\n\t\t\tif ((setting === 'always' || setting === 'first' && isFirstInteraction) && !isPromptFile) { // disable implicit context for prompt files\n\t\t\t\twidget.input.implicitContext.setValue(newValue, isSelection, languageId);\n\t\t\t} else {\n\t\t\t\twidget.input.implicitContext.setValue(undefined, false, undefined);\n\t\t\t}\n\t\t}\n\t}\n}\n\nexport class ChatImplicitContext extends Disposable implements IChatRequestImplicitVariableEntry {\n\tget id() {\n\t\tif (URI.isUri(this.value)) {\n\t\t\treturn 'vscode.implicit.file';\n\t\t} else if (isStringImplicitContextValue(this.value)) {\n\t\t\treturn 'vscode.implicit.string';\n\t\t} else if (this.value) {\n\t\t\tif (this._isSelection) {\n\t\t\t\treturn 'vscode.implicit.selection';\n\t\t\t} else {\n\t\t\t\treturn 'vscode.implicit.viewport';\n\t\t\t}\n\t\t} else {\n\t\t\treturn 'vscode.implicit';\n\t\t}\n\t}\n\n\tget name(): string {\n\t\tif (URI.isUri(this.value)) {\n\t\t\treturn `file:${basename(this.value)}`;\n\t\t} else if (isStringImplicitContextValue(this.value)) {\n\t\t\treturn this.value.name;\n\t\t} else if (this.value) {\n\t\t\treturn `file:${basename(this.value.uri)}`;\n\t\t} else {\n\t\t\treturn 'implicit';\n\t\t}\n\t}\n\n\treadonly kind = 'implicit';\n\n\tget modelDescription(): string {\n\t\tif (URI.isUri(this.value)) {\n\t\t\treturn `User's active file`;\n\t\t} else if (isStringImplicitContextValue(this.value)) {\n\t\t\treturn this.value.modelDescription ?? `User's active context from ${this.value.name}`;\n\t\t} else if (this._isSelection) {\n\t\t\treturn `User's active selection`;\n\t\t} else {\n\t\t\treturn `User's current visible code`;\n\t\t}\n\t}\n\n\treadonly isFile = true;\n\n\tprivate _isSelection = false;\n\tpublic get isSelection(): boolean {\n\t\treturn this._isSelection;\n\t}\n\n\tprivate _onDidChangeValue = this._register(new Emitter<void>());\n\treadonly onDidChangeValue = this._onDidChangeValue.event;\n\n\tprivate _value: Location | URI | StringChatContextValue | undefined;\n\tget value() {\n\t\treturn this._value;\n\t}\n\n\tprivate _enabled = true;\n\tget enabled() {\n\t\treturn this._enabled;\n\t}\n\n\tset enabled(value: boolean) {\n\t\tthis._enabled = value;\n\t\tthis._onDidChangeValue.fire();\n\t}\n\n\tprivate _uri: URI | undefined;\n\tget uri(): URI | undefined {\n\t\tif (isStringImplicitContextValue(this.value)) {\n\t\t\treturn this.value.uri;\n\t\t}\n\t\treturn this._uri;\n\t}\n\n\tget icon(): ThemeIcon | undefined {\n\t\tif (isStringImplicitContextValue(this.value)) {\n\t\t\treturn this.value.icon;\n\t\t}\n\t\treturn undefined;\n\t}\n\n\tsetValue(value: Location | URI | StringChatContextValue | undefined, isSelection: boolean, languageId?: string): void {\n\t\tif (isStringImplicitContextValue(value)) {\n\t\t\tthis._value = value;\n\t\t} else {\n\t\t\tthis._value = value;\n\t\t\tthis._uri = URI.isUri(value) ? value : value?.uri;\n\t\t}\n\t\tthis._isSelection = isSelection;\n\t\tthis._onDidChangeValue.fire();\n\t}\n\n\tpublic toBaseEntries(): IChatRequestVariableEntry[] {\n\t\tif (!this.value) {\n\t\t\treturn [];\n\t\t}\n\n\t\tif (isStringImplicitContextValue(this.value)) {\n\t\t\treturn [\n\t\t\t\t{\n\t\t\t\t\tkind: 'string',\n\t\t\t\t\tid: this.id,\n\t\t\t\t\tname: this.name,\n\t\t\t\t\tvalue: this.value.value ?? this.name,\n\t\t\t\t\tmodelDescription: this.modelDescription,\n\t\t\t\t\ticon: this.value.icon,\n\t\t\t\t\turi: this.value.uri\n\t\t\t\t}\n\t\t\t];\n\t\t}\n\n\t\treturn [{\n\t\t\tkind: 'file',\n\t\t\tid: this.id,\n\t\t\tname: this.name,\n\t\t\tvalue: this.value,\n\t\t\tmodelDescription: this.modelDescription,\n\t\t}];\n\t}\n\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { CancellationTokenSource } from '../../../../../base/common/cancellation.js';\nimport { Emitter, Event } from '../../../../../base/common/event.js';\nimport { Disposable, DisposableStore, MutableDisposable } from '../../../../../base/common/lifecycle.js';\nimport { Schemas } from '../../../../../base/common/network.js';\nimport { autorun } from '../../../../../base/common/observable.js';\nimport { basename, isEqual } from '../../../../../base/common/resources.js';\nimport { ThemeIcon } from '../../../../../base/common/themables.js';\nimport { URI } from '../../../../../base/common/uri.js';\nimport { getCodeEditor, ICodeEditor } from '../../../../../editor/browser/editorBrowser.js';\nimport { ICodeEditorService } from '../../../../../editor/browser/services/codeEditorService.js';\nimport { Location } from '../../../../../editor/common/languages.js';\nimport { IConfigurationService } from '../../../../../platform/configuration/common/configuration.js';\nimport { IWorkbenchContribution } from '../../../../common/contributions.js';\nimport { EditorsOrder } from '../../../../common/editor.js';\nimport { IEditorService } from '../../../../services/editor/common/editorService.js';\nimport { getNotebookEditorFromEditorPane, INotebookEditor } from '../../../notebook/browser/notebookBrowser.js';\nimport { WebviewEditor } from '../../../webviewPanel/browser/webviewEditor.js';\nimport { WebviewInput } from '../../../webviewPanel/browser/webviewEditorInput.js';\nimport { IChatEditingService } from '../../common/chatEditingService.js';\nimport { IChatService } from '../../common/chatService.js';\nimport { IChatRequestImplicitVariableEntry, IChatRequestVariableEntry, isStringImplicitContextValue, StringChatContextValue } from '../../common/chatVariableEntries.js';\nimport { ChatAgentLocation } from '../../common/constants.js';\nimport { ILanguageModelIgnoredFilesService } from '../../common/ignoredFiles.js';\nimport { getPromptsTypeForLanguageId } from '../../common/promptSyntax/promptTypes.js';\nimport { IChatWidget, IChatWidgetService } from '../chat.js';\nimport { IChatContextService } from '../chatContextService.js';\n\nexport class ChatImplicitContextContribution extends Disposable implements IWorkbenchContribution {\n\tstatic readonly ID = 'chat.implicitContext';\n\n\tprivate readonly _currentCancelTokenSource: MutableDisposable<CancellationTokenSource>;\n\n\tprivate _implicitContextEnablement: { [mode: string]: string };\n\n\tconstructor(\n\t\t@ICodeEditorService private readonly codeEditorService: ICodeEditorService,\n\t\t@IEditorService private readonly editorService: IEditorService,\n\t\t@IChatWidgetService private readonly chatWidgetService: IChatWidgetService,\n\t\t@IChatService private readonly chatService: IChatService,\n\t\t@IChatEditingService private readonly chatEditingService: IChatEditingService,\n\t\t@IConfigurationService private readonly configurationService: IConfigurationService,\n\t\t@ILanguageModelIgnoredFilesService private readonly ignoredFilesService: ILanguageModelIgnoredFilesService,\n\t\t@IChatContextService private readonly chatContextService: IChatContextService\n\t) {\n\t\tsuper();\n\t\tthis._currentCancelTokenSource = this._register(new MutableDisposable<CancellationTokenSource>());\n\t\tthis._implicitContextEnablement = this.configurationService.getValue<{ [mode: string]: string }>('chat.implicitContext.enabled');\n\n\t\tconst activeEditorDisposables = this._register(new DisposableStore());\n\n\t\tthis._register(Event.runAndSubscribe(\n\t\t\teditorService.onDidActiveEditorChange,\n\t\t\t(() => {\n\t\t\t\tactiveEditorDisposables.clear();\n\t\t\t\tconst codeEditor = this.findActiveCodeEditor();\n\t\t\t\tif (codeEditor) {\n\t\t\t\t\tactiveEditorDisposables.add(Event.debounce(\n\t\t\t\t\t\tEvent.any(\n\t\t\t\t\t\t\tcodeEditor.onDidChangeModel,\n\t\t\t\t\t\t\tcodeEditor.onDidChangeModelLanguage,\n\t\t\t\t\t\t\tcodeEditor.onDidChangeCursorSelection,\n\t\t\t\t\t\t\tcodeEditor.onDidScrollChange),\n\t\t\t\t\t\t() => undefined,\n\t\t\t\t\t\t500)(() => this.updateImplicitContext()));\n\t\t\t\t}\n\n\t\t\t\tconst notebookEditor = this.findActiveNotebookEditor();\n\t\t\t\tif (notebookEditor) {\n\t\t\t\t\tconst activeCellDisposables = activeEditorDisposables.add(new DisposableStore());\n\t\t\t\t\tactiveEditorDisposables.add(notebookEditor.onDidChangeActiveCell(() => {\n\t\t\t\t\t\tactiveCellDisposables.clear();\n\t\t\t\t\t\tconst codeEditor = this.codeEditorService.getActiveCodeEditor();\n\t\t\t\t\t\tif (codeEditor && codeEditor.getModel()?.uri.scheme === Schemas.vscodeNotebookCell) {\n\t\t\t\t\t\t\tactiveCellDisposables.add(Event.debounce(\n\t\t\t\t\t\t\t\tEvent.any(\n\t\t\t\t\t\t\t\t\tcodeEditor.onDidChangeModel,\n\t\t\t\t\t\t\t\t\tcodeEditor.onDidChangeCursorSelection,\n\t\t\t\t\t\t\t\t\tcodeEditor.onDidScrollChange),\n\t\t\t\t\t\t\t\t() => undefined,\n\t\t\t\t\t\t\t\t500)(() => this.updateImplicitContext()));\n\t\t\t\t\t\t}\n\t\t\t\t\t}));\n\n\t\t\t\t\tactiveEditorDisposables.add(Event.debounce(\n\t\t\t\t\t\tEvent.any(\n\t\t\t\t\t\t\tnotebookEditor.onDidChangeModel,\n\t\t\t\t\t\t\tnotebookEditor.onDidChangeActiveCell\n\t\t\t\t\t\t),\n\t\t\t\t\t\t() => undefined,\n\t\t\t\t\t\t500)(() => this.updateImplicitContext()));\n\t\t\t\t}\n\t\t\t\tconst webviewEditor = this.findActiveWebviewEditor();\n\t\t\t\tif (webviewEditor) {\n\t\t\t\t\tactiveEditorDisposables.add(Event.debounce((webviewEditor.input as WebviewInput).webview.onMessage, () => undefined, 500)(() => {\n\t\t\t\t\t\tthis.updateImplicitContext();\n\t\t\t\t\t}));\n\t\t\t\t}\n\n\t\t\t\tthis.updateImplicitContext();\n\t\t\t})));\n\t\tthis._register(autorun((reader) => {\n\t\t\tthis.chatEditingService.editingSessionsObs.read(reader);\n\t\t\tthis.updateImplicitContext();\n\t\t}));\n\t\tthis._register(this.configurationService.onDidChangeConfiguration(e => {\n\t\t\tif (e.affectsConfiguration('chat.implicitContext.enabled')) {\n\t\t\t\tthis._implicitContextEnablement = this.configurationService.getValue<{ [mode: string]: string }>('chat.implicitContext.enabled');\n\t\t\t\tthis.updateImplicitContext();\n\t\t\t}\n\t\t}));\n\t\tthis._register(this.chatService.onDidSubmitRequest(({ chatSessionResource }) => {\n\t\t\tconst widget = this.chatWidgetService.getWidgetBySessionResource(chatSessionResource);\n\t\t\tif (!widget?.input.implicitContext) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (this._implicitContextEnablement[widget.location] === 'first' && widget.viewModel?.getItems().length !== 0) {\n\t\t\t\twidget.input.implicitContext.setValue(undefined, false, undefined);\n\t\t\t}\n\t\t}));\n\t\tthis._register(this.chatWidgetService.onDidAddWidget(async (widget) => {\n\t\t\tawait this.updateImplicitContext(widget);\n\t\t}));\n\t}\n\n\tprivate findActiveCodeEditor(): ICodeEditor | undefined {\n\t\tconst codeEditor = this.codeEditorService.getActiveCodeEditor();\n\t\tif (codeEditor) {\n\t\t\tconst model = codeEditor.getModel();\n\t\t\tif (model?.uri.scheme === Schemas.vscodeNotebookCell) {\n\t\t\t\treturn undefined;\n\t\t\t}\n\n\t\t\tif (model) {\n\t\t\t\treturn codeEditor;\n\t\t\t}\n\t\t}\n\t\tfor (const codeOrDiffEditor of this.editorService.getVisibleTextEditorControls(EditorsOrder.MOST_RECENTLY_ACTIVE)) {\n\t\t\tconst codeEditor = getCodeEditor(codeOrDiffEditor);\n\t\t\tif (!codeEditor) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tconst model = codeEditor.getModel();\n\t\t\tif (model) {\n\t\t\t\treturn codeEditor;\n\t\t\t}\n\t\t}\n\t\treturn undefined;\n\t}\n\n\tprivate findActiveWebviewEditor(): WebviewEditor | undefined {\n\t\tconst activeEditorPane = this.editorService.activeEditorPane;\n\t\tif (activeEditorPane?.input instanceof WebviewInput) {\n\t\t\treturn activeEditorPane as WebviewEditor;\n\t\t}\n\t\treturn undefined;\n\t}\n\n\tprivate findActiveNotebookEditor(): INotebookEditor | undefined {\n\t\treturn getNotebookEditorFromEditorPane(this.editorService.activeEditorPane);\n\t}\n\n\tprivate async updateImplicitContext(updateWidget?: IChatWidget): Promise<void> {\n\t\tconst cancelTokenSource = this._currentCancelTokenSource.value = new CancellationTokenSource();\n\t\tconst codeEditor = this.findActiveCodeEditor();\n\t\tconst model = codeEditor?.getModel();\n\t\tconst selection = codeEditor?.getSelection();\n\t\tlet newValue: Location | URI | StringChatContextValue | undefined;\n\t\tlet isSelection = false;\n\n\t\tlet languageId: string | undefined;\n\t\tif (model) {\n\t\t\tlanguageId = model.getLanguageId();\n\t\t\tif (selection && !selection.isEmpty()) {\n\t\t\t\tnewValue = { uri: model.uri, range: selection } satisfies Location;\n\t\t\t\tisSelection = true;\n\t\t\t} else {\n\t\t\t\tif (this.configurationService.getValue('chat.implicitContext.suggestedContext')) {\n\t\t\t\t\tnewValue = model.uri;\n\t\t\t\t} else {\n\t\t\t\t\tconst visibleRanges = codeEditor?.getVisibleRanges();\n\t\t\t\t\tif (visibleRanges && visibleRanges.length > 0) {\n\t\t\t\t\t\t// Merge visible ranges. Maybe the reference value could actually be an array of Locations?\n\t\t\t\t\t\t// Something like a Location with an array of Ranges?\n\t\t\t\t\t\tlet range = visibleRanges[0];\n\t\t\t\t\t\tvisibleRanges.slice(1).forEach(r => {\n\t\t\t\t\t\t\trange = range.plusRange(r);\n\t\t\t\t\t\t});\n\t\t\t\t\t\tnewValue = { uri: model.uri, range } satisfies Location;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tnewValue = model.uri;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tconst notebookEditor = this.findActiveNotebookEditor();\n\t\tif (notebookEditor) {\n\t\t\tconst activeCell = notebookEditor.getActiveCell();\n\t\t\tif (activeCell) {\n\t\t\t\tconst codeEditor = this.codeEditorService.getActiveCodeEditor();\n\t\t\t\tconst selection = codeEditor?.getSelection();\n\t\t\t\tconst visibleRanges = codeEditor?.getVisibleRanges() || [];\n\t\t\t\tnewValue = activeCell.uri;\n\t\t\t\tif (isEqual(codeEditor?.getModel()?.uri, activeCell.uri)) {\n\t\t\t\t\tif (selection && !selection.isEmpty()) {\n\t\t\t\t\t\tnewValue = { uri: activeCell.uri, range: selection } satisfies Location;\n\t\t\t\t\t\tisSelection = true;\n\t\t\t\t\t} else if (visibleRanges.length > 0) {\n\t\t\t\t\t\t// Merge visible ranges. Maybe the reference value could actually be an array of Locations?\n\t\t\t\t\t\t// Something like a Location with an array of Ranges?\n\t\t\t\t\t\tlet range = visibleRanges[0];\n\t\t\t\t\t\tvisibleRanges.slice(1).forEach(r => {\n\t\t\t\t\t\t\trange = range.plusRange(r);\n\t\t\t\t\t\t});\n\t\t\t\t\t\tnewValue = { uri: activeCell.uri, range } satisfies Location;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tnewValue = notebookEditor.textModel?.uri;\n\t\t\t}\n\t\t}\n\n\t\tconst webviewEditor = this.findActiveWebviewEditor();\n\t\tif (webviewEditor?.input?.resource) {\n\t\t\tconst webviewContext = await this.chatContextService.contextForResource(webviewEditor.input.resource);\n\t\t\tif (webviewContext) {\n\t\t\t\tnewValue = webviewContext;\n\t\t\t}\n\t\t}\n\n\t\tconst uri = newValue instanceof URI ? newValue : (isStringImplicitContextValue(newValue) ? undefined : newValue?.uri);\n\t\tif (uri && (\n\t\t\tawait this.ignoredFilesService.fileIsIgnored(uri, cancelTokenSource.token) ||\n\t\t\turi.path.endsWith('.copilotmd'))\n\t\t) {\n\t\t\tnewValue = undefined;\n\t\t}\n\n\t\tif (cancelTokenSource.token.isCancellationRequested) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst isPromptFile = languageId && getPromptsTypeForLanguageId(languageId) !== undefined;\n\n\t\tconst widgets = updateWidget ? [updateWidget] : [...this.chatWidgetService.getWidgetsByLocations(ChatAgentLocation.Chat), ...this.chatWidgetService.getWidgetsByLocations(ChatAgentLocation.EditorInline)];\n\t\tfor (const widget of widgets) {\n\t\t\tif (!widget.input.implicitContext) {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tconst setting = this._implicitContextEnablement[widget.location];\n\t\t\tconst isFirstInteraction = widget.viewModel?.getItems().length === 0;\n\t\t\tif ((setting === 'always' || setting === 'first' && isFirstInteraction) && !isPromptFile) { // disable implicit context for prompt files\n\t\t\t\twidget.input.implicitContext.setValue(newValue, isSelection, languageId);\n\t\t\t} else {\n\t\t\t\twidget.input.implicitContext.setValue(undefined, false, undefined);\n\t\t\t}\n\t\t}\n\t}\n}\n\nexport class ChatImplicitContext extends Disposable implements IChatRequestImplicitVariableEntry {\n\tget id() {\n\t\tif (URI.isUri(this.value)) {\n\t\t\treturn 'vscode.implicit.file';\n\t\t} else if (isStringImplicitContextValue(this.value)) {\n\t\t\treturn 'vscode.implicit.string';\n\t\t} else if (this.value) {\n\t\t\tif (this._isSelection) {\n\t\t\t\treturn 'vscode.implicit.selection';\n\t\t\t} else {\n\t\t\t\treturn 'vscode.implicit.viewport';\n\t\t\t}\n\t\t} else {\n\t\t\treturn 'vscode.implicit';\n\t\t}\n\t}\n\n\tget name(): string {\n\t\tif (URI.isUri(this.value)) {\n\t\t\treturn `file:${basename(this.value)}`;\n\t\t} else if (isStringImplicitContextValue(this.value)) {\n\t\t\treturn this.value.name;\n\t\t} else if (this.value) {\n\t\t\treturn `file:${basename(this.value.uri)}`;\n\t\t} else {\n\t\t\treturn 'implicit';\n\t\t}\n\t}\n\n\treadonly kind = 'implicit';\n\n\tget modelDescription(): string {\n\t\tif (URI.isUri(this.value)) {\n\t\t\treturn `User's active file`;\n\t\t} else if (isStringImplicitContextValue(this.value)) {\n\t\t\treturn this.value.modelDescription ?? `User's active context from ${this.value.name}`;\n\t\t} else if (this._isSelection) {\n\t\t\treturn `User's active selection`;\n\t\t} else {\n\t\t\treturn `User's current visible code`;\n\t\t}\n\t}\n\n\treadonly isFile = true;\n\n\tprivate _isSelection = false;\n\tpublic get isSelection(): boolean {\n\t\treturn this._isSelection;\n\t}\n\n\tprivate _onDidChangeValue = this._register(new Emitter<void>());\n\treadonly onDidChangeValue = this._onDidChangeValue.event;\n\n\tprivate _value: Location | URI | StringChatContextValue | undefined;\n\tget value() {\n\t\treturn this._value;\n\t}\n\n\tprivate _enabled = true;\n\tget enabled() {\n\t\treturn this._enabled;\n\t}\n\n\tset enabled(value: boolean) {\n\t\tthis._enabled = value;\n\t\tthis._onDidChangeValue.fire();\n\t}\n\n\tprivate _uri: URI | undefined;\n\tget uri(): URI | undefined {\n\t\tif (isStringImplicitContextValue(this.value)) {\n\t\t\treturn this.value.uri;\n\t\t}\n\t\treturn this._uri;\n\t}\n\n\tget icon(): ThemeIcon | undefined {\n\t\tif (isStringImplicitContextValue(this.value)) {\n\t\t\treturn this.value.icon;\n\t\t}\n\t\treturn undefined;\n\t}\n\n\tsetValue(value: Location | URI | StringChatContextValue | undefined, isSelection: boolean, languageId?: string): void {\n\t\tif (isStringImplicitContextValue(value)) {\n\t\t\tthis._value = value;\n\t\t} else {\n\t\t\tthis._value = value;\n\t\t\tthis._uri = URI.isUri(value) ? value : value?.uri;\n\t\t}\n\t\tthis._isSelection = isSelection;\n\t\tthis._onDidChangeValue.fire();\n\t}\n\n\tpublic toBaseEntries(): IChatRequestVariableEntry[] {\n\t\tif (!this.value) {\n\t\t\treturn [];\n\t\t}\n\n\t\tif (isStringImplicitContextValue(this.value)) {\n\t\t\treturn [\n\t\t\t\t{\n\t\t\t\t\tkind: 'string',\n\t\t\t\t\tid: this.id,\n\t\t\t\t\tname: this.name,\n\t\t\t\t\tvalue: this.value.value ?? this.name,\n\t\t\t\t\tmodelDescription: this.modelDescription,\n\t\t\t\t\ticon: this.value.icon,\n\t\t\t\t\turi: this.value.uri\n\t\t\t\t}\n\t\t\t];\n\t\t}\n\n\t\treturn [{\n\t\t\tkind: 'file',\n\t\t\tid: this.id,\n\t\t\tname: this.name,\n\t\t\tvalue: this.value,\n\t\t\tmodelDescription: this.modelDescription,\n\t\t}];\n\t}\n\n}\n"]}