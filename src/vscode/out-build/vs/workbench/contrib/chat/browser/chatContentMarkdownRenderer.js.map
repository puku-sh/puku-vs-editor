{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/contrib/chat/browser/chatContentMarkdownRenderer.ts","vs/workbench/contrib/chat/browser/chatContentMarkdownRenderer.ts"],"names":[],"mappings":"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","file":"chatContentMarkdownRenderer.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { $ } from '../../../../base/browser/dom.js';\nimport { IRenderedMarkdown, MarkdownRenderOptions } from '../../../../base/browser/markdownRenderer.js';\nimport { getDefaultHoverDelegate } from '../../../../base/browser/ui/hover/hoverDelegateFactory.js';\nimport { IMarkdownString } from '../../../../base/common/htmlContent.js';\nimport { DisposableStore } from '../../../../base/common/lifecycle.js';\nimport { IMarkdownRenderer, IMarkdownRendererService } from '../../../../platform/markdown/browser/markdownRenderer.js';\nimport { ILanguageService } from '../../../../editor/common/languages/language.js';\nimport { IConfigurationService } from '../../../../platform/configuration/common/configuration.js';\nimport { IHoverService } from '../../../../platform/hover/browser/hover.js';\nimport { IOpenerService } from '../../../../platform/opener/common/opener.js';\nimport product from '../../../../platform/product/common/product.js';\n\nexport const allowedChatMarkdownHtmlTags = Object.freeze([\n\t'b',\n\t'blockquote',\n\t'br',\n\t'code',\n\t'del',\n\t'em',\n\t'h1',\n\t'h2',\n\t'h3',\n\t'h4',\n\t'h5',\n\t'h6',\n\t'hr',\n\t'i',\n\t'ins',\n\t'li',\n\t'ol',\n\t'p',\n\t'pre',\n\t's',\n\t'strong',\n\t'sub',\n\t'sup',\n\t'table',\n\t'tbody',\n\t'td',\n\t'th',\n\t'thead',\n\t'tr',\n\t'ul',\n\t'a',\n\t'img',\n\n\t// TODO@roblourens when we sanitize attributes in markdown source, we can ban these elements at that step. microsoft/vscode-copilot#5091\n\t// Not in the official list, but used for codicons and other vscode markdown extensions\n\t'span',\n\t'div',\n\n\t'input', // Allowed for rendering checkboxes. Other types of inputs are removed and the inputs are always disabled\n]);\n\n/**\n * This wraps the MarkdownRenderer and applies sanitizer options needed for chat content.\n */\nexport class ChatContentMarkdownRenderer implements IMarkdownRenderer {\n\tconstructor(\n\t\t@ILanguageService languageService: ILanguageService,\n\t\t@IOpenerService openerService: IOpenerService,\n\t\t@IConfigurationService configurationService: IConfigurationService,\n\t\t@IHoverService private readonly hoverService: IHoverService,\n\t\t@IMarkdownRendererService private readonly markdownRendererService: IMarkdownRendererService,\n\t) { }\n\n\trender(markdown: IMarkdownString, options?: MarkdownRenderOptions, outElement?: HTMLElement): IRenderedMarkdown {\n\t\toptions = {\n\t\t\t...options,\n\t\t\tsanitizerConfig: {\n\t\t\t\treplaceWithPlaintext: true,\n\t\t\t\tallowedTags: {\n\t\t\t\t\toverride: allowedChatMarkdownHtmlTags,\n\t\t\t\t},\n\t\t\t\t...options?.sanitizerConfig,\n\t\t\t\tallowedLinkSchemes: { augment: [product.urlProtocol] },\n\t\t\t\tremoteImageIsAllowed: (_uri) => false,\n\t\t\t}\n\t\t};\n\n\t\tconst mdWithBody: IMarkdownString = (markdown && markdown.supportHtml) ?\n\t\t\t{\n\t\t\t\t...markdown,\n\n\t\t\t\t// dompurify uses DOMParser, which strips leading comments. Wrapping it all in 'body' prevents this.\n\t\t\t\t// The \\n\\n prevents marked.js from parsing the body contents as just text in an 'html' token, instead of actual markdown.\n\t\t\t\tvalue: `<body>\\n\\n${markdown.value}</body>`,\n\t\t\t}\n\t\t\t: markdown;\n\t\tconst result = this.markdownRendererService.render(mdWithBody, options, outElement);\n\n\t\t// In some cases, the renderer can return top level text nodes  but our CSS expects\n\t\t// all text to be in a <p> for margin to be applied properly.\n\t\t// So just normalize it.\n\t\tresult.element.normalize();\n\t\tfor (const child of result.element.childNodes) {\n\t\t\tif (child.nodeType === Node.TEXT_NODE && child.textContent?.trim()) {\n\t\t\t\tchild.replaceWith($('p', undefined, child.textContent));\n\t\t\t}\n\t\t}\n\t\treturn this.attachCustomHover(result);\n\t}\n\n\tprivate attachCustomHover(result: IRenderedMarkdown): IRenderedMarkdown {\n\t\tconst store = new DisposableStore();\n\t\t// eslint-disable-next-line no-restricted-syntax\n\t\tresult.element.querySelectorAll('a').forEach((element) => {\n\t\t\tif (element.title) {\n\t\t\t\tconst title = element.title;\n\t\t\t\telement.title = '';\n\t\t\t\tstore.add(this.hoverService.setupManagedHover(getDefaultHoverDelegate('element'), element, title));\n\t\t\t}\n\t\t});\n\n\t\treturn {\n\t\t\telement: result.element,\n\t\t\tdispose: () => {\n\t\t\t\tresult.dispose();\n\t\t\t\tstore.dispose();\n\t\t\t}\n\t\t};\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { $ } from '../../../../base/browser/dom.js';\nimport { IRenderedMarkdown, MarkdownRenderOptions } from '../../../../base/browser/markdownRenderer.js';\nimport { getDefaultHoverDelegate } from '../../../../base/browser/ui/hover/hoverDelegateFactory.js';\nimport { IMarkdownString } from '../../../../base/common/htmlContent.js';\nimport { DisposableStore } from '../../../../base/common/lifecycle.js';\nimport { IMarkdownRenderer, IMarkdownRendererService } from '../../../../platform/markdown/browser/markdownRenderer.js';\nimport { ILanguageService } from '../../../../editor/common/languages/language.js';\nimport { IConfigurationService } from '../../../../platform/configuration/common/configuration.js';\nimport { IHoverService } from '../../../../platform/hover/browser/hover.js';\nimport { IOpenerService } from '../../../../platform/opener/common/opener.js';\nimport product from '../../../../platform/product/common/product.js';\n\nexport const allowedChatMarkdownHtmlTags = Object.freeze([\n\t'b',\n\t'blockquote',\n\t'br',\n\t'code',\n\t'del',\n\t'em',\n\t'h1',\n\t'h2',\n\t'h3',\n\t'h4',\n\t'h5',\n\t'h6',\n\t'hr',\n\t'i',\n\t'ins',\n\t'li',\n\t'ol',\n\t'p',\n\t'pre',\n\t's',\n\t'strong',\n\t'sub',\n\t'sup',\n\t'table',\n\t'tbody',\n\t'td',\n\t'th',\n\t'thead',\n\t'tr',\n\t'ul',\n\t'a',\n\t'img',\n\n\t// TODO@roblourens when we sanitize attributes in markdown source, we can ban these elements at that step. microsoft/vscode-copilot#5091\n\t// Not in the official list, but used for codicons and other vscode markdown extensions\n\t'span',\n\t'div',\n\n\t'input', // Allowed for rendering checkboxes. Other types of inputs are removed and the inputs are always disabled\n]);\n\n/**\n * This wraps the MarkdownRenderer and applies sanitizer options needed for chat content.\n */\nexport class ChatContentMarkdownRenderer implements IMarkdownRenderer {\n\tconstructor(\n\t\t@ILanguageService languageService: ILanguageService,\n\t\t@IOpenerService openerService: IOpenerService,\n\t\t@IConfigurationService configurationService: IConfigurationService,\n\t\t@IHoverService private readonly hoverService: IHoverService,\n\t\t@IMarkdownRendererService private readonly markdownRendererService: IMarkdownRendererService,\n\t) { }\n\n\trender(markdown: IMarkdownString, options?: MarkdownRenderOptions, outElement?: HTMLElement): IRenderedMarkdown {\n\t\toptions = {\n\t\t\t...options,\n\t\t\tsanitizerConfig: {\n\t\t\t\treplaceWithPlaintext: true,\n\t\t\t\tallowedTags: {\n\t\t\t\t\toverride: allowedChatMarkdownHtmlTags,\n\t\t\t\t},\n\t\t\t\t...options?.sanitizerConfig,\n\t\t\t\tallowedLinkSchemes: { augment: [product.urlProtocol] },\n\t\t\t\tremoteImageIsAllowed: (_uri) => false,\n\t\t\t}\n\t\t};\n\n\t\tconst mdWithBody: IMarkdownString = (markdown && markdown.supportHtml) ?\n\t\t\t{\n\t\t\t\t...markdown,\n\n\t\t\t\t// dompurify uses DOMParser, which strips leading comments. Wrapping it all in 'body' prevents this.\n\t\t\t\t// The \\n\\n prevents marked.js from parsing the body contents as just text in an 'html' token, instead of actual markdown.\n\t\t\t\tvalue: `<body>\\n\\n${markdown.value}</body>`,\n\t\t\t}\n\t\t\t: markdown;\n\t\tconst result = this.markdownRendererService.render(mdWithBody, options, outElement);\n\n\t\t// In some cases, the renderer can return top level text nodes  but our CSS expects\n\t\t// all text to be in a <p> for margin to be applied properly.\n\t\t// So just normalize it.\n\t\tresult.element.normalize();\n\t\tfor (const child of result.element.childNodes) {\n\t\t\tif (child.nodeType === Node.TEXT_NODE && child.textContent?.trim()) {\n\t\t\t\tchild.replaceWith($('p', undefined, child.textContent));\n\t\t\t}\n\t\t}\n\t\treturn this.attachCustomHover(result);\n\t}\n\n\tprivate attachCustomHover(result: IRenderedMarkdown): IRenderedMarkdown {\n\t\tconst store = new DisposableStore();\n\t\t// eslint-disable-next-line no-restricted-syntax\n\t\tresult.element.querySelectorAll('a').forEach((element) => {\n\t\t\tif (element.title) {\n\t\t\t\tconst title = element.title;\n\t\t\t\telement.title = '';\n\t\t\t\tstore.add(this.hoverService.setupManagedHover(getDefaultHoverDelegate('element'), element, title));\n\t\t\t}\n\t\t});\n\n\t\treturn {\n\t\t\telement: result.element,\n\t\t\tdispose: () => {\n\t\t\t\tresult.dispose();\n\t\t\t\tstore.dispose();\n\t\t\t}\n\t\t};\n\t}\n}\n"]}