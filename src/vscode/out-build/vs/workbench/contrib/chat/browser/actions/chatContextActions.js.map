{"version":3,"sources":["vs/workbench/contrib/chat/browser/actions/chatContextActions.ts"],"names":[],"mappings":"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","file":"chatContextActions.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { DeferredPromise, isThenable } from '../../../../../base/common/async.js';\nimport { CancellationTokenSource } from '../../../../../base/common/cancellation.js';\nimport { Codicon } from '../../../../../base/common/codicons.js';\nimport { KeyCode, KeyMod } from '../../../../../base/common/keyCodes.js';\nimport { DisposableStore, toDisposable } from '../../../../../base/common/lifecycle.js';\nimport { Schemas } from '../../../../../base/common/network.js';\nimport { autorun, observableValue } from '../../../../../base/common/observable.js';\nimport { ThemeIcon } from '../../../../../base/common/themables.js';\nimport { isObject } from '../../../../../base/common/types.js';\nimport { URI } from '../../../../../base/common/uri.js';\nimport { ServicesAccessor } from '../../../../../editor/browser/editorExtensions.js';\nimport { Range } from '../../../../../editor/common/core/range.js';\nimport { EditorContextKeys } from '../../../../../editor/common/editorContextKeys.js';\nimport { ITextModelService } from '../../../../../editor/common/services/resolverService.js';\nimport { AbstractGotoSymbolQuickAccessProvider, IGotoSymbolQuickPickItem } from '../../../../../editor/contrib/quickAccess/browser/gotoSymbolQuickAccess.js';\nimport { localize, localize2 } from '../../../../../nls.js';\nimport { Action2, MenuId, registerAction2 } from '../../../../../platform/actions/common/actions.js';\nimport { ICommandService } from '../../../../../platform/commands/common/commands.js';\nimport { ContextKeyExpr, IContextKeyService } from '../../../../../platform/contextkey/common/contextkey.js';\nimport { IFileService } from '../../../../../platform/files/common/files.js';\nimport { IInstantiationService } from '../../../../../platform/instantiation/common/instantiation.js';\nimport { IKeybindingService } from '../../../../../platform/keybinding/common/keybinding.js';\nimport { KeybindingWeight } from '../../../../../platform/keybinding/common/keybindingsRegistry.js';\nimport { IListService } from '../../../../../platform/list/browser/listService.js';\nimport { ILogService } from '../../../../../platform/log/common/log.js';\nimport { AnythingQuickAccessProviderRunOptions } from '../../../../../platform/quickinput/common/quickAccess.js';\nimport { IQuickInputService, IQuickPickItem, IQuickPickItemWithResource, QuickPickItem } from '../../../../../platform/quickinput/common/quickInput.js';\nimport { resolveCommandsContext } from '../../../../browser/parts/editor/editorCommandsContext.js';\nimport { ResourceContextKey } from '../../../../common/contextkeys.js';\nimport { EditorResourceAccessor, isEditorCommandsContext, SideBySideEditor } from '../../../../common/editor.js';\nimport { IEditorGroupsService } from '../../../../services/editor/common/editorGroupsService.js';\nimport { IEditorService } from '../../../../services/editor/common/editorService.js';\nimport { ExplorerFolderContext } from '../../../files/common/files.js';\nimport { CTX_INLINE_CHAT_V2_ENABLED } from '../../../inlineChat/common/inlineChat.js';\nimport { AnythingQuickAccessProvider } from '../../../search/browser/anythingQuickAccess.js';\nimport { isSearchTreeFileMatch, isSearchTreeMatch } from '../../../search/browser/searchTreeModel/searchTreeCommon.js';\nimport { ISymbolQuickPickItem, SymbolsQuickAccessProvider } from '../../../search/browser/symbolsQuickAccess.js';\nimport { SearchContext } from '../../../search/common/constants.js';\nimport { ChatContextKeys } from '../../common/chatContextKeys.js';\nimport { IChatRequestVariableEntry, OmittedState } from '../../common/chatVariableEntries.js';\nimport { ChatAgentLocation, isSupportedChatFileScheme } from '../../common/constants.js';\nimport { IChatWidget, IChatWidgetService, IQuickChatService } from '../chat.js';\nimport { IChatContextPickerItem, IChatContextPickService, IChatContextValueItem, isChatContextPickerPickItem } from '../chatContextPickService.js';\nimport { isQuickChat } from '../chatWidget.js';\nimport { resizeImage } from '../imageUtils.js';\nimport { registerPromptActions } from '../promptSyntax/promptFileActions.js';\nimport { CHAT_CATEGORY } from './chatActions.js';\n\nexport function registerChatContextActions() {\n\tregisterAction2(AttachContextAction);\n\tregisterAction2(AttachFileToChatAction);\n\tregisterAction2(AttachFolderToChatAction);\n\tregisterAction2(AttachSelectionToChatAction);\n\tregisterAction2(AttachSearchResultAction);\n\tregisterPromptActions();\n}\n\nasync function withChatView(accessor: ServicesAccessor): Promise<IChatWidget | undefined> {\n\tconst chatWidgetService = accessor.get(IChatWidgetService);\n\n\tconst lastFocusedWidget = chatWidgetService.lastFocusedWidget;\n\tif (!lastFocusedWidget || lastFocusedWidget.location === ChatAgentLocation.Chat) {\n\t\treturn chatWidgetService.revealWidget(); // only show chat view if we either have no chat view or its located in view container\n\t}\n\treturn lastFocusedWidget;\n}\n\nabstract class AttachResourceAction extends Action2 {\n\n\toverride async run(accessor: ServicesAccessor, ...args: unknown[]): Promise<void> {\n\t\tconst instaService = accessor.get(IInstantiationService);\n\t\tconst widget = await instaService.invokeFunction(withChatView);\n\t\tif (!widget) {\n\t\t\treturn;\n\t\t}\n\t\treturn instaService.invokeFunction(this.runWithWidget.bind(this), widget, ...args);\n\t}\n\n\tabstract runWithWidget(accessor: ServicesAccessor, widget: IChatWidget, ...args: unknown[]): Promise<void>;\n\n\tprotected _getResources(accessor: ServicesAccessor, ...args: unknown[]): URI[] {\n\t\tconst editorService = accessor.get(IEditorService);\n\n\t\tconst contexts = isEditorCommandsContext(args[1]) ? this._getEditorResources(accessor, args) : Array.isArray(args[1]) ? args[1] : [args[0]];\n\t\tconst files = [];\n\t\tfor (const context of contexts) {\n\t\t\tlet uri;\n\t\t\tif (URI.isUri(context)) {\n\t\t\t\turi = context;\n\t\t\t} else if (isSearchTreeFileMatch(context)) {\n\t\t\t\turi = context.resource;\n\t\t\t} else if (isSearchTreeMatch(context)) {\n\t\t\t\turi = context.parent().resource;\n\t\t\t} else if (!context && editorService.activeTextEditorControl) {\n\t\t\t\turi = EditorResourceAccessor.getCanonicalUri(editorService.activeEditor, { supportSideBySide: SideBySideEditor.PRIMARY });\n\t\t\t}\n\n\t\t\tif (uri && [Schemas.file, Schemas.vscodeRemote, Schemas.untitled].includes(uri.scheme)) {\n\t\t\t\tfiles.push(uri);\n\t\t\t}\n\t\t}\n\n\t\treturn files;\n\t}\n\n\tprivate _getEditorResources(accessor: ServicesAccessor, ...args: unknown[]): URI[] {\n\t\tconst resolvedContext = resolveCommandsContext(args, accessor.get(IEditorService), accessor.get(IEditorGroupsService), accessor.get(IListService));\n\n\t\treturn resolvedContext.groupedEditors\n\t\t\t.flatMap(groupedEditor => groupedEditor.editors)\n\t\t\t.map(editor => EditorResourceAccessor.getCanonicalUri(editor, { supportSideBySide: SideBySideEditor.PRIMARY }))\n\t\t\t.filter(uri => uri !== undefined);\n\t}\n}\n\nclass AttachFileToChatAction extends AttachResourceAction {\n\n\tstatic readonly ID = 'workbench.action.chat.attachFile';\n\n\tconstructor() {\n\t\tsuper({\n\t\t\tid: AttachFileToChatAction.ID,\n\t\t\ttitle: localize2('workbench.action.chat.attachFile.label', \"Add File to Chat\"),\n\t\t\tcategory: CHAT_CATEGORY,\n\t\t\tprecondition: ChatContextKeys.enabled,\n\t\t\tf1: true,\n\t\t\tmenu: [{\n\t\t\t\tid: MenuId.SearchContext,\n\t\t\t\tgroup: 'z_chat',\n\t\t\t\torder: 1,\n\t\t\t\twhen: ContextKeyExpr.and(ChatContextKeys.enabled, SearchContext.FileMatchOrMatchFocusKey, SearchContext.SearchResultHeaderFocused.negate()),\n\t\t\t}, {\n\t\t\t\tid: MenuId.ExplorerContext,\n\t\t\t\tgroup: '5_chat',\n\t\t\t\torder: 1,\n\t\t\t\twhen: ContextKeyExpr.and(\n\t\t\t\t\tChatContextKeys.enabled,\n\t\t\t\t\tExplorerFolderContext.negate(),\n\t\t\t\t\tContextKeyExpr.or(\n\t\t\t\t\t\tResourceContextKey.Scheme.isEqualTo(Schemas.file),\n\t\t\t\t\t\tResourceContextKey.Scheme.isEqualTo(Schemas.vscodeRemote)\n\t\t\t\t\t)\n\t\t\t\t),\n\t\t\t}, {\n\t\t\t\tid: MenuId.EditorTitleContext,\n\t\t\t\tgroup: '2_chat',\n\t\t\t\torder: 1,\n\t\t\t\twhen: ContextKeyExpr.and(\n\t\t\t\t\tChatContextKeys.enabled,\n\t\t\t\t\tContextKeyExpr.or(\n\t\t\t\t\t\tResourceContextKey.Scheme.isEqualTo(Schemas.file),\n\t\t\t\t\t\tResourceContextKey.Scheme.isEqualTo(Schemas.vscodeRemote)\n\t\t\t\t\t)\n\t\t\t\t),\n\t\t\t}, {\n\t\t\t\tid: MenuId.EditorContext,\n\t\t\t\tgroup: '1_chat',\n\t\t\t\torder: 2,\n\t\t\t\twhen: ContextKeyExpr.and(\n\t\t\t\t\tChatContextKeys.enabled,\n\t\t\t\t\tContextKeyExpr.or(\n\t\t\t\t\t\tResourceContextKey.Scheme.isEqualTo(Schemas.file),\n\t\t\t\t\t\tResourceContextKey.Scheme.isEqualTo(Schemas.vscodeRemote),\n\t\t\t\t\t\tResourceContextKey.Scheme.isEqualTo(Schemas.untitled),\n\t\t\t\t\t\tResourceContextKey.Scheme.isEqualTo(Schemas.vscodeUserData)\n\t\t\t\t\t)\n\t\t\t\t)\n\t\t\t}]\n\t\t});\n\t}\n\n\toverride async runWithWidget(accessor: ServicesAccessor, widget: IChatWidget, ...args: unknown[]): Promise<void> {\n\t\tconst files = this._getResources(accessor, ...args);\n\t\tif (!files.length) {\n\t\t\treturn;\n\t\t}\n\t\tif (widget) {\n\t\t\twidget.focusInput();\n\t\t\tfor (const file of files) {\n\t\t\t\twidget.attachmentModel.addFile(file);\n\t\t\t}\n\t\t}\n\t}\n}\n\nclass AttachFolderToChatAction extends AttachResourceAction {\n\n\tstatic readonly ID = 'workbench.action.chat.attachFolder';\n\n\tconstructor() {\n\t\tsuper({\n\t\t\tid: AttachFolderToChatAction.ID,\n\t\t\ttitle: localize2('workbench.action.chat.attachFolder.label', \"Add Folder to Chat\"),\n\t\t\tcategory: CHAT_CATEGORY,\n\t\t\tf1: false,\n\t\t\tmenu: {\n\t\t\t\tid: MenuId.ExplorerContext,\n\t\t\t\tgroup: '5_chat',\n\t\t\t\torder: 1,\n\t\t\t\twhen: ContextKeyExpr.and(\n\t\t\t\t\tChatContextKeys.enabled,\n\t\t\t\t\tExplorerFolderContext,\n\t\t\t\t\tContextKeyExpr.or(\n\t\t\t\t\t\tResourceContextKey.Scheme.isEqualTo(Schemas.file),\n\t\t\t\t\t\tResourceContextKey.Scheme.isEqualTo(Schemas.vscodeRemote)\n\t\t\t\t\t)\n\t\t\t\t)\n\t\t\t}\n\t\t});\n\t}\n\n\toverride async runWithWidget(accessor: ServicesAccessor, widget: IChatWidget, ...args: unknown[]): Promise<void> {\n\t\tconst folders = this._getResources(accessor, ...args);\n\t\tif (!folders.length) {\n\t\t\treturn;\n\t\t}\n\t\tif (widget) {\n\t\t\twidget.focusInput();\n\t\t\tfor (const folder of folders) {\n\t\t\t\twidget.attachmentModel.addFolder(folder);\n\t\t\t}\n\t\t}\n\t}\n}\n\nclass AttachSelectionToChatAction extends Action2 {\n\n\tstatic readonly ID = 'workbench.action.chat.attachSelection';\n\n\tconstructor() {\n\t\tsuper({\n\t\t\tid: AttachSelectionToChatAction.ID,\n\t\t\ttitle: localize2('workbench.action.chat.attachSelection.label', \"Add Selection to Chat\"),\n\t\t\tcategory: CHAT_CATEGORY,\n\t\t\tf1: true,\n\t\t\tprecondition: ChatContextKeys.enabled,\n\t\t\tmenu: {\n\t\t\t\tid: MenuId.EditorContext,\n\t\t\t\tgroup: '1_chat',\n\t\t\t\torder: 1,\n\t\t\t\twhen: ContextKeyExpr.and(\n\t\t\t\t\tChatContextKeys.enabled,\n\t\t\t\t\tEditorContextKeys.hasNonEmptySelection,\n\t\t\t\t\tContextKeyExpr.or(\n\t\t\t\t\t\tResourceContextKey.Scheme.isEqualTo(Schemas.file),\n\t\t\t\t\t\tResourceContextKey.Scheme.isEqualTo(Schemas.vscodeRemote),\n\t\t\t\t\t\tResourceContextKey.Scheme.isEqualTo(Schemas.untitled),\n\t\t\t\t\t\tResourceContextKey.Scheme.isEqualTo(Schemas.vscodeUserData)\n\t\t\t\t\t)\n\t\t\t\t)\n\t\t\t}\n\t\t});\n\t}\n\n\toverride async run(accessor: ServicesAccessor, ...args: any[]): Promise<void> {\n\t\tconst editorService = accessor.get(IEditorService);\n\n\t\tconst widget = await accessor.get(IInstantiationService).invokeFunction(withChatView);\n\t\tif (!widget) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst [_, matches] = args;\n\t\t// If we have search matches, it means this is coming from the search widget\n\t\tif (matches && matches.length > 0) {\n\t\t\tconst uris = new Map<URI, Range | undefined>();\n\t\t\tfor (const match of matches) {\n\t\t\t\tif (isSearchTreeFileMatch(match)) {\n\t\t\t\t\turis.set(match.resource, undefined);\n\t\t\t\t} else {\n\t\t\t\t\tconst context = { uri: match._parent.resource, range: match._range };\n\t\t\t\t\tconst range = uris.get(context.uri);\n\t\t\t\t\tif (!range ||\n\t\t\t\t\t\trange.startLineNumber !== context.range.startLineNumber && range.endLineNumber !== context.range.endLineNumber) {\n\t\t\t\t\t\turis.set(context.uri, context.range);\n\t\t\t\t\t\twidget.attachmentModel.addFile(context.uri, context.range);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\t// Add the root files for all of the ones that didn't have a match\n\t\t\tfor (const uri of uris) {\n\t\t\t\tconst [resource, range] = uri;\n\t\t\t\tif (!range) {\n\t\t\t\t\twidget.attachmentModel.addFile(resource);\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tconst activeEditor = editorService.activeTextEditorControl;\n\t\t\tconst activeUri = EditorResourceAccessor.getCanonicalUri(editorService.activeEditor, { supportSideBySide: SideBySideEditor.PRIMARY });\n\t\t\tif (activeEditor && activeUri && [Schemas.file, Schemas.vscodeRemote, Schemas.untitled].includes(activeUri.scheme)) {\n\t\t\t\tconst selection = activeEditor.getSelection();\n\t\t\t\tif (selection) {\n\t\t\t\t\twidget.focusInput();\n\t\t\t\t\tconst range = selection.isEmpty() ? new Range(selection.startLineNumber, 1, selection.startLineNumber + 1, 1) : selection;\n\t\t\t\t\twidget.attachmentModel.addFile(activeUri, range);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n}\n\nexport class AttachSearchResultAction extends Action2 {\n\n\tprivate static readonly Name = 'searchResults';\n\n\tconstructor() {\n\t\tsuper({\n\t\t\tid: 'workbench.action.chat.insertSearchResults',\n\t\t\ttitle: localize2('chat.insertSearchResults', 'Add Search Results to Chat'),\n\t\t\tcategory: CHAT_CATEGORY,\n\t\t\tf1: false,\n\t\t\tmenu: [{\n\t\t\t\tid: MenuId.SearchContext,\n\t\t\t\tgroup: 'z_chat',\n\t\t\t\torder: 3,\n\t\t\t\twhen: ContextKeyExpr.and(\n\t\t\t\t\tChatContextKeys.enabled,\n\t\t\t\t\tSearchContext.SearchResultHeaderFocused),\n\t\t\t}]\n\t\t});\n\t}\n\tasync run(accessor: ServicesAccessor) {\n\t\tconst logService = accessor.get(ILogService);\n\t\tconst widget = await accessor.get(IInstantiationService).invokeFunction(withChatView);\n\n\t\tif (!widget) {\n\t\t\tlogService.trace('InsertSearchResultAction: no chat view available');\n\t\t\treturn;\n\t\t}\n\n\t\tconst editor = widget.inputEditor;\n\t\tconst originalRange = editor.getSelection() ?? editor.getModel()?.getFullModelRange().collapseToEnd();\n\n\t\tif (!originalRange) {\n\t\t\tlogService.trace('InsertSearchResultAction: no selection');\n\t\t\treturn;\n\t\t}\n\n\t\tlet insertText = `#${AttachSearchResultAction.Name}`;\n\t\tconst varRange = new Range(originalRange.startLineNumber, originalRange.startColumn, originalRange.endLineNumber, originalRange.startLineNumber + insertText.length);\n\t\t// check character before the start of the range. If it's not a space, add a space\n\t\tconst model = editor.getModel();\n\t\tif (model && model.getValueInRange(new Range(originalRange.startLineNumber, originalRange.startColumn - 1, originalRange.startLineNumber, originalRange.startColumn)) !== ' ') {\n\t\t\tinsertText = ' ' + insertText;\n\t\t}\n\t\tconst success = editor.executeEdits('chatInsertSearch', [{ range: varRange, text: insertText + ' ' }]);\n\t\tif (!success) {\n\t\t\tlogService.trace(`InsertSearchResultAction: failed to insert \"${insertText}\"`);\n\t\t\treturn;\n\t\t}\n\t}\n}\n\n/** This is our type */\ninterface IContextPickItemItem extends IQuickPickItem {\n\tkind: 'contextPick';\n\titem: IChatContextValueItem | IChatContextPickerItem;\n}\n\n/** These are the types we get from \"platform QP\" */\ntype IQuickPickServicePickItem = IGotoSymbolQuickPickItem | ISymbolQuickPickItem | IQuickPickItemWithResource;\n\nfunction isIContextPickItemItem(obj: unknown): obj is IContextPickItemItem {\n\treturn (\n\t\tisObject(obj)\n\t\t&& typeof (<IContextPickItemItem>obj).kind === 'string'\n\t\t&& (<IContextPickItemItem>obj).kind === 'contextPick'\n\t);\n}\n\nfunction isIGotoSymbolQuickPickItem(obj: unknown): obj is IGotoSymbolQuickPickItem {\n\treturn (\n\t\tisObject(obj)\n\t\t&& typeof (obj as IGotoSymbolQuickPickItem).symbolName === 'string'\n\t\t&& !!(obj as IGotoSymbolQuickPickItem).uri\n\t\t&& !!(obj as IGotoSymbolQuickPickItem).range);\n}\n\nfunction isIQuickPickItemWithResource(obj: unknown): obj is IQuickPickItemWithResource {\n\treturn (\n\t\tisObject(obj)\n\t\t&& URI.isUri((obj as IQuickPickItemWithResource).resource));\n}\n\n\nexport class AttachContextAction extends Action2 {\n\n\tconstructor() {\n\t\tsuper({\n\t\t\tid: 'workbench.action.chat.attachContext',\n\t\t\ttitle: localize2('workbench.action.chat.attachContext.label.2', \"Add Context...\"),\n\t\t\ticon: Codicon.attach,\n\t\t\tcategory: CHAT_CATEGORY,\n\t\t\tkeybinding: {\n\t\t\t\twhen: ContextKeyExpr.and(ChatContextKeys.inChatInput, ChatContextKeys.location.isEqualTo(ChatAgentLocation.Chat)),\n\t\t\t\tprimary: KeyMod.CtrlCmd | KeyCode.Slash,\n\t\t\t\tweight: KeybindingWeight.EditorContrib\n\t\t\t},\n\t\t\tmenu: {\n\t\t\t\twhen: ContextKeyExpr.and(\n\t\t\t\t\tContextKeyExpr.or(\n\t\t\t\t\t\tChatContextKeys.location.isEqualTo(ChatAgentLocation.Chat),\n\t\t\t\t\t\tContextKeyExpr.and(ChatContextKeys.location.isEqualTo(ChatAgentLocation.EditorInline), CTX_INLINE_CHAT_V2_ENABLED)\n\t\t\t\t\t),\n\t\t\t\t\tContextKeyExpr.or(\n\t\t\t\t\t\tChatContextKeys.lockedToCodingAgent.negate(),\n\t\t\t\t\t\tChatContextKeys.agentSupportsAttachments\n\t\t\t\t\t)\n\t\t\t\t),\n\t\t\t\tid: MenuId.ChatInputAttachmentToolbar,\n\t\t\t\tgroup: 'navigation',\n\t\t\t\torder: 3\n\t\t\t},\n\n\t\t});\n\t}\n\n\toverride async run(accessor: ServicesAccessor, ...args: unknown[]): Promise<void> {\n\n\t\tconst instantiationService = accessor.get(IInstantiationService);\n\t\tconst widgetService = accessor.get(IChatWidgetService);\n\t\tconst contextKeyService = accessor.get(IContextKeyService);\n\t\tconst keybindingService = accessor.get(IKeybindingService);\n\t\tconst contextPickService = accessor.get(IChatContextPickService);\n\n\t\tconst context = args[0] as { widget?: IChatWidget; placeholder?: string } | undefined;\n\t\tconst widget = context?.widget ?? widgetService.lastFocusedWidget;\n\t\tif (!widget) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst quickPickItems: IContextPickItemItem[] = [];\n\n\t\tfor (const item of contextPickService.items) {\n\n\t\t\tif (item.isEnabled && !await item.isEnabled(widget)) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tquickPickItems.push({\n\t\t\t\tkind: 'contextPick',\n\t\t\t\titem,\n\t\t\t\tlabel: item.label,\n\t\t\t\ticonClass: ThemeIcon.asClassName(item.icon),\n\t\t\t\tkeybinding: item.commandId ? keybindingService.lookupKeybinding(item.commandId, contextKeyService) : undefined,\n\t\t\t});\n\t\t}\n\n\t\tinstantiationService.invokeFunction(this._show.bind(this), widget, quickPickItems, context?.placeholder);\n\t}\n\n\tprivate _show(accessor: ServicesAccessor, widget: IChatWidget, additionPicks: IContextPickItemItem[] | undefined, placeholder?: string) {\n\t\tconst quickInputService = accessor.get(IQuickInputService);\n\t\tconst quickChatService = accessor.get(IQuickChatService);\n\t\tconst instantiationService = accessor.get(IInstantiationService);\n\t\tconst commandService = accessor.get(ICommandService);\n\n\t\tconst providerOptions: AnythingQuickAccessProviderRunOptions = {\n\t\t\tfilter: (pick) => {\n\t\t\t\tif (isIQuickPickItemWithResource(pick) && pick.resource) {\n\t\t\t\t\treturn instantiationService.invokeFunction(accessor => isSupportedChatFileScheme(accessor, pick.resource!.scheme));\n\t\t\t\t}\n\t\t\t\treturn true;\n\t\t\t},\n\t\t\tadditionPicks,\n\t\t\thandleAccept: async (item: IQuickPickServicePickItem | IContextPickItemItem, isBackgroundAccept: boolean) => {\n\n\t\t\t\tif (isIContextPickItemItem(item)) {\n\n\t\t\t\t\tlet isDone = true;\n\t\t\t\t\tif (item.item.type === 'valuePick') {\n\t\t\t\t\t\tthis._handleContextPick(item.item, widget);\n\n\t\t\t\t\t} else if (item.item.type === 'pickerPick') {\n\t\t\t\t\t\tisDone = await this._handleContextPickerItem(quickInputService, commandService, item.item, widget);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!isDone) {\n\t\t\t\t\t\t// restart picker when sub-picker didn't return anything\n\t\t\t\t\t\tinstantiationService.invokeFunction(this._show.bind(this), widget, additionPicks, placeholder);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t} else {\n\t\t\t\t\tinstantiationService.invokeFunction(this._handleQPPick.bind(this), widget, isBackgroundAccept, item);\n\t\t\t\t}\n\t\t\t\tif (isQuickChat(widget)) {\n\t\t\t\t\tquickChatService.open();\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\tquickInputService.quickAccess.show('', {\n\t\t\tenabledProviderPrefixes: [\n\t\t\t\tAnythingQuickAccessProvider.PREFIX,\n\t\t\t\tSymbolsQuickAccessProvider.PREFIX,\n\t\t\t\tAbstractGotoSymbolQuickAccessProvider.PREFIX\n\t\t\t],\n\t\t\tplaceholder: placeholder ?? localize('chatContext.attach.placeholder', 'Search attachments'),\n\t\t\tproviderOptions,\n\t\t});\n\t}\n\n\tprivate async _handleQPPick(accessor: ServicesAccessor, widget: IChatWidget, isInBackground: boolean, pick: IQuickPickServicePickItem) {\n\t\tconst fileService = accessor.get(IFileService);\n\t\tconst textModelService = accessor.get(ITextModelService);\n\n\t\tconst toAttach: IChatRequestVariableEntry[] = [];\n\n\t\tif (isIQuickPickItemWithResource(pick) && pick.resource) {\n\t\t\tif (/\\.(png|jpg|jpeg|bmp|gif|tiff)$/i.test(pick.resource.path)) {\n\t\t\t\t// checks if the file is an image\n\t\t\t\tif (URI.isUri(pick.resource)) {\n\t\t\t\t\t// read the image and attach a new file context.\n\t\t\t\t\tconst readFile = await fileService.readFile(pick.resource);\n\t\t\t\t\tconst resizedImage = await resizeImage(readFile.value.buffer);\n\t\t\t\t\ttoAttach.push({\n\t\t\t\t\t\tid: pick.resource.toString(),\n\t\t\t\t\t\tname: pick.label,\n\t\t\t\t\t\tfullName: pick.label,\n\t\t\t\t\t\tvalue: resizedImage,\n\t\t\t\t\t\tkind: 'image',\n\t\t\t\t\t\treferences: [{ reference: pick.resource, kind: 'reference' }]\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tlet omittedState = OmittedState.NotOmitted;\n\t\t\t\ttry {\n\t\t\t\t\tconst createdModel = await textModelService.createModelReference(pick.resource);\n\t\t\t\t\tcreatedModel.dispose();\n\t\t\t\t} catch {\n\t\t\t\t\tomittedState = OmittedState.Full;\n\t\t\t\t}\n\n\t\t\t\ttoAttach.push({\n\t\t\t\t\tkind: 'file',\n\t\t\t\t\tid: pick.resource.toString(),\n\t\t\t\t\tvalue: pick.resource,\n\t\t\t\t\tname: pick.label,\n\t\t\t\t\tomittedState\n\t\t\t\t});\n\t\t\t}\n\t\t} else if (isIGotoSymbolQuickPickItem(pick) && pick.uri && pick.range) {\n\t\t\ttoAttach.push({\n\t\t\t\tkind: 'generic',\n\t\t\t\tid: JSON.stringify({ uri: pick.uri, range: pick.range.decoration }),\n\t\t\t\tvalue: { uri: pick.uri, range: pick.range.decoration },\n\t\t\t\tfullName: pick.label,\n\t\t\t\tname: pick.symbolName!,\n\t\t\t});\n\t\t}\n\n\n\t\twidget.attachmentModel.addContext(...toAttach);\n\n\t\tif (!isInBackground) {\n\t\t\t// Set focus back into the input once the user is done attaching items\n\t\t\t// so that the user can start typing their message\n\t\t\twidget.focusInput();\n\t\t}\n\t}\n\n\tprivate async _handleContextPick(item: IChatContextValueItem, widget: IChatWidget) {\n\n\t\tconst value = await item.asAttachment(widget);\n\t\tif (Array.isArray(value)) {\n\t\t\twidget.attachmentModel.addContext(...value);\n\t\t} else if (value) {\n\t\t\twidget.attachmentModel.addContext(value);\n\t\t}\n\t}\n\n\tprivate async _handleContextPickerItem(quickInputService: IQuickInputService, commandService: ICommandService, item: IChatContextPickerItem, widget: IChatWidget): Promise<boolean> {\n\n\t\tconst pickerConfig = item.asPicker(widget);\n\n\t\tconst store = new DisposableStore();\n\n\t\tconst goBackItem: IQuickPickItem = {\n\t\t\tlabel: localize('goBack', 'Go back â†©'),\n\t\t\talwaysShow: true\n\t\t};\n\t\tconst configureItem = pickerConfig.configure ? {\n\t\t\tlabel: pickerConfig.configure.label,\n\t\t\tcommandId: pickerConfig.configure.commandId,\n\t\t\talwaysShow: true\n\t\t} : undefined;\n\t\tconst extraPicks: QuickPickItem[] = [{ type: 'separator' }];\n\t\tif (configureItem) {\n\t\t\textraPicks.push(configureItem);\n\t\t}\n\t\textraPicks.push(goBackItem);\n\n\t\tconst qp = store.add(quickInputService.createQuickPick({ useSeparators: true }));\n\n\t\tconst cts = new CancellationTokenSource();\n\t\tstore.add(qp.onDidHide(() => cts.cancel()));\n\t\tstore.add(toDisposable(() => cts.dispose(true)));\n\n\t\tqp.placeholder = pickerConfig.placeholder;\n\t\tqp.matchOnDescription = true;\n\t\tqp.matchOnDetail = true;\n\t\t// qp.ignoreFocusOut = true;\n\t\tqp.canAcceptInBackground = true;\n\t\tqp.busy = true;\n\t\tqp.show();\n\n\t\tif (isThenable(pickerConfig.picks)) {\n\t\t\tconst items = await (pickerConfig.picks.then(value => {\n\t\t\t\treturn ([] as QuickPickItem[]).concat(value, extraPicks);\n\t\t\t}));\n\n\t\t\tqp.items = items;\n\t\t\tqp.busy = false;\n\t\t} else {\n\t\t\tconst query = observableValue<string>('attachContext.query', qp.value);\n\t\t\tstore.add(qp.onDidChangeValue(() => query.set(qp.value, undefined)));\n\n\t\t\tconst picksObservable = pickerConfig.picks(query, cts.token);\n\t\t\tstore.add(autorun(reader => {\n\t\t\t\tconst { busy, picks } = picksObservable.read(reader);\n\t\t\t\tqp.items = ([] as QuickPickItem[]).concat(picks, extraPicks);\n\t\t\t\tqp.busy = busy;\n\t\t\t}));\n\t\t}\n\n\t\tif (cts.token.isCancellationRequested) {\n\t\t\tpickerConfig.dispose?.();\n\t\t\treturn true; // picker got hidden already\n\t\t}\n\n\t\tconst defer = new DeferredPromise<boolean>();\n\t\tconst addPromises: Promise<void>[] = [];\n\n\t\tstore.add(qp.onDidAccept(async e => {\n\t\t\tconst noop = 'noop';\n\t\t\tconst [selected] = qp.selectedItems;\n\t\t\tif (isChatContextPickerPickItem(selected)) {\n\t\t\t\tconst attachment = selected.asAttachment();\n\t\t\t\tif (!attachment || attachment === noop) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tif (isThenable(attachment)) {\n\t\t\t\t\taddPromises.push(attachment.then(v => {\n\t\t\t\t\t\tif (v !== noop) {\n\t\t\t\t\t\t\twidget.attachmentModel.addContext(v);\n\t\t\t\t\t\t}\n\t\t\t\t\t}));\n\t\t\t\t} else {\n\t\t\t\t\twidget.attachmentModel.addContext(attachment);\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (selected === goBackItem) {\n\t\t\t\tif (pickerConfig.goBack?.()) {\n\t\t\t\t\t// Custom goBack handled the navigation, stay in the picker\n\t\t\t\t\treturn; // Don't complete, keep picker open\n\t\t\t\t}\n\t\t\t\t// Default behavior: go back to main picker\n\t\t\t\tdefer.complete(false);\n\t\t\t}\n\t\t\tif (selected === configureItem) {\n\t\t\t\tdefer.complete(true);\n\t\t\t\tcommandService.executeCommand(configureItem.commandId);\n\t\t\t}\n\t\t\tif (!e.inBackground) {\n\t\t\t\tdefer.complete(true);\n\t\t\t}\n\t\t}));\n\n\t\tstore.add(qp.onDidHide(() => {\n\t\t\tdefer.complete(true);\n\t\t\tpickerConfig.dispose?.();\n\t\t}));\n\n\t\ttry {\n\t\t\tconst result = await defer.p;\n\t\t\tqp.busy = true; // if still visible\n\t\t\tawait Promise.all(addPromises);\n\t\t\treturn result;\n\t\t} finally {\n\t\t\tstore.dispose();\n\t\t}\n\t}\n}\n"]}