{"version":3,"sources":["vs/workbench/contrib/chat/browser/promptSyntax/promptToolsCodeLensProvider.ts"],"names":[],"mappings":"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","file":"promptToolsCodeLensProvider.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { CancellationToken } from '../../../../../base/common/cancellation.js';\nimport { Disposable } from '../../../../../base/common/lifecycle.js';\nimport { generateUuid } from '../../../../../base/common/uuid.js';\nimport { CodeLens, CodeLensList, CodeLensProvider } from '../../../../../editor/common/languages.js';\nimport { isITextModel, ITextModel } from '../../../../../editor/common/model.js';\nimport { ILanguageFeaturesService } from '../../../../../editor/common/services/languageFeatures.js';\nimport { localize } from '../../../../../nls.js';\nimport { CommandsRegistry } from '../../../../../platform/commands/common/commands.js';\nimport { IInstantiationService } from '../../../../../platform/instantiation/common/instantiation.js';\nimport { showToolsPicker } from '../actions/chatToolPicker.js';\nimport { ILanguageModelToolsService } from '../../common/languageModelToolsService.js';\nimport { ALL_PROMPTS_LANGUAGE_SELECTOR, getPromptsTypeForLanguageId, PromptsType } from '../../common/promptSyntax/promptTypes.js';\nimport { IPromptsService } from '../../common/promptSyntax/service/promptsService.js';\nimport { registerEditorFeature } from '../../../../../editor/common/editorFeatures.js';\nimport { PromptFileRewriter } from './promptFileRewriter.js';\nimport { Range } from '../../../../../editor/common/core/range.js';\nimport { IEditorModel } from '../../../../../editor/common/editorCommon.js';\nimport { PromptHeaderAttributes } from '../../common/promptSyntax/promptFileParser.js';\nimport { isGithubTarget } from '../../common/promptSyntax/languageProviders/promptValidator.js';\n\nclass PromptToolsCodeLensProvider extends Disposable implements CodeLensProvider {\n\n\t// `_`-prefix marks this as private command\n\tprivate readonly cmdId = `_configure/${generateUuid()}`;\n\n\tconstructor(\n\t\t@IPromptsService private readonly promptsService: IPromptsService,\n\t\t@ILanguageFeaturesService private readonly languageService: ILanguageFeaturesService,\n\t\t@ILanguageModelToolsService private readonly languageModelToolsService: ILanguageModelToolsService,\n\t\t@IInstantiationService private readonly instantiationService: IInstantiationService\n\t) {\n\t\tsuper();\n\n\n\t\tthis._register(this.languageService.codeLensProvider.register(ALL_PROMPTS_LANGUAGE_SELECTOR, this));\n\n\t\tthis._register(CommandsRegistry.registerCommand(this.cmdId, (_accessor, ...args) => {\n\t\t\tconst [first, second, third, forth] = args;\n\t\t\tconst model = first as IEditorModel;\n\t\t\tif (isITextModel(model) && Range.isIRange(second) && Array.isArray(third) && (typeof forth === 'string' || forth === undefined)) {\n\t\t\t\tthis.updateTools(model as ITextModel, Range.lift(second), third, forth);\n\t\t\t}\n\t\t}));\n\t}\n\n\tasync provideCodeLenses(model: ITextModel, token: CancellationToken): Promise<undefined | CodeLensList> {\n\t\tconst promptType = getPromptsTypeForLanguageId(model.getLanguageId());\n\t\tif (!promptType || promptType === PromptsType.instructions) {\n\t\t\t// if the model is not a prompt, we don't provide any code actions\n\t\t\treturn undefined;\n\t\t}\n\n\t\tconst promptAST = this.promptsService.getParsedPromptFile(model);\n\t\tconst header = promptAST.header;\n\t\tif (!header) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\tif (isGithubTarget(promptType, header.target)) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\tconst toolsAttr = header.getAttribute(PromptHeaderAttributes.tools);\n\t\tif (!toolsAttr || toolsAttr.value.type !== 'array') {\n\t\t\treturn undefined;\n\t\t}\n\t\tconst items = toolsAttr.value.items;\n\t\tconst selectedTools = items.filter(item => item.type === 'string').map(item => item.value);\n\n\t\tconst codeLens: CodeLens = {\n\t\t\trange: toolsAttr.range.collapseToStart(),\n\t\t\tcommand: {\n\t\t\t\ttitle: localize('configure-tools.capitalized.ellipsis', \"Configure Tools...\"),\n\t\t\t\tid: this.cmdId,\n\t\t\t\targuments: [model, toolsAttr.value.range, selectedTools, header.target]\n\t\t\t}\n\t\t};\n\t\treturn { lenses: [codeLens] };\n\t}\n\n\tprivate async updateTools(model: ITextModel, range: Range, selectedTools: readonly string[], target: string | undefined): Promise<void> {\n\t\tconst selectedToolsNow = () => this.languageModelToolsService.toToolAndToolSetEnablementMap(selectedTools, target);\n\t\tconst newSelectedAfter = await this.instantiationService.invokeFunction(showToolsPicker, localize('placeholder', \"Select tools\"), undefined, selectedToolsNow);\n\t\tif (!newSelectedAfter) {\n\t\t\treturn;\n\t\t}\n\t\tawait this.instantiationService.createInstance(PromptFileRewriter).rewriteTools(model, newSelectedAfter, range);\n\t}\n}\n\nregisterEditorFeature(PromptToolsCodeLensProvider);\n"]}