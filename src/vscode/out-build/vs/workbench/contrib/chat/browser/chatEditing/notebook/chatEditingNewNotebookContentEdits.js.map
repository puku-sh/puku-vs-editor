{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/contrib/chat/browser/chatEditing/notebook/chatEditingNewNotebookContentEdits.ts","vs/workbench/contrib/chat/browser/chatEditing/notebook/chatEditingNewNotebookContentEdits.ts"],"names":[],"mappings":"AAAA;;;gGAGgG;;;;;;;;;;AAEhG,OAAO,EAAE,QAAQ,EAAE,MAAM,yCAAyC,CAAC;AAInE,OAAO,EAAE,gBAAgB,EAAE,MAAM,gDAAgD,CAAC;AAGlF;;;;;;;;;;GAUG;AACI,IAAM,kCAAkC,GAAxC,MAAM,kCAAkC;IAE9C,YACkB,QAA2B,EAC1B,gBAAmD;QADpD,aAAQ,GAAR,QAAQ,CAAmB;QACT,qBAAgB,GAAhB,gBAAgB,CAAkB;QAHrD,cAAS,GAAe,EAAE,CAAC;IAK5C,CAAC;IAED,eAAe,CAAC,KAAiB;QAChC,IAAI,KAAK,CAAC,MAAM,EAAE,CAAC;YAClB,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,GAAG,KAAK,CAAC,CAAC;QAC/B,CAAC;IACF,CAAC;IAED,KAAK,CAAC,aAAa;QAClB,IAAI,IAAI,CAAC,QAAQ,CAAC,KAAK,CAAC,MAAM,EAAE,CAAC;YAChC,OAAO,CAAC,KAAK,CAAC,4DAA4D,CAAC,CAAC;YAC5E,OAAO,EAAE,CAAC;QACX,CAAC;QACD,MAAM,OAAO,GAAG,IAAI,CAAC,eAAe,EAAE,CAAC;QACvC,IAAI,CAAC,OAAO,EAAE,CAAC;YACd,OAAO,EAAE,CAAC;QACX,CAAC;QAED,MAAM,aAAa,GAAyB,EAAE,CAAC;QAC/C,IAAI,CAAC;YACJ,MAAM,EAAE,UAAU,EAAE,GAAG,MAAM,IAAI,CAAC,gBAAgB,CAAC,wBAAwB,CAAC,IAAI,CAAC,QAAQ,CAAC,QAAQ,CAAC,CAAC;YACpG,MAAM,IAAI,GAAG,MAAM,UAAU,CAAC,cAAc,CAAC,QAAQ,CAAC,UAAU,CAAC,OAAO,CAAC,CAAC,CAAC;YAC3E,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,IAAI,CAAC,KAAK,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE,CAAC;gBAC5C,aAAa,CAAC,IAAI,CAAC;oBAClB,QAAQ,8BAAsB;oBAC9B,KAAK,EAAE,CAAC;oBACR,KAAK,EAAE,CAAC;oBACR,KAAK,EAAE,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC;iBACtB,CAAC,CAAC;YACJ,CAAC;QACF,CAAC;QAAC,OAAO,EAAE,EAAE,CAAC;YACb,OAAO,CAAC,KAAK,CAAC,qDAAqD,OAAO,EAAE,EAAE,EAAE,CAAC,CAAC;YAClF,OAAO,EAAE,CAAC;QACX,CAAC;QAED,OAAO,aAAa,CAAC;IACtB,CAAC;IAEO,eAAe;QACtB,IAAI,CAAC;YACJ,OAAO,cAAc,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC;QACvC,CAAC;QAAC,OAAO,EAAE,EAAE,CAAC;YACb,OAAO,CAAC,KAAK,CAAC,4CAA4C,EAAE,EAAE,CAAC,CAAC;YAChE,OAAO,EAAE,CAAC;QACX,CAAC;IACF,CAAC;CACD,CAAA;AApDY,kCAAkC;IAI5C,WAAA,gBAAgB,CAAA;GAJN,kCAAkC,CAoD9C;;AAED,SAAS,cAAc,CAAC,KAAiB;IACxC,IAAI,MAAM,GAAG,EAAE,CAAC;IAChB,KAAK,MAAM,IAAI,IAAI,KAAK,EAAE,CAAC;QAC1B,MAAM,GAAG,MAAM,CAAC,KAAK,CAAC,CAAC,EAAE,IAAI,CAAC,KAAK,CAAC,WAAW,CAAC;cAC7C,IAAI,CAAC,IAAI;cACT,MAAM,CAAC,KAAK,CAAC,IAAI,CAAC,KAAK,CAAC,SAAS,CAAC,CAAC;IACvC,CAAC;IACD,OAAO,MAAM,CAAC;AACf,CAAC","file":"chatEditingNewNotebookContentEdits.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { VSBuffer } from '../../../../../../base/common/buffer.js';\nimport { TextEdit } from '../../../../../../editor/common/languages.js';\nimport { NotebookTextModel } from '../../../../notebook/common/model/notebookTextModel.js';\nimport { CellEditType, ICellEditOperation } from '../../../../notebook/common/notebookCommon.js';\nimport { INotebookService } from '../../../../notebook/common/notebookService.js';\n\n\n/**\n * When asking LLM to generate a new notebook, LLM might end up generating the notebook\n * using the raw file format.\n * E.g. assume we ask LLM to generate a new Github Issues notebook, LLM might end up\n * genrating the notebook using the JSON format of github issues file.\n * Such a format is not known to copilot extension and those are sent over as regular\n * text edits for the Notebook URI.\n *\n * In such cases we should accumulate all of the edits, generate the content and deserialize the content\n * into a notebook, then generate notebooke edits to insert these cells.\n */\nexport class ChatEditingNewNotebookContentEdits {\n\tprivate readonly textEdits: TextEdit[] = [];\n\tconstructor(\n\t\tprivate readonly notebook: NotebookTextModel,\n\t\t@INotebookService private readonly _notebookService: INotebookService,\n\t) {\n\t}\n\n\tacceptTextEdits(edits: TextEdit[]): void {\n\t\tif (edits.length) {\n\t\t\tthis.textEdits.push(...edits);\n\t\t}\n\t}\n\n\tasync generateEdits(): Promise<ICellEditOperation[]> {\n\t\tif (this.notebook.cells.length) {\n\t\t\tconsole.error(`Notebook edits not generated as notebook already has cells`);\n\t\t\treturn [];\n\t\t}\n\t\tconst content = this.generateContent();\n\t\tif (!content) {\n\t\t\treturn [];\n\t\t}\n\n\t\tconst notebookEdits: ICellEditOperation[] = [];\n\t\ttry {\n\t\t\tconst { serializer } = await this._notebookService.withNotebookDataProvider(this.notebook.viewType);\n\t\t\tconst data = await serializer.dataToNotebook(VSBuffer.fromString(content));\n\t\t\tfor (let i = 0; i < data.cells.length; i++) {\n\t\t\t\tnotebookEdits.push({\n\t\t\t\t\teditType: CellEditType.Replace,\n\t\t\t\t\tindex: i,\n\t\t\t\t\tcount: 0,\n\t\t\t\t\tcells: [data.cells[i]]\n\t\t\t\t});\n\t\t\t}\n\t\t} catch (ex) {\n\t\t\tconsole.error(`Failed to generate notebook edits from text edits ${content}`, ex);\n\t\t\treturn [];\n\t\t}\n\n\t\treturn notebookEdits;\n\t}\n\n\tprivate generateContent() {\n\t\ttry {\n\t\t\treturn applyTextEdits(this.textEdits);\n\t\t} catch (ex) {\n\t\t\tconsole.error('Failed to generate content from text edits', ex);\n\t\t\treturn '';\n\t\t}\n\t}\n}\n\nfunction applyTextEdits(edits: TextEdit[]): string {\n\tlet output = '';\n\tfor (const edit of edits) {\n\t\toutput = output.slice(0, edit.range.startColumn)\n\t\t\t+ edit.text\n\t\t\t+ output.slice(edit.range.endColumn);\n\t}\n\treturn output;\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { VSBuffer } from '../../../../../../base/common/buffer.js';\nimport { TextEdit } from '../../../../../../editor/common/languages.js';\nimport { NotebookTextModel } from '../../../../notebook/common/model/notebookTextModel.js';\nimport { CellEditType, ICellEditOperation } from '../../../../notebook/common/notebookCommon.js';\nimport { INotebookService } from '../../../../notebook/common/notebookService.js';\n\n\n/**\n * When asking LLM to generate a new notebook, LLM might end up generating the notebook\n * using the raw file format.\n * E.g. assume we ask LLM to generate a new Github Issues notebook, LLM might end up\n * genrating the notebook using the JSON format of github issues file.\n * Such a format is not known to copilot extension and those are sent over as regular\n * text edits for the Notebook URI.\n *\n * In such cases we should accumulate all of the edits, generate the content and deserialize the content\n * into a notebook, then generate notebooke edits to insert these cells.\n */\nexport class ChatEditingNewNotebookContentEdits {\n\tprivate readonly textEdits: TextEdit[] = [];\n\tconstructor(\n\t\tprivate readonly notebook: NotebookTextModel,\n\t\t@INotebookService private readonly _notebookService: INotebookService,\n\t) {\n\t}\n\n\tacceptTextEdits(edits: TextEdit[]): void {\n\t\tif (edits.length) {\n\t\t\tthis.textEdits.push(...edits);\n\t\t}\n\t}\n\n\tasync generateEdits(): Promise<ICellEditOperation[]> {\n\t\tif (this.notebook.cells.length) {\n\t\t\tconsole.error(`Notebook edits not generated as notebook already has cells`);\n\t\t\treturn [];\n\t\t}\n\t\tconst content = this.generateContent();\n\t\tif (!content) {\n\t\t\treturn [];\n\t\t}\n\n\t\tconst notebookEdits: ICellEditOperation[] = [];\n\t\ttry {\n\t\t\tconst { serializer } = await this._notebookService.withNotebookDataProvider(this.notebook.viewType);\n\t\t\tconst data = await serializer.dataToNotebook(VSBuffer.fromString(content));\n\t\t\tfor (let i = 0; i < data.cells.length; i++) {\n\t\t\t\tnotebookEdits.push({\n\t\t\t\t\teditType: CellEditType.Replace,\n\t\t\t\t\tindex: i,\n\t\t\t\t\tcount: 0,\n\t\t\t\t\tcells: [data.cells[i]]\n\t\t\t\t});\n\t\t\t}\n\t\t} catch (ex) {\n\t\t\tconsole.error(`Failed to generate notebook edits from text edits ${content}`, ex);\n\t\t\treturn [];\n\t\t}\n\n\t\treturn notebookEdits;\n\t}\n\n\tprivate generateContent() {\n\t\ttry {\n\t\t\treturn applyTextEdits(this.textEdits);\n\t\t} catch (ex) {\n\t\t\tconsole.error('Failed to generate content from text edits', ex);\n\t\t\treturn '';\n\t\t}\n\t}\n}\n\nfunction applyTextEdits(edits: TextEdit[]): string {\n\tlet output = '';\n\tfor (const edit of edits) {\n\t\toutput = output.slice(0, edit.range.startColumn)\n\t\t\t+ edit.text\n\t\t\t+ output.slice(edit.range.endColumn);\n\t}\n\treturn output;\n}\n"]}