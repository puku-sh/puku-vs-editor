{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/contrib/chat/browser/contrib/chatInputEditorContrib.ts","vs/workbench/contrib/chat/browser/contrib/chatInputEditorContrib.ts"],"names":[],"mappings":"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","file":"chatInputEditorContrib.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { MarkdownString } from '../../../../../base/common/htmlContent.js';\nimport { Disposable, MutableDisposable, toDisposable } from '../../../../../base/common/lifecycle.js';\nimport { autorun } from '../../../../../base/common/observable.js';\nimport { themeColorFromId } from '../../../../../base/common/themables.js';\nimport { URI } from '../../../../../base/common/uri.js';\nimport { ICodeEditorService } from '../../../../../editor/browser/services/codeEditorService.js';\nimport { Range } from '../../../../../editor/common/core/range.js';\nimport { IDecorationOptions } from '../../../../../editor/common/editorCommon.js';\nimport { TrackedRangeStickiness } from '../../../../../editor/common/model.js';\nimport { IInstantiationService } from '../../../../../platform/instantiation/common/instantiation.js';\nimport { ILabelService } from '../../../../../platform/label/common/label.js';\nimport { inputPlaceholderForeground } from '../../../../../platform/theme/common/colorRegistry.js';\nimport { IThemeService } from '../../../../../platform/theme/common/themeService.js';\nimport { IChatAgentCommand, IChatAgentData, IChatAgentService } from '../../common/chatAgents.js';\nimport { chatSlashCommandBackground, chatSlashCommandForeground } from '../../common/chatColors.js';\nimport { ChatRequestAgentPart, ChatRequestAgentSubcommandPart, ChatRequestDynamicVariablePart, ChatRequestSlashCommandPart, ChatRequestSlashPromptPart, ChatRequestTextPart, ChatRequestToolPart, ChatRequestToolSetPart, IParsedChatRequestPart, chatAgentLeader, chatSubcommandLeader } from '../../common/chatParserTypes.js';\nimport { ChatRequestParser } from '../../common/chatRequestParser.js';\nimport { IPromptsService } from '../../common/promptSyntax/service/promptsService.js';\nimport { IChatWidget } from '../chat.js';\nimport { ChatWidget } from '../chatWidget.js';\nimport { dynamicVariableDecorationType } from './chatDynamicVariables.js';\nimport { NativeEditContextRegistry } from '../../../../../editor/browser/controller/editContext/native/nativeEditContextRegistry.js';\nimport { CancellationToken } from '../../../../../base/common/cancellation.js';\nimport { ThrottledDelayer } from '../../../../../base/common/async.js';\n\nconst decorationDescription = 'chat';\nconst placeholderDecorationType = 'chat-session-detail';\nconst slashCommandTextDecorationType = 'chat-session-text';\nconst variableTextDecorationType = 'chat-variable-text';\n\nfunction agentAndCommandToKey(agent: IChatAgentData, subcommand: string | undefined): string {\n\treturn subcommand ? `${agent.id}__${subcommand}` : agent.id;\n}\n\nfunction isWhitespaceOrPromptPart(p: IParsedChatRequestPart): boolean {\n\treturn (p instanceof ChatRequestTextPart && !p.text.trim().length) || (p instanceof ChatRequestSlashPromptPart);\n}\n\nfunction exactlyOneSpaceAfterPart(parsedRequest: readonly IParsedChatRequestPart[], part: IParsedChatRequestPart): boolean {\n\tconst partIdx = parsedRequest.indexOf(part);\n\tif (parsedRequest.length > partIdx + 2) {\n\t\treturn false;\n\t}\n\n\tconst nextPart = parsedRequest[partIdx + 1];\n\treturn nextPart && nextPart instanceof ChatRequestTextPart && nextPart.text === ' ';\n}\n\nfunction getRangeForPlaceholder(part: IParsedChatRequestPart) {\n\treturn {\n\t\tstartLineNumber: part.editorRange.startLineNumber,\n\t\tendLineNumber: part.editorRange.endLineNumber,\n\t\tstartColumn: part.editorRange.endColumn + 1,\n\t\tendColumn: 1000\n\t};\n}\n\nclass InputEditorDecorations extends Disposable {\n\n\tprivate static readonly UPDATE_DELAY = 200;\n\n\tpublic readonly id = 'inputEditorDecorations';\n\n\tprivate readonly previouslyUsedAgents = new Set<string>();\n\n\tprivate readonly viewModelDisposables = this._register(new MutableDisposable());\n\n\n\tprivate readonly updateThrottle = this._register(new ThrottledDelayer<void>(InputEditorDecorations.UPDATE_DELAY));\n\n\tconstructor(\n\t\tprivate readonly widget: IChatWidget,\n\t\t@ICodeEditorService private readonly codeEditorService: ICodeEditorService,\n\t\t@IThemeService private readonly themeService: IThemeService,\n\t\t@IChatAgentService private readonly chatAgentService: IChatAgentService,\n\t\t@ILabelService private readonly labelService: ILabelService,\n\t\t@IPromptsService private readonly promptsService: IPromptsService,\n\t) {\n\t\tsuper();\n\n\t\tthis.codeEditorService.registerDecorationType(decorationDescription, placeholderDecorationType, {});\n\n\t\tthis.registeredDecorationTypes();\n\n\t\tthis.triggerInputEditorDecorationsUpdate();\n\t\tthis._register(this.widget.inputEditor.onDidChangeModelContent(() => this.triggerInputEditorDecorationsUpdate()));\n\t\tthis._register(this.widget.onDidChangeParsedInput(() => this.triggerInputEditorDecorationsUpdate()));\n\t\tthis._register(this.widget.onDidChangeViewModel(() => {\n\t\t\tthis.registerViewModelListeners();\n\t\t\tthis.previouslyUsedAgents.clear();\n\t\t\tthis.triggerInputEditorDecorationsUpdate();\n\t\t}));\n\t\tthis._register(this.widget.onDidSubmitAgent((e) => {\n\t\t\tthis.previouslyUsedAgents.add(agentAndCommandToKey(e.agent, e.slashCommand?.name));\n\t\t}));\n\t\tthis._register(this.chatAgentService.onDidChangeAgents(() => this.triggerInputEditorDecorationsUpdate()));\n\t\tthis._register(this.promptsService.onDidChangeSlashCommands(() => this.triggerInputEditorDecorationsUpdate()));\n\t\tthis._register(autorun(reader => {\n\t\t\t// Watch for changes to the current mode and its properties\n\t\t\tconst currentMode = this.widget.input.currentModeObs.read(reader);\n\t\t\tif (currentMode) {\n\t\t\t\t// Also watch the mode's description to react to any changes\n\t\t\t\tcurrentMode.description.read(reader);\n\t\t\t}\n\t\t\t// Trigger decoration update when mode or its properties change\n\t\t\tthis.triggerInputEditorDecorationsUpdate();\n\t\t}));\n\n\t\tthis.registerViewModelListeners();\n\t}\n\n\tprivate registerViewModelListeners(): void {\n\t\tthis.viewModelDisposables.value = this.widget.viewModel?.onDidChange(e => {\n\t\t\tif (e?.kind === 'changePlaceholder' || e?.kind === 'initialize') {\n\t\t\t\tthis.triggerInputEditorDecorationsUpdate();\n\t\t\t}\n\t\t});\n\t}\n\n\tprivate registeredDecorationTypes() {\n\n\t\tthis.codeEditorService.registerDecorationType(decorationDescription, slashCommandTextDecorationType, {\n\t\t\tcolor: themeColorFromId(chatSlashCommandForeground),\n\t\t\tbackgroundColor: themeColorFromId(chatSlashCommandBackground),\n\t\t\tborderRadius: '3px'\n\t\t});\n\t\tthis.codeEditorService.registerDecorationType(decorationDescription, variableTextDecorationType, {\n\t\t\tcolor: themeColorFromId(chatSlashCommandForeground),\n\t\t\tbackgroundColor: themeColorFromId(chatSlashCommandBackground),\n\t\t\tborderRadius: '3px'\n\t\t});\n\t\tthis.codeEditorService.registerDecorationType(decorationDescription, dynamicVariableDecorationType, {\n\t\t\tcolor: themeColorFromId(chatSlashCommandForeground),\n\t\t\tbackgroundColor: themeColorFromId(chatSlashCommandBackground),\n\t\t\tborderRadius: '3px',\n\t\t\trangeBehavior: TrackedRangeStickiness.NeverGrowsWhenTypingAtEdges\n\t\t});\n\n\t\tthis._register(toDisposable(() => {\n\t\t\tthis.codeEditorService.removeDecorationType(variableTextDecorationType);\n\t\t\tthis.codeEditorService.removeDecorationType(dynamicVariableDecorationType);\n\t\t\tthis.codeEditorService.removeDecorationType(slashCommandTextDecorationType);\n\t\t}));\n\t}\n\n\tprivate getPlaceholderColor(): string | undefined {\n\t\tconst theme = this.themeService.getColorTheme();\n\t\tconst transparentForeground = theme.getColor(inputPlaceholderForeground);\n\t\treturn transparentForeground?.toString();\n\t}\n\n\tprivate triggerInputEditorDecorationsUpdate(): void {\n\t\t// update placeholder decorations immediately, in sync\n\t\tthis.updateInputPlaceholderDecoration();\n\n\t\t// with a delay, update the rest of the decorations\n\t\tthis.updateThrottle.trigger(token => this.updateAsyncInputEditorDecorations(token));\n\t}\n\n\tprivate updateInputPlaceholderDecoration(): void {\n\t\tconst inputValue = this.widget.inputEditor.getValue();\n\n\t\tconst viewModel = this.widget.viewModel;\n\t\tif (!viewModel) {\n\t\t\tthis.updateAriaPlaceholder(undefined);\n\t\t\treturn;\n\t\t}\n\n\t\tif (!inputValue) {\n\t\t\tconst mode = this.widget.input.currentModeObs.get();\n\t\t\tconst placeholder = mode.argumentHint?.get() ?? mode.description.get() ?? '';\n\t\t\tconst displayPlaceholder = viewModel.inputPlaceholder || placeholder;\n\n\t\t\tconst decoration: IDecorationOptions[] = [\n\t\t\t\t{\n\t\t\t\t\trange: {\n\t\t\t\t\t\tstartLineNumber: 1,\n\t\t\t\t\t\tendLineNumber: 1,\n\t\t\t\t\t\tstartColumn: 1,\n\t\t\t\t\t\tendColumn: 1000\n\t\t\t\t\t},\n\t\t\t\t\trenderOptions: {\n\t\t\t\t\t\tafter: {\n\t\t\t\t\t\t\tcontentText: displayPlaceholder,\n\t\t\t\t\t\t\tcolor: this.getPlaceholderColor()\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t];\n\t\t\tthis.updateAriaPlaceholder(displayPlaceholder || undefined);\n\t\t\tthis.widget.inputEditor.setDecorationsByType(decorationDescription, placeholderDecorationType, decoration);\n\t\t\treturn;\n\t\t}\n\n\t\tthis.updateAriaPlaceholder(undefined);\n\n\t\tconst parsedRequest = this.widget.parsedInput.parts;\n\n\t\tlet placeholderDecoration: IDecorationOptions[] | undefined;\n\t\tconst agentPart = parsedRequest.find((p): p is ChatRequestAgentPart => p instanceof ChatRequestAgentPart);\n\t\tconst agentSubcommandPart = parsedRequest.find((p): p is ChatRequestAgentSubcommandPart => p instanceof ChatRequestAgentSubcommandPart);\n\n\t\tconst onlyAgentAndWhitespace = agentPart && parsedRequest.every(p => p instanceof ChatRequestTextPart && !p.text.trim().length || p instanceof ChatRequestAgentPart);\n\t\tif (onlyAgentAndWhitespace) {\n\t\t\t// Agent reference with no other text - show the placeholder\n\t\t\tconst isFollowupSlashCommand = this.previouslyUsedAgents.has(agentAndCommandToKey(agentPart.agent, undefined));\n\t\t\tconst shouldRenderFollowupPlaceholder = isFollowupSlashCommand && agentPart.agent.metadata.followupPlaceholder;\n\t\t\tif (agentPart.agent.description && exactlyOneSpaceAfterPart(parsedRequest, agentPart)) {\n\t\t\t\tplaceholderDecoration = [{\n\t\t\t\t\trange: getRangeForPlaceholder(agentPart),\n\t\t\t\t\trenderOptions: {\n\t\t\t\t\t\tafter: {\n\t\t\t\t\t\t\tcontentText: shouldRenderFollowupPlaceholder ? agentPart.agent.metadata.followupPlaceholder : agentPart.agent.description,\n\t\t\t\t\t\t\tcolor: this.getPlaceholderColor(),\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}];\n\t\t\t}\n\t\t}\n\n\t\tconst onlyAgentAndAgentCommandAndWhitespace = agentPart && agentSubcommandPart && parsedRequest.every(p => p instanceof ChatRequestTextPart && !p.text.trim().length || p instanceof ChatRequestAgentPart || p instanceof ChatRequestAgentSubcommandPart);\n\t\tif (onlyAgentAndAgentCommandAndWhitespace) {\n\t\t\t// Agent reference and subcommand with no other text - show the placeholder\n\t\t\tconst isFollowupSlashCommand = this.previouslyUsedAgents.has(agentAndCommandToKey(agentPart.agent, agentSubcommandPart.command.name));\n\t\t\tconst shouldRenderFollowupPlaceholder = isFollowupSlashCommand && agentSubcommandPart.command.followupPlaceholder;\n\t\t\tif (agentSubcommandPart?.command.description && exactlyOneSpaceAfterPart(parsedRequest, agentSubcommandPart)) {\n\t\t\t\tplaceholderDecoration = [{\n\t\t\t\t\trange: getRangeForPlaceholder(agentSubcommandPart),\n\t\t\t\t\trenderOptions: {\n\t\t\t\t\t\tafter: {\n\t\t\t\t\t\t\tcontentText: shouldRenderFollowupPlaceholder ? agentSubcommandPart.command.followupPlaceholder : agentSubcommandPart.command.description,\n\t\t\t\t\t\t\tcolor: this.getPlaceholderColor(),\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}];\n\t\t\t}\n\t\t}\n\n\t\tconst onlyAgentCommandAndWhitespace = agentSubcommandPart && parsedRequest.every(p => p instanceof ChatRequestTextPart && !p.text.trim().length || p instanceof ChatRequestAgentSubcommandPart);\n\t\tif (onlyAgentCommandAndWhitespace) {\n\t\t\t// Agent subcommand with no other text - show the placeholder\n\t\t\tif (agentSubcommandPart?.command.description && exactlyOneSpaceAfterPart(parsedRequest, agentSubcommandPart)) {\n\t\t\t\tplaceholderDecoration = [{\n\t\t\t\t\trange: getRangeForPlaceholder(agentSubcommandPart),\n\t\t\t\t\trenderOptions: {\n\t\t\t\t\t\tafter: {\n\t\t\t\t\t\t\tcontentText: agentSubcommandPart.command.description,\n\t\t\t\t\t\t\tcolor: this.getPlaceholderColor(),\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}];\n\t\t\t}\n\t\t}\n\t\tthis.widget.inputEditor.setDecorationsByType(decorationDescription, placeholderDecorationType, placeholderDecoration ?? []);\n\t}\n\n\tprivate async updateAsyncInputEditorDecorations(token: CancellationToken): Promise<void> {\n\n\t\tconst parsedRequest = this.widget.parsedInput.parts;\n\n\t\tconst agentPart = parsedRequest.find((p): p is ChatRequestAgentPart => p instanceof ChatRequestAgentPart);\n\t\tconst agentSubcommandPart = parsedRequest.find((p): p is ChatRequestAgentSubcommandPart => p instanceof ChatRequestAgentSubcommandPart);\n\t\tconst slashCommandPart = parsedRequest.find((p): p is ChatRequestSlashCommandPart => p instanceof ChatRequestSlashCommandPart);\n\t\tconst slashPromptPart = parsedRequest.find((p): p is ChatRequestSlashPromptPart => p instanceof ChatRequestSlashPromptPart);\n\n\t\t// first, fetch all async context\n\t\tconst promptSlashCommand = slashPromptPart ? await this.promptsService.resolvePromptSlashCommand(slashPromptPart.name, token) : undefined;\n\t\tif (token.isCancellationRequested) {\n\t\t\t// a new update came in while we were waiting\n\t\t\treturn;\n\t\t}\n\n\t\tif (slashPromptPart && promptSlashCommand) {\n\t\t\tconst onlyPromptCommandAndWhitespace = slashPromptPart && parsedRequest.every(isWhitespaceOrPromptPart);\n\t\t\tif (onlyPromptCommandAndWhitespace && exactlyOneSpaceAfterPart(parsedRequest, slashPromptPart) && promptSlashCommand) {\n\t\t\t\tconst description = promptSlashCommand.argumentHint ?? promptSlashCommand.description;\n\t\t\t\tif (description) {\n\t\t\t\t\tthis.widget.inputEditor.setDecorationsByType(decorationDescription, placeholderDecorationType, [{\n\t\t\t\t\t\trange: getRangeForPlaceholder(slashPromptPart),\n\t\t\t\t\t\trenderOptions: {\n\t\t\t\t\t\t\tafter: {\n\t\t\t\t\t\t\t\tcontentText: description,\n\t\t\t\t\t\t\t\tcolor: this.getPlaceholderColor(),\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}]);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tconst textDecorations: IDecorationOptions[] | undefined = [];\n\t\tif (agentPart) {\n\t\t\ttextDecorations.push({ range: agentPart.editorRange });\n\t\t}\n\t\tif (agentSubcommandPart) {\n\t\t\ttextDecorations.push({ range: agentSubcommandPart.editorRange, hoverMessage: new MarkdownString(agentSubcommandPart.command.description) });\n\t\t}\n\n\t\tif (slashCommandPart) {\n\t\t\ttextDecorations.push({ range: slashCommandPart.editorRange });\n\t\t}\n\n\t\tif (slashPromptPart && promptSlashCommand) {\n\t\t\ttextDecorations.push({ range: slashPromptPart.editorRange });\n\t\t}\n\n\t\tthis.widget.inputEditor.setDecorationsByType(decorationDescription, slashCommandTextDecorationType, textDecorations);\n\n\t\tconst varDecorations: IDecorationOptions[] = [];\n\t\tconst toolParts = parsedRequest.filter((p): p is ChatRequestToolPart => p instanceof ChatRequestToolPart || p instanceof ChatRequestToolSetPart);\n\t\tfor (const tool of toolParts) {\n\t\t\tvarDecorations.push({ range: tool.editorRange });\n\t\t}\n\n\t\tconst dynamicVariableParts = parsedRequest.filter((p): p is ChatRequestDynamicVariablePart => p instanceof ChatRequestDynamicVariablePart);\n\n\t\tconst isEditingPreviousRequest = !!this.widget.viewModel?.editing;\n\t\tif (isEditingPreviousRequest) {\n\t\t\tfor (const variable of dynamicVariableParts) {\n\t\t\t\tvarDecorations.push({ range: variable.editorRange, hoverMessage: URI.isUri(variable.data) ? new MarkdownString(this.labelService.getUriLabel(variable.data, { relative: true })) : undefined });\n\t\t\t}\n\t\t}\n\n\t\tthis.widget.inputEditor.setDecorationsByType(decorationDescription, variableTextDecorationType, varDecorations);\n\t}\n\n\tprivate updateAriaPlaceholder(value: string | undefined): void {\n\t\tconst nativeEditContext = NativeEditContextRegistry.get(this.widget.inputEditor.getId());\n\t\tconst domNode = nativeEditContext?.domNode.domNode;\n\t\tif (!domNode) {\n\t\t\treturn;\n\t\t}\n\t\tif (value && value.trim().length) {\n\t\t\tdomNode.setAttribute('aria-placeholder', value);\n\t\t} else {\n\t\t\tdomNode.removeAttribute('aria-placeholder');\n\t\t}\n\t}\n}\n\nclass InputEditorSlashCommandMode extends Disposable {\n\tpublic readonly id = 'InputEditorSlashCommandMode';\n\n\tconstructor(\n\t\tprivate readonly widget: IChatWidget\n\t) {\n\t\tsuper();\n\t\tthis._register(this.widget.onDidChangeAgent(e => {\n\t\t\tif (e.slashCommand && e.slashCommand.isSticky || !e.slashCommand && e.agent.metadata.isSticky) {\n\t\t\t\tthis.repopulateAgentCommand(e.agent, e.slashCommand);\n\t\t\t}\n\t\t}));\n\t\tthis._register(this.widget.onDidSubmitAgent(e => {\n\t\t\tthis.repopulateAgentCommand(e.agent, e.slashCommand);\n\t\t}));\n\t}\n\n\tprivate async repopulateAgentCommand(agent: IChatAgentData, slashCommand: IChatAgentCommand | undefined) {\n\t\t// Make sure we don't repopulate if the user already has something in the input\n\t\tif (this.widget.inputEditor.getValue().trim()) {\n\t\t\treturn;\n\t\t}\n\n\t\tlet value: string | undefined;\n\t\tif (slashCommand && slashCommand.isSticky) {\n\t\t\tvalue = `${chatAgentLeader}${agent.name} ${chatSubcommandLeader}${slashCommand.name} `;\n\t\t} else if (agent.metadata.isSticky) {\n\t\t\tvalue = `${chatAgentLeader}${agent.name} `;\n\t\t}\n\n\t\tif (value) {\n\t\t\tthis.widget.inputEditor.setValue(value);\n\t\t\tthis.widget.inputEditor.setPosition({ lineNumber: 1, column: value.length + 1 });\n\t\t}\n\t}\n}\n\nChatWidget.CONTRIBS.push(InputEditorDecorations, InputEditorSlashCommandMode);\n\nclass ChatTokenDeleter extends Disposable {\n\n\tpublic readonly id = 'chatTokenDeleter';\n\n\tconstructor(\n\t\tprivate readonly widget: IChatWidget,\n\t\t@IInstantiationService private readonly instantiationService: IInstantiationService,\n\t) {\n\t\tsuper();\n\t\tconst parser = this.instantiationService.createInstance(ChatRequestParser);\n\t\tconst inputValue = this.widget.inputEditor.getValue();\n\t\tlet previousInputValue: string | undefined;\n\t\tlet previousSelectedAgent: IChatAgentData | undefined;\n\n\t\t// A simple heuristic to delete the previous token when the user presses backspace.\n\t\t// The sophisticated way to do this would be to have a parse tree that can be updated incrementally.\n\t\tthis._register(this.widget.inputEditor.onDidChangeModelContent(e => {\n\t\t\tif (!previousInputValue) {\n\t\t\t\tpreviousInputValue = inputValue;\n\t\t\t\tpreviousSelectedAgent = this.widget.lastSelectedAgent;\n\t\t\t}\n\n\t\t\t// Don't try to handle multicursor edits right now\n\t\t\tconst change = e.changes[0];\n\n\t\t\t// If this was a simple delete, try to find out whether it was inside a token\n\t\t\tif (!change.text && this.widget.viewModel) {\n\t\t\t\tconst previousParsedValue = parser.parseChatRequest(this.widget.viewModel.sessionResource, previousInputValue, widget.location, { selectedAgent: previousSelectedAgent, mode: this.widget.input.currentModeKind });\n\n\t\t\t\t// For dynamic variables, this has to happen in ChatDynamicVariableModel with the other bookkeeping\n\t\t\t\tconst deletableTokens = previousParsedValue.parts.filter(p => p instanceof ChatRequestAgentPart || p instanceof ChatRequestAgentSubcommandPart || p instanceof ChatRequestSlashCommandPart || p instanceof ChatRequestSlashPromptPart || p instanceof ChatRequestToolPart);\n\t\t\t\tdeletableTokens.forEach(token => {\n\t\t\t\t\tconst deletedRangeOfToken = Range.intersectRanges(token.editorRange, change.range);\n\t\t\t\t\t// Part of this token was deleted, or the space after it was deleted, and the deletion range doesn't go off the front of the token, for simpler math\n\t\t\t\t\tif (deletedRangeOfToken && Range.compareRangesUsingStarts(token.editorRange, change.range) < 0) {\n\t\t\t\t\t\t// Assume single line tokens\n\t\t\t\t\t\tconst length = deletedRangeOfToken.endColumn - deletedRangeOfToken.startColumn;\n\t\t\t\t\t\tconst rangeToDelete = new Range(token.editorRange.startLineNumber, token.editorRange.startColumn, token.editorRange.endLineNumber, token.editorRange.endColumn - length);\n\t\t\t\t\t\tthis.widget.inputEditor.executeEdits(this.id, [{\n\t\t\t\t\t\t\trange: rangeToDelete,\n\t\t\t\t\t\t\ttext: '',\n\t\t\t\t\t\t}]);\n\t\t\t\t\t\tthis.widget.refreshParsedInput();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tpreviousInputValue = this.widget.inputEditor.getValue();\n\t\t\tpreviousSelectedAgent = this.widget.lastSelectedAgent;\n\t\t}));\n\t}\n}\nChatWidget.CONTRIBS.push(ChatTokenDeleter);\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { MarkdownString } from '../../../../../base/common/htmlContent.js';\nimport { Disposable, MutableDisposable, toDisposable } from '../../../../../base/common/lifecycle.js';\nimport { autorun } from '../../../../../base/common/observable.js';\nimport { themeColorFromId } from '../../../../../base/common/themables.js';\nimport { URI } from '../../../../../base/common/uri.js';\nimport { ICodeEditorService } from '../../../../../editor/browser/services/codeEditorService.js';\nimport { Range } from '../../../../../editor/common/core/range.js';\nimport { IDecorationOptions } from '../../../../../editor/common/editorCommon.js';\nimport { TrackedRangeStickiness } from '../../../../../editor/common/model.js';\nimport { IInstantiationService } from '../../../../../platform/instantiation/common/instantiation.js';\nimport { ILabelService } from '../../../../../platform/label/common/label.js';\nimport { inputPlaceholderForeground } from '../../../../../platform/theme/common/colorRegistry.js';\nimport { IThemeService } from '../../../../../platform/theme/common/themeService.js';\nimport { IChatAgentCommand, IChatAgentData, IChatAgentService } from '../../common/chatAgents.js';\nimport { chatSlashCommandBackground, chatSlashCommandForeground } from '../../common/chatColors.js';\nimport { ChatRequestAgentPart, ChatRequestAgentSubcommandPart, ChatRequestDynamicVariablePart, ChatRequestSlashCommandPart, ChatRequestSlashPromptPart, ChatRequestTextPart, ChatRequestToolPart, ChatRequestToolSetPart, IParsedChatRequestPart, chatAgentLeader, chatSubcommandLeader } from '../../common/chatParserTypes.js';\nimport { ChatRequestParser } from '../../common/chatRequestParser.js';\nimport { IPromptsService } from '../../common/promptSyntax/service/promptsService.js';\nimport { IChatWidget } from '../chat.js';\nimport { ChatWidget } from '../chatWidget.js';\nimport { dynamicVariableDecorationType } from './chatDynamicVariables.js';\nimport { NativeEditContextRegistry } from '../../../../../editor/browser/controller/editContext/native/nativeEditContextRegistry.js';\nimport { CancellationToken } from '../../../../../base/common/cancellation.js';\nimport { ThrottledDelayer } from '../../../../../base/common/async.js';\n\nconst decorationDescription = 'chat';\nconst placeholderDecorationType = 'chat-session-detail';\nconst slashCommandTextDecorationType = 'chat-session-text';\nconst variableTextDecorationType = 'chat-variable-text';\n\nfunction agentAndCommandToKey(agent: IChatAgentData, subcommand: string | undefined): string {\n\treturn subcommand ? `${agent.id}__${subcommand}` : agent.id;\n}\n\nfunction isWhitespaceOrPromptPart(p: IParsedChatRequestPart): boolean {\n\treturn (p instanceof ChatRequestTextPart && !p.text.trim().length) || (p instanceof ChatRequestSlashPromptPart);\n}\n\nfunction exactlyOneSpaceAfterPart(parsedRequest: readonly IParsedChatRequestPart[], part: IParsedChatRequestPart): boolean {\n\tconst partIdx = parsedRequest.indexOf(part);\n\tif (parsedRequest.length > partIdx + 2) {\n\t\treturn false;\n\t}\n\n\tconst nextPart = parsedRequest[partIdx + 1];\n\treturn nextPart && nextPart instanceof ChatRequestTextPart && nextPart.text === ' ';\n}\n\nfunction getRangeForPlaceholder(part: IParsedChatRequestPart) {\n\treturn {\n\t\tstartLineNumber: part.editorRange.startLineNumber,\n\t\tendLineNumber: part.editorRange.endLineNumber,\n\t\tstartColumn: part.editorRange.endColumn + 1,\n\t\tendColumn: 1000\n\t};\n}\n\nclass InputEditorDecorations extends Disposable {\n\n\tprivate static readonly UPDATE_DELAY = 200;\n\n\tpublic readonly id = 'inputEditorDecorations';\n\n\tprivate readonly previouslyUsedAgents = new Set<string>();\n\n\tprivate readonly viewModelDisposables = this._register(new MutableDisposable());\n\n\n\tprivate readonly updateThrottle = this._register(new ThrottledDelayer<void>(InputEditorDecorations.UPDATE_DELAY));\n\n\tconstructor(\n\t\tprivate readonly widget: IChatWidget,\n\t\t@ICodeEditorService private readonly codeEditorService: ICodeEditorService,\n\t\t@IThemeService private readonly themeService: IThemeService,\n\t\t@IChatAgentService private readonly chatAgentService: IChatAgentService,\n\t\t@ILabelService private readonly labelService: ILabelService,\n\t\t@IPromptsService private readonly promptsService: IPromptsService,\n\t) {\n\t\tsuper();\n\n\t\tthis.codeEditorService.registerDecorationType(decorationDescription, placeholderDecorationType, {});\n\n\t\tthis.registeredDecorationTypes();\n\n\t\tthis.triggerInputEditorDecorationsUpdate();\n\t\tthis._register(this.widget.inputEditor.onDidChangeModelContent(() => this.triggerInputEditorDecorationsUpdate()));\n\t\tthis._register(this.widget.onDidChangeParsedInput(() => this.triggerInputEditorDecorationsUpdate()));\n\t\tthis._register(this.widget.onDidChangeViewModel(() => {\n\t\t\tthis.registerViewModelListeners();\n\t\t\tthis.previouslyUsedAgents.clear();\n\t\t\tthis.triggerInputEditorDecorationsUpdate();\n\t\t}));\n\t\tthis._register(this.widget.onDidSubmitAgent((e) => {\n\t\t\tthis.previouslyUsedAgents.add(agentAndCommandToKey(e.agent, e.slashCommand?.name));\n\t\t}));\n\t\tthis._register(this.chatAgentService.onDidChangeAgents(() => this.triggerInputEditorDecorationsUpdate()));\n\t\tthis._register(this.promptsService.onDidChangeSlashCommands(() => this.triggerInputEditorDecorationsUpdate()));\n\t\tthis._register(autorun(reader => {\n\t\t\t// Watch for changes to the current mode and its properties\n\t\t\tconst currentMode = this.widget.input.currentModeObs.read(reader);\n\t\t\tif (currentMode) {\n\t\t\t\t// Also watch the mode's description to react to any changes\n\t\t\t\tcurrentMode.description.read(reader);\n\t\t\t}\n\t\t\t// Trigger decoration update when mode or its properties change\n\t\t\tthis.triggerInputEditorDecorationsUpdate();\n\t\t}));\n\n\t\tthis.registerViewModelListeners();\n\t}\n\n\tprivate registerViewModelListeners(): void {\n\t\tthis.viewModelDisposables.value = this.widget.viewModel?.onDidChange(e => {\n\t\t\tif (e?.kind === 'changePlaceholder' || e?.kind === 'initialize') {\n\t\t\t\tthis.triggerInputEditorDecorationsUpdate();\n\t\t\t}\n\t\t});\n\t}\n\n\tprivate registeredDecorationTypes() {\n\n\t\tthis.codeEditorService.registerDecorationType(decorationDescription, slashCommandTextDecorationType, {\n\t\t\tcolor: themeColorFromId(chatSlashCommandForeground),\n\t\t\tbackgroundColor: themeColorFromId(chatSlashCommandBackground),\n\t\t\tborderRadius: '3px'\n\t\t});\n\t\tthis.codeEditorService.registerDecorationType(decorationDescription, variableTextDecorationType, {\n\t\t\tcolor: themeColorFromId(chatSlashCommandForeground),\n\t\t\tbackgroundColor: themeColorFromId(chatSlashCommandBackground),\n\t\t\tborderRadius: '3px'\n\t\t});\n\t\tthis.codeEditorService.registerDecorationType(decorationDescription, dynamicVariableDecorationType, {\n\t\t\tcolor: themeColorFromId(chatSlashCommandForeground),\n\t\t\tbackgroundColor: themeColorFromId(chatSlashCommandBackground),\n\t\t\tborderRadius: '3px',\n\t\t\trangeBehavior: TrackedRangeStickiness.NeverGrowsWhenTypingAtEdges\n\t\t});\n\n\t\tthis._register(toDisposable(() => {\n\t\t\tthis.codeEditorService.removeDecorationType(variableTextDecorationType);\n\t\t\tthis.codeEditorService.removeDecorationType(dynamicVariableDecorationType);\n\t\t\tthis.codeEditorService.removeDecorationType(slashCommandTextDecorationType);\n\t\t}));\n\t}\n\n\tprivate getPlaceholderColor(): string | undefined {\n\t\tconst theme = this.themeService.getColorTheme();\n\t\tconst transparentForeground = theme.getColor(inputPlaceholderForeground);\n\t\treturn transparentForeground?.toString();\n\t}\n\n\tprivate triggerInputEditorDecorationsUpdate(): void {\n\t\t// update placeholder decorations immediately, in sync\n\t\tthis.updateInputPlaceholderDecoration();\n\n\t\t// with a delay, update the rest of the decorations\n\t\tthis.updateThrottle.trigger(token => this.updateAsyncInputEditorDecorations(token));\n\t}\n\n\tprivate updateInputPlaceholderDecoration(): void {\n\t\tconst inputValue = this.widget.inputEditor.getValue();\n\n\t\tconst viewModel = this.widget.viewModel;\n\t\tif (!viewModel) {\n\t\t\tthis.updateAriaPlaceholder(undefined);\n\t\t\treturn;\n\t\t}\n\n\t\tif (!inputValue) {\n\t\t\tconst mode = this.widget.input.currentModeObs.get();\n\t\t\tconst placeholder = mode.argumentHint?.get() ?? mode.description.get() ?? '';\n\t\t\tconst displayPlaceholder = viewModel.inputPlaceholder || placeholder;\n\n\t\t\tconst decoration: IDecorationOptions[] = [\n\t\t\t\t{\n\t\t\t\t\trange: {\n\t\t\t\t\t\tstartLineNumber: 1,\n\t\t\t\t\t\tendLineNumber: 1,\n\t\t\t\t\t\tstartColumn: 1,\n\t\t\t\t\t\tendColumn: 1000\n\t\t\t\t\t},\n\t\t\t\t\trenderOptions: {\n\t\t\t\t\t\tafter: {\n\t\t\t\t\t\t\tcontentText: displayPlaceholder,\n\t\t\t\t\t\t\tcolor: this.getPlaceholderColor()\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t];\n\t\t\tthis.updateAriaPlaceholder(displayPlaceholder || undefined);\n\t\t\tthis.widget.inputEditor.setDecorationsByType(decorationDescription, placeholderDecorationType, decoration);\n\t\t\treturn;\n\t\t}\n\n\t\tthis.updateAriaPlaceholder(undefined);\n\n\t\tconst parsedRequest = this.widget.parsedInput.parts;\n\n\t\tlet placeholderDecoration: IDecorationOptions[] | undefined;\n\t\tconst agentPart = parsedRequest.find((p): p is ChatRequestAgentPart => p instanceof ChatRequestAgentPart);\n\t\tconst agentSubcommandPart = parsedRequest.find((p): p is ChatRequestAgentSubcommandPart => p instanceof ChatRequestAgentSubcommandPart);\n\n\t\tconst onlyAgentAndWhitespace = agentPart && parsedRequest.every(p => p instanceof ChatRequestTextPart && !p.text.trim().length || p instanceof ChatRequestAgentPart);\n\t\tif (onlyAgentAndWhitespace) {\n\t\t\t// Agent reference with no other text - show the placeholder\n\t\t\tconst isFollowupSlashCommand = this.previouslyUsedAgents.has(agentAndCommandToKey(agentPart.agent, undefined));\n\t\t\tconst shouldRenderFollowupPlaceholder = isFollowupSlashCommand && agentPart.agent.metadata.followupPlaceholder;\n\t\t\tif (agentPart.agent.description && exactlyOneSpaceAfterPart(parsedRequest, agentPart)) {\n\t\t\t\tplaceholderDecoration = [{\n\t\t\t\t\trange: getRangeForPlaceholder(agentPart),\n\t\t\t\t\trenderOptions: {\n\t\t\t\t\t\tafter: {\n\t\t\t\t\t\t\tcontentText: shouldRenderFollowupPlaceholder ? agentPart.agent.metadata.followupPlaceholder : agentPart.agent.description,\n\t\t\t\t\t\t\tcolor: this.getPlaceholderColor(),\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}];\n\t\t\t}\n\t\t}\n\n\t\tconst onlyAgentAndAgentCommandAndWhitespace = agentPart && agentSubcommandPart && parsedRequest.every(p => p instanceof ChatRequestTextPart && !p.text.trim().length || p instanceof ChatRequestAgentPart || p instanceof ChatRequestAgentSubcommandPart);\n\t\tif (onlyAgentAndAgentCommandAndWhitespace) {\n\t\t\t// Agent reference and subcommand with no other text - show the placeholder\n\t\t\tconst isFollowupSlashCommand = this.previouslyUsedAgents.has(agentAndCommandToKey(agentPart.agent, agentSubcommandPart.command.name));\n\t\t\tconst shouldRenderFollowupPlaceholder = isFollowupSlashCommand && agentSubcommandPart.command.followupPlaceholder;\n\t\t\tif (agentSubcommandPart?.command.description && exactlyOneSpaceAfterPart(parsedRequest, agentSubcommandPart)) {\n\t\t\t\tplaceholderDecoration = [{\n\t\t\t\t\trange: getRangeForPlaceholder(agentSubcommandPart),\n\t\t\t\t\trenderOptions: {\n\t\t\t\t\t\tafter: {\n\t\t\t\t\t\t\tcontentText: shouldRenderFollowupPlaceholder ? agentSubcommandPart.command.followupPlaceholder : agentSubcommandPart.command.description,\n\t\t\t\t\t\t\tcolor: this.getPlaceholderColor(),\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}];\n\t\t\t}\n\t\t}\n\n\t\tconst onlyAgentCommandAndWhitespace = agentSubcommandPart && parsedRequest.every(p => p instanceof ChatRequestTextPart && !p.text.trim().length || p instanceof ChatRequestAgentSubcommandPart);\n\t\tif (onlyAgentCommandAndWhitespace) {\n\t\t\t// Agent subcommand with no other text - show the placeholder\n\t\t\tif (agentSubcommandPart?.command.description && exactlyOneSpaceAfterPart(parsedRequest, agentSubcommandPart)) {\n\t\t\t\tplaceholderDecoration = [{\n\t\t\t\t\trange: getRangeForPlaceholder(agentSubcommandPart),\n\t\t\t\t\trenderOptions: {\n\t\t\t\t\t\tafter: {\n\t\t\t\t\t\t\tcontentText: agentSubcommandPart.command.description,\n\t\t\t\t\t\t\tcolor: this.getPlaceholderColor(),\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}];\n\t\t\t}\n\t\t}\n\t\tthis.widget.inputEditor.setDecorationsByType(decorationDescription, placeholderDecorationType, placeholderDecoration ?? []);\n\t}\n\n\tprivate async updateAsyncInputEditorDecorations(token: CancellationToken): Promise<void> {\n\n\t\tconst parsedRequest = this.widget.parsedInput.parts;\n\n\t\tconst agentPart = parsedRequest.find((p): p is ChatRequestAgentPart => p instanceof ChatRequestAgentPart);\n\t\tconst agentSubcommandPart = parsedRequest.find((p): p is ChatRequestAgentSubcommandPart => p instanceof ChatRequestAgentSubcommandPart);\n\t\tconst slashCommandPart = parsedRequest.find((p): p is ChatRequestSlashCommandPart => p instanceof ChatRequestSlashCommandPart);\n\t\tconst slashPromptPart = parsedRequest.find((p): p is ChatRequestSlashPromptPart => p instanceof ChatRequestSlashPromptPart);\n\n\t\t// first, fetch all async context\n\t\tconst promptSlashCommand = slashPromptPart ? await this.promptsService.resolvePromptSlashCommand(slashPromptPart.name, token) : undefined;\n\t\tif (token.isCancellationRequested) {\n\t\t\t// a new update came in while we were waiting\n\t\t\treturn;\n\t\t}\n\n\t\tif (slashPromptPart && promptSlashCommand) {\n\t\t\tconst onlyPromptCommandAndWhitespace = slashPromptPart && parsedRequest.every(isWhitespaceOrPromptPart);\n\t\t\tif (onlyPromptCommandAndWhitespace && exactlyOneSpaceAfterPart(parsedRequest, slashPromptPart) && promptSlashCommand) {\n\t\t\t\tconst description = promptSlashCommand.argumentHint ?? promptSlashCommand.description;\n\t\t\t\tif (description) {\n\t\t\t\t\tthis.widget.inputEditor.setDecorationsByType(decorationDescription, placeholderDecorationType, [{\n\t\t\t\t\t\trange: getRangeForPlaceholder(slashPromptPart),\n\t\t\t\t\t\trenderOptions: {\n\t\t\t\t\t\t\tafter: {\n\t\t\t\t\t\t\t\tcontentText: description,\n\t\t\t\t\t\t\t\tcolor: this.getPlaceholderColor(),\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}]);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tconst textDecorations: IDecorationOptions[] | undefined = [];\n\t\tif (agentPart) {\n\t\t\ttextDecorations.push({ range: agentPart.editorRange });\n\t\t}\n\t\tif (agentSubcommandPart) {\n\t\t\ttextDecorations.push({ range: agentSubcommandPart.editorRange, hoverMessage: new MarkdownString(agentSubcommandPart.command.description) });\n\t\t}\n\n\t\tif (slashCommandPart) {\n\t\t\ttextDecorations.push({ range: slashCommandPart.editorRange });\n\t\t}\n\n\t\tif (slashPromptPart && promptSlashCommand) {\n\t\t\ttextDecorations.push({ range: slashPromptPart.editorRange });\n\t\t}\n\n\t\tthis.widget.inputEditor.setDecorationsByType(decorationDescription, slashCommandTextDecorationType, textDecorations);\n\n\t\tconst varDecorations: IDecorationOptions[] = [];\n\t\tconst toolParts = parsedRequest.filter((p): p is ChatRequestToolPart => p instanceof ChatRequestToolPart || p instanceof ChatRequestToolSetPart);\n\t\tfor (const tool of toolParts) {\n\t\t\tvarDecorations.push({ range: tool.editorRange });\n\t\t}\n\n\t\tconst dynamicVariableParts = parsedRequest.filter((p): p is ChatRequestDynamicVariablePart => p instanceof ChatRequestDynamicVariablePart);\n\n\t\tconst isEditingPreviousRequest = !!this.widget.viewModel?.editing;\n\t\tif (isEditingPreviousRequest) {\n\t\t\tfor (const variable of dynamicVariableParts) {\n\t\t\t\tvarDecorations.push({ range: variable.editorRange, hoverMessage: URI.isUri(variable.data) ? new MarkdownString(this.labelService.getUriLabel(variable.data, { relative: true })) : undefined });\n\t\t\t}\n\t\t}\n\n\t\tthis.widget.inputEditor.setDecorationsByType(decorationDescription, variableTextDecorationType, varDecorations);\n\t}\n\n\tprivate updateAriaPlaceholder(value: string | undefined): void {\n\t\tconst nativeEditContext = NativeEditContextRegistry.get(this.widget.inputEditor.getId());\n\t\tconst domNode = nativeEditContext?.domNode.domNode;\n\t\tif (!domNode) {\n\t\t\treturn;\n\t\t}\n\t\tif (value && value.trim().length) {\n\t\t\tdomNode.setAttribute('aria-placeholder', value);\n\t\t} else {\n\t\t\tdomNode.removeAttribute('aria-placeholder');\n\t\t}\n\t}\n}\n\nclass InputEditorSlashCommandMode extends Disposable {\n\tpublic readonly id = 'InputEditorSlashCommandMode';\n\n\tconstructor(\n\t\tprivate readonly widget: IChatWidget\n\t) {\n\t\tsuper();\n\t\tthis._register(this.widget.onDidChangeAgent(e => {\n\t\t\tif (e.slashCommand && e.slashCommand.isSticky || !e.slashCommand && e.agent.metadata.isSticky) {\n\t\t\t\tthis.repopulateAgentCommand(e.agent, e.slashCommand);\n\t\t\t}\n\t\t}));\n\t\tthis._register(this.widget.onDidSubmitAgent(e => {\n\t\t\tthis.repopulateAgentCommand(e.agent, e.slashCommand);\n\t\t}));\n\t}\n\n\tprivate async repopulateAgentCommand(agent: IChatAgentData, slashCommand: IChatAgentCommand | undefined) {\n\t\t// Make sure we don't repopulate if the user already has something in the input\n\t\tif (this.widget.inputEditor.getValue().trim()) {\n\t\t\treturn;\n\t\t}\n\n\t\tlet value: string | undefined;\n\t\tif (slashCommand && slashCommand.isSticky) {\n\t\t\tvalue = `${chatAgentLeader}${agent.name} ${chatSubcommandLeader}${slashCommand.name} `;\n\t\t} else if (agent.metadata.isSticky) {\n\t\t\tvalue = `${chatAgentLeader}${agent.name} `;\n\t\t}\n\n\t\tif (value) {\n\t\t\tthis.widget.inputEditor.setValue(value);\n\t\t\tthis.widget.inputEditor.setPosition({ lineNumber: 1, column: value.length + 1 });\n\t\t}\n\t}\n}\n\nChatWidget.CONTRIBS.push(InputEditorDecorations, InputEditorSlashCommandMode);\n\nclass ChatTokenDeleter extends Disposable {\n\n\tpublic readonly id = 'chatTokenDeleter';\n\n\tconstructor(\n\t\tprivate readonly widget: IChatWidget,\n\t\t@IInstantiationService private readonly instantiationService: IInstantiationService,\n\t) {\n\t\tsuper();\n\t\tconst parser = this.instantiationService.createInstance(ChatRequestParser);\n\t\tconst inputValue = this.widget.inputEditor.getValue();\n\t\tlet previousInputValue: string | undefined;\n\t\tlet previousSelectedAgent: IChatAgentData | undefined;\n\n\t\t// A simple heuristic to delete the previous token when the user presses backspace.\n\t\t// The sophisticated way to do this would be to have a parse tree that can be updated incrementally.\n\t\tthis._register(this.widget.inputEditor.onDidChangeModelContent(e => {\n\t\t\tif (!previousInputValue) {\n\t\t\t\tpreviousInputValue = inputValue;\n\t\t\t\tpreviousSelectedAgent = this.widget.lastSelectedAgent;\n\t\t\t}\n\n\t\t\t// Don't try to handle multicursor edits right now\n\t\t\tconst change = e.changes[0];\n\n\t\t\t// If this was a simple delete, try to find out whether it was inside a token\n\t\t\tif (!change.text && this.widget.viewModel) {\n\t\t\t\tconst previousParsedValue = parser.parseChatRequest(this.widget.viewModel.sessionResource, previousInputValue, widget.location, { selectedAgent: previousSelectedAgent, mode: this.widget.input.currentModeKind });\n\n\t\t\t\t// For dynamic variables, this has to happen in ChatDynamicVariableModel with the other bookkeeping\n\t\t\t\tconst deletableTokens = previousParsedValue.parts.filter(p => p instanceof ChatRequestAgentPart || p instanceof ChatRequestAgentSubcommandPart || p instanceof ChatRequestSlashCommandPart || p instanceof ChatRequestSlashPromptPart || p instanceof ChatRequestToolPart);\n\t\t\t\tdeletableTokens.forEach(token => {\n\t\t\t\t\tconst deletedRangeOfToken = Range.intersectRanges(token.editorRange, change.range);\n\t\t\t\t\t// Part of this token was deleted, or the space after it was deleted, and the deletion range doesn't go off the front of the token, for simpler math\n\t\t\t\t\tif (deletedRangeOfToken && Range.compareRangesUsingStarts(token.editorRange, change.range) < 0) {\n\t\t\t\t\t\t// Assume single line tokens\n\t\t\t\t\t\tconst length = deletedRangeOfToken.endColumn - deletedRangeOfToken.startColumn;\n\t\t\t\t\t\tconst rangeToDelete = new Range(token.editorRange.startLineNumber, token.editorRange.startColumn, token.editorRange.endLineNumber, token.editorRange.endColumn - length);\n\t\t\t\t\t\tthis.widget.inputEditor.executeEdits(this.id, [{\n\t\t\t\t\t\t\trange: rangeToDelete,\n\t\t\t\t\t\t\ttext: '',\n\t\t\t\t\t\t}]);\n\t\t\t\t\t\tthis.widget.refreshParsedInput();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tpreviousInputValue = this.widget.inputEditor.getValue();\n\t\t\tpreviousSelectedAgent = this.widget.lastSelectedAgent;\n\t\t}));\n\t}\n}\nChatWidget.CONTRIBS.push(ChatTokenDeleter);\n"]}