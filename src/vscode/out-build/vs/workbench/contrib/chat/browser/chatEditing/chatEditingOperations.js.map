{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/contrib/chat/browser/chatEditing/chatEditingOperations.ts","vs/workbench/contrib/chat/browser/chatEditing/chatEditingOperations.ts"],"names":[],"mappings":"AAAA;;;gGAGgG;AAEhG,OAAO,EAAE,UAAU,EAAE,MAAM,oCAAoC,CAAC;AAKhE,OAAO,EAAE,mBAAmB,EAAE,MAAM,yBAAyB,CAAC;AAE9D,MAAM,CAAN,IAAY,iBAMX;AAND,WAAY,iBAAiB;IAC5B,sCAAiB,CAAA;IACjB,sCAAiB,CAAA;IACjB,sCAAiB,CAAA;IACjB,0CAAqB,CAAA;IACrB,kDAA6B,CAAA;AAC9B,CAAC,EANW,iBAAiB,KAAjB,iBAAiB,QAM5B;AAsHD,MAAM,UAAU,4BAA4B,CAAC,mBAAwB;IACpE,MAAM,SAAS,GAAG,mBAAmB,CAAC,mBAAmB,CAAC,mBAAmB,CAAC,CAAC;IAC/E,IAAI,SAAS,EAAE,CAAC;QACf,OAAO,SAAS,CAAC;IAClB,CAAC;IAED,MAAM,GAAG,GAAG,IAAI,UAAU,EAAE,CAAC;IAC7B,GAAG,CAAC,MAAM,CAAC,mBAAmB,CAAC,QAAQ,EAAE,CAAC,CAAC;IAC3C,OAAO,GAAG,CAAC,MAAM,EAAE,CAAC;AACrB,CAAC","file":"chatEditingOperations.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { StringSHA1 } from '../../../../../base/common/hash.js';\nimport { URI } from '../../../../../base/common/uri.js';\nimport { TextEdit } from '../../../../../editor/common/languages.js';\nimport { ICellEditOperation } from '../../../notebook/common/notebookCommon.js';\nimport { IModifiedEntryTelemetryInfo } from '../../common/chatEditingService.js';\nimport { LocalChatSessionUri } from '../../common/chatUri.js';\n\nexport enum FileOperationType {\n\tCreate = 'create',\n\tDelete = 'delete',\n\tRename = 'rename',\n\tTextEdit = 'textEdit',\n\tNotebookEdit = 'notebookEdit'\n}\n\n/**\n * Base interface for all file operations in the checkpoint timeline\n */\nexport interface IFileOperation {\n\treadonly type: FileOperationType;\n\treadonly uri: URI;\n\treadonly requestId: string;\n\treadonly epoch: number;\n}\n\n/**\n * Operation representing the creation of a new file\n */\nexport interface IFileCreateOperation extends IFileOperation {\n\treadonly type: FileOperationType.Create;\n\treadonly initialContent: string;\n\treadonly notebookViewType?: string;\n\treadonly telemetryInfo: IModifiedEntryTelemetryInfo;\n}\n\n/**\n * Operation representing the deletion of a file\n */\nexport interface IFileDeleteOperation extends IFileOperation {\n\treadonly type: FileOperationType.Delete;\n\treadonly finalContent: string; // content before deletion for potential restoration\n}\n\n/**\n * Operation representing the renaming/moving of a file\n */\nexport interface IFileRenameOperation extends IFileOperation {\n\treadonly type: FileOperationType.Rename;\n\treadonly oldUri: URI;\n\treadonly newUri: URI;\n}\n\n/**\n * Operation representing text edits applied to a file\n */\nexport interface ITextEditOperation extends IFileOperation {\n\treadonly type: FileOperationType.TextEdit;\n\treadonly edits: readonly TextEdit[];\n\t/**\n\t * For cell URIs, the cell index that was edited. Needed because the original\n\t * edit URI only contains the `handle` which is not portable between notebooks.\n\t */\n\treadonly cellIndex?: number;\n}\n\n/**\n * Operation representing notebook cell edits applied to a notebook\n */\nexport interface INotebookEditOperation extends IFileOperation {\n\treadonly type: FileOperationType.NotebookEdit;\n\treadonly cellEdits: readonly ICellEditOperation[];\n}\n\n/**\n * Union type of all possible file operations\n */\nexport type FileOperation = IFileCreateOperation | IFileDeleteOperation | IFileRenameOperation | ITextEditOperation | INotebookEditOperation;\n\n/**\n * File baseline represents the initial state of a file when first edited in a request\n */\nexport interface IFileBaseline {\n\treadonly uri: URI;\n\treadonly requestId: string;\n\treadonly content: string;\n\treadonly epoch: number;\n\treadonly telemetryInfo: IModifiedEntryTelemetryInfo;\n\treadonly notebookViewType?: string;\n}\n\nexport interface IReconstructedFileExistsState {\n\treadonly exists: true;\n\treadonly content: string;\n\treadonly uri: URI;\n\treadonly telemetryInfo: IModifiedEntryTelemetryInfo;\n\treadonly notebookViewType?: string;\n}\n\nexport interface IReconstructedFileNotExistsState {\n\treadonly exists: false;\n\treadonly uri: URI;\n}\n\n/**\n * The reconstructed state of a file at a specific checkpoint\n */\nexport type IReconstructedFileState = IReconstructedFileNotExistsState | IReconstructedFileExistsState;\n\n/**\n * Checkpoint represents a stable state that can be navigated to\n */\nexport interface ICheckpoint {\n\treadonly checkpointId: string;\n\treadonly requestId: string | undefined; // undefined for initial state\n\treadonly undoStopId: string | undefined;\n\treadonly epoch: number;\n\treadonly label: string; // for UI display\n\treadonly description?: string; // optional detailed description\n}\n\n/**\n * State that can be persisted and restored for the checkpoint timeline\n */\nexport interface IChatEditingTimelineState {\n\treadonly checkpoints: readonly ICheckpoint[];\n\treadonly fileBaselines: [string, IFileBaseline][]; // key: `${uri}::${requestId}`\n\treadonly operations: readonly FileOperation[];\n\treadonly currentEpoch: number;\n\treadonly epochCounter: number;\n}\n\nexport function getKeyForChatSessionResource(chatSessionResource: URI) {\n\tconst sessionId = LocalChatSessionUri.parseLocalSessionId(chatSessionResource);\n\tif (sessionId) {\n\t\treturn sessionId;\n\t}\n\n\tconst sha = new StringSHA1();\n\tsha.update(chatSessionResource.toString());\n\treturn sha.digest();\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { StringSHA1 } from '../../../../../base/common/hash.js';\nimport { URI } from '../../../../../base/common/uri.js';\nimport { TextEdit } from '../../../../../editor/common/languages.js';\nimport { ICellEditOperation } from '../../../notebook/common/notebookCommon.js';\nimport { IModifiedEntryTelemetryInfo } from '../../common/chatEditingService.js';\nimport { LocalChatSessionUri } from '../../common/chatUri.js';\n\nexport enum FileOperationType {\n\tCreate = 'create',\n\tDelete = 'delete',\n\tRename = 'rename',\n\tTextEdit = 'textEdit',\n\tNotebookEdit = 'notebookEdit'\n}\n\n/**\n * Base interface for all file operations in the checkpoint timeline\n */\nexport interface IFileOperation {\n\treadonly type: FileOperationType;\n\treadonly uri: URI;\n\treadonly requestId: string;\n\treadonly epoch: number;\n}\n\n/**\n * Operation representing the creation of a new file\n */\nexport interface IFileCreateOperation extends IFileOperation {\n\treadonly type: FileOperationType.Create;\n\treadonly initialContent: string;\n\treadonly notebookViewType?: string;\n\treadonly telemetryInfo: IModifiedEntryTelemetryInfo;\n}\n\n/**\n * Operation representing the deletion of a file\n */\nexport interface IFileDeleteOperation extends IFileOperation {\n\treadonly type: FileOperationType.Delete;\n\treadonly finalContent: string; // content before deletion for potential restoration\n}\n\n/**\n * Operation representing the renaming/moving of a file\n */\nexport interface IFileRenameOperation extends IFileOperation {\n\treadonly type: FileOperationType.Rename;\n\treadonly oldUri: URI;\n\treadonly newUri: URI;\n}\n\n/**\n * Operation representing text edits applied to a file\n */\nexport interface ITextEditOperation extends IFileOperation {\n\treadonly type: FileOperationType.TextEdit;\n\treadonly edits: readonly TextEdit[];\n\t/**\n\t * For cell URIs, the cell index that was edited. Needed because the original\n\t * edit URI only contains the `handle` which is not portable between notebooks.\n\t */\n\treadonly cellIndex?: number;\n}\n\n/**\n * Operation representing notebook cell edits applied to a notebook\n */\nexport interface INotebookEditOperation extends IFileOperation {\n\treadonly type: FileOperationType.NotebookEdit;\n\treadonly cellEdits: readonly ICellEditOperation[];\n}\n\n/**\n * Union type of all possible file operations\n */\nexport type FileOperation = IFileCreateOperation | IFileDeleteOperation | IFileRenameOperation | ITextEditOperation | INotebookEditOperation;\n\n/**\n * File baseline represents the initial state of a file when first edited in a request\n */\nexport interface IFileBaseline {\n\treadonly uri: URI;\n\treadonly requestId: string;\n\treadonly content: string;\n\treadonly epoch: number;\n\treadonly telemetryInfo: IModifiedEntryTelemetryInfo;\n\treadonly notebookViewType?: string;\n}\n\nexport interface IReconstructedFileExistsState {\n\treadonly exists: true;\n\treadonly content: string;\n\treadonly uri: URI;\n\treadonly telemetryInfo: IModifiedEntryTelemetryInfo;\n\treadonly notebookViewType?: string;\n}\n\nexport interface IReconstructedFileNotExistsState {\n\treadonly exists: false;\n\treadonly uri: URI;\n}\n\n/**\n * The reconstructed state of a file at a specific checkpoint\n */\nexport type IReconstructedFileState = IReconstructedFileNotExistsState | IReconstructedFileExistsState;\n\n/**\n * Checkpoint represents a stable state that can be navigated to\n */\nexport interface ICheckpoint {\n\treadonly checkpointId: string;\n\treadonly requestId: string | undefined; // undefined for initial state\n\treadonly undoStopId: string | undefined;\n\treadonly epoch: number;\n\treadonly label: string; // for UI display\n\treadonly description?: string; // optional detailed description\n}\n\n/**\n * State that can be persisted and restored for the checkpoint timeline\n */\nexport interface IChatEditingTimelineState {\n\treadonly checkpoints: readonly ICheckpoint[];\n\treadonly fileBaselines: [string, IFileBaseline][]; // key: `${uri}::${requestId}`\n\treadonly operations: readonly FileOperation[];\n\treadonly currentEpoch: number;\n\treadonly epochCounter: number;\n}\n\nexport function getKeyForChatSessionResource(chatSessionResource: URI) {\n\tconst sessionId = LocalChatSessionUri.parseLocalSessionId(chatSessionResource);\n\tif (sessionId) {\n\t\treturn sessionId;\n\t}\n\n\tconst sha = new StringSHA1();\n\tsha.update(chatSessionResource.toString());\n\treturn sha.digest();\n}\n"]}