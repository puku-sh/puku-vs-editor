{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/contrib/chat/browser/promptSyntax/promptFileRewriter.ts","vs/workbench/contrib/chat/browser/promptSyntax/promptFileRewriter.ts"],"names":[],"mappings":"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","file":"promptFileRewriter.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { CancellationToken } from '../../../../../base/common/cancellation.js';\nimport { URI } from '../../../../../base/common/uri.js';\nimport { ICodeEditorService } from '../../../../../editor/browser/services/codeEditorService.js';\nimport { EditOperation } from '../../../../../editor/common/core/editOperation.js';\nimport { Range } from '../../../../../editor/common/core/range.js';\nimport { ITextModel } from '../../../../../editor/common/model.js';\nimport { ILanguageModelToolsService, IToolAndToolSetEnablementMap } from '../../common/languageModelToolsService.js';\nimport { PromptHeaderAttributes } from '../../common/promptSyntax/promptFileParser.js';\nimport { IPromptsService } from '../../common/promptSyntax/service/promptsService.js';\n\nexport class PromptFileRewriter {\n\tconstructor(\n\t\t@ICodeEditorService private readonly _codeEditorService: ICodeEditorService,\n\t\t@IPromptsService private readonly _promptsService: IPromptsService,\n\t\t@ILanguageModelToolsService private readonly _languageModelToolsService: ILanguageModelToolsService\n\t) {\n\t}\n\n\tpublic async openAndRewriteTools(uri: URI, newTools: IToolAndToolSetEnablementMap | undefined, token: CancellationToken): Promise<void> {\n\t\tconst editor = await this._codeEditorService.openCodeEditor({ resource: uri }, this._codeEditorService.getFocusedCodeEditor());\n\t\tif (!editor || !editor.hasModel()) {\n\t\t\treturn;\n\t\t}\n\t\tconst model = editor.getModel();\n\n\t\tconst promptAST = this._promptsService.getParsedPromptFile(model);\n\t\tif (!promptAST.header) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\tconst toolsAttr = promptAST.header.getAttribute(PromptHeaderAttributes.tools);\n\t\tif (!toolsAttr) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\teditor.setSelection(toolsAttr.range);\n\t\tif (newTools === undefined) {\n\t\t\tthis.rewriteAttribute(model, '', toolsAttr.range);\n\t\t\treturn;\n\t\t} else {\n\t\t\tthis.rewriteTools(model, newTools, toolsAttr.value.range);\n\t\t}\n\t}\n\n\tpublic rewriteTools(model: ITextModel, newTools: IToolAndToolSetEnablementMap, range: Range): void {\n\t\tconst newToolNames = this._languageModelToolsService.toQualifiedToolNames(newTools);\n\t\tconst newValue = `[${newToolNames.map(s => `'${s}'`).join(', ')}]`;\n\t\tthis.rewriteAttribute(model, newValue, range);\n\t}\n\n\tprivate rewriteAttribute(model: ITextModel, newValue: string, range: Range): void {\n\t\tmodel.pushStackElement();\n\t\tmodel.pushEditOperations(null, [EditOperation.replaceMove(range, newValue)], () => null);\n\t\tmodel.pushStackElement();\n\t}\n\n\tpublic async openAndRewriteName(uri: URI, newName: string, token: CancellationToken): Promise<void> {\n\t\tconst editor = await this._codeEditorService.openCodeEditor({ resource: uri }, this._codeEditorService.getFocusedCodeEditor());\n\t\tif (!editor || !editor.hasModel()) {\n\t\t\treturn;\n\t\t}\n\t\tconst model = editor.getModel();\n\n\t\tconst promptAST = this._promptsService.getParsedPromptFile(model);\n\t\tif (!promptAST.header) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst nameAttr = promptAST.header.getAttribute(PromptHeaderAttributes.name);\n\t\tif (!nameAttr) {\n\t\t\treturn;\n\t\t}\n\t\tif (nameAttr.value.type === 'string' && nameAttr.value.value === newName) {\n\t\t\treturn;\n\t\t}\n\n\t\teditor.setSelection(nameAttr.range);\n\t\tthis.rewriteAttribute(model, newName, nameAttr.value.range);\n\t}\n}\n\n\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { CancellationToken } from '../../../../../base/common/cancellation.js';\nimport { URI } from '../../../../../base/common/uri.js';\nimport { ICodeEditorService } from '../../../../../editor/browser/services/codeEditorService.js';\nimport { EditOperation } from '../../../../../editor/common/core/editOperation.js';\nimport { Range } from '../../../../../editor/common/core/range.js';\nimport { ITextModel } from '../../../../../editor/common/model.js';\nimport { ILanguageModelToolsService, IToolAndToolSetEnablementMap } from '../../common/languageModelToolsService.js';\nimport { PromptHeaderAttributes } from '../../common/promptSyntax/promptFileParser.js';\nimport { IPromptsService } from '../../common/promptSyntax/service/promptsService.js';\n\nexport class PromptFileRewriter {\n\tconstructor(\n\t\t@ICodeEditorService private readonly _codeEditorService: ICodeEditorService,\n\t\t@IPromptsService private readonly _promptsService: IPromptsService,\n\t\t@ILanguageModelToolsService private readonly _languageModelToolsService: ILanguageModelToolsService\n\t) {\n\t}\n\n\tpublic async openAndRewriteTools(uri: URI, newTools: IToolAndToolSetEnablementMap | undefined, token: CancellationToken): Promise<void> {\n\t\tconst editor = await this._codeEditorService.openCodeEditor({ resource: uri }, this._codeEditorService.getFocusedCodeEditor());\n\t\tif (!editor || !editor.hasModel()) {\n\t\t\treturn;\n\t\t}\n\t\tconst model = editor.getModel();\n\n\t\tconst promptAST = this._promptsService.getParsedPromptFile(model);\n\t\tif (!promptAST.header) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\tconst toolsAttr = promptAST.header.getAttribute(PromptHeaderAttributes.tools);\n\t\tif (!toolsAttr) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\teditor.setSelection(toolsAttr.range);\n\t\tif (newTools === undefined) {\n\t\t\tthis.rewriteAttribute(model, '', toolsAttr.range);\n\t\t\treturn;\n\t\t} else {\n\t\t\tthis.rewriteTools(model, newTools, toolsAttr.value.range);\n\t\t}\n\t}\n\n\tpublic rewriteTools(model: ITextModel, newTools: IToolAndToolSetEnablementMap, range: Range): void {\n\t\tconst newToolNames = this._languageModelToolsService.toQualifiedToolNames(newTools);\n\t\tconst newValue = `[${newToolNames.map(s => `'${s}'`).join(', ')}]`;\n\t\tthis.rewriteAttribute(model, newValue, range);\n\t}\n\n\tprivate rewriteAttribute(model: ITextModel, newValue: string, range: Range): void {\n\t\tmodel.pushStackElement();\n\t\tmodel.pushEditOperations(null, [EditOperation.replaceMove(range, newValue)], () => null);\n\t\tmodel.pushStackElement();\n\t}\n\n\tpublic async openAndRewriteName(uri: URI, newName: string, token: CancellationToken): Promise<void> {\n\t\tconst editor = await this._codeEditorService.openCodeEditor({ resource: uri }, this._codeEditorService.getFocusedCodeEditor());\n\t\tif (!editor || !editor.hasModel()) {\n\t\t\treturn;\n\t\t}\n\t\tconst model = editor.getModel();\n\n\t\tconst promptAST = this._promptsService.getParsedPromptFile(model);\n\t\tif (!promptAST.header) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst nameAttr = promptAST.header.getAttribute(PromptHeaderAttributes.name);\n\t\tif (!nameAttr) {\n\t\t\treturn;\n\t\t}\n\t\tif (nameAttr.value.type === 'string' && nameAttr.value.value === newName) {\n\t\t\treturn;\n\t\t}\n\n\t\teditor.setSelection(nameAttr.range);\n\t\tthis.rewriteAttribute(model, newName, nameAttr.value.range);\n\t}\n}\n\n\n"]}