{"version":3,"sources":["vs/workbench/contrib/chat/browser/chatResponseAccessibleView.ts"],"names":[],"mappings":"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","file":"chatResponseAccessibleView.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { renderAsPlaintext } from '../../../../base/browser/markdownRenderer.js';\nimport { isMarkdownString, MarkdownString } from '../../../../base/common/htmlContent.js';\nimport { stripIcons } from '../../../../base/common/iconLabels.js';\nimport { Disposable } from '../../../../base/common/lifecycle.js';\nimport { localize } from '../../../../nls.js';\nimport { AccessibleViewProviderId, AccessibleViewType, IAccessibleViewContentProvider } from '../../../../platform/accessibility/browser/accessibleView.js';\nimport { IAccessibleViewImplementation } from '../../../../platform/accessibility/browser/accessibleViewRegistry.js';\nimport { ServicesAccessor } from '../../../../platform/instantiation/common/instantiation.js';\nimport { AccessibilityVerbositySettingId } from '../../accessibility/browser/accessibilityConfiguration.js';\nimport { migrateLegacyTerminalToolSpecificData } from '../common/chat.js';\nimport { ChatContextKeys } from '../common/chatContextKeys.js';\nimport { IChatToolInvocation } from '../common/chatService.js';\nimport { isResponseVM } from '../common/chatViewModel.js';\nimport { toolContentToA11yString } from '../common/languageModelToolsService.js';\nimport { ChatTreeItem, IChatWidget, IChatWidgetService } from './chat.js';\n\nexport class ChatResponseAccessibleView implements IAccessibleViewImplementation {\n\treadonly priority = 100;\n\treadonly name = 'panelChat';\n\treadonly type = AccessibleViewType.View;\n\treadonly when = ChatContextKeys.inChatSession;\n\tgetProvider(accessor: ServicesAccessor) {\n\t\tconst widgetService = accessor.get(IChatWidgetService);\n\t\tconst widget = widgetService.lastFocusedWidget;\n\t\tif (!widget) {\n\t\t\treturn;\n\t\t}\n\t\tconst chatInputFocused = widget.hasInputFocus();\n\t\tif (chatInputFocused) {\n\t\t\twidget.focusResponseItem();\n\t\t}\n\n\t\tconst verifiedWidget: IChatWidget = widget;\n\t\tconst focusedItem = verifiedWidget.getFocus();\n\t\tif (!focusedItem) {\n\t\t\treturn;\n\t\t}\n\n\t\treturn new ChatResponseAccessibleProvider(verifiedWidget, focusedItem, chatInputFocused);\n\t}\n}\n\nclass ChatResponseAccessibleProvider extends Disposable implements IAccessibleViewContentProvider {\n\tprivate _focusedItem: ChatTreeItem;\n\tconstructor(\n\t\tprivate readonly _widget: IChatWidget,\n\t\titem: ChatTreeItem,\n\t\tprivate readonly _wasOpenedFromInput: boolean\n\t) {\n\t\tsuper();\n\t\tthis._focusedItem = item;\n\t}\n\n\treadonly id = AccessibleViewProviderId.PanelChat;\n\treadonly verbositySettingKey = AccessibilityVerbositySettingId.Chat;\n\treadonly options = { type: AccessibleViewType.View };\n\n\tprovideContent(): string {\n\t\treturn this._getContent(this._focusedItem);\n\t}\n\n\tprivate _getContent(item: ChatTreeItem): string {\n\t\tlet responseContent = isResponseVM(item) ? item.response.toString() : '';\n\t\tif (!responseContent && 'errorDetails' in item && item.errorDetails) {\n\t\t\tresponseContent = item.errorDetails.message;\n\t\t}\n\t\tif (isResponseVM(item)) {\n\t\t\titem.response.value.filter(item => item.kind === 'elicitation2' || item.kind === 'elicitationSerialized').forEach(elicitation => {\n\t\t\t\tconst title = elicitation.title;\n\t\t\t\tif (typeof title === 'string') {\n\t\t\t\t\tresponseContent += `${title}\\n`;\n\t\t\t\t} else if (isMarkdownString(title)) {\n\t\t\t\t\tresponseContent += renderAsPlaintext(title, { includeCodeBlocksFences: true }) + '\\n';\n\t\t\t\t}\n\t\t\t\tconst message = elicitation.message;\n\t\t\t\tif (isMarkdownString(message)) {\n\t\t\t\t\tresponseContent += renderAsPlaintext(message, { includeCodeBlocksFences: true });\n\t\t\t\t} else {\n\t\t\t\t\tresponseContent += message;\n\t\t\t\t}\n\t\t\t});\n\t\t\tconst toolInvocations = item.response.value.filter(item => item.kind === 'toolInvocation');\n\t\t\tfor (const toolInvocation of toolInvocations) {\n\t\t\t\tconst state = toolInvocation.state.get();\n\t\t\t\tif (toolInvocation.confirmationMessages?.title && state.type === IChatToolInvocation.StateKind.WaitingForConfirmation) {\n\t\t\t\t\tconst title = typeof toolInvocation.confirmationMessages.title === 'string' ? toolInvocation.confirmationMessages.title : toolInvocation.confirmationMessages.title.value;\n\t\t\t\t\tconst message = typeof toolInvocation.confirmationMessages.message === 'string' ? toolInvocation.confirmationMessages.message : stripIcons(renderAsPlaintext(toolInvocation.confirmationMessages.message!));\n\t\t\t\t\tlet input = '';\n\t\t\t\t\tif (toolInvocation.toolSpecificData) {\n\t\t\t\t\t\tif (toolInvocation.toolSpecificData?.kind === 'terminal') {\n\t\t\t\t\t\t\tconst terminalData = migrateLegacyTerminalToolSpecificData(toolInvocation.toolSpecificData);\n\t\t\t\t\t\t\tinput = terminalData.commandLine.userEdited ?? terminalData.commandLine.toolEdited ?? terminalData.commandLine.original;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tinput = toolInvocation.toolSpecificData?.kind === 'extensions'\n\t\t\t\t\t\t\t\t? JSON.stringify(toolInvocation.toolSpecificData.extensions)\n\t\t\t\t\t\t\t\t: toolInvocation.toolSpecificData?.kind === 'todoList'\n\t\t\t\t\t\t\t\t\t? JSON.stringify(toolInvocation.toolSpecificData.todoList)\n\t\t\t\t\t\t\t\t\t: toolInvocation.toolSpecificData?.kind === 'pullRequest'\n\t\t\t\t\t\t\t\t\t\t? JSON.stringify(toolInvocation.toolSpecificData)\n\t\t\t\t\t\t\t\t\t\t: JSON.stringify(toolInvocation.toolSpecificData.rawInput);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tresponseContent += `${title}`;\n\t\t\t\t\tif (input) {\n\t\t\t\t\t\tresponseContent += `: ${input}`;\n\t\t\t\t\t}\n\t\t\t\t\tresponseContent += `\\n${message}\\n`;\n\t\t\t\t} else if (state.type === IChatToolInvocation.StateKind.WaitingForPostApproval) {\n\t\t\t\t\tresponseContent += localize('toolPostApprovalA11yView', \"Approve results of {0}? Result: \", toolInvocation.toolId) + toolContentToA11yString(state.contentForModel) + '\\n';\n\t\t\t\t} else {\n\t\t\t\t\tconst resultDetails = IChatToolInvocation.resultDetails(toolInvocation);\n\t\t\t\t\tif (resultDetails && 'input' in resultDetails) {\n\t\t\t\t\t\tresponseContent += '\\n' + (resultDetails.isError ? 'Errored ' : 'Completed ');\n\t\t\t\t\t\tresponseContent += `${`${typeof toolInvocation.invocationMessage === 'string' ? toolInvocation.invocationMessage : stripIcons(renderAsPlaintext(toolInvocation.invocationMessage))} with input: ${resultDetails.input}`}\\n`;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tconst pastConfirmations = item.response.value.filter(item => item.kind === 'toolInvocationSerialized');\n\t\t\tfor (const pastConfirmation of pastConfirmations) {\n\t\t\t\tif (pastConfirmation.isComplete && pastConfirmation.resultDetails && 'input' in pastConfirmation.resultDetails) {\n\t\t\t\t\tif (pastConfirmation.pastTenseMessage) {\n\t\t\t\t\t\tresponseContent += `\\n${`${typeof pastConfirmation.pastTenseMessage === 'string' ? pastConfirmation.pastTenseMessage : stripIcons(renderAsPlaintext(pastConfirmation.pastTenseMessage))} with input: ${pastConfirmation.resultDetails.input}`}\\n`;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn renderAsPlaintext(new MarkdownString(responseContent), { includeCodeBlocksFences: true });\n\t}\n\n\tonClose(): void {\n\t\tthis._widget.reveal(this._focusedItem);\n\t\tif (this._wasOpenedFromInput) {\n\t\t\tthis._widget.focusInput();\n\t\t} else {\n\t\t\tthis._widget.focus(this._focusedItem);\n\t\t}\n\t}\n\n\tprovideNextContent(): string | undefined {\n\t\tconst next = this._widget.getSibling(this._focusedItem, 'next');\n\t\tif (next) {\n\t\t\tthis._focusedItem = next;\n\t\t\treturn this._getContent(next);\n\t\t}\n\t\treturn;\n\t}\n\n\tprovidePreviousContent(): string | undefined {\n\t\tconst previous = this._widget.getSibling(this._focusedItem, 'previous');\n\t\tif (previous) {\n\t\t\tthis._focusedItem = previous;\n\t\t\treturn this._getContent(previous);\n\t\t}\n\t\treturn;\n\t}\n}\n"]}