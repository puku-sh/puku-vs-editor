{"version":3,"sources":["vs/workbench/contrib/chat/browser/chatContentParts/chatMarkdownContentPart.ts"],"names":[],"mappings":"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","file":"chatMarkdownContentPart.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as dom from '../../../../../base/browser/dom.js';\nimport { allowedMarkdownHtmlAttributes, MarkdownRendererMarkedOptions, type MarkdownRenderOptions } from '../../../../../base/browser/markdownRenderer.js';\nimport { StandardMouseEvent } from '../../../../../base/browser/mouseEvent.js';\nimport { status } from '../../../../../base/browser/ui/aria/aria.js';\nimport { HoverStyle } from '../../../../../base/browser/ui/hover/hover.js';\nimport { HoverPosition } from '../../../../../base/browser/ui/hover/hoverWidget.js';\nimport { DomScrollableElement } from '../../../../../base/browser/ui/scrollbar/scrollableElement.js';\nimport { coalesce } from '../../../../../base/common/arrays.js';\nimport { findLast } from '../../../../../base/common/arraysFind.js';\nimport { Codicon } from '../../../../../base/common/codicons.js';\nimport { Emitter } from '../../../../../base/common/event.js';\nimport { Lazy } from '../../../../../base/common/lazy.js';\nimport { Disposable, DisposableStore, IDisposable, MutableDisposable, toDisposable } from '../../../../../base/common/lifecycle.js';\nimport { autorun, autorunSelfDisposable, derived } from '../../../../../base/common/observable.js';\nimport { ScrollbarVisibility } from '../../../../../base/common/scrollable.js';\nimport { equalsIgnoreCase } from '../../../../../base/common/strings.js';\nimport { ThemeIcon } from '../../../../../base/common/themables.js';\nimport { URI } from '../../../../../base/common/uri.js';\nimport { Range } from '../../../../../editor/common/core/range.js';\nimport { ILanguageService } from '../../../../../editor/common/languages/language.js';\nimport { ITextModel } from '../../../../../editor/common/model.js';\nimport { getIconClasses } from '../../../../../editor/common/services/getIconClasses.js';\nimport { IModelService } from '../../../../../editor/common/services/model.js';\nimport { ITextModelService } from '../../../../../editor/common/services/resolverService.js';\nimport { EditDeltaInfo } from '../../../../../editor/common/textModelEditSource.js';\nimport { localize } from '../../../../../nls.js';\nimport { getFlatContextMenuActions } from '../../../../../platform/actions/browser/menuEntryActionViewItem.js';\nimport { IMenuService, MenuId } from '../../../../../platform/actions/common/actions.js';\nimport { IConfigurationService } from '../../../../../platform/configuration/common/configuration.js';\nimport { IContextKeyService } from '../../../../../platform/contextkey/common/contextkey.js';\nimport { IContextMenuService } from '../../../../../platform/contextview/browser/contextView.js';\nimport { IOpenEditorOptions, registerOpenEditorListeners } from '../../../../../platform/editor/browser/editor.js';\nimport { FileKind } from '../../../../../platform/files/common/files.js';\nimport { IHoverService } from '../../../../../platform/hover/browser/hover.js';\nimport { IInstantiationService } from '../../../../../platform/instantiation/common/instantiation.js';\nimport { ILabelService } from '../../../../../platform/label/common/label.js';\nimport { IMarkdownRenderer } from '../../../../../platform/markdown/browser/markdownRenderer.js';\nimport { IEditorService, SIDE_GROUP } from '../../../../services/editor/common/editorService.js';\nimport { AccessibilityWorkbenchSettingId } from '../../../accessibility/browser/accessibilityConfiguration.js';\nimport { IAiEditTelemetryService } from '../../../editTelemetry/browser/telemetry/aiEditTelemetry/aiEditTelemetryService.js';\nimport { MarkedKatexSupport } from '../../../markdown/browser/markedKatexSupport.js';\nimport { extractCodeblockUrisFromText, IMarkdownVulnerability } from '../../common/annotations.js';\nimport { IEditSessionEntryDiff } from '../../common/chatEditingService.js';\nimport { IChatProgressRenderableResponseContent } from '../../common/chatModel.js';\nimport { IChatMarkdownContent, IChatService, IChatUndoStop } from '../../common/chatService.js';\nimport { isRequestVM, isResponseVM } from '../../common/chatViewModel.js';\nimport { CodeBlockEntry, CodeBlockModelCollection } from '../../common/codeBlockModelCollection.js';\nimport { ChatConfiguration } from '../../common/constants.js';\nimport { IChatCodeBlockInfo } from '../chat.js';\nimport { allowedChatMarkdownHtmlTags } from '../chatContentMarkdownRenderer.js';\nimport { IMarkdownDiffBlockData, MarkdownDiffBlockPart, parseUnifiedDiff } from '../chatDiffBlockPart.js';\nimport { ChatEditingActionContext } from '../chatEditing/chatEditingActions.js';\nimport { ChatMarkdownDecorationsRenderer } from '../chatMarkdownDecorationsRenderer.js';\nimport { CodeBlockPart, ICodeBlockData, ICodeBlockRenderOptions, localFileLanguageId, parseLocalFileData } from '../codeBlockPart.js';\nimport '../media/chatCodeBlockPill.css';\nimport { IDisposableReference } from './chatCollections.js';\nimport { EditorPool } from './chatContentCodePools.js';\nimport { IChatContentPart, IChatContentPartRenderContext } from './chatContentParts.js';\nimport { ChatExtensionsContentPart } from './chatExtensionsContentPart.js';\nimport './media/chatMarkdownPart.css';\n\nconst $ = dom.$;\n\nexport interface IChatMarkdownContentPartOptions {\n\treadonly codeBlockRenderOptions?: ICodeBlockRenderOptions;\n\treadonly allowInlineDiffs?: boolean;\n\treadonly horizontalPadding?: number;\n\treadonly accessibilityOptions?: {\n\t\t/**\n\t\t * Message to announce to screen readers as a status update if VerboseChatProgressUpdates is enabled.\n\t\t * Will also be used as the aria-label for the container.\n\t\t * */\n\t\tstatusMessage?: string;\n\t};\n}\n\nexport class ChatMarkdownContentPart extends Disposable implements IChatContentPart {\n\n\tprivate static ID_POOL = 0;\n\n\treadonly codeblocksPartId = String(++ChatMarkdownContentPart.ID_POOL);\n\treadonly domNode: HTMLElement;\n\n\tprivate readonly allRefs: IDisposableReference<CodeBlockPart | CollapsedCodeBlock | MarkdownDiffBlockPart>[] = [];\n\n\tprivate readonly _onDidChangeHeight = this._register(new Emitter<void>());\n\treadonly onDidChangeHeight = this._onDidChangeHeight.event;\n\n\treadonly codeblocks: IChatCodeBlockInfo[] = [];\n\n\tprivate readonly mathLayoutParticipants = new Set<() => void>();\n\n\tconstructor(\n\t\tprivate readonly markdown: IChatMarkdownContent,\n\t\tcontext: IChatContentPartRenderContext,\n\t\tprivate readonly editorPool: EditorPool,\n\t\tfillInIncompleteTokens = false,\n\t\tcodeBlockStartIndex = 0,\n\t\trenderer: IMarkdownRenderer,\n\t\tmarkdownRenderOptions: MarkdownRenderOptions | undefined,\n\t\tcurrentWidth: number,\n\t\tprivate readonly codeBlockModelCollection: CodeBlockModelCollection,\n\t\tprivate readonly rendererOptions: IChatMarkdownContentPartOptions,\n\t\t@IContextKeyService contextKeyService: IContextKeyService,\n\t\t@IConfigurationService configurationService: IConfigurationService,\n\t\t@ITextModelService private readonly textModelService: ITextModelService,\n\t\t@IInstantiationService private readonly instantiationService: IInstantiationService,\n\t\t@IAiEditTelemetryService private readonly aiEditTelemetryService: IAiEditTelemetryService,\n\t) {\n\t\tsuper();\n\n\t\tconst element = context.element;\n\t\tconst inUndoStop = (findLast(context.content, e => e.kind === 'undoStop', context.contentIndex) as IChatUndoStop | undefined)?.id;\n\n\t\t// We release editors in order so that it's more likely that the same editor will\n\t\t// be assigned if this element is re-rendered right away, like it often is during\n\t\t// progressive rendering\n\t\tconst orderedDisposablesList: IDisposable[] = [];\n\n\t\t// Need to track the index of the codeblock within the response so it can have a unique ID,\n\t\t// and within this part to find it within the codeblocks array\n\t\tlet globalCodeBlockIndexStart = codeBlockStartIndex;\n\t\tlet thisPartCodeBlockIndexStart = 0;\n\n\t\tthis.domNode = $('div.chat-markdown-part');\n\n\t\tif (this.rendererOptions.accessibilityOptions?.statusMessage) {\n\t\t\tthis.domNode.ariaLabel = this.rendererOptions.accessibilityOptions.statusMessage;\n\t\t\tif (configurationService.getValue<boolean>(AccessibilityWorkbenchSettingId.VerboseChatProgressUpdates)) {\n\t\t\t\tstatus(this.rendererOptions.accessibilityOptions.statusMessage);\n\t\t\t}\n\t\t}\n\n\t\tconst enableMath = configurationService.getValue<boolean>(ChatConfiguration.EnableMath);\n\n\t\tconst doRenderMarkdown = () => {\n\t\t\tif (this._store.isDisposed) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// TODO: Move katex support into chatMarkdownRenderer\n\t\t\tconst markedExtensions = enableMath\n\t\t\t\t? coalesce([MarkedKatexSupport.getExtension(dom.getWindow(context.container), {\n\t\t\t\t\tthrowOnError: false\n\t\t\t\t})])\n\t\t\t\t: [];\n\n\t\t\t// Enables github-flavored-markdown + line breaks with single newlines\n\t\t\t// (which matches typical expectations but isn't \"proper\" in markdown)\n\t\t\tconst markedOpts: MarkdownRendererMarkedOptions = {\n\t\t\t\tgfm: true,\n\t\t\t\tbreaks: true,\n\t\t\t};\n\n\t\t\tconst result = this._register(renderer.render(markdown.content, {\n\t\t\t\tsanitizerConfig: MarkedKatexSupport.getSanitizerOptions({\n\t\t\t\t\tallowedTags: allowedChatMarkdownHtmlTags,\n\t\t\t\t\tallowedAttributes: allowedMarkdownHtmlAttributes,\n\t\t\t\t}),\n\t\t\t\tfillInIncompleteTokens,\n\t\t\t\tcodeBlockRendererSync: (languageId, text, raw) => {\n\t\t\t\t\tconst isCodeBlockComplete = !isResponseVM(context.element) || context.element.isComplete || !raw || codeblockHasClosingBackticks(raw);\n\t\t\t\t\tif ((!text || (text.startsWith('<vscode_codeblock_uri') && !text.includes('\\n'))) && !isCodeBlockComplete) {\n\t\t\t\t\t\tconst hideEmptyCodeblock = $('div');\n\t\t\t\t\t\thideEmptyCodeblock.style.display = 'none';\n\t\t\t\t\t\treturn hideEmptyCodeblock;\n\t\t\t\t\t}\n\t\t\t\t\tif (languageId === 'diff' && raw && this.rendererOptions.allowInlineDiffs) {\n\t\t\t\t\t\tconst match = raw.match(/^```diff:(\\w+)/);\n\t\t\t\t\t\tif (match && isResponseVM(context.element)) {\n\t\t\t\t\t\t\tconst actualLanguageId = match[1];\n\t\t\t\t\t\t\tconst codeBlockUri = extractCodeblockUrisFromText(text);\n\t\t\t\t\t\t\tconst { before, after } = parseUnifiedDiff(codeBlockUri?.textWithoutResult ?? text);\n\t\t\t\t\t\t\tconst diffData: IMarkdownDiffBlockData = {\n\t\t\t\t\t\t\t\telement: context.element,\n\t\t\t\t\t\t\t\tcodeBlockIndex: globalCodeBlockIndexStart++,\n\t\t\t\t\t\t\t\tlanguageId: actualLanguageId,\n\t\t\t\t\t\t\t\tbeforeContent: before,\n\t\t\t\t\t\t\t\tafterContent: after,\n\t\t\t\t\t\t\t\tcodeBlockResource: codeBlockUri?.uri,\n\t\t\t\t\t\t\t\tisReadOnly: true,\n\t\t\t\t\t\t\t\thorizontalPadding: this.rendererOptions.horizontalPadding,\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\tconst diffPart = this.instantiationService.createInstance(MarkdownDiffBlockPart, diffData, context.diffEditorPool, context.currentWidth());\n\t\t\t\t\t\t\tconst ref: IDisposableReference<MarkdownDiffBlockPart> = {\n\t\t\t\t\t\t\t\tobject: diffPart,\n\t\t\t\t\t\t\t\tisStale: () => false,\n\t\t\t\t\t\t\t\tdispose: () => diffPart.dispose()\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\tthis.allRefs.push(ref);\n\t\t\t\t\t\t\tthis._register(diffPart.onDidChangeContentHeight(() => this._onDidChangeHeight.fire()));\n\t\t\t\t\t\t\torderedDisposablesList.push(ref);\n\t\t\t\t\t\t\treturn diffPart.element;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif (languageId === 'vscode-extensions') {\n\t\t\t\t\t\tconst chatExtensions = this._register(instantiationService.createInstance(ChatExtensionsContentPart, { kind: 'extensions', extensions: text.split(',') }));\n\t\t\t\t\t\tthis._register(chatExtensions.onDidChangeHeight(() => this._onDidChangeHeight.fire()));\n\t\t\t\t\t\treturn chatExtensions.domNode;\n\t\t\t\t\t}\n\t\t\t\t\tconst globalIndex = globalCodeBlockIndexStart++;\n\t\t\t\t\tconst thisPartIndex = thisPartCodeBlockIndexStart++;\n\t\t\t\t\tlet textModel: Promise<ITextModel> | undefined;\n\t\t\t\t\tlet range: Range | undefined;\n\t\t\t\t\tlet vulns: readonly IMarkdownVulnerability[] | undefined;\n\t\t\t\t\tlet codeblockEntry: CodeBlockEntry | undefined;\n\t\t\t\t\tif (equalsIgnoreCase(languageId, localFileLanguageId)) {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tconst parsedBody = parseLocalFileData(text);\n\t\t\t\t\t\t\trange = parsedBody.range && Range.lift(parsedBody.range);\n\t\t\t\t\t\t\ttextModel = this.textModelService.createModelReference(parsedBody.uri).then(ref => ref.object.textEditorModel);\n\t\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\t\treturn $('div');\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif (isResponseVM(element) || isRequestVM(element)) {\n\t\t\t\t\t\t\tconst modelEntry = this.codeBlockModelCollection.getOrCreate(element.sessionResource, element, globalIndex);\n\t\t\t\t\t\t\tconst fastUpdateModelEntry = this.codeBlockModelCollection.updateSync(element.sessionResource, element, globalIndex, { text, languageId, isComplete: isCodeBlockComplete });\n\t\t\t\t\t\t\tvulns = modelEntry.vulns;\n\t\t\t\t\t\t\tcodeblockEntry = fastUpdateModelEntry;\n\t\t\t\t\t\t\ttextModel = modelEntry.model;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\ttextModel = undefined;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tconst hideToolbar = isResponseVM(element) && element.errorDetails?.responseIsFiltered;\n\t\t\t\t\tconst renderOptions = {\n\t\t\t\t\t\t...this.rendererOptions.codeBlockRenderOptions,\n\t\t\t\t\t};\n\t\t\t\t\tif (hideToolbar !== undefined) {\n\t\t\t\t\t\trenderOptions.hideToolbar = hideToolbar;\n\t\t\t\t\t}\n\t\t\t\t\tconst codeBlockInfo: ICodeBlockData = { languageId, textModel, codeBlockIndex: globalIndex, codeBlockPartIndex: thisPartIndex, element, range, parentContextKeyService: contextKeyService, vulns, codemapperUri: codeblockEntry?.codemapperUri, renderOptions, chatSessionResource: element.sessionResource };\n\n\t\t\t\t\tif (element.isCompleteAddedRequest || !codeblockEntry?.codemapperUri || !codeblockEntry.isEdit) {\n\t\t\t\t\t\tconst ref = this.renderCodeBlock(codeBlockInfo, text, isCodeBlockComplete, currentWidth);\n\t\t\t\t\t\tthis.allRefs.push(ref);\n\n\t\t\t\t\t\t// Attach this after updating text/layout of the editor, so it should only be fired when the size updates later (horizontal scrollbar, wrapping)\n\t\t\t\t\t\t// not during a renderElement OR a progressive render (when we will be firing this event anyway at the end of the render)\n\t\t\t\t\t\tthis._register(ref.object.onDidChangeContentHeight(() => this._onDidChangeHeight.fire()));\n\n\t\t\t\t\t\tconst ownerMarkdownPartId = this.codeblocksPartId;\n\t\t\t\t\t\tconst info: IChatCodeBlockInfo = new class implements IChatCodeBlockInfo {\n\t\t\t\t\t\t\treadonly ownerMarkdownPartId = ownerMarkdownPartId;\n\t\t\t\t\t\t\treadonly codeBlockIndex = globalIndex;\n\t\t\t\t\t\t\treadonly elementId = element.id;\n\t\t\t\t\t\t\treadonly chatSessionResource = element.sessionResource;\n\t\t\t\t\t\t\treadonly languageId = languageId;\n\t\t\t\t\t\t\treadonly editDeltaInfo = EditDeltaInfo.fromText(text);\n\t\t\t\t\t\t\tcodemapperUri = undefined; // will be set async\n\t\t\t\t\t\t\tget uri() {\n\t\t\t\t\t\t\t\t// here we must do a getter because the ref.object is rendered\n\t\t\t\t\t\t\t\t// async and the uri might be undefined when it's read immediately\n\t\t\t\t\t\t\t\treturn ref.object.uri;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\treadonly uriPromise = textModel?.then(model => model.uri) ?? Promise.resolve(undefined);\n\t\t\t\t\t\t\tfocus() {\n\t\t\t\t\t\t\t\tref.object.focus();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}();\n\t\t\t\t\t\tthis.codeblocks.push(info);\n\t\t\t\t\t\torderedDisposablesList.push(ref);\n\t\t\t\t\t\treturn ref.object.element;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tconst requestId = isRequestVM(element) ? element.id : element.requestId;\n\t\t\t\t\t\tconst ref = this.renderCodeBlockPill(element.sessionResource, requestId, inUndoStop, codeBlockInfo.codemapperUri, this.markdown.fromSubagent);\n\t\t\t\t\t\tif (isResponseVM(codeBlockInfo.element)) {\n\t\t\t\t\t\t\t// TODO@joyceerhl: remove this code when we change the codeblockUri API to make the URI available synchronously\n\t\t\t\t\t\t\tthis.codeBlockModelCollection.update(codeBlockInfo.element.sessionResource, codeBlockInfo.element, codeBlockInfo.codeBlockIndex, { text, languageId: codeBlockInfo.languageId, isComplete: isCodeBlockComplete }).then((e) => {\n\t\t\t\t\t\t\t\t// Update the existing object's codemapperUri\n\t\t\t\t\t\t\t\tthis.codeblocks[codeBlockInfo.codeBlockPartIndex].codemapperUri = e.codemapperUri;\n\t\t\t\t\t\t\t\tthis._onDidChangeHeight.fire();\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t\tthis.allRefs.push(ref);\n\t\t\t\t\t\tconst ownerMarkdownPartId = this.codeblocksPartId;\n\t\t\t\t\t\tconst info: IChatCodeBlockInfo = new class implements IChatCodeBlockInfo {\n\t\t\t\t\t\t\treadonly ownerMarkdownPartId = ownerMarkdownPartId;\n\t\t\t\t\t\t\treadonly codeBlockIndex = globalIndex;\n\t\t\t\t\t\t\treadonly elementId = element.id;\n\t\t\t\t\t\t\treadonly codemapperUri = codeblockEntry?.codemapperUri;\n\t\t\t\t\t\t\treadonly chatSessionResource = element.sessionResource;\n\t\t\t\t\t\t\tget uri() {\n\t\t\t\t\t\t\t\treturn undefined;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\treadonly uriPromise = Promise.resolve(undefined);\n\t\t\t\t\t\t\tfocus() {\n\t\t\t\t\t\t\t\treturn ref.object.element.focus();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\treadonly languageId = languageId;\n\t\t\t\t\t\t\treadonly editDeltaInfo = EditDeltaInfo.fromText(text);\n\t\t\t\t\t\t}();\n\t\t\t\t\t\tthis.codeblocks.push(info);\n\t\t\t\t\t\torderedDisposablesList.push(ref);\n\t\t\t\t\t\treturn ref.object.element;\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tasyncRenderCallback: () => this._onDidChangeHeight.fire(),\n\t\t\t\tmarkedOptions: markedOpts,\n\t\t\t\tmarkedExtensions,\n\t\t\t\t...markdownRenderOptions,\n\t\t\t}, this.domNode));\n\n\t\t\t// Ideally this would happen earlier, but we need to parse the markdown.\n\t\t\tif (isResponseVM(element) && !element.model.codeBlockInfos && element.model.isComplete) {\n\t\t\t\telement.model.initializeCodeBlockInfos(this.codeblocks.map(info => {\n\t\t\t\t\treturn {\n\t\t\t\t\t\tsuggestionId: this.aiEditTelemetryService.createSuggestionId({\n\t\t\t\t\t\t\tpresentation: 'codeBlock',\n\t\t\t\t\t\t\tfeature: 'sideBarChat',\n\t\t\t\t\t\t\teditDeltaInfo: info.editDeltaInfo,\n\t\t\t\t\t\t\tlanguageId: info.languageId,\n\t\t\t\t\t\t\tmodeId: element.model.request?.modeInfo?.modeId,\n\t\t\t\t\t\t\tmodelId: element.model.request?.modelId,\n\t\t\t\t\t\t\tapplyCodeBlockSuggestionId: undefined,\n\t\t\t\t\t\t\tsource: undefined,\n\t\t\t\t\t\t})\n\t\t\t\t\t};\n\t\t\t\t}));\n\t\t\t}\n\n\t\t\tconst markdownDecorationsRenderer = instantiationService.createInstance(ChatMarkdownDecorationsRenderer);\n\t\t\tthis._register(markdownDecorationsRenderer.walkTreeAndAnnotateReferenceLinks(markdown, result.element));\n\n\t\t\tconst layoutParticipants = new Lazy(() => {\n\t\t\t\tconst observer = new ResizeObserver(() => this.mathLayoutParticipants.forEach(layout => layout()));\n\t\t\t\tobserver.observe(this.domNode);\n\t\t\t\tthis._register(toDisposable(() => observer.disconnect()));\n\t\t\t\treturn this.mathLayoutParticipants;\n\t\t\t});\n\n\t\t\t// Make katex blocks horizontally scrollable\n\t\t\t// eslint-disable-next-line no-restricted-syntax\n\t\t\tfor (const katexBlock of this.domNode.querySelectorAll('.katex-display')) {\n\t\t\t\tif (!dom.isHTMLElement(katexBlock)) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tconst scrollable = new DomScrollableElement(katexBlock.cloneNode(true) as HTMLElement, {\n\t\t\t\t\tvertical: ScrollbarVisibility.Hidden,\n\t\t\t\t\thorizontal: ScrollbarVisibility.Auto,\n\t\t\t\t});\n\t\t\t\torderedDisposablesList.push(scrollable);\n\t\t\t\tkatexBlock.replaceWith(scrollable.getDomNode());\n\n\t\t\t\tlayoutParticipants.value.add(() => { scrollable.scanDomNode(); });\n\t\t\t\tscrollable.scanDomNode();\n\t\t\t}\n\n\t\t\torderedDisposablesList.reverse().forEach(d => this._register(d));\n\t\t};\n\n\t\tif (enableMath && !MarkedKatexSupport.getExtension(dom.getWindow(context.container))) {\n\t\t\t// Need to load async\n\t\t\tMarkedKatexSupport.loadExtension(dom.getWindow(context.container))\n\t\t\t\t.catch(e => {\n\t\t\t\t\tconsole.error('Failed to load MarkedKatexSupport extension:', e);\n\t\t\t\t}).finally(() => {\n\t\t\t\t\tdoRenderMarkdown();\n\t\t\t\t\tif (!this._store.isDisposed) {\n\t\t\t\t\t\tthis._onDidChangeHeight.fire();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t} else {\n\t\t\tdoRenderMarkdown();\n\t\t}\n\t}\n\n\tprivate renderCodeBlockPill(sessionResource: URI, requestId: string, inUndoStop: string | undefined, codemapperUri: URI | undefined, fromSubagent?: boolean): IDisposableReference<CollapsedCodeBlock> {\n\t\tconst codeBlock = this.instantiationService.createInstance(CollapsedCodeBlock, sessionResource, requestId, inUndoStop);\n\t\tif (codemapperUri) {\n\t\t\tcodeBlock.render(codemapperUri, fromSubagent);\n\t\t}\n\t\treturn {\n\t\t\tobject: codeBlock,\n\t\t\tisStale: () => false,\n\t\t\tdispose: () => codeBlock.dispose()\n\t\t};\n\t}\n\n\tprivate renderCodeBlock(data: ICodeBlockData, text: string, isComplete: boolean, currentWidth: number): IDisposableReference<CodeBlockPart> {\n\t\tconst ref = this.editorPool.get();\n\t\tconst editorInfo = ref.object;\n\t\tif (isResponseVM(data.element)) {\n\t\t\tthis.codeBlockModelCollection.update(data.element.sessionResource, data.element, data.codeBlockIndex, { text, languageId: data.languageId, isComplete }).then((e) => {\n\t\t\t\t// Update the existing object's codemapperUri\n\t\t\t\tthis.codeblocks[data.codeBlockPartIndex].codemapperUri = e.codemapperUri;\n\t\t\t\tthis._onDidChangeHeight.fire();\n\t\t\t});\n\t\t}\n\n\t\teditorInfo.render(data, currentWidth).then(() => {\n\t\t\tthis._onDidChangeHeight.fire();\n\t\t});\n\n\t\treturn ref;\n\t}\n\n\thasSameContent(other: IChatProgressRenderableResponseContent): boolean {\n\t\treturn other.kind === 'markdownContent' && !!(other.content.value === this.markdown.content.value\n\t\t\t|| this.codeblocks.at(-1)?.codemapperUri !== undefined && other.content.value.lastIndexOf('```') === this.markdown.content.value.lastIndexOf('```'));\n\t}\n\n\tlayout(width: number): void {\n\t\tthis.allRefs.forEach((ref, index) => {\n\t\t\tif (ref.object instanceof CodeBlockPart) {\n\t\t\t\tref.object.layout(width);\n\t\t\t} else if (ref.object instanceof MarkdownDiffBlockPart) {\n\t\t\t\tref.object.layout(width);\n\t\t\t} else if (ref.object instanceof CollapsedCodeBlock) {\n\t\t\t\tconst codeblockModel = this.codeblocks[index];\n\t\t\t\tif (codeblockModel.codemapperUri && ref.object.uri?.toString() !== codeblockModel.codemapperUri.toString()) {\n\t\t\t\t\tref.object.render(codeblockModel.codemapperUri);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tthis.mathLayoutParticipants.forEach(layout => layout());\n\t}\n\n\taddDisposable(disposable: IDisposable): void {\n\t\tthis._register(disposable);\n\t}\n}\n\nexport function codeblockHasClosingBackticks(str: string): boolean {\n\tstr = str.trim();\n\treturn !!str.match(/\\n```+$/);\n}\n\nexport class CollapsedCodeBlock extends Disposable {\n\n\treadonly element: HTMLElement;\n\tprivate readonly pillElement: HTMLElement;\n\tprivate readonly statusIndicatorContainer: HTMLElement;\n\n\tprivate _uri: URI | undefined;\n\tget uri(): URI | undefined { return this._uri; }\n\n\tprivate readonly hover = this._register(new MutableDisposable());\n\tprivate tooltip: string | undefined;\n\n\tprivate currentDiff: IEditSessionEntryDiff | undefined;\n\n\tprivate readonly progressStore = this._store.add(new DisposableStore());\n\n\tconstructor(\n\t\tprivate readonly sessionResource: URI,\n\t\tprivate readonly requestId: string,\n\t\tprivate readonly inUndoStop: string | undefined,\n\t\t@ILabelService private readonly labelService: ILabelService,\n\t\t@IEditorService private readonly editorService: IEditorService,\n\t\t@IModelService private readonly modelService: IModelService,\n\t\t@ILanguageService private readonly languageService: ILanguageService,\n\t\t@IContextMenuService private readonly contextMenuService: IContextMenuService,\n\t\t@IContextKeyService private readonly contextKeyService: IContextKeyService,\n\t\t@IMenuService private readonly menuService: IMenuService,\n\t\t@IHoverService private readonly hoverService: IHoverService,\n\t\t@IChatService private readonly chatService: IChatService,\n\t\t@IConfigurationService private readonly configurationService: IConfigurationService,\n\t) {\n\t\tsuper();\n\n\t\tthis.element = $('div.chat-codeblock-pill-container');\n\n\t\tthis.statusIndicatorContainer = $('div.status-indicator-container');\n\n\t\tthis.pillElement = $('.chat-codeblock-pill-widget');\n\t\tthis.pillElement.tabIndex = 0;\n\t\tthis.pillElement.classList.add('show-file-icons');\n\t\tthis.pillElement.role = 'button';\n\n\t\tthis.element.appendChild(this.statusIndicatorContainer);\n\t\tthis.element.appendChild(this.pillElement);\n\n\t\tthis.registerListeners();\n\t}\n\n\tprivate registerListeners(): void {\n\t\tthis._register(registerOpenEditorListeners(this.pillElement, e => this.showDiff(e)));\n\n\t\tthis._register(dom.addDisposableListener(this.pillElement, dom.EventType.CONTEXT_MENU, e => {\n\t\t\tconst event = new StandardMouseEvent(dom.getWindow(e), e);\n\t\t\tdom.EventHelper.stop(e, true);\n\n\t\t\tthis.contextMenuService.showContextMenu({\n\t\t\t\tcontextKeyService: this.contextKeyService,\n\t\t\t\tgetAnchor: () => event,\n\t\t\t\tgetActions: () => {\n\t\t\t\t\tif (!this.uri) {\n\t\t\t\t\t\treturn [];\n\t\t\t\t\t}\n\n\t\t\t\t\tconst menu = this.menuService.getMenuActions(MenuId.ChatEditingCodeBlockContext, this.contextKeyService, {\n\t\t\t\t\t\targ: {\n\t\t\t\t\t\t\tsessionResource: this.sessionResource,\n\t\t\t\t\t\t\trequestId: this.requestId,\n\t\t\t\t\t\t\turi: this.uri,\n\t\t\t\t\t\t\tstopId: this.inUndoStop\n\t\t\t\t\t\t} satisfies ChatEditingActionContext\n\t\t\t\t\t});\n\n\t\t\t\t\treturn getFlatContextMenuActions(menu);\n\t\t\t\t},\n\t\t\t});\n\t\t}));\n\t}\n\n\tprivate showDiff({ editorOptions: options, openToSide }: IOpenEditorOptions): void {\n\t\tif (this.currentDiff) {\n\t\t\tthis.editorService.openEditor({\n\t\t\t\toriginal: { resource: this.currentDiff.originalURI },\n\t\t\t\tmodified: { resource: this.currentDiff.modifiedURI },\n\t\t\t\toptions\n\t\t\t}, openToSide ? SIDE_GROUP : undefined);\n\t\t} else if (this.uri) {\n\t\t\tthis.editorService.openEditor({ resource: this.uri, options }, openToSide ? SIDE_GROUP : undefined);\n\t\t}\n\t}\n\n\t/**\n\t * @param uri URI of the file on-disk being changed\n\t * @param isStreaming Whether the edit has completed (at the time of this being rendered)\n\t */\n\trender(uri: URI, fromSubagent?: boolean): void {\n\t\tthis.pillElement.classList.toggle('from-sub-agent', !!fromSubagent);\n\n\t\tthis.progressStore.clear();\n\n\t\tthis._uri = uri;\n\n\t\tconst session = this.chatService.getSession(this.sessionResource);\n\t\tconst iconText = this.labelService.getUriBasenameLabel(uri);\n\n\t\tconst statusIconEl = dom.$('span.status-icon');\n\t\tconst statusLabelEl = dom.$('span.status-label', {}, '');\n\n\t\tthis.statusIndicatorContainer.replaceChildren(statusIconEl, statusLabelEl);\n\n\t\tconst iconEl = dom.$('span.icon');\n\t\tconst iconLabelEl = dom.$('span.icon-label', {}, iconText);\n\t\tconst labelDetail = dom.$('span.label-detail', {}, '');\n\n\t\t// Create a progress fill element for the animation\n\t\tconst progressFill = dom.$('span.progress-fill');\n\t\tthis.pillElement.replaceChildren(progressFill, iconEl, iconLabelEl, labelDetail);\n\t\tconst tooltipLabel = this.labelService.getUriLabel(uri, { relative: true });\n\t\tthis.updateTooltip(tooltipLabel);\n\n\t\tconst editSession = session?.editingSession;\n\t\tif (!editSession) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst diffObservable = derived(reader => {\n\t\t\tconst entry = editSession.readEntry(uri, reader);\n\t\t\treturn entry && editSession.getEntryDiffBetweenStops(entry.modifiedURI, this.requestId, this.inUndoStop);\n\t\t}).map((d, r) => d?.read(r));\n\n\t\tconst isStreaming = derived(r => {\n\t\t\tconst entry = editSession.readEntry(uri, r);\n\t\t\tconst currentlyModified = entry?.isCurrentlyBeingModifiedBy.read(r);\n\t\t\treturn !!currentlyModified && currentlyModified.responseModel.requestId === this.requestId && currentlyModified.undoStopId === this.inUndoStop;\n\t\t});\n\n\t\t// Set the icon/classes while edits are streaming\n\t\tlet statusIconClasses: string[] = [];\n\t\tlet pillIconClasses: string[] = [];\n\t\tthis.progressStore.add(autorun(r => {\n\t\t\tstatusIconEl.classList.remove(...statusIconClasses);\n\t\t\ticonEl.classList.remove(...pillIconClasses);\n\t\t\tif (isStreaming.read(r)) {\n\t\t\t\tconst codicon = ThemeIcon.modify(Codicon.loading, 'spin');\n\t\t\t\tstatusIconClasses = ThemeIcon.asClassNameArray(codicon);\n\t\t\t\tstatusIconEl.classList.add(...statusIconClasses);\n\t\t\t\tconst entry = editSession.readEntry(uri, r);\n\t\t\t\tconst rwRatio = Math.floor((entry?.rewriteRatio.read(r) || 0) * 100);\n\t\t\t\tstatusLabelEl.textContent = localize('chat.codeblock.applyingEdits', 'Applying edits');\n\n\t\t\t\tconst showAnimation = this.configurationService.getValue<boolean>(ChatConfiguration.ShowCodeBlockProgressAnimation);\n\t\t\t\tif (showAnimation) {\n\t\t\t\t\tprogressFill.style.width = `${rwRatio}%`;\n\t\t\t\t\tthis.pillElement.classList.add('progress-filling');\n\t\t\t\t\tlabelDetail.textContent = '';\n\t\t\t\t} else {\n\t\t\t\t\tprogressFill.style.width = '0%';\n\t\t\t\t\tthis.pillElement.classList.remove('progress-filling');\n\t\t\t\t\tlabelDetail.textContent = rwRatio === 0 || !rwRatio ? localize('chat.codeblock.generating', \"Generating edits...\") : localize('chat.codeblock.applyingPercentage', \"({0}%)...\", rwRatio);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tconst statusCodeicon = Codicon.check;\n\t\t\t\tstatusIconClasses = ThemeIcon.asClassNameArray(statusCodeicon);\n\t\t\t\tstatusIconEl.classList.add(...statusIconClasses);\n\t\t\t\tstatusLabelEl.textContent = localize('chat.codeblock.edited', 'Edited');\n\t\t\t\tconst fileKind = uri.path.endsWith('/') ? FileKind.FOLDER : FileKind.FILE;\n\t\t\t\tpillIconClasses = getIconClasses(this.modelService, this.languageService, uri, fileKind);\n\t\t\t\ticonEl.classList.add(...pillIconClasses);\n\t\t\t\tthis.pillElement.classList.remove('progress-filling');\n\t\t\t\tprogressFill.style.width = '0%';\n\t\t\t\tlabelDetail.textContent = '';\n\t\t\t}\n\t\t}));\n\n\t\t// Render the +/- diff\n\t\tthis.progressStore.add(autorunSelfDisposable(r => {\n\t\t\tconst changes = diffObservable.read(r);\n\t\t\tif (changes === undefined) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// eslint-disable-next-line no-restricted-syntax\n\t\t\tconst labelAdded = this.pillElement.querySelector('.label-added') ?? this.pillElement.appendChild(dom.$('span.label-added'));\n\t\t\t// eslint-disable-next-line no-restricted-syntax\n\t\t\tconst labelRemoved = this.pillElement.querySelector('.label-removed') ?? this.pillElement.appendChild(dom.$('span.label-removed'));\n\t\t\tif (changes && !changes?.identical && !changes?.quitEarly) {\n\t\t\t\tthis.currentDiff = changes;\n\t\t\t\tlabelAdded.textContent = `+${changes.added}`;\n\t\t\t\tlabelRemoved.textContent = `-${changes.removed}`;\n\t\t\t\tconst insertionsFragment = changes.added === 1 ? localize('chat.codeblock.insertions.one', \"1 insertion\") : localize('chat.codeblock.insertions', \"{0} insertions\", changes.added);\n\t\t\t\tconst deletionsFragment = changes.removed === 1 ? localize('chat.codeblock.deletions.one', \"1 deletion\") : localize('chat.codeblock.deletions', \"{0} deletions\", changes.removed);\n\t\t\t\tconst summary = localize('summary', 'Edited {0}, {1}, {2}', iconText, insertionsFragment, deletionsFragment);\n\t\t\t\tthis.element.ariaLabel = summary;\n\n\t\t\t\t// No need to keep updating once we get the diff info\n\t\t\t\tif (changes.isFinal) {\n\t\t\t\t\tr.dispose();\n\t\t\t\t}\n\t\t\t}\n\t\t}));\n\t}\n\n\tprivate updateTooltip(tooltip: string): void {\n\t\tthis.tooltip = tooltip;\n\n\t\tif (!this.hover.value) {\n\t\t\tthis.hover.value = this.hoverService.setupDelayedHover(this.pillElement, () => ({\n\t\t\t\tcontent: this.tooltip!,\n\t\t\t\tstyle: HoverStyle.Pointer,\n\t\t\t\tposition: { hoverPosition: HoverPosition.BELOW },\n\t\t\t\tpersistence: { hideOnKeyDown: true },\n\t\t\t}));\n\t\t}\n\t}\n}\n"]}