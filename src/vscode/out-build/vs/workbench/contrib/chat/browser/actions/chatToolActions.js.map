{"version":3,"sources":["vs/workbench/contrib/chat/browser/actions/chatToolActions.ts"],"names":[],"mappings":"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","file":"chatToolActions.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { $ } from '../../../../../base/browser/dom.js';\nimport { Codicon } from '../../../../../base/common/codicons.js';\nimport { Iterable } from '../../../../../base/common/iterator.js';\nimport { KeyCode, KeyMod } from '../../../../../base/common/keyCodes.js';\nimport { markAsSingleton } from '../../../../../base/common/lifecycle.js';\nimport { ThemeIcon } from '../../../../../base/common/themables.js';\nimport { ServicesAccessor } from '../../../../../editor/browser/editorExtensions.js';\nimport { localize, localize2 } from '../../../../../nls.js';\nimport { IActionViewItemService } from '../../../../../platform/actions/browser/actionViewItemService.js';\nimport { MenuEntryActionViewItem } from '../../../../../platform/actions/browser/menuEntryActionViewItem.js';\nimport { Action2, MenuId, MenuItemAction, registerAction2 } from '../../../../../platform/actions/common/actions.js';\nimport { ContextKeyExpr } from '../../../../../platform/contextkey/common/contextkey.js';\nimport { IInstantiationService } from '../../../../../platform/instantiation/common/instantiation.js';\nimport { KeybindingWeight } from '../../../../../platform/keybinding/common/keybindingsRegistry.js';\nimport { ITelemetryService } from '../../../../../platform/telemetry/common/telemetry.js';\nimport { IWorkbenchContribution, registerWorkbenchContribution2, WorkbenchPhase } from '../../../../common/contributions.js';\nimport { ChatContextKeys } from '../../common/chatContextKeys.js';\nimport { ConfirmedReason, IChatToolInvocation, ToolConfirmKind } from '../../common/chatService.js';\nimport { isResponseVM } from '../../common/chatViewModel.js';\nimport { ChatModeKind } from '../../common/constants.js';\nimport { IChatWidget, IChatWidgetService } from '../chat.js';\nimport { ToolsScope } from '../chatSelectedTools.js';\nimport { CHAT_CATEGORY } from './chatActions.js';\nimport { showToolsPicker } from './chatToolPicker.js';\n\n\ntype SelectedToolData = {\n\tenabled: number;\n\ttotal: number;\n};\ntype SelectedToolClassification = {\n\towner: 'connor4312';\n\tcomment: 'Details the capabilities of the MCP server';\n\tenabled: { classification: 'SystemMetaData'; purpose: 'FeatureInsight'; comment: 'Number of enabled chat tools' };\n\ttotal: { classification: 'SystemMetaData'; purpose: 'FeatureInsight'; comment: 'Number of total chat tools' };\n};\n\nexport const AcceptToolConfirmationActionId = 'workbench.action.chat.acceptTool';\nexport const SkipToolConfirmationActionId = 'workbench.action.chat.skipTool';\nexport const AcceptToolPostConfirmationActionId = 'workbench.action.chat.acceptToolPostExecution';\nexport const SkipToolPostConfirmationActionId = 'workbench.action.chat.skipToolPostExecution';\n\nabstract class ToolConfirmationAction extends Action2 {\n\tprotected abstract getReason(): ConfirmedReason;\n\n\trun(accessor: ServicesAccessor, ...args: unknown[]) {\n\t\tconst chatWidgetService = accessor.get(IChatWidgetService);\n\t\tconst widget = chatWidgetService.lastFocusedWidget;\n\t\tconst lastItem = widget?.viewModel?.getItems().at(-1);\n\t\tif (!isResponseVM(lastItem)) {\n\t\t\treturn;\n\t\t}\n\n\t\tfor (const item of lastItem.model.response.value) {\n\t\t\tconst state = item.kind === 'toolInvocation' ? item.state.get() : undefined;\n\t\t\tif (state?.type === IChatToolInvocation.StateKind.WaitingForConfirmation || state?.type === IChatToolInvocation.StateKind.WaitingForPostApproval) {\n\t\t\t\tstate.confirm(this.getReason());\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\t// Return focus to the chat input, in case it was in the tool confirmation editor\n\t\twidget?.focusInput();\n\t}\n}\n\nclass AcceptToolConfirmation extends ToolConfirmationAction {\n\tconstructor() {\n\t\tsuper({\n\t\t\tid: AcceptToolConfirmationActionId,\n\t\t\ttitle: localize2('chat.accept', \"Accept\"),\n\t\t\tf1: false,\n\t\t\tcategory: CHAT_CATEGORY,\n\t\t\tkeybinding: {\n\t\t\t\twhen: ContextKeyExpr.and(ChatContextKeys.inChatSession, ChatContextKeys.Editing.hasToolConfirmation),\n\t\t\t\tprimary: KeyMod.CtrlCmd | KeyCode.Enter,\n\t\t\t\t// Override chatEditor.action.accept\n\t\t\t\tweight: KeybindingWeight.WorkbenchContrib + 1,\n\t\t\t},\n\t\t});\n\t}\n\n\tprotected override getReason(): ConfirmedReason {\n\t\treturn { type: ToolConfirmKind.UserAction };\n\t}\n}\n\nclass SkipToolConfirmation extends ToolConfirmationAction {\n\tconstructor() {\n\t\tsuper({\n\t\t\tid: SkipToolConfirmationActionId,\n\t\t\ttitle: localize2('chat.skip', \"Skip\"),\n\t\t\tf1: false,\n\t\t\tcategory: CHAT_CATEGORY,\n\t\t\tkeybinding: {\n\t\t\t\twhen: ContextKeyExpr.and(ChatContextKeys.inChatSession, ChatContextKeys.Editing.hasToolConfirmation),\n\t\t\t\tprimary: KeyMod.CtrlCmd | KeyCode.Enter | KeyMod.Alt,\n\t\t\t\t// Override chatEditor.action.accept\n\t\t\t\tweight: KeybindingWeight.WorkbenchContrib + 1,\n\t\t\t},\n\t\t});\n\t}\n\n\tprotected override getReason(): ConfirmedReason {\n\t\treturn { type: ToolConfirmKind.Skipped };\n\t}\n}\n\nclass ConfigureToolsAction extends Action2 {\n\tpublic static ID = 'workbench.action.chat.configureTools';\n\n\tconstructor() {\n\t\tsuper({\n\t\t\tid: ConfigureToolsAction.ID,\n\t\t\ttitle: localize('label', \"Configure Tools...\"),\n\t\t\ticon: Codicon.tools,\n\t\t\tf1: false,\n\t\t\tcategory: CHAT_CATEGORY,\n\t\t\tprecondition: ChatContextKeys.chatModeKind.isEqualTo(ChatModeKind.Agent),\n\t\t\tmenu: [{\n\t\t\t\twhen: ContextKeyExpr.and(ChatContextKeys.chatModeKind.isEqualTo(ChatModeKind.Agent), ChatContextKeys.lockedToCodingAgent.negate()),\n\t\t\t\tid: MenuId.ChatInput,\n\t\t\t\tgroup: 'navigation',\n\t\t\t\torder: 100,\n\t\t\t}]\n\t\t});\n\t}\n\n\toverride async run(accessor: ServicesAccessor, ...args: unknown[]): Promise<void> {\n\n\t\tconst instaService = accessor.get(IInstantiationService);\n\t\tconst chatWidgetService = accessor.get(IChatWidgetService);\n\t\tconst telemetryService = accessor.get(ITelemetryService);\n\n\t\tlet widget = chatWidgetService.lastFocusedWidget;\n\t\tif (!widget) {\n\t\t\ttype ChatActionContext = { widget: IChatWidget };\n\t\t\tfunction isChatActionContext(obj: unknown): obj is ChatActionContext {\n\t\t\t\treturn !!obj && typeof obj === 'object' && !!(obj as ChatActionContext).widget;\n\t\t\t}\n\t\t\tconst context = args[0];\n\t\t\tif (isChatActionContext(context)) {\n\t\t\t\twidget = context.widget;\n\t\t\t}\n\t\t}\n\n\t\tif (!widget) {\n\t\t\treturn;\n\t\t}\n\n\t\tlet placeholder;\n\t\tlet description;\n\t\tconst { entriesScope, entriesMap } = widget.input.selectedToolsModel;\n\t\tswitch (entriesScope) {\n\t\t\tcase ToolsScope.Session:\n\t\t\t\tplaceholder = localize('chat.tools.placeholder.session', \"Select tools for this chat session\");\n\t\t\t\tdescription = localize('chat.tools.description.session', \"The selected tools were configured only for this chat session.\");\n\t\t\t\tbreak;\n\t\t\tcase ToolsScope.Agent:\n\t\t\t\tplaceholder = localize('chat.tools.placeholder.agent', \"Select tools for this custom agent\");\n\t\t\t\tdescription = localize('chat.tools.description.agent', \"The selected tools are configured by the '{0}' custom agent. Changes to the tools will be applied to the custom agent file as well.\", widget.input.currentModeObs.get().label.get());\n\t\t\t\tbreak;\n\t\t\tcase ToolsScope.Agent_ReadOnly:\n\t\t\t\tplaceholder = localize('chat.tools.placeholder.readOnlyAgent', \"Select tools for this custom agent\");\n\t\t\t\tdescription = localize('chat.tools.description.readOnlyAgent', \"The selected tools are configured by the '{0}' custom agent. Changes to the tools will only be used for this session and will not change the '{0}' custom agent.\", widget.input.currentModeObs.get().label.get());\n\t\t\t\tbreak;\n\t\t\tcase ToolsScope.Global:\n\t\t\t\tplaceholder = localize('chat.tools.placeholder.global', \"Select tools that are available to chat.\");\n\t\t\t\tdescription = localize('chat.tools.description.global', \"The selected tools will be applied globally for all chat sessions that use the default agent.\");\n\t\t\t\tbreak;\n\n\t\t}\n\n\t\tconst result = await instaService.invokeFunction(showToolsPicker, placeholder, description, () => entriesMap.get());\n\t\tif (result) {\n\t\t\twidget.input.selectedToolsModel.set(result, false);\n\t\t}\n\n\t\tconst tools = widget.input.selectedToolsModel.entriesMap.get();\n\t\ttelemetryService.publicLog2<SelectedToolData, SelectedToolClassification>('chat/selectedTools', {\n\t\t\ttotal: tools.size,\n\t\t\tenabled: Iterable.reduce(tools, (prev, [_, enabled]) => enabled ? prev + 1 : prev, 0),\n\t\t});\n\t}\n}\n\nclass ConfigureToolsActionRendering implements IWorkbenchContribution {\n\n\tstatic readonly ID = 'chat.configureToolsActionRendering';\n\n\tconstructor(\n\t\t@IActionViewItemService actionViewItemService: IActionViewItemService,\n\t) {\n\t\tconst disposable = actionViewItemService.register(MenuId.ChatInput, ConfigureToolsAction.ID, (action, _opts, instantiationService) => {\n\t\t\tif (!(action instanceof MenuItemAction)) {\n\t\t\t\treturn undefined;\n\t\t\t}\n\t\t\treturn instantiationService.createInstance(class extends MenuEntryActionViewItem {\n\t\t\t\tprivate warningElement!: HTMLElement;\n\n\t\t\t\toverride render(container: HTMLElement): void {\n\t\t\t\t\tsuper.render(container);\n\n\t\t\t\t\t// Add warning indicator element\n\t\t\t\t\tthis.warningElement = $(`.tool-warning-indicator${ThemeIcon.asCSSSelector(Codicon.warning)}`);\n\t\t\t\t\tthis.warningElement.style.display = 'none';\n\t\t\t\t\tcontainer.appendChild(this.warningElement);\n\t\t\t\t\tcontainer.style.position = 'relative';\n\n\t\t\t\t\t// Set up context key listeners\n\t\t\t\t\tthis.updateWarningState();\n\t\t\t\t\tthis._register(this._contextKeyService.onDidChangeContext(() => {\n\t\t\t\t\t\tthis.updateWarningState();\n\t\t\t\t\t}));\n\t\t\t\t}\n\n\t\t\t\tprivate updateWarningState(): void {\n\t\t\t\t\tconst wasShown = this.warningElement.style.display === 'block';\n\t\t\t\t\tconst shouldBeShown = this.isAboveToolLimit();\n\n\t\t\t\t\tif (!wasShown && shouldBeShown) {\n\t\t\t\t\t\tthis.warningElement.style.display = 'block';\n\t\t\t\t\t\tthis.updateTooltip();\n\t\t\t\t\t} else if (wasShown && !shouldBeShown) {\n\t\t\t\t\t\tthis.warningElement.style.display = 'none';\n\t\t\t\t\t\tthis.updateTooltip();\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tprotected override getTooltip(): string {\n\t\t\t\t\tif (this.isAboveToolLimit()) {\n\t\t\t\t\t\tconst warningMessage = localize('chatTools.tooManyEnabled', 'More than {0} tools are enabled, you may experience degraded tool calling.', this._contextKeyService.getContextKeyValue(ChatContextKeys.chatToolGroupingThreshold.key));\n\t\t\t\t\t\treturn `${warningMessage}`;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn super.getTooltip();\n\t\t\t\t}\n\n\t\t\t\tprivate isAboveToolLimit() {\n\t\t\t\t\tconst rawToolLimit = this._contextKeyService.getContextKeyValue(ChatContextKeys.chatToolGroupingThreshold.key);\n\t\t\t\t\tconst rawToolCount = this._contextKeyService.getContextKeyValue(ChatContextKeys.chatToolCount.key);\n\t\t\t\t\tif (rawToolLimit === undefined || rawToolCount === undefined) {\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\tconst toolLimit = Number(rawToolLimit || 0);\n\t\t\t\t\tconst toolCount = Number(rawToolCount || 0);\n\t\t\t\t\treturn toolCount > toolLimit;\n\t\t\t\t}\n\t\t\t}, action, undefined);\n\t\t});\n\n\t\t// Reduces flicker a bit on reload/restart\n\t\tmarkAsSingleton(disposable);\n\t}\n}\n\nexport function registerChatToolActions() {\n\tregisterAction2(AcceptToolConfirmation);\n\tregisterAction2(SkipToolConfirmation);\n\tregisterAction2(ConfigureToolsAction);\n\tregisterWorkbenchContribution2(ConfigureToolsActionRendering.ID, ConfigureToolsActionRendering, WorkbenchPhase.BlockRestore);\n}\n"]}