{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/contrib/chat/browser/chatDiffBlockPart.ts","vs/workbench/contrib/chat/browser/chatDiffBlockPart.ts"],"names":[],"mappings":"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","file":"chatDiffBlockPart.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { CancellationToken } from '../../../../base/common/cancellation.js';\nimport { Emitter } from '../../../../base/common/event.js';\nimport { hashAsync } from '../../../../base/common/hash.js';\nimport { Disposable, IReference, MutableDisposable } from '../../../../base/common/lifecycle.js';\nimport { Schemas } from '../../../../base/common/network.js';\nimport { URI } from '../../../../base/common/uri.js';\nimport { generateUuid } from '../../../../base/common/uuid.js';\nimport { ILanguageService } from '../../../../editor/common/languages/language.js';\nimport { ITextModel } from '../../../../editor/common/model.js';\nimport { IModelService } from '../../../../editor/common/services/model.js';\nimport { IResolvedTextEditorModel, ITextModelService } from '../../../../editor/common/services/resolverService.js';\nimport { EditorModel } from '../../../common/editor/editorModel.js';\nimport { IChatResponseViewModel } from '../common/chatViewModel.js';\nimport { IDisposableReference } from './chatContentParts/chatCollections.js';\nimport { DiffEditorPool } from './chatContentParts/chatContentCodePools.js';\nimport { CodeCompareBlockPart, ICodeCompareBlockData, ICodeCompareBlockDiffData } from './codeBlockPart.js';\n\n/**\n * Parses unified diff format into before/after content.\n * Supports standard unified diff format with - and + prefixes.\n */\nexport function parseUnifiedDiff(diffText: string): { before: string; after: string } {\n\tconst lines = diffText.split('\\n');\n\tconst beforeLines: string[] = [];\n\tconst afterLines: string[] = [];\n\n\tfor (const line of lines) {\n\t\tif (line.startsWith('- ')) {\n\t\t\tbeforeLines.push(line.substring(2));\n\t\t} else if (line.startsWith('-')) {\n\t\t\tbeforeLines.push(line.substring(1));\n\t\t} else if (line.startsWith('+ ')) {\n\t\t\tafterLines.push(line.substring(2));\n\t\t} else if (line.startsWith('+')) {\n\t\t\tafterLines.push(line.substring(1));\n\t\t} else if (line.startsWith(' ')) {\n\t\t\t// Context line - appears in both\n\t\t\tconst content = line.substring(1);\n\t\t\tbeforeLines.push(content);\n\t\t\tafterLines.push(content);\n\t\t} else if (!line.startsWith('@@') && !line.startsWith('---') && !line.startsWith('+++') && !line.startsWith('diff ')) {\n\t\t\t// Regular line without prefix - treat as context\n\t\t\tbeforeLines.push(line);\n\t\t\tafterLines.push(line);\n\t\t}\n\t}\n\n\treturn {\n\t\tbefore: beforeLines.join('\\n'),\n\t\tafter: afterLines.join('\\n')\n\t};\n}\n\n/**\n * Simple diff editor model for inline diffs in markdown code blocks\n */\nclass SimpleDiffEditorModel extends EditorModel {\n\tpublic readonly original: ITextModel;\n\tpublic readonly modified: ITextModel;\n\n\tconstructor(\n\t\tprivate readonly _original: IReference<IResolvedTextEditorModel>,\n\t\tprivate readonly _modified: IReference<IResolvedTextEditorModel>,\n\t) {\n\t\tsuper();\n\t\tthis.original = this._original.object.textEditorModel;\n\t\tthis.modified = this._modified.object.textEditorModel;\n\t}\n\n\tpublic override dispose() {\n\t\tsuper.dispose();\n\t\tthis._original.dispose();\n\t\tthis._modified.dispose();\n\t}\n}\n\nexport interface IMarkdownDiffBlockData {\n\treadonly element: IChatResponseViewModel;\n\treadonly codeBlockIndex: number;\n\treadonly languageId: string;\n\treadonly beforeContent: string;\n\treadonly afterContent: string;\n\treadonly codeBlockResource?: URI;\n\treadonly isReadOnly?: boolean;\n\treadonly horizontalPadding?: number;\n}\n\n/**\n * Renders a diff block from markdown content.\n * This is a lightweight wrapper that uses CodeCompareBlockPart for the actual rendering.\n */\nexport class MarkdownDiffBlockPart extends Disposable {\n\tprivate readonly _onDidChangeContentHeight = this._register(new Emitter<void>());\n\tpublic readonly onDidChangeContentHeight = this._onDidChangeContentHeight.event;\n\n\treadonly element: HTMLElement;\n\tprivate readonly comparePart: IDisposableReference<CodeCompareBlockPart>;\n\tprivate readonly modelRef = this._register(new MutableDisposable<SimpleDiffEditorModel>());\n\n\tconstructor(\n\t\tdata: IMarkdownDiffBlockData,\n\t\tdiffEditorPool: DiffEditorPool,\n\t\tcurrentWidth: number,\n\t\t@IModelService private readonly modelService: IModelService,\n\t\t@ITextModelService private readonly textModelService: ITextModelService,\n\t\t@ILanguageService private readonly languageService: ILanguageService,\n\t) {\n\t\tsuper();\n\n\t\tthis.comparePart = this._register(diffEditorPool.get());\n\n\t\tthis._register(this.comparePart.object.onDidChangeContentHeight(() => {\n\t\t\tthis._onDidChangeContentHeight.fire();\n\t\t}));\n\n\t\t// Create in-memory models for the diff\n\t\tconst originalUri = URI.from({\n\t\t\tscheme: Schemas.vscodeChatCodeBlock,\n\t\t\tpath: `/chat-diff-original-${data.codeBlockIndex}-${generateUuid()}`,\n\t\t});\n\t\tconst modifiedUri = URI.from({\n\t\t\tscheme: Schemas.vscodeChatCodeBlock,\n\t\t\tpath: `/chat-diff-modified-${data.codeBlockIndex}-${generateUuid()}`,\n\t\t});\n\n\t\tconst languageSelection = this.languageService.createById(data.languageId);\n\n\t\t// Create the models\n\t\tthis._register(this.modelService.createModel(data.beforeContent, languageSelection, originalUri, false));\n\t\tthis._register(this.modelService.createModel(data.afterContent, languageSelection, modifiedUri, false));\n\n\t\tconst modelsPromise = Promise.all([\n\t\t\tthis.textModelService.createModelReference(originalUri),\n\t\t\tthis.textModelService.createModelReference(modifiedUri)\n\t\t]).then(([originalRef, modifiedRef]) => {\n\t\t\treturn new SimpleDiffEditorModel(originalRef, modifiedRef);\n\t\t});\n\n\t\tconst compareData: ICodeCompareBlockData = {\n\t\t\telement: data.element,\n\t\t\tisReadOnly: data.isReadOnly,\n\t\t\thorizontalPadding: data.horizontalPadding,\n\t\t\tedit: {\n\t\t\t\turi: data.codeBlockResource || modifiedUri,\n\t\t\t\tedits: [],\n\t\t\t\tkind: 'textEditGroup',\n\t\t\t\tdone: true\n\t\t\t},\n\t\t\tdiffData: modelsPromise.then(async model => {\n\t\t\t\tthis.modelRef.value = model;\n\t\t\t\tconst diffData: ICodeCompareBlockDiffData = {\n\t\t\t\t\toriginal: model.original,\n\t\t\t\t\tmodified: model.modified,\n\t\t\t\t\toriginalSha1: await hashAsync(model.original.getValue()),\n\t\t\t\t};\n\t\t\t\treturn diffData;\n\t\t\t})\n\t\t};\n\n\t\tthis.comparePart.object.render(compareData, currentWidth, CancellationToken.None);\n\t\tthis.element = this.comparePart.object.element;\n\t}\n\n\tlayout(width: number): void {\n\t\tthis.comparePart.object.layout(width);\n\t}\n\n\treset(): void {\n\t\tthis.modelRef.clear();\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { CancellationToken } from '../../../../base/common/cancellation.js';\nimport { Emitter } from '../../../../base/common/event.js';\nimport { hashAsync } from '../../../../base/common/hash.js';\nimport { Disposable, IReference, MutableDisposable } from '../../../../base/common/lifecycle.js';\nimport { Schemas } from '../../../../base/common/network.js';\nimport { URI } from '../../../../base/common/uri.js';\nimport { generateUuid } from '../../../../base/common/uuid.js';\nimport { ILanguageService } from '../../../../editor/common/languages/language.js';\nimport { ITextModel } from '../../../../editor/common/model.js';\nimport { IModelService } from '../../../../editor/common/services/model.js';\nimport { IResolvedTextEditorModel, ITextModelService } from '../../../../editor/common/services/resolverService.js';\nimport { EditorModel } from '../../../common/editor/editorModel.js';\nimport { IChatResponseViewModel } from '../common/chatViewModel.js';\nimport { IDisposableReference } from './chatContentParts/chatCollections.js';\nimport { DiffEditorPool } from './chatContentParts/chatContentCodePools.js';\nimport { CodeCompareBlockPart, ICodeCompareBlockData, ICodeCompareBlockDiffData } from './codeBlockPart.js';\n\n/**\n * Parses unified diff format into before/after content.\n * Supports standard unified diff format with - and + prefixes.\n */\nexport function parseUnifiedDiff(diffText: string): { before: string; after: string } {\n\tconst lines = diffText.split('\\n');\n\tconst beforeLines: string[] = [];\n\tconst afterLines: string[] = [];\n\n\tfor (const line of lines) {\n\t\tif (line.startsWith('- ')) {\n\t\t\tbeforeLines.push(line.substring(2));\n\t\t} else if (line.startsWith('-')) {\n\t\t\tbeforeLines.push(line.substring(1));\n\t\t} else if (line.startsWith('+ ')) {\n\t\t\tafterLines.push(line.substring(2));\n\t\t} else if (line.startsWith('+')) {\n\t\t\tafterLines.push(line.substring(1));\n\t\t} else if (line.startsWith(' ')) {\n\t\t\t// Context line - appears in both\n\t\t\tconst content = line.substring(1);\n\t\t\tbeforeLines.push(content);\n\t\t\tafterLines.push(content);\n\t\t} else if (!line.startsWith('@@') && !line.startsWith('---') && !line.startsWith('+++') && !line.startsWith('diff ')) {\n\t\t\t// Regular line without prefix - treat as context\n\t\t\tbeforeLines.push(line);\n\t\t\tafterLines.push(line);\n\t\t}\n\t}\n\n\treturn {\n\t\tbefore: beforeLines.join('\\n'),\n\t\tafter: afterLines.join('\\n')\n\t};\n}\n\n/**\n * Simple diff editor model for inline diffs in markdown code blocks\n */\nclass SimpleDiffEditorModel extends EditorModel {\n\tpublic readonly original: ITextModel;\n\tpublic readonly modified: ITextModel;\n\n\tconstructor(\n\t\tprivate readonly _original: IReference<IResolvedTextEditorModel>,\n\t\tprivate readonly _modified: IReference<IResolvedTextEditorModel>,\n\t) {\n\t\tsuper();\n\t\tthis.original = this._original.object.textEditorModel;\n\t\tthis.modified = this._modified.object.textEditorModel;\n\t}\n\n\tpublic override dispose() {\n\t\tsuper.dispose();\n\t\tthis._original.dispose();\n\t\tthis._modified.dispose();\n\t}\n}\n\nexport interface IMarkdownDiffBlockData {\n\treadonly element: IChatResponseViewModel;\n\treadonly codeBlockIndex: number;\n\treadonly languageId: string;\n\treadonly beforeContent: string;\n\treadonly afterContent: string;\n\treadonly codeBlockResource?: URI;\n\treadonly isReadOnly?: boolean;\n\treadonly horizontalPadding?: number;\n}\n\n/**\n * Renders a diff block from markdown content.\n * This is a lightweight wrapper that uses CodeCompareBlockPart for the actual rendering.\n */\nexport class MarkdownDiffBlockPart extends Disposable {\n\tprivate readonly _onDidChangeContentHeight = this._register(new Emitter<void>());\n\tpublic readonly onDidChangeContentHeight = this._onDidChangeContentHeight.event;\n\n\treadonly element: HTMLElement;\n\tprivate readonly comparePart: IDisposableReference<CodeCompareBlockPart>;\n\tprivate readonly modelRef = this._register(new MutableDisposable<SimpleDiffEditorModel>());\n\n\tconstructor(\n\t\tdata: IMarkdownDiffBlockData,\n\t\tdiffEditorPool: DiffEditorPool,\n\t\tcurrentWidth: number,\n\t\t@IModelService private readonly modelService: IModelService,\n\t\t@ITextModelService private readonly textModelService: ITextModelService,\n\t\t@ILanguageService private readonly languageService: ILanguageService,\n\t) {\n\t\tsuper();\n\n\t\tthis.comparePart = this._register(diffEditorPool.get());\n\n\t\tthis._register(this.comparePart.object.onDidChangeContentHeight(() => {\n\t\t\tthis._onDidChangeContentHeight.fire();\n\t\t}));\n\n\t\t// Create in-memory models for the diff\n\t\tconst originalUri = URI.from({\n\t\t\tscheme: Schemas.vscodeChatCodeBlock,\n\t\t\tpath: `/chat-diff-original-${data.codeBlockIndex}-${generateUuid()}`,\n\t\t});\n\t\tconst modifiedUri = URI.from({\n\t\t\tscheme: Schemas.vscodeChatCodeBlock,\n\t\t\tpath: `/chat-diff-modified-${data.codeBlockIndex}-${generateUuid()}`,\n\t\t});\n\n\t\tconst languageSelection = this.languageService.createById(data.languageId);\n\n\t\t// Create the models\n\t\tthis._register(this.modelService.createModel(data.beforeContent, languageSelection, originalUri, false));\n\t\tthis._register(this.modelService.createModel(data.afterContent, languageSelection, modifiedUri, false));\n\n\t\tconst modelsPromise = Promise.all([\n\t\t\tthis.textModelService.createModelReference(originalUri),\n\t\t\tthis.textModelService.createModelReference(modifiedUri)\n\t\t]).then(([originalRef, modifiedRef]) => {\n\t\t\treturn new SimpleDiffEditorModel(originalRef, modifiedRef);\n\t\t});\n\n\t\tconst compareData: ICodeCompareBlockData = {\n\t\t\telement: data.element,\n\t\t\tisReadOnly: data.isReadOnly,\n\t\t\thorizontalPadding: data.horizontalPadding,\n\t\t\tedit: {\n\t\t\t\turi: data.codeBlockResource || modifiedUri,\n\t\t\t\tedits: [],\n\t\t\t\tkind: 'textEditGroup',\n\t\t\t\tdone: true\n\t\t\t},\n\t\t\tdiffData: modelsPromise.then(async model => {\n\t\t\t\tthis.modelRef.value = model;\n\t\t\t\tconst diffData: ICodeCompareBlockDiffData = {\n\t\t\t\t\toriginal: model.original,\n\t\t\t\t\tmodified: model.modified,\n\t\t\t\t\toriginalSha1: await hashAsync(model.original.getValue()),\n\t\t\t\t};\n\t\t\t\treturn diffData;\n\t\t\t})\n\t\t};\n\n\t\tthis.comparePart.object.render(compareData, currentWidth, CancellationToken.None);\n\t\tthis.element = this.comparePart.object.element;\n\t}\n\n\tlayout(width: number): void {\n\t\tthis.comparePart.object.layout(width);\n\t}\n\n\treset(): void {\n\t\tthis.modelRef.clear();\n\t}\n}\n"]}