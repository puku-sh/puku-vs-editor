{"version":3,"sources":["vs/workbench/contrib/chat/browser/actions/chatActions.ts"],"names":[],"mappings":"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","file":"chatActions.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { isAncestorOfActiveElement } from '../../../../../base/browser/dom.js';\nimport { mainWindow } from '../../../../../base/browser/window.js';\nimport { toAction, WorkbenchActionExecutedClassification, WorkbenchActionExecutedEvent } from '../../../../../base/common/actions.js';\nimport { coalesce } from '../../../../../base/common/arrays.js';\nimport { timeout } from '../../../../../base/common/async.js';\nimport { CancellationTokenSource } from '../../../../../base/common/cancellation.js';\nimport { Codicon } from '../../../../../base/common/codicons.js';\nimport { fromNowByDay, safeIntl } from '../../../../../base/common/date.js';\nimport { Event } from '../../../../../base/common/event.js';\nimport { MarkdownString } from '../../../../../base/common/htmlContent.js';\nimport { KeyCode, KeyMod } from '../../../../../base/common/keyCodes.js';\nimport { Disposable, DisposableStore, markAsSingleton } from '../../../../../base/common/lifecycle.js';\nimport { MarshalledId } from '../../../../../base/common/marshallingIds.js';\nimport { language } from '../../../../../base/common/platform.js';\nimport { basename, isEqual } from '../../../../../base/common/resources.js';\nimport { ThemeIcon } from '../../../../../base/common/themables.js';\nimport { hasKey } from '../../../../../base/common/types.js';\nimport { URI } from '../../../../../base/common/uri.js';\nimport { ICodeEditor } from '../../../../../editor/browser/editorBrowser.js';\nimport { EditorAction2 } from '../../../../../editor/browser/editorExtensions.js';\nimport { IRange } from '../../../../../editor/common/core/range.js';\nimport { localize, localize2 } from '../../../../../nls.js';\nimport { IActionViewItemService } from '../../../../../platform/actions/browser/actionViewItemService.js';\nimport { DropdownWithPrimaryActionViewItem } from '../../../../../platform/actions/browser/dropdownWithPrimaryActionViewItem.js';\nimport { getContextMenuActions } from '../../../../../platform/actions/browser/menuEntryActionViewItem.js';\nimport { Action2, ICommandPaletteOptions, IMenuService, MenuId, MenuItemAction, MenuRegistry, registerAction2, SubmenuItemAction } from '../../../../../platform/actions/common/actions.js';\nimport { ICommandService } from '../../../../../platform/commands/common/commands.js';\nimport { IConfigurationService } from '../../../../../platform/configuration/common/configuration.js';\nimport { ContextKeyExpr, IContextKeyService } from '../../../../../platform/contextkey/common/contextkey.js';\nimport { IsLinuxContext, IsWindowsContext } from '../../../../../platform/contextkey/common/contextkeys.js';\nimport { IDialogService } from '../../../../../platform/dialogs/common/dialogs.js';\nimport { IFileService } from '../../../../../platform/files/common/files.js';\nimport { IInstantiationService, ServicesAccessor } from '../../../../../platform/instantiation/common/instantiation.js';\nimport { KeybindingWeight } from '../../../../../platform/keybinding/common/keybindingsRegistry.js';\nimport { INotificationService } from '../../../../../platform/notification/common/notification.js';\nimport { IOpenerService } from '../../../../../platform/opener/common/opener.js';\nimport product from '../../../../../platform/product/common/product.js';\nimport { IQuickInputButton, IQuickInputService, IQuickPickItem, IQuickPickSeparator } from '../../../../../platform/quickinput/common/quickInput.js';\nimport { ITelemetryService } from '../../../../../platform/telemetry/common/telemetry.js';\nimport { ToggleTitleBarConfigAction } from '../../../../browser/parts/titlebar/titlebarActions.js';\nimport { ActiveEditorContext, IsCompactTitleBarContext } from '../../../../common/contextkeys.js';\nimport { IWorkbenchContribution } from '../../../../common/contributions.js';\nimport { IViewDescriptorService, ViewContainerLocation } from '../../../../common/views.js';\nimport { ChatEntitlement, IChatEntitlementService } from '../../../../services/chat/common/chatEntitlementService.js';\nimport { GroupDirection, IEditorGroupsService } from '../../../../services/editor/common/editorGroupsService.js';\nimport { ACTIVE_GROUP, AUX_WINDOW_GROUP, IEditorService } from '../../../../services/editor/common/editorService.js';\nimport { IHostService } from '../../../../services/host/browser/host.js';\nimport { IWorkbenchLayoutService, Parts } from '../../../../services/layout/browser/layoutService.js';\nimport { IPreferencesService } from '../../../../services/preferences/common/preferences.js';\nimport { IViewsService } from '../../../../services/views/common/viewsService.js';\nimport { EXTENSIONS_CATEGORY, IExtensionsWorkbenchService } from '../../../extensions/common/extensions.js';\nimport { SCMHistoryItemChangeRangeContentProvider, ScmHistoryItemChangeRangeUriFields } from '../../../scm/browser/scmHistoryChatContext.js';\nimport { ISCMService } from '../../../scm/common/scm.js';\nimport { IChatAgentResult, IChatAgentService } from '../../common/chatAgents.js';\nimport { ChatContextKeys } from '../../common/chatContextKeys.js';\nimport { IChatEditingSession, ModifiedFileEntryState } from '../../common/chatEditingService.js';\nimport { IChatResponseModel } from '../../common/chatModel.js';\nimport { ChatMode, IChatMode, IChatModeService } from '../../common/chatModes.js';\nimport { IChatDetail, IChatService } from '../../common/chatService.js';\nimport { IChatSessionItem, IChatSessionsService, localChatSessionType } from '../../common/chatSessionsService.js';\nimport { ISCMHistoryItemChangeRangeVariableEntry, ISCMHistoryItemChangeVariableEntry } from '../../common/chatVariableEntries.js';\nimport { IChatRequestViewModel, IChatResponseViewModel, isRequestVM } from '../../common/chatViewModel.js';\nimport { IChatWidgetHistoryService } from '../../common/chatWidgetHistoryService.js';\nimport { LEGACY_AGENT_SESSIONS_VIEW_ID, ChatAgentLocation, ChatConfiguration, ChatModeKind } from '../../common/constants.js';\nimport { ILanguageModelChatSelector, ILanguageModelsService } from '../../common/languageModels.js';\nimport { CopilotUsageExtensionFeatureId } from '../../common/languageModelStats.js';\nimport { ILanguageModelToolsConfirmationService } from '../../common/languageModelToolsConfirmationService.js';\nimport { ILanguageModelToolsService } from '../../common/languageModelToolsService.js';\nimport { ChatViewId, IChatWidget, IChatWidgetService } from '../chat.js';\nimport { IChatEditorOptions } from '../chatEditor.js';\nimport { ChatEditorInput, shouldShowClearEditingSessionConfirmation, showClearEditingSessionConfirmation } from '../chatEditorInput.js';\nimport { ChatViewPane } from '../chatViewPane.js';\nimport { convertBufferToScreenshotVariable } from '../contrib/screenshot.js';\nimport { clearChatEditor } from './chatClear.js';\nimport { IMarshalledChatSessionContext } from './chatSessionActions.js';\n\nexport const CHAT_CATEGORY = localize2('chat.category', 'Chat');\n\nexport const ACTION_ID_NEW_CHAT = `workbench.action.chat.newChat`;\nexport const ACTION_ID_NEW_EDIT_SESSION = `workbench.action.chat.newEditSession`;\nexport const ACTION_ID_OPEN_CHAT = 'workbench.action.openChat';\nexport const CHAT_OPEN_ACTION_ID = 'workbench.action.chat.open';\nexport const CHAT_SETUP_ACTION_ID = 'workbench.action.chat.triggerSetup';\nexport const CHAT_SETUP_SUPPORT_ANONYMOUS_ACTION_ID = 'workbench.action.chat.triggerSetupSupportAnonymousAction';\nconst TOGGLE_CHAT_ACTION_ID = 'workbench.action.chat.toggle';\nconst CHAT_CLEAR_HISTORY_ACTION_ID = 'workbench.action.chat.clearHistory';\n\nexport interface IChatViewOpenOptions {\n\t/**\n\t * The query for chat.\n\t */\n\tquery: string;\n\t/**\n\t * Whether the query is partial and will await more input from the user.\n\t */\n\tisPartialQuery?: boolean;\n\t/**\n\t * A list of tools IDs with `canBeReferencedInPrompt` that will be resolved and attached if they exist.\n\t */\n\ttoolIds?: string[];\n\t/**\n\t * Any previous chat requests and responses that should be shown in the chat view.\n\t */\n\tpreviousRequests?: IChatViewOpenRequestEntry[];\n\t/**\n\t * Whether a screenshot of the focused window should be taken and attached\n\t */\n\tattachScreenshot?: boolean;\n\t/**\n\t * A list of file URIs to attach to the chat as context.\n\t */\n\tattachFiles?: (URI | { uri: URI; range: IRange })[];\n\t/**\n\t * A list of source control history item changes to attach to the chat as context.\n\t */\n\tattachHistoryItemChanges?: { uri: URI; historyItemId: string }[];\n\t/**\n\t * A list of source control history item change ranges to attach to the chat as context.\n\t */\n\tattachHistoryItemChangeRanges?: {\n\t\tstart: { uri: URI; historyItemId: string };\n\t\tend: { uri: URI; historyItemId: string };\n\t}[];\n\t/**\n\t * The mode ID or name to open the chat in.\n\t */\n\tmode?: ChatModeKind | string;\n\n\t/**\n\t * The language model selector to use for the chat.\n\t * An Error will be thrown if there's no match. If there are multiple\n\t * matches, the first match will be used.\n\t *\n\t * Examples:\n\t *\n\t * ```\n\t * {\n\t *   id: 'claude-sonnet-4',\n\t *   vendor: 'copilot'\n\t * }\n\t * ```\n\t *\n\t * Use `claude-sonnet-4` from any vendor:\n\t *\n\t * ```\n\t * {\n\t *   id: 'claude-sonnet-4',\n\t * }\n\t * ```\n\t */\n\tmodelSelector?: ILanguageModelChatSelector;\n\n\t/**\n\t * Wait to resolve the command until the chat response reaches a terminal state (complete, error, or pending user confirmation, etc.).\n\t */\n\tblockOnResponse?: boolean;\n}\n\nexport interface IChatViewOpenRequestEntry {\n\trequest: string;\n\tresponse: string;\n}\n\nexport const CHAT_CONFIG_MENU_ID = new MenuId('workbench.chat.menu.config');\n\nconst OPEN_CHAT_QUOTA_EXCEEDED_DIALOG = 'workbench.action.chat.openQuotaExceededDialog';\n\nabstract class OpenChatGlobalAction extends Action2 {\n\tconstructor(overrides: Pick<ICommandPaletteOptions, 'keybinding' | 'title' | 'id' | 'menu'>, private readonly mode?: IChatMode) {\n\t\tsuper({\n\t\t\t...overrides,\n\t\t\ticon: Codicon.chatSparkle,\n\t\t\tf1: true,\n\t\t\tcategory: CHAT_CATEGORY,\n\t\t\tprecondition: ContextKeyExpr.and(\n\t\t\t\tChatContextKeys.Setup.hidden.negate(),\n\t\t\t\tChatContextKeys.Setup.disabled.negate()\n\t\t\t)\n\t\t});\n\t}\n\n\toverride async run(accessor: ServicesAccessor, opts?: string | IChatViewOpenOptions): Promise<IChatAgentResult & { type?: 'confirmation' } | undefined> {\n\t\topts = typeof opts === 'string' ? { query: opts } : opts;\n\n\t\tconst chatService = accessor.get(IChatService);\n\t\tconst widgetService = accessor.get(IChatWidgetService);\n\t\tconst toolsService = accessor.get(ILanguageModelToolsService);\n\t\tconst hostService = accessor.get(IHostService);\n\t\tconst chatAgentService = accessor.get(IChatAgentService);\n\t\tconst instaService = accessor.get(IInstantiationService);\n\t\tconst commandService = accessor.get(ICommandService);\n\t\tconst chatModeService = accessor.get(IChatModeService);\n\t\tconst fileService = accessor.get(IFileService);\n\t\tconst languageModelService = accessor.get(ILanguageModelsService);\n\t\tconst scmService = accessor.get(ISCMService);\n\n\t\tlet chatWidget = widgetService.lastFocusedWidget;\n\t\t// When this was invoked to switch to a mode via keybinding, and some chat widget is focused, use that one.\n\t\t// Otherwise, open the view.\n\t\tif (!this.mode || !chatWidget || !isAncestorOfActiveElement(chatWidget.domNode)) {\n\t\t\tchatWidget = await widgetService.revealWidget();\n\t\t}\n\n\t\tif (!chatWidget) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst switchToMode = (opts?.mode ? chatModeService.findModeByName(opts?.mode) : undefined) ?? this.mode;\n\t\tif (switchToMode) {\n\t\t\tawait this.handleSwitchToMode(switchToMode, chatWidget, instaService, commandService);\n\t\t}\n\n\t\tif (opts?.modelSelector) {\n\t\t\tconst ids = await languageModelService.selectLanguageModels(opts.modelSelector, false);\n\t\t\tconst id = ids.sort().at(0);\n\t\t\tif (!id) {\n\t\t\t\tthrow new Error(`No language models found matching selector: ${JSON.stringify(opts.modelSelector)}.`);\n\t\t\t}\n\n\t\t\tconst model = languageModelService.lookupLanguageModel(id);\n\t\t\tif (!model) {\n\t\t\t\tthrow new Error(`Language model not loaded: ${id}.`);\n\t\t\t}\n\n\t\t\tchatWidget.input.setCurrentLanguageModel({ metadata: model, identifier: id });\n\t\t}\n\n\t\tif (opts?.previousRequests?.length && chatWidget.viewModel) {\n\t\t\tfor (const { request, response } of opts.previousRequests) {\n\t\t\t\tchatService.addCompleteRequest(chatWidget.viewModel.sessionResource, request, undefined, 0, { message: response });\n\t\t\t}\n\t\t}\n\t\tif (opts?.attachScreenshot) {\n\t\t\tconst screenshot = await hostService.getScreenshot();\n\t\t\tif (screenshot) {\n\t\t\t\tchatWidget.attachmentModel.addContext(convertBufferToScreenshotVariable(screenshot));\n\t\t\t}\n\t\t}\n\t\tif (opts?.attachFiles) {\n\t\t\tfor (const file of opts.attachFiles) {\n\t\t\t\tconst uri = file instanceof URI ? file : file.uri;\n\t\t\t\tconst range = file instanceof URI ? undefined : file.range;\n\n\t\t\t\tif (await fileService.exists(uri)) {\n\t\t\t\t\tchatWidget.attachmentModel.addFile(uri, range);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tif (opts?.attachHistoryItemChanges) {\n\t\t\tfor (const historyItemChange of opts.attachHistoryItemChanges) {\n\t\t\t\tconst repository = scmService.getRepository(URI.file(historyItemChange.uri.path));\n\t\t\t\tconst historyProvider = repository?.provider.historyProvider.get();\n\t\t\t\tif (!historyProvider) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tconst historyItem = await historyProvider.resolveHistoryItem(historyItemChange.historyItemId);\n\t\t\t\tif (!historyItem) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tchatWidget.attachmentModel.addContext({\n\t\t\t\t\tid: historyItemChange.uri.toString(),\n\t\t\t\t\tname: `${basename(historyItemChange.uri)}`,\n\t\t\t\t\tvalue: historyItemChange.uri,\n\t\t\t\t\thistoryItem: historyItem,\n\t\t\t\t\tkind: 'scmHistoryItemChange'\n\t\t\t\t} satisfies ISCMHistoryItemChangeVariableEntry);\n\t\t\t}\n\t\t}\n\t\tif (opts?.attachHistoryItemChangeRanges) {\n\t\t\tfor (const historyItemChangeRange of opts.attachHistoryItemChangeRanges) {\n\t\t\t\tconst repository = scmService.getRepository(URI.file(historyItemChangeRange.end.uri.path));\n\t\t\t\tconst historyProvider = repository?.provider.historyProvider.get();\n\t\t\t\tif (!repository || !historyProvider) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tconst [historyItemStart, historyItemEnd] = await Promise.all([\n\t\t\t\t\thistoryProvider.resolveHistoryItem(historyItemChangeRange.start.historyItemId),\n\t\t\t\t\thistoryProvider.resolveHistoryItem(historyItemChangeRange.end.historyItemId),\n\t\t\t\t]);\n\t\t\t\tif (!historyItemStart || !historyItemEnd) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tconst uri = historyItemChangeRange.end.uri.with({\n\t\t\t\t\tscheme: SCMHistoryItemChangeRangeContentProvider.scheme,\n\t\t\t\t\tquery: JSON.stringify({\n\t\t\t\t\t\trepositoryId: repository.id,\n\t\t\t\t\t\tstart: historyItemStart.id,\n\t\t\t\t\t\tend: historyItemChangeRange.end.historyItemId\n\t\t\t\t\t} satisfies ScmHistoryItemChangeRangeUriFields)\n\t\t\t\t});\n\n\t\t\t\tchatWidget.attachmentModel.addContext({\n\t\t\t\t\tid: uri.toString(),\n\t\t\t\t\tname: `${basename(uri)}`,\n\t\t\t\t\tvalue: uri,\n\t\t\t\t\thistoryItemChangeStart: {\n\t\t\t\t\t\turi: historyItemChangeRange.start.uri,\n\t\t\t\t\t\thistoryItem: historyItemStart\n\t\t\t\t\t},\n\t\t\t\t\thistoryItemChangeEnd: {\n\t\t\t\t\t\turi: historyItemChangeRange.end.uri,\n\t\t\t\t\t\thistoryItem: {\n\t\t\t\t\t\t\t...historyItemEnd,\n\t\t\t\t\t\t\tdisplayId: historyItemChangeRange.end.historyItemId\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tkind: 'scmHistoryItemChangeRange'\n\t\t\t\t} satisfies ISCMHistoryItemChangeRangeVariableEntry);\n\t\t\t}\n\t\t}\n\n\t\tlet resp: Promise<IChatResponseModel | undefined> | undefined;\n\n\t\tif (opts?.query) {\n\t\t\tchatWidget.setInput(opts.query);\n\n\t\t\tif (!opts.isPartialQuery) {\n\t\t\t\tif (!chatWidget.viewModel) {\n\t\t\t\t\tawait Event.toPromise(chatWidget.onDidChangeViewModel);\n\t\t\t\t}\n\t\t\t\tawait waitForDefaultAgent(chatAgentService, chatWidget.input.currentModeKind);\n\t\t\t\tresp = chatWidget.acceptInput();\n\t\t\t}\n\t\t}\n\n\t\tif (opts?.toolIds && opts.toolIds.length > 0) {\n\t\t\tfor (const toolId of opts.toolIds) {\n\t\t\t\tconst tool = toolsService.getTool(toolId);\n\t\t\t\tif (tool) {\n\t\t\t\t\tchatWidget.attachmentModel.addContext({\n\t\t\t\t\t\tid: tool.id,\n\t\t\t\t\t\tname: tool.displayName,\n\t\t\t\t\t\tfullName: tool.displayName,\n\t\t\t\t\t\tvalue: undefined,\n\t\t\t\t\t\ticon: ThemeIcon.isThemeIcon(tool.icon) ? tool.icon : undefined,\n\t\t\t\t\t\tkind: 'tool'\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tchatWidget.focusInput();\n\n\t\tif (opts?.blockOnResponse) {\n\t\t\tconst response = await resp;\n\t\t\tif (response) {\n\t\t\t\tawait new Promise<void>(resolve => {\n\t\t\t\t\tconst d = response.onDidChange(async () => {\n\t\t\t\t\t\tif (response.isComplete || response.isPendingConfirmation.get()) {\n\t\t\t\t\t\t\td.dispose();\n\t\t\t\t\t\t\tresolve();\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t});\n\n\t\t\t\treturn { ...response.result, type: response.isPendingConfirmation.get() ? 'confirmation' : undefined };\n\t\t\t}\n\t\t}\n\n\t\treturn undefined;\n\t}\n\n\tprivate async handleSwitchToMode(switchToMode: IChatMode, chatWidget: IChatWidget, instaService: IInstantiationService, commandService: ICommandService): Promise<void> {\n\t\tconst currentMode = chatWidget.input.currentModeKind;\n\n\t\tif (switchToMode) {\n\t\t\tconst editingSession = chatWidget.viewModel?.model.editingSession;\n\t\t\tconst requestCount = chatWidget.viewModel?.model.getRequests().length ?? 0;\n\t\t\tconst chatModeCheck = await instaService.invokeFunction(handleModeSwitch, currentMode, switchToMode.kind, requestCount, editingSession);\n\t\t\tif (!chatModeCheck) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tchatWidget.input.setChatMode(switchToMode.id);\n\n\t\t\tif (chatModeCheck.needToClearSession) {\n\t\t\t\tawait commandService.executeCommand(ACTION_ID_NEW_CHAT);\n\t\t\t}\n\t\t}\n\t}\n}\n\nasync function waitForDefaultAgent(chatAgentService: IChatAgentService, mode: ChatModeKind): Promise<void> {\n\tconst defaultAgent = chatAgentService.getDefaultAgent(ChatAgentLocation.Chat, mode);\n\tif (defaultAgent) {\n\t\treturn;\n\t}\n\n\tawait Promise.race([\n\t\tEvent.toPromise(Event.filter(chatAgentService.onDidChangeAgents, () => {\n\t\t\tconst defaultAgent = chatAgentService.getDefaultAgent(ChatAgentLocation.Chat, mode);\n\t\t\treturn Boolean(defaultAgent);\n\t\t})),\n\t\ttimeout(60_000).then(() => { throw new Error('Timed out waiting for default agent'); })\n\t]);\n}\n\nclass PrimaryOpenChatGlobalAction extends OpenChatGlobalAction {\n\tconstructor() {\n\t\tsuper({\n\t\t\tid: CHAT_OPEN_ACTION_ID,\n\t\t\ttitle: localize2('openChat', \"Open Chat\"),\n\t\t\tkeybinding: {\n\t\t\t\tweight: KeybindingWeight.WorkbenchContrib,\n\t\t\t\tprimary: KeyMod.CtrlCmd | KeyMod.Alt | KeyCode.KeyI,\n\t\t\t\tmac: {\n\t\t\t\t\tprimary: KeyMod.CtrlCmd | KeyMod.WinCtrl | KeyCode.KeyI\n\t\t\t\t}\n\t\t\t},\n\t\t\tmenu: [{\n\t\t\t\tid: MenuId.ChatTitleBarMenu,\n\t\t\t\tgroup: 'a_open',\n\t\t\t\torder: 1\n\t\t\t}]\n\t\t});\n\t}\n}\n\nexport function getOpenChatActionIdForMode(mode: IChatMode): string {\n\treturn `workbench.action.chat.open${mode.name.get()}`;\n}\n\nabstract class ModeOpenChatGlobalAction extends OpenChatGlobalAction {\n\tconstructor(mode: IChatMode, keybinding?: ICommandPaletteOptions['keybinding']) {\n\t\tsuper({\n\t\t\tid: getOpenChatActionIdForMode(mode),\n\t\t\ttitle: localize2('openChatMode', \"Open Chat ({0})\", mode.label.get()),\n\t\t\tkeybinding\n\t\t}, mode);\n\t}\n}\n\nexport function registerChatActions() {\n\tregisterAction2(PrimaryOpenChatGlobalAction);\n\tregisterAction2(class extends ModeOpenChatGlobalAction {\n\t\tconstructor() { super(ChatMode.Ask); }\n\t});\n\tregisterAction2(class extends ModeOpenChatGlobalAction {\n\t\tconstructor() {\n\t\t\tsuper(ChatMode.Agent, {\n\t\t\t\twhen: ContextKeyExpr.has(`config.${ChatConfiguration.AgentEnabled}`),\n\t\t\t\tweight: KeybindingWeight.WorkbenchContrib,\n\t\t\t\tprimary: KeyMod.CtrlCmd | KeyMod.Shift | KeyCode.KeyI,\n\t\t\t\tlinux: {\n\t\t\t\t\tprimary: KeyMod.CtrlCmd | KeyMod.Alt | KeyMod.Shift | KeyCode.KeyI\n\t\t\t\t}\n\t\t\t},);\n\t\t}\n\t});\n\tregisterAction2(class extends ModeOpenChatGlobalAction {\n\t\tconstructor() { super(ChatMode.Edit); }\n\t});\n\n\tregisterAction2(class ToggleChatAction extends Action2 {\n\t\tconstructor() {\n\t\t\tsuper({\n\t\t\t\tid: TOGGLE_CHAT_ACTION_ID,\n\t\t\t\ttitle: localize2('toggleChat', \"Toggle Chat\"),\n\t\t\t\tcategory: CHAT_CATEGORY\n\t\t\t});\n\t\t}\n\n\t\tasync run(accessor: ServicesAccessor) {\n\t\t\tconst layoutService = accessor.get(IWorkbenchLayoutService);\n\t\t\tconst viewsService = accessor.get(IViewsService);\n\t\t\tconst viewDescriptorService = accessor.get(IViewDescriptorService);\n\t\t\tconst widgetService = accessor.get(IChatWidgetService);\n\n\t\t\tconst chatLocation = viewDescriptorService.getViewLocationById(ChatViewId);\n\n\t\t\tif (viewsService.isViewVisible(ChatViewId)) {\n\t\t\t\tthis.updatePartVisibility(layoutService, chatLocation, false);\n\t\t\t} else {\n\t\t\t\tthis.updatePartVisibility(layoutService, chatLocation, true);\n\t\t\t\t(await widgetService.revealWidget())?.focusInput();\n\t\t\t}\n\t\t}\n\n\t\tprivate updatePartVisibility(layoutService: IWorkbenchLayoutService, location: ViewContainerLocation | null, visible: boolean): void {\n\t\t\tlet part: Parts.PANEL_PART | Parts.SIDEBAR_PART | Parts.AUXILIARYBAR_PART | undefined;\n\t\t\tswitch (location) {\n\t\t\t\tcase ViewContainerLocation.Panel:\n\t\t\t\t\tpart = Parts.PANEL_PART;\n\t\t\t\t\tbreak;\n\t\t\t\tcase ViewContainerLocation.Sidebar:\n\t\t\t\t\tpart = Parts.SIDEBAR_PART;\n\t\t\t\t\tbreak;\n\t\t\t\tcase ViewContainerLocation.AuxiliaryBar:\n\t\t\t\t\tpart = Parts.AUXILIARYBAR_PART;\n\t\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tif (part) {\n\t\t\t\tlayoutService.setPartHidden(!visible, part);\n\t\t\t}\n\t\t}\n\t});\n\n\tregisterAction2(class ChatHistoryAction extends Action2 {\n\t\tconstructor() {\n\t\t\tsuper({\n\t\t\t\tid: `workbench.action.chat.history`,\n\t\t\t\ttitle: localize2('chat.history.label', \"Show Chats...\"),\n\t\t\t\tmenu: [\n\t\t\t\t\t{\n\t\t\t\t\t\tid: MenuId.ViewTitle,\n\t\t\t\t\t\twhen: ContextKeyExpr.and(\n\t\t\t\t\t\t\tContextKeyExpr.equals('view', ChatViewId),\n\t\t\t\t\t\t\tChatContextKeys.inEmptyStateWithHistoryEnabled.negate()\n\t\t\t\t\t\t),\n\t\t\t\t\t\tgroup: 'navigation',\n\t\t\t\t\t\torder: 2\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tid: MenuId.EditorTitle,\n\t\t\t\t\t\twhen: ActiveEditorContext.isEqualTo(ChatEditorInput.EditorID),\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tid: MenuId.ChatHistory,\n\t\t\t\t\t\twhen: ChatContextKeys.inEmptyStateWithHistoryEnabled,\n\t\t\t\t\t\tgroup: 'navigation',\n\t\t\t\t\t}\n\t\t\t\t],\n\t\t\t\tcategory: CHAT_CATEGORY,\n\t\t\t\ticon: Codicon.history,\n\t\t\t\tf1: true,\n\t\t\t\tprecondition: ChatContextKeys.enabled\n\t\t\t});\n\t\t}\n\n\t\tprivate showLegacyPicker = async (\n\t\t\tchatService: IChatService,\n\t\t\tquickInputService: IQuickInputService,\n\t\t\tcommandService: ICommandService,\n\t\t\teditorService: IEditorService,\n\t\t\tview: ChatViewPane\n\t\t) => {\n\t\t\tconst clearChatHistoryButton: IQuickInputButton = {\n\t\t\t\ticonClass: ThemeIcon.asClassName(Codicon.clearAll),\n\t\t\t\ttooltip: localize('interactiveSession.history.clear', \"Clear All Workspace Chats\"),\n\t\t\t};\n\n\t\t\tconst openInEditorButton: IQuickInputButton = {\n\t\t\t\ticonClass: ThemeIcon.asClassName(Codicon.file),\n\t\t\t\ttooltip: localize('interactiveSession.history.editor', \"Open in Editor\"),\n\t\t\t};\n\t\t\tconst deleteButton: IQuickInputButton = {\n\t\t\t\ticonClass: ThemeIcon.asClassName(Codicon.x),\n\t\t\t\ttooltip: localize('interactiveSession.history.delete', \"Delete\"),\n\t\t\t};\n\t\t\tconst renameButton: IQuickInputButton = {\n\t\t\t\ticonClass: ThemeIcon.asClassName(Codicon.pencil),\n\t\t\t\ttooltip: localize('chat.history.rename', \"Rename\"),\n\t\t\t};\n\n\t\t\tinterface IChatPickerItem extends IQuickPickItem {\n\t\t\t\tchat: IChatDetail;\n\t\t\t}\n\n\t\t\tconst getPicks = async () => {\n\t\t\t\tconst items = await chatService.getLocalSessionHistory();\n\t\t\t\titems.sort((a, b) => (b.lastMessageDate ?? 0) - (a.lastMessageDate ?? 0));\n\n\t\t\t\tlet lastDate: string | undefined = undefined;\n\t\t\t\tconst picks = items.flatMap((i): [IQuickPickSeparator | undefined, IChatPickerItem] => {\n\t\t\t\t\tconst timeAgoStr = fromNowByDay(i.lastMessageDate, true, true);\n\t\t\t\t\tconst separator: IQuickPickSeparator | undefined = timeAgoStr !== lastDate ? {\n\t\t\t\t\t\ttype: 'separator', label: timeAgoStr,\n\t\t\t\t\t} : undefined;\n\t\t\t\t\tlastDate = timeAgoStr;\n\t\t\t\t\treturn [\n\t\t\t\t\t\tseparator,\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tlabel: i.title,\n\t\t\t\t\t\t\tdescription: i.isActive ? `(${localize('currentChatLabel', 'current')})` : '',\n\t\t\t\t\t\t\tchat: i,\n\t\t\t\t\t\t\tbuttons: i.isActive ? [renameButton] : [\n\t\t\t\t\t\t\t\trenameButton,\n\t\t\t\t\t\t\t\topenInEditorButton,\n\t\t\t\t\t\t\t\tdeleteButton,\n\t\t\t\t\t\t\t]\n\t\t\t\t\t\t}\n\t\t\t\t\t];\n\t\t\t\t});\n\n\t\t\t\treturn coalesce(picks);\n\t\t\t};\n\n\t\t\tconst store = new (DisposableStore as { new(): DisposableStore })();\n\t\t\tconst picker = store.add(quickInputService.createQuickPick<IChatPickerItem>({ useSeparators: true }));\n\t\t\tpicker.title = localize('interactiveSession.history.title', \"Workspace Chat History\");\n\t\t\tpicker.placeholder = localize('interactiveSession.history.pick', \"Switch to chat\");\n\t\t\tpicker.buttons = [clearChatHistoryButton];\n\t\t\tconst picks = await getPicks();\n\t\t\tpicker.items = picks;\n\t\t\tstore.add(picker.onDidTriggerButton(async button => {\n\t\t\t\tif (button === clearChatHistoryButton) {\n\t\t\t\t\tawait commandService.executeCommand(CHAT_CLEAR_HISTORY_ACTION_ID);\n\t\t\t\t}\n\t\t\t}));\n\t\t\tstore.add(picker.onDidTriggerItemButton(async context => {\n\t\t\t\tif (context.button === openInEditorButton) {\n\t\t\t\t\teditorService.openEditor({\n\t\t\t\t\t\tresource: context.item.chat.sessionResource,\n\t\t\t\t\t\toptions: { pinned: true }\n\t\t\t\t\t}, ACTIVE_GROUP);\n\t\t\t\t\tpicker.hide();\n\t\t\t\t} else if (context.button === deleteButton) {\n\t\t\t\t\tchatService.removeHistoryEntry(context.item.chat.sessionResource);\n\t\t\t\t\tpicker.items = await getPicks();\n\t\t\t\t} else if (context.button === renameButton) {\n\t\t\t\t\tconst title = await quickInputService.input({ title: localize('newChatTitle', \"New chat title\"), value: context.item.chat.title });\n\t\t\t\t\tif (title) {\n\t\t\t\t\t\tchatService.setChatSessionTitle(context.item.chat.sessionResource, title);\n\t\t\t\t\t}\n\n\t\t\t\t\t// The quick input hides the picker, it gets disposed, so we kick it off from scratch\n\t\t\t\t\tawait this.showLegacyPicker(chatService, quickInputService, commandService, editorService, view);\n\t\t\t\t}\n\t\t\t}));\n\t\t\tstore.add(picker.onDidAccept(async () => {\n\t\t\t\ttry {\n\t\t\t\t\tconst item = picker.selectedItems[0];\n\t\t\t\t\tawait view.loadSession(item.chat.sessionResource);\n\t\t\t\t} finally {\n\t\t\t\t\tpicker.hide();\n\t\t\t\t}\n\t\t\t}));\n\t\t\tstore.add(picker.onDidHide(() => store.dispose()));\n\n\t\t\tpicker.show();\n\t\t};\n\n\t\tprivate async showIntegratedPicker(\n\t\t\tchatService: IChatService,\n\t\t\tquickInputService: IQuickInputService,\n\t\t\tcommandService: ICommandService,\n\t\t\teditorService: IEditorService,\n\t\t\tchatWidgetService: IChatWidgetService,\n\t\t\tview: ChatViewPane,\n\t\t\tchatSessionsService: IChatSessionsService,\n\t\t\tcontextKeyService: IContextKeyService,\n\t\t\tmenuService: IMenuService,\n\t\t\tshowAllChats: boolean = false,\n\t\t\tshowAllAgents: boolean = false\n\t\t) {\n\t\t\tconst clearChatHistoryButton: IQuickInputButton = {\n\t\t\t\ticonClass: ThemeIcon.asClassName(Codicon.clearAll),\n\t\t\t\ttooltip: localize('interactiveSession.history.clear', \"Clear All Workspace Chats\"),\n\t\t\t};\n\n\t\t\tconst openInEditorButton: IQuickInputButton = {\n\t\t\t\ticonClass: ThemeIcon.asClassName(Codicon.file),\n\t\t\t\ttooltip: localize('interactiveSession.history.editor', \"Open in Editor\"),\n\t\t\t};\n\t\t\tconst deleteButton: IQuickInputButton = {\n\t\t\t\ticonClass: ThemeIcon.asClassName(Codicon.x),\n\t\t\t\ttooltip: localize('interactiveSession.history.delete', \"Delete\"),\n\t\t\t};\n\t\t\tconst renameButton: IQuickInputButton = {\n\t\t\t\ticonClass: ThemeIcon.asClassName(Codicon.pencil),\n\t\t\t\ttooltip: localize('chat.history.rename', \"Rename\"),\n\t\t\t};\n\n\t\t\tinterface IChatPickerItem extends IQuickPickItem {\n\t\t\t\treadonly chat: IChatDetail;\n\t\t\t}\n\n\t\t\tinterface ICodingAgentPickerItem extends IChatPickerItem {\n\t\t\t\treadonly session: IChatSessionItem;\n\t\t\t}\n\n\t\t\tfunction isChatPickerItem(item: IQuickPickItem | IChatPickerItem): item is IChatPickerItem {\n\t\t\t\treturn hasKey(item, { chat: true });\n\t\t\t}\n\n\t\t\tfunction isCodingAgentPickerItem(item: IQuickPickItem): item is ICodingAgentPickerItem {\n\t\t\t\treturn isChatPickerItem(item) && hasKey(item as ICodingAgentPickerItem, { session: true });\n\t\t\t}\n\n\t\t\tconst showMorePick: IQuickPickItem = {\n\t\t\t\tlabel: localize('chat.history.showMore', 'Show more...'),\n\t\t\t};\n\n\t\t\tconst showMoreAgentsPick: IQuickPickItem = {\n\t\t\t\tlabel: localize('chat.history.showMoreAgents', 'Show more...'),\n\t\t\t};\n\n\t\t\tconst getPicks = async (showAllChats: boolean = false, showAllAgents: boolean = false) => {\n\t\t\t\t// Fast picks: Get cached/immediate items first\n\t\t\t\tconst cachedItems = await chatService.getLocalSessionHistory();\n\t\t\t\tcachedItems.sort((a, b) => (b.lastMessageDate ?? 0) - (a.lastMessageDate ?? 0));\n\n\t\t\t\tconst allFastPickItems: IChatPickerItem[] = cachedItems.map((i) => {\n\t\t\t\t\tconst timeAgoStr = fromNowByDay(i.lastMessageDate, true, true);\n\t\t\t\t\tconst currentLabel = i.isActive ? localize('currentChatLabel', 'current') : '';\n\t\t\t\t\tconst description = currentLabel ? `${timeAgoStr}  ${currentLabel}` : timeAgoStr;\n\n\t\t\t\t\treturn {\n\t\t\t\t\t\tlabel: i.title,\n\t\t\t\t\t\tdescription: description,\n\t\t\t\t\t\tchat: i,\n\t\t\t\t\t\tbuttons: i.isActive ? [renameButton] : [\n\t\t\t\t\t\t\trenameButton,\n\t\t\t\t\t\t\topenInEditorButton,\n\t\t\t\t\t\t\tdeleteButton,\n\t\t\t\t\t\t]\n\t\t\t\t\t};\n\t\t\t\t});\n\n\t\t\t\tconst fastPickItems = showAllChats ? allFastPickItems : allFastPickItems.slice(0, 5);\n\n\t\t\t\tconst fastPicks: Array<IQuickPickSeparator | IChatPickerItem | IQuickPickItem> = [];\n\t\t\t\tif (fastPickItems.length > 0) {\n\t\t\t\t\tfastPicks.push({\n\t\t\t\t\t\ttype: 'separator',\n\t\t\t\t\t\tlabel: localize('chat.history.recent', 'Recent Chats'),\n\t\t\t\t\t});\n\t\t\t\t\tfastPicks.push(...fastPickItems);\n\n\t\t\t\t\t// Add \"Show more...\" if there are more items and we're not showing all chats\n\t\t\t\t\tif (!showAllChats && allFastPickItems.length > 5) {\n\n\t\t\t\t\t\tfastPicks.push(showMorePick);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Slow picks: Get coding agents asynchronously via AsyncIterable\n\t\t\t\tconst slowPicks = (async function* (): AsyncGenerator<Array<IQuickPickSeparator | ICodingAgentPickerItem | IQuickPickItem>> {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tconst agentPicks: ICodingAgentPickerItem[] = [];\n\n\t\t\t\t\t\t// Use the new Promise-based API to get chat sessions\n\t\t\t\t\t\tconst cancellationToken = new CancellationTokenSource();\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tconst providerNSessions = await chatSessionsService.getAllChatSessionItems(cancellationToken.token);\n\t\t\t\t\t\t\tfor (const { chatSessionType, items } of providerNSessions) {\n\t\t\t\t\t\t\t\tfor (const session of items) {\n\t\t\t\t\t\t\t\t\tconst ckey = contextKeyService.createKey('chatSessionType', chatSessionType);\n\t\t\t\t\t\t\t\t\tconst actions = menuService.getMenuActions(MenuId.ChatSessionsMenu, contextKeyService);\n\t\t\t\t\t\t\t\t\tconst { primary } = getContextMenuActions(actions, 'inline');\n\t\t\t\t\t\t\t\t\tckey.reset();\n\n\t\t\t\t\t\t\t\t\t// Use primary actions if available, otherwise fall back to secondary actions\n\t\t\t\t\t\t\t\t\tconst buttons = primary.map(action => ({\n\t\t\t\t\t\t\t\t\t\tid: action.id,\n\t\t\t\t\t\t\t\t\t\ttooltip: action.tooltip,\n\t\t\t\t\t\t\t\t\t\ticonClass: action.class || ThemeIcon.asClassName(Codicon.symbolClass),\n\t\t\t\t\t\t\t\t\t}));\n\t\t\t\t\t\t\t\t\t// Create agent pick from the session content\n\t\t\t\t\t\t\t\t\tconst agentPick: ICodingAgentPickerItem = {\n\t\t\t\t\t\t\t\t\t\tlabel: session.label,\n\t\t\t\t\t\t\t\t\t\tdescription: chatSessionType,\n\t\t\t\t\t\t\t\t\t\tsession: session,\n\t\t\t\t\t\t\t\t\t\tchat: {\n\t\t\t\t\t\t\t\t\t\t\tsessionResource: session.resource,\n\t\t\t\t\t\t\t\t\t\t\ttitle: session.label,\n\t\t\t\t\t\t\t\t\t\t\tisActive: false,\n\t\t\t\t\t\t\t\t\t\t\tlastMessageDate: 0,\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\tbuttons,\n\t\t\t\t\t\t\t\t\t};\n\n\t\t\t\t\t\t\t\t\t// Check if this agent already exists (update existing or add new)\n\t\t\t\t\t\t\t\t\tconst existingIndex = agentPicks.findIndex(pick => isEqual(pick.chat.sessionResource, session.resource));\n\t\t\t\t\t\t\t\t\tif (existingIndex >= 0) {\n\t\t\t\t\t\t\t\t\t\tagentPicks[existingIndex] = agentPick;\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\tagentPicks.push(agentPick);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t// Create current picks with separator if we have agents\n\t\t\t\t\t\t\tconst currentPicks: Array<IQuickPickSeparator | ICodingAgentPickerItem | IQuickPickItem> = [];\n\n\t\t\t\t\t\t\tif (agentPicks.length > 0) {\n\t\t\t\t\t\t\t\t// Always add separator for coding agents section\n\t\t\t\t\t\t\t\tcurrentPicks.push({\n\t\t\t\t\t\t\t\t\ttype: 'separator',\n\t\t\t\t\t\t\t\t\tlabel: 'Chat Sessions',\n\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t\tconst defaultMaxToShow = 5;\n\t\t\t\t\t\t\t\tconst maxToShow = showAllAgents ? Number.MAX_SAFE_INTEGER : defaultMaxToShow;\n\t\t\t\t\t\t\t\tcurrentPicks.push(\n\t\t\t\t\t\t\t\t\t...agentPicks\n\t\t\t\t\t\t\t\t\t\t.toSorted((a, b) => (b.session.timing.endTime ?? b.session.timing.startTime) - (a.session.timing.endTime ?? a.session.timing.startTime))\n\t\t\t\t\t\t\t\t\t\t.slice(0, maxToShow));\n\n\t\t\t\t\t\t\t\t// Add \"Show more...\" if needed and not showing all agents\n\t\t\t\t\t\t\t\tif (!showAllAgents && agentPicks.length > defaultMaxToShow) {\n\t\t\t\t\t\t\t\t\tcurrentPicks.push(showMoreAgentsPick);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t// Yield the current state\n\t\t\t\t\t\t\tyield currentPicks;\n\n\t\t\t\t\t\t} finally {\n\t\t\t\t\t\t\tcancellationToken.dispose();\n\t\t\t\t\t\t}\n\n\t\t\t\t\t} catch (error) {\n\t\t\t\t\t\t// Gracefully handle errors in async contributions\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t})();\n\n\t\t\t\t// Return fast picks immediately, add slow picks as async generator\n\t\t\t\treturn {\n\t\t\t\t\tfast: coalesce(fastPicks),\n\t\t\t\t\tslow: slowPicks\n\t\t\t\t};\n\t\t\t};\n\n\t\t\tconst store = new DisposableStore();\n\t\t\tconst picker = store.add(quickInputService.createQuickPick<IChatPickerItem | IQuickPickItem>({ useSeparators: true }));\n\t\t\tpicker.title = (showAllChats || showAllAgents) ?\n\t\t\t\tlocalize('interactiveSession.history.titleAll', \"All Workspace Chat History\") :\n\t\t\t\tlocalize('interactiveSession.history.title', \"Workspace Chat History\");\n\t\t\tpicker.placeholder = localize('interactiveSession.history.pick', \"Switch to chat\");\n\t\t\tpicker.buttons = [clearChatHistoryButton];\n\n\t\t\t// Get fast and slow picks\n\t\t\tconst { fast, slow } = await getPicks(showAllChats, showAllAgents);\n\n\t\t\t// Set fast picks immediately\n\t\t\tpicker.items = fast;\n\t\t\tpicker.busy = true;\n\n\t\t\t// Consume slow picks progressively\n\t\t\t(async () => {\n\t\t\t\ttry {\n\t\t\t\t\tfor await (const slowPicks of slow) {\n\t\t\t\t\t\tif (!store.isDisposed) {\n\t\t\t\t\t\t\tpicker.items = coalesce([...fast, ...slowPicks]);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} catch (error) {\n\t\t\t\t\t// Handle errors gracefully\n\t\t\t\t} finally {\n\t\t\t\t\tif (!store.isDisposed) {\n\t\t\t\t\t\tpicker.busy = false;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t})();\n\t\t\tstore.add(picker.onDidTriggerButton(async button => {\n\t\t\t\tif (button === clearChatHistoryButton) {\n\t\t\t\t\tawait commandService.executeCommand(CHAT_CLEAR_HISTORY_ACTION_ID);\n\t\t\t\t}\n\t\t\t}));\n\t\t\tstore.add(picker.onDidTriggerItemButton(async context => {\n\t\t\t\tif (!isChatPickerItem(context.item)) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (context.button === openInEditorButton) {\n\t\t\t\t\tconst options: IChatEditorOptions = { pinned: true };\n\t\t\t\t\teditorService.openEditor({\n\t\t\t\t\t\tresource: context.item.chat.sessionResource,\n\t\t\t\t\t\toptions,\n\t\t\t\t\t}, ACTIVE_GROUP);\n\t\t\t\t\tpicker.hide();\n\t\t\t\t} else if (context.button === deleteButton) {\n\t\t\t\t\tchatService.removeHistoryEntry(context.item.chat.sessionResource);\n\t\t\t\t\t// Refresh picker items after deletion\n\t\t\t\t\tconst { fast, slow } = await getPicks(showAllChats, showAllAgents);\n\t\t\t\t\tpicker.items = fast;\n\t\t\t\t\tpicker.busy = true;\n\n\t\t\t\t\t// Consume slow picks progressively after deletion\n\t\t\t\t\t(async () => {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tfor await (const slowPicks of slow) {\n\t\t\t\t\t\t\t\tif (!store.isDisposed) {\n\t\t\t\t\t\t\t\t\tpicker.items = coalesce([...fast, ...slowPicks]);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} catch (error) {\n\t\t\t\t\t\t\t// Handle errors gracefully\n\t\t\t\t\t\t} finally {\n\t\t\t\t\t\t\tif (!store.isDisposed) {\n\t\t\t\t\t\t\t\tpicker.busy = false;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t})();\n\t\t\t\t} else if (context.button === renameButton) {\n\t\t\t\t\tconst title = await quickInputService.input({ title: localize('newChatTitle', \"New chat title\"), value: context.item.chat.title });\n\t\t\t\t\tif (title) {\n\t\t\t\t\t\tchatService.setChatSessionTitle(context.item.chat.sessionResource, title);\n\t\t\t\t\t}\n\n\t\t\t\t\t// The quick input hides the picker, it gets disposed, so we kick it off from scratch\n\t\t\t\t\tawait this.showIntegratedPicker(\n\t\t\t\t\t\tchatService,\n\t\t\t\t\t\tquickInputService,\n\t\t\t\t\t\tcommandService,\n\t\t\t\t\t\teditorService,\n\t\t\t\t\t\tchatWidgetService,\n\t\t\t\t\t\tview,\n\t\t\t\t\t\tchatSessionsService,\n\t\t\t\t\t\tcontextKeyService,\n\t\t\t\t\t\tmenuService,\n\t\t\t\t\t\tshowAllChats,\n\t\t\t\t\t\tshowAllAgents\n\t\t\t\t\t);\n\t\t\t\t} else {\n\t\t\t\t\tconst buttonItem = context.button as ICodingAgentPickerItem;\n\t\t\t\t\tif (buttonItem.id) {\n\t\t\t\t\t\tconst contextItem = context.item as ICodingAgentPickerItem;\n\n\t\t\t\t\t\tif (contextItem.session) {\n\t\t\t\t\t\t\tcommandService.executeCommand(buttonItem.id, {\n\t\t\t\t\t\t\t\tsession: contextItem.session,\n\t\t\t\t\t\t\t\t$mid: MarshalledId.ChatSessionContext\n\t\t\t\t\t\t\t} satisfies IMarshalledChatSessionContext);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// dismiss quick picker\n\t\t\t\t\t\tpicker.hide();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}));\n\t\t\tstore.add(picker.onDidAccept(async () => {\n\t\t\t\ttry {\n\t\t\t\t\tconst item = picker.selectedItems[0];\n\n\t\t\t\t\t// Handle \"Show more...\" options\n\t\t\t\t\tif (item === showMorePick) {\n\t\t\t\t\t\tpicker.hide();\n\t\t\t\t\t\t// Create a new picker with all chat items expanded\n\t\t\t\t\t\tawait this.showIntegratedPicker(\n\t\t\t\t\t\t\tchatService,\n\t\t\t\t\t\t\tquickInputService,\n\t\t\t\t\t\t\tcommandService,\n\t\t\t\t\t\t\teditorService,\n\t\t\t\t\t\t\tchatWidgetService,\n\t\t\t\t\t\t\tview,\n\t\t\t\t\t\t\tchatSessionsService,\n\t\t\t\t\t\t\tcontextKeyService,\n\t\t\t\t\t\t\tmenuService,\n\t\t\t\t\t\t\ttrue,\n\t\t\t\t\t\t\tshowAllAgents\n\t\t\t\t\t\t);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t} else if (item === showMoreAgentsPick) {\n\t\t\t\t\t\tpicker.hide();\n\t\t\t\t\t\t// Create a new picker with all agent items expanded\n\t\t\t\t\t\tawait this.showIntegratedPicker(\n\t\t\t\t\t\t\tchatService,\n\t\t\t\t\t\t\tquickInputService,\n\t\t\t\t\t\t\tcommandService,\n\t\t\t\t\t\t\teditorService,\n\t\t\t\t\t\t\tchatWidgetService,\n\t\t\t\t\t\t\tview,\n\t\t\t\t\t\t\tchatSessionsService,\n\t\t\t\t\t\t\tcontextKeyService,\n\t\t\t\t\t\t\tmenuService,\n\t\t\t\t\t\t\tshowAllChats,\n\t\t\t\t\t\t\ttrue\n\t\t\t\t\t\t);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t} else if (isCodingAgentPickerItem(item)) {\n\t\t\t\t\t\t// TODO: This is a temporary change that will be replaced by opening a new chat instance\n\t\t\t\t\t\tif (item.session) {\n\t\t\t\t\t\t\tawait this.showChatSessionInEditor(item.session, editorService);\n\t\t\t\t\t\t}\n\t\t\t\t\t} else if (isChatPickerItem(item)) {\n\t\t\t\t\t\tawait view.loadSession(item.chat.sessionResource);\n\t\t\t\t\t}\n\t\t\t\t} finally {\n\t\t\t\t\tpicker.hide();\n\t\t\t\t}\n\t\t\t}));\n\t\t\tstore.add(picker.onDidHide(() => store.dispose()));\n\n\t\t\tpicker.show();\n\t\t}\n\n\t\tasync run(accessor: ServicesAccessor) {\n\t\t\tconst chatService = accessor.get(IChatService);\n\t\t\tconst quickInputService = accessor.get(IQuickInputService);\n\t\t\tconst viewsService = accessor.get(IViewsService);\n\t\t\tconst editorService = accessor.get(IEditorService);\n\t\t\tconst chatWidgetService = accessor.get(IChatWidgetService);\n\t\t\tconst dialogService = accessor.get(IDialogService);\n\t\t\tconst commandService = accessor.get(ICommandService);\n\t\t\tconst chatSessionsService = accessor.get(IChatSessionsService);\n\t\t\tconst contextKeyService = accessor.get(IContextKeyService);\n\t\t\tconst menuService = accessor.get(IMenuService);\n\n\t\t\tconst view = await viewsService.openView<ChatViewPane>(ChatViewId);\n\t\t\tif (!view?.widget.viewModel) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst editingSession = view.widget.viewModel.model.editingSession;\n\t\t\tif (editingSession) {\n\t\t\t\tconst phrase = localize('switchChat.confirmPhrase', \"Switching chats will end your current edit session.\");\n\t\t\t\tif (!await handleCurrentEditingSession(editingSession, phrase, dialogService)) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Check if there are any non-local chat session item providers registered\n\t\t\tconst allProviders = chatSessionsService.getAllChatSessionItemProviders();\n\t\t\tconst hasNonLocalProviders = allProviders.some(provider => provider.chatSessionType !== localChatSessionType);\n\n\t\t\tif (hasNonLocalProviders) {\n\t\t\t\tawait this.showIntegratedPicker(\n\t\t\t\t\tchatService,\n\t\t\t\t\tquickInputService,\n\t\t\t\t\tcommandService,\n\t\t\t\t\teditorService,\n\t\t\t\t\tchatWidgetService,\n\t\t\t\t\tview,\n\t\t\t\t\tchatSessionsService,\n\t\t\t\t\tcontextKeyService,\n\t\t\t\t\tmenuService\n\t\t\t\t);\n\t\t\t} else {\n\t\t\t\tawait this.showLegacyPicker(chatService, quickInputService, commandService, editorService, view);\n\t\t\t}\n\t\t}\n\n\t\tprivate async showChatSessionInEditor(session: IChatSessionItem, editorService: IEditorService) {\n\t\t\t// Open the chat editor\n\t\t\tawait editorService.openEditor({\n\t\t\t\tresource: session.resource,\n\t\t\t\toptions: {} satisfies IChatEditorOptions\n\t\t\t});\n\t\t}\n\t});\n\n\tregisterAction2(class NewChatEditorAction extends Action2 {\n\t\tconstructor() {\n\t\t\tsuper({\n\t\t\t\tid: ACTION_ID_OPEN_CHAT,\n\t\t\t\ttitle: localize2('interactiveSession.open', \"New Chat Editor\"),\n\t\t\t\ticon: Codicon.plus,\n\t\t\t\tf1: true,\n\t\t\t\tcategory: CHAT_CATEGORY,\n\t\t\t\tprecondition: ChatContextKeys.enabled,\n\t\t\t\tkeybinding: {\n\t\t\t\t\tweight: KeybindingWeight.WorkbenchContrib,\n\t\t\t\t\tprimary: KeyMod.CtrlCmd | KeyCode.KeyN,\n\t\t\t\t\twhen: ContextKeyExpr.and(ChatContextKeys.inChatSession, ChatContextKeys.inChatEditor)\n\t\t\t\t},\n\t\t\t\tmenu: [{\n\t\t\t\t\tid: MenuId.ChatTitleBarMenu,\n\t\t\t\t\tgroup: 'b_new',\n\t\t\t\t\torder: 0\n\t\t\t\t}, {\n\t\t\t\t\tid: MenuId.ChatNewMenu,\n\t\t\t\t\tgroup: '2_new',\n\t\t\t\t\torder: 2\n\t\t\t\t}, {\n\t\t\t\t\tid: MenuId.EditorTitle,\n\t\t\t\t\tgroup: 'navigation',\n\t\t\t\t\twhen: ContextKeyExpr.and(ActiveEditorContext.isEqualTo(ChatEditorInput.EditorID), ChatContextKeys.lockedToCodingAgent.negate()),\n\t\t\t\t\torder: 1\n\t\t\t\t}],\n\t\t\t});\n\t\t}\n\n\t\tasync run(accessor: ServicesAccessor) {\n\t\t\tconst editorService = accessor.get(IEditorService);\n\t\t\tawait editorService.openEditor({ resource: ChatEditorInput.getNewEditorUri(), options: { pinned: true } satisfies IChatEditorOptions });\n\t\t}\n\t});\n\n\tregisterAction2(class NewChatWindowAction extends Action2 {\n\t\tconstructor() {\n\t\t\tsuper({\n\t\t\t\tid: `workbench.action.newChatWindow`,\n\t\t\t\ttitle: localize2('interactiveSession.newChatWindow', \"New Chat Window\"),\n\t\t\t\tf1: true,\n\t\t\t\tcategory: CHAT_CATEGORY,\n\t\t\t\tprecondition: ChatContextKeys.enabled,\n\t\t\t\tmenu: [{\n\t\t\t\t\tid: MenuId.ChatTitleBarMenu,\n\t\t\t\t\tgroup: 'b_new',\n\t\t\t\t\torder: 1\n\t\t\t\t}, {\n\t\t\t\t\tid: MenuId.ChatNewMenu,\n\t\t\t\t\tgroup: '2_new',\n\t\t\t\t\torder: 3\n\t\t\t\t}]\n\t\t\t});\n\t\t}\n\n\t\tasync run(accessor: ServicesAccessor) {\n\t\t\tconst editorService = accessor.get(IEditorService);\n\t\t\tawait editorService.openEditor({ resource: ChatEditorInput.getNewEditorUri(), options: { pinned: true, auxiliary: { compact: true, bounds: { width: 640, height: 640 } } } satisfies IChatEditorOptions }, AUX_WINDOW_GROUP);\n\t\t}\n\t});\n\n\tregisterAction2(class OpenChatEditorInNewWindowAction extends Action2 {\n\t\tconstructor() {\n\t\t\tsuper({\n\t\t\t\tid: `workbench.action.chat.newChatInNewWindow`,\n\t\t\t\ttitle: localize2('chatSessions.openNewChatInNewWindow', 'Open New Chat in New Window'),\n\t\t\t\tf1: false,\n\t\t\t\tcategory: CHAT_CATEGORY,\n\t\t\t\tprecondition: ChatContextKeys.enabled,\n\t\t\t\tmenu: {\n\t\t\t\t\tid: MenuId.ViewTitle,\n\t\t\t\t\tgroup: 'submenu',\n\t\t\t\t\torder: 1,\n\t\t\t\t\twhen: ContextKeyExpr.equals('view', `${LEGACY_AGENT_SESSIONS_VIEW_ID}.local`),\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tasync run(accessor: ServicesAccessor) {\n\t\t\tconst editorService = accessor.get(IEditorService);\n\t\t\tawait editorService.openEditor({\n\t\t\t\tresource: ChatEditorInput.getNewEditorUri(),\n\t\t\t\toptions: {\n\t\t\t\t\tpinned: true,\n\t\t\t\t\tauxiliary: { compact: true, bounds: { width: 800, height: 640 } }\n\t\t\t\t}\n\t\t\t}, AUX_WINDOW_GROUP);\n\t\t}\n\t});\n\n\tregisterAction2(class NewChatInSideBarAction extends Action2 {\n\t\tconstructor() {\n\t\t\tsuper({\n\t\t\t\tid: `workbench.action.chat.newChatInSideBar`,\n\t\t\t\ttitle: localize2('chatSessions.newChatInSideBar', 'Open New Chat in Side Bar'),\n\t\t\t\tf1: false,\n\t\t\t\tcategory: CHAT_CATEGORY,\n\t\t\t\tprecondition: ChatContextKeys.enabled,\n\t\t\t\tmenu: {\n\t\t\t\t\tid: MenuId.ViewTitle,\n\t\t\t\t\tgroup: 'submenu',\n\t\t\t\t\torder: 1,\n\t\t\t\t\twhen: ContextKeyExpr.equals('view', `${LEGACY_AGENT_SESSIONS_VIEW_ID}.local`),\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tasync run(accessor: ServicesAccessor) {\n\t\t\tconst widgetService = accessor.get(IChatWidgetService);\n\n\t\t\t// Open the chat view in the sidebar and get the widget\n\t\t\tconst chatWidget = await widgetService.revealWidget();\n\n\t\t\tif (chatWidget) {\n\t\t\t\t// Clear the current chat to start a new one\n\t\t\t\tawait chatWidget.clear();\n\t\t\t\tchatWidget.attachmentModel.clear(true);\n\t\t\t\tchatWidget.input.relatedFiles?.clear();\n\n\t\t\t\t// Focus the input area\n\t\t\t\tchatWidget.focusInput();\n\t\t\t}\n\t\t}\n\t});\n\n\tregisterAction2(class OpenChatInNewEditorGroupAction extends Action2 {\n\t\tconstructor() {\n\t\t\tsuper({\n\t\t\t\tid: 'workbench.action.chat.openNewChatToTheSide',\n\t\t\t\ttitle: localize2('chat.openNewChatToTheSide.label', \"Open New Chat Editor to the Side\"),\n\t\t\t\tcategory: CHAT_CATEGORY,\n\t\t\t\tprecondition: ChatContextKeys.enabled,\n\t\t\t\tf1: false,\n\t\t\t\tmenu: {\n\t\t\t\t\tid: MenuId.ViewTitle,\n\t\t\t\t\tgroup: 'submenu',\n\t\t\t\t\torder: 1,\n\t\t\t\t\twhen: ContextKeyExpr.equals('view', `${LEGACY_AGENT_SESSIONS_VIEW_ID}.local`),\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tasync run(accessor: ServicesAccessor, ...args: unknown[]) {\n\t\t\tconst editorService = accessor.get(IEditorService);\n\t\t\tconst editorGroupService = accessor.get(IEditorGroupsService);\n\n\t\t\t// Create a new editor group to the right\n\t\t\tconst newGroup = editorGroupService.addGroup(editorGroupService.activeGroup, GroupDirection.RIGHT);\n\t\t\teditorGroupService.activateGroup(newGroup);\n\n\t\t\t// Open a new chat editor in the new group\n\t\t\tawait editorService.openEditor(\n\t\t\t\t{ resource: ChatEditorInput.getNewEditorUri(), options: { pinned: true } },\n\t\t\t\tnewGroup.id\n\t\t\t);\n\t\t}\n\t});\n\n\tregisterAction2(class ClearChatInputHistoryAction extends Action2 {\n\t\tconstructor() {\n\t\t\tsuper({\n\t\t\t\tid: 'workbench.action.chat.clearInputHistory',\n\t\t\t\ttitle: localize2('interactiveSession.clearHistory.label', \"Clear Input History\"),\n\t\t\t\tprecondition: ChatContextKeys.enabled,\n\t\t\t\tcategory: CHAT_CATEGORY,\n\t\t\t\tf1: true,\n\t\t\t});\n\t\t}\n\t\tasync run(accessor: ServicesAccessor, ...args: unknown[]) {\n\t\t\tconst historyService = accessor.get(IChatWidgetHistoryService);\n\t\t\thistoryService.clearHistory();\n\t\t}\n\t});\n\n\tregisterAction2(class ClearChatHistoryAction extends Action2 {\n\t\tconstructor() {\n\t\t\tsuper({\n\t\t\t\tid: CHAT_CLEAR_HISTORY_ACTION_ID,\n\t\t\t\ttitle: localize2('chat.clear.label', \"Clear All Workspace Chats\"),\n\t\t\t\tprecondition: ChatContextKeys.enabled,\n\t\t\t\tcategory: CHAT_CATEGORY,\n\t\t\t\tf1: true,\n\t\t\t});\n\t\t}\n\t\tasync run(accessor: ServicesAccessor, ...args: unknown[]) {\n\t\t\tconst editorGroupsService = accessor.get(IEditorGroupsService);\n\t\t\tconst chatService = accessor.get(IChatService);\n\t\t\tconst instantiationService = accessor.get(IInstantiationService);\n\t\t\tconst widgetService = accessor.get(IChatWidgetService);\n\n\t\t\tawait chatService.clearAllHistoryEntries();\n\n\t\t\tawait Promise.all(widgetService.getAllWidgets().map(widget => widget.clear()));\n\n\t\t\t// Clear all chat editors. Have to go this route because the chat editor may be in the background and\n\t\t\t// not have a ChatEditorInput.\n\t\t\teditorGroupsService.groups.forEach(group => {\n\t\t\t\tgroup.editors.forEach(editor => {\n\t\t\t\t\tif (editor instanceof ChatEditorInput) {\n\t\t\t\t\t\tinstantiationService.invokeFunction(clearChatEditor, editor);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\t});\n\n\tregisterAction2(class FocusChatAction extends EditorAction2 {\n\t\tconstructor() {\n\t\t\tsuper({\n\t\t\t\tid: 'chat.action.focus',\n\t\t\t\ttitle: localize2('actions.interactiveSession.focus', 'Focus Chat List'),\n\t\t\t\tprecondition: ContextKeyExpr.and(ChatContextKeys.inChatInput),\n\t\t\t\tcategory: CHAT_CATEGORY,\n\t\t\t\tkeybinding: [\n\t\t\t\t\t// On mac, require that the cursor is at the top of the input, to avoid stealing cmd+up to move the cursor to the top\n\t\t\t\t\t{\n\t\t\t\t\t\twhen: ContextKeyExpr.and(ChatContextKeys.inputCursorAtTop, ChatContextKeys.inQuickChat.negate()),\n\t\t\t\t\t\tprimary: KeyMod.CtrlCmd | KeyCode.UpArrow,\n\t\t\t\t\t\tweight: KeybindingWeight.EditorContrib,\n\t\t\t\t\t},\n\t\t\t\t\t// On win/linux, ctrl+up can always focus the chat list\n\t\t\t\t\t{\n\t\t\t\t\t\twhen: ContextKeyExpr.and(ContextKeyExpr.or(IsWindowsContext, IsLinuxContext), ChatContextKeys.inQuickChat.negate()),\n\t\t\t\t\t\tprimary: KeyMod.CtrlCmd | KeyCode.UpArrow,\n\t\t\t\t\t\tweight: KeybindingWeight.EditorContrib,\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\twhen: ContextKeyExpr.and(ChatContextKeys.inChatSession, ChatContextKeys.inQuickChat),\n\t\t\t\t\t\tprimary: KeyMod.CtrlCmd | KeyCode.DownArrow,\n\t\t\t\t\t\tweight: KeybindingWeight.WorkbenchContrib,\n\t\t\t\t\t}\n\t\t\t\t]\n\t\t\t});\n\t\t}\n\n\t\trunEditorCommand(accessor: ServicesAccessor, editor: ICodeEditor): void | Promise<void> {\n\t\t\tconst editorUri = editor.getModel()?.uri;\n\t\t\tif (editorUri) {\n\t\t\t\tconst widgetService = accessor.get(IChatWidgetService);\n\t\t\t\twidgetService.getWidgetByInputUri(editorUri)?.focusResponseItem();\n\t\t\t}\n\t\t}\n\t});\n\n\tregisterAction2(class FocusMostRecentlyFocusedChatAction extends EditorAction2 {\n\t\tconstructor() {\n\t\t\tsuper({\n\t\t\t\tid: 'workbench.chat.action.focusLastFocused',\n\t\t\t\ttitle: localize2('actions.interactiveSession.focusLastFocused', 'Focus Last Focused Chat List Item'),\n\t\t\t\tprecondition: ContextKeyExpr.and(ChatContextKeys.inChatInput),\n\t\t\t\tcategory: CHAT_CATEGORY,\n\t\t\t\tkeybinding: [\n\t\t\t\t\t// On mac, require that the cursor is at the top of the input, to avoid stealing cmd+up to move the cursor to the top\n\t\t\t\t\t{\n\t\t\t\t\t\twhen: ContextKeyExpr.and(ChatContextKeys.inputCursorAtTop, ChatContextKeys.inQuickChat.negate()),\n\t\t\t\t\t\tprimary: KeyMod.CtrlCmd | KeyCode.UpArrow | KeyMod.Shift,\n\t\t\t\t\t\tweight: KeybindingWeight.EditorContrib + 1,\n\t\t\t\t\t},\n\t\t\t\t\t// On win/linux, ctrl+up can always focus the chat list\n\t\t\t\t\t{\n\t\t\t\t\t\twhen: ContextKeyExpr.and(ContextKeyExpr.or(IsWindowsContext, IsLinuxContext), ChatContextKeys.inQuickChat.negate()),\n\t\t\t\t\t\tprimary: KeyMod.CtrlCmd | KeyCode.UpArrow | KeyMod.Shift,\n\t\t\t\t\t\tweight: KeybindingWeight.EditorContrib + 1,\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\twhen: ContextKeyExpr.and(ChatContextKeys.inChatSession, ChatContextKeys.inQuickChat),\n\t\t\t\t\t\tprimary: KeyMod.CtrlCmd | KeyCode.DownArrow | KeyMod.Shift,\n\t\t\t\t\t\tweight: KeybindingWeight.WorkbenchContrib + 1,\n\t\t\t\t\t}\n\t\t\t\t]\n\t\t\t});\n\t\t}\n\n\t\trunEditorCommand(accessor: ServicesAccessor, editor: ICodeEditor): void | Promise<void> {\n\t\t\tconst editorUri = editor.getModel()?.uri;\n\t\t\tif (editorUri) {\n\t\t\t\tconst widgetService = accessor.get(IChatWidgetService);\n\t\t\t\twidgetService.getWidgetByInputUri(editorUri)?.focusResponseItem(true);\n\t\t\t}\n\t\t}\n\t});\n\n\tregisterAction2(class FocusChatInputAction extends Action2 {\n\t\tconstructor() {\n\t\t\tsuper({\n\t\t\t\tid: 'workbench.action.chat.focusInput',\n\t\t\t\ttitle: localize2('interactiveSession.focusInput.label', \"Focus Chat Input\"),\n\t\t\t\tf1: false,\n\t\t\t\tkeybinding: [\n\t\t\t\t\t{\n\t\t\t\t\t\tprimary: KeyMod.CtrlCmd | KeyCode.DownArrow,\n\t\t\t\t\t\tweight: KeybindingWeight.WorkbenchContrib,\n\t\t\t\t\t\twhen: ContextKeyExpr.and(ChatContextKeys.inChatSession, ChatContextKeys.inChatInput.negate(), ChatContextKeys.inQuickChat.negate()),\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\twhen: ContextKeyExpr.and(ChatContextKeys.inChatSession, ChatContextKeys.inChatInput.negate(), ChatContextKeys.inQuickChat),\n\t\t\t\t\t\tprimary: KeyMod.CtrlCmd | KeyCode.UpArrow,\n\t\t\t\t\t\tweight: KeybindingWeight.WorkbenchContrib,\n\t\t\t\t\t}\n\t\t\t\t]\n\t\t\t});\n\t\t}\n\t\trun(accessor: ServicesAccessor, ...args: unknown[]) {\n\t\t\tconst widgetService = accessor.get(IChatWidgetService);\n\t\t\twidgetService.lastFocusedWidget?.focusInput();\n\t\t}\n\t});\n\n\tconst nonEnterpriseCopilotUsers = ContextKeyExpr.and(ChatContextKeys.enabled, ContextKeyExpr.notEquals(`config.${defaultChat.completionsAdvancedSetting}.authProvider`, defaultChat.provider.enterprise.id));\n\tregisterAction2(class extends Action2 {\n\t\tconstructor() {\n\t\t\tsuper({\n\t\t\t\tid: 'workbench.action.chat.manageSettings',\n\t\t\t\ttitle: localize2('manageChat', \"Manage Chat\"),\n\t\t\t\tcategory: CHAT_CATEGORY,\n\t\t\t\tf1: true,\n\t\t\t\tprecondition: ContextKeyExpr.and(\n\t\t\t\t\tContextKeyExpr.or(\n\t\t\t\t\t\tChatContextKeys.Entitlement.planFree,\n\t\t\t\t\t\tChatContextKeys.Entitlement.planPro,\n\t\t\t\t\t\tChatContextKeys.Entitlement.planProPlus\n\t\t\t\t\t),\n\t\t\t\t\tnonEnterpriseCopilotUsers\n\t\t\t\t),\n\t\t\t\tmenu: {\n\t\t\t\t\tid: MenuId.ChatTitleBarMenu,\n\t\t\t\t\tgroup: 'y_manage',\n\t\t\t\t\torder: 1,\n\t\t\t\t\twhen: nonEnterpriseCopilotUsers\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\toverride async run(accessor: ServicesAccessor): Promise<void> {\n\t\t\tconst openerService = accessor.get(IOpenerService);\n\t\t\topenerService.open(URI.parse(defaultChat.manageSettingsUrl));\n\t\t}\n\t});\n\n\tregisterAction2(class ShowExtensionsUsingCopilot extends Action2 {\n\n\t\tconstructor() {\n\t\t\tsuper({\n\t\t\t\tid: 'workbench.action.chat.showExtensionsUsingCopilot',\n\t\t\t\ttitle: localize2('showCopilotUsageExtensions', \"Show Extensions using Copilot\"),\n\t\t\t\tf1: true,\n\t\t\t\tcategory: EXTENSIONS_CATEGORY,\n\t\t\t\tprecondition: ChatContextKeys.enabled\n\t\t\t});\n\t\t}\n\n\t\toverride async run(accessor: ServicesAccessor): Promise<void> {\n\t\t\tconst extensionsWorkbenchService = accessor.get(IExtensionsWorkbenchService);\n\t\t\textensionsWorkbenchService.openSearch(`@feature:${CopilotUsageExtensionFeatureId}`);\n\t\t}\n\t});\n\n\tregisterAction2(class ConfigureCopilotCompletions extends Action2 {\n\n\t\tconstructor() {\n\t\t\tsuper({\n\t\t\t\tid: 'workbench.action.chat.configureCodeCompletions',\n\t\t\t\ttitle: localize2('configureCompletions', \"Configure Inline Suggestions...\"),\n\t\t\t\tprecondition: ContextKeyExpr.and(\n\t\t\t\t\tChatContextKeys.Setup.installed,\n\t\t\t\t\tChatContextKeys.Setup.disabled.negate(),\n\t\t\t\t\tChatContextKeys.Setup.untrusted.negate()\n\t\t\t\t),\n\t\t\t\tmenu: {\n\t\t\t\t\tid: MenuId.ChatTitleBarMenu,\n\t\t\t\t\tgroup: 'f_completions',\n\t\t\t\t\torder: 10,\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\toverride async run(accessor: ServicesAccessor): Promise<void> {\n\t\t\tconst commandService = accessor.get(ICommandService);\n\t\t\tcommandService.executeCommand(defaultChat.completionsMenuCommand);\n\t\t}\n\t});\n\n\tregisterAction2(class ShowQuotaExceededDialogAction extends Action2 {\n\n\t\tconstructor() {\n\t\t\tsuper({\n\t\t\t\tid: OPEN_CHAT_QUOTA_EXCEEDED_DIALOG,\n\t\t\t\ttitle: localize('upgradeChat', \"Upgrade Puku AI Plan\")\n\t\t\t});\n\t\t}\n\n\t\toverride async run(accessor: ServicesAccessor) {\n\t\t\tconst chatEntitlementService = accessor.get(IChatEntitlementService);\n\t\t\tconst commandService = accessor.get(ICommandService);\n\t\t\tconst dialogService = accessor.get(IDialogService);\n\t\t\tconst telemetryService = accessor.get(ITelemetryService);\n\n\t\t\tlet message: string;\n\t\t\tconst chatQuotaExceeded = chatEntitlementService.quotas.chat?.percentRemaining === 0;\n\t\t\tconst completionsQuotaExceeded = chatEntitlementService.quotas.completions?.percentRemaining === 0;\n\t\t\tif (chatQuotaExceeded && !completionsQuotaExceeded) {\n\t\t\t\tmessage = localize('chatQuotaExceeded', \"You've reached your monthly chat messages quota. You still have free inline suggestions available.\");\n\t\t\t} else if (completionsQuotaExceeded && !chatQuotaExceeded) {\n\t\t\t\tmessage = localize('completionsQuotaExceeded', \"You've reached your monthly inline suggestions quota. You still have free chat messages available.\");\n\t\t\t} else {\n\t\t\t\tmessage = localize('chatAndCompletionsQuotaExceeded', \"You've reached your monthly chat messages and inline suggestions quota.\");\n\t\t\t}\n\n\t\t\tif (chatEntitlementService.quotas.resetDate) {\n\t\t\t\tconst dateFormatter = chatEntitlementService.quotas.resetDateHasTime ? safeIntl.DateTimeFormat(language, { year: 'numeric', month: 'long', day: 'numeric', hour: 'numeric', minute: 'numeric' }) : safeIntl.DateTimeFormat(language, { year: 'numeric', month: 'long', day: 'numeric' });\n\t\t\t\tconst quotaResetDate = new Date(chatEntitlementService.quotas.resetDate);\n\t\t\t\tmessage = [message, localize('quotaResetDate', \"The allowance will reset on {0}.\", dateFormatter.value.format(quotaResetDate))].join(' ');\n\t\t\t}\n\n\t\t\tconst free = chatEntitlementService.entitlement === ChatEntitlement.Free;\n\t\t\tconst upgradeToPro = free ? localize('upgradeToPro', \"Upgrade to Puku AI Pro (your first 30 days are free) for:\\n- Unlimited inline suggestions\\n- Unlimited chat messages\\n- Access to premium models\") : undefined;\n\n\t\t\tawait dialogService.prompt({\n\t\t\t\ttype: 'none',\n\t\t\t\tmessage: localize('copilotQuotaReached', \"Puku AI Quota Reached\"),\n\t\t\t\tcancelButton: {\n\t\t\t\t\tlabel: localize('dismiss', \"Dismiss\"),\n\t\t\t\t\trun: () => { /* noop */ }\n\t\t\t\t},\n\t\t\t\tbuttons: [\n\t\t\t\t\t{\n\t\t\t\t\t\tlabel: free ? localize('upgradePro', \"Upgrade to Puku AI Pro\") : localize('upgradePlan', \"Upgrade Puku AI Plan\"),\n\t\t\t\t\t\trun: () => {\n\t\t\t\t\t\t\tconst commandId = 'workbench.action.chat.upgradePlan';\n\t\t\t\t\t\t\ttelemetryService.publicLog2<WorkbenchActionExecutedEvent, WorkbenchActionExecutedClassification>('workbenchActionExecuted', { id: commandId, from: 'chat-dialog' });\n\t\t\t\t\t\t\tcommandService.executeCommand(commandId);\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t\tcustom: {\n\t\t\t\t\ticon: Codicon.copilotWarningLarge,\n\t\t\t\t\tmarkdownDetails: coalesce([\n\t\t\t\t\t\t{ markdown: new MarkdownString(message, true) },\n\t\t\t\t\t\tupgradeToPro ? { markdown: new MarkdownString(upgradeToPro, true) } : undefined\n\t\t\t\t\t])\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t});\n\n\tregisterAction2(class ResetTrustedToolsAction extends Action2 {\n\t\tconstructor() {\n\t\t\tsuper({\n\t\t\t\tid: 'workbench.action.chat.resetTrustedTools',\n\t\t\t\ttitle: localize2('resetTrustedTools', \"Reset Tool Confirmations\"),\n\t\t\t\tcategory: CHAT_CATEGORY,\n\t\t\t\tf1: true,\n\t\t\t\tprecondition: ChatContextKeys.enabled\n\t\t\t});\n\t\t}\n\t\toverride run(accessor: ServicesAccessor): void {\n\t\t\taccessor.get(ILanguageModelToolsConfirmationService).resetToolAutoConfirmation();\n\t\t\taccessor.get(INotificationService).info(localize('resetTrustedToolsSuccess', \"Tool confirmation preferences have been reset.\"));\n\t\t}\n\t});\n\n\tregisterAction2(class UpdateInstructionsAction extends Action2 {\n\t\tconstructor() {\n\t\t\tsuper({\n\t\t\t\tid: 'workbench.action.chat.generateInstructions',\n\t\t\t\ttitle: localize2('generateInstructions', \"Generate Workspace Instructions File\"),\n\t\t\t\tshortTitle: localize2('generateInstructions.short', \"Generate Chat Instructions\"),\n\t\t\t\tcategory: CHAT_CATEGORY,\n\t\t\t\ticon: Codicon.sparkle,\n\t\t\t\tf1: true,\n\t\t\t\tprecondition: ChatContextKeys.enabled,\n\t\t\t\tmenu: {\n\t\t\t\t\tid: CHAT_CONFIG_MENU_ID,\n\t\t\t\t\twhen: ContextKeyExpr.and(ChatContextKeys.enabled, ContextKeyExpr.equals('view', ChatViewId)),\n\t\t\t\t\torder: 11,\n\t\t\t\t\tgroup: '1_level'\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tasync run(accessor: ServicesAccessor): Promise<void> {\n\t\t\tconst commandService = accessor.get(ICommandService);\n\n\t\t\t// Use chat command to open and send the query\n\t\t\tconst query = `Analyze this codebase to generate or update \\`.github/copilot-instructions.md\\` for guiding AI coding agents.\n\nFocus on discovering the essential knowledge that would help an AI agents be immediately productive in this codebase. Consider aspects like:\n- The \"big picture\" architecture that requires reading multiple files to understand - major components, service boundaries, data flows, and the \"why\" behind structural decisions\n- Critical developer workflows (builds, tests, debugging) especially commands that aren't obvious from file inspection alone\n- Project-specific conventions and patterns that differ from common practices\n- Integration points, external dependencies, and cross-component communication patterns\n\nSource existing AI conventions from \\`**/{.github/copilot-instructions.md,AGENT.md,AGENTS.md,CLAUDE.md,.cursorrules,.windsurfrules,.clinerules,.cursor/rules/**,.windsurf/rules/**,.clinerules/**,README.md}\\` (do one glob search).\n\nGuidelines (read more at https://aka.ms/vscode-instructions-docs):\n- If \\`.github/copilot-instructions.md\\` exists, merge intelligently - preserve valuable content while updating outdated sections\n- Write concise, actionable instructions (~20-50 lines) using markdown structure\n- Include specific examples from the codebase when describing patterns\n- Avoid generic advice (\"write tests\", \"handle errors\") - focus on THIS project's specific approaches\n- Document only discoverable patterns, not aspirational practices\n- Reference key files/directories that exemplify important patterns\n\nUpdate \\`.github/copilot-instructions.md\\` for the user, then ask for feedback on any unclear or incomplete sections to iterate.`;\n\n\t\t\tawait commandService.executeCommand('workbench.action.chat.open', {\n\t\t\t\tmode: 'agent',\n\t\t\t\tquery: query,\n\t\t\t});\n\t\t}\n\t});\n\n\tregisterAction2(class OpenChatFeatureSettingsAction extends Action2 {\n\t\tconstructor() {\n\t\t\tsuper({\n\t\t\t\tid: 'workbench.action.chat.openFeatureSettings',\n\t\t\t\ttitle: localize2('openChatFeatureSettings', \"Chat Settings\"),\n\t\t\t\tshortTitle: localize('openChatFeatureSettings.short', \"Chat Settings\"),\n\t\t\t\tcategory: CHAT_CATEGORY,\n\t\t\t\tf1: true,\n\t\t\t\tprecondition: ChatContextKeys.enabled,\n\t\t\t\tmenu: [{\n\t\t\t\t\tid: CHAT_CONFIG_MENU_ID,\n\t\t\t\t\twhen: ContextKeyExpr.and(ChatContextKeys.enabled, ContextKeyExpr.equals('view', ChatViewId)),\n\t\t\t\t\torder: 15,\n\t\t\t\t\tgroup: '3_configure'\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tid: MenuId.ChatWelcomeContext,\n\t\t\t\t\tgroup: '2_settings',\n\t\t\t\t\torder: 1\n\t\t\t\t}]\n\t\t\t});\n\t\t}\n\n\t\toverride async run(accessor: ServicesAccessor): Promise<void> {\n\t\t\tconst preferencesService = accessor.get(IPreferencesService);\n\t\t\tpreferencesService.openSettings({ query: '@feature:chat ' });\n\t\t}\n\t});\n\n\tMenuRegistry.appendMenuItem(MenuId.ViewTitle, {\n\t\tsubmenu: CHAT_CONFIG_MENU_ID,\n\t\ttitle: localize2('config.label', \"Configure Chat\"),\n\t\tgroup: 'navigation',\n\t\twhen: ContextKeyExpr.equals('view', ChatViewId),\n\t\ticon: Codicon.gear,\n\t\torder: 6\n\t});\n}\n\nexport function stringifyItem(item: IChatRequestViewModel | IChatResponseViewModel, includeName = true): string {\n\tif (isRequestVM(item)) {\n\t\treturn (includeName ? `${item.username}: ` : '') + item.messageText;\n\t} else {\n\t\treturn (includeName ? `${item.username}: ` : '') + item.response.toString();\n\t}\n}\n\n\n// --- Title Bar Chat Controls\n\nconst defaultChat = {\n\tmanageSettingsUrl: product.defaultChatAgent?.manageSettingsUrl ?? '',\n\tprovider: product.defaultChatAgent?.provider ?? { enterprise: { id: '' } },\n\tcompletionsAdvancedSetting: product.defaultChatAgent?.completionsAdvancedSetting ?? '',\n\tcompletionsMenuCommand: product.defaultChatAgent?.completionsMenuCommand ?? '',\n};\n\n// Add next to the command center if command center is disabled\nMenuRegistry.appendMenuItem(MenuId.CommandCenter, {\n\tsubmenu: MenuId.ChatTitleBarMenu,\n\ttitle: localize('title4', \"Chat\"),\n\ticon: Codicon.chatSparkle,\n\twhen: ContextKeyExpr.and(\n\t\tChatContextKeys.supported,\n\t\tContextKeyExpr.and(\n\t\t\tChatContextKeys.Setup.hidden.negate(),\n\t\t\tChatContextKeys.Setup.disabled.negate()\n\t\t),\n\t\tContextKeyExpr.has('config.chat.commandCenter.enabled')\n\t),\n\torder: 10001 // to the right of command center\n});\n\n// Add to the global title bar if command center is disabled\nMenuRegistry.appendMenuItem(MenuId.TitleBar, {\n\tsubmenu: MenuId.ChatTitleBarMenu,\n\ttitle: localize('title4', \"Chat\"),\n\tgroup: 'navigation',\n\ticon: Codicon.chatSparkle,\n\twhen: ContextKeyExpr.and(\n\t\tChatContextKeys.supported,\n\t\tContextKeyExpr.and(\n\t\t\tChatContextKeys.Setup.hidden.negate(),\n\t\t\tChatContextKeys.Setup.disabled.negate()\n\t\t),\n\t\tContextKeyExpr.has('config.chat.commandCenter.enabled'),\n\t\tContextKeyExpr.has('config.window.commandCenter').negate(),\n\t),\n\torder: 1\n});\n\nregisterAction2(class ToggleCopilotControl extends ToggleTitleBarConfigAction {\n\tconstructor() {\n\t\tsuper(\n\t\t\t'chat.commandCenter.enabled',\n\t\t\tlocalize('toggle.chatControl', 'Chat Controls'),\n\t\t\tlocalize('toggle.chatControlsDescription', \"Toggle visibility of the Chat Controls in title bar\"), 5,\n\t\t\tContextKeyExpr.and(\n\t\t\t\tContextKeyExpr.and(\n\t\t\t\t\tChatContextKeys.Setup.hidden.negate(),\n\t\t\t\t\tChatContextKeys.Setup.disabled.negate()\n\t\t\t\t),\n\t\t\t\tIsCompactTitleBarContext.negate(),\n\t\t\t\tChatContextKeys.supported\n\t\t\t)\n\t\t);\n\t}\n});\n\nexport class CopilotTitleBarMenuRendering extends Disposable implements IWorkbenchContribution {\n\n\tstatic readonly ID = 'workbench.contrib.copilotTitleBarMenuRendering';\n\n\tconstructor(\n\t\t@IActionViewItemService actionViewItemService: IActionViewItemService,\n\t\t@IChatEntitlementService chatEntitlementService: IChatEntitlementService,\n\t) {\n\t\tsuper();\n\n\t\tconst disposable = actionViewItemService.register(MenuId.CommandCenter, MenuId.ChatTitleBarMenu, (action, options, instantiationService, windowId) => {\n\t\t\tif (!(action instanceof SubmenuItemAction)) {\n\t\t\t\treturn undefined;\n\t\t\t}\n\n\t\t\tconst dropdownAction = toAction({\n\t\t\t\tid: 'copilot.titleBarMenuRendering.more',\n\t\t\t\tlabel: localize('more', \"More...\"),\n\t\t\t\trun() { }\n\t\t\t});\n\n\t\t\tconst chatSentiment = chatEntitlementService.sentiment;\n\t\t\tconst chatQuotaExceeded = chatEntitlementService.quotas.chat?.percentRemaining === 0;\n\t\t\tconst signedOut = chatEntitlementService.entitlement === ChatEntitlement.Unknown;\n\t\t\tconst anonymous = chatEntitlementService.anonymous;\n\t\t\tconst free = chatEntitlementService.entitlement === ChatEntitlement.Free;\n\n\t\t\tconst isAuxiliaryWindow = windowId !== mainWindow.vscodeWindowId;\n\t\t\tlet primaryActionId = isAuxiliaryWindow ? CHAT_OPEN_ACTION_ID : TOGGLE_CHAT_ACTION_ID;\n\t\t\tlet primaryActionTitle = isAuxiliaryWindow ? localize('openChat', \"Open Chat\") : localize('toggleChat', \"Toggle Chat\");\n\t\t\tlet primaryActionIcon = Codicon.chatSparkle;\n\t\t\tif (chatSentiment.installed && !chatSentiment.disabled) {\n\t\t\t\tif (signedOut && !anonymous) {\n\t\t\t\t\tprimaryActionId = CHAT_SETUP_ACTION_ID;\n\t\t\t\t\tprimaryActionTitle = localize('signInToChatSetup', \"Sign in to use AI features...\");\n\t\t\t\t\tprimaryActionIcon = Codicon.chatSparkleError;\n\t\t\t\t} else if (chatQuotaExceeded && free) {\n\t\t\t\t\tprimaryActionId = OPEN_CHAT_QUOTA_EXCEEDED_DIALOG;\n\t\t\t\t\tprimaryActionTitle = localize('chatQuotaExceededButton', \"Puku AI Free plan chat messages quota reached. Click for details.\");\n\t\t\t\t\tprimaryActionIcon = Codicon.chatSparkleWarning;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn instantiationService.createInstance(DropdownWithPrimaryActionViewItem, instantiationService.createInstance(MenuItemAction, {\n\t\t\t\tid: primaryActionId,\n\t\t\t\ttitle: primaryActionTitle,\n\t\t\t\ticon: primaryActionIcon,\n\t\t\t}, undefined, undefined, undefined, undefined), dropdownAction, action.actions, '', { ...options, skipTelemetry: true });\n\t\t}, Event.any(\n\t\t\tchatEntitlementService.onDidChangeSentiment,\n\t\t\tchatEntitlementService.onDidChangeQuotaExceeded,\n\t\t\tchatEntitlementService.onDidChangeEntitlement,\n\t\t\tchatEntitlementService.onDidChangeAnonymous\n\t\t));\n\n\t\t// Reduces flicker a bit on reload/restart\n\t\tmarkAsSingleton(disposable);\n\t}\n}\n\n/**\n * Returns whether we can continue clearing/switching chat sessions, false to cancel.\n */\nexport async function handleCurrentEditingSession(currentEditingSession: IChatEditingSession, phrase: string | undefined, dialogService: IDialogService): Promise<boolean> {\n\tif (shouldShowClearEditingSessionConfirmation(currentEditingSession)) {\n\t\treturn showClearEditingSessionConfirmation(currentEditingSession, dialogService, { messageOverride: phrase });\n\t}\n\n\treturn true;\n}\n\n/**\n * Returns whether we can switch the agent, based on whether the user had to agree to clear the session, false to cancel.\n */\nexport async function handleModeSwitch(\n\taccessor: ServicesAccessor,\n\tfromMode: ChatModeKind,\n\ttoMode: ChatModeKind,\n\trequestCount: number,\n\teditingSession: IChatEditingSession | undefined,\n): Promise<false | { needToClearSession: boolean }> {\n\tif (!editingSession || fromMode === toMode) {\n\t\treturn { needToClearSession: false };\n\t}\n\n\tconst configurationService = accessor.get(IConfigurationService);\n\tconst dialogService = accessor.get(IDialogService);\n\tconst needToClearEdits = (!configurationService.getValue(ChatConfiguration.Edits2Enabled) && (fromMode === ChatModeKind.Edit || toMode === ChatModeKind.Edit)) && requestCount > 0;\n\tif (needToClearEdits) {\n\t\t// If not using edits2 and switching into or out of edit mode, ask to discard the session\n\t\tconst phrase = localize('switchMode.confirmPhrase', \"Switching agents will end your current edit session.\");\n\n\t\tconst currentEdits = editingSession.entries.get();\n\t\tconst undecidedEdits = currentEdits.filter((edit) => edit.state.get() === ModifiedFileEntryState.Modified);\n\t\tif (undecidedEdits.length > 0) {\n\t\t\tif (!await handleCurrentEditingSession(editingSession, phrase, dialogService)) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\treturn { needToClearSession: true };\n\t\t} else {\n\t\t\tconst confirmation = await dialogService.confirm({\n\t\t\t\ttitle: localize('agent.newSession', \"Start new session?\"),\n\t\t\t\tmessage: localize('agent.newSessionMessage', \"Changing the agent will end your current edit session. Would you like to change the agent?\"),\n\t\t\t\tprimaryButton: localize('agent.newSession.confirm', \"Yes\"),\n\t\t\t\ttype: 'info'\n\t\t\t});\n\t\t\tif (!confirmation.confirmed) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\treturn { needToClearSession: true };\n\t\t}\n\t}\n\n\treturn { needToClearSession: false };\n}\n\nexport interface IClearEditingSessionConfirmationOptions {\n\ttitleOverride?: string;\n\tmessageOverride?: string;\n}\n\n\n// --- Chat Submenus in various Components\n\nMenuRegistry.appendMenuItem(MenuId.EditorContext, {\n\tsubmenu: MenuId.ChatTextEditorMenu,\n\tgroup: '1_chat',\n\torder: 5,\n\ttitle: localize('generateCode', \"Generate Code\"),\n\twhen: ContextKeyExpr.and(\n\t\tChatContextKeys.Setup.hidden.negate(),\n\t\tChatContextKeys.Setup.disabled.negate()\n\t)\n});\n\n// --- Chat Default Visibility\n\nregisterAction2(class ToggleDefaultVisibilityAction extends Action2 {\n\tconstructor() {\n\t\tsuper({\n\t\t\tid: 'workbench.action.chat.toggleDefaultVisibility',\n\t\t\ttitle: localize2('chat.toggleDefaultVisibility.label', \"Show View by Default\"),\n\t\t\ttoggled: ContextKeyExpr.equals('config.workbench.secondarySideBar.defaultVisibility', 'hidden').negate(),\n\t\t\tf1: false,\n\t\t\tmenu: {\n\t\t\t\tid: MenuId.ViewTitle,\n\t\t\t\twhen: ContextKeyExpr.and(\n\t\t\t\t\tContextKeyExpr.equals('view', ChatViewId),\n\t\t\t\t\tChatContextKeys.panelLocation.isEqualTo(ViewContainerLocation.AuxiliaryBar),\n\t\t\t\t),\n\t\t\t\torder: 0,\n\t\t\t\tgroup: '5_configure'\n\t\t\t},\n\t\t});\n\t}\n\n\tasync run(accessor: ServicesAccessor) {\n\t\tconst configurationService = accessor.get(IConfigurationService);\n\n\t\tconst currentValue = configurationService.getValue<'hidden' | unknown>('workbench.secondarySideBar.defaultVisibility');\n\t\tconfigurationService.updateValue('workbench.secondarySideBar.defaultVisibility', currentValue !== 'hidden' ? 'hidden' : 'visible');\n\t}\n});\n\nregisterAction2(class EditToolApproval extends Action2 {\n\tconstructor() {\n\t\tsuper({\n\t\t\tid: 'workbench.action.chat.editToolApproval',\n\t\t\ttitle: localize2('chat.editToolApproval.label', \"Manage Tool Approval\"),\n\t\t\tmetadata: {\n\t\t\t\tdescription: localize2('chat.editToolApproval.description', \"Edit/manage the tool approval and confirmation preferences for AI chat agents.\"),\n\t\t\t},\n\t\t\tprecondition: ChatContextKeys.enabled,\n\t\t\tf1: true,\n\t\t\tcategory: CHAT_CATEGORY,\n\t\t});\n\t}\n\n\tasync run(accessor: ServicesAccessor, scope?: 'workspace' | 'profile' | 'session'): Promise<void> {\n\t\tconst confirmationService = accessor.get(ILanguageModelToolsConfirmationService);\n\t\tconst toolsService = accessor.get(ILanguageModelToolsService);\n\t\tconfirmationService.manageConfirmationPreferences([...toolsService.getTools()], scope ? { defaultScope: scope } : undefined);\n\t}\n});\n\n// Register actions for chat welcome history context menu\nregisterAction2(class ToggleChatHistoryVisibilityAction extends Action2 {\n\tconstructor() {\n\t\tsuper({\n\t\t\tid: 'workbench.action.chat.toggleChatHistoryVisibility',\n\t\t\ttitle: localize2('chat.toggleChatHistoryVisibility.label', \"Chat History\"),\n\t\t\tcategory: CHAT_CATEGORY,\n\t\t\tprecondition: ChatContextKeys.enabled,\n\t\t\ttoggled: ContextKeyExpr.equals('config.chat.emptyState.history.enabled', true),\n\t\t\tmenu: {\n\t\t\t\tid: MenuId.ChatWelcomeContext,\n\t\t\t\tgroup: '1_modify',\n\t\t\t\torder: 1\n\t\t\t}\n\t\t});\n\t}\n\n\tasync run(accessor: ServicesAccessor): Promise<void> {\n\t\tconst configurationService = accessor.get(IConfigurationService);\n\t\tconst current = configurationService.getValue<boolean>('chat.emptyState.history.enabled');\n\t\tawait configurationService.updateValue('chat.emptyState.history.enabled', !current);\n\t}\n});\n"]}