{"version":3,"sources":["vs/workbench/contrib/chat/browser/chatContentParts/chatMcpServersInteractionContentPart.ts"],"names":[],"mappings":"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","file":"chatMcpServersInteractionContentPart.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as dom from '../../../../../base/browser/dom.js';\nimport { RunOnceScheduler } from '../../../../../base/common/async.js';\nimport { Codicon } from '../../../../../base/common/codicons.js';\nimport { Emitter } from '../../../../../base/common/event.js';\nimport { escapeMarkdownSyntaxTokens, createMarkdownCommandLink, MarkdownString } from '../../../../../base/common/htmlContent.js';\nimport { Lazy } from '../../../../../base/common/lazy.js';\nimport { Disposable, IDisposable, MutableDisposable } from '../../../../../base/common/lifecycle.js';\nimport { autorun } from '../../../../../base/common/observable.js';\nimport { ThemeIcon } from '../../../../../base/common/themables.js';\nimport { IMarkdownRendererService, openLinkFromMarkdown } from '../../../../../platform/markdown/browser/markdownRenderer.js';\nimport { IRenderedMarkdown } from '../../../../../base/browser/markdownRenderer.js';\nimport { localize } from '../../../../../nls.js';\nimport { IInstantiationService } from '../../../../../platform/instantiation/common/instantiation.js';\nimport { IOpenerService } from '../../../../../platform/opener/common/opener.js';\nimport { McpCommandIds } from '../../../mcp/common/mcpCommandIds.js';\nimport { IAutostartResult, IMcpService } from '../../../mcp/common/mcpTypes.js';\nimport { startServerAndWaitForLiveTools } from '../../../mcp/common/mcpTypesUtils.js';\nimport { IChatMcpServersStarting } from '../../common/chatService.js';\nimport { IChatRendererContent, IChatResponseViewModel, isResponseVM } from '../../common/chatViewModel.js';\nimport { IChatContentPart, IChatContentPartRenderContext } from './chatContentParts.js';\nimport { ChatProgressContentPart } from './chatProgressContentPart.js';\nimport './media/chatMcpServersInteractionContent.css';\n\nexport class ChatMcpServersInteractionContentPart extends Disposable implements IChatContentPart {\n\tpublic readonly domNode: HTMLElement;\n\tprivate readonly _onDidChangeHeight = this._register(new Emitter<void>());\n\tpublic readonly onDidChangeHeight = this._onDidChangeHeight.event;\n\n\tprivate workingProgressPart: ChatProgressContentPart | undefined;\n\tprivate interactionContainer: HTMLElement | undefined;\n\tprivate readonly interactionMd = this._register(new MutableDisposable<IRenderedMarkdown>());\n\tprivate readonly showSpecificServersScheduler = this._register(new RunOnceScheduler(() => this.updateDetailedProgress(this.data.state!.get()), 2500));\n\tprivate readonly previousParts = new Lazy(() => {\n\t\tif (!isResponseVM(this.context.element)) {\n\t\t\treturn [];\n\t\t}\n\n\t\treturn this.context.element.session.getItems()\n\t\t\t.filter((r, i): r is IChatResponseViewModel => isResponseVM(r) && i < this.context.elementIndex)\n\t\t\t.flatMap(i => i.response.value.filter(c => c.kind === 'mcpServersStarting'))\n\t\t\t.map(p => p.state?.get());\n\t});\n\n\tconstructor(\n\t\tprivate readonly data: IChatMcpServersStarting,\n\t\tprivate readonly context: IChatContentPartRenderContext,\n\t\t@IMcpService private readonly mcpService: IMcpService,\n\t\t@IInstantiationService private readonly instantiationService: IInstantiationService,\n\t\t@IOpenerService private readonly _openerService: IOpenerService,\n\t\t@IMarkdownRendererService private readonly _markdownRendererService: IMarkdownRendererService,\n\t) {\n\t\tsuper();\n\n\t\tthis.domNode = dom.$('.chat-mcp-servers-interaction');\n\n\t\t// Listen to autostart state changes if available\n\t\tif (data.state) {\n\t\t\tthis._register(autorun(reader => {\n\t\t\t\tconst state = data.state!.read(reader);\n\t\t\t\tthis.updateForState(state);\n\t\t\t}));\n\t\t}\n\t}\n\n\tprivate updateForState(state: IAutostartResult): void {\n\t\tif (!state.working) {\n\t\t\tthis.workingProgressPart?.domNode.remove();\n\t\t\tthis.workingProgressPart = undefined;\n\t\t\tthis.showSpecificServersScheduler.cancel();\n\t\t} else if (!this.workingProgressPart) {\n\t\t\tif (!this.showSpecificServersScheduler.isScheduled()) {\n\t\t\t\tthis.showSpecificServersScheduler.schedule();\n\t\t\t}\n\t\t} else if (this.workingProgressPart) {\n\t\t\tthis.updateDetailedProgress(state);\n\t\t}\n\n\t\tconst requiringInteraction = state.serversRequiringInteraction.filter(s => {\n\t\t\t// don't note interaction for a server we already started\n\t\t\tif (this.data.didStartServerIds?.includes(s.id)) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\t// don't note interaction for a server we previously noted interaction for\n\t\t\tif (this.previousParts.value.some(p => p?.serversRequiringInteraction.some(s2 => s.id === s2.id))) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\treturn true;\n\t\t});\n\n\t\tif (requiringInteraction.length > 0) {\n\t\t\tif (!this.interactionMd.value) {\n\t\t\t\tthis.renderInteractionRequired(requiringInteraction);\n\t\t\t} else {\n\t\t\t\tthis.updateInteractionRequired(this.interactionMd.value.element, requiringInteraction);\n\t\t\t}\n\t\t} else if (requiringInteraction.length === 0 && this.interactionContainer) {\n\t\t\tthis.interactionContainer.remove();\n\t\t\tthis.interactionContainer = undefined;\n\t\t}\n\n\t\tthis._onDidChangeHeight.fire();\n\t}\n\n\tprivate createServerCommandLinks(servers: Array<{ id: string; label: string }>): string {\n\t\treturn servers.map(s => createMarkdownCommandLink({\n\t\t\ttitle: '`' + escapeMarkdownSyntaxTokens(s.label) + '`',\n\t\t\tid: McpCommandIds.ServerOptions,\n\t\t\targuments: [s.id],\n\t\t}, false)).join(', ');\n\t}\n\n\tprivate updateDetailedProgress(state: IAutostartResult): void {\n\t\tconst skipText = createMarkdownCommandLink({\n\t\t\ttitle: localize('mcp.skip.link', 'Skip?'),\n\t\t\tid: McpCommandIds.SkipCurrentAutostart,\n\t\t});\n\n\t\tlet content: MarkdownString;\n\t\tif (state.starting.length === 0) {\n\t\t\tcontent = new MarkdownString(undefined, { isTrusted: true }).appendText(localize('mcp.working.mcp', 'Activating MCP extensions...') + ' ').appendMarkdown(skipText);\n\t\t} else {\n\t\t\t// Update to show specific server names as command links\n\t\t\tconst serverLinks = this.createServerCommandLinks(state.starting);\n\t\t\tcontent = new MarkdownString(undefined, { isTrusted: true }).appendMarkdown(localize('mcp.starting.servers', 'Starting MCP servers {0}...', serverLinks) + ' ').appendMarkdown(skipText);\n\t\t}\n\n\t\tif (this.workingProgressPart) {\n\t\t\tthis.workingProgressPart.updateMessage(content);\n\t\t} else {\n\t\t\tthis.workingProgressPart = this._register(this.instantiationService.createInstance(\n\t\t\t\tChatProgressContentPart,\n\t\t\t\t{ kind: 'progressMessage', content },\n\t\t\t\tthis._markdownRendererService,\n\t\t\t\tthis.context,\n\t\t\t\ttrue, // forceShowSpinner\n\t\t\t\ttrue, // forceShowMessage\n\t\t\t\tundefined, // icon\n\t\t\t\tundefined, // toolInvocation\n\t\t\t));\n\t\t\tthis.domNode.appendChild(this.workingProgressPart.domNode);\n\t\t}\n\n\t\tthis._onDidChangeHeight.fire();\n\t}\n\n\tprivate renderInteractionRequired(serversRequiringInteraction: Array<{ id: string; label: string; errorMessage?: string }>): void {\n\t\tthis.interactionContainer = dom.$('.chat-mcp-servers-interaction-hint');\n\n\t\t// Create subtle hint message\n\t\tconst messageContainer = dom.$('.chat-mcp-servers-message');\n\t\tconst icon = dom.$('.chat-mcp-servers-icon');\n\t\ticon.classList.add(...ThemeIcon.asClassNameArray(Codicon.mcp));\n\n\t\tconst { messageMd } = this.createInteractionMessage(serversRequiringInteraction);\n\n\t\tmessageContainer.appendChild(icon);\n\t\tmessageContainer.appendChild(messageMd.element);\n\n\t\tthis.interactionContainer.appendChild(messageContainer);\n\t\tthis.domNode.prepend(this.interactionContainer);\n\t}\n\n\tprivate updateInteractionRequired(oldElement: HTMLElement, serversRequiringInteraction: Array<{ id: string; label: string; errorMessage?: string }>): void {\n\t\tconst { messageMd } = this.createInteractionMessage(serversRequiringInteraction);\n\t\toldElement.replaceWith(messageMd.element);\n\t}\n\n\tprivate createInteractionMessage(serversRequiringInteraction: Array<{ id: string; label: string; errorMessage?: string }>) {\n\t\tconst count = serversRequiringInteraction.length;\n\t\tconst links = this.createServerCommandLinks(serversRequiringInteraction);\n\n\t\tconst content = count === 1\n\t\t\t? localize('mcp.start.single', 'The MCP server {0} may have new tools and requires interaction to start. [Start it now?]({1})', links, '#start')\n\t\t\t: localize('mcp.start.multiple', 'The MCP servers {0} may have new tools and require interaction to start. [Start them now?]({1})', links, '#start');\n\t\tconst str = new MarkdownString(content, { isTrusted: true });\n\t\tconst messageMd = this.interactionMd.value = this._markdownRendererService.render(str, {\n\t\t\tasyncRenderCallback: () => this._onDidChangeHeight.fire(),\n\t\t\tactionHandler: (content) => {\n\t\t\t\tif (!content.startsWith('command:')) {\n\t\t\t\t\tthis._start(startLink!);\n\t\t\t\t\treturn Promise.resolve(true);\n\t\t\t\t}\n\t\t\t\treturn openLinkFromMarkdown(this._openerService, content, true);\n\t\t\t}\n\t\t});\n\n\t\t// eslint-disable-next-line no-restricted-syntax\n\t\tconst startLink = [...messageMd.element.querySelectorAll('a')].find(a => !a.getAttribute('data-href')?.startsWith('command:'));\n\t\tif (!startLink) {\n\t\t\t// Should not happen\n\t\t\treturn { messageMd, startLink: undefined };\n\t\t}\n\n\t\tstartLink.setAttribute('role', 'button');\n\t\tstartLink.href = '';\n\n\t\treturn { messageMd, startLink };\n\t}\n\n\tprivate async _start(startLink: HTMLElement) {\n\t\t// Update to starting state\n\t\tstartLink.style.pointerEvents = 'none';\n\t\tstartLink.style.opacity = '0.7';\n\n\t\ttry {\n\t\t\tif (!this.data.state) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst state = this.data.state.get();\n\t\t\tconst serversToStart = state.serversRequiringInteraction;\n\n\t\t\t// Start servers in sequence with progress updates\n\t\t\tfor (let i = 0; i < serversToStart.length; i++) {\n\t\t\t\tconst serverInfo = serversToStart[i];\n\t\t\t\tstartLink.textContent = localize('mcp.starting', \"Starting {0}...\", serverInfo.label);\n\t\t\t\tthis._onDidChangeHeight.fire();\n\n\t\t\t\tconst server = this.mcpService.servers.get().find(s => s.definition.id === serverInfo.id);\n\t\t\t\tif (server) {\n\t\t\t\t\tawait startServerAndWaitForLiveTools(server, { promptType: 'all-untrusted' });\n\n\t\t\t\t\tthis.data.didStartServerIds ??= [];\n\t\t\t\t\tthis.data.didStartServerIds.push(serverInfo.id);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Remove the interaction container after successful start\n\t\t\tif (this.interactionContainer) {\n\t\t\t\tthis.interactionContainer.remove();\n\t\t\t\tthis.interactionContainer = undefined;\n\t\t\t}\n\t\t} catch (error) {\n\t\t\t// Reset link on error\n\t\t\tstartLink.style.pointerEvents = '';\n\t\t\tstartLink.style.opacity = '';\n\t\t\tstartLink.textContent = 'Start now?';\n\t\t} finally {\n\t\t\tthis._onDidChangeHeight.fire();\n\t\t}\n\t}\n\n\thasSameContent(other: IChatRendererContent): boolean {\n\t\t// Simple implementation that checks if it's the same type\n\t\treturn other.kind === 'mcpServersStarting';\n\t}\n\n\taddDisposable(disposable: IDisposable): void {\n\t\tthis._register(disposable);\n\t}\n}\n"]}