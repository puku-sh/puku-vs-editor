{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/contrib/chat/browser/chatEditing/notebook/chatEditingNotebookFileSystemProvider.ts","vs/workbench/contrib/chat/browser/chatEditing/notebook/chatEditingNotebookFileSystemProvider.ts"],"names":[],"mappings":"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","file":"chatEditingNotebookFileSystemProvider.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { VSBuffer } from '../../../../../../base/common/buffer.js';\nimport { CancellationToken } from '../../../../../../base/common/cancellation.js';\nimport { Event } from '../../../../../../base/common/event.js';\nimport { Disposable, IDisposable } from '../../../../../../base/common/lifecycle.js';\nimport { ResourceMap } from '../../../../../../base/common/map.js';\nimport { ReadableStreamEvents } from '../../../../../../base/common/stream.js';\nimport { URI } from '../../../../../../base/common/uri.js';\nimport { FileSystemProviderCapabilities, FileType, IFileChange, IFileDeleteOptions, IFileOpenOptions, IFileOverwriteOptions, IFileReadStreamOptions, IFileService, IFileSystemProvider, IFileWriteOptions, IStat, IWatchOptions } from '../../../../../../platform/files/common/files.js';\nimport { IInstantiationService } from '../../../../../../platform/instantiation/common/instantiation.js';\nimport { IWorkbenchContribution } from '../../../../../common/contributions.js';\nimport { IChatEditingService } from '../../../common/chatEditingService.js';\nimport { LocalChatSessionUri } from '../../../common/chatUri.js';\nimport { ChatEditingNotebookSnapshotScheme } from './chatEditingModifiedNotebookSnapshot.js';\n\n\nexport class ChatEditingNotebookFileSystemProviderContrib extends Disposable implements IWorkbenchContribution {\n\tstatic ID = 'chatEditingNotebookFileSystemProviderContribution';\n\tconstructor(\n\t\t@IFileService private readonly fileService: IFileService,\n\t\t@IInstantiationService instantiationService: IInstantiationService,\n\t) {\n\n\t\tsuper();\n\t\tconst fileSystemProvider = instantiationService.createInstance(ChatEditingNotebookFileSystemProvider);\n\t\tthis._register(this.fileService.registerProvider(ChatEditingNotebookSnapshotScheme, fileSystemProvider));\n\t}\n}\n\ntype ChatEditingSnapshotNotebookContentQueryData = { sessionId: string; requestId: string | undefined; undoStop: string | undefined; viewType: string };\n\nexport class ChatEditingNotebookFileSystemProvider implements IFileSystemProvider {\n\tprivate static registeredFiles = new ResourceMap<VSBuffer>();\n\tpublic readonly capabilities: FileSystemProviderCapabilities = FileSystemProviderCapabilities.Readonly | FileSystemProviderCapabilities.FileAtomicRead | FileSystemProviderCapabilities.FileReadWrite;\n\tpublic static registerFile(resource: URI, buffer: VSBuffer): IDisposable {\n\t\tChatEditingNotebookFileSystemProvider.registeredFiles.set(resource, buffer);\n\t\treturn {\n\t\t\tdispose() {\n\t\t\t\tif (ChatEditingNotebookFileSystemProvider.registeredFiles.get(resource) === buffer) {\n\t\t\t\t\tChatEditingNotebookFileSystemProvider.registeredFiles.delete(resource);\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t}\n\n\tconstructor(@IChatEditingService private readonly _chatEditingService: IChatEditingService) { }\n\n\treadonly onDidChangeCapabilities = Event.None;\n\treadonly onDidChangeFile: Event<readonly IFileChange[]> = Event.None;\n\twatch(_resource: URI, _opts: IWatchOptions): IDisposable {\n\t\treturn Disposable.None;\n\t}\n\tasync stat(_resource: URI): Promise<IStat> {\n\t\treturn {\n\t\t\ttype: FileType.File,\n\t\t\tctime: 0,\n\t\t\tmtime: 0,\n\t\t\tsize: 0\n\t\t};\n\t}\n\tmkdir(_resource: URI): Promise<void> {\n\t\tthrow new Error('Method not implemented1.');\n\t}\n\treaddir(_resource: URI): Promise<[string, FileType][]> {\n\t\tthrow new Error('Method not implemented2.');\n\t}\n\tdelete(_resource: URI, _opts: IFileDeleteOptions): Promise<void> {\n\t\tthrow new Error('Method not implemented3.');\n\t}\n\trename(_from: URI, _to: URI, _opts: IFileOverwriteOptions): Promise<void> {\n\t\tthrow new Error('Method not implemented4.');\n\t}\n\tcopy?(_from: URI, _to: URI, _opts: IFileOverwriteOptions): Promise<void> {\n\t\tthrow new Error('Method not implemented5.');\n\t}\n\tasync readFile(resource: URI): Promise<Uint8Array> {\n\t\tconst buffer = ChatEditingNotebookFileSystemProvider.registeredFiles.get(resource);\n\t\tif (buffer) {\n\t\t\treturn buffer.buffer;\n\t\t}\n\t\tconst queryData = JSON.parse(resource.query) as ChatEditingSnapshotNotebookContentQueryData;\n\t\tif (!queryData.viewType) {\n\t\t\tthrow new Error('File not found, viewType not found');\n\t\t}\n\t\tconst session = this._chatEditingService.getEditingSession(LocalChatSessionUri.forSession(queryData.sessionId));\n\t\tif (!session || !queryData.requestId) {\n\t\t\tthrow new Error('File not found, session not found');\n\t\t}\n\t\tconst snapshotEntry = await session.getSnapshotContents(queryData.requestId, resource, queryData.undoStop || undefined);\n\t\tif (!snapshotEntry) {\n\t\t\tthrow new Error('File not found, snapshot not found');\n\t\t}\n\n\t\treturn snapshotEntry.buffer;\n\t}\n\n\twriteFile?(__resource: URI, _content: Uint8Array, _opts: IFileWriteOptions): Promise<void> {\n\t\tthrow new Error('Method not implemented7.');\n\t}\n\treadFileStream?(__resource: URI, _opts: IFileReadStreamOptions, _token: CancellationToken): ReadableStreamEvents<Uint8Array> {\n\t\tthrow new Error('Method not implemented8.');\n\t}\n\topen?(__resource: URI, _opts: IFileOpenOptions): Promise<number> {\n\t\tthrow new Error('Method not implemented9.');\n\t}\n\tclose?(_fd: number): Promise<void> {\n\t\tthrow new Error('Method not implemented10.');\n\t}\n\tread?(_fd: number, _pos: number, _data: Uint8Array, _offset: number, _length: number): Promise<number> {\n\t\tthrow new Error('Method not implemented11.');\n\t}\n\twrite?(_fd: number, _pos: number, _data: Uint8Array, _offset: number, _length: number): Promise<number> {\n\t\tthrow new Error('Method not implemented12.');\n\t}\n\tcloneFile?(_from: URI, __to: URI): Promise<void> {\n\t\tthrow new Error('Method not implemented13.');\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { VSBuffer } from '../../../../../../base/common/buffer.js';\nimport { CancellationToken } from '../../../../../../base/common/cancellation.js';\nimport { Event } from '../../../../../../base/common/event.js';\nimport { Disposable, IDisposable } from '../../../../../../base/common/lifecycle.js';\nimport { ResourceMap } from '../../../../../../base/common/map.js';\nimport { ReadableStreamEvents } from '../../../../../../base/common/stream.js';\nimport { URI } from '../../../../../../base/common/uri.js';\nimport { FileSystemProviderCapabilities, FileType, IFileChange, IFileDeleteOptions, IFileOpenOptions, IFileOverwriteOptions, IFileReadStreamOptions, IFileService, IFileSystemProvider, IFileWriteOptions, IStat, IWatchOptions } from '../../../../../../platform/files/common/files.js';\nimport { IInstantiationService } from '../../../../../../platform/instantiation/common/instantiation.js';\nimport { IWorkbenchContribution } from '../../../../../common/contributions.js';\nimport { IChatEditingService } from '../../../common/chatEditingService.js';\nimport { LocalChatSessionUri } from '../../../common/chatUri.js';\nimport { ChatEditingNotebookSnapshotScheme } from './chatEditingModifiedNotebookSnapshot.js';\n\n\nexport class ChatEditingNotebookFileSystemProviderContrib extends Disposable implements IWorkbenchContribution {\n\tstatic ID = 'chatEditingNotebookFileSystemProviderContribution';\n\tconstructor(\n\t\t@IFileService private readonly fileService: IFileService,\n\t\t@IInstantiationService instantiationService: IInstantiationService,\n\t) {\n\n\t\tsuper();\n\t\tconst fileSystemProvider = instantiationService.createInstance(ChatEditingNotebookFileSystemProvider);\n\t\tthis._register(this.fileService.registerProvider(ChatEditingNotebookSnapshotScheme, fileSystemProvider));\n\t}\n}\n\ntype ChatEditingSnapshotNotebookContentQueryData = { sessionId: string; requestId: string | undefined; undoStop: string | undefined; viewType: string };\n\nexport class ChatEditingNotebookFileSystemProvider implements IFileSystemProvider {\n\tprivate static registeredFiles = new ResourceMap<VSBuffer>();\n\tpublic readonly capabilities: FileSystemProviderCapabilities = FileSystemProviderCapabilities.Readonly | FileSystemProviderCapabilities.FileAtomicRead | FileSystemProviderCapabilities.FileReadWrite;\n\tpublic static registerFile(resource: URI, buffer: VSBuffer): IDisposable {\n\t\tChatEditingNotebookFileSystemProvider.registeredFiles.set(resource, buffer);\n\t\treturn {\n\t\t\tdispose() {\n\t\t\t\tif (ChatEditingNotebookFileSystemProvider.registeredFiles.get(resource) === buffer) {\n\t\t\t\t\tChatEditingNotebookFileSystemProvider.registeredFiles.delete(resource);\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t}\n\n\tconstructor(@IChatEditingService private readonly _chatEditingService: IChatEditingService) { }\n\n\treadonly onDidChangeCapabilities = Event.None;\n\treadonly onDidChangeFile: Event<readonly IFileChange[]> = Event.None;\n\twatch(_resource: URI, _opts: IWatchOptions): IDisposable {\n\t\treturn Disposable.None;\n\t}\n\tasync stat(_resource: URI): Promise<IStat> {\n\t\treturn {\n\t\t\ttype: FileType.File,\n\t\t\tctime: 0,\n\t\t\tmtime: 0,\n\t\t\tsize: 0\n\t\t};\n\t}\n\tmkdir(_resource: URI): Promise<void> {\n\t\tthrow new Error('Method not implemented1.');\n\t}\n\treaddir(_resource: URI): Promise<[string, FileType][]> {\n\t\tthrow new Error('Method not implemented2.');\n\t}\n\tdelete(_resource: URI, _opts: IFileDeleteOptions): Promise<void> {\n\t\tthrow new Error('Method not implemented3.');\n\t}\n\trename(_from: URI, _to: URI, _opts: IFileOverwriteOptions): Promise<void> {\n\t\tthrow new Error('Method not implemented4.');\n\t}\n\tcopy?(_from: URI, _to: URI, _opts: IFileOverwriteOptions): Promise<void> {\n\t\tthrow new Error('Method not implemented5.');\n\t}\n\tasync readFile(resource: URI): Promise<Uint8Array> {\n\t\tconst buffer = ChatEditingNotebookFileSystemProvider.registeredFiles.get(resource);\n\t\tif (buffer) {\n\t\t\treturn buffer.buffer;\n\t\t}\n\t\tconst queryData = JSON.parse(resource.query) as ChatEditingSnapshotNotebookContentQueryData;\n\t\tif (!queryData.viewType) {\n\t\t\tthrow new Error('File not found, viewType not found');\n\t\t}\n\t\tconst session = this._chatEditingService.getEditingSession(LocalChatSessionUri.forSession(queryData.sessionId));\n\t\tif (!session || !queryData.requestId) {\n\t\t\tthrow new Error('File not found, session not found');\n\t\t}\n\t\tconst snapshotEntry = await session.getSnapshotContents(queryData.requestId, resource, queryData.undoStop || undefined);\n\t\tif (!snapshotEntry) {\n\t\t\tthrow new Error('File not found, snapshot not found');\n\t\t}\n\n\t\treturn snapshotEntry.buffer;\n\t}\n\n\twriteFile?(__resource: URI, _content: Uint8Array, _opts: IFileWriteOptions): Promise<void> {\n\t\tthrow new Error('Method not implemented7.');\n\t}\n\treadFileStream?(__resource: URI, _opts: IFileReadStreamOptions, _token: CancellationToken): ReadableStreamEvents<Uint8Array> {\n\t\tthrow new Error('Method not implemented8.');\n\t}\n\topen?(__resource: URI, _opts: IFileOpenOptions): Promise<number> {\n\t\tthrow new Error('Method not implemented9.');\n\t}\n\tclose?(_fd: number): Promise<void> {\n\t\tthrow new Error('Method not implemented10.');\n\t}\n\tread?(_fd: number, _pos: number, _data: Uint8Array, _offset: number, _length: number): Promise<number> {\n\t\tthrow new Error('Method not implemented11.');\n\t}\n\twrite?(_fd: number, _pos: number, _data: Uint8Array, _offset: number, _length: number): Promise<number> {\n\t\tthrow new Error('Method not implemented12.');\n\t}\n\tcloneFile?(_from: URI, __to: URI): Promise<void> {\n\t\tthrow new Error('Method not implemented13.');\n\t}\n}\n"]}