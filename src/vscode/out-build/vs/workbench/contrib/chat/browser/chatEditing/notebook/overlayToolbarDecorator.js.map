{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/contrib/chat/browser/chatEditing/notebook/overlayToolbarDecorator.ts","vs/workbench/contrib/chat/browser/chatEditing/notebook/overlayToolbarDecorator.ts"],"names":[],"mappings":"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","file":"overlayToolbarDecorator.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { ActionViewItem } from '../../../../../../base/browser/ui/actionbar/actionViewItems.js';\nimport { Disposable, DisposableStore } from '../../../../../../base/common/lifecycle.js';\nimport { AccessibilitySignal, IAccessibilitySignalService } from '../../../../../../platform/accessibilitySignal/browser/accessibilitySignalService.js';\nimport { MenuWorkbenchToolBar, HiddenItemStrategy } from '../../../../../../platform/actions/browser/toolbar.js';\nimport { MenuId } from '../../../../../../platform/actions/common/actions.js';\nimport { IContextKeyService } from '../../../../../../platform/contextkey/common/contextkey.js';\nimport { IInstantiationService } from '../../../../../../platform/instantiation/common/instantiation.js';\nimport { ServiceCollection } from '../../../../../../platform/instantiation/common/serviceCollection.js';\nimport { CellEditState, INotebookEditor } from '../../../../notebook/browser/notebookBrowser.js';\nimport { NotebookTextModel } from '../../../../notebook/common/model/notebookTextModel.js';\nimport { CellKind } from '../../../../notebook/common/notebookCommon.js';\nimport { IModifiedFileEntryChangeHunk } from '../../../common/chatEditingService.js';\nimport { ICellDiffInfo } from './notebookCellChanges.js';\n\n\nexport class OverlayToolbarDecorator extends Disposable {\n\n\tprivate _timeout: Timeout | undefined = undefined;\n\tprivate readonly overlayDisposables = this._register(new DisposableStore());\n\n\tconstructor(\n\t\tprivate readonly notebookEditor: INotebookEditor,\n\t\tprivate readonly notebookModel: NotebookTextModel,\n\t\t@IInstantiationService private readonly instantiationService: IInstantiationService,\n\t\t@IAccessibilitySignalService private readonly accessibilitySignalService: IAccessibilitySignalService,\n\t) {\n\t\tsuper();\n\t}\n\n\tdecorate(changes: ICellDiffInfo[]) {\n\t\tif (this._timeout !== undefined) {\n\t\t\tclearTimeout(this._timeout);\n\t\t}\n\t\tthis._timeout = setTimeout(() => {\n\t\t\tthis._timeout = undefined;\n\t\t\tthis.createMarkdownPreviewToolbars(changes);\n\t\t}, 100);\n\t}\n\n\tprivate createMarkdownPreviewToolbars(changes: ICellDiffInfo[]) {\n\t\tthis.overlayDisposables.clear();\n\n\t\tconst accessibilitySignalService = this.accessibilitySignalService;\n\t\tconst editor = this.notebookEditor;\n\t\tfor (const change of changes) {\n\t\t\tconst cellViewModel = this.getCellViewModel(change);\n\n\t\t\tif (!cellViewModel || cellViewModel.cellKind !== CellKind.Markup) {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tconst toolbarContainer = document.createElement('div');\n\n\t\t\tlet overlayId: string | undefined = undefined;\n\t\t\teditor.changeCellOverlays((accessor) => {\n\t\t\t\ttoolbarContainer.style.right = '44px';\n\t\t\t\toverlayId = accessor.addOverlay({\n\t\t\t\t\tcell: cellViewModel,\n\t\t\t\t\tdomNode: toolbarContainer,\n\t\t\t\t});\n\t\t\t});\n\n\t\t\tconst removeOverlay = () => {\n\t\t\t\teditor.changeCellOverlays(accessor => {\n\t\t\t\t\tif (overlayId) {\n\t\t\t\t\t\taccessor.removeOverlay(overlayId);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t};\n\n\t\t\tthis.overlayDisposables.add({ dispose: removeOverlay });\n\n\t\t\tconst toolbar = document.createElement('div');\n\t\t\ttoolbarContainer.appendChild(toolbar);\n\t\t\ttoolbar.className = 'chat-diff-change-content-widget';\n\t\t\ttoolbar.classList.add('hover'); // Show by default\n\t\t\ttoolbar.style.position = 'relative';\n\t\t\ttoolbar.style.top = '18px';\n\t\t\ttoolbar.style.zIndex = '10';\n\t\t\ttoolbar.style.display = cellViewModel.getEditState() === CellEditState.Editing ? 'none' : 'block';\n\n\t\t\tthis.overlayDisposables.add(cellViewModel.onDidChangeState((e) => {\n\t\t\t\tif (e.editStateChanged) {\n\t\t\t\t\tif (cellViewModel.getEditState() === CellEditState.Editing) {\n\t\t\t\t\t\ttoolbar.style.display = 'none';\n\t\t\t\t\t} else {\n\t\t\t\t\t\ttoolbar.style.display = 'block';\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}));\n\n\t\t\tconst scopedInstaService = this._register(this.instantiationService.createChild(new ServiceCollection([IContextKeyService, this.notebookEditor.scopedContextKeyService])));\n\t\t\tconst toolbarWidget = scopedInstaService.createInstance(MenuWorkbenchToolBar, toolbar, MenuId.ChatEditingEditorHunk, {\n\t\t\t\ttelemetrySource: 'chatEditingNotebookHunk',\n\t\t\t\thiddenItemStrategy: HiddenItemStrategy.NoHide,\n\t\t\t\ttoolbarOptions: { primaryGroup: () => true },\n\t\t\t\tmenuOptions: {\n\t\t\t\t\trenderShortTitle: true,\n\t\t\t\t\targ: {\n\t\t\t\t\t\tasync accept() {\n\t\t\t\t\t\t\taccessibilitySignalService.playSignal(AccessibilitySignal.editsKept, { allowManyInParallel: true });\n\t\t\t\t\t\t\tremoveOverlay();\n\t\t\t\t\t\t\ttoolbarWidget.dispose();\n\t\t\t\t\t\t\tfor (const singleChange of change.diff.get().changes) {\n\t\t\t\t\t\t\t\tawait change.keep(singleChange);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t},\n\t\t\t\t\t\tasync reject() {\n\t\t\t\t\t\t\taccessibilitySignalService.playSignal(AccessibilitySignal.editsUndone, { allowManyInParallel: true });\n\t\t\t\t\t\t\tremoveOverlay();\n\t\t\t\t\t\t\ttoolbarWidget.dispose();\n\t\t\t\t\t\t\tfor (const singleChange of change.diff.get().changes) {\n\t\t\t\t\t\t\t\tawait change.undo(singleChange);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t}\n\t\t\t\t\t} satisfies IModifiedFileEntryChangeHunk,\n\t\t\t\t},\n\t\t\t\tactionViewItemProvider: (action, options) => {\n\t\t\t\t\tif (!action.class) {\n\t\t\t\t\t\treturn new class extends ActionViewItem {\n\t\t\t\t\t\t\tconstructor() {\n\t\t\t\t\t\t\t\tsuper(undefined, action, { ...options, keybindingNotRenderedWithLabel: true /* hide keybinding for actions without icon */, icon: false, label: true });\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\t\t\t\t\treturn undefined;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tthis.overlayDisposables.add(toolbarWidget);\n\t\t}\n\t}\n\n\tprivate getCellViewModel(change: ICellDiffInfo) {\n\t\tif (change.type === 'delete' || change.modifiedCellIndex === undefined) {\n\t\t\treturn undefined;\n\t\t}\n\t\tconst cell = this.notebookModel.cells[change.modifiedCellIndex];\n\t\tconst cellViewModel = this.notebookEditor.getViewModel()?.viewCells.find(c => c.handle === cell.handle);\n\t\treturn cellViewModel;\n\t}\n\n\toverride dispose(): void {\n\t\tsuper.dispose();\n\t\tif (this._timeout !== undefined) {\n\t\t\tclearTimeout(this._timeout);\n\t\t}\n\t}\n\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { ActionViewItem } from '../../../../../../base/browser/ui/actionbar/actionViewItems.js';\nimport { Disposable, DisposableStore } from '../../../../../../base/common/lifecycle.js';\nimport { AccessibilitySignal, IAccessibilitySignalService } from '../../../../../../platform/accessibilitySignal/browser/accessibilitySignalService.js';\nimport { MenuWorkbenchToolBar, HiddenItemStrategy } from '../../../../../../platform/actions/browser/toolbar.js';\nimport { MenuId } from '../../../../../../platform/actions/common/actions.js';\nimport { IContextKeyService } from '../../../../../../platform/contextkey/common/contextkey.js';\nimport { IInstantiationService } from '../../../../../../platform/instantiation/common/instantiation.js';\nimport { ServiceCollection } from '../../../../../../platform/instantiation/common/serviceCollection.js';\nimport { CellEditState, INotebookEditor } from '../../../../notebook/browser/notebookBrowser.js';\nimport { NotebookTextModel } from '../../../../notebook/common/model/notebookTextModel.js';\nimport { CellKind } from '../../../../notebook/common/notebookCommon.js';\nimport { IModifiedFileEntryChangeHunk } from '../../../common/chatEditingService.js';\nimport { ICellDiffInfo } from './notebookCellChanges.js';\n\n\nexport class OverlayToolbarDecorator extends Disposable {\n\n\tprivate _timeout: Timeout | undefined = undefined;\n\tprivate readonly overlayDisposables = this._register(new DisposableStore());\n\n\tconstructor(\n\t\tprivate readonly notebookEditor: INotebookEditor,\n\t\tprivate readonly notebookModel: NotebookTextModel,\n\t\t@IInstantiationService private readonly instantiationService: IInstantiationService,\n\t\t@IAccessibilitySignalService private readonly accessibilitySignalService: IAccessibilitySignalService,\n\t) {\n\t\tsuper();\n\t}\n\n\tdecorate(changes: ICellDiffInfo[]) {\n\t\tif (this._timeout !== undefined) {\n\t\t\tclearTimeout(this._timeout);\n\t\t}\n\t\tthis._timeout = setTimeout(() => {\n\t\t\tthis._timeout = undefined;\n\t\t\tthis.createMarkdownPreviewToolbars(changes);\n\t\t}, 100);\n\t}\n\n\tprivate createMarkdownPreviewToolbars(changes: ICellDiffInfo[]) {\n\t\tthis.overlayDisposables.clear();\n\n\t\tconst accessibilitySignalService = this.accessibilitySignalService;\n\t\tconst editor = this.notebookEditor;\n\t\tfor (const change of changes) {\n\t\t\tconst cellViewModel = this.getCellViewModel(change);\n\n\t\t\tif (!cellViewModel || cellViewModel.cellKind !== CellKind.Markup) {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tconst toolbarContainer = document.createElement('div');\n\n\t\t\tlet overlayId: string | undefined = undefined;\n\t\t\teditor.changeCellOverlays((accessor) => {\n\t\t\t\ttoolbarContainer.style.right = '44px';\n\t\t\t\toverlayId = accessor.addOverlay({\n\t\t\t\t\tcell: cellViewModel,\n\t\t\t\t\tdomNode: toolbarContainer,\n\t\t\t\t});\n\t\t\t});\n\n\t\t\tconst removeOverlay = () => {\n\t\t\t\teditor.changeCellOverlays(accessor => {\n\t\t\t\t\tif (overlayId) {\n\t\t\t\t\t\taccessor.removeOverlay(overlayId);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t};\n\n\t\t\tthis.overlayDisposables.add({ dispose: removeOverlay });\n\n\t\t\tconst toolbar = document.createElement('div');\n\t\t\ttoolbarContainer.appendChild(toolbar);\n\t\t\ttoolbar.className = 'chat-diff-change-content-widget';\n\t\t\ttoolbar.classList.add('hover'); // Show by default\n\t\t\ttoolbar.style.position = 'relative';\n\t\t\ttoolbar.style.top = '18px';\n\t\t\ttoolbar.style.zIndex = '10';\n\t\t\ttoolbar.style.display = cellViewModel.getEditState() === CellEditState.Editing ? 'none' : 'block';\n\n\t\t\tthis.overlayDisposables.add(cellViewModel.onDidChangeState((e) => {\n\t\t\t\tif (e.editStateChanged) {\n\t\t\t\t\tif (cellViewModel.getEditState() === CellEditState.Editing) {\n\t\t\t\t\t\ttoolbar.style.display = 'none';\n\t\t\t\t\t} else {\n\t\t\t\t\t\ttoolbar.style.display = 'block';\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}));\n\n\t\t\tconst scopedInstaService = this._register(this.instantiationService.createChild(new ServiceCollection([IContextKeyService, this.notebookEditor.scopedContextKeyService])));\n\t\t\tconst toolbarWidget = scopedInstaService.createInstance(MenuWorkbenchToolBar, toolbar, MenuId.ChatEditingEditorHunk, {\n\t\t\t\ttelemetrySource: 'chatEditingNotebookHunk',\n\t\t\t\thiddenItemStrategy: HiddenItemStrategy.NoHide,\n\t\t\t\ttoolbarOptions: { primaryGroup: () => true },\n\t\t\t\tmenuOptions: {\n\t\t\t\t\trenderShortTitle: true,\n\t\t\t\t\targ: {\n\t\t\t\t\t\tasync accept() {\n\t\t\t\t\t\t\taccessibilitySignalService.playSignal(AccessibilitySignal.editsKept, { allowManyInParallel: true });\n\t\t\t\t\t\t\tremoveOverlay();\n\t\t\t\t\t\t\ttoolbarWidget.dispose();\n\t\t\t\t\t\t\tfor (const singleChange of change.diff.get().changes) {\n\t\t\t\t\t\t\t\tawait change.keep(singleChange);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t},\n\t\t\t\t\t\tasync reject() {\n\t\t\t\t\t\t\taccessibilitySignalService.playSignal(AccessibilitySignal.editsUndone, { allowManyInParallel: true });\n\t\t\t\t\t\t\tremoveOverlay();\n\t\t\t\t\t\t\ttoolbarWidget.dispose();\n\t\t\t\t\t\t\tfor (const singleChange of change.diff.get().changes) {\n\t\t\t\t\t\t\t\tawait change.undo(singleChange);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t}\n\t\t\t\t\t} satisfies IModifiedFileEntryChangeHunk,\n\t\t\t\t},\n\t\t\t\tactionViewItemProvider: (action, options) => {\n\t\t\t\t\tif (!action.class) {\n\t\t\t\t\t\treturn new class extends ActionViewItem {\n\t\t\t\t\t\t\tconstructor() {\n\t\t\t\t\t\t\t\tsuper(undefined, action, { ...options, keybindingNotRenderedWithLabel: true /* hide keybinding for actions without icon */, icon: false, label: true });\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\t\t\t\t\treturn undefined;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tthis.overlayDisposables.add(toolbarWidget);\n\t\t}\n\t}\n\n\tprivate getCellViewModel(change: ICellDiffInfo) {\n\t\tif (change.type === 'delete' || change.modifiedCellIndex === undefined) {\n\t\t\treturn undefined;\n\t\t}\n\t\tconst cell = this.notebookModel.cells[change.modifiedCellIndex];\n\t\tconst cellViewModel = this.notebookEditor.getViewModel()?.viewCells.find(c => c.handle === cell.handle);\n\t\treturn cellViewModel;\n\t}\n\n\toverride dispose(): void {\n\t\tsuper.dispose();\n\t\tif (this._timeout !== undefined) {\n\t\t\tclearTimeout(this._timeout);\n\t\t}\n\t}\n\n}\n"]}