{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/contrib/chat/browser/imageUtils.ts","vs/workbench/contrib/chat/browser/imageUtils.ts"],"names":[],"mappings":"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","file":"imageUtils.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { decodeBase64, VSBuffer } from '../../../../base/common/buffer.js';\nimport { joinPath } from '../../../../base/common/resources.js';\nimport { URI } from '../../../../base/common/uri.js';\nimport { IFileService } from '../../../../platform/files/common/files.js';\nimport { ILogService } from '../../../../platform/log/common/log.js';\n\n/**\n * Resizes an image provided as a UInt8Array string. Resizing is based on Open AI's algorithm for tokenzing images.\n * https://platform.openai.com/docs/guides/vision#calculating-costs\n * @param data - The UInt8Array string of the image to resize.\n * @returns A promise that resolves to the UInt8Array string of the resized image.\n */\n\nexport async function resizeImage(data: Uint8Array | string, mimeType?: string): Promise<Uint8Array> {\n\tconst isGif = mimeType === 'image/gif';\n\n\tif (typeof data === 'string') {\n\t\tdata = convertStringToUInt8Array(data);\n\t}\n\n\treturn new Promise((resolve, reject) => {\n\t\tconst blob = new Blob([data as Uint8Array<ArrayBuffer>], { type: mimeType });\n\t\tconst img = new Image();\n\t\tconst url = URL.createObjectURL(blob);\n\t\timg.src = url;\n\n\t\timg.onload = () => {\n\t\t\tURL.revokeObjectURL(url);\n\t\t\tlet { width, height } = img;\n\n\t\t\tif ((width <= 768 || height <= 768) && !isGif) {\n\t\t\t\tresolve(data);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Calculate the new dimensions while maintaining the aspect ratio\n\t\t\tif (width > 2048 || height > 2048) {\n\t\t\t\tconst scaleFactor = 2048 / Math.max(width, height);\n\t\t\t\twidth = Math.round(width * scaleFactor);\n\t\t\t\theight = Math.round(height * scaleFactor);\n\t\t\t}\n\n\t\t\tconst scaleFactor = 768 / Math.min(width, height);\n\t\t\twidth = Math.round(width * scaleFactor);\n\t\t\theight = Math.round(height * scaleFactor);\n\n\t\t\tconst canvas = document.createElement('canvas');\n\t\t\tcanvas.width = width;\n\t\t\tcanvas.height = height;\n\t\t\tconst ctx = canvas.getContext('2d');\n\t\t\tif (ctx) {\n\t\t\t\tctx.drawImage(img, 0, 0, width, height);\n\n\t\t\t\tconst jpegTypes = ['image/jpeg', 'image/jpg'];\n\t\t\t\tconst outputMimeType = mimeType && jpegTypes.includes(mimeType) ? 'image/jpeg' : 'image/png';\n\n\t\t\t\tcanvas.toBlob(blob => {\n\t\t\t\t\tif (blob) {\n\t\t\t\t\t\tconst reader = new FileReader();\n\t\t\t\t\t\treader.onload = () => {\n\t\t\t\t\t\t\tresolve(new Uint8Array(reader.result as ArrayBuffer));\n\t\t\t\t\t\t};\n\t\t\t\t\t\treader.onerror = (error) => reject(error);\n\t\t\t\t\t\treader.readAsArrayBuffer(blob);\n\t\t\t\t\t} else {\n\t\t\t\t\t\treject(new Error('Failed to create blob from canvas'));\n\t\t\t\t\t}\n\t\t\t\t}, outputMimeType);\n\t\t\t} else {\n\t\t\t\treject(new Error('Failed to get canvas context'));\n\t\t\t}\n\t\t};\n\t\timg.onerror = (error) => {\n\t\t\tURL.revokeObjectURL(url);\n\t\t\treject(error);\n\t\t};\n\t});\n}\n\nexport function convertStringToUInt8Array(data: string): Uint8Array {\n\tconst base64Data = data.includes(',') ? data.split(',')[1] : data;\n\tif (isValidBase64(base64Data)) {\n\t\treturn decodeBase64(base64Data).buffer;\n\t}\n\treturn new TextEncoder().encode(data);\n}\n\n// Only used for URLs\nexport function convertUint8ArrayToString(data: Uint8Array): string {\n\ttry {\n\t\tconst decoder = new TextDecoder();\n\t\tconst decodedString = decoder.decode(data);\n\t\treturn decodedString;\n\t} catch {\n\t\treturn '';\n\t}\n}\n\nfunction isValidBase64(str: string): boolean {\n\t// checks if the string is a valid base64 string that is NOT encoded\n\treturn /^[A-Za-z0-9+/]*={0,2}$/.test(str) && (() => {\n\t\ttry {\n\t\t\tatob(str);\n\t\t\treturn true;\n\t\t} catch {\n\t\t\treturn false;\n\t\t}\n\t})();\n}\n\nexport async function createFileForMedia(fileService: IFileService, imagesFolder: URI, dataTransfer: Uint8Array, mimeType: string): Promise<URI | undefined> {\n\tconst exists = await fileService.exists(imagesFolder);\n\tif (!exists) {\n\t\tawait fileService.createFolder(imagesFolder);\n\t}\n\n\tconst ext = mimeType.split('/')[1] || 'png';\n\tconst filename = `image-${Date.now()}.${ext}`;\n\tconst fileUri = joinPath(imagesFolder, filename);\n\n\tconst buffer = VSBuffer.wrap(dataTransfer);\n\tawait fileService.writeFile(fileUri, buffer);\n\n\treturn fileUri;\n}\n\nexport async function cleanupOldImages(fileService: IFileService, logService: ILogService, imagesFolder: URI): Promise<void> {\n\tconst exists = await fileService.exists(imagesFolder);\n\tif (!exists) {\n\t\treturn;\n\t}\n\n\tconst duration = 7 * 24 * 60 * 60 * 1000; // 7 days\n\tconst files = await fileService.resolve(imagesFolder);\n\tif (!files.children) {\n\t\treturn;\n\t}\n\n\tawait Promise.all(files.children.map(async (file) => {\n\t\ttry {\n\t\t\tconst timestamp = getTimestampFromFilename(file.name);\n\t\t\tif (timestamp && (Date.now() - timestamp > duration)) {\n\t\t\t\tawait fileService.del(file.resource);\n\t\t\t}\n\t\t} catch (err) {\n\t\t\tlogService.error('Failed to clean up old images', err);\n\t\t}\n\t}));\n}\n\nfunction getTimestampFromFilename(filename: string): number | undefined {\n\tconst match = filename.match(/image-(\\d+)\\./);\n\tif (match) {\n\t\treturn parseInt(match[1], 10);\n\t}\n\treturn undefined;\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { decodeBase64, VSBuffer } from '../../../../base/common/buffer.js';\nimport { joinPath } from '../../../../base/common/resources.js';\nimport { URI } from '../../../../base/common/uri.js';\nimport { IFileService } from '../../../../platform/files/common/files.js';\nimport { ILogService } from '../../../../platform/log/common/log.js';\n\n/**\n * Resizes an image provided as a UInt8Array string. Resizing is based on Open AI's algorithm for tokenzing images.\n * https://platform.openai.com/docs/guides/vision#calculating-costs\n * @param data - The UInt8Array string of the image to resize.\n * @returns A promise that resolves to the UInt8Array string of the resized image.\n */\n\nexport async function resizeImage(data: Uint8Array | string, mimeType?: string): Promise<Uint8Array> {\n\tconst isGif = mimeType === 'image/gif';\n\n\tif (typeof data === 'string') {\n\t\tdata = convertStringToUInt8Array(data);\n\t}\n\n\treturn new Promise((resolve, reject) => {\n\t\tconst blob = new Blob([data as Uint8Array<ArrayBuffer>], { type: mimeType });\n\t\tconst img = new Image();\n\t\tconst url = URL.createObjectURL(blob);\n\t\timg.src = url;\n\n\t\timg.onload = () => {\n\t\t\tURL.revokeObjectURL(url);\n\t\t\tlet { width, height } = img;\n\n\t\t\tif ((width <= 768 || height <= 768) && !isGif) {\n\t\t\t\tresolve(data);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Calculate the new dimensions while maintaining the aspect ratio\n\t\t\tif (width > 2048 || height > 2048) {\n\t\t\t\tconst scaleFactor = 2048 / Math.max(width, height);\n\t\t\t\twidth = Math.round(width * scaleFactor);\n\t\t\t\theight = Math.round(height * scaleFactor);\n\t\t\t}\n\n\t\t\tconst scaleFactor = 768 / Math.min(width, height);\n\t\t\twidth = Math.round(width * scaleFactor);\n\t\t\theight = Math.round(height * scaleFactor);\n\n\t\t\tconst canvas = document.createElement('canvas');\n\t\t\tcanvas.width = width;\n\t\t\tcanvas.height = height;\n\t\t\tconst ctx = canvas.getContext('2d');\n\t\t\tif (ctx) {\n\t\t\t\tctx.drawImage(img, 0, 0, width, height);\n\n\t\t\t\tconst jpegTypes = ['image/jpeg', 'image/jpg'];\n\t\t\t\tconst outputMimeType = mimeType && jpegTypes.includes(mimeType) ? 'image/jpeg' : 'image/png';\n\n\t\t\t\tcanvas.toBlob(blob => {\n\t\t\t\t\tif (blob) {\n\t\t\t\t\t\tconst reader = new FileReader();\n\t\t\t\t\t\treader.onload = () => {\n\t\t\t\t\t\t\tresolve(new Uint8Array(reader.result as ArrayBuffer));\n\t\t\t\t\t\t};\n\t\t\t\t\t\treader.onerror = (error) => reject(error);\n\t\t\t\t\t\treader.readAsArrayBuffer(blob);\n\t\t\t\t\t} else {\n\t\t\t\t\t\treject(new Error('Failed to create blob from canvas'));\n\t\t\t\t\t}\n\t\t\t\t}, outputMimeType);\n\t\t\t} else {\n\t\t\t\treject(new Error('Failed to get canvas context'));\n\t\t\t}\n\t\t};\n\t\timg.onerror = (error) => {\n\t\t\tURL.revokeObjectURL(url);\n\t\t\treject(error);\n\t\t};\n\t});\n}\n\nexport function convertStringToUInt8Array(data: string): Uint8Array {\n\tconst base64Data = data.includes(',') ? data.split(',')[1] : data;\n\tif (isValidBase64(base64Data)) {\n\t\treturn decodeBase64(base64Data).buffer;\n\t}\n\treturn new TextEncoder().encode(data);\n}\n\n// Only used for URLs\nexport function convertUint8ArrayToString(data: Uint8Array): string {\n\ttry {\n\t\tconst decoder = new TextDecoder();\n\t\tconst decodedString = decoder.decode(data);\n\t\treturn decodedString;\n\t} catch {\n\t\treturn '';\n\t}\n}\n\nfunction isValidBase64(str: string): boolean {\n\t// checks if the string is a valid base64 string that is NOT encoded\n\treturn /^[A-Za-z0-9+/]*={0,2}$/.test(str) && (() => {\n\t\ttry {\n\t\t\tatob(str);\n\t\t\treturn true;\n\t\t} catch {\n\t\t\treturn false;\n\t\t}\n\t})();\n}\n\nexport async function createFileForMedia(fileService: IFileService, imagesFolder: URI, dataTransfer: Uint8Array, mimeType: string): Promise<URI | undefined> {\n\tconst exists = await fileService.exists(imagesFolder);\n\tif (!exists) {\n\t\tawait fileService.createFolder(imagesFolder);\n\t}\n\n\tconst ext = mimeType.split('/')[1] || 'png';\n\tconst filename = `image-${Date.now()}.${ext}`;\n\tconst fileUri = joinPath(imagesFolder, filename);\n\n\tconst buffer = VSBuffer.wrap(dataTransfer);\n\tawait fileService.writeFile(fileUri, buffer);\n\n\treturn fileUri;\n}\n\nexport async function cleanupOldImages(fileService: IFileService, logService: ILogService, imagesFolder: URI): Promise<void> {\n\tconst exists = await fileService.exists(imagesFolder);\n\tif (!exists) {\n\t\treturn;\n\t}\n\n\tconst duration = 7 * 24 * 60 * 60 * 1000; // 7 days\n\tconst files = await fileService.resolve(imagesFolder);\n\tif (!files.children) {\n\t\treturn;\n\t}\n\n\tawait Promise.all(files.children.map(async (file) => {\n\t\ttry {\n\t\t\tconst timestamp = getTimestampFromFilename(file.name);\n\t\t\tif (timestamp && (Date.now() - timestamp > duration)) {\n\t\t\t\tawait fileService.del(file.resource);\n\t\t\t}\n\t\t} catch (err) {\n\t\t\tlogService.error('Failed to clean up old images', err);\n\t\t}\n\t}));\n}\n\nfunction getTimestampFromFilename(filename: string): number | undefined {\n\tconst match = filename.match(/image-(\\d+)\\./);\n\tif (match) {\n\t\treturn parseInt(match[1], 10);\n\t}\n\treturn undefined;\n}\n"]}