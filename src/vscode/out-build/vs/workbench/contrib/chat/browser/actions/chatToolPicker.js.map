{"version":3,"sources":["vs/workbench/contrib/chat/browser/actions/chatToolPicker.ts"],"names":[],"mappings":"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","file":"chatToolPicker.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nimport { assertNever } from '../../../../../base/common/assert.js';\nimport { Codicon } from '../../../../../base/common/codicons.js';\nimport { Emitter, Event } from '../../../../../base/common/event.js';\nimport { createMarkdownCommandLink } from '../../../../../base/common/htmlContent.js';\nimport { DisposableStore } from '../../../../../base/common/lifecycle.js';\nimport Severity from '../../../../../base/common/severity.js';\nimport { ThemeIcon } from '../../../../../base/common/themables.js';\nimport { URI } from '../../../../../base/common/uri.js';\nimport { localize } from '../../../../../nls.js';\nimport { CommandsRegistry, ICommandService } from '../../../../../platform/commands/common/commands.js';\nimport { IContextKeyService } from '../../../../../platform/contextkey/common/contextkey.js';\nimport { ExtensionIdentifier } from '../../../../../platform/extensions/common/extensions.js';\nimport { ServicesAccessor } from '../../../../../platform/instantiation/common/instantiation.js';\nimport { IQuickInputButton, IQuickInputService, IQuickPickItem, IQuickTreeItem } from '../../../../../platform/quickinput/common/quickInput.js';\nimport { IEditorService } from '../../../../services/editor/common/editorService.js';\nimport { ExtensionEditorTab, IExtensionsWorkbenchService } from '../../../extensions/common/extensions.js';\nimport { McpCommandIds } from '../../../mcp/common/mcpCommandIds.js';\nimport { IMcpRegistry } from '../../../mcp/common/mcpRegistryTypes.js';\nimport { IMcpServer, IMcpService, IMcpWorkbenchService, McpConnectionState, McpServerCacheState, McpServerEditorTab } from '../../../mcp/common/mcpTypes.js';\nimport { startServerAndWaitForLiveTools } from '../../../mcp/common/mcpTypesUtils.js';\nimport { ChatContextKeys } from '../../common/chatContextKeys.js';\nimport { ILanguageModelToolsService, IToolData, ToolDataSource, ToolSet } from '../../common/languageModelToolsService.js';\nimport { ConfigureToolSets } from '../tools/toolSetsContribution.js';\n\nconst enum BucketOrdinal { User, BuiltIn, Mcp, Extension }\n\n// Legacy QuickPick types (existing implementation)\ntype BucketPick = IQuickPickItem & { picked: boolean; ordinal: BucketOrdinal; status?: string; toolset?: ToolSet; children: (ToolPick | ToolSetPick)[] };\ntype ToolSetPick = IQuickPickItem & { picked: boolean; toolset: ToolSet; parent: BucketPick };\ntype ToolPick = IQuickPickItem & { picked: boolean; tool: IToolData; parent: BucketPick };\ntype ActionableButton = IQuickInputButton & { action: () => void };\n\n// New QuickTree types for tree-based implementation\n\n/**\n * Base interface for all tree items in the QuickTree implementation.\n * Extends IQuickTreeItem with common properties for tool picker items.\n */\ninterface IToolTreeItem extends IQuickTreeItem {\n\treadonly itemType: 'bucket' | 'toolset' | 'tool' | 'callback';\n\treadonly ordinal?: BucketOrdinal;\n\treadonly buttons?: readonly ActionableButton[];\n}\n\n/**\n * Bucket tree item - represents a category of tools (User, BuiltIn, MCP Server, Extension).\n * For MCP servers, the bucket directly represents the server and stores the toolset.\n */\ninterface IBucketTreeItem extends IToolTreeItem {\n\treadonly itemType: 'bucket';\n\treadonly ordinal: BucketOrdinal;\n\ttoolset?: ToolSet; // For MCP servers where the bucket represents the ToolSet - mutable\n\treadonly status?: string;\n\treadonly children: AnyTreeItem[];\n\tchecked: boolean | 'mixed' | undefined;\n\treadonly sortOrder: number;\n}\n\n/**\n * ToolSet tree item - represents a collection of tools that can be managed together.\n * Used for regular (non-MCP) toolsets that appear as intermediate nodes in the tree.\n */\ninterface IToolSetTreeItem extends IToolTreeItem {\n\treadonly itemType: 'toolset';\n\treadonly toolset: ToolSet;\n\tchildren: AnyTreeItem[] | undefined;\n\tchecked: boolean | 'mixed';\n}\n\n/**\n * Tool tree item - represents an individual tool that can be selected/deselected.\n * This is a leaf node in the tree structure.\n */\ninterface IToolTreeItemData extends IToolTreeItem {\n\treadonly itemType: 'tool';\n\treadonly tool: IToolData;\n\tchecked: boolean;\n}\n\n/**\n * Callback tree item - represents action items like \"Add MCP Server\" or \"Configure Tool Sets\".\n * These are non-selectable items that execute actions when clicked. Can return\n * false to keep the picker open.\n */\ninterface ICallbackTreeItem extends IToolTreeItem {\n\treadonly itemType: 'callback';\n\treadonly run: () => boolean | void;\n\treadonly pickable: false;\n}\n\ntype AnyTreeItem = IBucketTreeItem | IToolSetTreeItem | IToolTreeItemData | ICallbackTreeItem;\n\n// Type guards for new QuickTree types\nfunction isBucketTreeItem(item: AnyTreeItem): item is IBucketTreeItem {\n\treturn item.itemType === 'bucket';\n}\nfunction isToolSetTreeItem(item: AnyTreeItem): item is IToolSetTreeItem {\n\treturn item.itemType === 'toolset';\n}\nfunction isToolTreeItem(item: AnyTreeItem): item is IToolTreeItemData {\n\treturn item.itemType === 'tool';\n}\nfunction isCallbackTreeItem(item: AnyTreeItem): item is ICallbackTreeItem {\n\treturn item.itemType === 'callback';\n}\n\n/**\n * Maps different icon types (ThemeIcon or URI-based) to QuickTreeItem icon properties.\n * Handles the conversion between ToolSet/IToolData icon formats and tree item requirements.\n * Provides a default tool icon when no icon is specified.\n *\n * @param icon - Icon to map (ThemeIcon, URI object, or undefined)\n * @param useDefaultToolIcon - Whether to use a default tool icon when none is provided\n * @returns Object with iconClass (for ThemeIcon) or iconPath (for URIs) properties\n */\nfunction mapIconToTreeItem(icon: ThemeIcon | { dark: URI; light?: URI } | undefined, useDefaultToolIcon: boolean = false): Pick<IQuickTreeItem, 'iconClass' | 'iconPath'> {\n\tif (!icon) {\n\t\tif (useDefaultToolIcon) {\n\t\t\treturn { iconClass: ThemeIcon.asClassName(Codicon.tools) };\n\t\t}\n\t\treturn {};\n\t}\n\n\tif (ThemeIcon.isThemeIcon(icon)) {\n\t\treturn { iconClass: ThemeIcon.asClassName(icon) };\n\t} else {\n\t\treturn { iconPath: icon };\n\t}\n}\n\nfunction createToolTreeItemFromData(tool: IToolData, checked: boolean): IToolTreeItemData {\n\tconst iconProps = mapIconToTreeItem(tool.icon, true); // Use default tool icon if none provided\n\n\treturn {\n\t\titemType: 'tool',\n\t\ttool,\n\t\tid: tool.id,\n\t\tlabel: tool.toolReferenceName ?? tool.displayName,\n\t\tdescription: tool.userDescription ?? tool.modelDescription,\n\t\tchecked,\n\t\t...iconProps\n\t};\n}\n\nfunction createToolSetTreeItem(toolset: ToolSet, checked: boolean, editorService: IEditorService): IToolSetTreeItem {\n\tconst iconProps = mapIconToTreeItem(toolset.icon);\n\tconst buttons = [];\n\tif (toolset.source.type === 'user') {\n\t\tconst resource = toolset.source.file;\n\t\tbuttons.push({\n\t\t\ticonClass: ThemeIcon.asClassName(Codicon.edit),\n\t\t\ttooltip: localize('editUserBucket', \"Edit Tool Set\"),\n\t\t\taction: () => editorService.openEditor({ resource })\n\t\t});\n\t}\n\treturn {\n\t\titemType: 'toolset',\n\t\ttoolset,\n\t\tbuttons,\n\t\tid: toolset.id,\n\t\tlabel: toolset.referenceName,\n\t\tdescription: toolset.description,\n\t\tchecked,\n\t\tchildren: undefined,\n\t\tcollapsed: true,\n\t\t...iconProps\n\t};\n}\n\n/**\n * New QuickTree implementation of the tools picker.\n * Uses IQuickTree to provide a true hierarchical tree structure with:\n * - Collapsible nodes for buckets and toolsets\n * - Checkbox state management with parent-child relationships\n * - Special handling for MCP servers (server as bucket, tools as direct children)\n * - Built-in filtering and search capabilities\n *\n * @param accessor - Service accessor for dependency injection\n * @param placeHolder - Placeholder text shown in the picker\n * @param description - Optional description text shown in the picker\n * @param toolsEntries - Optional initial selection state for tools and toolsets\n * @param onUpdate - Optional callback fired when the selection changes\n * @returns Promise resolving to the final selection map, or undefined if cancelled\n */\nexport async function showToolsPicker(\n\taccessor: ServicesAccessor,\n\tplaceHolder: string,\n\tdescription?: string,\n\tgetToolsEntries?: () => ReadonlyMap<ToolSet | IToolData, boolean>\n): Promise<ReadonlyMap<ToolSet | IToolData, boolean> | undefined> {\n\n\tconst quickPickService = accessor.get(IQuickInputService);\n\tconst mcpService = accessor.get(IMcpService);\n\tconst mcpRegistry = accessor.get(IMcpRegistry);\n\tconst commandService = accessor.get(ICommandService);\n\tconst extensionsWorkbenchService = accessor.get(IExtensionsWorkbenchService);\n\tconst editorService = accessor.get(IEditorService);\n\tconst mcpWorkbenchService = accessor.get(IMcpWorkbenchService);\n\tconst toolsService = accessor.get(ILanguageModelToolsService);\n\tconst toolLimit = accessor.get(IContextKeyService).getContextKeyValue<number>(ChatContextKeys.chatToolGroupingThreshold.key);\n\n\tconst mcpServerByTool = new Map<string, IMcpServer>();\n\tfor (const server of mcpService.servers.get()) {\n\t\tfor (const tool of server.tools.get()) {\n\t\t\tmcpServerByTool.set(tool.id, server);\n\t\t}\n\t}\n\n\tfunction computeItems(previousToolsEntries?: ReadonlyMap<ToolSet | IToolData, boolean>) {\n\t\t// Create default entries if none provided\n\t\tlet toolsEntries = getToolsEntries ? new Map(getToolsEntries()) : undefined;\n\t\tif (!toolsEntries) {\n\t\t\tconst defaultEntries = new Map();\n\t\t\tfor (const tool of toolsService.getTools()) {\n\t\t\t\tif (tool.canBeReferencedInPrompt) {\n\t\t\t\t\tdefaultEntries.set(tool, false);\n\t\t\t\t}\n\t\t\t}\n\t\t\tfor (const toolSet of toolsService.toolSets.get()) {\n\t\t\t\tdefaultEntries.set(toolSet, false);\n\t\t\t}\n\t\t\ttoolsEntries = defaultEntries;\n\t\t}\n\t\tpreviousToolsEntries?.forEach((value, key) => {\n\t\t\ttoolsEntries.set(key, value);\n\t\t});\n\n\t\t// Build tree structure\n\t\tconst treeItems: AnyTreeItem[] = [];\n\t\tconst bucketMap = new Map<string, IBucketTreeItem>();\n\n\t\tconst getKey = (source: ToolDataSource): string => {\n\t\t\tswitch (source.type) {\n\t\t\t\tcase 'mcp':\n\t\t\t\tcase 'extension':\n\t\t\t\t\treturn ToolDataSource.toKey(source);\n\t\t\t\tcase 'internal':\n\t\t\t\t\treturn BucketOrdinal.BuiltIn.toString();\n\t\t\t\tcase 'user':\n\t\t\t\t\treturn BucketOrdinal.User.toString();\n\t\t\t\tcase 'external':\n\t\t\t\t\tthrow new Error('should not be reachable');\n\t\t\t\tdefault:\n\t\t\t\t\tassertNever(source);\n\t\t\t}\n\t\t};\n\n\t\tconst mcpServers = new Map(mcpService.servers.get().map(s => [s.definition.id, { server: s, seen: false }]));\n\t\tconst createBucket = (source: ToolDataSource, key: string): IBucketTreeItem | undefined => {\n\t\t\tif (source.type === 'mcp') {\n\t\t\t\tconst mcpServerEntry = mcpServers.get(source.definitionId);\n\t\t\t\tif (!mcpServerEntry) {\n\t\t\t\t\treturn undefined;\n\t\t\t\t}\n\t\t\t\tmcpServerEntry.seen = true;\n\t\t\t\tconst mcpServer = mcpServerEntry.server;\n\t\t\t\tconst buttons: ActionableButton[] = [];\n\t\t\t\tconst collection = mcpRegistry.collections.get().find(c => c.id === mcpServer.collection.id);\n\t\t\t\tif (collection?.source) {\n\t\t\t\t\tbuttons.push({\n\t\t\t\t\t\ticonClass: ThemeIcon.asClassName(Codicon.settingsGear),\n\t\t\t\t\t\ttooltip: localize('configMcpCol', \"Configure {0}\", collection.label),\n\t\t\t\t\t\taction: () => collection.source ? collection.source instanceof ExtensionIdentifier ? extensionsWorkbenchService.open(collection.source.value, { tab: ExtensionEditorTab.Features, feature: 'mcp' }) : mcpWorkbenchService.open(collection.source, { tab: McpServerEditorTab.Configuration }) : undefined\n\t\t\t\t\t});\n\t\t\t\t} else if (collection?.presentation?.origin) {\n\t\t\t\t\tbuttons.push({\n\t\t\t\t\t\ticonClass: ThemeIcon.asClassName(Codicon.settingsGear),\n\t\t\t\t\t\ttooltip: localize('configMcpCol', \"Configure {0}\", collection.label),\n\t\t\t\t\t\taction: () => editorService.openEditor({\n\t\t\t\t\t\t\tresource: collection!.presentation!.origin,\n\t\t\t\t\t\t})\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tif (mcpServer.connectionState.get().state === McpConnectionState.Kind.Error) {\n\t\t\t\t\tbuttons.push({\n\t\t\t\t\t\ticonClass: ThemeIcon.asClassName(Codicon.warning),\n\t\t\t\t\t\ttooltip: localize('mcpShowOutput', \"Show Output\"),\n\t\t\t\t\t\taction: () => mcpServer.showOutput(),\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tconst cacheState = mcpServer.cacheState.get();\n\t\t\t\tconst children: AnyTreeItem[] = [];\n\t\t\t\tlet collapsed = true;\n\t\t\t\tif (cacheState === McpServerCacheState.Unknown || cacheState === McpServerCacheState.Outdated) {\n\t\t\t\t\tcollapsed = false;\n\t\t\t\t\tchildren.push({\n\t\t\t\t\t\titemType: 'callback',\n\t\t\t\t\t\ticonClass: ThemeIcon.asClassName(Codicon.sync),\n\t\t\t\t\t\tlabel: localize('mcpUpdate', \"Update Tools\"),\n\t\t\t\t\t\tpickable: false,\n\t\t\t\t\t\trun: () => {\n\t\t\t\t\t\t\ttreePicker.busy = true;\n\t\t\t\t\t\t\t(async () => {\n\t\t\t\t\t\t\t\tconst ok = await startServerAndWaitForLiveTools(mcpServer, { promptType: 'all-untrusted' });\n\t\t\t\t\t\t\t\tif (!ok) {\n\t\t\t\t\t\t\t\t\tmcpServer.showOutput();\n\t\t\t\t\t\t\t\t\ttreePicker.hide();\n\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\ttreePicker.busy = false;\n\t\t\t\t\t\t\t\tcomputeItems(collectResults());\n\t\t\t\t\t\t\t})();\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t},\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tconst bucket: IBucketTreeItem = {\n\t\t\t\t\titemType: 'bucket',\n\t\t\t\t\tordinal: BucketOrdinal.Mcp,\n\t\t\t\t\tid: key,\n\t\t\t\t\tlabel: source.label,\n\t\t\t\t\tchecked: undefined,\n\t\t\t\t\tcollapsed,\n\t\t\t\t\tchildren,\n\t\t\t\t\tbuttons,\n\t\t\t\t\tsortOrder: 2,\n\t\t\t\t};\n\t\t\t\tconst iconPath = mcpServer.serverMetadata.get()?.icons.getUrl(22);\n\t\t\t\tif (iconPath) {\n\t\t\t\t\tbucket.iconPath = iconPath;\n\t\t\t\t} else {\n\t\t\t\t\tbucket.iconClass = ThemeIcon.asClassName(Codicon.mcp);\n\t\t\t\t}\n\t\t\t\treturn bucket;\n\t\t\t} else if (source.type === 'extension') {\n\t\t\t\treturn {\n\t\t\t\t\titemType: 'bucket',\n\t\t\t\t\tordinal: BucketOrdinal.Extension,\n\t\t\t\t\tid: key,\n\t\t\t\t\tlabel: source.label,\n\t\t\t\t\tchecked: undefined,\n\t\t\t\t\tchildren: [],\n\t\t\t\t\tbuttons: [],\n\t\t\t\t\tcollapsed: true,\n\t\t\t\t\ticonClass: ThemeIcon.asClassName(Codicon.extensions),\n\t\t\t\t\tsortOrder: 3,\n\t\t\t\t};\n\t\t\t} else if (source.type === 'internal') {\n\t\t\t\treturn {\n\t\t\t\t\titemType: 'bucket',\n\t\t\t\t\tordinal: BucketOrdinal.BuiltIn,\n\t\t\t\t\tid: key,\n\t\t\t\t\tlabel: localize('defaultBucketLabel', \"Built-In\"),\n\t\t\t\t\tchecked: undefined,\n\t\t\t\t\tchildren: [],\n\t\t\t\t\tbuttons: [],\n\t\t\t\t\tcollapsed: false,\n\t\t\t\t\tsortOrder: 1,\n\t\t\t\t};\n\t\t\t} else {\n\t\t\t\treturn {\n\t\t\t\t\titemType: 'bucket',\n\t\t\t\t\tordinal: BucketOrdinal.User,\n\t\t\t\t\tid: key,\n\t\t\t\t\tlabel: localize('userBucket', \"User Defined Tool Sets\"),\n\t\t\t\t\tchecked: undefined,\n\t\t\t\t\tchildren: [],\n\t\t\t\t\tbuttons: [],\n\t\t\t\t\tcollapsed: true,\n\t\t\t\t\tsortOrder: 4,\n\t\t\t\t};\n\t\t\t}\n\t\t};\n\n\t\tconst getBucket = (source: ToolDataSource): IBucketTreeItem | undefined => {\n\t\t\tconst key = getKey(source);\n\t\t\tlet bucket = bucketMap.get(key);\n\t\t\tif (!bucket) {\n\t\t\t\tbucket = createBucket(source, key);\n\t\t\t\tif (bucket) {\n\t\t\t\t\tbucketMap.set(key, bucket);\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn bucket;\n\t\t};\n\n\t\tfor (const toolSet of toolsService.toolSets.get()) {\n\t\t\tif (!toolsEntries.has(toolSet)) {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tconst bucket = getBucket(toolSet.source);\n\t\t\tif (!bucket) {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tconst toolSetChecked = toolsEntries.get(toolSet) === true;\n\t\t\tif (toolSet.source.type === 'mcp') {\n\t\t\t\t// bucket represents the toolset\n\t\t\t\tbucket.toolset = toolSet;\n\t\t\t\tif (toolSetChecked) {\n\t\t\t\t\tbucket.checked = toolSetChecked;\n\t\t\t\t}\n\t\t\t\t// all mcp tools are part of toolsService.getTools()\n\t\t\t} else {\n\t\t\t\tconst treeItem = createToolSetTreeItem(toolSet, toolSetChecked, editorService);\n\t\t\t\tbucket.children.push(treeItem);\n\t\t\t\tconst children = [];\n\t\t\t\tfor (const tool of toolSet.getTools()) {\n\t\t\t\t\tconst toolChecked = toolSetChecked || toolsEntries.get(tool) === true;\n\t\t\t\t\tconst toolTreeItem = createToolTreeItemFromData(tool, toolChecked);\n\t\t\t\t\tchildren.push(toolTreeItem);\n\t\t\t\t}\n\t\t\t\tif (children.length > 0) {\n\t\t\t\t\ttreeItem.children = children;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tfor (const tool of toolsService.getTools()) {\n\t\t\tif (!tool.canBeReferencedInPrompt || !toolsEntries.has(tool)) {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tconst bucket = getBucket(tool.source);\n\t\t\tif (!bucket) {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tconst toolChecked = bucket.checked === true || toolsEntries.get(tool) === true;\n\t\t\tconst toolTreeItem = createToolTreeItemFromData(tool, toolChecked);\n\t\t\tbucket.children.push(toolTreeItem);\n\t\t}\n\n\t\t// Show entries for MCP servers that don't have any tools in them and might need to be started.\n\t\tfor (const { server, seen } of mcpServers.values()) {\n\t\t\tconst cacheState = server.cacheState.get();\n\t\t\tif (!seen && (cacheState === McpServerCacheState.Unknown || cacheState === McpServerCacheState.Outdated)) {\n\t\t\t\tgetBucket({ type: 'mcp', definitionId: server.definition.id, label: server.definition.label, instructions: '', serverLabel: '', collectionId: server.collection.id });\n\t\t\t}\n\t\t}\n\n\t\t// Convert bucket map to sorted tree items\n\t\tconst sortedBuckets = Array.from(bucketMap.values()).sort((a, b) => {\n\t\t\tif (a.sortOrder !== b.sortOrder) {\n\t\t\t\treturn a.sortOrder - b.sortOrder;\n\t\t\t}\n\t\t\treturn a.label.localeCompare(b.label);\n\t\t});\n\t\tfor (const bucket of sortedBuckets) {\n\t\t\ttreeItems.push(bucket);\n\t\t\t// Sort children alphabetically\n\t\t\tbucket.children.sort((a, b) => a.label.localeCompare(b.label));\n\t\t\tfor (const child of bucket.children) {\n\t\t\t\tif (isToolSetTreeItem(child) && child.children) {\n\t\t\t\t\tchild.children.sort((a, b) => a.label.localeCompare(b.label));\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tif (treeItems.length === 0) {\n\t\t\ttreePicker.placeholder = localize('noTools', \"Add tools to chat\");\n\t\t} else {\n\t\t\ttreePicker.placeholder = placeHolder;\n\t\t}\n\t\ttreePicker.setItemTree(treeItems);\n\t}\n\n\t// Create and configure the tree picker\n\tconst store = new DisposableStore();\n\tconst treePicker = store.add(quickPickService.createQuickTree<AnyTreeItem>());\n\n\ttreePicker.placeholder = placeHolder;\n\ttreePicker.ignoreFocusOut = true;\n\ttreePicker.description = description;\n\ttreePicker.matchOnDescription = true;\n\ttreePicker.matchOnLabel = true;\n\ttreePicker.sortByLabel = false;\n\n\tcomputeItems();\n\n\t// Handle button triggers\n\tstore.add(treePicker.onDidTriggerItemButton(e => {\n\t\tif (e.button && typeof (e.button as ActionableButton).action === 'function') {\n\t\t\t(e.button as ActionableButton).action();\n\t\t\tstore.dispose();\n\t\t}\n\t}));\n\n\tconst updateToolLimitMessage = () => {\n\t\tif (toolLimit) {\n\t\t\tlet count = 0;\n\t\t\tconst traverse = (items: readonly AnyTreeItem[]) => {\n\t\t\t\tfor (const item of items) {\n\t\t\t\t\tif (isBucketTreeItem(item) || isToolSetTreeItem(item)) {\n\t\t\t\t\t\tif (item.children) {\n\t\t\t\t\t\t\ttraverse(item.children);\n\t\t\t\t\t\t}\n\t\t\t\t\t} else if (isToolTreeItem(item) && item.checked) {\n\t\t\t\t\t\tcount++;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t};\n\t\t\ttraverse(treePicker.itemTree);\n\t\t\tif (count > toolLimit) {\n\t\t\t\ttreePicker.severity = Severity.Warning;\n\t\t\t\ttreePicker.validationMessage = localize('toolLimitExceeded', \"{0} tools are enabled. You may experience degraded tool calling above {1} tools.\", count, createMarkdownCommandLink({ title: String(toolLimit), id: '_chat.toolPicker.closeAndOpenVirtualThreshold' }));\n\t\t\t} else {\n\t\t\t\ttreePicker.severity = Severity.Ignore;\n\t\t\t\ttreePicker.validationMessage = undefined;\n\t\t\t}\n\t\t}\n\t};\n\tupdateToolLimitMessage();\n\n\tconst collectResults = () => {\n\n\t\tconst result = new Map<IToolData | ToolSet, boolean>();\n\t\tconst traverse = (items: readonly AnyTreeItem[]) => {\n\t\t\tfor (const item of items) {\n\t\t\t\tif (isBucketTreeItem(item)) {\n\t\t\t\t\tif (item.toolset) { // MCP server\n\t\t\t\t\t\t// MCP toolset is enabled only if all tools are enabled\n\t\t\t\t\t\tconst allChecked = item.checked === true;\n\t\t\t\t\t\tresult.set(item.toolset, allChecked);\n\t\t\t\t\t}\n\t\t\t\t\ttraverse(item.children);\n\t\t\t\t} else if (isToolSetTreeItem(item)) {\n\t\t\t\t\tresult.set(item.toolset, item.checked === true);\n\t\t\t\t\tif (item.children) {\n\t\t\t\t\t\ttraverse(item.children);\n\t\t\t\t\t}\n\t\t\t\t} else if (isToolTreeItem(item)) {\n\t\t\t\t\tresult.set(item.tool, item.checked || result.get(item.tool) === true); // tools can be in user tool sets and other buckets\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\ttraverse(treePicker.itemTree);\n\t\treturn result;\n\t};\n\n\t// Temporary command to close the picker and open settings, for use in the validation message\n\tstore.add(CommandsRegistry.registerCommand({\n\t\tid: '_chat.toolPicker.closeAndOpenVirtualThreshold',\n\t\thandler: () => {\n\t\t\ttreePicker.hide();\n\t\t\tcommandService.executeCommand('workbench.action.openSettings', 'github.copilot.chat.virtualTools.threshold');\n\t\t}\n\t}));\n\n\t// Handle checkbox state changes\n\tstore.add(treePicker.onDidChangeCheckedLeafItems(() => updateToolLimitMessage()));\n\n\t// Handle acceptance\n\tlet didAccept = false;\n\tconst didAcceptFinalItem = store.add(new Emitter<void>());\n\tstore.add(treePicker.onDidAccept(() => {\n\t\t// Check if a callback item was activated\n\t\tconst activeItems = treePicker.activeItems;\n\t\tconst callbackItem = activeItems.find(isCallbackTreeItem);\n\t\tif (!callbackItem) {\n\t\t\tdidAccept = true;\n\t\t\ttreePicker.hide();\n\t\t\treturn;\n\t\t}\n\n\t\tconst ret = callbackItem.run();\n\t\tif (ret !== false) {\n\t\t\tdidAcceptFinalItem.fire();\n\t\t}\n\t}));\n\n\tconst addMcpServerButton = {\n\t\ticonClass: ThemeIcon.asClassName(Codicon.mcp),\n\t\ttooltip: localize('addMcpServer', 'Add MCP Server...')\n\t};\n\tconst installExtension = {\n\t\ticonClass: ThemeIcon.asClassName(Codicon.extensions),\n\t\ttooltip: localize('addExtensionButton', 'Install Extension...')\n\t};\n\tconst configureToolSets = {\n\t\ticonClass: ThemeIcon.asClassName(Codicon.gear),\n\t\ttooltip: localize('configToolSets', 'Configure Tool Sets...')\n\t};\n\ttreePicker.title = localize('configureTools', \"Configure Tools\");\n\ttreePicker.buttons = [addMcpServerButton, installExtension, configureToolSets];\n\tstore.add(treePicker.onDidTriggerButton(button => {\n\t\tif (button === addMcpServerButton) {\n\t\t\tcommandService.executeCommand(McpCommandIds.AddConfiguration);\n\t\t} else if (button === installExtension) {\n\t\t\textensionsWorkbenchService.openSearch('@tag:language-model-tools');\n\t\t} else if (button === configureToolSets) {\n\t\t\tcommandService.executeCommand(ConfigureToolSets.ID);\n\t\t}\n\t\ttreePicker.hide();\n\t}));\n\n\ttreePicker.show();\n\n\tawait Promise.race([Event.toPromise(Event.any(treePicker.onDidHide, didAcceptFinalItem.event), store)]);\n\n\tstore.dispose();\n\n\treturn didAccept ? collectResults() : undefined;\n}\n"]}