{"version":3,"sources":["vs/workbench/contrib/chat/browser/contrib/chatInputCompletions.ts"],"names":[],"mappings":"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","file":"chatInputCompletions.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { coalesce } from '../../../../../base/common/arrays.js';\nimport { raceTimeout } from '../../../../../base/common/async.js';\nimport { decodeBase64 } from '../../../../../base/common/buffer.js';\nimport { CancellationToken, CancellationTokenSource } from '../../../../../base/common/cancellation.js';\nimport { Codicon } from '../../../../../base/common/codicons.js';\nimport { isPatternInWord } from '../../../../../base/common/filters.js';\nimport { Disposable, DisposableStore, toDisposable } from '../../../../../base/common/lifecycle.js';\nimport { ResourceSet } from '../../../../../base/common/map.js';\nimport { Schemas } from '../../../../../base/common/network.js';\nimport { basename } from '../../../../../base/common/resources.js';\nimport { ThemeIcon } from '../../../../../base/common/themables.js';\nimport { assertType } from '../../../../../base/common/types.js';\nimport { URI } from '../../../../../base/common/uri.js';\nimport { generateUuid } from '../../../../../base/common/uuid.js';\nimport { ICodeEditor, getCodeEditor, isCodeEditor } from '../../../../../editor/browser/editorBrowser.js';\nimport { ICodeEditorService } from '../../../../../editor/browser/services/codeEditorService.js';\nimport { Position } from '../../../../../editor/common/core/position.js';\nimport { Range } from '../../../../../editor/common/core/range.js';\nimport { IWordAtPosition, getWordAtText } from '../../../../../editor/common/core/wordHelper.js';\nimport { CompletionContext, CompletionItem, CompletionItemKind, CompletionItemProvider, CompletionList, DocumentSymbol, Location, ProviderResult, SymbolKind, SymbolKinds } from '../../../../../editor/common/languages.js';\nimport { ITextModel } from '../../../../../editor/common/model.js';\nimport { ILanguageFeaturesService } from '../../../../../editor/common/services/languageFeatures.js';\nimport { IOutlineModelService } from '../../../../../editor/contrib/documentSymbols/browser/outlineModel.js';\nimport { localize } from '../../../../../nls.js';\nimport { Action2, registerAction2 } from '../../../../../platform/actions/common/actions.js';\nimport { CommandsRegistry } from '../../../../../platform/commands/common/commands.js';\nimport { IConfigurationService } from '../../../../../platform/configuration/common/configuration.js';\nimport { FileKind, IFileService } from '../../../../../platform/files/common/files.js';\nimport { IInstantiationService, ServicesAccessor } from '../../../../../platform/instantiation/common/instantiation.js';\nimport { ILabelService } from '../../../../../platform/label/common/label.js';\nimport { INotificationService } from '../../../../../platform/notification/common/notification.js';\nimport { Registry } from '../../../../../platform/registry/common/platform.js';\nimport { IWorkspaceContextService } from '../../../../../platform/workspace/common/workspace.js';\nimport { IWorkbenchContributionsRegistry, Extensions as WorkbenchExtensions } from '../../../../common/contributions.js';\nimport { EditorsOrder } from '../../../../common/editor.js';\nimport { IEditorService } from '../../../../services/editor/common/editorService.js';\nimport { IHistoryService } from '../../../../services/history/common/history.js';\nimport { LifecyclePhase } from '../../../../services/lifecycle/common/lifecycle.js';\nimport { ISearchService } from '../../../../services/search/common/search.js';\nimport { McpPromptArgumentPick } from '../../../mcp/browser/mcpPromptArgumentPick.js';\nimport { IMcpPrompt, IMcpPromptMessage, IMcpServer, IMcpService, McpResourceURI } from '../../../mcp/common/mcpTypes.js';\nimport { searchFilesAndFolders } from '../../../search/browser/searchChatContext.js';\nimport { IChatAgentData, IChatAgentNameService, IChatAgentService, getFullyQualifiedId } from '../../common/chatAgents.js';\nimport { IChatEditingService } from '../../common/chatEditingService.js';\nimport { getAttachableImageExtension } from '../../common/chatModel.js';\nimport { ChatRequestAgentPart, ChatRequestAgentSubcommandPart, ChatRequestSlashPromptPart, ChatRequestTextPart, ChatRequestToolPart, ChatRequestToolSetPart, chatAgentLeader, chatSubcommandLeader, chatVariableLeader } from '../../common/chatParserTypes.js';\nimport { IChatSlashCommandService } from '../../common/chatSlashCommands.js';\nimport { IChatRequestVariableEntry } from '../../common/chatVariableEntries.js';\nimport { IDynamicVariable } from '../../common/chatVariables.js';\nimport { ChatAgentLocation, ChatModeKind, isSupportedChatFileScheme } from '../../common/constants.js';\nimport { ToolSet } from '../../common/languageModelToolsService.js';\nimport { IPromptsService } from '../../common/promptSyntax/service/promptsService.js';\nimport { ChatSubmitAction } from '../actions/chatExecuteActions.js';\nimport { IChatWidget, IChatWidgetService } from '../chat.js';\nimport { resizeImage } from '../imageUtils.js';\nimport { ChatDynamicVariableModel } from './chatDynamicVariables.js';\n\nclass SlashCommandCompletions extends Disposable {\n\tconstructor(\n\t\t@ILanguageFeaturesService private readonly languageFeaturesService: ILanguageFeaturesService,\n\t\t@IChatWidgetService private readonly chatWidgetService: IChatWidgetService,\n\t\t@IChatSlashCommandService private readonly chatSlashCommandService: IChatSlashCommandService,\n\t\t@IPromptsService private readonly promptsService: IPromptsService,\n\t\t@IMcpService mcpService: IMcpService,\n\t) {\n\t\tsuper();\n\n\t\tthis._register(this.languageFeaturesService.completionProvider.register({ scheme: Schemas.vscodeChatInput, hasAccessToAllModels: true }, {\n\t\t\t_debugDisplayName: 'globalSlashCommands',\n\t\t\ttriggerCharacters: [chatSubcommandLeader],\n\t\t\tprovideCompletionItems: async (model: ITextModel, position: Position, _context: CompletionContext, _token: CancellationToken) => {\n\t\t\t\tconst widget = this.chatWidgetService.getWidgetByInputUri(model.uri);\n\t\t\t\tif (!widget || !widget.viewModel) {\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\n\t\t\t\tif (widget.lockedAgentId) {\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\n\t\t\t\tconst range = computeCompletionRanges(model, position, /\\/\\w*/g);\n\t\t\t\tif (!range) {\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\n\t\t\t\tif (!isEmptyUpToCompletionWord(model, range)) {\n\t\t\t\t\t// No text allowed before the completion\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst parsedRequest = widget.parsedInput.parts;\n\t\t\t\tconst usedAgent = parsedRequest.find(p => p instanceof ChatRequestAgentPart);\n\t\t\t\tif (usedAgent) {\n\t\t\t\t\t// No (classic) global slash commands when an agent is used\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst slashCommands = this.chatSlashCommandService.getCommands(widget.location, widget.input.currentModeKind);\n\t\t\t\tif (!slashCommands) {\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\n\t\t\t\treturn {\n\t\t\t\t\tsuggestions: slashCommands.map((c, i): CompletionItem => {\n\t\t\t\t\t\tconst withSlash = `/${c.command}`;\n\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\tlabel: withSlash,\n\t\t\t\t\t\t\tinsertText: c.executeImmediately ? '' : `${withSlash} `,\n\t\t\t\t\t\t\tdocumentation: c.detail,\n\t\t\t\t\t\t\trange,\n\t\t\t\t\t\t\tsortText: c.sortText ?? 'a'.repeat(i + 1),\n\t\t\t\t\t\t\tkind: CompletionItemKind.Text, // The icons are disabled here anyway,\n\t\t\t\t\t\t\tcommand: c.executeImmediately ? { id: ChatSubmitAction.ID, title: withSlash, arguments: [{ widget, inputValue: `${withSlash} ` }] } : undefined,\n\t\t\t\t\t\t};\n\t\t\t\t\t})\n\t\t\t\t};\n\t\t\t}\n\t\t}));\n\t\tthis._register(this.languageFeaturesService.completionProvider.register({ scheme: Schemas.vscodeChatInput, hasAccessToAllModels: true }, {\n\t\t\t_debugDisplayName: 'globalSlashCommandsAt',\n\t\t\ttriggerCharacters: [chatAgentLeader],\n\t\t\tprovideCompletionItems: async (model: ITextModel, position: Position, _context: CompletionContext, _token: CancellationToken) => {\n\t\t\t\tconst widget = this.chatWidgetService.getWidgetByInputUri(model.uri);\n\t\t\t\tif (!widget || !widget.viewModel) {\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\n\t\t\t\tconst range = computeCompletionRanges(model, position, /@\\w*/g);\n\t\t\t\tif (!range) {\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\n\t\t\t\tif (!isEmptyUpToCompletionWord(model, range)) {\n\t\t\t\t\t// No text allowed before the completion\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst slashCommands = this.chatSlashCommandService.getCommands(widget.location, widget.input.currentModeKind);\n\t\t\t\tif (!slashCommands) {\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\n\t\t\t\tif (widget.lockedAgentId) {\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\n\t\t\t\treturn {\n\t\t\t\t\tsuggestions: slashCommands.map((c, i): CompletionItem => {\n\t\t\t\t\t\tconst withSlash = `${chatSubcommandLeader}${c.command}`;\n\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\tlabel: withSlash,\n\t\t\t\t\t\t\tinsertText: c.executeImmediately ? '' : `${withSlash} `,\n\t\t\t\t\t\t\tdocumentation: c.detail,\n\t\t\t\t\t\t\trange,\n\t\t\t\t\t\t\tfilterText: `${chatAgentLeader}${c.command}`,\n\t\t\t\t\t\t\tsortText: c.sortText ?? 'z'.repeat(i + 1),\n\t\t\t\t\t\t\tkind: CompletionItemKind.Text, // The icons are disabled here anyway,\n\t\t\t\t\t\t\tcommand: c.executeImmediately ? { id: ChatSubmitAction.ID, title: withSlash, arguments: [{ widget, inputValue: `${withSlash} ` }] } : undefined,\n\t\t\t\t\t\t};\n\t\t\t\t\t})\n\t\t\t\t};\n\t\t\t}\n\t\t}));\n\t\tthis._register(this.languageFeaturesService.completionProvider.register({ scheme: Schemas.vscodeChatInput, hasAccessToAllModels: true }, {\n\t\t\t_debugDisplayName: 'promptSlashCommands',\n\t\t\ttriggerCharacters: [chatSubcommandLeader],\n\t\t\tprovideCompletionItems: async (model: ITextModel, position: Position, _context: CompletionContext, token: CancellationToken) => {\n\t\t\t\tconst widget = this.chatWidgetService.getWidgetByInputUri(model.uri);\n\t\t\t\tif (!widget || !widget.viewModel) {\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\n\t\t\t\tconst range = computeCompletionRanges(model, position, /\\/\\w*/g);\n\t\t\t\tif (!range) {\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\n\t\t\t\tif (!isEmptyUpToCompletionWord(model, range)) {\n\t\t\t\t\t// No text allowed before the completion\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst parsedRequest = widget.parsedInput.parts;\n\t\t\t\tconst usedAgent = parsedRequest.find(p => p instanceof ChatRequestAgentPart);\n\t\t\t\tif (usedAgent) {\n\t\t\t\t\t// No (classic) global slash commands when an agent is used\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst promptCommands = await this.promptsService.getPromptSlashCommands(token);\n\t\t\t\tif (promptCommands.length === 0) {\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\n\t\t\t\tif (widget.lockedAgentId) {\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\n\t\t\t\treturn {\n\t\t\t\t\tsuggestions: promptCommands.map((c, i): CompletionItem => {\n\t\t\t\t\t\tconst label = `/${c.name}`;\n\t\t\t\t\t\tconst description = c.description;\n\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\tlabel: { label, description },\n\t\t\t\t\t\t\tinsertText: `${label} `,\n\t\t\t\t\t\t\tdocumentation: c.description,\n\t\t\t\t\t\t\trange,\n\t\t\t\t\t\t\tsortText: 'a'.repeat(i + 1),\n\t\t\t\t\t\t\tkind: CompletionItemKind.Text, // The icons are disabled here anyway,\n\t\t\t\t\t\t};\n\t\t\t\t\t})\n\t\t\t\t};\n\t\t\t}\n\t\t}));\n\n\t\tthis._register(this.languageFeaturesService.completionProvider.register({ scheme: Schemas.vscodeChatInput, hasAccessToAllModels: true }, {\n\t\t\t_debugDisplayName: 'mcpPromptSlashCommands',\n\t\t\ttriggerCharacters: [chatSubcommandLeader],\n\t\t\tprovideCompletionItems: async (model: ITextModel, position: Position, _context: CompletionContext, _token: CancellationToken) => {\n\t\t\t\tconst widget = this.chatWidgetService.getWidgetByInputUri(model.uri);\n\t\t\t\tif (!widget || !widget.viewModel) {\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\n\t\t\t\t// regex is the opposite of `mcpPromptReplaceSpecialChars` found in `mcpTypes.ts`\n\t\t\t\tconst range = computeCompletionRanges(model, position, /\\/[a-z0-9_.-]*/g);\n\t\t\t\tif (!range) {\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\n\t\t\t\tif (!isEmptyUpToCompletionWord(model, range)) {\n\t\t\t\t\t// No text allowed before the completion\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (widget.lockedAgentId) {\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\n\t\t\t\treturn {\n\t\t\t\t\tsuggestions: mcpService.servers.get().flatMap(server => server.prompts.get().map((prompt): CompletionItem => {\n\t\t\t\t\t\tconst label = `/mcp.${prompt.id}`;\n\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\tlabel: { label, description: prompt.description },\n\t\t\t\t\t\t\tcommand: {\n\t\t\t\t\t\t\t\tid: StartParameterizedPromptAction.ID,\n\t\t\t\t\t\t\t\ttitle: prompt.name,\n\t\t\t\t\t\t\t\targuments: [model, server, prompt, `${label} `],\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tinsertText: `${label} `,\n\t\t\t\t\t\t\trange,\n\t\t\t\t\t\t\tkind: CompletionItemKind.Text,\n\t\t\t\t\t\t};\n\t\t\t\t\t}))\n\t\t\t\t};\n\t\t\t}\n\t\t}));\n\t}\n}\n\nRegistry.as<IWorkbenchContributionsRegistry>(WorkbenchExtensions.Workbench).registerWorkbenchContribution(SlashCommandCompletions, LifecyclePhase.Eventually);\n\nclass AgentCompletions extends Disposable {\n\tconstructor(\n\t\t@ILanguageFeaturesService private readonly languageFeaturesService: ILanguageFeaturesService,\n\t\t@IChatWidgetService private readonly chatWidgetService: IChatWidgetService,\n\t\t@IChatAgentService private readonly chatAgentService: IChatAgentService,\n\t\t@IChatAgentNameService private readonly chatAgentNameService: IChatAgentNameService,\n\t) {\n\t\tsuper();\n\n\n\t\tconst subCommandProvider: CompletionItemProvider = {\n\t\t\t_debugDisplayName: 'chatAgentSubcommand',\n\t\t\ttriggerCharacters: [chatSubcommandLeader],\n\t\t\tprovideCompletionItems: async (model: ITextModel, position: Position, _context: CompletionContext, token: CancellationToken) => {\n\t\t\t\tconst widget = this.chatWidgetService.getWidgetByInputUri(model.uri);\n\t\t\t\tif (!widget || !widget.viewModel) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst range = computeCompletionRanges(model, position, /\\/\\w*/g);\n\t\t\t\tif (!range) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst usedAgent = this.getCurrentAgentForWidget(widget);\n\t\t\t\tif (!usedAgent || usedAgent.command) {\n\t\t\t\t\t// Only one allowed\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\treturn {\n\t\t\t\t\tsuggestions: usedAgent.agent.slashCommands.map((c, i): CompletionItem => {\n\t\t\t\t\t\tconst withSlash = `/${c.name}`;\n\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\tlabel: withSlash,\n\t\t\t\t\t\t\tinsertText: `${withSlash} `,\n\t\t\t\t\t\t\tdocumentation: c.description,\n\t\t\t\t\t\t\trange,\n\t\t\t\t\t\t\tkind: CompletionItemKind.Text, // The icons are disabled here anyway\n\t\t\t\t\t\t};\n\t\t\t\t\t})\n\t\t\t\t};\n\t\t\t}\n\t\t};\n\t\tthis._register(this.languageFeaturesService.completionProvider.register({ scheme: Schemas.vscodeChatInput, hasAccessToAllModels: true }, subCommandProvider));\n\n\t\tthis._register(this.languageFeaturesService.completionProvider.register({ scheme: Schemas.vscodeChatInput, hasAccessToAllModels: true }, {\n\t\t\t_debugDisplayName: 'chatAgentAndSubcommand',\n\t\t\ttriggerCharacters: [chatAgentLeader],\n\t\t\tprovideCompletionItems: async (model: ITextModel, position: Position, _context: CompletionContext, token: CancellationToken) => {\n\t\t\t\tconst widget = this.chatWidgetService.getWidgetByInputUri(model.uri);\n\t\t\t\tconst viewModel = widget?.viewModel;\n\t\t\t\tif (!widget || !viewModel) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (widget.lockedAgentId) {\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\n\t\t\t\tconst range = computeCompletionRanges(model, position, /(@|\\/)\\w*/g);\n\t\t\t\tif (!range) {\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\n\t\t\t\tif (!isEmptyUpToCompletionWord(model, range)) {\n\t\t\t\t\t// No text allowed before the completion\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst agents = this.chatAgentService.getAgents()\n\t\t\t\t\t.filter(a => a.locations.includes(widget.location));\n\n\t\t\t\t// When the input is only `/`, items are sorted by sortText.\n\t\t\t\t// When typing, filterText is used to score and sort.\n\t\t\t\t// The same list is refiltered/ranked while typing.\n\t\t\t\tconst getFilterText = (agent: IChatAgentData, command: string) => {\n\t\t\t\t\t// This is hacking the filter algorithm to make @terminal /explain match worse than @workspace /explain by making its match index later in the string.\n\t\t\t\t\t// When I type `/exp`, the workspace one should be sorted over the terminal one.\n\t\t\t\t\tconst dummyPrefix = agent.id === 'github.copilot.terminalPanel' ? `0000` : ``;\n\t\t\t\t\treturn `${chatAgentLeader}${dummyPrefix}${agent.name}.${command}`;\n\t\t\t\t};\n\n\t\t\t\tconst justAgents: CompletionItem[] = agents\n\t\t\t\t\t.filter(a => !a.isDefault)\n\t\t\t\t\t.map(agent => {\n\t\t\t\t\t\tconst { label: agentLabel, isDupe } = this.getAgentCompletionDetails(agent);\n\t\t\t\t\t\tconst detail = agent.description;\n\n\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\tlabel: isDupe ?\n\t\t\t\t\t\t\t\t{ label: agentLabel, description: agent.description, detail: ` (${agent.publisherDisplayName})` } :\n\t\t\t\t\t\t\t\tagentLabel,\n\t\t\t\t\t\t\tdocumentation: detail,\n\t\t\t\t\t\t\tfilterText: `${chatAgentLeader}${agent.name}`,\n\t\t\t\t\t\t\tinsertText: `${agentLabel} `,\n\t\t\t\t\t\t\trange,\n\t\t\t\t\t\t\tkind: CompletionItemKind.Text,\n\t\t\t\t\t\t\tsortText: `${chatAgentLeader}${agent.name}`,\n\t\t\t\t\t\t\tcommand: { id: AssignSelectedAgentAction.ID, title: AssignSelectedAgentAction.ID, arguments: [{ agent, widget } satisfies AssignSelectedAgentActionArgs] },\n\t\t\t\t\t\t};\n\t\t\t\t\t});\n\n\t\t\t\treturn {\n\t\t\t\t\tsuggestions: justAgents.concat(\n\t\t\t\t\t\tcoalesce(agents.flatMap(agent => agent.slashCommands.map((c, i) => {\n\t\t\t\t\t\t\tif (agent.isDefault && this.chatAgentService.getDefaultAgent(widget.location, widget.input.currentModeKind)?.id !== agent.id) {\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tconst { label: agentLabel, isDupe } = this.getAgentCompletionDetails(agent);\n\t\t\t\t\t\t\tconst label = `${agentLabel} ${chatSubcommandLeader}${c.name}`;\n\t\t\t\t\t\t\tconst item: CompletionItem = {\n\t\t\t\t\t\t\t\tlabel: isDupe ?\n\t\t\t\t\t\t\t\t\t{ label, description: c.description, detail: isDupe ? ` (${agent.publisherDisplayName})` : undefined } :\n\t\t\t\t\t\t\t\t\tlabel,\n\t\t\t\t\t\t\t\tdocumentation: c.description,\n\t\t\t\t\t\t\t\tfilterText: getFilterText(agent, c.name),\n\t\t\t\t\t\t\t\tcommitCharacters: [' '],\n\t\t\t\t\t\t\t\tinsertText: label + ' ',\n\t\t\t\t\t\t\t\trange,\n\t\t\t\t\t\t\t\tkind: CompletionItemKind.Text, // The icons are disabled here anyway\n\t\t\t\t\t\t\t\tsortText: `x${chatAgentLeader}${agent.name}${c.name}`,\n\t\t\t\t\t\t\t\tcommand: { id: AssignSelectedAgentAction.ID, title: AssignSelectedAgentAction.ID, arguments: [{ agent, widget } satisfies AssignSelectedAgentActionArgs] },\n\t\t\t\t\t\t\t};\n\n\t\t\t\t\t\t\tif (agent.isDefault) {\n\t\t\t\t\t\t\t\t// default agent isn't mentioned nor inserted\n\t\t\t\t\t\t\t\tconst label = `${chatSubcommandLeader}${c.name}`;\n\t\t\t\t\t\t\t\titem.label = label;\n\t\t\t\t\t\t\t\titem.insertText = `${label} `;\n\t\t\t\t\t\t\t\titem.documentation = c.description;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\treturn item;\n\t\t\t\t\t\t}))))\n\t\t\t\t};\n\t\t\t}\n\t\t}));\n\n\t\tthis._register(this.languageFeaturesService.completionProvider.register({ scheme: Schemas.vscodeChatInput, hasAccessToAllModels: true }, {\n\t\t\t_debugDisplayName: 'chatAgentAndSubcommand',\n\t\t\ttriggerCharacters: [chatSubcommandLeader],\n\t\t\tprovideCompletionItems: async (model: ITextModel, position: Position, _context: CompletionContext, token: CancellationToken) => {\n\t\t\t\tconst widget = this.chatWidgetService.getWidgetByInputUri(model.uri);\n\t\t\t\tconst viewModel = widget?.viewModel;\n\t\t\t\tif (!widget || !viewModel) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (widget.lockedAgentId) {\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\n\t\t\t\tconst range = computeCompletionRanges(model, position, /(@|\\/)\\w*/g);\n\t\t\t\tif (!range) {\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\n\t\t\t\tif (!isEmptyUpToCompletionWord(model, range)) {\n\t\t\t\t\t// No text allowed before the completion\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst agents = this.chatAgentService.getAgents()\n\t\t\t\t\t.filter(a => a.locations.includes(widget.location) && a.modes.includes(widget.input.currentModeKind));\n\n\t\t\t\treturn {\n\t\t\t\t\tsuggestions: coalesce(agents.flatMap(agent => agent.slashCommands.map((c, i) => {\n\t\t\t\t\t\tif (agent.isDefault && this.chatAgentService.getDefaultAgent(widget.location, widget.input.currentModeKind)?.id !== agent.id) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tconst { label: agentLabel, isDupe } = this.getAgentCompletionDetails(agent);\n\t\t\t\t\t\tconst withSlash = `${chatSubcommandLeader}${c.name}`;\n\t\t\t\t\t\tconst extraSortText = agent.id === 'github.copilot.terminalPanel' ? `z` : ``;\n\t\t\t\t\t\tconst sortText = `${chatSubcommandLeader}${extraSortText}${agent.name}${c.name}`;\n\t\t\t\t\t\tconst item: CompletionItem = {\n\t\t\t\t\t\t\tlabel: { label: withSlash, description: agentLabel, detail: isDupe ? ` (${agent.publisherDisplayName})` : undefined },\n\t\t\t\t\t\t\tcommitCharacters: [' '],\n\t\t\t\t\t\t\tinsertText: `${agentLabel} ${withSlash} `,\n\t\t\t\t\t\t\tdocumentation: `(${agentLabel}) ${c.description ?? ''}`,\n\t\t\t\t\t\t\trange,\n\t\t\t\t\t\t\tkind: CompletionItemKind.Text, // The icons are disabled here anyway\n\t\t\t\t\t\t\tsortText,\n\t\t\t\t\t\t\tcommand: { id: AssignSelectedAgentAction.ID, title: AssignSelectedAgentAction.ID, arguments: [{ agent, widget } satisfies AssignSelectedAgentActionArgs] },\n\t\t\t\t\t\t};\n\n\t\t\t\t\t\tif (agent.isDefault) {\n\t\t\t\t\t\t\t// default agent isn't mentioned nor inserted\n\t\t\t\t\t\t\tconst label = `${chatSubcommandLeader}${c.name}`;\n\t\t\t\t\t\t\titem.label = label;\n\t\t\t\t\t\t\titem.insertText = `${label} `;\n\t\t\t\t\t\t\titem.documentation = c.description;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn item;\n\t\t\t\t\t})))\n\t\t\t\t};\n\t\t\t}\n\t\t}));\n\n\t\tthis._register(this.languageFeaturesService.completionProvider.register({ scheme: Schemas.vscodeChatInput, hasAccessToAllModels: true }, {\n\t\t\t_debugDisplayName: 'installChatExtensions',\n\t\t\ttriggerCharacters: [chatAgentLeader],\n\t\t\tprovideCompletionItems: async (model: ITextModel, position: Position, _context: CompletionContext, token: CancellationToken) => {\n\t\t\t\tif (!model.getLineContent(1).startsWith(chatAgentLeader)) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst widget = this.chatWidgetService.getWidgetByInputUri(model.uri);\n\t\t\t\tif (widget?.location !== ChatAgentLocation.Chat || widget.input.currentModeKind !== ChatModeKind.Ask) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (widget.lockedAgentId) {\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\n\t\t\t\tconst range = computeCompletionRanges(model, position, /(@|\\/)\\w*/g);\n\t\t\t\tif (!range) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (!isEmptyUpToCompletionWord(model, range)) {\n\t\t\t\t\t// No text allowed before the completion\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst label = localize('installLabel', \"Install Chat Extensions...\");\n\t\t\t\tconst item: CompletionItem = {\n\t\t\t\t\tlabel,\n\t\t\t\t\tinsertText: '',\n\t\t\t\t\trange,\n\t\t\t\t\tkind: CompletionItemKind.Text, // The icons are disabled here anyway\n\t\t\t\t\tcommand: { id: 'workbench.extensions.search', title: '', arguments: ['@tag:chat-participant'] },\n\t\t\t\t\tfilterText: chatAgentLeader + label,\n\t\t\t\t\tsortText: 'zzz'\n\t\t\t\t};\n\n\t\t\t\treturn {\n\t\t\t\t\tsuggestions: [item]\n\t\t\t\t};\n\t\t\t}\n\t\t}));\n\t}\n\n\tprivate getCurrentAgentForWidget(widget: IChatWidget): { agent: IChatAgentData; command?: string } | undefined {\n\t\tif (widget.lockedAgentId) {\n\t\t\tconst usedAgent = this.chatAgentService.getAgent(widget.lockedAgentId);\n\t\t\treturn usedAgent && { agent: usedAgent };\n\t\t}\n\n\t\tconst parsedRequest = widget.parsedInput.parts;\n\t\tconst usedAgentIdx = parsedRequest.findIndex((p): p is ChatRequestAgentPart => p instanceof ChatRequestAgentPart);\n\t\tif (usedAgentIdx < 0) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst usedAgent = parsedRequest[usedAgentIdx] as ChatRequestAgentPart;\n\n\t\tconst usedOtherCommand = parsedRequest.find(p => p instanceof ChatRequestAgentSubcommandPart || p instanceof ChatRequestSlashPromptPart);\n\t\tif (usedOtherCommand) {\n\t\t\t// Only one allowed\n\t\t\treturn {\n\t\t\t\tagent: usedAgent.agent,\n\t\t\t\tcommand: usedOtherCommand instanceof ChatRequestAgentSubcommandPart ? usedOtherCommand.command.name : undefined\n\t\t\t};\n\t\t}\n\n\t\tfor (const partAfterAgent of parsedRequest.slice(usedAgentIdx + 1)) {\n\t\t\t// Could allow text after 'position'\n\t\t\tif (!(partAfterAgent instanceof ChatRequestTextPart) || !partAfterAgent.text.trim().match(/^(\\/\\w*)?$/)) {\n\t\t\t\t// No text allowed between agent and subcommand\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\treturn { agent: usedAgent.agent };\n\t}\n\n\tprivate getAgentCompletionDetails(agent: IChatAgentData): { label: string; isDupe: boolean } {\n\t\tconst isAllowed = this.chatAgentNameService.getAgentNameRestriction(agent);\n\t\tconst agentLabel = `${chatAgentLeader}${isAllowed ? agent.name : getFullyQualifiedId(agent)}`;\n\t\tconst isDupe = isAllowed && this.chatAgentService.agentHasDupeName(agent.id);\n\t\treturn { label: agentLabel, isDupe };\n\t}\n}\nRegistry.as<IWorkbenchContributionsRegistry>(WorkbenchExtensions.Workbench).registerWorkbenchContribution(AgentCompletions, LifecyclePhase.Eventually);\n\ninterface AssignSelectedAgentActionArgs {\n\tagent: IChatAgentData;\n\twidget: IChatWidget;\n}\n\nclass AssignSelectedAgentAction extends Action2 {\n\tstatic readonly ID = 'workbench.action.chat.assignSelectedAgent';\n\n\tconstructor() {\n\t\tsuper({\n\t\t\tid: AssignSelectedAgentAction.ID,\n\t\t\ttitle: '' // not displayed\n\t\t});\n\t}\n\n\tasync run(accessor: ServicesAccessor, ...args: unknown[]) {\n\t\tconst arg = args[0] as AssignSelectedAgentActionArgs | undefined;\n\t\tif (!arg || !arg.widget || !arg.agent) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!arg.agent.modes.includes(arg.widget.input.currentModeKind)) {\n\t\t\targ.widget.input.setChatMode(arg.agent.modes[0]);\n\t\t}\n\n\t\targ.widget.lastSelectedAgent = arg.agent;\n\t}\n}\nregisterAction2(AssignSelectedAgentAction);\n\nclass StartParameterizedPromptAction extends Action2 {\n\tstatic readonly ID = 'workbench.action.chat.startParameterizedPrompt';\n\n\tconstructor() {\n\t\tsuper({\n\t\t\tid: StartParameterizedPromptAction.ID,\n\t\t\ttitle: '' // not displayed\n\t\t});\n\t}\n\n\tasync run(accessor: ServicesAccessor, model: ITextModel, server: IMcpServer, prompt: IMcpPrompt, textToReplace: string) {\n\t\tif (!model || !prompt) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst instantiationService = accessor.get(IInstantiationService);\n\t\tconst notificationService = accessor.get(INotificationService);\n\t\tconst widgetService = accessor.get(IChatWidgetService);\n\t\tconst fileService = accessor.get(IFileService);\n\n\t\tconst chatWidget = widgetService.lastFocusedWidget;\n\t\tif (!chatWidget) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst lastPosition = model.getFullModelRange().collapseToEnd();\n\t\tconst getPromptIndex = () => model.findMatches(textToReplace, true, false, true, null, false)[0];\n\t\tconst replaceTextWith = (value: string) => model.applyEdits([{\n\t\t\trange: getPromptIndex()?.range || lastPosition,\n\t\t\ttext: value,\n\t\t}]);\n\n\t\tconst store = new DisposableStore();\n\t\tconst cts = store.add(new CancellationTokenSource());\n\t\tstore.add(chatWidget.input.startGenerating());\n\n\t\tstore.add(model.onDidChangeContent(() => {\n\t\t\tif (getPromptIndex()) {\n\t\t\t\tcts.cancel(); // cancel if the user deletes their prompt\n\t\t\t}\n\t\t}));\n\n\t\tmodel.changeDecorations(accessor => {\n\t\t\tconst id = accessor.addDecoration(lastPosition, {\n\t\t\t\tdescription: 'mcp-prompt-spinner',\n\t\t\t\tshowIfCollapsed: true,\n\t\t\t\tafter: {\n\t\t\t\t\tcontent: ' ',\n\t\t\t\t\tinlineClassNameAffectsLetterSpacing: true,\n\t\t\t\t\tinlineClassName: ThemeIcon.asClassName(ThemeIcon.modify(Codicon.loading, 'spin')) + ' chat-prompt-spinner',\n\t\t\t\t}\n\t\t\t});\n\t\t\tstore.add(toDisposable(() => {\n\t\t\t\tmodel.changeDecorations(a => a.removeDecoration(id));\n\t\t\t}));\n\t\t});\n\n\t\tconst pick = store.add(instantiationService.createInstance(McpPromptArgumentPick, prompt));\n\n\t\ttry {\n\t\t\t// start the server if not already running so that it's ready to resolve\n\t\t\t// the prompt instantly when the user finishes picking arguments.\n\t\t\tawait server.start();\n\n\t\t\tconst args = await pick.createArgs();\n\t\t\tif (!args) {\n\t\t\t\treplaceTextWith('');\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tlet messages: IMcpPromptMessage[];\n\t\t\ttry {\n\t\t\t\tmessages = await prompt.resolve(args, cts.token);\n\t\t\t} catch (e) {\n\t\t\t\tif (!cts.token.isCancellationRequested) {\n\t\t\t\t\tnotificationService.error(localize('mcp.prompt.error', \"Error resolving prompt: {0}\", String(e)));\n\t\t\t\t}\n\t\t\t\treplaceTextWith('');\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst toAttach: IChatRequestVariableEntry[] = [];\n\t\t\tconst attachBlob = async (mimeType: string | undefined, contents: string, uriStr?: string, isText = false) => {\n\t\t\t\tlet validURI: URI | undefined;\n\t\t\t\tif (uriStr) {\n\t\t\t\t\tfor (const uri of [URI.parse(uriStr), McpResourceURI.fromServer(server.definition, uriStr)]) {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tvalidURI ||= await fileService.exists(uri) ? uri : undefined;\n\t\t\t\t\t\t} catch {\n\t\t\t\t\t\t\t// ignored\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (isText) {\n\t\t\t\t\tif (validURI) {\n\t\t\t\t\t\ttoAttach.push({\n\t\t\t\t\t\t\tid: generateUuid(),\n\t\t\t\t\t\t\tkind: 'file',\n\t\t\t\t\t\t\tvalue: validURI,\n\t\t\t\t\t\t\tname: basename(validURI),\n\t\t\t\t\t\t});\n\t\t\t\t\t} else {\n\t\t\t\t\t\ttoAttach.push({\n\t\t\t\t\t\t\tid: generateUuid(),\n\t\t\t\t\t\t\tkind: 'generic',\n\t\t\t\t\t\t\tvalue: contents,\n\t\t\t\t\t\t\tname: localize('mcp.prompt.resource', 'Prompt Resource'),\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t} else if (mimeType && getAttachableImageExtension(mimeType)) {\n\t\t\t\t\tconst resized = await resizeImage(contents)\n\t\t\t\t\t\t.catch(() => decodeBase64(contents).buffer);\n\t\t\t\t\tchatWidget.attachmentModel.addContext({\n\t\t\t\t\t\tid: generateUuid(),\n\t\t\t\t\t\tname: localize('mcp.prompt.image', 'Prompt Image'),\n\t\t\t\t\t\tfullName: localize('mcp.prompt.image', 'Prompt Image'),\n\t\t\t\t\t\tvalue: resized,\n\t\t\t\t\t\tkind: 'image',\n\t\t\t\t\t\treferences: validURI && [{ reference: validURI, kind: 'reference' }],\n\t\t\t\t\t});\n\t\t\t\t} else if (validURI) {\n\t\t\t\t\ttoAttach.push({\n\t\t\t\t\t\tid: generateUuid(),\n\t\t\t\t\t\tkind: 'file',\n\t\t\t\t\t\tvalue: validURI,\n\t\t\t\t\t\tname: basename(validURI),\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\t// not a valid resource/resource URI\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tconst hasMultipleRoles = messages.some(m => m.role !== messages[0].role);\n\t\t\tlet input = '';\n\t\t\tfor (const message of messages) {\n\t\t\t\tswitch (message.content.type) {\n\t\t\t\t\tcase 'text':\n\t\t\t\t\t\tif (input) {\n\t\t\t\t\t\t\tinput += '\\n\\n';\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (hasMultipleRoles) {\n\t\t\t\t\t\t\tinput += `--${message.role.toUpperCase()}\\n`;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tinput += message.content.text;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'resource':\n\t\t\t\t\t\tif ('text' in message.content.resource) {\n\t\t\t\t\t\t\tawait attachBlob(message.content.resource.mimeType, message.content.resource.text, message.content.resource.uri, true);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tawait attachBlob(message.content.resource.mimeType, message.content.resource.blob, message.content.resource.uri);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'image':\n\t\t\t\t\tcase 'audio':\n\t\t\t\t\t\tawait attachBlob(message.content.mimeType, message.content.data);\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (toAttach.length) {\n\t\t\t\tchatWidget.attachmentModel.addContext(...toAttach);\n\t\t\t}\n\t\t\treplaceTextWith(input);\n\t\t} finally {\n\t\t\tstore.dispose();\n\t\t}\n\t}\n}\nregisterAction2(StartParameterizedPromptAction);\n\n\nclass ReferenceArgument {\n\tconstructor(\n\t\treadonly widget: IChatWidget,\n\t\treadonly variable: IDynamicVariable\n\t) { }\n}\n\ninterface IVariableCompletionsDetails {\n\tmodel: ITextModel;\n\tposition: Position;\n\tcontext: CompletionContext;\n\twidget: IChatWidget;\n\trange: IChatCompletionRangeResult;\n}\n\nclass BuiltinDynamicCompletions extends Disposable {\n\tprivate static readonly addReferenceCommand = '_addReferenceCmd';\n\tprivate static readonly VariableNameDef = new RegExp(`${chatVariableLeader}[\\\\w:-]*`, 'g'); // MUST be using `g`-flag\n\n\n\tconstructor(\n\t\t@IHistoryService private readonly historyService: IHistoryService,\n\t\t@IWorkspaceContextService private readonly workspaceContextService: IWorkspaceContextService,\n\t\t@ISearchService private readonly searchService: ISearchService,\n\t\t@ILabelService private readonly labelService: ILabelService,\n\t\t@ILanguageFeaturesService private readonly languageFeaturesService: ILanguageFeaturesService,\n\t\t@IChatWidgetService private readonly chatWidgetService: IChatWidgetService,\n\t\t@IChatEditingService private readonly _chatEditingService: IChatEditingService,\n\t\t@IOutlineModelService private readonly outlineService: IOutlineModelService,\n\t\t@IEditorService private readonly editorService: IEditorService,\n\t\t@IConfigurationService private readonly configurationService: IConfigurationService,\n\t\t@ICodeEditorService private readonly codeEditorService: ICodeEditorService,\n\t\t@IChatAgentService private readonly chatAgentService: IChatAgentService,\n\t\t@IInstantiationService private readonly instantiationService: IInstantiationService,\n\t) {\n\t\tsuper();\n\n\t\t// File/Folder completions in one go and m\n\t\tconst fileWordPattern = new RegExp(`${chatVariableLeader}[^\\\\s]*`, 'g');\n\t\tthis.registerVariableCompletions('fileAndFolder', async ({ widget, range }, token) => {\n\t\t\tif (!widget.supportsFileReferences) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst result: CompletionList = { suggestions: [] };\n\n\t\t\t// If locked to an agent that doesn't support file attachments, skip\n\t\t\tif (widget.lockedAgentId) {\n\t\t\t\tconst agent = this.chatAgentService.getAgent(widget.lockedAgentId);\n\t\t\t\tif (agent && !agent.capabilities?.supportsFileAttachments) {\n\t\t\t\t\treturn result;\n\t\t\t\t}\n\t\t\t}\n\t\t\tawait this.addFileAndFolderEntries(widget, result, range, token);\n\t\t\treturn result;\n\n\t\t}, fileWordPattern);\n\n\t\t// Selection completion\n\t\tthis.registerVariableCompletions('selection', ({ widget, range }, token) => {\n\t\t\tif (!widget.supportsFileReferences) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (widget.location === ChatAgentLocation.EditorInline) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst active = this.findActiveCodeEditor();\n\t\t\tif (!isCodeEditor(active)) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst currentResource = active.getModel()?.uri;\n\t\t\tconst currentSelection = active.getSelection();\n\t\t\tif (!currentSelection || !currentResource || currentSelection.isEmpty()) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst basename = this.labelService.getUriBasenameLabel(currentResource);\n\t\t\tconst text = `${chatVariableLeader}file:${basename}:${currentSelection.startLineNumber}-${currentSelection.endLineNumber}`;\n\t\t\tconst fullRangeText = `:${currentSelection.startLineNumber}:${currentSelection.startColumn}-${currentSelection.endLineNumber}:${currentSelection.endColumn}`;\n\t\t\tconst description = this.labelService.getUriLabel(currentResource, { relative: true }) + fullRangeText;\n\n\t\t\tconst result: CompletionList = { suggestions: [] };\n\t\t\tresult.suggestions.push({\n\t\t\t\tlabel: { label: `${chatVariableLeader}selection`, description },\n\t\t\t\tfilterText: `${chatVariableLeader}selection`,\n\t\t\t\tinsertText: range.varWord?.endColumn === range.replace.endColumn ? `${text} ` : text,\n\t\t\t\trange,\n\t\t\t\tkind: CompletionItemKind.Text,\n\t\t\t\tsortText: 'z',\n\t\t\t\tcommand: {\n\t\t\t\t\tid: BuiltinDynamicCompletions.addReferenceCommand, title: '', arguments: [new ReferenceArgument(widget, {\n\t\t\t\t\t\tid: 'vscode.selection',\n\t\t\t\t\t\tisFile: true,\n\t\t\t\t\t\trange: { startLineNumber: range.replace.startLineNumber, startColumn: range.replace.startColumn, endLineNumber: range.replace.endLineNumber, endColumn: range.replace.startColumn + text.length },\n\t\t\t\t\t\tdata: { range: currentSelection, uri: currentResource } satisfies Location\n\t\t\t\t\t})]\n\t\t\t\t}\n\t\t\t});\n\t\t\treturn result;\n\t\t});\n\n\t\t// Symbol completions\n\t\tthis.registerVariableCompletions('symbol', ({ widget, range, position, model }, token) => {\n\t\t\tif (!widget.supportsFileReferences) {\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tconst result: CompletionList = { suggestions: [] };\n\t\t\tconst range2 = computeCompletionRanges(model, position, new RegExp(`${chatVariableLeader}[^\\\\s]*`, 'g'), true);\n\t\t\tif (range2) {\n\t\t\t\tthis.addSymbolEntries(widget, result, range2, token);\n\t\t\t}\n\n\t\t\treturn result;\n\t\t});\n\n\t\tthis._register(CommandsRegistry.registerCommand(BuiltinDynamicCompletions.addReferenceCommand, (_services, arg) => {\n\t\t\tassertType(arg instanceof ReferenceArgument);\n\t\t\treturn this.cmdAddReference(arg);\n\t\t}));\n\t}\n\n\tprivate findActiveCodeEditor(): ICodeEditor | undefined {\n\t\tconst codeEditor = this.codeEditorService.getActiveCodeEditor();\n\t\tif (codeEditor) {\n\t\t\tconst model = codeEditor.getModel();\n\t\t\tif (model?.uri.scheme === Schemas.vscodeNotebookCell) {\n\t\t\t\treturn undefined;\n\t\t\t}\n\n\t\t\tif (model) {\n\t\t\t\treturn codeEditor;\n\t\t\t}\n\t\t}\n\t\tfor (const codeOrDiffEditor of this.editorService.getVisibleTextEditorControls(EditorsOrder.MOST_RECENTLY_ACTIVE)) {\n\t\t\tconst codeEditor = getCodeEditor(codeOrDiffEditor);\n\t\t\tif (!codeEditor) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tconst model = codeEditor.getModel();\n\t\t\tif (model) {\n\t\t\t\treturn codeEditor;\n\t\t\t}\n\t\t}\n\t\treturn undefined;\n\t}\n\n\tprivate registerVariableCompletions(debugName: string, provider: (details: IVariableCompletionsDetails, token: CancellationToken) => ProviderResult<CompletionList>, wordPattern: RegExp = BuiltinDynamicCompletions.VariableNameDef) {\n\t\tthis._register(this.languageFeaturesService.completionProvider.register({ scheme: Schemas.vscodeChatInput, hasAccessToAllModels: true }, {\n\t\t\t_debugDisplayName: `chatVarCompletions-${debugName}`,\n\t\t\ttriggerCharacters: [chatVariableLeader],\n\t\t\tprovideCompletionItems: async (model: ITextModel, position: Position, context: CompletionContext, token: CancellationToken) => {\n\t\t\t\tconst widget = this.chatWidgetService.getWidgetByInputUri(model.uri);\n\t\t\t\tif (!widget) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst range = computeCompletionRanges(model, position, wordPattern, true);\n\t\t\t\tif (range) {\n\t\t\t\t\treturn provider({ model, position, widget, range, context }, token);\n\t\t\t\t}\n\n\t\t\t\treturn;\n\t\t\t}\n\t\t}));\n\t}\n\n\tprivate cacheKey?: { key: string; time: number };\n\n\tprivate async addFileAndFolderEntries(widget: IChatWidget, result: CompletionList, info: { insert: Range; replace: Range; varWord: IWordAtPosition | null }, token: CancellationToken) {\n\n\t\tconst makeCompletionItem = (resource: URI, kind: FileKind, description?: string, boostPriority?: boolean): CompletionItem => {\n\t\t\tconst basename = this.labelService.getUriBasenameLabel(resource);\n\t\t\tconst text = `${chatVariableLeader}file:${basename}`;\n\t\t\tconst uriLabel = this.labelService.getUriLabel(resource, { relative: true });\n\t\t\tconst labelDescription = description\n\t\t\t\t? localize('fileEntryDescription', '{0} ({1})', uriLabel, description)\n\t\t\t\t: uriLabel;\n\t\t\t// keep files above other completions\n\t\t\tconst sortText = boostPriority ? ' ' : '!';\n\n\t\t\treturn {\n\t\t\t\tlabel: { label: basename, description: labelDescription },\n\t\t\t\tfilterText: `${chatVariableLeader}${basename}`,\n\t\t\t\tinsertText: info.varWord?.endColumn === info.replace.endColumn ? `${text} ` : text,\n\t\t\t\trange: info,\n\t\t\t\tkind: kind === FileKind.FILE ? CompletionItemKind.File : CompletionItemKind.Folder,\n\t\t\t\tsortText,\n\t\t\t\tcommand: {\n\t\t\t\t\tid: BuiltinDynamicCompletions.addReferenceCommand, title: '', arguments: [new ReferenceArgument(widget, {\n\t\t\t\t\t\tid: resource.toString(),\n\t\t\t\t\t\tisFile: kind === FileKind.FILE,\n\t\t\t\t\t\tisDirectory: kind === FileKind.FOLDER,\n\t\t\t\t\t\trange: { startLineNumber: info.replace.startLineNumber, startColumn: info.replace.startColumn, endLineNumber: info.replace.endLineNumber, endColumn: info.replace.startColumn + text.length },\n\t\t\t\t\t\tdata: resource\n\t\t\t\t\t})]\n\t\t\t\t}\n\t\t\t};\n\t\t};\n\n\t\tlet pattern: string | undefined;\n\t\tif (info.varWord?.word && info.varWord.word.startsWith(chatVariableLeader)) {\n\t\t\tpattern = info.varWord.word.toLowerCase().slice(1); // remove leading #\n\t\t}\n\n\t\tconst seen = new ResourceSet();\n\t\tconst len = result.suggestions.length;\n\n\t\t// HISTORY\n\t\t// always take the last N items\n\t\tfor (const [i, item] of this.historyService.getHistory().entries()) {\n\t\t\tif (!item.resource || seen.has(item.resource) || !this.instantiationService.invokeFunction(accessor => isSupportedChatFileScheme(accessor, item.resource!.scheme))) {\n\t\t\t\t// ignore editors without a resource\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif (pattern) {\n\t\t\t\t// use pattern if available\n\t\t\t\tconst basename = this.labelService.getUriBasenameLabel(item.resource).toLowerCase();\n\t\t\t\tif (!isPatternInWord(pattern, 0, pattern.length, basename, 0, basename.length)) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tseen.add(item.resource);\n\t\t\tconst newLen = result.suggestions.push(makeCompletionItem(item.resource, FileKind.FILE, i === 0 ? localize('activeFile', 'Active file') : undefined, i === 0));\n\t\t\tif (newLen - len >= 5) {\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\t// RELATED FILES\n\t\tif (widget.input.currentModeKind !== ChatModeKind.Ask && widget.viewModel && widget.viewModel.model.editingSession) {\n\t\t\tconst relatedFiles = (await raceTimeout(this._chatEditingService.getRelatedFiles(widget.viewModel.sessionResource, widget.getInput(), widget.attachmentModel.fileAttachments, token), 200)) ?? [];\n\t\t\tfor (const relatedFileGroup of relatedFiles) {\n\t\t\t\tfor (const relatedFile of relatedFileGroup.files) {\n\t\t\t\t\tif (!seen.has(relatedFile.uri)) {\n\t\t\t\t\t\tseen.add(relatedFile.uri);\n\t\t\t\t\t\tresult.suggestions.push(makeCompletionItem(relatedFile.uri, FileKind.FILE, relatedFile.description));\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// SEARCH\n\t\t// use file search when having a pattern\n\t\tif (pattern) {\n\n\t\t\tconst cacheKey = this.updateCacheKey();\n\t\t\tconst workspaces = this.workspaceContextService.getWorkspace().folders.map(folder => folder.uri);\n\n\t\t\tfor (const workspace of workspaces) {\n\t\t\t\tconst { folders, files } = await searchFilesAndFolders(workspace, pattern, true, token, cacheKey.key, this.configurationService, this.searchService);\n\t\t\t\tfor (const file of files) {\n\t\t\t\t\tif (!seen.has(file)) {\n\t\t\t\t\t\tresult.suggestions.push(makeCompletionItem(file, FileKind.FILE));\n\t\t\t\t\t\tseen.add(file);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tfor (const folder of folders) {\n\t\t\t\t\tif (!seen.has(folder)) {\n\t\t\t\t\t\tresult.suggestions.push(makeCompletionItem(folder, FileKind.FOLDER));\n\t\t\t\t\t\tseen.add(folder);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// mark results as incomplete because further typing might yield\n\t\t// in more search results\n\t\tresult.incomplete = true;\n\t}\n\n\tprivate addSymbolEntries(widget: IChatWidget, result: CompletionList, info: { insert: Range; replace: Range; varWord: IWordAtPosition | null }, token: CancellationToken) {\n\n\t\tconst makeSymbolCompletionItem = (symbolItem: { name: string; location: Location; kind: SymbolKind }, pattern: string): CompletionItem => {\n\t\t\tconst text = `${chatVariableLeader}sym:${symbolItem.name}`;\n\t\t\tconst resource = symbolItem.location.uri;\n\t\t\tconst uriLabel = this.labelService.getUriLabel(resource, { relative: true });\n\t\t\tconst sortText = pattern ? '{' /* after z */ : '|' /* after { */;\n\n\t\t\treturn {\n\t\t\t\tlabel: { label: symbolItem.name, description: uriLabel },\n\t\t\t\tfilterText: `${chatVariableLeader}${symbolItem.name}`,\n\t\t\t\tinsertText: info.varWord?.endColumn === info.replace.endColumn ? `${text} ` : text,\n\t\t\t\trange: info,\n\t\t\t\tkind: SymbolKinds.toCompletionKind(symbolItem.kind),\n\t\t\t\tsortText,\n\t\t\t\tcommand: {\n\t\t\t\t\tid: BuiltinDynamicCompletions.addReferenceCommand, title: '', arguments: [new ReferenceArgument(widget, {\n\t\t\t\t\t\tid: `vscode.symbol/${JSON.stringify(symbolItem.location)}`,\n\t\t\t\t\t\tfullName: symbolItem.name,\n\t\t\t\t\t\trange: { startLineNumber: info.replace.startLineNumber, startColumn: info.replace.startColumn, endLineNumber: info.replace.endLineNumber, endColumn: info.replace.startColumn + text.length },\n\t\t\t\t\t\tdata: symbolItem.location,\n\t\t\t\t\t\ticon: SymbolKinds.toIcon(symbolItem.kind)\n\t\t\t\t\t})]\n\t\t\t\t}\n\t\t\t};\n\t\t};\n\n\t\tlet pattern: string | undefined;\n\t\tif (info.varWord?.word && info.varWord.word.startsWith(chatVariableLeader)) {\n\t\t\tpattern = info.varWord.word.toLowerCase().slice(1); // remove leading #\n\t\t}\n\n\t\tconst symbolsToAdd: { symbol: DocumentSymbol; uri: URI }[] = [];\n\t\tfor (const outlineModel of this.outlineService.getCachedModels()) {\n\t\t\tconst symbols = outlineModel.asListOfDocumentSymbols();\n\t\t\tfor (const symbol of symbols) {\n\t\t\t\tsymbolsToAdd.push({ symbol, uri: outlineModel.uri });\n\t\t\t}\n\t\t}\n\n\t\tfor (const symbol of symbolsToAdd) {\n\t\t\tresult.suggestions.push(makeSymbolCompletionItem({ ...symbol.symbol, location: { uri: symbol.uri, range: symbol.symbol.range } }, pattern ?? ''));\n\t\t}\n\n\t\tresult.incomplete = !!pattern;\n\t}\n\n\tprivate updateCacheKey() {\n\t\tif (this.cacheKey && Date.now() - this.cacheKey.time > 60000) {\n\t\t\tthis.searchService.clearCache(this.cacheKey.key);\n\t\t\tthis.cacheKey = undefined;\n\t\t}\n\n\t\tif (!this.cacheKey) {\n\t\t\tthis.cacheKey = {\n\t\t\t\tkey: generateUuid(),\n\t\t\t\ttime: Date.now()\n\t\t\t};\n\t\t}\n\n\t\tthis.cacheKey.time = Date.now();\n\n\t\treturn this.cacheKey;\n\t}\n\n\tprivate cmdAddReference(arg: ReferenceArgument) {\n\t\t// invoked via the completion command\n\t\targ.widget.getContrib<ChatDynamicVariableModel>(ChatDynamicVariableModel.ID)?.addReference(arg.variable);\n\t}\n}\n\nRegistry.as<IWorkbenchContributionsRegistry>(WorkbenchExtensions.Workbench).registerWorkbenchContribution(BuiltinDynamicCompletions, LifecyclePhase.Eventually);\n\nexport interface IChatCompletionRangeResult {\n\tinsert: Range;\n\treplace: Range;\n\tvarWord: IWordAtPosition | null;\n}\n\nexport function computeCompletionRanges(model: ITextModel, position: Position, reg: RegExp, onlyOnWordStart = false): IChatCompletionRangeResult | undefined {\n\tconst varWord = getWordAtText(position.column, reg, model.getLineContent(position.lineNumber), 0);\n\tif (!varWord && model.getWordUntilPosition(position).word) {\n\t\t// inside a \"normal\" word\n\t\treturn;\n\t}\n\n\tif (!varWord && position.column > 1) {\n\t\tconst textBefore = model.getValueInRange(new Range(position.lineNumber, position.column - 1, position.lineNumber, position.column));\n\t\tif (textBefore !== ' ') {\n\t\t\treturn;\n\t\t}\n\t}\n\n\tif (varWord && onlyOnWordStart) {\n\t\tconst wordBefore = model.getWordUntilPosition({ lineNumber: position.lineNumber, column: varWord.startColumn });\n\t\tif (wordBefore.word) {\n\t\t\t// inside a word\n\t\t\treturn;\n\t\t}\n\t}\n\n\tlet insert: Range;\n\tlet replace: Range;\n\tif (!varWord) {\n\t\tinsert = replace = Range.fromPositions(position);\n\t} else {\n\t\tinsert = new Range(position.lineNumber, varWord.startColumn, position.lineNumber, position.column);\n\t\treplace = new Range(position.lineNumber, varWord.startColumn, position.lineNumber, varWord.endColumn);\n\t}\n\n\treturn { insert, replace, varWord };\n}\n\nfunction isEmptyUpToCompletionWord(model: ITextModel, rangeResult: IChatCompletionRangeResult): boolean {\n\tconst startToCompletionWordStart = new Range(1, 1, rangeResult.replace.startLineNumber, rangeResult.replace.startColumn);\n\treturn !!model.getValueInRange(startToCompletionWordStart).match(/^\\s*$/);\n}\n\nclass ToolCompletions extends Disposable {\n\n\tprivate static readonly VariableNameDef = new RegExp(`(?<=^|\\\\s)${chatVariableLeader}\\\\w*`, 'g'); // MUST be using `g`-flag\n\n\tconstructor(\n\t\t@ILanguageFeaturesService private readonly languageFeaturesService: ILanguageFeaturesService,\n\t\t@IChatWidgetService private readonly chatWidgetService: IChatWidgetService,\n\t\t@IChatAgentService private readonly chatAgentService: IChatAgentService,\n\t) {\n\t\tsuper();\n\n\t\tthis._register(this.languageFeaturesService.completionProvider.register({ scheme: Schemas.vscodeChatInput, hasAccessToAllModels: true }, {\n\t\t\t_debugDisplayName: 'chatVariables',\n\t\t\ttriggerCharacters: [chatVariableLeader],\n\t\t\tprovideCompletionItems: async (model: ITextModel, position: Position, _context: CompletionContext, _token: CancellationToken) => {\n\t\t\t\tconst widget = this.chatWidgetService.getWidgetByInputUri(model.uri);\n\t\t\t\tif (!widget) {\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\n\t\t\t\t// If locked to an agent that doesn't support tool attachments, skip\n\t\t\t\tif (widget.lockedAgentId) {\n\t\t\t\t\tconst agent = this.chatAgentService.getAgent(widget.lockedAgentId);\n\t\t\t\t\tif (agent && !agent.capabilities?.supportsToolAttachments) {\n\t\t\t\t\t\treturn null;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tconst range = computeCompletionRanges(model, position, ToolCompletions.VariableNameDef, true);\n\t\t\t\tif (!range) {\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\n\n\t\t\t\tconst usedNames = new Set<string>();\n\t\t\t\tfor (const part of widget.parsedInput.parts) {\n\t\t\t\t\tif (part instanceof ChatRequestToolPart) {\n\t\t\t\t\t\tusedNames.add(part.toolName);\n\t\t\t\t\t} else if (part instanceof ChatRequestToolSetPart) {\n\t\t\t\t\t\tusedNames.add(part.name);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tconst suggestions: CompletionItem[] = [];\n\n\n\t\t\t\tconst iter = widget.input.selectedToolsModel.entriesMap.get();\n\n\t\t\t\tfor (const [item, enabled] of iter) {\n\t\t\t\t\tif (!enabled) {\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\n\t\t\t\t\tlet detail: string | undefined;\n\n\t\t\t\t\tlet name: string;\n\t\t\t\t\tif (item instanceof ToolSet) {\n\t\t\t\t\t\tdetail = item.description;\n\t\t\t\t\t\tname = item.referenceName;\n\n\t\t\t\t\t} else {\n\t\t\t\t\t\tconst source = item.source;\n\t\t\t\t\t\tdetail = localize('tool_source_completion', \"{0}: {1}\", source.label, item.displayName);\n\t\t\t\t\t\tname = item.toolReferenceName ?? item.displayName;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (usedNames.has(name)) {\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\n\t\t\t\t\tconst withLeader = `${chatVariableLeader}${name}`;\n\t\t\t\t\tsuggestions.push({\n\t\t\t\t\t\tlabel: withLeader,\n\t\t\t\t\t\trange,\n\t\t\t\t\t\tdetail,\n\t\t\t\t\t\tinsertText: withLeader + ' ',\n\t\t\t\t\t\tkind: CompletionItemKind.Tool,\n\t\t\t\t\t\tsortText: 'z',\n\t\t\t\t\t});\n\n\t\t\t\t}\n\n\t\t\t\treturn { suggestions };\n\t\t\t}\n\t\t}));\n\t}\n}\n\nRegistry.as<IWorkbenchContributionsRegistry>(WorkbenchExtensions.Workbench).registerWorkbenchContribution(ToolCompletions, LifecyclePhase.Eventually);\n"]}