{"version":3,"sources":["vs/workbench/contrib/chat/common/promptSyntax/languageProviders/promptHeaderAutocompletion.ts"],"names":[],"mappings":"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","file":"promptHeaderAutocompletion.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { CancellationToken } from '../../../../../../base/common/cancellation.js';\nimport { CharCode } from '../../../../../../base/common/charCode.js';\nimport { Position } from '../../../../../../editor/common/core/position.js';\nimport { Range } from '../../../../../../editor/common/core/range.js';\nimport { CompletionContext, CompletionItem, CompletionItemInsertTextRule, CompletionItemKind, CompletionItemProvider, CompletionList } from '../../../../../../editor/common/languages.js';\nimport { ITextModel } from '../../../../../../editor/common/model.js';\nimport { ILanguageModelChatMetadata, ILanguageModelsService } from '../../languageModels.js';\nimport { ILanguageModelToolsService } from '../../languageModelToolsService.js';\nimport { IChatModeService } from '../../chatModes.js';\nimport { getPromptsTypeForLanguageId, PromptsType } from '../promptTypes.js';\nimport { IPromptsService } from '../service/promptsService.js';\nimport { Iterable } from '../../../../../../base/common/iterator.js';\nimport { PromptHeader, PromptHeaderAttributes } from '../promptFileParser.js';\nimport { getValidAttributeNames, isGithubTarget, knownGithubCopilotTools } from './promptValidator.js';\nimport { localize } from '../../../../../../nls.js';\n\nexport class PromptHeaderAutocompletion implements CompletionItemProvider {\n\t/**\n\t * Debug display name for this provider.\n\t */\n\tpublic readonly _debugDisplayName: string = 'PromptHeaderAutocompletion';\n\n\t/**\n\t * List of trigger characters handled by this provider.\n\t */\n\tpublic readonly triggerCharacters = [':'];\n\n\tconstructor(\n\t\t@IPromptsService private readonly promptsService: IPromptsService,\n\t\t@ILanguageModelsService private readonly languageModelsService: ILanguageModelsService,\n\t\t@ILanguageModelToolsService private readonly languageModelToolsService: ILanguageModelToolsService,\n\t\t@IChatModeService private readonly chatModeService: IChatModeService,\n\t) {\n\t}\n\n\t/**\n\t * The main function of this provider that calculates\n\t * completion items based on the provided arguments.\n\t */\n\tpublic async provideCompletionItems(\n\t\tmodel: ITextModel,\n\t\tposition: Position,\n\t\tcontext: CompletionContext,\n\t\ttoken: CancellationToken,\n\t): Promise<CompletionList | undefined> {\n\n\t\tconst promptType = getPromptsTypeForLanguageId(model.getLanguageId());\n\t\tif (!promptType) {\n\t\t\t// if the model is not a prompt, we don't provide any completions\n\t\t\treturn undefined;\n\t\t}\n\n\t\tconst parsedAST = this.promptsService.getParsedPromptFile(model);\n\t\tconst header = parsedAST.header;\n\t\tif (!header) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\tconst headerRange = parsedAST.header.range;\n\t\tif (position.lineNumber < headerRange.startLineNumber || position.lineNumber >= headerRange.endLineNumber) {\n\t\t\t// if the position is not inside the header, we don't provide any completions\n\t\t\treturn undefined;\n\t\t}\n\n\t\tconst lineText = model.getLineContent(position.lineNumber);\n\t\tconst colonIndex = lineText.indexOf(':');\n\t\tconst colonPosition = colonIndex !== -1 ? new Position(position.lineNumber, colonIndex + 1) : undefined;\n\n\t\tif (!colonPosition || position.isBeforeOrEqual(colonPosition)) {\n\t\t\treturn this.provideAttributeNameCompletions(model, position, header, colonPosition, promptType);\n\t\t} else if (colonPosition && colonPosition.isBefore(position)) {\n\t\t\treturn this.provideValueCompletions(model, position, header, colonPosition, promptType);\n\t\t}\n\t\treturn undefined;\n\t}\n\tprivate async provideAttributeNameCompletions(\n\t\tmodel: ITextModel,\n\t\tposition: Position,\n\t\theader: PromptHeader,\n\t\tcolonPosition: Position | undefined,\n\t\tpromptType: PromptsType,\n\t): Promise<CompletionList | undefined> {\n\n\t\tconst suggestions: CompletionItem[] = [];\n\n\t\tconst isGitHubTarget = isGithubTarget(promptType, header.target);\n\t\tconst attributesToPropose = new Set(getValidAttributeNames(promptType, false, isGitHubTarget));\n\t\tfor (const attr of header.attributes) {\n\t\t\tattributesToPropose.delete(attr.key);\n\t\t}\n\t\tconst getInsertText = (key: string): string => {\n\t\t\tif (colonPosition) {\n\t\t\t\treturn key;\n\t\t\t}\n\t\t\tconst valueSuggestions = this.getValueSuggestions(promptType, key);\n\t\t\tif (valueSuggestions.length > 0) {\n\t\t\t\treturn `${key}: \\${0:${valueSuggestions[0]}}`;\n\t\t\t} else {\n\t\t\t\treturn `${key}: \\$0`;\n\t\t\t}\n\t\t};\n\n\n\t\tfor (const attribute of attributesToPropose) {\n\t\t\tconst item: CompletionItem = {\n\t\t\t\tlabel: attribute,\n\t\t\t\tkind: CompletionItemKind.Property,\n\t\t\t\tinsertText: getInsertText(attribute),\n\t\t\t\tinsertTextRules: CompletionItemInsertTextRule.InsertAsSnippet,\n\t\t\t\trange: new Range(position.lineNumber, 1, position.lineNumber, !colonPosition ? model.getLineMaxColumn(position.lineNumber) : colonPosition.column),\n\t\t\t};\n\t\t\tsuggestions.push(item);\n\t\t}\n\n\t\treturn { suggestions };\n\t}\n\n\tprivate async provideValueCompletions(\n\t\tmodel: ITextModel,\n\t\tposition: Position,\n\t\theader: PromptHeader,\n\t\tcolonPosition: Position,\n\t\tpromptType: PromptsType,\n\t): Promise<CompletionList | undefined> {\n\n\t\tconst suggestions: CompletionItem[] = [];\n\t\tconst lineContent = model.getLineContent(position.lineNumber);\n\t\tconst attribute = lineContent.substring(0, colonPosition.column - 1).trim();\n\n\t\tconst isGitHubTarget = isGithubTarget(promptType, header.target);\n\t\tif (!getValidAttributeNames(promptType, true, isGitHubTarget).includes(attribute)) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\tif (promptType === PromptsType.prompt || promptType === PromptsType.agent) {\n\t\t\t// if the position is inside the tools metadata, we provide tool name completions\n\t\t\tconst result = this.provideToolCompletions(model, position, header, isGitHubTarget);\n\t\t\tif (result) {\n\t\t\t\treturn result;\n\t\t\t}\n\t\t}\n\n\t\tconst bracketIndex = lineContent.indexOf('[');\n\t\tif (bracketIndex !== -1 && bracketIndex <= position.column - 1) {\n\t\t\t// if the value is already inside a bracket, we don't provide value completions\n\t\t\treturn undefined;\n\t\t}\n\n\t\tconst whilespaceAfterColon = (lineContent.substring(colonPosition.column).match(/^\\s*/)?.[0].length) ?? 0;\n\t\tconst values = this.getValueSuggestions(promptType, attribute);\n\t\tfor (const value of values) {\n\t\t\tconst item: CompletionItem = {\n\t\t\t\tlabel: value,\n\t\t\t\tkind: CompletionItemKind.Value,\n\t\t\t\tinsertText: whilespaceAfterColon === 0 ? ` ${value}` : value,\n\t\t\t\trange: new Range(position.lineNumber, colonPosition.column + whilespaceAfterColon + 1, position.lineNumber, model.getLineMaxColumn(position.lineNumber)),\n\t\t\t};\n\t\t\tsuggestions.push(item);\n\t\t}\n\t\tif (attribute === PromptHeaderAttributes.handOffs && (promptType === PromptsType.agent)) {\n\t\t\tconst value = [\n\t\t\t\t'',\n\t\t\t\t'  - label: Start Implementation',\n\t\t\t\t'    agent: agent',\n\t\t\t\t'    prompt: Implement the plan',\n\t\t\t\t'    send: true'\n\t\t\t].join('\\n');\n\t\t\tconst item: CompletionItem = {\n\t\t\t\tlabel: localize('promptHeaderAutocompletion.handoffsExample', \"Handoff Example\"),\n\t\t\t\tkind: CompletionItemKind.Value,\n\t\t\t\tinsertText: whilespaceAfterColon === 0 ? ` ${value}` : value,\n\t\t\t\trange: new Range(position.lineNumber, colonPosition.column + whilespaceAfterColon + 1, position.lineNumber, model.getLineMaxColumn(position.lineNumber)),\n\t\t\t};\n\t\t\tsuggestions.push(item);\n\t\t}\n\t\treturn { suggestions };\n\t}\n\n\tprivate getValueSuggestions(promptType: string, attribute: string): string[] {\n\t\tswitch (attribute) {\n\t\t\tcase PromptHeaderAttributes.applyTo:\n\t\t\t\tif (promptType === PromptsType.instructions) {\n\t\t\t\t\treturn [`'**'`, `'**/*.ts, **/*.js'`, `'**/*.php'`, `'**/*.py'`];\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase PromptHeaderAttributes.agent:\n\t\t\tcase PromptHeaderAttributes.mode:\n\t\t\t\tif (promptType === PromptsType.prompt) {\n\t\t\t\t\t// Get all available agents (builtin + custom)\n\t\t\t\t\tconst agents = this.chatModeService.getModes();\n\t\t\t\t\tconst suggestions: string[] = [];\n\t\t\t\t\tfor (const agent of Iterable.concat(agents.builtin, agents.custom)) {\n\t\t\t\t\t\tsuggestions.push(agent.name.get());\n\t\t\t\t\t}\n\t\t\t\t\treturn suggestions;\n\t\t\t\t}\n\t\t\tcase PromptHeaderAttributes.target:\n\t\t\t\tif (promptType === PromptsType.agent) {\n\t\t\t\t\treturn ['vscode', 'github-copilot'];\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase PromptHeaderAttributes.tools:\n\t\t\t\tif (promptType === PromptsType.prompt || promptType === PromptsType.agent) {\n\t\t\t\t\treturn ['[]', `['search', 'edit', 'fetch']`];\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase PromptHeaderAttributes.model:\n\t\t\t\tif (promptType === PromptsType.prompt || promptType === PromptsType.agent) {\n\t\t\t\t\treturn this.getModelNames(promptType === PromptsType.agent);\n\t\t\t\t}\n\t\t}\n\t\treturn [];\n\t}\n\n\tprivate getModelNames(agentModeOnly: boolean): string[] {\n\t\tconst result = [];\n\t\tfor (const model of this.languageModelsService.getLanguageModelIds()) {\n\t\t\tconst metadata = this.languageModelsService.lookupLanguageModel(model);\n\t\t\tif (metadata && metadata.isUserSelectable !== false) {\n\t\t\t\tif (!agentModeOnly || ILanguageModelChatMetadata.suitableForAgentMode(metadata)) {\n\t\t\t\t\tresult.push(ILanguageModelChatMetadata.asQualifiedName(metadata));\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn result;\n\t}\n\n\tprivate provideToolCompletions(model: ITextModel, position: Position, header: PromptHeader, isGitHubTarget: boolean): CompletionList | undefined {\n\t\tconst toolsAttr = header.getAttribute(PromptHeaderAttributes.tools);\n\t\tif (!toolsAttr || toolsAttr.value.type !== 'array' || !toolsAttr.range.containsPosition(position)) {\n\t\t\treturn undefined;\n\t\t}\n\t\tconst getSuggestions = (toolRange: Range) => {\n\t\t\tconst suggestions: CompletionItem[] = [];\n\t\t\tconst toolNames = isGitHubTarget ? Object.keys(knownGithubCopilotTools) : this.languageModelToolsService.getQualifiedToolNames();\n\t\t\tfor (const toolName of toolNames) {\n\t\t\t\tlet insertText: string;\n\t\t\t\tif (!toolRange.isEmpty()) {\n\t\t\t\t\tconst firstChar = model.getValueInRange(toolRange).charCodeAt(0);\n\t\t\t\t\tinsertText = firstChar === CharCode.SingleQuote ? `'${toolName}'` : firstChar === CharCode.DoubleQuote ? `\"${toolName}\"` : toolName;\n\t\t\t\t} else {\n\t\t\t\t\tinsertText = `'${toolName}'`;\n\t\t\t\t}\n\t\t\t\tsuggestions.push({\n\t\t\t\t\tlabel: toolName,\n\t\t\t\t\tkind: CompletionItemKind.Value,\n\t\t\t\t\tfilterText: insertText,\n\t\t\t\t\tinsertText: insertText,\n\t\t\t\t\trange: toolRange,\n\t\t\t\t});\n\t\t\t}\n\t\t\treturn { suggestions };\n\t\t};\n\n\t\tfor (const toolNameNode of toolsAttr.value.items) {\n\t\t\tif (toolNameNode.range.containsPosition(position)) {\n\t\t\t\t// if the position is inside a tool range, we provide tool name completions\n\t\t\t\treturn getSuggestions(toolNameNode.range);\n\t\t\t}\n\t\t}\n\t\tconst prefix = model.getValueInRange(new Range(position.lineNumber, 1, position.lineNumber, position.column));\n\t\tif (prefix.match(/[,[]\\s*$/)) {\n\t\t\t// if the position is after a comma or bracket\n\t\t\treturn getSuggestions(new Range(position.lineNumber, position.column, position.lineNumber, position.column));\n\t\t}\n\t\treturn undefined;\n\t}\n\n}\n"]}