{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/contrib/chat/common/chatService.ts","vs/workbench/contrib/chat/common/chatService.ts"],"names":[],"mappings":"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","file":"chatService.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { IAction } from '../../../../base/common/actions.js';\nimport { DeferredPromise } from '../../../../base/common/async.js';\nimport { CancellationToken } from '../../../../base/common/cancellation.js';\nimport { Event } from '../../../../base/common/event.js';\nimport { IMarkdownString } from '../../../../base/common/htmlContent.js';\nimport { DisposableStore } from '../../../../base/common/lifecycle.js';\nimport { autorun, autorunSelfDisposable, IObservable, IReader } from '../../../../base/common/observable.js';\nimport { ThemeIcon } from '../../../../base/common/themables.js';\nimport { URI, UriComponents } from '../../../../base/common/uri.js';\nimport { IRange, Range } from '../../../../editor/common/core/range.js';\nimport { ISelection } from '../../../../editor/common/core/selection.js';\nimport { Command, Location, TextEdit } from '../../../../editor/common/languages.js';\nimport { FileType } from '../../../../platform/files/common/files.js';\nimport { createDecorator } from '../../../../platform/instantiation/common/instantiation.js';\nimport { IAutostartResult } from '../../mcp/common/mcpTypes.js';\nimport { ICellEditOperation } from '../../notebook/common/notebookCommon.js';\nimport { IWorkspaceSymbol } from '../../search/common/search.js';\nimport { IChatAgentCommand, IChatAgentData, IChatAgentResult, UserSelectedTools } from './chatAgents.js';\nimport { IChatEditingSession } from './chatEditingService.js';\nimport { ChatModel, IChatModel, IChatModelInputState, IChatRequestModeInfo, IChatRequestModel, IChatRequestVariableData, IChatResponseModel, IExportableChatData, ISerializableChatData } from './chatModel.js';\nimport { IParsedChatRequest } from './chatParserTypes.js';\nimport { IChatParserContext } from './chatRequestParser.js';\nimport { IChatRequestVariableEntry } from './chatVariableEntries.js';\nimport { IChatRequestVariableValue } from './chatVariables.js';\nimport { ChatAgentLocation } from './constants.js';\nimport { IPreparedToolInvocation, IToolConfirmationMessages, IToolResult, IToolResultInputOutputDetails, ToolDataSource } from './languageModelToolsService.js';\n\nexport interface IChatRequest {\n\tmessage: string;\n\tvariables: Record<string, IChatRequestVariableValue[]>;\n}\n\nexport enum ChatErrorLevel {\n\tInfo = 0,\n\tWarning = 1,\n\tError = 2\n}\n\nexport interface IChatResponseErrorDetailsConfirmationButton {\n\tdata: any;\n\tlabel: string;\n\tisSecondary?: boolean;\n}\n\nexport interface IChatResponseErrorDetails {\n\tmessage: string;\n\tresponseIsIncomplete?: boolean;\n\tresponseIsFiltered?: boolean;\n\tresponseIsRedacted?: boolean;\n\tisQuotaExceeded?: boolean;\n\tisRateLimited?: boolean;\n\tlevel?: ChatErrorLevel;\n\tconfirmationButtons?: IChatResponseErrorDetailsConfirmationButton[];\n\tcode?: string;\n}\n\nexport interface IChatResponseProgressFileTreeData {\n\tlabel: string;\n\turi: URI;\n\ttype?: FileType;\n\tchildren?: IChatResponseProgressFileTreeData[];\n}\n\nexport type IDocumentContext = {\n\turi: URI;\n\tversion: number;\n\tranges: IRange[];\n};\n\nexport function isIDocumentContext(obj: unknown): obj is IDocumentContext {\n\treturn (\n\t\t!!obj &&\n\t\ttypeof obj === 'object' &&\n\t\t'uri' in obj && obj.uri instanceof URI &&\n\t\t'version' in obj && typeof obj.version === 'number' &&\n\t\t'ranges' in obj && Array.isArray(obj.ranges) && obj.ranges.every(Range.isIRange)\n\t);\n}\n\nexport interface IChatUsedContext {\n\tdocuments: IDocumentContext[];\n\tkind: 'usedContext';\n}\n\nexport function isIUsedContext(obj: unknown): obj is IChatUsedContext {\n\treturn (\n\t\t!!obj &&\n\t\ttypeof obj === 'object' &&\n\t\t'documents' in obj &&\n\t\tArray.isArray(obj.documents) &&\n\t\tobj.documents.every(isIDocumentContext)\n\t);\n}\n\nexport interface IChatContentVariableReference {\n\tvariableName: string;\n\tvalue?: URI | Location;\n}\n\nexport enum ChatResponseReferencePartStatusKind {\n\tComplete = 1,\n\tPartial = 2,\n\tOmitted = 3\n}\n\nexport enum ChatResponseClearToPreviousToolInvocationReason {\n\tNoReason = 0,\n\tFilteredContentRetry = 1,\n\tCopyrightContentRetry = 2,\n}\n\nexport interface IChatContentReference {\n\treference: URI | Location | IChatContentVariableReference | string;\n\ticonPath?: ThemeIcon | { light: URI; dark?: URI };\n\toptions?: {\n\t\tstatus?: { description: string; kind: ChatResponseReferencePartStatusKind };\n\t\tdiffMeta?: { added: number; removed: number };\n\t};\n\tkind: 'reference';\n}\n\nexport interface IChatChangesSummary {\n\treadonly reference: URI;\n\treadonly sessionId: string;\n\treadonly requestId: string;\n\treadonly kind: 'changesSummary';\n}\n\nexport interface IChatCodeCitation {\n\tvalue: URI;\n\tlicense: string;\n\tsnippet: string;\n\tkind: 'codeCitation';\n}\n\nexport interface IChatContentInlineReference {\n\tresolveId?: string;\n\tinlineReference: URI | Location | IWorkspaceSymbol;\n\tname?: string;\n\tkind: 'inlineReference';\n}\n\nexport interface IChatMarkdownContent {\n\tkind: 'markdownContent';\n\tcontent: IMarkdownString;\n\tinlineReferences?: Record<string, IChatContentInlineReference>;\n\tfromSubagent?: boolean;\n}\n\nexport interface IChatTreeData {\n\ttreeData: IChatResponseProgressFileTreeData;\n\tkind: 'treeData';\n}\nexport interface IChatMultiDiffData {\n\tmultiDiffData: {\n\t\ttitle: string;\n\t\tresources: Array<{\n\t\t\toriginalUri?: URI;\n\t\t\tmodifiedUri?: URI;\n\t\t\tgoToFileUri?: URI;\n\t\t\tadded?: number;\n\t\t\tremoved?: number;\n\t\t}>;\n\t};\n\tkind: 'multiDiffData';\n\treadOnly?: boolean;\n}\n\nexport interface IChatProgressMessage {\n\tcontent: IMarkdownString;\n\tkind: 'progressMessage';\n}\n\nexport interface IChatTask extends IChatTaskDto {\n\tdeferred: DeferredPromise<string | void>;\n\tprogress: (IChatWarningMessage | IChatContentReference)[];\n\treadonly onDidAddProgress: Event<IChatWarningMessage | IChatContentReference>;\n\tadd(progress: IChatWarningMessage | IChatContentReference): void;\n\n\tcomplete: (result: string | void) => void;\n\ttask: () => Promise<string | void>;\n\tisSettled: () => boolean;\n}\n\nexport interface IChatUndoStop {\n\tkind: 'undoStop';\n\tid: string;\n}\n\nexport interface IChatExternalEditsDto {\n\tkind: 'externalEdits';\n\tstart: boolean; /** true=start, false=stop */\n\tresources: UriComponents[];\n}\n\nexport interface IChatTaskDto {\n\tcontent: IMarkdownString;\n\tkind: 'progressTask';\n}\n\nexport interface IChatTaskSerialized {\n\tcontent: IMarkdownString;\n\tprogress: (IChatWarningMessage | IChatContentReference)[];\n\tkind: 'progressTaskSerialized';\n}\n\nexport interface IChatTaskResult {\n\tcontent: IMarkdownString | void;\n\tkind: 'progressTaskResult';\n}\n\nexport interface IChatWarningMessage {\n\tcontent: IMarkdownString;\n\tkind: 'warning';\n}\n\nexport interface IChatAgentVulnerabilityDetails {\n\ttitle: string;\n\tdescription: string;\n}\n\nexport interface IChatResponseCodeblockUriPart {\n\tkind: 'codeblockUri';\n\turi: URI;\n\tisEdit?: boolean;\n}\n\nexport interface IChatAgentMarkdownContentWithVulnerability {\n\tcontent: IMarkdownString;\n\tvulnerabilities: IChatAgentVulnerabilityDetails[];\n\tkind: 'markdownVuln';\n}\n\nexport interface IChatCommandButton {\n\tcommand: Command;\n\tkind: 'command';\n}\n\nexport interface IChatMoveMessage {\n\turi: URI;\n\trange: IRange;\n\tkind: 'move';\n}\n\nexport interface IChatTextEdit {\n\turi: URI;\n\tedits: TextEdit[];\n\tkind: 'textEdit';\n\tdone?: boolean;\n\tisExternalEdit?: boolean;\n}\n\nexport interface IChatClearToPreviousToolInvocation {\n\tkind: 'clearToPreviousToolInvocation';\n\treason: ChatResponseClearToPreviousToolInvocationReason;\n}\n\nexport interface IChatNotebookEdit {\n\turi: URI;\n\tedits: ICellEditOperation[];\n\tkind: 'notebookEdit';\n\tdone?: boolean;\n\tisExternalEdit?: boolean;\n}\n\nexport interface IChatConfirmation {\n\ttitle: string;\n\tmessage: string | IMarkdownString;\n\tdata: any;\n\t/** Indicates whether this came from a current chat session (true/undefined) or a restored historic session (false) */\n\tisLive?: boolean;\n\tbuttons?: string[];\n\tisUsed?: boolean;\n\tkind: 'confirmation';\n}\n\nexport const enum ElicitationState {\n\tPending = 'pending',\n\tAccepted = 'accepted',\n\tRejected = 'rejected',\n}\n\nexport interface IChatElicitationRequest {\n\tkind: 'elicitation2'; // '2' because initially serialized data used the same kind\n\ttitle: string | IMarkdownString;\n\tmessage: string | IMarkdownString;\n\tacceptButtonLabel: string;\n\trejectButtonLabel: string | undefined;\n\tsubtitle?: string | IMarkdownString;\n\tsource?: ToolDataSource;\n\tstate: IObservable<ElicitationState>;\n\tacceptedResult?: Record<string, unknown>;\n\tmoreActions?: IAction[];\n\taccept(value: IAction | true): Promise<void>;\n\treject?: () => Promise<void>;\n\tisHidden?: IObservable<boolean>;\n\thide?(): void;\n}\n\nexport interface IChatElicitationRequestSerialized {\n\tkind: 'elicitationSerialized';\n\ttitle: string | IMarkdownString;\n\tmessage: string | IMarkdownString;\n\tsubtitle: string | IMarkdownString | undefined;\n\tsource: ToolDataSource | undefined;\n\tstate: ElicitationState.Accepted | ElicitationState.Rejected;\n\tisHidden: boolean;\n\tacceptedResult?: Record<string, unknown>;\n}\n\nexport interface IChatThinkingPart {\n\tkind: 'thinking';\n\tvalue?: string | string[];\n\tid?: string;\n\tmetadata?: { readonly [key: string]: any };\n}\n\nexport interface IChatTerminalToolInvocationData {\n\tkind: 'terminal';\n\tcommandLine: {\n\t\toriginal: string;\n\t\tuserEdited?: string;\n\t\ttoolEdited?: string;\n\t};\n\t/** Message for model recommending the use of an alternative tool */\n\talternativeRecommendation?: string;\n\tlanguage: string;\n\tterminalToolSessionId?: string;\n\t/** The predefined command ID that will be used for this terminal command */\n\tterminalCommandId?: string;\n\t/** Serialized URI for the command that was executed in the terminal */\n\tterminalCommandUri?: UriComponents;\n\t/** Serialized output of the executed command */\n\tterminalCommandOutput?: {\n\t\ttext: string;\n\t\ttruncated?: boolean;\n\t};\n\t/** Stored theme colors at execution time to style detached output */\n\tterminalTheme?: {\n\t\tbackground?: string;\n\t\tforeground?: string;\n\t};\n\t/** Stored command state to restore decorations after reload */\n\tterminalCommandState?: {\n\t\texitCode?: number;\n\t\ttimestamp?: number;\n\t\tduration?: number;\n\t};\n\tautoApproveInfo?: IMarkdownString;\n}\n\n/**\n * @deprecated This is the old API shape, we should support this for a while before removing it so\n * we don't break existing chats\n */\nexport interface ILegacyChatTerminalToolInvocationData {\n\tkind: 'terminal';\n\tcommand: string;\n\tlanguage: string;\n}\n\nexport interface IChatToolInputInvocationData {\n\tkind: 'input';\n\trawInput: any;\n}\n\nexport const enum ToolConfirmKind {\n\tDenied,\n\tConfirmationNotNeeded,\n\tSetting,\n\tLmServicePerTool,\n\tUserAction,\n\tSkipped\n}\n\nexport type ConfirmedReason =\n\t| { type: ToolConfirmKind.Denied }\n\t| { type: ToolConfirmKind.ConfirmationNotNeeded }\n\t| { type: ToolConfirmKind.Setting; id: string }\n\t| { type: ToolConfirmKind.LmServicePerTool; scope: 'session' | 'workspace' | 'profile' }\n\t| { type: ToolConfirmKind.UserAction }\n\t| { type: ToolConfirmKind.Skipped };\n\nexport interface IChatToolInvocation {\n\treadonly presentation: IPreparedToolInvocation['presentation'];\n\treadonly toolSpecificData?: IChatTerminalToolInvocationData | ILegacyChatTerminalToolInvocationData | IChatToolInputInvocationData | IChatExtensionsContent | IChatPullRequestContent | IChatTodoListContent;\n\treadonly confirmationMessages?: IToolConfirmationMessages;\n\treadonly originMessage: string | IMarkdownString | undefined;\n\treadonly invocationMessage: string | IMarkdownString;\n\treadonly pastTenseMessage: string | IMarkdownString | undefined;\n\treadonly source: ToolDataSource;\n\treadonly toolId: string;\n\treadonly toolCallId: string;\n\treadonly parameters: unknown;\n\treadonly fromSubAgent?: boolean;\n\treadonly state: IObservable<IChatToolInvocation.State>;\n\n\tkind: 'toolInvocation';\n}\n\nexport namespace IChatToolInvocation {\n\texport const enum StateKind {\n\t\tWaitingForConfirmation,\n\t\tExecuting,\n\t\tWaitingForPostApproval,\n\t\tCompleted,\n\t\tCancelled,\n\t}\n\n\tinterface IChatToolInvocationStateBase {\n\t\ttype: StateKind;\n\t}\n\n\tinterface IChatToolInvocationWaitingForConfirmationState extends IChatToolInvocationStateBase {\n\t\ttype: StateKind.WaitingForConfirmation;\n\t\tconfirm(reason: ConfirmedReason): void;\n\t}\n\n\tinterface IChatToolInvocationPostConfirmState {\n\t\tconfirmed: ConfirmedReason;\n\t}\n\n\tinterface IChatToolInvocationExecutingState extends IChatToolInvocationStateBase, IChatToolInvocationPostConfirmState {\n\t\ttype: StateKind.Executing;\n\t\tprogress: IObservable<{ message?: string | IMarkdownString; progress: number | undefined }>;\n\t}\n\n\tinterface IChatToolInvocationPostExecuteState extends IChatToolInvocationPostConfirmState {\n\t\tresultDetails: IToolResult['toolResultDetails'];\n\t}\n\n\tinterface IChatToolWaitingForPostApprovalState extends IChatToolInvocationStateBase, IChatToolInvocationPostExecuteState {\n\t\ttype: StateKind.WaitingForPostApproval;\n\t\tconfirm(reason: ConfirmedReason): void;\n\t\tcontentForModel: IToolResult['content'];\n\t}\n\n\tinterface IChatToolInvocationCompleteState extends IChatToolInvocationStateBase, IChatToolInvocationPostExecuteState {\n\t\ttype: StateKind.Completed;\n\t\tpostConfirmed: ConfirmedReason | undefined;\n\t\tcontentForModel: IToolResult['content'];\n\t}\n\n\tinterface IChatToolInvocationCancelledState extends IChatToolInvocationStateBase {\n\t\ttype: StateKind.Cancelled;\n\t\treason: ToolConfirmKind.Denied | ToolConfirmKind.Skipped;\n\t}\n\n\texport type State =\n\t\t| IChatToolInvocationWaitingForConfirmationState\n\t\t| IChatToolInvocationExecutingState\n\t\t| IChatToolWaitingForPostApprovalState\n\t\t| IChatToolInvocationCompleteState\n\t\t| IChatToolInvocationCancelledState;\n\n\texport function executionConfirmedOrDenied(invocation: IChatToolInvocation | IChatToolInvocationSerialized, reader?: IReader): ConfirmedReason | undefined {\n\t\tif (invocation.kind === 'toolInvocationSerialized') {\n\t\t\tif (invocation.isConfirmed === undefined || typeof invocation.isConfirmed === 'boolean') {\n\t\t\t\treturn { type: invocation.isConfirmed ? ToolConfirmKind.UserAction : ToolConfirmKind.Denied };\n\t\t\t}\n\t\t\treturn invocation.isConfirmed;\n\t\t}\n\n\t\tconst state = invocation.state.read(reader);\n\t\tif (state.type === StateKind.WaitingForConfirmation) {\n\t\t\treturn undefined; // don't know yet\n\t\t}\n\t\tif (state.type === StateKind.Cancelled) {\n\t\t\treturn { type: state.reason };\n\t\t}\n\n\t\treturn state.confirmed;\n\t}\n\n\texport function awaitConfirmation(invocation: IChatToolInvocation, token?: CancellationToken): Promise<ConfirmedReason> {\n\t\tconst reason = executionConfirmedOrDenied(invocation);\n\t\tif (reason) {\n\t\t\treturn Promise.resolve(reason);\n\t\t}\n\n\t\tconst store = new DisposableStore();\n\t\treturn new Promise<ConfirmedReason>(resolve => {\n\t\t\tif (token) {\n\t\t\t\tstore.add(token.onCancellationRequested(() => {\n\t\t\t\t\tresolve({ type: ToolConfirmKind.Denied });\n\t\t\t\t}));\n\t\t\t}\n\n\t\t\tstore.add(autorun(reader => {\n\t\t\t\tconst reason = executionConfirmedOrDenied(invocation, reader);\n\t\t\t\tif (reason) {\n\t\t\t\t\tstore.dispose();\n\t\t\t\t\tresolve(reason);\n\t\t\t\t}\n\t\t\t}));\n\t\t}).finally(() => {\n\t\t\tstore.dispose();\n\t\t});\n\t}\n\n\tfunction postApprovalConfirmedOrDenied(invocation: IChatToolInvocation, reader?: IReader): ConfirmedReason | undefined {\n\t\tconst state = invocation.state.read(reader);\n\t\tif (state.type === StateKind.Completed) {\n\t\t\treturn state.postConfirmed || { type: ToolConfirmKind.ConfirmationNotNeeded };\n\t\t}\n\t\tif (state.type === StateKind.Cancelled) {\n\t\t\treturn { type: state.reason };\n\t\t}\n\n\t\treturn undefined;\n\t}\n\n\texport function confirmWith(invocation: IChatToolInvocation | undefined, reason: ConfirmedReason) {\n\t\tconst state = invocation?.state.get();\n\t\tif (state?.type === StateKind.WaitingForConfirmation || state?.type === StateKind.WaitingForPostApproval) {\n\t\t\tstate.confirm(reason);\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\texport function awaitPostConfirmation(invocation: IChatToolInvocation, token?: CancellationToken): Promise<ConfirmedReason> {\n\t\tconst reason = postApprovalConfirmedOrDenied(invocation);\n\t\tif (reason) {\n\t\t\treturn Promise.resolve(reason);\n\t\t}\n\n\t\tconst store = new DisposableStore();\n\t\treturn new Promise<ConfirmedReason>(resolve => {\n\t\t\tif (token) {\n\t\t\t\tstore.add(token.onCancellationRequested(() => {\n\t\t\t\t\tresolve({ type: ToolConfirmKind.Denied });\n\t\t\t\t}));\n\t\t\t}\n\n\t\t\tstore.add(autorun(reader => {\n\t\t\t\tconst reason = postApprovalConfirmedOrDenied(invocation, reader);\n\t\t\t\tif (reason) {\n\t\t\t\t\tstore.dispose();\n\t\t\t\t\tresolve(reason);\n\t\t\t\t}\n\t\t\t}));\n\t\t}).finally(() => {\n\t\t\tstore.dispose();\n\t\t});\n\t}\n\n\texport function resultDetails(invocation: IChatToolInvocation | IChatToolInvocationSerialized, reader?: IReader) {\n\t\tif (invocation.kind === 'toolInvocationSerialized') {\n\t\t\treturn invocation.resultDetails;\n\t\t}\n\n\t\tconst state = invocation.state.read(reader);\n\t\tif (state.type === StateKind.Completed || state.type === StateKind.WaitingForPostApproval) {\n\t\t\treturn state.resultDetails;\n\t\t}\n\n\t\treturn undefined;\n\t}\n\n\texport function isComplete(invocation: IChatToolInvocation | IChatToolInvocationSerialized, reader?: IReader): boolean {\n\t\tif ('isComplete' in invocation) { // serialized\n\t\t\treturn true; // always cancelled or complete\n\t\t}\n\n\t\tconst state = invocation.state.read(reader);\n\t\treturn state.type === StateKind.Completed || state.type === StateKind.Cancelled;\n\t}\n}\n\n\nexport interface IToolResultOutputDetailsSerialized {\n\toutput: {\n\t\ttype: 'data';\n\t\tmimeType: string;\n\t\tbase64Data: string;\n\t};\n}\n\n/**\n * This is a IChatToolInvocation that has been serialized, like after window reload, so it is no longer an active tool invocation.\n */\nexport interface IChatToolInvocationSerialized {\n\tpresentation: IPreparedToolInvocation['presentation'];\n\ttoolSpecificData?: IChatTerminalToolInvocationData | IChatToolInputInvocationData | IChatExtensionsContent | IChatPullRequestContent | IChatTodoListContent;\n\tinvocationMessage: string | IMarkdownString;\n\toriginMessage: string | IMarkdownString | undefined;\n\tpastTenseMessage: string | IMarkdownString | undefined;\n\tresultDetails?: Array<URI | Location> | IToolResultInputOutputDetails | IToolResultOutputDetailsSerialized;\n\t/** boolean used by pre-1.104 versions */\n\tisConfirmed: ConfirmedReason | boolean | undefined;\n\tisComplete: boolean;\n\ttoolCallId: string;\n\ttoolId: string;\n\tsource: ToolDataSource;\n\treadonly fromSubAgent?: boolean;\n\tkind: 'toolInvocationSerialized';\n}\n\nexport interface IChatExtensionsContent {\n\textensions: string[];\n\tkind: 'extensions';\n}\n\nexport interface IChatPullRequestContent {\n\turi: URI;\n\ttitle: string;\n\tdescription: string;\n\tauthor: string;\n\tlinkTag: string;\n\tkind: 'pullRequest';\n}\n\nexport interface IChatTodoListContent {\n\tkind: 'todoList';\n\tsessionId: string;\n\ttodoList: Array<{\n\t\tid: string;\n\t\ttitle: string;\n\t\tdescription: string;\n\t\tstatus: 'not-started' | 'in-progress' | 'completed';\n\t}>;\n}\n\nexport interface IChatMcpServersStarting {\n\treadonly kind: 'mcpServersStarting';\n\treadonly state?: IObservable<IAutostartResult>; // not hydrated when serialized\n\tdidStartServerIds?: string[];\n}\n\nexport class ChatMcpServersStarting implements IChatMcpServersStarting {\n\tpublic readonly kind = 'mcpServersStarting';\n\n\tpublic didStartServerIds?: string[] = [];\n\n\tpublic get isEmpty() {\n\t\tconst s = this.state.get();\n\t\treturn !s.working && s.serversRequiringInteraction.length === 0;\n\t}\n\n\tconstructor(public readonly state: IObservable<IAutostartResult>) { }\n\n\twait() {\n\t\treturn new Promise<IAutostartResult>(resolve => {\n\t\t\tautorunSelfDisposable(reader => {\n\t\t\t\tconst s = this.state.read(reader);\n\t\t\t\tif (!s.working) {\n\t\t\t\t\treader.dispose();\n\t\t\t\t\tresolve(s);\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t}\n\n\ttoJSON(): IChatMcpServersStarting {\n\t\treturn { kind: 'mcpServersStarting', didStartServerIds: this.didStartServerIds };\n\t}\n}\n\nexport interface IChatPrepareToolInvocationPart {\n\treadonly kind: 'prepareToolInvocation';\n\treadonly toolName: string;\n}\n\nexport type IChatProgress =\n\t| IChatMarkdownContent\n\t| IChatAgentMarkdownContentWithVulnerability\n\t| IChatTreeData\n\t| IChatMultiDiffData\n\t| IChatUsedContext\n\t| IChatContentReference\n\t| IChatContentInlineReference\n\t| IChatCodeCitation\n\t| IChatProgressMessage\n\t| IChatTask\n\t| IChatTaskResult\n\t| IChatCommandButton\n\t| IChatWarningMessage\n\t| IChatTextEdit\n\t| IChatNotebookEdit\n\t| IChatMoveMessage\n\t| IChatResponseCodeblockUriPart\n\t| IChatConfirmation\n\t| IChatClearToPreviousToolInvocation\n\t| IChatToolInvocation\n\t| IChatToolInvocationSerialized\n\t| IChatExtensionsContent\n\t| IChatPullRequestContent\n\t| IChatUndoStop\n\t| IChatPrepareToolInvocationPart\n\t| IChatThinkingPart\n\t| IChatTaskSerialized\n\t| IChatElicitationRequest\n\t| IChatElicitationRequestSerialized\n\t| IChatMcpServersStarting;\n\nexport interface IChatFollowup {\n\tkind: 'reply';\n\tmessage: string;\n\tagentId: string;\n\tsubCommand?: string;\n\ttitle?: string;\n\ttooltip?: string;\n}\n\nexport function isChatFollowup(obj: unknown): obj is IChatFollowup {\n\treturn (\n\t\t!!obj &&\n\t\t(obj as IChatFollowup).kind === 'reply' &&\n\t\ttypeof (obj as IChatFollowup).message === 'string' &&\n\t\ttypeof (obj as IChatFollowup).agentId === 'string'\n\t);\n}\n\nexport enum ChatAgentVoteDirection {\n\tDown = 0,\n\tUp = 1\n}\n\nexport enum ChatAgentVoteDownReason {\n\tIncorrectCode = 'incorrectCode',\n\tDidNotFollowInstructions = 'didNotFollowInstructions',\n\tIncompleteCode = 'incompleteCode',\n\tMissingContext = 'missingContext',\n\tPoorlyWrittenOrFormatted = 'poorlyWrittenOrFormatted',\n\tRefusedAValidRequest = 'refusedAValidRequest',\n\tOffensiveOrUnsafe = 'offensiveOrUnsafe',\n\tOther = 'other',\n\tWillReportIssue = 'willReportIssue'\n}\n\nexport interface IChatVoteAction {\n\tkind: 'vote';\n\tdirection: ChatAgentVoteDirection;\n\treason: ChatAgentVoteDownReason | undefined;\n}\n\nexport enum ChatCopyKind {\n\t// Keyboard shortcut or context menu\n\tAction = 1,\n\tToolbar = 2\n}\n\nexport interface IChatCopyAction {\n\tkind: 'copy';\n\tcodeBlockIndex: number;\n\tcopyKind: ChatCopyKind;\n\tcopiedCharacters: number;\n\ttotalCharacters: number;\n\tcopiedText: string;\n\ttotalLines: number;\n\tcopiedLines: number;\n\tmodelId: string;\n\tlanguageId?: string;\n}\n\nexport interface IChatInsertAction {\n\tkind: 'insert';\n\tcodeBlockIndex: number;\n\ttotalCharacters: number;\n\ttotalLines: number;\n\tlanguageId?: string;\n\tmodelId: string;\n\tnewFile?: boolean;\n}\n\nexport interface IChatApplyAction {\n\tkind: 'apply';\n\tcodeBlockIndex: number;\n\ttotalCharacters: number;\n\ttotalLines: number;\n\tlanguageId?: string;\n\tmodelId: string;\n\tnewFile?: boolean;\n\tcodeMapper?: string;\n\teditsProposed: boolean;\n}\n\n\nexport interface IChatTerminalAction {\n\tkind: 'runInTerminal';\n\tcodeBlockIndex: number;\n\tlanguageId?: string;\n}\n\nexport interface IChatCommandAction {\n\tkind: 'command';\n\tcommandButton: IChatCommandButton;\n}\n\nexport interface IChatFollowupAction {\n\tkind: 'followUp';\n\tfollowup: IChatFollowup;\n}\n\nexport interface IChatBugReportAction {\n\tkind: 'bug';\n}\n\nexport interface IChatInlineChatCodeAction {\n\tkind: 'inlineChat';\n\taction: 'accepted' | 'discarded';\n}\n\n\nexport interface IChatEditingSessionAction {\n\tkind: 'chatEditingSessionAction';\n\turi: URI;\n\thasRemainingEdits: boolean;\n\toutcome: 'accepted' | 'rejected' | 'userModified';\n}\n\nexport interface IChatEditingHunkAction {\n\tkind: 'chatEditingHunkAction';\n\turi: URI;\n\tlineCount: number;\n\tlinesAdded: number;\n\tlinesRemoved: number;\n\toutcome: 'accepted' | 'rejected';\n\thasRemainingEdits: boolean;\n\tmodeId?: string;\n\tmodelId?: string;\n\tlanguageId?: string;\n}\n\nexport type ChatUserAction = IChatVoteAction | IChatCopyAction | IChatInsertAction | IChatApplyAction | IChatTerminalAction | IChatCommandAction | IChatFollowupAction | IChatBugReportAction | IChatInlineChatCodeAction | IChatEditingSessionAction | IChatEditingHunkAction;\n\nexport interface IChatUserActionEvent {\n\taction: ChatUserAction;\n\tagentId: string | undefined;\n\tcommand: string | undefined;\n\tsessionResource: URI;\n\trequestId: string;\n\tresult: IChatAgentResult | undefined;\n\tmodelId?: string | undefined;\n\tmodeId?: string | undefined;\n}\n\nexport interface IChatDynamicRequest {\n\t/**\n\t * The message that will be displayed in the UI\n\t */\n\tmessage: string;\n\n\t/**\n\t * Any extra metadata/context that will go to the provider.\n\t */\n\tmetadata?: any;\n}\n\nexport interface IChatCompleteResponse {\n\tmessage: string | ReadonlyArray<IChatProgress>;\n\tresult?: IChatAgentResult;\n\tfollowups?: IChatFollowup[];\n}\n\nexport interface IChatDetail {\n\tsessionResource: URI;\n\ttitle: string;\n\tlastMessageDate: number;\n\tisActive: boolean;\n}\n\nexport interface IChatProviderInfo {\n\tid: string;\n}\n\nexport interface IChatTransferredSessionData {\n\tsessionId: string;\n\tlocation: ChatAgentLocation;\n\tinputState: IChatModelInputState | undefined;\n}\n\nexport interface IChatSendRequestResponseState {\n\tresponseCreatedPromise: Promise<IChatResponseModel>;\n\tresponseCompletePromise: Promise<void>;\n}\n\nexport interface IChatSendRequestData extends IChatSendRequestResponseState {\n\tagent: IChatAgentData;\n\tslashCommand?: IChatAgentCommand;\n}\n\nexport interface IChatEditorLocationData {\n\ttype: ChatAgentLocation.EditorInline;\n\tdocument: URI;\n\tselection: ISelection;\n\twholeRange: IRange;\n\tclose: () => void;\n\tdelegateSessionResource: URI | undefined;\n}\n\nexport interface IChatNotebookLocationData {\n\ttype: ChatAgentLocation.Notebook;\n\tsessionInputUri: URI;\n}\n\nexport interface IChatTerminalLocationData {\n\ttype: ChatAgentLocation.Terminal;\n\t// TBD\n}\n\nexport type IChatLocationData = IChatEditorLocationData | IChatNotebookLocationData | IChatTerminalLocationData;\n\nexport interface IChatSendRequestOptions {\n\tmodeInfo?: IChatRequestModeInfo;\n\tuserSelectedModelId?: string;\n\tuserSelectedTools?: IObservable<UserSelectedTools>;\n\tlocation?: ChatAgentLocation;\n\tlocationData?: IChatLocationData;\n\tparserContext?: IChatParserContext;\n\tattempt?: number;\n\tnoCommandDetection?: boolean;\n\tacceptedConfirmationData?: any[];\n\trejectedConfirmationData?: any[];\n\tattachedContext?: IChatRequestVariableEntry[];\n\n\t/** The target agent ID can be specified with this property instead of using @ in 'message' */\n\tagentId?: string;\n\t/** agentId, but will not add a @ name to the request */\n\tagentIdSilent?: string;\n\tslashCommand?: string;\n\n\t/**\n\t * The label of the confirmation action that was selected.\n\t */\n\tconfirmation?: string;\n\n}\n\nexport const IChatService = createDecorator<IChatService>('IChatService');\n\nexport interface IChatService {\n\t_serviceBrand: undefined;\n\ttransferredSessionData: IChatTransferredSessionData | undefined;\n\n\treadonly onDidSubmitRequest: Event<{ readonly chatSessionResource: URI }>;\n\n\tisEnabled(location: ChatAgentLocation): boolean;\n\thasSessions(): boolean;\n\tstartSession(location: ChatAgentLocation, token: CancellationToken, options?: { canUseTools?: boolean }): ChatModel;\n\tgetSession(sessionResource: URI): IChatModel | undefined;\n\tgetOrRestoreSession(sessionResource: URI): Promise<IChatModel | undefined>;\n\tgetPersistedSessionTitle(sessionResource: URI): string | undefined;\n\tisPersistedSessionEmpty(sessionResource: URI): boolean;\n\tloadSessionFromContent(data: IExportableChatData | ISerializableChatData | URI): IChatModel | undefined;\n\tloadSessionForResource(resource: URI, location: ChatAgentLocation, token: CancellationToken): Promise<IChatModel | undefined>;\n\treadonly editingSessions: IChatEditingSession[];\n\tgetChatSessionFromInternalUri(sessionResource: URI): IChatSessionContext | undefined;\n\n\t/**\n\t * Returns whether the request was accepted.`\n\t */\n\tsendRequest(sessionResource: URI, message: string, options?: IChatSendRequestOptions): Promise<IChatSendRequestData | undefined>;\n\n\t/**\n\t * Sets a custom title for a chat model.\n\t */\n\tsetTitle(sessionResource: URI, title: string): void;\n\tappendProgress(request: IChatRequestModel, progress: IChatProgress): void;\n\tresendRequest(request: IChatRequestModel, options?: IChatSendRequestOptions): Promise<void>;\n\tadoptRequest(sessionResource: URI, request: IChatRequestModel): Promise<void>;\n\tremoveRequest(sessionResource: URI, requestId: string): Promise<void>;\n\tcancelCurrentRequestForSession(sessionResource: URI): void;\n\tclearSession(sessionResource: URI): Promise<void>;\n\taddCompleteRequest(sessionResource: URI, message: IParsedChatRequest | string, variableData: IChatRequestVariableData | undefined, attempt: number | undefined, response: IChatCompleteResponse): void;\n\tsetChatSessionTitle(sessionResource: URI, title: string): void;\n\tgetLocalSessionHistory(): Promise<IChatDetail[]>;\n\tclearAllHistoryEntries(): Promise<void>;\n\tremoveHistoryEntry(sessionResource: URI): Promise<void>;\n\tgetChatStorageFolder(): URI;\n\tlogChatIndex(): void;\n\tgetLiveSessionItems(): IChatDetail[];\n\tgetHistorySessionItems(): Promise<IChatDetail[]>;\n\n\treadonly onDidPerformUserAction: Event<IChatUserActionEvent>;\n\tnotifyUserAction(event: IChatUserActionEvent): void;\n\treadonly onDidDisposeSession: Event<{ readonly sessionResource: URI; readonly reason: 'cleared' }>;\n\n\ttransferChatSession(transferredSessionData: IChatTransferredSessionData, toWorkspace: URI): void;\n\n\tactivateDefaultAgent(location: ChatAgentLocation): Promise<void>;\n\n\treadonly edits2Enabled: boolean;\n\n\treadonly requestInProgressObs: IObservable<boolean>;\n}\n\nexport interface IChatSessionContext {\n\treadonly chatSessionType: string;\n\treadonly chatSessionResource: URI;\n\treadonly isUntitled: boolean;\n}\n\nexport const KEYWORD_ACTIVIATION_SETTING_ID = 'accessibility.voice.keywordActivation';\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { IAction } from '../../../../base/common/actions.js';\nimport { DeferredPromise } from '../../../../base/common/async.js';\nimport { CancellationToken } from '../../../../base/common/cancellation.js';\nimport { Event } from '../../../../base/common/event.js';\nimport { IMarkdownString } from '../../../../base/common/htmlContent.js';\nimport { DisposableStore } from '../../../../base/common/lifecycle.js';\nimport { autorun, autorunSelfDisposable, IObservable, IReader } from '../../../../base/common/observable.js';\nimport { ThemeIcon } from '../../../../base/common/themables.js';\nimport { URI, UriComponents } from '../../../../base/common/uri.js';\nimport { IRange, Range } from '../../../../editor/common/core/range.js';\nimport { ISelection } from '../../../../editor/common/core/selection.js';\nimport { Command, Location, TextEdit } from '../../../../editor/common/languages.js';\nimport { FileType } from '../../../../platform/files/common/files.js';\nimport { createDecorator } from '../../../../platform/instantiation/common/instantiation.js';\nimport { IAutostartResult } from '../../mcp/common/mcpTypes.js';\nimport { ICellEditOperation } from '../../notebook/common/notebookCommon.js';\nimport { IWorkspaceSymbol } from '../../search/common/search.js';\nimport { IChatAgentCommand, IChatAgentData, IChatAgentResult, UserSelectedTools } from './chatAgents.js';\nimport { IChatEditingSession } from './chatEditingService.js';\nimport { ChatModel, IChatModel, IChatModelInputState, IChatRequestModeInfo, IChatRequestModel, IChatRequestVariableData, IChatResponseModel, IExportableChatData, ISerializableChatData } from './chatModel.js';\nimport { IParsedChatRequest } from './chatParserTypes.js';\nimport { IChatParserContext } from './chatRequestParser.js';\nimport { IChatRequestVariableEntry } from './chatVariableEntries.js';\nimport { IChatRequestVariableValue } from './chatVariables.js';\nimport { ChatAgentLocation } from './constants.js';\nimport { IPreparedToolInvocation, IToolConfirmationMessages, IToolResult, IToolResultInputOutputDetails, ToolDataSource } from './languageModelToolsService.js';\n\nexport interface IChatRequest {\n\tmessage: string;\n\tvariables: Record<string, IChatRequestVariableValue[]>;\n}\n\nexport enum ChatErrorLevel {\n\tInfo = 0,\n\tWarning = 1,\n\tError = 2\n}\n\nexport interface IChatResponseErrorDetailsConfirmationButton {\n\tdata: any;\n\tlabel: string;\n\tisSecondary?: boolean;\n}\n\nexport interface IChatResponseErrorDetails {\n\tmessage: string;\n\tresponseIsIncomplete?: boolean;\n\tresponseIsFiltered?: boolean;\n\tresponseIsRedacted?: boolean;\n\tisQuotaExceeded?: boolean;\n\tisRateLimited?: boolean;\n\tlevel?: ChatErrorLevel;\n\tconfirmationButtons?: IChatResponseErrorDetailsConfirmationButton[];\n\tcode?: string;\n}\n\nexport interface IChatResponseProgressFileTreeData {\n\tlabel: string;\n\turi: URI;\n\ttype?: FileType;\n\tchildren?: IChatResponseProgressFileTreeData[];\n}\n\nexport type IDocumentContext = {\n\turi: URI;\n\tversion: number;\n\tranges: IRange[];\n};\n\nexport function isIDocumentContext(obj: unknown): obj is IDocumentContext {\n\treturn (\n\t\t!!obj &&\n\t\ttypeof obj === 'object' &&\n\t\t'uri' in obj && obj.uri instanceof URI &&\n\t\t'version' in obj && typeof obj.version === 'number' &&\n\t\t'ranges' in obj && Array.isArray(obj.ranges) && obj.ranges.every(Range.isIRange)\n\t);\n}\n\nexport interface IChatUsedContext {\n\tdocuments: IDocumentContext[];\n\tkind: 'usedContext';\n}\n\nexport function isIUsedContext(obj: unknown): obj is IChatUsedContext {\n\treturn (\n\t\t!!obj &&\n\t\ttypeof obj === 'object' &&\n\t\t'documents' in obj &&\n\t\tArray.isArray(obj.documents) &&\n\t\tobj.documents.every(isIDocumentContext)\n\t);\n}\n\nexport interface IChatContentVariableReference {\n\tvariableName: string;\n\tvalue?: URI | Location;\n}\n\nexport enum ChatResponseReferencePartStatusKind {\n\tComplete = 1,\n\tPartial = 2,\n\tOmitted = 3\n}\n\nexport enum ChatResponseClearToPreviousToolInvocationReason {\n\tNoReason = 0,\n\tFilteredContentRetry = 1,\n\tCopyrightContentRetry = 2,\n}\n\nexport interface IChatContentReference {\n\treference: URI | Location | IChatContentVariableReference | string;\n\ticonPath?: ThemeIcon | { light: URI; dark?: URI };\n\toptions?: {\n\t\tstatus?: { description: string; kind: ChatResponseReferencePartStatusKind };\n\t\tdiffMeta?: { added: number; removed: number };\n\t};\n\tkind: 'reference';\n}\n\nexport interface IChatChangesSummary {\n\treadonly reference: URI;\n\treadonly sessionId: string;\n\treadonly requestId: string;\n\treadonly kind: 'changesSummary';\n}\n\nexport interface IChatCodeCitation {\n\tvalue: URI;\n\tlicense: string;\n\tsnippet: string;\n\tkind: 'codeCitation';\n}\n\nexport interface IChatContentInlineReference {\n\tresolveId?: string;\n\tinlineReference: URI | Location | IWorkspaceSymbol;\n\tname?: string;\n\tkind: 'inlineReference';\n}\n\nexport interface IChatMarkdownContent {\n\tkind: 'markdownContent';\n\tcontent: IMarkdownString;\n\tinlineReferences?: Record<string, IChatContentInlineReference>;\n\tfromSubagent?: boolean;\n}\n\nexport interface IChatTreeData {\n\ttreeData: IChatResponseProgressFileTreeData;\n\tkind: 'treeData';\n}\nexport interface IChatMultiDiffData {\n\tmultiDiffData: {\n\t\ttitle: string;\n\t\tresources: Array<{\n\t\t\toriginalUri?: URI;\n\t\t\tmodifiedUri?: URI;\n\t\t\tgoToFileUri?: URI;\n\t\t\tadded?: number;\n\t\t\tremoved?: number;\n\t\t}>;\n\t};\n\tkind: 'multiDiffData';\n\treadOnly?: boolean;\n}\n\nexport interface IChatProgressMessage {\n\tcontent: IMarkdownString;\n\tkind: 'progressMessage';\n}\n\nexport interface IChatTask extends IChatTaskDto {\n\tdeferred: DeferredPromise<string | void>;\n\tprogress: (IChatWarningMessage | IChatContentReference)[];\n\treadonly onDidAddProgress: Event<IChatWarningMessage | IChatContentReference>;\n\tadd(progress: IChatWarningMessage | IChatContentReference): void;\n\n\tcomplete: (result: string | void) => void;\n\ttask: () => Promise<string | void>;\n\tisSettled: () => boolean;\n}\n\nexport interface IChatUndoStop {\n\tkind: 'undoStop';\n\tid: string;\n}\n\nexport interface IChatExternalEditsDto {\n\tkind: 'externalEdits';\n\tstart: boolean; /** true=start, false=stop */\n\tresources: UriComponents[];\n}\n\nexport interface IChatTaskDto {\n\tcontent: IMarkdownString;\n\tkind: 'progressTask';\n}\n\nexport interface IChatTaskSerialized {\n\tcontent: IMarkdownString;\n\tprogress: (IChatWarningMessage | IChatContentReference)[];\n\tkind: 'progressTaskSerialized';\n}\n\nexport interface IChatTaskResult {\n\tcontent: IMarkdownString | void;\n\tkind: 'progressTaskResult';\n}\n\nexport interface IChatWarningMessage {\n\tcontent: IMarkdownString;\n\tkind: 'warning';\n}\n\nexport interface IChatAgentVulnerabilityDetails {\n\ttitle: string;\n\tdescription: string;\n}\n\nexport interface IChatResponseCodeblockUriPart {\n\tkind: 'codeblockUri';\n\turi: URI;\n\tisEdit?: boolean;\n}\n\nexport interface IChatAgentMarkdownContentWithVulnerability {\n\tcontent: IMarkdownString;\n\tvulnerabilities: IChatAgentVulnerabilityDetails[];\n\tkind: 'markdownVuln';\n}\n\nexport interface IChatCommandButton {\n\tcommand: Command;\n\tkind: 'command';\n}\n\nexport interface IChatMoveMessage {\n\turi: URI;\n\trange: IRange;\n\tkind: 'move';\n}\n\nexport interface IChatTextEdit {\n\turi: URI;\n\tedits: TextEdit[];\n\tkind: 'textEdit';\n\tdone?: boolean;\n\tisExternalEdit?: boolean;\n}\n\nexport interface IChatClearToPreviousToolInvocation {\n\tkind: 'clearToPreviousToolInvocation';\n\treason: ChatResponseClearToPreviousToolInvocationReason;\n}\n\nexport interface IChatNotebookEdit {\n\turi: URI;\n\tedits: ICellEditOperation[];\n\tkind: 'notebookEdit';\n\tdone?: boolean;\n\tisExternalEdit?: boolean;\n}\n\nexport interface IChatConfirmation {\n\ttitle: string;\n\tmessage: string | IMarkdownString;\n\tdata: any;\n\t/** Indicates whether this came from a current chat session (true/undefined) or a restored historic session (false) */\n\tisLive?: boolean;\n\tbuttons?: string[];\n\tisUsed?: boolean;\n\tkind: 'confirmation';\n}\n\nexport const enum ElicitationState {\n\tPending = 'pending',\n\tAccepted = 'accepted',\n\tRejected = 'rejected',\n}\n\nexport interface IChatElicitationRequest {\n\tkind: 'elicitation2'; // '2' because initially serialized data used the same kind\n\ttitle: string | IMarkdownString;\n\tmessage: string | IMarkdownString;\n\tacceptButtonLabel: string;\n\trejectButtonLabel: string | undefined;\n\tsubtitle?: string | IMarkdownString;\n\tsource?: ToolDataSource;\n\tstate: IObservable<ElicitationState>;\n\tacceptedResult?: Record<string, unknown>;\n\tmoreActions?: IAction[];\n\taccept(value: IAction | true): Promise<void>;\n\treject?: () => Promise<void>;\n\tisHidden?: IObservable<boolean>;\n\thide?(): void;\n}\n\nexport interface IChatElicitationRequestSerialized {\n\tkind: 'elicitationSerialized';\n\ttitle: string | IMarkdownString;\n\tmessage: string | IMarkdownString;\n\tsubtitle: string | IMarkdownString | undefined;\n\tsource: ToolDataSource | undefined;\n\tstate: ElicitationState.Accepted | ElicitationState.Rejected;\n\tisHidden: boolean;\n\tacceptedResult?: Record<string, unknown>;\n}\n\nexport interface IChatThinkingPart {\n\tkind: 'thinking';\n\tvalue?: string | string[];\n\tid?: string;\n\tmetadata?: { readonly [key: string]: any };\n}\n\nexport interface IChatTerminalToolInvocationData {\n\tkind: 'terminal';\n\tcommandLine: {\n\t\toriginal: string;\n\t\tuserEdited?: string;\n\t\ttoolEdited?: string;\n\t};\n\t/** Message for model recommending the use of an alternative tool */\n\talternativeRecommendation?: string;\n\tlanguage: string;\n\tterminalToolSessionId?: string;\n\t/** The predefined command ID that will be used for this terminal command */\n\tterminalCommandId?: string;\n\t/** Serialized URI for the command that was executed in the terminal */\n\tterminalCommandUri?: UriComponents;\n\t/** Serialized output of the executed command */\n\tterminalCommandOutput?: {\n\t\ttext: string;\n\t\ttruncated?: boolean;\n\t};\n\t/** Stored theme colors at execution time to style detached output */\n\tterminalTheme?: {\n\t\tbackground?: string;\n\t\tforeground?: string;\n\t};\n\t/** Stored command state to restore decorations after reload */\n\tterminalCommandState?: {\n\t\texitCode?: number;\n\t\ttimestamp?: number;\n\t\tduration?: number;\n\t};\n\tautoApproveInfo?: IMarkdownString;\n}\n\n/**\n * @deprecated This is the old API shape, we should support this for a while before removing it so\n * we don't break existing chats\n */\nexport interface ILegacyChatTerminalToolInvocationData {\n\tkind: 'terminal';\n\tcommand: string;\n\tlanguage: string;\n}\n\nexport interface IChatToolInputInvocationData {\n\tkind: 'input';\n\trawInput: any;\n}\n\nexport const enum ToolConfirmKind {\n\tDenied,\n\tConfirmationNotNeeded,\n\tSetting,\n\tLmServicePerTool,\n\tUserAction,\n\tSkipped\n}\n\nexport type ConfirmedReason =\n\t| { type: ToolConfirmKind.Denied }\n\t| { type: ToolConfirmKind.ConfirmationNotNeeded }\n\t| { type: ToolConfirmKind.Setting; id: string }\n\t| { type: ToolConfirmKind.LmServicePerTool; scope: 'session' | 'workspace' | 'profile' }\n\t| { type: ToolConfirmKind.UserAction }\n\t| { type: ToolConfirmKind.Skipped };\n\nexport interface IChatToolInvocation {\n\treadonly presentation: IPreparedToolInvocation['presentation'];\n\treadonly toolSpecificData?: IChatTerminalToolInvocationData | ILegacyChatTerminalToolInvocationData | IChatToolInputInvocationData | IChatExtensionsContent | IChatPullRequestContent | IChatTodoListContent;\n\treadonly confirmationMessages?: IToolConfirmationMessages;\n\treadonly originMessage: string | IMarkdownString | undefined;\n\treadonly invocationMessage: string | IMarkdownString;\n\treadonly pastTenseMessage: string | IMarkdownString | undefined;\n\treadonly source: ToolDataSource;\n\treadonly toolId: string;\n\treadonly toolCallId: string;\n\treadonly parameters: unknown;\n\treadonly fromSubAgent?: boolean;\n\treadonly state: IObservable<IChatToolInvocation.State>;\n\n\tkind: 'toolInvocation';\n}\n\nexport namespace IChatToolInvocation {\n\texport const enum StateKind {\n\t\tWaitingForConfirmation,\n\t\tExecuting,\n\t\tWaitingForPostApproval,\n\t\tCompleted,\n\t\tCancelled,\n\t}\n\n\tinterface IChatToolInvocationStateBase {\n\t\ttype: StateKind;\n\t}\n\n\tinterface IChatToolInvocationWaitingForConfirmationState extends IChatToolInvocationStateBase {\n\t\ttype: StateKind.WaitingForConfirmation;\n\t\tconfirm(reason: ConfirmedReason): void;\n\t}\n\n\tinterface IChatToolInvocationPostConfirmState {\n\t\tconfirmed: ConfirmedReason;\n\t}\n\n\tinterface IChatToolInvocationExecutingState extends IChatToolInvocationStateBase, IChatToolInvocationPostConfirmState {\n\t\ttype: StateKind.Executing;\n\t\tprogress: IObservable<{ message?: string | IMarkdownString; progress: number | undefined }>;\n\t}\n\n\tinterface IChatToolInvocationPostExecuteState extends IChatToolInvocationPostConfirmState {\n\t\tresultDetails: IToolResult['toolResultDetails'];\n\t}\n\n\tinterface IChatToolWaitingForPostApprovalState extends IChatToolInvocationStateBase, IChatToolInvocationPostExecuteState {\n\t\ttype: StateKind.WaitingForPostApproval;\n\t\tconfirm(reason: ConfirmedReason): void;\n\t\tcontentForModel: IToolResult['content'];\n\t}\n\n\tinterface IChatToolInvocationCompleteState extends IChatToolInvocationStateBase, IChatToolInvocationPostExecuteState {\n\t\ttype: StateKind.Completed;\n\t\tpostConfirmed: ConfirmedReason | undefined;\n\t\tcontentForModel: IToolResult['content'];\n\t}\n\n\tinterface IChatToolInvocationCancelledState extends IChatToolInvocationStateBase {\n\t\ttype: StateKind.Cancelled;\n\t\treason: ToolConfirmKind.Denied | ToolConfirmKind.Skipped;\n\t}\n\n\texport type State =\n\t\t| IChatToolInvocationWaitingForConfirmationState\n\t\t| IChatToolInvocationExecutingState\n\t\t| IChatToolWaitingForPostApprovalState\n\t\t| IChatToolInvocationCompleteState\n\t\t| IChatToolInvocationCancelledState;\n\n\texport function executionConfirmedOrDenied(invocation: IChatToolInvocation | IChatToolInvocationSerialized, reader?: IReader): ConfirmedReason | undefined {\n\t\tif (invocation.kind === 'toolInvocationSerialized') {\n\t\t\tif (invocation.isConfirmed === undefined || typeof invocation.isConfirmed === 'boolean') {\n\t\t\t\treturn { type: invocation.isConfirmed ? ToolConfirmKind.UserAction : ToolConfirmKind.Denied };\n\t\t\t}\n\t\t\treturn invocation.isConfirmed;\n\t\t}\n\n\t\tconst state = invocation.state.read(reader);\n\t\tif (state.type === StateKind.WaitingForConfirmation) {\n\t\t\treturn undefined; // don't know yet\n\t\t}\n\t\tif (state.type === StateKind.Cancelled) {\n\t\t\treturn { type: state.reason };\n\t\t}\n\n\t\treturn state.confirmed;\n\t}\n\n\texport function awaitConfirmation(invocation: IChatToolInvocation, token?: CancellationToken): Promise<ConfirmedReason> {\n\t\tconst reason = executionConfirmedOrDenied(invocation);\n\t\tif (reason) {\n\t\t\treturn Promise.resolve(reason);\n\t\t}\n\n\t\tconst store = new DisposableStore();\n\t\treturn new Promise<ConfirmedReason>(resolve => {\n\t\t\tif (token) {\n\t\t\t\tstore.add(token.onCancellationRequested(() => {\n\t\t\t\t\tresolve({ type: ToolConfirmKind.Denied });\n\t\t\t\t}));\n\t\t\t}\n\n\t\t\tstore.add(autorun(reader => {\n\t\t\t\tconst reason = executionConfirmedOrDenied(invocation, reader);\n\t\t\t\tif (reason) {\n\t\t\t\t\tstore.dispose();\n\t\t\t\t\tresolve(reason);\n\t\t\t\t}\n\t\t\t}));\n\t\t}).finally(() => {\n\t\t\tstore.dispose();\n\t\t});\n\t}\n\n\tfunction postApprovalConfirmedOrDenied(invocation: IChatToolInvocation, reader?: IReader): ConfirmedReason | undefined {\n\t\tconst state = invocation.state.read(reader);\n\t\tif (state.type === StateKind.Completed) {\n\t\t\treturn state.postConfirmed || { type: ToolConfirmKind.ConfirmationNotNeeded };\n\t\t}\n\t\tif (state.type === StateKind.Cancelled) {\n\t\t\treturn { type: state.reason };\n\t\t}\n\n\t\treturn undefined;\n\t}\n\n\texport function confirmWith(invocation: IChatToolInvocation | undefined, reason: ConfirmedReason) {\n\t\tconst state = invocation?.state.get();\n\t\tif (state?.type === StateKind.WaitingForConfirmation || state?.type === StateKind.WaitingForPostApproval) {\n\t\t\tstate.confirm(reason);\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\texport function awaitPostConfirmation(invocation: IChatToolInvocation, token?: CancellationToken): Promise<ConfirmedReason> {\n\t\tconst reason = postApprovalConfirmedOrDenied(invocation);\n\t\tif (reason) {\n\t\t\treturn Promise.resolve(reason);\n\t\t}\n\n\t\tconst store = new DisposableStore();\n\t\treturn new Promise<ConfirmedReason>(resolve => {\n\t\t\tif (token) {\n\t\t\t\tstore.add(token.onCancellationRequested(() => {\n\t\t\t\t\tresolve({ type: ToolConfirmKind.Denied });\n\t\t\t\t}));\n\t\t\t}\n\n\t\t\tstore.add(autorun(reader => {\n\t\t\t\tconst reason = postApprovalConfirmedOrDenied(invocation, reader);\n\t\t\t\tif (reason) {\n\t\t\t\t\tstore.dispose();\n\t\t\t\t\tresolve(reason);\n\t\t\t\t}\n\t\t\t}));\n\t\t}).finally(() => {\n\t\t\tstore.dispose();\n\t\t});\n\t}\n\n\texport function resultDetails(invocation: IChatToolInvocation | IChatToolInvocationSerialized, reader?: IReader) {\n\t\tif (invocation.kind === 'toolInvocationSerialized') {\n\t\t\treturn invocation.resultDetails;\n\t\t}\n\n\t\tconst state = invocation.state.read(reader);\n\t\tif (state.type === StateKind.Completed || state.type === StateKind.WaitingForPostApproval) {\n\t\t\treturn state.resultDetails;\n\t\t}\n\n\t\treturn undefined;\n\t}\n\n\texport function isComplete(invocation: IChatToolInvocation | IChatToolInvocationSerialized, reader?: IReader): boolean {\n\t\tif ('isComplete' in invocation) { // serialized\n\t\t\treturn true; // always cancelled or complete\n\t\t}\n\n\t\tconst state = invocation.state.read(reader);\n\t\treturn state.type === StateKind.Completed || state.type === StateKind.Cancelled;\n\t}\n}\n\n\nexport interface IToolResultOutputDetailsSerialized {\n\toutput: {\n\t\ttype: 'data';\n\t\tmimeType: string;\n\t\tbase64Data: string;\n\t};\n}\n\n/**\n * This is a IChatToolInvocation that has been serialized, like after window reload, so it is no longer an active tool invocation.\n */\nexport interface IChatToolInvocationSerialized {\n\tpresentation: IPreparedToolInvocation['presentation'];\n\ttoolSpecificData?: IChatTerminalToolInvocationData | IChatToolInputInvocationData | IChatExtensionsContent | IChatPullRequestContent | IChatTodoListContent;\n\tinvocationMessage: string | IMarkdownString;\n\toriginMessage: string | IMarkdownString | undefined;\n\tpastTenseMessage: string | IMarkdownString | undefined;\n\tresultDetails?: Array<URI | Location> | IToolResultInputOutputDetails | IToolResultOutputDetailsSerialized;\n\t/** boolean used by pre-1.104 versions */\n\tisConfirmed: ConfirmedReason | boolean | undefined;\n\tisComplete: boolean;\n\ttoolCallId: string;\n\ttoolId: string;\n\tsource: ToolDataSource;\n\treadonly fromSubAgent?: boolean;\n\tkind: 'toolInvocationSerialized';\n}\n\nexport interface IChatExtensionsContent {\n\textensions: string[];\n\tkind: 'extensions';\n}\n\nexport interface IChatPullRequestContent {\n\turi: URI;\n\ttitle: string;\n\tdescription: string;\n\tauthor: string;\n\tlinkTag: string;\n\tkind: 'pullRequest';\n}\n\nexport interface IChatTodoListContent {\n\tkind: 'todoList';\n\tsessionId: string;\n\ttodoList: Array<{\n\t\tid: string;\n\t\ttitle: string;\n\t\tdescription: string;\n\t\tstatus: 'not-started' | 'in-progress' | 'completed';\n\t}>;\n}\n\nexport interface IChatMcpServersStarting {\n\treadonly kind: 'mcpServersStarting';\n\treadonly state?: IObservable<IAutostartResult>; // not hydrated when serialized\n\tdidStartServerIds?: string[];\n}\n\nexport class ChatMcpServersStarting implements IChatMcpServersStarting {\n\tpublic readonly kind = 'mcpServersStarting';\n\n\tpublic didStartServerIds?: string[] = [];\n\n\tpublic get isEmpty() {\n\t\tconst s = this.state.get();\n\t\treturn !s.working && s.serversRequiringInteraction.length === 0;\n\t}\n\n\tconstructor(public readonly state: IObservable<IAutostartResult>) { }\n\n\twait() {\n\t\treturn new Promise<IAutostartResult>(resolve => {\n\t\t\tautorunSelfDisposable(reader => {\n\t\t\t\tconst s = this.state.read(reader);\n\t\t\t\tif (!s.working) {\n\t\t\t\t\treader.dispose();\n\t\t\t\t\tresolve(s);\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t}\n\n\ttoJSON(): IChatMcpServersStarting {\n\t\treturn { kind: 'mcpServersStarting', didStartServerIds: this.didStartServerIds };\n\t}\n}\n\nexport interface IChatPrepareToolInvocationPart {\n\treadonly kind: 'prepareToolInvocation';\n\treadonly toolName: string;\n}\n\nexport type IChatProgress =\n\t| IChatMarkdownContent\n\t| IChatAgentMarkdownContentWithVulnerability\n\t| IChatTreeData\n\t| IChatMultiDiffData\n\t| IChatUsedContext\n\t| IChatContentReference\n\t| IChatContentInlineReference\n\t| IChatCodeCitation\n\t| IChatProgressMessage\n\t| IChatTask\n\t| IChatTaskResult\n\t| IChatCommandButton\n\t| IChatWarningMessage\n\t| IChatTextEdit\n\t| IChatNotebookEdit\n\t| IChatMoveMessage\n\t| IChatResponseCodeblockUriPart\n\t| IChatConfirmation\n\t| IChatClearToPreviousToolInvocation\n\t| IChatToolInvocation\n\t| IChatToolInvocationSerialized\n\t| IChatExtensionsContent\n\t| IChatPullRequestContent\n\t| IChatUndoStop\n\t| IChatPrepareToolInvocationPart\n\t| IChatThinkingPart\n\t| IChatTaskSerialized\n\t| IChatElicitationRequest\n\t| IChatElicitationRequestSerialized\n\t| IChatMcpServersStarting;\n\nexport interface IChatFollowup {\n\tkind: 'reply';\n\tmessage: string;\n\tagentId: string;\n\tsubCommand?: string;\n\ttitle?: string;\n\ttooltip?: string;\n}\n\nexport function isChatFollowup(obj: unknown): obj is IChatFollowup {\n\treturn (\n\t\t!!obj &&\n\t\t(obj as IChatFollowup).kind === 'reply' &&\n\t\ttypeof (obj as IChatFollowup).message === 'string' &&\n\t\ttypeof (obj as IChatFollowup).agentId === 'string'\n\t);\n}\n\nexport enum ChatAgentVoteDirection {\n\tDown = 0,\n\tUp = 1\n}\n\nexport enum ChatAgentVoteDownReason {\n\tIncorrectCode = 'incorrectCode',\n\tDidNotFollowInstructions = 'didNotFollowInstructions',\n\tIncompleteCode = 'incompleteCode',\n\tMissingContext = 'missingContext',\n\tPoorlyWrittenOrFormatted = 'poorlyWrittenOrFormatted',\n\tRefusedAValidRequest = 'refusedAValidRequest',\n\tOffensiveOrUnsafe = 'offensiveOrUnsafe',\n\tOther = 'other',\n\tWillReportIssue = 'willReportIssue'\n}\n\nexport interface IChatVoteAction {\n\tkind: 'vote';\n\tdirection: ChatAgentVoteDirection;\n\treason: ChatAgentVoteDownReason | undefined;\n}\n\nexport enum ChatCopyKind {\n\t// Keyboard shortcut or context menu\n\tAction = 1,\n\tToolbar = 2\n}\n\nexport interface IChatCopyAction {\n\tkind: 'copy';\n\tcodeBlockIndex: number;\n\tcopyKind: ChatCopyKind;\n\tcopiedCharacters: number;\n\ttotalCharacters: number;\n\tcopiedText: string;\n\ttotalLines: number;\n\tcopiedLines: number;\n\tmodelId: string;\n\tlanguageId?: string;\n}\n\nexport interface IChatInsertAction {\n\tkind: 'insert';\n\tcodeBlockIndex: number;\n\ttotalCharacters: number;\n\ttotalLines: number;\n\tlanguageId?: string;\n\tmodelId: string;\n\tnewFile?: boolean;\n}\n\nexport interface IChatApplyAction {\n\tkind: 'apply';\n\tcodeBlockIndex: number;\n\ttotalCharacters: number;\n\ttotalLines: number;\n\tlanguageId?: string;\n\tmodelId: string;\n\tnewFile?: boolean;\n\tcodeMapper?: string;\n\teditsProposed: boolean;\n}\n\n\nexport interface IChatTerminalAction {\n\tkind: 'runInTerminal';\n\tcodeBlockIndex: number;\n\tlanguageId?: string;\n}\n\nexport interface IChatCommandAction {\n\tkind: 'command';\n\tcommandButton: IChatCommandButton;\n}\n\nexport interface IChatFollowupAction {\n\tkind: 'followUp';\n\tfollowup: IChatFollowup;\n}\n\nexport interface IChatBugReportAction {\n\tkind: 'bug';\n}\n\nexport interface IChatInlineChatCodeAction {\n\tkind: 'inlineChat';\n\taction: 'accepted' | 'discarded';\n}\n\n\nexport interface IChatEditingSessionAction {\n\tkind: 'chatEditingSessionAction';\n\turi: URI;\n\thasRemainingEdits: boolean;\n\toutcome: 'accepted' | 'rejected' | 'userModified';\n}\n\nexport interface IChatEditingHunkAction {\n\tkind: 'chatEditingHunkAction';\n\turi: URI;\n\tlineCount: number;\n\tlinesAdded: number;\n\tlinesRemoved: number;\n\toutcome: 'accepted' | 'rejected';\n\thasRemainingEdits: boolean;\n\tmodeId?: string;\n\tmodelId?: string;\n\tlanguageId?: string;\n}\n\nexport type ChatUserAction = IChatVoteAction | IChatCopyAction | IChatInsertAction | IChatApplyAction | IChatTerminalAction | IChatCommandAction | IChatFollowupAction | IChatBugReportAction | IChatInlineChatCodeAction | IChatEditingSessionAction | IChatEditingHunkAction;\n\nexport interface IChatUserActionEvent {\n\taction: ChatUserAction;\n\tagentId: string | undefined;\n\tcommand: string | undefined;\n\tsessionResource: URI;\n\trequestId: string;\n\tresult: IChatAgentResult | undefined;\n\tmodelId?: string | undefined;\n\tmodeId?: string | undefined;\n}\n\nexport interface IChatDynamicRequest {\n\t/**\n\t * The message that will be displayed in the UI\n\t */\n\tmessage: string;\n\n\t/**\n\t * Any extra metadata/context that will go to the provider.\n\t */\n\tmetadata?: any;\n}\n\nexport interface IChatCompleteResponse {\n\tmessage: string | ReadonlyArray<IChatProgress>;\n\tresult?: IChatAgentResult;\n\tfollowups?: IChatFollowup[];\n}\n\nexport interface IChatDetail {\n\tsessionResource: URI;\n\ttitle: string;\n\tlastMessageDate: number;\n\tisActive: boolean;\n}\n\nexport interface IChatProviderInfo {\n\tid: string;\n}\n\nexport interface IChatTransferredSessionData {\n\tsessionId: string;\n\tlocation: ChatAgentLocation;\n\tinputState: IChatModelInputState | undefined;\n}\n\nexport interface IChatSendRequestResponseState {\n\tresponseCreatedPromise: Promise<IChatResponseModel>;\n\tresponseCompletePromise: Promise<void>;\n}\n\nexport interface IChatSendRequestData extends IChatSendRequestResponseState {\n\tagent: IChatAgentData;\n\tslashCommand?: IChatAgentCommand;\n}\n\nexport interface IChatEditorLocationData {\n\ttype: ChatAgentLocation.EditorInline;\n\tdocument: URI;\n\tselection: ISelection;\n\twholeRange: IRange;\n\tclose: () => void;\n\tdelegateSessionResource: URI | undefined;\n}\n\nexport interface IChatNotebookLocationData {\n\ttype: ChatAgentLocation.Notebook;\n\tsessionInputUri: URI;\n}\n\nexport interface IChatTerminalLocationData {\n\ttype: ChatAgentLocation.Terminal;\n\t// TBD\n}\n\nexport type IChatLocationData = IChatEditorLocationData | IChatNotebookLocationData | IChatTerminalLocationData;\n\nexport interface IChatSendRequestOptions {\n\tmodeInfo?: IChatRequestModeInfo;\n\tuserSelectedModelId?: string;\n\tuserSelectedTools?: IObservable<UserSelectedTools>;\n\tlocation?: ChatAgentLocation;\n\tlocationData?: IChatLocationData;\n\tparserContext?: IChatParserContext;\n\tattempt?: number;\n\tnoCommandDetection?: boolean;\n\tacceptedConfirmationData?: any[];\n\trejectedConfirmationData?: any[];\n\tattachedContext?: IChatRequestVariableEntry[];\n\n\t/** The target agent ID can be specified with this property instead of using @ in 'message' */\n\tagentId?: string;\n\t/** agentId, but will not add a @ name to the request */\n\tagentIdSilent?: string;\n\tslashCommand?: string;\n\n\t/**\n\t * The label of the confirmation action that was selected.\n\t */\n\tconfirmation?: string;\n\n}\n\nexport const IChatService = createDecorator<IChatService>('IChatService');\n\nexport interface IChatService {\n\t_serviceBrand: undefined;\n\ttransferredSessionData: IChatTransferredSessionData | undefined;\n\n\treadonly onDidSubmitRequest: Event<{ readonly chatSessionResource: URI }>;\n\n\tisEnabled(location: ChatAgentLocation): boolean;\n\thasSessions(): boolean;\n\tstartSession(location: ChatAgentLocation, token: CancellationToken, options?: { canUseTools?: boolean }): ChatModel;\n\tgetSession(sessionResource: URI): IChatModel | undefined;\n\tgetOrRestoreSession(sessionResource: URI): Promise<IChatModel | undefined>;\n\tgetPersistedSessionTitle(sessionResource: URI): string | undefined;\n\tisPersistedSessionEmpty(sessionResource: URI): boolean;\n\tloadSessionFromContent(data: IExportableChatData | ISerializableChatData | URI): IChatModel | undefined;\n\tloadSessionForResource(resource: URI, location: ChatAgentLocation, token: CancellationToken): Promise<IChatModel | undefined>;\n\treadonly editingSessions: IChatEditingSession[];\n\tgetChatSessionFromInternalUri(sessionResource: URI): IChatSessionContext | undefined;\n\n\t/**\n\t * Returns whether the request was accepted.`\n\t */\n\tsendRequest(sessionResource: URI, message: string, options?: IChatSendRequestOptions): Promise<IChatSendRequestData | undefined>;\n\n\t/**\n\t * Sets a custom title for a chat model.\n\t */\n\tsetTitle(sessionResource: URI, title: string): void;\n\tappendProgress(request: IChatRequestModel, progress: IChatProgress): void;\n\tresendRequest(request: IChatRequestModel, options?: IChatSendRequestOptions): Promise<void>;\n\tadoptRequest(sessionResource: URI, request: IChatRequestModel): Promise<void>;\n\tremoveRequest(sessionResource: URI, requestId: string): Promise<void>;\n\tcancelCurrentRequestForSession(sessionResource: URI): void;\n\tclearSession(sessionResource: URI): Promise<void>;\n\taddCompleteRequest(sessionResource: URI, message: IParsedChatRequest | string, variableData: IChatRequestVariableData | undefined, attempt: number | undefined, response: IChatCompleteResponse): void;\n\tsetChatSessionTitle(sessionResource: URI, title: string): void;\n\tgetLocalSessionHistory(): Promise<IChatDetail[]>;\n\tclearAllHistoryEntries(): Promise<void>;\n\tremoveHistoryEntry(sessionResource: URI): Promise<void>;\n\tgetChatStorageFolder(): URI;\n\tlogChatIndex(): void;\n\tgetLiveSessionItems(): IChatDetail[];\n\tgetHistorySessionItems(): Promise<IChatDetail[]>;\n\n\treadonly onDidPerformUserAction: Event<IChatUserActionEvent>;\n\tnotifyUserAction(event: IChatUserActionEvent): void;\n\treadonly onDidDisposeSession: Event<{ readonly sessionResource: URI; readonly reason: 'cleared' }>;\n\n\ttransferChatSession(transferredSessionData: IChatTransferredSessionData, toWorkspace: URI): void;\n\n\tactivateDefaultAgent(location: ChatAgentLocation): Promise<void>;\n\n\treadonly edits2Enabled: boolean;\n\n\treadonly requestInProgressObs: IObservable<boolean>;\n}\n\nexport interface IChatSessionContext {\n\treadonly chatSessionType: string;\n\treadonly chatSessionResource: URI;\n\treadonly isUntitled: boolean;\n}\n\nexport const KEYWORD_ACTIVIATION_SETTING_ID = 'accessibility.voice.keywordActivation';\n"]}