{"version":3,"sources":["vs/workbench/contrib/chat/common/chatProgressTypes/chatToolInvocation.ts"],"names":[],"mappings":"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","file":"chatToolInvocation.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { encodeBase64 } from '../../../../../base/common/buffer.js';\nimport { IMarkdownString } from '../../../../../base/common/htmlContent.js';\nimport { IObservable, ISettableObservable, observableValue } from '../../../../../base/common/observable.js';\nimport { localize } from '../../../../../nls.js';\nimport { ConfirmedReason, IChatExtensionsContent, IChatTodoListContent, IChatToolInputInvocationData, IChatToolInvocation, IChatToolInvocationSerialized, ToolConfirmKind, type IChatTerminalToolInvocationData } from '../chatService.js';\nimport { IPreparedToolInvocation, isToolResultOutputDetails, IToolConfirmationMessages, IToolData, IToolProgressStep, IToolResult, ToolDataSource } from '../languageModelToolsService.js';\n\nexport class ChatToolInvocation implements IChatToolInvocation {\n\tpublic readonly kind: 'toolInvocation' = 'toolInvocation';\n\n\tpublic readonly invocationMessage: string | IMarkdownString;\n\tpublic readonly originMessage: string | IMarkdownString | undefined;\n\tpublic pastTenseMessage: string | IMarkdownString | undefined;\n\tpublic confirmationMessages: IToolConfirmationMessages | undefined;\n\tpublic readonly presentation: IPreparedToolInvocation['presentation'];\n\tpublic readonly toolId: string;\n\tpublic readonly source: ToolDataSource;\n\tpublic readonly fromSubAgent: boolean | undefined;\n\tpublic readonly parameters: unknown;\n\n\tpublic readonly toolSpecificData?: IChatTerminalToolInvocationData | IChatToolInputInvocationData | IChatExtensionsContent | IChatTodoListContent;\n\n\tprivate readonly _progress = observableValue<{ message?: string | IMarkdownString; progress: number | undefined }>(this, { progress: 0 });\n\tprivate readonly _state: ISettableObservable<IChatToolInvocation.State>;\n\n\tpublic get state(): IObservable<IChatToolInvocation.State> {\n\t\treturn this._state;\n\t}\n\n\n\tconstructor(preparedInvocation: IPreparedToolInvocation | undefined, toolData: IToolData, public readonly toolCallId: string, fromSubAgent: boolean | undefined, parameters: unknown) {\n\t\tconst defaultMessage = localize('toolInvocationMessage', \"Using {0}\", `\"${toolData.displayName}\"`);\n\t\tconst invocationMessage = preparedInvocation?.invocationMessage ?? defaultMessage;\n\t\tthis.invocationMessage = invocationMessage;\n\t\tthis.pastTenseMessage = preparedInvocation?.pastTenseMessage;\n\t\tthis.originMessage = preparedInvocation?.originMessage;\n\t\tthis.confirmationMessages = preparedInvocation?.confirmationMessages;\n\t\tthis.presentation = preparedInvocation?.presentation;\n\t\tthis.toolSpecificData = preparedInvocation?.toolSpecificData;\n\t\tthis.toolId = toolData.id;\n\t\tthis.source = toolData.source;\n\t\tthis.fromSubAgent = fromSubAgent;\n\t\tthis.parameters = parameters;\n\n\t\tif (!this.confirmationMessages?.title) {\n\t\t\tthis._state = observableValue(this, { type: IChatToolInvocation.StateKind.Executing, confirmed: { type: ToolConfirmKind.ConfirmationNotNeeded }, progress: this._progress });\n\t\t} else {\n\t\t\tthis._state = observableValue(this, {\n\t\t\t\ttype: IChatToolInvocation.StateKind.WaitingForConfirmation,\n\t\t\t\tconfirm: reason => {\n\t\t\t\t\tif (reason.type === ToolConfirmKind.Denied || reason.type === ToolConfirmKind.Skipped) {\n\t\t\t\t\t\tthis._state.set({ type: IChatToolInvocation.StateKind.Cancelled, reason: reason.type }, undefined);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis._state.set({ type: IChatToolInvocation.StateKind.Executing, confirmed: reason, progress: this._progress }, undefined);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\tprivate _setCompleted(result: IToolResult | undefined, postConfirmed?: ConfirmedReason | undefined) {\n\t\tif (postConfirmed && (postConfirmed.type === ToolConfirmKind.Denied || postConfirmed.type === ToolConfirmKind.Skipped)) {\n\t\t\tthis._state.set({ type: IChatToolInvocation.StateKind.Cancelled, reason: postConfirmed.type }, undefined);\n\t\t\treturn;\n\t\t}\n\n\t\tthis._state.set({\n\t\t\ttype: IChatToolInvocation.StateKind.Completed,\n\t\t\tconfirmed: IChatToolInvocation.executionConfirmedOrDenied(this) || { type: ToolConfirmKind.ConfirmationNotNeeded },\n\t\t\tresultDetails: result?.toolResultDetails,\n\t\t\tpostConfirmed,\n\t\t\tcontentForModel: result?.content || [],\n\t\t}, undefined);\n\t}\n\n\tpublic didExecuteTool(result: IToolResult | undefined, final?: boolean): IChatToolInvocation.State {\n\t\tif (result?.toolResultMessage) {\n\t\t\tthis.pastTenseMessage = result.toolResultMessage;\n\t\t} else if (this._progress.get().message) {\n\t\t\tthis.pastTenseMessage = this._progress.get().message;\n\t\t}\n\n\t\tif (this.confirmationMessages?.confirmResults && !result?.toolResultError && result?.confirmResults !== false && !final) {\n\t\t\tthis._state.set({\n\t\t\t\ttype: IChatToolInvocation.StateKind.WaitingForPostApproval,\n\t\t\t\tconfirmed: IChatToolInvocation.executionConfirmedOrDenied(this) || { type: ToolConfirmKind.ConfirmationNotNeeded },\n\t\t\t\tresultDetails: result?.toolResultDetails,\n\t\t\t\tcontentForModel: result?.content || [],\n\t\t\t\tconfirm: reason => this._setCompleted(result, reason),\n\t\t\t}, undefined);\n\t\t} else {\n\t\t\tthis._setCompleted(result);\n\t\t}\n\n\t\treturn this._state.get();\n\t}\n\n\tpublic acceptProgress(step: IToolProgressStep) {\n\t\tconst prev = this._progress.get();\n\t\tthis._progress.set({\n\t\t\tprogress: step.progress || prev.progress || 0,\n\t\t\tmessage: step.message,\n\t\t}, undefined);\n\t}\n\n\tpublic toJSON(): IChatToolInvocationSerialized {\n\t\t// persist the serialized call as 'skipped' if we were waiting for postapproval\n\t\tconst waitingForPostApproval = this.state.get().type === IChatToolInvocation.StateKind.WaitingForPostApproval;\n\t\tconst details = waitingForPostApproval ? undefined : IChatToolInvocation.resultDetails(this);\n\n\t\treturn {\n\t\t\tkind: 'toolInvocationSerialized',\n\t\t\tpresentation: this.presentation,\n\t\t\tinvocationMessage: this.invocationMessage,\n\t\t\tpastTenseMessage: this.pastTenseMessage,\n\t\t\toriginMessage: this.originMessage,\n\t\t\tisConfirmed: waitingForPostApproval ? { type: ToolConfirmKind.Skipped } : IChatToolInvocation.executionConfirmedOrDenied(this),\n\t\t\tisComplete: true,\n\t\t\tsource: this.source,\n\t\t\tresultDetails: isToolResultOutputDetails(details)\n\t\t\t\t? { output: { type: 'data', mimeType: details.output.mimeType, base64Data: encodeBase64(details.output.value) } }\n\t\t\t\t: details,\n\t\t\ttoolSpecificData: this.toolSpecificData,\n\t\t\ttoolCallId: this.toolCallId,\n\t\t\ttoolId: this.toolId,\n\t\t\tfromSubAgent: this.fromSubAgent,\n\t\t};\n\t}\n}\n"]}