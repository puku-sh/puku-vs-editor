{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/contrib/chat/common/chatParserTypes.ts","vs/workbench/contrib/chat/common/chatParserTypes.ts"],"names":[],"mappings":"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","file":"chatParserTypes.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { revive } from '../../../../base/common/marshalling.js';\nimport { ThemeIcon } from '../../../../base/common/themables.js';\nimport { IOffsetRange, OffsetRange } from '../../../../editor/common/core/ranges/offsetRange.js';\nimport { IRange } from '../../../../editor/common/core/range.js';\nimport { IChatAgentCommand, IChatAgentData, IChatAgentService, reviveSerializedAgent } from './chatAgents.js';\nimport { IChatSlashData } from './chatSlashCommands.js';\nimport { IChatRequestProblemsVariable, IChatRequestVariableValue } from './chatVariables.js';\nimport { ChatAgentLocation } from './constants.js';\nimport { IToolData } from './languageModelToolsService.js';\nimport { IChatRequestToolEntry, IChatRequestToolSetEntry, IChatRequestVariableEntry, IDiagnosticVariableEntryFilterData } from './chatVariableEntries.js';\n\n// These are in a separate file to avoid circular dependencies with the dependencies of the parser\n\nexport interface IParsedChatRequest {\n\treadonly parts: ReadonlyArray<IParsedChatRequestPart>;\n\treadonly text: string;\n}\n\nexport interface IParsedChatRequestPart {\n\treadonly kind: string; // for serialization\n\treadonly range: IOffsetRange;\n\treadonly editorRange: IRange;\n\treadonly text: string;\n\t/** How this part is represented in the prompt going to the agent */\n\treadonly promptText: string;\n}\n\nexport function getPromptText(request: IParsedChatRequest): { message: string; diff: number } {\n\tconst message = request.parts.map(r => r.promptText).join('').trimStart();\n\tconst diff = request.text.length - message.length;\n\n\treturn { message, diff };\n}\n\nexport class ChatRequestTextPart implements IParsedChatRequestPart {\n\tstatic readonly Kind = 'text';\n\treadonly kind = ChatRequestTextPart.Kind;\n\tconstructor(readonly range: OffsetRange, readonly editorRange: IRange, readonly text: string) { }\n\n\tget promptText(): string {\n\t\treturn this.text;\n\t}\n}\n\n// warning, these also show up in a regex in the parser\nexport const chatVariableLeader = '#';\nexport const chatAgentLeader = '@';\nexport const chatSubcommandLeader = '/';\n\n/**\n * An invocation of a static variable that can be resolved by the variable service\n * @deprecated, but kept for backwards compatibility with old persisted chat requests\n */\nclass ChatRequestVariablePart implements IParsedChatRequestPart {\n\tstatic readonly Kind = 'var';\n\treadonly kind = ChatRequestVariablePart.Kind;\n\tconstructor(readonly range: OffsetRange, readonly editorRange: IRange, readonly variableName: string, readonly variableArg: string, readonly variableId: string) { }\n\n\tget text(): string {\n\t\tconst argPart = this.variableArg ? `:${this.variableArg}` : '';\n\t\treturn `${chatVariableLeader}${this.variableName}${argPart}`;\n\t}\n\n\tget promptText(): string {\n\t\treturn this.text;\n\t}\n}\n\n/**\n * An invocation of a tool\n */\nexport class ChatRequestToolPart implements IParsedChatRequestPart {\n\tstatic readonly Kind = 'tool';\n\treadonly kind = ChatRequestToolPart.Kind;\n\tconstructor(readonly range: OffsetRange, readonly editorRange: IRange, readonly toolName: string, readonly toolId: string, readonly displayName?: string, readonly icon?: IToolData['icon']) { }\n\n\tget text(): string {\n\t\treturn `${chatVariableLeader}${this.toolName}`;\n\t}\n\n\tget promptText(): string {\n\t\treturn this.text;\n\t}\n\n\ttoVariableEntry(): IChatRequestToolEntry {\n\t\treturn { kind: 'tool', id: this.toolId, name: this.toolName, range: this.range, value: undefined, icon: ThemeIcon.isThemeIcon(this.icon) ? this.icon : undefined, fullName: this.displayName };\n\t}\n}\n\n/**\n * An invocation of a tool\n */\nexport class ChatRequestToolSetPart implements IParsedChatRequestPart {\n\tstatic readonly Kind = 'toolset';\n\treadonly kind = ChatRequestToolSetPart.Kind;\n\tconstructor(readonly range: OffsetRange, readonly editorRange: IRange, readonly id: string, readonly name: string, readonly icon: ThemeIcon, readonly tools: IChatRequestToolEntry[]) { }\n\n\tget text(): string {\n\t\treturn `${chatVariableLeader}${this.name}`;\n\t}\n\n\tget promptText(): string {\n\t\treturn this.text;\n\t}\n\n\ttoVariableEntry(): IChatRequestToolSetEntry {\n\t\treturn { kind: 'toolset', id: this.id, name: this.name, range: this.range, icon: this.icon, value: this.tools };\n\t}\n}\n\n/**\n * An invocation of an agent that can be resolved by the agent service\n */\nexport class ChatRequestAgentPart implements IParsedChatRequestPart {\n\tstatic readonly Kind = 'agent';\n\treadonly kind = ChatRequestAgentPart.Kind;\n\tconstructor(readonly range: OffsetRange, readonly editorRange: IRange, readonly agent: IChatAgentData) { }\n\n\tget text(): string {\n\n\t\treturn `${chatAgentLeader}${this.agent.name}`;\n\t}\n\n\tget promptText(): string {\n\t\treturn '';\n\t}\n}\n\n/**\n * An invocation of an agent's subcommand\n */\nexport class ChatRequestAgentSubcommandPart implements IParsedChatRequestPart {\n\tstatic readonly Kind = 'subcommand';\n\treadonly kind = ChatRequestAgentSubcommandPart.Kind;\n\tconstructor(readonly range: OffsetRange, readonly editorRange: IRange, readonly command: IChatAgentCommand) { }\n\n\tget text(): string {\n\t\treturn `${chatSubcommandLeader}${this.command.name}`;\n\t}\n\n\tget promptText(): string {\n\t\treturn '';\n\t}\n}\n\n/**\n * An invocation of a standalone slash command\n */\nexport class ChatRequestSlashCommandPart implements IParsedChatRequestPart {\n\tstatic readonly Kind = 'slash';\n\treadonly kind = ChatRequestSlashCommandPart.Kind;\n\tconstructor(readonly range: OffsetRange, readonly editorRange: IRange, readonly slashCommand: IChatSlashData) { }\n\n\tget text(): string {\n\t\treturn `${chatSubcommandLeader}${this.slashCommand.command}`;\n\t}\n\n\tget promptText(): string {\n\t\treturn `${chatSubcommandLeader}${this.slashCommand.command}`;\n\t}\n}\n\n/**\n * An invocation of a standalone slash command\n */\nexport class ChatRequestSlashPromptPart implements IParsedChatRequestPart {\n\tstatic readonly Kind = 'prompt';\n\treadonly kind = ChatRequestSlashPromptPart.Kind;\n\tconstructor(readonly range: OffsetRange, readonly editorRange: IRange, readonly name: string) { }\n\n\tget text(): string {\n\t\treturn `${chatSubcommandLeader}${this.name}`;\n\t}\n\n\tget promptText(): string {\n\t\treturn `${chatSubcommandLeader}${this.name}`;\n\t}\n}\n\n/**\n * An invocation of a dynamic reference like '#file:'\n */\nexport class ChatRequestDynamicVariablePart implements IParsedChatRequestPart {\n\tstatic readonly Kind = 'dynamic';\n\treadonly kind = ChatRequestDynamicVariablePart.Kind;\n\tconstructor(readonly range: OffsetRange, readonly editorRange: IRange, readonly text: string, readonly id: string, readonly modelDescription: string | undefined, readonly data: IChatRequestVariableValue, readonly fullName?: string, readonly icon?: ThemeIcon, readonly isFile?: boolean, readonly isDirectory?: boolean) { }\n\n\tget referenceText(): string {\n\t\treturn this.text.replace(chatVariableLeader, '');\n\t}\n\n\tget promptText(): string {\n\t\treturn this.text;\n\t}\n\n\ttoVariableEntry(): IChatRequestVariableEntry {\n\t\tif (this.id === 'vscode.problems') {\n\t\t\treturn IDiagnosticVariableEntryFilterData.toEntry((this.data as IChatRequestProblemsVariable).filter);\n\t\t}\n\n\t\treturn { kind: this.isDirectory ? 'directory' : this.isFile ? 'file' : 'generic', id: this.id, name: this.referenceText, range: this.range, value: this.data, fullName: this.fullName, icon: this.icon };\n\t}\n}\n\nexport function reviveParsedChatRequest(serialized: IParsedChatRequest): IParsedChatRequest {\n\treturn {\n\t\ttext: serialized.text,\n\t\tparts: serialized.parts.map(part => {\n\t\t\tif (part.kind === ChatRequestTextPart.Kind) {\n\t\t\t\treturn new ChatRequestTextPart(\n\t\t\t\t\tnew OffsetRange(part.range.start, part.range.endExclusive),\n\t\t\t\t\tpart.editorRange,\n\t\t\t\t\tpart.text\n\t\t\t\t);\n\t\t\t} else if (part.kind === ChatRequestVariablePart.Kind) {\n\t\t\t\treturn new ChatRequestVariablePart(\n\t\t\t\t\tnew OffsetRange(part.range.start, part.range.endExclusive),\n\t\t\t\t\tpart.editorRange,\n\t\t\t\t\t(part as ChatRequestVariablePart).variableName,\n\t\t\t\t\t(part as ChatRequestVariablePart).variableArg,\n\t\t\t\t\t(part as ChatRequestVariablePart).variableId || '',\n\t\t\t\t);\n\t\t\t} else if (part.kind === ChatRequestToolPart.Kind) {\n\t\t\t\treturn new ChatRequestToolPart(\n\t\t\t\t\tnew OffsetRange(part.range.start, part.range.endExclusive),\n\t\t\t\t\tpart.editorRange,\n\t\t\t\t\t(part as ChatRequestToolPart).toolName,\n\t\t\t\t\t(part as ChatRequestToolPart).toolId,\n\t\t\t\t\t(part as ChatRequestToolPart).displayName,\n\t\t\t\t\t(part as ChatRequestToolPart).icon,\n\t\t\t\t);\n\t\t\t} else if (part.kind === ChatRequestToolSetPart.Kind) {\n\t\t\t\treturn new ChatRequestToolSetPart(\n\t\t\t\t\tnew OffsetRange(part.range.start, part.range.endExclusive),\n\t\t\t\t\tpart.editorRange,\n\t\t\t\t\t(part as ChatRequestToolSetPart).id,\n\t\t\t\t\t(part as ChatRequestToolSetPart).name,\n\t\t\t\t\t(part as ChatRequestToolSetPart).icon,\n\t\t\t\t\t(part as ChatRequestToolSetPart).tools ?? [],\n\t\t\t\t);\n\t\t\t} else if (part.kind === ChatRequestAgentPart.Kind) {\n\t\t\t\tlet agent = (part as ChatRequestAgentPart).agent;\n\t\t\t\tagent = reviveSerializedAgent(agent);\n\n\t\t\t\treturn new ChatRequestAgentPart(\n\t\t\t\t\tnew OffsetRange(part.range.start, part.range.endExclusive),\n\t\t\t\t\tpart.editorRange,\n\t\t\t\t\tagent\n\t\t\t\t);\n\t\t\t} else if (part.kind === ChatRequestAgentSubcommandPart.Kind) {\n\t\t\t\treturn new ChatRequestAgentSubcommandPart(\n\t\t\t\t\tnew OffsetRange(part.range.start, part.range.endExclusive),\n\t\t\t\t\tpart.editorRange,\n\t\t\t\t\t(part as ChatRequestAgentSubcommandPart).command\n\t\t\t\t);\n\t\t\t} else if (part.kind === ChatRequestSlashCommandPart.Kind) {\n\t\t\t\treturn new ChatRequestSlashCommandPart(\n\t\t\t\t\tnew OffsetRange(part.range.start, part.range.endExclusive),\n\t\t\t\t\tpart.editorRange,\n\t\t\t\t\t(part as ChatRequestSlashCommandPart).slashCommand\n\t\t\t\t);\n\t\t\t} else if (part.kind === ChatRequestSlashPromptPart.Kind) {\n\t\t\t\treturn new ChatRequestSlashPromptPart(\n\t\t\t\t\tnew OffsetRange(part.range.start, part.range.endExclusive),\n\t\t\t\t\tpart.editorRange,\n\t\t\t\t\t(part as ChatRequestSlashPromptPart).name\n\t\t\t\t);\n\t\t\t} else if (part.kind === ChatRequestDynamicVariablePart.Kind) {\n\t\t\t\treturn new ChatRequestDynamicVariablePart(\n\t\t\t\t\tnew OffsetRange(part.range.start, part.range.endExclusive),\n\t\t\t\t\tpart.editorRange,\n\t\t\t\t\t(part as ChatRequestDynamicVariablePart).text,\n\t\t\t\t\t(part as ChatRequestDynamicVariablePart).id,\n\t\t\t\t\t(part as ChatRequestDynamicVariablePart).modelDescription,\n\t\t\t\t\trevive((part as ChatRequestDynamicVariablePart).data),\n\t\t\t\t\t(part as ChatRequestDynamicVariablePart).fullName,\n\t\t\t\t\t(part as ChatRequestDynamicVariablePart).icon,\n\t\t\t\t\t(part as ChatRequestDynamicVariablePart).isFile,\n\t\t\t\t\t(part as ChatRequestDynamicVariablePart).isDirectory\n\t\t\t\t);\n\t\t\t} else {\n\t\t\t\tthrow new Error(`Unknown chat request part: ${part.kind}`);\n\t\t\t}\n\t\t})\n\t};\n}\n\nexport function extractAgentAndCommand(parsed: IParsedChatRequest): { agentPart: ChatRequestAgentPart | undefined; commandPart: ChatRequestAgentSubcommandPart | undefined } {\n\tconst agentPart = parsed.parts.find((r): r is ChatRequestAgentPart => r instanceof ChatRequestAgentPart);\n\tconst commandPart = parsed.parts.find((r): r is ChatRequestAgentSubcommandPart => r instanceof ChatRequestAgentSubcommandPart);\n\treturn { agentPart, commandPart };\n}\n\nexport function formatChatQuestion(chatAgentService: IChatAgentService, location: ChatAgentLocation, prompt: string, participant: string | null = null, command: string | null = null): string | undefined {\n\tlet question = '';\n\tif (participant && participant !== chatAgentService.getDefaultAgent(location)?.id) {\n\t\tconst agent = chatAgentService.getAgent(participant);\n\t\tif (!agent) {\n\t\t\t// Refers to agent that doesn't exist\n\t\t\treturn undefined;\n\t\t}\n\n\t\tquestion += `${chatAgentLeader}${agent.name} `;\n\t\tif (command) {\n\t\t\tquestion += `${chatSubcommandLeader}${command} `;\n\t\t}\n\t}\n\treturn question + prompt;\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { revive } from '../../../../base/common/marshalling.js';\nimport { ThemeIcon } from '../../../../base/common/themables.js';\nimport { IOffsetRange, OffsetRange } from '../../../../editor/common/core/ranges/offsetRange.js';\nimport { IRange } from '../../../../editor/common/core/range.js';\nimport { IChatAgentCommand, IChatAgentData, IChatAgentService, reviveSerializedAgent } from './chatAgents.js';\nimport { IChatSlashData } from './chatSlashCommands.js';\nimport { IChatRequestProblemsVariable, IChatRequestVariableValue } from './chatVariables.js';\nimport { ChatAgentLocation } from './constants.js';\nimport { IToolData } from './languageModelToolsService.js';\nimport { IChatRequestToolEntry, IChatRequestToolSetEntry, IChatRequestVariableEntry, IDiagnosticVariableEntryFilterData } from './chatVariableEntries.js';\n\n// These are in a separate file to avoid circular dependencies with the dependencies of the parser\n\nexport interface IParsedChatRequest {\n\treadonly parts: ReadonlyArray<IParsedChatRequestPart>;\n\treadonly text: string;\n}\n\nexport interface IParsedChatRequestPart {\n\treadonly kind: string; // for serialization\n\treadonly range: IOffsetRange;\n\treadonly editorRange: IRange;\n\treadonly text: string;\n\t/** How this part is represented in the prompt going to the agent */\n\treadonly promptText: string;\n}\n\nexport function getPromptText(request: IParsedChatRequest): { message: string; diff: number } {\n\tconst message = request.parts.map(r => r.promptText).join('').trimStart();\n\tconst diff = request.text.length - message.length;\n\n\treturn { message, diff };\n}\n\nexport class ChatRequestTextPart implements IParsedChatRequestPart {\n\tstatic readonly Kind = 'text';\n\treadonly kind = ChatRequestTextPart.Kind;\n\tconstructor(readonly range: OffsetRange, readonly editorRange: IRange, readonly text: string) { }\n\n\tget promptText(): string {\n\t\treturn this.text;\n\t}\n}\n\n// warning, these also show up in a regex in the parser\nexport const chatVariableLeader = '#';\nexport const chatAgentLeader = '@';\nexport const chatSubcommandLeader = '/';\n\n/**\n * An invocation of a static variable that can be resolved by the variable service\n * @deprecated, but kept for backwards compatibility with old persisted chat requests\n */\nclass ChatRequestVariablePart implements IParsedChatRequestPart {\n\tstatic readonly Kind = 'var';\n\treadonly kind = ChatRequestVariablePart.Kind;\n\tconstructor(readonly range: OffsetRange, readonly editorRange: IRange, readonly variableName: string, readonly variableArg: string, readonly variableId: string) { }\n\n\tget text(): string {\n\t\tconst argPart = this.variableArg ? `:${this.variableArg}` : '';\n\t\treturn `${chatVariableLeader}${this.variableName}${argPart}`;\n\t}\n\n\tget promptText(): string {\n\t\treturn this.text;\n\t}\n}\n\n/**\n * An invocation of a tool\n */\nexport class ChatRequestToolPart implements IParsedChatRequestPart {\n\tstatic readonly Kind = 'tool';\n\treadonly kind = ChatRequestToolPart.Kind;\n\tconstructor(readonly range: OffsetRange, readonly editorRange: IRange, readonly toolName: string, readonly toolId: string, readonly displayName?: string, readonly icon?: IToolData['icon']) { }\n\n\tget text(): string {\n\t\treturn `${chatVariableLeader}${this.toolName}`;\n\t}\n\n\tget promptText(): string {\n\t\treturn this.text;\n\t}\n\n\ttoVariableEntry(): IChatRequestToolEntry {\n\t\treturn { kind: 'tool', id: this.toolId, name: this.toolName, range: this.range, value: undefined, icon: ThemeIcon.isThemeIcon(this.icon) ? this.icon : undefined, fullName: this.displayName };\n\t}\n}\n\n/**\n * An invocation of a tool\n */\nexport class ChatRequestToolSetPart implements IParsedChatRequestPart {\n\tstatic readonly Kind = 'toolset';\n\treadonly kind = ChatRequestToolSetPart.Kind;\n\tconstructor(readonly range: OffsetRange, readonly editorRange: IRange, readonly id: string, readonly name: string, readonly icon: ThemeIcon, readonly tools: IChatRequestToolEntry[]) { }\n\n\tget text(): string {\n\t\treturn `${chatVariableLeader}${this.name}`;\n\t}\n\n\tget promptText(): string {\n\t\treturn this.text;\n\t}\n\n\ttoVariableEntry(): IChatRequestToolSetEntry {\n\t\treturn { kind: 'toolset', id: this.id, name: this.name, range: this.range, icon: this.icon, value: this.tools };\n\t}\n}\n\n/**\n * An invocation of an agent that can be resolved by the agent service\n */\nexport class ChatRequestAgentPart implements IParsedChatRequestPart {\n\tstatic readonly Kind = 'agent';\n\treadonly kind = ChatRequestAgentPart.Kind;\n\tconstructor(readonly range: OffsetRange, readonly editorRange: IRange, readonly agent: IChatAgentData) { }\n\n\tget text(): string {\n\n\t\treturn `${chatAgentLeader}${this.agent.name}`;\n\t}\n\n\tget promptText(): string {\n\t\treturn '';\n\t}\n}\n\n/**\n * An invocation of an agent's subcommand\n */\nexport class ChatRequestAgentSubcommandPart implements IParsedChatRequestPart {\n\tstatic readonly Kind = 'subcommand';\n\treadonly kind = ChatRequestAgentSubcommandPart.Kind;\n\tconstructor(readonly range: OffsetRange, readonly editorRange: IRange, readonly command: IChatAgentCommand) { }\n\n\tget text(): string {\n\t\treturn `${chatSubcommandLeader}${this.command.name}`;\n\t}\n\n\tget promptText(): string {\n\t\treturn '';\n\t}\n}\n\n/**\n * An invocation of a standalone slash command\n */\nexport class ChatRequestSlashCommandPart implements IParsedChatRequestPart {\n\tstatic readonly Kind = 'slash';\n\treadonly kind = ChatRequestSlashCommandPart.Kind;\n\tconstructor(readonly range: OffsetRange, readonly editorRange: IRange, readonly slashCommand: IChatSlashData) { }\n\n\tget text(): string {\n\t\treturn `${chatSubcommandLeader}${this.slashCommand.command}`;\n\t}\n\n\tget promptText(): string {\n\t\treturn `${chatSubcommandLeader}${this.slashCommand.command}`;\n\t}\n}\n\n/**\n * An invocation of a standalone slash command\n */\nexport class ChatRequestSlashPromptPart implements IParsedChatRequestPart {\n\tstatic readonly Kind = 'prompt';\n\treadonly kind = ChatRequestSlashPromptPart.Kind;\n\tconstructor(readonly range: OffsetRange, readonly editorRange: IRange, readonly name: string) { }\n\n\tget text(): string {\n\t\treturn `${chatSubcommandLeader}${this.name}`;\n\t}\n\n\tget promptText(): string {\n\t\treturn `${chatSubcommandLeader}${this.name}`;\n\t}\n}\n\n/**\n * An invocation of a dynamic reference like '#file:'\n */\nexport class ChatRequestDynamicVariablePart implements IParsedChatRequestPart {\n\tstatic readonly Kind = 'dynamic';\n\treadonly kind = ChatRequestDynamicVariablePart.Kind;\n\tconstructor(readonly range: OffsetRange, readonly editorRange: IRange, readonly text: string, readonly id: string, readonly modelDescription: string | undefined, readonly data: IChatRequestVariableValue, readonly fullName?: string, readonly icon?: ThemeIcon, readonly isFile?: boolean, readonly isDirectory?: boolean) { }\n\n\tget referenceText(): string {\n\t\treturn this.text.replace(chatVariableLeader, '');\n\t}\n\n\tget promptText(): string {\n\t\treturn this.text;\n\t}\n\n\ttoVariableEntry(): IChatRequestVariableEntry {\n\t\tif (this.id === 'vscode.problems') {\n\t\t\treturn IDiagnosticVariableEntryFilterData.toEntry((this.data as IChatRequestProblemsVariable).filter);\n\t\t}\n\n\t\treturn { kind: this.isDirectory ? 'directory' : this.isFile ? 'file' : 'generic', id: this.id, name: this.referenceText, range: this.range, value: this.data, fullName: this.fullName, icon: this.icon };\n\t}\n}\n\nexport function reviveParsedChatRequest(serialized: IParsedChatRequest): IParsedChatRequest {\n\treturn {\n\t\ttext: serialized.text,\n\t\tparts: serialized.parts.map(part => {\n\t\t\tif (part.kind === ChatRequestTextPart.Kind) {\n\t\t\t\treturn new ChatRequestTextPart(\n\t\t\t\t\tnew OffsetRange(part.range.start, part.range.endExclusive),\n\t\t\t\t\tpart.editorRange,\n\t\t\t\t\tpart.text\n\t\t\t\t);\n\t\t\t} else if (part.kind === ChatRequestVariablePart.Kind) {\n\t\t\t\treturn new ChatRequestVariablePart(\n\t\t\t\t\tnew OffsetRange(part.range.start, part.range.endExclusive),\n\t\t\t\t\tpart.editorRange,\n\t\t\t\t\t(part as ChatRequestVariablePart).variableName,\n\t\t\t\t\t(part as ChatRequestVariablePart).variableArg,\n\t\t\t\t\t(part as ChatRequestVariablePart).variableId || '',\n\t\t\t\t);\n\t\t\t} else if (part.kind === ChatRequestToolPart.Kind) {\n\t\t\t\treturn new ChatRequestToolPart(\n\t\t\t\t\tnew OffsetRange(part.range.start, part.range.endExclusive),\n\t\t\t\t\tpart.editorRange,\n\t\t\t\t\t(part as ChatRequestToolPart).toolName,\n\t\t\t\t\t(part as ChatRequestToolPart).toolId,\n\t\t\t\t\t(part as ChatRequestToolPart).displayName,\n\t\t\t\t\t(part as ChatRequestToolPart).icon,\n\t\t\t\t);\n\t\t\t} else if (part.kind === ChatRequestToolSetPart.Kind) {\n\t\t\t\treturn new ChatRequestToolSetPart(\n\t\t\t\t\tnew OffsetRange(part.range.start, part.range.endExclusive),\n\t\t\t\t\tpart.editorRange,\n\t\t\t\t\t(part as ChatRequestToolSetPart).id,\n\t\t\t\t\t(part as ChatRequestToolSetPart).name,\n\t\t\t\t\t(part as ChatRequestToolSetPart).icon,\n\t\t\t\t\t(part as ChatRequestToolSetPart).tools ?? [],\n\t\t\t\t);\n\t\t\t} else if (part.kind === ChatRequestAgentPart.Kind) {\n\t\t\t\tlet agent = (part as ChatRequestAgentPart).agent;\n\t\t\t\tagent = reviveSerializedAgent(agent);\n\n\t\t\t\treturn new ChatRequestAgentPart(\n\t\t\t\t\tnew OffsetRange(part.range.start, part.range.endExclusive),\n\t\t\t\t\tpart.editorRange,\n\t\t\t\t\tagent\n\t\t\t\t);\n\t\t\t} else if (part.kind === ChatRequestAgentSubcommandPart.Kind) {\n\t\t\t\treturn new ChatRequestAgentSubcommandPart(\n\t\t\t\t\tnew OffsetRange(part.range.start, part.range.endExclusive),\n\t\t\t\t\tpart.editorRange,\n\t\t\t\t\t(part as ChatRequestAgentSubcommandPart).command\n\t\t\t\t);\n\t\t\t} else if (part.kind === ChatRequestSlashCommandPart.Kind) {\n\t\t\t\treturn new ChatRequestSlashCommandPart(\n\t\t\t\t\tnew OffsetRange(part.range.start, part.range.endExclusive),\n\t\t\t\t\tpart.editorRange,\n\t\t\t\t\t(part as ChatRequestSlashCommandPart).slashCommand\n\t\t\t\t);\n\t\t\t} else if (part.kind === ChatRequestSlashPromptPart.Kind) {\n\t\t\t\treturn new ChatRequestSlashPromptPart(\n\t\t\t\t\tnew OffsetRange(part.range.start, part.range.endExclusive),\n\t\t\t\t\tpart.editorRange,\n\t\t\t\t\t(part as ChatRequestSlashPromptPart).name\n\t\t\t\t);\n\t\t\t} else if (part.kind === ChatRequestDynamicVariablePart.Kind) {\n\t\t\t\treturn new ChatRequestDynamicVariablePart(\n\t\t\t\t\tnew OffsetRange(part.range.start, part.range.endExclusive),\n\t\t\t\t\tpart.editorRange,\n\t\t\t\t\t(part as ChatRequestDynamicVariablePart).text,\n\t\t\t\t\t(part as ChatRequestDynamicVariablePart).id,\n\t\t\t\t\t(part as ChatRequestDynamicVariablePart).modelDescription,\n\t\t\t\t\trevive((part as ChatRequestDynamicVariablePart).data),\n\t\t\t\t\t(part as ChatRequestDynamicVariablePart).fullName,\n\t\t\t\t\t(part as ChatRequestDynamicVariablePart).icon,\n\t\t\t\t\t(part as ChatRequestDynamicVariablePart).isFile,\n\t\t\t\t\t(part as ChatRequestDynamicVariablePart).isDirectory\n\t\t\t\t);\n\t\t\t} else {\n\t\t\t\tthrow new Error(`Unknown chat request part: ${part.kind}`);\n\t\t\t}\n\t\t})\n\t};\n}\n\nexport function extractAgentAndCommand(parsed: IParsedChatRequest): { agentPart: ChatRequestAgentPart | undefined; commandPart: ChatRequestAgentSubcommandPart | undefined } {\n\tconst agentPart = parsed.parts.find((r): r is ChatRequestAgentPart => r instanceof ChatRequestAgentPart);\n\tconst commandPart = parsed.parts.find((r): r is ChatRequestAgentSubcommandPart => r instanceof ChatRequestAgentSubcommandPart);\n\treturn { agentPart, commandPart };\n}\n\nexport function formatChatQuestion(chatAgentService: IChatAgentService, location: ChatAgentLocation, prompt: string, participant: string | null = null, command: string | null = null): string | undefined {\n\tlet question = '';\n\tif (participant && participant !== chatAgentService.getDefaultAgent(location)?.id) {\n\t\tconst agent = chatAgentService.getAgent(participant);\n\t\tif (!agent) {\n\t\t\t// Refers to agent that doesn't exist\n\t\t\treturn undefined;\n\t\t}\n\n\t\tquestion += `${chatAgentLeader}${agent.name} `;\n\t\tif (command) {\n\t\t\tquestion += `${chatSubcommandLeader}${command} `;\n\t\t}\n\t}\n\treturn question + prompt;\n}\n"]}