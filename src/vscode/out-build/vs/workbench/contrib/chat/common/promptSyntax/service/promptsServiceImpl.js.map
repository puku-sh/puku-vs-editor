{"version":3,"sources":["vs/workbench/contrib/chat/common/promptSyntax/service/promptsServiceImpl.ts"],"names":[],"mappings":"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","file":"promptsServiceImpl.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { CancellationToken } from '../../../../../../base/common/cancellation.js';\nimport { CancellationError } from '../../../../../../base/common/errors.js';\nimport { Emitter, Event } from '../../../../../../base/common/event.js';\nimport { Disposable, IDisposable } from '../../../../../../base/common/lifecycle.js';\nimport { ResourceMap, ResourceSet } from '../../../../../../base/common/map.js';\nimport { dirname, isEqual } from '../../../../../../base/common/resources.js';\nimport { URI } from '../../../../../../base/common/uri.js';\nimport { OffsetRange } from '../../../../../../editor/common/core/ranges/offsetRange.js';\nimport { type ITextModel } from '../../../../../../editor/common/model.js';\nimport { IModelService } from '../../../../../../editor/common/services/model.js';\nimport { localize } from '../../../../../../nls.js';\nimport { IConfigurationService } from '../../../../../../platform/configuration/common/configuration.js';\nimport { IExtensionDescription } from '../../../../../../platform/extensions/common/extensions.js';\nimport { IFileService } from '../../../../../../platform/files/common/files.js';\nimport { IInstantiationService } from '../../../../../../platform/instantiation/common/instantiation.js';\nimport { ILabelService } from '../../../../../../platform/label/common/label.js';\nimport { ILogService } from '../../../../../../platform/log/common/log.js';\nimport { IFilesConfigurationService } from '../../../../../services/filesConfiguration/common/filesConfigurationService.js';\nimport { IStorageService, StorageScope, StorageTarget } from '../../../../../../platform/storage/common/storage.js';\nimport { IUserDataProfileService } from '../../../../../services/userDataProfile/common/userDataProfile.js';\nimport { IVariableReference } from '../../chatModes.js';\nimport { PromptsConfig } from '../config/config.js';\nimport { getCleanPromptName } from '../config/promptFileLocations.js';\nimport { PROMPT_LANGUAGE_ID, PromptsType, getPromptsTypeForLanguageId } from '../promptTypes.js';\nimport { PromptFilesLocator } from '../utils/promptFilesLocator.js';\nimport { PromptFileParser, ParsedPromptFile, PromptHeaderAttributes } from '../promptFileParser.js';\nimport { IAgentInstructions, IAgentSource, IChatPromptSlashCommand, ICustomAgent, IExtensionPromptPath, ILocalPromptPath, IPromptPath, IPromptsService, IClaudeSkill, IUserPromptPath, PromptsStorage } from './promptsService.js';\nimport { Delayer } from '../../../../../../base/common/async.js';\nimport { Schemas } from '../../../../../../base/common/network.js';\n\n/**\n * Provides prompt services.\n */\nexport class PromptsService extends Disposable implements IPromptsService {\n\tpublic declare readonly _serviceBrand: undefined;\n\n\t/**\n\t * Prompt files locator utility.\n\t */\n\tprivate readonly fileLocator: PromptFilesLocator;\n\n\t/**\n\t * Cached custom agents. Caching only happens if the `onDidChangeCustomAgents` event is used.\n\t */\n\tprivate readonly cachedCustomAgents: CachedPromise<readonly ICustomAgent[]>;\n\n\t/**\n\t * Cached slash commands. Caching only happens if the `onDidChangeSlashCommands` event is used.\n\t */\n\tprivate readonly cachedSlashCommands: CachedPromise<readonly IChatPromptSlashCommand[]>;\n\n\t/**\n\t * Cache for parsed prompt files keyed by URI.\n\t * The number in the returned tuple is textModel.getVersionId(), which is an internal VS Code counter that increments every time the text model's content changes.\n\t */\n\tprivate readonly cachedParsedPromptFromModels = new ResourceMap<[number, ParsedPromptFile]>();\n\n\t/**\n\t * Cached file locations commands. Caching only happens if the corresponding `fileLocatorEvents` event is used.\n\t */\n\tprivate readonly cachedFileLocations: { [key in PromptsType]?: Promise<readonly IPromptPath[]> } = {};\n\n\t/**\n\t * Lazily created events that notify listeners when the file locations for a given prompt type change.\n\t * An event is created on demand for each prompt type and can be used by consumers to react to updates\n\t * in the set of prompt files (e.g., when prompt files are added, removed, or modified).\n\t */\n\tprivate readonly fileLocatorEvents: { [key in PromptsType]?: Event<void> } = {};\n\n\n\t/**\n\t * Contributed files from extensions keyed by prompt type then name.\n\t */\n\tprivate readonly contributedFiles = {\n\t\t[PromptsType.prompt]: new ResourceMap<Promise<IExtensionPromptPath>>(),\n\t\t[PromptsType.instructions]: new ResourceMap<Promise<IExtensionPromptPath>>(),\n\t\t[PromptsType.agent]: new ResourceMap<Promise<IExtensionPromptPath>>(),\n\t};\n\n\tconstructor(\n\t\t@ILogService public readonly logger: ILogService,\n\t\t@ILabelService private readonly labelService: ILabelService,\n\t\t@IModelService private readonly modelService: IModelService,\n\t\t@IInstantiationService private readonly instantiationService: IInstantiationService,\n\t\t@IUserDataProfileService private readonly userDataService: IUserDataProfileService,\n\t\t@IConfigurationService private readonly configurationService: IConfigurationService,\n\t\t@IFileService private readonly fileService: IFileService,\n\t\t@IFilesConfigurationService private readonly filesConfigService: IFilesConfigurationService,\n\t\t@IStorageService private readonly storageService: IStorageService,\n\t) {\n\t\tsuper();\n\n\t\tthis.fileLocator = this.instantiationService.createInstance(PromptFilesLocator);\n\t\tthis._register(this.modelService.onModelRemoved((model) => {\n\t\t\tthis.cachedParsedPromptFromModels.delete(model.uri);\n\t\t}));\n\n\t\tconst modelChangeEvent = this._register(new ModelChangeTracker(this.modelService)).onDidPromptChange;\n\t\tthis.cachedCustomAgents = this._register(new CachedPromise(\n\t\t\t(token) => this.computeCustomAgents(token),\n\t\t\t() => Event.any(this.getFileLocatorEvent(PromptsType.agent), Event.filter(modelChangeEvent, e => e.promptType === PromptsType.agent))\n\t\t));\n\n\t\tthis.cachedSlashCommands = this._register(new CachedPromise(\n\t\t\t(token) => this.computePromptSlashCommands(token),\n\t\t\t() => Event.any(this.getFileLocatorEvent(PromptsType.prompt), Event.filter(modelChangeEvent, e => e.promptType === PromptsType.prompt))\n\t\t));\n\t}\n\n\tprivate getFileLocatorEvent(type: PromptsType): Event<void> {\n\t\tlet event = this.fileLocatorEvents[type];\n\t\tif (!event) {\n\t\t\tevent = this.fileLocatorEvents[type] = this._register(this.fileLocator.createFilesUpdatedEvent(type)).event;\n\t\t\tthis._register(event(() => {\n\t\t\t\tthis.cachedFileLocations[type] = undefined;\n\t\t\t}));\n\t\t}\n\t\treturn event;\n\t}\n\n\tpublic getParsedPromptFile(textModel: ITextModel): ParsedPromptFile {\n\t\tconst cached = this.cachedParsedPromptFromModels.get(textModel.uri);\n\t\tif (cached && cached[0] === textModel.getVersionId()) {\n\t\t\treturn cached[1];\n\t\t}\n\t\tconst ast = new PromptFileParser().parse(textModel.uri, textModel.getValue());\n\t\tif (!cached || cached[0] < textModel.getVersionId()) {\n\t\t\tthis.cachedParsedPromptFromModels.set(textModel.uri, [textModel.getVersionId(), ast]);\n\t\t}\n\t\treturn ast;\n\t}\n\n\tpublic async listPromptFiles(type: PromptsType, token: CancellationToken): Promise<readonly IPromptPath[]> {\n\t\tlet listPromise = this.cachedFileLocations[type];\n\t\tif (!listPromise) {\n\t\t\tlistPromise = this.computeListPromptFiles(type, token);\n\t\t\tif (!this.fileLocatorEvents[type]) {\n\t\t\t\treturn listPromise;\n\t\t\t}\n\t\t\tthis.cachedFileLocations[type] = listPromise;\n\t\t\treturn listPromise;\n\t\t}\n\t\treturn listPromise;\n\t}\n\n\tprivate async computeListPromptFiles(type: PromptsType, token: CancellationToken): Promise<readonly IPromptPath[]> {\n\t\tconst prompts = await Promise.all([\n\t\t\tthis.fileLocator.listFiles(type, PromptsStorage.user, token).then(uris => uris.map(uri => ({ uri, storage: PromptsStorage.user, type } satisfies IUserPromptPath))),\n\t\t\tthis.fileLocator.listFiles(type, PromptsStorage.local, token).then(uris => uris.map(uri => ({ uri, storage: PromptsStorage.local, type } satisfies ILocalPromptPath))),\n\t\t\tthis.getExtensionContributions(type)\n\t\t]);\n\n\t\treturn [...prompts.flat()];\n\t}\n\n\tpublic async listPromptFilesForStorage(type: PromptsType, storage: PromptsStorage, token: CancellationToken): Promise<readonly IPromptPath[]> {\n\t\tswitch (storage) {\n\t\t\tcase PromptsStorage.extension:\n\t\t\t\treturn this.getExtensionContributions(type);\n\t\t\tcase PromptsStorage.local:\n\t\t\t\treturn this.fileLocator.listFiles(type, PromptsStorage.local, token).then(uris => uris.map(uri => ({ uri, storage: PromptsStorage.local, type } satisfies ILocalPromptPath)));\n\t\t\tcase PromptsStorage.user:\n\t\t\t\treturn this.fileLocator.listFiles(type, PromptsStorage.user, token).then(uris => uris.map(uri => ({ uri, storage: PromptsStorage.user, type } satisfies IUserPromptPath)));\n\t\t\tdefault:\n\t\t\t\tthrow new Error(`[listPromptFilesForStorage] Unsupported prompt storage type: ${storage}`);\n\t\t}\n\t}\n\n\tprivate async getExtensionContributions(type: PromptsType): Promise<IPromptPath[]> {\n\t\treturn Promise.all(this.contributedFiles[type].values());\n\t}\n\n\tpublic getSourceFolders(type: PromptsType): readonly IPromptPath[] {\n\t\tconst result: IPromptPath[] = [];\n\n\t\tif (type === PromptsType.agent) {\n\t\t\tconst folders = this.fileLocator.getAgentSourceFolder();\n\t\t\tfor (const uri of folders) {\n\t\t\t\tresult.push({ uri, storage: PromptsStorage.local, type });\n\t\t\t}\n\t\t} else {\n\t\t\tfor (const uri of this.fileLocator.getConfigBasedSourceFolders(type)) {\n\t\t\t\tresult.push({ uri, storage: PromptsStorage.local, type });\n\t\t\t}\n\t\t}\n\n\t\tconst userHome = this.userDataService.currentProfile.promptsHome;\n\t\tresult.push({ uri: userHome, storage: PromptsStorage.user, type });\n\n\t\treturn result;\n\t}\n\n\t// slash prompt commands\n\n\t/**\n\t * Emitter for slash commands change events.\n\t */\n\tpublic get onDidChangeSlashCommands(): Event<void> {\n\t\treturn this.cachedSlashCommands.onDidChange;\n\t}\n\n\tpublic async getPromptSlashCommands(token: CancellationToken): Promise<readonly IChatPromptSlashCommand[]> {\n\t\treturn this.cachedSlashCommands.get(token);\n\t}\n\n\tprivate async computePromptSlashCommands(token: CancellationToken): Promise<readonly IChatPromptSlashCommand[]> {\n\t\tconst promptFiles = await this.listPromptFiles(PromptsType.prompt, token);\n\t\tconst details = await Promise.all(promptFiles.map(async promptPath => {\n\t\t\ttry {\n\t\t\t\tconst parsedPromptFile = await this.parseNew(promptPath.uri, token);\n\t\t\t\treturn this.asChatPromptSlashCommand(parsedPromptFile, promptPath);\n\t\t\t} catch (e) {\n\t\t\t\tthis.logger.error(`[computePromptSlashCommands] Failed to parse prompt file for slash command: ${promptPath.uri}`, e instanceof Error ? e.message : String(e));\n\t\t\t\treturn undefined;\n\t\t\t}\n\t\t}));\n\t\tconst result = [];\n\t\tconst seen = new ResourceSet();\n\t\tfor (const detail of details) {\n\t\t\tif (detail) {\n\t\t\t\tresult.push(detail);\n\t\t\t\tseen.add(detail.promptPath.uri);\n\t\t\t}\n\t\t}\n\t\tfor (const model of this.modelService.getModels()) {\n\t\t\tif (model.getLanguageId() === PROMPT_LANGUAGE_ID && model.uri.scheme === Schemas.untitled && !seen.has(model.uri)) {\n\t\t\t\tconst parsedPromptFile = this.getParsedPromptFile(model);\n\t\t\t\tresult.push(this.asChatPromptSlashCommand(parsedPromptFile, { uri: model.uri, storage: PromptsStorage.local, type: PromptsType.prompt }));\n\t\t\t}\n\t\t}\n\t\treturn result;\n\t}\n\n\tpublic isValidSlashCommandName(command: string): boolean {\n\t\treturn command.match(/^[\\p{L}\\d_\\-\\.]+$/u) !== null;\n\t}\n\n\tpublic async resolvePromptSlashCommand(name: string, token: CancellationToken): Promise<IChatPromptSlashCommand | undefined> {\n\t\tconst commands = await this.getPromptSlashCommands(token);\n\t\treturn commands.find(cmd => cmd.name === name);\n\t}\n\n\tprivate asChatPromptSlashCommand(parsedPromptFile: ParsedPromptFile, promptPath: IPromptPath): IChatPromptSlashCommand {\n\t\tlet name = parsedPromptFile?.header?.name ?? promptPath.name ?? getCleanPromptName(promptPath.uri);\n\t\tname = name.replace(/[^\\p{L}\\d_\\-\\.]+/gu, '-'); // replace spaces with dashes\n\t\treturn {\n\t\t\tname: name,\n\t\t\tdescription: parsedPromptFile?.header?.description ?? promptPath.description,\n\t\t\targumentHint: parsedPromptFile?.header?.argumentHint,\n\t\t\tparsedPromptFile,\n\t\t\tpromptPath\n\t\t};\n\t}\n\n\tpublic async getPromptSlashCommandName(uri: URI, token: CancellationToken): Promise<string> {\n\t\tconst slashCommands = await this.getPromptSlashCommands(token);\n\t\tconst slashCommand = slashCommands.find(c => isEqual(c.promptPath.uri, uri));\n\t\tif (!slashCommand) {\n\t\t\treturn getCleanPromptName(uri);\n\t\t}\n\t\treturn slashCommand.name;\n\t}\n\n\t// custom agents\n\n\t/**\n\t * Emitter for custom agents change events.\n\t */\n\tpublic get onDidChangeCustomAgents(): Event<void> {\n\t\treturn this.cachedCustomAgents.onDidChange;\n\t}\n\n\tpublic async getCustomAgents(token: CancellationToken): Promise<readonly ICustomAgent[]> {\n\t\treturn this.cachedCustomAgents.get(token);\n\t}\n\n\tprivate async computeCustomAgents(token: CancellationToken): Promise<readonly ICustomAgent[]> {\n\t\tlet agentFiles = await this.listPromptFiles(PromptsType.agent, token);\n\t\tconst disabledAgents = this.getDisabledPromptFiles(PromptsType.agent);\n\t\tagentFiles = agentFiles.filter(promptPath => !disabledAgents.has(promptPath.uri));\n\t\tconst customAgents = await Promise.all(\n\t\t\tagentFiles.map(async (promptPath): Promise<ICustomAgent> => {\n\t\t\t\tconst uri = promptPath.uri;\n\t\t\t\tconst ast = await this.parseNew(uri, token);\n\n\t\t\t\tlet metadata: any | undefined;\n\t\t\t\tif (ast.header) {\n\t\t\t\t\tconst advanced = ast.header.getAttribute(PromptHeaderAttributes.advancedOptions);\n\t\t\t\t\tif (advanced && advanced.value.type === 'object') {\n\t\t\t\t\t\tmetadata = {};\n\t\t\t\t\t\tfor (const [key, value] of Object.entries(advanced.value)) {\n\t\t\t\t\t\t\tif (['string', 'number', 'boolean'].includes(value.type)) {\n\t\t\t\t\t\t\t\tmetadata[key] = value;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tconst toolReferences: IVariableReference[] = [];\n\t\t\t\tif (ast.body) {\n\t\t\t\t\tconst bodyOffset = ast.body.offset;\n\t\t\t\t\tconst bodyVarRefs = ast.body.variableReferences;\n\t\t\t\t\tfor (let i = bodyVarRefs.length - 1; i >= 0; i--) { // in reverse order\n\t\t\t\t\t\tconst { name, offset } = bodyVarRefs[i];\n\t\t\t\t\t\tconst range = new OffsetRange(offset - bodyOffset, offset - bodyOffset + name.length + 1);\n\t\t\t\t\t\ttoolReferences.push({ name, range });\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tconst agentInstructions = {\n\t\t\t\t\tcontent: ast.body?.getContent() ?? '',\n\t\t\t\t\ttoolReferences,\n\t\t\t\t\tmetadata,\n\t\t\t\t} satisfies IAgentInstructions;\n\n\t\t\t\tconst name = ast.header?.name ?? promptPath.name ?? getCleanPromptName(uri);\n\n\t\t\t\tconst source: IAgentSource = IAgentSource.fromPromptPath(promptPath);\n\t\t\t\tif (!ast.header) {\n\t\t\t\t\treturn { uri, name, agentInstructions, source };\n\t\t\t\t}\n\t\t\t\tconst { description, model, tools, handOffs, argumentHint, target } = ast.header;\n\t\t\t\treturn { uri, name, description, model, tools, handOffs, argumentHint, target, agentInstructions, source };\n\t\t\t})\n\t\t);\n\t\treturn customAgents;\n\t}\n\n\n\tpublic async parseNew(uri: URI, token: CancellationToken): Promise<ParsedPromptFile> {\n\t\tconst model = this.modelService.getModel(uri);\n\t\tif (model) {\n\t\t\treturn this.getParsedPromptFile(model);\n\t\t}\n\t\tconst fileContent = await this.fileService.readFile(uri);\n\t\tif (token.isCancellationRequested) {\n\t\t\tthrow new CancellationError();\n\t\t}\n\t\treturn new PromptFileParser().parse(uri, fileContent.value.toString());\n\t}\n\n\tpublic registerContributedFile(type: PromptsType, name: string, description: string, uri: URI, extension: IExtensionDescription) {\n\t\tconst bucket = this.contributedFiles[type];\n\t\tif (bucket.has(uri)) {\n\t\t\t// keep first registration per extension (handler filters duplicates per extension already)\n\t\t\treturn Disposable.None;\n\t\t}\n\t\tconst entryPromise = (async () => {\n\t\t\ttry {\n\t\t\t\tawait this.filesConfigService.updateReadonly(uri, true);\n\t\t\t} catch (e) {\n\t\t\t\tconst msg = e instanceof Error ? e.message : String(e);\n\t\t\t\tthis.logger.error(`[registerContributedFile] Failed to make prompt file readonly: ${uri}`, msg);\n\t\t\t}\n\t\t\treturn { uri, name, description, storage: PromptsStorage.extension, type, extension } satisfies IExtensionPromptPath;\n\t\t})();\n\t\tbucket.set(uri, entryPromise);\n\n\t\tconst flushCachesIfRequired = () => {\n\t\t\tthis.cachedFileLocations[type] = undefined;\n\t\t\tswitch (type) {\n\t\t\t\tcase PromptsType.agent:\n\t\t\t\t\tthis.cachedCustomAgents.refresh();\n\t\t\t\t\tbreak;\n\t\t\t\tcase PromptsType.prompt:\n\t\t\t\t\tthis.cachedSlashCommands.refresh();\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t};\n\t\tflushCachesIfRequired();\n\t\treturn {\n\t\t\tdispose: () => {\n\t\t\t\tbucket.delete(uri);\n\t\t\t\tflushCachesIfRequired();\n\t\t\t}\n\t\t};\n\t}\n\n\tgetPromptLocationLabel(promptPath: IPromptPath): string {\n\t\tswitch (promptPath.storage) {\n\t\t\tcase PromptsStorage.local: return this.labelService.getUriLabel(dirname(promptPath.uri), { relative: true });\n\t\t\tcase PromptsStorage.user: return localize('user-data-dir.capitalized', 'User Data');\n\t\t\tcase PromptsStorage.extension: {\n\t\t\t\treturn localize('extension.with.id', 'Extension: {0}', promptPath.extension.displayName ?? promptPath.extension.id);\n\t\t\t}\n\t\t\tdefault: throw new Error('Unknown prompt storage type');\n\t\t}\n\t}\n\n\tfindAgentMDsInWorkspace(token: CancellationToken): Promise<URI[]> {\n\t\treturn this.fileLocator.findAgentMDsInWorkspace(token);\n\t}\n\n\tpublic async listAgentMDs(token: CancellationToken, includeNested: boolean): Promise<URI[]> {\n\t\tconst useAgentMD = this.configurationService.getValue(PromptsConfig.USE_AGENT_MD);\n\t\tif (!useAgentMD) {\n\t\t\treturn [];\n\t\t}\n\t\tif (includeNested) {\n\t\t\treturn await this.fileLocator.findAgentMDsInWorkspace(token);\n\t\t} else {\n\t\t\treturn await this.fileLocator.findAgentMDsInWorkspaceRoots(token);\n\t\t}\n\t}\n\n\tpublic async listCopilotInstructionsMDs(token: CancellationToken): Promise<URI[]> {\n\t\tconst useCopilotInstructionsFiles = this.configurationService.getValue(PromptsConfig.USE_COPILOT_INSTRUCTION_FILES);\n\t\tif (!useCopilotInstructionsFiles) {\n\t\t\treturn [];\n\t\t}\n\t\treturn await this.fileLocator.findCopilotInstructionsMDsInWorkspace(token);\n\t}\n\n\tpublic getAgentFileURIFromModeFile(oldURI: URI): URI | undefined {\n\t\treturn this.fileLocator.getAgentFileURIFromModeFile(oldURI);\n\t}\n\n\t// --- Enabled Prompt Files -----------------------------------------------------------\n\n\tprivate readonly disabledPromptsStorageKeyPrefix = 'chat.disabledPromptFiles.';\n\n\tpublic getDisabledPromptFiles(type: PromptsType): ResourceSet {\n\t\t// Migration: if disabled key absent but legacy enabled key present, convert once.\n\t\tconst disabledKey = this.disabledPromptsStorageKeyPrefix + type;\n\t\tconst value = this.storageService.get(disabledKey, StorageScope.PROFILE, '[]');\n\t\tconst result = new ResourceSet();\n\t\ttry {\n\t\t\tconst arr = JSON.parse(value);\n\t\t\tif (Array.isArray(arr)) {\n\t\t\t\tfor (const s of arr) {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tresult.add(URI.revive(s));\n\t\t\t\t\t} catch {\n\t\t\t\t\t\t// ignore\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t} catch {\n\t\t\t// ignore invalid storage values\n\t\t}\n\t\treturn result;\n\t}\n\n\tpublic setDisabledPromptFiles(type: PromptsType, uris: ResourceSet): void {\n\t\tconst disabled = Array.from(uris).map(uri => uri.toJSON());\n\t\tthis.storageService.store(this.disabledPromptsStorageKeyPrefix + type, JSON.stringify(disabled), StorageScope.PROFILE, StorageTarget.USER);\n\t\tif (type === PromptsType.agent) {\n\t\t\tthis.cachedCustomAgents.refresh();\n\t\t}\n\t}\n\n\t// Claude skills\n\n\tpublic async findClaudeSkills(token: CancellationToken): Promise<IClaudeSkill[] | undefined> {\n\t\tconst useClaudeSkills = this.configurationService.getValue(PromptsConfig.USE_CLAUDE_SKILLS);\n\t\tif (useClaudeSkills) {\n\t\t\tconst result: IClaudeSkill[] = [];\n\t\t\tconst process = async (uri: URI, type: 'personal' | 'project'): Promise<void> => {\n\t\t\t\ttry {\n\t\t\t\t\tconst parsedFile = await this.parseNew(uri, token);\n\t\t\t\t\tconst name = parsedFile.header?.name;\n\t\t\t\t\tif (name) {\n\t\t\t\t\t\tresult.push({ uri, type, name, description: parsedFile.header?.description } satisfies IClaudeSkill);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.logger.error(`[findClaudeSkills] Claude skill file missing name attribute: ${uri}`);\n\t\t\t\t\t}\n\t\t\t\t} catch (e) {\n\t\t\t\t\tthis.logger.error(`[findClaudeSkills] Failed to parse Claude skill file: ${uri}`, e instanceof Error ? e.message : String(e));\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tconst workspaceSkills = await this.fileLocator.findClaudeSkillsInWorkspace(token);\n\t\t\tawait Promise.all(workspaceSkills.map(uri => process(uri, 'project')));\n\t\t\tconst userSkills = await this.fileLocator.findClaudeSkillsInUserHome(token);\n\t\t\tawait Promise.all(userSkills.map(uri => process(uri, 'personal')));\n\t\t\treturn result;\n\t\t}\n\t\treturn undefined;\n\t}\n}\n\n// helpers\n\nclass CachedPromise<T> extends Disposable {\n\tprivate cachedPromise: Promise<T> | undefined = undefined;\n\tprivate onDidUpdatePromiseEmitter: Emitter<void> | undefined = undefined;\n\n\tconstructor(private readonly computeFn: (token: CancellationToken) => Promise<T>, private readonly getEvent: () => Event<void>, private readonly delay: number = 0) {\n\t\tsuper();\n\t}\n\n\tpublic get onDidChange(): Event<void> {\n\t\tif (!this.onDidUpdatePromiseEmitter) {\n\t\t\tconst emitter = this.onDidUpdatePromiseEmitter = this._register(new Emitter<void>());\n\t\t\tconst delayer = this._register(new Delayer<void>(this.delay));\n\t\t\tthis._register(this.getEvent()(() => {\n\t\t\t\tthis.cachedPromise = undefined;\n\t\t\t\tdelayer.trigger(() => emitter.fire());\n\t\t\t}));\n\t\t}\n\t\treturn this.onDidUpdatePromiseEmitter.event;\n\t}\n\n\tpublic get(token: CancellationToken): Promise<T> {\n\t\tif (this.cachedPromise !== undefined) {\n\t\t\treturn this.cachedPromise;\n\t\t}\n\t\tconst result = this.computeFn(token);\n\t\tif (!this.onDidUpdatePromiseEmitter) {\n\t\t\treturn result; // only cache if there is an event listener\n\t\t}\n\t\tthis.cachedPromise = result;\n\t\tthis.onDidUpdatePromiseEmitter.fire();\n\t\treturn result;\n\t}\n\n\tpublic refresh(): void {\n\t\tthis.cachedPromise = undefined;\n\t\tthis.onDidUpdatePromiseEmitter?.fire();\n\t}\n}\n\ninterface ModelChangeEvent {\n\treadonly promptType: PromptsType;\n\treadonly uri: URI;\n}\n\nclass ModelChangeTracker extends Disposable {\n\n\tprivate readonly listeners = new ResourceMap<IDisposable>();\n\tprivate readonly onDidPromptModelChange: Emitter<ModelChangeEvent>;\n\n\tpublic get onDidPromptChange(): Event<ModelChangeEvent> {\n\t\treturn this.onDidPromptModelChange.event;\n\t}\n\n\tconstructor(modelService: IModelService) {\n\t\tsuper();\n\t\tthis.onDidPromptModelChange = this._register(new Emitter<ModelChangeEvent>());\n\t\tconst onAdd = (model: ITextModel) => {\n\t\t\tconst promptType = getPromptsTypeForLanguageId(model.getLanguageId());\n\t\t\tif (promptType !== undefined) {\n\t\t\t\tthis.listeners.set(model.uri, model.onDidChangeContent(() => this.onDidPromptModelChange.fire({ uri: model.uri, promptType })));\n\t\t\t}\n\t\t};\n\t\tconst onRemove = (languageId: string, uri: URI) => {\n\t\t\tconst promptType = getPromptsTypeForLanguageId(languageId);\n\t\t\tif (promptType !== undefined) {\n\t\t\t\tthis.listeners.get(uri)?.dispose();\n\t\t\t\tthis.listeners.delete(uri);\n\t\t\t\tthis.onDidPromptModelChange.fire({ uri, promptType });\n\t\t\t}\n\t\t};\n\t\tthis._register(modelService.onModelAdded(model => onAdd(model)));\n\t\tthis._register(modelService.onModelLanguageChanged(e => {\n\t\t\tonRemove(e.oldLanguageId, e.model.uri);\n\t\t\tonAdd(e.model);\n\t\t}));\n\t\tthis._register(modelService.onModelRemoved(model => onRemove(model.getLanguageId(), model.uri)));\n\t}\n\n\tpublic override dispose(): void {\n\t\tsuper.dispose();\n\t\tthis.listeners.forEach(listener => listener.dispose());\n\t\tthis.listeners.clear();\n\t}\n}\n\nnamespace IAgentSource {\n\texport function fromPromptPath(promptPath: IPromptPath): IAgentSource {\n\t\tif (promptPath.storage === PromptsStorage.extension) {\n\t\t\treturn {\n\t\t\t\tstorage: PromptsStorage.extension,\n\t\t\t\textensionId: promptPath.extension.identifier\n\t\t\t};\n\t\t} else {\n\t\t\treturn {\n\t\t\t\tstorage: promptPath.storage\n\t\t\t};\n\t\t}\n\t}\n}\n\n"]}