{"version":3,"sources":["vs/workbench/contrib/chat/common/languageModelToolsService.ts"],"names":[],"mappings":"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","file":"languageModelToolsService.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Separator } from '../../../../base/common/actions.js';\nimport { VSBuffer } from '../../../../base/common/buffer.js';\nimport { CancellationToken } from '../../../../base/common/cancellation.js';\nimport { Event } from '../../../../base/common/event.js';\nimport { IMarkdownString } from '../../../../base/common/htmlContent.js';\nimport { Iterable } from '../../../../base/common/iterator.js';\nimport { IJSONSchema } from '../../../../base/common/jsonSchema.js';\nimport { Disposable, IDisposable, toDisposable } from '../../../../base/common/lifecycle.js';\nimport { Schemas } from '../../../../base/common/network.js';\nimport { derived, IObservable, IReader, ITransaction, ObservableSet } from '../../../../base/common/observable.js';\nimport { ThemeIcon } from '../../../../base/common/themables.js';\nimport { URI } from '../../../../base/common/uri.js';\nimport { Location } from '../../../../editor/common/languages.js';\nimport { localize } from '../../../../nls.js';\nimport { ContextKeyExpression } from '../../../../platform/contextkey/common/contextkey.js';\nimport { ExtensionIdentifier } from '../../../../platform/extensions/common/extensions.js';\nimport { ByteSize } from '../../../../platform/files/common/files.js';\nimport { createDecorator } from '../../../../platform/instantiation/common/instantiation.js';\nimport { IProgress } from '../../../../platform/progress/common/progress.js';\nimport { UserSelectedTools } from './chatAgents.js';\nimport { IVariableReference } from './chatModes.js';\nimport { IChatExtensionsContent, IChatTodoListContent, IChatToolInputInvocationData, type IChatTerminalToolInvocationData } from './chatService.js';\nimport { ChatRequestToolReferenceEntry } from './chatVariableEntries.js';\nimport { LanguageModelPartAudience } from './languageModels.js';\nimport { PromptElementJSON, stringifyPromptElementJSON } from './tools/promptTsxTypes.js';\n\nexport interface IToolData {\n\tid: string;\n\tsource: ToolDataSource;\n\ttoolReferenceName?: string;\n\tlegacyToolReferenceFullNames?: string[];\n\ticon?: { dark: URI; light?: URI } | ThemeIcon;\n\twhen?: ContextKeyExpression;\n\ttags?: string[];\n\tdisplayName: string;\n\tuserDescription?: string;\n\tmodelDescription: string;\n\tinputSchema?: IJSONSchema;\n\tcanBeReferencedInPrompt?: boolean;\n\t/**\n\t * True if the tool runs in the (possibly remote) workspace, false if it runs\n\t * on the host, undefined if known.\n\t */\n\trunsInWorkspace?: boolean;\n\talwaysDisplayInputOutput?: boolean;\n\t/** True if this tool might ask for pre-approval */\n\tcanRequestPreApproval?: boolean;\n\t/** True if this tool might ask for post-approval */\n\tcanRequestPostApproval?: boolean;\n}\n\nexport interface IToolProgressStep {\n\treadonly message: string | IMarkdownString | undefined;\n\t/** 0-1 progress of the tool call */\n\treadonly progress?: number;\n}\n\nexport type ToolProgress = IProgress<IToolProgressStep>;\n\nexport type ToolDataSource =\n\t| {\n\t\ttype: 'extension';\n\t\tlabel: string;\n\t\textensionId: ExtensionIdentifier;\n\t}\n\t| {\n\t\ttype: 'mcp';\n\t\tlabel: string;\n\t\tserverLabel: string | undefined;\n\t\tinstructions: string | undefined;\n\t\tcollectionId: string;\n\t\tdefinitionId: string;\n\t}\n\t| {\n\t\ttype: 'user';\n\t\tlabel: string;\n\t\tfile: URI;\n\t}\n\t| {\n\t\ttype: 'internal';\n\t\tlabel: string;\n\t} | {\n\t\ttype: 'external';\n\t\tlabel: string;\n\t};\n\nexport namespace ToolDataSource {\n\n\texport const Internal: ToolDataSource = { type: 'internal', label: 'Built-In' };\n\n\t/** External tools may not be contributed or invoked, but may be invoked externally and described in an IChatToolInvocationSerialized */\n\texport const External: ToolDataSource = { type: 'external', label: 'External' };\n\n\texport function toKey(source: ToolDataSource): string {\n\t\tswitch (source.type) {\n\t\t\tcase 'extension': return `extension:${source.extensionId.value}`;\n\t\t\tcase 'mcp': return `mcp:${source.collectionId}:${source.definitionId}`;\n\t\t\tcase 'user': return `user:${source.file.toString()}`;\n\t\t\tcase 'internal': return 'internal';\n\t\t\tcase 'external': return 'external';\n\t\t}\n\t}\n\n\texport function equals(a: ToolDataSource, b: ToolDataSource): boolean {\n\t\treturn toKey(a) === toKey(b);\n\t}\n\n\texport function classify(source: ToolDataSource): { readonly ordinal: number; readonly label: string } {\n\t\tif (source.type === 'internal') {\n\t\t\treturn { ordinal: 1, label: localize('builtin', 'Built-In') };\n\t\t} else if (source.type === 'mcp') {\n\t\t\treturn { ordinal: 2, label: source.label };\n\t\t} else if (source.type === 'user') {\n\t\t\treturn { ordinal: 0, label: localize('user', 'User Defined') };\n\t\t} else {\n\t\t\treturn { ordinal: 3, label: source.label };\n\t\t}\n\t}\n}\n\nexport interface IToolInvocation {\n\tcallId: string;\n\ttoolId: string;\n\tparameters: Record<string, any>;\n\ttokenBudget?: number;\n\tcontext: IToolInvocationContext | undefined;\n\tchatRequestId?: string;\n\tchatInteractionId?: string;\n\t/**\n\t * Lets us add some nicer UI to toolcalls that came from a sub-agent, but in the long run, this should probably just be rendered in a similar way to thinking text + tool call groups\n\t */\n\tfromSubAgent?: boolean;\n\ttoolSpecificData?: IChatTerminalToolInvocationData | IChatToolInputInvocationData | IChatExtensionsContent | IChatTodoListContent;\n\tmodelId?: string;\n\tuserSelectedTools?: UserSelectedTools;\n}\n\nexport interface IToolInvocationContext {\n\t/** @deprecated Use {@link sessionResource} instead */\n\treadonly sessionId: string;\n\treadonly sessionResource: URI;\n}\n\nexport function isToolInvocationContext(obj: any): obj is IToolInvocationContext {\n\treturn typeof obj === 'object' && typeof obj.sessionId === 'string' && URI.isUri(obj.sessionResource);\n}\n\nexport interface IToolInvocationPreparationContext {\n\tparameters: any;\n\tchatRequestId?: string;\n\tchatSessionId?: string;\n\tchatInteractionId?: string;\n}\n\nexport type ToolInputOutputBase = {\n\t/** Mimetype of the value, optional */\n\tmimeType?: string;\n\t/** URI of the resource on the MCP server. */\n\turi?: URI;\n\t/** If true, this part came in as a resource reference rather than direct data. */\n\tasResource?: boolean;\n\t/** Audience of the data part */\n\taudience?: LanguageModelPartAudience[];\n};\n\nexport type ToolInputOutputEmbedded = ToolInputOutputBase & {\n\ttype: 'embed';\n\tvalue: string;\n\t/** If true, value is text. If false or not given, value is base64 */\n\tisText?: boolean;\n};\n\nexport type ToolInputOutputReference = ToolInputOutputBase & { type: 'ref'; uri: URI };\n\nexport interface IToolResultInputOutputDetails {\n\treadonly input: string;\n\treadonly output: (ToolInputOutputEmbedded | ToolInputOutputReference)[];\n\treadonly isError?: boolean;\n}\n\nexport interface IToolResultOutputDetails {\n\treadonly output: { type: 'data'; mimeType: string; value: VSBuffer };\n}\n\nexport function isToolResultInputOutputDetails(obj: any): obj is IToolResultInputOutputDetails {\n\treturn typeof obj === 'object' && typeof obj?.input === 'string' && (typeof obj?.output === 'string' || Array.isArray(obj?.output));\n}\n\nexport function isToolResultOutputDetails(obj: any): obj is IToolResultOutputDetails {\n\treturn typeof obj === 'object' && typeof obj?.output === 'object' && typeof obj?.output?.mimeType === 'string' && obj?.output?.type === 'data';\n}\n\nexport interface IToolResult {\n\tcontent: (IToolResultPromptTsxPart | IToolResultTextPart | IToolResultDataPart)[];\n\ttoolResultMessage?: string | IMarkdownString;\n\ttoolResultDetails?: Array<URI | Location> | IToolResultInputOutputDetails | IToolResultOutputDetails;\n\ttoolResultError?: string;\n\ttoolMetadata?: unknown;\n\t/** Whether to ask the user to confirm these tool results. Overrides {@link IToolConfirmationMessages.confirmResults}. */\n\tconfirmResults?: boolean;\n}\n\nexport function toolContentToA11yString(part: IToolResult['content']) {\n\treturn part.map(p => {\n\t\tswitch (p.kind) {\n\t\t\tcase 'promptTsx':\n\t\t\t\treturn stringifyPromptTsxPart(p);\n\t\t\tcase 'text':\n\t\t\t\treturn p.value;\n\t\t\tcase 'data':\n\t\t\t\treturn localize('toolResultDataPartA11y', \"{0} of {1} binary data\", ByteSize.formatSize(p.value.data.byteLength), p.value.mimeType || 'unknown');\n\t\t}\n\t}).join(', ');\n}\n\nexport function toolResultHasBuffers(result: IToolResult): boolean {\n\treturn result.content.some(part => part.kind === 'data');\n}\n\nexport interface IToolResultPromptTsxPart {\n\tkind: 'promptTsx';\n\tvalue: unknown;\n}\n\nexport function stringifyPromptTsxPart(part: IToolResultPromptTsxPart): string {\n\treturn stringifyPromptElementJSON(part.value as PromptElementJSON);\n}\n\nexport interface IToolResultTextPart {\n\tkind: 'text';\n\tvalue: string;\n\taudience?: LanguageModelPartAudience[];\n}\n\nexport interface IToolResultDataPart {\n\tkind: 'data';\n\tvalue: {\n\t\tmimeType: string;\n\t\tdata: VSBuffer;\n\t};\n\taudience?: LanguageModelPartAudience[];\n}\n\nexport interface IToolConfirmationMessages {\n\t/** Title for the confirmation. If set, the user will be asked to confirm execution of the tool */\n\ttitle?: string | IMarkdownString;\n\t/** MUST be set if `title` is also set */\n\tmessage?: string | IMarkdownString;\n\tdisclaimer?: string | IMarkdownString;\n\tallowAutoConfirm?: boolean;\n\tterminalCustomActions?: ToolConfirmationAction[];\n\t/** If true, confirmation will be requested after the tool executes and before results are sent to the model */\n\tconfirmResults?: boolean;\n}\n\nexport interface IToolConfirmationAction {\n\tlabel: string;\n\tdisabled?: boolean;\n\ttooltip?: string;\n\tdata: any;\n}\n\nexport type ToolConfirmationAction = IToolConfirmationAction | Separator;\n\nexport enum ToolInvocationPresentation {\n\tHidden = 'hidden',\n\tHiddenAfterComplete = 'hiddenAfterComplete'\n}\n\nexport interface IPreparedToolInvocation {\n\tinvocationMessage?: string | IMarkdownString;\n\tpastTenseMessage?: string | IMarkdownString;\n\toriginMessage?: string | IMarkdownString;\n\tconfirmationMessages?: IToolConfirmationMessages;\n\tpresentation?: ToolInvocationPresentation;\n\ttoolSpecificData?: IChatTerminalToolInvocationData | IChatToolInputInvocationData | IChatExtensionsContent | IChatTodoListContent;\n}\n\nexport interface IToolImpl {\n\tinvoke(invocation: IToolInvocation, countTokens: CountTokensCallback, progress: ToolProgress, token: CancellationToken): Promise<IToolResult>;\n\tprepareToolInvocation?(context: IToolInvocationPreparationContext, token: CancellationToken): Promise<IPreparedToolInvocation | undefined>;\n}\n\nexport type IToolAndToolSetEnablementMap = ReadonlyMap<IToolData | ToolSet, boolean>;\n\nexport class ToolSet {\n\n\tprotected readonly _tools = new ObservableSet<IToolData>();\n\n\tprotected readonly _toolSets = new ObservableSet<ToolSet>();\n\n\t/**\n\t * A homogenous tool set only contains tools from the same source as the tool set itself\n\t */\n\treadonly isHomogenous: IObservable<boolean>;\n\n\tconstructor(\n\t\treadonly id: string,\n\t\treadonly referenceName: string,\n\t\treadonly icon: ThemeIcon,\n\t\treadonly source: ToolDataSource,\n\t\treadonly description?: string,\n\t\treadonly legacyFullNames?: string[],\n\t) {\n\n\t\tthis.isHomogenous = derived(r => {\n\t\t\treturn !Iterable.some(this._tools.observable.read(r), tool => !ToolDataSource.equals(tool.source, this.source))\n\t\t\t\t&& !Iterable.some(this._toolSets.observable.read(r), toolSet => !ToolDataSource.equals(toolSet.source, this.source));\n\t\t});\n\t}\n\n\taddTool(data: IToolData, tx?: ITransaction): IDisposable {\n\t\tthis._tools.add(data, tx);\n\t\treturn toDisposable(() => {\n\t\t\tthis._tools.delete(data);\n\t\t});\n\t}\n\n\taddToolSet(toolSet: ToolSet, tx?: ITransaction): IDisposable {\n\t\tif (toolSet === this) {\n\t\t\treturn Disposable.None;\n\t\t}\n\t\tthis._toolSets.add(toolSet, tx);\n\t\treturn toDisposable(() => {\n\t\t\tthis._toolSets.delete(toolSet);\n\t\t});\n\t}\n\n\tgetTools(r?: IReader): Iterable<IToolData> {\n\t\treturn Iterable.concat(\n\t\t\tthis._tools.observable.read(r),\n\t\t\t...Iterable.map(this._toolSets.observable.read(r), toolSet => toolSet.getTools(r))\n\t\t);\n\t}\n}\n\n\nexport const ILanguageModelToolsService = createDecorator<ILanguageModelToolsService>('ILanguageModelToolsService');\n\nexport type CountTokensCallback = (input: string, token: CancellationToken) => Promise<number>;\n\nexport interface ILanguageModelToolsService {\n\t_serviceBrand: undefined;\n\treadonly vscodeToolSet: ToolSet;\n\treadonly launchToolSet: ToolSet;\n\treadonly onDidChangeTools: Event<void>;\n\treadonly onDidPrepareToolCallBecomeUnresponsive: Event<{ readonly sessionId: string; readonly toolData: IToolData }>;\n\tregisterToolData(toolData: IToolData): IDisposable;\n\tregisterToolImplementation(id: string, tool: IToolImpl): IDisposable;\n\tregisterTool(toolData: IToolData, tool: IToolImpl): IDisposable;\n\tgetTools(): Iterable<Readonly<IToolData>>;\n\tgetTool(id: string): IToolData | undefined;\n\tgetToolByName(name: string, includeDisabled?: boolean): IToolData | undefined;\n\tinvokeTool(invocation: IToolInvocation, countTokens: CountTokensCallback, token: CancellationToken): Promise<IToolResult>;\n\tcancelToolCallsForRequest(requestId: string): void;\n\t/** Flush any pending tool updates to the extension hosts. */\n\tflushToolUpdates(): void;\n\n\treadonly toolSets: IObservable<Iterable<ToolSet>>;\n\tgetToolSet(id: string): ToolSet | undefined;\n\tgetToolSetByName(name: string): ToolSet | undefined;\n\tcreateToolSet(source: ToolDataSource, id: string, referenceName: string, options?: { icon?: ThemeIcon; description?: string; legacyFullNames?: string[] }): ToolSet & IDisposable;\n\n\t// tool names in prompt files handling ('qualified names')\n\n\tgetQualifiedToolNames(): Iterable<string>;\n\tgetToolByQualifiedName(qualifiedName: string): IToolData | ToolSet | undefined;\n\tgetQualifiedToolName(tool: IToolData, toolSet?: ToolSet): string;\n\tgetDeprecatedQualifiedToolNames(): Map<string, Set<string>>;\n\tmapGithubToolName(githubToolName: string): string;\n\n\ttoToolAndToolSetEnablementMap(qualifiedToolOrToolSetNames: readonly string[], target: string | undefined): IToolAndToolSetEnablementMap;\n\ttoQualifiedToolNames(map: IToolAndToolSetEnablementMap): string[];\n\ttoToolReferences(variableReferences: readonly IVariableReference[]): ChatRequestToolReferenceEntry[];\n}\n\nexport function createToolInputUri(toolCallId: string): URI {\n\treturn URI.from({ scheme: Schemas.inMemory, path: `/lm/tool/${toolCallId}/tool_input.json` });\n}\n\nexport function createToolSchemaUri(toolOrId: IToolData | string): URI {\n\tif (typeof toolOrId !== 'string') {\n\t\ttoolOrId = toolOrId.id;\n\t}\n\treturn URI.from({ scheme: Schemas.vscode, authority: 'schemas', path: `/lm/tool/${toolOrId}` });\n}\n\nexport namespace GithubCopilotToolReference {\n\texport const shell = 'shell';\n\texport const edit = 'edit';\n\texport const search = 'search';\n\texport const customAgent = 'custom-agent';\n}\n\nexport namespace VSCodeToolReference {\n\texport const customAgent = 'agents';\n\texport const shell = 'shell';\n\texport const runSubagent = 'runSubagent';\n\texport const vscode = 'vscode';\n\texport const launch = 'launch';\n}\n"]}