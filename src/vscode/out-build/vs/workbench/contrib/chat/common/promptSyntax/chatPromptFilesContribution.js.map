{"version":3,"sources":["vs/workbench/contrib/chat/common/promptSyntax/chatPromptFilesContribution.ts"],"names":[],"mappings":"AAAA;;;gGAGgG;;;;;;;;;;AAEhG,OAAO,EAAE,QAAQ,EAAE,MAAM,uBAAuB,CAAC;AAEjD,OAAO,KAAK,kBAAkB,MAAM,8DAA8D,CAAC;AAEnG,OAAO,EAAE,QAAQ,EAAE,eAAe,EAAE,MAAM,yCAAyC,CAAC;AACpF,OAAO,EAAE,eAAe,EAAE,MAAM,6BAA6B,CAAC;AAC9D,OAAO,EAAE,WAAW,EAAE,MAAM,kBAAkB,CAAC;AAC/C,OAAO,EAAE,aAAa,EAAE,MAAM,yCAAyC,CAAC;AAUxE,SAAS,+BAA+B,CAAC,KAA4B;IACpE,OAAO,kBAAkB,CAAC,kBAAkB,CAAC,sBAAsB,CAA6B;QAC/F,cAAc,EAAE,KAAK;QACrB,UAAU,EAAE;YACX,WAAW,EAAE,QAAQ,CAAC,IAAqC,EAAE,IAAmC,EAAE,KAAK,CAAC;YACxG,IAAI,EAAE,OAAO;YACb,KAAK,EAAE;gBACN,oBAAoB,EAAE,KAAK;gBAC3B,IAAI,EAAE,QAAQ;gBACd,eAAe,EAAE,CAAC;wBACjB,IAAI,EAAE;4BACL,IAAI,EAAE,aAAa;4BACnB,IAAI,EAAE,4BAA4B;4BAClC,WAAW,EAAE,sBAAsB;yBACnC;qBACD,CAAC;gBACF,QAAQ,EAAE,CAAC,MAAM,EAAE,MAAM,CAAC;gBAC1B,UAAU,EAAE;oBACX,IAAI,EAAE;wBACL,WAAW,EAAE,QAAQ,CAAC,IAAgC,EAAE,IAA6F,CAAC;wBACtJ,IAAI,EAAE,QAAQ;wBACd,OAAO,EAAE,YAAY;qBACrB;oBACD,IAAI,EAAE;wBACL,WAAW,EAAE,QAAQ,CAAC,IAAgC,EAAE,IAAkD,CAAC;wBAC3G,IAAI,EAAE,QAAQ;qBACd;oBACD,WAAW,EAAE;wBACZ,WAAW,EAAE,QAAQ,CAAC,IAAuC,EAAE,IAAqC,CAAC;wBACrG,IAAI,EAAE,QAAQ;qBACd;iBACD;aACD;SACD;KACD,CAAC,CAAC;AACJ,CAAC;AAED,MAAM,QAAQ,GAAG,+BAA+B,CAAC,iBAAiB,CAAC,CAAC;AACpE,MAAM,cAAc,GAAG,+BAA+B,CAAC,kBAAkB,CAAC,CAAC;AAC3E,MAAM,QAAQ,GAAG,+BAA+B,CAAC,YAAY,CAAC,CAAC;AAE/D,SAAS,WAAW,CAAC,iBAAwC;IAC5D,QAAQ,iBAAiB,EAAE,CAAC;QAC3B,KAAK,iBAAiB,CAAC,CAAC,OAAO,WAAW,CAAC,MAAM,CAAC;QAClD,KAAK,kBAAkB,CAAC,CAAC,OAAO,WAAW,CAAC,YAAY,CAAC;QACzD,KAAK,YAAY,CAAC,CAAC,OAAO,WAAW,CAAC,KAAK,CAAC;IAC7C,CAAC;AACF,CAAC;AAED,SAAS,GAAG,CAAC,WAAgC,EAAE,IAAiB,EAAE,IAAY;IAC7E,OAAO,GAAG,WAAW,CAAC,KAAK,IAAI,IAAI,IAAI,IAAI,EAAE,CAAC;AAC/C,CAAC;AAEM,IAAM,oCAAoC,GAA1C,MAAM,oCAAoC;aACzB,OAAE,GAAG,wDAAH,AAA2D,CAAC;IAIrF,YACkB,cAAgD;QAA/B,mBAAc,GAAd,cAAc,CAAiB;QAHjD,kBAAa,GAAG,IAAI,aAAa,EAAU,CAAC;QAK5D,IAAI,CAAC,MAAM,CAAC,QAAQ,EAAE,iBAAiB,CAAC,CAAC;QACzC,IAAI,CAAC,MAAM,CAAC,cAAc,EAAE,kBAAkB,CAAC,CAAC;QAChD,IAAI,CAAC,MAAM,CAAC,QAAQ,EAAE,YAAY,CAAC,CAAC;IACrC,CAAC;IAEO,MAAM,CAAC,cAA8E,EAAE,iBAAwC;QACtI,cAAc,CAAC,UAAU,CAAC,CAAC,WAAW,EAAE,KAAK,EAAE,EAAE;YAChD,KAAK,MAAM,GAAG,IAAI,KAAK,CAAC,KAAK,EAAE,CAAC;gBAC/B,MAAM,IAAI,GAAG,WAAW,CAAC,iBAAiB,CAAC,CAAC;gBAC5C,KAAK,MAAM,GAAG,IAAI,GAAG,CAAC,KAAK,EAAE,CAAC;oBAC7B,IAAI,CAAC,GAAG,CAAC,IAAI,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,KAAK,CAAC,WAAW,CAAC,EAAE,CAAC;wBAC/C,GAAG,CAAC,SAAS,CAAC,KAAK,CAAC,QAAQ,CAAC,IAAwB,EAAE,IAAoE,EAAE,GAAG,CAAC,WAAW,CAAC,UAAU,CAAC,KAAK,EAAE,iBAAiB,EAAE,GAAG,CAAC,IAAI,CAAC,CAAC,CAAC;wBAC7L,SAAS;oBACV,CAAC;oBACD,IAAI,CAAC,GAAG,CAAC,IAAI,EAAE,CAAC;wBACf,GAAG,CAAC,SAAS,CAAC,KAAK,CAAC,QAAQ,CAAC,IAAwB,EAAE,IAA+D,EAAE,GAAG,CAAC,WAAW,CAAC,UAAU,CAAC,KAAK,EAAE,iBAAiB,EAAE,GAAG,CAAC,IAAI,CAAC,CAAC,CAAC;wBACxL,SAAS;oBACV,CAAC;oBACD,IAAI,CAAC,GAAG,CAAC,WAAW,EAAE,CAAC;wBACtB,GAAG,CAAC,SAAS,CAAC,KAAK,CAAC,QAAQ,CAAC,IAA+B,EAAE,IAAsE,EAAE,GAAG,CAAC,WAAW,CAAC,UAAU,CAAC,KAAK,EAAE,iBAAiB,EAAE,GAAG,CAAC,IAAI,CAAC,CAAC,CAAC;wBACtM,SAAS;oBACV,CAAC;oBACD,MAAM,OAAO,GAAG,QAAQ,CAAC,GAAG,CAAC,WAAW,CAAC,iBAAiB,EAAE,GAAG,CAAC,IAAI,CAAC,CAAC;oBACtE,IAAI,CAAC,eAAe,CAAC,OAAO,EAAE,GAAG,CAAC,WAAW,CAAC,iBAAiB,CAAC,EAAE,CAAC;wBAClE,GAAG,CAAC,SAAS,CAAC,KAAK,CAAC,QAAQ,CAAC,IAAwB,EAAE,IAAsE,EAAE,GAAG,CAAC,WAAW,CAAC,UAAU,CAAC,KAAK,EAAE,iBAAiB,EAAE,GAAG,CAAC,IAAI,CAAC,CAAC,CAAC;wBAC/L,SAAS;oBACV,CAAC;oBACD,IAAI,CAAC;wBACJ,MAAM,CAAC,GAAG,IAAI,CAAC,cAAc,CAAC,uBAAuB,CAAC,IAAI,EAAE,GAAG,CAAC,IAAI,EAAE,GAAG,CAAC,WAAW,EAAE,OAAO,EAAE,GAAG,CAAC,WAAW,CAAC,CAAC;wBACjH,IAAI,CAAC,aAAa,CAAC,GAAG,CAAC,GAAG,CAAC,GAAG,CAAC,WAAW,CAAC,UAAU,EAAE,IAAI,EAAE,GAAG,CAAC,IAAI,CAAC,EAAE,CAAC,CAAC,CAAC;oBAC5E,CAAC;oBAAC,OAAO,CAAC,EAAE,CAAC;wBACZ,MAAM,GAAG,GAAG,CAAC,YAAY,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC,OAAO,CAAC,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC;wBACvD,GAAG,CAAC,SAAS,CAAC,KAAK,CAAC,QAAQ,CAAC,IAA+B,EAAE,IAAyC,EAAE,iBAAiB,EAAE,GAAG,CAAC,IAAI,EAAE,GAAG,CAAC,CAAC,CAAC;oBAC7I,CAAC;gBACF,CAAC;YACF,CAAC;YACD,KAAK,MAAM,GAAG,IAAI,KAAK,CAAC,OAAO,EAAE,CAAC;gBACjC,MAAM,IAAI,GAAG,WAAW,CAAC,iBAAiB,CAAC,CAAC;gBAC5C,KAAK,MAAM,GAAG,IAAI,GAAG,CAAC,KAAK,EAAE,CAAC;oBAC7B,IAAI,CAAC,aAAa,CAAC,gBAAgB,CAAC,GAAG,CAAC,GAAG,CAAC,WAAW,CAAC,UAAU,EAAE,IAAI,EAAE,GAAG,CAAC,IAAI,CAAC,CAAC,CAAC;gBACtF,CAAC;YACF,CAAC;QACF,CAAC,CAAC,CAAC;IACJ,CAAC;;AAnDW,oCAAoC;IAM9C,WAAA,eAAe,CAAA;GANL,oCAAoC,CAoDhD","file":"chatPromptFilesContribution.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { localize } from '../../../../../nls.js';\nimport { IWorkbenchContribution } from '../../../../common/contributions.js';\nimport * as extensionsRegistry from '../../../../services/extensions/common/extensionsRegistry.js';\nimport { ExtensionIdentifier } from '../../../../../platform/extensions/common/extensions.js';\nimport { joinPath, isEqualOrParent } from '../../../../../base/common/resources.js';\nimport { IPromptsService } from './service/promptsService.js';\nimport { PromptsType } from './promptTypes.js';\nimport { DisposableMap } from '../../../../../base/common/lifecycle.js';\n\ninterface IRawChatFileContribution {\n\treadonly name: string;\n\treadonly path: string;\n\treadonly description?: string; // reserved for future use\n}\n\ntype ChatContributionPoint = 'chatPromptFiles' | 'chatInstructions' | 'chatAgents';\n\nfunction registerChatFilesExtensionPoint(point: ChatContributionPoint) {\n\treturn extensionsRegistry.ExtensionsRegistry.registerExtensionPoint<IRawChatFileContribution[]>({\n\t\textensionPoint: point,\n\t\tjsonSchema: {\n\t\t\tdescription: localize('chatContribution.schema.description', 'Contributes {0} for chat prompts.', point),\n\t\t\ttype: 'array',\n\t\t\titems: {\n\t\t\t\tadditionalProperties: false,\n\t\t\t\ttype: 'object',\n\t\t\t\tdefaultSnippets: [{\n\t\t\t\t\tbody: {\n\t\t\t\t\t\tname: 'exampleName',\n\t\t\t\t\t\tpath: './relative/path/to/file.md',\n\t\t\t\t\t\tdescription: 'Optional description'\n\t\t\t\t\t}\n\t\t\t\t}],\n\t\t\t\trequired: ['name', 'path'],\n\t\t\t\tproperties: {\n\t\t\t\t\tname: {\n\t\t\t\t\t\tdescription: localize('chatContribution.property.name', 'Identifier for this file. Must be unique within this extension for this contribution point.'),\n\t\t\t\t\t\ttype: 'string',\n\t\t\t\t\t\tpattern: '^[\\\\w.-]+$'\n\t\t\t\t\t},\n\t\t\t\t\tpath: {\n\t\t\t\t\t\tdescription: localize('chatContribution.property.path', 'Path to the file relative to the extension root.'),\n\t\t\t\t\t\ttype: 'string'\n\t\t\t\t\t},\n\t\t\t\t\tdescription: {\n\t\t\t\t\t\tdescription: localize('chatContribution.property.description', '(Optional) Description of the file.'),\n\t\t\t\t\t\ttype: 'string'\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t});\n}\n\nconst epPrompt = registerChatFilesExtensionPoint('chatPromptFiles');\nconst epInstructions = registerChatFilesExtensionPoint('chatInstructions');\nconst epAgents = registerChatFilesExtensionPoint('chatAgents');\n\nfunction pointToType(contributionPoint: ChatContributionPoint): PromptsType {\n\tswitch (contributionPoint) {\n\t\tcase 'chatPromptFiles': return PromptsType.prompt;\n\t\tcase 'chatInstructions': return PromptsType.instructions;\n\t\tcase 'chatAgents': return PromptsType.agent;\n\t}\n}\n\nfunction key(extensionId: ExtensionIdentifier, type: PromptsType, name: string) {\n\treturn `${extensionId.value}/${type}/${name}`;\n}\n\nexport class ChatPromptFilesExtensionPointHandler implements IWorkbenchContribution {\n\tpublic static readonly ID = 'workbench.contrib.chatPromptFilesExtensionPointHandler';\n\n\tprivate readonly registrations = new DisposableMap<string>();\n\n\tconstructor(\n\t\t@IPromptsService private readonly promptsService: IPromptsService,\n\t) {\n\t\tthis.handle(epPrompt, 'chatPromptFiles');\n\t\tthis.handle(epInstructions, 'chatInstructions');\n\t\tthis.handle(epAgents, 'chatAgents');\n\t}\n\n\tprivate handle(extensionPoint: extensionsRegistry.IExtensionPoint<IRawChatFileContribution[]>, contributionPoint: ChatContributionPoint) {\n\t\textensionPoint.setHandler((_extensions, delta) => {\n\t\t\tfor (const ext of delta.added) {\n\t\t\t\tconst type = pointToType(contributionPoint);\n\t\t\t\tfor (const raw of ext.value) {\n\t\t\t\t\tif (!raw.name || !raw.name.match(/^[\\w.-]+$/)) {\n\t\t\t\t\t\text.collector.error(localize('extension.invalid.name', \"Extension '{0}' cannot register {1} entry with invalid name '{2}'.\", ext.description.identifier.value, contributionPoint, raw.name));\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\t\tif (!raw.path) {\n\t\t\t\t\t\text.collector.error(localize('extension.missing.path', \"Extension '{0}' cannot register {1} entry '{2}' without path.\", ext.description.identifier.value, contributionPoint, raw.name));\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\t\tif (!raw.description) {\n\t\t\t\t\t\text.collector.error(localize('extension.missing.description', \"Extension '{0}' cannot register {1} entry '{2}' without description.\", ext.description.identifier.value, contributionPoint, raw.name));\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\t\tconst fileUri = joinPath(ext.description.extensionLocation, raw.path);\n\t\t\t\t\tif (!isEqualOrParent(fileUri, ext.description.extensionLocation)) {\n\t\t\t\t\t\text.collector.error(localize('extension.invalid.path', \"Extension '{0}' {1} entry '{2}' path resolves outside the extension.\", ext.description.identifier.value, contributionPoint, raw.name));\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\t\ttry {\n\t\t\t\t\t\tconst d = this.promptsService.registerContributedFile(type, raw.name, raw.description, fileUri, ext.description);\n\t\t\t\t\t\tthis.registrations.set(key(ext.description.identifier, type, raw.name), d);\n\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\tconst msg = e instanceof Error ? e.message : String(e);\n\t\t\t\t\t\text.collector.error(localize('extension.registration.failed', \"Failed to register {0} entry '{1}': {2}\", contributionPoint, raw.name, msg));\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tfor (const ext of delta.removed) {\n\t\t\t\tconst type = pointToType(contributionPoint);\n\t\t\t\tfor (const raw of ext.value) {\n\t\t\t\t\tthis.registrations.deleteAndDispose(key(ext.description.identifier, type, raw.name));\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n}\n"]}