{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/contrib/chat/common/promptSyntax/languageProviders/promptDocumentSemanticTokensProvider.ts","vs/workbench/contrib/chat/common/promptSyntax/languageProviders/promptDocumentSemanticTokensProvider.ts"],"names":[],"mappings":"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","file":"promptDocumentSemanticTokensProvider.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { CancellationToken } from '../../../../../../base/common/cancellation.js';\nimport { DocumentSemanticTokensProvider, ProviderResult, SemanticTokens, SemanticTokensLegend } from '../../../../../../editor/common/languages.js';\nimport { ITextModel } from '../../../../../../editor/common/model.js';\nimport { getPromptsTypeForLanguageId } from '../promptTypes.js';\nimport { IPromptsService } from '../service/promptsService.js';\nimport { isGithubTarget } from './promptValidator.js';\n\nexport class PromptDocumentSemanticTokensProvider implements DocumentSemanticTokensProvider {\n\t/**\n\t * Debug display name for this provider.\n\t */\n\tpublic readonly _debugDisplayName: string = 'PromptDocumentSemanticTokensProvider';\n\n\tconstructor(\n\t\t@IPromptsService private readonly promptsService: IPromptsService,\n\t) {\n\t}\n\n\tprovideDocumentSemanticTokens(model: ITextModel, lastResultId: string | null, token: CancellationToken): ProviderResult<SemanticTokens> {\n\t\tconst promptType = getPromptsTypeForLanguageId(model.getLanguageId());\n\t\tif (!promptType) {\n\t\t\t// if the model is not a prompt, we don't provide any semantic tokens\n\t\t\treturn undefined;\n\t\t}\n\n\t\tconst promptAST = this.promptsService.getParsedPromptFile(model);\n\t\tif (!promptAST.body) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\tif (isGithubTarget(promptType, promptAST.header?.target)) {\n\t\t\t// In Puku AI mode, we don't provide variable semantic tokens to tool references\n\t\t\treturn undefined;\n\t\t}\n\n\t\tconst variableReferences = promptAST.body.variableReferences;\n\t\tif (!variableReferences.length) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\t// Prepare semantic tokens data following the delta-encoded, 5-number tuple format:\n\t\t// [deltaLine, deltaStart, length, tokenType, tokenModifiers]\n\t\t// We expose a single token type 'variable' (index 0) and no modifiers (bitset 0).\n\t\tconst data: number[] = [];\n\t\tlet lastLine = 0;\n\t\tlet lastChar = 0;\n\n\t\t// Ensure stable order (parser already produces them in order, but sort defensively)\n\t\tconst ordered = [...variableReferences].sort((a, b) => a.range.startLineNumber === b.range.startLineNumber\n\t\t\t? a.range.startColumn - b.range.startColumn\n\t\t\t: a.range.startLineNumber - b.range.startLineNumber);\n\n\t\tfor (const ref of ordered) {\n\t\t\t// Also include the '#tool:' prefix for syntax highlighting purposes, even if it's not originally part of the variable name itself.\n\t\t\tconst extraCharCount = '#tool:'.length;\n\t\t\tconst line = ref.range.startLineNumber - 1; // zero-based\n\t\t\tconst char = ref.range.startColumn - extraCharCount - 1; // zero-based\n\t\t\tconst length = ref.range.endColumn - ref.range.startColumn + extraCharCount;\n\t\t\tconst deltaLine = line - lastLine;\n\t\t\tconst deltaChar = deltaLine === 0 ? char - lastChar : char;\n\t\t\tdata.push(deltaLine, deltaChar, length, 0 /* variable token type index */, 0 /* no modifiers */);\n\t\t\tlastLine = line;\n\t\t\tlastChar = char;\n\t\t\tif (token.isCancellationRequested) {\n\t\t\t\tbreak; // Return what we have so far if cancelled.\n\t\t\t}\n\t\t}\n\n\t\treturn { data: new Uint32Array(data) };\n\t}\n\n\tgetLegend(): SemanticTokensLegend {\n\t\treturn { tokenTypes: ['variable'], tokenModifiers: [] };\n\t}\n\n\treleaseDocumentSemanticTokens(resultId: string | undefined): void {\n\t\t// No caching/result management needed for the simple, stateless implementation.\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { CancellationToken } from '../../../../../../base/common/cancellation.js';\nimport { DocumentSemanticTokensProvider, ProviderResult, SemanticTokens, SemanticTokensLegend } from '../../../../../../editor/common/languages.js';\nimport { ITextModel } from '../../../../../../editor/common/model.js';\nimport { getPromptsTypeForLanguageId } from '../promptTypes.js';\nimport { IPromptsService } from '../service/promptsService.js';\nimport { isGithubTarget } from './promptValidator.js';\n\nexport class PromptDocumentSemanticTokensProvider implements DocumentSemanticTokensProvider {\n\t/**\n\t * Debug display name for this provider.\n\t */\n\tpublic readonly _debugDisplayName: string = 'PromptDocumentSemanticTokensProvider';\n\n\tconstructor(\n\t\t@IPromptsService private readonly promptsService: IPromptsService,\n\t) {\n\t}\n\n\tprovideDocumentSemanticTokens(model: ITextModel, lastResultId: string | null, token: CancellationToken): ProviderResult<SemanticTokens> {\n\t\tconst promptType = getPromptsTypeForLanguageId(model.getLanguageId());\n\t\tif (!promptType) {\n\t\t\t// if the model is not a prompt, we don't provide any semantic tokens\n\t\t\treturn undefined;\n\t\t}\n\n\t\tconst promptAST = this.promptsService.getParsedPromptFile(model);\n\t\tif (!promptAST.body) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\tif (isGithubTarget(promptType, promptAST.header?.target)) {\n\t\t\t// In Puku AI mode, we don't provide variable semantic tokens to tool references\n\t\t\treturn undefined;\n\t\t}\n\n\t\tconst variableReferences = promptAST.body.variableReferences;\n\t\tif (!variableReferences.length) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\t// Prepare semantic tokens data following the delta-encoded, 5-number tuple format:\n\t\t// [deltaLine, deltaStart, length, tokenType, tokenModifiers]\n\t\t// We expose a single token type 'variable' (index 0) and no modifiers (bitset 0).\n\t\tconst data: number[] = [];\n\t\tlet lastLine = 0;\n\t\tlet lastChar = 0;\n\n\t\t// Ensure stable order (parser already produces them in order, but sort defensively)\n\t\tconst ordered = [...variableReferences].sort((a, b) => a.range.startLineNumber === b.range.startLineNumber\n\t\t\t? a.range.startColumn - b.range.startColumn\n\t\t\t: a.range.startLineNumber - b.range.startLineNumber);\n\n\t\tfor (const ref of ordered) {\n\t\t\t// Also include the '#tool:' prefix for syntax highlighting purposes, even if it's not originally part of the variable name itself.\n\t\t\tconst extraCharCount = '#tool:'.length;\n\t\t\tconst line = ref.range.startLineNumber - 1; // zero-based\n\t\t\tconst char = ref.range.startColumn - extraCharCount - 1; // zero-based\n\t\t\tconst length = ref.range.endColumn - ref.range.startColumn + extraCharCount;\n\t\t\tconst deltaLine = line - lastLine;\n\t\t\tconst deltaChar = deltaLine === 0 ? char - lastChar : char;\n\t\t\tdata.push(deltaLine, deltaChar, length, 0 /* variable token type index */, 0 /* no modifiers */);\n\t\t\tlastLine = line;\n\t\t\tlastChar = char;\n\t\t\tif (token.isCancellationRequested) {\n\t\t\t\tbreak; // Return what we have so far if cancelled.\n\t\t\t}\n\t\t}\n\n\t\treturn { data: new Uint32Array(data) };\n\t}\n\n\tgetLegend(): SemanticTokensLegend {\n\t\treturn { tokenTypes: ['variable'], tokenModifiers: [] };\n\t}\n\n\treleaseDocumentSemanticTokens(resultId: string | undefined): void {\n\t\t// No caching/result management needed for the simple, stateless implementation.\n\t}\n}\n"]}