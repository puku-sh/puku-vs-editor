{"version":3,"sources":["vs/workbench/contrib/chat/common/languageModels.ts"],"names":[],"mappings":"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","file":"languageModels.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { SequencerByKey } from '../../../../base/common/async.js';\nimport { VSBuffer } from '../../../../base/common/buffer.js';\nimport { CancellationToken } from '../../../../base/common/cancellation.js';\nimport { Emitter, Event } from '../../../../base/common/event.js';\nimport { Iterable } from '../../../../base/common/iterator.js';\nimport { IJSONSchema, TypeFromJsonSchema } from '../../../../base/common/jsonSchema.js';\nimport { DisposableStore, IDisposable, toDisposable } from '../../../../base/common/lifecycle.js';\nimport { isFalsyOrWhitespace } from '../../../../base/common/strings.js';\nimport { ThemeIcon } from '../../../../base/common/themables.js';\nimport { URI } from '../../../../base/common/uri.js';\nimport { localize } from '../../../../nls.js';\nimport { IConfigurationService } from '../../../../platform/configuration/common/configuration.js';\nimport { ContextKeyExpr, IContextKey, IContextKeyService } from '../../../../platform/contextkey/common/contextkey.js';\nimport { ExtensionIdentifier } from '../../../../platform/extensions/common/extensions.js';\nimport { createDecorator } from '../../../../platform/instantiation/common/instantiation.js';\nimport { ILogService } from '../../../../platform/log/common/log.js';\nimport { IStorageService, StorageScope, StorageTarget } from '../../../../platform/storage/common/storage.js';\nimport { ChatEntitlement, IChatEntitlementService } from '../../../services/chat/common/chatEntitlementService.js';\nimport { IExtensionService } from '../../../services/extensions/common/extensions.js';\nimport { ExtensionsRegistry } from '../../../services/extensions/common/extensionsRegistry.js';\nimport { ChatContextKeys } from './chatContextKeys.js';\n\nexport const enum ChatMessageRole {\n\tSystem,\n\tUser,\n\tAssistant,\n}\n\nexport enum LanguageModelPartAudience {\n\tAssistant = 0,\n\tUser = 1,\n\tExtension = 2,\n}\n\nexport interface IChatMessageTextPart {\n\ttype: 'text';\n\tvalue: string;\n\taudience?: LanguageModelPartAudience[];\n}\n\nexport interface IChatMessageImagePart {\n\ttype: 'image_url';\n\tvalue: IChatImageURLPart;\n}\n\nexport interface IChatMessageThinkingPart {\n\ttype: 'thinking';\n\tvalue: string | string[];\n\tid?: string;\n\tmetadata?: { readonly [key: string]: any };\n}\n\nexport interface IChatMessageDataPart {\n\ttype: 'data';\n\tmimeType: string;\n\tdata: VSBuffer;\n\taudience?: LanguageModelPartAudience[];\n}\n\nexport interface IChatImageURLPart {\n\t/**\n\t * The image's MIME type (e.g., \"image/png\", \"image/jpeg\").\n\t */\n\tmimeType: ChatImageMimeType;\n\n\t/**\n\t * The raw binary data of the image, encoded as a Uint8Array. Note: do not use base64 encoding. Maximum image size is 5MB.\n\t */\n\tdata: VSBuffer;\n}\n\n/**\n * Enum for supported image MIME types.\n */\nexport enum ChatImageMimeType {\n\tPNG = 'image/png',\n\tJPEG = 'image/jpeg',\n\tGIF = 'image/gif',\n\tWEBP = 'image/webp',\n\tBMP = 'image/bmp',\n}\n\n/**\n * Specifies the detail level of the image.\n */\nexport enum ImageDetailLevel {\n\tLow = 'low',\n\tHigh = 'high'\n}\n\n\nexport interface IChatMessageToolResultPart {\n\ttype: 'tool_result';\n\ttoolCallId: string;\n\tvalue: (IChatResponseTextPart | IChatResponsePromptTsxPart | IChatResponseDataPart)[];\n\tisError?: boolean;\n}\n\nexport type IChatMessagePart = IChatMessageTextPart | IChatMessageToolResultPart | IChatResponseToolUsePart | IChatMessageImagePart | IChatMessageDataPart | IChatMessageThinkingPart;\n\nexport interface IChatMessage {\n\treadonly name?: string | undefined;\n\treadonly role: ChatMessageRole;\n\treadonly content: IChatMessagePart[];\n}\n\nexport interface IChatResponseTextPart {\n\ttype: 'text';\n\tvalue: string;\n\taudience?: LanguageModelPartAudience[];\n}\n\nexport interface IChatResponsePromptTsxPart {\n\ttype: 'prompt_tsx';\n\tvalue: unknown;\n}\n\nexport interface IChatResponseDataPart {\n\ttype: 'data';\n\tmimeType: string;\n\tdata: VSBuffer;\n\taudience?: LanguageModelPartAudience[];\n}\n\nexport interface IChatResponseToolUsePart {\n\ttype: 'tool_use';\n\tname: string;\n\ttoolCallId: string;\n\tparameters: any;\n}\n\nexport interface IChatResponseThinkingPart {\n\ttype: 'thinking';\n\tvalue: string | string[];\n\tid?: string;\n\tmetadata?: { readonly [key: string]: any };\n}\n\nexport interface IChatResponsePullRequestPart {\n\ttype: 'pullRequest';\n\turi: URI;\n\ttitle: string;\n\tdescription: string;\n\tauthor: string;\n\tlinkTag: string;\n}\n\nexport type IChatResponsePart = IChatResponseTextPart | IChatResponseToolUsePart | IChatResponseDataPart | IChatResponseThinkingPart;\n\nexport type IExtendedChatResponsePart = IChatResponsePullRequestPart;\n\nexport interface ILanguageModelChatMetadata {\n\treadonly extension: ExtensionIdentifier;\n\n\treadonly name: string;\n\treadonly id: string;\n\treadonly vendor: string;\n\treadonly version: string;\n\treadonly tooltip?: string;\n\treadonly detail?: string;\n\treadonly family: string;\n\treadonly maxInputTokens: number;\n\treadonly maxOutputTokens: number;\n\n\treadonly isDefault?: boolean;\n\treadonly isUserSelectable?: boolean;\n\treadonly statusIcon?: ThemeIcon;\n\treadonly modelPickerCategory: { label: string; order: number } | undefined;\n\treadonly auth?: {\n\t\treadonly providerLabel: string;\n\t\treadonly accountLabel?: string;\n\t};\n\treadonly capabilities?: {\n\t\treadonly vision?: boolean;\n\t\treadonly toolCalling?: boolean;\n\t\treadonly agentMode?: boolean;\n\t\treadonly editTools?: ReadonlyArray<string>;\n\t};\n}\n\nexport namespace ILanguageModelChatMetadata {\n\texport function suitableForAgentMode(metadata: ILanguageModelChatMetadata): boolean {\n\t\tconst supportsToolsAgent = typeof metadata.capabilities?.agentMode === 'undefined' || metadata.capabilities.agentMode;\n\t\treturn supportsToolsAgent && !!metadata.capabilities?.toolCalling;\n\t}\n\n\texport function asQualifiedName(metadata: ILanguageModelChatMetadata): string {\n\t\treturn `${metadata.name} (${metadata.vendor})`;\n\t}\n\n\texport function matchesQualifiedName(name: string, metadata: ILanguageModelChatMetadata): boolean {\n\t\tif (metadata.vendor === 'copilot' && name === metadata.name) {\n\t\t\treturn true;\n\t\t}\n\t\treturn name === asQualifiedName(metadata);\n\t}\n}\n\nexport interface ILanguageModelChatResponse {\n\tstream: AsyncIterable<IChatResponsePart | IChatResponsePart[]>;\n\tresult: Promise<any>;\n}\n\nexport interface ILanguageModelChatProvider {\n\treadonly onDidChange: Event<void>;\n\tprovideLanguageModelChatInfo(options: { silent: boolean }, token: CancellationToken): Promise<ILanguageModelChatMetadataAndIdentifier[]>;\n\tsendChatRequest(modelId: string, messages: IChatMessage[], from: ExtensionIdentifier, options: { [name: string]: any }, token: CancellationToken): Promise<ILanguageModelChatResponse>;\n\tprovideTokenCount(modelId: string, message: string | IChatMessage, token: CancellationToken): Promise<number>;\n}\n\nexport interface ILanguageModelChat {\n\tmetadata: ILanguageModelChatMetadata;\n\tsendChatRequest(messages: IChatMessage[], from: ExtensionIdentifier, options: { [name: string]: any }, token: CancellationToken): Promise<ILanguageModelChatResponse>;\n\tprovideTokenCount(message: string | IChatMessage, token: CancellationToken): Promise<number>;\n}\n\nexport interface ILanguageModelChatSelector {\n\treadonly name?: string;\n\treadonly id?: string;\n\treadonly vendor?: string;\n\treadonly version?: string;\n\treadonly family?: string;\n\treadonly tokens?: number;\n\treadonly extension?: ExtensionIdentifier;\n}\n\nexport const ILanguageModelsService = createDecorator<ILanguageModelsService>('ILanguageModelsService');\n\nexport interface ILanguageModelChatMetadataAndIdentifier {\n\tmetadata: ILanguageModelChatMetadata;\n\tidentifier: string;\n}\n\nexport interface ILanguageModelsService {\n\n\treadonly _serviceBrand: undefined;\n\n\t// TODO @lramos15 - Make this a richer event in the future. Right now it just indicates some change happened, but not what\n\treadonly onDidChangeLanguageModels: Event<string>;\n\n\tupdateModelPickerPreference(modelIdentifier: string, showInModelPicker: boolean): void;\n\n\tgetLanguageModelIds(): string[];\n\n\tgetVendors(): IUserFriendlyLanguageModel[];\n\n\tlookupLanguageModel(modelId: string): ILanguageModelChatMetadata | undefined;\n\n\t/**\n\t * Given a selector, returns a list of model identifiers\n\t * @param selector The selector to lookup for language models. If the selector is empty, all language models are returned.\n\t * @param allowPromptingUser If true the user may be prompted for things like API keys for us to select the model.\n\t */\n\tselectLanguageModels(selector: ILanguageModelChatSelector, allowPromptingUser?: boolean): Promise<string[]>;\n\n\tregisterLanguageModelProvider(vendor: string, provider: ILanguageModelChatProvider): IDisposable;\n\n\tsendChatRequest(modelId: string, from: ExtensionIdentifier, messages: IChatMessage[], options: { [name: string]: any }, token: CancellationToken): Promise<ILanguageModelChatResponse>;\n\n\tcomputeTokenLength(modelId: string, message: string | IChatMessage, token: CancellationToken): Promise<number>;\n}\n\nconst languageModelChatProviderType = {\n\ttype: 'object',\n\trequired: ['vendor', 'displayName'],\n\tproperties: {\n\t\tvendor: {\n\t\t\ttype: 'string',\n\t\t\tdescription: localize('vscode.extension.contributes.languageModels.vendor', \"A globally unique vendor of language model chat provider.\")\n\t\t},\n\t\tdisplayName: {\n\t\t\ttype: 'string',\n\t\t\tdescription: localize('vscode.extension.contributes.languageModels.displayName', \"The display name of the language model chat provider.\")\n\t\t},\n\t\tmanagementCommand: {\n\t\t\ttype: 'string',\n\t\t\tdescription: localize('vscode.extension.contributes.languageModels.managementCommand', \"A command to manage the language model chat provider, e.g. 'Manage Copilot models'. This is used in the chat model picker. If not provided, a gear icon is not rendered during vendor selection.\")\n\t\t},\n\t\twhen: {\n\t\t\ttype: 'string',\n\t\t\tdescription: localize('vscode.extension.contributes.languageModels.when', \"Condition which must be true to show this language model chat provider in the Manage Models list.\")\n\t\t}\n\t}\n} as const satisfies IJSONSchema;\n\nexport type IUserFriendlyLanguageModel = TypeFromJsonSchema<typeof languageModelChatProviderType>;\n\nexport const languageModelChatProviderExtensionPoint = ExtensionsRegistry.registerExtensionPoint<IUserFriendlyLanguageModel | IUserFriendlyLanguageModel[]>({\n\textensionPoint: 'languageModelChatProviders',\n\tjsonSchema: {\n\t\tdescription: localize('vscode.extension.contributes.languageModelChatProviders', \"Contribute language model chat providers of a specific vendor.\"),\n\t\toneOf: [\n\t\t\tlanguageModelChatProviderType,\n\t\t\t{\n\t\t\t\ttype: 'array',\n\t\t\t\titems: languageModelChatProviderType\n\t\t\t}\n\t\t]\n\t},\n\tactivationEventsGenerator: function* (contribs: readonly IUserFriendlyLanguageModel[]) {\n\t\tfor (const contrib of contribs) {\n\t\t\tyield `onLanguageModelChatProvider:${contrib.vendor}`;\n\t\t}\n\t}\n});\n\nexport class LanguageModelsService implements ILanguageModelsService {\n\n\treadonly _serviceBrand: undefined;\n\n\tprivate readonly _store = new DisposableStore();\n\n\tprivate readonly _providers = new Map<string, ILanguageModelChatProvider>();\n\tprivate readonly _modelCache = new Map<string, ILanguageModelChatMetadata>();\n\tprivate readonly _vendors = new Map<string, IUserFriendlyLanguageModel>();\n\tprivate readonly _resolveLMSequencer = new SequencerByKey<string>();\n\tprivate _modelPickerUserPreferences: Record<string, boolean> = {};\n\tprivate readonly _hasUserSelectableModels: IContextKey<boolean>;\n\tprivate readonly _contextKeyService: IContextKeyService;\n\tprivate readonly _onLanguageModelChange = this._store.add(new Emitter<string>());\n\treadonly onDidChangeLanguageModels: Event<string> = this._onLanguageModelChange.event;\n\n\tconstructor(\n\t\t@IExtensionService private readonly _extensionService: IExtensionService,\n\t\t@ILogService private readonly _logService: ILogService,\n\t\t@IStorageService private readonly _storageService: IStorageService,\n\t\t@IContextKeyService _contextKeyService: IContextKeyService,\n\t\t@IConfigurationService private readonly _configurationService: IConfigurationService,\n\t\t@IChatEntitlementService private readonly _chatEntitlementService: IChatEntitlementService,\n\t) {\n\t\tthis._hasUserSelectableModels = ChatContextKeys.languageModelsAreUserSelectable.bindTo(_contextKeyService);\n\t\tthis._contextKeyService = _contextKeyService;\n\t\tthis._modelPickerUserPreferences = this._storageService.getObject<Record<string, boolean>>('chatModelPickerPreferences', StorageScope.PROFILE, this._modelPickerUserPreferences);\n\t\t// TODO @lramos15 - Remove after a few releases, as this is just cleaning a bad storage state\n\t\tconst entitlementChangeHandler = () => {\n\t\t\tif ((this._chatEntitlementService.entitlement === ChatEntitlement.Business || this._chatEntitlementService.entitlement === ChatEntitlement.Enterprise) && !this._chatEntitlementService.isInternal) {\n\t\t\t\tthis._modelPickerUserPreferences = {};\n\t\t\t\tthis._storageService.store('chatModelPickerPreferences', this._modelPickerUserPreferences, StorageScope.PROFILE, StorageTarget.USER);\n\t\t\t}\n\t\t};\n\n\t\tentitlementChangeHandler();\n\t\tthis._store.add(this._chatEntitlementService.onDidChangeEntitlement(entitlementChangeHandler));\n\n\t\tthis._store.add(this.onDidChangeLanguageModels(() => {\n\t\t\tthis._hasUserSelectableModels.set(this._modelCache.size > 0 && Array.from(this._modelCache.values()).some(model => model.isUserSelectable));\n\t\t}));\n\n\t\tthis._store.add(languageModelChatProviderExtensionPoint.setHandler((extensions) => {\n\n\t\t\tthis._vendors.clear();\n\n\t\t\tfor (const extension of extensions) {\n\t\t\t\tfor (const item of Iterable.wrap(extension.value)) {\n\t\t\t\t\tif (this._vendors.has(item.vendor)) {\n\t\t\t\t\t\textension.collector.error(localize('vscode.extension.contributes.languageModels.vendorAlreadyRegistered', \"The vendor '{0}' is already registered and cannot be registered twice\", item.vendor));\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\t\tif (isFalsyOrWhitespace(item.vendor)) {\n\t\t\t\t\t\textension.collector.error(localize('vscode.extension.contributes.languageModels.emptyVendor', \"The vendor field cannot be empty.\"));\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\t\tif (item.vendor.trim() !== item.vendor) {\n\t\t\t\t\t\textension.collector.error(localize('vscode.extension.contributes.languageModels.whitespaceVendor', \"The vendor field cannot start or end with whitespace.\"));\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\t\tthis._vendors.set(item.vendor, item);\n\t\t\t\t\t// Have some models we want from this vendor, so activate the extension\n\t\t\t\t\tif (this._hasStoredModelForVendor(item.vendor)) {\n\t\t\t\t\t\tthis._extensionService.activateByEvent(`onLanguageModelChatProvider:${item.vendor}`);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tfor (const [vendor, _] of this._providers) {\n\t\t\t\tif (!this._vendors.has(vendor)) {\n\t\t\t\t\tthis._providers.delete(vendor);\n\t\t\t\t}\n\t\t\t}\n\t\t}));\n\t}\n\n\tprivate _hasStoredModelForVendor(vendor: string): boolean {\n\t\treturn Object.keys(this._modelPickerUserPreferences).some(modelId => {\n\t\t\treturn modelId.startsWith(vendor);\n\t\t});\n\t}\n\n\tdispose() {\n\t\tthis._store.dispose();\n\t\tthis._providers.clear();\n\t}\n\n\tupdateModelPickerPreference(modelIdentifier: string, showInModelPicker: boolean): void {\n\t\tconst model = this._modelCache.get(modelIdentifier);\n\t\tif (!model) {\n\t\t\tthis._logService.warn(`[LM] Cannot update model picker preference for unknown model ${modelIdentifier}`);\n\t\t\treturn;\n\t\t}\n\n\t\tthis._modelPickerUserPreferences[modelIdentifier] = showInModelPicker;\n\t\tif (showInModelPicker === model.isUserSelectable) {\n\t\t\tdelete this._modelPickerUserPreferences[modelIdentifier];\n\t\t\tthis._storageService.store('chatModelPickerPreferences', this._modelPickerUserPreferences, StorageScope.PROFILE, StorageTarget.USER);\n\t\t} else if (model.isUserSelectable !== showInModelPicker) {\n\t\t\tthis._storageService.store('chatModelPickerPreferences', this._modelPickerUserPreferences, StorageScope.PROFILE, StorageTarget.USER);\n\t\t}\n\t\tthis._onLanguageModelChange.fire(model.vendor);\n\t\tthis._logService.trace(`[LM] Updated model picker preference for ${modelIdentifier} to ${showInModelPicker}`);\n\t}\n\n\tgetVendors(): IUserFriendlyLanguageModel[] {\n\t\treturn Array.from(this._vendors.values()).filter(vendor => {\n\t\t\tif (!vendor.when) {\n\t\t\t\treturn true; // No when clause means always visible\n\t\t\t}\n\t\t\tconst whenClause = ContextKeyExpr.deserialize(vendor.when);\n\t\t\treturn whenClause ? this._contextKeyService.contextMatchesRules(whenClause) : false;\n\t\t});\n\t}\n\n\tgetLanguageModelIds(): string[] {\n\t\treturn Array.from(this._modelCache.keys());\n\t}\n\n\tlookupLanguageModel(modelIdentifier: string): ILanguageModelChatMetadata | undefined {\n\t\tconst model = this._modelCache.get(modelIdentifier);\n\t\tif (model && this._configurationService.getValue('chat.experimentalShowAllModels')) {\n\t\t\treturn { ...model, isUserSelectable: true };\n\t\t}\n\t\tif (model && this._modelPickerUserPreferences[modelIdentifier] !== undefined) {\n\t\t\treturn { ...model, isUserSelectable: this._modelPickerUserPreferences[modelIdentifier] };\n\t\t}\n\t\treturn model;\n\t}\n\n\tprivate _clearModelCache(vendor: string): void {\n\t\tfor (const [id, model] of this._modelCache.entries()) {\n\t\t\tif (model.vendor === vendor) {\n\t\t\t\tthis._modelCache.delete(id);\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate async _resolveLanguageModels(vendor: string, silent: boolean): Promise<void> {\n\t\t// Activate extensions before requesting to resolve the models\n\t\tawait this._extensionService.activateByEvent(`onLanguageModelChatProvider:${vendor}`);\n\t\tconst provider = this._providers.get(vendor);\n\t\tif (!provider) {\n\t\t\tthis._logService.warn(`[LM] No provider registered for vendor ${vendor}`);\n\t\t\treturn;\n\t\t}\n\t\treturn this._resolveLMSequencer.queue(vendor, async () => {\n\t\t\ttry {\n\t\t\t\tlet modelsAndIdentifiers = await provider.provideLanguageModelChatInfo({ silent }, CancellationToken.None);\n\t\t\t\t// This is a bit of a hack, when prompting user if the provider returns any models that are user selectable then we only want to show those and not the entire model list\n\t\t\t\tif (!silent && modelsAndIdentifiers.some(m => m.metadata.isUserSelectable)) {\n\t\t\t\t\tmodelsAndIdentifiers = modelsAndIdentifiers.filter(m => m.metadata.isUserSelectable || this._modelPickerUserPreferences[m.identifier] === true);\n\t\t\t\t}\n\t\t\t\tthis._clearModelCache(vendor);\n\t\t\t\tfor (const modelAndIdentifier of modelsAndIdentifiers) {\n\t\t\t\t\tif (this._modelCache.has(modelAndIdentifier.identifier)) {\n\t\t\t\t\t\tthis._logService.warn(`[LM] Model ${modelAndIdentifier.identifier} is already registered. Skipping.`);\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\t\tthis._modelCache.set(modelAndIdentifier.identifier, modelAndIdentifier.metadata);\n\t\t\t\t}\n\t\t\t\tthis._logService.trace(`[LM] Resolved language models for vendor ${vendor}`, modelsAndIdentifiers);\n\t\t\t} catch (error) {\n\t\t\t\tthis._logService.error(`[LM] Error resolving language models for vendor ${vendor}:`, error);\n\t\t\t}\n\t\t\tthis._onLanguageModelChange.fire(vendor);\n\t\t});\n\t}\n\n\tasync selectLanguageModels(selector: ILanguageModelChatSelector, allowPromptingUser?: boolean): Promise<string[]> {\n\n\t\tif (selector.vendor) {\n\t\t\tawait this._resolveLanguageModels(selector.vendor, !allowPromptingUser);\n\t\t} else {\n\t\t\tconst allVendors = Array.from(this._vendors.keys());\n\t\t\tawait Promise.all(allVendors.map(vendor => this._resolveLanguageModels(vendor, !allowPromptingUser)));\n\t\t}\n\n\t\tconst result: string[] = [];\n\n\t\tfor (const [internalModelIdentifier, model] of this._modelCache) {\n\t\t\tif ((selector.vendor === undefined || model.vendor === selector.vendor)\n\t\t\t\t&& (selector.family === undefined || model.family === selector.family)\n\t\t\t\t&& (selector.version === undefined || model.version === selector.version)\n\t\t\t\t&& (selector.id === undefined || model.id === selector.id)) {\n\t\t\t\tresult.push(internalModelIdentifier);\n\t\t\t}\n\t\t}\n\n\t\tthis._logService.trace('[LM] selected language models', selector, result);\n\n\t\treturn result;\n\t}\n\n\tregisterLanguageModelProvider(vendor: string, provider: ILanguageModelChatProvider): IDisposable {\n\t\tthis._logService.trace('[LM] registering language model provider', vendor, provider);\n\n\t\tif (!this._vendors.has(vendor)) {\n\t\t\tthrow new Error(`Chat model provider uses UNKNOWN vendor ${vendor}.`);\n\t\t}\n\t\tif (this._providers.has(vendor)) {\n\t\t\tthrow new Error(`Chat model provider for vendor ${vendor} is already registered.`);\n\t\t}\n\n\t\tthis._providers.set(vendor, provider);\n\n\t\tif (this._hasStoredModelForVendor(vendor)) {\n\t\t\tthis._resolveLanguageModels(vendor, true);\n\t\t}\n\n\t\tconst modelChangeListener = provider.onDidChange(async () => {\n\t\t\tawait this._resolveLanguageModels(vendor, true);\n\t\t});\n\n\t\treturn toDisposable(() => {\n\t\t\tthis._logService.trace('[LM] UNregistered language model provider', vendor);\n\t\t\tthis._clearModelCache(vendor);\n\t\t\tthis._providers.delete(vendor);\n\t\t\tmodelChangeListener.dispose();\n\t\t});\n\t}\n\n\tasync sendChatRequest(modelId: string, from: ExtensionIdentifier, messages: IChatMessage[], options: { [name: string]: any }, token: CancellationToken): Promise<ILanguageModelChatResponse> {\n\t\tconst provider = this._providers.get(this._modelCache.get(modelId)?.vendor || '');\n\t\tif (!provider) {\n\t\t\tthrow new Error(`Chat provider for model ${modelId} is not registered.`);\n\t\t}\n\t\treturn provider.sendChatRequest(modelId, messages, from, options, token);\n\t}\n\n\tcomputeTokenLength(modelId: string, message: string | IChatMessage, token: CancellationToken): Promise<number> {\n\t\tconst model = this._modelCache.get(modelId);\n\t\tif (!model) {\n\t\t\tthrow new Error(`Chat model ${modelId} could not be found.`);\n\t\t}\n\t\tconst provider = this._providers.get(model.vendor);\n\t\tif (!provider) {\n\t\t\tthrow new Error(`Chat provider for model ${modelId} is not registered.`);\n\t\t}\n\t\treturn provider.provideTokenCount(modelId, message, token);\n\t}\n}\n"]}