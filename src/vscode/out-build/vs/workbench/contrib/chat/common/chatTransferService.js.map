{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/contrib/chat/common/chatTransferService.ts","vs/workbench/contrib/chat/common/chatTransferService.ts"],"names":[],"mappings":";;;;;;;;;AAAA;;;gGAGgG;AAChG,OAAO,EAAE,wBAAwB,EAAE,MAAM,oDAAoD,CAAC;AAC9F,OAAO,EAAE,eAAe,EAA+B,MAAM,gDAAgD,CAAC;AAC9G,OAAO,EAAE,YAAY,EAAE,MAAM,4CAA4C,CAAC;AAC1E,OAAO,EAAE,gCAAgC,EAAE,MAAM,yDAAyD,CAAC;AAC3G,OAAO,EAAE,wBAAwB,EAAE,MAAM,uDAAuD,CAAC;AACjG,OAAO,EAAE,eAAe,EAAE,MAAM,4DAA4D,CAAC;AAG7F,MAAM,CAAC,MAAM,oBAAoB,GAAG,eAAe,CAAuB,qBAAqB,CAAC,CAAC;AACjG,MAAM,wBAAwB,GAAG,2BAA2B,CAAC;AAStD,IAAM,mBAAmB,GAAzB,MAAM,mBAAmB;IAG/B,YAC4C,gBAA0C,EACnD,cAA+B,EAClC,WAAyB,EACL,+BAAiE;QAHzE,qBAAgB,GAAhB,gBAAgB,CAA0B;QACnD,mBAAc,GAAd,cAAc,CAAiB;QAClC,gBAAW,GAAX,WAAW,CAAc;QACL,oCAA+B,GAA/B,+BAA+B,CAAkC;IACjH,CAAC;IAEL,kCAAkC,CAAC,SAAc;QAChD,MAAM,qBAAqB,GAAG,IAAI,CAAC,cAAc,CAAC,SAAS,CAAW,wBAAwB,gCAAwB,EAAE,CAAC,CAAC;QAC1H,MAAM,iBAAiB,GAAG,qBAAqB,CAAC,MAAM,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,KAAK,SAAS,CAAC,QAAQ,EAAE,CAAC,CAAC;QAC5F,IAAI,CAAC,cAAc,CAAC,KAAK,CAAC,wBAAwB,EAAE,iBAAiB,8DAA8C,CAAC;IACrH,CAAC;IAED,yBAAyB,CAAC,SAAc;QACvC,MAAM,qBAAqB,GAAG,IAAI,CAAC,cAAc,CAAC,SAAS,CAAW,wBAAwB,gCAAwB,EAAE,CAAC,CAAC;QAC1H,qBAAqB,CAAC,IAAI,CAAC,SAAS,CAAC,QAAQ,EAAE,CAAC,CAAC;QACjD,IAAI,CAAC,cAAc,CAAC,KAAK,CAAC,wBAAwB,EAAE,qBAAqB,8DAA8C,CAAC;IACzH,CAAC;IAED,KAAK,CAAC,oCAAoC;QACzC,MAAM,SAAS,GAAG,IAAI,CAAC,gBAAgB,CAAC,YAAY,EAAE,CAAC;QACvD,MAAM,mBAAmB,GAAG,SAAS,CAAC,OAAO,CAAC,CAAC,CAAC,EAAE,GAAG,CAAC;QACtD,IAAI,CAAC,mBAAmB,EAAE,CAAC;YAC1B,OAAO;QACR,CAAC;QACD,IAAI,IAAI,CAAC,0BAA0B,CAAC,mBAAmB,EAAE,IAAI,CAAC,cAAc,CAAC,IAAI,MAAM,wBAAwB,CAAC,SAAS,EAAE,IAAI,CAAC,WAAW,CAAC,EAAE,CAAC;YAC9I,MAAM,IAAI,CAAC,+BAA+B,CAAC,iBAAiB,CAAC,IAAI,CAAC,CAAC;YACnE,IAAI,CAAC,kCAAkC,CAAC,mBAAmB,CAAC,CAAC;QAC9D,CAAC;IACF,CAAC;IAED,0BAA0B,CAAC,SAAc,EAAE,cAA+B;QACzE,IAAI,CAAC,SAAS,EAAE,CAAC;YAChB,OAAO,KAAK,CAAC;QACd,CAAC;QACD,MAAM,qBAAqB,GAAU,cAAc,CAAC,SAAS,CAAC,wBAAwB,gCAAwB,EAAE,CAAC,CAAC;QAClH,OAAO,qBAAqB,CAAC,IAAI,CAAC,IAAI,CAAC,EAAE,CAAC,IAAI,CAAC,QAAQ,EAAE,KAAK,SAAS,CAAC,QAAQ,EAAE,CAAC,CAAC;IACrF,CAAC;CACD,CAAA;AAzCY,mBAAmB;IAI7B,WAAA,wBAAwB,CAAA;IACxB,WAAA,eAAe,CAAA;IACf,WAAA,YAAY,CAAA;IACZ,WAAA,gCAAgC,CAAA;GAPtB,mBAAmB,CAyC/B","file":"chatTransferService.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nimport { IWorkspaceContextService } from '../../../../platform/workspace/common/workspace.js';\nimport { IStorageService, StorageScope, StorageTarget } from '../../../../platform/storage/common/storage.js';\nimport { IFileService } from '../../../../platform/files/common/files.js';\nimport { IWorkspaceTrustManagementService } from '../../../../platform/workspace/common/workspaceTrust.js';\nimport { areWorkspaceFoldersEmpty } from '../../../services/workspaces/common/workspaceUtils.js';\nimport { createDecorator } from '../../../../platform/instantiation/common/instantiation.js';\nimport { URI } from '../../../../base/common/uri.js';\n\nexport const IChatTransferService = createDecorator<IChatTransferService>('chatTransferService');\nconst transferredWorkspacesKey = 'chat.transferedWorkspaces';\n\nexport interface IChatTransferService {\n\treadonly _serviceBrand: undefined;\n\n\tcheckAndSetTransferredWorkspaceTrust(): Promise<void>;\n\taddWorkspaceToTransferred(workspace: URI): void;\n}\n\nexport class ChatTransferService implements IChatTransferService {\n\t_serviceBrand: undefined;\n\n\tconstructor(\n\t\t@IWorkspaceContextService private readonly workspaceService: IWorkspaceContextService,\n\t\t@IStorageService private readonly storageService: IStorageService,\n\t\t@IFileService private readonly fileService: IFileService,\n\t\t@IWorkspaceTrustManagementService private readonly workspaceTrustManagementService: IWorkspaceTrustManagementService\n\t) { }\n\n\tdeleteWorkspaceFromTransferredList(workspace: URI): void {\n\t\tconst transferredWorkspaces = this.storageService.getObject<string[]>(transferredWorkspacesKey, StorageScope.PROFILE, []);\n\t\tconst updatedWorkspaces = transferredWorkspaces.filter(uri => uri !== workspace.toString());\n\t\tthis.storageService.store(transferredWorkspacesKey, updatedWorkspaces, StorageScope.PROFILE, StorageTarget.MACHINE);\n\t}\n\n\taddWorkspaceToTransferred(workspace: URI): void {\n\t\tconst transferredWorkspaces = this.storageService.getObject<string[]>(transferredWorkspacesKey, StorageScope.PROFILE, []);\n\t\ttransferredWorkspaces.push(workspace.toString());\n\t\tthis.storageService.store(transferredWorkspacesKey, transferredWorkspaces, StorageScope.PROFILE, StorageTarget.MACHINE);\n\t}\n\n\tasync checkAndSetTransferredWorkspaceTrust(): Promise<void> {\n\t\tconst workspace = this.workspaceService.getWorkspace();\n\t\tconst currentWorkspaceUri = workspace.folders[0]?.uri;\n\t\tif (!currentWorkspaceUri) {\n\t\t\treturn;\n\t\t}\n\t\tif (this.isChatTransferredWorkspace(currentWorkspaceUri, this.storageService) && await areWorkspaceFoldersEmpty(workspace, this.fileService)) {\n\t\t\tawait this.workspaceTrustManagementService.setWorkspaceTrust(true);\n\t\t\tthis.deleteWorkspaceFromTransferredList(currentWorkspaceUri);\n\t\t}\n\t}\n\n\tisChatTransferredWorkspace(workspace: URI, storageService: IStorageService): boolean {\n\t\tif (!workspace) {\n\t\t\treturn false;\n\t\t}\n\t\tconst chatWorkspaceTransfer: URI[] = storageService.getObject(transferredWorkspacesKey, StorageScope.PROFILE, []);\n\t\treturn chatWorkspaceTransfer.some(item => item.toString() === workspace.toString());\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nimport { IWorkspaceContextService } from '../../../../platform/workspace/common/workspace.js';\nimport { IStorageService, StorageScope, StorageTarget } from '../../../../platform/storage/common/storage.js';\nimport { IFileService } from '../../../../platform/files/common/files.js';\nimport { IWorkspaceTrustManagementService } from '../../../../platform/workspace/common/workspaceTrust.js';\nimport { areWorkspaceFoldersEmpty } from '../../../services/workspaces/common/workspaceUtils.js';\nimport { createDecorator } from '../../../../platform/instantiation/common/instantiation.js';\nimport { URI } from '../../../../base/common/uri.js';\n\nexport const IChatTransferService = createDecorator<IChatTransferService>('chatTransferService');\nconst transferredWorkspacesKey = 'chat.transferedWorkspaces';\n\nexport interface IChatTransferService {\n\treadonly _serviceBrand: undefined;\n\n\tcheckAndSetTransferredWorkspaceTrust(): Promise<void>;\n\taddWorkspaceToTransferred(workspace: URI): void;\n}\n\nexport class ChatTransferService implements IChatTransferService {\n\t_serviceBrand: undefined;\n\n\tconstructor(\n\t\t@IWorkspaceContextService private readonly workspaceService: IWorkspaceContextService,\n\t\t@IStorageService private readonly storageService: IStorageService,\n\t\t@IFileService private readonly fileService: IFileService,\n\t\t@IWorkspaceTrustManagementService private readonly workspaceTrustManagementService: IWorkspaceTrustManagementService\n\t) { }\n\n\tdeleteWorkspaceFromTransferredList(workspace: URI): void {\n\t\tconst transferredWorkspaces = this.storageService.getObject<string[]>(transferredWorkspacesKey, StorageScope.PROFILE, []);\n\t\tconst updatedWorkspaces = transferredWorkspaces.filter(uri => uri !== workspace.toString());\n\t\tthis.storageService.store(transferredWorkspacesKey, updatedWorkspaces, StorageScope.PROFILE, StorageTarget.MACHINE);\n\t}\n\n\taddWorkspaceToTransferred(workspace: URI): void {\n\t\tconst transferredWorkspaces = this.storageService.getObject<string[]>(transferredWorkspacesKey, StorageScope.PROFILE, []);\n\t\ttransferredWorkspaces.push(workspace.toString());\n\t\tthis.storageService.store(transferredWorkspacesKey, transferredWorkspaces, StorageScope.PROFILE, StorageTarget.MACHINE);\n\t}\n\n\tasync checkAndSetTransferredWorkspaceTrust(): Promise<void> {\n\t\tconst workspace = this.workspaceService.getWorkspace();\n\t\tconst currentWorkspaceUri = workspace.folders[0]?.uri;\n\t\tif (!currentWorkspaceUri) {\n\t\t\treturn;\n\t\t}\n\t\tif (this.isChatTransferredWorkspace(currentWorkspaceUri, this.storageService) && await areWorkspaceFoldersEmpty(workspace, this.fileService)) {\n\t\t\tawait this.workspaceTrustManagementService.setWorkspaceTrust(true);\n\t\t\tthis.deleteWorkspaceFromTransferredList(currentWorkspaceUri);\n\t\t}\n\t}\n\n\tisChatTransferredWorkspace(workspace: URI, storageService: IStorageService): boolean {\n\t\tif (!workspace) {\n\t\t\treturn false;\n\t\t}\n\t\tconst chatWorkspaceTransfer: URI[] = storageService.getObject(transferredWorkspacesKey, StorageScope.PROFILE, []);\n\t\treturn chatWorkspaceTransfer.some(item => item.toString() === workspace.toString());\n\t}\n}\n"]}