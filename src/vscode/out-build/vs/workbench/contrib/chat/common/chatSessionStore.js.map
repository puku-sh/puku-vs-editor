{"version":3,"sources":["vs/workbench/contrib/chat/common/chatSessionStore.ts"],"names":[],"mappings":"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","file":"chatSessionStore.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Sequencer } from '../../../../base/common/async.js';\nimport { VSBuffer } from '../../../../base/common/buffer.js';\nimport { toErrorMessage } from '../../../../base/common/errorMessage.js';\nimport { MarkdownString } from '../../../../base/common/htmlContent.js';\nimport { Disposable } from '../../../../base/common/lifecycle.js';\nimport { revive } from '../../../../base/common/marshalling.js';\nimport { joinPath } from '../../../../base/common/resources.js';\nimport { URI } from '../../../../base/common/uri.js';\nimport { localize } from '../../../../nls.js';\nimport { IEnvironmentService } from '../../../../platform/environment/common/environment.js';\nimport { FileOperationResult, IFileService, toFileOperationResult } from '../../../../platform/files/common/files.js';\nimport { ILogService } from '../../../../platform/log/common/log.js';\nimport { IStorageService, StorageScope, StorageTarget } from '../../../../platform/storage/common/storage.js';\nimport { ITelemetryService } from '../../../../platform/telemetry/common/telemetry.js';\nimport { IUserDataProfilesService } from '../../../../platform/userDataProfile/common/userDataProfile.js';\nimport { IWorkspaceContextService } from '../../../../platform/workspace/common/workspace.js';\nimport { ILifecycleService } from '../../../services/lifecycle/common/lifecycle.js';\nimport { ChatModel, IChatModelInputState, ISerializableChatData, ISerializableChatDataIn, ISerializableChatsData, normalizeSerializableChatData } from './chatModel.js';\nimport { ChatAgentLocation } from './constants.js';\n\nconst maxPersistedSessions = 25;\n\nconst ChatIndexStorageKey = 'chat.ChatSessionStore.index';\n// const ChatTransferIndexStorageKey = 'ChatSessionStore.transferIndex';\n\nexport class ChatSessionStore extends Disposable {\n\tprivate readonly storageRoot: URI;\n\tprivate readonly previousEmptyWindowStorageRoot: URI | undefined;\n\t// private readonly transferredSessionStorageRoot: URI;\n\n\tprivate readonly storeQueue = new Sequencer();\n\n\tprivate storeTask: Promise<void> | undefined;\n\tprivate shuttingDown = false;\n\n\tconstructor(\n\t\t@IFileService private readonly fileService: IFileService,\n\t\t@IEnvironmentService private readonly environmentService: IEnvironmentService,\n\t\t@ILogService private readonly logService: ILogService,\n\t\t@IWorkspaceContextService private readonly workspaceContextService: IWorkspaceContextService,\n\t\t@ITelemetryService private readonly telemetryService: ITelemetryService,\n\t\t@IStorageService private readonly storageService: IStorageService,\n\t\t@ILifecycleService private readonly lifecycleService: ILifecycleService,\n\t\t@IUserDataProfilesService private readonly userDataProfilesService: IUserDataProfilesService,\n\t) {\n\t\tsuper();\n\n\t\tconst workspace = this.workspaceContextService.getWorkspace();\n\t\tconst isEmptyWindow = !workspace.configuration && workspace.folders.length === 0;\n\t\tconst workspaceId = this.workspaceContextService.getWorkspace().id;\n\t\tthis.storageRoot = isEmptyWindow ?\n\t\t\tjoinPath(this.userDataProfilesService.defaultProfile.globalStorageHome, 'emptyWindowChatSessions') :\n\t\t\tjoinPath(this.environmentService.workspaceStorageHome, workspaceId, 'chatSessions');\n\n\t\tthis.previousEmptyWindowStorageRoot = isEmptyWindow ?\n\t\t\tjoinPath(this.environmentService.workspaceStorageHome, 'no-workspace', 'chatSessions') :\n\t\t\tundefined;\n\n\t\t// TODO tmpdir\n\t\t// this.transferredSessionStorageRoot = joinPath(this.environmentService.workspaceStorageHome, 'transferredChatSessions');\n\n\t\tthis._register(this.lifecycleService.onWillShutdown(e => {\n\t\t\tthis.shuttingDown = true;\n\t\t\tif (!this.storeTask) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\te.join(this.storeTask, {\n\t\t\t\tid: 'join.chatSessionStore',\n\t\t\t\tlabel: localize('join.chatSessionStore', \"Saving chat history\")\n\t\t\t});\n\t\t}));\n\t}\n\n\tasync storeSessions(sessions: ChatModel[]): Promise<void> {\n\t\tif (this.shuttingDown) {\n\t\t\t// Don't start this task if we missed the chance to block shutdown\n\t\t\treturn;\n\t\t}\n\n\t\ttry {\n\t\t\tthis.storeTask = this.storeQueue.queue(async () => {\n\t\t\t\ttry {\n\t\t\t\t\tawait Promise.all(sessions.map(session => this.writeSession(session)));\n\t\t\t\t\tawait this.trimEntries();\n\t\t\t\t\tawait this.flushIndex();\n\t\t\t\t} catch (e) {\n\t\t\t\t\tthis.reportError('storeSessions', 'Error storing chat sessions', e);\n\t\t\t\t}\n\t\t\t});\n\t\t\tawait this.storeTask;\n\t\t} finally {\n\t\t\tthis.storeTask = undefined;\n\t\t}\n\t}\n\n\t// async storeTransferSession(transferData: IChatTransfer, session: ISerializableChatData): Promise<void> {\n\t// \ttry {\n\t// \t\tconst content = JSON.stringify(session, undefined, 2);\n\t// \t\tawait this.fileService.writeFile(this.transferredSessionStorageRoot, VSBuffer.fromString(content));\n\t// \t} catch (e) {\n\t// \t\tthis.reportError('sessionWrite', 'Error writing chat session', e);\n\t// \t\treturn;\n\t// \t}\n\n\t// \tconst index = this.getTransferredSessionIndex();\n\t// \tindex[transferData.toWorkspace.toString()] = transferData;\n\t// \ttry {\n\t// \t\tthis.storageService.store(ChatTransferIndexStorageKey, index, StorageScope.PROFILE, StorageTarget.MACHINE);\n\t// \t} catch (e) {\n\t// \t\tthis.reportError('storeTransferSession', 'Error storing chat transfer session', e);\n\t// \t}\n\t// }\n\n\t// private getTransferredSessionIndex(): IChatTransferIndex {\n\t// \ttry {\n\t// \t\tconst data: IChatTransferIndex = this.storageService.getObject(ChatTransferIndexStorageKey, StorageScope.PROFILE, {});\n\t// \t\treturn data;\n\t// \t} catch (e) {\n\t// \t\tthis.reportError('getTransferredSessionIndex', 'Error reading chat transfer index', e);\n\t// \t\treturn {};\n\t// \t}\n\t// }\n\n\tprivate async writeSession(session: ChatModel | ISerializableChatData): Promise<void> {\n\t\ttry {\n\t\t\tconst index = this.internalGetIndex();\n\t\t\tconst storageLocation = this.getStorageLocation(session.sessionId);\n\t\t\tconst content = JSON.stringify(session, undefined, 2);\n\t\t\tawait this.fileService.writeFile(storageLocation, VSBuffer.fromString(content));\n\n\t\t\t// Write succeeded, update index\n\t\t\tindex.entries[session.sessionId] = getSessionMetadata(session);\n\t\t} catch (e) {\n\t\t\tthis.reportError('sessionWrite', 'Error writing chat session', e);\n\t\t}\n\t}\n\n\tprivate async flushIndex(): Promise<void> {\n\t\tconst index = this.internalGetIndex();\n\t\ttry {\n\t\t\tthis.storageService.store(ChatIndexStorageKey, index, this.getIndexStorageScope(), StorageTarget.MACHINE);\n\t\t} catch (e) {\n\t\t\t// Only if JSON.stringify fails, AFAIK\n\t\t\tthis.reportError('indexWrite', 'Error writing index', e);\n\t\t}\n\t}\n\n\tprivate getIndexStorageScope(): StorageScope {\n\t\tconst workspace = this.workspaceContextService.getWorkspace();\n\t\tconst isEmptyWindow = !workspace.configuration && workspace.folders.length === 0;\n\t\treturn isEmptyWindow ? StorageScope.APPLICATION : StorageScope.WORKSPACE;\n\t}\n\n\tprivate async trimEntries(): Promise<void> {\n\t\tconst index = this.internalGetIndex();\n\t\tconst entries = Object.entries(index.entries)\n\t\t\t.sort((a, b) => b[1].lastMessageDate - a[1].lastMessageDate)\n\t\t\t.map(([id]) => id);\n\n\t\tif (entries.length > maxPersistedSessions) {\n\t\t\tconst entriesToDelete = entries.slice(maxPersistedSessions);\n\t\t\tfor (const entry of entriesToDelete) {\n\t\t\t\tdelete index.entries[entry];\n\t\t\t}\n\n\t\t\tthis.logService.trace(`ChatSessionStore: Trimmed ${entriesToDelete.length} old chat sessions from index`);\n\t\t}\n\t}\n\n\tprivate async internalDeleteSession(sessionId: string): Promise<void> {\n\t\tconst index = this.internalGetIndex();\n\t\tif (!index.entries[sessionId]) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst storageLocation = this.getStorageLocation(sessionId);\n\t\ttry {\n\t\t\tawait this.fileService.del(storageLocation);\n\t\t} catch (e) {\n\t\t\tif (toFileOperationResult(e) !== FileOperationResult.FILE_NOT_FOUND) {\n\t\t\t\tthis.reportError('sessionDelete', 'Error deleting chat session', e);\n\t\t\t}\n\t\t} finally {\n\t\t\tdelete index.entries[sessionId];\n\t\t}\n\t}\n\n\thasSessions(): boolean {\n\t\treturn Object.keys(this.internalGetIndex().entries).length > 0;\n\t}\n\n\tisSessionEmpty(sessionId: string): boolean {\n\t\tconst index = this.internalGetIndex();\n\t\treturn index.entries[sessionId]?.isEmpty ?? true;\n\t}\n\n\tasync deleteSession(sessionId: string): Promise<void> {\n\t\tawait this.storeQueue.queue(async () => {\n\t\t\tawait this.internalDeleteSession(sessionId);\n\t\t\tawait this.flushIndex();\n\t\t});\n\t}\n\n\tasync clearAllSessions(): Promise<void> {\n\t\tawait this.storeQueue.queue(async () => {\n\t\t\tconst index = this.internalGetIndex();\n\t\t\tconst entries = Object.keys(index.entries);\n\t\t\tthis.logService.info(`ChatSessionStore: Clearing ${entries.length} chat sessions`);\n\t\t\tawait Promise.all(entries.map(entry => this.internalDeleteSession(entry)));\n\t\t\tawait this.flushIndex();\n\t\t});\n\t}\n\n\tpublic async setSessionTitle(sessionId: string, title: string): Promise<void> {\n\t\tawait this.storeQueue.queue(async () => {\n\t\t\tconst index = this.internalGetIndex();\n\t\t\tif (index.entries[sessionId]) {\n\t\t\t\tindex.entries[sessionId].title = title;\n\t\t\t}\n\t\t});\n\t}\n\n\tprivate reportError(reasonForTelemetry: string, message: string, error?: Error): void {\n\t\tthis.logService.error(`ChatSessionStore: ` + message, toErrorMessage(error));\n\n\t\tconst fileOperationReason = error && toFileOperationResult(error);\n\t\ttype ChatSessionStoreErrorData = {\n\t\t\treason: string;\n\t\t\tfileOperationReason: number;\n\t\t\t// error: Error;\n\t\t};\n\t\ttype ChatSessionStoreErrorClassification = {\n\t\t\towner: 'roblourens';\n\t\t\tcomment: 'Detect issues related to managing chat sessions';\n\t\t\treason: { classification: 'SystemMetaData'; purpose: 'PerformanceAndHealth'; comment: 'Info about the error that occurred' };\n\t\t\tfileOperationReason: { classification: 'SystemMetaData'; purpose: 'PerformanceAndHealth'; comment: 'An error code from the file service' };\n\t\t\t// error: { classification: 'SystemMetaData'; purpose: 'PerformanceAndHealth'; comment: 'Info about the error that occurred' };\n\t\t};\n\t\tthis.telemetryService.publicLog2<ChatSessionStoreErrorData, ChatSessionStoreErrorClassification>('chatSessionStoreError', {\n\t\t\treason: reasonForTelemetry,\n\t\t\tfileOperationReason: fileOperationReason ?? -1\n\t\t});\n\t}\n\n\tprivate indexCache: IChatSessionIndexData | undefined;\n\tprivate internalGetIndex(): IChatSessionIndexData {\n\t\tif (this.indexCache) {\n\t\t\treturn this.indexCache;\n\t\t}\n\n\t\tconst data = this.storageService.get(ChatIndexStorageKey, this.getIndexStorageScope(), undefined);\n\t\tif (!data) {\n\t\t\tthis.indexCache = { version: 1, entries: {} };\n\t\t\treturn this.indexCache;\n\t\t}\n\n\t\ttry {\n\t\t\tconst index = JSON.parse(data) as unknown;\n\t\t\tif (isChatSessionIndex(index)) {\n\t\t\t\t// Success\n\t\t\t\tthis.indexCache = index;\n\t\t\t} else {\n\t\t\t\tthis.reportError('invalidIndexFormat', `Invalid index format: ${data}`);\n\t\t\t\tthis.indexCache = { version: 1, entries: {} };\n\t\t\t}\n\n\t\t\treturn this.indexCache;\n\t\t} catch (e) {\n\t\t\t// Only if JSON.parse fails\n\t\t\tthis.reportError('invalidIndexJSON', `Index corrupt: ${data}`, e);\n\t\t\tthis.indexCache = { version: 1, entries: {} };\n\t\t\treturn this.indexCache;\n\t\t}\n\t}\n\n\tasync getIndex(): Promise<IChatSessionIndex> {\n\t\treturn this.storeQueue.queue(async () => {\n\t\t\treturn this.internalGetIndex().entries;\n\t\t});\n\t}\n\n\tlogIndex(): void {\n\t\tconst data = this.storageService.get(ChatIndexStorageKey, this.getIndexStorageScope(), undefined);\n\t\tthis.logService.info('ChatSessionStore index: ', data);\n\t}\n\n\tasync migrateDataIfNeeded(getInitialData: () => ISerializableChatsData | undefined): Promise<void> {\n\t\tawait this.storeQueue.queue(async () => {\n\t\t\tconst data = this.storageService.get(ChatIndexStorageKey, this.getIndexStorageScope(), undefined);\n\t\t\tconst needsMigrationFromStorageService = !data;\n\t\t\tif (needsMigrationFromStorageService) {\n\t\t\t\tconst initialData = getInitialData();\n\t\t\t\tif (initialData) {\n\t\t\t\t\tawait this.migrate(initialData);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\tprivate async migrate(initialData: ISerializableChatsData): Promise<void> {\n\t\tconst numSessions = Object.keys(initialData).length;\n\t\tthis.logService.info(`ChatSessionStore: Migrating ${numSessions} chat sessions from storage service to file system`);\n\n\t\tawait Promise.all(Object.values(initialData).map(async session => {\n\t\t\tawait this.writeSession(session);\n\t\t}));\n\n\t\tawait this.flushIndex();\n\t}\n\n\tpublic async readSession(sessionId: string): Promise<ISerializableChatData | undefined> {\n\t\treturn await this.storeQueue.queue(async () => {\n\t\t\tlet rawData: string | undefined;\n\t\t\tconst storageLocation = this.getStorageLocation(sessionId);\n\t\t\ttry {\n\t\t\t\trawData = (await this.fileService.readFile(storageLocation)).value.toString();\n\t\t\t} catch (e) {\n\t\t\t\tthis.reportError('sessionReadFile', `Error reading chat session file ${sessionId}`, e);\n\n\t\t\t\tif (toFileOperationResult(e) === FileOperationResult.FILE_NOT_FOUND && this.previousEmptyWindowStorageRoot) {\n\t\t\t\t\trawData = await this.readSessionFromPreviousLocation(sessionId);\n\t\t\t\t}\n\n\t\t\t\tif (!rawData) {\n\t\t\t\t\treturn undefined;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\ttry {\n\t\t\t\t// TODO Copied from ChatService.ts, cleanup\n\t\t\t\tconst session: ISerializableChatDataIn = revive(JSON.parse(rawData)); // Revive serialized URIs in session data\n\t\t\t\t// Revive serialized markdown strings in response data\n\t\t\t\tfor (const request of session.requests) {\n\t\t\t\t\tif (Array.isArray(request.response)) {\n\t\t\t\t\t\trequest.response = request.response.map((response) => {\n\t\t\t\t\t\t\tif (typeof response === 'string') {\n\t\t\t\t\t\t\t\treturn new MarkdownString(response);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\treturn response;\n\t\t\t\t\t\t});\n\t\t\t\t\t} else if (typeof request.response === 'string') {\n\t\t\t\t\t\trequest.response = [new MarkdownString(request.response)];\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn normalizeSerializableChatData(session);\n\t\t\t} catch (err) {\n\t\t\t\tthis.reportError('malformedSession', `Malformed session data in ${storageLocation.fsPath}: [${rawData.substring(0, 20)}${rawData.length > 20 ? '...' : ''}]`, err);\n\t\t\t\treturn undefined;\n\t\t\t}\n\t\t});\n\t}\n\n\tprivate async readSessionFromPreviousLocation(sessionId: string): Promise<string | undefined> {\n\t\tlet rawData: string | undefined;\n\n\t\tif (this.previousEmptyWindowStorageRoot) {\n\t\t\tconst storageLocation2 = joinPath(this.previousEmptyWindowStorageRoot, `${sessionId}.json`);\n\t\t\ttry {\n\t\t\t\trawData = (await this.fileService.readFile(storageLocation2)).value.toString();\n\t\t\t\tthis.logService.info(`ChatSessionStore: Read chat session ${sessionId} from previous location`);\n\t\t\t} catch (e) {\n\t\t\t\tthis.reportError('sessionReadFile', `Error reading chat session file ${sessionId} from previous location`, e);\n\t\t\t\treturn undefined;\n\t\t\t}\n\t\t}\n\n\t\treturn rawData;\n\t}\n\n\tprivate getStorageLocation(chatSessionId: string): URI {\n\t\treturn joinPath(this.storageRoot, `${chatSessionId}.json`);\n\t}\n\n\tpublic getChatStorageFolder(): URI {\n\t\treturn this.storageRoot;\n\t}\n}\n\ninterface IChatSessionEntryMetadata {\n\tsessionId: string;\n\ttitle: string;\n\tlastMessageDate: number;\n\tisImported?: boolean;\n\tinitialLocation?: ChatAgentLocation;\n\n\t/**\n\t * This only exists because the migrated data from the storage service had empty sessions persisted, and it's impossible to know which ones are\n\t * currently in use. Now, `clearSession` deletes empty sessions, so old ones shouldn't take up space in the store anymore, but we still need to\n\t * filter the old ones out of history.\n\t */\n\tisEmpty?: boolean;\n}\n\nfunction isChatSessionEntryMetadata(obj: unknown): obj is IChatSessionEntryMetadata {\n\treturn (\n\t\t!!obj &&\n\t\ttypeof obj === 'object' &&\n\t\ttypeof (obj as IChatSessionEntryMetadata).sessionId === 'string' &&\n\t\ttypeof (obj as IChatSessionEntryMetadata).title === 'string' &&\n\t\ttypeof (obj as IChatSessionEntryMetadata).lastMessageDate === 'number'\n\t);\n}\n\nexport type IChatSessionIndex = Record<string, IChatSessionEntryMetadata>;\n\ninterface IChatSessionIndexData {\n\tversion: 1;\n\tentries: IChatSessionIndex;\n}\n\n// TODO if we update the index version:\n// Don't throw away index when moving backwards in VS Code version. Try to recover it. But this scenario is hard.\nfunction isChatSessionIndex(data: unknown): data is IChatSessionIndexData {\n\tif (typeof data !== 'object' || data === null) {\n\t\treturn false;\n\t}\n\n\tconst index = data as IChatSessionIndexData;\n\tif (index.version !== 1) {\n\t\treturn false;\n\t}\n\n\tif (typeof index.entries !== 'object' || index.entries === null) {\n\t\treturn false;\n\t}\n\n\tfor (const key in index.entries) {\n\t\tif (!isChatSessionEntryMetadata(index.entries[key])) {\n\t\t\treturn false;\n\t\t}\n\t}\n\n\treturn true;\n}\n\nfunction getSessionMetadata(session: ChatModel | ISerializableChatData): IChatSessionEntryMetadata {\n\tconst title = session.customTitle || (session instanceof ChatModel ? session.title : undefined);\n\n\treturn {\n\t\tsessionId: session.sessionId,\n\t\ttitle: title || localize('newChat', \"New Chat\"),\n\t\tlastMessageDate: session.lastMessageDate,\n\t\tisImported: session.isImported,\n\t\tinitialLocation: session.initialLocation,\n\t\tisEmpty: session instanceof ChatModel ? session.getRequests().length === 0 : session.requests.length === 0\n\t};\n}\n\nexport interface IChatTransfer {\n\ttoWorkspace: URI;\n\ttimestampInMilliseconds: number;\n\tinputState: IChatModelInputState | undefined;\n\tlocation: ChatAgentLocation;\n}\n\nexport interface IChatTransfer2 extends IChatTransfer {\n\tchat: ISerializableChatData;\n}\n\n// type IChatTransferDto = Dto<IChatTransfer>;\n\n/**\n * Map of destination workspace URI to chat transfer data\n */\n// type IChatTransferIndex = Record<string, IChatTransferDto>;\n"]}