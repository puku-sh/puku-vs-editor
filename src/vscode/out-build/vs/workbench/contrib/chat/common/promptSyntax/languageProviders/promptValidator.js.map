{"version":3,"sources":["vs/workbench/contrib/chat/common/promptSyntax/languageProviders/promptValidator.ts"],"names":[],"mappings":"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","file":"promptValidator.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { isEmptyPattern, parse, splitGlobAware } from '../../../../../../base/common/glob.js';\nimport { Iterable } from '../../../../../../base/common/iterator.js';\nimport { Range } from '../../../../../../editor/common/core/range.js';\nimport { ITextModel } from '../../../../../../editor/common/model.js';\nimport { IModelService } from '../../../../../../editor/common/services/model.js';\nimport { localize } from '../../../../../../nls.js';\nimport { IInstantiationService } from '../../../../../../platform/instantiation/common/instantiation.js';\nimport { IMarkerData, IMarkerService, MarkerSeverity } from '../../../../../../platform/markers/common/markers.js';\nimport { IChatMode, IChatModeService } from '../../chatModes.js';\nimport { ChatModeKind } from '../../constants.js';\nimport { ILanguageModelChatMetadata, ILanguageModelsService } from '../../languageModels.js';\nimport { ILanguageModelToolsService } from '../../languageModelToolsService.js';\nimport { getPromptsTypeForLanguageId, PromptsType } from '../promptTypes.js';\nimport { GithubPromptHeaderAttributes, IArrayValue, IHeaderAttribute, IStringValue, ParsedPromptFile, PromptHeaderAttributes, Target } from '../promptFileParser.js';\nimport { Disposable, DisposableStore, toDisposable } from '../../../../../../base/common/lifecycle.js';\nimport { Delayer } from '../../../../../../base/common/async.js';\nimport { ResourceMap } from '../../../../../../base/common/map.js';\nimport { IFileService } from '../../../../../../platform/files/common/files.js';\nimport { IPromptsService } from '../service/promptsService.js';\nimport { ILabelService } from '../../../../../../platform/label/common/label.js';\nimport { AGENTS_SOURCE_FOLDER, LEGACY_MODE_FILE_EXTENSION } from '../config/promptFileLocations.js';\nimport { Lazy } from '../../../../../../base/common/lazy.js';\n\nconst MARKERS_OWNER_ID = 'prompts-diagnostics-provider';\n\nexport class PromptValidator {\n\tconstructor(\n\t\t@ILanguageModelsService private readonly languageModelsService: ILanguageModelsService,\n\t\t@ILanguageModelToolsService private readonly languageModelToolsService: ILanguageModelToolsService,\n\t\t@IChatModeService private readonly chatModeService: IChatModeService,\n\t\t@IFileService private readonly fileService: IFileService,\n\t\t@ILabelService private readonly labelService: ILabelService,\n\t\t@IPromptsService private readonly promptsService: IPromptsService\n\t) { }\n\n\tpublic async validate(promptAST: ParsedPromptFile, promptType: PromptsType, report: (markers: IMarkerData) => void): Promise<void> {\n\t\tpromptAST.header?.errors.forEach(error => report(toMarker(error.message, error.range, MarkerSeverity.Error)));\n\t\tthis.validateHeader(promptAST, promptType, report);\n\t\tawait this.validateBody(promptAST, promptType, report);\n\t\tawait this.validateFileName(promptAST, promptType, report);\n\t}\n\n\tprivate async validateFileName(promptAST: ParsedPromptFile, promptType: PromptsType, report: (markers: IMarkerData) => void): Promise<void> {\n\t\tif (promptType === PromptsType.agent && promptAST.uri.path.endsWith(LEGACY_MODE_FILE_EXTENSION)) {\n\t\t\tconst location = this.promptsService.getAgentFileURIFromModeFile(promptAST.uri);\n\t\t\tif (location && await this.fileService.canCreateFile(location)) {\n\t\t\t\treport(toMarker(localize('promptValidator.chatModesRenamedToAgents', \"Chat modes have been renamed to agents. Please move this file to {0}\", location.toString()), new Range(1, 1, 1, 4), MarkerSeverity.Warning));\n\t\t\t} else {\n\t\t\t\treport(toMarker(localize('promptValidator.chatModesRenamedToAgentsNoMove', \"Chat modes have been renamed to agents. Please move the file to {0}\", AGENTS_SOURCE_FOLDER), new Range(1, 1, 1, 4), MarkerSeverity.Warning));\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate async validateBody(promptAST: ParsedPromptFile, promptType: PromptsType, report: (markers: IMarkerData) => void): Promise<void> {\n\t\tconst body = promptAST.body;\n\t\tif (!body) {\n\t\t\treturn;\n\t\t}\n\n\t\t// Validate file references\n\t\tconst fileReferenceChecks: Promise<void>[] = [];\n\t\tfor (const ref of body.fileReferences) {\n\t\t\tconst resolved = body.resolveFilePath(ref.content);\n\t\t\tif (!resolved) {\n\t\t\t\treport(toMarker(localize('promptValidator.invalidFileReference', \"Invalid file reference '{0}'.\", ref.content), ref.range, MarkerSeverity.Warning));\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tif (promptAST.uri.scheme === resolved.scheme) {\n\t\t\t\t// only validate if the link is in the file system of the prompt file\n\t\t\t\tfileReferenceChecks.push((async () => {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tconst exists = await this.fileService.exists(resolved);\n\t\t\t\t\t\tif (exists) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t} catch {\n\t\t\t\t\t}\n\t\t\t\t\tconst loc = this.labelService.getUriLabel(resolved);\n\t\t\t\t\treport(toMarker(localize('promptValidator.fileNotFound', \"File '{0}' not found at '{1}'.\", ref.content, loc), ref.range, MarkerSeverity.Warning));\n\t\t\t\t})());\n\t\t\t}\n\t\t}\n\n\t\tconst isGitHubTarget = isGithubTarget(promptType, promptAST.header?.target);\n\n\t\t// Validate variable references (tool or toolset names)\n\t\tif (body.variableReferences.length && !isGitHubTarget) {\n\t\t\tconst headerTools = promptAST.header?.tools;\n\t\t\tconst headerTarget = promptAST.header?.target;\n\t\t\tconst headerToolsMap = headerTools ? this.languageModelToolsService.toToolAndToolSetEnablementMap(headerTools, headerTarget) : undefined;\n\n\t\t\tconst available = new Set<string>(this.languageModelToolsService.getQualifiedToolNames());\n\t\t\tconst deprecatedNames = this.languageModelToolsService.getDeprecatedQualifiedToolNames();\n\t\t\tfor (const variable of body.variableReferences) {\n\t\t\t\tif (!available.has(variable.name)) {\n\t\t\t\t\tif (deprecatedNames.has(variable.name)) {\n\t\t\t\t\t\tconst currentNames = deprecatedNames.get(variable.name);\n\t\t\t\t\t\tif (currentNames && currentNames.size > 0) {\n\t\t\t\t\t\t\tif (currentNames.size === 1) {\n\t\t\t\t\t\t\t\tconst newName = Array.from(currentNames)[0];\n\t\t\t\t\t\t\t\treport(toMarker(localize('promptValidator.deprecatedVariableReference', \"Tool or toolset '{0}' has been renamed, use '{1}' instead.\", variable.name, newName), variable.range, MarkerSeverity.Info));\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tconst newNames = Array.from(currentNames).sort((a, b) => a.localeCompare(b)).join(', ');\n\t\t\t\t\t\t\t\treport(toMarker(localize('promptValidator.deprecatedVariableReferenceMultipleNames', \"Tool or toolset '{0}' has been renamed, use the following tools instead: {1}\", variable.name, newNames), variable.range, MarkerSeverity.Info));\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\treport(toMarker(localize('promptValidator.unknownVariableReference', \"Unknown tool or toolset '{0}'.\", variable.name), variable.range, MarkerSeverity.Warning));\n\t\t\t\t\t}\n\t\t\t\t} else if (headerToolsMap) {\n\t\t\t\t\tconst tool = this.languageModelToolsService.getToolByQualifiedName(variable.name);\n\t\t\t\t\tif (tool && headerToolsMap.get(tool) === false) {\n\t\t\t\t\t\treport(toMarker(localize('promptValidator.disabledTool', \"Tool or toolset '{0}' also needs to be enabled in the header.\", variable.name), variable.range, MarkerSeverity.Warning));\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tawait Promise.all(fileReferenceChecks);\n\t}\n\n\tprivate validateHeader(promptAST: ParsedPromptFile, promptType: PromptsType, report: (markers: IMarkerData) => void): void {\n\t\tconst header = promptAST.header;\n\t\tif (!header) {\n\t\t\treturn;\n\t\t}\n\t\tconst attributes = header.attributes;\n\t\tconst isGitHubTarget = isGithubTarget(promptType, header.target);\n\t\tthis.checkForInvalidArguments(attributes, promptType, isGitHubTarget, report);\n\n\t\tthis.validateName(attributes, isGitHubTarget, report);\n\t\tthis.validateDescription(attributes, report);\n\t\tthis.validateArgumentHint(attributes, report);\n\t\tswitch (promptType) {\n\t\t\tcase PromptsType.prompt: {\n\t\t\t\tconst agent = this.validateAgent(attributes, report);\n\t\t\t\tthis.validateTools(attributes, agent?.kind ?? ChatModeKind.Agent, header.target, report);\n\t\t\t\tthis.validateModel(attributes, agent?.kind ?? ChatModeKind.Agent, report);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcase PromptsType.instructions:\n\t\t\t\tthis.validateApplyTo(attributes, report);\n\t\t\t\tthis.validateExcludeAgent(attributes, report);\n\t\t\t\tbreak;\n\n\t\t\tcase PromptsType.agent: {\n\t\t\t\tthis.validateTarget(attributes, report);\n\t\t\t\tthis.validateTools(attributes, ChatModeKind.Agent, header.target, report);\n\t\t\t\tif (!isGitHubTarget) {\n\t\t\t\t\tthis.validateModel(attributes, ChatModeKind.Agent, report);\n\t\t\t\t\tthis.validateHandoffs(attributes, report);\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t}\n\t}\n\n\tprivate checkForInvalidArguments(attributes: IHeaderAttribute[], promptType: PromptsType, isGitHubTarget: boolean, report: (markers: IMarkerData) => void): void {\n\t\tconst validAttributeNames = getValidAttributeNames(promptType, true, isGitHubTarget);\n\t\tconst validGithubCopilotAttributeNames = new Lazy(() => new Set(getValidAttributeNames(promptType, false, true)));\n\t\tfor (const attribute of attributes) {\n\t\t\tif (!validAttributeNames.includes(attribute.key)) {\n\t\t\t\tconst supportedNames = new Lazy(() => getValidAttributeNames(promptType, false, isGitHubTarget).sort().join(', '));\n\t\t\t\tswitch (promptType) {\n\t\t\t\t\tcase PromptsType.prompt:\n\t\t\t\t\t\treport(toMarker(localize('promptValidator.unknownAttribute.prompt', \"Attribute '{0}' is not supported in prompt files. Supported: {1}.\", attribute.key, supportedNames.value), attribute.range, MarkerSeverity.Warning));\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase PromptsType.agent:\n\t\t\t\t\t\tif (isGitHubTarget) {\n\t\t\t\t\t\t\treport(toMarker(localize('promptValidator.unknownAttribute.github-agent', \"Attribute '{0}' is not supported in custom Puku AI agent files. Supported: {1}.\", attribute.key, supportedNames.value), attribute.range, MarkerSeverity.Warning));\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tif (validGithubCopilotAttributeNames.value.has(attribute.key)) {\n\t\t\t\t\t\t\t\treport(toMarker(localize('promptValidator.ignoredAttribute.vscode-agent', \"Attribute '{0}' is ignored when running locally in VS Code.\", attribute.key), attribute.range, MarkerSeverity.Info));\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\treport(toMarker(localize('promptValidator.unknownAttribute.vscode-agent', \"Attribute '{0}' is not supported in VS Code agent files. Supported: {1}.\", attribute.key, supportedNames.value), attribute.range, MarkerSeverity.Warning));\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase PromptsType.instructions:\n\t\t\t\t\t\treport(toMarker(localize('promptValidator.unknownAttribute.instructions', \"Attribute '{0}' is not supported in instructions files. Supported: {1}.\", attribute.key, supportedNames.value), attribute.range, MarkerSeverity.Warning));\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\n\n\tprivate validateName(attributes: IHeaderAttribute[], isGitHubTarget: boolean, report: (markers: IMarkerData) => void): void {\n\t\tconst nameAttribute = attributes.find(attr => attr.key === PromptHeaderAttributes.name);\n\t\tif (!nameAttribute) {\n\t\t\treturn;\n\t\t}\n\t\tif (nameAttribute.value.type !== 'string') {\n\t\t\treport(toMarker(localize('promptValidator.nameMustBeString', \"The 'name' attribute must be a string.\"), nameAttribute.range, MarkerSeverity.Error));\n\t\t\treturn;\n\t\t}\n\t\tif (nameAttribute.value.value.trim().length === 0) {\n\t\t\treport(toMarker(localize('promptValidator.nameShouldNotBeEmpty', \"The 'name' attribute must not be empty.\"), nameAttribute.value.range, MarkerSeverity.Error));\n\t\t\treturn;\n\t\t}\n\t}\n\n\tprivate validateDescription(attributes: IHeaderAttribute[], report: (markers: IMarkerData) => void): void {\n\t\tconst descriptionAttribute = attributes.find(attr => attr.key === PromptHeaderAttributes.description);\n\t\tif (!descriptionAttribute) {\n\t\t\treturn;\n\t\t}\n\t\tif (descriptionAttribute.value.type !== 'string') {\n\t\t\treport(toMarker(localize('promptValidator.descriptionMustBeString', \"The 'description' attribute must be a string.\"), descriptionAttribute.range, MarkerSeverity.Error));\n\t\t\treturn;\n\t\t}\n\t\tif (descriptionAttribute.value.value.trim().length === 0) {\n\t\t\treport(toMarker(localize('promptValidator.descriptionShouldNotBeEmpty', \"The 'description' attribute should not be empty.\"), descriptionAttribute.value.range, MarkerSeverity.Error));\n\t\t\treturn;\n\t\t}\n\t}\n\n\tprivate validateArgumentHint(attributes: IHeaderAttribute[], report: (markers: IMarkerData) => void): void {\n\t\tconst argumentHintAttribute = attributes.find(attr => attr.key === PromptHeaderAttributes.argumentHint);\n\t\tif (!argumentHintAttribute) {\n\t\t\treturn;\n\t\t}\n\t\tif (argumentHintAttribute.value.type !== 'string') {\n\t\t\treport(toMarker(localize('promptValidator.argumentHintMustBeString', \"The 'argument-hint' attribute must be a string.\"), argumentHintAttribute.range, MarkerSeverity.Error));\n\t\t\treturn;\n\t\t}\n\t\tif (argumentHintAttribute.value.value.trim().length === 0) {\n\t\t\treport(toMarker(localize('promptValidator.argumentHintShouldNotBeEmpty', \"The 'argument-hint' attribute should not be empty.\"), argumentHintAttribute.value.range, MarkerSeverity.Error));\n\t\t\treturn;\n\t\t}\n\t}\n\n\tprivate validateModel(attributes: IHeaderAttribute[], agentKind: ChatModeKind, report: (markers: IMarkerData) => void): void {\n\t\tconst attribute = attributes.find(attr => attr.key === PromptHeaderAttributes.model);\n\t\tif (!attribute) {\n\t\t\treturn;\n\t\t}\n\t\tif (attribute.value.type !== 'string') {\n\t\t\treport(toMarker(localize('promptValidator.modelMustBeString', \"The 'model' attribute must be a string.\"), attribute.value.range, MarkerSeverity.Error));\n\t\t\treturn;\n\t\t}\n\t\tconst modelName = attribute.value.value.trim();\n\t\tif (modelName.length === 0) {\n\t\t\treport(toMarker(localize('promptValidator.modelMustBeNonEmpty', \"The 'model' attribute must be a non-empty string.\"), attribute.value.range, MarkerSeverity.Error));\n\t\t\treturn;\n\t\t}\n\n\t\tconst languageModes = this.languageModelsService.getLanguageModelIds();\n\t\tif (languageModes.length === 0) {\n\t\t\t// likely the service is not initialized yet\n\t\t\treturn;\n\t\t}\n\t\tconst modelMetadata = this.findModelByName(languageModes, modelName);\n\t\tif (!modelMetadata) {\n\t\t\treport(toMarker(localize('promptValidator.modelNotFound', \"Unknown model '{0}'.\", modelName), attribute.value.range, MarkerSeverity.Warning));\n\n\t\t} else if (agentKind === ChatModeKind.Agent && !ILanguageModelChatMetadata.suitableForAgentMode(modelMetadata)) {\n\t\t\treport(toMarker(localize('promptValidator.modelNotSuited', \"Model '{0}' is not suited for agent mode.\", modelName), attribute.value.range, MarkerSeverity.Warning));\n\t\t}\n\t}\n\n\tprivate findModelByName(languageModes: string[], modelName: string): ILanguageModelChatMetadata | undefined {\n\t\tfor (const model of languageModes) {\n\t\t\tconst metadata = this.languageModelsService.lookupLanguageModel(model);\n\t\t\tif (metadata && metadata.isUserSelectable !== false && ILanguageModelChatMetadata.matchesQualifiedName(modelName, metadata)) {\n\t\t\t\treturn metadata;\n\t\t\t}\n\t\t}\n\t\treturn undefined;\n\t}\n\n\tprivate validateAgent(attributes: IHeaderAttribute[], report: (markers: IMarkerData) => void): IChatMode | undefined {\n\t\tconst agentAttribute = attributes.find(attr => attr.key === PromptHeaderAttributes.agent);\n\t\tconst modeAttribute = attributes.find(attr => attr.key === PromptHeaderAttributes.mode);\n\t\tif (modeAttribute) {\n\t\t\tif (agentAttribute) {\n\t\t\t\treport(toMarker(localize('promptValidator.modeDeprecated', \"The 'mode' attribute has been deprecated. The 'agent' attribute is used instead.\"), modeAttribute.range, MarkerSeverity.Warning));\n\t\t\t} else {\n\t\t\t\treport(toMarker(localize('promptValidator.modeDeprecated.useAgent', \"The 'mode' attribute has been deprecated. Please rename it to 'agent'.\"), modeAttribute.range, MarkerSeverity.Error));\n\t\t\t}\n\t\t}\n\n\t\tconst attribute = attributes.find(attr => attr.key === PromptHeaderAttributes.agent) ?? modeAttribute;\n\t\tif (!attribute) {\n\t\t\treturn undefined; // default agent for prompts is Agent\n\t\t}\n\t\tif (attribute.value.type !== 'string') {\n\t\t\treport(toMarker(localize('promptValidator.attributeMustBeString', \"The '{0}' attribute must be a string.\", attribute.key), attribute.value.range, MarkerSeverity.Error));\n\t\t\treturn undefined;\n\t\t}\n\t\tconst agentValue = attribute.value.value;\n\t\tif (agentValue.trim().length === 0) {\n\t\t\treport(toMarker(localize('promptValidator.attributeMustBeNonEmpty', \"The '{0}' attribute must be a non-empty string.\", attribute.key), attribute.value.range, MarkerSeverity.Error));\n\t\t\treturn undefined;\n\t\t}\n\t\treturn this.validateAgentValue(attribute.value, report);\n\t}\n\n\tprivate validateAgentValue(value: IStringValue, report: (markers: IMarkerData) => void): IChatMode | undefined {\n\t\tconst agents = this.chatModeService.getModes();\n\t\tconst availableAgents = [];\n\n\t\t// Check if agent exists in builtin or custom agents\n\t\tfor (const agent of Iterable.concat(agents.builtin, agents.custom)) {\n\t\t\tif (agent.name.get() === value.value) {\n\t\t\t\treturn agent;\n\t\t\t}\n\t\t\tavailableAgents.push(agent.name.get()); // collect all available agent names\n\t\t}\n\n\t\tconst errorMessage = localize('promptValidator.agentNotFound', \"Unknown agent '{0}'. Available agents: {1}.\", value.value, availableAgents.join(', '));\n\t\treport(toMarker(errorMessage, value.range, MarkerSeverity.Warning));\n\t\treturn undefined;\n\t}\n\n\tprivate validateTools(attributes: IHeaderAttribute[], agentKind: ChatModeKind, target: string | undefined, report: (markers: IMarkerData) => void): undefined {\n\t\tconst attribute = attributes.find(attr => attr.key === PromptHeaderAttributes.tools);\n\t\tif (!attribute) {\n\t\t\treturn;\n\t\t}\n\t\tif (agentKind !== ChatModeKind.Agent) {\n\t\t\treport(toMarker(localize('promptValidator.toolsOnlyInAgent', \"The 'tools' attribute is only supported when using agents. Attribute will be ignored.\"), attribute.range, MarkerSeverity.Warning));\n\t\t}\n\n\t\tswitch (attribute.value.type) {\n\t\t\tcase 'array':\n\t\t\t\tif (target === Target.GitHubCopilot) {\n\t\t\t\t\t// no validation for github-copilot target\n\t\t\t\t} else {\n\t\t\t\t\tthis.validateVSCodeTools(attribute.value, target, report);\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\treport(toMarker(localize('promptValidator.toolsMustBeArrayOrMap', \"The 'tools' attribute must be an array.\"), attribute.value.range, MarkerSeverity.Error));\n\t\t}\n\t}\n\n\tprivate validateVSCodeTools(valueItem: IArrayValue, target: string | undefined, report: (markers: IMarkerData) => void) {\n\t\tif (valueItem.items.length > 0) {\n\t\t\tconst available = new Set<string>(this.languageModelToolsService.getQualifiedToolNames());\n\t\t\tconst deprecatedNames = this.languageModelToolsService.getDeprecatedQualifiedToolNames();\n\t\t\tfor (const item of valueItem.items) {\n\t\t\t\tif (item.type !== 'string') {\n\t\t\t\t\treport(toMarker(localize('promptValidator.eachToolMustBeString', \"Each tool name in the 'tools' attribute must be a string.\"), item.range, MarkerSeverity.Error));\n\t\t\t\t} else if (item.value) {\n\t\t\t\t\tconst toolName = target === undefined ? this.languageModelToolsService.mapGithubToolName(item.value) : item.value;\n\t\t\t\t\tif (!available.has(toolName)) {\n\t\t\t\t\t\tconst currentNames = deprecatedNames.get(toolName);\n\t\t\t\t\t\tif (currentNames) {\n\t\t\t\t\t\t\tif (currentNames?.size === 1) {\n\t\t\t\t\t\t\t\tconst newName = Array.from(currentNames)[0];\n\t\t\t\t\t\t\t\treport(toMarker(localize('promptValidator.toolDeprecated', \"Tool or toolset '{0}' has been renamed, use '{1}' instead.\", toolName, newName), item.range, MarkerSeverity.Info));\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tconst newNames = Array.from(currentNames).sort((a, b) => a.localeCompare(b)).join(', ');\n\t\t\t\t\t\t\t\treport(toMarker(localize('promptValidator.toolDeprecatedMultipleNames', \"Tool or toolset '{0}' has been renamed, use the following tools instead: {1}\", toolName, newNames), item.range, MarkerSeverity.Info));\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\treport(toMarker(localize('promptValidator.toolNotFound', \"Unknown tool '{0}'.\", toolName), item.range, MarkerSeverity.Warning));\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate validateApplyTo(attributes: IHeaderAttribute[], report: (markers: IMarkerData) => void): undefined {\n\t\tconst attribute = attributes.find(attr => attr.key === PromptHeaderAttributes.applyTo);\n\t\tif (!attribute) {\n\t\t\treturn;\n\t\t}\n\t\tif (attribute.value.type !== 'string') {\n\t\t\treport(toMarker(localize('promptValidator.applyToMustBeString', \"The 'applyTo' attribute must be a string.\"), attribute.value.range, MarkerSeverity.Error));\n\t\t\treturn;\n\t\t}\n\t\tconst pattern = attribute.value.value;\n\t\ttry {\n\t\t\tconst patterns = splitGlobAware(pattern, ',');\n\t\t\tif (patterns.length === 0) {\n\t\t\t\treport(toMarker(localize('promptValidator.applyToMustBeValidGlob', \"The 'applyTo' attribute must be a valid glob pattern.\"), attribute.value.range, MarkerSeverity.Error));\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tfor (const pattern of patterns) {\n\t\t\t\tconst globPattern = parse(pattern);\n\t\t\t\tif (isEmptyPattern(globPattern)) {\n\t\t\t\t\treport(toMarker(localize('promptValidator.applyToMustBeValidGlob', \"The 'applyTo' attribute must be a valid glob pattern.\"), attribute.value.range, MarkerSeverity.Error));\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\t\t} catch (_error) {\n\t\t\treport(toMarker(localize('promptValidator.applyToMustBeValidGlob', \"The 'applyTo' attribute must be a valid glob pattern.\"), attribute.value.range, MarkerSeverity.Error));\n\t\t}\n\t}\n\n\tprivate validateExcludeAgent(attributes: IHeaderAttribute[], report: (markers: IMarkerData) => void): undefined {\n\t\tconst attribute = attributes.find(attr => attr.key === PromptHeaderAttributes.excludeAgent);\n\t\tif (!attribute) {\n\t\t\treturn;\n\t\t}\n\t\tif (attribute.value.type !== 'array') {\n\t\t\treport(toMarker(localize('promptValidator.excludeAgentMustBeArray', \"The 'excludeAgent' attribute must be an array.\"), attribute.value.range, MarkerSeverity.Error));\n\t\t\treturn;\n\t\t}\n\t}\n\n\tprivate validateHandoffs(attributes: IHeaderAttribute[], report: (markers: IMarkerData) => void): undefined {\n\t\tconst attribute = attributes.find(attr => attr.key === PromptHeaderAttributes.handOffs);\n\t\tif (!attribute) {\n\t\t\treturn;\n\t\t}\n\t\tif (attribute.value.type !== 'array') {\n\t\t\treport(toMarker(localize('promptValidator.handoffsMustBeArray', \"The 'handoffs' attribute must be an array.\"), attribute.value.range, MarkerSeverity.Error));\n\t\t\treturn;\n\t\t}\n\t\tfor (const item of attribute.value.items) {\n\t\t\tif (item.type !== 'object') {\n\t\t\t\treport(toMarker(localize('promptValidator.eachHandoffMustBeObject', \"Each handoff in the 'handoffs' attribute must be an object with 'label', 'agent', 'prompt' and optional 'send'.\"), item.range, MarkerSeverity.Error));\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tconst required = new Set(['label', 'agent', 'prompt']);\n\t\t\tfor (const prop of item.properties) {\n\t\t\t\tswitch (prop.key.value) {\n\t\t\t\t\tcase 'label':\n\t\t\t\t\t\tif (prop.value.type !== 'string' || prop.value.value.trim().length === 0) {\n\t\t\t\t\t\t\treport(toMarker(localize('promptValidator.handoffLabelMustBeNonEmptyString', \"The 'label' property in a handoff must be a non-empty string.\"), prop.value.range, MarkerSeverity.Error));\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'agent':\n\t\t\t\t\t\tif (prop.value.type !== 'string' || prop.value.value.trim().length === 0) {\n\t\t\t\t\t\t\treport(toMarker(localize('promptValidator.handoffAgentMustBeNonEmptyString', \"The 'agent' property in a handoff must be a non-empty string.\"), prop.value.range, MarkerSeverity.Error));\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tthis.validateAgentValue(prop.value, report);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'prompt':\n\t\t\t\t\t\tif (prop.value.type !== 'string') {\n\t\t\t\t\t\t\treport(toMarker(localize('promptValidator.handoffPromptMustBeString', \"The 'prompt' property in a handoff must be a string.\"), prop.value.range, MarkerSeverity.Error));\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'send':\n\t\t\t\t\t\tif (prop.value.type !== 'boolean') {\n\t\t\t\t\t\t\treport(toMarker(localize('promptValidator.handoffSendMustBeBoolean', \"The 'send' property in a handoff must be a boolean.\"), prop.value.range, MarkerSeverity.Error));\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tdefault:\n\t\t\t\t\t\treport(toMarker(localize('promptValidator.unknownHandoffProperty', \"Unknown property '{0}' in handoff object. Supported properties are 'label', 'agent', 'prompt' and optional 'send'.\", prop.key.value), prop.value.range, MarkerSeverity.Warning));\n\t\t\t\t}\n\t\t\t\trequired.delete(prop.key.value);\n\t\t\t}\n\t\t\tif (required.size > 0) {\n\t\t\t\treport(toMarker(localize('promptValidator.missingHandoffProperties', \"Missing required properties {0} in handoff object.\", Array.from(required).map(s => `'${s}'`).join(', ')), item.range, MarkerSeverity.Error));\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate validateTarget(attributes: IHeaderAttribute[], report: (markers: IMarkerData) => void): undefined {\n\t\tconst attribute = attributes.find(attr => attr.key === PromptHeaderAttributes.target);\n\t\tif (!attribute) {\n\t\t\treturn;\n\t\t}\n\t\tif (attribute.value.type !== 'string') {\n\t\t\treport(toMarker(localize('promptValidator.targetMustBeString', \"The 'target' attribute must be a string.\"), attribute.value.range, MarkerSeverity.Error));\n\t\t\treturn;\n\t\t}\n\t\tconst targetValue = attribute.value.value.trim();\n\t\tif (targetValue.length === 0) {\n\t\t\treport(toMarker(localize('promptValidator.targetMustBeNonEmpty', \"The 'target' attribute must be a non-empty string.\"), attribute.value.range, MarkerSeverity.Error));\n\t\t\treturn;\n\t\t}\n\t\tconst validTargets = ['github-copilot', 'vscode'];\n\t\tif (!validTargets.includes(targetValue)) {\n\t\t\treport(toMarker(localize('promptValidator.targetInvalidValue', \"The 'target' attribute must be one of: {0}.\", validTargets.join(', ')), attribute.value.range, MarkerSeverity.Error));\n\t\t}\n\t}\n}\n\nconst allAttributeNames = {\n\t[PromptsType.prompt]: [PromptHeaderAttributes.name, PromptHeaderAttributes.description, PromptHeaderAttributes.model, PromptHeaderAttributes.tools, PromptHeaderAttributes.mode, PromptHeaderAttributes.agent, PromptHeaderAttributes.argumentHint],\n\t[PromptsType.instructions]: [PromptHeaderAttributes.name, PromptHeaderAttributes.description, PromptHeaderAttributes.applyTo, PromptHeaderAttributes.excludeAgent],\n\t[PromptsType.agent]: [PromptHeaderAttributes.name, PromptHeaderAttributes.description, PromptHeaderAttributes.model, PromptHeaderAttributes.tools, PromptHeaderAttributes.advancedOptions, PromptHeaderAttributes.handOffs, PromptHeaderAttributes.argumentHint, PromptHeaderAttributes.target]\n};\nconst githubCopilotAgentAttributeNames = [PromptHeaderAttributes.name, PromptHeaderAttributes.description, PromptHeaderAttributes.tools, PromptHeaderAttributes.target, GithubPromptHeaderAttributes.mcpServers];\nconst recommendedAttributeNames = {\n\t[PromptsType.prompt]: allAttributeNames[PromptsType.prompt].filter(name => !isNonRecommendedAttribute(name)),\n\t[PromptsType.instructions]: allAttributeNames[PromptsType.instructions].filter(name => !isNonRecommendedAttribute(name)),\n\t[PromptsType.agent]: allAttributeNames[PromptsType.agent].filter(name => !isNonRecommendedAttribute(name))\n};\n\nexport function getValidAttributeNames(promptType: PromptsType, includeNonRecommended: boolean, isGitHubTarget: boolean): string[] {\n\tif (isGitHubTarget && promptType === PromptsType.agent) {\n\t\treturn githubCopilotAgentAttributeNames;\n\t}\n\treturn includeNonRecommended ? allAttributeNames[promptType] : recommendedAttributeNames[promptType];\n}\n\nexport function isNonRecommendedAttribute(attributeName: string): boolean {\n\treturn attributeName === PromptHeaderAttributes.advancedOptions || attributeName === PromptHeaderAttributes.excludeAgent || attributeName === PromptHeaderAttributes.mode;\n}\n\n// The list of tools known to be used by Puku AI custom agents\nexport const knownGithubCopilotTools: Record<string, string> = {\n\t'shell': localize('githubCopilotTools.shell', 'Execute shell commands'),\n\t'edit': localize('githubCopilotTools.edit', 'Edit files'),\n\t'search': localize('githubCopilotTools.search', 'Search in files'),\n\t'custom-agent': localize('githubCopilotTools.customAgent', 'Call custom agents')\n};\nexport function isGithubTarget(promptType: PromptsType, target: string | undefined): boolean {\n\treturn promptType === PromptsType.agent && target === Target.GitHubCopilot;\n}\n\nfunction toMarker(message: string, range: Range, severity = MarkerSeverity.Error): IMarkerData {\n\treturn { severity, message, ...range };\n}\n\nexport class PromptValidatorContribution extends Disposable {\n\n\tprivate readonly validator: PromptValidator;\n\tprivate readonly localDisposables = this._register(new DisposableStore());\n\n\tconstructor(\n\t\t@IModelService private modelService: IModelService,\n\t\t@IInstantiationService instantiationService: IInstantiationService,\n\t\t@IMarkerService private readonly markerService: IMarkerService,\n\t\t@IPromptsService private readonly promptsService: IPromptsService,\n\t\t@ILanguageModelsService private readonly languageModelsService: ILanguageModelsService,\n\t\t@ILanguageModelToolsService private readonly languageModelToolsService: ILanguageModelToolsService,\n\t\t@IChatModeService private readonly chatModeService: IChatModeService,\n\t) {\n\t\tsuper();\n\t\tthis.validator = instantiationService.createInstance(PromptValidator);\n\n\t\tthis.updateRegistration();\n\t}\n\n\tupdateRegistration(): void {\n\t\tthis.localDisposables.clear();\n\t\tconst trackers = new ResourceMap<ModelTracker>();\n\t\tthis.localDisposables.add(toDisposable(() => {\n\t\t\ttrackers.forEach(tracker => tracker.dispose());\n\t\t\ttrackers.clear();\n\t\t}));\n\t\tthis.modelService.getModels().forEach(model => {\n\t\t\tconst promptType = getPromptsTypeForLanguageId(model.getLanguageId());\n\t\t\tif (promptType) {\n\t\t\t\ttrackers.set(model.uri, new ModelTracker(model, promptType, this.validator, this.promptsService, this.markerService));\n\t\t\t}\n\t\t});\n\n\t\tthis.localDisposables.add(this.modelService.onModelAdded((model) => {\n\t\t\tconst promptType = getPromptsTypeForLanguageId(model.getLanguageId());\n\t\t\tif (promptType && !trackers.has(model.uri)) {\n\t\t\t\ttrackers.set(model.uri, new ModelTracker(model, promptType, this.validator, this.promptsService, this.markerService));\n\t\t\t}\n\t\t}));\n\t\tthis.localDisposables.add(this.modelService.onModelRemoved((model) => {\n\t\t\tconst tracker = trackers.get(model.uri);\n\t\t\tif (tracker) {\n\t\t\t\ttracker.dispose();\n\t\t\t\ttrackers.delete(model.uri);\n\t\t\t}\n\t\t}));\n\t\tthis.localDisposables.add(this.modelService.onModelLanguageChanged((event) => {\n\t\t\tconst { model } = event;\n\t\t\tconst tracker = trackers.get(model.uri);\n\t\t\tif (tracker) {\n\t\t\t\ttracker.dispose();\n\t\t\t\ttrackers.delete(model.uri);\n\t\t\t}\n\t\t\tconst promptType = getPromptsTypeForLanguageId(model.getLanguageId());\n\t\t\tif (promptType) {\n\t\t\t\ttrackers.set(model.uri, new ModelTracker(model, promptType, this.validator, this.promptsService, this.markerService));\n\t\t\t}\n\t\t}));\n\n\t\tconst validateAll = (): void => trackers.forEach(tracker => tracker.validate());\n\t\tthis.localDisposables.add(this.languageModelToolsService.onDidChangeTools(() => validateAll()));\n\t\tthis.localDisposables.add(this.chatModeService.onDidChangeChatModes(() => validateAll()));\n\t\tthis.localDisposables.add(this.languageModelsService.onDidChangeLanguageModels(() => validateAll()));\n\t}\n}\n\nclass ModelTracker extends Disposable {\n\n\tprivate readonly delayer: Delayer<void>;\n\n\tconstructor(\n\t\tprivate readonly textModel: ITextModel,\n\t\tprivate readonly promptType: PromptsType,\n\t\tprivate readonly validator: PromptValidator,\n\t\t@IPromptsService private readonly promptsService: IPromptsService,\n\t\t@IMarkerService private readonly markerService: IMarkerService,\n\t) {\n\t\tsuper();\n\t\tthis.delayer = this._register(new Delayer<void>(200));\n\t\tthis._register(textModel.onDidChangeContent(() => this.validate()));\n\t\tthis.validate();\n\t}\n\n\tpublic validate(): void {\n\t\tthis.delayer.trigger(async () => {\n\t\t\tconst markers: IMarkerData[] = [];\n\t\t\tconst ast = this.promptsService.getParsedPromptFile(this.textModel);\n\t\t\tawait this.validator.validate(ast, this.promptType, m => markers.push(m));\n\t\t\tthis.markerService.changeOne(MARKERS_OWNER_ID, this.textModel.uri, markers);\n\t\t});\n\t}\n\n\tpublic override dispose() {\n\t\tthis.markerService.remove(MARKERS_OWNER_ID, [this.textModel.uri]);\n\t\tsuper.dispose();\n\t}\n}\n"]}