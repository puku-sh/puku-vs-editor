{"version":3,"sources":["vs/workbench/contrib/chat/electron-browser/tools/fetchPageTool.ts"],"names":[],"mappings":"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","file":"fetchPageTool.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { assertNever } from '../../../../../base/common/assert.js';\nimport { CancellationToken } from '../../../../../base/common/cancellation.js';\nimport { MarkdownString } from '../../../../../base/common/htmlContent.js';\nimport { Iterable } from '../../../../../base/common/iterator.js';\nimport { ResourceSet } from '../../../../../base/common/map.js';\nimport { extname } from '../../../../../base/common/path.js';\nimport { URI } from '../../../../../base/common/uri.js';\nimport { localize } from '../../../../../nls.js';\nimport { IFileService } from '../../../../../platform/files/common/files.js';\nimport { IWebContentExtractorService, WebContentExtractResult } from '../../../../../platform/webContentExtractor/common/webContentExtractor.js';\nimport { detectEncodingFromBuffer } from '../../../../services/textfile/common/encoding.js';\nimport { ITrustedDomainService } from '../../../url/browser/trustedDomainService.js';\nimport { IChatService } from '../../common/chatService.js';\nimport { LocalChatSessionUri } from '../../common/chatUri.js';\nimport { ChatImageMimeType } from '../../common/languageModels.js';\nimport { CountTokensCallback, IPreparedToolInvocation, IToolData, IToolImpl, IToolInvocation, IToolInvocationPreparationContext, IToolResult, IToolResultDataPart, IToolResultTextPart, ToolDataSource, ToolProgress } from '../../common/languageModelToolsService.js';\nimport { InternalFetchWebPageToolId } from '../../common/tools/tools.js';\n\nexport const FetchWebPageToolData: IToolData = {\n\tid: InternalFetchWebPageToolId,\n\tdisplayName: 'Fetch Web Page',\n\tcanBeReferencedInPrompt: false,\n\tmodelDescription: 'Fetches the main content from a web page. This tool is useful for summarizing or analyzing the content of a webpage.',\n\tsource: ToolDataSource.Internal,\n\tcanRequestPostApproval: true,\n\tcanRequestPreApproval: true,\n\tinputSchema: {\n\t\ttype: 'object',\n\t\tproperties: {\n\t\t\turls: {\n\t\t\t\ttype: 'array',\n\t\t\t\titems: {\n\t\t\t\t\ttype: 'string',\n\t\t\t\t},\n\t\t\t\tdescription: localize('fetchWebPage.urlsDescription', 'An array of URLs to fetch content from.')\n\t\t\t}\n\t\t},\n\t\trequired: ['urls']\n\t}\n};\n\nexport interface IFetchWebPageToolParams {\n\turls?: string[];\n}\n\ntype ResultType = string | { type: 'tooldata'; value: IToolResultDataPart } | { type: 'extracted'; value: WebContentExtractResult } | undefined;\n\nexport class FetchWebPageTool implements IToolImpl {\n\n\tconstructor(\n\t\t@IWebContentExtractorService private readonly _readerModeService: IWebContentExtractorService,\n\t\t@IFileService private readonly _fileService: IFileService,\n\t\t@ITrustedDomainService private readonly _trustedDomainService: ITrustedDomainService,\n\t\t@IChatService private readonly _chatService: IChatService,\n\t) { }\n\n\tasync invoke(invocation: IToolInvocation, _countTokens: CountTokensCallback, _progress: ToolProgress, token: CancellationToken): Promise<IToolResult> {\n\t\tconst urls = (invocation.parameters as IFetchWebPageToolParams).urls || [];\n\t\tconst { webUris, fileUris, invalidUris } = this._parseUris(urls);\n\t\tconst allValidUris = [...webUris.values(), ...fileUris.values()];\n\n\t\tif (!allValidUris.length && invalidUris.size === 0) {\n\t\t\treturn {\n\t\t\t\tcontent: [{ kind: 'text', value: localize('fetchWebPage.noValidUrls', 'No valid URLs provided.') }]\n\t\t\t};\n\t\t}\n\n\t\t// Get contents from web URIs\n\t\tconst webContents = webUris.size > 0 ? await this._readerModeService.extract([...webUris.values()]) : [];\n\n\t\t// Get contents from file URIs\n\t\tconst fileContents: (string | { type: 'tooldata'; value: IToolResultDataPart } | undefined)[] = [];\n\t\tconst successfulFileUris: URI[] = [];\n\t\tfor (const uri of fileUris.values()) {\n\t\t\ttry {\n\t\t\t\tconst fileContent = await this._fileService.readFile(uri, undefined, token);\n\n\t\t\t\t// Check if this is a supported image type first\n\t\t\t\tconst imageMimeType = this._getSupportedImageMimeType(uri);\n\t\t\t\tif (imageMimeType) {\n\t\t\t\t\t// For supported image files, return as IToolResultDataPart\n\t\t\t\t\tfileContents.push({\n\t\t\t\t\t\ttype: 'tooldata',\n\t\t\t\t\t\tvalue: {\n\t\t\t\t\t\t\tkind: 'data',\n\t\t\t\t\t\t\tvalue: {\n\t\t\t\t\t\t\t\tmimeType: imageMimeType,\n\t\t\t\t\t\t\t\tdata: fileContent.value\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\t// Check if the content is binary\n\t\t\t\t\tconst detected = detectEncodingFromBuffer({ buffer: fileContent.value, bytesRead: fileContent.value.byteLength });\n\n\t\t\t\t\tif (detected.seemsBinary) {\n\t\t\t\t\t\t// For binary files, return a message indicating they're not supported\n\t\t\t\t\t\t// We do this for now until the tools that leverage this internal tool can support binary content\n\t\t\t\t\t\tfileContents.push(localize('fetchWebPage.binaryNotSupported', 'Binary files are not supported at the moment.'));\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// For text files, convert to string\n\t\t\t\t\t\tfileContents.push(fileContent.value.toString());\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tsuccessfulFileUris.push(uri);\n\t\t\t} catch (error) {\n\t\t\t\t// If file service can't read it, treat as invalid\n\t\t\t\tfileContents.push(undefined);\n\t\t\t}\n\t\t}\n\n\t\t// Build results array in original order\n\t\tconst results: ResultType[] = [];\n\t\tlet webIndex = 0;\n\t\tlet fileIndex = 0;\n\t\tfor (const url of urls) {\n\t\t\tif (invalidUris.has(url)) {\n\t\t\t\tresults.push(undefined);\n\t\t\t} else if (webUris.has(url)) {\n\t\t\t\tresults.push({ type: 'extracted', value: webContents[webIndex] });\n\t\t\t\twebIndex++;\n\t\t\t} else if (fileUris.has(url)) {\n\t\t\t\tresults.push(fileContents[fileIndex]);\n\t\t\t\tfileIndex++;\n\t\t\t} else {\n\t\t\t\tresults.push(undefined);\n\t\t\t}\n\t\t}\n\n\t\t// Skip confirming any results if every web content we got was an error or redirect\n\t\tlet confirmResults: undefined | boolean;\n\t\tif (webContents.every(e => e.status === 'error' || e.status === 'redirect')) {\n\t\t\tconfirmResults = false;\n\t\t}\n\n\n\t\t// Only include URIs that actually had content successfully fetched\n\t\tconst actuallyValidUris = [...webUris.values(), ...successfulFileUris];\n\n\t\treturn {\n\t\t\tcontent: this._getPromptPartsForResults(results),\n\t\t\ttoolResultDetails: actuallyValidUris,\n\t\t\tconfirmResults,\n\t\t};\n\t}\n\n\tasync prepareToolInvocation(context: IToolInvocationPreparationContext, token: CancellationToken): Promise<IPreparedToolInvocation | undefined> {\n\t\tconst { webUris, fileUris, invalidUris } = this._parseUris(context.parameters.urls);\n\n\t\t// Check which file URIs can actually be read\n\t\tconst validFileUris: URI[] = [];\n\t\tconst additionalInvalidUrls: string[] = [];\n\t\tfor (const [originalUrl, uri] of fileUris.entries()) {\n\t\t\ttry {\n\t\t\t\tawait this._fileService.stat(uri);\n\t\t\t\tvalidFileUris.push(uri);\n\t\t\t} catch (error) {\n\t\t\t\t// If file service can't stat it, treat as invalid\n\t\t\t\tadditionalInvalidUrls.push(originalUrl);\n\t\t\t}\n\t\t}\n\n\t\tconst invalid = [...Array.from(invalidUris), ...additionalInvalidUrls];\n\t\tconst urlsNeedingConfirmation = new ResourceSet([...webUris.values(), ...validFileUris]);\n\n\t\tconst pastTenseMessage = invalid.length\n\t\t\t? invalid.length > 1\n\t\t\t\t// If there are multiple invalid URLs, show them all\n\t\t\t\t? new MarkdownString(\n\t\t\t\t\tlocalize(\n\t\t\t\t\t\t'fetchWebPage.pastTenseMessage.plural',\n\t\t\t\t\t\t'Fetched {0} resources, but the following were invalid URLs:\\n\\n{1}\\n\\n', urlsNeedingConfirmation.size, invalid.map(url => `- ${url}`).join('\\n')\n\t\t\t\t\t))\n\t\t\t\t// If there is only one invalid URL, show it\n\t\t\t\t: new MarkdownString(\n\t\t\t\t\tlocalize(\n\t\t\t\t\t\t'fetchWebPage.pastTenseMessage.singular',\n\t\t\t\t\t\t'Fetched resource, but the following was an invalid URL:\\n\\n{0}\\n\\n', invalid[0]\n\t\t\t\t\t))\n\t\t\t// No invalid URLs\n\t\t\t: new MarkdownString();\n\n\t\tconst invocationMessage = new MarkdownString();\n\t\tif (urlsNeedingConfirmation.size > 1) {\n\t\t\tpastTenseMessage.appendMarkdown(localize('fetchWebPage.pastTenseMessageResult.plural', 'Fetched {0} resources', urlsNeedingConfirmation.size));\n\t\t\tinvocationMessage.appendMarkdown(localize('fetchWebPage.invocationMessage.plural', 'Fetching {0} resources', urlsNeedingConfirmation.size));\n\t\t} else if (urlsNeedingConfirmation.size === 1) {\n\t\t\tconst url = Iterable.first(urlsNeedingConfirmation)!.toString();\n\t\t\t// If the URL is too long or it's a file url, show it as a link... otherwise, show it as plain text\n\t\t\tif (url.length > 400 || validFileUris.length === 1) {\n\t\t\t\tpastTenseMessage.appendMarkdown(localize({\n\t\t\t\t\tkey: 'fetchWebPage.pastTenseMessageResult.singularAsLink',\n\t\t\t\t\tcomment: [\n\t\t\t\t\t\t// Make sure the link syntax is correct\n\t\t\t\t\t\t'{Locked=\"]({0})\"}',\n\t\t\t\t\t]\n\t\t\t\t}, 'Fetched [resource]({0})', url));\n\t\t\t\tinvocationMessage.appendMarkdown(localize({\n\t\t\t\t\tkey: 'fetchWebPage.invocationMessage.singularAsLink',\n\t\t\t\t\tcomment: [\n\t\t\t\t\t\t// Make sure the link syntax is correct\n\t\t\t\t\t\t'{Locked=\"]({0})\"}',\n\t\t\t\t\t]\n\t\t\t\t}, 'Fetching [resource]({0})', url));\n\t\t\t} else {\n\t\t\t\tpastTenseMessage.appendMarkdown(localize('fetchWebPage.pastTenseMessageResult.singular', 'Fetched {0}', url));\n\t\t\t\tinvocationMessage.appendMarkdown(localize('fetchWebPage.invocationMessage.singular', 'Fetching {0}', url));\n\t\t\t}\n\t\t}\n\n\t\tif (context.chatSessionId) {\n\t\t\tconst model = this._chatService.getSession(LocalChatSessionUri.forSession(context.chatSessionId));\n\t\t\tconst userMessages = model?.getRequests().map(r => r.message.text.toLowerCase());\n\t\t\tfor (const uri of urlsNeedingConfirmation) {\n\t\t\t\t// Normalize to lowercase and remove any trailing slash\n\t\t\t\tconst toToCheck = uri.toString(true).toLowerCase().replace(/\\/$/, '');\n\t\t\t\tif (userMessages?.some(m => m.includes(toToCheck))) {\n\t\t\t\t\turlsNeedingConfirmation.delete(uri);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tconst result: IPreparedToolInvocation = { invocationMessage, pastTenseMessage };\n\t\tconst allDomainsTrusted = Iterable.every(urlsNeedingConfirmation, u => this._trustedDomainService.isValid(u));\n\t\tlet confirmationTitle: string | undefined;\n\t\tlet confirmationMessage: string | MarkdownString | undefined;\n\n\t\tif (urlsNeedingConfirmation.size && !allDomainsTrusted) {\n\t\t\tif (urlsNeedingConfirmation.size === 1) {\n\t\t\t\tconfirmationTitle = localize('fetchWebPage.confirmationTitle.singular', 'Fetch web page?');\n\t\t\t\tconfirmationMessage = new MarkdownString(\n\t\t\t\t\tIterable.first(urlsNeedingConfirmation)!.toString(),\n\t\t\t\t\t{ supportThemeIcons: true }\n\t\t\t\t);\n\t\t\t} else {\n\t\t\t\tconfirmationTitle = localize('fetchWebPage.confirmationTitle.plural', 'Fetch web pages?');\n\t\t\t\tconfirmationMessage = new MarkdownString(\n\t\t\t\t\t[...urlsNeedingConfirmation].map(uri => `- ${uri.toString()}`).join('\\n'),\n\t\t\t\t\t{ supportThemeIcons: true }\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\t\tresult.confirmationMessages = {\n\t\t\ttitle: confirmationTitle,\n\t\t\tmessage: confirmationMessage,\n\t\t\tconfirmResults: urlsNeedingConfirmation.size > 0,\n\t\t\tallowAutoConfirm: true,\n\t\t\tdisclaimer: new MarkdownString('$(info) ' + localize('fetchWebPage.confirmationMessage.plural', 'Web content may contain malicious code or attempt prompt injection attacks.'), { supportThemeIcons: true })\n\t\t};\n\t\treturn result;\n\t}\n\n\tprivate _parseUris(urls?: string[]): { webUris: Map<string, URI>; fileUris: Map<string, URI>; invalidUris: Set<string> } {\n\t\tconst webUris = new Map<string, URI>();\n\t\tconst fileUris = new Map<string, URI>();\n\t\tconst invalidUris = new Set<string>();\n\n\t\turls?.forEach(url => {\n\t\t\ttry {\n\t\t\t\tconst uriObj = URI.parse(url);\n\t\t\t\tif (uriObj.scheme === 'http' || uriObj.scheme === 'https') {\n\t\t\t\t\twebUris.set(url, uriObj);\n\t\t\t\t} else {\n\t\t\t\t\t// Try to handle other schemes via file service\n\t\t\t\t\tfileUris.set(url, uriObj);\n\t\t\t\t}\n\t\t\t} catch (e) {\n\t\t\t\tinvalidUris.add(url);\n\t\t\t}\n\t\t});\n\n\t\treturn { webUris, fileUris, invalidUris };\n\t}\n\n\tprivate _getPromptPartsForResults(results: ResultType[]): (IToolResultTextPart | IToolResultDataPart)[] {\n\t\treturn results.map(value => {\n\t\t\tif (!value) {\n\t\t\t\treturn {\n\t\t\t\t\tkind: 'text',\n\t\t\t\t\tvalue: localize('fetchWebPage.invalidUrl', 'Invalid URL')\n\t\t\t\t};\n\t\t\t} else if (typeof value === 'string') {\n\t\t\t\treturn {\n\t\t\t\t\tkind: 'text',\n\t\t\t\t\tvalue: value\n\t\t\t\t};\n\t\t\t} else if (value.type === 'tooldata') {\n\t\t\t\treturn value.value;\n\t\t\t} else if (value.type === 'extracted') {\n\t\t\t\tswitch (value.value.status) {\n\t\t\t\t\tcase 'ok':\n\t\t\t\t\t\treturn { kind: 'text', value: value.value.result };\n\t\t\t\t\tcase 'redirect':\n\t\t\t\t\t\treturn { kind: 'text', value: `The webpage has redirected to \"${value.value.toURI.toString(true)}\". Use the ${InternalFetchWebPageToolId} again to get its contents.` };\n\t\t\t\t\tcase 'error':\n\t\t\t\t\t\treturn { kind: 'text', value: `An error occurred retrieving the fetch result: ${value.value.error}` };\n\t\t\t\t\tdefault:\n\t\t\t\t\t\tassertNever(value.value);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tthrow new Error('unreachable');\n\t\t\t}\n\t\t});\n\t}\n\n\tprivate _getSupportedImageMimeType(uri: URI): ChatImageMimeType | undefined {\n\t\tconst ext = extname(uri.path).toLowerCase();\n\t\tswitch (ext) {\n\t\t\tcase '.png':\n\t\t\t\treturn ChatImageMimeType.PNG;\n\t\t\tcase '.jpg':\n\t\t\tcase '.jpeg':\n\t\t\t\treturn ChatImageMimeType.JPEG;\n\t\t\tcase '.gif':\n\t\t\t\treturn ChatImageMimeType.GIF;\n\t\t\tcase '.webp':\n\t\t\t\treturn ChatImageMimeType.WEBP;\n\t\t\tcase '.bmp':\n\t\t\t\treturn ChatImageMimeType.BMP;\n\t\t\tdefault:\n\t\t\t\treturn undefined;\n\t\t}\n\t}\n}\n"]}