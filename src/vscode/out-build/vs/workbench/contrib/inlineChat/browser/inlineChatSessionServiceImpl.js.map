{"version":3,"sources":["vs/workbench/contrib/inlineChat/browser/inlineChatSessionServiceImpl.ts"],"names":[],"mappings":"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","file":"inlineChatSessionServiceImpl.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nimport { CancellationToken } from '../../../../base/common/cancellation.js';\nimport { Emitter, Event } from '../../../../base/common/event.js';\nimport { Disposable, DisposableStore, IDisposable, MutableDisposable, toDisposable } from '../../../../base/common/lifecycle.js';\nimport { ResourceMap } from '../../../../base/common/map.js';\nimport { Schemas } from '../../../../base/common/network.js';\nimport { autorun, observableFromEvent } from '../../../../base/common/observable.js';\nimport { isEqual } from '../../../../base/common/resources.js';\nimport { assertType } from '../../../../base/common/types.js';\nimport { URI } from '../../../../base/common/uri.js';\nimport { generateUuid } from '../../../../base/common/uuid.js';\nimport { IActiveCodeEditor, ICodeEditor, isCodeEditor, isCompositeEditor, isDiffEditor } from '../../../../editor/browser/editorBrowser.js';\nimport { ICodeEditorService } from '../../../../editor/browser/services/codeEditorService.js';\nimport { Range } from '../../../../editor/common/core/range.js';\nimport { ILanguageService } from '../../../../editor/common/languages/language.js';\nimport { IValidEditOperation } from '../../../../editor/common/model.js';\nimport { createTextBufferFactoryFromSnapshot } from '../../../../editor/common/model/textModel.js';\nimport { IEditorWorkerService } from '../../../../editor/common/services/editorWorker.js';\nimport { IModelService } from '../../../../editor/common/services/model.js';\nimport { ITextModelService } from '../../../../editor/common/services/resolverService.js';\nimport { localize, localize2 } from '../../../../nls.js';\nimport { IConfigurationService } from '../../../../platform/configuration/common/configuration.js';\nimport { ContextKeyExpr, IContextKey, IContextKeyService } from '../../../../platform/contextkey/common/contextkey.js';\nimport { IDialogService } from '../../../../platform/dialogs/common/dialogs.js';\nimport { IInstantiationService, ServicesAccessor } from '../../../../platform/instantiation/common/instantiation.js';\nimport { ILogService } from '../../../../platform/log/common/log.js';\nimport { Action2, registerAction2 } from '../../../../platform/actions/common/actions.js';\nimport { observableConfigValue } from '../../../../platform/observable/common/platformObservableUtils.js';\nimport { IStorageService, StorageScope, StorageTarget } from '../../../../platform/storage/common/storage.js';\nimport { ITelemetryService } from '../../../../platform/telemetry/common/telemetry.js';\nimport { DEFAULT_EDITOR_ASSOCIATION } from '../../../common/editor.js';\nimport { IEditorService } from '../../../services/editor/common/editorService.js';\nimport { ITextFileService } from '../../../services/textfile/common/textfiles.js';\nimport { UntitledTextEditorInput } from '../../../services/untitled/common/untitledTextEditorInput.js';\nimport { IChatWidgetService } from '../../chat/browser/chat.js';\nimport { IChatAgentService } from '../../chat/common/chatAgents.js';\nimport { ModifiedFileEntryState } from '../../chat/common/chatEditingService.js';\nimport { IChatService } from '../../chat/common/chatService.js';\nimport { ChatAgentLocation } from '../../chat/common/constants.js';\nimport { ILanguageModelToolsService, ToolDataSource, IToolData } from '../../chat/common/languageModelToolsService.js';\nimport { CTX_INLINE_CHAT_HAS_AGENT2, CTX_INLINE_CHAT_HAS_NOTEBOOK_AGENT, CTX_INLINE_CHAT_HAS_NOTEBOOK_INLINE, CTX_INLINE_CHAT_POSSIBLE, InlineChatConfigKeys } from '../common/inlineChat.js';\nimport { HunkData, Session, SessionWholeRange, StashedSession, TelemetryData, TelemetryDataClassification } from './inlineChatSession.js';\nimport { askInPanelChat, IInlineChatSession2, IInlineChatSessionEndEvent, IInlineChatSessionEvent, IInlineChatSessionService, ISessionKeyComputer } from './inlineChatSessionService.js';\n\n\ntype SessionData = {\n\teditor: ICodeEditor;\n\tsession: Session;\n\tstore: IDisposable;\n};\n\nexport class InlineChatError extends Error {\n\tstatic readonly code = 'InlineChatError';\n\tconstructor(message: string) {\n\t\tsuper(message);\n\t\tthis.name = InlineChatError.code;\n\t}\n}\n\n\nexport class InlineChatSessionServiceImpl implements IInlineChatSessionService {\n\n\tdeclare _serviceBrand: undefined;\n\n\tprivate readonly _store = new DisposableStore();\n\n\tprivate readonly _onWillStartSession = this._store.add(new Emitter<IActiveCodeEditor>());\n\treadonly onWillStartSession: Event<IActiveCodeEditor> = this._onWillStartSession.event;\n\n\tprivate readonly _onDidMoveSession = this._store.add(new Emitter<IInlineChatSessionEvent>());\n\treadonly onDidMoveSession: Event<IInlineChatSessionEvent> = this._onDidMoveSession.event;\n\n\tprivate readonly _onDidEndSession = this._store.add(new Emitter<IInlineChatSessionEndEvent>());\n\treadonly onDidEndSession: Event<IInlineChatSessionEndEvent> = this._onDidEndSession.event;\n\n\tprivate readonly _onDidStashSession = this._store.add(new Emitter<IInlineChatSessionEvent>());\n\treadonly onDidStashSession: Event<IInlineChatSessionEvent> = this._onDidStashSession.event;\n\n\tprivate readonly _sessions = new Map<string, SessionData>();\n\tprivate readonly _keyComputers = new Map<string, ISessionKeyComputer>();\n\n\tconstructor(\n\t\t@ITelemetryService private readonly _telemetryService: ITelemetryService,\n\t\t@IModelService private readonly _modelService: IModelService,\n\t\t@ITextModelService private readonly _textModelService: ITextModelService,\n\t\t@IEditorWorkerService private readonly _editorWorkerService: IEditorWorkerService,\n\t\t@ILogService private readonly _logService: ILogService,\n\t\t@IInstantiationService private readonly _instaService: IInstantiationService,\n\t\t@IEditorService private readonly _editorService: IEditorService,\n\t\t@ITextFileService private readonly _textFileService: ITextFileService,\n\t\t@ILanguageService private readonly _languageService: ILanguageService,\n\t\t@IChatService private readonly _chatService: IChatService,\n\t\t@IChatAgentService private readonly _chatAgentService: IChatAgentService,\n\t\t@IChatWidgetService private readonly _chatWidgetService: IChatWidgetService,\n\t) {\n\n\t}\n\n\tdispose() {\n\t\tthis._store.dispose();\n\t\tthis._sessions.forEach(x => x.store.dispose());\n\t\tthis._sessions.clear();\n\t}\n\n\tasync createSession(editor: IActiveCodeEditor, options: { headless?: boolean; wholeRange?: Range; session?: Session }, token: CancellationToken): Promise<Session | undefined> {\n\n\t\tconst agent = this._chatAgentService.getDefaultAgent(ChatAgentLocation.EditorInline);\n\n\t\tif (!agent) {\n\t\t\tthis._logService.trace('[IE] NO agent found');\n\t\t\treturn undefined;\n\t\t}\n\n\t\tthis._onWillStartSession.fire(editor);\n\n\t\tconst textModel = editor.getModel();\n\t\tconst selection = editor.getSelection();\n\n\t\tconst store = new DisposableStore();\n\t\tthis._logService.trace(`[IE] creating NEW session for ${editor.getId()}, ${agent.extensionId}`);\n\n\t\tconst chatModel = options.session?.chatModel ?? this._chatService.startSession(ChatAgentLocation.EditorInline, token);\n\t\tif (!chatModel) {\n\t\t\tthis._logService.trace('[IE] NO chatModel found');\n\t\t\treturn undefined;\n\t\t}\n\n\t\tstore.add(toDisposable(() => {\n\t\t\tconst doesOtherSessionUseChatModel = [...this._sessions.values()].some(data => data.session !== session && data.session.chatModel === chatModel);\n\n\t\t\tif (!doesOtherSessionUseChatModel) {\n\t\t\t\tthis._chatService.clearSession(chatModel.sessionResource);\n\t\t\t\tchatModel.dispose();\n\t\t\t}\n\t\t}));\n\n\t\tconst lastResponseListener = store.add(new MutableDisposable());\n\t\tstore.add(chatModel.onDidChange(e => {\n\t\t\tif (e.kind !== 'addRequest' || !e.request.response) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst { response } = e.request;\n\n\t\t\tsession.markModelVersion(e.request);\n\t\t\tlastResponseListener.value = response.onDidChange(() => {\n\n\t\t\t\tif (!response.isComplete) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tlastResponseListener.clear(); // ONCE\n\n\t\t\t\t// special handling for untitled files\n\t\t\t\tfor (const part of response.response.value) {\n\t\t\t\t\tif (part.kind !== 'textEditGroup' || part.uri.scheme !== Schemas.untitled || isEqual(part.uri, session.textModelN.uri)) {\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\t\tconst langSelection = this._languageService.createByFilepathOrFirstLine(part.uri, undefined);\n\t\t\t\t\tconst untitledTextModel = this._textFileService.untitled.create({\n\t\t\t\t\t\tassociatedResource: part.uri,\n\t\t\t\t\t\tlanguageId: langSelection.languageId\n\t\t\t\t\t});\n\t\t\t\t\tuntitledTextModel.resolve();\n\t\t\t\t\tthis._textModelService.createModelReference(part.uri).then(ref => {\n\t\t\t\t\t\tstore.add(ref);\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t});\n\t\t}));\n\n\t\tstore.add(this._chatAgentService.onDidChangeAgents(e => {\n\t\t\tif (e === undefined && (!this._chatAgentService.getAgent(agent.id) || !this._chatAgentService.getActivatedAgents().map(agent => agent.id).includes(agent.id))) {\n\t\t\t\tthis._logService.trace(`[IE] provider GONE for ${editor.getId()}, ${agent.extensionId}`);\n\t\t\t\tthis._releaseSession(session, true);\n\t\t\t}\n\t\t}));\n\n\t\tconst id = generateUuid();\n\t\tconst targetUri = textModel.uri;\n\n\t\t// AI edits happen in the actual model, keep a reference but make no copy\n\t\tstore.add((await this._textModelService.createModelReference(textModel.uri)));\n\t\tconst textModelN = textModel;\n\n\t\t// create: keep a snapshot of the \"actual\" model\n\t\tconst textModel0 = store.add(this._modelService.createModel(\n\t\t\tcreateTextBufferFactoryFromSnapshot(textModel.createSnapshot()),\n\t\t\t{ languageId: textModel.getLanguageId(), onDidChange: Event.None },\n\t\t\ttargetUri.with({ scheme: Schemas.vscode, authority: 'inline-chat', path: '', query: new URLSearchParams({ id, 'textModel0': '' }).toString() }), true\n\t\t));\n\n\t\t// untitled documents are special and we are releasing their session when their last editor closes\n\t\tif (targetUri.scheme === Schemas.untitled) {\n\t\t\tstore.add(this._editorService.onDidCloseEditor(() => {\n\t\t\t\tif (!this._editorService.isOpened({ resource: targetUri, typeId: UntitledTextEditorInput.ID, editorId: DEFAULT_EDITOR_ASSOCIATION.id })) {\n\t\t\t\t\tthis._releaseSession(session, true);\n\t\t\t\t}\n\t\t\t}));\n\t\t}\n\n\t\tlet wholeRange = options.wholeRange;\n\t\tif (!wholeRange) {\n\t\t\twholeRange = new Range(selection.selectionStartLineNumber, selection.selectionStartColumn, selection.positionLineNumber, selection.positionColumn);\n\t\t}\n\n\t\tif (token.isCancellationRequested) {\n\t\t\tstore.dispose();\n\t\t\treturn undefined;\n\t\t}\n\n\t\tconst session = new Session(\n\t\t\toptions.headless ?? false,\n\t\t\ttargetUri,\n\t\t\ttextModel0,\n\t\t\ttextModelN,\n\t\t\tagent,\n\t\t\tstore.add(new SessionWholeRange(textModelN, wholeRange)),\n\t\t\tstore.add(new HunkData(this._editorWorkerService, textModel0, textModelN)),\n\t\t\tchatModel,\n\t\t\toptions.session?.versionsByRequest,\n\t\t);\n\n\t\t// store: key -> session\n\t\tconst key = this._key(editor, session.targetUri);\n\t\tif (this._sessions.has(key)) {\n\t\t\tstore.dispose();\n\t\t\tthrow new Error(`Session already stored for ${key}`);\n\t\t}\n\t\tthis._sessions.set(key, { session, editor, store });\n\t\treturn session;\n\t}\n\n\tmoveSession(session: Session, target: ICodeEditor): void {\n\t\tconst newKey = this._key(target, session.targetUri);\n\t\tconst existing = this._sessions.get(newKey);\n\t\tif (existing) {\n\t\t\tif (existing.session !== session) {\n\t\t\t\tthrow new Error(`Cannot move session because the target editor already/still has one`);\n\t\t\t} else {\n\t\t\t\t// noop\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tlet found = false;\n\t\tfor (const [oldKey, data] of this._sessions) {\n\t\t\tif (data.session === session) {\n\t\t\t\tfound = true;\n\t\t\t\tthis._sessions.delete(oldKey);\n\t\t\t\tthis._sessions.set(newKey, { ...data, editor: target });\n\t\t\t\tthis._logService.trace(`[IE] did MOVE session for ${data.editor.getId()} to NEW EDITOR ${target.getId()}, ${session.agent.extensionId}`);\n\t\t\t\tthis._onDidMoveSession.fire({ session, editor: target });\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\tif (!found) {\n\t\t\tthrow new Error(`Cannot move session because it is not stored`);\n\t\t}\n\t}\n\n\treleaseSession(session: Session): void {\n\t\tthis._releaseSession(session, false);\n\t}\n\n\tprivate _releaseSession(session: Session, byServer: boolean): void {\n\n\t\tlet tuple: [string, SessionData] | undefined;\n\n\t\t// cleanup\n\t\tfor (const candidate of this._sessions) {\n\t\t\tif (candidate[1].session === session) {\n\t\t\t\t// if (value.session === session) {\n\t\t\t\ttuple = candidate;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\tif (!tuple) {\n\t\t\t// double remove\n\t\t\treturn;\n\t\t}\n\n\t\tthis._telemetryService.publicLog2<TelemetryData, TelemetryDataClassification>('interactiveEditor/session', session.asTelemetryData());\n\n\t\tconst [key, value] = tuple;\n\t\tthis._sessions.delete(key);\n\t\tthis._logService.trace(`[IE] did RELEASED session for ${value.editor.getId()}, ${session.agent.extensionId}`);\n\n\t\tthis._onDidEndSession.fire({ editor: value.editor, session, endedByExternalCause: byServer });\n\t\tvalue.store.dispose();\n\t}\n\n\tstashSession(session: Session, editor: ICodeEditor, undoCancelEdits: IValidEditOperation[]): StashedSession {\n\t\tconst result = this._instaService.createInstance(StashedSession, editor, session, undoCancelEdits);\n\t\tthis._onDidStashSession.fire({ editor, session });\n\t\tthis._logService.trace(`[IE] did STASH session for ${editor.getId()}, ${session.agent.extensionId}`);\n\t\treturn result;\n\t}\n\n\tgetCodeEditor(session: Session): ICodeEditor {\n\t\tfor (const [, data] of this._sessions) {\n\t\t\tif (data.session === session) {\n\t\t\t\treturn data.editor;\n\t\t\t}\n\t\t}\n\t\tthrow new Error('session not found');\n\t}\n\n\tgetSession(editor: ICodeEditor, uri: URI): Session | undefined {\n\t\tconst key = this._key(editor, uri);\n\t\treturn this._sessions.get(key)?.session;\n\t}\n\n\tprivate _key(editor: ICodeEditor, uri: URI): string {\n\t\tconst item = this._keyComputers.get(uri.scheme);\n\t\treturn item\n\t\t\t? item.getComparisonKey(editor, uri)\n\t\t\t: `${editor.getId()}@${uri.toString()}`;\n\n\t}\n\n\tregisterSessionKeyComputer(scheme: string, value: ISessionKeyComputer): IDisposable {\n\t\tthis._keyComputers.set(scheme, value);\n\t\treturn toDisposable(() => this._keyComputers.delete(scheme));\n\t}\n\n\t// ---- NEW\n\n\tprivate readonly _sessions2 = new ResourceMap<IInlineChatSession2>();\n\n\tprivate readonly _onDidChangeSessions = this._store.add(new Emitter<this>());\n\treadonly onDidChangeSessions: Event<this> = this._onDidChangeSessions.event;\n\n\n\tasync createSession2(editor: ICodeEditor, uri: URI, token: CancellationToken): Promise<IInlineChatSession2> {\n\n\t\tassertType(editor.hasModel());\n\n\t\tif (this._sessions2.has(uri)) {\n\t\t\tthrow new Error('Session already exists');\n\t\t}\n\n\t\tthis._onWillStartSession.fire(editor as IActiveCodeEditor);\n\n\t\tconst chatModel = this._chatService.startSession(ChatAgentLocation.EditorInline, token);\n\t\tchatModel.startEditingSession(false);\n\n\t\tconst widget = this._chatWidgetService.getWidgetBySessionResource(chatModel.sessionResource);\n\t\tawait widget?.attachmentModel.addFile(uri);\n\n\t\tconst store = new DisposableStore();\n\t\tstore.add(toDisposable(() => {\n\t\t\tthis._chatService.cancelCurrentRequestForSession(chatModel.sessionResource);\n\t\t\tchatModel.editingSession?.reject();\n\t\t\tthis._sessions2.delete(uri);\n\t\t\tthis._onDidChangeSessions.fire(this);\n\t\t}));\n\t\tstore.add(chatModel);\n\n\t\tstore.add(autorun(r => {\n\n\t\t\tconst entries = chatModel.editingSession?.entries.read(r);\n\t\t\tif (!entries?.length) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst state = entries.find(entry => isEqual(entry.modifiedURI, uri))?.state.read(r);\n\t\t\tif (state === ModifiedFileEntryState.Accepted || state === ModifiedFileEntryState.Rejected) {\n\t\t\t\tconst response = chatModel.getRequests().at(-1)?.response;\n\t\t\t\tif (response) {\n\t\t\t\t\tthis._chatService.notifyUserAction({\n\t\t\t\t\t\tsessionResource: response.session.sessionResource,\n\t\t\t\t\t\trequestId: response.requestId,\n\t\t\t\t\t\tagentId: response.agent?.id,\n\t\t\t\t\t\tcommand: response.slashCommand?.name,\n\t\t\t\t\t\tresult: response.result,\n\t\t\t\t\t\taction: {\n\t\t\t\t\t\t\tkind: 'inlineChat',\n\t\t\t\t\t\t\taction: state === ModifiedFileEntryState.Accepted ? 'accepted' : 'discarded'\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tconst allSettled = entries.every(entry => {\n\t\t\t\tconst state = entry.state.read(r);\n\t\t\t\treturn (state === ModifiedFileEntryState.Accepted || state === ModifiedFileEntryState.Rejected)\n\t\t\t\t\t&& !entry.isCurrentlyBeingModifiedBy.read(r);\n\t\t\t});\n\n\t\t\tif (allSettled && !chatModel.requestInProgress.read(undefined)) {\n\t\t\t\t// self terminate\n\t\t\t\tstore.dispose();\n\t\t\t}\n\t\t}));\n\n\t\tconst result: IInlineChatSession2 = {\n\t\t\turi,\n\t\t\tinitialPosition: editor.getSelection().getStartPosition().delta(-1), /* one line above selection start */\n\t\t\tchatModel,\n\t\t\teditingSession: chatModel.editingSession!,\n\t\t\tdispose: store.dispose.bind(store)\n\t\t};\n\t\tthis._sessions2.set(uri, result);\n\t\tthis._onDidChangeSessions.fire(this);\n\t\treturn result;\n\t}\n\n\tgetSession2(uriOrSessionId: URI | string): IInlineChatSession2 | undefined {\n\t\tif (URI.isUri(uriOrSessionId)) {\n\n\t\t\tlet result = this._sessions2.get(uriOrSessionId);\n\t\t\tif (!result) {\n\t\t\t\t// no direct session, try to find an editing session which has a file entry for the uri\n\t\t\t\tfor (const [_, candidate] of this._sessions2) {\n\t\t\t\t\tconst entry = candidate.editingSession.getEntry(uriOrSessionId);\n\t\t\t\t\tif (entry) {\n\t\t\t\t\t\tresult = candidate;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn result;\n\t\t} else {\n\t\t\tfor (const session of this._sessions2.values()) {\n\t\t\t\tif (session.chatModel.sessionId === uriOrSessionId) {\n\t\t\t\t\treturn session;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn undefined;\n\t}\n}\n\nexport class InlineChatEnabler {\n\n\tstatic Id = 'inlineChat.enabler';\n\n\tprivate readonly _ctxHasProvider2: IContextKey<boolean>;\n\tprivate readonly _ctxHasNotebookInline: IContextKey<boolean>;\n\tprivate readonly _ctxHasNotebookProvider: IContextKey<boolean>;\n\tprivate readonly _ctxPossible: IContextKey<boolean>;\n\n\tprivate readonly _store = new DisposableStore();\n\n\tconstructor(\n\t\t@IContextKeyService contextKeyService: IContextKeyService,\n\t\t@IChatAgentService chatAgentService: IChatAgentService,\n\t\t@IEditorService editorService: IEditorService,\n\t\t@IConfigurationService configService: IConfigurationService,\n\t) {\n\t\tthis._ctxHasProvider2 = CTX_INLINE_CHAT_HAS_AGENT2.bindTo(contextKeyService);\n\t\tthis._ctxHasNotebookInline = CTX_INLINE_CHAT_HAS_NOTEBOOK_INLINE.bindTo(contextKeyService);\n\t\tthis._ctxHasNotebookProvider = CTX_INLINE_CHAT_HAS_NOTEBOOK_AGENT.bindTo(contextKeyService);\n\t\tthis._ctxPossible = CTX_INLINE_CHAT_POSSIBLE.bindTo(contextKeyService);\n\n\t\tconst agentObs = observableFromEvent(this, chatAgentService.onDidChangeAgents, () => chatAgentService.getDefaultAgent(ChatAgentLocation.EditorInline));\n\t\tconst notebookAgentObs = observableFromEvent(this, chatAgentService.onDidChangeAgents, () => chatAgentService.getDefaultAgent(ChatAgentLocation.Notebook));\n\t\tconst notebookAgentConfigObs = observableConfigValue(InlineChatConfigKeys.notebookAgent, false, configService);\n\n\t\tthis._store.add(autorun(r => {\n\t\t\tconst agent = agentObs.read(r);\n\t\t\tif (!agent) {\n\t\t\t\tthis._ctxHasProvider2.reset();\n\t\t\t} else {\n\t\t\t\tthis._ctxHasProvider2.set(true);\n\t\t\t}\n\t\t}));\n\n\t\tthis._store.add(autorun(r => {\n\t\t\tthis._ctxHasNotebookInline.set(!notebookAgentConfigObs.read(r) && !!agentObs.read(r));\n\t\t\tthis._ctxHasNotebookProvider.set(notebookAgentConfigObs.read(r) && !!notebookAgentObs.read(r));\n\t\t}));\n\n\t\tconst updateEditor = () => {\n\t\t\tconst ctrl = editorService.activeEditorPane?.getControl();\n\t\t\tconst isCodeEditorLike = isCodeEditor(ctrl) || isDiffEditor(ctrl) || isCompositeEditor(ctrl);\n\t\t\tthis._ctxPossible.set(isCodeEditorLike);\n\t\t};\n\n\t\tthis._store.add(editorService.onDidActiveEditorChange(updateEditor));\n\t\tupdateEditor();\n\t}\n\n\tdispose() {\n\t\tthis._ctxPossible.reset();\n\t\tthis._ctxHasProvider2.reset();\n\t\tthis._store.dispose();\n\t}\n}\n\n\nexport class InlineChatEscapeToolContribution extends Disposable {\n\n\tstatic readonly Id = 'inlineChat.escapeTool';\n\n\tstatic readonly DONT_ASK_AGAIN_KEY = 'inlineChat.dontAskMoveToPanelChat';\n\n\tprivate static readonly _data: IToolData = {\n\t\tid: 'inline_chat_exit',\n\t\tsource: ToolDataSource.Internal,\n\t\tcanBeReferencedInPrompt: false,\n\t\talwaysDisplayInputOutput: false,\n\t\tdisplayName: localize('name', \"Inline Chat to Panel Chat\"),\n\t\tmodelDescription: 'Moves the inline chat session to the richer panel chat which supports edits across files, creating and deleting files, multi-turn conversations between the user and the assistant, and access to more IDE tools, like retrieve problems, interact with source control, run terminal commands etc.',\n\t};\n\n\tconstructor(\n\t\t@ILanguageModelToolsService lmTools: ILanguageModelToolsService,\n\t\t@IInlineChatSessionService inlineChatSessionService: IInlineChatSessionService,\n\t\t@IDialogService dialogService: IDialogService,\n\t\t@ICodeEditorService codeEditorService: ICodeEditorService,\n\t\t@IChatService chatService: IChatService,\n\t\t@ILogService logService: ILogService,\n\t\t@IStorageService storageService: IStorageService,\n\t\t@IInstantiationService instaService: IInstantiationService,\n\t) {\n\n\t\tsuper();\n\n\t\tthis._store.add(lmTools.registerTool(InlineChatEscapeToolContribution._data, {\n\t\t\tinvoke: async (invocation, _tokenCountFn, _progress, _token) => {\n\n\t\t\t\tconst sessionId = invocation.context?.sessionId;\n\n\t\t\t\tif (!sessionId) {\n\t\t\t\t\tlogService.warn('InlineChatEscapeToolContribution: no sessionId in tool invocation context');\n\t\t\t\t\treturn { content: [{ kind: 'text', value: 'Cancel' }] };\n\t\t\t\t}\n\n\t\t\t\tconst session = inlineChatSessionService.getSession2(sessionId);\n\n\t\t\t\tif (!session) {\n\t\t\t\t\tlogService.warn(`InlineChatEscapeToolContribution: no session found for id ${sessionId}`);\n\t\t\t\t\treturn { content: [{ kind: 'text', value: 'Cancel' }] };\n\t\t\t\t}\n\n\t\t\t\tconst dontAskAgain = storageService.getBoolean(InlineChatEscapeToolContribution.DONT_ASK_AGAIN_KEY, StorageScope.PROFILE);\n\n\t\t\t\tlet result: { confirmed: boolean; checkboxChecked?: boolean };\n\t\t\t\tif (dontAskAgain !== undefined) {\n\t\t\t\t\t// Use previously stored user preference: true = 'Continue in Chat view', false = 'Rephrase' (Cancel)\n\t\t\t\t\tresult = { confirmed: dontAskAgain, checkboxChecked: false };\n\t\t\t\t} else {\n\t\t\t\t\tresult = await dialogService.confirm({\n\t\t\t\t\t\ttype: 'question',\n\t\t\t\t\t\ttitle: localize('confirm.title', \"Do you want to continue in Chat view?\"),\n\t\t\t\t\t\tmessage: localize('confirm', \"Do you want to continue in Chat view?\"),\n\t\t\t\t\t\tdetail: localize('confirm.detail', \"Inline chat is designed for making single-file code changes. Continue your request in the Chat view or rephrase it for inline chat.\"),\n\t\t\t\t\t\tprimaryButton: localize('confirm.yes', \"Continue in Chat view\"),\n\t\t\t\t\t\tcancelButton: localize('confirm.cancel', \"Cancel\"),\n\t\t\t\t\t\tcheckbox: { label: localize('chat.remove.confirmation.checkbox', \"Don't ask again\"), checked: false },\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tconst editor = codeEditorService.getFocusedCodeEditor();\n\n\t\t\t\tif (!editor || result.confirmed) {\n\t\t\t\t\tlogService.trace('InlineChatEscapeToolContribution: moving session to panel chat');\n\t\t\t\t\tawait instaService.invokeFunction(askInPanelChat, session.chatModel.getRequests().at(-1)!);\n\t\t\t\t\tsession.dispose();\n\n\t\t\t\t} else {\n\t\t\t\t\tlogService.trace('InlineChatEscapeToolContribution: rephrase prompt');\n\t\t\t\t\tchatService.removeRequest(session.chatModel.sessionResource, session.chatModel.getRequests().at(-1)!.id);\n\t\t\t\t}\n\n\t\t\t\tif (result.checkboxChecked) {\n\t\t\t\t\tstorageService.store(InlineChatEscapeToolContribution.DONT_ASK_AGAIN_KEY, result.confirmed, StorageScope.PROFILE, StorageTarget.USER);\n\t\t\t\t\tlogService.trace('InlineChatEscapeToolContribution: stored don\\'t ask again preference');\n\t\t\t\t}\n\n\t\t\t\treturn { content: [{ kind: 'text', value: 'Success' }] };\n\t\t\t}\n\t\t}));\n\t}\n}\n\nregisterAction2(class ResetMoveToPanelChatChoice extends Action2 {\n\tconstructor() {\n\t\tsuper({\n\t\t\tid: 'inlineChat.resetMoveToPanelChatChoice',\n\t\t\tprecondition: ContextKeyExpr.has('config.chat.disableAIFeatures').negate(),\n\t\t\ttitle: localize2('resetChoice.label', \"Reset Choice for 'Move Inline Chat to Panel Chat'\"),\n\t\t\tf1: true\n\t\t});\n\t}\n\trun(accessor: ServicesAccessor) {\n\t\taccessor.get(IStorageService).remove(InlineChatEscapeToolContribution.DONT_ASK_AGAIN_KEY, StorageScope.PROFILE);\n\t}\n});\n"]}