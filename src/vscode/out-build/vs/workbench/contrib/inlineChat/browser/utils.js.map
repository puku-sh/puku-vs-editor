{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/contrib/inlineChat/browser/utils.ts","vs/workbench/contrib/inlineChat/browser/utils.ts"],"names":[],"mappings":"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","file":"utils.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { EditOperation } from '../../../../editor/common/core/editOperation.js';\nimport { IRange } from '../../../../editor/common/core/range.js';\nimport { IIdentifiedSingleEditOperation, ITextModel, IValidEditOperation, TrackedRangeStickiness } from '../../../../editor/common/model.js';\nimport { IEditObserver } from './inlineChatStrategies.js';\nimport { IProgress } from '../../../../platform/progress/common/progress.js';\nimport { IntervalTimer, AsyncIterableSource } from '../../../../base/common/async.js';\nimport { CancellationToken } from '../../../../base/common/cancellation.js';\nimport { getNWords } from '../../chat/common/chatWordCounter.js';\nimport { TextModelEditSource } from '../../../../editor/common/textModelEditSource.js';\n\n\n\n// --- async edit\n\nexport interface AsyncTextEdit {\n\treadonly range: IRange;\n\treadonly newText: AsyncIterable<string>;\n}\n\nexport async function performAsyncTextEdit(model: ITextModel, edit: AsyncTextEdit, progress?: IProgress<IValidEditOperation[]>, obs?: IEditObserver, editSource?: TextModelEditSource) {\n\n\tconst [id] = model.deltaDecorations([], [{\n\t\trange: edit.range,\n\t\toptions: {\n\t\t\tdescription: 'asyncTextEdit',\n\t\t\tstickiness: TrackedRangeStickiness.AlwaysGrowsWhenTypingAtEdges\n\t\t}\n\t}]);\n\n\tlet first = true;\n\tfor await (const part of edit.newText) {\n\n\t\tif (model.isDisposed()) {\n\t\t\tbreak;\n\t\t}\n\n\t\tconst range = model.getDecorationRange(id);\n\t\tif (!range) {\n\t\t\tthrow new Error('FAILED to perform async replace edit because the anchor decoration was removed');\n\t\t}\n\n\t\tconst edit = first\n\t\t\t? EditOperation.replace(range, part) // first edit needs to override the \"anchor\"\n\t\t\t: EditOperation.insert(range.getEndPosition(), part);\n\t\tobs?.start();\n\n\t\tmodel.pushEditOperations(null, [edit], (undoEdits) => {\n\t\t\tprogress?.report(undoEdits);\n\t\t\treturn null;\n\t\t}, undefined, editSource);\n\n\t\tobs?.stop();\n\t\tfirst = false;\n\t}\n}\n\nexport function asProgressiveEdit(interval: IntervalTimer, edit: IIdentifiedSingleEditOperation, wordsPerSec: number, token: CancellationToken): AsyncTextEdit {\n\n\twordsPerSec = Math.max(30, wordsPerSec);\n\n\tconst stream = new AsyncIterableSource<string>();\n\tlet newText = edit.text ?? '';\n\n\tinterval.cancelAndSet(() => {\n\t\tif (token.isCancellationRequested) {\n\t\t\treturn;\n\t\t}\n\t\tconst r = getNWords(newText, 1);\n\t\tstream.emitOne(r.value);\n\t\tnewText = newText.substring(r.value.length);\n\t\tif (r.isFullString) {\n\t\t\tinterval.cancel();\n\t\t\tstream.resolve();\n\t\t\td.dispose();\n\t\t}\n\n\t}, 1000 / wordsPerSec);\n\n\t// cancel ASAP\n\tconst d = token.onCancellationRequested(() => {\n\t\tinterval.cancel();\n\t\tstream.resolve();\n\t\td.dispose();\n\t});\n\n\treturn {\n\t\trange: edit.range,\n\t\tnewText: stream.asyncIterable\n\t};\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { EditOperation } from '../../../../editor/common/core/editOperation.js';\nimport { IRange } from '../../../../editor/common/core/range.js';\nimport { IIdentifiedSingleEditOperation, ITextModel, IValidEditOperation, TrackedRangeStickiness } from '../../../../editor/common/model.js';\nimport { IEditObserver } from './inlineChatStrategies.js';\nimport { IProgress } from '../../../../platform/progress/common/progress.js';\nimport { IntervalTimer, AsyncIterableSource } from '../../../../base/common/async.js';\nimport { CancellationToken } from '../../../../base/common/cancellation.js';\nimport { getNWords } from '../../chat/common/chatWordCounter.js';\nimport { TextModelEditSource } from '../../../../editor/common/textModelEditSource.js';\n\n\n\n// --- async edit\n\nexport interface AsyncTextEdit {\n\treadonly range: IRange;\n\treadonly newText: AsyncIterable<string>;\n}\n\nexport async function performAsyncTextEdit(model: ITextModel, edit: AsyncTextEdit, progress?: IProgress<IValidEditOperation[]>, obs?: IEditObserver, editSource?: TextModelEditSource) {\n\n\tconst [id] = model.deltaDecorations([], [{\n\t\trange: edit.range,\n\t\toptions: {\n\t\t\tdescription: 'asyncTextEdit',\n\t\t\tstickiness: TrackedRangeStickiness.AlwaysGrowsWhenTypingAtEdges\n\t\t}\n\t}]);\n\n\tlet first = true;\n\tfor await (const part of edit.newText) {\n\n\t\tif (model.isDisposed()) {\n\t\t\tbreak;\n\t\t}\n\n\t\tconst range = model.getDecorationRange(id);\n\t\tif (!range) {\n\t\t\tthrow new Error('FAILED to perform async replace edit because the anchor decoration was removed');\n\t\t}\n\n\t\tconst edit = first\n\t\t\t? EditOperation.replace(range, part) // first edit needs to override the \"anchor\"\n\t\t\t: EditOperation.insert(range.getEndPosition(), part);\n\t\tobs?.start();\n\n\t\tmodel.pushEditOperations(null, [edit], (undoEdits) => {\n\t\t\tprogress?.report(undoEdits);\n\t\t\treturn null;\n\t\t}, undefined, editSource);\n\n\t\tobs?.stop();\n\t\tfirst = false;\n\t}\n}\n\nexport function asProgressiveEdit(interval: IntervalTimer, edit: IIdentifiedSingleEditOperation, wordsPerSec: number, token: CancellationToken): AsyncTextEdit {\n\n\twordsPerSec = Math.max(30, wordsPerSec);\n\n\tconst stream = new AsyncIterableSource<string>();\n\tlet newText = edit.text ?? '';\n\n\tinterval.cancelAndSet(() => {\n\t\tif (token.isCancellationRequested) {\n\t\t\treturn;\n\t\t}\n\t\tconst r = getNWords(newText, 1);\n\t\tstream.emitOne(r.value);\n\t\tnewText = newText.substring(r.value.length);\n\t\tif (r.isFullString) {\n\t\t\tinterval.cancel();\n\t\t\tstream.resolve();\n\t\t\td.dispose();\n\t\t}\n\n\t}, 1000 / wordsPerSec);\n\n\t// cancel ASAP\n\tconst d = token.onCancellationRequested(() => {\n\t\tinterval.cancel();\n\t\tstream.resolve();\n\t\td.dispose();\n\t});\n\n\treturn {\n\t\trange: edit.range,\n\t\tnewText: stream.asyncIterable\n\t};\n}\n"]}