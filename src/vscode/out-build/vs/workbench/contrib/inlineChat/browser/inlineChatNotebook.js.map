{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/contrib/inlineChat/browser/inlineChatNotebook.ts","vs/workbench/contrib/inlineChat/browser/inlineChatNotebook.ts"],"names":[],"mappings":"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","file":"inlineChatNotebook.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { illegalState } from '../../../../base/common/errors.js';\nimport { DisposableStore } from '../../../../base/common/lifecycle.js';\nimport { Schemas } from '../../../../base/common/network.js';\nimport { isEqual } from '../../../../base/common/resources.js';\nimport { ICodeEditor } from '../../../../editor/browser/editorBrowser.js';\nimport { InlineChatController } from './inlineChatController.js';\nimport { IInlineChatSessionService } from './inlineChatSessionService.js';\nimport { INotebookEditorService } from '../../notebook/browser/services/notebookEditorService.js';\nimport { CellUri } from '../../notebook/common/notebookCommon.js';\nimport { IEditorService } from '../../../services/editor/common/editorService.js';\nimport { NotebookTextDiffEditor } from '../../notebook/browser/diff/notebookDiffEditor.js';\nimport { NotebookMultiTextDiffEditor } from '../../notebook/browser/diff/notebookMultiDiffEditor.js';\n\nexport class InlineChatNotebookContribution {\n\n\tprivate readonly _store = new DisposableStore();\n\n\tconstructor(\n\t\t@IInlineChatSessionService sessionService: IInlineChatSessionService,\n\t\t@IEditorService editorService: IEditorService,\n\t\t@INotebookEditorService notebookEditorService: INotebookEditorService,\n\t) {\n\n\t\tthis._store.add(sessionService.registerSessionKeyComputer(Schemas.vscodeNotebookCell, {\n\t\t\tgetComparisonKey: (editor, uri) => {\n\t\t\t\tconst data = CellUri.parse(uri);\n\t\t\t\tif (!data) {\n\t\t\t\t\tthrow illegalState('Expected notebook cell uri');\n\t\t\t\t}\n\t\t\t\tlet fallback: string | undefined;\n\t\t\t\tfor (const notebookEditor of notebookEditorService.listNotebookEditors()) {\n\t\t\t\t\tif (notebookEditor.hasModel() && isEqual(notebookEditor.textModel.uri, data.notebook)) {\n\n\t\t\t\t\t\tconst candidate = `<notebook>${notebookEditor.getId()}#${uri}`;\n\n\t\t\t\t\t\tif (!fallback) {\n\t\t\t\t\t\t\tfallback = candidate;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// find the code editor in the list of cell-code editors\n\t\t\t\t\t\tif (notebookEditor.codeEditors.find((tuple) => tuple[1] === editor)) {\n\t\t\t\t\t\t\treturn candidate;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// \t// reveal cell and try to find code editor again\n\t\t\t\t\t\t// \tconst cell = notebookEditor.getCellByHandle(data.handle);\n\t\t\t\t\t\t// \tif (cell) {\n\t\t\t\t\t\t// \t\tnotebookEditor.revealInViewAtTop(cell);\n\t\t\t\t\t\t// \t\tif (notebookEditor.codeEditors.find((tuple) => tuple[1] === editor)) {\n\t\t\t\t\t\t// \t\t\treturn candidate;\n\t\t\t\t\t\t// \t\t}\n\t\t\t\t\t\t// \t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (fallback) {\n\t\t\t\t\treturn fallback;\n\t\t\t\t}\n\n\t\t\t\tconst activeEditor = editorService.activeEditorPane;\n\t\t\t\tif (activeEditor && (activeEditor.getId() === NotebookTextDiffEditor.ID || activeEditor.getId() === NotebookMultiTextDiffEditor.ID)) {\n\t\t\t\t\treturn `<notebook>${editor.getId()}#${uri}`;\n\t\t\t\t}\n\n\t\t\t\tthrow illegalState('Expected notebook editor');\n\t\t\t}\n\t\t}));\n\n\t\tthis._store.add(sessionService.onWillStartSession(newSessionEditor => {\n\t\t\tconst candidate = CellUri.parse(newSessionEditor.getModel().uri);\n\t\t\tif (!candidate) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tfor (const notebookEditor of notebookEditorService.listNotebookEditors()) {\n\t\t\t\tif (isEqual(notebookEditor.textModel?.uri, candidate.notebook)) {\n\t\t\t\t\tlet found = false;\n\t\t\t\t\tconst editors: ICodeEditor[] = [];\n\t\t\t\t\tfor (const [, codeEditor] of notebookEditor.codeEditors) {\n\t\t\t\t\t\teditors.push(codeEditor);\n\t\t\t\t\t\tfound = codeEditor === newSessionEditor || found;\n\t\t\t\t\t}\n\t\t\t\t\tif (found) {\n\t\t\t\t\t\t// found the this editor in the outer notebook editor -> make sure to\n\t\t\t\t\t\t// cancel all sibling sessions\n\t\t\t\t\t\tfor (const editor of editors) {\n\t\t\t\t\t\t\tif (editor !== newSessionEditor) {\n\t\t\t\t\t\t\t\tInlineChatController.get(editor)?.acceptSession();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}));\n\t}\n\n\tdispose(): void {\n\t\tthis._store.dispose();\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { illegalState } from '../../../../base/common/errors.js';\nimport { DisposableStore } from '../../../../base/common/lifecycle.js';\nimport { Schemas } from '../../../../base/common/network.js';\nimport { isEqual } from '../../../../base/common/resources.js';\nimport { ICodeEditor } from '../../../../editor/browser/editorBrowser.js';\nimport { InlineChatController } from './inlineChatController.js';\nimport { IInlineChatSessionService } from './inlineChatSessionService.js';\nimport { INotebookEditorService } from '../../notebook/browser/services/notebookEditorService.js';\nimport { CellUri } from '../../notebook/common/notebookCommon.js';\nimport { IEditorService } from '../../../services/editor/common/editorService.js';\nimport { NotebookTextDiffEditor } from '../../notebook/browser/diff/notebookDiffEditor.js';\nimport { NotebookMultiTextDiffEditor } from '../../notebook/browser/diff/notebookMultiDiffEditor.js';\n\nexport class InlineChatNotebookContribution {\n\n\tprivate readonly _store = new DisposableStore();\n\n\tconstructor(\n\t\t@IInlineChatSessionService sessionService: IInlineChatSessionService,\n\t\t@IEditorService editorService: IEditorService,\n\t\t@INotebookEditorService notebookEditorService: INotebookEditorService,\n\t) {\n\n\t\tthis._store.add(sessionService.registerSessionKeyComputer(Schemas.vscodeNotebookCell, {\n\t\t\tgetComparisonKey: (editor, uri) => {\n\t\t\t\tconst data = CellUri.parse(uri);\n\t\t\t\tif (!data) {\n\t\t\t\t\tthrow illegalState('Expected notebook cell uri');\n\t\t\t\t}\n\t\t\t\tlet fallback: string | undefined;\n\t\t\t\tfor (const notebookEditor of notebookEditorService.listNotebookEditors()) {\n\t\t\t\t\tif (notebookEditor.hasModel() && isEqual(notebookEditor.textModel.uri, data.notebook)) {\n\n\t\t\t\t\t\tconst candidate = `<notebook>${notebookEditor.getId()}#${uri}`;\n\n\t\t\t\t\t\tif (!fallback) {\n\t\t\t\t\t\t\tfallback = candidate;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// find the code editor in the list of cell-code editors\n\t\t\t\t\t\tif (notebookEditor.codeEditors.find((tuple) => tuple[1] === editor)) {\n\t\t\t\t\t\t\treturn candidate;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// \t// reveal cell and try to find code editor again\n\t\t\t\t\t\t// \tconst cell = notebookEditor.getCellByHandle(data.handle);\n\t\t\t\t\t\t// \tif (cell) {\n\t\t\t\t\t\t// \t\tnotebookEditor.revealInViewAtTop(cell);\n\t\t\t\t\t\t// \t\tif (notebookEditor.codeEditors.find((tuple) => tuple[1] === editor)) {\n\t\t\t\t\t\t// \t\t\treturn candidate;\n\t\t\t\t\t\t// \t\t}\n\t\t\t\t\t\t// \t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (fallback) {\n\t\t\t\t\treturn fallback;\n\t\t\t\t}\n\n\t\t\t\tconst activeEditor = editorService.activeEditorPane;\n\t\t\t\tif (activeEditor && (activeEditor.getId() === NotebookTextDiffEditor.ID || activeEditor.getId() === NotebookMultiTextDiffEditor.ID)) {\n\t\t\t\t\treturn `<notebook>${editor.getId()}#${uri}`;\n\t\t\t\t}\n\n\t\t\t\tthrow illegalState('Expected notebook editor');\n\t\t\t}\n\t\t}));\n\n\t\tthis._store.add(sessionService.onWillStartSession(newSessionEditor => {\n\t\t\tconst candidate = CellUri.parse(newSessionEditor.getModel().uri);\n\t\t\tif (!candidate) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tfor (const notebookEditor of notebookEditorService.listNotebookEditors()) {\n\t\t\t\tif (isEqual(notebookEditor.textModel?.uri, candidate.notebook)) {\n\t\t\t\t\tlet found = false;\n\t\t\t\t\tconst editors: ICodeEditor[] = [];\n\t\t\t\t\tfor (const [, codeEditor] of notebookEditor.codeEditors) {\n\t\t\t\t\t\teditors.push(codeEditor);\n\t\t\t\t\t\tfound = codeEditor === newSessionEditor || found;\n\t\t\t\t\t}\n\t\t\t\t\tif (found) {\n\t\t\t\t\t\t// found the this editor in the outer notebook editor -> make sure to\n\t\t\t\t\t\t// cancel all sibling sessions\n\t\t\t\t\t\tfor (const editor of editors) {\n\t\t\t\t\t\t\tif (editor !== newSessionEditor) {\n\t\t\t\t\t\t\t\tInlineChatController.get(editor)?.acceptSession();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}));\n\t}\n\n\tdispose(): void {\n\t\tthis._store.dispose();\n\t}\n}\n"]}