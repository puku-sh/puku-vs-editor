{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/contrib/inlineChat/browser/inlineChatSessionService.ts","vs/workbench/contrib/inlineChat/browser/inlineChatSessionService.ts"],"names":[],"mappings":"AAAA;;;gGAGgG;AAChG,OAAO,EAAE,WAAW,EAAE,MAAM,kCAAkC,CAAC;AAE/D,OAAO,EAAE,KAAK,EAAE,MAAM,kCAAkC,CAAC;AAOzD,OAAO,EAAE,eAAe,EAAoB,MAAM,4DAA4D,CAAC;AAC/G,OAAO,EAAE,kBAAkB,EAAE,MAAM,4BAA4B,CAAC;AAGhE,OAAO,EAAE,YAAY,EAAE,MAAM,kCAAkC,CAAC;AAOhE,MAAM,CAAC,MAAM,yBAAyB,GAAG,eAAe,CAA4B,2BAA2B,CAAC,CAAC;AAiDjH,MAAM,CAAC,KAAK,UAAU,eAAe,CAAC,QAA0B,EAAE,KAA6B,EAAE,MAAe;IAE/G,MAAM,WAAW,GAAG,QAAQ,CAAC,GAAG,CAAC,YAAY,CAAC,CAAC;IAC/C,MAAM,aAAa,GAAG,QAAQ,CAAC,GAAG,CAAC,kBAAkB,CAAC,CAAC;IAEvD,MAAM,MAAM,GAAG,MAAM,aAAa,CAAC,YAAY,EAAE,CAAC;IAElD,IAAI,MAAM,IAAI,MAAM,CAAC,SAAS,IAAI,KAAK,EAAE,CAAC;QACzC,IAAI,WAA0C,CAAC;QAC/C,KAAK,MAAM,OAAO,IAAI,KAAK,CAAC,WAAW,EAAE,CAAC,KAAK,EAAE,EAAE,CAAC;YACnD,MAAM,WAAW,CAAC,YAAY,CAAC,MAAM,CAAC,SAAS,CAAC,KAAK,CAAC,eAAe,EAAE,OAAO,CAAC,CAAC;YAChF,WAAW,GAAG,OAAO,CAAC;QACvB,CAAC;QAED,IAAI,WAAW,IAAI,MAAM,EAAE,CAAC;YAC3B,WAAW,CAAC,aAAa,CAAC,WAAW,EAAE,EAAE,QAAQ,EAAE,MAAM,CAAC,QAAQ,EAAE,CAAC,CAAC;QACvE,CAAC;QAED,MAAM,CAAC,iBAAiB,EAAE,CAAC;IAC5B,CAAC;AACF,CAAC;AAED,MAAM,CAAC,KAAK,UAAU,cAAc,CAAC,QAA0B,EAAE,KAAwB;IAExF,MAAM,aAAa,GAAG,QAAQ,CAAC,GAAG,CAAC,kBAAkB,CAAC,CAAC;IAEvD,MAAM,MAAM,GAAG,MAAM,aAAa,CAAC,YAAY,EAAE,CAAC;IAElD,IAAI,CAAC,MAAM,EAAE,CAAC;QACb,OAAO;IACR,CAAC;IAED,IAAI,CAAC,MAAM,CAAC,SAAS,EAAE,CAAC;QACvB,MAAM,WAAW,CAAC,KAAK,CAAC,SAAS,CAAC,MAAM,CAAC,oBAAoB,CAAC,EAAE,IAAI,CAAC,CAAC;IACvE,CAAC;IAED,IAAI,KAAK,CAAC,eAAe,EAAE,CAAC;QAC3B,MAAM,CAAC,eAAe,CAAC,UAAU,CAAC,GAAG,KAAK,CAAC,eAAe,CAAC,CAAC;IAC7D,CAAC;IAED,MAAM,CAAC,WAAW,CAAC,KAAK,CAAC,OAAO,CAAC,IAAI,EAAE;QACtC,qBAAqB,EAAE,IAAI;QAC3B,YAAY,EAAE,KAAK;QACnB,kBAAkB,EAAE,IAAI;KACxB,CAAC,CAAC;AACJ,CAAC","file":"inlineChatSessionService.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nimport { raceTimeout } from '../../../../base/common/async.js';\nimport { CancellationToken } from '../../../../base/common/cancellation.js';\nimport { Event } from '../../../../base/common/event.js';\nimport { IDisposable } from '../../../../base/common/lifecycle.js';\nimport { URI } from '../../../../base/common/uri.js';\nimport { IActiveCodeEditor, ICodeEditor } from '../../../../editor/browser/editorBrowser.js';\nimport { Position } from '../../../../editor/common/core/position.js';\nimport { IRange } from '../../../../editor/common/core/range.js';\nimport { IValidEditOperation } from '../../../../editor/common/model.js';\nimport { createDecorator, ServicesAccessor } from '../../../../platform/instantiation/common/instantiation.js';\nimport { IChatWidgetService } from '../../chat/browser/chat.js';\nimport { IChatEditingSession } from '../../chat/common/chatEditingService.js';\nimport { IChatModel, IChatRequestModel } from '../../chat/common/chatModel.js';\nimport { IChatService } from '../../chat/common/chatService.js';\nimport { Session, StashedSession } from './inlineChatSession.js';\n\nexport interface ISessionKeyComputer {\n\tgetComparisonKey(editor: ICodeEditor, uri: URI): string;\n}\n\nexport const IInlineChatSessionService = createDecorator<IInlineChatSessionService>('IInlineChatSessionService');\n\nexport interface IInlineChatSessionEvent {\n\treadonly editor: ICodeEditor;\n\treadonly session: Session;\n}\n\nexport interface IInlineChatSessionEndEvent extends IInlineChatSessionEvent {\n\treadonly endedByExternalCause: boolean;\n}\n\nexport interface IInlineChatSession2 {\n\treadonly initialPosition: Position;\n\treadonly uri: URI;\n\treadonly chatModel: IChatModel;\n\treadonly editingSession: IChatEditingSession;\n\tdispose(): void;\n}\n\nexport interface IInlineChatSessionService {\n\t_serviceBrand: undefined;\n\n\treadonly onWillStartSession: Event<IActiveCodeEditor>;\n\treadonly onDidMoveSession: Event<IInlineChatSessionEvent>;\n\treadonly onDidStashSession: Event<IInlineChatSessionEvent>;\n\treadonly onDidEndSession: Event<IInlineChatSessionEndEvent>;\n\n\tcreateSession(editor: IActiveCodeEditor, options: { wholeRange?: IRange; session?: Session; headless?: boolean }, token: CancellationToken): Promise<Session | undefined>;\n\n\tmoveSession(session: Session, newEditor: ICodeEditor): void;\n\n\tgetCodeEditor(session: Session): ICodeEditor;\n\n\tgetSession(editor: ICodeEditor, uri: URI): Session | undefined;\n\n\treleaseSession(session: Session): void;\n\n\tstashSession(session: Session, editor: ICodeEditor, undoCancelEdits: IValidEditOperation[]): StashedSession;\n\n\tregisterSessionKeyComputer(scheme: string, value: ISessionKeyComputer): IDisposable;\n\n\tdispose(): void;\n\n\tcreateSession2(editor: ICodeEditor, uri: URI, token: CancellationToken): Promise<IInlineChatSession2>;\n\tgetSession2(uri: URI): IInlineChatSession2 | undefined;\n\tgetSession2(sessionId: string): IInlineChatSession2 | undefined;\n\treadonly onDidChangeSessions: Event<this>;\n}\n\nexport async function moveToPanelChat(accessor: ServicesAccessor, model: IChatModel | undefined, resend: boolean) {\n\n\tconst chatService = accessor.get(IChatService);\n\tconst widgetService = accessor.get(IChatWidgetService);\n\n\tconst widget = await widgetService.revealWidget();\n\n\tif (widget && widget.viewModel && model) {\n\t\tlet lastRequest: IChatRequestModel | undefined;\n\t\tfor (const request of model.getRequests().slice()) {\n\t\t\tawait chatService.adoptRequest(widget.viewModel.model.sessionResource, request);\n\t\t\tlastRequest = request;\n\t\t}\n\n\t\tif (lastRequest && resend) {\n\t\t\tchatService.resendRequest(lastRequest, { location: widget.location });\n\t\t}\n\n\t\twidget.focusResponseItem();\n\t}\n}\n\nexport async function askInPanelChat(accessor: ServicesAccessor, model: IChatRequestModel) {\n\n\tconst widgetService = accessor.get(IChatWidgetService);\n\n\tconst widget = await widgetService.revealWidget();\n\n\tif (!widget) {\n\t\treturn;\n\t}\n\n\tif (!widget.viewModel) {\n\t\tawait raceTimeout(Event.toPromise(widget.onDidChangeViewModel), 1000);\n\t}\n\n\tif (model.attachedContext) {\n\t\twidget.attachmentModel.addContext(...model.attachedContext);\n\t}\n\n\twidget.acceptInput(model.message.text, {\n\t\tenableImplicitContext: true,\n\t\tisVoiceInput: false,\n\t\tnoCommandDetection: true\n\t});\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nimport { raceTimeout } from '../../../../base/common/async.js';\nimport { CancellationToken } from '../../../../base/common/cancellation.js';\nimport { Event } from '../../../../base/common/event.js';\nimport { IDisposable } from '../../../../base/common/lifecycle.js';\nimport { URI } from '../../../../base/common/uri.js';\nimport { IActiveCodeEditor, ICodeEditor } from '../../../../editor/browser/editorBrowser.js';\nimport { Position } from '../../../../editor/common/core/position.js';\nimport { IRange } from '../../../../editor/common/core/range.js';\nimport { IValidEditOperation } from '../../../../editor/common/model.js';\nimport { createDecorator, ServicesAccessor } from '../../../../platform/instantiation/common/instantiation.js';\nimport { IChatWidgetService } from '../../chat/browser/chat.js';\nimport { IChatEditingSession } from '../../chat/common/chatEditingService.js';\nimport { IChatModel, IChatRequestModel } from '../../chat/common/chatModel.js';\nimport { IChatService } from '../../chat/common/chatService.js';\nimport { Session, StashedSession } from './inlineChatSession.js';\n\nexport interface ISessionKeyComputer {\n\tgetComparisonKey(editor: ICodeEditor, uri: URI): string;\n}\n\nexport const IInlineChatSessionService = createDecorator<IInlineChatSessionService>('IInlineChatSessionService');\n\nexport interface IInlineChatSessionEvent {\n\treadonly editor: ICodeEditor;\n\treadonly session: Session;\n}\n\nexport interface IInlineChatSessionEndEvent extends IInlineChatSessionEvent {\n\treadonly endedByExternalCause: boolean;\n}\n\nexport interface IInlineChatSession2 {\n\treadonly initialPosition: Position;\n\treadonly uri: URI;\n\treadonly chatModel: IChatModel;\n\treadonly editingSession: IChatEditingSession;\n\tdispose(): void;\n}\n\nexport interface IInlineChatSessionService {\n\t_serviceBrand: undefined;\n\n\treadonly onWillStartSession: Event<IActiveCodeEditor>;\n\treadonly onDidMoveSession: Event<IInlineChatSessionEvent>;\n\treadonly onDidStashSession: Event<IInlineChatSessionEvent>;\n\treadonly onDidEndSession: Event<IInlineChatSessionEndEvent>;\n\n\tcreateSession(editor: IActiveCodeEditor, options: { wholeRange?: IRange; session?: Session; headless?: boolean }, token: CancellationToken): Promise<Session | undefined>;\n\n\tmoveSession(session: Session, newEditor: ICodeEditor): void;\n\n\tgetCodeEditor(session: Session): ICodeEditor;\n\n\tgetSession(editor: ICodeEditor, uri: URI): Session | undefined;\n\n\treleaseSession(session: Session): void;\n\n\tstashSession(session: Session, editor: ICodeEditor, undoCancelEdits: IValidEditOperation[]): StashedSession;\n\n\tregisterSessionKeyComputer(scheme: string, value: ISessionKeyComputer): IDisposable;\n\n\tdispose(): void;\n\n\tcreateSession2(editor: ICodeEditor, uri: URI, token: CancellationToken): Promise<IInlineChatSession2>;\n\tgetSession2(uri: URI): IInlineChatSession2 | undefined;\n\tgetSession2(sessionId: string): IInlineChatSession2 | undefined;\n\treadonly onDidChangeSessions: Event<this>;\n}\n\nexport async function moveToPanelChat(accessor: ServicesAccessor, model: IChatModel | undefined, resend: boolean) {\n\n\tconst chatService = accessor.get(IChatService);\n\tconst widgetService = accessor.get(IChatWidgetService);\n\n\tconst widget = await widgetService.revealWidget();\n\n\tif (widget && widget.viewModel && model) {\n\t\tlet lastRequest: IChatRequestModel | undefined;\n\t\tfor (const request of model.getRequests().slice()) {\n\t\t\tawait chatService.adoptRequest(widget.viewModel.model.sessionResource, request);\n\t\t\tlastRequest = request;\n\t\t}\n\n\t\tif (lastRequest && resend) {\n\t\t\tchatService.resendRequest(lastRequest, { location: widget.location });\n\t\t}\n\n\t\twidget.focusResponseItem();\n\t}\n}\n\nexport async function askInPanelChat(accessor: ServicesAccessor, model: IChatRequestModel) {\n\n\tconst widgetService = accessor.get(IChatWidgetService);\n\n\tconst widget = await widgetService.revealWidget();\n\n\tif (!widget) {\n\t\treturn;\n\t}\n\n\tif (!widget.viewModel) {\n\t\tawait raceTimeout(Event.toPromise(widget.onDidChangeViewModel), 1000);\n\t}\n\n\tif (model.attachedContext) {\n\t\twidget.attachmentModel.addContext(...model.attachedContext);\n\t}\n\n\twidget.acceptInput(model.message.text, {\n\t\tenableImplicitContext: true,\n\t\tisVoiceInput: false,\n\t\tnoCommandDetection: true\n\t});\n}\n"]}