{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/contrib/inlineChat/test/browser/inlineChatSession.test.ts","vs/workbench/contrib/inlineChat/test/browser/inlineChatSession.test.ts"],"names":[],"mappings":"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","file":"inlineChatSession.test.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nimport assert from 'assert';\nimport { CancellationToken } from '../../../../../base/common/cancellation.js';\nimport { Event } from '../../../../../base/common/event.js';\nimport { DisposableStore } from '../../../../../base/common/lifecycle.js';\nimport { IObservable, constObservable } from '../../../../../base/common/observable.js';\nimport { assertType } from '../../../../../base/common/types.js';\nimport { mock } from '../../../../../base/test/common/mock.js';\nimport { assertSnapshot } from '../../../../../base/test/common/snapshot.js';\nimport { ensureNoDisposablesAreLeakedInTestSuite } from '../../../../../base/test/common/utils.js';\nimport { IActiveCodeEditor } from '../../../../../editor/browser/editorBrowser.js';\nimport { IDiffProviderFactoryService } from '../../../../../editor/browser/widget/diffEditor/diffProviderFactoryService.js';\nimport { EditOperation } from '../../../../../editor/common/core/editOperation.js';\nimport { Position } from '../../../../../editor/common/core/position.js';\nimport { Range } from '../../../../../editor/common/core/range.js';\nimport { ITextModel } from '../../../../../editor/common/model.js';\nimport { IEditorWorkerService } from '../../../../../editor/common/services/editorWorker.js';\nimport { IModelService } from '../../../../../editor/common/services/model.js';\nimport { TestDiffProviderFactoryService } from '../../../../../editor/test/browser/diff/testDiffProviderFactoryService.js';\nimport { TestCommandService } from '../../../../../editor/test/browser/editorTestServices.js';\nimport { instantiateTestCodeEditor } from '../../../../../editor/test/browser/testCodeEditor.js';\nimport { IAccessibleViewService } from '../../../../../platform/accessibility/browser/accessibleView.js';\nimport { ICommandService } from '../../../../../platform/commands/common/commands.js';\nimport { IConfigurationService } from '../../../../../platform/configuration/common/configuration.js';\nimport { TestConfigurationService } from '../../../../../platform/configuration/test/common/testConfigurationService.js';\nimport { IContextKeyService } from '../../../../../platform/contextkey/common/contextkey.js';\nimport { SyncDescriptor } from '../../../../../platform/instantiation/common/descriptors.js';\nimport { ServiceCollection } from '../../../../../platform/instantiation/common/serviceCollection.js';\nimport { TestInstantiationService } from '../../../../../platform/instantiation/test/common/instantiationServiceMock.js';\nimport { MockContextKeyService } from '../../../../../platform/keybinding/test/common/mockKeybindingService.js';\nimport { ILogService, NullLogService } from '../../../../../platform/log/common/log.js';\nimport { IEditorProgressService, IProgressRunner } from '../../../../../platform/progress/common/progress.js';\nimport { ITelemetryService } from '../../../../../platform/telemetry/common/telemetry.js';\nimport { NullTelemetryService } from '../../../../../platform/telemetry/common/telemetryUtils.js';\nimport { IWorkspaceContextService } from '../../../../../platform/workspace/common/workspace.js';\nimport { IViewDescriptorService } from '../../../../common/views.js';\nimport { IWorkbenchAssignmentService } from '../../../../services/assignment/common/assignmentService.js';\nimport { NullWorkbenchAssignmentService } from '../../../../services/assignment/test/common/nullAssignmentService.js';\nimport { IExtensionService, nullExtensionDescription } from '../../../../services/extensions/common/extensions.js';\nimport { IViewsService } from '../../../../services/views/common/viewsService.js';\nimport { workbenchInstantiationService } from '../../../../test/browser/workbenchTestServices.js';\nimport { TestContextService, TestExtensionService } from '../../../../test/common/workbenchTestServices.js';\nimport { AccessibilityVerbositySettingId } from '../../../accessibility/browser/accessibilityConfiguration.js';\nimport { IChatAccessibilityService, IChatWidgetService, IQuickChatService } from '../../../chat/browser/chat.js';\nimport { ChatSessionsService } from '../../../chat/browser/chatSessions.contribution.js';\nimport { ChatVariablesService } from '../../../chat/browser/chatVariables.js';\nimport { ChatWidget } from '../../../chat/browser/chatWidget.js';\nimport { ChatAgentService, IChatAgentService } from '../../../chat/common/chatAgents.js';\nimport { IChatEditingService, IChatEditingSession } from '../../../chat/common/chatEditingService.js';\nimport { IChatRequestModel } from '../../../chat/common/chatModel.js';\nimport { IChatService } from '../../../chat/common/chatService.js';\nimport { ChatService } from '../../../chat/common/chatServiceImpl.js';\nimport { IChatSessionsService } from '../../../chat/common/chatSessionsService.js';\nimport { ChatSlashCommandService, IChatSlashCommandService } from '../../../chat/common/chatSlashCommands.js';\nimport { ChatTransferService, IChatTransferService } from '../../../chat/common/chatTransferService.js';\nimport { IChatVariablesService } from '../../../chat/common/chatVariables.js';\nimport { IChatResponseViewModel } from '../../../chat/common/chatViewModel.js';\nimport { ChatWidgetHistoryService, IChatWidgetHistoryService } from '../../../chat/common/chatWidgetHistoryService.js';\nimport { ChatAgentLocation, ChatModeKind } from '../../../chat/common/constants.js';\nimport { ILanguageModelsService } from '../../../chat/common/languageModels.js';\nimport { ILanguageModelToolsService } from '../../../chat/common/languageModelToolsService.js';\nimport { NullLanguageModelsService } from '../../../chat/test/common/languageModels.js';\nimport { MockLanguageModelToolsService } from '../../../chat/test/common/mockLanguageModelToolsService.js';\nimport { IMcpService } from '../../../mcp/common/mcpTypes.js';\nimport { TestMcpService } from '../../../mcp/test/common/testMcpService.js';\nimport { HunkState } from '../../browser/inlineChatSession.js';\nimport { IInlineChatSessionService } from '../../browser/inlineChatSessionService.js';\nimport { InlineChatSessionServiceImpl } from '../../browser/inlineChatSessionServiceImpl.js';\nimport { TestWorkerService } from './testWorkerService.js';\nimport { ChatWidgetService } from '../../../chat/browser/chatWidgetService.js';\n\nsuite('InlineChatSession', function () {\n\n\tconst store = new DisposableStore();\n\tlet editor: IActiveCodeEditor;\n\tlet model: ITextModel;\n\tlet instaService: TestInstantiationService;\n\n\tlet inlineChatSessionService: IInlineChatSessionService;\n\n\tsetup(function () {\n\t\tconst contextKeyService = new MockContextKeyService();\n\n\n\t\tconst serviceCollection = new ServiceCollection(\n\t\t\t[IConfigurationService, new TestConfigurationService()],\n\t\t\t[IChatVariablesService, new SyncDescriptor(ChatVariablesService)],\n\t\t\t[ILogService, new NullLogService()],\n\t\t\t[ITelemetryService, NullTelemetryService],\n\t\t\t[IExtensionService, new TestExtensionService()],\n\t\t\t[IContextKeyService, new MockContextKeyService()],\n\t\t\t[IViewsService, new TestExtensionService()],\n\t\t\t[IWorkspaceContextService, new TestContextService()],\n\t\t\t[IChatWidgetHistoryService, new SyncDescriptor(ChatWidgetHistoryService)],\n\t\t\t[IChatWidgetService, new SyncDescriptor(ChatWidgetService)],\n\t\t\t[IChatSlashCommandService, new SyncDescriptor(ChatSlashCommandService)],\n\t\t\t[IChatTransferService, new SyncDescriptor(ChatTransferService)],\n\t\t\t[IChatSessionsService, new SyncDescriptor(ChatSessionsService)],\n\t\t\t[IChatService, new SyncDescriptor(ChatService)],\n\t\t\t[IEditorWorkerService, new SyncDescriptor(TestWorkerService)],\n\t\t\t[IChatAgentService, new SyncDescriptor(ChatAgentService)],\n\t\t\t[IContextKeyService, contextKeyService],\n\t\t\t[IDiffProviderFactoryService, new SyncDescriptor(TestDiffProviderFactoryService)],\n\t\t\t[ILanguageModelsService, new SyncDescriptor(NullLanguageModelsService)],\n\t\t\t[IInlineChatSessionService, new SyncDescriptor(InlineChatSessionServiceImpl)],\n\t\t\t[ICommandService, new SyncDescriptor(TestCommandService)],\n\t\t\t[ILanguageModelToolsService, new MockLanguageModelToolsService()],\n\t\t\t[IMcpService, new TestMcpService()],\n\t\t\t[IEditorProgressService, new class extends mock<IEditorProgressService>() {\n\t\t\t\toverride show(total: unknown, delay?: unknown): IProgressRunner {\n\t\t\t\t\treturn {\n\t\t\t\t\t\ttotal() { },\n\t\t\t\t\t\tworked(value) { },\n\t\t\t\t\t\tdone() { },\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t}],\n\t\t\t[IChatEditingService, new class extends mock<IChatEditingService>() {\n\t\t\t\toverride editingSessionsObs: IObservable<readonly IChatEditingSession[]> = constObservable([]);\n\t\t\t}],\n\t\t\t[IChatAccessibilityService, new class extends mock<IChatAccessibilityService>() {\n\t\t\t\toverride acceptResponse(chatWidget: ChatWidget, container: HTMLElement, response: IChatResponseViewModel | undefined, requestId: number): void { }\n\t\t\t\toverride acceptRequest(): number { return -1; }\n\t\t\t\toverride acceptElicitation(): void { }\n\t\t\t}],\n\t\t\t[IAccessibleViewService, new class extends mock<IAccessibleViewService>() {\n\t\t\t\toverride getOpenAriaHint(verbositySettingKey: AccessibilityVerbositySettingId): string | null {\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\t\t\t}],\n\t\t\t[IQuickChatService, new class extends mock<IQuickChatService>() { }],\n\t\t\t[IConfigurationService, new TestConfigurationService()],\n\t\t\t[IViewDescriptorService, new class extends mock<IViewDescriptorService>() {\n\t\t\t\toverride onDidChangeLocation = Event.None;\n\t\t\t}],\n\t\t\t[IWorkbenchAssignmentService, new NullWorkbenchAssignmentService()]\n\t\t);\n\n\n\n\t\tinstaService = store.add(workbenchInstantiationService(undefined, store).createChild(serviceCollection));\n\t\tinlineChatSessionService = store.add(instaService.get(IInlineChatSessionService));\n\t\tstore.add(instaService.get(IChatSessionsService) as ChatSessionsService);  // Needs to be disposed in between test runs to clear extensionPoint contribution\n\n\t\tinstaService.get(IChatAgentService).registerDynamicAgent({\n\t\t\textensionId: nullExtensionDescription.identifier,\n\t\t\textensionVersion: undefined,\n\t\t\tpublisherDisplayName: '',\n\t\t\textensionDisplayName: '',\n\t\t\textensionPublisherId: '',\n\t\t\tid: 'testAgent',\n\t\t\tname: 'testAgent',\n\t\t\tisDefault: true,\n\t\t\tlocations: [ChatAgentLocation.EditorInline],\n\t\t\tmodes: [ChatModeKind.Ask],\n\t\t\tmetadata: {},\n\t\t\tslashCommands: [],\n\t\t\tdisambiguation: [],\n\t\t}, {\n\t\t\tasync invoke() {\n\t\t\t\treturn {};\n\t\t\t}\n\t\t});\n\n\n\t\tstore.add(instaService.get(IEditorWorkerService) as TestWorkerService);\n\t\tmodel = store.add(instaService.get(IModelService).createModel('one\\ntwo\\nthree\\nfour\\nfive\\nsix\\nseven\\neight\\nnine\\nten\\neleven', null));\n\t\teditor = store.add(instantiateTestCodeEditor(instaService, model));\n\t});\n\n\tteardown(function () {\n\t\tstore.clear();\n\t});\n\n\tensureNoDisposablesAreLeakedInTestSuite();\n\n\tasync function makeEditAsAi(edit: EditOperation | EditOperation[]) {\n\t\tconst session = inlineChatSessionService.getSession(editor, editor.getModel()!.uri);\n\t\tassertType(session);\n\t\tsession.hunkData.ignoreTextModelNChanges = true;\n\t\ttry {\n\t\t\teditor.executeEdits('test', Array.isArray(edit) ? edit : [edit]);\n\t\t} finally {\n\t\t\tsession.hunkData.ignoreTextModelNChanges = false;\n\t\t}\n\t\tawait session.hunkData.recompute({ applied: 0, sha1: 'fakeSha1' });\n\t}\n\n\tfunction makeEdit(edit: EditOperation | EditOperation[]) {\n\t\teditor.executeEdits('test', Array.isArray(edit) ? edit : [edit]);\n\t}\n\n\ttest('Create, release', async function () {\n\n\t\tconst session = await inlineChatSessionService.createSession(editor, {}, CancellationToken.None);\n\t\tassertType(session);\n\t\tinlineChatSessionService.releaseSession(session);\n\t});\n\n\ttest('HunkData, info', async function () {\n\n\t\tconst decorationCountThen = model.getAllDecorations().length;\n\n\t\tconst session = await inlineChatSessionService.createSession(editor, {}, CancellationToken.None);\n\t\tassertType(session);\n\t\tassert.ok(session.textModelN === model);\n\n\t\tawait makeEditAsAi(EditOperation.insert(new Position(1, 1), 'AI_EDIT\\n'));\n\n\n\t\tassert.strictEqual(session.hunkData.size, 1);\n\t\tlet [hunk] = session.hunkData.getInfo();\n\t\tassertType(hunk);\n\n\t\tassert.ok(!session.textModel0.equalsTextBuffer(session.textModelN.getTextBuffer()));\n\t\tassert.strictEqual(hunk.getState(), HunkState.Pending);\n\t\tassert.ok(hunk.getRangesN()[0].equalsRange({ startLineNumber: 1, startColumn: 1, endLineNumber: 1, endColumn: 8 }));\n\n\t\tawait makeEditAsAi(EditOperation.insert(new Position(1, 3), 'foobar'));\n\t\t[hunk] = session.hunkData.getInfo();\n\t\tassert.ok(hunk.getRangesN()[0].equalsRange({ startLineNumber: 1, startColumn: 1, endLineNumber: 1, endColumn: 14 }));\n\n\t\tinlineChatSessionService.releaseSession(session);\n\n\t\tassert.strictEqual(model.getAllDecorations().length, decorationCountThen); // no leaked decorations!\n\t});\n\n\ttest('HunkData, accept', async function () {\n\n\t\tconst session = await inlineChatSessionService.createSession(editor, {}, CancellationToken.None);\n\t\tassertType(session);\n\n\t\tawait makeEditAsAi([EditOperation.insert(new Position(1, 1), 'AI_EDIT\\n'), EditOperation.insert(new Position(10, 1), 'AI_EDIT\\n')]);\n\n\t\tassert.strictEqual(session.hunkData.size, 2);\n\t\tassert.ok(!session.textModel0.equalsTextBuffer(session.textModelN.getTextBuffer()));\n\n\t\tfor (const hunk of session.hunkData.getInfo()) {\n\t\t\tassertType(hunk);\n\t\t\tassert.strictEqual(hunk.getState(), HunkState.Pending);\n\t\t\thunk.acceptChanges();\n\t\t\tassert.strictEqual(hunk.getState(), HunkState.Accepted);\n\t\t}\n\n\t\tassert.strictEqual(session.textModel0.getValue(), session.textModelN.getValue());\n\t\tinlineChatSessionService.releaseSession(session);\n\t});\n\n\ttest('HunkData, reject', async function () {\n\n\t\tconst session = await inlineChatSessionService.createSession(editor, {}, CancellationToken.None);\n\t\tassertType(session);\n\n\t\tawait makeEditAsAi([EditOperation.insert(new Position(1, 1), 'AI_EDIT\\n'), EditOperation.insert(new Position(10, 1), 'AI_EDIT\\n')]);\n\n\t\tassert.strictEqual(session.hunkData.size, 2);\n\t\tassert.ok(!session.textModel0.equalsTextBuffer(session.textModelN.getTextBuffer()));\n\n\t\tfor (const hunk of session.hunkData.getInfo()) {\n\t\t\tassertType(hunk);\n\t\t\tassert.strictEqual(hunk.getState(), HunkState.Pending);\n\t\t\thunk.discardChanges();\n\t\t\tassert.strictEqual(hunk.getState(), HunkState.Rejected);\n\t\t}\n\n\t\tassert.strictEqual(session.textModel0.getValue(), session.textModelN.getValue());\n\t\tinlineChatSessionService.releaseSession(session);\n\t});\n\n\ttest('HunkData, N rounds', async function () {\n\n\t\tmodel.setValue('one\\ntwo\\nthree\\nfour\\nfive\\nsix\\nseven\\neight\\nnine\\nten\\neleven\\ntwelwe\\nthirteen\\nfourteen\\nfifteen\\nsixteen\\nseventeen\\neighteen\\nnineteen\\n');\n\n\t\tconst session = await inlineChatSessionService.createSession(editor, {}, CancellationToken.None);\n\t\tassertType(session);\n\n\t\tassert.ok(session.textModel0.equalsTextBuffer(session.textModelN.getTextBuffer()));\n\n\t\tassert.strictEqual(session.hunkData.size, 0);\n\n\t\t// ROUND #1\n\t\tawait makeEditAsAi([\n\t\t\tEditOperation.insert(new Position(1, 1), 'AI1'),\n\t\t\tEditOperation.insert(new Position(4, 1), 'AI2'),\n\t\t\tEditOperation.insert(new Position(19, 1), 'AI3')\n\t\t]);\n\n\t\tassert.strictEqual(session.hunkData.size, 2); // AI1, AI2 are merged into one hunk, AI3 is a separate hunk\n\n\t\tlet [first, second] = session.hunkData.getInfo();\n\n\t\tassert.ok(model.getValueInRange(first.getRangesN()[0]).includes('AI1'));\n\t\tassert.ok(model.getValueInRange(first.getRangesN()[0]).includes('AI2'));\n\t\tassert.ok(model.getValueInRange(second.getRangesN()[0]).includes('AI3'));\n\n\t\tassert.ok(!session.textModel0.getValueInRange(first.getRangesN()[0]).includes('AI1'));\n\t\tassert.ok(!session.textModel0.getValueInRange(first.getRangesN()[0]).includes('AI2'));\n\t\tassert.ok(!session.textModel0.getValueInRange(second.getRangesN()[0]).includes('AI3'));\n\n\t\tfirst.acceptChanges();\n\t\tassert.ok(session.textModel0.getValueInRange(first.getRangesN()[0]).includes('AI1'));\n\t\tassert.ok(session.textModel0.getValueInRange(first.getRangesN()[0]).includes('AI2'));\n\t\tassert.ok(!session.textModel0.getValueInRange(second.getRangesN()[0]).includes('AI3'));\n\n\n\t\t// ROUND #2\n\t\tawait makeEditAsAi([\n\t\t\tEditOperation.insert(new Position(7, 1), 'AI4'),\n\t\t]);\n\t\tassert.strictEqual(session.hunkData.size, 2);\n\n\t\t[first, second] = session.hunkData.getInfo();\n\t\tassert.ok(model.getValueInRange(first.getRangesN()[0]).includes('AI4')); // the new hunk (in line-order)\n\t\tassert.ok(model.getValueInRange(second.getRangesN()[0]).includes('AI3')); // the previous hunk remains\n\n\t\tinlineChatSessionService.releaseSession(session);\n\t});\n\n\ttest('HunkData, (mirror) edit before', async function () {\n\n\t\tconst lines = ['one', 'two', 'three'];\n\t\tmodel.setValue(lines.join('\\n'));\n\t\tconst session = await inlineChatSessionService.createSession(editor, {}, CancellationToken.None);\n\t\tassertType(session);\n\n\t\tawait makeEditAsAi([EditOperation.insert(new Position(3, 1), 'AI WAS HERE\\n')]);\n\t\tassert.strictEqual(session.textModelN.getValue(), ['one', 'two', 'AI WAS HERE', 'three'].join('\\n'));\n\t\tassert.strictEqual(session.textModel0.getValue(), lines.join('\\n'));\n\n\t\tmakeEdit([EditOperation.replace(new Range(1, 1, 1, 4), 'ONE')]);\n\t\tassert.strictEqual(session.textModelN.getValue(), ['ONE', 'two', 'AI WAS HERE', 'three'].join('\\n'));\n\t\tassert.strictEqual(session.textModel0.getValue(), ['ONE', 'two', 'three'].join('\\n'));\n\t});\n\n\ttest('HunkData, (mirror) edit after', async function () {\n\n\t\tconst lines = ['one', 'two', 'three', 'four', 'five'];\n\t\tmodel.setValue(lines.join('\\n'));\n\n\t\tconst session = await inlineChatSessionService.createSession(editor, {}, CancellationToken.None);\n\t\tassertType(session);\n\n\t\tawait makeEditAsAi([EditOperation.insert(new Position(3, 1), 'AI_EDIT\\n')]);\n\n\t\tassert.strictEqual(session.hunkData.size, 1);\n\t\tconst [hunk] = session.hunkData.getInfo();\n\n\t\tmakeEdit([EditOperation.insert(new Position(1, 1), 'USER1')]);\n\t\tassert.strictEqual(session.textModelN.getValue(), ['USER1one', 'two', 'AI_EDIT', 'three', 'four', 'five'].join('\\n'));\n\t\tassert.strictEqual(session.textModel0.getValue(), ['USER1one', 'two', 'three', 'four', 'five'].join('\\n'));\n\n\t\tmakeEdit([EditOperation.insert(new Position(5, 1), 'USER2')]);\n\t\tassert.strictEqual(session.textModelN.getValue(), ['USER1one', 'two', 'AI_EDIT', 'three', 'USER2four', 'five'].join('\\n'));\n\t\tassert.strictEqual(session.textModel0.getValue(), ['USER1one', 'two', 'three', 'USER2four', 'five'].join('\\n'));\n\n\t\thunk.acceptChanges();\n\t\tassert.strictEqual(session.textModelN.getValue(), ['USER1one', 'two', 'AI_EDIT', 'three', 'USER2four', 'five'].join('\\n'));\n\t\tassert.strictEqual(session.textModel0.getValue(), ['USER1one', 'two', 'AI_EDIT', 'three', 'USER2four', 'five'].join('\\n'));\n\t});\n\n\ttest('HunkData, (mirror) edit inside ', async function () {\n\n\t\tconst lines = ['one', 'two', 'three'];\n\t\tmodel.setValue(lines.join('\\n'));\n\t\tconst session = await inlineChatSessionService.createSession(editor, {}, CancellationToken.None);\n\t\tassertType(session);\n\n\t\tawait makeEditAsAi([EditOperation.insert(new Position(3, 1), 'AI WAS HERE\\n')]);\n\t\tassert.strictEqual(session.textModelN.getValue(), ['one', 'two', 'AI WAS HERE', 'three'].join('\\n'));\n\t\tassert.strictEqual(session.textModel0.getValue(), lines.join('\\n'));\n\n\t\tmakeEdit([EditOperation.replace(new Range(3, 4, 3, 7), 'wwaaassss')]);\n\t\tassert.strictEqual(session.textModelN.getValue(), ['one', 'two', 'AI wwaaassss HERE', 'three'].join('\\n'));\n\t\tassert.strictEqual(session.textModel0.getValue(), ['one', 'two', 'three'].join('\\n'));\n\t});\n\n\ttest('HunkData, (mirror) edit after dicard ', async function () {\n\n\t\tconst lines = ['one', 'two', 'three'];\n\t\tmodel.setValue(lines.join('\\n'));\n\t\tconst session = await inlineChatSessionService.createSession(editor, {}, CancellationToken.None);\n\t\tassertType(session);\n\n\t\tawait makeEditAsAi([EditOperation.insert(new Position(3, 1), 'AI WAS HERE\\n')]);\n\t\tassert.strictEqual(session.textModelN.getValue(), ['one', 'two', 'AI WAS HERE', 'three'].join('\\n'));\n\t\tassert.strictEqual(session.textModel0.getValue(), lines.join('\\n'));\n\n\t\tassert.strictEqual(session.hunkData.size, 1);\n\t\tconst [hunk] = session.hunkData.getInfo();\n\t\thunk.discardChanges();\n\t\tassert.strictEqual(session.textModelN.getValue(), lines.join('\\n'));\n\t\tassert.strictEqual(session.textModel0.getValue(), lines.join('\\n'));\n\n\t\tmakeEdit([EditOperation.replace(new Range(3, 4, 3, 6), '3333')]);\n\t\tassert.strictEqual(session.textModelN.getValue(), ['one', 'two', 'thr3333'].join('\\n'));\n\t\tassert.strictEqual(session.textModel0.getValue(), ['one', 'two', 'thr3333'].join('\\n'));\n\t});\n\n\ttest('HunkData, (mirror) edit after, multi turn', async function () {\n\n\t\tconst lines = ['one', 'two', 'three', 'four', 'five'];\n\t\tmodel.setValue(lines.join('\\n'));\n\n\t\tconst session = await inlineChatSessionService.createSession(editor, {}, CancellationToken.None);\n\t\tassertType(session);\n\n\t\tawait makeEditAsAi([EditOperation.insert(new Position(3, 1), 'AI_EDIT\\n')]);\n\n\t\tassert.strictEqual(session.hunkData.size, 1);\n\n\t\tmakeEdit([EditOperation.insert(new Position(5, 1), 'FOO')]);\n\t\tassert.strictEqual(session.textModelN.getValue(), ['one', 'two', 'AI_EDIT', 'three', 'FOOfour', 'five'].join('\\n'));\n\t\tassert.strictEqual(session.textModel0.getValue(), ['one', 'two', 'three', 'FOOfour', 'five'].join('\\n'));\n\n\t\tawait makeEditAsAi([EditOperation.insert(new Position(2, 4), ' zwei')]);\n\t\tassert.strictEqual(session.hunkData.size, 1);\n\n\t\tassert.strictEqual(session.textModelN.getValue(), ['one', 'two zwei', 'AI_EDIT', 'three', 'FOOfour', 'five'].join('\\n'));\n\t\tassert.strictEqual(session.textModel0.getValue(), ['one', 'two', 'three', 'FOOfour', 'five'].join('\\n'));\n\n\t\tmakeEdit([EditOperation.replace(new Range(6, 3, 6, 5), 'vefivefi')]);\n\t\tassert.strictEqual(session.textModelN.getValue(), ['one', 'two zwei', 'AI_EDIT', 'three', 'FOOfour', 'fivefivefi'].join('\\n'));\n\t\tassert.strictEqual(session.textModel0.getValue(), ['one', 'two', 'three', 'FOOfour', 'fivefivefi'].join('\\n'));\n\t});\n\n\ttest('HunkData, (mirror) edit after, multi turn 2', async function () {\n\n\t\tconst lines = ['one', 'two', 'three', 'four', 'five'];\n\t\tmodel.setValue(lines.join('\\n'));\n\n\t\tconst session = await inlineChatSessionService.createSession(editor, {}, CancellationToken.None);\n\t\tassertType(session);\n\n\t\tawait makeEditAsAi([EditOperation.insert(new Position(3, 1), 'AI_EDIT\\n')]);\n\n\t\tassert.strictEqual(session.hunkData.size, 1);\n\n\t\tmakeEdit([EditOperation.insert(new Position(5, 1), 'FOO')]);\n\t\tassert.strictEqual(session.textModelN.getValue(), ['one', 'two', 'AI_EDIT', 'three', 'FOOfour', 'five'].join('\\n'));\n\t\tassert.strictEqual(session.textModel0.getValue(), ['one', 'two', 'three', 'FOOfour', 'five'].join('\\n'));\n\n\t\tawait makeEditAsAi([EditOperation.insert(new Position(2, 4), 'zwei')]);\n\t\tassert.strictEqual(session.hunkData.size, 1);\n\n\t\tassert.strictEqual(session.textModelN.getValue(), ['one', 'twozwei', 'AI_EDIT', 'three', 'FOOfour', 'five'].join('\\n'));\n\t\tassert.strictEqual(session.textModel0.getValue(), ['one', 'two', 'three', 'FOOfour', 'five'].join('\\n'));\n\n\t\tmakeEdit([EditOperation.replace(new Range(6, 3, 6, 5), 'vefivefi')]);\n\t\tassert.strictEqual(session.textModelN.getValue(), ['one', 'twozwei', 'AI_EDIT', 'three', 'FOOfour', 'fivefivefi'].join('\\n'));\n\t\tassert.strictEqual(session.textModel0.getValue(), ['one', 'two', 'three', 'FOOfour', 'fivefivefi'].join('\\n'));\n\n\t\tsession.hunkData.getInfo()[0].acceptChanges();\n\t\tassert.strictEqual(session.textModelN.getValue(), session.textModel0.getValue());\n\n\t\tmakeEdit([EditOperation.replace(new Range(1, 1, 1, 1), 'done')]);\n\t\tassert.strictEqual(session.textModelN.getValue(), session.textModel0.getValue());\n\t});\n\n\ttest('HunkData, accept, discardAll', async function () {\n\n\t\tconst session = await inlineChatSessionService.createSession(editor, {}, CancellationToken.None);\n\t\tassertType(session);\n\n\t\tawait makeEditAsAi([EditOperation.insert(new Position(1, 1), 'AI_EDIT\\n'), EditOperation.insert(new Position(10, 1), 'AI_EDIT\\n')]);\n\n\t\tassert.strictEqual(session.hunkData.size, 2);\n\t\tassert.ok(!session.textModel0.equalsTextBuffer(session.textModelN.getTextBuffer()));\n\n\t\tconst textModeNNow = session.textModelN.getValue();\n\n\t\tsession.hunkData.getInfo()[0].acceptChanges();\n\t\tassert.strictEqual(textModeNNow, session.textModelN.getValue());\n\n\t\tsession.hunkData.discardAll(); // all remaining\n\t\tassert.strictEqual(session.textModelN.getValue(), 'AI_EDIT\\none\\ntwo\\nthree\\nfour\\nfive\\nsix\\nseven\\neight\\nnine\\nten\\neleven');\n\t\tassert.strictEqual(session.textModelN.getValue(), session.textModel0.getValue());\n\n\t\tinlineChatSessionService.releaseSession(session);\n\t});\n\n\ttest('HunkData, discardAll return undo edits', async function () {\n\n\t\tconst session = await inlineChatSessionService.createSession(editor, {}, CancellationToken.None);\n\t\tassertType(session);\n\n\t\tawait makeEditAsAi([EditOperation.insert(new Position(1, 1), 'AI_EDIT\\n'), EditOperation.insert(new Position(10, 1), 'AI_EDIT\\n')]);\n\n\t\tassert.strictEqual(session.hunkData.size, 2);\n\t\tassert.ok(!session.textModel0.equalsTextBuffer(session.textModelN.getTextBuffer()));\n\n\t\tconst textModeNNow = session.textModelN.getValue();\n\n\t\tsession.hunkData.getInfo()[0].acceptChanges();\n\t\tassert.strictEqual(textModeNNow, session.textModelN.getValue());\n\n\t\tconst undoEdits = session.hunkData.discardAll(); // all remaining\n\t\tassert.strictEqual(session.textModelN.getValue(), 'AI_EDIT\\none\\ntwo\\nthree\\nfour\\nfive\\nsix\\nseven\\neight\\nnine\\nten\\neleven');\n\t\tassert.strictEqual(session.textModelN.getValue(), session.textModel0.getValue());\n\n\t\t// undo the discards\n\t\tsession.textModelN.pushEditOperations(null, undoEdits, () => null);\n\t\tassert.strictEqual(textModeNNow, session.textModelN.getValue());\n\n\t\tinlineChatSessionService.releaseSession(session);\n\t});\n\n\ttest('Pressing Escape after inline chat errored with \"response filtered\" leaves document dirty #7764', async function () {\n\n\t\tconst origValue = `class Foo {\n\tprivate onError(error: string): void {\n\t\tif (/The request timed out|The network connection was lost/i.test(error)) {\n\t\t\treturn;\n\t\t}\n\n\t\terror = error.replace(/See https:\\/\\/github\\.com\\/Squirrel\\/Squirrel\\.Mac\\/issues\\/182 for more information/, 'This might mean the application was put on quarantine by macOS. See [this link](https://github.com/microsoft/vscode/issues/7426#issuecomment-425093469) for more information');\n\n\t\tthis.notificationService.notify({\n\t\t\tseverity: Severity.Error,\n\t\t\tmessage: error,\n\t\t\tsource: nls.localize('update service', \"Update Service\"),\n\t\t});\n\t}\n}`;\n\t\tmodel.setValue(origValue);\n\n\t\tconst session = await inlineChatSessionService.createSession(editor, {}, CancellationToken.None);\n\t\tassertType(session);\n\n\t\tconst fakeRequest = new class extends mock<IChatRequestModel>() {\n\t\t\toverride get id() { return 'one'; }\n\t\t};\n\t\tsession.markModelVersion(fakeRequest);\n\n\t\tassert.strictEqual(editor.getModel().getLineCount(), 15);\n\n\t\tawait makeEditAsAi([EditOperation.replace(new Range(7, 1, 7, Number.MAX_SAFE_INTEGER), `error = error.replace(\n\t\t\t/See https:\\/\\/github\\.com\\/Squirrel\\/Squirrel\\.Mac\\/issues\\/182 for more information/,\n\t\t\t'This might mean the application was put on quarantine by macOS. See [this link](https://github.com/microsoft/vscode/issues/7426#issuecomment-425093469) for more information'\n\t\t);`)]);\n\n\t\tassert.strictEqual(editor.getModel().getLineCount(), 18);\n\n\t\t// called when a response errors out\n\t\tawait session.undoChangesUntil(fakeRequest.id);\n\t\tawait session.hunkData.recompute({ applied: 0, sha1: 'fakeSha1' }, undefined);\n\n\t\tassert.strictEqual(editor.getModel().getValue(), origValue);\n\n\t\tsession.hunkData.discardAll(); // called when dimissing the session\n\t\tassert.strictEqual(editor.getModel().getValue(), origValue);\n\t});\n\n\ttest('Apply Code\\'s preview should be easier to undo/esc #7537', async function () {\n\t\tmodel.setValue(`export function fib(n) {\n\tif (n <= 0) return 0;\n\tif (n === 1) return 0;\n\tif (n === 2) return 1;\n\treturn fib(n - 1) + fib(n - 2);\n}`);\n\t\tconst session = await inlineChatSessionService.createSession(editor, {}, CancellationToken.None);\n\t\tassertType(session);\n\n\t\tawait makeEditAsAi([EditOperation.replace(new Range(5, 1, 6, Number.MAX_SAFE_INTEGER), `\n\tlet a = 0, b = 1, c;\n\tfor (let i = 3; i <= n; i++) {\n\t\tc = a + b;\n\t\ta = b;\n\t\tb = c;\n\t}\n\treturn b;\n}`)]);\n\n\t\tassert.strictEqual(session.hunkData.size, 1);\n\t\tassert.strictEqual(session.hunkData.pending, 1);\n\t\tassert.ok(session.hunkData.getInfo().every(d => d.getState() === HunkState.Pending));\n\n\t\tawait assertSnapshot(editor.getModel().getValue(), { name: '1' });\n\n\t\tawait model.undo();\n\t\tawait assertSnapshot(editor.getModel().getValue(), { name: '2' });\n\n\t\t// overlapping edits (even UNDO) mark edits as accepted\n\t\tassert.strictEqual(session.hunkData.size, 1);\n\t\tassert.strictEqual(session.hunkData.pending, 0);\n\t\tassert.ok(session.hunkData.getInfo().every(d => d.getState() === HunkState.Accepted));\n\n\t\t// no further change when discarding\n\t\tsession.hunkData.discardAll(); // CANCEL\n\t\tawait assertSnapshot(editor.getModel().getValue(), { name: '2' });\n\t});\n\n});\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nimport assert from 'assert';\nimport { CancellationToken } from '../../../../../base/common/cancellation.js';\nimport { Event } from '../../../../../base/common/event.js';\nimport { DisposableStore } from '../../../../../base/common/lifecycle.js';\nimport { IObservable, constObservable } from '../../../../../base/common/observable.js';\nimport { assertType } from '../../../../../base/common/types.js';\nimport { mock } from '../../../../../base/test/common/mock.js';\nimport { assertSnapshot } from '../../../../../base/test/common/snapshot.js';\nimport { ensureNoDisposablesAreLeakedInTestSuite } from '../../../../../base/test/common/utils.js';\nimport { IActiveCodeEditor } from '../../../../../editor/browser/editorBrowser.js';\nimport { IDiffProviderFactoryService } from '../../../../../editor/browser/widget/diffEditor/diffProviderFactoryService.js';\nimport { EditOperation } from '../../../../../editor/common/core/editOperation.js';\nimport { Position } from '../../../../../editor/common/core/position.js';\nimport { Range } from '../../../../../editor/common/core/range.js';\nimport { ITextModel } from '../../../../../editor/common/model.js';\nimport { IEditorWorkerService } from '../../../../../editor/common/services/editorWorker.js';\nimport { IModelService } from '../../../../../editor/common/services/model.js';\nimport { TestDiffProviderFactoryService } from '../../../../../editor/test/browser/diff/testDiffProviderFactoryService.js';\nimport { TestCommandService } from '../../../../../editor/test/browser/editorTestServices.js';\nimport { instantiateTestCodeEditor } from '../../../../../editor/test/browser/testCodeEditor.js';\nimport { IAccessibleViewService } from '../../../../../platform/accessibility/browser/accessibleView.js';\nimport { ICommandService } from '../../../../../platform/commands/common/commands.js';\nimport { IConfigurationService } from '../../../../../platform/configuration/common/configuration.js';\nimport { TestConfigurationService } from '../../../../../platform/configuration/test/common/testConfigurationService.js';\nimport { IContextKeyService } from '../../../../../platform/contextkey/common/contextkey.js';\nimport { SyncDescriptor } from '../../../../../platform/instantiation/common/descriptors.js';\nimport { ServiceCollection } from '../../../../../platform/instantiation/common/serviceCollection.js';\nimport { TestInstantiationService } from '../../../../../platform/instantiation/test/common/instantiationServiceMock.js';\nimport { MockContextKeyService } from '../../../../../platform/keybinding/test/common/mockKeybindingService.js';\nimport { ILogService, NullLogService } from '../../../../../platform/log/common/log.js';\nimport { IEditorProgressService, IProgressRunner } from '../../../../../platform/progress/common/progress.js';\nimport { ITelemetryService } from '../../../../../platform/telemetry/common/telemetry.js';\nimport { NullTelemetryService } from '../../../../../platform/telemetry/common/telemetryUtils.js';\nimport { IWorkspaceContextService } from '../../../../../platform/workspace/common/workspace.js';\nimport { IViewDescriptorService } from '../../../../common/views.js';\nimport { IWorkbenchAssignmentService } from '../../../../services/assignment/common/assignmentService.js';\nimport { NullWorkbenchAssignmentService } from '../../../../services/assignment/test/common/nullAssignmentService.js';\nimport { IExtensionService, nullExtensionDescription } from '../../../../services/extensions/common/extensions.js';\nimport { IViewsService } from '../../../../services/views/common/viewsService.js';\nimport { workbenchInstantiationService } from '../../../../test/browser/workbenchTestServices.js';\nimport { TestContextService, TestExtensionService } from '../../../../test/common/workbenchTestServices.js';\nimport { AccessibilityVerbositySettingId } from '../../../accessibility/browser/accessibilityConfiguration.js';\nimport { IChatAccessibilityService, IChatWidgetService, IQuickChatService } from '../../../chat/browser/chat.js';\nimport { ChatSessionsService } from '../../../chat/browser/chatSessions.contribution.js';\nimport { ChatVariablesService } from '../../../chat/browser/chatVariables.js';\nimport { ChatWidget } from '../../../chat/browser/chatWidget.js';\nimport { ChatAgentService, IChatAgentService } from '../../../chat/common/chatAgents.js';\nimport { IChatEditingService, IChatEditingSession } from '../../../chat/common/chatEditingService.js';\nimport { IChatRequestModel } from '../../../chat/common/chatModel.js';\nimport { IChatService } from '../../../chat/common/chatService.js';\nimport { ChatService } from '../../../chat/common/chatServiceImpl.js';\nimport { IChatSessionsService } from '../../../chat/common/chatSessionsService.js';\nimport { ChatSlashCommandService, IChatSlashCommandService } from '../../../chat/common/chatSlashCommands.js';\nimport { ChatTransferService, IChatTransferService } from '../../../chat/common/chatTransferService.js';\nimport { IChatVariablesService } from '../../../chat/common/chatVariables.js';\nimport { IChatResponseViewModel } from '../../../chat/common/chatViewModel.js';\nimport { ChatWidgetHistoryService, IChatWidgetHistoryService } from '../../../chat/common/chatWidgetHistoryService.js';\nimport { ChatAgentLocation, ChatModeKind } from '../../../chat/common/constants.js';\nimport { ILanguageModelsService } from '../../../chat/common/languageModels.js';\nimport { ILanguageModelToolsService } from '../../../chat/common/languageModelToolsService.js';\nimport { NullLanguageModelsService } from '../../../chat/test/common/languageModels.js';\nimport { MockLanguageModelToolsService } from '../../../chat/test/common/mockLanguageModelToolsService.js';\nimport { IMcpService } from '../../../mcp/common/mcpTypes.js';\nimport { TestMcpService } from '../../../mcp/test/common/testMcpService.js';\nimport { HunkState } from '../../browser/inlineChatSession.js';\nimport { IInlineChatSessionService } from '../../browser/inlineChatSessionService.js';\nimport { InlineChatSessionServiceImpl } from '../../browser/inlineChatSessionServiceImpl.js';\nimport { TestWorkerService } from './testWorkerService.js';\nimport { ChatWidgetService } from '../../../chat/browser/chatWidgetService.js';\n\nsuite('InlineChatSession', function () {\n\n\tconst store = new DisposableStore();\n\tlet editor: IActiveCodeEditor;\n\tlet model: ITextModel;\n\tlet instaService: TestInstantiationService;\n\n\tlet inlineChatSessionService: IInlineChatSessionService;\n\n\tsetup(function () {\n\t\tconst contextKeyService = new MockContextKeyService();\n\n\n\t\tconst serviceCollection = new ServiceCollection(\n\t\t\t[IConfigurationService, new TestConfigurationService()],\n\t\t\t[IChatVariablesService, new SyncDescriptor(ChatVariablesService)],\n\t\t\t[ILogService, new NullLogService()],\n\t\t\t[ITelemetryService, NullTelemetryService],\n\t\t\t[IExtensionService, new TestExtensionService()],\n\t\t\t[IContextKeyService, new MockContextKeyService()],\n\t\t\t[IViewsService, new TestExtensionService()],\n\t\t\t[IWorkspaceContextService, new TestContextService()],\n\t\t\t[IChatWidgetHistoryService, new SyncDescriptor(ChatWidgetHistoryService)],\n\t\t\t[IChatWidgetService, new SyncDescriptor(ChatWidgetService)],\n\t\t\t[IChatSlashCommandService, new SyncDescriptor(ChatSlashCommandService)],\n\t\t\t[IChatTransferService, new SyncDescriptor(ChatTransferService)],\n\t\t\t[IChatSessionsService, new SyncDescriptor(ChatSessionsService)],\n\t\t\t[IChatService, new SyncDescriptor(ChatService)],\n\t\t\t[IEditorWorkerService, new SyncDescriptor(TestWorkerService)],\n\t\t\t[IChatAgentService, new SyncDescriptor(ChatAgentService)],\n\t\t\t[IContextKeyService, contextKeyService],\n\t\t\t[IDiffProviderFactoryService, new SyncDescriptor(TestDiffProviderFactoryService)],\n\t\t\t[ILanguageModelsService, new SyncDescriptor(NullLanguageModelsService)],\n\t\t\t[IInlineChatSessionService, new SyncDescriptor(InlineChatSessionServiceImpl)],\n\t\t\t[ICommandService, new SyncDescriptor(TestCommandService)],\n\t\t\t[ILanguageModelToolsService, new MockLanguageModelToolsService()],\n\t\t\t[IMcpService, new TestMcpService()],\n\t\t\t[IEditorProgressService, new class extends mock<IEditorProgressService>() {\n\t\t\t\toverride show(total: unknown, delay?: unknown): IProgressRunner {\n\t\t\t\t\treturn {\n\t\t\t\t\t\ttotal() { },\n\t\t\t\t\t\tworked(value) { },\n\t\t\t\t\t\tdone() { },\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t}],\n\t\t\t[IChatEditingService, new class extends mock<IChatEditingService>() {\n\t\t\t\toverride editingSessionsObs: IObservable<readonly IChatEditingSession[]> = constObservable([]);\n\t\t\t}],\n\t\t\t[IChatAccessibilityService, new class extends mock<IChatAccessibilityService>() {\n\t\t\t\toverride acceptResponse(chatWidget: ChatWidget, container: HTMLElement, response: IChatResponseViewModel | undefined, requestId: number): void { }\n\t\t\t\toverride acceptRequest(): number { return -1; }\n\t\t\t\toverride acceptElicitation(): void { }\n\t\t\t}],\n\t\t\t[IAccessibleViewService, new class extends mock<IAccessibleViewService>() {\n\t\t\t\toverride getOpenAriaHint(verbositySettingKey: AccessibilityVerbositySettingId): string | null {\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\t\t\t}],\n\t\t\t[IQuickChatService, new class extends mock<IQuickChatService>() { }],\n\t\t\t[IConfigurationService, new TestConfigurationService()],\n\t\t\t[IViewDescriptorService, new class extends mock<IViewDescriptorService>() {\n\t\t\t\toverride onDidChangeLocation = Event.None;\n\t\t\t}],\n\t\t\t[IWorkbenchAssignmentService, new NullWorkbenchAssignmentService()]\n\t\t);\n\n\n\n\t\tinstaService = store.add(workbenchInstantiationService(undefined, store).createChild(serviceCollection));\n\t\tinlineChatSessionService = store.add(instaService.get(IInlineChatSessionService));\n\t\tstore.add(instaService.get(IChatSessionsService) as ChatSessionsService);  // Needs to be disposed in between test runs to clear extensionPoint contribution\n\n\t\tinstaService.get(IChatAgentService).registerDynamicAgent({\n\t\t\textensionId: nullExtensionDescription.identifier,\n\t\t\textensionVersion: undefined,\n\t\t\tpublisherDisplayName: '',\n\t\t\textensionDisplayName: '',\n\t\t\textensionPublisherId: '',\n\t\t\tid: 'testAgent',\n\t\t\tname: 'testAgent',\n\t\t\tisDefault: true,\n\t\t\tlocations: [ChatAgentLocation.EditorInline],\n\t\t\tmodes: [ChatModeKind.Ask],\n\t\t\tmetadata: {},\n\t\t\tslashCommands: [],\n\t\t\tdisambiguation: [],\n\t\t}, {\n\t\t\tasync invoke() {\n\t\t\t\treturn {};\n\t\t\t}\n\t\t});\n\n\n\t\tstore.add(instaService.get(IEditorWorkerService) as TestWorkerService);\n\t\tmodel = store.add(instaService.get(IModelService).createModel('one\\ntwo\\nthree\\nfour\\nfive\\nsix\\nseven\\neight\\nnine\\nten\\neleven', null));\n\t\teditor = store.add(instantiateTestCodeEditor(instaService, model));\n\t});\n\n\tteardown(function () {\n\t\tstore.clear();\n\t});\n\n\tensureNoDisposablesAreLeakedInTestSuite();\n\n\tasync function makeEditAsAi(edit: EditOperation | EditOperation[]) {\n\t\tconst session = inlineChatSessionService.getSession(editor, editor.getModel()!.uri);\n\t\tassertType(session);\n\t\tsession.hunkData.ignoreTextModelNChanges = true;\n\t\ttry {\n\t\t\teditor.executeEdits('test', Array.isArray(edit) ? edit : [edit]);\n\t\t} finally {\n\t\t\tsession.hunkData.ignoreTextModelNChanges = false;\n\t\t}\n\t\tawait session.hunkData.recompute({ applied: 0, sha1: 'fakeSha1' });\n\t}\n\n\tfunction makeEdit(edit: EditOperation | EditOperation[]) {\n\t\teditor.executeEdits('test', Array.isArray(edit) ? edit : [edit]);\n\t}\n\n\ttest('Create, release', async function () {\n\n\t\tconst session = await inlineChatSessionService.createSession(editor, {}, CancellationToken.None);\n\t\tassertType(session);\n\t\tinlineChatSessionService.releaseSession(session);\n\t});\n\n\ttest('HunkData, info', async function () {\n\n\t\tconst decorationCountThen = model.getAllDecorations().length;\n\n\t\tconst session = await inlineChatSessionService.createSession(editor, {}, CancellationToken.None);\n\t\tassertType(session);\n\t\tassert.ok(session.textModelN === model);\n\n\t\tawait makeEditAsAi(EditOperation.insert(new Position(1, 1), 'AI_EDIT\\n'));\n\n\n\t\tassert.strictEqual(session.hunkData.size, 1);\n\t\tlet [hunk] = session.hunkData.getInfo();\n\t\tassertType(hunk);\n\n\t\tassert.ok(!session.textModel0.equalsTextBuffer(session.textModelN.getTextBuffer()));\n\t\tassert.strictEqual(hunk.getState(), HunkState.Pending);\n\t\tassert.ok(hunk.getRangesN()[0].equalsRange({ startLineNumber: 1, startColumn: 1, endLineNumber: 1, endColumn: 8 }));\n\n\t\tawait makeEditAsAi(EditOperation.insert(new Position(1, 3), 'foobar'));\n\t\t[hunk] = session.hunkData.getInfo();\n\t\tassert.ok(hunk.getRangesN()[0].equalsRange({ startLineNumber: 1, startColumn: 1, endLineNumber: 1, endColumn: 14 }));\n\n\t\tinlineChatSessionService.releaseSession(session);\n\n\t\tassert.strictEqual(model.getAllDecorations().length, decorationCountThen); // no leaked decorations!\n\t});\n\n\ttest('HunkData, accept', async function () {\n\n\t\tconst session = await inlineChatSessionService.createSession(editor, {}, CancellationToken.None);\n\t\tassertType(session);\n\n\t\tawait makeEditAsAi([EditOperation.insert(new Position(1, 1), 'AI_EDIT\\n'), EditOperation.insert(new Position(10, 1), 'AI_EDIT\\n')]);\n\n\t\tassert.strictEqual(session.hunkData.size, 2);\n\t\tassert.ok(!session.textModel0.equalsTextBuffer(session.textModelN.getTextBuffer()));\n\n\t\tfor (const hunk of session.hunkData.getInfo()) {\n\t\t\tassertType(hunk);\n\t\t\tassert.strictEqual(hunk.getState(), HunkState.Pending);\n\t\t\thunk.acceptChanges();\n\t\t\tassert.strictEqual(hunk.getState(), HunkState.Accepted);\n\t\t}\n\n\t\tassert.strictEqual(session.textModel0.getValue(), session.textModelN.getValue());\n\t\tinlineChatSessionService.releaseSession(session);\n\t});\n\n\ttest('HunkData, reject', async function () {\n\n\t\tconst session = await inlineChatSessionService.createSession(editor, {}, CancellationToken.None);\n\t\tassertType(session);\n\n\t\tawait makeEditAsAi([EditOperation.insert(new Position(1, 1), 'AI_EDIT\\n'), EditOperation.insert(new Position(10, 1), 'AI_EDIT\\n')]);\n\n\t\tassert.strictEqual(session.hunkData.size, 2);\n\t\tassert.ok(!session.textModel0.equalsTextBuffer(session.textModelN.getTextBuffer()));\n\n\t\tfor (const hunk of session.hunkData.getInfo()) {\n\t\t\tassertType(hunk);\n\t\t\tassert.strictEqual(hunk.getState(), HunkState.Pending);\n\t\t\thunk.discardChanges();\n\t\t\tassert.strictEqual(hunk.getState(), HunkState.Rejected);\n\t\t}\n\n\t\tassert.strictEqual(session.textModel0.getValue(), session.textModelN.getValue());\n\t\tinlineChatSessionService.releaseSession(session);\n\t});\n\n\ttest('HunkData, N rounds', async function () {\n\n\t\tmodel.setValue('one\\ntwo\\nthree\\nfour\\nfive\\nsix\\nseven\\neight\\nnine\\nten\\neleven\\ntwelwe\\nthirteen\\nfourteen\\nfifteen\\nsixteen\\nseventeen\\neighteen\\nnineteen\\n');\n\n\t\tconst session = await inlineChatSessionService.createSession(editor, {}, CancellationToken.None);\n\t\tassertType(session);\n\n\t\tassert.ok(session.textModel0.equalsTextBuffer(session.textModelN.getTextBuffer()));\n\n\t\tassert.strictEqual(session.hunkData.size, 0);\n\n\t\t// ROUND #1\n\t\tawait makeEditAsAi([\n\t\t\tEditOperation.insert(new Position(1, 1), 'AI1'),\n\t\t\tEditOperation.insert(new Position(4, 1), 'AI2'),\n\t\t\tEditOperation.insert(new Position(19, 1), 'AI3')\n\t\t]);\n\n\t\tassert.strictEqual(session.hunkData.size, 2); // AI1, AI2 are merged into one hunk, AI3 is a separate hunk\n\n\t\tlet [first, second] = session.hunkData.getInfo();\n\n\t\tassert.ok(model.getValueInRange(first.getRangesN()[0]).includes('AI1'));\n\t\tassert.ok(model.getValueInRange(first.getRangesN()[0]).includes('AI2'));\n\t\tassert.ok(model.getValueInRange(second.getRangesN()[0]).includes('AI3'));\n\n\t\tassert.ok(!session.textModel0.getValueInRange(first.getRangesN()[0]).includes('AI1'));\n\t\tassert.ok(!session.textModel0.getValueInRange(first.getRangesN()[0]).includes('AI2'));\n\t\tassert.ok(!session.textModel0.getValueInRange(second.getRangesN()[0]).includes('AI3'));\n\n\t\tfirst.acceptChanges();\n\t\tassert.ok(session.textModel0.getValueInRange(first.getRangesN()[0]).includes('AI1'));\n\t\tassert.ok(session.textModel0.getValueInRange(first.getRangesN()[0]).includes('AI2'));\n\t\tassert.ok(!session.textModel0.getValueInRange(second.getRangesN()[0]).includes('AI3'));\n\n\n\t\t// ROUND #2\n\t\tawait makeEditAsAi([\n\t\t\tEditOperation.insert(new Position(7, 1), 'AI4'),\n\t\t]);\n\t\tassert.strictEqual(session.hunkData.size, 2);\n\n\t\t[first, second] = session.hunkData.getInfo();\n\t\tassert.ok(model.getValueInRange(first.getRangesN()[0]).includes('AI4')); // the new hunk (in line-order)\n\t\tassert.ok(model.getValueInRange(second.getRangesN()[0]).includes('AI3')); // the previous hunk remains\n\n\t\tinlineChatSessionService.releaseSession(session);\n\t});\n\n\ttest('HunkData, (mirror) edit before', async function () {\n\n\t\tconst lines = ['one', 'two', 'three'];\n\t\tmodel.setValue(lines.join('\\n'));\n\t\tconst session = await inlineChatSessionService.createSession(editor, {}, CancellationToken.None);\n\t\tassertType(session);\n\n\t\tawait makeEditAsAi([EditOperation.insert(new Position(3, 1), 'AI WAS HERE\\n')]);\n\t\tassert.strictEqual(session.textModelN.getValue(), ['one', 'two', 'AI WAS HERE', 'three'].join('\\n'));\n\t\tassert.strictEqual(session.textModel0.getValue(), lines.join('\\n'));\n\n\t\tmakeEdit([EditOperation.replace(new Range(1, 1, 1, 4), 'ONE')]);\n\t\tassert.strictEqual(session.textModelN.getValue(), ['ONE', 'two', 'AI WAS HERE', 'three'].join('\\n'));\n\t\tassert.strictEqual(session.textModel0.getValue(), ['ONE', 'two', 'three'].join('\\n'));\n\t});\n\n\ttest('HunkData, (mirror) edit after', async function () {\n\n\t\tconst lines = ['one', 'two', 'three', 'four', 'five'];\n\t\tmodel.setValue(lines.join('\\n'));\n\n\t\tconst session = await inlineChatSessionService.createSession(editor, {}, CancellationToken.None);\n\t\tassertType(session);\n\n\t\tawait makeEditAsAi([EditOperation.insert(new Position(3, 1), 'AI_EDIT\\n')]);\n\n\t\tassert.strictEqual(session.hunkData.size, 1);\n\t\tconst [hunk] = session.hunkData.getInfo();\n\n\t\tmakeEdit([EditOperation.insert(new Position(1, 1), 'USER1')]);\n\t\tassert.strictEqual(session.textModelN.getValue(), ['USER1one', 'two', 'AI_EDIT', 'three', 'four', 'five'].join('\\n'));\n\t\tassert.strictEqual(session.textModel0.getValue(), ['USER1one', 'two', 'three', 'four', 'five'].join('\\n'));\n\n\t\tmakeEdit([EditOperation.insert(new Position(5, 1), 'USER2')]);\n\t\tassert.strictEqual(session.textModelN.getValue(), ['USER1one', 'two', 'AI_EDIT', 'three', 'USER2four', 'five'].join('\\n'));\n\t\tassert.strictEqual(session.textModel0.getValue(), ['USER1one', 'two', 'three', 'USER2four', 'five'].join('\\n'));\n\n\t\thunk.acceptChanges();\n\t\tassert.strictEqual(session.textModelN.getValue(), ['USER1one', 'two', 'AI_EDIT', 'three', 'USER2four', 'five'].join('\\n'));\n\t\tassert.strictEqual(session.textModel0.getValue(), ['USER1one', 'two', 'AI_EDIT', 'three', 'USER2four', 'five'].join('\\n'));\n\t});\n\n\ttest('HunkData, (mirror) edit inside ', async function () {\n\n\t\tconst lines = ['one', 'two', 'three'];\n\t\tmodel.setValue(lines.join('\\n'));\n\t\tconst session = await inlineChatSessionService.createSession(editor, {}, CancellationToken.None);\n\t\tassertType(session);\n\n\t\tawait makeEditAsAi([EditOperation.insert(new Position(3, 1), 'AI WAS HERE\\n')]);\n\t\tassert.strictEqual(session.textModelN.getValue(), ['one', 'two', 'AI WAS HERE', 'three'].join('\\n'));\n\t\tassert.strictEqual(session.textModel0.getValue(), lines.join('\\n'));\n\n\t\tmakeEdit([EditOperation.replace(new Range(3, 4, 3, 7), 'wwaaassss')]);\n\t\tassert.strictEqual(session.textModelN.getValue(), ['one', 'two', 'AI wwaaassss HERE', 'three'].join('\\n'));\n\t\tassert.strictEqual(session.textModel0.getValue(), ['one', 'two', 'three'].join('\\n'));\n\t});\n\n\ttest('HunkData, (mirror) edit after dicard ', async function () {\n\n\t\tconst lines = ['one', 'two', 'three'];\n\t\tmodel.setValue(lines.join('\\n'));\n\t\tconst session = await inlineChatSessionService.createSession(editor, {}, CancellationToken.None);\n\t\tassertType(session);\n\n\t\tawait makeEditAsAi([EditOperation.insert(new Position(3, 1), 'AI WAS HERE\\n')]);\n\t\tassert.strictEqual(session.textModelN.getValue(), ['one', 'two', 'AI WAS HERE', 'three'].join('\\n'));\n\t\tassert.strictEqual(session.textModel0.getValue(), lines.join('\\n'));\n\n\t\tassert.strictEqual(session.hunkData.size, 1);\n\t\tconst [hunk] = session.hunkData.getInfo();\n\t\thunk.discardChanges();\n\t\tassert.strictEqual(session.textModelN.getValue(), lines.join('\\n'));\n\t\tassert.strictEqual(session.textModel0.getValue(), lines.join('\\n'));\n\n\t\tmakeEdit([EditOperation.replace(new Range(3, 4, 3, 6), '3333')]);\n\t\tassert.strictEqual(session.textModelN.getValue(), ['one', 'two', 'thr3333'].join('\\n'));\n\t\tassert.strictEqual(session.textModel0.getValue(), ['one', 'two', 'thr3333'].join('\\n'));\n\t});\n\n\ttest('HunkData, (mirror) edit after, multi turn', async function () {\n\n\t\tconst lines = ['one', 'two', 'three', 'four', 'five'];\n\t\tmodel.setValue(lines.join('\\n'));\n\n\t\tconst session = await inlineChatSessionService.createSession(editor, {}, CancellationToken.None);\n\t\tassertType(session);\n\n\t\tawait makeEditAsAi([EditOperation.insert(new Position(3, 1), 'AI_EDIT\\n')]);\n\n\t\tassert.strictEqual(session.hunkData.size, 1);\n\n\t\tmakeEdit([EditOperation.insert(new Position(5, 1), 'FOO')]);\n\t\tassert.strictEqual(session.textModelN.getValue(), ['one', 'two', 'AI_EDIT', 'three', 'FOOfour', 'five'].join('\\n'));\n\t\tassert.strictEqual(session.textModel0.getValue(), ['one', 'two', 'three', 'FOOfour', 'five'].join('\\n'));\n\n\t\tawait makeEditAsAi([EditOperation.insert(new Position(2, 4), ' zwei')]);\n\t\tassert.strictEqual(session.hunkData.size, 1);\n\n\t\tassert.strictEqual(session.textModelN.getValue(), ['one', 'two zwei', 'AI_EDIT', 'three', 'FOOfour', 'five'].join('\\n'));\n\t\tassert.strictEqual(session.textModel0.getValue(), ['one', 'two', 'three', 'FOOfour', 'five'].join('\\n'));\n\n\t\tmakeEdit([EditOperation.replace(new Range(6, 3, 6, 5), 'vefivefi')]);\n\t\tassert.strictEqual(session.textModelN.getValue(), ['one', 'two zwei', 'AI_EDIT', 'three', 'FOOfour', 'fivefivefi'].join('\\n'));\n\t\tassert.strictEqual(session.textModel0.getValue(), ['one', 'two', 'three', 'FOOfour', 'fivefivefi'].join('\\n'));\n\t});\n\n\ttest('HunkData, (mirror) edit after, multi turn 2', async function () {\n\n\t\tconst lines = ['one', 'two', 'three', 'four', 'five'];\n\t\tmodel.setValue(lines.join('\\n'));\n\n\t\tconst session = await inlineChatSessionService.createSession(editor, {}, CancellationToken.None);\n\t\tassertType(session);\n\n\t\tawait makeEditAsAi([EditOperation.insert(new Position(3, 1), 'AI_EDIT\\n')]);\n\n\t\tassert.strictEqual(session.hunkData.size, 1);\n\n\t\tmakeEdit([EditOperation.insert(new Position(5, 1), 'FOO')]);\n\t\tassert.strictEqual(session.textModelN.getValue(), ['one', 'two', 'AI_EDIT', 'three', 'FOOfour', 'five'].join('\\n'));\n\t\tassert.strictEqual(session.textModel0.getValue(), ['one', 'two', 'three', 'FOOfour', 'five'].join('\\n'));\n\n\t\tawait makeEditAsAi([EditOperation.insert(new Position(2, 4), 'zwei')]);\n\t\tassert.strictEqual(session.hunkData.size, 1);\n\n\t\tassert.strictEqual(session.textModelN.getValue(), ['one', 'twozwei', 'AI_EDIT', 'three', 'FOOfour', 'five'].join('\\n'));\n\t\tassert.strictEqual(session.textModel0.getValue(), ['one', 'two', 'three', 'FOOfour', 'five'].join('\\n'));\n\n\t\tmakeEdit([EditOperation.replace(new Range(6, 3, 6, 5), 'vefivefi')]);\n\t\tassert.strictEqual(session.textModelN.getValue(), ['one', 'twozwei', 'AI_EDIT', 'three', 'FOOfour', 'fivefivefi'].join('\\n'));\n\t\tassert.strictEqual(session.textModel0.getValue(), ['one', 'two', 'three', 'FOOfour', 'fivefivefi'].join('\\n'));\n\n\t\tsession.hunkData.getInfo()[0].acceptChanges();\n\t\tassert.strictEqual(session.textModelN.getValue(), session.textModel0.getValue());\n\n\t\tmakeEdit([EditOperation.replace(new Range(1, 1, 1, 1), 'done')]);\n\t\tassert.strictEqual(session.textModelN.getValue(), session.textModel0.getValue());\n\t});\n\n\ttest('HunkData, accept, discardAll', async function () {\n\n\t\tconst session = await inlineChatSessionService.createSession(editor, {}, CancellationToken.None);\n\t\tassertType(session);\n\n\t\tawait makeEditAsAi([EditOperation.insert(new Position(1, 1), 'AI_EDIT\\n'), EditOperation.insert(new Position(10, 1), 'AI_EDIT\\n')]);\n\n\t\tassert.strictEqual(session.hunkData.size, 2);\n\t\tassert.ok(!session.textModel0.equalsTextBuffer(session.textModelN.getTextBuffer()));\n\n\t\tconst textModeNNow = session.textModelN.getValue();\n\n\t\tsession.hunkData.getInfo()[0].acceptChanges();\n\t\tassert.strictEqual(textModeNNow, session.textModelN.getValue());\n\n\t\tsession.hunkData.discardAll(); // all remaining\n\t\tassert.strictEqual(session.textModelN.getValue(), 'AI_EDIT\\none\\ntwo\\nthree\\nfour\\nfive\\nsix\\nseven\\neight\\nnine\\nten\\neleven');\n\t\tassert.strictEqual(session.textModelN.getValue(), session.textModel0.getValue());\n\n\t\tinlineChatSessionService.releaseSession(session);\n\t});\n\n\ttest('HunkData, discardAll return undo edits', async function () {\n\n\t\tconst session = await inlineChatSessionService.createSession(editor, {}, CancellationToken.None);\n\t\tassertType(session);\n\n\t\tawait makeEditAsAi([EditOperation.insert(new Position(1, 1), 'AI_EDIT\\n'), EditOperation.insert(new Position(10, 1), 'AI_EDIT\\n')]);\n\n\t\tassert.strictEqual(session.hunkData.size, 2);\n\t\tassert.ok(!session.textModel0.equalsTextBuffer(session.textModelN.getTextBuffer()));\n\n\t\tconst textModeNNow = session.textModelN.getValue();\n\n\t\tsession.hunkData.getInfo()[0].acceptChanges();\n\t\tassert.strictEqual(textModeNNow, session.textModelN.getValue());\n\n\t\tconst undoEdits = session.hunkData.discardAll(); // all remaining\n\t\tassert.strictEqual(session.textModelN.getValue(), 'AI_EDIT\\none\\ntwo\\nthree\\nfour\\nfive\\nsix\\nseven\\neight\\nnine\\nten\\neleven');\n\t\tassert.strictEqual(session.textModelN.getValue(), session.textModel0.getValue());\n\n\t\t// undo the discards\n\t\tsession.textModelN.pushEditOperations(null, undoEdits, () => null);\n\t\tassert.strictEqual(textModeNNow, session.textModelN.getValue());\n\n\t\tinlineChatSessionService.releaseSession(session);\n\t});\n\n\ttest('Pressing Escape after inline chat errored with \"response filtered\" leaves document dirty #7764', async function () {\n\n\t\tconst origValue = `class Foo {\n\tprivate onError(error: string): void {\n\t\tif (/The request timed out|The network connection was lost/i.test(error)) {\n\t\t\treturn;\n\t\t}\n\n\t\terror = error.replace(/See https:\\/\\/github\\.com\\/Squirrel\\/Squirrel\\.Mac\\/issues\\/182 for more information/, 'This might mean the application was put on quarantine by macOS. See [this link](https://github.com/microsoft/vscode/issues/7426#issuecomment-425093469) for more information');\n\n\t\tthis.notificationService.notify({\n\t\t\tseverity: Severity.Error,\n\t\t\tmessage: error,\n\t\t\tsource: nls.localize('update service', \"Update Service\"),\n\t\t});\n\t}\n}`;\n\t\tmodel.setValue(origValue);\n\n\t\tconst session = await inlineChatSessionService.createSession(editor, {}, CancellationToken.None);\n\t\tassertType(session);\n\n\t\tconst fakeRequest = new class extends mock<IChatRequestModel>() {\n\t\t\toverride get id() { return 'one'; }\n\t\t};\n\t\tsession.markModelVersion(fakeRequest);\n\n\t\tassert.strictEqual(editor.getModel().getLineCount(), 15);\n\n\t\tawait makeEditAsAi([EditOperation.replace(new Range(7, 1, 7, Number.MAX_SAFE_INTEGER), `error = error.replace(\n\t\t\t/See https:\\/\\/github\\.com\\/Squirrel\\/Squirrel\\.Mac\\/issues\\/182 for more information/,\n\t\t\t'This might mean the application was put on quarantine by macOS. See [this link](https://github.com/microsoft/vscode/issues/7426#issuecomment-425093469) for more information'\n\t\t);`)]);\n\n\t\tassert.strictEqual(editor.getModel().getLineCount(), 18);\n\n\t\t// called when a response errors out\n\t\tawait session.undoChangesUntil(fakeRequest.id);\n\t\tawait session.hunkData.recompute({ applied: 0, sha1: 'fakeSha1' }, undefined);\n\n\t\tassert.strictEqual(editor.getModel().getValue(), origValue);\n\n\t\tsession.hunkData.discardAll(); // called when dimissing the session\n\t\tassert.strictEqual(editor.getModel().getValue(), origValue);\n\t});\n\n\ttest('Apply Code\\'s preview should be easier to undo/esc #7537', async function () {\n\t\tmodel.setValue(`export function fib(n) {\n\tif (n <= 0) return 0;\n\tif (n === 1) return 0;\n\tif (n === 2) return 1;\n\treturn fib(n - 1) + fib(n - 2);\n}`);\n\t\tconst session = await inlineChatSessionService.createSession(editor, {}, CancellationToken.None);\n\t\tassertType(session);\n\n\t\tawait makeEditAsAi([EditOperation.replace(new Range(5, 1, 6, Number.MAX_SAFE_INTEGER), `\n\tlet a = 0, b = 1, c;\n\tfor (let i = 3; i <= n; i++) {\n\t\tc = a + b;\n\t\ta = b;\n\t\tb = c;\n\t}\n\treturn b;\n}`)]);\n\n\t\tassert.strictEqual(session.hunkData.size, 1);\n\t\tassert.strictEqual(session.hunkData.pending, 1);\n\t\tassert.ok(session.hunkData.getInfo().every(d => d.getState() === HunkState.Pending));\n\n\t\tawait assertSnapshot(editor.getModel().getValue(), { name: '1' });\n\n\t\tawait model.undo();\n\t\tawait assertSnapshot(editor.getModel().getValue(), { name: '2' });\n\n\t\t// overlapping edits (even UNDO) mark edits as accepted\n\t\tassert.strictEqual(session.hunkData.size, 1);\n\t\tassert.strictEqual(session.hunkData.pending, 0);\n\t\tassert.ok(session.hunkData.getInfo().every(d => d.getState() === HunkState.Accepted));\n\n\t\t// no further change when discarding\n\t\tsession.hunkData.discardAll(); // CANCEL\n\t\tawait assertSnapshot(editor.getModel().getValue(), { name: '2' });\n\t});\n\n});\n"]}