{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/services/configuration/common/configurationCache.ts","vs/workbench/services/configuration/common/configurationCache.ts"],"names":[],"mappings":"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","file":"configurationCache.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { IConfigurationCache, ConfigurationKey } from './configuration.js';\nimport { URI } from '../../../../base/common/uri.js';\nimport { FileOperationError, FileOperationResult, IFileService } from '../../../../platform/files/common/files.js';\nimport { joinPath } from '../../../../base/common/resources.js';\nimport { VSBuffer } from '../../../../base/common/buffer.js';\nimport { Queue } from '../../../../base/common/async.js';\nimport { IEnvironmentService } from '../../../../platform/environment/common/environment.js';\n\nexport class ConfigurationCache implements IConfigurationCache {\n\n\tprivate readonly cacheHome: URI;\n\tprivate readonly cachedConfigurations: Map<string, CachedConfiguration> = new Map<string, CachedConfiguration>();\n\n\tconstructor(\n\t\tprivate readonly donotCacheResourcesWithSchemes: string[],\n\t\tenvironmentService: IEnvironmentService,\n\t\tprivate readonly fileService: IFileService\n\t) {\n\t\tthis.cacheHome = environmentService.cacheHome;\n\t}\n\n\tneedsCaching(resource: URI): boolean {\n\t\t// Cache all non native resources\n\t\treturn !this.donotCacheResourcesWithSchemes.includes(resource.scheme);\n\t}\n\n\tread(key: ConfigurationKey): Promise<string> {\n\t\treturn this.getCachedConfiguration(key).read();\n\t}\n\n\twrite(key: ConfigurationKey, content: string): Promise<void> {\n\t\treturn this.getCachedConfiguration(key).save(content);\n\t}\n\n\tremove(key: ConfigurationKey): Promise<void> {\n\t\treturn this.getCachedConfiguration(key).remove();\n\t}\n\n\tprivate getCachedConfiguration({ type, key }: ConfigurationKey): CachedConfiguration {\n\t\tconst k = `${type}:${key}`;\n\t\tlet cachedConfiguration = this.cachedConfigurations.get(k);\n\t\tif (!cachedConfiguration) {\n\t\t\tcachedConfiguration = new CachedConfiguration({ type, key }, this.cacheHome, this.fileService);\n\t\t\tthis.cachedConfigurations.set(k, cachedConfiguration);\n\t\t}\n\t\treturn cachedConfiguration;\n\t}\n}\n\nclass CachedConfiguration {\n\n\tprivate queue: Queue<void>;\n\tprivate cachedConfigurationFolderResource: URI;\n\tprivate cachedConfigurationFileResource: URI;\n\n\tconstructor(\n\t\t{ type, key }: ConfigurationKey,\n\t\tcacheHome: URI,\n\t\tprivate readonly fileService: IFileService\n\t) {\n\t\tthis.cachedConfigurationFolderResource = joinPath(cacheHome, 'CachedConfigurations', type, key);\n\t\tthis.cachedConfigurationFileResource = joinPath(this.cachedConfigurationFolderResource, type === 'workspaces' ? 'workspace.json' : 'configuration.json');\n\t\tthis.queue = new Queue<void>();\n\t}\n\n\tasync read(): Promise<string> {\n\t\ttry {\n\t\t\tconst content = await this.fileService.readFile(this.cachedConfigurationFileResource);\n\t\t\treturn content.value.toString();\n\t\t} catch (e) {\n\t\t\treturn '';\n\t\t}\n\t}\n\n\tasync save(content: string): Promise<void> {\n\t\tconst created = await this.createCachedFolder();\n\t\tif (created) {\n\t\t\tawait this.queue.queue(async () => {\n\t\t\t\tawait this.fileService.writeFile(this.cachedConfigurationFileResource, VSBuffer.fromString(content));\n\t\t\t});\n\t\t}\n\t}\n\n\tasync remove(): Promise<void> {\n\t\ttry {\n\t\t\tawait this.queue.queue(() => this.fileService.del(this.cachedConfigurationFolderResource, { recursive: true, useTrash: false }));\n\t\t} catch (error) {\n\t\t\tif ((<FileOperationError>error).fileOperationResult !== FileOperationResult.FILE_NOT_FOUND) {\n\t\t\t\tthrow error;\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate async createCachedFolder(): Promise<boolean> {\n\t\tif (await this.fileService.exists(this.cachedConfigurationFolderResource)) {\n\t\t\treturn true;\n\t\t}\n\t\ttry {\n\t\t\tawait this.fileService.createFolder(this.cachedConfigurationFolderResource);\n\t\t\treturn true;\n\t\t} catch (error) {\n\t\t\treturn false;\n\t\t}\n\t}\n}\n\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { IConfigurationCache, ConfigurationKey } from './configuration.js';\nimport { URI } from '../../../../base/common/uri.js';\nimport { FileOperationError, FileOperationResult, IFileService } from '../../../../platform/files/common/files.js';\nimport { joinPath } from '../../../../base/common/resources.js';\nimport { VSBuffer } from '../../../../base/common/buffer.js';\nimport { Queue } from '../../../../base/common/async.js';\nimport { IEnvironmentService } from '../../../../platform/environment/common/environment.js';\n\nexport class ConfigurationCache implements IConfigurationCache {\n\n\tprivate readonly cacheHome: URI;\n\tprivate readonly cachedConfigurations: Map<string, CachedConfiguration> = new Map<string, CachedConfiguration>();\n\n\tconstructor(\n\t\tprivate readonly donotCacheResourcesWithSchemes: string[],\n\t\tenvironmentService: IEnvironmentService,\n\t\tprivate readonly fileService: IFileService\n\t) {\n\t\tthis.cacheHome = environmentService.cacheHome;\n\t}\n\n\tneedsCaching(resource: URI): boolean {\n\t\t// Cache all non native resources\n\t\treturn !this.donotCacheResourcesWithSchemes.includes(resource.scheme);\n\t}\n\n\tread(key: ConfigurationKey): Promise<string> {\n\t\treturn this.getCachedConfiguration(key).read();\n\t}\n\n\twrite(key: ConfigurationKey, content: string): Promise<void> {\n\t\treturn this.getCachedConfiguration(key).save(content);\n\t}\n\n\tremove(key: ConfigurationKey): Promise<void> {\n\t\treturn this.getCachedConfiguration(key).remove();\n\t}\n\n\tprivate getCachedConfiguration({ type, key }: ConfigurationKey): CachedConfiguration {\n\t\tconst k = `${type}:${key}`;\n\t\tlet cachedConfiguration = this.cachedConfigurations.get(k);\n\t\tif (!cachedConfiguration) {\n\t\t\tcachedConfiguration = new CachedConfiguration({ type, key }, this.cacheHome, this.fileService);\n\t\t\tthis.cachedConfigurations.set(k, cachedConfiguration);\n\t\t}\n\t\treturn cachedConfiguration;\n\t}\n}\n\nclass CachedConfiguration {\n\n\tprivate queue: Queue<void>;\n\tprivate cachedConfigurationFolderResource: URI;\n\tprivate cachedConfigurationFileResource: URI;\n\n\tconstructor(\n\t\t{ type, key }: ConfigurationKey,\n\t\tcacheHome: URI,\n\t\tprivate readonly fileService: IFileService\n\t) {\n\t\tthis.cachedConfigurationFolderResource = joinPath(cacheHome, 'CachedConfigurations', type, key);\n\t\tthis.cachedConfigurationFileResource = joinPath(this.cachedConfigurationFolderResource, type === 'workspaces' ? 'workspace.json' : 'configuration.json');\n\t\tthis.queue = new Queue<void>();\n\t}\n\n\tasync read(): Promise<string> {\n\t\ttry {\n\t\t\tconst content = await this.fileService.readFile(this.cachedConfigurationFileResource);\n\t\t\treturn content.value.toString();\n\t\t} catch (e) {\n\t\t\treturn '';\n\t\t}\n\t}\n\n\tasync save(content: string): Promise<void> {\n\t\tconst created = await this.createCachedFolder();\n\t\tif (created) {\n\t\t\tawait this.queue.queue(async () => {\n\t\t\t\tawait this.fileService.writeFile(this.cachedConfigurationFileResource, VSBuffer.fromString(content));\n\t\t\t});\n\t\t}\n\t}\n\n\tasync remove(): Promise<void> {\n\t\ttry {\n\t\t\tawait this.queue.queue(() => this.fileService.del(this.cachedConfigurationFolderResource, { recursive: true, useTrash: false }));\n\t\t} catch (error) {\n\t\t\tif ((<FileOperationError>error).fileOperationResult !== FileOperationResult.FILE_NOT_FOUND) {\n\t\t\t\tthrow error;\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate async createCachedFolder(): Promise<boolean> {\n\t\tif (await this.fileService.exists(this.cachedConfigurationFolderResource)) {\n\t\t\treturn true;\n\t\t}\n\t\ttry {\n\t\t\tawait this.fileService.createFolder(this.cachedConfigurationFolderResource);\n\t\t\treturn true;\n\t\t} catch (error) {\n\t\t\treturn false;\n\t\t}\n\t}\n}\n\n"]}