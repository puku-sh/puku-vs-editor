{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/services/userDataSync/browser/userDataSyncInit.ts","vs/workbench/services/userDataSync/browser/userDataSyncInit.ts"],"names":[],"mappings":"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","file":"userDataSyncInit.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { IStorageService, StorageScope } from '../../../../platform/storage/common/storage.js';\nimport { AbstractExtensionsInitializer, IExtensionsInitializerPreviewResult } from '../../../../platform/userDataSync/common/extensionsSync.js';\nimport { GlobalStateInitializer, UserDataSyncStoreTypeSynchronizer } from '../../../../platform/userDataSync/common/globalStateSync.js';\nimport { KeybindingsInitializer } from '../../../../platform/userDataSync/common/keybindingsSync.js';\nimport { SettingsInitializer } from '../../../../platform/userDataSync/common/settingsSync.js';\nimport { SnippetsInitializer } from '../../../../platform/userDataSync/common/snippetsSync.js';\nimport { IFileService } from '../../../../platform/files/common/files.js';\nimport { IInstantiationService } from '../../../../platform/instantiation/common/instantiation.js';\nimport { ILogService } from '../../../../platform/log/common/log.js';\nimport { UserDataSyncStoreClient } from '../../../../platform/userDataSync/common/userDataSyncStoreService.js';\nimport { IProductService } from '../../../../platform/product/common/productService.js';\nimport { IRequestService } from '../../../../platform/request/common/request.js';\nimport { IRemoteUserData, IUserData, IUserDataSyncResourceInitializer, IUserDataSyncLogService, IUserDataSyncStoreManagementService, SyncResource } from '../../../../platform/userDataSync/common/userDataSync.js';\nimport { AuthenticationSessionInfo, getCurrentAuthenticationSessionInfo } from '../../authentication/browser/authenticationService.js';\nimport { getSyncAreaLabel } from '../common/userDataSync.js';\nimport { isWeb } from '../../../../base/common/platform.js';\nimport { Barrier, Promises } from '../../../../base/common/async.js';\nimport { EXTENSION_INSTALL_SKIP_PUBLISHER_TRUST_CONTEXT, IExtensionGalleryService, IExtensionManagementService, IGlobalExtensionEnablementService, ILocalExtension } from '../../../../platform/extensionManagement/common/extensionManagement.js';\nimport { IEnvironmentService } from '../../../../platform/environment/common/environment.js';\nimport { IExtensionService, toExtensionDescription } from '../../extensions/common/extensions.js';\nimport { areSameExtensions } from '../../../../platform/extensionManagement/common/extensionManagementUtil.js';\nimport { IIgnoredExtensionsManagementService } from '../../../../platform/userDataSync/common/ignoredExtensions.js';\nimport { DisposableStore } from '../../../../base/common/lifecycle.js';\nimport { isEqual } from '../../../../base/common/resources.js';\nimport { CancellationToken } from '../../../../base/common/cancellation.js';\nimport { IUriIdentityService } from '../../../../platform/uriIdentity/common/uriIdentity.js';\nimport { IExtensionStorageService } from '../../../../platform/extensionManagement/common/extensionStorage.js';\nimport { TasksInitializer } from '../../../../platform/userDataSync/common/tasksSync.js';\nimport { IUserDataProfilesService } from '../../../../platform/userDataProfile/common/userDataProfile.js';\nimport { IBrowserWorkbenchEnvironmentService } from '../../environment/browser/environmentService.js';\nimport { IUserDataInitializer } from '../../userData/browser/userDataInit.js';\nimport { ISecretStorageService } from '../../../../platform/secrets/common/secrets.js';\n\nexport class UserDataSyncInitializer implements IUserDataInitializer {\n\n\t_serviceBrand: undefined;\n\n\tprivate readonly initialized: SyncResource[] = [];\n\tprivate readonly initializationFinished = new Barrier();\n\tprivate globalStateUserData: IUserData | null = null;\n\n\tconstructor(\n\t\t@IBrowserWorkbenchEnvironmentService private readonly environmentService: IBrowserWorkbenchEnvironmentService,\n\t\t@ISecretStorageService private readonly secretStorageService: ISecretStorageService,\n\t\t@IUserDataSyncStoreManagementService private readonly userDataSyncStoreManagementService: IUserDataSyncStoreManagementService,\n\t\t@IFileService private readonly fileService: IFileService,\n\t\t@IUserDataProfilesService private readonly userDataProfilesService: IUserDataProfilesService,\n\t\t@IStorageService private readonly storageService: IStorageService,\n\t\t@IProductService private readonly productService: IProductService,\n\t\t@IRequestService private readonly requestService: IRequestService,\n\t\t@ILogService private readonly logService: ILogService,\n\t\t@IUriIdentityService private readonly uriIdentityService: IUriIdentityService,\n\t) {\n\t\tthis.createUserDataSyncStoreClient().then(userDataSyncStoreClient => {\n\t\t\tif (!userDataSyncStoreClient) {\n\t\t\t\tthis.initializationFinished.open();\n\t\t\t}\n\t\t});\n\t}\n\n\tprivate _userDataSyncStoreClientPromise: Promise<UserDataSyncStoreClient | undefined> | undefined;\n\tprivate createUserDataSyncStoreClient(): Promise<UserDataSyncStoreClient | undefined> {\n\t\tif (!this._userDataSyncStoreClientPromise) {\n\t\t\tthis._userDataSyncStoreClientPromise = (async (): Promise<UserDataSyncStoreClient | undefined> => {\n\t\t\t\ttry {\n\t\t\t\t\tif (!isWeb) {\n\t\t\t\t\t\tthis.logService.trace(`Skipping initializing user data in desktop`);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!this.storageService.isNew(StorageScope.APPLICATION)) {\n\t\t\t\t\t\tthis.logService.trace(`Skipping initializing user data as application was opened before`);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!this.storageService.isNew(StorageScope.WORKSPACE)) {\n\t\t\t\t\t\tthis.logService.trace(`Skipping initializing user data as workspace was opened before`);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (this.environmentService.options?.settingsSyncOptions?.authenticationProvider && !this.environmentService.options.settingsSyncOptions.enabled) {\n\t\t\t\t\t\tthis.logService.trace(`Skipping initializing user data as settings sync is disabled`);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tlet authenticationSession;\n\t\t\t\t\ttry {\n\t\t\t\t\t\tauthenticationSession = await getCurrentAuthenticationSessionInfo(this.secretStorageService, this.productService);\n\t\t\t\t\t} catch (error) {\n\t\t\t\t\t\tthis.logService.error(error);\n\t\t\t\t\t}\n\t\t\t\t\tif (!authenticationSession) {\n\t\t\t\t\t\tthis.logService.trace(`Skipping initializing user data as authentication session is not set`);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tawait this.initializeUserDataSyncStore(authenticationSession);\n\n\t\t\t\t\tconst userDataSyncStore = this.userDataSyncStoreManagementService.userDataSyncStore;\n\t\t\t\t\tif (!userDataSyncStore) {\n\t\t\t\t\t\tthis.logService.trace(`Skipping initializing user data as sync service is not provided`);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tconst userDataSyncStoreClient = new UserDataSyncStoreClient(userDataSyncStore.url, this.productService, this.requestService, this.logService, this.environmentService, this.fileService, this.storageService);\n\t\t\t\t\tuserDataSyncStoreClient.setAuthToken(authenticationSession.accessToken, authenticationSession.providerId);\n\n\t\t\t\t\tconst manifest = await userDataSyncStoreClient.manifest(null);\n\t\t\t\t\tif (manifest === null) {\n\t\t\t\t\t\tuserDataSyncStoreClient.dispose();\n\t\t\t\t\t\tthis.logService.trace(`Skipping initializing user data as there is no data`);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.logService.info(`Using settings sync service ${userDataSyncStore.url.toString()} for initialization`);\n\t\t\t\t\treturn userDataSyncStoreClient;\n\n\t\t\t\t} catch (error) {\n\t\t\t\t\tthis.logService.error(error);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t})();\n\t\t}\n\n\t\treturn this._userDataSyncStoreClientPromise;\n\t}\n\n\tprivate async initializeUserDataSyncStore(authenticationSession: AuthenticationSessionInfo): Promise<void> {\n\t\tconst userDataSyncStore = this.userDataSyncStoreManagementService.userDataSyncStore;\n\t\tif (!userDataSyncStore?.canSwitch) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst disposables = new DisposableStore();\n\t\ttry {\n\t\t\tconst userDataSyncStoreClient = disposables.add(new UserDataSyncStoreClient(userDataSyncStore.url, this.productService, this.requestService, this.logService, this.environmentService, this.fileService, this.storageService));\n\t\t\tuserDataSyncStoreClient.setAuthToken(authenticationSession.accessToken, authenticationSession.providerId);\n\n\t\t\t// Cache global state data for global state initialization\n\t\t\tthis.globalStateUserData = await userDataSyncStoreClient.readResource(SyncResource.GlobalState, null);\n\n\t\t\tif (this.globalStateUserData) {\n\t\t\t\tconst userDataSyncStoreType = new UserDataSyncStoreTypeSynchronizer(userDataSyncStoreClient, this.storageService, this.environmentService, this.fileService, this.logService).getSyncStoreType(this.globalStateUserData);\n\t\t\t\tif (userDataSyncStoreType) {\n\t\t\t\t\tawait this.userDataSyncStoreManagementService.switch(userDataSyncStoreType);\n\n\t\t\t\t\t// Unset cached global state data if urls are changed\n\t\t\t\t\tif (!isEqual(userDataSyncStore.url, this.userDataSyncStoreManagementService.userDataSyncStore?.url)) {\n\t\t\t\t\t\tthis.logService.info('Switched settings sync store');\n\t\t\t\t\t\tthis.globalStateUserData = null;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t} finally {\n\t\t\tdisposables.dispose();\n\t\t}\n\t}\n\n\tasync whenInitializationFinished(): Promise<void> {\n\t\tawait this.initializationFinished.wait();\n\t}\n\n\tasync requiresInitialization(): Promise<boolean> {\n\t\tthis.logService.trace(`UserDataInitializationService#requiresInitialization`);\n\t\tconst userDataSyncStoreClient = await this.createUserDataSyncStoreClient();\n\t\treturn !!userDataSyncStoreClient;\n\t}\n\n\tasync initializeRequiredResources(): Promise<void> {\n\t\tthis.logService.trace(`UserDataInitializationService#initializeRequiredResources`);\n\t\treturn this.initialize([SyncResource.Settings, SyncResource.GlobalState]);\n\t}\n\n\tasync initializeOtherResources(instantiationService: IInstantiationService): Promise<void> {\n\t\ttry {\n\t\t\tthis.logService.trace(`UserDataInitializationService#initializeOtherResources`);\n\t\t\tawait Promise.allSettled([this.initialize([SyncResource.Keybindings, SyncResource.Snippets, SyncResource.Tasks]), this.initializeExtensions(instantiationService)]);\n\t\t} finally {\n\t\t\tthis.initializationFinished.open();\n\t\t}\n\t}\n\n\tprivate async initializeExtensions(instantiationService: IInstantiationService): Promise<void> {\n\t\ttry {\n\t\t\tawait Promise.all([this.initializeInstalledExtensions(instantiationService), this.initializeNewExtensions(instantiationService)]);\n\t\t} finally {\n\t\t\tthis.initialized.push(SyncResource.Extensions);\n\t\t}\n\t}\n\n\tprivate initializeInstalledExtensionsPromise: Promise<void> | undefined;\n\tasync initializeInstalledExtensions(instantiationService: IInstantiationService): Promise<void> {\n\t\tif (!this.initializeInstalledExtensionsPromise) {\n\t\t\tthis.initializeInstalledExtensionsPromise = (async () => {\n\t\t\t\tthis.logService.trace(`UserDataInitializationService#initializeInstalledExtensions`);\n\t\t\t\tconst extensionsPreviewInitializer = await this.getExtensionsPreviewInitializer(instantiationService);\n\t\t\t\tif (extensionsPreviewInitializer) {\n\t\t\t\t\tawait instantiationService.createInstance(InstalledExtensionsInitializer, extensionsPreviewInitializer).initialize();\n\t\t\t\t}\n\t\t\t})();\n\t\t}\n\t\treturn this.initializeInstalledExtensionsPromise;\n\t}\n\n\tprivate initializeNewExtensionsPromise: Promise<void> | undefined;\n\tprivate async initializeNewExtensions(instantiationService: IInstantiationService): Promise<void> {\n\t\tif (!this.initializeNewExtensionsPromise) {\n\t\t\tthis.initializeNewExtensionsPromise = (async () => {\n\t\t\t\tthis.logService.trace(`UserDataInitializationService#initializeNewExtensions`);\n\t\t\t\tconst extensionsPreviewInitializer = await this.getExtensionsPreviewInitializer(instantiationService);\n\t\t\t\tif (extensionsPreviewInitializer) {\n\t\t\t\t\tawait instantiationService.createInstance(NewExtensionsInitializer, extensionsPreviewInitializer).initialize();\n\t\t\t\t}\n\t\t\t})();\n\t\t}\n\t\treturn this.initializeNewExtensionsPromise;\n\t}\n\n\tprivate extensionsPreviewInitializerPromise: Promise<ExtensionsPreviewInitializer | null> | undefined;\n\tprivate getExtensionsPreviewInitializer(instantiationService: IInstantiationService): Promise<ExtensionsPreviewInitializer | null> {\n\t\tif (!this.extensionsPreviewInitializerPromise) {\n\t\t\tthis.extensionsPreviewInitializerPromise = (async () => {\n\t\t\t\tconst userDataSyncStoreClient = await this.createUserDataSyncStoreClient();\n\t\t\t\tif (!userDataSyncStoreClient) {\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\t\t\t\tconst userData = await userDataSyncStoreClient.readResource(SyncResource.Extensions, null);\n\t\t\t\treturn instantiationService.createInstance(ExtensionsPreviewInitializer, userData);\n\t\t\t})();\n\t\t}\n\t\treturn this.extensionsPreviewInitializerPromise;\n\t}\n\n\tprivate async initialize(syncResources: SyncResource[]): Promise<void> {\n\t\tconst userDataSyncStoreClient = await this.createUserDataSyncStoreClient();\n\t\tif (!userDataSyncStoreClient) {\n\t\t\treturn;\n\t\t}\n\n\t\tawait Promises.settled(syncResources.map(async syncResource => {\n\t\t\ttry {\n\t\t\t\tif (this.initialized.includes(syncResource)) {\n\t\t\t\t\tthis.logService.info(`${getSyncAreaLabel(syncResource)} initialized already.`);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tthis.initialized.push(syncResource);\n\t\t\t\tthis.logService.trace(`Initializing ${getSyncAreaLabel(syncResource)}`);\n\t\t\t\tconst initializer = this.createSyncResourceInitializer(syncResource);\n\t\t\t\tconst userData = await userDataSyncStoreClient.readResource(syncResource, syncResource === SyncResource.GlobalState ? this.globalStateUserData : null);\n\t\t\t\tawait initializer.initialize(userData);\n\t\t\t\tthis.logService.info(`Initialized ${getSyncAreaLabel(syncResource)}`);\n\t\t\t} catch (error) {\n\t\t\t\tthis.logService.info(`Error while initializing ${getSyncAreaLabel(syncResource)}`);\n\t\t\t\tthis.logService.error(error);\n\t\t\t}\n\t\t}));\n\t}\n\n\tprivate createSyncResourceInitializer(syncResource: SyncResource): IUserDataSyncResourceInitializer {\n\t\tswitch (syncResource) {\n\t\t\tcase SyncResource.Settings: return new SettingsInitializer(this.fileService, this.userDataProfilesService, this.environmentService, this.logService, this.storageService, this.uriIdentityService);\n\t\t\tcase SyncResource.Keybindings: return new KeybindingsInitializer(this.fileService, this.userDataProfilesService, this.environmentService, this.logService, this.storageService, this.uriIdentityService);\n\t\t\tcase SyncResource.Tasks: return new TasksInitializer(this.fileService, this.userDataProfilesService, this.environmentService, this.logService, this.storageService, this.uriIdentityService);\n\t\t\tcase SyncResource.Snippets: return new SnippetsInitializer(this.fileService, this.userDataProfilesService, this.environmentService, this.logService, this.storageService, this.uriIdentityService);\n\t\t\tcase SyncResource.GlobalState: return new GlobalStateInitializer(this.storageService, this.fileService, this.userDataProfilesService, this.environmentService, this.logService, this.uriIdentityService);\n\t\t}\n\t\tthrow new Error(`Cannot create initializer for ${syncResource}`);\n\t}\n\n}\n\nclass ExtensionsPreviewInitializer extends AbstractExtensionsInitializer {\n\n\tprivate previewPromise: Promise<IExtensionsInitializerPreviewResult | null> | undefined;\n\tprivate preview: IExtensionsInitializerPreviewResult | null = null;\n\n\tconstructor(\n\t\tprivate readonly extensionsData: IUserData,\n\t\t@IExtensionManagementService extensionManagementService: IExtensionManagementService,\n\t\t@IIgnoredExtensionsManagementService ignoredExtensionsManagementService: IIgnoredExtensionsManagementService,\n\t\t@IFileService fileService: IFileService,\n\t\t@IUserDataProfilesService userDataProfilesService: IUserDataProfilesService,\n\t\t@IEnvironmentService environmentService: IEnvironmentService,\n\t\t@IUserDataSyncLogService logService: IUserDataSyncLogService,\n\t\t@IStorageService storageService: IStorageService,\n\t\t@IUriIdentityService uriIdentityService: IUriIdentityService,\n\t) {\n\t\tsuper(extensionManagementService, ignoredExtensionsManagementService, fileService, userDataProfilesService, environmentService, logService, storageService, uriIdentityService);\n\t}\n\n\tgetPreview(): Promise<IExtensionsInitializerPreviewResult | null> {\n\t\tif (!this.previewPromise) {\n\t\t\tthis.previewPromise = super.initialize(this.extensionsData).then(() => this.preview);\n\t\t}\n\t\treturn this.previewPromise;\n\t}\n\n\toverride initialize(): Promise<void> {\n\t\tthrow new Error('should not be called directly');\n\t}\n\n\tprotected override async doInitialize(remoteUserData: IRemoteUserData): Promise<void> {\n\t\tconst remoteExtensions = await this.parseExtensions(remoteUserData);\n\t\tif (!remoteExtensions) {\n\t\t\tthis.logService.info('Skipping initializing extensions because remote extensions does not exist.');\n\t\t\treturn;\n\t\t}\n\t\tconst installedExtensions = await this.extensionManagementService.getInstalled();\n\t\tthis.preview = this.generatePreview(remoteExtensions, installedExtensions);\n\t}\n}\n\nclass InstalledExtensionsInitializer implements IUserDataSyncResourceInitializer {\n\n\tconstructor(\n\t\tprivate readonly extensionsPreviewInitializer: ExtensionsPreviewInitializer,\n\t\t@IGlobalExtensionEnablementService private readonly extensionEnablementService: IGlobalExtensionEnablementService,\n\t\t@IExtensionStorageService private readonly extensionStorageService: IExtensionStorageService,\n\t\t@IUserDataSyncLogService private readonly logService: IUserDataSyncLogService,\n\t) {\n\t}\n\n\tasync initialize(): Promise<void> {\n\t\tconst preview = await this.extensionsPreviewInitializer.getPreview();\n\t\tif (!preview) {\n\t\t\treturn;\n\t\t}\n\n\t\t// 1. Initialise already installed extensions state\n\t\tfor (const installedExtension of preview.installedExtensions) {\n\t\t\tconst syncExtension = preview.remoteExtensions.find(({ identifier }) => areSameExtensions(identifier, installedExtension.identifier));\n\t\t\tif (syncExtension?.state) {\n\t\t\t\tconst extensionState = this.extensionStorageService.getExtensionState(installedExtension, true) || {};\n\t\t\t\tObject.keys(syncExtension.state).forEach(key => extensionState[key] = syncExtension.state![key]);\n\t\t\t\tthis.extensionStorageService.setExtensionState(installedExtension, extensionState, true);\n\t\t\t}\n\t\t}\n\n\t\t// 2. Initialise extensions enablement\n\t\tif (preview.disabledExtensions.length) {\n\t\t\tfor (const identifier of preview.disabledExtensions) {\n\t\t\t\tthis.logService.trace(`Disabling extension...`, identifier.id);\n\t\t\t\tawait this.extensionEnablementService.disableExtension(identifier);\n\t\t\t\tthis.logService.info(`Disabling extension`, identifier.id);\n\t\t\t}\n\t\t}\n\t}\n}\n\nclass NewExtensionsInitializer implements IUserDataSyncResourceInitializer {\n\n\tconstructor(\n\t\tprivate readonly extensionsPreviewInitializer: ExtensionsPreviewInitializer,\n\t\t@IExtensionService private readonly extensionService: IExtensionService,\n\t\t@IExtensionStorageService private readonly extensionStorageService: IExtensionStorageService,\n\t\t@IExtensionGalleryService private readonly galleryService: IExtensionGalleryService,\n\t\t@IExtensionManagementService private readonly extensionManagementService: IExtensionManagementService,\n\t\t@IUserDataSyncLogService private readonly logService: IUserDataSyncLogService,\n\t) {\n\t}\n\n\tasync initialize(): Promise<void> {\n\t\tconst preview = await this.extensionsPreviewInitializer.getPreview();\n\t\tif (!preview) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst newlyEnabledExtensions: ILocalExtension[] = [];\n\t\tconst targetPlatform = await this.extensionManagementService.getTargetPlatform();\n\t\tconst galleryExtensions = await this.galleryService.getExtensions(preview.newExtensions, { targetPlatform, compatible: true }, CancellationToken.None);\n\t\tfor (const galleryExtension of galleryExtensions) {\n\t\t\ttry {\n\t\t\t\tconst extensionToSync = preview.remoteExtensions.find(({ identifier }) => areSameExtensions(identifier, galleryExtension.identifier));\n\t\t\t\tif (!extensionToSync) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tif (extensionToSync.state) {\n\t\t\t\t\tthis.extensionStorageService.setExtensionState(galleryExtension, extensionToSync.state, true);\n\t\t\t\t}\n\t\t\t\tthis.logService.trace(`Installing extension...`, galleryExtension.identifier.id);\n\t\t\t\tconst local = await this.extensionManagementService.installFromGallery(galleryExtension, {\n\t\t\t\t\tisMachineScoped: false, /* set isMachineScoped to prevent install and sync dialog in web */\n\t\t\t\t\tdonotIncludePackAndDependencies: true,\n\t\t\t\t\tinstallGivenVersion: !!extensionToSync.version,\n\t\t\t\t\tinstallPreReleaseVersion: extensionToSync.preRelease,\n\t\t\t\t\tcontext: { [EXTENSION_INSTALL_SKIP_PUBLISHER_TRUST_CONTEXT]: true }\n\t\t\t\t});\n\t\t\t\tif (!preview.disabledExtensions.some(identifier => areSameExtensions(identifier, galleryExtension.identifier))) {\n\t\t\t\t\tnewlyEnabledExtensions.push(local);\n\t\t\t\t}\n\t\t\t\tthis.logService.info(`Installed extension.`, galleryExtension.identifier.id);\n\t\t\t} catch (error) {\n\t\t\t\tthis.logService.error(error);\n\t\t\t}\n\t\t}\n\n\t\tconst canEnabledExtensions = newlyEnabledExtensions.filter(e => this.extensionService.canAddExtension(toExtensionDescription(e)));\n\t\tif (!(await this.areExtensionsRunning(canEnabledExtensions))) {\n\t\t\tawait new Promise<void>((c, e) => {\n\t\t\t\tconst disposable = this.extensionService.onDidChangeExtensions(async () => {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tif (await this.areExtensionsRunning(canEnabledExtensions)) {\n\t\t\t\t\t\t\tdisposable.dispose();\n\t\t\t\t\t\t\tc();\n\t\t\t\t\t\t}\n\t\t\t\t\t} catch (error) {\n\t\t\t\t\t\te(error);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\t}\n\n\tprivate async areExtensionsRunning(extensions: ILocalExtension[]): Promise<boolean> {\n\t\tawait this.extensionService.whenInstalledExtensionsRegistered();\n\t\tconst runningExtensions = this.extensionService.extensions;\n\t\treturn extensions.every(e => runningExtensions.some(r => areSameExtensions({ id: r.identifier.value }, e.identifier)));\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { IStorageService, StorageScope } from '../../../../platform/storage/common/storage.js';\nimport { AbstractExtensionsInitializer, IExtensionsInitializerPreviewResult } from '../../../../platform/userDataSync/common/extensionsSync.js';\nimport { GlobalStateInitializer, UserDataSyncStoreTypeSynchronizer } from '../../../../platform/userDataSync/common/globalStateSync.js';\nimport { KeybindingsInitializer } from '../../../../platform/userDataSync/common/keybindingsSync.js';\nimport { SettingsInitializer } from '../../../../platform/userDataSync/common/settingsSync.js';\nimport { SnippetsInitializer } from '../../../../platform/userDataSync/common/snippetsSync.js';\nimport { IFileService } from '../../../../platform/files/common/files.js';\nimport { IInstantiationService } from '../../../../platform/instantiation/common/instantiation.js';\nimport { ILogService } from '../../../../platform/log/common/log.js';\nimport { UserDataSyncStoreClient } from '../../../../platform/userDataSync/common/userDataSyncStoreService.js';\nimport { IProductService } from '../../../../platform/product/common/productService.js';\nimport { IRequestService } from '../../../../platform/request/common/request.js';\nimport { IRemoteUserData, IUserData, IUserDataSyncResourceInitializer, IUserDataSyncLogService, IUserDataSyncStoreManagementService, SyncResource } from '../../../../platform/userDataSync/common/userDataSync.js';\nimport { AuthenticationSessionInfo, getCurrentAuthenticationSessionInfo } from '../../authentication/browser/authenticationService.js';\nimport { getSyncAreaLabel } from '../common/userDataSync.js';\nimport { isWeb } from '../../../../base/common/platform.js';\nimport { Barrier, Promises } from '../../../../base/common/async.js';\nimport { EXTENSION_INSTALL_SKIP_PUBLISHER_TRUST_CONTEXT, IExtensionGalleryService, IExtensionManagementService, IGlobalExtensionEnablementService, ILocalExtension } from '../../../../platform/extensionManagement/common/extensionManagement.js';\nimport { IEnvironmentService } from '../../../../platform/environment/common/environment.js';\nimport { IExtensionService, toExtensionDescription } from '../../extensions/common/extensions.js';\nimport { areSameExtensions } from '../../../../platform/extensionManagement/common/extensionManagementUtil.js';\nimport { IIgnoredExtensionsManagementService } from '../../../../platform/userDataSync/common/ignoredExtensions.js';\nimport { DisposableStore } from '../../../../base/common/lifecycle.js';\nimport { isEqual } from '../../../../base/common/resources.js';\nimport { CancellationToken } from '../../../../base/common/cancellation.js';\nimport { IUriIdentityService } from '../../../../platform/uriIdentity/common/uriIdentity.js';\nimport { IExtensionStorageService } from '../../../../platform/extensionManagement/common/extensionStorage.js';\nimport { TasksInitializer } from '../../../../platform/userDataSync/common/tasksSync.js';\nimport { IUserDataProfilesService } from '../../../../platform/userDataProfile/common/userDataProfile.js';\nimport { IBrowserWorkbenchEnvironmentService } from '../../environment/browser/environmentService.js';\nimport { IUserDataInitializer } from '../../userData/browser/userDataInit.js';\nimport { ISecretStorageService } from '../../../../platform/secrets/common/secrets.js';\n\nexport class UserDataSyncInitializer implements IUserDataInitializer {\n\n\t_serviceBrand: undefined;\n\n\tprivate readonly initialized: SyncResource[] = [];\n\tprivate readonly initializationFinished = new Barrier();\n\tprivate globalStateUserData: IUserData | null = null;\n\n\tconstructor(\n\t\t@IBrowserWorkbenchEnvironmentService private readonly environmentService: IBrowserWorkbenchEnvironmentService,\n\t\t@ISecretStorageService private readonly secretStorageService: ISecretStorageService,\n\t\t@IUserDataSyncStoreManagementService private readonly userDataSyncStoreManagementService: IUserDataSyncStoreManagementService,\n\t\t@IFileService private readonly fileService: IFileService,\n\t\t@IUserDataProfilesService private readonly userDataProfilesService: IUserDataProfilesService,\n\t\t@IStorageService private readonly storageService: IStorageService,\n\t\t@IProductService private readonly productService: IProductService,\n\t\t@IRequestService private readonly requestService: IRequestService,\n\t\t@ILogService private readonly logService: ILogService,\n\t\t@IUriIdentityService private readonly uriIdentityService: IUriIdentityService,\n\t) {\n\t\tthis.createUserDataSyncStoreClient().then(userDataSyncStoreClient => {\n\t\t\tif (!userDataSyncStoreClient) {\n\t\t\t\tthis.initializationFinished.open();\n\t\t\t}\n\t\t});\n\t}\n\n\tprivate _userDataSyncStoreClientPromise: Promise<UserDataSyncStoreClient | undefined> | undefined;\n\tprivate createUserDataSyncStoreClient(): Promise<UserDataSyncStoreClient | undefined> {\n\t\tif (!this._userDataSyncStoreClientPromise) {\n\t\t\tthis._userDataSyncStoreClientPromise = (async (): Promise<UserDataSyncStoreClient | undefined> => {\n\t\t\t\ttry {\n\t\t\t\t\tif (!isWeb) {\n\t\t\t\t\t\tthis.logService.trace(`Skipping initializing user data in desktop`);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!this.storageService.isNew(StorageScope.APPLICATION)) {\n\t\t\t\t\t\tthis.logService.trace(`Skipping initializing user data as application was opened before`);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!this.storageService.isNew(StorageScope.WORKSPACE)) {\n\t\t\t\t\t\tthis.logService.trace(`Skipping initializing user data as workspace was opened before`);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (this.environmentService.options?.settingsSyncOptions?.authenticationProvider && !this.environmentService.options.settingsSyncOptions.enabled) {\n\t\t\t\t\t\tthis.logService.trace(`Skipping initializing user data as settings sync is disabled`);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tlet authenticationSession;\n\t\t\t\t\ttry {\n\t\t\t\t\t\tauthenticationSession = await getCurrentAuthenticationSessionInfo(this.secretStorageService, this.productService);\n\t\t\t\t\t} catch (error) {\n\t\t\t\t\t\tthis.logService.error(error);\n\t\t\t\t\t}\n\t\t\t\t\tif (!authenticationSession) {\n\t\t\t\t\t\tthis.logService.trace(`Skipping initializing user data as authentication session is not set`);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tawait this.initializeUserDataSyncStore(authenticationSession);\n\n\t\t\t\t\tconst userDataSyncStore = this.userDataSyncStoreManagementService.userDataSyncStore;\n\t\t\t\t\tif (!userDataSyncStore) {\n\t\t\t\t\t\tthis.logService.trace(`Skipping initializing user data as sync service is not provided`);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tconst userDataSyncStoreClient = new UserDataSyncStoreClient(userDataSyncStore.url, this.productService, this.requestService, this.logService, this.environmentService, this.fileService, this.storageService);\n\t\t\t\t\tuserDataSyncStoreClient.setAuthToken(authenticationSession.accessToken, authenticationSession.providerId);\n\n\t\t\t\t\tconst manifest = await userDataSyncStoreClient.manifest(null);\n\t\t\t\t\tif (manifest === null) {\n\t\t\t\t\t\tuserDataSyncStoreClient.dispose();\n\t\t\t\t\t\tthis.logService.trace(`Skipping initializing user data as there is no data`);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.logService.info(`Using settings sync service ${userDataSyncStore.url.toString()} for initialization`);\n\t\t\t\t\treturn userDataSyncStoreClient;\n\n\t\t\t\t} catch (error) {\n\t\t\t\t\tthis.logService.error(error);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t})();\n\t\t}\n\n\t\treturn this._userDataSyncStoreClientPromise;\n\t}\n\n\tprivate async initializeUserDataSyncStore(authenticationSession: AuthenticationSessionInfo): Promise<void> {\n\t\tconst userDataSyncStore = this.userDataSyncStoreManagementService.userDataSyncStore;\n\t\tif (!userDataSyncStore?.canSwitch) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst disposables = new DisposableStore();\n\t\ttry {\n\t\t\tconst userDataSyncStoreClient = disposables.add(new UserDataSyncStoreClient(userDataSyncStore.url, this.productService, this.requestService, this.logService, this.environmentService, this.fileService, this.storageService));\n\t\t\tuserDataSyncStoreClient.setAuthToken(authenticationSession.accessToken, authenticationSession.providerId);\n\n\t\t\t// Cache global state data for global state initialization\n\t\t\tthis.globalStateUserData = await userDataSyncStoreClient.readResource(SyncResource.GlobalState, null);\n\n\t\t\tif (this.globalStateUserData) {\n\t\t\t\tconst userDataSyncStoreType = new UserDataSyncStoreTypeSynchronizer(userDataSyncStoreClient, this.storageService, this.environmentService, this.fileService, this.logService).getSyncStoreType(this.globalStateUserData);\n\t\t\t\tif (userDataSyncStoreType) {\n\t\t\t\t\tawait this.userDataSyncStoreManagementService.switch(userDataSyncStoreType);\n\n\t\t\t\t\t// Unset cached global state data if urls are changed\n\t\t\t\t\tif (!isEqual(userDataSyncStore.url, this.userDataSyncStoreManagementService.userDataSyncStore?.url)) {\n\t\t\t\t\t\tthis.logService.info('Switched settings sync store');\n\t\t\t\t\t\tthis.globalStateUserData = null;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t} finally {\n\t\t\tdisposables.dispose();\n\t\t}\n\t}\n\n\tasync whenInitializationFinished(): Promise<void> {\n\t\tawait this.initializationFinished.wait();\n\t}\n\n\tasync requiresInitialization(): Promise<boolean> {\n\t\tthis.logService.trace(`UserDataInitializationService#requiresInitialization`);\n\t\tconst userDataSyncStoreClient = await this.createUserDataSyncStoreClient();\n\t\treturn !!userDataSyncStoreClient;\n\t}\n\n\tasync initializeRequiredResources(): Promise<void> {\n\t\tthis.logService.trace(`UserDataInitializationService#initializeRequiredResources`);\n\t\treturn this.initialize([SyncResource.Settings, SyncResource.GlobalState]);\n\t}\n\n\tasync initializeOtherResources(instantiationService: IInstantiationService): Promise<void> {\n\t\ttry {\n\t\t\tthis.logService.trace(`UserDataInitializationService#initializeOtherResources`);\n\t\t\tawait Promise.allSettled([this.initialize([SyncResource.Keybindings, SyncResource.Snippets, SyncResource.Tasks]), this.initializeExtensions(instantiationService)]);\n\t\t} finally {\n\t\t\tthis.initializationFinished.open();\n\t\t}\n\t}\n\n\tprivate async initializeExtensions(instantiationService: IInstantiationService): Promise<void> {\n\t\ttry {\n\t\t\tawait Promise.all([this.initializeInstalledExtensions(instantiationService), this.initializeNewExtensions(instantiationService)]);\n\t\t} finally {\n\t\t\tthis.initialized.push(SyncResource.Extensions);\n\t\t}\n\t}\n\n\tprivate initializeInstalledExtensionsPromise: Promise<void> | undefined;\n\tasync initializeInstalledExtensions(instantiationService: IInstantiationService): Promise<void> {\n\t\tif (!this.initializeInstalledExtensionsPromise) {\n\t\t\tthis.initializeInstalledExtensionsPromise = (async () => {\n\t\t\t\tthis.logService.trace(`UserDataInitializationService#initializeInstalledExtensions`);\n\t\t\t\tconst extensionsPreviewInitializer = await this.getExtensionsPreviewInitializer(instantiationService);\n\t\t\t\tif (extensionsPreviewInitializer) {\n\t\t\t\t\tawait instantiationService.createInstance(InstalledExtensionsInitializer, extensionsPreviewInitializer).initialize();\n\t\t\t\t}\n\t\t\t})();\n\t\t}\n\t\treturn this.initializeInstalledExtensionsPromise;\n\t}\n\n\tprivate initializeNewExtensionsPromise: Promise<void> | undefined;\n\tprivate async initializeNewExtensions(instantiationService: IInstantiationService): Promise<void> {\n\t\tif (!this.initializeNewExtensionsPromise) {\n\t\t\tthis.initializeNewExtensionsPromise = (async () => {\n\t\t\t\tthis.logService.trace(`UserDataInitializationService#initializeNewExtensions`);\n\t\t\t\tconst extensionsPreviewInitializer = await this.getExtensionsPreviewInitializer(instantiationService);\n\t\t\t\tif (extensionsPreviewInitializer) {\n\t\t\t\t\tawait instantiationService.createInstance(NewExtensionsInitializer, extensionsPreviewInitializer).initialize();\n\t\t\t\t}\n\t\t\t})();\n\t\t}\n\t\treturn this.initializeNewExtensionsPromise;\n\t}\n\n\tprivate extensionsPreviewInitializerPromise: Promise<ExtensionsPreviewInitializer | null> | undefined;\n\tprivate getExtensionsPreviewInitializer(instantiationService: IInstantiationService): Promise<ExtensionsPreviewInitializer | null> {\n\t\tif (!this.extensionsPreviewInitializerPromise) {\n\t\t\tthis.extensionsPreviewInitializerPromise = (async () => {\n\t\t\t\tconst userDataSyncStoreClient = await this.createUserDataSyncStoreClient();\n\t\t\t\tif (!userDataSyncStoreClient) {\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\t\t\t\tconst userData = await userDataSyncStoreClient.readResource(SyncResource.Extensions, null);\n\t\t\t\treturn instantiationService.createInstance(ExtensionsPreviewInitializer, userData);\n\t\t\t})();\n\t\t}\n\t\treturn this.extensionsPreviewInitializerPromise;\n\t}\n\n\tprivate async initialize(syncResources: SyncResource[]): Promise<void> {\n\t\tconst userDataSyncStoreClient = await this.createUserDataSyncStoreClient();\n\t\tif (!userDataSyncStoreClient) {\n\t\t\treturn;\n\t\t}\n\n\t\tawait Promises.settled(syncResources.map(async syncResource => {\n\t\t\ttry {\n\t\t\t\tif (this.initialized.includes(syncResource)) {\n\t\t\t\t\tthis.logService.info(`${getSyncAreaLabel(syncResource)} initialized already.`);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tthis.initialized.push(syncResource);\n\t\t\t\tthis.logService.trace(`Initializing ${getSyncAreaLabel(syncResource)}`);\n\t\t\t\tconst initializer = this.createSyncResourceInitializer(syncResource);\n\t\t\t\tconst userData = await userDataSyncStoreClient.readResource(syncResource, syncResource === SyncResource.GlobalState ? this.globalStateUserData : null);\n\t\t\t\tawait initializer.initialize(userData);\n\t\t\t\tthis.logService.info(`Initialized ${getSyncAreaLabel(syncResource)}`);\n\t\t\t} catch (error) {\n\t\t\t\tthis.logService.info(`Error while initializing ${getSyncAreaLabel(syncResource)}`);\n\t\t\t\tthis.logService.error(error);\n\t\t\t}\n\t\t}));\n\t}\n\n\tprivate createSyncResourceInitializer(syncResource: SyncResource): IUserDataSyncResourceInitializer {\n\t\tswitch (syncResource) {\n\t\t\tcase SyncResource.Settings: return new SettingsInitializer(this.fileService, this.userDataProfilesService, this.environmentService, this.logService, this.storageService, this.uriIdentityService);\n\t\t\tcase SyncResource.Keybindings: return new KeybindingsInitializer(this.fileService, this.userDataProfilesService, this.environmentService, this.logService, this.storageService, this.uriIdentityService);\n\t\t\tcase SyncResource.Tasks: return new TasksInitializer(this.fileService, this.userDataProfilesService, this.environmentService, this.logService, this.storageService, this.uriIdentityService);\n\t\t\tcase SyncResource.Snippets: return new SnippetsInitializer(this.fileService, this.userDataProfilesService, this.environmentService, this.logService, this.storageService, this.uriIdentityService);\n\t\t\tcase SyncResource.GlobalState: return new GlobalStateInitializer(this.storageService, this.fileService, this.userDataProfilesService, this.environmentService, this.logService, this.uriIdentityService);\n\t\t}\n\t\tthrow new Error(`Cannot create initializer for ${syncResource}`);\n\t}\n\n}\n\nclass ExtensionsPreviewInitializer extends AbstractExtensionsInitializer {\n\n\tprivate previewPromise: Promise<IExtensionsInitializerPreviewResult | null> | undefined;\n\tprivate preview: IExtensionsInitializerPreviewResult | null = null;\n\n\tconstructor(\n\t\tprivate readonly extensionsData: IUserData,\n\t\t@IExtensionManagementService extensionManagementService: IExtensionManagementService,\n\t\t@IIgnoredExtensionsManagementService ignoredExtensionsManagementService: IIgnoredExtensionsManagementService,\n\t\t@IFileService fileService: IFileService,\n\t\t@IUserDataProfilesService userDataProfilesService: IUserDataProfilesService,\n\t\t@IEnvironmentService environmentService: IEnvironmentService,\n\t\t@IUserDataSyncLogService logService: IUserDataSyncLogService,\n\t\t@IStorageService storageService: IStorageService,\n\t\t@IUriIdentityService uriIdentityService: IUriIdentityService,\n\t) {\n\t\tsuper(extensionManagementService, ignoredExtensionsManagementService, fileService, userDataProfilesService, environmentService, logService, storageService, uriIdentityService);\n\t}\n\n\tgetPreview(): Promise<IExtensionsInitializerPreviewResult | null> {\n\t\tif (!this.previewPromise) {\n\t\t\tthis.previewPromise = super.initialize(this.extensionsData).then(() => this.preview);\n\t\t}\n\t\treturn this.previewPromise;\n\t}\n\n\toverride initialize(): Promise<void> {\n\t\tthrow new Error('should not be called directly');\n\t}\n\n\tprotected override async doInitialize(remoteUserData: IRemoteUserData): Promise<void> {\n\t\tconst remoteExtensions = await this.parseExtensions(remoteUserData);\n\t\tif (!remoteExtensions) {\n\t\t\tthis.logService.info('Skipping initializing extensions because remote extensions does not exist.');\n\t\t\treturn;\n\t\t}\n\t\tconst installedExtensions = await this.extensionManagementService.getInstalled();\n\t\tthis.preview = this.generatePreview(remoteExtensions, installedExtensions);\n\t}\n}\n\nclass InstalledExtensionsInitializer implements IUserDataSyncResourceInitializer {\n\n\tconstructor(\n\t\tprivate readonly extensionsPreviewInitializer: ExtensionsPreviewInitializer,\n\t\t@IGlobalExtensionEnablementService private readonly extensionEnablementService: IGlobalExtensionEnablementService,\n\t\t@IExtensionStorageService private readonly extensionStorageService: IExtensionStorageService,\n\t\t@IUserDataSyncLogService private readonly logService: IUserDataSyncLogService,\n\t) {\n\t}\n\n\tasync initialize(): Promise<void> {\n\t\tconst preview = await this.extensionsPreviewInitializer.getPreview();\n\t\tif (!preview) {\n\t\t\treturn;\n\t\t}\n\n\t\t// 1. Initialise already installed extensions state\n\t\tfor (const installedExtension of preview.installedExtensions) {\n\t\t\tconst syncExtension = preview.remoteExtensions.find(({ identifier }) => areSameExtensions(identifier, installedExtension.identifier));\n\t\t\tif (syncExtension?.state) {\n\t\t\t\tconst extensionState = this.extensionStorageService.getExtensionState(installedExtension, true) || {};\n\t\t\t\tObject.keys(syncExtension.state).forEach(key => extensionState[key] = syncExtension.state![key]);\n\t\t\t\tthis.extensionStorageService.setExtensionState(installedExtension, extensionState, true);\n\t\t\t}\n\t\t}\n\n\t\t// 2. Initialise extensions enablement\n\t\tif (preview.disabledExtensions.length) {\n\t\t\tfor (const identifier of preview.disabledExtensions) {\n\t\t\t\tthis.logService.trace(`Disabling extension...`, identifier.id);\n\t\t\t\tawait this.extensionEnablementService.disableExtension(identifier);\n\t\t\t\tthis.logService.info(`Disabling extension`, identifier.id);\n\t\t\t}\n\t\t}\n\t}\n}\n\nclass NewExtensionsInitializer implements IUserDataSyncResourceInitializer {\n\n\tconstructor(\n\t\tprivate readonly extensionsPreviewInitializer: ExtensionsPreviewInitializer,\n\t\t@IExtensionService private readonly extensionService: IExtensionService,\n\t\t@IExtensionStorageService private readonly extensionStorageService: IExtensionStorageService,\n\t\t@IExtensionGalleryService private readonly galleryService: IExtensionGalleryService,\n\t\t@IExtensionManagementService private readonly extensionManagementService: IExtensionManagementService,\n\t\t@IUserDataSyncLogService private readonly logService: IUserDataSyncLogService,\n\t) {\n\t}\n\n\tasync initialize(): Promise<void> {\n\t\tconst preview = await this.extensionsPreviewInitializer.getPreview();\n\t\tif (!preview) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst newlyEnabledExtensions: ILocalExtension[] = [];\n\t\tconst targetPlatform = await this.extensionManagementService.getTargetPlatform();\n\t\tconst galleryExtensions = await this.galleryService.getExtensions(preview.newExtensions, { targetPlatform, compatible: true }, CancellationToken.None);\n\t\tfor (const galleryExtension of galleryExtensions) {\n\t\t\ttry {\n\t\t\t\tconst extensionToSync = preview.remoteExtensions.find(({ identifier }) => areSameExtensions(identifier, galleryExtension.identifier));\n\t\t\t\tif (!extensionToSync) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tif (extensionToSync.state) {\n\t\t\t\t\tthis.extensionStorageService.setExtensionState(galleryExtension, extensionToSync.state, true);\n\t\t\t\t}\n\t\t\t\tthis.logService.trace(`Installing extension...`, galleryExtension.identifier.id);\n\t\t\t\tconst local = await this.extensionManagementService.installFromGallery(galleryExtension, {\n\t\t\t\t\tisMachineScoped: false, /* set isMachineScoped to prevent install and sync dialog in web */\n\t\t\t\t\tdonotIncludePackAndDependencies: true,\n\t\t\t\t\tinstallGivenVersion: !!extensionToSync.version,\n\t\t\t\t\tinstallPreReleaseVersion: extensionToSync.preRelease,\n\t\t\t\t\tcontext: { [EXTENSION_INSTALL_SKIP_PUBLISHER_TRUST_CONTEXT]: true }\n\t\t\t\t});\n\t\t\t\tif (!preview.disabledExtensions.some(identifier => areSameExtensions(identifier, galleryExtension.identifier))) {\n\t\t\t\t\tnewlyEnabledExtensions.push(local);\n\t\t\t\t}\n\t\t\t\tthis.logService.info(`Installed extension.`, galleryExtension.identifier.id);\n\t\t\t} catch (error) {\n\t\t\t\tthis.logService.error(error);\n\t\t\t}\n\t\t}\n\n\t\tconst canEnabledExtensions = newlyEnabledExtensions.filter(e => this.extensionService.canAddExtension(toExtensionDescription(e)));\n\t\tif (!(await this.areExtensionsRunning(canEnabledExtensions))) {\n\t\t\tawait new Promise<void>((c, e) => {\n\t\t\t\tconst disposable = this.extensionService.onDidChangeExtensions(async () => {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tif (await this.areExtensionsRunning(canEnabledExtensions)) {\n\t\t\t\t\t\t\tdisposable.dispose();\n\t\t\t\t\t\t\tc();\n\t\t\t\t\t\t}\n\t\t\t\t\t} catch (error) {\n\t\t\t\t\t\te(error);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\t}\n\n\tprivate async areExtensionsRunning(extensions: ILocalExtension[]): Promise<boolean> {\n\t\tawait this.extensionService.whenInstalledExtensionsRegistered();\n\t\tconst runningExtensions = this.extensionService.extensions;\n\t\treturn extensions.every(e => runningExtensions.some(r => areSameExtensions({ id: r.identifier.value }, e.identifier)));\n\t}\n}\n"]}