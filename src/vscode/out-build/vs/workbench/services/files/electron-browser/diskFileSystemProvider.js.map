{"version":3,"sources":["vs/workbench/services/files/electron-browser/diskFileSystemProvider.ts"],"names":[],"mappings":"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","file":"diskFileSystemProvider.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { localize } from '../../../../nls.js';\nimport { Event } from '../../../../base/common/event.js';\nimport { isLinux } from '../../../../base/common/platform.js';\nimport { FileSystemProviderCapabilities, IFileDeleteOptions, IStat, FileType, IFileReadStreamOptions, IFileWriteOptions, IFileOpenOptions, IFileOverwriteOptions, IFileSystemProviderWithFileReadWriteCapability, IFileSystemProviderWithOpenReadWriteCloseCapability, IFileSystemProviderWithFileReadStreamCapability, IFileSystemProviderWithFileFolderCopyCapability, IFileSystemProviderWithFileAtomicReadCapability, IFileAtomicReadOptions, IFileSystemProviderWithFileCloneCapability, IFileChange } from '../../../../platform/files/common/files.js';\nimport { AbstractDiskFileSystemProvider } from '../../../../platform/files/common/diskFileSystemProvider.js';\nimport { IMainProcessService } from '../../../../platform/ipc/common/mainProcessService.js';\nimport { CancellationToken } from '../../../../base/common/cancellation.js';\nimport { ReadableStreamEvents } from '../../../../base/common/stream.js';\nimport { URI } from '../../../../base/common/uri.js';\nimport { DiskFileSystemProviderClient, LOCAL_FILE_SYSTEM_CHANNEL_NAME } from '../../../../platform/files/common/diskFileSystemProviderClient.js';\nimport { ILogMessage, AbstractUniversalWatcherClient } from '../../../../platform/files/common/watcher.js';\nimport { UniversalWatcherClient } from './watcherClient.js';\nimport { ILoggerService, ILogService } from '../../../../platform/log/common/log.js';\nimport { IUtilityProcessWorkerWorkbenchService } from '../../utilityProcess/electron-browser/utilityProcessWorkerWorkbenchService.js';\nimport { LogService } from '../../../../platform/log/common/logService.js';\n\n/**\n * A sandbox ready disk file system provider that delegates almost all calls\n * to the main process via `DiskFileSystemProviderServer` except for recursive\n * file watching that is done via shared process workers due to CPU intensity.\n */\nexport class DiskFileSystemProvider extends AbstractDiskFileSystemProvider implements\n\tIFileSystemProviderWithFileReadWriteCapability,\n\tIFileSystemProviderWithOpenReadWriteCloseCapability,\n\tIFileSystemProviderWithFileReadStreamCapability,\n\tIFileSystemProviderWithFileFolderCopyCapability,\n\tIFileSystemProviderWithFileAtomicReadCapability,\n\tIFileSystemProviderWithFileCloneCapability {\n\n\tprivate readonly provider: DiskFileSystemProviderClient;\n\n\tconstructor(\n\t\tmainProcessService: IMainProcessService,\n\t\tprivate readonly utilityProcessWorkerWorkbenchService: IUtilityProcessWorkerWorkbenchService,\n\t\tlogService: ILogService,\n\t\tprivate readonly loggerService: ILoggerService\n\t) {\n\t\tsuper(logService, { watcher: { forceUniversal: true /* send all requests to universal watcher process */ } });\n\n\t\tthis.provider = this._register(new DiskFileSystemProviderClient(mainProcessService.getChannel(LOCAL_FILE_SYSTEM_CHANNEL_NAME), { pathCaseSensitive: isLinux, trash: true }));\n\n\t\tthis.registerListeners();\n\t}\n\n\tprivate registerListeners(): void {\n\n\t\t// Forward events from the embedded provider\n\t\tthis._register(this.provider.onDidChangeFile(changes => this._onDidChangeFile.fire(changes)));\n\t\tthis._register(this.provider.onDidWatchError(error => this._onDidWatchError.fire(error)));\n\t}\n\n\t//#region File Capabilities\n\n\tget onDidChangeCapabilities(): Event<void> { return this.provider.onDidChangeCapabilities; }\n\n\tget capabilities(): FileSystemProviderCapabilities { return this.provider.capabilities; }\n\n\t//#endregion\n\n\t//#region File Metadata Resolving\n\n\tstat(resource: URI): Promise<IStat> {\n\t\treturn this.provider.stat(resource);\n\t}\n\n\trealpath(resource: URI): Promise<string> {\n\t\treturn this.provider.realpath(resource);\n\t}\n\n\treaddir(resource: URI): Promise<[string, FileType][]> {\n\t\treturn this.provider.readdir(resource);\n\t}\n\n\t//#endregion\n\n\t//#region File Reading/Writing\n\n\treadFile(resource: URI, opts?: IFileAtomicReadOptions): Promise<Uint8Array> {\n\t\treturn this.provider.readFile(resource, opts);\n\t}\n\n\treadFileStream(resource: URI, opts: IFileReadStreamOptions, token: CancellationToken): ReadableStreamEvents<Uint8Array> {\n\t\treturn this.provider.readFileStream(resource, opts, token);\n\t}\n\n\twriteFile(resource: URI, content: Uint8Array, opts: IFileWriteOptions): Promise<void> {\n\t\treturn this.provider.writeFile(resource, content, opts);\n\t}\n\n\topen(resource: URI, opts: IFileOpenOptions): Promise<number> {\n\t\treturn this.provider.open(resource, opts);\n\t}\n\n\tclose(fd: number): Promise<void> {\n\t\treturn this.provider.close(fd);\n\t}\n\n\tread(fd: number, pos: number, data: Uint8Array, offset: number, length: number): Promise<number> {\n\t\treturn this.provider.read(fd, pos, data, offset, length);\n\t}\n\n\twrite(fd: number, pos: number, data: Uint8Array, offset: number, length: number): Promise<number> {\n\t\treturn this.provider.write(fd, pos, data, offset, length);\n\t}\n\n\t//#endregion\n\n\t//#region Move/Copy/Delete/Create Folder\n\n\tmkdir(resource: URI): Promise<void> {\n\t\treturn this.provider.mkdir(resource);\n\t}\n\n\tdelete(resource: URI, opts: IFileDeleteOptions): Promise<void> {\n\t\treturn this.provider.delete(resource, opts);\n\t}\n\n\trename(from: URI, to: URI, opts: IFileOverwriteOptions): Promise<void> {\n\t\treturn this.provider.rename(from, to, opts);\n\t}\n\n\tcopy(from: URI, to: URI, opts: IFileOverwriteOptions): Promise<void> {\n\t\treturn this.provider.copy(from, to, opts);\n\t}\n\n\t//#endregion\n\n\t//#region Clone File\n\n\tcloneFile(from: URI, to: URI): Promise<void> {\n\t\treturn this.provider.cloneFile(from, to);\n\t}\n\n\t//#endregion\n\n\t//#region File Watching\n\n\tprotected createUniversalWatcher(\n\t\tonChange: (changes: IFileChange[]) => void,\n\t\tonLogMessage: (msg: ILogMessage) => void,\n\t\tverboseLogging: boolean\n\t): AbstractUniversalWatcherClient {\n\t\treturn new UniversalWatcherClient(changes => onChange(changes), msg => onLogMessage(msg), verboseLogging, this.utilityProcessWorkerWorkbenchService);\n\t}\n\n\tprotected createNonRecursiveWatcher(): never {\n\t\tthrow new Error('Method not implemented in sandbox.'); // we never expect this to be called given we set `forceUniversal: true`\n\t}\n\n\tprivate _watcherLogService: ILogService | undefined = undefined;\n\tprivate get watcherLogService(): ILogService {\n\t\tif (!this._watcherLogService) {\n\t\t\tthis._watcherLogService = new LogService(this.loggerService.createLogger('fileWatcher', { name: localize('fileWatcher', \"File Watcher\") }));\n\t\t}\n\n\t\treturn this._watcherLogService;\n\t}\n\n\tprotected override logWatcherMessage(msg: ILogMessage): void {\n\t\tthis.watcherLogService[msg.type](msg.message);\n\n\t\tif (msg.type !== 'trace' && msg.type !== 'debug') {\n\t\t\tsuper.logWatcherMessage(msg); // allow non-verbose log messages in window log\n\t\t}\n\t}\n\n\t//#endregion\n}\n"]}