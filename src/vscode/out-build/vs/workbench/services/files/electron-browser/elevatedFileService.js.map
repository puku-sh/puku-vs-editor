{"version":3,"sources":["vs/workbench/services/files/electron-browser/elevatedFileService.ts"],"names":[],"mappings":"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","file":"elevatedFileService.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { localize } from '../../../../nls.js';\nimport { VSBuffer, VSBufferReadable, VSBufferReadableStream } from '../../../../base/common/buffer.js';\nimport { randomPath } from '../../../../base/common/extpath.js';\nimport { Schemas } from '../../../../base/common/network.js';\nimport { URI } from '../../../../base/common/uri.js';\nimport { IFileService, IFileStatWithMetadata, IWriteFileOptions } from '../../../../platform/files/common/files.js';\nimport { InstantiationType, registerSingleton } from '../../../../platform/instantiation/common/extensions.js';\nimport { INativeHostService } from '../../../../platform/native/common/native.js';\nimport { IWorkspaceTrustRequestService } from '../../../../platform/workspace/common/workspaceTrust.js';\nimport { INativeWorkbenchEnvironmentService } from '../../environment/electron-browser/environmentService.js';\nimport { IElevatedFileService } from '../common/elevatedFileService.js';\nimport { isWindows } from '../../../../base/common/platform.js';\nimport { ILabelService } from '../../../../platform/label/common/label.js';\nexport class NativeElevatedFileService implements IElevatedFileService {\n\n\treadonly _serviceBrand: undefined;\n\n\tconstructor(\n\t\t@INativeHostService private readonly nativeHostService: INativeHostService,\n\t\t@IFileService private readonly fileService: IFileService,\n\t\t@INativeWorkbenchEnvironmentService private readonly environmentService: INativeWorkbenchEnvironmentService,\n\t\t@IWorkspaceTrustRequestService private readonly workspaceTrustRequestService: IWorkspaceTrustRequestService,\n\t\t@ILabelService private readonly labelService: ILabelService\n\t) { }\n\n\tisSupported(resource: URI): boolean {\n\t\t// Saving elevated is currently only supported for local\n\t\t// files for as long as we have no generic support from\n\t\t// the file service\n\t\t// (https://github.com/microsoft/vscode/issues/48659)\n\t\treturn resource.scheme === Schemas.file;\n\t}\n\n\tasync writeFileElevated(resource: URI, value: VSBuffer | VSBufferReadable | VSBufferReadableStream, options?: IWriteFileOptions): Promise<IFileStatWithMetadata> {\n\t\tconst trusted = await this.workspaceTrustRequestService.requestWorkspaceTrust({\n\t\t\tmessage: isWindows ? localize('fileNotTrustedMessageWindows', \"You are about to save '{0}' as admin.\", this.labelService.getUriLabel(resource)) : localize('fileNotTrustedMessagePosix', \"You are about to save '{0}' as super user.\", this.labelService.getUriLabel(resource)),\n\t\t});\n\t\tif (!trusted) {\n\t\t\tthrow new Error(localize('fileNotTrusted', \"Workspace is not trusted.\"));\n\t\t}\n\n\t\tconst source = URI.file(randomPath(this.environmentService.userDataPath, 'code-elevated'));\n\t\ttry {\n\t\t\t// write into a tmp file first\n\t\t\tawait this.fileService.writeFile(source, value, options);\n\n\t\t\t// then sudo prompt copy\n\t\t\tawait this.nativeHostService.writeElevated(source, resource, options);\n\t\t} finally {\n\n\t\t\t// clean up\n\t\t\tawait this.fileService.del(source);\n\t\t}\n\n\t\treturn this.fileService.resolve(resource, { resolveMetadata: true });\n\t}\n}\n\nregisterSingleton(IElevatedFileService, NativeElevatedFileService, InstantiationType.Delayed);\n"]}