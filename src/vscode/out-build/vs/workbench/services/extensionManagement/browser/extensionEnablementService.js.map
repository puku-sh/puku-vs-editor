{"version":3,"sources":["vs/workbench/services/extensionManagement/browser/extensionEnablementService.ts"],"names":[],"mappings":"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","file":"extensionEnablementService.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { localize } from '../../../../nls.js';\nimport { Event, Emitter } from '../../../../base/common/event.js';\nimport { Disposable, toDisposable } from '../../../../base/common/lifecycle.js';\nimport { IExtensionManagementService, IExtensionIdentifier, IGlobalExtensionEnablementService, ENABLED_EXTENSIONS_STORAGE_PATH, DISABLED_EXTENSIONS_STORAGE_PATH, InstallOperation, IAllowedExtensionsService } from '../../../../platform/extensionManagement/common/extensionManagement.js';\nimport { IWorkbenchExtensionEnablementService, EnablementState, IExtensionManagementServerService, IWorkbenchExtensionManagementService, IExtensionManagementServer, ExtensionInstallLocation } from '../common/extensionManagement.js';\nimport { areSameExtensions, BetterMergeId, getExtensionDependencies, isMalicious } from '../../../../platform/extensionManagement/common/extensionManagementUtil.js';\nimport { IWorkspaceContextService, WorkbenchState } from '../../../../platform/workspace/common/workspace.js';\nimport { IStorageService, StorageScope, StorageTarget } from '../../../../platform/storage/common/storage.js';\nimport { IWorkbenchEnvironmentService } from '../../environment/common/environmentService.js';\nimport { ExtensionType, IExtension, isAuthenticationProviderExtension, isLanguagePackExtension, isResolverExtension } from '../../../../platform/extensions/common/extensions.js';\nimport { IConfigurationService } from '../../../../platform/configuration/common/configuration.js';\nimport { InstantiationType, registerSingleton } from '../../../../platform/instantiation/common/extensions.js';\nimport { StorageManager } from '../../../../platform/extensionManagement/common/extensionEnablementService.js';\nimport { webWorkerExtHostConfig, WebWorkerExtHostConfigValue } from '../../extensions/common/extensions.js';\nimport { IUserDataSyncAccountService } from '../../../../platform/userDataSync/common/userDataSyncAccount.js';\nimport { IUserDataSyncEnablementService } from '../../../../platform/userDataSync/common/userDataSync.js';\nimport { ILifecycleService, LifecyclePhase } from '../../lifecycle/common/lifecycle.js';\nimport { INotificationService, NotificationPriority, Severity } from '../../../../platform/notification/common/notification.js';\nimport { IHostService } from '../../host/browser/host.js';\nimport { IExtensionBisectService } from './extensionBisect.js';\nimport { IWorkspaceTrustManagementService, IWorkspaceTrustRequestService } from '../../../../platform/workspace/common/workspaceTrust.js';\nimport { IExtensionManifestPropertiesService } from '../../extensions/common/extensionManifestPropertiesService.js';\nimport { isVirtualWorkspace } from '../../../../platform/workspace/common/virtualWorkspace.js';\nimport { ILogService } from '../../../../platform/log/common/log.js';\nimport { IInstantiationService } from '../../../../platform/instantiation/common/instantiation.js';\nimport { equals } from '../../../../base/common/arrays.js';\nimport { isString } from '../../../../base/common/types.js';\nimport { Delayer } from '../../../../base/common/async.js';\nimport { IProductService } from '../../../../platform/product/common/productService.js';\n\nconst SOURCE = 'IWorkbenchExtensionEnablementService';\n\ntype WorkspaceType = { readonly virtual: boolean; readonly trusted: boolean };\n\nconst EXTENSION_UNIFICATION_SETTING = 'chat.extensionUnification.enabled';\n\nexport class ExtensionEnablementService extends Disposable implements IWorkbenchExtensionEnablementService {\n\n\tdeclare readonly _serviceBrand: undefined;\n\n\tprivate readonly _onEnablementChanged = new Emitter<readonly IExtension[]>();\n\tpublic readonly onEnablementChanged: Event<readonly IExtension[]> = this._onEnablementChanged.event;\n\n\tprotected readonly extensionsManager: ExtensionsManager;\n\tprivate readonly storageManager: StorageManager;\n\tprivate extensionsDisabledExtensions: IExtension[] = [];\n\tprivate readonly delayer = this._register(new Delayer<void>(0));\n\n\t// Extension unification\n\tprivate readonly _completionsExtensionId: string | undefined;\n\tprivate readonly _chatExtensionId: string | undefined;\n\tprivate _extensionUnificationEnabled: boolean;\n\n\tconstructor(\n\t\t@IStorageService private readonly storageService: IStorageService,\n\t\t@IGlobalExtensionEnablementService protected readonly globalExtensionEnablementService: IGlobalExtensionEnablementService,\n\t\t@IWorkspaceContextService private readonly contextService: IWorkspaceContextService,\n\t\t@IWorkbenchEnvironmentService private readonly environmentService: IWorkbenchEnvironmentService,\n\t\t@IExtensionManagementService private readonly extensionManagementService: IExtensionManagementService,\n\t\t@IConfigurationService private readonly configurationService: IConfigurationService,\n\t\t@IExtensionManagementServerService private readonly extensionManagementServerService: IExtensionManagementServerService,\n\t\t@IUserDataSyncEnablementService private readonly userDataSyncEnablementService: IUserDataSyncEnablementService,\n\t\t@IUserDataSyncAccountService private readonly userDataSyncAccountService: IUserDataSyncAccountService,\n\t\t@ILifecycleService private readonly lifecycleService: ILifecycleService,\n\t\t@INotificationService private readonly notificationService: INotificationService,\n\t\t@IHostService hostService: IHostService,\n\t\t@IExtensionBisectService private readonly extensionBisectService: IExtensionBisectService,\n\t\t@IAllowedExtensionsService private readonly allowedExtensionsService: IAllowedExtensionsService,\n\t\t@IWorkspaceTrustManagementService private readonly workspaceTrustManagementService: IWorkspaceTrustManagementService,\n\t\t@IWorkspaceTrustRequestService private readonly workspaceTrustRequestService: IWorkspaceTrustRequestService,\n\t\t@IExtensionManifestPropertiesService private readonly extensionManifestPropertiesService: IExtensionManifestPropertiesService,\n\t\t@IInstantiationService instantiationService: IInstantiationService,\n\t\t@ILogService private readonly logService: ILogService,\n\t\t@IProductService productService: IProductService\n\t) {\n\t\tsuper();\n\t\tthis.storageManager = this._register(new StorageManager(storageService));\n\n\t\tconst uninstallDisposable = this._register(Event.filter(extensionManagementService.onDidUninstallExtension, e => !e.error)(({ identifier }) => this._reset(identifier)));\n\t\tlet isDisposed = false;\n\t\tthis._register(toDisposable(() => isDisposed = true));\n\t\tthis.extensionsManager = this._register(instantiationService.createInstance(ExtensionsManager));\n\t\tthis.extensionsManager.whenInitialized().then(() => {\n\t\t\tif (!isDisposed) {\n\t\t\t\tuninstallDisposable.dispose();\n\t\t\t\tthis._onDidChangeExtensions([], [], false);\n\t\t\t\tthis._register(this.extensionsManager.onDidChangeExtensions(({ added, removed, isProfileSwitch }) => this._onDidChangeExtensions(added, removed, isProfileSwitch)));\n\t\t\t\tthis.loopCheckForMaliciousExtensions();\n\t\t\t}\n\t\t});\n\n\t\tthis._register(this.globalExtensionEnablementService.onDidChangeEnablement(({ extensions, source }) => this._onDidChangeGloballyDisabledExtensions(extensions, source)));\n\t\tthis._register(allowedExtensionsService.onDidChangeAllowedExtensionsConfigValue(() => this._onDidChangeExtensions([], [], false)));\n\n\t\t// Extension unification\n\t\tthis._completionsExtensionId = productService.defaultChatAgent?.extensionId.toLowerCase();\n\t\tthis._chatExtensionId = productService.defaultChatAgent?.chatExtensionId.toLowerCase();\n\t\tconst unificationExtensions = [this._completionsExtensionId, this._chatExtensionId].filter(id => !!id);\n\n\t\t// Disabling extension unification should immediately disable the unified extension flow\n\t\t// Enabling extension unification will only take effect after restart\n\t\tthis._extensionUnificationEnabled = this.configurationService.getValue<boolean>(EXTENSION_UNIFICATION_SETTING);\n\t\tthis._register(this.configurationService.onDidChangeConfiguration(e => {\n\t\t\tif (e.affectsConfiguration(EXTENSION_UNIFICATION_SETTING)) {\n\t\t\t\tconst extensionUnificationEnabled = this.configurationService.getValue<boolean>(EXTENSION_UNIFICATION_SETTING);\n\t\t\t\tif (!extensionUnificationEnabled) {\n\t\t\t\t\tthis._extensionUnificationEnabled = false;\n\t\t\t\t\tthis._onEnablementChanged.fire(this.extensionsManager.extensions.filter(ext => unificationExtensions.includes(ext.identifier.id.toLowerCase())));\n\t\t\t\t}\n\t\t\t}\n\t\t}));\n\n\t\t// delay notification for extensions disabled until workbench restored\n\t\tif (this.allUserExtensionsDisabled) {\n\t\t\tthis.lifecycleService.when(LifecyclePhase.Eventually).then(() => {\n\t\t\t\tthis.notificationService.prompt(Severity.Info, localize('extensionsDisabled', \"All installed extensions are temporarily disabled.\"), [{\n\t\t\t\t\tlabel: localize('Reload', \"Reload and Enable Extensions\"),\n\t\t\t\t\trun: () => hostService.reload({ disableExtensions: false })\n\t\t\t\t}], {\n\t\t\t\t\tsticky: true,\n\t\t\t\t\tpriority: NotificationPriority.URGENT\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\t}\n\n\tprivate get hasWorkspace(): boolean {\n\t\treturn this.contextService.getWorkbenchState() !== WorkbenchState.EMPTY;\n\t}\n\n\tprivate get allUserExtensionsDisabled(): boolean {\n\t\treturn this.environmentService.disableExtensions === true;\n\t}\n\n\tgetEnablementState(extension: IExtension): EnablementState {\n\t\treturn this._computeEnablementState(extension, this.extensionsManager.extensions, this.getWorkspaceType());\n\t}\n\n\tgetEnablementStates(extensions: IExtension[], workspaceTypeOverrides: Partial<WorkspaceType> = {}): EnablementState[] {\n\t\tconst extensionsEnablements = new Map<IExtension, EnablementState>();\n\t\tconst workspaceType = { ...this.getWorkspaceType(), ...workspaceTypeOverrides };\n\t\treturn extensions.map(extension => this._computeEnablementState(extension, extensions, workspaceType, extensionsEnablements));\n\t}\n\n\tgetDependenciesEnablementStates(extension: IExtension): [IExtension, EnablementState][] {\n\t\treturn getExtensionDependencies(this.extensionsManager.extensions, extension).map(e => [e, this.getEnablementState(e)]);\n\t}\n\n\tcanChangeEnablement(extension: IExtension): boolean {\n\t\ttry {\n\t\t\tthis.throwErrorIfCannotChangeEnablement(extension);\n\t\t\treturn true;\n\t\t} catch (error) {\n\t\t\treturn false;\n\t\t}\n\t}\n\n\tcanChangeWorkspaceEnablement(extension: IExtension): boolean {\n\t\tif (!this.canChangeEnablement(extension)) {\n\t\t\treturn false;\n\t\t}\n\n\t\ttry {\n\t\t\tthis.throwErrorIfCannotChangeWorkspaceEnablement(extension);\n\t\t\treturn true;\n\t\t} catch (error) {\n\t\t\treturn false;\n\t\t}\n\t}\n\n\tprivate throwErrorIfCannotChangeEnablement(extension: IExtension, donotCheckDependencies?: boolean): void {\n\t\tif (isLanguagePackExtension(extension.manifest)) {\n\t\t\tthrow new Error(localize('cannot disable language pack extension', \"Cannot change enablement of {0} extension because it contributes language packs.\", extension.manifest.displayName || extension.identifier.id));\n\t\t}\n\n\t\tif (this.userDataSyncEnablementService.isEnabled() && this.userDataSyncAccountService.account &&\n\t\t\tisAuthenticationProviderExtension(extension.manifest) && extension.manifest.contributes!.authentication!.some(a => a.id === this.userDataSyncAccountService.account!.authenticationProviderId)) {\n\t\t\tthrow new Error(localize('cannot disable auth extension', \"Cannot change enablement {0} extension because Settings Sync depends on it.\", extension.manifest.displayName || extension.identifier.id));\n\t\t}\n\n\t\tif (this._isEnabledInEnv(extension)) {\n\t\t\tthrow new Error(localize('cannot change enablement environment', \"Cannot change enablement of {0} extension because it is enabled in environment\", extension.manifest.displayName || extension.identifier.id));\n\t\t}\n\n\t\tthis.throwErrorIfEnablementStateCannotBeChanged(extension, this.getEnablementState(extension), donotCheckDependencies);\n\t}\n\n\tprivate throwErrorIfEnablementStateCannotBeChanged(extension: IExtension, enablementStateOfExtension: EnablementState, donotCheckDependencies?: boolean): void {\n\t\tswitch (enablementStateOfExtension) {\n\t\t\tcase EnablementState.DisabledByEnvironment:\n\t\t\t\tthrow new Error(localize('cannot change disablement environment', \"Cannot change enablement of {0} extension because it is disabled in environment\", extension.manifest.displayName || extension.identifier.id));\n\t\t\tcase EnablementState.DisabledByMalicious:\n\t\t\t\tthrow new Error(localize('cannot change enablement malicious', \"Cannot change enablement of {0} extension because it is malicious\", extension.manifest.displayName || extension.identifier.id));\n\t\t\tcase EnablementState.DisabledByVirtualWorkspace:\n\t\t\t\tthrow new Error(localize('cannot change enablement virtual workspace', \"Cannot change enablement of {0} extension because it does not support virtual workspaces\", extension.manifest.displayName || extension.identifier.id));\n\t\t\tcase EnablementState.DisabledByExtensionKind:\n\t\t\t\tthrow new Error(localize('cannot change enablement extension kind', \"Cannot change enablement of {0} extension because of its extension kind\", extension.manifest.displayName || extension.identifier.id));\n\t\t\tcase EnablementState.DisabledByAllowlist:\n\t\t\t\tthrow new Error(localize('cannot change disallowed extension enablement', \"Cannot change enablement of {0} extension because it is disallowed\", extension.manifest.displayName || extension.identifier.id));\n\t\t\tcase EnablementState.DisabledByInvalidExtension:\n\t\t\t\tthrow new Error(localize('cannot change invalid extension enablement', \"Cannot change enablement of {0} extension because of it is invalid\", extension.manifest.displayName || extension.identifier.id));\n\t\t\tcase EnablementState.DisabledByExtensionDependency:\n\t\t\t\tif (donotCheckDependencies) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\t// Can be changed only when all its dependencies enablements can be changed\n\t\t\t\tfor (const dependency of getExtensionDependencies(this.extensionsManager.extensions, extension)) {\n\t\t\t\t\tif (this.isEnabled(dependency)) {\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\t\tthrow new Error(localize('cannot change enablement dependency', \"Cannot enable '{0}' extension because it depends on '{1}' extension that cannot be enabled\", extension.manifest.displayName || extension.identifier.id, dependency.manifest.displayName || dependency.identifier.id));\n\t\t\t\t}\n\t\t}\n\t}\n\n\tprivate throwErrorIfCannotChangeWorkspaceEnablement(extension: IExtension): void {\n\t\tif (!this.hasWorkspace) {\n\t\t\tthrow new Error(localize('noWorkspace', \"No workspace.\"));\n\t\t}\n\t\tif (isAuthenticationProviderExtension(extension.manifest)) {\n\t\t\tthrow new Error(localize('cannot disable auth extension in workspace', \"Cannot change enablement of {0} extension in workspace because it contributes authentication providers\", extension.manifest.displayName || extension.identifier.id));\n\t\t}\n\t}\n\n\tasync setEnablement(extensions: IExtension[], newState: EnablementState): Promise<boolean[]> {\n\t\tawait this.extensionsManager.whenInitialized();\n\n\t\tif (newState === EnablementState.EnabledGlobally || newState === EnablementState.EnabledWorkspace) {\n\t\t\textensions.push(...this.getExtensionsToEnableRecursively(extensions, this.extensionsManager.extensions, newState, { dependencies: true, pack: true }));\n\t\t}\n\n\t\tconst workspace = newState === EnablementState.DisabledWorkspace || newState === EnablementState.EnabledWorkspace;\n\t\tfor (const extension of extensions) {\n\t\t\tif (workspace) {\n\t\t\t\tthis.throwErrorIfCannotChangeWorkspaceEnablement(extension);\n\t\t\t} else {\n\t\t\t\tthis.throwErrorIfCannotChangeEnablement(extension);\n\t\t\t}\n\t\t}\n\n\t\tconst result: boolean[] = [];\n\t\tfor (const extension of extensions) {\n\t\t\tconst enablementState = this.getEnablementState(extension);\n\t\t\tif (enablementState === EnablementState.DisabledByTrustRequirement\n\t\t\t\t/* All its disabled dependencies are disabled by Trust Requirement */\n\t\t\t\t|| (enablementState === EnablementState.DisabledByExtensionDependency && this.getDependenciesEnablementStates(extension).every(([, e]) => this.isEnabledEnablementState(e) || e === EnablementState.DisabledByTrustRequirement))\n\t\t\t) {\n\t\t\t\tconst trustState = await this.workspaceTrustRequestService.requestWorkspaceTrust();\n\t\t\t\tresult.push(trustState ?? false);\n\t\t\t} else {\n\t\t\t\tresult.push(await this._setUserEnablementState(extension, newState));\n\t\t\t}\n\t\t}\n\n\t\tconst changedExtensions = extensions.filter((e, index) => result[index]);\n\t\tif (changedExtensions.length) {\n\t\t\tthis._onEnablementChanged.fire(changedExtensions);\n\t\t}\n\t\treturn result;\n\t}\n\n\tprivate getExtensionsToEnableRecursively(extensions: IExtension[], allExtensions: ReadonlyArray<IExtension>, enablementState: EnablementState, options: { dependencies: boolean; pack: boolean }, checked: IExtension[] = []): IExtension[] {\n\t\tif (!options.dependencies && !options.pack) {\n\t\t\treturn [];\n\t\t}\n\n\t\tconst toCheck = extensions.filter(e => checked.indexOf(e) === -1);\n\t\tif (!toCheck.length) {\n\t\t\treturn [];\n\t\t}\n\n\t\tfor (const extension of toCheck) {\n\t\t\tchecked.push(extension);\n\t\t}\n\n\t\tconst extensionsToEnable: IExtension[] = [];\n\t\tfor (const extension of allExtensions) {\n\t\t\t// Extension is already checked\n\t\t\tif (checked.some(e => areSameExtensions(e.identifier, extension.identifier))) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tconst enablementStateOfExtension = this.getEnablementState(extension);\n\t\t\t// Extension is enabled\n\t\t\tif (this.isEnabledEnablementState(enablementStateOfExtension)) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t// Skip if dependency extension is disabled by extension kind\n\t\t\tif (enablementStateOfExtension === EnablementState.DisabledByExtensionKind) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t// Check if the extension is a dependency or in extension pack\n\t\t\tif (extensions.some(e =>\n\t\t\t\t(options.dependencies && e.manifest.extensionDependencies?.some(id => areSameExtensions({ id }, extension.identifier)))\n\t\t\t\t|| (options.pack && e.manifest.extensionPack?.some(id => areSameExtensions({ id }, extension.identifier))))) {\n\n\t\t\t\tconst index = extensionsToEnable.findIndex(e => areSameExtensions(e.identifier, extension.identifier));\n\n\t\t\t\t// Extension is not added to the disablement list so add it\n\t\t\t\tif (index === -1) {\n\t\t\t\t\textensionsToEnable.push(extension);\n\t\t\t\t}\n\n\t\t\t\t// Extension is there already in the disablement list.\n\t\t\t\telse {\n\t\t\t\t\ttry {\n\t\t\t\t\t\t// Replace only if the enablement state can be changed\n\t\t\t\t\t\tthis.throwErrorIfEnablementStateCannotBeChanged(extension, enablementStateOfExtension, true);\n\t\t\t\t\t\textensionsToEnable.splice(index, 1, extension);\n\t\t\t\t\t} catch (error) { /*Do not add*/ }\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (extensionsToEnable.length) {\n\t\t\textensionsToEnable.push(...this.getExtensionsToEnableRecursively(extensionsToEnable, allExtensions, enablementState, options, checked));\n\t\t}\n\n\t\treturn extensionsToEnable;\n\t}\n\n\tprivate _setUserEnablementState(extension: IExtension, newState: EnablementState): Promise<boolean> {\n\n\t\tconst currentState = this._getUserEnablementState(extension.identifier);\n\n\t\tif (currentState === newState) {\n\t\t\treturn Promise.resolve(false);\n\t\t}\n\n\t\tswitch (newState) {\n\t\t\tcase EnablementState.EnabledGlobally:\n\t\t\t\tthis._enableExtension(extension.identifier);\n\t\t\t\tbreak;\n\t\t\tcase EnablementState.DisabledGlobally:\n\t\t\t\tthis._disableExtension(extension.identifier);\n\t\t\t\tbreak;\n\t\t\tcase EnablementState.EnabledWorkspace:\n\t\t\t\tthis._enableExtensionInWorkspace(extension.identifier);\n\t\t\t\tbreak;\n\t\t\tcase EnablementState.DisabledWorkspace:\n\t\t\t\tthis._disableExtensionInWorkspace(extension.identifier);\n\t\t\t\tbreak;\n\t\t}\n\n\t\treturn Promise.resolve(true);\n\t}\n\n\tisEnabled(extension: IExtension): boolean {\n\t\tconst enablementState = this.getEnablementState(extension);\n\t\treturn this.isEnabledEnablementState(enablementState);\n\t}\n\n\tisEnabledEnablementState(enablementState: EnablementState): boolean {\n\t\treturn enablementState === EnablementState.EnabledByEnvironment || enablementState === EnablementState.EnabledWorkspace || enablementState === EnablementState.EnabledGlobally;\n\t}\n\n\tisDisabledGlobally(extension: IExtension): boolean {\n\t\treturn this._isDisabledGlobally(extension.identifier);\n\t}\n\n\tprivate _computeEnablementState(extension: IExtension, extensions: ReadonlyArray<IExtension>, workspaceType: WorkspaceType, computedEnablementStates?: Map<IExtension, EnablementState>): EnablementState {\n\t\tcomputedEnablementStates = computedEnablementStates ?? new Map<IExtension, EnablementState>();\n\t\tlet enablementState = computedEnablementStates.get(extension);\n\t\tif (enablementState !== undefined) {\n\t\t\treturn enablementState;\n\t\t}\n\n\t\tenablementState = this._getUserEnablementState(extension.identifier);\n\t\tconst isEnabled = this.isEnabledEnablementState(enablementState);\n\n\t\tif (isMalicious(extension.identifier, this.getMaliciousExtensions().map(e => ({ extensionOrPublisher: e })))) {\n\t\t\tenablementState = EnablementState.DisabledByMalicious;\n\t\t}\n\n\t\telse if (isEnabled && extension.type === ExtensionType.User && this.allowedExtensionsService.isAllowed(extension) !== true) {\n\t\t\tenablementState = EnablementState.DisabledByAllowlist;\n\t\t}\n\n\t\telse if (isEnabled && !extension.isValid) {\n\t\t\tenablementState = EnablementState.DisabledByInvalidExtension;\n\t\t}\n\n\t\telse if (this.extensionBisectService.isDisabledByBisect(extension)) {\n\t\t\tenablementState = EnablementState.DisabledByEnvironment;\n\t\t}\n\n\t\telse if (this._isDisabledInEnv(extension)) {\n\t\t\tenablementState = EnablementState.DisabledByEnvironment;\n\t\t}\n\n\t\telse if (this._isDisabledByVirtualWorkspace(extension, workspaceType)) {\n\t\t\tenablementState = EnablementState.DisabledByVirtualWorkspace;\n\t\t}\n\n\t\telse if (isEnabled && this._isDisabledByWorkspaceTrust(extension, workspaceType)) {\n\t\t\tenablementState = EnablementState.DisabledByTrustRequirement;\n\t\t}\n\n\t\telse if (this._isDisabledByExtensionKind(extension)) {\n\t\t\tenablementState = EnablementState.DisabledByExtensionKind;\n\t\t}\n\n\t\telse if (isEnabled && this._isDisabledByExtensionDependency(extension, extensions, workspaceType, computedEnablementStates)) {\n\t\t\tenablementState = EnablementState.DisabledByExtensionDependency;\n\t\t}\n\n\t\telse if (this._isDisabledByUnification(extension.identifier)) {\n\t\t\tenablementState = EnablementState.DisabledByUnification;\n\t\t}\n\n\t\telse if (!isEnabled && this._isEnabledInEnv(extension)) {\n\t\t\tenablementState = EnablementState.EnabledByEnvironment;\n\t\t}\n\n\t\tcomputedEnablementStates.set(extension, enablementState);\n\t\treturn enablementState;\n\t}\n\n\tprivate _isDisabledInEnv(extension: IExtension): boolean {\n\t\tif (this.allUserExtensionsDisabled) {\n\t\t\treturn !extension.isBuiltin && !isResolverExtension(extension.manifest, this.environmentService.remoteAuthority);\n\t\t}\n\n\t\tconst disabledExtensions = this.environmentService.disableExtensions;\n\t\tif (Array.isArray(disabledExtensions)) {\n\t\t\treturn disabledExtensions.some(id => areSameExtensions({ id }, extension.identifier));\n\t\t}\n\n\t\t// Check if this is the better merge extension which was migrated to a built-in extension\n\t\tif (areSameExtensions({ id: BetterMergeId.value }, extension.identifier)) {\n\t\t\treturn true;\n\t\t}\n\n\t\treturn false;\n\t}\n\n\tprivate _isEnabledInEnv(extension: IExtension): boolean {\n\t\tconst enabledExtensions = this.environmentService.enableExtensions;\n\t\tif (Array.isArray(enabledExtensions)) {\n\t\t\treturn enabledExtensions.some(id => areSameExtensions({ id }, extension.identifier));\n\t\t}\n\t\treturn false;\n\t}\n\n\tprivate _isDisabledByVirtualWorkspace(extension: IExtension, workspaceType: WorkspaceType): boolean {\n\t\t// Not a virtual workspace\n\t\tif (!workspaceType.virtual) {\n\t\t\treturn false;\n\t\t}\n\n\t\t// Supports virtual workspace\n\t\tif (this.extensionManifestPropertiesService.getExtensionVirtualWorkspaceSupportType(extension.manifest) !== false) {\n\t\t\treturn false;\n\t\t}\n\n\t\t// Web extension from web extension management server\n\t\tif (this.extensionManagementServerService.getExtensionManagementServer(extension) === this.extensionManagementServerService.webExtensionManagementServer && this.extensionManifestPropertiesService.canExecuteOnWeb(extension.manifest)) {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t}\n\n\tprivate _isDisabledByExtensionKind(extension: IExtension): boolean {\n\t\tif (this.extensionManagementServerService.remoteExtensionManagementServer || this.extensionManagementServerService.webExtensionManagementServer) {\n\t\t\tconst installLocation = this.extensionManagementServerService.getExtensionInstallLocation(extension);\n\t\t\tfor (const extensionKind of this.extensionManifestPropertiesService.getExtensionKind(extension.manifest)) {\n\t\t\t\tif (extensionKind === 'ui') {\n\t\t\t\t\tif (installLocation === ExtensionInstallLocation.Local) {\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (extensionKind === 'workspace') {\n\t\t\t\t\tif (installLocation === ExtensionInstallLocation.Remote) {\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (extensionKind === 'web') {\n\t\t\t\t\tif (this.extensionManagementServerService.webExtensionManagementServer /* web */) {\n\t\t\t\t\t\tif (installLocation === ExtensionInstallLocation.Web || installLocation === ExtensionInstallLocation.Remote) {\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\t\t\t\t\t} else if (installLocation === ExtensionInstallLocation.Local) {\n\t\t\t\t\t\tconst enableLocalWebWorker = this.configurationService.getValue<WebWorkerExtHostConfigValue>(webWorkerExtHostConfig);\n\t\t\t\t\t\tif (enableLocalWebWorker === true || enableLocalWebWorker === 'auto') {\n\t\t\t\t\t\t\t// Web extensions are enabled on all configurations\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tprivate _isDisabledByWorkspaceTrust(extension: IExtension, workspaceType: WorkspaceType): boolean {\n\t\tif (workspaceType.trusted) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif (this.contextService.isInsideWorkspace(extension.location)) {\n\t\t\treturn true;\n\t\t}\n\n\t\treturn this.extensionManifestPropertiesService.getExtensionUntrustedWorkspaceSupportType(extension.manifest) === false;\n\t}\n\n\tprivate _isDisabledByExtensionDependency(extension: IExtension, extensions: ReadonlyArray<IExtension>, workspaceType: WorkspaceType, computedEnablementStates: Map<IExtension, EnablementState>): boolean {\n\n\t\tif (!extension.manifest.extensionDependencies) {\n\t\t\treturn false;\n\t\t}\n\n\t\t// Find dependency that is from the same server or does not exports any API\n\t\tconst dependencyExtensions = extensions.filter(e =>\n\t\t\textension.manifest.extensionDependencies?.some(id => areSameExtensions(e.identifier, { id })\n\t\t\t\t&& (this.extensionManagementServerService.getExtensionManagementServer(e) === this.extensionManagementServerService.getExtensionManagementServer(extension) || ((e.manifest.main || e.manifest.browser) && e.manifest.api === 'none'))));\n\n\t\tif (!dependencyExtensions.length) {\n\t\t\treturn false;\n\t\t}\n\n\t\tconst hasEnablementState = computedEnablementStates.has(extension);\n\t\tif (!hasEnablementState) {\n\t\t\t// Placeholder to handle cyclic deps\n\t\t\tcomputedEnablementStates.set(extension, EnablementState.EnabledGlobally);\n\t\t}\n\t\ttry {\n\t\t\tfor (const dependencyExtension of dependencyExtensions) {\n\t\t\t\tconst enablementState = this._computeEnablementState(dependencyExtension, extensions, workspaceType, computedEnablementStates);\n\t\t\t\tif (!this.isEnabledEnablementState(enablementState) && enablementState !== EnablementState.DisabledByExtensionKind) {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t}\n\t\t} finally {\n\t\t\tif (!hasEnablementState) {\n\t\t\t\t// remove the placeholder\n\t\t\t\tcomputedEnablementStates.delete(extension);\n\t\t\t}\n\t\t}\n\n\t\treturn false;\n\t}\n\n\tprivate _getUserEnablementState(identifier: IExtensionIdentifier): EnablementState {\n\t\tif (this.hasWorkspace) {\n\t\t\tif (this._getWorkspaceEnabledExtensions().filter(e => areSameExtensions(e, identifier))[0]) {\n\t\t\t\treturn EnablementState.EnabledWorkspace;\n\t\t\t}\n\n\t\t\tif (this._getWorkspaceDisabledExtensions().filter(e => areSameExtensions(e, identifier))[0]) {\n\t\t\t\treturn EnablementState.DisabledWorkspace;\n\t\t\t}\n\t\t}\n\t\tif (this._isDisabledGlobally(identifier)) {\n\t\t\treturn EnablementState.DisabledGlobally;\n\t\t}\n\t\treturn EnablementState.EnabledGlobally;\n\t}\n\n\tprivate _isDisabledGlobally(identifier: IExtensionIdentifier): boolean {\n\t\treturn this.globalExtensionEnablementService.getDisabledExtensions().some(e => areSameExtensions(e, identifier));\n\t}\n\n\tprivate _isDisabledByUnification(identifier: IExtensionIdentifier): boolean {\n\t\treturn this._extensionUnificationEnabled && identifier.id.toLowerCase() === this._completionsExtensionId;\n\t}\n\n\tprivate _enableExtension(identifier: IExtensionIdentifier): Promise<boolean> {\n\t\tthis._removeFromWorkspaceDisabledExtensions(identifier);\n\t\tthis._removeFromWorkspaceEnabledExtensions(identifier);\n\t\treturn this.globalExtensionEnablementService.enableExtension(identifier, SOURCE);\n\t}\n\n\tprivate _disableExtension(identifier: IExtensionIdentifier): Promise<boolean> {\n\t\tthis._removeFromWorkspaceDisabledExtensions(identifier);\n\t\tthis._removeFromWorkspaceEnabledExtensions(identifier);\n\t\treturn this.globalExtensionEnablementService.disableExtension(identifier, SOURCE);\n\t}\n\n\tprivate _enableExtensionInWorkspace(identifier: IExtensionIdentifier): void {\n\t\tthis._removeFromWorkspaceDisabledExtensions(identifier);\n\t\tthis._addToWorkspaceEnabledExtensions(identifier);\n\t}\n\n\tprivate _disableExtensionInWorkspace(identifier: IExtensionIdentifier): void {\n\t\tthis._addToWorkspaceDisabledExtensions(identifier);\n\t\tthis._removeFromWorkspaceEnabledExtensions(identifier);\n\t}\n\n\tprivate _addToWorkspaceDisabledExtensions(identifier: IExtensionIdentifier): Promise<boolean> {\n\t\tif (!this.hasWorkspace) {\n\t\t\treturn Promise.resolve(false);\n\t\t}\n\t\tconst disabledExtensions = this._getWorkspaceDisabledExtensions();\n\t\tif (disabledExtensions.every(e => !areSameExtensions(e, identifier))) {\n\t\t\tdisabledExtensions.push(identifier);\n\t\t\tthis._setDisabledExtensions(disabledExtensions);\n\t\t\treturn Promise.resolve(true);\n\t\t}\n\t\treturn Promise.resolve(false);\n\t}\n\n\tprivate async _removeFromWorkspaceDisabledExtensions(identifier: IExtensionIdentifier): Promise<boolean> {\n\t\tif (!this.hasWorkspace) {\n\t\t\treturn false;\n\t\t}\n\t\tconst disabledExtensions = this._getWorkspaceDisabledExtensions();\n\t\tfor (let index = 0; index < disabledExtensions.length; index++) {\n\t\t\tconst disabledExtension = disabledExtensions[index];\n\t\t\tif (areSameExtensions(disabledExtension, identifier)) {\n\t\t\t\tdisabledExtensions.splice(index, 1);\n\t\t\t\tthis._setDisabledExtensions(disabledExtensions);\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t}\n\n\tprivate _addToWorkspaceEnabledExtensions(identifier: IExtensionIdentifier): boolean {\n\t\tif (!this.hasWorkspace) {\n\t\t\treturn false;\n\t\t}\n\t\tconst enabledExtensions = this._getWorkspaceEnabledExtensions();\n\t\tif (enabledExtensions.every(e => !areSameExtensions(e, identifier))) {\n\t\t\tenabledExtensions.push(identifier);\n\t\t\tthis._setEnabledExtensions(enabledExtensions);\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tprivate _removeFromWorkspaceEnabledExtensions(identifier: IExtensionIdentifier): boolean {\n\t\tif (!this.hasWorkspace) {\n\t\t\treturn false;\n\t\t}\n\t\tconst enabledExtensions = this._getWorkspaceEnabledExtensions();\n\t\tfor (let index = 0; index < enabledExtensions.length; index++) {\n\t\t\tconst disabledExtension = enabledExtensions[index];\n\t\t\tif (areSameExtensions(disabledExtension, identifier)) {\n\t\t\t\tenabledExtensions.splice(index, 1);\n\t\t\t\tthis._setEnabledExtensions(enabledExtensions);\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t}\n\n\tprotected _getWorkspaceEnabledExtensions(): IExtensionIdentifier[] {\n\t\treturn this._getExtensions(ENABLED_EXTENSIONS_STORAGE_PATH);\n\t}\n\n\tprivate _setEnabledExtensions(enabledExtensions: IExtensionIdentifier[]): void {\n\t\tthis._setExtensions(ENABLED_EXTENSIONS_STORAGE_PATH, enabledExtensions);\n\t}\n\n\tprotected _getWorkspaceDisabledExtensions(): IExtensionIdentifier[] {\n\t\treturn this._getExtensions(DISABLED_EXTENSIONS_STORAGE_PATH);\n\t}\n\n\tprivate _setDisabledExtensions(disabledExtensions: IExtensionIdentifier[]): void {\n\t\tthis._setExtensions(DISABLED_EXTENSIONS_STORAGE_PATH, disabledExtensions);\n\t}\n\n\tprivate _getExtensions(storageId: string): IExtensionIdentifier[] {\n\t\tif (!this.hasWorkspace) {\n\t\t\treturn [];\n\t\t}\n\t\treturn this.storageManager.get(storageId, StorageScope.WORKSPACE);\n\t}\n\n\tprivate _setExtensions(storageId: string, extensions: IExtensionIdentifier[]): void {\n\t\tthis.storageManager.set(storageId, extensions, StorageScope.WORKSPACE);\n\t}\n\n\tprivate async _onDidChangeGloballyDisabledExtensions(extensionIdentifiers: ReadonlyArray<IExtensionIdentifier>, source?: string): Promise<void> {\n\t\tif (source !== SOURCE) {\n\t\t\tawait this.extensionsManager.whenInitialized();\n\t\t\tconst extensions = this.extensionsManager.extensions.filter(installedExtension => extensionIdentifiers.some(identifier => areSameExtensions(identifier, installedExtension.identifier)));\n\t\t\tthis._onEnablementChanged.fire(extensions);\n\t\t}\n\t}\n\n\tprivate _onDidChangeExtensions(added: ReadonlyArray<IExtension>, removed: ReadonlyArray<IExtension>, isProfileSwitch: boolean): void {\n\t\tconst changedExtensions: IExtension[] = added.filter(e => !this.isEnabledEnablementState(this.getEnablementState(e)));\n\t\tconst existingDisabledExtensions = this.extensionsDisabledExtensions;\n\t\tthis.extensionsDisabledExtensions = this.extensionsManager.extensions.filter(extension => {\n\t\t\tconst enablementState = this.getEnablementState(extension);\n\t\t\treturn enablementState === EnablementState.DisabledByExtensionDependency || enablementState === EnablementState.DisabledByAllowlist || enablementState === EnablementState.DisabledByMalicious;\n\t\t});\n\t\tfor (const extension of existingDisabledExtensions) {\n\t\t\tif (this.extensionsDisabledExtensions.every(e => !areSameExtensions(e.identifier, extension.identifier))) {\n\t\t\t\tchangedExtensions.push(extension);\n\t\t\t}\n\t\t}\n\t\tfor (const extension of this.extensionsDisabledExtensions) {\n\t\t\tif (existingDisabledExtensions.every(e => !areSameExtensions(e.identifier, extension.identifier))) {\n\t\t\t\tchangedExtensions.push(extension);\n\t\t\t}\n\t\t}\n\t\tif (changedExtensions.length) {\n\t\t\tthis._onEnablementChanged.fire(changedExtensions);\n\t\t}\n\t\tif (!isProfileSwitch) {\n\t\t\tremoved.forEach(({ identifier }) => this._reset(identifier));\n\t\t}\n\t}\n\n\tpublic async updateExtensionsEnablementsWhenWorkspaceTrustChanges(): Promise<void> {\n\t\tawait this.extensionsManager.whenInitialized();\n\n\t\tconst computeEnablementStates = (workspaceType: WorkspaceType): [IExtension, EnablementState][] => {\n\t\t\tconst extensionsEnablements = new Map<IExtension, EnablementState>();\n\t\t\treturn this.extensionsManager.extensions.map(extension => [extension, this._computeEnablementState(extension, this.extensionsManager.extensions, workspaceType, extensionsEnablements)]);\n\t\t};\n\n\t\tconst workspaceType = this.getWorkspaceType();\n\t\tconst enablementStatesWithTrustedWorkspace = computeEnablementStates({ ...workspaceType, trusted: true });\n\t\tconst enablementStatesWithUntrustedWorkspace = computeEnablementStates({ ...workspaceType, trusted: false });\n\t\tconst enablementChangedExtensionsBecauseOfTrust = enablementStatesWithTrustedWorkspace.filter(([, enablementState], index) => enablementState !== enablementStatesWithUntrustedWorkspace[index][1]).map(([extension]) => extension);\n\n\t\tif (enablementChangedExtensionsBecauseOfTrust.length) {\n\t\t\tthis._onEnablementChanged.fire(enablementChangedExtensionsBecauseOfTrust);\n\t\t}\n\t}\n\n\tprivate getWorkspaceType(): WorkspaceType {\n\t\treturn { trusted: this.workspaceTrustManagementService.isWorkspaceTrusted(), virtual: isVirtualWorkspace(this.contextService.getWorkspace()) };\n\t}\n\n\tprivate _reset(extension: IExtensionIdentifier) {\n\t\tthis._removeFromWorkspaceDisabledExtensions(extension);\n\t\tthis._removeFromWorkspaceEnabledExtensions(extension);\n\t\tthis.globalExtensionEnablementService.enableExtension(extension);\n\t}\n\n\tprivate loopCheckForMaliciousExtensions(): void {\n\t\tthis.checkForMaliciousExtensions()\n\t\t\t.then(() => this.delayer.trigger(() => { }, 1000 * 60 * 5)) // every five minutes\n\t\t\t.then(() => this.loopCheckForMaliciousExtensions());\n\t}\n\n\tprivate async checkForMaliciousExtensions(): Promise<void> {\n\t\ttry {\n\t\t\tconst extensionsControlManifest = await this.extensionManagementService.getExtensionsControlManifest();\n\t\t\tconst changed = this.storeMaliciousExtensions(extensionsControlManifest.malicious.map(({ extensionOrPublisher }) => extensionOrPublisher));\n\t\t\tif (changed) {\n\t\t\t\tthis._onDidChangeExtensions([], [], false);\n\t\t\t}\n\t\t} catch (err) {\n\t\t\tthis.logService.error(err);\n\t\t}\n\t}\n\n\tprivate getMaliciousExtensions(): ReadonlyArray<IExtensionIdentifier | string> {\n\t\treturn this.storageService.getObject('extensionsEnablement/malicious', StorageScope.APPLICATION, []);\n\t}\n\n\tprivate storeMaliciousExtensions(extensions: ReadonlyArray<IExtensionIdentifier | string>): boolean {\n\t\tconst existing = this.getMaliciousExtensions();\n\t\tif (equals(existing, extensions, (a, b) => !isString(a) && !isString(b) ? areSameExtensions(a, b) : a === b)) {\n\t\t\treturn false;\n\t\t}\n\t\tthis.storageService.store('extensionsEnablement/malicious', JSON.stringify(extensions), StorageScope.APPLICATION, StorageTarget.MACHINE);\n\t\treturn true;\n\t}\n}\n\nclass ExtensionsManager extends Disposable {\n\n\tprivate _extensions: IExtension[] = [];\n\tget extensions(): readonly IExtension[] { return this._extensions; }\n\n\tprivate _onDidChangeExtensions = this._register(new Emitter<{ added: readonly IExtension[]; removed: readonly IExtension[]; readonly isProfileSwitch: boolean }>());\n\treadonly onDidChangeExtensions = this._onDidChangeExtensions.event;\n\n\tprivate readonly initializePromise;\n\tprivate disposed: boolean = false;\n\n\tconstructor(\n\t\t@IWorkbenchExtensionManagementService private readonly extensionManagementService: IWorkbenchExtensionManagementService,\n\t\t@IExtensionManagementServerService private readonly extensionManagementServerService: IExtensionManagementServerService,\n\t\t@ILogService private readonly logService: ILogService\n\t) {\n\t\tsuper();\n\t\tthis._register(toDisposable(() => this.disposed = true));\n\t\tthis.initializePromise = this.initialize();\n\t}\n\n\twhenInitialized(): Promise<void> {\n\t\treturn this.initializePromise;\n\t}\n\n\tprivate async initialize(): Promise<void> {\n\t\ttry {\n\t\t\tthis._extensions = [\n\t\t\t\t...await this.extensionManagementService.getInstalled(),\n\t\t\t\t...await this.extensionManagementService.getInstalledWorkspaceExtensions(true)\n\t\t\t];\n\t\t\tif (this.disposed) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis._onDidChangeExtensions.fire({ added: this.extensions, removed: [], isProfileSwitch: false });\n\t\t} catch (error) {\n\t\t\tthis.logService.error(error);\n\t\t}\n\t\tthis._register(this.extensionManagementService.onDidInstallExtensions(e =>\n\t\t\tthis.updateExtensions(e.reduce<IExtension[]>((result, { local, operation }) => {\n\t\t\t\tif (local && operation !== InstallOperation.Migrate) { result.push(local); } return result;\n\t\t\t}, []), [], undefined, false)));\n\t\tthis._register(Event.filter(this.extensionManagementService.onDidUninstallExtension, (e => !e.error))(e => this.updateExtensions([], [e.identifier], e.server, false)));\n\t\tthis._register(this.extensionManagementService.onDidChangeProfile(({ added, removed, server }) => {\n\t\t\tthis.updateExtensions(added, removed.map(({ identifier }) => identifier), server, true);\n\t\t}));\n\t}\n\n\tprivate updateExtensions(added: IExtension[], identifiers: IExtensionIdentifier[], server: IExtensionManagementServer | undefined, isProfileSwitch: boolean): void {\n\t\tif (added.length) {\n\t\t\tfor (const extension of added) {\n\t\t\t\tconst extensionServer = this.extensionManagementServerService.getExtensionManagementServer(extension);\n\t\t\t\tconst index = this._extensions.findIndex(e => areSameExtensions(e.identifier, extension.identifier) && this.extensionManagementServerService.getExtensionManagementServer(e) === extensionServer);\n\t\t\t\tif (index !== -1) {\n\t\t\t\t\tthis._extensions.splice(index, 1);\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis._extensions.push(...added);\n\t\t}\n\t\tconst removed: IExtension[] = [];\n\t\tfor (const identifier of identifiers) {\n\t\t\tconst index = this._extensions.findIndex(e => areSameExtensions(e.identifier, identifier) && this.extensionManagementServerService.getExtensionManagementServer(e) === server);\n\t\t\tif (index !== -1) {\n\t\t\t\tremoved.push(...this._extensions.splice(index, 1));\n\t\t\t}\n\t\t}\n\t\tif (added.length || removed.length) {\n\t\t\tthis._onDidChangeExtensions.fire({ added, removed, isProfileSwitch });\n\t\t}\n\t}\n}\n\nregisterSingleton(IWorkbenchExtensionEnablementService, ExtensionEnablementService, InstantiationType.Delayed);\n"]}