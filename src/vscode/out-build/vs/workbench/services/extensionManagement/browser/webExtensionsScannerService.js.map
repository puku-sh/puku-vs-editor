{"version":3,"sources":["vs/workbench/services/extensionManagement/browser/webExtensionsScannerService.ts"],"names":[],"mappings":"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","file":"webExtensionsScannerService.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { IBuiltinExtensionsScannerService, ExtensionType, IExtensionIdentifier, IExtension, IExtensionManifest, TargetPlatform, IRelaxedExtensionManifest, parseEnabledApiProposalNames } from '../../../../platform/extensions/common/extensions.js';\nimport { IBrowserWorkbenchEnvironmentService } from '../../environment/browser/environmentService.js';\nimport { IScannedExtension, IWebExtensionsScannerService, ScanOptions } from '../common/extensionManagement.js';\nimport { isWeb, Language } from '../../../../base/common/platform.js';\nimport { InstantiationType, registerSingleton } from '../../../../platform/instantiation/common/extensions.js';\nimport { joinPath } from '../../../../base/common/resources.js';\nimport { URI, UriComponents } from '../../../../base/common/uri.js';\nimport { FileOperationError, FileOperationResult, IFileService } from '../../../../platform/files/common/files.js';\nimport { Queue } from '../../../../base/common/async.js';\nimport { VSBuffer } from '../../../../base/common/buffer.js';\nimport { ILogService } from '../../../../platform/log/common/log.js';\nimport { CancellationToken } from '../../../../base/common/cancellation.js';\nimport { IExtensionGalleryService, IExtensionInfo, IGalleryExtension, IGalleryMetadata, Metadata } from '../../../../platform/extensionManagement/common/extensionManagement.js';\nimport { areSameExtensions, getGalleryExtensionId, getExtensionId, isMalicious } from '../../../../platform/extensionManagement/common/extensionManagementUtil.js';\nimport { Disposable } from '../../../../base/common/lifecycle.js';\nimport { ITranslations, localizeManifest } from '../../../../platform/extensionManagement/common/extensionNls.js';\nimport { localize, localize2 } from '../../../../nls.js';\nimport * as semver from '../../../../base/common/semver/semver.js';\nimport { isString, isUndefined } from '../../../../base/common/types.js';\nimport { getErrorMessage } from '../../../../base/common/errors.js';\nimport { ResourceMap } from '../../../../base/common/map.js';\nimport { IExtensionManifestPropertiesService } from '../../extensions/common/extensionManifestPropertiesService.js';\nimport { IExtensionResourceLoaderService, migratePlatformSpecificExtensionGalleryResourceURL } from '../../../../platform/extensionResourceLoader/common/extensionResourceLoader.js';\nimport { Action2, registerAction2 } from '../../../../platform/actions/common/actions.js';\nimport { Categories } from '../../../../platform/action/common/actionCommonCategories.js';\nimport { IsWebContext } from '../../../../platform/contextkey/common/contextkeys.js';\nimport { IEditorService } from '../../editor/common/editorService.js';\nimport { ServicesAccessor } from '../../../../platform/instantiation/common/instantiation.js';\nimport { basename } from '../../../../base/common/path.js';\nimport { IExtensionStorageService } from '../../../../platform/extensionManagement/common/extensionStorage.js';\nimport { isNonEmptyArray } from '../../../../base/common/arrays.js';\nimport { ILifecycleService, LifecyclePhase } from '../../lifecycle/common/lifecycle.js';\nimport { IStorageService, StorageScope, StorageTarget } from '../../../../platform/storage/common/storage.js';\nimport { IProductService } from '../../../../platform/product/common/productService.js';\nimport { validateExtensionManifest } from '../../../../platform/extensions/common/extensionValidator.js';\nimport Severity from '../../../../base/common/severity.js';\nimport { IStringDictionary } from '../../../../base/common/collections.js';\nimport { IUserDataProfileService } from '../../userDataProfile/common/userDataProfile.js';\nimport { IUserDataProfilesService } from '../../../../platform/userDataProfile/common/userDataProfile.js';\nimport { IUriIdentityService } from '../../../../platform/uriIdentity/common/uriIdentity.js';\n\ntype GalleryExtensionInfo = { readonly id: string; preRelease?: boolean; migrateStorageFrom?: string };\ntype ExtensionInfo = { readonly id: string; preRelease: boolean };\n\nfunction isGalleryExtensionInfo(obj: unknown): obj is GalleryExtensionInfo {\n\tconst galleryExtensionInfo = obj as GalleryExtensionInfo | undefined;\n\treturn typeof galleryExtensionInfo?.id === 'string'\n\t\t&& (galleryExtensionInfo.preRelease === undefined || typeof galleryExtensionInfo.preRelease === 'boolean')\n\t\t&& (galleryExtensionInfo.migrateStorageFrom === undefined || typeof galleryExtensionInfo.migrateStorageFrom === 'string');\n}\n\nfunction isUriComponents(obj: unknown): obj is UriComponents {\n\tif (!obj) {\n\t\treturn false;\n\t}\n\tconst thing = obj as UriComponents | undefined;\n\treturn typeof thing?.path === 'string' &&\n\t\ttypeof thing?.scheme === 'string';\n}\n\ninterface IStoredWebExtension {\n\treadonly identifier: IExtensionIdentifier;\n\treadonly version: string;\n\treadonly location: UriComponents;\n\treadonly manifest?: IExtensionManifest;\n\treadonly readmeUri?: UriComponents;\n\treadonly changelogUri?: UriComponents;\n\t// deprecated in favor of packageNLSUris & fallbackPackageNLSUri\n\treadonly packageNLSUri?: UriComponents;\n\treadonly packageNLSUris?: IStringDictionary<UriComponents>;\n\treadonly fallbackPackageNLSUri?: UriComponents;\n\treadonly defaultManifestTranslations?: ITranslations | null;\n\treadonly metadata?: Metadata;\n}\n\ninterface IWebExtension {\n\tidentifier: IExtensionIdentifier;\n\tversion: string;\n\tlocation: URI;\n\tmanifest?: IExtensionManifest;\n\treadmeUri?: URI;\n\tchangelogUri?: URI;\n\t// deprecated in favor of packageNLSUris & fallbackPackageNLSUri\n\tpackageNLSUri?: URI;\n\tpackageNLSUris?: Map<string, URI>;\n\tfallbackPackageNLSUri?: URI;\n\tdefaultManifestTranslations?: ITranslations | null;\n\tmetadata?: Metadata;\n}\n\nexport class WebExtensionsScannerService extends Disposable implements IWebExtensionsScannerService {\n\n\tdeclare readonly _serviceBrand: undefined;\n\n\tprivate readonly systemExtensionsCacheResource: URI | undefined = undefined;\n\tprivate readonly customBuiltinExtensionsCacheResource: URI | undefined = undefined;\n\tprivate readonly resourcesAccessQueueMap = new ResourceMap<Queue<IWebExtension[]>>();\n\tprivate readonly extensionsEnabledWithApiProposalVersion: string[];\n\n\tconstructor(\n\t\t@IBrowserWorkbenchEnvironmentService private readonly environmentService: IBrowserWorkbenchEnvironmentService,\n\t\t@IBuiltinExtensionsScannerService private readonly builtinExtensionsScannerService: IBuiltinExtensionsScannerService,\n\t\t@IFileService private readonly fileService: IFileService,\n\t\t@ILogService private readonly logService: ILogService,\n\t\t@IExtensionGalleryService private readonly galleryService: IExtensionGalleryService,\n\t\t@IExtensionManifestPropertiesService private readonly extensionManifestPropertiesService: IExtensionManifestPropertiesService,\n\t\t@IExtensionResourceLoaderService private readonly extensionResourceLoaderService: IExtensionResourceLoaderService,\n\t\t@IExtensionStorageService private readonly extensionStorageService: IExtensionStorageService,\n\t\t@IStorageService private readonly storageService: IStorageService,\n\t\t@IProductService private readonly productService: IProductService,\n\t\t@IUserDataProfilesService private readonly userDataProfilesService: IUserDataProfilesService,\n\t\t@IUriIdentityService private readonly uriIdentityService: IUriIdentityService,\n\t\t@ILifecycleService lifecycleService: ILifecycleService,\n\t) {\n\t\tsuper();\n\t\tif (isWeb) {\n\t\t\tthis.systemExtensionsCacheResource = joinPath(environmentService.userRoamingDataHome, 'systemExtensionsCache.json');\n\t\t\tthis.customBuiltinExtensionsCacheResource = joinPath(environmentService.userRoamingDataHome, 'customBuiltinExtensionsCache.json');\n\n\t\t\t// Eventually update caches\n\t\t\tlifecycleService.when(LifecyclePhase.Eventually).then(() => this.updateCaches());\n\t\t}\n\t\tthis.extensionsEnabledWithApiProposalVersion = productService.extensionsEnabledWithApiProposalVersion?.map(id => id.toLowerCase()) ?? [];\n\t}\n\n\tprivate _customBuiltinExtensionsInfoPromise: Promise<{ extensions: ExtensionInfo[]; extensionsToMigrate: [string, string][]; extensionLocations: URI[]; extensionGalleryResources: URI[] }> | undefined;\n\tprivate readCustomBuiltinExtensionsInfoFromEnv(): Promise<{ extensions: ExtensionInfo[]; extensionsToMigrate: [string, string][]; extensionLocations: URI[]; extensionGalleryResources: URI[] }> {\n\t\tif (!this._customBuiltinExtensionsInfoPromise) {\n\t\t\tthis._customBuiltinExtensionsInfoPromise = (async () => {\n\t\t\t\tlet extensions: ExtensionInfo[] = [];\n\t\t\t\tconst extensionLocations: URI[] = [];\n\t\t\t\tconst extensionGalleryResources: URI[] = [];\n\t\t\t\tconst extensionsToMigrate: [string, string][] = [];\n\t\t\t\tconst customBuiltinExtensionsInfo = this.environmentService.options && Array.isArray(this.environmentService.options.additionalBuiltinExtensions)\n\t\t\t\t\t? this.environmentService.options.additionalBuiltinExtensions.map(additionalBuiltinExtension => isString(additionalBuiltinExtension) ? { id: additionalBuiltinExtension } : additionalBuiltinExtension)\n\t\t\t\t\t: [];\n\t\t\t\tfor (const e of customBuiltinExtensionsInfo) {\n\t\t\t\t\tif (isGalleryExtensionInfo(e)) {\n\t\t\t\t\t\textensions.push({ id: e.id, preRelease: !!e.preRelease });\n\t\t\t\t\t\tif (e.migrateStorageFrom) {\n\t\t\t\t\t\t\textensionsToMigrate.push([e.migrateStorageFrom, e.id]);\n\t\t\t\t\t\t}\n\t\t\t\t\t} else if (isUriComponents(e)) {\n\t\t\t\t\t\tconst extensionLocation = URI.revive(e);\n\t\t\t\t\t\tif (await this.extensionResourceLoaderService.isExtensionGalleryResource(extensionLocation)) {\n\t\t\t\t\t\t\textensionGalleryResources.push(extensionLocation);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\textensionLocations.push(extensionLocation);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (extensions.length) {\n\t\t\t\t\textensions = await this.checkAdditionalBuiltinExtensions(extensions);\n\t\t\t\t}\n\t\t\t\tif (extensions.length) {\n\t\t\t\t\tthis.logService.info('Found additional builtin gallery extensions in env', extensions);\n\t\t\t\t}\n\t\t\t\tif (extensionLocations.length) {\n\t\t\t\t\tthis.logService.info('Found additional builtin location extensions in env', extensionLocations.map(e => e.toString()));\n\t\t\t\t}\n\t\t\t\tif (extensionGalleryResources.length) {\n\t\t\t\t\tthis.logService.info('Found additional builtin extension gallery resources in env', extensionGalleryResources.map(e => e.toString()));\n\t\t\t\t}\n\t\t\t\treturn { extensions, extensionsToMigrate, extensionLocations, extensionGalleryResources };\n\t\t\t})();\n\t\t}\n\t\treturn this._customBuiltinExtensionsInfoPromise;\n\t}\n\n\tprivate async checkAdditionalBuiltinExtensions(extensions: ExtensionInfo[]): Promise<ExtensionInfo[]> {\n\t\tconst extensionsControlManifest = await this.galleryService.getExtensionsControlManifest();\n\t\tconst result: ExtensionInfo[] = [];\n\t\tfor (const extension of extensions) {\n\t\t\tif (isMalicious({ id: extension.id }, extensionsControlManifest.malicious)) {\n\t\t\t\tthis.logService.info(`Checking additional builtin extensions: Ignoring '${extension.id}' because it is reported to be malicious.`);\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tconst deprecationInfo = extensionsControlManifest.deprecated[extension.id.toLowerCase()];\n\t\t\tif (deprecationInfo?.extension?.autoMigrate) {\n\t\t\t\tconst preReleaseExtensionId = deprecationInfo.extension.id;\n\t\t\t\tthis.logService.info(`Checking additional builtin extensions: '${extension.id}' is deprecated, instead using '${preReleaseExtensionId}'`);\n\t\t\t\tresult.push({ id: preReleaseExtensionId, preRelease: !!extension.preRelease });\n\t\t\t} else {\n\t\t\t\tresult.push(extension);\n\t\t\t}\n\t\t}\n\t\treturn result;\n\t}\n\n\t/**\n\t * All system extensions bundled with the product\n\t */\n\tprivate async readSystemExtensions(): Promise<IExtension[]> {\n\t\tconst systemExtensions = await this.builtinExtensionsScannerService.scanBuiltinExtensions();\n\t\tconst cachedSystemExtensions = await Promise.all((await this.readSystemExtensionsCache()).map(e => this.toScannedExtension(e, true, ExtensionType.System)));\n\n\t\tconst result = new Map<string, IExtension>();\n\t\tfor (const extension of [...systemExtensions, ...cachedSystemExtensions]) {\n\t\t\tconst existing = result.get(extension.identifier.id.toLowerCase());\n\t\t\tif (existing) {\n\t\t\t\t// Incase there are duplicates always take the latest version\n\t\t\t\tif (semver.gt(existing.manifest.version, extension.manifest.version)) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t}\n\t\t\tresult.set(extension.identifier.id.toLowerCase(), extension);\n\t\t}\n\t\treturn [...result.values()];\n\t}\n\n\t/**\n\t * All extensions defined via `additionalBuiltinExtensions` API\n\t */\n\tprivate async readCustomBuiltinExtensions(scanOptions?: ScanOptions): Promise<IScannedExtension[]> {\n\t\tconst [customBuiltinExtensionsFromLocations, customBuiltinExtensionsFromGallery] = await Promise.all([\n\t\t\tthis.getCustomBuiltinExtensionsFromLocations(scanOptions),\n\t\t\tthis.getCustomBuiltinExtensionsFromGallery(scanOptions),\n\t\t]);\n\t\tconst customBuiltinExtensions: IScannedExtension[] = [...customBuiltinExtensionsFromLocations, ...customBuiltinExtensionsFromGallery];\n\t\tawait this.migrateExtensionsStorage(customBuiltinExtensions);\n\t\treturn customBuiltinExtensions;\n\t}\n\n\tprivate async getCustomBuiltinExtensionsFromLocations(scanOptions?: ScanOptions): Promise<IScannedExtension[]> {\n\t\tconst { extensionLocations } = await this.readCustomBuiltinExtensionsInfoFromEnv();\n\t\tif (!extensionLocations.length) {\n\t\t\treturn [];\n\t\t}\n\t\tconst result: IScannedExtension[] = [];\n\t\tawait Promise.allSettled(extensionLocations.map(async extensionLocation => {\n\t\t\ttry {\n\t\t\t\tconst webExtension = await this.toWebExtension(extensionLocation);\n\t\t\t\tconst extension = await this.toScannedExtension(webExtension, true);\n\t\t\t\tif (extension.isValid || !scanOptions?.skipInvalidExtensions) {\n\t\t\t\t\tresult.push(extension);\n\t\t\t\t} else {\n\t\t\t\t\tthis.logService.info(`Skipping invalid additional builtin extension ${webExtension.identifier.id}`);\n\t\t\t\t}\n\t\t\t} catch (error) {\n\t\t\t\tthis.logService.info(`Error while fetching the additional builtin extension ${extensionLocation.toString()}.`, getErrorMessage(error));\n\t\t\t}\n\t\t}));\n\t\treturn result;\n\t}\n\n\tprivate async getCustomBuiltinExtensionsFromGallery(scanOptions?: ScanOptions): Promise<IScannedExtension[]> {\n\t\tif (!this.galleryService.isEnabled()) {\n\t\t\tthis.logService.info('Ignoring fetching additional builtin extensions from gallery as it is disabled.');\n\t\t\treturn [];\n\t\t}\n\t\tconst result: IScannedExtension[] = [];\n\t\tconst { extensions, extensionGalleryResources } = await this.readCustomBuiltinExtensionsInfoFromEnv();\n\t\ttry {\n\t\t\tconst cacheValue = JSON.stringify({\n\t\t\t\textensions: extensions.sort((a, b) => a.id.localeCompare(b.id)),\n\t\t\t\textensionGalleryResources: extensionGalleryResources.map(e => e.toString()).sort()\n\t\t\t});\n\t\t\tconst useCache = this.storageService.get('additionalBuiltinExtensions', StorageScope.APPLICATION, '{}') === cacheValue;\n\t\t\tconst webExtensions = await (useCache ? this.getCustomBuiltinExtensionsFromCache() : this.updateCustomBuiltinExtensionsCache());\n\t\t\tif (webExtensions.length) {\n\t\t\t\tawait Promise.all(webExtensions.map(async webExtension => {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tconst extension = await this.toScannedExtension(webExtension, true);\n\t\t\t\t\t\tif (extension.isValid || !scanOptions?.skipInvalidExtensions) {\n\t\t\t\t\t\t\tresult.push(extension);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tthis.logService.info(`Skipping invalid additional builtin gallery extension ${webExtension.identifier.id}`);\n\t\t\t\t\t\t}\n\t\t\t\t\t} catch (error) {\n\t\t\t\t\t\tthis.logService.info(`Ignoring additional builtin extension ${webExtension.identifier.id} because there is an error while converting it into scanned extension`, getErrorMessage(error));\n\t\t\t\t\t}\n\t\t\t\t}));\n\t\t\t}\n\t\t\tthis.storageService.store('additionalBuiltinExtensions', cacheValue, StorageScope.APPLICATION, StorageTarget.MACHINE);\n\t\t} catch (error) {\n\t\t\tthis.logService.info('Ignoring following additional builtin extensions as there is an error while fetching them from gallery', extensions.map(({ id }) => id), getErrorMessage(error));\n\t\t}\n\t\treturn result;\n\t}\n\n\tprivate async getCustomBuiltinExtensionsFromCache(): Promise<IWebExtension[]> {\n\t\tconst cachedCustomBuiltinExtensions = await this.readCustomBuiltinExtensionsCache();\n\t\tconst webExtensionsMap = new Map<string, IWebExtension>();\n\t\tfor (const webExtension of cachedCustomBuiltinExtensions) {\n\t\t\tconst existing = webExtensionsMap.get(webExtension.identifier.id.toLowerCase());\n\t\t\tif (existing) {\n\t\t\t\t// Incase there are duplicates always take the latest version\n\t\t\t\tif (semver.gt(existing.version, webExtension.version)) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t}\n\t\t\t/* Update preRelease flag in the cache - https://github.com/microsoft/vscode/issues/142831 */\n\t\t\tif (webExtension.metadata?.isPreReleaseVersion && !webExtension.metadata?.preRelease) {\n\t\t\t\twebExtension.metadata.preRelease = true;\n\t\t\t}\n\t\t\twebExtensionsMap.set(webExtension.identifier.id.toLowerCase(), webExtension);\n\t\t}\n\t\treturn [...webExtensionsMap.values()];\n\t}\n\n\tprivate _migrateExtensionsStoragePromise: Promise<void> | undefined;\n\tprivate async migrateExtensionsStorage(customBuiltinExtensions: IExtension[]): Promise<void> {\n\t\tif (!this._migrateExtensionsStoragePromise) {\n\t\t\tthis._migrateExtensionsStoragePromise = (async () => {\n\t\t\t\tconst { extensionsToMigrate } = await this.readCustomBuiltinExtensionsInfoFromEnv();\n\t\t\t\tif (!extensionsToMigrate.length) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tconst fromExtensions = await this.galleryService.getExtensions(extensionsToMigrate.map(([id]) => ({ id })), CancellationToken.None);\n\t\t\t\ttry {\n\t\t\t\t\tawait Promise.allSettled(extensionsToMigrate.map(async ([from, to]) => {\n\t\t\t\t\t\tconst toExtension = customBuiltinExtensions.find(extension => areSameExtensions(extension.identifier, { id: to }));\n\t\t\t\t\t\tif (toExtension) {\n\t\t\t\t\t\t\tconst fromExtension = fromExtensions.find(extension => areSameExtensions(extension.identifier, { id: from }));\n\t\t\t\t\t\t\tconst fromExtensionManifest = fromExtension ? await this.galleryService.getManifest(fromExtension, CancellationToken.None) : null;\n\t\t\t\t\t\t\tconst fromExtensionId = fromExtensionManifest ? getExtensionId(fromExtensionManifest.publisher, fromExtensionManifest.name) : from;\n\t\t\t\t\t\t\tconst toExtensionId = getExtensionId(toExtension.manifest.publisher, toExtension.manifest.name);\n\t\t\t\t\t\t\tthis.extensionStorageService.addToMigrationList(fromExtensionId, toExtensionId);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tthis.logService.info(`Skipped migrating extension storage from '${from}' to '${to}', because the '${to}' extension is not found.`);\n\t\t\t\t\t\t}\n\t\t\t\t\t}));\n\t\t\t\t} catch (error) {\n\t\t\t\t\tthis.logService.error(error);\n\t\t\t\t}\n\t\t\t})();\n\t\t}\n\t\treturn this._migrateExtensionsStoragePromise;\n\t}\n\n\tprivate async updateCaches(): Promise<void> {\n\t\tawait this.updateSystemExtensionsCache();\n\t\tawait this.updateCustomBuiltinExtensionsCache();\n\t}\n\n\tprivate async updateSystemExtensionsCache(): Promise<void> {\n\t\tconst systemExtensions = await this.builtinExtensionsScannerService.scanBuiltinExtensions();\n\t\tconst cachedSystemExtensions = (await this.readSystemExtensionsCache())\n\t\t\t.filter(cached => {\n\t\t\t\tconst systemExtension = systemExtensions.find(e => areSameExtensions(e.identifier, cached.identifier));\n\t\t\t\treturn systemExtension && semver.gt(cached.version, systemExtension.manifest.version);\n\t\t\t});\n\t\tawait this.writeSystemExtensionsCache(() => cachedSystemExtensions);\n\t}\n\n\tprivate _updateCustomBuiltinExtensionsCachePromise: Promise<IWebExtension[]> | undefined;\n\tprivate async updateCustomBuiltinExtensionsCache(): Promise<IWebExtension[]> {\n\t\tif (!this._updateCustomBuiltinExtensionsCachePromise) {\n\t\t\tthis._updateCustomBuiltinExtensionsCachePromise = (async () => {\n\t\t\t\tthis.logService.info('Updating additional builtin extensions cache');\n\t\t\t\tconst { extensions, extensionGalleryResources } = await this.readCustomBuiltinExtensionsInfoFromEnv();\n\t\t\t\tconst [galleryWebExtensions, extensionGalleryResourceWebExtensions] = await Promise.all([\n\t\t\t\t\tthis.resolveBuiltinGalleryExtensions(extensions),\n\t\t\t\t\tthis.resolveBuiltinExtensionGalleryResources(extensionGalleryResources)\n\t\t\t\t]);\n\t\t\t\tconst webExtensionsMap = new Map<string, IWebExtension>();\n\t\t\t\tfor (const webExtension of [...galleryWebExtensions, ...extensionGalleryResourceWebExtensions]) {\n\t\t\t\t\twebExtensionsMap.set(webExtension.identifier.id.toLowerCase(), webExtension);\n\t\t\t\t}\n\t\t\t\tawait this.resolveDependenciesAndPackedExtensions(extensionGalleryResourceWebExtensions, webExtensionsMap);\n\t\t\t\tconst webExtensions = [...webExtensionsMap.values()];\n\t\t\t\tawait this.writeCustomBuiltinExtensionsCache(() => webExtensions);\n\t\t\t\treturn webExtensions;\n\t\t\t})();\n\t\t}\n\t\treturn this._updateCustomBuiltinExtensionsCachePromise;\n\t}\n\n\tprivate async resolveBuiltinExtensionGalleryResources(extensionGalleryResources: URI[]): Promise<IWebExtension[]> {\n\t\tif (extensionGalleryResources.length === 0) {\n\t\t\treturn [];\n\t\t}\n\t\tconst result = new Map<string, IWebExtension>();\n\t\tconst extensionInfos: IExtensionInfo[] = [];\n\t\tawait Promise.all(extensionGalleryResources.map(async extensionGalleryResource => {\n\t\t\ttry {\n\t\t\t\tconst webExtension = await this.toWebExtensionFromExtensionGalleryResource(extensionGalleryResource);\n\t\t\t\tresult.set(webExtension.identifier.id.toLowerCase(), webExtension);\n\t\t\t\textensionInfos.push({ id: webExtension.identifier.id, version: webExtension.version });\n\t\t\t} catch (error) {\n\t\t\t\tthis.logService.info(`Ignoring additional builtin extension from gallery resource ${extensionGalleryResource.toString()} because there is an error while converting it into web extension`, getErrorMessage(error));\n\t\t\t}\n\t\t}));\n\t\tconst galleryExtensions = await this.galleryService.getExtensions(extensionInfos, CancellationToken.None);\n\t\tfor (const galleryExtension of galleryExtensions) {\n\t\t\tconst webExtension = result.get(galleryExtension.identifier.id.toLowerCase());\n\t\t\tif (webExtension) {\n\t\t\t\tresult.set(galleryExtension.identifier.id.toLowerCase(), {\n\t\t\t\t\t...webExtension,\n\t\t\t\t\tidentifier: { id: webExtension.identifier.id, uuid: galleryExtension.identifier.uuid },\n\t\t\t\t\treadmeUri: galleryExtension.assets.readme ? URI.parse(galleryExtension.assets.readme.uri) : undefined,\n\t\t\t\t\tchangelogUri: galleryExtension.assets.changelog ? URI.parse(galleryExtension.assets.changelog.uri) : undefined,\n\t\t\t\t\tmetadata: { isPreReleaseVersion: galleryExtension.properties.isPreReleaseVersion, preRelease: galleryExtension.properties.isPreReleaseVersion, isBuiltin: true, pinned: true }\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t\treturn [...result.values()];\n\t}\n\n\tprivate async resolveBuiltinGalleryExtensions(extensions: IExtensionInfo[]): Promise<IWebExtension[]> {\n\t\tif (extensions.length === 0) {\n\t\t\treturn [];\n\t\t}\n\t\tconst webExtensions: IWebExtension[] = [];\n\t\tconst galleryExtensionsMap = await this.getExtensionsWithDependenciesAndPackedExtensions(extensions);\n\t\tconst missingExtensions = extensions.filter(({ id }) => !galleryExtensionsMap.has(id.toLowerCase()));\n\t\tif (missingExtensions.length) {\n\t\t\tthis.logService.info('Skipping the additional builtin extensions because their compatible versions are not found.', missingExtensions);\n\t\t}\n\t\tawait Promise.all([...galleryExtensionsMap.values()].map(async gallery => {\n\t\t\ttry {\n\t\t\t\tconst webExtension = await this.toWebExtensionFromGallery(gallery, { isPreReleaseVersion: gallery.properties.isPreReleaseVersion, preRelease: gallery.properties.isPreReleaseVersion, isBuiltin: true });\n\t\t\t\twebExtensions.push(webExtension);\n\t\t\t} catch (error) {\n\t\t\t\tthis.logService.info(`Ignoring additional builtin extension ${gallery.identifier.id} because there is an error while converting it into web extension`, getErrorMessage(error));\n\t\t\t}\n\t\t}));\n\t\treturn webExtensions;\n\t}\n\n\tprivate async resolveDependenciesAndPackedExtensions(webExtensions: IWebExtension[], result: Map<string, IWebExtension>): Promise<void> {\n\t\tconst extensionInfos: IExtensionInfo[] = [];\n\t\tfor (const webExtension of webExtensions) {\n\t\t\tfor (const e of [...(webExtension.manifest?.extensionDependencies ?? []), ...(webExtension.manifest?.extensionPack ?? [])]) {\n\t\t\t\tif (!result.has(e.toLowerCase())) {\n\t\t\t\t\textensionInfos.push({ id: e, version: webExtension.version });\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tif (extensionInfos.length === 0) {\n\t\t\treturn;\n\t\t}\n\t\tconst galleryExtensions = await this.getExtensionsWithDependenciesAndPackedExtensions(extensionInfos, new Set<string>([...result.keys()]));\n\t\tawait Promise.all([...galleryExtensions.values()].map(async gallery => {\n\t\t\ttry {\n\t\t\t\tconst webExtension = await this.toWebExtensionFromGallery(gallery, { isPreReleaseVersion: gallery.properties.isPreReleaseVersion, preRelease: gallery.properties.isPreReleaseVersion, isBuiltin: true });\n\t\t\t\tresult.set(webExtension.identifier.id.toLowerCase(), webExtension);\n\t\t\t} catch (error) {\n\t\t\t\tthis.logService.info(`Ignoring additional builtin extension ${gallery.identifier.id} because there is an error while converting it into web extension`, getErrorMessage(error));\n\t\t\t}\n\t\t}));\n\t}\n\n\tprivate async getExtensionsWithDependenciesAndPackedExtensions(toGet: IExtensionInfo[], seen: Set<string> = new Set<string>(), result: Map<string, IGalleryExtension> = new Map<string, IGalleryExtension>()): Promise<Map<string, IGalleryExtension>> {\n\t\tif (toGet.length === 0) {\n\t\t\treturn result;\n\t\t}\n\t\tconst extensions = await this.galleryService.getExtensions(toGet, { compatible: true, targetPlatform: TargetPlatform.WEB }, CancellationToken.None);\n\t\tconst packsAndDependencies = new Map<string, IExtensionInfo>();\n\t\tfor (const extension of extensions) {\n\t\t\tresult.set(extension.identifier.id.toLowerCase(), extension);\n\t\t\tfor (const id of [...(isNonEmptyArray(extension.properties.dependencies) ? extension.properties.dependencies : []), ...(isNonEmptyArray(extension.properties.extensionPack) ? extension.properties.extensionPack : [])]) {\n\t\t\t\tif (!result.has(id.toLowerCase()) && !packsAndDependencies.has(id.toLowerCase()) && !seen.has(id.toLowerCase())) {\n\t\t\t\t\tconst extensionInfo = toGet.find(e => areSameExtensions(e, extension.identifier));\n\t\t\t\t\tpacksAndDependencies.set(id.toLowerCase(), { id, preRelease: extensionInfo?.preRelease });\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn this.getExtensionsWithDependenciesAndPackedExtensions([...packsAndDependencies.values()].filter(({ id }) => !result.has(id.toLowerCase())), seen, result);\n\t}\n\n\tasync scanSystemExtensions(): Promise<IExtension[]> {\n\t\treturn this.readSystemExtensions();\n\t}\n\n\tasync scanUserExtensions(profileLocation: URI, scanOptions?: ScanOptions): Promise<IScannedExtension[]> {\n\t\tconst extensions = new Map<string, IScannedExtension>();\n\n\t\t// Custom builtin extensions defined through `additionalBuiltinExtensions` API\n\t\tconst customBuiltinExtensions = await this.readCustomBuiltinExtensions(scanOptions);\n\t\tfor (const extension of customBuiltinExtensions) {\n\t\t\textensions.set(extension.identifier.id.toLowerCase(), extension);\n\t\t}\n\n\t\t// User Installed extensions\n\t\tconst installedExtensions = await this.scanInstalledExtensions(profileLocation, scanOptions);\n\t\tfor (const extension of installedExtensions) {\n\t\t\textensions.set(extension.identifier.id.toLowerCase(), extension);\n\t\t}\n\n\t\treturn [...extensions.values()];\n\t}\n\n\tasync scanExtensionsUnderDevelopment(): Promise<IExtension[]> {\n\t\tconst devExtensions = this.environmentService.options?.developmentOptions?.extensions;\n\t\tconst result: IExtension[] = [];\n\t\tif (Array.isArray(devExtensions)) {\n\t\t\tawait Promise.allSettled(devExtensions.map(async devExtension => {\n\t\t\t\ttry {\n\t\t\t\t\tconst location = URI.revive(devExtension);\n\t\t\t\t\tif (URI.isUri(location)) {\n\t\t\t\t\t\tconst webExtension = await this.toWebExtension(location);\n\t\t\t\t\t\tresult.push(await this.toScannedExtension(webExtension, false));\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.logService.info(`Skipping the extension under development ${devExtension} as it is not URI type.`);\n\t\t\t\t\t}\n\t\t\t\t} catch (error) {\n\t\t\t\t\tthis.logService.info(`Error while fetching the extension under development ${devExtension.toString()}.`, getErrorMessage(error));\n\t\t\t\t}\n\t\t\t}));\n\t\t}\n\t\treturn result;\n\t}\n\n\tasync scanExistingExtension(extensionLocation: URI, extensionType: ExtensionType, profileLocation: URI): Promise<IScannedExtension | null> {\n\t\tif (extensionType === ExtensionType.System) {\n\t\t\tconst systemExtensions = await this.scanSystemExtensions();\n\t\t\treturn systemExtensions.find(e => e.location.toString() === extensionLocation.toString()) || null;\n\t\t}\n\t\tconst userExtensions = await this.scanUserExtensions(profileLocation);\n\t\treturn userExtensions.find(e => e.location.toString() === extensionLocation.toString()) || null;\n\t}\n\n\tasync scanExtensionManifest(extensionLocation: URI): Promise<IExtensionManifest | null> {\n\t\ttry {\n\t\t\treturn await this.getExtensionManifest(extensionLocation);\n\t\t} catch (error) {\n\t\t\tthis.logService.warn(`Error while fetching manifest from ${extensionLocation.toString()}`, getErrorMessage(error));\n\t\t\treturn null;\n\t\t}\n\t}\n\n\tasync addExtensionFromGallery(galleryExtension: IGalleryExtension, metadata: Metadata, profileLocation: URI): Promise<IScannedExtension> {\n\t\tconst webExtension = await this.toWebExtensionFromGallery(galleryExtension, metadata);\n\t\treturn this.addWebExtension(webExtension, profileLocation);\n\t}\n\n\tasync addExtension(location: URI, metadata: Metadata, profileLocation: URI): Promise<IScannedExtension> {\n\t\tconst webExtension = await this.toWebExtension(location, undefined, undefined, undefined, undefined, undefined, undefined, metadata);\n\t\tconst extension = await this.toScannedExtension(webExtension, false);\n\t\tawait this.addToInstalledExtensions([webExtension], profileLocation);\n\t\treturn extension;\n\t}\n\n\tasync removeExtension(extension: IScannedExtension, profileLocation: URI): Promise<void> {\n\t\tawait this.writeInstalledExtensions(profileLocation, installedExtensions => installedExtensions.filter(installedExtension => !areSameExtensions(installedExtension.identifier, extension.identifier)));\n\t}\n\n\tasync updateMetadata(extension: IScannedExtension, metadata: Partial<Metadata>, profileLocation: URI): Promise<IScannedExtension> {\n\t\tlet updatedExtension: IWebExtension | undefined = undefined;\n\t\tawait this.writeInstalledExtensions(profileLocation, installedExtensions => {\n\t\t\tconst result: IWebExtension[] = [];\n\t\t\tfor (const installedExtension of installedExtensions) {\n\t\t\t\tif (areSameExtensions(extension.identifier, installedExtension.identifier)) {\n\t\t\t\t\tinstalledExtension.metadata = { ...installedExtension.metadata, ...metadata };\n\t\t\t\t\tupdatedExtension = installedExtension;\n\t\t\t\t\tresult.push(installedExtension);\n\t\t\t\t} else {\n\t\t\t\t\tresult.push(installedExtension);\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn result;\n\t\t});\n\t\tif (!updatedExtension) {\n\t\t\tthrow new Error('Extension not found');\n\t\t}\n\t\treturn this.toScannedExtension(updatedExtension, extension.isBuiltin);\n\t}\n\n\tasync copyExtensions(fromProfileLocation: URI, toProfileLocation: URI, filter: (extension: IScannedExtension) => boolean): Promise<void> {\n\t\tconst extensionsToCopy: IWebExtension[] = [];\n\t\tconst fromWebExtensions = await this.readInstalledExtensions(fromProfileLocation);\n\t\tawait Promise.all(fromWebExtensions.map(async webExtension => {\n\t\t\tconst scannedExtension = await this.toScannedExtension(webExtension, false);\n\t\t\tif (filter(scannedExtension)) {\n\t\t\t\textensionsToCopy.push(webExtension);\n\t\t\t}\n\t\t}));\n\t\tif (extensionsToCopy.length) {\n\t\t\tawait this.addToInstalledExtensions(extensionsToCopy, toProfileLocation);\n\t\t}\n\t}\n\n\tprivate async addWebExtension(webExtension: IWebExtension, profileLocation: URI): Promise<IScannedExtension> {\n\t\tconst isSystem = !!(await this.scanSystemExtensions()).find(e => areSameExtensions(e.identifier, webExtension.identifier));\n\t\tconst isBuiltin = !!webExtension.metadata?.isBuiltin;\n\t\tconst extension = await this.toScannedExtension(webExtension, isBuiltin);\n\n\t\tif (isSystem) {\n\t\t\tawait this.writeSystemExtensionsCache(systemExtensions => {\n\t\t\t\t// Remove the existing extension to avoid duplicates\n\t\t\t\tsystemExtensions = systemExtensions.filter(extension => !areSameExtensions(extension.identifier, webExtension.identifier));\n\t\t\t\tsystemExtensions.push(webExtension);\n\t\t\t\treturn systemExtensions;\n\t\t\t});\n\t\t\treturn extension;\n\t\t}\n\n\t\t// Update custom builtin extensions to custom builtin extensions cache\n\t\tif (isBuiltin) {\n\t\t\tawait this.writeCustomBuiltinExtensionsCache(customBuiltinExtensions => {\n\t\t\t\t// Remove the existing extension to avoid duplicates\n\t\t\t\tcustomBuiltinExtensions = customBuiltinExtensions.filter(extension => !areSameExtensions(extension.identifier, webExtension.identifier));\n\t\t\t\tcustomBuiltinExtensions.push(webExtension);\n\t\t\t\treturn customBuiltinExtensions;\n\t\t\t});\n\n\t\t\tconst installedExtensions = await this.readInstalledExtensions(profileLocation);\n\t\t\t// Also add to installed extensions if it is installed to update its version\n\t\t\tif (installedExtensions.some(e => areSameExtensions(e.identifier, webExtension.identifier))) {\n\t\t\t\tawait this.addToInstalledExtensions([webExtension], profileLocation);\n\t\t\t}\n\t\t\treturn extension;\n\t\t}\n\n\t\t// Add to installed extensions\n\t\tawait this.addToInstalledExtensions([webExtension], profileLocation);\n\t\treturn extension;\n\t}\n\n\tprivate async addToInstalledExtensions(webExtensions: IWebExtension[], profileLocation: URI): Promise<void> {\n\t\tawait this.writeInstalledExtensions(profileLocation, installedExtensions => {\n\t\t\t// Remove the existing extension to avoid duplicates\n\t\t\tinstalledExtensions = installedExtensions.filter(installedExtension => webExtensions.some(extension => !areSameExtensions(installedExtension.identifier, extension.identifier)));\n\t\t\tinstalledExtensions.push(...webExtensions);\n\t\t\treturn installedExtensions;\n\t\t});\n\t}\n\n\tprivate async scanInstalledExtensions(profileLocation: URI, scanOptions?: ScanOptions): Promise<IScannedExtension[]> {\n\t\tlet installedExtensions = await this.readInstalledExtensions(profileLocation);\n\n\t\t// If current profile is not a default profile, then add the application extensions to the list\n\t\tif (!this.uriIdentityService.extUri.isEqual(profileLocation, this.userDataProfilesService.defaultProfile.extensionsResource)) {\n\t\t\t// Remove application extensions from the non default profile\n\t\t\tinstalledExtensions = installedExtensions.filter(i => !i.metadata?.isApplicationScoped);\n\t\t\t// Add application extensions from the default profile to the list\n\t\t\tconst defaultProfileExtensions = await this.readInstalledExtensions(this.userDataProfilesService.defaultProfile.extensionsResource);\n\t\t\tinstalledExtensions.push(...defaultProfileExtensions.filter(i => i.metadata?.isApplicationScoped));\n\t\t}\n\n\t\tinstalledExtensions.sort((a, b) => a.identifier.id < b.identifier.id ? -1 : a.identifier.id > b.identifier.id ? 1 : semver.rcompare(a.version, b.version));\n\t\tconst result = new Map<string, IScannedExtension>();\n\t\tfor (const webExtension of installedExtensions) {\n\t\t\tconst existing = result.get(webExtension.identifier.id.toLowerCase());\n\t\t\tif (existing && semver.gt(existing.manifest.version, webExtension.version)) {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tconst extension = await this.toScannedExtension(webExtension, false);\n\t\t\tif (extension.isValid || !scanOptions?.skipInvalidExtensions) {\n\t\t\t\tresult.set(extension.identifier.id.toLowerCase(), extension);\n\t\t\t} else {\n\t\t\t\tthis.logService.info(`Skipping invalid installed extension ${webExtension.identifier.id}`);\n\t\t\t}\n\t\t}\n\t\treturn [...result.values()];\n\t}\n\n\tprivate async toWebExtensionFromGallery(galleryExtension: IGalleryExtension, metadata?: Metadata): Promise<IWebExtension> {\n\t\tconst extensionLocation = await this.extensionResourceLoaderService.getExtensionGalleryResourceURL({\n\t\t\tpublisher: galleryExtension.publisher,\n\t\t\tname: galleryExtension.name,\n\t\t\tversion: galleryExtension.version,\n\t\t\ttargetPlatform: galleryExtension.properties.targetPlatform === TargetPlatform.WEB ? TargetPlatform.WEB : undefined\n\t\t}, 'extension');\n\n\t\tif (!extensionLocation) {\n\t\t\tthrow new Error('No extension gallery service configured.');\n\t\t}\n\n\t\treturn this.toWebExtensionFromExtensionGalleryResource(extensionLocation,\n\t\t\tgalleryExtension.identifier,\n\t\t\tgalleryExtension.assets.readme ? URI.parse(galleryExtension.assets.readme.uri) : undefined,\n\t\t\tgalleryExtension.assets.changelog ? URI.parse(galleryExtension.assets.changelog.uri) : undefined,\n\t\t\tmetadata);\n\t}\n\n\tprivate async toWebExtensionFromExtensionGalleryResource(extensionLocation: URI, identifier?: IExtensionIdentifier, readmeUri?: URI, changelogUri?: URI, metadata?: Metadata): Promise<IWebExtension> {\n\t\tconst extensionResources = await this.listExtensionResources(extensionLocation);\n\t\tconst packageNLSResources = this.getPackageNLSResourceMapFromResources(extensionResources);\n\n\t\t// The fallback, in English, will fill in any gaps missing in the localized file.\n\t\tconst fallbackPackageNLSResource = extensionResources.find(e => basename(e) === 'package.nls.json');\n\t\treturn this.toWebExtension(\n\t\t\textensionLocation,\n\t\t\tidentifier,\n\t\t\tundefined,\n\t\t\tpackageNLSResources,\n\t\t\tfallbackPackageNLSResource ? URI.parse(fallbackPackageNLSResource) : null,\n\t\t\treadmeUri,\n\t\t\tchangelogUri,\n\t\t\tmetadata);\n\t}\n\n\tprivate getPackageNLSResourceMapFromResources(extensionResources: string[]): Map<string, URI> {\n\t\tconst packageNLSResources = new Map<string, URI>();\n\t\textensionResources.forEach(e => {\n\t\t\t// Grab all package.nls.{language}.json files\n\t\t\tconst regexResult = /package\\.nls\\.([\\w-]+)\\.json/.exec(basename(e));\n\t\t\tif (regexResult?.[1]) {\n\t\t\t\tpackageNLSResources.set(regexResult[1], URI.parse(e));\n\t\t\t}\n\t\t});\n\t\treturn packageNLSResources;\n\t}\n\n\tprivate async toWebExtension(extensionLocation: URI, identifier?: IExtensionIdentifier, manifest?: IExtensionManifest, packageNLSUris?: Map<string, URI>, fallbackPackageNLSUri?: URI | ITranslations | null, readmeUri?: URI, changelogUri?: URI, metadata?: Metadata): Promise<IWebExtension> {\n\t\tif (!manifest) {\n\t\t\ttry {\n\t\t\t\tmanifest = await this.getExtensionManifest(extensionLocation);\n\t\t\t} catch (error) {\n\t\t\t\tthrow new Error(`Error while fetching manifest from the location '${extensionLocation.toString()}'. ${getErrorMessage(error)}`);\n\t\t\t}\n\t\t}\n\n\t\tif (!this.extensionManifestPropertiesService.canExecuteOnWeb(manifest)) {\n\t\t\tthrow new Error(localize('not a web extension', \"Cannot add '{0}' because this extension is not a web extension.\", manifest.displayName || manifest.name));\n\t\t}\n\n\t\tif (fallbackPackageNLSUri === undefined) {\n\t\t\ttry {\n\t\t\t\tfallbackPackageNLSUri = joinPath(extensionLocation, 'package.nls.json');\n\t\t\t\tawait this.extensionResourceLoaderService.readExtensionResource(fallbackPackageNLSUri);\n\t\t\t} catch (error) {\n\t\t\t\tfallbackPackageNLSUri = undefined;\n\t\t\t}\n\t\t}\n\t\tconst defaultManifestTranslations: ITranslations | null | undefined = fallbackPackageNLSUri ? URI.isUri(fallbackPackageNLSUri) ? await this.getTranslations(fallbackPackageNLSUri) : fallbackPackageNLSUri : null;\n\n\t\treturn {\n\t\t\tidentifier: { id: getGalleryExtensionId(manifest.publisher, manifest.name), uuid: identifier?.uuid },\n\t\t\tversion: manifest.version,\n\t\t\tlocation: extensionLocation,\n\t\t\tmanifest,\n\t\t\treadmeUri,\n\t\t\tchangelogUri,\n\t\t\tpackageNLSUris,\n\t\t\tfallbackPackageNLSUri: URI.isUri(fallbackPackageNLSUri) ? fallbackPackageNLSUri : undefined,\n\t\t\tdefaultManifestTranslations,\n\t\t\tmetadata,\n\t\t};\n\t}\n\n\tprivate async toScannedExtension(webExtension: IWebExtension, isBuiltin: boolean, type: ExtensionType = ExtensionType.User): Promise<IScannedExtension> {\n\t\tconst validations: [Severity, string][] = [];\n\t\tlet manifest: IRelaxedExtensionManifest | undefined = webExtension.manifest;\n\n\t\tif (!manifest) {\n\t\t\ttry {\n\t\t\t\tmanifest = await this.getExtensionManifest(webExtension.location);\n\t\t\t} catch (error) {\n\t\t\t\tvalidations.push([Severity.Error, `Error while fetching manifest from the location '${webExtension.location}'. ${getErrorMessage(error)}`]);\n\t\t\t}\n\t\t}\n\n\t\tif (!manifest) {\n\t\t\tconst [publisher, name] = webExtension.identifier.id.split('.');\n\t\t\tmanifest = {\n\t\t\t\tname,\n\t\t\t\tpublisher,\n\t\t\t\tversion: webExtension.version,\n\t\t\t\tengines: { vscode: '*' },\n\t\t\t};\n\t\t}\n\n\t\tconst packageNLSUri = webExtension.packageNLSUris?.get(Language.value().toLowerCase());\n\t\tconst fallbackPackageNLS = webExtension.defaultManifestTranslations ?? webExtension.fallbackPackageNLSUri;\n\n\t\tif (packageNLSUri) {\n\t\t\tmanifest = await this.translateManifest(manifest, packageNLSUri, fallbackPackageNLS);\n\t\t} else if (fallbackPackageNLS) {\n\t\t\tmanifest = await this.translateManifest(manifest, fallbackPackageNLS);\n\t\t}\n\n\t\tconst uuid = (<IGalleryMetadata | undefined>webExtension.metadata)?.id;\n\n\t\tconst validateApiVersion = this.extensionsEnabledWithApiProposalVersion.includes(webExtension.identifier.id.toLowerCase());\n\t\tvalidations.push(...validateExtensionManifest(this.productService.version, this.productService.date, webExtension.location, manifest, false, validateApiVersion));\n\t\tlet isValid = true;\n\t\tfor (const [severity, message] of validations) {\n\t\t\tif (severity === Severity.Error) {\n\t\t\t\tisValid = false;\n\t\t\t\tthis.logService.error(message);\n\t\t\t}\n\t\t}\n\n\t\tif (manifest.enabledApiProposals && validateApiVersion) {\n\t\t\tmanifest.enabledApiProposals = parseEnabledApiProposalNames([...manifest.enabledApiProposals]);\n\t\t}\n\n\t\treturn {\n\t\t\tidentifier: { id: webExtension.identifier.id, uuid: webExtension.identifier.uuid || uuid },\n\t\t\tlocation: webExtension.location,\n\t\t\tmanifest,\n\t\t\ttype,\n\t\t\tisBuiltin,\n\t\t\treadmeUrl: webExtension.readmeUri,\n\t\t\tchangelogUrl: webExtension.changelogUri,\n\t\t\tmetadata: webExtension.metadata,\n\t\t\ttargetPlatform: TargetPlatform.WEB,\n\t\t\tvalidations,\n\t\t\tisValid,\n\t\t\tpreRelease: !!webExtension.metadata?.preRelease,\n\t\t};\n\t}\n\n\tprivate async listExtensionResources(extensionLocation: URI): Promise<string[]> {\n\t\ttry {\n\t\t\tconst result = await this.extensionResourceLoaderService.readExtensionResource(extensionLocation);\n\t\t\treturn JSON.parse(result);\n\t\t} catch (error) {\n\t\t\tthis.logService.warn('Error while fetching extension resources list', getErrorMessage(error));\n\t\t}\n\t\treturn [];\n\t}\n\n\tprivate async translateManifest(manifest: IExtensionManifest, nlsURL: ITranslations | URI, fallbackNLS?: ITranslations | URI): Promise<IRelaxedExtensionManifest> {\n\t\ttry {\n\t\t\tconst translations = URI.isUri(nlsURL) ? await this.getTranslations(nlsURL) : nlsURL;\n\t\t\tconst fallbackTranslations = URI.isUri(fallbackNLS) ? await this.getTranslations(fallbackNLS) : fallbackNLS;\n\t\t\tif (translations) {\n\t\t\t\tmanifest = localizeManifest(this.logService, manifest, translations, fallbackTranslations);\n\t\t\t}\n\t\t} catch (error) { /* ignore */ }\n\t\treturn manifest;\n\t}\n\n\tprivate async getExtensionManifest(location: URI): Promise<IExtensionManifest> {\n\t\tconst url = joinPath(location, 'package.json');\n\t\tconst content = await this.extensionResourceLoaderService.readExtensionResource(url);\n\t\treturn JSON.parse(content);\n\t}\n\n\tprivate async getTranslations(nlsUrl: URI): Promise<ITranslations | undefined> {\n\t\ttry {\n\t\t\tconst content = await this.extensionResourceLoaderService.readExtensionResource(nlsUrl);\n\t\t\treturn JSON.parse(content);\n\t\t} catch (error) {\n\t\t\tthis.logService.error(`Error while fetching translations of an extension`, nlsUrl.toString(), getErrorMessage(error));\n\t\t}\n\t\treturn undefined;\n\t}\n\n\tprivate async readInstalledExtensions(profileLocation: URI): Promise<IWebExtension[]> {\n\t\treturn this.withWebExtensions(profileLocation);\n\t}\n\n\tprivate writeInstalledExtensions(profileLocation: URI, updateFn: (extensions: IWebExtension[]) => IWebExtension[]): Promise<IWebExtension[]> {\n\t\treturn this.withWebExtensions(profileLocation, updateFn);\n\t}\n\n\tprivate readCustomBuiltinExtensionsCache(): Promise<IWebExtension[]> {\n\t\treturn this.withWebExtensions(this.customBuiltinExtensionsCacheResource);\n\t}\n\n\tprivate writeCustomBuiltinExtensionsCache(updateFn: (extensions: IWebExtension[]) => IWebExtension[]): Promise<IWebExtension[]> {\n\t\treturn this.withWebExtensions(this.customBuiltinExtensionsCacheResource, updateFn);\n\t}\n\n\tprivate readSystemExtensionsCache(): Promise<IWebExtension[]> {\n\t\treturn this.withWebExtensions(this.systemExtensionsCacheResource);\n\t}\n\n\tprivate writeSystemExtensionsCache(updateFn: (extensions: IWebExtension[]) => IWebExtension[]): Promise<IWebExtension[]> {\n\t\treturn this.withWebExtensions(this.systemExtensionsCacheResource, updateFn);\n\t}\n\n\tprivate async withWebExtensions(file: URI | undefined, updateFn?: (extensions: IWebExtension[]) => IWebExtension[]): Promise<IWebExtension[]> {\n\t\tif (!file) {\n\t\t\treturn [];\n\t\t}\n\t\treturn this.getResourceAccessQueue(file).queue(async () => {\n\t\t\tlet webExtensions: IWebExtension[] = [];\n\n\t\t\t// Read\n\t\t\ttry {\n\t\t\t\tconst content = await this.fileService.readFile(file);\n\t\t\t\tconst storedWebExtensions: IStoredWebExtension[] = JSON.parse(content.value.toString());\n\t\t\t\tfor (const e of storedWebExtensions) {\n\t\t\t\t\tif (!e.location || !e.identifier || !e.version) {\n\t\t\t\t\t\tthis.logService.info('Ignoring invalid extension while scanning', storedWebExtensions);\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\t\tlet packageNLSUris: Map<string, URI> | undefined;\n\t\t\t\t\tif (e.packageNLSUris) {\n\t\t\t\t\t\tpackageNLSUris = new Map<string, URI>();\n\t\t\t\t\t\tObject.entries(e.packageNLSUris).forEach(([key, value]) => packageNLSUris!.set(key, URI.revive(value)));\n\t\t\t\t\t}\n\n\t\t\t\t\twebExtensions.push({\n\t\t\t\t\t\tidentifier: e.identifier,\n\t\t\t\t\t\tversion: e.version,\n\t\t\t\t\t\tlocation: URI.revive(e.location),\n\t\t\t\t\t\tmanifest: e.manifest,\n\t\t\t\t\t\treadmeUri: URI.revive(e.readmeUri),\n\t\t\t\t\t\tchangelogUri: URI.revive(e.changelogUri),\n\t\t\t\t\t\tpackageNLSUris,\n\t\t\t\t\t\tfallbackPackageNLSUri: URI.revive(e.fallbackPackageNLSUri),\n\t\t\t\t\t\tdefaultManifestTranslations: e.defaultManifestTranslations,\n\t\t\t\t\t\tpackageNLSUri: URI.revive(e.packageNLSUri),\n\t\t\t\t\t\tmetadata: e.metadata,\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\ttry {\n\t\t\t\t\twebExtensions = await this.migrateWebExtensions(webExtensions, file);\n\t\t\t\t} catch (error) {\n\t\t\t\t\tthis.logService.error(`Error while migrating scanned extensions in ${file.toString()}`, getErrorMessage(error));\n\t\t\t\t}\n\n\t\t\t} catch (error) {\n\t\t\t\t/* Ignore */\n\t\t\t\tif ((<FileOperationError>error).fileOperationResult !== FileOperationResult.FILE_NOT_FOUND) {\n\t\t\t\t\tthis.logService.error(error);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Update\n\t\t\tif (updateFn) {\n\t\t\t\tawait this.storeWebExtensions(webExtensions = updateFn(webExtensions), file);\n\t\t\t}\n\n\t\t\treturn webExtensions;\n\t\t});\n\t}\n\n\tprivate async migrateWebExtensions(webExtensions: IWebExtension[], file: URI): Promise<IWebExtension[]> {\n\t\tlet update = false;\n\t\twebExtensions = await Promise.all(webExtensions.map(async webExtension => {\n\t\t\tif (!webExtension.manifest) {\n\t\t\t\ttry {\n\t\t\t\t\twebExtension.manifest = await this.getExtensionManifest(webExtension.location);\n\t\t\t\t\tupdate = true;\n\t\t\t\t} catch (error) {\n\t\t\t\t\tthis.logService.error(`Error while updating manifest of an extension in ${file.toString()}`, webExtension.identifier.id, getErrorMessage(error));\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (isUndefined(webExtension.defaultManifestTranslations)) {\n\t\t\t\tif (webExtension.fallbackPackageNLSUri) {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tconst content = await this.extensionResourceLoaderService.readExtensionResource(webExtension.fallbackPackageNLSUri);\n\t\t\t\t\t\twebExtension.defaultManifestTranslations = JSON.parse(content);\n\t\t\t\t\t\tupdate = true;\n\t\t\t\t\t} catch (error) {\n\t\t\t\t\t\tthis.logService.error(`Error while fetching default manifest translations of an extension`, webExtension.identifier.id, getErrorMessage(error));\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tupdate = true;\n\t\t\t\t\twebExtension.defaultManifestTranslations = null;\n\t\t\t\t}\n\t\t\t}\n\t\t\tconst migratedLocation = migratePlatformSpecificExtensionGalleryResourceURL(webExtension.location, TargetPlatform.WEB);\n\t\t\tif (migratedLocation) {\n\t\t\t\tupdate = true;\n\t\t\t\twebExtension.location = migratedLocation;\n\t\t\t}\n\t\t\tif (isUndefined(webExtension.metadata?.hasPreReleaseVersion) && webExtension.metadata?.preRelease) {\n\t\t\t\tupdate = true;\n\t\t\t\twebExtension.metadata.hasPreReleaseVersion = true;\n\t\t\t}\n\t\t\treturn webExtension;\n\t\t}));\n\t\tif (update) {\n\t\t\tawait this.storeWebExtensions(webExtensions, file);\n\t\t}\n\t\treturn webExtensions;\n\t}\n\n\tprivate async storeWebExtensions(webExtensions: IWebExtension[], file: URI): Promise<void> {\n\t\tfunction toStringDictionary(dictionary: Map<string, URI> | undefined): IStringDictionary<UriComponents> | undefined {\n\t\t\tif (!dictionary) {\n\t\t\t\treturn undefined;\n\t\t\t}\n\t\t\tconst result: IStringDictionary<UriComponents> = Object.create(null);\n\t\t\tdictionary.forEach((value, key) => result[key] = value.toJSON());\n\t\t\treturn result;\n\t\t}\n\t\tconst storedWebExtensions: IStoredWebExtension[] = webExtensions.map(e => ({\n\t\t\tidentifier: e.identifier,\n\t\t\tversion: e.version,\n\t\t\tmanifest: e.manifest,\n\t\t\tlocation: e.location.toJSON(),\n\t\t\treadmeUri: e.readmeUri?.toJSON(),\n\t\t\tchangelogUri: e.changelogUri?.toJSON(),\n\t\t\tpackageNLSUris: toStringDictionary(e.packageNLSUris),\n\t\t\tdefaultManifestTranslations: e.defaultManifestTranslations,\n\t\t\tfallbackPackageNLSUri: e.fallbackPackageNLSUri?.toJSON(),\n\t\t\tmetadata: e.metadata\n\t\t}));\n\t\tawait this.fileService.writeFile(file, VSBuffer.fromString(JSON.stringify(storedWebExtensions)));\n\t}\n\n\tprivate getResourceAccessQueue(file: URI): Queue<IWebExtension[]> {\n\t\tlet resourceQueue = this.resourcesAccessQueueMap.get(file);\n\t\tif (!resourceQueue) {\n\t\t\tthis.resourcesAccessQueueMap.set(file, resourceQueue = new Queue<IWebExtension[]>());\n\t\t}\n\t\treturn resourceQueue;\n\t}\n\n}\n\nif (isWeb) {\n\tregisterAction2(class extends Action2 {\n\t\tconstructor() {\n\t\t\tsuper({\n\t\t\t\tid: 'workbench.extensions.action.openInstalledWebExtensionsResource',\n\t\t\t\ttitle: localize2('openInstalledWebExtensionsResource', 'Open Installed Web Extensions Resource'),\n\t\t\t\tcategory: Categories.Developer,\n\t\t\t\tf1: true,\n\t\t\t\tprecondition: IsWebContext\n\t\t\t});\n\t\t}\n\t\trun(serviceAccessor: ServicesAccessor): void {\n\t\t\tconst editorService = serviceAccessor.get(IEditorService);\n\t\t\tconst userDataProfileService = serviceAccessor.get(IUserDataProfileService);\n\t\t\teditorService.openEditor({ resource: userDataProfileService.currentProfile.extensionsResource });\n\t\t}\n\t});\n}\n\nregisterSingleton(IWebExtensionsScannerService, WebExtensionsScannerService, InstantiationType.Delayed);\n"]}