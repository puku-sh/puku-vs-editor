{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/services/extensionManagement/browser/builtinExtensionsScannerService.ts","vs/workbench/services/extensionManagement/browser/builtinExtensionsScannerService.ts"],"names":[],"mappings":"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","file":"builtinExtensionsScannerService.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { IBuiltinExtensionsScannerService, ExtensionType, IExtensionManifest, TargetPlatform, IExtension } from '../../../../platform/extensions/common/extensions.js';\nimport { isWeb, Language } from '../../../../base/common/platform.js';\nimport { IWorkbenchEnvironmentService } from '../../environment/common/environmentService.js';\nimport { IUriIdentityService } from '../../../../platform/uriIdentity/common/uriIdentity.js';\nimport { InstantiationType, registerSingleton } from '../../../../platform/instantiation/common/extensions.js';\nimport { getGalleryExtensionId } from '../../../../platform/extensionManagement/common/extensionManagementUtil.js';\nimport { builtinExtensionsPath, FileAccess } from '../../../../base/common/network.js';\nimport { URI } from '../../../../base/common/uri.js';\nimport { IExtensionResourceLoaderService } from '../../../../platform/extensionResourceLoader/common/extensionResourceLoader.js';\nimport { IProductService } from '../../../../platform/product/common/productService.js';\nimport { ITranslations, localizeManifest } from '../../../../platform/extensionManagement/common/extensionNls.js';\nimport { ILogService } from '../../../../platform/log/common/log.js';\nimport { mainWindow } from '../../../../base/browser/window.js';\n\ninterface IBundledExtension {\n\textensionPath: string;\n\tpackageJSON: IExtensionManifest;\n\tpackageNLS?: ITranslations;\n\treadmePath?: string;\n\tchangelogPath?: string;\n}\n\nexport class BuiltinExtensionsScannerService implements IBuiltinExtensionsScannerService {\n\n\tdeclare readonly _serviceBrand: undefined;\n\n\tprivate readonly builtinExtensionsPromises: Promise<IExtension>[] = [];\n\n\tprivate nlsUrl: URI | undefined;\n\n\tconstructor(\n\t\t@IWorkbenchEnvironmentService environmentService: IWorkbenchEnvironmentService,\n\t\t@IUriIdentityService uriIdentityService: IUriIdentityService,\n\t\t@IExtensionResourceLoaderService private readonly extensionResourceLoaderService: IExtensionResourceLoaderService,\n\t\t@IProductService productService: IProductService,\n\t\t@ILogService private readonly logService: ILogService\n\t) {\n\t\tif (isWeb) {\n\t\t\tconst nlsBaseUrl = productService.extensionsGallery?.nlsBaseUrl;\n\t\t\t// Only use the nlsBaseUrl if we are using a language other than the default, English.\n\t\t\tif (nlsBaseUrl && productService.commit && !Language.isDefaultVariant()) {\n\t\t\t\tthis.nlsUrl = URI.joinPath(URI.parse(nlsBaseUrl), productService.commit, productService.version, Language.value());\n\t\t\t}\n\n\t\t\tconst builtinExtensionsServiceUrl = FileAccess.asBrowserUri(builtinExtensionsPath);\n\t\t\tif (builtinExtensionsServiceUrl) {\n\t\t\t\tlet bundledExtensions: IBundledExtension[] = [];\n\n\t\t\t\tif (environmentService.isBuilt) {\n\t\t\t\t\t// Built time configuration (do NOT modify)\n\t\t\t\t\tbundledExtensions = [/*BUILD->INSERT_BUILTIN_EXTENSIONS*/];\n\t\t\t\t} else {\n\t\t\t\t\t// Find builtin extensions by checking for DOM\n\t\t\t\t\t// eslint-disable-next-line no-restricted-syntax\n\t\t\t\t\tconst builtinExtensionsElement = mainWindow.document.getElementById('vscode-workbench-builtin-extensions');\n\t\t\t\t\tconst builtinExtensionsElementAttribute = builtinExtensionsElement ? builtinExtensionsElement.getAttribute('data-settings') : undefined;\n\t\t\t\t\tif (builtinExtensionsElementAttribute) {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tbundledExtensions = JSON.parse(builtinExtensionsElementAttribute);\n\t\t\t\t\t\t} catch (error) { /* ignore error*/ }\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tthis.builtinExtensionsPromises = bundledExtensions.map(async e => {\n\t\t\t\t\tconst id = getGalleryExtensionId(e.packageJSON.publisher, e.packageJSON.name);\n\t\t\t\t\treturn {\n\t\t\t\t\t\tidentifier: { id },\n\t\t\t\t\t\tlocation: uriIdentityService.extUri.joinPath(builtinExtensionsServiceUrl, e.extensionPath),\n\t\t\t\t\t\ttype: ExtensionType.System,\n\t\t\t\t\t\tisBuiltin: true,\n\t\t\t\t\t\tmanifest: e.packageNLS ? await this.localizeManifest(id, e.packageJSON, e.packageNLS) : e.packageJSON,\n\t\t\t\t\t\treadmeUrl: e.readmePath ? uriIdentityService.extUri.joinPath(builtinExtensionsServiceUrl, e.readmePath) : undefined,\n\t\t\t\t\t\tchangelogUrl: e.changelogPath ? uriIdentityService.extUri.joinPath(builtinExtensionsServiceUrl, e.changelogPath) : undefined,\n\t\t\t\t\t\ttargetPlatform: TargetPlatform.WEB,\n\t\t\t\t\t\tvalidations: [],\n\t\t\t\t\t\tisValid: true,\n\t\t\t\t\t\tpreRelease: false,\n\t\t\t\t\t};\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n\n\tasync scanBuiltinExtensions(): Promise<IExtension[]> {\n\t\treturn [...await Promise.all(this.builtinExtensionsPromises)];\n\t}\n\n\tprivate async localizeManifest(extensionId: string, manifest: IExtensionManifest, fallbackTranslations: ITranslations): Promise<IExtensionManifest> {\n\t\tif (!this.nlsUrl) {\n\t\t\treturn localizeManifest(this.logService, manifest, fallbackTranslations);\n\t\t}\n\t\t// the `package` endpoint returns the translations in a key-value format similar to the package.nls.json file.\n\t\tconst uri = URI.joinPath(this.nlsUrl, extensionId, 'package');\n\t\ttry {\n\t\t\tconst res = await this.extensionResourceLoaderService.readExtensionResource(uri);\n\t\t\tconst json = JSON.parse(res.toString());\n\t\t\treturn localizeManifest(this.logService, manifest, json, fallbackTranslations);\n\t\t} catch (e) {\n\t\t\tthis.logService.error(e);\n\t\t\treturn localizeManifest(this.logService, manifest, fallbackTranslations);\n\t\t}\n\t}\n}\n\nregisterSingleton(IBuiltinExtensionsScannerService, BuiltinExtensionsScannerService, InstantiationType.Delayed);\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { IBuiltinExtensionsScannerService, ExtensionType, IExtensionManifest, TargetPlatform, IExtension } from '../../../../platform/extensions/common/extensions.js';\nimport { isWeb, Language } from '../../../../base/common/platform.js';\nimport { IWorkbenchEnvironmentService } from '../../environment/common/environmentService.js';\nimport { IUriIdentityService } from '../../../../platform/uriIdentity/common/uriIdentity.js';\nimport { InstantiationType, registerSingleton } from '../../../../platform/instantiation/common/extensions.js';\nimport { getGalleryExtensionId } from '../../../../platform/extensionManagement/common/extensionManagementUtil.js';\nimport { builtinExtensionsPath, FileAccess } from '../../../../base/common/network.js';\nimport { URI } from '../../../../base/common/uri.js';\nimport { IExtensionResourceLoaderService } from '../../../../platform/extensionResourceLoader/common/extensionResourceLoader.js';\nimport { IProductService } from '../../../../platform/product/common/productService.js';\nimport { ITranslations, localizeManifest } from '../../../../platform/extensionManagement/common/extensionNls.js';\nimport { ILogService } from '../../../../platform/log/common/log.js';\nimport { mainWindow } from '../../../../base/browser/window.js';\n\ninterface IBundledExtension {\n\textensionPath: string;\n\tpackageJSON: IExtensionManifest;\n\tpackageNLS?: ITranslations;\n\treadmePath?: string;\n\tchangelogPath?: string;\n}\n\nexport class BuiltinExtensionsScannerService implements IBuiltinExtensionsScannerService {\n\n\tdeclare readonly _serviceBrand: undefined;\n\n\tprivate readonly builtinExtensionsPromises: Promise<IExtension>[] = [];\n\n\tprivate nlsUrl: URI | undefined;\n\n\tconstructor(\n\t\t@IWorkbenchEnvironmentService environmentService: IWorkbenchEnvironmentService,\n\t\t@IUriIdentityService uriIdentityService: IUriIdentityService,\n\t\t@IExtensionResourceLoaderService private readonly extensionResourceLoaderService: IExtensionResourceLoaderService,\n\t\t@IProductService productService: IProductService,\n\t\t@ILogService private readonly logService: ILogService\n\t) {\n\t\tif (isWeb) {\n\t\t\tconst nlsBaseUrl = productService.extensionsGallery?.nlsBaseUrl;\n\t\t\t// Only use the nlsBaseUrl if we are using a language other than the default, English.\n\t\t\tif (nlsBaseUrl && productService.commit && !Language.isDefaultVariant()) {\n\t\t\t\tthis.nlsUrl = URI.joinPath(URI.parse(nlsBaseUrl), productService.commit, productService.version, Language.value());\n\t\t\t}\n\n\t\t\tconst builtinExtensionsServiceUrl = FileAccess.asBrowserUri(builtinExtensionsPath);\n\t\t\tif (builtinExtensionsServiceUrl) {\n\t\t\t\tlet bundledExtensions: IBundledExtension[] = [];\n\n\t\t\t\tif (environmentService.isBuilt) {\n\t\t\t\t\t// Built time configuration (do NOT modify)\n\t\t\t\t\tbundledExtensions = [/*BUILD->INSERT_BUILTIN_EXTENSIONS*/];\n\t\t\t\t} else {\n\t\t\t\t\t// Find builtin extensions by checking for DOM\n\t\t\t\t\t// eslint-disable-next-line no-restricted-syntax\n\t\t\t\t\tconst builtinExtensionsElement = mainWindow.document.getElementById('vscode-workbench-builtin-extensions');\n\t\t\t\t\tconst builtinExtensionsElementAttribute = builtinExtensionsElement ? builtinExtensionsElement.getAttribute('data-settings') : undefined;\n\t\t\t\t\tif (builtinExtensionsElementAttribute) {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tbundledExtensions = JSON.parse(builtinExtensionsElementAttribute);\n\t\t\t\t\t\t} catch (error) { /* ignore error*/ }\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tthis.builtinExtensionsPromises = bundledExtensions.map(async e => {\n\t\t\t\t\tconst id = getGalleryExtensionId(e.packageJSON.publisher, e.packageJSON.name);\n\t\t\t\t\treturn {\n\t\t\t\t\t\tidentifier: { id },\n\t\t\t\t\t\tlocation: uriIdentityService.extUri.joinPath(builtinExtensionsServiceUrl, e.extensionPath),\n\t\t\t\t\t\ttype: ExtensionType.System,\n\t\t\t\t\t\tisBuiltin: true,\n\t\t\t\t\t\tmanifest: e.packageNLS ? await this.localizeManifest(id, e.packageJSON, e.packageNLS) : e.packageJSON,\n\t\t\t\t\t\treadmeUrl: e.readmePath ? uriIdentityService.extUri.joinPath(builtinExtensionsServiceUrl, e.readmePath) : undefined,\n\t\t\t\t\t\tchangelogUrl: e.changelogPath ? uriIdentityService.extUri.joinPath(builtinExtensionsServiceUrl, e.changelogPath) : undefined,\n\t\t\t\t\t\ttargetPlatform: TargetPlatform.WEB,\n\t\t\t\t\t\tvalidations: [],\n\t\t\t\t\t\tisValid: true,\n\t\t\t\t\t\tpreRelease: false,\n\t\t\t\t\t};\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n\n\tasync scanBuiltinExtensions(): Promise<IExtension[]> {\n\t\treturn [...await Promise.all(this.builtinExtensionsPromises)];\n\t}\n\n\tprivate async localizeManifest(extensionId: string, manifest: IExtensionManifest, fallbackTranslations: ITranslations): Promise<IExtensionManifest> {\n\t\tif (!this.nlsUrl) {\n\t\t\treturn localizeManifest(this.logService, manifest, fallbackTranslations);\n\t\t}\n\t\t// the `package` endpoint returns the translations in a key-value format similar to the package.nls.json file.\n\t\tconst uri = URI.joinPath(this.nlsUrl, extensionId, 'package');\n\t\ttry {\n\t\t\tconst res = await this.extensionResourceLoaderService.readExtensionResource(uri);\n\t\t\tconst json = JSON.parse(res.toString());\n\t\t\treturn localizeManifest(this.logService, manifest, json, fallbackTranslations);\n\t\t} catch (e) {\n\t\t\tthis.logService.error(e);\n\t\t\treturn localizeManifest(this.logService, manifest, fallbackTranslations);\n\t\t}\n\t}\n}\n\nregisterSingleton(IBuiltinExtensionsScannerService, BuiltinExtensionsScannerService, InstantiationType.Delayed);\n"]}