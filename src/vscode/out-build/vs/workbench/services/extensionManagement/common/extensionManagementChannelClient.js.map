{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/services/extensionManagement/common/extensionManagementChannelClient.ts","vs/workbench/services/extensionManagement/common/extensionManagementChannelClient.ts"],"names":[],"mappings":"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","file":"extensionManagementChannelClient.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { ILocalExtension, IGalleryExtension, InstallOptions, UninstallOptions, Metadata, InstallExtensionResult, InstallExtensionInfo, IProductVersion, UninstallExtensionInfo, DidUninstallExtensionEvent, DidUpdateExtensionMetadata, InstallExtensionEvent, UninstallExtensionEvent, IAllowedExtensionsService } from '../../../../platform/extensionManagement/common/extensionManagement.js';\nimport { URI } from '../../../../base/common/uri.js';\nimport { ExtensionIdentifier, ExtensionType, IExtensionIdentifier } from '../../../../platform/extensions/common/extensions.js';\nimport { ExtensionManagementChannelClient as BaseExtensionManagementChannelClient } from '../../../../platform/extensionManagement/common/extensionManagementIpc.js';\nimport { IChannel } from '../../../../base/parts/ipc/common/ipc.js';\nimport { DidChangeUserDataProfileEvent, IUserDataProfileService } from '../../userDataProfile/common/userDataProfile.js';\nimport { Emitter } from '../../../../base/common/event.js';\nimport { delta } from '../../../../base/common/arrays.js';\nimport { compare } from '../../../../base/common/strings.js';\nimport { IUriIdentityService } from '../../../../platform/uriIdentity/common/uriIdentity.js';\nimport { DidChangeProfileEvent, IProfileAwareExtensionManagementService } from './extensionManagement.js';\nimport { IProductService } from '../../../../platform/product/common/productService.js';\n\nexport abstract class ProfileAwareExtensionManagementChannelClient extends BaseExtensionManagementChannelClient implements IProfileAwareExtensionManagementService {\n\n\tprivate readonly _onDidChangeProfile = this._register(new Emitter<{ readonly added: ILocalExtension[]; readonly removed: ILocalExtension[] }>());\n\treadonly onDidChangeProfile = this._onDidChangeProfile.event;\n\n\tprivate readonly _onDidProfileAwareInstallExtensions = this._register(new Emitter<readonly InstallExtensionResult[]>());\n\tget onProfileAwareDidInstallExtensions() { return this._onDidProfileAwareInstallExtensions.event; }\n\n\tprivate readonly _onDidProfileAwareUninstallExtension = this._register(new Emitter<DidUninstallExtensionEvent>());\n\tget onProfileAwareDidUninstallExtension() { return this._onDidProfileAwareUninstallExtension.event; }\n\n\tprivate readonly _onDidProfileAwareUpdateExtensionMetadata = this._register(new Emitter<DidUpdateExtensionMetadata>());\n\tget onProfileAwareDidUpdateExtensionMetadata() { return this._onDidProfileAwareUpdateExtensionMetadata.event; }\n\n\tconstructor(channel: IChannel,\n\t\tproductService: IProductService,\n\t\tallowedExtensionsService: IAllowedExtensionsService,\n\t\tprotected readonly userDataProfileService: IUserDataProfileService,\n\t\tprotected readonly uriIdentityService: IUriIdentityService,\n\t) {\n\t\tsuper(channel, productService, allowedExtensionsService);\n\t\tthis._register(userDataProfileService.onDidChangeCurrentProfile(e => {\n\t\t\tif (!this.uriIdentityService.extUri.isEqual(e.previous.extensionsResource, e.profile.extensionsResource)) {\n\t\t\t\te.join(this.whenProfileChanged(e));\n\t\t\t}\n\t\t}));\n\t}\n\n\tprotected override async onInstallExtensionEvent(data: InstallExtensionEvent): Promise<void> {\n\t\tconst result = this.filterEvent(data.profileLocation, data.applicationScoped ?? false);\n\t\tif (result instanceof Promise ? await result : result) {\n\t\t\tthis._onInstallExtension.fire(data);\n\t\t}\n\t}\n\n\tprotected override async onDidInstallExtensionsEvent(results: readonly InstallExtensionResult[]): Promise<void> {\n\t\tconst filtered = [];\n\t\tfor (const e of results) {\n\t\t\tconst result = this.filterEvent(e.profileLocation, e.applicationScoped ?? e.local?.isApplicationScoped ?? false);\n\t\t\tif (result instanceof Promise ? await result : result) {\n\t\t\t\tfiltered.push(e);\n\t\t\t}\n\t\t}\n\t\tif (filtered.length) {\n\t\t\tthis._onDidInstallExtensions.fire(filtered);\n\t\t}\n\t\tthis._onDidProfileAwareInstallExtensions.fire(results);\n\t}\n\n\tprotected override async onUninstallExtensionEvent(data: UninstallExtensionEvent): Promise<void> {\n\t\tconst result = this.filterEvent(data.profileLocation, data.applicationScoped ?? false);\n\t\tif (result instanceof Promise ? await result : result) {\n\t\t\tthis._onUninstallExtension.fire(data);\n\t\t}\n\t}\n\n\tprotected override async onDidUninstallExtensionEvent(data: DidUninstallExtensionEvent): Promise<void> {\n\t\tconst result = this.filterEvent(data.profileLocation, data.applicationScoped ?? false);\n\t\tif (result instanceof Promise ? await result : result) {\n\t\t\tthis._onDidUninstallExtension.fire(data);\n\t\t}\n\t\tthis._onDidProfileAwareUninstallExtension.fire(data);\n\t}\n\n\tprotected override async onDidUpdateExtensionMetadataEvent(data: DidUpdateExtensionMetadata): Promise<void> {\n\t\tconst result = this.filterEvent(data.profileLocation, data.local?.isApplicationScoped ?? false);\n\t\tif (result instanceof Promise ? await result : result) {\n\t\t\tthis._onDidUpdateExtensionMetadata.fire(data);\n\t\t}\n\t\tthis._onDidProfileAwareUpdateExtensionMetadata.fire(data);\n\t}\n\n\toverride async install(vsix: URI, installOptions?: InstallOptions): Promise<ILocalExtension> {\n\t\tinstallOptions = { ...installOptions, profileLocation: await this.getProfileLocation(installOptions?.profileLocation) };\n\t\treturn super.install(vsix, installOptions);\n\t}\n\n\toverride async installFromLocation(location: URI, profileLocation: URI): Promise<ILocalExtension> {\n\t\treturn super.installFromLocation(location, await this.getProfileLocation(profileLocation));\n\t}\n\n\toverride async installFromGallery(extension: IGalleryExtension, installOptions?: InstallOptions): Promise<ILocalExtension> {\n\t\tinstallOptions = { ...installOptions, profileLocation: await this.getProfileLocation(installOptions?.profileLocation) };\n\t\treturn super.installFromGallery(extension, installOptions);\n\t}\n\n\toverride async installGalleryExtensions(extensions: InstallExtensionInfo[]): Promise<InstallExtensionResult[]> {\n\t\tconst infos: InstallExtensionInfo[] = [];\n\t\tfor (const extension of extensions) {\n\t\t\tinfos.push({ ...extension, options: { ...extension.options, profileLocation: await this.getProfileLocation(extension.options?.profileLocation) } });\n\t\t}\n\t\treturn super.installGalleryExtensions(infos);\n\t}\n\n\toverride async uninstall(extension: ILocalExtension, options?: UninstallOptions): Promise<void> {\n\t\toptions = { ...options, profileLocation: await this.getProfileLocation(options?.profileLocation) };\n\t\treturn super.uninstall(extension, options);\n\t}\n\n\toverride async uninstallExtensions(extensions: UninstallExtensionInfo[]): Promise<void> {\n\t\tconst infos: UninstallExtensionInfo[] = [];\n\t\tfor (const { extension, options } of extensions) {\n\t\t\tinfos.push({ extension, options: { ...options, profileLocation: await this.getProfileLocation(options?.profileLocation) } });\n\t\t}\n\t\treturn super.uninstallExtensions(infos);\n\t}\n\n\toverride async getInstalled(type: ExtensionType | null = null, extensionsProfileResource?: URI, productVersion?: IProductVersion): Promise<ILocalExtension[]> {\n\t\treturn super.getInstalled(type, await this.getProfileLocation(extensionsProfileResource), productVersion);\n\t}\n\n\toverride async updateMetadata(local: ILocalExtension, metadata: Partial<Metadata>, extensionsProfileResource?: URI): Promise<ILocalExtension> {\n\t\treturn super.updateMetadata(local, metadata, await this.getProfileLocation(extensionsProfileResource));\n\t}\n\n\toverride async toggleApplicationScope(local: ILocalExtension, fromProfileLocation: URI): Promise<ILocalExtension> {\n\t\treturn super.toggleApplicationScope(local, await this.getProfileLocation(fromProfileLocation));\n\t}\n\n\toverride async copyExtensions(fromProfileLocation: URI, toProfileLocation: URI): Promise<void> {\n\t\treturn super.copyExtensions(await this.getProfileLocation(fromProfileLocation), await this.getProfileLocation(toProfileLocation));\n\t}\n\n\tprivate async whenProfileChanged(e: DidChangeUserDataProfileEvent): Promise<void> {\n\t\tconst previousProfileLocation = await this.getProfileLocation(e.previous.extensionsResource);\n\t\tconst currentProfileLocation = await this.getProfileLocation(e.profile.extensionsResource);\n\n\t\tif (this.uriIdentityService.extUri.isEqual(previousProfileLocation, currentProfileLocation)) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst eventData = await this.switchExtensionsProfile(previousProfileLocation, currentProfileLocation);\n\t\tthis._onDidChangeProfile.fire(eventData);\n\t}\n\n\tprotected async switchExtensionsProfile(previousProfileLocation: URI, currentProfileLocation: URI, preserveExtensions?: ExtensionIdentifier[]): Promise<DidChangeProfileEvent> {\n\t\tconst oldExtensions = await this.getInstalled(ExtensionType.User, previousProfileLocation);\n\t\tconst newExtensions = await this.getInstalled(ExtensionType.User, currentProfileLocation);\n\t\tif (preserveExtensions?.length) {\n\t\t\tconst extensionsToInstall: IExtensionIdentifier[] = [];\n\t\t\tfor (const extension of oldExtensions) {\n\t\t\t\tif (preserveExtensions.some(id => ExtensionIdentifier.equals(extension.identifier.id, id)) &&\n\t\t\t\t\t!newExtensions.some(e => ExtensionIdentifier.equals(e.identifier.id, extension.identifier.id))) {\n\t\t\t\t\textensionsToInstall.push(extension.identifier);\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (extensionsToInstall.length) {\n\t\t\t\tawait this.installExtensionsFromProfile(extensionsToInstall, previousProfileLocation, currentProfileLocation);\n\t\t\t}\n\t\t}\n\t\treturn delta(oldExtensions, newExtensions, (a, b) => compare(`${ExtensionIdentifier.toKey(a.identifier.id)}@${a.manifest.version}`, `${ExtensionIdentifier.toKey(b.identifier.id)}@${b.manifest.version}`));\n\t}\n\n\tprotected getProfileLocation(profileLocation: URI): Promise<URI>;\n\tprotected getProfileLocation(profileLocation?: URI): Promise<URI | undefined>;\n\tprotected async getProfileLocation(profileLocation?: URI): Promise<URI | undefined> {\n\t\treturn profileLocation ?? this.userDataProfileService.currentProfile.extensionsResource;\n\t}\n\n\tprotected abstract filterEvent(profileLocation: URI, isApplicationScoped: boolean): boolean | Promise<boolean>;\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { ILocalExtension, IGalleryExtension, InstallOptions, UninstallOptions, Metadata, InstallExtensionResult, InstallExtensionInfo, IProductVersion, UninstallExtensionInfo, DidUninstallExtensionEvent, DidUpdateExtensionMetadata, InstallExtensionEvent, UninstallExtensionEvent, IAllowedExtensionsService } from '../../../../platform/extensionManagement/common/extensionManagement.js';\nimport { URI } from '../../../../base/common/uri.js';\nimport { ExtensionIdentifier, ExtensionType, IExtensionIdentifier } from '../../../../platform/extensions/common/extensions.js';\nimport { ExtensionManagementChannelClient as BaseExtensionManagementChannelClient } from '../../../../platform/extensionManagement/common/extensionManagementIpc.js';\nimport { IChannel } from '../../../../base/parts/ipc/common/ipc.js';\nimport { DidChangeUserDataProfileEvent, IUserDataProfileService } from '../../userDataProfile/common/userDataProfile.js';\nimport { Emitter } from '../../../../base/common/event.js';\nimport { delta } from '../../../../base/common/arrays.js';\nimport { compare } from '../../../../base/common/strings.js';\nimport { IUriIdentityService } from '../../../../platform/uriIdentity/common/uriIdentity.js';\nimport { DidChangeProfileEvent, IProfileAwareExtensionManagementService } from './extensionManagement.js';\nimport { IProductService } from '../../../../platform/product/common/productService.js';\n\nexport abstract class ProfileAwareExtensionManagementChannelClient extends BaseExtensionManagementChannelClient implements IProfileAwareExtensionManagementService {\n\n\tprivate readonly _onDidChangeProfile = this._register(new Emitter<{ readonly added: ILocalExtension[]; readonly removed: ILocalExtension[] }>());\n\treadonly onDidChangeProfile = this._onDidChangeProfile.event;\n\n\tprivate readonly _onDidProfileAwareInstallExtensions = this._register(new Emitter<readonly InstallExtensionResult[]>());\n\tget onProfileAwareDidInstallExtensions() { return this._onDidProfileAwareInstallExtensions.event; }\n\n\tprivate readonly _onDidProfileAwareUninstallExtension = this._register(new Emitter<DidUninstallExtensionEvent>());\n\tget onProfileAwareDidUninstallExtension() { return this._onDidProfileAwareUninstallExtension.event; }\n\n\tprivate readonly _onDidProfileAwareUpdateExtensionMetadata = this._register(new Emitter<DidUpdateExtensionMetadata>());\n\tget onProfileAwareDidUpdateExtensionMetadata() { return this._onDidProfileAwareUpdateExtensionMetadata.event; }\n\n\tconstructor(channel: IChannel,\n\t\tproductService: IProductService,\n\t\tallowedExtensionsService: IAllowedExtensionsService,\n\t\tprotected readonly userDataProfileService: IUserDataProfileService,\n\t\tprotected readonly uriIdentityService: IUriIdentityService,\n\t) {\n\t\tsuper(channel, productService, allowedExtensionsService);\n\t\tthis._register(userDataProfileService.onDidChangeCurrentProfile(e => {\n\t\t\tif (!this.uriIdentityService.extUri.isEqual(e.previous.extensionsResource, e.profile.extensionsResource)) {\n\t\t\t\te.join(this.whenProfileChanged(e));\n\t\t\t}\n\t\t}));\n\t}\n\n\tprotected override async onInstallExtensionEvent(data: InstallExtensionEvent): Promise<void> {\n\t\tconst result = this.filterEvent(data.profileLocation, data.applicationScoped ?? false);\n\t\tif (result instanceof Promise ? await result : result) {\n\t\t\tthis._onInstallExtension.fire(data);\n\t\t}\n\t}\n\n\tprotected override async onDidInstallExtensionsEvent(results: readonly InstallExtensionResult[]): Promise<void> {\n\t\tconst filtered = [];\n\t\tfor (const e of results) {\n\t\t\tconst result = this.filterEvent(e.profileLocation, e.applicationScoped ?? e.local?.isApplicationScoped ?? false);\n\t\t\tif (result instanceof Promise ? await result : result) {\n\t\t\t\tfiltered.push(e);\n\t\t\t}\n\t\t}\n\t\tif (filtered.length) {\n\t\t\tthis._onDidInstallExtensions.fire(filtered);\n\t\t}\n\t\tthis._onDidProfileAwareInstallExtensions.fire(results);\n\t}\n\n\tprotected override async onUninstallExtensionEvent(data: UninstallExtensionEvent): Promise<void> {\n\t\tconst result = this.filterEvent(data.profileLocation, data.applicationScoped ?? false);\n\t\tif (result instanceof Promise ? await result : result) {\n\t\t\tthis._onUninstallExtension.fire(data);\n\t\t}\n\t}\n\n\tprotected override async onDidUninstallExtensionEvent(data: DidUninstallExtensionEvent): Promise<void> {\n\t\tconst result = this.filterEvent(data.profileLocation, data.applicationScoped ?? false);\n\t\tif (result instanceof Promise ? await result : result) {\n\t\t\tthis._onDidUninstallExtension.fire(data);\n\t\t}\n\t\tthis._onDidProfileAwareUninstallExtension.fire(data);\n\t}\n\n\tprotected override async onDidUpdateExtensionMetadataEvent(data: DidUpdateExtensionMetadata): Promise<void> {\n\t\tconst result = this.filterEvent(data.profileLocation, data.local?.isApplicationScoped ?? false);\n\t\tif (result instanceof Promise ? await result : result) {\n\t\t\tthis._onDidUpdateExtensionMetadata.fire(data);\n\t\t}\n\t\tthis._onDidProfileAwareUpdateExtensionMetadata.fire(data);\n\t}\n\n\toverride async install(vsix: URI, installOptions?: InstallOptions): Promise<ILocalExtension> {\n\t\tinstallOptions = { ...installOptions, profileLocation: await this.getProfileLocation(installOptions?.profileLocation) };\n\t\treturn super.install(vsix, installOptions);\n\t}\n\n\toverride async installFromLocation(location: URI, profileLocation: URI): Promise<ILocalExtension> {\n\t\treturn super.installFromLocation(location, await this.getProfileLocation(profileLocation));\n\t}\n\n\toverride async installFromGallery(extension: IGalleryExtension, installOptions?: InstallOptions): Promise<ILocalExtension> {\n\t\tinstallOptions = { ...installOptions, profileLocation: await this.getProfileLocation(installOptions?.profileLocation) };\n\t\treturn super.installFromGallery(extension, installOptions);\n\t}\n\n\toverride async installGalleryExtensions(extensions: InstallExtensionInfo[]): Promise<InstallExtensionResult[]> {\n\t\tconst infos: InstallExtensionInfo[] = [];\n\t\tfor (const extension of extensions) {\n\t\t\tinfos.push({ ...extension, options: { ...extension.options, profileLocation: await this.getProfileLocation(extension.options?.profileLocation) } });\n\t\t}\n\t\treturn super.installGalleryExtensions(infos);\n\t}\n\n\toverride async uninstall(extension: ILocalExtension, options?: UninstallOptions): Promise<void> {\n\t\toptions = { ...options, profileLocation: await this.getProfileLocation(options?.profileLocation) };\n\t\treturn super.uninstall(extension, options);\n\t}\n\n\toverride async uninstallExtensions(extensions: UninstallExtensionInfo[]): Promise<void> {\n\t\tconst infos: UninstallExtensionInfo[] = [];\n\t\tfor (const { extension, options } of extensions) {\n\t\t\tinfos.push({ extension, options: { ...options, profileLocation: await this.getProfileLocation(options?.profileLocation) } });\n\t\t}\n\t\treturn super.uninstallExtensions(infos);\n\t}\n\n\toverride async getInstalled(type: ExtensionType | null = null, extensionsProfileResource?: URI, productVersion?: IProductVersion): Promise<ILocalExtension[]> {\n\t\treturn super.getInstalled(type, await this.getProfileLocation(extensionsProfileResource), productVersion);\n\t}\n\n\toverride async updateMetadata(local: ILocalExtension, metadata: Partial<Metadata>, extensionsProfileResource?: URI): Promise<ILocalExtension> {\n\t\treturn super.updateMetadata(local, metadata, await this.getProfileLocation(extensionsProfileResource));\n\t}\n\n\toverride async toggleApplicationScope(local: ILocalExtension, fromProfileLocation: URI): Promise<ILocalExtension> {\n\t\treturn super.toggleApplicationScope(local, await this.getProfileLocation(fromProfileLocation));\n\t}\n\n\toverride async copyExtensions(fromProfileLocation: URI, toProfileLocation: URI): Promise<void> {\n\t\treturn super.copyExtensions(await this.getProfileLocation(fromProfileLocation), await this.getProfileLocation(toProfileLocation));\n\t}\n\n\tprivate async whenProfileChanged(e: DidChangeUserDataProfileEvent): Promise<void> {\n\t\tconst previousProfileLocation = await this.getProfileLocation(e.previous.extensionsResource);\n\t\tconst currentProfileLocation = await this.getProfileLocation(e.profile.extensionsResource);\n\n\t\tif (this.uriIdentityService.extUri.isEqual(previousProfileLocation, currentProfileLocation)) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst eventData = await this.switchExtensionsProfile(previousProfileLocation, currentProfileLocation);\n\t\tthis._onDidChangeProfile.fire(eventData);\n\t}\n\n\tprotected async switchExtensionsProfile(previousProfileLocation: URI, currentProfileLocation: URI, preserveExtensions?: ExtensionIdentifier[]): Promise<DidChangeProfileEvent> {\n\t\tconst oldExtensions = await this.getInstalled(ExtensionType.User, previousProfileLocation);\n\t\tconst newExtensions = await this.getInstalled(ExtensionType.User, currentProfileLocation);\n\t\tif (preserveExtensions?.length) {\n\t\t\tconst extensionsToInstall: IExtensionIdentifier[] = [];\n\t\t\tfor (const extension of oldExtensions) {\n\t\t\t\tif (preserveExtensions.some(id => ExtensionIdentifier.equals(extension.identifier.id, id)) &&\n\t\t\t\t\t!newExtensions.some(e => ExtensionIdentifier.equals(e.identifier.id, extension.identifier.id))) {\n\t\t\t\t\textensionsToInstall.push(extension.identifier);\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (extensionsToInstall.length) {\n\t\t\t\tawait this.installExtensionsFromProfile(extensionsToInstall, previousProfileLocation, currentProfileLocation);\n\t\t\t}\n\t\t}\n\t\treturn delta(oldExtensions, newExtensions, (a, b) => compare(`${ExtensionIdentifier.toKey(a.identifier.id)}@${a.manifest.version}`, `${ExtensionIdentifier.toKey(b.identifier.id)}@${b.manifest.version}`));\n\t}\n\n\tprotected getProfileLocation(profileLocation: URI): Promise<URI>;\n\tprotected getProfileLocation(profileLocation?: URI): Promise<URI | undefined>;\n\tprotected async getProfileLocation(profileLocation?: URI): Promise<URI | undefined> {\n\t\treturn profileLocation ?? this.userDataProfileService.currentProfile.extensionsResource;\n\t}\n\n\tprotected abstract filterEvent(profileLocation: URI, isApplicationScoped: boolean): boolean | Promise<boolean>;\n}\n"]}