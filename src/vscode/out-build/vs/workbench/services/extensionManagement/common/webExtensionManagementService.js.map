{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/services/extensionManagement/common/webExtensionManagementService.ts","vs/workbench/services/extensionManagement/common/webExtensionManagementService.ts"],"names":[],"mappings":"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","file":"webExtensionManagementService.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { ExtensionIdentifier, ExtensionType, IExtension, IExtensionIdentifier, IExtensionManifest, TargetPlatform } from '../../../../platform/extensions/common/extensions.js';\nimport { ILocalExtension, IGalleryExtension, InstallOperation, IExtensionGalleryService, Metadata, InstallOptions, IProductVersion, IAllowedExtensionsService } from '../../../../platform/extensionManagement/common/extensionManagement.js';\nimport { URI } from '../../../../base/common/uri.js';\nimport { Emitter, Event } from '../../../../base/common/event.js';\nimport { areSameExtensions, getGalleryExtensionId } from '../../../../platform/extensionManagement/common/extensionManagementUtil.js';\nimport { IProfileAwareExtensionManagementService, IScannedExtension, IWebExtensionsScannerService } from './extensionManagement.js';\nimport { ILogService } from '../../../../platform/log/common/log.js';\nimport { CancellationToken } from '../../../../base/common/cancellation.js';\nimport { AbstractExtensionManagementService, AbstractExtensionTask, IInstallExtensionTask, InstallExtensionTaskOptions, IUninstallExtensionTask, toExtensionManagementError, UninstallExtensionTaskOptions } from '../../../../platform/extensionManagement/common/abstractExtensionManagementService.js';\nimport { ITelemetryService } from '../../../../platform/telemetry/common/telemetry.js';\nimport { IExtensionManifestPropertiesService } from '../../extensions/common/extensionManifestPropertiesService.js';\nimport { IProductService } from '../../../../platform/product/common/productService.js';\nimport { isBoolean, isUndefined } from '../../../../base/common/types.js';\nimport { DidChangeUserDataProfileEvent, IUserDataProfileService } from '../../userDataProfile/common/userDataProfile.js';\nimport { delta } from '../../../../base/common/arrays.js';\nimport { compare } from '../../../../base/common/strings.js';\nimport { IUserDataProfilesService } from '../../../../platform/userDataProfile/common/userDataProfile.js';\nimport { IUriIdentityService } from '../../../../platform/uriIdentity/common/uriIdentity.js';\nimport { DisposableStore } from '../../../../base/common/lifecycle.js';\n\nexport class WebExtensionManagementService extends AbstractExtensionManagementService implements IProfileAwareExtensionManagementService {\n\n\tdeclare readonly _serviceBrand: undefined;\n\n\tprivate readonly disposables = this._register(new DisposableStore());\n\n\tget onProfileAwareInstallExtension() { return super.onInstallExtension; }\n\toverride get onInstallExtension() { return Event.filter(this.onProfileAwareInstallExtension, e => this.filterEvent(e), this.disposables); }\n\n\tget onProfileAwareDidInstallExtensions() { return super.onDidInstallExtensions; }\n\toverride get onDidInstallExtensions() {\n\t\treturn Event.filter(\n\t\t\tEvent.map(this.onProfileAwareDidInstallExtensions, results => results.filter(e => this.filterEvent(e)), this.disposables),\n\t\t\tresults => results.length > 0, this.disposables);\n\t}\n\n\tget onProfileAwareUninstallExtension() { return super.onUninstallExtension; }\n\toverride get onUninstallExtension() { return Event.filter(this.onProfileAwareUninstallExtension, e => this.filterEvent(e), this.disposables); }\n\n\tget onProfileAwareDidUninstallExtension() { return super.onDidUninstallExtension; }\n\toverride get onDidUninstallExtension() { return Event.filter(this.onProfileAwareDidUninstallExtension, e => this.filterEvent(e), this.disposables); }\n\n\tprivate readonly _onDidChangeProfile = this._register(new Emitter<{ readonly added: ILocalExtension[]; readonly removed: ILocalExtension[] }>());\n\treadonly onDidChangeProfile = this._onDidChangeProfile.event;\n\n\tget onProfileAwareDidUpdateExtensionMetadata() { return super.onDidUpdateExtensionMetadata; }\n\n\tconstructor(\n\t\t@IExtensionGalleryService extensionGalleryService: IExtensionGalleryService,\n\t\t@ITelemetryService telemetryService: ITelemetryService,\n\t\t@ILogService logService: ILogService,\n\t\t@IWebExtensionsScannerService private readonly webExtensionsScannerService: IWebExtensionsScannerService,\n\t\t@IExtensionManifestPropertiesService private readonly extensionManifestPropertiesService: IExtensionManifestPropertiesService,\n\t\t@IUserDataProfileService private readonly userDataProfileService: IUserDataProfileService,\n\t\t@IProductService productService: IProductService,\n\t\t@IAllowedExtensionsService allowedExtensionsService: IAllowedExtensionsService,\n\t\t@IUserDataProfilesService userDataProfilesService: IUserDataProfilesService,\n\t\t@IUriIdentityService uriIdentityService: IUriIdentityService,\n\t) {\n\t\tsuper(extensionGalleryService, telemetryService, uriIdentityService, logService, productService, allowedExtensionsService, userDataProfilesService);\n\t\tthis._register(userDataProfileService.onDidChangeCurrentProfile(e => {\n\t\t\tif (!this.uriIdentityService.extUri.isEqual(e.previous.extensionsResource, e.profile.extensionsResource)) {\n\t\t\t\te.join(this.whenProfileChanged(e));\n\t\t\t}\n\t\t}));\n\t}\n\n\tprivate filterEvent({ profileLocation, applicationScoped }: { profileLocation?: URI; applicationScoped?: boolean }): boolean {\n\t\tprofileLocation = profileLocation ?? this.userDataProfileService.currentProfile.extensionsResource;\n\t\treturn applicationScoped || this.uriIdentityService.extUri.isEqual(this.userDataProfileService.currentProfile.extensionsResource, profileLocation);\n\t}\n\n\tasync getTargetPlatform(): Promise<TargetPlatform> {\n\t\treturn TargetPlatform.WEB;\n\t}\n\n\tprotected override async isExtensionPlatformCompatible(extension: IGalleryExtension): Promise<boolean> {\n\t\tif (this.isConfiguredToExecuteOnWeb(extension)) {\n\t\t\treturn true;\n\t\t}\n\t\treturn super.isExtensionPlatformCompatible(extension);\n\t}\n\n\tasync getInstalled(type?: ExtensionType, profileLocation?: URI): Promise<ILocalExtension[]> {\n\t\tconst extensions = [];\n\t\tif (type === undefined || type === ExtensionType.System) {\n\t\t\tconst systemExtensions = await this.webExtensionsScannerService.scanSystemExtensions();\n\t\t\textensions.push(...systemExtensions);\n\t\t}\n\t\tif (type === undefined || type === ExtensionType.User) {\n\t\t\tconst userExtensions = await this.webExtensionsScannerService.scanUserExtensions(profileLocation ?? this.userDataProfileService.currentProfile.extensionsResource);\n\t\t\textensions.push(...userExtensions);\n\t\t}\n\t\treturn extensions.map(e => toLocalExtension(e));\n\t}\n\n\tasync install(location: URI, options: InstallOptions = {}): Promise<ILocalExtension> {\n\t\tthis.logService.trace('ExtensionManagementService#install', location.toString());\n\t\tconst manifest = await this.webExtensionsScannerService.scanExtensionManifest(location);\n\t\tif (!manifest || !manifest.name || !manifest.version) {\n\t\t\tthrow new Error(`Cannot find a valid extension from the location ${location.toString()}`);\n\t\t}\n\t\tconst result = await this.installExtensions([{ manifest, extension: location, options }]);\n\t\tif (result[0]?.local) {\n\t\t\treturn result[0]?.local;\n\t\t}\n\t\tif (result[0]?.error) {\n\t\t\tthrow result[0].error;\n\t\t}\n\t\tthrow toExtensionManagementError(new Error(`Unknown error while installing extension ${getGalleryExtensionId(manifest.publisher, manifest.name)}`));\n\t}\n\n\tinstallFromLocation(location: URI, profileLocation: URI): Promise<ILocalExtension> {\n\t\treturn this.install(location, { profileLocation });\n\t}\n\n\tprotected async deleteExtension(extension: ILocalExtension): Promise<void> {\n\t\t// do nothing\n\t}\n\n\tprotected async copyExtension(extension: ILocalExtension, fromProfileLocation: URI, toProfileLocation: URI, metadata: Partial<Metadata>): Promise<ILocalExtension> {\n\t\tconst target = await this.webExtensionsScannerService.scanExistingExtension(extension.location, extension.type, toProfileLocation);\n\t\tconst source = await this.webExtensionsScannerService.scanExistingExtension(extension.location, extension.type, fromProfileLocation);\n\t\tmetadata = { ...source?.metadata, ...metadata };\n\n\t\tlet scanned;\n\t\tif (target) {\n\t\t\tscanned = await this.webExtensionsScannerService.updateMetadata(extension, { ...target.metadata, ...metadata }, toProfileLocation);\n\t\t} else {\n\t\t\tscanned = await this.webExtensionsScannerService.addExtension(extension.location, metadata, toProfileLocation);\n\t\t}\n\t\treturn toLocalExtension(scanned);\n\t}\n\n\tprotected async moveExtension(extension: ILocalExtension, fromProfileLocation: URI, toProfileLocation: URI, metadata: Partial<Metadata>): Promise<ILocalExtension> {\n\t\tconst target = await this.webExtensionsScannerService.scanExistingExtension(extension.location, extension.type, toProfileLocation);\n\t\tconst source = await this.webExtensionsScannerService.scanExistingExtension(extension.location, extension.type, fromProfileLocation);\n\t\tmetadata = { ...source?.metadata, ...metadata };\n\n\t\tlet scanned;\n\t\tif (target) {\n\t\t\tscanned = await this.webExtensionsScannerService.updateMetadata(extension, { ...target.metadata, ...metadata }, toProfileLocation);\n\t\t} else {\n\t\t\tscanned = await this.webExtensionsScannerService.addExtension(extension.location, metadata, toProfileLocation);\n\t\t\tif (source) {\n\t\t\t\tawait this.webExtensionsScannerService.removeExtension(source, fromProfileLocation);\n\t\t\t}\n\t\t}\n\t\treturn toLocalExtension(scanned);\n\t}\n\n\tprotected async removeExtension(extension: ILocalExtension, fromProfileLocation: URI): Promise<void> {\n\t\tconst source = await this.webExtensionsScannerService.scanExistingExtension(extension.location, extension.type, fromProfileLocation);\n\t\tif (source) {\n\t\t\tawait this.webExtensionsScannerService.removeExtension(source, fromProfileLocation);\n\t\t}\n\t}\n\n\tasync installExtensionsFromProfile(extensions: IExtensionIdentifier[], fromProfileLocation: URI, toProfileLocation: URI): Promise<ILocalExtension[]> {\n\t\tconst result: ILocalExtension[] = [];\n\t\tconst extensionsToInstall = (await this.webExtensionsScannerService.scanUserExtensions(fromProfileLocation))\n\t\t\t.filter(e => extensions.some(id => areSameExtensions(id, e.identifier)));\n\t\tif (extensionsToInstall.length) {\n\t\t\tawait Promise.allSettled(extensionsToInstall.map(async e => {\n\t\t\t\tlet local = await this.installFromLocation(e.location, toProfileLocation);\n\t\t\t\tif (e.metadata) {\n\t\t\t\t\tlocal = await this.updateMetadata(local, e.metadata, fromProfileLocation);\n\t\t\t\t}\n\t\t\t\tresult.push(local);\n\t\t\t}));\n\t\t}\n\t\treturn result;\n\t}\n\n\tasync updateMetadata(local: ILocalExtension, metadata: Partial<Metadata>, profileLocation: URI): Promise<ILocalExtension> {\n\t\t// unset if false\n\t\tif (metadata.isMachineScoped === false) {\n\t\t\tmetadata.isMachineScoped = undefined;\n\t\t}\n\t\tif (metadata.isBuiltin === false) {\n\t\t\tmetadata.isBuiltin = undefined;\n\t\t}\n\t\tif (metadata.pinned === false) {\n\t\t\tmetadata.pinned = undefined;\n\t\t}\n\t\tconst updatedExtension = await this.webExtensionsScannerService.updateMetadata(local, metadata, profileLocation);\n\t\tconst updatedLocalExtension = toLocalExtension(updatedExtension);\n\t\tthis._onDidUpdateExtensionMetadata.fire({ local: updatedLocalExtension, profileLocation });\n\t\treturn updatedLocalExtension;\n\t}\n\n\toverride async copyExtensions(fromProfileLocation: URI, toProfileLocation: URI): Promise<void> {\n\t\tawait this.webExtensionsScannerService.copyExtensions(fromProfileLocation, toProfileLocation, e => !e.metadata?.isApplicationScoped);\n\t}\n\n\tprotected override async getCompatibleVersion(extension: IGalleryExtension, sameVersion: boolean, includePreRelease: boolean, productVersion: IProductVersion): Promise<IGalleryExtension | null> {\n\t\tconst compatibleExtension = await super.getCompatibleVersion(extension, sameVersion, includePreRelease, productVersion);\n\t\tif (compatibleExtension) {\n\t\t\treturn compatibleExtension;\n\t\t}\n\t\tif (this.isConfiguredToExecuteOnWeb(extension)) {\n\t\t\treturn extension;\n\t\t}\n\t\treturn null;\n\t}\n\n\tprivate isConfiguredToExecuteOnWeb(gallery: IGalleryExtension): boolean {\n\t\tconst configuredExtensionKind = this.extensionManifestPropertiesService.getUserConfiguredExtensionKind(gallery.identifier);\n\t\treturn !!configuredExtensionKind && configuredExtensionKind.includes('web');\n\t}\n\n\tprotected getCurrentExtensionsManifestLocation(): URI {\n\t\treturn this.userDataProfileService.currentProfile.extensionsResource;\n\t}\n\n\tprotected createInstallExtensionTask(manifest: IExtensionManifest, extension: URI | IGalleryExtension, options: InstallExtensionTaskOptions): IInstallExtensionTask {\n\t\treturn new InstallExtensionTask(manifest, extension, options, this.webExtensionsScannerService, this.userDataProfilesService);\n\t}\n\n\tprotected createUninstallExtensionTask(extension: ILocalExtension, options: UninstallExtensionTaskOptions): IUninstallExtensionTask {\n\t\treturn new UninstallExtensionTask(extension, options, this.webExtensionsScannerService);\n\t}\n\n\tzip(extension: ILocalExtension): Promise<URI> { throw new Error('unsupported'); }\n\tgetManifest(vsix: URI): Promise<IExtensionManifest> { throw new Error('unsupported'); }\n\tdownload(): Promise<URI> { throw new Error('unsupported'); }\n\n\tasync cleanUp(): Promise<void> { }\n\n\tprivate async whenProfileChanged(e: DidChangeUserDataProfileEvent): Promise<void> {\n\t\tconst previousProfileLocation = e.previous.extensionsResource;\n\t\tconst currentProfileLocation = e.profile.extensionsResource;\n\t\tif (!previousProfileLocation || !currentProfileLocation) {\n\t\t\tthrow new Error('This should not happen');\n\t\t}\n\t\tconst oldExtensions = await this.webExtensionsScannerService.scanUserExtensions(previousProfileLocation);\n\t\tconst newExtensions = await this.webExtensionsScannerService.scanUserExtensions(currentProfileLocation);\n\t\tconst { added, removed } = delta(oldExtensions, newExtensions, (a, b) => compare(`${ExtensionIdentifier.toKey(a.identifier.id)}@${a.manifest.version}`, `${ExtensionIdentifier.toKey(b.identifier.id)}@${b.manifest.version}`));\n\t\tthis._onDidChangeProfile.fire({ added: added.map(e => toLocalExtension(e)), removed: removed.map(e => toLocalExtension(e)) });\n\t}\n}\n\nfunction toLocalExtension(extension: IExtension): ILocalExtension {\n\tconst metadata = getMetadata(undefined, extension);\n\treturn {\n\t\t...extension,\n\t\tidentifier: { id: extension.identifier.id, uuid: metadata.id ?? extension.identifier.uuid },\n\t\tisMachineScoped: !!metadata.isMachineScoped,\n\t\tisApplicationScoped: !!metadata.isApplicationScoped,\n\t\tpublisherId: metadata.publisherId || null,\n\t\tpublisherDisplayName: metadata.publisherDisplayName,\n\t\tinstalledTimestamp: metadata.installedTimestamp,\n\t\tisPreReleaseVersion: !!metadata.isPreReleaseVersion,\n\t\thasPreReleaseVersion: !!metadata.hasPreReleaseVersion,\n\t\tpreRelease: extension.preRelease,\n\t\ttargetPlatform: TargetPlatform.WEB,\n\t\tupdated: !!metadata.updated,\n\t\tpinned: !!metadata?.pinned,\n\t\tprivate: !!metadata.private,\n\t\tisWorkspaceScoped: false,\n\t\tsource: metadata?.source ?? (extension.identifier.uuid ? 'gallery' : 'resource'),\n\t\tsize: metadata.size ?? 0,\n\t};\n}\n\nfunction getMetadata(options?: InstallOptions, existingExtension?: IExtension): Metadata {\n\tconst metadata: Metadata = { ...((<IScannedExtension>existingExtension)?.metadata || {}) };\n\tmetadata.isMachineScoped = options?.isMachineScoped || metadata.isMachineScoped;\n\treturn metadata;\n}\n\nclass InstallExtensionTask extends AbstractExtensionTask<ILocalExtension> implements IInstallExtensionTask {\n\n\treadonly identifier: IExtensionIdentifier;\n\treadonly source: URI | IGalleryExtension;\n\n\tprivate _profileLocation: URI;\n\tget profileLocation() { return this._profileLocation; }\n\n\tprivate _operation = InstallOperation.Install;\n\tget operation() { return isUndefined(this.options.operation) ? this._operation : this.options.operation; }\n\n\tconstructor(\n\t\treadonly manifest: IExtensionManifest,\n\t\tprivate readonly extension: URI | IGalleryExtension,\n\t\treadonly options: InstallExtensionTaskOptions,\n\t\tprivate readonly webExtensionsScannerService: IWebExtensionsScannerService,\n\t\tprivate readonly userDataProfilesService: IUserDataProfilesService,\n\t) {\n\t\tsuper();\n\t\tthis._profileLocation = options.profileLocation;\n\t\tthis.identifier = URI.isUri(extension) ? { id: getGalleryExtensionId(manifest.publisher, manifest.name) } : extension.identifier;\n\t\tthis.source = extension;\n\t}\n\n\tprotected async doRun(token: CancellationToken): Promise<ILocalExtension> {\n\t\tconst userExtensions = await this.webExtensionsScannerService.scanUserExtensions(this.options.profileLocation);\n\t\tconst existingExtension = userExtensions.find(e => areSameExtensions(e.identifier, this.identifier));\n\t\tif (existingExtension) {\n\t\t\tthis._operation = InstallOperation.Update;\n\t\t}\n\n\t\tconst metadata = getMetadata(this.options, existingExtension);\n\t\tif (!URI.isUri(this.extension)) {\n\t\t\tmetadata.id = this.extension.identifier.uuid;\n\t\t\tmetadata.publisherDisplayName = this.extension.publisherDisplayName;\n\t\t\tmetadata.publisherId = this.extension.publisherId;\n\t\t\tmetadata.installedTimestamp = Date.now();\n\t\t\tmetadata.isPreReleaseVersion = this.extension.properties.isPreReleaseVersion;\n\t\t\tmetadata.hasPreReleaseVersion = metadata.hasPreReleaseVersion || this.extension.properties.isPreReleaseVersion;\n\t\t\tmetadata.isBuiltin = this.options.isBuiltin || existingExtension?.isBuiltin;\n\t\t\tmetadata.isSystem = existingExtension?.type === ExtensionType.System ? true : undefined;\n\t\t\tmetadata.updated = !!existingExtension;\n\t\t\tmetadata.isApplicationScoped = this.options.isApplicationScoped || metadata.isApplicationScoped;\n\t\t\tmetadata.private = this.extension.private;\n\t\t\tmetadata.preRelease = isBoolean(this.options.preRelease)\n\t\t\t\t? this.options.preRelease\n\t\t\t\t: this.options.installPreReleaseVersion || this.extension.properties.isPreReleaseVersion || metadata.preRelease;\n\t\t\tmetadata.source = URI.isUri(this.extension) ? 'resource' : 'gallery';\n\t\t}\n\t\tmetadata.pinned = this.options.installGivenVersion ? true : (this.options.pinned ?? metadata.pinned);\n\n\t\tthis._profileLocation = metadata.isApplicationScoped ? this.userDataProfilesService.defaultProfile.extensionsResource : this.options.profileLocation;\n\t\tconst scannedExtension = URI.isUri(this.extension) ? await this.webExtensionsScannerService.addExtension(this.extension, metadata, this.profileLocation)\n\t\t\t: await this.webExtensionsScannerService.addExtensionFromGallery(this.extension, metadata, this.profileLocation);\n\t\treturn toLocalExtension(scannedExtension);\n\t}\n}\n\nclass UninstallExtensionTask extends AbstractExtensionTask<void> implements IUninstallExtensionTask {\n\n\tconstructor(\n\t\treadonly extension: ILocalExtension,\n\t\treadonly options: UninstallExtensionTaskOptions,\n\t\tprivate readonly webExtensionsScannerService: IWebExtensionsScannerService,\n\t) {\n\t\tsuper();\n\t}\n\n\tprotected doRun(token: CancellationToken): Promise<void> {\n\t\treturn this.webExtensionsScannerService.removeExtension(this.extension, this.options.profileLocation);\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { ExtensionIdentifier, ExtensionType, IExtension, IExtensionIdentifier, IExtensionManifest, TargetPlatform } from '../../../../platform/extensions/common/extensions.js';\nimport { ILocalExtension, IGalleryExtension, InstallOperation, IExtensionGalleryService, Metadata, InstallOptions, IProductVersion, IAllowedExtensionsService } from '../../../../platform/extensionManagement/common/extensionManagement.js';\nimport { URI } from '../../../../base/common/uri.js';\nimport { Emitter, Event } from '../../../../base/common/event.js';\nimport { areSameExtensions, getGalleryExtensionId } from '../../../../platform/extensionManagement/common/extensionManagementUtil.js';\nimport { IProfileAwareExtensionManagementService, IScannedExtension, IWebExtensionsScannerService } from './extensionManagement.js';\nimport { ILogService } from '../../../../platform/log/common/log.js';\nimport { CancellationToken } from '../../../../base/common/cancellation.js';\nimport { AbstractExtensionManagementService, AbstractExtensionTask, IInstallExtensionTask, InstallExtensionTaskOptions, IUninstallExtensionTask, toExtensionManagementError, UninstallExtensionTaskOptions } from '../../../../platform/extensionManagement/common/abstractExtensionManagementService.js';\nimport { ITelemetryService } from '../../../../platform/telemetry/common/telemetry.js';\nimport { IExtensionManifestPropertiesService } from '../../extensions/common/extensionManifestPropertiesService.js';\nimport { IProductService } from '../../../../platform/product/common/productService.js';\nimport { isBoolean, isUndefined } from '../../../../base/common/types.js';\nimport { DidChangeUserDataProfileEvent, IUserDataProfileService } from '../../userDataProfile/common/userDataProfile.js';\nimport { delta } from '../../../../base/common/arrays.js';\nimport { compare } from '../../../../base/common/strings.js';\nimport { IUserDataProfilesService } from '../../../../platform/userDataProfile/common/userDataProfile.js';\nimport { IUriIdentityService } from '../../../../platform/uriIdentity/common/uriIdentity.js';\nimport { DisposableStore } from '../../../../base/common/lifecycle.js';\n\nexport class WebExtensionManagementService extends AbstractExtensionManagementService implements IProfileAwareExtensionManagementService {\n\n\tdeclare readonly _serviceBrand: undefined;\n\n\tprivate readonly disposables = this._register(new DisposableStore());\n\n\tget onProfileAwareInstallExtension() { return super.onInstallExtension; }\n\toverride get onInstallExtension() { return Event.filter(this.onProfileAwareInstallExtension, e => this.filterEvent(e), this.disposables); }\n\n\tget onProfileAwareDidInstallExtensions() { return super.onDidInstallExtensions; }\n\toverride get onDidInstallExtensions() {\n\t\treturn Event.filter(\n\t\t\tEvent.map(this.onProfileAwareDidInstallExtensions, results => results.filter(e => this.filterEvent(e)), this.disposables),\n\t\t\tresults => results.length > 0, this.disposables);\n\t}\n\n\tget onProfileAwareUninstallExtension() { return super.onUninstallExtension; }\n\toverride get onUninstallExtension() { return Event.filter(this.onProfileAwareUninstallExtension, e => this.filterEvent(e), this.disposables); }\n\n\tget onProfileAwareDidUninstallExtension() { return super.onDidUninstallExtension; }\n\toverride get onDidUninstallExtension() { return Event.filter(this.onProfileAwareDidUninstallExtension, e => this.filterEvent(e), this.disposables); }\n\n\tprivate readonly _onDidChangeProfile = this._register(new Emitter<{ readonly added: ILocalExtension[]; readonly removed: ILocalExtension[] }>());\n\treadonly onDidChangeProfile = this._onDidChangeProfile.event;\n\n\tget onProfileAwareDidUpdateExtensionMetadata() { return super.onDidUpdateExtensionMetadata; }\n\n\tconstructor(\n\t\t@IExtensionGalleryService extensionGalleryService: IExtensionGalleryService,\n\t\t@ITelemetryService telemetryService: ITelemetryService,\n\t\t@ILogService logService: ILogService,\n\t\t@IWebExtensionsScannerService private readonly webExtensionsScannerService: IWebExtensionsScannerService,\n\t\t@IExtensionManifestPropertiesService private readonly extensionManifestPropertiesService: IExtensionManifestPropertiesService,\n\t\t@IUserDataProfileService private readonly userDataProfileService: IUserDataProfileService,\n\t\t@IProductService productService: IProductService,\n\t\t@IAllowedExtensionsService allowedExtensionsService: IAllowedExtensionsService,\n\t\t@IUserDataProfilesService userDataProfilesService: IUserDataProfilesService,\n\t\t@IUriIdentityService uriIdentityService: IUriIdentityService,\n\t) {\n\t\tsuper(extensionGalleryService, telemetryService, uriIdentityService, logService, productService, allowedExtensionsService, userDataProfilesService);\n\t\tthis._register(userDataProfileService.onDidChangeCurrentProfile(e => {\n\t\t\tif (!this.uriIdentityService.extUri.isEqual(e.previous.extensionsResource, e.profile.extensionsResource)) {\n\t\t\t\te.join(this.whenProfileChanged(e));\n\t\t\t}\n\t\t}));\n\t}\n\n\tprivate filterEvent({ profileLocation, applicationScoped }: { profileLocation?: URI; applicationScoped?: boolean }): boolean {\n\t\tprofileLocation = profileLocation ?? this.userDataProfileService.currentProfile.extensionsResource;\n\t\treturn applicationScoped || this.uriIdentityService.extUri.isEqual(this.userDataProfileService.currentProfile.extensionsResource, profileLocation);\n\t}\n\n\tasync getTargetPlatform(): Promise<TargetPlatform> {\n\t\treturn TargetPlatform.WEB;\n\t}\n\n\tprotected override async isExtensionPlatformCompatible(extension: IGalleryExtension): Promise<boolean> {\n\t\tif (this.isConfiguredToExecuteOnWeb(extension)) {\n\t\t\treturn true;\n\t\t}\n\t\treturn super.isExtensionPlatformCompatible(extension);\n\t}\n\n\tasync getInstalled(type?: ExtensionType, profileLocation?: URI): Promise<ILocalExtension[]> {\n\t\tconst extensions = [];\n\t\tif (type === undefined || type === ExtensionType.System) {\n\t\t\tconst systemExtensions = await this.webExtensionsScannerService.scanSystemExtensions();\n\t\t\textensions.push(...systemExtensions);\n\t\t}\n\t\tif (type === undefined || type === ExtensionType.User) {\n\t\t\tconst userExtensions = await this.webExtensionsScannerService.scanUserExtensions(profileLocation ?? this.userDataProfileService.currentProfile.extensionsResource);\n\t\t\textensions.push(...userExtensions);\n\t\t}\n\t\treturn extensions.map(e => toLocalExtension(e));\n\t}\n\n\tasync install(location: URI, options: InstallOptions = {}): Promise<ILocalExtension> {\n\t\tthis.logService.trace('ExtensionManagementService#install', location.toString());\n\t\tconst manifest = await this.webExtensionsScannerService.scanExtensionManifest(location);\n\t\tif (!manifest || !manifest.name || !manifest.version) {\n\t\t\tthrow new Error(`Cannot find a valid extension from the location ${location.toString()}`);\n\t\t}\n\t\tconst result = await this.installExtensions([{ manifest, extension: location, options }]);\n\t\tif (result[0]?.local) {\n\t\t\treturn result[0]?.local;\n\t\t}\n\t\tif (result[0]?.error) {\n\t\t\tthrow result[0].error;\n\t\t}\n\t\tthrow toExtensionManagementError(new Error(`Unknown error while installing extension ${getGalleryExtensionId(manifest.publisher, manifest.name)}`));\n\t}\n\n\tinstallFromLocation(location: URI, profileLocation: URI): Promise<ILocalExtension> {\n\t\treturn this.install(location, { profileLocation });\n\t}\n\n\tprotected async deleteExtension(extension: ILocalExtension): Promise<void> {\n\t\t// do nothing\n\t}\n\n\tprotected async copyExtension(extension: ILocalExtension, fromProfileLocation: URI, toProfileLocation: URI, metadata: Partial<Metadata>): Promise<ILocalExtension> {\n\t\tconst target = await this.webExtensionsScannerService.scanExistingExtension(extension.location, extension.type, toProfileLocation);\n\t\tconst source = await this.webExtensionsScannerService.scanExistingExtension(extension.location, extension.type, fromProfileLocation);\n\t\tmetadata = { ...source?.metadata, ...metadata };\n\n\t\tlet scanned;\n\t\tif (target) {\n\t\t\tscanned = await this.webExtensionsScannerService.updateMetadata(extension, { ...target.metadata, ...metadata }, toProfileLocation);\n\t\t} else {\n\t\t\tscanned = await this.webExtensionsScannerService.addExtension(extension.location, metadata, toProfileLocation);\n\t\t}\n\t\treturn toLocalExtension(scanned);\n\t}\n\n\tprotected async moveExtension(extension: ILocalExtension, fromProfileLocation: URI, toProfileLocation: URI, metadata: Partial<Metadata>): Promise<ILocalExtension> {\n\t\tconst target = await this.webExtensionsScannerService.scanExistingExtension(extension.location, extension.type, toProfileLocation);\n\t\tconst source = await this.webExtensionsScannerService.scanExistingExtension(extension.location, extension.type, fromProfileLocation);\n\t\tmetadata = { ...source?.metadata, ...metadata };\n\n\t\tlet scanned;\n\t\tif (target) {\n\t\t\tscanned = await this.webExtensionsScannerService.updateMetadata(extension, { ...target.metadata, ...metadata }, toProfileLocation);\n\t\t} else {\n\t\t\tscanned = await this.webExtensionsScannerService.addExtension(extension.location, metadata, toProfileLocation);\n\t\t\tif (source) {\n\t\t\t\tawait this.webExtensionsScannerService.removeExtension(source, fromProfileLocation);\n\t\t\t}\n\t\t}\n\t\treturn toLocalExtension(scanned);\n\t}\n\n\tprotected async removeExtension(extension: ILocalExtension, fromProfileLocation: URI): Promise<void> {\n\t\tconst source = await this.webExtensionsScannerService.scanExistingExtension(extension.location, extension.type, fromProfileLocation);\n\t\tif (source) {\n\t\t\tawait this.webExtensionsScannerService.removeExtension(source, fromProfileLocation);\n\t\t}\n\t}\n\n\tasync installExtensionsFromProfile(extensions: IExtensionIdentifier[], fromProfileLocation: URI, toProfileLocation: URI): Promise<ILocalExtension[]> {\n\t\tconst result: ILocalExtension[] = [];\n\t\tconst extensionsToInstall = (await this.webExtensionsScannerService.scanUserExtensions(fromProfileLocation))\n\t\t\t.filter(e => extensions.some(id => areSameExtensions(id, e.identifier)));\n\t\tif (extensionsToInstall.length) {\n\t\t\tawait Promise.allSettled(extensionsToInstall.map(async e => {\n\t\t\t\tlet local = await this.installFromLocation(e.location, toProfileLocation);\n\t\t\t\tif (e.metadata) {\n\t\t\t\t\tlocal = await this.updateMetadata(local, e.metadata, fromProfileLocation);\n\t\t\t\t}\n\t\t\t\tresult.push(local);\n\t\t\t}));\n\t\t}\n\t\treturn result;\n\t}\n\n\tasync updateMetadata(local: ILocalExtension, metadata: Partial<Metadata>, profileLocation: URI): Promise<ILocalExtension> {\n\t\t// unset if false\n\t\tif (metadata.isMachineScoped === false) {\n\t\t\tmetadata.isMachineScoped = undefined;\n\t\t}\n\t\tif (metadata.isBuiltin === false) {\n\t\t\tmetadata.isBuiltin = undefined;\n\t\t}\n\t\tif (metadata.pinned === false) {\n\t\t\tmetadata.pinned = undefined;\n\t\t}\n\t\tconst updatedExtension = await this.webExtensionsScannerService.updateMetadata(local, metadata, profileLocation);\n\t\tconst updatedLocalExtension = toLocalExtension(updatedExtension);\n\t\tthis._onDidUpdateExtensionMetadata.fire({ local: updatedLocalExtension, profileLocation });\n\t\treturn updatedLocalExtension;\n\t}\n\n\toverride async copyExtensions(fromProfileLocation: URI, toProfileLocation: URI): Promise<void> {\n\t\tawait this.webExtensionsScannerService.copyExtensions(fromProfileLocation, toProfileLocation, e => !e.metadata?.isApplicationScoped);\n\t}\n\n\tprotected override async getCompatibleVersion(extension: IGalleryExtension, sameVersion: boolean, includePreRelease: boolean, productVersion: IProductVersion): Promise<IGalleryExtension | null> {\n\t\tconst compatibleExtension = await super.getCompatibleVersion(extension, sameVersion, includePreRelease, productVersion);\n\t\tif (compatibleExtension) {\n\t\t\treturn compatibleExtension;\n\t\t}\n\t\tif (this.isConfiguredToExecuteOnWeb(extension)) {\n\t\t\treturn extension;\n\t\t}\n\t\treturn null;\n\t}\n\n\tprivate isConfiguredToExecuteOnWeb(gallery: IGalleryExtension): boolean {\n\t\tconst configuredExtensionKind = this.extensionManifestPropertiesService.getUserConfiguredExtensionKind(gallery.identifier);\n\t\treturn !!configuredExtensionKind && configuredExtensionKind.includes('web');\n\t}\n\n\tprotected getCurrentExtensionsManifestLocation(): URI {\n\t\treturn this.userDataProfileService.currentProfile.extensionsResource;\n\t}\n\n\tprotected createInstallExtensionTask(manifest: IExtensionManifest, extension: URI | IGalleryExtension, options: InstallExtensionTaskOptions): IInstallExtensionTask {\n\t\treturn new InstallExtensionTask(manifest, extension, options, this.webExtensionsScannerService, this.userDataProfilesService);\n\t}\n\n\tprotected createUninstallExtensionTask(extension: ILocalExtension, options: UninstallExtensionTaskOptions): IUninstallExtensionTask {\n\t\treturn new UninstallExtensionTask(extension, options, this.webExtensionsScannerService);\n\t}\n\n\tzip(extension: ILocalExtension): Promise<URI> { throw new Error('unsupported'); }\n\tgetManifest(vsix: URI): Promise<IExtensionManifest> { throw new Error('unsupported'); }\n\tdownload(): Promise<URI> { throw new Error('unsupported'); }\n\n\tasync cleanUp(): Promise<void> { }\n\n\tprivate async whenProfileChanged(e: DidChangeUserDataProfileEvent): Promise<void> {\n\t\tconst previousProfileLocation = e.previous.extensionsResource;\n\t\tconst currentProfileLocation = e.profile.extensionsResource;\n\t\tif (!previousProfileLocation || !currentProfileLocation) {\n\t\t\tthrow new Error('This should not happen');\n\t\t}\n\t\tconst oldExtensions = await this.webExtensionsScannerService.scanUserExtensions(previousProfileLocation);\n\t\tconst newExtensions = await this.webExtensionsScannerService.scanUserExtensions(currentProfileLocation);\n\t\tconst { added, removed } = delta(oldExtensions, newExtensions, (a, b) => compare(`${ExtensionIdentifier.toKey(a.identifier.id)}@${a.manifest.version}`, `${ExtensionIdentifier.toKey(b.identifier.id)}@${b.manifest.version}`));\n\t\tthis._onDidChangeProfile.fire({ added: added.map(e => toLocalExtension(e)), removed: removed.map(e => toLocalExtension(e)) });\n\t}\n}\n\nfunction toLocalExtension(extension: IExtension): ILocalExtension {\n\tconst metadata = getMetadata(undefined, extension);\n\treturn {\n\t\t...extension,\n\t\tidentifier: { id: extension.identifier.id, uuid: metadata.id ?? extension.identifier.uuid },\n\t\tisMachineScoped: !!metadata.isMachineScoped,\n\t\tisApplicationScoped: !!metadata.isApplicationScoped,\n\t\tpublisherId: metadata.publisherId || null,\n\t\tpublisherDisplayName: metadata.publisherDisplayName,\n\t\tinstalledTimestamp: metadata.installedTimestamp,\n\t\tisPreReleaseVersion: !!metadata.isPreReleaseVersion,\n\t\thasPreReleaseVersion: !!metadata.hasPreReleaseVersion,\n\t\tpreRelease: extension.preRelease,\n\t\ttargetPlatform: TargetPlatform.WEB,\n\t\tupdated: !!metadata.updated,\n\t\tpinned: !!metadata?.pinned,\n\t\tprivate: !!metadata.private,\n\t\tisWorkspaceScoped: false,\n\t\tsource: metadata?.source ?? (extension.identifier.uuid ? 'gallery' : 'resource'),\n\t\tsize: metadata.size ?? 0,\n\t};\n}\n\nfunction getMetadata(options?: InstallOptions, existingExtension?: IExtension): Metadata {\n\tconst metadata: Metadata = { ...((<IScannedExtension>existingExtension)?.metadata || {}) };\n\tmetadata.isMachineScoped = options?.isMachineScoped || metadata.isMachineScoped;\n\treturn metadata;\n}\n\nclass InstallExtensionTask extends AbstractExtensionTask<ILocalExtension> implements IInstallExtensionTask {\n\n\treadonly identifier: IExtensionIdentifier;\n\treadonly source: URI | IGalleryExtension;\n\n\tprivate _profileLocation: URI;\n\tget profileLocation() { return this._profileLocation; }\n\n\tprivate _operation = InstallOperation.Install;\n\tget operation() { return isUndefined(this.options.operation) ? this._operation : this.options.operation; }\n\n\tconstructor(\n\t\treadonly manifest: IExtensionManifest,\n\t\tprivate readonly extension: URI | IGalleryExtension,\n\t\treadonly options: InstallExtensionTaskOptions,\n\t\tprivate readonly webExtensionsScannerService: IWebExtensionsScannerService,\n\t\tprivate readonly userDataProfilesService: IUserDataProfilesService,\n\t) {\n\t\tsuper();\n\t\tthis._profileLocation = options.profileLocation;\n\t\tthis.identifier = URI.isUri(extension) ? { id: getGalleryExtensionId(manifest.publisher, manifest.name) } : extension.identifier;\n\t\tthis.source = extension;\n\t}\n\n\tprotected async doRun(token: CancellationToken): Promise<ILocalExtension> {\n\t\tconst userExtensions = await this.webExtensionsScannerService.scanUserExtensions(this.options.profileLocation);\n\t\tconst existingExtension = userExtensions.find(e => areSameExtensions(e.identifier, this.identifier));\n\t\tif (existingExtension) {\n\t\t\tthis._operation = InstallOperation.Update;\n\t\t}\n\n\t\tconst metadata = getMetadata(this.options, existingExtension);\n\t\tif (!URI.isUri(this.extension)) {\n\t\t\tmetadata.id = this.extension.identifier.uuid;\n\t\t\tmetadata.publisherDisplayName = this.extension.publisherDisplayName;\n\t\t\tmetadata.publisherId = this.extension.publisherId;\n\t\t\tmetadata.installedTimestamp = Date.now();\n\t\t\tmetadata.isPreReleaseVersion = this.extension.properties.isPreReleaseVersion;\n\t\t\tmetadata.hasPreReleaseVersion = metadata.hasPreReleaseVersion || this.extension.properties.isPreReleaseVersion;\n\t\t\tmetadata.isBuiltin = this.options.isBuiltin || existingExtension?.isBuiltin;\n\t\t\tmetadata.isSystem = existingExtension?.type === ExtensionType.System ? true : undefined;\n\t\t\tmetadata.updated = !!existingExtension;\n\t\t\tmetadata.isApplicationScoped = this.options.isApplicationScoped || metadata.isApplicationScoped;\n\t\t\tmetadata.private = this.extension.private;\n\t\t\tmetadata.preRelease = isBoolean(this.options.preRelease)\n\t\t\t\t? this.options.preRelease\n\t\t\t\t: this.options.installPreReleaseVersion || this.extension.properties.isPreReleaseVersion || metadata.preRelease;\n\t\t\tmetadata.source = URI.isUri(this.extension) ? 'resource' : 'gallery';\n\t\t}\n\t\tmetadata.pinned = this.options.installGivenVersion ? true : (this.options.pinned ?? metadata.pinned);\n\n\t\tthis._profileLocation = metadata.isApplicationScoped ? this.userDataProfilesService.defaultProfile.extensionsResource : this.options.profileLocation;\n\t\tconst scannedExtension = URI.isUri(this.extension) ? await this.webExtensionsScannerService.addExtension(this.extension, metadata, this.profileLocation)\n\t\t\t: await this.webExtensionsScannerService.addExtensionFromGallery(this.extension, metadata, this.profileLocation);\n\t\treturn toLocalExtension(scannedExtension);\n\t}\n}\n\nclass UninstallExtensionTask extends AbstractExtensionTask<void> implements IUninstallExtensionTask {\n\n\tconstructor(\n\t\treadonly extension: ILocalExtension,\n\t\treadonly options: UninstallExtensionTaskOptions,\n\t\tprivate readonly webExtensionsScannerService: IWebExtensionsScannerService,\n\t) {\n\t\tsuper();\n\t}\n\n\tprotected doRun(token: CancellationToken): Promise<void> {\n\t\treturn this.webExtensionsScannerService.removeExtension(this.extension, this.options.profileLocation);\n\t}\n}\n"]}