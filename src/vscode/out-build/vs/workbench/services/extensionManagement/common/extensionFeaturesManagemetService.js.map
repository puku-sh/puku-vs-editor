{"version":3,"sources":["vs/workbench/services/extensionManagement/common/extensionFeaturesManagemetService.ts"],"names":[],"mappings":"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","file":"extensionFeaturesManagemetService.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Emitter } from '../../../../base/common/event.js';\nimport { ExtensionIdentifier } from '../../../../platform/extensions/common/extensions.js';\nimport { Disposable } from '../../../../base/common/lifecycle.js';\nimport Severity from '../../../../base/common/severity.js';\nimport { Extensions, IExtensionFeatureAccessData, IExtensionFeaturesManagementService, IExtensionFeaturesRegistry } from './extensionFeatures.js';\nimport { InstantiationType, registerSingleton } from '../../../../platform/instantiation/common/extensions.js';\nimport { IStorageService, StorageScope, StorageTarget } from '../../../../platform/storage/common/storage.js';\nimport { Registry } from '../../../../platform/registry/common/platform.js';\nimport { IStringDictionary } from '../../../../base/common/collections.js';\nimport { Mutable, isBoolean } from '../../../../base/common/types.js';\nimport { IDialogService } from '../../../../platform/dialogs/common/dialogs.js';\nimport { localize } from '../../../../nls.js';\nimport { IExtensionService } from '../../extensions/common/extensions.js';\nimport { IStorageChangeEvent } from '../../../../base/parts/storage/common/storage.js';\nimport { distinct } from '../../../../base/common/arrays.js';\nimport { equals } from '../../../../base/common/objects.js';\n\ninterface IExtensionFeatureState {\n\tdisabled?: boolean;\n\taccessData: Mutable<IExtensionFeatureAccessData>;\n}\n\nconst FEATURES_STATE_KEY = 'extension.features.state';\n\nclass ExtensionFeaturesManagementService extends Disposable implements IExtensionFeaturesManagementService {\n\tdeclare readonly _serviceBrand: undefined;\n\n\tprivate readonly _onDidChangeEnablement = this._register(new Emitter<{ extension: ExtensionIdentifier; featureId: string; enabled: boolean }>());\n\treadonly onDidChangeEnablement = this._onDidChangeEnablement.event;\n\n\tprivate readonly _onDidChangeAccessData = this._register(new Emitter<{ extension: ExtensionIdentifier; featureId: string; accessData: IExtensionFeatureAccessData }>());\n\treadonly onDidChangeAccessData = this._onDidChangeAccessData.event;\n\n\tprivate readonly registry: IExtensionFeaturesRegistry;\n\tprivate extensionFeaturesState = new Map<string, Map<string, IExtensionFeatureState>>();\n\n\tconstructor(\n\t\t@IStorageService private readonly storageService: IStorageService,\n\t\t@IDialogService private readonly dialogService: IDialogService,\n\t\t@IExtensionService private readonly extensionService: IExtensionService,\n\t) {\n\t\tsuper();\n\t\tthis.registry = Registry.as<IExtensionFeaturesRegistry>(Extensions.ExtensionFeaturesRegistry);\n\t\tthis.extensionFeaturesState = this.loadState();\n\t\tthis.garbageCollectOldRequests();\n\t\tthis._register(storageService.onDidChangeValue(StorageScope.PROFILE, FEATURES_STATE_KEY, this._store)(e => this.onDidStorageChange(e)));\n\t}\n\n\tisEnabled(extension: ExtensionIdentifier, featureId: string): boolean {\n\t\tconst feature = this.registry.getExtensionFeature(featureId);\n\t\tif (!feature) {\n\t\t\treturn false;\n\t\t}\n\t\tconst isDisabled = this.getExtensionFeatureState(extension, featureId)?.disabled;\n\t\tif (isBoolean(isDisabled)) {\n\t\t\treturn !isDisabled;\n\t\t}\n\t\tconst defaultExtensionAccess = feature.access.extensionsList?.[extension._lower];\n\t\tif (isBoolean(defaultExtensionAccess)) {\n\t\t\treturn defaultExtensionAccess;\n\t\t}\n\t\treturn !feature.access.requireUserConsent;\n\t}\n\n\tsetEnablement(extension: ExtensionIdentifier, featureId: string, enabled: boolean): void {\n\t\tconst feature = this.registry.getExtensionFeature(featureId);\n\t\tif (!feature) {\n\t\t\tthrow new Error(`No feature with id '${featureId}'`);\n\t\t}\n\t\tconst featureState = this.getAndSetIfNotExistsExtensionFeatureState(extension, featureId);\n\t\tif (featureState.disabled !== !enabled) {\n\t\t\tfeatureState.disabled = !enabled;\n\t\t\tthis._onDidChangeEnablement.fire({ extension, featureId, enabled });\n\t\t\tthis.saveState();\n\t\t}\n\t}\n\n\tgetEnablementData(featureId: string): { readonly extension: ExtensionIdentifier; readonly enabled: boolean }[] {\n\t\tconst result: { readonly extension: ExtensionIdentifier; readonly enabled: boolean }[] = [];\n\t\tconst feature = this.registry.getExtensionFeature(featureId);\n\t\tif (feature) {\n\t\t\tfor (const [extension, featuresStateMap] of this.extensionFeaturesState) {\n\t\t\t\tconst featureState = featuresStateMap.get(featureId);\n\t\t\t\tif (featureState?.disabled !== undefined) {\n\t\t\t\t\tresult.push({ extension: new ExtensionIdentifier(extension), enabled: !featureState.disabled });\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn result;\n\t}\n\n\tasync getAccess(extension: ExtensionIdentifier, featureId: string, justification?: string): Promise<boolean> {\n\t\tconst feature = this.registry.getExtensionFeature(featureId);\n\t\tif (!feature) {\n\t\t\treturn false;\n\t\t}\n\t\tconst featureState = this.getAndSetIfNotExistsExtensionFeatureState(extension, featureId);\n\t\tif (featureState.disabled) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif (featureState.disabled === undefined) {\n\t\t\tlet enabled = true;\n\t\t\tif (feature.access.requireUserConsent) {\n\t\t\t\tconst extensionDescription = this.extensionService.extensions.find(e => ExtensionIdentifier.equals(e.identifier, extension));\n\t\t\t\tconst confirmationResult = await this.dialogService.confirm({\n\t\t\t\t\ttitle: localize('accessExtensionFeature', \"Access '{0}' Feature\", feature.label),\n\t\t\t\t\tmessage: localize('accessExtensionFeatureMessage', \"'{0}' extension would like to access the '{1}' feature.\", extensionDescription?.displayName ?? extension._lower, feature.label),\n\t\t\t\t\tdetail: justification ?? feature.description,\n\t\t\t\t\tcustom: true,\n\t\t\t\t\tprimaryButton: localize('allow', \"Allow\"),\n\t\t\t\t\tcancelButton: localize('disallow', \"Don't Allow\"),\n\t\t\t\t});\n\t\t\t\tenabled = confirmationResult.confirmed;\n\t\t\t}\n\t\t\tthis.setEnablement(extension, featureId, enabled);\n\t\t\tif (!enabled) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\n\t\tconst accessTime = new Date();\n\t\tfeatureState.accessData.current = {\n\t\t\taccessTimes: [accessTime].concat(featureState.accessData.current?.accessTimes ?? []),\n\t\t\tlastAccessed: accessTime,\n\t\t\tstatus: featureState.accessData.current?.status\n\t\t};\n\t\tfeatureState.accessData.accessTimes = (featureState.accessData.accessTimes ?? []).concat(accessTime);\n\t\tthis.saveState();\n\t\tthis._onDidChangeAccessData.fire({ extension, featureId, accessData: featureState.accessData });\n\t\treturn true;\n\t}\n\n\tgetAllAccessDataForExtension(extension: ExtensionIdentifier): Map<string, IExtensionFeatureAccessData> {\n\t\tconst result = new Map<string, IExtensionFeatureAccessData>();\n\t\tconst extensionState = this.extensionFeaturesState.get(extension._lower);\n\t\tif (extensionState) {\n\t\t\tfor (const [featureId, featureState] of extensionState) {\n\t\t\t\tresult.set(featureId, featureState.accessData);\n\t\t\t}\n\t\t}\n\t\treturn result;\n\t}\n\n\tgetAccessData(extension: ExtensionIdentifier, featureId: string): IExtensionFeatureAccessData | undefined {\n\t\tconst feature = this.registry.getExtensionFeature(featureId);\n\t\tif (!feature) {\n\t\t\treturn;\n\t\t}\n\t\treturn this.getExtensionFeatureState(extension, featureId)?.accessData;\n\t}\n\n\tsetStatus(extension: ExtensionIdentifier, featureId: string, status: { readonly severity: Severity; readonly message: string } | undefined): void {\n\t\tconst feature = this.registry.getExtensionFeature(featureId);\n\t\tif (!feature) {\n\t\t\tthrow new Error(`No feature with id '${featureId}'`);\n\t\t}\n\t\tconst featureState = this.getAndSetIfNotExistsExtensionFeatureState(extension, featureId);\n\t\tfeatureState.accessData.current = {\n\t\t\taccessTimes: featureState.accessData.current?.accessTimes ?? [],\n\t\t\tlastAccessed: featureState.accessData.current?.lastAccessed ?? new Date(),\n\t\t\tstatus\n\t\t};\n\t\tthis._onDidChangeAccessData.fire({ extension, featureId, accessData: this.getAccessData(extension, featureId)! });\n\t}\n\n\tprivate getExtensionFeatureState(extension: ExtensionIdentifier, featureId: string): IExtensionFeatureState | undefined {\n\t\treturn this.extensionFeaturesState.get(extension._lower)?.get(featureId);\n\t}\n\n\tprivate getAndSetIfNotExistsExtensionFeatureState(extension: ExtensionIdentifier, featureId: string): Mutable<IExtensionFeatureState> {\n\t\tlet extensionState = this.extensionFeaturesState.get(extension._lower);\n\t\tif (!extensionState) {\n\t\t\textensionState = new Map<string, IExtensionFeatureState>();\n\t\t\tthis.extensionFeaturesState.set(extension._lower, extensionState);\n\t\t}\n\t\tlet featureState = extensionState.get(featureId);\n\t\tif (!featureState) {\n\t\t\tfeatureState = { accessData: { accessTimes: [] } };\n\t\t\textensionState.set(featureId, featureState);\n\t\t}\n\t\treturn featureState;\n\t}\n\n\tprivate onDidStorageChange(e: IStorageChangeEvent): void {\n\t\tif (e.external) {\n\t\t\tconst oldState = this.extensionFeaturesState;\n\t\t\tthis.extensionFeaturesState = this.loadState();\n\t\t\tfor (const extensionId of distinct([...oldState.keys(), ...this.extensionFeaturesState.keys()])) {\n\t\t\t\tconst extension = new ExtensionIdentifier(extensionId);\n\t\t\t\tconst oldExtensionFeaturesState = oldState.get(extensionId);\n\t\t\t\tconst newExtensionFeaturesState = this.extensionFeaturesState.get(extensionId);\n\t\t\t\tfor (const featureId of distinct([...oldExtensionFeaturesState?.keys() ?? [], ...newExtensionFeaturesState?.keys() ?? []])) {\n\t\t\t\t\tconst isEnabled = this.isEnabled(extension, featureId);\n\t\t\t\t\tconst wasEnabled = !oldExtensionFeaturesState?.get(featureId)?.disabled;\n\t\t\t\t\tif (isEnabled !== wasEnabled) {\n\t\t\t\t\t\tthis._onDidChangeEnablement.fire({ extension, featureId, enabled: isEnabled });\n\t\t\t\t\t}\n\t\t\t\t\tconst newAccessData = this.getAccessData(extension, featureId);\n\t\t\t\t\tconst oldAccessData = oldExtensionFeaturesState?.get(featureId)?.accessData;\n\t\t\t\t\tif (!equals(newAccessData, oldAccessData)) {\n\t\t\t\t\t\tthis._onDidChangeAccessData.fire({ extension, featureId, accessData: newAccessData ?? { accessTimes: [] } });\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate loadState(): Map<string, Map<string, IExtensionFeatureState>> {\n\t\tlet data: IStringDictionary<IStringDictionary<{ disabled?: boolean; accessTimes?: number[] }>> = {};\n\t\tconst raw = this.storageService.get(FEATURES_STATE_KEY, StorageScope.PROFILE, '{}');\n\t\ttry {\n\t\t\tdata = JSON.parse(raw);\n\t\t} catch (e) {\n\t\t\t// ignore\n\t\t}\n\t\tconst result = new Map<string, Map<string, IExtensionFeatureState>>();\n\t\tfor (const extensionId in data) {\n\t\t\tconst extensionFeatureState = new Map<string, IExtensionFeatureState>();\n\t\t\tconst extensionFeatures = data[extensionId];\n\t\t\tfor (const featureId in extensionFeatures) {\n\t\t\t\tconst extensionFeature = extensionFeatures[featureId];\n\t\t\t\textensionFeatureState.set(featureId, {\n\t\t\t\t\tdisabled: extensionFeature.disabled,\n\t\t\t\t\taccessData: {\n\t\t\t\t\t\taccessTimes: (extensionFeature.accessTimes ?? []).map(time => new Date(time)),\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t\tresult.set(extensionId.toLowerCase(), extensionFeatureState);\n\t\t}\n\t\treturn result;\n\t}\n\n\tprivate saveState(): void {\n\t\tconst data: IStringDictionary<IStringDictionary<{ disabled?: boolean; accessTimes: number[] }>> = {};\n\t\tthis.extensionFeaturesState.forEach((extensionState, extensionId) => {\n\t\t\tconst extensionFeatures: IStringDictionary<{ disabled?: boolean; accessTimes: number[] }> = {};\n\t\t\textensionState.forEach((featureState, featureId) => {\n\t\t\t\textensionFeatures[featureId] = {\n\t\t\t\t\tdisabled: featureState.disabled,\n\t\t\t\t\taccessTimes: featureState.accessData.accessTimes.map(time => time.getTime()),\n\t\t\t\t};\n\t\t\t});\n\t\t\tdata[extensionId] = extensionFeatures;\n\t\t});\n\t\tthis.storageService.store(FEATURES_STATE_KEY, JSON.stringify(data), StorageScope.PROFILE, StorageTarget.USER);\n\t}\n\n\tprivate garbageCollectOldRequests(): void {\n\t\tconst now = new Date();\n\t\tconst thirtyDaysAgo = new Date(now.setDate(now.getDate() - 30));\n\t\tlet modified = false;\n\n\t\tfor (const [, featuresStateMap] of this.extensionFeaturesState) {\n\t\t\tfor (const [, featureState] of featuresStateMap) {\n\t\t\t\tconst originalLength = featureState.accessData.accessTimes.length;\n\t\t\t\tfeatureState.accessData.accessTimes = featureState.accessData.accessTimes.filter(accessTime => accessTime > thirtyDaysAgo);\n\t\t\t\tif (featureState.accessData.accessTimes.length !== originalLength) {\n\t\t\t\t\tmodified = true;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (modified) {\n\t\t\tthis.saveState();\n\t\t}\n\t}\n}\n\nregisterSingleton(IExtensionFeaturesManagementService, ExtensionFeaturesManagementService, InstantiationType.Delayed);\n"]}