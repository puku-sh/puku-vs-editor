{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/services/timer/electron-browser/timerService.ts","vs/workbench/services/timer/electron-browser/timerService.ts"],"names":[],"mappings":"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","file":"timerService.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { INativeHostService } from '../../../../platform/native/common/native.js';\nimport { INativeWorkbenchEnvironmentService } from '../../environment/electron-browser/environmentService.js';\nimport { IWorkspaceContextService } from '../../../../platform/workspace/common/workspace.js';\nimport { IExtensionService } from '../../extensions/common/extensions.js';\nimport { IUpdateService } from '../../../../platform/update/common/update.js';\nimport { ILifecycleService } from '../../lifecycle/common/lifecycle.js';\nimport { IEditorService } from '../../editor/common/editorService.js';\nimport { IAccessibilityService } from '../../../../platform/accessibility/common/accessibility.js';\nimport { IStartupMetrics, AbstractTimerService, Writeable, ITimerService } from '../browser/timerService.js';\nimport { ITelemetryService } from '../../../../platform/telemetry/common/telemetry.js';\nimport { process } from '../../../../base/parts/sandbox/electron-browser/globals.js';\nimport { InstantiationType, registerSingleton } from '../../../../platform/instantiation/common/extensions.js';\nimport { IWorkbenchLayoutService } from '../../layout/browser/layoutService.js';\nimport { IProductService } from '../../../../platform/product/common/productService.js';\nimport { IStorageService, StorageScope, StorageTarget } from '../../../../platform/storage/common/storage.js';\nimport { IPaneCompositePartService } from '../../panecomposite/browser/panecomposite.js';\n\nexport class TimerService extends AbstractTimerService {\n\n\tconstructor(\n\t\t@INativeHostService private readonly _nativeHostService: INativeHostService,\n\t\t@INativeWorkbenchEnvironmentService private readonly _environmentService: INativeWorkbenchEnvironmentService,\n\t\t@ILifecycleService lifecycleService: ILifecycleService,\n\t\t@IWorkspaceContextService contextService: IWorkspaceContextService,\n\t\t@IExtensionService extensionService: IExtensionService,\n\t\t@IUpdateService updateService: IUpdateService,\n\t\t@IPaneCompositePartService paneCompositeService: IPaneCompositePartService,\n\t\t@IEditorService editorService: IEditorService,\n\t\t@IAccessibilityService accessibilityService: IAccessibilityService,\n\t\t@ITelemetryService telemetryService: ITelemetryService,\n\t\t@IWorkbenchLayoutService layoutService: IWorkbenchLayoutService,\n\t\t@IProductService private readonly _productService: IProductService,\n\t\t@IStorageService private readonly _storageService: IStorageService\n\t) {\n\t\tsuper(lifecycleService, contextService, extensionService, updateService, paneCompositeService, editorService, accessibilityService, telemetryService, layoutService);\n\t\tthis.setPerformanceMarks('main', _environmentService.window.perfMarks);\n\t}\n\n\tprotected _isInitialStartup(): boolean {\n\t\treturn Boolean(this._environmentService.window.isInitialStartup);\n\t}\n\tprotected _didUseCachedData(): boolean {\n\t\treturn didUseCachedData(this._productService, this._storageService, this._environmentService);\n\t}\n\tprotected _getWindowCount(): Promise<number> {\n\t\treturn this._nativeHostService.getWindowCount();\n\t}\n\n\tprotected async _extendStartupInfo(info: Writeable<IStartupMetrics>): Promise<void> {\n\t\ttry {\n\t\t\tconst [osProperties, osStatistics, virtualMachineHint, isARM64Emulated] = await Promise.all([\n\t\t\t\tthis._nativeHostService.getOSProperties(),\n\t\t\t\tthis._nativeHostService.getOSStatistics(),\n\t\t\t\tthis._nativeHostService.getOSVirtualMachineHint(),\n\t\t\t\tthis._nativeHostService.isRunningUnderARM64Translation()\n\t\t\t]);\n\n\t\t\tinfo.totalmem = osStatistics.totalmem;\n\t\t\tinfo.freemem = osStatistics.freemem;\n\t\t\tinfo.platform = osProperties.platform;\n\t\t\tinfo.release = osProperties.release;\n\t\t\tinfo.arch = osProperties.arch;\n\t\t\tinfo.loadavg = osStatistics.loadavg;\n\t\t\tinfo.isARM64Emulated = isARM64Emulated;\n\n\t\t\tconst processMemoryInfo = await process.getProcessMemoryInfo();\n\t\t\tinfo.meminfo = {\n\t\t\t\tworkingSetSize: processMemoryInfo.residentSet,\n\t\t\t\tprivateBytes: processMemoryInfo.private,\n\t\t\t\tsharedBytes: processMemoryInfo.shared\n\t\t\t};\n\n\t\t\tinfo.isVMLikelyhood = Math.round((virtualMachineHint * 100));\n\n\t\t\tconst rawCpus = osProperties.cpus;\n\t\t\tif (rawCpus && rawCpus.length > 0) {\n\t\t\t\tinfo.cpus = { count: rawCpus.length, speed: rawCpus[0].speed, model: rawCpus[0].model };\n\t\t\t}\n\t\t} catch (error) {\n\t\t\t// ignore, be on the safe side with these hardware method calls\n\t\t}\n\t}\n\n\tprotected override _shouldReportPerfMarks(): boolean {\n\t\t// always send when running with the prof-append-timers flag\n\t\treturn super._shouldReportPerfMarks() || Boolean(this._environmentService.args['prof-append-timers']);\n\t}\n}\n\nregisterSingleton(ITimerService, TimerService, InstantiationType.Delayed);\n\n//#region cached data logic\n\nconst lastRunningCommitStorageKey = 'perf/lastRunningCommit';\nlet _didUseCachedData: boolean | undefined = undefined;\n\nexport function didUseCachedData(productService: IProductService, storageService: IStorageService, environmentService: INativeWorkbenchEnvironmentService): boolean {\n\t// browser code loading: only a guess based on\n\t// this being the first start with the commit\n\t// or subsequent\n\tif (typeof _didUseCachedData !== 'boolean') {\n\t\tif (!environmentService.window.isCodeCaching || !productService.commit) {\n\t\t\t_didUseCachedData = false; // we only produce cached data whith commit and code cache path\n\t\t} else if (storageService.get(lastRunningCommitStorageKey, StorageScope.APPLICATION) === productService.commit) {\n\t\t\t_didUseCachedData = true; // subsequent start on same commit, assume cached data is there\n\t\t} else {\n\t\t\tstorageService.store(lastRunningCommitStorageKey, productService.commit, StorageScope.APPLICATION, StorageTarget.MACHINE);\n\t\t\t_didUseCachedData = false; // first time start on commit, assume cached data is not yet there\n\t\t}\n\t}\n\treturn _didUseCachedData;\n}\n\n//#endregion\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { INativeHostService } from '../../../../platform/native/common/native.js';\nimport { INativeWorkbenchEnvironmentService } from '../../environment/electron-browser/environmentService.js';\nimport { IWorkspaceContextService } from '../../../../platform/workspace/common/workspace.js';\nimport { IExtensionService } from '../../extensions/common/extensions.js';\nimport { IUpdateService } from '../../../../platform/update/common/update.js';\nimport { ILifecycleService } from '../../lifecycle/common/lifecycle.js';\nimport { IEditorService } from '../../editor/common/editorService.js';\nimport { IAccessibilityService } from '../../../../platform/accessibility/common/accessibility.js';\nimport { IStartupMetrics, AbstractTimerService, Writeable, ITimerService } from '../browser/timerService.js';\nimport { ITelemetryService } from '../../../../platform/telemetry/common/telemetry.js';\nimport { process } from '../../../../base/parts/sandbox/electron-browser/globals.js';\nimport { InstantiationType, registerSingleton } from '../../../../platform/instantiation/common/extensions.js';\nimport { IWorkbenchLayoutService } from '../../layout/browser/layoutService.js';\nimport { IProductService } from '../../../../platform/product/common/productService.js';\nimport { IStorageService, StorageScope, StorageTarget } from '../../../../platform/storage/common/storage.js';\nimport { IPaneCompositePartService } from '../../panecomposite/browser/panecomposite.js';\n\nexport class TimerService extends AbstractTimerService {\n\n\tconstructor(\n\t\t@INativeHostService private readonly _nativeHostService: INativeHostService,\n\t\t@INativeWorkbenchEnvironmentService private readonly _environmentService: INativeWorkbenchEnvironmentService,\n\t\t@ILifecycleService lifecycleService: ILifecycleService,\n\t\t@IWorkspaceContextService contextService: IWorkspaceContextService,\n\t\t@IExtensionService extensionService: IExtensionService,\n\t\t@IUpdateService updateService: IUpdateService,\n\t\t@IPaneCompositePartService paneCompositeService: IPaneCompositePartService,\n\t\t@IEditorService editorService: IEditorService,\n\t\t@IAccessibilityService accessibilityService: IAccessibilityService,\n\t\t@ITelemetryService telemetryService: ITelemetryService,\n\t\t@IWorkbenchLayoutService layoutService: IWorkbenchLayoutService,\n\t\t@IProductService private readonly _productService: IProductService,\n\t\t@IStorageService private readonly _storageService: IStorageService\n\t) {\n\t\tsuper(lifecycleService, contextService, extensionService, updateService, paneCompositeService, editorService, accessibilityService, telemetryService, layoutService);\n\t\tthis.setPerformanceMarks('main', _environmentService.window.perfMarks);\n\t}\n\n\tprotected _isInitialStartup(): boolean {\n\t\treturn Boolean(this._environmentService.window.isInitialStartup);\n\t}\n\tprotected _didUseCachedData(): boolean {\n\t\treturn didUseCachedData(this._productService, this._storageService, this._environmentService);\n\t}\n\tprotected _getWindowCount(): Promise<number> {\n\t\treturn this._nativeHostService.getWindowCount();\n\t}\n\n\tprotected async _extendStartupInfo(info: Writeable<IStartupMetrics>): Promise<void> {\n\t\ttry {\n\t\t\tconst [osProperties, osStatistics, virtualMachineHint, isARM64Emulated] = await Promise.all([\n\t\t\t\tthis._nativeHostService.getOSProperties(),\n\t\t\t\tthis._nativeHostService.getOSStatistics(),\n\t\t\t\tthis._nativeHostService.getOSVirtualMachineHint(),\n\t\t\t\tthis._nativeHostService.isRunningUnderARM64Translation()\n\t\t\t]);\n\n\t\t\tinfo.totalmem = osStatistics.totalmem;\n\t\t\tinfo.freemem = osStatistics.freemem;\n\t\t\tinfo.platform = osProperties.platform;\n\t\t\tinfo.release = osProperties.release;\n\t\t\tinfo.arch = osProperties.arch;\n\t\t\tinfo.loadavg = osStatistics.loadavg;\n\t\t\tinfo.isARM64Emulated = isARM64Emulated;\n\n\t\t\tconst processMemoryInfo = await process.getProcessMemoryInfo();\n\t\t\tinfo.meminfo = {\n\t\t\t\tworkingSetSize: processMemoryInfo.residentSet,\n\t\t\t\tprivateBytes: processMemoryInfo.private,\n\t\t\t\tsharedBytes: processMemoryInfo.shared\n\t\t\t};\n\n\t\t\tinfo.isVMLikelyhood = Math.round((virtualMachineHint * 100));\n\n\t\t\tconst rawCpus = osProperties.cpus;\n\t\t\tif (rawCpus && rawCpus.length > 0) {\n\t\t\t\tinfo.cpus = { count: rawCpus.length, speed: rawCpus[0].speed, model: rawCpus[0].model };\n\t\t\t}\n\t\t} catch (error) {\n\t\t\t// ignore, be on the safe side with these hardware method calls\n\t\t}\n\t}\n\n\tprotected override _shouldReportPerfMarks(): boolean {\n\t\t// always send when running with the prof-append-timers flag\n\t\treturn super._shouldReportPerfMarks() || Boolean(this._environmentService.args['prof-append-timers']);\n\t}\n}\n\nregisterSingleton(ITimerService, TimerService, InstantiationType.Delayed);\n\n//#region cached data logic\n\nconst lastRunningCommitStorageKey = 'perf/lastRunningCommit';\nlet _didUseCachedData: boolean | undefined = undefined;\n\nexport function didUseCachedData(productService: IProductService, storageService: IStorageService, environmentService: INativeWorkbenchEnvironmentService): boolean {\n\t// browser code loading: only a guess based on\n\t// this being the first start with the commit\n\t// or subsequent\n\tif (typeof _didUseCachedData !== 'boolean') {\n\t\tif (!environmentService.window.isCodeCaching || !productService.commit) {\n\t\t\t_didUseCachedData = false; // we only produce cached data whith commit and code cache path\n\t\t} else if (storageService.get(lastRunningCommitStorageKey, StorageScope.APPLICATION) === productService.commit) {\n\t\t\t_didUseCachedData = true; // subsequent start on same commit, assume cached data is there\n\t\t} else {\n\t\t\tstorageService.store(lastRunningCommitStorageKey, productService.commit, StorageScope.APPLICATION, StorageTarget.MACHINE);\n\t\t\t_didUseCachedData = false; // first time start on commit, assume cached data is not yet there\n\t\t}\n\t}\n\treturn _didUseCachedData;\n}\n\n//#endregion\n"]}