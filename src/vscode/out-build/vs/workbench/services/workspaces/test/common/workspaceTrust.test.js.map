{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/services/workspaces/test/common/workspaceTrust.test.ts","vs/workbench/services/workspaces/test/common/workspaceTrust.test.ts"],"names":[],"mappings":"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","file":"workspaceTrust.test.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport assert from 'assert';\nimport { URI } from '../../../../../base/common/uri.js';\nimport { mock } from '../../../../../base/test/common/mock.js';\nimport { IConfigurationService } from '../../../../../platform/configuration/common/configuration.js';\nimport { TestConfigurationService } from '../../../../../platform/configuration/test/common/testConfigurationService.js';\nimport { FileService } from '../../../../../platform/files/common/fileService.js';\nimport { TestInstantiationService } from '../../../../../platform/instantiation/test/common/instantiationServiceMock.js';\nimport { NullLogService } from '../../../../../platform/log/common/log.js';\nimport { IRemoteAuthorityResolverService } from '../../../../../platform/remote/common/remoteAuthorityResolver.js';\nimport { IStorageService, StorageScope, StorageTarget } from '../../../../../platform/storage/common/storage.js';\nimport { IWorkspaceContextService } from '../../../../../platform/workspace/common/workspace.js';\nimport { IWorkspaceTrustEnablementService, IWorkspaceTrustInfo } from '../../../../../platform/workspace/common/workspaceTrust.js';\nimport { Workspace } from '../../../../../platform/workspace/test/common/testWorkspace.js';\nimport { Memento } from '../../../../common/memento.js';\nimport { IWorkbenchEnvironmentService } from '../../../environment/common/environmentService.js';\nimport { IUriIdentityService } from '../../../../../platform/uriIdentity/common/uriIdentity.js';\nimport { UriIdentityService } from '../../../../../platform/uriIdentity/common/uriIdentityService.js';\nimport { WorkspaceTrustEnablementService, WorkspaceTrustManagementService, WORKSPACE_TRUST_STORAGE_KEY } from '../../common/workspaceTrust.js';\nimport { TestContextService, TestStorageService, TestWorkspaceTrustEnablementService } from '../../../../test/common/workbenchTestServices.js';\nimport { ensureNoDisposablesAreLeakedInTestSuite } from '../../../../../base/test/common/utils.js';\nimport { Mutable } from '../../../../../base/common/types.js';\n\nsuite('Workspace Trust', () => {\n\tconst store = ensureNoDisposablesAreLeakedInTestSuite();\n\n\tlet instantiationService: TestInstantiationService;\n\tlet configurationService: TestConfigurationService;\n\tlet environmentService: Mutable<IWorkbenchEnvironmentService>;\n\n\tsetup(async () => {\n\t\tinstantiationService = store.add(new TestInstantiationService());\n\n\t\tconfigurationService = new TestConfigurationService();\n\t\tinstantiationService.stub(IConfigurationService, configurationService);\n\n\t\tenvironmentService = {} as IWorkbenchEnvironmentService;\n\t\tinstantiationService.stub(IWorkbenchEnvironmentService, environmentService);\n\n\t\tconst fileService = store.add(new FileService(new NullLogService()));\n\t\tconst uriIdentityService = store.add(new UriIdentityService(fileService));\n\n\t\tinstantiationService.stub(IUriIdentityService, uriIdentityService);\n\t\tinstantiationService.stub(IRemoteAuthorityResolverService, new class extends mock<IRemoteAuthorityResolverService>() { });\n\t});\n\n\tsuite('Enablement', () => {\n\t\ttest('workspace trust enabled', async () => {\n\t\t\tawait configurationService.setUserConfiguration('security', getUserSettings(true, true));\n\t\t\tconst testObject = store.add(instantiationService.createInstance(WorkspaceTrustEnablementService));\n\n\t\t\tassert.strictEqual(testObject.isWorkspaceTrustEnabled(), true);\n\t\t});\n\n\t\ttest('workspace trust disabled (user setting)', async () => {\n\t\t\tawait configurationService.setUserConfiguration('security', getUserSettings(false, true));\n\t\t\tconst testObject = store.add(instantiationService.createInstance(WorkspaceTrustEnablementService));\n\n\t\t\tassert.strictEqual(testObject.isWorkspaceTrustEnabled(), false);\n\t\t});\n\n\t\ttest('workspace trust disabled (--disable-workspace-trust)', () => {\n\t\t\tinstantiationService.stub(IWorkbenchEnvironmentService, { ...environmentService, disableWorkspaceTrust: true });\n\t\t\tconst testObject = store.add(instantiationService.createInstance(WorkspaceTrustEnablementService));\n\n\t\t\tassert.strictEqual(testObject.isWorkspaceTrustEnabled(), false);\n\t\t});\n\t});\n\n\tsuite('Management', () => {\n\t\tlet storageService: TestStorageService;\n\t\tlet workspaceService: TestContextService;\n\n\t\tteardown(() => {\n\t\t\tMemento.clear(StorageScope.WORKSPACE);\n\t\t});\n\n\t\tsetup(() => {\n\t\t\tstorageService = store.add(new TestStorageService());\n\t\t\tinstantiationService.stub(IStorageService, storageService);\n\n\t\t\tworkspaceService = new TestContextService();\n\t\t\tinstantiationService.stub(IWorkspaceContextService, workspaceService);\n\n\t\t\tinstantiationService.stub(IWorkspaceTrustEnablementService, new TestWorkspaceTrustEnablementService());\n\t\t});\n\n\t\ttest('empty workspace - trusted', async () => {\n\t\t\tawait configurationService.setUserConfiguration('security', getUserSettings(true, true));\n\t\t\tworkspaceService.setWorkspace(new Workspace('empty-workspace'));\n\t\t\tconst testObject = await initializeTestObject();\n\n\t\t\tassert.strictEqual(true, testObject.isWorkspaceTrusted());\n\t\t});\n\n\t\ttest('empty workspace - untrusted', async () => {\n\t\t\tawait configurationService.setUserConfiguration('security', getUserSettings(true, false));\n\t\t\tworkspaceService.setWorkspace(new Workspace('empty-workspace'));\n\t\t\tconst testObject = await initializeTestObject();\n\n\t\t\tassert.strictEqual(false, testObject.isWorkspaceTrusted());\n\t\t});\n\n\t\ttest('empty workspace - trusted, open trusted file', async () => {\n\t\t\tawait configurationService.setUserConfiguration('security', getUserSettings(true, true));\n\t\t\tconst trustInfo: IWorkspaceTrustInfo = { uriTrustInfo: [{ uri: URI.parse('file:///Folder'), trusted: true }] };\n\t\t\tstorageService.store(WORKSPACE_TRUST_STORAGE_KEY, JSON.stringify(trustInfo), StorageScope.APPLICATION, StorageTarget.MACHINE);\n\n\t\t\tenvironmentService.filesToOpenOrCreate = [{ fileUri: URI.parse('file:///Folder/file.txt') }];\n\t\t\tinstantiationService.stub(IWorkbenchEnvironmentService, { ...environmentService });\n\n\t\t\tworkspaceService.setWorkspace(new Workspace('empty-workspace'));\n\t\t\tconst testObject = await initializeTestObject();\n\n\t\t\tassert.strictEqual(true, testObject.isWorkspaceTrusted());\n\t\t});\n\n\t\ttest('empty workspace - trusted, open untrusted file', async () => {\n\t\t\tawait configurationService.setUserConfiguration('security', getUserSettings(true, true));\n\n\t\t\tenvironmentService.filesToOpenOrCreate = [{ fileUri: URI.parse('file:///Folder/foo.txt') }];\n\t\t\tinstantiationService.stub(IWorkbenchEnvironmentService, { ...environmentService });\n\n\t\t\tworkspaceService.setWorkspace(new Workspace('empty-workspace'));\n\t\t\tconst testObject = await initializeTestObject();\n\n\t\t\tassert.strictEqual(false, testObject.isWorkspaceTrusted());\n\t\t});\n\n\t\tasync function initializeTestObject(): Promise<WorkspaceTrustManagementService> {\n\t\t\tconst workspaceTrustManagementService = store.add(instantiationService.createInstance(WorkspaceTrustManagementService));\n\t\t\tawait workspaceTrustManagementService.workspaceTrustInitialized;\n\n\t\t\treturn workspaceTrustManagementService;\n\t\t}\n\t});\n\n\tfunction getUserSettings(enabled: boolean, emptyWindow: boolean) {\n\t\treturn { workspace: { trust: { emptyWindow, enabled } } };\n\t}\n});\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport assert from 'assert';\nimport { URI } from '../../../../../base/common/uri.js';\nimport { mock } from '../../../../../base/test/common/mock.js';\nimport { IConfigurationService } from '../../../../../platform/configuration/common/configuration.js';\nimport { TestConfigurationService } from '../../../../../platform/configuration/test/common/testConfigurationService.js';\nimport { FileService } from '../../../../../platform/files/common/fileService.js';\nimport { TestInstantiationService } from '../../../../../platform/instantiation/test/common/instantiationServiceMock.js';\nimport { NullLogService } from '../../../../../platform/log/common/log.js';\nimport { IRemoteAuthorityResolverService } from '../../../../../platform/remote/common/remoteAuthorityResolver.js';\nimport { IStorageService, StorageScope, StorageTarget } from '../../../../../platform/storage/common/storage.js';\nimport { IWorkspaceContextService } from '../../../../../platform/workspace/common/workspace.js';\nimport { IWorkspaceTrustEnablementService, IWorkspaceTrustInfo } from '../../../../../platform/workspace/common/workspaceTrust.js';\nimport { Workspace } from '../../../../../platform/workspace/test/common/testWorkspace.js';\nimport { Memento } from '../../../../common/memento.js';\nimport { IWorkbenchEnvironmentService } from '../../../environment/common/environmentService.js';\nimport { IUriIdentityService } from '../../../../../platform/uriIdentity/common/uriIdentity.js';\nimport { UriIdentityService } from '../../../../../platform/uriIdentity/common/uriIdentityService.js';\nimport { WorkspaceTrustEnablementService, WorkspaceTrustManagementService, WORKSPACE_TRUST_STORAGE_KEY } from '../../common/workspaceTrust.js';\nimport { TestContextService, TestStorageService, TestWorkspaceTrustEnablementService } from '../../../../test/common/workbenchTestServices.js';\nimport { ensureNoDisposablesAreLeakedInTestSuite } from '../../../../../base/test/common/utils.js';\nimport { Mutable } from '../../../../../base/common/types.js';\n\nsuite('Workspace Trust', () => {\n\tconst store = ensureNoDisposablesAreLeakedInTestSuite();\n\n\tlet instantiationService: TestInstantiationService;\n\tlet configurationService: TestConfigurationService;\n\tlet environmentService: Mutable<IWorkbenchEnvironmentService>;\n\n\tsetup(async () => {\n\t\tinstantiationService = store.add(new TestInstantiationService());\n\n\t\tconfigurationService = new TestConfigurationService();\n\t\tinstantiationService.stub(IConfigurationService, configurationService);\n\n\t\tenvironmentService = {} as IWorkbenchEnvironmentService;\n\t\tinstantiationService.stub(IWorkbenchEnvironmentService, environmentService);\n\n\t\tconst fileService = store.add(new FileService(new NullLogService()));\n\t\tconst uriIdentityService = store.add(new UriIdentityService(fileService));\n\n\t\tinstantiationService.stub(IUriIdentityService, uriIdentityService);\n\t\tinstantiationService.stub(IRemoteAuthorityResolverService, new class extends mock<IRemoteAuthorityResolverService>() { });\n\t});\n\n\tsuite('Enablement', () => {\n\t\ttest('workspace trust enabled', async () => {\n\t\t\tawait configurationService.setUserConfiguration('security', getUserSettings(true, true));\n\t\t\tconst testObject = store.add(instantiationService.createInstance(WorkspaceTrustEnablementService));\n\n\t\t\tassert.strictEqual(testObject.isWorkspaceTrustEnabled(), true);\n\t\t});\n\n\t\ttest('workspace trust disabled (user setting)', async () => {\n\t\t\tawait configurationService.setUserConfiguration('security', getUserSettings(false, true));\n\t\t\tconst testObject = store.add(instantiationService.createInstance(WorkspaceTrustEnablementService));\n\n\t\t\tassert.strictEqual(testObject.isWorkspaceTrustEnabled(), false);\n\t\t});\n\n\t\ttest('workspace trust disabled (--disable-workspace-trust)', () => {\n\t\t\tinstantiationService.stub(IWorkbenchEnvironmentService, { ...environmentService, disableWorkspaceTrust: true });\n\t\t\tconst testObject = store.add(instantiationService.createInstance(WorkspaceTrustEnablementService));\n\n\t\t\tassert.strictEqual(testObject.isWorkspaceTrustEnabled(), false);\n\t\t});\n\t});\n\n\tsuite('Management', () => {\n\t\tlet storageService: TestStorageService;\n\t\tlet workspaceService: TestContextService;\n\n\t\tteardown(() => {\n\t\t\tMemento.clear(StorageScope.WORKSPACE);\n\t\t});\n\n\t\tsetup(() => {\n\t\t\tstorageService = store.add(new TestStorageService());\n\t\t\tinstantiationService.stub(IStorageService, storageService);\n\n\t\t\tworkspaceService = new TestContextService();\n\t\t\tinstantiationService.stub(IWorkspaceContextService, workspaceService);\n\n\t\t\tinstantiationService.stub(IWorkspaceTrustEnablementService, new TestWorkspaceTrustEnablementService());\n\t\t});\n\n\t\ttest('empty workspace - trusted', async () => {\n\t\t\tawait configurationService.setUserConfiguration('security', getUserSettings(true, true));\n\t\t\tworkspaceService.setWorkspace(new Workspace('empty-workspace'));\n\t\t\tconst testObject = await initializeTestObject();\n\n\t\t\tassert.strictEqual(true, testObject.isWorkspaceTrusted());\n\t\t});\n\n\t\ttest('empty workspace - untrusted', async () => {\n\t\t\tawait configurationService.setUserConfiguration('security', getUserSettings(true, false));\n\t\t\tworkspaceService.setWorkspace(new Workspace('empty-workspace'));\n\t\t\tconst testObject = await initializeTestObject();\n\n\t\t\tassert.strictEqual(false, testObject.isWorkspaceTrusted());\n\t\t});\n\n\t\ttest('empty workspace - trusted, open trusted file', async () => {\n\t\t\tawait configurationService.setUserConfiguration('security', getUserSettings(true, true));\n\t\t\tconst trustInfo: IWorkspaceTrustInfo = { uriTrustInfo: [{ uri: URI.parse('file:///Folder'), trusted: true }] };\n\t\t\tstorageService.store(WORKSPACE_TRUST_STORAGE_KEY, JSON.stringify(trustInfo), StorageScope.APPLICATION, StorageTarget.MACHINE);\n\n\t\t\tenvironmentService.filesToOpenOrCreate = [{ fileUri: URI.parse('file:///Folder/file.txt') }];\n\t\t\tinstantiationService.stub(IWorkbenchEnvironmentService, { ...environmentService });\n\n\t\t\tworkspaceService.setWorkspace(new Workspace('empty-workspace'));\n\t\t\tconst testObject = await initializeTestObject();\n\n\t\t\tassert.strictEqual(true, testObject.isWorkspaceTrusted());\n\t\t});\n\n\t\ttest('empty workspace - trusted, open untrusted file', async () => {\n\t\t\tawait configurationService.setUserConfiguration('security', getUserSettings(true, true));\n\n\t\t\tenvironmentService.filesToOpenOrCreate = [{ fileUri: URI.parse('file:///Folder/foo.txt') }];\n\t\t\tinstantiationService.stub(IWorkbenchEnvironmentService, { ...environmentService });\n\n\t\t\tworkspaceService.setWorkspace(new Workspace('empty-workspace'));\n\t\t\tconst testObject = await initializeTestObject();\n\n\t\t\tassert.strictEqual(false, testObject.isWorkspaceTrusted());\n\t\t});\n\n\t\tasync function initializeTestObject(): Promise<WorkspaceTrustManagementService> {\n\t\t\tconst workspaceTrustManagementService = store.add(instantiationService.createInstance(WorkspaceTrustManagementService));\n\t\t\tawait workspaceTrustManagementService.workspaceTrustInitialized;\n\n\t\t\treturn workspaceTrustManagementService;\n\t\t}\n\t});\n\n\tfunction getUserSettings(enabled: boolean, emptyWindow: boolean) {\n\t\treturn { workspace: { trust: { emptyWindow, enabled } } };\n\t}\n});\n"]}