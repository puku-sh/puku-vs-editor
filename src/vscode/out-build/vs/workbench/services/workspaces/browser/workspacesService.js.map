{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/services/workspaces/browser/workspacesService.ts","vs/workbench/services/workspaces/browser/workspacesService.ts"],"names":[],"mappings":"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","file":"workspacesService.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { InstantiationType, registerSingleton } from '../../../../platform/instantiation/common/extensions.js';\nimport { IWorkspacesService, IWorkspaceFolderCreationData, IEnterWorkspaceResult, IRecentlyOpened, restoreRecentlyOpened, IRecent, isRecentFile, isRecentFolder, toStoreData, IStoredWorkspaceFolder, getStoredWorkspaceFolder, IStoredWorkspace, isRecentWorkspace } from '../../../../platform/workspaces/common/workspaces.js';\nimport { URI } from '../../../../base/common/uri.js';\nimport { Emitter } from '../../../../base/common/event.js';\nimport { IStorageService, StorageScope, StorageTarget } from '../../../../platform/storage/common/storage.js';\nimport { isTemporaryWorkspace, IWorkspaceContextService, IWorkspaceFoldersChangeEvent, IWorkspaceIdentifier, WorkbenchState, WORKSPACE_EXTENSION } from '../../../../platform/workspace/common/workspace.js';\nimport { ILogService } from '../../../../platform/log/common/log.js';\nimport { Disposable } from '../../../../base/common/lifecycle.js';\nimport { getWorkspaceIdentifier } from './workspaces.js';\nimport { IFileService, FileOperationError, FileOperationResult } from '../../../../platform/files/common/files.js';\nimport { IWorkbenchEnvironmentService } from '../../environment/common/environmentService.js';\nimport { joinPath } from '../../../../base/common/resources.js';\nimport { VSBuffer } from '../../../../base/common/buffer.js';\nimport { IUriIdentityService } from '../../../../platform/uriIdentity/common/uriIdentity.js';\nimport { IWorkspaceBackupInfo, IFolderBackupInfo } from '../../../../platform/backup/common/backup.js';\nimport { Schemas } from '../../../../base/common/network.js';\n\nexport class BrowserWorkspacesService extends Disposable implements IWorkspacesService {\n\n\tstatic readonly RECENTLY_OPENED_KEY = 'recently.opened';\n\n\tdeclare readonly _serviceBrand: undefined;\n\n\tprivate readonly _onRecentlyOpenedChange = this._register(new Emitter<void>());\n\treadonly onDidChangeRecentlyOpened = this._onRecentlyOpenedChange.event;\n\n\tconstructor(\n\t\t@IStorageService private readonly storageService: IStorageService,\n\t\t@IWorkspaceContextService private readonly contextService: IWorkspaceContextService,\n\t\t@ILogService private readonly logService: ILogService,\n\t\t@IFileService private readonly fileService: IFileService,\n\t\t@IWorkbenchEnvironmentService private readonly environmentService: IWorkbenchEnvironmentService,\n\t\t@IUriIdentityService private readonly uriIdentityService: IUriIdentityService,\n\t) {\n\t\tsuper();\n\n\t\t// Opening a workspace should push it as most\n\t\t// recently used to the workspaces history\n\t\tthis.addWorkspaceToRecentlyOpened();\n\n\t\tthis.registerListeners();\n\t}\n\n\tprivate registerListeners(): void {\n\n\t\t// Storage\n\t\tthis._register(this.storageService.onDidChangeValue(StorageScope.APPLICATION, BrowserWorkspacesService.RECENTLY_OPENED_KEY, this._store)(() => this._onRecentlyOpenedChange.fire()));\n\n\t\t// Workspace\n\t\tthis._register(this.contextService.onDidChangeWorkspaceFolders(e => this.onDidChangeWorkspaceFolders(e)));\n\t}\n\n\tprivate onDidChangeWorkspaceFolders(e: IWorkspaceFoldersChangeEvent): void {\n\t\tif (!isTemporaryWorkspace(this.contextService.getWorkspace())) {\n\t\t\treturn;\n\t\t}\n\n\t\t// When in a temporary workspace, make sure to track folder changes\n\t\t// in the history so that these can later be restored.\n\n\t\tfor (const folder of e.added) {\n\t\t\tthis.addRecentlyOpened([{ folderUri: folder.uri }]);\n\t\t}\n\t}\n\n\tprivate addWorkspaceToRecentlyOpened(): void {\n\t\tconst workspace = this.contextService.getWorkspace();\n\t\tconst remoteAuthority = this.environmentService.remoteAuthority;\n\t\tswitch (this.contextService.getWorkbenchState()) {\n\t\t\tcase WorkbenchState.FOLDER:\n\t\t\t\tthis.addRecentlyOpened([{ folderUri: workspace.folders[0].uri, remoteAuthority }]);\n\t\t\t\tbreak;\n\t\t\tcase WorkbenchState.WORKSPACE:\n\t\t\t\tthis.addRecentlyOpened([{ workspace: { id: workspace.id, configPath: workspace.configuration! }, remoteAuthority }]);\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\t//#region Workspaces History\n\n\tasync getRecentlyOpened(): Promise<IRecentlyOpened> {\n\t\tconst recentlyOpenedRaw = this.storageService.get(BrowserWorkspacesService.RECENTLY_OPENED_KEY, StorageScope.APPLICATION);\n\t\tif (recentlyOpenedRaw) {\n\t\t\tconst recentlyOpened = restoreRecentlyOpened(JSON.parse(recentlyOpenedRaw), this.logService);\n\t\t\trecentlyOpened.workspaces = recentlyOpened.workspaces.filter(recent => {\n\n\t\t\t\t// In web, unless we are in a temporary workspace, we cannot support\n\t\t\t\t// to switch to local folders because this would require a window\n\t\t\t\t// reload and local file access only works with explicit user gesture\n\t\t\t\t// from the current session.\n\t\t\t\tif (isRecentFolder(recent) && recent.folderUri.scheme === Schemas.file && !isTemporaryWorkspace(this.contextService.getWorkspace())) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\t// Never offer temporary workspaces in the history\n\t\t\t\tif (isRecentWorkspace(recent) && isTemporaryWorkspace(recent.workspace.configPath)) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\treturn true;\n\t\t\t});\n\n\t\t\treturn recentlyOpened;\n\t\t}\n\n\t\treturn { workspaces: [], files: [] };\n\t}\n\n\tasync addRecentlyOpened(recents: IRecent[]): Promise<void> {\n\t\tconst recentlyOpened = await this.getRecentlyOpened();\n\n\t\tfor (const recent of recents) {\n\t\t\tif (isRecentFile(recent)) {\n\t\t\t\tthis.doRemoveRecentlyOpened(recentlyOpened, [recent.fileUri]);\n\t\t\t\trecentlyOpened.files.unshift(recent);\n\t\t\t} else if (isRecentFolder(recent)) {\n\t\t\t\tthis.doRemoveRecentlyOpened(recentlyOpened, [recent.folderUri]);\n\t\t\t\trecentlyOpened.workspaces.unshift(recent);\n\t\t\t} else {\n\t\t\t\tthis.doRemoveRecentlyOpened(recentlyOpened, [recent.workspace.configPath]);\n\t\t\t\trecentlyOpened.workspaces.unshift(recent);\n\t\t\t}\n\t\t}\n\n\t\treturn this.saveRecentlyOpened(recentlyOpened);\n\t}\n\n\tasync removeRecentlyOpened(paths: URI[]): Promise<void> {\n\t\tconst recentlyOpened = await this.getRecentlyOpened();\n\n\t\tthis.doRemoveRecentlyOpened(recentlyOpened, paths);\n\n\t\treturn this.saveRecentlyOpened(recentlyOpened);\n\t}\n\n\tprivate doRemoveRecentlyOpened(recentlyOpened: IRecentlyOpened, paths: URI[]): void {\n\t\trecentlyOpened.files = recentlyOpened.files.filter(file => {\n\t\t\treturn !paths.some(path => path.toString() === file.fileUri.toString());\n\t\t});\n\n\t\trecentlyOpened.workspaces = recentlyOpened.workspaces.filter(workspace => {\n\t\t\treturn !paths.some(path => path.toString() === (isRecentFolder(workspace) ? workspace.folderUri.toString() : workspace.workspace.configPath.toString()));\n\t\t});\n\t}\n\n\tprivate async saveRecentlyOpened(data: IRecentlyOpened): Promise<void> {\n\t\treturn this.storageService.store(BrowserWorkspacesService.RECENTLY_OPENED_KEY, JSON.stringify(toStoreData(data)), StorageScope.APPLICATION, StorageTarget.USER);\n\t}\n\n\tasync clearRecentlyOpened(): Promise<void> {\n\t\tthis.storageService.remove(BrowserWorkspacesService.RECENTLY_OPENED_KEY, StorageScope.APPLICATION);\n\t}\n\n\t//#endregion\n\n\t//#region Workspace Management\n\n\tasync enterWorkspace(workspaceUri: URI): Promise<IEnterWorkspaceResult | undefined> {\n\t\treturn { workspace: await this.getWorkspaceIdentifier(workspaceUri) };\n\t}\n\n\tasync createUntitledWorkspace(folders?: IWorkspaceFolderCreationData[], remoteAuthority?: string): Promise<IWorkspaceIdentifier> {\n\t\tconst randomId = (Date.now() + Math.round(Math.random() * 1000)).toString();\n\t\tconst newUntitledWorkspacePath = joinPath(this.environmentService.untitledWorkspacesHome, `Untitled-${randomId}.${WORKSPACE_EXTENSION}`);\n\n\t\t// Build array of workspace folders to store\n\t\tconst storedWorkspaceFolder: IStoredWorkspaceFolder[] = [];\n\t\tif (folders) {\n\t\t\tfor (const folder of folders) {\n\t\t\t\tstoredWorkspaceFolder.push(getStoredWorkspaceFolder(folder.uri, true, folder.name, this.environmentService.untitledWorkspacesHome, this.uriIdentityService.extUri));\n\t\t\t}\n\t\t}\n\n\t\t// Store at untitled workspaces location\n\t\tconst storedWorkspace: IStoredWorkspace = { folders: storedWorkspaceFolder, remoteAuthority };\n\t\tawait this.fileService.writeFile(newUntitledWorkspacePath, VSBuffer.fromString(JSON.stringify(storedWorkspace, null, '\\t')));\n\n\t\treturn this.getWorkspaceIdentifier(newUntitledWorkspacePath);\n\t}\n\n\tasync deleteUntitledWorkspace(workspace: IWorkspaceIdentifier): Promise<void> {\n\t\ttry {\n\t\t\tawait this.fileService.del(workspace.configPath);\n\t\t} catch (error) {\n\t\t\tif ((<FileOperationError>error).fileOperationResult !== FileOperationResult.FILE_NOT_FOUND) {\n\t\t\t\tthrow error; // re-throw any other error than file not found which is OK\n\t\t\t}\n\t\t}\n\t}\n\n\tasync getWorkspaceIdentifier(workspaceUri: URI): Promise<IWorkspaceIdentifier> {\n\t\treturn getWorkspaceIdentifier(workspaceUri);\n\t}\n\n\t//#endregion\n\n\n\t//#region Dirty Workspaces\n\n\tasync getDirtyWorkspaces(): Promise<Array<IWorkspaceBackupInfo | IFolderBackupInfo>> {\n\t\treturn []; // Currently not supported in web\n\t}\n\n\t//#endregion\n}\n\nregisterSingleton(IWorkspacesService, BrowserWorkspacesService, InstantiationType.Delayed);\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { InstantiationType, registerSingleton } from '../../../../platform/instantiation/common/extensions.js';\nimport { IWorkspacesService, IWorkspaceFolderCreationData, IEnterWorkspaceResult, IRecentlyOpened, restoreRecentlyOpened, IRecent, isRecentFile, isRecentFolder, toStoreData, IStoredWorkspaceFolder, getStoredWorkspaceFolder, IStoredWorkspace, isRecentWorkspace } from '../../../../platform/workspaces/common/workspaces.js';\nimport { URI } from '../../../../base/common/uri.js';\nimport { Emitter } from '../../../../base/common/event.js';\nimport { IStorageService, StorageScope, StorageTarget } from '../../../../platform/storage/common/storage.js';\nimport { isTemporaryWorkspace, IWorkspaceContextService, IWorkspaceFoldersChangeEvent, IWorkspaceIdentifier, WorkbenchState, WORKSPACE_EXTENSION } from '../../../../platform/workspace/common/workspace.js';\nimport { ILogService } from '../../../../platform/log/common/log.js';\nimport { Disposable } from '../../../../base/common/lifecycle.js';\nimport { getWorkspaceIdentifier } from './workspaces.js';\nimport { IFileService, FileOperationError, FileOperationResult } from '../../../../platform/files/common/files.js';\nimport { IWorkbenchEnvironmentService } from '../../environment/common/environmentService.js';\nimport { joinPath } from '../../../../base/common/resources.js';\nimport { VSBuffer } from '../../../../base/common/buffer.js';\nimport { IUriIdentityService } from '../../../../platform/uriIdentity/common/uriIdentity.js';\nimport { IWorkspaceBackupInfo, IFolderBackupInfo } from '../../../../platform/backup/common/backup.js';\nimport { Schemas } from '../../../../base/common/network.js';\n\nexport class BrowserWorkspacesService extends Disposable implements IWorkspacesService {\n\n\tstatic readonly RECENTLY_OPENED_KEY = 'recently.opened';\n\n\tdeclare readonly _serviceBrand: undefined;\n\n\tprivate readonly _onRecentlyOpenedChange = this._register(new Emitter<void>());\n\treadonly onDidChangeRecentlyOpened = this._onRecentlyOpenedChange.event;\n\n\tconstructor(\n\t\t@IStorageService private readonly storageService: IStorageService,\n\t\t@IWorkspaceContextService private readonly contextService: IWorkspaceContextService,\n\t\t@ILogService private readonly logService: ILogService,\n\t\t@IFileService private readonly fileService: IFileService,\n\t\t@IWorkbenchEnvironmentService private readonly environmentService: IWorkbenchEnvironmentService,\n\t\t@IUriIdentityService private readonly uriIdentityService: IUriIdentityService,\n\t) {\n\t\tsuper();\n\n\t\t// Opening a workspace should push it as most\n\t\t// recently used to the workspaces history\n\t\tthis.addWorkspaceToRecentlyOpened();\n\n\t\tthis.registerListeners();\n\t}\n\n\tprivate registerListeners(): void {\n\n\t\t// Storage\n\t\tthis._register(this.storageService.onDidChangeValue(StorageScope.APPLICATION, BrowserWorkspacesService.RECENTLY_OPENED_KEY, this._store)(() => this._onRecentlyOpenedChange.fire()));\n\n\t\t// Workspace\n\t\tthis._register(this.contextService.onDidChangeWorkspaceFolders(e => this.onDidChangeWorkspaceFolders(e)));\n\t}\n\n\tprivate onDidChangeWorkspaceFolders(e: IWorkspaceFoldersChangeEvent): void {\n\t\tif (!isTemporaryWorkspace(this.contextService.getWorkspace())) {\n\t\t\treturn;\n\t\t}\n\n\t\t// When in a temporary workspace, make sure to track folder changes\n\t\t// in the history so that these can later be restored.\n\n\t\tfor (const folder of e.added) {\n\t\t\tthis.addRecentlyOpened([{ folderUri: folder.uri }]);\n\t\t}\n\t}\n\n\tprivate addWorkspaceToRecentlyOpened(): void {\n\t\tconst workspace = this.contextService.getWorkspace();\n\t\tconst remoteAuthority = this.environmentService.remoteAuthority;\n\t\tswitch (this.contextService.getWorkbenchState()) {\n\t\t\tcase WorkbenchState.FOLDER:\n\t\t\t\tthis.addRecentlyOpened([{ folderUri: workspace.folders[0].uri, remoteAuthority }]);\n\t\t\t\tbreak;\n\t\t\tcase WorkbenchState.WORKSPACE:\n\t\t\t\tthis.addRecentlyOpened([{ workspace: { id: workspace.id, configPath: workspace.configuration! }, remoteAuthority }]);\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\t//#region Workspaces History\n\n\tasync getRecentlyOpened(): Promise<IRecentlyOpened> {\n\t\tconst recentlyOpenedRaw = this.storageService.get(BrowserWorkspacesService.RECENTLY_OPENED_KEY, StorageScope.APPLICATION);\n\t\tif (recentlyOpenedRaw) {\n\t\t\tconst recentlyOpened = restoreRecentlyOpened(JSON.parse(recentlyOpenedRaw), this.logService);\n\t\t\trecentlyOpened.workspaces = recentlyOpened.workspaces.filter(recent => {\n\n\t\t\t\t// In web, unless we are in a temporary workspace, we cannot support\n\t\t\t\t// to switch to local folders because this would require a window\n\t\t\t\t// reload and local file access only works with explicit user gesture\n\t\t\t\t// from the current session.\n\t\t\t\tif (isRecentFolder(recent) && recent.folderUri.scheme === Schemas.file && !isTemporaryWorkspace(this.contextService.getWorkspace())) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\t// Never offer temporary workspaces in the history\n\t\t\t\tif (isRecentWorkspace(recent) && isTemporaryWorkspace(recent.workspace.configPath)) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\treturn true;\n\t\t\t});\n\n\t\t\treturn recentlyOpened;\n\t\t}\n\n\t\treturn { workspaces: [], files: [] };\n\t}\n\n\tasync addRecentlyOpened(recents: IRecent[]): Promise<void> {\n\t\tconst recentlyOpened = await this.getRecentlyOpened();\n\n\t\tfor (const recent of recents) {\n\t\t\tif (isRecentFile(recent)) {\n\t\t\t\tthis.doRemoveRecentlyOpened(recentlyOpened, [recent.fileUri]);\n\t\t\t\trecentlyOpened.files.unshift(recent);\n\t\t\t} else if (isRecentFolder(recent)) {\n\t\t\t\tthis.doRemoveRecentlyOpened(recentlyOpened, [recent.folderUri]);\n\t\t\t\trecentlyOpened.workspaces.unshift(recent);\n\t\t\t} else {\n\t\t\t\tthis.doRemoveRecentlyOpened(recentlyOpened, [recent.workspace.configPath]);\n\t\t\t\trecentlyOpened.workspaces.unshift(recent);\n\t\t\t}\n\t\t}\n\n\t\treturn this.saveRecentlyOpened(recentlyOpened);\n\t}\n\n\tasync removeRecentlyOpened(paths: URI[]): Promise<void> {\n\t\tconst recentlyOpened = await this.getRecentlyOpened();\n\n\t\tthis.doRemoveRecentlyOpened(recentlyOpened, paths);\n\n\t\treturn this.saveRecentlyOpened(recentlyOpened);\n\t}\n\n\tprivate doRemoveRecentlyOpened(recentlyOpened: IRecentlyOpened, paths: URI[]): void {\n\t\trecentlyOpened.files = recentlyOpened.files.filter(file => {\n\t\t\treturn !paths.some(path => path.toString() === file.fileUri.toString());\n\t\t});\n\n\t\trecentlyOpened.workspaces = recentlyOpened.workspaces.filter(workspace => {\n\t\t\treturn !paths.some(path => path.toString() === (isRecentFolder(workspace) ? workspace.folderUri.toString() : workspace.workspace.configPath.toString()));\n\t\t});\n\t}\n\n\tprivate async saveRecentlyOpened(data: IRecentlyOpened): Promise<void> {\n\t\treturn this.storageService.store(BrowserWorkspacesService.RECENTLY_OPENED_KEY, JSON.stringify(toStoreData(data)), StorageScope.APPLICATION, StorageTarget.USER);\n\t}\n\n\tasync clearRecentlyOpened(): Promise<void> {\n\t\tthis.storageService.remove(BrowserWorkspacesService.RECENTLY_OPENED_KEY, StorageScope.APPLICATION);\n\t}\n\n\t//#endregion\n\n\t//#region Workspace Management\n\n\tasync enterWorkspace(workspaceUri: URI): Promise<IEnterWorkspaceResult | undefined> {\n\t\treturn { workspace: await this.getWorkspaceIdentifier(workspaceUri) };\n\t}\n\n\tasync createUntitledWorkspace(folders?: IWorkspaceFolderCreationData[], remoteAuthority?: string): Promise<IWorkspaceIdentifier> {\n\t\tconst randomId = (Date.now() + Math.round(Math.random() * 1000)).toString();\n\t\tconst newUntitledWorkspacePath = joinPath(this.environmentService.untitledWorkspacesHome, `Untitled-${randomId}.${WORKSPACE_EXTENSION}`);\n\n\t\t// Build array of workspace folders to store\n\t\tconst storedWorkspaceFolder: IStoredWorkspaceFolder[] = [];\n\t\tif (folders) {\n\t\t\tfor (const folder of folders) {\n\t\t\t\tstoredWorkspaceFolder.push(getStoredWorkspaceFolder(folder.uri, true, folder.name, this.environmentService.untitledWorkspacesHome, this.uriIdentityService.extUri));\n\t\t\t}\n\t\t}\n\n\t\t// Store at untitled workspaces location\n\t\tconst storedWorkspace: IStoredWorkspace = { folders: storedWorkspaceFolder, remoteAuthority };\n\t\tawait this.fileService.writeFile(newUntitledWorkspacePath, VSBuffer.fromString(JSON.stringify(storedWorkspace, null, '\\t')));\n\n\t\treturn this.getWorkspaceIdentifier(newUntitledWorkspacePath);\n\t}\n\n\tasync deleteUntitledWorkspace(workspace: IWorkspaceIdentifier): Promise<void> {\n\t\ttry {\n\t\t\tawait this.fileService.del(workspace.configPath);\n\t\t} catch (error) {\n\t\t\tif ((<FileOperationError>error).fileOperationResult !== FileOperationResult.FILE_NOT_FOUND) {\n\t\t\t\tthrow error; // re-throw any other error than file not found which is OK\n\t\t\t}\n\t\t}\n\t}\n\n\tasync getWorkspaceIdentifier(workspaceUri: URI): Promise<IWorkspaceIdentifier> {\n\t\treturn getWorkspaceIdentifier(workspaceUri);\n\t}\n\n\t//#endregion\n\n\n\t//#region Dirty Workspaces\n\n\tasync getDirtyWorkspaces(): Promise<Array<IWorkspaceBackupInfo | IFolderBackupInfo>> {\n\t\treturn []; // Currently not supported in web\n\t}\n\n\t//#endregion\n}\n\nregisterSingleton(IWorkspacesService, BrowserWorkspacesService, InstantiationType.Delayed);\n"]}