{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/services/workspaces/common/workspaceIdentityService.ts","vs/workbench/services/workspaces/common/workspaceIdentityService.ts"],"names":[],"mappings":"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","file":"workspaceIdentityService.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { VSBuffer } from '../../../../base/common/buffer.js';\nimport { CancellationToken } from '../../../../base/common/cancellation.js';\nimport { isEqualOrParent, joinPath, relativePath } from '../../../../base/common/resources.js';\nimport { URI } from '../../../../base/common/uri.js';\nimport { InstantiationType, registerSingleton } from '../../../../platform/instantiation/common/extensions.js';\nimport { createDecorator } from '../../../../platform/instantiation/common/instantiation.js';\nimport { IWorkspaceStateFolder } from '../../../../platform/userDataSync/common/userDataSync.js';\nimport { EditSessionIdentityMatch, IEditSessionIdentityService } from '../../../../platform/workspace/common/editSessions.js';\nimport { IWorkspaceContextService, IWorkspaceFolder } from '../../../../platform/workspace/common/workspace.js';\n\nexport const IWorkspaceIdentityService = createDecorator<IWorkspaceIdentityService>('IWorkspaceIdentityService');\nexport interface IWorkspaceIdentityService {\n\t_serviceBrand: undefined;\n\tmatches(folders: IWorkspaceStateFolder[], cancellationToken: CancellationToken): Promise<((obj: unknown) => unknown) | false>;\n\tgetWorkspaceStateFolders(cancellationToken: CancellationToken): Promise<IWorkspaceStateFolder[]>;\n}\n\nexport class WorkspaceIdentityService implements IWorkspaceIdentityService {\n\tdeclare _serviceBrand: undefined;\n\n\tconstructor(\n\t\t@IWorkspaceContextService private readonly workspaceContextService: IWorkspaceContextService,\n\t\t@IEditSessionIdentityService private readonly editSessionIdentityService: IEditSessionIdentityService\n\t) { }\n\n\tasync getWorkspaceStateFolders(cancellationToken: CancellationToken): Promise<IWorkspaceStateFolder[]> {\n\t\tconst workspaceStateFolders: IWorkspaceStateFolder[] = [];\n\n\t\tfor (const workspaceFolder of this.workspaceContextService.getWorkspace().folders) {\n\t\t\tconst workspaceFolderIdentity = await this.editSessionIdentityService.getEditSessionIdentifier(workspaceFolder, cancellationToken);\n\t\t\tif (!workspaceFolderIdentity) { continue; }\n\t\t\tworkspaceStateFolders.push({ resourceUri: workspaceFolder.uri.toString(), workspaceFolderIdentity });\n\t\t}\n\n\t\treturn workspaceStateFolders;\n\t}\n\n\tasync matches(incomingWorkspaceFolders: IWorkspaceStateFolder[], cancellationToken: CancellationToken): Promise<((value: unknown) => unknown) | false> {\n\t\tconst incomingToCurrentWorkspaceFolderUris: { [key: string]: string } = {};\n\n\t\tconst incomingIdentitiesToIncomingWorkspaceFolders: { [key: string]: string } = {};\n\t\tfor (const workspaceFolder of incomingWorkspaceFolders) {\n\t\t\tincomingIdentitiesToIncomingWorkspaceFolders[workspaceFolder.workspaceFolderIdentity] = workspaceFolder.resourceUri;\n\t\t}\n\n\t\t// Precompute the identities of the current workspace folders\n\t\tconst currentWorkspaceFoldersToIdentities = new Map<IWorkspaceFolder, string>();\n\t\tfor (const workspaceFolder of this.workspaceContextService.getWorkspace().folders) {\n\t\t\tconst workspaceFolderIdentity = await this.editSessionIdentityService.getEditSessionIdentifier(workspaceFolder, cancellationToken);\n\t\t\tif (!workspaceFolderIdentity) { continue; }\n\t\t\tcurrentWorkspaceFoldersToIdentities.set(workspaceFolder, workspaceFolderIdentity);\n\t\t}\n\n\t\t// Match the current workspace folders to the incoming workspace folders\n\t\tfor (const [currentWorkspaceFolder, currentWorkspaceFolderIdentity] of currentWorkspaceFoldersToIdentities.entries()) {\n\n\t\t\t// Happy case: identities do not need further disambiguation\n\t\t\tconst incomingWorkspaceFolder = incomingIdentitiesToIncomingWorkspaceFolders[currentWorkspaceFolderIdentity];\n\t\t\tif (incomingWorkspaceFolder) {\n\t\t\t\t// There is an incoming workspace folder with the exact same identity as the current workspace folder\n\t\t\t\tincomingToCurrentWorkspaceFolderUris[incomingWorkspaceFolder] = currentWorkspaceFolder.uri.toString();\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t// Unhappy case: compare the identity of the current workspace folder to all incoming workspace folder identities\n\t\t\tlet hasCompleteMatch = false;\n\t\t\tfor (const [incomingIdentity, incomingFolder] of Object.entries(incomingIdentitiesToIncomingWorkspaceFolders)) {\n\t\t\t\tif (await this.editSessionIdentityService.provideEditSessionIdentityMatch(currentWorkspaceFolder, currentWorkspaceFolderIdentity, incomingIdentity, cancellationToken) === EditSessionIdentityMatch.Complete) {\n\t\t\t\t\tincomingToCurrentWorkspaceFolderUris[incomingFolder] = currentWorkspaceFolder.uri.toString();\n\t\t\t\t\thasCompleteMatch = true;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (hasCompleteMatch) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\treturn false;\n\t\t}\n\n\t\tconst convertUri = (uriToConvert: URI) => {\n\t\t\t// Figure out which current folder the incoming URI is a child of\n\t\t\tfor (const incomingFolderUriKey of Object.keys(incomingToCurrentWorkspaceFolderUris)) {\n\t\t\t\tconst incomingFolderUri = URI.parse(incomingFolderUriKey);\n\t\t\t\tif (isEqualOrParent(incomingFolderUri, uriToConvert)) {\n\t\t\t\t\tconst currentWorkspaceFolderUri = incomingToCurrentWorkspaceFolderUris[incomingFolderUriKey];\n\n\t\t\t\t\t// Compute the relative file path section of the uri to convert relative to the folder it came from\n\t\t\t\t\tconst relativeFilePath = relativePath(incomingFolderUri, uriToConvert);\n\n\t\t\t\t\t// Reparent the relative file path under the current workspace folder it belongs to\n\t\t\t\t\tif (relativeFilePath) {\n\t\t\t\t\t\treturn joinPath(URI.parse(currentWorkspaceFolderUri), relativeFilePath);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// No conversion was possible; return the original URI\n\t\t\treturn uriToConvert;\n\t\t};\n\n\t\t// Recursively look for any URIs in the provided object and\n\t\t// replace them with the URIs of the current workspace folders\n\t\tconst uriReplacer = (obj: unknown, depth = 0) => {\n\t\t\tif (!obj || depth > 200) {\n\t\t\t\treturn obj;\n\t\t\t}\n\n\t\t\tif (obj instanceof VSBuffer || obj instanceof Uint8Array) {\n\t\t\t\treturn obj;\n\t\t\t}\n\n\t\t\tif (URI.isUri(obj)) {\n\t\t\t\treturn convertUri(obj);\n\t\t\t}\n\n\t\t\tif (Array.isArray(obj)) {\n\t\t\t\tfor (let i = 0; i < obj.length; ++i) {\n\t\t\t\t\tobj[i] = uriReplacer(obj[i], depth + 1);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// walk object\n\t\t\t\tfor (const key in obj) {\n\t\t\t\t\tif (Object.hasOwnProperty.call(obj, key)) {\n\t\t\t\t\t\t(obj as Record<string, unknown>)[key] = uriReplacer((obj as Record<string, unknown>)[key], depth + 1);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn obj;\n\t\t};\n\n\t\treturn uriReplacer;\n\t}\n}\n\nregisterSingleton(IWorkspaceIdentityService, WorkspaceIdentityService, InstantiationType.Delayed);\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { VSBuffer } from '../../../../base/common/buffer.js';\nimport { CancellationToken } from '../../../../base/common/cancellation.js';\nimport { isEqualOrParent, joinPath, relativePath } from '../../../../base/common/resources.js';\nimport { URI } from '../../../../base/common/uri.js';\nimport { InstantiationType, registerSingleton } from '../../../../platform/instantiation/common/extensions.js';\nimport { createDecorator } from '../../../../platform/instantiation/common/instantiation.js';\nimport { IWorkspaceStateFolder } from '../../../../platform/userDataSync/common/userDataSync.js';\nimport { EditSessionIdentityMatch, IEditSessionIdentityService } from '../../../../platform/workspace/common/editSessions.js';\nimport { IWorkspaceContextService, IWorkspaceFolder } from '../../../../platform/workspace/common/workspace.js';\n\nexport const IWorkspaceIdentityService = createDecorator<IWorkspaceIdentityService>('IWorkspaceIdentityService');\nexport interface IWorkspaceIdentityService {\n\t_serviceBrand: undefined;\n\tmatches(folders: IWorkspaceStateFolder[], cancellationToken: CancellationToken): Promise<((obj: unknown) => unknown) | false>;\n\tgetWorkspaceStateFolders(cancellationToken: CancellationToken): Promise<IWorkspaceStateFolder[]>;\n}\n\nexport class WorkspaceIdentityService implements IWorkspaceIdentityService {\n\tdeclare _serviceBrand: undefined;\n\n\tconstructor(\n\t\t@IWorkspaceContextService private readonly workspaceContextService: IWorkspaceContextService,\n\t\t@IEditSessionIdentityService private readonly editSessionIdentityService: IEditSessionIdentityService\n\t) { }\n\n\tasync getWorkspaceStateFolders(cancellationToken: CancellationToken): Promise<IWorkspaceStateFolder[]> {\n\t\tconst workspaceStateFolders: IWorkspaceStateFolder[] = [];\n\n\t\tfor (const workspaceFolder of this.workspaceContextService.getWorkspace().folders) {\n\t\t\tconst workspaceFolderIdentity = await this.editSessionIdentityService.getEditSessionIdentifier(workspaceFolder, cancellationToken);\n\t\t\tif (!workspaceFolderIdentity) { continue; }\n\t\t\tworkspaceStateFolders.push({ resourceUri: workspaceFolder.uri.toString(), workspaceFolderIdentity });\n\t\t}\n\n\t\treturn workspaceStateFolders;\n\t}\n\n\tasync matches(incomingWorkspaceFolders: IWorkspaceStateFolder[], cancellationToken: CancellationToken): Promise<((value: unknown) => unknown) | false> {\n\t\tconst incomingToCurrentWorkspaceFolderUris: { [key: string]: string } = {};\n\n\t\tconst incomingIdentitiesToIncomingWorkspaceFolders: { [key: string]: string } = {};\n\t\tfor (const workspaceFolder of incomingWorkspaceFolders) {\n\t\t\tincomingIdentitiesToIncomingWorkspaceFolders[workspaceFolder.workspaceFolderIdentity] = workspaceFolder.resourceUri;\n\t\t}\n\n\t\t// Precompute the identities of the current workspace folders\n\t\tconst currentWorkspaceFoldersToIdentities = new Map<IWorkspaceFolder, string>();\n\t\tfor (const workspaceFolder of this.workspaceContextService.getWorkspace().folders) {\n\t\t\tconst workspaceFolderIdentity = await this.editSessionIdentityService.getEditSessionIdentifier(workspaceFolder, cancellationToken);\n\t\t\tif (!workspaceFolderIdentity) { continue; }\n\t\t\tcurrentWorkspaceFoldersToIdentities.set(workspaceFolder, workspaceFolderIdentity);\n\t\t}\n\n\t\t// Match the current workspace folders to the incoming workspace folders\n\t\tfor (const [currentWorkspaceFolder, currentWorkspaceFolderIdentity] of currentWorkspaceFoldersToIdentities.entries()) {\n\n\t\t\t// Happy case: identities do not need further disambiguation\n\t\t\tconst incomingWorkspaceFolder = incomingIdentitiesToIncomingWorkspaceFolders[currentWorkspaceFolderIdentity];\n\t\t\tif (incomingWorkspaceFolder) {\n\t\t\t\t// There is an incoming workspace folder with the exact same identity as the current workspace folder\n\t\t\t\tincomingToCurrentWorkspaceFolderUris[incomingWorkspaceFolder] = currentWorkspaceFolder.uri.toString();\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t// Unhappy case: compare the identity of the current workspace folder to all incoming workspace folder identities\n\t\t\tlet hasCompleteMatch = false;\n\t\t\tfor (const [incomingIdentity, incomingFolder] of Object.entries(incomingIdentitiesToIncomingWorkspaceFolders)) {\n\t\t\t\tif (await this.editSessionIdentityService.provideEditSessionIdentityMatch(currentWorkspaceFolder, currentWorkspaceFolderIdentity, incomingIdentity, cancellationToken) === EditSessionIdentityMatch.Complete) {\n\t\t\t\t\tincomingToCurrentWorkspaceFolderUris[incomingFolder] = currentWorkspaceFolder.uri.toString();\n\t\t\t\t\thasCompleteMatch = true;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (hasCompleteMatch) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\treturn false;\n\t\t}\n\n\t\tconst convertUri = (uriToConvert: URI) => {\n\t\t\t// Figure out which current folder the incoming URI is a child of\n\t\t\tfor (const incomingFolderUriKey of Object.keys(incomingToCurrentWorkspaceFolderUris)) {\n\t\t\t\tconst incomingFolderUri = URI.parse(incomingFolderUriKey);\n\t\t\t\tif (isEqualOrParent(incomingFolderUri, uriToConvert)) {\n\t\t\t\t\tconst currentWorkspaceFolderUri = incomingToCurrentWorkspaceFolderUris[incomingFolderUriKey];\n\n\t\t\t\t\t// Compute the relative file path section of the uri to convert relative to the folder it came from\n\t\t\t\t\tconst relativeFilePath = relativePath(incomingFolderUri, uriToConvert);\n\n\t\t\t\t\t// Reparent the relative file path under the current workspace folder it belongs to\n\t\t\t\t\tif (relativeFilePath) {\n\t\t\t\t\t\treturn joinPath(URI.parse(currentWorkspaceFolderUri), relativeFilePath);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// No conversion was possible; return the original URI\n\t\t\treturn uriToConvert;\n\t\t};\n\n\t\t// Recursively look for any URIs in the provided object and\n\t\t// replace them with the URIs of the current workspace folders\n\t\tconst uriReplacer = (obj: unknown, depth = 0) => {\n\t\t\tif (!obj || depth > 200) {\n\t\t\t\treturn obj;\n\t\t\t}\n\n\t\t\tif (obj instanceof VSBuffer || obj instanceof Uint8Array) {\n\t\t\t\treturn obj;\n\t\t\t}\n\n\t\t\tif (URI.isUri(obj)) {\n\t\t\t\treturn convertUri(obj);\n\t\t\t}\n\n\t\t\tif (Array.isArray(obj)) {\n\t\t\t\tfor (let i = 0; i < obj.length; ++i) {\n\t\t\t\t\tobj[i] = uriReplacer(obj[i], depth + 1);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// walk object\n\t\t\t\tfor (const key in obj) {\n\t\t\t\t\tif (Object.hasOwnProperty.call(obj, key)) {\n\t\t\t\t\t\t(obj as Record<string, unknown>)[key] = uriReplacer((obj as Record<string, unknown>)[key], depth + 1);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn obj;\n\t\t};\n\n\t\treturn uriReplacer;\n\t}\n}\n\nregisterSingleton(IWorkspaceIdentityService, WorkspaceIdentityService, InstantiationType.Delayed);\n"]}