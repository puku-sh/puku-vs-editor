{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/services/workspaces/common/workspaceTrust.ts","vs/workbench/services/workspaces/common/workspaceTrust.ts"],"names":[],"mappings":"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","file":"workspaceTrust.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Emitter, Event } from '../../../../base/common/event.js';\nimport { Disposable, IDisposable, toDisposable } from '../../../../base/common/lifecycle.js';\nimport { LinkedList } from '../../../../base/common/linkedList.js';\nimport { Schemas } from '../../../../base/common/network.js';\nimport { URI } from '../../../../base/common/uri.js';\nimport { IPath } from '../../../../platform/window/common/window.js';\nimport { IConfigurationService } from '../../../../platform/configuration/common/configuration.js';\nimport { InstantiationType, registerSingleton } from '../../../../platform/instantiation/common/extensions.js';\nimport { IRemoteAuthorityResolverService, ResolverResult } from '../../../../platform/remote/common/remoteAuthorityResolver.js';\nimport { getRemoteAuthority } from '../../../../platform/remote/common/remoteHosts.js';\nimport { isVirtualResource } from '../../../../platform/workspace/common/virtualWorkspace.js';\nimport { IStorageService, StorageScope, StorageTarget } from '../../../../platform/storage/common/storage.js';\nimport { ISingleFolderWorkspaceIdentifier, isSavedWorkspace, isSingleFolderWorkspaceIdentifier, isTemporaryWorkspace, IWorkspace, IWorkspaceContextService, IWorkspaceFolder, toWorkspaceIdentifier, WorkbenchState } from '../../../../platform/workspace/common/workspace.js';\nimport { WorkspaceTrustRequestOptions, IWorkspaceTrustManagementService, IWorkspaceTrustInfo, IWorkspaceTrustUriInfo, IWorkspaceTrustRequestService, IWorkspaceTrustTransitionParticipant, WorkspaceTrustUriResponse, IWorkspaceTrustEnablementService } from '../../../../platform/workspace/common/workspaceTrust.js';\nimport { Memento } from '../../../common/memento.js';\nimport { IWorkbenchEnvironmentService } from '../../environment/common/environmentService.js';\nimport { IUriIdentityService } from '../../../../platform/uriIdentity/common/uriIdentity.js';\nimport { isEqualAuthority } from '../../../../base/common/resources.js';\nimport { isWeb } from '../../../../base/common/platform.js';\nimport { IFileService } from '../../../../platform/files/common/files.js';\nimport { promiseWithResolvers } from '../../../../base/common/async.js';\n\nexport const WORKSPACE_TRUST_ENABLED = 'security.workspace.trust.enabled';\nexport const WORKSPACE_TRUST_STARTUP_PROMPT = 'security.workspace.trust.startupPrompt';\nexport const WORKSPACE_TRUST_BANNER = 'security.workspace.trust.banner';\nexport const WORKSPACE_TRUST_UNTRUSTED_FILES = 'security.workspace.trust.untrustedFiles';\nexport const WORKSPACE_TRUST_EMPTY_WINDOW = 'security.workspace.trust.emptyWindow';\nexport const WORKSPACE_TRUST_EXTENSION_SUPPORT = 'extensions.supportUntrustedWorkspaces';\nexport const WORKSPACE_TRUST_STORAGE_KEY = 'content.trust.model.key';\n\nexport class CanonicalWorkspace implements IWorkspace {\n\tconstructor(\n\t\tprivate readonly originalWorkspace: IWorkspace,\n\t\tprivate readonly canonicalFolderUris: URI[],\n\t\tprivate readonly canonicalConfiguration: URI | null | undefined\n\t) { }\n\n\n\tget folders(): IWorkspaceFolder[] {\n\t\treturn this.originalWorkspace.folders.map((folder, index) => {\n\t\t\treturn {\n\t\t\t\tindex: folder.index,\n\t\t\t\tname: folder.name,\n\t\t\t\ttoResource: folder.toResource,\n\t\t\t\turi: this.canonicalFolderUris[index]\n\t\t\t};\n\t\t});\n\t}\n\n\tget transient(): boolean | undefined {\n\t\treturn this.originalWorkspace.transient;\n\t}\n\n\tget configuration(): URI | null | undefined {\n\t\treturn this.canonicalConfiguration ?? this.originalWorkspace.configuration;\n\t}\n\n\tget id(): string {\n\t\treturn this.originalWorkspace.id;\n\t}\n}\n\nexport class WorkspaceTrustEnablementService extends Disposable implements IWorkspaceTrustEnablementService {\n\n\t_serviceBrand: undefined;\n\n\tconstructor(\n\t\t@IConfigurationService private readonly configurationService: IConfigurationService,\n\t\t@IWorkbenchEnvironmentService private readonly environmentService: IWorkbenchEnvironmentService\n\t) {\n\t\tsuper();\n\t}\n\n\tisWorkspaceTrustEnabled(): boolean {\n\t\tif (this.environmentService.disableWorkspaceTrust) {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn !!this.configurationService.getValue(WORKSPACE_TRUST_ENABLED);\n\t}\n}\n\nexport class WorkspaceTrustManagementService extends Disposable implements IWorkspaceTrustManagementService {\n\n\t_serviceBrand: undefined;\n\n\tprivate readonly storageKey = WORKSPACE_TRUST_STORAGE_KEY;\n\n\tprivate readonly _workspaceResolvedPromise: Promise<void>;\n\tprivate readonly _workspaceResolvedPromiseResolve: () => void;\n\tprivate readonly _workspaceTrustInitializedPromise: Promise<void>;\n\tprivate readonly _workspaceTrustInitializedPromiseResolve: () => void;\n\n\tprivate readonly _onDidChangeTrust = this._register(new Emitter<boolean>());\n\treadonly onDidChangeTrust = this._onDidChangeTrust.event;\n\n\tprivate readonly _onDidChangeTrustedFolders = this._register(new Emitter<void>());\n\treadonly onDidChangeTrustedFolders = this._onDidChangeTrustedFolders.event;\n\n\tprivate _canonicalStartupFiles: URI[] = [];\n\tprivate _canonicalWorkspace: IWorkspace;\n\tprivate _canonicalUrisResolved: boolean;\n\n\tprivate _isTrusted: boolean;\n\tprivate _trustStateInfo: IWorkspaceTrustInfo;\n\tprivate _remoteAuthority: ResolverResult | undefined;\n\n\tprivate readonly _storedTrustState: WorkspaceTrustMemento;\n\tprivate readonly _trustTransitionManager: WorkspaceTrustTransitionManager;\n\n\tconstructor(\n\t\t@IConfigurationService private readonly configurationService: IConfigurationService,\n\t\t@IRemoteAuthorityResolverService private readonly remoteAuthorityResolverService: IRemoteAuthorityResolverService,\n\t\t@IStorageService private readonly storageService: IStorageService,\n\t\t@IUriIdentityService private readonly uriIdentityService: IUriIdentityService,\n\t\t@IWorkbenchEnvironmentService private readonly environmentService: IWorkbenchEnvironmentService,\n\t\t@IWorkspaceContextService private readonly workspaceService: IWorkspaceContextService,\n\t\t@IWorkspaceTrustEnablementService private readonly workspaceTrustEnablementService: IWorkspaceTrustEnablementService,\n\t\t@IFileService private readonly fileService: IFileService\n\t) {\n\t\tsuper();\n\n\t\tthis._canonicalUrisResolved = false;\n\t\tthis._canonicalWorkspace = this.workspaceService.getWorkspace();\n\n\t\t({ promise: this._workspaceResolvedPromise, resolve: this._workspaceResolvedPromiseResolve } = promiseWithResolvers());\n\t\t({ promise: this._workspaceTrustInitializedPromise, resolve: this._workspaceTrustInitializedPromiseResolve } = promiseWithResolvers());\n\n\t\tthis._storedTrustState = new WorkspaceTrustMemento(isWeb && this.isEmptyWorkspace() ? undefined : this.storageService);\n\t\tthis._trustTransitionManager = this._register(new WorkspaceTrustTransitionManager());\n\n\t\tthis._trustStateInfo = this.loadTrustInfo();\n\t\tthis._isTrusted = this.calculateWorkspaceTrust();\n\n\t\tthis.initializeWorkspaceTrust();\n\t\tthis.registerListeners();\n\t}\n\n\t//#region initialize\n\n\tprivate initializeWorkspaceTrust(): void {\n\t\t// Resolve canonical Uris\n\t\tthis.resolveCanonicalUris()\n\t\t\t.then(async () => {\n\t\t\t\tthis._canonicalUrisResolved = true;\n\t\t\t\tawait this.updateWorkspaceTrust();\n\t\t\t})\n\t\t\t.finally(() => {\n\t\t\t\tthis._workspaceResolvedPromiseResolve();\n\n\t\t\t\tif (!this.environmentService.remoteAuthority) {\n\t\t\t\t\tthis._workspaceTrustInitializedPromiseResolve();\n\t\t\t\t}\n\t\t\t});\n\n\t\t// Remote - resolve remote authority\n\t\tif (this.environmentService.remoteAuthority) {\n\t\t\tthis.remoteAuthorityResolverService.resolveAuthority(this.environmentService.remoteAuthority)\n\t\t\t\t.then(async result => {\n\t\t\t\t\tthis._remoteAuthority = result;\n\t\t\t\t\tawait this.fileService.activateProvider(Schemas.vscodeRemote);\n\t\t\t\t\tawait this.updateWorkspaceTrust();\n\t\t\t\t})\n\t\t\t\t.finally(() => {\n\t\t\t\t\tthis._workspaceTrustInitializedPromiseResolve();\n\t\t\t\t});\n\t\t}\n\n\t\t// Empty workspace - save initial state to memento\n\t\tif (this.isEmptyWorkspace()) {\n\t\t\tthis._workspaceTrustInitializedPromise.then(() => {\n\t\t\t\tif (this._storedTrustState.isEmptyWorkspaceTrusted === undefined) {\n\t\t\t\t\tthis._storedTrustState.isEmptyWorkspaceTrusted = this.isWorkspaceTrusted();\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\t//#endregion\n\n\t//#region private interface\n\n\tprivate registerListeners(): void {\n\t\tthis._register(this.workspaceService.onDidChangeWorkspaceFolders(async () => await this.updateWorkspaceTrust()));\n\t\tthis._register(this.storageService.onDidChangeValue(StorageScope.APPLICATION, this.storageKey, this._store)(async () => {\n\t\t\t/* This will only execute if storage was changed by a user action in a separate window */\n\t\t\tif (JSON.stringify(this._trustStateInfo) !== JSON.stringify(this.loadTrustInfo())) {\n\t\t\t\tthis._trustStateInfo = this.loadTrustInfo();\n\t\t\t\tthis._onDidChangeTrustedFolders.fire();\n\n\t\t\t\tawait this.updateWorkspaceTrust();\n\t\t\t}\n\t\t}));\n\t}\n\n\tprivate async getCanonicalUri(uri: URI): Promise<URI> {\n\t\tlet canonicalUri = uri;\n\t\tif (this.environmentService.remoteAuthority && uri.scheme === Schemas.vscodeRemote) {\n\t\t\tcanonicalUri = await this.remoteAuthorityResolverService.getCanonicalURI(uri);\n\t\t} else if (uri.scheme === 'vscode-vfs') {\n\t\t\tconst index = uri.authority.indexOf('+');\n\t\t\tif (index !== -1) {\n\t\t\t\tcanonicalUri = uri.with({ authority: uri.authority.substr(0, index) });\n\t\t\t}\n\t\t}\n\n\t\t// ignore query and fragent section of uris always\n\t\treturn canonicalUri.with({ query: null, fragment: null });\n\t}\n\n\tprivate async resolveCanonicalUris(): Promise<void> {\n\t\t// Open editors\n\t\tconst filesToOpen: IPath[] = [];\n\t\tif (this.environmentService.filesToOpenOrCreate) {\n\t\t\tfilesToOpen.push(...this.environmentService.filesToOpenOrCreate);\n\t\t}\n\n\t\tif (this.environmentService.filesToDiff) {\n\t\t\tfilesToOpen.push(...this.environmentService.filesToDiff);\n\t\t}\n\n\t\tif (this.environmentService.filesToMerge) {\n\t\t\tfilesToOpen.push(...this.environmentService.filesToMerge);\n\t\t}\n\n\t\tif (filesToOpen.length) {\n\t\t\tconst filesToOpenOrCreateUris = filesToOpen.filter(f => !!f.fileUri).map(f => f.fileUri!);\n\t\t\tconst canonicalFilesToOpen = await Promise.all(filesToOpenOrCreateUris.map(uri => this.getCanonicalUri(uri)));\n\n\t\t\tthis._canonicalStartupFiles.push(...canonicalFilesToOpen.filter(uri => this._canonicalStartupFiles.every(u => !this.uriIdentityService.extUri.isEqual(uri, u))));\n\t\t}\n\n\t\t// Workspace\n\t\tconst workspaceUris = this.workspaceService.getWorkspace().folders.map(f => f.uri);\n\t\tconst canonicalWorkspaceFolders = await Promise.all(workspaceUris.map(uri => this.getCanonicalUri(uri)));\n\n\t\tlet canonicalWorkspaceConfiguration = this.workspaceService.getWorkspace().configuration;\n\t\tif (canonicalWorkspaceConfiguration && isSavedWorkspace(canonicalWorkspaceConfiguration, this.environmentService)) {\n\t\t\tcanonicalWorkspaceConfiguration = await this.getCanonicalUri(canonicalWorkspaceConfiguration);\n\t\t}\n\n\t\tthis._canonicalWorkspace = new CanonicalWorkspace(this.workspaceService.getWorkspace(), canonicalWorkspaceFolders, canonicalWorkspaceConfiguration);\n\t}\n\n\tprivate loadTrustInfo(): IWorkspaceTrustInfo {\n\t\tconst infoAsString = this.storageService.get(this.storageKey, StorageScope.APPLICATION);\n\n\t\tlet result: IWorkspaceTrustInfo | undefined;\n\t\ttry {\n\t\t\tif (infoAsString) {\n\t\t\t\tresult = JSON.parse(infoAsString);\n\t\t\t}\n\t\t} catch { }\n\n\t\tif (!result) {\n\t\t\tresult = {\n\t\t\t\turiTrustInfo: []\n\t\t\t};\n\t\t}\n\n\t\tif (!result.uriTrustInfo) {\n\t\t\tresult.uriTrustInfo = [];\n\t\t}\n\n\t\tresult.uriTrustInfo = result.uriTrustInfo.map(info => { return { uri: URI.revive(info.uri), trusted: info.trusted }; });\n\t\tresult.uriTrustInfo = result.uriTrustInfo.filter(info => info.trusted);\n\n\t\treturn result;\n\t}\n\n\tprivate async saveTrustInfo(): Promise<void> {\n\t\tthis.storageService.store(this.storageKey, JSON.stringify(this._trustStateInfo), StorageScope.APPLICATION, StorageTarget.MACHINE);\n\t\tthis._onDidChangeTrustedFolders.fire();\n\n\t\tawait this.updateWorkspaceTrust();\n\t}\n\n\tprivate getWorkspaceUris(): URI[] {\n\t\tconst workspaceUris = this._canonicalWorkspace.folders.map(f => f.uri);\n\t\tconst workspaceConfiguration = this._canonicalWorkspace.configuration;\n\t\tif (workspaceConfiguration && isSavedWorkspace(workspaceConfiguration, this.environmentService)) {\n\t\t\tworkspaceUris.push(workspaceConfiguration);\n\t\t}\n\n\t\treturn workspaceUris;\n\t}\n\n\tprivate calculateWorkspaceTrust(): boolean {\n\t\t// Feature is disabled\n\t\tif (!this.workspaceTrustEnablementService.isWorkspaceTrustEnabled()) {\n\t\t\treturn true;\n\t\t}\n\n\t\t// Canonical Uris not yet resolved\n\t\tif (!this._canonicalUrisResolved) {\n\t\t\treturn false;\n\t\t}\n\n\t\t// Remote - resolver explicitly sets workspace trust to TRUE\n\t\tif (this.environmentService.remoteAuthority && this._remoteAuthority?.options?.isTrusted) {\n\t\t\treturn this._remoteAuthority.options.isTrusted;\n\t\t}\n\n\t\t// Empty workspace - use memento, open ediors, or user setting\n\t\tif (this.isEmptyWorkspace()) {\n\t\t\t// Use memento if present\n\t\t\tif (this._storedTrustState.isEmptyWorkspaceTrusted !== undefined) {\n\t\t\t\treturn this._storedTrustState.isEmptyWorkspaceTrusted;\n\t\t\t}\n\n\t\t\t// Startup files\n\t\t\tif (this._canonicalStartupFiles.length) {\n\t\t\t\treturn this.getUrisTrust(this._canonicalStartupFiles);\n\t\t\t}\n\n\t\t\t// User setting\n\t\t\treturn !!this.configurationService.getValue(WORKSPACE_TRUST_EMPTY_WINDOW);\n\t\t}\n\n\t\treturn this.getUrisTrust(this.getWorkspaceUris());\n\t}\n\n\tprivate async updateWorkspaceTrust(trusted?: boolean): Promise<void> {\n\t\tif (!this.workspaceTrustEnablementService.isWorkspaceTrustEnabled()) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (trusted === undefined) {\n\t\t\tawait this.resolveCanonicalUris();\n\t\t\ttrusted = this.calculateWorkspaceTrust();\n\t\t}\n\n\t\tif (this.isWorkspaceTrusted() === trusted) { return; }\n\n\t\t// Update workspace trust\n\t\tthis.isTrusted = trusted;\n\n\t\t// Run workspace trust transition participants\n\t\tawait this._trustTransitionManager.participate(trusted);\n\n\t\t// Fire workspace trust change event\n\t\tthis._onDidChangeTrust.fire(trusted);\n\t}\n\n\tprivate getUrisTrust(uris: URI[]): boolean {\n\t\tlet state = true;\n\t\tfor (const uri of uris) {\n\t\t\tconst { trusted } = this.doGetUriTrustInfo(uri);\n\n\t\t\tif (!trusted) {\n\t\t\t\tstate = trusted;\n\t\t\t\treturn state;\n\t\t\t}\n\t\t}\n\n\t\treturn state;\n\t}\n\n\tprivate doGetUriTrustInfo(uri: URI): IWorkspaceTrustUriInfo {\n\t\t// Return trusted when workspace trust is disabled\n\t\tif (!this.workspaceTrustEnablementService.isWorkspaceTrustEnabled()) {\n\t\t\treturn { trusted: true, uri };\n\t\t}\n\n\t\tif (this.isTrustedVirtualResource(uri)) {\n\t\t\treturn { trusted: true, uri };\n\t\t}\n\n\t\tif (this.isTrustedByRemote(uri)) {\n\t\t\treturn { trusted: true, uri };\n\t\t}\n\n\t\tlet resultState = false;\n\t\tlet maxLength = -1;\n\n\t\tlet resultUri = uri;\n\n\t\tfor (const trustInfo of this._trustStateInfo.uriTrustInfo) {\n\t\t\tif (this.uriIdentityService.extUri.isEqualOrParent(uri, trustInfo.uri)) {\n\t\t\t\tconst fsPath = trustInfo.uri.fsPath;\n\t\t\t\tif (fsPath.length > maxLength) {\n\t\t\t\t\tmaxLength = fsPath.length;\n\t\t\t\t\tresultState = trustInfo.trusted;\n\t\t\t\t\tresultUri = trustInfo.uri;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn { trusted: resultState, uri: resultUri };\n\t}\n\n\tprivate async doSetUrisTrust(uris: URI[], trusted: boolean): Promise<void> {\n\t\tlet changed = false;\n\n\t\tfor (const uri of uris) {\n\t\t\tif (trusted) {\n\t\t\t\tif (this.isTrustedVirtualResource(uri)) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tif (this.isTrustedByRemote(uri)) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tconst foundItem = this._trustStateInfo.uriTrustInfo.find(trustInfo => this.uriIdentityService.extUri.isEqual(trustInfo.uri, uri));\n\t\t\t\tif (!foundItem) {\n\t\t\t\t\tthis._trustStateInfo.uriTrustInfo.push({ uri, trusted: true });\n\t\t\t\t\tchanged = true;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tconst previousLength = this._trustStateInfo.uriTrustInfo.length;\n\t\t\t\tthis._trustStateInfo.uriTrustInfo = this._trustStateInfo.uriTrustInfo.filter(trustInfo => !this.uriIdentityService.extUri.isEqual(trustInfo.uri, uri));\n\t\t\t\tif (previousLength !== this._trustStateInfo.uriTrustInfo.length) {\n\t\t\t\t\tchanged = true;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (changed) {\n\t\t\tawait this.saveTrustInfo();\n\t\t}\n\t}\n\n\tprivate isEmptyWorkspace(): boolean {\n\t\tif (this.workspaceService.getWorkbenchState() === WorkbenchState.EMPTY) {\n\t\t\treturn true;\n\t\t}\n\n\t\tconst workspace = this.workspaceService.getWorkspace();\n\t\tif (workspace) {\n\t\t\treturn isTemporaryWorkspace(this.workspaceService.getWorkspace()) && workspace.folders.length === 0;\n\t\t}\n\n\t\treturn false;\n\t}\n\n\tprivate isTrustedVirtualResource(uri: URI): boolean {\n\t\treturn isVirtualResource(uri) && uri.scheme !== 'vscode-vfs';\n\t}\n\n\tprivate isTrustedByRemote(uri: URI): boolean {\n\t\tif (!this.environmentService.remoteAuthority) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif (!this._remoteAuthority) {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn (isEqualAuthority(getRemoteAuthority(uri), this._remoteAuthority.authority.authority)) && !!this._remoteAuthority.options?.isTrusted;\n\t}\n\n\tprivate set isTrusted(value: boolean) {\n\t\tthis._isTrusted = value;\n\n\t\t// Reset acceptsOutOfWorkspaceFiles\n\t\tif (!value) {\n\t\t\tthis._storedTrustState.acceptsOutOfWorkspaceFiles = false;\n\t\t}\n\n\t\t// Empty workspace - save memento\n\t\tif (this.isEmptyWorkspace()) {\n\t\t\tthis._storedTrustState.isEmptyWorkspaceTrusted = value;\n\t\t}\n\t}\n\n\t//#endregion\n\n\t//#region public interface\n\n\tget workspaceResolved(): Promise<void> {\n\t\treturn this._workspaceResolvedPromise;\n\t}\n\n\tget workspaceTrustInitialized(): Promise<void> {\n\t\treturn this._workspaceTrustInitializedPromise;\n\t}\n\n\tget acceptsOutOfWorkspaceFiles(): boolean {\n\t\treturn this._storedTrustState.acceptsOutOfWorkspaceFiles;\n\t}\n\n\tset acceptsOutOfWorkspaceFiles(value: boolean) {\n\t\tthis._storedTrustState.acceptsOutOfWorkspaceFiles = value;\n\t}\n\n\tisWorkspaceTrusted(): boolean {\n\t\treturn this._isTrusted;\n\t}\n\n\tisWorkspaceTrustForced(): boolean {\n\t\t// Remote - remote authority explicitly sets workspace trust\n\t\tif (this.environmentService.remoteAuthority && this._remoteAuthority?.options?.isTrusted !== undefined) {\n\t\t\treturn true;\n\t\t}\n\n\t\t// All workspace uris are trusted automatically\n\t\tconst workspaceUris = this.getWorkspaceUris().filter(uri => !this.isTrustedVirtualResource(uri));\n\t\tif (workspaceUris.length === 0) {\n\t\t\treturn true;\n\t\t}\n\n\t\treturn false;\n\t}\n\n\tcanSetParentFolderTrust(): boolean {\n\t\tconst workspaceIdentifier = toWorkspaceIdentifier(this._canonicalWorkspace);\n\n\t\tif (!isSingleFolderWorkspaceIdentifier(workspaceIdentifier)) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif (workspaceIdentifier.uri.scheme !== Schemas.file && workspaceIdentifier.uri.scheme !== Schemas.vscodeRemote) {\n\t\t\treturn false;\n\t\t}\n\n\t\tconst parentFolder = this.uriIdentityService.extUri.dirname(workspaceIdentifier.uri);\n\t\tif (this.uriIdentityService.extUri.isEqual(workspaceIdentifier.uri, parentFolder)) {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t}\n\n\tasync setParentFolderTrust(trusted: boolean): Promise<void> {\n\t\tif (this.canSetParentFolderTrust()) {\n\t\t\tconst workspaceUri = (toWorkspaceIdentifier(this._canonicalWorkspace) as ISingleFolderWorkspaceIdentifier).uri;\n\t\t\tconst parentFolder = this.uriIdentityService.extUri.dirname(workspaceUri);\n\n\t\t\tawait this.setUrisTrust([parentFolder], trusted);\n\t\t}\n\t}\n\n\tcanSetWorkspaceTrust(): boolean {\n\t\t// Remote - remote authority not yet resolved, or remote authority explicitly sets workspace trust\n\t\tif (this.environmentService.remoteAuthority && (!this._remoteAuthority || this._remoteAuthority.options?.isTrusted !== undefined)) {\n\t\t\treturn false;\n\t\t}\n\n\t\t// Empty workspace\n\t\tif (this.isEmptyWorkspace()) {\n\t\t\treturn true;\n\t\t}\n\n\t\t// All workspace uris are trusted automatically\n\t\tconst workspaceUris = this.getWorkspaceUris().filter(uri => !this.isTrustedVirtualResource(uri));\n\t\tif (workspaceUris.length === 0) {\n\t\t\treturn false;\n\t\t}\n\n\t\t// Untrusted workspace\n\t\tif (!this.isWorkspaceTrusted()) {\n\t\t\treturn true;\n\t\t}\n\n\t\t// Trusted workspaces\n\t\t// Can only untrusted in the single folder scenario\n\t\tconst workspaceIdentifier = toWorkspaceIdentifier(this._canonicalWorkspace);\n\t\tif (!isSingleFolderWorkspaceIdentifier(workspaceIdentifier)) {\n\t\t\treturn false;\n\t\t}\n\n\t\t// Can only be untrusted in certain schemes\n\t\tif (workspaceIdentifier.uri.scheme !== Schemas.file && workspaceIdentifier.uri.scheme !== 'vscode-vfs') {\n\t\t\treturn false;\n\t\t}\n\n\t\t// If the current folder isn't trusted directly, return false\n\t\tconst trustInfo = this.doGetUriTrustInfo(workspaceIdentifier.uri);\n\t\tif (!trustInfo.trusted || !this.uriIdentityService.extUri.isEqual(workspaceIdentifier.uri, trustInfo.uri)) {\n\t\t\treturn false;\n\t\t}\n\n\t\t// Check if the parent is also trusted\n\t\tif (this.canSetParentFolderTrust()) {\n\t\t\tconst parentFolder = this.uriIdentityService.extUri.dirname(workspaceIdentifier.uri);\n\t\t\tconst parentPathTrustInfo = this.doGetUriTrustInfo(parentFolder);\n\t\t\tif (parentPathTrustInfo.trusted) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\n\t\treturn true;\n\t}\n\n\tasync setWorkspaceTrust(trusted: boolean): Promise<void> {\n\t\t// Empty workspace\n\t\tif (this.isEmptyWorkspace()) {\n\t\t\tawait this.updateWorkspaceTrust(trusted);\n\t\t\treturn;\n\t\t}\n\n\t\tconst workspaceFolders = this.getWorkspaceUris();\n\t\tawait this.setUrisTrust(workspaceFolders, trusted);\n\t}\n\n\tasync getUriTrustInfo(uri: URI): Promise<IWorkspaceTrustUriInfo> {\n\t\t// Return trusted when workspace trust is disabled\n\t\tif (!this.workspaceTrustEnablementService.isWorkspaceTrustEnabled()) {\n\t\t\treturn { trusted: true, uri };\n\t\t}\n\n\t\t// Uri is trusted automatically by the remote\n\t\tif (this.isTrustedByRemote(uri)) {\n\t\t\treturn { trusted: true, uri };\n\t\t}\n\n\t\treturn this.doGetUriTrustInfo(await this.getCanonicalUri(uri));\n\t}\n\n\tasync setUrisTrust(uris: URI[], trusted: boolean): Promise<void> {\n\t\tthis.doSetUrisTrust(await Promise.all(uris.map(uri => this.getCanonicalUri(uri))), trusted);\n\t}\n\n\tgetTrustedUris(): URI[] {\n\t\treturn this._trustStateInfo.uriTrustInfo.map(info => info.uri);\n\t}\n\n\tasync setTrustedUris(uris: URI[]): Promise<void> {\n\t\tthis._trustStateInfo.uriTrustInfo = [];\n\t\tfor (const uri of uris) {\n\t\t\tconst canonicalUri = await this.getCanonicalUri(uri);\n\t\t\tconst cleanUri = this.uriIdentityService.extUri.removeTrailingPathSeparator(canonicalUri);\n\t\t\tlet added = false;\n\t\t\tfor (const addedUri of this._trustStateInfo.uriTrustInfo) {\n\t\t\t\tif (this.uriIdentityService.extUri.isEqual(addedUri.uri, cleanUri)) {\n\t\t\t\t\tadded = true;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (added) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tthis._trustStateInfo.uriTrustInfo.push({\n\t\t\t\ttrusted: true,\n\t\t\t\turi: cleanUri\n\t\t\t});\n\t\t}\n\n\t\tawait this.saveTrustInfo();\n\t}\n\n\taddWorkspaceTrustTransitionParticipant(participant: IWorkspaceTrustTransitionParticipant): IDisposable {\n\t\treturn this._trustTransitionManager.addWorkspaceTrustTransitionParticipant(participant);\n\t}\n\n\t//#endregion\n}\n\nexport class WorkspaceTrustRequestService extends Disposable implements IWorkspaceTrustRequestService {\n\t_serviceBrand: undefined;\n\n\tprivate _openFilesTrustRequestPromise?: Promise<WorkspaceTrustUriResponse>;\n\tprivate _openFilesTrustRequestResolver?: (response: WorkspaceTrustUriResponse) => void;\n\n\tprivate _workspaceTrustRequestPromise?: Promise<boolean | undefined>;\n\tprivate _workspaceTrustRequestResolver?: (trusted: boolean | undefined) => void;\n\n\tprivate readonly _onDidInitiateOpenFilesTrustRequest = this._register(new Emitter<void>());\n\treadonly onDidInitiateOpenFilesTrustRequest = this._onDidInitiateOpenFilesTrustRequest.event;\n\n\tprivate readonly _onDidInitiateWorkspaceTrustRequest = this._register(new Emitter<WorkspaceTrustRequestOptions | undefined>());\n\treadonly onDidInitiateWorkspaceTrustRequest = this._onDidInitiateWorkspaceTrustRequest.event;\n\n\tprivate readonly _onDidInitiateWorkspaceTrustRequestOnStartup = this._register(new Emitter<void>());\n\treadonly onDidInitiateWorkspaceTrustRequestOnStartup = this._onDidInitiateWorkspaceTrustRequestOnStartup.event;\n\n\tconstructor(\n\t\t@IConfigurationService private readonly configurationService: IConfigurationService,\n\t\t@IWorkspaceTrustManagementService private readonly workspaceTrustManagementService: IWorkspaceTrustManagementService\n\t) {\n\t\tsuper();\n\t}\n\n\t//#region Open file(s) trust request\n\n\tprivate get untrustedFilesSetting(): 'prompt' | 'open' | 'newWindow' {\n\t\treturn this.configurationService.getValue(WORKSPACE_TRUST_UNTRUSTED_FILES);\n\t}\n\n\tprivate set untrustedFilesSetting(value: 'prompt' | 'open' | 'newWindow') {\n\t\tthis.configurationService.updateValue(WORKSPACE_TRUST_UNTRUSTED_FILES, value);\n\t}\n\n\tasync completeOpenFilesTrustRequest(result: WorkspaceTrustUriResponse, saveResponse?: boolean): Promise<void> {\n\t\tif (!this._openFilesTrustRequestResolver) {\n\t\t\treturn;\n\t\t}\n\n\t\t// Set acceptsOutOfWorkspaceFiles\n\t\tif (result === WorkspaceTrustUriResponse.Open) {\n\t\t\tthis.workspaceTrustManagementService.acceptsOutOfWorkspaceFiles = true;\n\t\t}\n\n\t\t// Save response\n\t\tif (saveResponse) {\n\t\t\tif (result === WorkspaceTrustUriResponse.Open) {\n\t\t\t\tthis.untrustedFilesSetting = 'open';\n\t\t\t}\n\n\t\t\tif (result === WorkspaceTrustUriResponse.OpenInNewWindow) {\n\t\t\t\tthis.untrustedFilesSetting = 'newWindow';\n\t\t\t}\n\t\t}\n\n\t\t// Resolve promise\n\t\tthis._openFilesTrustRequestResolver(result);\n\n\t\tthis._openFilesTrustRequestResolver = undefined;\n\t\tthis._openFilesTrustRequestPromise = undefined;\n\t}\n\n\tasync requestOpenFilesTrust(uris: URI[]): Promise<WorkspaceTrustUriResponse> {\n\t\t// If workspace is untrusted, there is no conflict\n\t\tif (!this.workspaceTrustManagementService.isWorkspaceTrusted()) {\n\t\t\treturn WorkspaceTrustUriResponse.Open;\n\t\t}\n\n\t\tconst openFilesTrustInfo = await Promise.all(uris.map(uri => this.workspaceTrustManagementService.getUriTrustInfo(uri)));\n\n\t\t// If all uris are trusted, there is no conflict\n\t\tif (openFilesTrustInfo.map(info => info.trusted).every(trusted => trusted)) {\n\t\t\treturn WorkspaceTrustUriResponse.Open;\n\t\t}\n\n\t\t// If user has setting, don't need to ask\n\t\tif (this.untrustedFilesSetting !== 'prompt') {\n\t\t\tif (this.untrustedFilesSetting === 'newWindow') {\n\t\t\t\treturn WorkspaceTrustUriResponse.OpenInNewWindow;\n\t\t\t}\n\n\t\t\tif (this.untrustedFilesSetting === 'open') {\n\t\t\t\treturn WorkspaceTrustUriResponse.Open;\n\t\t\t}\n\t\t}\n\n\t\t// If we already asked the user, don't need to ask again\n\t\tif (this.workspaceTrustManagementService.acceptsOutOfWorkspaceFiles) {\n\t\t\treturn WorkspaceTrustUriResponse.Open;\n\t\t}\n\n\t\t// Create/return a promise\n\t\tif (!this._openFilesTrustRequestPromise) {\n\t\t\tthis._openFilesTrustRequestPromise = new Promise<WorkspaceTrustUriResponse>(resolve => {\n\t\t\t\tthis._openFilesTrustRequestResolver = resolve;\n\t\t\t});\n\t\t} else {\n\t\t\treturn this._openFilesTrustRequestPromise;\n\t\t}\n\n\t\tthis._onDidInitiateOpenFilesTrustRequest.fire();\n\t\treturn this._openFilesTrustRequestPromise;\n\t}\n\n\t//#endregion\n\n\t//#region Workspace trust request\n\n\tprivate resolveWorkspaceTrustRequest(trusted?: boolean): void {\n\t\tif (this._workspaceTrustRequestResolver) {\n\t\t\tthis._workspaceTrustRequestResolver(trusted ?? this.workspaceTrustManagementService.isWorkspaceTrusted());\n\n\t\t\tthis._workspaceTrustRequestResolver = undefined;\n\t\t\tthis._workspaceTrustRequestPromise = undefined;\n\t\t}\n\t}\n\n\tcancelWorkspaceTrustRequest(): void {\n\t\tif (this._workspaceTrustRequestResolver) {\n\t\t\tthis._workspaceTrustRequestResolver(undefined);\n\n\t\t\tthis._workspaceTrustRequestResolver = undefined;\n\t\t\tthis._workspaceTrustRequestPromise = undefined;\n\t\t}\n\t}\n\n\tasync completeWorkspaceTrustRequest(trusted?: boolean): Promise<void> {\n\t\tif (trusted === undefined || trusted === this.workspaceTrustManagementService.isWorkspaceTrusted()) {\n\t\t\tthis.resolveWorkspaceTrustRequest(trusted);\n\t\t\treturn;\n\t\t}\n\n\t\t// Register one-time event handler to resolve the promise when workspace trust changed\n\t\tEvent.once(this.workspaceTrustManagementService.onDidChangeTrust)(trusted => this.resolveWorkspaceTrustRequest(trusted));\n\n\t\t// Update storage, transition workspace state\n\t\tawait this.workspaceTrustManagementService.setWorkspaceTrust(trusted);\n\t}\n\n\tasync requestWorkspaceTrust(options?: WorkspaceTrustRequestOptions): Promise<boolean | undefined> {\n\t\t// Trusted workspace\n\t\tif (this.workspaceTrustManagementService.isWorkspaceTrusted()) {\n\t\t\treturn this.workspaceTrustManagementService.isWorkspaceTrusted();\n\t\t}\n\n\t\t// Modal request\n\t\tif (!this._workspaceTrustRequestPromise) {\n\t\t\t// Create promise\n\t\t\tthis._workspaceTrustRequestPromise = new Promise(resolve => {\n\t\t\t\tthis._workspaceTrustRequestResolver = resolve;\n\t\t\t});\n\t\t} else {\n\t\t\t// Return existing promise\n\t\t\treturn this._workspaceTrustRequestPromise;\n\t\t}\n\n\t\tthis._onDidInitiateWorkspaceTrustRequest.fire(options);\n\t\treturn this._workspaceTrustRequestPromise;\n\t}\n\n\trequestWorkspaceTrustOnStartup(): void {\n\t\tif (!this._workspaceTrustRequestPromise) {\n\t\t\t// Create promise\n\t\t\tthis._workspaceTrustRequestPromise = new Promise(resolve => {\n\t\t\t\tthis._workspaceTrustRequestResolver = resolve;\n\t\t\t});\n\t\t}\n\n\t\tthis._onDidInitiateWorkspaceTrustRequestOnStartup.fire();\n\t}\n\n\t//#endregion\n}\n\nclass WorkspaceTrustTransitionManager extends Disposable {\n\n\tprivate readonly participants = new LinkedList<IWorkspaceTrustTransitionParticipant>();\n\n\taddWorkspaceTrustTransitionParticipant(participant: IWorkspaceTrustTransitionParticipant): IDisposable {\n\t\tconst remove = this.participants.push(participant);\n\t\treturn toDisposable(() => remove());\n\t}\n\n\tasync participate(trusted: boolean): Promise<void> {\n\t\tfor (const participant of this.participants) {\n\t\t\tawait participant.participate(trusted);\n\t\t}\n\t}\n\n\toverride dispose(): void {\n\t\tthis.participants.clear();\n\t\tsuper.dispose();\n\t}\n}\n\ninterface WorkspaceTrustMementoData {\n\tacceptsOutOfWorkspaceFiles?: boolean;\n\tisEmptyWorkspaceTrusted?: boolean | undefined;\n}\n\nclass WorkspaceTrustMemento {\n\n\tprivate readonly _memento?: Memento<WorkspaceTrustMementoData>;\n\tprivate readonly _mementoObject: WorkspaceTrustMementoData;\n\n\tprivate readonly _acceptsOutOfWorkspaceFilesKey = 'acceptsOutOfWorkspaceFiles';\n\tprivate readonly _isEmptyWorkspaceTrustedKey = 'isEmptyWorkspaceTrusted';\n\n\tconstructor(storageService?: IStorageService) {\n\t\tif (storageService) {\n\t\t\tthis._memento = new Memento('workspaceTrust', storageService);\n\t\t\tthis._mementoObject = this._memento.getMemento(StorageScope.WORKSPACE, StorageTarget.MACHINE);\n\t\t} else {\n\t\t\tthis._mementoObject = {};\n\t\t}\n\t}\n\n\tget acceptsOutOfWorkspaceFiles(): boolean {\n\t\treturn this._mementoObject[this._acceptsOutOfWorkspaceFilesKey] ?? false;\n\t}\n\n\tset acceptsOutOfWorkspaceFiles(value: boolean) {\n\t\tthis._mementoObject[this._acceptsOutOfWorkspaceFilesKey] = value;\n\n\t\tthis._memento?.saveMemento();\n\t}\n\n\tget isEmptyWorkspaceTrusted(): boolean | undefined {\n\t\treturn this._mementoObject[this._isEmptyWorkspaceTrustedKey];\n\t}\n\n\tset isEmptyWorkspaceTrusted(value: boolean | undefined) {\n\t\tthis._mementoObject[this._isEmptyWorkspaceTrustedKey] = value;\n\n\t\tthis._memento?.saveMemento();\n\t}\n}\n\nregisterSingleton(IWorkspaceTrustRequestService, WorkspaceTrustRequestService, InstantiationType.Delayed);\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Emitter, Event } from '../../../../base/common/event.js';\nimport { Disposable, IDisposable, toDisposable } from '../../../../base/common/lifecycle.js';\nimport { LinkedList } from '../../../../base/common/linkedList.js';\nimport { Schemas } from '../../../../base/common/network.js';\nimport { URI } from '../../../../base/common/uri.js';\nimport { IPath } from '../../../../platform/window/common/window.js';\nimport { IConfigurationService } from '../../../../platform/configuration/common/configuration.js';\nimport { InstantiationType, registerSingleton } from '../../../../platform/instantiation/common/extensions.js';\nimport { IRemoteAuthorityResolverService, ResolverResult } from '../../../../platform/remote/common/remoteAuthorityResolver.js';\nimport { getRemoteAuthority } from '../../../../platform/remote/common/remoteHosts.js';\nimport { isVirtualResource } from '../../../../platform/workspace/common/virtualWorkspace.js';\nimport { IStorageService, StorageScope, StorageTarget } from '../../../../platform/storage/common/storage.js';\nimport { ISingleFolderWorkspaceIdentifier, isSavedWorkspace, isSingleFolderWorkspaceIdentifier, isTemporaryWorkspace, IWorkspace, IWorkspaceContextService, IWorkspaceFolder, toWorkspaceIdentifier, WorkbenchState } from '../../../../platform/workspace/common/workspace.js';\nimport { WorkspaceTrustRequestOptions, IWorkspaceTrustManagementService, IWorkspaceTrustInfo, IWorkspaceTrustUriInfo, IWorkspaceTrustRequestService, IWorkspaceTrustTransitionParticipant, WorkspaceTrustUriResponse, IWorkspaceTrustEnablementService } from '../../../../platform/workspace/common/workspaceTrust.js';\nimport { Memento } from '../../../common/memento.js';\nimport { IWorkbenchEnvironmentService } from '../../environment/common/environmentService.js';\nimport { IUriIdentityService } from '../../../../platform/uriIdentity/common/uriIdentity.js';\nimport { isEqualAuthority } from '../../../../base/common/resources.js';\nimport { isWeb } from '../../../../base/common/platform.js';\nimport { IFileService } from '../../../../platform/files/common/files.js';\nimport { promiseWithResolvers } from '../../../../base/common/async.js';\n\nexport const WORKSPACE_TRUST_ENABLED = 'security.workspace.trust.enabled';\nexport const WORKSPACE_TRUST_STARTUP_PROMPT = 'security.workspace.trust.startupPrompt';\nexport const WORKSPACE_TRUST_BANNER = 'security.workspace.trust.banner';\nexport const WORKSPACE_TRUST_UNTRUSTED_FILES = 'security.workspace.trust.untrustedFiles';\nexport const WORKSPACE_TRUST_EMPTY_WINDOW = 'security.workspace.trust.emptyWindow';\nexport const WORKSPACE_TRUST_EXTENSION_SUPPORT = 'extensions.supportUntrustedWorkspaces';\nexport const WORKSPACE_TRUST_STORAGE_KEY = 'content.trust.model.key';\n\nexport class CanonicalWorkspace implements IWorkspace {\n\tconstructor(\n\t\tprivate readonly originalWorkspace: IWorkspace,\n\t\tprivate readonly canonicalFolderUris: URI[],\n\t\tprivate readonly canonicalConfiguration: URI | null | undefined\n\t) { }\n\n\n\tget folders(): IWorkspaceFolder[] {\n\t\treturn this.originalWorkspace.folders.map((folder, index) => {\n\t\t\treturn {\n\t\t\t\tindex: folder.index,\n\t\t\t\tname: folder.name,\n\t\t\t\ttoResource: folder.toResource,\n\t\t\t\turi: this.canonicalFolderUris[index]\n\t\t\t};\n\t\t});\n\t}\n\n\tget transient(): boolean | undefined {\n\t\treturn this.originalWorkspace.transient;\n\t}\n\n\tget configuration(): URI | null | undefined {\n\t\treturn this.canonicalConfiguration ?? this.originalWorkspace.configuration;\n\t}\n\n\tget id(): string {\n\t\treturn this.originalWorkspace.id;\n\t}\n}\n\nexport class WorkspaceTrustEnablementService extends Disposable implements IWorkspaceTrustEnablementService {\n\n\t_serviceBrand: undefined;\n\n\tconstructor(\n\t\t@IConfigurationService private readonly configurationService: IConfigurationService,\n\t\t@IWorkbenchEnvironmentService private readonly environmentService: IWorkbenchEnvironmentService\n\t) {\n\t\tsuper();\n\t}\n\n\tisWorkspaceTrustEnabled(): boolean {\n\t\tif (this.environmentService.disableWorkspaceTrust) {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn !!this.configurationService.getValue(WORKSPACE_TRUST_ENABLED);\n\t}\n}\n\nexport class WorkspaceTrustManagementService extends Disposable implements IWorkspaceTrustManagementService {\n\n\t_serviceBrand: undefined;\n\n\tprivate readonly storageKey = WORKSPACE_TRUST_STORAGE_KEY;\n\n\tprivate readonly _workspaceResolvedPromise: Promise<void>;\n\tprivate readonly _workspaceResolvedPromiseResolve: () => void;\n\tprivate readonly _workspaceTrustInitializedPromise: Promise<void>;\n\tprivate readonly _workspaceTrustInitializedPromiseResolve: () => void;\n\n\tprivate readonly _onDidChangeTrust = this._register(new Emitter<boolean>());\n\treadonly onDidChangeTrust = this._onDidChangeTrust.event;\n\n\tprivate readonly _onDidChangeTrustedFolders = this._register(new Emitter<void>());\n\treadonly onDidChangeTrustedFolders = this._onDidChangeTrustedFolders.event;\n\n\tprivate _canonicalStartupFiles: URI[] = [];\n\tprivate _canonicalWorkspace: IWorkspace;\n\tprivate _canonicalUrisResolved: boolean;\n\n\tprivate _isTrusted: boolean;\n\tprivate _trustStateInfo: IWorkspaceTrustInfo;\n\tprivate _remoteAuthority: ResolverResult | undefined;\n\n\tprivate readonly _storedTrustState: WorkspaceTrustMemento;\n\tprivate readonly _trustTransitionManager: WorkspaceTrustTransitionManager;\n\n\tconstructor(\n\t\t@IConfigurationService private readonly configurationService: IConfigurationService,\n\t\t@IRemoteAuthorityResolverService private readonly remoteAuthorityResolverService: IRemoteAuthorityResolverService,\n\t\t@IStorageService private readonly storageService: IStorageService,\n\t\t@IUriIdentityService private readonly uriIdentityService: IUriIdentityService,\n\t\t@IWorkbenchEnvironmentService private readonly environmentService: IWorkbenchEnvironmentService,\n\t\t@IWorkspaceContextService private readonly workspaceService: IWorkspaceContextService,\n\t\t@IWorkspaceTrustEnablementService private readonly workspaceTrustEnablementService: IWorkspaceTrustEnablementService,\n\t\t@IFileService private readonly fileService: IFileService\n\t) {\n\t\tsuper();\n\n\t\tthis._canonicalUrisResolved = false;\n\t\tthis._canonicalWorkspace = this.workspaceService.getWorkspace();\n\n\t\t({ promise: this._workspaceResolvedPromise, resolve: this._workspaceResolvedPromiseResolve } = promiseWithResolvers());\n\t\t({ promise: this._workspaceTrustInitializedPromise, resolve: this._workspaceTrustInitializedPromiseResolve } = promiseWithResolvers());\n\n\t\tthis._storedTrustState = new WorkspaceTrustMemento(isWeb && this.isEmptyWorkspace() ? undefined : this.storageService);\n\t\tthis._trustTransitionManager = this._register(new WorkspaceTrustTransitionManager());\n\n\t\tthis._trustStateInfo = this.loadTrustInfo();\n\t\tthis._isTrusted = this.calculateWorkspaceTrust();\n\n\t\tthis.initializeWorkspaceTrust();\n\t\tthis.registerListeners();\n\t}\n\n\t//#region initialize\n\n\tprivate initializeWorkspaceTrust(): void {\n\t\t// Resolve canonical Uris\n\t\tthis.resolveCanonicalUris()\n\t\t\t.then(async () => {\n\t\t\t\tthis._canonicalUrisResolved = true;\n\t\t\t\tawait this.updateWorkspaceTrust();\n\t\t\t})\n\t\t\t.finally(() => {\n\t\t\t\tthis._workspaceResolvedPromiseResolve();\n\n\t\t\t\tif (!this.environmentService.remoteAuthority) {\n\t\t\t\t\tthis._workspaceTrustInitializedPromiseResolve();\n\t\t\t\t}\n\t\t\t});\n\n\t\t// Remote - resolve remote authority\n\t\tif (this.environmentService.remoteAuthority) {\n\t\t\tthis.remoteAuthorityResolverService.resolveAuthority(this.environmentService.remoteAuthority)\n\t\t\t\t.then(async result => {\n\t\t\t\t\tthis._remoteAuthority = result;\n\t\t\t\t\tawait this.fileService.activateProvider(Schemas.vscodeRemote);\n\t\t\t\t\tawait this.updateWorkspaceTrust();\n\t\t\t\t})\n\t\t\t\t.finally(() => {\n\t\t\t\t\tthis._workspaceTrustInitializedPromiseResolve();\n\t\t\t\t});\n\t\t}\n\n\t\t// Empty workspace - save initial state to memento\n\t\tif (this.isEmptyWorkspace()) {\n\t\t\tthis._workspaceTrustInitializedPromise.then(() => {\n\t\t\t\tif (this._storedTrustState.isEmptyWorkspaceTrusted === undefined) {\n\t\t\t\t\tthis._storedTrustState.isEmptyWorkspaceTrusted = this.isWorkspaceTrusted();\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\t//#endregion\n\n\t//#region private interface\n\n\tprivate registerListeners(): void {\n\t\tthis._register(this.workspaceService.onDidChangeWorkspaceFolders(async () => await this.updateWorkspaceTrust()));\n\t\tthis._register(this.storageService.onDidChangeValue(StorageScope.APPLICATION, this.storageKey, this._store)(async () => {\n\t\t\t/* This will only execute if storage was changed by a user action in a separate window */\n\t\t\tif (JSON.stringify(this._trustStateInfo) !== JSON.stringify(this.loadTrustInfo())) {\n\t\t\t\tthis._trustStateInfo = this.loadTrustInfo();\n\t\t\t\tthis._onDidChangeTrustedFolders.fire();\n\n\t\t\t\tawait this.updateWorkspaceTrust();\n\t\t\t}\n\t\t}));\n\t}\n\n\tprivate async getCanonicalUri(uri: URI): Promise<URI> {\n\t\tlet canonicalUri = uri;\n\t\tif (this.environmentService.remoteAuthority && uri.scheme === Schemas.vscodeRemote) {\n\t\t\tcanonicalUri = await this.remoteAuthorityResolverService.getCanonicalURI(uri);\n\t\t} else if (uri.scheme === 'vscode-vfs') {\n\t\t\tconst index = uri.authority.indexOf('+');\n\t\t\tif (index !== -1) {\n\t\t\t\tcanonicalUri = uri.with({ authority: uri.authority.substr(0, index) });\n\t\t\t}\n\t\t}\n\n\t\t// ignore query and fragent section of uris always\n\t\treturn canonicalUri.with({ query: null, fragment: null });\n\t}\n\n\tprivate async resolveCanonicalUris(): Promise<void> {\n\t\t// Open editors\n\t\tconst filesToOpen: IPath[] = [];\n\t\tif (this.environmentService.filesToOpenOrCreate) {\n\t\t\tfilesToOpen.push(...this.environmentService.filesToOpenOrCreate);\n\t\t}\n\n\t\tif (this.environmentService.filesToDiff) {\n\t\t\tfilesToOpen.push(...this.environmentService.filesToDiff);\n\t\t}\n\n\t\tif (this.environmentService.filesToMerge) {\n\t\t\tfilesToOpen.push(...this.environmentService.filesToMerge);\n\t\t}\n\n\t\tif (filesToOpen.length) {\n\t\t\tconst filesToOpenOrCreateUris = filesToOpen.filter(f => !!f.fileUri).map(f => f.fileUri!);\n\t\t\tconst canonicalFilesToOpen = await Promise.all(filesToOpenOrCreateUris.map(uri => this.getCanonicalUri(uri)));\n\n\t\t\tthis._canonicalStartupFiles.push(...canonicalFilesToOpen.filter(uri => this._canonicalStartupFiles.every(u => !this.uriIdentityService.extUri.isEqual(uri, u))));\n\t\t}\n\n\t\t// Workspace\n\t\tconst workspaceUris = this.workspaceService.getWorkspace().folders.map(f => f.uri);\n\t\tconst canonicalWorkspaceFolders = await Promise.all(workspaceUris.map(uri => this.getCanonicalUri(uri)));\n\n\t\tlet canonicalWorkspaceConfiguration = this.workspaceService.getWorkspace().configuration;\n\t\tif (canonicalWorkspaceConfiguration && isSavedWorkspace(canonicalWorkspaceConfiguration, this.environmentService)) {\n\t\t\tcanonicalWorkspaceConfiguration = await this.getCanonicalUri(canonicalWorkspaceConfiguration);\n\t\t}\n\n\t\tthis._canonicalWorkspace = new CanonicalWorkspace(this.workspaceService.getWorkspace(), canonicalWorkspaceFolders, canonicalWorkspaceConfiguration);\n\t}\n\n\tprivate loadTrustInfo(): IWorkspaceTrustInfo {\n\t\tconst infoAsString = this.storageService.get(this.storageKey, StorageScope.APPLICATION);\n\n\t\tlet result: IWorkspaceTrustInfo | undefined;\n\t\ttry {\n\t\t\tif (infoAsString) {\n\t\t\t\tresult = JSON.parse(infoAsString);\n\t\t\t}\n\t\t} catch { }\n\n\t\tif (!result) {\n\t\t\tresult = {\n\t\t\t\turiTrustInfo: []\n\t\t\t};\n\t\t}\n\n\t\tif (!result.uriTrustInfo) {\n\t\t\tresult.uriTrustInfo = [];\n\t\t}\n\n\t\tresult.uriTrustInfo = result.uriTrustInfo.map(info => { return { uri: URI.revive(info.uri), trusted: info.trusted }; });\n\t\tresult.uriTrustInfo = result.uriTrustInfo.filter(info => info.trusted);\n\n\t\treturn result;\n\t}\n\n\tprivate async saveTrustInfo(): Promise<void> {\n\t\tthis.storageService.store(this.storageKey, JSON.stringify(this._trustStateInfo), StorageScope.APPLICATION, StorageTarget.MACHINE);\n\t\tthis._onDidChangeTrustedFolders.fire();\n\n\t\tawait this.updateWorkspaceTrust();\n\t}\n\n\tprivate getWorkspaceUris(): URI[] {\n\t\tconst workspaceUris = this._canonicalWorkspace.folders.map(f => f.uri);\n\t\tconst workspaceConfiguration = this._canonicalWorkspace.configuration;\n\t\tif (workspaceConfiguration && isSavedWorkspace(workspaceConfiguration, this.environmentService)) {\n\t\t\tworkspaceUris.push(workspaceConfiguration);\n\t\t}\n\n\t\treturn workspaceUris;\n\t}\n\n\tprivate calculateWorkspaceTrust(): boolean {\n\t\t// Feature is disabled\n\t\tif (!this.workspaceTrustEnablementService.isWorkspaceTrustEnabled()) {\n\t\t\treturn true;\n\t\t}\n\n\t\t// Canonical Uris not yet resolved\n\t\tif (!this._canonicalUrisResolved) {\n\t\t\treturn false;\n\t\t}\n\n\t\t// Remote - resolver explicitly sets workspace trust to TRUE\n\t\tif (this.environmentService.remoteAuthority && this._remoteAuthority?.options?.isTrusted) {\n\t\t\treturn this._remoteAuthority.options.isTrusted;\n\t\t}\n\n\t\t// Empty workspace - use memento, open ediors, or user setting\n\t\tif (this.isEmptyWorkspace()) {\n\t\t\t// Use memento if present\n\t\t\tif (this._storedTrustState.isEmptyWorkspaceTrusted !== undefined) {\n\t\t\t\treturn this._storedTrustState.isEmptyWorkspaceTrusted;\n\t\t\t}\n\n\t\t\t// Startup files\n\t\t\tif (this._canonicalStartupFiles.length) {\n\t\t\t\treturn this.getUrisTrust(this._canonicalStartupFiles);\n\t\t\t}\n\n\t\t\t// User setting\n\t\t\treturn !!this.configurationService.getValue(WORKSPACE_TRUST_EMPTY_WINDOW);\n\t\t}\n\n\t\treturn this.getUrisTrust(this.getWorkspaceUris());\n\t}\n\n\tprivate async updateWorkspaceTrust(trusted?: boolean): Promise<void> {\n\t\tif (!this.workspaceTrustEnablementService.isWorkspaceTrustEnabled()) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (trusted === undefined) {\n\t\t\tawait this.resolveCanonicalUris();\n\t\t\ttrusted = this.calculateWorkspaceTrust();\n\t\t}\n\n\t\tif (this.isWorkspaceTrusted() === trusted) { return; }\n\n\t\t// Update workspace trust\n\t\tthis.isTrusted = trusted;\n\n\t\t// Run workspace trust transition participants\n\t\tawait this._trustTransitionManager.participate(trusted);\n\n\t\t// Fire workspace trust change event\n\t\tthis._onDidChangeTrust.fire(trusted);\n\t}\n\n\tprivate getUrisTrust(uris: URI[]): boolean {\n\t\tlet state = true;\n\t\tfor (const uri of uris) {\n\t\t\tconst { trusted } = this.doGetUriTrustInfo(uri);\n\n\t\t\tif (!trusted) {\n\t\t\t\tstate = trusted;\n\t\t\t\treturn state;\n\t\t\t}\n\t\t}\n\n\t\treturn state;\n\t}\n\n\tprivate doGetUriTrustInfo(uri: URI): IWorkspaceTrustUriInfo {\n\t\t// Return trusted when workspace trust is disabled\n\t\tif (!this.workspaceTrustEnablementService.isWorkspaceTrustEnabled()) {\n\t\t\treturn { trusted: true, uri };\n\t\t}\n\n\t\tif (this.isTrustedVirtualResource(uri)) {\n\t\t\treturn { trusted: true, uri };\n\t\t}\n\n\t\tif (this.isTrustedByRemote(uri)) {\n\t\t\treturn { trusted: true, uri };\n\t\t}\n\n\t\tlet resultState = false;\n\t\tlet maxLength = -1;\n\n\t\tlet resultUri = uri;\n\n\t\tfor (const trustInfo of this._trustStateInfo.uriTrustInfo) {\n\t\t\tif (this.uriIdentityService.extUri.isEqualOrParent(uri, trustInfo.uri)) {\n\t\t\t\tconst fsPath = trustInfo.uri.fsPath;\n\t\t\t\tif (fsPath.length > maxLength) {\n\t\t\t\t\tmaxLength = fsPath.length;\n\t\t\t\t\tresultState = trustInfo.trusted;\n\t\t\t\t\tresultUri = trustInfo.uri;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn { trusted: resultState, uri: resultUri };\n\t}\n\n\tprivate async doSetUrisTrust(uris: URI[], trusted: boolean): Promise<void> {\n\t\tlet changed = false;\n\n\t\tfor (const uri of uris) {\n\t\t\tif (trusted) {\n\t\t\t\tif (this.isTrustedVirtualResource(uri)) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tif (this.isTrustedByRemote(uri)) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tconst foundItem = this._trustStateInfo.uriTrustInfo.find(trustInfo => this.uriIdentityService.extUri.isEqual(trustInfo.uri, uri));\n\t\t\t\tif (!foundItem) {\n\t\t\t\t\tthis._trustStateInfo.uriTrustInfo.push({ uri, trusted: true });\n\t\t\t\t\tchanged = true;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tconst previousLength = this._trustStateInfo.uriTrustInfo.length;\n\t\t\t\tthis._trustStateInfo.uriTrustInfo = this._trustStateInfo.uriTrustInfo.filter(trustInfo => !this.uriIdentityService.extUri.isEqual(trustInfo.uri, uri));\n\t\t\t\tif (previousLength !== this._trustStateInfo.uriTrustInfo.length) {\n\t\t\t\t\tchanged = true;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (changed) {\n\t\t\tawait this.saveTrustInfo();\n\t\t}\n\t}\n\n\tprivate isEmptyWorkspace(): boolean {\n\t\tif (this.workspaceService.getWorkbenchState() === WorkbenchState.EMPTY) {\n\t\t\treturn true;\n\t\t}\n\n\t\tconst workspace = this.workspaceService.getWorkspace();\n\t\tif (workspace) {\n\t\t\treturn isTemporaryWorkspace(this.workspaceService.getWorkspace()) && workspace.folders.length === 0;\n\t\t}\n\n\t\treturn false;\n\t}\n\n\tprivate isTrustedVirtualResource(uri: URI): boolean {\n\t\treturn isVirtualResource(uri) && uri.scheme !== 'vscode-vfs';\n\t}\n\n\tprivate isTrustedByRemote(uri: URI): boolean {\n\t\tif (!this.environmentService.remoteAuthority) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif (!this._remoteAuthority) {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn (isEqualAuthority(getRemoteAuthority(uri), this._remoteAuthority.authority.authority)) && !!this._remoteAuthority.options?.isTrusted;\n\t}\n\n\tprivate set isTrusted(value: boolean) {\n\t\tthis._isTrusted = value;\n\n\t\t// Reset acceptsOutOfWorkspaceFiles\n\t\tif (!value) {\n\t\t\tthis._storedTrustState.acceptsOutOfWorkspaceFiles = false;\n\t\t}\n\n\t\t// Empty workspace - save memento\n\t\tif (this.isEmptyWorkspace()) {\n\t\t\tthis._storedTrustState.isEmptyWorkspaceTrusted = value;\n\t\t}\n\t}\n\n\t//#endregion\n\n\t//#region public interface\n\n\tget workspaceResolved(): Promise<void> {\n\t\treturn this._workspaceResolvedPromise;\n\t}\n\n\tget workspaceTrustInitialized(): Promise<void> {\n\t\treturn this._workspaceTrustInitializedPromise;\n\t}\n\n\tget acceptsOutOfWorkspaceFiles(): boolean {\n\t\treturn this._storedTrustState.acceptsOutOfWorkspaceFiles;\n\t}\n\n\tset acceptsOutOfWorkspaceFiles(value: boolean) {\n\t\tthis._storedTrustState.acceptsOutOfWorkspaceFiles = value;\n\t}\n\n\tisWorkspaceTrusted(): boolean {\n\t\treturn this._isTrusted;\n\t}\n\n\tisWorkspaceTrustForced(): boolean {\n\t\t// Remote - remote authority explicitly sets workspace trust\n\t\tif (this.environmentService.remoteAuthority && this._remoteAuthority?.options?.isTrusted !== undefined) {\n\t\t\treturn true;\n\t\t}\n\n\t\t// All workspace uris are trusted automatically\n\t\tconst workspaceUris = this.getWorkspaceUris().filter(uri => !this.isTrustedVirtualResource(uri));\n\t\tif (workspaceUris.length === 0) {\n\t\t\treturn true;\n\t\t}\n\n\t\treturn false;\n\t}\n\n\tcanSetParentFolderTrust(): boolean {\n\t\tconst workspaceIdentifier = toWorkspaceIdentifier(this._canonicalWorkspace);\n\n\t\tif (!isSingleFolderWorkspaceIdentifier(workspaceIdentifier)) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif (workspaceIdentifier.uri.scheme !== Schemas.file && workspaceIdentifier.uri.scheme !== Schemas.vscodeRemote) {\n\t\t\treturn false;\n\t\t}\n\n\t\tconst parentFolder = this.uriIdentityService.extUri.dirname(workspaceIdentifier.uri);\n\t\tif (this.uriIdentityService.extUri.isEqual(workspaceIdentifier.uri, parentFolder)) {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t}\n\n\tasync setParentFolderTrust(trusted: boolean): Promise<void> {\n\t\tif (this.canSetParentFolderTrust()) {\n\t\t\tconst workspaceUri = (toWorkspaceIdentifier(this._canonicalWorkspace) as ISingleFolderWorkspaceIdentifier).uri;\n\t\t\tconst parentFolder = this.uriIdentityService.extUri.dirname(workspaceUri);\n\n\t\t\tawait this.setUrisTrust([parentFolder], trusted);\n\t\t}\n\t}\n\n\tcanSetWorkspaceTrust(): boolean {\n\t\t// Remote - remote authority not yet resolved, or remote authority explicitly sets workspace trust\n\t\tif (this.environmentService.remoteAuthority && (!this._remoteAuthority || this._remoteAuthority.options?.isTrusted !== undefined)) {\n\t\t\treturn false;\n\t\t}\n\n\t\t// Empty workspace\n\t\tif (this.isEmptyWorkspace()) {\n\t\t\treturn true;\n\t\t}\n\n\t\t// All workspace uris are trusted automatically\n\t\tconst workspaceUris = this.getWorkspaceUris().filter(uri => !this.isTrustedVirtualResource(uri));\n\t\tif (workspaceUris.length === 0) {\n\t\t\treturn false;\n\t\t}\n\n\t\t// Untrusted workspace\n\t\tif (!this.isWorkspaceTrusted()) {\n\t\t\treturn true;\n\t\t}\n\n\t\t// Trusted workspaces\n\t\t// Can only untrusted in the single folder scenario\n\t\tconst workspaceIdentifier = toWorkspaceIdentifier(this._canonicalWorkspace);\n\t\tif (!isSingleFolderWorkspaceIdentifier(workspaceIdentifier)) {\n\t\t\treturn false;\n\t\t}\n\n\t\t// Can only be untrusted in certain schemes\n\t\tif (workspaceIdentifier.uri.scheme !== Schemas.file && workspaceIdentifier.uri.scheme !== 'vscode-vfs') {\n\t\t\treturn false;\n\t\t}\n\n\t\t// If the current folder isn't trusted directly, return false\n\t\tconst trustInfo = this.doGetUriTrustInfo(workspaceIdentifier.uri);\n\t\tif (!trustInfo.trusted || !this.uriIdentityService.extUri.isEqual(workspaceIdentifier.uri, trustInfo.uri)) {\n\t\t\treturn false;\n\t\t}\n\n\t\t// Check if the parent is also trusted\n\t\tif (this.canSetParentFolderTrust()) {\n\t\t\tconst parentFolder = this.uriIdentityService.extUri.dirname(workspaceIdentifier.uri);\n\t\t\tconst parentPathTrustInfo = this.doGetUriTrustInfo(parentFolder);\n\t\t\tif (parentPathTrustInfo.trusted) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\n\t\treturn true;\n\t}\n\n\tasync setWorkspaceTrust(trusted: boolean): Promise<void> {\n\t\t// Empty workspace\n\t\tif (this.isEmptyWorkspace()) {\n\t\t\tawait this.updateWorkspaceTrust(trusted);\n\t\t\treturn;\n\t\t}\n\n\t\tconst workspaceFolders = this.getWorkspaceUris();\n\t\tawait this.setUrisTrust(workspaceFolders, trusted);\n\t}\n\n\tasync getUriTrustInfo(uri: URI): Promise<IWorkspaceTrustUriInfo> {\n\t\t// Return trusted when workspace trust is disabled\n\t\tif (!this.workspaceTrustEnablementService.isWorkspaceTrustEnabled()) {\n\t\t\treturn { trusted: true, uri };\n\t\t}\n\n\t\t// Uri is trusted automatically by the remote\n\t\tif (this.isTrustedByRemote(uri)) {\n\t\t\treturn { trusted: true, uri };\n\t\t}\n\n\t\treturn this.doGetUriTrustInfo(await this.getCanonicalUri(uri));\n\t}\n\n\tasync setUrisTrust(uris: URI[], trusted: boolean): Promise<void> {\n\t\tthis.doSetUrisTrust(await Promise.all(uris.map(uri => this.getCanonicalUri(uri))), trusted);\n\t}\n\n\tgetTrustedUris(): URI[] {\n\t\treturn this._trustStateInfo.uriTrustInfo.map(info => info.uri);\n\t}\n\n\tasync setTrustedUris(uris: URI[]): Promise<void> {\n\t\tthis._trustStateInfo.uriTrustInfo = [];\n\t\tfor (const uri of uris) {\n\t\t\tconst canonicalUri = await this.getCanonicalUri(uri);\n\t\t\tconst cleanUri = this.uriIdentityService.extUri.removeTrailingPathSeparator(canonicalUri);\n\t\t\tlet added = false;\n\t\t\tfor (const addedUri of this._trustStateInfo.uriTrustInfo) {\n\t\t\t\tif (this.uriIdentityService.extUri.isEqual(addedUri.uri, cleanUri)) {\n\t\t\t\t\tadded = true;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (added) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tthis._trustStateInfo.uriTrustInfo.push({\n\t\t\t\ttrusted: true,\n\t\t\t\turi: cleanUri\n\t\t\t});\n\t\t}\n\n\t\tawait this.saveTrustInfo();\n\t}\n\n\taddWorkspaceTrustTransitionParticipant(participant: IWorkspaceTrustTransitionParticipant): IDisposable {\n\t\treturn this._trustTransitionManager.addWorkspaceTrustTransitionParticipant(participant);\n\t}\n\n\t//#endregion\n}\n\nexport class WorkspaceTrustRequestService extends Disposable implements IWorkspaceTrustRequestService {\n\t_serviceBrand: undefined;\n\n\tprivate _openFilesTrustRequestPromise?: Promise<WorkspaceTrustUriResponse>;\n\tprivate _openFilesTrustRequestResolver?: (response: WorkspaceTrustUriResponse) => void;\n\n\tprivate _workspaceTrustRequestPromise?: Promise<boolean | undefined>;\n\tprivate _workspaceTrustRequestResolver?: (trusted: boolean | undefined) => void;\n\n\tprivate readonly _onDidInitiateOpenFilesTrustRequest = this._register(new Emitter<void>());\n\treadonly onDidInitiateOpenFilesTrustRequest = this._onDidInitiateOpenFilesTrustRequest.event;\n\n\tprivate readonly _onDidInitiateWorkspaceTrustRequest = this._register(new Emitter<WorkspaceTrustRequestOptions | undefined>());\n\treadonly onDidInitiateWorkspaceTrustRequest = this._onDidInitiateWorkspaceTrustRequest.event;\n\n\tprivate readonly _onDidInitiateWorkspaceTrustRequestOnStartup = this._register(new Emitter<void>());\n\treadonly onDidInitiateWorkspaceTrustRequestOnStartup = this._onDidInitiateWorkspaceTrustRequestOnStartup.event;\n\n\tconstructor(\n\t\t@IConfigurationService private readonly configurationService: IConfigurationService,\n\t\t@IWorkspaceTrustManagementService private readonly workspaceTrustManagementService: IWorkspaceTrustManagementService\n\t) {\n\t\tsuper();\n\t}\n\n\t//#region Open file(s) trust request\n\n\tprivate get untrustedFilesSetting(): 'prompt' | 'open' | 'newWindow' {\n\t\treturn this.configurationService.getValue(WORKSPACE_TRUST_UNTRUSTED_FILES);\n\t}\n\n\tprivate set untrustedFilesSetting(value: 'prompt' | 'open' | 'newWindow') {\n\t\tthis.configurationService.updateValue(WORKSPACE_TRUST_UNTRUSTED_FILES, value);\n\t}\n\n\tasync completeOpenFilesTrustRequest(result: WorkspaceTrustUriResponse, saveResponse?: boolean): Promise<void> {\n\t\tif (!this._openFilesTrustRequestResolver) {\n\t\t\treturn;\n\t\t}\n\n\t\t// Set acceptsOutOfWorkspaceFiles\n\t\tif (result === WorkspaceTrustUriResponse.Open) {\n\t\t\tthis.workspaceTrustManagementService.acceptsOutOfWorkspaceFiles = true;\n\t\t}\n\n\t\t// Save response\n\t\tif (saveResponse) {\n\t\t\tif (result === WorkspaceTrustUriResponse.Open) {\n\t\t\t\tthis.untrustedFilesSetting = 'open';\n\t\t\t}\n\n\t\t\tif (result === WorkspaceTrustUriResponse.OpenInNewWindow) {\n\t\t\t\tthis.untrustedFilesSetting = 'newWindow';\n\t\t\t}\n\t\t}\n\n\t\t// Resolve promise\n\t\tthis._openFilesTrustRequestResolver(result);\n\n\t\tthis._openFilesTrustRequestResolver = undefined;\n\t\tthis._openFilesTrustRequestPromise = undefined;\n\t}\n\n\tasync requestOpenFilesTrust(uris: URI[]): Promise<WorkspaceTrustUriResponse> {\n\t\t// If workspace is untrusted, there is no conflict\n\t\tif (!this.workspaceTrustManagementService.isWorkspaceTrusted()) {\n\t\t\treturn WorkspaceTrustUriResponse.Open;\n\t\t}\n\n\t\tconst openFilesTrustInfo = await Promise.all(uris.map(uri => this.workspaceTrustManagementService.getUriTrustInfo(uri)));\n\n\t\t// If all uris are trusted, there is no conflict\n\t\tif (openFilesTrustInfo.map(info => info.trusted).every(trusted => trusted)) {\n\t\t\treturn WorkspaceTrustUriResponse.Open;\n\t\t}\n\n\t\t// If user has setting, don't need to ask\n\t\tif (this.untrustedFilesSetting !== 'prompt') {\n\t\t\tif (this.untrustedFilesSetting === 'newWindow') {\n\t\t\t\treturn WorkspaceTrustUriResponse.OpenInNewWindow;\n\t\t\t}\n\n\t\t\tif (this.untrustedFilesSetting === 'open') {\n\t\t\t\treturn WorkspaceTrustUriResponse.Open;\n\t\t\t}\n\t\t}\n\n\t\t// If we already asked the user, don't need to ask again\n\t\tif (this.workspaceTrustManagementService.acceptsOutOfWorkspaceFiles) {\n\t\t\treturn WorkspaceTrustUriResponse.Open;\n\t\t}\n\n\t\t// Create/return a promise\n\t\tif (!this._openFilesTrustRequestPromise) {\n\t\t\tthis._openFilesTrustRequestPromise = new Promise<WorkspaceTrustUriResponse>(resolve => {\n\t\t\t\tthis._openFilesTrustRequestResolver = resolve;\n\t\t\t});\n\t\t} else {\n\t\t\treturn this._openFilesTrustRequestPromise;\n\t\t}\n\n\t\tthis._onDidInitiateOpenFilesTrustRequest.fire();\n\t\treturn this._openFilesTrustRequestPromise;\n\t}\n\n\t//#endregion\n\n\t//#region Workspace trust request\n\n\tprivate resolveWorkspaceTrustRequest(trusted?: boolean): void {\n\t\tif (this._workspaceTrustRequestResolver) {\n\t\t\tthis._workspaceTrustRequestResolver(trusted ?? this.workspaceTrustManagementService.isWorkspaceTrusted());\n\n\t\t\tthis._workspaceTrustRequestResolver = undefined;\n\t\t\tthis._workspaceTrustRequestPromise = undefined;\n\t\t}\n\t}\n\n\tcancelWorkspaceTrustRequest(): void {\n\t\tif (this._workspaceTrustRequestResolver) {\n\t\t\tthis._workspaceTrustRequestResolver(undefined);\n\n\t\t\tthis._workspaceTrustRequestResolver = undefined;\n\t\t\tthis._workspaceTrustRequestPromise = undefined;\n\t\t}\n\t}\n\n\tasync completeWorkspaceTrustRequest(trusted?: boolean): Promise<void> {\n\t\tif (trusted === undefined || trusted === this.workspaceTrustManagementService.isWorkspaceTrusted()) {\n\t\t\tthis.resolveWorkspaceTrustRequest(trusted);\n\t\t\treturn;\n\t\t}\n\n\t\t// Register one-time event handler to resolve the promise when workspace trust changed\n\t\tEvent.once(this.workspaceTrustManagementService.onDidChangeTrust)(trusted => this.resolveWorkspaceTrustRequest(trusted));\n\n\t\t// Update storage, transition workspace state\n\t\tawait this.workspaceTrustManagementService.setWorkspaceTrust(trusted);\n\t}\n\n\tasync requestWorkspaceTrust(options?: WorkspaceTrustRequestOptions): Promise<boolean | undefined> {\n\t\t// Trusted workspace\n\t\tif (this.workspaceTrustManagementService.isWorkspaceTrusted()) {\n\t\t\treturn this.workspaceTrustManagementService.isWorkspaceTrusted();\n\t\t}\n\n\t\t// Modal request\n\t\tif (!this._workspaceTrustRequestPromise) {\n\t\t\t// Create promise\n\t\t\tthis._workspaceTrustRequestPromise = new Promise(resolve => {\n\t\t\t\tthis._workspaceTrustRequestResolver = resolve;\n\t\t\t});\n\t\t} else {\n\t\t\t// Return existing promise\n\t\t\treturn this._workspaceTrustRequestPromise;\n\t\t}\n\n\t\tthis._onDidInitiateWorkspaceTrustRequest.fire(options);\n\t\treturn this._workspaceTrustRequestPromise;\n\t}\n\n\trequestWorkspaceTrustOnStartup(): void {\n\t\tif (!this._workspaceTrustRequestPromise) {\n\t\t\t// Create promise\n\t\t\tthis._workspaceTrustRequestPromise = new Promise(resolve => {\n\t\t\t\tthis._workspaceTrustRequestResolver = resolve;\n\t\t\t});\n\t\t}\n\n\t\tthis._onDidInitiateWorkspaceTrustRequestOnStartup.fire();\n\t}\n\n\t//#endregion\n}\n\nclass WorkspaceTrustTransitionManager extends Disposable {\n\n\tprivate readonly participants = new LinkedList<IWorkspaceTrustTransitionParticipant>();\n\n\taddWorkspaceTrustTransitionParticipant(participant: IWorkspaceTrustTransitionParticipant): IDisposable {\n\t\tconst remove = this.participants.push(participant);\n\t\treturn toDisposable(() => remove());\n\t}\n\n\tasync participate(trusted: boolean): Promise<void> {\n\t\tfor (const participant of this.participants) {\n\t\t\tawait participant.participate(trusted);\n\t\t}\n\t}\n\n\toverride dispose(): void {\n\t\tthis.participants.clear();\n\t\tsuper.dispose();\n\t}\n}\n\ninterface WorkspaceTrustMementoData {\n\tacceptsOutOfWorkspaceFiles?: boolean;\n\tisEmptyWorkspaceTrusted?: boolean | undefined;\n}\n\nclass WorkspaceTrustMemento {\n\n\tprivate readonly _memento?: Memento<WorkspaceTrustMementoData>;\n\tprivate readonly _mementoObject: WorkspaceTrustMementoData;\n\n\tprivate readonly _acceptsOutOfWorkspaceFilesKey = 'acceptsOutOfWorkspaceFiles';\n\tprivate readonly _isEmptyWorkspaceTrustedKey = 'isEmptyWorkspaceTrusted';\n\n\tconstructor(storageService?: IStorageService) {\n\t\tif (storageService) {\n\t\t\tthis._memento = new Memento('workspaceTrust', storageService);\n\t\t\tthis._mementoObject = this._memento.getMemento(StorageScope.WORKSPACE, StorageTarget.MACHINE);\n\t\t} else {\n\t\t\tthis._mementoObject = {};\n\t\t}\n\t}\n\n\tget acceptsOutOfWorkspaceFiles(): boolean {\n\t\treturn this._mementoObject[this._acceptsOutOfWorkspaceFilesKey] ?? false;\n\t}\n\n\tset acceptsOutOfWorkspaceFiles(value: boolean) {\n\t\tthis._mementoObject[this._acceptsOutOfWorkspaceFilesKey] = value;\n\n\t\tthis._memento?.saveMemento();\n\t}\n\n\tget isEmptyWorkspaceTrusted(): boolean | undefined {\n\t\treturn this._mementoObject[this._isEmptyWorkspaceTrustedKey];\n\t}\n\n\tset isEmptyWorkspaceTrusted(value: boolean | undefined) {\n\t\tthis._mementoObject[this._isEmptyWorkspaceTrustedKey] = value;\n\n\t\tthis._memento?.saveMemento();\n\t}\n}\n\nregisterSingleton(IWorkspaceTrustRequestService, WorkspaceTrustRequestService, InstantiationType.Delayed);\n"]}