{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/services/search/common/searchExtConversionTypes.ts","vs/workbench/services/search/common/searchExtConversionTypes.ts"],"names":[],"mappings":"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","file":"searchExtConversionTypes.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { asArray, coalesce } from '../../../../base/common/arrays.js';\nimport { CancellationToken } from '../../../../base/common/cancellation.js';\nimport { URI } from '../../../../base/common/uri.js';\nimport { IProgress } from '../../../../platform/progress/common/progress.js';\nimport { DEFAULT_TEXT_SEARCH_PREVIEW_OPTIONS } from './search.js';\nimport { Range, FileSearchProvider2, FileSearchProviderOptions, ProviderResult, TextSearchComplete2, TextSearchContext2, TextSearchMatch2, TextSearchProvider2, TextSearchProviderOptions, TextSearchQuery2, TextSearchResult2, TextSearchCompleteMessage } from './searchExtTypes.js';\n\n// old types that are retained for backward compatibility\n// TODO: delete this when search apis are adopted by all first-party extensions\n\n/**\n * A relative pattern is a helper to construct glob patterns that are matched\n * relatively to a base path. The base path can either be an absolute file path\n * or a [workspace folder](#WorkspaceFolder).\n */\nexport interface RelativePattern {\n\n\t/**\n\t * A base file path to which this pattern will be matched against relatively.\n\t */\n\tbase: string;\n\n\t/**\n\t * A file glob pattern like `*.{ts,js}` that will be matched on file paths\n\t * relative to the base path.\n\t *\n\t * Example: Given a base of `/home/work/folder` and a file path of `/home/work/folder/index.js`,\n\t * the file glob pattern will match on `index.js`.\n\t */\n\tpattern: string;\n}\n\n/**\n * A file glob pattern to match file paths against. This can either be a glob pattern string\n * (like `** /*.{ts,js}` without space before / or `*.{ts,js}`) or a [relative pattern](#RelativePattern).\n *\n * Glob patterns can have the following syntax:\n * * `*` to match zero or more characters in a path segment\n * * `?` to match on one character in a path segment\n * * `**` to match any number of path segments, including none\n * * `{}` to group conditions (e.g. `** /*.{ts,js}` without space before / matches all TypeScript and JavaScript files)\n * * `[]` to declare a range of characters to match in a path segment (e.g., `example.[0-9]` to match on `example.0`, `example.1`, …)\n * * `[!...]` to negate a range of characters to match in a path segment (e.g., `example.[!0-9]` to match on `example.a`, `example.b`, but not `example.0`)\n *\n * Note: a backslash (`\\`) is not valid within a glob pattern. If you have an existing file\n * path to match against, consider to use the [relative pattern](#RelativePattern) support\n * that takes care of converting any backslash into slash. Otherwise, make sure to convert\n * any backslash to slash when creating the glob pattern.\n */\nexport type GlobPattern = string | RelativePattern;\n\n/**\n * The parameters of a query for text search.\n */\nexport interface TextSearchQuery {\n\t/**\n\t * The text pattern to search for.\n\t */\n\tpattern: string;\n\n\t/**\n\t * Whether or not `pattern` should match multiple lines of text.\n\t */\n\tisMultiline?: boolean;\n\n\t/**\n\t * Whether or not `pattern` should be interpreted as a regular expression.\n\t */\n\tisRegExp?: boolean;\n\n\t/**\n\t * Whether or not the search should be case-sensitive.\n\t */\n\tisCaseSensitive?: boolean;\n\n\t/**\n\t * Whether or not to search for whole word matches only.\n\t */\n\tisWordMatch?: boolean;\n}\n\n/**\n * A file glob pattern to match file paths against.\n * TODO@roblou - merge this with the GlobPattern docs/definition in vscode.d.ts.\n * @see [GlobPattern](#GlobPattern)\n */\nexport type GlobString = string;\n\n/**\n * Options common to file and text search\n */\nexport interface SearchOptions {\n\t/**\n\t * The root folder to search within.\n\t */\n\tfolder: URI;\n\n\t/**\n\t * Files that match an `includes` glob pattern should be included in the search.\n\t */\n\tincludes: GlobString[];\n\n\t/**\n\t * Files that match an `excludes` glob pattern should be excluded from the search.\n\t */\n\texcludes: GlobString[];\n\n\t/**\n\t * Whether external files that exclude files, like .gitignore, should be respected.\n\t * See the vscode setting `\"search.useIgnoreFiles\"`.\n\t */\n\tuseIgnoreFiles: boolean;\n\n\t/**\n\t * Whether symlinks should be followed while searching.\n\t * See the vscode setting `\"search.followSymlinks\"`.\n\t */\n\tfollowSymlinks: boolean;\n\n\t/**\n\t * Whether global files that exclude files, like .gitignore, should be respected.\n\t * See the vscode setting `\"search.useGlobalIgnoreFiles\"`.\n\t */\n\tuseGlobalIgnoreFiles: boolean;\n\n\t/**\n\t * Whether files in parent directories that exclude files, like .gitignore, should be respected.\n\t * See the vscode setting `\"search.useParentIgnoreFiles\"`.\n\t */\n\tuseParentIgnoreFiles: boolean;\n}\n\n/**\n * Options to specify the size of the result text preview.\n * These options don't affect the size of the match itself, just the amount of preview text.\n */\nexport interface TextSearchPreviewOptions {\n\t/**\n\t * The maximum number of lines in the preview.\n\t * Only search providers that support multiline search will ever return more than one line in the match.\n\t */\n\tmatchLines: number;\n\n\t/**\n\t * The maximum number of characters included per line.\n\t */\n\tcharsPerLine: number;\n}\n\n/**\n * Options that apply to text search.\n */\nexport interface TextSearchOptions extends SearchOptions {\n\t/**\n\t * The maximum number of results to be returned.\n\t */\n\tmaxResults: number;\n\n\t/**\n\t * Options to specify the size of the result text preview.\n\t */\n\tpreviewOptions?: TextSearchPreviewOptions;\n\n\t/**\n\t * Exclude files larger than `maxFileSize` in bytes.\n\t */\n\tmaxFileSize?: number;\n\n\t/**\n\t * Interpret files using this encoding.\n\t * See the vscode setting `\"files.encoding\"`\n\t */\n\tencoding?: string;\n\n\t/**\n\t * Number of lines of context to include before each match.\n\t */\n\tbeforeContext?: number;\n\n\t/**\n\t * Number of lines of context to include after each match.\n\t */\n\tafterContext?: number;\n}\n/**\n * Options that apply to AI text search.\n */\nexport interface AITextSearchOptions extends SearchOptions {\n\t/**\n\t * The maximum number of results to be returned.\n\t */\n\tmaxResults: number;\n\n\t/**\n\t * Options to specify the size of the result text preview.\n\t */\n\tpreviewOptions?: TextSearchPreviewOptions;\n\n\t/**\n\t * Exclude files larger than `maxFileSize` in bytes.\n\t */\n\tmaxFileSize?: number;\n\n\t/**\n\t * Number of lines of context to include before each match.\n\t */\n\tbeforeContext?: number;\n\n\t/**\n\t * Number of lines of context to include after each match.\n\t */\n\tafterContext?: number;\n}\n\n/**\n * Information collected when text search is complete.\n */\nexport interface TextSearchComplete {\n\t/**\n\t * Whether the search hit the limit on the maximum number of search results.\n\t * `maxResults` on [`TextSearchOptions`](#TextSearchOptions) specifies the max number of results.\n\t * - If exactly that number of matches exist, this should be false.\n\t * - If `maxResults` matches are returned and more exist, this should be true.\n\t * - If search hits an internal limit which is less than `maxResults`, this should be true.\n\t */\n\tlimitHit?: boolean;\n\n\t/**\n\t * Additional information regarding the state of the completed search.\n\t *\n\t * Supports links in markdown syntax:\n\t * - Click to [run a command](command:workbench.action.OpenQuickPick)\n\t * - Click to [open a website](https://aka.ms)\n\t */\n\tmessage?: TextSearchCompleteMessage | TextSearchCompleteMessage[];\n}\n\n/**\n * The parameters of a query for file search.\n */\nexport interface FileSearchQuery {\n\t/**\n\t * The search pattern to match against file paths.\n\t */\n\tpattern: string;\n}\n\n/**\n * Options that apply to file search.\n */\nexport interface FileSearchOptions extends SearchOptions {\n\t/**\n\t * The maximum number of results to be returned.\n\t */\n\tmaxResults?: number;\n\n\t/**\n\t * A CancellationToken that represents the session for this search query. If the provider chooses to, this object can be used as the key for a cache,\n\t * and searches with the same session object can search the same cache. When the token is cancelled, the session is complete and the cache can be cleared.\n\t */\n\tsession?: CancellationToken;\n}\n\n/**\n * A preview of the text result.\n */\nexport interface TextSearchMatchPreview {\n\t/**\n\t * The matching lines of text, or a portion of the matching line that contains the match.\n\t */\n\ttext: string;\n\n\t/**\n\t * The Range within `text` corresponding to the text of the match.\n\t * The number of matches must match the TextSearchMatch's range property.\n\t */\n\tmatches: Range | Range[];\n}\n\n/**\n * A match from a text search\n */\nexport interface TextSearchMatch {\n\t/**\n\t * The uri for the matching document.\n\t */\n\turi: URI;\n\n\t/**\n\t * The range of the match within the document, or multiple ranges for multiple matches.\n\t */\n\tranges: Range | Range[];\n\n\t/**\n\t * A preview of the text match.\n\t */\n\tpreview: TextSearchMatchPreview;\n}\n\n/**\n * Checks if the given object is of type TextSearchMatch.\n * @param object The object to check.\n * @returns True if the object is a TextSearchMatch, false otherwise.\n */\nfunction isTextSearchMatch(object: any): object is TextSearchMatch {\n\treturn 'uri' in object && 'ranges' in object && 'preview' in object;\n}\n\n/**\n * A line of context surrounding a TextSearchMatch.\n */\nexport interface TextSearchContext {\n\t/**\n\t * The uri for the matching document.\n\t */\n\turi: URI;\n\n\t/**\n\t * One line of text.\n\t * previewOptions.charsPerLine applies to this\n\t */\n\ttext: string;\n\n\t/**\n\t * The line number of this line of context.\n\t */\n\tlineNumber: number;\n}\n\nexport type TextSearchResult = TextSearchMatch | TextSearchContext;\n\n/**\n * A FileSearchProvider provides search results for files in the given folder that match a query string. It can be invoked by quickaccess or other extensions.\n *\n * A FileSearchProvider is the more powerful of two ways to implement file search in VS Code. Use a FileSearchProvider if you wish to search within a folder for\n * all files that match the user's query.\n *\n * The FileSearchProvider will be invoked on every keypress in quickaccess. When `workspace.findFiles` is called, it will be invoked with an empty query string,\n * and in that case, every file in the folder should be returned.\n */\nexport interface FileSearchProvider {\n\t/**\n\t * Provide the set of files that match a certain file path pattern.\n\t * @param query The parameters for this query.\n\t * @param options A set of options to consider while searching files.\n\t * @param progress A progress callback that must be invoked for all results.\n\t * @param token A cancellation token.\n\t */\n\tprovideFileSearchResults(query: FileSearchQuery, options: FileSearchOptions, token: CancellationToken): ProviderResult<URI[]>;\n}\n\n/**\n * A TextSearchProvider provides search results for text results inside files in the workspace.\n */\nexport interface TextSearchProvider {\n\t/**\n\t * Provide results that match the given text pattern.\n\t * @param query The parameters for this query.\n\t * @param options A set of options to consider while searching.\n\t * @param progress A progress callback that must be invoked for all results.\n\t * @param token A cancellation token.\n\t */\n\tprovideTextSearchResults(query: TextSearchQuery, options: TextSearchOptions, progress: IProgress<TextSearchResult>, token: CancellationToken): ProviderResult<TextSearchComplete>;\n}\n/**\n * Options that can be set on a findTextInFiles search.\n */\nexport interface FindTextInFilesOptions {\n\t/**\n\t * A [glob pattern](#GlobPattern) that defines the files to search for. The glob pattern\n\t * will be matched against the file paths of files relative to their workspace. Use a [relative pattern](#RelativePattern)\n\t * to restrict the search results to a [workspace folder](#WorkspaceFolder).\n\t */\n\tinclude?: GlobPattern;\n\n\t/**\n\t * A [glob pattern](#GlobPattern) that defines files and folders to exclude. The glob pattern\n\t * will be matched against the file paths of resulting matches relative to their workspace. When `undefined` only default excludes will\n\t * apply, when `null` no excludes will apply.\n\t */\n\texclude?: GlobPattern | null;\n\n\t/**\n\t * The maximum number of results to search for\n\t */\n\tmaxResults?: number;\n\n\t/**\n\t * Whether external files that exclude files, like .gitignore, should be respected.\n\t * See the vscode setting `\"search.useIgnoreFiles\"`.\n\t */\n\tuseIgnoreFiles?: boolean;\n\n\t/**\n\t * Whether global files that exclude files, like .gitignore, should be respected.\n\t * See the vscode setting `\"search.useGlobalIgnoreFiles\"`.\n\t */\n\tuseGlobalIgnoreFiles?: boolean;\n\n\t/**\n\t * Whether files in parent directories that exclude files, like .gitignore, should be respected.\n\t * See the vscode setting `\"search.useParentIgnoreFiles\"`.\n\t */\n\tuseParentIgnoreFiles: boolean;\n\n\t/**\n\t * Whether symlinks should be followed while searching.\n\t * See the vscode setting `\"search.followSymlinks\"`.\n\t */\n\tfollowSymlinks?: boolean;\n\n\t/**\n\t * Interpret files using this encoding.\n\t * See the vscode setting `\"files.encoding\"`\n\t */\n\tencoding?: string;\n\n\t/**\n\t * Options to specify the size of the result text preview.\n\t */\n\tpreviewOptions?: TextSearchPreviewOptions;\n\n\t/**\n\t * Number of lines of context to include before each match.\n\t */\n\tbeforeContext?: number;\n\n\t/**\n\t * Number of lines of context to include after each match.\n\t */\n\tafterContext?: number;\n}\n\nfunction newToOldFileProviderOptions(options: FileSearchProviderOptions): FileSearchOptions[] {\n\treturn options.folderOptions.map(folderOption => ({\n\t\tfolder: folderOption.folder,\n\t\texcludes: folderOption.excludes.map(e => typeof (e) === 'string' ? e : e.pattern),\n\t\tincludes: folderOption.includes,\n\t\tuseGlobalIgnoreFiles: folderOption.useIgnoreFiles.global,\n\t\tuseIgnoreFiles: folderOption.useIgnoreFiles.local,\n\t\tuseParentIgnoreFiles: folderOption.useIgnoreFiles.parent,\n\t\tfollowSymlinks: folderOption.followSymlinks,\n\t\tmaxResults: options.maxResults,\n\t\tsession: <CancellationToken | undefined>options.session // TODO: make sure that we actually use a cancellation token here.\n\t} satisfies FileSearchOptions));\n}\n\nexport class OldFileSearchProviderConverter implements FileSearchProvider2 {\n\tconstructor(private provider: FileSearchProvider) { }\n\n\tprovideFileSearchResults(pattern: string, options: FileSearchProviderOptions, token: CancellationToken): ProviderResult<URI[]> {\n\t\tconst getResult = async () => {\n\t\t\tconst newOpts = newToOldFileProviderOptions(options);\n\t\t\treturn Promise.all(newOpts.map(\n\t\t\t\to => this.provider.provideFileSearchResults({ pattern }, o, token)));\n\t\t};\n\t\treturn getResult().then(e => coalesce(e).flat());\n\t}\n}\n\nfunction newToOldTextProviderOptions(options: TextSearchProviderOptions): TextSearchOptions[] {\n\treturn options.folderOptions.map(folderOption => ({\n\t\tfolder: folderOption.folder,\n\t\texcludes: folderOption.excludes.map(e => typeof (e) === 'string' ? e : e.pattern),\n\t\tincludes: folderOption.includes,\n\t\tuseGlobalIgnoreFiles: folderOption.useIgnoreFiles.global,\n\t\tuseIgnoreFiles: folderOption.useIgnoreFiles.local,\n\t\tuseParentIgnoreFiles: folderOption.useIgnoreFiles.parent,\n\t\tfollowSymlinks: folderOption.followSymlinks,\n\t\tmaxResults: options.maxResults,\n\t\tpreviewOptions: newToOldPreviewOptions(options.previewOptions),\n\t\tmaxFileSize: options.maxFileSize,\n\t\tencoding: folderOption.encoding,\n\t\tafterContext: options.surroundingContext,\n\t\tbeforeContext: options.surroundingContext\n\t} satisfies TextSearchOptions));\n}\n\nexport function newToOldPreviewOptions(options: {\n\tmatchLines?: number;\n\tcharsPerLine?: number;\n} | undefined\n): {\n\tmatchLines: number;\n\tcharsPerLine: number;\n} {\n\treturn {\n\t\tmatchLines: options?.matchLines ?? DEFAULT_TEXT_SEARCH_PREVIEW_OPTIONS.matchLines,\n\t\tcharsPerLine: options?.charsPerLine ?? DEFAULT_TEXT_SEARCH_PREVIEW_OPTIONS.charsPerLine\n\t};\n}\n\nexport function oldToNewTextSearchResult(result: TextSearchResult): TextSearchResult2 {\n\tif (isTextSearchMatch(result)) {\n\t\tconst ranges = asArray(result.ranges).map((r, i) => {\n\t\t\tconst previewArr = asArray(result.preview.matches);\n\t\t\tconst matchingPreviewRange = previewArr[i];\n\t\t\treturn { sourceRange: r, previewRange: matchingPreviewRange };\n\t\t});\n\t\treturn new TextSearchMatch2(result.uri, ranges, result.preview.text);\n\t} else {\n\t\treturn new TextSearchContext2(result.uri, result.text, result.lineNumber);\n\t}\n}\n\nexport class OldTextSearchProviderConverter implements TextSearchProvider2 {\n\tconstructor(private provider: TextSearchProvider) { }\n\n\tprovideTextSearchResults(query: TextSearchQuery2, options: TextSearchProviderOptions, progress: IProgress<TextSearchResult2>, token: CancellationToken): ProviderResult<TextSearchComplete2> {\n\n\t\tconst progressShim = (oldResult: TextSearchResult) => {\n\t\t\tif (!validateProviderResult(oldResult)) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tprogress.report(oldToNewTextSearchResult(oldResult));\n\t\t};\n\n\t\tconst getResult = async () => {\n\t\t\treturn coalesce(await Promise.all(\n\t\t\t\tnewToOldTextProviderOptions(options).map(\n\t\t\t\t\to => this.provider.provideTextSearchResults(query, o, { report: (e) => progressShim(e) }, token))))\n\t\t\t\t.reduce(\n\t\t\t\t\t(prev, cur) => ({ limitHit: prev.limitHit || cur.limitHit }),\n\t\t\t\t\t{ limitHit: false }\n\t\t\t\t);\n\t\t};\n\t\tconst oldResult = getResult();\n\t\treturn oldResult.then((e) => {\n\t\t\treturn {\n\t\t\t\tlimitHit: e.limitHit,\n\t\t\t\tmessage: coalesce(asArray(e.message))\n\t\t\t} satisfies TextSearchComplete2;\n\t\t});\n\t}\n}\n\nfunction validateProviderResult(result: TextSearchResult): boolean {\n\tif (extensionResultIsMatch(result)) {\n\t\tif (Array.isArray(result.ranges)) {\n\t\t\tif (!Array.isArray(result.preview.matches)) {\n\t\t\t\tconsole.warn('INVALID - A text search provider match\\'s`ranges` and`matches` properties must have the same type.');\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif ((<Range[]>result.preview.matches).length !== result.ranges.length) {\n\t\t\t\tconsole.warn('INVALID - A text search provider match\\'s`ranges` and`matches` properties must have the same length.');\n\t\t\t\treturn false;\n\t\t\t}\n\t\t} else {\n\t\t\tif (Array.isArray(result.preview.matches)) {\n\t\t\t\tconsole.warn('INVALID - A text search provider match\\'s`ranges` and`matches` properties must have the same length.');\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\t}\n\n\treturn true;\n}\n\nexport function extensionResultIsMatch(data: TextSearchResult): data is TextSearchMatch {\n\treturn !!(<TextSearchMatch>data).preview;\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { asArray, coalesce } from '../../../../base/common/arrays.js';\nimport { CancellationToken } from '../../../../base/common/cancellation.js';\nimport { URI } from '../../../../base/common/uri.js';\nimport { IProgress } from '../../../../platform/progress/common/progress.js';\nimport { DEFAULT_TEXT_SEARCH_PREVIEW_OPTIONS } from './search.js';\nimport { Range, FileSearchProvider2, FileSearchProviderOptions, ProviderResult, TextSearchComplete2, TextSearchContext2, TextSearchMatch2, TextSearchProvider2, TextSearchProviderOptions, TextSearchQuery2, TextSearchResult2, TextSearchCompleteMessage } from './searchExtTypes.js';\n\n// old types that are retained for backward compatibility\n// TODO: delete this when search apis are adopted by all first-party extensions\n\n/**\n * A relative pattern is a helper to construct glob patterns that are matched\n * relatively to a base path. The base path can either be an absolute file path\n * or a [workspace folder](#WorkspaceFolder).\n */\nexport interface RelativePattern {\n\n\t/**\n\t * A base file path to which this pattern will be matched against relatively.\n\t */\n\tbase: string;\n\n\t/**\n\t * A file glob pattern like `*.{ts,js}` that will be matched on file paths\n\t * relative to the base path.\n\t *\n\t * Example: Given a base of `/home/work/folder` and a file path of `/home/work/folder/index.js`,\n\t * the file glob pattern will match on `index.js`.\n\t */\n\tpattern: string;\n}\n\n/**\n * A file glob pattern to match file paths against. This can either be a glob pattern string\n * (like `** /*.{ts,js}` without space before / or `*.{ts,js}`) or a [relative pattern](#RelativePattern).\n *\n * Glob patterns can have the following syntax:\n * * `*` to match zero or more characters in a path segment\n * * `?` to match on one character in a path segment\n * * `**` to match any number of path segments, including none\n * * `{}` to group conditions (e.g. `** /*.{ts,js}` without space before / matches all TypeScript and JavaScript files)\n * * `[]` to declare a range of characters to match in a path segment (e.g., `example.[0-9]` to match on `example.0`, `example.1`, …)\n * * `[!...]` to negate a range of characters to match in a path segment (e.g., `example.[!0-9]` to match on `example.a`, `example.b`, but not `example.0`)\n *\n * Note: a backslash (`\\`) is not valid within a glob pattern. If you have an existing file\n * path to match against, consider to use the [relative pattern](#RelativePattern) support\n * that takes care of converting any backslash into slash. Otherwise, make sure to convert\n * any backslash to slash when creating the glob pattern.\n */\nexport type GlobPattern = string | RelativePattern;\n\n/**\n * The parameters of a query for text search.\n */\nexport interface TextSearchQuery {\n\t/**\n\t * The text pattern to search for.\n\t */\n\tpattern: string;\n\n\t/**\n\t * Whether or not `pattern` should match multiple lines of text.\n\t */\n\tisMultiline?: boolean;\n\n\t/**\n\t * Whether or not `pattern` should be interpreted as a regular expression.\n\t */\n\tisRegExp?: boolean;\n\n\t/**\n\t * Whether or not the search should be case-sensitive.\n\t */\n\tisCaseSensitive?: boolean;\n\n\t/**\n\t * Whether or not to search for whole word matches only.\n\t */\n\tisWordMatch?: boolean;\n}\n\n/**\n * A file glob pattern to match file paths against.\n * TODO@roblou - merge this with the GlobPattern docs/definition in vscode.d.ts.\n * @see [GlobPattern](#GlobPattern)\n */\nexport type GlobString = string;\n\n/**\n * Options common to file and text search\n */\nexport interface SearchOptions {\n\t/**\n\t * The root folder to search within.\n\t */\n\tfolder: URI;\n\n\t/**\n\t * Files that match an `includes` glob pattern should be included in the search.\n\t */\n\tincludes: GlobString[];\n\n\t/**\n\t * Files that match an `excludes` glob pattern should be excluded from the search.\n\t */\n\texcludes: GlobString[];\n\n\t/**\n\t * Whether external files that exclude files, like .gitignore, should be respected.\n\t * See the vscode setting `\"search.useIgnoreFiles\"`.\n\t */\n\tuseIgnoreFiles: boolean;\n\n\t/**\n\t * Whether symlinks should be followed while searching.\n\t * See the vscode setting `\"search.followSymlinks\"`.\n\t */\n\tfollowSymlinks: boolean;\n\n\t/**\n\t * Whether global files that exclude files, like .gitignore, should be respected.\n\t * See the vscode setting `\"search.useGlobalIgnoreFiles\"`.\n\t */\n\tuseGlobalIgnoreFiles: boolean;\n\n\t/**\n\t * Whether files in parent directories that exclude files, like .gitignore, should be respected.\n\t * See the vscode setting `\"search.useParentIgnoreFiles\"`.\n\t */\n\tuseParentIgnoreFiles: boolean;\n}\n\n/**\n * Options to specify the size of the result text preview.\n * These options don't affect the size of the match itself, just the amount of preview text.\n */\nexport interface TextSearchPreviewOptions {\n\t/**\n\t * The maximum number of lines in the preview.\n\t * Only search providers that support multiline search will ever return more than one line in the match.\n\t */\n\tmatchLines: number;\n\n\t/**\n\t * The maximum number of characters included per line.\n\t */\n\tcharsPerLine: number;\n}\n\n/**\n * Options that apply to text search.\n */\nexport interface TextSearchOptions extends SearchOptions {\n\t/**\n\t * The maximum number of results to be returned.\n\t */\n\tmaxResults: number;\n\n\t/**\n\t * Options to specify the size of the result text preview.\n\t */\n\tpreviewOptions?: TextSearchPreviewOptions;\n\n\t/**\n\t * Exclude files larger than `maxFileSize` in bytes.\n\t */\n\tmaxFileSize?: number;\n\n\t/**\n\t * Interpret files using this encoding.\n\t * See the vscode setting `\"files.encoding\"`\n\t */\n\tencoding?: string;\n\n\t/**\n\t * Number of lines of context to include before each match.\n\t */\n\tbeforeContext?: number;\n\n\t/**\n\t * Number of lines of context to include after each match.\n\t */\n\tafterContext?: number;\n}\n/**\n * Options that apply to AI text search.\n */\nexport interface AITextSearchOptions extends SearchOptions {\n\t/**\n\t * The maximum number of results to be returned.\n\t */\n\tmaxResults: number;\n\n\t/**\n\t * Options to specify the size of the result text preview.\n\t */\n\tpreviewOptions?: TextSearchPreviewOptions;\n\n\t/**\n\t * Exclude files larger than `maxFileSize` in bytes.\n\t */\n\tmaxFileSize?: number;\n\n\t/**\n\t * Number of lines of context to include before each match.\n\t */\n\tbeforeContext?: number;\n\n\t/**\n\t * Number of lines of context to include after each match.\n\t */\n\tafterContext?: number;\n}\n\n/**\n * Information collected when text search is complete.\n */\nexport interface TextSearchComplete {\n\t/**\n\t * Whether the search hit the limit on the maximum number of search results.\n\t * `maxResults` on [`TextSearchOptions`](#TextSearchOptions) specifies the max number of results.\n\t * - If exactly that number of matches exist, this should be false.\n\t * - If `maxResults` matches are returned and more exist, this should be true.\n\t * - If search hits an internal limit which is less than `maxResults`, this should be true.\n\t */\n\tlimitHit?: boolean;\n\n\t/**\n\t * Additional information regarding the state of the completed search.\n\t *\n\t * Supports links in markdown syntax:\n\t * - Click to [run a command](command:workbench.action.OpenQuickPick)\n\t * - Click to [open a website](https://aka.ms)\n\t */\n\tmessage?: TextSearchCompleteMessage | TextSearchCompleteMessage[];\n}\n\n/**\n * The parameters of a query for file search.\n */\nexport interface FileSearchQuery {\n\t/**\n\t * The search pattern to match against file paths.\n\t */\n\tpattern: string;\n}\n\n/**\n * Options that apply to file search.\n */\nexport interface FileSearchOptions extends SearchOptions {\n\t/**\n\t * The maximum number of results to be returned.\n\t */\n\tmaxResults?: number;\n\n\t/**\n\t * A CancellationToken that represents the session for this search query. If the provider chooses to, this object can be used as the key for a cache,\n\t * and searches with the same session object can search the same cache. When the token is cancelled, the session is complete and the cache can be cleared.\n\t */\n\tsession?: CancellationToken;\n}\n\n/**\n * A preview of the text result.\n */\nexport interface TextSearchMatchPreview {\n\t/**\n\t * The matching lines of text, or a portion of the matching line that contains the match.\n\t */\n\ttext: string;\n\n\t/**\n\t * The Range within `text` corresponding to the text of the match.\n\t * The number of matches must match the TextSearchMatch's range property.\n\t */\n\tmatches: Range | Range[];\n}\n\n/**\n * A match from a text search\n */\nexport interface TextSearchMatch {\n\t/**\n\t * The uri for the matching document.\n\t */\n\turi: URI;\n\n\t/**\n\t * The range of the match within the document, or multiple ranges for multiple matches.\n\t */\n\tranges: Range | Range[];\n\n\t/**\n\t * A preview of the text match.\n\t */\n\tpreview: TextSearchMatchPreview;\n}\n\n/**\n * Checks if the given object is of type TextSearchMatch.\n * @param object The object to check.\n * @returns True if the object is a TextSearchMatch, false otherwise.\n */\nfunction isTextSearchMatch(object: any): object is TextSearchMatch {\n\treturn 'uri' in object && 'ranges' in object && 'preview' in object;\n}\n\n/**\n * A line of context surrounding a TextSearchMatch.\n */\nexport interface TextSearchContext {\n\t/**\n\t * The uri for the matching document.\n\t */\n\turi: URI;\n\n\t/**\n\t * One line of text.\n\t * previewOptions.charsPerLine applies to this\n\t */\n\ttext: string;\n\n\t/**\n\t * The line number of this line of context.\n\t */\n\tlineNumber: number;\n}\n\nexport type TextSearchResult = TextSearchMatch | TextSearchContext;\n\n/**\n * A FileSearchProvider provides search results for files in the given folder that match a query string. It can be invoked by quickaccess or other extensions.\n *\n * A FileSearchProvider is the more powerful of two ways to implement file search in VS Code. Use a FileSearchProvider if you wish to search within a folder for\n * all files that match the user's query.\n *\n * The FileSearchProvider will be invoked on every keypress in quickaccess. When `workspace.findFiles` is called, it will be invoked with an empty query string,\n * and in that case, every file in the folder should be returned.\n */\nexport interface FileSearchProvider {\n\t/**\n\t * Provide the set of files that match a certain file path pattern.\n\t * @param query The parameters for this query.\n\t * @param options A set of options to consider while searching files.\n\t * @param progress A progress callback that must be invoked for all results.\n\t * @param token A cancellation token.\n\t */\n\tprovideFileSearchResults(query: FileSearchQuery, options: FileSearchOptions, token: CancellationToken): ProviderResult<URI[]>;\n}\n\n/**\n * A TextSearchProvider provides search results for text results inside files in the workspace.\n */\nexport interface TextSearchProvider {\n\t/**\n\t * Provide results that match the given text pattern.\n\t * @param query The parameters for this query.\n\t * @param options A set of options to consider while searching.\n\t * @param progress A progress callback that must be invoked for all results.\n\t * @param token A cancellation token.\n\t */\n\tprovideTextSearchResults(query: TextSearchQuery, options: TextSearchOptions, progress: IProgress<TextSearchResult>, token: CancellationToken): ProviderResult<TextSearchComplete>;\n}\n/**\n * Options that can be set on a findTextInFiles search.\n */\nexport interface FindTextInFilesOptions {\n\t/**\n\t * A [glob pattern](#GlobPattern) that defines the files to search for. The glob pattern\n\t * will be matched against the file paths of files relative to their workspace. Use a [relative pattern](#RelativePattern)\n\t * to restrict the search results to a [workspace folder](#WorkspaceFolder).\n\t */\n\tinclude?: GlobPattern;\n\n\t/**\n\t * A [glob pattern](#GlobPattern) that defines files and folders to exclude. The glob pattern\n\t * will be matched against the file paths of resulting matches relative to their workspace. When `undefined` only default excludes will\n\t * apply, when `null` no excludes will apply.\n\t */\n\texclude?: GlobPattern | null;\n\n\t/**\n\t * The maximum number of results to search for\n\t */\n\tmaxResults?: number;\n\n\t/**\n\t * Whether external files that exclude files, like .gitignore, should be respected.\n\t * See the vscode setting `\"search.useIgnoreFiles\"`.\n\t */\n\tuseIgnoreFiles?: boolean;\n\n\t/**\n\t * Whether global files that exclude files, like .gitignore, should be respected.\n\t * See the vscode setting `\"search.useGlobalIgnoreFiles\"`.\n\t */\n\tuseGlobalIgnoreFiles?: boolean;\n\n\t/**\n\t * Whether files in parent directories that exclude files, like .gitignore, should be respected.\n\t * See the vscode setting `\"search.useParentIgnoreFiles\"`.\n\t */\n\tuseParentIgnoreFiles: boolean;\n\n\t/**\n\t * Whether symlinks should be followed while searching.\n\t * See the vscode setting `\"search.followSymlinks\"`.\n\t */\n\tfollowSymlinks?: boolean;\n\n\t/**\n\t * Interpret files using this encoding.\n\t * See the vscode setting `\"files.encoding\"`\n\t */\n\tencoding?: string;\n\n\t/**\n\t * Options to specify the size of the result text preview.\n\t */\n\tpreviewOptions?: TextSearchPreviewOptions;\n\n\t/**\n\t * Number of lines of context to include before each match.\n\t */\n\tbeforeContext?: number;\n\n\t/**\n\t * Number of lines of context to include after each match.\n\t */\n\tafterContext?: number;\n}\n\nfunction newToOldFileProviderOptions(options: FileSearchProviderOptions): FileSearchOptions[] {\n\treturn options.folderOptions.map(folderOption => ({\n\t\tfolder: folderOption.folder,\n\t\texcludes: folderOption.excludes.map(e => typeof (e) === 'string' ? e : e.pattern),\n\t\tincludes: folderOption.includes,\n\t\tuseGlobalIgnoreFiles: folderOption.useIgnoreFiles.global,\n\t\tuseIgnoreFiles: folderOption.useIgnoreFiles.local,\n\t\tuseParentIgnoreFiles: folderOption.useIgnoreFiles.parent,\n\t\tfollowSymlinks: folderOption.followSymlinks,\n\t\tmaxResults: options.maxResults,\n\t\tsession: <CancellationToken | undefined>options.session // TODO: make sure that we actually use a cancellation token here.\n\t} satisfies FileSearchOptions));\n}\n\nexport class OldFileSearchProviderConverter implements FileSearchProvider2 {\n\tconstructor(private provider: FileSearchProvider) { }\n\n\tprovideFileSearchResults(pattern: string, options: FileSearchProviderOptions, token: CancellationToken): ProviderResult<URI[]> {\n\t\tconst getResult = async () => {\n\t\t\tconst newOpts = newToOldFileProviderOptions(options);\n\t\t\treturn Promise.all(newOpts.map(\n\t\t\t\to => this.provider.provideFileSearchResults({ pattern }, o, token)));\n\t\t};\n\t\treturn getResult().then(e => coalesce(e).flat());\n\t}\n}\n\nfunction newToOldTextProviderOptions(options: TextSearchProviderOptions): TextSearchOptions[] {\n\treturn options.folderOptions.map(folderOption => ({\n\t\tfolder: folderOption.folder,\n\t\texcludes: folderOption.excludes.map(e => typeof (e) === 'string' ? e : e.pattern),\n\t\tincludes: folderOption.includes,\n\t\tuseGlobalIgnoreFiles: folderOption.useIgnoreFiles.global,\n\t\tuseIgnoreFiles: folderOption.useIgnoreFiles.local,\n\t\tuseParentIgnoreFiles: folderOption.useIgnoreFiles.parent,\n\t\tfollowSymlinks: folderOption.followSymlinks,\n\t\tmaxResults: options.maxResults,\n\t\tpreviewOptions: newToOldPreviewOptions(options.previewOptions),\n\t\tmaxFileSize: options.maxFileSize,\n\t\tencoding: folderOption.encoding,\n\t\tafterContext: options.surroundingContext,\n\t\tbeforeContext: options.surroundingContext\n\t} satisfies TextSearchOptions));\n}\n\nexport function newToOldPreviewOptions(options: {\n\tmatchLines?: number;\n\tcharsPerLine?: number;\n} | undefined\n): {\n\tmatchLines: number;\n\tcharsPerLine: number;\n} {\n\treturn {\n\t\tmatchLines: options?.matchLines ?? DEFAULT_TEXT_SEARCH_PREVIEW_OPTIONS.matchLines,\n\t\tcharsPerLine: options?.charsPerLine ?? DEFAULT_TEXT_SEARCH_PREVIEW_OPTIONS.charsPerLine\n\t};\n}\n\nexport function oldToNewTextSearchResult(result: TextSearchResult): TextSearchResult2 {\n\tif (isTextSearchMatch(result)) {\n\t\tconst ranges = asArray(result.ranges).map((r, i) => {\n\t\t\tconst previewArr = asArray(result.preview.matches);\n\t\t\tconst matchingPreviewRange = previewArr[i];\n\t\t\treturn { sourceRange: r, previewRange: matchingPreviewRange };\n\t\t});\n\t\treturn new TextSearchMatch2(result.uri, ranges, result.preview.text);\n\t} else {\n\t\treturn new TextSearchContext2(result.uri, result.text, result.lineNumber);\n\t}\n}\n\nexport class OldTextSearchProviderConverter implements TextSearchProvider2 {\n\tconstructor(private provider: TextSearchProvider) { }\n\n\tprovideTextSearchResults(query: TextSearchQuery2, options: TextSearchProviderOptions, progress: IProgress<TextSearchResult2>, token: CancellationToken): ProviderResult<TextSearchComplete2> {\n\n\t\tconst progressShim = (oldResult: TextSearchResult) => {\n\t\t\tif (!validateProviderResult(oldResult)) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tprogress.report(oldToNewTextSearchResult(oldResult));\n\t\t};\n\n\t\tconst getResult = async () => {\n\t\t\treturn coalesce(await Promise.all(\n\t\t\t\tnewToOldTextProviderOptions(options).map(\n\t\t\t\t\to => this.provider.provideTextSearchResults(query, o, { report: (e) => progressShim(e) }, token))))\n\t\t\t\t.reduce(\n\t\t\t\t\t(prev, cur) => ({ limitHit: prev.limitHit || cur.limitHit }),\n\t\t\t\t\t{ limitHit: false }\n\t\t\t\t);\n\t\t};\n\t\tconst oldResult = getResult();\n\t\treturn oldResult.then((e) => {\n\t\t\treturn {\n\t\t\t\tlimitHit: e.limitHit,\n\t\t\t\tmessage: coalesce(asArray(e.message))\n\t\t\t} satisfies TextSearchComplete2;\n\t\t});\n\t}\n}\n\nfunction validateProviderResult(result: TextSearchResult): boolean {\n\tif (extensionResultIsMatch(result)) {\n\t\tif (Array.isArray(result.ranges)) {\n\t\t\tif (!Array.isArray(result.preview.matches)) {\n\t\t\t\tconsole.warn('INVALID - A text search provider match\\'s`ranges` and`matches` properties must have the same type.');\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif ((<Range[]>result.preview.matches).length !== result.ranges.length) {\n\t\t\t\tconsole.warn('INVALID - A text search provider match\\'s`ranges` and`matches` properties must have the same length.');\n\t\t\t\treturn false;\n\t\t\t}\n\t\t} else {\n\t\t\tif (Array.isArray(result.preview.matches)) {\n\t\t\t\tconsole.warn('INVALID - A text search provider match\\'s`ranges` and`matches` properties must have the same length.');\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\t}\n\n\treturn true;\n}\n\nexport function extensionResultIsMatch(data: TextSearchResult): data is TextSearchMatch {\n\treturn !!(<TextSearchMatch>data).preview;\n}\n"]}