{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/services/search/test/node/textSearch.integrationTest.ts","vs/workbench/services/search/test/node/textSearch.integrationTest.ts"],"names":[],"mappings":"AAAA;;;gGAGgG;AAEhG,OAAO,MAAM,MAAM,QAAQ,CAAC;AAC5B,OAAO,EAAE,uBAAuB,EAAE,MAAM,4CAA4C,CAAC;AAErF,OAAO,EAAE,UAAU,EAAE,MAAM,uCAAuC,CAAC;AACnE,OAAO,KAAK,IAAI,MAAM,oCAAoC,CAAC;AAC3D,OAAO,EAAE,GAAG,EAAE,MAAM,mCAAmC,CAAC;AACxD,OAAO,EAAE,UAAU,EAAE,MAAM,4CAA4C,CAAC;AACxE,OAAO,EAAE,sBAAsB,EAAiH,eAAe,EAAE,MAAM,wBAAwB,CAAC;AAChM,OAAO,EAAE,uBAAuB,EAAE,MAAM,iCAAiC,CAAC;AAE1E,MAAM,aAAa,GAAG,IAAI,CAAC,SAAS,CAAC,UAAU,CAAC,SAAS,CAAC,iDAAiD,CAAC,CAAC,MAAM,CAAC,CAAC;AACrH,MAAM,iBAAiB,GAAG,IAAI,CAAC,IAAI,CAAC,aAAa,EAAE,UAAU,CAAC,CAAC;AAC/D,MAAM,aAAa,GAAG,IAAI,CAAC,IAAI,CAAC,aAAa,EAAE,MAAM,CAAC,CAAC;AACvD,MAAM,gBAAgB,GAAiB,EAAE,MAAM,EAAE,GAAG,CAAC,IAAI,CAAC,aAAa,CAAC,EAAE,CAAC;AAC3E,MAAM,iBAAiB,GAAmB;IACzC,gBAAgB;CAChB,CAAC;AAEF,MAAM,iBAAiB,GAAmB;IACzC,EAAE,MAAM,EAAE,GAAG,CAAC,IAAI,CAAC,iBAAiB,CAAC,EAAE;IACvC,EAAE,MAAM,EAAE,GAAG,CAAC,IAAI,CAAC,aAAa,CAAC,EAAE;CACnC,CAAC;AAEF,SAAS,YAAY,CAAC,KAAiB,EAAE,mBAAsC;IAC9E,MAAM,MAAM,GAAG,IAAI,uBAAuB,CAAC,KAAK,CAAC,CAAC;IAElD,IAAI,CAAC,GAAG,CAAC,CAAC;IACV,MAAM,OAAO,GAA2B,EAAE,CAAC;IAC3C,OAAO,MAAM,CAAC,MAAM,CAAC,IAAI,uBAAuB,EAAE,CAAC,KAAK,EAAE,QAAQ,CAAC,EAAE;QACpE,IAAI,QAAQ,EAAE,CAAC;YACd,CAAC,IAAI,QAAQ,CAAC,MAAM,CAAC,CAAC,GAAG,EAAE,GAAG,EAAE,EAAE,CAAC,GAAG,GAAG,GAAG,CAAC,UAAW,EAAE,CAAC,CAAC,CAAC;YAC7D,OAAO,CAAC,IAAI,CAAC,GAAG,QAAQ,CAAC,CAAC;QAC3B,CAAC;IACF,CAAC,EAAE,GAAG,EAAE,GAAG,CAAC,CAAC,CAAC,IAAI,CAAC,GAAG,EAAE;QACvB,IAAI,OAAO,mBAAmB,KAAK,UAAU,EAAE,CAAC;YAC/C,MAAM,CAAC,mBAAmB,CAAC,CAAC,CAAC,CAAC,CAAC;QAChC,CAAC;aAAM,CAAC;YACP,MAAM,CAAC,WAAW,CAAC,CAAC,EAAE,mBAAmB,EAAE,MAAM,CAAC,QAAQ,mBAAmB,EAAE,CAAC,CAAC;QAClF,CAAC;QAED,OAAO,OAAO,CAAC;IAChB,CAAC,CAAC,CAAC;AACJ,CAAC;AAED,UAAU,CAAC,wBAAwB,EAAE;IAEpC,IAAI,CAAC,kBAAkB,EAAE,GAAG,EAAE;QAC7B,MAAM,MAAM,GAAe;YAC1B,IAAI,wBAAgB;YACpB,aAAa,EAAE,iBAAiB;YAChC,cAAc,EAAE,EAAE,OAAO,EAAE,YAAY,EAAE;SACzC,CAAC;QAEF,OAAO,YAAY,CAAC,MAAM,EAAE,CAAC,CAAC,CAAC;IAChC,CAAC,CAAC,CAAC;IAEH,IAAI,CAAC,2BAA2B,EAAE,GAAG,EAAE;QACtC,MAAM,MAAM,GAAe;YAC1B,IAAI,wBAAgB;YACpB,aAAa,EAAE,iBAAiB;YAChC,cAAc,EAAE,EAAE,OAAO,EAAE,gBAAgB,EAAE,QAAQ,EAAE,IAAI,EAAE;SAC7D,CAAC;QAEF,OAAO,YAAY,CAAC,MAAM,EAAE,CAAC,CAAC,CAAC;IAChC,CAAC,CAAC,CAAC;IAEH,IAAI,CAAC,6CAA6C,EAAE,GAAG,EAAE;QACxD,MAAM,MAAM,GAAe;YAC1B,IAAI,wBAAgB;YACpB,aAAa,EAAE,iBAAiB;YAChC,cAAc,EAAE,EAAE,OAAO,EAAE,0BAA0B,EAAE,QAAQ,EAAE,IAAI,EAAE;SACvE,CAAC;QAEF,OAAO,YAAY,CAAC,MAAM,EAAE,CAAC,CAAC,CAAC;IAChC,CAAC,CAAC,CAAC;IAEH,IAAI,CAAC,0DAA0D,EAAE,GAAG,EAAE;QACrE,MAAM,MAAM,GAAe;YAC1B,IAAI,wBAAgB;YACpB,aAAa,EAAE,iBAAiB;YAChC,cAAc,EAAE,EAAE,OAAO,EAAE,gCAAgC,EAAE,QAAQ,EAAE,IAAI,EAAE;SAC7E,CAAC;QAEF,OAAO,YAAY,CAAC,MAAM,EAAE,CAAC,CAAC,CAAC;IAChC,CAAC,CAAC,CAAC;IAEH,IAAI,CAAC,iCAAiC,EAAE,GAAG,EAAE;QAC5C,MAAM,MAAM,GAAe;YAC1B,IAAI,wBAAgB;YACpB,aAAa,EAAE,iBAAiB;YAChC,QAAQ,EAAE,IAAI;YACd,cAAc,EAAE,EAAE,OAAO,EAAE,WAAW,EAAE,QAAQ,EAAE,IAAI,EAAE;SACxD,CAAC;QAEF,OAAO,YAAY,CAAC,MAAM,EAAE,CAAC,CAAC,CAAC;IAChC,CAAC,CAAC,CAAC;IAEH,IAAI,CAAC,kCAAkC,EAAE,GAAG,EAAE;QAC7C,MAAM,MAAM,GAAe;YAC1B,IAAI,wBAAgB;YACpB,aAAa,EAAE,iBAAiB;YAChC,cAAc,EAAE,EAAE,OAAO,EAAE,cAAc,EAAE,QAAQ,EAAE,IAAI,EAAE;SAC3D,CAAC;QAEF,OAAO,YAAY,CAAC,MAAM,EAAE,CAAC,CAAC,CAAC;IAChC,CAAC,CAAC,CAAC;IAEH,IAAI,CAAC,+CAA+C,EAAE,GAAG,EAAE;QAC1D,MAAM,MAAM,GAAe;YAC1B,IAAI,wBAAgB;YACpB,aAAa,EAAE,iBAAiB;YAChC,cAAc,EAAE,EAAE,OAAO,EAAE,YAAY,EAAE,WAAW,EAAE,IAAI,EAAE,eAAe,EAAE,IAAI,EAAE;SACnF,CAAC;QAEF,OAAO,YAAY,CAAC,MAAM,EAAE,CAAC,CAAC,CAAC;IAChC,CAAC,CAAC,CAAC;IAEH,IAAI,CAAC,uCAAuC,EAAE,GAAG,EAAE;QAClD,MAAM,MAAM,GAAe;YAC1B,IAAI,wBAAgB;YACpB,aAAa,EAAE,iBAAiB;YAChC,cAAc,EAAE,EAAE,OAAO,EAAE,cAAc,EAAE,WAAW,EAAE,IAAI,EAAE;SAC9D,CAAC;QAEF,OAAO,YAAY,CAAC,MAAM,EAAE,CAAC,CAAC,CAAC;IAChC,CAAC,CAAC,CAAC;IAEH,IAAI,CAAC,uDAAuD,EAAE,GAAG,EAAE;QAClE,MAAM,MAAM,GAAe;YAC1B,IAAI,wBAAgB;YACpB,aAAa,EAAE,iBAAiB;YAChC,cAAc,EAAE,EAAE,OAAO,EAAE,QAAQ,EAAE,WAAW,EAAE,IAAI,EAAE;SACxD,CAAC;QAEF,OAAO,YAAY,CAAC,MAAM,EAAE,CAAC,CAAC,CAAC;IAChC,CAAC,CAAC,CAAC;IAEH,IAAI,CAAC,0BAA0B,EAAE,GAAG,EAAE;QACrC,MAAM,MAAM,GAAe;YAC1B,IAAI,wBAAgB;YACpB,aAAa,EAAE,iBAAiB;YAChC,cAAc,EAAE,EAAE,OAAO,EAAE,WAAW,EAAE;SACxC,CAAC;QAEF,OAAO,YAAY,CAAC,MAAM,EAAE,CAAC,CAAC,CAAC;IAChC,CAAC,CAAC,CAAC;IAEH,IAAI,CAAC,SAAS,EAAE,GAAG,EAAE;QACpB,MAAM,MAAM,GAAe;YAC1B,IAAI,wBAAgB;YACpB,aAAa,EAAE,iBAAiB;YAChC,cAAc,EAAE,EAAE,OAAO,EAAE,GAAG,EAAE;SAChC,CAAC;QAEF,OAAO,YAAY,CAAC,MAAM,EAAE,GAAG,CAAC,CAAC;IAClC,CAAC,CAAC,CAAC;IAEH,IAAI,CAAC,yBAAyB,EAAE,GAAG,EAAE;QACpC,MAAM,MAAM,GAAQ;YACnB,aAAa,EAAE,iBAAiB;YAChC,cAAc,EAAE,EAAE,OAAO,EAAE,GAAG,EAAE;YAChC,cAAc,EAAE,EAAE,aAAa,EAAE,IAAI,EAAE;SACvC,CAAC;QAEF,OAAO,YAAY,CAAC,MAAM,EAAE,GAAG,CAAC,CAAC;IAClC,CAAC,CAAC,CAAC;IAEH,IAAI,CAAC,yBAAyB,EAAE,GAAG,EAAE;QACpC,MAAM,MAAM,GAAQ;YACnB,aAAa,EAAE,iBAAiB;YAChC,cAAc,EAAE,EAAE,OAAO,EAAE,GAAG,EAAE;YAChC,cAAc,EAAE,EAAE,gBAAgB,EAAE,IAAI,EAAE;SAC1C,CAAC;QAEF,OAAO,YAAY,CAAC,MAAM,EAAE,GAAG,CAAC,CAAC;IAClC,CAAC,CAAC,CAAC;IAEH,OAAO;IACP,wDAAwD;IACxD,yBAAyB;IACzB,sCAAsC;IACtC,sCAAsC;IACtC,4EAA4E;IAC5E,MAAM;IAEN,qCAAqC;IACrC,MAAM;IAEN,uEAAuE;IACvE,yBAAyB;IACzB,sCAAsC;IACtC,sCAAsC;IACtC,qFAAqF;IACrF,MAAM;IAEN,qCAAqC;IACrC,MAAM;IAEN,IAAI,CAAC,uBAAuB,EAAE,GAAG,EAAE;QAClC,MAAM,MAAM,GAAQ;YACnB,aAAa,EAAE,iBAAiB;YAChC,cAAc,EAAE,EAAE,OAAO,EAAE,GAAG,EAAE;YAChC,cAAc,EAAE,cAAc,CAAC,UAAU,CAAC;YAC1C,cAAc,EAAE,EAAE,OAAO,EAAE,EAAE,IAAI,EAAE,kBAAkB,EAAE,EAAE;SACzD,CAAC;QAEF,OAAO,YAAY,CAAC,MAAM,EAAE,CAAC,CAAC,CAAC;IAChC,CAAC,CAAC,CAAC;IAEH,IAAI,CAAC,qCAAqC,EAAE,GAAG,EAAE;QAChD,MAAM,MAAM,GAAQ;YACnB,aAAa,EAAE,iBAAiB;YAChC,cAAc,EAAE,EAAE,OAAO,EAAE,GAAG,EAAE;YAChC,cAAc,EAAE,EAAE,gBAAgB,EAAE,IAAI,EAAE;YAC1C,cAAc,EAAE,EAAE,sBAAsB,EAAE,IAAI,EAAE;SAChD,CAAC;QAEF,OAAO,YAAY,CAAC,MAAM,EAAE,GAAG,CAAC,CAAC;IAClC,CAAC,CAAC,CAAC;IAEH,IAAI,CAAC,kBAAkB,EAAE,GAAG,EAAE;QAC7B,MAAM,UAAU,GAAG,GAAG,CAAC;QACvB,MAAM,MAAM,GAAe;YAC1B,IAAI,wBAAgB;YACpB,aAAa,EAAE,iBAAiB;YAChC,cAAc,EAAE,EAAE,OAAO,EAAE,GAAG,EAAE;YAChC,UAAU;SACV,CAAC;QAEF,OAAO,YAAY,CAAC,MAAM,EAAE,UAAU,CAAC,CAAC;IACzC,CAAC,CAAC,CAAC;IAEH,IAAI,CAAC,sBAAsB,EAAE,GAAG,EAAE;QACjC,MAAM,MAAM,GAAe;YAC1B,IAAI,wBAAgB;YACpB,aAAa,EAAE,iBAAiB;YAChC,cAAc,EAAE,EAAE,OAAO,EAAE,aAAa,EAAE;SAC1C,CAAC;QAEF,OAAO,YAAY,CAAC,MAAM,EAAE,CAAC,CAAC,CAAC;IAChC,CAAC,CAAC,CAAC;IAEH,IAAI,CAAC,aAAa,EAAE,GAAG,EAAE;QACxB,MAAM,MAAM,GAAe;YAC1B,IAAI,wBAAgB;YACpB,aAAa,EAAE,iBAAiB;YAChC,cAAc,EAAE,EAAE,OAAO,EAAE,OAAO,EAAE;SACpC,CAAC;QAEF,OAAO,YAAY,CAAC,MAAM,EAAE,CAAC,CAAC,CAAC;IAChC,CAAC,CAAC,CAAC;IAEH,IAAI,CAAC,mBAAmB,EAAE,GAAG,EAAE;QAC9B,MAAM,MAAM,GAAe;YAC1B,IAAI,wBAAgB;YACpB,aAAa,EAAE,iBAAiB;YAChC,cAAc,EAAE,EAAE,OAAO,EAAE,QAAQ,EAAE;SACrC,CAAC;QAEF,OAAO,YAAY,CAAC,MAAM,EAAE,CAAC,CAAC,CAAC;IAChC,CAAC,CAAC,CAAC;IAEH,IAAI,CAAC,0CAA0C,EAAE,GAAG,EAAE;QACrD,MAAM,MAAM,GAAe;YAC1B,IAAI,wBAAgB;YACpB,aAAa,EAAE,iBAAiB;YAChC,cAAc,EAAE,EAAE,OAAO,EAAE,GAAG,EAAE;YAChC,cAAc,EAAE,cAAc,CAAC,UAAU,CAAC;SAC1C,CAAC;QAEF,OAAO,YAAY,CAAC,MAAM,EAAE,GAAG,CAAC,CAAC;IAClC,CAAC,CAAC,CAAC;IAEH,IAAI,CAAC,mCAAmC,EAAE,GAAG,EAAE;QAC9C,MAAM,MAAM,GAAe;YAC1B,IAAI,wBAAgB;YACpB,aAAa,EAAE,iBAAiB;YAChC,cAAc,EAAE,EAAE,OAAO,EAAE,GAAG,EAAE;YAChC,cAAc,EAAE,cAAc,CAAC,UAAU,EAAE,SAAS,CAAC;SACrD,CAAC;QAEF,OAAO,YAAY,CAAC,MAAM,EAAE,CAAC,CAAC,CAAC;IAChC,CAAC,CAAC,CAAC;IAEH,IAAI,CAAC,kCAAkC,EAAE,GAAG,EAAE;QAC7C,MAAM,MAAM,GAAe;YAC1B,IAAI,wBAAgB;YACpB,aAAa,EAAE;gBACd;oBACC,MAAM,EAAE,GAAG,CAAC,IAAI,CAAC,iBAAiB,CAAC,EAAE,cAAc,EAAE,CAAC;4BACrD,OAAO,EAAE,cAAc,CAAC,UAAU,CAAC;yBACnC,CAAC;iBACF;gBACD,EAAE,MAAM,EAAE,GAAG,CAAC,IAAI,CAAC,aAAa,CAAC,EAAE;aACnC;YACD,cAAc,EAAE,EAAE,OAAO,EAAE,GAAG,EAAE;SAChC,CAAC;QAEF,OAAO,YAAY,CAAC,MAAM,EAAE,GAAG,CAAC,CAAC;IAClC,CAAC,CAAC,CAAC;IAEH,IAAI,CAAC,SAAS,EAAE,GAAG,EAAE;QACpB,MAAM,MAAM,GAAe;YAC1B,IAAI,wBAAgB;YACpB,aAAa,EAAE,iBAAiB;YAChC,cAAc,EAAE,EAAE,OAAO,EAAE,GAAG,EAAE;SAChC,CAAC;QAEF,OAAO,YAAY,CAAC,MAAM,EAAE,CAAC,CAAC,CAAC,IAAI,CAAC,OAAO,CAAC,EAAE;YAC7C,MAAM,UAAU,GAAsB,OAAO,CAAC,CAAC,CAAC,CAAC,OAAQ,CAAC,CAAC,CAAE,CAAC,cAAc,CAAC,GAAG,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,MAAM,CAAC,CAAC;YAChG,MAAM,CAAC,eAAe,CAAC,UAAU,EAAE,CAAC;oBACnC,eAAe,EAAE,CAAC;oBAClB,WAAW,EAAE,CAAC;oBACd,aAAa,EAAE,CAAC;oBAChB,SAAS,EAAE,CAAC;iBACZ,CAAC,CAAC,CAAC;QACL,CAAC,CAAC,CAAC;IACJ,CAAC,CAAC,CAAC;IAEH,IAAI,CAAC,iCAAiC,EAAE,GAAG,EAAE;QAC5C,MAAM,MAAM,GAAe;YAC1B,IAAI,wBAAgB;YACpB,aAAa,EAAE,iBAAiB;YAChC,cAAc,EAAE,EAAE,OAAO,EAAE,OAAO,EAAE,QAAQ,EAAE,IAAI,EAAE;SACpD,CAAC;QAEF,OAAO,YAAY,CAAC,MAAM,EAAE,EAAE,CAAC,CAAC,IAAI,CAAC,OAAO,CAAC,EAAE;YAC9C,MAAM,CAAC,WAAW,CAAC,OAAO,CAAC,MAAM,EAAE,CAAC,CAAC,CAAC;YACtC,MAAM,CAAC,WAAW,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC,OAAQ,CAAC,MAAM,EAAE,CAAC,CAAC,CAAC;YAClD,MAAM,KAAK,GAAqB,OAAO,CAAC,CAAC,CAAC,CAAC,OAAQ,CAAC,CAAC,CAAC,CAAC;YACvD,MAAM,CAAC,WAAW,CAAkB,KAAK,CAAC,cAAc,CAAC,GAAG,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,MAAM,CAAE,CAAC,MAAM,EAAE,CAAC,CAAC,CAAC;QACzF,CAAC,CAAC,CAAC;IACJ,CAAC,CAAC,CAAC;IAEH,IAAI,CAAC,6BAA6B,EAAE,GAAG,EAAE;QACxC,MAAM,MAAM,GAAe;YAC1B,IAAI,wBAAgB;YACpB,aAAa,EAAE,iBAAiB;YAChC,cAAc,EAAE,EAAE,OAAO,EAAE,uBAAuB,EAAE;YACpD,kBAAkB,EAAE,CAAC;SACrB,CAAC;QAEF,OAAO,YAAY,CAAC,MAAM,EAAE,CAAC,CAAC,CAAC,IAAI,CAAC,OAAO,CAAC,EAAE;YAC7C,MAAM,CAAC,WAAW,CAAC,OAAO,CAAC,MAAM,EAAE,CAAC,CAAC,CAAC;YACtC,MAAM,CAAC,WAAW,CAAsB,OAAO,CAAC,CAAC,CAAC,CAAC,OAAQ,CAAC,CAAC,CAAE,CAAC,UAAU,EAAE,EAAE,CAAC,CAAC;YAChF,MAAM,CAAC,WAAW,CAAsB,OAAO,CAAC,CAAC,CAAC,CAAC,OAAQ,CAAC,CAAC,CAAE,CAAC,IAAI,EAAE,4CAA4C,CAAC,CAAC;YACpH,0KAA0K;YAC1K,MAAM,CAAC,WAAW,CAAsB,OAAO,CAAC,CAAC,CAAC,CAAC,OAAQ,CAAC,CAAC,CAAE,CAAC,UAAU,EAAE,EAAE,CAAC,CAAC;YAChF,MAAM,CAAC,WAAW,CAAsB,OAAO,CAAC,CAAC,CAAC,CAAC,OAAQ,CAAC,CAAC,CAAE,CAAC,IAAI,EAAE,0BAA0B,CAAC,CAAC;QACnG,CAAC,CAAC,CAAC;IACJ,CAAC,CAAC,CAAC;IAEH,KAAK,CAAC,gBAAgB,EAAE,GAAG,EAAE;QAC5B,IAAI,CAAC,kBAAkB,EAAE,GAAG,EAAE;YAC7B,MAAM,MAAM,GAAe;gBAC1B,IAAI,wBAAgB;gBACpB,aAAa,EAAE;oBACd;wBACC,GAAG,gBAAgB;wBACnB,YAAY,EAAE,iBAAiB;qBAC/B;iBACD;gBACD,cAAc,EAAE,EAAE,OAAO,EAAE,MAAM,EAAE;aACnC,CAAC;YAEF,OAAO,YAAY,CAAC,MAAM,EAAE,CAAC,CAAC,CAAC,IAAI,CAAC,GAAG,EAAE;gBACxC,MAAM,IAAI,KAAK,CAAC,eAAe,CAAC,CAAC;YAClC,CAAC,EAAE,GAAG,CAAC,EAAE;gBACR,MAAM,WAAW,GAAG,sBAAsB,CAAC,GAAG,CAAC,CAAC;gBAChD,MAAM,CAAC,WAAW,CAAC,WAAW,CAAC,OAAO,EAAE,mCAAmC,CAAC,CAAC;gBAC7E,MAAM,CAAC,WAAW,CAAC,WAAW,CAAC,IAAI,EAAE,eAAe,CAAC,eAAe,CAAC,CAAC;YACvE,CAAC,CAAC,CAAC;QACJ,CAAC,CAAC,CAAC;QAEH,IAAI,CAAC,sBAAsB,EAAE,GAAG,EAAE;YACjC,MAAM,MAAM,GAAe;gBAC1B,IAAI,wBAAgB;gBACpB,aAAa,EAAE,iBAAiB;gBAChC,cAAc,EAAE,EAAE,OAAO,EAAE,GAAG,EAAE,QAAQ,EAAE,IAAI,EAAE;aAChD,CAAC;YAEF,OAAO,YAAY,CAAC,MAAM,EAAE,CAAC,CAAC,CAAC,IAAI,CAAC,GAAG,EAAE;gBACxC,MAAM,IAAI,KAAK,CAAC,eAAe,CAAC,CAAC;YAClC,CAAC,EAAE,GAAG,CAAC,EAAE;gBACR,MAAM,WAAW,GAAG,sBAAsB,CAAC,GAAG,CAAC,CAAC;gBAChD,MAAM,qCAAqC,GAAG,kDAAkD,CAAC;gBACjG,MAAM,CAAC,WAAW,CAAC,WAAW,CAAC,OAAO,EAAE,qCAAqC,CAAC,CAAC;gBAC/E,MAAM,CAAC,WAAW,CAAC,WAAW,CAAC,IAAI,EAAE,eAAe,CAAC,eAAe,CAAC,CAAC;YACvE,CAAC,CAAC,CAAC;QACJ,CAAC,CAAC,CAAC;QAEH,IAAI,CAAC,sBAAsB,EAAE,GAAG,EAAE;YACjC,MAAM,MAAM,GAAe;gBAC1B,IAAI,wBAAgB;gBACpB,aAAa,EAAE,iBAAiB;gBAChC,cAAc,EAAE,EAAE,OAAO,EAAE,UAAU,EAAE,QAAQ,EAAE,IAAI,EAAE;aACvD,CAAC;YAEF,OAAO,YAAY,CAAC,MAAM,EAAE,CAAC,CAAC,CAAC,IAAI,CAAC,GAAG,EAAE;gBACxC,MAAM,IAAI,KAAK,CAAC,eAAe,CAAC,CAAC;YAClC,CAAC,EAAE,GAAG,CAAC,EAAE;gBACR,MAAM,WAAW,GAAG,sBAAsB,CAAC,GAAG,CAAC,CAAC;gBAChD,MAAM,4BAA4B,GAAG,kEAAkE,CAAC;gBACxG,MAAM,CAAC,WAAW,CAAC,WAAW,CAAC,OAAO,EAAE,4BAA4B,CAAC,CAAC;gBACtE,MAAM,CAAC,WAAW,CAAC,WAAW,CAAC,IAAI,EAAE,eAAe,CAAC,eAAe,CAAC,CAAC;YACvE,CAAC,CAAC,CAAC;QACJ,CAAC,CAAC,CAAC;QAGH,IAAI,CAAC,cAAc,EAAE,GAAG,EAAE;YACzB,MAAM,MAAM,GAAe;gBAC1B,IAAI,wBAAgB;gBACpB,aAAa,EAAE,iBAAiB;gBAChC,cAAc,EAAE,EAAE,OAAO,EAAE,KAAK,EAAE;gBAClC,cAAc,EAAE;oBACf,KAAK,EAAE,IAAI;iBACX;aACD,CAAC;YAEF,OAAO,YAAY,CAAC,MAAM,EAAE,CAAC,CAAC,CAAC,IAAI,CAAC,GAAG,EAAE;gBACxC,MAAM,IAAI,KAAK,CAAC,eAAe,CAAC,CAAC;YAClC,CAAC,EAAE,GAAG,CAAC,EAAE;gBACR,MAAM,WAAW,GAAG,sBAAsB,CAAC,GAAG,CAAC,CAAC;gBAChD,MAAM,CAAC,WAAW,CAAC,WAAW,CAAC,OAAO,EAAE,sEAAsE,CAAC,CAAC;gBAChH,MAAM,CAAC,WAAW,CAAC,WAAW,CAAC,IAAI,EAAE,eAAe,CAAC,cAAc,CAAC,CAAC;YACtE,CAAC,CAAC,CAAC;QACJ,CAAC,CAAC,CAAC;IACJ,CAAC,CAAC,CAAC;AACJ,CAAC,CAAC,CAAC;AAEH,SAAS,cAAc,CAAC,GAAG,QAAkB;IAC5C,OAAO,QAAQ,CAAC,MAAM,CAAC,CAAC,IAAI,EAAE,OAAO,EAAE,EAAE;QACxC,gCAAgC;QAChC,OAAO,GAAG,OAAO,CAAC,OAAO,CAAC,KAAK,EAAE,GAAG,CAAC,CAAC;QACtC,IAAI,CAAC,OAAO,CAAC,GAAG,IAAI,CAAC;QACrB,OAAO,IAAI,CAAC;IACb,CAAC,EAAE,MAAM,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC,CAAC;AACzB,CAAC","file":"textSearch.integrationTest.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport assert from 'assert';\nimport { CancellationTokenSource } from '../../../../../base/common/cancellation.js';\nimport * as glob from '../../../../../base/common/glob.js';\nimport { FileAccess } from '../../../../../base/common/network.js';\nimport * as path from '../../../../../base/common/path.js';\nimport { URI } from '../../../../../base/common/uri.js';\nimport { flakySuite } from '../../../../../base/test/node/testUtils.js';\nimport { deserializeSearchError, IFolderQuery, ISearchRange, ISerializedFileMatch, ITextQuery, ITextSearchContext, ITextSearchMatch, QueryType, SearchErrorCode } from '../../common/search.js';\nimport { TextSearchEngineAdapter } from '../../node/textSearchAdapter.js';\n\nconst TEST_FIXTURES = path.normalize(FileAccess.asFileUri('vs/workbench/services/search/test/node/fixtures').fsPath);\nconst EXAMPLES_FIXTURES = path.join(TEST_FIXTURES, 'examples');\nconst MORE_FIXTURES = path.join(TEST_FIXTURES, 'more');\nconst TEST_ROOT_FOLDER: IFolderQuery = { folder: URI.file(TEST_FIXTURES) };\nconst ROOT_FOLDER_QUERY: IFolderQuery[] = [\n\tTEST_ROOT_FOLDER\n];\n\nconst MULTIROOT_QUERIES: IFolderQuery[] = [\n\t{ folder: URI.file(EXAMPLES_FIXTURES) },\n\t{ folder: URI.file(MORE_FIXTURES) }\n];\n\nfunction doSearchTest(query: ITextQuery, expectedResultCount: number | Function): Promise<ISerializedFileMatch[]> {\n\tconst engine = new TextSearchEngineAdapter(query);\n\n\tlet c = 0;\n\tconst results: ISerializedFileMatch[] = [];\n\treturn engine.search(new CancellationTokenSource().token, _results => {\n\t\tif (_results) {\n\t\t\tc += _results.reduce((acc, cur) => acc + cur.numMatches!, 0);\n\t\t\tresults.push(..._results);\n\t\t}\n\t}, () => { }).then(() => {\n\t\tif (typeof expectedResultCount === 'function') {\n\t\t\tassert(expectedResultCount(c));\n\t\t} else {\n\t\t\tassert.strictEqual(c, expectedResultCount, `rg ${c} !== ${expectedResultCount}`);\n\t\t}\n\n\t\treturn results;\n\t});\n}\n\nflakySuite('TextSearch-integration', function () {\n\n\ttest('Text: GameOfLife', () => {\n\t\tconst config: ITextQuery = {\n\t\t\ttype: QueryType.Text,\n\t\t\tfolderQueries: ROOT_FOLDER_QUERY,\n\t\t\tcontentPattern: { pattern: 'GameOfLife' },\n\t\t};\n\n\t\treturn doSearchTest(config, 4);\n\t});\n\n\ttest('Text: GameOfLife (RegExp)', () => {\n\t\tconst config: ITextQuery = {\n\t\t\ttype: QueryType.Text,\n\t\t\tfolderQueries: ROOT_FOLDER_QUERY,\n\t\t\tcontentPattern: { pattern: 'Game.?fL\\\\w?fe', isRegExp: true }\n\t\t};\n\n\t\treturn doSearchTest(config, 4);\n\t});\n\n\ttest('Text: GameOfLife (unicode escape sequences)', () => {\n\t\tconst config: ITextQuery = {\n\t\t\ttype: QueryType.Text,\n\t\t\tfolderQueries: ROOT_FOLDER_QUERY,\n\t\t\tcontentPattern: { pattern: 'G\\\\u{0061}m\\\\u0065OfLife', isRegExp: true }\n\t\t};\n\n\t\treturn doSearchTest(config, 4);\n\t});\n\n\ttest('Text: GameOfLife (unicode escape sequences, force PCRE2)', () => {\n\t\tconst config: ITextQuery = {\n\t\t\ttype: QueryType.Text,\n\t\t\tfolderQueries: ROOT_FOLDER_QUERY,\n\t\t\tcontentPattern: { pattern: '(?<!a)G\\\\u{0061}m\\\\u0065OfLife', isRegExp: true }\n\t\t};\n\n\t\treturn doSearchTest(config, 4);\n\t});\n\n\ttest('Text: GameOfLife (PCRE2 RegExp)', () => {\n\t\tconst config: ITextQuery = {\n\t\t\ttype: QueryType.Text,\n\t\t\tfolderQueries: ROOT_FOLDER_QUERY,\n\t\t\tusePCRE2: true,\n\t\t\tcontentPattern: { pattern: 'Life(?!P)', isRegExp: true }\n\t\t};\n\n\t\treturn doSearchTest(config, 8);\n\t});\n\n\ttest('Text: GameOfLife (RegExp to EOL)', () => {\n\t\tconst config: ITextQuery = {\n\t\t\ttype: QueryType.Text,\n\t\t\tfolderQueries: ROOT_FOLDER_QUERY,\n\t\t\tcontentPattern: { pattern: 'GameOfLife.*', isRegExp: true }\n\t\t};\n\n\t\treturn doSearchTest(config, 4);\n\t});\n\n\ttest('Text: GameOfLife (Word Match, Case Sensitive)', () => {\n\t\tconst config: ITextQuery = {\n\t\t\ttype: QueryType.Text,\n\t\t\tfolderQueries: ROOT_FOLDER_QUERY,\n\t\t\tcontentPattern: { pattern: 'GameOfLife', isWordMatch: true, isCaseSensitive: true }\n\t\t};\n\n\t\treturn doSearchTest(config, 4);\n\t});\n\n\ttest('Text: GameOfLife (Word Match, Spaces)', () => {\n\t\tconst config: ITextQuery = {\n\t\t\ttype: QueryType.Text,\n\t\t\tfolderQueries: ROOT_FOLDER_QUERY,\n\t\t\tcontentPattern: { pattern: ' GameOfLife ', isWordMatch: true }\n\t\t};\n\n\t\treturn doSearchTest(config, 1);\n\t});\n\n\ttest('Text: GameOfLife (Word Match, Punctuation and Spaces)', () => {\n\t\tconst config: ITextQuery = {\n\t\t\ttype: QueryType.Text,\n\t\t\tfolderQueries: ROOT_FOLDER_QUERY,\n\t\t\tcontentPattern: { pattern: ', as =', isWordMatch: true }\n\t\t};\n\n\t\treturn doSearchTest(config, 1);\n\t});\n\n\ttest('Text: Helvetica (UTF 16)', () => {\n\t\tconst config: ITextQuery = {\n\t\t\ttype: QueryType.Text,\n\t\t\tfolderQueries: ROOT_FOLDER_QUERY,\n\t\t\tcontentPattern: { pattern: 'Helvetica' }\n\t\t};\n\n\t\treturn doSearchTest(config, 3);\n\t});\n\n\ttest('Text: e', () => {\n\t\tconst config: ITextQuery = {\n\t\t\ttype: QueryType.Text,\n\t\t\tfolderQueries: ROOT_FOLDER_QUERY,\n\t\t\tcontentPattern: { pattern: 'e' }\n\t\t};\n\n\t\treturn doSearchTest(config, 785);\n\t});\n\n\ttest('Text: e (with excludes)', () => {\n\t\tconst config: any = {\n\t\t\tfolderQueries: ROOT_FOLDER_QUERY,\n\t\t\tcontentPattern: { pattern: 'e' },\n\t\t\texcludePattern: { '**/examples': true }\n\t\t};\n\n\t\treturn doSearchTest(config, 391);\n\t});\n\n\ttest('Text: e (with includes)', () => {\n\t\tconst config: any = {\n\t\t\tfolderQueries: ROOT_FOLDER_QUERY,\n\t\t\tcontentPattern: { pattern: 'e' },\n\t\t\tincludePattern: { '**/examples/**': true }\n\t\t};\n\n\t\treturn doSearchTest(config, 394);\n\t});\n\n\t// TODO\n\t// test('Text: e (with absolute path excludes)', () => {\n\t// \tconst config: any = {\n\t// \t\tfolderQueries: ROOT_FOLDER_QUERY,\n\t// \t\tcontentPattern: { pattern: 'e' },\n\t// \t\texcludePattern: makeExpression(path.join(TEST_FIXTURES, '**/examples'))\n\t// \t};\n\n\t// \treturn doSearchTest(config, 394);\n\t// });\n\n\t// test('Text: e (with mixed absolute/relative path excludes)', () => {\n\t// \tconst config: any = {\n\t// \t\tfolderQueries: ROOT_FOLDER_QUERY,\n\t// \t\tcontentPattern: { pattern: 'e' },\n\t// \t\texcludePattern: makeExpression(path.join(TEST_FIXTURES, '**/examples'), '*.css')\n\t// \t};\n\n\t// \treturn doSearchTest(config, 310);\n\t// });\n\n\ttest('Text: sibling exclude', () => {\n\t\tconst config: any = {\n\t\t\tfolderQueries: ROOT_FOLDER_QUERY,\n\t\t\tcontentPattern: { pattern: 'm' },\n\t\t\tincludePattern: makeExpression('**/site*'),\n\t\t\texcludePattern: { '*.css': { when: '$(basename).less' } }\n\t\t};\n\n\t\treturn doSearchTest(config, 1);\n\t});\n\n\ttest('Text: e (with includes and exclude)', () => {\n\t\tconst config: any = {\n\t\t\tfolderQueries: ROOT_FOLDER_QUERY,\n\t\t\tcontentPattern: { pattern: 'e' },\n\t\t\tincludePattern: { '**/examples/**': true },\n\t\t\texcludePattern: { '**/examples/small.js': true }\n\t\t};\n\n\t\treturn doSearchTest(config, 371);\n\t});\n\n\ttest('Text: a (capped)', () => {\n\t\tconst maxResults = 520;\n\t\tconst config: ITextQuery = {\n\t\t\ttype: QueryType.Text,\n\t\t\tfolderQueries: ROOT_FOLDER_QUERY,\n\t\t\tcontentPattern: { pattern: 'a' },\n\t\t\tmaxResults\n\t\t};\n\n\t\treturn doSearchTest(config, maxResults);\n\t});\n\n\ttest('Text: a (no results)', () => {\n\t\tconst config: ITextQuery = {\n\t\t\ttype: QueryType.Text,\n\t\t\tfolderQueries: ROOT_FOLDER_QUERY,\n\t\t\tcontentPattern: { pattern: 'ahsogehtdas' }\n\t\t};\n\n\t\treturn doSearchTest(config, 0);\n\t});\n\n\ttest('Text: -size', () => {\n\t\tconst config: ITextQuery = {\n\t\t\ttype: QueryType.Text,\n\t\t\tfolderQueries: ROOT_FOLDER_QUERY,\n\t\t\tcontentPattern: { pattern: '-size' }\n\t\t};\n\n\t\treturn doSearchTest(config, 9);\n\t});\n\n\ttest('Multiroot: Conway', () => {\n\t\tconst config: ITextQuery = {\n\t\t\ttype: QueryType.Text,\n\t\t\tfolderQueries: MULTIROOT_QUERIES,\n\t\t\tcontentPattern: { pattern: 'conway' }\n\t\t};\n\n\t\treturn doSearchTest(config, 8);\n\t});\n\n\ttest('Multiroot: e with partial global exclude', () => {\n\t\tconst config: ITextQuery = {\n\t\t\ttype: QueryType.Text,\n\t\t\tfolderQueries: MULTIROOT_QUERIES,\n\t\t\tcontentPattern: { pattern: 'e' },\n\t\t\texcludePattern: makeExpression('**/*.txt')\n\t\t};\n\n\t\treturn doSearchTest(config, 394);\n\t});\n\n\ttest('Multiroot: e with global excludes', () => {\n\t\tconst config: ITextQuery = {\n\t\t\ttype: QueryType.Text,\n\t\t\tfolderQueries: MULTIROOT_QUERIES,\n\t\t\tcontentPattern: { pattern: 'e' },\n\t\t\texcludePattern: makeExpression('**/*.txt', '**/*.js')\n\t\t};\n\n\t\treturn doSearchTest(config, 0);\n\t});\n\n\ttest('Multiroot: e with folder exclude', () => {\n\t\tconst config: ITextQuery = {\n\t\t\ttype: QueryType.Text,\n\t\t\tfolderQueries: [\n\t\t\t\t{\n\t\t\t\t\tfolder: URI.file(EXAMPLES_FIXTURES), excludePattern: [{\n\t\t\t\t\t\tpattern: makeExpression('**/e*.js')\n\t\t\t\t\t}]\n\t\t\t\t},\n\t\t\t\t{ folder: URI.file(MORE_FIXTURES) }\n\t\t\t],\n\t\t\tcontentPattern: { pattern: 'e' }\n\t\t};\n\n\t\treturn doSearchTest(config, 298);\n\t});\n\n\ttest('Text: 语', () => {\n\t\tconst config: ITextQuery = {\n\t\t\ttype: QueryType.Text,\n\t\t\tfolderQueries: ROOT_FOLDER_QUERY,\n\t\t\tcontentPattern: { pattern: '语' }\n\t\t};\n\n\t\treturn doSearchTest(config, 1).then(results => {\n\t\t\tconst matchRange = (<ITextSearchMatch>results[0].results![0]).rangeLocations.map(e => e.source);\n\t\t\tassert.deepStrictEqual(matchRange, [{\n\t\t\t\tstartLineNumber: 0,\n\t\t\t\tstartColumn: 1,\n\t\t\t\tendLineNumber: 0,\n\t\t\t\tendColumn: 2\n\t\t\t}]);\n\t\t});\n\t});\n\n\ttest('Multiple matches on line: h\\\\d,', () => {\n\t\tconst config: ITextQuery = {\n\t\t\ttype: QueryType.Text,\n\t\t\tfolderQueries: ROOT_FOLDER_QUERY,\n\t\t\tcontentPattern: { pattern: 'h\\\\d,', isRegExp: true }\n\t\t};\n\n\t\treturn doSearchTest(config, 15).then(results => {\n\t\t\tassert.strictEqual(results.length, 3);\n\t\t\tassert.strictEqual(results[0].results!.length, 1);\n\t\t\tconst match = <ITextSearchMatch>results[0].results![0];\n\t\t\tassert.strictEqual((<ISearchRange[]>match.rangeLocations.map(e => e.source)).length, 5);\n\t\t});\n\t});\n\n\ttest('Search with context matches', () => {\n\t\tconst config: ITextQuery = {\n\t\t\ttype: QueryType.Text,\n\t\t\tfolderQueries: ROOT_FOLDER_QUERY,\n\t\t\tcontentPattern: { pattern: 'compiler.typeCheck();' },\n\t\t\tsurroundingContext: 1,\n\t\t};\n\n\t\treturn doSearchTest(config, 3).then(results => {\n\t\t\tassert.strictEqual(results.length, 3);\n\t\t\tassert.strictEqual((<ITextSearchContext>results[0].results![0]).lineNumber, 24);\n\t\t\tassert.strictEqual((<ITextSearchContext>results[0].results![0]).text, '        compiler.addUnit(prog,\"input.ts\");');\n\t\t\t// assert.strictEqual((<ITextSearchMatch>results[1].results[0]).preview.text, '        compiler.typeCheck();\\n'); // See https://github.com/BurntSushi/ripgrep/issues/1095\n\t\t\tassert.strictEqual((<ITextSearchContext>results[2].results![0]).lineNumber, 26);\n\t\t\tassert.strictEqual((<ITextSearchContext>results[2].results![0]).text, '        compiler.emit();');\n\t\t});\n\t});\n\n\tsuite('error messages', () => {\n\t\ttest('invalid encoding', () => {\n\t\t\tconst config: ITextQuery = {\n\t\t\t\ttype: QueryType.Text,\n\t\t\t\tfolderQueries: [\n\t\t\t\t\t{\n\t\t\t\t\t\t...TEST_ROOT_FOLDER,\n\t\t\t\t\t\tfileEncoding: 'invalidEncoding'\n\t\t\t\t\t}\n\t\t\t\t],\n\t\t\t\tcontentPattern: { pattern: 'test' },\n\t\t\t};\n\n\t\t\treturn doSearchTest(config, 0).then(() => {\n\t\t\t\tthrow new Error('expected fail');\n\t\t\t}, err => {\n\t\t\t\tconst searchError = deserializeSearchError(err);\n\t\t\t\tassert.strictEqual(searchError.message, 'Unknown encoding: invalidEncoding');\n\t\t\t\tassert.strictEqual(searchError.code, SearchErrorCode.unknownEncoding);\n\t\t\t});\n\t\t});\n\n\t\ttest('invalid regex case 1', () => {\n\t\t\tconst config: ITextQuery = {\n\t\t\t\ttype: QueryType.Text,\n\t\t\t\tfolderQueries: ROOT_FOLDER_QUERY,\n\t\t\t\tcontentPattern: { pattern: ')', isRegExp: true },\n\t\t\t};\n\n\t\t\treturn doSearchTest(config, 0).then(() => {\n\t\t\t\tthrow new Error('expected fail');\n\t\t\t}, err => {\n\t\t\t\tconst searchError = deserializeSearchError(err);\n\t\t\t\tconst regexParseErrorForUnclosedParenthesis = 'Regex parse error: unmatched closing parenthesis';\n\t\t\t\tassert.strictEqual(searchError.message, regexParseErrorForUnclosedParenthesis);\n\t\t\t\tassert.strictEqual(searchError.code, SearchErrorCode.regexParseError);\n\t\t\t});\n\t\t});\n\n\t\ttest('invalid regex case 2', () => {\n\t\t\tconst config: ITextQuery = {\n\t\t\t\ttype: QueryType.Text,\n\t\t\t\tfolderQueries: ROOT_FOLDER_QUERY,\n\t\t\t\tcontentPattern: { pattern: '(?<!a.*)', isRegExp: true },\n\t\t\t};\n\n\t\t\treturn doSearchTest(config, 0).then(() => {\n\t\t\t\tthrow new Error('expected fail');\n\t\t\t}, err => {\n\t\t\t\tconst searchError = deserializeSearchError(err);\n\t\t\t\tconst regexParseErrorForLookAround = 'Regex parse error: length of lookbehind assertion is not limited';\n\t\t\t\tassert.strictEqual(searchError.message, regexParseErrorForLookAround);\n\t\t\t\tassert.strictEqual(searchError.code, SearchErrorCode.regexParseError);\n\t\t\t});\n\t\t});\n\n\n\t\ttest('invalid glob', () => {\n\t\t\tconst config: ITextQuery = {\n\t\t\t\ttype: QueryType.Text,\n\t\t\t\tfolderQueries: ROOT_FOLDER_QUERY,\n\t\t\t\tcontentPattern: { pattern: 'foo' },\n\t\t\t\tincludePattern: {\n\t\t\t\t\t'{{}': true\n\t\t\t\t}\n\t\t\t};\n\n\t\t\treturn doSearchTest(config, 0).then(() => {\n\t\t\t\tthrow new Error('expected fail');\n\t\t\t}, err => {\n\t\t\t\tconst searchError = deserializeSearchError(err);\n\t\t\t\tassert.strictEqual(searchError.message, 'Error parsing glob \\'/{{}\\': nested alternate groups are not allowed');\n\t\t\t\tassert.strictEqual(searchError.code, SearchErrorCode.globParseError);\n\t\t\t});\n\t\t});\n\t});\n});\n\nfunction makeExpression(...patterns: string[]): glob.IExpression {\n\treturn patterns.reduce((glob, pattern) => {\n\t\t// glob.ts needs forward slashes\n\t\tpattern = pattern.replace(/\\\\/g, '/');\n\t\tglob[pattern] = true;\n\t\treturn glob;\n\t}, Object.create(null));\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport assert from 'assert';\nimport { CancellationTokenSource } from '../../../../../base/common/cancellation.js';\nimport * as glob from '../../../../../base/common/glob.js';\nimport { FileAccess } from '../../../../../base/common/network.js';\nimport * as path from '../../../../../base/common/path.js';\nimport { URI } from '../../../../../base/common/uri.js';\nimport { flakySuite } from '../../../../../base/test/node/testUtils.js';\nimport { deserializeSearchError, IFolderQuery, ISearchRange, ISerializedFileMatch, ITextQuery, ITextSearchContext, ITextSearchMatch, QueryType, SearchErrorCode } from '../../common/search.js';\nimport { TextSearchEngineAdapter } from '../../node/textSearchAdapter.js';\n\nconst TEST_FIXTURES = path.normalize(FileAccess.asFileUri('vs/workbench/services/search/test/node/fixtures').fsPath);\nconst EXAMPLES_FIXTURES = path.join(TEST_FIXTURES, 'examples');\nconst MORE_FIXTURES = path.join(TEST_FIXTURES, 'more');\nconst TEST_ROOT_FOLDER: IFolderQuery = { folder: URI.file(TEST_FIXTURES) };\nconst ROOT_FOLDER_QUERY: IFolderQuery[] = [\n\tTEST_ROOT_FOLDER\n];\n\nconst MULTIROOT_QUERIES: IFolderQuery[] = [\n\t{ folder: URI.file(EXAMPLES_FIXTURES) },\n\t{ folder: URI.file(MORE_FIXTURES) }\n];\n\nfunction doSearchTest(query: ITextQuery, expectedResultCount: number | Function): Promise<ISerializedFileMatch[]> {\n\tconst engine = new TextSearchEngineAdapter(query);\n\n\tlet c = 0;\n\tconst results: ISerializedFileMatch[] = [];\n\treturn engine.search(new CancellationTokenSource().token, _results => {\n\t\tif (_results) {\n\t\t\tc += _results.reduce((acc, cur) => acc + cur.numMatches!, 0);\n\t\t\tresults.push(..._results);\n\t\t}\n\t}, () => { }).then(() => {\n\t\tif (typeof expectedResultCount === 'function') {\n\t\t\tassert(expectedResultCount(c));\n\t\t} else {\n\t\t\tassert.strictEqual(c, expectedResultCount, `rg ${c} !== ${expectedResultCount}`);\n\t\t}\n\n\t\treturn results;\n\t});\n}\n\nflakySuite('TextSearch-integration', function () {\n\n\ttest('Text: GameOfLife', () => {\n\t\tconst config: ITextQuery = {\n\t\t\ttype: QueryType.Text,\n\t\t\tfolderQueries: ROOT_FOLDER_QUERY,\n\t\t\tcontentPattern: { pattern: 'GameOfLife' },\n\t\t};\n\n\t\treturn doSearchTest(config, 4);\n\t});\n\n\ttest('Text: GameOfLife (RegExp)', () => {\n\t\tconst config: ITextQuery = {\n\t\t\ttype: QueryType.Text,\n\t\t\tfolderQueries: ROOT_FOLDER_QUERY,\n\t\t\tcontentPattern: { pattern: 'Game.?fL\\\\w?fe', isRegExp: true }\n\t\t};\n\n\t\treturn doSearchTest(config, 4);\n\t});\n\n\ttest('Text: GameOfLife (unicode escape sequences)', () => {\n\t\tconst config: ITextQuery = {\n\t\t\ttype: QueryType.Text,\n\t\t\tfolderQueries: ROOT_FOLDER_QUERY,\n\t\t\tcontentPattern: { pattern: 'G\\\\u{0061}m\\\\u0065OfLife', isRegExp: true }\n\t\t};\n\n\t\treturn doSearchTest(config, 4);\n\t});\n\n\ttest('Text: GameOfLife (unicode escape sequences, force PCRE2)', () => {\n\t\tconst config: ITextQuery = {\n\t\t\ttype: QueryType.Text,\n\t\t\tfolderQueries: ROOT_FOLDER_QUERY,\n\t\t\tcontentPattern: { pattern: '(?<!a)G\\\\u{0061}m\\\\u0065OfLife', isRegExp: true }\n\t\t};\n\n\t\treturn doSearchTest(config, 4);\n\t});\n\n\ttest('Text: GameOfLife (PCRE2 RegExp)', () => {\n\t\tconst config: ITextQuery = {\n\t\t\ttype: QueryType.Text,\n\t\t\tfolderQueries: ROOT_FOLDER_QUERY,\n\t\t\tusePCRE2: true,\n\t\t\tcontentPattern: { pattern: 'Life(?!P)', isRegExp: true }\n\t\t};\n\n\t\treturn doSearchTest(config, 8);\n\t});\n\n\ttest('Text: GameOfLife (RegExp to EOL)', () => {\n\t\tconst config: ITextQuery = {\n\t\t\ttype: QueryType.Text,\n\t\t\tfolderQueries: ROOT_FOLDER_QUERY,\n\t\t\tcontentPattern: { pattern: 'GameOfLife.*', isRegExp: true }\n\t\t};\n\n\t\treturn doSearchTest(config, 4);\n\t});\n\n\ttest('Text: GameOfLife (Word Match, Case Sensitive)', () => {\n\t\tconst config: ITextQuery = {\n\t\t\ttype: QueryType.Text,\n\t\t\tfolderQueries: ROOT_FOLDER_QUERY,\n\t\t\tcontentPattern: { pattern: 'GameOfLife', isWordMatch: true, isCaseSensitive: true }\n\t\t};\n\n\t\treturn doSearchTest(config, 4);\n\t});\n\n\ttest('Text: GameOfLife (Word Match, Spaces)', () => {\n\t\tconst config: ITextQuery = {\n\t\t\ttype: QueryType.Text,\n\t\t\tfolderQueries: ROOT_FOLDER_QUERY,\n\t\t\tcontentPattern: { pattern: ' GameOfLife ', isWordMatch: true }\n\t\t};\n\n\t\treturn doSearchTest(config, 1);\n\t});\n\n\ttest('Text: GameOfLife (Word Match, Punctuation and Spaces)', () => {\n\t\tconst config: ITextQuery = {\n\t\t\ttype: QueryType.Text,\n\t\t\tfolderQueries: ROOT_FOLDER_QUERY,\n\t\t\tcontentPattern: { pattern: ', as =', isWordMatch: true }\n\t\t};\n\n\t\treturn doSearchTest(config, 1);\n\t});\n\n\ttest('Text: Helvetica (UTF 16)', () => {\n\t\tconst config: ITextQuery = {\n\t\t\ttype: QueryType.Text,\n\t\t\tfolderQueries: ROOT_FOLDER_QUERY,\n\t\t\tcontentPattern: { pattern: 'Helvetica' }\n\t\t};\n\n\t\treturn doSearchTest(config, 3);\n\t});\n\n\ttest('Text: e', () => {\n\t\tconst config: ITextQuery = {\n\t\t\ttype: QueryType.Text,\n\t\t\tfolderQueries: ROOT_FOLDER_QUERY,\n\t\t\tcontentPattern: { pattern: 'e' }\n\t\t};\n\n\t\treturn doSearchTest(config, 785);\n\t});\n\n\ttest('Text: e (with excludes)', () => {\n\t\tconst config: any = {\n\t\t\tfolderQueries: ROOT_FOLDER_QUERY,\n\t\t\tcontentPattern: { pattern: 'e' },\n\t\t\texcludePattern: { '**/examples': true }\n\t\t};\n\n\t\treturn doSearchTest(config, 391);\n\t});\n\n\ttest('Text: e (with includes)', () => {\n\t\tconst config: any = {\n\t\t\tfolderQueries: ROOT_FOLDER_QUERY,\n\t\t\tcontentPattern: { pattern: 'e' },\n\t\t\tincludePattern: { '**/examples/**': true }\n\t\t};\n\n\t\treturn doSearchTest(config, 394);\n\t});\n\n\t// TODO\n\t// test('Text: e (with absolute path excludes)', () => {\n\t// \tconst config: any = {\n\t// \t\tfolderQueries: ROOT_FOLDER_QUERY,\n\t// \t\tcontentPattern: { pattern: 'e' },\n\t// \t\texcludePattern: makeExpression(path.join(TEST_FIXTURES, '**/examples'))\n\t// \t};\n\n\t// \treturn doSearchTest(config, 394);\n\t// });\n\n\t// test('Text: e (with mixed absolute/relative path excludes)', () => {\n\t// \tconst config: any = {\n\t// \t\tfolderQueries: ROOT_FOLDER_QUERY,\n\t// \t\tcontentPattern: { pattern: 'e' },\n\t// \t\texcludePattern: makeExpression(path.join(TEST_FIXTURES, '**/examples'), '*.css')\n\t// \t};\n\n\t// \treturn doSearchTest(config, 310);\n\t// });\n\n\ttest('Text: sibling exclude', () => {\n\t\tconst config: any = {\n\t\t\tfolderQueries: ROOT_FOLDER_QUERY,\n\t\t\tcontentPattern: { pattern: 'm' },\n\t\t\tincludePattern: makeExpression('**/site*'),\n\t\t\texcludePattern: { '*.css': { when: '$(basename).less' } }\n\t\t};\n\n\t\treturn doSearchTest(config, 1);\n\t});\n\n\ttest('Text: e (with includes and exclude)', () => {\n\t\tconst config: any = {\n\t\t\tfolderQueries: ROOT_FOLDER_QUERY,\n\t\t\tcontentPattern: { pattern: 'e' },\n\t\t\tincludePattern: { '**/examples/**': true },\n\t\t\texcludePattern: { '**/examples/small.js': true }\n\t\t};\n\n\t\treturn doSearchTest(config, 371);\n\t});\n\n\ttest('Text: a (capped)', () => {\n\t\tconst maxResults = 520;\n\t\tconst config: ITextQuery = {\n\t\t\ttype: QueryType.Text,\n\t\t\tfolderQueries: ROOT_FOLDER_QUERY,\n\t\t\tcontentPattern: { pattern: 'a' },\n\t\t\tmaxResults\n\t\t};\n\n\t\treturn doSearchTest(config, maxResults);\n\t});\n\n\ttest('Text: a (no results)', () => {\n\t\tconst config: ITextQuery = {\n\t\t\ttype: QueryType.Text,\n\t\t\tfolderQueries: ROOT_FOLDER_QUERY,\n\t\t\tcontentPattern: { pattern: 'ahsogehtdas' }\n\t\t};\n\n\t\treturn doSearchTest(config, 0);\n\t});\n\n\ttest('Text: -size', () => {\n\t\tconst config: ITextQuery = {\n\t\t\ttype: QueryType.Text,\n\t\t\tfolderQueries: ROOT_FOLDER_QUERY,\n\t\t\tcontentPattern: { pattern: '-size' }\n\t\t};\n\n\t\treturn doSearchTest(config, 9);\n\t});\n\n\ttest('Multiroot: Conway', () => {\n\t\tconst config: ITextQuery = {\n\t\t\ttype: QueryType.Text,\n\t\t\tfolderQueries: MULTIROOT_QUERIES,\n\t\t\tcontentPattern: { pattern: 'conway' }\n\t\t};\n\n\t\treturn doSearchTest(config, 8);\n\t});\n\n\ttest('Multiroot: e with partial global exclude', () => {\n\t\tconst config: ITextQuery = {\n\t\t\ttype: QueryType.Text,\n\t\t\tfolderQueries: MULTIROOT_QUERIES,\n\t\t\tcontentPattern: { pattern: 'e' },\n\t\t\texcludePattern: makeExpression('**/*.txt')\n\t\t};\n\n\t\treturn doSearchTest(config, 394);\n\t});\n\n\ttest('Multiroot: e with global excludes', () => {\n\t\tconst config: ITextQuery = {\n\t\t\ttype: QueryType.Text,\n\t\t\tfolderQueries: MULTIROOT_QUERIES,\n\t\t\tcontentPattern: { pattern: 'e' },\n\t\t\texcludePattern: makeExpression('**/*.txt', '**/*.js')\n\t\t};\n\n\t\treturn doSearchTest(config, 0);\n\t});\n\n\ttest('Multiroot: e with folder exclude', () => {\n\t\tconst config: ITextQuery = {\n\t\t\ttype: QueryType.Text,\n\t\t\tfolderQueries: [\n\t\t\t\t{\n\t\t\t\t\tfolder: URI.file(EXAMPLES_FIXTURES), excludePattern: [{\n\t\t\t\t\t\tpattern: makeExpression('**/e*.js')\n\t\t\t\t\t}]\n\t\t\t\t},\n\t\t\t\t{ folder: URI.file(MORE_FIXTURES) }\n\t\t\t],\n\t\t\tcontentPattern: { pattern: 'e' }\n\t\t};\n\n\t\treturn doSearchTest(config, 298);\n\t});\n\n\ttest('Text: 语', () => {\n\t\tconst config: ITextQuery = {\n\t\t\ttype: QueryType.Text,\n\t\t\tfolderQueries: ROOT_FOLDER_QUERY,\n\t\t\tcontentPattern: { pattern: '语' }\n\t\t};\n\n\t\treturn doSearchTest(config, 1).then(results => {\n\t\t\tconst matchRange = (<ITextSearchMatch>results[0].results![0]).rangeLocations.map(e => e.source);\n\t\t\tassert.deepStrictEqual(matchRange, [{\n\t\t\t\tstartLineNumber: 0,\n\t\t\t\tstartColumn: 1,\n\t\t\t\tendLineNumber: 0,\n\t\t\t\tendColumn: 2\n\t\t\t}]);\n\t\t});\n\t});\n\n\ttest('Multiple matches on line: h\\\\d,', () => {\n\t\tconst config: ITextQuery = {\n\t\t\ttype: QueryType.Text,\n\t\t\tfolderQueries: ROOT_FOLDER_QUERY,\n\t\t\tcontentPattern: { pattern: 'h\\\\d,', isRegExp: true }\n\t\t};\n\n\t\treturn doSearchTest(config, 15).then(results => {\n\t\t\tassert.strictEqual(results.length, 3);\n\t\t\tassert.strictEqual(results[0].results!.length, 1);\n\t\t\tconst match = <ITextSearchMatch>results[0].results![0];\n\t\t\tassert.strictEqual((<ISearchRange[]>match.rangeLocations.map(e => e.source)).length, 5);\n\t\t});\n\t});\n\n\ttest('Search with context matches', () => {\n\t\tconst config: ITextQuery = {\n\t\t\ttype: QueryType.Text,\n\t\t\tfolderQueries: ROOT_FOLDER_QUERY,\n\t\t\tcontentPattern: { pattern: 'compiler.typeCheck();' },\n\t\t\tsurroundingContext: 1,\n\t\t};\n\n\t\treturn doSearchTest(config, 3).then(results => {\n\t\t\tassert.strictEqual(results.length, 3);\n\t\t\tassert.strictEqual((<ITextSearchContext>results[0].results![0]).lineNumber, 24);\n\t\t\tassert.strictEqual((<ITextSearchContext>results[0].results![0]).text, '        compiler.addUnit(prog,\"input.ts\");');\n\t\t\t// assert.strictEqual((<ITextSearchMatch>results[1].results[0]).preview.text, '        compiler.typeCheck();\\n'); // See https://github.com/BurntSushi/ripgrep/issues/1095\n\t\t\tassert.strictEqual((<ITextSearchContext>results[2].results![0]).lineNumber, 26);\n\t\t\tassert.strictEqual((<ITextSearchContext>results[2].results![0]).text, '        compiler.emit();');\n\t\t});\n\t});\n\n\tsuite('error messages', () => {\n\t\ttest('invalid encoding', () => {\n\t\t\tconst config: ITextQuery = {\n\t\t\t\ttype: QueryType.Text,\n\t\t\t\tfolderQueries: [\n\t\t\t\t\t{\n\t\t\t\t\t\t...TEST_ROOT_FOLDER,\n\t\t\t\t\t\tfileEncoding: 'invalidEncoding'\n\t\t\t\t\t}\n\t\t\t\t],\n\t\t\t\tcontentPattern: { pattern: 'test' },\n\t\t\t};\n\n\t\t\treturn doSearchTest(config, 0).then(() => {\n\t\t\t\tthrow new Error('expected fail');\n\t\t\t}, err => {\n\t\t\t\tconst searchError = deserializeSearchError(err);\n\t\t\t\tassert.strictEqual(searchError.message, 'Unknown encoding: invalidEncoding');\n\t\t\t\tassert.strictEqual(searchError.code, SearchErrorCode.unknownEncoding);\n\t\t\t});\n\t\t});\n\n\t\ttest('invalid regex case 1', () => {\n\t\t\tconst config: ITextQuery = {\n\t\t\t\ttype: QueryType.Text,\n\t\t\t\tfolderQueries: ROOT_FOLDER_QUERY,\n\t\t\t\tcontentPattern: { pattern: ')', isRegExp: true },\n\t\t\t};\n\n\t\t\treturn doSearchTest(config, 0).then(() => {\n\t\t\t\tthrow new Error('expected fail');\n\t\t\t}, err => {\n\t\t\t\tconst searchError = deserializeSearchError(err);\n\t\t\t\tconst regexParseErrorForUnclosedParenthesis = 'Regex parse error: unmatched closing parenthesis';\n\t\t\t\tassert.strictEqual(searchError.message, regexParseErrorForUnclosedParenthesis);\n\t\t\t\tassert.strictEqual(searchError.code, SearchErrorCode.regexParseError);\n\t\t\t});\n\t\t});\n\n\t\ttest('invalid regex case 2', () => {\n\t\t\tconst config: ITextQuery = {\n\t\t\t\ttype: QueryType.Text,\n\t\t\t\tfolderQueries: ROOT_FOLDER_QUERY,\n\t\t\t\tcontentPattern: { pattern: '(?<!a.*)', isRegExp: true },\n\t\t\t};\n\n\t\t\treturn doSearchTest(config, 0).then(() => {\n\t\t\t\tthrow new Error('expected fail');\n\t\t\t}, err => {\n\t\t\t\tconst searchError = deserializeSearchError(err);\n\t\t\t\tconst regexParseErrorForLookAround = 'Regex parse error: length of lookbehind assertion is not limited';\n\t\t\t\tassert.strictEqual(searchError.message, regexParseErrorForLookAround);\n\t\t\t\tassert.strictEqual(searchError.code, SearchErrorCode.regexParseError);\n\t\t\t});\n\t\t});\n\n\n\t\ttest('invalid glob', () => {\n\t\t\tconst config: ITextQuery = {\n\t\t\t\ttype: QueryType.Text,\n\t\t\t\tfolderQueries: ROOT_FOLDER_QUERY,\n\t\t\t\tcontentPattern: { pattern: 'foo' },\n\t\t\t\tincludePattern: {\n\t\t\t\t\t'{{}': true\n\t\t\t\t}\n\t\t\t};\n\n\t\t\treturn doSearchTest(config, 0).then(() => {\n\t\t\t\tthrow new Error('expected fail');\n\t\t\t}, err => {\n\t\t\t\tconst searchError = deserializeSearchError(err);\n\t\t\t\tassert.strictEqual(searchError.message, 'Error parsing glob \\'/{{}\\': nested alternate groups are not allowed');\n\t\t\t\tassert.strictEqual(searchError.code, SearchErrorCode.globParseError);\n\t\t\t});\n\t\t});\n\t});\n});\n\nfunction makeExpression(...patterns: string[]): glob.IExpression {\n\treturn patterns.reduce((glob, pattern) => {\n\t\t// glob.ts needs forward slashes\n\t\tpattern = pattern.replace(/\\\\/g, '/');\n\t\tglob[pattern] = true;\n\t\treturn glob;\n\t}, Object.create(null));\n}\n"]}