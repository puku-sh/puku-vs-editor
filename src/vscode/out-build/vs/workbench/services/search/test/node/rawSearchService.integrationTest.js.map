{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/services/search/test/node/rawSearchService.integrationTest.ts","vs/workbench/services/search/test/node/rawSearchService.integrationTest.ts"],"names":[],"mappings":"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","file":"rawSearchService.integrationTest.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport assert from 'assert';\nimport { CancelablePromise, createCancelablePromise } from '../../../../../base/common/async.js';\nimport { Emitter, Event } from '../../../../../base/common/event.js';\nimport { IDisposable } from '../../../../../base/common/lifecycle.js';\nimport { FileAccess } from '../../../../../base/common/network.js';\nimport * as path from '../../../../../base/common/path.js';\nimport { URI } from '../../../../../base/common/uri.js';\nimport { flakySuite } from '../../../../../base/test/node/testUtils.js';\nimport { IFileQuery, IFileSearchStats, IFolderQuery, IProgressMessage, IRawFileMatch, ISearchEngine, ISearchEngineStats, ISearchEngineSuccess, ISerializedFileMatch, ISerializedSearchComplete, ISerializedSearchProgressItem, ISerializedSearchSuccess, isSerializedSearchComplete, isSerializedSearchSuccess, QueryType } from '../../common/search.js';\nimport { IProgressCallback, SearchService as RawSearchService } from '../../node/rawSearchService.js';\n\nconst TEST_FOLDER_QUERIES = [\n\t{ folder: URI.file(path.normalize('/some/where')) }\n];\n\nconst TEST_FIXTURES = path.normalize(FileAccess.asFileUri('vs/workbench/services/search/test/node/fixtures').fsPath);\nconst MULTIROOT_QUERIES: IFolderQuery[] = [\n\t{ folder: URI.file(path.join(TEST_FIXTURES, 'examples')) },\n\t{ folder: URI.file(path.join(TEST_FIXTURES, 'more')) }\n];\n\nconst stats: ISearchEngineStats = {\n\tfileWalkTime: 0,\n\tcmdTime: 1,\n\tdirectoriesWalked: 2,\n\tfilesWalked: 3\n};\n\nclass TestSearchEngine implements ISearchEngine<IRawFileMatch> {\n\n\tstatic last: TestSearchEngine;\n\n\tprivate isCanceled = false;\n\n\tconstructor(private result: () => IRawFileMatch | null, public config?: IFileQuery) {\n\t\tTestSearchEngine.last = this;\n\t}\n\n\tsearch(onResult: (match: IRawFileMatch) => void, onProgress: (progress: IProgressMessage) => void, done: (error: Error, complete: ISearchEngineSuccess) => void): void {\n\t\tconst self = this;\n\t\t(function next() {\n\t\t\tprocess.nextTick(() => {\n\t\t\t\tif (self.isCanceled) {\n\t\t\t\t\tdone(null!, {\n\t\t\t\t\t\tlimitHit: false,\n\t\t\t\t\t\tstats: stats,\n\t\t\t\t\t\tmessages: [],\n\t\t\t\t\t});\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tconst result = self.result();\n\t\t\t\tif (!result) {\n\t\t\t\t\tdone(null!, {\n\t\t\t\t\t\tlimitHit: false,\n\t\t\t\t\t\tstats: stats,\n\t\t\t\t\t\tmessages: [],\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tonResult(result);\n\t\t\t\t\tnext();\n\t\t\t\t}\n\t\t\t});\n\t\t})();\n\t}\n\n\tcancel(): void {\n\t\tthis.isCanceled = true;\n\t}\n}\n\nflakySuite('RawSearchService', () => {\n\n\tconst rawSearch: IFileQuery = {\n\t\ttype: QueryType.File,\n\t\tfolderQueries: TEST_FOLDER_QUERIES,\n\t\tfilePattern: 'a'\n\t};\n\n\tconst rawMatch: IRawFileMatch = {\n\t\tbase: path.normalize('/some'),\n\t\trelativePath: 'where',\n\t\tsearchPath: undefined\n\t};\n\n\tconst match: ISerializedFileMatch = {\n\t\tpath: path.normalize('/some/where')\n\t};\n\n\ttest('Individual results', async function () {\n\t\tlet i = 5;\n\t\tconst Engine = TestSearchEngine.bind(null, () => i-- ? rawMatch : null);\n\t\tconst service = new RawSearchService();\n\n\t\tlet results = 0;\n\t\tconst cb: (p: ISerializedSearchProgressItem) => void = value => {\n\t\t\tif (!!(<IProgressMessage>value).message) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (!Array.isArray(value)) {\n\t\t\t\tassert.deepStrictEqual(value, match);\n\t\t\t\tresults++;\n\t\t\t} else {\n\t\t\t\tassert.fail(JSON.stringify(value));\n\t\t\t}\n\t\t};\n\n\t\tawait service.doFileSearchWithEngine(Engine, rawSearch, cb, null!, 0);\n\t\treturn assert.strictEqual(results, 5);\n\t});\n\n\ttest('Batch results', async function () {\n\t\tlet i = 25;\n\t\tconst Engine = TestSearchEngine.bind(null, () => i-- ? rawMatch : null);\n\t\tconst service = new RawSearchService();\n\n\t\tconst results: number[] = [];\n\t\tconst cb: (p: ISerializedSearchProgressItem) => void = value => {\n\t\t\tif (!!(<IProgressMessage>value).message) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (Array.isArray(value)) {\n\t\t\t\tvalue.forEach(m => {\n\t\t\t\t\tassert.deepStrictEqual(m, match);\n\t\t\t\t});\n\t\t\t\tresults.push(value.length);\n\t\t\t} else {\n\t\t\t\tassert.fail(JSON.stringify(value));\n\t\t\t}\n\t\t};\n\n\t\tawait service.doFileSearchWithEngine(Engine, rawSearch, cb, undefined, 10);\n\t\tassert.deepStrictEqual(results, [10, 10, 5]);\n\t});\n\n\ttest('Collect batched results', async function () {\n\t\tconst uriPath = '/some/where';\n\t\tlet i = 25;\n\t\tconst Engine = TestSearchEngine.bind(null, () => i-- ? rawMatch : null);\n\t\tconst service = new RawSearchService();\n\n\t\tfunction fileSearch(config: IFileQuery, batchSize: number): Event<ISerializedSearchProgressItem | ISerializedSearchComplete> {\n\t\t\tlet promise: CancelablePromise<ISerializedSearchSuccess | void>;\n\n\t\t\tconst emitter = new Emitter<ISerializedSearchProgressItem | ISerializedSearchComplete>({\n\t\t\t\tonWillAddFirstListener: () => {\n\t\t\t\t\tpromise = createCancelablePromise(token => service.doFileSearchWithEngine(Engine, config, p => emitter.fire(p), token, batchSize)\n\t\t\t\t\t\t.then(c => emitter.fire(c), err => emitter.fire({ type: 'error', error: err })));\n\t\t\t\t},\n\t\t\t\tonDidRemoveLastListener: () => {\n\t\t\t\t\tpromise.cancel();\n\t\t\t\t}\n\t\t\t});\n\n\t\t\treturn emitter.event;\n\t\t}\n\n\t\tconst result = await collectResultsFromEvent(fileSearch(rawSearch, 10));\n\t\tresult.files.forEach(f => {\n\t\t\tassert.strictEqual(f.path.replace(/\\\\/g, '/'), uriPath);\n\t\t});\n\t\tassert.strictEqual(result.files.length, 25, 'Result');\n\t});\n\n\ttest('Multi-root with include pattern and maxResults', async function () {\n\t\tconst service = new RawSearchService();\n\n\t\tconst query: IFileQuery = {\n\t\t\ttype: QueryType.File,\n\t\t\tfolderQueries: MULTIROOT_QUERIES,\n\t\t\tmaxResults: 1,\n\t\t\tincludePattern: {\n\t\t\t\t'*.txt': true,\n\t\t\t\t'*.js': true\n\t\t\t},\n\t\t};\n\n\t\tconst result = await collectResultsFromEvent(service.fileSearch(query));\n\t\tassert.strictEqual(result.files.length, 1, 'Result');\n\t});\n\n\ttest('Handles maxResults=0 correctly', async function () {\n\t\tconst service = new RawSearchService();\n\n\t\tconst query: IFileQuery = {\n\t\t\ttype: QueryType.File,\n\t\t\tfolderQueries: MULTIROOT_QUERIES,\n\t\t\tmaxResults: 0,\n\t\t\tsortByScore: true,\n\t\t\tincludePattern: {\n\t\t\t\t'*.txt': true,\n\t\t\t\t'*.js': true\n\t\t\t},\n\t\t};\n\n\t\tconst result = await collectResultsFromEvent(service.fileSearch(query));\n\t\tassert.strictEqual(result.files.length, 0, 'Result');\n\t});\n\n\ttest('Multi-root with include pattern and exists', async function () {\n\t\tconst service = new RawSearchService();\n\n\t\tconst query: IFileQuery = {\n\t\t\ttype: QueryType.File,\n\t\t\tfolderQueries: MULTIROOT_QUERIES,\n\t\t\texists: true,\n\t\t\tincludePattern: {\n\t\t\t\t'*.txt': true,\n\t\t\t\t'*.js': true\n\t\t\t},\n\t\t};\n\n\t\tconst result = await collectResultsFromEvent(service.fileSearch(query));\n\t\tassert.strictEqual(result.files.length, 0, 'Result');\n\t\tassert.ok(result.limitHit);\n\t});\n\n\ttest('Sorted results', async function () {\n\t\tconst paths = ['bab', 'bbc', 'abb'];\n\t\tconst matches: IRawFileMatch[] = paths.map(relativePath => ({\n\t\t\tbase: path.normalize('/some/where'),\n\t\t\trelativePath,\n\t\t\tbasename: relativePath,\n\t\t\tsize: 3,\n\t\t\tsearchPath: undefined\n\t\t}));\n\t\tconst Engine = TestSearchEngine.bind(null, () => matches.shift()!);\n\t\tconst service = new RawSearchService();\n\n\t\tconst results: any[] = [];\n\t\tconst cb: IProgressCallback = value => {\n\t\t\tif (!!(<IProgressMessage>value).message) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (Array.isArray(value)) {\n\t\t\t\tresults.push(...value.map(v => v.path));\n\t\t\t} else {\n\t\t\t\tassert.fail(JSON.stringify(value));\n\t\t\t}\n\t\t};\n\n\t\tawait service.doFileSearchWithEngine(Engine, {\n\t\t\ttype: QueryType.File,\n\t\t\tfolderQueries: TEST_FOLDER_QUERIES,\n\t\t\tfilePattern: 'bb',\n\t\t\tsortByScore: true,\n\t\t\tmaxResults: 2\n\t\t}, cb, undefined, 1);\n\t\tassert.notStrictEqual(typeof TestSearchEngine.last.config!.maxResults, 'number');\n\t\tassert.deepStrictEqual(results, [path.normalize('/some/where/bbc'), path.normalize('/some/where/bab')]);\n\t});\n\n\ttest('Sorted result batches', async function () {\n\t\tlet i = 25;\n\t\tconst Engine = TestSearchEngine.bind(null, () => i-- ? rawMatch : null);\n\t\tconst service = new RawSearchService();\n\n\t\tconst results: number[] = [];\n\t\tconst cb: IProgressCallback = value => {\n\t\t\tif (!!(<IProgressMessage>value).message) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (Array.isArray(value)) {\n\t\t\t\tvalue.forEach(m => {\n\t\t\t\t\tassert.deepStrictEqual(m, match);\n\t\t\t\t});\n\t\t\t\tresults.push(value.length);\n\t\t\t} else {\n\t\t\t\tassert.fail(JSON.stringify(value));\n\t\t\t}\n\t\t};\n\t\tawait service.doFileSearchWithEngine(Engine, {\n\t\t\ttype: QueryType.File,\n\t\t\tfolderQueries: TEST_FOLDER_QUERIES,\n\t\t\tfilePattern: 'a',\n\t\t\tsortByScore: true,\n\t\t\tmaxResults: 23\n\t\t}, cb, undefined, 10);\n\t\tassert.deepStrictEqual(results, [10, 10, 3]);\n\t});\n\n\ttest('Cached results', function () {\n\t\tconst paths = ['bcb', 'bbc', 'aab'];\n\t\tconst matches: IRawFileMatch[] = paths.map(relativePath => ({\n\t\t\tbase: path.normalize('/some/where'),\n\t\t\trelativePath,\n\t\t\tbasename: relativePath,\n\t\t\tsize: 3,\n\t\t\tsearchPath: undefined\n\t\t}));\n\t\tconst Engine = TestSearchEngine.bind(null, () => matches.shift()!);\n\t\tconst service = new RawSearchService();\n\n\t\tconst results: any[] = [];\n\t\tconst cb: IProgressCallback = value => {\n\t\t\tif (!!(<IProgressMessage>value).message) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (Array.isArray(value)) {\n\t\t\t\tresults.push(...value.map(v => v.path));\n\t\t\t} else {\n\t\t\t\tassert.fail(JSON.stringify(value));\n\t\t\t}\n\t\t};\n\t\treturn service.doFileSearchWithEngine(Engine, {\n\t\t\ttype: QueryType.File,\n\t\t\tfolderQueries: TEST_FOLDER_QUERIES,\n\t\t\tfilePattern: 'b',\n\t\t\tsortByScore: true,\n\t\t\tcacheKey: 'x'\n\t\t}, cb, undefined, -1).then(complete => {\n\t\t\tassert.strictEqual((<IFileSearchStats>complete.stats).fromCache, false);\n\t\t\tassert.deepStrictEqual(results, [path.normalize('/some/where/bcb'), path.normalize('/some/where/bbc'), path.normalize('/some/where/aab')]);\n\t\t}).then(async () => {\n\t\t\tconst results: any[] = [];\n\t\t\tconst cb: IProgressCallback = value => {\n\t\t\t\tif (Array.isArray(value)) {\n\t\t\t\t\tresults.push(...value.map(v => v.path));\n\t\t\t\t} else {\n\t\t\t\t\tassert.fail(JSON.stringify(value));\n\t\t\t\t}\n\t\t\t};\n\t\t\ttry {\n\t\t\t\tconst complete = await service.doFileSearchWithEngine(Engine, {\n\t\t\t\t\ttype: QueryType.File,\n\t\t\t\t\tfolderQueries: TEST_FOLDER_QUERIES,\n\t\t\t\t\tfilePattern: 'bc',\n\t\t\t\t\tsortByScore: true,\n\t\t\t\t\tcacheKey: 'x'\n\t\t\t\t}, cb, undefined, -1);\n\t\t\t\tassert.ok((<IFileSearchStats>complete.stats).fromCache);\n\t\t\t\tassert.deepStrictEqual(results, [path.normalize('/some/where/bcb'), path.normalize('/some/where/bbc')]);\n\t\t\t}\n\t\t\tcatch (e) { }\n\t\t}).then(() => {\n\t\t\treturn service.clearCache('x');\n\t\t}).then(async () => {\n\t\t\tmatches.push({\n\t\t\t\tbase: path.normalize('/some/where'),\n\t\t\t\trelativePath: 'bc',\n\t\t\t\tsearchPath: undefined\n\t\t\t});\n\t\t\tconst results: any[] = [];\n\t\t\tconst cb: IProgressCallback = value => {\n\t\t\t\tif (!!(<IProgressMessage>value).message) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tif (Array.isArray(value)) {\n\t\t\t\t\tresults.push(...value.map(v => v.path));\n\t\t\t\t} else {\n\t\t\t\t\tassert.fail(JSON.stringify(value));\n\t\t\t\t}\n\t\t\t};\n\t\t\tconst complete = await service.doFileSearchWithEngine(Engine, {\n\t\t\t\ttype: QueryType.File,\n\t\t\t\tfolderQueries: TEST_FOLDER_QUERIES,\n\t\t\t\tfilePattern: 'bc',\n\t\t\t\tsortByScore: true,\n\t\t\t\tcacheKey: 'x'\n\t\t\t}, cb, undefined, -1);\n\t\t\tassert.strictEqual((<IFileSearchStats>complete.stats).fromCache, false);\n\t\t\tassert.deepStrictEqual(results, [path.normalize('/some/where/bc')]);\n\t\t});\n\t});\n});\n\nfunction collectResultsFromEvent(event: Event<ISerializedSearchProgressItem | ISerializedSearchComplete>): Promise<{ files: ISerializedFileMatch[]; limitHit: boolean }> {\n\tconst files: ISerializedFileMatch[] = [];\n\n\tlet listener: IDisposable;\n\treturn new Promise((c, e) => {\n\t\tlistener = event(ev => {\n\t\t\tif (isSerializedSearchComplete(ev)) {\n\t\t\t\tif (isSerializedSearchSuccess(ev)) {\n\t\t\t\t\tc({ files, limitHit: ev.limitHit });\n\t\t\t\t} else {\n\t\t\t\t\te(ev.error);\n\t\t\t\t}\n\n\t\t\t\tlistener.dispose();\n\t\t\t} else if (Array.isArray(ev)) {\n\t\t\t\tfiles.push(...ev);\n\t\t\t} else if ((<ISerializedFileMatch>ev).path) {\n\t\t\t\tfiles.push(ev as ISerializedFileMatch);\n\t\t\t}\n\t\t});\n\t});\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport assert from 'assert';\nimport { CancelablePromise, createCancelablePromise } from '../../../../../base/common/async.js';\nimport { Emitter, Event } from '../../../../../base/common/event.js';\nimport { IDisposable } from '../../../../../base/common/lifecycle.js';\nimport { FileAccess } from '../../../../../base/common/network.js';\nimport * as path from '../../../../../base/common/path.js';\nimport { URI } from '../../../../../base/common/uri.js';\nimport { flakySuite } from '../../../../../base/test/node/testUtils.js';\nimport { IFileQuery, IFileSearchStats, IFolderQuery, IProgressMessage, IRawFileMatch, ISearchEngine, ISearchEngineStats, ISearchEngineSuccess, ISerializedFileMatch, ISerializedSearchComplete, ISerializedSearchProgressItem, ISerializedSearchSuccess, isSerializedSearchComplete, isSerializedSearchSuccess, QueryType } from '../../common/search.js';\nimport { IProgressCallback, SearchService as RawSearchService } from '../../node/rawSearchService.js';\n\nconst TEST_FOLDER_QUERIES = [\n\t{ folder: URI.file(path.normalize('/some/where')) }\n];\n\nconst TEST_FIXTURES = path.normalize(FileAccess.asFileUri('vs/workbench/services/search/test/node/fixtures').fsPath);\nconst MULTIROOT_QUERIES: IFolderQuery[] = [\n\t{ folder: URI.file(path.join(TEST_FIXTURES, 'examples')) },\n\t{ folder: URI.file(path.join(TEST_FIXTURES, 'more')) }\n];\n\nconst stats: ISearchEngineStats = {\n\tfileWalkTime: 0,\n\tcmdTime: 1,\n\tdirectoriesWalked: 2,\n\tfilesWalked: 3\n};\n\nclass TestSearchEngine implements ISearchEngine<IRawFileMatch> {\n\n\tstatic last: TestSearchEngine;\n\n\tprivate isCanceled = false;\n\n\tconstructor(private result: () => IRawFileMatch | null, public config?: IFileQuery) {\n\t\tTestSearchEngine.last = this;\n\t}\n\n\tsearch(onResult: (match: IRawFileMatch) => void, onProgress: (progress: IProgressMessage) => void, done: (error: Error, complete: ISearchEngineSuccess) => void): void {\n\t\tconst self = this;\n\t\t(function next() {\n\t\t\tprocess.nextTick(() => {\n\t\t\t\tif (self.isCanceled) {\n\t\t\t\t\tdone(null!, {\n\t\t\t\t\t\tlimitHit: false,\n\t\t\t\t\t\tstats: stats,\n\t\t\t\t\t\tmessages: [],\n\t\t\t\t\t});\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tconst result = self.result();\n\t\t\t\tif (!result) {\n\t\t\t\t\tdone(null!, {\n\t\t\t\t\t\tlimitHit: false,\n\t\t\t\t\t\tstats: stats,\n\t\t\t\t\t\tmessages: [],\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tonResult(result);\n\t\t\t\t\tnext();\n\t\t\t\t}\n\t\t\t});\n\t\t})();\n\t}\n\n\tcancel(): void {\n\t\tthis.isCanceled = true;\n\t}\n}\n\nflakySuite('RawSearchService', () => {\n\n\tconst rawSearch: IFileQuery = {\n\t\ttype: QueryType.File,\n\t\tfolderQueries: TEST_FOLDER_QUERIES,\n\t\tfilePattern: 'a'\n\t};\n\n\tconst rawMatch: IRawFileMatch = {\n\t\tbase: path.normalize('/some'),\n\t\trelativePath: 'where',\n\t\tsearchPath: undefined\n\t};\n\n\tconst match: ISerializedFileMatch = {\n\t\tpath: path.normalize('/some/where')\n\t};\n\n\ttest('Individual results', async function () {\n\t\tlet i = 5;\n\t\tconst Engine = TestSearchEngine.bind(null, () => i-- ? rawMatch : null);\n\t\tconst service = new RawSearchService();\n\n\t\tlet results = 0;\n\t\tconst cb: (p: ISerializedSearchProgressItem) => void = value => {\n\t\t\tif (!!(<IProgressMessage>value).message) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (!Array.isArray(value)) {\n\t\t\t\tassert.deepStrictEqual(value, match);\n\t\t\t\tresults++;\n\t\t\t} else {\n\t\t\t\tassert.fail(JSON.stringify(value));\n\t\t\t}\n\t\t};\n\n\t\tawait service.doFileSearchWithEngine(Engine, rawSearch, cb, null!, 0);\n\t\treturn assert.strictEqual(results, 5);\n\t});\n\n\ttest('Batch results', async function () {\n\t\tlet i = 25;\n\t\tconst Engine = TestSearchEngine.bind(null, () => i-- ? rawMatch : null);\n\t\tconst service = new RawSearchService();\n\n\t\tconst results: number[] = [];\n\t\tconst cb: (p: ISerializedSearchProgressItem) => void = value => {\n\t\t\tif (!!(<IProgressMessage>value).message) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (Array.isArray(value)) {\n\t\t\t\tvalue.forEach(m => {\n\t\t\t\t\tassert.deepStrictEqual(m, match);\n\t\t\t\t});\n\t\t\t\tresults.push(value.length);\n\t\t\t} else {\n\t\t\t\tassert.fail(JSON.stringify(value));\n\t\t\t}\n\t\t};\n\n\t\tawait service.doFileSearchWithEngine(Engine, rawSearch, cb, undefined, 10);\n\t\tassert.deepStrictEqual(results, [10, 10, 5]);\n\t});\n\n\ttest('Collect batched results', async function () {\n\t\tconst uriPath = '/some/where';\n\t\tlet i = 25;\n\t\tconst Engine = TestSearchEngine.bind(null, () => i-- ? rawMatch : null);\n\t\tconst service = new RawSearchService();\n\n\t\tfunction fileSearch(config: IFileQuery, batchSize: number): Event<ISerializedSearchProgressItem | ISerializedSearchComplete> {\n\t\t\tlet promise: CancelablePromise<ISerializedSearchSuccess | void>;\n\n\t\t\tconst emitter = new Emitter<ISerializedSearchProgressItem | ISerializedSearchComplete>({\n\t\t\t\tonWillAddFirstListener: () => {\n\t\t\t\t\tpromise = createCancelablePromise(token => service.doFileSearchWithEngine(Engine, config, p => emitter.fire(p), token, batchSize)\n\t\t\t\t\t\t.then(c => emitter.fire(c), err => emitter.fire({ type: 'error', error: err })));\n\t\t\t\t},\n\t\t\t\tonDidRemoveLastListener: () => {\n\t\t\t\t\tpromise.cancel();\n\t\t\t\t}\n\t\t\t});\n\n\t\t\treturn emitter.event;\n\t\t}\n\n\t\tconst result = await collectResultsFromEvent(fileSearch(rawSearch, 10));\n\t\tresult.files.forEach(f => {\n\t\t\tassert.strictEqual(f.path.replace(/\\\\/g, '/'), uriPath);\n\t\t});\n\t\tassert.strictEqual(result.files.length, 25, 'Result');\n\t});\n\n\ttest('Multi-root with include pattern and maxResults', async function () {\n\t\tconst service = new RawSearchService();\n\n\t\tconst query: IFileQuery = {\n\t\t\ttype: QueryType.File,\n\t\t\tfolderQueries: MULTIROOT_QUERIES,\n\t\t\tmaxResults: 1,\n\t\t\tincludePattern: {\n\t\t\t\t'*.txt': true,\n\t\t\t\t'*.js': true\n\t\t\t},\n\t\t};\n\n\t\tconst result = await collectResultsFromEvent(service.fileSearch(query));\n\t\tassert.strictEqual(result.files.length, 1, 'Result');\n\t});\n\n\ttest('Handles maxResults=0 correctly', async function () {\n\t\tconst service = new RawSearchService();\n\n\t\tconst query: IFileQuery = {\n\t\t\ttype: QueryType.File,\n\t\t\tfolderQueries: MULTIROOT_QUERIES,\n\t\t\tmaxResults: 0,\n\t\t\tsortByScore: true,\n\t\t\tincludePattern: {\n\t\t\t\t'*.txt': true,\n\t\t\t\t'*.js': true\n\t\t\t},\n\t\t};\n\n\t\tconst result = await collectResultsFromEvent(service.fileSearch(query));\n\t\tassert.strictEqual(result.files.length, 0, 'Result');\n\t});\n\n\ttest('Multi-root with include pattern and exists', async function () {\n\t\tconst service = new RawSearchService();\n\n\t\tconst query: IFileQuery = {\n\t\t\ttype: QueryType.File,\n\t\t\tfolderQueries: MULTIROOT_QUERIES,\n\t\t\texists: true,\n\t\t\tincludePattern: {\n\t\t\t\t'*.txt': true,\n\t\t\t\t'*.js': true\n\t\t\t},\n\t\t};\n\n\t\tconst result = await collectResultsFromEvent(service.fileSearch(query));\n\t\tassert.strictEqual(result.files.length, 0, 'Result');\n\t\tassert.ok(result.limitHit);\n\t});\n\n\ttest('Sorted results', async function () {\n\t\tconst paths = ['bab', 'bbc', 'abb'];\n\t\tconst matches: IRawFileMatch[] = paths.map(relativePath => ({\n\t\t\tbase: path.normalize('/some/where'),\n\t\t\trelativePath,\n\t\t\tbasename: relativePath,\n\t\t\tsize: 3,\n\t\t\tsearchPath: undefined\n\t\t}));\n\t\tconst Engine = TestSearchEngine.bind(null, () => matches.shift()!);\n\t\tconst service = new RawSearchService();\n\n\t\tconst results: any[] = [];\n\t\tconst cb: IProgressCallback = value => {\n\t\t\tif (!!(<IProgressMessage>value).message) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (Array.isArray(value)) {\n\t\t\t\tresults.push(...value.map(v => v.path));\n\t\t\t} else {\n\t\t\t\tassert.fail(JSON.stringify(value));\n\t\t\t}\n\t\t};\n\n\t\tawait service.doFileSearchWithEngine(Engine, {\n\t\t\ttype: QueryType.File,\n\t\t\tfolderQueries: TEST_FOLDER_QUERIES,\n\t\t\tfilePattern: 'bb',\n\t\t\tsortByScore: true,\n\t\t\tmaxResults: 2\n\t\t}, cb, undefined, 1);\n\t\tassert.notStrictEqual(typeof TestSearchEngine.last.config!.maxResults, 'number');\n\t\tassert.deepStrictEqual(results, [path.normalize('/some/where/bbc'), path.normalize('/some/where/bab')]);\n\t});\n\n\ttest('Sorted result batches', async function () {\n\t\tlet i = 25;\n\t\tconst Engine = TestSearchEngine.bind(null, () => i-- ? rawMatch : null);\n\t\tconst service = new RawSearchService();\n\n\t\tconst results: number[] = [];\n\t\tconst cb: IProgressCallback = value => {\n\t\t\tif (!!(<IProgressMessage>value).message) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (Array.isArray(value)) {\n\t\t\t\tvalue.forEach(m => {\n\t\t\t\t\tassert.deepStrictEqual(m, match);\n\t\t\t\t});\n\t\t\t\tresults.push(value.length);\n\t\t\t} else {\n\t\t\t\tassert.fail(JSON.stringify(value));\n\t\t\t}\n\t\t};\n\t\tawait service.doFileSearchWithEngine(Engine, {\n\t\t\ttype: QueryType.File,\n\t\t\tfolderQueries: TEST_FOLDER_QUERIES,\n\t\t\tfilePattern: 'a',\n\t\t\tsortByScore: true,\n\t\t\tmaxResults: 23\n\t\t}, cb, undefined, 10);\n\t\tassert.deepStrictEqual(results, [10, 10, 3]);\n\t});\n\n\ttest('Cached results', function () {\n\t\tconst paths = ['bcb', 'bbc', 'aab'];\n\t\tconst matches: IRawFileMatch[] = paths.map(relativePath => ({\n\t\t\tbase: path.normalize('/some/where'),\n\t\t\trelativePath,\n\t\t\tbasename: relativePath,\n\t\t\tsize: 3,\n\t\t\tsearchPath: undefined\n\t\t}));\n\t\tconst Engine = TestSearchEngine.bind(null, () => matches.shift()!);\n\t\tconst service = new RawSearchService();\n\n\t\tconst results: any[] = [];\n\t\tconst cb: IProgressCallback = value => {\n\t\t\tif (!!(<IProgressMessage>value).message) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (Array.isArray(value)) {\n\t\t\t\tresults.push(...value.map(v => v.path));\n\t\t\t} else {\n\t\t\t\tassert.fail(JSON.stringify(value));\n\t\t\t}\n\t\t};\n\t\treturn service.doFileSearchWithEngine(Engine, {\n\t\t\ttype: QueryType.File,\n\t\t\tfolderQueries: TEST_FOLDER_QUERIES,\n\t\t\tfilePattern: 'b',\n\t\t\tsortByScore: true,\n\t\t\tcacheKey: 'x'\n\t\t}, cb, undefined, -1).then(complete => {\n\t\t\tassert.strictEqual((<IFileSearchStats>complete.stats).fromCache, false);\n\t\t\tassert.deepStrictEqual(results, [path.normalize('/some/where/bcb'), path.normalize('/some/where/bbc'), path.normalize('/some/where/aab')]);\n\t\t}).then(async () => {\n\t\t\tconst results: any[] = [];\n\t\t\tconst cb: IProgressCallback = value => {\n\t\t\t\tif (Array.isArray(value)) {\n\t\t\t\t\tresults.push(...value.map(v => v.path));\n\t\t\t\t} else {\n\t\t\t\t\tassert.fail(JSON.stringify(value));\n\t\t\t\t}\n\t\t\t};\n\t\t\ttry {\n\t\t\t\tconst complete = await service.doFileSearchWithEngine(Engine, {\n\t\t\t\t\ttype: QueryType.File,\n\t\t\t\t\tfolderQueries: TEST_FOLDER_QUERIES,\n\t\t\t\t\tfilePattern: 'bc',\n\t\t\t\t\tsortByScore: true,\n\t\t\t\t\tcacheKey: 'x'\n\t\t\t\t}, cb, undefined, -1);\n\t\t\t\tassert.ok((<IFileSearchStats>complete.stats).fromCache);\n\t\t\t\tassert.deepStrictEqual(results, [path.normalize('/some/where/bcb'), path.normalize('/some/where/bbc')]);\n\t\t\t}\n\t\t\tcatch (e) { }\n\t\t}).then(() => {\n\t\t\treturn service.clearCache('x');\n\t\t}).then(async () => {\n\t\t\tmatches.push({\n\t\t\t\tbase: path.normalize('/some/where'),\n\t\t\t\trelativePath: 'bc',\n\t\t\t\tsearchPath: undefined\n\t\t\t});\n\t\t\tconst results: any[] = [];\n\t\t\tconst cb: IProgressCallback = value => {\n\t\t\t\tif (!!(<IProgressMessage>value).message) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tif (Array.isArray(value)) {\n\t\t\t\t\tresults.push(...value.map(v => v.path));\n\t\t\t\t} else {\n\t\t\t\t\tassert.fail(JSON.stringify(value));\n\t\t\t\t}\n\t\t\t};\n\t\t\tconst complete = await service.doFileSearchWithEngine(Engine, {\n\t\t\t\ttype: QueryType.File,\n\t\t\t\tfolderQueries: TEST_FOLDER_QUERIES,\n\t\t\t\tfilePattern: 'bc',\n\t\t\t\tsortByScore: true,\n\t\t\t\tcacheKey: 'x'\n\t\t\t}, cb, undefined, -1);\n\t\t\tassert.strictEqual((<IFileSearchStats>complete.stats).fromCache, false);\n\t\t\tassert.deepStrictEqual(results, [path.normalize('/some/where/bc')]);\n\t\t});\n\t});\n});\n\nfunction collectResultsFromEvent(event: Event<ISerializedSearchProgressItem | ISerializedSearchComplete>): Promise<{ files: ISerializedFileMatch[]; limitHit: boolean }> {\n\tconst files: ISerializedFileMatch[] = [];\n\n\tlet listener: IDisposable;\n\treturn new Promise((c, e) => {\n\t\tlistener = event(ev => {\n\t\t\tif (isSerializedSearchComplete(ev)) {\n\t\t\t\tif (isSerializedSearchSuccess(ev)) {\n\t\t\t\t\tc({ files, limitHit: ev.limitHit });\n\t\t\t\t} else {\n\t\t\t\t\te(ev.error);\n\t\t\t\t}\n\n\t\t\t\tlistener.dispose();\n\t\t\t} else if (Array.isArray(ev)) {\n\t\t\t\tfiles.push(...ev);\n\t\t\t} else if ((<ISerializedFileMatch>ev).path) {\n\t\t\t\tfiles.push(ev as ISerializedFileMatch);\n\t\t\t}\n\t\t});\n\t});\n}\n"]}