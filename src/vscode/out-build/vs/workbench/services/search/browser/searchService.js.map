{"version":3,"sources":["vs/workbench/services/search/browser/searchService.ts"],"names":[],"mappings":"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","file":"searchService.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { CancellationToken } from '../../../../base/common/cancellation.js';\nimport { IModelService } from '../../../../editor/common/services/model.js';\nimport { IFileService } from '../../../../platform/files/common/files.js';\nimport { IInstantiationService } from '../../../../platform/instantiation/common/instantiation.js';\nimport { ILogService } from '../../../../platform/log/common/log.js';\nimport { ITelemetryService } from '../../../../platform/telemetry/common/telemetry.js';\nimport { IEditorService } from '../../editor/common/editorService.js';\nimport { IExtensionService } from '../../extensions/common/extensions.js';\nimport { IFileMatch, IFileQuery, ISearchComplete, ISearchProgressItem, ISearchResultProvider, ISearchService, ITextQuery, SearchProviderType, TextSearchCompleteMessageType } from '../common/search.js';\nimport { SearchService } from '../common/searchService.js';\nimport { IUriIdentityService } from '../../../../platform/uriIdentity/common/uriIdentity.js';\nimport { IWebWorkerClient, logOnceWebWorkerWarning } from '../../../../base/common/worker/webWorker.js';\nimport { Disposable, DisposableStore } from '../../../../base/common/lifecycle.js';\nimport { WebWorkerDescriptor } from '../../../../platform/webWorker/browser/webWorkerDescriptor.js';\nimport { IWebWorkerService } from '../../../../platform/webWorker/browser/webWorkerService.js';\nimport { InstantiationType, registerSingleton } from '../../../../platform/instantiation/common/extensions.js';\nimport { ILocalFileSearchWorker, LocalFileSearchWorkerHost } from '../common/localFileSearchWorkerTypes.js';\nimport { memoize } from '../../../../base/common/decorators.js';\nimport { HTMLFileSystemProvider } from '../../../../platform/files/browser/htmlFileSystemProvider.js';\nimport { FileAccess, Schemas } from '../../../../base/common/network.js';\nimport { URI, UriComponents } from '../../../../base/common/uri.js';\nimport { Emitter, Event } from '../../../../base/common/event.js';\nimport { localize } from '../../../../nls.js';\nimport { WebFileSystemAccess } from '../../../../platform/files/browser/webFileSystemAccess.js';\nimport { revive } from '../../../../base/common/marshalling.js';\n\nexport class RemoteSearchService extends SearchService {\n\tconstructor(\n\t\t@IModelService modelService: IModelService,\n\t\t@IEditorService editorService: IEditorService,\n\t\t@ITelemetryService telemetryService: ITelemetryService,\n\t\t@ILogService logService: ILogService,\n\t\t@IExtensionService extensionService: IExtensionService,\n\t\t@IFileService fileService: IFileService,\n\t\t@IInstantiationService private readonly instantiationService: IInstantiationService,\n\t\t@IUriIdentityService uriIdentityService: IUriIdentityService,\n\t) {\n\t\tsuper(modelService, editorService, telemetryService, logService, extensionService, fileService, uriIdentityService);\n\t\tconst searchProvider = this.instantiationService.createInstance(LocalFileSearchWorkerClient);\n\t\tthis.registerSearchResultProvider(Schemas.file, SearchProviderType.file, searchProvider);\n\t\tthis.registerSearchResultProvider(Schemas.file, SearchProviderType.text, searchProvider);\n\t}\n}\n\nexport class LocalFileSearchWorkerClient extends Disposable implements ISearchResultProvider {\n\n\tprotected _worker: IWebWorkerClient<ILocalFileSearchWorker> | null;\n\n\tprivate readonly _onDidReceiveTextSearchMatch = new Emitter<{ match: IFileMatch<UriComponents>; queryId: number }>();\n\treadonly onDidReceiveTextSearchMatch: Event<{ match: IFileMatch<UriComponents>; queryId: number }> = this._onDidReceiveTextSearchMatch.event;\n\n\tprivate cache: { key: string; cache: ISearchComplete } | undefined;\n\n\tprivate queryId: number = 0;\n\n\tconstructor(\n\t\t@IFileService private fileService: IFileService,\n\t\t@IUriIdentityService private uriIdentityService: IUriIdentityService,\n\t\t@IWebWorkerService private webWorkerService: IWebWorkerService,\n\t) {\n\t\tsuper();\n\t\tthis._worker = null;\n\t}\n\n\tasync getAIName(): Promise<string | undefined> {\n\t\treturn undefined;\n\t}\n\n\tsendTextSearchMatch(match: IFileMatch<UriComponents>, queryId: number): void {\n\t\tthis._onDidReceiveTextSearchMatch.fire({ match, queryId });\n\t}\n\n\t@memoize\n\tprivate get fileSystemProvider(): HTMLFileSystemProvider {\n\t\treturn this.fileService.getProvider(Schemas.file) as HTMLFileSystemProvider;\n\t}\n\n\tprivate async cancelQuery(queryId: number) {\n\t\tconst proxy = this._getOrCreateWorker().proxy;\n\t\tproxy.$cancelQuery(queryId);\n\t}\n\n\tasync textSearch(query: ITextQuery, onProgress?: (p: ISearchProgressItem) => void, token?: CancellationToken): Promise<ISearchComplete> {\n\t\ttry {\n\t\t\tconst queryDisposables = new DisposableStore();\n\n\t\t\tconst proxy = this._getOrCreateWorker().proxy;\n\t\t\tconst results: IFileMatch[] = [];\n\n\t\t\tlet limitHit = false;\n\n\t\t\tawait Promise.all(query.folderQueries.map(async fq => {\n\t\t\t\tconst queryId = this.queryId++;\n\t\t\t\tqueryDisposables.add(token?.onCancellationRequested(e => this.cancelQuery(queryId)) || Disposable.None);\n\n\t\t\t\tconst handle: FileSystemHandle | undefined = await this.fileSystemProvider.getHandle(fq.folder);\n\t\t\t\tif (!handle || !WebFileSystemAccess.isFileSystemDirectoryHandle(handle)) {\n\t\t\t\t\tconsole.error('Could not get directory handle for ', fq);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t// force resource to revive using URI.revive.\n\t\t\t\t// TODO @andrea see why we can't just use `revive()` below. For some reason, (<MarshalledObject>obj).$mid was undefined for result.resource\n\t\t\t\tconst reviveMatch = (result: IFileMatch<UriComponents>): IFileMatch => ({\n\t\t\t\t\tresource: URI.revive(result.resource),\n\t\t\t\t\tresults: revive(result.results)\n\t\t\t\t});\n\n\t\t\t\tqueryDisposables.add(this.onDidReceiveTextSearchMatch(e => {\n\t\t\t\t\tif (e.queryId === queryId) {\n\t\t\t\t\t\tonProgress?.(reviveMatch(e.match));\n\t\t\t\t\t}\n\t\t\t\t}));\n\n\t\t\t\tconst ignorePathCasing = this.uriIdentityService.extUri.ignorePathCasing(fq.folder);\n\t\t\t\tconst folderResults = await proxy.$searchDirectory(handle, query, fq, ignorePathCasing, queryId);\n\t\t\t\tfor (const folderResult of folderResults.results) {\n\t\t\t\t\tresults.push(revive(folderResult));\n\t\t\t\t}\n\n\t\t\t\tif (folderResults.limitHit) {\n\t\t\t\t\tlimitHit = true;\n\t\t\t\t}\n\n\t\t\t}));\n\n\t\t\tqueryDisposables.dispose();\n\t\t\tconst result = { messages: [], results, limitHit };\n\t\t\treturn result;\n\t\t} catch (e) {\n\t\t\tconsole.error('Error performing web worker text search', e);\n\t\t\treturn {\n\t\t\t\tresults: [],\n\t\t\t\tmessages: [{\n\t\t\t\t\ttext: localize('errorSearchText', \"Unable to search with Web Worker text searcher\"), type: TextSearchCompleteMessageType.Warning\n\t\t\t\t}],\n\t\t\t};\n\t\t}\n\t}\n\n\tasync fileSearch(query: IFileQuery, token?: CancellationToken): Promise<ISearchComplete> {\n\t\ttry {\n\t\t\tconst queryDisposables = new DisposableStore();\n\t\t\tlet limitHit = false;\n\n\t\t\tconst proxy = this._getOrCreateWorker().proxy;\n\t\t\tconst results: IFileMatch[] = [];\n\t\t\tawait Promise.all(query.folderQueries.map(async fq => {\n\t\t\t\tconst queryId = this.queryId++;\n\t\t\t\tqueryDisposables.add(token?.onCancellationRequested(e => this.cancelQuery(queryId)) || Disposable.None);\n\n\t\t\t\tconst handle: FileSystemHandle | undefined = await this.fileSystemProvider.getHandle(fq.folder);\n\t\t\t\tif (!handle || !WebFileSystemAccess.isFileSystemDirectoryHandle(handle)) {\n\t\t\t\t\tconsole.error('Could not get directory handle for ', fq);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tconst caseSensitive = this.uriIdentityService.extUri.ignorePathCasing(fq.folder);\n\t\t\t\tconst folderResults = await proxy.$listDirectory(handle, query, fq, caseSensitive, queryId);\n\t\t\t\tfor (const folderResult of folderResults.results) {\n\t\t\t\t\tresults.push({ resource: URI.joinPath(fq.folder, folderResult) });\n\t\t\t\t}\n\t\t\t\tif (folderResults.limitHit) { limitHit = true; }\n\t\t\t}));\n\n\t\t\tqueryDisposables.dispose();\n\n\t\t\tconst result = { messages: [], results, limitHit };\n\t\t\treturn result;\n\t\t} catch (e) {\n\t\t\tconsole.error('Error performing web worker file search', e);\n\t\t\treturn {\n\t\t\t\tresults: [],\n\t\t\t\tmessages: [{\n\t\t\t\t\ttext: localize('errorSearchFile', \"Unable to search with Web Worker file searcher\"), type: TextSearchCompleteMessageType.Warning\n\t\t\t\t}],\n\t\t\t};\n\t\t}\n\t}\n\n\tasync clearCache(cacheKey: string): Promise<void> {\n\t\tif (this.cache?.key === cacheKey) { this.cache = undefined; }\n\t}\n\n\tprivate _getOrCreateWorker(): IWebWorkerClient<ILocalFileSearchWorker> {\n\t\tif (!this._worker) {\n\t\t\ttry {\n\t\t\t\tthis._worker = this._register(this.webWorkerService.createWorkerClient<ILocalFileSearchWorker>(\n\t\t\t\t\tnew WebWorkerDescriptor({\n\t\t\t\t\t\tesmModuleLocation: FileAccess.asBrowserUri('vs/workbench/services/search/worker/localFileSearchMain.js'),\n\t\t\t\t\t\tlabel: 'LocalFileSearchWorker'\n\t\t\t\t\t})\n\t\t\t\t));\n\t\t\t\tLocalFileSearchWorkerHost.setChannel(this._worker, {\n\t\t\t\t\t$sendTextSearchMatch: (match, queryId) => {\n\t\t\t\t\t\treturn this.sendTextSearchMatch(match, queryId);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t} catch (err) {\n\t\t\t\tlogOnceWebWorkerWarning(err);\n\t\t\t\tthrow err;\n\t\t\t}\n\t\t}\n\t\treturn this._worker;\n\t}\n}\n\nregisterSingleton(ISearchService, RemoteSearchService, InstantiationType.Delayed);\n"]}