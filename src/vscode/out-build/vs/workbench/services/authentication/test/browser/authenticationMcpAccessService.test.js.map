{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/services/authentication/test/browser/authenticationMcpAccessService.test.ts","vs/workbench/services/authentication/test/browser/authenticationMcpAccessService.test.ts"],"names":[],"mappings":"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","file":"authenticationMcpAccessService.test.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport assert from 'assert';\nimport { ensureNoDisposablesAreLeakedInTestSuite } from '../../../../../base/test/common/utils.js';\nimport { TestInstantiationService } from '../../../../../platform/instantiation/test/common/instantiationServiceMock.js';\nimport { IStorageService, StorageScope, StorageTarget } from '../../../../../platform/storage/common/storage.js';\nimport { IProductService } from '../../../../../platform/product/common/productService.js';\nimport { TestStorageService, TestProductService } from '../../../../test/common/workbenchTestServices.js';\nimport { AuthenticationMcpAccessService, AllowedMcpServer, IAuthenticationMcpAccessService } from '../../browser/authenticationMcpAccessService.js';\n\nsuite('AuthenticationMcpAccessService', () => {\n\tconst disposables = ensureNoDisposablesAreLeakedInTestSuite();\n\n\tlet instantiationService: TestInstantiationService;\n\tlet storageService: TestStorageService;\n\tlet productService: IProductService & { trustedMcpAuthAccess?: string[] | Record<string, string[]> };\n\tlet authenticationMcpAccessService: IAuthenticationMcpAccessService;\n\n\tsetup(() => {\n\t\tinstantiationService = disposables.add(new TestInstantiationService());\n\n\t\t// Set up storage service\n\t\tstorageService = disposables.add(new TestStorageService());\n\t\tinstantiationService.stub(IStorageService, storageService);\n\n\t\t// Set up product service with no trusted servers by default\n\t\tproductService = { ...TestProductService };\n\t\tinstantiationService.stub(IProductService, productService);\n\n\t\t// Create the service instance\n\t\tauthenticationMcpAccessService = disposables.add(instantiationService.createInstance(AuthenticationMcpAccessService));\n\t});\n\n\tsuite('isAccessAllowed', () => {\n\t\ttest('returns undefined for unknown MCP server with no product configuration', () => {\n\t\t\tconst result = authenticationMcpAccessService.isAccessAllowed('github', 'user@example.com', 'unknown-server');\n\t\t\tassert.strictEqual(result, undefined);\n\t\t});\n\n\t\ttest('returns true for trusted MCP server from product.json (array format)', () => {\n\t\t\tproductService.trustedMcpAuthAccess = ['trusted-server-1', 'trusted-server-2'];\n\n\t\t\tconst result = authenticationMcpAccessService.isAccessAllowed('github', 'user@example.com', 'trusted-server-1');\n\t\t\tassert.strictEqual(result, true);\n\t\t});\n\n\t\ttest('returns true for trusted MCP server from product.json (object format)', () => {\n\t\t\tproductService.trustedMcpAuthAccess = {\n\t\t\t\t'github': ['github-server'],\n\t\t\t\t'microsoft': ['microsoft-server']\n\t\t\t};\n\n\t\t\tconst result1 = authenticationMcpAccessService.isAccessAllowed('github', 'user@example.com', 'github-server');\n\t\t\tassert.strictEqual(result1, true);\n\n\t\t\tconst result2 = authenticationMcpAccessService.isAccessAllowed('microsoft', 'user@microsoft.com', 'microsoft-server');\n\t\t\tassert.strictEqual(result2, true);\n\t\t});\n\n\t\ttest('returns undefined for MCP server not in trusted list', () => {\n\t\t\tproductService.trustedMcpAuthAccess = ['trusted-server'];\n\n\t\t\tconst result = authenticationMcpAccessService.isAccessAllowed('github', 'user@example.com', 'untrusted-server');\n\t\t\tassert.strictEqual(result, undefined);\n\t\t});\n\n\t\ttest('returns stored allowed state when server is in storage', () => {\n\t\t\t// Add server to storage\n\t\t\tauthenticationMcpAccessService.updateAllowedMcpServers('github', 'user@example.com', [{\n\t\t\t\tid: 'stored-server',\n\t\t\t\tname: 'Stored Server',\n\t\t\t\tallowed: false\n\t\t\t}]);\n\n\t\t\tconst result = authenticationMcpAccessService.isAccessAllowed('github', 'user@example.com', 'stored-server');\n\t\t\tassert.strictEqual(result, false);\n\t\t});\n\n\t\ttest('returns true for server in storage with allowed=true', () => {\n\t\t\tauthenticationMcpAccessService.updateAllowedMcpServers('github', 'user@example.com', [{\n\t\t\t\tid: 'allowed-server',\n\t\t\t\tname: 'Allowed Server',\n\t\t\t\tallowed: true\n\t\t\t}]);\n\n\t\t\tconst result = authenticationMcpAccessService.isAccessAllowed('github', 'user@example.com', 'allowed-server');\n\t\t\tassert.strictEqual(result, true);\n\t\t});\n\n\t\ttest('returns true for server in storage with undefined allowed property (legacy behavior)', () => {\n\t\t\t// Simulate legacy data where allowed property didn't exist\n\t\t\tconst legacyServer: AllowedMcpServer = {\n\t\t\t\tid: 'legacy-server',\n\t\t\t\tname: 'Legacy Server'\n\t\t\t\t// allowed property is undefined\n\t\t\t};\n\n\t\t\tauthenticationMcpAccessService.updateAllowedMcpServers('github', 'user@example.com', [legacyServer]);\n\n\t\t\tconst result = authenticationMcpAccessService.isAccessAllowed('github', 'user@example.com', 'legacy-server');\n\t\t\tassert.strictEqual(result, true);\n\t\t});\n\n\t\ttest('product.json trusted servers take precedence over storage', () => {\n\t\t\tproductService.trustedMcpAuthAccess = ['product-trusted-server'];\n\n\t\t\t// Try to store the same server as not allowed\n\t\t\tauthenticationMcpAccessService.updateAllowedMcpServers('github', 'user@example.com', [{\n\t\t\t\tid: 'product-trusted-server',\n\t\t\t\tname: 'Product Trusted Server',\n\t\t\t\tallowed: false\n\t\t\t}]);\n\n\t\t\t// Product.json should take precedence\n\t\t\tconst result = authenticationMcpAccessService.isAccessAllowed('github', 'user@example.com', 'product-trusted-server');\n\t\t\tassert.strictEqual(result, true);\n\t\t});\n\t});\n\n\tsuite('readAllowedMcpServers', () => {\n\t\ttest('returns empty array when no data exists', () => {\n\t\t\tconst result = authenticationMcpAccessService.readAllowedMcpServers('github', 'user@example.com');\n\t\t\tassert.strictEqual(result.length, 0);\n\t\t});\n\n\t\ttest('returns stored MCP servers', () => {\n\t\t\tconst servers: AllowedMcpServer[] = [\n\t\t\t\t{ id: 'server1', name: 'Server 1', allowed: true },\n\t\t\t\t{ id: 'server2', name: 'Server 2', allowed: false }\n\t\t\t];\n\n\t\t\tauthenticationMcpAccessService.updateAllowedMcpServers('github', 'user@example.com', servers);\n\n\t\t\tconst result = authenticationMcpAccessService.readAllowedMcpServers('github', 'user@example.com');\n\t\t\tassert.strictEqual(result.length, 2);\n\t\t\tassert.strictEqual(result[0].id, 'server1');\n\t\t\tassert.strictEqual(result[0].allowed, true);\n\t\t\tassert.strictEqual(result[1].id, 'server2');\n\t\t\tassert.strictEqual(result[1].allowed, false);\n\t\t});\n\n\t\ttest('includes trusted servers from product.json (array format)', () => {\n\t\t\tproductService.trustedMcpAuthAccess = ['trusted-server-1', 'trusted-server-2'];\n\n\t\t\tconst result = authenticationMcpAccessService.readAllowedMcpServers('github', 'user@example.com');\n\t\t\tassert.strictEqual(result.length, 2);\n\n\t\t\tconst trustedServer1 = result.find(s => s.id === 'trusted-server-1');\n\t\t\tassert.ok(trustedServer1);\n\t\t\tassert.strictEqual(trustedServer1.allowed, true);\n\t\t\tassert.strictEqual(trustedServer1.trusted, true);\n\t\t\tassert.strictEqual(trustedServer1.name, 'trusted-server-1'); // Should default to ID\n\n\t\t\tconst trustedServer2 = result.find(s => s.id === 'trusted-server-2');\n\t\t\tassert.ok(trustedServer2);\n\t\t\tassert.strictEqual(trustedServer2.allowed, true);\n\t\t\tassert.strictEqual(trustedServer2.trusted, true);\n\t\t});\n\n\t\ttest('includes trusted servers from product.json (object format)', () => {\n\t\t\tproductService.trustedMcpAuthAccess = {\n\t\t\t\t'github': ['github-server'],\n\t\t\t\t'microsoft': ['microsoft-server']\n\t\t\t};\n\n\t\t\tconst githubResult = authenticationMcpAccessService.readAllowedMcpServers('github', 'user@example.com');\n\t\t\tassert.strictEqual(githubResult.length, 1);\n\t\t\tassert.strictEqual(githubResult[0].id, 'github-server');\n\t\t\tassert.strictEqual(githubResult[0].trusted, true);\n\n\t\t\tconst microsoftResult = authenticationMcpAccessService.readAllowedMcpServers('microsoft', 'user@microsoft.com');\n\t\t\tassert.strictEqual(microsoftResult.length, 1);\n\t\t\tassert.strictEqual(microsoftResult[0].id, 'microsoft-server');\n\t\t\tassert.strictEqual(microsoftResult[0].trusted, true);\n\n\t\t\t// Provider not in trusted list should return empty (no stored servers)\n\t\t\tconst unknownResult = authenticationMcpAccessService.readAllowedMcpServers('unknown', 'user@unknown.com');\n\t\t\tassert.strictEqual(unknownResult.length, 0);\n\t\t});\n\n\t\ttest('merges stored servers with trusted servers from product.json', () => {\n\t\t\tproductService.trustedMcpAuthAccess = ['trusted-server'];\n\n\t\t\t// Add some stored servers\n\t\t\tauthenticationMcpAccessService.updateAllowedMcpServers('github', 'user@example.com', [\n\t\t\t\t{ id: 'stored-server', name: 'Stored Server', allowed: false }\n\t\t\t]);\n\n\t\t\tconst result = authenticationMcpAccessService.readAllowedMcpServers('github', 'user@example.com');\n\t\t\tassert.strictEqual(result.length, 2);\n\n\t\t\tconst trustedServer = result.find(s => s.id === 'trusted-server');\n\t\t\tassert.ok(trustedServer);\n\t\t\tassert.strictEqual(trustedServer.trusted, true);\n\t\t\tassert.strictEqual(trustedServer.allowed, true);\n\n\t\t\tconst storedServer = result.find(s => s.id === 'stored-server');\n\t\t\tassert.ok(storedServer);\n\t\t\tassert.strictEqual(storedServer.trusted, undefined);\n\t\t\tassert.strictEqual(storedServer.allowed, false);\n\t\t});\n\n\t\ttest('updates existing stored server to be trusted when it appears in product.json', () => {\n\t\t\t// First add a server as stored (not trusted)\n\t\t\tauthenticationMcpAccessService.updateAllowedMcpServers('github', 'user@example.com', [\n\t\t\t\t{ id: 'server-1', name: 'Server 1', allowed: false }\n\t\t\t]);\n\n\t\t\t// Then make it trusted via product.json\n\t\t\tproductService.trustedMcpAuthAccess = ['server-1'];\n\n\t\t\tconst result = authenticationMcpAccessService.readAllowedMcpServers('github', 'user@example.com');\n\t\t\tassert.strictEqual(result.length, 1);\n\n\t\t\tconst server = result[0];\n\t\t\tassert.strictEqual(server.id, 'server-1');\n\t\t\tassert.strictEqual(server.allowed, true); // Should be overridden to true\n\t\t\tassert.strictEqual(server.trusted, true); // Should be marked as trusted\n\t\t\tassert.strictEqual(server.name, 'Server 1'); // Should keep existing name\n\t\t});\n\n\t\ttest('handles malformed JSON in storage gracefully', () => {\n\t\t\t// Manually corrupt the storage\n\t\t\tstorageService.store('mcpserver-github-user@example.com', 'invalid json', StorageScope.APPLICATION, StorageTarget.USER);\n\n\t\t\t// Should return empty array instead of throwing\n\t\t\tconst result = authenticationMcpAccessService.readAllowedMcpServers('github', 'user@example.com');\n\t\t\tassert.strictEqual(result.length, 0);\n\t\t});\n\n\t\ttest('handles non-array product.json configuration gracefully', () => {\n\t\t\t// Set up invalid configuration\n\t\t\t// eslint-disable-next-line local/code-no-any-casts\n\t\t\tproductService.trustedMcpAuthAccess = 'invalid-string' as any;\n\n\t\t\tconst result = authenticationMcpAccessService.readAllowedMcpServers('github', 'user@example.com');\n\t\t\tassert.strictEqual(result.length, 0);\n\t\t});\n\t});\n\n\tsuite('updateAllowedMcpServers', () => {\n\t\ttest('stores new MCP servers', () => {\n\t\t\tconst servers: AllowedMcpServer[] = [\n\t\t\t\t{ id: 'server1', name: 'Server 1', allowed: true },\n\t\t\t\t{ id: 'server2', name: 'Server 2', allowed: false }\n\t\t\t];\n\n\t\t\tauthenticationMcpAccessService.updateAllowedMcpServers('github', 'user@example.com', servers);\n\n\t\t\tconst result = authenticationMcpAccessService.readAllowedMcpServers('github', 'user@example.com');\n\t\t\tassert.strictEqual(result.length, 2);\n\t\t\tassert.strictEqual(result[0].id, 'server1');\n\t\t\tassert.strictEqual(result[1].id, 'server2');\n\t\t});\n\n\t\ttest('updates existing MCP server allowed status', () => {\n\t\t\t// First add a server\n\t\t\tauthenticationMcpAccessService.updateAllowedMcpServers('github', 'user@example.com', [\n\t\t\t\t{ id: 'server1', name: 'Server 1', allowed: true }\n\t\t\t]);\n\n\t\t\t// Then update its allowed status\n\t\t\tauthenticationMcpAccessService.updateAllowedMcpServers('github', 'user@example.com', [\n\t\t\t\t{ id: 'server1', name: 'Server 1', allowed: false }\n\t\t\t]);\n\n\t\t\tconst result = authenticationMcpAccessService.readAllowedMcpServers('github', 'user@example.com');\n\t\t\tassert.strictEqual(result.length, 1);\n\t\t\tassert.strictEqual(result[0].allowed, false);\n\t\t});\n\n\t\ttest('updates existing MCP server name when new name is provided', () => {\n\t\t\t// First add a server with default name\n\t\t\tauthenticationMcpAccessService.updateAllowedMcpServers('github', 'user@example.com', [\n\t\t\t\t{ id: 'server1', name: 'server1', allowed: true }\n\t\t\t]);\n\n\t\t\t// Then update with a proper name\n\t\t\tauthenticationMcpAccessService.updateAllowedMcpServers('github', 'user@example.com', [\n\t\t\t\t{ id: 'server1', name: 'My Server', allowed: true }\n\t\t\t]);\n\n\t\t\tconst result = authenticationMcpAccessService.readAllowedMcpServers('github', 'user@example.com');\n\t\t\tassert.strictEqual(result.length, 1);\n\t\t\tassert.strictEqual(result[0].name, 'My Server');\n\t\t});\n\n\t\ttest('does not update name when new name is same as ID', () => {\n\t\t\t// First add a server with a proper name\n\t\t\tauthenticationMcpAccessService.updateAllowedMcpServers('github', 'user@example.com', [\n\t\t\t\t{ id: 'server1', name: 'My Server', allowed: true }\n\t\t\t]);\n\n\t\t\t// Then try to update with ID as name (should keep existing name)\n\t\t\tauthenticationMcpAccessService.updateAllowedMcpServers('github', 'user@example.com', [\n\t\t\t\t{ id: 'server1', name: 'server1', allowed: false }\n\t\t\t]);\n\n\t\t\tconst result = authenticationMcpAccessService.readAllowedMcpServers('github', 'user@example.com');\n\t\t\tassert.strictEqual(result.length, 1);\n\t\t\tassert.strictEqual(result[0].name, 'My Server'); // Should keep original name\n\t\t\tassert.strictEqual(result[0].allowed, false); // But allowed status should update\n\t\t});\n\n\t\ttest('adds new servers while preserving existing ones', () => {\n\t\t\t// First add one server\n\t\t\tauthenticationMcpAccessService.updateAllowedMcpServers('github', 'user@example.com', [\n\t\t\t\t{ id: 'server1', name: 'Server 1', allowed: true }\n\t\t\t]);\n\n\t\t\t// Then add another server\n\t\t\tauthenticationMcpAccessService.updateAllowedMcpServers('github', 'user@example.com', [\n\t\t\t\t{ id: 'server2', name: 'Server 2', allowed: false }\n\t\t\t]);\n\n\t\t\tconst result = authenticationMcpAccessService.readAllowedMcpServers('github', 'user@example.com');\n\t\t\tassert.strictEqual(result.length, 2);\n\n\t\t\tconst server1 = result.find(s => s.id === 'server1');\n\t\t\tconst server2 = result.find(s => s.id === 'server2');\n\t\t\tassert.ok(server1);\n\t\t\tassert.ok(server2);\n\t\t\tassert.strictEqual(server1.allowed, true);\n\t\t\tassert.strictEqual(server2.allowed, false);\n\t\t});\n\n\t\ttest('does not store trusted servers from product.json', () => {\n\t\t\tproductService.trustedMcpAuthAccess = ['trusted-server'];\n\n\t\t\t// Try to update a trusted server\n\t\t\tauthenticationMcpAccessService.updateAllowedMcpServers('github', 'user@example.com', [\n\t\t\t\t{ id: 'trusted-server', name: 'Trusted Server', allowed: false, trusted: true },\n\t\t\t\t{ id: 'user-server', name: 'User Server', allowed: true }\n\t\t\t]);\n\n\t\t\t// Check what's actually stored in storage (not including product.json servers)\n\t\t\tconst storageKey = 'mcpserver-github-user@example.com';\n\t\t\tconst storedData = JSON.parse(storageService.get(storageKey, StorageScope.APPLICATION) || '[]');\n\n\t\t\t// Should only contain the user-managed server, not the trusted one\n\t\t\tassert.strictEqual(storedData.length, 1);\n\t\t\tassert.strictEqual(storedData[0].id, 'user-server');\n\n\t\t\t// But readAllowedMcpServers should return both (including trusted from product.json)\n\t\t\tconst allServers = authenticationMcpAccessService.readAllowedMcpServers('github', 'user@example.com');\n\t\t\tassert.strictEqual(allServers.length, 2);\n\t\t});\n\n\t\ttest('fires onDidChangeMcpSessionAccess event', () => {\n\t\t\tlet eventFired = false;\n\t\t\tlet eventData: { providerId: string; accountName: string } | undefined;\n\n\t\t\tconst disposable = authenticationMcpAccessService.onDidChangeMcpSessionAccess(event => {\n\t\t\t\teventFired = true;\n\t\t\t\teventData = event;\n\t\t\t});\n\n\t\t\ttry {\n\t\t\t\tauthenticationMcpAccessService.updateAllowedMcpServers('github', 'user@example.com', [\n\t\t\t\t\t{ id: 'server1', name: 'Server 1', allowed: true }\n\t\t\t\t]);\n\n\t\t\t\tassert.strictEqual(eventFired, true);\n\t\t\t\tassert.ok(eventData);\n\t\t\t\tassert.strictEqual(eventData.providerId, 'github');\n\t\t\t\tassert.strictEqual(eventData.accountName, 'user@example.com');\n\t\t\t} finally {\n\t\t\t\tdisposable.dispose();\n\t\t\t}\n\t\t});\n\t});\n\n\tsuite('removeAllowedMcpServers', () => {\n\t\ttest('removes all stored MCP servers for account', () => {\n\t\t\t// First add some servers\n\t\t\tauthenticationMcpAccessService.updateAllowedMcpServers('github', 'user@example.com', [\n\t\t\t\t{ id: 'server1', name: 'Server 1', allowed: true },\n\t\t\t\t{ id: 'server2', name: 'Server 2', allowed: false }\n\t\t\t]);\n\n\t\t\t// Verify they exist\n\t\t\tlet result = authenticationMcpAccessService.readAllowedMcpServers('github', 'user@example.com');\n\t\t\tassert.strictEqual(result.length, 2);\n\n\t\t\t// Remove them\n\t\t\tauthenticationMcpAccessService.removeAllowedMcpServers('github', 'user@example.com');\n\n\t\t\t// Verify they're gone\n\t\t\tresult = authenticationMcpAccessService.readAllowedMcpServers('github', 'user@example.com');\n\t\t\tassert.strictEqual(result.length, 0);\n\t\t});\n\n\t\ttest('does not affect trusted servers from product.json', () => {\n\t\t\tproductService.trustedMcpAuthAccess = ['trusted-server'];\n\n\t\t\t// Add some user-managed servers\n\t\t\tauthenticationMcpAccessService.updateAllowedMcpServers('github', 'user@example.com', [\n\t\t\t\t{ id: 'user-server', name: 'User Server', allowed: true }\n\t\t\t]);\n\n\t\t\t// Verify both trusted and user servers exist\n\t\t\tlet result = authenticationMcpAccessService.readAllowedMcpServers('github', 'user@example.com');\n\t\t\tassert.strictEqual(result.length, 2);\n\n\t\t\t// Remove user servers\n\t\t\tauthenticationMcpAccessService.removeAllowedMcpServers('github', 'user@example.com');\n\n\t\t\t// Should still have trusted server\n\t\t\tresult = authenticationMcpAccessService.readAllowedMcpServers('github', 'user@example.com');\n\t\t\tassert.strictEqual(result.length, 1);\n\t\t\tassert.strictEqual(result[0].id, 'trusted-server');\n\t\t\tassert.strictEqual(result[0].trusted, true);\n\t\t});\n\n\t\ttest('fires onDidChangeMcpSessionAccess event', () => {\n\t\t\tlet eventFired = false;\n\t\t\tlet eventData: { providerId: string; accountName: string } | undefined;\n\n\t\t\tconst disposable = authenticationMcpAccessService.onDidChangeMcpSessionAccess(event => {\n\t\t\t\teventFired = true;\n\t\t\t\teventData = event;\n\t\t\t});\n\n\t\t\ttry {\n\t\t\t\tauthenticationMcpAccessService.removeAllowedMcpServers('github', 'user@example.com');\n\n\t\t\t\tassert.strictEqual(eventFired, true);\n\t\t\t\tassert.ok(eventData);\n\t\t\t\tassert.strictEqual(eventData.providerId, 'github');\n\t\t\t\tassert.strictEqual(eventData.accountName, 'user@example.com');\n\t\t\t} finally {\n\t\t\t\tdisposable.dispose();\n\t\t\t}\n\t\t});\n\n\t\ttest('handles removal of non-existent data gracefully', () => {\n\t\t\t// Should not throw when trying to remove data that doesn't exist\n\t\t\tassert.doesNotThrow(() => {\n\t\t\t\tauthenticationMcpAccessService.removeAllowedMcpServers('nonexistent', 'user@example.com');\n\t\t\t});\n\t\t});\n\t});\n\n\tsuite('onDidChangeMcpSessionAccess event', () => {\n\t\ttest('event is fired for each update operation', () => {\n\t\t\tconst events: Array<{ providerId: string; accountName: string }> = [];\n\n\t\t\tconst disposable = authenticationMcpAccessService.onDidChangeMcpSessionAccess(event => {\n\t\t\t\tevents.push(event);\n\t\t\t});\n\n\t\t\ttry {\n\t\t\t\t// Should fire for update\n\t\t\t\tauthenticationMcpAccessService.updateAllowedMcpServers('github', 'user@example.com', [\n\t\t\t\t\t{ id: 'server1', name: 'Server 1', allowed: true }\n\t\t\t\t]);\n\n\t\t\t\t// Should fire for remove\n\t\t\t\tauthenticationMcpAccessService.removeAllowedMcpServers('github', 'user@example.com');\n\n\t\t\t\t// Should fire for different account\n\t\t\t\tauthenticationMcpAccessService.updateAllowedMcpServers('microsoft', 'admin@company.com', [\n\t\t\t\t\t{ id: 'server2', name: 'Server 2', allowed: false }\n\t\t\t\t]);\n\n\t\t\t\tassert.strictEqual(events.length, 3);\n\t\t\t\tassert.strictEqual(events[0].providerId, 'github');\n\t\t\t\tassert.strictEqual(events[0].accountName, 'user@example.com');\n\t\t\t\tassert.strictEqual(events[1].providerId, 'github');\n\t\t\t\tassert.strictEqual(events[1].accountName, 'user@example.com');\n\t\t\t\tassert.strictEqual(events[2].providerId, 'microsoft');\n\t\t\t\tassert.strictEqual(events[2].accountName, 'admin@company.com');\n\t\t\t} finally {\n\t\t\t\tdisposable.dispose();\n\t\t\t}\n\t\t});\n\n\t\ttest('multiple listeners receive events', () => {\n\t\t\tlet listener1Fired = false;\n\t\t\tlet listener2Fired = false;\n\n\t\t\tconst disposable1 = authenticationMcpAccessService.onDidChangeMcpSessionAccess(() => {\n\t\t\t\tlistener1Fired = true;\n\t\t\t});\n\n\t\t\tconst disposable2 = authenticationMcpAccessService.onDidChangeMcpSessionAccess(() => {\n\t\t\t\tlistener2Fired = true;\n\t\t\t});\n\n\t\t\ttry {\n\t\t\t\tauthenticationMcpAccessService.updateAllowedMcpServers('github', 'user@example.com', [\n\t\t\t\t\t{ id: 'server1', name: 'Server 1', allowed: true }\n\t\t\t\t]);\n\n\t\t\t\tassert.strictEqual(listener1Fired, true);\n\t\t\t\tassert.strictEqual(listener2Fired, true);\n\t\t\t} finally {\n\t\t\t\tdisposable1.dispose();\n\t\t\t\tdisposable2.dispose();\n\t\t\t}\n\t\t});\n\t});\n\n\tsuite('integration scenarios', () => {\n\t\ttest('complete workflow: add, update, query, remove', () => {\n\t\t\tconst providerId = 'github';\n\t\t\tconst accountName = 'user@example.com';\n\t\t\tconst serverId = 'test-server';\n\n\t\t\t// Initially unknown\n\t\t\tassert.strictEqual(\n\t\t\t\tauthenticationMcpAccessService.isAccessAllowed(providerId, accountName, serverId),\n\t\t\t\tundefined\n\t\t\t);\n\n\t\t\t// Add server as allowed\n\t\t\tauthenticationMcpAccessService.updateAllowedMcpServers(providerId, accountName, [\n\t\t\t\t{ id: serverId, name: 'Test Server', allowed: true }\n\t\t\t]);\n\n\t\t\tassert.strictEqual(\n\t\t\t\tauthenticationMcpAccessService.isAccessAllowed(providerId, accountName, serverId),\n\t\t\t\ttrue\n\t\t\t);\n\n\t\t\t// Update to disallowed\n\t\t\tauthenticationMcpAccessService.updateAllowedMcpServers(providerId, accountName, [\n\t\t\t\t{ id: serverId, name: 'Test Server', allowed: false }\n\t\t\t]);\n\n\t\t\tassert.strictEqual(\n\t\t\t\tauthenticationMcpAccessService.isAccessAllowed(providerId, accountName, serverId),\n\t\t\t\tfalse\n\t\t\t);\n\n\t\t\t// Remove all\n\t\t\tauthenticationMcpAccessService.removeAllowedMcpServers(providerId, accountName);\n\n\t\t\tassert.strictEqual(\n\t\t\t\tauthenticationMcpAccessService.isAccessAllowed(providerId, accountName, serverId),\n\t\t\t\tundefined\n\t\t\t);\n\t\t});\n\n\t\ttest('multiple providers and accounts are isolated', () => {\n\t\t\t// Add data for different combinations\n\t\t\tauthenticationMcpAccessService.updateAllowedMcpServers('github', 'user1@example.com', [\n\t\t\t\t{ id: 'server1', name: 'Server 1', allowed: true }\n\t\t\t]);\n\n\t\t\tauthenticationMcpAccessService.updateAllowedMcpServers('github', 'user2@example.com', [\n\t\t\t\t{ id: 'server1', name: 'Server 1', allowed: false }\n\t\t\t]);\n\n\t\t\tauthenticationMcpAccessService.updateAllowedMcpServers('microsoft', 'user1@example.com', [\n\t\t\t\t{ id: 'server1', name: 'Server 1', allowed: true }\n\t\t\t]);\n\n\t\t\t// Verify isolation\n\t\t\tassert.strictEqual(\n\t\t\t\tauthenticationMcpAccessService.isAccessAllowed('github', 'user1@example.com', 'server1'),\n\t\t\t\ttrue\n\t\t\t);\n\t\t\tassert.strictEqual(\n\t\t\t\tauthenticationMcpAccessService.isAccessAllowed('github', 'user2@example.com', 'server1'),\n\t\t\t\tfalse\n\t\t\t);\n\t\t\tassert.strictEqual(\n\t\t\t\tauthenticationMcpAccessService.isAccessAllowed('microsoft', 'user1@example.com', 'server1'),\n\t\t\t\ttrue\n\t\t\t);\n\n\t\t\t// Non-existent combinations should return undefined\n\t\t\tassert.strictEqual(\n\t\t\t\tauthenticationMcpAccessService.isAccessAllowed('microsoft', 'user2@example.com', 'server1'),\n\t\t\t\tundefined\n\t\t\t);\n\t\t});\n\n\t\ttest('product.json configuration takes precedence in all scenarios', () => {\n\t\t\tproductService.trustedMcpAuthAccess = {\n\t\t\t\t'github': ['trusted-server'],\n\t\t\t\t'microsoft': ['microsoft-trusted']\n\t\t\t};\n\n\t\t\t// Trusted servers should always return true regardless of storage\n\t\t\tassert.strictEqual(\n\t\t\t\tauthenticationMcpAccessService.isAccessAllowed('github', 'user@example.com', 'trusted-server'),\n\t\t\t\ttrue\n\t\t\t);\n\n\t\t\t// Try to override via storage\n\t\t\tauthenticationMcpAccessService.updateAllowedMcpServers('github', 'user@example.com', [\n\t\t\t\t{ id: 'trusted-server', name: 'Trusted Server', allowed: false }\n\t\t\t]);\n\n\t\t\t// Should still return true\n\t\t\tassert.strictEqual(\n\t\t\t\tauthenticationMcpAccessService.isAccessAllowed('github', 'user@example.com', 'trusted-server'),\n\t\t\t\ttrue\n\t\t\t);\n\n\t\t\t// But non-trusted servers should still respect storage\n\t\t\tauthenticationMcpAccessService.updateAllowedMcpServers('github', 'user@example.com', [\n\t\t\t\t{ id: 'user-server', name: 'User Server', allowed: false }\n\t\t\t]);\n\n\t\t\tassert.strictEqual(\n\t\t\t\tauthenticationMcpAccessService.isAccessAllowed('github', 'user@example.com', 'user-server'),\n\t\t\t\tfalse\n\t\t\t);\n\t\t});\n\n\t\ttest('handles edge cases with empty or null values', () => {\n\t\t\t// Empty provider/account names\n\t\t\tassert.doesNotThrow(() => {\n\t\t\t\tauthenticationMcpAccessService.isAccessAllowed('', '', 'server1');\n\t\t\t});\n\n\t\t\t// Empty server arrays\n\t\t\tassert.doesNotThrow(() => {\n\t\t\t\tauthenticationMcpAccessService.updateAllowedMcpServers('github', 'user@example.com', []);\n\t\t\t});\n\n\t\t\t// Empty server ID/name\n\t\t\tassert.doesNotThrow(() => {\n\t\t\t\tauthenticationMcpAccessService.updateAllowedMcpServers('github', 'user@example.com', [\n\t\t\t\t\t{ id: '', name: '', allowed: true }\n\t\t\t\t]);\n\t\t\t});\n\t\t});\n\t});\n});\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport assert from 'assert';\nimport { ensureNoDisposablesAreLeakedInTestSuite } from '../../../../../base/test/common/utils.js';\nimport { TestInstantiationService } from '../../../../../platform/instantiation/test/common/instantiationServiceMock.js';\nimport { IStorageService, StorageScope, StorageTarget } from '../../../../../platform/storage/common/storage.js';\nimport { IProductService } from '../../../../../platform/product/common/productService.js';\nimport { TestStorageService, TestProductService } from '../../../../test/common/workbenchTestServices.js';\nimport { AuthenticationMcpAccessService, AllowedMcpServer, IAuthenticationMcpAccessService } from '../../browser/authenticationMcpAccessService.js';\n\nsuite('AuthenticationMcpAccessService', () => {\n\tconst disposables = ensureNoDisposablesAreLeakedInTestSuite();\n\n\tlet instantiationService: TestInstantiationService;\n\tlet storageService: TestStorageService;\n\tlet productService: IProductService & { trustedMcpAuthAccess?: string[] | Record<string, string[]> };\n\tlet authenticationMcpAccessService: IAuthenticationMcpAccessService;\n\n\tsetup(() => {\n\t\tinstantiationService = disposables.add(new TestInstantiationService());\n\n\t\t// Set up storage service\n\t\tstorageService = disposables.add(new TestStorageService());\n\t\tinstantiationService.stub(IStorageService, storageService);\n\n\t\t// Set up product service with no trusted servers by default\n\t\tproductService = { ...TestProductService };\n\t\tinstantiationService.stub(IProductService, productService);\n\n\t\t// Create the service instance\n\t\tauthenticationMcpAccessService = disposables.add(instantiationService.createInstance(AuthenticationMcpAccessService));\n\t});\n\n\tsuite('isAccessAllowed', () => {\n\t\ttest('returns undefined for unknown MCP server with no product configuration', () => {\n\t\t\tconst result = authenticationMcpAccessService.isAccessAllowed('github', 'user@example.com', 'unknown-server');\n\t\t\tassert.strictEqual(result, undefined);\n\t\t});\n\n\t\ttest('returns true for trusted MCP server from product.json (array format)', () => {\n\t\t\tproductService.trustedMcpAuthAccess = ['trusted-server-1', 'trusted-server-2'];\n\n\t\t\tconst result = authenticationMcpAccessService.isAccessAllowed('github', 'user@example.com', 'trusted-server-1');\n\t\t\tassert.strictEqual(result, true);\n\t\t});\n\n\t\ttest('returns true for trusted MCP server from product.json (object format)', () => {\n\t\t\tproductService.trustedMcpAuthAccess = {\n\t\t\t\t'github': ['github-server'],\n\t\t\t\t'microsoft': ['microsoft-server']\n\t\t\t};\n\n\t\t\tconst result1 = authenticationMcpAccessService.isAccessAllowed('github', 'user@example.com', 'github-server');\n\t\t\tassert.strictEqual(result1, true);\n\n\t\t\tconst result2 = authenticationMcpAccessService.isAccessAllowed('microsoft', 'user@microsoft.com', 'microsoft-server');\n\t\t\tassert.strictEqual(result2, true);\n\t\t});\n\n\t\ttest('returns undefined for MCP server not in trusted list', () => {\n\t\t\tproductService.trustedMcpAuthAccess = ['trusted-server'];\n\n\t\t\tconst result = authenticationMcpAccessService.isAccessAllowed('github', 'user@example.com', 'untrusted-server');\n\t\t\tassert.strictEqual(result, undefined);\n\t\t});\n\n\t\ttest('returns stored allowed state when server is in storage', () => {\n\t\t\t// Add server to storage\n\t\t\tauthenticationMcpAccessService.updateAllowedMcpServers('github', 'user@example.com', [{\n\t\t\t\tid: 'stored-server',\n\t\t\t\tname: 'Stored Server',\n\t\t\t\tallowed: false\n\t\t\t}]);\n\n\t\t\tconst result = authenticationMcpAccessService.isAccessAllowed('github', 'user@example.com', 'stored-server');\n\t\t\tassert.strictEqual(result, false);\n\t\t});\n\n\t\ttest('returns true for server in storage with allowed=true', () => {\n\t\t\tauthenticationMcpAccessService.updateAllowedMcpServers('github', 'user@example.com', [{\n\t\t\t\tid: 'allowed-server',\n\t\t\t\tname: 'Allowed Server',\n\t\t\t\tallowed: true\n\t\t\t}]);\n\n\t\t\tconst result = authenticationMcpAccessService.isAccessAllowed('github', 'user@example.com', 'allowed-server');\n\t\t\tassert.strictEqual(result, true);\n\t\t});\n\n\t\ttest('returns true for server in storage with undefined allowed property (legacy behavior)', () => {\n\t\t\t// Simulate legacy data where allowed property didn't exist\n\t\t\tconst legacyServer: AllowedMcpServer = {\n\t\t\t\tid: 'legacy-server',\n\t\t\t\tname: 'Legacy Server'\n\t\t\t\t// allowed property is undefined\n\t\t\t};\n\n\t\t\tauthenticationMcpAccessService.updateAllowedMcpServers('github', 'user@example.com', [legacyServer]);\n\n\t\t\tconst result = authenticationMcpAccessService.isAccessAllowed('github', 'user@example.com', 'legacy-server');\n\t\t\tassert.strictEqual(result, true);\n\t\t});\n\n\t\ttest('product.json trusted servers take precedence over storage', () => {\n\t\t\tproductService.trustedMcpAuthAccess = ['product-trusted-server'];\n\n\t\t\t// Try to store the same server as not allowed\n\t\t\tauthenticationMcpAccessService.updateAllowedMcpServers('github', 'user@example.com', [{\n\t\t\t\tid: 'product-trusted-server',\n\t\t\t\tname: 'Product Trusted Server',\n\t\t\t\tallowed: false\n\t\t\t}]);\n\n\t\t\t// Product.json should take precedence\n\t\t\tconst result = authenticationMcpAccessService.isAccessAllowed('github', 'user@example.com', 'product-trusted-server');\n\t\t\tassert.strictEqual(result, true);\n\t\t});\n\t});\n\n\tsuite('readAllowedMcpServers', () => {\n\t\ttest('returns empty array when no data exists', () => {\n\t\t\tconst result = authenticationMcpAccessService.readAllowedMcpServers('github', 'user@example.com');\n\t\t\tassert.strictEqual(result.length, 0);\n\t\t});\n\n\t\ttest('returns stored MCP servers', () => {\n\t\t\tconst servers: AllowedMcpServer[] = [\n\t\t\t\t{ id: 'server1', name: 'Server 1', allowed: true },\n\t\t\t\t{ id: 'server2', name: 'Server 2', allowed: false }\n\t\t\t];\n\n\t\t\tauthenticationMcpAccessService.updateAllowedMcpServers('github', 'user@example.com', servers);\n\n\t\t\tconst result = authenticationMcpAccessService.readAllowedMcpServers('github', 'user@example.com');\n\t\t\tassert.strictEqual(result.length, 2);\n\t\t\tassert.strictEqual(result[0].id, 'server1');\n\t\t\tassert.strictEqual(result[0].allowed, true);\n\t\t\tassert.strictEqual(result[1].id, 'server2');\n\t\t\tassert.strictEqual(result[1].allowed, false);\n\t\t});\n\n\t\ttest('includes trusted servers from product.json (array format)', () => {\n\t\t\tproductService.trustedMcpAuthAccess = ['trusted-server-1', 'trusted-server-2'];\n\n\t\t\tconst result = authenticationMcpAccessService.readAllowedMcpServers('github', 'user@example.com');\n\t\t\tassert.strictEqual(result.length, 2);\n\n\t\t\tconst trustedServer1 = result.find(s => s.id === 'trusted-server-1');\n\t\t\tassert.ok(trustedServer1);\n\t\t\tassert.strictEqual(trustedServer1.allowed, true);\n\t\t\tassert.strictEqual(trustedServer1.trusted, true);\n\t\t\tassert.strictEqual(trustedServer1.name, 'trusted-server-1'); // Should default to ID\n\n\t\t\tconst trustedServer2 = result.find(s => s.id === 'trusted-server-2');\n\t\t\tassert.ok(trustedServer2);\n\t\t\tassert.strictEqual(trustedServer2.allowed, true);\n\t\t\tassert.strictEqual(trustedServer2.trusted, true);\n\t\t});\n\n\t\ttest('includes trusted servers from product.json (object format)', () => {\n\t\t\tproductService.trustedMcpAuthAccess = {\n\t\t\t\t'github': ['github-server'],\n\t\t\t\t'microsoft': ['microsoft-server']\n\t\t\t};\n\n\t\t\tconst githubResult = authenticationMcpAccessService.readAllowedMcpServers('github', 'user@example.com');\n\t\t\tassert.strictEqual(githubResult.length, 1);\n\t\t\tassert.strictEqual(githubResult[0].id, 'github-server');\n\t\t\tassert.strictEqual(githubResult[0].trusted, true);\n\n\t\t\tconst microsoftResult = authenticationMcpAccessService.readAllowedMcpServers('microsoft', 'user@microsoft.com');\n\t\t\tassert.strictEqual(microsoftResult.length, 1);\n\t\t\tassert.strictEqual(microsoftResult[0].id, 'microsoft-server');\n\t\t\tassert.strictEqual(microsoftResult[0].trusted, true);\n\n\t\t\t// Provider not in trusted list should return empty (no stored servers)\n\t\t\tconst unknownResult = authenticationMcpAccessService.readAllowedMcpServers('unknown', 'user@unknown.com');\n\t\t\tassert.strictEqual(unknownResult.length, 0);\n\t\t});\n\n\t\ttest('merges stored servers with trusted servers from product.json', () => {\n\t\t\tproductService.trustedMcpAuthAccess = ['trusted-server'];\n\n\t\t\t// Add some stored servers\n\t\t\tauthenticationMcpAccessService.updateAllowedMcpServers('github', 'user@example.com', [\n\t\t\t\t{ id: 'stored-server', name: 'Stored Server', allowed: false }\n\t\t\t]);\n\n\t\t\tconst result = authenticationMcpAccessService.readAllowedMcpServers('github', 'user@example.com');\n\t\t\tassert.strictEqual(result.length, 2);\n\n\t\t\tconst trustedServer = result.find(s => s.id === 'trusted-server');\n\t\t\tassert.ok(trustedServer);\n\t\t\tassert.strictEqual(trustedServer.trusted, true);\n\t\t\tassert.strictEqual(trustedServer.allowed, true);\n\n\t\t\tconst storedServer = result.find(s => s.id === 'stored-server');\n\t\t\tassert.ok(storedServer);\n\t\t\tassert.strictEqual(storedServer.trusted, undefined);\n\t\t\tassert.strictEqual(storedServer.allowed, false);\n\t\t});\n\n\t\ttest('updates existing stored server to be trusted when it appears in product.json', () => {\n\t\t\t// First add a server as stored (not trusted)\n\t\t\tauthenticationMcpAccessService.updateAllowedMcpServers('github', 'user@example.com', [\n\t\t\t\t{ id: 'server-1', name: 'Server 1', allowed: false }\n\t\t\t]);\n\n\t\t\t// Then make it trusted via product.json\n\t\t\tproductService.trustedMcpAuthAccess = ['server-1'];\n\n\t\t\tconst result = authenticationMcpAccessService.readAllowedMcpServers('github', 'user@example.com');\n\t\t\tassert.strictEqual(result.length, 1);\n\n\t\t\tconst server = result[0];\n\t\t\tassert.strictEqual(server.id, 'server-1');\n\t\t\tassert.strictEqual(server.allowed, true); // Should be overridden to true\n\t\t\tassert.strictEqual(server.trusted, true); // Should be marked as trusted\n\t\t\tassert.strictEqual(server.name, 'Server 1'); // Should keep existing name\n\t\t});\n\n\t\ttest('handles malformed JSON in storage gracefully', () => {\n\t\t\t// Manually corrupt the storage\n\t\t\tstorageService.store('mcpserver-github-user@example.com', 'invalid json', StorageScope.APPLICATION, StorageTarget.USER);\n\n\t\t\t// Should return empty array instead of throwing\n\t\t\tconst result = authenticationMcpAccessService.readAllowedMcpServers('github', 'user@example.com');\n\t\t\tassert.strictEqual(result.length, 0);\n\t\t});\n\n\t\ttest('handles non-array product.json configuration gracefully', () => {\n\t\t\t// Set up invalid configuration\n\t\t\t// eslint-disable-next-line local/code-no-any-casts\n\t\t\tproductService.trustedMcpAuthAccess = 'invalid-string' as any;\n\n\t\t\tconst result = authenticationMcpAccessService.readAllowedMcpServers('github', 'user@example.com');\n\t\t\tassert.strictEqual(result.length, 0);\n\t\t});\n\t});\n\n\tsuite('updateAllowedMcpServers', () => {\n\t\ttest('stores new MCP servers', () => {\n\t\t\tconst servers: AllowedMcpServer[] = [\n\t\t\t\t{ id: 'server1', name: 'Server 1', allowed: true },\n\t\t\t\t{ id: 'server2', name: 'Server 2', allowed: false }\n\t\t\t];\n\n\t\t\tauthenticationMcpAccessService.updateAllowedMcpServers('github', 'user@example.com', servers);\n\n\t\t\tconst result = authenticationMcpAccessService.readAllowedMcpServers('github', 'user@example.com');\n\t\t\tassert.strictEqual(result.length, 2);\n\t\t\tassert.strictEqual(result[0].id, 'server1');\n\t\t\tassert.strictEqual(result[1].id, 'server2');\n\t\t});\n\n\t\ttest('updates existing MCP server allowed status', () => {\n\t\t\t// First add a server\n\t\t\tauthenticationMcpAccessService.updateAllowedMcpServers('github', 'user@example.com', [\n\t\t\t\t{ id: 'server1', name: 'Server 1', allowed: true }\n\t\t\t]);\n\n\t\t\t// Then update its allowed status\n\t\t\tauthenticationMcpAccessService.updateAllowedMcpServers('github', 'user@example.com', [\n\t\t\t\t{ id: 'server1', name: 'Server 1', allowed: false }\n\t\t\t]);\n\n\t\t\tconst result = authenticationMcpAccessService.readAllowedMcpServers('github', 'user@example.com');\n\t\t\tassert.strictEqual(result.length, 1);\n\t\t\tassert.strictEqual(result[0].allowed, false);\n\t\t});\n\n\t\ttest('updates existing MCP server name when new name is provided', () => {\n\t\t\t// First add a server with default name\n\t\t\tauthenticationMcpAccessService.updateAllowedMcpServers('github', 'user@example.com', [\n\t\t\t\t{ id: 'server1', name: 'server1', allowed: true }\n\t\t\t]);\n\n\t\t\t// Then update with a proper name\n\t\t\tauthenticationMcpAccessService.updateAllowedMcpServers('github', 'user@example.com', [\n\t\t\t\t{ id: 'server1', name: 'My Server', allowed: true }\n\t\t\t]);\n\n\t\t\tconst result = authenticationMcpAccessService.readAllowedMcpServers('github', 'user@example.com');\n\t\t\tassert.strictEqual(result.length, 1);\n\t\t\tassert.strictEqual(result[0].name, 'My Server');\n\t\t});\n\n\t\ttest('does not update name when new name is same as ID', () => {\n\t\t\t// First add a server with a proper name\n\t\t\tauthenticationMcpAccessService.updateAllowedMcpServers('github', 'user@example.com', [\n\t\t\t\t{ id: 'server1', name: 'My Server', allowed: true }\n\t\t\t]);\n\n\t\t\t// Then try to update with ID as name (should keep existing name)\n\t\t\tauthenticationMcpAccessService.updateAllowedMcpServers('github', 'user@example.com', [\n\t\t\t\t{ id: 'server1', name: 'server1', allowed: false }\n\t\t\t]);\n\n\t\t\tconst result = authenticationMcpAccessService.readAllowedMcpServers('github', 'user@example.com');\n\t\t\tassert.strictEqual(result.length, 1);\n\t\t\tassert.strictEqual(result[0].name, 'My Server'); // Should keep original name\n\t\t\tassert.strictEqual(result[0].allowed, false); // But allowed status should update\n\t\t});\n\n\t\ttest('adds new servers while preserving existing ones', () => {\n\t\t\t// First add one server\n\t\t\tauthenticationMcpAccessService.updateAllowedMcpServers('github', 'user@example.com', [\n\t\t\t\t{ id: 'server1', name: 'Server 1', allowed: true }\n\t\t\t]);\n\n\t\t\t// Then add another server\n\t\t\tauthenticationMcpAccessService.updateAllowedMcpServers('github', 'user@example.com', [\n\t\t\t\t{ id: 'server2', name: 'Server 2', allowed: false }\n\t\t\t]);\n\n\t\t\tconst result = authenticationMcpAccessService.readAllowedMcpServers('github', 'user@example.com');\n\t\t\tassert.strictEqual(result.length, 2);\n\n\t\t\tconst server1 = result.find(s => s.id === 'server1');\n\t\t\tconst server2 = result.find(s => s.id === 'server2');\n\t\t\tassert.ok(server1);\n\t\t\tassert.ok(server2);\n\t\t\tassert.strictEqual(server1.allowed, true);\n\t\t\tassert.strictEqual(server2.allowed, false);\n\t\t});\n\n\t\ttest('does not store trusted servers from product.json', () => {\n\t\t\tproductService.trustedMcpAuthAccess = ['trusted-server'];\n\n\t\t\t// Try to update a trusted server\n\t\t\tauthenticationMcpAccessService.updateAllowedMcpServers('github', 'user@example.com', [\n\t\t\t\t{ id: 'trusted-server', name: 'Trusted Server', allowed: false, trusted: true },\n\t\t\t\t{ id: 'user-server', name: 'User Server', allowed: true }\n\t\t\t]);\n\n\t\t\t// Check what's actually stored in storage (not including product.json servers)\n\t\t\tconst storageKey = 'mcpserver-github-user@example.com';\n\t\t\tconst storedData = JSON.parse(storageService.get(storageKey, StorageScope.APPLICATION) || '[]');\n\n\t\t\t// Should only contain the user-managed server, not the trusted one\n\t\t\tassert.strictEqual(storedData.length, 1);\n\t\t\tassert.strictEqual(storedData[0].id, 'user-server');\n\n\t\t\t// But readAllowedMcpServers should return both (including trusted from product.json)\n\t\t\tconst allServers = authenticationMcpAccessService.readAllowedMcpServers('github', 'user@example.com');\n\t\t\tassert.strictEqual(allServers.length, 2);\n\t\t});\n\n\t\ttest('fires onDidChangeMcpSessionAccess event', () => {\n\t\t\tlet eventFired = false;\n\t\t\tlet eventData: { providerId: string; accountName: string } | undefined;\n\n\t\t\tconst disposable = authenticationMcpAccessService.onDidChangeMcpSessionAccess(event => {\n\t\t\t\teventFired = true;\n\t\t\t\teventData = event;\n\t\t\t});\n\n\t\t\ttry {\n\t\t\t\tauthenticationMcpAccessService.updateAllowedMcpServers('github', 'user@example.com', [\n\t\t\t\t\t{ id: 'server1', name: 'Server 1', allowed: true }\n\t\t\t\t]);\n\n\t\t\t\tassert.strictEqual(eventFired, true);\n\t\t\t\tassert.ok(eventData);\n\t\t\t\tassert.strictEqual(eventData.providerId, 'github');\n\t\t\t\tassert.strictEqual(eventData.accountName, 'user@example.com');\n\t\t\t} finally {\n\t\t\t\tdisposable.dispose();\n\t\t\t}\n\t\t});\n\t});\n\n\tsuite('removeAllowedMcpServers', () => {\n\t\ttest('removes all stored MCP servers for account', () => {\n\t\t\t// First add some servers\n\t\t\tauthenticationMcpAccessService.updateAllowedMcpServers('github', 'user@example.com', [\n\t\t\t\t{ id: 'server1', name: 'Server 1', allowed: true },\n\t\t\t\t{ id: 'server2', name: 'Server 2', allowed: false }\n\t\t\t]);\n\n\t\t\t// Verify they exist\n\t\t\tlet result = authenticationMcpAccessService.readAllowedMcpServers('github', 'user@example.com');\n\t\t\tassert.strictEqual(result.length, 2);\n\n\t\t\t// Remove them\n\t\t\tauthenticationMcpAccessService.removeAllowedMcpServers('github', 'user@example.com');\n\n\t\t\t// Verify they're gone\n\t\t\tresult = authenticationMcpAccessService.readAllowedMcpServers('github', 'user@example.com');\n\t\t\tassert.strictEqual(result.length, 0);\n\t\t});\n\n\t\ttest('does not affect trusted servers from product.json', () => {\n\t\t\tproductService.trustedMcpAuthAccess = ['trusted-server'];\n\n\t\t\t// Add some user-managed servers\n\t\t\tauthenticationMcpAccessService.updateAllowedMcpServers('github', 'user@example.com', [\n\t\t\t\t{ id: 'user-server', name: 'User Server', allowed: true }\n\t\t\t]);\n\n\t\t\t// Verify both trusted and user servers exist\n\t\t\tlet result = authenticationMcpAccessService.readAllowedMcpServers('github', 'user@example.com');\n\t\t\tassert.strictEqual(result.length, 2);\n\n\t\t\t// Remove user servers\n\t\t\tauthenticationMcpAccessService.removeAllowedMcpServers('github', 'user@example.com');\n\n\t\t\t// Should still have trusted server\n\t\t\tresult = authenticationMcpAccessService.readAllowedMcpServers('github', 'user@example.com');\n\t\t\tassert.strictEqual(result.length, 1);\n\t\t\tassert.strictEqual(result[0].id, 'trusted-server');\n\t\t\tassert.strictEqual(result[0].trusted, true);\n\t\t});\n\n\t\ttest('fires onDidChangeMcpSessionAccess event', () => {\n\t\t\tlet eventFired = false;\n\t\t\tlet eventData: { providerId: string; accountName: string } | undefined;\n\n\t\t\tconst disposable = authenticationMcpAccessService.onDidChangeMcpSessionAccess(event => {\n\t\t\t\teventFired = true;\n\t\t\t\teventData = event;\n\t\t\t});\n\n\t\t\ttry {\n\t\t\t\tauthenticationMcpAccessService.removeAllowedMcpServers('github', 'user@example.com');\n\n\t\t\t\tassert.strictEqual(eventFired, true);\n\t\t\t\tassert.ok(eventData);\n\t\t\t\tassert.strictEqual(eventData.providerId, 'github');\n\t\t\t\tassert.strictEqual(eventData.accountName, 'user@example.com');\n\t\t\t} finally {\n\t\t\t\tdisposable.dispose();\n\t\t\t}\n\t\t});\n\n\t\ttest('handles removal of non-existent data gracefully', () => {\n\t\t\t// Should not throw when trying to remove data that doesn't exist\n\t\t\tassert.doesNotThrow(() => {\n\t\t\t\tauthenticationMcpAccessService.removeAllowedMcpServers('nonexistent', 'user@example.com');\n\t\t\t});\n\t\t});\n\t});\n\n\tsuite('onDidChangeMcpSessionAccess event', () => {\n\t\ttest('event is fired for each update operation', () => {\n\t\t\tconst events: Array<{ providerId: string; accountName: string }> = [];\n\n\t\t\tconst disposable = authenticationMcpAccessService.onDidChangeMcpSessionAccess(event => {\n\t\t\t\tevents.push(event);\n\t\t\t});\n\n\t\t\ttry {\n\t\t\t\t// Should fire for update\n\t\t\t\tauthenticationMcpAccessService.updateAllowedMcpServers('github', 'user@example.com', [\n\t\t\t\t\t{ id: 'server1', name: 'Server 1', allowed: true }\n\t\t\t\t]);\n\n\t\t\t\t// Should fire for remove\n\t\t\t\tauthenticationMcpAccessService.removeAllowedMcpServers('github', 'user@example.com');\n\n\t\t\t\t// Should fire for different account\n\t\t\t\tauthenticationMcpAccessService.updateAllowedMcpServers('microsoft', 'admin@company.com', [\n\t\t\t\t\t{ id: 'server2', name: 'Server 2', allowed: false }\n\t\t\t\t]);\n\n\t\t\t\tassert.strictEqual(events.length, 3);\n\t\t\t\tassert.strictEqual(events[0].providerId, 'github');\n\t\t\t\tassert.strictEqual(events[0].accountName, 'user@example.com');\n\t\t\t\tassert.strictEqual(events[1].providerId, 'github');\n\t\t\t\tassert.strictEqual(events[1].accountName, 'user@example.com');\n\t\t\t\tassert.strictEqual(events[2].providerId, 'microsoft');\n\t\t\t\tassert.strictEqual(events[2].accountName, 'admin@company.com');\n\t\t\t} finally {\n\t\t\t\tdisposable.dispose();\n\t\t\t}\n\t\t});\n\n\t\ttest('multiple listeners receive events', () => {\n\t\t\tlet listener1Fired = false;\n\t\t\tlet listener2Fired = false;\n\n\t\t\tconst disposable1 = authenticationMcpAccessService.onDidChangeMcpSessionAccess(() => {\n\t\t\t\tlistener1Fired = true;\n\t\t\t});\n\n\t\t\tconst disposable2 = authenticationMcpAccessService.onDidChangeMcpSessionAccess(() => {\n\t\t\t\tlistener2Fired = true;\n\t\t\t});\n\n\t\t\ttry {\n\t\t\t\tauthenticationMcpAccessService.updateAllowedMcpServers('github', 'user@example.com', [\n\t\t\t\t\t{ id: 'server1', name: 'Server 1', allowed: true }\n\t\t\t\t]);\n\n\t\t\t\tassert.strictEqual(listener1Fired, true);\n\t\t\t\tassert.strictEqual(listener2Fired, true);\n\t\t\t} finally {\n\t\t\t\tdisposable1.dispose();\n\t\t\t\tdisposable2.dispose();\n\t\t\t}\n\t\t});\n\t});\n\n\tsuite('integration scenarios', () => {\n\t\ttest('complete workflow: add, update, query, remove', () => {\n\t\t\tconst providerId = 'github';\n\t\t\tconst accountName = 'user@example.com';\n\t\t\tconst serverId = 'test-server';\n\n\t\t\t// Initially unknown\n\t\t\tassert.strictEqual(\n\t\t\t\tauthenticationMcpAccessService.isAccessAllowed(providerId, accountName, serverId),\n\t\t\t\tundefined\n\t\t\t);\n\n\t\t\t// Add server as allowed\n\t\t\tauthenticationMcpAccessService.updateAllowedMcpServers(providerId, accountName, [\n\t\t\t\t{ id: serverId, name: 'Test Server', allowed: true }\n\t\t\t]);\n\n\t\t\tassert.strictEqual(\n\t\t\t\tauthenticationMcpAccessService.isAccessAllowed(providerId, accountName, serverId),\n\t\t\t\ttrue\n\t\t\t);\n\n\t\t\t// Update to disallowed\n\t\t\tauthenticationMcpAccessService.updateAllowedMcpServers(providerId, accountName, [\n\t\t\t\t{ id: serverId, name: 'Test Server', allowed: false }\n\t\t\t]);\n\n\t\t\tassert.strictEqual(\n\t\t\t\tauthenticationMcpAccessService.isAccessAllowed(providerId, accountName, serverId),\n\t\t\t\tfalse\n\t\t\t);\n\n\t\t\t// Remove all\n\t\t\tauthenticationMcpAccessService.removeAllowedMcpServers(providerId, accountName);\n\n\t\t\tassert.strictEqual(\n\t\t\t\tauthenticationMcpAccessService.isAccessAllowed(providerId, accountName, serverId),\n\t\t\t\tundefined\n\t\t\t);\n\t\t});\n\n\t\ttest('multiple providers and accounts are isolated', () => {\n\t\t\t// Add data for different combinations\n\t\t\tauthenticationMcpAccessService.updateAllowedMcpServers('github', 'user1@example.com', [\n\t\t\t\t{ id: 'server1', name: 'Server 1', allowed: true }\n\t\t\t]);\n\n\t\t\tauthenticationMcpAccessService.updateAllowedMcpServers('github', 'user2@example.com', [\n\t\t\t\t{ id: 'server1', name: 'Server 1', allowed: false }\n\t\t\t]);\n\n\t\t\tauthenticationMcpAccessService.updateAllowedMcpServers('microsoft', 'user1@example.com', [\n\t\t\t\t{ id: 'server1', name: 'Server 1', allowed: true }\n\t\t\t]);\n\n\t\t\t// Verify isolation\n\t\t\tassert.strictEqual(\n\t\t\t\tauthenticationMcpAccessService.isAccessAllowed('github', 'user1@example.com', 'server1'),\n\t\t\t\ttrue\n\t\t\t);\n\t\t\tassert.strictEqual(\n\t\t\t\tauthenticationMcpAccessService.isAccessAllowed('github', 'user2@example.com', 'server1'),\n\t\t\t\tfalse\n\t\t\t);\n\t\t\tassert.strictEqual(\n\t\t\t\tauthenticationMcpAccessService.isAccessAllowed('microsoft', 'user1@example.com', 'server1'),\n\t\t\t\ttrue\n\t\t\t);\n\n\t\t\t// Non-existent combinations should return undefined\n\t\t\tassert.strictEqual(\n\t\t\t\tauthenticationMcpAccessService.isAccessAllowed('microsoft', 'user2@example.com', 'server1'),\n\t\t\t\tundefined\n\t\t\t);\n\t\t});\n\n\t\ttest('product.json configuration takes precedence in all scenarios', () => {\n\t\t\tproductService.trustedMcpAuthAccess = {\n\t\t\t\t'github': ['trusted-server'],\n\t\t\t\t'microsoft': ['microsoft-trusted']\n\t\t\t};\n\n\t\t\t// Trusted servers should always return true regardless of storage\n\t\t\tassert.strictEqual(\n\t\t\t\tauthenticationMcpAccessService.isAccessAllowed('github', 'user@example.com', 'trusted-server'),\n\t\t\t\ttrue\n\t\t\t);\n\n\t\t\t// Try to override via storage\n\t\t\tauthenticationMcpAccessService.updateAllowedMcpServers('github', 'user@example.com', [\n\t\t\t\t{ id: 'trusted-server', name: 'Trusted Server', allowed: false }\n\t\t\t]);\n\n\t\t\t// Should still return true\n\t\t\tassert.strictEqual(\n\t\t\t\tauthenticationMcpAccessService.isAccessAllowed('github', 'user@example.com', 'trusted-server'),\n\t\t\t\ttrue\n\t\t\t);\n\n\t\t\t// But non-trusted servers should still respect storage\n\t\t\tauthenticationMcpAccessService.updateAllowedMcpServers('github', 'user@example.com', [\n\t\t\t\t{ id: 'user-server', name: 'User Server', allowed: false }\n\t\t\t]);\n\n\t\t\tassert.strictEqual(\n\t\t\t\tauthenticationMcpAccessService.isAccessAllowed('github', 'user@example.com', 'user-server'),\n\t\t\t\tfalse\n\t\t\t);\n\t\t});\n\n\t\ttest('handles edge cases with empty or null values', () => {\n\t\t\t// Empty provider/account names\n\t\t\tassert.doesNotThrow(() => {\n\t\t\t\tauthenticationMcpAccessService.isAccessAllowed('', '', 'server1');\n\t\t\t});\n\n\t\t\t// Empty server arrays\n\t\t\tassert.doesNotThrow(() => {\n\t\t\t\tauthenticationMcpAccessService.updateAllowedMcpServers('github', 'user@example.com', []);\n\t\t\t});\n\n\t\t\t// Empty server ID/name\n\t\t\tassert.doesNotThrow(() => {\n\t\t\t\tauthenticationMcpAccessService.updateAllowedMcpServers('github', 'user@example.com', [\n\t\t\t\t\t{ id: '', name: '', allowed: true }\n\t\t\t\t]);\n\t\t\t});\n\t\t});\n\t});\n});\n"]}