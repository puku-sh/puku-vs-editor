{"version":3,"sources":["vs/workbench/services/authentication/browser/authenticationMcpService.ts"],"names":[],"mappings":"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","file":"authenticationMcpService.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Disposable, DisposableStore, dispose, IDisposable, MutableDisposable } from '../../../../base/common/lifecycle.js';\nimport { scopesMatch } from '../../../../base/common/oauth.js';\nimport * as nls from '../../../../nls.js';\nimport { MenuId, MenuRegistry } from '../../../../platform/actions/common/actions.js';\nimport { CommandsRegistry } from '../../../../platform/commands/common/commands.js';\nimport { IDialogService } from '../../../../platform/dialogs/common/dialogs.js';\nimport { InstantiationType, registerSingleton } from '../../../../platform/instantiation/common/extensions.js';\nimport { Severity } from '../../../../platform/notification/common/notification.js';\nimport { IQuickInputService } from '../../../../platform/quickinput/common/quickInput.js';\nimport { IStorageService, StorageScope, StorageTarget } from '../../../../platform/storage/common/storage.js';\nimport { IActivityService, NumberBadge } from '../../activity/common/activity.js';\nimport { IAuthenticationMcpAccessService } from './authenticationMcpAccessService.js';\nimport { IAuthenticationMcpUsageService } from './authenticationMcpUsageService.js';\nimport { AuthenticationSession, IAuthenticationProvider, IAuthenticationService, AuthenticationSessionAccount } from '../common/authentication.js';\nimport { Emitter, Event } from '../../../../base/common/event.js';\nimport { IProductService } from '../../../../platform/product/common/productService.js';\nimport { createDecorator } from '../../../../platform/instantiation/common/instantiation.js';\n\n// OAuth2 spec prohibits space in a scope, so use that to join them.\nconst SCOPESLIST_SEPARATOR = ' ';\n\ninterface SessionRequest {\n\tdisposables: IDisposable[];\n\trequestingMcpServerIds: string[];\n}\n\ninterface SessionRequestInfo {\n\t[scopesList: string]: SessionRequest;\n}\n\n// TODO: Move this into MainThreadAuthentication\nexport const IAuthenticationMcpService = createDecorator<IAuthenticationMcpService>('IAuthenticationMcpService');\nexport interface IAuthenticationMcpService {\n\treadonly _serviceBrand: undefined;\n\n\t/**\n\t * Fires when an account preference for a specific provider has changed for the specified MCP servers. Does not fire when:\n\t * * An account preference is removed\n\t * * A session preference is changed (because it's deprecated)\n\t * * A session preference is removed (because it's deprecated)\n\t */\n\treadonly onDidChangeAccountPreference: Event<{ mcpServerIds: string[]; providerId: string }>;\n\t/**\n\t * Returns the accountName (also known as account.label) to pair with `IAuthenticationMCPServerAccessService` to get the account preference\n\t * @param providerId The authentication provider id\n\t * @param mcpServerId The MCP server id to get the preference for\n\t * @returns The accountName of the preference, or undefined if there is no preference set\n\t */\n\tgetAccountPreference(mcpServerId: string, providerId: string): string | undefined;\n\t/**\n\t * Sets the account preference for the given provider and MCP server\n\t * @param providerId The authentication provider id\n\t * @param mcpServerId The MCP server id to set the preference for\n\t * @param account The account to set the preference to\n\t */\n\tupdateAccountPreference(mcpServerId: string, providerId: string, account: AuthenticationSessionAccount): void;\n\t/**\n\t * Removes the account preference for the given provider and MCP server\n\t * @param providerId The authentication provider id\n\t * @param mcpServerId The MCP server id to remove the preference for\n\t */\n\tremoveAccountPreference(mcpServerId: string, providerId: string): void;\n\t/**\n\t * @deprecated Sets the session preference for the given provider and MCP server\n\t * @param providerId\n\t * @param mcpServerId\n\t * @param session\n\t */\n\tupdateSessionPreference(providerId: string, mcpServerId: string, session: AuthenticationSession): void;\n\t/**\n\t * @deprecated Gets the session preference for the given provider and MCP server\n\t * @param providerId\n\t * @param mcpServerId\n\t * @param scopes\n\t */\n\tgetSessionPreference(providerId: string, mcpServerId: string, scopes: string[]): string | undefined;\n\t/**\n\t * @deprecated Removes the session preference for the given provider and MCP server\n\t * @param providerId\n\t * @param mcpServerId\n\t * @param scopes\n\t */\n\tremoveSessionPreference(providerId: string, mcpServerId: string, scopes: string[]): void;\n\tselectSession(providerId: string, mcpServerId: string, mcpServerName: string, scopes: string[], possibleSessions: readonly AuthenticationSession[]): Promise<AuthenticationSession>;\n\trequestSessionAccess(providerId: string, mcpServerId: string, mcpServerName: string, scopes: string[], possibleSessions: readonly AuthenticationSession[]): void;\n\trequestNewSession(providerId: string, scopes: string[], mcpServerId: string, mcpServerName: string): Promise<void>;\n}\n\n// TODO@TylerLeonhardt: This should all go in MainThreadAuthentication\nexport class AuthenticationMcpService extends Disposable implements IAuthenticationMcpService {\n\tdeclare readonly _serviceBrand: undefined;\n\tprivate _signInRequestItems = new Map<string, SessionRequestInfo>();\n\tprivate _sessionAccessRequestItems = new Map<string, { [mcpServerId: string]: { disposables: IDisposable[]; possibleSessions: AuthenticationSession[] } }>();\n\tprivate readonly _accountBadgeDisposable = this._register(new MutableDisposable());\n\n\tprivate _onDidAccountPreferenceChange: Emitter<{ providerId: string; mcpServerIds: string[] }> = this._register(new Emitter<{ providerId: string; mcpServerIds: string[] }>());\n\treadonly onDidChangeAccountPreference = this._onDidAccountPreferenceChange.event;\n\n\tprivate _inheritAuthAccountPreferenceParentToChildren: Record<string, string[]>;\n\tprivate _inheritAuthAccountPreferenceChildToParent: { [mcpServerId: string]: string };\n\n\tconstructor(\n\t\t@IActivityService private readonly activityService: IActivityService,\n\t\t@IStorageService private readonly storageService: IStorageService,\n\t\t@IDialogService private readonly dialogService: IDialogService,\n\t\t@IQuickInputService private readonly quickInputService: IQuickInputService,\n\t\t@IProductService private readonly _productService: IProductService,\n\t\t@IAuthenticationService private readonly _authenticationService: IAuthenticationService,\n\t\t@IAuthenticationMcpUsageService private readonly _authenticationUsageService: IAuthenticationMcpUsageService,\n\t\t@IAuthenticationMcpAccessService private readonly _authenticationAccessService: IAuthenticationMcpAccessService\n\t) {\n\t\tsuper();\n\t\tthis._inheritAuthAccountPreferenceParentToChildren = this._productService.inheritAuthAccountPreference || {};\n\t\tthis._inheritAuthAccountPreferenceChildToParent = Object.entries(this._inheritAuthAccountPreferenceParentToChildren).reduce<{ [mcpServerId: string]: string }>((acc, [parent, children]) => {\n\t\t\tchildren.forEach((child: string) => {\n\t\t\t\tacc[child] = parent;\n\t\t\t});\n\t\t\treturn acc;\n\t\t}, {});\n\t\tthis.registerListeners();\n\t}\n\n\tprivate registerListeners() {\n\t\tthis._register(this._authenticationService.onDidChangeSessions(async e => {\n\t\t\tif (e.event.added?.length) {\n\t\t\t\tawait this.updateNewSessionRequests(e.providerId, e.event.added);\n\t\t\t}\n\t\t\tif (e.event.removed?.length) {\n\t\t\t\tawait this.updateAccessRequests(e.providerId, e.event.removed);\n\t\t\t}\n\t\t\tthis.updateBadgeCount();\n\t\t}));\n\n\t\tthis._register(this._authenticationService.onDidUnregisterAuthenticationProvider(e => {\n\t\t\tconst accessRequests = this._sessionAccessRequestItems.get(e.id) || {};\n\t\t\tObject.keys(accessRequests).forEach(mcpServerId => {\n\t\t\t\tthis.removeAccessRequest(e.id, mcpServerId);\n\t\t\t});\n\t\t}));\n\t}\n\n\tprivate async updateNewSessionRequests(providerId: string, addedSessions: readonly AuthenticationSession[]): Promise<void> {\n\t\tconst existingRequestsForProvider = this._signInRequestItems.get(providerId);\n\t\tif (!existingRequestsForProvider) {\n\t\t\treturn;\n\t\t}\n\n\t\tObject.keys(existingRequestsForProvider).forEach(requestedScopes => {\n\t\t\t// Parse the requested scopes from the stored key\n\t\t\tconst requestedScopesArray = requestedScopes.split(SCOPESLIST_SEPARATOR);\n\n\t\t\t// Check if any added session has matching scopes (order-independent)\n\t\t\tif (addedSessions.some(session => scopesMatch(session.scopes, requestedScopesArray))) {\n\t\t\t\tconst sessionRequest = existingRequestsForProvider[requestedScopes];\n\t\t\t\tsessionRequest?.disposables.forEach(item => item.dispose());\n\n\t\t\t\tdelete existingRequestsForProvider[requestedScopes];\n\t\t\t\tif (Object.keys(existingRequestsForProvider).length === 0) {\n\t\t\t\t\tthis._signInRequestItems.delete(providerId);\n\t\t\t\t} else {\n\t\t\t\t\tthis._signInRequestItems.set(providerId, existingRequestsForProvider);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\tprivate async updateAccessRequests(providerId: string, removedSessions: readonly AuthenticationSession[]) {\n\t\tconst providerRequests = this._sessionAccessRequestItems.get(providerId);\n\t\tif (providerRequests) {\n\t\t\tObject.keys(providerRequests).forEach(mcpServerId => {\n\t\t\t\tremovedSessions.forEach(removed => {\n\t\t\t\t\tconst indexOfSession = providerRequests[mcpServerId].possibleSessions.findIndex(session => session.id === removed.id);\n\t\t\t\t\tif (indexOfSession) {\n\t\t\t\t\t\tproviderRequests[mcpServerId].possibleSessions.splice(indexOfSession, 1);\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tif (!providerRequests[mcpServerId].possibleSessions.length) {\n\t\t\t\t\tthis.removeAccessRequest(providerId, mcpServerId);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\tprivate updateBadgeCount(): void {\n\t\tthis._accountBadgeDisposable.clear();\n\n\t\tlet numberOfRequests = 0;\n\t\tthis._signInRequestItems.forEach(providerRequests => {\n\t\t\tObject.keys(providerRequests).forEach(request => {\n\t\t\t\tnumberOfRequests += providerRequests[request].requestingMcpServerIds.length;\n\t\t\t});\n\t\t});\n\n\t\tthis._sessionAccessRequestItems.forEach(accessRequest => {\n\t\t\tnumberOfRequests += Object.keys(accessRequest).length;\n\t\t});\n\n\t\tif (numberOfRequests > 0) {\n\t\t\tconst badge = new NumberBadge(numberOfRequests, () => nls.localize('sign in', \"Sign in requested\"));\n\t\t\tthis._accountBadgeDisposable.value = this.activityService.showAccountsActivity({ badge });\n\t\t}\n\t}\n\n\tprivate removeAccessRequest(providerId: string, mcpServerId: string): void {\n\t\tconst providerRequests = this._sessionAccessRequestItems.get(providerId) || {};\n\t\tif (providerRequests[mcpServerId]) {\n\t\t\tdispose(providerRequests[mcpServerId].disposables);\n\t\t\tdelete providerRequests[mcpServerId];\n\t\t\tthis.updateBadgeCount();\n\t\t}\n\t}\n\n\t//#region Account/Session Preference\n\n\tupdateAccountPreference(mcpServerId: string, providerId: string, account: AuthenticationSessionAccount): void {\n\t\tconst parentMcpServerId = this._inheritAuthAccountPreferenceChildToParent[mcpServerId] ?? mcpServerId;\n\t\tconst key = this._getKey(parentMcpServerId, providerId);\n\n\t\t// Store the preference in the workspace and application storage. This allows new workspaces to\n\t\t// have a preference set already to limit the number of prompts that are shown... but also allows\n\t\t// a specific workspace to override the global preference.\n\t\tthis.storageService.store(key, account.label, StorageScope.WORKSPACE, StorageTarget.MACHINE);\n\t\tthis.storageService.store(key, account.label, StorageScope.APPLICATION, StorageTarget.MACHINE);\n\n\t\tconst childrenMcpServers = this._inheritAuthAccountPreferenceParentToChildren[parentMcpServerId];\n\t\tconst mcpServerIds = childrenMcpServers ? [parentMcpServerId, ...childrenMcpServers] : [parentMcpServerId];\n\t\tthis._onDidAccountPreferenceChange.fire({ mcpServerIds, providerId });\n\t}\n\n\tgetAccountPreference(mcpServerId: string, providerId: string): string | undefined {\n\t\tconst key = this._getKey(this._inheritAuthAccountPreferenceChildToParent[mcpServerId] ?? mcpServerId, providerId);\n\n\t\t// If a preference is set in the workspace, use that. Otherwise, use the global preference.\n\t\treturn this.storageService.get(key, StorageScope.WORKSPACE) ?? this.storageService.get(key, StorageScope.APPLICATION);\n\t}\n\n\tremoveAccountPreference(mcpServerId: string, providerId: string): void {\n\t\tconst key = this._getKey(this._inheritAuthAccountPreferenceChildToParent[mcpServerId] ?? mcpServerId, providerId);\n\n\t\t// This won't affect any other workspaces that have a preference set, but it will remove the preference\n\t\t// for this workspace and the global preference. This is only paired with a call to updateSessionPreference...\n\t\t// so we really don't _need_ to remove them as they are about to be overridden anyway... but it's more correct\n\t\t// to remove them first... and in case this gets called from somewhere else in the future.\n\t\tthis.storageService.remove(key, StorageScope.WORKSPACE);\n\t\tthis.storageService.remove(key, StorageScope.APPLICATION);\n\t}\n\n\tprivate _getKey(mcpServerId: string, providerId: string): string {\n\t\treturn `${mcpServerId}-${providerId}`;\n\t}\n\n\t// TODO@TylerLeonhardt: Remove all of this after a couple iterations\n\n\tupdateSessionPreference(providerId: string, mcpServerId: string, session: AuthenticationSession): void {\n\t\t// The 3 parts of this key are important:\n\t\t// * MCP server id: The MCP server that has a preference\n\t\t// * Provider id: The provider that the preference is for\n\t\t// * The scopes: The subset of sessions that the preference applies to\n\t\tconst key = `${mcpServerId}-${providerId}-${session.scopes.join(SCOPESLIST_SEPARATOR)}`;\n\n\t\t// Store the preference in the workspace and application storage. This allows new workspaces to\n\t\t// have a preference set already to limit the number of prompts that are shown... but also allows\n\t\t// a specific workspace to override the global preference.\n\t\tthis.storageService.store(key, session.id, StorageScope.WORKSPACE, StorageTarget.MACHINE);\n\t\tthis.storageService.store(key, session.id, StorageScope.APPLICATION, StorageTarget.MACHINE);\n\t}\n\n\tgetSessionPreference(providerId: string, mcpServerId: string, scopes: string[]): string | undefined {\n\t\t// The 3 parts of this key are important:\n\t\t// * MCP server id: The MCP server that has a preference\n\t\t// * Provider id: The provider that the preference is for\n\t\t// * The scopes: The subset of sessions that the preference applies to\n\t\tconst key = `${mcpServerId}-${providerId}-${scopes.join(SCOPESLIST_SEPARATOR)}`;\n\n\t\t// If a preference is set in the workspace, use that. Otherwise, use the global preference.\n\t\treturn this.storageService.get(key, StorageScope.WORKSPACE) ?? this.storageService.get(key, StorageScope.APPLICATION);\n\t}\n\n\tremoveSessionPreference(providerId: string, mcpServerId: string, scopes: string[]): void {\n\t\t// The 3 parts of this key are important:\n\t\t// * MCP server id: The MCP server that has a preference\n\t\t// * Provider id: The provider that the preference is for\n\t\t// * The scopes: The subset of sessions that the preference applies to\n\t\tconst key = `${mcpServerId}-${providerId}-${scopes.join(SCOPESLIST_SEPARATOR)}`;\n\n\t\t// This won't affect any other workspaces that have a preference set, but it will remove the preference\n\t\t// for this workspace and the global preference. This is only paired with a call to updateSessionPreference...\n\t\t// so we really don't _need_ to remove them as they are about to be overridden anyway... but it's more correct\n\t\t// to remove them first... and in case this gets called from somewhere else in the future.\n\t\tthis.storageService.remove(key, StorageScope.WORKSPACE);\n\t\tthis.storageService.remove(key, StorageScope.APPLICATION);\n\t}\n\n\tprivate _updateAccountAndSessionPreferences(providerId: string, mcpServerId: string, session: AuthenticationSession): void {\n\t\tthis.updateAccountPreference(mcpServerId, providerId, session.account);\n\t\tthis.updateSessionPreference(providerId, mcpServerId, session);\n\t}\n\n\t//#endregion\n\n\tprivate async showGetSessionPrompt(provider: IAuthenticationProvider, accountName: string, mcpServerId: string, mcpServerName: string): Promise<boolean> {\n\t\tenum SessionPromptChoice {\n\t\t\tAllow = 0,\n\t\t\tDeny = 1,\n\t\t\tCancel = 2\n\t\t}\n\t\tconst { result } = await this.dialogService.prompt<SessionPromptChoice>({\n\t\t\ttype: Severity.Info,\n\t\t\tmessage: nls.localize('confirmAuthenticationAccess', \"The MCP server '{0}' wants to access the {1} account '{2}'.\", mcpServerName, provider.label, accountName),\n\t\t\tbuttons: [\n\t\t\t\t{\n\t\t\t\t\tlabel: nls.localize({ key: 'allow', comment: ['&& denotes a mnemonic'] }, \"&&Allow\"),\n\t\t\t\t\trun: () => SessionPromptChoice.Allow\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tlabel: nls.localize({ key: 'deny', comment: ['&& denotes a mnemonic'] }, \"&&Deny\"),\n\t\t\t\t\trun: () => SessionPromptChoice.Deny\n\t\t\t\t}\n\t\t\t],\n\t\t\tcancelButton: {\n\t\t\t\trun: () => SessionPromptChoice.Cancel\n\t\t\t}\n\t\t});\n\n\t\tif (result !== SessionPromptChoice.Cancel) {\n\t\t\tthis._authenticationAccessService.updateAllowedMcpServers(provider.id, accountName, [{ id: mcpServerId, name: mcpServerName, allowed: result === SessionPromptChoice.Allow }]);\n\t\t\tthis.removeAccessRequest(provider.id, mcpServerId);\n\t\t}\n\n\t\treturn result === SessionPromptChoice.Allow;\n\t}\n\n\t/**\n\t * This function should be used only when there are sessions to disambiguate.\n\t */\n\tasync selectSession(providerId: string, mcpServerId: string, mcpServerName: string, scopes: string[], availableSessions: AuthenticationSession[]): Promise<AuthenticationSession> {\n\t\tconst allAccounts = await this._authenticationService.getAccounts(providerId);\n\t\tif (!allAccounts.length) {\n\t\t\tthrow new Error('No accounts available');\n\t\t}\n\t\tconst disposables = new DisposableStore();\n\t\tconst quickPick = disposables.add(this.quickInputService.createQuickPick<{ label: string; session?: AuthenticationSession; account?: AuthenticationSessionAccount }>());\n\t\tquickPick.ignoreFocusOut = true;\n\t\tconst accountsWithSessions = new Set<string>();\n\t\tconst items: { label: string; session?: AuthenticationSession; account?: AuthenticationSessionAccount }[] = availableSessions\n\t\t\t// Only grab the first account\n\t\t\t.filter(session => !accountsWithSessions.has(session.account.label) && accountsWithSessions.add(session.account.label))\n\t\t\t.map(session => {\n\t\t\t\treturn {\n\t\t\t\t\tlabel: session.account.label,\n\t\t\t\t\tsession: session\n\t\t\t\t};\n\t\t\t});\n\n\t\t// Add the additional accounts that have been logged into the provider but are\n\t\t// don't have a session yet.\n\t\tallAccounts.forEach(account => {\n\t\t\tif (!accountsWithSessions.has(account.label)) {\n\t\t\t\titems.push({ label: account.label, account });\n\t\t\t}\n\t\t});\n\t\titems.push({ label: nls.localize('useOtherAccount', \"Sign in to another account\") });\n\t\tquickPick.items = items;\n\t\tquickPick.title = nls.localize(\n\t\t\t{\n\t\t\t\tkey: 'selectAccount',\n\t\t\t\tcomment: ['The placeholder {0} is the name of a MCP server. {1} is the name of the type of account, such as Microsoft or GitHub.']\n\t\t\t},\n\t\t\t\"The MCP server '{0}' wants to access a {1} account\",\n\t\t\tmcpServerName,\n\t\t\tthis._authenticationService.getProvider(providerId).label\n\t\t);\n\t\tquickPick.placeholder = nls.localize('getSessionPlateholder', \"Select an account for '{0}' to use or Esc to cancel\", mcpServerName);\n\n\t\treturn await new Promise((resolve, reject) => {\n\t\t\tdisposables.add(quickPick.onDidAccept(async _ => {\n\t\t\t\tquickPick.dispose();\n\t\t\t\tlet session = quickPick.selectedItems[0].session;\n\t\t\t\tif (!session) {\n\t\t\t\t\tconst account = quickPick.selectedItems[0].account;\n\t\t\t\t\ttry {\n\t\t\t\t\t\tsession = await this._authenticationService.createSession(providerId, scopes, { account });\n\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\treject(e);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tconst accountName = session.account.label;\n\n\t\t\t\tthis._authenticationAccessService.updateAllowedMcpServers(providerId, accountName, [{ id: mcpServerId, name: mcpServerName, allowed: true }]);\n\t\t\t\tthis._updateAccountAndSessionPreferences(providerId, mcpServerId, session);\n\t\t\t\tthis.removeAccessRequest(providerId, mcpServerId);\n\n\t\t\t\tresolve(session);\n\t\t\t}));\n\n\t\t\tdisposables.add(quickPick.onDidHide(_ => {\n\t\t\t\tif (!quickPick.selectedItems[0]) {\n\t\t\t\t\treject('User did not consent to account access');\n\t\t\t\t}\n\t\t\t\tdisposables.dispose();\n\t\t\t}));\n\n\t\t\tquickPick.show();\n\t\t});\n\t}\n\n\tprivate async completeSessionAccessRequest(provider: IAuthenticationProvider, mcpServerId: string, mcpServerName: string, scopes: string[]): Promise<void> {\n\t\tconst providerRequests = this._sessionAccessRequestItems.get(provider.id) || {};\n\t\tconst existingRequest = providerRequests[mcpServerId];\n\t\tif (!existingRequest) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!provider) {\n\t\t\treturn;\n\t\t}\n\t\tconst possibleSessions = existingRequest.possibleSessions;\n\n\t\tlet session: AuthenticationSession | undefined;\n\t\tif (provider.supportsMultipleAccounts) {\n\t\t\ttry {\n\t\t\t\tsession = await this.selectSession(provider.id, mcpServerId, mcpServerName, scopes, possibleSessions);\n\t\t\t} catch (_) {\n\t\t\t\t// ignore cancel\n\t\t\t}\n\t\t} else {\n\t\t\tconst approved = await this.showGetSessionPrompt(provider, possibleSessions[0].account.label, mcpServerId, mcpServerName);\n\t\t\tif (approved) {\n\t\t\t\tsession = possibleSessions[0];\n\t\t\t}\n\t\t}\n\n\t\tif (session) {\n\t\t\tthis._authenticationUsageService.addAccountUsage(provider.id, session.account.label, session.scopes, mcpServerId, mcpServerName);\n\t\t}\n\t}\n\n\trequestSessionAccess(providerId: string, mcpServerId: string, mcpServerName: string, scopes: string[], possibleSessions: AuthenticationSession[]): void {\n\t\tconst providerRequests = this._sessionAccessRequestItems.get(providerId) || {};\n\t\tconst hasExistingRequest = providerRequests[mcpServerId];\n\t\tif (hasExistingRequest) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst provider = this._authenticationService.getProvider(providerId);\n\t\tconst menuItem = MenuRegistry.appendMenuItem(MenuId.AccountsContext, {\n\t\t\tgroup: '3_accessRequests',\n\t\t\tcommand: {\n\t\t\t\tid: `${providerId}${mcpServerId}Access`,\n\t\t\t\ttitle: nls.localize({\n\t\t\t\t\tkey: 'accessRequest',\n\t\t\t\t\tcomment: [`The placeholder {0} will be replaced with an authentication provider''s label. {1} will be replaced with a MCP server name. (1) is to indicate that this menu item contributes to a badge count`]\n\t\t\t\t},\n\t\t\t\t\t\"Grant access to {0} for {1}... (1)\",\n\t\t\t\t\tprovider.label,\n\t\t\t\t\tmcpServerName)\n\t\t\t}\n\t\t});\n\n\t\tconst accessCommand = CommandsRegistry.registerCommand({\n\t\t\tid: `${providerId}${mcpServerId}Access`,\n\t\t\thandler: async (accessor) => {\n\t\t\t\tthis.completeSessionAccessRequest(provider, mcpServerId, mcpServerName, scopes);\n\t\t\t}\n\t\t});\n\n\t\tproviderRequests[mcpServerId] = { possibleSessions, disposables: [menuItem, accessCommand] };\n\t\tthis._sessionAccessRequestItems.set(providerId, providerRequests);\n\t\tthis.updateBadgeCount();\n\t}\n\n\tasync requestNewSession(providerId: string, scopes: string[], mcpServerId: string, mcpServerName: string): Promise<void> {\n\t\tif (!this._authenticationService.isAuthenticationProviderRegistered(providerId)) {\n\t\t\t// Activate has already been called for the authentication provider, but it cannot block on registering itself\n\t\t\t// since this is sync and returns a disposable. So, wait for registration event to fire that indicates the\n\t\t\t// provider is now in the map.\n\t\t\tawait new Promise<void>((resolve, _) => {\n\t\t\t\tconst dispose = this._authenticationService.onDidRegisterAuthenticationProvider(e => {\n\t\t\t\t\tif (e.id === providerId) {\n\t\t\t\t\t\tdispose.dispose();\n\t\t\t\t\t\tresolve();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\n\t\tlet provider: IAuthenticationProvider;\n\t\ttry {\n\t\t\tprovider = this._authenticationService.getProvider(providerId);\n\t\t} catch (_e) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst providerRequests = this._signInRequestItems.get(providerId);\n\t\tconst scopesList = scopes.join(SCOPESLIST_SEPARATOR);\n\t\tconst mcpServerHasExistingRequest = providerRequests\n\t\t\t&& providerRequests[scopesList]\n\t\t\t&& providerRequests[scopesList].requestingMcpServerIds.includes(mcpServerId);\n\n\t\tif (mcpServerHasExistingRequest) {\n\t\t\treturn;\n\t\t}\n\n\t\t// Construct a commandId that won't clash with others generated here, nor likely with an MCP server's command\n\t\tconst commandId = `${providerId}:${mcpServerId}:signIn${Object.keys(providerRequests || []).length}`;\n\t\tconst menuItem = MenuRegistry.appendMenuItem(MenuId.AccountsContext, {\n\t\t\tgroup: '2_signInRequests',\n\t\t\tcommand: {\n\t\t\t\tid: commandId,\n\t\t\t\ttitle: nls.localize({\n\t\t\t\t\tkey: 'signInRequest',\n\t\t\t\t\tcomment: [`The placeholder {0} will be replaced with an authentication provider's label. {1} will be replaced with a MCP server name. (1) is to indicate that this menu item contributes to a badge count.`]\n\t\t\t\t},\n\t\t\t\t\t\"Sign in with {0} to use {1} (1)\",\n\t\t\t\t\tprovider.label,\n\t\t\t\t\tmcpServerName)\n\t\t\t}\n\t\t});\n\n\t\tconst signInCommand = CommandsRegistry.registerCommand({\n\t\t\tid: commandId,\n\t\t\thandler: async (accessor) => {\n\t\t\t\tconst authenticationService = accessor.get(IAuthenticationService);\n\t\t\t\tconst session = await authenticationService.createSession(providerId, scopes);\n\n\t\t\t\tthis._authenticationAccessService.updateAllowedMcpServers(providerId, session.account.label, [{ id: mcpServerId, name: mcpServerName, allowed: true }]);\n\t\t\t\tthis._updateAccountAndSessionPreferences(providerId, mcpServerId, session);\n\t\t\t}\n\t\t});\n\n\n\t\tif (providerRequests) {\n\t\t\tconst existingRequest = providerRequests[scopesList] || { disposables: [], requestingMcpServerIds: [] };\n\n\t\t\tproviderRequests[scopesList] = {\n\t\t\t\tdisposables: [...existingRequest.disposables, menuItem, signInCommand],\n\t\t\t\trequestingMcpServerIds: [...existingRequest.requestingMcpServerIds, mcpServerId]\n\t\t\t};\n\t\t\tthis._signInRequestItems.set(providerId, providerRequests);\n\t\t} else {\n\t\t\tthis._signInRequestItems.set(providerId, {\n\t\t\t\t[scopesList]: {\n\t\t\t\t\tdisposables: [menuItem, signInCommand],\n\t\t\t\t\trequestingMcpServerIds: [mcpServerId]\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tthis.updateBadgeCount();\n\t}\n}\n\nregisterSingleton(IAuthenticationMcpService, AuthenticationMcpService, InstantiationType.Delayed);\n"]}