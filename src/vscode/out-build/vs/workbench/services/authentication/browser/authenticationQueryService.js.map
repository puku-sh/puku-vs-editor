{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/services/authentication/browser/authenticationQueryService.ts","vs/workbench/services/authentication/browser/authenticationQueryService.ts"],"names":[],"mappings":"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","file":"authenticationQueryService.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Emitter } from '../../../../base/common/event.js';\nimport { Disposable } from '../../../../base/common/lifecycle.js';\nimport { InstantiationType, registerSingleton } from '../../../../platform/instantiation/common/extensions.js';\nimport { ILogService } from '../../../../platform/log/common/log.js';\nimport { AuthenticationSessionAccount, IAuthenticationService, IAuthenticationExtensionsService, INTERNAL_AUTH_PROVIDER_PREFIX } from '../common/authentication.js';\nimport {\n\tIAuthenticationQueryService,\n\tIProviderQuery,\n\tIAccountQuery,\n\tIAccountExtensionQuery,\n\tIAccountMcpServerQuery,\n\tIAccountExtensionsQuery,\n\tIAccountMcpServersQuery,\n\tIAccountEntitiesQuery,\n\tIProviderExtensionQuery,\n\tIProviderMcpServerQuery,\n\tIExtensionQuery,\n\tIMcpServerQuery,\n\tIActiveEntities,\n\tIAuthenticationUsageStats,\n\tIBaseQuery\n} from '../common/authenticationQuery.js';\nimport { IAuthenticationUsageService } from './authenticationUsageService.js';\nimport { IAuthenticationMcpUsageService } from './authenticationMcpUsageService.js';\nimport { IAuthenticationAccessService } from './authenticationAccessService.js';\nimport { IAuthenticationMcpAccessService } from './authenticationMcpAccessService.js';\nimport { IAuthenticationMcpService } from './authenticationMcpService.js';\nimport { ExtensionIdentifier } from '../../../../platform/extensions/common/extensions.js';\n\n/**\n * Base implementation for query interfaces\n */\nabstract class BaseQuery implements IBaseQuery {\n\tconstructor(\n\t\tpublic readonly providerId: string,\n\t\tprotected readonly queryService: AuthenticationQueryService\n\t) { }\n}\n\n/**\n * Implementation of account-extension query operations\n */\nclass AccountExtensionQuery extends BaseQuery implements IAccountExtensionQuery {\n\tconstructor(\n\t\tproviderId: string,\n\t\tpublic readonly accountName: string,\n\t\tpublic readonly extensionId: string,\n\t\tqueryService: AuthenticationQueryService\n\t) {\n\t\tsuper(providerId, queryService);\n\t}\n\n\tisAccessAllowed(): boolean | undefined {\n\t\treturn this.queryService.authenticationAccessService.isAccessAllowed(this.providerId, this.accountName, this.extensionId);\n\t}\n\n\tsetAccessAllowed(allowed: boolean, extensionName?: string): void {\n\t\tthis.queryService.authenticationAccessService.updateAllowedExtensions(\n\t\t\tthis.providerId,\n\t\t\tthis.accountName,\n\t\t\t[{ id: this.extensionId, name: extensionName || this.extensionId, allowed }]\n\t\t);\n\t}\n\n\taddUsage(scopes: readonly string[], extensionName: string): void {\n\t\tthis.queryService.authenticationUsageService.addAccountUsage(\n\t\t\tthis.providerId,\n\t\t\tthis.accountName,\n\t\t\tscopes,\n\t\t\tthis.extensionId,\n\t\t\textensionName\n\t\t);\n\t}\n\n\tgetUsage(): {\n\t\treadonly extensionId: string;\n\t\treadonly extensionName: string;\n\t\treadonly scopes: readonly string[];\n\t\treadonly lastUsed: number;\n\t}[] {\n\t\tconst allUsages = this.queryService.authenticationUsageService.readAccountUsages(this.providerId, this.accountName);\n\t\treturn allUsages\n\t\t\t.filter(usage => usage.extensionId === ExtensionIdentifier.toKey(this.extensionId))\n\t\t\t.map(usage => ({\n\t\t\t\textensionId: usage.extensionId,\n\t\t\t\textensionName: usage.extensionName,\n\t\t\t\tscopes: usage.scopes || [],\n\t\t\t\tlastUsed: usage.lastUsed\n\t\t\t}));\n\t}\n\n\tremoveUsage(): void {\n\t\t// Get current usages, filter out this extension, and store the rest\n\t\tconst allUsages = this.queryService.authenticationUsageService.readAccountUsages(this.providerId, this.accountName);\n\t\tconst filteredUsages = allUsages.filter(usage => usage.extensionId !== this.extensionId);\n\n\t\t// Clear all usages and re-add the filtered ones\n\t\tthis.queryService.authenticationUsageService.removeAccountUsage(this.providerId, this.accountName);\n\t\tfor (const usage of filteredUsages) {\n\t\t\tthis.queryService.authenticationUsageService.addAccountUsage(\n\t\t\t\tthis.providerId,\n\t\t\t\tthis.accountName,\n\t\t\t\tusage.scopes || [],\n\t\t\t\tusage.extensionId,\n\t\t\t\tusage.extensionName\n\t\t\t);\n\t\t}\n\t}\n\n\tsetAsPreferred(): void {\n\t\tthis.queryService.authenticationExtensionsService.updateAccountPreference(\n\t\t\tthis.extensionId,\n\t\t\tthis.providerId,\n\t\t\t{ label: this.accountName, id: this.accountName }\n\t\t);\n\t}\n\n\tisPreferred(): boolean {\n\t\tconst preferredAccount = this.queryService.authenticationExtensionsService.getAccountPreference(this.extensionId, this.providerId);\n\t\treturn preferredAccount === this.accountName;\n\t}\n\n\tisTrusted(): boolean {\n\t\tconst allowedExtensions = this.queryService.authenticationAccessService.readAllowedExtensions(this.providerId, this.accountName);\n\t\tconst extension = allowedExtensions.find(ext => ext.id === this.extensionId);\n\t\treturn extension?.trusted === true;\n\t}\n}\n\n/**\n * Implementation of account-MCP server query operations\n */\nclass AccountMcpServerQuery extends BaseQuery implements IAccountMcpServerQuery {\n\tconstructor(\n\t\tproviderId: string,\n\t\tpublic readonly accountName: string,\n\t\tpublic readonly mcpServerId: string,\n\t\tqueryService: AuthenticationQueryService\n\t) {\n\t\tsuper(providerId, queryService);\n\t}\n\n\tisAccessAllowed(): boolean | undefined {\n\t\treturn this.queryService.authenticationMcpAccessService.isAccessAllowed(this.providerId, this.accountName, this.mcpServerId);\n\t}\n\n\tsetAccessAllowed(allowed: boolean, mcpServerName?: string): void {\n\t\tthis.queryService.authenticationMcpAccessService.updateAllowedMcpServers(\n\t\t\tthis.providerId,\n\t\t\tthis.accountName,\n\t\t\t[{ id: this.mcpServerId, name: mcpServerName || this.mcpServerId, allowed }]\n\t\t);\n\t}\n\n\taddUsage(scopes: readonly string[], mcpServerName: string): void {\n\t\tthis.queryService.authenticationMcpUsageService.addAccountUsage(\n\t\t\tthis.providerId,\n\t\t\tthis.accountName,\n\t\t\tscopes,\n\t\t\tthis.mcpServerId,\n\t\t\tmcpServerName\n\t\t);\n\t}\n\n\tgetUsage(): {\n\t\treadonly mcpServerId: string;\n\t\treadonly mcpServerName: string;\n\t\treadonly scopes: readonly string[];\n\t\treadonly lastUsed: number;\n\t}[] {\n\t\tconst allUsages = this.queryService.authenticationMcpUsageService.readAccountUsages(this.providerId, this.accountName);\n\t\treturn allUsages\n\t\t\t.filter(usage => usage.mcpServerId === this.mcpServerId)\n\t\t\t.map(usage => ({\n\t\t\t\tmcpServerId: usage.mcpServerId,\n\t\t\t\tmcpServerName: usage.mcpServerName,\n\t\t\t\tscopes: usage.scopes || [],\n\t\t\t\tlastUsed: usage.lastUsed\n\t\t\t}));\n\t}\n\n\tremoveUsage(): void {\n\t\t// Get current usages, filter out this MCP server, and store the rest\n\t\tconst allUsages = this.queryService.authenticationMcpUsageService.readAccountUsages(this.providerId, this.accountName);\n\t\tconst filteredUsages = allUsages.filter(usage => usage.mcpServerId !== this.mcpServerId);\n\n\t\t// Clear all usages and re-add the filtered ones\n\t\tthis.queryService.authenticationMcpUsageService.removeAccountUsage(this.providerId, this.accountName);\n\t\tfor (const usage of filteredUsages) {\n\t\t\tthis.queryService.authenticationMcpUsageService.addAccountUsage(\n\t\t\t\tthis.providerId,\n\t\t\t\tthis.accountName,\n\t\t\t\tusage.scopes || [],\n\t\t\t\tusage.mcpServerId,\n\t\t\t\tusage.mcpServerName\n\t\t\t);\n\t\t}\n\t}\n\n\tsetAsPreferred(): void {\n\t\tthis.queryService.authenticationMcpService.updateAccountPreference(\n\t\t\tthis.mcpServerId,\n\t\t\tthis.providerId,\n\t\t\t{ label: this.accountName, id: this.accountName }\n\t\t);\n\t}\n\n\tisPreferred(): boolean {\n\t\tconst preferredAccount = this.queryService.authenticationMcpService.getAccountPreference(this.mcpServerId, this.providerId);\n\t\treturn preferredAccount === this.accountName;\n\t}\n\n\tisTrusted(): boolean {\n\t\tconst allowedMcpServers = this.queryService.authenticationMcpAccessService.readAllowedMcpServers(this.providerId, this.accountName);\n\t\tconst mcpServer = allowedMcpServers.find(server => server.id === this.mcpServerId);\n\t\treturn mcpServer?.trusted === true;\n\t}\n}\n\n/**\n * Implementation of account-extensions query operations\n */\nclass AccountExtensionsQuery extends BaseQuery implements IAccountExtensionsQuery {\n\tconstructor(\n\t\tproviderId: string,\n\t\tpublic readonly accountName: string,\n\t\tqueryService: AuthenticationQueryService\n\t) {\n\t\tsuper(providerId, queryService);\n\t}\n\n\tgetAllowedExtensions(): { id: string; name: string; allowed?: boolean; lastUsed?: number; trusted?: boolean }[] {\n\t\tconst allowedExtensions = this.queryService.authenticationAccessService.readAllowedExtensions(this.providerId, this.accountName);\n\t\tconst usages = this.queryService.authenticationUsageService.readAccountUsages(this.providerId, this.accountName);\n\n\t\treturn allowedExtensions\n\t\t\t.filter(ext => ext.allowed !== false)\n\t\t\t.map(ext => {\n\t\t\t\t// Find the most recent usage for this extension\n\t\t\t\tconst extensionUsages = usages.filter(usage => usage.extensionId === ext.id);\n\t\t\t\tconst lastUsed = extensionUsages.length > 0 ? Math.max(...extensionUsages.map(u => u.lastUsed)) : undefined;\n\n\t\t\t\t// Check if trusted through the extension query\n\t\t\t\tconst extensionQuery = new AccountExtensionQuery(this.providerId, this.accountName, ext.id, this.queryService);\n\t\t\t\tconst trusted = extensionQuery.isTrusted();\n\n\t\t\t\treturn {\n\t\t\t\t\tid: ext.id,\n\t\t\t\t\tname: ext.name,\n\t\t\t\t\tallowed: ext.allowed,\n\t\t\t\t\tlastUsed,\n\t\t\t\t\ttrusted\n\t\t\t\t};\n\t\t\t});\n\t}\n\n\tallowAccess(extensionIds: string[]): void {\n\t\tconst extensionsToAllow = extensionIds.map(id => ({ id, name: id, allowed: true }));\n\t\tthis.queryService.authenticationAccessService.updateAllowedExtensions(this.providerId, this.accountName, extensionsToAllow);\n\t}\n\n\tremoveAccess(extensionIds: string[]): void {\n\t\tconst extensionsToRemove = extensionIds.map(id => ({ id, name: id, allowed: false }));\n\t\tthis.queryService.authenticationAccessService.updateAllowedExtensions(this.providerId, this.accountName, extensionsToRemove);\n\t}\n\n\tforEach(callback: (extensionQuery: IAccountExtensionQuery) => void): void {\n\t\tconst usages = this.queryService.authenticationUsageService.readAccountUsages(this.providerId, this.accountName);\n\t\tconst allowedExtensions = this.queryService.authenticationAccessService.readAllowedExtensions(this.providerId, this.accountName);\n\n\t\t// Combine extensions from both usage and access data\n\t\tconst extensionIds = new Set<string>();\n\t\tusages.forEach(usage => extensionIds.add(usage.extensionId));\n\t\tallowedExtensions.forEach(ext => extensionIds.add(ext.id));\n\n\t\tfor (const extensionId of extensionIds) {\n\t\t\tconst extensionQuery = new AccountExtensionQuery(this.providerId, this.accountName, extensionId, this.queryService);\n\t\t\tcallback(extensionQuery);\n\t\t}\n\t}\n}\n\n/**\n * Implementation of account-MCP servers query operations\n */\nclass AccountMcpServersQuery extends BaseQuery implements IAccountMcpServersQuery {\n\tconstructor(\n\t\tproviderId: string,\n\t\tpublic readonly accountName: string,\n\t\tqueryService: AuthenticationQueryService\n\t) {\n\t\tsuper(providerId, queryService);\n\t}\n\n\tgetAllowedMcpServers(): { id: string; name: string; allowed?: boolean; lastUsed?: number; trusted?: boolean }[] {\n\t\treturn this.queryService.authenticationMcpAccessService.readAllowedMcpServers(this.providerId, this.accountName)\n\t\t\t.filter(server => server.allowed !== false);\n\t}\n\n\tallowAccess(mcpServerIds: string[]): void {\n\t\tconst mcpServersToAllow = mcpServerIds.map(id => ({ id, name: id, allowed: true }));\n\t\tthis.queryService.authenticationMcpAccessService.updateAllowedMcpServers(this.providerId, this.accountName, mcpServersToAllow);\n\t}\n\n\tremoveAccess(mcpServerIds: string[]): void {\n\t\tconst mcpServersToRemove = mcpServerIds.map(id => ({ id, name: id, allowed: false }));\n\t\tthis.queryService.authenticationMcpAccessService.updateAllowedMcpServers(this.providerId, this.accountName, mcpServersToRemove);\n\t}\n\n\tforEach(callback: (mcpServerQuery: IAccountMcpServerQuery) => void): void {\n\t\tconst usages = this.queryService.authenticationMcpUsageService.readAccountUsages(this.providerId, this.accountName);\n\t\tconst allowedMcpServers = this.queryService.authenticationMcpAccessService.readAllowedMcpServers(this.providerId, this.accountName);\n\n\t\t// Combine MCP servers from both usage and access data\n\t\tconst mcpServerIds = new Set<string>();\n\t\tusages.forEach(usage => mcpServerIds.add(usage.mcpServerId));\n\t\tallowedMcpServers.forEach(server => mcpServerIds.add(server.id));\n\n\t\tfor (const mcpServerId of mcpServerIds) {\n\t\t\tconst mcpServerQuery = new AccountMcpServerQuery(this.providerId, this.accountName, mcpServerId, this.queryService);\n\t\t\tcallback(mcpServerQuery);\n\t\t}\n\t}\n}\n\n/**\n * Implementation of account-entities query operations for type-agnostic operations\n */\nclass AccountEntitiesQuery extends BaseQuery implements IAccountEntitiesQuery {\n\tconstructor(\n\t\tproviderId: string,\n\t\tpublic readonly accountName: string,\n\t\tqueryService: AuthenticationQueryService\n\t) {\n\t\tsuper(providerId, queryService);\n\t}\n\n\thasAnyUsage(): boolean {\n\t\t// Check extension usage\n\t\tconst extensionUsages = this.queryService.authenticationUsageService.readAccountUsages(this.providerId, this.accountName);\n\t\tif (extensionUsages.length > 0) {\n\t\t\treturn true;\n\t\t}\n\n\t\t// Check MCP server usage\n\t\tconst mcpUsages = this.queryService.authenticationMcpUsageService.readAccountUsages(this.providerId, this.accountName);\n\t\tif (mcpUsages.length > 0) {\n\t\t\treturn true;\n\t\t}\n\n\t\t// Check extension access\n\t\tconst allowedExtensions = this.queryService.authenticationAccessService.readAllowedExtensions(this.providerId, this.accountName);\n\t\tif (allowedExtensions.some(ext => ext.allowed !== false)) {\n\t\t\treturn true;\n\t\t}\n\n\t\t// Check MCP server access\n\t\tconst allowedMcpServers = this.queryService.authenticationMcpAccessService.readAllowedMcpServers(this.providerId, this.accountName);\n\t\tif (allowedMcpServers.some(server => server.allowed !== false)) {\n\t\t\treturn true;\n\t\t}\n\n\t\treturn false;\n\t}\n\n\tgetEntityCount(): { extensions: number; mcpServers: number; total: number } {\n\t\t// Use the same logic as getAllEntities to count all entities with usage or access\n\t\tconst extensionUsages = this.queryService.authenticationUsageService.readAccountUsages(this.providerId, this.accountName);\n\t\tconst allowedExtensions = this.queryService.authenticationAccessService.readAllowedExtensions(this.providerId, this.accountName).filter(ext => ext.allowed);\n\t\tconst extensionIds = new Set<string>();\n\t\textensionUsages.forEach(usage => extensionIds.add(usage.extensionId));\n\t\tallowedExtensions.forEach(ext => extensionIds.add(ext.id));\n\n\t\tconst mcpUsages = this.queryService.authenticationMcpUsageService.readAccountUsages(this.providerId, this.accountName);\n\t\tconst allowedMcpServers = this.queryService.authenticationMcpAccessService.readAllowedMcpServers(this.providerId, this.accountName).filter(server => server.allowed);\n\t\tconst mcpServerIds = new Set<string>();\n\t\tmcpUsages.forEach(usage => mcpServerIds.add(usage.mcpServerId));\n\t\tallowedMcpServers.forEach(server => mcpServerIds.add(server.id));\n\n\t\tconst extensionCount = extensionIds.size;\n\t\tconst mcpServerCount = mcpServerIds.size;\n\n\t\treturn {\n\t\t\textensions: extensionCount,\n\t\t\tmcpServers: mcpServerCount,\n\t\t\ttotal: extensionCount + mcpServerCount\n\t\t};\n\t}\n\n\tremoveAllAccess(): void {\n\t\t// Remove all extension access\n\t\tconst extensionsQuery = new AccountExtensionsQuery(this.providerId, this.accountName, this.queryService);\n\t\tconst extensions = extensionsQuery.getAllowedExtensions();\n\t\tconst extensionIds = extensions.map(ext => ext.id);\n\t\tif (extensionIds.length > 0) {\n\t\t\textensionsQuery.removeAccess(extensionIds);\n\t\t}\n\n\t\t// Remove all MCP server access\n\t\tconst mcpServersQuery = new AccountMcpServersQuery(this.providerId, this.accountName, this.queryService);\n\t\tconst mcpServers = mcpServersQuery.getAllowedMcpServers();\n\t\tconst mcpServerIds = mcpServers.map(server => server.id);\n\t\tif (mcpServerIds.length > 0) {\n\t\t\tmcpServersQuery.removeAccess(mcpServerIds);\n\t\t}\n\t}\n\n\tforEach(callback: (entityId: string, entityType: 'extension' | 'mcpServer') => void): void {\n\t\t// Iterate over extensions\n\t\tconst extensionsQuery = new AccountExtensionsQuery(this.providerId, this.accountName, this.queryService);\n\t\textensionsQuery.forEach(extensionQuery => {\n\t\t\tcallback(extensionQuery.extensionId, 'extension');\n\t\t});\n\n\t\t// Iterate over MCP servers\n\t\tconst mcpServersQuery = new AccountMcpServersQuery(this.providerId, this.accountName, this.queryService);\n\t\tmcpServersQuery.forEach(mcpServerQuery => {\n\t\t\tcallback(mcpServerQuery.mcpServerId, 'mcpServer');\n\t\t});\n\t}\n}\n\n/**\n * Implementation of account query operations\n */\nclass AccountQuery extends BaseQuery implements IAccountQuery {\n\tconstructor(\n\t\tproviderId: string,\n\t\tpublic readonly accountName: string,\n\t\tqueryService: AuthenticationQueryService\n\t) {\n\t\tsuper(providerId, queryService);\n\t}\n\n\textension(extensionId: string): IAccountExtensionQuery {\n\t\treturn new AccountExtensionQuery(this.providerId, this.accountName, extensionId, this.queryService);\n\t}\n\n\tmcpServer(mcpServerId: string): IAccountMcpServerQuery {\n\t\treturn new AccountMcpServerQuery(this.providerId, this.accountName, mcpServerId, this.queryService);\n\t}\n\n\textensions(): IAccountExtensionsQuery {\n\t\treturn new AccountExtensionsQuery(this.providerId, this.accountName, this.queryService);\n\t}\n\n\tmcpServers(): IAccountMcpServersQuery {\n\t\treturn new AccountMcpServersQuery(this.providerId, this.accountName, this.queryService);\n\t}\n\n\tentities(): IAccountEntitiesQuery {\n\t\treturn new AccountEntitiesQuery(this.providerId, this.accountName, this.queryService);\n\t}\n\n\tremove(): void {\n\t\t// Remove all extension access and usage data\n\t\tthis.queryService.authenticationAccessService.removeAllowedExtensions(this.providerId, this.accountName);\n\t\tthis.queryService.authenticationUsageService.removeAccountUsage(this.providerId, this.accountName);\n\n\t\t// Remove all MCP server access and usage data\n\t\tthis.queryService.authenticationMcpAccessService.removeAllowedMcpServers(this.providerId, this.accountName);\n\t\tthis.queryService.authenticationMcpUsageService.removeAccountUsage(this.providerId, this.accountName);\n\t}\n}\n\n/**\n * Implementation of provider-extension query operations\n */\nclass ProviderExtensionQuery extends BaseQuery implements IProviderExtensionQuery {\n\tconstructor(\n\t\tproviderId: string,\n\t\tpublic readonly extensionId: string,\n\t\tqueryService: AuthenticationQueryService\n\t) {\n\t\tsuper(providerId, queryService);\n\t}\n\n\tgetPreferredAccount(): string | undefined {\n\t\treturn this.queryService.authenticationExtensionsService.getAccountPreference(this.extensionId, this.providerId);\n\t}\n\n\tsetPreferredAccount(account: AuthenticationSessionAccount): void {\n\t\tthis.queryService.authenticationExtensionsService.updateAccountPreference(this.extensionId, this.providerId, account);\n\t}\n\n\tremoveAccountPreference(): void {\n\t\tthis.queryService.authenticationExtensionsService.removeAccountPreference(this.extensionId, this.providerId);\n\t}\n}\n\n/**\n * Implementation of provider-MCP server query operations\n */\nclass ProviderMcpServerQuery extends BaseQuery implements IProviderMcpServerQuery {\n\tconstructor(\n\t\tproviderId: string,\n\t\tpublic readonly mcpServerId: string,\n\t\tqueryService: AuthenticationQueryService\n\t) {\n\t\tsuper(providerId, queryService);\n\t}\n\n\tasync getLastUsedAccount(): Promise<string | undefined> {\n\t\ttry {\n\t\t\tconst accounts = await this.queryService.authenticationService.getAccounts(this.providerId);\n\t\t\tlet lastUsedAccount: string | undefined;\n\t\t\tlet lastUsedTime = 0;\n\n\t\t\tfor (const account of accounts) {\n\t\t\t\tconst usages = this.queryService.authenticationMcpUsageService.readAccountUsages(this.providerId, account.label);\n\t\t\t\tconst mcpServerUsages = usages.filter(usage => usage.mcpServerId === this.mcpServerId);\n\n\t\t\t\tfor (const usage of mcpServerUsages) {\n\t\t\t\t\tif (usage.lastUsed > lastUsedTime) {\n\t\t\t\t\t\tlastUsedTime = usage.lastUsed;\n\t\t\t\t\t\tlastUsedAccount = account.label;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn lastUsedAccount;\n\t\t} catch {\n\t\t\treturn undefined;\n\t\t}\n\t}\n\n\tgetPreferredAccount(): string | undefined {\n\t\treturn this.queryService.authenticationMcpService.getAccountPreference(this.mcpServerId, this.providerId);\n\t}\n\n\tsetPreferredAccount(account: AuthenticationSessionAccount): void {\n\t\tthis.queryService.authenticationMcpService.updateAccountPreference(this.mcpServerId, this.providerId, account);\n\t}\n\n\tremoveAccountPreference(): void {\n\t\tthis.queryService.authenticationMcpService.removeAccountPreference(this.mcpServerId, this.providerId);\n\t}\n\n\tasync getUsedAccounts(): Promise<string[]> {\n\t\ttry {\n\t\t\tconst accounts = await this.queryService.authenticationService.getAccounts(this.providerId);\n\t\t\tconst usedAccounts: string[] = [];\n\n\t\t\tfor (const account of accounts) {\n\t\t\t\tconst usages = this.queryService.authenticationMcpUsageService.readAccountUsages(this.providerId, account.label);\n\t\t\t\tif (usages.some(usage => usage.mcpServerId === this.mcpServerId)) {\n\t\t\t\t\tusedAccounts.push(account.label);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn usedAccounts;\n\t\t} catch {\n\t\t\treturn [];\n\t\t}\n\t}\n}\n\n/**\n * Implementation of provider query operations\n */\nclass ProviderQuery extends BaseQuery implements IProviderQuery {\n\tconstructor(\n\t\tproviderId: string,\n\t\tqueryService: AuthenticationQueryService\n\t) {\n\t\tsuper(providerId, queryService);\n\t}\n\n\taccount(accountName: string): IAccountQuery {\n\t\treturn new AccountQuery(this.providerId, accountName, this.queryService);\n\t}\n\n\textension(extensionId: string): IProviderExtensionQuery {\n\t\treturn new ProviderExtensionQuery(this.providerId, extensionId, this.queryService);\n\t}\n\n\tmcpServer(mcpServerId: string): IProviderMcpServerQuery {\n\t\treturn new ProviderMcpServerQuery(this.providerId, mcpServerId, this.queryService);\n\t}\n\n\tasync getActiveEntities(): Promise<IActiveEntities> {\n\t\tconst extensions: string[] = [];\n\t\tconst mcpServers: string[] = [];\n\n\t\ttry {\n\t\t\tconst accounts = await this.queryService.authenticationService.getAccounts(this.providerId);\n\n\t\t\tfor (const account of accounts) {\n\t\t\t\t// Get extension usages\n\t\t\t\tconst extensionUsages = this.queryService.authenticationUsageService.readAccountUsages(this.providerId, account.label);\n\t\t\t\tfor (const usage of extensionUsages) {\n\t\t\t\t\tif (!extensions.includes(usage.extensionId)) {\n\t\t\t\t\t\textensions.push(usage.extensionId);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Get MCP server usages\n\t\t\t\tconst mcpUsages = this.queryService.authenticationMcpUsageService.readAccountUsages(this.providerId, account.label);\n\t\t\t\tfor (const usage of mcpUsages) {\n\t\t\t\t\tif (!mcpServers.includes(usage.mcpServerId)) {\n\t\t\t\t\t\tmcpServers.push(usage.mcpServerId);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t} catch {\n\t\t\t// Return empty arrays if there's an error\n\t\t}\n\n\t\treturn { extensions, mcpServers };\n\t}\n\n\tasync getAccountNames(): Promise<string[]> {\n\t\ttry {\n\t\t\tconst accounts = await this.queryService.authenticationService.getAccounts(this.providerId);\n\t\t\treturn accounts.map(account => account.label);\n\t\t} catch {\n\t\t\treturn [];\n\t\t}\n\t}\n\n\tasync getUsageStats(): Promise<IAuthenticationUsageStats> {\n\t\tconst recentActivity: { accountName: string; lastUsed: number; usageCount: number }[] = [];\n\t\tlet totalSessions = 0;\n\t\tlet totalAccounts = 0;\n\n\t\ttry {\n\t\t\tconst accounts = await this.queryService.authenticationService.getAccounts(this.providerId);\n\t\t\ttotalAccounts = accounts.length;\n\n\t\t\tfor (const account of accounts) {\n\t\t\t\tconst extensionUsages = this.queryService.authenticationUsageService.readAccountUsages(this.providerId, account.label);\n\t\t\t\tconst mcpUsages = this.queryService.authenticationMcpUsageService.readAccountUsages(this.providerId, account.label);\n\n\t\t\t\tconst allUsages = [...extensionUsages, ...mcpUsages];\n\t\t\t\tconst usageCount = allUsages.length;\n\t\t\t\tconst lastUsed = Math.max(...allUsages.map(u => u.lastUsed), 0);\n\n\t\t\t\tif (usageCount > 0) {\n\t\t\t\t\trecentActivity.push({ accountName: account.label, lastUsed, usageCount });\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Sort by most recent activity\n\t\t\trecentActivity.sort((a, b) => b.lastUsed - a.lastUsed);\n\n\t\t\t// Count total sessions (approximate)\n\t\t\ttotalSessions = recentActivity.reduce((sum, activity) => sum + activity.usageCount, 0);\n\t\t} catch {\n\t\t\t// Return default stats if there's an error\n\t\t}\n\n\t\treturn { totalSessions, totalAccounts, recentActivity };\n\t}\n\n\tasync forEachAccount(callback: (accountQuery: IAccountQuery) => void): Promise<void> {\n\t\ttry {\n\t\t\tconst accounts = await this.queryService.authenticationService.getAccounts(this.providerId);\n\t\t\tfor (const account of accounts) {\n\t\t\t\tconst accountQuery = new AccountQuery(this.providerId, account.label, this.queryService);\n\t\t\t\tcallback(accountQuery);\n\t\t\t}\n\t\t} catch {\n\t\t\t// Silently handle errors in enumeration\n\t\t}\n\t}\n}\n\n/**\n * Implementation of extension query operations (cross-provider)\n */\nclass ExtensionQuery implements IExtensionQuery {\n\tconstructor(\n\t\tpublic readonly extensionId: string,\n\t\tprivate readonly queryService: AuthenticationQueryService\n\t) { }\n\n\tasync getProvidersWithAccess(includeInternal?: boolean): Promise<string[]> {\n\t\tconst providersWithAccess: string[] = [];\n\t\tconst providerIds = this.queryService.authenticationService.getProviderIds();\n\n\t\tfor (const providerId of providerIds) {\n\t\t\t// Skip internal providers unless explicitly requested\n\t\t\tif (!includeInternal && providerId.startsWith(INTERNAL_AUTH_PROVIDER_PREFIX)) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\ttry {\n\t\t\t\tconst accounts = await this.queryService.authenticationService.getAccounts(providerId);\n\t\t\t\tconst hasAccess = accounts.some(account => {\n\t\t\t\t\tconst accessAllowed = this.queryService.authenticationAccessService.isAccessAllowed(providerId, account.label, this.extensionId);\n\t\t\t\t\treturn accessAllowed === true;\n\t\t\t\t});\n\n\t\t\t\tif (hasAccess) {\n\t\t\t\t\tprovidersWithAccess.push(providerId);\n\t\t\t\t}\n\t\t\t} catch {\n\t\t\t\t// Skip providers that error\n\t\t\t}\n\t\t}\n\n\t\treturn providersWithAccess;\n\t}\n\n\tgetAllAccountPreferences(includeInternal?: boolean): Map<string, string> {\n\t\tconst preferences = new Map<string, string>();\n\t\tconst providerIds = this.queryService.authenticationService.getProviderIds();\n\n\t\tfor (const providerId of providerIds) {\n\t\t\t// Skip internal providers unless explicitly requested\n\t\t\tif (!includeInternal && providerId.startsWith(INTERNAL_AUTH_PROVIDER_PREFIX)) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tconst preferredAccount = this.queryService.authenticationExtensionsService.getAccountPreference(this.extensionId, providerId);\n\t\t\tif (preferredAccount) {\n\t\t\t\tpreferences.set(providerId, preferredAccount);\n\t\t\t}\n\t\t}\n\n\t\treturn preferences;\n\t}\n\n\tprovider(providerId: string): IProviderExtensionQuery {\n\t\treturn new ProviderExtensionQuery(providerId, this.extensionId, this.queryService);\n\t}\n}\n\n/**\n * Implementation of MCP server query operations (cross-provider)\n */\nclass McpServerQuery implements IMcpServerQuery {\n\tconstructor(\n\t\tpublic readonly mcpServerId: string,\n\t\tprivate readonly queryService: AuthenticationQueryService\n\t) { }\n\n\tasync getProvidersWithAccess(includeInternal?: boolean): Promise<string[]> {\n\t\tconst providersWithAccess: string[] = [];\n\t\tconst providerIds = this.queryService.authenticationService.getProviderIds();\n\n\t\tfor (const providerId of providerIds) {\n\t\t\t// Skip internal providers unless explicitly requested\n\t\t\tif (!includeInternal && providerId.startsWith(INTERNAL_AUTH_PROVIDER_PREFIX)) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\ttry {\n\t\t\t\tconst accounts = await this.queryService.authenticationService.getAccounts(providerId);\n\t\t\t\tconst hasAccess = accounts.some(account => {\n\t\t\t\t\tconst accessAllowed = this.queryService.authenticationMcpAccessService.isAccessAllowed(providerId, account.label, this.mcpServerId);\n\t\t\t\t\treturn accessAllowed === true;\n\t\t\t\t});\n\n\t\t\t\tif (hasAccess) {\n\t\t\t\t\tprovidersWithAccess.push(providerId);\n\t\t\t\t}\n\t\t\t} catch {\n\t\t\t\t// Skip providers that error\n\t\t\t}\n\t\t}\n\n\t\treturn providersWithAccess;\n\t}\n\n\tgetAllAccountPreferences(includeInternal?: boolean): Map<string, string> {\n\t\tconst preferences = new Map<string, string>();\n\t\tconst providerIds = this.queryService.authenticationService.getProviderIds();\n\n\t\tfor (const providerId of providerIds) {\n\t\t\t// Skip internal providers unless explicitly requested\n\t\t\tif (!includeInternal && providerId.startsWith(INTERNAL_AUTH_PROVIDER_PREFIX)) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tconst preferredAccount = this.queryService.authenticationMcpService.getAccountPreference(this.mcpServerId, providerId);\n\t\t\tif (preferredAccount) {\n\t\t\t\tpreferences.set(providerId, preferredAccount);\n\t\t\t}\n\t\t}\n\n\t\treturn preferences;\n\t}\n\n\tprovider(providerId: string): IProviderMcpServerQuery {\n\t\treturn new ProviderMcpServerQuery(providerId, this.mcpServerId, this.queryService);\n\t}\n}\n\n/**\n * Main implementation of the authentication query service\n */\nexport class AuthenticationQueryService extends Disposable implements IAuthenticationQueryService {\n\tdeclare readonly _serviceBrand: undefined;\n\n\tprivate readonly _onDidChangePreferences = this._register(new Emitter<{\n\t\treadonly providerId: string;\n\t\treadonly entityType: 'extension' | 'mcpServer';\n\t\treadonly entityIds: string[];\n\t}>());\n\treadonly onDidChangePreferences = this._onDidChangePreferences.event;\n\n\tprivate readonly _onDidChangeAccess = this._register(new Emitter<{\n\t\treadonly providerId: string;\n\t\treadonly accountName: string;\n\t}>());\n\treadonly onDidChangeAccess = this._onDidChangeAccess.event;\n\n\tconstructor(\n\t\t@IAuthenticationService public readonly authenticationService: IAuthenticationService,\n\t\t@IAuthenticationUsageService public readonly authenticationUsageService: IAuthenticationUsageService,\n\t\t@IAuthenticationMcpUsageService public readonly authenticationMcpUsageService: IAuthenticationMcpUsageService,\n\t\t@IAuthenticationAccessService public readonly authenticationAccessService: IAuthenticationAccessService,\n\t\t@IAuthenticationMcpAccessService public readonly authenticationMcpAccessService: IAuthenticationMcpAccessService,\n\t\t@IAuthenticationExtensionsService public readonly authenticationExtensionsService: IAuthenticationExtensionsService,\n\t\t@IAuthenticationMcpService public readonly authenticationMcpService: IAuthenticationMcpService,\n\t\t@ILogService public readonly logService: ILogService\n\t) {\n\t\tsuper();\n\n\t\t// Forward events from underlying services\n\t\tthis._register(this.authenticationExtensionsService.onDidChangeAccountPreference(e => {\n\t\t\tthis._onDidChangePreferences.fire({\n\t\t\t\tproviderId: e.providerId,\n\t\t\t\tentityType: 'extension',\n\t\t\t\tentityIds: e.extensionIds\n\t\t\t});\n\t\t}));\n\n\t\tthis._register(this.authenticationMcpService.onDidChangeAccountPreference(e => {\n\t\t\tthis._onDidChangePreferences.fire({\n\t\t\t\tproviderId: e.providerId,\n\t\t\t\tentityType: 'mcpServer',\n\t\t\t\tentityIds: e.mcpServerIds\n\t\t\t});\n\t\t}));\n\n\t\tthis._register(this.authenticationAccessService.onDidChangeExtensionSessionAccess(e => {\n\t\t\tthis._onDidChangeAccess.fire({\n\t\t\t\tproviderId: e.providerId,\n\t\t\t\taccountName: e.accountName\n\t\t\t});\n\t\t}));\n\n\t\tthis._register(this.authenticationMcpAccessService.onDidChangeMcpSessionAccess(e => {\n\t\t\tthis._onDidChangeAccess.fire({\n\t\t\t\tproviderId: e.providerId,\n\t\t\t\taccountName: e.accountName\n\t\t\t});\n\t\t}));\n\t}\n\n\tprovider(providerId: string): IProviderQuery {\n\t\treturn new ProviderQuery(providerId, this);\n\t}\n\n\textension(extensionId: string): IExtensionQuery {\n\t\treturn new ExtensionQuery(extensionId, this);\n\t}\n\n\tmcpServer(mcpServerId: string): IMcpServerQuery {\n\t\treturn new McpServerQuery(mcpServerId, this);\n\t}\n\n\tgetProviderIds(includeInternal?: boolean): string[] {\n\t\treturn this.authenticationService.getProviderIds().filter(providerId => {\n\t\t\t// Filter out internal providers unless explicitly included\n\t\t\treturn includeInternal || !providerId.startsWith(INTERNAL_AUTH_PROVIDER_PREFIX);\n\t\t});\n\t}\n\n\tasync clearAllData(confirmation: 'CLEAR_ALL_AUTH_DATA', includeInternal: boolean = true): Promise<void> {\n\t\tif (confirmation !== 'CLEAR_ALL_AUTH_DATA') {\n\t\t\tthrow new Error('Must provide confirmation string to clear all authentication data');\n\t\t}\n\n\t\tconst providerIds = this.getProviderIds(includeInternal);\n\n\t\tfor (const providerId of providerIds) {\n\t\t\ttry {\n\t\t\t\tconst accounts = await this.authenticationService.getAccounts(providerId);\n\n\t\t\t\tfor (const account of accounts) {\n\t\t\t\t\t// Clear extension data\n\t\t\t\t\tthis.authenticationAccessService.removeAllowedExtensions(providerId, account.label);\n\t\t\t\t\tthis.authenticationUsageService.removeAccountUsage(providerId, account.label);\n\n\t\t\t\t\t// Clear MCP server data\n\t\t\t\t\tthis.authenticationMcpAccessService.removeAllowedMcpServers(providerId, account.label);\n\t\t\t\t\tthis.authenticationMcpUsageService.removeAccountUsage(providerId, account.label);\n\t\t\t\t}\n\t\t\t} catch (error) {\n\t\t\t\tthis.logService.error(`Error clearing data for provider ${providerId}:`, error);\n\t\t\t}\n\t\t}\n\n\t\tthis.logService.info('All authentication data cleared');\n\t}\n}\n\nregisterSingleton(IAuthenticationQueryService, AuthenticationQueryService, InstantiationType.Delayed);\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Emitter } from '../../../../base/common/event.js';\nimport { Disposable } from '../../../../base/common/lifecycle.js';\nimport { InstantiationType, registerSingleton } from '../../../../platform/instantiation/common/extensions.js';\nimport { ILogService } from '../../../../platform/log/common/log.js';\nimport { AuthenticationSessionAccount, IAuthenticationService, IAuthenticationExtensionsService, INTERNAL_AUTH_PROVIDER_PREFIX } from '../common/authentication.js';\nimport {\n\tIAuthenticationQueryService,\n\tIProviderQuery,\n\tIAccountQuery,\n\tIAccountExtensionQuery,\n\tIAccountMcpServerQuery,\n\tIAccountExtensionsQuery,\n\tIAccountMcpServersQuery,\n\tIAccountEntitiesQuery,\n\tIProviderExtensionQuery,\n\tIProviderMcpServerQuery,\n\tIExtensionQuery,\n\tIMcpServerQuery,\n\tIActiveEntities,\n\tIAuthenticationUsageStats,\n\tIBaseQuery\n} from '../common/authenticationQuery.js';\nimport { IAuthenticationUsageService } from './authenticationUsageService.js';\nimport { IAuthenticationMcpUsageService } from './authenticationMcpUsageService.js';\nimport { IAuthenticationAccessService } from './authenticationAccessService.js';\nimport { IAuthenticationMcpAccessService } from './authenticationMcpAccessService.js';\nimport { IAuthenticationMcpService } from './authenticationMcpService.js';\nimport { ExtensionIdentifier } from '../../../../platform/extensions/common/extensions.js';\n\n/**\n * Base implementation for query interfaces\n */\nabstract class BaseQuery implements IBaseQuery {\n\tconstructor(\n\t\tpublic readonly providerId: string,\n\t\tprotected readonly queryService: AuthenticationQueryService\n\t) { }\n}\n\n/**\n * Implementation of account-extension query operations\n */\nclass AccountExtensionQuery extends BaseQuery implements IAccountExtensionQuery {\n\tconstructor(\n\t\tproviderId: string,\n\t\tpublic readonly accountName: string,\n\t\tpublic readonly extensionId: string,\n\t\tqueryService: AuthenticationQueryService\n\t) {\n\t\tsuper(providerId, queryService);\n\t}\n\n\tisAccessAllowed(): boolean | undefined {\n\t\treturn this.queryService.authenticationAccessService.isAccessAllowed(this.providerId, this.accountName, this.extensionId);\n\t}\n\n\tsetAccessAllowed(allowed: boolean, extensionName?: string): void {\n\t\tthis.queryService.authenticationAccessService.updateAllowedExtensions(\n\t\t\tthis.providerId,\n\t\t\tthis.accountName,\n\t\t\t[{ id: this.extensionId, name: extensionName || this.extensionId, allowed }]\n\t\t);\n\t}\n\n\taddUsage(scopes: readonly string[], extensionName: string): void {\n\t\tthis.queryService.authenticationUsageService.addAccountUsage(\n\t\t\tthis.providerId,\n\t\t\tthis.accountName,\n\t\t\tscopes,\n\t\t\tthis.extensionId,\n\t\t\textensionName\n\t\t);\n\t}\n\n\tgetUsage(): {\n\t\treadonly extensionId: string;\n\t\treadonly extensionName: string;\n\t\treadonly scopes: readonly string[];\n\t\treadonly lastUsed: number;\n\t}[] {\n\t\tconst allUsages = this.queryService.authenticationUsageService.readAccountUsages(this.providerId, this.accountName);\n\t\treturn allUsages\n\t\t\t.filter(usage => usage.extensionId === ExtensionIdentifier.toKey(this.extensionId))\n\t\t\t.map(usage => ({\n\t\t\t\textensionId: usage.extensionId,\n\t\t\t\textensionName: usage.extensionName,\n\t\t\t\tscopes: usage.scopes || [],\n\t\t\t\tlastUsed: usage.lastUsed\n\t\t\t}));\n\t}\n\n\tremoveUsage(): void {\n\t\t// Get current usages, filter out this extension, and store the rest\n\t\tconst allUsages = this.queryService.authenticationUsageService.readAccountUsages(this.providerId, this.accountName);\n\t\tconst filteredUsages = allUsages.filter(usage => usage.extensionId !== this.extensionId);\n\n\t\t// Clear all usages and re-add the filtered ones\n\t\tthis.queryService.authenticationUsageService.removeAccountUsage(this.providerId, this.accountName);\n\t\tfor (const usage of filteredUsages) {\n\t\t\tthis.queryService.authenticationUsageService.addAccountUsage(\n\t\t\t\tthis.providerId,\n\t\t\t\tthis.accountName,\n\t\t\t\tusage.scopes || [],\n\t\t\t\tusage.extensionId,\n\t\t\t\tusage.extensionName\n\t\t\t);\n\t\t}\n\t}\n\n\tsetAsPreferred(): void {\n\t\tthis.queryService.authenticationExtensionsService.updateAccountPreference(\n\t\t\tthis.extensionId,\n\t\t\tthis.providerId,\n\t\t\t{ label: this.accountName, id: this.accountName }\n\t\t);\n\t}\n\n\tisPreferred(): boolean {\n\t\tconst preferredAccount = this.queryService.authenticationExtensionsService.getAccountPreference(this.extensionId, this.providerId);\n\t\treturn preferredAccount === this.accountName;\n\t}\n\n\tisTrusted(): boolean {\n\t\tconst allowedExtensions = this.queryService.authenticationAccessService.readAllowedExtensions(this.providerId, this.accountName);\n\t\tconst extension = allowedExtensions.find(ext => ext.id === this.extensionId);\n\t\treturn extension?.trusted === true;\n\t}\n}\n\n/**\n * Implementation of account-MCP server query operations\n */\nclass AccountMcpServerQuery extends BaseQuery implements IAccountMcpServerQuery {\n\tconstructor(\n\t\tproviderId: string,\n\t\tpublic readonly accountName: string,\n\t\tpublic readonly mcpServerId: string,\n\t\tqueryService: AuthenticationQueryService\n\t) {\n\t\tsuper(providerId, queryService);\n\t}\n\n\tisAccessAllowed(): boolean | undefined {\n\t\treturn this.queryService.authenticationMcpAccessService.isAccessAllowed(this.providerId, this.accountName, this.mcpServerId);\n\t}\n\n\tsetAccessAllowed(allowed: boolean, mcpServerName?: string): void {\n\t\tthis.queryService.authenticationMcpAccessService.updateAllowedMcpServers(\n\t\t\tthis.providerId,\n\t\t\tthis.accountName,\n\t\t\t[{ id: this.mcpServerId, name: mcpServerName || this.mcpServerId, allowed }]\n\t\t);\n\t}\n\n\taddUsage(scopes: readonly string[], mcpServerName: string): void {\n\t\tthis.queryService.authenticationMcpUsageService.addAccountUsage(\n\t\t\tthis.providerId,\n\t\t\tthis.accountName,\n\t\t\tscopes,\n\t\t\tthis.mcpServerId,\n\t\t\tmcpServerName\n\t\t);\n\t}\n\n\tgetUsage(): {\n\t\treadonly mcpServerId: string;\n\t\treadonly mcpServerName: string;\n\t\treadonly scopes: readonly string[];\n\t\treadonly lastUsed: number;\n\t}[] {\n\t\tconst allUsages = this.queryService.authenticationMcpUsageService.readAccountUsages(this.providerId, this.accountName);\n\t\treturn allUsages\n\t\t\t.filter(usage => usage.mcpServerId === this.mcpServerId)\n\t\t\t.map(usage => ({\n\t\t\t\tmcpServerId: usage.mcpServerId,\n\t\t\t\tmcpServerName: usage.mcpServerName,\n\t\t\t\tscopes: usage.scopes || [],\n\t\t\t\tlastUsed: usage.lastUsed\n\t\t\t}));\n\t}\n\n\tremoveUsage(): void {\n\t\t// Get current usages, filter out this MCP server, and store the rest\n\t\tconst allUsages = this.queryService.authenticationMcpUsageService.readAccountUsages(this.providerId, this.accountName);\n\t\tconst filteredUsages = allUsages.filter(usage => usage.mcpServerId !== this.mcpServerId);\n\n\t\t// Clear all usages and re-add the filtered ones\n\t\tthis.queryService.authenticationMcpUsageService.removeAccountUsage(this.providerId, this.accountName);\n\t\tfor (const usage of filteredUsages) {\n\t\t\tthis.queryService.authenticationMcpUsageService.addAccountUsage(\n\t\t\t\tthis.providerId,\n\t\t\t\tthis.accountName,\n\t\t\t\tusage.scopes || [],\n\t\t\t\tusage.mcpServerId,\n\t\t\t\tusage.mcpServerName\n\t\t\t);\n\t\t}\n\t}\n\n\tsetAsPreferred(): void {\n\t\tthis.queryService.authenticationMcpService.updateAccountPreference(\n\t\t\tthis.mcpServerId,\n\t\t\tthis.providerId,\n\t\t\t{ label: this.accountName, id: this.accountName }\n\t\t);\n\t}\n\n\tisPreferred(): boolean {\n\t\tconst preferredAccount = this.queryService.authenticationMcpService.getAccountPreference(this.mcpServerId, this.providerId);\n\t\treturn preferredAccount === this.accountName;\n\t}\n\n\tisTrusted(): boolean {\n\t\tconst allowedMcpServers = this.queryService.authenticationMcpAccessService.readAllowedMcpServers(this.providerId, this.accountName);\n\t\tconst mcpServer = allowedMcpServers.find(server => server.id === this.mcpServerId);\n\t\treturn mcpServer?.trusted === true;\n\t}\n}\n\n/**\n * Implementation of account-extensions query operations\n */\nclass AccountExtensionsQuery extends BaseQuery implements IAccountExtensionsQuery {\n\tconstructor(\n\t\tproviderId: string,\n\t\tpublic readonly accountName: string,\n\t\tqueryService: AuthenticationQueryService\n\t) {\n\t\tsuper(providerId, queryService);\n\t}\n\n\tgetAllowedExtensions(): { id: string; name: string; allowed?: boolean; lastUsed?: number; trusted?: boolean }[] {\n\t\tconst allowedExtensions = this.queryService.authenticationAccessService.readAllowedExtensions(this.providerId, this.accountName);\n\t\tconst usages = this.queryService.authenticationUsageService.readAccountUsages(this.providerId, this.accountName);\n\n\t\treturn allowedExtensions\n\t\t\t.filter(ext => ext.allowed !== false)\n\t\t\t.map(ext => {\n\t\t\t\t// Find the most recent usage for this extension\n\t\t\t\tconst extensionUsages = usages.filter(usage => usage.extensionId === ext.id);\n\t\t\t\tconst lastUsed = extensionUsages.length > 0 ? Math.max(...extensionUsages.map(u => u.lastUsed)) : undefined;\n\n\t\t\t\t// Check if trusted through the extension query\n\t\t\t\tconst extensionQuery = new AccountExtensionQuery(this.providerId, this.accountName, ext.id, this.queryService);\n\t\t\t\tconst trusted = extensionQuery.isTrusted();\n\n\t\t\t\treturn {\n\t\t\t\t\tid: ext.id,\n\t\t\t\t\tname: ext.name,\n\t\t\t\t\tallowed: ext.allowed,\n\t\t\t\t\tlastUsed,\n\t\t\t\t\ttrusted\n\t\t\t\t};\n\t\t\t});\n\t}\n\n\tallowAccess(extensionIds: string[]): void {\n\t\tconst extensionsToAllow = extensionIds.map(id => ({ id, name: id, allowed: true }));\n\t\tthis.queryService.authenticationAccessService.updateAllowedExtensions(this.providerId, this.accountName, extensionsToAllow);\n\t}\n\n\tremoveAccess(extensionIds: string[]): void {\n\t\tconst extensionsToRemove = extensionIds.map(id => ({ id, name: id, allowed: false }));\n\t\tthis.queryService.authenticationAccessService.updateAllowedExtensions(this.providerId, this.accountName, extensionsToRemove);\n\t}\n\n\tforEach(callback: (extensionQuery: IAccountExtensionQuery) => void): void {\n\t\tconst usages = this.queryService.authenticationUsageService.readAccountUsages(this.providerId, this.accountName);\n\t\tconst allowedExtensions = this.queryService.authenticationAccessService.readAllowedExtensions(this.providerId, this.accountName);\n\n\t\t// Combine extensions from both usage and access data\n\t\tconst extensionIds = new Set<string>();\n\t\tusages.forEach(usage => extensionIds.add(usage.extensionId));\n\t\tallowedExtensions.forEach(ext => extensionIds.add(ext.id));\n\n\t\tfor (const extensionId of extensionIds) {\n\t\t\tconst extensionQuery = new AccountExtensionQuery(this.providerId, this.accountName, extensionId, this.queryService);\n\t\t\tcallback(extensionQuery);\n\t\t}\n\t}\n}\n\n/**\n * Implementation of account-MCP servers query operations\n */\nclass AccountMcpServersQuery extends BaseQuery implements IAccountMcpServersQuery {\n\tconstructor(\n\t\tproviderId: string,\n\t\tpublic readonly accountName: string,\n\t\tqueryService: AuthenticationQueryService\n\t) {\n\t\tsuper(providerId, queryService);\n\t}\n\n\tgetAllowedMcpServers(): { id: string; name: string; allowed?: boolean; lastUsed?: number; trusted?: boolean }[] {\n\t\treturn this.queryService.authenticationMcpAccessService.readAllowedMcpServers(this.providerId, this.accountName)\n\t\t\t.filter(server => server.allowed !== false);\n\t}\n\n\tallowAccess(mcpServerIds: string[]): void {\n\t\tconst mcpServersToAllow = mcpServerIds.map(id => ({ id, name: id, allowed: true }));\n\t\tthis.queryService.authenticationMcpAccessService.updateAllowedMcpServers(this.providerId, this.accountName, mcpServersToAllow);\n\t}\n\n\tremoveAccess(mcpServerIds: string[]): void {\n\t\tconst mcpServersToRemove = mcpServerIds.map(id => ({ id, name: id, allowed: false }));\n\t\tthis.queryService.authenticationMcpAccessService.updateAllowedMcpServers(this.providerId, this.accountName, mcpServersToRemove);\n\t}\n\n\tforEach(callback: (mcpServerQuery: IAccountMcpServerQuery) => void): void {\n\t\tconst usages = this.queryService.authenticationMcpUsageService.readAccountUsages(this.providerId, this.accountName);\n\t\tconst allowedMcpServers = this.queryService.authenticationMcpAccessService.readAllowedMcpServers(this.providerId, this.accountName);\n\n\t\t// Combine MCP servers from both usage and access data\n\t\tconst mcpServerIds = new Set<string>();\n\t\tusages.forEach(usage => mcpServerIds.add(usage.mcpServerId));\n\t\tallowedMcpServers.forEach(server => mcpServerIds.add(server.id));\n\n\t\tfor (const mcpServerId of mcpServerIds) {\n\t\t\tconst mcpServerQuery = new AccountMcpServerQuery(this.providerId, this.accountName, mcpServerId, this.queryService);\n\t\t\tcallback(mcpServerQuery);\n\t\t}\n\t}\n}\n\n/**\n * Implementation of account-entities query operations for type-agnostic operations\n */\nclass AccountEntitiesQuery extends BaseQuery implements IAccountEntitiesQuery {\n\tconstructor(\n\t\tproviderId: string,\n\t\tpublic readonly accountName: string,\n\t\tqueryService: AuthenticationQueryService\n\t) {\n\t\tsuper(providerId, queryService);\n\t}\n\n\thasAnyUsage(): boolean {\n\t\t// Check extension usage\n\t\tconst extensionUsages = this.queryService.authenticationUsageService.readAccountUsages(this.providerId, this.accountName);\n\t\tif (extensionUsages.length > 0) {\n\t\t\treturn true;\n\t\t}\n\n\t\t// Check MCP server usage\n\t\tconst mcpUsages = this.queryService.authenticationMcpUsageService.readAccountUsages(this.providerId, this.accountName);\n\t\tif (mcpUsages.length > 0) {\n\t\t\treturn true;\n\t\t}\n\n\t\t// Check extension access\n\t\tconst allowedExtensions = this.queryService.authenticationAccessService.readAllowedExtensions(this.providerId, this.accountName);\n\t\tif (allowedExtensions.some(ext => ext.allowed !== false)) {\n\t\t\treturn true;\n\t\t}\n\n\t\t// Check MCP server access\n\t\tconst allowedMcpServers = this.queryService.authenticationMcpAccessService.readAllowedMcpServers(this.providerId, this.accountName);\n\t\tif (allowedMcpServers.some(server => server.allowed !== false)) {\n\t\t\treturn true;\n\t\t}\n\n\t\treturn false;\n\t}\n\n\tgetEntityCount(): { extensions: number; mcpServers: number; total: number } {\n\t\t// Use the same logic as getAllEntities to count all entities with usage or access\n\t\tconst extensionUsages = this.queryService.authenticationUsageService.readAccountUsages(this.providerId, this.accountName);\n\t\tconst allowedExtensions = this.queryService.authenticationAccessService.readAllowedExtensions(this.providerId, this.accountName).filter(ext => ext.allowed);\n\t\tconst extensionIds = new Set<string>();\n\t\textensionUsages.forEach(usage => extensionIds.add(usage.extensionId));\n\t\tallowedExtensions.forEach(ext => extensionIds.add(ext.id));\n\n\t\tconst mcpUsages = this.queryService.authenticationMcpUsageService.readAccountUsages(this.providerId, this.accountName);\n\t\tconst allowedMcpServers = this.queryService.authenticationMcpAccessService.readAllowedMcpServers(this.providerId, this.accountName).filter(server => server.allowed);\n\t\tconst mcpServerIds = new Set<string>();\n\t\tmcpUsages.forEach(usage => mcpServerIds.add(usage.mcpServerId));\n\t\tallowedMcpServers.forEach(server => mcpServerIds.add(server.id));\n\n\t\tconst extensionCount = extensionIds.size;\n\t\tconst mcpServerCount = mcpServerIds.size;\n\n\t\treturn {\n\t\t\textensions: extensionCount,\n\t\t\tmcpServers: mcpServerCount,\n\t\t\ttotal: extensionCount + mcpServerCount\n\t\t};\n\t}\n\n\tremoveAllAccess(): void {\n\t\t// Remove all extension access\n\t\tconst extensionsQuery = new AccountExtensionsQuery(this.providerId, this.accountName, this.queryService);\n\t\tconst extensions = extensionsQuery.getAllowedExtensions();\n\t\tconst extensionIds = extensions.map(ext => ext.id);\n\t\tif (extensionIds.length > 0) {\n\t\t\textensionsQuery.removeAccess(extensionIds);\n\t\t}\n\n\t\t// Remove all MCP server access\n\t\tconst mcpServersQuery = new AccountMcpServersQuery(this.providerId, this.accountName, this.queryService);\n\t\tconst mcpServers = mcpServersQuery.getAllowedMcpServers();\n\t\tconst mcpServerIds = mcpServers.map(server => server.id);\n\t\tif (mcpServerIds.length > 0) {\n\t\t\tmcpServersQuery.removeAccess(mcpServerIds);\n\t\t}\n\t}\n\n\tforEach(callback: (entityId: string, entityType: 'extension' | 'mcpServer') => void): void {\n\t\t// Iterate over extensions\n\t\tconst extensionsQuery = new AccountExtensionsQuery(this.providerId, this.accountName, this.queryService);\n\t\textensionsQuery.forEach(extensionQuery => {\n\t\t\tcallback(extensionQuery.extensionId, 'extension');\n\t\t});\n\n\t\t// Iterate over MCP servers\n\t\tconst mcpServersQuery = new AccountMcpServersQuery(this.providerId, this.accountName, this.queryService);\n\t\tmcpServersQuery.forEach(mcpServerQuery => {\n\t\t\tcallback(mcpServerQuery.mcpServerId, 'mcpServer');\n\t\t});\n\t}\n}\n\n/**\n * Implementation of account query operations\n */\nclass AccountQuery extends BaseQuery implements IAccountQuery {\n\tconstructor(\n\t\tproviderId: string,\n\t\tpublic readonly accountName: string,\n\t\tqueryService: AuthenticationQueryService\n\t) {\n\t\tsuper(providerId, queryService);\n\t}\n\n\textension(extensionId: string): IAccountExtensionQuery {\n\t\treturn new AccountExtensionQuery(this.providerId, this.accountName, extensionId, this.queryService);\n\t}\n\n\tmcpServer(mcpServerId: string): IAccountMcpServerQuery {\n\t\treturn new AccountMcpServerQuery(this.providerId, this.accountName, mcpServerId, this.queryService);\n\t}\n\n\textensions(): IAccountExtensionsQuery {\n\t\treturn new AccountExtensionsQuery(this.providerId, this.accountName, this.queryService);\n\t}\n\n\tmcpServers(): IAccountMcpServersQuery {\n\t\treturn new AccountMcpServersQuery(this.providerId, this.accountName, this.queryService);\n\t}\n\n\tentities(): IAccountEntitiesQuery {\n\t\treturn new AccountEntitiesQuery(this.providerId, this.accountName, this.queryService);\n\t}\n\n\tremove(): void {\n\t\t// Remove all extension access and usage data\n\t\tthis.queryService.authenticationAccessService.removeAllowedExtensions(this.providerId, this.accountName);\n\t\tthis.queryService.authenticationUsageService.removeAccountUsage(this.providerId, this.accountName);\n\n\t\t// Remove all MCP server access and usage data\n\t\tthis.queryService.authenticationMcpAccessService.removeAllowedMcpServers(this.providerId, this.accountName);\n\t\tthis.queryService.authenticationMcpUsageService.removeAccountUsage(this.providerId, this.accountName);\n\t}\n}\n\n/**\n * Implementation of provider-extension query operations\n */\nclass ProviderExtensionQuery extends BaseQuery implements IProviderExtensionQuery {\n\tconstructor(\n\t\tproviderId: string,\n\t\tpublic readonly extensionId: string,\n\t\tqueryService: AuthenticationQueryService\n\t) {\n\t\tsuper(providerId, queryService);\n\t}\n\n\tgetPreferredAccount(): string | undefined {\n\t\treturn this.queryService.authenticationExtensionsService.getAccountPreference(this.extensionId, this.providerId);\n\t}\n\n\tsetPreferredAccount(account: AuthenticationSessionAccount): void {\n\t\tthis.queryService.authenticationExtensionsService.updateAccountPreference(this.extensionId, this.providerId, account);\n\t}\n\n\tremoveAccountPreference(): void {\n\t\tthis.queryService.authenticationExtensionsService.removeAccountPreference(this.extensionId, this.providerId);\n\t}\n}\n\n/**\n * Implementation of provider-MCP server query operations\n */\nclass ProviderMcpServerQuery extends BaseQuery implements IProviderMcpServerQuery {\n\tconstructor(\n\t\tproviderId: string,\n\t\tpublic readonly mcpServerId: string,\n\t\tqueryService: AuthenticationQueryService\n\t) {\n\t\tsuper(providerId, queryService);\n\t}\n\n\tasync getLastUsedAccount(): Promise<string | undefined> {\n\t\ttry {\n\t\t\tconst accounts = await this.queryService.authenticationService.getAccounts(this.providerId);\n\t\t\tlet lastUsedAccount: string | undefined;\n\t\t\tlet lastUsedTime = 0;\n\n\t\t\tfor (const account of accounts) {\n\t\t\t\tconst usages = this.queryService.authenticationMcpUsageService.readAccountUsages(this.providerId, account.label);\n\t\t\t\tconst mcpServerUsages = usages.filter(usage => usage.mcpServerId === this.mcpServerId);\n\n\t\t\t\tfor (const usage of mcpServerUsages) {\n\t\t\t\t\tif (usage.lastUsed > lastUsedTime) {\n\t\t\t\t\t\tlastUsedTime = usage.lastUsed;\n\t\t\t\t\t\tlastUsedAccount = account.label;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn lastUsedAccount;\n\t\t} catch {\n\t\t\treturn undefined;\n\t\t}\n\t}\n\n\tgetPreferredAccount(): string | undefined {\n\t\treturn this.queryService.authenticationMcpService.getAccountPreference(this.mcpServerId, this.providerId);\n\t}\n\n\tsetPreferredAccount(account: AuthenticationSessionAccount): void {\n\t\tthis.queryService.authenticationMcpService.updateAccountPreference(this.mcpServerId, this.providerId, account);\n\t}\n\n\tremoveAccountPreference(): void {\n\t\tthis.queryService.authenticationMcpService.removeAccountPreference(this.mcpServerId, this.providerId);\n\t}\n\n\tasync getUsedAccounts(): Promise<string[]> {\n\t\ttry {\n\t\t\tconst accounts = await this.queryService.authenticationService.getAccounts(this.providerId);\n\t\t\tconst usedAccounts: string[] = [];\n\n\t\t\tfor (const account of accounts) {\n\t\t\t\tconst usages = this.queryService.authenticationMcpUsageService.readAccountUsages(this.providerId, account.label);\n\t\t\t\tif (usages.some(usage => usage.mcpServerId === this.mcpServerId)) {\n\t\t\t\t\tusedAccounts.push(account.label);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn usedAccounts;\n\t\t} catch {\n\t\t\treturn [];\n\t\t}\n\t}\n}\n\n/**\n * Implementation of provider query operations\n */\nclass ProviderQuery extends BaseQuery implements IProviderQuery {\n\tconstructor(\n\t\tproviderId: string,\n\t\tqueryService: AuthenticationQueryService\n\t) {\n\t\tsuper(providerId, queryService);\n\t}\n\n\taccount(accountName: string): IAccountQuery {\n\t\treturn new AccountQuery(this.providerId, accountName, this.queryService);\n\t}\n\n\textension(extensionId: string): IProviderExtensionQuery {\n\t\treturn new ProviderExtensionQuery(this.providerId, extensionId, this.queryService);\n\t}\n\n\tmcpServer(mcpServerId: string): IProviderMcpServerQuery {\n\t\treturn new ProviderMcpServerQuery(this.providerId, mcpServerId, this.queryService);\n\t}\n\n\tasync getActiveEntities(): Promise<IActiveEntities> {\n\t\tconst extensions: string[] = [];\n\t\tconst mcpServers: string[] = [];\n\n\t\ttry {\n\t\t\tconst accounts = await this.queryService.authenticationService.getAccounts(this.providerId);\n\n\t\t\tfor (const account of accounts) {\n\t\t\t\t// Get extension usages\n\t\t\t\tconst extensionUsages = this.queryService.authenticationUsageService.readAccountUsages(this.providerId, account.label);\n\t\t\t\tfor (const usage of extensionUsages) {\n\t\t\t\t\tif (!extensions.includes(usage.extensionId)) {\n\t\t\t\t\t\textensions.push(usage.extensionId);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Get MCP server usages\n\t\t\t\tconst mcpUsages = this.queryService.authenticationMcpUsageService.readAccountUsages(this.providerId, account.label);\n\t\t\t\tfor (const usage of mcpUsages) {\n\t\t\t\t\tif (!mcpServers.includes(usage.mcpServerId)) {\n\t\t\t\t\t\tmcpServers.push(usage.mcpServerId);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t} catch {\n\t\t\t// Return empty arrays if there's an error\n\t\t}\n\n\t\treturn { extensions, mcpServers };\n\t}\n\n\tasync getAccountNames(): Promise<string[]> {\n\t\ttry {\n\t\t\tconst accounts = await this.queryService.authenticationService.getAccounts(this.providerId);\n\t\t\treturn accounts.map(account => account.label);\n\t\t} catch {\n\t\t\treturn [];\n\t\t}\n\t}\n\n\tasync getUsageStats(): Promise<IAuthenticationUsageStats> {\n\t\tconst recentActivity: { accountName: string; lastUsed: number; usageCount: number }[] = [];\n\t\tlet totalSessions = 0;\n\t\tlet totalAccounts = 0;\n\n\t\ttry {\n\t\t\tconst accounts = await this.queryService.authenticationService.getAccounts(this.providerId);\n\t\t\ttotalAccounts = accounts.length;\n\n\t\t\tfor (const account of accounts) {\n\t\t\t\tconst extensionUsages = this.queryService.authenticationUsageService.readAccountUsages(this.providerId, account.label);\n\t\t\t\tconst mcpUsages = this.queryService.authenticationMcpUsageService.readAccountUsages(this.providerId, account.label);\n\n\t\t\t\tconst allUsages = [...extensionUsages, ...mcpUsages];\n\t\t\t\tconst usageCount = allUsages.length;\n\t\t\t\tconst lastUsed = Math.max(...allUsages.map(u => u.lastUsed), 0);\n\n\t\t\t\tif (usageCount > 0) {\n\t\t\t\t\trecentActivity.push({ accountName: account.label, lastUsed, usageCount });\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Sort by most recent activity\n\t\t\trecentActivity.sort((a, b) => b.lastUsed - a.lastUsed);\n\n\t\t\t// Count total sessions (approximate)\n\t\t\ttotalSessions = recentActivity.reduce((sum, activity) => sum + activity.usageCount, 0);\n\t\t} catch {\n\t\t\t// Return default stats if there's an error\n\t\t}\n\n\t\treturn { totalSessions, totalAccounts, recentActivity };\n\t}\n\n\tasync forEachAccount(callback: (accountQuery: IAccountQuery) => void): Promise<void> {\n\t\ttry {\n\t\t\tconst accounts = await this.queryService.authenticationService.getAccounts(this.providerId);\n\t\t\tfor (const account of accounts) {\n\t\t\t\tconst accountQuery = new AccountQuery(this.providerId, account.label, this.queryService);\n\t\t\t\tcallback(accountQuery);\n\t\t\t}\n\t\t} catch {\n\t\t\t// Silently handle errors in enumeration\n\t\t}\n\t}\n}\n\n/**\n * Implementation of extension query operations (cross-provider)\n */\nclass ExtensionQuery implements IExtensionQuery {\n\tconstructor(\n\t\tpublic readonly extensionId: string,\n\t\tprivate readonly queryService: AuthenticationQueryService\n\t) { }\n\n\tasync getProvidersWithAccess(includeInternal?: boolean): Promise<string[]> {\n\t\tconst providersWithAccess: string[] = [];\n\t\tconst providerIds = this.queryService.authenticationService.getProviderIds();\n\n\t\tfor (const providerId of providerIds) {\n\t\t\t// Skip internal providers unless explicitly requested\n\t\t\tif (!includeInternal && providerId.startsWith(INTERNAL_AUTH_PROVIDER_PREFIX)) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\ttry {\n\t\t\t\tconst accounts = await this.queryService.authenticationService.getAccounts(providerId);\n\t\t\t\tconst hasAccess = accounts.some(account => {\n\t\t\t\t\tconst accessAllowed = this.queryService.authenticationAccessService.isAccessAllowed(providerId, account.label, this.extensionId);\n\t\t\t\t\treturn accessAllowed === true;\n\t\t\t\t});\n\n\t\t\t\tif (hasAccess) {\n\t\t\t\t\tprovidersWithAccess.push(providerId);\n\t\t\t\t}\n\t\t\t} catch {\n\t\t\t\t// Skip providers that error\n\t\t\t}\n\t\t}\n\n\t\treturn providersWithAccess;\n\t}\n\n\tgetAllAccountPreferences(includeInternal?: boolean): Map<string, string> {\n\t\tconst preferences = new Map<string, string>();\n\t\tconst providerIds = this.queryService.authenticationService.getProviderIds();\n\n\t\tfor (const providerId of providerIds) {\n\t\t\t// Skip internal providers unless explicitly requested\n\t\t\tif (!includeInternal && providerId.startsWith(INTERNAL_AUTH_PROVIDER_PREFIX)) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tconst preferredAccount = this.queryService.authenticationExtensionsService.getAccountPreference(this.extensionId, providerId);\n\t\t\tif (preferredAccount) {\n\t\t\t\tpreferences.set(providerId, preferredAccount);\n\t\t\t}\n\t\t}\n\n\t\treturn preferences;\n\t}\n\n\tprovider(providerId: string): IProviderExtensionQuery {\n\t\treturn new ProviderExtensionQuery(providerId, this.extensionId, this.queryService);\n\t}\n}\n\n/**\n * Implementation of MCP server query operations (cross-provider)\n */\nclass McpServerQuery implements IMcpServerQuery {\n\tconstructor(\n\t\tpublic readonly mcpServerId: string,\n\t\tprivate readonly queryService: AuthenticationQueryService\n\t) { }\n\n\tasync getProvidersWithAccess(includeInternal?: boolean): Promise<string[]> {\n\t\tconst providersWithAccess: string[] = [];\n\t\tconst providerIds = this.queryService.authenticationService.getProviderIds();\n\n\t\tfor (const providerId of providerIds) {\n\t\t\t// Skip internal providers unless explicitly requested\n\t\t\tif (!includeInternal && providerId.startsWith(INTERNAL_AUTH_PROVIDER_PREFIX)) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\ttry {\n\t\t\t\tconst accounts = await this.queryService.authenticationService.getAccounts(providerId);\n\t\t\t\tconst hasAccess = accounts.some(account => {\n\t\t\t\t\tconst accessAllowed = this.queryService.authenticationMcpAccessService.isAccessAllowed(providerId, account.label, this.mcpServerId);\n\t\t\t\t\treturn accessAllowed === true;\n\t\t\t\t});\n\n\t\t\t\tif (hasAccess) {\n\t\t\t\t\tprovidersWithAccess.push(providerId);\n\t\t\t\t}\n\t\t\t} catch {\n\t\t\t\t// Skip providers that error\n\t\t\t}\n\t\t}\n\n\t\treturn providersWithAccess;\n\t}\n\n\tgetAllAccountPreferences(includeInternal?: boolean): Map<string, string> {\n\t\tconst preferences = new Map<string, string>();\n\t\tconst providerIds = this.queryService.authenticationService.getProviderIds();\n\n\t\tfor (const providerId of providerIds) {\n\t\t\t// Skip internal providers unless explicitly requested\n\t\t\tif (!includeInternal && providerId.startsWith(INTERNAL_AUTH_PROVIDER_PREFIX)) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tconst preferredAccount = this.queryService.authenticationMcpService.getAccountPreference(this.mcpServerId, providerId);\n\t\t\tif (preferredAccount) {\n\t\t\t\tpreferences.set(providerId, preferredAccount);\n\t\t\t}\n\t\t}\n\n\t\treturn preferences;\n\t}\n\n\tprovider(providerId: string): IProviderMcpServerQuery {\n\t\treturn new ProviderMcpServerQuery(providerId, this.mcpServerId, this.queryService);\n\t}\n}\n\n/**\n * Main implementation of the authentication query service\n */\nexport class AuthenticationQueryService extends Disposable implements IAuthenticationQueryService {\n\tdeclare readonly _serviceBrand: undefined;\n\n\tprivate readonly _onDidChangePreferences = this._register(new Emitter<{\n\t\treadonly providerId: string;\n\t\treadonly entityType: 'extension' | 'mcpServer';\n\t\treadonly entityIds: string[];\n\t}>());\n\treadonly onDidChangePreferences = this._onDidChangePreferences.event;\n\n\tprivate readonly _onDidChangeAccess = this._register(new Emitter<{\n\t\treadonly providerId: string;\n\t\treadonly accountName: string;\n\t}>());\n\treadonly onDidChangeAccess = this._onDidChangeAccess.event;\n\n\tconstructor(\n\t\t@IAuthenticationService public readonly authenticationService: IAuthenticationService,\n\t\t@IAuthenticationUsageService public readonly authenticationUsageService: IAuthenticationUsageService,\n\t\t@IAuthenticationMcpUsageService public readonly authenticationMcpUsageService: IAuthenticationMcpUsageService,\n\t\t@IAuthenticationAccessService public readonly authenticationAccessService: IAuthenticationAccessService,\n\t\t@IAuthenticationMcpAccessService public readonly authenticationMcpAccessService: IAuthenticationMcpAccessService,\n\t\t@IAuthenticationExtensionsService public readonly authenticationExtensionsService: IAuthenticationExtensionsService,\n\t\t@IAuthenticationMcpService public readonly authenticationMcpService: IAuthenticationMcpService,\n\t\t@ILogService public readonly logService: ILogService\n\t) {\n\t\tsuper();\n\n\t\t// Forward events from underlying services\n\t\tthis._register(this.authenticationExtensionsService.onDidChangeAccountPreference(e => {\n\t\t\tthis._onDidChangePreferences.fire({\n\t\t\t\tproviderId: e.providerId,\n\t\t\t\tentityType: 'extension',\n\t\t\t\tentityIds: e.extensionIds\n\t\t\t});\n\t\t}));\n\n\t\tthis._register(this.authenticationMcpService.onDidChangeAccountPreference(e => {\n\t\t\tthis._onDidChangePreferences.fire({\n\t\t\t\tproviderId: e.providerId,\n\t\t\t\tentityType: 'mcpServer',\n\t\t\t\tentityIds: e.mcpServerIds\n\t\t\t});\n\t\t}));\n\n\t\tthis._register(this.authenticationAccessService.onDidChangeExtensionSessionAccess(e => {\n\t\t\tthis._onDidChangeAccess.fire({\n\t\t\t\tproviderId: e.providerId,\n\t\t\t\taccountName: e.accountName\n\t\t\t});\n\t\t}));\n\n\t\tthis._register(this.authenticationMcpAccessService.onDidChangeMcpSessionAccess(e => {\n\t\t\tthis._onDidChangeAccess.fire({\n\t\t\t\tproviderId: e.providerId,\n\t\t\t\taccountName: e.accountName\n\t\t\t});\n\t\t}));\n\t}\n\n\tprovider(providerId: string): IProviderQuery {\n\t\treturn new ProviderQuery(providerId, this);\n\t}\n\n\textension(extensionId: string): IExtensionQuery {\n\t\treturn new ExtensionQuery(extensionId, this);\n\t}\n\n\tmcpServer(mcpServerId: string): IMcpServerQuery {\n\t\treturn new McpServerQuery(mcpServerId, this);\n\t}\n\n\tgetProviderIds(includeInternal?: boolean): string[] {\n\t\treturn this.authenticationService.getProviderIds().filter(providerId => {\n\t\t\t// Filter out internal providers unless explicitly included\n\t\t\treturn includeInternal || !providerId.startsWith(INTERNAL_AUTH_PROVIDER_PREFIX);\n\t\t});\n\t}\n\n\tasync clearAllData(confirmation: 'CLEAR_ALL_AUTH_DATA', includeInternal: boolean = true): Promise<void> {\n\t\tif (confirmation !== 'CLEAR_ALL_AUTH_DATA') {\n\t\t\tthrow new Error('Must provide confirmation string to clear all authentication data');\n\t\t}\n\n\t\tconst providerIds = this.getProviderIds(includeInternal);\n\n\t\tfor (const providerId of providerIds) {\n\t\t\ttry {\n\t\t\t\tconst accounts = await this.authenticationService.getAccounts(providerId);\n\n\t\t\t\tfor (const account of accounts) {\n\t\t\t\t\t// Clear extension data\n\t\t\t\t\tthis.authenticationAccessService.removeAllowedExtensions(providerId, account.label);\n\t\t\t\t\tthis.authenticationUsageService.removeAccountUsage(providerId, account.label);\n\n\t\t\t\t\t// Clear MCP server data\n\t\t\t\t\tthis.authenticationMcpAccessService.removeAllowedMcpServers(providerId, account.label);\n\t\t\t\t\tthis.authenticationMcpUsageService.removeAccountUsage(providerId, account.label);\n\t\t\t\t}\n\t\t\t} catch (error) {\n\t\t\t\tthis.logService.error(`Error clearing data for provider ${providerId}:`, error);\n\t\t\t}\n\t\t}\n\n\t\tthis.logService.info('All authentication data cleared');\n\t}\n}\n\nregisterSingleton(IAuthenticationQueryService, AuthenticationQueryService, InstantiationType.Delayed);\n"]}