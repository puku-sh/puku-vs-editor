{"version":3,"sources":["vs/workbench/services/authentication/browser/authenticationService.ts"],"names":[],"mappings":"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","file":"authenticationService.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Emitter, Event } from '../../../../base/common/event.js';\nimport { Disposable, DisposableMap, DisposableStore, IDisposable, isDisposable, toDisposable } from '../../../../base/common/lifecycle.js';\nimport { equalsIgnoreCase, isFalsyOrWhitespace } from '../../../../base/common/strings.js';\nimport { isString } from '../../../../base/common/types.js';\nimport { localize } from '../../../../nls.js';\nimport { InstantiationType, registerSingleton } from '../../../../platform/instantiation/common/extensions.js';\nimport { IProductService } from '../../../../platform/product/common/productService.js';\nimport { ISecretStorageService } from '../../../../platform/secrets/common/secrets.js';\nimport { IAuthenticationAccessService } from './authenticationAccessService.js';\nimport { AuthenticationProviderInformation, AuthenticationSession, AuthenticationSessionAccount, AuthenticationSessionsChangeEvent, IAuthenticationCreateSessionOptions, IAuthenticationGetSessionsOptions, IAuthenticationProvider, IAuthenticationProviderHostDelegate, IAuthenticationService, IAuthenticationWwwAuthenticateRequest, isAuthenticationWwwAuthenticateRequest } from '../common/authentication.js';\nimport { IBrowserWorkbenchEnvironmentService } from '../../environment/browser/environmentService.js';\nimport { ActivationKind, IExtensionService } from '../../extensions/common/extensions.js';\nimport { ILogService } from '../../../../platform/log/common/log.js';\nimport { IJSONSchema } from '../../../../base/common/jsonSchema.js';\nimport { ExtensionsRegistry } from '../../extensions/common/extensionsRegistry.js';\nimport { match } from '../../../../base/common/glob.js';\nimport { URI } from '../../../../base/common/uri.js';\nimport { IAuthorizationProtectedResourceMetadata, IAuthorizationServerMetadata, parseWWWAuthenticateHeader } from '../../../../base/common/oauth.js';\nimport { raceCancellation, raceTimeout } from '../../../../base/common/async.js';\nimport { CancellationTokenSource } from '../../../../base/common/cancellation.js';\n\nexport function getAuthenticationProviderActivationEvent(id: string): string { return `onAuthenticationRequest:${id}`; }\n\n// TODO: pull this out into its own service\nexport type AuthenticationSessionInfo = { readonly id: string; readonly accessToken: string; readonly providerId: string; readonly canSignOut?: boolean };\nexport async function getCurrentAuthenticationSessionInfo(\n\tsecretStorageService: ISecretStorageService,\n\tproductService: IProductService\n): Promise<AuthenticationSessionInfo | undefined> {\n\tconst authenticationSessionValue = await secretStorageService.get(`${productService.urlProtocol}.loginAccount`);\n\tif (authenticationSessionValue) {\n\t\ttry {\n\t\t\tconst authenticationSessionInfo: AuthenticationSessionInfo = JSON.parse(authenticationSessionValue);\n\t\t\tif (authenticationSessionInfo\n\t\t\t\t&& isString(authenticationSessionInfo.id)\n\t\t\t\t&& isString(authenticationSessionInfo.accessToken)\n\t\t\t\t&& isString(authenticationSessionInfo.providerId)\n\t\t\t) {\n\t\t\t\treturn authenticationSessionInfo;\n\t\t\t}\n\t\t} catch (e) {\n\t\t\t// This is a best effort operation.\n\t\t\tconsole.error(`Failed parsing current auth session value: ${e}`);\n\t\t}\n\t}\n\treturn undefined;\n}\n\nconst authenticationDefinitionSchema: IJSONSchema = {\n\ttype: 'object',\n\tadditionalProperties: false,\n\tproperties: {\n\t\tid: {\n\t\t\ttype: 'string',\n\t\t\tdescription: localize('authentication.id', 'The id of the authentication provider.')\n\t\t},\n\t\tlabel: {\n\t\t\ttype: 'string',\n\t\t\tdescription: localize('authentication.label', 'The human readable name of the authentication provider.'),\n\t\t},\n\t\tauthorizationServerGlobs: {\n\t\t\ttype: 'array',\n\t\t\titems: {\n\t\t\t\ttype: 'string',\n\t\t\t\tdescription: localize('authentication.authorizationServerGlobs', 'A list of globs that match the authorization servers that this provider supports.'),\n\t\t\t},\n\t\t\tdescription: localize('authentication.authorizationServerGlobsDescription', 'A list of globs that match the authorization servers that this provider supports.')\n\t\t}\n\t}\n};\n\nconst authenticationExtPoint = ExtensionsRegistry.registerExtensionPoint<AuthenticationProviderInformation[]>({\n\textensionPoint: 'authentication',\n\tjsonSchema: {\n\t\tdescription: localize({ key: 'authenticationExtensionPoint', comment: [`'Contributes' means adds here`] }, 'Contributes authentication'),\n\t\ttype: 'array',\n\t\titems: authenticationDefinitionSchema\n\t},\n\tactivationEventsGenerator: function* (authenticationProviders) {\n\t\tfor (const authenticationProvider of authenticationProviders) {\n\t\t\tif (authenticationProvider.id) {\n\t\t\t\tyield `onAuthenticationRequest:${authenticationProvider.id}`;\n\t\t\t}\n\t\t}\n\t}\n});\n\nexport class AuthenticationService extends Disposable implements IAuthenticationService {\n\tdeclare readonly _serviceBrand: undefined;\n\n\tprivate _onDidRegisterAuthenticationProvider: Emitter<AuthenticationProviderInformation> = this._register(new Emitter<AuthenticationProviderInformation>());\n\treadonly onDidRegisterAuthenticationProvider: Event<AuthenticationProviderInformation> = this._onDidRegisterAuthenticationProvider.event;\n\n\tprivate _onDidUnregisterAuthenticationProvider: Emitter<AuthenticationProviderInformation> = this._register(new Emitter<AuthenticationProviderInformation>());\n\treadonly onDidUnregisterAuthenticationProvider: Event<AuthenticationProviderInformation> = this._onDidUnregisterAuthenticationProvider.event;\n\n\tprivate _onDidChangeSessions: Emitter<{ providerId: string; label: string; event: AuthenticationSessionsChangeEvent }> = this._register(new Emitter<{ providerId: string; label: string; event: AuthenticationSessionsChangeEvent }>());\n\treadonly onDidChangeSessions: Event<{ providerId: string; label: string; event: AuthenticationSessionsChangeEvent }> = this._onDidChangeSessions.event;\n\n\tprivate _onDidChangeDeclaredProviders: Emitter<void> = this._register(new Emitter<void>());\n\treadonly onDidChangeDeclaredProviders: Event<void> = this._onDidChangeDeclaredProviders.event;\n\n\tprivate _authenticationProviders: Map<string, IAuthenticationProvider> = new Map<string, IAuthenticationProvider>();\n\tprivate _authenticationProviderDisposables: DisposableMap<string, IDisposable> = this._register(new DisposableMap<string, IDisposable>());\n\tprivate _dynamicAuthenticationProviderIds = new Set<string>();\n\n\tprivate readonly _delegates: IAuthenticationProviderHostDelegate[] = [];\n\n\tprivate _disposedSource = new CancellationTokenSource();\n\n\tconstructor(\n\t\t@IExtensionService private readonly _extensionService: IExtensionService,\n\t\t@IAuthenticationAccessService authenticationAccessService: IAuthenticationAccessService,\n\t\t@IBrowserWorkbenchEnvironmentService private readonly _environmentService: IBrowserWorkbenchEnvironmentService,\n\t\t@ILogService private readonly _logService: ILogService\n\t) {\n\t\tsuper();\n\t\tthis._register(toDisposable(() => this._disposedSource.dispose(true)));\n\t\tthis._register(authenticationAccessService.onDidChangeExtensionSessionAccess(e => {\n\t\t\t// The access has changed, not the actual session itself but extensions depend on this event firing\n\t\t\t// when they have gained access to an account so this fires that event.\n\t\t\tthis._onDidChangeSessions.fire({\n\t\t\t\tproviderId: e.providerId,\n\t\t\t\tlabel: e.accountName,\n\t\t\t\tevent: {\n\t\t\t\t\tadded: [],\n\t\t\t\t\tchanged: [],\n\t\t\t\t\tremoved: []\n\t\t\t\t}\n\t\t\t});\n\t\t}));\n\n\t\tthis._registerEnvContributedAuthenticationProviders();\n\t\tthis._registerAuthenticationExtensionPointHandler();\n\t}\n\n\tprivate _declaredProviders: AuthenticationProviderInformation[] = [];\n\tget declaredProviders(): AuthenticationProviderInformation[] {\n\t\treturn this._declaredProviders;\n\t}\n\n\tprivate _registerEnvContributedAuthenticationProviders(): void {\n\t\tif (!this._environmentService.options?.authenticationProviders?.length) {\n\t\t\treturn;\n\t\t}\n\t\tfor (const provider of this._environmentService.options.authenticationProviders) {\n\t\t\tthis.registerDeclaredAuthenticationProvider(provider);\n\t\t\tthis.registerAuthenticationProvider(provider.id, provider);\n\t\t}\n\t}\n\n\tprivate _registerAuthenticationExtensionPointHandler(): void {\n\t\tthis._register(authenticationExtPoint.setHandler((_extensions, { added, removed }) => {\n\t\t\tthis._logService.debug(`Found authentication providers. added: ${added.length}, removed: ${removed.length}`);\n\t\t\tadded.forEach(point => {\n\t\t\t\tfor (const provider of point.value) {\n\t\t\t\t\tif (isFalsyOrWhitespace(provider.id)) {\n\t\t\t\t\t\tpoint.collector.error(localize('authentication.missingId', 'An authentication contribution must specify an id.'));\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (isFalsyOrWhitespace(provider.label)) {\n\t\t\t\t\t\tpoint.collector.error(localize('authentication.missingLabel', 'An authentication contribution must specify a label.'));\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!this.declaredProviders.some(p => p.id === provider.id)) {\n\t\t\t\t\t\tthis.registerDeclaredAuthenticationProvider(provider);\n\t\t\t\t\t\tthis._logService.debug(`Declared authentication provider: ${provider.id}`);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tpoint.collector.error(localize('authentication.idConflict', \"This authentication id '{0}' has already been registered\", provider.id));\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tconst removedExtPoints = removed.flatMap(r => r.value);\n\t\t\tremovedExtPoints.forEach(point => {\n\t\t\t\tconst provider = this.declaredProviders.find(provider => provider.id === point.id);\n\t\t\t\tif (provider) {\n\t\t\t\t\tthis.unregisterDeclaredAuthenticationProvider(provider.id);\n\t\t\t\t\tthis._logService.debug(`Undeclared authentication provider: ${provider.id}`);\n\t\t\t\t}\n\t\t\t});\n\t\t}));\n\t}\n\n\tregisterDeclaredAuthenticationProvider(provider: AuthenticationProviderInformation): void {\n\t\tif (isFalsyOrWhitespace(provider.id)) {\n\t\t\tthrow new Error(localize('authentication.missingId', 'An authentication contribution must specify an id.'));\n\t\t}\n\t\tif (isFalsyOrWhitespace(provider.label)) {\n\t\t\tthrow new Error(localize('authentication.missingLabel', 'An authentication contribution must specify a label.'));\n\t\t}\n\t\tif (this.declaredProviders.some(p => p.id === provider.id)) {\n\t\t\tthrow new Error(localize('authentication.idConflict', \"This authentication id '{0}' has already been registered\", provider.id));\n\t\t}\n\t\tthis._declaredProviders.push(provider);\n\t\tthis._onDidChangeDeclaredProviders.fire();\n\t}\n\n\tunregisterDeclaredAuthenticationProvider(id: string): void {\n\t\tconst index = this.declaredProviders.findIndex(provider => provider.id === id);\n\t\tif (index > -1) {\n\t\t\tthis.declaredProviders.splice(index, 1);\n\t\t}\n\t\tthis._onDidChangeDeclaredProviders.fire();\n\t}\n\n\tisAuthenticationProviderRegistered(id: string): boolean {\n\t\treturn this._authenticationProviders.has(id);\n\t}\n\n\tisDynamicAuthenticationProvider(id: string): boolean {\n\t\treturn this._dynamicAuthenticationProviderIds.has(id);\n\t}\n\n\tregisterAuthenticationProvider(id: string, authenticationProvider: IAuthenticationProvider): void {\n\t\tthis._authenticationProviders.set(id, authenticationProvider);\n\t\tconst disposableStore = new DisposableStore();\n\t\tdisposableStore.add(authenticationProvider.onDidChangeSessions(e => this._onDidChangeSessions.fire({\n\t\t\tproviderId: id,\n\t\t\tlabel: authenticationProvider.label,\n\t\t\tevent: e\n\t\t})));\n\t\tif (isDisposable(authenticationProvider)) {\n\t\t\tdisposableStore.add(authenticationProvider);\n\t\t}\n\t\tthis._authenticationProviderDisposables.set(id, disposableStore);\n\t\tthis._onDidRegisterAuthenticationProvider.fire({ id, label: authenticationProvider.label });\n\t}\n\n\tunregisterAuthenticationProvider(id: string): void {\n\t\tconst provider = this._authenticationProviders.get(id);\n\t\tif (provider) {\n\t\t\tthis._authenticationProviders.delete(id);\n\t\t\t// If this is a dynamic provider, remove it from the set of dynamic providers\n\t\t\tif (this._dynamicAuthenticationProviderIds.has(id)) {\n\t\t\t\tthis._dynamicAuthenticationProviderIds.delete(id);\n\t\t\t}\n\t\t\tthis._onDidUnregisterAuthenticationProvider.fire({ id, label: provider.label });\n\t\t}\n\t\tthis._authenticationProviderDisposables.deleteAndDispose(id);\n\t}\n\n\tgetProviderIds(): string[] {\n\t\tconst providerIds: string[] = [];\n\t\tthis._authenticationProviders.forEach(provider => {\n\t\t\tproviderIds.push(provider.id);\n\t\t});\n\t\treturn providerIds;\n\t}\n\n\tgetProvider(id: string): IAuthenticationProvider {\n\t\tif (this._authenticationProviders.has(id)) {\n\t\t\treturn this._authenticationProviders.get(id)!;\n\t\t}\n\t\tthrow new Error(`No authentication provider '${id}' is currently registered.`);\n\t}\n\n\tasync getAccounts(id: string): Promise<ReadonlyArray<AuthenticationSessionAccount>> {\n\t\t// TODO: Cache this\n\t\tconst sessions = await this.getSessions(id);\n\t\tconst accounts = new Array<AuthenticationSessionAccount>();\n\t\tconst seenAccounts = new Set<string>();\n\t\tfor (const session of sessions) {\n\t\t\tif (!seenAccounts.has(session.account.label)) {\n\t\t\t\tseenAccounts.add(session.account.label);\n\t\t\t\taccounts.push(session.account);\n\t\t\t}\n\t\t}\n\t\treturn accounts;\n\t}\n\n\tasync getSessions(id: string, scopeListOrRequest?: ReadonlyArray<string> | IAuthenticationWwwAuthenticateRequest, options?: IAuthenticationGetSessionsOptions, activateImmediate: boolean = false): Promise<ReadonlyArray<AuthenticationSession>> {\n\t\tif (this._disposedSource.token.isCancellationRequested) {\n\t\t\treturn [];\n\t\t}\n\n\t\tconst authProvider = this._authenticationProviders.get(id) || await this.tryActivateProvider(id, activateImmediate);\n\t\tif (authProvider) {\n\t\t\t// Check if the authorization server is in the list of supported authorization servers\n\t\t\tconst server = options?.authorizationServer;\n\t\t\tif (server) {\n\t\t\t\t// Skip the resource server check since the auth provider id contains a specific resource server\n\t\t\t\t// TODO@TylerLeonhardt: this can change when we have providers that support multiple resource servers\n\t\t\t\tif (!this.matchesProvider(authProvider, server)) {\n\t\t\t\t\tthrow new Error(`The authentication provider '${id}' does not support the authorization server '${server.toString(true)}'.`);\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (isAuthenticationWwwAuthenticateRequest(scopeListOrRequest)) {\n\t\t\t\tif (!authProvider.getSessionsFromChallenges) {\n\t\t\t\t\tthrow new Error(`The authentication provider '${id}' does not support getting sessions from challenges.`);\n\t\t\t\t}\n\t\t\t\treturn await authProvider.getSessionsFromChallenges(\n\t\t\t\t\t{ challenges: parseWWWAuthenticateHeader(scopeListOrRequest.wwwAuthenticate), fallbackScopes: scopeListOrRequest.fallbackScopes },\n\t\t\t\t\t{ ...options }\n\t\t\t\t);\n\t\t\t}\n\t\t\treturn await authProvider.getSessions(scopeListOrRequest ? [...scopeListOrRequest] : undefined, { ...options });\n\t\t} else {\n\t\t\tthrow new Error(`No authentication provider '${id}' is currently registered.`);\n\t\t}\n\t}\n\n\tasync createSession(id: string, scopeListOrRequest: ReadonlyArray<string> | IAuthenticationWwwAuthenticateRequest, options?: IAuthenticationCreateSessionOptions): Promise<AuthenticationSession> {\n\t\tif (this._disposedSource.token.isCancellationRequested) {\n\t\t\tthrow new Error('Authentication service is disposed.');\n\t\t}\n\n\t\tconst authProvider = this._authenticationProviders.get(id) || await this.tryActivateProvider(id, !!options?.activateImmediate);\n\t\tif (authProvider) {\n\t\t\tif (isAuthenticationWwwAuthenticateRequest(scopeListOrRequest)) {\n\t\t\t\tif (!authProvider.createSessionFromChallenges) {\n\t\t\t\t\tthrow new Error(`The authentication provider '${id}' does not support creating sessions from challenges.`);\n\t\t\t\t}\n\t\t\t\treturn await authProvider.createSessionFromChallenges(\n\t\t\t\t\t{ challenges: parseWWWAuthenticateHeader(scopeListOrRequest.wwwAuthenticate), fallbackScopes: scopeListOrRequest.fallbackScopes },\n\t\t\t\t\t{ ...options }\n\t\t\t\t);\n\t\t\t}\n\t\t\treturn await authProvider.createSession([...scopeListOrRequest], { ...options });\n\t\t} else {\n\t\t\tthrow new Error(`No authentication provider '${id}' is currently registered.`);\n\t\t}\n\t}\n\n\tasync removeSession(id: string, sessionId: string): Promise<void> {\n\t\tif (this._disposedSource.token.isCancellationRequested) {\n\t\t\tthrow new Error('Authentication service is disposed.');\n\t\t}\n\n\t\tconst authProvider = this._authenticationProviders.get(id);\n\t\tif (authProvider) {\n\t\t\treturn authProvider.removeSession(sessionId);\n\t\t} else {\n\t\t\tthrow new Error(`No authentication provider '${id}' is currently registered.`);\n\t\t}\n\t}\n\n\tasync getOrActivateProviderIdForServer(authorizationServer: URI, resourceServer?: URI): Promise<string | undefined> {\n\t\tfor (const provider of this._authenticationProviders.values()) {\n\t\t\tif (this.matchesProvider(provider, authorizationServer, resourceServer)) {\n\t\t\t\treturn provider.id;\n\t\t\t}\n\t\t}\n\n\t\tconst authServerStr = authorizationServer.toString(true);\n\t\tconst providers = this._declaredProviders\n\t\t\t// Only consider providers that are not already registered since we already checked them\n\t\t\t.filter(p => !this._authenticationProviders.has(p.id))\n\t\t\t.filter(p => !!p.authorizationServerGlobs?.some(i => match(i, authServerStr, { ignoreCase: true })));\n\n\t\t// TODO:@TylerLeonhardt fan out?\n\t\tfor (const provider of providers) {\n\t\t\tconst activeProvider = await this.tryActivateProvider(provider.id, true);\n\t\t\t// Check the resolved authorization servers\n\t\t\tif (this.matchesProvider(activeProvider, authorizationServer, resourceServer)) {\n\t\t\t\treturn activeProvider.id;\n\t\t\t}\n\t\t}\n\t\treturn undefined;\n\t}\n\n\tasync createDynamicAuthenticationProvider(authorizationServer: URI, serverMetadata: IAuthorizationServerMetadata, resource: IAuthorizationProtectedResourceMetadata | undefined): Promise<IAuthenticationProvider | undefined> {\n\t\tconst delegate = this._delegates[0];\n\t\tif (!delegate) {\n\t\t\tthis._logService.error('No authentication provider host delegate found');\n\t\t\treturn undefined;\n\t\t}\n\t\tconst providerId = await delegate.create(authorizationServer, serverMetadata, resource);\n\t\tconst provider = this._authenticationProviders.get(providerId);\n\t\tif (provider) {\n\t\t\tthis._logService.debug(`Created dynamic authentication provider: ${providerId}`);\n\t\t\tthis._dynamicAuthenticationProviderIds.add(providerId);\n\t\t\treturn provider;\n\t\t}\n\t\tthis._logService.error(`Failed to create dynamic authentication provider: ${providerId}`);\n\t\treturn undefined;\n\t}\n\n\tregisterAuthenticationProviderHostDelegate(delegate: IAuthenticationProviderHostDelegate): IDisposable {\n\t\tthis._delegates.push(delegate);\n\t\tthis._delegates.sort((a, b) => b.priority - a.priority);\n\n\t\treturn {\n\t\t\tdispose: () => {\n\t\t\t\tconst index = this._delegates.indexOf(delegate);\n\t\t\t\tif (index !== -1) {\n\t\t\t\t\tthis._delegates.splice(index, 1);\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t}\n\n\tprivate matchesProvider(provider: IAuthenticationProvider, authorizationServer: URI, resourceServer?: URI): boolean {\n\t\t// If a resourceServer is provided and the provider has a resourceServer defined, they must match\n\t\tif (resourceServer && provider.resourceServer) {\n\t\t\tconst resourceServerStr = resourceServer.toString(true);\n\t\t\tconst providerResourceServerStr = provider.resourceServer.toString(true);\n\t\t\tif (!equalsIgnoreCase(providerResourceServerStr, resourceServerStr)) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\n\t\tif (provider.authorizationServers) {\n\t\t\tconst authServerStr = authorizationServer.toString(true);\n\t\t\tfor (const server of provider.authorizationServers) {\n\t\t\t\tconst str = server.toString(true);\n\t\t\t\tif (equalsIgnoreCase(str, authServerStr) || match(str, authServerStr, { ignoreCase: true })) {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t}\n\n\tprivate async tryActivateProvider(providerId: string, activateImmediate: boolean): Promise<IAuthenticationProvider> {\n\t\tawait this._extensionService.activateByEvent(getAuthenticationProviderActivationEvent(providerId), activateImmediate ? ActivationKind.Immediate : ActivationKind.Normal);\n\t\tlet provider = this._authenticationProviders.get(providerId);\n\t\tif (provider) {\n\t\t\treturn provider;\n\t\t}\n\t\tif (this._disposedSource.token.isCancellationRequested) {\n\t\t\tthrow new Error('Authentication service is disposed.');\n\t\t}\n\n\t\tconst store = new DisposableStore();\n\t\ttry {\n\t\t\tconst result = await raceTimeout(\n\t\t\t\traceCancellation(\n\t\t\t\t\tEvent.toPromise(\n\t\t\t\t\t\tEvent.filter(\n\t\t\t\t\t\t\tthis.onDidRegisterAuthenticationProvider,\n\t\t\t\t\t\t\te => e.id === providerId,\n\t\t\t\t\t\t\tstore\n\t\t\t\t\t\t),\n\t\t\t\t\t\tstore\n\t\t\t\t\t),\n\t\t\t\t\tthis._disposedSource.token\n\t\t\t\t),\n\t\t\t\t5000\n\t\t\t);\n\t\t\tif (!result) {\n\t\t\t\tthrow new Error(`Timed out waiting for authentication provider '${providerId}' to register.`);\n\t\t\t}\n\t\t\tprovider = this._authenticationProviders.get(result.id);\n\t\t\tif (provider) {\n\t\t\t\treturn provider;\n\t\t\t}\n\t\t\tthrow new Error(`No authentication provider '${providerId}' is currently registered.`);\n\t\t} finally {\n\t\t\tstore.dispose();\n\t\t}\n\t}\n}\n\nregisterSingleton(IAuthenticationService, AuthenticationService, InstantiationType.Delayed);\n"]}