{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/services/policies/test/common/accountPolicyService.test.ts","vs/workbench/services/policies/test/common/accountPolicyService.test.ts"],"names":[],"mappings":"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","file":"accountPolicyService.test.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport assert from 'assert';\nimport { NullLogService } from '../../../../../platform/log/common/log.js';\nimport { DefaultAccountService, IDefaultAccountService } from '../../../accounts/common/defaultAccount.js';\nimport { AccountPolicyService } from '../../common/accountPolicyService.js';\nimport { ensureNoDisposablesAreLeakedInTestSuite } from '../../../../../base/test/common/utils.js';\nimport { Registry } from '../../../../../platform/registry/common/platform.js';\nimport { Extensions, IConfigurationNode, IConfigurationRegistry } from '../../../../../platform/configuration/common/configurationRegistry.js';\nimport { DefaultConfiguration, PolicyConfiguration } from '../../../../../platform/configuration/common/configurations.js';\nimport { IDefaultAccount } from '../../../../../base/common/defaultAccount.js';\nimport { PolicyCategory } from '../../../../../base/common/policy.js';\n\nconst BASE_DEFAULT_ACCOUNT: IDefaultAccount = {\n\tenterprise: false,\n\tsessionId: 'abc123',\n};\n\nsuite('AccountPolicyService', () => {\n\n\tconst disposables = ensureNoDisposablesAreLeakedInTestSuite();\n\n\tlet policyService: AccountPolicyService;\n\tlet defaultAccountService: IDefaultAccountService;\n\tlet policyConfiguration: PolicyConfiguration;\n\tconst logService = new NullLogService();\n\n\tconst policyConfigurationNode: IConfigurationNode = {\n\t\t'id': 'policyConfiguration',\n\t\t'order': 1,\n\t\t'title': 'a',\n\t\t'type': 'object',\n\t\t'properties': {\n\t\t\t'setting.A': {\n\t\t\t\t'type': 'string',\n\t\t\t\t'default': 'defaultValueA',\n\t\t\t\tpolicy: {\n\t\t\t\t\tname: 'PolicySettingA',\n\t\t\t\t\tcategory: PolicyCategory.Extensions,\n\t\t\t\t\tminimumVersion: '1.0.0',\n\t\t\t\t\tlocalization: { description: { key: '', value: '' } }\n\t\t\t\t}\n\t\t\t},\n\t\t\t'setting.B': {\n\t\t\t\t'type': 'string',\n\t\t\t\t'default': 'defaultValueB',\n\t\t\t\tpolicy: {\n\t\t\t\t\tname: 'PolicySettingB',\n\t\t\t\t\tcategory: PolicyCategory.Extensions,\n\t\t\t\t\tminimumVersion: '1.0.0',\n\t\t\t\t\tlocalization: { description: { key: '', value: '' } },\n\t\t\t\t\tvalue: account => account.chat_preview_features_enabled === false ? 'policyValueB' : undefined,\n\t\t\t\t}\n\t\t\t},\n\t\t\t'setting.C': {\n\t\t\t\t'type': 'array',\n\t\t\t\t'default': ['defaultValueC1', 'defaultValueC2'],\n\t\t\t\tpolicy: {\n\t\t\t\t\tname: 'PolicySettingC',\n\t\t\t\t\tcategory: PolicyCategory.Extensions,\n\t\t\t\t\tminimumVersion: '1.0.0',\n\t\t\t\t\tlocalization: { description: { key: '', value: '' } },\n\t\t\t\t\tvalue: account => account.chat_preview_features_enabled === false ? JSON.stringify(['policyValueC1', 'policyValueC2']) : undefined,\n\t\t\t\t}\n\t\t\t},\n\t\t\t'setting.D': {\n\t\t\t\t'type': 'boolean',\n\t\t\t\t'default': true,\n\t\t\t\tpolicy: {\n\t\t\t\t\tname: 'PolicySettingD',\n\t\t\t\t\tcategory: PolicyCategory.Extensions,\n\t\t\t\t\tminimumVersion: '1.0.0',\n\t\t\t\t\tlocalization: { description: { key: '', value: '' } },\n\t\t\t\t\tvalue: account => account.chat_preview_features_enabled === false ? false : undefined,\n\t\t\t\t}\n\t\t\t},\n\t\t\t'setting.E': {\n\t\t\t\t'type': 'boolean',\n\t\t\t\t'default': true,\n\t\t\t}\n\t\t}\n\t};\n\n\n\tsuiteSetup(() => Registry.as<IConfigurationRegistry>(Extensions.Configuration).registerConfiguration(policyConfigurationNode));\n\tsuiteTeardown(() => Registry.as<IConfigurationRegistry>(Extensions.Configuration).deregisterConfigurations([policyConfigurationNode]));\n\n\tsetup(async () => {\n\t\tconst defaultConfiguration = disposables.add(new DefaultConfiguration(new NullLogService()));\n\t\tawait defaultConfiguration.initialize();\n\n\t\tdefaultAccountService = disposables.add(new DefaultAccountService());\n\t\tpolicyService = disposables.add(new AccountPolicyService(logService, defaultAccountService));\n\t\tpolicyConfiguration = disposables.add(new PolicyConfiguration(defaultConfiguration, policyService, new NullLogService()));\n\n\t});\n\n\tasync function assertDefaultBehavior(defaultAccount: IDefaultAccount) {\n\t\tdefaultAccountService.setDefaultAccount(defaultAccount);\n\n\t\tawait policyConfiguration.initialize();\n\n\t\t{\n\t\t\tconst A = policyService.getPolicyValue('PolicySettingA');\n\t\t\tconst B = policyService.getPolicyValue('PolicySettingB');\n\t\t\tconst C = policyService.getPolicyValue('PolicySettingC');\n\t\t\tconst D = policyService.getPolicyValue('PolicySettingD');\n\n\t\t\t// No policy is set\n\t\t\tassert.strictEqual(A, undefined);\n\t\t\tassert.strictEqual(B, undefined);\n\t\t\tassert.strictEqual(C, undefined);\n\t\t\tassert.strictEqual(D, undefined);\n\t\t}\n\n\t\t{\n\t\t\tconst B = policyConfiguration.configurationModel.getValue('setting.B');\n\t\t\tconst C = policyConfiguration.configurationModel.getValue('setting.C');\n\t\t\tconst D = policyConfiguration.configurationModel.getValue('setting.D');\n\n\t\t\tassert.strictEqual(B, undefined);\n\t\t\tassert.deepStrictEqual(C, undefined);\n\t\t\tassert.strictEqual(D, undefined);\n\t\t}\n\t}\n\n\n\ttest('should initialize with default account', async () => {\n\t\tconst defaultAccount = { ...BASE_DEFAULT_ACCOUNT };\n\t\tawait assertDefaultBehavior(defaultAccount);\n\t});\n\n\ttest('should initialize with default account and preview features enabled', async () => {\n\t\tconst defaultAccount = { ...BASE_DEFAULT_ACCOUNT, chat_preview_features_enabled: true };\n\t\tawait assertDefaultBehavior(defaultAccount);\n\t});\n\n\ttest('should initialize with default account and preview features disabled', async () => {\n\t\tconst defaultAccount = { ...BASE_DEFAULT_ACCOUNT, chat_preview_features_enabled: false };\n\t\tdefaultAccountService.setDefaultAccount(defaultAccount);\n\n\t\tawait policyConfiguration.initialize();\n\t\tconst actualConfigurationModel = policyConfiguration.configurationModel;\n\n\t\t{\n\t\t\tconst A = policyService.getPolicyValue('PolicySettingA');\n\t\t\tconst B = policyService.getPolicyValue('PolicySettingB');\n\t\t\tconst C = policyService.getPolicyValue('PolicySettingC');\n\t\t\tconst D = policyService.getPolicyValue('PolicySettingD');\n\n\t\t\tassert.strictEqual(A, undefined); // Not tagged with chat preview tags\n\t\t\tassert.strictEqual(B, 'policyValueB');\n\t\t\tassert.strictEqual(C, JSON.stringify(['policyValueC1', 'policyValueC2']));\n\t\t\tassert.strictEqual(D, false);\n\t\t}\n\n\t\t{\n\t\t\tconst B = actualConfigurationModel.getValue('setting.B');\n\t\t\tconst C = actualConfigurationModel.getValue('setting.C');\n\t\t\tconst D = actualConfigurationModel.getValue('setting.D');\n\n\t\t\tassert.strictEqual(B, 'policyValueB');\n\t\t\tassert.deepStrictEqual(C, ['policyValueC1', 'policyValueC2']);\n\t\t\tassert.strictEqual(D, false);\n\t\t}\n\t});\n});\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport assert from 'assert';\nimport { NullLogService } from '../../../../../platform/log/common/log.js';\nimport { DefaultAccountService, IDefaultAccountService } from '../../../accounts/common/defaultAccount.js';\nimport { AccountPolicyService } from '../../common/accountPolicyService.js';\nimport { ensureNoDisposablesAreLeakedInTestSuite } from '../../../../../base/test/common/utils.js';\nimport { Registry } from '../../../../../platform/registry/common/platform.js';\nimport { Extensions, IConfigurationNode, IConfigurationRegistry } from '../../../../../platform/configuration/common/configurationRegistry.js';\nimport { DefaultConfiguration, PolicyConfiguration } from '../../../../../platform/configuration/common/configurations.js';\nimport { IDefaultAccount } from '../../../../../base/common/defaultAccount.js';\nimport { PolicyCategory } from '../../../../../base/common/policy.js';\n\nconst BASE_DEFAULT_ACCOUNT: IDefaultAccount = {\n\tenterprise: false,\n\tsessionId: 'abc123',\n};\n\nsuite('AccountPolicyService', () => {\n\n\tconst disposables = ensureNoDisposablesAreLeakedInTestSuite();\n\n\tlet policyService: AccountPolicyService;\n\tlet defaultAccountService: IDefaultAccountService;\n\tlet policyConfiguration: PolicyConfiguration;\n\tconst logService = new NullLogService();\n\n\tconst policyConfigurationNode: IConfigurationNode = {\n\t\t'id': 'policyConfiguration',\n\t\t'order': 1,\n\t\t'title': 'a',\n\t\t'type': 'object',\n\t\t'properties': {\n\t\t\t'setting.A': {\n\t\t\t\t'type': 'string',\n\t\t\t\t'default': 'defaultValueA',\n\t\t\t\tpolicy: {\n\t\t\t\t\tname: 'PolicySettingA',\n\t\t\t\t\tcategory: PolicyCategory.Extensions,\n\t\t\t\t\tminimumVersion: '1.0.0',\n\t\t\t\t\tlocalization: { description: { key: '', value: '' } }\n\t\t\t\t}\n\t\t\t},\n\t\t\t'setting.B': {\n\t\t\t\t'type': 'string',\n\t\t\t\t'default': 'defaultValueB',\n\t\t\t\tpolicy: {\n\t\t\t\t\tname: 'PolicySettingB',\n\t\t\t\t\tcategory: PolicyCategory.Extensions,\n\t\t\t\t\tminimumVersion: '1.0.0',\n\t\t\t\t\tlocalization: { description: { key: '', value: '' } },\n\t\t\t\t\tvalue: account => account.chat_preview_features_enabled === false ? 'policyValueB' : undefined,\n\t\t\t\t}\n\t\t\t},\n\t\t\t'setting.C': {\n\t\t\t\t'type': 'array',\n\t\t\t\t'default': ['defaultValueC1', 'defaultValueC2'],\n\t\t\t\tpolicy: {\n\t\t\t\t\tname: 'PolicySettingC',\n\t\t\t\t\tcategory: PolicyCategory.Extensions,\n\t\t\t\t\tminimumVersion: '1.0.0',\n\t\t\t\t\tlocalization: { description: { key: '', value: '' } },\n\t\t\t\t\tvalue: account => account.chat_preview_features_enabled === false ? JSON.stringify(['policyValueC1', 'policyValueC2']) : undefined,\n\t\t\t\t}\n\t\t\t},\n\t\t\t'setting.D': {\n\t\t\t\t'type': 'boolean',\n\t\t\t\t'default': true,\n\t\t\t\tpolicy: {\n\t\t\t\t\tname: 'PolicySettingD',\n\t\t\t\t\tcategory: PolicyCategory.Extensions,\n\t\t\t\t\tminimumVersion: '1.0.0',\n\t\t\t\t\tlocalization: { description: { key: '', value: '' } },\n\t\t\t\t\tvalue: account => account.chat_preview_features_enabled === false ? false : undefined,\n\t\t\t\t}\n\t\t\t},\n\t\t\t'setting.E': {\n\t\t\t\t'type': 'boolean',\n\t\t\t\t'default': true,\n\t\t\t}\n\t\t}\n\t};\n\n\n\tsuiteSetup(() => Registry.as<IConfigurationRegistry>(Extensions.Configuration).registerConfiguration(policyConfigurationNode));\n\tsuiteTeardown(() => Registry.as<IConfigurationRegistry>(Extensions.Configuration).deregisterConfigurations([policyConfigurationNode]));\n\n\tsetup(async () => {\n\t\tconst defaultConfiguration = disposables.add(new DefaultConfiguration(new NullLogService()));\n\t\tawait defaultConfiguration.initialize();\n\n\t\tdefaultAccountService = disposables.add(new DefaultAccountService());\n\t\tpolicyService = disposables.add(new AccountPolicyService(logService, defaultAccountService));\n\t\tpolicyConfiguration = disposables.add(new PolicyConfiguration(defaultConfiguration, policyService, new NullLogService()));\n\n\t});\n\n\tasync function assertDefaultBehavior(defaultAccount: IDefaultAccount) {\n\t\tdefaultAccountService.setDefaultAccount(defaultAccount);\n\n\t\tawait policyConfiguration.initialize();\n\n\t\t{\n\t\t\tconst A = policyService.getPolicyValue('PolicySettingA');\n\t\t\tconst B = policyService.getPolicyValue('PolicySettingB');\n\t\t\tconst C = policyService.getPolicyValue('PolicySettingC');\n\t\t\tconst D = policyService.getPolicyValue('PolicySettingD');\n\n\t\t\t// No policy is set\n\t\t\tassert.strictEqual(A, undefined);\n\t\t\tassert.strictEqual(B, undefined);\n\t\t\tassert.strictEqual(C, undefined);\n\t\t\tassert.strictEqual(D, undefined);\n\t\t}\n\n\t\t{\n\t\t\tconst B = policyConfiguration.configurationModel.getValue('setting.B');\n\t\t\tconst C = policyConfiguration.configurationModel.getValue('setting.C');\n\t\t\tconst D = policyConfiguration.configurationModel.getValue('setting.D');\n\n\t\t\tassert.strictEqual(B, undefined);\n\t\t\tassert.deepStrictEqual(C, undefined);\n\t\t\tassert.strictEqual(D, undefined);\n\t\t}\n\t}\n\n\n\ttest('should initialize with default account', async () => {\n\t\tconst defaultAccount = { ...BASE_DEFAULT_ACCOUNT };\n\t\tawait assertDefaultBehavior(defaultAccount);\n\t});\n\n\ttest('should initialize with default account and preview features enabled', async () => {\n\t\tconst defaultAccount = { ...BASE_DEFAULT_ACCOUNT, chat_preview_features_enabled: true };\n\t\tawait assertDefaultBehavior(defaultAccount);\n\t});\n\n\ttest('should initialize with default account and preview features disabled', async () => {\n\t\tconst defaultAccount = { ...BASE_DEFAULT_ACCOUNT, chat_preview_features_enabled: false };\n\t\tdefaultAccountService.setDefaultAccount(defaultAccount);\n\n\t\tawait policyConfiguration.initialize();\n\t\tconst actualConfigurationModel = policyConfiguration.configurationModel;\n\n\t\t{\n\t\t\tconst A = policyService.getPolicyValue('PolicySettingA');\n\t\t\tconst B = policyService.getPolicyValue('PolicySettingB');\n\t\t\tconst C = policyService.getPolicyValue('PolicySettingC');\n\t\t\tconst D = policyService.getPolicyValue('PolicySettingD');\n\n\t\t\tassert.strictEqual(A, undefined); // Not tagged with chat preview tags\n\t\t\tassert.strictEqual(B, 'policyValueB');\n\t\t\tassert.strictEqual(C, JSON.stringify(['policyValueC1', 'policyValueC2']));\n\t\t\tassert.strictEqual(D, false);\n\t\t}\n\n\t\t{\n\t\t\tconst B = actualConfigurationModel.getValue('setting.B');\n\t\t\tconst C = actualConfigurationModel.getValue('setting.C');\n\t\t\tconst D = actualConfigurationModel.getValue('setting.D');\n\n\t\t\tassert.strictEqual(B, 'policyValueB');\n\t\t\tassert.deepStrictEqual(C, ['policyValueC1', 'policyValueC2']);\n\t\t\tassert.strictEqual(D, false);\n\t\t}\n\t});\n});\n"]}