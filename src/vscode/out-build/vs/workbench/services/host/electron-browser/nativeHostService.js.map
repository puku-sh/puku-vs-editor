{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/services/host/electron-browser/nativeHostService.ts","vs/workbench/services/host/electron-browser/nativeHostService.ts"],"names":[],"mappings":"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","file":"nativeHostService.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Emitter, Event } from '../../../../base/common/event.js';\nimport { IHostService } from '../browser/host.js';\nimport { FocusMode, INativeHostService } from '../../../../platform/native/common/native.js';\nimport { InstantiationType, registerSingleton } from '../../../../platform/instantiation/common/extensions.js';\nimport { ILabelService, Verbosity } from '../../../../platform/label/common/label.js';\nimport { IWorkbenchEnvironmentService } from '../../environment/common/environmentService.js';\nimport { IWindowOpenable, IOpenWindowOptions, isFolderToOpen, isWorkspaceToOpen, IOpenEmptyWindowOptions, IPoint, IRectangle, IOpenedAuxiliaryWindow, IOpenedMainWindow } from '../../../../platform/window/common/window.js';\nimport { Disposable } from '../../../../base/common/lifecycle.js';\nimport { NativeHostService } from '../../../../platform/native/common/nativeHostService.js';\nimport { INativeWorkbenchEnvironmentService } from '../../environment/electron-browser/environmentService.js';\nimport { IMainProcessService } from '../../../../platform/ipc/common/mainProcessService.js';\nimport { disposableWindowInterval, getActiveDocument, getWindowId, getWindowsCount, hasWindow, onDidRegisterWindow } from '../../../../base/browser/dom.js';\nimport { memoize } from '../../../../base/common/decorators.js';\nimport { isAuxiliaryWindow } from '../../../../base/browser/window.js';\nimport { VSBuffer } from '../../../../base/common/buffer.js';\n\nclass WorkbenchNativeHostService extends NativeHostService {\n\n\tconstructor(\n\t\t@INativeWorkbenchEnvironmentService environmentService: INativeWorkbenchEnvironmentService,\n\t\t@IMainProcessService mainProcessService: IMainProcessService\n\t) {\n\t\tsuper(environmentService.window.id, mainProcessService);\n\t}\n}\n\nclass WorkbenchHostService extends Disposable implements IHostService {\n\n\tdeclare readonly _serviceBrand: undefined;\n\n\tconstructor(\n\t\t@INativeHostService private readonly nativeHostService: INativeHostService,\n\t\t@ILabelService private readonly labelService: ILabelService,\n\t\t@IWorkbenchEnvironmentService private readonly environmentService: IWorkbenchEnvironmentService\n\t) {\n\t\tsuper();\n\n\t\tthis.onDidChangeFocus = Event.latch(\n\t\t\tEvent.any(\n\t\t\t\tEvent.map(Event.filter(this.nativeHostService.onDidFocusMainOrAuxiliaryWindow, id => hasWindow(id), this._store), () => this.hasFocus, this._store),\n\t\t\t\tEvent.map(Event.filter(this.nativeHostService.onDidBlurMainOrAuxiliaryWindow, id => hasWindow(id), this._store), () => this.hasFocus, this._store),\n\t\t\t\tEvent.map(this.onDidChangeActiveWindow, () => this.hasFocus, this._store)\n\t\t\t), undefined, this._store\n\t\t);\n\n\t\tthis.onDidChangeFullScreen = Event.filter(this.nativeHostService.onDidChangeWindowFullScreen, e => hasWindow(e.windowId), this._store);\n\t}\n\n\t//#region Focus\n\n\treadonly onDidChangeFocus: Event<boolean>;\n\n\tget hasFocus(): boolean {\n\t\treturn getActiveDocument().hasFocus();\n\t}\n\n\tasync hadLastFocus(): Promise<boolean> {\n\t\tconst activeWindowId = await this.nativeHostService.getActiveWindowId();\n\n\t\tif (typeof activeWindowId === 'undefined') {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn activeWindowId === this.nativeHostService.windowId;\n\t}\n\n\t//#endregion\n\n\t//#region Window\n\n\t@memoize\n\tget onDidChangeActiveWindow(): Event<number> {\n\t\tconst emitter = this._register(new Emitter<number>());\n\n\t\t// Emit via native focus tracking\n\t\tthis._register(Event.filter(this.nativeHostService.onDidFocusMainOrAuxiliaryWindow, id => hasWindow(id), this._store)(id => emitter.fire(id)));\n\n\t\tthis._register(onDidRegisterWindow(({ window, disposables }) => {\n\n\t\t\t// Emit via interval: immediately when opening an auxiliary window,\n\t\t\t// it is possible that document focus has not yet changed, so we\n\t\t\t// poll for a while to ensure we catch the event.\n\t\t\tdisposables.add(disposableWindowInterval(window, () => {\n\t\t\t\tconst hasFocus = window.document.hasFocus();\n\t\t\t\tif (hasFocus) {\n\t\t\t\t\temitter.fire(window.vscodeWindowId);\n\t\t\t\t}\n\n\t\t\t\treturn hasFocus;\n\t\t\t}, 100, 20));\n\t\t}));\n\n\t\treturn Event.latch(emitter.event, undefined, this._store);\n\t}\n\n\treadonly onDidChangeFullScreen: Event<{ readonly windowId: number; readonly fullscreen: boolean }>;\n\n\topenWindow(options?: IOpenEmptyWindowOptions): Promise<void>;\n\topenWindow(toOpen: IWindowOpenable[], options?: IOpenWindowOptions): Promise<void>;\n\topenWindow(arg1?: IOpenEmptyWindowOptions | IWindowOpenable[], arg2?: IOpenWindowOptions): Promise<void> {\n\t\tif (Array.isArray(arg1)) {\n\t\t\treturn this.doOpenWindow(arg1, arg2);\n\t\t}\n\n\t\treturn this.doOpenEmptyWindow(arg1);\n\t}\n\n\tprivate doOpenWindow(toOpen: IWindowOpenable[], options?: IOpenWindowOptions): Promise<void> {\n\t\tconst remoteAuthority = this.environmentService.remoteAuthority;\n\t\tif (remoteAuthority) {\n\t\t\ttoOpen.forEach(openable => openable.label = openable.label || this.getRecentLabel(openable));\n\n\t\t\tif (options?.remoteAuthority === undefined) {\n\t\t\t\t// set the remoteAuthority of the window the request came from.\n\t\t\t\t// It will be used when the input is neither file nor vscode-remote.\n\t\t\t\toptions = options ? { ...options, remoteAuthority } : { remoteAuthority };\n\t\t\t}\n\t\t}\n\n\t\treturn this.nativeHostService.openWindow(toOpen, options);\n\t}\n\n\tprivate getRecentLabel(openable: IWindowOpenable): string {\n\t\tif (isFolderToOpen(openable)) {\n\t\t\treturn this.labelService.getWorkspaceLabel(openable.folderUri, { verbose: Verbosity.LONG });\n\t\t}\n\n\t\tif (isWorkspaceToOpen(openable)) {\n\t\t\treturn this.labelService.getWorkspaceLabel({ id: '', configPath: openable.workspaceUri }, { verbose: Verbosity.LONG });\n\t\t}\n\n\t\treturn this.labelService.getUriLabel(openable.fileUri, { appendWorkspaceSuffix: true });\n\t}\n\n\tprivate doOpenEmptyWindow(options?: IOpenEmptyWindowOptions): Promise<void> {\n\t\tconst remoteAuthority = this.environmentService.remoteAuthority;\n\t\tif (!!remoteAuthority && options?.remoteAuthority === undefined) {\n\t\t\t// set the remoteAuthority of the window the request came from\n\t\t\toptions = options ? { ...options, remoteAuthority } : { remoteAuthority };\n\t\t}\n\t\treturn this.nativeHostService.openWindow(options);\n\t}\n\n\ttoggleFullScreen(targetWindow: Window): Promise<void> {\n\t\treturn this.nativeHostService.toggleFullScreen({ targetWindowId: isAuxiliaryWindow(targetWindow) ? targetWindow.vscodeWindowId : undefined });\n\t}\n\n\tasync moveTop(targetWindow: Window): Promise<void> {\n\t\tif (getWindowsCount() <= 1) {\n\t\t\treturn; // does not apply when only one window is opened\n\t\t}\n\n\t\treturn this.nativeHostService.moveWindowTop(isAuxiliaryWindow(targetWindow) ? { targetWindowId: targetWindow.vscodeWindowId } : undefined);\n\t}\n\n\tgetCursorScreenPoint(): Promise<{ readonly point: IPoint; readonly display: IRectangle }> {\n\t\treturn this.nativeHostService.getCursorScreenPoint();\n\t}\n\n\tgetWindows(options: { includeAuxiliaryWindows: true }): Promise<Array<IOpenedMainWindow | IOpenedAuxiliaryWindow>>;\n\tgetWindows(options: { includeAuxiliaryWindows: false }): Promise<Array<IOpenedMainWindow>>;\n\tgetWindows(options: { includeAuxiliaryWindows: boolean }): Promise<Array<IOpenedMainWindow | IOpenedAuxiliaryWindow>> {\n\t\tif (options.includeAuxiliaryWindows === false) {\n\t\t\treturn this.nativeHostService.getWindows({ includeAuxiliaryWindows: false });\n\t\t}\n\n\t\treturn this.nativeHostService.getWindows({ includeAuxiliaryWindows: true });\n\t}\n\n\t//#endregion\n\n\t//#region Lifecycle\n\n\tfocus(targetWindow: Window, options?: { mode?: FocusMode }): Promise<void> {\n\t\treturn this.nativeHostService.focusWindow({\n\t\t\tmode: options?.mode,\n\t\t\ttargetWindowId: getWindowId(targetWindow)\n\t\t});\n\t}\n\n\trestart(): Promise<void> {\n\t\treturn this.nativeHostService.relaunch();\n\t}\n\n\treload(options?: { disableExtensions?: boolean }): Promise<void> {\n\t\treturn this.nativeHostService.reload(options);\n\t}\n\n\tclose(): Promise<void> {\n\t\treturn this.nativeHostService.closeWindow();\n\t}\n\n\tasync withExpectedShutdown<T>(expectedShutdownTask: () => Promise<T>): Promise<T> {\n\t\treturn await expectedShutdownTask();\n\t}\n\n\t//#endregion\n\n\t//#region Screenshots\n\n\tgetScreenshot(rect?: IRectangle): Promise<VSBuffer | undefined> {\n\t\treturn this.nativeHostService.getScreenshot(rect);\n\t}\n\n\t//#endregion\n\n\t//#region Native Handle\n\n\tprivate _nativeWindowHandleCache = new Map<number, Promise<VSBuffer | undefined>>();\n\tasync getNativeWindowHandle(windowId: number): Promise<VSBuffer | undefined> {\n\t\tif (!this._nativeWindowHandleCache.has(windowId)) {\n\t\t\tthis._nativeWindowHandleCache.set(windowId, this.nativeHostService.getNativeWindowHandle(windowId));\n\t\t}\n\t\treturn this._nativeWindowHandleCache.get(windowId)!;\n\t}\n\n\t//#endregion\n}\n\nregisterSingleton(IHostService, WorkbenchHostService, InstantiationType.Delayed);\nregisterSingleton(INativeHostService, WorkbenchNativeHostService, InstantiationType.Delayed);\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Emitter, Event } from '../../../../base/common/event.js';\nimport { IHostService } from '../browser/host.js';\nimport { FocusMode, INativeHostService } from '../../../../platform/native/common/native.js';\nimport { InstantiationType, registerSingleton } from '../../../../platform/instantiation/common/extensions.js';\nimport { ILabelService, Verbosity } from '../../../../platform/label/common/label.js';\nimport { IWorkbenchEnvironmentService } from '../../environment/common/environmentService.js';\nimport { IWindowOpenable, IOpenWindowOptions, isFolderToOpen, isWorkspaceToOpen, IOpenEmptyWindowOptions, IPoint, IRectangle, IOpenedAuxiliaryWindow, IOpenedMainWindow } from '../../../../platform/window/common/window.js';\nimport { Disposable } from '../../../../base/common/lifecycle.js';\nimport { NativeHostService } from '../../../../platform/native/common/nativeHostService.js';\nimport { INativeWorkbenchEnvironmentService } from '../../environment/electron-browser/environmentService.js';\nimport { IMainProcessService } from '../../../../platform/ipc/common/mainProcessService.js';\nimport { disposableWindowInterval, getActiveDocument, getWindowId, getWindowsCount, hasWindow, onDidRegisterWindow } from '../../../../base/browser/dom.js';\nimport { memoize } from '../../../../base/common/decorators.js';\nimport { isAuxiliaryWindow } from '../../../../base/browser/window.js';\nimport { VSBuffer } from '../../../../base/common/buffer.js';\n\nclass WorkbenchNativeHostService extends NativeHostService {\n\n\tconstructor(\n\t\t@INativeWorkbenchEnvironmentService environmentService: INativeWorkbenchEnvironmentService,\n\t\t@IMainProcessService mainProcessService: IMainProcessService\n\t) {\n\t\tsuper(environmentService.window.id, mainProcessService);\n\t}\n}\n\nclass WorkbenchHostService extends Disposable implements IHostService {\n\n\tdeclare readonly _serviceBrand: undefined;\n\n\tconstructor(\n\t\t@INativeHostService private readonly nativeHostService: INativeHostService,\n\t\t@ILabelService private readonly labelService: ILabelService,\n\t\t@IWorkbenchEnvironmentService private readonly environmentService: IWorkbenchEnvironmentService\n\t) {\n\t\tsuper();\n\n\t\tthis.onDidChangeFocus = Event.latch(\n\t\t\tEvent.any(\n\t\t\t\tEvent.map(Event.filter(this.nativeHostService.onDidFocusMainOrAuxiliaryWindow, id => hasWindow(id), this._store), () => this.hasFocus, this._store),\n\t\t\t\tEvent.map(Event.filter(this.nativeHostService.onDidBlurMainOrAuxiliaryWindow, id => hasWindow(id), this._store), () => this.hasFocus, this._store),\n\t\t\t\tEvent.map(this.onDidChangeActiveWindow, () => this.hasFocus, this._store)\n\t\t\t), undefined, this._store\n\t\t);\n\n\t\tthis.onDidChangeFullScreen = Event.filter(this.nativeHostService.onDidChangeWindowFullScreen, e => hasWindow(e.windowId), this._store);\n\t}\n\n\t//#region Focus\n\n\treadonly onDidChangeFocus: Event<boolean>;\n\n\tget hasFocus(): boolean {\n\t\treturn getActiveDocument().hasFocus();\n\t}\n\n\tasync hadLastFocus(): Promise<boolean> {\n\t\tconst activeWindowId = await this.nativeHostService.getActiveWindowId();\n\n\t\tif (typeof activeWindowId === 'undefined') {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn activeWindowId === this.nativeHostService.windowId;\n\t}\n\n\t//#endregion\n\n\t//#region Window\n\n\t@memoize\n\tget onDidChangeActiveWindow(): Event<number> {\n\t\tconst emitter = this._register(new Emitter<number>());\n\n\t\t// Emit via native focus tracking\n\t\tthis._register(Event.filter(this.nativeHostService.onDidFocusMainOrAuxiliaryWindow, id => hasWindow(id), this._store)(id => emitter.fire(id)));\n\n\t\tthis._register(onDidRegisterWindow(({ window, disposables }) => {\n\n\t\t\t// Emit via interval: immediately when opening an auxiliary window,\n\t\t\t// it is possible that document focus has not yet changed, so we\n\t\t\t// poll for a while to ensure we catch the event.\n\t\t\tdisposables.add(disposableWindowInterval(window, () => {\n\t\t\t\tconst hasFocus = window.document.hasFocus();\n\t\t\t\tif (hasFocus) {\n\t\t\t\t\temitter.fire(window.vscodeWindowId);\n\t\t\t\t}\n\n\t\t\t\treturn hasFocus;\n\t\t\t}, 100, 20));\n\t\t}));\n\n\t\treturn Event.latch(emitter.event, undefined, this._store);\n\t}\n\n\treadonly onDidChangeFullScreen: Event<{ readonly windowId: number; readonly fullscreen: boolean }>;\n\n\topenWindow(options?: IOpenEmptyWindowOptions): Promise<void>;\n\topenWindow(toOpen: IWindowOpenable[], options?: IOpenWindowOptions): Promise<void>;\n\topenWindow(arg1?: IOpenEmptyWindowOptions | IWindowOpenable[], arg2?: IOpenWindowOptions): Promise<void> {\n\t\tif (Array.isArray(arg1)) {\n\t\t\treturn this.doOpenWindow(arg1, arg2);\n\t\t}\n\n\t\treturn this.doOpenEmptyWindow(arg1);\n\t}\n\n\tprivate doOpenWindow(toOpen: IWindowOpenable[], options?: IOpenWindowOptions): Promise<void> {\n\t\tconst remoteAuthority = this.environmentService.remoteAuthority;\n\t\tif (remoteAuthority) {\n\t\t\ttoOpen.forEach(openable => openable.label = openable.label || this.getRecentLabel(openable));\n\n\t\t\tif (options?.remoteAuthority === undefined) {\n\t\t\t\t// set the remoteAuthority of the window the request came from.\n\t\t\t\t// It will be used when the input is neither file nor vscode-remote.\n\t\t\t\toptions = options ? { ...options, remoteAuthority } : { remoteAuthority };\n\t\t\t}\n\t\t}\n\n\t\treturn this.nativeHostService.openWindow(toOpen, options);\n\t}\n\n\tprivate getRecentLabel(openable: IWindowOpenable): string {\n\t\tif (isFolderToOpen(openable)) {\n\t\t\treturn this.labelService.getWorkspaceLabel(openable.folderUri, { verbose: Verbosity.LONG });\n\t\t}\n\n\t\tif (isWorkspaceToOpen(openable)) {\n\t\t\treturn this.labelService.getWorkspaceLabel({ id: '', configPath: openable.workspaceUri }, { verbose: Verbosity.LONG });\n\t\t}\n\n\t\treturn this.labelService.getUriLabel(openable.fileUri, { appendWorkspaceSuffix: true });\n\t}\n\n\tprivate doOpenEmptyWindow(options?: IOpenEmptyWindowOptions): Promise<void> {\n\t\tconst remoteAuthority = this.environmentService.remoteAuthority;\n\t\tif (!!remoteAuthority && options?.remoteAuthority === undefined) {\n\t\t\t// set the remoteAuthority of the window the request came from\n\t\t\toptions = options ? { ...options, remoteAuthority } : { remoteAuthority };\n\t\t}\n\t\treturn this.nativeHostService.openWindow(options);\n\t}\n\n\ttoggleFullScreen(targetWindow: Window): Promise<void> {\n\t\treturn this.nativeHostService.toggleFullScreen({ targetWindowId: isAuxiliaryWindow(targetWindow) ? targetWindow.vscodeWindowId : undefined });\n\t}\n\n\tasync moveTop(targetWindow: Window): Promise<void> {\n\t\tif (getWindowsCount() <= 1) {\n\t\t\treturn; // does not apply when only one window is opened\n\t\t}\n\n\t\treturn this.nativeHostService.moveWindowTop(isAuxiliaryWindow(targetWindow) ? { targetWindowId: targetWindow.vscodeWindowId } : undefined);\n\t}\n\n\tgetCursorScreenPoint(): Promise<{ readonly point: IPoint; readonly display: IRectangle }> {\n\t\treturn this.nativeHostService.getCursorScreenPoint();\n\t}\n\n\tgetWindows(options: { includeAuxiliaryWindows: true }): Promise<Array<IOpenedMainWindow | IOpenedAuxiliaryWindow>>;\n\tgetWindows(options: { includeAuxiliaryWindows: false }): Promise<Array<IOpenedMainWindow>>;\n\tgetWindows(options: { includeAuxiliaryWindows: boolean }): Promise<Array<IOpenedMainWindow | IOpenedAuxiliaryWindow>> {\n\t\tif (options.includeAuxiliaryWindows === false) {\n\t\t\treturn this.nativeHostService.getWindows({ includeAuxiliaryWindows: false });\n\t\t}\n\n\t\treturn this.nativeHostService.getWindows({ includeAuxiliaryWindows: true });\n\t}\n\n\t//#endregion\n\n\t//#region Lifecycle\n\n\tfocus(targetWindow: Window, options?: { mode?: FocusMode }): Promise<void> {\n\t\treturn this.nativeHostService.focusWindow({\n\t\t\tmode: options?.mode,\n\t\t\ttargetWindowId: getWindowId(targetWindow)\n\t\t});\n\t}\n\n\trestart(): Promise<void> {\n\t\treturn this.nativeHostService.relaunch();\n\t}\n\n\treload(options?: { disableExtensions?: boolean }): Promise<void> {\n\t\treturn this.nativeHostService.reload(options);\n\t}\n\n\tclose(): Promise<void> {\n\t\treturn this.nativeHostService.closeWindow();\n\t}\n\n\tasync withExpectedShutdown<T>(expectedShutdownTask: () => Promise<T>): Promise<T> {\n\t\treturn await expectedShutdownTask();\n\t}\n\n\t//#endregion\n\n\t//#region Screenshots\n\n\tgetScreenshot(rect?: IRectangle): Promise<VSBuffer | undefined> {\n\t\treturn this.nativeHostService.getScreenshot(rect);\n\t}\n\n\t//#endregion\n\n\t//#region Native Handle\n\n\tprivate _nativeWindowHandleCache = new Map<number, Promise<VSBuffer | undefined>>();\n\tasync getNativeWindowHandle(windowId: number): Promise<VSBuffer | undefined> {\n\t\tif (!this._nativeWindowHandleCache.has(windowId)) {\n\t\t\tthis._nativeWindowHandleCache.set(windowId, this.nativeHostService.getNativeWindowHandle(windowId));\n\t\t}\n\t\treturn this._nativeWindowHandleCache.get(windowId)!;\n\t}\n\n\t//#endregion\n}\n\nregisterSingleton(IHostService, WorkbenchHostService, InstantiationType.Delayed);\nregisterSingleton(INativeHostService, WorkbenchNativeHostService, InstantiationType.Delayed);\n"]}