{"version":3,"sources":["vs/workbench/services/extensions/common/extensionsProposedApi.ts"],"names":[],"mappings":"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","file":"extensionsProposedApi.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { isNonEmptyArray } from '../../../../base/common/arrays.js';\nimport { localize } from '../../../../nls.js';\nimport { Disposable } from '../../../../base/common/lifecycle.js';\nimport { ExtensionIdentifier, IExtensionDescription, IExtensionManifest } from '../../../../platform/extensions/common/extensions.js';\nimport { allApiProposals, ApiProposalName } from '../../../../platform/extensions/common/extensionsApiProposals.js';\nimport { SyncDescriptor } from '../../../../platform/instantiation/common/descriptors.js';\nimport { ILogService } from '../../../../platform/log/common/log.js';\nimport { IProductService } from '../../../../platform/product/common/productService.js';\nimport { Registry } from '../../../../platform/registry/common/platform.js';\nimport { IWorkbenchEnvironmentService } from '../../environment/common/environmentService.js';\nimport { Extensions, IExtensionFeatureMarkdownRenderer, IExtensionFeaturesRegistry, IRenderedData } from '../../extensionManagement/common/extensionFeatures.js';\nimport { IMarkdownString, MarkdownString } from '../../../../base/common/htmlContent.js';\nimport { Mutable } from '../../../../base/common/types.js';\n\nexport class ExtensionsProposedApi {\n\n\tprivate readonly _envEnablesProposedApiForAll: boolean;\n\tprivate readonly _envEnabledExtensions: Set<string>;\n\tprivate readonly _productEnabledExtensions: Map<string, string[]>;\n\n\tconstructor(\n\t\t@ILogService private readonly _logService: ILogService,\n\t\t@IWorkbenchEnvironmentService private readonly _environmentService: IWorkbenchEnvironmentService,\n\t\t@IProductService productService: IProductService\n\t) {\n\n\t\tthis._envEnabledExtensions = new Set((_environmentService.extensionEnabledProposedApi ?? []).map(id => ExtensionIdentifier.toKey(id)));\n\n\t\tthis._envEnablesProposedApiForAll =\n\t\t\t!_environmentService.isBuilt || // always allow proposed API when running out of sources\n\t\t\t(_environmentService.isExtensionDevelopment && productService.quality !== 'stable') || // do not allow proposed API against stable builds when developing an extension\n\t\t\t(this._envEnabledExtensions.size === 0 && Array.isArray(_environmentService.extensionEnabledProposedApi)); // always allow proposed API if --enable-proposed-api is provided without extension ID\n\n\t\tthis._productEnabledExtensions = new Map<string, ApiProposalName[]>();\n\n\n\t\t// NEW world - product.json spells out what proposals each extension can use\n\t\tif (productService.extensionEnabledApiProposals) {\n\t\t\tfor (const [k, value] of Object.entries(productService.extensionEnabledApiProposals)) {\n\t\t\t\tconst key = ExtensionIdentifier.toKey(k);\n\t\t\t\tconst proposalNames = value.filter(name => {\n\t\t\t\t\tif (!allApiProposals[<ApiProposalName>name]) {\n\t\t\t\t\t\t_logService.warn(`Via 'product.json#extensionEnabledApiProposals' extension '${key}' wants API proposal '${name}' but that proposal DOES NOT EXIST. Likely, the proposal has been finalized (check 'vscode.d.ts') or was abandoned.`);\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t\treturn true;\n\t\t\t\t});\n\t\t\t\tthis._productEnabledExtensions.set(key, proposalNames);\n\t\t\t}\n\t\t}\n\t}\n\n\tupdateEnabledApiProposals(extensions: IExtensionDescription[]): void {\n\t\tfor (const extension of extensions) {\n\t\t\tthis.doUpdateEnabledApiProposals(extension);\n\t\t}\n\t}\n\n\tprivate doUpdateEnabledApiProposals(extension: Mutable<IExtensionDescription>): void {\n\n\t\tconst key = ExtensionIdentifier.toKey(extension.identifier);\n\n\t\t// warn about invalid proposal and remove them from the list\n\t\tif (isNonEmptyArray(extension.enabledApiProposals)) {\n\t\t\textension.enabledApiProposals = extension.enabledApiProposals.filter(name => {\n\t\t\t\tconst result = Boolean(allApiProposals[<ApiProposalName>name]);\n\t\t\t\tif (!result) {\n\t\t\t\t\tthis._logService.error(`Extension '${key}' wants API proposal '${name}' but that proposal DOES NOT EXIST. Likely, the proposal has been finalized (check 'vscode.d.ts') or was abandoned.`);\n\t\t\t\t}\n\t\t\t\treturn result;\n\t\t\t});\n\t\t}\n\n\n\t\tif (this._productEnabledExtensions.has(key)) {\n\t\t\t// NOTE that proposals that are listed in product.json override whatever is declared in the extension\n\t\t\t// itself. This is needed for us to know what proposals are used \"in the wild\". Merging product.json-proposals\n\t\t\t// and extension-proposals would break that.\n\n\t\t\tconst productEnabledProposals = this._productEnabledExtensions.get(key)!;\n\n\t\t\t// check for difference between product.json-declaration and package.json-declaration\n\t\t\tconst productSet = new Set(productEnabledProposals);\n\t\t\tconst extensionSet = new Set(extension.enabledApiProposals);\n\t\t\tconst diff = new Set([...extensionSet].filter(a => !productSet.has(a)));\n\t\t\tif (diff.size > 0) {\n\t\t\t\tthis._logService.error(`Extension '${key}' appears in product.json but enables LESS API proposals than the extension wants.\\npackage.json (LOSES): ${[...extensionSet].join(', ')}\\nproduct.json (WINS): ${[...productSet].join(', ')}`);\n\n\t\t\t\tif (this._environmentService.isExtensionDevelopment) {\n\t\t\t\t\tthis._logService.error(`Proceeding with EXTRA proposals (${[...diff].join(', ')}) because extension is in development mode. Still, this EXTENSION WILL BE BROKEN unless product.json is updated.`);\n\t\t\t\t\tproductEnabledProposals.push(...diff);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\textension.enabledApiProposals = productEnabledProposals;\n\t\t\treturn;\n\t\t}\n\n\t\tif (this._envEnablesProposedApiForAll || this._envEnabledExtensions.has(key)) {\n\t\t\t// proposed API usage is not restricted and allowed just like the extension\n\t\t\t// has declared it\n\t\t\treturn;\n\t\t}\n\n\t\tif (!extension.isBuiltin && isNonEmptyArray(extension.enabledApiProposals)) {\n\t\t\t// restrictive: extension cannot use proposed API in this context and its declaration is nulled\n\t\t\tthis._logService.error(`Extension '${extension.identifier.value} CANNOT USE these API proposals '${extension.enabledApiProposals?.join(', ') || '*'}'. You MUST start in extension development mode or use the --enable-proposed-api command line flag`);\n\t\t\textension.enabledApiProposals = [];\n\t\t}\n\t}\n}\n\nclass ApiProposalsMarkdowneRenderer extends Disposable implements IExtensionFeatureMarkdownRenderer {\n\n\treadonly type = 'markdown';\n\n\tshouldRender(manifest: IExtensionManifest): boolean {\n\t\treturn !!manifest.originalEnabledApiProposals?.length || !!manifest.enabledApiProposals?.length;\n\t}\n\n\trender(manifest: IExtensionManifest): IRenderedData<IMarkdownString> {\n\t\tconst enabledApiProposals = manifest.originalEnabledApiProposals ?? manifest.enabledApiProposals ?? [];\n\t\tconst data = new MarkdownString();\n\t\tif (enabledApiProposals.length) {\n\t\t\tfor (const proposal of enabledApiProposals) {\n\t\t\t\tdata.appendMarkdown(`- \\`${proposal}\\`\\n`);\n\t\t\t}\n\t\t}\n\t\treturn {\n\t\t\tdata,\n\t\t\tdispose: () => { }\n\t\t};\n\t}\n}\n\nRegistry.as<IExtensionFeaturesRegistry>(Extensions.ExtensionFeaturesRegistry).registerExtensionFeature({\n\tid: 'enabledApiProposals',\n\tlabel: localize('enabledProposedAPIs', \"API Proposals\"),\n\taccess: {\n\t\tcanToggle: false\n\t},\n\trenderer: new SyncDescriptor(ApiProposalsMarkdowneRenderer),\n});\n"]}