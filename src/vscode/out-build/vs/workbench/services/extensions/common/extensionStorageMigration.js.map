{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/services/extensions/common/extensionStorageMigration.ts","vs/workbench/services/extensions/common/extensionStorageMigration.ts"],"names":[],"mappings":"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","file":"extensionStorageMigration.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { getErrorMessage } from '../../../../base/common/errors.js';\nimport { URI } from '../../../../base/common/uri.js';\nimport { IEnvironmentService } from '../../../../platform/environment/common/environment.js';\nimport { IExtensionStorageService } from '../../../../platform/extensionManagement/common/extensionStorage.js';\nimport { FileSystemProviderError, FileSystemProviderErrorCode, IFileService } from '../../../../platform/files/common/files.js';\nimport { IInstantiationService } from '../../../../platform/instantiation/common/instantiation.js';\nimport { ILogService } from '../../../../platform/log/common/log.js';\nimport { IStorageService, StorageScope, StorageTarget } from '../../../../platform/storage/common/storage.js';\nimport { IUriIdentityService } from '../../../../platform/uriIdentity/common/uriIdentity.js';\nimport { IUserDataProfilesService } from '../../../../platform/userDataProfile/common/userDataProfile.js';\nimport { IWorkspaceContextService } from '../../../../platform/workspace/common/workspace.js';\n\n/**\n * An extension storage has following\n * \t- State: Stored using storage service with extension id as key and state as value.\n *  - Resources: Stored under a location scoped to the extension.\n */\nexport async function migrateExtensionStorage(fromExtensionId: string, toExtensionId: string, global: boolean, instantionService: IInstantiationService): Promise<void> {\n\treturn instantionService.invokeFunction(async serviceAccessor => {\n\t\tconst environmentService = serviceAccessor.get(IEnvironmentService);\n\t\tconst userDataProfilesService = serviceAccessor.get(IUserDataProfilesService);\n\t\tconst extensionStorageService = serviceAccessor.get(IExtensionStorageService);\n\t\tconst storageService = serviceAccessor.get(IStorageService);\n\t\tconst uriIdentityService = serviceAccessor.get(IUriIdentityService);\n\t\tconst fileService = serviceAccessor.get(IFileService);\n\t\tconst workspaceContextService = serviceAccessor.get(IWorkspaceContextService);\n\t\tconst logService = serviceAccessor.get(ILogService);\n\t\tconst storageMigratedKey = `extensionStorage.migrate.${fromExtensionId}-${toExtensionId}`;\n\t\tconst migrateLowerCaseStorageKey = fromExtensionId.toLowerCase() === toExtensionId.toLowerCase() ? `extension.storage.migrateFromLowerCaseKey.${fromExtensionId.toLowerCase()}` : undefined;\n\n\t\tif (fromExtensionId === toExtensionId) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst getExtensionStorageLocation = (extensionId: string, global: boolean): URI => {\n\t\t\tif (global) {\n\t\t\t\treturn uriIdentityService.extUri.joinPath(userDataProfilesService.defaultProfile.globalStorageHome, extensionId.toLowerCase() /* Extension id is lower cased for global storage */);\n\t\t\t}\n\t\t\treturn uriIdentityService.extUri.joinPath(environmentService.workspaceStorageHome, workspaceContextService.getWorkspace().id, extensionId);\n\t\t};\n\n\t\tconst storageScope = global ? StorageScope.PROFILE : StorageScope.WORKSPACE;\n\t\tif (!storageService.getBoolean(storageMigratedKey, storageScope, false) && !(migrateLowerCaseStorageKey && storageService.getBoolean(migrateLowerCaseStorageKey, storageScope, false))) {\n\t\t\tlogService.info(`Migrating ${global ? 'global' : 'workspace'} extension storage from ${fromExtensionId} to ${toExtensionId}...`);\n\t\t\t// Migrate state\n\t\t\tconst value = extensionStorageService.getExtensionState(fromExtensionId, global);\n\t\t\tif (value) {\n\t\t\t\textensionStorageService.setExtensionState(toExtensionId, value, global);\n\t\t\t\textensionStorageService.setExtensionState(fromExtensionId, undefined, global);\n\t\t\t}\n\n\t\t\t// Migrate stored files\n\t\t\tconst fromPath = getExtensionStorageLocation(fromExtensionId, global);\n\t\t\tconst toPath = getExtensionStorageLocation(toExtensionId, global);\n\t\t\tif (!uriIdentityService.extUri.isEqual(fromPath, toPath)) {\n\t\t\t\ttry {\n\t\t\t\t\tawait fileService.move(fromPath, toPath, true);\n\t\t\t\t} catch (error) {\n\t\t\t\t\tif ((<FileSystemProviderError>error).code !== FileSystemProviderErrorCode.FileNotFound) {\n\t\t\t\t\t\tlogService.info(`Error while migrating ${global ? 'global' : 'workspace'} file storage from '${fromExtensionId}' to '${toExtensionId}'`, getErrorMessage(error));\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tlogService.info(`Migrated ${global ? 'global' : 'workspace'} extension storage from ${fromExtensionId} to ${toExtensionId}`);\n\t\t\tstorageService.store(storageMigratedKey, true, storageScope, StorageTarget.MACHINE);\n\t\t}\n\t});\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { getErrorMessage } from '../../../../base/common/errors.js';\nimport { URI } from '../../../../base/common/uri.js';\nimport { IEnvironmentService } from '../../../../platform/environment/common/environment.js';\nimport { IExtensionStorageService } from '../../../../platform/extensionManagement/common/extensionStorage.js';\nimport { FileSystemProviderError, FileSystemProviderErrorCode, IFileService } from '../../../../platform/files/common/files.js';\nimport { IInstantiationService } from '../../../../platform/instantiation/common/instantiation.js';\nimport { ILogService } from '../../../../platform/log/common/log.js';\nimport { IStorageService, StorageScope, StorageTarget } from '../../../../platform/storage/common/storage.js';\nimport { IUriIdentityService } from '../../../../platform/uriIdentity/common/uriIdentity.js';\nimport { IUserDataProfilesService } from '../../../../platform/userDataProfile/common/userDataProfile.js';\nimport { IWorkspaceContextService } from '../../../../platform/workspace/common/workspace.js';\n\n/**\n * An extension storage has following\n * \t- State: Stored using storage service with extension id as key and state as value.\n *  - Resources: Stored under a location scoped to the extension.\n */\nexport async function migrateExtensionStorage(fromExtensionId: string, toExtensionId: string, global: boolean, instantionService: IInstantiationService): Promise<void> {\n\treturn instantionService.invokeFunction(async serviceAccessor => {\n\t\tconst environmentService = serviceAccessor.get(IEnvironmentService);\n\t\tconst userDataProfilesService = serviceAccessor.get(IUserDataProfilesService);\n\t\tconst extensionStorageService = serviceAccessor.get(IExtensionStorageService);\n\t\tconst storageService = serviceAccessor.get(IStorageService);\n\t\tconst uriIdentityService = serviceAccessor.get(IUriIdentityService);\n\t\tconst fileService = serviceAccessor.get(IFileService);\n\t\tconst workspaceContextService = serviceAccessor.get(IWorkspaceContextService);\n\t\tconst logService = serviceAccessor.get(ILogService);\n\t\tconst storageMigratedKey = `extensionStorage.migrate.${fromExtensionId}-${toExtensionId}`;\n\t\tconst migrateLowerCaseStorageKey = fromExtensionId.toLowerCase() === toExtensionId.toLowerCase() ? `extension.storage.migrateFromLowerCaseKey.${fromExtensionId.toLowerCase()}` : undefined;\n\n\t\tif (fromExtensionId === toExtensionId) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst getExtensionStorageLocation = (extensionId: string, global: boolean): URI => {\n\t\t\tif (global) {\n\t\t\t\treturn uriIdentityService.extUri.joinPath(userDataProfilesService.defaultProfile.globalStorageHome, extensionId.toLowerCase() /* Extension id is lower cased for global storage */);\n\t\t\t}\n\t\t\treturn uriIdentityService.extUri.joinPath(environmentService.workspaceStorageHome, workspaceContextService.getWorkspace().id, extensionId);\n\t\t};\n\n\t\tconst storageScope = global ? StorageScope.PROFILE : StorageScope.WORKSPACE;\n\t\tif (!storageService.getBoolean(storageMigratedKey, storageScope, false) && !(migrateLowerCaseStorageKey && storageService.getBoolean(migrateLowerCaseStorageKey, storageScope, false))) {\n\t\t\tlogService.info(`Migrating ${global ? 'global' : 'workspace'} extension storage from ${fromExtensionId} to ${toExtensionId}...`);\n\t\t\t// Migrate state\n\t\t\tconst value = extensionStorageService.getExtensionState(fromExtensionId, global);\n\t\t\tif (value) {\n\t\t\t\textensionStorageService.setExtensionState(toExtensionId, value, global);\n\t\t\t\textensionStorageService.setExtensionState(fromExtensionId, undefined, global);\n\t\t\t}\n\n\t\t\t// Migrate stored files\n\t\t\tconst fromPath = getExtensionStorageLocation(fromExtensionId, global);\n\t\t\tconst toPath = getExtensionStorageLocation(toExtensionId, global);\n\t\t\tif (!uriIdentityService.extUri.isEqual(fromPath, toPath)) {\n\t\t\t\ttry {\n\t\t\t\t\tawait fileService.move(fromPath, toPath, true);\n\t\t\t\t} catch (error) {\n\t\t\t\t\tif ((<FileSystemProviderError>error).code !== FileSystemProviderErrorCode.FileNotFound) {\n\t\t\t\t\t\tlogService.info(`Error while migrating ${global ? 'global' : 'workspace'} file storage from '${fromExtensionId}' to '${toExtensionId}'`, getErrorMessage(error));\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tlogService.info(`Migrated ${global ? 'global' : 'workspace'} extension storage from ${fromExtensionId} to ${toExtensionId}`);\n\t\t\tstorageService.store(storageMigratedKey, true, storageScope, StorageTarget.MACHINE);\n\t\t}\n\t});\n}\n"]}