{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/services/extensions/common/lazyCreateExtensionHostManager.ts","vs/workbench/services/extensions/common/lazyCreateExtensionHostManager.ts"],"names":[],"mappings":"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","file":"lazyCreateExtensionHostManager.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Barrier } from '../../../../base/common/async.js';\nimport { Emitter, Event } from '../../../../base/common/event.js';\nimport { Disposable } from '../../../../base/common/lifecycle.js';\nimport { URI } from '../../../../base/common/uri.js';\nimport { ExtensionIdentifier, IExtensionDescription } from '../../../../platform/extensions/common/extensions.js';\nimport { IInstantiationService } from '../../../../platform/instantiation/common/instantiation.js';\nimport { ILogService } from '../../../../platform/log/common/log.js';\nimport { RemoteAuthorityResolverErrorCode } from '../../../../platform/remote/common/remoteAuthorityResolver.js';\nimport { ExtensionHostKind } from './extensionHostKind.js';\nimport { ExtensionHostManager, friendlyExtHostName } from './extensionHostManager.js';\nimport { IExtensionHostManager } from './extensionHostManagers.js';\nimport { IExtensionDescriptionDelta } from './extensionHostProtocol.js';\nimport { IResolveAuthorityResult } from './extensionHostProxy.js';\nimport { ExtensionRunningLocation } from './extensionRunningLocation.js';\nimport { ActivationKind, ExtensionActivationReason, ExtensionHostStartup, IExtensionHost, IExtensionInspectInfo, IInternalExtensionService } from './extensions.js';\nimport { ResponsiveState } from './rpcProtocol.js';\n\n/**\n * Waits until `start()` and only if it has extensions proceeds to really start.\n */\nexport class LazyCreateExtensionHostManager extends Disposable implements IExtensionHostManager {\n\n\tpublic readonly onDidExit: Event<[number, string | null]>;\n\tprivate readonly _onDidChangeResponsiveState: Emitter<ResponsiveState> = this._register(new Emitter<ResponsiveState>());\n\tpublic readonly onDidChangeResponsiveState: Event<ResponsiveState> = this._onDidChangeResponsiveState.event;\n\n\tprivate readonly _extensionHost: IExtensionHost;\n\tprivate _startCalled: Barrier;\n\tprivate _actual: ExtensionHostManager | null;\n\n\tpublic get pid(): number | null {\n\t\tif (this._actual) {\n\t\t\treturn this._actual.pid;\n\t\t}\n\t\treturn null;\n\t}\n\n\tpublic get kind(): ExtensionHostKind {\n\t\treturn this._extensionHost.runningLocation.kind;\n\t}\n\n\tpublic get startup(): ExtensionHostStartup {\n\t\treturn this._extensionHost.startup;\n\t}\n\n\tpublic get friendyName(): string {\n\t\treturn friendlyExtHostName(this.kind, this.pid);\n\t}\n\n\tconstructor(\n\t\textensionHost: IExtensionHost,\n\t\tprivate readonly _initialActivationEvents: string[],\n\t\tprivate readonly _internalExtensionService: IInternalExtensionService,\n\t\t@IInstantiationService private readonly _instantiationService: IInstantiationService,\n\t\t@ILogService private readonly _logService: ILogService\n\t) {\n\t\tsuper();\n\t\tthis._extensionHost = extensionHost;\n\t\tthis.onDidExit = extensionHost.onExit;\n\t\tthis._startCalled = new Barrier();\n\t\tthis._actual = null;\n\t}\n\n\toverride dispose(): void {\n\t\tif (!this._actual) {\n\t\t\tthis._extensionHost.dispose();\n\t\t}\n\t\tsuper.dispose();\n\t}\n\n\tprivate _createActual(reason: string): ExtensionHostManager {\n\t\tthis._logService.info(`Creating lazy extension host (${this.friendyName}). Reason: ${reason}`);\n\t\tthis._actual = this._register(this._instantiationService.createInstance(ExtensionHostManager, this._extensionHost, this._initialActivationEvents, this._internalExtensionService));\n\t\tthis._register(this._actual.onDidChangeResponsiveState((e) => this._onDidChangeResponsiveState.fire(e)));\n\t\treturn this._actual;\n\t}\n\n\tprivate async _getOrCreateActualAndStart(reason: string): Promise<ExtensionHostManager> {\n\t\tif (this._actual) {\n\t\t\t// already created/started\n\t\t\treturn this._actual;\n\t\t}\n\t\tconst actual = this._createActual(reason);\n\t\tawait actual.ready();\n\t\treturn actual;\n\t}\n\n\tpublic async ready(): Promise<void> {\n\t\tawait this._startCalled.wait();\n\t\tif (this._actual) {\n\t\t\tawait this._actual.ready();\n\t\t}\n\t}\n\n\tpublic async disconnect(): Promise<void> {\n\t\tawait this._actual?.disconnect();\n\t}\n\n\tpublic representsRunningLocation(runningLocation: ExtensionRunningLocation): boolean {\n\t\treturn this._extensionHost.runningLocation.equals(runningLocation);\n\t}\n\n\tpublic async deltaExtensions(extensionsDelta: IExtensionDescriptionDelta): Promise<void> {\n\t\tawait this._startCalled.wait();\n\t\tif (this._actual) {\n\t\t\treturn this._actual.deltaExtensions(extensionsDelta);\n\t\t}\n\t\tif (extensionsDelta.myToAdd.length > 0) {\n\t\t\tconst actual = this._createActual(`contains ${extensionsDelta.myToAdd.length} new extension(s) (installed or enabled): ${extensionsDelta.myToAdd.map(extId => extId.value)}`);\n\t\t\tawait actual.ready();\n\t\t\treturn;\n\t\t}\n\t}\n\n\tpublic containsExtension(extensionId: ExtensionIdentifier): boolean {\n\t\treturn this._extensionHost.extensions?.containsExtension(extensionId) ?? false;\n\t}\n\n\tpublic async activate(extension: ExtensionIdentifier, reason: ExtensionActivationReason): Promise<boolean> {\n\t\tawait this._startCalled.wait();\n\t\tif (this._actual) {\n\t\t\treturn this._actual.activate(extension, reason);\n\t\t}\n\t\treturn false;\n\t}\n\n\tpublic async activateByEvent(activationEvent: string, activationKind: ActivationKind): Promise<void> {\n\t\tif (activationKind === ActivationKind.Immediate) {\n\t\t\t// this is an immediate request, so we cannot wait for start to be called\n\t\t\tif (this._actual) {\n\t\t\t\treturn this._actual.activateByEvent(activationEvent, activationKind);\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\t\tawait this._startCalled.wait();\n\t\tif (this._actual) {\n\t\t\treturn this._actual.activateByEvent(activationEvent, activationKind);\n\t\t}\n\t}\n\n\tpublic activationEventIsDone(activationEvent: string): boolean {\n\t\tif (!this._startCalled.isOpen()) {\n\t\t\treturn false;\n\t\t}\n\t\tif (this._actual) {\n\t\t\treturn this._actual.activationEventIsDone(activationEvent);\n\t\t}\n\t\treturn true;\n\t}\n\n\tpublic async getInspectPort(tryEnableInspector: boolean): Promise<IExtensionInspectInfo | undefined> {\n\t\tawait this._startCalled.wait();\n\t\treturn this._actual?.getInspectPort(tryEnableInspector);\n\t}\n\n\tpublic async resolveAuthority(remoteAuthority: string, resolveAttempt: number): Promise<IResolveAuthorityResult> {\n\t\tawait this._startCalled.wait();\n\t\tif (this._actual) {\n\t\t\treturn this._actual.resolveAuthority(remoteAuthority, resolveAttempt);\n\t\t}\n\t\treturn {\n\t\t\ttype: 'error',\n\t\t\terror: {\n\t\t\t\tmessage: `Cannot resolve authority`,\n\t\t\t\tcode: RemoteAuthorityResolverErrorCode.Unknown,\n\t\t\t\tdetail: undefined\n\t\t\t}\n\t\t};\n\t}\n\n\tpublic async getCanonicalURI(remoteAuthority: string, uri: URI): Promise<URI | null> {\n\t\tawait this._startCalled.wait();\n\t\tif (this._actual) {\n\t\t\treturn this._actual.getCanonicalURI(remoteAuthority, uri);\n\t\t}\n\t\tthrow new Error(`Cannot resolve canonical URI`);\n\t}\n\n\tpublic async start(extensionRegistryVersionId: number, allExtensions: IExtensionDescription[], myExtensions: ExtensionIdentifier[]): Promise<void> {\n\t\tif (myExtensions.length > 0) {\n\t\t\t// there are actual extensions, so let's launch the extension host (auto-start)\n\t\t\tconst actual = this._createActual(`contains ${myExtensions.length} extension(s): ${myExtensions.map(extId => extId.value)}.`);\n\t\t\tconst result = actual.ready();\n\t\t\tthis._startCalled.open();\n\t\t\treturn result;\n\t\t}\n\t\t// there are no actual extensions running\n\t\tthis._startCalled.open();\n\t}\n\n\tpublic async extensionTestsExecute(): Promise<number> {\n\t\tawait this._startCalled.wait();\n\t\tconst actual = await this._getOrCreateActualAndStart(`execute tests.`);\n\t\treturn actual.extensionTestsExecute();\n\t}\n\n\tpublic async setRemoteEnvironment(env: { [key: string]: string | null }): Promise<void> {\n\t\tawait this._startCalled.wait();\n\t\tif (this._actual) {\n\t\t\treturn this._actual.setRemoteEnvironment(env);\n\t\t}\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Barrier } from '../../../../base/common/async.js';\nimport { Emitter, Event } from '../../../../base/common/event.js';\nimport { Disposable } from '../../../../base/common/lifecycle.js';\nimport { URI } from '../../../../base/common/uri.js';\nimport { ExtensionIdentifier, IExtensionDescription } from '../../../../platform/extensions/common/extensions.js';\nimport { IInstantiationService } from '../../../../platform/instantiation/common/instantiation.js';\nimport { ILogService } from '../../../../platform/log/common/log.js';\nimport { RemoteAuthorityResolverErrorCode } from '../../../../platform/remote/common/remoteAuthorityResolver.js';\nimport { ExtensionHostKind } from './extensionHostKind.js';\nimport { ExtensionHostManager, friendlyExtHostName } from './extensionHostManager.js';\nimport { IExtensionHostManager } from './extensionHostManagers.js';\nimport { IExtensionDescriptionDelta } from './extensionHostProtocol.js';\nimport { IResolveAuthorityResult } from './extensionHostProxy.js';\nimport { ExtensionRunningLocation } from './extensionRunningLocation.js';\nimport { ActivationKind, ExtensionActivationReason, ExtensionHostStartup, IExtensionHost, IExtensionInspectInfo, IInternalExtensionService } from './extensions.js';\nimport { ResponsiveState } from './rpcProtocol.js';\n\n/**\n * Waits until `start()` and only if it has extensions proceeds to really start.\n */\nexport class LazyCreateExtensionHostManager extends Disposable implements IExtensionHostManager {\n\n\tpublic readonly onDidExit: Event<[number, string | null]>;\n\tprivate readonly _onDidChangeResponsiveState: Emitter<ResponsiveState> = this._register(new Emitter<ResponsiveState>());\n\tpublic readonly onDidChangeResponsiveState: Event<ResponsiveState> = this._onDidChangeResponsiveState.event;\n\n\tprivate readonly _extensionHost: IExtensionHost;\n\tprivate _startCalled: Barrier;\n\tprivate _actual: ExtensionHostManager | null;\n\n\tpublic get pid(): number | null {\n\t\tif (this._actual) {\n\t\t\treturn this._actual.pid;\n\t\t}\n\t\treturn null;\n\t}\n\n\tpublic get kind(): ExtensionHostKind {\n\t\treturn this._extensionHost.runningLocation.kind;\n\t}\n\n\tpublic get startup(): ExtensionHostStartup {\n\t\treturn this._extensionHost.startup;\n\t}\n\n\tpublic get friendyName(): string {\n\t\treturn friendlyExtHostName(this.kind, this.pid);\n\t}\n\n\tconstructor(\n\t\textensionHost: IExtensionHost,\n\t\tprivate readonly _initialActivationEvents: string[],\n\t\tprivate readonly _internalExtensionService: IInternalExtensionService,\n\t\t@IInstantiationService private readonly _instantiationService: IInstantiationService,\n\t\t@ILogService private readonly _logService: ILogService\n\t) {\n\t\tsuper();\n\t\tthis._extensionHost = extensionHost;\n\t\tthis.onDidExit = extensionHost.onExit;\n\t\tthis._startCalled = new Barrier();\n\t\tthis._actual = null;\n\t}\n\n\toverride dispose(): void {\n\t\tif (!this._actual) {\n\t\t\tthis._extensionHost.dispose();\n\t\t}\n\t\tsuper.dispose();\n\t}\n\n\tprivate _createActual(reason: string): ExtensionHostManager {\n\t\tthis._logService.info(`Creating lazy extension host (${this.friendyName}). Reason: ${reason}`);\n\t\tthis._actual = this._register(this._instantiationService.createInstance(ExtensionHostManager, this._extensionHost, this._initialActivationEvents, this._internalExtensionService));\n\t\tthis._register(this._actual.onDidChangeResponsiveState((e) => this._onDidChangeResponsiveState.fire(e)));\n\t\treturn this._actual;\n\t}\n\n\tprivate async _getOrCreateActualAndStart(reason: string): Promise<ExtensionHostManager> {\n\t\tif (this._actual) {\n\t\t\t// already created/started\n\t\t\treturn this._actual;\n\t\t}\n\t\tconst actual = this._createActual(reason);\n\t\tawait actual.ready();\n\t\treturn actual;\n\t}\n\n\tpublic async ready(): Promise<void> {\n\t\tawait this._startCalled.wait();\n\t\tif (this._actual) {\n\t\t\tawait this._actual.ready();\n\t\t}\n\t}\n\n\tpublic async disconnect(): Promise<void> {\n\t\tawait this._actual?.disconnect();\n\t}\n\n\tpublic representsRunningLocation(runningLocation: ExtensionRunningLocation): boolean {\n\t\treturn this._extensionHost.runningLocation.equals(runningLocation);\n\t}\n\n\tpublic async deltaExtensions(extensionsDelta: IExtensionDescriptionDelta): Promise<void> {\n\t\tawait this._startCalled.wait();\n\t\tif (this._actual) {\n\t\t\treturn this._actual.deltaExtensions(extensionsDelta);\n\t\t}\n\t\tif (extensionsDelta.myToAdd.length > 0) {\n\t\t\tconst actual = this._createActual(`contains ${extensionsDelta.myToAdd.length} new extension(s) (installed or enabled): ${extensionsDelta.myToAdd.map(extId => extId.value)}`);\n\t\t\tawait actual.ready();\n\t\t\treturn;\n\t\t}\n\t}\n\n\tpublic containsExtension(extensionId: ExtensionIdentifier): boolean {\n\t\treturn this._extensionHost.extensions?.containsExtension(extensionId) ?? false;\n\t}\n\n\tpublic async activate(extension: ExtensionIdentifier, reason: ExtensionActivationReason): Promise<boolean> {\n\t\tawait this._startCalled.wait();\n\t\tif (this._actual) {\n\t\t\treturn this._actual.activate(extension, reason);\n\t\t}\n\t\treturn false;\n\t}\n\n\tpublic async activateByEvent(activationEvent: string, activationKind: ActivationKind): Promise<void> {\n\t\tif (activationKind === ActivationKind.Immediate) {\n\t\t\t// this is an immediate request, so we cannot wait for start to be called\n\t\t\tif (this._actual) {\n\t\t\t\treturn this._actual.activateByEvent(activationEvent, activationKind);\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\t\tawait this._startCalled.wait();\n\t\tif (this._actual) {\n\t\t\treturn this._actual.activateByEvent(activationEvent, activationKind);\n\t\t}\n\t}\n\n\tpublic activationEventIsDone(activationEvent: string): boolean {\n\t\tif (!this._startCalled.isOpen()) {\n\t\t\treturn false;\n\t\t}\n\t\tif (this._actual) {\n\t\t\treturn this._actual.activationEventIsDone(activationEvent);\n\t\t}\n\t\treturn true;\n\t}\n\n\tpublic async getInspectPort(tryEnableInspector: boolean): Promise<IExtensionInspectInfo | undefined> {\n\t\tawait this._startCalled.wait();\n\t\treturn this._actual?.getInspectPort(tryEnableInspector);\n\t}\n\n\tpublic async resolveAuthority(remoteAuthority: string, resolveAttempt: number): Promise<IResolveAuthorityResult> {\n\t\tawait this._startCalled.wait();\n\t\tif (this._actual) {\n\t\t\treturn this._actual.resolveAuthority(remoteAuthority, resolveAttempt);\n\t\t}\n\t\treturn {\n\t\t\ttype: 'error',\n\t\t\terror: {\n\t\t\t\tmessage: `Cannot resolve authority`,\n\t\t\t\tcode: RemoteAuthorityResolverErrorCode.Unknown,\n\t\t\t\tdetail: undefined\n\t\t\t}\n\t\t};\n\t}\n\n\tpublic async getCanonicalURI(remoteAuthority: string, uri: URI): Promise<URI | null> {\n\t\tawait this._startCalled.wait();\n\t\tif (this._actual) {\n\t\t\treturn this._actual.getCanonicalURI(remoteAuthority, uri);\n\t\t}\n\t\tthrow new Error(`Cannot resolve canonical URI`);\n\t}\n\n\tpublic async start(extensionRegistryVersionId: number, allExtensions: IExtensionDescription[], myExtensions: ExtensionIdentifier[]): Promise<void> {\n\t\tif (myExtensions.length > 0) {\n\t\t\t// there are actual extensions, so let's launch the extension host (auto-start)\n\t\t\tconst actual = this._createActual(`contains ${myExtensions.length} extension(s): ${myExtensions.map(extId => extId.value)}.`);\n\t\t\tconst result = actual.ready();\n\t\t\tthis._startCalled.open();\n\t\t\treturn result;\n\t\t}\n\t\t// there are no actual extensions running\n\t\tthis._startCalled.open();\n\t}\n\n\tpublic async extensionTestsExecute(): Promise<number> {\n\t\tawait this._startCalled.wait();\n\t\tconst actual = await this._getOrCreateActualAndStart(`execute tests.`);\n\t\treturn actual.extensionTestsExecute();\n\t}\n\n\tpublic async setRemoteEnvironment(env: { [key: string]: string | null }): Promise<void> {\n\t\tawait this._startCalled.wait();\n\t\tif (this._actual) {\n\t\t\treturn this._actual.setRemoteEnvironment(env);\n\t\t}\n\t}\n}\n"]}