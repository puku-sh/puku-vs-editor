{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/services/extensions/common/proxyIdentifier.ts","vs/workbench/services/extensions/common/proxyIdentifier.ts"],"names":[],"mappings":"AAAA;;;gGAGgG;AA6BhG,MAAM,OAAO,eAAe;aACb,UAAK,GAAG,CAAH,AAAI,CAAC;IAMxB,YAAY,GAAW;QALvB,0BAAqB,GAAS,SAAS,CAAC;QAMvC,IAAI,CAAC,GAAG,GAAG,GAAG,CAAC;QACf,IAAI,CAAC,GAAG,GAAG,CAAC,EAAE,eAAe,CAAC,KAAK,CAAC,CAAC;IACtC,CAAC;;AAGF,MAAM,WAAW,GAA+B,EAAE,CAAC;AAEnD,MAAM,UAAU,qBAAqB,CAAI,UAAkB;IAC1D,MAAM,MAAM,GAAG,IAAI,eAAe,CAAI,UAAU,CAAC,CAAC;IAClD,WAAW,CAAC,MAAM,CAAC,GAAG,CAAC,GAAG,MAAM,CAAC;IACjC,OAAO,MAAM,CAAC;AACf,CAAC;AAsBD,MAAM,UAAU,2BAA2B,CAAC,GAAW;IACtD,OAAO,WAAW,CAAC,GAAG,CAAC,CAAC,GAAG,CAAC;AAC7B,CAAC;AAED;;GAEG;AACH,MAAM,OAAO,6BAA6B;IACzC,YACiB,KAAQ;QAAR,UAAK,GAAL,KAAK,CAAG;IACrB,CAAC;CACL","file":"proxyIdentifier.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport type { VSBuffer } from '../../../../base/common/buffer.js';\nimport type { CancellationToken } from '../../../../base/common/cancellation.js';\n\nexport interface IRPCProtocol {\n\t/**\n\t * Returns a proxy to an object addressable/named in the extension host process or in the renderer process.\n\t */\n\tgetProxy<T>(identifier: ProxyIdentifier<T>): Proxied<T>;\n\n\t/**\n\t * Register manually created instance.\n\t */\n\tset<T, R extends T>(identifier: ProxyIdentifier<T>, instance: R): R;\n\n\t/**\n\t * Assert these identifiers are already registered via `.set`.\n\t */\n\tassertRegistered(identifiers: ProxyIdentifier<unknown>[]): void;\n\n\t/**\n\t * Wait for the write buffer (if applicable) to become empty.\n\t */\n\tdrain(): Promise<void>;\n\n\tdispose(): void;\n}\n\nexport class ProxyIdentifier<T> {\n\tpublic static count = 0;\n\t_proxyIdentifierBrand: void = undefined;\n\n\tpublic readonly sid: string;\n\tpublic readonly nid: number;\n\n\tconstructor(sid: string) {\n\t\tthis.sid = sid;\n\t\tthis.nid = (++ProxyIdentifier.count);\n\t}\n}\n\nconst identifiers: ProxyIdentifier<unknown>[] = [];\n\nexport function createProxyIdentifier<T>(identifier: string): ProxyIdentifier<T> {\n\tconst result = new ProxyIdentifier<T>(identifier);\n\tidentifiers[result.nid] = result;\n\treturn result;\n}\n\n/**\n * Mapped-type that replaces all JSONable-types with their toJSON-result type\n */\nexport type Dto<T> = T extends { toJSON(): infer U }\n\t? U\n\t: T extends VSBuffer // VSBuffer is understood by rpc-logic\n\t? T\n\t: T extends CancellationToken // CancellationToken is understood by rpc-logic\n\t? T\n\t: T extends Function // functions are dropped during JSON-stringify\n\t? never\n\t: T extends object // recurse\n\t? { [k in keyof T]: Dto<T[k]>; }\n\t: T;\n\nexport type Proxied<T> = { [K in keyof T]: T[K] extends (...args: infer A) => infer R\n\t? (...args: { [K in keyof A]: Dto<A[K]> }) => Promise<Dto<Awaited<R>>>\n\t: never\n};\n\nexport function getStringIdentifierForProxy(nid: number): string {\n\treturn identifiers[nid].sid;\n}\n\n/**\n * Marks the object as containing buffers that should be serialized more efficiently.\n */\nexport class SerializableObjectWithBuffers<T> {\n\tconstructor(\n\t\tpublic readonly value: T\n\t) { }\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport type { VSBuffer } from '../../../../base/common/buffer.js';\nimport type { CancellationToken } from '../../../../base/common/cancellation.js';\n\nexport interface IRPCProtocol {\n\t/**\n\t * Returns a proxy to an object addressable/named in the extension host process or in the renderer process.\n\t */\n\tgetProxy<T>(identifier: ProxyIdentifier<T>): Proxied<T>;\n\n\t/**\n\t * Register manually created instance.\n\t */\n\tset<T, R extends T>(identifier: ProxyIdentifier<T>, instance: R): R;\n\n\t/**\n\t * Assert these identifiers are already registered via `.set`.\n\t */\n\tassertRegistered(identifiers: ProxyIdentifier<unknown>[]): void;\n\n\t/**\n\t * Wait for the write buffer (if applicable) to become empty.\n\t */\n\tdrain(): Promise<void>;\n\n\tdispose(): void;\n}\n\nexport class ProxyIdentifier<T> {\n\tpublic static count = 0;\n\t_proxyIdentifierBrand: void = undefined;\n\n\tpublic readonly sid: string;\n\tpublic readonly nid: number;\n\n\tconstructor(sid: string) {\n\t\tthis.sid = sid;\n\t\tthis.nid = (++ProxyIdentifier.count);\n\t}\n}\n\nconst identifiers: ProxyIdentifier<unknown>[] = [];\n\nexport function createProxyIdentifier<T>(identifier: string): ProxyIdentifier<T> {\n\tconst result = new ProxyIdentifier<T>(identifier);\n\tidentifiers[result.nid] = result;\n\treturn result;\n}\n\n/**\n * Mapped-type that replaces all JSONable-types with their toJSON-result type\n */\nexport type Dto<T> = T extends { toJSON(): infer U }\n\t? U\n\t: T extends VSBuffer // VSBuffer is understood by rpc-logic\n\t? T\n\t: T extends CancellationToken // CancellationToken is understood by rpc-logic\n\t? T\n\t: T extends Function // functions are dropped during JSON-stringify\n\t? never\n\t: T extends object // recurse\n\t? { [k in keyof T]: Dto<T[k]>; }\n\t: T;\n\nexport type Proxied<T> = { [K in keyof T]: T[K] extends (...args: infer A) => infer R\n\t? (...args: { [K in keyof A]: Dto<A[K]> }) => Promise<Dto<Awaited<R>>>\n\t: never\n};\n\nexport function getStringIdentifierForProxy(nid: number): string {\n\treturn identifiers[nid].sid;\n}\n\n/**\n * Marks the object as containing buffers that should be serialized more efficiently.\n */\nexport class SerializableObjectWithBuffers<T> {\n\tconstructor(\n\t\tpublic readonly value: T\n\t) { }\n}\n"]}