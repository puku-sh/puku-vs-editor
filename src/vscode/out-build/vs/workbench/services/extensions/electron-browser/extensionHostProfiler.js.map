{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/services/extensions/electron-browser/extensionHostProfiler.ts","vs/workbench/services/extensions/electron-browser/extensionHostProfiler.ts"],"names":[],"mappings":"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","file":"extensionHostProfiler.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { TernarySearchTree } from '../../../../base/common/ternarySearchTree.js';\nimport { IExtensionHostProfile, IExtensionService, ProfileSegmentId, ProfileSession } from '../common/extensions.js';\nimport { IExtensionDescription } from '../../../../platform/extensions/common/extensions.js';\nimport { Schemas } from '../../../../base/common/network.js';\nimport { URI } from '../../../../base/common/uri.js';\nimport { IV8InspectProfilingService, IV8Profile, IV8ProfileNode } from '../../../../platform/profiling/common/profiling.js';\nimport { createSingleCallFunction } from '../../../../base/common/functional.js';\n\nexport class ExtensionHostProfiler {\n\n\tconstructor(\n\t\tprivate readonly _host: string,\n\t\tprivate readonly _port: number,\n\t\t@IExtensionService private readonly _extensionService: IExtensionService,\n\t\t@IV8InspectProfilingService private readonly _profilingService: IV8InspectProfilingService,\n\t) {\n\t}\n\n\tpublic async start(): Promise<ProfileSession> {\n\n\t\tconst id = await this._profilingService.startProfiling({ host: this._host, port: this._port });\n\n\t\treturn {\n\t\t\tstop: createSingleCallFunction(async () => {\n\t\t\t\tconst profile = await this._profilingService.stopProfiling(id);\n\t\t\t\tawait this._extensionService.whenInstalledExtensionsRegistered();\n\t\t\t\tconst extensions = this._extensionService.extensions;\n\t\t\t\treturn this._distill(profile, extensions);\n\t\t\t})\n\t\t};\n\t}\n\n\tprivate _distill(profile: IV8Profile, extensions: readonly IExtensionDescription[]): IExtensionHostProfile {\n\t\tconst searchTree = TernarySearchTree.forUris<IExtensionDescription>();\n\t\tfor (const extension of extensions) {\n\t\t\tif (extension.extensionLocation.scheme === Schemas.file) {\n\t\t\t\tsearchTree.set(URI.file(extension.extensionLocation.fsPath), extension);\n\t\t\t}\n\t\t}\n\n\t\tconst nodes = profile.nodes;\n\t\tconst idsToNodes = new Map<number, IV8ProfileNode>();\n\t\tconst idsToSegmentId = new Map<number, ProfileSegmentId | null>();\n\t\tfor (const node of nodes) {\n\t\t\tidsToNodes.set(node.id, node);\n\t\t}\n\n\t\tfunction visit(node: IV8ProfileNode, segmentId: ProfileSegmentId | null) {\n\t\t\tif (!segmentId) {\n\t\t\t\tswitch (node.callFrame.functionName) {\n\t\t\t\t\tcase '(root)':\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase '(program)':\n\t\t\t\t\t\tsegmentId = 'program';\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase '(garbage collector)':\n\t\t\t\t\t\tsegmentId = 'gc';\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tdefault:\n\t\t\t\t\t\tsegmentId = 'self';\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t} else if (segmentId === 'self' && node.callFrame.url) {\n\t\t\t\tlet extension: IExtensionDescription | undefined;\n\t\t\t\ttry {\n\t\t\t\t\textension = searchTree.findSubstr(URI.parse(node.callFrame.url));\n\t\t\t\t} catch {\n\t\t\t\t\t// ignore\n\t\t\t\t}\n\t\t\t\tif (extension) {\n\t\t\t\t\tsegmentId = extension.identifier.value;\n\t\t\t\t}\n\t\t\t}\n\t\t\tidsToSegmentId.set(node.id, segmentId);\n\n\t\t\tif (node.children) {\n\t\t\t\tfor (const child of node.children) {\n\t\t\t\t\tconst childNode = idsToNodes.get(child);\n\t\t\t\t\tif (childNode) {\n\t\t\t\t\t\tvisit(childNode, segmentId);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tvisit(nodes[0], null);\n\n\t\tconst samples = profile.samples || [];\n\t\tconst timeDeltas = profile.timeDeltas || [];\n\t\tconst distilledDeltas: number[] = [];\n\t\tconst distilledIds: ProfileSegmentId[] = [];\n\n\t\tlet currSegmentTime = 0;\n\t\tlet currSegmentId: string | undefined;\n\t\tfor (let i = 0; i < samples.length; i++) {\n\t\t\tconst id = samples[i];\n\t\t\tconst segmentId = idsToSegmentId.get(id);\n\t\t\tif (segmentId !== currSegmentId) {\n\t\t\t\tif (currSegmentId) {\n\t\t\t\t\tdistilledIds.push(currSegmentId);\n\t\t\t\t\tdistilledDeltas.push(currSegmentTime);\n\t\t\t\t}\n\t\t\t\tcurrSegmentId = segmentId ?? undefined;\n\t\t\t\tcurrSegmentTime = 0;\n\t\t\t}\n\t\t\tcurrSegmentTime += timeDeltas[i];\n\t\t}\n\t\tif (currSegmentId) {\n\t\t\tdistilledIds.push(currSegmentId);\n\t\t\tdistilledDeltas.push(currSegmentTime);\n\t\t}\n\n\t\treturn {\n\t\t\tstartTime: profile.startTime,\n\t\t\tendTime: profile.endTime,\n\t\t\tdeltas: distilledDeltas,\n\t\t\tids: distilledIds,\n\t\t\tdata: profile,\n\t\t\tgetAggregatedTimes: () => {\n\t\t\t\tconst segmentsToTime = new Map<ProfileSegmentId, number>();\n\t\t\t\tfor (let i = 0; i < distilledIds.length; i++) {\n\t\t\t\t\tconst id = distilledIds[i];\n\t\t\t\t\tsegmentsToTime.set(id, (segmentsToTime.get(id) || 0) + distilledDeltas[i]);\n\t\t\t\t}\n\t\t\t\treturn segmentsToTime;\n\t\t\t}\n\t\t};\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { TernarySearchTree } from '../../../../base/common/ternarySearchTree.js';\nimport { IExtensionHostProfile, IExtensionService, ProfileSegmentId, ProfileSession } from '../common/extensions.js';\nimport { IExtensionDescription } from '../../../../platform/extensions/common/extensions.js';\nimport { Schemas } from '../../../../base/common/network.js';\nimport { URI } from '../../../../base/common/uri.js';\nimport { IV8InspectProfilingService, IV8Profile, IV8ProfileNode } from '../../../../platform/profiling/common/profiling.js';\nimport { createSingleCallFunction } from '../../../../base/common/functional.js';\n\nexport class ExtensionHostProfiler {\n\n\tconstructor(\n\t\tprivate readonly _host: string,\n\t\tprivate readonly _port: number,\n\t\t@IExtensionService private readonly _extensionService: IExtensionService,\n\t\t@IV8InspectProfilingService private readonly _profilingService: IV8InspectProfilingService,\n\t) {\n\t}\n\n\tpublic async start(): Promise<ProfileSession> {\n\n\t\tconst id = await this._profilingService.startProfiling({ host: this._host, port: this._port });\n\n\t\treturn {\n\t\t\tstop: createSingleCallFunction(async () => {\n\t\t\t\tconst profile = await this._profilingService.stopProfiling(id);\n\t\t\t\tawait this._extensionService.whenInstalledExtensionsRegistered();\n\t\t\t\tconst extensions = this._extensionService.extensions;\n\t\t\t\treturn this._distill(profile, extensions);\n\t\t\t})\n\t\t};\n\t}\n\n\tprivate _distill(profile: IV8Profile, extensions: readonly IExtensionDescription[]): IExtensionHostProfile {\n\t\tconst searchTree = TernarySearchTree.forUris<IExtensionDescription>();\n\t\tfor (const extension of extensions) {\n\t\t\tif (extension.extensionLocation.scheme === Schemas.file) {\n\t\t\t\tsearchTree.set(URI.file(extension.extensionLocation.fsPath), extension);\n\t\t\t}\n\t\t}\n\n\t\tconst nodes = profile.nodes;\n\t\tconst idsToNodes = new Map<number, IV8ProfileNode>();\n\t\tconst idsToSegmentId = new Map<number, ProfileSegmentId | null>();\n\t\tfor (const node of nodes) {\n\t\t\tidsToNodes.set(node.id, node);\n\t\t}\n\n\t\tfunction visit(node: IV8ProfileNode, segmentId: ProfileSegmentId | null) {\n\t\t\tif (!segmentId) {\n\t\t\t\tswitch (node.callFrame.functionName) {\n\t\t\t\t\tcase '(root)':\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase '(program)':\n\t\t\t\t\t\tsegmentId = 'program';\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase '(garbage collector)':\n\t\t\t\t\t\tsegmentId = 'gc';\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tdefault:\n\t\t\t\t\t\tsegmentId = 'self';\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t} else if (segmentId === 'self' && node.callFrame.url) {\n\t\t\t\tlet extension: IExtensionDescription | undefined;\n\t\t\t\ttry {\n\t\t\t\t\textension = searchTree.findSubstr(URI.parse(node.callFrame.url));\n\t\t\t\t} catch {\n\t\t\t\t\t// ignore\n\t\t\t\t}\n\t\t\t\tif (extension) {\n\t\t\t\t\tsegmentId = extension.identifier.value;\n\t\t\t\t}\n\t\t\t}\n\t\t\tidsToSegmentId.set(node.id, segmentId);\n\n\t\t\tif (node.children) {\n\t\t\t\tfor (const child of node.children) {\n\t\t\t\t\tconst childNode = idsToNodes.get(child);\n\t\t\t\t\tif (childNode) {\n\t\t\t\t\t\tvisit(childNode, segmentId);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tvisit(nodes[0], null);\n\n\t\tconst samples = profile.samples || [];\n\t\tconst timeDeltas = profile.timeDeltas || [];\n\t\tconst distilledDeltas: number[] = [];\n\t\tconst distilledIds: ProfileSegmentId[] = [];\n\n\t\tlet currSegmentTime = 0;\n\t\tlet currSegmentId: string | undefined;\n\t\tfor (let i = 0; i < samples.length; i++) {\n\t\t\tconst id = samples[i];\n\t\t\tconst segmentId = idsToSegmentId.get(id);\n\t\t\tif (segmentId !== currSegmentId) {\n\t\t\t\tif (currSegmentId) {\n\t\t\t\t\tdistilledIds.push(currSegmentId);\n\t\t\t\t\tdistilledDeltas.push(currSegmentTime);\n\t\t\t\t}\n\t\t\t\tcurrSegmentId = segmentId ?? undefined;\n\t\t\t\tcurrSegmentTime = 0;\n\t\t\t}\n\t\t\tcurrSegmentTime += timeDeltas[i];\n\t\t}\n\t\tif (currSegmentId) {\n\t\t\tdistilledIds.push(currSegmentId);\n\t\t\tdistilledDeltas.push(currSegmentTime);\n\t\t}\n\n\t\treturn {\n\t\t\tstartTime: profile.startTime,\n\t\t\tendTime: profile.endTime,\n\t\t\tdeltas: distilledDeltas,\n\t\t\tids: distilledIds,\n\t\t\tdata: profile,\n\t\t\tgetAggregatedTimes: () => {\n\t\t\t\tconst segmentsToTime = new Map<ProfileSegmentId, number>();\n\t\t\t\tfor (let i = 0; i < distilledIds.length; i++) {\n\t\t\t\t\tconst id = distilledIds[i];\n\t\t\t\t\tsegmentsToTime.set(id, (segmentsToTime.get(id) || 0) + distilledDeltas[i]);\n\t\t\t\t}\n\t\t\t\treturn segmentsToTime;\n\t\t\t}\n\t\t};\n\t}\n}\n"]}