{"version":3,"sources":["vs/workbench/services/extensions/electron-browser/cachedExtensionScanner.ts"],"names":[],"mappings":"AAAA;;;gGAGgG;;;;;;;;;;AAEhG,OAAO,KAAK,QAAQ,MAAM,qCAAqC,CAAC;AAEhE,OAAO,EAAE,eAAe,EAAE,MAAM,6BAA6B,CAAC;AAC9D,OAAO,EAAE,yBAAyB,EAAqB,sBAAsB,IAAI,0CAA0C,EAAE,MAAM,6EAA6E,CAAC;AACjN,OAAO,EAAE,WAAW,EAAE,MAAM,wCAAwC,CAAC;AACrE,OAAO,QAAQ,MAAM,qCAAqC,CAAC;AAC3D,OAAO,EAAE,QAAQ,EAAE,MAAM,oBAAoB,CAAC;AAC9C,OAAO,EAAE,oBAAoB,EAAE,MAAM,0DAA0D,CAAC;AAChG,OAAO,EAAE,YAAY,EAAE,MAAM,4BAA4B,CAAC;AAC1D,OAAO,EAAE,OAAO,EAAE,MAAM,kCAAkC,CAAC;AAC3D,OAAO,EAAE,uBAAuB,EAAE,MAAM,iDAAiD,CAAC;AAC1F,OAAO,EAAE,eAAe,EAAE,MAAM,mCAAmC,CAAC;AACpE,OAAO,EAAE,oCAAoC,EAAE,MAAM,yDAAyD,CAAC;AAC/G,OAAO,EAAE,sBAAsB,EAAE,MAAM,yBAAyB,CAAC;AACjE,OAAO,EAAE,4BAA4B,EAAE,MAAM,gDAAgD,CAAC;AAEvF,IAAM,sBAAsB,GAA5B,MAAM,sBAAsB;IAMlC,YACwC,oBAA0C,EAClD,YAA0B,EACb,yBAAoD,EACtD,uBAAgD,EACnC,2BAAiE,EACzE,mBAAiD,EAClE,WAAwB;QANf,yBAAoB,GAApB,oBAAoB,CAAsB;QAClD,iBAAY,GAAZ,YAAY,CAAc;QACb,8BAAyB,GAAzB,yBAAyB,CAA2B;QACtD,4BAAuB,GAAvB,uBAAuB,CAAyB;QACnC,gCAA2B,GAA3B,2BAA2B,CAAsC;QACzE,wBAAmB,GAAnB,mBAAmB,CAA8B;QAClE,gBAAW,GAAX,WAAW,CAAa;QAEtD,IAAI,CAAC,iBAAiB,GAAG,IAAI,OAAO,CAA0B,CAAC,OAAO,EAAE,MAAM,EAAE,EAAE;YACjF,IAAI,CAAC,yBAAyB,GAAG,OAAO,CAAC;YACzC,IAAI,CAAC,wBAAwB,GAAG,MAAM,CAAC;QACxC,CAAC,CAAC,CAAC;IACJ,CAAC;IAEM,KAAK,CAAC,uBAAuB;QACnC,IAAI,CAAC;YACJ,MAAM,UAAU,GAAG,MAAM,IAAI,CAAC,wBAAwB,EAAE,CAAC;YACzD,IAAI,CAAC,yBAAyB,CAAC,UAAU,CAAC,CAAC;QAC5C,CAAC;QAAC,OAAO,GAAG,EAAE,CAAC;YACd,IAAI,CAAC,wBAAwB,CAAC,GAAG,CAAC,CAAC;QACpC,CAAC;IACF,CAAC;IAEO,KAAK,CAAC,wBAAwB;QACrC,IAAI,CAAC;YACJ,MAAM,QAAQ,GAAG,QAAQ,CAAC,QAAQ,CAAC;YACnC,MAAM,MAAM,GAAG,MAAM,OAAO,CAAC,UAAU,CAAC;gBACvC,IAAI,CAAC,yBAAyB,CAAC,oBAAoB,CAAC,EAAE,QAAQ,EAAE,gBAAgB,EAAE,IAAI,EAAE,CAAC;gBACzF,IAAI,CAAC,yBAAyB,CAAC,kBAAkB,CAAC,EAAE,QAAQ,EAAE,eAAe,EAAE,IAAI,CAAC,uBAAuB,CAAC,cAAc,CAAC,kBAAkB,EAAE,QAAQ,EAAE,IAAI,EAAE,CAAC;gBAChK,IAAI,CAAC,mBAAmB,CAAC,eAAe,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,IAAI,CAAC,2BAA2B,CAAC,+BAA+B,CAAC,KAAK,CAAC;aACvH,CAAC,CAAC;YAEH,IAAI,SAAS,GAAG,KAAK,CAAC;YAEtB,IAAI,uBAAuB,GAAwB,EAAE,CAAC;YACtD,IAAI,MAAM,CAAC,CAAC,CAAC,CAAC,MAAM,KAAK,WAAW,EAAE,CAAC;gBACtC,uBAAuB,GAAG,MAAM,CAAC,CAAC,CAAC,CAAC,KAAK,CAAC;YAC3C,CAAC;iBAAM,CAAC;gBACP,SAAS,GAAG,IAAI,CAAC;gBACjB,IAAI,CAAC,WAAW,CAAC,KAAK,CAAC,mCAAmC,EAAE,eAAe,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC;YAChG,CAAC;YAED,IAAI,qBAAqB,GAAwB,EAAE,CAAC;YACpD,IAAI,MAAM,CAAC,CAAC,CAAC,CAAC,MAAM,KAAK,WAAW,EAAE,CAAC;gBACtC,qBAAqB,GAAG,MAAM,CAAC,CAAC,CAAC,CAAC,KAAK,CAAC;YACzC,CAAC;iBAAM,CAAC;gBACP,SAAS,GAAG,IAAI,CAAC;gBACjB,IAAI,CAAC,WAAW,CAAC,KAAK,CAAC,iCAAiC,EAAE,eAAe,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC;YAC9F,CAAC;YAED,IAAI,mBAAmB,GAAiB,EAAE,CAAC;YAC3C,IAAI,MAAM,CAAC,CAAC,CAAC,CAAC,MAAM,KAAK,WAAW,EAAE,CAAC;gBACtC,mBAAmB,GAAG,MAAM,CAAC,CAAC,CAAC,CAAC,KAAK,CAAC;YACvC,CAAC;iBAAM,CAAC;gBACP,SAAS,GAAG,IAAI,CAAC;gBACjB,IAAI,CAAC,WAAW,CAAC,KAAK,CAAC,sCAAsC,EAAE,eAAe,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC;YACnG,CAAC;YAED,MAAM,0BAA0B,GAAwB,EAAE,CAAC;YAC3D,IAAI,CAAC;gBACJ,MAAM,6BAA6B,GAAG,MAAM,IAAI,CAAC,yBAAyB,CAAC,8BAA8B,CAAC,CAAC,GAAG,uBAAuB,EAAE,GAAG,qBAAqB,CAAC,EAAE,EAAE,QAAQ,EAAE,cAAc,EAAE,IAAI,EAAE,CAAC,CAAC;gBACtM,MAAM,iBAAiB,GAAwB,EAAE,CAAC;gBAClD,KAAK,MAAM,yBAAyB,IAAI,6BAA6B,EAAE,CAAC;oBACvE,IAAI,yBAAyB,CAAC,OAAO,EAAE,CAAC;wBACvC,0BAA0B,CAAC,IAAI,CAAC,yBAAyB,CAAC,CAAC;oBAC5D,CAAC;yBAAM,CAAC;wBACP,iBAAiB,CAAC,IAAI,CAAC,yBAAyB,CAAC,CAAC;oBACnD,CAAC;gBACF,CAAC;gBACD,IAAI,iBAAiB,CAAC,MAAM,GAAG,CAAC,EAAE,CAAC;oBAClC,IAAI,CAAC,oBAAoB,CAAC,MAAM,CAC/B,QAAQ,CAAC,OAAO,EAChB,iBAAiB,CAAC,MAAM,KAAK,CAAC;wBAC7B,CAAC,CAAC,QAAQ,CAAC,KAAmC,EAAE,IAA6E,EAAE,iBAAiB,CAAC,CAAC,CAAC,CAAC,QAAQ,CAAC,MAAM,EAAE,iBAAiB,CAAC,CAAC,CAAC,CAAC,WAAW,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;wBAC5M,CAAC,CAAC,QAAQ,CAAC,KAAoC,EAAE,IAA+E,EAAE,iBAAiB,CAAC,GAAG,CAAC,GAAG,CAAC,EAAE,CAAC,IAAI,GAAG,CAAC,QAAQ,CAAC,MAAM,GAAG,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,EAAE,iBAAiB,CAAC,GAAG,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,GAAG,CAAC,WAAW,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,EAC5Q,EAAE,CACF,CAAC;gBACH,CAAC;YACF,CAAC;YAAC,OAAO,KAAK,EAAE,CAAC;gBAChB,IAAI,CAAC,WAAW,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC;YAC/B,CAAC;YAED,MAAM,MAAM,GAAG,uBAAuB,CAAC,GAAG,CAAC,CAAC,CAAC,EAAE,CAAC,0CAA0C,CAAC,CAAC,EAAE,KAAK,CAAC,CAAC,CAAC;YACtG,MAAM,IAAI,GAAG,qBAAqB,CAAC,GAAG,CAAC,CAAC,CAAC,EAAE,CAAC,0CAA0C,CAAC,CAAC,EAAE,KAAK,CAAC,CAAC,CAAC;YAClG,MAAM,SAAS,GAAG,mBAAmB,CAAC,GAAG,CAAC,CAAC,CAAC,EAAE,CAAC,sBAAsB,CAAC,CAAC,EAAE,KAAK,CAAC,CAAC,CAAC;YACjF,MAAM,WAAW,GAAG,0BAA0B,CAAC,GAAG,CAAC,CAAC,CAAC,EAAE,CAAC,0CAA0C,CAAC,CAAC,EAAE,IAAI,CAAC,CAAC,CAAC;YAC7G,MAAM,CAAC,GAAG,eAAe,CAAC,MAAM,EAAE,IAAI,EAAE,SAAS,EAAE,WAAW,EAAE,IAAI,CAAC,WAAW,CAAC,CAAC;YAElF,IAAI,CAAC,SAAS,EAAE,CAAC;gBAChB,MAAM,UAAU,GAAG,IAAI,CAAC,yBAAyB,CAAC,gBAAgB,CAAC,GAAG,EAAE;oBACvE,UAAU,CAAC,OAAO,EAAE,CAAC;oBACrB,IAAI,CAAC,oBAAoB,CAAC,MAAM,CAC/B,QAAQ,CAAC,KAAK,EACd,QAAQ,CAAC,KAAwB,EAAE,IAAkE,CAAC,EACtG,CAAC;4BACA,KAAK,EAAE,QAAQ,CAAC,KAAc,EAAE,IAAe,CAAC;4BAChD,GAAG,EAAE,GAAG,EAAE,CAAC,IAAI,CAAC,YAAY,CAAC,MAAM,EAAE;yBACrC,CAAC,CACF,CAAC;gBACH,CAAC,CAAC,CAAC;gBACH,OAAO,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC,GAAG,EAAE,CAAC,UAAU,CAAC,OAAO,EAAE,CAAC,CAAC;YAChD,CAAC;YAED,OAAO,CAAC,CAAC;QACV,CAAC;QAAC,OAAO,GAAG,EAAE,CAAC;YACd,IAAI,CAAC,WAAW,CAAC,KAAK,CAAC,sCAAsC,CAAC,CAAC;YAC/D,IAAI,CAAC,WAAW,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC;YAC5B,OAAO,EAAE,CAAC;QACX,CAAC;IACF,CAAC;CAED,CAAA;AAtHY,sBAAsB;IAOhC,WAAA,oBAAoB,CAAA;IACpB,WAAA,YAAY,CAAA;IACZ,WAAA,yBAAyB,CAAA;IACzB,WAAA,uBAAuB,CAAA;IACvB,WAAA,oCAAoC,CAAA;IACpC,WAAA,4BAA4B,CAAA;IAC5B,WAAA,WAAW,CAAA;GAbD,sBAAsB,CAsHlC","file":"cachedExtensionScanner.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as platform from '../../../../base/common/platform.js';\nimport { IExtensionDescription, IExtension } from '../../../../platform/extensions/common/extensions.js';\nimport { dedupExtensions } from '../common/extensionsUtil.js';\nimport { IExtensionsScannerService, IScannedExtension, toExtensionDescription as toExtensionDescriptionFromScannedExtension } from '../../../../platform/extensionManagement/common/extensionsScannerService.js';\nimport { ILogService } from '../../../../platform/log/common/log.js';\nimport Severity from '../../../../base/common/severity.js';\nimport { localize } from '../../../../nls.js';\nimport { INotificationService } from '../../../../platform/notification/common/notification.js';\nimport { IHostService } from '../../host/browser/host.js';\nimport { timeout } from '../../../../base/common/async.js';\nimport { IUserDataProfileService } from '../../userDataProfile/common/userDataProfile.js';\nimport { getErrorMessage } from '../../../../base/common/errors.js';\nimport { IWorkbenchExtensionManagementService } from '../../extensionManagement/common/extensionManagement.js';\nimport { toExtensionDescription } from '../common/extensions.js';\nimport { IWorkbenchEnvironmentService } from '../../environment/common/environmentService.js';\n\nexport class CachedExtensionScanner {\n\n\tpublic readonly scannedExtensions: Promise<IExtensionDescription[]>;\n\tprivate _scannedExtensionsResolve!: (result: IExtensionDescription[]) => void;\n\tprivate _scannedExtensionsReject!: (err: unknown) => void;\n\n\tconstructor(\n\t\t@INotificationService private readonly _notificationService: INotificationService,\n\t\t@IHostService private readonly _hostService: IHostService,\n\t\t@IExtensionsScannerService private readonly _extensionsScannerService: IExtensionsScannerService,\n\t\t@IUserDataProfileService private readonly _userDataProfileService: IUserDataProfileService,\n\t\t@IWorkbenchExtensionManagementService private readonly _extensionManagementService: IWorkbenchExtensionManagementService,\n\t\t@IWorkbenchEnvironmentService private readonly _environmentService: IWorkbenchEnvironmentService,\n\t\t@ILogService private readonly _logService: ILogService,\n\t) {\n\t\tthis.scannedExtensions = new Promise<IExtensionDescription[]>((resolve, reject) => {\n\t\t\tthis._scannedExtensionsResolve = resolve;\n\t\t\tthis._scannedExtensionsReject = reject;\n\t\t});\n\t}\n\n\tpublic async startScanningExtensions(): Promise<void> {\n\t\ttry {\n\t\t\tconst extensions = await this._scanInstalledExtensions();\n\t\t\tthis._scannedExtensionsResolve(extensions);\n\t\t} catch (err) {\n\t\t\tthis._scannedExtensionsReject(err);\n\t\t}\n\t}\n\n\tprivate async _scanInstalledExtensions(): Promise<IExtensionDescription[]> {\n\t\ttry {\n\t\t\tconst language = platform.language;\n\t\t\tconst result = await Promise.allSettled([\n\t\t\t\tthis._extensionsScannerService.scanSystemExtensions({ language, checkControlFile: true }),\n\t\t\t\tthis._extensionsScannerService.scanUserExtensions({ language, profileLocation: this._userDataProfileService.currentProfile.extensionsResource, useCache: true }),\n\t\t\t\tthis._environmentService.remoteAuthority ? [] : this._extensionManagementService.getInstalledWorkspaceExtensions(false)\n\t\t\t]);\n\n\t\t\tlet hasErrors = false;\n\n\t\t\tlet scannedSystemExtensions: IScannedExtension[] = [];\n\t\t\tif (result[0].status === 'fulfilled') {\n\t\t\t\tscannedSystemExtensions = result[0].value;\n\t\t\t} else {\n\t\t\t\thasErrors = true;\n\t\t\t\tthis._logService.error(`Error scanning system extensions:`, getErrorMessage(result[0].reason));\n\t\t\t}\n\n\t\t\tlet scannedUserExtensions: IScannedExtension[] = [];\n\t\t\tif (result[1].status === 'fulfilled') {\n\t\t\t\tscannedUserExtensions = result[1].value;\n\t\t\t} else {\n\t\t\t\thasErrors = true;\n\t\t\t\tthis._logService.error(`Error scanning user extensions:`, getErrorMessage(result[1].reason));\n\t\t\t}\n\n\t\t\tlet workspaceExtensions: IExtension[] = [];\n\t\t\tif (result[2].status === 'fulfilled') {\n\t\t\t\tworkspaceExtensions = result[2].value;\n\t\t\t} else {\n\t\t\t\thasErrors = true;\n\t\t\t\tthis._logService.error(`Error scanning workspace extensions:`, getErrorMessage(result[2].reason));\n\t\t\t}\n\n\t\t\tconst scannedDevelopedExtensions: IScannedExtension[] = [];\n\t\t\ttry {\n\t\t\t\tconst allScannedDevelopedExtensions = await this._extensionsScannerService.scanExtensionsUnderDevelopment([...scannedSystemExtensions, ...scannedUserExtensions], { language, includeInvalid: true });\n\t\t\t\tconst invalidExtensions: IScannedExtension[] = [];\n\t\t\t\tfor (const extensionUnderDevelopment of allScannedDevelopedExtensions) {\n\t\t\t\t\tif (extensionUnderDevelopment.isValid) {\n\t\t\t\t\t\tscannedDevelopedExtensions.push(extensionUnderDevelopment);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tinvalidExtensions.push(extensionUnderDevelopment);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (invalidExtensions.length > 0) {\n\t\t\t\t\tthis._notificationService.prompt(\n\t\t\t\t\t\tSeverity.Warning,\n\t\t\t\t\t\tinvalidExtensions.length === 1\n\t\t\t\t\t\t\t? localize('extensionUnderDevelopment.invalid', \"Failed loading extension '{0}' under development because it is invalid: {1}\", invalidExtensions[0].location.fsPath, invalidExtensions[0].validations[0][1])\n\t\t\t\t\t\t\t: localize('extensionsUnderDevelopment.invalid', \"Failed loading extensions {0} under development because they are invalid: {1}\", invalidExtensions.map(ext => `'${ext.location.fsPath}'`).join(', '), invalidExtensions.map(ext => `${ext.validations[0][1]}`).join(', ')),\n\t\t\t\t\t\t[]\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t} catch (error) {\n\t\t\t\tthis._logService.error(error);\n\t\t\t}\n\n\t\t\tconst system = scannedSystemExtensions.map(e => toExtensionDescriptionFromScannedExtension(e, false));\n\t\t\tconst user = scannedUserExtensions.map(e => toExtensionDescriptionFromScannedExtension(e, false));\n\t\t\tconst workspace = workspaceExtensions.map(e => toExtensionDescription(e, false));\n\t\t\tconst development = scannedDevelopedExtensions.map(e => toExtensionDescriptionFromScannedExtension(e, true));\n\t\t\tconst r = dedupExtensions(system, user, workspace, development, this._logService);\n\n\t\t\tif (!hasErrors) {\n\t\t\t\tconst disposable = this._extensionsScannerService.onDidChangeCache(() => {\n\t\t\t\t\tdisposable.dispose();\n\t\t\t\t\tthis._notificationService.prompt(\n\t\t\t\t\t\tSeverity.Error,\n\t\t\t\t\t\tlocalize('extensionCache.invalid', \"Extensions have been modified on disk. Please reload the window.\"),\n\t\t\t\t\t\t[{\n\t\t\t\t\t\t\tlabel: localize('reloadWindow', \"Reload Window\"),\n\t\t\t\t\t\t\trun: () => this._hostService.reload()\n\t\t\t\t\t\t}]\n\t\t\t\t\t);\n\t\t\t\t});\n\t\t\t\ttimeout(5000).then(() => disposable.dispose());\n\t\t\t}\n\n\t\t\treturn r;\n\t\t} catch (err) {\n\t\t\tthis._logService.error(`Error scanning installed extensions:`);\n\t\t\tthis._logService.error(err);\n\t\t\treturn [];\n\t\t}\n\t}\n\n}\n"]}