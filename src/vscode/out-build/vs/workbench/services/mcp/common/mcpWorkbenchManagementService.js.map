{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/services/mcp/common/mcpWorkbenchManagementService.ts","vs/workbench/services/mcp/common/mcpWorkbenchManagementService.ts"],"names":[],"mappings":"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","file":"mcpWorkbenchManagementService.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { DisposableStore, IDisposable } from '../../../../base/common/lifecycle.js';\nimport { ILocalMcpServer, IMcpManagementService, IGalleryMcpServer, InstallOptions, InstallMcpServerEvent, UninstallMcpServerEvent, DidUninstallMcpServerEvent, InstallMcpServerResult, IInstallableMcpServer, IMcpGalleryService, UninstallOptions, IAllowedMcpServersService, RegistryType } from '../../../../platform/mcp/common/mcpManagement.js';\nimport { IInstantiationService, refineServiceDecorator } from '../../../../platform/instantiation/common/instantiation.js';\nimport { IUserDataProfileService } from '../../../services/userDataProfile/common/userDataProfile.js';\nimport { Emitter, Event } from '../../../../base/common/event.js';\nimport { IMcpResourceScannerService, McpResourceTarget } from '../../../../platform/mcp/common/mcpResourceScannerService.js';\nimport { isWorkspaceFolder, IWorkspaceContextService, IWorkspaceFolder, IWorkspaceFoldersChangeEvent } from '../../../../platform/workspace/common/workspace.js';\nimport { IUriIdentityService } from '../../../../platform/uriIdentity/common/uriIdentity.js';\nimport { MCP_CONFIGURATION_KEY, WORKSPACE_STANDALONE_CONFIGURATIONS } from '../../configuration/common/configuration.js';\nimport { ILogService } from '../../../../platform/log/common/log.js';\nimport { IRemoteAgentService } from '../../remote/common/remoteAgentService.js';\nimport { URI } from '../../../../base/common/uri.js';\nimport { ConfigurationTarget } from '../../../../platform/configuration/common/configuration.js';\nimport { IChannel } from '../../../../base/parts/ipc/common/ipc.js';\nimport { McpManagementChannelClient } from '../../../../platform/mcp/common/mcpManagementIpc.js';\nimport { IUserDataProfilesService } from '../../../../platform/userDataProfile/common/userDataProfile.js';\nimport { IRemoteUserDataProfilesService } from '../../userDataProfile/common/remoteUserDataProfiles.js';\nimport { AbstractMcpManagementService, AbstractMcpResourceManagementService, ILocalMcpServerInfo } from '../../../../platform/mcp/common/mcpManagementService.js';\nimport { IFileService } from '../../../../platform/files/common/files.js';\nimport { ResourceMap } from '../../../../base/common/map.js';\nimport { IMarkdownString } from '../../../../base/common/htmlContent.js';\nimport { IMcpServerConfiguration } from '../../../../platform/mcp/common/mcpPlatformTypes.js';\n\nexport const USER_CONFIG_ID = 'usrlocal';\nexport const REMOTE_USER_CONFIG_ID = 'usrremote';\nexport const WORKSPACE_CONFIG_ID = 'workspace';\nexport const WORKSPACE_FOLDER_CONFIG_ID_PREFIX = 'ws';\n\nexport interface IWorkbencMcpServerInstallOptions extends InstallOptions {\n\ttarget?: ConfigurationTarget | IWorkspaceFolder;\n}\n\nexport const enum LocalMcpServerScope {\n\tUser = 'user',\n\tRemoteUser = 'remoteUser',\n\tWorkspace = 'workspace',\n}\n\nexport interface IWorkbenchLocalMcpServer extends ILocalMcpServer {\n\treadonly id: string;\n\treadonly scope: LocalMcpServerScope;\n}\n\nexport interface InstallWorkbenchMcpServerEvent extends InstallMcpServerEvent {\n\treadonly scope: LocalMcpServerScope;\n}\n\nexport interface IWorkbenchMcpServerInstallResult extends InstallMcpServerResult {\n\treadonly local?: IWorkbenchLocalMcpServer;\n}\n\nexport interface UninstallWorkbenchMcpServerEvent extends UninstallMcpServerEvent {\n\treadonly scope: LocalMcpServerScope;\n}\n\nexport interface DidUninstallWorkbenchMcpServerEvent extends DidUninstallMcpServerEvent {\n\treadonly scope: LocalMcpServerScope;\n}\n\nexport const IWorkbenchMcpManagementService = refineServiceDecorator<IMcpManagementService, IWorkbenchMcpManagementService>(IMcpManagementService);\nexport interface IWorkbenchMcpManagementService extends IMcpManagementService {\n\treadonly _serviceBrand: undefined;\n\n\treadonly onInstallMcpServerInCurrentProfile: Event<InstallWorkbenchMcpServerEvent>;\n\treadonly onDidInstallMcpServersInCurrentProfile: Event<readonly IWorkbenchMcpServerInstallResult[]>;\n\treadonly onDidUpdateMcpServersInCurrentProfile: Event<readonly IWorkbenchMcpServerInstallResult[]>;\n\treadonly onUninstallMcpServerInCurrentProfile: Event<UninstallWorkbenchMcpServerEvent>;\n\treadonly onDidUninstallMcpServerInCurrentProfile: Event<DidUninstallWorkbenchMcpServerEvent>;\n\treadonly onDidChangeProfile: Event<void>;\n\n\tgetInstalled(): Promise<IWorkbenchLocalMcpServer[]>;\n\tinstall(server: IInstallableMcpServer | URI, options?: IWorkbencMcpServerInstallOptions): Promise<IWorkbenchLocalMcpServer>;\n\tinstallFromGallery(server: IGalleryMcpServer, options?: InstallOptions): Promise<IWorkbenchLocalMcpServer>;\n\tupdateMetadata(local: ILocalMcpServer, server: IGalleryMcpServer, profileLocation?: URI): Promise<IWorkbenchLocalMcpServer>;\n}\n\nexport class WorkbenchMcpManagementService extends AbstractMcpManagementService implements IWorkbenchMcpManagementService {\n\n\tprivate _onInstallMcpServer = this._register(new Emitter<InstallMcpServerEvent>());\n\treadonly onInstallMcpServer = this._onInstallMcpServer.event;\n\n\tprivate _onDidInstallMcpServers = this._register(new Emitter<readonly InstallMcpServerResult[]>());\n\treadonly onDidInstallMcpServers = this._onDidInstallMcpServers.event;\n\n\tprivate _onDidUpdateMcpServers = this._register(new Emitter<readonly InstallMcpServerResult[]>());\n\treadonly onDidUpdateMcpServers = this._onDidUpdateMcpServers.event;\n\n\tprivate _onUninstallMcpServer = this._register(new Emitter<UninstallMcpServerEvent>());\n\treadonly onUninstallMcpServer = this._onUninstallMcpServer.event;\n\n\tprivate _onDidUninstallMcpServer = this._register(new Emitter<DidUninstallMcpServerEvent>());\n\treadonly onDidUninstallMcpServer = this._onDidUninstallMcpServer.event;\n\n\tprivate readonly _onInstallMcpServerInCurrentProfile = this._register(new Emitter<InstallWorkbenchMcpServerEvent>());\n\treadonly onInstallMcpServerInCurrentProfile = this._onInstallMcpServerInCurrentProfile.event;\n\n\tprivate readonly _onDidInstallMcpServersInCurrentProfile = this._register(new Emitter<readonly IWorkbenchMcpServerInstallResult[]>());\n\treadonly onDidInstallMcpServersInCurrentProfile = this._onDidInstallMcpServersInCurrentProfile.event;\n\n\tprivate readonly _onDidUpdateMcpServersInCurrentProfile = this._register(new Emitter<readonly IWorkbenchMcpServerInstallResult[]>());\n\treadonly onDidUpdateMcpServersInCurrentProfile = this._onDidUpdateMcpServersInCurrentProfile.event;\n\n\tprivate readonly _onUninstallMcpServerInCurrentProfile = this._register(new Emitter<UninstallWorkbenchMcpServerEvent>());\n\treadonly onUninstallMcpServerInCurrentProfile = this._onUninstallMcpServerInCurrentProfile.event;\n\n\tprivate readonly _onDidUninstallMcpServerInCurrentProfile = this._register(new Emitter<DidUninstallWorkbenchMcpServerEvent>());\n\treadonly onDidUninstallMcpServerInCurrentProfile = this._onDidUninstallMcpServerInCurrentProfile.event;\n\n\tprivate readonly _onDidChangeProfile = this._register(new Emitter<void>());\n\treadonly onDidChangeProfile = this._onDidChangeProfile.event;\n\n\tprivate readonly workspaceMcpManagementService: IMcpManagementService;\n\tprivate readonly remoteMcpManagementService: IMcpManagementService | undefined;\n\n\tconstructor(\n\t\tprivate readonly mcpManagementService: IMcpManagementService,\n\t\t@IAllowedMcpServersService allowedMcpServersService: IAllowedMcpServersService,\n\t\t@ILogService logService: ILogService,\n\t\t@IUserDataProfileService private readonly userDataProfileService: IUserDataProfileService,\n\t\t@IUriIdentityService private readonly uriIdentityService: IUriIdentityService,\n\t\t@IWorkspaceContextService private readonly workspaceContextService: IWorkspaceContextService,\n\t\t@IRemoteAgentService remoteAgentService: IRemoteAgentService,\n\t\t@IUserDataProfilesService private readonly userDataProfilesService: IUserDataProfilesService,\n\t\t@IRemoteUserDataProfilesService private readonly remoteUserDataProfilesService: IRemoteUserDataProfilesService,\n\t\t@IInstantiationService instantiationService: IInstantiationService,\n\t) {\n\t\tsuper(allowedMcpServersService, logService);\n\n\t\tthis.workspaceMcpManagementService = this._register(instantiationService.createInstance(WorkspaceMcpManagementService));\n\t\tconst remoteAgentConnection = remoteAgentService.getConnection();\n\t\tif (remoteAgentConnection) {\n\t\t\tthis.remoteMcpManagementService = this._register(instantiationService.createInstance(McpManagementChannelClient, remoteAgentConnection.getChannel<IChannel>('mcpManagement')));\n\t\t}\n\n\t\tthis._register(this.mcpManagementService.onInstallMcpServer(e => {\n\t\t\tthis._onInstallMcpServer.fire(e);\n\t\t\tif (uriIdentityService.extUri.isEqual(e.mcpResource, this.userDataProfileService.currentProfile.mcpResource)) {\n\t\t\t\tthis._onInstallMcpServerInCurrentProfile.fire({ ...e, scope: LocalMcpServerScope.User });\n\t\t\t}\n\t\t}));\n\n\t\tthis._register(this.mcpManagementService.onDidInstallMcpServers(e => {\n\t\t\tconst { mcpServerInstallResult, mcpServerInstallResultInCurrentProfile } = this.createInstallMcpServerResultsFromEvent(e, LocalMcpServerScope.User);\n\t\t\tthis._onDidInstallMcpServers.fire(mcpServerInstallResult);\n\t\t\tif (mcpServerInstallResultInCurrentProfile.length) {\n\t\t\t\tthis._onDidInstallMcpServersInCurrentProfile.fire(mcpServerInstallResultInCurrentProfile);\n\t\t\t}\n\t\t}));\n\n\t\tthis._register(this.mcpManagementService.onDidUpdateMcpServers(e => {\n\t\t\tconst { mcpServerInstallResult, mcpServerInstallResultInCurrentProfile } = this.createInstallMcpServerResultsFromEvent(e, LocalMcpServerScope.User);\n\t\t\tthis._onDidUpdateMcpServers.fire(mcpServerInstallResult);\n\t\t\tif (mcpServerInstallResultInCurrentProfile.length) {\n\t\t\t\tthis._onDidUpdateMcpServersInCurrentProfile.fire(mcpServerInstallResultInCurrentProfile);\n\t\t\t}\n\t\t}));\n\n\t\tthis._register(this.mcpManagementService.onUninstallMcpServer(e => {\n\t\t\tthis._onUninstallMcpServer.fire(e);\n\t\t\tif (uriIdentityService.extUri.isEqual(e.mcpResource, this.userDataProfileService.currentProfile.mcpResource)) {\n\t\t\t\tthis._onUninstallMcpServerInCurrentProfile.fire({ ...e, scope: LocalMcpServerScope.User });\n\t\t\t}\n\t\t}));\n\n\t\tthis._register(this.mcpManagementService.onDidUninstallMcpServer(e => {\n\t\t\tthis._onDidUninstallMcpServer.fire(e);\n\t\t\tif (uriIdentityService.extUri.isEqual(e.mcpResource, this.userDataProfileService.currentProfile.mcpResource)) {\n\t\t\t\tthis._onDidUninstallMcpServerInCurrentProfile.fire({ ...e, scope: LocalMcpServerScope.User });\n\t\t\t}\n\t\t}));\n\n\t\tthis._register(this.workspaceMcpManagementService.onInstallMcpServer(async e => {\n\t\t\tthis._onInstallMcpServer.fire(e);\n\t\t\tthis._onInstallMcpServerInCurrentProfile.fire({ ...e, scope: LocalMcpServerScope.Workspace });\n\t\t}));\n\n\t\tthis._register(this.workspaceMcpManagementService.onDidInstallMcpServers(async e => {\n\t\t\tconst { mcpServerInstallResult } = this.createInstallMcpServerResultsFromEvent(e, LocalMcpServerScope.Workspace);\n\t\t\tthis._onDidInstallMcpServers.fire(mcpServerInstallResult);\n\t\t\tthis._onDidInstallMcpServersInCurrentProfile.fire(mcpServerInstallResult);\n\t\t}));\n\n\t\tthis._register(this.workspaceMcpManagementService.onUninstallMcpServer(async e => {\n\t\t\tthis._onUninstallMcpServer.fire(e);\n\t\t\tthis._onUninstallMcpServerInCurrentProfile.fire({ ...e, scope: LocalMcpServerScope.Workspace });\n\t\t}));\n\n\t\tthis._register(this.workspaceMcpManagementService.onDidUninstallMcpServer(async e => {\n\t\t\tthis._onDidUninstallMcpServer.fire(e);\n\t\t\tthis._onDidUninstallMcpServerInCurrentProfile.fire({ ...e, scope: LocalMcpServerScope.Workspace });\n\t\t}));\n\n\t\tthis._register(this.workspaceMcpManagementService.onDidUpdateMcpServers(e => {\n\t\t\tconst { mcpServerInstallResult } = this.createInstallMcpServerResultsFromEvent(e, LocalMcpServerScope.Workspace);\n\t\t\tthis._onDidUpdateMcpServers.fire(mcpServerInstallResult);\n\t\t\tthis._onDidUpdateMcpServersInCurrentProfile.fire(mcpServerInstallResult);\n\t\t}));\n\n\t\tif (this.remoteMcpManagementService) {\n\t\t\tthis._register(this.remoteMcpManagementService.onInstallMcpServer(async e => {\n\t\t\t\tthis._onInstallMcpServer.fire(e);\n\t\t\t\tconst remoteMcpResource = await this.getRemoteMcpResource(this.userDataProfileService.currentProfile.mcpResource);\n\t\t\t\tif (remoteMcpResource ? uriIdentityService.extUri.isEqual(e.mcpResource, remoteMcpResource) : this.userDataProfileService.currentProfile.isDefault) {\n\t\t\t\t\tthis._onInstallMcpServerInCurrentProfile.fire({ ...e, scope: LocalMcpServerScope.RemoteUser });\n\t\t\t\t}\n\t\t\t}));\n\n\t\t\tthis._register(this.remoteMcpManagementService.onDidInstallMcpServers(e => this.handleRemoteInstallMcpServerResultsFromEvent(e, this._onDidInstallMcpServers, this._onDidInstallMcpServersInCurrentProfile)));\n\t\t\tthis._register(this.remoteMcpManagementService.onDidUpdateMcpServers(e => this.handleRemoteInstallMcpServerResultsFromEvent(e, this._onDidInstallMcpServers, this._onDidInstallMcpServersInCurrentProfile)));\n\n\t\t\tthis._register(this.remoteMcpManagementService.onUninstallMcpServer(async e => {\n\t\t\t\tthis._onUninstallMcpServer.fire(e);\n\t\t\t\tconst remoteMcpResource = await this.getRemoteMcpResource(this.userDataProfileService.currentProfile.mcpResource);\n\t\t\t\tif (remoteMcpResource ? uriIdentityService.extUri.isEqual(e.mcpResource, remoteMcpResource) : this.userDataProfileService.currentProfile.isDefault) {\n\t\t\t\t\tthis._onUninstallMcpServerInCurrentProfile.fire({ ...e, scope: LocalMcpServerScope.RemoteUser });\n\t\t\t\t}\n\t\t\t}));\n\n\t\t\tthis._register(this.remoteMcpManagementService.onDidUninstallMcpServer(async e => {\n\t\t\t\tthis._onDidUninstallMcpServer.fire(e);\n\t\t\t\tconst remoteMcpResource = await this.getRemoteMcpResource(this.userDataProfileService.currentProfile.mcpResource);\n\t\t\t\tif (remoteMcpResource ? uriIdentityService.extUri.isEqual(e.mcpResource, remoteMcpResource) : this.userDataProfileService.currentProfile.isDefault) {\n\t\t\t\t\tthis._onDidUninstallMcpServerInCurrentProfile.fire({ ...e, scope: LocalMcpServerScope.RemoteUser });\n\t\t\t\t}\n\t\t\t}));\n\t\t}\n\n\t\tthis._register(userDataProfileService.onDidChangeCurrentProfile(e => {\n\t\t\tif (!this.uriIdentityService.extUri.isEqual(e.previous.mcpResource, e.profile.mcpResource)) {\n\t\t\t\tthis._onDidChangeProfile.fire();\n\t\t\t}\n\t\t}));\n\t}\n\n\tprivate createInstallMcpServerResultsFromEvent(e: readonly InstallMcpServerResult[], scope: LocalMcpServerScope): { mcpServerInstallResult: IWorkbenchMcpServerInstallResult[]; mcpServerInstallResultInCurrentProfile: IWorkbenchMcpServerInstallResult[] } {\n\t\tconst mcpServerInstallResult: IWorkbenchMcpServerInstallResult[] = [];\n\t\tconst mcpServerInstallResultInCurrentProfile: IWorkbenchMcpServerInstallResult[] = [];\n\t\tfor (const result of e) {\n\t\t\tconst workbenchResult = {\n\t\t\t\t...result,\n\t\t\t\tlocal: result.local ? this.toWorkspaceMcpServer(result.local, scope) : undefined\n\t\t\t};\n\t\t\tmcpServerInstallResult.push(workbenchResult);\n\t\t\tif (this.uriIdentityService.extUri.isEqual(result.mcpResource, this.userDataProfileService.currentProfile.mcpResource)) {\n\t\t\t\tmcpServerInstallResultInCurrentProfile.push(workbenchResult);\n\t\t\t}\n\t\t}\n\n\t\treturn { mcpServerInstallResult, mcpServerInstallResultInCurrentProfile };\n\t}\n\n\tprivate async handleRemoteInstallMcpServerResultsFromEvent(e: readonly InstallMcpServerResult[], emitter: Emitter<readonly InstallMcpServerResult[]>, currentProfileEmitter: Emitter<readonly IWorkbenchMcpServerInstallResult[]>): Promise<void> {\n\t\tconst mcpServerInstallResult: IWorkbenchMcpServerInstallResult[] = [];\n\t\tconst mcpServerInstallResultInCurrentProfile: IWorkbenchMcpServerInstallResult[] = [];\n\t\tconst remoteMcpResource = await this.getRemoteMcpResource(this.userDataProfileService.currentProfile.mcpResource);\n\t\tfor (const result of e) {\n\t\t\tconst workbenchResult = {\n\t\t\t\t...result,\n\t\t\t\tlocal: result.local ? this.toWorkspaceMcpServer(result.local, LocalMcpServerScope.RemoteUser) : undefined\n\t\t\t};\n\t\t\tmcpServerInstallResult.push(workbenchResult);\n\t\t\tif (remoteMcpResource ? this.uriIdentityService.extUri.isEqual(result.mcpResource, remoteMcpResource) : this.userDataProfileService.currentProfile.isDefault) {\n\t\t\t\tmcpServerInstallResultInCurrentProfile.push(workbenchResult);\n\t\t\t}\n\t\t}\n\n\t\temitter.fire(mcpServerInstallResult);\n\t\tif (mcpServerInstallResultInCurrentProfile.length) {\n\t\t\tcurrentProfileEmitter.fire(mcpServerInstallResultInCurrentProfile);\n\t\t}\n\t}\n\n\tasync getInstalled(): Promise<IWorkbenchLocalMcpServer[]> {\n\t\tconst installed: IWorkbenchLocalMcpServer[] = [];\n\t\tconst [userServers, remoteServers, workspaceServers] = await Promise.all([\n\t\t\tthis.mcpManagementService.getInstalled(this.userDataProfileService.currentProfile.mcpResource),\n\t\t\tthis.remoteMcpManagementService?.getInstalled(await this.getRemoteMcpResource()) ?? Promise.resolve<ILocalMcpServer[]>([]),\n\t\t\tthis.workspaceMcpManagementService?.getInstalled() ?? Promise.resolve<ILocalMcpServer[]>([]),\n\t\t]);\n\n\t\tfor (const server of userServers) {\n\t\t\tinstalled.push(this.toWorkspaceMcpServer(server, LocalMcpServerScope.User));\n\t\t}\n\t\tfor (const server of remoteServers) {\n\t\t\tinstalled.push(this.toWorkspaceMcpServer(server, LocalMcpServerScope.RemoteUser));\n\t\t}\n\t\tfor (const server of workspaceServers) {\n\t\t\tinstalled.push(this.toWorkspaceMcpServer(server, LocalMcpServerScope.Workspace));\n\t\t}\n\n\t\treturn installed;\n\t}\n\n\tprivate toWorkspaceMcpServer(server: ILocalMcpServer, scope: LocalMcpServerScope): IWorkbenchLocalMcpServer {\n\t\treturn { ...server, id: `mcp.config.${this.getConfigId(server, scope)}.${server.name}`, scope };\n\t}\n\n\tprivate getConfigId(server: ILocalMcpServer, scope: LocalMcpServerScope): string {\n\t\tif (scope === LocalMcpServerScope.User) {\n\t\t\treturn USER_CONFIG_ID;\n\t\t}\n\n\t\tif (scope === LocalMcpServerScope.RemoteUser) {\n\t\t\treturn REMOTE_USER_CONFIG_ID;\n\t\t}\n\n\t\tif (scope === LocalMcpServerScope.Workspace) {\n\t\t\tconst workspace = this.workspaceContextService.getWorkspace();\n\t\t\tif (workspace.configuration && this.uriIdentityService.extUri.isEqual(workspace.configuration, server.mcpResource)) {\n\t\t\t\treturn WORKSPACE_CONFIG_ID;\n\t\t\t}\n\n\t\t\tconst workspaceFolders = workspace.folders;\n\t\t\tfor (let index = 0; index < workspaceFolders.length; index++) {\n\t\t\t\tconst workspaceFolder = workspaceFolders[index];\n\t\t\t\tif (this.uriIdentityService.extUri.isEqual(this.uriIdentityService.extUri.joinPath(workspaceFolder.uri, WORKSPACE_STANDALONE_CONFIGURATIONS[MCP_CONFIGURATION_KEY]), server.mcpResource)) {\n\t\t\t\t\treturn `${WORKSPACE_FOLDER_CONFIG_ID_PREFIX}${index}`;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn 'unknown';\n\t}\n\n\tasync install(server: IInstallableMcpServer, options?: IWorkbencMcpServerInstallOptions): Promise<IWorkbenchLocalMcpServer> {\n\t\toptions = options ?? {};\n\n\t\tif (options.target === ConfigurationTarget.WORKSPACE || isWorkspaceFolder(options.target)) {\n\t\t\tconst mcpResource = options.target === ConfigurationTarget.WORKSPACE ? this.workspaceContextService.getWorkspace().configuration : options.target.toResource(WORKSPACE_STANDALONE_CONFIGURATIONS[MCP_CONFIGURATION_KEY]);\n\t\t\tif (!mcpResource) {\n\t\t\t\tthrow new Error(`Illegal target: ${options.target}`);\n\t\t\t}\n\t\t\toptions.mcpResource = mcpResource;\n\t\t\tconst result = await this.workspaceMcpManagementService.install(server, options);\n\t\t\treturn this.toWorkspaceMcpServer(result, LocalMcpServerScope.Workspace);\n\t\t}\n\n\t\tif (options.target === ConfigurationTarget.USER_REMOTE) {\n\t\t\tif (!this.remoteMcpManagementService) {\n\t\t\t\tthrow new Error(`Illegal target: ${options.target}`);\n\t\t\t}\n\t\t\toptions.mcpResource = await this.getRemoteMcpResource(options.mcpResource);\n\t\t\tconst result = await this.remoteMcpManagementService.install(server, options);\n\t\t\treturn this.toWorkspaceMcpServer(result, LocalMcpServerScope.RemoteUser);\n\t\t}\n\n\t\tif (options.target && options.target !== ConfigurationTarget.USER && options.target !== ConfigurationTarget.USER_LOCAL) {\n\t\t\tthrow new Error(`Illegal target: ${options.target}`);\n\t\t}\n\n\t\toptions.mcpResource = this.userDataProfileService.currentProfile.mcpResource;\n\t\tconst result = await this.mcpManagementService.install(server, options);\n\t\treturn this.toWorkspaceMcpServer(result, LocalMcpServerScope.User);\n\t}\n\n\tasync installFromGallery(server: IGalleryMcpServer, options?: IWorkbencMcpServerInstallOptions): Promise<IWorkbenchLocalMcpServer> {\n\t\toptions = options ?? {};\n\n\t\tif (options.target === ConfigurationTarget.WORKSPACE || isWorkspaceFolder(options.target)) {\n\t\t\tconst mcpResource = options.target === ConfigurationTarget.WORKSPACE ? this.workspaceContextService.getWorkspace().configuration : options.target.toResource(WORKSPACE_STANDALONE_CONFIGURATIONS[MCP_CONFIGURATION_KEY]);\n\t\t\tif (!mcpResource) {\n\t\t\t\tthrow new Error(`Illegal target: ${options.target}`);\n\t\t\t}\n\t\t\toptions.mcpResource = mcpResource;\n\t\t\tconst result = await this.workspaceMcpManagementService.installFromGallery(server, options);\n\t\t\treturn this.toWorkspaceMcpServer(result, LocalMcpServerScope.Workspace);\n\t\t}\n\n\t\tif (options.target === ConfigurationTarget.USER_REMOTE) {\n\t\t\tif (!this.remoteMcpManagementService) {\n\t\t\t\tthrow new Error(`Illegal target: ${options.target}`);\n\t\t\t}\n\t\t\toptions.mcpResource = await this.getRemoteMcpResource(options.mcpResource);\n\t\t\tconst result = await this.remoteMcpManagementService.installFromGallery(server, options);\n\t\t\treturn this.toWorkspaceMcpServer(result, LocalMcpServerScope.RemoteUser);\n\t\t}\n\n\t\tif (options.target && options.target !== ConfigurationTarget.USER && options.target !== ConfigurationTarget.USER_LOCAL) {\n\t\t\tthrow new Error(`Illegal target: ${options.target}`);\n\t\t}\n\n\t\tif (!options.mcpResource) {\n\t\t\toptions.mcpResource = this.userDataProfileService.currentProfile.mcpResource;\n\t\t}\n\t\tconst result = await this.mcpManagementService.installFromGallery(server, options);\n\t\treturn this.toWorkspaceMcpServer(result, LocalMcpServerScope.User);\n\t}\n\n\tasync updateMetadata(local: IWorkbenchLocalMcpServer, server: IGalleryMcpServer, profileLocation: URI): Promise<IWorkbenchLocalMcpServer> {\n\t\tif (local.scope === LocalMcpServerScope.Workspace) {\n\t\t\tconst result = await this.workspaceMcpManagementService.updateMetadata(local, server, profileLocation);\n\t\t\treturn this.toWorkspaceMcpServer(result, LocalMcpServerScope.Workspace);\n\t\t}\n\n\t\tif (local.scope === LocalMcpServerScope.RemoteUser) {\n\t\t\tif (!this.remoteMcpManagementService) {\n\t\t\t\tthrow new Error(`Illegal target: ${local.scope}`);\n\t\t\t}\n\t\t\tconst result = await this.remoteMcpManagementService.updateMetadata(local, server, profileLocation);\n\t\t\treturn this.toWorkspaceMcpServer(result, LocalMcpServerScope.RemoteUser);\n\t\t}\n\n\t\tconst result = await this.mcpManagementService.updateMetadata(local, server, profileLocation);\n\t\treturn this.toWorkspaceMcpServer(result, LocalMcpServerScope.User);\n\t}\n\n\tasync uninstall(server: IWorkbenchLocalMcpServer): Promise<void> {\n\t\tif (server.scope === LocalMcpServerScope.Workspace) {\n\t\t\treturn this.workspaceMcpManagementService.uninstall(server);\n\t\t}\n\n\t\tif (server.scope === LocalMcpServerScope.RemoteUser) {\n\t\t\tif (!this.remoteMcpManagementService) {\n\t\t\t\tthrow new Error(`Illegal target: ${server.scope}`);\n\t\t\t}\n\t\t\treturn this.remoteMcpManagementService.uninstall(server);\n\t\t}\n\n\t\treturn this.mcpManagementService.uninstall(server, { mcpResource: this.userDataProfileService.currentProfile.mcpResource });\n\t}\n\n\tprivate async getRemoteMcpResource(mcpResource?: URI): Promise<URI | undefined> {\n\t\tif (!mcpResource && this.userDataProfileService.currentProfile.isDefault) {\n\t\t\treturn undefined;\n\t\t}\n\t\tmcpResource = mcpResource ?? this.userDataProfileService.currentProfile.mcpResource;\n\t\tlet profile = this.userDataProfilesService.profiles.find(p => this.uriIdentityService.extUri.isEqual(p.mcpResource, mcpResource));\n\t\tif (profile) {\n\t\t\tprofile = await this.remoteUserDataProfilesService.getRemoteProfile(profile);\n\t\t} else {\n\t\t\tprofile = (await this.remoteUserDataProfilesService.getRemoteProfiles()).find(p => this.uriIdentityService.extUri.isEqual(p.mcpResource, mcpResource));\n\t\t}\n\t\treturn profile?.mcpResource;\n\t}\n}\n\nclass WorkspaceMcpResourceManagementService extends AbstractMcpResourceManagementService {\n\n\tconstructor(\n\t\tmcpResource: URI,\n\t\ttarget: McpResourceTarget,\n\t\t@IMcpGalleryService mcpGalleryService: IMcpGalleryService,\n\t\t@IFileService fileService: IFileService,\n\t\t@IUriIdentityService uriIdentityService: IUriIdentityService,\n\t\t@ILogService logService: ILogService,\n\t\t@IMcpResourceScannerService mcpResourceScannerService: IMcpResourceScannerService,\n\t) {\n\t\tsuper(mcpResource, target, mcpGalleryService, fileService, uriIdentityService, logService, mcpResourceScannerService);\n\t}\n\n\toverride async installFromGallery(server: IGalleryMcpServer, options?: InstallOptions): Promise<ILocalMcpServer> {\n\t\tthis.logService.trace('MCP Management Service: installGallery', server.name, server.galleryUrl);\n\n\t\tthis._onInstallMcpServer.fire({ name: server.name, mcpResource: this.mcpResource });\n\n\t\ttry {\n\t\t\tconst packageType = options?.packageType ?? server.configuration.packages?.[0]?.registryType ?? RegistryType.REMOTE;\n\n\t\t\tconst { mcpServerConfiguration, notices } = this.getMcpServerConfigurationFromManifest(server.configuration, packageType);\n\n\t\t\tif (notices.length > 0) {\n\t\t\t\tthis.logService.warn(`MCP Management Service: Warnings while installing ${server.name}`, notices);\n\t\t\t}\n\n\t\t\tconst installable: IInstallableMcpServer = {\n\t\t\t\tname: server.name,\n\t\t\t\tconfig: {\n\t\t\t\t\t...mcpServerConfiguration.config,\n\t\t\t\t\tgallery: server.galleryUrl ?? true,\n\t\t\t\t\tversion: server.version\n\t\t\t\t},\n\t\t\t\tinputs: mcpServerConfiguration.inputs\n\t\t\t};\n\n\t\t\tawait this.mcpResourceScannerService.addMcpServers([installable], this.mcpResource, this.target);\n\n\t\t\tawait this.updateLocal();\n\t\t\tconst local = (await this.getInstalled()).find(s => s.name === server.name);\n\t\t\tif (!local) {\n\t\t\t\tthrow new Error(`Failed to install MCP server: ${server.name}`);\n\t\t\t}\n\t\t\treturn local;\n\t\t} catch (e) {\n\t\t\tthis._onDidInstallMcpServers.fire([{ name: server.name, source: server, error: e, mcpResource: this.mcpResource }]);\n\t\t\tthrow e;\n\t\t}\n\t}\n\n\toverride updateMetadata(): Promise<ILocalMcpServer> {\n\t\tthrow new Error('Not supported');\n\t}\n\n\tprotected override installFromUri(): Promise<ILocalMcpServer> {\n\t\tthrow new Error('Not supported');\n\t}\n\n\tprotected override async getLocalServerInfo(name: string, mcpServerConfig: IMcpServerConfiguration): Promise<ILocalMcpServerInfo | undefined> {\n\t\tif (!mcpServerConfig.gallery) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\tconst [mcpServer] = await this.mcpGalleryService.getMcpServersFromGallery([{ name }]);\n\t\tif (!mcpServer) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\treturn {\n\t\t\tname: mcpServer.name,\n\t\t\tversion: mcpServerConfig.version,\n\t\t\tdisplayName: mcpServer.displayName,\n\t\t\tdescription: mcpServer.description,\n\t\t\tgalleryUrl: mcpServer.galleryUrl,\n\t\t\tmanifest: mcpServer.configuration,\n\t\t\tpublisher: mcpServer.publisher,\n\t\t\tpublisherDisplayName: mcpServer.publisherDisplayName,\n\t\t\trepositoryUrl: mcpServer.repositoryUrl,\n\t\t\ticon: mcpServer.icon,\n\t\t};\n\t}\n\n\toverride canInstall(server: IGalleryMcpServer | IInstallableMcpServer): true | IMarkdownString {\n\t\tthrow new Error('Not supported');\n\t}\n}\n\nclass WorkspaceMcpManagementService extends AbstractMcpManagementService implements IMcpManagementService {\n\n\tprivate readonly _onInstallMcpServer = this._register(new Emitter<InstallMcpServerEvent>());\n\treadonly onInstallMcpServer = this._onInstallMcpServer.event;\n\n\tprivate readonly _onDidInstallMcpServers = this._register(new Emitter<readonly InstallMcpServerResult[]>());\n\treadonly onDidInstallMcpServers = this._onDidInstallMcpServers.event;\n\n\tprivate readonly _onDidUpdateMcpServers = this._register(new Emitter<readonly InstallMcpServerResult[]>());\n\treadonly onDidUpdateMcpServers = this._onDidUpdateMcpServers.event;\n\n\tprivate readonly _onUninstallMcpServer = this._register(new Emitter<UninstallMcpServerEvent>());\n\treadonly onUninstallMcpServer = this._onUninstallMcpServer.event;\n\n\tprivate readonly _onDidUninstallMcpServer = this._register(new Emitter<DidUninstallMcpServerEvent>());\n\treadonly onDidUninstallMcpServer = this._onDidUninstallMcpServer.event;\n\n\tprivate allMcpServers: ILocalMcpServer[] = [];\n\n\tprivate workspaceConfiguration?: URI | null;\n\tprivate readonly workspaceMcpManagementServices = new ResourceMap<{ service: WorkspaceMcpResourceManagementService } & IDisposable>();\n\n\tconstructor(\n\t\t@IAllowedMcpServersService allowedMcpServersService: IAllowedMcpServersService,\n\t\t@IUriIdentityService private readonly uriIdentityService: IUriIdentityService,\n\t\t@ILogService logService: ILogService,\n\t\t@IWorkspaceContextService private readonly workspaceContextService: IWorkspaceContextService,\n\t\t@IInstantiationService private readonly instantiationService: IInstantiationService,\n\t) {\n\t\tsuper(allowedMcpServersService, logService);\n\t\tthis.initialize();\n\t}\n\n\tprivate async initialize(): Promise<void> {\n\t\ttry {\n\t\t\tawait this.onDidChangeWorkbenchState();\n\t\t\tawait this.onDidChangeWorkspaceFolders({ added: this.workspaceContextService.getWorkspace().folders, removed: [], changed: [] });\n\t\t\tthis._register(this.workspaceContextService.onDidChangeWorkspaceFolders(e => this.onDidChangeWorkspaceFolders(e)));\n\t\t\tthis._register(this.workspaceContextService.onDidChangeWorkbenchState(e => this.onDidChangeWorkbenchState()));\n\t\t} catch (error) {\n\t\t\tthis.logService.error('Failed to initialize workspace folders', error);\n\t\t}\n\t}\n\n\tprivate async onDidChangeWorkbenchState(): Promise<void> {\n\t\tif (this.workspaceConfiguration) {\n\t\t\tawait this.removeWorkspaceService(this.workspaceConfiguration);\n\t\t}\n\t\tthis.workspaceConfiguration = this.workspaceContextService.getWorkspace().configuration;\n\t\tif (this.workspaceConfiguration) {\n\t\t\tawait this.addWorkspaceService(this.workspaceConfiguration, ConfigurationTarget.WORKSPACE);\n\t\t}\n\t}\n\n\tprivate async onDidChangeWorkspaceFolders(e: IWorkspaceFoldersChangeEvent): Promise<void> {\n\t\ttry {\n\t\t\tawait Promise.allSettled(e.removed.map(folder => this.removeWorkspaceService(folder.toResource(WORKSPACE_STANDALONE_CONFIGURATIONS[MCP_CONFIGURATION_KEY]))));\n\t\t} catch (error) {\n\t\t\tthis.logService.error(error);\n\t\t}\n\t\ttry {\n\t\t\tawait Promise.allSettled(e.added.map(folder => this.addWorkspaceService(folder.toResource(WORKSPACE_STANDALONE_CONFIGURATIONS[MCP_CONFIGURATION_KEY]), ConfigurationTarget.WORKSPACE_FOLDER)));\n\t\t} catch (error) {\n\t\t\tthis.logService.error(error);\n\t\t}\n\t}\n\n\tprivate async addWorkspaceService(mcpResource: URI, target: McpResourceTarget): Promise<void> {\n\t\tif (this.workspaceMcpManagementServices.has(mcpResource)) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst disposables = new DisposableStore();\n\t\tconst service = disposables.add(this.instantiationService.createInstance(WorkspaceMcpResourceManagementService, mcpResource, target));\n\n\t\ttry {\n\t\t\tconst installedServers = await service.getInstalled();\n\t\t\tthis.allMcpServers.push(...installedServers);\n\t\t\tif (installedServers.length > 0) {\n\t\t\t\tconst installResults: InstallMcpServerResult[] = installedServers.map(server => ({\n\t\t\t\t\tname: server.name,\n\t\t\t\t\tlocal: server,\n\t\t\t\t\tmcpResource: server.mcpResource\n\t\t\t\t}));\n\t\t\t\tthis._onDidInstallMcpServers.fire(installResults);\n\t\t\t}\n\t\t} catch (error) {\n\t\t\tthis.logService.warn('Failed to get installed servers from', mcpResource.toString(), error);\n\t\t}\n\n\t\tdisposables.add(service.onInstallMcpServer(e => this._onInstallMcpServer.fire(e)));\n\t\tdisposables.add(service.onDidInstallMcpServers(e => {\n\t\t\tfor (const { local } of e) {\n\t\t\t\tif (local) {\n\t\t\t\t\tthis.allMcpServers.push(local);\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis._onDidInstallMcpServers.fire(e);\n\t\t}));\n\t\tdisposables.add(service.onDidUpdateMcpServers(e => {\n\t\t\tfor (const { local, mcpResource } of e) {\n\t\t\t\tif (local) {\n\t\t\t\t\tconst index = this.allMcpServers.findIndex(server => this.uriIdentityService.extUri.isEqual(server.mcpResource, mcpResource) && server.name === local.name);\n\t\t\t\t\tif (index !== -1) {\n\t\t\t\t\t\tthis.allMcpServers.splice(index, 1, local);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis._onDidUpdateMcpServers.fire(e);\n\t\t}));\n\t\tdisposables.add(service.onUninstallMcpServer(e => this._onUninstallMcpServer.fire(e)));\n\t\tdisposables.add(service.onDidUninstallMcpServer(e => {\n\t\t\tconst index = this.allMcpServers.findIndex(server => this.uriIdentityService.extUri.isEqual(server.mcpResource, e.mcpResource) && server.name === e.name);\n\t\t\tif (index !== -1) {\n\t\t\t\tthis.allMcpServers.splice(index, 1);\n\t\t\t\tthis._onDidUninstallMcpServer.fire(e);\n\t\t\t}\n\t\t}));\n\t\tthis.workspaceMcpManagementServices.set(mcpResource, { service, dispose: () => disposables.dispose() });\n\t}\n\n\tprivate async removeWorkspaceService(mcpResource: URI): Promise<void> {\n\t\tconst serviceItem = this.workspaceMcpManagementServices.get(mcpResource);\n\t\tif (serviceItem) {\n\t\t\ttry {\n\t\t\t\tconst installedServers = await serviceItem.service.getInstalled();\n\t\t\t\tthis.allMcpServers = this.allMcpServers.filter(server => !installedServers.some(uninstalled => this.uriIdentityService.extUri.isEqual(uninstalled.mcpResource, server.mcpResource)));\n\t\t\t\tfor (const server of installedServers) {\n\t\t\t\t\tthis._onDidUninstallMcpServer.fire({\n\t\t\t\t\t\tname: server.name,\n\t\t\t\t\t\tmcpResource: server.mcpResource\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t} catch (error) {\n\t\t\t\tthis.logService.warn('Failed to get installed servers from', mcpResource.toString(), error);\n\t\t\t}\n\t\t\tthis.workspaceMcpManagementServices.delete(mcpResource);\n\t\t\tserviceItem.dispose();\n\t\t}\n\t}\n\n\tasync getInstalled(): Promise<ILocalMcpServer[]> {\n\t\treturn this.allMcpServers;\n\t}\n\n\tasync install(server: IInstallableMcpServer, options?: InstallOptions): Promise<ILocalMcpServer> {\n\t\tif (!options?.mcpResource) {\n\t\t\tthrow new Error('MCP resource is required');\n\t\t}\n\n\t\tconst mcpManagementServiceItem = this.workspaceMcpManagementServices.get(options?.mcpResource);\n\t\tif (!mcpManagementServiceItem) {\n\t\t\tthrow new Error(`No MCP management service found for resource: ${options?.mcpResource.toString()}`);\n\t\t}\n\n\t\treturn mcpManagementServiceItem.service.install(server, options);\n\t}\n\n\tasync uninstall(server: ILocalMcpServer, options?: UninstallOptions): Promise<void> {\n\t\tconst mcpResource = server.mcpResource;\n\n\t\tconst mcpManagementServiceItem = this.workspaceMcpManagementServices.get(mcpResource);\n\t\tif (!mcpManagementServiceItem) {\n\t\t\tthrow new Error(`No MCP management service found for resource: ${mcpResource.toString()}`);\n\t\t}\n\n\t\treturn mcpManagementServiceItem.service.uninstall(server, options);\n\t}\n\n\tinstallFromGallery(gallery: IGalleryMcpServer, options?: InstallOptions): Promise<ILocalMcpServer> {\n\t\tif (!options?.mcpResource) {\n\t\t\tthrow new Error('MCP resource is required');\n\t\t}\n\n\t\tconst mcpManagementServiceItem = this.workspaceMcpManagementServices.get(options?.mcpResource);\n\t\tif (!mcpManagementServiceItem) {\n\t\t\tthrow new Error(`No MCP management service found for resource: ${options?.mcpResource.toString()}`);\n\t\t}\n\n\t\treturn mcpManagementServiceItem.service.installFromGallery(gallery, options);\n\t}\n\n\tupdateMetadata(): Promise<ILocalMcpServer> {\n\t\tthrow new Error('Not supported');\n\t}\n\n\toverride dispose(): void {\n\t\tthis.workspaceMcpManagementServices.forEach(service => service.dispose());\n\t\tthis.workspaceMcpManagementServices.clear();\n\t\tsuper.dispose();\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { DisposableStore, IDisposable } from '../../../../base/common/lifecycle.js';\nimport { ILocalMcpServer, IMcpManagementService, IGalleryMcpServer, InstallOptions, InstallMcpServerEvent, UninstallMcpServerEvent, DidUninstallMcpServerEvent, InstallMcpServerResult, IInstallableMcpServer, IMcpGalleryService, UninstallOptions, IAllowedMcpServersService, RegistryType } from '../../../../platform/mcp/common/mcpManagement.js';\nimport { IInstantiationService, refineServiceDecorator } from '../../../../platform/instantiation/common/instantiation.js';\nimport { IUserDataProfileService } from '../../../services/userDataProfile/common/userDataProfile.js';\nimport { Emitter, Event } from '../../../../base/common/event.js';\nimport { IMcpResourceScannerService, McpResourceTarget } from '../../../../platform/mcp/common/mcpResourceScannerService.js';\nimport { isWorkspaceFolder, IWorkspaceContextService, IWorkspaceFolder, IWorkspaceFoldersChangeEvent } from '../../../../platform/workspace/common/workspace.js';\nimport { IUriIdentityService } from '../../../../platform/uriIdentity/common/uriIdentity.js';\nimport { MCP_CONFIGURATION_KEY, WORKSPACE_STANDALONE_CONFIGURATIONS } from '../../configuration/common/configuration.js';\nimport { ILogService } from '../../../../platform/log/common/log.js';\nimport { IRemoteAgentService } from '../../remote/common/remoteAgentService.js';\nimport { URI } from '../../../../base/common/uri.js';\nimport { ConfigurationTarget } from '../../../../platform/configuration/common/configuration.js';\nimport { IChannel } from '../../../../base/parts/ipc/common/ipc.js';\nimport { McpManagementChannelClient } from '../../../../platform/mcp/common/mcpManagementIpc.js';\nimport { IUserDataProfilesService } from '../../../../platform/userDataProfile/common/userDataProfile.js';\nimport { IRemoteUserDataProfilesService } from '../../userDataProfile/common/remoteUserDataProfiles.js';\nimport { AbstractMcpManagementService, AbstractMcpResourceManagementService, ILocalMcpServerInfo } from '../../../../platform/mcp/common/mcpManagementService.js';\nimport { IFileService } from '../../../../platform/files/common/files.js';\nimport { ResourceMap } from '../../../../base/common/map.js';\nimport { IMarkdownString } from '../../../../base/common/htmlContent.js';\nimport { IMcpServerConfiguration } from '../../../../platform/mcp/common/mcpPlatformTypes.js';\n\nexport const USER_CONFIG_ID = 'usrlocal';\nexport const REMOTE_USER_CONFIG_ID = 'usrremote';\nexport const WORKSPACE_CONFIG_ID = 'workspace';\nexport const WORKSPACE_FOLDER_CONFIG_ID_PREFIX = 'ws';\n\nexport interface IWorkbencMcpServerInstallOptions extends InstallOptions {\n\ttarget?: ConfigurationTarget | IWorkspaceFolder;\n}\n\nexport const enum LocalMcpServerScope {\n\tUser = 'user',\n\tRemoteUser = 'remoteUser',\n\tWorkspace = 'workspace',\n}\n\nexport interface IWorkbenchLocalMcpServer extends ILocalMcpServer {\n\treadonly id: string;\n\treadonly scope: LocalMcpServerScope;\n}\n\nexport interface InstallWorkbenchMcpServerEvent extends InstallMcpServerEvent {\n\treadonly scope: LocalMcpServerScope;\n}\n\nexport interface IWorkbenchMcpServerInstallResult extends InstallMcpServerResult {\n\treadonly local?: IWorkbenchLocalMcpServer;\n}\n\nexport interface UninstallWorkbenchMcpServerEvent extends UninstallMcpServerEvent {\n\treadonly scope: LocalMcpServerScope;\n}\n\nexport interface DidUninstallWorkbenchMcpServerEvent extends DidUninstallMcpServerEvent {\n\treadonly scope: LocalMcpServerScope;\n}\n\nexport const IWorkbenchMcpManagementService = refineServiceDecorator<IMcpManagementService, IWorkbenchMcpManagementService>(IMcpManagementService);\nexport interface IWorkbenchMcpManagementService extends IMcpManagementService {\n\treadonly _serviceBrand: undefined;\n\n\treadonly onInstallMcpServerInCurrentProfile: Event<InstallWorkbenchMcpServerEvent>;\n\treadonly onDidInstallMcpServersInCurrentProfile: Event<readonly IWorkbenchMcpServerInstallResult[]>;\n\treadonly onDidUpdateMcpServersInCurrentProfile: Event<readonly IWorkbenchMcpServerInstallResult[]>;\n\treadonly onUninstallMcpServerInCurrentProfile: Event<UninstallWorkbenchMcpServerEvent>;\n\treadonly onDidUninstallMcpServerInCurrentProfile: Event<DidUninstallWorkbenchMcpServerEvent>;\n\treadonly onDidChangeProfile: Event<void>;\n\n\tgetInstalled(): Promise<IWorkbenchLocalMcpServer[]>;\n\tinstall(server: IInstallableMcpServer | URI, options?: IWorkbencMcpServerInstallOptions): Promise<IWorkbenchLocalMcpServer>;\n\tinstallFromGallery(server: IGalleryMcpServer, options?: InstallOptions): Promise<IWorkbenchLocalMcpServer>;\n\tupdateMetadata(local: ILocalMcpServer, server: IGalleryMcpServer, profileLocation?: URI): Promise<IWorkbenchLocalMcpServer>;\n}\n\nexport class WorkbenchMcpManagementService extends AbstractMcpManagementService implements IWorkbenchMcpManagementService {\n\n\tprivate _onInstallMcpServer = this._register(new Emitter<InstallMcpServerEvent>());\n\treadonly onInstallMcpServer = this._onInstallMcpServer.event;\n\n\tprivate _onDidInstallMcpServers = this._register(new Emitter<readonly InstallMcpServerResult[]>());\n\treadonly onDidInstallMcpServers = this._onDidInstallMcpServers.event;\n\n\tprivate _onDidUpdateMcpServers = this._register(new Emitter<readonly InstallMcpServerResult[]>());\n\treadonly onDidUpdateMcpServers = this._onDidUpdateMcpServers.event;\n\n\tprivate _onUninstallMcpServer = this._register(new Emitter<UninstallMcpServerEvent>());\n\treadonly onUninstallMcpServer = this._onUninstallMcpServer.event;\n\n\tprivate _onDidUninstallMcpServer = this._register(new Emitter<DidUninstallMcpServerEvent>());\n\treadonly onDidUninstallMcpServer = this._onDidUninstallMcpServer.event;\n\n\tprivate readonly _onInstallMcpServerInCurrentProfile = this._register(new Emitter<InstallWorkbenchMcpServerEvent>());\n\treadonly onInstallMcpServerInCurrentProfile = this._onInstallMcpServerInCurrentProfile.event;\n\n\tprivate readonly _onDidInstallMcpServersInCurrentProfile = this._register(new Emitter<readonly IWorkbenchMcpServerInstallResult[]>());\n\treadonly onDidInstallMcpServersInCurrentProfile = this._onDidInstallMcpServersInCurrentProfile.event;\n\n\tprivate readonly _onDidUpdateMcpServersInCurrentProfile = this._register(new Emitter<readonly IWorkbenchMcpServerInstallResult[]>());\n\treadonly onDidUpdateMcpServersInCurrentProfile = this._onDidUpdateMcpServersInCurrentProfile.event;\n\n\tprivate readonly _onUninstallMcpServerInCurrentProfile = this._register(new Emitter<UninstallWorkbenchMcpServerEvent>());\n\treadonly onUninstallMcpServerInCurrentProfile = this._onUninstallMcpServerInCurrentProfile.event;\n\n\tprivate readonly _onDidUninstallMcpServerInCurrentProfile = this._register(new Emitter<DidUninstallWorkbenchMcpServerEvent>());\n\treadonly onDidUninstallMcpServerInCurrentProfile = this._onDidUninstallMcpServerInCurrentProfile.event;\n\n\tprivate readonly _onDidChangeProfile = this._register(new Emitter<void>());\n\treadonly onDidChangeProfile = this._onDidChangeProfile.event;\n\n\tprivate readonly workspaceMcpManagementService: IMcpManagementService;\n\tprivate readonly remoteMcpManagementService: IMcpManagementService | undefined;\n\n\tconstructor(\n\t\tprivate readonly mcpManagementService: IMcpManagementService,\n\t\t@IAllowedMcpServersService allowedMcpServersService: IAllowedMcpServersService,\n\t\t@ILogService logService: ILogService,\n\t\t@IUserDataProfileService private readonly userDataProfileService: IUserDataProfileService,\n\t\t@IUriIdentityService private readonly uriIdentityService: IUriIdentityService,\n\t\t@IWorkspaceContextService private readonly workspaceContextService: IWorkspaceContextService,\n\t\t@IRemoteAgentService remoteAgentService: IRemoteAgentService,\n\t\t@IUserDataProfilesService private readonly userDataProfilesService: IUserDataProfilesService,\n\t\t@IRemoteUserDataProfilesService private readonly remoteUserDataProfilesService: IRemoteUserDataProfilesService,\n\t\t@IInstantiationService instantiationService: IInstantiationService,\n\t) {\n\t\tsuper(allowedMcpServersService, logService);\n\n\t\tthis.workspaceMcpManagementService = this._register(instantiationService.createInstance(WorkspaceMcpManagementService));\n\t\tconst remoteAgentConnection = remoteAgentService.getConnection();\n\t\tif (remoteAgentConnection) {\n\t\t\tthis.remoteMcpManagementService = this._register(instantiationService.createInstance(McpManagementChannelClient, remoteAgentConnection.getChannel<IChannel>('mcpManagement')));\n\t\t}\n\n\t\tthis._register(this.mcpManagementService.onInstallMcpServer(e => {\n\t\t\tthis._onInstallMcpServer.fire(e);\n\t\t\tif (uriIdentityService.extUri.isEqual(e.mcpResource, this.userDataProfileService.currentProfile.mcpResource)) {\n\t\t\t\tthis._onInstallMcpServerInCurrentProfile.fire({ ...e, scope: LocalMcpServerScope.User });\n\t\t\t}\n\t\t}));\n\n\t\tthis._register(this.mcpManagementService.onDidInstallMcpServers(e => {\n\t\t\tconst { mcpServerInstallResult, mcpServerInstallResultInCurrentProfile } = this.createInstallMcpServerResultsFromEvent(e, LocalMcpServerScope.User);\n\t\t\tthis._onDidInstallMcpServers.fire(mcpServerInstallResult);\n\t\t\tif (mcpServerInstallResultInCurrentProfile.length) {\n\t\t\t\tthis._onDidInstallMcpServersInCurrentProfile.fire(mcpServerInstallResultInCurrentProfile);\n\t\t\t}\n\t\t}));\n\n\t\tthis._register(this.mcpManagementService.onDidUpdateMcpServers(e => {\n\t\t\tconst { mcpServerInstallResult, mcpServerInstallResultInCurrentProfile } = this.createInstallMcpServerResultsFromEvent(e, LocalMcpServerScope.User);\n\t\t\tthis._onDidUpdateMcpServers.fire(mcpServerInstallResult);\n\t\t\tif (mcpServerInstallResultInCurrentProfile.length) {\n\t\t\t\tthis._onDidUpdateMcpServersInCurrentProfile.fire(mcpServerInstallResultInCurrentProfile);\n\t\t\t}\n\t\t}));\n\n\t\tthis._register(this.mcpManagementService.onUninstallMcpServer(e => {\n\t\t\tthis._onUninstallMcpServer.fire(e);\n\t\t\tif (uriIdentityService.extUri.isEqual(e.mcpResource, this.userDataProfileService.currentProfile.mcpResource)) {\n\t\t\t\tthis._onUninstallMcpServerInCurrentProfile.fire({ ...e, scope: LocalMcpServerScope.User });\n\t\t\t}\n\t\t}));\n\n\t\tthis._register(this.mcpManagementService.onDidUninstallMcpServer(e => {\n\t\t\tthis._onDidUninstallMcpServer.fire(e);\n\t\t\tif (uriIdentityService.extUri.isEqual(e.mcpResource, this.userDataProfileService.currentProfile.mcpResource)) {\n\t\t\t\tthis._onDidUninstallMcpServerInCurrentProfile.fire({ ...e, scope: LocalMcpServerScope.User });\n\t\t\t}\n\t\t}));\n\n\t\tthis._register(this.workspaceMcpManagementService.onInstallMcpServer(async e => {\n\t\t\tthis._onInstallMcpServer.fire(e);\n\t\t\tthis._onInstallMcpServerInCurrentProfile.fire({ ...e, scope: LocalMcpServerScope.Workspace });\n\t\t}));\n\n\t\tthis._register(this.workspaceMcpManagementService.onDidInstallMcpServers(async e => {\n\t\t\tconst { mcpServerInstallResult } = this.createInstallMcpServerResultsFromEvent(e, LocalMcpServerScope.Workspace);\n\t\t\tthis._onDidInstallMcpServers.fire(mcpServerInstallResult);\n\t\t\tthis._onDidInstallMcpServersInCurrentProfile.fire(mcpServerInstallResult);\n\t\t}));\n\n\t\tthis._register(this.workspaceMcpManagementService.onUninstallMcpServer(async e => {\n\t\t\tthis._onUninstallMcpServer.fire(e);\n\t\t\tthis._onUninstallMcpServerInCurrentProfile.fire({ ...e, scope: LocalMcpServerScope.Workspace });\n\t\t}));\n\n\t\tthis._register(this.workspaceMcpManagementService.onDidUninstallMcpServer(async e => {\n\t\t\tthis._onDidUninstallMcpServer.fire(e);\n\t\t\tthis._onDidUninstallMcpServerInCurrentProfile.fire({ ...e, scope: LocalMcpServerScope.Workspace });\n\t\t}));\n\n\t\tthis._register(this.workspaceMcpManagementService.onDidUpdateMcpServers(e => {\n\t\t\tconst { mcpServerInstallResult } = this.createInstallMcpServerResultsFromEvent(e, LocalMcpServerScope.Workspace);\n\t\t\tthis._onDidUpdateMcpServers.fire(mcpServerInstallResult);\n\t\t\tthis._onDidUpdateMcpServersInCurrentProfile.fire(mcpServerInstallResult);\n\t\t}));\n\n\t\tif (this.remoteMcpManagementService) {\n\t\t\tthis._register(this.remoteMcpManagementService.onInstallMcpServer(async e => {\n\t\t\t\tthis._onInstallMcpServer.fire(e);\n\t\t\t\tconst remoteMcpResource = await this.getRemoteMcpResource(this.userDataProfileService.currentProfile.mcpResource);\n\t\t\t\tif (remoteMcpResource ? uriIdentityService.extUri.isEqual(e.mcpResource, remoteMcpResource) : this.userDataProfileService.currentProfile.isDefault) {\n\t\t\t\t\tthis._onInstallMcpServerInCurrentProfile.fire({ ...e, scope: LocalMcpServerScope.RemoteUser });\n\t\t\t\t}\n\t\t\t}));\n\n\t\t\tthis._register(this.remoteMcpManagementService.onDidInstallMcpServers(e => this.handleRemoteInstallMcpServerResultsFromEvent(e, this._onDidInstallMcpServers, this._onDidInstallMcpServersInCurrentProfile)));\n\t\t\tthis._register(this.remoteMcpManagementService.onDidUpdateMcpServers(e => this.handleRemoteInstallMcpServerResultsFromEvent(e, this._onDidInstallMcpServers, this._onDidInstallMcpServersInCurrentProfile)));\n\n\t\t\tthis._register(this.remoteMcpManagementService.onUninstallMcpServer(async e => {\n\t\t\t\tthis._onUninstallMcpServer.fire(e);\n\t\t\t\tconst remoteMcpResource = await this.getRemoteMcpResource(this.userDataProfileService.currentProfile.mcpResource);\n\t\t\t\tif (remoteMcpResource ? uriIdentityService.extUri.isEqual(e.mcpResource, remoteMcpResource) : this.userDataProfileService.currentProfile.isDefault) {\n\t\t\t\t\tthis._onUninstallMcpServerInCurrentProfile.fire({ ...e, scope: LocalMcpServerScope.RemoteUser });\n\t\t\t\t}\n\t\t\t}));\n\n\t\t\tthis._register(this.remoteMcpManagementService.onDidUninstallMcpServer(async e => {\n\t\t\t\tthis._onDidUninstallMcpServer.fire(e);\n\t\t\t\tconst remoteMcpResource = await this.getRemoteMcpResource(this.userDataProfileService.currentProfile.mcpResource);\n\t\t\t\tif (remoteMcpResource ? uriIdentityService.extUri.isEqual(e.mcpResource, remoteMcpResource) : this.userDataProfileService.currentProfile.isDefault) {\n\t\t\t\t\tthis._onDidUninstallMcpServerInCurrentProfile.fire({ ...e, scope: LocalMcpServerScope.RemoteUser });\n\t\t\t\t}\n\t\t\t}));\n\t\t}\n\n\t\tthis._register(userDataProfileService.onDidChangeCurrentProfile(e => {\n\t\t\tif (!this.uriIdentityService.extUri.isEqual(e.previous.mcpResource, e.profile.mcpResource)) {\n\t\t\t\tthis._onDidChangeProfile.fire();\n\t\t\t}\n\t\t}));\n\t}\n\n\tprivate createInstallMcpServerResultsFromEvent(e: readonly InstallMcpServerResult[], scope: LocalMcpServerScope): { mcpServerInstallResult: IWorkbenchMcpServerInstallResult[]; mcpServerInstallResultInCurrentProfile: IWorkbenchMcpServerInstallResult[] } {\n\t\tconst mcpServerInstallResult: IWorkbenchMcpServerInstallResult[] = [];\n\t\tconst mcpServerInstallResultInCurrentProfile: IWorkbenchMcpServerInstallResult[] = [];\n\t\tfor (const result of e) {\n\t\t\tconst workbenchResult = {\n\t\t\t\t...result,\n\t\t\t\tlocal: result.local ? this.toWorkspaceMcpServer(result.local, scope) : undefined\n\t\t\t};\n\t\t\tmcpServerInstallResult.push(workbenchResult);\n\t\t\tif (this.uriIdentityService.extUri.isEqual(result.mcpResource, this.userDataProfileService.currentProfile.mcpResource)) {\n\t\t\t\tmcpServerInstallResultInCurrentProfile.push(workbenchResult);\n\t\t\t}\n\t\t}\n\n\t\treturn { mcpServerInstallResult, mcpServerInstallResultInCurrentProfile };\n\t}\n\n\tprivate async handleRemoteInstallMcpServerResultsFromEvent(e: readonly InstallMcpServerResult[], emitter: Emitter<readonly InstallMcpServerResult[]>, currentProfileEmitter: Emitter<readonly IWorkbenchMcpServerInstallResult[]>): Promise<void> {\n\t\tconst mcpServerInstallResult: IWorkbenchMcpServerInstallResult[] = [];\n\t\tconst mcpServerInstallResultInCurrentProfile: IWorkbenchMcpServerInstallResult[] = [];\n\t\tconst remoteMcpResource = await this.getRemoteMcpResource(this.userDataProfileService.currentProfile.mcpResource);\n\t\tfor (const result of e) {\n\t\t\tconst workbenchResult = {\n\t\t\t\t...result,\n\t\t\t\tlocal: result.local ? this.toWorkspaceMcpServer(result.local, LocalMcpServerScope.RemoteUser) : undefined\n\t\t\t};\n\t\t\tmcpServerInstallResult.push(workbenchResult);\n\t\t\tif (remoteMcpResource ? this.uriIdentityService.extUri.isEqual(result.mcpResource, remoteMcpResource) : this.userDataProfileService.currentProfile.isDefault) {\n\t\t\t\tmcpServerInstallResultInCurrentProfile.push(workbenchResult);\n\t\t\t}\n\t\t}\n\n\t\temitter.fire(mcpServerInstallResult);\n\t\tif (mcpServerInstallResultInCurrentProfile.length) {\n\t\t\tcurrentProfileEmitter.fire(mcpServerInstallResultInCurrentProfile);\n\t\t}\n\t}\n\n\tasync getInstalled(): Promise<IWorkbenchLocalMcpServer[]> {\n\t\tconst installed: IWorkbenchLocalMcpServer[] = [];\n\t\tconst [userServers, remoteServers, workspaceServers] = await Promise.all([\n\t\t\tthis.mcpManagementService.getInstalled(this.userDataProfileService.currentProfile.mcpResource),\n\t\t\tthis.remoteMcpManagementService?.getInstalled(await this.getRemoteMcpResource()) ?? Promise.resolve<ILocalMcpServer[]>([]),\n\t\t\tthis.workspaceMcpManagementService?.getInstalled() ?? Promise.resolve<ILocalMcpServer[]>([]),\n\t\t]);\n\n\t\tfor (const server of userServers) {\n\t\t\tinstalled.push(this.toWorkspaceMcpServer(server, LocalMcpServerScope.User));\n\t\t}\n\t\tfor (const server of remoteServers) {\n\t\t\tinstalled.push(this.toWorkspaceMcpServer(server, LocalMcpServerScope.RemoteUser));\n\t\t}\n\t\tfor (const server of workspaceServers) {\n\t\t\tinstalled.push(this.toWorkspaceMcpServer(server, LocalMcpServerScope.Workspace));\n\t\t}\n\n\t\treturn installed;\n\t}\n\n\tprivate toWorkspaceMcpServer(server: ILocalMcpServer, scope: LocalMcpServerScope): IWorkbenchLocalMcpServer {\n\t\treturn { ...server, id: `mcp.config.${this.getConfigId(server, scope)}.${server.name}`, scope };\n\t}\n\n\tprivate getConfigId(server: ILocalMcpServer, scope: LocalMcpServerScope): string {\n\t\tif (scope === LocalMcpServerScope.User) {\n\t\t\treturn USER_CONFIG_ID;\n\t\t}\n\n\t\tif (scope === LocalMcpServerScope.RemoteUser) {\n\t\t\treturn REMOTE_USER_CONFIG_ID;\n\t\t}\n\n\t\tif (scope === LocalMcpServerScope.Workspace) {\n\t\t\tconst workspace = this.workspaceContextService.getWorkspace();\n\t\t\tif (workspace.configuration && this.uriIdentityService.extUri.isEqual(workspace.configuration, server.mcpResource)) {\n\t\t\t\treturn WORKSPACE_CONFIG_ID;\n\t\t\t}\n\n\t\t\tconst workspaceFolders = workspace.folders;\n\t\t\tfor (let index = 0; index < workspaceFolders.length; index++) {\n\t\t\t\tconst workspaceFolder = workspaceFolders[index];\n\t\t\t\tif (this.uriIdentityService.extUri.isEqual(this.uriIdentityService.extUri.joinPath(workspaceFolder.uri, WORKSPACE_STANDALONE_CONFIGURATIONS[MCP_CONFIGURATION_KEY]), server.mcpResource)) {\n\t\t\t\t\treturn `${WORKSPACE_FOLDER_CONFIG_ID_PREFIX}${index}`;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn 'unknown';\n\t}\n\n\tasync install(server: IInstallableMcpServer, options?: IWorkbencMcpServerInstallOptions): Promise<IWorkbenchLocalMcpServer> {\n\t\toptions = options ?? {};\n\n\t\tif (options.target === ConfigurationTarget.WORKSPACE || isWorkspaceFolder(options.target)) {\n\t\t\tconst mcpResource = options.target === ConfigurationTarget.WORKSPACE ? this.workspaceContextService.getWorkspace().configuration : options.target.toResource(WORKSPACE_STANDALONE_CONFIGURATIONS[MCP_CONFIGURATION_KEY]);\n\t\t\tif (!mcpResource) {\n\t\t\t\tthrow new Error(`Illegal target: ${options.target}`);\n\t\t\t}\n\t\t\toptions.mcpResource = mcpResource;\n\t\t\tconst result = await this.workspaceMcpManagementService.install(server, options);\n\t\t\treturn this.toWorkspaceMcpServer(result, LocalMcpServerScope.Workspace);\n\t\t}\n\n\t\tif (options.target === ConfigurationTarget.USER_REMOTE) {\n\t\t\tif (!this.remoteMcpManagementService) {\n\t\t\t\tthrow new Error(`Illegal target: ${options.target}`);\n\t\t\t}\n\t\t\toptions.mcpResource = await this.getRemoteMcpResource(options.mcpResource);\n\t\t\tconst result = await this.remoteMcpManagementService.install(server, options);\n\t\t\treturn this.toWorkspaceMcpServer(result, LocalMcpServerScope.RemoteUser);\n\t\t}\n\n\t\tif (options.target && options.target !== ConfigurationTarget.USER && options.target !== ConfigurationTarget.USER_LOCAL) {\n\t\t\tthrow new Error(`Illegal target: ${options.target}`);\n\t\t}\n\n\t\toptions.mcpResource = this.userDataProfileService.currentProfile.mcpResource;\n\t\tconst result = await this.mcpManagementService.install(server, options);\n\t\treturn this.toWorkspaceMcpServer(result, LocalMcpServerScope.User);\n\t}\n\n\tasync installFromGallery(server: IGalleryMcpServer, options?: IWorkbencMcpServerInstallOptions): Promise<IWorkbenchLocalMcpServer> {\n\t\toptions = options ?? {};\n\n\t\tif (options.target === ConfigurationTarget.WORKSPACE || isWorkspaceFolder(options.target)) {\n\t\t\tconst mcpResource = options.target === ConfigurationTarget.WORKSPACE ? this.workspaceContextService.getWorkspace().configuration : options.target.toResource(WORKSPACE_STANDALONE_CONFIGURATIONS[MCP_CONFIGURATION_KEY]);\n\t\t\tif (!mcpResource) {\n\t\t\t\tthrow new Error(`Illegal target: ${options.target}`);\n\t\t\t}\n\t\t\toptions.mcpResource = mcpResource;\n\t\t\tconst result = await this.workspaceMcpManagementService.installFromGallery(server, options);\n\t\t\treturn this.toWorkspaceMcpServer(result, LocalMcpServerScope.Workspace);\n\t\t}\n\n\t\tif (options.target === ConfigurationTarget.USER_REMOTE) {\n\t\t\tif (!this.remoteMcpManagementService) {\n\t\t\t\tthrow new Error(`Illegal target: ${options.target}`);\n\t\t\t}\n\t\t\toptions.mcpResource = await this.getRemoteMcpResource(options.mcpResource);\n\t\t\tconst result = await this.remoteMcpManagementService.installFromGallery(server, options);\n\t\t\treturn this.toWorkspaceMcpServer(result, LocalMcpServerScope.RemoteUser);\n\t\t}\n\n\t\tif (options.target && options.target !== ConfigurationTarget.USER && options.target !== ConfigurationTarget.USER_LOCAL) {\n\t\t\tthrow new Error(`Illegal target: ${options.target}`);\n\t\t}\n\n\t\tif (!options.mcpResource) {\n\t\t\toptions.mcpResource = this.userDataProfileService.currentProfile.mcpResource;\n\t\t}\n\t\tconst result = await this.mcpManagementService.installFromGallery(server, options);\n\t\treturn this.toWorkspaceMcpServer(result, LocalMcpServerScope.User);\n\t}\n\n\tasync updateMetadata(local: IWorkbenchLocalMcpServer, server: IGalleryMcpServer, profileLocation: URI): Promise<IWorkbenchLocalMcpServer> {\n\t\tif (local.scope === LocalMcpServerScope.Workspace) {\n\t\t\tconst result = await this.workspaceMcpManagementService.updateMetadata(local, server, profileLocation);\n\t\t\treturn this.toWorkspaceMcpServer(result, LocalMcpServerScope.Workspace);\n\t\t}\n\n\t\tif (local.scope === LocalMcpServerScope.RemoteUser) {\n\t\t\tif (!this.remoteMcpManagementService) {\n\t\t\t\tthrow new Error(`Illegal target: ${local.scope}`);\n\t\t\t}\n\t\t\tconst result = await this.remoteMcpManagementService.updateMetadata(local, server, profileLocation);\n\t\t\treturn this.toWorkspaceMcpServer(result, LocalMcpServerScope.RemoteUser);\n\t\t}\n\n\t\tconst result = await this.mcpManagementService.updateMetadata(local, server, profileLocation);\n\t\treturn this.toWorkspaceMcpServer(result, LocalMcpServerScope.User);\n\t}\n\n\tasync uninstall(server: IWorkbenchLocalMcpServer): Promise<void> {\n\t\tif (server.scope === LocalMcpServerScope.Workspace) {\n\t\t\treturn this.workspaceMcpManagementService.uninstall(server);\n\t\t}\n\n\t\tif (server.scope === LocalMcpServerScope.RemoteUser) {\n\t\t\tif (!this.remoteMcpManagementService) {\n\t\t\t\tthrow new Error(`Illegal target: ${server.scope}`);\n\t\t\t}\n\t\t\treturn this.remoteMcpManagementService.uninstall(server);\n\t\t}\n\n\t\treturn this.mcpManagementService.uninstall(server, { mcpResource: this.userDataProfileService.currentProfile.mcpResource });\n\t}\n\n\tprivate async getRemoteMcpResource(mcpResource?: URI): Promise<URI | undefined> {\n\t\tif (!mcpResource && this.userDataProfileService.currentProfile.isDefault) {\n\t\t\treturn undefined;\n\t\t}\n\t\tmcpResource = mcpResource ?? this.userDataProfileService.currentProfile.mcpResource;\n\t\tlet profile = this.userDataProfilesService.profiles.find(p => this.uriIdentityService.extUri.isEqual(p.mcpResource, mcpResource));\n\t\tif (profile) {\n\t\t\tprofile = await this.remoteUserDataProfilesService.getRemoteProfile(profile);\n\t\t} else {\n\t\t\tprofile = (await this.remoteUserDataProfilesService.getRemoteProfiles()).find(p => this.uriIdentityService.extUri.isEqual(p.mcpResource, mcpResource));\n\t\t}\n\t\treturn profile?.mcpResource;\n\t}\n}\n\nclass WorkspaceMcpResourceManagementService extends AbstractMcpResourceManagementService {\n\n\tconstructor(\n\t\tmcpResource: URI,\n\t\ttarget: McpResourceTarget,\n\t\t@IMcpGalleryService mcpGalleryService: IMcpGalleryService,\n\t\t@IFileService fileService: IFileService,\n\t\t@IUriIdentityService uriIdentityService: IUriIdentityService,\n\t\t@ILogService logService: ILogService,\n\t\t@IMcpResourceScannerService mcpResourceScannerService: IMcpResourceScannerService,\n\t) {\n\t\tsuper(mcpResource, target, mcpGalleryService, fileService, uriIdentityService, logService, mcpResourceScannerService);\n\t}\n\n\toverride async installFromGallery(server: IGalleryMcpServer, options?: InstallOptions): Promise<ILocalMcpServer> {\n\t\tthis.logService.trace('MCP Management Service: installGallery', server.name, server.galleryUrl);\n\n\t\tthis._onInstallMcpServer.fire({ name: server.name, mcpResource: this.mcpResource });\n\n\t\ttry {\n\t\t\tconst packageType = options?.packageType ?? server.configuration.packages?.[0]?.registryType ?? RegistryType.REMOTE;\n\n\t\t\tconst { mcpServerConfiguration, notices } = this.getMcpServerConfigurationFromManifest(server.configuration, packageType);\n\n\t\t\tif (notices.length > 0) {\n\t\t\t\tthis.logService.warn(`MCP Management Service: Warnings while installing ${server.name}`, notices);\n\t\t\t}\n\n\t\t\tconst installable: IInstallableMcpServer = {\n\t\t\t\tname: server.name,\n\t\t\t\tconfig: {\n\t\t\t\t\t...mcpServerConfiguration.config,\n\t\t\t\t\tgallery: server.galleryUrl ?? true,\n\t\t\t\t\tversion: server.version\n\t\t\t\t},\n\t\t\t\tinputs: mcpServerConfiguration.inputs\n\t\t\t};\n\n\t\t\tawait this.mcpResourceScannerService.addMcpServers([installable], this.mcpResource, this.target);\n\n\t\t\tawait this.updateLocal();\n\t\t\tconst local = (await this.getInstalled()).find(s => s.name === server.name);\n\t\t\tif (!local) {\n\t\t\t\tthrow new Error(`Failed to install MCP server: ${server.name}`);\n\t\t\t}\n\t\t\treturn local;\n\t\t} catch (e) {\n\t\t\tthis._onDidInstallMcpServers.fire([{ name: server.name, source: server, error: e, mcpResource: this.mcpResource }]);\n\t\t\tthrow e;\n\t\t}\n\t}\n\n\toverride updateMetadata(): Promise<ILocalMcpServer> {\n\t\tthrow new Error('Not supported');\n\t}\n\n\tprotected override installFromUri(): Promise<ILocalMcpServer> {\n\t\tthrow new Error('Not supported');\n\t}\n\n\tprotected override async getLocalServerInfo(name: string, mcpServerConfig: IMcpServerConfiguration): Promise<ILocalMcpServerInfo | undefined> {\n\t\tif (!mcpServerConfig.gallery) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\tconst [mcpServer] = await this.mcpGalleryService.getMcpServersFromGallery([{ name }]);\n\t\tif (!mcpServer) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\treturn {\n\t\t\tname: mcpServer.name,\n\t\t\tversion: mcpServerConfig.version,\n\t\t\tdisplayName: mcpServer.displayName,\n\t\t\tdescription: mcpServer.description,\n\t\t\tgalleryUrl: mcpServer.galleryUrl,\n\t\t\tmanifest: mcpServer.configuration,\n\t\t\tpublisher: mcpServer.publisher,\n\t\t\tpublisherDisplayName: mcpServer.publisherDisplayName,\n\t\t\trepositoryUrl: mcpServer.repositoryUrl,\n\t\t\ticon: mcpServer.icon,\n\t\t};\n\t}\n\n\toverride canInstall(server: IGalleryMcpServer | IInstallableMcpServer): true | IMarkdownString {\n\t\tthrow new Error('Not supported');\n\t}\n}\n\nclass WorkspaceMcpManagementService extends AbstractMcpManagementService implements IMcpManagementService {\n\n\tprivate readonly _onInstallMcpServer = this._register(new Emitter<InstallMcpServerEvent>());\n\treadonly onInstallMcpServer = this._onInstallMcpServer.event;\n\n\tprivate readonly _onDidInstallMcpServers = this._register(new Emitter<readonly InstallMcpServerResult[]>());\n\treadonly onDidInstallMcpServers = this._onDidInstallMcpServers.event;\n\n\tprivate readonly _onDidUpdateMcpServers = this._register(new Emitter<readonly InstallMcpServerResult[]>());\n\treadonly onDidUpdateMcpServers = this._onDidUpdateMcpServers.event;\n\n\tprivate readonly _onUninstallMcpServer = this._register(new Emitter<UninstallMcpServerEvent>());\n\treadonly onUninstallMcpServer = this._onUninstallMcpServer.event;\n\n\tprivate readonly _onDidUninstallMcpServer = this._register(new Emitter<DidUninstallMcpServerEvent>());\n\treadonly onDidUninstallMcpServer = this._onDidUninstallMcpServer.event;\n\n\tprivate allMcpServers: ILocalMcpServer[] = [];\n\n\tprivate workspaceConfiguration?: URI | null;\n\tprivate readonly workspaceMcpManagementServices = new ResourceMap<{ service: WorkspaceMcpResourceManagementService } & IDisposable>();\n\n\tconstructor(\n\t\t@IAllowedMcpServersService allowedMcpServersService: IAllowedMcpServersService,\n\t\t@IUriIdentityService private readonly uriIdentityService: IUriIdentityService,\n\t\t@ILogService logService: ILogService,\n\t\t@IWorkspaceContextService private readonly workspaceContextService: IWorkspaceContextService,\n\t\t@IInstantiationService private readonly instantiationService: IInstantiationService,\n\t) {\n\t\tsuper(allowedMcpServersService, logService);\n\t\tthis.initialize();\n\t}\n\n\tprivate async initialize(): Promise<void> {\n\t\ttry {\n\t\t\tawait this.onDidChangeWorkbenchState();\n\t\t\tawait this.onDidChangeWorkspaceFolders({ added: this.workspaceContextService.getWorkspace().folders, removed: [], changed: [] });\n\t\t\tthis._register(this.workspaceContextService.onDidChangeWorkspaceFolders(e => this.onDidChangeWorkspaceFolders(e)));\n\t\t\tthis._register(this.workspaceContextService.onDidChangeWorkbenchState(e => this.onDidChangeWorkbenchState()));\n\t\t} catch (error) {\n\t\t\tthis.logService.error('Failed to initialize workspace folders', error);\n\t\t}\n\t}\n\n\tprivate async onDidChangeWorkbenchState(): Promise<void> {\n\t\tif (this.workspaceConfiguration) {\n\t\t\tawait this.removeWorkspaceService(this.workspaceConfiguration);\n\t\t}\n\t\tthis.workspaceConfiguration = this.workspaceContextService.getWorkspace().configuration;\n\t\tif (this.workspaceConfiguration) {\n\t\t\tawait this.addWorkspaceService(this.workspaceConfiguration, ConfigurationTarget.WORKSPACE);\n\t\t}\n\t}\n\n\tprivate async onDidChangeWorkspaceFolders(e: IWorkspaceFoldersChangeEvent): Promise<void> {\n\t\ttry {\n\t\t\tawait Promise.allSettled(e.removed.map(folder => this.removeWorkspaceService(folder.toResource(WORKSPACE_STANDALONE_CONFIGURATIONS[MCP_CONFIGURATION_KEY]))));\n\t\t} catch (error) {\n\t\t\tthis.logService.error(error);\n\t\t}\n\t\ttry {\n\t\t\tawait Promise.allSettled(e.added.map(folder => this.addWorkspaceService(folder.toResource(WORKSPACE_STANDALONE_CONFIGURATIONS[MCP_CONFIGURATION_KEY]), ConfigurationTarget.WORKSPACE_FOLDER)));\n\t\t} catch (error) {\n\t\t\tthis.logService.error(error);\n\t\t}\n\t}\n\n\tprivate async addWorkspaceService(mcpResource: URI, target: McpResourceTarget): Promise<void> {\n\t\tif (this.workspaceMcpManagementServices.has(mcpResource)) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst disposables = new DisposableStore();\n\t\tconst service = disposables.add(this.instantiationService.createInstance(WorkspaceMcpResourceManagementService, mcpResource, target));\n\n\t\ttry {\n\t\t\tconst installedServers = await service.getInstalled();\n\t\t\tthis.allMcpServers.push(...installedServers);\n\t\t\tif (installedServers.length > 0) {\n\t\t\t\tconst installResults: InstallMcpServerResult[] = installedServers.map(server => ({\n\t\t\t\t\tname: server.name,\n\t\t\t\t\tlocal: server,\n\t\t\t\t\tmcpResource: server.mcpResource\n\t\t\t\t}));\n\t\t\t\tthis._onDidInstallMcpServers.fire(installResults);\n\t\t\t}\n\t\t} catch (error) {\n\t\t\tthis.logService.warn('Failed to get installed servers from', mcpResource.toString(), error);\n\t\t}\n\n\t\tdisposables.add(service.onInstallMcpServer(e => this._onInstallMcpServer.fire(e)));\n\t\tdisposables.add(service.onDidInstallMcpServers(e => {\n\t\t\tfor (const { local } of e) {\n\t\t\t\tif (local) {\n\t\t\t\t\tthis.allMcpServers.push(local);\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis._onDidInstallMcpServers.fire(e);\n\t\t}));\n\t\tdisposables.add(service.onDidUpdateMcpServers(e => {\n\t\t\tfor (const { local, mcpResource } of e) {\n\t\t\t\tif (local) {\n\t\t\t\t\tconst index = this.allMcpServers.findIndex(server => this.uriIdentityService.extUri.isEqual(server.mcpResource, mcpResource) && server.name === local.name);\n\t\t\t\t\tif (index !== -1) {\n\t\t\t\t\t\tthis.allMcpServers.splice(index, 1, local);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis._onDidUpdateMcpServers.fire(e);\n\t\t}));\n\t\tdisposables.add(service.onUninstallMcpServer(e => this._onUninstallMcpServer.fire(e)));\n\t\tdisposables.add(service.onDidUninstallMcpServer(e => {\n\t\t\tconst index = this.allMcpServers.findIndex(server => this.uriIdentityService.extUri.isEqual(server.mcpResource, e.mcpResource) && server.name === e.name);\n\t\t\tif (index !== -1) {\n\t\t\t\tthis.allMcpServers.splice(index, 1);\n\t\t\t\tthis._onDidUninstallMcpServer.fire(e);\n\t\t\t}\n\t\t}));\n\t\tthis.workspaceMcpManagementServices.set(mcpResource, { service, dispose: () => disposables.dispose() });\n\t}\n\n\tprivate async removeWorkspaceService(mcpResource: URI): Promise<void> {\n\t\tconst serviceItem = this.workspaceMcpManagementServices.get(mcpResource);\n\t\tif (serviceItem) {\n\t\t\ttry {\n\t\t\t\tconst installedServers = await serviceItem.service.getInstalled();\n\t\t\t\tthis.allMcpServers = this.allMcpServers.filter(server => !installedServers.some(uninstalled => this.uriIdentityService.extUri.isEqual(uninstalled.mcpResource, server.mcpResource)));\n\t\t\t\tfor (const server of installedServers) {\n\t\t\t\t\tthis._onDidUninstallMcpServer.fire({\n\t\t\t\t\t\tname: server.name,\n\t\t\t\t\t\tmcpResource: server.mcpResource\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t} catch (error) {\n\t\t\t\tthis.logService.warn('Failed to get installed servers from', mcpResource.toString(), error);\n\t\t\t}\n\t\t\tthis.workspaceMcpManagementServices.delete(mcpResource);\n\t\t\tserviceItem.dispose();\n\t\t}\n\t}\n\n\tasync getInstalled(): Promise<ILocalMcpServer[]> {\n\t\treturn this.allMcpServers;\n\t}\n\n\tasync install(server: IInstallableMcpServer, options?: InstallOptions): Promise<ILocalMcpServer> {\n\t\tif (!options?.mcpResource) {\n\t\t\tthrow new Error('MCP resource is required');\n\t\t}\n\n\t\tconst mcpManagementServiceItem = this.workspaceMcpManagementServices.get(options?.mcpResource);\n\t\tif (!mcpManagementServiceItem) {\n\t\t\tthrow new Error(`No MCP management service found for resource: ${options?.mcpResource.toString()}`);\n\t\t}\n\n\t\treturn mcpManagementServiceItem.service.install(server, options);\n\t}\n\n\tasync uninstall(server: ILocalMcpServer, options?: UninstallOptions): Promise<void> {\n\t\tconst mcpResource = server.mcpResource;\n\n\t\tconst mcpManagementServiceItem = this.workspaceMcpManagementServices.get(mcpResource);\n\t\tif (!mcpManagementServiceItem) {\n\t\t\tthrow new Error(`No MCP management service found for resource: ${mcpResource.toString()}`);\n\t\t}\n\n\t\treturn mcpManagementServiceItem.service.uninstall(server, options);\n\t}\n\n\tinstallFromGallery(gallery: IGalleryMcpServer, options?: InstallOptions): Promise<ILocalMcpServer> {\n\t\tif (!options?.mcpResource) {\n\t\t\tthrow new Error('MCP resource is required');\n\t\t}\n\n\t\tconst mcpManagementServiceItem = this.workspaceMcpManagementServices.get(options?.mcpResource);\n\t\tif (!mcpManagementServiceItem) {\n\t\t\tthrow new Error(`No MCP management service found for resource: ${options?.mcpResource.toString()}`);\n\t\t}\n\n\t\treturn mcpManagementServiceItem.service.installFromGallery(gallery, options);\n\t}\n\n\tupdateMetadata(): Promise<ILocalMcpServer> {\n\t\tthrow new Error('Not supported');\n\t}\n\n\toverride dispose(): void {\n\t\tthis.workspaceMcpManagementServices.forEach(service => service.dispose());\n\t\tthis.workspaceMcpManagementServices.clear();\n\t\tsuper.dispose();\n\t}\n}\n"]}