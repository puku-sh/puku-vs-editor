{"version":3,"sources":["vs/workbench/services/textMate/browser/textMateTokenizationFeatureImpl.ts"],"names":[],"mappings":"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","file":"textMateTokenizationFeatureImpl.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { canASAR, importAMDNodeModule, resolveAmdNodeModulePath } from '../../../../amdX.js';\nimport * as domStylesheets from '../../../../base/browser/domStylesheets.js';\nimport { equals as equalArray } from '../../../../base/common/arrays.js';\nimport { Color } from '../../../../base/common/color.js';\nimport { onUnexpectedError } from '../../../../base/common/errors.js';\nimport { Disposable, DisposableStore, IDisposable } from '../../../../base/common/lifecycle.js';\nimport { FileAccess, nodeModulesAsarUnpackedPath, nodeModulesPath } from '../../../../base/common/network.js';\nimport { IObservable, observableFromEvent } from '../../../../base/common/observable.js';\nimport { isWeb } from '../../../../base/common/platform.js';\nimport * as resources from '../../../../base/common/resources.js';\nimport * as types from '../../../../base/common/types.js';\nimport { URI } from '../../../../base/common/uri.js';\nimport { StandardTokenType } from '../../../../editor/common/encodedTokenAttributes.js';\nimport { ITokenizationSupport, LazyTokenizationSupport, TokenizationRegistry } from '../../../../editor/common/languages.js';\nimport { ILanguageService } from '../../../../editor/common/languages/language.js';\nimport { generateTokensCSSForColorMap } from '../../../../editor/common/languages/supports/tokenization.js';\nimport * as nls from '../../../../nls.js';\nimport { IConfigurationService } from '../../../../platform/configuration/common/configuration.js';\nimport { IExtensionResourceLoaderService } from '../../../../platform/extensionResourceLoader/common/extensionResourceLoader.js';\nimport { IInstantiationService } from '../../../../platform/instantiation/common/instantiation.js';\nimport { ILogService } from '../../../../platform/log/common/log.js';\nimport { INotificationService } from '../../../../platform/notification/common/notification.js';\nimport { IProgressService, ProgressLocation } from '../../../../platform/progress/common/progress.js';\nimport { ITelemetryService } from '../../../../platform/telemetry/common/telemetry.js';\nimport { IWorkbenchEnvironmentService } from '../../environment/common/environmentService.js';\nimport { ExtensionMessageCollector, IExtensionPointUser } from '../../extensions/common/extensionsRegistry.js';\nimport { ITextMateTokenizationService } from './textMateTokenizationFeature.js';\nimport { TextMateTokenizationSupport } from './tokenizationSupport/textMateTokenizationSupport.js';\nimport { TokenizationSupportWithLineLimit } from './tokenizationSupport/tokenizationSupportWithLineLimit.js';\nimport { ThreadedBackgroundTokenizerFactory } from './backgroundTokenization/threadedBackgroundTokenizerFactory.js';\nimport { TMGrammarFactory, missingTMGrammarErrorMessage } from '../common/TMGrammarFactory.js';\nimport { ITMSyntaxExtensionPoint, grammarsExtPoint } from '../common/TMGrammars.js';\nimport { IValidEmbeddedLanguagesMap, IValidGrammarDefinition, IValidTokenTypeMap } from '../common/TMScopeRegistry.js';\nimport { ITextMateThemingRule, IWorkbenchColorTheme, IWorkbenchThemeService } from '../../themes/common/workbenchThemeService.js';\nimport type { IGrammar, IOnigLib, IRawTheme } from 'vscode-textmate';\n\nexport class TextMateTokenizationFeature extends Disposable implements ITextMateTokenizationService {\n\tprivate static reportTokenizationTimeCounter = { sync: 0, async: 0 };\n\tpublic _serviceBrand: undefined;\n\n\tprivate readonly _styleElement: HTMLStyleElement;\n\tprivate readonly _createdModes: string[];\n\tprivate readonly _encounteredLanguages: boolean[];\n\n\tprivate _debugMode: boolean;\n\tprivate _debugModePrintFunc: (str: string) => void;\n\n\tprivate _grammarDefinitions: IValidGrammarDefinition[] | null;\n\tprivate _grammarFactory: TMGrammarFactory | null;\n\tprivate readonly _tokenizersRegistrations;\n\tprivate _currentTheme: IRawTheme | null;\n\tprivate _currentTokenColorMap: string[] | null;\n\tprivate readonly _threadedBackgroundTokenizerFactory;\n\n\tconstructor(\n\t\t@ILanguageService private readonly _languageService: ILanguageService,\n\t\t@IWorkbenchThemeService private readonly _themeService: IWorkbenchThemeService,\n\t\t@IExtensionResourceLoaderService private readonly _extensionResourceLoaderService: IExtensionResourceLoaderService,\n\t\t@INotificationService private readonly _notificationService: INotificationService,\n\t\t@ILogService private readonly _logService: ILogService,\n\t\t@IConfigurationService private readonly _configurationService: IConfigurationService,\n\t\t@IProgressService private readonly _progressService: IProgressService,\n\t\t@IWorkbenchEnvironmentService private readonly _environmentService: IWorkbenchEnvironmentService,\n\t\t@IInstantiationService private readonly _instantiationService: IInstantiationService,\n\t\t@ITelemetryService private readonly _telemetryService: ITelemetryService,\n\t) {\n\t\tsuper();\n\t\tthis._createdModes = [];\n\t\tthis._encounteredLanguages = [];\n\t\tthis._debugMode = false;\n\t\tthis._debugModePrintFunc = () => { };\n\t\tthis._grammarDefinitions = null;\n\t\tthis._grammarFactory = null;\n\t\tthis._tokenizersRegistrations = this._register(new DisposableStore());\n\t\tthis._currentTheme = null;\n\t\tthis._currentTokenColorMap = null;\n\t\tthis._threadedBackgroundTokenizerFactory = this._instantiationService.createInstance(\n\t\t\tThreadedBackgroundTokenizerFactory,\n\t\t\t(timeMs, languageId, sourceExtensionId, lineLength, isRandomSample) => this._reportTokenizationTime(timeMs, languageId, sourceExtensionId, lineLength, true, isRandomSample),\n\t\t\t() => this.getAsyncTokenizationEnabled(),\n\t\t);\n\t\tthis._vscodeOniguruma = null;\n\n\t\tthis._styleElement = domStylesheets.createStyleSheet();\n\t\tthis._styleElement.className = 'vscode-tokens-styles';\n\n\t\tgrammarsExtPoint.setHandler((extensions) => this._handleGrammarsExtPoint(extensions));\n\n\t\tthis._updateTheme(this._themeService.getColorTheme(), true);\n\t\tthis._register(this._themeService.onDidColorThemeChange(() => {\n\t\t\tthis._updateTheme(this._themeService.getColorTheme(), false);\n\t\t}));\n\n\t\tthis._register(this._languageService.onDidRequestRichLanguageFeatures((languageId) => {\n\t\t\tthis._createdModes.push(languageId);\n\t\t}));\n\t}\n\n\tprivate getAsyncTokenizationEnabled(): boolean {\n\t\treturn !!this._configurationService.getValue<boolean>('editor.experimental.asyncTokenization');\n\t}\n\n\tprivate getAsyncTokenizationVerification(): boolean {\n\t\treturn !!this._configurationService.getValue<boolean>('editor.experimental.asyncTokenizationVerification');\n\t}\n\n\tprivate _handleGrammarsExtPoint(extensions: readonly IExtensionPointUser<ITMSyntaxExtensionPoint[]>[]): void {\n\t\tthis._grammarDefinitions = null;\n\t\tif (this._grammarFactory) {\n\t\t\tthis._grammarFactory.dispose();\n\t\t\tthis._grammarFactory = null;\n\t\t}\n\t\tthis._tokenizersRegistrations.clear();\n\n\t\tthis._grammarDefinitions = [];\n\t\tfor (const extension of extensions) {\n\t\t\tconst grammars = extension.value;\n\t\t\tfor (const grammar of grammars) {\n\t\t\t\tconst validatedGrammar = this._validateGrammarDefinition(extension, grammar);\n\t\t\t\tif (validatedGrammar) {\n\t\t\t\t\tthis._grammarDefinitions.push(validatedGrammar);\n\t\t\t\t\tif (validatedGrammar.language) {\n\t\t\t\t\t\tconst lazyTokenizationSupport = new LazyTokenizationSupport(() => this._createTokenizationSupport(validatedGrammar.language!));\n\t\t\t\t\t\tthis._tokenizersRegistrations.add(lazyTokenizationSupport);\n\t\t\t\t\t\tthis._tokenizersRegistrations.add(TokenizationRegistry.registerFactory(validatedGrammar.language, lazyTokenizationSupport));\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tthis._threadedBackgroundTokenizerFactory.setGrammarDefinitions(this._grammarDefinitions);\n\n\t\tfor (const createdMode of this._createdModes) {\n\t\t\tTokenizationRegistry.getOrCreate(createdMode);\n\t\t}\n\t}\n\n\tprivate _validateGrammarDefinition(extension: IExtensionPointUser<ITMSyntaxExtensionPoint[]>, grammar: ITMSyntaxExtensionPoint): IValidGrammarDefinition | null {\n\t\tif (!validateGrammarExtensionPoint(extension.description.extensionLocation, grammar, extension.collector, this._languageService)) {\n\t\t\treturn null;\n\t\t}\n\n\t\tconst grammarLocation = resources.joinPath(extension.description.extensionLocation, grammar.path);\n\n\t\tconst embeddedLanguages: IValidEmbeddedLanguagesMap = Object.create(null);\n\t\tif (grammar.embeddedLanguages) {\n\t\t\tconst scopes = Object.keys(grammar.embeddedLanguages);\n\t\t\tfor (let i = 0, len = scopes.length; i < len; i++) {\n\t\t\t\tconst scope = scopes[i];\n\t\t\t\tconst language = grammar.embeddedLanguages[scope];\n\t\t\t\tif (typeof language !== 'string') {\n\t\t\t\t\t// never hurts to be too careful\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tif (this._languageService.isRegisteredLanguageId(language)) {\n\t\t\t\t\tembeddedLanguages[scope] = this._languageService.languageIdCodec.encodeLanguageId(language);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tconst tokenTypes: IValidTokenTypeMap = Object.create(null);\n\t\tif (grammar.tokenTypes) {\n\t\t\tconst scopes = Object.keys(grammar.tokenTypes);\n\t\t\tfor (const scope of scopes) {\n\t\t\t\tconst tokenType = grammar.tokenTypes[scope];\n\t\t\t\tswitch (tokenType) {\n\t\t\t\t\tcase 'string':\n\t\t\t\t\t\ttokenTypes[scope] = StandardTokenType.String;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'other':\n\t\t\t\t\t\ttokenTypes[scope] = StandardTokenType.Other;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'comment':\n\t\t\t\t\t\ttokenTypes[scope] = StandardTokenType.Comment;\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tconst validLanguageId = grammar.language && this._languageService.isRegisteredLanguageId(grammar.language) ? grammar.language : undefined;\n\n\t\tfunction asStringArray(array: unknown, defaultValue: string[]): string[] {\n\t\t\tif (!Array.isArray(array)) {\n\t\t\t\treturn defaultValue;\n\t\t\t}\n\t\t\tif (!array.every(e => typeof e === 'string')) {\n\t\t\t\treturn defaultValue;\n\t\t\t}\n\t\t\treturn array;\n\t\t}\n\n\t\treturn {\n\t\t\tlocation: grammarLocation,\n\t\t\tlanguage: validLanguageId,\n\t\t\tscopeName: grammar.scopeName,\n\t\t\tembeddedLanguages: embeddedLanguages,\n\t\t\ttokenTypes: tokenTypes,\n\t\t\tinjectTo: grammar.injectTo,\n\t\t\tbalancedBracketSelectors: asStringArray(grammar.balancedBracketScopes, ['*']),\n\t\t\tunbalancedBracketSelectors: asStringArray(grammar.unbalancedBracketScopes, []),\n\t\t\tsourceExtensionId: extension.description.id,\n\t\t};\n\t}\n\n\tpublic startDebugMode(printFn: (str: string) => void, onStop: () => void): void {\n\t\tif (this._debugMode) {\n\t\t\tthis._notificationService.error(nls.localize('alreadyDebugging', \"Already Logging.\"));\n\t\t\treturn;\n\t\t}\n\n\t\tthis._debugModePrintFunc = printFn;\n\t\tthis._debugMode = true;\n\n\t\tif (this._debugMode) {\n\t\t\tthis._progressService.withProgress(\n\t\t\t\t{\n\t\t\t\t\tlocation: ProgressLocation.Notification,\n\t\t\t\t\tbuttons: [nls.localize('stop', \"Stop\")]\n\t\t\t\t},\n\t\t\t\t(progress) => {\n\t\t\t\t\tprogress.report({\n\t\t\t\t\t\tmessage: nls.localize('progress1', \"Preparing to log TM Grammar parsing. Press Stop when finished.\")\n\t\t\t\t\t});\n\n\t\t\t\t\treturn this._getVSCodeOniguruma().then((vscodeOniguruma) => {\n\t\t\t\t\t\tvscodeOniguruma.setDefaultDebugCall(true);\n\t\t\t\t\t\tprogress.report({\n\t\t\t\t\t\t\tmessage: nls.localize('progress2', \"Now logging TM Grammar parsing. Press Stop when finished.\")\n\t\t\t\t\t\t});\n\t\t\t\t\t\treturn new Promise<void>((resolve, reject) => { });\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\t(choice) => {\n\t\t\t\t\tthis._getVSCodeOniguruma().then((vscodeOniguruma) => {\n\t\t\t\t\t\tthis._debugModePrintFunc = () => { };\n\t\t\t\t\t\tthis._debugMode = false;\n\t\t\t\t\t\tvscodeOniguruma.setDefaultDebugCall(false);\n\t\t\t\t\t\tonStop();\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\t}\n\n\tprivate _canCreateGrammarFactory(): boolean {\n\t\t// Check if extension point is ready\n\t\treturn !!this._grammarDefinitions;\n\t}\n\tprivate async _getOrCreateGrammarFactory(): Promise<TMGrammarFactory> {\n\t\tif (this._grammarFactory) {\n\t\t\treturn this._grammarFactory;\n\t\t}\n\n\t\tconst [vscodeTextmate, vscodeOniguruma] = await Promise.all([importAMDNodeModule<typeof import('vscode-textmate')>('vscode-textmate', 'release/main.js'), this._getVSCodeOniguruma()]);\n\t\tconst onigLib: Promise<IOnigLib> = Promise.resolve({\n\t\t\tcreateOnigScanner: (sources: string[]) => vscodeOniguruma.createOnigScanner(sources),\n\t\t\tcreateOnigString: (str: string) => vscodeOniguruma.createOnigString(str)\n\t\t});\n\n\t\t// Avoid duplicate instantiations\n\t\tif (this._grammarFactory) {\n\t\t\treturn this._grammarFactory;\n\t\t}\n\n\t\tthis._grammarFactory = new TMGrammarFactory({\n\t\t\tlogTrace: (msg: string) => this._logService.trace(msg),\n\t\t\tlogError: (msg: string, err: unknown) => this._logService.error(msg, err),\n\t\t\treadFile: (resource: URI) => this._extensionResourceLoaderService.readExtensionResource(resource)\n\t\t}, this._grammarDefinitions || [], vscodeTextmate, onigLib);\n\n\t\tthis._updateTheme(this._themeService.getColorTheme(), true);\n\n\t\treturn this._grammarFactory;\n\t}\n\n\tprivate async _createTokenizationSupport(languageId: string): Promise<ITokenizationSupport & IDisposable | null> {\n\t\tif (!this._languageService.isRegisteredLanguageId(languageId)) {\n\t\t\treturn null;\n\t\t}\n\t\tif (!this._canCreateGrammarFactory()) {\n\t\t\treturn null;\n\t\t}\n\n\t\ttry {\n\t\t\tconst grammarFactory = await this._getOrCreateGrammarFactory();\n\t\t\tif (!grammarFactory.has(languageId)) {\n\t\t\t\treturn null;\n\t\t\t}\n\t\t\tconst encodedLanguageId = this._languageService.languageIdCodec.encodeLanguageId(languageId);\n\t\t\tconst r = await grammarFactory.createGrammar(languageId, encodedLanguageId);\n\t\t\tif (!r.grammar) {\n\t\t\t\treturn null;\n\t\t\t}\n\t\t\tconst maxTokenizationLineLength = observableConfigValue<number>(\n\t\t\t\t'editor.maxTokenizationLineLength',\n\t\t\t\tlanguageId,\n\t\t\t\t-1,\n\t\t\t\tthis._configurationService\n\t\t\t);\n\t\t\tconst store = new DisposableStore();\n\t\t\tconst tokenization = store.add(new TextMateTokenizationSupport(\n\t\t\t\tr.grammar,\n\t\t\t\tr.initialState,\n\t\t\t\tr.containsEmbeddedLanguages,\n\t\t\t\t(textModel, tokenStore) => this._threadedBackgroundTokenizerFactory.createBackgroundTokenizer(textModel, tokenStore, maxTokenizationLineLength),\n\t\t\t\t() => this.getAsyncTokenizationVerification(),\n\t\t\t\t(timeMs, lineLength, isRandomSample) => {\n\t\t\t\t\tthis._reportTokenizationTime(timeMs, languageId, r.sourceExtensionId, lineLength, false, isRandomSample);\n\t\t\t\t},\n\t\t\t\ttrue,\n\t\t\t));\n\t\t\tstore.add(tokenization.onDidEncounterLanguage((encodedLanguageId) => {\n\t\t\t\tif (!this._encounteredLanguages[encodedLanguageId]) {\n\t\t\t\t\tconst languageId = this._languageService.languageIdCodec.decodeLanguageId(encodedLanguageId);\n\t\t\t\t\tthis._encounteredLanguages[encodedLanguageId] = true;\n\t\t\t\t\tthis._languageService.requestBasicLanguageFeatures(languageId);\n\t\t\t\t}\n\t\t\t}));\n\n\t\t\treturn new TokenizationSupportWithLineLimit(encodedLanguageId, tokenization, store, maxTokenizationLineLength);\n\t\t} catch (err) {\n\t\t\tif (err.message && err.message === missingTMGrammarErrorMessage) {\n\t\t\t\t// Don't log this error message\n\t\t\t\treturn null;\n\t\t\t}\n\t\t\tonUnexpectedError(err);\n\t\t\treturn null;\n\t\t}\n\t}\n\n\tprivate _updateTheme(colorTheme: IWorkbenchColorTheme, forceUpdate: boolean): void {\n\t\tif (!forceUpdate && this._currentTheme && this._currentTokenColorMap && equalsTokenRules(this._currentTheme.settings, colorTheme.tokenColors)\n\t\t\t&& equalArray(this._currentTokenColorMap, colorTheme.tokenColorMap)) {\n\t\t\treturn;\n\t\t}\n\t\tthis._currentTheme = { name: colorTheme.label, settings: colorTheme.tokenColors };\n\t\tthis._currentTokenColorMap = colorTheme.tokenColorMap;\n\n\t\tthis._grammarFactory?.setTheme(this._currentTheme, this._currentTokenColorMap);\n\t\tconst colorMap = toColorMap(this._currentTokenColorMap);\n\t\tconst cssRules = generateTokensCSSForColorMap(colorMap);\n\t\tthis._styleElement.textContent = cssRules;\n\t\tTokenizationRegistry.setColorMap(colorMap);\n\n\t\tif (this._currentTheme && this._currentTokenColorMap) {\n\t\t\tthis._threadedBackgroundTokenizerFactory.acceptTheme(this._currentTheme, this._currentTokenColorMap);\n\t\t}\n\t}\n\n\tpublic async createTokenizer(languageId: string): Promise<IGrammar | null> {\n\t\tif (!this._languageService.isRegisteredLanguageId(languageId)) {\n\t\t\treturn null;\n\t\t}\n\t\tconst grammarFactory = await this._getOrCreateGrammarFactory();\n\t\tif (!grammarFactory.has(languageId)) {\n\t\t\treturn null;\n\t\t}\n\t\tconst encodedLanguageId = this._languageService.languageIdCodec.encodeLanguageId(languageId);\n\t\tconst { grammar } = await grammarFactory.createGrammar(languageId, encodedLanguageId);\n\t\treturn grammar;\n\t}\n\n\tprivate _vscodeOniguruma: Promise<typeof import('vscode-oniguruma')> | null;\n\tprivate _getVSCodeOniguruma(): Promise<typeof import('vscode-oniguruma')> {\n\t\tif (!this._vscodeOniguruma) {\n\t\t\tthis._vscodeOniguruma = (async () => {\n\t\t\t\tconst [vscodeOniguruma, wasm] = await Promise.all([importAMDNodeModule<typeof import('vscode-oniguruma')>('vscode-oniguruma', 'release/main.js'), this._loadVSCodeOnigurumaWASM()]);\n\t\t\t\tawait vscodeOniguruma.loadWASM({\n\t\t\t\t\tdata: wasm,\n\t\t\t\t\tprint: (str: string) => {\n\t\t\t\t\t\tthis._debugModePrintFunc(str);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\treturn vscodeOniguruma;\n\t\t\t})();\n\t\t}\n\t\treturn this._vscodeOniguruma;\n\t}\n\n\tprivate async _loadVSCodeOnigurumaWASM(): Promise<Response | ArrayBuffer> {\n\t\tif (isWeb) {\n\t\t\tconst response = await fetch(resolveAmdNodeModulePath('vscode-oniguruma', 'release/onig.wasm'));\n\t\t\t// Using the response directly only works if the server sets the MIME type 'application/wasm'.\n\t\t\t// Otherwise, a TypeError is thrown when using the streaming compiler.\n\t\t\t// We therefore use the non-streaming compiler :(.\n\t\t\treturn await response.arrayBuffer();\n\t\t} else {\n\t\t\tconst response = await fetch(canASAR && this._environmentService.isBuilt\n\t\t\t\t? FileAccess.asBrowserUri(`${nodeModulesAsarUnpackedPath}/vscode-oniguruma/release/onig.wasm`).toString(true)\n\t\t\t\t: FileAccess.asBrowserUri(`${nodeModulesPath}/vscode-oniguruma/release/onig.wasm`).toString(true));\n\t\t\treturn response;\n\t\t}\n\t}\n\n\tprivate _reportTokenizationTime(timeMs: number, languageId: string, sourceExtensionId: string | undefined, lineLength: number, fromWorker: boolean, isRandomSample: boolean): void {\n\t\tconst key = fromWorker ? 'async' : 'sync';\n\n\t\t// 50 events per hour (one event has a low probability)\n\t\tif (TextMateTokenizationFeature.reportTokenizationTimeCounter[key] > 50) {\n\t\t\t// Don't flood telemetry with too many events\n\t\t\treturn;\n\t\t}\n\t\tif (TextMateTokenizationFeature.reportTokenizationTimeCounter[key] === 0) {\n\t\t\tsetTimeout(() => {\n\t\t\t\tTextMateTokenizationFeature.reportTokenizationTimeCounter[key] = 0;\n\t\t\t}, 1000 * 60 * 60);\n\t\t}\n\t\tTextMateTokenizationFeature.reportTokenizationTimeCounter[key]++;\n\n\t\tthis._telemetryService.publicLog2<{\n\t\t\ttimeMs: number;\n\t\t\tlanguageId: string;\n\t\t\tlineLength: number;\n\t\t\tfromWorker: boolean;\n\t\t\tsourceExtensionId: string | undefined;\n\t\t\tisRandomSample: boolean;\n\t\t\ttokenizationSetting: number;\n\t\t}, {\n\t\t\towner: 'hediet';\n\n\t\t\ttimeMs: { classification: 'SystemMetaData'; purpose: 'FeatureInsight'; comment: 'To understand how long it took to tokenize a random line' };\n\t\t\tlanguageId: { classification: 'SystemMetaData'; purpose: 'FeatureInsight'; comment: 'To relate the performance to the language' };\n\t\t\tlineLength: { classification: 'SystemMetaData'; purpose: 'FeatureInsight'; comment: 'To relate the performance to the line length' };\n\t\t\tfromWorker: { classification: 'SystemMetaData'; purpose: 'FeatureInsight'; comment: 'To figure out if this line was tokenized sync or async' };\n\t\t\tsourceExtensionId: { classification: 'SystemMetaData'; purpose: 'FeatureInsight'; comment: 'To figure out which extension contributed the grammar' };\n\t\t\tisRandomSample: { classification: 'SystemMetaData'; purpose: 'FeatureInsight'; comment: 'To figure out if this is a random sample or measured because of some other condition.' };\n\t\t\ttokenizationSetting: { classification: 'SystemMetaData'; purpose: 'FeatureInsight'; comment: 'To understand if the user has async tokenization enabled. 0=sync, 1=async, 2=verification' };\n\n\t\t\tcomment: 'This event gives insight about the performance certain grammars.';\n\t\t}>('editor.tokenizedLine', {\n\t\t\ttimeMs,\n\t\t\tlanguageId,\n\t\t\tlineLength,\n\t\t\tfromWorker,\n\t\t\tsourceExtensionId,\n\t\t\tisRandomSample,\n\t\t\ttokenizationSetting: this.getAsyncTokenizationEnabled() ? (this.getAsyncTokenizationVerification() ? 2 : 1) : 0,\n\t\t});\n\t}\n}\n\nfunction toColorMap(colorMap: string[]): Color[] {\n\tconst result: Color[] = [null!];\n\tfor (let i = 1, len = colorMap.length; i < len; i++) {\n\t\tresult[i] = Color.fromHex(colorMap[i]);\n\t}\n\treturn result;\n}\n\nfunction equalsTokenRules(a: ITextMateThemingRule[] | null, b: ITextMateThemingRule[] | null): boolean {\n\tif (!b || !a || b.length !== a.length) {\n\t\treturn false;\n\t}\n\tfor (let i = b.length - 1; i >= 0; i--) {\n\t\tconst r1 = b[i];\n\t\tconst r2 = a[i];\n\t\tif (r1.scope !== r2.scope) {\n\t\t\treturn false;\n\t\t}\n\t\tconst s1 = r1.settings;\n\t\tconst s2 = r2.settings;\n\t\tif (s1 && s2) {\n\t\t\tif (s1.fontStyle !== s2.fontStyle || s1.foreground !== s2.foreground || s1.background !== s2.background) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t} else if (!s1 || !s2) {\n\t\t\treturn false;\n\t\t}\n\t}\n\treturn true;\n}\n\nfunction validateGrammarExtensionPoint(extensionLocation: URI, syntax: ITMSyntaxExtensionPoint, collector: ExtensionMessageCollector, _languageService: ILanguageService): boolean {\n\tif (syntax.language && ((typeof syntax.language !== 'string') || !_languageService.isRegisteredLanguageId(syntax.language))) {\n\t\tcollector.error(nls.localize('invalid.language', \"Unknown language in `contributes.{0}.language`. Provided value: {1}\", grammarsExtPoint.name, String(syntax.language)));\n\t\treturn false;\n\t}\n\tif (!syntax.scopeName || (typeof syntax.scopeName !== 'string')) {\n\t\tcollector.error(nls.localize('invalid.scopeName', \"Expected string in `contributes.{0}.scopeName`. Provided value: {1}\", grammarsExtPoint.name, String(syntax.scopeName)));\n\t\treturn false;\n\t}\n\tif (!syntax.path || (typeof syntax.path !== 'string')) {\n\t\tcollector.error(nls.localize('invalid.path.0', \"Expected string in `contributes.{0}.path`. Provided value: {1}\", grammarsExtPoint.name, String(syntax.path)));\n\t\treturn false;\n\t}\n\tif (syntax.injectTo && (!Array.isArray(syntax.injectTo) || syntax.injectTo.some(scope => typeof scope !== 'string'))) {\n\t\tcollector.error(nls.localize('invalid.injectTo', \"Invalid value in `contributes.{0}.injectTo`. Must be an array of language scope names. Provided value: {1}\", grammarsExtPoint.name, JSON.stringify(syntax.injectTo)));\n\t\treturn false;\n\t}\n\tif (syntax.embeddedLanguages && !types.isObject(syntax.embeddedLanguages)) {\n\t\tcollector.error(nls.localize('invalid.embeddedLanguages', \"Invalid value in `contributes.{0}.embeddedLanguages`. Must be an object map from scope name to language. Provided value: {1}\", grammarsExtPoint.name, JSON.stringify(syntax.embeddedLanguages)));\n\t\treturn false;\n\t}\n\n\tif (syntax.tokenTypes && !types.isObject(syntax.tokenTypes)) {\n\t\tcollector.error(nls.localize('invalid.tokenTypes', \"Invalid value in `contributes.{0}.tokenTypes`. Must be an object map from scope name to token type. Provided value: {1}\", grammarsExtPoint.name, JSON.stringify(syntax.tokenTypes)));\n\t\treturn false;\n\t}\n\n\tconst grammarLocation = resources.joinPath(extensionLocation, syntax.path);\n\tif (!resources.isEqualOrParent(grammarLocation, extensionLocation)) {\n\t\tcollector.warn(nls.localize('invalid.path.1', \"Expected `contributes.{0}.path` ({1}) to be included inside extension's folder ({2}). This might make the extension non-portable.\", grammarsExtPoint.name, grammarLocation.path, extensionLocation.path));\n\t}\n\treturn true;\n}\n\nfunction observableConfigValue<T>(key: string, languageId: string, defaultValue: T, configurationService: IConfigurationService): IObservable<T> {\n\treturn observableFromEvent(\n\t\t(handleChange) => configurationService.onDidChangeConfiguration(e => {\n\t\t\tif (e.affectsConfiguration(key, { overrideIdentifier: languageId })) {\n\t\t\t\thandleChange(e);\n\t\t\t}\n\t\t}),\n\t\t() => configurationService.getValue<T>(key, { overrideIdentifier: languageId }) ?? defaultValue,\n\t);\n}\n"]}