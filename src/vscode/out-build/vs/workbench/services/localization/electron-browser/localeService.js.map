{"version":3,"sources":["vs/workbench/services/localization/electron-browser/localeService.ts"],"names":[],"mappings":"AAAA;;;gGAGgG;;;;;;;;;;AAEhG,OAAO,EAAE,QAAQ,EAAE,gBAAgB,EAAE,MAAM,qCAAqC,CAAC;AACjF,OAAO,EAAE,mBAAmB,EAAE,MAAM,wDAAwD,CAAC;AAC7F,OAAO,EAAE,oBAAoB,EAAE,QAAQ,EAAE,MAAM,0DAA0D,CAAC;AAC1G,OAAO,EAAE,mBAAmB,EAAE,MAAM,2CAA2C,CAAC;AAChF,OAAO,EAAE,0BAA0B,EAAE,cAAc,EAAE,MAAM,qBAAqB,CAAC;AACjF,OAAO,EAAqB,oBAAoB,EAAE,MAAM,4DAA4D,CAAC;AACrH,OAAO,EAAE,yBAAyB,EAAE,MAAM,8CAA8C,CAAC;AAEzF,OAAO,EAAE,2BAA2B,EAAE,MAAM,wEAAwE,CAAC;AACrH,OAAO,EAAE,gBAAgB,EAAoB,MAAM,kDAAkD,CAAC;AACtG,OAAO,EAAE,QAAQ,EAAE,MAAM,oBAAoB,CAAC;AAC9C,OAAO,EAAE,QAAQ,EAAE,MAAM,oCAAoC,CAAC;AAC9D,OAAO,EAAE,gBAAgB,EAAE,MAAM,oCAAoC,CAAC;AACtE,OAAO,EAAE,KAAK,EAAE,MAAM,kCAAkC,CAAC;AACzD,OAAO,EAAE,cAAc,EAAE,MAAM,sCAAsC,CAAC;AACtE,OAAO,EAAE,YAAY,EAAE,MAAM,4BAA4B,CAAC;AAC1D,OAAO,EAAE,cAAc,EAAE,MAAM,gDAAgD,CAAC;AAChF,OAAO,EAAE,eAAe,EAAE,MAAM,uDAAuD,CAAC;AACxF,OAAO,EAAqB,iBAAiB,EAAE,MAAM,yDAAyD,CAAC;AAS/G,gDAAgD;AAChD,MAAM,qBAAqB,GAAG,2BAA2B,CAAC;AAE1D,IAAM,mBAAmB,GAAzB,MAAM,mBAAmB;IAGxB,YACuC,kBAAuC,EACvC,kBAAuC,EACtC,mBAAyC,EACzC,mBAAyC,EACpC,wBAAmD,EACjD,0BAAuD,EAClE,eAAiC,EACjC,eAAiC,EACnC,aAA6B,EAC7B,aAA6B,EAC/B,WAAyB,EACtB,cAA+B;QAX3B,uBAAkB,GAAlB,kBAAkB,CAAqB;QACvC,uBAAkB,GAAlB,kBAAkB,CAAqB;QACtC,wBAAmB,GAAnB,mBAAmB,CAAsB;QACzC,wBAAmB,GAAnB,mBAAmB,CAAsB;QACpC,6BAAwB,GAAxB,wBAAwB,CAA2B;QACjD,+BAA0B,GAA1B,0BAA0B,CAA6B;QAClE,oBAAe,GAAf,eAAe,CAAkB;QACjC,oBAAe,GAAf,eAAe,CAAkB;QACnC,kBAAa,GAAb,aAAa,CAAgB;QAC7B,kBAAa,GAAb,aAAa,CAAgB;QAC/B,gBAAW,GAAX,WAAW,CAAc;QACtB,mBAAc,GAAd,cAAc,CAAiB;IAC9D,CAAC;IAEG,KAAK,CAAC,kBAAkB;QAC/B,IAAI,CAAC;YACJ,MAAM,OAAO,GAAG,MAAM,IAAI,CAAC,eAAe,CAAC,IAAI,CAAC,IAAI,CAAC,kBAAkB,CAAC,YAAY,EAAE,EAAE,QAAQ,EAAE,MAAM,EAAE,CAAC,CAAC;YAE5G,8EAA8E;YAC9E,0GAA0G;YAC1G,KAAK,CAAC,OAAO,CAAC,KAAK,CAAC,CAAC;QACtB,CAAC;QAAC,OAAO,KAAK,EAAE,CAAC;YAChB,IAAI,CAAC,mBAAmB,CAAC,MAAM,CAAC;gBAC/B,QAAQ,EAAE,QAAQ,CAAC,KAAK;gBACxB,OAAO,EAAE,QAAQ,CAAC,KAAa,EAAE,IAAkH,CAAC;gBACpJ,OAAO,EAAE;oBACR,OAAO,EAAE;wBACR,QAAQ,CAAC;4BACR,EAAE,EAAE,UAAU;4BACd,KAAK,EAAE,QAAQ,CAAC,KAAU,EAAE,IAAuB,CAAC;4BACpD,GAAG,EAAE,GAAG,EAAE,CAAC,IAAI,CAAC,aAAa,CAAC,UAAU,CAAC,EAAE,QAAQ,EAAE,IAAI,CAAC,kBAAkB,CAAC,YAAY,EAAE,CAAC;yBAC5F,CAAC;qBACF;iBACD;aACD,CAAC,CAAC;YACH,OAAO,KAAK,CAAC;QACd,CAAC;QACD,OAAO,IAAI,CAAC;IACb,CAAC;IAEO,KAAK,CAAC,gBAAgB,CAAC,MAA0B;QACxD,IAAI,CAAC,CAAC,MAAM,IAAI,CAAC,kBAAkB,EAAE,CAAC,EAAE,CAAC;YACxC,OAAO,KAAK,CAAC;QACd,CAAC;QACD,MAAM,IAAI,CAAC,kBAAkB,CAAC,KAAK,CAAC,IAAI,CAAC,kBAAkB,CAAC,YAAY,EAAE,CAAC,EAAE,IAAI,EAAE,CAAC,QAAQ,CAAC,EAAE,KAAK,EAAE,MAAM,EAAE,CAAC,EAAE,IAAI,CAAC,CAAC;QACvH,OAAO,IAAI,CAAC;IACb,CAAC;IAED,KAAK,CAAC,SAAS,CAAC,gBAAmC,EAAE,UAAU,GAAG,KAAK;QACtE,MAAM,MAAM,GAAG,gBAAgB,CAAC,EAAE,CAAC;QACnC,IAAI,MAAM,KAAK,QAAQ,CAAC,KAAK,EAAE,IAAI,CAAC,CAAC,MAAM,IAAI,QAAQ,CAAC,gBAAgB,EAAE,CAAC,EAAE,CAAC;YAC7E,OAAO;QACR,CAAC;QACD,MAAM,kBAAkB,GAAG,MAAM,IAAI,CAAC,mBAAmB,CAAC,qBAAqB,EAAE,CAAC;QAClF,IAAI,CAAC;YAEJ,2FAA2F;YAC3F,iDAAiD;YACjD,IAAI,CAAC,kBAAkB,CAAC,IAAI,CAAC,iBAAiB,CAAC,EAAE,CAAC,iBAAiB,CAAC,EAAE,KAAK,gBAAgB,CAAC,EAAE,CAAC,EAAE,CAAC;gBAEjG,uDAAuD;gBACvD,IAAI,gBAAgB,CAAC,gBAAgB,EAAE,SAAS,CAAC,WAAW,EAAE,KAAK,WAAW,EAAE,CAAC;oBAChF,+EAA+E;oBAC/E,iFAAiF;oBACjF,MAAM,OAAO,GAAG,MAAM,IAAI,CAAC,wBAAwB,CAAC,iBAAiB,CAAC,qBAAqB,wCAAgC,CAAC;oBAC5H,CAAC,OAAO,EAAE,oBAAoB,EAAmC,CAAA,CAAC,MAAM,CAAC,OAAO,gBAAgB,CAAC,WAAW,EAAE,CAAC,CAAC;oBAChH,OAAO;gBACR,CAAC;gBAED,MAAM,IAAI,CAAC,eAAe,CAAC,YAAY,CACtC;oBACC,QAAQ,wCAA+B;oBACvC,KAAK,EAAE,QAAQ,CAAC,KAAY,EAAE,IAAoC,EAAE,gBAAgB,CAAC,KAAK,CAAC;iBAC3F,EACD,QAAQ,CAAC,EAAE,CAAC,IAAI,CAAC,0BAA0B,CAAC,kBAAkB,CAAC,gBAAgB,CAAC,gBAAiB,EAAE;oBAClG,mGAAmG;oBACnG,eAAe,EAAE,KAAK;iBACtB,CAAC,CACF,CAAC;YACH,CAAC;YAED,IAAI,CAAC,UAAU,IAAI,CAAC,MAAM,IAAI,CAAC,iBAAiB,CAAC,gBAAgB,CAAC,KAAK,CAAC,EAAE,CAAC;gBAC1E,OAAO;YACR,CAAC;YACD,MAAM,IAAI,CAAC,gBAAgB,CAAC,MAAM,CAAC,CAAC;YACpC,MAAM,IAAI,CAAC,WAAW,CAAC,OAAO,EAAE,CAAC;QAClC,CAAC;QAAC,OAAO,GAAG,EAAE,CAAC;YACd,IAAI,CAAC,mBAAmB,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC;QACrC,CAAC;IACF,CAAC;IAED,KAAK,CAAC,qBAAqB;QAC1B,IAAI,CAAC;YACJ,MAAM,IAAI,CAAC,gBAAgB,CAAC,SAAS,CAAC,CAAC;YACvC,IAAI,CAAC,QAAQ,CAAC,gBAAgB,EAAE,EAAE,CAAC;gBAClC,MAAM,IAAI,CAAC,iBAAiB,CAAC,SAAS,CAAC,CAAC;YACzC,CAAC;QACF,CAAC;QAAC,OAAO,GAAG,EAAE,CAAC;YACd,IAAI,CAAC,mBAAmB,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC;QACrC,CAAC;IACF,CAAC;IAEO,KAAK,CAAC,iBAAiB,CAAC,YAAoB;QACnD,MAAM,EAAE,SAAS,EAAE,GAAG,MAAM,IAAI,CAAC,aAAa,CAAC,OAAO,CAAC;YACtD,OAAO,EAAE,QAAQ,CAAC,KAAgC,EAAE,IAA+B,EAAE,IAAI,CAAC,cAAc,CAAC,QAAQ,EAAE,YAAY,CAAC;YAChI,MAAM,EAAE,QAAQ,CACf,KAA+B,EAC/B,IAA8D,EAC9D,YAAY,EACZ,IAAI,CAAC,cAAc,CAAC,QAAQ,CAC5B;YACD,aAAa,EAAE,QAAQ,CAAC,EAAE,GAAG,AAA2D,EAAzD,AAA2D,IAAW,CAAC,IAA9D,EAAE,OAAO,EAAE,CAAC,iCAAiC,CAAC;SACtF,CAAC,CAAC;QAEH,OAAO,SAAS,CAAC;IAClB,CAAC;CACD,CAAA;AAxHK,mBAAmB;IAItB,WAAA,mBAAmB,CAAA;IACnB,WAAA,mBAAmB,CAAA;IACnB,WAAA,oBAAoB,CAAA;IACpB,WAAA,oBAAoB,CAAA;IACpB,WAAA,yBAAyB,CAAA;IACzB,WAAA,2BAA2B,CAAA;IAC3B,WAAA,gBAAgB,CAAA;IAChB,WAAA,gBAAgB,CAAA;IAChB,WAAA,cAAc,CAAA;IACd,WAAA,cAAc,CAAA;IACd,YAAA,YAAY,CAAA;IACZ,YAAA,eAAe,CAAA;GAfZ,mBAAmB,CAwHxB;AAED,sHAAsH;AACtH,mEAAmE;AACnE,IAAM,+BAA+B,GAArC,MAAM,+BAA+B;IAGpC,YACwC,mBAAyC;QAAzC,wBAAmB,GAAnB,mBAAmB,CAAsB;IAC7E,CAAC;IAEL,KAAK,CAAC,oCAAoC;QACzC,MAAM,QAAQ,GAAG,QAAQ,CAAC,KAAK,EAAE,CAAC;QAClC,IAAI,QAAQ,KAAK,gBAAgB,EAAE,CAAC;YACnC,OAAO,SAAS,CAAC;QAClB,CAAC;QACD,MAAM,SAAS,GAAG,MAAM,IAAI,CAAC,mBAAmB,CAAC,qBAAqB,EAAE,CAAC;QACzE,MAAM,YAAY,GAAG,SAAS,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,EAAE,KAAK,QAAQ,CAAC,CAAC;QAC5D,OAAO,YAAY,EAAE,WAAW,CAAC;IAClC,CAAC;CACD,CAAA;AAhBK,+BAA+B;IAIlC,WAAA,oBAAoB,CAAA;GAJjB,+BAA+B,CAgBpC;AAED,iBAAiB,CAAC,cAAc,EAAE,mBAAmB,oCAA4B,CAAC;AAClF,iBAAiB,CAAC,0BAA0B,EAAE,+BAA+B,oCAA4B,CAAC","file":"localeService.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Language, LANGUAGE_DEFAULT } from '../../../../base/common/platform.js';\nimport { IEnvironmentService } from '../../../../platform/environment/common/environment.js';\nimport { INotificationService, Severity } from '../../../../platform/notification/common/notification.js';\nimport { IJSONEditingService } from '../../configuration/common/jsonEditing.js';\nimport { IActiveLanguagePackService, ILocaleService } from '../common/locale.js';\nimport { ILanguagePackItem, ILanguagePackService } from '../../../../platform/languagePacks/common/languagePacks.js';\nimport { IPaneCompositePartService } from '../../panecomposite/browser/panecomposite.js';\nimport { IViewPaneContainer, ViewContainerLocation } from '../../../common/views.js';\nimport { IExtensionManagementService } from '../../../../platform/extensionManagement/common/extensionManagement.js';\nimport { IProgressService, ProgressLocation } from '../../../../platform/progress/common/progress.js';\nimport { localize } from '../../../../nls.js';\nimport { toAction } from '../../../../base/common/actions.js';\nimport { ITextFileService } from '../../textfile/common/textfiles.js';\nimport { parse } from '../../../../base/common/jsonc.js';\nimport { IEditorService } from '../../editor/common/editorService.js';\nimport { IHostService } from '../../host/browser/host.js';\nimport { IDialogService } from '../../../../platform/dialogs/common/dialogs.js';\nimport { IProductService } from '../../../../platform/product/common/productService.js';\nimport { InstantiationType, registerSingleton } from '../../../../platform/instantiation/common/extensions.js';\n\n// duplicate of IExtensionsViewPaneContainer in contrib\ninterface IExtensionsViewPaneContainer extends IViewPaneContainer {\n\treadonly searchValue: string | undefined;\n\tsearch(text: string): void;\n\trefresh(): Promise<void>;\n}\n\n// duplicate of VIEWLET_ID in contrib/extensions\nconst EXTENSIONS_VIEWLET_ID = 'workbench.view.extensions';\n\nclass NativeLocaleService implements ILocaleService {\n\t_serviceBrand: undefined;\n\n\tconstructor(\n\t\t@IJSONEditingService private readonly jsonEditingService: IJSONEditingService,\n\t\t@IEnvironmentService private readonly environmentService: IEnvironmentService,\n\t\t@INotificationService private readonly notificationService: INotificationService,\n\t\t@ILanguagePackService private readonly languagePackService: ILanguagePackService,\n\t\t@IPaneCompositePartService private readonly paneCompositePartService: IPaneCompositePartService,\n\t\t@IExtensionManagementService private readonly extensionManagementService: IExtensionManagementService,\n\t\t@IProgressService private readonly progressService: IProgressService,\n\t\t@ITextFileService private readonly textFileService: ITextFileService,\n\t\t@IEditorService private readonly editorService: IEditorService,\n\t\t@IDialogService private readonly dialogService: IDialogService,\n\t\t@IHostService private readonly hostService: IHostService,\n\t\t@IProductService private readonly productService: IProductService\n\t) { }\n\n\tprivate async validateLocaleFile(): Promise<boolean> {\n\t\ttry {\n\t\t\tconst content = await this.textFileService.read(this.environmentService.argvResource, { encoding: 'utf8' });\n\n\t\t\t// This is the same logic that we do where argv.json is parsed so mirror that:\n\t\t\t// https://github.com/microsoft/vscode/blob/32d40cf44e893e87ac33ac4f08de1e5f7fe077fc/src/main.js#L238-L246\n\t\t\tparse(content.value);\n\t\t} catch (error) {\n\t\t\tthis.notificationService.notify({\n\t\t\t\tseverity: Severity.Error,\n\t\t\t\tmessage: localize('argvInvalid', 'Unable to write display language. Please open the runtime settings, correct errors/warnings in it and try again.'),\n\t\t\t\tactions: {\n\t\t\t\t\tprimary: [\n\t\t\t\t\t\ttoAction({\n\t\t\t\t\t\t\tid: 'openArgv',\n\t\t\t\t\t\t\tlabel: localize('openArgv', \"Open Runtime Settings\"),\n\t\t\t\t\t\t\trun: () => this.editorService.openEditor({ resource: this.environmentService.argvResource })\n\t\t\t\t\t\t})\n\t\t\t\t\t]\n\t\t\t\t}\n\t\t\t});\n\t\t\treturn false;\n\t\t}\n\t\treturn true;\n\t}\n\n\tprivate async writeLocaleValue(locale: string | undefined): Promise<boolean> {\n\t\tif (!(await this.validateLocaleFile())) {\n\t\t\treturn false;\n\t\t}\n\t\tawait this.jsonEditingService.write(this.environmentService.argvResource, [{ path: ['locale'], value: locale }], true);\n\t\treturn true;\n\t}\n\n\tasync setLocale(languagePackItem: ILanguagePackItem, skipDialog = false): Promise<void> {\n\t\tconst locale = languagePackItem.id;\n\t\tif (locale === Language.value() || (!locale && Language.isDefaultVariant())) {\n\t\t\treturn;\n\t\t}\n\t\tconst installedLanguages = await this.languagePackService.getInstalledLanguages();\n\t\ttry {\n\n\t\t\t// Only Desktop has the concept of installing language packs so we only do this for Desktop\n\t\t\t// and only if the language pack is not installed\n\t\t\tif (!installedLanguages.some(installedLanguage => installedLanguage.id === languagePackItem.id)) {\n\n\t\t\t\t// Only actually install a language pack from Microsoft\n\t\t\t\tif (languagePackItem.galleryExtension?.publisher.toLowerCase() !== 'ms-ceintl') {\n\t\t\t\t\t// Show the view so the user can see the language pack that they should install\n\t\t\t\t\t// as of now, there are no 3rd party language packs available on the Marketplace.\n\t\t\t\t\tconst viewlet = await this.paneCompositePartService.openPaneComposite(EXTENSIONS_VIEWLET_ID, ViewContainerLocation.Sidebar);\n\t\t\t\t\t(viewlet?.getViewPaneContainer() as IExtensionsViewPaneContainer).search(`@id:${languagePackItem.extensionId}`);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tawait this.progressService.withProgress(\n\t\t\t\t\t{\n\t\t\t\t\t\tlocation: ProgressLocation.Notification,\n\t\t\t\t\t\ttitle: localize('installing', \"Installing {0} language support...\", languagePackItem.label),\n\t\t\t\t\t},\n\t\t\t\t\tprogress => this.extensionManagementService.installFromGallery(languagePackItem.galleryExtension!, {\n\t\t\t\t\t\t// Setting this to false is how you get the extension to be synced with Settings Sync (if enabled).\n\t\t\t\t\t\tisMachineScoped: false,\n\t\t\t\t\t})\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tif (!skipDialog && !await this.showRestartDialog(languagePackItem.label)) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tawait this.writeLocaleValue(locale);\n\t\t\tawait this.hostService.restart();\n\t\t} catch (err) {\n\t\t\tthis.notificationService.error(err);\n\t\t}\n\t}\n\n\tasync clearLocalePreference(): Promise<void> {\n\t\ttry {\n\t\t\tawait this.writeLocaleValue(undefined);\n\t\t\tif (!Language.isDefaultVariant()) {\n\t\t\t\tawait this.showRestartDialog('English');\n\t\t\t}\n\t\t} catch (err) {\n\t\t\tthis.notificationService.error(err);\n\t\t}\n\t}\n\n\tprivate async showRestartDialog(languageName: string): Promise<boolean> {\n\t\tconst { confirmed } = await this.dialogService.confirm({\n\t\t\tmessage: localize('restartDisplayLanguageMessage1', \"Restart {0} to switch to {1}?\", this.productService.nameLong, languageName),\n\t\t\tdetail: localize(\n\t\t\t\t'restartDisplayLanguageDetail1',\n\t\t\t\t\"To change the display language to {0}, {1} needs to restart.\",\n\t\t\t\tlanguageName,\n\t\t\t\tthis.productService.nameLong\n\t\t\t),\n\t\t\tprimaryButton: localize({ key: 'restart', comment: ['&& denotes a mnemonic character'] }, \"&&Restart\"),\n\t\t});\n\n\t\treturn confirmed;\n\t}\n}\n\n// This is its own service because the localeService depends on IJSONEditingService which causes a circular dependency\n// Once that's ironed out, we can fold this into the localeService.\nclass NativeActiveLanguagePackService implements IActiveLanguagePackService {\n\t_serviceBrand: undefined;\n\n\tconstructor(\n\t\t@ILanguagePackService private readonly languagePackService: ILanguagePackService\n\t) { }\n\n\tasync getExtensionIdProvidingCurrentLocale(): Promise<string | undefined> {\n\t\tconst language = Language.value();\n\t\tif (language === LANGUAGE_DEFAULT) {\n\t\t\treturn undefined;\n\t\t}\n\t\tconst languages = await this.languagePackService.getInstalledLanguages();\n\t\tconst languagePack = languages.find(l => l.id === language);\n\t\treturn languagePack?.extensionId;\n\t}\n}\n\nregisterSingleton(ILocaleService, NativeLocaleService, InstantiationType.Delayed);\nregisterSingleton(IActiveLanguagePackService, NativeActiveLanguagePackService, InstantiationType.Delayed);\n"]}