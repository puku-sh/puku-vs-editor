{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/services/aiRelatedInformation/common/aiRelatedInformationService.ts","vs/workbench/services/aiRelatedInformation/common/aiRelatedInformationService.ts"],"names":[],"mappings":"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","file":"aiRelatedInformationService.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { CancellationToken } from '../../../../base/common/cancellation.js';\nimport { CancelablePromise, createCancelablePromise, raceTimeout } from '../../../../base/common/async.js';\nimport { IDisposable } from '../../../../base/common/lifecycle.js';\nimport { InstantiationType, registerSingleton } from '../../../../platform/instantiation/common/extensions.js';\nimport { StopWatch } from '../../../../base/common/stopwatch.js';\nimport { ILogService } from '../../../../platform/log/common/log.js';\nimport { IAiRelatedInformationService, IAiRelatedInformationProvider, RelatedInformationType, RelatedInformationResult } from './aiRelatedInformation.js';\n\nexport class AiRelatedInformationService implements IAiRelatedInformationService {\n\treadonly _serviceBrand: undefined;\n\n\tstatic readonly DEFAULT_TIMEOUT = 1000 * 10; // 10 seconds\n\n\tprivate readonly _providers: Map<RelatedInformationType, IAiRelatedInformationProvider[]> = new Map();\n\n\tconstructor(@ILogService private readonly logService: ILogService) { }\n\n\tisEnabled(): boolean {\n\t\treturn this._providers.size > 0;\n\t}\n\n\tregisterAiRelatedInformationProvider(type: RelatedInformationType, provider: IAiRelatedInformationProvider): IDisposable {\n\t\tconst providers = this._providers.get(type) ?? [];\n\t\tproviders.push(provider);\n\t\tthis._providers.set(type, providers);\n\n\n\t\treturn {\n\t\t\tdispose: () => {\n\t\t\t\tconst providers = this._providers.get(type) ?? [];\n\t\t\t\tconst index = providers.indexOf(provider);\n\t\t\t\tif (index !== -1) {\n\t\t\t\t\tproviders.splice(index, 1);\n\t\t\t\t}\n\t\t\t\tif (providers.length === 0) {\n\t\t\t\t\tthis._providers.delete(type);\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t}\n\n\tasync getRelatedInformation(query: string, types: RelatedInformationType[], token: CancellationToken): Promise<RelatedInformationResult[]> {\n\t\tif (this._providers.size === 0) {\n\t\t\tthrow new Error('No related information providers registered');\n\t\t}\n\n\t\t// get providers for each type\n\t\tconst providers: IAiRelatedInformationProvider[] = [];\n\t\tfor (const type of types) {\n\t\t\tconst typeProviders = this._providers.get(type);\n\t\t\tif (typeProviders) {\n\t\t\t\tproviders.push(...typeProviders);\n\t\t\t}\n\t\t}\n\n\t\tif (providers.length === 0) {\n\t\t\tthrow new Error('No related information providers registered for the given types');\n\t\t}\n\n\t\tconst stopwatch = StopWatch.create();\n\n\t\tconst cancellablePromises: Array<CancelablePromise<RelatedInformationResult[]>> = providers.map((provider) => {\n\t\t\treturn createCancelablePromise(async t => {\n\t\t\t\ttry {\n\t\t\t\t\tconst result = await provider.provideAiRelatedInformation(query, t);\n\t\t\t\t\t// double filter just in case\n\t\t\t\t\treturn result.filter(r => types.includes(r.type));\n\t\t\t\t} catch (e) {\n\t\t\t\t\t// logged in extension host\n\t\t\t\t}\n\t\t\t\treturn [];\n\t\t\t});\n\t\t});\n\n\t\ttry {\n\t\t\tconst results = await raceTimeout(\n\t\t\t\tPromise.allSettled(cancellablePromises),\n\t\t\t\tAiRelatedInformationService.DEFAULT_TIMEOUT,\n\t\t\t\t() => {\n\t\t\t\t\tcancellablePromises.forEach(p => p.cancel());\n\t\t\t\t\tthis.logService.warn('[AiRelatedInformationService]: Related information provider timed out');\n\t\t\t\t}\n\t\t\t);\n\t\t\tif (!results) {\n\t\t\t\treturn [];\n\t\t\t}\n\t\t\tconst result = results\n\t\t\t\t.filter(r => r.status === 'fulfilled')\n\t\t\t\t.flatMap(r => (r as PromiseFulfilledResult<RelatedInformationResult[]>).value);\n\t\t\treturn result;\n\t\t} finally {\n\t\t\tstopwatch.stop();\n\t\t\tthis.logService.trace(`[AiRelatedInformationService]: getRelatedInformation took ${stopwatch.elapsed()}ms`);\n\t\t}\n\t}\n}\n\nregisterSingleton(IAiRelatedInformationService, AiRelatedInformationService, InstantiationType.Delayed);\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { CancellationToken } from '../../../../base/common/cancellation.js';\nimport { CancelablePromise, createCancelablePromise, raceTimeout } from '../../../../base/common/async.js';\nimport { IDisposable } from '../../../../base/common/lifecycle.js';\nimport { InstantiationType, registerSingleton } from '../../../../platform/instantiation/common/extensions.js';\nimport { StopWatch } from '../../../../base/common/stopwatch.js';\nimport { ILogService } from '../../../../platform/log/common/log.js';\nimport { IAiRelatedInformationService, IAiRelatedInformationProvider, RelatedInformationType, RelatedInformationResult } from './aiRelatedInformation.js';\n\nexport class AiRelatedInformationService implements IAiRelatedInformationService {\n\treadonly _serviceBrand: undefined;\n\n\tstatic readonly DEFAULT_TIMEOUT = 1000 * 10; // 10 seconds\n\n\tprivate readonly _providers: Map<RelatedInformationType, IAiRelatedInformationProvider[]> = new Map();\n\n\tconstructor(@ILogService private readonly logService: ILogService) { }\n\n\tisEnabled(): boolean {\n\t\treturn this._providers.size > 0;\n\t}\n\n\tregisterAiRelatedInformationProvider(type: RelatedInformationType, provider: IAiRelatedInformationProvider): IDisposable {\n\t\tconst providers = this._providers.get(type) ?? [];\n\t\tproviders.push(provider);\n\t\tthis._providers.set(type, providers);\n\n\n\t\treturn {\n\t\t\tdispose: () => {\n\t\t\t\tconst providers = this._providers.get(type) ?? [];\n\t\t\t\tconst index = providers.indexOf(provider);\n\t\t\t\tif (index !== -1) {\n\t\t\t\t\tproviders.splice(index, 1);\n\t\t\t\t}\n\t\t\t\tif (providers.length === 0) {\n\t\t\t\t\tthis._providers.delete(type);\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t}\n\n\tasync getRelatedInformation(query: string, types: RelatedInformationType[], token: CancellationToken): Promise<RelatedInformationResult[]> {\n\t\tif (this._providers.size === 0) {\n\t\t\tthrow new Error('No related information providers registered');\n\t\t}\n\n\t\t// get providers for each type\n\t\tconst providers: IAiRelatedInformationProvider[] = [];\n\t\tfor (const type of types) {\n\t\t\tconst typeProviders = this._providers.get(type);\n\t\t\tif (typeProviders) {\n\t\t\t\tproviders.push(...typeProviders);\n\t\t\t}\n\t\t}\n\n\t\tif (providers.length === 0) {\n\t\t\tthrow new Error('No related information providers registered for the given types');\n\t\t}\n\n\t\tconst stopwatch = StopWatch.create();\n\n\t\tconst cancellablePromises: Array<CancelablePromise<RelatedInformationResult[]>> = providers.map((provider) => {\n\t\t\treturn createCancelablePromise(async t => {\n\t\t\t\ttry {\n\t\t\t\t\tconst result = await provider.provideAiRelatedInformation(query, t);\n\t\t\t\t\t// double filter just in case\n\t\t\t\t\treturn result.filter(r => types.includes(r.type));\n\t\t\t\t} catch (e) {\n\t\t\t\t\t// logged in extension host\n\t\t\t\t}\n\t\t\t\treturn [];\n\t\t\t});\n\t\t});\n\n\t\ttry {\n\t\t\tconst results = await raceTimeout(\n\t\t\t\tPromise.allSettled(cancellablePromises),\n\t\t\t\tAiRelatedInformationService.DEFAULT_TIMEOUT,\n\t\t\t\t() => {\n\t\t\t\t\tcancellablePromises.forEach(p => p.cancel());\n\t\t\t\t\tthis.logService.warn('[AiRelatedInformationService]: Related information provider timed out');\n\t\t\t\t}\n\t\t\t);\n\t\t\tif (!results) {\n\t\t\t\treturn [];\n\t\t\t}\n\t\t\tconst result = results\n\t\t\t\t.filter(r => r.status === 'fulfilled')\n\t\t\t\t.flatMap(r => (r as PromiseFulfilledResult<RelatedInformationResult[]>).value);\n\t\t\treturn result;\n\t\t} finally {\n\t\t\tstopwatch.stop();\n\t\t\tthis.logService.trace(`[AiRelatedInformationService]: getRelatedInformation took ${stopwatch.elapsed()}ms`);\n\t\t}\n\t}\n}\n\nregisterSingleton(IAiRelatedInformationService, AiRelatedInformationService, InstantiationType.Delayed);\n"]}