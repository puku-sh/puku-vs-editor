{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/services/untitled/common/untitledTextEditorService.ts","vs/workbench/services/untitled/common/untitledTextEditorService.ts"],"names":[],"mappings":"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","file":"untitledTextEditorService.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { URI } from '../../../../base/common/uri.js';\nimport { createDecorator, IInstantiationService } from '../../../../platform/instantiation/common/instantiation.js';\nimport { UntitledTextEditorModel, IUntitledTextEditorModel } from './untitledTextEditorModel.js';\nimport { IFilesConfiguration } from '../../../../platform/files/common/files.js';\nimport { IConfigurationService } from '../../../../platform/configuration/common/configuration.js';\nimport { Event, Emitter } from '../../../../base/common/event.js';\nimport { ResourceMap } from '../../../../base/common/map.js';\nimport { Schemas } from '../../../../base/common/network.js';\nimport { Disposable, DisposableStore } from '../../../../base/common/lifecycle.js';\nimport { InstantiationType, registerSingleton } from '../../../../platform/instantiation/common/extensions.js';\n\nexport const IUntitledTextEditorService = createDecorator<IUntitledTextEditorService>('untitledTextEditorService');\n\nexport interface INewUntitledTextEditorOptions {\n\n\t/**\n\t * Initial value of the untitled editor. An untitled editor with initial\n\t * value is dirty right from the beginning.\n\t */\n\tinitialValue?: string;\n\n\t/**\n\t * Preferred language id to use when saving the untitled editor.\n\t */\n\tlanguageId?: string;\n\n\t/**\n\t * Preferred encoding to use when saving the untitled editor.\n\t */\n\tencoding?: string;\n}\n\nexport interface IExistingUntitledTextEditorOptions extends INewUntitledTextEditorOptions {\n\n\t/**\n\t * A resource to identify the untitled editor to create or return\n\t * if already existing.\n\t *\n\t * Note: the resource will not be used unless the scheme is `untitled`.\n\t */\n\tuntitledResource?: URI;\n}\n\nexport interface INewUntitledTextEditorWithAssociatedResourceOptions extends INewUntitledTextEditorOptions {\n\n\t/**\n\t * Resource components to associate with the untitled editor. When saving\n\t * the untitled editor, the associated components will be used and the user\n\t * is not being asked to provide a file path.\n\t *\n\t * Note: currently it is not possible to specify the `scheme` to use. The\n\t * untitled editor will saved to the default local or remote resource.\n\t */\n\tassociatedResource?: { authority: string; path: string; query: string; fragment: string };\n}\n\ntype IInternalUntitledTextEditorOptions = IExistingUntitledTextEditorOptions & INewUntitledTextEditorWithAssociatedResourceOptions;\n\nexport interface IUntitledTextEditorModelSaveEvent {\n\n\t/**\n\t * The source untitled file that was saved. It is disposed at this point.\n\t */\n\treadonly source: URI;\n\n\t/**\n\t * The target file the untitled was saved to. Is never untitled.\n\t */\n\treadonly target: URI;\n}\n\nexport interface IUntitledTextEditorService {\n\n\treadonly _serviceBrand: undefined;\n\n\t/**\n\t * An event for when an untitled editor model was saved to disk.\n\t * At the point the event fires, the untitled editor model is\n\t * disposed.\n\t */\n\treadonly onDidSave: Event<IUntitledTextEditorModelSaveEvent>;\n\n\t/**\n\t * Events for when untitled text editors change (e.g. getting dirty, saved or reverted).\n\t */\n\treadonly onDidChangeDirty: Event<IUntitledTextEditorModel>;\n\n\t/**\n\t * Events for when untitled text editor encodings change.\n\t */\n\treadonly onDidChangeEncoding: Event<IUntitledTextEditorModel>;\n\n\t/**\n\t * Events for when untitled text editor labels change.\n\t */\n\treadonly onDidChangeLabel: Event<IUntitledTextEditorModel>;\n\n\t/**\n\t * Events for when untitled text editor models are created.\n\t */\n\treadonly onDidCreate: Event<IUntitledTextEditorModel>;\n\n\t/**\n\t * Events for when untitled text editors are about to be disposed.\n\t */\n\treadonly onWillDispose: Event<IUntitledTextEditorModel>;\n\n\t/**\n\t * Creates a new untitled editor model with the provided options. If the `untitledResource`\n\t * property is provided and the untitled editor exists, it will return that existing\n\t * instance instead of creating a new one.\n\t */\n\tcreate(options?: INewUntitledTextEditorOptions): IUntitledTextEditorModel;\n\tcreate(options?: INewUntitledTextEditorWithAssociatedResourceOptions): IUntitledTextEditorModel;\n\tcreate(options?: IExistingUntitledTextEditorOptions): IUntitledTextEditorModel;\n\n\t/**\n\t * Returns an existing untitled editor model if already created before.\n\t */\n\tget(resource: URI): IUntitledTextEditorModel | undefined;\n\n\t/**\n\t * Returns the value of the untitled editor, undefined if none exists\n\t * @param resource The URI of the untitled file\n\t * @returns The content, or undefined\n\t */\n\tgetValue(resource: URI): string | undefined;\n\n\t/**\n\t * Resolves an untitled editor model from the provided options. If the `untitledResource`\n\t * property is provided and the untitled editor exists, it will return that existing\n\t * instance instead of creating a new one.\n\t */\n\tresolve(options?: INewUntitledTextEditorOptions): Promise<IUntitledTextEditorModel>;\n\tresolve(options?: INewUntitledTextEditorWithAssociatedResourceOptions): Promise<IUntitledTextEditorModel>;\n\tresolve(options?: IExistingUntitledTextEditorOptions): Promise<IUntitledTextEditorModel>;\n\n\t/**\n\t * Figures out if the given resource has an associated resource or not.\n\t */\n\tisUntitledWithAssociatedResource(resource: URI): boolean;\n\n\t/**\n\t * Waits for the model to be ready to be disposed. There may be conditions\n\t * under which the model cannot be disposed, e.g. when it is dirty. Once the\n\t * promise is settled, it is safe to dispose the model.\n\t */\n\tcanDispose(model: IUntitledTextEditorModel): true | Promise<true>;\n}\n\nexport interface IUntitledTextEditorModelManager extends IUntitledTextEditorService {\n\n\t/**\n\t * Internal method: triggers the onDidSave event.\n\t */\n\tnotifyDidSave(source: URI, target: URI): void;\n}\n\nexport class UntitledTextEditorService extends Disposable implements IUntitledTextEditorModelManager {\n\n\tdeclare readonly _serviceBrand: undefined;\n\n\tprivate static readonly UNTITLED_WITHOUT_ASSOCIATED_RESOURCE_REGEX = /Untitled-\\d+/;\n\n\tprivate readonly _onDidSave = this._register(new Emitter<IUntitledTextEditorModelSaveEvent>());\n\treadonly onDidSave = this._onDidSave.event;\n\n\tprivate readonly _onDidChangeDirty = this._register(new Emitter<IUntitledTextEditorModel>());\n\treadonly onDidChangeDirty = this._onDidChangeDirty.event;\n\n\tprivate readonly _onDidChangeEncoding = this._register(new Emitter<IUntitledTextEditorModel>());\n\treadonly onDidChangeEncoding = this._onDidChangeEncoding.event;\n\n\tprivate readonly _onDidCreate = this._register(new Emitter<IUntitledTextEditorModel>());\n\treadonly onDidCreate = this._onDidCreate.event;\n\n\tprivate readonly _onWillDispose = this._register(new Emitter<IUntitledTextEditorModel>());\n\treadonly onWillDispose = this._onWillDispose.event;\n\n\tprivate readonly _onDidChangeLabel = this._register(new Emitter<IUntitledTextEditorModel>());\n\treadonly onDidChangeLabel = this._onDidChangeLabel.event;\n\n\tprivate readonly mapResourceToModel = new ResourceMap<UntitledTextEditorModel>();\n\n\tconstructor(\n\t\t@IInstantiationService private readonly instantiationService: IInstantiationService,\n\t\t@IConfigurationService private readonly configurationService: IConfigurationService\n\t) {\n\t\tsuper();\n\t}\n\n\tget(resource: URI): UntitledTextEditorModel | undefined {\n\t\treturn this.mapResourceToModel.get(resource);\n\t}\n\n\tgetValue(resource: URI): string | undefined {\n\t\treturn this.get(resource)?.textEditorModel?.getValue();\n\t}\n\n\tasync resolve(options?: IInternalUntitledTextEditorOptions): Promise<UntitledTextEditorModel> {\n\t\tconst model = this.doCreateOrGet(options);\n\t\tawait model.resolve();\n\n\t\treturn model;\n\t}\n\n\tcreate(options?: IInternalUntitledTextEditorOptions): UntitledTextEditorModel {\n\t\treturn this.doCreateOrGet(options);\n\t}\n\n\tprivate doCreateOrGet(options: IInternalUntitledTextEditorOptions = Object.create(null)): UntitledTextEditorModel {\n\t\tconst massagedOptions = this.massageOptions(options);\n\n\t\t// Return existing instance if asked for it\n\t\tif (massagedOptions.untitledResource && this.mapResourceToModel.has(massagedOptions.untitledResource)) {\n\t\t\treturn this.mapResourceToModel.get(massagedOptions.untitledResource)!;\n\t\t}\n\n\t\t// Create new instance otherwise\n\t\treturn this.doCreate(massagedOptions);\n\t}\n\n\tprivate massageOptions(options: IInternalUntitledTextEditorOptions): IInternalUntitledTextEditorOptions {\n\t\tconst massagedOptions: IInternalUntitledTextEditorOptions = Object.create(null);\n\n\t\t// Figure out associated and untitled resource\n\t\tif (options.associatedResource) {\n\t\t\tmassagedOptions.untitledResource = URI.from({\n\t\t\t\tscheme: Schemas.untitled,\n\t\t\t\tauthority: options.associatedResource.authority,\n\t\t\t\tfragment: options.associatedResource.fragment,\n\t\t\t\tpath: options.associatedResource.path,\n\t\t\t\tquery: options.associatedResource.query\n\t\t\t});\n\t\t\tmassagedOptions.associatedResource = options.associatedResource;\n\t\t} else {\n\t\t\tif (options.untitledResource?.scheme === Schemas.untitled) {\n\t\t\t\tmassagedOptions.untitledResource = options.untitledResource;\n\t\t\t}\n\t\t}\n\n\t\t// Language id\n\t\tif (options.languageId) {\n\t\t\tmassagedOptions.languageId = options.languageId;\n\t\t} else if (!massagedOptions.associatedResource) {\n\t\t\tconst configuration = this.configurationService.getValue<IFilesConfiguration>();\n\t\t\tif (configuration.files?.defaultLanguage) {\n\t\t\t\tmassagedOptions.languageId = configuration.files.defaultLanguage;\n\t\t\t}\n\t\t}\n\n\t\t// Take over encoding and initial value\n\t\tmassagedOptions.encoding = options.encoding;\n\t\tmassagedOptions.initialValue = options.initialValue;\n\n\t\treturn massagedOptions;\n\t}\n\n\tprivate doCreate(options: IInternalUntitledTextEditorOptions): UntitledTextEditorModel {\n\n\t\t// Create a new untitled resource if none is provided\n\t\tlet untitledResource = options.untitledResource;\n\t\tif (!untitledResource) {\n\t\t\tlet counter = 1;\n\t\t\tdo {\n\t\t\t\tuntitledResource = URI.from({ scheme: Schemas.untitled, path: `Untitled-${counter}` });\n\t\t\t\tcounter++;\n\t\t\t} while (this.mapResourceToModel.has(untitledResource));\n\t\t}\n\n\t\t// Create new model with provided options\n\t\tconst model = this._register(this.instantiationService.createInstance(UntitledTextEditorModel, untitledResource, !!options.associatedResource, options.initialValue, options.languageId, options.encoding));\n\n\t\tthis.registerModel(model);\n\n\t\treturn model;\n\t}\n\n\tprivate registerModel(model: UntitledTextEditorModel): void {\n\n\t\t// Install model listeners\n\t\tconst modelListeners = new DisposableStore();\n\t\tmodelListeners.add(model.onDidChangeDirty(() => this._onDidChangeDirty.fire(model)));\n\t\tmodelListeners.add(model.onDidChangeName(() => this._onDidChangeLabel.fire(model)));\n\t\tmodelListeners.add(model.onDidChangeEncoding(() => this._onDidChangeEncoding.fire(model)));\n\t\tmodelListeners.add(model.onWillDispose(() => this._onWillDispose.fire(model)));\n\n\t\t// Remove from cache on dispose\n\t\tEvent.once(model.onWillDispose)(() => {\n\n\t\t\t// Registry\n\t\t\tthis.mapResourceToModel.delete(model.resource);\n\n\t\t\t// Listeners\n\t\t\tmodelListeners.dispose();\n\t\t});\n\n\t\t// Add to cache\n\t\tthis.mapResourceToModel.set(model.resource, model);\n\n\t\t// Emit as event\n\t\tthis._onDidCreate.fire(model);\n\n\t\t// If the model is dirty right from the beginning,\n\t\t// make sure to emit this as an event\n\t\tif (model.isDirty()) {\n\t\t\tthis._onDidChangeDirty.fire(model);\n\t\t}\n\t}\n\n\tisUntitledWithAssociatedResource(resource: URI): boolean {\n\t\treturn resource.scheme === Schemas.untitled && resource.path.length > 1 && !UntitledTextEditorService.UNTITLED_WITHOUT_ASSOCIATED_RESOURCE_REGEX.test(resource.path);\n\t}\n\n\tcanDispose(model: UntitledTextEditorModel): true | Promise<true> {\n\t\tif (model.isDisposed()) {\n\t\t\treturn true; // quick return if model already disposed\n\t\t}\n\n\t\t// promise based return in all other cases\n\t\treturn this.doCanDispose(model);\n\t}\n\n\tprivate async doCanDispose(model: UntitledTextEditorModel): Promise<true> {\n\n\t\t// dirty model: we do not allow to dispose dirty models to prevent\n\t\t// data loss cases. dirty models can only be disposed when they are\n\t\t// either saved or reverted\n\t\tif (model.isDirty()) {\n\t\t\tawait Event.toPromise(model.onDidChangeDirty);\n\n\t\t\treturn this.canDispose(model);\n\t\t}\n\n\t\treturn true;\n\t}\n\n\tnotifyDidSave(source: URI, target: URI): void {\n\t\tthis._onDidSave.fire({ source, target });\n\t}\n}\n\nregisterSingleton(IUntitledTextEditorService, UntitledTextEditorService, InstantiationType.Delayed);\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { URI } from '../../../../base/common/uri.js';\nimport { createDecorator, IInstantiationService } from '../../../../platform/instantiation/common/instantiation.js';\nimport { UntitledTextEditorModel, IUntitledTextEditorModel } from './untitledTextEditorModel.js';\nimport { IFilesConfiguration } from '../../../../platform/files/common/files.js';\nimport { IConfigurationService } from '../../../../platform/configuration/common/configuration.js';\nimport { Event, Emitter } from '../../../../base/common/event.js';\nimport { ResourceMap } from '../../../../base/common/map.js';\nimport { Schemas } from '../../../../base/common/network.js';\nimport { Disposable, DisposableStore } from '../../../../base/common/lifecycle.js';\nimport { InstantiationType, registerSingleton } from '../../../../platform/instantiation/common/extensions.js';\n\nexport const IUntitledTextEditorService = createDecorator<IUntitledTextEditorService>('untitledTextEditorService');\n\nexport interface INewUntitledTextEditorOptions {\n\n\t/**\n\t * Initial value of the untitled editor. An untitled editor with initial\n\t * value is dirty right from the beginning.\n\t */\n\tinitialValue?: string;\n\n\t/**\n\t * Preferred language id to use when saving the untitled editor.\n\t */\n\tlanguageId?: string;\n\n\t/**\n\t * Preferred encoding to use when saving the untitled editor.\n\t */\n\tencoding?: string;\n}\n\nexport interface IExistingUntitledTextEditorOptions extends INewUntitledTextEditorOptions {\n\n\t/**\n\t * A resource to identify the untitled editor to create or return\n\t * if already existing.\n\t *\n\t * Note: the resource will not be used unless the scheme is `untitled`.\n\t */\n\tuntitledResource?: URI;\n}\n\nexport interface INewUntitledTextEditorWithAssociatedResourceOptions extends INewUntitledTextEditorOptions {\n\n\t/**\n\t * Resource components to associate with the untitled editor. When saving\n\t * the untitled editor, the associated components will be used and the user\n\t * is not being asked to provide a file path.\n\t *\n\t * Note: currently it is not possible to specify the `scheme` to use. The\n\t * untitled editor will saved to the default local or remote resource.\n\t */\n\tassociatedResource?: { authority: string; path: string; query: string; fragment: string };\n}\n\ntype IInternalUntitledTextEditorOptions = IExistingUntitledTextEditorOptions & INewUntitledTextEditorWithAssociatedResourceOptions;\n\nexport interface IUntitledTextEditorModelSaveEvent {\n\n\t/**\n\t * The source untitled file that was saved. It is disposed at this point.\n\t */\n\treadonly source: URI;\n\n\t/**\n\t * The target file the untitled was saved to. Is never untitled.\n\t */\n\treadonly target: URI;\n}\n\nexport interface IUntitledTextEditorService {\n\n\treadonly _serviceBrand: undefined;\n\n\t/**\n\t * An event for when an untitled editor model was saved to disk.\n\t * At the point the event fires, the untitled editor model is\n\t * disposed.\n\t */\n\treadonly onDidSave: Event<IUntitledTextEditorModelSaveEvent>;\n\n\t/**\n\t * Events for when untitled text editors change (e.g. getting dirty, saved or reverted).\n\t */\n\treadonly onDidChangeDirty: Event<IUntitledTextEditorModel>;\n\n\t/**\n\t * Events for when untitled text editor encodings change.\n\t */\n\treadonly onDidChangeEncoding: Event<IUntitledTextEditorModel>;\n\n\t/**\n\t * Events for when untitled text editor labels change.\n\t */\n\treadonly onDidChangeLabel: Event<IUntitledTextEditorModel>;\n\n\t/**\n\t * Events for when untitled text editor models are created.\n\t */\n\treadonly onDidCreate: Event<IUntitledTextEditorModel>;\n\n\t/**\n\t * Events for when untitled text editors are about to be disposed.\n\t */\n\treadonly onWillDispose: Event<IUntitledTextEditorModel>;\n\n\t/**\n\t * Creates a new untitled editor model with the provided options. If the `untitledResource`\n\t * property is provided and the untitled editor exists, it will return that existing\n\t * instance instead of creating a new one.\n\t */\n\tcreate(options?: INewUntitledTextEditorOptions): IUntitledTextEditorModel;\n\tcreate(options?: INewUntitledTextEditorWithAssociatedResourceOptions): IUntitledTextEditorModel;\n\tcreate(options?: IExistingUntitledTextEditorOptions): IUntitledTextEditorModel;\n\n\t/**\n\t * Returns an existing untitled editor model if already created before.\n\t */\n\tget(resource: URI): IUntitledTextEditorModel | undefined;\n\n\t/**\n\t * Returns the value of the untitled editor, undefined if none exists\n\t * @param resource The URI of the untitled file\n\t * @returns The content, or undefined\n\t */\n\tgetValue(resource: URI): string | undefined;\n\n\t/**\n\t * Resolves an untitled editor model from the provided options. If the `untitledResource`\n\t * property is provided and the untitled editor exists, it will return that existing\n\t * instance instead of creating a new one.\n\t */\n\tresolve(options?: INewUntitledTextEditorOptions): Promise<IUntitledTextEditorModel>;\n\tresolve(options?: INewUntitledTextEditorWithAssociatedResourceOptions): Promise<IUntitledTextEditorModel>;\n\tresolve(options?: IExistingUntitledTextEditorOptions): Promise<IUntitledTextEditorModel>;\n\n\t/**\n\t * Figures out if the given resource has an associated resource or not.\n\t */\n\tisUntitledWithAssociatedResource(resource: URI): boolean;\n\n\t/**\n\t * Waits for the model to be ready to be disposed. There may be conditions\n\t * under which the model cannot be disposed, e.g. when it is dirty. Once the\n\t * promise is settled, it is safe to dispose the model.\n\t */\n\tcanDispose(model: IUntitledTextEditorModel): true | Promise<true>;\n}\n\nexport interface IUntitledTextEditorModelManager extends IUntitledTextEditorService {\n\n\t/**\n\t * Internal method: triggers the onDidSave event.\n\t */\n\tnotifyDidSave(source: URI, target: URI): void;\n}\n\nexport class UntitledTextEditorService extends Disposable implements IUntitledTextEditorModelManager {\n\n\tdeclare readonly _serviceBrand: undefined;\n\n\tprivate static readonly UNTITLED_WITHOUT_ASSOCIATED_RESOURCE_REGEX = /Untitled-\\d+/;\n\n\tprivate readonly _onDidSave = this._register(new Emitter<IUntitledTextEditorModelSaveEvent>());\n\treadonly onDidSave = this._onDidSave.event;\n\n\tprivate readonly _onDidChangeDirty = this._register(new Emitter<IUntitledTextEditorModel>());\n\treadonly onDidChangeDirty = this._onDidChangeDirty.event;\n\n\tprivate readonly _onDidChangeEncoding = this._register(new Emitter<IUntitledTextEditorModel>());\n\treadonly onDidChangeEncoding = this._onDidChangeEncoding.event;\n\n\tprivate readonly _onDidCreate = this._register(new Emitter<IUntitledTextEditorModel>());\n\treadonly onDidCreate = this._onDidCreate.event;\n\n\tprivate readonly _onWillDispose = this._register(new Emitter<IUntitledTextEditorModel>());\n\treadonly onWillDispose = this._onWillDispose.event;\n\n\tprivate readonly _onDidChangeLabel = this._register(new Emitter<IUntitledTextEditorModel>());\n\treadonly onDidChangeLabel = this._onDidChangeLabel.event;\n\n\tprivate readonly mapResourceToModel = new ResourceMap<UntitledTextEditorModel>();\n\n\tconstructor(\n\t\t@IInstantiationService private readonly instantiationService: IInstantiationService,\n\t\t@IConfigurationService private readonly configurationService: IConfigurationService\n\t) {\n\t\tsuper();\n\t}\n\n\tget(resource: URI): UntitledTextEditorModel | undefined {\n\t\treturn this.mapResourceToModel.get(resource);\n\t}\n\n\tgetValue(resource: URI): string | undefined {\n\t\treturn this.get(resource)?.textEditorModel?.getValue();\n\t}\n\n\tasync resolve(options?: IInternalUntitledTextEditorOptions): Promise<UntitledTextEditorModel> {\n\t\tconst model = this.doCreateOrGet(options);\n\t\tawait model.resolve();\n\n\t\treturn model;\n\t}\n\n\tcreate(options?: IInternalUntitledTextEditorOptions): UntitledTextEditorModel {\n\t\treturn this.doCreateOrGet(options);\n\t}\n\n\tprivate doCreateOrGet(options: IInternalUntitledTextEditorOptions = Object.create(null)): UntitledTextEditorModel {\n\t\tconst massagedOptions = this.massageOptions(options);\n\n\t\t// Return existing instance if asked for it\n\t\tif (massagedOptions.untitledResource && this.mapResourceToModel.has(massagedOptions.untitledResource)) {\n\t\t\treturn this.mapResourceToModel.get(massagedOptions.untitledResource)!;\n\t\t}\n\n\t\t// Create new instance otherwise\n\t\treturn this.doCreate(massagedOptions);\n\t}\n\n\tprivate massageOptions(options: IInternalUntitledTextEditorOptions): IInternalUntitledTextEditorOptions {\n\t\tconst massagedOptions: IInternalUntitledTextEditorOptions = Object.create(null);\n\n\t\t// Figure out associated and untitled resource\n\t\tif (options.associatedResource) {\n\t\t\tmassagedOptions.untitledResource = URI.from({\n\t\t\t\tscheme: Schemas.untitled,\n\t\t\t\tauthority: options.associatedResource.authority,\n\t\t\t\tfragment: options.associatedResource.fragment,\n\t\t\t\tpath: options.associatedResource.path,\n\t\t\t\tquery: options.associatedResource.query\n\t\t\t});\n\t\t\tmassagedOptions.associatedResource = options.associatedResource;\n\t\t} else {\n\t\t\tif (options.untitledResource?.scheme === Schemas.untitled) {\n\t\t\t\tmassagedOptions.untitledResource = options.untitledResource;\n\t\t\t}\n\t\t}\n\n\t\t// Language id\n\t\tif (options.languageId) {\n\t\t\tmassagedOptions.languageId = options.languageId;\n\t\t} else if (!massagedOptions.associatedResource) {\n\t\t\tconst configuration = this.configurationService.getValue<IFilesConfiguration>();\n\t\t\tif (configuration.files?.defaultLanguage) {\n\t\t\t\tmassagedOptions.languageId = configuration.files.defaultLanguage;\n\t\t\t}\n\t\t}\n\n\t\t// Take over encoding and initial value\n\t\tmassagedOptions.encoding = options.encoding;\n\t\tmassagedOptions.initialValue = options.initialValue;\n\n\t\treturn massagedOptions;\n\t}\n\n\tprivate doCreate(options: IInternalUntitledTextEditorOptions): UntitledTextEditorModel {\n\n\t\t// Create a new untitled resource if none is provided\n\t\tlet untitledResource = options.untitledResource;\n\t\tif (!untitledResource) {\n\t\t\tlet counter = 1;\n\t\t\tdo {\n\t\t\t\tuntitledResource = URI.from({ scheme: Schemas.untitled, path: `Untitled-${counter}` });\n\t\t\t\tcounter++;\n\t\t\t} while (this.mapResourceToModel.has(untitledResource));\n\t\t}\n\n\t\t// Create new model with provided options\n\t\tconst model = this._register(this.instantiationService.createInstance(UntitledTextEditorModel, untitledResource, !!options.associatedResource, options.initialValue, options.languageId, options.encoding));\n\n\t\tthis.registerModel(model);\n\n\t\treturn model;\n\t}\n\n\tprivate registerModel(model: UntitledTextEditorModel): void {\n\n\t\t// Install model listeners\n\t\tconst modelListeners = new DisposableStore();\n\t\tmodelListeners.add(model.onDidChangeDirty(() => this._onDidChangeDirty.fire(model)));\n\t\tmodelListeners.add(model.onDidChangeName(() => this._onDidChangeLabel.fire(model)));\n\t\tmodelListeners.add(model.onDidChangeEncoding(() => this._onDidChangeEncoding.fire(model)));\n\t\tmodelListeners.add(model.onWillDispose(() => this._onWillDispose.fire(model)));\n\n\t\t// Remove from cache on dispose\n\t\tEvent.once(model.onWillDispose)(() => {\n\n\t\t\t// Registry\n\t\t\tthis.mapResourceToModel.delete(model.resource);\n\n\t\t\t// Listeners\n\t\t\tmodelListeners.dispose();\n\t\t});\n\n\t\t// Add to cache\n\t\tthis.mapResourceToModel.set(model.resource, model);\n\n\t\t// Emit as event\n\t\tthis._onDidCreate.fire(model);\n\n\t\t// If the model is dirty right from the beginning,\n\t\t// make sure to emit this as an event\n\t\tif (model.isDirty()) {\n\t\t\tthis._onDidChangeDirty.fire(model);\n\t\t}\n\t}\n\n\tisUntitledWithAssociatedResource(resource: URI): boolean {\n\t\treturn resource.scheme === Schemas.untitled && resource.path.length > 1 && !UntitledTextEditorService.UNTITLED_WITHOUT_ASSOCIATED_RESOURCE_REGEX.test(resource.path);\n\t}\n\n\tcanDispose(model: UntitledTextEditorModel): true | Promise<true> {\n\t\tif (model.isDisposed()) {\n\t\t\treturn true; // quick return if model already disposed\n\t\t}\n\n\t\t// promise based return in all other cases\n\t\treturn this.doCanDispose(model);\n\t}\n\n\tprivate async doCanDispose(model: UntitledTextEditorModel): Promise<true> {\n\n\t\t// dirty model: we do not allow to dispose dirty models to prevent\n\t\t// data loss cases. dirty models can only be disposed when they are\n\t\t// either saved or reverted\n\t\tif (model.isDirty()) {\n\t\t\tawait Event.toPromise(model.onDidChangeDirty);\n\n\t\t\treturn this.canDispose(model);\n\t\t}\n\n\t\treturn true;\n\t}\n\n\tnotifyDidSave(source: URI, target: URI): void {\n\t\tthis._onDidSave.fire({ source, target });\n\t}\n}\n\nregisterSingleton(IUntitledTextEditorService, UntitledTextEditorService, InstantiationType.Delayed);\n"]}