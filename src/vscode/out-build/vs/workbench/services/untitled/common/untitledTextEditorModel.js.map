{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/services/untitled/common/untitledTextEditorModel.ts","vs/workbench/services/untitled/common/untitledTextEditorModel.ts"],"names":[],"mappings":"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","file":"untitledTextEditorModel.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { ISaveOptions } from '../../../common/editor.js';\nimport { BaseTextEditorModel } from '../../../common/editor/textEditorModel.js';\nimport { URI } from '../../../../base/common/uri.js';\nimport { ILanguageService } from '../../../../editor/common/languages/language.js';\nimport { IModelService } from '../../../../editor/common/services/model.js';\nimport { Event, Emitter } from '../../../../base/common/event.js';\nimport { IWorkingCopyBackupService } from '../../workingCopy/common/workingCopyBackup.js';\nimport { ITextResourceConfigurationChangeEvent, ITextResourceConfigurationService } from '../../../../editor/common/services/textResourceConfiguration.js';\nimport { ITextModel } from '../../../../editor/common/model.js';\nimport { createTextBufferFactory, createTextBufferFactoryFromStream } from '../../../../editor/common/model/textModel.js';\nimport { ITextEditorModel } from '../../../../editor/common/services/resolverService.js';\nimport { IWorkingCopyService } from '../../workingCopy/common/workingCopyService.js';\nimport { IWorkingCopy, WorkingCopyCapabilities, IWorkingCopyBackup, NO_TYPE_ID, IWorkingCopySaveEvent } from '../../workingCopy/common/workingCopy.js';\nimport { IEncodingSupport, ILanguageSupport, ITextFileService } from '../../textfile/common/textfiles.js';\nimport { IModelContentChangedEvent } from '../../../../editor/common/textModelEvents.js';\nimport { assertReturnsDefined } from '../../../../base/common/types.js';\nimport { ILabelService } from '../../../../platform/label/common/label.js';\nimport { ensureValidWordDefinition } from '../../../../editor/common/core/wordHelper.js';\nimport { IEditorService } from '../../editor/common/editorService.js';\nimport { CancellationToken } from '../../../../base/common/cancellation.js';\nimport { getCharContainingOffset } from '../../../../base/common/strings.js';\nimport { UTF8 } from '../../textfile/common/encoding.js';\nimport { bufferToReadable, bufferToStream, VSBuffer, VSBufferReadable, VSBufferReadableStream } from '../../../../base/common/buffer.js';\nimport { ILanguageDetectionService } from '../../languageDetection/common/languageDetectionWorkerService.js';\nimport { IAccessibilityService } from '../../../../platform/accessibility/common/accessibility.js';\n\nexport interface IUntitledTextEditorModel extends ITextEditorModel, ILanguageSupport, IEncodingSupport, IWorkingCopy {\n\n\t/**\n\t * Emits an event when the encoding of this untitled model changes.\n\t */\n\treadonly onDidChangeEncoding: Event<void>;\n\n\t/**\n\t * Emits an event when the name of this untitled model changes.\n\t */\n\treadonly onDidChangeName: Event<void>;\n\n\t/**\n\t * Emits an event when this untitled model is reverted.\n\t */\n\treadonly onDidRevert: Event<void>;\n\n\t/**\n\t * Whether this untitled text model has an associated file path.\n\t */\n\treadonly hasAssociatedFilePath: boolean;\n\n\t/**\n\t * Whether this model has an explicit language or not.\n\t */\n\treadonly hasLanguageSetExplicitly: boolean;\n\n\t/**\n\t * Sets the encoding to use for this untitled model.\n\t */\n\tsetEncoding(encoding: string): Promise<void>;\n\n\t/**\n\t * Resolves the untitled model.\n\t */\n\tresolve(): Promise<void>;\n\n\t/**\n\t * Whether this model is resolved or not.\n\t */\n\tisResolved(): this is IResolvedUntitledTextEditorModel;\n}\n\nexport interface IResolvedUntitledTextEditorModel extends IUntitledTextEditorModel {\n\n\treadonly textEditorModel: ITextModel;\n}\n\nexport class UntitledTextEditorModel extends BaseTextEditorModel implements IUntitledTextEditorModel {\n\n\tprivate static readonly FIRST_LINE_NAME_MAX_LENGTH = 40;\n\tprivate static readonly FIRST_LINE_NAME_CANDIDATE_MAX_LENGTH = this.FIRST_LINE_NAME_MAX_LENGTH * 10;\n\n\t// Support the special '${activeEditorLanguage}' language by\n\t// looking up the language id from the editor that is active\n\t// before the untitled editor opens. This special id is only\n\t// used for the initial language and can be changed after the\n\t// fact (either manually or through auto-detection).\n\tprivate static readonly ACTIVE_EDITOR_LANGUAGE_ID = '${activeEditorLanguage}';\n\n\t//#region Events\n\n\tprivate readonly _onDidChangeContent = this._register(new Emitter<void>());\n\treadonly onDidChangeContent = this._onDidChangeContent.event;\n\n\tprivate readonly _onDidChangeName = this._register(new Emitter<void>());\n\treadonly onDidChangeName = this._onDidChangeName.event;\n\n\tprivate readonly _onDidChangeDirty = this._register(new Emitter<void>());\n\treadonly onDidChangeDirty = this._onDidChangeDirty.event;\n\n\tprivate readonly _onDidChangeEncoding = this._register(new Emitter<void>());\n\treadonly onDidChangeEncoding = this._onDidChangeEncoding.event;\n\n\tprivate readonly _onDidSave = this._register(new Emitter<IWorkingCopySaveEvent>());\n\treadonly onDidSave = this._onDidSave.event;\n\n\tprivate readonly _onDidRevert = this._register(new Emitter<void>());\n\treadonly onDidRevert = this._onDidRevert.event;\n\n\t//#endregion\n\n\treadonly typeId = NO_TYPE_ID; // IMPORTANT: never change this to not break existing assumptions (e.g. backups)\n\n\treadonly capabilities = WorkingCopyCapabilities.Untitled;\n\n\t//#region Name\n\n\tprivate configuredLabelFormat: 'content' | 'name' = 'content';\n\n\tprivate cachedModelFirstLineWords: string | undefined = undefined;\n\tget name(): string {\n\n\t\t// Take name from first line if present and only if\n\t\t// we have no associated file path. In that case we\n\t\t// prefer the file name as title.\n\t\tif (this.configuredLabelFormat === 'content' && !this.hasAssociatedFilePath && this.cachedModelFirstLineWords) {\n\t\t\treturn this.cachedModelFirstLineWords;\n\t\t}\n\n\t\t// Otherwise fallback to resource\n\t\treturn this.labelService.getUriBasenameLabel(this.resource);\n\t}\n\n\t//#endregion\n\n\tconstructor(\n\t\treadonly resource: URI,\n\t\treadonly hasAssociatedFilePath: boolean,\n\t\tprivate readonly initialValue: string | undefined,\n\t\tprivate preferredLanguageId: string | undefined,\n\t\tprivate preferredEncoding: string | undefined,\n\t\t@ILanguageService languageService: ILanguageService,\n\t\t@IModelService modelService: IModelService,\n\t\t@IWorkingCopyBackupService private readonly workingCopyBackupService: IWorkingCopyBackupService,\n\t\t@ITextResourceConfigurationService private readonly textResourceConfigurationService: ITextResourceConfigurationService,\n\t\t@IWorkingCopyService private readonly workingCopyService: IWorkingCopyService,\n\t\t@ITextFileService private readonly textFileService: ITextFileService,\n\t\t@ILabelService private readonly labelService: ILabelService,\n\t\t@IEditorService private readonly editorService: IEditorService,\n\t\t@ILanguageDetectionService languageDetectionService: ILanguageDetectionService,\n\t\t@IAccessibilityService accessibilityService: IAccessibilityService,\n\t) {\n\t\tsuper(modelService, languageService, languageDetectionService, accessibilityService);\n\n\t\tthis.dirty = this.hasAssociatedFilePath || !!this.initialValue;\n\n\t\t// Make known to working copy service\n\t\tthis._register(this.workingCopyService.registerWorkingCopy(this));\n\n\t\t// This is typically controlled by the setting `files.defaultLanguage`.\n\t\t// If that setting is set, we should not detect the language.\n\t\tif (preferredLanguageId) {\n\t\t\tthis.setLanguageId(preferredLanguageId);\n\t\t}\n\n\t\t// Fetch config\n\t\tthis.onConfigurationChange(undefined, false);\n\n\t\tthis.registerListeners();\n\t}\n\n\tprivate registerListeners(): void {\n\n\t\t// Config Changes\n\t\tthis._register(this.textResourceConfigurationService.onDidChangeConfiguration(e => this.onConfigurationChange(e, true)));\n\t}\n\n\tprivate onConfigurationChange(e: ITextResourceConfigurationChangeEvent | undefined, fromEvent: boolean): void {\n\n\t\t// Encoding\n\t\tif (!e || e.affectsConfiguration(this.resource, 'files.encoding')) {\n\t\t\tconst configuredEncoding = this.textResourceConfigurationService.getValue(this.resource, 'files.encoding');\n\t\t\tif (this.configuredEncoding !== configuredEncoding && typeof configuredEncoding === 'string') {\n\t\t\t\tthis.configuredEncoding = configuredEncoding;\n\n\t\t\t\tif (fromEvent && !this.preferredEncoding) {\n\t\t\t\t\tthis._onDidChangeEncoding.fire(); // do not fire event if we have a preferred encoding set\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// Label Format\n\t\tif (!e || e.affectsConfiguration(this.resource, 'workbench.editor.untitled.labelFormat')) {\n\t\t\tconst configuredLabelFormat = this.textResourceConfigurationService.getValue(this.resource, 'workbench.editor.untitled.labelFormat');\n\t\t\tif (this.configuredLabelFormat !== configuredLabelFormat && (configuredLabelFormat === 'content' || configuredLabelFormat === 'name')) {\n\t\t\t\tthis.configuredLabelFormat = configuredLabelFormat;\n\n\t\t\t\tif (fromEvent) {\n\t\t\t\t\tthis._onDidChangeName.fire();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t//#region Language\n\n\toverride setLanguageId(languageId: string, source?: string): void {\n\t\tconst actualLanguage: string | undefined = languageId === UntitledTextEditorModel.ACTIVE_EDITOR_LANGUAGE_ID\n\t\t\t? this.editorService.activeTextEditorLanguageId\n\t\t\t: languageId;\n\t\tthis.preferredLanguageId = actualLanguage;\n\n\t\tif (actualLanguage) {\n\t\t\tsuper.setLanguageId(actualLanguage, source);\n\t\t}\n\t}\n\n\toverride getLanguageId(): string | undefined {\n\t\tif (this.textEditorModel) {\n\t\t\treturn this.textEditorModel.getLanguageId();\n\t\t}\n\n\t\treturn this.preferredLanguageId;\n\t}\n\n\t//#endregion\n\n\t//#region Encoding\n\n\tprivate configuredEncoding: string | undefined;\n\n\tgetEncoding(): string | undefined {\n\t\treturn this.preferredEncoding || this.configuredEncoding;\n\t}\n\n\tasync setEncoding(encoding: string): Promise<void> {\n\t\tconst oldEncoding = this.getEncoding();\n\t\tthis.preferredEncoding = encoding;\n\n\t\t// Emit if it changed\n\t\tif (oldEncoding !== this.preferredEncoding) {\n\t\t\tthis._onDidChangeEncoding.fire();\n\t\t}\n\t}\n\n\t//#endregion\n\n\t//#region Dirty\n\n\tprivate dirty: boolean;\n\n\tisDirty(): boolean {\n\t\treturn this.dirty;\n\t}\n\n\tisModified(): boolean {\n\t\treturn this.isDirty();\n\t}\n\n\tprivate setDirty(dirty: boolean): void {\n\t\tif (this.dirty === dirty) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.dirty = dirty;\n\t\tthis._onDidChangeDirty.fire();\n\t}\n\n\t//#endregion\n\n\t//#region Save / Revert / Backup\n\n\tasync save(options?: ISaveOptions): Promise<boolean> {\n\t\tconst target = await this.textFileService.save(this.resource, options);\n\n\t\t// Emit as event\n\t\tif (target) {\n\t\t\tthis._onDidSave.fire({ reason: options?.reason, source: options?.source });\n\t\t}\n\n\t\treturn !!target;\n\t}\n\n\tasync revert(): Promise<void> {\n\n\t\t// Reset contents to be empty\n\t\tthis.ignoreDirtyOnModelContentChange = true;\n\t\ttry {\n\t\t\tthis.updateTextEditorModel(createTextBufferFactory(''));\n\t\t} finally {\n\t\t\tthis.ignoreDirtyOnModelContentChange = false;\n\t\t}\n\n\t\t// No longer dirty\n\t\tthis.setDirty(false);\n\n\t\t// Emit as event\n\t\tthis._onDidRevert.fire();\n\t}\n\n\tasync backup(token: CancellationToken): Promise<IWorkingCopyBackup> {\n\t\tlet content: VSBufferReadable | undefined = undefined;\n\n\t\t// Make sure to check whether this model has been resolved\n\t\t// or not and fallback to the initial value - if any - to\n\t\t// prevent backing up an unresolved model and loosing the\n\t\t// initial value.\n\t\tif (this.isResolved()) {\n\t\t\t// Fill in content the same way we would do when saving the file\n\t\t\t// via the text file service encoding support (hardcode UTF-8)\n\t\t\tcontent = await this.textFileService.getEncodedReadable(this.resource, this.createSnapshot() ?? undefined, { encoding: UTF8 });\n\t\t} else if (typeof this.initialValue === 'string') {\n\t\t\tcontent = bufferToReadable(VSBuffer.fromString(this.initialValue));\n\t\t}\n\n\t\treturn { content };\n\t}\n\n\t//#endregion\n\n\t//#region Resolve\n\n\tprivate ignoreDirtyOnModelContentChange = false;\n\n\toverride async resolve(): Promise<void> {\n\n\t\t// Create text editor model if not yet done\n\t\tlet createdUntitledModel = false;\n\t\tlet hasBackup = false;\n\t\tif (!this.textEditorModel) {\n\t\t\tlet untitledContents: VSBufferReadableStream;\n\n\t\t\t// Check for backups or use initial value or empty\n\t\t\tconst backup = await this.workingCopyBackupService.resolve(this);\n\t\t\tif (backup) {\n\t\t\t\tuntitledContents = backup.value;\n\t\t\t\thasBackup = true;\n\t\t\t} else {\n\t\t\t\tuntitledContents = bufferToStream(VSBuffer.fromString(this.initialValue || ''));\n\t\t\t}\n\n\t\t\t// Determine untitled contents based on backup\n\t\t\t// or initial value. We must use text file service\n\t\t\t// to create the text factory to respect encodings\n\t\t\t// accordingly.\n\t\t\tconst untitledContentsFactory = await createTextBufferFactoryFromStream(await this.textFileService.getDecodedStream(this.resource, untitledContents, { encoding: UTF8 }));\n\n\t\t\tthis.createTextEditorModel(untitledContentsFactory, this.resource, this.preferredLanguageId);\n\t\t\tcreatedUntitledModel = true;\n\t\t}\n\n\t\t// Otherwise: the untitled model already exists and we must assume\n\t\t// that the value of the model was changed by the user. As such we\n\t\t// do not update the contents, only the language if configured.\n\t\telse {\n\t\t\tthis.updateTextEditorModel(undefined, this.preferredLanguageId);\n\t\t}\n\n\t\t// Listen to text model events\n\t\tconst textEditorModel = assertReturnsDefined(this.textEditorModel);\n\t\tthis.installModelListeners(textEditorModel);\n\n\t\t// Only adjust name and dirty state etc. if we\n\t\t// actually created the untitled model\n\t\tif (createdUntitledModel) {\n\n\t\t\t// Name\n\t\t\tif (hasBackup || this.initialValue) {\n\t\t\t\tthis.updateNameFromFirstLine(textEditorModel);\n\t\t\t}\n\n\t\t\t// Untitled associated to file path are dirty right away as well as untitled with content\n\t\t\tthis.setDirty(this.hasAssociatedFilePath || !!hasBackup || !!this.initialValue);\n\n\t\t\t// If we have initial contents, make sure to emit this\n\t\t\t// as the appropiate events to the outside.\n\t\t\tif (hasBackup || this.initialValue) {\n\t\t\t\tthis._onDidChangeContent.fire();\n\t\t\t}\n\t\t}\n\n\t\treturn super.resolve();\n\t}\n\n\toverride isResolved(): this is IResolvedUntitledTextEditorModel {\n\t\treturn !!this.textEditorModelHandle;\n\t}\n\n\tprotected override installModelListeners(model: ITextModel): void {\n\t\tthis._register(model.onDidChangeContent(e => this.onModelContentChanged(model, e)));\n\t\tthis._register(model.onDidChangeLanguage(() => this.onConfigurationChange(undefined, true))); // language change can have impact on config\n\n\t\tsuper.installModelListeners(model);\n\t}\n\n\tprivate onModelContentChanged(textEditorModel: ITextModel, e: IModelContentChangedEvent): void {\n\t\tif (!this.ignoreDirtyOnModelContentChange) {\n\n\t\t\t// mark the untitled text editor as non-dirty once its content becomes empty and we do\n\t\t\t// not have an associated path set. we never want dirty indicator in that case.\n\t\t\tif (!this.hasAssociatedFilePath && textEditorModel.getLineCount() === 1 && textEditorModel.getLineLength(1) === 0) {\n\t\t\t\tthis.setDirty(false);\n\t\t\t}\n\n\t\t\t// turn dirty otherwise\n\t\t\telse {\n\t\t\t\tthis.setDirty(true);\n\t\t\t}\n\t\t}\n\n\t\t// Check for name change if first line changed in the range of 0-FIRST_LINE_NAME_CANDIDATE_MAX_LENGTH columns\n\t\tif (e.changes.some(change => (change.range.startLineNumber === 1 || change.range.endLineNumber === 1) && change.range.startColumn <= UntitledTextEditorModel.FIRST_LINE_NAME_CANDIDATE_MAX_LENGTH)) {\n\t\t\tthis.updateNameFromFirstLine(textEditorModel);\n\t\t}\n\n\t\t// Emit as general content change event\n\t\tthis._onDidChangeContent.fire();\n\n\t\t// Detect language from content\n\t\tthis.autoDetectLanguage();\n\t}\n\n\tprivate updateNameFromFirstLine(textEditorModel: ITextModel): void {\n\t\tif (this.hasAssociatedFilePath) {\n\t\t\treturn; // not in case of an associated file path\n\t\t}\n\n\t\t// Determine the first words of the model following these rules:\n\t\t// - cannot be only whitespace (so we trim())\n\t\t// - cannot be only non-alphanumeric characters (so we run word definition regex over it)\n\t\t// - cannot be longer than FIRST_LINE_MAX_TITLE_LENGTH\n\t\t// - normalize multiple whitespaces to a single whitespace\n\n\t\tlet modelFirstWordsCandidate: string | undefined = undefined;\n\n\t\tlet firstLineText = textEditorModel\n\t\t\t.getValueInRange({\n\t\t\t\tstartLineNumber: 1,\n\t\t\t\tendLineNumber: 1,\n\t\t\t\tstartColumn: 1,\n\t\t\t\tendColumn: UntitledTextEditorModel.FIRST_LINE_NAME_CANDIDATE_MAX_LENGTH + 1\t\t// first cap at FIRST_LINE_NAME_CANDIDATE_MAX_LENGTH\n\t\t\t})\n\t\t\t.trim().replace(/\\s+/g, ' ') \t\t\t\t\t\t\t\t\t\t\t\t\t\t// normalize whitespaces\n\t\t\t.replace(/\\u202E/g, '');\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// drop Right-to-Left Override character (#190133)\n\t\tfirstLineText = firstLineText.substr(0, getCharContainingOffset(\t\t\t\t\t\t// finally cap at FIRST_LINE_NAME_MAX_LENGTH (grapheme aware #111235)\n\t\t\tfirstLineText,\n\t\t\tUntitledTextEditorModel.FIRST_LINE_NAME_MAX_LENGTH)[0]\n\t\t);\n\n\t\tif (firstLineText && ensureValidWordDefinition().exec(firstLineText)) {\n\t\t\tmodelFirstWordsCandidate = firstLineText;\n\t\t}\n\n\t\tif (modelFirstWordsCandidate !== this.cachedModelFirstLineWords) {\n\t\t\tthis.cachedModelFirstLineWords = modelFirstWordsCandidate;\n\t\t\tthis._onDidChangeName.fire();\n\t\t}\n\t}\n\n\t//#endregion\n\n\toverride isReadonly(): boolean {\n\t\treturn false;\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { ISaveOptions } from '../../../common/editor.js';\nimport { BaseTextEditorModel } from '../../../common/editor/textEditorModel.js';\nimport { URI } from '../../../../base/common/uri.js';\nimport { ILanguageService } from '../../../../editor/common/languages/language.js';\nimport { IModelService } from '../../../../editor/common/services/model.js';\nimport { Event, Emitter } from '../../../../base/common/event.js';\nimport { IWorkingCopyBackupService } from '../../workingCopy/common/workingCopyBackup.js';\nimport { ITextResourceConfigurationChangeEvent, ITextResourceConfigurationService } from '../../../../editor/common/services/textResourceConfiguration.js';\nimport { ITextModel } from '../../../../editor/common/model.js';\nimport { createTextBufferFactory, createTextBufferFactoryFromStream } from '../../../../editor/common/model/textModel.js';\nimport { ITextEditorModel } from '../../../../editor/common/services/resolverService.js';\nimport { IWorkingCopyService } from '../../workingCopy/common/workingCopyService.js';\nimport { IWorkingCopy, WorkingCopyCapabilities, IWorkingCopyBackup, NO_TYPE_ID, IWorkingCopySaveEvent } from '../../workingCopy/common/workingCopy.js';\nimport { IEncodingSupport, ILanguageSupport, ITextFileService } from '../../textfile/common/textfiles.js';\nimport { IModelContentChangedEvent } from '../../../../editor/common/textModelEvents.js';\nimport { assertReturnsDefined } from '../../../../base/common/types.js';\nimport { ILabelService } from '../../../../platform/label/common/label.js';\nimport { ensureValidWordDefinition } from '../../../../editor/common/core/wordHelper.js';\nimport { IEditorService } from '../../editor/common/editorService.js';\nimport { CancellationToken } from '../../../../base/common/cancellation.js';\nimport { getCharContainingOffset } from '../../../../base/common/strings.js';\nimport { UTF8 } from '../../textfile/common/encoding.js';\nimport { bufferToReadable, bufferToStream, VSBuffer, VSBufferReadable, VSBufferReadableStream } from '../../../../base/common/buffer.js';\nimport { ILanguageDetectionService } from '../../languageDetection/common/languageDetectionWorkerService.js';\nimport { IAccessibilityService } from '../../../../platform/accessibility/common/accessibility.js';\n\nexport interface IUntitledTextEditorModel extends ITextEditorModel, ILanguageSupport, IEncodingSupport, IWorkingCopy {\n\n\t/**\n\t * Emits an event when the encoding of this untitled model changes.\n\t */\n\treadonly onDidChangeEncoding: Event<void>;\n\n\t/**\n\t * Emits an event when the name of this untitled model changes.\n\t */\n\treadonly onDidChangeName: Event<void>;\n\n\t/**\n\t * Emits an event when this untitled model is reverted.\n\t */\n\treadonly onDidRevert: Event<void>;\n\n\t/**\n\t * Whether this untitled text model has an associated file path.\n\t */\n\treadonly hasAssociatedFilePath: boolean;\n\n\t/**\n\t * Whether this model has an explicit language or not.\n\t */\n\treadonly hasLanguageSetExplicitly: boolean;\n\n\t/**\n\t * Sets the encoding to use for this untitled model.\n\t */\n\tsetEncoding(encoding: string): Promise<void>;\n\n\t/**\n\t * Resolves the untitled model.\n\t */\n\tresolve(): Promise<void>;\n\n\t/**\n\t * Whether this model is resolved or not.\n\t */\n\tisResolved(): this is IResolvedUntitledTextEditorModel;\n}\n\nexport interface IResolvedUntitledTextEditorModel extends IUntitledTextEditorModel {\n\n\treadonly textEditorModel: ITextModel;\n}\n\nexport class UntitledTextEditorModel extends BaseTextEditorModel implements IUntitledTextEditorModel {\n\n\tprivate static readonly FIRST_LINE_NAME_MAX_LENGTH = 40;\n\tprivate static readonly FIRST_LINE_NAME_CANDIDATE_MAX_LENGTH = this.FIRST_LINE_NAME_MAX_LENGTH * 10;\n\n\t// Support the special '${activeEditorLanguage}' language by\n\t// looking up the language id from the editor that is active\n\t// before the untitled editor opens. This special id is only\n\t// used for the initial language and can be changed after the\n\t// fact (either manually or through auto-detection).\n\tprivate static readonly ACTIVE_EDITOR_LANGUAGE_ID = '${activeEditorLanguage}';\n\n\t//#region Events\n\n\tprivate readonly _onDidChangeContent = this._register(new Emitter<void>());\n\treadonly onDidChangeContent = this._onDidChangeContent.event;\n\n\tprivate readonly _onDidChangeName = this._register(new Emitter<void>());\n\treadonly onDidChangeName = this._onDidChangeName.event;\n\n\tprivate readonly _onDidChangeDirty = this._register(new Emitter<void>());\n\treadonly onDidChangeDirty = this._onDidChangeDirty.event;\n\n\tprivate readonly _onDidChangeEncoding = this._register(new Emitter<void>());\n\treadonly onDidChangeEncoding = this._onDidChangeEncoding.event;\n\n\tprivate readonly _onDidSave = this._register(new Emitter<IWorkingCopySaveEvent>());\n\treadonly onDidSave = this._onDidSave.event;\n\n\tprivate readonly _onDidRevert = this._register(new Emitter<void>());\n\treadonly onDidRevert = this._onDidRevert.event;\n\n\t//#endregion\n\n\treadonly typeId = NO_TYPE_ID; // IMPORTANT: never change this to not break existing assumptions (e.g. backups)\n\n\treadonly capabilities = WorkingCopyCapabilities.Untitled;\n\n\t//#region Name\n\n\tprivate configuredLabelFormat: 'content' | 'name' = 'content';\n\n\tprivate cachedModelFirstLineWords: string | undefined = undefined;\n\tget name(): string {\n\n\t\t// Take name from first line if present and only if\n\t\t// we have no associated file path. In that case we\n\t\t// prefer the file name as title.\n\t\tif (this.configuredLabelFormat === 'content' && !this.hasAssociatedFilePath && this.cachedModelFirstLineWords) {\n\t\t\treturn this.cachedModelFirstLineWords;\n\t\t}\n\n\t\t// Otherwise fallback to resource\n\t\treturn this.labelService.getUriBasenameLabel(this.resource);\n\t}\n\n\t//#endregion\n\n\tconstructor(\n\t\treadonly resource: URI,\n\t\treadonly hasAssociatedFilePath: boolean,\n\t\tprivate readonly initialValue: string | undefined,\n\t\tprivate preferredLanguageId: string | undefined,\n\t\tprivate preferredEncoding: string | undefined,\n\t\t@ILanguageService languageService: ILanguageService,\n\t\t@IModelService modelService: IModelService,\n\t\t@IWorkingCopyBackupService private readonly workingCopyBackupService: IWorkingCopyBackupService,\n\t\t@ITextResourceConfigurationService private readonly textResourceConfigurationService: ITextResourceConfigurationService,\n\t\t@IWorkingCopyService private readonly workingCopyService: IWorkingCopyService,\n\t\t@ITextFileService private readonly textFileService: ITextFileService,\n\t\t@ILabelService private readonly labelService: ILabelService,\n\t\t@IEditorService private readonly editorService: IEditorService,\n\t\t@ILanguageDetectionService languageDetectionService: ILanguageDetectionService,\n\t\t@IAccessibilityService accessibilityService: IAccessibilityService,\n\t) {\n\t\tsuper(modelService, languageService, languageDetectionService, accessibilityService);\n\n\t\tthis.dirty = this.hasAssociatedFilePath || !!this.initialValue;\n\n\t\t// Make known to working copy service\n\t\tthis._register(this.workingCopyService.registerWorkingCopy(this));\n\n\t\t// This is typically controlled by the setting `files.defaultLanguage`.\n\t\t// If that setting is set, we should not detect the language.\n\t\tif (preferredLanguageId) {\n\t\t\tthis.setLanguageId(preferredLanguageId);\n\t\t}\n\n\t\t// Fetch config\n\t\tthis.onConfigurationChange(undefined, false);\n\n\t\tthis.registerListeners();\n\t}\n\n\tprivate registerListeners(): void {\n\n\t\t// Config Changes\n\t\tthis._register(this.textResourceConfigurationService.onDidChangeConfiguration(e => this.onConfigurationChange(e, true)));\n\t}\n\n\tprivate onConfigurationChange(e: ITextResourceConfigurationChangeEvent | undefined, fromEvent: boolean): void {\n\n\t\t// Encoding\n\t\tif (!e || e.affectsConfiguration(this.resource, 'files.encoding')) {\n\t\t\tconst configuredEncoding = this.textResourceConfigurationService.getValue(this.resource, 'files.encoding');\n\t\t\tif (this.configuredEncoding !== configuredEncoding && typeof configuredEncoding === 'string') {\n\t\t\t\tthis.configuredEncoding = configuredEncoding;\n\n\t\t\t\tif (fromEvent && !this.preferredEncoding) {\n\t\t\t\t\tthis._onDidChangeEncoding.fire(); // do not fire event if we have a preferred encoding set\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// Label Format\n\t\tif (!e || e.affectsConfiguration(this.resource, 'workbench.editor.untitled.labelFormat')) {\n\t\t\tconst configuredLabelFormat = this.textResourceConfigurationService.getValue(this.resource, 'workbench.editor.untitled.labelFormat');\n\t\t\tif (this.configuredLabelFormat !== configuredLabelFormat && (configuredLabelFormat === 'content' || configuredLabelFormat === 'name')) {\n\t\t\t\tthis.configuredLabelFormat = configuredLabelFormat;\n\n\t\t\t\tif (fromEvent) {\n\t\t\t\t\tthis._onDidChangeName.fire();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t//#region Language\n\n\toverride setLanguageId(languageId: string, source?: string): void {\n\t\tconst actualLanguage: string | undefined = languageId === UntitledTextEditorModel.ACTIVE_EDITOR_LANGUAGE_ID\n\t\t\t? this.editorService.activeTextEditorLanguageId\n\t\t\t: languageId;\n\t\tthis.preferredLanguageId = actualLanguage;\n\n\t\tif (actualLanguage) {\n\t\t\tsuper.setLanguageId(actualLanguage, source);\n\t\t}\n\t}\n\n\toverride getLanguageId(): string | undefined {\n\t\tif (this.textEditorModel) {\n\t\t\treturn this.textEditorModel.getLanguageId();\n\t\t}\n\n\t\treturn this.preferredLanguageId;\n\t}\n\n\t//#endregion\n\n\t//#region Encoding\n\n\tprivate configuredEncoding: string | undefined;\n\n\tgetEncoding(): string | undefined {\n\t\treturn this.preferredEncoding || this.configuredEncoding;\n\t}\n\n\tasync setEncoding(encoding: string): Promise<void> {\n\t\tconst oldEncoding = this.getEncoding();\n\t\tthis.preferredEncoding = encoding;\n\n\t\t// Emit if it changed\n\t\tif (oldEncoding !== this.preferredEncoding) {\n\t\t\tthis._onDidChangeEncoding.fire();\n\t\t}\n\t}\n\n\t//#endregion\n\n\t//#region Dirty\n\n\tprivate dirty: boolean;\n\n\tisDirty(): boolean {\n\t\treturn this.dirty;\n\t}\n\n\tisModified(): boolean {\n\t\treturn this.isDirty();\n\t}\n\n\tprivate setDirty(dirty: boolean): void {\n\t\tif (this.dirty === dirty) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.dirty = dirty;\n\t\tthis._onDidChangeDirty.fire();\n\t}\n\n\t//#endregion\n\n\t//#region Save / Revert / Backup\n\n\tasync save(options?: ISaveOptions): Promise<boolean> {\n\t\tconst target = await this.textFileService.save(this.resource, options);\n\n\t\t// Emit as event\n\t\tif (target) {\n\t\t\tthis._onDidSave.fire({ reason: options?.reason, source: options?.source });\n\t\t}\n\n\t\treturn !!target;\n\t}\n\n\tasync revert(): Promise<void> {\n\n\t\t// Reset contents to be empty\n\t\tthis.ignoreDirtyOnModelContentChange = true;\n\t\ttry {\n\t\t\tthis.updateTextEditorModel(createTextBufferFactory(''));\n\t\t} finally {\n\t\t\tthis.ignoreDirtyOnModelContentChange = false;\n\t\t}\n\n\t\t// No longer dirty\n\t\tthis.setDirty(false);\n\n\t\t// Emit as event\n\t\tthis._onDidRevert.fire();\n\t}\n\n\tasync backup(token: CancellationToken): Promise<IWorkingCopyBackup> {\n\t\tlet content: VSBufferReadable | undefined = undefined;\n\n\t\t// Make sure to check whether this model has been resolved\n\t\t// or not and fallback to the initial value - if any - to\n\t\t// prevent backing up an unresolved model and loosing the\n\t\t// initial value.\n\t\tif (this.isResolved()) {\n\t\t\t// Fill in content the same way we would do when saving the file\n\t\t\t// via the text file service encoding support (hardcode UTF-8)\n\t\t\tcontent = await this.textFileService.getEncodedReadable(this.resource, this.createSnapshot() ?? undefined, { encoding: UTF8 });\n\t\t} else if (typeof this.initialValue === 'string') {\n\t\t\tcontent = bufferToReadable(VSBuffer.fromString(this.initialValue));\n\t\t}\n\n\t\treturn { content };\n\t}\n\n\t//#endregion\n\n\t//#region Resolve\n\n\tprivate ignoreDirtyOnModelContentChange = false;\n\n\toverride async resolve(): Promise<void> {\n\n\t\t// Create text editor model if not yet done\n\t\tlet createdUntitledModel = false;\n\t\tlet hasBackup = false;\n\t\tif (!this.textEditorModel) {\n\t\t\tlet untitledContents: VSBufferReadableStream;\n\n\t\t\t// Check for backups or use initial value or empty\n\t\t\tconst backup = await this.workingCopyBackupService.resolve(this);\n\t\t\tif (backup) {\n\t\t\t\tuntitledContents = backup.value;\n\t\t\t\thasBackup = true;\n\t\t\t} else {\n\t\t\t\tuntitledContents = bufferToStream(VSBuffer.fromString(this.initialValue || ''));\n\t\t\t}\n\n\t\t\t// Determine untitled contents based on backup\n\t\t\t// or initial value. We must use text file service\n\t\t\t// to create the text factory to respect encodings\n\t\t\t// accordingly.\n\t\t\tconst untitledContentsFactory = await createTextBufferFactoryFromStream(await this.textFileService.getDecodedStream(this.resource, untitledContents, { encoding: UTF8 }));\n\n\t\t\tthis.createTextEditorModel(untitledContentsFactory, this.resource, this.preferredLanguageId);\n\t\t\tcreatedUntitledModel = true;\n\t\t}\n\n\t\t// Otherwise: the untitled model already exists and we must assume\n\t\t// that the value of the model was changed by the user. As such we\n\t\t// do not update the contents, only the language if configured.\n\t\telse {\n\t\t\tthis.updateTextEditorModel(undefined, this.preferredLanguageId);\n\t\t}\n\n\t\t// Listen to text model events\n\t\tconst textEditorModel = assertReturnsDefined(this.textEditorModel);\n\t\tthis.installModelListeners(textEditorModel);\n\n\t\t// Only adjust name and dirty state etc. if we\n\t\t// actually created the untitled model\n\t\tif (createdUntitledModel) {\n\n\t\t\t// Name\n\t\t\tif (hasBackup || this.initialValue) {\n\t\t\t\tthis.updateNameFromFirstLine(textEditorModel);\n\t\t\t}\n\n\t\t\t// Untitled associated to file path are dirty right away as well as untitled with content\n\t\t\tthis.setDirty(this.hasAssociatedFilePath || !!hasBackup || !!this.initialValue);\n\n\t\t\t// If we have initial contents, make sure to emit this\n\t\t\t// as the appropiate events to the outside.\n\t\t\tif (hasBackup || this.initialValue) {\n\t\t\t\tthis._onDidChangeContent.fire();\n\t\t\t}\n\t\t}\n\n\t\treturn super.resolve();\n\t}\n\n\toverride isResolved(): this is IResolvedUntitledTextEditorModel {\n\t\treturn !!this.textEditorModelHandle;\n\t}\n\n\tprotected override installModelListeners(model: ITextModel): void {\n\t\tthis._register(model.onDidChangeContent(e => this.onModelContentChanged(model, e)));\n\t\tthis._register(model.onDidChangeLanguage(() => this.onConfigurationChange(undefined, true))); // language change can have impact on config\n\n\t\tsuper.installModelListeners(model);\n\t}\n\n\tprivate onModelContentChanged(textEditorModel: ITextModel, e: IModelContentChangedEvent): void {\n\t\tif (!this.ignoreDirtyOnModelContentChange) {\n\n\t\t\t// mark the untitled text editor as non-dirty once its content becomes empty and we do\n\t\t\t// not have an associated path set. we never want dirty indicator in that case.\n\t\t\tif (!this.hasAssociatedFilePath && textEditorModel.getLineCount() === 1 && textEditorModel.getLineLength(1) === 0) {\n\t\t\t\tthis.setDirty(false);\n\t\t\t}\n\n\t\t\t// turn dirty otherwise\n\t\t\telse {\n\t\t\t\tthis.setDirty(true);\n\t\t\t}\n\t\t}\n\n\t\t// Check for name change if first line changed in the range of 0-FIRST_LINE_NAME_CANDIDATE_MAX_LENGTH columns\n\t\tif (e.changes.some(change => (change.range.startLineNumber === 1 || change.range.endLineNumber === 1) && change.range.startColumn <= UntitledTextEditorModel.FIRST_LINE_NAME_CANDIDATE_MAX_LENGTH)) {\n\t\t\tthis.updateNameFromFirstLine(textEditorModel);\n\t\t}\n\n\t\t// Emit as general content change event\n\t\tthis._onDidChangeContent.fire();\n\n\t\t// Detect language from content\n\t\tthis.autoDetectLanguage();\n\t}\n\n\tprivate updateNameFromFirstLine(textEditorModel: ITextModel): void {\n\t\tif (this.hasAssociatedFilePath) {\n\t\t\treturn; // not in case of an associated file path\n\t\t}\n\n\t\t// Determine the first words of the model following these rules:\n\t\t// - cannot be only whitespace (so we trim())\n\t\t// - cannot be only non-alphanumeric characters (so we run word definition regex over it)\n\t\t// - cannot be longer than FIRST_LINE_MAX_TITLE_LENGTH\n\t\t// - normalize multiple whitespaces to a single whitespace\n\n\t\tlet modelFirstWordsCandidate: string | undefined = undefined;\n\n\t\tlet firstLineText = textEditorModel\n\t\t\t.getValueInRange({\n\t\t\t\tstartLineNumber: 1,\n\t\t\t\tendLineNumber: 1,\n\t\t\t\tstartColumn: 1,\n\t\t\t\tendColumn: UntitledTextEditorModel.FIRST_LINE_NAME_CANDIDATE_MAX_LENGTH + 1\t\t// first cap at FIRST_LINE_NAME_CANDIDATE_MAX_LENGTH\n\t\t\t})\n\t\t\t.trim().replace(/\\s+/g, ' ') \t\t\t\t\t\t\t\t\t\t\t\t\t\t// normalize whitespaces\n\t\t\t.replace(/\\u202E/g, '');\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// drop Right-to-Left Override character (#190133)\n\t\tfirstLineText = firstLineText.substr(0, getCharContainingOffset(\t\t\t\t\t\t// finally cap at FIRST_LINE_NAME_MAX_LENGTH (grapheme aware #111235)\n\t\t\tfirstLineText,\n\t\t\tUntitledTextEditorModel.FIRST_LINE_NAME_MAX_LENGTH)[0]\n\t\t);\n\n\t\tif (firstLineText && ensureValidWordDefinition().exec(firstLineText)) {\n\t\t\tmodelFirstWordsCandidate = firstLineText;\n\t\t}\n\n\t\tif (modelFirstWordsCandidate !== this.cachedModelFirstLineWords) {\n\t\t\tthis.cachedModelFirstLineWords = modelFirstWordsCandidate;\n\t\t\tthis._onDidChangeName.fire();\n\t\t}\n\t}\n\n\t//#endregion\n\n\toverride isReadonly(): boolean {\n\t\treturn false;\n\t}\n}\n"]}