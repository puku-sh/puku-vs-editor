{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/services/untitled/common/untitledTextEditorInput.ts","vs/workbench/services/untitled/common/untitledTextEditorInput.ts"],"names":[],"mappings":"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","file":"untitledTextEditorInput.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { URI } from '../../../../base/common/uri.js';\nimport { DEFAULT_EDITOR_ASSOCIATION, findViewStateForEditor, isUntitledResourceEditorInput, IUntitledTextResourceEditorInput, IUntypedEditorInput, Verbosity } from '../../../common/editor.js';\nimport { EditorInput, IUntypedEditorOptions } from '../../../common/editor/editorInput.js';\nimport { AbstractTextResourceEditorInput } from '../../../common/editor/textResourceEditorInput.js';\nimport { IUntitledTextEditorModel } from './untitledTextEditorModel.js';\nimport { EncodingMode, IEncodingSupport, ILanguageSupport, ITextFileService } from '../../textfile/common/textfiles.js';\nimport { ILabelService } from '../../../../platform/label/common/label.js';\nimport { IEditorService } from '../../editor/common/editorService.js';\nimport { IFileService } from '../../../../platform/files/common/files.js';\nimport { isEqual, toLocalResource } from '../../../../base/common/resources.js';\nimport { IWorkbenchEnvironmentService } from '../../environment/common/environmentService.js';\nimport { IPathService } from '../../path/common/pathService.js';\nimport { ITextEditorOptions } from '../../../../platform/editor/common/editor.js';\nimport { IFilesConfigurationService } from '../../filesConfiguration/common/filesConfigurationService.js';\nimport { ITextModelService } from '../../../../editor/common/services/resolverService.js';\nimport { DisposableStore, dispose, IReference } from '../../../../base/common/lifecycle.js';\nimport { ITextResourceConfigurationService } from '../../../../editor/common/services/textResourceConfiguration.js';\nimport { ICustomEditorLabelService } from '../../editor/common/customEditorLabelService.js';\n\n/**\n * An editor input to be used for untitled text buffers.\n */\nexport class UntitledTextEditorInput extends AbstractTextResourceEditorInput implements IEncodingSupport, ILanguageSupport {\n\n\tstatic readonly ID: string = 'workbench.editors.untitledEditorInput';\n\n\toverride get typeId(): string {\n\t\treturn UntitledTextEditorInput.ID;\n\t}\n\n\toverride get editorId(): string | undefined {\n\t\treturn DEFAULT_EDITOR_ASSOCIATION.id;\n\t}\n\n\tprivate modelResolve: Promise<void> | undefined = undefined;\n\tprivate readonly modelDisposables = this._register(new DisposableStore());\n\tprivate cachedUntitledTextEditorModelReference: IReference<IUntitledTextEditorModel> | undefined = undefined;\n\n\tconstructor(\n\t\tprotected model: IUntitledTextEditorModel,\n\t\t@ITextFileService textFileService: ITextFileService,\n\t\t@ILabelService labelService: ILabelService,\n\t\t@IEditorService editorService: IEditorService,\n\t\t@IFileService fileService: IFileService,\n\t\t@IWorkbenchEnvironmentService private readonly environmentService: IWorkbenchEnvironmentService,\n\t\t@IPathService private readonly pathService: IPathService,\n\t\t@IFilesConfigurationService filesConfigurationService: IFilesConfigurationService,\n\t\t@ITextModelService private readonly textModelService: ITextModelService,\n\t\t@ITextResourceConfigurationService textResourceConfigurationService: ITextResourceConfigurationService,\n\t\t@ICustomEditorLabelService customEditorLabelService: ICustomEditorLabelService\n\t) {\n\t\tsuper(model.resource, undefined, editorService, textFileService, labelService, fileService, filesConfigurationService, textResourceConfigurationService, customEditorLabelService);\n\n\t\tthis.registerModelListeners(model);\n\n\t\tthis._register(this.textFileService.untitled.onDidCreate(model => this.onDidCreateUntitledModel(model)));\n\t}\n\n\tprivate registerModelListeners(model: IUntitledTextEditorModel): void {\n\t\tthis.modelDisposables.clear();\n\n\t\t// re-emit some events from the model\n\t\tthis.modelDisposables.add(model.onDidChangeDirty(() => this._onDidChangeDirty.fire()));\n\t\tthis.modelDisposables.add(model.onDidChangeName(() => this._onDidChangeLabel.fire()));\n\n\t\t// a reverted untitled text editor model renders this input disposed\n\t\tthis.modelDisposables.add(model.onDidRevert(() => this.dispose()));\n\t}\n\n\tprivate onDidCreateUntitledModel(model: IUntitledTextEditorModel): void {\n\t\tif (isEqual(model.resource, this.model.resource) && model !== this.model) {\n\n\t\t\t// Ensure that we keep our model up to date with\n\t\t\t// the actual model from the service so that we\n\t\t\t// never get out of sync with the truth.\n\n\t\t\tthis.model = model;\n\t\t\tthis.registerModelListeners(model);\n\t\t}\n\t}\n\n\toverride getName(): string {\n\t\treturn this.model.name;\n\t}\n\n\toverride getDescription(verbosity = Verbosity.MEDIUM): string | undefined {\n\n\t\t// Without associated path: only use if name and description differ\n\t\tif (!this.model.hasAssociatedFilePath) {\n\t\t\tconst descriptionCandidate = this.resource.path;\n\t\t\tif (descriptionCandidate !== this.getName()) {\n\t\t\t\treturn descriptionCandidate;\n\t\t\t}\n\n\t\t\treturn undefined;\n\t\t}\n\n\t\t// With associated path: delegate to parent\n\t\treturn super.getDescription(verbosity);\n\t}\n\n\toverride getTitle(verbosity: Verbosity): string {\n\n\t\t// Without associated path: check if name and description differ to decide\n\t\t// if description should appear besides the name to distinguish better\n\t\tif (!this.model.hasAssociatedFilePath) {\n\t\t\tconst name = this.getName();\n\t\t\tconst description = this.getDescription();\n\t\t\tif (description && description !== name) {\n\t\t\t\treturn `${name} • ${description}`;\n\t\t\t}\n\n\t\t\treturn name;\n\t\t}\n\n\t\t// With associated path: delegate to parent\n\t\treturn super.getTitle(verbosity);\n\t}\n\n\toverride isDirty(): boolean {\n\t\treturn this.model.isDirty();\n\t}\n\n\tgetEncoding(): string | undefined {\n\t\treturn this.model.getEncoding();\n\t}\n\n\tsetEncoding(encoding: string, mode: EncodingMode /* ignored, we only have Encode */): Promise<void> {\n\t\treturn this.model.setEncoding(encoding);\n\t}\n\n\tget hasLanguageSetExplicitly() { return this.model.hasLanguageSetExplicitly; }\n\n\tget hasAssociatedFilePath() { return this.model.hasAssociatedFilePath; }\n\n\tsetLanguageId(languageId: string, source?: string): void {\n\t\tthis.model.setLanguageId(languageId, source);\n\t}\n\n\tgetLanguageId(): string | undefined {\n\t\treturn this.model.getLanguageId();\n\t}\n\n\toverride async resolve(): Promise<IUntitledTextEditorModel> {\n\t\tif (!this.modelResolve) {\n\t\t\tthis.modelResolve = (async () => {\n\n\t\t\t\t// Acquire a model reference\n\t\t\t\tthis.cachedUntitledTextEditorModelReference = await this.textModelService.createModelReference(this.resource) as IReference<IUntitledTextEditorModel>;\n\t\t\t})();\n\t\t}\n\n\t\tawait this.modelResolve;\n\n\t\t// It is possible that this input was disposed before the model\n\t\t// finished resolving. As such, we need to make sure to dispose\n\t\t// the model reference to not leak it.\n\t\tif (this.isDisposed()) {\n\t\t\tthis.disposeModelReference();\n\t\t}\n\n\t\treturn this.model;\n\t}\n\n\toverride toUntyped(options?: IUntypedEditorOptions): IUntitledTextResourceEditorInput {\n\t\tconst untypedInput: IUntitledTextResourceEditorInput & { resource: URI | undefined; options: ITextEditorOptions } = {\n\t\t\tresource: this.model.hasAssociatedFilePath ? toLocalResource(this.model.resource, this.environmentService.remoteAuthority, this.pathService.defaultUriScheme) : this.resource,\n\t\t\tforceUntitled: true,\n\t\t\toptions: {\n\t\t\t\toverride: this.editorId\n\t\t\t}\n\t\t};\n\n\t\tif (typeof options?.preserveViewState === 'number') {\n\t\t\tuntypedInput.encoding = this.getEncoding();\n\t\t\tuntypedInput.languageId = this.getLanguageId();\n\t\t\tuntypedInput.contents = this.model.isModified() ? this.model.textEditorModel?.getValue() : undefined;\n\t\t\tuntypedInput.options.viewState = findViewStateForEditor(this, options.preserveViewState, this.editorService);\n\n\t\t\tif (typeof untypedInput.contents === 'string' && !this.model.hasAssociatedFilePath && !options.preserveResource) {\n\t\t\t\t// Given how generic untitled resources in the system are, we\n\t\t\t\t// need to be careful not to set our resource into the untyped\n\t\t\t\t// editor if we want to transport contents too, because of\n\t\t\t\t// issue https://github.com/microsoft/vscode/issues/140898\n\t\t\t\t// The workaround is to simply remove the resource association\n\t\t\t\t// if we have contents and no associated resource.\n\t\t\t\t// In that case we can ensure that a new untitled resource is\n\t\t\t\t// being created and the contents can be restored properly.\n\t\t\t\tuntypedInput.resource = undefined;\n\t\t\t}\n\t\t}\n\n\t\treturn untypedInput;\n\t}\n\n\toverride matches(otherInput: EditorInput | IUntypedEditorInput): boolean {\n\t\tif (this === otherInput) {\n\t\t\treturn true;\n\t\t}\n\n\t\tif (otherInput instanceof UntitledTextEditorInput) {\n\t\t\treturn isEqual(otherInput.resource, this.resource);\n\t\t}\n\n\t\tif (isUntitledResourceEditorInput(otherInput)) {\n\t\t\treturn super.matches(otherInput);\n\t\t}\n\n\t\treturn false;\n\t}\n\n\toverride dispose(): void {\n\n\t\t// Model\n\t\tthis.modelResolve = undefined;\n\n\t\t// Model reference\n\t\tthis.disposeModelReference();\n\n\t\tsuper.dispose();\n\t}\n\n\tprivate disposeModelReference(): void {\n\t\tdispose(this.cachedUntitledTextEditorModelReference);\n\t\tthis.cachedUntitledTextEditorModelReference = undefined;\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { URI } from '../../../../base/common/uri.js';\nimport { DEFAULT_EDITOR_ASSOCIATION, findViewStateForEditor, isUntitledResourceEditorInput, IUntitledTextResourceEditorInput, IUntypedEditorInput, Verbosity } from '../../../common/editor.js';\nimport { EditorInput, IUntypedEditorOptions } from '../../../common/editor/editorInput.js';\nimport { AbstractTextResourceEditorInput } from '../../../common/editor/textResourceEditorInput.js';\nimport { IUntitledTextEditorModel } from './untitledTextEditorModel.js';\nimport { EncodingMode, IEncodingSupport, ILanguageSupport, ITextFileService } from '../../textfile/common/textfiles.js';\nimport { ILabelService } from '../../../../platform/label/common/label.js';\nimport { IEditorService } from '../../editor/common/editorService.js';\nimport { IFileService } from '../../../../platform/files/common/files.js';\nimport { isEqual, toLocalResource } from '../../../../base/common/resources.js';\nimport { IWorkbenchEnvironmentService } from '../../environment/common/environmentService.js';\nimport { IPathService } from '../../path/common/pathService.js';\nimport { ITextEditorOptions } from '../../../../platform/editor/common/editor.js';\nimport { IFilesConfigurationService } from '../../filesConfiguration/common/filesConfigurationService.js';\nimport { ITextModelService } from '../../../../editor/common/services/resolverService.js';\nimport { DisposableStore, dispose, IReference } from '../../../../base/common/lifecycle.js';\nimport { ITextResourceConfigurationService } from '../../../../editor/common/services/textResourceConfiguration.js';\nimport { ICustomEditorLabelService } from '../../editor/common/customEditorLabelService.js';\n\n/**\n * An editor input to be used for untitled text buffers.\n */\nexport class UntitledTextEditorInput extends AbstractTextResourceEditorInput implements IEncodingSupport, ILanguageSupport {\n\n\tstatic readonly ID: string = 'workbench.editors.untitledEditorInput';\n\n\toverride get typeId(): string {\n\t\treturn UntitledTextEditorInput.ID;\n\t}\n\n\toverride get editorId(): string | undefined {\n\t\treturn DEFAULT_EDITOR_ASSOCIATION.id;\n\t}\n\n\tprivate modelResolve: Promise<void> | undefined = undefined;\n\tprivate readonly modelDisposables = this._register(new DisposableStore());\n\tprivate cachedUntitledTextEditorModelReference: IReference<IUntitledTextEditorModel> | undefined = undefined;\n\n\tconstructor(\n\t\tprotected model: IUntitledTextEditorModel,\n\t\t@ITextFileService textFileService: ITextFileService,\n\t\t@ILabelService labelService: ILabelService,\n\t\t@IEditorService editorService: IEditorService,\n\t\t@IFileService fileService: IFileService,\n\t\t@IWorkbenchEnvironmentService private readonly environmentService: IWorkbenchEnvironmentService,\n\t\t@IPathService private readonly pathService: IPathService,\n\t\t@IFilesConfigurationService filesConfigurationService: IFilesConfigurationService,\n\t\t@ITextModelService private readonly textModelService: ITextModelService,\n\t\t@ITextResourceConfigurationService textResourceConfigurationService: ITextResourceConfigurationService,\n\t\t@ICustomEditorLabelService customEditorLabelService: ICustomEditorLabelService\n\t) {\n\t\tsuper(model.resource, undefined, editorService, textFileService, labelService, fileService, filesConfigurationService, textResourceConfigurationService, customEditorLabelService);\n\n\t\tthis.registerModelListeners(model);\n\n\t\tthis._register(this.textFileService.untitled.onDidCreate(model => this.onDidCreateUntitledModel(model)));\n\t}\n\n\tprivate registerModelListeners(model: IUntitledTextEditorModel): void {\n\t\tthis.modelDisposables.clear();\n\n\t\t// re-emit some events from the model\n\t\tthis.modelDisposables.add(model.onDidChangeDirty(() => this._onDidChangeDirty.fire()));\n\t\tthis.modelDisposables.add(model.onDidChangeName(() => this._onDidChangeLabel.fire()));\n\n\t\t// a reverted untitled text editor model renders this input disposed\n\t\tthis.modelDisposables.add(model.onDidRevert(() => this.dispose()));\n\t}\n\n\tprivate onDidCreateUntitledModel(model: IUntitledTextEditorModel): void {\n\t\tif (isEqual(model.resource, this.model.resource) && model !== this.model) {\n\n\t\t\t// Ensure that we keep our model up to date with\n\t\t\t// the actual model from the service so that we\n\t\t\t// never get out of sync with the truth.\n\n\t\t\tthis.model = model;\n\t\t\tthis.registerModelListeners(model);\n\t\t}\n\t}\n\n\toverride getName(): string {\n\t\treturn this.model.name;\n\t}\n\n\toverride getDescription(verbosity = Verbosity.MEDIUM): string | undefined {\n\n\t\t// Without associated path: only use if name and description differ\n\t\tif (!this.model.hasAssociatedFilePath) {\n\t\t\tconst descriptionCandidate = this.resource.path;\n\t\t\tif (descriptionCandidate !== this.getName()) {\n\t\t\t\treturn descriptionCandidate;\n\t\t\t}\n\n\t\t\treturn undefined;\n\t\t}\n\n\t\t// With associated path: delegate to parent\n\t\treturn super.getDescription(verbosity);\n\t}\n\n\toverride getTitle(verbosity: Verbosity): string {\n\n\t\t// Without associated path: check if name and description differ to decide\n\t\t// if description should appear besides the name to distinguish better\n\t\tif (!this.model.hasAssociatedFilePath) {\n\t\t\tconst name = this.getName();\n\t\t\tconst description = this.getDescription();\n\t\t\tif (description && description !== name) {\n\t\t\t\treturn `${name} • ${description}`;\n\t\t\t}\n\n\t\t\treturn name;\n\t\t}\n\n\t\t// With associated path: delegate to parent\n\t\treturn super.getTitle(verbosity);\n\t}\n\n\toverride isDirty(): boolean {\n\t\treturn this.model.isDirty();\n\t}\n\n\tgetEncoding(): string | undefined {\n\t\treturn this.model.getEncoding();\n\t}\n\n\tsetEncoding(encoding: string, mode: EncodingMode /* ignored, we only have Encode */): Promise<void> {\n\t\treturn this.model.setEncoding(encoding);\n\t}\n\n\tget hasLanguageSetExplicitly() { return this.model.hasLanguageSetExplicitly; }\n\n\tget hasAssociatedFilePath() { return this.model.hasAssociatedFilePath; }\n\n\tsetLanguageId(languageId: string, source?: string): void {\n\t\tthis.model.setLanguageId(languageId, source);\n\t}\n\n\tgetLanguageId(): string | undefined {\n\t\treturn this.model.getLanguageId();\n\t}\n\n\toverride async resolve(): Promise<IUntitledTextEditorModel> {\n\t\tif (!this.modelResolve) {\n\t\t\tthis.modelResolve = (async () => {\n\n\t\t\t\t// Acquire a model reference\n\t\t\t\tthis.cachedUntitledTextEditorModelReference = await this.textModelService.createModelReference(this.resource) as IReference<IUntitledTextEditorModel>;\n\t\t\t})();\n\t\t}\n\n\t\tawait this.modelResolve;\n\n\t\t// It is possible that this input was disposed before the model\n\t\t// finished resolving. As such, we need to make sure to dispose\n\t\t// the model reference to not leak it.\n\t\tif (this.isDisposed()) {\n\t\t\tthis.disposeModelReference();\n\t\t}\n\n\t\treturn this.model;\n\t}\n\n\toverride toUntyped(options?: IUntypedEditorOptions): IUntitledTextResourceEditorInput {\n\t\tconst untypedInput: IUntitledTextResourceEditorInput & { resource: URI | undefined; options: ITextEditorOptions } = {\n\t\t\tresource: this.model.hasAssociatedFilePath ? toLocalResource(this.model.resource, this.environmentService.remoteAuthority, this.pathService.defaultUriScheme) : this.resource,\n\t\t\tforceUntitled: true,\n\t\t\toptions: {\n\t\t\t\toverride: this.editorId\n\t\t\t}\n\t\t};\n\n\t\tif (typeof options?.preserveViewState === 'number') {\n\t\t\tuntypedInput.encoding = this.getEncoding();\n\t\t\tuntypedInput.languageId = this.getLanguageId();\n\t\t\tuntypedInput.contents = this.model.isModified() ? this.model.textEditorModel?.getValue() : undefined;\n\t\t\tuntypedInput.options.viewState = findViewStateForEditor(this, options.preserveViewState, this.editorService);\n\n\t\t\tif (typeof untypedInput.contents === 'string' && !this.model.hasAssociatedFilePath && !options.preserveResource) {\n\t\t\t\t// Given how generic untitled resources in the system are, we\n\t\t\t\t// need to be careful not to set our resource into the untyped\n\t\t\t\t// editor if we want to transport contents too, because of\n\t\t\t\t// issue https://github.com/microsoft/vscode/issues/140898\n\t\t\t\t// The workaround is to simply remove the resource association\n\t\t\t\t// if we have contents and no associated resource.\n\t\t\t\t// In that case we can ensure that a new untitled resource is\n\t\t\t\t// being created and the contents can be restored properly.\n\t\t\t\tuntypedInput.resource = undefined;\n\t\t\t}\n\t\t}\n\n\t\treturn untypedInput;\n\t}\n\n\toverride matches(otherInput: EditorInput | IUntypedEditorInput): boolean {\n\t\tif (this === otherInput) {\n\t\t\treturn true;\n\t\t}\n\n\t\tif (otherInput instanceof UntitledTextEditorInput) {\n\t\t\treturn isEqual(otherInput.resource, this.resource);\n\t\t}\n\n\t\tif (isUntitledResourceEditorInput(otherInput)) {\n\t\t\treturn super.matches(otherInput);\n\t\t}\n\n\t\treturn false;\n\t}\n\n\toverride dispose(): void {\n\n\t\t// Model\n\t\tthis.modelResolve = undefined;\n\n\t\t// Model reference\n\t\tthis.disposeModelReference();\n\n\t\tsuper.dispose();\n\t}\n\n\tprivate disposeModelReference(): void {\n\t\tdispose(this.cachedUntitledTextEditorModelReference);\n\t\tthis.cachedUntitledTextEditorModelReference = undefined;\n\t}\n}\n"]}