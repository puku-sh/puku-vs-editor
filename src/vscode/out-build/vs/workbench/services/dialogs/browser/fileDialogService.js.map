{"version":3,"sources":["vs/workbench/services/dialogs/browser/fileDialogService.ts"],"names":[],"mappings":"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","file":"fileDialogService.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { IPickAndOpenOptions, ISaveDialogOptions, IOpenDialogOptions, IFileDialogService, FileFilter, IPromptButton } from '../../../../platform/dialogs/common/dialogs.js';\nimport { URI } from '../../../../base/common/uri.js';\nimport { InstantiationType, registerSingleton } from '../../../../platform/instantiation/common/extensions.js';\nimport { AbstractFileDialogService } from './abstractFileDialogService.js';\nimport { Schemas } from '../../../../base/common/network.js';\nimport { memoize } from '../../../../base/common/decorators.js';\nimport { HTMLFileSystemProvider } from '../../../../platform/files/browser/htmlFileSystemProvider.js';\nimport { localize } from '../../../../nls.js';\nimport { getMediaOrTextMime } from '../../../../base/common/mime.js';\nimport { basename } from '../../../../base/common/resources.js';\nimport { getActiveWindow, triggerDownload, triggerUpload } from '../../../../base/browser/dom.js';\nimport Severity from '../../../../base/common/severity.js';\nimport { VSBuffer } from '../../../../base/common/buffer.js';\nimport { extractFileListData } from '../../../../platform/dnd/browser/dnd.js';\nimport { Iterable } from '../../../../base/common/iterator.js';\nimport { WebFileSystemAccess } from '../../../../platform/files/browser/webFileSystemAccess.js';\nimport { EmbeddedCodeEditorWidget } from '../../../../editor/browser/widget/codeEditor/embeddedCodeEditorWidget.js';\n\nexport class FileDialogService extends AbstractFileDialogService implements IFileDialogService {\n\n\t@memoize\n\tprivate get fileSystemProvider(): HTMLFileSystemProvider {\n\t\treturn this.fileService.getProvider(Schemas.file) as HTMLFileSystemProvider;\n\t}\n\n\tasync pickFileFolderAndOpen(options: IPickAndOpenOptions): Promise<void> {\n\t\tconst schema = this.getFileSystemSchema(options);\n\n\t\tif (!options.defaultUri) {\n\t\t\toptions.defaultUri = await this.defaultFilePath(schema);\n\t\t}\n\n\t\tif (this.shouldUseSimplified(schema)) {\n\t\t\treturn super.pickFileFolderAndOpenSimplified(schema, options, false);\n\t\t}\n\n\t\tthrow new Error(localize('pickFolderAndOpen', \"Can't open folders, try adding a folder to the workspace instead.\"));\n\t}\n\n\tprotected override addFileSchemaIfNeeded(schema: string, isFolder: boolean): string[] {\n\t\treturn (schema === Schemas.untitled) ? [Schemas.file]\n\t\t\t: (((schema !== Schemas.file) && (!isFolder || (schema !== Schemas.vscodeRemote))) ? [schema, Schemas.file] : [schema]);\n\t}\n\n\tasync pickFileAndOpen(options: IPickAndOpenOptions): Promise<void> {\n\t\tconst schema = this.getFileSystemSchema(options);\n\n\t\tif (!options.defaultUri) {\n\t\t\toptions.defaultUri = await this.defaultFilePath(schema);\n\t\t}\n\n\t\tif (this.shouldUseSimplified(schema)) {\n\t\t\treturn super.pickFileAndOpenSimplified(schema, options, false);\n\t\t}\n\n\t\tconst activeWindow = getActiveWindow();\n\t\tif (!WebFileSystemAccess.supported(activeWindow)) {\n\t\t\treturn this.showUnsupportedBrowserWarning('open');\n\t\t}\n\n\t\tlet fileHandle: FileSystemHandle | undefined = undefined;\n\t\ttry {\n\t\t\t([fileHandle] = await activeWindow.showOpenFilePicker({ multiple: false }));\n\t\t} catch (error) {\n\t\t\treturn; // `showOpenFilePicker` will throw an error when the user cancels\n\t\t}\n\n\t\tif (!WebFileSystemAccess.isFileSystemFileHandle(fileHandle)) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst uri = await this.fileSystemProvider.registerFileHandle(fileHandle);\n\n\t\tthis.addFileToRecentlyOpened(uri);\n\n\t\tawait this.openerService.open(uri, { fromUserGesture: true, editorOptions: { pinned: true } });\n\t}\n\n\tasync pickFolderAndOpen(options: IPickAndOpenOptions): Promise<void> {\n\t\tconst schema = this.getFileSystemSchema(options);\n\n\t\tif (!options.defaultUri) {\n\t\t\toptions.defaultUri = await this.defaultFolderPath(schema);\n\t\t}\n\n\t\tif (this.shouldUseSimplified(schema)) {\n\t\t\treturn super.pickFolderAndOpenSimplified(schema, options);\n\t\t}\n\n\t\tthrow new Error(localize('pickFolderAndOpen', \"Can't open folders, try adding a folder to the workspace instead.\"));\n\t}\n\n\tasync pickWorkspaceAndOpen(options: IPickAndOpenOptions): Promise<void> {\n\t\toptions.availableFileSystems = this.getWorkspaceAvailableFileSystems(options);\n\t\tconst schema = this.getFileSystemSchema(options);\n\n\t\tif (!options.defaultUri) {\n\t\t\toptions.defaultUri = await this.defaultWorkspacePath(schema);\n\t\t}\n\n\t\tif (this.shouldUseSimplified(schema)) {\n\t\t\treturn super.pickWorkspaceAndOpenSimplified(schema, options);\n\t\t}\n\n\t\tthrow new Error(localize('pickWorkspaceAndOpen', \"Can't open workspaces, try adding a folder to the workspace instead.\"));\n\t}\n\n\tasync pickFileToSave(defaultUri: URI, availableFileSystems?: string[]): Promise<URI | undefined> {\n\t\tconst schema = this.getFileSystemSchema({ defaultUri, availableFileSystems });\n\n\t\tconst options = this.getPickFileToSaveDialogOptions(defaultUri, availableFileSystems);\n\t\tif (this.shouldUseSimplified(schema)) {\n\t\t\treturn super.pickFileToSaveSimplified(schema, options);\n\t\t}\n\n\t\tconst activeWindow = getActiveWindow();\n\t\tif (!WebFileSystemAccess.supported(activeWindow)) {\n\t\t\treturn this.showUnsupportedBrowserWarning('save');\n\t\t}\n\n\t\tlet fileHandle: FileSystemHandle | undefined = undefined;\n\t\tconst startIn = Iterable.first(this.fileSystemProvider.directories);\n\n\t\ttry {\n\t\t\tfileHandle = await activeWindow.showSaveFilePicker({ types: this.getFilePickerTypes(options.filters), ...{ suggestedName: basename(defaultUri), startIn } });\n\t\t} catch (error) {\n\t\t\treturn; // `showSaveFilePicker` will throw an error when the user cancels\n\t\t}\n\n\t\tif (!WebFileSystemAccess.isFileSystemFileHandle(fileHandle)) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\treturn this.fileSystemProvider.registerFileHandle(fileHandle);\n\t}\n\n\tprivate getFilePickerTypes(filters?: FileFilter[]): FilePickerAcceptType[] | undefined {\n\t\treturn filters?.filter(filter => {\n\t\t\treturn !((filter.extensions.length === 1) && ((filter.extensions[0] === '*') || filter.extensions[0] === ''));\n\t\t}).map((filter): FilePickerAcceptType => {\n\t\t\tconst accept: Record<MIMEType, FileExtension[]> = {};\n\t\t\tconst extensions = filter.extensions.filter(ext => (ext.indexOf('-') < 0) && (ext.indexOf('*') < 0) && (ext.indexOf('_') < 0));\n\t\t\taccept[(getMediaOrTextMime(`fileName.${filter.extensions[0]}`) ?? 'text/plain') as MIMEType] = extensions.map(ext => ext.startsWith('.') ? ext : `.${ext}`) as FileExtension[];\n\t\t\treturn {\n\t\t\t\tdescription: filter.name,\n\t\t\t\taccept\n\t\t\t};\n\t\t});\n\t}\n\n\tasync showSaveDialog(options: ISaveDialogOptions): Promise<URI | undefined> {\n\t\tconst schema = this.getFileSystemSchema(options);\n\n\t\tif (this.shouldUseSimplified(schema)) {\n\t\t\treturn super.showSaveDialogSimplified(schema, options);\n\t\t}\n\n\t\tconst activeWindow = getActiveWindow();\n\t\tif (!WebFileSystemAccess.supported(activeWindow)) {\n\t\t\treturn this.showUnsupportedBrowserWarning('save');\n\t\t}\n\n\t\tlet fileHandle: FileSystemHandle | undefined = undefined;\n\t\tconst startIn = Iterable.first(this.fileSystemProvider.directories);\n\n\t\ttry {\n\t\t\tfileHandle = await activeWindow.showSaveFilePicker({ types: this.getFilePickerTypes(options.filters), ...options.defaultUri ? { suggestedName: basename(options.defaultUri) } : undefined, ...{ startIn } });\n\t\t} catch (error) {\n\t\t\treturn undefined; // `showSaveFilePicker` will throw an error when the user cancels\n\t\t}\n\n\t\tif (!WebFileSystemAccess.isFileSystemFileHandle(fileHandle)) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\treturn this.fileSystemProvider.registerFileHandle(fileHandle);\n\t}\n\n\tasync showOpenDialog(options: IOpenDialogOptions): Promise<URI[] | undefined> {\n\t\tconst schema = this.getFileSystemSchema(options);\n\n\t\tif (this.shouldUseSimplified(schema)) {\n\t\t\treturn super.showOpenDialogSimplified(schema, options);\n\t\t}\n\n\t\tconst activeWindow = getActiveWindow();\n\t\tif (!WebFileSystemAccess.supported(activeWindow)) {\n\t\t\treturn this.showUnsupportedBrowserWarning('open');\n\t\t}\n\n\t\tlet uri: URI | undefined;\n\t\tconst startIn = Iterable.first(this.fileSystemProvider.directories) ?? 'documents';\n\n\t\ttry {\n\t\t\tif (options.canSelectFiles) {\n\t\t\t\tconst handle = await activeWindow.showOpenFilePicker({ multiple: false, types: this.getFilePickerTypes(options.filters), ...{ startIn } });\n\t\t\t\tif (handle.length === 1 && WebFileSystemAccess.isFileSystemFileHandle(handle[0])) {\n\t\t\t\t\turi = await this.fileSystemProvider.registerFileHandle(handle[0]);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tconst handle = await activeWindow.showDirectoryPicker({ ...{ startIn } });\n\t\t\t\turi = await this.fileSystemProvider.registerDirectoryHandle(handle);\n\t\t\t}\n\t\t} catch (error) {\n\t\t\t// ignore - `showOpenFilePicker` / `showDirectoryPicker` will throw an error when the user cancels\n\t\t}\n\n\t\treturn uri ? [uri] : undefined;\n\t}\n\n\tprivate async showUnsupportedBrowserWarning(context: 'save' | 'open'): Promise<undefined> {\n\n\t\t// When saving, try to just download the contents\n\t\t// of the active text editor if any as a workaround\n\t\tif (context === 'save') {\n\t\t\tconst activeCodeEditor = this.codeEditorService.getActiveCodeEditor();\n\t\t\tif (!(activeCodeEditor instanceof EmbeddedCodeEditorWidget)) {\n\t\t\t\tconst activeTextModel = activeCodeEditor?.getModel();\n\t\t\t\tif (activeTextModel) {\n\t\t\t\t\ttriggerDownload(VSBuffer.fromString(activeTextModel.getValue()).buffer, basename(activeTextModel.uri));\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// Otherwise inform the user about options\n\n\t\tconst buttons: IPromptButton<void>[] = [\n\t\t\t{\n\t\t\t\tlabel: localize({ key: 'openRemote', comment: ['&& denotes a mnemonic'] }, \"&&Open Remote...\"),\n\t\t\t\trun: async () => { await this.commandService.executeCommand('workbench.action.remote.showMenu'); }\n\t\t\t},\n\t\t\t{\n\t\t\t\tlabel: localize({ key: 'learnMore', comment: ['&& denotes a mnemonic'] }, \"&&Learn More\"),\n\t\t\t\trun: async () => { await this.openerService.open('https://aka.ms/VSCodeWebLocalFileSystemAccess'); }\n\t\t\t}\n\t\t];\n\t\tif (context === 'open') {\n\t\t\tbuttons.push({\n\t\t\t\tlabel: localize({ key: 'openFiles', comment: ['&& denotes a mnemonic'] }, \"Open &&Files...\"),\n\t\t\t\trun: async () => {\n\t\t\t\t\tconst files = await triggerUpload();\n\t\t\t\t\tif (files) {\n\t\t\t\t\t\tconst filesData = (await this.instantiationService.invokeFunction(accessor => extractFileListData(accessor, files))).filter(fileData => !fileData.isDirectory);\n\t\t\t\t\t\tif (filesData.length > 0) {\n\t\t\t\t\t\t\tthis.editorService.openEditors(filesData.map(fileData => {\n\t\t\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\t\t\tresource: fileData.resource,\n\t\t\t\t\t\t\t\t\tcontents: fileData.contents?.toString(),\n\t\t\t\t\t\t\t\t\toptions: { pinned: true }\n\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t}));\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tawait this.dialogService.prompt({\n\t\t\ttype: Severity.Warning,\n\t\t\tmessage: localize('unsupportedBrowserMessage', \"Opening Local Folders is Unsupported\"),\n\t\t\tdetail: localize('unsupportedBrowserDetail', \"Your browser doesn't support opening local folders.\\nYou can either open single files or open a remote repository.\"),\n\t\t\tbuttons\n\t\t});\n\n\t\treturn undefined;\n\t}\n\n\tprivate shouldUseSimplified(scheme: string): boolean {\n\t\treturn ![Schemas.file, Schemas.vscodeUserData, Schemas.tmp].includes(scheme);\n\t}\n}\n\nregisterSingleton(IFileDialogService, FileDialogService, InstantiationType.Delayed);\n"]}