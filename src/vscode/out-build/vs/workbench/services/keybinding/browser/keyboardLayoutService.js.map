{"version":3,"sources":["vs/workbench/services/keybinding/browser/keyboardLayoutService.ts"],"names":[],"mappings":"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","file":"keyboardLayoutService.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as nls from '../../../../nls.js';\nimport { Emitter, Event } from '../../../../base/common/event.js';\nimport { AppResourcePath, FileAccess } from '../../../../base/common/network.js';\nimport { Disposable } from '../../../../base/common/lifecycle.js';\nimport { KeymapInfo, IRawMixedKeyboardMapping, IKeymapInfo } from '../common/keymapInfo.js';\nimport { InstantiationType, registerSingleton } from '../../../../platform/instantiation/common/extensions.js';\nimport { DispatchConfig, readKeyboardConfig } from '../../../../platform/keyboardLayout/common/keyboardConfig.js';\nimport { IKeyboardMapper, CachedKeyboardMapper } from '../../../../platform/keyboardLayout/common/keyboardMapper.js';\nimport { OS, OperatingSystem, isMacintosh, isWindows } from '../../../../base/common/platform.js';\nimport { WindowsKeyboardMapper } from '../common/windowsKeyboardMapper.js';\nimport { FallbackKeyboardMapper } from '../common/fallbackKeyboardMapper.js';\nimport { IKeyboardEvent } from '../../../../platform/keybinding/common/keybinding.js';\nimport { MacLinuxKeyboardMapper } from '../common/macLinuxKeyboardMapper.js';\nimport { StandardKeyboardEvent } from '../../../../base/browser/keyboardEvent.js';\nimport { URI } from '../../../../base/common/uri.js';\nimport { IFileService } from '../../../../platform/files/common/files.js';\nimport { RunOnceScheduler } from '../../../../base/common/async.js';\nimport { parse, getNodeType } from '../../../../base/common/json.js';\nimport * as objects from '../../../../base/common/objects.js';\nimport { IEnvironmentService } from '../../../../platform/environment/common/environment.js';\nimport { Registry } from '../../../../platform/registry/common/platform.js';\nimport { Extensions as ConfigExtensions, IConfigurationRegistry, IConfigurationNode } from '../../../../platform/configuration/common/configurationRegistry.js';\nimport { IConfigurationService } from '../../../../platform/configuration/common/configuration.js';\nimport { INavigatorWithKeyboard } from './navigatorKeyboard.js';\nimport { INotificationService } from '../../../../platform/notification/common/notification.js';\nimport { ICommandService } from '../../../../platform/commands/common/commands.js';\nimport { IStorageService } from '../../../../platform/storage/common/storage.js';\nimport { getKeyboardLayoutId, IKeyboardLayoutInfo, IKeyboardLayoutService, IKeyboardMapping, IMacLinuxKeyboardMapping, IWindowsKeyboardMapping } from '../../../../platform/keyboardLayout/common/keyboardLayout.js';\n\nexport class BrowserKeyboardMapperFactoryBase extends Disposable {\n\t// keyboard mapper\n\tprotected _initialized: boolean;\n\tprotected _keyboardMapper: IKeyboardMapper | null;\n\tprivate readonly _onDidChangeKeyboardMapper = new Emitter<void>();\n\tpublic readonly onDidChangeKeyboardMapper: Event<void> = this._onDidChangeKeyboardMapper.event;\n\n\t// keymap infos\n\tprotected _keymapInfos: KeymapInfo[];\n\tprotected _mru: KeymapInfo[];\n\tprivate _activeKeymapInfo: KeymapInfo | null;\n\tprivate keyboardLayoutMapAllowed: boolean = (navigator as INavigatorWithKeyboard).keyboard !== undefined;\n\n\tget activeKeymap(): KeymapInfo | null {\n\t\treturn this._activeKeymapInfo;\n\t}\n\n\tget keymapInfos(): KeymapInfo[] {\n\t\treturn this._keymapInfos;\n\t}\n\n\tget activeKeyboardLayout(): IKeyboardLayoutInfo | null {\n\t\tif (!this._initialized) {\n\t\t\treturn null;\n\t\t}\n\n\t\treturn this._activeKeymapInfo?.layout ?? null;\n\t}\n\n\tget activeKeyMapping(): IKeyboardMapping | null {\n\t\tif (!this._initialized) {\n\t\t\treturn null;\n\t\t}\n\n\t\treturn this._activeKeymapInfo?.mapping ?? null;\n\t}\n\n\tget keyboardLayouts(): IKeyboardLayoutInfo[] {\n\t\treturn this._keymapInfos.map(keymapInfo => keymapInfo.layout);\n\t}\n\n\tprotected constructor(\n\t\tprivate readonly _configurationService: IConfigurationService,\n\t\t// private _notificationService: INotificationService,\n\t\t// private _storageService: IStorageService,\n\t\t// private _commandService: ICommandService\n\t) {\n\t\tsuper();\n\t\tthis._keyboardMapper = null;\n\t\tthis._initialized = false;\n\t\tthis._keymapInfos = [];\n\t\tthis._mru = [];\n\t\tthis._activeKeymapInfo = null;\n\n\t\tif ((<INavigatorWithKeyboard>navigator).keyboard && (<INavigatorWithKeyboard>navigator).keyboard.addEventListener) {\n\t\t\t(<INavigatorWithKeyboard>navigator).keyboard.addEventListener!('layoutchange', () => {\n\t\t\t\t// Update user keyboard map settings\n\t\t\t\tthis._getBrowserKeyMapping().then((mapping: IKeyboardMapping | null) => {\n\t\t\t\t\tif (this.isKeyMappingActive(mapping)) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.setLayoutFromBrowserAPI();\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\n\t\tthis._register(this._configurationService.onDidChangeConfiguration((e) => {\n\t\t\tif (e.affectsConfiguration('keyboard')) {\n\t\t\t\tthis._keyboardMapper = null;\n\t\t\t\tthis._onDidChangeKeyboardMapper.fire();\n\t\t\t}\n\t\t}));\n\t}\n\n\tregisterKeyboardLayout(layout: KeymapInfo) {\n\t\tthis._keymapInfos.push(layout);\n\t\tthis._mru = this._keymapInfos;\n\t}\n\n\tremoveKeyboardLayout(layout: KeymapInfo): void {\n\t\tlet index = this._mru.indexOf(layout);\n\t\tthis._mru.splice(index, 1);\n\t\tindex = this._keymapInfos.indexOf(layout);\n\t\tthis._keymapInfos.splice(index, 1);\n\t}\n\n\tgetMatchedKeymapInfo(keyMapping: IKeyboardMapping | null): { result: KeymapInfo; score: number } | null {\n\t\tif (!keyMapping) {\n\t\t\treturn null;\n\t\t}\n\n\t\tconst usStandard = this.getUSStandardLayout();\n\n\t\tif (usStandard) {\n\t\t\tlet maxScore = usStandard.getScore(keyMapping);\n\t\t\tif (maxScore === 0) {\n\t\t\t\treturn {\n\t\t\t\t\tresult: usStandard,\n\t\t\t\t\tscore: 0\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tlet result = usStandard;\n\t\t\tfor (let i = 0; i < this._mru.length; i++) {\n\t\t\t\tconst score = this._mru[i].getScore(keyMapping);\n\t\t\t\tif (score > maxScore) {\n\t\t\t\t\tif (score === 0) {\n\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\tresult: this._mru[i],\n\t\t\t\t\t\t\tscore: 0\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\n\t\t\t\t\tmaxScore = score;\n\t\t\t\t\tresult = this._mru[i];\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\tresult,\n\t\t\t\tscore: maxScore\n\t\t\t};\n\t\t}\n\n\t\tfor (let i = 0; i < this._mru.length; i++) {\n\t\t\tif (this._mru[i].fuzzyEqual(keyMapping)) {\n\t\t\t\treturn {\n\t\t\t\t\tresult: this._mru[i],\n\t\t\t\t\tscore: 0\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tgetUSStandardLayout() {\n\t\tconst usStandardLayouts = this._mru.filter(layout => layout.layout.isUSStandard);\n\n\t\tif (usStandardLayouts.length) {\n\t\t\treturn usStandardLayouts[0];\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tisKeyMappingActive(keymap: IKeyboardMapping | null) {\n\t\treturn this._activeKeymapInfo && keymap && this._activeKeymapInfo.fuzzyEqual(keymap);\n\t}\n\n\tsetUSKeyboardLayout() {\n\t\tthis._activeKeymapInfo = this.getUSStandardLayout();\n\t}\n\n\tsetActiveKeyMapping(keymap: IKeyboardMapping | null) {\n\t\tlet keymapUpdated = false;\n\t\tconst matchedKeyboardLayout = this.getMatchedKeymapInfo(keymap);\n\t\tif (matchedKeyboardLayout) {\n\t\t\t// let score = matchedKeyboardLayout.score;\n\n\t\t\t// Due to https://bugs.chromium.org/p/chromium/issues/detail?id=977609, any key after a dead key will generate a wrong mapping,\n\t\t\t// we shoud avoid yielding the false error.\n\t\t\t// if (keymap && score < 0) {\n\t\t\t// const donotAskUpdateKey = 'missing.keyboardlayout.donotask';\n\t\t\t// if (this._storageService.getBoolean(donotAskUpdateKey, StorageScope.APPLICATION)) {\n\t\t\t// \treturn;\n\t\t\t// }\n\n\t\t\t// the keyboard layout doesn't actually match the key event or the keymap from chromium\n\t\t\t// this._notificationService.prompt(\n\t\t\t// \tSeverity.Info,\n\t\t\t// \tnls.localize('missing.keyboardlayout', 'Fail to find matching keyboard layout'),\n\t\t\t// \t[{\n\t\t\t// \t\tlabel: nls.localize('keyboardLayoutMissing.configure', \"Configure\"),\n\t\t\t// \t\trun: () => this._commandService.executeCommand('workbench.action.openKeyboardLayoutPicker')\n\t\t\t// \t}, {\n\t\t\t// \t\tlabel: nls.localize('neverAgain', \"Don't Show Again\"),\n\t\t\t// \t\tisSecondary: true,\n\t\t\t// \t\trun: () => this._storageService.store(donotAskUpdateKey, true, StorageScope.APPLICATION)\n\t\t\t// \t}]\n\t\t\t// );\n\n\t\t\t// console.warn('Active keymap/keyevent does not match current keyboard layout', JSON.stringify(keymap), this._activeKeymapInfo ? JSON.stringify(this._activeKeymapInfo.layout) : '');\n\n\t\t\t// return;\n\t\t\t// }\n\n\t\t\tif (!this._activeKeymapInfo) {\n\t\t\t\tthis._activeKeymapInfo = matchedKeyboardLayout.result;\n\t\t\t\tkeymapUpdated = true;\n\t\t\t} else if (keymap) {\n\t\t\t\tif (matchedKeyboardLayout.result.getScore(keymap) > this._activeKeymapInfo.getScore(keymap)) {\n\t\t\t\t\tthis._activeKeymapInfo = matchedKeyboardLayout.result;\n\t\t\t\t\tkeymapUpdated = true;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (!this._activeKeymapInfo) {\n\t\t\tthis._activeKeymapInfo = this.getUSStandardLayout();\n\t\t\tkeymapUpdated = true;\n\t\t}\n\n\t\tif (!this._activeKeymapInfo || !keymapUpdated) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst index = this._mru.indexOf(this._activeKeymapInfo);\n\n\t\tthis._mru.splice(index, 1);\n\t\tthis._mru.unshift(this._activeKeymapInfo);\n\n\t\tthis._setKeyboardData(this._activeKeymapInfo);\n\t}\n\n\tsetActiveKeymapInfo(keymapInfo: KeymapInfo) {\n\t\tthis._activeKeymapInfo = keymapInfo;\n\n\t\tconst index = this._mru.indexOf(this._activeKeymapInfo);\n\n\t\tif (index === 0) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._mru.splice(index, 1);\n\t\tthis._mru.unshift(this._activeKeymapInfo);\n\n\t\tthis._setKeyboardData(this._activeKeymapInfo);\n\t}\n\n\tpublic setLayoutFromBrowserAPI(): void {\n\t\tthis._updateKeyboardLayoutAsync(this._initialized);\n\t}\n\n\tprivate _updateKeyboardLayoutAsync(initialized: boolean, keyboardEvent?: IKeyboardEvent) {\n\t\tif (!initialized) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._getBrowserKeyMapping(keyboardEvent).then(keyMap => {\n\t\t\t// might be false positive\n\t\t\tif (this.isKeyMappingActive(keyMap)) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis.setActiveKeyMapping(keyMap);\n\t\t});\n\t}\n\n\tpublic getKeyboardMapper(): IKeyboardMapper {\n\t\tconst config = readKeyboardConfig(this._configurationService);\n\t\tif (config.dispatch === DispatchConfig.KeyCode || !this._initialized || !this._activeKeymapInfo) {\n\t\t\t// Forcefully set to use keyCode\n\t\t\treturn new FallbackKeyboardMapper(config.mapAltGrToCtrlAlt, OS);\n\t\t}\n\t\tif (!this._keyboardMapper) {\n\t\t\tthis._keyboardMapper = new CachedKeyboardMapper(BrowserKeyboardMapperFactory._createKeyboardMapper(this._activeKeymapInfo, config.mapAltGrToCtrlAlt));\n\t\t}\n\t\treturn this._keyboardMapper;\n\t}\n\n\tpublic validateCurrentKeyboardMapping(keyboardEvent: IKeyboardEvent): void {\n\t\tif (!this._initialized) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst isCurrentKeyboard = this._validateCurrentKeyboardMapping(keyboardEvent);\n\n\t\tif (isCurrentKeyboard) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._updateKeyboardLayoutAsync(true, keyboardEvent);\n\t}\n\n\tpublic setKeyboardLayout(layoutName: string) {\n\t\tconst matchedLayouts: KeymapInfo[] = this.keymapInfos.filter(keymapInfo => getKeyboardLayoutId(keymapInfo.layout) === layoutName);\n\n\t\tif (matchedLayouts.length > 0) {\n\t\t\tthis.setActiveKeymapInfo(matchedLayouts[0]);\n\t\t}\n\t}\n\n\tprivate _setKeyboardData(keymapInfo: KeymapInfo): void {\n\t\tthis._initialized = true;\n\n\t\tthis._keyboardMapper = null;\n\t\tthis._onDidChangeKeyboardMapper.fire();\n\t}\n\n\tprivate static _createKeyboardMapper(keymapInfo: KeymapInfo, mapAltGrToCtrlAlt: boolean): IKeyboardMapper {\n\t\tconst rawMapping = keymapInfo.mapping;\n\t\tconst isUSStandard = !!keymapInfo.layout.isUSStandard;\n\t\tif (OS === OperatingSystem.Windows) {\n\t\t\treturn new WindowsKeyboardMapper(isUSStandard, <IWindowsKeyboardMapping>rawMapping, mapAltGrToCtrlAlt);\n\t\t}\n\t\tif (Object.keys(rawMapping).length === 0) {\n\t\t\t// Looks like reading the mappings failed (most likely Mac + Japanese/Chinese keyboard layouts)\n\t\t\treturn new FallbackKeyboardMapper(mapAltGrToCtrlAlt, OS);\n\t\t}\n\n\t\treturn new MacLinuxKeyboardMapper(isUSStandard, <IMacLinuxKeyboardMapping>rawMapping, mapAltGrToCtrlAlt, OS);\n\t}\n\n\t//#region Browser API\n\tprivate _validateCurrentKeyboardMapping(keyboardEvent: IKeyboardEvent): boolean {\n\t\tif (!this._initialized) {\n\t\t\treturn true;\n\t\t}\n\n\t\tconst standardKeyboardEvent = keyboardEvent as StandardKeyboardEvent;\n\t\tconst currentKeymap = this._activeKeymapInfo;\n\t\tif (!currentKeymap) {\n\t\t\treturn true;\n\t\t}\n\n\t\tif (standardKeyboardEvent.browserEvent.key === 'Dead' || standardKeyboardEvent.browserEvent.isComposing) {\n\t\t\treturn true;\n\t\t}\n\n\t\tconst mapping = currentKeymap.mapping[standardKeyboardEvent.code];\n\n\t\tif (!mapping) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif (mapping.value === '') {\n\t\t\t// The value is empty when the key is not a printable character, we skip validation.\n\t\t\tif (keyboardEvent.ctrlKey || keyboardEvent.metaKey) {\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tthis._getBrowserKeyMapping().then((keymap: IRawMixedKeyboardMapping | null) => {\n\t\t\t\t\t\tif (this.isKeyMappingActive(keymap)) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tthis.setLayoutFromBrowserAPI();\n\t\t\t\t\t});\n\t\t\t\t}, 350);\n\t\t\t}\n\t\t\treturn true;\n\t\t}\n\n\t\tconst expectedValue = standardKeyboardEvent.altKey && standardKeyboardEvent.shiftKey ? mapping.withShiftAltGr :\n\t\t\tstandardKeyboardEvent.altKey ? mapping.withAltGr :\n\t\t\t\tstandardKeyboardEvent.shiftKey ? mapping.withShift : mapping.value;\n\n\t\tconst isDead = (standardKeyboardEvent.altKey && standardKeyboardEvent.shiftKey && mapping.withShiftAltGrIsDeadKey) ||\n\t\t\t(standardKeyboardEvent.altKey && mapping.withAltGrIsDeadKey) ||\n\t\t\t(standardKeyboardEvent.shiftKey && mapping.withShiftIsDeadKey) ||\n\t\t\tmapping.valueIsDeadKey;\n\n\t\tif (isDead && standardKeyboardEvent.browserEvent.key !== 'Dead') {\n\t\t\treturn false;\n\t\t}\n\n\t\t// TODO, this assumption is wrong as `browserEvent.key` doesn't necessarily equal expectedValue from real keymap\n\t\tif (!isDead && standardKeyboardEvent.browserEvent.key !== expectedValue) {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t}\n\n\tprivate async _getBrowserKeyMapping(keyboardEvent?: IKeyboardEvent): Promise<IRawMixedKeyboardMapping | null> {\n\t\tif (this.keyboardLayoutMapAllowed) {\n\t\t\ttry {\n\t\t\t\treturn await (navigator as INavigatorWithKeyboard).keyboard.getLayoutMap().then((e: any) => {\n\t\t\t\t\tconst ret: IKeyboardMapping = {};\n\t\t\t\t\tfor (const key of e) {\n\t\t\t\t\t\tret[key[0]] = {\n\t\t\t\t\t\t\t'value': key[1],\n\t\t\t\t\t\t\t'withShift': '',\n\t\t\t\t\t\t\t'withAltGr': '',\n\t\t\t\t\t\t\t'withShiftAltGr': ''\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\n\t\t\t\t\treturn ret;\n\n\t\t\t\t\t// const matchedKeyboardLayout = this.getMatchedKeymapInfo(ret);\n\n\t\t\t\t\t// if (matchedKeyboardLayout) {\n\t\t\t\t\t// \treturn matchedKeyboardLayout.result.mapping;\n\t\t\t\t\t// }\n\n\t\t\t\t\t// return null;\n\t\t\t\t});\n\t\t\t} catch {\n\t\t\t\t// getLayoutMap can throw if invoked from a nested browsing context\n\t\t\t\tthis.keyboardLayoutMapAllowed = false;\n\t\t\t}\n\t\t}\n\t\tif (keyboardEvent && !keyboardEvent.shiftKey && !keyboardEvent.altKey && !keyboardEvent.metaKey && !keyboardEvent.metaKey) {\n\t\t\tconst ret: IKeyboardMapping = {};\n\t\t\tconst standardKeyboardEvent = keyboardEvent as StandardKeyboardEvent;\n\t\t\tret[standardKeyboardEvent.browserEvent.code] = {\n\t\t\t\t'value': standardKeyboardEvent.browserEvent.key,\n\t\t\t\t'withShift': '',\n\t\t\t\t'withAltGr': '',\n\t\t\t\t'withShiftAltGr': ''\n\t\t\t};\n\n\t\t\tconst matchedKeyboardLayout = this.getMatchedKeymapInfo(ret);\n\n\t\t\tif (matchedKeyboardLayout) {\n\t\t\t\treturn ret;\n\t\t\t}\n\n\t\t\treturn null;\n\t\t}\n\n\t\treturn null;\n\t}\n\n\t//#endregion\n}\n\nexport class BrowserKeyboardMapperFactory extends BrowserKeyboardMapperFactoryBase {\n\tconstructor(configurationService: IConfigurationService, notificationService: INotificationService, storageService: IStorageService, commandService: ICommandService) {\n\t\t// super(notificationService, storageService, commandService);\n\t\tsuper(configurationService);\n\n\t\tconst platform = isWindows ? 'win' : isMacintosh ? 'darwin' : 'linux';\n\n\t\timport(FileAccess.asBrowserUri(`vs/workbench/services/keybinding/browser/keyboardLayouts/layout.contribution.${platform}.js` satisfies AppResourcePath).path).then((m) => {\n\t\t\tconst keymapInfos: IKeymapInfo[] = m.KeyboardLayoutContribution.INSTANCE.layoutInfos;\n\t\t\tthis._keymapInfos.push(...keymapInfos.map(info => (new KeymapInfo(info.layout, info.secondaryLayouts, info.mapping, info.isUserKeyboardLayout))));\n\t\t\tthis._mru = this._keymapInfos;\n\t\t\tthis._initialized = true;\n\t\t\tthis.setLayoutFromBrowserAPI();\n\t\t});\n\t}\n}\n\nclass UserKeyboardLayout extends Disposable {\n\n\tprivate readonly reloadConfigurationScheduler: RunOnceScheduler;\n\tprotected readonly _onDidChange: Emitter<void> = this._register(new Emitter<void>());\n\treadonly onDidChange: Event<void> = this._onDidChange.event;\n\n\tprivate _keyboardLayout: KeymapInfo | null;\n\tget keyboardLayout(): KeymapInfo | null { return this._keyboardLayout; }\n\n\tconstructor(\n\t\tprivate readonly keyboardLayoutResource: URI,\n\t\tprivate readonly fileService: IFileService\n\t) {\n\t\tsuper();\n\n\t\tthis._keyboardLayout = null;\n\n\t\tthis.reloadConfigurationScheduler = this._register(new RunOnceScheduler(() => this.reload().then(changed => {\n\t\t\tif (changed) {\n\t\t\t\tthis._onDidChange.fire();\n\t\t\t}\n\t\t}), 50));\n\n\t\tthis._register(Event.filter(this.fileService.onDidFilesChange, e => e.contains(this.keyboardLayoutResource))(() => this.reloadConfigurationScheduler.schedule()));\n\t}\n\n\tasync initialize(): Promise<void> {\n\t\tawait this.reload();\n\t}\n\n\tprivate async reload(): Promise<boolean> {\n\t\tconst existing = this._keyboardLayout;\n\t\ttry {\n\t\t\tconst content = await this.fileService.readFile(this.keyboardLayoutResource);\n\t\t\tconst value = parse(content.value.toString());\n\t\t\tif (getNodeType(value) === 'object') {\n\t\t\t\tconst layoutInfo = value.layout;\n\t\t\t\tconst mappings = value.rawMapping;\n\t\t\t\tthis._keyboardLayout = KeymapInfo.createKeyboardLayoutFromDebugInfo(layoutInfo, mappings, true);\n\t\t\t} else {\n\t\t\t\tthis._keyboardLayout = null;\n\t\t\t}\n\t\t} catch (e) {\n\t\t\tthis._keyboardLayout = null;\n\t\t}\n\n\t\treturn existing ? !objects.equals(existing, this._keyboardLayout) : true;\n\t}\n\n}\n\nexport class BrowserKeyboardLayoutService extends Disposable implements IKeyboardLayoutService {\n\tpublic _serviceBrand: undefined;\n\n\tprivate readonly _onDidChangeKeyboardLayout = new Emitter<void>();\n\tpublic readonly onDidChangeKeyboardLayout: Event<void> = this._onDidChangeKeyboardLayout.event;\n\n\tprivate _userKeyboardLayout: UserKeyboardLayout;\n\n\tprivate readonly _factory: BrowserKeyboardMapperFactory;\n\tprivate _keyboardLayoutMode: string;\n\n\tconstructor(\n\t\t@IEnvironmentService environmentService: IEnvironmentService,\n\t\t@IFileService fileService: IFileService,\n\t\t@INotificationService notificationService: INotificationService,\n\t\t@IStorageService storageService: IStorageService,\n\t\t@ICommandService commandService: ICommandService,\n\t\t@IConfigurationService private configurationService: IConfigurationService,\n\t) {\n\t\tsuper();\n\t\tconst keyboardConfig = configurationService.getValue<{ layout: string }>('keyboard');\n\t\tconst layout = keyboardConfig.layout;\n\t\tthis._keyboardLayoutMode = layout ?? 'autodetect';\n\t\tthis._factory = new BrowserKeyboardMapperFactory(configurationService, notificationService, storageService, commandService);\n\n\t\tthis._register(this._factory.onDidChangeKeyboardMapper(() => {\n\t\t\tthis._onDidChangeKeyboardLayout.fire();\n\t\t}));\n\n\t\tif (layout && layout !== 'autodetect') {\n\t\t\t// set keyboard layout\n\t\t\tthis._factory.setKeyboardLayout(layout);\n\t\t}\n\n\t\tthis._register(configurationService.onDidChangeConfiguration(e => {\n\t\t\tif (e.affectsConfiguration('keyboard.layout')) {\n\t\t\t\tconst keyboardConfig = configurationService.getValue<{ layout: string }>('keyboard');\n\t\t\t\tconst layout = keyboardConfig.layout;\n\t\t\t\tthis._keyboardLayoutMode = layout;\n\n\t\t\t\tif (layout === 'autodetect') {\n\t\t\t\t\tthis._factory.setLayoutFromBrowserAPI();\n\t\t\t\t} else {\n\t\t\t\t\tthis._factory.setKeyboardLayout(layout);\n\t\t\t\t}\n\t\t\t}\n\t\t}));\n\n\t\tthis._userKeyboardLayout = new UserKeyboardLayout(environmentService.keyboardLayoutResource, fileService);\n\t\tthis._userKeyboardLayout.initialize().then(() => {\n\t\t\tif (this._userKeyboardLayout.keyboardLayout) {\n\t\t\t\tthis._factory.registerKeyboardLayout(this._userKeyboardLayout.keyboardLayout);\n\n\t\t\t\tthis.setUserKeyboardLayoutIfMatched();\n\t\t\t}\n\t\t});\n\n\t\tthis._register(this._userKeyboardLayout.onDidChange(() => {\n\t\t\tconst userKeyboardLayouts = this._factory.keymapInfos.filter(layout => layout.isUserKeyboardLayout);\n\n\t\t\tif (userKeyboardLayouts.length) {\n\t\t\t\tif (this._userKeyboardLayout.keyboardLayout) {\n\t\t\t\t\tuserKeyboardLayouts[0].update(this._userKeyboardLayout.keyboardLayout);\n\t\t\t\t} else {\n\t\t\t\t\tthis._factory.removeKeyboardLayout(userKeyboardLayouts[0]);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif (this._userKeyboardLayout.keyboardLayout) {\n\t\t\t\t\tthis._factory.registerKeyboardLayout(this._userKeyboardLayout.keyboardLayout);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis.setUserKeyboardLayoutIfMatched();\n\t\t}));\n\t}\n\n\tsetUserKeyboardLayoutIfMatched() {\n\t\tconst keyboardConfig = this.configurationService.getValue<{ layout: string }>('keyboard');\n\t\tconst layout = keyboardConfig.layout;\n\n\t\tif (layout && this._userKeyboardLayout.keyboardLayout) {\n\t\t\tif (getKeyboardLayoutId(this._userKeyboardLayout.keyboardLayout.layout) === layout && this._factory.activeKeymap) {\n\n\t\t\t\tif (!this._userKeyboardLayout.keyboardLayout.equal(this._factory.activeKeymap)) {\n\t\t\t\t\tthis._factory.setActiveKeymapInfo(this._userKeyboardLayout.keyboardLayout);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tgetKeyboardMapper(): IKeyboardMapper {\n\t\treturn this._factory.getKeyboardMapper();\n\t}\n\n\tpublic getCurrentKeyboardLayout(): IKeyboardLayoutInfo | null {\n\t\treturn this._factory.activeKeyboardLayout;\n\t}\n\n\tpublic getAllKeyboardLayouts(): IKeyboardLayoutInfo[] {\n\t\treturn this._factory.keyboardLayouts;\n\t}\n\n\tpublic getRawKeyboardMapping(): IKeyboardMapping | null {\n\t\treturn this._factory.activeKeyMapping;\n\t}\n\n\tpublic validateCurrentKeyboardMapping(keyboardEvent: IKeyboardEvent): void {\n\t\tif (this._keyboardLayoutMode !== 'autodetect') {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._factory.validateCurrentKeyboardMapping(keyboardEvent);\n\t}\n}\n\nregisterSingleton(IKeyboardLayoutService, BrowserKeyboardLayoutService, InstantiationType.Delayed);\n\n// Configuration\nconst configurationRegistry = Registry.as<IConfigurationRegistry>(ConfigExtensions.Configuration);\nconst keyboardConfiguration: IConfigurationNode = {\n\t'id': 'keyboard',\n\t'order': 15,\n\t'type': 'object',\n\t'title': nls.localize('keyboardConfigurationTitle', \"Keyboard\"),\n\t'properties': {\n\t\t'keyboard.layout': {\n\t\t\t'type': 'string',\n\t\t\t'default': 'autodetect',\n\t\t\t'description': nls.localize('keyboard.layout.config', \"Control the keyboard layout used in web.\")\n\t\t}\n\t}\n};\n\nconfigurationRegistry.registerConfiguration(keyboardConfiguration);\n"]}