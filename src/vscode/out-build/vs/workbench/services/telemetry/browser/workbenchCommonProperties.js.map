{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/services/telemetry/browser/workbenchCommonProperties.ts","vs/workbench/services/telemetry/browser/workbenchCommonProperties.ts"],"names":[],"mappings":"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","file":"workbenchCommonProperties.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { IStorageService, StorageScope, StorageTarget } from '../../../../platform/storage/common/storage.js';\nimport * as Platform from '../../../../base/common/platform.js';\nimport * as uuid from '../../../../base/common/uuid.js';\nimport { cleanRemoteAuthority } from '../../../../platform/telemetry/common/telemetryUtils.js';\nimport { mixin } from '../../../../base/common/objects.js';\nimport { ICommonProperties, firstSessionDateStorageKey, lastSessionDateStorageKey, machineIdKey } from '../../../../platform/telemetry/common/telemetry.js';\nimport { Gesture } from '../../../../base/browser/touch.js';\n\n/**\n * General function to help reduce the individuality of user agents\n * @param userAgent userAgent from browser window\n * @returns A simplified user agent with less detail\n */\nfunction cleanUserAgent(userAgent: string): string {\n\treturn userAgent.replace(/(\\d+\\.\\d+)(\\.\\d+)+/g, '$1');\n}\n\nexport function resolveWorkbenchCommonProperties(\n\tstorageService: IStorageService,\n\tcommit: string | undefined,\n\tversion: string | undefined,\n\tisInternalTelemetry: boolean,\n\tremoteAuthority?: string,\n\tproductIdentifier?: string,\n\tremoveMachineId?: boolean,\n\tresolveAdditionalProperties?: () => { [key: string]: unknown }\n): ICommonProperties {\n\tconst result: ICommonProperties = Object.create(null);\n\tconst firstSessionDate = storageService.get(firstSessionDateStorageKey, StorageScope.APPLICATION)!;\n\tconst lastSessionDate = storageService.get(lastSessionDateStorageKey, StorageScope.APPLICATION)!;\n\n\tlet machineId: string | undefined;\n\tif (!removeMachineId) {\n\t\tmachineId = storageService.get(machineIdKey, StorageScope.APPLICATION);\n\t\tif (!machineId) {\n\t\t\tmachineId = uuid.generateUuid();\n\t\t\tstorageService.store(machineIdKey, machineId, StorageScope.APPLICATION, StorageTarget.MACHINE);\n\t\t}\n\t} else {\n\t\tmachineId = `Redacted-${productIdentifier ?? 'web'}`;\n\t}\n\n\n\t/**\n\t * Note: In the web, session date information is fetched from browser storage, so these dates are tied to a specific\n\t * browser and not the machine overall.\n\t */\n\t// __GDPR__COMMON__ \"common.firstSessionDate\" : { \"classification\": \"SystemMetaData\", \"purpose\": \"FeatureInsight\" }\n\tresult['common.firstSessionDate'] = firstSessionDate;\n\t// __GDPR__COMMON__ \"common.lastSessionDate\" : { \"classification\": \"SystemMetaData\", \"purpose\": \"FeatureInsight\" }\n\tresult['common.lastSessionDate'] = lastSessionDate || '';\n\t// __GDPR__COMMON__ \"common.isNewSession\" : { \"classification\": \"SystemMetaData\", \"purpose\": \"FeatureInsight\" }\n\tresult['common.isNewSession'] = !lastSessionDate ? '1' : '0';\n\t// __GDPR__COMMON__ \"common.remoteAuthority\" : { \"classification\": \"SystemMetaData\", \"purpose\": \"PerformanceAndHealth\" }\n\tresult['common.remoteAuthority'] = cleanRemoteAuthority(remoteAuthority);\n\n\t// __GDPR__COMMON__ \"common.machineId\" : { \"endPoint\": \"MacAddressHash\", \"classification\": \"EndUserPseudonymizedInformation\", \"purpose\": \"FeatureInsight\" }\n\tresult['common.machineId'] = machineId;\n\t// __GDPR__COMMON__ \"sessionID\" : { \"classification\": \"SystemMetaData\", \"purpose\": \"FeatureInsight\" }\n\tresult['sessionID'] = uuid.generateUuid() + Date.now();\n\t// __GDPR__COMMON__ \"commitHash\" : { \"classification\": \"SystemMetaData\", \"purpose\": \"PerformanceAndHealth\" }\n\tresult['commitHash'] = commit;\n\t// __GDPR__COMMON__ \"version\" : { \"classification\": \"SystemMetaData\", \"purpose\": \"FeatureInsight\" }\n\tresult['version'] = version;\n\t// __GDPR__COMMON__ \"common.platform\" : { \"classification\": \"SystemMetaData\", \"purpose\": \"FeatureInsight\" }\n\tresult['common.platform'] = Platform.PlatformToString(Platform.platform);\n\t// __GDPR__COMMON__ \"common.product\" : { \"classification\": \"SystemMetaData\", \"purpose\": \"PerformanceAndHealth\" }\n\tresult['common.product'] = productIdentifier ?? 'web';\n\t// __GDPR__COMMON__ \"common.userAgent\" : { \"classification\": \"SystemMetaData\", \"purpose\": \"FeatureInsight\" }\n\tresult['common.userAgent'] = Platform.userAgent ? cleanUserAgent(Platform.userAgent) : undefined;\n\t// __GDPR__COMMON__ \"common.isTouchDevice\" : { \"classification\": \"SystemMetaData\", \"purpose\": \"FeatureInsight\" }\n\tresult['common.isTouchDevice'] = String(Gesture.isTouchDevice());\n\n\tif (isInternalTelemetry) {\n\t\t// __GDPR__COMMON__ \"common.msftInternal\" : { \"classification\": \"SystemMetaData\", \"purpose\": \"FeatureInsight\", \"isMeasurement\": true }\n\t\tresult['common.msftInternal'] = isInternalTelemetry;\n\t}\n\n\t// dynamic properties which value differs on each call\n\tlet seq = 0;\n\tconst startTime = Date.now();\n\tObject.defineProperties(result, {\n\t\t// __GDPR__COMMON__ \"timestamp\" : { \"classification\": \"SystemMetaData\", \"purpose\": \"FeatureInsight\" }\n\t\t'timestamp': {\n\t\t\tget: () => new Date(),\n\t\t\tenumerable: true\n\t\t},\n\t\t// __GDPR__COMMON__ \"common.timesincesessionstart\" : { \"classification\": \"SystemMetaData\", \"purpose\": \"FeatureInsight\", \"isMeasurement\": true }\n\t\t'common.timesincesessionstart': {\n\t\t\tget: () => Date.now() - startTime,\n\t\t\tenumerable: true\n\t\t},\n\t\t// __GDPR__COMMON__ \"common.sequence\" : { \"classification\": \"SystemMetaData\", \"purpose\": \"FeatureInsight\", \"isMeasurement\": true }\n\t\t'common.sequence': {\n\t\t\tget: () => seq++,\n\t\t\tenumerable: true\n\t\t}\n\t});\n\n\tif (resolveAdditionalProperties) {\n\t\tmixin(result, resolveAdditionalProperties());\n\t}\n\n\treturn result;\n}\n\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { IStorageService, StorageScope, StorageTarget } from '../../../../platform/storage/common/storage.js';\nimport * as Platform from '../../../../base/common/platform.js';\nimport * as uuid from '../../../../base/common/uuid.js';\nimport { cleanRemoteAuthority } from '../../../../platform/telemetry/common/telemetryUtils.js';\nimport { mixin } from '../../../../base/common/objects.js';\nimport { ICommonProperties, firstSessionDateStorageKey, lastSessionDateStorageKey, machineIdKey } from '../../../../platform/telemetry/common/telemetry.js';\nimport { Gesture } from '../../../../base/browser/touch.js';\n\n/**\n * General function to help reduce the individuality of user agents\n * @param userAgent userAgent from browser window\n * @returns A simplified user agent with less detail\n */\nfunction cleanUserAgent(userAgent: string): string {\n\treturn userAgent.replace(/(\\d+\\.\\d+)(\\.\\d+)+/g, '$1');\n}\n\nexport function resolveWorkbenchCommonProperties(\n\tstorageService: IStorageService,\n\tcommit: string | undefined,\n\tversion: string | undefined,\n\tisInternalTelemetry: boolean,\n\tremoteAuthority?: string,\n\tproductIdentifier?: string,\n\tremoveMachineId?: boolean,\n\tresolveAdditionalProperties?: () => { [key: string]: unknown }\n): ICommonProperties {\n\tconst result: ICommonProperties = Object.create(null);\n\tconst firstSessionDate = storageService.get(firstSessionDateStorageKey, StorageScope.APPLICATION)!;\n\tconst lastSessionDate = storageService.get(lastSessionDateStorageKey, StorageScope.APPLICATION)!;\n\n\tlet machineId: string | undefined;\n\tif (!removeMachineId) {\n\t\tmachineId = storageService.get(machineIdKey, StorageScope.APPLICATION);\n\t\tif (!machineId) {\n\t\t\tmachineId = uuid.generateUuid();\n\t\t\tstorageService.store(machineIdKey, machineId, StorageScope.APPLICATION, StorageTarget.MACHINE);\n\t\t}\n\t} else {\n\t\tmachineId = `Redacted-${productIdentifier ?? 'web'}`;\n\t}\n\n\n\t/**\n\t * Note: In the web, session date information is fetched from browser storage, so these dates are tied to a specific\n\t * browser and not the machine overall.\n\t */\n\t// __GDPR__COMMON__ \"common.firstSessionDate\" : { \"classification\": \"SystemMetaData\", \"purpose\": \"FeatureInsight\" }\n\tresult['common.firstSessionDate'] = firstSessionDate;\n\t// __GDPR__COMMON__ \"common.lastSessionDate\" : { \"classification\": \"SystemMetaData\", \"purpose\": \"FeatureInsight\" }\n\tresult['common.lastSessionDate'] = lastSessionDate || '';\n\t// __GDPR__COMMON__ \"common.isNewSession\" : { \"classification\": \"SystemMetaData\", \"purpose\": \"FeatureInsight\" }\n\tresult['common.isNewSession'] = !lastSessionDate ? '1' : '0';\n\t// __GDPR__COMMON__ \"common.remoteAuthority\" : { \"classification\": \"SystemMetaData\", \"purpose\": \"PerformanceAndHealth\" }\n\tresult['common.remoteAuthority'] = cleanRemoteAuthority(remoteAuthority);\n\n\t// __GDPR__COMMON__ \"common.machineId\" : { \"endPoint\": \"MacAddressHash\", \"classification\": \"EndUserPseudonymizedInformation\", \"purpose\": \"FeatureInsight\" }\n\tresult['common.machineId'] = machineId;\n\t// __GDPR__COMMON__ \"sessionID\" : { \"classification\": \"SystemMetaData\", \"purpose\": \"FeatureInsight\" }\n\tresult['sessionID'] = uuid.generateUuid() + Date.now();\n\t// __GDPR__COMMON__ \"commitHash\" : { \"classification\": \"SystemMetaData\", \"purpose\": \"PerformanceAndHealth\" }\n\tresult['commitHash'] = commit;\n\t// __GDPR__COMMON__ \"version\" : { \"classification\": \"SystemMetaData\", \"purpose\": \"FeatureInsight\" }\n\tresult['version'] = version;\n\t// __GDPR__COMMON__ \"common.platform\" : { \"classification\": \"SystemMetaData\", \"purpose\": \"FeatureInsight\" }\n\tresult['common.platform'] = Platform.PlatformToString(Platform.platform);\n\t// __GDPR__COMMON__ \"common.product\" : { \"classification\": \"SystemMetaData\", \"purpose\": \"PerformanceAndHealth\" }\n\tresult['common.product'] = productIdentifier ?? 'web';\n\t// __GDPR__COMMON__ \"common.userAgent\" : { \"classification\": \"SystemMetaData\", \"purpose\": \"FeatureInsight\" }\n\tresult['common.userAgent'] = Platform.userAgent ? cleanUserAgent(Platform.userAgent) : undefined;\n\t// __GDPR__COMMON__ \"common.isTouchDevice\" : { \"classification\": \"SystemMetaData\", \"purpose\": \"FeatureInsight\" }\n\tresult['common.isTouchDevice'] = String(Gesture.isTouchDevice());\n\n\tif (isInternalTelemetry) {\n\t\t// __GDPR__COMMON__ \"common.msftInternal\" : { \"classification\": \"SystemMetaData\", \"purpose\": \"FeatureInsight\", \"isMeasurement\": true }\n\t\tresult['common.msftInternal'] = isInternalTelemetry;\n\t}\n\n\t// dynamic properties which value differs on each call\n\tlet seq = 0;\n\tconst startTime = Date.now();\n\tObject.defineProperties(result, {\n\t\t// __GDPR__COMMON__ \"timestamp\" : { \"classification\": \"SystemMetaData\", \"purpose\": \"FeatureInsight\" }\n\t\t'timestamp': {\n\t\t\tget: () => new Date(),\n\t\t\tenumerable: true\n\t\t},\n\t\t// __GDPR__COMMON__ \"common.timesincesessionstart\" : { \"classification\": \"SystemMetaData\", \"purpose\": \"FeatureInsight\", \"isMeasurement\": true }\n\t\t'common.timesincesessionstart': {\n\t\t\tget: () => Date.now() - startTime,\n\t\t\tenumerable: true\n\t\t},\n\t\t// __GDPR__COMMON__ \"common.sequence\" : { \"classification\": \"SystemMetaData\", \"purpose\": \"FeatureInsight\", \"isMeasurement\": true }\n\t\t'common.sequence': {\n\t\t\tget: () => seq++,\n\t\t\tenumerable: true\n\t\t}\n\t});\n\n\tif (resolveAdditionalProperties) {\n\t\tmixin(result, resolveAdditionalProperties());\n\t}\n\n\treturn result;\n}\n\n"]}