{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/services/aiSettingsSearch/common/aiSettingsSearchService.ts","vs/workbench/services/aiSettingsSearch/common/aiSettingsSearchService.ts"],"names":[],"mappings":"AAAA;;;gGAGgG;AAEhG,OAAO,EAAE,eAAe,EAAE,gBAAgB,EAAE,MAAM,kCAAkC,CAAC;AAErF,OAAO,EAAE,OAAO,EAAS,MAAM,kCAAkC,CAAC;AAClE,OAAO,EAAE,UAAU,EAAe,MAAM,sCAAsC,CAAC;AAC/E,OAAO,EAAqB,iBAAiB,EAAE,MAAM,yDAAyD,CAAC;AAC/G,OAAO,EAA0B,0BAA0B,EAA6B,wBAAwB,EAAE,MAAM,uBAAuB,CAAC;AAEhJ,MAAM,OAAO,uBAAwB,SAAQ,UAAU;IAAvD;;QAIS,eAAU,GAAgC,EAAE,CAAC;QAC7C,8BAAyB,GAA2C,IAAI,GAAG,EAAE,CAAC;QAC9E,+BAA0B,GAA2C,IAAI,GAAG,EAAE,CAAC;QAE/E,0BAAqB,GAAkB,IAAI,CAAC,SAAS,CAAC,IAAI,OAAO,EAAQ,CAAC,CAAC;QAC1E,yBAAoB,GAAgB,IAAI,CAAC,qBAAqB,CAAC,KAAK,CAAC;IAyF/E,CAAC;aAhGwB,cAAS,GAAG,CAAH,AAAI,CAAC;IAStC,SAAS;QACR,OAAO,IAAI,CAAC,UAAU,CAAC,MAAM,GAAG,CAAC,CAAC;IACnC,CAAC;IAED,8BAA8B,CAAC,QAAmC;QACjE,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;QAC/B,IAAI,CAAC,qBAAqB,CAAC,IAAI,EAAE,CAAC;QAClC,OAAO;YACN,OAAO,EAAE,GAAG,EAAE;gBACb,MAAM,KAAK,GAAG,IAAI,CAAC,UAAU,CAAC,OAAO,CAAC,QAAQ,CAAC,CAAC;gBAChD,IAAI,KAAK,KAAK,CAAC,CAAC,EAAE,CAAC;oBAClB,IAAI,CAAC,UAAU,CAAC,MAAM,CAAC,KAAK,EAAE,CAAC,CAAC,CAAC;gBAClC,CAAC;YACF,CAAC;SACD,CAAC;IACH,CAAC;IAED,WAAW,CAAC,KAAa,EAAE,cAAuB,EAAE,KAAwB;QAC3E,IAAI,CAAC,IAAI,CAAC,SAAS,EAAE,EAAE,CAAC;YACvB,MAAM,IAAI,KAAK,CAAC,yCAAyC,CAAC,CAAC;QAC5D,CAAC;QAED,IAAI,CAAC,0BAA0B,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC;QAC9C,IAAI,CAAC,yBAAyB,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC;QAE7C,IAAI,CAAC,UAAU,CAAC,OAAO,CAAC,QAAQ,CAAC,EAAE,CAAC,QAAQ,CAAC,cAAc,CAAC,KAAK,EAAE,EAAE,KAAK,EAAE,uBAAuB,CAAC,SAAS,EAAE,cAAc,EAAE,EAAE,KAAK,CAAC,CAAC,CAAC;IAC1I,CAAC;IAED,KAAK,CAAC,oBAAoB,CAAC,KAAa,EAAE,KAAwB;QACjE,IAAI,CAAC,IAAI,CAAC,SAAS,EAAE,EAAE,CAAC;YACvB,MAAM,IAAI,KAAK,CAAC,yCAAyC,CAAC,CAAC;QAC5D,CAAC;QAED,MAAM,eAAe,GAAG,IAAI,CAAC,0BAA0B,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC;QACnE,IAAI,eAAe,EAAE,CAAC;YACrB,MAAM,MAAM,GAAG,MAAM,eAAe,CAAC,CAAC,CAAC;YACvC,OAAO,MAAM,IAAI,IAAI,CAAC;QACvB,CAAC;QAED,MAAM,OAAO,GAAG,IAAI,eAAe,EAAY,CAAC;QAChD,IAAI,CAAC,0BAA0B,CAAC,GAAG,CAAC,KAAK,EAAE,OAAO,CAAC,CAAC;QACpD,MAAM,MAAM,GAAG,MAAM,gBAAgB,CAAC,OAAO,CAAC,CAAC,EAAE,KAAK,CAAC,CAAC;QACxD,OAAO,MAAM,IAAI,IAAI,CAAC;IACvB,CAAC;IAED,KAAK,CAAC,mBAAmB,CAAC,KAAa,EAAE,KAAwB;QAChE,IAAI,CAAC,IAAI,CAAC,SAAS,EAAE,EAAE,CAAC;YACvB,MAAM,IAAI,KAAK,CAAC,yCAAyC,CAAC,CAAC;QAC5D,CAAC;QAED,MAAM,eAAe,GAAG,IAAI,CAAC,yBAAyB,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC;QAClE,IAAI,eAAe,EAAE,CAAC;YACrB,MAAM,MAAM,GAAG,MAAM,eAAe,CAAC,CAAC,CAAC;YACvC,OAAO,MAAM,IAAI,IAAI,CAAC;QACvB,CAAC;QAED,MAAM,OAAO,GAAG,IAAI,eAAe,EAAY,CAAC;QAChD,IAAI,CAAC,yBAAyB,CAAC,GAAG,CAAC,KAAK,EAAE,OAAO,CAAC,CAAC;QACnD,MAAM,MAAM,GAAG,MAAM,gBAAgB,CAAC,OAAO,CAAC,CAAC,EAAE,KAAK,CAAC,CAAC;QACxD,OAAO,MAAM,IAAI,IAAI,CAAC;IACvB,CAAC;IAED,kBAAkB,CAAC,MAA8B;QAChD,IAAI,CAAC,IAAI,CAAC,SAAS,EAAE,EAAE,CAAC;YACvB,OAAO;QACR,CAAC;QAED,IAAI,MAAM,CAAC,IAAI,KAAK,0BAA0B,CAAC,QAAQ,EAAE,CAAC;YACzD,MAAM,OAAO,GAAG,IAAI,CAAC,0BAA0B,CAAC,GAAG,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC;YAClE,IAAI,OAAO,EAAE,CAAC;gBACb,OAAO,CAAC,QAAQ,CAAC,MAAM,CAAC,QAAQ,CAAC,CAAC;YACnC,CAAC;iBAAM,CAAC;gBACP,MAAM,aAAa,GAAG,IAAI,eAAe,EAAY,CAAC;gBACtD,aAAa,CAAC,QAAQ,CAAC,MAAM,CAAC,QAAQ,CAAC,CAAC;gBACxC,IAAI,CAAC,0BAA0B,CAAC,GAAG,CAAC,MAAM,CAAC,KAAK,EAAE,aAAa,CAAC,CAAC;YAClE,CAAC;QACF,CAAC;aAAM,IAAI,MAAM,CAAC,IAAI,KAAK,0BAA0B,CAAC,UAAU,EAAE,CAAC;YAClE,MAAM,OAAO,GAAG,IAAI,CAAC,yBAAyB,CAAC,GAAG,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC;YACjE,IAAI,OAAO,EAAE,CAAC;gBACb,OAAO,CAAC,QAAQ,CAAC,MAAM,CAAC,QAAQ,CAAC,CAAC;YACnC,CAAC;iBAAM,CAAC;gBACP,MAAM,aAAa,GAAG,IAAI,eAAe,EAAY,CAAC;gBACtD,aAAa,CAAC,QAAQ,CAAC,MAAM,CAAC,QAAQ,CAAC,CAAC;gBACxC,IAAI,CAAC,yBAAyB,CAAC,GAAG,CAAC,MAAM,CAAC,KAAK,EAAE,aAAa,CAAC,CAAC;YACjE,CAAC;QACF,CAAC;IACF,CAAC;;AAGF,iBAAiB,CAAC,wBAAwB,EAAE,uBAAuB,oCAA4B,CAAC","file":"aiSettingsSearchService.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { DeferredPromise, raceCancellation } from '../../../../base/common/async.js';\nimport { CancellationToken } from '../../../../base/common/cancellation.js';\nimport { Emitter, Event } from '../../../../base/common/event.js';\nimport { Disposable, IDisposable } from '../../../../base/common/lifecycle.js';\nimport { InstantiationType, registerSingleton } from '../../../../platform/instantiation/common/extensions.js';\nimport { AiSettingsSearchResult, AiSettingsSearchResultKind, IAiSettingsSearchProvider, IAiSettingsSearchService } from './aiSettingsSearch.js';\n\nexport class AiSettingsSearchService extends Disposable implements IAiSettingsSearchService {\n\treadonly _serviceBrand: undefined;\n\tprivate static readonly MAX_PICKS = 5;\n\n\tprivate _providers: IAiSettingsSearchProvider[] = [];\n\tprivate _llmRankedResultsPromises: Map<string, DeferredPromise<string[]>> = new Map();\n\tprivate _embeddingsResultsPromises: Map<string, DeferredPromise<string[]>> = new Map();\n\n\tprivate _onProviderRegistered: Emitter<void> = this._register(new Emitter<void>());\n\treadonly onProviderRegistered: Event<void> = this._onProviderRegistered.event;\n\n\tisEnabled(): boolean {\n\t\treturn this._providers.length > 0;\n\t}\n\n\tregisterSettingsSearchProvider(provider: IAiSettingsSearchProvider): IDisposable {\n\t\tthis._providers.push(provider);\n\t\tthis._onProviderRegistered.fire();\n\t\treturn {\n\t\t\tdispose: () => {\n\t\t\t\tconst index = this._providers.indexOf(provider);\n\t\t\t\tif (index !== -1) {\n\t\t\t\t\tthis._providers.splice(index, 1);\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t}\n\n\tstartSearch(query: string, embeddingsOnly: boolean, token: CancellationToken): void {\n\t\tif (!this.isEnabled()) {\n\t\t\tthrow new Error('No settings search providers registered');\n\t\t}\n\n\t\tthis._embeddingsResultsPromises.delete(query);\n\t\tthis._llmRankedResultsPromises.delete(query);\n\n\t\tthis._providers.forEach(provider => provider.searchSettings(query, { limit: AiSettingsSearchService.MAX_PICKS, embeddingsOnly }, token));\n\t}\n\n\tasync getEmbeddingsResults(query: string, token: CancellationToken): Promise<string[] | null> {\n\t\tif (!this.isEnabled()) {\n\t\t\tthrow new Error('No settings search providers registered');\n\t\t}\n\n\t\tconst existingPromise = this._embeddingsResultsPromises.get(query);\n\t\tif (existingPromise) {\n\t\t\tconst result = await existingPromise.p;\n\t\t\treturn result ?? null;\n\t\t}\n\n\t\tconst promise = new DeferredPromise<string[]>();\n\t\tthis._embeddingsResultsPromises.set(query, promise);\n\t\tconst result = await raceCancellation(promise.p, token);\n\t\treturn result ?? null;\n\t}\n\n\tasync getLLMRankedResults(query: string, token: CancellationToken): Promise<string[] | null> {\n\t\tif (!this.isEnabled()) {\n\t\t\tthrow new Error('No settings search providers registered');\n\t\t}\n\n\t\tconst existingPromise = this._llmRankedResultsPromises.get(query);\n\t\tif (existingPromise) {\n\t\t\tconst result = await existingPromise.p;\n\t\t\treturn result ?? null;\n\t\t}\n\n\t\tconst promise = new DeferredPromise<string[]>();\n\t\tthis._llmRankedResultsPromises.set(query, promise);\n\t\tconst result = await raceCancellation(promise.p, token);\n\t\treturn result ?? null;\n\t}\n\n\thandleSearchResult(result: AiSettingsSearchResult): void {\n\t\tif (!this.isEnabled()) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (result.kind === AiSettingsSearchResultKind.EMBEDDED) {\n\t\t\tconst promise = this._embeddingsResultsPromises.get(result.query);\n\t\t\tif (promise) {\n\t\t\t\tpromise.complete(result.settings);\n\t\t\t} else {\n\t\t\t\tconst parkedPromise = new DeferredPromise<string[]>();\n\t\t\t\tparkedPromise.complete(result.settings);\n\t\t\t\tthis._embeddingsResultsPromises.set(result.query, parkedPromise);\n\t\t\t}\n\t\t} else if (result.kind === AiSettingsSearchResultKind.LLM_RANKED) {\n\t\t\tconst promise = this._llmRankedResultsPromises.get(result.query);\n\t\t\tif (promise) {\n\t\t\t\tpromise.complete(result.settings);\n\t\t\t} else {\n\t\t\t\tconst parkedPromise = new DeferredPromise<string[]>();\n\t\t\t\tparkedPromise.complete(result.settings);\n\t\t\t\tthis._llmRankedResultsPromises.set(result.query, parkedPromise);\n\t\t\t}\n\t\t}\n\t}\n}\n\nregisterSingleton(IAiSettingsSearchService, AiSettingsSearchService, InstantiationType.Delayed);\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { DeferredPromise, raceCancellation } from '../../../../base/common/async.js';\nimport { CancellationToken } from '../../../../base/common/cancellation.js';\nimport { Emitter, Event } from '../../../../base/common/event.js';\nimport { Disposable, IDisposable } from '../../../../base/common/lifecycle.js';\nimport { InstantiationType, registerSingleton } from '../../../../platform/instantiation/common/extensions.js';\nimport { AiSettingsSearchResult, AiSettingsSearchResultKind, IAiSettingsSearchProvider, IAiSettingsSearchService } from './aiSettingsSearch.js';\n\nexport class AiSettingsSearchService extends Disposable implements IAiSettingsSearchService {\n\treadonly _serviceBrand: undefined;\n\tprivate static readonly MAX_PICKS = 5;\n\n\tprivate _providers: IAiSettingsSearchProvider[] = [];\n\tprivate _llmRankedResultsPromises: Map<string, DeferredPromise<string[]>> = new Map();\n\tprivate _embeddingsResultsPromises: Map<string, DeferredPromise<string[]>> = new Map();\n\n\tprivate _onProviderRegistered: Emitter<void> = this._register(new Emitter<void>());\n\treadonly onProviderRegistered: Event<void> = this._onProviderRegistered.event;\n\n\tisEnabled(): boolean {\n\t\treturn this._providers.length > 0;\n\t}\n\n\tregisterSettingsSearchProvider(provider: IAiSettingsSearchProvider): IDisposable {\n\t\tthis._providers.push(provider);\n\t\tthis._onProviderRegistered.fire();\n\t\treturn {\n\t\t\tdispose: () => {\n\t\t\t\tconst index = this._providers.indexOf(provider);\n\t\t\t\tif (index !== -1) {\n\t\t\t\t\tthis._providers.splice(index, 1);\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t}\n\n\tstartSearch(query: string, embeddingsOnly: boolean, token: CancellationToken): void {\n\t\tif (!this.isEnabled()) {\n\t\t\tthrow new Error('No settings search providers registered');\n\t\t}\n\n\t\tthis._embeddingsResultsPromises.delete(query);\n\t\tthis._llmRankedResultsPromises.delete(query);\n\n\t\tthis._providers.forEach(provider => provider.searchSettings(query, { limit: AiSettingsSearchService.MAX_PICKS, embeddingsOnly }, token));\n\t}\n\n\tasync getEmbeddingsResults(query: string, token: CancellationToken): Promise<string[] | null> {\n\t\tif (!this.isEnabled()) {\n\t\t\tthrow new Error('No settings search providers registered');\n\t\t}\n\n\t\tconst existingPromise = this._embeddingsResultsPromises.get(query);\n\t\tif (existingPromise) {\n\t\t\tconst result = await existingPromise.p;\n\t\t\treturn result ?? null;\n\t\t}\n\n\t\tconst promise = new DeferredPromise<string[]>();\n\t\tthis._embeddingsResultsPromises.set(query, promise);\n\t\tconst result = await raceCancellation(promise.p, token);\n\t\treturn result ?? null;\n\t}\n\n\tasync getLLMRankedResults(query: string, token: CancellationToken): Promise<string[] | null> {\n\t\tif (!this.isEnabled()) {\n\t\t\tthrow new Error('No settings search providers registered');\n\t\t}\n\n\t\tconst existingPromise = this._llmRankedResultsPromises.get(query);\n\t\tif (existingPromise) {\n\t\t\tconst result = await existingPromise.p;\n\t\t\treturn result ?? null;\n\t\t}\n\n\t\tconst promise = new DeferredPromise<string[]>();\n\t\tthis._llmRankedResultsPromises.set(query, promise);\n\t\tconst result = await raceCancellation(promise.p, token);\n\t\treturn result ?? null;\n\t}\n\n\thandleSearchResult(result: AiSettingsSearchResult): void {\n\t\tif (!this.isEnabled()) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (result.kind === AiSettingsSearchResultKind.EMBEDDED) {\n\t\t\tconst promise = this._embeddingsResultsPromises.get(result.query);\n\t\t\tif (promise) {\n\t\t\t\tpromise.complete(result.settings);\n\t\t\t} else {\n\t\t\t\tconst parkedPromise = new DeferredPromise<string[]>();\n\t\t\t\tparkedPromise.complete(result.settings);\n\t\t\t\tthis._embeddingsResultsPromises.set(result.query, parkedPromise);\n\t\t\t}\n\t\t} else if (result.kind === AiSettingsSearchResultKind.LLM_RANKED) {\n\t\t\tconst promise = this._llmRankedResultsPromises.get(result.query);\n\t\t\tif (promise) {\n\t\t\t\tpromise.complete(result.settings);\n\t\t\t} else {\n\t\t\t\tconst parkedPromise = new DeferredPromise<string[]>();\n\t\t\t\tparkedPromise.complete(result.settings);\n\t\t\t\tthis._llmRankedResultsPromises.set(result.query, parkedPromise);\n\t\t\t}\n\t\t}\n\t}\n}\n\nregisterSingleton(IAiSettingsSearchService, AiSettingsSearchService, InstantiationType.Delayed);\n"]}