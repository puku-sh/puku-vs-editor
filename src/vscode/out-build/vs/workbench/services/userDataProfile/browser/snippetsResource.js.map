{"version":3,"sources":["vs/workbench/services/userDataProfile/browser/snippetsResource.ts"],"names":[],"mappings":"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","file":"snippetsResource.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { VSBuffer } from '../../../../base/common/buffer.js';\nimport { IStringDictionary } from '../../../../base/common/collections.js';\nimport { ResourceSet } from '../../../../base/common/map.js';\nimport { URI } from '../../../../base/common/uri.js';\nimport { localize } from '../../../../nls.js';\nimport { FileOperationError, FileOperationResult, IFileService, IFileStat } from '../../../../platform/files/common/files.js';\nimport { IInstantiationService } from '../../../../platform/instantiation/common/instantiation.js';\nimport { IUriIdentityService } from '../../../../platform/uriIdentity/common/uriIdentity.js';\nimport { IUserDataProfile, ProfileResourceType } from '../../../../platform/userDataProfile/common/userDataProfile.js';\nimport { API_OPEN_EDITOR_COMMAND_ID } from '../../../browser/parts/editor/editorCommands.js';\nimport { ITreeItemCheckboxState, TreeItemCollapsibleState } from '../../../common/views.js';\nimport { IProfileResource, IProfileResourceChildTreeItem, IProfileResourceInitializer, IProfileResourceTreeItem, IUserDataProfileService } from '../common/userDataProfile.js';\n\ninterface ISnippetsContent {\n\tsnippets: IStringDictionary<string>;\n}\n\nexport class SnippetsResourceInitializer implements IProfileResourceInitializer {\n\n\tconstructor(\n\t\t@IUserDataProfileService private readonly userDataProfileService: IUserDataProfileService,\n\t\t@IFileService private readonly fileService: IFileService,\n\t\t@IUriIdentityService private readonly uriIdentityService: IUriIdentityService,\n\t) {\n\t}\n\n\tasync initialize(content: string): Promise<void> {\n\t\tconst snippetsContent: ISnippetsContent = JSON.parse(content);\n\t\tfor (const key in snippetsContent.snippets) {\n\t\t\tconst resource = this.uriIdentityService.extUri.joinPath(this.userDataProfileService.currentProfile.snippetsHome, key);\n\t\t\tawait this.fileService.writeFile(resource, VSBuffer.fromString(snippetsContent.snippets[key]));\n\t\t}\n\t}\n}\n\nexport class SnippetsResource implements IProfileResource {\n\n\tconstructor(\n\t\t@IFileService private readonly fileService: IFileService,\n\t\t@IUriIdentityService private readonly uriIdentityService: IUriIdentityService,\n\t) {\n\t}\n\n\tasync getContent(profile: IUserDataProfile, excluded?: ResourceSet): Promise<string> {\n\t\tconst snippets = await this.getSnippets(profile, excluded);\n\t\treturn JSON.stringify({ snippets });\n\t}\n\n\tasync apply(content: string, profile: IUserDataProfile): Promise<void> {\n\t\tconst snippetsContent: ISnippetsContent = JSON.parse(content);\n\t\tfor (const key in snippetsContent.snippets) {\n\t\t\tconst resource = this.uriIdentityService.extUri.joinPath(profile.snippetsHome, key);\n\t\t\tawait this.fileService.writeFile(resource, VSBuffer.fromString(snippetsContent.snippets[key]));\n\t\t}\n\t}\n\n\tprivate async getSnippets(profile: IUserDataProfile, excluded?: ResourceSet): Promise<IStringDictionary<string>> {\n\t\tconst snippets: IStringDictionary<string> = {};\n\t\tconst snippetsResources = await this.getSnippetsResources(profile, excluded);\n\t\tfor (const resource of snippetsResources) {\n\t\t\tconst key = this.uriIdentityService.extUri.relativePath(profile.snippetsHome, resource)!;\n\t\t\tconst content = await this.fileService.readFile(resource);\n\t\t\tsnippets[key] = content.value.toString();\n\t\t}\n\t\treturn snippets;\n\t}\n\n\tasync getSnippetsResources(profile: IUserDataProfile, excluded?: ResourceSet): Promise<URI[]> {\n\t\tconst snippets: URI[] = [];\n\t\tlet stat: IFileStat;\n\t\ttry {\n\t\t\tstat = await this.fileService.resolve(profile.snippetsHome);\n\t\t} catch (e) {\n\t\t\t// No snippets\n\t\t\tif (e instanceof FileOperationError && e.fileOperationResult === FileOperationResult.FILE_NOT_FOUND) {\n\t\t\t\treturn snippets;\n\t\t\t} else {\n\t\t\t\tthrow e;\n\t\t\t}\n\t\t}\n\t\tfor (const { resource } of stat.children || []) {\n\t\t\tif (excluded?.has(resource)) {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tconst extension = this.uriIdentityService.extUri.extname(resource);\n\t\t\tif (extension === '.json' || extension === '.code-snippets') {\n\t\t\t\tsnippets.push(resource);\n\t\t\t}\n\t\t}\n\t\treturn snippets;\n\t}\n}\n\nexport class SnippetsResourceTreeItem implements IProfileResourceTreeItem {\n\n\treadonly type = ProfileResourceType.Snippets;\n\treadonly handle: string;\n\treadonly label = { label: localize('snippets', \"Snippets\") };\n\treadonly collapsibleState = TreeItemCollapsibleState.Collapsed;\n\tcheckbox: ITreeItemCheckboxState | undefined;\n\n\tprivate readonly excludedSnippets = new ResourceSet();\n\n\tconstructor(\n\t\tprivate readonly profile: IUserDataProfile,\n\t\t@IInstantiationService private readonly instantiationService: IInstantiationService,\n\t\t@IUriIdentityService private readonly uriIdentityService: IUriIdentityService,\n\t) {\n\t\tthis.handle = this.profile.snippetsHome.toString();\n\t}\n\n\tasync getChildren(): Promise<IProfileResourceChildTreeItem[] | undefined> {\n\t\tconst snippetsResources = await this.instantiationService.createInstance(SnippetsResource).getSnippetsResources(this.profile);\n\t\tconst that = this;\n\t\treturn snippetsResources.map<IProfileResourceChildTreeItem>(resource => ({\n\t\t\thandle: resource.toString(),\n\t\t\tparent: that,\n\t\t\tresourceUri: resource,\n\t\t\tcollapsibleState: TreeItemCollapsibleState.None,\n\t\t\taccessibilityInformation: {\n\t\t\t\tlabel: this.uriIdentityService.extUri.basename(resource),\n\t\t\t},\n\t\t\tcheckbox: that.checkbox ? {\n\t\t\t\tget isChecked() { return !that.excludedSnippets.has(resource); },\n\t\t\t\tset isChecked(value: boolean) {\n\t\t\t\t\tif (value) {\n\t\t\t\t\t\tthat.excludedSnippets.delete(resource);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthat.excludedSnippets.add(resource);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\taccessibilityInformation: {\n\t\t\t\t\tlabel: localize('exclude', \"Select Snippet {0}\", this.uriIdentityService.extUri.basename(resource)),\n\t\t\t\t}\n\t\t\t} : undefined,\n\t\t\tcommand: {\n\t\t\t\tid: API_OPEN_EDITOR_COMMAND_ID,\n\t\t\t\ttitle: '',\n\t\t\t\targuments: [resource, undefined, undefined]\n\t\t\t}\n\t\t}));\n\t}\n\n\tasync hasContent(): Promise<boolean> {\n\t\tconst snippetsResources = await this.instantiationService.createInstance(SnippetsResource).getSnippetsResources(this.profile);\n\t\treturn snippetsResources.length > 0;\n\t}\n\n\tasync getContent(): Promise<string> {\n\t\treturn this.instantiationService.createInstance(SnippetsResource).getContent(this.profile, this.excludedSnippets);\n\t}\n\n\tisFromDefaultProfile(): boolean {\n\t\treturn !this.profile.isDefault && !!this.profile.useDefaultFlags?.snippets;\n\t}\n\n\n}\n\n"]}