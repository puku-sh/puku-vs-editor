{"version":3,"sources":["vs/workbench/services/userDataProfile/browser/globalStateResource.ts"],"names":[],"mappings":"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","file":"globalStateResource.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { IStringDictionary } from '../../../../base/common/collections.js';\nimport { URI } from '../../../../base/common/uri.js';\nimport { localize } from '../../../../nls.js';\nimport { IInstantiationService } from '../../../../platform/instantiation/common/instantiation.js';\nimport { ILogService } from '../../../../platform/log/common/log.js';\nimport { IStorageEntry, IStorageService, StorageScope, StorageTarget } from '../../../../platform/storage/common/storage.js';\nimport { IUriIdentityService } from '../../../../platform/uriIdentity/common/uriIdentity.js';\nimport { IUserDataProfile, ProfileResourceType } from '../../../../platform/userDataProfile/common/userDataProfile.js';\nimport { IUserDataProfileStorageService } from '../../../../platform/userDataProfile/common/userDataProfileStorageService.js';\nimport { API_OPEN_EDITOR_COMMAND_ID } from '../../../browser/parts/editor/editorCommands.js';\nimport { ITreeItemCheckboxState, TreeItemCollapsibleState } from '../../../common/views.js';\nimport { IProfileResource, IProfileResourceChildTreeItem, IProfileResourceInitializer, IProfileResourceTreeItem } from '../common/userDataProfile.js';\n\ninterface IGlobalState {\n\tstorage: IStringDictionary<string>;\n}\n\nexport class GlobalStateResourceInitializer implements IProfileResourceInitializer {\n\n\tconstructor(@IStorageService private readonly storageService: IStorageService) {\n\t}\n\n\tasync initialize(content: string): Promise<void> {\n\t\tconst globalState: IGlobalState = JSON.parse(content);\n\t\tconst storageKeys = Object.keys(globalState.storage);\n\t\tif (storageKeys.length) {\n\t\t\tconst storageEntries: Array<IStorageEntry> = [];\n\t\t\tfor (const key of storageKeys) {\n\t\t\t\tstorageEntries.push({ key, value: globalState.storage[key], scope: StorageScope.PROFILE, target: StorageTarget.USER });\n\t\t\t}\n\t\t\tthis.storageService.storeAll(storageEntries, true);\n\t\t}\n\t}\n}\n\nexport class GlobalStateResource implements IProfileResource {\n\n\tconstructor(\n\t\t@IStorageService private readonly storageService: IStorageService,\n\t\t@IUserDataProfileStorageService private readonly userDataProfileStorageService: IUserDataProfileStorageService,\n\t\t@ILogService private readonly logService: ILogService,\n\t) {\n\t}\n\n\tasync getContent(profile: IUserDataProfile): Promise<string> {\n\t\tconst globalState = await this.getGlobalState(profile);\n\t\treturn JSON.stringify(globalState);\n\t}\n\n\tasync apply(content: string, profile: IUserDataProfile): Promise<void> {\n\t\tconst globalState: IGlobalState = JSON.parse(content);\n\t\tawait this.writeGlobalState(globalState, profile);\n\t}\n\n\tasync getGlobalState(profile: IUserDataProfile): Promise<IGlobalState> {\n\t\tconst storage: IStringDictionary<string> = {};\n\t\tconst storageData = await this.userDataProfileStorageService.readStorageData(profile);\n\t\tfor (const [key, value] of storageData) {\n\t\t\tif (value.value !== undefined && value.target === StorageTarget.USER) {\n\t\t\t\tstorage[key] = value.value;\n\t\t\t}\n\t\t}\n\t\treturn { storage };\n\t}\n\n\tprivate async writeGlobalState(globalState: IGlobalState, profile: IUserDataProfile): Promise<void> {\n\t\tconst storageKeys = Object.keys(globalState.storage);\n\t\tif (storageKeys.length) {\n\t\t\tconst updatedStorage = new Map<string, string | undefined>();\n\t\t\tconst nonProfileKeys = [\n\t\t\t\t// Do not include application scope user target keys because they also include default profile user target keys\n\t\t\t\t...this.storageService.keys(StorageScope.APPLICATION, StorageTarget.MACHINE),\n\t\t\t\t...this.storageService.keys(StorageScope.WORKSPACE, StorageTarget.USER),\n\t\t\t\t...this.storageService.keys(StorageScope.WORKSPACE, StorageTarget.MACHINE),\n\t\t\t];\n\t\t\tfor (const key of storageKeys) {\n\t\t\t\tif (nonProfileKeys.includes(key)) {\n\t\t\t\t\tthis.logService.info(`Importing Profile (${profile.name}): Ignoring global state key '${key}' because it is not a profile key.`);\n\t\t\t\t} else {\n\t\t\t\t\tupdatedStorage.set(key, globalState.storage[key]);\n\t\t\t\t}\n\t\t\t}\n\t\t\tawait this.userDataProfileStorageService.updateStorageData(profile, updatedStorage, StorageTarget.USER);\n\t\t}\n\t}\n}\n\nexport abstract class GlobalStateResourceTreeItem implements IProfileResourceTreeItem {\n\n\treadonly type = ProfileResourceType.GlobalState;\n\treadonly handle = ProfileResourceType.GlobalState;\n\treadonly label = { label: localize('globalState', \"UI State\") };\n\treadonly collapsibleState = TreeItemCollapsibleState.Collapsed;\n\tcheckbox: ITreeItemCheckboxState | undefined;\n\n\tconstructor(\n\t\tprivate readonly resource: URI,\n\t\tprivate readonly uriIdentityService: IUriIdentityService\n\t) { }\n\n\tasync getChildren(): Promise<IProfileResourceChildTreeItem[]> {\n\t\treturn [{\n\t\t\thandle: this.resource.toString(),\n\t\t\tresourceUri: this.resource,\n\t\t\tcollapsibleState: TreeItemCollapsibleState.None,\n\t\t\taccessibilityInformation: {\n\t\t\t\tlabel: this.uriIdentityService.extUri.basename(this.resource)\n\t\t\t},\n\t\t\tparent: this,\n\t\t\tcommand: {\n\t\t\t\tid: API_OPEN_EDITOR_COMMAND_ID,\n\t\t\t\ttitle: '',\n\t\t\t\targuments: [this.resource, undefined, undefined]\n\t\t\t}\n\t\t}];\n\t}\n\n\tabstract getContent(): Promise<string>;\n\tabstract isFromDefaultProfile(): boolean;\n}\n\nexport class GlobalStateResourceExportTreeItem extends GlobalStateResourceTreeItem {\n\n\tconstructor(\n\t\tprivate readonly profile: IUserDataProfile,\n\t\tresource: URI,\n\t\t@IUriIdentityService uriIdentityService: IUriIdentityService,\n\t\t@IInstantiationService private readonly instantiationService: IInstantiationService\n\t) {\n\t\tsuper(resource, uriIdentityService);\n\t}\n\n\tasync hasContent(): Promise<boolean> {\n\t\tconst globalState = await this.instantiationService.createInstance(GlobalStateResource).getGlobalState(this.profile);\n\t\treturn Object.keys(globalState.storage).length > 0;\n\t}\n\n\tasync getContent(): Promise<string> {\n\t\treturn this.instantiationService.createInstance(GlobalStateResource).getContent(this.profile);\n\t}\n\n\tisFromDefaultProfile(): boolean {\n\t\treturn !this.profile.isDefault && !!this.profile.useDefaultFlags?.globalState;\n\t}\n\n}\n\nexport class GlobalStateResourceImportTreeItem extends GlobalStateResourceTreeItem {\n\n\tconstructor(\n\t\tprivate readonly content: string,\n\t\tresource: URI,\n\t\t@IUriIdentityService uriIdentityService: IUriIdentityService,\n\t) {\n\t\tsuper(resource, uriIdentityService);\n\t}\n\n\tasync getContent(): Promise<string> {\n\t\treturn this.content;\n\t}\n\n\tisFromDefaultProfile(): boolean {\n\t\treturn false;\n\t}\n\n}\n"]}