{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/services/views/common/viewContainerModel.ts","vs/workbench/services/views/common/viewContainerModel.ts"],"names":[],"mappings":"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","file":"viewContainerModel.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { ViewContainer, IViewsRegistry, IViewDescriptor, Extensions as ViewExtensions, IViewContainerModel, IAddedViewDescriptorRef, IViewDescriptorRef, IAddedViewDescriptorState, defaultViewIcon, VIEWS_LOG_ID, VIEWS_LOG_NAME } from '../../../common/views.js';\nimport { IContextKeyService } from '../../../../platform/contextkey/common/contextkey.js';\nimport { IStorageService, StorageScope, StorageTarget } from '../../../../platform/storage/common/storage.js';\nimport { Registry } from '../../../../platform/registry/common/platform.js';\nimport { Disposable } from '../../../../base/common/lifecycle.js';\nimport { Event, Emitter } from '../../../../base/common/event.js';\nimport { IInstantiationService } from '../../../../platform/instantiation/common/instantiation.js';\nimport { URI } from '../../../../base/common/uri.js';\nimport { coalesce, move } from '../../../../base/common/arrays.js';\nimport { isUndefined, isUndefinedOrNull } from '../../../../base/common/types.js';\nimport { isEqual } from '../../../../base/common/resources.js';\nimport { ThemeIcon } from '../../../../base/common/themables.js';\nimport { IStringDictionary } from '../../../../base/common/collections.js';\nimport { ILogger, ILoggerService } from '../../../../platform/log/common/log.js';\nimport { CounterSet } from '../../../../base/common/map.js';\nimport { Lazy } from '../../../../base/common/lazy.js';\nimport { windowLogGroup } from '../../log/common/logConstants.js';\n\nexport function getViewsStateStorageId(viewContainerStorageId: string): string { return `${viewContainerStorageId}.hidden`; }\n\ninterface IStoredWorkspaceViewState {\n\tcollapsed: boolean;\n\tisHidden: boolean;\n\tsize?: number;\n\torder?: number;\n}\n\ninterface IStoredGlobalViewState {\n\tid: string;\n\tisHidden: boolean;\n\torder?: number;\n}\n\ninterface IViewDescriptorState {\n\tvisibleGlobal: boolean | undefined;\n\tvisibleWorkspace: boolean | undefined;\n\tcollapsed: boolean | undefined;\n\tactive: boolean;\n\torder?: number;\n\tsize?: number;\n}\n\nclass ViewDescriptorsState extends Disposable {\n\n\tprivate readonly workspaceViewsStateStorageId: string;\n\tprivate readonly globalViewsStateStorageId: string;\n\tprivate readonly state: Map<string, IViewDescriptorState>;\n\n\tprivate _onDidChangeStoredState = this._register(new Emitter<{ id: string; visible: boolean }[]>());\n\treadonly onDidChangeStoredState = this._onDidChangeStoredState.event;\n\n\tprivate readonly logger: Lazy<ILogger>;\n\n\tconstructor(\n\t\tviewContainerStorageId: string,\n\t\tprivate readonly viewContainerName: string,\n\t\t@IStorageService private readonly storageService: IStorageService,\n\t\t@ILoggerService loggerService: ILoggerService,\n\t) {\n\t\tsuper();\n\n\t\tthis.logger = new Lazy(() => loggerService.createLogger(VIEWS_LOG_ID, { name: VIEWS_LOG_NAME, group: windowLogGroup }));\n\n\t\tthis.globalViewsStateStorageId = getViewsStateStorageId(viewContainerStorageId);\n\t\tthis.workspaceViewsStateStorageId = viewContainerStorageId;\n\t\tthis._register(this.storageService.onDidChangeValue(StorageScope.PROFILE, this.globalViewsStateStorageId, this._store)(() => this.onDidStorageChange()));\n\n\t\tthis.state = this.initialize();\n\n\t}\n\n\tset(id: string, state: IViewDescriptorState): void {\n\t\tthis.state.set(id, state);\n\t}\n\n\tget(id: string): IViewDescriptorState | undefined {\n\t\treturn this.state.get(id);\n\t}\n\n\tupdateState(viewDescriptors: ReadonlyArray<IViewDescriptor>): void {\n\t\tthis.updateWorkspaceState(viewDescriptors);\n\t\tthis.updateGlobalState(viewDescriptors);\n\t}\n\n\tprivate updateWorkspaceState(viewDescriptors: ReadonlyArray<IViewDescriptor>): void {\n\t\tconst storedViewsStates = this.getStoredWorkspaceState();\n\t\tfor (const viewDescriptor of viewDescriptors) {\n\t\t\tconst viewState = this.get(viewDescriptor.id);\n\t\t\tif (viewState) {\n\t\t\t\tstoredViewsStates[viewDescriptor.id] = {\n\t\t\t\t\tcollapsed: !!viewState.collapsed,\n\t\t\t\t\tisHidden: !viewState.visibleWorkspace,\n\t\t\t\t\tsize: viewState.size,\n\t\t\t\t\torder: viewDescriptor.workspace && viewState ? viewState.order : undefined\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\n\t\tif (Object.keys(storedViewsStates).length > 0) {\n\t\t\tthis.storageService.store(this.workspaceViewsStateStorageId, JSON.stringify(storedViewsStates), StorageScope.WORKSPACE, StorageTarget.MACHINE);\n\t\t} else {\n\t\t\tthis.storageService.remove(this.workspaceViewsStateStorageId, StorageScope.WORKSPACE);\n\t\t}\n\t}\n\n\tprivate updateGlobalState(viewDescriptors: ReadonlyArray<IViewDescriptor>): void {\n\t\tconst storedGlobalState = this.getStoredGlobalState();\n\t\tfor (const viewDescriptor of viewDescriptors) {\n\t\t\tconst state = this.get(viewDescriptor.id);\n\t\t\tstoredGlobalState.set(viewDescriptor.id, {\n\t\t\t\tid: viewDescriptor.id,\n\t\t\t\tisHidden: state && viewDescriptor.canToggleVisibility ? !state.visibleGlobal : false,\n\t\t\t\torder: !viewDescriptor.workspace && state ? state.order : undefined\n\t\t\t});\n\t\t}\n\t\tthis.setStoredGlobalState(storedGlobalState);\n\t}\n\n\tprivate onDidStorageChange(): void {\n\t\tif (this.globalViewsStatesValue !== this.getStoredGlobalViewsStatesValue() /* This checks if current window changed the value or not */) {\n\t\t\tthis._globalViewsStatesValue = undefined;\n\t\t\tconst storedViewsVisibilityStates = this.getStoredGlobalState();\n\t\t\tconst storedWorkspaceViewsStates = this.getStoredWorkspaceState();\n\t\t\tconst changedStates: { id: string; visible: boolean }[] = [];\n\t\t\tfor (const [id, storedState] of storedViewsVisibilityStates) {\n\t\t\t\tconst state = this.get(id);\n\t\t\t\tif (state) {\n\t\t\t\t\tif (state.visibleGlobal !== !storedState.isHidden) {\n\t\t\t\t\t\tif (!storedState.isHidden) {\n\t\t\t\t\t\t\tthis.logger.value.trace(`View visibility state changed: ${id} is now visible`, this.viewContainerName);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tchangedStates.push({ id, visible: !storedState.isHidden });\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tconst workspaceViewState: IStoredWorkspaceViewState | undefined = storedWorkspaceViewsStates[id];\n\t\t\t\t\tthis.set(id, {\n\t\t\t\t\t\tactive: false,\n\t\t\t\t\t\tvisibleGlobal: !storedState.isHidden,\n\t\t\t\t\t\tvisibleWorkspace: isUndefined(workspaceViewState?.isHidden) ? undefined : !workspaceViewState?.isHidden,\n\t\t\t\t\t\tcollapsed: workspaceViewState?.collapsed,\n\t\t\t\t\t\torder: workspaceViewState?.order,\n\t\t\t\t\t\tsize: workspaceViewState?.size,\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (changedStates.length) {\n\t\t\t\tthis._onDidChangeStoredState.fire(changedStates);\n\t\t\t\t// Update the in memory state after firing the event\n\t\t\t\t// so that the views can update their state accordingly\n\t\t\t\tfor (const changedState of changedStates) {\n\t\t\t\t\tconst state = this.get(changedState.id);\n\t\t\t\t\tif (state) {\n\t\t\t\t\t\tstate.visibleGlobal = changedState.visible;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate initialize(): Map<string, IViewDescriptorState> {\n\t\tconst viewStates = new Map<string, IViewDescriptorState>();\n\t\tconst workspaceViewsStates = this.getStoredWorkspaceState();\n\t\tfor (const id of Object.keys(workspaceViewsStates)) {\n\t\t\tconst workspaceViewState = workspaceViewsStates[id];\n\t\t\tviewStates.set(id, {\n\t\t\t\tactive: false,\n\t\t\t\tvisibleGlobal: undefined,\n\t\t\t\tvisibleWorkspace: isUndefined(workspaceViewState.isHidden) ? undefined : !workspaceViewState.isHidden,\n\t\t\t\tcollapsed: workspaceViewState.collapsed,\n\t\t\t\torder: workspaceViewState.order,\n\t\t\t\tsize: workspaceViewState.size,\n\t\t\t});\n\t\t}\n\n\t\t// Migrate to `viewletStateStorageId`\n\t\tconst value = this.storageService.get(this.globalViewsStateStorageId, StorageScope.WORKSPACE, '[]');\n\t\tconst { state: workspaceVisibilityStates } = this.parseStoredGlobalState(value);\n\t\tif (workspaceVisibilityStates.size > 0) {\n\t\t\tfor (const { id, isHidden } of workspaceVisibilityStates.values()) {\n\t\t\t\tconst viewState = viewStates.get(id);\n\t\t\t\t// Not migrated to `viewletStateStorageId`\n\t\t\t\tif (viewState) {\n\t\t\t\t\tif (isUndefined(viewState.visibleWorkspace)) {\n\t\t\t\t\t\tviewState.visibleWorkspace = !isHidden;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tviewStates.set(id, {\n\t\t\t\t\t\tactive: false,\n\t\t\t\t\t\tcollapsed: undefined,\n\t\t\t\t\t\tvisibleGlobal: undefined,\n\t\t\t\t\t\tvisibleWorkspace: !isHidden,\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis.storageService.remove(this.globalViewsStateStorageId, StorageScope.WORKSPACE);\n\t\t}\n\n\t\tconst { state, hasDuplicates } = this.parseStoredGlobalState(this.globalViewsStatesValue);\n\t\tif (hasDuplicates) {\n\t\t\tthis.setStoredGlobalState(state);\n\t\t}\n\t\tfor (const { id, isHidden, order } of state.values()) {\n\t\t\tconst viewState = viewStates.get(id);\n\t\t\tif (viewState) {\n\t\t\t\tviewState.visibleGlobal = !isHidden;\n\t\t\t\tif (!isUndefined(order)) {\n\t\t\t\t\tviewState.order = order;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tviewStates.set(id, {\n\t\t\t\t\tactive: false,\n\t\t\t\t\tvisibleGlobal: !isHidden,\n\t\t\t\t\torder,\n\t\t\t\t\tcollapsed: undefined,\n\t\t\t\t\tvisibleWorkspace: undefined,\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t\treturn viewStates;\n\t}\n\n\tprivate getStoredWorkspaceState(): IStringDictionary<IStoredWorkspaceViewState> {\n\t\treturn JSON.parse(this.storageService.get(this.workspaceViewsStateStorageId, StorageScope.WORKSPACE, '{}'));\n\t}\n\n\tprivate getStoredGlobalState(): Map<string, IStoredGlobalViewState> {\n\t\treturn this.parseStoredGlobalState(this.globalViewsStatesValue).state;\n\t}\n\n\tprivate setStoredGlobalState(storedGlobalState: Map<string, IStoredGlobalViewState>): void {\n\t\tthis.globalViewsStatesValue = JSON.stringify([...storedGlobalState.values()]);\n\t}\n\n\tprivate parseStoredGlobalState(value: string): { state: Map<string, IStoredGlobalViewState>; hasDuplicates: boolean } {\n\t\tconst storedValue: Array<string | IStoredGlobalViewState> = JSON.parse(value);\n\t\tlet hasDuplicates = false;\n\t\tconst state = storedValue.reduce((result, storedState) => {\n\t\t\tif (typeof storedState === 'string' /* migration */) {\n\t\t\t\thasDuplicates = hasDuplicates || result.has(storedState);\n\t\t\t\tresult.set(storedState, { id: storedState, isHidden: true });\n\t\t\t} else {\n\t\t\t\thasDuplicates = hasDuplicates || result.has(storedState.id);\n\t\t\t\tresult.set(storedState.id, storedState);\n\t\t\t}\n\t\t\treturn result;\n\t\t}, new Map<string, IStoredGlobalViewState>());\n\t\treturn { state, hasDuplicates };\n\t}\n\n\tprivate _globalViewsStatesValue: string | undefined;\n\tprivate get globalViewsStatesValue(): string {\n\t\tif (!this._globalViewsStatesValue) {\n\t\t\tthis._globalViewsStatesValue = this.getStoredGlobalViewsStatesValue();\n\t\t}\n\n\t\treturn this._globalViewsStatesValue;\n\t}\n\n\tprivate set globalViewsStatesValue(globalViewsStatesValue: string) {\n\t\tif (this.globalViewsStatesValue !== globalViewsStatesValue) {\n\t\t\tthis._globalViewsStatesValue = globalViewsStatesValue;\n\t\t\tthis.setStoredGlobalViewsStatesValue(globalViewsStatesValue);\n\t\t}\n\t}\n\n\tprivate getStoredGlobalViewsStatesValue(): string {\n\t\treturn this.storageService.get(this.globalViewsStateStorageId, StorageScope.PROFILE, '[]');\n\t}\n\n\tprivate setStoredGlobalViewsStatesValue(value: string): void {\n\t\tthis.storageService.store(this.globalViewsStateStorageId, value, StorageScope.PROFILE, StorageTarget.USER);\n\t}\n\n}\n\ninterface IViewDescriptorItem {\n\tviewDescriptor: IViewDescriptor;\n\tstate: IViewDescriptorState;\n}\n\nexport class ViewContainerModel extends Disposable implements IViewContainerModel {\n\n\tprivate readonly contextKeys = new CounterSet<string>();\n\tprivate viewDescriptorItems: IViewDescriptorItem[] = [];\n\tprivate viewDescriptorsState: ViewDescriptorsState;\n\n\t// Container Info\n\tprivate _title!: string;\n\tget title(): string { return this._title; }\n\n\tprivate _icon: URI | ThemeIcon | undefined;\n\tget icon(): URI | ThemeIcon | undefined { return this._icon; }\n\n\tprivate _keybindingId: string | undefined;\n\tget keybindingId(): string | undefined { return this._keybindingId; }\n\n\tprivate _onDidChangeContainerInfo = this._register(new Emitter<{ title?: boolean; icon?: boolean; keybindingId?: boolean }>());\n\treadonly onDidChangeContainerInfo = this._onDidChangeContainerInfo.event;\n\n\t// All View Descriptors\n\tget allViewDescriptors(): ReadonlyArray<IViewDescriptor> { return this.viewDescriptorItems.map(item => item.viewDescriptor); }\n\tprivate _onDidChangeAllViewDescriptors = this._register(new Emitter<{ added: ReadonlyArray<IViewDescriptor>; removed: ReadonlyArray<IViewDescriptor> }>());\n\treadonly onDidChangeAllViewDescriptors = this._onDidChangeAllViewDescriptors.event;\n\n\t// Active View Descriptors\n\tget activeViewDescriptors(): ReadonlyArray<IViewDescriptor> { return this.viewDescriptorItems.filter(item => item.state.active).map(item => item.viewDescriptor); }\n\tprivate _onDidChangeActiveViewDescriptors = this._register(new Emitter<{ added: ReadonlyArray<IViewDescriptor>; removed: ReadonlyArray<IViewDescriptor> }>());\n\treadonly onDidChangeActiveViewDescriptors = this._onDidChangeActiveViewDescriptors.event;\n\n\t// Visible View Descriptors\n\tget visibleViewDescriptors(): ReadonlyArray<IViewDescriptor> { return this.viewDescriptorItems.filter(item => this.isViewDescriptorVisible(item)).map(item => item.viewDescriptor); }\n\n\tprivate _onDidAddVisibleViewDescriptors = this._register(new Emitter<IAddedViewDescriptorRef[]>());\n\treadonly onDidAddVisibleViewDescriptors: Event<IAddedViewDescriptorRef[]> = this._onDidAddVisibleViewDescriptors.event;\n\n\tprivate _onDidRemoveVisibleViewDescriptors = this._register(new Emitter<IViewDescriptorRef[]>());\n\treadonly onDidRemoveVisibleViewDescriptors: Event<IViewDescriptorRef[]> = this._onDidRemoveVisibleViewDescriptors.event;\n\n\tprivate _onDidMoveVisibleViewDescriptors = this._register(new Emitter<{ from: IViewDescriptorRef; to: IViewDescriptorRef }>());\n\treadonly onDidMoveVisibleViewDescriptors: Event<{ from: IViewDescriptorRef; to: IViewDescriptorRef }> = this._onDidMoveVisibleViewDescriptors.event;\n\n\tprivate readonly logger: Lazy<ILogger>;\n\n\tconstructor(\n\t\treadonly viewContainer: ViewContainer,\n\t\t@IInstantiationService instantiationService: IInstantiationService,\n\t\t@IContextKeyService private readonly contextKeyService: IContextKeyService,\n\t\t@ILoggerService loggerService: ILoggerService,\n\t) {\n\t\tsuper();\n\n\t\tthis.logger = new Lazy(() => loggerService.createLogger(VIEWS_LOG_ID, { name: VIEWS_LOG_NAME, group: windowLogGroup }));\n\n\t\tthis._register(Event.filter(contextKeyService.onDidChangeContext, e => e.affectsSome(this.contextKeys))(() => this.onDidChangeContext()));\n\t\tthis.viewDescriptorsState = this._register(instantiationService.createInstance(ViewDescriptorsState, viewContainer.storageId || `${viewContainer.id}.state`, typeof viewContainer.title === 'string' ? viewContainer.title : viewContainer.title.original));\n\t\tthis._register(this.viewDescriptorsState.onDidChangeStoredState(items => this.updateVisibility(items)));\n\n\t\tthis.updateContainerInfo();\n\t}\n\n\tprivate updateContainerInfo(): void {\n\t\t/* Use default container info if one of the visible view descriptors belongs to the current container by default */\n\t\tconst useDefaultContainerInfo = this.viewContainer.alwaysUseContainerInfo || this.visibleViewDescriptors.length === 0 || this.visibleViewDescriptors.some(v => Registry.as<IViewsRegistry>(ViewExtensions.ViewsRegistry).getViewContainer(v.id) === this.viewContainer);\n\t\tconst title = useDefaultContainerInfo ? (typeof this.viewContainer.title === 'string' ? this.viewContainer.title : this.viewContainer.title.value) : this.visibleViewDescriptors[0]?.containerTitle || this.visibleViewDescriptors[0]?.name?.value || '';\n\t\tlet titleChanged: boolean = false;\n\t\tif (this._title !== title) {\n\t\t\tthis._title = title;\n\t\t\ttitleChanged = true;\n\t\t}\n\n\t\tconst icon = useDefaultContainerInfo ? this.viewContainer.icon : this.visibleViewDescriptors[0]?.containerIcon || defaultViewIcon;\n\t\tlet iconChanged: boolean = false;\n\t\tif (!this.isEqualIcon(icon)) {\n\t\t\tthis._icon = icon;\n\t\t\ticonChanged = true;\n\t\t}\n\n\t\tconst keybindingId = this.viewContainer.openCommandActionDescriptor?.id ?? this.activeViewDescriptors.find(v => v.openCommandActionDescriptor)?.openCommandActionDescriptor?.id;\n\t\tlet keybindingIdChanged: boolean = false;\n\t\tif (this._keybindingId !== keybindingId) {\n\t\t\tthis._keybindingId = keybindingId;\n\t\t\tkeybindingIdChanged = true;\n\t\t}\n\n\t\tif (titleChanged || iconChanged || keybindingIdChanged) {\n\t\t\tthis._onDidChangeContainerInfo.fire({ title: titleChanged, icon: iconChanged, keybindingId: keybindingIdChanged });\n\t\t}\n\t}\n\n\tprivate isEqualIcon(icon: URI | ThemeIcon | undefined): boolean {\n\t\tif (URI.isUri(icon)) {\n\t\t\treturn URI.isUri(this._icon) && isEqual(icon, this._icon);\n\t\t} else if (ThemeIcon.isThemeIcon(icon)) {\n\t\t\treturn ThemeIcon.isThemeIcon(this._icon) && ThemeIcon.isEqual(icon, this._icon);\n\t\t}\n\t\treturn icon === this._icon;\n\t}\n\n\tisVisible(id: string): boolean {\n\t\tconst viewDescriptorItem = this.viewDescriptorItems.find(v => v.viewDescriptor.id === id);\n\t\tif (!viewDescriptorItem) {\n\t\t\tthrow new Error(`Unknown view ${id}`);\n\t\t}\n\t\treturn this.isViewDescriptorVisible(viewDescriptorItem);\n\t}\n\n\tsetVisible(id: string, visible: boolean): void {\n\t\tthis.updateVisibility([{ id, visible }]);\n\t}\n\n\tprivate updateVisibility(viewDescriptors: { id: string; visible: boolean }[]): void {\n\t\t// First: Update and remove the view descriptors which are asked to be hidden\n\t\tconst viewDescriptorItemsToHide = coalesce(viewDescriptors.filter(({ visible }) => !visible)\n\t\t\t.map(({ id }) => this.findAndIgnoreIfNotFound(id)));\n\t\tconst removed: IViewDescriptorRef[] = [];\n\t\tfor (const { viewDescriptorItem, visibleIndex } of viewDescriptorItemsToHide) {\n\t\t\tif (this.updateViewDescriptorItemVisibility(viewDescriptorItem, false)) {\n\t\t\t\tremoved.push({ viewDescriptor: viewDescriptorItem.viewDescriptor, index: visibleIndex });\n\t\t\t}\n\t\t}\n\t\tif (removed.length) {\n\t\t\tthis.broadCastRemovedVisibleViewDescriptors(removed);\n\t\t}\n\n\t\t// Second: Update and add the view descriptors which are asked to be shown\n\t\tconst added: IAddedViewDescriptorRef[] = [];\n\t\tfor (const { id, visible } of viewDescriptors) {\n\t\t\tif (!visible) {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tconst foundViewDescriptor = this.findAndIgnoreIfNotFound(id);\n\t\t\tif (!foundViewDescriptor) {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tconst { viewDescriptorItem, visibleIndex } = foundViewDescriptor;\n\t\t\tif (this.updateViewDescriptorItemVisibility(viewDescriptorItem, true)) {\n\t\t\t\tadded.push({ index: visibleIndex, viewDescriptor: viewDescriptorItem.viewDescriptor, size: viewDescriptorItem.state.size, collapsed: !!viewDescriptorItem.state.collapsed });\n\t\t\t}\n\t\t}\n\t\tif (added.length) {\n\t\t\tthis.broadCastAddedVisibleViewDescriptors(added);\n\t\t}\n\t}\n\n\tprivate updateViewDescriptorItemVisibility(viewDescriptorItem: IViewDescriptorItem, visible: boolean): boolean {\n\t\tif (!viewDescriptorItem.viewDescriptor.canToggleVisibility) {\n\t\t\treturn false;\n\t\t}\n\t\tif (this.isViewDescriptorVisibleWhenActive(viewDescriptorItem) === visible) {\n\t\t\treturn false;\n\t\t}\n\n\t\t// update visibility\n\t\tif (viewDescriptorItem.viewDescriptor.workspace) {\n\t\t\tviewDescriptorItem.state.visibleWorkspace = visible;\n\t\t} else {\n\t\t\tviewDescriptorItem.state.visibleGlobal = visible;\n\t\t\tif (visible) {\n\t\t\t\tthis.logger.value.trace(`Showing view ${viewDescriptorItem.viewDescriptor.id} in the container ${this.viewContainer.id}`);\n\t\t\t}\n\t\t}\n\n\t\t// return `true` only if visibility is changed\n\t\treturn this.isViewDescriptorVisible(viewDescriptorItem) === visible;\n\t}\n\n\tisCollapsed(id: string): boolean {\n\t\treturn !!this.find(id).viewDescriptorItem.state.collapsed;\n\t}\n\n\tsetCollapsed(id: string, collapsed: boolean): void {\n\t\tconst { viewDescriptorItem } = this.find(id);\n\t\tif (viewDescriptorItem.state.collapsed !== collapsed) {\n\t\t\tviewDescriptorItem.state.collapsed = collapsed;\n\t\t}\n\t\tthis.viewDescriptorsState.updateState(this.allViewDescriptors);\n\t}\n\n\tgetSize(id: string): number | undefined {\n\t\treturn this.find(id).viewDescriptorItem.state.size;\n\t}\n\n\tsetSizes(newSizes: readonly { id: string; size: number }[]): void {\n\t\tfor (const { id, size } of newSizes) {\n\t\t\tconst { viewDescriptorItem } = this.find(id);\n\t\t\tif (viewDescriptorItem.state.size !== size) {\n\t\t\t\tviewDescriptorItem.state.size = size;\n\t\t\t}\n\t\t}\n\t\tthis.viewDescriptorsState.updateState(this.allViewDescriptors);\n\t}\n\n\tmove(from: string, to: string): void {\n\t\tconst fromIndex = this.viewDescriptorItems.findIndex(v => v.viewDescriptor.id === from);\n\t\tconst toIndex = this.viewDescriptorItems.findIndex(v => v.viewDescriptor.id === to);\n\n\t\tconst fromViewDescriptor = this.viewDescriptorItems[fromIndex];\n\t\tconst toViewDescriptor = this.viewDescriptorItems[toIndex];\n\n\t\tmove(this.viewDescriptorItems, fromIndex, toIndex);\n\n\t\tfor (let index = 0; index < this.viewDescriptorItems.length; index++) {\n\t\t\tthis.viewDescriptorItems[index].state.order = index;\n\t\t}\n\n\t\tthis.broadCastMovedViewDescriptors({ index: fromIndex, viewDescriptor: fromViewDescriptor.viewDescriptor }, { index: toIndex, viewDescriptor: toViewDescriptor.viewDescriptor });\n\t}\n\n\tadd(addedViewDescriptorStates: IAddedViewDescriptorState[]): void {\n\t\tconst addedItems: IViewDescriptorItem[] = [];\n\t\tfor (const addedViewDescriptorState of addedViewDescriptorStates) {\n\t\t\tconst viewDescriptor = addedViewDescriptorState.viewDescriptor;\n\n\t\t\tif (viewDescriptor.when) {\n\t\t\t\tfor (const key of viewDescriptor.when.keys()) {\n\t\t\t\t\tthis.contextKeys.add(key);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tlet state = this.viewDescriptorsState.get(viewDescriptor.id);\n\t\t\tif (state) {\n\t\t\t\t// set defaults if not set\n\t\t\t\tif (viewDescriptor.workspace) {\n\t\t\t\t\tstate.visibleWorkspace = isUndefinedOrNull(addedViewDescriptorState.visible) ? (isUndefinedOrNull(state.visibleWorkspace) ? !viewDescriptor.hideByDefault : state.visibleWorkspace) : addedViewDescriptorState.visible;\n\t\t\t\t} else {\n\t\t\t\t\tconst isVisible = state.visibleGlobal;\n\t\t\t\t\tstate.visibleGlobal = isUndefinedOrNull(addedViewDescriptorState.visible) ? (isUndefinedOrNull(state.visibleGlobal) ? !viewDescriptor.hideByDefault : state.visibleGlobal) : addedViewDescriptorState.visible;\n\t\t\t\t\tif (state.visibleGlobal && !isVisible) {\n\t\t\t\t\t\tthis.logger.value.trace(`Added view ${viewDescriptor.id} in the container ${this.viewContainer.id} and showing it.`, `${isVisible}`, `${viewDescriptor.hideByDefault}`, `${addedViewDescriptorState.visible}`);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tstate.collapsed = isUndefinedOrNull(addedViewDescriptorState.collapsed) ? (isUndefinedOrNull(state.collapsed) ? !!viewDescriptor.collapsed : state.collapsed) : addedViewDescriptorState.collapsed;\n\t\t\t} else {\n\t\t\t\tstate = {\n\t\t\t\t\tactive: false,\n\t\t\t\t\tvisibleGlobal: isUndefinedOrNull(addedViewDescriptorState.visible) ? !viewDescriptor.hideByDefault : addedViewDescriptorState.visible,\n\t\t\t\t\tvisibleWorkspace: isUndefinedOrNull(addedViewDescriptorState.visible) ? !viewDescriptor.hideByDefault : addedViewDescriptorState.visible,\n\t\t\t\t\tcollapsed: isUndefinedOrNull(addedViewDescriptorState.collapsed) ? !!viewDescriptor.collapsed : addedViewDescriptorState.collapsed,\n\t\t\t\t};\n\t\t\t}\n\t\t\tthis.viewDescriptorsState.set(viewDescriptor.id, state);\n\t\t\tstate.active = this.contextKeyService.contextMatchesRules(viewDescriptor.when);\n\t\t\taddedItems.push({ viewDescriptor, state });\n\t\t}\n\t\tthis.viewDescriptorItems.push(...addedItems);\n\t\tthis.viewDescriptorItems.sort(this.compareViewDescriptors.bind(this));\n\t\tthis._onDidChangeAllViewDescriptors.fire({ added: addedItems.map(({ viewDescriptor }) => viewDescriptor), removed: [] });\n\n\t\tconst addedActiveItems: { viewDescriptorItem: IViewDescriptorItem; visible: boolean }[] = [];\n\t\tfor (const viewDescriptorItem of addedItems) {\n\t\t\tif (viewDescriptorItem.state.active) {\n\t\t\t\taddedActiveItems.push({ viewDescriptorItem, visible: this.isViewDescriptorVisible(viewDescriptorItem) });\n\t\t\t}\n\t\t}\n\t\tif (addedActiveItems.length) {\n\t\t\tthis._onDidChangeActiveViewDescriptors.fire(({ added: addedActiveItems.map(({ viewDescriptorItem }) => viewDescriptorItem.viewDescriptor), removed: [] }));\n\t\t}\n\n\t\tconst addedVisibleDescriptors: IAddedViewDescriptorRef[] = [];\n\t\tfor (const { viewDescriptorItem, visible } of addedActiveItems) {\n\t\t\tif (visible && this.isViewDescriptorVisible(viewDescriptorItem)) {\n\t\t\t\tconst { visibleIndex } = this.find(viewDescriptorItem.viewDescriptor.id);\n\t\t\t\taddedVisibleDescriptors.push({ index: visibleIndex, viewDescriptor: viewDescriptorItem.viewDescriptor, size: viewDescriptorItem.state.size, collapsed: !!viewDescriptorItem.state.collapsed });\n\t\t\t}\n\t\t}\n\t\tthis.broadCastAddedVisibleViewDescriptors(addedVisibleDescriptors);\n\t}\n\n\tremove(viewDescriptors: IViewDescriptor[]): void {\n\t\tconst removed: IViewDescriptor[] = [];\n\t\tconst removedItems: IViewDescriptorItem[] = [];\n\t\tconst removedActiveDescriptors: IViewDescriptor[] = [];\n\t\tconst removedVisibleDescriptors: IViewDescriptorRef[] = [];\n\n\t\tfor (const viewDescriptor of viewDescriptors) {\n\t\t\tif (viewDescriptor.when) {\n\t\t\t\tfor (const key of viewDescriptor.when.keys()) {\n\t\t\t\t\tthis.contextKeys.delete(key);\n\t\t\t\t}\n\t\t\t}\n\t\t\tconst index = this.viewDescriptorItems.findIndex(i => i.viewDescriptor.id === viewDescriptor.id);\n\t\t\tif (index !== -1) {\n\t\t\t\tremoved.push(viewDescriptor);\n\t\t\t\tconst viewDescriptorItem = this.viewDescriptorItems[index];\n\t\t\t\tif (viewDescriptorItem.state.active) {\n\t\t\t\t\tremovedActiveDescriptors.push(viewDescriptorItem.viewDescriptor);\n\t\t\t\t}\n\t\t\t\tif (this.isViewDescriptorVisible(viewDescriptorItem)) {\n\t\t\t\t\tconst { visibleIndex } = this.find(viewDescriptorItem.viewDescriptor.id);\n\t\t\t\t\tremovedVisibleDescriptors.push({ index: visibleIndex, viewDescriptor: viewDescriptorItem.viewDescriptor });\n\t\t\t\t}\n\t\t\t\tremovedItems.push(viewDescriptorItem);\n\t\t\t}\n\t\t}\n\n\t\t// update state\n\t\tremovedItems.forEach(item => this.viewDescriptorItems.splice(this.viewDescriptorItems.indexOf(item), 1));\n\n\t\tthis.broadCastRemovedVisibleViewDescriptors(removedVisibleDescriptors);\n\t\tif (removedActiveDescriptors.length) {\n\t\t\tthis._onDidChangeActiveViewDescriptors.fire(({ added: [], removed: removedActiveDescriptors }));\n\t\t}\n\t\tif (removed.length) {\n\t\t\tthis._onDidChangeAllViewDescriptors.fire({ added: [], removed });\n\t\t}\n\t}\n\n\tprivate onDidChangeContext(): void {\n\t\tconst addedActiveItems: { item: IViewDescriptorItem; visibleWhenActive: boolean }[] = [];\n\t\tconst removedActiveItems: IViewDescriptorItem[] = [];\n\n\t\tfor (const item of this.viewDescriptorItems) {\n\t\t\tconst wasActive = item.state.active;\n\t\t\tconst isActive = this.contextKeyService.contextMatchesRules(item.viewDescriptor.when);\n\t\t\tif (wasActive !== isActive) {\n\t\t\t\tif (isActive) {\n\t\t\t\t\taddedActiveItems.push({ item, visibleWhenActive: this.isViewDescriptorVisibleWhenActive(item) });\n\t\t\t\t} else {\n\t\t\t\t\tremovedActiveItems.push(item);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tconst removedVisibleDescriptors: IViewDescriptorRef[] = [];\n\t\tfor (const item of removedActiveItems) {\n\t\t\tif (this.isViewDescriptorVisible(item)) {\n\t\t\t\tconst { visibleIndex } = this.find(item.viewDescriptor.id);\n\t\t\t\tremovedVisibleDescriptors.push({ index: visibleIndex, viewDescriptor: item.viewDescriptor });\n\t\t\t}\n\t\t}\n\n\t\t// Update the State\n\t\tremovedActiveItems.forEach(item => item.state.active = false);\n\t\taddedActiveItems.forEach(({ item }) => item.state.active = true);\n\n\t\tthis.broadCastRemovedVisibleViewDescriptors(removedVisibleDescriptors);\n\n\t\tif (addedActiveItems.length || removedActiveItems.length) {\n\t\t\tthis._onDidChangeActiveViewDescriptors.fire(({ added: addedActiveItems.map(({ item }) => item.viewDescriptor), removed: removedActiveItems.map(item => item.viewDescriptor) }));\n\t\t}\n\n\t\tconst addedVisibleDescriptors: IAddedViewDescriptorRef[] = [];\n\t\tfor (const { item, visibleWhenActive } of addedActiveItems) {\n\t\t\tif (visibleWhenActive && this.isViewDescriptorVisible(item)) {\n\t\t\t\tconst { visibleIndex } = this.find(item.viewDescriptor.id);\n\t\t\t\taddedVisibleDescriptors.push({ index: visibleIndex, viewDescriptor: item.viewDescriptor, size: item.state.size, collapsed: !!item.state.collapsed });\n\t\t\t}\n\t\t}\n\t\tthis.broadCastAddedVisibleViewDescriptors(addedVisibleDescriptors);\n\t}\n\n\tprivate broadCastAddedVisibleViewDescriptors(added: IAddedViewDescriptorRef[]): void {\n\t\tif (added.length) {\n\t\t\tthis._onDidAddVisibleViewDescriptors.fire(added.sort((a, b) => a.index - b.index));\n\t\t\tthis.updateState(`Added views:${added.map(v => v.viewDescriptor.id).join(',')} in ${this.viewContainer.id}`);\n\t\t}\n\t}\n\n\tprivate broadCastRemovedVisibleViewDescriptors(removed: IViewDescriptorRef[]): void {\n\t\tif (removed.length) {\n\t\t\tthis._onDidRemoveVisibleViewDescriptors.fire(removed.sort((a, b) => b.index - a.index));\n\t\t\tthis.updateState(`Removed views:${removed.map(v => v.viewDescriptor.id).join(',')} from ${this.viewContainer.id}`);\n\t\t}\n\t}\n\n\tprivate broadCastMovedViewDescriptors(from: IViewDescriptorRef, to: IViewDescriptorRef): void {\n\t\tthis._onDidMoveVisibleViewDescriptors.fire({ from, to });\n\t\tthis.updateState(`Moved view ${from.viewDescriptor.id} to ${to.viewDescriptor.id} in ${this.viewContainer.id}`);\n\t}\n\n\tprivate updateState(reason: string): void {\n\t\tthis.logger.value.trace(reason);\n\t\tthis.viewDescriptorsState.updateState(this.allViewDescriptors);\n\t\tthis.updateContainerInfo();\n\t}\n\n\tprivate isViewDescriptorVisible(viewDescriptorItem: IViewDescriptorItem): boolean {\n\t\tif (!viewDescriptorItem.state.active) {\n\t\t\treturn false;\n\t\t}\n\t\treturn this.isViewDescriptorVisibleWhenActive(viewDescriptorItem);\n\t}\n\n\tprivate isViewDescriptorVisibleWhenActive(viewDescriptorItem: IViewDescriptorItem): boolean {\n\t\tif (viewDescriptorItem.viewDescriptor.workspace) {\n\t\t\treturn !!viewDescriptorItem.state.visibleWorkspace;\n\t\t}\n\t\treturn !!viewDescriptorItem.state.visibleGlobal;\n\t}\n\n\tprivate find(id: string): { index: number; visibleIndex: number; viewDescriptorItem: IViewDescriptorItem } {\n\t\tconst result = this.findAndIgnoreIfNotFound(id);\n\t\tif (result) {\n\t\t\treturn result;\n\t\t}\n\t\tthrow new Error(`view descriptor ${id} not found`);\n\t}\n\n\tprivate findAndIgnoreIfNotFound(id: string): { index: number; visibleIndex: number; viewDescriptorItem: IViewDescriptorItem } | undefined {\n\t\tfor (let i = 0, visibleIndex = 0; i < this.viewDescriptorItems.length; i++) {\n\t\t\tconst viewDescriptorItem = this.viewDescriptorItems[i];\n\t\t\tif (viewDescriptorItem.viewDescriptor.id === id) {\n\t\t\t\treturn { index: i, visibleIndex, viewDescriptorItem: viewDescriptorItem };\n\t\t\t}\n\t\t\tif (this.isViewDescriptorVisible(viewDescriptorItem)) {\n\t\t\t\tvisibleIndex++;\n\t\t\t}\n\t\t}\n\t\treturn undefined;\n\t}\n\n\tprivate compareViewDescriptors(a: IViewDescriptorItem, b: IViewDescriptorItem): number {\n\t\tif (a.viewDescriptor.id === b.viewDescriptor.id) {\n\t\t\treturn 0;\n\t\t}\n\n\t\treturn (this.getViewOrder(a) - this.getViewOrder(b)) || this.getGroupOrderResult(a.viewDescriptor, b.viewDescriptor);\n\t}\n\n\tprivate getViewOrder(viewDescriptorItem: IViewDescriptorItem): number {\n\t\tconst viewOrder = typeof viewDescriptorItem.state.order === 'number' ? viewDescriptorItem.state.order : viewDescriptorItem.viewDescriptor.order;\n\t\treturn typeof viewOrder === 'number' ? viewOrder : Number.MAX_VALUE;\n\t}\n\n\tprivate getGroupOrderResult(a: IViewDescriptor, b: IViewDescriptor) {\n\t\tif (!a.group || !b.group) {\n\t\t\treturn 0;\n\t\t}\n\n\t\tif (a.group === b.group) {\n\t\t\treturn 0;\n\t\t}\n\n\t\treturn a.group < b.group ? -1 : 1;\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { ViewContainer, IViewsRegistry, IViewDescriptor, Extensions as ViewExtensions, IViewContainerModel, IAddedViewDescriptorRef, IViewDescriptorRef, IAddedViewDescriptorState, defaultViewIcon, VIEWS_LOG_ID, VIEWS_LOG_NAME } from '../../../common/views.js';\nimport { IContextKeyService } from '../../../../platform/contextkey/common/contextkey.js';\nimport { IStorageService, StorageScope, StorageTarget } from '../../../../platform/storage/common/storage.js';\nimport { Registry } from '../../../../platform/registry/common/platform.js';\nimport { Disposable } from '../../../../base/common/lifecycle.js';\nimport { Event, Emitter } from '../../../../base/common/event.js';\nimport { IInstantiationService } from '../../../../platform/instantiation/common/instantiation.js';\nimport { URI } from '../../../../base/common/uri.js';\nimport { coalesce, move } from '../../../../base/common/arrays.js';\nimport { isUndefined, isUndefinedOrNull } from '../../../../base/common/types.js';\nimport { isEqual } from '../../../../base/common/resources.js';\nimport { ThemeIcon } from '../../../../base/common/themables.js';\nimport { IStringDictionary } from '../../../../base/common/collections.js';\nimport { ILogger, ILoggerService } from '../../../../platform/log/common/log.js';\nimport { CounterSet } from '../../../../base/common/map.js';\nimport { Lazy } from '../../../../base/common/lazy.js';\nimport { windowLogGroup } from '../../log/common/logConstants.js';\n\nexport function getViewsStateStorageId(viewContainerStorageId: string): string { return `${viewContainerStorageId}.hidden`; }\n\ninterface IStoredWorkspaceViewState {\n\tcollapsed: boolean;\n\tisHidden: boolean;\n\tsize?: number;\n\torder?: number;\n}\n\ninterface IStoredGlobalViewState {\n\tid: string;\n\tisHidden: boolean;\n\torder?: number;\n}\n\ninterface IViewDescriptorState {\n\tvisibleGlobal: boolean | undefined;\n\tvisibleWorkspace: boolean | undefined;\n\tcollapsed: boolean | undefined;\n\tactive: boolean;\n\torder?: number;\n\tsize?: number;\n}\n\nclass ViewDescriptorsState extends Disposable {\n\n\tprivate readonly workspaceViewsStateStorageId: string;\n\tprivate readonly globalViewsStateStorageId: string;\n\tprivate readonly state: Map<string, IViewDescriptorState>;\n\n\tprivate _onDidChangeStoredState = this._register(new Emitter<{ id: string; visible: boolean }[]>());\n\treadonly onDidChangeStoredState = this._onDidChangeStoredState.event;\n\n\tprivate readonly logger: Lazy<ILogger>;\n\n\tconstructor(\n\t\tviewContainerStorageId: string,\n\t\tprivate readonly viewContainerName: string,\n\t\t@IStorageService private readonly storageService: IStorageService,\n\t\t@ILoggerService loggerService: ILoggerService,\n\t) {\n\t\tsuper();\n\n\t\tthis.logger = new Lazy(() => loggerService.createLogger(VIEWS_LOG_ID, { name: VIEWS_LOG_NAME, group: windowLogGroup }));\n\n\t\tthis.globalViewsStateStorageId = getViewsStateStorageId(viewContainerStorageId);\n\t\tthis.workspaceViewsStateStorageId = viewContainerStorageId;\n\t\tthis._register(this.storageService.onDidChangeValue(StorageScope.PROFILE, this.globalViewsStateStorageId, this._store)(() => this.onDidStorageChange()));\n\n\t\tthis.state = this.initialize();\n\n\t}\n\n\tset(id: string, state: IViewDescriptorState): void {\n\t\tthis.state.set(id, state);\n\t}\n\n\tget(id: string): IViewDescriptorState | undefined {\n\t\treturn this.state.get(id);\n\t}\n\n\tupdateState(viewDescriptors: ReadonlyArray<IViewDescriptor>): void {\n\t\tthis.updateWorkspaceState(viewDescriptors);\n\t\tthis.updateGlobalState(viewDescriptors);\n\t}\n\n\tprivate updateWorkspaceState(viewDescriptors: ReadonlyArray<IViewDescriptor>): void {\n\t\tconst storedViewsStates = this.getStoredWorkspaceState();\n\t\tfor (const viewDescriptor of viewDescriptors) {\n\t\t\tconst viewState = this.get(viewDescriptor.id);\n\t\t\tif (viewState) {\n\t\t\t\tstoredViewsStates[viewDescriptor.id] = {\n\t\t\t\t\tcollapsed: !!viewState.collapsed,\n\t\t\t\t\tisHidden: !viewState.visibleWorkspace,\n\t\t\t\t\tsize: viewState.size,\n\t\t\t\t\torder: viewDescriptor.workspace && viewState ? viewState.order : undefined\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\n\t\tif (Object.keys(storedViewsStates).length > 0) {\n\t\t\tthis.storageService.store(this.workspaceViewsStateStorageId, JSON.stringify(storedViewsStates), StorageScope.WORKSPACE, StorageTarget.MACHINE);\n\t\t} else {\n\t\t\tthis.storageService.remove(this.workspaceViewsStateStorageId, StorageScope.WORKSPACE);\n\t\t}\n\t}\n\n\tprivate updateGlobalState(viewDescriptors: ReadonlyArray<IViewDescriptor>): void {\n\t\tconst storedGlobalState = this.getStoredGlobalState();\n\t\tfor (const viewDescriptor of viewDescriptors) {\n\t\t\tconst state = this.get(viewDescriptor.id);\n\t\t\tstoredGlobalState.set(viewDescriptor.id, {\n\t\t\t\tid: viewDescriptor.id,\n\t\t\t\tisHidden: state && viewDescriptor.canToggleVisibility ? !state.visibleGlobal : false,\n\t\t\t\torder: !viewDescriptor.workspace && state ? state.order : undefined\n\t\t\t});\n\t\t}\n\t\tthis.setStoredGlobalState(storedGlobalState);\n\t}\n\n\tprivate onDidStorageChange(): void {\n\t\tif (this.globalViewsStatesValue !== this.getStoredGlobalViewsStatesValue() /* This checks if current window changed the value or not */) {\n\t\t\tthis._globalViewsStatesValue = undefined;\n\t\t\tconst storedViewsVisibilityStates = this.getStoredGlobalState();\n\t\t\tconst storedWorkspaceViewsStates = this.getStoredWorkspaceState();\n\t\t\tconst changedStates: { id: string; visible: boolean }[] = [];\n\t\t\tfor (const [id, storedState] of storedViewsVisibilityStates) {\n\t\t\t\tconst state = this.get(id);\n\t\t\t\tif (state) {\n\t\t\t\t\tif (state.visibleGlobal !== !storedState.isHidden) {\n\t\t\t\t\t\tif (!storedState.isHidden) {\n\t\t\t\t\t\t\tthis.logger.value.trace(`View visibility state changed: ${id} is now visible`, this.viewContainerName);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tchangedStates.push({ id, visible: !storedState.isHidden });\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tconst workspaceViewState: IStoredWorkspaceViewState | undefined = storedWorkspaceViewsStates[id];\n\t\t\t\t\tthis.set(id, {\n\t\t\t\t\t\tactive: false,\n\t\t\t\t\t\tvisibleGlobal: !storedState.isHidden,\n\t\t\t\t\t\tvisibleWorkspace: isUndefined(workspaceViewState?.isHidden) ? undefined : !workspaceViewState?.isHidden,\n\t\t\t\t\t\tcollapsed: workspaceViewState?.collapsed,\n\t\t\t\t\t\torder: workspaceViewState?.order,\n\t\t\t\t\t\tsize: workspaceViewState?.size,\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (changedStates.length) {\n\t\t\t\tthis._onDidChangeStoredState.fire(changedStates);\n\t\t\t\t// Update the in memory state after firing the event\n\t\t\t\t// so that the views can update their state accordingly\n\t\t\t\tfor (const changedState of changedStates) {\n\t\t\t\t\tconst state = this.get(changedState.id);\n\t\t\t\t\tif (state) {\n\t\t\t\t\t\tstate.visibleGlobal = changedState.visible;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate initialize(): Map<string, IViewDescriptorState> {\n\t\tconst viewStates = new Map<string, IViewDescriptorState>();\n\t\tconst workspaceViewsStates = this.getStoredWorkspaceState();\n\t\tfor (const id of Object.keys(workspaceViewsStates)) {\n\t\t\tconst workspaceViewState = workspaceViewsStates[id];\n\t\t\tviewStates.set(id, {\n\t\t\t\tactive: false,\n\t\t\t\tvisibleGlobal: undefined,\n\t\t\t\tvisibleWorkspace: isUndefined(workspaceViewState.isHidden) ? undefined : !workspaceViewState.isHidden,\n\t\t\t\tcollapsed: workspaceViewState.collapsed,\n\t\t\t\torder: workspaceViewState.order,\n\t\t\t\tsize: workspaceViewState.size,\n\t\t\t});\n\t\t}\n\n\t\t// Migrate to `viewletStateStorageId`\n\t\tconst value = this.storageService.get(this.globalViewsStateStorageId, StorageScope.WORKSPACE, '[]');\n\t\tconst { state: workspaceVisibilityStates } = this.parseStoredGlobalState(value);\n\t\tif (workspaceVisibilityStates.size > 0) {\n\t\t\tfor (const { id, isHidden } of workspaceVisibilityStates.values()) {\n\t\t\t\tconst viewState = viewStates.get(id);\n\t\t\t\t// Not migrated to `viewletStateStorageId`\n\t\t\t\tif (viewState) {\n\t\t\t\t\tif (isUndefined(viewState.visibleWorkspace)) {\n\t\t\t\t\t\tviewState.visibleWorkspace = !isHidden;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tviewStates.set(id, {\n\t\t\t\t\t\tactive: false,\n\t\t\t\t\t\tcollapsed: undefined,\n\t\t\t\t\t\tvisibleGlobal: undefined,\n\t\t\t\t\t\tvisibleWorkspace: !isHidden,\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis.storageService.remove(this.globalViewsStateStorageId, StorageScope.WORKSPACE);\n\t\t}\n\n\t\tconst { state, hasDuplicates } = this.parseStoredGlobalState(this.globalViewsStatesValue);\n\t\tif (hasDuplicates) {\n\t\t\tthis.setStoredGlobalState(state);\n\t\t}\n\t\tfor (const { id, isHidden, order } of state.values()) {\n\t\t\tconst viewState = viewStates.get(id);\n\t\t\tif (viewState) {\n\t\t\t\tviewState.visibleGlobal = !isHidden;\n\t\t\t\tif (!isUndefined(order)) {\n\t\t\t\t\tviewState.order = order;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tviewStates.set(id, {\n\t\t\t\t\tactive: false,\n\t\t\t\t\tvisibleGlobal: !isHidden,\n\t\t\t\t\torder,\n\t\t\t\t\tcollapsed: undefined,\n\t\t\t\t\tvisibleWorkspace: undefined,\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t\treturn viewStates;\n\t}\n\n\tprivate getStoredWorkspaceState(): IStringDictionary<IStoredWorkspaceViewState> {\n\t\treturn JSON.parse(this.storageService.get(this.workspaceViewsStateStorageId, StorageScope.WORKSPACE, '{}'));\n\t}\n\n\tprivate getStoredGlobalState(): Map<string, IStoredGlobalViewState> {\n\t\treturn this.parseStoredGlobalState(this.globalViewsStatesValue).state;\n\t}\n\n\tprivate setStoredGlobalState(storedGlobalState: Map<string, IStoredGlobalViewState>): void {\n\t\tthis.globalViewsStatesValue = JSON.stringify([...storedGlobalState.values()]);\n\t}\n\n\tprivate parseStoredGlobalState(value: string): { state: Map<string, IStoredGlobalViewState>; hasDuplicates: boolean } {\n\t\tconst storedValue: Array<string | IStoredGlobalViewState> = JSON.parse(value);\n\t\tlet hasDuplicates = false;\n\t\tconst state = storedValue.reduce((result, storedState) => {\n\t\t\tif (typeof storedState === 'string' /* migration */) {\n\t\t\t\thasDuplicates = hasDuplicates || result.has(storedState);\n\t\t\t\tresult.set(storedState, { id: storedState, isHidden: true });\n\t\t\t} else {\n\t\t\t\thasDuplicates = hasDuplicates || result.has(storedState.id);\n\t\t\t\tresult.set(storedState.id, storedState);\n\t\t\t}\n\t\t\treturn result;\n\t\t}, new Map<string, IStoredGlobalViewState>());\n\t\treturn { state, hasDuplicates };\n\t}\n\n\tprivate _globalViewsStatesValue: string | undefined;\n\tprivate get globalViewsStatesValue(): string {\n\t\tif (!this._globalViewsStatesValue) {\n\t\t\tthis._globalViewsStatesValue = this.getStoredGlobalViewsStatesValue();\n\t\t}\n\n\t\treturn this._globalViewsStatesValue;\n\t}\n\n\tprivate set globalViewsStatesValue(globalViewsStatesValue: string) {\n\t\tif (this.globalViewsStatesValue !== globalViewsStatesValue) {\n\t\t\tthis._globalViewsStatesValue = globalViewsStatesValue;\n\t\t\tthis.setStoredGlobalViewsStatesValue(globalViewsStatesValue);\n\t\t}\n\t}\n\n\tprivate getStoredGlobalViewsStatesValue(): string {\n\t\treturn this.storageService.get(this.globalViewsStateStorageId, StorageScope.PROFILE, '[]');\n\t}\n\n\tprivate setStoredGlobalViewsStatesValue(value: string): void {\n\t\tthis.storageService.store(this.globalViewsStateStorageId, value, StorageScope.PROFILE, StorageTarget.USER);\n\t}\n\n}\n\ninterface IViewDescriptorItem {\n\tviewDescriptor: IViewDescriptor;\n\tstate: IViewDescriptorState;\n}\n\nexport class ViewContainerModel extends Disposable implements IViewContainerModel {\n\n\tprivate readonly contextKeys = new CounterSet<string>();\n\tprivate viewDescriptorItems: IViewDescriptorItem[] = [];\n\tprivate viewDescriptorsState: ViewDescriptorsState;\n\n\t// Container Info\n\tprivate _title!: string;\n\tget title(): string { return this._title; }\n\n\tprivate _icon: URI | ThemeIcon | undefined;\n\tget icon(): URI | ThemeIcon | undefined { return this._icon; }\n\n\tprivate _keybindingId: string | undefined;\n\tget keybindingId(): string | undefined { return this._keybindingId; }\n\n\tprivate _onDidChangeContainerInfo = this._register(new Emitter<{ title?: boolean; icon?: boolean; keybindingId?: boolean }>());\n\treadonly onDidChangeContainerInfo = this._onDidChangeContainerInfo.event;\n\n\t// All View Descriptors\n\tget allViewDescriptors(): ReadonlyArray<IViewDescriptor> { return this.viewDescriptorItems.map(item => item.viewDescriptor); }\n\tprivate _onDidChangeAllViewDescriptors = this._register(new Emitter<{ added: ReadonlyArray<IViewDescriptor>; removed: ReadonlyArray<IViewDescriptor> }>());\n\treadonly onDidChangeAllViewDescriptors = this._onDidChangeAllViewDescriptors.event;\n\n\t// Active View Descriptors\n\tget activeViewDescriptors(): ReadonlyArray<IViewDescriptor> { return this.viewDescriptorItems.filter(item => item.state.active).map(item => item.viewDescriptor); }\n\tprivate _onDidChangeActiveViewDescriptors = this._register(new Emitter<{ added: ReadonlyArray<IViewDescriptor>; removed: ReadonlyArray<IViewDescriptor> }>());\n\treadonly onDidChangeActiveViewDescriptors = this._onDidChangeActiveViewDescriptors.event;\n\n\t// Visible View Descriptors\n\tget visibleViewDescriptors(): ReadonlyArray<IViewDescriptor> { return this.viewDescriptorItems.filter(item => this.isViewDescriptorVisible(item)).map(item => item.viewDescriptor); }\n\n\tprivate _onDidAddVisibleViewDescriptors = this._register(new Emitter<IAddedViewDescriptorRef[]>());\n\treadonly onDidAddVisibleViewDescriptors: Event<IAddedViewDescriptorRef[]> = this._onDidAddVisibleViewDescriptors.event;\n\n\tprivate _onDidRemoveVisibleViewDescriptors = this._register(new Emitter<IViewDescriptorRef[]>());\n\treadonly onDidRemoveVisibleViewDescriptors: Event<IViewDescriptorRef[]> = this._onDidRemoveVisibleViewDescriptors.event;\n\n\tprivate _onDidMoveVisibleViewDescriptors = this._register(new Emitter<{ from: IViewDescriptorRef; to: IViewDescriptorRef }>());\n\treadonly onDidMoveVisibleViewDescriptors: Event<{ from: IViewDescriptorRef; to: IViewDescriptorRef }> = this._onDidMoveVisibleViewDescriptors.event;\n\n\tprivate readonly logger: Lazy<ILogger>;\n\n\tconstructor(\n\t\treadonly viewContainer: ViewContainer,\n\t\t@IInstantiationService instantiationService: IInstantiationService,\n\t\t@IContextKeyService private readonly contextKeyService: IContextKeyService,\n\t\t@ILoggerService loggerService: ILoggerService,\n\t) {\n\t\tsuper();\n\n\t\tthis.logger = new Lazy(() => loggerService.createLogger(VIEWS_LOG_ID, { name: VIEWS_LOG_NAME, group: windowLogGroup }));\n\n\t\tthis._register(Event.filter(contextKeyService.onDidChangeContext, e => e.affectsSome(this.contextKeys))(() => this.onDidChangeContext()));\n\t\tthis.viewDescriptorsState = this._register(instantiationService.createInstance(ViewDescriptorsState, viewContainer.storageId || `${viewContainer.id}.state`, typeof viewContainer.title === 'string' ? viewContainer.title : viewContainer.title.original));\n\t\tthis._register(this.viewDescriptorsState.onDidChangeStoredState(items => this.updateVisibility(items)));\n\n\t\tthis.updateContainerInfo();\n\t}\n\n\tprivate updateContainerInfo(): void {\n\t\t/* Use default container info if one of the visible view descriptors belongs to the current container by default */\n\t\tconst useDefaultContainerInfo = this.viewContainer.alwaysUseContainerInfo || this.visibleViewDescriptors.length === 0 || this.visibleViewDescriptors.some(v => Registry.as<IViewsRegistry>(ViewExtensions.ViewsRegistry).getViewContainer(v.id) === this.viewContainer);\n\t\tconst title = useDefaultContainerInfo ? (typeof this.viewContainer.title === 'string' ? this.viewContainer.title : this.viewContainer.title.value) : this.visibleViewDescriptors[0]?.containerTitle || this.visibleViewDescriptors[0]?.name?.value || '';\n\t\tlet titleChanged: boolean = false;\n\t\tif (this._title !== title) {\n\t\t\tthis._title = title;\n\t\t\ttitleChanged = true;\n\t\t}\n\n\t\tconst icon = useDefaultContainerInfo ? this.viewContainer.icon : this.visibleViewDescriptors[0]?.containerIcon || defaultViewIcon;\n\t\tlet iconChanged: boolean = false;\n\t\tif (!this.isEqualIcon(icon)) {\n\t\t\tthis._icon = icon;\n\t\t\ticonChanged = true;\n\t\t}\n\n\t\tconst keybindingId = this.viewContainer.openCommandActionDescriptor?.id ?? this.activeViewDescriptors.find(v => v.openCommandActionDescriptor)?.openCommandActionDescriptor?.id;\n\t\tlet keybindingIdChanged: boolean = false;\n\t\tif (this._keybindingId !== keybindingId) {\n\t\t\tthis._keybindingId = keybindingId;\n\t\t\tkeybindingIdChanged = true;\n\t\t}\n\n\t\tif (titleChanged || iconChanged || keybindingIdChanged) {\n\t\t\tthis._onDidChangeContainerInfo.fire({ title: titleChanged, icon: iconChanged, keybindingId: keybindingIdChanged });\n\t\t}\n\t}\n\n\tprivate isEqualIcon(icon: URI | ThemeIcon | undefined): boolean {\n\t\tif (URI.isUri(icon)) {\n\t\t\treturn URI.isUri(this._icon) && isEqual(icon, this._icon);\n\t\t} else if (ThemeIcon.isThemeIcon(icon)) {\n\t\t\treturn ThemeIcon.isThemeIcon(this._icon) && ThemeIcon.isEqual(icon, this._icon);\n\t\t}\n\t\treturn icon === this._icon;\n\t}\n\n\tisVisible(id: string): boolean {\n\t\tconst viewDescriptorItem = this.viewDescriptorItems.find(v => v.viewDescriptor.id === id);\n\t\tif (!viewDescriptorItem) {\n\t\t\tthrow new Error(`Unknown view ${id}`);\n\t\t}\n\t\treturn this.isViewDescriptorVisible(viewDescriptorItem);\n\t}\n\n\tsetVisible(id: string, visible: boolean): void {\n\t\tthis.updateVisibility([{ id, visible }]);\n\t}\n\n\tprivate updateVisibility(viewDescriptors: { id: string; visible: boolean }[]): void {\n\t\t// First: Update and remove the view descriptors which are asked to be hidden\n\t\tconst viewDescriptorItemsToHide = coalesce(viewDescriptors.filter(({ visible }) => !visible)\n\t\t\t.map(({ id }) => this.findAndIgnoreIfNotFound(id)));\n\t\tconst removed: IViewDescriptorRef[] = [];\n\t\tfor (const { viewDescriptorItem, visibleIndex } of viewDescriptorItemsToHide) {\n\t\t\tif (this.updateViewDescriptorItemVisibility(viewDescriptorItem, false)) {\n\t\t\t\tremoved.push({ viewDescriptor: viewDescriptorItem.viewDescriptor, index: visibleIndex });\n\t\t\t}\n\t\t}\n\t\tif (removed.length) {\n\t\t\tthis.broadCastRemovedVisibleViewDescriptors(removed);\n\t\t}\n\n\t\t// Second: Update and add the view descriptors which are asked to be shown\n\t\tconst added: IAddedViewDescriptorRef[] = [];\n\t\tfor (const { id, visible } of viewDescriptors) {\n\t\t\tif (!visible) {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tconst foundViewDescriptor = this.findAndIgnoreIfNotFound(id);\n\t\t\tif (!foundViewDescriptor) {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tconst { viewDescriptorItem, visibleIndex } = foundViewDescriptor;\n\t\t\tif (this.updateViewDescriptorItemVisibility(viewDescriptorItem, true)) {\n\t\t\t\tadded.push({ index: visibleIndex, viewDescriptor: viewDescriptorItem.viewDescriptor, size: viewDescriptorItem.state.size, collapsed: !!viewDescriptorItem.state.collapsed });\n\t\t\t}\n\t\t}\n\t\tif (added.length) {\n\t\t\tthis.broadCastAddedVisibleViewDescriptors(added);\n\t\t}\n\t}\n\n\tprivate updateViewDescriptorItemVisibility(viewDescriptorItem: IViewDescriptorItem, visible: boolean): boolean {\n\t\tif (!viewDescriptorItem.viewDescriptor.canToggleVisibility) {\n\t\t\treturn false;\n\t\t}\n\t\tif (this.isViewDescriptorVisibleWhenActive(viewDescriptorItem) === visible) {\n\t\t\treturn false;\n\t\t}\n\n\t\t// update visibility\n\t\tif (viewDescriptorItem.viewDescriptor.workspace) {\n\t\t\tviewDescriptorItem.state.visibleWorkspace = visible;\n\t\t} else {\n\t\t\tviewDescriptorItem.state.visibleGlobal = visible;\n\t\t\tif (visible) {\n\t\t\t\tthis.logger.value.trace(`Showing view ${viewDescriptorItem.viewDescriptor.id} in the container ${this.viewContainer.id}`);\n\t\t\t}\n\t\t}\n\n\t\t// return `true` only if visibility is changed\n\t\treturn this.isViewDescriptorVisible(viewDescriptorItem) === visible;\n\t}\n\n\tisCollapsed(id: string): boolean {\n\t\treturn !!this.find(id).viewDescriptorItem.state.collapsed;\n\t}\n\n\tsetCollapsed(id: string, collapsed: boolean): void {\n\t\tconst { viewDescriptorItem } = this.find(id);\n\t\tif (viewDescriptorItem.state.collapsed !== collapsed) {\n\t\t\tviewDescriptorItem.state.collapsed = collapsed;\n\t\t}\n\t\tthis.viewDescriptorsState.updateState(this.allViewDescriptors);\n\t}\n\n\tgetSize(id: string): number | undefined {\n\t\treturn this.find(id).viewDescriptorItem.state.size;\n\t}\n\n\tsetSizes(newSizes: readonly { id: string; size: number }[]): void {\n\t\tfor (const { id, size } of newSizes) {\n\t\t\tconst { viewDescriptorItem } = this.find(id);\n\t\t\tif (viewDescriptorItem.state.size !== size) {\n\t\t\t\tviewDescriptorItem.state.size = size;\n\t\t\t}\n\t\t}\n\t\tthis.viewDescriptorsState.updateState(this.allViewDescriptors);\n\t}\n\n\tmove(from: string, to: string): void {\n\t\tconst fromIndex = this.viewDescriptorItems.findIndex(v => v.viewDescriptor.id === from);\n\t\tconst toIndex = this.viewDescriptorItems.findIndex(v => v.viewDescriptor.id === to);\n\n\t\tconst fromViewDescriptor = this.viewDescriptorItems[fromIndex];\n\t\tconst toViewDescriptor = this.viewDescriptorItems[toIndex];\n\n\t\tmove(this.viewDescriptorItems, fromIndex, toIndex);\n\n\t\tfor (let index = 0; index < this.viewDescriptorItems.length; index++) {\n\t\t\tthis.viewDescriptorItems[index].state.order = index;\n\t\t}\n\n\t\tthis.broadCastMovedViewDescriptors({ index: fromIndex, viewDescriptor: fromViewDescriptor.viewDescriptor }, { index: toIndex, viewDescriptor: toViewDescriptor.viewDescriptor });\n\t}\n\n\tadd(addedViewDescriptorStates: IAddedViewDescriptorState[]): void {\n\t\tconst addedItems: IViewDescriptorItem[] = [];\n\t\tfor (const addedViewDescriptorState of addedViewDescriptorStates) {\n\t\t\tconst viewDescriptor = addedViewDescriptorState.viewDescriptor;\n\n\t\t\tif (viewDescriptor.when) {\n\t\t\t\tfor (const key of viewDescriptor.when.keys()) {\n\t\t\t\t\tthis.contextKeys.add(key);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tlet state = this.viewDescriptorsState.get(viewDescriptor.id);\n\t\t\tif (state) {\n\t\t\t\t// set defaults if not set\n\t\t\t\tif (viewDescriptor.workspace) {\n\t\t\t\t\tstate.visibleWorkspace = isUndefinedOrNull(addedViewDescriptorState.visible) ? (isUndefinedOrNull(state.visibleWorkspace) ? !viewDescriptor.hideByDefault : state.visibleWorkspace) : addedViewDescriptorState.visible;\n\t\t\t\t} else {\n\t\t\t\t\tconst isVisible = state.visibleGlobal;\n\t\t\t\t\tstate.visibleGlobal = isUndefinedOrNull(addedViewDescriptorState.visible) ? (isUndefinedOrNull(state.visibleGlobal) ? !viewDescriptor.hideByDefault : state.visibleGlobal) : addedViewDescriptorState.visible;\n\t\t\t\t\tif (state.visibleGlobal && !isVisible) {\n\t\t\t\t\t\tthis.logger.value.trace(`Added view ${viewDescriptor.id} in the container ${this.viewContainer.id} and showing it.`, `${isVisible}`, `${viewDescriptor.hideByDefault}`, `${addedViewDescriptorState.visible}`);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tstate.collapsed = isUndefinedOrNull(addedViewDescriptorState.collapsed) ? (isUndefinedOrNull(state.collapsed) ? !!viewDescriptor.collapsed : state.collapsed) : addedViewDescriptorState.collapsed;\n\t\t\t} else {\n\t\t\t\tstate = {\n\t\t\t\t\tactive: false,\n\t\t\t\t\tvisibleGlobal: isUndefinedOrNull(addedViewDescriptorState.visible) ? !viewDescriptor.hideByDefault : addedViewDescriptorState.visible,\n\t\t\t\t\tvisibleWorkspace: isUndefinedOrNull(addedViewDescriptorState.visible) ? !viewDescriptor.hideByDefault : addedViewDescriptorState.visible,\n\t\t\t\t\tcollapsed: isUndefinedOrNull(addedViewDescriptorState.collapsed) ? !!viewDescriptor.collapsed : addedViewDescriptorState.collapsed,\n\t\t\t\t};\n\t\t\t}\n\t\t\tthis.viewDescriptorsState.set(viewDescriptor.id, state);\n\t\t\tstate.active = this.contextKeyService.contextMatchesRules(viewDescriptor.when);\n\t\t\taddedItems.push({ viewDescriptor, state });\n\t\t}\n\t\tthis.viewDescriptorItems.push(...addedItems);\n\t\tthis.viewDescriptorItems.sort(this.compareViewDescriptors.bind(this));\n\t\tthis._onDidChangeAllViewDescriptors.fire({ added: addedItems.map(({ viewDescriptor }) => viewDescriptor), removed: [] });\n\n\t\tconst addedActiveItems: { viewDescriptorItem: IViewDescriptorItem; visible: boolean }[] = [];\n\t\tfor (const viewDescriptorItem of addedItems) {\n\t\t\tif (viewDescriptorItem.state.active) {\n\t\t\t\taddedActiveItems.push({ viewDescriptorItem, visible: this.isViewDescriptorVisible(viewDescriptorItem) });\n\t\t\t}\n\t\t}\n\t\tif (addedActiveItems.length) {\n\t\t\tthis._onDidChangeActiveViewDescriptors.fire(({ added: addedActiveItems.map(({ viewDescriptorItem }) => viewDescriptorItem.viewDescriptor), removed: [] }));\n\t\t}\n\n\t\tconst addedVisibleDescriptors: IAddedViewDescriptorRef[] = [];\n\t\tfor (const { viewDescriptorItem, visible } of addedActiveItems) {\n\t\t\tif (visible && this.isViewDescriptorVisible(viewDescriptorItem)) {\n\t\t\t\tconst { visibleIndex } = this.find(viewDescriptorItem.viewDescriptor.id);\n\t\t\t\taddedVisibleDescriptors.push({ index: visibleIndex, viewDescriptor: viewDescriptorItem.viewDescriptor, size: viewDescriptorItem.state.size, collapsed: !!viewDescriptorItem.state.collapsed });\n\t\t\t}\n\t\t}\n\t\tthis.broadCastAddedVisibleViewDescriptors(addedVisibleDescriptors);\n\t}\n\n\tremove(viewDescriptors: IViewDescriptor[]): void {\n\t\tconst removed: IViewDescriptor[] = [];\n\t\tconst removedItems: IViewDescriptorItem[] = [];\n\t\tconst removedActiveDescriptors: IViewDescriptor[] = [];\n\t\tconst removedVisibleDescriptors: IViewDescriptorRef[] = [];\n\n\t\tfor (const viewDescriptor of viewDescriptors) {\n\t\t\tif (viewDescriptor.when) {\n\t\t\t\tfor (const key of viewDescriptor.when.keys()) {\n\t\t\t\t\tthis.contextKeys.delete(key);\n\t\t\t\t}\n\t\t\t}\n\t\t\tconst index = this.viewDescriptorItems.findIndex(i => i.viewDescriptor.id === viewDescriptor.id);\n\t\t\tif (index !== -1) {\n\t\t\t\tremoved.push(viewDescriptor);\n\t\t\t\tconst viewDescriptorItem = this.viewDescriptorItems[index];\n\t\t\t\tif (viewDescriptorItem.state.active) {\n\t\t\t\t\tremovedActiveDescriptors.push(viewDescriptorItem.viewDescriptor);\n\t\t\t\t}\n\t\t\t\tif (this.isViewDescriptorVisible(viewDescriptorItem)) {\n\t\t\t\t\tconst { visibleIndex } = this.find(viewDescriptorItem.viewDescriptor.id);\n\t\t\t\t\tremovedVisibleDescriptors.push({ index: visibleIndex, viewDescriptor: viewDescriptorItem.viewDescriptor });\n\t\t\t\t}\n\t\t\t\tremovedItems.push(viewDescriptorItem);\n\t\t\t}\n\t\t}\n\n\t\t// update state\n\t\tremovedItems.forEach(item => this.viewDescriptorItems.splice(this.viewDescriptorItems.indexOf(item), 1));\n\n\t\tthis.broadCastRemovedVisibleViewDescriptors(removedVisibleDescriptors);\n\t\tif (removedActiveDescriptors.length) {\n\t\t\tthis._onDidChangeActiveViewDescriptors.fire(({ added: [], removed: removedActiveDescriptors }));\n\t\t}\n\t\tif (removed.length) {\n\t\t\tthis._onDidChangeAllViewDescriptors.fire({ added: [], removed });\n\t\t}\n\t}\n\n\tprivate onDidChangeContext(): void {\n\t\tconst addedActiveItems: { item: IViewDescriptorItem; visibleWhenActive: boolean }[] = [];\n\t\tconst removedActiveItems: IViewDescriptorItem[] = [];\n\n\t\tfor (const item of this.viewDescriptorItems) {\n\t\t\tconst wasActive = item.state.active;\n\t\t\tconst isActive = this.contextKeyService.contextMatchesRules(item.viewDescriptor.when);\n\t\t\tif (wasActive !== isActive) {\n\t\t\t\tif (isActive) {\n\t\t\t\t\taddedActiveItems.push({ item, visibleWhenActive: this.isViewDescriptorVisibleWhenActive(item) });\n\t\t\t\t} else {\n\t\t\t\t\tremovedActiveItems.push(item);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tconst removedVisibleDescriptors: IViewDescriptorRef[] = [];\n\t\tfor (const item of removedActiveItems) {\n\t\t\tif (this.isViewDescriptorVisible(item)) {\n\t\t\t\tconst { visibleIndex } = this.find(item.viewDescriptor.id);\n\t\t\t\tremovedVisibleDescriptors.push({ index: visibleIndex, viewDescriptor: item.viewDescriptor });\n\t\t\t}\n\t\t}\n\n\t\t// Update the State\n\t\tremovedActiveItems.forEach(item => item.state.active = false);\n\t\taddedActiveItems.forEach(({ item }) => item.state.active = true);\n\n\t\tthis.broadCastRemovedVisibleViewDescriptors(removedVisibleDescriptors);\n\n\t\tif (addedActiveItems.length || removedActiveItems.length) {\n\t\t\tthis._onDidChangeActiveViewDescriptors.fire(({ added: addedActiveItems.map(({ item }) => item.viewDescriptor), removed: removedActiveItems.map(item => item.viewDescriptor) }));\n\t\t}\n\n\t\tconst addedVisibleDescriptors: IAddedViewDescriptorRef[] = [];\n\t\tfor (const { item, visibleWhenActive } of addedActiveItems) {\n\t\t\tif (visibleWhenActive && this.isViewDescriptorVisible(item)) {\n\t\t\t\tconst { visibleIndex } = this.find(item.viewDescriptor.id);\n\t\t\t\taddedVisibleDescriptors.push({ index: visibleIndex, viewDescriptor: item.viewDescriptor, size: item.state.size, collapsed: !!item.state.collapsed });\n\t\t\t}\n\t\t}\n\t\tthis.broadCastAddedVisibleViewDescriptors(addedVisibleDescriptors);\n\t}\n\n\tprivate broadCastAddedVisibleViewDescriptors(added: IAddedViewDescriptorRef[]): void {\n\t\tif (added.length) {\n\t\t\tthis._onDidAddVisibleViewDescriptors.fire(added.sort((a, b) => a.index - b.index));\n\t\t\tthis.updateState(`Added views:${added.map(v => v.viewDescriptor.id).join(',')} in ${this.viewContainer.id}`);\n\t\t}\n\t}\n\n\tprivate broadCastRemovedVisibleViewDescriptors(removed: IViewDescriptorRef[]): void {\n\t\tif (removed.length) {\n\t\t\tthis._onDidRemoveVisibleViewDescriptors.fire(removed.sort((a, b) => b.index - a.index));\n\t\t\tthis.updateState(`Removed views:${removed.map(v => v.viewDescriptor.id).join(',')} from ${this.viewContainer.id}`);\n\t\t}\n\t}\n\n\tprivate broadCastMovedViewDescriptors(from: IViewDescriptorRef, to: IViewDescriptorRef): void {\n\t\tthis._onDidMoveVisibleViewDescriptors.fire({ from, to });\n\t\tthis.updateState(`Moved view ${from.viewDescriptor.id} to ${to.viewDescriptor.id} in ${this.viewContainer.id}`);\n\t}\n\n\tprivate updateState(reason: string): void {\n\t\tthis.logger.value.trace(reason);\n\t\tthis.viewDescriptorsState.updateState(this.allViewDescriptors);\n\t\tthis.updateContainerInfo();\n\t}\n\n\tprivate isViewDescriptorVisible(viewDescriptorItem: IViewDescriptorItem): boolean {\n\t\tif (!viewDescriptorItem.state.active) {\n\t\t\treturn false;\n\t\t}\n\t\treturn this.isViewDescriptorVisibleWhenActive(viewDescriptorItem);\n\t}\n\n\tprivate isViewDescriptorVisibleWhenActive(viewDescriptorItem: IViewDescriptorItem): boolean {\n\t\tif (viewDescriptorItem.viewDescriptor.workspace) {\n\t\t\treturn !!viewDescriptorItem.state.visibleWorkspace;\n\t\t}\n\t\treturn !!viewDescriptorItem.state.visibleGlobal;\n\t}\n\n\tprivate find(id: string): { index: number; visibleIndex: number; viewDescriptorItem: IViewDescriptorItem } {\n\t\tconst result = this.findAndIgnoreIfNotFound(id);\n\t\tif (result) {\n\t\t\treturn result;\n\t\t}\n\t\tthrow new Error(`view descriptor ${id} not found`);\n\t}\n\n\tprivate findAndIgnoreIfNotFound(id: string): { index: number; visibleIndex: number; viewDescriptorItem: IViewDescriptorItem } | undefined {\n\t\tfor (let i = 0, visibleIndex = 0; i < this.viewDescriptorItems.length; i++) {\n\t\t\tconst viewDescriptorItem = this.viewDescriptorItems[i];\n\t\t\tif (viewDescriptorItem.viewDescriptor.id === id) {\n\t\t\t\treturn { index: i, visibleIndex, viewDescriptorItem: viewDescriptorItem };\n\t\t\t}\n\t\t\tif (this.isViewDescriptorVisible(viewDescriptorItem)) {\n\t\t\t\tvisibleIndex++;\n\t\t\t}\n\t\t}\n\t\treturn undefined;\n\t}\n\n\tprivate compareViewDescriptors(a: IViewDescriptorItem, b: IViewDescriptorItem): number {\n\t\tif (a.viewDescriptor.id === b.viewDescriptor.id) {\n\t\t\treturn 0;\n\t\t}\n\n\t\treturn (this.getViewOrder(a) - this.getViewOrder(b)) || this.getGroupOrderResult(a.viewDescriptor, b.viewDescriptor);\n\t}\n\n\tprivate getViewOrder(viewDescriptorItem: IViewDescriptorItem): number {\n\t\tconst viewOrder = typeof viewDescriptorItem.state.order === 'number' ? viewDescriptorItem.state.order : viewDescriptorItem.viewDescriptor.order;\n\t\treturn typeof viewOrder === 'number' ? viewOrder : Number.MAX_VALUE;\n\t}\n\n\tprivate getGroupOrderResult(a: IViewDescriptor, b: IViewDescriptor) {\n\t\tif (!a.group || !b.group) {\n\t\t\treturn 0;\n\t\t}\n\n\t\tif (a.group === b.group) {\n\t\t\treturn 0;\n\t\t}\n\n\t\treturn a.group < b.group ? -1 : 1;\n\t}\n}\n"]}