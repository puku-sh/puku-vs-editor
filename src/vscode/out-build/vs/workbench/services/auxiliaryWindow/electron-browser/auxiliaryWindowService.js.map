{"version":3,"sources":["vs/workbench/services/auxiliaryWindow/electron-browser/auxiliaryWindowService.ts"],"names":[],"mappings":"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","file":"auxiliaryWindowService.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { localize } from '../../../../nls.js';\nimport { InstantiationType, registerSingleton } from '../../../../platform/instantiation/common/extensions.js';\nimport { IWorkbenchLayoutService } from '../../layout/browser/layoutService.js';\nimport { AuxiliaryWindow, AuxiliaryWindowMode, BrowserAuxiliaryWindowService, IAuxiliaryWindowOpenOptions, IAuxiliaryWindowService } from '../browser/auxiliaryWindowService.js';\nimport { ISandboxGlobals } from '../../../../base/parts/sandbox/electron-browser/globals.js';\nimport { IConfigurationService } from '../../../../platform/configuration/common/configuration.js';\nimport { DisposableStore } from '../../../../base/common/lifecycle.js';\nimport { INativeHostService } from '../../../../platform/native/common/native.js';\nimport { IDialogService } from '../../../../platform/dialogs/common/dialogs.js';\nimport { CodeWindow } from '../../../../base/browser/window.js';\nimport { mark } from '../../../../base/common/performance.js';\nimport { IInstantiationService } from '../../../../platform/instantiation/common/instantiation.js';\nimport { ShutdownReason } from '../../lifecycle/common/lifecycle.js';\nimport { ITelemetryService } from '../../../../platform/telemetry/common/telemetry.js';\nimport { Barrier } from '../../../../base/common/async.js';\nimport { IHostService } from '../../host/browser/host.js';\nimport { applyZoom } from '../../../../platform/window/electron-browser/window.js';\nimport { getZoomLevel, isFullscreen, setFullscreen } from '../../../../base/browser/browser.js';\nimport { getActiveWindow } from '../../../../base/browser/dom.js';\nimport { IWorkbenchEnvironmentService } from '../../environment/common/environmentService.js';\nimport { isMacintosh } from '../../../../base/common/platform.js';\nimport { assert } from '../../../../base/common/assert.js';\nimport { IContextMenuService } from '../../../../platform/contextview/browser/contextView.js';\n\ntype NativeCodeWindow = CodeWindow & {\n\treadonly vscode: ISandboxGlobals;\n};\n\nexport class NativeAuxiliaryWindow extends AuxiliaryWindow {\n\n\tprivate skipUnloadConfirmation = false;\n\n\tprivate maximized = false;\n\tprivate alwaysOnTop = false;\n\n\tconstructor(\n\t\twindow: CodeWindow,\n\t\tcontainer: HTMLElement,\n\t\tstylesHaveLoaded: Barrier,\n\t\t@IConfigurationService configurationService: IConfigurationService,\n\t\t@INativeHostService private readonly nativeHostService: INativeHostService,\n\t\t@IInstantiationService private readonly instantiationService: IInstantiationService,\n\t\t@IHostService hostService: IHostService,\n\t\t@IWorkbenchEnvironmentService environmentService: IWorkbenchEnvironmentService,\n\t\t@IDialogService private readonly dialogService: IDialogService,\n\t\t@IContextMenuService contextMenuService: IContextMenuService,\n\t\t@IWorkbenchLayoutService layoutService: IWorkbenchLayoutService\n\t) {\n\t\tsuper(window, container, stylesHaveLoaded, configurationService, hostService, environmentService, contextMenuService, layoutService);\n\n\t\tif (!isMacintosh) {\n\t\t\t// For now, limit this to platforms that have clear maximised\n\t\t\t// transitions (Windows, Linux) via window buttons.\n\t\t\tthis.handleMaximizedState();\n\t\t}\n\n\t\tthis.handleFullScreenState();\n\t\tthis.handleAlwaysOnTopState();\n\t}\n\n\tprivate handleMaximizedState(): void {\n\t\t(async () => {\n\t\t\tthis.maximized = await this.nativeHostService.isMaximized({ targetWindowId: this.window.vscodeWindowId });\n\t\t})();\n\n\t\tthis._register(this.nativeHostService.onDidMaximizeWindow(windowId => {\n\t\t\tif (windowId === this.window.vscodeWindowId) {\n\t\t\t\tthis.maximized = true;\n\t\t\t}\n\t\t}));\n\n\t\tthis._register(this.nativeHostService.onDidUnmaximizeWindow(windowId => {\n\t\t\tif (windowId === this.window.vscodeWindowId) {\n\t\t\t\tthis.maximized = false;\n\t\t\t}\n\t\t}));\n\t}\n\n\tprivate handleAlwaysOnTopState(): void {\n\t\t(async () => {\n\t\t\tthis.alwaysOnTop = await this.nativeHostService.isWindowAlwaysOnTop({ targetWindowId: this.window.vscodeWindowId });\n\t\t})();\n\n\t\tthis._register(this.nativeHostService.onDidChangeWindowAlwaysOnTop(({ windowId, alwaysOnTop }) => {\n\t\t\tif (windowId === this.window.vscodeWindowId) {\n\t\t\t\tthis.alwaysOnTop = alwaysOnTop;\n\t\t\t}\n\t\t}));\n\t}\n\n\tprivate async handleFullScreenState(): Promise<void> {\n\t\tconst fullscreen = await this.nativeHostService.isFullScreen({ targetWindowId: this.window.vscodeWindowId });\n\t\tif (fullscreen) {\n\t\t\tsetFullscreen(true, this.window);\n\t\t}\n\t}\n\n\tprotected override async handleVetoBeforeClose(e: BeforeUnloadEvent, veto: string): Promise<void> {\n\t\tthis.preventUnload(e);\n\n\t\tawait this.dialogService.error(veto, localize('backupErrorDetails', \"Try saving or reverting the editors with unsaved changes first and then try again.\"));\n\t}\n\n\tprotected override async confirmBeforeClose(e: BeforeUnloadEvent): Promise<void> {\n\t\tif (this.skipUnloadConfirmation) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.preventUnload(e);\n\n\t\tconst confirmed = await this.instantiationService.invokeFunction(accessor => NativeAuxiliaryWindow.confirmOnShutdown(accessor, ShutdownReason.CLOSE));\n\t\tif (confirmed) {\n\t\t\tthis.skipUnloadConfirmation = true;\n\t\t\tthis.nativeHostService.closeWindow({ targetWindowId: this.window.vscodeWindowId });\n\t\t}\n\t}\n\n\tprotected override preventUnload(e: BeforeUnloadEvent): void {\n\t\te.preventDefault();\n\t\te.returnValue = true;\n\t}\n\n\toverride createState(): IAuxiliaryWindowOpenOptions {\n\t\tconst state = super.createState();\n\t\tconst fullscreen = isFullscreen(this.window);\n\t\treturn {\n\t\t\t...state,\n\t\t\tbounds: state.bounds,\n\t\t\tmode: this.maximized ? AuxiliaryWindowMode.Maximized : fullscreen ? AuxiliaryWindowMode.Fullscreen : AuxiliaryWindowMode.Normal,\n\t\t\talwaysOnTop: this.alwaysOnTop\n\t\t};\n\t}\n}\n\nexport class NativeAuxiliaryWindowService extends BrowserAuxiliaryWindowService {\n\n\tconstructor(\n\t\t@IWorkbenchLayoutService layoutService: IWorkbenchLayoutService,\n\t\t@IConfigurationService configurationService: IConfigurationService,\n\t\t@INativeHostService private readonly nativeHostService: INativeHostService,\n\t\t@IDialogService dialogService: IDialogService,\n\t\t@IInstantiationService private readonly instantiationService: IInstantiationService,\n\t\t@ITelemetryService telemetryService: ITelemetryService,\n\t\t@IHostService hostService: IHostService,\n\t\t@IWorkbenchEnvironmentService environmentService: IWorkbenchEnvironmentService,\n\t\t@IContextMenuService contextMenuService: IContextMenuService,\n\t) {\n\t\tsuper(layoutService, dialogService, configurationService, telemetryService, hostService, environmentService, contextMenuService);\n\t}\n\n\tprotected override async resolveWindowId(auxiliaryWindow: NativeCodeWindow): Promise<number> {\n\t\tmark('code/auxiliaryWindow/willResolveWindowId');\n\t\tconst windowId = await auxiliaryWindow.vscode.ipcRenderer.invoke('vscode:registerAuxiliaryWindow', this.nativeHostService.windowId);\n\t\tmark('code/auxiliaryWindow/didResolveWindowId');\n\t\tassert(typeof windowId === 'number');\n\n\t\treturn windowId;\n\t}\n\n\tprotected override createContainer(auxiliaryWindow: NativeCodeWindow, disposables: DisposableStore, options?: IAuxiliaryWindowOpenOptions) {\n\n\t\t// Zoom level (either explicitly provided or inherited from main window)\n\t\tlet windowZoomLevel: number;\n\t\tif (typeof options?.zoomLevel === 'number') {\n\t\t\twindowZoomLevel = options.zoomLevel;\n\t\t} else {\n\t\t\twindowZoomLevel = getZoomLevel(getActiveWindow());\n\t\t}\n\n\t\tapplyZoom(windowZoomLevel, auxiliaryWindow);\n\n\t\treturn super.createContainer(auxiliaryWindow, disposables);\n\t}\n\n\tprotected override createAuxiliaryWindow(targetWindow: CodeWindow, container: HTMLElement, stylesHaveLoaded: Barrier): AuxiliaryWindow {\n\t\treturn new NativeAuxiliaryWindow(targetWindow, container, stylesHaveLoaded, this.configurationService, this.nativeHostService, this.instantiationService, this.hostService, this.environmentService, this.dialogService, this.contextMenuService, this.layoutService);\n\t}\n}\n\nregisterSingleton(IAuxiliaryWindowService, NativeAuxiliaryWindowService, InstantiationType.Delayed);\n"]}