{"version":3,"sources":["vs/workbench/services/workingCopy/electron-browser/workingCopyBackupTracker.ts"],"names":[],"mappings":"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","file":"workingCopyBackupTracker.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { localize } from '../../../../nls.js';\nimport { IWorkingCopyBackupService } from '../common/workingCopyBackup.js';\nimport { IWorkbenchContribution } from '../../../common/contributions.js';\nimport { IFilesConfigurationService, AutoSaveMode } from '../../filesConfiguration/common/filesConfigurationService.js';\nimport { IWorkingCopyService } from '../common/workingCopyService.js';\nimport { IWorkingCopy, IWorkingCopyIdentifier, WorkingCopyCapabilities } from '../common/workingCopy.js';\nimport { ILifecycleService, ShutdownReason } from '../../lifecycle/common/lifecycle.js';\nimport { ConfirmResult, IFileDialogService, IDialogService, getFileNamesMessage } from '../../../../platform/dialogs/common/dialogs.js';\nimport { WorkbenchState, IWorkspaceContextService } from '../../../../platform/workspace/common/workspace.js';\nimport { isMacintosh } from '../../../../base/common/platform.js';\nimport { HotExitConfiguration } from '../../../../platform/files/common/files.js';\nimport { INativeHostService } from '../../../../platform/native/common/native.js';\nimport { WorkingCopyBackupTracker } from '../common/workingCopyBackupTracker.js';\nimport { ILogService } from '../../../../platform/log/common/log.js';\nimport { IEditorService } from '../../editor/common/editorService.js';\nimport { SaveReason } from '../../../common/editor.js';\nimport { IEnvironmentService } from '../../../../platform/environment/common/environment.js';\nimport { CancellationToken, CancellationTokenSource } from '../../../../base/common/cancellation.js';\nimport { IProgressService, ProgressLocation } from '../../../../platform/progress/common/progress.js';\nimport { Promises, raceCancellation } from '../../../../base/common/async.js';\nimport { IWorkingCopyEditorService } from '../common/workingCopyEditorService.js';\nimport { IEditorGroupsService } from '../../editor/common/editorGroupsService.js';\n\nexport class NativeWorkingCopyBackupTracker extends WorkingCopyBackupTracker implements IWorkbenchContribution {\n\n\tstatic readonly ID = 'workbench.contrib.nativeWorkingCopyBackupTracker';\n\n\tconstructor(\n\t\t@IWorkingCopyBackupService workingCopyBackupService: IWorkingCopyBackupService,\n\t\t@IFilesConfigurationService filesConfigurationService: IFilesConfigurationService,\n\t\t@IWorkingCopyService workingCopyService: IWorkingCopyService,\n\t\t@ILifecycleService lifecycleService: ILifecycleService,\n\t\t@IFileDialogService private readonly fileDialogService: IFileDialogService,\n\t\t@IDialogService private readonly dialogService: IDialogService,\n\t\t@IWorkspaceContextService private readonly contextService: IWorkspaceContextService,\n\t\t@INativeHostService private readonly nativeHostService: INativeHostService,\n\t\t@ILogService logService: ILogService,\n\t\t@IEnvironmentService private readonly environmentService: IEnvironmentService,\n\t\t@IProgressService private readonly progressService: IProgressService,\n\t\t@IWorkingCopyEditorService workingCopyEditorService: IWorkingCopyEditorService,\n\t\t@IEditorService editorService: IEditorService,\n\t\t@IEditorGroupsService editorGroupService: IEditorGroupsService\n\t) {\n\t\tsuper(workingCopyBackupService, workingCopyService, logService, lifecycleService, filesConfigurationService, workingCopyEditorService, editorService, editorGroupService);\n\t}\n\n\tprotected async onFinalBeforeShutdown(reason: ShutdownReason): Promise<boolean> {\n\n\t\t// Important: we are about to shutdown and handle modified working copies\n\t\t// and backups. We do not want any pending backup ops to interfer with\n\t\t// this because there is a risk of a backup being scheduled after we have\n\t\t// acknowledged to shutdown and then might end up with partial backups\n\t\t// written to disk, or even empty backups or deletes after writes.\n\t\t// (https://github.com/microsoft/vscode/issues/138055)\n\n\t\tthis.cancelBackupOperations();\n\n\t\t// For the duration of the shutdown handling, suspend backup operations\n\t\t// and only resume after we have handled backups. Similar to above, we\n\t\t// do not want to trigger backup tracking during our shutdown handling\n\t\t// but we must resume, in case of a veto afterwards.\n\n\t\tconst { resume } = this.suspendBackupOperations();\n\n\t\ttry {\n\n\t\t\t// Modified working copies need treatment on shutdown\n\t\t\tconst modifiedWorkingCopies = this.workingCopyService.modifiedWorkingCopies;\n\t\t\tif (modifiedWorkingCopies.length) {\n\t\t\t\treturn await this.onBeforeShutdownWithModified(reason, modifiedWorkingCopies);\n\t\t\t}\n\n\t\t\t// No modified working copies\n\t\t\telse {\n\t\t\t\treturn await this.onBeforeShutdownWithoutModified();\n\t\t\t}\n\t\t} finally {\n\t\t\tresume();\n\t\t}\n\t}\n\n\tprotected async onBeforeShutdownWithModified(reason: ShutdownReason, modifiedWorkingCopies: readonly IWorkingCopy[]): Promise<boolean> {\n\n\t\t// If auto save is enabled, save all non-untitled working copies\n\t\t// and then check again for modified copies\n\n\t\tconst workingCopiesToAutoSave = modifiedWorkingCopies.filter(wc => !(wc.capabilities & WorkingCopyCapabilities.Untitled) && this.filesConfigurationService.getAutoSaveMode(wc.resource).mode !== AutoSaveMode.OFF);\n\t\tif (workingCopiesToAutoSave.length > 0) {\n\n\t\t\t// Save all modified working copies that can be auto-saved\n\t\t\ttry {\n\t\t\t\tawait this.doSaveAllBeforeShutdown(workingCopiesToAutoSave, SaveReason.AUTO);\n\t\t\t} catch (error) {\n\t\t\t\tthis.logService.error(`[backup tracker] error saving modified working copies: ${error}`); // guard against misbehaving saves, we handle remaining modified below\n\t\t\t}\n\n\t\t\t// If we still have modified working copies, we either have untitled ones or working copies that cannot be saved\n\t\t\tconst remainingModifiedWorkingCopies = this.workingCopyService.modifiedWorkingCopies;\n\t\t\tif (remainingModifiedWorkingCopies.length) {\n\t\t\t\treturn this.handleModifiedBeforeShutdown(remainingModifiedWorkingCopies, reason);\n\t\t\t}\n\n\t\t\treturn this.noVeto([...modifiedWorkingCopies]); // no veto (modified auto-saved)\n\t\t}\n\n\t\t// Auto save is not enabled\n\t\treturn this.handleModifiedBeforeShutdown(modifiedWorkingCopies, reason);\n\t}\n\n\tprivate async handleModifiedBeforeShutdown(modifiedWorkingCopies: readonly IWorkingCopy[], reason: ShutdownReason): Promise<boolean> {\n\n\t\t// Trigger backup if configured and enabled for shutdown reason\n\t\tlet backups: IWorkingCopy[] = [];\n\t\tlet backupError: Error | undefined = undefined;\n\t\tconst modifiedWorkingCopiesToBackup = await this.shouldBackupBeforeShutdown(reason, modifiedWorkingCopies);\n\t\tif (modifiedWorkingCopiesToBackup.length > 0) {\n\t\t\ttry {\n\t\t\t\tconst backupResult = await this.backupBeforeShutdown(modifiedWorkingCopiesToBackup);\n\t\t\t\tbackups = backupResult.backups;\n\t\t\t\tbackupError = backupResult.error;\n\n\t\t\t\tif (backups.length === modifiedWorkingCopies.length) {\n\t\t\t\t\treturn false; // no veto (backup was successful for all working copies)\n\t\t\t\t}\n\t\t\t} catch (error) {\n\t\t\t\tbackupError = error;\n\t\t\t}\n\t\t}\n\n\t\tconst remainingModifiedWorkingCopies = modifiedWorkingCopies.filter(workingCopy => !backups.includes(workingCopy));\n\n\t\t// We ran a backup but received an error that we show to the user\n\t\tif (backupError) {\n\t\t\tif (this.environmentService.isExtensionDevelopment) {\n\t\t\t\tthis.logService.error(`[backup tracker] error creating backups: ${backupError}`);\n\n\t\t\t\treturn false; // do not block shutdown during extension development (https://github.com/microsoft/vscode/issues/115028)\n\t\t\t}\n\n\t\t\treturn this.showErrorDialog(localize('backupTrackerBackupFailed', \"The following editors with unsaved changes could not be saved to the backup location.\"), remainingModifiedWorkingCopies, backupError, reason);\n\t\t}\n\n\t\t// Since a backup did not happen, we have to confirm for\n\t\t// the working copies that did not successfully backup\n\n\t\ttry {\n\t\t\treturn await this.confirmBeforeShutdown(remainingModifiedWorkingCopies);\n\t\t} catch (error) {\n\t\t\tif (this.environmentService.isExtensionDevelopment) {\n\t\t\t\tthis.logService.error(`[backup tracker] error saving or reverting modified working copies: ${error}`);\n\n\t\t\t\treturn false; // do not block shutdown during extension development (https://github.com/microsoft/vscode/issues/115028)\n\t\t\t}\n\n\t\t\treturn this.showErrorDialog(localize('backupTrackerConfirmFailed', \"The following editors with unsaved changes could not be saved or reverted.\"), remainingModifiedWorkingCopies, error, reason);\n\t\t}\n\t}\n\n\tprivate async shouldBackupBeforeShutdown(reason: ShutdownReason, modifiedWorkingCopies: readonly IWorkingCopy[]): Promise<readonly IWorkingCopy[]> {\n\t\tif (!this.filesConfigurationService.isHotExitEnabled) {\n\t\t\treturn []; // never backup when hot exit is disabled via settings\n\t\t}\n\n\t\tif (this.environmentService.isExtensionDevelopment) {\n\t\t\treturn modifiedWorkingCopies; // always backup closing extension development window without asking to speed up debugging\n\t\t}\n\n\t\tswitch (reason) {\n\n\t\t\t// Window Close\n\t\t\tcase ShutdownReason.CLOSE:\n\t\t\t\tif (this.contextService.getWorkbenchState() !== WorkbenchState.EMPTY && this.filesConfigurationService.hotExitConfiguration === HotExitConfiguration.ON_EXIT_AND_WINDOW_CLOSE) {\n\t\t\t\t\treturn modifiedWorkingCopies; // backup if a workspace/folder is open and onExitAndWindowClose is configured\n\t\t\t\t}\n\n\t\t\t\tif (isMacintosh || await this.nativeHostService.getWindowCount() > 1) {\n\t\t\t\t\tif (this.contextService.getWorkbenchState() !== WorkbenchState.EMPTY) {\n\t\t\t\t\t\treturn modifiedWorkingCopies.filter(modifiedWorkingCopy => modifiedWorkingCopy.capabilities & WorkingCopyCapabilities.Scratchpad); // backup scratchpads automatically to avoid user confirmation\n\t\t\t\t\t}\n\n\t\t\t\t\treturn []; // do not backup if a window is closed that does not cause quitting of the application\n\t\t\t\t}\n\n\t\t\t\treturn modifiedWorkingCopies; // backup if last window is closed on win/linux where the application quits right after\n\n\t\t\t// Application Quit\n\t\t\tcase ShutdownReason.QUIT:\n\t\t\t\treturn modifiedWorkingCopies; // backup because next start we restore all backups\n\n\t\t\t// Window Reload\n\t\t\tcase ShutdownReason.RELOAD:\n\t\t\t\treturn modifiedWorkingCopies; // backup because after window reload, backups restore\n\n\t\t\t// Workspace Change\n\t\t\tcase ShutdownReason.LOAD:\n\t\t\t\tif (this.contextService.getWorkbenchState() !== WorkbenchState.EMPTY) {\n\t\t\t\t\tif (this.filesConfigurationService.hotExitConfiguration === HotExitConfiguration.ON_EXIT_AND_WINDOW_CLOSE) {\n\t\t\t\t\t\treturn modifiedWorkingCopies; // backup if a workspace/folder is open and onExitAndWindowClose is configured\n\t\t\t\t\t}\n\n\t\t\t\t\treturn modifiedWorkingCopies.filter(modifiedWorkingCopy => modifiedWorkingCopy.capabilities & WorkingCopyCapabilities.Scratchpad); // backup scratchpads automatically to avoid user confirmation\n\t\t\t\t}\n\n\t\t\t\treturn []; // do not backup because we are switching contexts with no workspace/folder open\n\t\t}\n\t}\n\n\tprivate async showErrorDialog(message: string, workingCopies: readonly IWorkingCopy[], error: Error, reason: ShutdownReason): Promise<boolean> {\n\t\tthis.logService.error(`[backup tracker] ${message}: ${error}`);\n\n\t\tconst modifiedWorkingCopies = workingCopies.filter(workingCopy => workingCopy.isModified());\n\n\t\tconst advice = localize('backupErrorDetails', \"Try saving or reverting the editors with unsaved changes first and then try again.\");\n\t\tconst detail = modifiedWorkingCopies.length\n\t\t\t? `${getFileNamesMessage(modifiedWorkingCopies.map(x => x.name))}\\n${advice}`\n\t\t\t: advice;\n\n\t\tconst { result } = await this.dialogService.prompt({\n\t\t\ttype: 'error',\n\t\t\tmessage,\n\t\t\tdetail,\n\t\t\tbuttons: [\n\t\t\t\t{\n\t\t\t\t\tlabel: localize({ key: 'ok', comment: ['&& denotes a mnemonic'] }, \"&&OK\"),\n\t\t\t\t\trun: () => true // veto\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tlabel: this.toForceShutdownLabel(reason),\n\t\t\t\t\trun: () => false // no veto\n\t\t\t\t}\n\t\t\t],\n\t\t});\n\n\t\treturn result ?? true;\n\t}\n\n\tprivate toForceShutdownLabel(reason: ShutdownReason): string {\n\t\tswitch (reason) {\n\t\t\tcase ShutdownReason.CLOSE:\n\t\t\tcase ShutdownReason.LOAD:\n\t\t\t\treturn localize('shutdownForceClose', \"Close Anyway\");\n\t\t\tcase ShutdownReason.QUIT:\n\t\t\t\treturn localize('shutdownForceQuit', \"Quit Anyway\");\n\t\t\tcase ShutdownReason.RELOAD:\n\t\t\t\treturn localize('shutdownForceReload', \"Reload Anyway\");\n\t\t}\n\t}\n\n\tprivate async backupBeforeShutdown(modifiedWorkingCopies: readonly IWorkingCopy[]): Promise<{ backups: IWorkingCopy[]; error?: Error }> {\n\t\tconst backups: IWorkingCopy[] = [];\n\t\tlet error: Error | undefined = undefined;\n\n\t\tawait this.withProgressAndCancellation(async token => {\n\n\t\t\t// Perform a backup of all modified working copies unless a backup already exists\n\t\t\ttry {\n\t\t\t\tawait Promises.settled(modifiedWorkingCopies.map(async workingCopy => {\n\n\t\t\t\t\t// Backup exists\n\t\t\t\t\tconst contentVersion = this.getContentVersion(workingCopy);\n\t\t\t\t\tif (this.workingCopyBackupService.hasBackupSync(workingCopy, contentVersion)) {\n\t\t\t\t\t\tbackups.push(workingCopy);\n\t\t\t\t\t}\n\n\t\t\t\t\t// Backup does not exist\n\t\t\t\t\telse {\n\t\t\t\t\t\tconst backup = await workingCopy.backup(token);\n\t\t\t\t\t\tif (token.isCancellationRequested) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tawait this.workingCopyBackupService.backup(workingCopy, backup.content, contentVersion, backup.meta, token);\n\t\t\t\t\t\tif (token.isCancellationRequested) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tbackups.push(workingCopy);\n\t\t\t\t\t}\n\t\t\t\t}));\n\t\t\t} catch (backupError) {\n\t\t\t\terror = backupError;\n\t\t\t}\n\t\t},\n\t\t\tlocalize('backupBeforeShutdownMessage', \"Backing up editors with unsaved changes is taking a bit longer...\"),\n\t\t\tlocalize('backupBeforeShutdownDetail', \"Click 'Cancel' to stop waiting and to save or revert editors with unsaved changes.\")\n\t\t);\n\n\t\treturn { backups, error };\n\t}\n\n\tprivate async confirmBeforeShutdown(modifiedWorkingCopies: IWorkingCopy[]): Promise<boolean> {\n\n\t\t// Save\n\t\tconst confirm = await this.fileDialogService.showSaveConfirm(modifiedWorkingCopies.map(workingCopy => workingCopy.name));\n\t\tif (confirm === ConfirmResult.SAVE) {\n\t\t\tconst modifiedCountBeforeSave = this.workingCopyService.modifiedCount;\n\n\t\t\ttry {\n\t\t\t\tawait this.doSaveAllBeforeShutdown(modifiedWorkingCopies, SaveReason.EXPLICIT);\n\t\t\t} catch (error) {\n\t\t\t\tthis.logService.error(`[backup tracker] error saving modified working copies: ${error}`); // guard against misbehaving saves, we handle remaining modified below\n\t\t\t}\n\n\t\t\tconst savedWorkingCopies = modifiedCountBeforeSave - this.workingCopyService.modifiedCount;\n\t\t\tif (savedWorkingCopies < modifiedWorkingCopies.length) {\n\t\t\t\treturn true; // veto (save failed or was canceled)\n\t\t\t}\n\n\t\t\treturn this.noVeto(modifiedWorkingCopies); // no veto (modified saved)\n\t\t}\n\n\t\t// Don't Save\n\t\telse if (confirm === ConfirmResult.DONT_SAVE) {\n\t\t\ttry {\n\t\t\t\tawait this.doRevertAllBeforeShutdown(modifiedWorkingCopies);\n\t\t\t} catch (error) {\n\t\t\t\tthis.logService.error(`[backup tracker] error reverting modified working copies: ${error}`); // do not block the shutdown on errors from revert\n\t\t\t}\n\n\t\t\treturn this.noVeto(modifiedWorkingCopies); // no veto (modified reverted)\n\t\t}\n\n\t\t// Cancel\n\t\treturn true; // veto (user canceled)\n\t}\n\n\tprivate doSaveAllBeforeShutdown(workingCopies: IWorkingCopy[], reason: SaveReason): Promise<void> {\n\t\treturn this.withProgressAndCancellation(async () => {\n\n\t\t\t// Skip save participants on shutdown for performance reasons\n\t\t\tconst saveOptions = { skipSaveParticipants: true, reason };\n\n\t\t\t// First save through the editor service if we save all to benefit\n\t\t\t// from some extras like switching to untitled modified editors before saving.\n\t\t\tlet result: boolean | undefined = undefined;\n\t\t\tif (workingCopies.length === this.workingCopyService.modifiedCount) {\n\t\t\t\tresult = (await this.editorService.saveAll({\n\t\t\t\t\tincludeUntitled: { includeScratchpad: true },\n\t\t\t\t\t...saveOptions\n\t\t\t\t})).success;\n\t\t\t}\n\n\t\t\t// If we still have modified working copies, save those directly\n\t\t\t// unless the save was not successful (e.g. cancelled)\n\t\t\tif (result !== false) {\n\t\t\t\tawait Promises.settled(workingCopies.map(workingCopy => workingCopy.isModified() ? workingCopy.save(saveOptions) : Promise.resolve(true)));\n\t\t\t}\n\t\t},\n\t\t\tlocalize('saveBeforeShutdown', \"Saving editors with unsaved changes is taking a bit longer...\"),\n\t\t\tundefined,\n\t\t\t// Do not pick `Dialog` as location for reporting progress if it is likely\n\t\t\t// that the save operation will itself open a dialog for asking for the\n\t\t\t// location to save to for untitled or scratchpad working copies.\n\t\t\t// https://github.com/microsoft/vscode-internalbacklog/issues/4943\n\t\t\tworkingCopies.some(workingCopy => workingCopy.capabilities & WorkingCopyCapabilities.Untitled || workingCopy.capabilities & WorkingCopyCapabilities.Scratchpad) ? ProgressLocation.Window : ProgressLocation.Dialog);\n\t}\n\n\tprivate doRevertAllBeforeShutdown(modifiedWorkingCopies: IWorkingCopy[]): Promise<void> {\n\t\treturn this.withProgressAndCancellation(async () => {\n\n\t\t\t// Soft revert is good enough on shutdown\n\t\t\tconst revertOptions = { soft: true };\n\n\t\t\t// First revert through the editor service if we revert all\n\t\t\tif (modifiedWorkingCopies.length === this.workingCopyService.modifiedCount) {\n\t\t\t\tawait this.editorService.revertAll(revertOptions);\n\t\t\t}\n\n\t\t\t// If we still have modified working copies, revert those directly\n\t\t\tawait Promises.settled(modifiedWorkingCopies.map(workingCopy => workingCopy.isModified() ? workingCopy.revert(revertOptions) : Promise.resolve()));\n\t\t}, localize('revertBeforeShutdown', \"Reverting editors with unsaved changes is taking a bit longer...\"));\n\t}\n\n\tprivate onBeforeShutdownWithoutModified(): Promise<boolean> {\n\n\t\t// We are about to shutdown without modified editors\n\t\t// and will discard any backups that are still\n\t\t// around that have not been handled depending\n\t\t// on the window state.\n\t\t//\n\t\t// Empty window: discard even unrestored backups to\n\t\t// prevent empty windows from restoring that cannot\n\t\t// be closed (workaround for not having implemented\n\t\t// https://github.com/microsoft/vscode/issues/127163\n\t\t// and a fix for what users have reported in issue\n\t\t// https://github.com/microsoft/vscode/issues/126725)\n\t\t//\n\t\t// Workspace/Folder window: do not discard unrestored\n\t\t// backups to give a chance to restore them in the\n\t\t// future. Since we do not restore workspace/folder\n\t\t// windows with backups, this is fine.\n\n\t\treturn this.noVeto({ except: this.contextService.getWorkbenchState() === WorkbenchState.EMPTY ? [] : Array.from(this.unrestoredBackups) });\n\t}\n\n\tprivate noVeto(backupsToDiscard: IWorkingCopyIdentifier[]): Promise<boolean>;\n\tprivate noVeto(backupsToKeep: { except: IWorkingCopyIdentifier[] }): Promise<boolean>;\n\tprivate async noVeto(arg1: IWorkingCopyIdentifier[] | { except: IWorkingCopyIdentifier[] }): Promise<boolean> {\n\n\t\t// Discard backups from working copies the\n\t\t// user either saved or reverted\n\n\t\tawait this.discardBackupsBeforeShutdown(arg1);\n\n\t\treturn false; // no veto (no modified)\n\t}\n\n\tprivate discardBackupsBeforeShutdown(backupsToDiscard: IWorkingCopyIdentifier[]): Promise<void>;\n\tprivate discardBackupsBeforeShutdown(backupsToKeep: { except: IWorkingCopyIdentifier[] }): Promise<void>;\n\tprivate discardBackupsBeforeShutdown(backupsToDiscardOrKeep: IWorkingCopyIdentifier[] | { except: IWorkingCopyIdentifier[] }): Promise<void>;\n\tprivate async discardBackupsBeforeShutdown(arg1: IWorkingCopyIdentifier[] | { except: IWorkingCopyIdentifier[] }): Promise<void> {\n\n\t\t// We never discard any backups before we are ready\n\t\t// and have resolved all backups that exist. This\n\t\t// is important to not loose backups that have not\n\t\t// been handled.\n\n\t\tif (!this.isReady) {\n\t\t\treturn;\n\t\t}\n\n\t\tawait this.withProgressAndCancellation(async () => {\n\n\t\t\t// When we shutdown either with no modified working copies left\n\t\t\t// or with some handled, we start to discard these backups\n\t\t\t// to free them up. This helps to get rid of stale backups\n\t\t\t// as reported in https://github.com/microsoft/vscode/issues/92962\n\t\t\t//\n\t\t\t// However, we never want to discard backups that we know\n\t\t\t// were not restored in the session.\n\n\t\t\ttry {\n\t\t\t\tif (Array.isArray(arg1)) {\n\t\t\t\t\tawait Promises.settled(arg1.map(workingCopy => this.workingCopyBackupService.discardBackup(workingCopy)));\n\t\t\t\t} else {\n\t\t\t\t\tawait this.workingCopyBackupService.discardBackups(arg1);\n\t\t\t\t}\n\t\t\t} catch (error) {\n\t\t\t\tthis.logService.error(`[backup tracker] error discarding backups: ${error}`);\n\t\t\t}\n\t\t}, localize('discardBackupsBeforeShutdown', \"Discarding backups is taking a bit longer...\"));\n\t}\n\n\tprivate withProgressAndCancellation(promiseFactory: (token: CancellationToken) => Promise<void>, title: string, detail?: string, location = ProgressLocation.Dialog): Promise<void> {\n\t\tconst cts = new CancellationTokenSource();\n\n\t\treturn this.progressService.withProgress({\n\t\t\tlocation, \t\t\t// by default use a dialog to prevent the user from making any more changes now (https://github.com/microsoft/vscode/issues/122774)\n\t\t\tcancellable: true, \t// allow to cancel (https://github.com/microsoft/vscode/issues/112278)\n\t\t\tdelay: 800, \t\t// delay so that it only appears when operation takes a long time\n\t\t\ttitle,\n\t\t\tdetail\n\t\t}, () => raceCancellation(promiseFactory(cts.token), cts.token), () => cts.dispose(true));\n\t}\n}\n"]}