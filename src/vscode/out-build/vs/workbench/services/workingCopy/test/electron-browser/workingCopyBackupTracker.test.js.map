{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/services/workingCopy/test/electron-browser/workingCopyBackupTracker.test.ts","vs/workbench/services/workingCopy/test/electron-browser/workingCopyBackupTracker.test.ts"],"names":[],"mappings":"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","file":"workingCopyBackupTracker.test.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport assert from 'assert';\nimport { isMacintosh, isWindows } from '../../../../../base/common/platform.js';\nimport { join } from '../../../../../base/common/path.js';\nimport { URI } from '../../../../../base/common/uri.js';\nimport { hash } from '../../../../../base/common/hash.js';\nimport { NativeWorkingCopyBackupTracker } from '../../electron-browser/workingCopyBackupTracker.js';\nimport { TextFileEditorModelManager } from '../../../textfile/common/textFileEditorModelManager.js';\nimport { IEditorService } from '../../../editor/common/editorService.js';\nimport { EditorPart } from '../../../../browser/parts/editor/editorPart.js';\nimport { IEditorGroupsService } from '../../../editor/common/editorGroupsService.js';\nimport { EditorService } from '../../../editor/browser/editorService.js';\nimport { IWorkingCopyBackupService } from '../../common/workingCopyBackup.js';\nimport { DisposableStore } from '../../../../../base/common/lifecycle.js';\nimport { ensureNoDisposablesAreLeakedInTestSuite, toResource } from '../../../../../base/test/common/utils.js';\nimport { IFilesConfigurationService } from '../../../filesConfiguration/common/filesConfigurationService.js';\nimport { IWorkingCopyService } from '../../common/workingCopyService.js';\nimport { ILogService } from '../../../../../platform/log/common/log.js';\nimport { HotExitConfiguration } from '../../../../../platform/files/common/files.js';\nimport { ShutdownReason, ILifecycleService } from '../../../lifecycle/common/lifecycle.js';\nimport { IFileDialogService, ConfirmResult, IDialogService } from '../../../../../platform/dialogs/common/dialogs.js';\nimport { IWorkspaceContextService } from '../../../../../platform/workspace/common/workspace.js';\nimport { INativeHostService } from '../../../../../platform/native/common/native.js';\nimport { IInstantiationService } from '../../../../../platform/instantiation/common/instantiation.js';\nimport { TestConfigurationService } from '../../../../../platform/configuration/test/common/testConfigurationService.js';\nimport { IConfigurationService } from '../../../../../platform/configuration/common/configuration.js';\nimport { createEditorPart, registerTestFileEditor, TestBeforeShutdownEvent, TestEnvironmentService, TestFilesConfigurationService, TestFileService, TestTextResourceConfigurationService, workbenchTeardown } from '../../../../test/browser/workbenchTestServices.js';\nimport { MockContextKeyService } from '../../../../../platform/keybinding/test/common/mockKeybindingService.js';\nimport { IContextKeyService } from '../../../../../platform/contextkey/common/contextkey.js';\nimport { IEnvironmentService } from '../../../../../platform/environment/common/environment.js';\nimport { TestWorkspace, Workspace } from '../../../../../platform/workspace/test/common/testWorkspace.js';\nimport { IProgressService } from '../../../../../platform/progress/common/progress.js';\nimport { IWorkingCopyEditorService } from '../../common/workingCopyEditorService.js';\nimport { TestContextService, TestMarkerService, TestWorkingCopy } from '../../../../test/common/workbenchTestServices.js';\nimport { CancellationToken } from '../../../../../base/common/cancellation.js';\nimport { IWorkingCopyBackup, WorkingCopyCapabilities } from '../../common/workingCopy.js';\nimport { Event, Emitter } from '../../../../../base/common/event.js';\nimport { generateUuid } from '../../../../../base/common/uuid.js';\nimport { Schemas } from '../../../../../base/common/network.js';\nimport { joinPath } from '../../../../../base/common/resources.js';\nimport { VSBuffer } from '../../../../../base/common/buffer.js';\nimport { TestServiceAccessor, workbenchInstantiationService } from '../../../../test/electron-browser/workbenchTestServices.js';\nimport { UriIdentityService } from '../../../../../platform/uriIdentity/common/uriIdentityService.js';\n\nsuite('WorkingCopyBackupTracker (native)', function () {\n\n\tclass TestWorkingCopyBackupTracker extends NativeWorkingCopyBackupTracker {\n\n\t\tconstructor(\n\t\t\t@IWorkingCopyBackupService workingCopyBackupService: IWorkingCopyBackupService,\n\t\t\t@IFilesConfigurationService filesConfigurationService: IFilesConfigurationService,\n\t\t\t@IWorkingCopyService workingCopyService: IWorkingCopyService,\n\t\t\t@ILifecycleService lifecycleService: ILifecycleService,\n\t\t\t@IFileDialogService fileDialogService: IFileDialogService,\n\t\t\t@IDialogService dialogService: IDialogService,\n\t\t\t@IWorkspaceContextService contextService: IWorkspaceContextService,\n\t\t\t@INativeHostService nativeHostService: INativeHostService,\n\t\t\t@ILogService logService: ILogService,\n\t\t\t@IEditorService editorService: IEditorService,\n\t\t\t@IEnvironmentService environmentService: IEnvironmentService,\n\t\t\t@IProgressService progressService: IProgressService,\n\t\t\t@IWorkingCopyEditorService workingCopyEditorService: IWorkingCopyEditorService,\n\t\t\t@IEditorGroupsService editorGroupService: IEditorGroupsService\n\t\t) {\n\t\t\tsuper(workingCopyBackupService, filesConfigurationService, workingCopyService, lifecycleService, fileDialogService, dialogService, contextService, nativeHostService, logService, environmentService, progressService, workingCopyEditorService, editorService, editorGroupService);\n\t\t}\n\n\t\tprotected override getBackupScheduleDelay(): number {\n\t\t\treturn 10; // Reduce timeout for tests\n\t\t}\n\n\t\twaitForReady(): Promise<void> {\n\t\t\treturn this.whenReady;\n\t\t}\n\n\t\tget pendingBackupOperationCount(): number { return this.pendingBackupOperations.size; }\n\n\t\toverride dispose() {\n\t\t\tsuper.dispose();\n\n\t\t\tfor (const [_, pending] of this.pendingBackupOperations) {\n\t\t\t\tpending.cancel();\n\t\t\t\tpending.disposable.dispose();\n\t\t\t}\n\t\t}\n\n\t\tprivate readonly _onDidResume = this._register(new Emitter<void>());\n\t\treadonly onDidResume = this._onDidResume.event;\n\n\t\tprivate readonly _onDidSuspend = this._register(new Emitter<void>());\n\t\treadonly onDidSuspend = this._onDidSuspend.event;\n\n\t\tprotected override suspendBackupOperations(): { resume: () => void } {\n\t\t\tconst { resume } = super.suspendBackupOperations();\n\n\t\t\tthis._onDidSuspend.fire();\n\n\t\t\treturn {\n\t\t\t\tresume: () => {\n\t\t\t\t\tresume();\n\n\t\t\t\t\tthis._onDidResume.fire();\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\t}\n\n\tlet testDir: URI;\n\tlet backupHome: URI;\n\tlet workspaceBackupPath: URI;\n\n\tlet accessor: TestServiceAccessor;\n\n\tconst disposables = new DisposableStore();\n\n\tsetup(async () => {\n\t\ttestDir = URI.file(join(generateUuid(), 'vsctests', 'workingcopybackuptracker')).with({ scheme: Schemas.inMemory });\n\t\tbackupHome = joinPath(testDir, 'Backups');\n\t\tconst workspacesJsonPath = joinPath(backupHome, 'workspaces.json');\n\n\t\tconst workspaceResource = URI.file(isWindows ? 'c:\\\\workspace' : '/workspace').with({ scheme: Schemas.inMemory });\n\t\tworkspaceBackupPath = joinPath(backupHome, hash(workspaceResource.toString()).toString(16));\n\n\t\tconst instantiationService = workbenchInstantiationService(undefined, disposables);\n\t\taccessor = instantiationService.createInstance(TestServiceAccessor);\n\t\tdisposables.add((<TextFileEditorModelManager>accessor.textFileService.files));\n\n\t\tdisposables.add(registerTestFileEditor());\n\n\t\tawait accessor.fileService.createFolder(backupHome);\n\t\tawait accessor.fileService.createFolder(workspaceBackupPath);\n\n\t\treturn accessor.fileService.writeFile(workspacesJsonPath, VSBuffer.fromString(''));\n\t});\n\n\tteardown(() => {\n\t\tdisposables.clear();\n\t});\n\n\tasync function createTracker(autoSaveEnabled = false): Promise<{ accessor: TestServiceAccessor; part: EditorPart; tracker: TestWorkingCopyBackupTracker; instantiationService: IInstantiationService; cleanup: () => Promise<void> }> {\n\t\tconst instantiationService = workbenchInstantiationService(undefined, disposables);\n\n\t\tconst configurationService = new TestConfigurationService();\n\t\tif (autoSaveEnabled) {\n\t\t\tconfigurationService.setUserConfiguration('files', { autoSave: 'afterDelay', autoSaveDelay: 1 });\n\t\t} else {\n\t\t\tconfigurationService.setUserConfiguration('files', { autoSave: 'off', autoSaveDelay: 1 });\n\t\t}\n\t\tinstantiationService.stub(IConfigurationService, configurationService);\n\n\t\tinstantiationService.stub(IFilesConfigurationService, disposables.add(new TestFilesConfigurationService(\n\t\t\t<IContextKeyService>instantiationService.createInstance(MockContextKeyService),\n\t\t\tconfigurationService,\n\t\t\tnew TestContextService(TestWorkspace),\n\t\t\tTestEnvironmentService,\n\t\t\tdisposables.add(new UriIdentityService(disposables.add(new TestFileService()))),\n\t\t\tdisposables.add(new TestFileService()),\n\t\t\tnew TestMarkerService(),\n\t\t\tnew TestTextResourceConfigurationService(configurationService)\n\t\t)));\n\n\t\tconst part = await createEditorPart(instantiationService, disposables);\n\t\tinstantiationService.stub(IEditorGroupsService, part);\n\n\t\tconst editorService: EditorService = disposables.add(instantiationService.createInstance(EditorService, undefined));\n\t\tinstantiationService.stub(IEditorService, editorService);\n\n\t\taccessor = instantiationService.createInstance(TestServiceAccessor);\n\n\t\tconst tracker = instantiationService.createInstance(TestWorkingCopyBackupTracker);\n\n\t\tconst cleanup = async () => {\n\t\t\tawait accessor.workingCopyBackupService.waitForAllBackups(); // File changes could also schedule some backup operations so we need to wait for them before finishing the test\n\n\t\t\tawait workbenchTeardown(instantiationService);\n\n\t\t\tpart.dispose();\n\t\t\ttracker.dispose();\n\t\t};\n\n\t\treturn { accessor, part, tracker, instantiationService, cleanup };\n\t}\n\n\ttest('Track backups (file, auto save off)', function () {\n\t\treturn trackBackupsTest(toResource.call(this, '/path/index.txt'), false);\n\t});\n\n\ttest('Track backups (file, auto save on)', function () {\n\t\treturn trackBackupsTest(toResource.call(this, '/path/index.txt'), true);\n\t});\n\n\tasync function trackBackupsTest(resource: URI, autoSave: boolean) {\n\t\tconst { accessor, cleanup } = await createTracker(autoSave);\n\n\t\tawait accessor.editorService.openEditor({ resource, options: { pinned: true } });\n\n\t\tconst fileModel = accessor.textFileService.files.get(resource);\n\t\tassert.ok(fileModel);\n\t\tfileModel.textEditorModel?.setValue('Super Good');\n\n\t\tawait accessor.workingCopyBackupService.joinBackupResource();\n\n\t\tassert.strictEqual(accessor.workingCopyBackupService.hasBackupSync(fileModel), true);\n\n\t\tfileModel.dispose();\n\n\t\tawait accessor.workingCopyBackupService.joinDiscardBackup();\n\n\t\tassert.strictEqual(accessor.workingCopyBackupService.hasBackupSync(fileModel), false);\n\n\t\tawait cleanup();\n\t}\n\n\ttest('onWillShutdown - no veto if no dirty files', async function () {\n\t\tconst { accessor, cleanup } = await createTracker();\n\n\t\tconst resource = toResource.call(this, '/path/index.txt');\n\t\tawait accessor.editorService.openEditor({ resource, options: { pinned: true } });\n\n\t\tconst event = new TestBeforeShutdownEvent();\n\t\taccessor.lifecycleService.fireBeforeShutdown(event);\n\n\t\tconst veto = await event.value;\n\t\tassert.ok(!veto);\n\n\t\tawait cleanup();\n\t});\n\n\ttest('onWillShutdown - veto if user cancels (hot.exit: off)', async function () {\n\t\tconst { accessor, cleanup } = await createTracker();\n\n\t\tconst resource = toResource.call(this, '/path/index.txt');\n\t\tawait accessor.editorService.openEditor({ resource, options: { pinned: true } });\n\n\t\tconst model = accessor.textFileService.files.get(resource);\n\n\t\taccessor.fileDialogService.setConfirmResult(ConfirmResult.CANCEL);\n\t\taccessor.filesConfigurationService.testOnFilesConfigurationChange({ files: { hotExit: 'off' } });\n\n\t\tawait model?.resolve();\n\t\tmodel?.textEditorModel?.setValue('foo');\n\t\tassert.strictEqual(accessor.workingCopyService.dirtyCount, 1);\n\n\t\tconst event = new TestBeforeShutdownEvent();\n\t\taccessor.lifecycleService.fireBeforeShutdown(event);\n\n\t\tconst veto = await event.value;\n\t\tassert.ok(veto);\n\n\t\tawait cleanup();\n\t});\n\n\ttest('onWillShutdown - no veto if auto save is on', async function () {\n\t\tconst { accessor, cleanup } = await createTracker(true /* auto save enabled */);\n\n\t\tconst resource = toResource.call(this, '/path/index.txt');\n\t\tawait accessor.editorService.openEditor({ resource, options: { pinned: true } });\n\n\t\tconst model = accessor.textFileService.files.get(resource);\n\n\t\tawait model?.resolve();\n\t\tmodel?.textEditorModel?.setValue('foo');\n\t\tassert.strictEqual(accessor.workingCopyService.dirtyCount, 1);\n\n\t\tconst event = new TestBeforeShutdownEvent();\n\t\taccessor.lifecycleService.fireBeforeShutdown(event);\n\n\t\tconst veto = await event.value;\n\t\tassert.ok(!veto);\n\n\t\tassert.strictEqual(accessor.workingCopyService.dirtyCount, 0);\n\n\t\tawait cleanup();\n\t});\n\n\ttest('onWillShutdown - no veto and backups cleaned up if user does not want to save (hot.exit: off)', async function () {\n\t\tconst { accessor, cleanup } = await createTracker();\n\n\t\tconst resource = toResource.call(this, '/path/index.txt');\n\t\tawait accessor.editorService.openEditor({ resource, options: { pinned: true } });\n\n\t\tconst model = accessor.textFileService.files.get(resource);\n\n\t\taccessor.fileDialogService.setConfirmResult(ConfirmResult.DONT_SAVE);\n\t\taccessor.filesConfigurationService.testOnFilesConfigurationChange({ files: { hotExit: 'off' } });\n\n\t\tawait model?.resolve();\n\t\tmodel?.textEditorModel?.setValue('foo');\n\t\tassert.strictEqual(accessor.workingCopyService.dirtyCount, 1);\n\t\tconst event = new TestBeforeShutdownEvent();\n\t\taccessor.lifecycleService.fireBeforeShutdown(event);\n\n\t\tconst veto = await event.value;\n\t\tassert.ok(!veto);\n\t\tassert.ok(accessor.workingCopyBackupService.discardedBackups.length > 0);\n\n\t\tawait cleanup();\n\t});\n\n\ttest('onWillShutdown - no backups discarded when shutdown without dirty but tracker not ready', async function () {\n\t\tconst { accessor, cleanup } = await createTracker();\n\n\t\tconst event = new TestBeforeShutdownEvent();\n\t\taccessor.lifecycleService.fireBeforeShutdown(event);\n\n\t\tconst veto = await event.value;\n\t\tassert.ok(!veto);\n\t\tassert.ok(!accessor.workingCopyBackupService.discardedAllBackups);\n\n\t\tawait cleanup();\n\t});\n\n\ttest('onWillShutdown - backups discarded when shutdown without dirty', async function () {\n\t\tconst { accessor, tracker, cleanup } = await createTracker();\n\n\t\tawait tracker.waitForReady();\n\n\t\tconst event = new TestBeforeShutdownEvent();\n\t\taccessor.lifecycleService.fireBeforeShutdown(event);\n\n\t\tconst veto = await event.value;\n\t\tassert.ok(!veto);\n\t\tassert.ok(accessor.workingCopyBackupService.discardedAllBackups);\n\n\t\tawait cleanup();\n\t});\n\n\ttest('onWillShutdown - save (hot.exit: off)', async function () {\n\t\tconst { accessor, cleanup } = await createTracker();\n\n\t\tconst resource = toResource.call(this, '/path/index.txt');\n\t\tawait accessor.editorService.openEditor({ resource, options: { pinned: true } });\n\n\t\tconst model = accessor.textFileService.files.get(resource);\n\n\t\taccessor.fileDialogService.setConfirmResult(ConfirmResult.SAVE);\n\t\taccessor.filesConfigurationService.testOnFilesConfigurationChange({ files: { hotExit: 'off' } });\n\n\t\tawait model?.resolve();\n\t\tmodel?.textEditorModel?.setValue('foo');\n\t\tassert.strictEqual(accessor.workingCopyService.dirtyCount, 1);\n\t\tconst event = new TestBeforeShutdownEvent();\n\t\taccessor.lifecycleService.fireBeforeShutdown(event);\n\n\t\tconst veto = await event.value;\n\t\tassert.ok(!veto);\n\t\tassert.ok(!model?.isDirty());\n\n\t\tawait cleanup();\n\t});\n\n\ttest('onWillShutdown - veto if backup fails', async function () {\n\t\tconst { accessor, cleanup } = await createTracker();\n\n\t\tclass TestBackupWorkingCopy extends TestWorkingCopy {\n\n\t\t\tconstructor(resource: URI) {\n\t\t\t\tsuper(resource);\n\n\t\t\t\tthis._register(accessor.workingCopyService.registerWorkingCopy(this));\n\t\t\t}\n\n\t\t\toverride async backup(token: CancellationToken): Promise<IWorkingCopyBackup> {\n\t\t\t\tthrow new Error('unable to backup');\n\t\t\t}\n\t\t}\n\n\t\tconst resource = toResource.call(this, '/path/custom.txt');\n\t\tconst customWorkingCopy = disposables.add(new TestBackupWorkingCopy(resource));\n\t\tcustomWorkingCopy.setDirty(true);\n\n\t\tconst event = new TestBeforeShutdownEvent();\n\t\tevent.reason = ShutdownReason.QUIT;\n\t\taccessor.lifecycleService.fireBeforeShutdown(event);\n\n\t\tconst veto = await event.value;\n\t\tassert.ok(veto);\n\n\t\tconst finalVeto = await event.finalValue?.();\n\t\tassert.ok(finalVeto); // assert the tracker uses the internal finalVeto API\n\n\t\tawait cleanup();\n\t});\n\n\ttest('onWillShutdown - scratchpads - veto if backup fails', async function () {\n\t\tconst { accessor, cleanup } = await createTracker();\n\n\t\tclass TestBackupWorkingCopy extends TestWorkingCopy {\n\n\t\t\tconstructor(resource: URI) {\n\t\t\t\tsuper(resource);\n\n\t\t\t\tthis._register(accessor.workingCopyService.registerWorkingCopy(this));\n\t\t\t}\n\n\t\t\toverride capabilities = WorkingCopyCapabilities.Untitled | WorkingCopyCapabilities.Scratchpad;\n\n\t\t\toverride async backup(token: CancellationToken): Promise<IWorkingCopyBackup> {\n\t\t\t\tthrow new Error('unable to backup');\n\t\t\t}\n\n\t\t\toverride isDirty(): boolean {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\toverride isModified(): boolean {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\n\t\tconst resource = toResource.call(this, '/path/custom.txt');\n\t\tdisposables.add(new TestBackupWorkingCopy(resource));\n\n\t\tconst event = new TestBeforeShutdownEvent();\n\t\tevent.reason = ShutdownReason.QUIT;\n\t\taccessor.lifecycleService.fireBeforeShutdown(event);\n\n\t\tconst veto = await event.value;\n\t\tassert.ok(veto);\n\n\t\tconst finalVeto = await event.finalValue?.();\n\t\tassert.ok(finalVeto); // assert the tracker uses the internal finalVeto API\n\n\t\tawait cleanup();\n\t});\n\n\ttest('onWillShutdown - pending backup operations canceled and tracker suspended/resumsed', async function () {\n\t\tconst { accessor, tracker, cleanup } = await createTracker();\n\n\t\tconst resource = toResource.call(this, '/path/index.txt');\n\t\tawait accessor.editorService.openEditor({ resource, options: { pinned: true } });\n\n\t\tconst model = accessor.textFileService.files.get(resource);\n\n\t\tawait model?.resolve();\n\t\tmodel?.textEditorModel?.setValue('foo');\n\t\tassert.strictEqual(accessor.workingCopyService.dirtyCount, 1);\n\t\tassert.strictEqual(tracker.pendingBackupOperationCount, 1);\n\n\t\tconst onSuspend = Event.toPromise(tracker.onDidSuspend);\n\n\t\tconst event = new TestBeforeShutdownEvent();\n\t\tevent.reason = ShutdownReason.QUIT;\n\t\taccessor.lifecycleService.fireBeforeShutdown(event);\n\n\t\tawait onSuspend;\n\n\t\tassert.strictEqual(tracker.pendingBackupOperationCount, 0);\n\n\t\t// Ops are suspended during shutdown!\n\t\tmodel?.textEditorModel?.setValue('bar');\n\t\tassert.strictEqual(accessor.workingCopyService.dirtyCount, 1);\n\t\tassert.strictEqual(tracker.pendingBackupOperationCount, 0);\n\n\t\tconst onResume = Event.toPromise(tracker.onDidResume);\n\t\tawait event.value;\n\n\t\t// Ops are resumed after shutdown!\n\t\tmodel?.textEditorModel?.setValue('foo');\n\t\tawait onResume;\n\t\tassert.strictEqual(tracker.pendingBackupOperationCount, 1);\n\n\t\tawait cleanup();\n\t});\n\n\tsuite('Hot Exit', () => {\n\t\tsuite('\"onExit\" setting', () => {\n\t\t\ttest('should hot exit on non-Mac (reason: CLOSE, windows: single, workspace)', function () {\n\t\t\t\treturn hotExitTest.call(this, HotExitConfiguration.ON_EXIT, ShutdownReason.CLOSE, false, true, !!isMacintosh);\n\t\t\t});\n\t\t\ttest('should hot exit on non-Mac (reason: CLOSE, windows: single, empty workspace)', function () {\n\t\t\t\treturn hotExitTest.call(this, HotExitConfiguration.ON_EXIT, ShutdownReason.CLOSE, false, false, !!isMacintosh);\n\t\t\t});\n\t\t\ttest('should NOT hot exit (reason: CLOSE, windows: multiple, workspace)', function () {\n\t\t\t\treturn hotExitTest.call(this, HotExitConfiguration.ON_EXIT, ShutdownReason.CLOSE, true, true, true);\n\t\t\t});\n\t\t\ttest('should NOT hot exit (reason: CLOSE, windows: multiple, empty workspace)', function () {\n\t\t\t\treturn hotExitTest.call(this, HotExitConfiguration.ON_EXIT, ShutdownReason.CLOSE, true, false, true);\n\t\t\t});\n\t\t\ttest('should hot exit (reason: QUIT, windows: single, workspace)', function () {\n\t\t\t\treturn hotExitTest.call(this, HotExitConfiguration.ON_EXIT, ShutdownReason.QUIT, false, true, false);\n\t\t\t});\n\t\t\ttest('should hot exit (reason: QUIT, windows: single, empty workspace)', function () {\n\t\t\t\treturn hotExitTest.call(this, HotExitConfiguration.ON_EXIT, ShutdownReason.QUIT, false, false, false);\n\t\t\t});\n\t\t\ttest('should hot exit (reason: QUIT, windows: multiple, workspace)', function () {\n\t\t\t\treturn hotExitTest.call(this, HotExitConfiguration.ON_EXIT, ShutdownReason.QUIT, true, true, false);\n\t\t\t});\n\t\t\ttest('should hot exit (reason: QUIT, windows: multiple, empty workspace)', function () {\n\t\t\t\treturn hotExitTest.call(this, HotExitConfiguration.ON_EXIT, ShutdownReason.QUIT, true, false, false);\n\t\t\t});\n\t\t\ttest('should hot exit (reason: RELOAD, windows: single, workspace)', function () {\n\t\t\t\treturn hotExitTest.call(this, HotExitConfiguration.ON_EXIT, ShutdownReason.RELOAD, false, true, false);\n\t\t\t});\n\t\t\ttest('should hot exit (reason: RELOAD, windows: single, empty workspace)', function () {\n\t\t\t\treturn hotExitTest.call(this, HotExitConfiguration.ON_EXIT, ShutdownReason.RELOAD, false, false, false);\n\t\t\t});\n\t\t\ttest('should hot exit (reason: RELOAD, windows: multiple, workspace)', function () {\n\t\t\t\treturn hotExitTest.call(this, HotExitConfiguration.ON_EXIT, ShutdownReason.RELOAD, true, true, false);\n\t\t\t});\n\t\t\ttest('should hot exit (reason: RELOAD, windows: multiple, empty workspace)', function () {\n\t\t\t\treturn hotExitTest.call(this, HotExitConfiguration.ON_EXIT, ShutdownReason.RELOAD, true, false, false);\n\t\t\t});\n\t\t\ttest('should NOT hot exit (reason: LOAD, windows: single, workspace)', function () {\n\t\t\t\treturn hotExitTest.call(this, HotExitConfiguration.ON_EXIT, ShutdownReason.LOAD, false, true, true);\n\t\t\t});\n\t\t\ttest('should NOT hot exit (reason: LOAD, windows: single, empty workspace)', function () {\n\t\t\t\treturn hotExitTest.call(this, HotExitConfiguration.ON_EXIT, ShutdownReason.LOAD, false, false, true);\n\t\t\t});\n\t\t\ttest('should NOT hot exit (reason: LOAD, windows: multiple, workspace)', function () {\n\t\t\t\treturn hotExitTest.call(this, HotExitConfiguration.ON_EXIT, ShutdownReason.LOAD, true, true, true);\n\t\t\t});\n\t\t\ttest('should NOT hot exit (reason: LOAD, windows: multiple, empty workspace)', function () {\n\t\t\t\treturn hotExitTest.call(this, HotExitConfiguration.ON_EXIT, ShutdownReason.LOAD, true, false, true);\n\t\t\t});\n\t\t});\n\n\t\tsuite('\"onExitAndWindowClose\" setting', () => {\n\t\t\ttest('should hot exit (reason: CLOSE, windows: single, workspace)', function () {\n\t\t\t\treturn hotExitTest.call(this, HotExitConfiguration.ON_EXIT_AND_WINDOW_CLOSE, ShutdownReason.CLOSE, false, true, false);\n\t\t\t});\n\t\t\ttest('should hot exit (reason: CLOSE, windows: single, empty workspace)', function () {\n\t\t\t\treturn hotExitTest.call(this, HotExitConfiguration.ON_EXIT_AND_WINDOW_CLOSE, ShutdownReason.CLOSE, false, false, !!isMacintosh);\n\t\t\t});\n\t\t\ttest('should hot exit (reason: CLOSE, windows: multiple, workspace)', function () {\n\t\t\t\treturn hotExitTest.call(this, HotExitConfiguration.ON_EXIT_AND_WINDOW_CLOSE, ShutdownReason.CLOSE, true, true, false);\n\t\t\t});\n\t\t\ttest('should NOT hot exit (reason: CLOSE, windows: multiple, empty workspace)', function () {\n\t\t\t\treturn hotExitTest.call(this, HotExitConfiguration.ON_EXIT_AND_WINDOW_CLOSE, ShutdownReason.CLOSE, true, false, true);\n\t\t\t});\n\t\t\ttest('should hot exit (reason: QUIT, windows: single, workspace)', function () {\n\t\t\t\treturn hotExitTest.call(this, HotExitConfiguration.ON_EXIT_AND_WINDOW_CLOSE, ShutdownReason.QUIT, false, true, false);\n\t\t\t});\n\t\t\ttest('should hot exit (reason: QUIT, windows: single, empty workspace)', function () {\n\t\t\t\treturn hotExitTest.call(this, HotExitConfiguration.ON_EXIT_AND_WINDOW_CLOSE, ShutdownReason.QUIT, false, false, false);\n\t\t\t});\n\t\t\ttest('should hot exit (reason: QUIT, windows: multiple, workspace)', function () {\n\t\t\t\treturn hotExitTest.call(this, HotExitConfiguration.ON_EXIT_AND_WINDOW_CLOSE, ShutdownReason.QUIT, true, true, false);\n\t\t\t});\n\t\t\ttest('should hot exit (reason: QUIT, windows: multiple, empty workspace)', function () {\n\t\t\t\treturn hotExitTest.call(this, HotExitConfiguration.ON_EXIT_AND_WINDOW_CLOSE, ShutdownReason.QUIT, true, false, false);\n\t\t\t});\n\t\t\ttest('should hot exit (reason: RELOAD, windows: single, workspace)', function () {\n\t\t\t\treturn hotExitTest.call(this, HotExitConfiguration.ON_EXIT_AND_WINDOW_CLOSE, ShutdownReason.RELOAD, false, true, false);\n\t\t\t});\n\t\t\ttest('should hot exit (reason: RELOAD, windows: single, empty workspace)', function () {\n\t\t\t\treturn hotExitTest.call(this, HotExitConfiguration.ON_EXIT_AND_WINDOW_CLOSE, ShutdownReason.RELOAD, false, false, false);\n\t\t\t});\n\t\t\ttest('should hot exit (reason: RELOAD, windows: multiple, workspace)', function () {\n\t\t\t\treturn hotExitTest.call(this, HotExitConfiguration.ON_EXIT_AND_WINDOW_CLOSE, ShutdownReason.RELOAD, true, true, false);\n\t\t\t});\n\t\t\ttest('should hot exit (reason: RELOAD, windows: multiple, empty workspace)', function () {\n\t\t\t\treturn hotExitTest.call(this, HotExitConfiguration.ON_EXIT_AND_WINDOW_CLOSE, ShutdownReason.RELOAD, true, false, false);\n\t\t\t});\n\t\t\ttest('should hot exit (reason: LOAD, windows: single, workspace)', function () {\n\t\t\t\treturn hotExitTest.call(this, HotExitConfiguration.ON_EXIT_AND_WINDOW_CLOSE, ShutdownReason.LOAD, false, true, false);\n\t\t\t});\n\t\t\ttest('should NOT hot exit (reason: LOAD, windows: single, empty workspace)', function () {\n\t\t\t\treturn hotExitTest.call(this, HotExitConfiguration.ON_EXIT_AND_WINDOW_CLOSE, ShutdownReason.LOAD, false, false, true);\n\t\t\t});\n\t\t\ttest('should hot exit (reason: LOAD, windows: multiple, workspace)', function () {\n\t\t\t\treturn hotExitTest.call(this, HotExitConfiguration.ON_EXIT_AND_WINDOW_CLOSE, ShutdownReason.LOAD, true, true, false);\n\t\t\t});\n\t\t\ttest('should NOT hot exit (reason: LOAD, windows: multiple, empty workspace)', function () {\n\t\t\t\treturn hotExitTest.call(this, HotExitConfiguration.ON_EXIT_AND_WINDOW_CLOSE, ShutdownReason.LOAD, true, false, true);\n\t\t\t});\n\t\t});\n\n\t\tsuite('\"onExit\" setting - scratchpad', () => {\n\t\t\ttest('should hot exit (reason: CLOSE, windows: single, workspace)', function () {\n\t\t\t\treturn scratchpadHotExitTest.call(this, HotExitConfiguration.ON_EXIT, ShutdownReason.CLOSE, false, true, false);\n\t\t\t});\n\t\t\ttest('should hot exit (reason: CLOSE, windows: single, empty workspace)', function () {\n\t\t\t\treturn scratchpadHotExitTest.call(this, HotExitConfiguration.ON_EXIT, ShutdownReason.CLOSE, false, false, !!isMacintosh);\n\t\t\t});\n\t\t\ttest('should hot exit (reason: CLOSE, windows: multiple, workspace)', function () {\n\t\t\t\treturn scratchpadHotExitTest.call(this, HotExitConfiguration.ON_EXIT, ShutdownReason.CLOSE, true, true, false);\n\t\t\t});\n\t\t\ttest('should NOT hot exit (reason: CLOSE, windows: multiple, empty workspace)', function () {\n\t\t\t\treturn scratchpadHotExitTest.call(this, HotExitConfiguration.ON_EXIT, ShutdownReason.CLOSE, true, false, true);\n\t\t\t});\n\t\t\ttest('should hot exit (reason: QUIT, windows: single, workspace)', function () {\n\t\t\t\treturn scratchpadHotExitTest.call(this, HotExitConfiguration.ON_EXIT, ShutdownReason.QUIT, false, true, false);\n\t\t\t});\n\t\t\ttest('should hot exit (reason: QUIT, windows: single, empty workspace)', function () {\n\t\t\t\treturn scratchpadHotExitTest.call(this, HotExitConfiguration.ON_EXIT, ShutdownReason.QUIT, false, false, false);\n\t\t\t});\n\t\t\ttest('should hot exit (reason: QUIT, windows: multiple, workspace)', function () {\n\t\t\t\treturn scratchpadHotExitTest.call(this, HotExitConfiguration.ON_EXIT, ShutdownReason.QUIT, true, true, false);\n\t\t\t});\n\t\t\ttest('should hot exit (reason: QUIT, windows: multiple, empty workspace)', function () {\n\t\t\t\treturn scratchpadHotExitTest.call(this, HotExitConfiguration.ON_EXIT, ShutdownReason.QUIT, true, false, false);\n\t\t\t});\n\t\t\ttest('should hot exit (reason: RELOAD, windows: single, workspace)', function () {\n\t\t\t\treturn scratchpadHotExitTest.call(this, HotExitConfiguration.ON_EXIT, ShutdownReason.RELOAD, false, true, false);\n\t\t\t});\n\t\t\ttest('should hot exit (reason: RELOAD, windows: single, empty workspace)', function () {\n\t\t\t\treturn scratchpadHotExitTest.call(this, HotExitConfiguration.ON_EXIT, ShutdownReason.RELOAD, false, false, false);\n\t\t\t});\n\t\t\ttest('should hot exit (reason: RELOAD, windows: multiple, workspace)', function () {\n\t\t\t\treturn scratchpadHotExitTest.call(this, HotExitConfiguration.ON_EXIT, ShutdownReason.RELOAD, true, true, false);\n\t\t\t});\n\t\t\ttest('should hot exit (reason: RELOAD, windows: multiple, empty workspace)', function () {\n\t\t\t\treturn scratchpadHotExitTest.call(this, HotExitConfiguration.ON_EXIT, ShutdownReason.RELOAD, true, false, false);\n\t\t\t});\n\t\t\ttest('should hot exit (reason: LOAD, windows: single, workspace)', function () {\n\t\t\t\treturn scratchpadHotExitTest.call(this, HotExitConfiguration.ON_EXIT, ShutdownReason.LOAD, false, true, false);\n\t\t\t});\n\t\t\ttest('should NOT hot exit (reason: LOAD, windows: single, empty workspace)', function () {\n\t\t\t\treturn scratchpadHotExitTest.call(this, HotExitConfiguration.ON_EXIT, ShutdownReason.LOAD, false, false, true);\n\t\t\t});\n\t\t\ttest('should hot exit (reason: LOAD, windows: multiple, workspace)', function () {\n\t\t\t\treturn scratchpadHotExitTest.call(this, HotExitConfiguration.ON_EXIT, ShutdownReason.LOAD, true, true, false);\n\t\t\t});\n\t\t\ttest('should NOT hot exit (reason: LOAD, windows: multiple, empty workspace)', function () {\n\t\t\t\treturn scratchpadHotExitTest.call(this, HotExitConfiguration.ON_EXIT, ShutdownReason.LOAD, true, false, true);\n\t\t\t});\n\t\t});\n\n\t\tsuite('\"onExitAndWindowClose\" setting - scratchpad', () => {\n\t\t\ttest('should hot exit (reason: CLOSE, windows: single, workspace)', function () {\n\t\t\t\treturn scratchpadHotExitTest.call(this, HotExitConfiguration.ON_EXIT_AND_WINDOW_CLOSE, ShutdownReason.CLOSE, false, true, false);\n\t\t\t});\n\t\t\ttest('should hot exit (reason: CLOSE, windows: single, empty workspace)', function () {\n\t\t\t\treturn scratchpadHotExitTest.call(this, HotExitConfiguration.ON_EXIT_AND_WINDOW_CLOSE, ShutdownReason.CLOSE, false, false, !!isMacintosh);\n\t\t\t});\n\t\t\ttest('should hot exit (reason: CLOSE, windows: multiple, workspace)', function () {\n\t\t\t\treturn scratchpadHotExitTest.call(this, HotExitConfiguration.ON_EXIT_AND_WINDOW_CLOSE, ShutdownReason.CLOSE, true, true, false);\n\t\t\t});\n\t\t\ttest('should NOT hot exit (reason: CLOSE, windows: multiple, empty workspace)', function () {\n\t\t\t\treturn scratchpadHotExitTest.call(this, HotExitConfiguration.ON_EXIT_AND_WINDOW_CLOSE, ShutdownReason.CLOSE, true, false, true);\n\t\t\t});\n\t\t\ttest('should hot exit (reason: QUIT, windows: single, workspace)', function () {\n\t\t\t\treturn scratchpadHotExitTest.call(this, HotExitConfiguration.ON_EXIT_AND_WINDOW_CLOSE, ShutdownReason.QUIT, false, true, false);\n\t\t\t});\n\t\t\ttest('should hot exit (reason: QUIT, windows: single, empty workspace)', function () {\n\t\t\t\treturn scratchpadHotExitTest.call(this, HotExitConfiguration.ON_EXIT_AND_WINDOW_CLOSE, ShutdownReason.QUIT, false, false, false);\n\t\t\t});\n\t\t\ttest('should hot exit (reason: QUIT, windows: multiple, workspace)', function () {\n\t\t\t\treturn scratchpadHotExitTest.call(this, HotExitConfiguration.ON_EXIT_AND_WINDOW_CLOSE, ShutdownReason.QUIT, true, true, false);\n\t\t\t});\n\t\t\ttest('should hot exit (reason: QUIT, windows: multiple, empty workspace)', function () {\n\t\t\t\treturn scratchpadHotExitTest.call(this, HotExitConfiguration.ON_EXIT_AND_WINDOW_CLOSE, ShutdownReason.QUIT, true, false, false);\n\t\t\t});\n\t\t\ttest('should hot exit (reason: RELOAD, windows: single, workspace)', function () {\n\t\t\t\treturn scratchpadHotExitTest.call(this, HotExitConfiguration.ON_EXIT_AND_WINDOW_CLOSE, ShutdownReason.RELOAD, false, true, false);\n\t\t\t});\n\t\t\ttest('should hot exit (reason: RELOAD, windows: single, empty workspace)', function () {\n\t\t\t\treturn scratchpadHotExitTest.call(this, HotExitConfiguration.ON_EXIT_AND_WINDOW_CLOSE, ShutdownReason.RELOAD, false, false, false);\n\t\t\t});\n\t\t\ttest('should hot exit (reason: RELOAD, windows: multiple, workspace)', function () {\n\t\t\t\treturn scratchpadHotExitTest.call(this, HotExitConfiguration.ON_EXIT_AND_WINDOW_CLOSE, ShutdownReason.RELOAD, true, true, false);\n\t\t\t});\n\t\t\ttest('should hot exit (reason: RELOAD, windows: multiple, empty workspace)', function () {\n\t\t\t\treturn scratchpadHotExitTest.call(this, HotExitConfiguration.ON_EXIT_AND_WINDOW_CLOSE, ShutdownReason.RELOAD, true, false, false);\n\t\t\t});\n\t\t\ttest('should hot exit (reason: LOAD, windows: single, workspace)', function () {\n\t\t\t\treturn scratchpadHotExitTest.call(this, HotExitConfiguration.ON_EXIT_AND_WINDOW_CLOSE, ShutdownReason.LOAD, false, true, false);\n\t\t\t});\n\t\t\ttest('should NOT hot exit (reason: LOAD, windows: single, empty workspace)', function () {\n\t\t\t\treturn scratchpadHotExitTest.call(this, HotExitConfiguration.ON_EXIT_AND_WINDOW_CLOSE, ShutdownReason.LOAD, false, false, true);\n\t\t\t});\n\t\t\ttest('should hot exit (reason: LOAD, windows: multiple, workspace)', function () {\n\t\t\t\treturn scratchpadHotExitTest.call(this, HotExitConfiguration.ON_EXIT_AND_WINDOW_CLOSE, ShutdownReason.LOAD, true, true, false);\n\t\t\t});\n\t\t\ttest('should NOT hot exit (reason: LOAD, windows: multiple, empty workspace)', function () {\n\t\t\t\treturn scratchpadHotExitTest.call(this, HotExitConfiguration.ON_EXIT_AND_WINDOW_CLOSE, ShutdownReason.LOAD, true, false, true);\n\t\t\t});\n\t\t});\n\n\n\t\tasync function hotExitTest(this: any, setting: string, shutdownReason: ShutdownReason, multipleWindows: boolean, workspace: boolean, shouldVeto: boolean): Promise<void> {\n\t\t\tconst { accessor, cleanup } = await createTracker();\n\n\t\t\tconst resource = toResource.call(this, '/path/index.txt');\n\t\t\tawait accessor.editorService.openEditor({ resource, options: { pinned: true } });\n\n\t\t\tconst model = accessor.textFileService.files.get(resource);\n\n\t\t\t// Set hot exit config\n\t\t\taccessor.filesConfigurationService.testOnFilesConfigurationChange({ files: { hotExit: setting } });\n\n\t\t\t// Set empty workspace if required\n\t\t\tif (!workspace) {\n\t\t\t\taccessor.contextService.setWorkspace(new Workspace('empty:1508317022751'));\n\t\t\t}\n\n\t\t\t// Set multiple windows if required\n\t\t\tif (multipleWindows) {\n\t\t\t\taccessor.nativeHostService.windowCount = Promise.resolve(2);\n\t\t\t}\n\n\t\t\t// Set cancel to force a veto if hot exit does not trigger\n\t\t\taccessor.fileDialogService.setConfirmResult(ConfirmResult.CANCEL);\n\n\t\t\tawait model?.resolve();\n\t\t\tmodel?.textEditorModel?.setValue('foo');\n\t\t\tassert.strictEqual(accessor.workingCopyService.dirtyCount, 1);\n\n\t\t\tconst event = new TestBeforeShutdownEvent();\n\t\t\tevent.reason = shutdownReason;\n\t\t\taccessor.lifecycleService.fireBeforeShutdown(event);\n\n\t\t\tconst veto = await event.value;\n\t\t\tassert.ok(typeof event.finalValue === 'function'); // assert the tracker uses the internal finalVeto API\n\t\t\tassert.strictEqual(accessor.workingCopyBackupService.discardedBackups.length, 0); // When hot exit is set, backups should never be cleaned since the confirm result is cancel\n\t\t\tassert.strictEqual(veto, shouldVeto);\n\n\t\t\tawait cleanup();\n\t\t}\n\n\t\tasync function scratchpadHotExitTest(this: any, setting: string, shutdownReason: ShutdownReason, multipleWindows: boolean, workspace: boolean, shouldVeto: boolean): Promise<void> {\n\t\t\tconst { accessor, cleanup } = await createTracker();\n\n\t\t\tclass TestBackupWorkingCopy extends TestWorkingCopy {\n\n\t\t\t\tconstructor(resource: URI) {\n\t\t\t\t\tsuper(resource);\n\n\t\t\t\t\tthis._register(accessor.workingCopyService.registerWorkingCopy(this));\n\t\t\t\t}\n\n\t\t\t\toverride capabilities = WorkingCopyCapabilities.Untitled | WorkingCopyCapabilities.Scratchpad;\n\n\t\t\t\toverride isDirty(): boolean {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\toverride isModified(): boolean {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Set hot exit config\n\t\t\taccessor.filesConfigurationService.testOnFilesConfigurationChange({ files: { hotExit: setting } });\n\n\t\t\t// Set empty workspace if required\n\t\t\tif (!workspace) {\n\t\t\t\taccessor.contextService.setWorkspace(new Workspace('empty:1508317022751'));\n\t\t\t}\n\n\t\t\t// Set multiple windows if required\n\t\t\tif (multipleWindows) {\n\t\t\t\taccessor.nativeHostService.windowCount = Promise.resolve(2);\n\t\t\t}\n\n\t\t\t// Set cancel to force a veto if hot exit does not trigger\n\t\t\taccessor.fileDialogService.setConfirmResult(ConfirmResult.CANCEL);\n\n\t\t\tconst resource = toResource.call(this, '/path/custom.txt');\n\t\t\tdisposables.add(new TestBackupWorkingCopy(resource));\n\n\t\t\tconst event = new TestBeforeShutdownEvent();\n\t\t\tevent.reason = shutdownReason;\n\t\t\taccessor.lifecycleService.fireBeforeShutdown(event);\n\n\t\t\tconst veto = await event.value;\n\t\t\tassert.ok(typeof event.finalValue === 'function'); // assert the tracker uses the internal finalVeto API\n\t\t\tassert.strictEqual(accessor.workingCopyBackupService.discardedBackups.length, 0); // When hot exit is set, backups should never be cleaned since the confirm result is cancel\n\t\t\tassert.strictEqual(veto, shouldVeto);\n\n\t\t\tawait cleanup();\n\t\t}\n\t});\n\n\tensureNoDisposablesAreLeakedInTestSuite();\n});\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport assert from 'assert';\nimport { isMacintosh, isWindows } from '../../../../../base/common/platform.js';\nimport { join } from '../../../../../base/common/path.js';\nimport { URI } from '../../../../../base/common/uri.js';\nimport { hash } from '../../../../../base/common/hash.js';\nimport { NativeWorkingCopyBackupTracker } from '../../electron-browser/workingCopyBackupTracker.js';\nimport { TextFileEditorModelManager } from '../../../textfile/common/textFileEditorModelManager.js';\nimport { IEditorService } from '../../../editor/common/editorService.js';\nimport { EditorPart } from '../../../../browser/parts/editor/editorPart.js';\nimport { IEditorGroupsService } from '../../../editor/common/editorGroupsService.js';\nimport { EditorService } from '../../../editor/browser/editorService.js';\nimport { IWorkingCopyBackupService } from '../../common/workingCopyBackup.js';\nimport { DisposableStore } from '../../../../../base/common/lifecycle.js';\nimport { ensureNoDisposablesAreLeakedInTestSuite, toResource } from '../../../../../base/test/common/utils.js';\nimport { IFilesConfigurationService } from '../../../filesConfiguration/common/filesConfigurationService.js';\nimport { IWorkingCopyService } from '../../common/workingCopyService.js';\nimport { ILogService } from '../../../../../platform/log/common/log.js';\nimport { HotExitConfiguration } from '../../../../../platform/files/common/files.js';\nimport { ShutdownReason, ILifecycleService } from '../../../lifecycle/common/lifecycle.js';\nimport { IFileDialogService, ConfirmResult, IDialogService } from '../../../../../platform/dialogs/common/dialogs.js';\nimport { IWorkspaceContextService } from '../../../../../platform/workspace/common/workspace.js';\nimport { INativeHostService } from '../../../../../platform/native/common/native.js';\nimport { IInstantiationService } from '../../../../../platform/instantiation/common/instantiation.js';\nimport { TestConfigurationService } from '../../../../../platform/configuration/test/common/testConfigurationService.js';\nimport { IConfigurationService } from '../../../../../platform/configuration/common/configuration.js';\nimport { createEditorPart, registerTestFileEditor, TestBeforeShutdownEvent, TestEnvironmentService, TestFilesConfigurationService, TestFileService, TestTextResourceConfigurationService, workbenchTeardown } from '../../../../test/browser/workbenchTestServices.js';\nimport { MockContextKeyService } from '../../../../../platform/keybinding/test/common/mockKeybindingService.js';\nimport { IContextKeyService } from '../../../../../platform/contextkey/common/contextkey.js';\nimport { IEnvironmentService } from '../../../../../platform/environment/common/environment.js';\nimport { TestWorkspace, Workspace } from '../../../../../platform/workspace/test/common/testWorkspace.js';\nimport { IProgressService } from '../../../../../platform/progress/common/progress.js';\nimport { IWorkingCopyEditorService } from '../../common/workingCopyEditorService.js';\nimport { TestContextService, TestMarkerService, TestWorkingCopy } from '../../../../test/common/workbenchTestServices.js';\nimport { CancellationToken } from '../../../../../base/common/cancellation.js';\nimport { IWorkingCopyBackup, WorkingCopyCapabilities } from '../../common/workingCopy.js';\nimport { Event, Emitter } from '../../../../../base/common/event.js';\nimport { generateUuid } from '../../../../../base/common/uuid.js';\nimport { Schemas } from '../../../../../base/common/network.js';\nimport { joinPath } from '../../../../../base/common/resources.js';\nimport { VSBuffer } from '../../../../../base/common/buffer.js';\nimport { TestServiceAccessor, workbenchInstantiationService } from '../../../../test/electron-browser/workbenchTestServices.js';\nimport { UriIdentityService } from '../../../../../platform/uriIdentity/common/uriIdentityService.js';\n\nsuite('WorkingCopyBackupTracker (native)', function () {\n\n\tclass TestWorkingCopyBackupTracker extends NativeWorkingCopyBackupTracker {\n\n\t\tconstructor(\n\t\t\t@IWorkingCopyBackupService workingCopyBackupService: IWorkingCopyBackupService,\n\t\t\t@IFilesConfigurationService filesConfigurationService: IFilesConfigurationService,\n\t\t\t@IWorkingCopyService workingCopyService: IWorkingCopyService,\n\t\t\t@ILifecycleService lifecycleService: ILifecycleService,\n\t\t\t@IFileDialogService fileDialogService: IFileDialogService,\n\t\t\t@IDialogService dialogService: IDialogService,\n\t\t\t@IWorkspaceContextService contextService: IWorkspaceContextService,\n\t\t\t@INativeHostService nativeHostService: INativeHostService,\n\t\t\t@ILogService logService: ILogService,\n\t\t\t@IEditorService editorService: IEditorService,\n\t\t\t@IEnvironmentService environmentService: IEnvironmentService,\n\t\t\t@IProgressService progressService: IProgressService,\n\t\t\t@IWorkingCopyEditorService workingCopyEditorService: IWorkingCopyEditorService,\n\t\t\t@IEditorGroupsService editorGroupService: IEditorGroupsService\n\t\t) {\n\t\t\tsuper(workingCopyBackupService, filesConfigurationService, workingCopyService, lifecycleService, fileDialogService, dialogService, contextService, nativeHostService, logService, environmentService, progressService, workingCopyEditorService, editorService, editorGroupService);\n\t\t}\n\n\t\tprotected override getBackupScheduleDelay(): number {\n\t\t\treturn 10; // Reduce timeout for tests\n\t\t}\n\n\t\twaitForReady(): Promise<void> {\n\t\t\treturn this.whenReady;\n\t\t}\n\n\t\tget pendingBackupOperationCount(): number { return this.pendingBackupOperations.size; }\n\n\t\toverride dispose() {\n\t\t\tsuper.dispose();\n\n\t\t\tfor (const [_, pending] of this.pendingBackupOperations) {\n\t\t\t\tpending.cancel();\n\t\t\t\tpending.disposable.dispose();\n\t\t\t}\n\t\t}\n\n\t\tprivate readonly _onDidResume = this._register(new Emitter<void>());\n\t\treadonly onDidResume = this._onDidResume.event;\n\n\t\tprivate readonly _onDidSuspend = this._register(new Emitter<void>());\n\t\treadonly onDidSuspend = this._onDidSuspend.event;\n\n\t\tprotected override suspendBackupOperations(): { resume: () => void } {\n\t\t\tconst { resume } = super.suspendBackupOperations();\n\n\t\t\tthis._onDidSuspend.fire();\n\n\t\t\treturn {\n\t\t\t\tresume: () => {\n\t\t\t\t\tresume();\n\n\t\t\t\t\tthis._onDidResume.fire();\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\t}\n\n\tlet testDir: URI;\n\tlet backupHome: URI;\n\tlet workspaceBackupPath: URI;\n\n\tlet accessor: TestServiceAccessor;\n\n\tconst disposables = new DisposableStore();\n\n\tsetup(async () => {\n\t\ttestDir = URI.file(join(generateUuid(), 'vsctests', 'workingcopybackuptracker')).with({ scheme: Schemas.inMemory });\n\t\tbackupHome = joinPath(testDir, 'Backups');\n\t\tconst workspacesJsonPath = joinPath(backupHome, 'workspaces.json');\n\n\t\tconst workspaceResource = URI.file(isWindows ? 'c:\\\\workspace' : '/workspace').with({ scheme: Schemas.inMemory });\n\t\tworkspaceBackupPath = joinPath(backupHome, hash(workspaceResource.toString()).toString(16));\n\n\t\tconst instantiationService = workbenchInstantiationService(undefined, disposables);\n\t\taccessor = instantiationService.createInstance(TestServiceAccessor);\n\t\tdisposables.add((<TextFileEditorModelManager>accessor.textFileService.files));\n\n\t\tdisposables.add(registerTestFileEditor());\n\n\t\tawait accessor.fileService.createFolder(backupHome);\n\t\tawait accessor.fileService.createFolder(workspaceBackupPath);\n\n\t\treturn accessor.fileService.writeFile(workspacesJsonPath, VSBuffer.fromString(''));\n\t});\n\n\tteardown(() => {\n\t\tdisposables.clear();\n\t});\n\n\tasync function createTracker(autoSaveEnabled = false): Promise<{ accessor: TestServiceAccessor; part: EditorPart; tracker: TestWorkingCopyBackupTracker; instantiationService: IInstantiationService; cleanup: () => Promise<void> }> {\n\t\tconst instantiationService = workbenchInstantiationService(undefined, disposables);\n\n\t\tconst configurationService = new TestConfigurationService();\n\t\tif (autoSaveEnabled) {\n\t\t\tconfigurationService.setUserConfiguration('files', { autoSave: 'afterDelay', autoSaveDelay: 1 });\n\t\t} else {\n\t\t\tconfigurationService.setUserConfiguration('files', { autoSave: 'off', autoSaveDelay: 1 });\n\t\t}\n\t\tinstantiationService.stub(IConfigurationService, configurationService);\n\n\t\tinstantiationService.stub(IFilesConfigurationService, disposables.add(new TestFilesConfigurationService(\n\t\t\t<IContextKeyService>instantiationService.createInstance(MockContextKeyService),\n\t\t\tconfigurationService,\n\t\t\tnew TestContextService(TestWorkspace),\n\t\t\tTestEnvironmentService,\n\t\t\tdisposables.add(new UriIdentityService(disposables.add(new TestFileService()))),\n\t\t\tdisposables.add(new TestFileService()),\n\t\t\tnew TestMarkerService(),\n\t\t\tnew TestTextResourceConfigurationService(configurationService)\n\t\t)));\n\n\t\tconst part = await createEditorPart(instantiationService, disposables);\n\t\tinstantiationService.stub(IEditorGroupsService, part);\n\n\t\tconst editorService: EditorService = disposables.add(instantiationService.createInstance(EditorService, undefined));\n\t\tinstantiationService.stub(IEditorService, editorService);\n\n\t\taccessor = instantiationService.createInstance(TestServiceAccessor);\n\n\t\tconst tracker = instantiationService.createInstance(TestWorkingCopyBackupTracker);\n\n\t\tconst cleanup = async () => {\n\t\t\tawait accessor.workingCopyBackupService.waitForAllBackups(); // File changes could also schedule some backup operations so we need to wait for them before finishing the test\n\n\t\t\tawait workbenchTeardown(instantiationService);\n\n\t\t\tpart.dispose();\n\t\t\ttracker.dispose();\n\t\t};\n\n\t\treturn { accessor, part, tracker, instantiationService, cleanup };\n\t}\n\n\ttest('Track backups (file, auto save off)', function () {\n\t\treturn trackBackupsTest(toResource.call(this, '/path/index.txt'), false);\n\t});\n\n\ttest('Track backups (file, auto save on)', function () {\n\t\treturn trackBackupsTest(toResource.call(this, '/path/index.txt'), true);\n\t});\n\n\tasync function trackBackupsTest(resource: URI, autoSave: boolean) {\n\t\tconst { accessor, cleanup } = await createTracker(autoSave);\n\n\t\tawait accessor.editorService.openEditor({ resource, options: { pinned: true } });\n\n\t\tconst fileModel = accessor.textFileService.files.get(resource);\n\t\tassert.ok(fileModel);\n\t\tfileModel.textEditorModel?.setValue('Super Good');\n\n\t\tawait accessor.workingCopyBackupService.joinBackupResource();\n\n\t\tassert.strictEqual(accessor.workingCopyBackupService.hasBackupSync(fileModel), true);\n\n\t\tfileModel.dispose();\n\n\t\tawait accessor.workingCopyBackupService.joinDiscardBackup();\n\n\t\tassert.strictEqual(accessor.workingCopyBackupService.hasBackupSync(fileModel), false);\n\n\t\tawait cleanup();\n\t}\n\n\ttest('onWillShutdown - no veto if no dirty files', async function () {\n\t\tconst { accessor, cleanup } = await createTracker();\n\n\t\tconst resource = toResource.call(this, '/path/index.txt');\n\t\tawait accessor.editorService.openEditor({ resource, options: { pinned: true } });\n\n\t\tconst event = new TestBeforeShutdownEvent();\n\t\taccessor.lifecycleService.fireBeforeShutdown(event);\n\n\t\tconst veto = await event.value;\n\t\tassert.ok(!veto);\n\n\t\tawait cleanup();\n\t});\n\n\ttest('onWillShutdown - veto if user cancels (hot.exit: off)', async function () {\n\t\tconst { accessor, cleanup } = await createTracker();\n\n\t\tconst resource = toResource.call(this, '/path/index.txt');\n\t\tawait accessor.editorService.openEditor({ resource, options: { pinned: true } });\n\n\t\tconst model = accessor.textFileService.files.get(resource);\n\n\t\taccessor.fileDialogService.setConfirmResult(ConfirmResult.CANCEL);\n\t\taccessor.filesConfigurationService.testOnFilesConfigurationChange({ files: { hotExit: 'off' } });\n\n\t\tawait model?.resolve();\n\t\tmodel?.textEditorModel?.setValue('foo');\n\t\tassert.strictEqual(accessor.workingCopyService.dirtyCount, 1);\n\n\t\tconst event = new TestBeforeShutdownEvent();\n\t\taccessor.lifecycleService.fireBeforeShutdown(event);\n\n\t\tconst veto = await event.value;\n\t\tassert.ok(veto);\n\n\t\tawait cleanup();\n\t});\n\n\ttest('onWillShutdown - no veto if auto save is on', async function () {\n\t\tconst { accessor, cleanup } = await createTracker(true /* auto save enabled */);\n\n\t\tconst resource = toResource.call(this, '/path/index.txt');\n\t\tawait accessor.editorService.openEditor({ resource, options: { pinned: true } });\n\n\t\tconst model = accessor.textFileService.files.get(resource);\n\n\t\tawait model?.resolve();\n\t\tmodel?.textEditorModel?.setValue('foo');\n\t\tassert.strictEqual(accessor.workingCopyService.dirtyCount, 1);\n\n\t\tconst event = new TestBeforeShutdownEvent();\n\t\taccessor.lifecycleService.fireBeforeShutdown(event);\n\n\t\tconst veto = await event.value;\n\t\tassert.ok(!veto);\n\n\t\tassert.strictEqual(accessor.workingCopyService.dirtyCount, 0);\n\n\t\tawait cleanup();\n\t});\n\n\ttest('onWillShutdown - no veto and backups cleaned up if user does not want to save (hot.exit: off)', async function () {\n\t\tconst { accessor, cleanup } = await createTracker();\n\n\t\tconst resource = toResource.call(this, '/path/index.txt');\n\t\tawait accessor.editorService.openEditor({ resource, options: { pinned: true } });\n\n\t\tconst model = accessor.textFileService.files.get(resource);\n\n\t\taccessor.fileDialogService.setConfirmResult(ConfirmResult.DONT_SAVE);\n\t\taccessor.filesConfigurationService.testOnFilesConfigurationChange({ files: { hotExit: 'off' } });\n\n\t\tawait model?.resolve();\n\t\tmodel?.textEditorModel?.setValue('foo');\n\t\tassert.strictEqual(accessor.workingCopyService.dirtyCount, 1);\n\t\tconst event = new TestBeforeShutdownEvent();\n\t\taccessor.lifecycleService.fireBeforeShutdown(event);\n\n\t\tconst veto = await event.value;\n\t\tassert.ok(!veto);\n\t\tassert.ok(accessor.workingCopyBackupService.discardedBackups.length > 0);\n\n\t\tawait cleanup();\n\t});\n\n\ttest('onWillShutdown - no backups discarded when shutdown without dirty but tracker not ready', async function () {\n\t\tconst { accessor, cleanup } = await createTracker();\n\n\t\tconst event = new TestBeforeShutdownEvent();\n\t\taccessor.lifecycleService.fireBeforeShutdown(event);\n\n\t\tconst veto = await event.value;\n\t\tassert.ok(!veto);\n\t\tassert.ok(!accessor.workingCopyBackupService.discardedAllBackups);\n\n\t\tawait cleanup();\n\t});\n\n\ttest('onWillShutdown - backups discarded when shutdown without dirty', async function () {\n\t\tconst { accessor, tracker, cleanup } = await createTracker();\n\n\t\tawait tracker.waitForReady();\n\n\t\tconst event = new TestBeforeShutdownEvent();\n\t\taccessor.lifecycleService.fireBeforeShutdown(event);\n\n\t\tconst veto = await event.value;\n\t\tassert.ok(!veto);\n\t\tassert.ok(accessor.workingCopyBackupService.discardedAllBackups);\n\n\t\tawait cleanup();\n\t});\n\n\ttest('onWillShutdown - save (hot.exit: off)', async function () {\n\t\tconst { accessor, cleanup } = await createTracker();\n\n\t\tconst resource = toResource.call(this, '/path/index.txt');\n\t\tawait accessor.editorService.openEditor({ resource, options: { pinned: true } });\n\n\t\tconst model = accessor.textFileService.files.get(resource);\n\n\t\taccessor.fileDialogService.setConfirmResult(ConfirmResult.SAVE);\n\t\taccessor.filesConfigurationService.testOnFilesConfigurationChange({ files: { hotExit: 'off' } });\n\n\t\tawait model?.resolve();\n\t\tmodel?.textEditorModel?.setValue('foo');\n\t\tassert.strictEqual(accessor.workingCopyService.dirtyCount, 1);\n\t\tconst event = new TestBeforeShutdownEvent();\n\t\taccessor.lifecycleService.fireBeforeShutdown(event);\n\n\t\tconst veto = await event.value;\n\t\tassert.ok(!veto);\n\t\tassert.ok(!model?.isDirty());\n\n\t\tawait cleanup();\n\t});\n\n\ttest('onWillShutdown - veto if backup fails', async function () {\n\t\tconst { accessor, cleanup } = await createTracker();\n\n\t\tclass TestBackupWorkingCopy extends TestWorkingCopy {\n\n\t\t\tconstructor(resource: URI) {\n\t\t\t\tsuper(resource);\n\n\t\t\t\tthis._register(accessor.workingCopyService.registerWorkingCopy(this));\n\t\t\t}\n\n\t\t\toverride async backup(token: CancellationToken): Promise<IWorkingCopyBackup> {\n\t\t\t\tthrow new Error('unable to backup');\n\t\t\t}\n\t\t}\n\n\t\tconst resource = toResource.call(this, '/path/custom.txt');\n\t\tconst customWorkingCopy = disposables.add(new TestBackupWorkingCopy(resource));\n\t\tcustomWorkingCopy.setDirty(true);\n\n\t\tconst event = new TestBeforeShutdownEvent();\n\t\tevent.reason = ShutdownReason.QUIT;\n\t\taccessor.lifecycleService.fireBeforeShutdown(event);\n\n\t\tconst veto = await event.value;\n\t\tassert.ok(veto);\n\n\t\tconst finalVeto = await event.finalValue?.();\n\t\tassert.ok(finalVeto); // assert the tracker uses the internal finalVeto API\n\n\t\tawait cleanup();\n\t});\n\n\ttest('onWillShutdown - scratchpads - veto if backup fails', async function () {\n\t\tconst { accessor, cleanup } = await createTracker();\n\n\t\tclass TestBackupWorkingCopy extends TestWorkingCopy {\n\n\t\t\tconstructor(resource: URI) {\n\t\t\t\tsuper(resource);\n\n\t\t\t\tthis._register(accessor.workingCopyService.registerWorkingCopy(this));\n\t\t\t}\n\n\t\t\toverride capabilities = WorkingCopyCapabilities.Untitled | WorkingCopyCapabilities.Scratchpad;\n\n\t\t\toverride async backup(token: CancellationToken): Promise<IWorkingCopyBackup> {\n\t\t\t\tthrow new Error('unable to backup');\n\t\t\t}\n\n\t\t\toverride isDirty(): boolean {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\toverride isModified(): boolean {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\n\t\tconst resource = toResource.call(this, '/path/custom.txt');\n\t\tdisposables.add(new TestBackupWorkingCopy(resource));\n\n\t\tconst event = new TestBeforeShutdownEvent();\n\t\tevent.reason = ShutdownReason.QUIT;\n\t\taccessor.lifecycleService.fireBeforeShutdown(event);\n\n\t\tconst veto = await event.value;\n\t\tassert.ok(veto);\n\n\t\tconst finalVeto = await event.finalValue?.();\n\t\tassert.ok(finalVeto); // assert the tracker uses the internal finalVeto API\n\n\t\tawait cleanup();\n\t});\n\n\ttest('onWillShutdown - pending backup operations canceled and tracker suspended/resumsed', async function () {\n\t\tconst { accessor, tracker, cleanup } = await createTracker();\n\n\t\tconst resource = toResource.call(this, '/path/index.txt');\n\t\tawait accessor.editorService.openEditor({ resource, options: { pinned: true } });\n\n\t\tconst model = accessor.textFileService.files.get(resource);\n\n\t\tawait model?.resolve();\n\t\tmodel?.textEditorModel?.setValue('foo');\n\t\tassert.strictEqual(accessor.workingCopyService.dirtyCount, 1);\n\t\tassert.strictEqual(tracker.pendingBackupOperationCount, 1);\n\n\t\tconst onSuspend = Event.toPromise(tracker.onDidSuspend);\n\n\t\tconst event = new TestBeforeShutdownEvent();\n\t\tevent.reason = ShutdownReason.QUIT;\n\t\taccessor.lifecycleService.fireBeforeShutdown(event);\n\n\t\tawait onSuspend;\n\n\t\tassert.strictEqual(tracker.pendingBackupOperationCount, 0);\n\n\t\t// Ops are suspended during shutdown!\n\t\tmodel?.textEditorModel?.setValue('bar');\n\t\tassert.strictEqual(accessor.workingCopyService.dirtyCount, 1);\n\t\tassert.strictEqual(tracker.pendingBackupOperationCount, 0);\n\n\t\tconst onResume = Event.toPromise(tracker.onDidResume);\n\t\tawait event.value;\n\n\t\t// Ops are resumed after shutdown!\n\t\tmodel?.textEditorModel?.setValue('foo');\n\t\tawait onResume;\n\t\tassert.strictEqual(tracker.pendingBackupOperationCount, 1);\n\n\t\tawait cleanup();\n\t});\n\n\tsuite('Hot Exit', () => {\n\t\tsuite('\"onExit\" setting', () => {\n\t\t\ttest('should hot exit on non-Mac (reason: CLOSE, windows: single, workspace)', function () {\n\t\t\t\treturn hotExitTest.call(this, HotExitConfiguration.ON_EXIT, ShutdownReason.CLOSE, false, true, !!isMacintosh);\n\t\t\t});\n\t\t\ttest('should hot exit on non-Mac (reason: CLOSE, windows: single, empty workspace)', function () {\n\t\t\t\treturn hotExitTest.call(this, HotExitConfiguration.ON_EXIT, ShutdownReason.CLOSE, false, false, !!isMacintosh);\n\t\t\t});\n\t\t\ttest('should NOT hot exit (reason: CLOSE, windows: multiple, workspace)', function () {\n\t\t\t\treturn hotExitTest.call(this, HotExitConfiguration.ON_EXIT, ShutdownReason.CLOSE, true, true, true);\n\t\t\t});\n\t\t\ttest('should NOT hot exit (reason: CLOSE, windows: multiple, empty workspace)', function () {\n\t\t\t\treturn hotExitTest.call(this, HotExitConfiguration.ON_EXIT, ShutdownReason.CLOSE, true, false, true);\n\t\t\t});\n\t\t\ttest('should hot exit (reason: QUIT, windows: single, workspace)', function () {\n\t\t\t\treturn hotExitTest.call(this, HotExitConfiguration.ON_EXIT, ShutdownReason.QUIT, false, true, false);\n\t\t\t});\n\t\t\ttest('should hot exit (reason: QUIT, windows: single, empty workspace)', function () {\n\t\t\t\treturn hotExitTest.call(this, HotExitConfiguration.ON_EXIT, ShutdownReason.QUIT, false, false, false);\n\t\t\t});\n\t\t\ttest('should hot exit (reason: QUIT, windows: multiple, workspace)', function () {\n\t\t\t\treturn hotExitTest.call(this, HotExitConfiguration.ON_EXIT, ShutdownReason.QUIT, true, true, false);\n\t\t\t});\n\t\t\ttest('should hot exit (reason: QUIT, windows: multiple, empty workspace)', function () {\n\t\t\t\treturn hotExitTest.call(this, HotExitConfiguration.ON_EXIT, ShutdownReason.QUIT, true, false, false);\n\t\t\t});\n\t\t\ttest('should hot exit (reason: RELOAD, windows: single, workspace)', function () {\n\t\t\t\treturn hotExitTest.call(this, HotExitConfiguration.ON_EXIT, ShutdownReason.RELOAD, false, true, false);\n\t\t\t});\n\t\t\ttest('should hot exit (reason: RELOAD, windows: single, empty workspace)', function () {\n\t\t\t\treturn hotExitTest.call(this, HotExitConfiguration.ON_EXIT, ShutdownReason.RELOAD, false, false, false);\n\t\t\t});\n\t\t\ttest('should hot exit (reason: RELOAD, windows: multiple, workspace)', function () {\n\t\t\t\treturn hotExitTest.call(this, HotExitConfiguration.ON_EXIT, ShutdownReason.RELOAD, true, true, false);\n\t\t\t});\n\t\t\ttest('should hot exit (reason: RELOAD, windows: multiple, empty workspace)', function () {\n\t\t\t\treturn hotExitTest.call(this, HotExitConfiguration.ON_EXIT, ShutdownReason.RELOAD, true, false, false);\n\t\t\t});\n\t\t\ttest('should NOT hot exit (reason: LOAD, windows: single, workspace)', function () {\n\t\t\t\treturn hotExitTest.call(this, HotExitConfiguration.ON_EXIT, ShutdownReason.LOAD, false, true, true);\n\t\t\t});\n\t\t\ttest('should NOT hot exit (reason: LOAD, windows: single, empty workspace)', function () {\n\t\t\t\treturn hotExitTest.call(this, HotExitConfiguration.ON_EXIT, ShutdownReason.LOAD, false, false, true);\n\t\t\t});\n\t\t\ttest('should NOT hot exit (reason: LOAD, windows: multiple, workspace)', function () {\n\t\t\t\treturn hotExitTest.call(this, HotExitConfiguration.ON_EXIT, ShutdownReason.LOAD, true, true, true);\n\t\t\t});\n\t\t\ttest('should NOT hot exit (reason: LOAD, windows: multiple, empty workspace)', function () {\n\t\t\t\treturn hotExitTest.call(this, HotExitConfiguration.ON_EXIT, ShutdownReason.LOAD, true, false, true);\n\t\t\t});\n\t\t});\n\n\t\tsuite('\"onExitAndWindowClose\" setting', () => {\n\t\t\ttest('should hot exit (reason: CLOSE, windows: single, workspace)', function () {\n\t\t\t\treturn hotExitTest.call(this, HotExitConfiguration.ON_EXIT_AND_WINDOW_CLOSE, ShutdownReason.CLOSE, false, true, false);\n\t\t\t});\n\t\t\ttest('should hot exit (reason: CLOSE, windows: single, empty workspace)', function () {\n\t\t\t\treturn hotExitTest.call(this, HotExitConfiguration.ON_EXIT_AND_WINDOW_CLOSE, ShutdownReason.CLOSE, false, false, !!isMacintosh);\n\t\t\t});\n\t\t\ttest('should hot exit (reason: CLOSE, windows: multiple, workspace)', function () {\n\t\t\t\treturn hotExitTest.call(this, HotExitConfiguration.ON_EXIT_AND_WINDOW_CLOSE, ShutdownReason.CLOSE, true, true, false);\n\t\t\t});\n\t\t\ttest('should NOT hot exit (reason: CLOSE, windows: multiple, empty workspace)', function () {\n\t\t\t\treturn hotExitTest.call(this, HotExitConfiguration.ON_EXIT_AND_WINDOW_CLOSE, ShutdownReason.CLOSE, true, false, true);\n\t\t\t});\n\t\t\ttest('should hot exit (reason: QUIT, windows: single, workspace)', function () {\n\t\t\t\treturn hotExitTest.call(this, HotExitConfiguration.ON_EXIT_AND_WINDOW_CLOSE, ShutdownReason.QUIT, false, true, false);\n\t\t\t});\n\t\t\ttest('should hot exit (reason: QUIT, windows: single, empty workspace)', function () {\n\t\t\t\treturn hotExitTest.call(this, HotExitConfiguration.ON_EXIT_AND_WINDOW_CLOSE, ShutdownReason.QUIT, false, false, false);\n\t\t\t});\n\t\t\ttest('should hot exit (reason: QUIT, windows: multiple, workspace)', function () {\n\t\t\t\treturn hotExitTest.call(this, HotExitConfiguration.ON_EXIT_AND_WINDOW_CLOSE, ShutdownReason.QUIT, true, true, false);\n\t\t\t});\n\t\t\ttest('should hot exit (reason: QUIT, windows: multiple, empty workspace)', function () {\n\t\t\t\treturn hotExitTest.call(this, HotExitConfiguration.ON_EXIT_AND_WINDOW_CLOSE, ShutdownReason.QUIT, true, false, false);\n\t\t\t});\n\t\t\ttest('should hot exit (reason: RELOAD, windows: single, workspace)', function () {\n\t\t\t\treturn hotExitTest.call(this, HotExitConfiguration.ON_EXIT_AND_WINDOW_CLOSE, ShutdownReason.RELOAD, false, true, false);\n\t\t\t});\n\t\t\ttest('should hot exit (reason: RELOAD, windows: single, empty workspace)', function () {\n\t\t\t\treturn hotExitTest.call(this, HotExitConfiguration.ON_EXIT_AND_WINDOW_CLOSE, ShutdownReason.RELOAD, false, false, false);\n\t\t\t});\n\t\t\ttest('should hot exit (reason: RELOAD, windows: multiple, workspace)', function () {\n\t\t\t\treturn hotExitTest.call(this, HotExitConfiguration.ON_EXIT_AND_WINDOW_CLOSE, ShutdownReason.RELOAD, true, true, false);\n\t\t\t});\n\t\t\ttest('should hot exit (reason: RELOAD, windows: multiple, empty workspace)', function () {\n\t\t\t\treturn hotExitTest.call(this, HotExitConfiguration.ON_EXIT_AND_WINDOW_CLOSE, ShutdownReason.RELOAD, true, false, false);\n\t\t\t});\n\t\t\ttest('should hot exit (reason: LOAD, windows: single, workspace)', function () {\n\t\t\t\treturn hotExitTest.call(this, HotExitConfiguration.ON_EXIT_AND_WINDOW_CLOSE, ShutdownReason.LOAD, false, true, false);\n\t\t\t});\n\t\t\ttest('should NOT hot exit (reason: LOAD, windows: single, empty workspace)', function () {\n\t\t\t\treturn hotExitTest.call(this, HotExitConfiguration.ON_EXIT_AND_WINDOW_CLOSE, ShutdownReason.LOAD, false, false, true);\n\t\t\t});\n\t\t\ttest('should hot exit (reason: LOAD, windows: multiple, workspace)', function () {\n\t\t\t\treturn hotExitTest.call(this, HotExitConfiguration.ON_EXIT_AND_WINDOW_CLOSE, ShutdownReason.LOAD, true, true, false);\n\t\t\t});\n\t\t\ttest('should NOT hot exit (reason: LOAD, windows: multiple, empty workspace)', function () {\n\t\t\t\treturn hotExitTest.call(this, HotExitConfiguration.ON_EXIT_AND_WINDOW_CLOSE, ShutdownReason.LOAD, true, false, true);\n\t\t\t});\n\t\t});\n\n\t\tsuite('\"onExit\" setting - scratchpad', () => {\n\t\t\ttest('should hot exit (reason: CLOSE, windows: single, workspace)', function () {\n\t\t\t\treturn scratchpadHotExitTest.call(this, HotExitConfiguration.ON_EXIT, ShutdownReason.CLOSE, false, true, false);\n\t\t\t});\n\t\t\ttest('should hot exit (reason: CLOSE, windows: single, empty workspace)', function () {\n\t\t\t\treturn scratchpadHotExitTest.call(this, HotExitConfiguration.ON_EXIT, ShutdownReason.CLOSE, false, false, !!isMacintosh);\n\t\t\t});\n\t\t\ttest('should hot exit (reason: CLOSE, windows: multiple, workspace)', function () {\n\t\t\t\treturn scratchpadHotExitTest.call(this, HotExitConfiguration.ON_EXIT, ShutdownReason.CLOSE, true, true, false);\n\t\t\t});\n\t\t\ttest('should NOT hot exit (reason: CLOSE, windows: multiple, empty workspace)', function () {\n\t\t\t\treturn scratchpadHotExitTest.call(this, HotExitConfiguration.ON_EXIT, ShutdownReason.CLOSE, true, false, true);\n\t\t\t});\n\t\t\ttest('should hot exit (reason: QUIT, windows: single, workspace)', function () {\n\t\t\t\treturn scratchpadHotExitTest.call(this, HotExitConfiguration.ON_EXIT, ShutdownReason.QUIT, false, true, false);\n\t\t\t});\n\t\t\ttest('should hot exit (reason: QUIT, windows: single, empty workspace)', function () {\n\t\t\t\treturn scratchpadHotExitTest.call(this, HotExitConfiguration.ON_EXIT, ShutdownReason.QUIT, false, false, false);\n\t\t\t});\n\t\t\ttest('should hot exit (reason: QUIT, windows: multiple, workspace)', function () {\n\t\t\t\treturn scratchpadHotExitTest.call(this, HotExitConfiguration.ON_EXIT, ShutdownReason.QUIT, true, true, false);\n\t\t\t});\n\t\t\ttest('should hot exit (reason: QUIT, windows: multiple, empty workspace)', function () {\n\t\t\t\treturn scratchpadHotExitTest.call(this, HotExitConfiguration.ON_EXIT, ShutdownReason.QUIT, true, false, false);\n\t\t\t});\n\t\t\ttest('should hot exit (reason: RELOAD, windows: single, workspace)', function () {\n\t\t\t\treturn scratchpadHotExitTest.call(this, HotExitConfiguration.ON_EXIT, ShutdownReason.RELOAD, false, true, false);\n\t\t\t});\n\t\t\ttest('should hot exit (reason: RELOAD, windows: single, empty workspace)', function () {\n\t\t\t\treturn scratchpadHotExitTest.call(this, HotExitConfiguration.ON_EXIT, ShutdownReason.RELOAD, false, false, false);\n\t\t\t});\n\t\t\ttest('should hot exit (reason: RELOAD, windows: multiple, workspace)', function () {\n\t\t\t\treturn scratchpadHotExitTest.call(this, HotExitConfiguration.ON_EXIT, ShutdownReason.RELOAD, true, true, false);\n\t\t\t});\n\t\t\ttest('should hot exit (reason: RELOAD, windows: multiple, empty workspace)', function () {\n\t\t\t\treturn scratchpadHotExitTest.call(this, HotExitConfiguration.ON_EXIT, ShutdownReason.RELOAD, true, false, false);\n\t\t\t});\n\t\t\ttest('should hot exit (reason: LOAD, windows: single, workspace)', function () {\n\t\t\t\treturn scratchpadHotExitTest.call(this, HotExitConfiguration.ON_EXIT, ShutdownReason.LOAD, false, true, false);\n\t\t\t});\n\t\t\ttest('should NOT hot exit (reason: LOAD, windows: single, empty workspace)', function () {\n\t\t\t\treturn scratchpadHotExitTest.call(this, HotExitConfiguration.ON_EXIT, ShutdownReason.LOAD, false, false, true);\n\t\t\t});\n\t\t\ttest('should hot exit (reason: LOAD, windows: multiple, workspace)', function () {\n\t\t\t\treturn scratchpadHotExitTest.call(this, HotExitConfiguration.ON_EXIT, ShutdownReason.LOAD, true, true, false);\n\t\t\t});\n\t\t\ttest('should NOT hot exit (reason: LOAD, windows: multiple, empty workspace)', function () {\n\t\t\t\treturn scratchpadHotExitTest.call(this, HotExitConfiguration.ON_EXIT, ShutdownReason.LOAD, true, false, true);\n\t\t\t});\n\t\t});\n\n\t\tsuite('\"onExitAndWindowClose\" setting - scratchpad', () => {\n\t\t\ttest('should hot exit (reason: CLOSE, windows: single, workspace)', function () {\n\t\t\t\treturn scratchpadHotExitTest.call(this, HotExitConfiguration.ON_EXIT_AND_WINDOW_CLOSE, ShutdownReason.CLOSE, false, true, false);\n\t\t\t});\n\t\t\ttest('should hot exit (reason: CLOSE, windows: single, empty workspace)', function () {\n\t\t\t\treturn scratchpadHotExitTest.call(this, HotExitConfiguration.ON_EXIT_AND_WINDOW_CLOSE, ShutdownReason.CLOSE, false, false, !!isMacintosh);\n\t\t\t});\n\t\t\ttest('should hot exit (reason: CLOSE, windows: multiple, workspace)', function () {\n\t\t\t\treturn scratchpadHotExitTest.call(this, HotExitConfiguration.ON_EXIT_AND_WINDOW_CLOSE, ShutdownReason.CLOSE, true, true, false);\n\t\t\t});\n\t\t\ttest('should NOT hot exit (reason: CLOSE, windows: multiple, empty workspace)', function () {\n\t\t\t\treturn scratchpadHotExitTest.call(this, HotExitConfiguration.ON_EXIT_AND_WINDOW_CLOSE, ShutdownReason.CLOSE, true, false, true);\n\t\t\t});\n\t\t\ttest('should hot exit (reason: QUIT, windows: single, workspace)', function () {\n\t\t\t\treturn scratchpadHotExitTest.call(this, HotExitConfiguration.ON_EXIT_AND_WINDOW_CLOSE, ShutdownReason.QUIT, false, true, false);\n\t\t\t});\n\t\t\ttest('should hot exit (reason: QUIT, windows: single, empty workspace)', function () {\n\t\t\t\treturn scratchpadHotExitTest.call(this, HotExitConfiguration.ON_EXIT_AND_WINDOW_CLOSE, ShutdownReason.QUIT, false, false, false);\n\t\t\t});\n\t\t\ttest('should hot exit (reason: QUIT, windows: multiple, workspace)', function () {\n\t\t\t\treturn scratchpadHotExitTest.call(this, HotExitConfiguration.ON_EXIT_AND_WINDOW_CLOSE, ShutdownReason.QUIT, true, true, false);\n\t\t\t});\n\t\t\ttest('should hot exit (reason: QUIT, windows: multiple, empty workspace)', function () {\n\t\t\t\treturn scratchpadHotExitTest.call(this, HotExitConfiguration.ON_EXIT_AND_WINDOW_CLOSE, ShutdownReason.QUIT, true, false, false);\n\t\t\t});\n\t\t\ttest('should hot exit (reason: RELOAD, windows: single, workspace)', function () {\n\t\t\t\treturn scratchpadHotExitTest.call(this, HotExitConfiguration.ON_EXIT_AND_WINDOW_CLOSE, ShutdownReason.RELOAD, false, true, false);\n\t\t\t});\n\t\t\ttest('should hot exit (reason: RELOAD, windows: single, empty workspace)', function () {\n\t\t\t\treturn scratchpadHotExitTest.call(this, HotExitConfiguration.ON_EXIT_AND_WINDOW_CLOSE, ShutdownReason.RELOAD, false, false, false);\n\t\t\t});\n\t\t\ttest('should hot exit (reason: RELOAD, windows: multiple, workspace)', function () {\n\t\t\t\treturn scratchpadHotExitTest.call(this, HotExitConfiguration.ON_EXIT_AND_WINDOW_CLOSE, ShutdownReason.RELOAD, true, true, false);\n\t\t\t});\n\t\t\ttest('should hot exit (reason: RELOAD, windows: multiple, empty workspace)', function () {\n\t\t\t\treturn scratchpadHotExitTest.call(this, HotExitConfiguration.ON_EXIT_AND_WINDOW_CLOSE, ShutdownReason.RELOAD, true, false, false);\n\t\t\t});\n\t\t\ttest('should hot exit (reason: LOAD, windows: single, workspace)', function () {\n\t\t\t\treturn scratchpadHotExitTest.call(this, HotExitConfiguration.ON_EXIT_AND_WINDOW_CLOSE, ShutdownReason.LOAD, false, true, false);\n\t\t\t});\n\t\t\ttest('should NOT hot exit (reason: LOAD, windows: single, empty workspace)', function () {\n\t\t\t\treturn scratchpadHotExitTest.call(this, HotExitConfiguration.ON_EXIT_AND_WINDOW_CLOSE, ShutdownReason.LOAD, false, false, true);\n\t\t\t});\n\t\t\ttest('should hot exit (reason: LOAD, windows: multiple, workspace)', function () {\n\t\t\t\treturn scratchpadHotExitTest.call(this, HotExitConfiguration.ON_EXIT_AND_WINDOW_CLOSE, ShutdownReason.LOAD, true, true, false);\n\t\t\t});\n\t\t\ttest('should NOT hot exit (reason: LOAD, windows: multiple, empty workspace)', function () {\n\t\t\t\treturn scratchpadHotExitTest.call(this, HotExitConfiguration.ON_EXIT_AND_WINDOW_CLOSE, ShutdownReason.LOAD, true, false, true);\n\t\t\t});\n\t\t});\n\n\n\t\tasync function hotExitTest(this: any, setting: string, shutdownReason: ShutdownReason, multipleWindows: boolean, workspace: boolean, shouldVeto: boolean): Promise<void> {\n\t\t\tconst { accessor, cleanup } = await createTracker();\n\n\t\t\tconst resource = toResource.call(this, '/path/index.txt');\n\t\t\tawait accessor.editorService.openEditor({ resource, options: { pinned: true } });\n\n\t\t\tconst model = accessor.textFileService.files.get(resource);\n\n\t\t\t// Set hot exit config\n\t\t\taccessor.filesConfigurationService.testOnFilesConfigurationChange({ files: { hotExit: setting } });\n\n\t\t\t// Set empty workspace if required\n\t\t\tif (!workspace) {\n\t\t\t\taccessor.contextService.setWorkspace(new Workspace('empty:1508317022751'));\n\t\t\t}\n\n\t\t\t// Set multiple windows if required\n\t\t\tif (multipleWindows) {\n\t\t\t\taccessor.nativeHostService.windowCount = Promise.resolve(2);\n\t\t\t}\n\n\t\t\t// Set cancel to force a veto if hot exit does not trigger\n\t\t\taccessor.fileDialogService.setConfirmResult(ConfirmResult.CANCEL);\n\n\t\t\tawait model?.resolve();\n\t\t\tmodel?.textEditorModel?.setValue('foo');\n\t\t\tassert.strictEqual(accessor.workingCopyService.dirtyCount, 1);\n\n\t\t\tconst event = new TestBeforeShutdownEvent();\n\t\t\tevent.reason = shutdownReason;\n\t\t\taccessor.lifecycleService.fireBeforeShutdown(event);\n\n\t\t\tconst veto = await event.value;\n\t\t\tassert.ok(typeof event.finalValue === 'function'); // assert the tracker uses the internal finalVeto API\n\t\t\tassert.strictEqual(accessor.workingCopyBackupService.discardedBackups.length, 0); // When hot exit is set, backups should never be cleaned since the confirm result is cancel\n\t\t\tassert.strictEqual(veto, shouldVeto);\n\n\t\t\tawait cleanup();\n\t\t}\n\n\t\tasync function scratchpadHotExitTest(this: any, setting: string, shutdownReason: ShutdownReason, multipleWindows: boolean, workspace: boolean, shouldVeto: boolean): Promise<void> {\n\t\t\tconst { accessor, cleanup } = await createTracker();\n\n\t\t\tclass TestBackupWorkingCopy extends TestWorkingCopy {\n\n\t\t\t\tconstructor(resource: URI) {\n\t\t\t\t\tsuper(resource);\n\n\t\t\t\t\tthis._register(accessor.workingCopyService.registerWorkingCopy(this));\n\t\t\t\t}\n\n\t\t\t\toverride capabilities = WorkingCopyCapabilities.Untitled | WorkingCopyCapabilities.Scratchpad;\n\n\t\t\t\toverride isDirty(): boolean {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\toverride isModified(): boolean {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Set hot exit config\n\t\t\taccessor.filesConfigurationService.testOnFilesConfigurationChange({ files: { hotExit: setting } });\n\n\t\t\t// Set empty workspace if required\n\t\t\tif (!workspace) {\n\t\t\t\taccessor.contextService.setWorkspace(new Workspace('empty:1508317022751'));\n\t\t\t}\n\n\t\t\t// Set multiple windows if required\n\t\t\tif (multipleWindows) {\n\t\t\t\taccessor.nativeHostService.windowCount = Promise.resolve(2);\n\t\t\t}\n\n\t\t\t// Set cancel to force a veto if hot exit does not trigger\n\t\t\taccessor.fileDialogService.setConfirmResult(ConfirmResult.CANCEL);\n\n\t\t\tconst resource = toResource.call(this, '/path/custom.txt');\n\t\t\tdisposables.add(new TestBackupWorkingCopy(resource));\n\n\t\t\tconst event = new TestBeforeShutdownEvent();\n\t\t\tevent.reason = shutdownReason;\n\t\t\taccessor.lifecycleService.fireBeforeShutdown(event);\n\n\t\t\tconst veto = await event.value;\n\t\t\tassert.ok(typeof event.finalValue === 'function'); // assert the tracker uses the internal finalVeto API\n\t\t\tassert.strictEqual(accessor.workingCopyBackupService.discardedBackups.length, 0); // When hot exit is set, backups should never be cleaned since the confirm result is cancel\n\t\t\tassert.strictEqual(veto, shouldVeto);\n\n\t\t\tawait cleanup();\n\t\t}\n\t});\n\n\tensureNoDisposablesAreLeakedInTestSuite();\n});\n"]}