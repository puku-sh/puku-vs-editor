{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/services/workingCopy/common/resourceWorkingCopy.ts","vs/workbench/services/workingCopy/common/resourceWorkingCopy.ts"],"names":[],"mappings":"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","file":"resourceWorkingCopy.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { timeout } from '../../../../base/common/async.js';\nimport { CancellationToken } from '../../../../base/common/cancellation.js';\nimport { Event, Emitter } from '../../../../base/common/event.js';\nimport { Disposable, IDisposable } from '../../../../base/common/lifecycle.js';\nimport { URI } from '../../../../base/common/uri.js';\nimport { FileChangesEvent, FileChangeType, IFileService } from '../../../../platform/files/common/files.js';\nimport { ISaveOptions, IRevertOptions } from '../../../common/editor.js';\nimport { IWorkingCopy, IWorkingCopyBackup, IWorkingCopySaveEvent, WorkingCopyCapabilities } from './workingCopy.js';\n\n/**\n * A resource based `IWorkingCopy` is backed by a `URI` from a\n * known file system provider.\n */\nexport interface IResourceWorkingCopy extends IWorkingCopy, IDisposable {\n\n\t/**\n\t * An event for when the orphaned state of the resource working copy changes.\n\t */\n\treadonly onDidChangeOrphaned: Event<void>;\n\n\t/**\n\t * Whether the resource working copy is orphaned or not.\n\t */\n\tisOrphaned(): boolean;\n\n\t/**\n\t * An event for when the file working copy has been disposed.\n\t */\n\treadonly onWillDispose: Event<void>;\n\n\t/**\n\t * Whether the file working copy has been disposed or not.\n\t */\n\tisDisposed(): boolean;\n}\n\nexport abstract class ResourceWorkingCopy extends Disposable implements IResourceWorkingCopy {\n\n\tconstructor(\n\t\treadonly resource: URI,\n\t\t@IFileService protected readonly fileService: IFileService\n\t) {\n\t\tsuper();\n\n\t\tthis._register(this.fileService.onDidFilesChange(e => this.onDidFilesChange(e)));\n\t}\n\n\t//#region Orphaned Tracking\n\n\tprivate readonly _onDidChangeOrphaned = this._register(new Emitter<void>());\n\treadonly onDidChangeOrphaned = this._onDidChangeOrphaned.event;\n\n\tprivate orphaned = false;\n\n\tisOrphaned(): boolean {\n\t\treturn this.orphaned;\n\t}\n\n\tprivate async onDidFilesChange(e: FileChangesEvent): Promise<void> {\n\t\tlet fileEventImpactsUs = false;\n\t\tlet newInOrphanModeGuess: boolean | undefined;\n\n\t\t// If we are currently orphaned, we check if the file was added back\n\t\tif (this.orphaned) {\n\t\t\tconst fileWorkingCopyResourceAdded = e.contains(this.resource, FileChangeType.ADDED);\n\t\t\tif (fileWorkingCopyResourceAdded) {\n\t\t\t\tnewInOrphanModeGuess = false;\n\t\t\t\tfileEventImpactsUs = true;\n\t\t\t}\n\t\t}\n\n\t\t// Otherwise we check if the file was deleted\n\t\telse {\n\t\t\tconst fileWorkingCopyResourceDeleted = e.contains(this.resource, FileChangeType.DELETED);\n\t\t\tif (fileWorkingCopyResourceDeleted) {\n\t\t\t\tnewInOrphanModeGuess = true;\n\t\t\t\tfileEventImpactsUs = true;\n\t\t\t}\n\t\t}\n\n\t\tif (fileEventImpactsUs && this.orphaned !== newInOrphanModeGuess) {\n\t\t\tlet newInOrphanModeValidated = false;\n\t\t\tif (newInOrphanModeGuess) {\n\n\t\t\t\t// We have received reports of users seeing delete events even though the file still\n\t\t\t\t// exists (network shares issue: https://github.com/microsoft/vscode/issues/13665).\n\t\t\t\t// Since we do not want to mark the working copy as orphaned, we have to check if the\n\t\t\t\t// file is really gone and not just a faulty file event.\n\t\t\t\tawait timeout(100, CancellationToken.None);\n\n\t\t\t\tif (this.isDisposed()) {\n\t\t\t\t\tnewInOrphanModeValidated = true;\n\t\t\t\t} else {\n\t\t\t\t\tconst exists = await this.fileService.exists(this.resource);\n\t\t\t\t\tnewInOrphanModeValidated = !exists;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (this.orphaned !== newInOrphanModeValidated && !this.isDisposed()) {\n\t\t\t\tthis.setOrphaned(newInOrphanModeValidated);\n\t\t\t}\n\t\t}\n\t}\n\n\tprotected setOrphaned(orphaned: boolean): void {\n\t\tif (this.orphaned !== orphaned) {\n\t\t\tthis.orphaned = orphaned;\n\n\t\t\tthis._onDidChangeOrphaned.fire();\n\t\t}\n\t}\n\n\t//#endregion\n\n\n\t//#region Dispose\n\n\tprivate readonly _onWillDispose = this._register(new Emitter<void>());\n\treadonly onWillDispose = this._onWillDispose.event;\n\n\tisDisposed(): boolean {\n\t\treturn this._store.isDisposed;\n\t}\n\n\toverride dispose(): void {\n\n\t\t// State\n\t\tthis.orphaned = false;\n\n\t\t// Event\n\t\tthis._onWillDispose.fire();\n\n\t\tsuper.dispose();\n\t}\n\n\t//#endregion\n\n\t//#region Modified Tracking\n\n\tisModified(): boolean {\n\t\treturn this.isDirty();\n\t}\n\n\t//#endregion\n\n\t//#region Abstract\n\n\tabstract typeId: string;\n\tabstract name: string;\n\tabstract capabilities: WorkingCopyCapabilities;\n\n\tabstract onDidChangeDirty: Event<void>;\n\tabstract onDidChangeContent: Event<void>;\n\tabstract onDidSave: Event<IWorkingCopySaveEvent>;\n\n\tabstract isDirty(): boolean;\n\n\tabstract backup(token: CancellationToken): Promise<IWorkingCopyBackup>;\n\tabstract save(options?: ISaveOptions): Promise<boolean>;\n\tabstract revert(options?: IRevertOptions): Promise<void>;\n\n\t//#endregion\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { timeout } from '../../../../base/common/async.js';\nimport { CancellationToken } from '../../../../base/common/cancellation.js';\nimport { Event, Emitter } from '../../../../base/common/event.js';\nimport { Disposable, IDisposable } from '../../../../base/common/lifecycle.js';\nimport { URI } from '../../../../base/common/uri.js';\nimport { FileChangesEvent, FileChangeType, IFileService } from '../../../../platform/files/common/files.js';\nimport { ISaveOptions, IRevertOptions } from '../../../common/editor.js';\nimport { IWorkingCopy, IWorkingCopyBackup, IWorkingCopySaveEvent, WorkingCopyCapabilities } from './workingCopy.js';\n\n/**\n * A resource based `IWorkingCopy` is backed by a `URI` from a\n * known file system provider.\n */\nexport interface IResourceWorkingCopy extends IWorkingCopy, IDisposable {\n\n\t/**\n\t * An event for when the orphaned state of the resource working copy changes.\n\t */\n\treadonly onDidChangeOrphaned: Event<void>;\n\n\t/**\n\t * Whether the resource working copy is orphaned or not.\n\t */\n\tisOrphaned(): boolean;\n\n\t/**\n\t * An event for when the file working copy has been disposed.\n\t */\n\treadonly onWillDispose: Event<void>;\n\n\t/**\n\t * Whether the file working copy has been disposed or not.\n\t */\n\tisDisposed(): boolean;\n}\n\nexport abstract class ResourceWorkingCopy extends Disposable implements IResourceWorkingCopy {\n\n\tconstructor(\n\t\treadonly resource: URI,\n\t\t@IFileService protected readonly fileService: IFileService\n\t) {\n\t\tsuper();\n\n\t\tthis._register(this.fileService.onDidFilesChange(e => this.onDidFilesChange(e)));\n\t}\n\n\t//#region Orphaned Tracking\n\n\tprivate readonly _onDidChangeOrphaned = this._register(new Emitter<void>());\n\treadonly onDidChangeOrphaned = this._onDidChangeOrphaned.event;\n\n\tprivate orphaned = false;\n\n\tisOrphaned(): boolean {\n\t\treturn this.orphaned;\n\t}\n\n\tprivate async onDidFilesChange(e: FileChangesEvent): Promise<void> {\n\t\tlet fileEventImpactsUs = false;\n\t\tlet newInOrphanModeGuess: boolean | undefined;\n\n\t\t// If we are currently orphaned, we check if the file was added back\n\t\tif (this.orphaned) {\n\t\t\tconst fileWorkingCopyResourceAdded = e.contains(this.resource, FileChangeType.ADDED);\n\t\t\tif (fileWorkingCopyResourceAdded) {\n\t\t\t\tnewInOrphanModeGuess = false;\n\t\t\t\tfileEventImpactsUs = true;\n\t\t\t}\n\t\t}\n\n\t\t// Otherwise we check if the file was deleted\n\t\telse {\n\t\t\tconst fileWorkingCopyResourceDeleted = e.contains(this.resource, FileChangeType.DELETED);\n\t\t\tif (fileWorkingCopyResourceDeleted) {\n\t\t\t\tnewInOrphanModeGuess = true;\n\t\t\t\tfileEventImpactsUs = true;\n\t\t\t}\n\t\t}\n\n\t\tif (fileEventImpactsUs && this.orphaned !== newInOrphanModeGuess) {\n\t\t\tlet newInOrphanModeValidated = false;\n\t\t\tif (newInOrphanModeGuess) {\n\n\t\t\t\t// We have received reports of users seeing delete events even though the file still\n\t\t\t\t// exists (network shares issue: https://github.com/microsoft/vscode/issues/13665).\n\t\t\t\t// Since we do not want to mark the working copy as orphaned, we have to check if the\n\t\t\t\t// file is really gone and not just a faulty file event.\n\t\t\t\tawait timeout(100, CancellationToken.None);\n\n\t\t\t\tif (this.isDisposed()) {\n\t\t\t\t\tnewInOrphanModeValidated = true;\n\t\t\t\t} else {\n\t\t\t\t\tconst exists = await this.fileService.exists(this.resource);\n\t\t\t\t\tnewInOrphanModeValidated = !exists;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (this.orphaned !== newInOrphanModeValidated && !this.isDisposed()) {\n\t\t\t\tthis.setOrphaned(newInOrphanModeValidated);\n\t\t\t}\n\t\t}\n\t}\n\n\tprotected setOrphaned(orphaned: boolean): void {\n\t\tif (this.orphaned !== orphaned) {\n\t\t\tthis.orphaned = orphaned;\n\n\t\t\tthis._onDidChangeOrphaned.fire();\n\t\t}\n\t}\n\n\t//#endregion\n\n\n\t//#region Dispose\n\n\tprivate readonly _onWillDispose = this._register(new Emitter<void>());\n\treadonly onWillDispose = this._onWillDispose.event;\n\n\tisDisposed(): boolean {\n\t\treturn this._store.isDisposed;\n\t}\n\n\toverride dispose(): void {\n\n\t\t// State\n\t\tthis.orphaned = false;\n\n\t\t// Event\n\t\tthis._onWillDispose.fire();\n\n\t\tsuper.dispose();\n\t}\n\n\t//#endregion\n\n\t//#region Modified Tracking\n\n\tisModified(): boolean {\n\t\treturn this.isDirty();\n\t}\n\n\t//#endregion\n\n\t//#region Abstract\n\n\tabstract typeId: string;\n\tabstract name: string;\n\tabstract capabilities: WorkingCopyCapabilities;\n\n\tabstract onDidChangeDirty: Event<void>;\n\tabstract onDidChangeContent: Event<void>;\n\tabstract onDidSave: Event<IWorkingCopySaveEvent>;\n\n\tabstract isDirty(): boolean;\n\n\tabstract backup(token: CancellationToken): Promise<IWorkingCopyBackup>;\n\tabstract save(options?: ISaveOptions): Promise<boolean>;\n\tabstract revert(options?: IRevertOptions): Promise<void>;\n\n\t//#endregion\n}\n"]}