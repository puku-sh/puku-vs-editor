{"version":3,"sources":["vs/workbench/services/workingCopy/common/fileWorkingCopyManager.ts"],"names":[],"mappings":"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","file":"fileWorkingCopyManager.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { localize } from '../../../../nls.js';\nimport { Emitter, Event } from '../../../../base/common/event.js';\nimport { Promises } from '../../../../base/common/async.js';\nimport { VSBufferReadableStream } from '../../../../base/common/buffer.js';\nimport { CancellationToken } from '../../../../base/common/cancellation.js';\nimport { Disposable } from '../../../../base/common/lifecycle.js';\nimport { toLocalResource, joinPath, isEqual, basename, dirname } from '../../../../base/common/resources.js';\nimport { URI } from '../../../../base/common/uri.js';\nimport { IFileDialogService, IDialogService } from '../../../../platform/dialogs/common/dialogs.js';\nimport { IFileService } from '../../../../platform/files/common/files.js';\nimport { ISaveOptions, SaveSourceRegistry } from '../../../common/editor.js';\nimport { IWorkbenchEnvironmentService } from '../../environment/common/environmentService.js';\nimport { IPathService } from '../../path/common/pathService.js';\nimport { IUriIdentityService } from '../../../../platform/uriIdentity/common/uriIdentity.js';\nimport { IStoredFileWorkingCopy, IStoredFileWorkingCopyModel, IStoredFileWorkingCopyModelFactory, IStoredFileWorkingCopyResolveOptions, StoredFileWorkingCopyState } from './storedFileWorkingCopy.js';\nimport { StoredFileWorkingCopyManager, IStoredFileWorkingCopyManager, IStoredFileWorkingCopyManagerResolveOptions } from './storedFileWorkingCopyManager.js';\nimport { IUntitledFileWorkingCopy, IUntitledFileWorkingCopyModel, IUntitledFileWorkingCopyModelFactory, UntitledFileWorkingCopy } from './untitledFileWorkingCopy.js';\nimport { INewOrExistingUntitledFileWorkingCopyOptions, INewUntitledFileWorkingCopyOptions, INewUntitledFileWorkingCopyWithAssociatedResourceOptions, IUntitledFileWorkingCopyManager, UntitledFileWorkingCopyManager } from './untitledFileWorkingCopyManager.js';\nimport { IWorkingCopyFileService } from './workingCopyFileService.js';\nimport { IBaseFileWorkingCopyManager } from './abstractFileWorkingCopyManager.js';\nimport { IFileWorkingCopy, SnapshotContext } from './fileWorkingCopy.js';\nimport { ILabelService } from '../../../../platform/label/common/label.js';\nimport { ILogService } from '../../../../platform/log/common/log.js';\nimport { INotificationService } from '../../../../platform/notification/common/notification.js';\nimport { IEditorService } from '../../editor/common/editorService.js';\nimport { IElevatedFileService } from '../../files/common/elevatedFileService.js';\nimport { IFilesConfigurationService } from '../../filesConfiguration/common/filesConfigurationService.js';\nimport { ILifecycleService } from '../../lifecycle/common/lifecycle.js';\nimport { IWorkingCopyBackupService } from './workingCopyBackup.js';\nimport { IWorkingCopyEditorService } from './workingCopyEditorService.js';\nimport { IWorkingCopyService } from './workingCopyService.js';\nimport { Schemas } from '../../../../base/common/network.js';\nimport { IDecorationData, IDecorationsProvider, IDecorationsService } from '../../decorations/common/decorations.js';\nimport { Codicon } from '../../../../base/common/codicons.js';\nimport { listErrorForeground } from '../../../../platform/theme/common/colorRegistry.js';\nimport { IProgressService } from '../../../../platform/progress/common/progress.js';\n\nexport interface IFileWorkingCopyManager<S extends IStoredFileWorkingCopyModel, U extends IUntitledFileWorkingCopyModel> extends IBaseFileWorkingCopyManager<S | U, IFileWorkingCopy<S | U>> {\n\n\t/**\n\t * Provides access to the manager for stored file working copies.\n\t */\n\treadonly stored: IStoredFileWorkingCopyManager<S>;\n\n\t/**\n\t * Provides access to the manager for untitled file working copies.\n\t */\n\treadonly untitled: IUntitledFileWorkingCopyManager<U>;\n\n\t/**\n\t * Allows to resolve a stored file working copy. If the manager already knows\n\t * about a stored file working copy with the same `URI`, it will return that\n\t * existing stored file working copy. There will never be more than one\n\t * stored file working copy per `URI` until the stored file working copy is\n\t * disposed.\n\t *\n\t * Use the `IStoredFileWorkingCopyResolveOptions.reload` option to control the\n\t * behaviour for when a stored file working copy was previously already resolved\n\t * with regards to resolving it again from the underlying file resource\n\t * or not.\n\t *\n\t * Note: Callers must `dispose` the working copy when no longer needed.\n\t *\n\t * @param resource used as unique identifier of the stored file working copy in\n\t * case one is already known for this `URI`.\n\t * @param options\n\t */\n\tresolve(resource: URI, options?: IStoredFileWorkingCopyManagerResolveOptions): Promise<IStoredFileWorkingCopy<S>>;\n\n\t/**\n\t * Create a new untitled file working copy with optional initial contents.\n\t *\n\t * Note: Callers must `dispose` the working copy when no longer needed.\n\t */\n\tresolve(options?: INewUntitledFileWorkingCopyOptions): Promise<IUntitledFileWorkingCopy<U>>;\n\n\t/**\n\t * Create a new untitled file working copy with optional initial contents\n\t * and associated resource. The associated resource will be used when\n\t * saving and will not require to ask the user for a file path.\n\t *\n\t * Note: Callers must `dispose` the working copy when no longer needed.\n\t */\n\tresolve(options?: INewUntitledFileWorkingCopyWithAssociatedResourceOptions): Promise<IUntitledFileWorkingCopy<U>>;\n\n\t/**\n\t * Creates a new untitled file working copy with optional initial contents\n\t * with the provided resource or return an existing untitled file working\n\t * copy otherwise.\n\t *\n\t * Note: Callers must `dispose` the working copy when no longer needed.\n\t */\n\tresolve(options?: INewOrExistingUntitledFileWorkingCopyOptions): Promise<IUntitledFileWorkingCopy<U>>;\n\n\t/**\n\t * Implements \"Save As\" for file based working copies. The API is `URI` based\n\t * because it works even without resolved file working copies. If a file working\n\t * copy exists for any given `URI`, the implementation will deal with them properly\n\t * (e.g. dirty contents of the source will be written to the target and the source\n\t * will be reverted).\n\t *\n\t * Note: it is possible that the returned file working copy has a different `URI`\n\t * than the `target` that was passed in. Based on URI identity, the file working\n\t * copy may chose to return an existing file working copy with different casing\n\t * to respect file systems that are case insensitive.\n\t *\n\t * Note: Callers must `dispose` the working copy when no longer needed.\n\t *\n\t * Note: Untitled file working copies are being disposed when saved.\n\t *\n\t * @param source the source resource to save as\n\t * @param target the optional target resource to save to. if not defined, the user\n\t * will be asked for input\n\t * @returns the target stored working copy that was saved to or `undefined` in case of\n\t * cancellation\n\t */\n\tsaveAs(source: URI, target: URI, options?: ISaveOptions): Promise<IStoredFileWorkingCopy<S> | undefined>;\n\tsaveAs(source: URI, target: undefined, options?: IFileWorkingCopySaveAsOptions): Promise<IStoredFileWorkingCopy<S> | undefined>;\n}\n\nexport interface IFileWorkingCopySaveAsOptions extends ISaveOptions {\n\n\t/**\n\t * Optional target resource to suggest to the user in case\n\t * no target resource is provided to save to.\n\t */\n\tsuggestedTarget?: URI;\n}\n\nexport class FileWorkingCopyManager<S extends IStoredFileWorkingCopyModel, U extends IUntitledFileWorkingCopyModel> extends Disposable implements IFileWorkingCopyManager<S, U> {\n\n\treadonly onDidCreate: Event<IFileWorkingCopy<S | U>>;\n\n\tprivate static readonly FILE_WORKING_COPY_SAVE_CREATE_SOURCE = SaveSourceRegistry.registerSource('fileWorkingCopyCreate.source', localize('fileWorkingCopyCreate.source', \"File Created\"));\n\tprivate static readonly FILE_WORKING_COPY_SAVE_REPLACE_SOURCE = SaveSourceRegistry.registerSource('fileWorkingCopyReplace.source', localize('fileWorkingCopyReplace.source', \"File Replaced\"));\n\n\treadonly stored: IStoredFileWorkingCopyManager<S>;\n\treadonly untitled: IUntitledFileWorkingCopyManager<U>;\n\n\tconstructor(\n\t\tprivate readonly workingCopyTypeId: string,\n\t\tprivate readonly storedWorkingCopyModelFactory: IStoredFileWorkingCopyModelFactory<S>,\n\t\tprivate readonly untitledWorkingCopyModelFactory: IUntitledFileWorkingCopyModelFactory<U>,\n\t\t@IFileService private readonly fileService: IFileService,\n\t\t@ILifecycleService lifecycleService: ILifecycleService,\n\t\t@ILabelService labelService: ILabelService,\n\t\t@ILogService private readonly logService: ILogService,\n\t\t@IWorkingCopyFileService private readonly workingCopyFileService: IWorkingCopyFileService,\n\t\t@IWorkingCopyBackupService workingCopyBackupService: IWorkingCopyBackupService,\n\t\t@IUriIdentityService private readonly uriIdentityService: IUriIdentityService,\n\t\t@IFileDialogService private readonly fileDialogService: IFileDialogService,\n\t\t@IFilesConfigurationService private readonly filesConfigurationService: IFilesConfigurationService,\n\t\t@IWorkingCopyService workingCopyService: IWorkingCopyService,\n\t\t@INotificationService notificationService: INotificationService,\n\t\t@IWorkingCopyEditorService workingCopyEditorService: IWorkingCopyEditorService,\n\t\t@IEditorService editorService: IEditorService,\n\t\t@IElevatedFileService elevatedFileService: IElevatedFileService,\n\t\t@IPathService private readonly pathService: IPathService,\n\t\t@IWorkbenchEnvironmentService private readonly environmentService: IWorkbenchEnvironmentService,\n\t\t@IDialogService private readonly dialogService: IDialogService,\n\t\t@IDecorationsService private readonly decorationsService: IDecorationsService,\n\t\t@IProgressService progressService: IProgressService\n\t) {\n\t\tsuper();\n\n\t\t// Stored file working copies manager\n\t\tthis.stored = this._register(new StoredFileWorkingCopyManager(\n\t\t\tthis.workingCopyTypeId,\n\t\t\tthis.storedWorkingCopyModelFactory,\n\t\t\tfileService, lifecycleService, labelService, logService, workingCopyFileService,\n\t\t\tworkingCopyBackupService, uriIdentityService, filesConfigurationService, workingCopyService,\n\t\t\tnotificationService, workingCopyEditorService, editorService, elevatedFileService, progressService\n\t\t));\n\n\t\t// Untitled file working copies manager\n\t\tthis.untitled = this._register(new UntitledFileWorkingCopyManager(\n\t\t\tthis.workingCopyTypeId,\n\t\t\tthis.untitledWorkingCopyModelFactory,\n\t\t\tasync (workingCopy, options) => {\n\t\t\t\tconst result = await this.saveAs(workingCopy.resource, undefined, options);\n\n\t\t\t\treturn !!result;\n\t\t\t},\n\t\t\tfileService, labelService, logService, workingCopyBackupService, workingCopyService\n\t\t));\n\n\t\t// Events\n\t\tthis.onDidCreate = Event.any<IFileWorkingCopy<S | U>>(this.stored.onDidCreate, this.untitled.onDidCreate);\n\n\t\t// Decorations\n\t\tthis.provideDecorations();\n\t}\n\n\t//#region decorations\n\n\tprivate provideDecorations(): void {\n\n\t\t// File working copy decorations\n\t\tconst provider = this._register(new class extends Disposable implements IDecorationsProvider {\n\n\t\t\treadonly label = localize('fileWorkingCopyDecorations', \"File Working Copy Decorations\");\n\n\t\t\tprivate readonly _onDidChange = this._register(new Emitter<URI[]>());\n\t\t\treadonly onDidChange = this._onDidChange.event;\n\n\t\t\tconstructor(private readonly stored: IStoredFileWorkingCopyManager<S>) {\n\t\t\t\tsuper();\n\n\t\t\t\tthis.registerListeners();\n\t\t\t}\n\n\t\t\tprivate registerListeners(): void {\n\n\t\t\t\t// Creates\n\t\t\t\tthis._register(this.stored.onDidResolve(workingCopy => {\n\t\t\t\t\tif (workingCopy.isReadonly() || workingCopy.hasState(StoredFileWorkingCopyState.ORPHAN)) {\n\t\t\t\t\t\tthis._onDidChange.fire([workingCopy.resource]);\n\t\t\t\t\t}\n\t\t\t\t}));\n\n\t\t\t\t// Removals: once a stored working copy is no longer\n\t\t\t\t// under our control, make sure to signal this as\n\t\t\t\t// decoration change because from this point on we\n\t\t\t\t// have no way of updating the decoration anymore.\n\t\t\t\tthis._register(this.stored.onDidRemove(workingCopyUri => this._onDidChange.fire([workingCopyUri])));\n\n\t\t\t\t// Changes\n\t\t\t\tthis._register(this.stored.onDidChangeReadonly(workingCopy => this._onDidChange.fire([workingCopy.resource])));\n\t\t\t\tthis._register(this.stored.onDidChangeOrphaned(workingCopy => this._onDidChange.fire([workingCopy.resource])));\n\t\t\t}\n\n\t\t\tprovideDecorations(uri: URI): IDecorationData | undefined {\n\t\t\t\tconst workingCopy = this.stored.get(uri);\n\t\t\t\tif (!workingCopy || workingCopy.isDisposed()) {\n\t\t\t\t\treturn undefined;\n\t\t\t\t}\n\n\t\t\t\tconst isReadonly = workingCopy.isReadonly();\n\t\t\t\tconst isOrphaned = workingCopy.hasState(StoredFileWorkingCopyState.ORPHAN);\n\n\t\t\t\t// Readonly + Orphaned\n\t\t\t\tif (isReadonly && isOrphaned) {\n\t\t\t\t\treturn {\n\t\t\t\t\t\tcolor: listErrorForeground,\n\t\t\t\t\t\tletter: Codicon.lockSmall,\n\t\t\t\t\t\tstrikethrough: true,\n\t\t\t\t\t\ttooltip: localize('readonlyAndDeleted', \"Deleted, Read-only\"),\n\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\t// Readonly\n\t\t\t\telse if (isReadonly) {\n\t\t\t\t\treturn {\n\t\t\t\t\t\tletter: Codicon.lockSmall,\n\t\t\t\t\t\ttooltip: localize('readonly', \"Read-only\"),\n\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\t// Orphaned\n\t\t\t\telse if (isOrphaned) {\n\t\t\t\t\treturn {\n\t\t\t\t\t\tcolor: listErrorForeground,\n\t\t\t\t\t\tstrikethrough: true,\n\t\t\t\t\t\ttooltip: localize('deleted', \"Deleted\"),\n\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\treturn undefined;\n\t\t\t}\n\t\t}(this.stored));\n\n\t\tthis._register(this.decorationsService.registerDecorationsProvider(provider));\n\t}\n\n\t//#endregion\n\n\t//#region get / get all\n\n\tget workingCopies(): (IUntitledFileWorkingCopy<U> | IStoredFileWorkingCopy<S>)[] {\n\t\treturn [...this.stored.workingCopies, ...this.untitled.workingCopies];\n\t}\n\n\tget(resource: URI): IUntitledFileWorkingCopy<U> | IStoredFileWorkingCopy<S> | undefined {\n\t\treturn this.stored.get(resource) ?? this.untitled.get(resource);\n\t}\n\n\t//#endregion\n\n\t//#region resolve\n\n\tresolve(options?: INewUntitledFileWorkingCopyOptions): Promise<IUntitledFileWorkingCopy<U>>;\n\tresolve(options?: INewUntitledFileWorkingCopyWithAssociatedResourceOptions): Promise<IUntitledFileWorkingCopy<U>>;\n\tresolve(options?: INewOrExistingUntitledFileWorkingCopyOptions): Promise<IUntitledFileWorkingCopy<U>>;\n\tresolve(resource: URI, options?: IStoredFileWorkingCopyResolveOptions): Promise<IStoredFileWorkingCopy<S>>;\n\tresolve(arg1?: URI | INewUntitledFileWorkingCopyOptions | INewUntitledFileWorkingCopyWithAssociatedResourceOptions | INewOrExistingUntitledFileWorkingCopyOptions, arg2?: IStoredFileWorkingCopyResolveOptions): Promise<IUntitledFileWorkingCopy<U> | IStoredFileWorkingCopy<S>> {\n\t\tif (URI.isUri(arg1)) {\n\n\t\t\t// Untitled: via untitled manager\n\t\t\tif (arg1.scheme === Schemas.untitled) {\n\t\t\t\treturn this.untitled.resolve({ untitledResource: arg1 });\n\t\t\t}\n\n\t\t\t// else: via stored file manager\n\t\t\telse {\n\t\t\t\treturn this.stored.resolve(arg1, arg2);\n\t\t\t}\n\t\t}\n\n\t\treturn this.untitled.resolve(arg1);\n\t}\n\n\t//#endregion\n\n\t//#region Save\n\n\tasync saveAs(source: URI, target?: URI, options?: IFileWorkingCopySaveAsOptions): Promise<IStoredFileWorkingCopy<S> | undefined> {\n\n\t\t// Get to target resource\n\t\tif (!target) {\n\t\t\tconst workingCopy = this.get(source);\n\t\t\tif (workingCopy instanceof UntitledFileWorkingCopy && workingCopy.hasAssociatedFilePath) {\n\t\t\t\ttarget = await this.suggestSavePath(source);\n\t\t\t} else {\n\t\t\t\ttarget = await this.fileDialogService.pickFileToSave(await this.suggestSavePath(options?.suggestedTarget ?? source), options?.availableFileSystems);\n\t\t\t}\n\t\t}\n\n\t\tif (!target) {\n\t\t\treturn; // user canceled\n\t\t}\n\n\t\t// Ensure target is not marked as readonly and prompt otherwise\n\t\tif (this.filesConfigurationService.isReadonly(target)) {\n\t\t\tconst confirmed = await this.confirmMakeWriteable(target);\n\t\t\tif (!confirmed) {\n\t\t\t\treturn;\n\t\t\t} else {\n\t\t\t\tthis.filesConfigurationService.updateReadonly(target, false);\n\t\t\t}\n\t\t}\n\n\t\t// Just save if target is same as working copies own resource\n\t\t// and we are not saving an untitled file working copy\n\t\tif (this.fileService.hasProvider(source) && isEqual(source, target)) {\n\t\t\treturn this.doSave(source, { ...options, force: true  /* force to save, even if not dirty (https://github.com/microsoft/vscode/issues/99619) */ });\n\t\t}\n\n\t\t// If the target is different but of same identity, we\n\t\t// move the source to the target, knowing that the\n\t\t// underlying file system cannot have both and then save.\n\t\t// However, this will only work if the source exists\n\t\t// and is not orphaned, so we need to check that too.\n\t\tif (this.fileService.hasProvider(source) && this.uriIdentityService.extUri.isEqual(source, target) && (await this.fileService.exists(source))) {\n\n\t\t\t// Move via working copy file service to enable participants\n\t\t\tawait this.workingCopyFileService.move([{ file: { source, target } }], CancellationToken.None);\n\n\t\t\t// At this point we don't know whether we have a\n\t\t\t// working copy for the source or the target URI so we\n\t\t\t// simply try to save with both resources.\n\t\t\treturn (await this.doSave(source, options)) ?? (await this.doSave(target, options));\n\t\t}\n\n\t\t// Perform normal \"Save As\"\n\t\treturn this.doSaveAs(source, target, options);\n\t}\n\n\tprivate async doSave(resource: URI, options?: ISaveOptions): Promise<IStoredFileWorkingCopy<S> | undefined> {\n\n\t\t// Save is only possible with stored file working copies,\n\t\t// any other have to go via `saveAs` flow.\n\t\tconst storedFileWorkingCopy = this.stored.get(resource);\n\t\tif (storedFileWorkingCopy) {\n\t\t\tconst success = await storedFileWorkingCopy.save(options);\n\t\t\tif (success) {\n\t\t\t\treturn storedFileWorkingCopy;\n\t\t\t}\n\t\t}\n\n\t\treturn undefined;\n\t}\n\n\tprivate async doSaveAs(source: URI, target: URI, options?: IFileWorkingCopySaveAsOptions): Promise<IStoredFileWorkingCopy<S> | undefined> {\n\t\tlet sourceContents: VSBufferReadableStream;\n\n\t\t// If the source is an existing file working copy, we can directly\n\t\t// use that to copy the contents to the target destination\n\t\tconst sourceWorkingCopy = this.get(source);\n\t\tif (sourceWorkingCopy?.isResolved()) {\n\t\t\tsourceContents = await sourceWorkingCopy.model.snapshot(SnapshotContext.Save, CancellationToken.None);\n\t\t}\n\n\t\t// Otherwise we resolve the contents from the underlying file\n\t\telse {\n\t\t\tsourceContents = (await this.fileService.readFileStream(source)).value;\n\t\t}\n\n\t\t// Resolve target\n\t\tconst { targetFileExists, targetStoredFileWorkingCopy } = await this.doResolveSaveTarget(source, target);\n\n\t\t// Confirm to overwrite if we have an untitled file working copy with associated path where\n\t\t// the file actually exists on disk and we are instructed to save to that file path.\n\t\t// This can happen if the file was created after the untitled file was opened.\n\t\t// See https://github.com/microsoft/vscode/issues/67946\n\t\tif (\n\t\t\tsourceWorkingCopy instanceof UntitledFileWorkingCopy &&\n\t\t\tsourceWorkingCopy.hasAssociatedFilePath &&\n\t\t\ttargetFileExists &&\n\t\t\tthis.uriIdentityService.extUri.isEqual(target, toLocalResource(sourceWorkingCopy.resource, this.environmentService.remoteAuthority, this.pathService.defaultUriScheme))\n\t\t) {\n\t\t\tconst overwrite = await this.confirmOverwrite(target);\n\t\t\tif (!overwrite) {\n\t\t\t\treturn undefined;\n\t\t\t}\n\t\t}\n\n\t\t// Take over content from source to target\n\t\tawait targetStoredFileWorkingCopy.model?.update(sourceContents, CancellationToken.None);\n\n\t\t// Set source options depending on target exists or not\n\t\tif (!options?.source) {\n\t\t\toptions = {\n\t\t\t\t...options,\n\t\t\t\tsource: targetFileExists ? FileWorkingCopyManager.FILE_WORKING_COPY_SAVE_REPLACE_SOURCE : FileWorkingCopyManager.FILE_WORKING_COPY_SAVE_CREATE_SOURCE\n\t\t\t};\n\t\t}\n\n\t\t// Save target\n\t\tconst success = await targetStoredFileWorkingCopy.save({\n\t\t\t...options,\n\t\t\tfrom: source,\n\t\t\tforce: true  /* force to save, even if not dirty (https://github.com/microsoft/vscode/issues/99619) */\n\t\t});\n\t\tif (!success) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\t// Revert the source\n\t\ttry {\n\t\t\tawait sourceWorkingCopy?.revert();\n\t\t} catch (error) {\n\n\t\t\t// It is possible that reverting the source fails, for example\n\t\t\t// when a remote is disconnected and we cannot read it anymore.\n\t\t\t// However, this should not interrupt the \"Save As\" flow, so\n\t\t\t// we gracefully catch the error and just log it.\n\n\t\t\tthis.logService.error(error);\n\t\t}\n\n\t\t// Events\n\t\tif (source.scheme === Schemas.untitled) {\n\t\t\tthis.untitled.notifyDidSave(source, target);\n\t\t}\n\n\t\treturn targetStoredFileWorkingCopy;\n\t}\n\n\tprivate async doResolveSaveTarget(source: URI, target: URI): Promise<{ targetFileExists: boolean; targetStoredFileWorkingCopy: IStoredFileWorkingCopy<S> }> {\n\n\t\t// Prefer an existing stored file working copy if it is already resolved\n\t\t// for the given target resource\n\t\tlet targetFileExists = false;\n\t\tlet targetStoredFileWorkingCopy = this.stored.get(target);\n\t\tif (targetStoredFileWorkingCopy?.isResolved()) {\n\t\t\ttargetFileExists = true;\n\t\t}\n\n\t\t// Otherwise create the target working copy empty if\n\t\t// it does not exist already and resolve it from there\n\t\telse {\n\t\t\ttargetFileExists = await this.fileService.exists(target);\n\n\t\t\t// Create target file adhoc if it does not exist yet\n\t\t\tif (!targetFileExists) {\n\t\t\t\tawait this.workingCopyFileService.create([{ resource: target }], CancellationToken.None);\n\t\t\t}\n\n\t\t\t// At this point we need to resolve the target working copy\n\t\t\t// and we have to do an explicit check if the source URI\n\t\t\t// equals the target via URI identity. If they match and we\n\t\t\t// have had an existing working copy with the source, we\n\t\t\t// prefer that one over resolving the target. Otherwise we\n\t\t\t// would potentially introduce a\n\t\t\tif (this.uriIdentityService.extUri.isEqual(source, target) && this.get(source)) {\n\t\t\t\ttargetStoredFileWorkingCopy = await this.stored.resolve(source);\n\t\t\t} else {\n\t\t\t\ttargetStoredFileWorkingCopy = await this.stored.resolve(target);\n\t\t\t}\n\t\t}\n\n\t\treturn { targetFileExists, targetStoredFileWorkingCopy };\n\t}\n\n\tprivate async confirmOverwrite(resource: URI): Promise<boolean> {\n\t\tconst { confirmed } = await this.dialogService.confirm({\n\t\t\ttype: 'warning',\n\t\t\tmessage: localize('confirmOverwrite', \"'{0}' already exists. Do you want to replace it?\", basename(resource)),\n\t\t\tdetail: localize('overwriteIrreversible', \"A file or folder with the name '{0}' already exists in the folder '{1}'. Replacing it will overwrite its current contents.\", basename(resource), basename(dirname(resource))),\n\t\t\tprimaryButton: localize({ key: 'replaceButtonLabel', comment: ['&& denotes a mnemonic'] }, \"&&Replace\")\n\t\t});\n\n\t\treturn confirmed;\n\t}\n\n\tprivate async confirmMakeWriteable(resource: URI): Promise<boolean> {\n\t\tconst { confirmed } = await this.dialogService.confirm({\n\t\t\ttype: 'warning',\n\t\t\tmessage: localize('confirmMakeWriteable', \"'{0}' is marked as read-only. Do you want to save anyway?\", basename(resource)),\n\t\t\tdetail: localize('confirmMakeWriteableDetail', \"Paths can be configured as read-only via settings.\"),\n\t\t\tprimaryButton: localize({ key: 'makeWriteableButtonLabel', comment: ['&& denotes a mnemonic'] }, \"&&Save Anyway\")\n\t\t});\n\n\t\treturn confirmed;\n\t}\n\n\tprivate async suggestSavePath(resource: URI): Promise<URI> {\n\n\t\t// 1.) Just take the resource as is if the file service can handle it\n\t\tif (this.fileService.hasProvider(resource)) {\n\t\t\treturn resource;\n\t\t}\n\n\t\t// 2.) Pick the associated file path for untitled working copies if any\n\t\tconst workingCopy = this.get(resource);\n\t\tif (workingCopy instanceof UntitledFileWorkingCopy && workingCopy.hasAssociatedFilePath) {\n\t\t\treturn toLocalResource(resource, this.environmentService.remoteAuthority, this.pathService.defaultUriScheme);\n\t\t}\n\n\t\tconst defaultFilePath = await this.fileDialogService.defaultFilePath();\n\n\t\t// 3.) Pick the working copy name if valid joined with default path\n\t\tif (workingCopy) {\n\t\t\tconst candidatePath = joinPath(defaultFilePath, workingCopy.name);\n\t\t\tif (await this.pathService.hasValidBasename(candidatePath, workingCopy.name)) {\n\t\t\t\treturn candidatePath;\n\t\t\t}\n\t\t}\n\n\t\t// 4.) Finally fallback to the name of the resource joined with default path\n\t\treturn joinPath(defaultFilePath, basename(resource));\n\t}\n\n\t//#endregion\n\n\t//#region Lifecycle\n\n\tasync destroy(): Promise<void> {\n\t\tawait Promises.settled([\n\t\t\tthis.stored.destroy(),\n\t\t\tthis.untitled.destroy()\n\t\t]);\n\t}\n\n\t//#endregion\n}\n"]}