{"version":3,"sources":["vs/workbench/services/textfile/common/textFileEditorModelManager.ts"],"names":[],"mappings":"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","file":"textFileEditorModelManager.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { localize } from '../../../../nls.js';\nimport { toErrorMessage } from '../../../../base/common/errorMessage.js';\nimport { Event, Emitter } from '../../../../base/common/event.js';\nimport { URI } from '../../../../base/common/uri.js';\nimport { TextFileEditorModel } from './textFileEditorModel.js';\nimport { dispose, IDisposable, Disposable, DisposableStore } from '../../../../base/common/lifecycle.js';\nimport { ITextFileEditorModel, ITextFileEditorModelManager, ITextFileEditorModelResolveOrCreateOptions, ITextFileResolveEvent, ITextFileSaveEvent, ITextFileSaveParticipant } from './textfiles.js';\nimport { IInstantiationService } from '../../../../platform/instantiation/common/instantiation.js';\nimport { ResourceMap } from '../../../../base/common/map.js';\nimport { IFileService, FileChangesEvent, FileOperation, FileChangeType, IFileSystemProviderRegistrationEvent, IFileSystemProviderCapabilitiesChangeEvent } from '../../../../platform/files/common/files.js';\nimport { Promises, ResourceQueue } from '../../../../base/common/async.js';\nimport { onUnexpectedError } from '../../../../base/common/errors.js';\nimport { TextFileSaveParticipant } from './textFileSaveParticipant.js';\nimport { CancellationToken } from '../../../../base/common/cancellation.js';\nimport { INotificationService } from '../../../../platform/notification/common/notification.js';\nimport { IStoredFileWorkingCopySaveParticipantContext, IWorkingCopyFileService, WorkingCopyFileEvent } from '../../workingCopy/common/workingCopyFileService.js';\nimport { ITextSnapshot } from '../../../../editor/common/model.js';\nimport { extname, joinPath } from '../../../../base/common/resources.js';\nimport { createTextBufferFactoryFromSnapshot } from '../../../../editor/common/model/textModel.js';\nimport { PLAINTEXT_EXTENSION, PLAINTEXT_LANGUAGE_ID } from '../../../../editor/common/languages/modesRegistry.js';\nimport { IUriIdentityService } from '../../../../platform/uriIdentity/common/uriIdentity.js';\nimport { IProgress, IProgressStep } from '../../../../platform/progress/common/progress.js';\n\ninterface ITextFileEditorModelToRestore {\n\treadonly source: URI;\n\treadonly target: URI;\n\treadonly snapshot?: ITextSnapshot;\n\treadonly language?: {\n\t\treadonly id: string;\n\t\treadonly explicit: boolean;\n\t};\n\treadonly encoding?: string;\n}\n\nexport class TextFileEditorModelManager extends Disposable implements ITextFileEditorModelManager {\n\n\tprivate readonly _onDidCreate = this._register(new Emitter<TextFileEditorModel>({ leakWarningThreshold: 500 /* increased for users with hundreds of inputs opened */ }));\n\treadonly onDidCreate = this._onDidCreate.event;\n\n\tprivate readonly _onDidResolve = this._register(new Emitter<ITextFileResolveEvent>());\n\treadonly onDidResolve = this._onDidResolve.event;\n\n\tprivate readonly _onDidRemove = this._register(new Emitter<URI>());\n\treadonly onDidRemove = this._onDidRemove.event;\n\n\tprivate readonly _onDidChangeDirty = this._register(new Emitter<TextFileEditorModel>());\n\treadonly onDidChangeDirty = this._onDidChangeDirty.event;\n\n\tprivate readonly _onDidChangeReadonly = this._register(new Emitter<TextFileEditorModel>());\n\treadonly onDidChangeReadonly = this._onDidChangeReadonly.event;\n\n\tprivate readonly _onDidChangeOrphaned = this._register(new Emitter<TextFileEditorModel>());\n\treadonly onDidChangeOrphaned = this._onDidChangeOrphaned.event;\n\n\tprivate readonly _onDidSaveError = this._register(new Emitter<TextFileEditorModel>());\n\treadonly onDidSaveError = this._onDidSaveError.event;\n\n\tprivate readonly _onDidSave = this._register(new Emitter<ITextFileSaveEvent>());\n\treadonly onDidSave = this._onDidSave.event;\n\n\tprivate readonly _onDidRevert = this._register(new Emitter<TextFileEditorModel>());\n\treadonly onDidRevert = this._onDidRevert.event;\n\n\tprivate readonly _onDidChangeEncoding = this._register(new Emitter<TextFileEditorModel>());\n\treadonly onDidChangeEncoding = this._onDidChangeEncoding.event;\n\n\tprivate readonly mapResourceToModel = new ResourceMap<TextFileEditorModel>();\n\tprivate readonly mapResourceToModelListeners = new ResourceMap<IDisposable>();\n\tprivate readonly mapResourceToDisposeListener = new ResourceMap<IDisposable>();\n\tprivate readonly mapResourceToPendingModelResolvers = new ResourceMap<Promise<void>>();\n\n\tprivate readonly modelResolveQueue = this._register(new ResourceQueue());\n\n\tsaveErrorHandler = (() => {\n\t\tconst notificationService = this.notificationService;\n\n\t\treturn {\n\t\t\tonSaveError(error: Error, model: ITextFileEditorModel): void {\n\t\t\t\tnotificationService.error(localize({ key: 'genericSaveError', comment: ['{0} is the resource that failed to save and {1} the error message'] }, \"Failed to save '{0}': {1}\", model.name, toErrorMessage(error, false)));\n\t\t\t}\n\t\t};\n\t})();\n\n\tget models(): TextFileEditorModel[] {\n\t\treturn [...this.mapResourceToModel.values()];\n\t}\n\n\tconstructor(\n\t\t@IInstantiationService private readonly instantiationService: IInstantiationService,\n\t\t@IFileService private readonly fileService: IFileService,\n\t\t@INotificationService private readonly notificationService: INotificationService,\n\t\t@IWorkingCopyFileService private readonly workingCopyFileService: IWorkingCopyFileService,\n\t\t@IUriIdentityService private readonly uriIdentityService: IUriIdentityService\n\t) {\n\t\tsuper();\n\n\t\tthis.saveParticipants = this._register(this.instantiationService.createInstance(TextFileSaveParticipant));\n\n\t\tthis.registerListeners();\n\t}\n\n\tprivate registerListeners(): void {\n\n\t\t// Update models from file change events\n\t\tthis._register(this.fileService.onDidFilesChange(e => this.onDidFilesChange(e)));\n\n\t\t// File system provider changes\n\t\tthis._register(this.fileService.onDidChangeFileSystemProviderCapabilities(e => this.onDidChangeFileSystemProviderCapabilities(e)));\n\t\tthis._register(this.fileService.onDidChangeFileSystemProviderRegistrations(e => this.onDidChangeFileSystemProviderRegistrations(e)));\n\n\t\t// Working copy operations\n\t\tthis._register(this.workingCopyFileService.onWillRunWorkingCopyFileOperation(e => this.onWillRunWorkingCopyFileOperation(e)));\n\t\tthis._register(this.workingCopyFileService.onDidFailWorkingCopyFileOperation(e => this.onDidFailWorkingCopyFileOperation(e)));\n\t\tthis._register(this.workingCopyFileService.onDidRunWorkingCopyFileOperation(e => this.onDidRunWorkingCopyFileOperation(e)));\n\t}\n\n\tprivate onDidFilesChange(e: FileChangesEvent): void {\n\t\tfor (const model of this.models) {\n\t\t\tif (model.isDirty()) {\n\t\t\t\tcontinue; // never reload dirty models\n\t\t\t}\n\n\t\t\t// Trigger a model resolve for any update or add event that impacts\n\t\t\t// the model. We also consider the added event because it could\n\t\t\t// be that a file was added and updated right after.\n\t\t\tif (e.contains(model.resource, FileChangeType.UPDATED, FileChangeType.ADDED)) {\n\t\t\t\tthis.queueModelReload(model);\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate onDidChangeFileSystemProviderCapabilities(e: IFileSystemProviderCapabilitiesChangeEvent): void {\n\n\t\t// Resolve models again for file systems that changed\n\t\t// capabilities to fetch latest metadata (e.g. readonly)\n\t\t// into all models.\n\t\tthis.queueModelReloads(e.scheme);\n\t}\n\n\tprivate onDidChangeFileSystemProviderRegistrations(e: IFileSystemProviderRegistrationEvent): void {\n\t\tif (!e.added) {\n\t\t\treturn; // only if added\n\t\t}\n\n\t\t// Resolve models again for file systems that registered\n\t\t// to account for capability changes: extensions may\n\t\t// unregister and register the same provider with different\n\t\t// capabilities, so we want to ensure to fetch latest\n\t\t// metadata (e.g. readonly) into all models.\n\t\tthis.queueModelReloads(e.scheme);\n\t}\n\n\tprivate queueModelReloads(scheme: string): void {\n\t\tfor (const model of this.models) {\n\t\t\tif (model.isDirty()) {\n\t\t\t\tcontinue; // never reload dirty models\n\t\t\t}\n\n\t\t\tif (scheme === model.resource.scheme) {\n\t\t\t\tthis.queueModelReload(model);\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate queueModelReload(model: TextFileEditorModel): void {\n\n\t\t// Resolve model to update (use a queue to prevent accumulation of resolves\n\t\t// when the resolve actually takes long. At most we only want the queue\n\t\t// to have a size of 2 (1 running resolve and 1 queued resolve).\n\t\tconst queueSize = this.modelResolveQueue.queueSize(model.resource);\n\t\tif (queueSize <= 1) {\n\t\t\tthis.modelResolveQueue.queueFor(model.resource, async () => {\n\t\t\t\ttry {\n\t\t\t\t\tawait this.reload(model);\n\t\t\t\t} catch (error) {\n\t\t\t\t\tonUnexpectedError(error);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\tprivate readonly mapCorrelationIdToModelsToRestore = new Map<number, ITextFileEditorModelToRestore[]>();\n\n\tprivate onWillRunWorkingCopyFileOperation(e: WorkingCopyFileEvent): void {\n\n\t\t// Move / Copy: remember models to restore after the operation\n\t\tif (e.operation === FileOperation.MOVE || e.operation === FileOperation.COPY) {\n\t\t\tconst modelsToRestore: ITextFileEditorModelToRestore[] = [];\n\n\t\t\tfor (const { source, target } of e.files) {\n\t\t\t\tif (source) {\n\t\t\t\t\tif (this.uriIdentityService.extUri.isEqual(source, target)) {\n\t\t\t\t\t\tcontinue; // ignore if resources are considered equal\n\t\t\t\t\t}\n\n\t\t\t\t\t// find all models that related to source (can be many if resource is a folder)\n\t\t\t\t\tconst sourceModels: TextFileEditorModel[] = [];\n\t\t\t\t\tfor (const model of this.models) {\n\t\t\t\t\t\tif (this.uriIdentityService.extUri.isEqualOrParent(model.resource, source)) {\n\t\t\t\t\t\t\tsourceModels.push(model);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t// remember each source model to resolve again after move is done\n\t\t\t\t\t// with optional content to restore if it was dirty\n\t\t\t\t\tfor (const sourceModel of sourceModels) {\n\t\t\t\t\t\tconst sourceModelResource = sourceModel.resource;\n\n\t\t\t\t\t\t// If the source is the actual model, just use target as new resource\n\t\t\t\t\t\tlet targetModelResource: URI;\n\t\t\t\t\t\tif (this.uriIdentityService.extUri.isEqual(sourceModelResource, source)) {\n\t\t\t\t\t\t\ttargetModelResource = target;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Otherwise a parent folder of the source is being moved, so we need\n\t\t\t\t\t\t// to compute the target resource based on that\n\t\t\t\t\t\telse {\n\t\t\t\t\t\t\ttargetModelResource = joinPath(target, sourceModelResource.path.substr(source.path.length + 1));\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tconst languageId = sourceModel.getLanguageId();\n\t\t\t\t\t\tmodelsToRestore.push({\n\t\t\t\t\t\t\tsource: sourceModelResource,\n\t\t\t\t\t\t\ttarget: targetModelResource,\n\t\t\t\t\t\t\tlanguage: languageId ? {\n\t\t\t\t\t\t\t\tid: languageId,\n\t\t\t\t\t\t\t\texplicit: sourceModel.languageChangeSource === 'user'\n\t\t\t\t\t\t\t} : undefined,\n\t\t\t\t\t\t\tencoding: sourceModel.getEncoding(),\n\t\t\t\t\t\t\tsnapshot: sourceModel.isDirty() ? sourceModel.createSnapshot() : undefined\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis.mapCorrelationIdToModelsToRestore.set(e.correlationId, modelsToRestore);\n\t\t}\n\t}\n\n\tprivate onDidFailWorkingCopyFileOperation(e: WorkingCopyFileEvent): void {\n\n\t\t// Move / Copy: restore dirty flag on models to restore that were dirty\n\t\tif ((e.operation === FileOperation.MOVE || e.operation === FileOperation.COPY)) {\n\t\t\tconst modelsToRestore = this.mapCorrelationIdToModelsToRestore.get(e.correlationId);\n\t\t\tif (modelsToRestore) {\n\t\t\t\tthis.mapCorrelationIdToModelsToRestore.delete(e.correlationId);\n\n\t\t\t\tmodelsToRestore.forEach(model => {\n\t\t\t\t\t// snapshot presence means this model used to be dirty and so we restore that\n\t\t\t\t\t// flag. we do NOT have to restore the content because the model was only soft\n\t\t\t\t\t// reverted and did not loose its original dirty contents.\n\t\t\t\t\tif (model.snapshot) {\n\t\t\t\t\t\tthis.get(model.source)?.setDirty(true);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate onDidRunWorkingCopyFileOperation(e: WorkingCopyFileEvent): void {\n\t\tswitch (e.operation) {\n\n\t\t\t// Create: Revert existing models\n\t\t\tcase FileOperation.CREATE:\n\t\t\t\te.waitUntil((async () => {\n\t\t\t\t\tfor (const { target } of e.files) {\n\t\t\t\t\t\tconst model = this.get(target);\n\t\t\t\t\t\tif (model && !model.isDisposed()) {\n\t\t\t\t\t\t\tawait model.revert();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t})());\n\t\t\t\tbreak;\n\n\t\t\t// Move/Copy: restore models that were resolved before the operation took place\n\t\t\tcase FileOperation.MOVE:\n\t\t\tcase FileOperation.COPY:\n\t\t\t\te.waitUntil((async () => {\n\t\t\t\t\tconst modelsToRestore = this.mapCorrelationIdToModelsToRestore.get(e.correlationId);\n\t\t\t\t\tif (modelsToRestore) {\n\t\t\t\t\t\tthis.mapCorrelationIdToModelsToRestore.delete(e.correlationId);\n\n\t\t\t\t\t\tawait Promises.settled(modelsToRestore.map(async modelToRestore => {\n\n\t\t\t\t\t\t\t// From this moment on, only operate on the canonical resource\n\t\t\t\t\t\t\t// to fix a potential data loss issue:\n\t\t\t\t\t\t\t// https://github.com/microsoft/vscode/issues/211374\n\t\t\t\t\t\t\tconst target = this.uriIdentityService.asCanonicalUri(modelToRestore.target);\n\n\t\t\t\t\t\t\t// restore the model at the target. if we have previous dirty content, we pass it\n\t\t\t\t\t\t\t// over to be used, otherwise we force a reload from disk. this is important\n\t\t\t\t\t\t\t// because we know the file has changed on disk after the move and the model might\n\t\t\t\t\t\t\t// have still existed with the previous state. this ensures that the model is not\n\t\t\t\t\t\t\t// tracking a stale state.\n\t\t\t\t\t\t\tconst restoredModel = await this.resolve(target, {\n\t\t\t\t\t\t\t\treload: { async: false }, // enforce a reload\n\t\t\t\t\t\t\t\tcontents: modelToRestore.snapshot ? createTextBufferFactoryFromSnapshot(modelToRestore.snapshot) : undefined,\n\t\t\t\t\t\t\t\tencoding: modelToRestore.encoding\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t// restore model language only if it is specific\n\t\t\t\t\t\t\tif (modelToRestore.language?.id && modelToRestore.language.id !== PLAINTEXT_LANGUAGE_ID) {\n\n\t\t\t\t\t\t\t\t// an explicitly set language is restored via `setLanguageId`\n\t\t\t\t\t\t\t\t// to preserve it as explicitly set by the user.\n\t\t\t\t\t\t\t\t// (https://github.com/microsoft/vscode/issues/203648)\n\t\t\t\t\t\t\t\tif (modelToRestore.language.explicit) {\n\t\t\t\t\t\t\t\t\trestoredModel.setLanguageId(modelToRestore.language.id);\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t// otherwise, a model language is applied via lower level\n\t\t\t\t\t\t\t\t// APIs to not confuse it with an explicitly set language.\n\t\t\t\t\t\t\t\t// (https://github.com/microsoft/vscode/issues/125795)\n\t\t\t\t\t\t\t\telse if (restoredModel.getLanguageId() === PLAINTEXT_LANGUAGE_ID && extname(target) !== PLAINTEXT_EXTENSION) {\n\t\t\t\t\t\t\t\t\trestoredModel.updateTextEditorModel(undefined, modelToRestore.language.id);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}));\n\t\t\t\t\t}\n\t\t\t\t})());\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tget(resource: URI): TextFileEditorModel | undefined {\n\t\treturn this.mapResourceToModel.get(resource);\n\t}\n\n\tprivate has(resource: URI): boolean {\n\t\treturn this.mapResourceToModel.has(resource);\n\t}\n\n\tprivate async reload(model: TextFileEditorModel): Promise<void> {\n\n\t\t// Await a pending model resolve first before proceeding\n\t\t// to ensure that we never resolve a model more than once\n\t\t// in parallel.\n\t\tawait this.joinPendingResolves(model.resource);\n\n\t\tif (model.isDirty() || model.isDisposed() || !this.has(model.resource)) {\n\t\t\treturn; // the model possibly got dirty or disposed, so return early then\n\t\t}\n\n\t\t// Trigger reload\n\t\tawait this.doResolve(model, { reload: { async: false } });\n\t}\n\n\tasync resolve(resource: URI, options?: ITextFileEditorModelResolveOrCreateOptions): Promise<TextFileEditorModel> {\n\n\t\t// Await a pending model resolve first before proceeding\n\t\t// to ensure that we never resolve a model more than once\n\t\t// in parallel.\n\t\tconst pendingResolve = this.joinPendingResolves(resource);\n\t\tif (pendingResolve) {\n\t\t\tawait pendingResolve;\n\t\t}\n\n\t\t// Trigger resolve\n\t\treturn this.doResolve(resource, options);\n\t}\n\n\tprivate async doResolve(resourceOrModel: URI | TextFileEditorModel, options?: ITextFileEditorModelResolveOrCreateOptions): Promise<TextFileEditorModel> {\n\t\tlet model: TextFileEditorModel | undefined;\n\t\tlet resource: URI;\n\t\tif (URI.isUri(resourceOrModel)) {\n\t\t\tresource = resourceOrModel;\n\t\t\tmodel = this.get(resource);\n\t\t} else {\n\t\t\tresource = resourceOrModel.resource;\n\t\t\tmodel = resourceOrModel;\n\t\t}\n\n\t\tlet modelResolve: Promise<void>;\n\t\tlet didCreateModel = false;\n\n\t\t// Model exists\n\t\tif (model) {\n\n\t\t\t// Always reload if contents are provided\n\t\t\tif (options?.contents) {\n\t\t\t\tmodelResolve = model.resolve(options);\n\t\t\t}\n\n\t\t\t// Reload async or sync based on options\n\t\t\telse if (options?.reload) {\n\n\t\t\t\t// async reload: trigger a reload but return immediately\n\t\t\t\tif (options.reload.async) {\n\t\t\t\t\tmodelResolve = Promise.resolve();\n\t\t\t\t\t(async () => {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tawait model.resolve(options);\n\t\t\t\t\t\t} catch (error) {\n\t\t\t\t\t\t\tif (!model.isDisposed()) {\n\t\t\t\t\t\t\t\tonUnexpectedError(error); // only log if the model is still around\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t})();\n\t\t\t\t}\n\n\t\t\t\t// sync reload: do not return until model reloaded\n\t\t\t\telse {\n\t\t\t\t\tmodelResolve = model.resolve(options);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Do not reload\n\t\t\telse {\n\t\t\t\tmodelResolve = Promise.resolve();\n\t\t\t}\n\t\t}\n\n\t\t// Model does not exist\n\t\telse {\n\t\t\tdidCreateModel = true;\n\n\t\t\tconst newModel = model = this.instantiationService.createInstance(TextFileEditorModel, resource, options ? options.encoding : undefined, options ? options.languageId : undefined);\n\t\t\tmodelResolve = model.resolve(options);\n\n\t\t\tthis.registerModel(newModel);\n\t\t}\n\n\t\t// Store pending resolves to avoid race conditions\n\t\tthis.mapResourceToPendingModelResolvers.set(resource, modelResolve);\n\n\t\t// Make known to manager (if not already known)\n\t\tthis.add(resource, model);\n\n\t\t// Emit some events if we created the model\n\t\tif (didCreateModel) {\n\t\t\tthis._onDidCreate.fire(model);\n\n\t\t\t// If the model is dirty right from the beginning,\n\t\t\t// make sure to emit this as an event\n\t\t\tif (model.isDirty()) {\n\t\t\t\tthis._onDidChangeDirty.fire(model);\n\t\t\t}\n\t\t}\n\n\t\ttry {\n\t\t\tawait modelResolve;\n\t\t} catch (error) {\n\n\t\t\t// Automatically dispose the model if we created it\n\t\t\t// because we cannot dispose a model we do not own\n\t\t\t// https://github.com/microsoft/vscode/issues/138850\n\t\t\tif (didCreateModel) {\n\t\t\t\tmodel.dispose();\n\t\t\t}\n\n\t\t\tthrow error;\n\t\t} finally {\n\n\t\t\t// Remove from pending resolves\n\t\t\tthis.mapResourceToPendingModelResolvers.delete(resource);\n\t\t}\n\n\t\t// Apply language if provided\n\t\tif (options?.languageId) {\n\t\t\tmodel.setLanguageId(options.languageId);\n\t\t}\n\n\t\t// Model can be dirty if a backup was restored, so we make sure to\n\t\t// have this event delivered if we created the model here\n\t\tif (didCreateModel && model.isDirty()) {\n\t\t\tthis._onDidChangeDirty.fire(model);\n\t\t}\n\n\t\treturn model;\n\t}\n\n\tprivate joinPendingResolves(resource: URI): Promise<void> | undefined {\n\t\tconst pendingModelResolve = this.mapResourceToPendingModelResolvers.get(resource);\n\t\tif (!pendingModelResolve) {\n\t\t\treturn;\n\t\t}\n\n\t\treturn this.doJoinPendingResolves(resource);\n\t}\n\n\tprivate async doJoinPendingResolves(resource: URI): Promise<void> {\n\n\t\t// While we have pending model resolves, ensure\n\t\t// to await the last one finishing before returning.\n\t\t// This prevents a race when multiple clients await\n\t\t// the pending resolve and then all trigger the resolve\n\t\t// at the same time.\n\t\tlet currentModelCopyResolve: Promise<void> | undefined;\n\t\twhile (this.mapResourceToPendingModelResolvers.has(resource)) {\n\t\t\tconst nextPendingModelResolve = this.mapResourceToPendingModelResolvers.get(resource);\n\t\t\tif (nextPendingModelResolve === currentModelCopyResolve) {\n\t\t\t\treturn; // already awaited on - return\n\t\t\t}\n\n\t\t\tcurrentModelCopyResolve = nextPendingModelResolve;\n\t\t\ttry {\n\t\t\t\tawait nextPendingModelResolve;\n\t\t\t} catch (error) {\n\t\t\t\t// ignore any error here, it will bubble to the original requestor\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate registerModel(model: TextFileEditorModel): void {\n\n\t\t// Install model listeners\n\t\tconst modelListeners = new DisposableStore();\n\t\tmodelListeners.add(model.onDidResolve(reason => this._onDidResolve.fire({ model, reason })));\n\t\tmodelListeners.add(model.onDidChangeDirty(() => this._onDidChangeDirty.fire(model)));\n\t\tmodelListeners.add(model.onDidChangeReadonly(() => this._onDidChangeReadonly.fire(model)));\n\t\tmodelListeners.add(model.onDidChangeOrphaned(() => this._onDidChangeOrphaned.fire(model)));\n\t\tmodelListeners.add(model.onDidSaveError(() => this._onDidSaveError.fire(model)));\n\t\tmodelListeners.add(model.onDidSave(e => this._onDidSave.fire({ model, ...e })));\n\t\tmodelListeners.add(model.onDidRevert(() => this._onDidRevert.fire(model)));\n\t\tmodelListeners.add(model.onDidChangeEncoding(() => this._onDidChangeEncoding.fire(model)));\n\n\t\t// Keep for disposal\n\t\tthis.mapResourceToModelListeners.set(model.resource, modelListeners);\n\t}\n\n\tadd(resource: URI, model: TextFileEditorModel): void {\n\t\tconst knownModel = this.mapResourceToModel.get(resource);\n\t\tif (knownModel === model) {\n\t\t\treturn; // already cached\n\t\t}\n\n\t\t// dispose any previously stored dispose listener for this resource\n\t\tconst disposeListener = this.mapResourceToDisposeListener.get(resource);\n\t\tdisposeListener?.dispose();\n\n\t\t// store in cache but remove when model gets disposed\n\t\tthis.mapResourceToModel.set(resource, model);\n\t\tthis.mapResourceToDisposeListener.set(resource, model.onWillDispose(() => this.remove(resource)));\n\t}\n\n\tremove(resource: URI): void {\n\t\tconst removed = this.mapResourceToModel.delete(resource);\n\n\t\tconst disposeListener = this.mapResourceToDisposeListener.get(resource);\n\t\tif (disposeListener) {\n\t\t\tdispose(disposeListener);\n\t\t\tthis.mapResourceToDisposeListener.delete(resource);\n\t\t}\n\n\t\tconst modelListener = this.mapResourceToModelListeners.get(resource);\n\t\tif (modelListener) {\n\t\t\tdispose(modelListener);\n\t\t\tthis.mapResourceToModelListeners.delete(resource);\n\t\t}\n\n\t\tif (removed) {\n\t\t\tthis._onDidRemove.fire(resource);\n\t\t}\n\t}\n\n\t//#region Save participants\n\n\tprivate readonly saveParticipants: TextFileSaveParticipant;\n\n\taddSaveParticipant(participant: ITextFileSaveParticipant): IDisposable {\n\t\treturn this.saveParticipants.addSaveParticipant(participant);\n\t}\n\n\trunSaveParticipants(model: ITextFileEditorModel, context: IStoredFileWorkingCopySaveParticipantContext, progress: IProgress<IProgressStep>, token: CancellationToken): Promise<void> {\n\t\treturn this.saveParticipants.participate(model, context, progress, token);\n\t}\n\n\t//#endregion\n\n\tcanDispose(model: TextFileEditorModel): true | Promise<true> {\n\n\t\t// quick return if model already disposed or not dirty and not resolving\n\t\tif (\n\t\t\tmodel.isDisposed() ||\n\t\t\t(!this.mapResourceToPendingModelResolvers.has(model.resource) && !model.isDirty())\n\t\t) {\n\t\t\treturn true;\n\t\t}\n\n\t\t// promise based return in all other cases\n\t\treturn this.doCanDispose(model);\n\t}\n\n\tprivate async doCanDispose(model: TextFileEditorModel): Promise<true> {\n\n\t\t// Await any pending resolves first before proceeding\n\t\tconst pendingResolve = this.joinPendingResolves(model.resource);\n\t\tif (pendingResolve) {\n\t\t\tawait pendingResolve;\n\n\t\t\treturn this.canDispose(model);\n\t\t}\n\n\t\t// dirty model: we do not allow to dispose dirty models to prevent\n\t\t// data loss cases. dirty models can only be disposed when they are\n\t\t// either saved or reverted\n\t\tif (model.isDirty()) {\n\t\t\tawait Event.toPromise(model.onDidChangeDirty);\n\n\t\t\treturn this.canDispose(model);\n\t\t}\n\n\t\treturn true;\n\t}\n\n\toverride dispose(): void {\n\t\tsuper.dispose();\n\n\t\t// model caches\n\t\tthis.mapResourceToModel.clear();\n\t\tthis.mapResourceToPendingModelResolvers.clear();\n\n\t\t// dispose the dispose listeners\n\t\tdispose(this.mapResourceToDisposeListener.values());\n\t\tthis.mapResourceToDisposeListener.clear();\n\n\t\t// dispose the model change listeners\n\t\tdispose(this.mapResourceToModelListeners.values());\n\t\tthis.mapResourceToModelListeners.clear();\n\t}\n}\n"]}