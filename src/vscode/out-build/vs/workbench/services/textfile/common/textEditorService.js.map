{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/services/textfile/common/textEditorService.ts","vs/workbench/services/textfile/common/textEditorService.ts"],"names":[],"mappings":"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","file":"textEditorService.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Event } from '../../../../base/common/event.js';\nimport { Registry } from '../../../../platform/registry/common/platform.js';\nimport { ResourceMap } from '../../../../base/common/map.js';\nimport { createDecorator, IInstantiationService } from '../../../../platform/instantiation/common/instantiation.js';\nimport { IEditorFactoryRegistry, IFileEditorInput, IUntypedEditorInput, IUntypedFileEditorInput, EditorExtensions, isResourceDiffEditorInput, isResourceSideBySideEditorInput, IUntitledTextResourceEditorInput, DEFAULT_EDITOR_ASSOCIATION, isResourceMergeEditorInput } from '../../../common/editor.js';\nimport { EditorInput } from '../../../common/editor/editorInput.js';\nimport { INewUntitledTextEditorOptions, IUntitledTextEditorService } from '../../untitled/common/untitledTextEditorService.js';\nimport { Schemas } from '../../../../base/common/network.js';\nimport { DiffEditorInput } from '../../../common/editor/diffEditorInput.js';\nimport { SideBySideEditorInput } from '../../../common/editor/sideBySideEditorInput.js';\nimport { TextResourceEditorInput } from '../../../common/editor/textResourceEditorInput.js';\nimport { UntitledTextEditorInput } from '../../untitled/common/untitledTextEditorInput.js';\nimport { IUntitledTextEditorModel } from '../../untitled/common/untitledTextEditorModel.js';\nimport { basename } from '../../../../base/common/resources.js';\nimport { URI } from '../../../../base/common/uri.js';\nimport { IUriIdentityService } from '../../../../platform/uriIdentity/common/uriIdentity.js';\nimport { IFileService } from '../../../../platform/files/common/files.js';\nimport { IEditorResolverService, RegisteredEditorPriority } from '../../editor/common/editorResolverService.js';\nimport { Disposable } from '../../../../base/common/lifecycle.js';\nimport { InstantiationType, registerSingleton } from '../../../../platform/instantiation/common/extensions.js';\nimport { onUnexpectedError } from '../../../../base/common/errors.js';\n\nexport const ITextEditorService = createDecorator<ITextEditorService>('textEditorService');\n\nexport interface ITextEditorService {\n\n\treadonly _serviceBrand: undefined;\n\n\t/**\n\t * @deprecated this method should not be used, rather consider using\n\t * `IEditorResolverService` instead with `DEFAULT_EDITOR_ASSOCIATION.id`.\n\t */\n\tcreateTextEditor(input: IUntypedEditorInput): EditorInput;\n\n\t/**\n\t * @deprecated this method should not be used, rather consider using\n\t * `IEditorResolverService` instead with `DEFAULT_EDITOR_ASSOCIATION.id`.\n\t */\n\tcreateTextEditor(input: IUntypedFileEditorInput): IFileEditorInput;\n\n\t/**\n\t * A way to create text editor inputs from an untyped editor input. Depending\n\t * on the passed in input this will be:\n\t * - a `IFileEditorInput` for file resources\n\t * - a `UntitledEditorInput` for untitled resources\n\t * - a `TextResourceEditorInput` for virtual resources\n\t *\n\t * @param input the untyped editor input to create a typed input from\n\t */\n\tresolveTextEditor(input: IUntypedEditorInput): Promise<EditorInput>;\n\tresolveTextEditor(input: IUntypedFileEditorInput): Promise<IFileEditorInput>;\n}\n\nclass FileEditorInputLeakError extends Error {\n\n\tconstructor(message: string, stack: string) {\n\t\tsuper(message);\n\n\t\tthis.name = 'FileEditorInputLeakError';\n\t\tthis.stack = stack;\n\t}\n}\n\nexport class TextEditorService extends Disposable implements ITextEditorService {\n\n\tdeclare readonly _serviceBrand: undefined;\n\n\tprivate readonly editorInputCache = new ResourceMap<TextResourceEditorInput | IFileEditorInput | UntitledTextEditorInput>();\n\n\tprivate readonly fileEditorFactory = Registry.as<IEditorFactoryRegistry>(EditorExtensions.EditorFactory).getFileEditorFactory();\n\n\tconstructor(\n\t\t@IUntitledTextEditorService private readonly untitledTextEditorService: IUntitledTextEditorService,\n\t\t@IInstantiationService private readonly instantiationService: IInstantiationService,\n\t\t@IUriIdentityService private readonly uriIdentityService: IUriIdentityService,\n\t\t@IFileService private readonly fileService: IFileService,\n\t\t@IEditorResolverService private readonly editorResolverService: IEditorResolverService\n\t) {\n\t\tsuper();\n\n\t\t// Register the default editor to the editor resolver\n\t\t// service so that it shows up in the editors picker\n\t\tthis.registerDefaultEditor();\n\t}\n\n\tprivate registerDefaultEditor(): void {\n\t\tthis._register(this.editorResolverService.registerEditor(\n\t\t\t'*',\n\t\t\t{\n\t\t\t\tid: DEFAULT_EDITOR_ASSOCIATION.id,\n\t\t\t\tlabel: DEFAULT_EDITOR_ASSOCIATION.displayName,\n\t\t\t\tdetail: DEFAULT_EDITOR_ASSOCIATION.providerDisplayName,\n\t\t\t\tpriority: RegisteredEditorPriority.builtin\n\t\t\t},\n\t\t\t{},\n\t\t\t{\n\t\t\t\tcreateEditorInput: editor => ({ editor: this.createTextEditor(editor) }),\n\t\t\t\tcreateUntitledEditorInput: untitledEditor => ({ editor: this.createTextEditor(untitledEditor) }),\n\t\t\t\tcreateDiffEditorInput: diffEditor => ({ editor: this.createTextEditor(diffEditor) })\n\t\t\t}\n\t\t));\n\t}\n\n\tresolveTextEditor(input: IUntypedEditorInput): Promise<EditorInput>;\n\tresolveTextEditor(input: IUntypedFileEditorInput): Promise<IFileEditorInput>;\n\tasync resolveTextEditor(input: IUntypedEditorInput | IUntypedFileEditorInput): Promise<EditorInput | IFileEditorInput> {\n\t\treturn this.createTextEditor(input);\n\t}\n\n\tcreateTextEditor(input: IUntypedEditorInput): EditorInput;\n\tcreateTextEditor(input: IUntypedFileEditorInput): IFileEditorInput;\n\tcreateTextEditor(input: IUntypedEditorInput | IUntypedFileEditorInput): EditorInput | IFileEditorInput {\n\n\t\t// Merge Editor Not Supported (we fallback to showing the result only)\n\t\tif (isResourceMergeEditorInput(input)) {\n\t\t\treturn this.createTextEditor(input.result);\n\t\t}\n\n\t\t// Diff Editor Support\n\t\tif (isResourceDiffEditorInput(input)) {\n\t\t\tconst original = this.createTextEditor(input.original);\n\t\t\tconst modified = this.createTextEditor(input.modified);\n\n\t\t\treturn this.instantiationService.createInstance(DiffEditorInput, input.label, input.description, original, modified, undefined);\n\t\t}\n\n\t\t// Side by Side Editor Support\n\t\tif (isResourceSideBySideEditorInput(input)) {\n\t\t\tconst primary = this.createTextEditor(input.primary);\n\t\t\tconst secondary = this.createTextEditor(input.secondary);\n\n\t\t\treturn this.instantiationService.createInstance(SideBySideEditorInput, input.label, input.description, secondary, primary);\n\t\t}\n\n\t\t// Untitled text file support\n\t\tconst untitledInput = input as IUntitledTextResourceEditorInput;\n\t\tif (untitledInput.forceUntitled || !untitledInput.resource || (untitledInput.resource.scheme === Schemas.untitled)) {\n\t\t\tconst untitledOptions: Partial<INewUntitledTextEditorOptions> = {\n\t\t\t\tlanguageId: untitledInput.languageId,\n\t\t\t\tinitialValue: untitledInput.contents,\n\t\t\t\tencoding: untitledInput.encoding\n\t\t\t};\n\n\t\t\t// Untitled resource: use as hint for an existing untitled editor\n\t\t\tlet untitledModel: IUntitledTextEditorModel;\n\t\t\tif (untitledInput.resource?.scheme === Schemas.untitled) {\n\t\t\t\tuntitledModel = this.untitledTextEditorService.create({ untitledResource: untitledInput.resource, ...untitledOptions });\n\t\t\t}\n\n\t\t\t// Other resource: use as hint for associated filepath\n\t\t\telse {\n\t\t\t\tuntitledModel = this.untitledTextEditorService.create({ associatedResource: untitledInput.resource, ...untitledOptions });\n\t\t\t}\n\n\t\t\treturn this.createOrGetCached(untitledModel.resource, () => this.instantiationService.createInstance(UntitledTextEditorInput, untitledModel));\n\t\t}\n\n\t\t// Text File/Resource Editor Support\n\t\tconst textResourceEditorInput = input as IUntypedFileEditorInput;\n\t\tif (textResourceEditorInput.resource instanceof URI) {\n\n\t\t\t// Derive the label from the path if not provided explicitly\n\t\t\tconst label = textResourceEditorInput.label || basename(textResourceEditorInput.resource);\n\n\t\t\t// We keep track of the preferred resource this input is to be created\n\t\t\t// with but it may be different from the canonical resource (see below)\n\t\t\tconst preferredResource = textResourceEditorInput.resource;\n\n\t\t\t// From this moment on, only operate on the canonical resource\n\t\t\t// to ensure we reduce the chance of opening the same resource\n\t\t\t// with different resource forms (e.g. path casing on Windows)\n\t\t\tconst canonicalResource = this.uriIdentityService.asCanonicalUri(preferredResource);\n\n\t\t\treturn this.createOrGetCached(canonicalResource, () => {\n\n\t\t\t\t// File\n\t\t\t\tif (textResourceEditorInput.forceFile || this.fileService.hasProvider(canonicalResource)) {\n\t\t\t\t\treturn this.fileEditorFactory.createFileEditor(canonicalResource, preferredResource, textResourceEditorInput.label, textResourceEditorInput.description, textResourceEditorInput.encoding, textResourceEditorInput.languageId, textResourceEditorInput.contents, this.instantiationService);\n\t\t\t\t}\n\n\t\t\t\t// Resource\n\t\t\t\treturn this.instantiationService.createInstance(TextResourceEditorInput, canonicalResource, textResourceEditorInput.label, textResourceEditorInput.description, textResourceEditorInput.languageId, textResourceEditorInput.contents);\n\t\t\t}, cachedInput => {\n\n\t\t\t\t// Untitled\n\t\t\t\tif (cachedInput instanceof UntitledTextEditorInput) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t// Files\n\t\t\t\telse if (!(cachedInput instanceof TextResourceEditorInput)) {\n\t\t\t\t\tcachedInput.setPreferredResource(preferredResource);\n\n\t\t\t\t\tif (textResourceEditorInput.label) {\n\t\t\t\t\t\tcachedInput.setPreferredName(textResourceEditorInput.label);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (textResourceEditorInput.description) {\n\t\t\t\t\t\tcachedInput.setPreferredDescription(textResourceEditorInput.description);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (textResourceEditorInput.encoding) {\n\t\t\t\t\t\tcachedInput.setPreferredEncoding(textResourceEditorInput.encoding);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (textResourceEditorInput.languageId) {\n\t\t\t\t\t\tcachedInput.setPreferredLanguageId(textResourceEditorInput.languageId);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (typeof textResourceEditorInput.contents === 'string') {\n\t\t\t\t\t\tcachedInput.setPreferredContents(textResourceEditorInput.contents);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Resources\n\t\t\t\telse {\n\t\t\t\t\tif (label) {\n\t\t\t\t\t\tcachedInput.setName(label);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (textResourceEditorInput.description) {\n\t\t\t\t\t\tcachedInput.setDescription(textResourceEditorInput.description);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (textResourceEditorInput.languageId) {\n\t\t\t\t\t\tcachedInput.setPreferredLanguageId(textResourceEditorInput.languageId);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (typeof textResourceEditorInput.contents === 'string') {\n\t\t\t\t\t\tcachedInput.setPreferredContents(textResourceEditorInput.contents);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tthrow new Error(`ITextEditorService: Unable to create texteditor from ${JSON.stringify(input)}`);\n\t}\n\n\tprivate createOrGetCached(\n\t\tresource: URI,\n\t\tfactoryFn: () => TextResourceEditorInput | IFileEditorInput | UntitledTextEditorInput,\n\t\tcachedFn?: (input: TextResourceEditorInput | IFileEditorInput | UntitledTextEditorInput) => void\n\t): TextResourceEditorInput | IFileEditorInput | UntitledTextEditorInput {\n\n\t\t// Return early if already cached\n\t\tlet input = this.editorInputCache.get(resource);\n\t\tif (input) {\n\t\t\tcachedFn?.(input);\n\n\t\t\treturn input;\n\t\t}\n\n\t\t// Otherwise create and add to cache\n\t\tinput = factoryFn();\n\t\tthis.editorInputCache.set(resource, input);\n\n\t\t// Track Leaks\n\t\tconst leakId = this.trackLeaks(input);\n\n\t\tEvent.once(input.onWillDispose)(() => {\n\n\t\t\t// Remove from cache\n\t\t\tthis.editorInputCache.delete(resource);\n\n\t\t\t// Untrack Leaks\n\t\t\tif (leakId) {\n\t\t\t\tthis.untrackLeaks(leakId);\n\t\t\t}\n\t\t});\n\n\t\treturn input;\n\t}\n\n\t//#region Leak Monitoring\n\n\tprivate static readonly LEAK_TRACKING_THRESHOLD = 256;\n\tprivate static readonly LEAK_REPORTING_THRESHOLD = 2 * this.LEAK_TRACKING_THRESHOLD;\n\tprivate static LEAK_REPORTED = false;\n\n\tprivate readonly mapLeakToCounter = new Map<string, number>();\n\n\tprivate trackLeaks(input: TextResourceEditorInput | IFileEditorInput | UntitledTextEditorInput): string | undefined {\n\t\tif (TextEditorService.LEAK_REPORTED || this.editorInputCache.size < TextEditorService.LEAK_TRACKING_THRESHOLD) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\tconst leakId = `${input.resource.scheme}#${input.typeId || '<no typeId>'}#${input.editorId || '<no editorId>'}\\n${new Error().stack?.split('\\n').slice(2).join('\\n') ?? ''}`;\n\t\tconst leakCounter = (this.mapLeakToCounter.get(leakId) ?? 0) + 1;\n\t\tthis.mapLeakToCounter.set(leakId, leakCounter);\n\n\t\tif (this.editorInputCache.size > TextEditorService.LEAK_REPORTING_THRESHOLD) {\n\t\t\tTextEditorService.LEAK_REPORTED = true;\n\n\t\t\tconst [topLeak, topCount] = Array.from(this.mapLeakToCounter.entries()).reduce(\n\t\t\t\t([topLeak, topCount], [key, val]) => val > topCount ? [key, val] : [topLeak, topCount]\n\t\t\t);\n\n\t\t\tconst message = `Potential text editor input LEAK detected, having ${this.editorInputCache.size} text editor inputs already. Most frequent owner (${topCount})`;\n\t\t\tonUnexpectedError(new FileEditorInputLeakError(message, topLeak));\n\t\t}\n\n\t\treturn leakId;\n\t}\n\n\tprivate untrackLeaks(leakId: string): void {\n\t\tconst stackCounter = (this.mapLeakToCounter.get(leakId) ?? 1) - 1;\n\t\tthis.mapLeakToCounter.set(leakId, stackCounter);\n\n\t\tif (stackCounter === 0) {\n\t\t\tthis.mapLeakToCounter.delete(leakId);\n\t\t}\n\t}\n\n\t//#endregion\n}\n\nregisterSingleton(ITextEditorService, TextEditorService, InstantiationType.Eager /* do not change: https://github.com/microsoft/vscode/issues/137675 */);\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Event } from '../../../../base/common/event.js';\nimport { Registry } from '../../../../platform/registry/common/platform.js';\nimport { ResourceMap } from '../../../../base/common/map.js';\nimport { createDecorator, IInstantiationService } from '../../../../platform/instantiation/common/instantiation.js';\nimport { IEditorFactoryRegistry, IFileEditorInput, IUntypedEditorInput, IUntypedFileEditorInput, EditorExtensions, isResourceDiffEditorInput, isResourceSideBySideEditorInput, IUntitledTextResourceEditorInput, DEFAULT_EDITOR_ASSOCIATION, isResourceMergeEditorInput } from '../../../common/editor.js';\nimport { EditorInput } from '../../../common/editor/editorInput.js';\nimport { INewUntitledTextEditorOptions, IUntitledTextEditorService } from '../../untitled/common/untitledTextEditorService.js';\nimport { Schemas } from '../../../../base/common/network.js';\nimport { DiffEditorInput } from '../../../common/editor/diffEditorInput.js';\nimport { SideBySideEditorInput } from '../../../common/editor/sideBySideEditorInput.js';\nimport { TextResourceEditorInput } from '../../../common/editor/textResourceEditorInput.js';\nimport { UntitledTextEditorInput } from '../../untitled/common/untitledTextEditorInput.js';\nimport { IUntitledTextEditorModel } from '../../untitled/common/untitledTextEditorModel.js';\nimport { basename } from '../../../../base/common/resources.js';\nimport { URI } from '../../../../base/common/uri.js';\nimport { IUriIdentityService } from '../../../../platform/uriIdentity/common/uriIdentity.js';\nimport { IFileService } from '../../../../platform/files/common/files.js';\nimport { IEditorResolverService, RegisteredEditorPriority } from '../../editor/common/editorResolverService.js';\nimport { Disposable } from '../../../../base/common/lifecycle.js';\nimport { InstantiationType, registerSingleton } from '../../../../platform/instantiation/common/extensions.js';\nimport { onUnexpectedError } from '../../../../base/common/errors.js';\n\nexport const ITextEditorService = createDecorator<ITextEditorService>('textEditorService');\n\nexport interface ITextEditorService {\n\n\treadonly _serviceBrand: undefined;\n\n\t/**\n\t * @deprecated this method should not be used, rather consider using\n\t * `IEditorResolverService` instead with `DEFAULT_EDITOR_ASSOCIATION.id`.\n\t */\n\tcreateTextEditor(input: IUntypedEditorInput): EditorInput;\n\n\t/**\n\t * @deprecated this method should not be used, rather consider using\n\t * `IEditorResolverService` instead with `DEFAULT_EDITOR_ASSOCIATION.id`.\n\t */\n\tcreateTextEditor(input: IUntypedFileEditorInput): IFileEditorInput;\n\n\t/**\n\t * A way to create text editor inputs from an untyped editor input. Depending\n\t * on the passed in input this will be:\n\t * - a `IFileEditorInput` for file resources\n\t * - a `UntitledEditorInput` for untitled resources\n\t * - a `TextResourceEditorInput` for virtual resources\n\t *\n\t * @param input the untyped editor input to create a typed input from\n\t */\n\tresolveTextEditor(input: IUntypedEditorInput): Promise<EditorInput>;\n\tresolveTextEditor(input: IUntypedFileEditorInput): Promise<IFileEditorInput>;\n}\n\nclass FileEditorInputLeakError extends Error {\n\n\tconstructor(message: string, stack: string) {\n\t\tsuper(message);\n\n\t\tthis.name = 'FileEditorInputLeakError';\n\t\tthis.stack = stack;\n\t}\n}\n\nexport class TextEditorService extends Disposable implements ITextEditorService {\n\n\tdeclare readonly _serviceBrand: undefined;\n\n\tprivate readonly editorInputCache = new ResourceMap<TextResourceEditorInput | IFileEditorInput | UntitledTextEditorInput>();\n\n\tprivate readonly fileEditorFactory = Registry.as<IEditorFactoryRegistry>(EditorExtensions.EditorFactory).getFileEditorFactory();\n\n\tconstructor(\n\t\t@IUntitledTextEditorService private readonly untitledTextEditorService: IUntitledTextEditorService,\n\t\t@IInstantiationService private readonly instantiationService: IInstantiationService,\n\t\t@IUriIdentityService private readonly uriIdentityService: IUriIdentityService,\n\t\t@IFileService private readonly fileService: IFileService,\n\t\t@IEditorResolverService private readonly editorResolverService: IEditorResolverService\n\t) {\n\t\tsuper();\n\n\t\t// Register the default editor to the editor resolver\n\t\t// service so that it shows up in the editors picker\n\t\tthis.registerDefaultEditor();\n\t}\n\n\tprivate registerDefaultEditor(): void {\n\t\tthis._register(this.editorResolverService.registerEditor(\n\t\t\t'*',\n\t\t\t{\n\t\t\t\tid: DEFAULT_EDITOR_ASSOCIATION.id,\n\t\t\t\tlabel: DEFAULT_EDITOR_ASSOCIATION.displayName,\n\t\t\t\tdetail: DEFAULT_EDITOR_ASSOCIATION.providerDisplayName,\n\t\t\t\tpriority: RegisteredEditorPriority.builtin\n\t\t\t},\n\t\t\t{},\n\t\t\t{\n\t\t\t\tcreateEditorInput: editor => ({ editor: this.createTextEditor(editor) }),\n\t\t\t\tcreateUntitledEditorInput: untitledEditor => ({ editor: this.createTextEditor(untitledEditor) }),\n\t\t\t\tcreateDiffEditorInput: diffEditor => ({ editor: this.createTextEditor(diffEditor) })\n\t\t\t}\n\t\t));\n\t}\n\n\tresolveTextEditor(input: IUntypedEditorInput): Promise<EditorInput>;\n\tresolveTextEditor(input: IUntypedFileEditorInput): Promise<IFileEditorInput>;\n\tasync resolveTextEditor(input: IUntypedEditorInput | IUntypedFileEditorInput): Promise<EditorInput | IFileEditorInput> {\n\t\treturn this.createTextEditor(input);\n\t}\n\n\tcreateTextEditor(input: IUntypedEditorInput): EditorInput;\n\tcreateTextEditor(input: IUntypedFileEditorInput): IFileEditorInput;\n\tcreateTextEditor(input: IUntypedEditorInput | IUntypedFileEditorInput): EditorInput | IFileEditorInput {\n\n\t\t// Merge Editor Not Supported (we fallback to showing the result only)\n\t\tif (isResourceMergeEditorInput(input)) {\n\t\t\treturn this.createTextEditor(input.result);\n\t\t}\n\n\t\t// Diff Editor Support\n\t\tif (isResourceDiffEditorInput(input)) {\n\t\t\tconst original = this.createTextEditor(input.original);\n\t\t\tconst modified = this.createTextEditor(input.modified);\n\n\t\t\treturn this.instantiationService.createInstance(DiffEditorInput, input.label, input.description, original, modified, undefined);\n\t\t}\n\n\t\t// Side by Side Editor Support\n\t\tif (isResourceSideBySideEditorInput(input)) {\n\t\t\tconst primary = this.createTextEditor(input.primary);\n\t\t\tconst secondary = this.createTextEditor(input.secondary);\n\n\t\t\treturn this.instantiationService.createInstance(SideBySideEditorInput, input.label, input.description, secondary, primary);\n\t\t}\n\n\t\t// Untitled text file support\n\t\tconst untitledInput = input as IUntitledTextResourceEditorInput;\n\t\tif (untitledInput.forceUntitled || !untitledInput.resource || (untitledInput.resource.scheme === Schemas.untitled)) {\n\t\t\tconst untitledOptions: Partial<INewUntitledTextEditorOptions> = {\n\t\t\t\tlanguageId: untitledInput.languageId,\n\t\t\t\tinitialValue: untitledInput.contents,\n\t\t\t\tencoding: untitledInput.encoding\n\t\t\t};\n\n\t\t\t// Untitled resource: use as hint for an existing untitled editor\n\t\t\tlet untitledModel: IUntitledTextEditorModel;\n\t\t\tif (untitledInput.resource?.scheme === Schemas.untitled) {\n\t\t\t\tuntitledModel = this.untitledTextEditorService.create({ untitledResource: untitledInput.resource, ...untitledOptions });\n\t\t\t}\n\n\t\t\t// Other resource: use as hint for associated filepath\n\t\t\telse {\n\t\t\t\tuntitledModel = this.untitledTextEditorService.create({ associatedResource: untitledInput.resource, ...untitledOptions });\n\t\t\t}\n\n\t\t\treturn this.createOrGetCached(untitledModel.resource, () => this.instantiationService.createInstance(UntitledTextEditorInput, untitledModel));\n\t\t}\n\n\t\t// Text File/Resource Editor Support\n\t\tconst textResourceEditorInput = input as IUntypedFileEditorInput;\n\t\tif (textResourceEditorInput.resource instanceof URI) {\n\n\t\t\t// Derive the label from the path if not provided explicitly\n\t\t\tconst label = textResourceEditorInput.label || basename(textResourceEditorInput.resource);\n\n\t\t\t// We keep track of the preferred resource this input is to be created\n\t\t\t// with but it may be different from the canonical resource (see below)\n\t\t\tconst preferredResource = textResourceEditorInput.resource;\n\n\t\t\t// From this moment on, only operate on the canonical resource\n\t\t\t// to ensure we reduce the chance of opening the same resource\n\t\t\t// with different resource forms (e.g. path casing on Windows)\n\t\t\tconst canonicalResource = this.uriIdentityService.asCanonicalUri(preferredResource);\n\n\t\t\treturn this.createOrGetCached(canonicalResource, () => {\n\n\t\t\t\t// File\n\t\t\t\tif (textResourceEditorInput.forceFile || this.fileService.hasProvider(canonicalResource)) {\n\t\t\t\t\treturn this.fileEditorFactory.createFileEditor(canonicalResource, preferredResource, textResourceEditorInput.label, textResourceEditorInput.description, textResourceEditorInput.encoding, textResourceEditorInput.languageId, textResourceEditorInput.contents, this.instantiationService);\n\t\t\t\t}\n\n\t\t\t\t// Resource\n\t\t\t\treturn this.instantiationService.createInstance(TextResourceEditorInput, canonicalResource, textResourceEditorInput.label, textResourceEditorInput.description, textResourceEditorInput.languageId, textResourceEditorInput.contents);\n\t\t\t}, cachedInput => {\n\n\t\t\t\t// Untitled\n\t\t\t\tif (cachedInput instanceof UntitledTextEditorInput) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t// Files\n\t\t\t\telse if (!(cachedInput instanceof TextResourceEditorInput)) {\n\t\t\t\t\tcachedInput.setPreferredResource(preferredResource);\n\n\t\t\t\t\tif (textResourceEditorInput.label) {\n\t\t\t\t\t\tcachedInput.setPreferredName(textResourceEditorInput.label);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (textResourceEditorInput.description) {\n\t\t\t\t\t\tcachedInput.setPreferredDescription(textResourceEditorInput.description);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (textResourceEditorInput.encoding) {\n\t\t\t\t\t\tcachedInput.setPreferredEncoding(textResourceEditorInput.encoding);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (textResourceEditorInput.languageId) {\n\t\t\t\t\t\tcachedInput.setPreferredLanguageId(textResourceEditorInput.languageId);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (typeof textResourceEditorInput.contents === 'string') {\n\t\t\t\t\t\tcachedInput.setPreferredContents(textResourceEditorInput.contents);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Resources\n\t\t\t\telse {\n\t\t\t\t\tif (label) {\n\t\t\t\t\t\tcachedInput.setName(label);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (textResourceEditorInput.description) {\n\t\t\t\t\t\tcachedInput.setDescription(textResourceEditorInput.description);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (textResourceEditorInput.languageId) {\n\t\t\t\t\t\tcachedInput.setPreferredLanguageId(textResourceEditorInput.languageId);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (typeof textResourceEditorInput.contents === 'string') {\n\t\t\t\t\t\tcachedInput.setPreferredContents(textResourceEditorInput.contents);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tthrow new Error(`ITextEditorService: Unable to create texteditor from ${JSON.stringify(input)}`);\n\t}\n\n\tprivate createOrGetCached(\n\t\tresource: URI,\n\t\tfactoryFn: () => TextResourceEditorInput | IFileEditorInput | UntitledTextEditorInput,\n\t\tcachedFn?: (input: TextResourceEditorInput | IFileEditorInput | UntitledTextEditorInput) => void\n\t): TextResourceEditorInput | IFileEditorInput | UntitledTextEditorInput {\n\n\t\t// Return early if already cached\n\t\tlet input = this.editorInputCache.get(resource);\n\t\tif (input) {\n\t\t\tcachedFn?.(input);\n\n\t\t\treturn input;\n\t\t}\n\n\t\t// Otherwise create and add to cache\n\t\tinput = factoryFn();\n\t\tthis.editorInputCache.set(resource, input);\n\n\t\t// Track Leaks\n\t\tconst leakId = this.trackLeaks(input);\n\n\t\tEvent.once(input.onWillDispose)(() => {\n\n\t\t\t// Remove from cache\n\t\t\tthis.editorInputCache.delete(resource);\n\n\t\t\t// Untrack Leaks\n\t\t\tif (leakId) {\n\t\t\t\tthis.untrackLeaks(leakId);\n\t\t\t}\n\t\t});\n\n\t\treturn input;\n\t}\n\n\t//#region Leak Monitoring\n\n\tprivate static readonly LEAK_TRACKING_THRESHOLD = 256;\n\tprivate static readonly LEAK_REPORTING_THRESHOLD = 2 * this.LEAK_TRACKING_THRESHOLD;\n\tprivate static LEAK_REPORTED = false;\n\n\tprivate readonly mapLeakToCounter = new Map<string, number>();\n\n\tprivate trackLeaks(input: TextResourceEditorInput | IFileEditorInput | UntitledTextEditorInput): string | undefined {\n\t\tif (TextEditorService.LEAK_REPORTED || this.editorInputCache.size < TextEditorService.LEAK_TRACKING_THRESHOLD) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\tconst leakId = `${input.resource.scheme}#${input.typeId || '<no typeId>'}#${input.editorId || '<no editorId>'}\\n${new Error().stack?.split('\\n').slice(2).join('\\n') ?? ''}`;\n\t\tconst leakCounter = (this.mapLeakToCounter.get(leakId) ?? 0) + 1;\n\t\tthis.mapLeakToCounter.set(leakId, leakCounter);\n\n\t\tif (this.editorInputCache.size > TextEditorService.LEAK_REPORTING_THRESHOLD) {\n\t\t\tTextEditorService.LEAK_REPORTED = true;\n\n\t\t\tconst [topLeak, topCount] = Array.from(this.mapLeakToCounter.entries()).reduce(\n\t\t\t\t([topLeak, topCount], [key, val]) => val > topCount ? [key, val] : [topLeak, topCount]\n\t\t\t);\n\n\t\t\tconst message = `Potential text editor input LEAK detected, having ${this.editorInputCache.size} text editor inputs already. Most frequent owner (${topCount})`;\n\t\t\tonUnexpectedError(new FileEditorInputLeakError(message, topLeak));\n\t\t}\n\n\t\treturn leakId;\n\t}\n\n\tprivate untrackLeaks(leakId: string): void {\n\t\tconst stackCounter = (this.mapLeakToCounter.get(leakId) ?? 1) - 1;\n\t\tthis.mapLeakToCounter.set(leakId, stackCounter);\n\n\t\tif (stackCounter === 0) {\n\t\t\tthis.mapLeakToCounter.delete(leakId);\n\t\t}\n\t}\n\n\t//#endregion\n}\n\nregisterSingleton(ITextEditorService, TextEditorService, InstantiationType.Eager /* do not change: https://github.com/microsoft/vscode/issues/137675 */);\n"]}