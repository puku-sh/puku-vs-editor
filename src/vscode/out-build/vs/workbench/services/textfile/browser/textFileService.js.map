{"version":3,"sources":["vs/workbench/services/textfile/browser/textFileService.ts"],"names":[],"mappings":"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","file":"textFileService.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { localize } from '../../../../nls.js';\nimport { URI } from '../../../../base/common/uri.js';\nimport { IEncodingSupport, ITextFileService, ITextFileStreamContent, ITextFileContent, IResourceEncodings, IReadTextFileOptions, IWriteTextFileOptions, toBufferOrReadable, TextFileOperationError, TextFileOperationResult, ITextFileSaveOptions, ITextFileEditorModelManager, IResourceEncoding, stringToSnapshot, ITextFileSaveAsOptions, IReadTextFileEncodingOptions, TextFileEditorModelState, IResolvedTextFileEditorModel } from '../common/textfiles.js';\nimport { IRevertOptions, SaveSourceRegistry } from '../../../common/editor.js';\nimport { ILifecycleService } from '../../lifecycle/common/lifecycle.js';\nimport { IFileService, FileOperationError, FileOperationResult, IFileStatWithMetadata, ICreateFileOptions, IFileStreamContent } from '../../../../platform/files/common/files.js';\nimport { Disposable } from '../../../../base/common/lifecycle.js';\nimport { extname as pathExtname } from '../../../../base/common/path.js';\nimport { IWorkbenchEnvironmentService } from '../../environment/common/environmentService.js';\nimport { IUntitledTextEditorService, IUntitledTextEditorModelManager } from '../../untitled/common/untitledTextEditorService.js';\nimport { IResolvedUntitledTextEditorModel, UntitledTextEditorModel } from '../../untitled/common/untitledTextEditorModel.js';\nimport { TextFileEditorModelManager } from '../common/textFileEditorModelManager.js';\nimport { IInstantiationService } from '../../../../platform/instantiation/common/instantiation.js';\nimport { Schemas } from '../../../../base/common/network.js';\nimport { createTextBufferFactoryFromSnapshot, createTextBufferFactoryFromStream } from '../../../../editor/common/model/textModel.js';\nimport { IModelService } from '../../../../editor/common/services/model.js';\nimport { joinPath, dirname, basename, toLocalResource, extname, isEqual } from '../../../../base/common/resources.js';\nimport { IDialogService, IFileDialogService } from '../../../../platform/dialogs/common/dialogs.js';\nimport { VSBuffer, VSBufferReadable, bufferToStream, VSBufferReadableStream } from '../../../../base/common/buffer.js';\nimport { ITextSnapshot, ITextModel } from '../../../../editor/common/model.js';\nimport { ITextResourceConfigurationService } from '../../../../editor/common/services/textResourceConfiguration.js';\nimport { PLAINTEXT_LANGUAGE_ID } from '../../../../editor/common/languages/modesRegistry.js';\nimport { IFilesConfigurationService } from '../../filesConfiguration/common/filesConfigurationService.js';\nimport { IResolvedTextEditorModel } from '../../../../editor/common/services/resolverService.js';\nimport { BaseTextEditorModel } from '../../../common/editor/textEditorModel.js';\nimport { ICodeEditorService } from '../../../../editor/browser/services/codeEditorService.js';\nimport { IPathService } from '../../path/common/pathService.js';\nimport { IWorkingCopyFileService, IFileOperationUndoRedoInfo, ICreateFileOperation } from '../../workingCopy/common/workingCopyFileService.js';\nimport { IUriIdentityService } from '../../../../platform/uriIdentity/common/uriIdentity.js';\nimport { IWorkspaceContextService, WORKSPACE_EXTENSION } from '../../../../platform/workspace/common/workspace.js';\nimport { UTF8, UTF8_with_bom, UTF16be, UTF16le, encodingExists, toEncodeReadable, toDecodeStream, IDecodeStreamResult, DecodeStreamError, DecodeStreamErrorKind } from '../common/encoding.js';\nimport { consumeStream, ReadableStream } from '../../../../base/common/stream.js';\nimport { ILanguageService } from '../../../../editor/common/languages/language.js';\nimport { ILogService } from '../../../../platform/log/common/log.js';\nimport { CancellationToken, CancellationTokenSource } from '../../../../base/common/cancellation.js';\nimport { IElevatedFileService } from '../../files/common/elevatedFileService.js';\nimport { IDecorationData, IDecorationsProvider, IDecorationsService } from '../../decorations/common/decorations.js';\nimport { Emitter } from '../../../../base/common/event.js';\nimport { Codicon } from '../../../../base/common/codicons.js';\nimport { listErrorForeground } from '../../../../platform/theme/common/colorRegistry.js';\n\nexport abstract class AbstractTextFileService extends Disposable implements ITextFileService {\n\n\tdeclare readonly _serviceBrand: undefined;\n\n\tprivate static readonly TEXTFILE_SAVE_CREATE_SOURCE = SaveSourceRegistry.registerSource('textFileCreate.source', localize('textFileCreate.source', \"File Created\"));\n\tprivate static readonly TEXTFILE_SAVE_REPLACE_SOURCE = SaveSourceRegistry.registerSource('textFileOverwrite.source', localize('textFileOverwrite.source', \"File Replaced\"));\n\n\treadonly files: ITextFileEditorModelManager;\n\n\treadonly untitled: IUntitledTextEditorModelManager;\n\n\tconstructor(\n\t\t@IFileService protected readonly fileService: IFileService,\n\t\t@IUntitledTextEditorService untitledTextEditorService: IUntitledTextEditorModelManager,\n\t\t@ILifecycleService protected readonly lifecycleService: ILifecycleService,\n\t\t@IInstantiationService protected readonly instantiationService: IInstantiationService,\n\t\t@IModelService private readonly modelService: IModelService,\n\t\t@IWorkbenchEnvironmentService protected readonly environmentService: IWorkbenchEnvironmentService,\n\t\t@IDialogService private readonly dialogService: IDialogService,\n\t\t@IFileDialogService private readonly fileDialogService: IFileDialogService,\n\t\t@ITextResourceConfigurationService protected readonly textResourceConfigurationService: ITextResourceConfigurationService,\n\t\t@IFilesConfigurationService protected readonly filesConfigurationService: IFilesConfigurationService,\n\t\t@ICodeEditorService private readonly codeEditorService: ICodeEditorService,\n\t\t@IPathService private readonly pathService: IPathService,\n\t\t@IWorkingCopyFileService private readonly workingCopyFileService: IWorkingCopyFileService,\n\t\t@IUriIdentityService private readonly uriIdentityService: IUriIdentityService,\n\t\t@ILanguageService private readonly languageService: ILanguageService,\n\t\t@ILogService protected readonly logService: ILogService,\n\t\t@IElevatedFileService private readonly elevatedFileService: IElevatedFileService,\n\t\t@IDecorationsService private readonly decorationsService: IDecorationsService\n\t) {\n\t\tsuper();\n\n\t\tthis.files = this._register(this.instantiationService.createInstance(TextFileEditorModelManager));\n\t\tthis.untitled = untitledTextEditorService;\n\n\t\tthis.provideDecorations();\n\t}\n\n\t//#region decorations\n\n\tprivate provideDecorations(): void {\n\n\t\t// Text file model decorations\n\t\tconst provider = this._register(new class extends Disposable implements IDecorationsProvider {\n\n\t\t\treadonly label = localize('textFileModelDecorations', \"Text File Model Decorations\");\n\n\t\t\tprivate readonly _onDidChange = this._register(new Emitter<URI[]>());\n\t\t\treadonly onDidChange = this._onDidChange.event;\n\n\t\t\tconstructor(private readonly files: ITextFileEditorModelManager) {\n\t\t\t\tsuper();\n\n\t\t\t\tthis.registerListeners();\n\t\t\t}\n\n\t\t\tprivate registerListeners(): void {\n\n\t\t\t\t// Creates\n\t\t\t\tthis._register(this.files.onDidResolve(({ model }) => {\n\t\t\t\t\tif (model.isReadonly() || model.hasState(TextFileEditorModelState.ORPHAN)) {\n\t\t\t\t\t\tthis._onDidChange.fire([model.resource]);\n\t\t\t\t\t}\n\t\t\t\t}));\n\n\t\t\t\t// Removals: once a text file model is no longer\n\t\t\t\t// under our control, make sure to signal this as\n\t\t\t\t// decoration change because from this point on we\n\t\t\t\t// have no way of updating the decoration anymore.\n\t\t\t\tthis._register(this.files.onDidRemove(modelUri => this._onDidChange.fire([modelUri])));\n\n\t\t\t\t// Changes\n\t\t\t\tthis._register(this.files.onDidChangeReadonly(model => this._onDidChange.fire([model.resource])));\n\t\t\t\tthis._register(this.files.onDidChangeOrphaned(model => this._onDidChange.fire([model.resource])));\n\t\t\t}\n\n\t\t\tprovideDecorations(uri: URI): IDecorationData | undefined {\n\t\t\t\tconst model = this.files.get(uri);\n\t\t\t\tif (!model || model.isDisposed()) {\n\t\t\t\t\treturn undefined;\n\t\t\t\t}\n\n\t\t\t\tconst isReadonly = model.isReadonly();\n\t\t\t\tconst isOrphaned = model.hasState(TextFileEditorModelState.ORPHAN);\n\n\t\t\t\t// Readonly + Orphaned\n\t\t\t\tif (isReadonly && isOrphaned) {\n\t\t\t\t\treturn {\n\t\t\t\t\t\tcolor: listErrorForeground,\n\t\t\t\t\t\tletter: Codicon.lockSmall,\n\t\t\t\t\t\tstrikethrough: true,\n\t\t\t\t\t\ttooltip: localize('readonlyAndDeleted', \"Deleted, Read-only\"),\n\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\t// Readonly\n\t\t\t\telse if (isReadonly) {\n\t\t\t\t\treturn {\n\t\t\t\t\t\tletter: Codicon.lockSmall,\n\t\t\t\t\t\ttooltip: localize('readonly', \"Read-only\"),\n\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\t// Orphaned\n\t\t\t\telse if (isOrphaned) {\n\t\t\t\t\treturn {\n\t\t\t\t\t\tcolor: listErrorForeground,\n\t\t\t\t\t\tstrikethrough: true,\n\t\t\t\t\t\ttooltip: localize('deleted', \"Deleted\"),\n\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\treturn undefined;\n\t\t\t}\n\t\t}(this.files));\n\n\t\tthis._register(this.decorationsService.registerDecorationsProvider(provider));\n\t}\n\n\t//#endregion\n\n\t//#region text file read / write / create\n\n\tprivate _encoding: EncodingOracle | undefined;\n\n\tget encoding(): EncodingOracle {\n\t\tif (!this._encoding) {\n\t\t\tthis._encoding = this._register(this.instantiationService.createInstance(EncodingOracle));\n\t\t}\n\n\t\treturn this._encoding;\n\t}\n\n\tasync read(resource: URI, options?: IReadTextFileOptions): Promise<ITextFileContent> {\n\t\tconst [bufferStream, decoder] = await this.doRead(resource, {\n\t\t\t...options,\n\t\t\t// optimization: since we know that the caller does not\n\t\t\t// care about buffering, we indicate this to the reader.\n\t\t\t// this reduces all the overhead the buffered reading\n\t\t\t// has (open, read, close) if the provider supports\n\t\t\t// unbuffered reading.\n\t\t\tpreferUnbuffered: true\n\t\t});\n\n\t\treturn {\n\t\t\t...bufferStream,\n\t\t\tencoding: decoder.detected.encoding || UTF8,\n\t\t\tvalue: await consumeStream(decoder.stream, strings => strings.join(''))\n\t\t};\n\t}\n\n\tasync readStream(resource: URI, options?: IReadTextFileOptions): Promise<ITextFileStreamContent> {\n\t\tconst [bufferStream, decoder] = await this.doRead(resource, options);\n\n\t\treturn {\n\t\t\t...bufferStream,\n\t\t\tencoding: decoder.detected.encoding || UTF8,\n\t\t\tvalue: await createTextBufferFactoryFromStream(decoder.stream)\n\t\t};\n\t}\n\n\tprivate async doRead(resource: URI, options?: IReadTextFileOptions & { preferUnbuffered?: boolean }): Promise<[IFileStreamContent, IDecodeStreamResult]> {\n\t\tconst cts = new CancellationTokenSource();\n\n\t\t// read stream raw (either buffered or unbuffered)\n\t\tlet bufferStream: IFileStreamContent;\n\t\tif (options?.preferUnbuffered) {\n\t\t\tconst content = await this.fileService.readFile(resource, options, cts.token);\n\t\t\tbufferStream = {\n\t\t\t\t...content,\n\t\t\t\tvalue: bufferToStream(content.value)\n\t\t\t};\n\t\t} else {\n\t\t\tbufferStream = await this.fileService.readFileStream(resource, options, cts.token);\n\t\t}\n\n\t\t// read through encoding library\n\t\ttry {\n\t\t\tconst decoder = await this.doGetDecodedStream(resource, bufferStream.value, options);\n\n\t\t\treturn [bufferStream, decoder];\n\t\t} catch (error) {\n\n\t\t\t// Make sure to cancel reading on error to\n\t\t\t// stop file service activity as soon as\n\t\t\t// possible. When for example a large binary\n\t\t\t// file is read we want to cancel the read\n\t\t\t// instantly.\n\t\t\t// Refs:\n\t\t\t// - https://github.com/microsoft/vscode/issues/138805\n\t\t\t// - https://github.com/microsoft/vscode/issues/132771\n\t\t\tcts.dispose(true);\n\n\t\t\t// special treatment for streams that are binary\n\t\t\tif ((<DecodeStreamError>error).decodeStreamErrorKind === DecodeStreamErrorKind.STREAM_IS_BINARY) {\n\t\t\t\tthrow new TextFileOperationError(localize('fileBinaryError', \"File seems to be binary and cannot be opened as text\"), TextFileOperationResult.FILE_IS_BINARY, options);\n\t\t\t}\n\n\t\t\t// re-throw any other error as it is\n\t\t\telse {\n\t\t\t\tthrow error;\n\t\t\t}\n\t\t}\n\t}\n\n\tasync create(operations: { resource: URI; value?: string | ITextSnapshot; options?: ICreateFileOptions }[], undoInfo?: IFileOperationUndoRedoInfo): Promise<readonly IFileStatWithMetadata[]> {\n\t\tconst operationsWithContents: ICreateFileOperation[] = await Promise.all(operations.map(async operation => {\n\t\t\tconst contents = await this.getEncodedReadable(operation.resource, operation.value);\n\t\t\treturn {\n\t\t\t\tresource: operation.resource,\n\t\t\t\tcontents,\n\t\t\t\toverwrite: operation.options?.overwrite\n\t\t\t};\n\t\t}));\n\n\t\treturn this.workingCopyFileService.create(operationsWithContents, CancellationToken.None, undoInfo);\n\t}\n\n\tasync write(resource: URI, value: string | ITextSnapshot, options?: IWriteTextFileOptions): Promise<IFileStatWithMetadata> {\n\t\tconst readable = await this.getEncodedReadable(resource, value, options);\n\n\t\tif (options?.writeElevated && this.elevatedFileService.isSupported(resource)) {\n\t\t\treturn this.elevatedFileService.writeFileElevated(resource, readable, options);\n\t\t}\n\n\t\treturn this.fileService.writeFile(resource, readable, options);\n\t}\n\n\tasync getEncodedReadable(resource: URI | undefined, value: ITextSnapshot): Promise<VSBufferReadable>;\n\tasync getEncodedReadable(resource: URI | undefined, value: string): Promise<VSBuffer | VSBufferReadable>;\n\tasync getEncodedReadable(resource: URI | undefined, value?: ITextSnapshot): Promise<VSBufferReadable | undefined>;\n\tasync getEncodedReadable(resource: URI | undefined, value?: string): Promise<VSBuffer | VSBufferReadable | undefined>;\n\tasync getEncodedReadable(resource: URI | undefined, value?: string | ITextSnapshot): Promise<VSBuffer | VSBufferReadable | undefined>;\n\tasync getEncodedReadable(resource: URI | undefined, value: string | ITextSnapshot, options?: IWriteTextFileOptions): Promise<VSBuffer | VSBufferReadable>;\n\tasync getEncodedReadable(resource: URI | undefined, value?: string | ITextSnapshot, options?: IWriteTextFileOptions): Promise<VSBuffer | VSBufferReadable | undefined> {\n\n\t\t// check for encoding\n\t\tconst { encoding, addBOM } = await this.encoding.getWriteEncoding(resource, options);\n\n\t\t// when encoding is standard skip encoding step\n\t\tif (encoding === UTF8 && !addBOM) {\n\t\t\treturn typeof value === 'undefined'\n\t\t\t\t? undefined\n\t\t\t\t: toBufferOrReadable(value);\n\t\t}\n\n\t\t// otherwise create encoded readable\n\t\tvalue = value || '';\n\t\tconst snapshot = typeof value === 'string' ? stringToSnapshot(value) : value;\n\t\treturn toEncodeReadable(snapshot, encoding, { addBOM });\n\t}\n\n\tasync getDecodedStream(resource: URI | undefined, value: VSBufferReadableStream, options?: IReadTextFileEncodingOptions): Promise<ReadableStream<string>> {\n\t\treturn (await this.doGetDecodedStream(resource, value, options)).stream;\n\t}\n\n\tprivate doGetDecodedStream(resource: URI | undefined, stream: VSBufferReadableStream, options?: IReadTextFileEncodingOptions): Promise<IDecodeStreamResult> {\n\n\t\t// read through encoding library\n\t\treturn toDecodeStream(stream, {\n\t\t\tacceptTextOnly: options?.acceptTextOnly ?? false,\n\t\t\tguessEncoding:\n\t\t\t\toptions?.autoGuessEncoding ||\n\t\t\t\tthis.textResourceConfigurationService.getValue(resource, 'files.autoGuessEncoding'),\n\t\t\tcandidateGuessEncodings:\n\t\t\t\toptions?.candidateGuessEncodings ||\n\t\t\t\tthis.textResourceConfigurationService.getValue(resource, 'files.candidateGuessEncodings'),\n\t\t\toverwriteEncoding: async detectedEncoding => this.validateDetectedEncoding(resource, detectedEncoding ?? undefined, options)\n\t\t});\n\t}\n\n\tgetEncoding(resource: URI): string {\n\t\tconst model = resource.scheme === Schemas.untitled ? this.untitled.get(resource) : this.files.get(resource);\n\t\treturn model?.getEncoding() ?? this.encoding.getUnvalidatedEncodingForResource(resource);\n\t}\n\n\tasync resolveDecoding(resource: URI | undefined, options?: IReadTextFileEncodingOptions): Promise<{ preferredEncoding: string; guessEncoding: boolean; candidateGuessEncodings: string[] }> {\n\t\treturn {\n\t\t\tpreferredEncoding: (await this.encoding.getPreferredReadEncoding(resource, options, undefined)).encoding,\n\t\t\tguessEncoding:\n\t\t\t\toptions?.autoGuessEncoding ||\n\t\t\t\tthis.textResourceConfigurationService.getValue(resource, 'files.autoGuessEncoding'),\n\t\t\tcandidateGuessEncodings:\n\t\t\t\toptions?.candidateGuessEncodings ||\n\t\t\t\tthis.textResourceConfigurationService.getValue(resource, 'files.candidateGuessEncodings'),\n\t\t};\n\t}\n\n\tasync validateDetectedEncoding(resource: URI | undefined, detectedEncoding: string | undefined, options?: IReadTextFileEncodingOptions): Promise<string> {\n\t\tconst { encoding } = await this.encoding.getPreferredReadEncoding(resource, options, detectedEncoding);\n\n\t\treturn encoding;\n\t}\n\n\tresolveEncoding(resource: URI | undefined, options?: IWriteTextFileOptions): Promise<{ encoding: string; addBOM: boolean }> {\n\t\treturn this.encoding.getWriteEncoding(resource, options);\n\t}\n\n\t//#endregion\n\n\n\t//#region save\n\n\tasync save(resource: URI, options?: ITextFileSaveOptions): Promise<URI | undefined> {\n\n\t\t// Untitled\n\t\tif (resource.scheme === Schemas.untitled) {\n\t\t\tconst model = this.untitled.get(resource);\n\t\t\tif (model) {\n\t\t\t\tlet targetUri: URI | undefined;\n\n\t\t\t\t// Untitled with associated file path don't need to prompt\n\t\t\t\tif (model.hasAssociatedFilePath) {\n\t\t\t\t\ttargetUri = await this.suggestSavePath(resource);\n\t\t\t\t}\n\n\t\t\t\t// Otherwise ask user\n\t\t\t\telse {\n\t\t\t\t\ttargetUri = await this.fileDialogService.pickFileToSave(await this.suggestSavePath(resource), options?.availableFileSystems);\n\t\t\t\t}\n\n\t\t\t\t// Save as if target provided\n\t\t\t\tif (targetUri) {\n\t\t\t\t\treturn this.saveAs(resource, targetUri, options);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// File\n\t\telse {\n\t\t\tconst model = this.files.get(resource);\n\t\t\tif (model) {\n\t\t\t\treturn await model.save(options) ? resource : undefined;\n\t\t\t}\n\t\t}\n\n\t\treturn undefined;\n\t}\n\n\tasync saveAs(source: URI, target?: URI, options?: ITextFileSaveAsOptions): Promise<URI | undefined> {\n\n\t\t// Get to target resource\n\t\tif (!target) {\n\t\t\ttarget = await this.fileDialogService.pickFileToSave(await this.suggestSavePath(options?.suggestedTarget ?? source), options?.availableFileSystems);\n\t\t}\n\n\t\tif (!target) {\n\t\t\treturn; // user canceled\n\t\t}\n\n\t\t// Ensure target is not marked as readonly and prompt otherwise\n\t\tif (this.filesConfigurationService.isReadonly(target)) {\n\t\t\tconst confirmed = await this.confirmMakeWriteable(target);\n\t\t\tif (!confirmed) {\n\t\t\t\treturn;\n\t\t\t} else {\n\t\t\t\tthis.filesConfigurationService.updateReadonly(target, false);\n\t\t\t}\n\t\t}\n\n\t\t// Just save if target is same as models own resource\n\t\tif (isEqual(source, target)) {\n\t\t\treturn this.save(source, { ...options, force: true  /* force to save, even if not dirty (https://github.com/microsoft/vscode/issues/99619) */ });\n\t\t}\n\n\t\t// If the target is different but of same identity, we\n\t\t// move the source to the target, knowing that the\n\t\t// underlying file system cannot have both and then save.\n\t\t// However, this will only work if the source exists\n\t\t// and is not orphaned, so we need to check that too.\n\t\tif (this.fileService.hasProvider(source) && this.uriIdentityService.extUri.isEqual(source, target) && (await this.fileService.exists(source))) {\n\t\t\tawait this.workingCopyFileService.move([{ file: { source, target } }], CancellationToken.None);\n\n\t\t\t// At this point we don't know whether we have a\n\t\t\t// model for the source or the target URI so we\n\t\t\t// simply try to save with both resources.\n\t\t\tconst success = await this.save(source, options);\n\t\t\tif (!success) {\n\t\t\t\tawait this.save(target, options);\n\t\t\t}\n\n\t\t\treturn target;\n\t\t}\n\n\t\t// Do it\n\t\treturn this.doSaveAs(source, target, options);\n\t}\n\n\tprivate async doSaveAs(source: URI, target: URI, options?: ITextFileSaveOptions): Promise<URI | undefined> {\n\t\tlet success = false;\n\n\t\tlet resolvedTextModel: IResolvedTextFileEditorModel | IResolvedUntitledTextEditorModel | undefined;\n\t\tif (source.scheme !== Schemas.untitled) {\n\t\t\tconst textFileModel = this.files.get(source);\n\t\t\tif (textFileModel?.isResolved()) {\n\t\t\t\tresolvedTextModel = textFileModel;\n\t\t\t}\n\t\t} else {\n\t\t\tconst untitledTextModel = this.untitled.get(source);\n\t\t\tif (untitledTextModel?.isResolved()) {\n\t\t\t\tresolvedTextModel = untitledTextModel;\n\t\t\t}\n\t\t}\n\n\t\t// If the source is an existing resolved file or untitled text model, we can\n\t\t// directly use that model to copy the contents to the target destination\n\t\tif (resolvedTextModel) {\n\t\t\tsuccess = await this.doSaveAsTextFile(resolvedTextModel, source, target, options);\n\t\t}\n\n\t\t// Otherwise if the source can be handled by the file service\n\t\t// we can simply invoke the copy() function to save as\n\t\telse if (this.fileService.hasProvider(source)) {\n\t\t\tawait this.fileService.copy(source, target, true);\n\n\t\t\tsuccess = true;\n\t\t}\n\n\t\t// Finally we simply check if we can find a editor model that\n\t\t// would give us access to the contents.\n\t\telse {\n\t\t\tconst textModel = this.modelService.getModel(source);\n\t\t\tif (textModel) {\n\t\t\t\tsuccess = await this.doSaveAsTextFile(textModel, source, target, options);\n\t\t\t}\n\t\t}\n\n\t\tif (!success) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\t// Revert the source\n\t\ttry {\n\t\t\tawait this.revert(source);\n\t\t} catch (error) {\n\n\t\t\t// It is possible that reverting the source fails, for example\n\t\t\t// when a remote is disconnected and we cannot read it anymore.\n\t\t\t// However, this should not interrupt the \"Save As\" flow, so\n\t\t\t// we gracefully catch the error and just log it.\n\n\t\t\tthis.logService.error(error);\n\t\t}\n\n\t\t// Events\n\t\tif (source.scheme === Schemas.untitled) {\n\t\t\tthis.untitled.notifyDidSave(source, target);\n\t\t}\n\n\t\treturn target;\n\t}\n\n\tprivate async doSaveAsTextFile(sourceModel: IResolvedTextEditorModel | IResolvedUntitledTextEditorModel | ITextModel, source: URI, target: URI, options?: ITextFileSaveOptions): Promise<boolean> {\n\n\t\t// Find source encoding if any\n\t\tlet sourceModelEncoding: string | undefined = undefined;\n\t\tconst sourceModelWithEncodingSupport = (sourceModel as unknown as IEncodingSupport);\n\t\tif (typeof sourceModelWithEncodingSupport.getEncoding === 'function') {\n\t\t\tsourceModelEncoding = sourceModelWithEncodingSupport.getEncoding();\n\t\t}\n\n\t\t// Prefer an existing model if it is already resolved for the given target resource\n\t\tlet targetExists = false;\n\t\tlet targetModel = this.files.get(target);\n\t\tif (targetModel?.isResolved()) {\n\t\t\ttargetExists = true;\n\t\t}\n\n\t\t// Otherwise create the target file empty if it does not exist already and resolve it from there\n\t\telse {\n\t\t\ttargetExists = await this.fileService.exists(target);\n\n\t\t\t// create target file adhoc if it does not exist yet\n\t\t\tif (!targetExists) {\n\t\t\t\tawait this.create([{ resource: target, value: '' }]);\n\t\t\t}\n\n\t\t\ttry {\n\t\t\t\ttargetModel = await this.files.resolve(target, { encoding: sourceModelEncoding });\n\t\t\t} catch (error) {\n\t\t\t\t// if the target already exists and was not created by us, it is possible\n\t\t\t\t// that we cannot resolve the target as text model if it is binary or too\n\t\t\t\t// large. in that case we have to delete the target file first and then\n\t\t\t\t// re-run the operation.\n\t\t\t\tif (targetExists) {\n\t\t\t\t\tif (\n\t\t\t\t\t\t(<TextFileOperationError>error).textFileOperationResult === TextFileOperationResult.FILE_IS_BINARY ||\n\t\t\t\t\t\t(<FileOperationError>error).fileOperationResult === FileOperationResult.FILE_TOO_LARGE\n\t\t\t\t\t) {\n\t\t\t\t\t\tawait this.fileService.del(target);\n\n\t\t\t\t\t\treturn this.doSaveAsTextFile(sourceModel, source, target, options);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tthrow error;\n\t\t\t}\n\t\t}\n\n\t\t// Confirm to overwrite if we have an untitled file with associated file where\n\t\t// the file actually exists on disk and we are instructed to save to that file\n\t\t// path. This can happen if the file was created after the untitled file was opened.\n\t\t// See https://github.com/microsoft/vscode/issues/67946\n\t\tlet write: boolean;\n\t\tif (sourceModel instanceof UntitledTextEditorModel && sourceModel.hasAssociatedFilePath && targetExists && this.uriIdentityService.extUri.isEqual(target, toLocalResource(sourceModel.resource, this.environmentService.remoteAuthority, this.pathService.defaultUriScheme))) {\n\t\t\twrite = await this.confirmOverwrite(target);\n\t\t} else {\n\t\t\twrite = true;\n\t\t}\n\n\t\tif (!write) {\n\t\t\treturn false;\n\t\t}\n\n\t\tlet sourceTextModel: ITextModel | undefined = undefined;\n\t\tif (sourceModel instanceof BaseTextEditorModel) {\n\t\t\tif (sourceModel.isResolved()) {\n\t\t\t\tsourceTextModel = sourceModel.textEditorModel ?? undefined;\n\t\t\t}\n\t\t} else {\n\t\t\tsourceTextModel = sourceModel as ITextModel;\n\t\t}\n\n\t\tlet targetTextModel: ITextModel | undefined = undefined;\n\t\tif (targetModel.isResolved()) {\n\t\t\ttargetTextModel = targetModel.textEditorModel;\n\t\t}\n\n\t\t// take over model value, encoding and language (only if more specific) from source model\n\t\tif (sourceTextModel && targetTextModel) {\n\n\t\t\t// encoding\n\t\t\ttargetModel.updatePreferredEncoding(sourceModelEncoding);\n\n\t\t\t// content\n\t\t\tthis.modelService.updateModel(targetTextModel, createTextBufferFactoryFromSnapshot(sourceTextModel.createSnapshot()));\n\n\t\t\t// language\n\t\t\tconst sourceLanguageId = sourceTextModel.getLanguageId();\n\t\t\tconst targetLanguageId = targetTextModel.getLanguageId();\n\t\t\tif (sourceLanguageId !== PLAINTEXT_LANGUAGE_ID && targetLanguageId === PLAINTEXT_LANGUAGE_ID) {\n\t\t\t\ttargetTextModel.setLanguage(sourceLanguageId); // only use if more specific than plain/text\n\t\t\t}\n\n\t\t\t// transient properties\n\t\t\tconst sourceTransientProperties = this.codeEditorService.getTransientModelProperties(sourceTextModel);\n\t\t\tif (sourceTransientProperties) {\n\t\t\t\tfor (const [key, value] of sourceTransientProperties) {\n\t\t\t\t\tthis.codeEditorService.setTransientModelProperty(targetTextModel, key, value);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// set source options depending on target exists or not\n\t\tif (!options?.source) {\n\t\t\toptions = {\n\t\t\t\t...options,\n\t\t\t\tsource: targetExists ? AbstractTextFileService.TEXTFILE_SAVE_REPLACE_SOURCE : AbstractTextFileService.TEXTFILE_SAVE_CREATE_SOURCE\n\t\t\t};\n\t\t}\n\n\t\t// save model\n\t\treturn targetModel.save({\n\t\t\t...options,\n\t\t\tfrom: source\n\t\t});\n\t}\n\n\tprivate async confirmOverwrite(resource: URI): Promise<boolean> {\n\t\tconst { confirmed } = await this.dialogService.confirm({\n\t\t\ttype: 'warning',\n\t\t\tmessage: localize('confirmOverwrite', \"'{0}' already exists. Do you want to replace it?\", basename(resource)),\n\t\t\tdetail: localize('overwriteIrreversible', \"A file or folder with the name '{0}' already exists in the folder '{1}'. Replacing it will overwrite its current contents.\", basename(resource), basename(dirname(resource))),\n\t\t\tprimaryButton: localize({ key: 'replaceButtonLabel', comment: ['&& denotes a mnemonic'] }, \"&&Replace\"),\n\t\t});\n\n\t\treturn confirmed;\n\t}\n\n\tprivate async confirmMakeWriteable(resource: URI): Promise<boolean> {\n\t\tconst { confirmed } = await this.dialogService.confirm({\n\t\t\ttype: 'warning',\n\t\t\tmessage: localize('confirmMakeWriteable', \"'{0}' is marked as read-only. Do you want to save anyway?\", basename(resource)),\n\t\t\tdetail: localize('confirmMakeWriteableDetail', \"Paths can be configured as read-only via settings.\"),\n\t\t\tprimaryButton: localize({ key: 'makeWriteableButtonLabel', comment: ['&& denotes a mnemonic'] }, \"&&Save Anyway\")\n\t\t});\n\n\t\treturn confirmed;\n\t}\n\n\tprivate async suggestSavePath(resource: URI): Promise<URI> {\n\n\t\t// Just take the resource as is if the file service can handle it\n\t\tif (this.fileService.hasProvider(resource)) {\n\t\t\treturn resource;\n\t\t}\n\n\t\tconst remoteAuthority = this.environmentService.remoteAuthority;\n\t\tconst defaultFilePath = await this.fileDialogService.defaultFilePath();\n\n\t\t// Otherwise try to suggest a path that can be saved\n\t\tlet suggestedFilename: string | undefined = undefined;\n\t\tif (resource.scheme === Schemas.untitled) {\n\t\t\tconst model = this.untitled.get(resource);\n\t\t\tif (model) {\n\n\t\t\t\t// Untitled with associated file path\n\t\t\t\tif (model.hasAssociatedFilePath) {\n\t\t\t\t\treturn toLocalResource(resource, remoteAuthority, this.pathService.defaultUriScheme);\n\t\t\t\t}\n\n\t\t\t\t// Untitled without associated file path: use name\n\t\t\t\t// of untitled model if it is a valid path name and\n\t\t\t\t// figure out the file extension from the mode if any.\n\n\t\t\t\tlet nameCandidate: string;\n\t\t\t\tif (await this.pathService.hasValidBasename(joinPath(defaultFilePath, model.name), model.name)) {\n\t\t\t\t\tnameCandidate = model.name;\n\t\t\t\t} else {\n\t\t\t\t\tnameCandidate = basename(resource);\n\t\t\t\t}\n\n\t\t\t\tconst languageId = model.getLanguageId();\n\t\t\t\tif (languageId && languageId !== PLAINTEXT_LANGUAGE_ID) {\n\t\t\t\t\tsuggestedFilename = this.suggestFilename(languageId, nameCandidate);\n\t\t\t\t} else {\n\t\t\t\t\tsuggestedFilename = nameCandidate;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// Fallback to basename of resource\n\t\tif (!suggestedFilename) {\n\t\t\tsuggestedFilename = basename(resource);\n\t\t}\n\n\t\t// Try to place where last active file was if any\n\t\t// Otherwise fallback to user home\n\t\treturn joinPath(defaultFilePath, suggestedFilename);\n\t}\n\n\tsuggestFilename(languageId: string, untitledName: string) {\n\t\tconst languageName = this.languageService.getLanguageName(languageId);\n\t\tif (!languageName) {\n\t\t\treturn untitledName; // unknown language, so we cannot suggest a better name\n\t\t}\n\n\t\tconst untitledExtension = pathExtname(untitledName);\n\n\t\tconst extensions = this.languageService.getExtensions(languageId);\n\t\tif (extensions.includes(untitledExtension)) {\n\t\t\treturn untitledName; // preserve extension if it is compatible with the mode\n\t\t}\n\n\t\tconst primaryExtension = extensions.at(0);\n\t\tif (primaryExtension) {\n\t\t\tif (untitledExtension) {\n\t\t\t\treturn `${untitledName.substring(0, untitledName.indexOf(untitledExtension))}${primaryExtension}`;\n\t\t\t}\n\n\t\t\treturn `${untitledName}${primaryExtension}`;\n\t\t}\n\n\t\tconst filenames = this.languageService.getFilenames(languageId);\n\t\tif (filenames.includes(untitledName)) {\n\t\t\treturn untitledName; // preserve name if it is compatible with the mode\n\t\t}\n\n\t\treturn filenames.at(0) ?? untitledName;\n\t}\n\n\t//#endregion\n\n\t//#region revert\n\n\tasync revert(resource: URI, options?: IRevertOptions): Promise<void> {\n\n\t\t// Untitled\n\t\tif (resource.scheme === Schemas.untitled) {\n\t\t\tconst model = this.untitled.get(resource);\n\t\t\tif (model) {\n\t\t\t\treturn model.revert(options);\n\t\t\t}\n\t\t}\n\n\t\t// File\n\t\telse {\n\t\t\tconst model = this.files.get(resource);\n\t\t\tif (model && (model.isDirty() || options?.force)) {\n\t\t\t\treturn model.revert(options);\n\t\t\t}\n\t\t}\n\t}\n\n\t//#endregion\n\n\t//#region dirty\n\n\tisDirty(resource: URI): boolean {\n\t\tconst model = resource.scheme === Schemas.untitled ? this.untitled.get(resource) : this.files.get(resource);\n\t\tif (model) {\n\t\t\treturn model.isDirty();\n\t\t}\n\n\t\treturn false;\n\t}\n\n\t//#endregion\n}\n\nexport interface IEncodingOverride {\n\tparent?: URI;\n\textension?: string;\n\tencoding: string;\n}\n\nexport class EncodingOracle extends Disposable implements IResourceEncodings {\n\n\tprivate _encodingOverrides: IEncodingOverride[];\n\tprotected get encodingOverrides(): IEncodingOverride[] { return this._encodingOverrides; }\n\tprotected set encodingOverrides(value: IEncodingOverride[]) { this._encodingOverrides = value; }\n\n\tconstructor(\n\t\t@ITextResourceConfigurationService private textResourceConfigurationService: ITextResourceConfigurationService,\n\t\t@IWorkbenchEnvironmentService private environmentService: IWorkbenchEnvironmentService,\n\t\t@IWorkspaceContextService private contextService: IWorkspaceContextService,\n\t\t@IUriIdentityService private readonly uriIdentityService: IUriIdentityService\n\t) {\n\t\tsuper();\n\n\t\tthis._encodingOverrides = this.getDefaultEncodingOverrides();\n\n\t\tthis.registerListeners();\n\t}\n\n\tprivate registerListeners(): void {\n\n\t\t// Workspace Folder Change\n\t\tthis._register(this.contextService.onDidChangeWorkspaceFolders(() => this.encodingOverrides = this.getDefaultEncodingOverrides()));\n\t}\n\n\tprivate getDefaultEncodingOverrides(): IEncodingOverride[] {\n\t\tconst defaultEncodingOverrides: IEncodingOverride[] = [];\n\n\t\t// Global settings\n\t\tdefaultEncodingOverrides.push({ parent: this.environmentService.userRoamingDataHome, encoding: UTF8 });\n\n\t\t// Workspace files (via extension and via untitled workspaces location)\n\t\tdefaultEncodingOverrides.push({ extension: WORKSPACE_EXTENSION, encoding: UTF8 });\n\t\tdefaultEncodingOverrides.push({ parent: this.environmentService.untitledWorkspacesHome, encoding: UTF8 });\n\n\t\t// Folder Settings\n\t\tthis.contextService.getWorkspace().folders.forEach(folder => {\n\t\t\tdefaultEncodingOverrides.push({ parent: joinPath(folder.uri, '.vscode'), encoding: UTF8 });\n\t\t});\n\n\t\treturn defaultEncodingOverrides;\n\t}\n\n\tasync getWriteEncoding(resource: URI | undefined, options?: IWriteTextFileOptions): Promise<{ encoding: string; addBOM: boolean }> {\n\t\tconst { encoding, hasBOM } = await this.getPreferredWriteEncoding(resource, options ? options.encoding : undefined);\n\n\t\treturn { encoding, addBOM: hasBOM };\n\t}\n\n\tasync getPreferredWriteEncoding(resource: URI | undefined, preferredEncoding?: string): Promise<IResourceEncoding> {\n\t\tconst resourceEncoding = await this.getValidatedEncodingForResource(resource, preferredEncoding);\n\n\t\treturn {\n\t\t\tencoding: resourceEncoding,\n\t\t\thasBOM: resourceEncoding === UTF16be || resourceEncoding === UTF16le || resourceEncoding === UTF8_with_bom // enforce BOM for certain encodings\n\t\t};\n\t}\n\n\tasync getPreferredReadEncoding(resource: URI | undefined, options?: IReadTextFileEncodingOptions, detectedEncoding?: string): Promise<IResourceEncoding> {\n\t\tlet preferredEncoding: string | undefined;\n\n\t\t// Encoding passed in as option\n\t\tif (options?.encoding) {\n\t\t\tif (detectedEncoding === UTF8_with_bom && options.encoding === UTF8) {\n\t\t\t\tpreferredEncoding = UTF8_with_bom; // indicate the file has BOM if we are to resolve with UTF 8\n\t\t\t} else {\n\t\t\t\tpreferredEncoding = options.encoding; // give passed in encoding highest priority\n\t\t\t}\n\t\t}\n\n\t\t// Encoding detected\n\t\telse if (typeof detectedEncoding === 'string') {\n\t\t\tpreferredEncoding = detectedEncoding;\n\t\t}\n\n\t\t// Encoding configured\n\t\telse if (this.textResourceConfigurationService.getValue(resource, 'files.encoding') === UTF8_with_bom) {\n\t\t\tpreferredEncoding = UTF8; // if we did not detect UTF 8 BOM before, this can only be UTF 8 then\n\t\t}\n\n\t\tconst encoding = await this.getValidatedEncodingForResource(resource, preferredEncoding);\n\n\t\treturn {\n\t\t\tencoding,\n\t\t\thasBOM: encoding === UTF16be || encoding === UTF16le || encoding === UTF8_with_bom // enforce BOM for certain encodings\n\t\t};\n\t}\n\n\tgetUnvalidatedEncodingForResource(resource: URI | undefined, preferredEncoding?: string): string {\n\t\tlet fileEncoding: string;\n\n\t\tconst override = this.getEncodingOverride(resource);\n\t\tif (override) {\n\t\t\tfileEncoding = override; // encoding override always wins\n\t\t} else if (preferredEncoding) {\n\t\t\tfileEncoding = preferredEncoding; // preferred encoding comes second\n\t\t} else {\n\t\t\tfileEncoding = this.textResourceConfigurationService.getValue(resource, 'files.encoding'); // and last we check for settings\n\t\t}\n\n\t\treturn fileEncoding || UTF8;\n\t}\n\n\tprivate async getValidatedEncodingForResource(resource: URI | undefined, preferredEncoding?: string): Promise<string> {\n\t\tlet fileEncoding = this.getUnvalidatedEncodingForResource(resource, preferredEncoding);\n\t\tif (fileEncoding !== UTF8 && !(await encodingExists(fileEncoding))) {\n\t\t\tfileEncoding = UTF8;\n\t\t}\n\n\t\treturn fileEncoding;\n\t}\n\n\tprivate getEncodingOverride(resource: URI | undefined): string | undefined {\n\t\tif (resource && this.encodingOverrides?.length) {\n\t\t\tfor (const override of this.encodingOverrides) {\n\n\t\t\t\t// check if the resource is child of encoding override path\n\t\t\t\tif (override.parent && this.uriIdentityService.extUri.isEqualOrParent(resource, override.parent)) {\n\t\t\t\t\treturn override.encoding;\n\t\t\t\t}\n\n\t\t\t\t// check if the resource extension is equal to encoding override\n\t\t\t\tif (override.extension && extname(resource) === `.${override.extension}`) {\n\t\t\t\t\treturn override.encoding;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn undefined;\n\t}\n}\n"]}