{"version":3,"sources":["vs/workbench/services/secrets/electron-browser/secretStorageService.ts"],"names":[],"mappings":"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","file":"secretStorageService.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { createSingleCallFunction } from '../../../../base/common/functional.js';\nimport { isLinux } from '../../../../base/common/platform.js';\nimport Severity from '../../../../base/common/severity.js';\nimport { localize } from '../../../../nls.js';\nimport { IDialogService } from '../../../../platform/dialogs/common/dialogs.js';\nimport { IEncryptionService, KnownStorageProvider, PasswordStoreCLIOption, isGnome, isKwallet } from '../../../../platform/encryption/common/encryptionService.js';\nimport { INativeEnvironmentService } from '../../../../platform/environment/common/environment.js';\nimport { InstantiationType, registerSingleton } from '../../../../platform/instantiation/common/extensions.js';\nimport { ILogService } from '../../../../platform/log/common/log.js';\nimport { INotificationService, IPromptChoice } from '../../../../platform/notification/common/notification.js';\nimport { IOpenerService } from '../../../../platform/opener/common/opener.js';\nimport { BaseSecretStorageService, ISecretStorageService } from '../../../../platform/secrets/common/secrets.js';\nimport { IStorageService } from '../../../../platform/storage/common/storage.js';\nimport { IJSONEditingService } from '../../configuration/common/jsonEditing.js';\n\nexport class NativeSecretStorageService extends BaseSecretStorageService {\n\n\tconstructor(\n\t\t@INotificationService private readonly _notificationService: INotificationService,\n\t\t@IDialogService private readonly _dialogService: IDialogService,\n\t\t@IOpenerService private readonly _openerService: IOpenerService,\n\t\t@IJSONEditingService private readonly _jsonEditingService: IJSONEditingService,\n\t\t@INativeEnvironmentService private readonly _environmentService: INativeEnvironmentService,\n\t\t@IStorageService storageService: IStorageService,\n\t\t@IEncryptionService encryptionService: IEncryptionService,\n\t\t@ILogService logService: ILogService\n\t) {\n\t\tsuper(\n\t\t\t!!_environmentService.useInMemorySecretStorage,\n\t\t\tstorageService,\n\t\t\tencryptionService,\n\t\t\tlogService\n\t\t);\n\t}\n\n\toverride set(key: string, value: string): Promise<void> {\n\t\tthis._sequencer.queue(key, async () => {\n\t\t\tawait this.resolvedStorageService;\n\n\t\t\tif (this.type !== 'persisted' && !this._environmentService.useInMemorySecretStorage) {\n\t\t\t\tthis._logService.trace('[NativeSecretStorageService] Notifying user that secrets are not being stored on disk.');\n\t\t\t\tawait this.notifyOfNoEncryptionOnce();\n\t\t\t}\n\n\t\t});\n\n\t\treturn super.set(key, value);\n\t}\n\n\tprivate notifyOfNoEncryptionOnce = createSingleCallFunction(() => this.notifyOfNoEncryption());\n\tprivate async notifyOfNoEncryption(): Promise<void> {\n\t\tconst buttons: IPromptChoice[] = [];\n\t\tconst troubleshootingButton: IPromptChoice = {\n\t\t\tlabel: localize('troubleshootingButton', \"Open troubleshooting guide\"),\n\t\t\trun: () => this._openerService.open('https://go.microsoft.com/fwlink/?linkid=2239490'),\n\t\t\t// doesn't close dialogs\n\t\t\tkeepOpen: true\n\t\t};\n\t\tbuttons.push(troubleshootingButton);\n\n\t\tlet errorMessage = localize('encryptionNotAvailableJustTroubleshootingGuide', \"An OS keyring couldn't be identified for storing the encryption related data in your current desktop environment.\");\n\n\t\tif (!isLinux) {\n\t\t\tthis._notificationService.prompt(Severity.Error, errorMessage, buttons);\n\t\t\treturn;\n\t\t}\n\n\t\tconst provider = await this._encryptionService.getKeyStorageProvider();\n\t\tif (provider === KnownStorageProvider.basicText) {\n\t\t\tconst detail = localize('usePlainTextExtraSentence', \"Open the troubleshooting guide to address this or you can use weaker encryption that doesn't use the OS keyring.\");\n\t\t\tconst usePlainTextButton: IPromptChoice = {\n\t\t\t\tlabel: localize('usePlainText', \"Use weaker encryption\"),\n\t\t\t\trun: async () => {\n\t\t\t\t\tawait this._encryptionService.setUsePlainTextEncryption();\n\t\t\t\t\tawait this._jsonEditingService.write(this._environmentService.argvResource, [{ path: ['password-store'], value: PasswordStoreCLIOption.basic }], true);\n\t\t\t\t\tthis.reinitialize();\n\t\t\t\t}\n\t\t\t};\n\t\t\tbuttons.unshift(usePlainTextButton);\n\n\t\t\tawait this._dialogService.prompt({\n\t\t\t\ttype: 'error',\n\t\t\t\tbuttons,\n\t\t\t\tmessage: errorMessage,\n\t\t\t\tdetail\n\t\t\t});\n\t\t\treturn;\n\t\t}\n\n\t\tif (isGnome(provider)) {\n\t\t\terrorMessage = localize('isGnome', \"You're running in a GNOME environment but the OS keyring is not available for encryption. Ensure you have gnome-keyring or another libsecret compatible implementation installed and running.\");\n\t\t} else if (isKwallet(provider)) {\n\t\t\terrorMessage = localize('isKwallet', \"You're running in a KDE environment but the OS keyring is not available for encryption. Ensure you have kwallet running.\");\n\t\t}\n\n\t\tthis._notificationService.prompt(Severity.Error, errorMessage, buttons);\n\t}\n}\n\nregisterSingleton(ISecretStorageService, NativeSecretStorageService, InstantiationType.Delayed);\n"]}