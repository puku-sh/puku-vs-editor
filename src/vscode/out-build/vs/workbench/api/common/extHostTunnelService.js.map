{"version":3,"sources":["vs/workbench/api/common/extHostTunnelService.ts"],"names":[],"mappings":"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","file":"extHostTunnelService.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { CancellationToken } from '../../../base/common/cancellation.js';\nimport { Emitter } from '../../../base/common/event.js';\nimport { Disposable, IDisposable, toDisposable } from '../../../base/common/lifecycle.js';\nimport * as nls from '../../../nls.js';\nimport { IExtensionDescription } from '../../../platform/extensions/common/extensions.js';\nimport { createDecorator } from '../../../platform/instantiation/common/instantiation.js';\nimport { ILogService } from '../../../platform/log/common/log.js';\nimport { DisposableTunnel, ProvidedOnAutoForward, ProvidedPortAttributes, RemoteTunnel, TunnelCreationOptions, TunnelOptions, TunnelPrivacyId } from '../../../platform/tunnel/common/tunnel.js';\nimport { ExtHostTunnelServiceShape, MainContext, MainThreadTunnelServiceShape, PortAttributesSelector, TunnelDto } from './extHost.protocol.js';\nimport { IExtHostInitDataService } from './extHostInitDataService.js';\nimport { IExtHostRpcService } from './extHostRpcService.js';\nimport * as types from './extHostTypes.js';\nimport { CandidatePort } from '../../services/remote/common/tunnelModel.js';\nimport * as vscode from 'vscode';\n\nclass ExtensionTunnel extends DisposableTunnel implements vscode.Tunnel { }\n\nexport namespace TunnelDtoConverter {\n\texport function fromApiTunnel(tunnel: vscode.Tunnel): TunnelDto {\n\t\treturn {\n\t\t\tremoteAddress: tunnel.remoteAddress,\n\t\t\tlocalAddress: tunnel.localAddress,\n\t\t\tpublic: !!tunnel.public,\n\t\t\tprivacy: tunnel.privacy ?? (tunnel.public ? TunnelPrivacyId.Public : TunnelPrivacyId.Private),\n\t\t\tprotocol: tunnel.protocol\n\t\t};\n\t}\n\texport function fromServiceTunnel(tunnel: RemoteTunnel): TunnelDto {\n\t\treturn {\n\t\t\tremoteAddress: {\n\t\t\t\thost: tunnel.tunnelRemoteHost,\n\t\t\t\tport: tunnel.tunnelRemotePort\n\t\t\t},\n\t\t\tlocalAddress: tunnel.localAddress,\n\t\t\tpublic: tunnel.privacy !== TunnelPrivacyId.ConstantPrivate && tunnel.privacy !== TunnelPrivacyId.ConstantPrivate,\n\t\t\tprivacy: tunnel.privacy,\n\t\t\tprotocol: tunnel.protocol\n\t\t};\n\t}\n}\n\nexport interface Tunnel extends vscode.Disposable {\n\tremote: { port: number; host: string };\n\tlocalAddress: string;\n}\n\nexport interface IExtHostTunnelService extends ExtHostTunnelServiceShape {\n\treadonly _serviceBrand: undefined;\n\topenTunnel(extension: IExtensionDescription, forward: TunnelOptions): Promise<vscode.Tunnel | undefined>;\n\tgetTunnels(): Promise<vscode.TunnelDescription[]>;\n\tonDidChangeTunnels: vscode.Event<void>;\n\tsetTunnelFactory(provider: vscode.RemoteAuthorityResolver | undefined, managedRemoteAuthority: vscode.ManagedResolvedAuthority | undefined): Promise<IDisposable>;\n\tregisterPortsAttributesProvider(portSelector: PortAttributesSelector, provider: vscode.PortAttributesProvider): IDisposable;\n\tregisterTunnelProvider(provider: vscode.TunnelProvider, information: vscode.TunnelInformation): Promise<IDisposable>;\n\thasTunnelProvider(): Promise<boolean>;\n}\n\nexport const IExtHostTunnelService = createDecorator<IExtHostTunnelService>('IExtHostTunnelService');\n\nexport class ExtHostTunnelService extends Disposable implements IExtHostTunnelService {\n\treadonly _serviceBrand: undefined;\n\tprotected readonly _proxy: MainThreadTunnelServiceShape;\n\tprivate _forwardPortProvider: ((tunnelOptions: TunnelOptions, tunnelCreationOptions: TunnelCreationOptions, token?: vscode.CancellationToken) => Thenable<vscode.Tunnel | undefined> | undefined) | undefined;\n\tprivate _showCandidatePort: (host: string, port: number, detail: string) => Thenable<boolean> = () => { return Promise.resolve(true); };\n\tprivate _extensionTunnels: Map<string, Map<number, { tunnel: vscode.Tunnel; disposeListener: IDisposable }>> = new Map();\n\tprivate _onDidChangeTunnels: Emitter<void> = new Emitter<void>();\n\tonDidChangeTunnels: vscode.Event<void> = this._onDidChangeTunnels.event;\n\n\tprivate _providerHandleCounter: number = 0;\n\tprivate _portAttributesProviders: Map<number, { provider: vscode.PortAttributesProvider; selector: PortAttributesSelector }> = new Map();\n\n\tconstructor(\n\t\t@IExtHostRpcService extHostRpc: IExtHostRpcService,\n\t\t@IExtHostInitDataService initData: IExtHostInitDataService,\n\t\t@ILogService protected readonly logService: ILogService\n\t) {\n\t\tsuper();\n\t\tthis._proxy = extHostRpc.getProxy(MainContext.MainThreadTunnelService);\n\t}\n\n\tasync openTunnel(extension: IExtensionDescription, forward: TunnelOptions): Promise<vscode.Tunnel | undefined> {\n\t\tthis.logService.trace(`ForwardedPorts: (ExtHostTunnelService) ${extension.identifier.value} called openTunnel API for ${forward.remoteAddress.host}:${forward.remoteAddress.port}.`);\n\t\tconst tunnel = await this._proxy.$openTunnel(forward, extension.displayName);\n\t\tif (tunnel) {\n\t\t\tconst disposableTunnel: vscode.Tunnel = new ExtensionTunnel(tunnel.remoteAddress, tunnel.localAddress, () => {\n\t\t\t\treturn this._proxy.$closeTunnel(tunnel.remoteAddress);\n\t\t\t});\n\t\t\tthis._register(disposableTunnel);\n\t\t\treturn disposableTunnel;\n\t\t}\n\t\treturn undefined;\n\t}\n\n\tasync getTunnels(): Promise<vscode.TunnelDescription[]> {\n\t\treturn this._proxy.$getTunnels();\n\t}\n\tprivate nextPortAttributesProviderHandle(): number {\n\t\treturn this._providerHandleCounter++;\n\t}\n\n\tregisterPortsAttributesProvider(portSelector: PortAttributesSelector, provider: vscode.PortAttributesProvider): vscode.Disposable {\n\t\tif (portSelector.portRange === undefined && portSelector.commandPattern === undefined) {\n\t\t\tthis.logService.error('PortAttributesProvider must specify either a portRange or a commandPattern');\n\t\t}\n\t\tconst providerHandle = this.nextPortAttributesProviderHandle();\n\t\tthis._portAttributesProviders.set(providerHandle, { selector: portSelector, provider });\n\n\t\tthis._proxy.$registerPortsAttributesProvider(portSelector, providerHandle);\n\t\treturn new types.Disposable(() => {\n\t\t\tthis._portAttributesProviders.delete(providerHandle);\n\t\t\tthis._proxy.$unregisterPortsAttributesProvider(providerHandle);\n\t\t});\n\t}\n\n\tasync $providePortAttributes(handles: number[], ports: number[], pid: number | undefined, commandLine: string | undefined, cancellationToken: vscode.CancellationToken): Promise<ProvidedPortAttributes[]> {\n\t\tconst providedAttributes: { providedAttributes: vscode.PortAttributes | null | undefined; port: number }[] = [];\n\t\tfor (const handle of handles) {\n\t\t\tconst provider = this._portAttributesProviders.get(handle);\n\t\t\tif (!provider) {\n\t\t\t\treturn [];\n\t\t\t}\n\t\t\tprovidedAttributes.push(...(await Promise.all(ports.map(async (port) => {\n\t\t\t\tlet providedAttributes: vscode.PortAttributes | null | undefined;\n\t\t\t\ttry {\n\t\t\t\t\tprovidedAttributes = await provider.provider.providePortAttributes({ port, pid, commandLine }, cancellationToken);\n\t\t\t\t} catch (e) {\n\t\t\t\t\t// Call with old signature for breaking API change\n\t\t\t\t\tprovidedAttributes = await (provider.provider.providePortAttributes as unknown as (port: number, pid: number | undefined, commandLine: string | undefined, token: vscode.CancellationToken) => vscode.ProviderResult<vscode.PortAttributes>)(port, pid, commandLine, cancellationToken);\n\t\t\t\t}\n\t\t\t\treturn { providedAttributes, port };\n\t\t\t}))));\n\t\t}\n\n\t\tconst allAttributes = <{ providedAttributes: vscode.PortAttributes; port: number }[]>providedAttributes.filter(attribute => !!attribute.providedAttributes);\n\n\t\treturn (allAttributes.length > 0) ? allAttributes.map(attributes => {\n\t\t\treturn {\n\t\t\t\tautoForwardAction: <ProvidedOnAutoForward><unknown>attributes.providedAttributes.autoForwardAction,\n\t\t\t\tport: attributes.port\n\t\t\t};\n\t\t}) : [];\n\t}\n\n\tasync $registerCandidateFinder(_enable: boolean): Promise<void> { }\n\n\tregisterTunnelProvider(provider: vscode.TunnelProvider, information: vscode.TunnelInformation): Promise<IDisposable> {\n\t\tif (this._forwardPortProvider) {\n\t\t\tthrow new Error('A tunnel provider has already been registered. Only the first tunnel provider to be registered will be used.');\n\t\t}\n\t\tthis._forwardPortProvider = async (tunnelOptions: TunnelOptions, tunnelCreationOptions: TunnelCreationOptions) => {\n\t\t\tconst result = await provider.provideTunnel(tunnelOptions, tunnelCreationOptions, CancellationToken.None);\n\t\t\treturn result ?? undefined;\n\t\t};\n\n\t\tconst tunnelFeatures = information.tunnelFeatures ? {\n\t\t\televation: !!information.tunnelFeatures?.elevation,\n\t\t\tprivacyOptions: information.tunnelFeatures?.privacyOptions,\n\t\t\tprotocol: information.tunnelFeatures.protocol === undefined ? true : information.tunnelFeatures.protocol,\n\t\t} : undefined;\n\n\t\tthis._proxy.$setTunnelProvider(tunnelFeatures, true);\n\t\treturn Promise.resolve(toDisposable(() => {\n\t\t\tthis._forwardPortProvider = undefined;\n\t\t\tthis._proxy.$setTunnelProvider(undefined, false);\n\t\t}));\n\t}\n\n\thasTunnelProvider(): Promise<boolean> {\n\t\treturn this._proxy.$hasTunnelProvider();\n\t}\n\n\t/**\n\t * Applies the tunnel metadata and factory found in the remote authority\n\t * resolver to the tunnel system.\n\t *\n\t * `managedRemoteAuthority` should be be passed if the resolver returned on.\n\t * If this is the case, the tunnel cannot be connected to via a websocket from\n\t * the share process, so a synethic tunnel factory is used as a default.\n\t */\n\tasync setTunnelFactory(provider: vscode.RemoteAuthorityResolver | undefined, managedRemoteAuthority: vscode.ManagedResolvedAuthority | undefined): Promise<IDisposable> {\n\t\t// Do not wait for any of the proxy promises here.\n\t\t// It will delay startup and there is nothing that needs to be waited for.\n\t\tif (provider) {\n\t\t\tif (provider.candidatePortSource !== undefined) {\n\t\t\t\tthis._proxy.$setCandidatePortSource(provider.candidatePortSource);\n\t\t\t}\n\t\t\tif (provider.showCandidatePort) {\n\t\t\t\tthis._showCandidatePort = provider.showCandidatePort;\n\t\t\t\tthis._proxy.$setCandidateFilter();\n\t\t\t}\n\t\t\tconst tunnelFactory = provider.tunnelFactory ?? (managedRemoteAuthority ? this.makeManagedTunnelFactory(managedRemoteAuthority) : undefined);\n\t\t\tif (tunnelFactory) {\n\t\t\t\tthis._forwardPortProvider = tunnelFactory;\n\t\t\t\tlet privacyOptions = provider.tunnelFeatures?.privacyOptions ?? [];\n\t\t\t\tif (provider.tunnelFeatures?.public && (privacyOptions.length === 0)) {\n\t\t\t\t\tprivacyOptions = [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tid: 'private',\n\t\t\t\t\t\t\tlabel: nls.localize('tunnelPrivacy.private', \"Private\"),\n\t\t\t\t\t\t\tthemeIcon: 'lock'\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tid: 'public',\n\t\t\t\t\t\t\tlabel: nls.localize('tunnelPrivacy.public', \"Public\"),\n\t\t\t\t\t\t\tthemeIcon: 'eye'\n\t\t\t\t\t\t}\n\t\t\t\t\t];\n\t\t\t\t}\n\n\t\t\t\tconst tunnelFeatures = provider.tunnelFeatures ? {\n\t\t\t\t\televation: !!provider.tunnelFeatures?.elevation,\n\t\t\t\t\tpublic: !!provider.tunnelFeatures?.public,\n\t\t\t\t\tprivacyOptions,\n\t\t\t\t\tprotocol: true\n\t\t\t\t} : undefined;\n\n\t\t\t\tthis._proxy.$setTunnelProvider(tunnelFeatures, !!provider.tunnelFactory);\n\t\t\t}\n\t\t} else {\n\t\t\tthis._forwardPortProvider = undefined;\n\t\t}\n\t\treturn toDisposable(() => {\n\t\t\tthis._forwardPortProvider = undefined;\n\t\t});\n\t}\n\n\tprotected makeManagedTunnelFactory(_authority: vscode.ManagedResolvedAuthority): vscode.RemoteAuthorityResolver['tunnelFactory'] {\n\t\treturn undefined; // may be overridden\n\t}\n\n\tasync $closeTunnel(remote: { host: string; port: number }, silent?: boolean): Promise<void> {\n\t\tif (this._extensionTunnels.has(remote.host)) {\n\t\t\tconst hostMap = this._extensionTunnels.get(remote.host)!;\n\t\t\tif (hostMap.has(remote.port)) {\n\t\t\t\tif (silent) {\n\t\t\t\t\thostMap.get(remote.port)!.disposeListener.dispose();\n\t\t\t\t}\n\t\t\t\tawait hostMap.get(remote.port)!.tunnel.dispose();\n\t\t\t\thostMap.delete(remote.port);\n\t\t\t}\n\t\t}\n\t}\n\n\tasync $onDidTunnelsChange(): Promise<void> {\n\t\tthis._onDidChangeTunnels.fire();\n\t}\n\n\tasync $forwardPort(tunnelOptions: TunnelOptions, tunnelCreationOptions: TunnelCreationOptions): Promise<TunnelDto | string | undefined> {\n\t\tif (this._forwardPortProvider) {\n\t\t\ttry {\n\t\t\t\tthis.logService.trace('ForwardedPorts: (ExtHostTunnelService) Getting tunnel from provider.');\n\t\t\t\tconst providedPort = this._forwardPortProvider(tunnelOptions, tunnelCreationOptions,);\n\t\t\t\tthis.logService.trace('ForwardedPorts: (ExtHostTunnelService) Got tunnel promise from provider.');\n\t\t\t\tif (providedPort !== undefined) {\n\t\t\t\t\tconst tunnel = await providedPort;\n\t\t\t\t\tthis.logService.trace('ForwardedPorts: (ExtHostTunnelService) Successfully awaited tunnel from provider.');\n\t\t\t\t\tif (tunnel === undefined) {\n\t\t\t\t\t\tthis.logService.error('ForwardedPorts: (ExtHostTunnelService) Resolved tunnel is undefined');\n\t\t\t\t\t\treturn undefined;\n\t\t\t\t\t}\n\t\t\t\t\tif (!this._extensionTunnels.has(tunnelOptions.remoteAddress.host)) {\n\t\t\t\t\t\tthis._extensionTunnels.set(tunnelOptions.remoteAddress.host, new Map());\n\t\t\t\t\t}\n\t\t\t\t\tconst disposeListener = this._register(tunnel.onDidDispose(() => {\n\t\t\t\t\t\tthis.logService.trace('ForwardedPorts: (ExtHostTunnelService) Extension fired tunnel\\'s onDidDispose.');\n\t\t\t\t\t\treturn this._proxy.$closeTunnel(tunnel.remoteAddress);\n\t\t\t\t\t}));\n\t\t\t\t\tthis._extensionTunnels.get(tunnelOptions.remoteAddress.host)!.set(tunnelOptions.remoteAddress.port, { tunnel, disposeListener });\n\t\t\t\t\treturn TunnelDtoConverter.fromApiTunnel(tunnel);\n\t\t\t\t} else {\n\t\t\t\t\tthis.logService.trace('ForwardedPorts: (ExtHostTunnelService) Tunnel is undefined');\n\t\t\t\t}\n\t\t\t} catch (e) {\n\t\t\t\tthis.logService.trace('ForwardedPorts: (ExtHostTunnelService) tunnel provider error');\n\t\t\t\tif (e instanceof Error) {\n\t\t\t\t\treturn e.message;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn undefined;\n\t}\n\n\tasync $applyCandidateFilter(candidates: CandidatePort[]): Promise<CandidatePort[]> {\n\t\tconst filter = await Promise.all(candidates.map(candidate => this._showCandidatePort(candidate.host, candidate.port, candidate.detail ?? '')));\n\t\tconst result = candidates.filter((candidate, index) => filter[index]);\n\t\tthis.logService.trace(`ForwardedPorts: (ExtHostTunnelService) filtered from ${candidates.map(port => port.port).join(', ')} to ${result.map(port => port.port).join(', ')}`);\n\t\treturn result;\n\t}\n}\n"]}