{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/api/common/extHostEmbedding.ts","vs/workbench/api/common/extHostEmbedding.ts"],"names":[],"mappings":"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","file":"extHostEmbedding.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { CancellationToken } from '../../../base/common/cancellation.js';\nimport { Emitter, Event } from '../../../base/common/event.js';\nimport { IDisposable, toDisposable } from '../../../base/common/lifecycle.js';\nimport { IExtensionDescription } from '../../../platform/extensions/common/extensions.js';\nimport { ExtHostEmbeddingsShape, IMainContext, MainContext, MainThreadEmbeddingsShape } from './extHost.protocol.js';\nimport type * as vscode from 'vscode';\n\n\nexport class ExtHostEmbeddings implements ExtHostEmbeddingsShape {\n\n\tprivate readonly _proxy: MainThreadEmbeddingsShape;\n\tprivate readonly _provider = new Map<number, { id: string; provider: vscode.EmbeddingsProvider }>();\n\n\tprivate readonly _onDidChange = new Emitter<void>();\n\treadonly onDidChange: Event<void> = this._onDidChange.event;\n\n\tprivate _allKnownModels = new Set<string>();\n\tprivate _handlePool: number = 0;\n\n\tconstructor(\n\t\tmainContext: IMainContext\n\t) {\n\t\tthis._proxy = mainContext.getProxy(MainContext.MainThreadEmbeddings);\n\t}\n\n\tregisterEmbeddingsProvider(_extension: IExtensionDescription, embeddingsModel: string, provider: vscode.EmbeddingsProvider): IDisposable {\n\t\tif (this._allKnownModels.has(embeddingsModel)) {\n\t\t\tthrow new Error('An embeddings provider for this model is already registered');\n\t\t}\n\n\t\tconst handle = this._handlePool++;\n\n\t\tthis._proxy.$registerEmbeddingProvider(handle, embeddingsModel);\n\t\tthis._provider.set(handle, { id: embeddingsModel, provider });\n\n\t\treturn toDisposable(() => {\n\t\t\tthis._allKnownModels.delete(embeddingsModel);\n\t\t\tthis._proxy.$unregisterEmbeddingProvider(handle);\n\t\t\tthis._provider.delete(handle);\n\t\t});\n\t}\n\n\tasync computeEmbeddings(embeddingsModel: string, input: string, token?: vscode.CancellationToken): Promise<vscode.Embedding>;\n\tasync computeEmbeddings(embeddingsModel: string, input: string[], token?: vscode.CancellationToken): Promise<vscode.Embedding[]>;\n\tasync computeEmbeddings(embeddingsModel: string, input: string | string[], token?: vscode.CancellationToken): Promise<vscode.Embedding[] | vscode.Embedding> {\n\n\t\ttoken ??= CancellationToken.None;\n\n\t\tlet returnSingle = false;\n\t\tif (typeof input === 'string') {\n\t\t\tinput = [input];\n\t\t\treturnSingle = true;\n\t\t}\n\t\tconst result = await this._proxy.$computeEmbeddings(embeddingsModel, input, token);\n\t\tif (result.length !== input.length) {\n\t\t\tthrow new Error();\n\t\t}\n\t\tif (returnSingle) {\n\t\t\tif (result.length !== 1) {\n\t\t\t\tthrow new Error();\n\t\t\t}\n\t\t\treturn result[0];\n\t\t}\n\t\treturn result;\n\n\t}\n\n\tasync $provideEmbeddings(handle: number, input: string[], token: CancellationToken): Promise<{ values: number[] }[]> {\n\t\tconst data = this._provider.get(handle);\n\t\tif (!data) {\n\t\t\treturn [];\n\t\t}\n\t\tconst result = await data.provider.provideEmbeddings(input, token);\n\t\tif (!result) {\n\t\t\treturn [];\n\t\t}\n\t\treturn result;\n\t}\n\n\tget embeddingsModels(): string[] {\n\t\treturn Array.from(this._allKnownModels);\n\t}\n\n\t$acceptEmbeddingModels(models: string[]): void {\n\t\tthis._allKnownModels = new Set(models);\n\t\tthis._onDidChange.fire();\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { CancellationToken } from '../../../base/common/cancellation.js';\nimport { Emitter, Event } from '../../../base/common/event.js';\nimport { IDisposable, toDisposable } from '../../../base/common/lifecycle.js';\nimport { IExtensionDescription } from '../../../platform/extensions/common/extensions.js';\nimport { ExtHostEmbeddingsShape, IMainContext, MainContext, MainThreadEmbeddingsShape } from './extHost.protocol.js';\nimport type * as vscode from 'vscode';\n\n\nexport class ExtHostEmbeddings implements ExtHostEmbeddingsShape {\n\n\tprivate readonly _proxy: MainThreadEmbeddingsShape;\n\tprivate readonly _provider = new Map<number, { id: string; provider: vscode.EmbeddingsProvider }>();\n\n\tprivate readonly _onDidChange = new Emitter<void>();\n\treadonly onDidChange: Event<void> = this._onDidChange.event;\n\n\tprivate _allKnownModels = new Set<string>();\n\tprivate _handlePool: number = 0;\n\n\tconstructor(\n\t\tmainContext: IMainContext\n\t) {\n\t\tthis._proxy = mainContext.getProxy(MainContext.MainThreadEmbeddings);\n\t}\n\n\tregisterEmbeddingsProvider(_extension: IExtensionDescription, embeddingsModel: string, provider: vscode.EmbeddingsProvider): IDisposable {\n\t\tif (this._allKnownModels.has(embeddingsModel)) {\n\t\t\tthrow new Error('An embeddings provider for this model is already registered');\n\t\t}\n\n\t\tconst handle = this._handlePool++;\n\n\t\tthis._proxy.$registerEmbeddingProvider(handle, embeddingsModel);\n\t\tthis._provider.set(handle, { id: embeddingsModel, provider });\n\n\t\treturn toDisposable(() => {\n\t\t\tthis._allKnownModels.delete(embeddingsModel);\n\t\t\tthis._proxy.$unregisterEmbeddingProvider(handle);\n\t\t\tthis._provider.delete(handle);\n\t\t});\n\t}\n\n\tasync computeEmbeddings(embeddingsModel: string, input: string, token?: vscode.CancellationToken): Promise<vscode.Embedding>;\n\tasync computeEmbeddings(embeddingsModel: string, input: string[], token?: vscode.CancellationToken): Promise<vscode.Embedding[]>;\n\tasync computeEmbeddings(embeddingsModel: string, input: string | string[], token?: vscode.CancellationToken): Promise<vscode.Embedding[] | vscode.Embedding> {\n\n\t\ttoken ??= CancellationToken.None;\n\n\t\tlet returnSingle = false;\n\t\tif (typeof input === 'string') {\n\t\t\tinput = [input];\n\t\t\treturnSingle = true;\n\t\t}\n\t\tconst result = await this._proxy.$computeEmbeddings(embeddingsModel, input, token);\n\t\tif (result.length !== input.length) {\n\t\t\tthrow new Error();\n\t\t}\n\t\tif (returnSingle) {\n\t\t\tif (result.length !== 1) {\n\t\t\t\tthrow new Error();\n\t\t\t}\n\t\t\treturn result[0];\n\t\t}\n\t\treturn result;\n\n\t}\n\n\tasync $provideEmbeddings(handle: number, input: string[], token: CancellationToken): Promise<{ values: number[] }[]> {\n\t\tconst data = this._provider.get(handle);\n\t\tif (!data) {\n\t\t\treturn [];\n\t\t}\n\t\tconst result = await data.provider.provideEmbeddings(input, token);\n\t\tif (!result) {\n\t\t\treturn [];\n\t\t}\n\t\treturn result;\n\t}\n\n\tget embeddingsModels(): string[] {\n\t\treturn Array.from(this._allKnownModels);\n\t}\n\n\t$acceptEmbeddingModels(models: string[]): void {\n\t\tthis._allKnownModels = new Set(models);\n\t\tthis._onDidChange.fire();\n\t}\n}\n"]}