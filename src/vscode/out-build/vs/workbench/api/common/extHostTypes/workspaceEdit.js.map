{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/api/common/extHostTypes/workspaceEdit.ts","vs/workbench/api/common/extHostTypes/workspaceEdit.ts"],"names":[],"mappings":"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","file":"workspaceEdit.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport type * as vscode from 'vscode';\nimport { coalesceInPlace } from '../../../../base/common/arrays.js';\nimport { ResourceMap } from '../../../../base/common/map.js';\nimport { URI } from '../../../../base/common/uri.js';\nimport { CellEditType, ICellMetadataEdit, IDocumentMetadataEdit } from '../../../contrib/notebook/common/notebookCommon.js';\nimport { NotebookEdit } from './notebooks.js';\nimport { SnippetTextEdit } from './snippetTextEdit.js';\nimport { es5ClassCompat } from './es5ClassCompat.js';\nimport { Position } from './position.js';\nimport { Range } from './range.js';\nimport { TextEdit } from './textEdit.js';\n\nexport interface IFileOperationOptions {\n\treadonly overwrite?: boolean;\n\treadonly ignoreIfExists?: boolean;\n\treadonly ignoreIfNotExists?: boolean;\n\treadonly recursive?: boolean;\n\treadonly contents?: Uint8Array | vscode.DataTransferFile;\n}\n\nexport const enum FileEditType {\n\tFile = 1,\n\tText = 2,\n\tCell = 3,\n\tCellReplace = 5,\n\tSnippet = 6,\n}\n\nexport interface IFileOperation {\n\treadonly _type: FileEditType.File;\n\treadonly from?: URI;\n\treadonly to?: URI;\n\treadonly options?: IFileOperationOptions;\n\treadonly metadata?: vscode.WorkspaceEditEntryMetadata;\n}\n\nexport interface IFileTextEdit {\n\treadonly _type: FileEditType.Text;\n\treadonly uri: URI;\n\treadonly edit: TextEdit;\n\treadonly metadata?: vscode.WorkspaceEditEntryMetadata;\n}\n\nexport interface IFileSnippetTextEdit {\n\treadonly _type: FileEditType.Snippet;\n\treadonly uri: URI;\n\treadonly range: vscode.Range;\n\treadonly edit: vscode.SnippetString;\n\treadonly metadata?: vscode.WorkspaceEditEntryMetadata;\n\treadonly keepWhitespace?: boolean;\n}\n\nexport interface IFileCellEdit {\n\treadonly _type: FileEditType.Cell;\n\treadonly uri: URI;\n\treadonly edit?: ICellMetadataEdit | IDocumentMetadataEdit;\n\treadonly metadata?: vscode.WorkspaceEditEntryMetadata;\n}\n\nexport interface ICellEdit {\n\treadonly _type: FileEditType.CellReplace;\n\treadonly metadata?: vscode.WorkspaceEditEntryMetadata;\n\treadonly uri: URI;\n\treadonly index: number;\n\treadonly count: number;\n\treadonly cells: vscode.NotebookCellData[];\n}\n\nexport type WorkspaceEditEntry = IFileOperation | IFileTextEdit | IFileSnippetTextEdit | IFileCellEdit | ICellEdit;\n\n@es5ClassCompat\nexport class WorkspaceEdit implements vscode.WorkspaceEdit {\n\n\tprivate readonly _edits: WorkspaceEditEntry[] = [];\n\n\n\t_allEntries(): ReadonlyArray<WorkspaceEditEntry> {\n\t\treturn this._edits;\n\t}\n\n\t// --- file\n\trenameFile(from: vscode.Uri, to: vscode.Uri, options?: { readonly overwrite?: boolean; readonly ignoreIfExists?: boolean }, metadata?: vscode.WorkspaceEditEntryMetadata): void {\n\t\tthis._edits.push({ _type: FileEditType.File, from, to, options, metadata });\n\t}\n\n\tcreateFile(uri: vscode.Uri, options?: { readonly overwrite?: boolean; readonly ignoreIfExists?: boolean; readonly contents?: Uint8Array | vscode.DataTransferFile }, metadata?: vscode.WorkspaceEditEntryMetadata): void {\n\t\tthis._edits.push({ _type: FileEditType.File, from: undefined, to: uri, options, metadata });\n\t}\n\n\tdeleteFile(uri: vscode.Uri, options?: { readonly recursive?: boolean; readonly ignoreIfNotExists?: boolean }, metadata?: vscode.WorkspaceEditEntryMetadata): void {\n\t\tthis._edits.push({ _type: FileEditType.File, from: uri, to: undefined, options, metadata });\n\t}\n\n\t// --- notebook\n\tprivate replaceNotebookMetadata(uri: URI, value: Record<string, unknown>, metadata?: vscode.WorkspaceEditEntryMetadata): void {\n\t\tthis._edits.push({ _type: FileEditType.Cell, metadata, uri, edit: { editType: CellEditType.DocumentMetadata, metadata: value } });\n\t}\n\n\tprivate replaceNotebookCells(uri: URI, startOrRange: vscode.NotebookRange, cellData: vscode.NotebookCellData[], metadata?: vscode.WorkspaceEditEntryMetadata): void {\n\t\tconst start = startOrRange.start;\n\t\tconst end = startOrRange.end;\n\n\t\tif (start !== end || cellData.length > 0) {\n\t\t\tthis._edits.push({ _type: FileEditType.CellReplace, uri, index: start, count: end - start, cells: cellData, metadata });\n\t\t}\n\t}\n\n\tprivate replaceNotebookCellMetadata(uri: URI, index: number, cellMetadata: Record<string, unknown>, metadata?: vscode.WorkspaceEditEntryMetadata): void {\n\t\tthis._edits.push({ _type: FileEditType.Cell, metadata, uri, edit: { editType: CellEditType.Metadata, index, metadata: cellMetadata } });\n\t}\n\n\t// --- text\n\treplace(uri: URI, range: Range, newText: string, metadata?: vscode.WorkspaceEditEntryMetadata): void {\n\t\tthis._edits.push({ _type: FileEditType.Text, uri, edit: new TextEdit(range, newText), metadata });\n\t}\n\n\tinsert(resource: URI, position: Position, newText: string, metadata?: vscode.WorkspaceEditEntryMetadata): void {\n\t\tthis.replace(resource, new Range(position, position), newText, metadata);\n\t}\n\n\tdelete(resource: URI, range: Range, metadata?: vscode.WorkspaceEditEntryMetadata): void {\n\t\tthis.replace(resource, range, '', metadata);\n\t}\n\n\t// --- text (Maplike)\n\thas(uri: URI): boolean {\n\t\treturn this._edits.some(edit => edit._type === FileEditType.Text && edit.uri.toString() === uri.toString());\n\t}\n\n\tset(uri: URI, edits: ReadonlyArray<TextEdit | SnippetTextEdit>): void;\n\tset(uri: URI, edits: ReadonlyArray<[TextEdit | SnippetTextEdit, vscode.WorkspaceEditEntryMetadata | undefined]>): void;\n\tset(uri: URI, edits: readonly NotebookEdit[]): void;\n\tset(uri: URI, edits: ReadonlyArray<[NotebookEdit, vscode.WorkspaceEditEntryMetadata | undefined]>): void;\n\n\tset(uri: URI, edits: null | undefined | ReadonlyArray<TextEdit | SnippetTextEdit | NotebookEdit | [NotebookEdit, vscode.WorkspaceEditEntryMetadata | undefined] | [TextEdit | SnippetTextEdit, vscode.WorkspaceEditEntryMetadata | undefined]>): void {\n\t\tif (!edits) {\n\t\t\t// remove all text, snippet, or notebook edits for `uri`\n\t\t\tfor (let i = 0; i < this._edits.length; i++) {\n\t\t\t\tconst element = this._edits[i];\n\t\t\t\tswitch (element._type) {\n\t\t\t\t\tcase FileEditType.Text:\n\t\t\t\t\tcase FileEditType.Snippet:\n\t\t\t\t\tcase FileEditType.Cell:\n\t\t\t\t\tcase FileEditType.CellReplace:\n\t\t\t\t\t\tif (element.uri.toString() === uri.toString()) {\n\t\t\t\t\t\t\tthis._edits[i] = undefined!; // will be coalesced down below\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t\tcoalesceInPlace(this._edits);\n\t\t} else {\n\t\t\t// append edit to the end\n\t\t\tfor (const editOrTuple of edits) {\n\t\t\t\tif (!editOrTuple) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tlet edit: TextEdit | SnippetTextEdit | NotebookEdit;\n\t\t\t\tlet metadata: vscode.WorkspaceEditEntryMetadata | undefined;\n\t\t\t\tif (Array.isArray(editOrTuple)) {\n\t\t\t\t\tedit = editOrTuple[0];\n\t\t\t\t\tmetadata = editOrTuple[1];\n\t\t\t\t} else {\n\t\t\t\t\tedit = editOrTuple;\n\t\t\t\t}\n\t\t\t\tif (NotebookEdit.isNotebookCellEdit(edit)) {\n\t\t\t\t\tif (edit.newCellMetadata) {\n\t\t\t\t\t\tthis.replaceNotebookCellMetadata(uri, edit.range.start, edit.newCellMetadata, metadata);\n\t\t\t\t\t} else if (edit.newNotebookMetadata) {\n\t\t\t\t\t\tthis.replaceNotebookMetadata(uri, edit.newNotebookMetadata, metadata);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.replaceNotebookCells(uri, edit.range, edit.newCells, metadata);\n\t\t\t\t\t}\n\t\t\t\t} else if (SnippetTextEdit.isSnippetTextEdit(edit)) {\n\t\t\t\t\tthis._edits.push({ _type: FileEditType.Snippet, uri, range: edit.range, edit: edit.snippet, metadata, keepWhitespace: edit.keepWhitespace });\n\n\t\t\t\t} else {\n\t\t\t\t\tthis._edits.push({ _type: FileEditType.Text, uri, edit, metadata });\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tget(uri: URI): TextEdit[] {\n\t\tconst res: TextEdit[] = [];\n\t\tfor (const candidate of this._edits) {\n\t\t\tif (candidate._type === FileEditType.Text && candidate.uri.toString() === uri.toString()) {\n\t\t\t\tres.push(candidate.edit);\n\t\t\t}\n\t\t}\n\t\treturn res;\n\t}\n\n\tentries(): [URI, TextEdit[]][] {\n\t\tconst textEdits = new ResourceMap<[URI, TextEdit[]]>();\n\t\tfor (const candidate of this._edits) {\n\t\t\tif (candidate._type === FileEditType.Text) {\n\t\t\t\tlet textEdit = textEdits.get(candidate.uri);\n\t\t\t\tif (!textEdit) {\n\t\t\t\t\ttextEdit = [candidate.uri, []];\n\t\t\t\t\ttextEdits.set(candidate.uri, textEdit);\n\t\t\t\t}\n\t\t\t\ttextEdit[1].push(candidate.edit);\n\t\t\t}\n\t\t}\n\t\treturn [...textEdits.values()];\n\t}\n\n\tget size(): number {\n\t\treturn this.entries().length;\n\t}\n\n\ttoJSON(): [URI, TextEdit[]][] {\n\t\treturn this.entries();\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport type * as vscode from 'vscode';\nimport { coalesceInPlace } from '../../../../base/common/arrays.js';\nimport { ResourceMap } from '../../../../base/common/map.js';\nimport { URI } from '../../../../base/common/uri.js';\nimport { CellEditType, ICellMetadataEdit, IDocumentMetadataEdit } from '../../../contrib/notebook/common/notebookCommon.js';\nimport { NotebookEdit } from './notebooks.js';\nimport { SnippetTextEdit } from './snippetTextEdit.js';\nimport { es5ClassCompat } from './es5ClassCompat.js';\nimport { Position } from './position.js';\nimport { Range } from './range.js';\nimport { TextEdit } from './textEdit.js';\n\nexport interface IFileOperationOptions {\n\treadonly overwrite?: boolean;\n\treadonly ignoreIfExists?: boolean;\n\treadonly ignoreIfNotExists?: boolean;\n\treadonly recursive?: boolean;\n\treadonly contents?: Uint8Array | vscode.DataTransferFile;\n}\n\nexport const enum FileEditType {\n\tFile = 1,\n\tText = 2,\n\tCell = 3,\n\tCellReplace = 5,\n\tSnippet = 6,\n}\n\nexport interface IFileOperation {\n\treadonly _type: FileEditType.File;\n\treadonly from?: URI;\n\treadonly to?: URI;\n\treadonly options?: IFileOperationOptions;\n\treadonly metadata?: vscode.WorkspaceEditEntryMetadata;\n}\n\nexport interface IFileTextEdit {\n\treadonly _type: FileEditType.Text;\n\treadonly uri: URI;\n\treadonly edit: TextEdit;\n\treadonly metadata?: vscode.WorkspaceEditEntryMetadata;\n}\n\nexport interface IFileSnippetTextEdit {\n\treadonly _type: FileEditType.Snippet;\n\treadonly uri: URI;\n\treadonly range: vscode.Range;\n\treadonly edit: vscode.SnippetString;\n\treadonly metadata?: vscode.WorkspaceEditEntryMetadata;\n\treadonly keepWhitespace?: boolean;\n}\n\nexport interface IFileCellEdit {\n\treadonly _type: FileEditType.Cell;\n\treadonly uri: URI;\n\treadonly edit?: ICellMetadataEdit | IDocumentMetadataEdit;\n\treadonly metadata?: vscode.WorkspaceEditEntryMetadata;\n}\n\nexport interface ICellEdit {\n\treadonly _type: FileEditType.CellReplace;\n\treadonly metadata?: vscode.WorkspaceEditEntryMetadata;\n\treadonly uri: URI;\n\treadonly index: number;\n\treadonly count: number;\n\treadonly cells: vscode.NotebookCellData[];\n}\n\nexport type WorkspaceEditEntry = IFileOperation | IFileTextEdit | IFileSnippetTextEdit | IFileCellEdit | ICellEdit;\n\n@es5ClassCompat\nexport class WorkspaceEdit implements vscode.WorkspaceEdit {\n\n\tprivate readonly _edits: WorkspaceEditEntry[] = [];\n\n\n\t_allEntries(): ReadonlyArray<WorkspaceEditEntry> {\n\t\treturn this._edits;\n\t}\n\n\t// --- file\n\trenameFile(from: vscode.Uri, to: vscode.Uri, options?: { readonly overwrite?: boolean; readonly ignoreIfExists?: boolean }, metadata?: vscode.WorkspaceEditEntryMetadata): void {\n\t\tthis._edits.push({ _type: FileEditType.File, from, to, options, metadata });\n\t}\n\n\tcreateFile(uri: vscode.Uri, options?: { readonly overwrite?: boolean; readonly ignoreIfExists?: boolean; readonly contents?: Uint8Array | vscode.DataTransferFile }, metadata?: vscode.WorkspaceEditEntryMetadata): void {\n\t\tthis._edits.push({ _type: FileEditType.File, from: undefined, to: uri, options, metadata });\n\t}\n\n\tdeleteFile(uri: vscode.Uri, options?: { readonly recursive?: boolean; readonly ignoreIfNotExists?: boolean }, metadata?: vscode.WorkspaceEditEntryMetadata): void {\n\t\tthis._edits.push({ _type: FileEditType.File, from: uri, to: undefined, options, metadata });\n\t}\n\n\t// --- notebook\n\tprivate replaceNotebookMetadata(uri: URI, value: Record<string, unknown>, metadata?: vscode.WorkspaceEditEntryMetadata): void {\n\t\tthis._edits.push({ _type: FileEditType.Cell, metadata, uri, edit: { editType: CellEditType.DocumentMetadata, metadata: value } });\n\t}\n\n\tprivate replaceNotebookCells(uri: URI, startOrRange: vscode.NotebookRange, cellData: vscode.NotebookCellData[], metadata?: vscode.WorkspaceEditEntryMetadata): void {\n\t\tconst start = startOrRange.start;\n\t\tconst end = startOrRange.end;\n\n\t\tif (start !== end || cellData.length > 0) {\n\t\t\tthis._edits.push({ _type: FileEditType.CellReplace, uri, index: start, count: end - start, cells: cellData, metadata });\n\t\t}\n\t}\n\n\tprivate replaceNotebookCellMetadata(uri: URI, index: number, cellMetadata: Record<string, unknown>, metadata?: vscode.WorkspaceEditEntryMetadata): void {\n\t\tthis._edits.push({ _type: FileEditType.Cell, metadata, uri, edit: { editType: CellEditType.Metadata, index, metadata: cellMetadata } });\n\t}\n\n\t// --- text\n\treplace(uri: URI, range: Range, newText: string, metadata?: vscode.WorkspaceEditEntryMetadata): void {\n\t\tthis._edits.push({ _type: FileEditType.Text, uri, edit: new TextEdit(range, newText), metadata });\n\t}\n\n\tinsert(resource: URI, position: Position, newText: string, metadata?: vscode.WorkspaceEditEntryMetadata): void {\n\t\tthis.replace(resource, new Range(position, position), newText, metadata);\n\t}\n\n\tdelete(resource: URI, range: Range, metadata?: vscode.WorkspaceEditEntryMetadata): void {\n\t\tthis.replace(resource, range, '', metadata);\n\t}\n\n\t// --- text (Maplike)\n\thas(uri: URI): boolean {\n\t\treturn this._edits.some(edit => edit._type === FileEditType.Text && edit.uri.toString() === uri.toString());\n\t}\n\n\tset(uri: URI, edits: ReadonlyArray<TextEdit | SnippetTextEdit>): void;\n\tset(uri: URI, edits: ReadonlyArray<[TextEdit | SnippetTextEdit, vscode.WorkspaceEditEntryMetadata | undefined]>): void;\n\tset(uri: URI, edits: readonly NotebookEdit[]): void;\n\tset(uri: URI, edits: ReadonlyArray<[NotebookEdit, vscode.WorkspaceEditEntryMetadata | undefined]>): void;\n\n\tset(uri: URI, edits: null | undefined | ReadonlyArray<TextEdit | SnippetTextEdit | NotebookEdit | [NotebookEdit, vscode.WorkspaceEditEntryMetadata | undefined] | [TextEdit | SnippetTextEdit, vscode.WorkspaceEditEntryMetadata | undefined]>): void {\n\t\tif (!edits) {\n\t\t\t// remove all text, snippet, or notebook edits for `uri`\n\t\t\tfor (let i = 0; i < this._edits.length; i++) {\n\t\t\t\tconst element = this._edits[i];\n\t\t\t\tswitch (element._type) {\n\t\t\t\t\tcase FileEditType.Text:\n\t\t\t\t\tcase FileEditType.Snippet:\n\t\t\t\t\tcase FileEditType.Cell:\n\t\t\t\t\tcase FileEditType.CellReplace:\n\t\t\t\t\t\tif (element.uri.toString() === uri.toString()) {\n\t\t\t\t\t\t\tthis._edits[i] = undefined!; // will be coalesced down below\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t\tcoalesceInPlace(this._edits);\n\t\t} else {\n\t\t\t// append edit to the end\n\t\t\tfor (const editOrTuple of edits) {\n\t\t\t\tif (!editOrTuple) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tlet edit: TextEdit | SnippetTextEdit | NotebookEdit;\n\t\t\t\tlet metadata: vscode.WorkspaceEditEntryMetadata | undefined;\n\t\t\t\tif (Array.isArray(editOrTuple)) {\n\t\t\t\t\tedit = editOrTuple[0];\n\t\t\t\t\tmetadata = editOrTuple[1];\n\t\t\t\t} else {\n\t\t\t\t\tedit = editOrTuple;\n\t\t\t\t}\n\t\t\t\tif (NotebookEdit.isNotebookCellEdit(edit)) {\n\t\t\t\t\tif (edit.newCellMetadata) {\n\t\t\t\t\t\tthis.replaceNotebookCellMetadata(uri, edit.range.start, edit.newCellMetadata, metadata);\n\t\t\t\t\t} else if (edit.newNotebookMetadata) {\n\t\t\t\t\t\tthis.replaceNotebookMetadata(uri, edit.newNotebookMetadata, metadata);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.replaceNotebookCells(uri, edit.range, edit.newCells, metadata);\n\t\t\t\t\t}\n\t\t\t\t} else if (SnippetTextEdit.isSnippetTextEdit(edit)) {\n\t\t\t\t\tthis._edits.push({ _type: FileEditType.Snippet, uri, range: edit.range, edit: edit.snippet, metadata, keepWhitespace: edit.keepWhitespace });\n\n\t\t\t\t} else {\n\t\t\t\t\tthis._edits.push({ _type: FileEditType.Text, uri, edit, metadata });\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tget(uri: URI): TextEdit[] {\n\t\tconst res: TextEdit[] = [];\n\t\tfor (const candidate of this._edits) {\n\t\t\tif (candidate._type === FileEditType.Text && candidate.uri.toString() === uri.toString()) {\n\t\t\t\tres.push(candidate.edit);\n\t\t\t}\n\t\t}\n\t\treturn res;\n\t}\n\n\tentries(): [URI, TextEdit[]][] {\n\t\tconst textEdits = new ResourceMap<[URI, TextEdit[]]>();\n\t\tfor (const candidate of this._edits) {\n\t\t\tif (candidate._type === FileEditType.Text) {\n\t\t\t\tlet textEdit = textEdits.get(candidate.uri);\n\t\t\t\tif (!textEdit) {\n\t\t\t\t\ttextEdit = [candidate.uri, []];\n\t\t\t\t\ttextEdits.set(candidate.uri, textEdit);\n\t\t\t\t}\n\t\t\t\ttextEdit[1].push(candidate.edit);\n\t\t\t}\n\t\t}\n\t\treturn [...textEdits.values()];\n\t}\n\n\tget size(): number {\n\t\treturn this.entries().length;\n\t}\n\n\ttoJSON(): [URI, TextEdit[]][] {\n\t\treturn this.entries();\n\t}\n}\n"]}