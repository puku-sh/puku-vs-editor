{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/api/common/extHostChatContext.ts","vs/workbench/api/common/extHostChatContext.ts"],"names":[],"mappings":"AAAA;;;gGAGgG;;;;;;;;;;AAGhG,OAAO,EAAE,iBAAiB,EAAE,MAAM,sCAAsC,CAAC;AACzE,OAAO,EAAE,GAAG,EAAiB,MAAM,6BAA6B,CAAC;AACjE,OAAO,EAA2B,WAAW,EAA8B,MAAM,uBAAuB,CAAC;AACzG,OAAO,EAAE,gBAAgB,EAAE,MAAM,4BAA4B,CAAC;AAC9D,OAAO,EAAE,kBAAkB,EAAE,MAAM,wBAAwB,CAAC;AAE5D,OAAO,EAAE,UAAU,EAAE,eAAe,EAAE,MAAM,mCAAmC,CAAC;AAEzE,IAAM,kBAAkB,GAAxB,MAAM,kBAAmB,SAAQ,UAAU;IASjD,YAAgC,UAA8B;QAE7D,KAAK,EAAE,CAAC;QAPD,gBAAW,GAAW,CAAC,CAAC;QACxB,eAAU,GAAwF,IAAI,GAAG,EAAE,CAAC;QAC5G,cAAS,GAAW,CAAC,CAAC;QACtB,WAAM,GAAqD,IAAI,GAAG,EAAE,CAAC,CAAC,+BAA+B;QAK5G,IAAI,CAAC,MAAM,GAAG,UAAU,CAAC,QAAQ,CAAC,WAAW,CAAC,qBAAqB,CAAC,CAAC;IACtE,CAAC;IAED,KAAK,CAAC,mBAAmB,CAAC,MAAc,EAAE,KAAwB;QACjE,IAAI,CAAC,MAAM,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC,CAAC,uBAAuB;QACnD,MAAM,QAAQ,GAAG,IAAI,CAAC,YAAY,CAAC,MAAM,CAAC,CAAC;QAC3C,IAAI,CAAC,QAAQ,CAAC,0BAA0B,EAAE,CAAC;YAC1C,MAAM,IAAI,KAAK,CAAC,oCAAoC,CAAC,CAAC;QACvD,CAAC;QACD,MAAM,MAAM,GAAG,CAAC,MAAM,QAAQ,CAAC,0BAA2B,CAAC,KAAK,CAAC,CAAC,IAAI,EAAE,CAAC;QACzE,MAAM,KAAK,GAAuB,EAAE,CAAC;QACrC,KAAK,MAAM,IAAI,IAAI,MAAM,EAAE,CAAC;YAC3B,MAAM,UAAU,GAAG,IAAI,CAAC,eAAe,CAAC,MAAM,EAAE,IAAI,CAAC,CAAC;YACtD,KAAK,CAAC,IAAI,CAAC;gBACV,MAAM,EAAE,UAAU;gBAClB,IAAI,EAAE,IAAI,CAAC,IAAI;gBACf,KAAK,EAAE,IAAI,CAAC,KAAK;gBACjB,gBAAgB,EAAE,IAAI,CAAC,gBAAgB;gBACvC,KAAK,EAAE,IAAI,CAAC,KAAK;aACjB,CAAC,CAAC;QACJ,CAAC;QACD,OAAO,KAAK,CAAC;IACd,CAAC;IAEO,eAAe,CAAC,MAAc,EAAE,IAA4B;QACnE,MAAM,UAAU,GAAG,IAAI,CAAC,SAAS,EAAE,CAAC;QACpC,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,GAAG,CAAC,MAAM,CAAC,EAAE,CAAC;YAC9B,IAAI,CAAC,MAAM,CAAC,GAAG,CAAC,MAAM,EAAE,IAAI,GAAG,EAAE,CAAC,CAAC;QACpC,CAAC;QACD,IAAI,CAAC,MAAM,CAAC,GAAG,CAAC,MAAM,CAAE,CAAC,GAAG,CAAC,UAAU,EAAE,IAAI,CAAC,CAAC;QAC/C,OAAO,UAAU,CAAC;IACnB,CAAC;IAED,KAAK,CAAC,8BAA8B,CAAC,MAAc,EAAE,OAAwD,EAAE,KAAwB;QACtI,MAAM,QAAQ,GAAG,IAAI,CAAC,YAAY,CAAC,MAAM,CAAC,CAAC;QAE3C,IAAI,CAAC,QAAQ,CAAC,6BAA6B,EAAE,CAAC;YAC7C,MAAM,IAAI,KAAK,CAAC,+CAA+C,CAAC,CAAC;QAClE,CAAC;QAED,MAAM,MAAM,GAAG,MAAM,QAAQ,CAAC,6BAA6B,CAAC,EAAE,QAAQ,EAAE,GAAG,CAAC,MAAM,CAAC,OAAO,CAAC,QAAQ,CAAC,EAAE,EAAE,KAAK,CAAC,CAAC;QAC/G,IAAI,CAAC,MAAM,EAAE,CAAC;YACb,OAAO,SAAS,CAAC;QAClB,CAAC;QACD,MAAM,UAAU,GAAG,IAAI,CAAC,eAAe,CAAC,MAAM,EAAE,MAAM,CAAC,CAAC;QAExD,MAAM,IAAI,GAAiC;YAC1C,MAAM,EAAE,UAAU;YAClB,IAAI,EAAE,MAAM,CAAC,IAAI;YACjB,KAAK,EAAE,MAAM,CAAC,KAAK;YACnB,gBAAgB,EAAE,MAAM,CAAC,gBAAgB;YACzC,KAAK,EAAE,OAAO,CAAC,SAAS,CAAC,CAAC,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC,CAAC,SAAS;SACnD,CAAC;QACF,IAAI,OAAO,CAAC,SAAS,IAAI,CAAC,IAAI,CAAC,KAAK,IAAI,QAAQ,CAAC,kBAAkB,EAAE,CAAC;YACrE,MAAM,QAAQ,GAAG,MAAM,QAAQ,CAAC,kBAAkB,CAAC,MAAM,EAAE,KAAK,CAAC,CAAC;YAClE,IAAI,CAAC,KAAK,GAAG,QAAQ,EAAE,KAAK,CAAC;QAC9B,CAAC;QAED,OAAO,IAAI,CAAC;IACb,CAAC;IAEO,KAAK,CAAC,UAAU,CAAC,QAAoC,EAAE,OAAyB,EAAE,OAA+B,EAAE,KAAwB;QAClJ,MAAM,SAAS,GAAG,MAAM,QAAQ,CAAC,kBAAkB,CAAC,OAAO,EAAE,KAAK,CAAC,CAAC;QACpE,MAAM,MAAM,GAAG,SAAS,IAAI,OAAO,CAAC;QACpC,OAAO;YACN,MAAM,EAAE,OAAO,CAAC,MAAM;YACtB,IAAI,EAAE,MAAM,CAAC,IAAI;YACjB,KAAK,EAAE,MAAM,CAAC,KAAK;YACnB,gBAAgB,EAAE,MAAM,CAAC,gBAAgB;YACzC,KAAK,EAAE,MAAM,CAAC,KAAK;SACnB,CAAC;IACH,CAAC;IAED,KAAK,CAAC,mBAAmB,CAAC,MAAc,EAAE,OAAyB,EAAE,KAAwB;QAC5F,MAAM,QAAQ,GAAG,IAAI,CAAC,YAAY,CAAC,MAAM,CAAC,CAAC;QAE3C,IAAI,CAAC,QAAQ,CAAC,kBAAkB,EAAE,CAAC;YAClC,MAAM,IAAI,KAAK,CAAC,oCAAoC,CAAC,CAAC;QACvD,CAAC;QACD,MAAM,OAAO,GAAG,IAAI,CAAC,MAAM,CAAC,GAAG,CAAC,MAAM,CAAC,EAAE,GAAG,CAAC,OAAO,CAAC,MAAM,CAAC,CAAC;QAC7D,IAAI,CAAC,OAAO,EAAE,CAAC;YACd,MAAM,IAAI,KAAK,CAAC,6BAA6B,CAAC,CAAC;QAChD,CAAC;QACD,OAAO,IAAI,CAAC,UAAU,CAAC,QAAQ,EAAE,OAAO,EAAE,OAAO,EAAE,KAAK,CAAC,CAAC;IAC3D,CAAC;IAED,2BAA2B,CAAC,QAA6C,EAAE,EAAU,EAAE,QAAoC;QAC1H,MAAM,MAAM,GAAG,IAAI,CAAC,WAAW,EAAE,CAAC;QAClC,MAAM,WAAW,GAAG,IAAI,eAAe,EAAE,CAAC;QAC1C,IAAI,CAAC,iCAAiC,CAAC,MAAM,EAAE,QAAQ,EAAE,WAAW,CAAC,CAAC;QACtE,IAAI,CAAC,UAAU,CAAC,GAAG,CAAC,MAAM,EAAE,EAAE,QAAQ,EAAE,WAAW,EAAE,CAAC,CAAC;QACvD,IAAI,CAAC,MAAM,CAAC,4BAA4B,CAAC,MAAM,EAAE,GAAG,EAAE,EAAE,EAAE,QAAQ,CAAC,CAAC,CAAC,gBAAgB,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC,SAAS,EAAE,EAAE,EAAE,EAAE,gBAAgB,EAAE,CAAC,CAAC,QAAQ,CAAC,6BAA6B,EAAE,eAAe,EAAE,CAAC,CAAC,QAAQ,CAAC,kBAAkB,EAAE,CAAC,CAAC;QAEtO,OAAO;YACN,OAAO,EAAE,GAAG,EAAE;gBACb,IAAI,CAAC,UAAU,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC;gBAC/B,IAAI,CAAC,MAAM,CAAC,8BAA8B,CAAC,MAAM,CAAC,CAAC;gBACnD,WAAW,CAAC,OAAO,EAAE,CAAC;YACvB,CAAC;SACD,CAAC;IACH,CAAC;IAEO,iCAAiC,CAAC,MAAc,EAAE,QAAoC,EAAE,WAA4B;QAC3H,IAAI,CAAC,QAAQ,CAAC,+BAA+B,IAAI,CAAC,QAAQ,CAAC,2BAA2B,EAAE,CAAC;YACxF,OAAO;QACR,CAAC;QACD,WAAW,CAAC,GAAG,CAAC,QAAQ,CAAC,+BAA+B,CAAC,KAAK,IAAI,EAAE;YACnE,MAAM,iBAAiB,GAAG,MAAM,QAAQ,CAAC,2BAA4B,CAAC,iBAAiB,CAAC,IAAI,CAAC,CAAC;YAC9F,MAAM,gBAAgB,GAAuB,EAAE,CAAC;YAChD,KAAK,MAAM,IAAI,IAAI,iBAAiB,IAAI,EAAE,EAAE,CAAC;gBAC5C,MAAM,WAAW,GAAqB;oBACrC,IAAI,EAAE,IAAI,CAAC,IAAI;oBACf,KAAK,EAAE,IAAI,CAAC,KAAK;oBACjB,gBAAgB,EAAE,IAAI,CAAC,gBAAgB;oBACvC,KAAK,EAAE,IAAI,CAAC,KAAK;oBACjB,MAAM,EAAE,IAAI,CAAC,SAAS,EAAE;iBACxB,CAAC;gBACF,MAAM,QAAQ,GAAG,MAAM,IAAI,CAAC,UAAU,CAAC,QAAQ,EAAE,WAAW,EAAE,IAAI,EAAE,iBAAiB,CAAC,IAAI,CAAC,CAAC;gBAC5F,gBAAgB,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;YACjC,CAAC;YAED,IAAI,CAAC,MAAM,CAAC,4BAA4B,CAAC,MAAM,EAAE,gBAAgB,CAAC,CAAC;QACpE,CAAC,CAAC,CAAC,CAAC;IACL,CAAC;IAEO,YAAY,CAAC,MAAc;QAClC,IAAI,CAAC,IAAI,CAAC,UAAU,CAAC,GAAG,CAAC,MAAM,CAAC,EAAE,CAAC;YAClC,MAAM,IAAI,KAAK,CAAC,iCAAiC,CAAC,CAAC;QACpD,CAAC;QACD,OAAO,IAAI,CAAC,UAAU,CAAC,GAAG,CAAC,MAAM,CAAE,CAAC,QAAQ,CAAC;IAC9C,CAAC;IAEe,OAAO;QACtB,KAAK,CAAC,OAAO,EAAE,CAAC;QAChB,KAAK,MAAM,EAAE,WAAW,EAAE,IAAI,IAAI,CAAC,UAAU,CAAC,MAAM,EAAE,EAAE,CAAC;YACxD,WAAW,CAAC,OAAO,EAAE,CAAC;QACvB,CAAC;IACF,CAAC;CACD,CAAA;AAtJY,kBAAkB;IASjB,WAAA,kBAAkB,CAAA;GATnB,kBAAkB,CAsJ9B","file":"extHostChatContext.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport type * as vscode from 'vscode';\nimport { CancellationToken } from '../../../base/common/cancellation.js';\nimport { URI, UriComponents } from '../../../base/common/uri.js';\nimport { ExtHostChatContextShape, MainContext, MainThreadChatContextShape } from './extHost.protocol.js';\nimport { DocumentSelector } from './extHostTypeConverters.js';\nimport { IExtHostRpcService } from './extHostRpcService.js';\nimport { IChatContextItem } from '../../contrib/chat/common/chatContext.js';\nimport { Disposable, DisposableStore } from '../../../base/common/lifecycle.js';\n\nexport class ExtHostChatContext extends Disposable implements ExtHostChatContextShape {\n\tdeclare _serviceBrand: undefined;\n\n\tprivate _proxy: MainThreadChatContextShape;\n\tprivate _handlePool: number = 0;\n\tprivate _providers: Map<number, { provider: vscode.ChatContextProvider; disposables: DisposableStore }> = new Map();\n\tprivate _itemPool: number = 0;\n\tprivate _items: Map<number, Map<number, vscode.ChatContextItem>> = new Map(); // handle -> itemHandle -> item\n\n\tconstructor(@IExtHostRpcService extHostRpc: IExtHostRpcService,\n\t) {\n\t\tsuper();\n\t\tthis._proxy = extHostRpc.getProxy(MainContext.MainThreadChatContext);\n\t}\n\n\tasync $provideChatContext(handle: number, token: CancellationToken): Promise<IChatContextItem[]> {\n\t\tthis._items.delete(handle); // clear previous items\n\t\tconst provider = this._getProvider(handle);\n\t\tif (!provider.provideChatContextExplicit) {\n\t\t\tthrow new Error('provideChatContext not implemented');\n\t\t}\n\t\tconst result = (await provider.provideChatContextExplicit!(token)) ?? [];\n\t\tconst items: IChatContextItem[] = [];\n\t\tfor (const item of result) {\n\t\t\tconst itemHandle = this._addTrackedItem(handle, item);\n\t\t\titems.push({\n\t\t\t\thandle: itemHandle,\n\t\t\t\ticon: item.icon,\n\t\t\t\tlabel: item.label,\n\t\t\t\tmodelDescription: item.modelDescription,\n\t\t\t\tvalue: item.value\n\t\t\t});\n\t\t}\n\t\treturn items;\n\t}\n\n\tprivate _addTrackedItem(handle: number, item: vscode.ChatContextItem): number {\n\t\tconst itemHandle = this._itemPool++;\n\t\tif (!this._items.has(handle)) {\n\t\t\tthis._items.set(handle, new Map());\n\t\t}\n\t\tthis._items.get(handle)!.set(itemHandle, item);\n\t\treturn itemHandle;\n\t}\n\n\tasync $provideChatContextForResource(handle: number, options: { resource: UriComponents; withValue: boolean }, token: CancellationToken): Promise<IChatContextItem | undefined> {\n\t\tconst provider = this._getProvider(handle);\n\n\t\tif (!provider.provideChatContextForResource) {\n\t\t\tthrow new Error('provideChatContextForResource not implemented');\n\t\t}\n\n\t\tconst result = await provider.provideChatContextForResource({ resource: URI.revive(options.resource) }, token);\n\t\tif (!result) {\n\t\t\treturn undefined;\n\t\t}\n\t\tconst itemHandle = this._addTrackedItem(handle, result);\n\n\t\tconst item: IChatContextItem | undefined = {\n\t\t\thandle: itemHandle,\n\t\t\ticon: result.icon,\n\t\t\tlabel: result.label,\n\t\t\tmodelDescription: result.modelDescription,\n\t\t\tvalue: options.withValue ? result.value : undefined\n\t\t};\n\t\tif (options.withValue && !item.value && provider.resolveChatContext) {\n\t\t\tconst resolved = await provider.resolveChatContext(result, token);\n\t\t\titem.value = resolved?.value;\n\t\t}\n\n\t\treturn item;\n\t}\n\n\tprivate async _doResolve(provider: vscode.ChatContextProvider, context: IChatContextItem, extItem: vscode.ChatContextItem, token: CancellationToken): Promise<IChatContextItem> {\n\t\tconst extResult = await provider.resolveChatContext(extItem, token);\n\t\tconst result = extResult ?? context;\n\t\treturn {\n\t\t\thandle: context.handle,\n\t\t\ticon: result.icon,\n\t\t\tlabel: result.label,\n\t\t\tmodelDescription: result.modelDescription,\n\t\t\tvalue: result.value\n\t\t};\n\t}\n\n\tasync $resolveChatContext(handle: number, context: IChatContextItem, token: CancellationToken): Promise<IChatContextItem> {\n\t\tconst provider = this._getProvider(handle);\n\n\t\tif (!provider.resolveChatContext) {\n\t\t\tthrow new Error('resolveChatContext not implemented');\n\t\t}\n\t\tconst extItem = this._items.get(handle)?.get(context.handle);\n\t\tif (!extItem) {\n\t\t\tthrow new Error('Chat context item not found');\n\t\t}\n\t\treturn this._doResolve(provider, context, extItem, token);\n\t}\n\n\tregisterChatContextProvider(selector: vscode.DocumentSelector | undefined, id: string, provider: vscode.ChatContextProvider): vscode.Disposable {\n\t\tconst handle = this._handlePool++;\n\t\tconst disposables = new DisposableStore();\n\t\tthis._listenForWorkspaceContextChanges(handle, provider, disposables);\n\t\tthis._providers.set(handle, { provider, disposables });\n\t\tthis._proxy.$registerChatContextProvider(handle, `${id}`, selector ? DocumentSelector.from(selector) : undefined, {}, { supportsResource: !!provider.provideChatContextForResource, supportsResolve: !!provider.resolveChatContext });\n\n\t\treturn {\n\t\t\tdispose: () => {\n\t\t\t\tthis._providers.delete(handle);\n\t\t\t\tthis._proxy.$unregisterChatContextProvider(handle);\n\t\t\t\tdisposables.dispose();\n\t\t\t}\n\t\t};\n\t}\n\n\tprivate _listenForWorkspaceContextChanges(handle: number, provider: vscode.ChatContextProvider, disposables: DisposableStore): void {\n\t\tif (!provider.onDidChangeWorkspaceChatContext || !provider.provideWorkspaceChatContext) {\n\t\t\treturn;\n\t\t}\n\t\tdisposables.add(provider.onDidChangeWorkspaceChatContext(async () => {\n\t\t\tconst workspaceContexts = await provider.provideWorkspaceChatContext!(CancellationToken.None);\n\t\t\tconst resolvedContexts: IChatContextItem[] = [];\n\t\t\tfor (const item of workspaceContexts ?? []) {\n\t\t\t\tconst contextItem: IChatContextItem = {\n\t\t\t\t\ticon: item.icon,\n\t\t\t\t\tlabel: item.label,\n\t\t\t\t\tmodelDescription: item.modelDescription,\n\t\t\t\t\tvalue: item.value,\n\t\t\t\t\thandle: this._itemPool++\n\t\t\t\t};\n\t\t\t\tconst resolved = await this._doResolve(provider, contextItem, item, CancellationToken.None);\n\t\t\t\tresolvedContexts.push(resolved);\n\t\t\t}\n\n\t\t\tthis._proxy.$updateWorkspaceContextItems(handle, resolvedContexts);\n\t\t}));\n\t}\n\n\tprivate _getProvider(handle: number): vscode.ChatContextProvider {\n\t\tif (!this._providers.has(handle)) {\n\t\t\tthrow new Error('Chat context provider not found');\n\t\t}\n\t\treturn this._providers.get(handle)!.provider;\n\t}\n\n\tpublic override dispose(): void {\n\t\tsuper.dispose();\n\t\tfor (const { disposables } of this._providers.values()) {\n\t\t\tdisposables.dispose();\n\t\t}\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport type * as vscode from 'vscode';\nimport { CancellationToken } from '../../../base/common/cancellation.js';\nimport { URI, UriComponents } from '../../../base/common/uri.js';\nimport { ExtHostChatContextShape, MainContext, MainThreadChatContextShape } from './extHost.protocol.js';\nimport { DocumentSelector } from './extHostTypeConverters.js';\nimport { IExtHostRpcService } from './extHostRpcService.js';\nimport { IChatContextItem } from '../../contrib/chat/common/chatContext.js';\nimport { Disposable, DisposableStore } from '../../../base/common/lifecycle.js';\n\nexport class ExtHostChatContext extends Disposable implements ExtHostChatContextShape {\n\tdeclare _serviceBrand: undefined;\n\n\tprivate _proxy: MainThreadChatContextShape;\n\tprivate _handlePool: number = 0;\n\tprivate _providers: Map<number, { provider: vscode.ChatContextProvider; disposables: DisposableStore }> = new Map();\n\tprivate _itemPool: number = 0;\n\tprivate _items: Map<number, Map<number, vscode.ChatContextItem>> = new Map(); // handle -> itemHandle -> item\n\n\tconstructor(@IExtHostRpcService extHostRpc: IExtHostRpcService,\n\t) {\n\t\tsuper();\n\t\tthis._proxy = extHostRpc.getProxy(MainContext.MainThreadChatContext);\n\t}\n\n\tasync $provideChatContext(handle: number, token: CancellationToken): Promise<IChatContextItem[]> {\n\t\tthis._items.delete(handle); // clear previous items\n\t\tconst provider = this._getProvider(handle);\n\t\tif (!provider.provideChatContextExplicit) {\n\t\t\tthrow new Error('provideChatContext not implemented');\n\t\t}\n\t\tconst result = (await provider.provideChatContextExplicit!(token)) ?? [];\n\t\tconst items: IChatContextItem[] = [];\n\t\tfor (const item of result) {\n\t\t\tconst itemHandle = this._addTrackedItem(handle, item);\n\t\t\titems.push({\n\t\t\t\thandle: itemHandle,\n\t\t\t\ticon: item.icon,\n\t\t\t\tlabel: item.label,\n\t\t\t\tmodelDescription: item.modelDescription,\n\t\t\t\tvalue: item.value\n\t\t\t});\n\t\t}\n\t\treturn items;\n\t}\n\n\tprivate _addTrackedItem(handle: number, item: vscode.ChatContextItem): number {\n\t\tconst itemHandle = this._itemPool++;\n\t\tif (!this._items.has(handle)) {\n\t\t\tthis._items.set(handle, new Map());\n\t\t}\n\t\tthis._items.get(handle)!.set(itemHandle, item);\n\t\treturn itemHandle;\n\t}\n\n\tasync $provideChatContextForResource(handle: number, options: { resource: UriComponents; withValue: boolean }, token: CancellationToken): Promise<IChatContextItem | undefined> {\n\t\tconst provider = this._getProvider(handle);\n\n\t\tif (!provider.provideChatContextForResource) {\n\t\t\tthrow new Error('provideChatContextForResource not implemented');\n\t\t}\n\n\t\tconst result = await provider.provideChatContextForResource({ resource: URI.revive(options.resource) }, token);\n\t\tif (!result) {\n\t\t\treturn undefined;\n\t\t}\n\t\tconst itemHandle = this._addTrackedItem(handle, result);\n\n\t\tconst item: IChatContextItem | undefined = {\n\t\t\thandle: itemHandle,\n\t\t\ticon: result.icon,\n\t\t\tlabel: result.label,\n\t\t\tmodelDescription: result.modelDescription,\n\t\t\tvalue: options.withValue ? result.value : undefined\n\t\t};\n\t\tif (options.withValue && !item.value && provider.resolveChatContext) {\n\t\t\tconst resolved = await provider.resolveChatContext(result, token);\n\t\t\titem.value = resolved?.value;\n\t\t}\n\n\t\treturn item;\n\t}\n\n\tprivate async _doResolve(provider: vscode.ChatContextProvider, context: IChatContextItem, extItem: vscode.ChatContextItem, token: CancellationToken): Promise<IChatContextItem> {\n\t\tconst extResult = await provider.resolveChatContext(extItem, token);\n\t\tconst result = extResult ?? context;\n\t\treturn {\n\t\t\thandle: context.handle,\n\t\t\ticon: result.icon,\n\t\t\tlabel: result.label,\n\t\t\tmodelDescription: result.modelDescription,\n\t\t\tvalue: result.value\n\t\t};\n\t}\n\n\tasync $resolveChatContext(handle: number, context: IChatContextItem, token: CancellationToken): Promise<IChatContextItem> {\n\t\tconst provider = this._getProvider(handle);\n\n\t\tif (!provider.resolveChatContext) {\n\t\t\tthrow new Error('resolveChatContext not implemented');\n\t\t}\n\t\tconst extItem = this._items.get(handle)?.get(context.handle);\n\t\tif (!extItem) {\n\t\t\tthrow new Error('Chat context item not found');\n\t\t}\n\t\treturn this._doResolve(provider, context, extItem, token);\n\t}\n\n\tregisterChatContextProvider(selector: vscode.DocumentSelector | undefined, id: string, provider: vscode.ChatContextProvider): vscode.Disposable {\n\t\tconst handle = this._handlePool++;\n\t\tconst disposables = new DisposableStore();\n\t\tthis._listenForWorkspaceContextChanges(handle, provider, disposables);\n\t\tthis._providers.set(handle, { provider, disposables });\n\t\tthis._proxy.$registerChatContextProvider(handle, `${id}`, selector ? DocumentSelector.from(selector) : undefined, {}, { supportsResource: !!provider.provideChatContextForResource, supportsResolve: !!provider.resolveChatContext });\n\n\t\treturn {\n\t\t\tdispose: () => {\n\t\t\t\tthis._providers.delete(handle);\n\t\t\t\tthis._proxy.$unregisterChatContextProvider(handle);\n\t\t\t\tdisposables.dispose();\n\t\t\t}\n\t\t};\n\t}\n\n\tprivate _listenForWorkspaceContextChanges(handle: number, provider: vscode.ChatContextProvider, disposables: DisposableStore): void {\n\t\tif (!provider.onDidChangeWorkspaceChatContext || !provider.provideWorkspaceChatContext) {\n\t\t\treturn;\n\t\t}\n\t\tdisposables.add(provider.onDidChangeWorkspaceChatContext(async () => {\n\t\t\tconst workspaceContexts = await provider.provideWorkspaceChatContext!(CancellationToken.None);\n\t\t\tconst resolvedContexts: IChatContextItem[] = [];\n\t\t\tfor (const item of workspaceContexts ?? []) {\n\t\t\t\tconst contextItem: IChatContextItem = {\n\t\t\t\t\ticon: item.icon,\n\t\t\t\t\tlabel: item.label,\n\t\t\t\t\tmodelDescription: item.modelDescription,\n\t\t\t\t\tvalue: item.value,\n\t\t\t\t\thandle: this._itemPool++\n\t\t\t\t};\n\t\t\t\tconst resolved = await this._doResolve(provider, contextItem, item, CancellationToken.None);\n\t\t\t\tresolvedContexts.push(resolved);\n\t\t\t}\n\n\t\t\tthis._proxy.$updateWorkspaceContextItems(handle, resolvedContexts);\n\t\t}));\n\t}\n\n\tprivate _getProvider(handle: number): vscode.ChatContextProvider {\n\t\tif (!this._providers.has(handle)) {\n\t\t\tthrow new Error('Chat context provider not found');\n\t\t}\n\t\treturn this._providers.get(handle)!.provider;\n\t}\n\n\tpublic override dispose(): void {\n\t\tsuper.dispose();\n\t\tfor (const { disposables } of this._providers.values()) {\n\t\t\tdisposables.dispose();\n\t\t}\n\t}\n}\n"]}