{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/api/common/extHostCodeInsets.ts","vs/workbench/api/common/extHostCodeInsets.ts"],"names":[],"mappings":"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","file":"extHostCodeInsets.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Emitter } from '../../../base/common/event.js';\nimport { DisposableStore } from '../../../base/common/lifecycle.js';\nimport { IExtensionDescription } from '../../../platform/extensions/common/extensions.js';\nimport { ExtHostTextEditor } from './extHostTextEditor.js';\nimport { ExtHostEditors } from './extHostTextEditors.js';\nimport { asWebviewUri, webviewGenericCspSource, WebviewRemoteInfo } from '../../contrib/webview/common/webview.js';\nimport type * as vscode from 'vscode';\nimport { ExtHostEditorInsetsShape, MainThreadEditorInsetsShape } from './extHost.protocol.js';\n\nexport class ExtHostEditorInsets implements ExtHostEditorInsetsShape {\n\n\tprivate _handlePool = 0;\n\tprivate readonly _disposables = new DisposableStore();\n\tprivate _insets = new Map<number, { editor: vscode.TextEditor; inset: vscode.WebviewEditorInset; onDidReceiveMessage: Emitter<any> }>();\n\n\tconstructor(\n\t\tprivate readonly _proxy: MainThreadEditorInsetsShape,\n\t\tprivate readonly _editors: ExtHostEditors,\n\t\tprivate readonly _remoteInfo: WebviewRemoteInfo\n\t) {\n\n\t\t// dispose editor inset whenever the hosting editor goes away\n\t\tthis._disposables.add(_editors.onDidChangeVisibleTextEditors(() => {\n\t\t\tconst visibleEditor = _editors.getVisibleTextEditors();\n\t\t\tfor (const value of this._insets.values()) {\n\t\t\t\tif (visibleEditor.indexOf(value.editor) < 0) {\n\t\t\t\t\tvalue.inset.dispose(); // will remove from `this._insets`\n\t\t\t\t}\n\t\t\t}\n\t\t}));\n\t}\n\n\tdispose(): void {\n\t\tthis._insets.forEach(value => value.inset.dispose());\n\t\tthis._disposables.dispose();\n\t}\n\n\tcreateWebviewEditorInset(editor: vscode.TextEditor, line: number, height: number, options: vscode.WebviewOptions | undefined, extension: IExtensionDescription): vscode.WebviewEditorInset {\n\n\t\tlet apiEditor: ExtHostTextEditor | undefined;\n\t\tfor (const candidate of this._editors.getVisibleTextEditors(true)) {\n\t\t\tif (candidate.value === editor) {\n\t\t\t\tapiEditor = <ExtHostTextEditor>candidate;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\tif (!apiEditor) {\n\t\t\tthrow new Error('not a visible editor');\n\t\t}\n\n\t\tconst that = this;\n\t\tconst handle = this._handlePool++;\n\t\tconst onDidReceiveMessage = new Emitter<any>();\n\t\tconst onDidDispose = new Emitter<void>();\n\n\t\tconst webview = new class implements vscode.Webview {\n\n\t\t\tprivate _html: string = '';\n\t\t\tprivate _options: vscode.WebviewOptions = Object.create(null);\n\n\t\t\tasWebviewUri(resource: vscode.Uri): vscode.Uri {\n\t\t\t\treturn asWebviewUri(resource, that._remoteInfo);\n\t\t\t}\n\n\t\t\tget cspSource(): string {\n\t\t\t\treturn webviewGenericCspSource;\n\t\t\t}\n\n\t\t\tset options(value: vscode.WebviewOptions) {\n\t\t\t\tthis._options = value;\n\t\t\t\tthat._proxy.$setOptions(handle, value);\n\t\t\t}\n\n\t\t\tget options(): vscode.WebviewOptions {\n\t\t\t\treturn this._options;\n\t\t\t}\n\n\t\t\tset html(value: string) {\n\t\t\t\tthis._html = value;\n\t\t\t\tthat._proxy.$setHtml(handle, value);\n\t\t\t}\n\n\t\t\tget html(): string {\n\t\t\t\treturn this._html;\n\t\t\t}\n\n\t\t\tget onDidReceiveMessage(): vscode.Event<any> {\n\t\t\t\treturn onDidReceiveMessage.event;\n\t\t\t}\n\n\t\t\tpostMessage(message: any): Thenable<boolean> {\n\t\t\t\treturn that._proxy.$postMessage(handle, message);\n\t\t\t}\n\t\t};\n\n\t\tconst inset = new class implements vscode.WebviewEditorInset {\n\n\t\t\treadonly editor: vscode.TextEditor = editor;\n\t\t\treadonly line: number = line;\n\t\t\treadonly height: number = height;\n\t\t\treadonly webview: vscode.Webview = webview;\n\t\t\treadonly onDidDispose: vscode.Event<void> = onDidDispose.event;\n\n\t\t\tdispose(): void {\n\t\t\t\tif (that._insets.has(handle)) {\n\t\t\t\t\tthat._insets.delete(handle);\n\t\t\t\t\tthat._proxy.$disposeEditorInset(handle);\n\t\t\t\t\tonDidDispose.fire();\n\n\t\t\t\t\t// final cleanup\n\t\t\t\t\tonDidDispose.dispose();\n\t\t\t\t\tonDidReceiveMessage.dispose();\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\tthis._proxy.$createEditorInset(handle, apiEditor.id, apiEditor.value.document.uri, line + 1, height, options || {}, extension.identifier, extension.extensionLocation);\n\t\tthis._insets.set(handle, { editor, inset, onDidReceiveMessage });\n\n\t\treturn inset;\n\t}\n\n\t$onDidDispose(handle: number): void {\n\t\tconst value = this._insets.get(handle);\n\t\tif (value) {\n\t\t\tvalue.inset.dispose();\n\t\t}\n\t}\n\n\t$onDidReceiveMessage(handle: number, message: any): void {\n\t\tconst value = this._insets.get(handle);\n\t\tvalue?.onDidReceiveMessage.fire(message);\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Emitter } from '../../../base/common/event.js';\nimport { DisposableStore } from '../../../base/common/lifecycle.js';\nimport { IExtensionDescription } from '../../../platform/extensions/common/extensions.js';\nimport { ExtHostTextEditor } from './extHostTextEditor.js';\nimport { ExtHostEditors } from './extHostTextEditors.js';\nimport { asWebviewUri, webviewGenericCspSource, WebviewRemoteInfo } from '../../contrib/webview/common/webview.js';\nimport type * as vscode from 'vscode';\nimport { ExtHostEditorInsetsShape, MainThreadEditorInsetsShape } from './extHost.protocol.js';\n\nexport class ExtHostEditorInsets implements ExtHostEditorInsetsShape {\n\n\tprivate _handlePool = 0;\n\tprivate readonly _disposables = new DisposableStore();\n\tprivate _insets = new Map<number, { editor: vscode.TextEditor; inset: vscode.WebviewEditorInset; onDidReceiveMessage: Emitter<any> }>();\n\n\tconstructor(\n\t\tprivate readonly _proxy: MainThreadEditorInsetsShape,\n\t\tprivate readonly _editors: ExtHostEditors,\n\t\tprivate readonly _remoteInfo: WebviewRemoteInfo\n\t) {\n\n\t\t// dispose editor inset whenever the hosting editor goes away\n\t\tthis._disposables.add(_editors.onDidChangeVisibleTextEditors(() => {\n\t\t\tconst visibleEditor = _editors.getVisibleTextEditors();\n\t\t\tfor (const value of this._insets.values()) {\n\t\t\t\tif (visibleEditor.indexOf(value.editor) < 0) {\n\t\t\t\t\tvalue.inset.dispose(); // will remove from `this._insets`\n\t\t\t\t}\n\t\t\t}\n\t\t}));\n\t}\n\n\tdispose(): void {\n\t\tthis._insets.forEach(value => value.inset.dispose());\n\t\tthis._disposables.dispose();\n\t}\n\n\tcreateWebviewEditorInset(editor: vscode.TextEditor, line: number, height: number, options: vscode.WebviewOptions | undefined, extension: IExtensionDescription): vscode.WebviewEditorInset {\n\n\t\tlet apiEditor: ExtHostTextEditor | undefined;\n\t\tfor (const candidate of this._editors.getVisibleTextEditors(true)) {\n\t\t\tif (candidate.value === editor) {\n\t\t\t\tapiEditor = <ExtHostTextEditor>candidate;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\tif (!apiEditor) {\n\t\t\tthrow new Error('not a visible editor');\n\t\t}\n\n\t\tconst that = this;\n\t\tconst handle = this._handlePool++;\n\t\tconst onDidReceiveMessage = new Emitter<any>();\n\t\tconst onDidDispose = new Emitter<void>();\n\n\t\tconst webview = new class implements vscode.Webview {\n\n\t\t\tprivate _html: string = '';\n\t\t\tprivate _options: vscode.WebviewOptions = Object.create(null);\n\n\t\t\tasWebviewUri(resource: vscode.Uri): vscode.Uri {\n\t\t\t\treturn asWebviewUri(resource, that._remoteInfo);\n\t\t\t}\n\n\t\t\tget cspSource(): string {\n\t\t\t\treturn webviewGenericCspSource;\n\t\t\t}\n\n\t\t\tset options(value: vscode.WebviewOptions) {\n\t\t\t\tthis._options = value;\n\t\t\t\tthat._proxy.$setOptions(handle, value);\n\t\t\t}\n\n\t\t\tget options(): vscode.WebviewOptions {\n\t\t\t\treturn this._options;\n\t\t\t}\n\n\t\t\tset html(value: string) {\n\t\t\t\tthis._html = value;\n\t\t\t\tthat._proxy.$setHtml(handle, value);\n\t\t\t}\n\n\t\t\tget html(): string {\n\t\t\t\treturn this._html;\n\t\t\t}\n\n\t\t\tget onDidReceiveMessage(): vscode.Event<any> {\n\t\t\t\treturn onDidReceiveMessage.event;\n\t\t\t}\n\n\t\t\tpostMessage(message: any): Thenable<boolean> {\n\t\t\t\treturn that._proxy.$postMessage(handle, message);\n\t\t\t}\n\t\t};\n\n\t\tconst inset = new class implements vscode.WebviewEditorInset {\n\n\t\t\treadonly editor: vscode.TextEditor = editor;\n\t\t\treadonly line: number = line;\n\t\t\treadonly height: number = height;\n\t\t\treadonly webview: vscode.Webview = webview;\n\t\t\treadonly onDidDispose: vscode.Event<void> = onDidDispose.event;\n\n\t\t\tdispose(): void {\n\t\t\t\tif (that._insets.has(handle)) {\n\t\t\t\t\tthat._insets.delete(handle);\n\t\t\t\t\tthat._proxy.$disposeEditorInset(handle);\n\t\t\t\t\tonDidDispose.fire();\n\n\t\t\t\t\t// final cleanup\n\t\t\t\t\tonDidDispose.dispose();\n\t\t\t\t\tonDidReceiveMessage.dispose();\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\tthis._proxy.$createEditorInset(handle, apiEditor.id, apiEditor.value.document.uri, line + 1, height, options || {}, extension.identifier, extension.extensionLocation);\n\t\tthis._insets.set(handle, { editor, inset, onDidReceiveMessage });\n\n\t\treturn inset;\n\t}\n\n\t$onDidDispose(handle: number): void {\n\t\tconst value = this._insets.get(handle);\n\t\tif (value) {\n\t\t\tvalue.inset.dispose();\n\t\t}\n\t}\n\n\t$onDidReceiveMessage(handle: number, message: any): void {\n\t\tconst value = this._insets.get(handle);\n\t\tvalue?.onDidReceiveMessage.fire(message);\n\t}\n}\n"]}