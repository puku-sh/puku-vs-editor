{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/api/common/extHostLocalizationService.ts","vs/workbench/api/common/extHostLocalizationService.ts"],"names":[],"mappings":"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","file":"extHostLocalizationService.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { LANGUAGE_DEFAULT } from '../../../base/common/platform.js';\nimport { format2 } from '../../../base/common/strings.js';\nimport { URI } from '../../../base/common/uri.js';\nimport { IExtensionDescription } from '../../../platform/extensions/common/extensions.js';\nimport { createDecorator } from '../../../platform/instantiation/common/instantiation.js';\nimport { ILogService } from '../../../platform/log/common/log.js';\nimport { ExtHostLocalizationShape, IStringDetails, MainContext, MainThreadLocalizationShape } from './extHost.protocol.js';\nimport { IExtHostInitDataService } from './extHostInitDataService.js';\nimport { IExtHostRpcService } from './extHostRpcService.js';\n\nexport class ExtHostLocalizationService implements ExtHostLocalizationShape {\n\treadonly _serviceBrand: undefined;\n\n\tprivate readonly _proxy: MainThreadLocalizationShape;\n\tprivate readonly currentLanguage: string;\n\tprivate readonly isDefaultLanguage: boolean;\n\n\tprivate readonly bundleCache: Map<string, { contents: { [key: string]: string }; uri: URI }> = new Map();\n\n\tconstructor(\n\t\t@IExtHostInitDataService initData: IExtHostInitDataService,\n\t\t@IExtHostRpcService rpc: IExtHostRpcService,\n\t\t@ILogService private readonly logService: ILogService\n\t) {\n\t\tthis._proxy = rpc.getProxy(MainContext.MainThreadLocalization);\n\t\tthis.currentLanguage = initData.environment.appLanguage;\n\t\tthis.isDefaultLanguage = this.currentLanguage === LANGUAGE_DEFAULT;\n\t}\n\n\tgetMessage(extensionId: string, details: IStringDetails): string {\n\t\tconst { message, args, comment } = details;\n\t\tif (this.isDefaultLanguage) {\n\t\t\treturn format2(message, (args ?? {}));\n\t\t}\n\n\t\tlet key = message;\n\t\tif (comment && comment.length > 0) {\n\t\t\tkey += `/${Array.isArray(comment) ? comment.join('') : comment}`;\n\t\t}\n\t\tconst str = this.bundleCache.get(extensionId)?.contents[key];\n\t\tif (!str) {\n\t\t\tthis.logService.warn(`Using default string since no string found in i18n bundle that has the key: ${key}`);\n\t\t}\n\t\treturn format2(str ?? message, (args ?? {}));\n\t}\n\n\tgetBundle(extensionId: string): { [key: string]: string } | undefined {\n\t\treturn this.bundleCache.get(extensionId)?.contents;\n\t}\n\n\tgetBundleUri(extensionId: string): URI | undefined {\n\t\treturn this.bundleCache.get(extensionId)?.uri;\n\t}\n\n\tasync initializeLocalizedMessages(extension: IExtensionDescription): Promise<void> {\n\t\tif (this.isDefaultLanguage\n\t\t\t|| (!extension.l10n && !extension.isBuiltin)\n\t\t) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.bundleCache.has(extension.identifier.value)) {\n\t\t\treturn;\n\t\t}\n\n\t\tlet contents: { [key: string]: string } | undefined;\n\t\tconst bundleUri = await this.getBundleLocation(extension);\n\t\tif (!bundleUri) {\n\t\t\tthis.logService.error(`No bundle location found for extension ${extension.identifier.value}`);\n\t\t\treturn;\n\t\t}\n\n\t\ttry {\n\t\t\tconst response = await this._proxy.$fetchBundleContents(bundleUri);\n\t\t\tconst result = JSON.parse(response);\n\t\t\t// 'contents.bundle' is a well-known key in the language pack json file that contains the _code_ translations for the extension\n\t\t\tcontents = extension.isBuiltin ? result.contents?.bundle : result;\n\t\t} catch (e) {\n\t\t\tthis.logService.error(`Failed to load translations for ${extension.identifier.value} from ${bundleUri}: ${e.message}`);\n\t\t\treturn;\n\t\t}\n\n\t\tif (contents) {\n\t\t\tthis.bundleCache.set(extension.identifier.value, {\n\t\t\t\tcontents,\n\t\t\t\turi: bundleUri\n\t\t\t});\n\t\t}\n\t}\n\n\tprivate async getBundleLocation(extension: IExtensionDescription): Promise<URI | undefined> {\n\t\tif (extension.isBuiltin) {\n\t\t\tconst uri = await this._proxy.$fetchBuiltInBundleUri(extension.identifier.value, this.currentLanguage);\n\t\t\treturn URI.revive(uri);\n\t\t}\n\n\t\treturn extension.l10n\n\t\t\t? URI.joinPath(extension.extensionLocation, extension.l10n, `bundle.l10n.${this.currentLanguage}.json`)\n\t\t\t: undefined;\n\t}\n}\n\nexport const IExtHostLocalizationService = createDecorator<IExtHostLocalizationService>('IExtHostLocalizationService');\nexport interface IExtHostLocalizationService extends ExtHostLocalizationService { }\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { LANGUAGE_DEFAULT } from '../../../base/common/platform.js';\nimport { format2 } from '../../../base/common/strings.js';\nimport { URI } from '../../../base/common/uri.js';\nimport { IExtensionDescription } from '../../../platform/extensions/common/extensions.js';\nimport { createDecorator } from '../../../platform/instantiation/common/instantiation.js';\nimport { ILogService } from '../../../platform/log/common/log.js';\nimport { ExtHostLocalizationShape, IStringDetails, MainContext, MainThreadLocalizationShape } from './extHost.protocol.js';\nimport { IExtHostInitDataService } from './extHostInitDataService.js';\nimport { IExtHostRpcService } from './extHostRpcService.js';\n\nexport class ExtHostLocalizationService implements ExtHostLocalizationShape {\n\treadonly _serviceBrand: undefined;\n\n\tprivate readonly _proxy: MainThreadLocalizationShape;\n\tprivate readonly currentLanguage: string;\n\tprivate readonly isDefaultLanguage: boolean;\n\n\tprivate readonly bundleCache: Map<string, { contents: { [key: string]: string }; uri: URI }> = new Map();\n\n\tconstructor(\n\t\t@IExtHostInitDataService initData: IExtHostInitDataService,\n\t\t@IExtHostRpcService rpc: IExtHostRpcService,\n\t\t@ILogService private readonly logService: ILogService\n\t) {\n\t\tthis._proxy = rpc.getProxy(MainContext.MainThreadLocalization);\n\t\tthis.currentLanguage = initData.environment.appLanguage;\n\t\tthis.isDefaultLanguage = this.currentLanguage === LANGUAGE_DEFAULT;\n\t}\n\n\tgetMessage(extensionId: string, details: IStringDetails): string {\n\t\tconst { message, args, comment } = details;\n\t\tif (this.isDefaultLanguage) {\n\t\t\treturn format2(message, (args ?? {}));\n\t\t}\n\n\t\tlet key = message;\n\t\tif (comment && comment.length > 0) {\n\t\t\tkey += `/${Array.isArray(comment) ? comment.join('') : comment}`;\n\t\t}\n\t\tconst str = this.bundleCache.get(extensionId)?.contents[key];\n\t\tif (!str) {\n\t\t\tthis.logService.warn(`Using default string since no string found in i18n bundle that has the key: ${key}`);\n\t\t}\n\t\treturn format2(str ?? message, (args ?? {}));\n\t}\n\n\tgetBundle(extensionId: string): { [key: string]: string } | undefined {\n\t\treturn this.bundleCache.get(extensionId)?.contents;\n\t}\n\n\tgetBundleUri(extensionId: string): URI | undefined {\n\t\treturn this.bundleCache.get(extensionId)?.uri;\n\t}\n\n\tasync initializeLocalizedMessages(extension: IExtensionDescription): Promise<void> {\n\t\tif (this.isDefaultLanguage\n\t\t\t|| (!extension.l10n && !extension.isBuiltin)\n\t\t) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.bundleCache.has(extension.identifier.value)) {\n\t\t\treturn;\n\t\t}\n\n\t\tlet contents: { [key: string]: string } | undefined;\n\t\tconst bundleUri = await this.getBundleLocation(extension);\n\t\tif (!bundleUri) {\n\t\t\tthis.logService.error(`No bundle location found for extension ${extension.identifier.value}`);\n\t\t\treturn;\n\t\t}\n\n\t\ttry {\n\t\t\tconst response = await this._proxy.$fetchBundleContents(bundleUri);\n\t\t\tconst result = JSON.parse(response);\n\t\t\t// 'contents.bundle' is a well-known key in the language pack json file that contains the _code_ translations for the extension\n\t\t\tcontents = extension.isBuiltin ? result.contents?.bundle : result;\n\t\t} catch (e) {\n\t\t\tthis.logService.error(`Failed to load translations for ${extension.identifier.value} from ${bundleUri}: ${e.message}`);\n\t\t\treturn;\n\t\t}\n\n\t\tif (contents) {\n\t\t\tthis.bundleCache.set(extension.identifier.value, {\n\t\t\t\tcontents,\n\t\t\t\turi: bundleUri\n\t\t\t});\n\t\t}\n\t}\n\n\tprivate async getBundleLocation(extension: IExtensionDescription): Promise<URI | undefined> {\n\t\tif (extension.isBuiltin) {\n\t\t\tconst uri = await this._proxy.$fetchBuiltInBundleUri(extension.identifier.value, this.currentLanguage);\n\t\t\treturn URI.revive(uri);\n\t\t}\n\n\t\treturn extension.l10n\n\t\t\t? URI.joinPath(extension.extensionLocation, extension.l10n, `bundle.l10n.${this.currentLanguage}.json`)\n\t\t\t: undefined;\n\t}\n}\n\nexport const IExtHostLocalizationService = createDecorator<IExtHostLocalizationService>('IExtHostLocalizationService');\nexport interface IExtHostLocalizationService extends ExtHostLocalizationService { }\n"]}