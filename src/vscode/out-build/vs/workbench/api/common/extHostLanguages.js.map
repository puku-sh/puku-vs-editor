{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/api/common/extHostLanguages.ts","vs/workbench/api/common/extHostLanguages.ts"],"names":[],"mappings":"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","file":"extHostLanguages.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { MainContext, MainThreadLanguagesShape, IMainContext, ExtHostLanguagesShape } from './extHost.protocol.js';\nimport type * as vscode from 'vscode';\nimport { ExtHostDocuments } from './extHostDocuments.js';\nimport * as typeConvert from './extHostTypeConverters.js';\nimport { StandardTokenType, Range, Position, LanguageStatusSeverity } from './extHostTypes.js';\nimport Severity from '../../../base/common/severity.js';\nimport { disposableTimeout } from '../../../base/common/async.js';\nimport { DisposableStore, IDisposable } from '../../../base/common/lifecycle.js';\nimport { IExtensionDescription } from '../../../platform/extensions/common/extensions.js';\nimport { CommandsConverter } from './extHostCommands.js';\nimport { IURITransformer } from '../../../base/common/uriIpc.js';\nimport { checkProposedApiEnabled } from '../../services/extensions/common/extensions.js';\n\nexport class ExtHostLanguages implements ExtHostLanguagesShape {\n\n\tprivate readonly _proxy: MainThreadLanguagesShape;\n\n\tprivate _languageIds: string[] = [];\n\n\tconstructor(\n\t\tmainContext: IMainContext,\n\t\tprivate readonly _documents: ExtHostDocuments,\n\t\tprivate readonly _commands: CommandsConverter,\n\t\tprivate readonly _uriTransformer: IURITransformer | undefined\n\t) {\n\t\tthis._proxy = mainContext.getProxy(MainContext.MainThreadLanguages);\n\t}\n\n\t$acceptLanguageIds(ids: string[]): void {\n\t\tthis._languageIds = ids;\n\t}\n\n\tasync getLanguages(): Promise<string[]> {\n\t\treturn this._languageIds.slice(0);\n\t}\n\n\tasync changeLanguage(uri: vscode.Uri, languageId: string): Promise<vscode.TextDocument> {\n\t\tawait this._proxy.$changeLanguage(uri, languageId);\n\t\tconst data = this._documents.getDocumentData(uri);\n\t\tif (!data) {\n\t\t\tthrow new Error(`document '${uri.toString()}' NOT found`);\n\t\t}\n\t\treturn data.document;\n\t}\n\n\tasync tokenAtPosition(document: vscode.TextDocument, position: vscode.Position): Promise<vscode.TokenInformation> {\n\t\tconst versionNow = document.version;\n\t\tconst pos = typeConvert.Position.from(position);\n\t\tconst info = await this._proxy.$tokensAtPosition(document.uri, pos);\n\t\tconst defaultRange = {\n\t\t\ttype: StandardTokenType.Other,\n\t\t\trange: document.getWordRangeAtPosition(position) ?? new Range(position.line, position.character, position.line, position.character)\n\t\t};\n\t\tif (!info) {\n\t\t\t// no result\n\t\t\treturn defaultRange;\n\t\t}\n\t\tconst result = {\n\t\t\trange: typeConvert.Range.to(info.range),\n\t\t\ttype: typeConvert.TokenType.to(info.type)\n\t\t};\n\t\tif (!result.range.contains(<Position>position)) {\n\t\t\t// bogous result\n\t\t\treturn defaultRange;\n\t\t}\n\t\tif (versionNow !== document.version) {\n\t\t\t// concurrent change\n\t\t\treturn defaultRange;\n\t\t}\n\t\treturn result;\n\t}\n\n\tprivate _handlePool: number = 0;\n\tprivate _ids = new Set<string>();\n\n\tcreateLanguageStatusItem(extension: IExtensionDescription, id: string, selector: vscode.DocumentSelector): vscode.LanguageStatusItem {\n\n\t\tconst handle = this._handlePool++;\n\t\tconst proxy = this._proxy;\n\t\tconst ids = this._ids;\n\n\t\t// enforce extension unique identifier\n\t\tconst fullyQualifiedId = `${extension.identifier.value}/${id}`;\n\t\tif (ids.has(fullyQualifiedId)) {\n\t\t\tthrow new Error(`LanguageStatusItem with id '${id}' ALREADY exists`);\n\t\t}\n\t\tids.add(fullyQualifiedId);\n\n\t\tconst data: Omit<vscode.LanguageStatusItem, 'dispose' | 'text2'> = {\n\t\t\tselector,\n\t\t\tid,\n\t\t\tname: extension.displayName ?? extension.name,\n\t\t\tseverity: LanguageStatusSeverity.Information,\n\t\t\tcommand: undefined,\n\t\t\ttext: '',\n\t\t\tdetail: '',\n\t\t\tbusy: false\n\t\t};\n\n\n\t\tlet soonHandle: IDisposable | undefined;\n\t\tconst commandDisposables = new DisposableStore();\n\t\tconst updateAsync = () => {\n\t\t\tsoonHandle?.dispose();\n\n\t\t\tif (!ids.has(fullyQualifiedId)) {\n\t\t\t\tconsole.warn(`LanguageStatusItem (${id}) from ${extension.identifier.value} has been disposed and CANNOT be updated anymore`);\n\t\t\t\treturn; // disposed in the meantime\n\t\t\t}\n\n\t\t\tsoonHandle = disposableTimeout(() => {\n\t\t\t\tcommandDisposables.clear();\n\t\t\t\tthis._proxy.$setLanguageStatus(handle, {\n\t\t\t\t\tid: fullyQualifiedId,\n\t\t\t\t\tname: data.name ?? extension.displayName ?? extension.name,\n\t\t\t\t\tsource: extension.displayName ?? extension.name,\n\t\t\t\t\tselector: typeConvert.DocumentSelector.from(data.selector, this._uriTransformer),\n\t\t\t\t\tlabel: data.text,\n\t\t\t\t\tdetail: data.detail ?? '',\n\t\t\t\t\tseverity: data.severity === LanguageStatusSeverity.Error ? Severity.Error : data.severity === LanguageStatusSeverity.Warning ? Severity.Warning : Severity.Info,\n\t\t\t\t\tcommand: data.command && this._commands.toInternal(data.command, commandDisposables),\n\t\t\t\t\taccessibilityInfo: data.accessibilityInformation,\n\t\t\t\t\tbusy: data.busy\n\t\t\t\t});\n\t\t\t}, 0);\n\t\t};\n\n\t\tconst result: vscode.LanguageStatusItem = {\n\t\t\tdispose() {\n\t\t\t\tcommandDisposables.dispose();\n\t\t\t\tsoonHandle?.dispose();\n\t\t\t\tproxy.$removeLanguageStatus(handle);\n\t\t\t\tids.delete(fullyQualifiedId);\n\t\t\t},\n\t\t\tget id() {\n\t\t\t\treturn data.id;\n\t\t\t},\n\t\t\tget name() {\n\t\t\t\treturn data.name;\n\t\t\t},\n\t\t\tset name(value) {\n\t\t\t\tdata.name = value;\n\t\t\t\tupdateAsync();\n\t\t\t},\n\t\t\tget selector() {\n\t\t\t\treturn data.selector;\n\t\t\t},\n\t\t\tset selector(value) {\n\t\t\t\tdata.selector = value;\n\t\t\t\tupdateAsync();\n\t\t\t},\n\t\t\tget text() {\n\t\t\t\treturn data.text;\n\t\t\t},\n\t\t\tset text(value) {\n\t\t\t\tdata.text = value;\n\t\t\t\tupdateAsync();\n\t\t\t},\n\t\t\tset text2(value) {\n\t\t\t\tcheckProposedApiEnabled(extension, 'languageStatusText');\n\t\t\t\tdata.text = value;\n\t\t\t\tupdateAsync();\n\t\t\t},\n\t\t\tget text2() {\n\t\t\t\tcheckProposedApiEnabled(extension, 'languageStatusText');\n\t\t\t\treturn data.text;\n\t\t\t},\n\t\t\tget detail() {\n\t\t\t\treturn data.detail;\n\t\t\t},\n\t\t\tset detail(value) {\n\t\t\t\tdata.detail = value;\n\t\t\t\tupdateAsync();\n\t\t\t},\n\t\t\tget severity() {\n\t\t\t\treturn data.severity;\n\t\t\t},\n\t\t\tset severity(value) {\n\t\t\t\tdata.severity = value;\n\t\t\t\tupdateAsync();\n\t\t\t},\n\t\t\tget accessibilityInformation() {\n\t\t\t\treturn data.accessibilityInformation;\n\t\t\t},\n\t\t\tset accessibilityInformation(value) {\n\t\t\t\tdata.accessibilityInformation = value;\n\t\t\t\tupdateAsync();\n\t\t\t},\n\t\t\tget command() {\n\t\t\t\treturn data.command;\n\t\t\t},\n\t\t\tset command(value) {\n\t\t\t\tdata.command = value;\n\t\t\t\tupdateAsync();\n\t\t\t},\n\t\t\tget busy() {\n\t\t\t\treturn data.busy;\n\t\t\t},\n\t\t\tset busy(value: boolean) {\n\t\t\t\tdata.busy = value;\n\t\t\t\tupdateAsync();\n\t\t\t}\n\t\t};\n\t\tupdateAsync();\n\t\treturn result;\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { MainContext, MainThreadLanguagesShape, IMainContext, ExtHostLanguagesShape } from './extHost.protocol.js';\nimport type * as vscode from 'vscode';\nimport { ExtHostDocuments } from './extHostDocuments.js';\nimport * as typeConvert from './extHostTypeConverters.js';\nimport { StandardTokenType, Range, Position, LanguageStatusSeverity } from './extHostTypes.js';\nimport Severity from '../../../base/common/severity.js';\nimport { disposableTimeout } from '../../../base/common/async.js';\nimport { DisposableStore, IDisposable } from '../../../base/common/lifecycle.js';\nimport { IExtensionDescription } from '../../../platform/extensions/common/extensions.js';\nimport { CommandsConverter } from './extHostCommands.js';\nimport { IURITransformer } from '../../../base/common/uriIpc.js';\nimport { checkProposedApiEnabled } from '../../services/extensions/common/extensions.js';\n\nexport class ExtHostLanguages implements ExtHostLanguagesShape {\n\n\tprivate readonly _proxy: MainThreadLanguagesShape;\n\n\tprivate _languageIds: string[] = [];\n\n\tconstructor(\n\t\tmainContext: IMainContext,\n\t\tprivate readonly _documents: ExtHostDocuments,\n\t\tprivate readonly _commands: CommandsConverter,\n\t\tprivate readonly _uriTransformer: IURITransformer | undefined\n\t) {\n\t\tthis._proxy = mainContext.getProxy(MainContext.MainThreadLanguages);\n\t}\n\n\t$acceptLanguageIds(ids: string[]): void {\n\t\tthis._languageIds = ids;\n\t}\n\n\tasync getLanguages(): Promise<string[]> {\n\t\treturn this._languageIds.slice(0);\n\t}\n\n\tasync changeLanguage(uri: vscode.Uri, languageId: string): Promise<vscode.TextDocument> {\n\t\tawait this._proxy.$changeLanguage(uri, languageId);\n\t\tconst data = this._documents.getDocumentData(uri);\n\t\tif (!data) {\n\t\t\tthrow new Error(`document '${uri.toString()}' NOT found`);\n\t\t}\n\t\treturn data.document;\n\t}\n\n\tasync tokenAtPosition(document: vscode.TextDocument, position: vscode.Position): Promise<vscode.TokenInformation> {\n\t\tconst versionNow = document.version;\n\t\tconst pos = typeConvert.Position.from(position);\n\t\tconst info = await this._proxy.$tokensAtPosition(document.uri, pos);\n\t\tconst defaultRange = {\n\t\t\ttype: StandardTokenType.Other,\n\t\t\trange: document.getWordRangeAtPosition(position) ?? new Range(position.line, position.character, position.line, position.character)\n\t\t};\n\t\tif (!info) {\n\t\t\t// no result\n\t\t\treturn defaultRange;\n\t\t}\n\t\tconst result = {\n\t\t\trange: typeConvert.Range.to(info.range),\n\t\t\ttype: typeConvert.TokenType.to(info.type)\n\t\t};\n\t\tif (!result.range.contains(<Position>position)) {\n\t\t\t// bogous result\n\t\t\treturn defaultRange;\n\t\t}\n\t\tif (versionNow !== document.version) {\n\t\t\t// concurrent change\n\t\t\treturn defaultRange;\n\t\t}\n\t\treturn result;\n\t}\n\n\tprivate _handlePool: number = 0;\n\tprivate _ids = new Set<string>();\n\n\tcreateLanguageStatusItem(extension: IExtensionDescription, id: string, selector: vscode.DocumentSelector): vscode.LanguageStatusItem {\n\n\t\tconst handle = this._handlePool++;\n\t\tconst proxy = this._proxy;\n\t\tconst ids = this._ids;\n\n\t\t// enforce extension unique identifier\n\t\tconst fullyQualifiedId = `${extension.identifier.value}/${id}`;\n\t\tif (ids.has(fullyQualifiedId)) {\n\t\t\tthrow new Error(`LanguageStatusItem with id '${id}' ALREADY exists`);\n\t\t}\n\t\tids.add(fullyQualifiedId);\n\n\t\tconst data: Omit<vscode.LanguageStatusItem, 'dispose' | 'text2'> = {\n\t\t\tselector,\n\t\t\tid,\n\t\t\tname: extension.displayName ?? extension.name,\n\t\t\tseverity: LanguageStatusSeverity.Information,\n\t\t\tcommand: undefined,\n\t\t\ttext: '',\n\t\t\tdetail: '',\n\t\t\tbusy: false\n\t\t};\n\n\n\t\tlet soonHandle: IDisposable | undefined;\n\t\tconst commandDisposables = new DisposableStore();\n\t\tconst updateAsync = () => {\n\t\t\tsoonHandle?.dispose();\n\n\t\t\tif (!ids.has(fullyQualifiedId)) {\n\t\t\t\tconsole.warn(`LanguageStatusItem (${id}) from ${extension.identifier.value} has been disposed and CANNOT be updated anymore`);\n\t\t\t\treturn; // disposed in the meantime\n\t\t\t}\n\n\t\t\tsoonHandle = disposableTimeout(() => {\n\t\t\t\tcommandDisposables.clear();\n\t\t\t\tthis._proxy.$setLanguageStatus(handle, {\n\t\t\t\t\tid: fullyQualifiedId,\n\t\t\t\t\tname: data.name ?? extension.displayName ?? extension.name,\n\t\t\t\t\tsource: extension.displayName ?? extension.name,\n\t\t\t\t\tselector: typeConvert.DocumentSelector.from(data.selector, this._uriTransformer),\n\t\t\t\t\tlabel: data.text,\n\t\t\t\t\tdetail: data.detail ?? '',\n\t\t\t\t\tseverity: data.severity === LanguageStatusSeverity.Error ? Severity.Error : data.severity === LanguageStatusSeverity.Warning ? Severity.Warning : Severity.Info,\n\t\t\t\t\tcommand: data.command && this._commands.toInternal(data.command, commandDisposables),\n\t\t\t\t\taccessibilityInfo: data.accessibilityInformation,\n\t\t\t\t\tbusy: data.busy\n\t\t\t\t});\n\t\t\t}, 0);\n\t\t};\n\n\t\tconst result: vscode.LanguageStatusItem = {\n\t\t\tdispose() {\n\t\t\t\tcommandDisposables.dispose();\n\t\t\t\tsoonHandle?.dispose();\n\t\t\t\tproxy.$removeLanguageStatus(handle);\n\t\t\t\tids.delete(fullyQualifiedId);\n\t\t\t},\n\t\t\tget id() {\n\t\t\t\treturn data.id;\n\t\t\t},\n\t\t\tget name() {\n\t\t\t\treturn data.name;\n\t\t\t},\n\t\t\tset name(value) {\n\t\t\t\tdata.name = value;\n\t\t\t\tupdateAsync();\n\t\t\t},\n\t\t\tget selector() {\n\t\t\t\treturn data.selector;\n\t\t\t},\n\t\t\tset selector(value) {\n\t\t\t\tdata.selector = value;\n\t\t\t\tupdateAsync();\n\t\t\t},\n\t\t\tget text() {\n\t\t\t\treturn data.text;\n\t\t\t},\n\t\t\tset text(value) {\n\t\t\t\tdata.text = value;\n\t\t\t\tupdateAsync();\n\t\t\t},\n\t\t\tset text2(value) {\n\t\t\t\tcheckProposedApiEnabled(extension, 'languageStatusText');\n\t\t\t\tdata.text = value;\n\t\t\t\tupdateAsync();\n\t\t\t},\n\t\t\tget text2() {\n\t\t\t\tcheckProposedApiEnabled(extension, 'languageStatusText');\n\t\t\t\treturn data.text;\n\t\t\t},\n\t\t\tget detail() {\n\t\t\t\treturn data.detail;\n\t\t\t},\n\t\t\tset detail(value) {\n\t\t\t\tdata.detail = value;\n\t\t\t\tupdateAsync();\n\t\t\t},\n\t\t\tget severity() {\n\t\t\t\treturn data.severity;\n\t\t\t},\n\t\t\tset severity(value) {\n\t\t\t\tdata.severity = value;\n\t\t\t\tupdateAsync();\n\t\t\t},\n\t\t\tget accessibilityInformation() {\n\t\t\t\treturn data.accessibilityInformation;\n\t\t\t},\n\t\t\tset accessibilityInformation(value) {\n\t\t\t\tdata.accessibilityInformation = value;\n\t\t\t\tupdateAsync();\n\t\t\t},\n\t\t\tget command() {\n\t\t\t\treturn data.command;\n\t\t\t},\n\t\t\tset command(value) {\n\t\t\t\tdata.command = value;\n\t\t\t\tupdateAsync();\n\t\t\t},\n\t\t\tget busy() {\n\t\t\t\treturn data.busy;\n\t\t\t},\n\t\t\tset busy(value: boolean) {\n\t\t\t\tdata.busy = value;\n\t\t\t\tupdateAsync();\n\t\t\t}\n\t\t};\n\t\tupdateAsync();\n\t\treturn result;\n\t}\n}\n"]}