{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/api/common/extHostTextEditors.ts","vs/workbench/api/common/extHostTextEditors.ts"],"names":[],"mappings":"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","file":"extHostTextEditors.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as arrays from '../../../base/common/arrays.js';\nimport { Emitter, Event } from '../../../base/common/event.js';\nimport { Disposable } from '../../../base/common/lifecycle.js';\nimport { URI } from '../../../base/common/uri.js';\nimport { IExtensionDescription } from '../../../platform/extensions/common/extensions.js';\nimport { ExtHostEditorsShape, IEditorPropertiesChangeData, IMainContext, ITextDocumentShowOptions, ITextEditorDiffInformation, ITextEditorPositionData, MainContext, MainThreadTextEditorsShape } from './extHost.protocol.js';\nimport { ExtHostDocumentsAndEditors } from './extHostDocumentsAndEditors.js';\nimport { ExtHostTextEditor, TextEditorDecorationType } from './extHostTextEditor.js';\nimport * as TypeConverters from './extHostTypeConverters.js';\nimport { TextEditorSelectionChangeKind, TextEditorChangeKind } from './extHostTypes.js';\nimport * as vscode from 'vscode';\n\nexport class ExtHostEditors extends Disposable implements ExtHostEditorsShape {\n\n\tprivate readonly _onDidChangeTextEditorSelection = new Emitter<vscode.TextEditorSelectionChangeEvent>();\n\tprivate readonly _onDidChangeTextEditorOptions = new Emitter<vscode.TextEditorOptionsChangeEvent>();\n\tprivate readonly _onDidChangeTextEditorVisibleRanges = new Emitter<vscode.TextEditorVisibleRangesChangeEvent>();\n\tprivate readonly _onDidChangeTextEditorViewColumn = new Emitter<vscode.TextEditorViewColumnChangeEvent>();\n\tprivate readonly _onDidChangeTextEditorDiffInformation = new Emitter<vscode.TextEditorDiffInformationChangeEvent>();\n\tprivate readonly _onDidChangeActiveTextEditor = new Emitter<vscode.TextEditor | undefined>();\n\tprivate readonly _onDidChangeVisibleTextEditors = new Emitter<readonly vscode.TextEditor[]>();\n\n\treadonly onDidChangeTextEditorSelection: Event<vscode.TextEditorSelectionChangeEvent> = this._onDidChangeTextEditorSelection.event;\n\treadonly onDidChangeTextEditorOptions: Event<vscode.TextEditorOptionsChangeEvent> = this._onDidChangeTextEditorOptions.event;\n\treadonly onDidChangeTextEditorVisibleRanges: Event<vscode.TextEditorVisibleRangesChangeEvent> = this._onDidChangeTextEditorVisibleRanges.event;\n\treadonly onDidChangeTextEditorViewColumn: Event<vscode.TextEditorViewColumnChangeEvent> = this._onDidChangeTextEditorViewColumn.event;\n\treadonly onDidChangeTextEditorDiffInformation: Event<vscode.TextEditorDiffInformationChangeEvent> = this._onDidChangeTextEditorDiffInformation.event;\n\treadonly onDidChangeActiveTextEditor: Event<vscode.TextEditor | undefined> = this._onDidChangeActiveTextEditor.event;\n\treadonly onDidChangeVisibleTextEditors: Event<readonly vscode.TextEditor[]> = this._onDidChangeVisibleTextEditors.event;\n\n\tprivate readonly _proxy: MainThreadTextEditorsShape;\n\n\tconstructor(\n\t\tmainContext: IMainContext,\n\t\tprivate readonly _extHostDocumentsAndEditors: ExtHostDocumentsAndEditors,\n\t) {\n\t\tsuper();\n\t\tthis._proxy = mainContext.getProxy(MainContext.MainThreadTextEditors);\n\n\t\tthis._register(this._extHostDocumentsAndEditors.onDidChangeVisibleTextEditors(e => this._onDidChangeVisibleTextEditors.fire(e)));\n\t\tthis._register(this._extHostDocumentsAndEditors.onDidChangeActiveTextEditor(e => this._onDidChangeActiveTextEditor.fire(e)));\n\t}\n\n\tgetActiveTextEditor(): vscode.TextEditor | undefined {\n\t\treturn this._extHostDocumentsAndEditors.activeEditor();\n\t}\n\n\tgetVisibleTextEditors(): vscode.TextEditor[];\n\tgetVisibleTextEditors(internal: true): ExtHostTextEditor[];\n\tgetVisibleTextEditors(internal?: true): ExtHostTextEditor[] | vscode.TextEditor[] {\n\t\tconst editors = this._extHostDocumentsAndEditors.allEditors();\n\t\treturn internal\n\t\t\t? editors\n\t\t\t: editors.map(editor => editor.value);\n\t}\n\n\tshowTextDocument(document: vscode.TextDocument, column: vscode.ViewColumn, preserveFocus: boolean): Promise<vscode.TextEditor>;\n\tshowTextDocument(document: vscode.TextDocument, options: { column: vscode.ViewColumn; preserveFocus: boolean; pinned: boolean }): Promise<vscode.TextEditor>;\n\tshowTextDocument(document: vscode.TextDocument, columnOrOptions: vscode.ViewColumn | vscode.TextDocumentShowOptions | undefined, preserveFocus?: boolean): Promise<vscode.TextEditor>;\n\tasync showTextDocument(document: vscode.TextDocument, columnOrOptions: vscode.ViewColumn | vscode.TextDocumentShowOptions | undefined, preserveFocus?: boolean): Promise<vscode.TextEditor> {\n\t\tlet options: ITextDocumentShowOptions;\n\t\tif (typeof columnOrOptions === 'number') {\n\t\t\toptions = {\n\t\t\t\tposition: TypeConverters.ViewColumn.from(columnOrOptions),\n\t\t\t\tpreserveFocus\n\t\t\t};\n\t\t} else if (typeof columnOrOptions === 'object') {\n\t\t\toptions = {\n\t\t\t\tposition: TypeConverters.ViewColumn.from(columnOrOptions.viewColumn),\n\t\t\t\tpreserveFocus: columnOrOptions.preserveFocus,\n\t\t\t\tselection: typeof columnOrOptions.selection === 'object' ? TypeConverters.Range.from(columnOrOptions.selection) : undefined,\n\t\t\t\tpinned: typeof columnOrOptions.preview === 'boolean' ? !columnOrOptions.preview : undefined\n\t\t\t};\n\t\t} else {\n\t\t\toptions = {\n\t\t\t\tpreserveFocus: false\n\t\t\t};\n\t\t}\n\n\t\tconst editorId = await this._proxy.$tryShowTextDocument(document.uri, options);\n\t\tconst editor = editorId && this._extHostDocumentsAndEditors.getEditor(editorId);\n\t\tif (editor) {\n\t\t\treturn editor.value;\n\t\t}\n\t\t// we have no editor... having an id means that we had an editor\n\t\t// on the main side and that it isn't the current editor anymore...\n\t\tif (editorId) {\n\t\t\tthrow new Error(`Could NOT open editor for \"${document.uri.toString()}\" because another editor opened in the meantime.`);\n\t\t} else {\n\t\t\tthrow new Error(`Could NOT open editor for \"${document.uri.toString()}\".`);\n\t\t}\n\t}\n\n\tcreateTextEditorDecorationType(extension: IExtensionDescription, options: vscode.DecorationRenderOptions): vscode.TextEditorDecorationType {\n\t\treturn new TextEditorDecorationType(this._proxy, extension, options).value;\n\t}\n\n\t// --- called from main thread\n\n\t$acceptEditorPropertiesChanged(id: string, data: IEditorPropertiesChangeData): void {\n\t\tconst textEditor = this._extHostDocumentsAndEditors.getEditor(id);\n\t\tif (!textEditor) {\n\t\t\tthrow new Error('unknown text editor');\n\t\t}\n\n\t\t// (1) set all properties\n\t\tif (data.options) {\n\t\t\ttextEditor._acceptOptions(data.options);\n\t\t}\n\t\tif (data.selections) {\n\t\t\tconst selections = data.selections.selections.map(TypeConverters.Selection.to);\n\t\t\ttextEditor._acceptSelections(selections);\n\t\t}\n\t\tif (data.visibleRanges) {\n\t\t\tconst visibleRanges = arrays.coalesce(data.visibleRanges.map(TypeConverters.Range.to));\n\t\t\ttextEditor._acceptVisibleRanges(visibleRanges);\n\t\t}\n\n\t\t// (2) fire change events\n\t\tif (data.options) {\n\t\t\tthis._onDidChangeTextEditorOptions.fire({\n\t\t\t\ttextEditor: textEditor.value,\n\t\t\t\toptions: { ...data.options, lineNumbers: TypeConverters.TextEditorLineNumbersStyle.to(data.options.lineNumbers) }\n\t\t\t});\n\t\t}\n\t\tif (data.selections) {\n\t\t\tconst kind = TextEditorSelectionChangeKind.fromValue(data.selections.source);\n\t\t\tconst selections = data.selections.selections.map(TypeConverters.Selection.to);\n\t\t\tthis._onDidChangeTextEditorSelection.fire({\n\t\t\t\ttextEditor: textEditor.value,\n\t\t\t\tselections,\n\t\t\t\tkind\n\t\t\t});\n\t\t}\n\t\tif (data.visibleRanges) {\n\t\t\tconst visibleRanges = arrays.coalesce(data.visibleRanges.map(TypeConverters.Range.to));\n\t\t\tthis._onDidChangeTextEditorVisibleRanges.fire({\n\t\t\t\ttextEditor: textEditor.value,\n\t\t\t\tvisibleRanges\n\t\t\t});\n\t\t}\n\t}\n\n\t$acceptEditorPositionData(data: ITextEditorPositionData): void {\n\t\tfor (const id in data) {\n\t\t\tconst textEditor = this._extHostDocumentsAndEditors.getEditor(id);\n\t\t\tif (!textEditor) {\n\t\t\t\tthrow new Error('Unknown text editor');\n\t\t\t}\n\t\t\tconst viewColumn = TypeConverters.ViewColumn.to(data[id]);\n\t\t\tif (textEditor.value.viewColumn !== viewColumn) {\n\t\t\t\ttextEditor._acceptViewColumn(viewColumn);\n\t\t\t\tthis._onDidChangeTextEditorViewColumn.fire({ textEditor: textEditor.value, viewColumn });\n\t\t\t}\n\t\t}\n\t}\n\n\t$acceptEditorDiffInformation(id: string, diffInformation: ITextEditorDiffInformation[] | undefined): void {\n\t\tconst textEditor = this._extHostDocumentsAndEditors.getEditor(id);\n\t\tif (!textEditor) {\n\t\t\tthrow new Error('unknown text editor');\n\t\t}\n\n\t\tif (!diffInformation) {\n\t\t\ttextEditor._acceptDiffInformation(undefined);\n\t\t\tthis._onDidChangeTextEditorDiffInformation.fire({\n\t\t\t\ttextEditor: textEditor.value,\n\t\t\t\tdiffInformation: undefined\n\t\t\t});\n\t\t\treturn;\n\t\t}\n\n\t\tconst that = this;\n\t\tconst result = diffInformation.map(diff => {\n\t\t\tconst original = URI.revive(diff.original);\n\t\t\tconst modified = URI.revive(diff.modified);\n\n\t\t\tconst changes = diff.changes.map(change => {\n\t\t\t\tconst [originalStartLineNumber, originalEndLineNumberExclusive, modifiedStartLineNumber, modifiedEndLineNumberExclusive] = change;\n\n\t\t\t\tlet kind: vscode.TextEditorChangeKind;\n\t\t\t\tif (originalStartLineNumber === originalEndLineNumberExclusive) {\n\t\t\t\t\tkind = TextEditorChangeKind.Addition;\n\t\t\t\t} else if (modifiedStartLineNumber === modifiedEndLineNumberExclusive) {\n\t\t\t\t\tkind = TextEditorChangeKind.Deletion;\n\t\t\t\t} else {\n\t\t\t\t\tkind = TextEditorChangeKind.Modification;\n\t\t\t\t}\n\n\t\t\t\treturn {\n\t\t\t\t\toriginal: {\n\t\t\t\t\t\tstartLineNumber: originalStartLineNumber,\n\t\t\t\t\t\tendLineNumberExclusive: originalEndLineNumberExclusive\n\t\t\t\t\t},\n\t\t\t\t\tmodified: {\n\t\t\t\t\t\tstartLineNumber: modifiedStartLineNumber,\n\t\t\t\t\t\tendLineNumberExclusive: modifiedEndLineNumberExclusive\n\t\t\t\t\t},\n\t\t\t\t\tkind\n\t\t\t\t} satisfies vscode.TextEditorChange;\n\t\t\t});\n\n\t\t\treturn Object.freeze({\n\t\t\t\tdocumentVersion: diff.documentVersion,\n\t\t\t\toriginal,\n\t\t\t\tmodified,\n\t\t\t\tchanges,\n\t\t\t\tget isStale(): boolean {\n\t\t\t\t\tconst document = that._extHostDocumentsAndEditors.getDocument(modified);\n\t\t\t\t\treturn document?.version !== diff.documentVersion;\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\n\t\ttextEditor._acceptDiffInformation(result);\n\t\tthis._onDidChangeTextEditorDiffInformation.fire({\n\t\t\ttextEditor: textEditor.value,\n\t\t\tdiffInformation: result\n\t\t});\n\t}\n\n\tgetDiffInformation(id: string): Promise<vscode.LineChange[]> {\n\t\treturn Promise.resolve(this._proxy.$getDiffInformation(id));\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as arrays from '../../../base/common/arrays.js';\nimport { Emitter, Event } from '../../../base/common/event.js';\nimport { Disposable } from '../../../base/common/lifecycle.js';\nimport { URI } from '../../../base/common/uri.js';\nimport { IExtensionDescription } from '../../../platform/extensions/common/extensions.js';\nimport { ExtHostEditorsShape, IEditorPropertiesChangeData, IMainContext, ITextDocumentShowOptions, ITextEditorDiffInformation, ITextEditorPositionData, MainContext, MainThreadTextEditorsShape } from './extHost.protocol.js';\nimport { ExtHostDocumentsAndEditors } from './extHostDocumentsAndEditors.js';\nimport { ExtHostTextEditor, TextEditorDecorationType } from './extHostTextEditor.js';\nimport * as TypeConverters from './extHostTypeConverters.js';\nimport { TextEditorSelectionChangeKind, TextEditorChangeKind } from './extHostTypes.js';\nimport * as vscode from 'vscode';\n\nexport class ExtHostEditors extends Disposable implements ExtHostEditorsShape {\n\n\tprivate readonly _onDidChangeTextEditorSelection = new Emitter<vscode.TextEditorSelectionChangeEvent>();\n\tprivate readonly _onDidChangeTextEditorOptions = new Emitter<vscode.TextEditorOptionsChangeEvent>();\n\tprivate readonly _onDidChangeTextEditorVisibleRanges = new Emitter<vscode.TextEditorVisibleRangesChangeEvent>();\n\tprivate readonly _onDidChangeTextEditorViewColumn = new Emitter<vscode.TextEditorViewColumnChangeEvent>();\n\tprivate readonly _onDidChangeTextEditorDiffInformation = new Emitter<vscode.TextEditorDiffInformationChangeEvent>();\n\tprivate readonly _onDidChangeActiveTextEditor = new Emitter<vscode.TextEditor | undefined>();\n\tprivate readonly _onDidChangeVisibleTextEditors = new Emitter<readonly vscode.TextEditor[]>();\n\n\treadonly onDidChangeTextEditorSelection: Event<vscode.TextEditorSelectionChangeEvent> = this._onDidChangeTextEditorSelection.event;\n\treadonly onDidChangeTextEditorOptions: Event<vscode.TextEditorOptionsChangeEvent> = this._onDidChangeTextEditorOptions.event;\n\treadonly onDidChangeTextEditorVisibleRanges: Event<vscode.TextEditorVisibleRangesChangeEvent> = this._onDidChangeTextEditorVisibleRanges.event;\n\treadonly onDidChangeTextEditorViewColumn: Event<vscode.TextEditorViewColumnChangeEvent> = this._onDidChangeTextEditorViewColumn.event;\n\treadonly onDidChangeTextEditorDiffInformation: Event<vscode.TextEditorDiffInformationChangeEvent> = this._onDidChangeTextEditorDiffInformation.event;\n\treadonly onDidChangeActiveTextEditor: Event<vscode.TextEditor | undefined> = this._onDidChangeActiveTextEditor.event;\n\treadonly onDidChangeVisibleTextEditors: Event<readonly vscode.TextEditor[]> = this._onDidChangeVisibleTextEditors.event;\n\n\tprivate readonly _proxy: MainThreadTextEditorsShape;\n\n\tconstructor(\n\t\tmainContext: IMainContext,\n\t\tprivate readonly _extHostDocumentsAndEditors: ExtHostDocumentsAndEditors,\n\t) {\n\t\tsuper();\n\t\tthis._proxy = mainContext.getProxy(MainContext.MainThreadTextEditors);\n\n\t\tthis._register(this._extHostDocumentsAndEditors.onDidChangeVisibleTextEditors(e => this._onDidChangeVisibleTextEditors.fire(e)));\n\t\tthis._register(this._extHostDocumentsAndEditors.onDidChangeActiveTextEditor(e => this._onDidChangeActiveTextEditor.fire(e)));\n\t}\n\n\tgetActiveTextEditor(): vscode.TextEditor | undefined {\n\t\treturn this._extHostDocumentsAndEditors.activeEditor();\n\t}\n\n\tgetVisibleTextEditors(): vscode.TextEditor[];\n\tgetVisibleTextEditors(internal: true): ExtHostTextEditor[];\n\tgetVisibleTextEditors(internal?: true): ExtHostTextEditor[] | vscode.TextEditor[] {\n\t\tconst editors = this._extHostDocumentsAndEditors.allEditors();\n\t\treturn internal\n\t\t\t? editors\n\t\t\t: editors.map(editor => editor.value);\n\t}\n\n\tshowTextDocument(document: vscode.TextDocument, column: vscode.ViewColumn, preserveFocus: boolean): Promise<vscode.TextEditor>;\n\tshowTextDocument(document: vscode.TextDocument, options: { column: vscode.ViewColumn; preserveFocus: boolean; pinned: boolean }): Promise<vscode.TextEditor>;\n\tshowTextDocument(document: vscode.TextDocument, columnOrOptions: vscode.ViewColumn | vscode.TextDocumentShowOptions | undefined, preserveFocus?: boolean): Promise<vscode.TextEditor>;\n\tasync showTextDocument(document: vscode.TextDocument, columnOrOptions: vscode.ViewColumn | vscode.TextDocumentShowOptions | undefined, preserveFocus?: boolean): Promise<vscode.TextEditor> {\n\t\tlet options: ITextDocumentShowOptions;\n\t\tif (typeof columnOrOptions === 'number') {\n\t\t\toptions = {\n\t\t\t\tposition: TypeConverters.ViewColumn.from(columnOrOptions),\n\t\t\t\tpreserveFocus\n\t\t\t};\n\t\t} else if (typeof columnOrOptions === 'object') {\n\t\t\toptions = {\n\t\t\t\tposition: TypeConverters.ViewColumn.from(columnOrOptions.viewColumn),\n\t\t\t\tpreserveFocus: columnOrOptions.preserveFocus,\n\t\t\t\tselection: typeof columnOrOptions.selection === 'object' ? TypeConverters.Range.from(columnOrOptions.selection) : undefined,\n\t\t\t\tpinned: typeof columnOrOptions.preview === 'boolean' ? !columnOrOptions.preview : undefined\n\t\t\t};\n\t\t} else {\n\t\t\toptions = {\n\t\t\t\tpreserveFocus: false\n\t\t\t};\n\t\t}\n\n\t\tconst editorId = await this._proxy.$tryShowTextDocument(document.uri, options);\n\t\tconst editor = editorId && this._extHostDocumentsAndEditors.getEditor(editorId);\n\t\tif (editor) {\n\t\t\treturn editor.value;\n\t\t}\n\t\t// we have no editor... having an id means that we had an editor\n\t\t// on the main side and that it isn't the current editor anymore...\n\t\tif (editorId) {\n\t\t\tthrow new Error(`Could NOT open editor for \"${document.uri.toString()}\" because another editor opened in the meantime.`);\n\t\t} else {\n\t\t\tthrow new Error(`Could NOT open editor for \"${document.uri.toString()}\".`);\n\t\t}\n\t}\n\n\tcreateTextEditorDecorationType(extension: IExtensionDescription, options: vscode.DecorationRenderOptions): vscode.TextEditorDecorationType {\n\t\treturn new TextEditorDecorationType(this._proxy, extension, options).value;\n\t}\n\n\t// --- called from main thread\n\n\t$acceptEditorPropertiesChanged(id: string, data: IEditorPropertiesChangeData): void {\n\t\tconst textEditor = this._extHostDocumentsAndEditors.getEditor(id);\n\t\tif (!textEditor) {\n\t\t\tthrow new Error('unknown text editor');\n\t\t}\n\n\t\t// (1) set all properties\n\t\tif (data.options) {\n\t\t\ttextEditor._acceptOptions(data.options);\n\t\t}\n\t\tif (data.selections) {\n\t\t\tconst selections = data.selections.selections.map(TypeConverters.Selection.to);\n\t\t\ttextEditor._acceptSelections(selections);\n\t\t}\n\t\tif (data.visibleRanges) {\n\t\t\tconst visibleRanges = arrays.coalesce(data.visibleRanges.map(TypeConverters.Range.to));\n\t\t\ttextEditor._acceptVisibleRanges(visibleRanges);\n\t\t}\n\n\t\t// (2) fire change events\n\t\tif (data.options) {\n\t\t\tthis._onDidChangeTextEditorOptions.fire({\n\t\t\t\ttextEditor: textEditor.value,\n\t\t\t\toptions: { ...data.options, lineNumbers: TypeConverters.TextEditorLineNumbersStyle.to(data.options.lineNumbers) }\n\t\t\t});\n\t\t}\n\t\tif (data.selections) {\n\t\t\tconst kind = TextEditorSelectionChangeKind.fromValue(data.selections.source);\n\t\t\tconst selections = data.selections.selections.map(TypeConverters.Selection.to);\n\t\t\tthis._onDidChangeTextEditorSelection.fire({\n\t\t\t\ttextEditor: textEditor.value,\n\t\t\t\tselections,\n\t\t\t\tkind\n\t\t\t});\n\t\t}\n\t\tif (data.visibleRanges) {\n\t\t\tconst visibleRanges = arrays.coalesce(data.visibleRanges.map(TypeConverters.Range.to));\n\t\t\tthis._onDidChangeTextEditorVisibleRanges.fire({\n\t\t\t\ttextEditor: textEditor.value,\n\t\t\t\tvisibleRanges\n\t\t\t});\n\t\t}\n\t}\n\n\t$acceptEditorPositionData(data: ITextEditorPositionData): void {\n\t\tfor (const id in data) {\n\t\t\tconst textEditor = this._extHostDocumentsAndEditors.getEditor(id);\n\t\t\tif (!textEditor) {\n\t\t\t\tthrow new Error('Unknown text editor');\n\t\t\t}\n\t\t\tconst viewColumn = TypeConverters.ViewColumn.to(data[id]);\n\t\t\tif (textEditor.value.viewColumn !== viewColumn) {\n\t\t\t\ttextEditor._acceptViewColumn(viewColumn);\n\t\t\t\tthis._onDidChangeTextEditorViewColumn.fire({ textEditor: textEditor.value, viewColumn });\n\t\t\t}\n\t\t}\n\t}\n\n\t$acceptEditorDiffInformation(id: string, diffInformation: ITextEditorDiffInformation[] | undefined): void {\n\t\tconst textEditor = this._extHostDocumentsAndEditors.getEditor(id);\n\t\tif (!textEditor) {\n\t\t\tthrow new Error('unknown text editor');\n\t\t}\n\n\t\tif (!diffInformation) {\n\t\t\ttextEditor._acceptDiffInformation(undefined);\n\t\t\tthis._onDidChangeTextEditorDiffInformation.fire({\n\t\t\t\ttextEditor: textEditor.value,\n\t\t\t\tdiffInformation: undefined\n\t\t\t});\n\t\t\treturn;\n\t\t}\n\n\t\tconst that = this;\n\t\tconst result = diffInformation.map(diff => {\n\t\t\tconst original = URI.revive(diff.original);\n\t\t\tconst modified = URI.revive(diff.modified);\n\n\t\t\tconst changes = diff.changes.map(change => {\n\t\t\t\tconst [originalStartLineNumber, originalEndLineNumberExclusive, modifiedStartLineNumber, modifiedEndLineNumberExclusive] = change;\n\n\t\t\t\tlet kind: vscode.TextEditorChangeKind;\n\t\t\t\tif (originalStartLineNumber === originalEndLineNumberExclusive) {\n\t\t\t\t\tkind = TextEditorChangeKind.Addition;\n\t\t\t\t} else if (modifiedStartLineNumber === modifiedEndLineNumberExclusive) {\n\t\t\t\t\tkind = TextEditorChangeKind.Deletion;\n\t\t\t\t} else {\n\t\t\t\t\tkind = TextEditorChangeKind.Modification;\n\t\t\t\t}\n\n\t\t\t\treturn {\n\t\t\t\t\toriginal: {\n\t\t\t\t\t\tstartLineNumber: originalStartLineNumber,\n\t\t\t\t\t\tendLineNumberExclusive: originalEndLineNumberExclusive\n\t\t\t\t\t},\n\t\t\t\t\tmodified: {\n\t\t\t\t\t\tstartLineNumber: modifiedStartLineNumber,\n\t\t\t\t\t\tendLineNumberExclusive: modifiedEndLineNumberExclusive\n\t\t\t\t\t},\n\t\t\t\t\tkind\n\t\t\t\t} satisfies vscode.TextEditorChange;\n\t\t\t});\n\n\t\t\treturn Object.freeze({\n\t\t\t\tdocumentVersion: diff.documentVersion,\n\t\t\t\toriginal,\n\t\t\t\tmodified,\n\t\t\t\tchanges,\n\t\t\t\tget isStale(): boolean {\n\t\t\t\t\tconst document = that._extHostDocumentsAndEditors.getDocument(modified);\n\t\t\t\t\treturn document?.version !== diff.documentVersion;\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\n\t\ttextEditor._acceptDiffInformation(result);\n\t\tthis._onDidChangeTextEditorDiffInformation.fire({\n\t\t\ttextEditor: textEditor.value,\n\t\t\tdiffInformation: result\n\t\t});\n\t}\n\n\tgetDiffInformation(id: string): Promise<vscode.LineChange[]> {\n\t\treturn Promise.resolve(this._proxy.$getDiffInformation(id));\n\t}\n}\n"]}