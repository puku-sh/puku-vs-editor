{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/api/common/extHostCommands.ts","vs/workbench/api/common/extHostCommands.ts"],"names":[],"mappings":"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","file":"extHostCommands.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\n/* eslint-disable local/code-no-native-private */\n\nimport { validateConstraint } from '../../../base/common/types.js';\nimport { ICommandMetadata } from '../../../platform/commands/common/commands.js';\nimport * as extHostTypes from './extHostTypes.js';\nimport * as extHostTypeConverter from './extHostTypeConverters.js';\nimport { cloneAndChange } from '../../../base/common/objects.js';\nimport { MainContext, MainThreadCommandsShape, ExtHostCommandsShape, ICommandDto, ICommandMetadataDto, MainThreadTelemetryShape } from './extHost.protocol.js';\nimport { isNonEmptyArray } from '../../../base/common/arrays.js';\nimport * as languages from '../../../editor/common/languages.js';\nimport type * as vscode from 'vscode';\nimport { ILogService } from '../../../platform/log/common/log.js';\nimport { revive } from '../../../base/common/marshalling.js';\nimport { IRange, Range } from '../../../editor/common/core/range.js';\nimport { IPosition, Position } from '../../../editor/common/core/position.js';\nimport { URI } from '../../../base/common/uri.js';\nimport { DisposableStore, toDisposable } from '../../../base/common/lifecycle.js';\nimport { createDecorator } from '../../../platform/instantiation/common/instantiation.js';\nimport { IExtHostRpcService } from './extHostRpcService.js';\nimport { ISelection } from '../../../editor/common/core/selection.js';\nimport { TestItemImpl } from './extHostTestItem.js';\nimport { VSBuffer } from '../../../base/common/buffer.js';\nimport { SerializableObjectWithBuffers } from '../../services/extensions/common/proxyIdentifier.js';\nimport { toErrorMessage } from '../../../base/common/errorMessage.js';\nimport { StopWatch } from '../../../base/common/stopwatch.js';\nimport { IExtensionDescription } from '../../../platform/extensions/common/extensions.js';\nimport { TelemetryTrustedValue } from '../../../platform/telemetry/common/telemetryUtils.js';\nimport { IExtHostTelemetry } from './extHostTelemetry.js';\nimport { generateUuid } from '../../../base/common/uuid.js';\nimport { isCancellationError } from '../../../base/common/errors.js';\n\ninterface CommandHandler {\n\tcallback: Function;\n\tthisArg: any;\n\tmetadata?: ICommandMetadata;\n\textension?: IExtensionDescription;\n}\n\nexport interface ArgumentProcessor {\n\tprocessArgument(arg: any, extension: IExtensionDescription | undefined): any;\n}\n\nexport class ExtHostCommands implements ExtHostCommandsShape {\n\n\treadonly _serviceBrand: undefined;\n\n\t#proxy: MainThreadCommandsShape;\n\n\tprivate readonly _commands = new Map<string, CommandHandler>();\n\tprivate readonly _apiCommands = new Map<string, ApiCommand>();\n\t#telemetry: MainThreadTelemetryShape;\n\n\tprivate readonly _logService: ILogService;\n\treadonly #extHostTelemetry: IExtHostTelemetry;\n\tprivate readonly _argumentProcessors: ArgumentProcessor[];\n\n\treadonly converter: CommandsConverter;\n\n\tconstructor(\n\t\t@IExtHostRpcService extHostRpc: IExtHostRpcService,\n\t\t@ILogService logService: ILogService,\n\t\t@IExtHostTelemetry extHostTelemetry: IExtHostTelemetry\n\t) {\n\t\tthis.#proxy = extHostRpc.getProxy(MainContext.MainThreadCommands);\n\t\tthis._logService = logService;\n\t\tthis.#extHostTelemetry = extHostTelemetry;\n\t\tthis.#telemetry = extHostRpc.getProxy(MainContext.MainThreadTelemetry);\n\t\tthis.converter = new CommandsConverter(\n\t\t\tthis,\n\t\t\tid => {\n\t\t\t\t// API commands that have no return type (void) can be\n\t\t\t\t// converted to their internal command and don't need\n\t\t\t\t// any indirection commands\n\t\t\t\tconst candidate = this._apiCommands.get(id);\n\t\t\t\treturn candidate?.result === ApiCommandResult.Void\n\t\t\t\t\t? candidate : undefined;\n\t\t\t},\n\t\t\tlogService\n\t\t);\n\t\tthis._argumentProcessors = [\n\t\t\t{\n\t\t\t\tprocessArgument(a) {\n\t\t\t\t\t// URI, Regex\n\t\t\t\t\treturn revive(a);\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\tprocessArgument(arg) {\n\t\t\t\t\treturn cloneAndChange(arg, function (obj) {\n\t\t\t\t\t\t// Reverse of https://github.com/microsoft/vscode/blob/1f28c5fc681f4c01226460b6d1c7e91b8acb4a5b/src/vs/workbench/api/node/extHostCommands.ts#L112-L127\n\t\t\t\t\t\tif (Range.isIRange(obj)) {\n\t\t\t\t\t\t\treturn extHostTypeConverter.Range.to(obj);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (Position.isIPosition(obj)) {\n\t\t\t\t\t\t\treturn extHostTypeConverter.Position.to(obj);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (Range.isIRange((obj as languages.Location).range) && URI.isUri((obj as languages.Location).uri)) {\n\t\t\t\t\t\t\treturn extHostTypeConverter.location.to(obj);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (obj instanceof VSBuffer) {\n\t\t\t\t\t\t\treturn obj.buffer.buffer;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (!Array.isArray(obj)) {\n\t\t\t\t\t\t\treturn obj;\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t];\n\t}\n\n\tregisterArgumentProcessor(processor: ArgumentProcessor): void {\n\t\tthis._argumentProcessors.push(processor);\n\t}\n\n\tregisterApiCommand(apiCommand: ApiCommand): extHostTypes.Disposable {\n\n\n\t\tconst registration = this.registerCommand(false, apiCommand.id, async (...apiArgs) => {\n\n\t\t\tconst internalArgs = apiCommand.args.map((arg, i) => {\n\t\t\t\tif (!arg.validate(apiArgs[i])) {\n\t\t\t\t\tthrow new Error(`Invalid argument '${arg.name}' when running '${apiCommand.id}', received: ${typeof apiArgs[i] === 'object' ? JSON.stringify(apiArgs[i], null, '\\t') : apiArgs[i]} `);\n\t\t\t\t}\n\t\t\t\treturn arg.convert(apiArgs[i]);\n\t\t\t});\n\n\t\t\tconst internalResult = await this.executeCommand(apiCommand.internalId, ...internalArgs);\n\t\t\treturn apiCommand.result.convert(internalResult, apiArgs, this.converter);\n\t\t}, undefined, {\n\t\t\tdescription: apiCommand.description,\n\t\t\targs: apiCommand.args,\n\t\t\treturns: apiCommand.result.description\n\t\t});\n\n\t\tthis._apiCommands.set(apiCommand.id, apiCommand);\n\n\t\treturn new extHostTypes.Disposable(() => {\n\t\t\tregistration.dispose();\n\t\t\tthis._apiCommands.delete(apiCommand.id);\n\t\t});\n\t}\n\n\tregisterCommand(global: boolean, id: string, callback: <T>(...args: any[]) => T | Thenable<T>, thisArg?: any, metadata?: ICommandMetadata, extension?: IExtensionDescription): extHostTypes.Disposable {\n\t\tthis._logService.trace('ExtHostCommands#registerCommand', id);\n\n\t\tif (!id.trim().length) {\n\t\t\tthrow new Error('invalid id');\n\t\t}\n\n\t\tif (this._commands.has(id)) {\n\t\t\tthrow new Error(`command '${id}' already exists`);\n\t\t}\n\n\t\tthis._commands.set(id, { callback, thisArg, metadata, extension });\n\t\tif (global) {\n\t\t\tthis.#proxy.$registerCommand(id);\n\t\t}\n\n\t\treturn new extHostTypes.Disposable(() => {\n\t\t\tif (this._commands.delete(id)) {\n\t\t\t\tif (global) {\n\t\t\t\t\tthis.#proxy.$unregisterCommand(id);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\texecuteCommand<T>(id: string, ...args: unknown[]): Promise<T> {\n\t\tthis._logService.trace('ExtHostCommands#executeCommand', id);\n\t\treturn this._doExecuteCommand(id, args, true);\n\t}\n\n\tprivate async _doExecuteCommand<T>(id: string, args: unknown[], retry: boolean): Promise<T> {\n\n\t\tif (this._commands.has(id)) {\n\t\t\t// - We stay inside the extension host and support\n\t\t\t// \t to pass any kind of parameters around.\n\t\t\t// - We still emit the corresponding activation event\n\t\t\t//   BUT we don't await that event\n\t\t\tthis.#proxy.$fireCommandActivationEvent(id);\n\t\t\treturn this._executeContributedCommand<T>(id, args, false);\n\n\t\t} else {\n\t\t\t// automagically convert some argument types\n\t\t\tlet hasBuffers = false;\n\t\t\tconst toArgs = cloneAndChange(args, function (value) {\n\t\t\t\tif (value instanceof extHostTypes.Position) {\n\t\t\t\t\treturn extHostTypeConverter.Position.from(value);\n\t\t\t\t} else if (value instanceof extHostTypes.Range) {\n\t\t\t\t\treturn extHostTypeConverter.Range.from(value);\n\t\t\t\t} else if (value instanceof extHostTypes.Location) {\n\t\t\t\t\treturn extHostTypeConverter.location.from(value);\n\t\t\t\t} else if (extHostTypes.NotebookRange.isNotebookRange(value)) {\n\t\t\t\t\treturn extHostTypeConverter.NotebookRange.from(value);\n\t\t\t\t} else if (value instanceof ArrayBuffer) {\n\t\t\t\t\thasBuffers = true;\n\t\t\t\t\treturn VSBuffer.wrap(new Uint8Array(value));\n\t\t\t\t} else if (value instanceof Uint8Array) {\n\t\t\t\t\thasBuffers = true;\n\t\t\t\t\treturn VSBuffer.wrap(value);\n\t\t\t\t} else if (value instanceof VSBuffer) {\n\t\t\t\t\thasBuffers = true;\n\t\t\t\t\treturn value;\n\t\t\t\t}\n\t\t\t\tif (!Array.isArray(value)) {\n\t\t\t\t\treturn value;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\ttry {\n\t\t\t\tconst result = await this.#proxy.$executeCommand(id, hasBuffers ? new SerializableObjectWithBuffers(toArgs) : toArgs, retry);\n\t\t\t\treturn revive<any>(result);\n\t\t\t} catch (e) {\n\t\t\t\t// Rerun the command when it wasn't known, had arguments, and when retry\n\t\t\t\t// is enabled. We do this because the command might be registered inside\n\t\t\t\t// the extension host now and can therefore accept the arguments as-is.\n\t\t\t\tif (e instanceof Error && e.message === '$executeCommand:retry') {\n\t\t\t\t\treturn this._doExecuteCommand(id, args, false);\n\t\t\t\t} else {\n\t\t\t\t\tthrow e;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate async _executeContributedCommand<T = unknown>(id: string, args: unknown[], annotateError: boolean): Promise<T> {\n\t\tconst command = this._commands.get(id);\n\t\tif (!command) {\n\t\t\tthrow new Error('Unknown command');\n\t\t}\n\t\tconst { callback, thisArg, metadata } = command;\n\t\tif (metadata?.args) {\n\t\t\tfor (let i = 0; i < metadata.args.length; i++) {\n\t\t\t\ttry {\n\t\t\t\t\tvalidateConstraint(args[i], metadata.args[i].constraint);\n\t\t\t\t} catch (err) {\n\t\t\t\t\tthrow new Error(`Running the contributed command: '${id}' failed. Illegal argument '${metadata.args[i].name}' - ${metadata.args[i].description}`);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tconst stopWatch = StopWatch.create();\n\t\ttry {\n\t\t\treturn await callback.apply(thisArg, args);\n\t\t} catch (err) {\n\t\t\t// The indirection-command from the converter can fail when invoking the actual\n\t\t\t// command and in that case it is better to blame the correct command\n\t\t\tif (id === this.converter.delegatingCommandId) {\n\t\t\t\tconst actual = this.converter.getActualCommand(...args);\n\t\t\t\tif (actual) {\n\t\t\t\t\tid = actual.command;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (!isCancellationError(err)) {\n\t\t\t\tthis._logService.error(err, id, command.extension?.identifier);\n\t\t\t}\n\n\t\t\tif (!annotateError) {\n\t\t\t\tthrow err;\n\t\t\t}\n\n\t\t\tif (command.extension?.identifier) {\n\t\t\t\tconst reported = this.#extHostTelemetry.onExtensionError(command.extension.identifier, err);\n\t\t\t\tthis._logService.trace('forwarded error to extension?', reported, command.extension?.identifier);\n\t\t\t}\n\n\t\t\tthrow new class CommandError extends Error {\n\t\t\t\treadonly id = id;\n\t\t\t\treadonly source = command!.extension?.displayName ?? command!.extension?.name;\n\t\t\t\tconstructor() {\n\t\t\t\t\tsuper(toErrorMessage(err));\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\t\tfinally {\n\t\t\tthis._reportTelemetry(command, id, stopWatch.elapsed());\n\t\t}\n\t}\n\n\tprivate _reportTelemetry(command: CommandHandler, id: string, duration: number) {\n\t\tif (!command.extension) {\n\t\t\treturn;\n\t\t}\n\t\tif (id.startsWith('code.copilot.logStructured')) {\n\t\t\t// This command is very active. See https://github.com/microsoft/vscode/issues/254153.\n\t\t\treturn;\n\t\t}\n\t\ttype ExtensionActionTelemetry = {\n\t\t\textensionId: string;\n\t\t\tid: TelemetryTrustedValue<string>;\n\t\t\tduration: number;\n\t\t};\n\t\ttype ExtensionActionTelemetryMeta = {\n\t\t\textensionId: { classification: 'SystemMetaData'; purpose: 'FeatureInsight'; comment: 'The id of the extension handling the command, informing which extensions provide most-used functionality.' };\n\t\t\tid: { classification: 'SystemMetaData'; purpose: 'FeatureInsight'; comment: 'The id of the command, to understand which specific extension features are most popular.' };\n\t\t\tduration: { classification: 'SystemMetaData'; purpose: 'FeatureInsight'; comment: 'The duration of the command execution, to detect performance issues' };\n\t\t\towner: 'digitarald';\n\t\t\tcomment: 'Used to gain insight on the most popular commands used from extensions';\n\t\t};\n\t\tthis.#telemetry.$publicLog2<ExtensionActionTelemetry, ExtensionActionTelemetryMeta>('Extension:ActionExecuted', {\n\t\t\textensionId: command.extension.identifier.value,\n\t\t\tid: new TelemetryTrustedValue(id),\n\t\t\tduration: duration,\n\t\t});\n\t}\n\n\t$executeContributedCommand(id: string, ...args: unknown[]): Promise<unknown> {\n\t\tthis._logService.trace('ExtHostCommands#$executeContributedCommand', id);\n\n\t\tconst cmdHandler = this._commands.get(id);\n\t\tif (!cmdHandler) {\n\t\t\treturn Promise.reject(new Error(`Contributed command '${id}' does not exist.`));\n\t\t} else {\n\t\t\targs = args.map(arg => this._argumentProcessors.reduce((r, p) => p.processArgument(r, cmdHandler.extension), arg));\n\t\t\treturn this._executeContributedCommand(id, args, true);\n\t\t}\n\t}\n\n\tgetCommands(filterUnderscoreCommands: boolean = false): Promise<string[]> {\n\t\tthis._logService.trace('ExtHostCommands#getCommands', filterUnderscoreCommands);\n\n\t\treturn this.#proxy.$getCommands().then(result => {\n\t\t\tif (filterUnderscoreCommands) {\n\t\t\t\tresult = result.filter(command => command[0] !== '_');\n\t\t\t}\n\t\t\treturn result;\n\t\t});\n\t}\n\n\t$getContributedCommandMetadata(): Promise<{ [id: string]: string | ICommandMetadataDto }> {\n\t\tconst result: { [id: string]: string | ICommandMetadata } = Object.create(null);\n\t\tfor (const [id, command] of this._commands) {\n\t\t\tconst { metadata } = command;\n\t\t\tif (metadata) {\n\t\t\t\tresult[id] = metadata;\n\t\t\t}\n\t\t}\n\t\treturn Promise.resolve(result);\n\t}\n}\n\nexport interface IExtHostCommands extends ExtHostCommands { }\nexport const IExtHostCommands = createDecorator<IExtHostCommands>('IExtHostCommands');\n\nexport class CommandsConverter implements extHostTypeConverter.Command.ICommandsConverter {\n\n\treadonly delegatingCommandId: string = `__vsc${generateUuid()}`;\n\tprivate readonly _cache = new Map<string, vscode.Command>();\n\tprivate _cachIdPool = 0;\n\n\t// --- conversion between internal and api commands\n\tconstructor(\n\t\tprivate readonly _commands: ExtHostCommands,\n\t\tprivate readonly _lookupApiCommand: (id: string) => ApiCommand | undefined,\n\t\tprivate readonly _logService: ILogService\n\t) {\n\t\tthis._commands.registerCommand(true, this.delegatingCommandId, this._executeConvertedCommand, this);\n\t}\n\n\ttoInternal(command: vscode.Command, disposables: DisposableStore): ICommandDto;\n\ttoInternal(command: vscode.Command | undefined, disposables: DisposableStore): ICommandDto | undefined;\n\ttoInternal(command: vscode.Command | undefined, disposables: DisposableStore): ICommandDto | undefined {\n\n\t\tif (!command) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\tconst result: ICommandDto = {\n\t\t\t$ident: undefined,\n\t\t\tid: command.command,\n\t\t\ttitle: command.title,\n\t\t\ttooltip: command.tooltip\n\t\t};\n\n\t\tif (!command.command) {\n\t\t\t// falsy command id -> return converted command but don't attempt any\n\t\t\t// argument or API-command dance since this command won't run anyways\n\t\t\treturn result;\n\t\t}\n\n\t\tconst apiCommand = this._lookupApiCommand(command.command);\n\t\tif (apiCommand) {\n\t\t\t// API command with return-value can be converted inplace\n\t\t\tresult.id = apiCommand.internalId;\n\t\t\tresult.arguments = apiCommand.args.map((arg, i) => arg.convert(command.arguments && command.arguments[i]));\n\n\n\t\t} else if (isNonEmptyArray(command.arguments)) {\n\t\t\t// we have a contributed command with arguments. that\n\t\t\t// means we don't want to send the arguments around\n\n\t\t\tconst id = `${command.command} /${++this._cachIdPool}`;\n\t\t\tthis._cache.set(id, command);\n\t\t\tdisposables.add(toDisposable(() => {\n\t\t\t\tthis._cache.delete(id);\n\t\t\t\tthis._logService.trace('CommandsConverter#DISPOSE', id);\n\t\t\t}));\n\t\t\tresult.$ident = id;\n\n\t\t\tresult.id = this.delegatingCommandId;\n\t\t\tresult.arguments = [id];\n\n\t\t\tthis._logService.trace('CommandsConverter#CREATE', command.command, id);\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tfromInternal(command: ICommandDto): vscode.Command | undefined {\n\n\t\tif (typeof command.$ident === 'string') {\n\t\t\treturn this._cache.get(command.$ident);\n\n\t\t} else {\n\t\t\treturn {\n\t\t\t\tcommand: command.id,\n\t\t\t\ttitle: command.title,\n\t\t\t\targuments: command.arguments\n\t\t\t};\n\t\t}\n\t}\n\n\n\tgetActualCommand(...args: any[]): vscode.Command | undefined {\n\t\treturn this._cache.get(args[0]);\n\t}\n\n\tprivate _executeConvertedCommand<R>(...args: any[]): Promise<R> {\n\t\tconst actualCmd = this.getActualCommand(...args);\n\t\tthis._logService.trace('CommandsConverter#EXECUTE', args[0], actualCmd ? actualCmd.command : 'MISSING');\n\n\t\tif (!actualCmd) {\n\t\t\treturn Promise.reject(`Actual command not found, wanted to execute ${args[0]}`);\n\t\t}\n\t\treturn this._commands.executeCommand(actualCmd.command, ...(actualCmd.arguments || []));\n\t}\n\n}\n\n\nexport class ApiCommandArgument<V, O = V> {\n\n\tstatic readonly Uri = new ApiCommandArgument<URI>('uri', 'Uri of a text document', v => URI.isUri(v), v => v);\n\tstatic readonly Position = new ApiCommandArgument<extHostTypes.Position, IPosition>('position', 'A position in a text document', v => extHostTypes.Position.isPosition(v), extHostTypeConverter.Position.from);\n\tstatic readonly Range = new ApiCommandArgument<extHostTypes.Range, IRange>('range', 'A range in a text document', v => extHostTypes.Range.isRange(v), extHostTypeConverter.Range.from);\n\tstatic readonly Selection = new ApiCommandArgument<extHostTypes.Selection, ISelection>('selection', 'A selection in a text document', v => extHostTypes.Selection.isSelection(v), extHostTypeConverter.Selection.from);\n\tstatic readonly Number = new ApiCommandArgument<number>('number', '', v => typeof v === 'number', v => v);\n\tstatic readonly String = new ApiCommandArgument<string>('string', '', v => typeof v === 'string', v => v);\n\n\tstatic Arr<T, K = T>(element: ApiCommandArgument<T, K>) {\n\t\treturn new ApiCommandArgument(\n\t\t\t`${element.name}_array`,\n\t\t\t`Array of ${element.name}, ${element.description}`,\n\t\t\t(v: unknown) => Array.isArray(v) && v.every(e => element.validate(e)),\n\t\t\t(v: T[]) => v.map(e => element.convert(e))\n\t\t);\n\t}\n\n\tstatic readonly CallHierarchyItem = new ApiCommandArgument('item', 'A call hierarchy item', v => v instanceof extHostTypes.CallHierarchyItem, extHostTypeConverter.CallHierarchyItem.from);\n\tstatic readonly TypeHierarchyItem = new ApiCommandArgument('item', 'A type hierarchy item', v => v instanceof extHostTypes.TypeHierarchyItem, extHostTypeConverter.TypeHierarchyItem.from);\n\tstatic readonly TestItem = new ApiCommandArgument('testItem', 'A VS Code TestItem', v => v instanceof TestItemImpl, extHostTypeConverter.TestItem.from);\n\tstatic readonly TestProfile = new ApiCommandArgument('testProfile', 'A VS Code test profile', v => v instanceof extHostTypes.TestRunProfileBase, extHostTypeConverter.TestRunProfile.from);\n\n\tconstructor(\n\t\treadonly name: string,\n\t\treadonly description: string,\n\t\treadonly validate: (v: V) => boolean,\n\t\treadonly convert: (v: V) => O\n\t) { }\n\n\toptional(): ApiCommandArgument<V | undefined | null, O | undefined | null> {\n\t\treturn new ApiCommandArgument(\n\t\t\tthis.name, `(optional) ${this.description}`,\n\t\t\tvalue => value === undefined || value === null || this.validate(value),\n\t\t\tvalue => value === undefined ? undefined : value === null ? null : this.convert(value)\n\t\t);\n\t}\n\n\twith(name: string | undefined, description: string | undefined): ApiCommandArgument<V, O> {\n\t\treturn new ApiCommandArgument(name ?? this.name, description ?? this.description, this.validate, this.convert);\n\t}\n}\n\nexport class ApiCommandResult<V, O = V> {\n\n\tstatic readonly Void = new ApiCommandResult<void, void>('no result', v => v);\n\n\tconstructor(\n\t\treadonly description: string,\n\t\treadonly convert: (v: V, apiArgs: any[], cmdConverter: CommandsConverter) => O\n\t) { }\n}\n\nexport class ApiCommand {\n\n\tconstructor(\n\t\treadonly id: string,\n\t\treadonly internalId: string,\n\t\treadonly description: string,\n\t\treadonly args: ApiCommandArgument<any, any>[],\n\t\treadonly result: ApiCommandResult<any, any>\n\t) { }\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\n/* eslint-disable local/code-no-native-private */\n\nimport { validateConstraint } from '../../../base/common/types.js';\nimport { ICommandMetadata } from '../../../platform/commands/common/commands.js';\nimport * as extHostTypes from './extHostTypes.js';\nimport * as extHostTypeConverter from './extHostTypeConverters.js';\nimport { cloneAndChange } from '../../../base/common/objects.js';\nimport { MainContext, MainThreadCommandsShape, ExtHostCommandsShape, ICommandDto, ICommandMetadataDto, MainThreadTelemetryShape } from './extHost.protocol.js';\nimport { isNonEmptyArray } from '../../../base/common/arrays.js';\nimport * as languages from '../../../editor/common/languages.js';\nimport type * as vscode from 'vscode';\nimport { ILogService } from '../../../platform/log/common/log.js';\nimport { revive } from '../../../base/common/marshalling.js';\nimport { IRange, Range } from '../../../editor/common/core/range.js';\nimport { IPosition, Position } from '../../../editor/common/core/position.js';\nimport { URI } from '../../../base/common/uri.js';\nimport { DisposableStore, toDisposable } from '../../../base/common/lifecycle.js';\nimport { createDecorator } from '../../../platform/instantiation/common/instantiation.js';\nimport { IExtHostRpcService } from './extHostRpcService.js';\nimport { ISelection } from '../../../editor/common/core/selection.js';\nimport { TestItemImpl } from './extHostTestItem.js';\nimport { VSBuffer } from '../../../base/common/buffer.js';\nimport { SerializableObjectWithBuffers } from '../../services/extensions/common/proxyIdentifier.js';\nimport { toErrorMessage } from '../../../base/common/errorMessage.js';\nimport { StopWatch } from '../../../base/common/stopwatch.js';\nimport { IExtensionDescription } from '../../../platform/extensions/common/extensions.js';\nimport { TelemetryTrustedValue } from '../../../platform/telemetry/common/telemetryUtils.js';\nimport { IExtHostTelemetry } from './extHostTelemetry.js';\nimport { generateUuid } from '../../../base/common/uuid.js';\nimport { isCancellationError } from '../../../base/common/errors.js';\n\ninterface CommandHandler {\n\tcallback: Function;\n\tthisArg: any;\n\tmetadata?: ICommandMetadata;\n\textension?: IExtensionDescription;\n}\n\nexport interface ArgumentProcessor {\n\tprocessArgument(arg: any, extension: IExtensionDescription | undefined): any;\n}\n\nexport class ExtHostCommands implements ExtHostCommandsShape {\n\n\treadonly _serviceBrand: undefined;\n\n\t#proxy: MainThreadCommandsShape;\n\n\tprivate readonly _commands = new Map<string, CommandHandler>();\n\tprivate readonly _apiCommands = new Map<string, ApiCommand>();\n\t#telemetry: MainThreadTelemetryShape;\n\n\tprivate readonly _logService: ILogService;\n\treadonly #extHostTelemetry: IExtHostTelemetry;\n\tprivate readonly _argumentProcessors: ArgumentProcessor[];\n\n\treadonly converter: CommandsConverter;\n\n\tconstructor(\n\t\t@IExtHostRpcService extHostRpc: IExtHostRpcService,\n\t\t@ILogService logService: ILogService,\n\t\t@IExtHostTelemetry extHostTelemetry: IExtHostTelemetry\n\t) {\n\t\tthis.#proxy = extHostRpc.getProxy(MainContext.MainThreadCommands);\n\t\tthis._logService = logService;\n\t\tthis.#extHostTelemetry = extHostTelemetry;\n\t\tthis.#telemetry = extHostRpc.getProxy(MainContext.MainThreadTelemetry);\n\t\tthis.converter = new CommandsConverter(\n\t\t\tthis,\n\t\t\tid => {\n\t\t\t\t// API commands that have no return type (void) can be\n\t\t\t\t// converted to their internal command and don't need\n\t\t\t\t// any indirection commands\n\t\t\t\tconst candidate = this._apiCommands.get(id);\n\t\t\t\treturn candidate?.result === ApiCommandResult.Void\n\t\t\t\t\t? candidate : undefined;\n\t\t\t},\n\t\t\tlogService\n\t\t);\n\t\tthis._argumentProcessors = [\n\t\t\t{\n\t\t\t\tprocessArgument(a) {\n\t\t\t\t\t// URI, Regex\n\t\t\t\t\treturn revive(a);\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\tprocessArgument(arg) {\n\t\t\t\t\treturn cloneAndChange(arg, function (obj) {\n\t\t\t\t\t\t// Reverse of https://github.com/microsoft/vscode/blob/1f28c5fc681f4c01226460b6d1c7e91b8acb4a5b/src/vs/workbench/api/node/extHostCommands.ts#L112-L127\n\t\t\t\t\t\tif (Range.isIRange(obj)) {\n\t\t\t\t\t\t\treturn extHostTypeConverter.Range.to(obj);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (Position.isIPosition(obj)) {\n\t\t\t\t\t\t\treturn extHostTypeConverter.Position.to(obj);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (Range.isIRange((obj as languages.Location).range) && URI.isUri((obj as languages.Location).uri)) {\n\t\t\t\t\t\t\treturn extHostTypeConverter.location.to(obj);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (obj instanceof VSBuffer) {\n\t\t\t\t\t\t\treturn obj.buffer.buffer;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (!Array.isArray(obj)) {\n\t\t\t\t\t\t\treturn obj;\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t];\n\t}\n\n\tregisterArgumentProcessor(processor: ArgumentProcessor): void {\n\t\tthis._argumentProcessors.push(processor);\n\t}\n\n\tregisterApiCommand(apiCommand: ApiCommand): extHostTypes.Disposable {\n\n\n\t\tconst registration = this.registerCommand(false, apiCommand.id, async (...apiArgs) => {\n\n\t\t\tconst internalArgs = apiCommand.args.map((arg, i) => {\n\t\t\t\tif (!arg.validate(apiArgs[i])) {\n\t\t\t\t\tthrow new Error(`Invalid argument '${arg.name}' when running '${apiCommand.id}', received: ${typeof apiArgs[i] === 'object' ? JSON.stringify(apiArgs[i], null, '\\t') : apiArgs[i]} `);\n\t\t\t\t}\n\t\t\t\treturn arg.convert(apiArgs[i]);\n\t\t\t});\n\n\t\t\tconst internalResult = await this.executeCommand(apiCommand.internalId, ...internalArgs);\n\t\t\treturn apiCommand.result.convert(internalResult, apiArgs, this.converter);\n\t\t}, undefined, {\n\t\t\tdescription: apiCommand.description,\n\t\t\targs: apiCommand.args,\n\t\t\treturns: apiCommand.result.description\n\t\t});\n\n\t\tthis._apiCommands.set(apiCommand.id, apiCommand);\n\n\t\treturn new extHostTypes.Disposable(() => {\n\t\t\tregistration.dispose();\n\t\t\tthis._apiCommands.delete(apiCommand.id);\n\t\t});\n\t}\n\n\tregisterCommand(global: boolean, id: string, callback: <T>(...args: any[]) => T | Thenable<T>, thisArg?: any, metadata?: ICommandMetadata, extension?: IExtensionDescription): extHostTypes.Disposable {\n\t\tthis._logService.trace('ExtHostCommands#registerCommand', id);\n\n\t\tif (!id.trim().length) {\n\t\t\tthrow new Error('invalid id');\n\t\t}\n\n\t\tif (this._commands.has(id)) {\n\t\t\tthrow new Error(`command '${id}' already exists`);\n\t\t}\n\n\t\tthis._commands.set(id, { callback, thisArg, metadata, extension });\n\t\tif (global) {\n\t\t\tthis.#proxy.$registerCommand(id);\n\t\t}\n\n\t\treturn new extHostTypes.Disposable(() => {\n\t\t\tif (this._commands.delete(id)) {\n\t\t\t\tif (global) {\n\t\t\t\t\tthis.#proxy.$unregisterCommand(id);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\texecuteCommand<T>(id: string, ...args: unknown[]): Promise<T> {\n\t\tthis._logService.trace('ExtHostCommands#executeCommand', id);\n\t\treturn this._doExecuteCommand(id, args, true);\n\t}\n\n\tprivate async _doExecuteCommand<T>(id: string, args: unknown[], retry: boolean): Promise<T> {\n\n\t\tif (this._commands.has(id)) {\n\t\t\t// - We stay inside the extension host and support\n\t\t\t// \t to pass any kind of parameters around.\n\t\t\t// - We still emit the corresponding activation event\n\t\t\t//   BUT we don't await that event\n\t\t\tthis.#proxy.$fireCommandActivationEvent(id);\n\t\t\treturn this._executeContributedCommand<T>(id, args, false);\n\n\t\t} else {\n\t\t\t// automagically convert some argument types\n\t\t\tlet hasBuffers = false;\n\t\t\tconst toArgs = cloneAndChange(args, function (value) {\n\t\t\t\tif (value instanceof extHostTypes.Position) {\n\t\t\t\t\treturn extHostTypeConverter.Position.from(value);\n\t\t\t\t} else if (value instanceof extHostTypes.Range) {\n\t\t\t\t\treturn extHostTypeConverter.Range.from(value);\n\t\t\t\t} else if (value instanceof extHostTypes.Location) {\n\t\t\t\t\treturn extHostTypeConverter.location.from(value);\n\t\t\t\t} else if (extHostTypes.NotebookRange.isNotebookRange(value)) {\n\t\t\t\t\treturn extHostTypeConverter.NotebookRange.from(value);\n\t\t\t\t} else if (value instanceof ArrayBuffer) {\n\t\t\t\t\thasBuffers = true;\n\t\t\t\t\treturn VSBuffer.wrap(new Uint8Array(value));\n\t\t\t\t} else if (value instanceof Uint8Array) {\n\t\t\t\t\thasBuffers = true;\n\t\t\t\t\treturn VSBuffer.wrap(value);\n\t\t\t\t} else if (value instanceof VSBuffer) {\n\t\t\t\t\thasBuffers = true;\n\t\t\t\t\treturn value;\n\t\t\t\t}\n\t\t\t\tif (!Array.isArray(value)) {\n\t\t\t\t\treturn value;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\ttry {\n\t\t\t\tconst result = await this.#proxy.$executeCommand(id, hasBuffers ? new SerializableObjectWithBuffers(toArgs) : toArgs, retry);\n\t\t\t\treturn revive<any>(result);\n\t\t\t} catch (e) {\n\t\t\t\t// Rerun the command when it wasn't known, had arguments, and when retry\n\t\t\t\t// is enabled. We do this because the command might be registered inside\n\t\t\t\t// the extension host now and can therefore accept the arguments as-is.\n\t\t\t\tif (e instanceof Error && e.message === '$executeCommand:retry') {\n\t\t\t\t\treturn this._doExecuteCommand(id, args, false);\n\t\t\t\t} else {\n\t\t\t\t\tthrow e;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate async _executeContributedCommand<T = unknown>(id: string, args: unknown[], annotateError: boolean): Promise<T> {\n\t\tconst command = this._commands.get(id);\n\t\tif (!command) {\n\t\t\tthrow new Error('Unknown command');\n\t\t}\n\t\tconst { callback, thisArg, metadata } = command;\n\t\tif (metadata?.args) {\n\t\t\tfor (let i = 0; i < metadata.args.length; i++) {\n\t\t\t\ttry {\n\t\t\t\t\tvalidateConstraint(args[i], metadata.args[i].constraint);\n\t\t\t\t} catch (err) {\n\t\t\t\t\tthrow new Error(`Running the contributed command: '${id}' failed. Illegal argument '${metadata.args[i].name}' - ${metadata.args[i].description}`);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tconst stopWatch = StopWatch.create();\n\t\ttry {\n\t\t\treturn await callback.apply(thisArg, args);\n\t\t} catch (err) {\n\t\t\t// The indirection-command from the converter can fail when invoking the actual\n\t\t\t// command and in that case it is better to blame the correct command\n\t\t\tif (id === this.converter.delegatingCommandId) {\n\t\t\t\tconst actual = this.converter.getActualCommand(...args);\n\t\t\t\tif (actual) {\n\t\t\t\t\tid = actual.command;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (!isCancellationError(err)) {\n\t\t\t\tthis._logService.error(err, id, command.extension?.identifier);\n\t\t\t}\n\n\t\t\tif (!annotateError) {\n\t\t\t\tthrow err;\n\t\t\t}\n\n\t\t\tif (command.extension?.identifier) {\n\t\t\t\tconst reported = this.#extHostTelemetry.onExtensionError(command.extension.identifier, err);\n\t\t\t\tthis._logService.trace('forwarded error to extension?', reported, command.extension?.identifier);\n\t\t\t}\n\n\t\t\tthrow new class CommandError extends Error {\n\t\t\t\treadonly id = id;\n\t\t\t\treadonly source = command!.extension?.displayName ?? command!.extension?.name;\n\t\t\t\tconstructor() {\n\t\t\t\t\tsuper(toErrorMessage(err));\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\t\tfinally {\n\t\t\tthis._reportTelemetry(command, id, stopWatch.elapsed());\n\t\t}\n\t}\n\n\tprivate _reportTelemetry(command: CommandHandler, id: string, duration: number) {\n\t\tif (!command.extension) {\n\t\t\treturn;\n\t\t}\n\t\tif (id.startsWith('code.copilot.logStructured')) {\n\t\t\t// This command is very active. See https://github.com/microsoft/vscode/issues/254153.\n\t\t\treturn;\n\t\t}\n\t\ttype ExtensionActionTelemetry = {\n\t\t\textensionId: string;\n\t\t\tid: TelemetryTrustedValue<string>;\n\t\t\tduration: number;\n\t\t};\n\t\ttype ExtensionActionTelemetryMeta = {\n\t\t\textensionId: { classification: 'SystemMetaData'; purpose: 'FeatureInsight'; comment: 'The id of the extension handling the command, informing which extensions provide most-used functionality.' };\n\t\t\tid: { classification: 'SystemMetaData'; purpose: 'FeatureInsight'; comment: 'The id of the command, to understand which specific extension features are most popular.' };\n\t\t\tduration: { classification: 'SystemMetaData'; purpose: 'FeatureInsight'; comment: 'The duration of the command execution, to detect performance issues' };\n\t\t\towner: 'digitarald';\n\t\t\tcomment: 'Used to gain insight on the most popular commands used from extensions';\n\t\t};\n\t\tthis.#telemetry.$publicLog2<ExtensionActionTelemetry, ExtensionActionTelemetryMeta>('Extension:ActionExecuted', {\n\t\t\textensionId: command.extension.identifier.value,\n\t\t\tid: new TelemetryTrustedValue(id),\n\t\t\tduration: duration,\n\t\t});\n\t}\n\n\t$executeContributedCommand(id: string, ...args: unknown[]): Promise<unknown> {\n\t\tthis._logService.trace('ExtHostCommands#$executeContributedCommand', id);\n\n\t\tconst cmdHandler = this._commands.get(id);\n\t\tif (!cmdHandler) {\n\t\t\treturn Promise.reject(new Error(`Contributed command '${id}' does not exist.`));\n\t\t} else {\n\t\t\targs = args.map(arg => this._argumentProcessors.reduce((r, p) => p.processArgument(r, cmdHandler.extension), arg));\n\t\t\treturn this._executeContributedCommand(id, args, true);\n\t\t}\n\t}\n\n\tgetCommands(filterUnderscoreCommands: boolean = false): Promise<string[]> {\n\t\tthis._logService.trace('ExtHostCommands#getCommands', filterUnderscoreCommands);\n\n\t\treturn this.#proxy.$getCommands().then(result => {\n\t\t\tif (filterUnderscoreCommands) {\n\t\t\t\tresult = result.filter(command => command[0] !== '_');\n\t\t\t}\n\t\t\treturn result;\n\t\t});\n\t}\n\n\t$getContributedCommandMetadata(): Promise<{ [id: string]: string | ICommandMetadataDto }> {\n\t\tconst result: { [id: string]: string | ICommandMetadata } = Object.create(null);\n\t\tfor (const [id, command] of this._commands) {\n\t\t\tconst { metadata } = command;\n\t\t\tif (metadata) {\n\t\t\t\tresult[id] = metadata;\n\t\t\t}\n\t\t}\n\t\treturn Promise.resolve(result);\n\t}\n}\n\nexport interface IExtHostCommands extends ExtHostCommands { }\nexport const IExtHostCommands = createDecorator<IExtHostCommands>('IExtHostCommands');\n\nexport class CommandsConverter implements extHostTypeConverter.Command.ICommandsConverter {\n\n\treadonly delegatingCommandId: string = `__vsc${generateUuid()}`;\n\tprivate readonly _cache = new Map<string, vscode.Command>();\n\tprivate _cachIdPool = 0;\n\n\t// --- conversion between internal and api commands\n\tconstructor(\n\t\tprivate readonly _commands: ExtHostCommands,\n\t\tprivate readonly _lookupApiCommand: (id: string) => ApiCommand | undefined,\n\t\tprivate readonly _logService: ILogService\n\t) {\n\t\tthis._commands.registerCommand(true, this.delegatingCommandId, this._executeConvertedCommand, this);\n\t}\n\n\ttoInternal(command: vscode.Command, disposables: DisposableStore): ICommandDto;\n\ttoInternal(command: vscode.Command | undefined, disposables: DisposableStore): ICommandDto | undefined;\n\ttoInternal(command: vscode.Command | undefined, disposables: DisposableStore): ICommandDto | undefined {\n\n\t\tif (!command) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\tconst result: ICommandDto = {\n\t\t\t$ident: undefined,\n\t\t\tid: command.command,\n\t\t\ttitle: command.title,\n\t\t\ttooltip: command.tooltip\n\t\t};\n\n\t\tif (!command.command) {\n\t\t\t// falsy command id -> return converted command but don't attempt any\n\t\t\t// argument or API-command dance since this command won't run anyways\n\t\t\treturn result;\n\t\t}\n\n\t\tconst apiCommand = this._lookupApiCommand(command.command);\n\t\tif (apiCommand) {\n\t\t\t// API command with return-value can be converted inplace\n\t\t\tresult.id = apiCommand.internalId;\n\t\t\tresult.arguments = apiCommand.args.map((arg, i) => arg.convert(command.arguments && command.arguments[i]));\n\n\n\t\t} else if (isNonEmptyArray(command.arguments)) {\n\t\t\t// we have a contributed command with arguments. that\n\t\t\t// means we don't want to send the arguments around\n\n\t\t\tconst id = `${command.command} /${++this._cachIdPool}`;\n\t\t\tthis._cache.set(id, command);\n\t\t\tdisposables.add(toDisposable(() => {\n\t\t\t\tthis._cache.delete(id);\n\t\t\t\tthis._logService.trace('CommandsConverter#DISPOSE', id);\n\t\t\t}));\n\t\t\tresult.$ident = id;\n\n\t\t\tresult.id = this.delegatingCommandId;\n\t\t\tresult.arguments = [id];\n\n\t\t\tthis._logService.trace('CommandsConverter#CREATE', command.command, id);\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tfromInternal(command: ICommandDto): vscode.Command | undefined {\n\n\t\tif (typeof command.$ident === 'string') {\n\t\t\treturn this._cache.get(command.$ident);\n\n\t\t} else {\n\t\t\treturn {\n\t\t\t\tcommand: command.id,\n\t\t\t\ttitle: command.title,\n\t\t\t\targuments: command.arguments\n\t\t\t};\n\t\t}\n\t}\n\n\n\tgetActualCommand(...args: any[]): vscode.Command | undefined {\n\t\treturn this._cache.get(args[0]);\n\t}\n\n\tprivate _executeConvertedCommand<R>(...args: any[]): Promise<R> {\n\t\tconst actualCmd = this.getActualCommand(...args);\n\t\tthis._logService.trace('CommandsConverter#EXECUTE', args[0], actualCmd ? actualCmd.command : 'MISSING');\n\n\t\tif (!actualCmd) {\n\t\t\treturn Promise.reject(`Actual command not found, wanted to execute ${args[0]}`);\n\t\t}\n\t\treturn this._commands.executeCommand(actualCmd.command, ...(actualCmd.arguments || []));\n\t}\n\n}\n\n\nexport class ApiCommandArgument<V, O = V> {\n\n\tstatic readonly Uri = new ApiCommandArgument<URI>('uri', 'Uri of a text document', v => URI.isUri(v), v => v);\n\tstatic readonly Position = new ApiCommandArgument<extHostTypes.Position, IPosition>('position', 'A position in a text document', v => extHostTypes.Position.isPosition(v), extHostTypeConverter.Position.from);\n\tstatic readonly Range = new ApiCommandArgument<extHostTypes.Range, IRange>('range', 'A range in a text document', v => extHostTypes.Range.isRange(v), extHostTypeConverter.Range.from);\n\tstatic readonly Selection = new ApiCommandArgument<extHostTypes.Selection, ISelection>('selection', 'A selection in a text document', v => extHostTypes.Selection.isSelection(v), extHostTypeConverter.Selection.from);\n\tstatic readonly Number = new ApiCommandArgument<number>('number', '', v => typeof v === 'number', v => v);\n\tstatic readonly String = new ApiCommandArgument<string>('string', '', v => typeof v === 'string', v => v);\n\n\tstatic Arr<T, K = T>(element: ApiCommandArgument<T, K>) {\n\t\treturn new ApiCommandArgument(\n\t\t\t`${element.name}_array`,\n\t\t\t`Array of ${element.name}, ${element.description}`,\n\t\t\t(v: unknown) => Array.isArray(v) && v.every(e => element.validate(e)),\n\t\t\t(v: T[]) => v.map(e => element.convert(e))\n\t\t);\n\t}\n\n\tstatic readonly CallHierarchyItem = new ApiCommandArgument('item', 'A call hierarchy item', v => v instanceof extHostTypes.CallHierarchyItem, extHostTypeConverter.CallHierarchyItem.from);\n\tstatic readonly TypeHierarchyItem = new ApiCommandArgument('item', 'A type hierarchy item', v => v instanceof extHostTypes.TypeHierarchyItem, extHostTypeConverter.TypeHierarchyItem.from);\n\tstatic readonly TestItem = new ApiCommandArgument('testItem', 'A VS Code TestItem', v => v instanceof TestItemImpl, extHostTypeConverter.TestItem.from);\n\tstatic readonly TestProfile = new ApiCommandArgument('testProfile', 'A VS Code test profile', v => v instanceof extHostTypes.TestRunProfileBase, extHostTypeConverter.TestRunProfile.from);\n\n\tconstructor(\n\t\treadonly name: string,\n\t\treadonly description: string,\n\t\treadonly validate: (v: V) => boolean,\n\t\treadonly convert: (v: V) => O\n\t) { }\n\n\toptional(): ApiCommandArgument<V | undefined | null, O | undefined | null> {\n\t\treturn new ApiCommandArgument(\n\t\t\tthis.name, `(optional) ${this.description}`,\n\t\t\tvalue => value === undefined || value === null || this.validate(value),\n\t\t\tvalue => value === undefined ? undefined : value === null ? null : this.convert(value)\n\t\t);\n\t}\n\n\twith(name: string | undefined, description: string | undefined): ApiCommandArgument<V, O> {\n\t\treturn new ApiCommandArgument(name ?? this.name, description ?? this.description, this.validate, this.convert);\n\t}\n}\n\nexport class ApiCommandResult<V, O = V> {\n\n\tstatic readonly Void = new ApiCommandResult<void, void>('no result', v => v);\n\n\tconstructor(\n\t\treadonly description: string,\n\t\treadonly convert: (v: V, apiArgs: any[], cmdConverter: CommandsConverter) => O\n\t) { }\n}\n\nexport class ApiCommand {\n\n\tconstructor(\n\t\treadonly id: string,\n\t\treadonly internalId: string,\n\t\treadonly description: string,\n\t\treadonly args: ApiCommandArgument<any, any>[],\n\t\treadonly result: ApiCommandResult<any, any>\n\t) { }\n}\n"]}