{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/api/common/extHostWebviewMessaging.ts","vs/workbench/api/common/extHostWebviewMessaging.ts"],"names":[],"mappings":"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","file":"extHostWebviewMessaging.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { VSBuffer } from '../../../base/common/buffer.js';\nimport * as extHostProtocol from './extHost.protocol.js';\n\nclass ArrayBufferSet {\n\tpublic readonly buffers: ArrayBufferLike[] = [];\n\n\tpublic add(buffer: ArrayBufferLike): number {\n\t\tlet index = this.buffers.indexOf(buffer);\n\t\tif (index < 0) {\n\t\t\tindex = this.buffers.length;\n\t\t\tthis.buffers.push(buffer);\n\t\t}\n\t\treturn index;\n\t}\n}\n\nexport function serializeWebviewMessage(\n\tmessage: unknown,\n\toptions: { serializeBuffersForPostMessage?: boolean }\n): { message: string; buffers: VSBuffer[] } {\n\tif (options.serializeBuffersForPostMessage) {\n\t\t// Extract all ArrayBuffers from the message and replace them with references.\n\t\tconst arrayBuffers = new ArrayBufferSet();\n\n\t\tconst replacer = (_key: string, value: any) => {\n\t\t\tif (value instanceof ArrayBuffer) {\n\t\t\t\tconst index = arrayBuffers.add(value);\n\t\t\t\treturn {\n\t\t\t\t\t$$vscode_array_buffer_reference$$: true,\n\t\t\t\t\tindex,\n\t\t\t\t} satisfies extHostProtocol.WebviewMessageArrayBufferReference;\n\t\t\t} else if (ArrayBuffer.isView(value)) {\n\t\t\t\tconst type = getTypedArrayType(value);\n\t\t\t\tif (type) {\n\t\t\t\t\tconst index = arrayBuffers.add(value.buffer);\n\t\t\t\t\treturn {\n\t\t\t\t\t\t$$vscode_array_buffer_reference$$: true,\n\t\t\t\t\t\tindex,\n\t\t\t\t\t\tview: {\n\t\t\t\t\t\t\ttype: type,\n\t\t\t\t\t\t\tbyteLength: value.byteLength,\n\t\t\t\t\t\t\tbyteOffset: value.byteOffset,\n\t\t\t\t\t\t}\n\t\t\t\t\t} satisfies extHostProtocol.WebviewMessageArrayBufferReference;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn value;\n\t\t};\n\n\t\tconst serializedMessage = JSON.stringify(message, replacer);\n\n\t\tconst buffers = arrayBuffers.buffers.map(arrayBuffer => {\n\t\t\tconst bytes = new Uint8Array(arrayBuffer);\n\t\t\treturn VSBuffer.wrap(bytes);\n\t\t});\n\n\t\treturn { message: serializedMessage, buffers };\n\t} else {\n\t\treturn { message: JSON.stringify(message), buffers: [] };\n\t}\n}\n\nfunction getTypedArrayType(value: ArrayBufferView): extHostProtocol.WebviewMessageArrayBufferViewType | undefined {\n\tswitch (value.constructor.name) {\n\t\tcase 'Int8Array': return extHostProtocol.WebviewMessageArrayBufferViewType.Int8Array;\n\t\tcase 'Uint8Array': return extHostProtocol.WebviewMessageArrayBufferViewType.Uint8Array;\n\t\tcase 'Uint8ClampedArray': return extHostProtocol.WebviewMessageArrayBufferViewType.Uint8ClampedArray;\n\t\tcase 'Int16Array': return extHostProtocol.WebviewMessageArrayBufferViewType.Int16Array;\n\t\tcase 'Uint16Array': return extHostProtocol.WebviewMessageArrayBufferViewType.Uint16Array;\n\t\tcase 'Int32Array': return extHostProtocol.WebviewMessageArrayBufferViewType.Int32Array;\n\t\tcase 'Uint32Array': return extHostProtocol.WebviewMessageArrayBufferViewType.Uint32Array;\n\t\tcase 'Float32Array': return extHostProtocol.WebviewMessageArrayBufferViewType.Float32Array;\n\t\tcase 'Float64Array': return extHostProtocol.WebviewMessageArrayBufferViewType.Float64Array;\n\t\tcase 'BigInt64Array': return extHostProtocol.WebviewMessageArrayBufferViewType.BigInt64Array;\n\t\tcase 'BigUint64Array': return extHostProtocol.WebviewMessageArrayBufferViewType.BigUint64Array;\n\t}\n\treturn undefined;\n}\n\nexport function deserializeWebviewMessage(jsonMessage: string, buffers: VSBuffer[]): { message: unknown; arrayBuffers: ArrayBuffer[] } {\n\tconst arrayBuffers: ArrayBuffer[] = buffers.map(buffer => {\n\t\tconst arrayBuffer = new ArrayBuffer(buffer.byteLength);\n\t\tconst uint8Array = new Uint8Array(arrayBuffer);\n\t\tuint8Array.set(buffer.buffer);\n\t\treturn arrayBuffer;\n\t});\n\n\tconst reviver = !buffers.length ? undefined : (_key: string, value: any) => {\n\t\tif (value && typeof value === 'object' && (value as extHostProtocol.WebviewMessageArrayBufferReference).$$vscode_array_buffer_reference$$) {\n\t\t\tconst ref = value as extHostProtocol.WebviewMessageArrayBufferReference;\n\t\t\tconst { index } = ref;\n\t\t\tconst arrayBuffer = arrayBuffers[index];\n\t\t\tif (ref.view) {\n\t\t\t\tswitch (ref.view.type) {\n\t\t\t\t\tcase extHostProtocol.WebviewMessageArrayBufferViewType.Int8Array: return new Int8Array(arrayBuffer, ref.view.byteOffset, ref.view.byteLength / Int8Array.BYTES_PER_ELEMENT);\n\t\t\t\t\tcase extHostProtocol.WebviewMessageArrayBufferViewType.Uint8Array: return new Uint8Array(arrayBuffer, ref.view.byteOffset, ref.view.byteLength / Uint8Array.BYTES_PER_ELEMENT);\n\t\t\t\t\tcase extHostProtocol.WebviewMessageArrayBufferViewType.Uint8ClampedArray: return new Uint8ClampedArray(arrayBuffer, ref.view.byteOffset, ref.view.byteLength / Uint8ClampedArray.BYTES_PER_ELEMENT);\n\t\t\t\t\tcase extHostProtocol.WebviewMessageArrayBufferViewType.Int16Array: return new Int16Array(arrayBuffer, ref.view.byteOffset, ref.view.byteLength / Int16Array.BYTES_PER_ELEMENT);\n\t\t\t\t\tcase extHostProtocol.WebviewMessageArrayBufferViewType.Uint16Array: return new Uint16Array(arrayBuffer, ref.view.byteOffset, ref.view.byteLength / Uint16Array.BYTES_PER_ELEMENT);\n\t\t\t\t\tcase extHostProtocol.WebviewMessageArrayBufferViewType.Int32Array: return new Int32Array(arrayBuffer, ref.view.byteOffset, ref.view.byteLength / Int32Array.BYTES_PER_ELEMENT);\n\t\t\t\t\tcase extHostProtocol.WebviewMessageArrayBufferViewType.Uint32Array: return new Uint32Array(arrayBuffer, ref.view.byteOffset, ref.view.byteLength / Uint32Array.BYTES_PER_ELEMENT);\n\t\t\t\t\tcase extHostProtocol.WebviewMessageArrayBufferViewType.Float32Array: return new Float32Array(arrayBuffer, ref.view.byteOffset, ref.view.byteLength / Float32Array.BYTES_PER_ELEMENT);\n\t\t\t\t\tcase extHostProtocol.WebviewMessageArrayBufferViewType.Float64Array: return new Float64Array(arrayBuffer, ref.view.byteOffset, ref.view.byteLength / Float64Array.BYTES_PER_ELEMENT);\n\t\t\t\t\tcase extHostProtocol.WebviewMessageArrayBufferViewType.BigInt64Array: return new BigInt64Array(arrayBuffer, ref.view.byteOffset, ref.view.byteLength / BigInt64Array.BYTES_PER_ELEMENT);\n\t\t\t\t\tcase extHostProtocol.WebviewMessageArrayBufferViewType.BigUint64Array: return new BigUint64Array(arrayBuffer, ref.view.byteOffset, ref.view.byteLength / BigUint64Array.BYTES_PER_ELEMENT);\n\t\t\t\t\tdefault: throw new Error('Unknown array buffer view type');\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn arrayBuffer;\n\t\t}\n\t\treturn value;\n\t};\n\n\tconst message = JSON.parse(jsonMessage, reviver) as unknown;\n\treturn { message, arrayBuffers };\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { VSBuffer } from '../../../base/common/buffer.js';\nimport * as extHostProtocol from './extHost.protocol.js';\n\nclass ArrayBufferSet {\n\tpublic readonly buffers: ArrayBufferLike[] = [];\n\n\tpublic add(buffer: ArrayBufferLike): number {\n\t\tlet index = this.buffers.indexOf(buffer);\n\t\tif (index < 0) {\n\t\t\tindex = this.buffers.length;\n\t\t\tthis.buffers.push(buffer);\n\t\t}\n\t\treturn index;\n\t}\n}\n\nexport function serializeWebviewMessage(\n\tmessage: unknown,\n\toptions: { serializeBuffersForPostMessage?: boolean }\n): { message: string; buffers: VSBuffer[] } {\n\tif (options.serializeBuffersForPostMessage) {\n\t\t// Extract all ArrayBuffers from the message and replace them with references.\n\t\tconst arrayBuffers = new ArrayBufferSet();\n\n\t\tconst replacer = (_key: string, value: any) => {\n\t\t\tif (value instanceof ArrayBuffer) {\n\t\t\t\tconst index = arrayBuffers.add(value);\n\t\t\t\treturn {\n\t\t\t\t\t$$vscode_array_buffer_reference$$: true,\n\t\t\t\t\tindex,\n\t\t\t\t} satisfies extHostProtocol.WebviewMessageArrayBufferReference;\n\t\t\t} else if (ArrayBuffer.isView(value)) {\n\t\t\t\tconst type = getTypedArrayType(value);\n\t\t\t\tif (type) {\n\t\t\t\t\tconst index = arrayBuffers.add(value.buffer);\n\t\t\t\t\treturn {\n\t\t\t\t\t\t$$vscode_array_buffer_reference$$: true,\n\t\t\t\t\t\tindex,\n\t\t\t\t\t\tview: {\n\t\t\t\t\t\t\ttype: type,\n\t\t\t\t\t\t\tbyteLength: value.byteLength,\n\t\t\t\t\t\t\tbyteOffset: value.byteOffset,\n\t\t\t\t\t\t}\n\t\t\t\t\t} satisfies extHostProtocol.WebviewMessageArrayBufferReference;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn value;\n\t\t};\n\n\t\tconst serializedMessage = JSON.stringify(message, replacer);\n\n\t\tconst buffers = arrayBuffers.buffers.map(arrayBuffer => {\n\t\t\tconst bytes = new Uint8Array(arrayBuffer);\n\t\t\treturn VSBuffer.wrap(bytes);\n\t\t});\n\n\t\treturn { message: serializedMessage, buffers };\n\t} else {\n\t\treturn { message: JSON.stringify(message), buffers: [] };\n\t}\n}\n\nfunction getTypedArrayType(value: ArrayBufferView): extHostProtocol.WebviewMessageArrayBufferViewType | undefined {\n\tswitch (value.constructor.name) {\n\t\tcase 'Int8Array': return extHostProtocol.WebviewMessageArrayBufferViewType.Int8Array;\n\t\tcase 'Uint8Array': return extHostProtocol.WebviewMessageArrayBufferViewType.Uint8Array;\n\t\tcase 'Uint8ClampedArray': return extHostProtocol.WebviewMessageArrayBufferViewType.Uint8ClampedArray;\n\t\tcase 'Int16Array': return extHostProtocol.WebviewMessageArrayBufferViewType.Int16Array;\n\t\tcase 'Uint16Array': return extHostProtocol.WebviewMessageArrayBufferViewType.Uint16Array;\n\t\tcase 'Int32Array': return extHostProtocol.WebviewMessageArrayBufferViewType.Int32Array;\n\t\tcase 'Uint32Array': return extHostProtocol.WebviewMessageArrayBufferViewType.Uint32Array;\n\t\tcase 'Float32Array': return extHostProtocol.WebviewMessageArrayBufferViewType.Float32Array;\n\t\tcase 'Float64Array': return extHostProtocol.WebviewMessageArrayBufferViewType.Float64Array;\n\t\tcase 'BigInt64Array': return extHostProtocol.WebviewMessageArrayBufferViewType.BigInt64Array;\n\t\tcase 'BigUint64Array': return extHostProtocol.WebviewMessageArrayBufferViewType.BigUint64Array;\n\t}\n\treturn undefined;\n}\n\nexport function deserializeWebviewMessage(jsonMessage: string, buffers: VSBuffer[]): { message: unknown; arrayBuffers: ArrayBuffer[] } {\n\tconst arrayBuffers: ArrayBuffer[] = buffers.map(buffer => {\n\t\tconst arrayBuffer = new ArrayBuffer(buffer.byteLength);\n\t\tconst uint8Array = new Uint8Array(arrayBuffer);\n\t\tuint8Array.set(buffer.buffer);\n\t\treturn arrayBuffer;\n\t});\n\n\tconst reviver = !buffers.length ? undefined : (_key: string, value: any) => {\n\t\tif (value && typeof value === 'object' && (value as extHostProtocol.WebviewMessageArrayBufferReference).$$vscode_array_buffer_reference$$) {\n\t\t\tconst ref = value as extHostProtocol.WebviewMessageArrayBufferReference;\n\t\t\tconst { index } = ref;\n\t\t\tconst arrayBuffer = arrayBuffers[index];\n\t\t\tif (ref.view) {\n\t\t\t\tswitch (ref.view.type) {\n\t\t\t\t\tcase extHostProtocol.WebviewMessageArrayBufferViewType.Int8Array: return new Int8Array(arrayBuffer, ref.view.byteOffset, ref.view.byteLength / Int8Array.BYTES_PER_ELEMENT);\n\t\t\t\t\tcase extHostProtocol.WebviewMessageArrayBufferViewType.Uint8Array: return new Uint8Array(arrayBuffer, ref.view.byteOffset, ref.view.byteLength / Uint8Array.BYTES_PER_ELEMENT);\n\t\t\t\t\tcase extHostProtocol.WebviewMessageArrayBufferViewType.Uint8ClampedArray: return new Uint8ClampedArray(arrayBuffer, ref.view.byteOffset, ref.view.byteLength / Uint8ClampedArray.BYTES_PER_ELEMENT);\n\t\t\t\t\tcase extHostProtocol.WebviewMessageArrayBufferViewType.Int16Array: return new Int16Array(arrayBuffer, ref.view.byteOffset, ref.view.byteLength / Int16Array.BYTES_PER_ELEMENT);\n\t\t\t\t\tcase extHostProtocol.WebviewMessageArrayBufferViewType.Uint16Array: return new Uint16Array(arrayBuffer, ref.view.byteOffset, ref.view.byteLength / Uint16Array.BYTES_PER_ELEMENT);\n\t\t\t\t\tcase extHostProtocol.WebviewMessageArrayBufferViewType.Int32Array: return new Int32Array(arrayBuffer, ref.view.byteOffset, ref.view.byteLength / Int32Array.BYTES_PER_ELEMENT);\n\t\t\t\t\tcase extHostProtocol.WebviewMessageArrayBufferViewType.Uint32Array: return new Uint32Array(arrayBuffer, ref.view.byteOffset, ref.view.byteLength / Uint32Array.BYTES_PER_ELEMENT);\n\t\t\t\t\tcase extHostProtocol.WebviewMessageArrayBufferViewType.Float32Array: return new Float32Array(arrayBuffer, ref.view.byteOffset, ref.view.byteLength / Float32Array.BYTES_PER_ELEMENT);\n\t\t\t\t\tcase extHostProtocol.WebviewMessageArrayBufferViewType.Float64Array: return new Float64Array(arrayBuffer, ref.view.byteOffset, ref.view.byteLength / Float64Array.BYTES_PER_ELEMENT);\n\t\t\t\t\tcase extHostProtocol.WebviewMessageArrayBufferViewType.BigInt64Array: return new BigInt64Array(arrayBuffer, ref.view.byteOffset, ref.view.byteLength / BigInt64Array.BYTES_PER_ELEMENT);\n\t\t\t\t\tcase extHostProtocol.WebviewMessageArrayBufferViewType.BigUint64Array: return new BigUint64Array(arrayBuffer, ref.view.byteOffset, ref.view.byteLength / BigUint64Array.BYTES_PER_ELEMENT);\n\t\t\t\t\tdefault: throw new Error('Unknown array buffer view type');\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn arrayBuffer;\n\t\t}\n\t\treturn value;\n\t};\n\n\tconst message = JSON.parse(jsonMessage, reviver) as unknown;\n\treturn { message, arrayBuffers };\n}\n"]}