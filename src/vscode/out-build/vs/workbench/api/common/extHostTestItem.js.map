{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/api/common/extHostTestItem.ts","vs/workbench/api/common/extHostTestItem.ts"],"names":[],"mappings":"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","file":"extHostTestItem.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport type * as vscode from 'vscode';\nimport { URI } from '../../../base/common/uri.js';\nimport * as editorRange from '../../../editor/common/core/range.js';\nimport { TestId, TestIdPathParts } from '../../contrib/testing/common/testId.js';\nimport { createTestItemChildren, ExtHostTestItemEvent, ITestChildrenLike, ITestItemApi, ITestItemChildren, TestItemCollection, TestItemEventOp } from '../../contrib/testing/common/testItemCollection.js';\nimport { denamespaceTestTag, ITestItem, ITestItemContext } from '../../contrib/testing/common/testTypes.js';\nimport { ExtHostDocumentsAndEditors } from './extHostDocumentsAndEditors.js';\nimport { createPrivateApiFor, getPrivateApiFor, IExtHostTestItemApi } from './extHostTestingPrivateApi.js';\nimport * as Convert from './extHostTypeConverters.js';\n\nconst testItemPropAccessor = <K extends keyof vscode.TestItem>(\n\tapi: IExtHostTestItemApi,\n\tdefaultValue: vscode.TestItem[K],\n\tequals: (a: vscode.TestItem[K], b: vscode.TestItem[K]) => boolean,\n\ttoUpdate: (newValue: vscode.TestItem[K], oldValue: vscode.TestItem[K]) => ExtHostTestItemEvent,\n) => {\n\tlet value = defaultValue;\n\treturn {\n\t\tenumerable: true,\n\t\tconfigurable: false,\n\t\tget() {\n\t\t\treturn value;\n\t\t},\n\t\tset(newValue: vscode.TestItem[K]) {\n\t\t\tif (!equals(value, newValue)) {\n\t\t\t\tconst oldValue = value;\n\t\t\t\tvalue = newValue;\n\t\t\t\tapi.listener?.(toUpdate(newValue, oldValue));\n\t\t\t}\n\t\t},\n\t};\n};\n\ntype WritableProps = Pick<vscode.TestItem, 'range' | 'label' | 'description' | 'sortText' | 'canResolveChildren' | 'busy' | 'error' | 'tags'>;\n\nconst strictEqualComparator = <T>(a: T, b: T) => a === b;\n\nconst propComparators: { [K in keyof Required<WritableProps>]: (a: vscode.TestItem[K], b: vscode.TestItem[K]) => boolean } = {\n\trange: (a, b) => {\n\t\tif (a === b) { return true; }\n\t\tif (!a || !b) { return false; }\n\t\treturn a.isEqual(b);\n\t},\n\tlabel: strictEqualComparator,\n\tdescription: strictEqualComparator,\n\tsortText: strictEqualComparator,\n\tbusy: strictEqualComparator,\n\terror: strictEqualComparator,\n\tcanResolveChildren: strictEqualComparator,\n\ttags: (a, b) => {\n\t\tif (a.length !== b.length) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif (a.some(t1 => !b.find(t2 => t1.id === t2.id))) {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t},\n};\n\nconst evSetProps = <T>(fn: (newValue: T) => Partial<ITestItem>): (newValue: T) => ExtHostTestItemEvent =>\n\tv => ({ op: TestItemEventOp.SetProp, update: fn(v) });\n\nconst makePropDescriptors = (api: IExtHostTestItemApi, label: string): { [K in keyof Required<WritableProps>]: PropertyDescriptor } => ({\n\trange: (() => {\n\t\tlet value: vscode.Range | undefined;\n\t\tconst updateProps = evSetProps<vscode.Range | undefined>(r => ({ range: editorRange.Range.lift(Convert.Range.from(r)) }));\n\t\treturn {\n\t\t\tenumerable: true,\n\t\t\tconfigurable: false,\n\t\t\tget() {\n\t\t\t\treturn value;\n\t\t\t},\n\t\t\tset(newValue: vscode.Range | undefined) {\n\t\t\t\tapi.listener?.({ op: TestItemEventOp.DocumentSynced });\n\t\t\t\tif (!propComparators.range(value, newValue)) {\n\t\t\t\t\tvalue = newValue;\n\t\t\t\t\tapi.listener?.(updateProps(newValue));\n\t\t\t\t}\n\t\t\t},\n\t\t};\n\t})(),\n\tlabel: testItemPropAccessor<'label'>(api, label, propComparators.label, evSetProps(label => ({ label }))),\n\tdescription: testItemPropAccessor<'description'>(api, undefined, propComparators.description, evSetProps(description => ({ description }))),\n\tsortText: testItemPropAccessor<'sortText'>(api, undefined, propComparators.sortText, evSetProps(sortText => ({ sortText }))),\n\tcanResolveChildren: testItemPropAccessor<'canResolveChildren'>(api, false, propComparators.canResolveChildren, state => ({\n\t\top: TestItemEventOp.UpdateCanResolveChildren,\n\t\tstate,\n\t})),\n\tbusy: testItemPropAccessor<'busy'>(api, false, propComparators.busy, evSetProps(busy => ({ busy }))),\n\terror: testItemPropAccessor<'error'>(api, undefined, propComparators.error, evSetProps(error => ({ error: Convert.MarkdownString.fromStrict(error) || null }))),\n\ttags: testItemPropAccessor<'tags'>(api, [], propComparators.tags, (current, previous) => ({\n\t\top: TestItemEventOp.SetTags,\n\t\tnew: current.map(Convert.TestTag.from),\n\t\told: previous.map(Convert.TestTag.from),\n\t})),\n});\n\nconst toItemFromPlain = (item: ITestItem.Serialized): TestItemImpl => {\n\tconst testId = TestId.fromString(item.extId);\n\tconst testItem = new TestItemImpl(testId.controllerId, testId.localId, item.label, URI.revive(item.uri) || undefined);\n\ttestItem.range = Convert.Range.to(item.range || undefined);\n\ttestItem.description = item.description || undefined;\n\ttestItem.sortText = item.sortText || undefined;\n\ttestItem.tags = item.tags.map(t => Convert.TestTag.to({ id: denamespaceTestTag(t).tagId }));\n\treturn testItem;\n};\n\nexport const toItemFromContext = (context: ITestItemContext): TestItemImpl => {\n\tlet node: TestItemImpl | undefined;\n\tfor (const test of context.tests) {\n\t\tconst next = toItemFromPlain(test.item);\n\t\tgetPrivateApiFor(next).parent = node;\n\t\tnode = next;\n\t}\n\n\treturn node!;\n};\n\nexport class TestItemImpl implements vscode.TestItem {\n\tpublic readonly id!: string;\n\tpublic readonly uri!: vscode.Uri | undefined;\n\tpublic readonly children!: ITestItemChildren<vscode.TestItem>;\n\tpublic readonly parent!: TestItemImpl | undefined;\n\n\tpublic range!: vscode.Range | undefined;\n\tpublic description!: string | undefined;\n\tpublic sortText!: string | undefined;\n\tpublic label!: string;\n\tpublic error!: string | vscode.MarkdownString;\n\tpublic busy!: boolean;\n\tpublic canResolveChildren!: boolean;\n\tpublic tags!: readonly vscode.TestTag[];\n\n\t/**\n\t * Note that data is deprecated and here for back-compat only\n\t */\n\tconstructor(controllerId: string, id: string, label: string, uri: vscode.Uri | undefined) {\n\t\tif (id.includes(TestIdPathParts.Delimiter)) {\n\t\t\tthrow new Error(`Test IDs may not include the ${JSON.stringify(id)} symbol`);\n\t\t}\n\n\t\tconst api = createPrivateApiFor(this, controllerId);\n\t\tObject.defineProperties(this, {\n\t\t\tid: {\n\t\t\t\tvalue: id,\n\t\t\t\tenumerable: true,\n\t\t\t\twritable: false,\n\t\t\t},\n\t\t\turi: {\n\t\t\t\tvalue: uri,\n\t\t\t\tenumerable: true,\n\t\t\t\twritable: false,\n\t\t\t},\n\t\t\tparent: {\n\t\t\t\tenumerable: false,\n\t\t\t\tget() {\n\t\t\t\t\treturn api.parent instanceof TestItemRootImpl ? undefined : api.parent;\n\t\t\t\t},\n\t\t\t},\n\t\t\tchildren: {\n\t\t\t\tvalue: createTestItemChildren(api, getPrivateApiFor, TestItemImpl),\n\t\t\t\tenumerable: true,\n\t\t\t\twritable: false,\n\t\t\t},\n\t\t\t...makePropDescriptors(api, label),\n\t\t});\n\t}\n}\n\nexport class TestItemRootImpl extends TestItemImpl {\n\tpublic readonly _isRoot = true;\n\n\tconstructor(controllerId: string, label: string) {\n\t\tsuper(controllerId, controllerId, label, undefined);\n\t}\n}\n\nexport class ExtHostTestItemCollection extends TestItemCollection<TestItemImpl> {\n\tconstructor(controllerId: string, controllerLabel: string, editors: ExtHostDocumentsAndEditors) {\n\t\tsuper({\n\t\t\tcontrollerId,\n\t\t\tgetDocumentVersion: uri => uri && editors.getDocument(uri)?.version,\n\t\t\tgetApiFor: getPrivateApiFor as (impl: TestItemImpl) => ITestItemApi<TestItemImpl>,\n\t\t\tgetChildren: (item) => item.children as ITestChildrenLike<TestItemImpl>,\n\t\t\troot: new TestItemRootImpl(controllerId, controllerLabel),\n\t\t\ttoITestItem: Convert.TestItem.from,\n\t\t});\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport type * as vscode from 'vscode';\nimport { URI } from '../../../base/common/uri.js';\nimport * as editorRange from '../../../editor/common/core/range.js';\nimport { TestId, TestIdPathParts } from '../../contrib/testing/common/testId.js';\nimport { createTestItemChildren, ExtHostTestItemEvent, ITestChildrenLike, ITestItemApi, ITestItemChildren, TestItemCollection, TestItemEventOp } from '../../contrib/testing/common/testItemCollection.js';\nimport { denamespaceTestTag, ITestItem, ITestItemContext } from '../../contrib/testing/common/testTypes.js';\nimport { ExtHostDocumentsAndEditors } from './extHostDocumentsAndEditors.js';\nimport { createPrivateApiFor, getPrivateApiFor, IExtHostTestItemApi } from './extHostTestingPrivateApi.js';\nimport * as Convert from './extHostTypeConverters.js';\n\nconst testItemPropAccessor = <K extends keyof vscode.TestItem>(\n\tapi: IExtHostTestItemApi,\n\tdefaultValue: vscode.TestItem[K],\n\tequals: (a: vscode.TestItem[K], b: vscode.TestItem[K]) => boolean,\n\ttoUpdate: (newValue: vscode.TestItem[K], oldValue: vscode.TestItem[K]) => ExtHostTestItemEvent,\n) => {\n\tlet value = defaultValue;\n\treturn {\n\t\tenumerable: true,\n\t\tconfigurable: false,\n\t\tget() {\n\t\t\treturn value;\n\t\t},\n\t\tset(newValue: vscode.TestItem[K]) {\n\t\t\tif (!equals(value, newValue)) {\n\t\t\t\tconst oldValue = value;\n\t\t\t\tvalue = newValue;\n\t\t\t\tapi.listener?.(toUpdate(newValue, oldValue));\n\t\t\t}\n\t\t},\n\t};\n};\n\ntype WritableProps = Pick<vscode.TestItem, 'range' | 'label' | 'description' | 'sortText' | 'canResolveChildren' | 'busy' | 'error' | 'tags'>;\n\nconst strictEqualComparator = <T>(a: T, b: T) => a === b;\n\nconst propComparators: { [K in keyof Required<WritableProps>]: (a: vscode.TestItem[K], b: vscode.TestItem[K]) => boolean } = {\n\trange: (a, b) => {\n\t\tif (a === b) { return true; }\n\t\tif (!a || !b) { return false; }\n\t\treturn a.isEqual(b);\n\t},\n\tlabel: strictEqualComparator,\n\tdescription: strictEqualComparator,\n\tsortText: strictEqualComparator,\n\tbusy: strictEqualComparator,\n\terror: strictEqualComparator,\n\tcanResolveChildren: strictEqualComparator,\n\ttags: (a, b) => {\n\t\tif (a.length !== b.length) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif (a.some(t1 => !b.find(t2 => t1.id === t2.id))) {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t},\n};\n\nconst evSetProps = <T>(fn: (newValue: T) => Partial<ITestItem>): (newValue: T) => ExtHostTestItemEvent =>\n\tv => ({ op: TestItemEventOp.SetProp, update: fn(v) });\n\nconst makePropDescriptors = (api: IExtHostTestItemApi, label: string): { [K in keyof Required<WritableProps>]: PropertyDescriptor } => ({\n\trange: (() => {\n\t\tlet value: vscode.Range | undefined;\n\t\tconst updateProps = evSetProps<vscode.Range | undefined>(r => ({ range: editorRange.Range.lift(Convert.Range.from(r)) }));\n\t\treturn {\n\t\t\tenumerable: true,\n\t\t\tconfigurable: false,\n\t\t\tget() {\n\t\t\t\treturn value;\n\t\t\t},\n\t\t\tset(newValue: vscode.Range | undefined) {\n\t\t\t\tapi.listener?.({ op: TestItemEventOp.DocumentSynced });\n\t\t\t\tif (!propComparators.range(value, newValue)) {\n\t\t\t\t\tvalue = newValue;\n\t\t\t\t\tapi.listener?.(updateProps(newValue));\n\t\t\t\t}\n\t\t\t},\n\t\t};\n\t})(),\n\tlabel: testItemPropAccessor<'label'>(api, label, propComparators.label, evSetProps(label => ({ label }))),\n\tdescription: testItemPropAccessor<'description'>(api, undefined, propComparators.description, evSetProps(description => ({ description }))),\n\tsortText: testItemPropAccessor<'sortText'>(api, undefined, propComparators.sortText, evSetProps(sortText => ({ sortText }))),\n\tcanResolveChildren: testItemPropAccessor<'canResolveChildren'>(api, false, propComparators.canResolveChildren, state => ({\n\t\top: TestItemEventOp.UpdateCanResolveChildren,\n\t\tstate,\n\t})),\n\tbusy: testItemPropAccessor<'busy'>(api, false, propComparators.busy, evSetProps(busy => ({ busy }))),\n\terror: testItemPropAccessor<'error'>(api, undefined, propComparators.error, evSetProps(error => ({ error: Convert.MarkdownString.fromStrict(error) || null }))),\n\ttags: testItemPropAccessor<'tags'>(api, [], propComparators.tags, (current, previous) => ({\n\t\top: TestItemEventOp.SetTags,\n\t\tnew: current.map(Convert.TestTag.from),\n\t\told: previous.map(Convert.TestTag.from),\n\t})),\n});\n\nconst toItemFromPlain = (item: ITestItem.Serialized): TestItemImpl => {\n\tconst testId = TestId.fromString(item.extId);\n\tconst testItem = new TestItemImpl(testId.controllerId, testId.localId, item.label, URI.revive(item.uri) || undefined);\n\ttestItem.range = Convert.Range.to(item.range || undefined);\n\ttestItem.description = item.description || undefined;\n\ttestItem.sortText = item.sortText || undefined;\n\ttestItem.tags = item.tags.map(t => Convert.TestTag.to({ id: denamespaceTestTag(t).tagId }));\n\treturn testItem;\n};\n\nexport const toItemFromContext = (context: ITestItemContext): TestItemImpl => {\n\tlet node: TestItemImpl | undefined;\n\tfor (const test of context.tests) {\n\t\tconst next = toItemFromPlain(test.item);\n\t\tgetPrivateApiFor(next).parent = node;\n\t\tnode = next;\n\t}\n\n\treturn node!;\n};\n\nexport class TestItemImpl implements vscode.TestItem {\n\tpublic readonly id!: string;\n\tpublic readonly uri!: vscode.Uri | undefined;\n\tpublic readonly children!: ITestItemChildren<vscode.TestItem>;\n\tpublic readonly parent!: TestItemImpl | undefined;\n\n\tpublic range!: vscode.Range | undefined;\n\tpublic description!: string | undefined;\n\tpublic sortText!: string | undefined;\n\tpublic label!: string;\n\tpublic error!: string | vscode.MarkdownString;\n\tpublic busy!: boolean;\n\tpublic canResolveChildren!: boolean;\n\tpublic tags!: readonly vscode.TestTag[];\n\n\t/**\n\t * Note that data is deprecated and here for back-compat only\n\t */\n\tconstructor(controllerId: string, id: string, label: string, uri: vscode.Uri | undefined) {\n\t\tif (id.includes(TestIdPathParts.Delimiter)) {\n\t\t\tthrow new Error(`Test IDs may not include the ${JSON.stringify(id)} symbol`);\n\t\t}\n\n\t\tconst api = createPrivateApiFor(this, controllerId);\n\t\tObject.defineProperties(this, {\n\t\t\tid: {\n\t\t\t\tvalue: id,\n\t\t\t\tenumerable: true,\n\t\t\t\twritable: false,\n\t\t\t},\n\t\t\turi: {\n\t\t\t\tvalue: uri,\n\t\t\t\tenumerable: true,\n\t\t\t\twritable: false,\n\t\t\t},\n\t\t\tparent: {\n\t\t\t\tenumerable: false,\n\t\t\t\tget() {\n\t\t\t\t\treturn api.parent instanceof TestItemRootImpl ? undefined : api.parent;\n\t\t\t\t},\n\t\t\t},\n\t\t\tchildren: {\n\t\t\t\tvalue: createTestItemChildren(api, getPrivateApiFor, TestItemImpl),\n\t\t\t\tenumerable: true,\n\t\t\t\twritable: false,\n\t\t\t},\n\t\t\t...makePropDescriptors(api, label),\n\t\t});\n\t}\n}\n\nexport class TestItemRootImpl extends TestItemImpl {\n\tpublic readonly _isRoot = true;\n\n\tconstructor(controllerId: string, label: string) {\n\t\tsuper(controllerId, controllerId, label, undefined);\n\t}\n}\n\nexport class ExtHostTestItemCollection extends TestItemCollection<TestItemImpl> {\n\tconstructor(controllerId: string, controllerLabel: string, editors: ExtHostDocumentsAndEditors) {\n\t\tsuper({\n\t\t\tcontrollerId,\n\t\t\tgetDocumentVersion: uri => uri && editors.getDocument(uri)?.version,\n\t\t\tgetApiFor: getPrivateApiFor as (impl: TestItemImpl) => ITestItemApi<TestItemImpl>,\n\t\t\tgetChildren: (item) => item.children as ITestChildrenLike<TestItemImpl>,\n\t\t\troot: new TestItemRootImpl(controllerId, controllerLabel),\n\t\t\ttoITestItem: Convert.TestItem.from,\n\t\t});\n\t}\n}\n"]}