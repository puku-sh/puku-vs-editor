{"version":3,"sources":["vs/workbench/api/common/extHostNotebook.ts"],"names":[],"mappings":"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","file":"extHostNotebook.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { localize } from '../../../nls.js';\nimport { VSBuffer } from '../../../base/common/buffer.js';\nimport { CancellationToken } from '../../../base/common/cancellation.js';\nimport { Emitter, Event } from '../../../base/common/event.js';\nimport { IRelativePattern } from '../../../base/common/glob.js';\nimport { DisposableStore, IDisposable, toDisposable } from '../../../base/common/lifecycle.js';\nimport { ResourceMap, ResourceSet } from '../../../base/common/map.js';\nimport { MarshalledId } from '../../../base/common/marshallingIds.js';\nimport { isFalsyOrWhitespace } from '../../../base/common/strings.js';\nimport { assertReturnsDefined } from '../../../base/common/types.js';\nimport { URI, UriComponents } from '../../../base/common/uri.js';\nimport { CancellationError } from '../../../base/common/errors.js';\nimport { IExtensionDescription } from '../../../platform/extensions/common/extensions.js';\nimport * as files from '../../../platform/files/common/files.js';\nimport { Cache } from './cache.js';\nimport { ExtHostNotebookShape, IMainContext, IModelAddedData, INotebookCellStatusBarListDto, INotebookDocumentsAndEditorsDelta, INotebookDocumentShowOptions, INotebookEditorAddData, INotebookPartialFileStatsWithMetadata, MainContext, MainThreadNotebookDocumentsShape, MainThreadNotebookEditorsShape, MainThreadNotebookShape, NotebookDataDto } from './extHost.protocol.js';\nimport { ApiCommand, ApiCommandArgument, ApiCommandResult, CommandsConverter, ExtHostCommands } from './extHostCommands.js';\nimport { ExtHostDocuments } from './extHostDocuments.js';\nimport { ExtHostDocumentsAndEditors } from './extHostDocumentsAndEditors.js';\nimport * as typeConverters from './extHostTypeConverters.js';\nimport * as extHostTypes from './extHostTypes.js';\nimport { INotebookExclusiveDocumentFilter, INotebookContributionData } from '../../contrib/notebook/common/notebookCommon.js';\nimport { SerializableObjectWithBuffers } from '../../services/extensions/common/proxyIdentifier.js';\nimport type * as vscode from 'vscode';\nimport { ExtHostCell, ExtHostNotebookDocument } from './extHostNotebookDocument.js';\nimport { ExtHostNotebookEditor } from './extHostNotebookEditor.js';\nimport { IExtHostConsumerFileSystem } from './extHostFileSystemConsumer.js';\nimport { filter } from '../../../base/common/objects.js';\nimport { Schemas } from '../../../base/common/network.js';\nimport { IFileQuery, ITextQuery, QueryType } from '../../services/search/common/search.js';\nimport { IExtHostSearch } from './extHostSearch.js';\nimport { CellSearchModel } from '../../contrib/search/common/cellSearchModel.js';\nimport { INotebookCellMatchNoModel, INotebookFileMatchNoModel, IRawClosedNotebookFileMatch, genericCellMatchesToTextSearchMatches } from '../../contrib/search/common/searchNotebookHelpers.js';\nimport { NotebookPriorityInfo } from '../../contrib/search/common/search.js';\nimport { globMatchesResource, RegisteredEditorPriority } from '../../services/editor/common/editorResolverService.js';\nimport { ILogService } from '../../../platform/log/common/log.js';\n\nexport class ExtHostNotebookController implements ExtHostNotebookShape {\n\tprivate static _notebookStatusBarItemProviderHandlePool: number = 0;\n\n\tprivate readonly _notebookProxy: MainThreadNotebookShape;\n\tprivate readonly _notebookDocumentsProxy: MainThreadNotebookDocumentsShape;\n\tprivate readonly _notebookEditorsProxy: MainThreadNotebookEditorsShape;\n\n\tprivate readonly _notebookStatusBarItemProviders = new Map<number, vscode.NotebookCellStatusBarItemProvider>();\n\tprivate readonly _documents = new ResourceMap<ExtHostNotebookDocument>();\n\tprivate readonly _editors = new Map<string, ExtHostNotebookEditor>();\n\tprivate readonly _commandsConverter: CommandsConverter;\n\n\tprivate readonly _onDidChangeActiveNotebookEditor = new Emitter<vscode.NotebookEditor | undefined>();\n\treadonly onDidChangeActiveNotebookEditor = this._onDidChangeActiveNotebookEditor.event;\n\n\tprivate _activeNotebookEditor: ExtHostNotebookEditor | undefined;\n\tget activeNotebookEditor(): vscode.NotebookEditor | undefined {\n\t\treturn this._activeNotebookEditor?.apiEditor;\n\t}\n\tprivate _visibleNotebookEditors: ExtHostNotebookEditor[] = [];\n\tget visibleNotebookEditors(): vscode.NotebookEditor[] {\n\t\treturn this._visibleNotebookEditors.map(editor => editor.apiEditor);\n\t}\n\n\tprivate _onDidOpenNotebookDocument = new Emitter<vscode.NotebookDocument>();\n\treadonly onDidOpenNotebookDocument: Event<vscode.NotebookDocument> = this._onDidOpenNotebookDocument.event;\n\tprivate _onDidCloseNotebookDocument = new Emitter<vscode.NotebookDocument>();\n\treadonly onDidCloseNotebookDocument: Event<vscode.NotebookDocument> = this._onDidCloseNotebookDocument.event;\n\n\tprivate _onDidChangeVisibleNotebookEditors = new Emitter<vscode.NotebookEditor[]>();\n\tonDidChangeVisibleNotebookEditors = this._onDidChangeVisibleNotebookEditors.event;\n\n\tprivate _statusBarCache = new Cache<IDisposable>('NotebookCellStatusBarCache');\n\n\tconstructor(\n\t\tmainContext: IMainContext,\n\t\tcommands: ExtHostCommands,\n\t\tprivate _textDocumentsAndEditors: ExtHostDocumentsAndEditors,\n\t\tprivate _textDocuments: ExtHostDocuments,\n\t\tprivate _extHostFileSystem: IExtHostConsumerFileSystem,\n\t\tprivate _extHostSearch: IExtHostSearch,\n\t\tprivate _logService: ILogService\n\t) {\n\t\tthis._notebookProxy = mainContext.getProxy(MainContext.MainThreadNotebook);\n\t\tthis._notebookDocumentsProxy = mainContext.getProxy(MainContext.MainThreadNotebookDocuments);\n\t\tthis._notebookEditorsProxy = mainContext.getProxy(MainContext.MainThreadNotebookEditors);\n\t\tthis._commandsConverter = commands.converter;\n\n\t\tcommands.registerArgumentProcessor({\n\t\t\t// Serialized INotebookCellActionContext\n\t\t\tprocessArgument: (arg) => {\n\t\t\t\tif (arg && arg.$mid === MarshalledId.NotebookCellActionContext) {\n\t\t\t\t\tconst notebookUri = arg.notebookEditor?.notebookUri;\n\t\t\t\t\tconst cellHandle = arg.cell.handle;\n\n\t\t\t\t\tconst data = this._documents.get(notebookUri);\n\t\t\t\t\tconst cell = data?.getCell(cellHandle);\n\t\t\t\t\tif (cell) {\n\t\t\t\t\t\treturn cell.apiCell;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (arg && arg.$mid === MarshalledId.NotebookActionContext) {\n\t\t\t\t\tconst notebookUri = arg.uri;\n\t\t\t\t\tconst data = this._documents.get(notebookUri);\n\t\t\t\t\tif (data) {\n\t\t\t\t\t\treturn data.apiNotebook;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn arg;\n\t\t\t}\n\t\t});\n\n\t\tExtHostNotebookController._registerApiCommands(commands);\n\t}\n\n\tgetEditorById(editorId: string): ExtHostNotebookEditor {\n\t\tconst editor = this._editors.get(editorId);\n\t\tif (!editor) {\n\t\t\tthrow new Error(`unknown text editor: ${editorId}. known editors: ${[...this._editors.keys()]} `);\n\t\t}\n\t\treturn editor;\n\t}\n\n\tgetIdByEditor(editor: vscode.NotebookEditor): string | undefined {\n\t\tfor (const [id, candidate] of this._editors) {\n\t\t\tif (candidate.apiEditor === editor) {\n\t\t\t\treturn id;\n\t\t\t}\n\t\t}\n\t\treturn undefined;\n\t}\n\n\tget notebookDocuments() {\n\t\treturn [...this._documents.values()];\n\t}\n\n\tgetNotebookDocument(uri: URI, relaxed: true): ExtHostNotebookDocument | undefined;\n\tgetNotebookDocument(uri: URI): ExtHostNotebookDocument;\n\tgetNotebookDocument(uri: URI, relaxed?: true): ExtHostNotebookDocument | undefined {\n\t\tconst result = this._documents.get(uri);\n\t\tif (!result && !relaxed) {\n\t\t\tthrow new Error(`NO notebook document for '${uri}'`);\n\t\t}\n\t\treturn result;\n\t}\n\n\tprivate static _convertNotebookRegistrationData(extension: IExtensionDescription, registration: vscode.NotebookRegistrationData | undefined): INotebookContributionData | undefined {\n\t\tif (!registration) {\n\t\t\treturn;\n\t\t}\n\t\tconst viewOptionsFilenamePattern = registration.filenamePattern\n\t\t\t.map(pattern => typeConverters.NotebookExclusiveDocumentPattern.from(pattern))\n\t\t\t.filter(pattern => pattern !== undefined) as (string | IRelativePattern | INotebookExclusiveDocumentFilter)[];\n\t\tif (registration.filenamePattern && !viewOptionsFilenamePattern) {\n\t\t\tconsole.warn(`Notebook content provider view options file name pattern is invalid ${registration.filenamePattern}`);\n\t\t\treturn undefined;\n\t\t}\n\t\treturn {\n\t\t\textension: extension.identifier,\n\t\t\tproviderDisplayName: extension.displayName || extension.name,\n\t\t\tdisplayName: registration.displayName,\n\t\t\tfilenamePattern: viewOptionsFilenamePattern,\n\t\t\tpriority: registration.exclusive ? RegisteredEditorPriority.exclusive : undefined\n\t\t};\n\t}\n\n\tregisterNotebookCellStatusBarItemProvider(extension: IExtensionDescription, notebookType: string, provider: vscode.NotebookCellStatusBarItemProvider) {\n\n\t\tconst handle = ExtHostNotebookController._notebookStatusBarItemProviderHandlePool++;\n\t\tconst eventHandle = typeof provider.onDidChangeCellStatusBarItems === 'function' ? ExtHostNotebookController._notebookStatusBarItemProviderHandlePool++ : undefined;\n\n\t\tthis._notebookStatusBarItemProviders.set(handle, provider);\n\t\tthis._notebookProxy.$registerNotebookCellStatusBarItemProvider(handle, eventHandle, notebookType);\n\n\t\tlet subscription: vscode.Disposable | undefined;\n\t\tif (eventHandle !== undefined) {\n\t\t\tsubscription = provider.onDidChangeCellStatusBarItems!(_ => this._notebookProxy.$emitCellStatusBarEvent(eventHandle));\n\t\t}\n\n\t\treturn new extHostTypes.Disposable(() => {\n\t\t\tthis._notebookStatusBarItemProviders.delete(handle);\n\t\t\tthis._notebookProxy.$unregisterNotebookCellStatusBarItemProvider(handle, eventHandle);\n\t\t\tsubscription?.dispose();\n\t\t});\n\t}\n\n\tasync createNotebookDocument(options: { viewType: string; content?: vscode.NotebookData }): Promise<URI> {\n\t\tconst canonicalUri = await this._notebookDocumentsProxy.$tryCreateNotebook({\n\t\t\tviewType: options.viewType,\n\t\t\tcontent: options.content && typeConverters.NotebookData.from(options.content)\n\t\t});\n\t\treturn URI.revive(canonicalUri);\n\t}\n\n\tasync openNotebookDocument(uri: URI): Promise<vscode.NotebookDocument> {\n\t\tconst cached = this._documents.get(uri);\n\t\tif (cached) {\n\t\t\treturn cached.apiNotebook;\n\t\t}\n\t\tconst canonicalUri = await this._notebookDocumentsProxy.$tryOpenNotebook(uri);\n\t\tconst document = this._documents.get(URI.revive(canonicalUri));\n\t\treturn assertReturnsDefined(document?.apiNotebook);\n\t}\n\n\tasync showNotebookDocument(notebook: vscode.NotebookDocument, options?: vscode.NotebookDocumentShowOptions): Promise<vscode.NotebookEditor> {\n\t\tlet resolvedOptions: INotebookDocumentShowOptions;\n\t\tif (typeof options === 'object') {\n\t\t\tresolvedOptions = {\n\t\t\t\tposition: typeConverters.ViewColumn.from(options.viewColumn),\n\t\t\t\tpreserveFocus: options.preserveFocus,\n\t\t\t\tselections: options.selections && options.selections.map(typeConverters.NotebookRange.from),\n\t\t\t\tpinned: typeof options.preview === 'boolean' ? !options.preview : undefined,\n\t\t\t\tlabel: typeof options.asRepl === 'string' ?\n\t\t\t\t\toptions.asRepl :\n\t\t\t\t\ttypeof options.asRepl === 'object' ?\n\t\t\t\t\t\toptions.asRepl.label :\n\t\t\t\t\t\tundefined,\n\t\t\t};\n\t\t} else {\n\t\t\tresolvedOptions = {\n\t\t\t\tpreserveFocus: false,\n\t\t\t\tpinned: true\n\t\t\t};\n\t\t}\n\n\t\tconst viewType = !!options?.asRepl ? 'repl' : notebook.notebookType;\n\t\tconst editorId = await this._notebookEditorsProxy.$tryShowNotebookDocument(notebook.uri, viewType, resolvedOptions);\n\t\tconst editor = editorId && this._editors.get(editorId)?.apiEditor;\n\n\t\tif (editor) {\n\t\t\treturn editor;\n\t\t}\n\n\t\tif (editorId) {\n\t\t\tthrow new Error(`Could NOT open editor for \"${notebook.uri.toString()}\" because another editor opened in the meantime.`);\n\t\t} else {\n\t\t\tthrow new Error(`Could NOT open editor for \"${notebook.uri.toString()}\".`);\n\t\t}\n\t}\n\n\tasync $provideNotebookCellStatusBarItems(handle: number, uri: UriComponents, index: number, token: CancellationToken): Promise<INotebookCellStatusBarListDto | undefined> {\n\t\tconst provider = this._notebookStatusBarItemProviders.get(handle);\n\t\tconst revivedUri = URI.revive(uri);\n\t\tconst document = this._documents.get(revivedUri);\n\t\tif (!document || !provider) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst cell = document.getCellFromIndex(index);\n\t\tif (!cell) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst result = await provider.provideCellStatusBarItems(cell.apiCell, token);\n\t\tif (!result) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\tconst disposables = new DisposableStore();\n\t\tconst cacheId = this._statusBarCache.add([disposables]);\n\t\tconst resultArr = Array.isArray(result) ? result : [result];\n\t\tconst items = resultArr.map(item => typeConverters.NotebookStatusBarItem.from(item, this._commandsConverter, disposables));\n\t\treturn {\n\t\t\tcacheId,\n\t\t\titems\n\t\t};\n\t}\n\n\t$releaseNotebookCellStatusBarItems(cacheId: number): void {\n\t\tthis._statusBarCache.delete(cacheId);\n\t}\n\n\t// --- serialize/deserialize\n\n\tprivate _handlePool = 0;\n\tprivate readonly _notebookSerializer = new Map<number, { viewType: string; serializer: vscode.NotebookSerializer; options: vscode.NotebookDocumentContentOptions | undefined }>();\n\n\tregisterNotebookSerializer(extension: IExtensionDescription, viewType: string, serializer: vscode.NotebookSerializer, options?: vscode.NotebookDocumentContentOptions, registration?: vscode.NotebookRegistrationData): vscode.Disposable {\n\t\tif (isFalsyOrWhitespace(viewType)) {\n\t\t\tthrow new Error(`viewType cannot be empty or just whitespace`);\n\t\t}\n\t\tconst handle = this._handlePool++;\n\t\tthis._notebookSerializer.set(handle, { viewType, serializer, options });\n\t\tthis._notebookProxy.$registerNotebookSerializer(\n\t\t\thandle,\n\t\t\t{ id: extension.identifier, location: extension.extensionLocation },\n\t\t\tviewType,\n\t\t\ttypeConverters.NotebookDocumentContentOptions.from(options),\n\t\t\tExtHostNotebookController._convertNotebookRegistrationData(extension, registration)\n\t\t);\n\t\treturn toDisposable(() => {\n\t\t\tthis._notebookProxy.$unregisterNotebookSerializer(handle);\n\t\t});\n\t}\n\n\tasync $dataToNotebook(handle: number, bytes: VSBuffer, token: CancellationToken): Promise<SerializableObjectWithBuffers<NotebookDataDto>> {\n\t\tconst serializer = this._notebookSerializer.get(handle);\n\t\tif (!serializer) {\n\t\t\tthrow new Error('NO serializer found');\n\t\t}\n\t\tconst data = await serializer.serializer.deserializeNotebook(bytes.buffer, token);\n\t\treturn new SerializableObjectWithBuffers(typeConverters.NotebookData.from(data));\n\t}\n\n\tasync $notebookToData(handle: number, data: SerializableObjectWithBuffers<NotebookDataDto>, token: CancellationToken): Promise<VSBuffer> {\n\t\tconst serializer = this._notebookSerializer.get(handle);\n\t\tif (!serializer) {\n\t\t\tthrow new Error('NO serializer found');\n\t\t}\n\t\tconst bytes = await serializer.serializer.serializeNotebook(typeConverters.NotebookData.to(data.value), token);\n\t\treturn VSBuffer.wrap(bytes);\n\t}\n\n\tasync $saveNotebook(handle: number, uriComponents: UriComponents, versionId: number, options: files.IWriteFileOptions, token: CancellationToken): Promise<INotebookPartialFileStatsWithMetadata | files.FileOperationError> {\n\t\tconst uri = URI.revive(uriComponents);\n\t\tconst serializer = this._notebookSerializer.get(handle);\n\t\tthis.trace(`enter saveNotebook(versionId: ${versionId}, ${uri.toString()})`);\n\n\t\ttry {\n\t\t\tif (!serializer) {\n\t\t\t\tthrow new NotebookSaveError('NO serializer found');\n\t\t\t}\n\n\t\t\tconst document = this._documents.get(uri);\n\t\t\tif (!document) {\n\t\t\t\tthrow new NotebookSaveError('Document NOT found');\n\t\t\t}\n\n\t\t\tif (document.versionId !== versionId) {\n\t\t\t\tthrow new NotebookSaveError('Document version mismatch, expected: ' + versionId + ', actual: ' + document.versionId);\n\t\t\t}\n\n\t\t\tif (!this._extHostFileSystem.value.isWritableFileSystem(uri.scheme)) {\n\t\t\t\tthrow new files.FileOperationError(localize('err.readonly', \"Unable to modify read-only file '{0}'\", this._resourceForError(uri)), files.FileOperationResult.FILE_PERMISSION_DENIED);\n\t\t\t}\n\n\t\t\tconst data: vscode.NotebookData = {\n\t\t\t\tmetadata: filter(document.apiNotebook.metadata, key => !(serializer.options?.transientDocumentMetadata ?? {})[key]),\n\t\t\t\tcells: [],\n\t\t\t};\n\n\t\t\t// this data must be retrieved before any async calls to ensure the data is for the correct version\n\t\t\tfor (const cell of document.apiNotebook.getCells()) {\n\t\t\t\tconst cellData = new extHostTypes.NotebookCellData(\n\t\t\t\t\tcell.kind,\n\t\t\t\t\tcell.document.getText(),\n\t\t\t\t\tcell.document.languageId,\n\t\t\t\t\tcell.mime,\n\t\t\t\t\t!(serializer.options?.transientOutputs) ? [...cell.outputs] : [],\n\t\t\t\t\tcell.metadata,\n\t\t\t\t\tcell.executionSummary\n\t\t\t\t);\n\n\t\t\t\tcellData.metadata = filter(cell.metadata, key => !(serializer.options?.transientCellMetadata ?? {})[key]);\n\t\t\t\tdata.cells.push(cellData);\n\t\t\t}\n\n\t\t\t// validate write\n\t\t\tawait this._validateWriteFile(uri, options);\n\n\t\t\tif (token.isCancellationRequested) {\n\t\t\t\tthrow new CancellationError();\n\t\t\t}\n\t\t\tconst bytes = await serializer.serializer.serializeNotebook(data, token);\n\t\t\tif (token.isCancellationRequested) {\n\t\t\t\tthrow new CancellationError();\n\t\t\t}\n\n\t\t\t// Don't accept any cancellation beyond this point, we need to report the result of the file write\n\t\t\tthis.trace(`serialized versionId: ${versionId} ${uri.toString()}`);\n\t\t\tawait this._extHostFileSystem.value.writeFile(uri, bytes);\n\t\t\tthis.trace(`Finished write versionId: ${versionId} ${uri.toString()}`);\n\t\t\tconst providerExtUri = this._extHostFileSystem.getFileSystemProviderExtUri(uri.scheme);\n\t\t\tconst stat = await this._extHostFileSystem.value.stat(uri);\n\n\t\t\tconst fileStats = {\n\t\t\t\tname: providerExtUri.basename(uri),\n\t\t\t\tisFile: (stat.type & files.FileType.File) !== 0,\n\t\t\t\tisDirectory: (stat.type & files.FileType.Directory) !== 0,\n\t\t\t\tisSymbolicLink: (stat.type & files.FileType.SymbolicLink) !== 0,\n\t\t\t\tmtime: stat.mtime,\n\t\t\t\tctime: stat.ctime,\n\t\t\t\tsize: stat.size,\n\t\t\t\treadonly: Boolean((stat.permissions ?? 0) & files.FilePermission.Readonly) || !this._extHostFileSystem.value.isWritableFileSystem(uri.scheme),\n\t\t\t\tlocked: Boolean((stat.permissions ?? 0) & files.FilePermission.Locked),\n\t\t\t\tetag: files.etag({ mtime: stat.mtime, size: stat.size }),\n\t\t\t\tchildren: undefined\n\t\t\t};\n\n\t\t\tthis.trace(`exit saveNotebook(versionId: ${versionId}, ${uri.toString()})`);\n\t\t\treturn fileStats;\n\t\t} catch (error) {\n\t\t\t// return fileOperationsErrors to keep the whole object across serialization, these errors are handled specially by the WCS\n\t\t\tif (error instanceof files.FileOperationError) {\n\t\t\t\treturn { ...error, message: error.message };\n\t\t\t}\n\t\t\tthrow error;\n\t\t}\n\t}\n\n\t/**\n\t * Search for query in all notebooks that can be deserialized by the serializer fetched by `handle`.\n\t *\n\t * @param handle used to get notebook serializer\n\t * @param textQuery the text query to search using\n\t * @param viewTypeFileTargets the globs (and associated ranks) that are targetting for opening this type of notebook\n\t * @param otherViewTypeFileTargets ranked globs for other editors that we should consider when deciding whether it will open as this notebook\n\t * @param token cancellation token\n\t * @returns `IRawClosedNotebookFileMatch` for every file. Files without matches will just have a `IRawClosedNotebookFileMatch`\n\t * \twith no `cellResults`. This allows the caller to know what was searched in already, even if it did not yield results.\n\t */\n\tasync $searchInNotebooks(handle: number, textQuery: ITextQuery, viewTypeFileTargets: NotebookPriorityInfo[], otherViewTypeFileTargets: NotebookPriorityInfo[], token: CancellationToken): Promise<{ results: IRawClosedNotebookFileMatch[]; limitHit: boolean }> {\n\t\tconst serializer = this._notebookSerializer.get(handle)?.serializer;\n\t\tif (!serializer) {\n\t\t\treturn {\n\t\t\t\tlimitHit: false,\n\t\t\t\tresults: []\n\t\t\t};\n\t\t}\n\n\t\tconst finalMatchedTargets = new ResourceSet();\n\n\t\tconst runFileQueries = async (includes: NotebookPriorityInfo[], token: CancellationToken, textQuery: ITextQuery): Promise<void> => {\n\t\t\tawait Promise.all(includes.map(async include =>\n\t\t\t\tawait Promise.all(include.filenamePatterns.map(filePattern => {\n\t\t\t\t\tconst query: IFileQuery = {\n\t\t\t\t\t\t_reason: textQuery._reason,\n\t\t\t\t\t\tfolderQueries: textQuery.folderQueries,\n\t\t\t\t\t\tincludePattern: textQuery.includePattern,\n\t\t\t\t\t\texcludePattern: textQuery.excludePattern,\n\t\t\t\t\t\tmaxResults: textQuery.maxResults,\n\t\t\t\t\t\ttype: QueryType.File,\n\t\t\t\t\t\tfilePattern\n\t\t\t\t\t};\n\n\t\t\t\t\t// use priority info to exclude info from other globs\n\t\t\t\t\treturn this._extHostSearch.doInternalFileSearchWithCustomCallback(query, token, (data) => {\n\t\t\t\t\t\tdata.forEach(uri => {\n\t\t\t\t\t\t\tif (finalMatchedTargets.has(uri)) {\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tconst hasOtherMatches = otherViewTypeFileTargets.some(target => {\n\t\t\t\t\t\t\t\t// use the same strategy that the editor service uses to open editors\n\t\t\t\t\t\t\t\t// https://github.com/microsoft/vscode/blob/ac1631528e67637da65ec994c6dc35d73f6e33cc/src/vs/workbench/services/editor/browser/editorResolverService.ts#L359-L366\n\t\t\t\t\t\t\t\tif (include.isFromSettings && !target.isFromSettings) {\n\t\t\t\t\t\t\t\t\t// if the include is from the settings and target isn't, even if it matches, it's still overridden.\n\t\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t// longer filePatterns are considered more specifc, so they always have precedence the shorter patterns\n\t\t\t\t\t\t\t\t\treturn target.filenamePatterns.some(targetFilePattern => globMatchesResource(targetFilePattern, uri));\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\tif (hasOtherMatches) {\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tfinalMatchedTargets.add(uri);\n\t\t\t\t\t\t});\n\t\t\t\t\t}).catch(err => {\n\t\t\t\t\t\t// temporary fix for https://github.com/microsoft/vscode/issues/205044: don't show notebook results for remotehub repos.\n\t\t\t\t\t\tif (err.code === 'ENOENT') {\n\t\t\t\t\t\t\tconsole.warn(`Could not find notebook search results, ignoring notebook results.`);\n\t\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\t\tlimitHit: false,\n\t\t\t\t\t\t\t\tmessages: [],\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tthrow err;\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}))\n\t\t\t));\n\t\t\treturn;\n\t\t};\n\n\t\tawait runFileQueries(viewTypeFileTargets, token, textQuery);\n\n\t\tconst results = new ResourceMap<INotebookFileMatchNoModel>();\n\t\tlet limitHit = false;\n\t\tconst promises = Array.from(finalMatchedTargets).map(async (uri) => {\n\t\t\tconst cellMatches: INotebookCellMatchNoModel[] = [];\n\n\t\t\ttry {\n\t\t\t\tif (token.isCancellationRequested) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tif (textQuery.maxResults && [...results.values()].reduce((acc, value) => acc + value.cellResults.length, 0) > textQuery.maxResults) {\n\t\t\t\t\tlimitHit = true;\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst simpleCells: Array<{ input: string; outputs: string[] }> = [];\n\t\t\t\tconst notebook = this._documents.get(uri);\n\t\t\t\tif (notebook) {\n\t\t\t\t\tconst cells = notebook.apiNotebook.getCells();\n\t\t\t\t\tcells.forEach(e => simpleCells.push(\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tinput: e.document.getText(),\n\t\t\t\t\t\t\toutputs: e.outputs.flatMap(value => value.items.map(output => output.data.toString()))\n\t\t\t\t\t\t}\n\t\t\t\t\t));\n\t\t\t\t} else {\n\t\t\t\t\tconst fileContent = await this._extHostFileSystem.value.readFile(uri);\n\t\t\t\t\tconst bytes = VSBuffer.fromString(fileContent.toString());\n\t\t\t\t\tconst notebook = await serializer.deserializeNotebook(bytes.buffer, token);\n\t\t\t\t\tif (token.isCancellationRequested) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tconst data = typeConverters.NotebookData.from(notebook);\n\n\t\t\t\t\tdata.cells.forEach(cell => simpleCells.push(\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tinput: cell.source,\n\t\t\t\t\t\t\toutputs: cell.outputs.flatMap(value => value.items.map(output => output.valueBytes.toString()))\n\t\t\t\t\t\t}\n\t\t\t\t\t));\n\t\t\t\t}\n\n\n\t\t\t\tif (token.isCancellationRequested) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tsimpleCells.forEach((cell, index) => {\n\t\t\t\t\tconst target = textQuery.contentPattern.pattern;\n\t\t\t\t\tconst cellModel = new CellSearchModel(cell.input, undefined, cell.outputs);\n\n\t\t\t\t\tconst inputMatches = cellModel.findInInputs(target);\n\t\t\t\t\tconst outputMatches = cellModel.findInOutputs(target);\n\t\t\t\t\tconst webviewResults = outputMatches\n\t\t\t\t\t\t.flatMap(outputMatch =>\n\t\t\t\t\t\t\tgenericCellMatchesToTextSearchMatches(outputMatch.matches, outputMatch.textBuffer))\n\t\t\t\t\t\t.map((textMatch, index) => {\n\t\t\t\t\t\t\ttextMatch.webviewIndex = index;\n\t\t\t\t\t\t\treturn textMatch;\n\t\t\t\t\t\t});\n\n\t\t\t\t\tif (inputMatches.length > 0 || outputMatches.length > 0) {\n\t\t\t\t\t\tconst cellMatch: INotebookCellMatchNoModel = {\n\t\t\t\t\t\t\tindex: index,\n\t\t\t\t\t\t\tcontentResults: genericCellMatchesToTextSearchMatches(inputMatches, cellModel.inputTextBuffer),\n\t\t\t\t\t\t\twebviewResults\n\t\t\t\t\t\t};\n\t\t\t\t\t\tcellMatches.push(cellMatch);\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tconst fileMatch = {\n\t\t\t\t\tresource: uri, cellResults: cellMatches\n\t\t\t\t};\n\t\t\t\tresults.set(uri, fileMatch);\n\t\t\t\treturn;\n\n\t\t\t} catch (e) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t});\n\n\t\tawait Promise.all(promises);\n\t\treturn {\n\t\t\tlimitHit,\n\t\t\tresults: [...results.values()]\n\t\t};\n\t}\n\n\n\n\tprivate async _validateWriteFile(uri: URI, options: files.IWriteFileOptions) {\n\t\tconst stat = await this._extHostFileSystem.value.stat(uri);\n\t\t// Dirty write prevention\n\t\tif (\n\t\t\ttypeof options?.mtime === 'number' && typeof options.etag === 'string' && options.etag !== files.ETAG_DISABLED &&\n\t\t\ttypeof stat.mtime === 'number' && typeof stat.size === 'number' &&\n\t\t\toptions.mtime < stat.mtime && options.etag !== files.etag({ mtime: options.mtime /* not using stat.mtime for a reason, see above */, size: stat.size })\n\t\t) {\n\t\t\tthrow new files.FileOperationError(localize('fileModifiedError', \"File Modified Since\"), files.FileOperationResult.FILE_MODIFIED_SINCE, options);\n\t\t}\n\n\t\treturn;\n\t}\n\n\tprivate _resourceForError(uri: URI): string {\n\t\treturn uri.scheme === Schemas.file ? uri.fsPath : uri.toString();\n\t}\n\n\t// --- open, save, saveAs, backup\n\n\n\tprivate _createExtHostEditor(document: ExtHostNotebookDocument, editorId: string, data: INotebookEditorAddData) {\n\n\t\tif (this._editors.has(editorId)) {\n\t\t\tthrow new Error(`editor with id ALREADY EXSIST: ${editorId}`);\n\t\t}\n\n\t\tconst editor = new ExtHostNotebookEditor(\n\t\t\teditorId,\n\t\t\tthis._notebookEditorsProxy,\n\t\t\tdocument,\n\t\t\tdata.visibleRanges.map(typeConverters.NotebookRange.to),\n\t\t\tdata.selections.map(typeConverters.NotebookRange.to),\n\t\t\ttypeof data.viewColumn === 'number' ? typeConverters.ViewColumn.to(data.viewColumn) : undefined,\n\t\t\tdata.viewType\n\t\t);\n\n\t\tthis._editors.set(editorId, editor);\n\t}\n\n\t$acceptDocumentAndEditorsDelta(delta: SerializableObjectWithBuffers<INotebookDocumentsAndEditorsDelta>): void {\n\n\t\tif (delta.value.removedDocuments) {\n\t\t\tfor (const uri of delta.value.removedDocuments) {\n\t\t\t\tconst revivedUri = URI.revive(uri);\n\t\t\t\tconst document = this._documents.get(revivedUri);\n\n\t\t\t\tif (document) {\n\t\t\t\t\tdocument.dispose();\n\t\t\t\t\tthis._documents.delete(revivedUri);\n\t\t\t\t\tthis._textDocumentsAndEditors.$acceptDocumentsAndEditorsDelta({ removedDocuments: document.apiNotebook.getCells().map(cell => cell.document.uri) });\n\t\t\t\t\tthis._onDidCloseNotebookDocument.fire(document.apiNotebook);\n\t\t\t\t}\n\n\t\t\t\tfor (const editor of this._editors.values()) {\n\t\t\t\t\tif (editor.notebookData.uri.toString() === revivedUri.toString()) {\n\t\t\t\t\t\tthis._editors.delete(editor.id);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (delta.value.addedDocuments) {\n\n\t\t\tconst addedCellDocuments: IModelAddedData[] = [];\n\n\t\t\tfor (const modelData of delta.value.addedDocuments) {\n\t\t\t\tconst uri = URI.revive(modelData.uri);\n\n\t\t\t\tif (this._documents.has(uri)) {\n\t\t\t\t\tthrow new Error(`adding EXISTING notebook ${uri} `);\n\t\t\t\t}\n\n\t\t\t\tconst document = new ExtHostNotebookDocument(\n\t\t\t\t\tthis._notebookDocumentsProxy,\n\t\t\t\t\tthis._textDocumentsAndEditors,\n\t\t\t\t\tthis._textDocuments,\n\t\t\t\t\turi,\n\t\t\t\t\tmodelData\n\t\t\t\t);\n\n\t\t\t\t// add cell document as vscode.TextDocument\n\t\t\t\taddedCellDocuments.push(...modelData.cells.map(cell => ExtHostCell.asModelAddData(cell)));\n\n\t\t\t\tthis._documents.get(uri)?.dispose();\n\t\t\t\tthis._documents.set(uri, document);\n\t\t\t\tthis._textDocumentsAndEditors.$acceptDocumentsAndEditorsDelta({ addedDocuments: addedCellDocuments });\n\n\t\t\t\tthis._onDidOpenNotebookDocument.fire(document.apiNotebook);\n\t\t\t}\n\t\t}\n\n\t\tif (delta.value.addedEditors) {\n\t\t\tfor (const editorModelData of delta.value.addedEditors) {\n\t\t\t\tif (this._editors.has(editorModelData.id)) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst revivedUri = URI.revive(editorModelData.documentUri);\n\t\t\t\tconst document = this._documents.get(revivedUri);\n\n\t\t\t\tif (document) {\n\t\t\t\t\tthis._createExtHostEditor(document, editorModelData.id, editorModelData);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tconst removedEditors: ExtHostNotebookEditor[] = [];\n\n\t\tif (delta.value.removedEditors) {\n\t\t\tfor (const editorid of delta.value.removedEditors) {\n\t\t\t\tconst editor = this._editors.get(editorid);\n\n\t\t\t\tif (editor) {\n\t\t\t\t\tthis._editors.delete(editorid);\n\n\t\t\t\t\tif (this._activeNotebookEditor?.id === editor.id) {\n\t\t\t\t\t\tthis._activeNotebookEditor = undefined;\n\t\t\t\t\t}\n\n\t\t\t\t\tremovedEditors.push(editor);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (delta.value.visibleEditors) {\n\t\t\tthis._visibleNotebookEditors = delta.value.visibleEditors.map(id => this._editors.get(id)!).filter(editor => !!editor) as ExtHostNotebookEditor[];\n\t\t\tconst visibleEditorsSet = new Set<string>();\n\t\t\tthis._visibleNotebookEditors.forEach(editor => visibleEditorsSet.add(editor.id));\n\n\t\t\tfor (const editor of this._editors.values()) {\n\t\t\t\tconst newValue = visibleEditorsSet.has(editor.id);\n\t\t\t\teditor._acceptVisibility(newValue);\n\t\t\t}\n\n\t\t\tthis._visibleNotebookEditors = [...this._editors.values()].map(e => e).filter(e => e.visible);\n\t\t\tthis._onDidChangeVisibleNotebookEditors.fire(this.visibleNotebookEditors);\n\t\t}\n\n\t\tif (delta.value.newActiveEditor === null) {\n\t\t\t// clear active notebook as current active editor is non-notebook editor\n\t\t\tthis._activeNotebookEditor = undefined;\n\t\t} else if (delta.value.newActiveEditor) {\n\t\t\tconst activeEditor = this._editors.get(delta.value.newActiveEditor);\n\t\t\tif (!activeEditor) {\n\t\t\t\tconsole.error(`FAILED to find active notebook editor ${delta.value.newActiveEditor}`);\n\t\t\t}\n\t\t\tthis._activeNotebookEditor = this._editors.get(delta.value.newActiveEditor);\n\t\t}\n\t\tif (delta.value.newActiveEditor !== undefined) {\n\t\t\tthis._onDidChangeActiveNotebookEditor.fire(this._activeNotebookEditor?.apiEditor);\n\t\t}\n\t}\n\n\tprivate static _registerApiCommands(extHostCommands: ExtHostCommands) {\n\n\t\tconst notebookTypeArg = ApiCommandArgument.String.with('notebookType', 'A notebook type');\n\n\t\tconst commandDataToNotebook = new ApiCommand(\n\t\t\t'vscode.executeDataToNotebook', '_executeDataToNotebook', 'Invoke notebook serializer',\n\t\t\t[notebookTypeArg, new ApiCommandArgument<Uint8Array, VSBuffer>('data', 'Bytes to convert to data', v => v instanceof Uint8Array, v => VSBuffer.wrap(v))],\n\t\t\tnew ApiCommandResult<SerializableObjectWithBuffers<NotebookDataDto>, vscode.NotebookData>('Notebook Data', data => typeConverters.NotebookData.to(data.value))\n\t\t);\n\n\t\tconst commandNotebookToData = new ApiCommand(\n\t\t\t'vscode.executeNotebookToData', '_executeNotebookToData', 'Invoke notebook serializer',\n\t\t\t[notebookTypeArg, new ApiCommandArgument<vscode.NotebookData, SerializableObjectWithBuffers<NotebookDataDto>>('NotebookData', 'Notebook data to convert to bytes', v => true, v => new SerializableObjectWithBuffers(typeConverters.NotebookData.from(v)))],\n\t\t\tnew ApiCommandResult<VSBuffer, Uint8Array>('Bytes', dto => dto.buffer)\n\t\t);\n\n\t\textHostCommands.registerApiCommand(commandDataToNotebook);\n\t\textHostCommands.registerApiCommand(commandNotebookToData);\n\t}\n\n\tprivate trace(msg: string): void {\n\t\tthis._logService.trace(`[Extension Host Notebook] ${msg}`);\n\t}\n}\n\nexport class NotebookSaveError extends Error {\n\tconstructor(message: string) {\n\t\tsuper(message);\n\t\tthis.name = 'NotebookSaveError';\n\t}\n}\n"]}