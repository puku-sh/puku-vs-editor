{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/api/common/extHostNotebookDocument.ts","vs/workbench/api/common/extHostNotebookDocument.ts"],"names":[],"mappings":"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","file":"extHostNotebookDocument.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Schemas } from '../../../base/common/network.js';\nimport { URI } from '../../../base/common/uri.js';\nimport * as extHostProtocol from './extHost.protocol.js';\nimport { ExtHostDocuments } from './extHostDocuments.js';\nimport { ExtHostDocumentsAndEditors } from './extHostDocumentsAndEditors.js';\nimport * as extHostTypeConverters from './extHostTypeConverters.js';\nimport { NotebookRange } from './extHostTypes.js';\nimport * as notebookCommon from '../../contrib/notebook/common/notebookCommon.js';\nimport * as vscode from 'vscode';\nimport { isTextStreamMime } from '../../../base/common/mime.js';\n\nclass RawContentChangeEvent {\n\n\tconstructor(\n\t\treadonly start: number,\n\t\treadonly deletedCount: number,\n\t\treadonly deletedItems: vscode.NotebookCell[],\n\t\treadonly items: ExtHostCell[]\n\t) { }\n\n\tasApiEvent(): vscode.NotebookDocumentContentChange {\n\t\treturn {\n\t\t\trange: new NotebookRange(this.start, this.start + this.deletedCount),\n\t\t\taddedCells: this.items.map(cell => cell.apiCell),\n\t\t\tremovedCells: this.deletedItems,\n\t\t};\n\t}\n}\n\nexport class ExtHostCell {\n\n\tstatic asModelAddData(cell: extHostProtocol.NotebookCellDto): extHostProtocol.IModelAddedData {\n\t\treturn {\n\t\t\tEOL: cell.eol,\n\t\t\tlines: cell.source,\n\t\t\tlanguageId: cell.language,\n\t\t\turi: cell.uri,\n\t\t\tisDirty: false,\n\t\t\tversionId: 1,\n\t\t\tencoding: 'utf8'\n\t\t};\n\t}\n\n\tprivate _outputs: vscode.NotebookCellOutput[];\n\tprivate _metadata: Readonly<notebookCommon.NotebookCellMetadata>;\n\tprivate _previousResult: Readonly<vscode.NotebookCellExecutionSummary | undefined>;\n\n\tprivate _internalMetadata: notebookCommon.NotebookCellInternalMetadata;\n\treadonly handle: number;\n\treadonly uri: URI;\n\treadonly cellKind: notebookCommon.CellKind;\n\n\tprivate _apiCell: vscode.NotebookCell | undefined;\n\tprivate _mime: string | undefined;\n\n\tconstructor(\n\t\treadonly notebook: ExtHostNotebookDocument,\n\t\tprivate readonly _extHostDocument: ExtHostDocumentsAndEditors,\n\t\tprivate readonly _cellData: extHostProtocol.NotebookCellDto,\n\t) {\n\t\tthis.handle = _cellData.handle;\n\t\tthis.uri = URI.revive(_cellData.uri);\n\t\tthis.cellKind = _cellData.cellKind;\n\t\tthis._outputs = _cellData.outputs.map(extHostTypeConverters.NotebookCellOutput.to);\n\t\tthis._internalMetadata = _cellData.internalMetadata ?? {};\n\t\tthis._metadata = Object.freeze(_cellData.metadata ?? {});\n\t\tthis._previousResult = Object.freeze(extHostTypeConverters.NotebookCellExecutionSummary.to(_cellData.internalMetadata ?? {}));\n\t}\n\n\tget internalMetadata(): notebookCommon.NotebookCellInternalMetadata {\n\t\treturn this._internalMetadata;\n\t}\n\n\tget apiCell(): vscode.NotebookCell {\n\t\tif (!this._apiCell) {\n\t\t\tconst that = this;\n\t\t\tconst data = this._extHostDocument.getDocument(this.uri);\n\t\t\tif (!data) {\n\t\t\t\tthrow new Error(`MISSING extHostDocument for notebook cell: ${this.uri}`);\n\t\t\t}\n\t\t\tconst apiCell: vscode.NotebookCell = {\n\t\t\t\tget index() { return that.notebook.getCellIndex(that); },\n\t\t\t\tnotebook: that.notebook.apiNotebook,\n\t\t\t\tkind: extHostTypeConverters.NotebookCellKind.to(this._cellData.cellKind),\n\t\t\t\tdocument: data.document,\n\t\t\t\tget mime() { return that._mime; },\n\t\t\t\tset mime(value: string | undefined) { that._mime = value; },\n\t\t\t\tget outputs() { return that._outputs.slice(0); },\n\t\t\t\tget metadata() { return that._metadata; },\n\t\t\t\tget executionSummary() { return that._previousResult; }\n\t\t\t};\n\t\t\tthis._apiCell = Object.freeze(apiCell);\n\t\t}\n\t\treturn this._apiCell;\n\t}\n\n\tsetOutputs(newOutputs: extHostProtocol.NotebookOutputDto[]): void {\n\t\tthis._outputs = newOutputs.map(extHostTypeConverters.NotebookCellOutput.to);\n\t}\n\n\tsetOutputItems(outputId: string, append: boolean, newOutputItems: extHostProtocol.NotebookOutputItemDto[]) {\n\t\tconst newItems = newOutputItems.map(extHostTypeConverters.NotebookCellOutputItem.to);\n\t\tconst output = this._outputs.find(op => op.id === outputId);\n\t\tif (output) {\n\t\t\tif (!append) {\n\t\t\t\toutput.items.length = 0;\n\t\t\t}\n\t\t\toutput.items.push(...newItems);\n\n\t\t\tif (output.items.length > 1 && output.items.every(item => isTextStreamMime(item.mime))) {\n\t\t\t\t// Look for the mimes in the items, and keep track of their order.\n\t\t\t\t// Merge the streams into one output item, per mime type.\n\t\t\t\tconst mimeOutputs = new Map<string, Uint8Array[]>();\n\t\t\t\tconst mimeTypes: string[] = [];\n\t\t\t\toutput.items.forEach(item => {\n\t\t\t\t\tlet items: Uint8Array[];\n\t\t\t\t\tif (mimeOutputs.has(item.mime)) {\n\t\t\t\t\t\titems = mimeOutputs.get(item.mime)!;\n\t\t\t\t\t} else {\n\t\t\t\t\t\titems = [];\n\t\t\t\t\t\tmimeOutputs.set(item.mime, items);\n\t\t\t\t\t\tmimeTypes.push(item.mime);\n\t\t\t\t\t}\n\t\t\t\t\titems.push(item.data);\n\t\t\t\t});\n\t\t\t\toutput.items.length = 0;\n\t\t\t\tmimeTypes.forEach(mime => {\n\t\t\t\t\tconst compressed = notebookCommon.compressOutputItemStreams(mimeOutputs.get(mime)!);\n\t\t\t\t\toutput.items.push({\n\t\t\t\t\t\tmime,\n\t\t\t\t\t\tdata: compressed.data.buffer\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n\n\tsetMetadata(newMetadata: notebookCommon.NotebookCellMetadata): void {\n\t\tthis._metadata = Object.freeze(newMetadata);\n\t}\n\n\tsetInternalMetadata(newInternalMetadata: notebookCommon.NotebookCellInternalMetadata): void {\n\t\tthis._internalMetadata = newInternalMetadata;\n\t\tthis._previousResult = Object.freeze(extHostTypeConverters.NotebookCellExecutionSummary.to(newInternalMetadata));\n\t}\n\n\tsetMime(newMime: string | undefined) {\n\n\t}\n}\n\n\nexport class ExtHostNotebookDocument {\n\n\tprivate static _handlePool: number = 0;\n\treadonly handle = ExtHostNotebookDocument._handlePool++;\n\n\tprivate readonly _cells: ExtHostCell[] = [];\n\n\tprivate readonly _notebookType: string;\n\n\tprivate _notebook: vscode.NotebookDocument | undefined;\n\tprivate _metadata: Record<string, any>;\n\tprivate _versionId: number = 0;\n\tprivate _isDirty: boolean = false;\n\tprivate _disposed: boolean = false;\n\n\tconstructor(\n\t\tprivate readonly _proxy: extHostProtocol.MainThreadNotebookDocumentsShape,\n\t\tprivate readonly _textDocumentsAndEditors: ExtHostDocumentsAndEditors,\n\t\tprivate readonly _textDocuments: ExtHostDocuments,\n\t\treadonly uri: URI,\n\t\tdata: extHostProtocol.INotebookModelAddedData\n\t) {\n\t\tthis._notebookType = data.viewType;\n\t\tthis._metadata = Object.freeze(data.metadata ?? Object.create(null));\n\t\tthis._spliceNotebookCells([[0, 0, data.cells]], true /* init -> no event*/, undefined);\n\t\tthis._versionId = data.versionId;\n\t}\n\n\tdispose() {\n\t\tthis._disposed = true;\n\t}\n\n\tget versionId(): number {\n\t\treturn this._versionId;\n\t}\n\n\tget apiNotebook(): vscode.NotebookDocument {\n\t\tif (!this._notebook) {\n\t\t\tconst that = this;\n\t\t\tconst apiObject: vscode.NotebookDocument = {\n\t\t\t\tget uri() { return that.uri; },\n\t\t\t\tget version() { return that._versionId; },\n\t\t\t\tget notebookType() { return that._notebookType; },\n\t\t\t\tget isDirty() { return that._isDirty; },\n\t\t\t\tget isUntitled() { return that.uri.scheme === Schemas.untitled; },\n\t\t\t\tget isClosed() { return that._disposed; },\n\t\t\t\tget metadata() { return that._metadata; },\n\t\t\t\tget cellCount() { return that._cells.length; },\n\t\t\t\tcellAt(index) {\n\t\t\t\t\tindex = that._validateIndex(index);\n\t\t\t\t\treturn that._cells[index].apiCell;\n\t\t\t\t},\n\t\t\t\tgetCells(range) {\n\t\t\t\t\tconst cells = range ? that._getCells(range) : that._cells;\n\t\t\t\t\treturn cells.map(cell => cell.apiCell);\n\t\t\t\t},\n\t\t\t\tsave() {\n\t\t\t\t\treturn that._save();\n\t\t\t\t},\n\t\t\t\t[Symbol.for('debug.description')]() {\n\t\t\t\t\treturn `NotebookDocument(${this.uri.toString()})`;\n\t\t\t\t}\n\t\t\t};\n\t\t\tthis._notebook = Object.freeze(apiObject);\n\t\t}\n\t\treturn this._notebook;\n\t}\n\n\tacceptDocumentPropertiesChanged(data: extHostProtocol.INotebookDocumentPropertiesChangeData) {\n\t\tif (data.metadata) {\n\t\t\tthis._metadata = Object.freeze({ ...this._metadata, ...data.metadata });\n\t\t}\n\t}\n\n\tacceptDirty(isDirty: boolean): void {\n\t\tthis._isDirty = isDirty;\n\t}\n\n\tacceptModelChanged(event: extHostProtocol.NotebookCellsChangedEventDto, isDirty: boolean, newMetadata: notebookCommon.NotebookDocumentMetadata | undefined): vscode.NotebookDocumentChangeEvent {\n\t\tthis._versionId = event.versionId;\n\t\tthis._isDirty = isDirty;\n\t\tthis.acceptDocumentPropertiesChanged({ metadata: newMetadata });\n\n\t\tconst result = {\n\t\t\tnotebook: this.apiNotebook,\n\t\t\tmetadata: newMetadata,\n\t\t\tcellChanges: <vscode.NotebookDocumentCellChange[]>[],\n\t\t\tcontentChanges: <vscode.NotebookDocumentContentChange[]>[],\n\t\t};\n\n\t\ttype RelaxedCellChange = Partial<vscode.NotebookDocumentCellChange> & { cell: vscode.NotebookCell };\n\t\tconst relaxedCellChanges: RelaxedCellChange[] = [];\n\n\t\t// -- apply change and populate content changes\n\n\t\tfor (const rawEvent of event.rawEvents) {\n\t\t\tif (rawEvent.kind === notebookCommon.NotebookCellsChangeType.ModelChange) {\n\t\t\t\tthis._spliceNotebookCells(rawEvent.changes, false, result.contentChanges);\n\n\t\t\t} else if (rawEvent.kind === notebookCommon.NotebookCellsChangeType.Move) {\n\t\t\t\tthis._moveCells(rawEvent.index, rawEvent.length, rawEvent.newIdx, result.contentChanges);\n\n\t\t\t} else if (rawEvent.kind === notebookCommon.NotebookCellsChangeType.Output) {\n\t\t\t\tthis._setCellOutputs(rawEvent.index, rawEvent.outputs);\n\t\t\t\trelaxedCellChanges.push({ cell: this._cells[rawEvent.index].apiCell, outputs: this._cells[rawEvent.index].apiCell.outputs });\n\n\t\t\t} else if (rawEvent.kind === notebookCommon.NotebookCellsChangeType.OutputItem) {\n\t\t\t\tthis._setCellOutputItems(rawEvent.index, rawEvent.outputId, rawEvent.append, rawEvent.outputItems);\n\t\t\t\trelaxedCellChanges.push({ cell: this._cells[rawEvent.index].apiCell, outputs: this._cells[rawEvent.index].apiCell.outputs });\n\n\t\t\t} else if (rawEvent.kind === notebookCommon.NotebookCellsChangeType.ChangeCellLanguage) {\n\t\t\t\tthis._changeCellLanguage(rawEvent.index, rawEvent.language);\n\t\t\t\trelaxedCellChanges.push({ cell: this._cells[rawEvent.index].apiCell, document: this._cells[rawEvent.index].apiCell.document });\n\n\t\t\t} else if (rawEvent.kind === notebookCommon.NotebookCellsChangeType.ChangeCellContent) {\n\t\t\t\trelaxedCellChanges.push({ cell: this._cells[rawEvent.index].apiCell, document: this._cells[rawEvent.index].apiCell.document });\n\n\t\t\t} else if (rawEvent.kind === notebookCommon.NotebookCellsChangeType.ChangeCellMime) {\n\t\t\t\tthis._changeCellMime(rawEvent.index, rawEvent.mime);\n\t\t\t} else if (rawEvent.kind === notebookCommon.NotebookCellsChangeType.ChangeCellMetadata) {\n\t\t\t\tthis._changeCellMetadata(rawEvent.index, rawEvent.metadata);\n\t\t\t\trelaxedCellChanges.push({ cell: this._cells[rawEvent.index].apiCell, metadata: this._cells[rawEvent.index].apiCell.metadata });\n\n\t\t\t} else if (rawEvent.kind === notebookCommon.NotebookCellsChangeType.ChangeCellInternalMetadata) {\n\t\t\t\tthis._changeCellInternalMetadata(rawEvent.index, rawEvent.internalMetadata);\n\t\t\t\trelaxedCellChanges.push({ cell: this._cells[rawEvent.index].apiCell, executionSummary: this._cells[rawEvent.index].apiCell.executionSummary });\n\t\t\t}\n\t\t}\n\n\t\t// -- compact cellChanges\n\n\t\tconst map = new Map<vscode.NotebookCell, number>();\n\t\tfor (let i = 0; i < relaxedCellChanges.length; i++) {\n\t\t\tconst relaxedCellChange = relaxedCellChanges[i];\n\t\t\tconst existing = map.get(relaxedCellChange.cell);\n\t\t\tif (existing === undefined) {\n\t\t\t\tconst newLen = result.cellChanges.push({\n\t\t\t\t\tdocument: undefined,\n\t\t\t\t\texecutionSummary: undefined,\n\t\t\t\t\tmetadata: undefined,\n\t\t\t\t\toutputs: undefined,\n\t\t\t\t\t...relaxedCellChange,\n\t\t\t\t});\n\t\t\t\tmap.set(relaxedCellChange.cell, newLen - 1);\n\t\t\t} else {\n\t\t\t\tresult.cellChanges[existing] = {\n\t\t\t\t\t...result.cellChanges[existing],\n\t\t\t\t\t...relaxedCellChange\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\n\t\t// Freeze event properties so handlers cannot accidentally modify them\n\t\tObject.freeze(result);\n\t\tObject.freeze(result.cellChanges);\n\t\tObject.freeze(result.contentChanges);\n\n\t\treturn result;\n\t}\n\n\tprivate _validateIndex(index: number): number {\n\t\tindex = index | 0;\n\t\tif (index < 0) {\n\t\t\treturn 0;\n\t\t} else if (index >= this._cells.length) {\n\t\t\treturn this._cells.length - 1;\n\t\t} else {\n\t\t\treturn index;\n\t\t}\n\t}\n\n\tprivate _validateRange(range: vscode.NotebookRange): vscode.NotebookRange {\n\t\tlet start = range.start | 0;\n\t\tlet end = range.end | 0;\n\t\tif (start < 0) {\n\t\t\tstart = 0;\n\t\t}\n\t\tif (end > this._cells.length) {\n\t\t\tend = this._cells.length;\n\t\t}\n\t\treturn range.with({ start, end });\n\t}\n\n\tprivate _getCells(range: vscode.NotebookRange): ExtHostCell[] {\n\t\trange = this._validateRange(range);\n\t\tconst result: ExtHostCell[] = [];\n\t\tfor (let i = range.start; i < range.end; i++) {\n\t\t\tresult.push(this._cells[i]);\n\t\t}\n\t\treturn result;\n\t}\n\n\tprivate async _save(): Promise<boolean> {\n\t\tif (this._disposed) {\n\t\t\treturn Promise.reject(new Error('Notebook has been closed'));\n\t\t}\n\t\treturn this._proxy.$trySaveNotebook(this.uri);\n\t}\n\n\tprivate _spliceNotebookCells(splices: notebookCommon.NotebookCellTextModelSplice<extHostProtocol.NotebookCellDto>[], initialization: boolean, bucket: vscode.NotebookDocumentContentChange[] | undefined): void {\n\t\tif (this._disposed) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst contentChangeEvents: RawContentChangeEvent[] = [];\n\t\tconst addedCellDocuments: extHostProtocol.IModelAddedData[] = [];\n\t\tconst removedCellDocuments: URI[] = [];\n\n\t\tsplices.reverse().forEach(splice => {\n\t\t\tconst cellDtos = splice[2];\n\t\t\tconst newCells = cellDtos.map(cell => {\n\n\t\t\t\tconst extCell = new ExtHostCell(this, this._textDocumentsAndEditors, cell);\n\t\t\t\tif (!initialization) {\n\t\t\t\t\taddedCellDocuments.push(ExtHostCell.asModelAddData(cell));\n\t\t\t\t}\n\t\t\t\treturn extCell;\n\t\t\t});\n\n\t\t\tconst changeEvent = new RawContentChangeEvent(splice[0], splice[1], [], newCells);\n\t\t\tconst deletedItems = this._cells.splice(splice[0], splice[1], ...newCells);\n\t\t\tfor (const cell of deletedItems) {\n\t\t\t\tremovedCellDocuments.push(cell.uri);\n\t\t\t\tchangeEvent.deletedItems.push(cell.apiCell);\n\t\t\t}\n\t\t\tcontentChangeEvents.push(changeEvent);\n\t\t});\n\n\t\tthis._textDocumentsAndEditors.acceptDocumentsAndEditorsDelta({\n\t\t\taddedDocuments: addedCellDocuments,\n\t\t\tremovedDocuments: removedCellDocuments\n\t\t});\n\n\t\tif (bucket) {\n\t\t\tfor (const changeEvent of contentChangeEvents) {\n\t\t\t\tbucket.push(changeEvent.asApiEvent());\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate _moveCells(index: number, length: number, newIdx: number, bucket: vscode.NotebookDocumentContentChange[]): void {\n\t\tconst cells = this._cells.splice(index, length);\n\t\tthis._cells.splice(newIdx, 0, ...cells);\n\t\tconst changes = [\n\t\t\tnew RawContentChangeEvent(index, length, cells.map(c => c.apiCell), []),\n\t\t\tnew RawContentChangeEvent(newIdx, 0, [], cells)\n\t\t];\n\t\tfor (const change of changes) {\n\t\t\tbucket.push(change.asApiEvent());\n\t\t}\n\t}\n\n\tprivate _setCellOutputs(index: number, outputs: extHostProtocol.NotebookOutputDto[]): void {\n\t\tconst cell = this._cells[index];\n\t\tcell.setOutputs(outputs);\n\t}\n\n\tprivate _setCellOutputItems(index: number, outputId: string, append: boolean, outputItems: extHostProtocol.NotebookOutputItemDto[]): void {\n\t\tconst cell = this._cells[index];\n\t\tcell.setOutputItems(outputId, append, outputItems);\n\t}\n\n\tprivate _changeCellLanguage(index: number, newLanguageId: string): void {\n\t\tconst cell = this._cells[index];\n\t\tif (cell.apiCell.document.languageId !== newLanguageId) {\n\t\t\tthis._textDocuments.$acceptModelLanguageChanged(cell.uri, newLanguageId);\n\t\t}\n\t}\n\n\tprivate _changeCellMime(index: number, newMime: string | undefined): void {\n\t\tconst cell = this._cells[index];\n\t\tcell.apiCell.mime = newMime;\n\t}\n\n\tprivate _changeCellMetadata(index: number, newMetadata: notebookCommon.NotebookCellMetadata): void {\n\t\tconst cell = this._cells[index];\n\t\tcell.setMetadata(newMetadata);\n\t}\n\n\tprivate _changeCellInternalMetadata(index: number, newInternalMetadata: notebookCommon.NotebookCellInternalMetadata): void {\n\t\tconst cell = this._cells[index];\n\t\tcell.setInternalMetadata(newInternalMetadata);\n\t}\n\n\tgetCellFromApiCell(apiCell: vscode.NotebookCell): ExtHostCell | undefined {\n\t\treturn this._cells.find(cell => cell.apiCell === apiCell);\n\t}\n\n\tgetCellFromIndex(index: number): ExtHostCell | undefined {\n\t\treturn this._cells[index];\n\t}\n\n\tgetCell(cellHandle: number): ExtHostCell | undefined {\n\t\treturn this._cells.find(cell => cell.handle === cellHandle);\n\t}\n\n\tgetCellIndex(cell: ExtHostCell): number {\n\t\treturn this._cells.indexOf(cell);\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Schemas } from '../../../base/common/network.js';\nimport { URI } from '../../../base/common/uri.js';\nimport * as extHostProtocol from './extHost.protocol.js';\nimport { ExtHostDocuments } from './extHostDocuments.js';\nimport { ExtHostDocumentsAndEditors } from './extHostDocumentsAndEditors.js';\nimport * as extHostTypeConverters from './extHostTypeConverters.js';\nimport { NotebookRange } from './extHostTypes.js';\nimport * as notebookCommon from '../../contrib/notebook/common/notebookCommon.js';\nimport * as vscode from 'vscode';\nimport { isTextStreamMime } from '../../../base/common/mime.js';\n\nclass RawContentChangeEvent {\n\n\tconstructor(\n\t\treadonly start: number,\n\t\treadonly deletedCount: number,\n\t\treadonly deletedItems: vscode.NotebookCell[],\n\t\treadonly items: ExtHostCell[]\n\t) { }\n\n\tasApiEvent(): vscode.NotebookDocumentContentChange {\n\t\treturn {\n\t\t\trange: new NotebookRange(this.start, this.start + this.deletedCount),\n\t\t\taddedCells: this.items.map(cell => cell.apiCell),\n\t\t\tremovedCells: this.deletedItems,\n\t\t};\n\t}\n}\n\nexport class ExtHostCell {\n\n\tstatic asModelAddData(cell: extHostProtocol.NotebookCellDto): extHostProtocol.IModelAddedData {\n\t\treturn {\n\t\t\tEOL: cell.eol,\n\t\t\tlines: cell.source,\n\t\t\tlanguageId: cell.language,\n\t\t\turi: cell.uri,\n\t\t\tisDirty: false,\n\t\t\tversionId: 1,\n\t\t\tencoding: 'utf8'\n\t\t};\n\t}\n\n\tprivate _outputs: vscode.NotebookCellOutput[];\n\tprivate _metadata: Readonly<notebookCommon.NotebookCellMetadata>;\n\tprivate _previousResult: Readonly<vscode.NotebookCellExecutionSummary | undefined>;\n\n\tprivate _internalMetadata: notebookCommon.NotebookCellInternalMetadata;\n\treadonly handle: number;\n\treadonly uri: URI;\n\treadonly cellKind: notebookCommon.CellKind;\n\n\tprivate _apiCell: vscode.NotebookCell | undefined;\n\tprivate _mime: string | undefined;\n\n\tconstructor(\n\t\treadonly notebook: ExtHostNotebookDocument,\n\t\tprivate readonly _extHostDocument: ExtHostDocumentsAndEditors,\n\t\tprivate readonly _cellData: extHostProtocol.NotebookCellDto,\n\t) {\n\t\tthis.handle = _cellData.handle;\n\t\tthis.uri = URI.revive(_cellData.uri);\n\t\tthis.cellKind = _cellData.cellKind;\n\t\tthis._outputs = _cellData.outputs.map(extHostTypeConverters.NotebookCellOutput.to);\n\t\tthis._internalMetadata = _cellData.internalMetadata ?? {};\n\t\tthis._metadata = Object.freeze(_cellData.metadata ?? {});\n\t\tthis._previousResult = Object.freeze(extHostTypeConverters.NotebookCellExecutionSummary.to(_cellData.internalMetadata ?? {}));\n\t}\n\n\tget internalMetadata(): notebookCommon.NotebookCellInternalMetadata {\n\t\treturn this._internalMetadata;\n\t}\n\n\tget apiCell(): vscode.NotebookCell {\n\t\tif (!this._apiCell) {\n\t\t\tconst that = this;\n\t\t\tconst data = this._extHostDocument.getDocument(this.uri);\n\t\t\tif (!data) {\n\t\t\t\tthrow new Error(`MISSING extHostDocument for notebook cell: ${this.uri}`);\n\t\t\t}\n\t\t\tconst apiCell: vscode.NotebookCell = {\n\t\t\t\tget index() { return that.notebook.getCellIndex(that); },\n\t\t\t\tnotebook: that.notebook.apiNotebook,\n\t\t\t\tkind: extHostTypeConverters.NotebookCellKind.to(this._cellData.cellKind),\n\t\t\t\tdocument: data.document,\n\t\t\t\tget mime() { return that._mime; },\n\t\t\t\tset mime(value: string | undefined) { that._mime = value; },\n\t\t\t\tget outputs() { return that._outputs.slice(0); },\n\t\t\t\tget metadata() { return that._metadata; },\n\t\t\t\tget executionSummary() { return that._previousResult; }\n\t\t\t};\n\t\t\tthis._apiCell = Object.freeze(apiCell);\n\t\t}\n\t\treturn this._apiCell;\n\t}\n\n\tsetOutputs(newOutputs: extHostProtocol.NotebookOutputDto[]): void {\n\t\tthis._outputs = newOutputs.map(extHostTypeConverters.NotebookCellOutput.to);\n\t}\n\n\tsetOutputItems(outputId: string, append: boolean, newOutputItems: extHostProtocol.NotebookOutputItemDto[]) {\n\t\tconst newItems = newOutputItems.map(extHostTypeConverters.NotebookCellOutputItem.to);\n\t\tconst output = this._outputs.find(op => op.id === outputId);\n\t\tif (output) {\n\t\t\tif (!append) {\n\t\t\t\toutput.items.length = 0;\n\t\t\t}\n\t\t\toutput.items.push(...newItems);\n\n\t\t\tif (output.items.length > 1 && output.items.every(item => isTextStreamMime(item.mime))) {\n\t\t\t\t// Look for the mimes in the items, and keep track of their order.\n\t\t\t\t// Merge the streams into one output item, per mime type.\n\t\t\t\tconst mimeOutputs = new Map<string, Uint8Array[]>();\n\t\t\t\tconst mimeTypes: string[] = [];\n\t\t\t\toutput.items.forEach(item => {\n\t\t\t\t\tlet items: Uint8Array[];\n\t\t\t\t\tif (mimeOutputs.has(item.mime)) {\n\t\t\t\t\t\titems = mimeOutputs.get(item.mime)!;\n\t\t\t\t\t} else {\n\t\t\t\t\t\titems = [];\n\t\t\t\t\t\tmimeOutputs.set(item.mime, items);\n\t\t\t\t\t\tmimeTypes.push(item.mime);\n\t\t\t\t\t}\n\t\t\t\t\titems.push(item.data);\n\t\t\t\t});\n\t\t\t\toutput.items.length = 0;\n\t\t\t\tmimeTypes.forEach(mime => {\n\t\t\t\t\tconst compressed = notebookCommon.compressOutputItemStreams(mimeOutputs.get(mime)!);\n\t\t\t\t\toutput.items.push({\n\t\t\t\t\t\tmime,\n\t\t\t\t\t\tdata: compressed.data.buffer\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n\n\tsetMetadata(newMetadata: notebookCommon.NotebookCellMetadata): void {\n\t\tthis._metadata = Object.freeze(newMetadata);\n\t}\n\n\tsetInternalMetadata(newInternalMetadata: notebookCommon.NotebookCellInternalMetadata): void {\n\t\tthis._internalMetadata = newInternalMetadata;\n\t\tthis._previousResult = Object.freeze(extHostTypeConverters.NotebookCellExecutionSummary.to(newInternalMetadata));\n\t}\n\n\tsetMime(newMime: string | undefined) {\n\n\t}\n}\n\n\nexport class ExtHostNotebookDocument {\n\n\tprivate static _handlePool: number = 0;\n\treadonly handle = ExtHostNotebookDocument._handlePool++;\n\n\tprivate readonly _cells: ExtHostCell[] = [];\n\n\tprivate readonly _notebookType: string;\n\n\tprivate _notebook: vscode.NotebookDocument | undefined;\n\tprivate _metadata: Record<string, any>;\n\tprivate _versionId: number = 0;\n\tprivate _isDirty: boolean = false;\n\tprivate _disposed: boolean = false;\n\n\tconstructor(\n\t\tprivate readonly _proxy: extHostProtocol.MainThreadNotebookDocumentsShape,\n\t\tprivate readonly _textDocumentsAndEditors: ExtHostDocumentsAndEditors,\n\t\tprivate readonly _textDocuments: ExtHostDocuments,\n\t\treadonly uri: URI,\n\t\tdata: extHostProtocol.INotebookModelAddedData\n\t) {\n\t\tthis._notebookType = data.viewType;\n\t\tthis._metadata = Object.freeze(data.metadata ?? Object.create(null));\n\t\tthis._spliceNotebookCells([[0, 0, data.cells]], true /* init -> no event*/, undefined);\n\t\tthis._versionId = data.versionId;\n\t}\n\n\tdispose() {\n\t\tthis._disposed = true;\n\t}\n\n\tget versionId(): number {\n\t\treturn this._versionId;\n\t}\n\n\tget apiNotebook(): vscode.NotebookDocument {\n\t\tif (!this._notebook) {\n\t\t\tconst that = this;\n\t\t\tconst apiObject: vscode.NotebookDocument = {\n\t\t\t\tget uri() { return that.uri; },\n\t\t\t\tget version() { return that._versionId; },\n\t\t\t\tget notebookType() { return that._notebookType; },\n\t\t\t\tget isDirty() { return that._isDirty; },\n\t\t\t\tget isUntitled() { return that.uri.scheme === Schemas.untitled; },\n\t\t\t\tget isClosed() { return that._disposed; },\n\t\t\t\tget metadata() { return that._metadata; },\n\t\t\t\tget cellCount() { return that._cells.length; },\n\t\t\t\tcellAt(index) {\n\t\t\t\t\tindex = that._validateIndex(index);\n\t\t\t\t\treturn that._cells[index].apiCell;\n\t\t\t\t},\n\t\t\t\tgetCells(range) {\n\t\t\t\t\tconst cells = range ? that._getCells(range) : that._cells;\n\t\t\t\t\treturn cells.map(cell => cell.apiCell);\n\t\t\t\t},\n\t\t\t\tsave() {\n\t\t\t\t\treturn that._save();\n\t\t\t\t},\n\t\t\t\t[Symbol.for('debug.description')]() {\n\t\t\t\t\treturn `NotebookDocument(${this.uri.toString()})`;\n\t\t\t\t}\n\t\t\t};\n\t\t\tthis._notebook = Object.freeze(apiObject);\n\t\t}\n\t\treturn this._notebook;\n\t}\n\n\tacceptDocumentPropertiesChanged(data: extHostProtocol.INotebookDocumentPropertiesChangeData) {\n\t\tif (data.metadata) {\n\t\t\tthis._metadata = Object.freeze({ ...this._metadata, ...data.metadata });\n\t\t}\n\t}\n\n\tacceptDirty(isDirty: boolean): void {\n\t\tthis._isDirty = isDirty;\n\t}\n\n\tacceptModelChanged(event: extHostProtocol.NotebookCellsChangedEventDto, isDirty: boolean, newMetadata: notebookCommon.NotebookDocumentMetadata | undefined): vscode.NotebookDocumentChangeEvent {\n\t\tthis._versionId = event.versionId;\n\t\tthis._isDirty = isDirty;\n\t\tthis.acceptDocumentPropertiesChanged({ metadata: newMetadata });\n\n\t\tconst result = {\n\t\t\tnotebook: this.apiNotebook,\n\t\t\tmetadata: newMetadata,\n\t\t\tcellChanges: <vscode.NotebookDocumentCellChange[]>[],\n\t\t\tcontentChanges: <vscode.NotebookDocumentContentChange[]>[],\n\t\t};\n\n\t\ttype RelaxedCellChange = Partial<vscode.NotebookDocumentCellChange> & { cell: vscode.NotebookCell };\n\t\tconst relaxedCellChanges: RelaxedCellChange[] = [];\n\n\t\t// -- apply change and populate content changes\n\n\t\tfor (const rawEvent of event.rawEvents) {\n\t\t\tif (rawEvent.kind === notebookCommon.NotebookCellsChangeType.ModelChange) {\n\t\t\t\tthis._spliceNotebookCells(rawEvent.changes, false, result.contentChanges);\n\n\t\t\t} else if (rawEvent.kind === notebookCommon.NotebookCellsChangeType.Move) {\n\t\t\t\tthis._moveCells(rawEvent.index, rawEvent.length, rawEvent.newIdx, result.contentChanges);\n\n\t\t\t} else if (rawEvent.kind === notebookCommon.NotebookCellsChangeType.Output) {\n\t\t\t\tthis._setCellOutputs(rawEvent.index, rawEvent.outputs);\n\t\t\t\trelaxedCellChanges.push({ cell: this._cells[rawEvent.index].apiCell, outputs: this._cells[rawEvent.index].apiCell.outputs });\n\n\t\t\t} else if (rawEvent.kind === notebookCommon.NotebookCellsChangeType.OutputItem) {\n\t\t\t\tthis._setCellOutputItems(rawEvent.index, rawEvent.outputId, rawEvent.append, rawEvent.outputItems);\n\t\t\t\trelaxedCellChanges.push({ cell: this._cells[rawEvent.index].apiCell, outputs: this._cells[rawEvent.index].apiCell.outputs });\n\n\t\t\t} else if (rawEvent.kind === notebookCommon.NotebookCellsChangeType.ChangeCellLanguage) {\n\t\t\t\tthis._changeCellLanguage(rawEvent.index, rawEvent.language);\n\t\t\t\trelaxedCellChanges.push({ cell: this._cells[rawEvent.index].apiCell, document: this._cells[rawEvent.index].apiCell.document });\n\n\t\t\t} else if (rawEvent.kind === notebookCommon.NotebookCellsChangeType.ChangeCellContent) {\n\t\t\t\trelaxedCellChanges.push({ cell: this._cells[rawEvent.index].apiCell, document: this._cells[rawEvent.index].apiCell.document });\n\n\t\t\t} else if (rawEvent.kind === notebookCommon.NotebookCellsChangeType.ChangeCellMime) {\n\t\t\t\tthis._changeCellMime(rawEvent.index, rawEvent.mime);\n\t\t\t} else if (rawEvent.kind === notebookCommon.NotebookCellsChangeType.ChangeCellMetadata) {\n\t\t\t\tthis._changeCellMetadata(rawEvent.index, rawEvent.metadata);\n\t\t\t\trelaxedCellChanges.push({ cell: this._cells[rawEvent.index].apiCell, metadata: this._cells[rawEvent.index].apiCell.metadata });\n\n\t\t\t} else if (rawEvent.kind === notebookCommon.NotebookCellsChangeType.ChangeCellInternalMetadata) {\n\t\t\t\tthis._changeCellInternalMetadata(rawEvent.index, rawEvent.internalMetadata);\n\t\t\t\trelaxedCellChanges.push({ cell: this._cells[rawEvent.index].apiCell, executionSummary: this._cells[rawEvent.index].apiCell.executionSummary });\n\t\t\t}\n\t\t}\n\n\t\t// -- compact cellChanges\n\n\t\tconst map = new Map<vscode.NotebookCell, number>();\n\t\tfor (let i = 0; i < relaxedCellChanges.length; i++) {\n\t\t\tconst relaxedCellChange = relaxedCellChanges[i];\n\t\t\tconst existing = map.get(relaxedCellChange.cell);\n\t\t\tif (existing === undefined) {\n\t\t\t\tconst newLen = result.cellChanges.push({\n\t\t\t\t\tdocument: undefined,\n\t\t\t\t\texecutionSummary: undefined,\n\t\t\t\t\tmetadata: undefined,\n\t\t\t\t\toutputs: undefined,\n\t\t\t\t\t...relaxedCellChange,\n\t\t\t\t});\n\t\t\t\tmap.set(relaxedCellChange.cell, newLen - 1);\n\t\t\t} else {\n\t\t\t\tresult.cellChanges[existing] = {\n\t\t\t\t\t...result.cellChanges[existing],\n\t\t\t\t\t...relaxedCellChange\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\n\t\t// Freeze event properties so handlers cannot accidentally modify them\n\t\tObject.freeze(result);\n\t\tObject.freeze(result.cellChanges);\n\t\tObject.freeze(result.contentChanges);\n\n\t\treturn result;\n\t}\n\n\tprivate _validateIndex(index: number): number {\n\t\tindex = index | 0;\n\t\tif (index < 0) {\n\t\t\treturn 0;\n\t\t} else if (index >= this._cells.length) {\n\t\t\treturn this._cells.length - 1;\n\t\t} else {\n\t\t\treturn index;\n\t\t}\n\t}\n\n\tprivate _validateRange(range: vscode.NotebookRange): vscode.NotebookRange {\n\t\tlet start = range.start | 0;\n\t\tlet end = range.end | 0;\n\t\tif (start < 0) {\n\t\t\tstart = 0;\n\t\t}\n\t\tif (end > this._cells.length) {\n\t\t\tend = this._cells.length;\n\t\t}\n\t\treturn range.with({ start, end });\n\t}\n\n\tprivate _getCells(range: vscode.NotebookRange): ExtHostCell[] {\n\t\trange = this._validateRange(range);\n\t\tconst result: ExtHostCell[] = [];\n\t\tfor (let i = range.start; i < range.end; i++) {\n\t\t\tresult.push(this._cells[i]);\n\t\t}\n\t\treturn result;\n\t}\n\n\tprivate async _save(): Promise<boolean> {\n\t\tif (this._disposed) {\n\t\t\treturn Promise.reject(new Error('Notebook has been closed'));\n\t\t}\n\t\treturn this._proxy.$trySaveNotebook(this.uri);\n\t}\n\n\tprivate _spliceNotebookCells(splices: notebookCommon.NotebookCellTextModelSplice<extHostProtocol.NotebookCellDto>[], initialization: boolean, bucket: vscode.NotebookDocumentContentChange[] | undefined): void {\n\t\tif (this._disposed) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst contentChangeEvents: RawContentChangeEvent[] = [];\n\t\tconst addedCellDocuments: extHostProtocol.IModelAddedData[] = [];\n\t\tconst removedCellDocuments: URI[] = [];\n\n\t\tsplices.reverse().forEach(splice => {\n\t\t\tconst cellDtos = splice[2];\n\t\t\tconst newCells = cellDtos.map(cell => {\n\n\t\t\t\tconst extCell = new ExtHostCell(this, this._textDocumentsAndEditors, cell);\n\t\t\t\tif (!initialization) {\n\t\t\t\t\taddedCellDocuments.push(ExtHostCell.asModelAddData(cell));\n\t\t\t\t}\n\t\t\t\treturn extCell;\n\t\t\t});\n\n\t\t\tconst changeEvent = new RawContentChangeEvent(splice[0], splice[1], [], newCells);\n\t\t\tconst deletedItems = this._cells.splice(splice[0], splice[1], ...newCells);\n\t\t\tfor (const cell of deletedItems) {\n\t\t\t\tremovedCellDocuments.push(cell.uri);\n\t\t\t\tchangeEvent.deletedItems.push(cell.apiCell);\n\t\t\t}\n\t\t\tcontentChangeEvents.push(changeEvent);\n\t\t});\n\n\t\tthis._textDocumentsAndEditors.acceptDocumentsAndEditorsDelta({\n\t\t\taddedDocuments: addedCellDocuments,\n\t\t\tremovedDocuments: removedCellDocuments\n\t\t});\n\n\t\tif (bucket) {\n\t\t\tfor (const changeEvent of contentChangeEvents) {\n\t\t\t\tbucket.push(changeEvent.asApiEvent());\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate _moveCells(index: number, length: number, newIdx: number, bucket: vscode.NotebookDocumentContentChange[]): void {\n\t\tconst cells = this._cells.splice(index, length);\n\t\tthis._cells.splice(newIdx, 0, ...cells);\n\t\tconst changes = [\n\t\t\tnew RawContentChangeEvent(index, length, cells.map(c => c.apiCell), []),\n\t\t\tnew RawContentChangeEvent(newIdx, 0, [], cells)\n\t\t];\n\t\tfor (const change of changes) {\n\t\t\tbucket.push(change.asApiEvent());\n\t\t}\n\t}\n\n\tprivate _setCellOutputs(index: number, outputs: extHostProtocol.NotebookOutputDto[]): void {\n\t\tconst cell = this._cells[index];\n\t\tcell.setOutputs(outputs);\n\t}\n\n\tprivate _setCellOutputItems(index: number, outputId: string, append: boolean, outputItems: extHostProtocol.NotebookOutputItemDto[]): void {\n\t\tconst cell = this._cells[index];\n\t\tcell.setOutputItems(outputId, append, outputItems);\n\t}\n\n\tprivate _changeCellLanguage(index: number, newLanguageId: string): void {\n\t\tconst cell = this._cells[index];\n\t\tif (cell.apiCell.document.languageId !== newLanguageId) {\n\t\t\tthis._textDocuments.$acceptModelLanguageChanged(cell.uri, newLanguageId);\n\t\t}\n\t}\n\n\tprivate _changeCellMime(index: number, newMime: string | undefined): void {\n\t\tconst cell = this._cells[index];\n\t\tcell.apiCell.mime = newMime;\n\t}\n\n\tprivate _changeCellMetadata(index: number, newMetadata: notebookCommon.NotebookCellMetadata): void {\n\t\tconst cell = this._cells[index];\n\t\tcell.setMetadata(newMetadata);\n\t}\n\n\tprivate _changeCellInternalMetadata(index: number, newInternalMetadata: notebookCommon.NotebookCellInternalMetadata): void {\n\t\tconst cell = this._cells[index];\n\t\tcell.setInternalMetadata(newInternalMetadata);\n\t}\n\n\tgetCellFromApiCell(apiCell: vscode.NotebookCell): ExtHostCell | undefined {\n\t\treturn this._cells.find(cell => cell.apiCell === apiCell);\n\t}\n\n\tgetCellFromIndex(index: number): ExtHostCell | undefined {\n\t\treturn this._cells[index];\n\t}\n\n\tgetCell(cellHandle: number): ExtHostCell | undefined {\n\t\treturn this._cells.find(cell => cell.handle === cellHandle);\n\t}\n\n\tgetCellIndex(cell: ExtHostCell): number {\n\t\treturn this._cells.indexOf(cell);\n\t}\n}\n"]}