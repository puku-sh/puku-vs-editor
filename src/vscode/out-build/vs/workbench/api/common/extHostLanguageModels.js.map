{"version":3,"sources":["vs/workbench/api/common/extHostLanguageModels.ts"],"names":[],"mappings":"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","file":"extHostLanguageModels.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport type * as vscode from 'vscode';\nimport { AsyncIterableProducer, AsyncIterableSource, RunOnceScheduler } from '../../../base/common/async.js';\nimport { VSBuffer } from '../../../base/common/buffer.js';\nimport { CancellationToken } from '../../../base/common/cancellation.js';\nimport { SerializedError, transformErrorForSerialization, transformErrorFromSerialization } from '../../../base/common/errors.js';\nimport { Emitter, Event } from '../../../base/common/event.js';\nimport { Iterable } from '../../../base/common/iterator.js';\nimport { IDisposable, toDisposable } from '../../../base/common/lifecycle.js';\nimport { URI, UriComponents } from '../../../base/common/uri.js';\nimport { localize } from '../../../nls.js';\nimport { ExtensionIdentifier, ExtensionIdentifierMap, ExtensionIdentifierSet, IExtensionDescription } from '../../../platform/extensions/common/extensions.js';\nimport { createDecorator } from '../../../platform/instantiation/common/instantiation.js';\nimport { ILogService } from '../../../platform/log/common/log.js';\nimport { Progress } from '../../../platform/progress/common/progress.js';\nimport { IChatMessage, IChatResponsePart, ILanguageModelChatMetadata, ILanguageModelChatMetadataAndIdentifier } from '../../contrib/chat/common/languageModels.js';\nimport { DEFAULT_MODEL_PICKER_CATEGORY } from '../../contrib/chat/common/modelPicker/modelPickerWidget.js';\nimport { INTERNAL_AUTH_PROVIDER_PREFIX } from '../../services/authentication/common/authentication.js';\nimport { checkProposedApiEnabled, isProposedApiEnabled } from '../../services/extensions/common/extensions.js';\nimport { SerializableObjectWithBuffers } from '../../services/extensions/common/proxyIdentifier.js';\nimport { ExtHostLanguageModelsShape, MainContext, MainThreadLanguageModelsShape } from './extHost.protocol.js';\nimport { IExtHostAuthentication } from './extHostAuthentication.js';\nimport { IExtHostRpcService } from './extHostRpcService.js';\nimport * as typeConvert from './extHostTypeConverters.js';\nimport * as extHostTypes from './extHostTypes.js';\n\nexport interface IExtHostLanguageModels extends ExtHostLanguageModels { }\n\nexport const IExtHostLanguageModels = createDecorator<IExtHostLanguageModels>('IExtHostLanguageModels');\n\ntype LanguageModelProviderData = {\n\treadonly extension: IExtensionDescription;\n\treadonly provider: vscode.LanguageModelChatProvider;\n};\n\ntype LMResponsePart = vscode.LanguageModelTextPart | vscode.LanguageModelToolCallPart | vscode.LanguageModelDataPart | vscode.LanguageModelThinkingPart;\n\n\nclass LanguageModelResponse {\n\n\treadonly apiObject: vscode.LanguageModelChatResponse;\n\n\tprivate readonly _defaultStream = new AsyncIterableSource<LMResponsePart>();\n\tprivate _isDone: boolean = false;\n\n\tconstructor() {\n\n\t\tconst that = this;\n\n\t\tconst [stream1, stream2] = AsyncIterableProducer.tee(that._defaultStream.asyncIterable);\n\n\t\tthis.apiObject = {\n\t\t\t// result: promise,\n\t\t\tget stream() {\n\t\t\t\treturn stream1;\n\t\t\t},\n\t\t\tget text() {\n\t\t\t\treturn stream2.map(part => {\n\t\t\t\t\tif (part instanceof extHostTypes.LanguageModelTextPart) {\n\t\t\t\t\t\treturn part.value;\n\t\t\t\t\t} else {\n\t\t\t\t\t\treturn undefined;\n\t\t\t\t\t}\n\t\t\t\t}).coalesce();\n\t\t\t},\n\t\t};\n\t}\n\n\thandleResponsePart(parts: IChatResponsePart | IChatResponsePart[]): void {\n\t\tif (this._isDone) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst lmResponseParts: LMResponsePart[] = [];\n\n\t\tfor (const part of Iterable.wrap(parts)) {\n\n\t\t\tlet out: LMResponsePart;\n\t\t\tif (part.type === 'text') {\n\t\t\t\tout = new extHostTypes.LanguageModelTextPart(part.value, part.audience);\n\t\t\t} else if (part.type === 'thinking') {\n\t\t\t\tout = new extHostTypes.LanguageModelThinkingPart(part.value, part.id, part.metadata);\n\n\t\t\t} else if (part.type === 'data') {\n\t\t\t\tout = new extHostTypes.LanguageModelDataPart(part.data.buffer, part.mimeType, part.audience);\n\t\t\t} else {\n\t\t\t\tout = new extHostTypes.LanguageModelToolCallPart(part.toolCallId, part.name, part.parameters);\n\t\t\t}\n\t\t\tlmResponseParts.push(out);\n\t\t}\n\n\t\tthis._defaultStream.emitMany(lmResponseParts);\n\t}\n\n\treject(err: Error): void {\n\t\tthis._isDone = true;\n\t\tthis._defaultStream.reject(err);\n\t}\n\n\tresolve(): void {\n\t\tthis._isDone = true;\n\t\tthis._defaultStream.resolve();\n\t}\n}\n\nexport class ExtHostLanguageModels implements ExtHostLanguageModelsShape {\n\n\tdeclare _serviceBrand: undefined;\n\n\tprivate static _idPool = 1;\n\n\tprivate readonly _proxy: MainThreadLanguageModelsShape;\n\tprivate readonly _onDidChangeModelAccess = new Emitter<{ from: ExtensionIdentifier; to: ExtensionIdentifier }>();\n\tprivate readonly _onDidChangeProviders = new Emitter<void>();\n\treadonly onDidChangeProviders = this._onDidChangeProviders.event;\n\tprivate readonly _onDidChangeModelProxyAvailability = new Emitter<void>();\n\treadonly onDidChangeModelProxyAvailability = this._onDidChangeModelProxyAvailability.event;\n\n\tprivate readonly _languageModelProviders = new Map<string, LanguageModelProviderData>();\n\t// TODO @lramos15 - Remove the need for both info and metadata as it's a lot of redundancy. Should just need one\n\tprivate readonly _localModels = new Map<string, { metadata: ILanguageModelChatMetadata; info: vscode.LanguageModelChatInformation }>();\n\tprivate readonly _modelAccessList = new ExtensionIdentifierMap<ExtensionIdentifierSet>();\n\tprivate readonly _pendingRequest = new Map<number, { languageModelId: string; res: LanguageModelResponse }>();\n\tprivate readonly _ignoredFileProviders = new Map<number, vscode.LanguageModelIgnoredFileProvider>();\n\tprivate _languageModelProxyProvider: vscode.LanguageModelProxyProvider | undefined;\n\n\tconstructor(\n\t\t@IExtHostRpcService extHostRpc: IExtHostRpcService,\n\t\t@ILogService private readonly _logService: ILogService,\n\t\t@IExtHostAuthentication private readonly _extHostAuthentication: IExtHostAuthentication,\n\t) {\n\t\tthis._proxy = extHostRpc.getProxy(MainContext.MainThreadLanguageModels);\n\t}\n\n\tdispose(): void {\n\t\tthis._onDidChangeModelAccess.dispose();\n\t\tthis._onDidChangeProviders.dispose();\n\t\tthis._onDidChangeModelProxyAvailability.dispose();\n\t}\n\n\tregisterLanguageModelChatProvider(extension: IExtensionDescription, vendor: string, provider: vscode.LanguageModelChatProvider): IDisposable {\n\n\t\tthis._languageModelProviders.set(vendor, { extension: extension, provider });\n\t\tthis._proxy.$registerLanguageModelProvider(vendor);\n\n\t\tlet providerChangeEventDisposable: IDisposable | undefined;\n\t\tif (provider.onDidChangeLanguageModelChatInformation) {\n\t\t\tproviderChangeEventDisposable = provider.onDidChangeLanguageModelChatInformation(() => {\n\t\t\t\tthis._proxy.$onLMProviderChange(vendor);\n\t\t\t});\n\t\t}\n\n\t\treturn toDisposable(() => {\n\t\t\tthis._languageModelProviders.delete(vendor);\n\t\t\tthis._clearModelCache(vendor);\n\t\t\tproviderChangeEventDisposable?.dispose();\n\t\t\tthis._proxy.$unregisterProvider(vendor);\n\t\t});\n\t}\n\n\t// Helper function to clear the local cache for a specific vendor. There's no lookup, so this involves iterating over all models.\n\tprivate _clearModelCache(vendor: string): void {\n\t\tthis._localModels.forEach((value, key) => {\n\t\t\tif (value.metadata.vendor === vendor) {\n\t\t\t\tthis._localModels.delete(key);\n\t\t\t}\n\t\t});\n\t}\n\n\tasync $provideLanguageModelChatInfo(vendor: string, options: { silent: boolean }, token: CancellationToken): Promise<ILanguageModelChatMetadataAndIdentifier[]> {\n\t\tconst data = this._languageModelProviders.get(vendor);\n\t\tif (!data) {\n\t\t\treturn [];\n\t\t}\n\t\tconst modelInformation: vscode.LanguageModelChatInformation[] = await data.provider.provideLanguageModelChatInformation(options, token) ?? [];\n\t\tconst modelMetadataAndIdentifier: ILanguageModelChatMetadataAndIdentifier[] = modelInformation.map((m): ILanguageModelChatMetadataAndIdentifier => {\n\t\t\tlet auth;\n\t\t\tif (m.requiresAuthorization && isProposedApiEnabled(data.extension, 'chatProvider')) {\n\t\t\t\tauth = {\n\t\t\t\t\tproviderLabel: data.extension.displayName || data.extension.name,\n\t\t\t\t\taccountLabel: typeof m.requiresAuthorization === 'object' ? m.requiresAuthorization.label : undefined\n\t\t\t\t};\n\t\t\t}\n\t\t\tif (m.capabilities.editTools) {\n\t\t\t\tcheckProposedApiEnabled(data.extension, 'chatProvider');\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\tmetadata: {\n\t\t\t\t\textension: data.extension.identifier,\n\t\t\t\t\tid: m.id,\n\t\t\t\t\tvendor,\n\t\t\t\t\tname: m.name ?? '',\n\t\t\t\t\tfamily: m.family ?? '',\n\t\t\t\t\tdetail: m.detail,\n\t\t\t\t\ttooltip: m.tooltip,\n\t\t\t\t\tversion: m.version,\n\t\t\t\t\tmaxInputTokens: m.maxInputTokens,\n\t\t\t\t\tmaxOutputTokens: m.maxOutputTokens,\n\t\t\t\t\tauth,\n\t\t\t\t\tisDefault: m.isDefault,\n\t\t\t\t\tisUserSelectable: m.isUserSelectable,\n\t\t\t\t\tstatusIcon: m.statusIcon,\n\t\t\t\t\tmodelPickerCategory: m.category ?? DEFAULT_MODEL_PICKER_CATEGORY,\n\t\t\t\t\tcapabilities: m.capabilities ? {\n\t\t\t\t\t\tvision: m.capabilities.imageInput,\n\t\t\t\t\t\teditTools: m.capabilities.editTools,\n\t\t\t\t\t\ttoolCalling: !!m.capabilities.toolCalling,\n\t\t\t\t\t\tagentMode: !!m.capabilities.toolCalling\n\t\t\t\t\t} : undefined,\n\t\t\t\t},\n\t\t\t\tidentifier: `${vendor}/${m.id}`,\n\t\t\t};\n\t\t});\n\n\t\tthis._clearModelCache(vendor);\n\t\tfor (let i = 0; i < modelMetadataAndIdentifier.length; i++) {\n\t\t\tthis._localModels.set(modelMetadataAndIdentifier[i].identifier, {\n\t\t\t\tmetadata: modelMetadataAndIdentifier[i].metadata,\n\t\t\t\tinfo: modelInformation[i]\n\t\t\t});\n\t\t}\n\n\t\treturn modelMetadataAndIdentifier;\n\t}\n\n\tasync $startChatRequest(modelId: string, requestId: number, from: ExtensionIdentifier, messages: SerializableObjectWithBuffers<IChatMessage[]>, options: vscode.LanguageModelChatRequestOptions, token: CancellationToken): Promise<void> {\n\t\tconst knownModel = this._localModels.get(modelId);\n\t\tif (!knownModel) {\n\t\t\tthrow new Error('Model not found');\n\t\t}\n\n\t\tconst data = this._languageModelProviders.get(knownModel.metadata.vendor);\n\t\tif (!data) {\n\t\t\tthrow new Error(`Language model provider for '${knownModel.metadata.id}' not found.`);\n\t\t}\n\n\t\tconst queue: IChatResponsePart[] = [];\n\t\tconst sendNow = () => {\n\t\t\tif (queue.length > 0) {\n\t\t\t\tthis._proxy.$reportResponsePart(requestId, new SerializableObjectWithBuffers(queue));\n\t\t\t\tqueue.length = 0;\n\t\t\t}\n\t\t};\n\t\tconst queueScheduler = new RunOnceScheduler(sendNow, 30);\n\t\tconst sendSoon = (part: IChatResponsePart) => {\n\t\t\tconst newLen = queue.push(part);\n\t\t\t// flush/send if things pile up more than expected\n\t\t\tif (newLen > 30) {\n\t\t\t\tsendNow();\n\t\t\t\tqueueScheduler.cancel();\n\t\t\t} else {\n\t\t\t\tqueueScheduler.schedule();\n\t\t\t}\n\t\t};\n\n\t\tconst progress = new Progress<vscode.LanguageModelTextPart | vscode.LanguageModelToolCallPart | vscode.LanguageModelDataPart | vscode.LanguageModelThinkingPart>(async fragment => {\n\t\t\tif (token.isCancellationRequested) {\n\t\t\t\tthis._logService.warn(`[CHAT](${data.extension.identifier.value}) CANNOT send progress because the REQUEST IS CANCELLED`);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tlet part: IChatResponsePart | undefined;\n\t\t\tif (fragment instanceof extHostTypes.LanguageModelToolCallPart) {\n\t\t\t\tpart = { type: 'tool_use', name: fragment.name, parameters: fragment.input, toolCallId: fragment.callId };\n\t\t\t} else if (fragment instanceof extHostTypes.LanguageModelTextPart) {\n\t\t\t\tpart = { type: 'text', value: fragment.value, audience: fragment.audience };\n\t\t\t} else if (fragment instanceof extHostTypes.LanguageModelDataPart) {\n\t\t\t\tpart = { type: 'data', mimeType: fragment.mimeType, data: VSBuffer.wrap(fragment.data), audience: fragment.audience };\n\t\t\t} else if (fragment instanceof extHostTypes.LanguageModelThinkingPart) {\n\t\t\t\tpart = { type: 'thinking', value: fragment.value, id: fragment.id, metadata: fragment.metadata };\n\t\t\t}\n\n\t\t\tif (!part) {\n\t\t\t\tthis._logService.warn(`[CHAT](${data.extension.identifier.value}) UNKNOWN part ${JSON.stringify(fragment)}`);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tsendSoon(part);\n\t\t});\n\n\t\tlet value: unknown;\n\n\t\ttry {\n\t\t\tvalue = data.provider.provideLanguageModelChatResponse(\n\t\t\t\tknownModel.info,\n\t\t\t\tmessages.value.map(typeConvert.LanguageModelChatMessage2.to),\n\t\t\t\t{ ...options, modelOptions: options.modelOptions ?? {}, requestInitiator: ExtensionIdentifier.toKey(from), toolMode: options.toolMode ?? extHostTypes.LanguageModelChatToolMode.Auto },\n\t\t\t\tprogress,\n\t\t\t\ttoken\n\t\t\t);\n\n\t\t} catch (err) {\n\t\t\t// synchronously failed\n\t\t\tthrow err;\n\t\t}\n\n\t\tPromise.resolve(value).then(() => {\n\t\t\tsendNow();\n\t\t\tthis._proxy.$reportResponseDone(requestId, undefined);\n\t\t}, err => {\n\t\t\tsendNow();\n\t\t\tthis._proxy.$reportResponseDone(requestId, transformErrorForSerialization(err));\n\t\t});\n\t}\n\n\t//#region --- token counting\n\n\t$provideTokenLength(modelId: string, value: string, token: CancellationToken): Promise<number> {\n\t\tconst knownModel = this._localModels.get(modelId);\n\t\tif (!knownModel) {\n\t\t\treturn Promise.resolve(0);\n\t\t}\n\t\tconst data = this._languageModelProviders.get(knownModel.metadata.vendor);\n\t\tif (!data) {\n\t\t\treturn Promise.resolve(0);\n\t\t}\n\t\treturn Promise.resolve(data.provider.provideTokenCount(knownModel.info, value, token));\n\t}\n\n\n\t//#region --- making request\n\n\tasync getDefaultLanguageModel(extension: IExtensionDescription, forceResolveModels?: boolean): Promise<vscode.LanguageModelChat | undefined> {\n\t\tlet defaultModelId: string | undefined;\n\n\t\tif (forceResolveModels) {\n\t\t\tawait this.selectLanguageModels(extension, {});\n\t\t}\n\n\t\tfor (const [modelIdentifier, modelData] of this._localModels) {\n\t\t\tif (modelData.metadata.isDefault) {\n\t\t\t\tdefaultModelId = modelIdentifier;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\tif (!defaultModelId && !forceResolveModels) {\n\t\t\t// Maybe the default wasn't cached so we will try again with resolving the models too\n\t\t\treturn this.getDefaultLanguageModel(extension, true);\n\t\t}\n\t\treturn this.getLanguageModelByIdentifier(extension, defaultModelId);\n\t}\n\n\tasync getLanguageModelByIdentifier(extension: IExtensionDescription, modelId: string | undefined): Promise<vscode.LanguageModelChat | undefined> {\n\t\tif (!modelId) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\tconst model = this._localModels.get(modelId);\n\t\tif (!model) {\n\t\t\t// model gone? is this an error on us? Try to resolve model again\n\t\t\treturn (await this.selectLanguageModels(extension, { id: modelId }))[0];\n\t\t}\n\n\t\t// make sure auth information is correct\n\t\tif (this._isUsingAuth(extension.identifier, model.metadata)) {\n\t\t\tawait this._fakeAuthPopulate(model.metadata);\n\t\t}\n\n\t\tlet apiObject: vscode.LanguageModelChat | undefined;\n\t\tif (!apiObject) {\n\t\t\tconst that = this;\n\t\t\tapiObject = {\n\t\t\t\tid: model.info.id,\n\t\t\t\tvendor: model.metadata.vendor,\n\t\t\t\tfamily: model.info.family,\n\t\t\t\tversion: model.info.version,\n\t\t\t\tname: model.info.name,\n\t\t\t\tcapabilities: {\n\t\t\t\t\tsupportsImageToText: model.metadata.capabilities?.vision ?? false,\n\t\t\t\t\tsupportsToolCalling: !!model.metadata.capabilities?.toolCalling,\n\t\t\t\t\teditToolsHint: model.metadata.capabilities?.editTools,\n\t\t\t\t},\n\t\t\t\tmaxInputTokens: model.metadata.maxInputTokens,\n\t\t\t\tcountTokens(text, token) {\n\t\t\t\t\tif (!that._localModels.has(modelId)) {\n\t\t\t\t\t\tthrow extHostTypes.LanguageModelError.NotFound(modelId);\n\t\t\t\t\t}\n\t\t\t\t\treturn that._computeTokenLength(modelId, text, token ?? CancellationToken.None);\n\t\t\t\t},\n\t\t\t\tsendRequest(messages, options, token) {\n\t\t\t\t\tif (!that._localModels.has(modelId)) {\n\t\t\t\t\t\tthrow extHostTypes.LanguageModelError.NotFound(modelId);\n\t\t\t\t\t}\n\t\t\t\t\treturn that._sendChatRequest(extension, modelId, messages, options ?? {}, token ?? CancellationToken.None);\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tObject.freeze(apiObject);\n\t\t}\n\n\t\treturn apiObject;\n\t}\n\n\tasync selectLanguageModels(extension: IExtensionDescription, selector: vscode.LanguageModelChatSelector) {\n\n\t\t// this triggers extension activation\n\t\tconst models = await this._proxy.$selectChatModels({ ...selector, extension: extension.identifier });\n\n\t\tconst result: vscode.LanguageModelChat[] = [];\n\n\t\tconst modelPromises = models.map(identifier => this.getLanguageModelByIdentifier(extension, identifier));\n\t\tconst modelResults = await Promise.all(modelPromises);\n\t\tfor (const model of modelResults) {\n\t\t\tif (model) {\n\t\t\t\tresult.push(model);\n\t\t\t}\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tprivate async _sendChatRequest(extension: IExtensionDescription, languageModelId: string, messages: vscode.LanguageModelChatMessage2[], options: vscode.LanguageModelChatRequestOptions, token: CancellationToken) {\n\n\t\tconst internalMessages: IChatMessage[] = this._convertMessages(extension, messages);\n\n\t\tconst from = extension.identifier;\n\t\tconst metadata = this._localModels.get(languageModelId)?.metadata;\n\n\t\tif (!metadata || !this._localModels.has(languageModelId)) {\n\t\t\tthrow extHostTypes.LanguageModelError.NotFound(`Language model '${languageModelId}' is unknown.`);\n\t\t}\n\n\t\tif (this._isUsingAuth(from, metadata)) {\n\t\t\tconst success = await this._getAuthAccess(extension, { identifier: metadata.extension, displayName: metadata.auth.providerLabel }, options.justification, false);\n\n\t\t\tif (!success || !this._modelAccessList.get(from)?.has(metadata.extension)) {\n\t\t\t\tthrow extHostTypes.LanguageModelError.NoPermissions(`Language model '${languageModelId}' cannot be used by '${from.value}'.`);\n\t\t\t}\n\t\t}\n\n\t\tconst requestId = (Math.random() * 1e6) | 0;\n\t\tconst res = new LanguageModelResponse();\n\t\tthis._pendingRequest.set(requestId, { languageModelId, res });\n\n\t\ttry {\n\t\t\tawait this._proxy.$tryStartChatRequest(from, languageModelId, requestId, new SerializableObjectWithBuffers(internalMessages), options, token);\n\n\t\t} catch (error) {\n\t\t\t// error'ing here means that the request could NOT be started/made, e.g. wrong model, no access, etc, but\n\t\t\t// later the response can fail as well. Those failures are communicated via the stream-object\n\t\t\tthis._pendingRequest.delete(requestId);\n\t\t\tthrow extHostTypes.LanguageModelError.tryDeserialize(error) ?? error;\n\t\t}\n\n\t\treturn res.apiObject;\n\t}\n\n\tprivate _convertMessages(extension: IExtensionDescription, messages: vscode.LanguageModelChatMessage2[]) {\n\t\tconst internalMessages: IChatMessage[] = [];\n\t\tfor (const message of messages) {\n\t\t\tif (message.role as number === extHostTypes.LanguageModelChatMessageRole.System) {\n\t\t\t\tcheckProposedApiEnabled(extension, 'languageModelSystem');\n\t\t\t}\n\t\t\tinternalMessages.push(typeConvert.LanguageModelChatMessage2.from(message));\n\t\t}\n\t\treturn internalMessages;\n\t}\n\n\tasync $acceptResponsePart(requestId: number, chunk: SerializableObjectWithBuffers<IChatResponsePart | IChatResponsePart[]>): Promise<void> {\n\t\tconst data = this._pendingRequest.get(requestId);\n\t\tif (data) {\n\t\t\tdata.res.handleResponsePart(chunk.value);\n\t\t}\n\t}\n\n\tasync $acceptResponseDone(requestId: number, error: SerializedError | undefined): Promise<void> {\n\t\tconst data = this._pendingRequest.get(requestId);\n\t\tif (!data) {\n\t\t\treturn;\n\t\t}\n\t\tthis._pendingRequest.delete(requestId);\n\t\tif (error) {\n\t\t\t// we error the stream because that's the only way to signal\n\t\t\t// that the request has failed\n\t\t\tdata.res.reject(extHostTypes.LanguageModelError.tryDeserialize(error) ?? transformErrorFromSerialization(error));\n\t\t} else {\n\t\t\tdata.res.resolve();\n\t\t}\n\t}\n\n\t// BIG HACK: Using AuthenticationProviders to check access to Language Models\n\tprivate async _getAuthAccess(from: IExtensionDescription, to: { identifier: ExtensionIdentifier; displayName: string }, justification: string | undefined, silent: boolean | undefined): Promise<boolean> {\n\t\t// This needs to be done in both MainThread & ExtHost ChatProvider\n\t\tconst providerId = INTERNAL_AUTH_PROVIDER_PREFIX + to.identifier.value;\n\t\tconst session = await this._extHostAuthentication.getSession(from, providerId, [], { silent: true });\n\n\t\tif (session) {\n\t\t\tthis.$updateModelAccesslist([{ from: from.identifier, to: to.identifier, enabled: true }]);\n\t\t\treturn true;\n\t\t}\n\n\t\tif (silent) {\n\t\t\treturn false;\n\t\t}\n\n\t\ttry {\n\t\t\tconst detail = justification\n\t\t\t\t? localize('chatAccessWithJustification', \"Justification: {1}\", to.displayName, justification)\n\t\t\t\t: undefined;\n\t\t\tawait this._extHostAuthentication.getSession(from, providerId, [], { forceNewSession: { detail } });\n\t\t\tthis.$updateModelAccesslist([{ from: from.identifier, to: to.identifier, enabled: true }]);\n\t\t\treturn true;\n\n\t\t} catch (err) {\n\t\t\t// ignore\n\t\t\treturn false;\n\t\t}\n\t}\n\n\tprivate _isUsingAuth(from: ExtensionIdentifier, toMetadata: ILanguageModelChatMetadata): toMetadata is ILanguageModelChatMetadata & { auth: NonNullable<ILanguageModelChatMetadata['auth']> } {\n\t\t// If the 'to' extension uses an auth check\n\t\treturn !!toMetadata.auth\n\t\t\t// And we're asking from a different extension\n\t\t\t&& !ExtensionIdentifier.equals(toMetadata.extension, from);\n\t}\n\n\tprivate async _fakeAuthPopulate(metadata: ILanguageModelChatMetadata): Promise<void> {\n\n\t\tif (!metadata.auth) {\n\t\t\treturn;\n\t\t}\n\n\t\tfor (const from of this._languageAccessInformationExtensions) {\n\t\t\ttry {\n\t\t\t\tawait this._getAuthAccess(from, { identifier: metadata.extension, displayName: '' }, undefined, true);\n\t\t\t} catch (err) {\n\t\t\t\tthis._logService.error('Fake Auth request failed');\n\t\t\t\tthis._logService.error(err);\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate async _computeTokenLength(modelId: string, value: string | vscode.LanguageModelChatMessage2, token: vscode.CancellationToken): Promise<number> {\n\n\t\tconst data = this._localModels.get(modelId);\n\t\tif (!data) {\n\t\t\tthrow extHostTypes.LanguageModelError.NotFound(`Language model '${modelId}' is unknown.`);\n\t\t}\n\t\treturn this._languageModelProviders.get(data.metadata.vendor)?.provider.provideTokenCount(data.info, value, token) ?? 0;\n\t\t// return this._proxy.$countTokens(languageModelId, (typeof value === 'string' ? value : typeConvert.LanguageModelChatMessage2.from(value)), token);\n\t}\n\n\t$updateModelAccesslist(data: { from: ExtensionIdentifier; to: ExtensionIdentifier; enabled: boolean }[]): void {\n\t\tconst updated = new Array<{ from: ExtensionIdentifier; to: ExtensionIdentifier }>();\n\t\tfor (const { from, to, enabled } of data) {\n\t\t\tconst set = this._modelAccessList.get(from) ?? new ExtensionIdentifierSet();\n\t\t\tconst oldValue = set.has(to);\n\t\t\tif (oldValue !== enabled) {\n\t\t\t\tif (enabled) {\n\t\t\t\t\tset.add(to);\n\t\t\t\t} else {\n\t\t\t\t\tset.delete(to);\n\t\t\t\t}\n\t\t\t\tthis._modelAccessList.set(from, set);\n\t\t\t\tconst newItem = { from, to };\n\t\t\t\tupdated.push(newItem);\n\t\t\t\tthis._onDidChangeModelAccess.fire(newItem);\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate readonly _languageAccessInformationExtensions = new Set<Readonly<IExtensionDescription>>();\n\n\tcreateLanguageModelAccessInformation(from: Readonly<IExtensionDescription>): vscode.LanguageModelAccessInformation {\n\n\t\tthis._languageAccessInformationExtensions.add(from);\n\n\t\t// const that = this;\n\t\tconst _onDidChangeAccess = Event.signal(Event.filter(this._onDidChangeModelAccess.event, e => ExtensionIdentifier.equals(e.from, from.identifier)));\n\t\tconst _onDidAddRemove = Event.signal(this._onDidChangeProviders.event);\n\n\t\treturn {\n\t\t\tget onDidChange() {\n\t\t\t\treturn Event.any(_onDidChangeAccess, _onDidAddRemove);\n\t\t\t},\n\t\t\tcanSendRequest(chat: vscode.LanguageModelChat): boolean | undefined {\n\t\t\t\treturn true;\n\t\t\t\t// TODO @lramos15 - Fix\n\n\t\t\t\t// let metadata: ILanguageModelChatMetadata | undefined;\n\n\t\t\t\t// out: for (const [_, value] of that._allLanguageModelData) {\n\t\t\t\t// \tfor (const candidate of value.apiObjects.values()) {\n\t\t\t\t// \t\tif (candidate === chat) {\n\t\t\t\t// \t\t\tmetadata = value.metadata;\n\t\t\t\t// \t\t\tbreak out;\n\t\t\t\t// \t\t}\n\t\t\t\t// \t}\n\t\t\t\t// }\n\t\t\t\t// if (!metadata) {\n\t\t\t\t// \treturn undefined;\n\t\t\t\t// }\n\t\t\t\t// if (!that._isUsingAuth(from.identifier, metadata)) {\n\t\t\t\t// \treturn true;\n\t\t\t\t// }\n\n\t\t\t\t// const list = that._modelAccessList.get(from.identifier);\n\t\t\t\t// if (!list) {\n\t\t\t\t// \treturn undefined;\n\t\t\t\t// }\n\t\t\t\t// return list.has(metadata.extension);\n\t\t\t}\n\t\t};\n\t}\n\n\tfileIsIgnored(extension: IExtensionDescription, uri: vscode.Uri, token: vscode.CancellationToken = CancellationToken.None): Promise<boolean> {\n\t\tcheckProposedApiEnabled(extension, 'chatParticipantAdditions');\n\n\t\treturn this._proxy.$fileIsIgnored(uri, token);\n\t}\n\n\tget isModelProxyAvailable(): boolean {\n\t\treturn !!this._languageModelProxyProvider;\n\t}\n\n\tasync getModelProxy(extension: IExtensionDescription): Promise<vscode.LanguageModelProxy> {\n\t\tcheckProposedApiEnabled(extension, 'languageModelProxy');\n\n\t\tif (!this._languageModelProxyProvider) {\n\t\t\tthis._logService.trace('[LanguageModelProxy] No LanguageModelProxyProvider registered');\n\t\t\tthrow new Error('No language model proxy provider is registered.');\n\t\t}\n\n\t\tconst requestingExtensionId = ExtensionIdentifier.toKey(extension.identifier);\n\t\ttry {\n\t\t\tconst result = await Promise.resolve(this._languageModelProxyProvider.provideModelProxy(requestingExtensionId, CancellationToken.None));\n\t\t\tif (!result) {\n\t\t\t\tthis._logService.warn(`[LanguageModelProxy] Provider returned no proxy for ${requestingExtensionId}`);\n\t\t\t\tthrow new Error('Language model proxy is not available.');\n\t\t\t}\n\t\t\treturn result;\n\t\t} catch (err) {\n\t\t\tthis._logService.error(`[LanguageModelProxy] Provider failed to return proxy for ${requestingExtensionId}`, err);\n\t\t\tthrow err;\n\t\t}\n\t}\n\n\tasync $isFileIgnored(handle: number, uri: UriComponents, token: CancellationToken): Promise<boolean> {\n\t\tconst provider = this._ignoredFileProviders.get(handle);\n\t\tif (!provider) {\n\t\t\tthrow new Error('Unknown LanguageModelIgnoredFileProvider');\n\t\t}\n\n\t\treturn (await provider.provideFileIgnored(URI.revive(uri), token)) ?? false;\n\t}\n\n\tregisterIgnoredFileProvider(extension: IExtensionDescription, provider: vscode.LanguageModelIgnoredFileProvider): vscode.Disposable {\n\t\tcheckProposedApiEnabled(extension, 'chatParticipantPrivate');\n\n\t\tconst handle = ExtHostLanguageModels._idPool++;\n\t\tthis._proxy.$registerFileIgnoreProvider(handle);\n\t\tthis._ignoredFileProviders.set(handle, provider);\n\t\treturn toDisposable(() => {\n\t\t\tthis._proxy.$unregisterFileIgnoreProvider(handle);\n\t\t\tthis._ignoredFileProviders.delete(handle);\n\t\t});\n\t}\n\n\tregisterLanguageModelProxyProvider(extension: IExtensionDescription, provider: vscode.LanguageModelProxyProvider): vscode.Disposable {\n\t\tcheckProposedApiEnabled(extension, 'chatParticipantPrivate');\n\n\t\tthis._languageModelProxyProvider = provider;\n\t\tthis._onDidChangeModelProxyAvailability.fire();\n\t\treturn toDisposable(() => {\n\t\t\tif (this._languageModelProxyProvider === provider) {\n\t\t\t\tthis._languageModelProxyProvider = undefined;\n\t\t\t\tthis._onDidChangeModelProxyAvailability.fire();\n\t\t\t}\n\t\t});\n\t}\n}\n"]}