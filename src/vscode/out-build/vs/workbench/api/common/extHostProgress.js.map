{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/api/common/extHostProgress.ts","vs/workbench/api/common/extHostProgress.ts"],"names":[],"mappings":"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","file":"extHostProgress.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { ProgressOptions } from 'vscode';\nimport { MainThreadProgressShape, ExtHostProgressShape, MainContext } from './extHost.protocol.js';\nimport { ProgressLocation } from './extHostTypeConverters.js';\nimport { Progress, IProgressStep } from '../../../platform/progress/common/progress.js';\nimport { CancellationTokenSource, CancellationToken } from '../../../base/common/cancellation.js';\nimport { throttle } from '../../../base/common/decorators.js';\nimport { IExtensionDescription } from '../../../platform/extensions/common/extensions.js';\nimport { onUnexpectedExternalError } from '../../../base/common/errors.js';\nimport { INotificationSource } from '../../../platform/notification/common/notification.js';\nimport { createDecorator } from '../../../platform/instantiation/common/instantiation.js';\nimport { IExtHostRpcService } from './extHostRpcService.js';\n\nexport interface IExtHostProgress extends ExtHostProgress { }\nexport const IExtHostProgress = createDecorator<IExtHostProgress>('IExtHostProgress');\n\nexport class ExtHostProgress implements ExtHostProgressShape {\n\n\tdeclare readonly _serviceBrand: undefined;\n\n\tprivate _proxy: MainThreadProgressShape;\n\tprivate _handles: number = 0;\n\tprivate _mapHandleToCancellationSource: Map<number, CancellationTokenSource> = new Map();\n\n\tconstructor(@IExtHostRpcService extHostRpc: IExtHostRpcService) {\n\t\tthis._proxy = extHostRpc.getProxy(MainContext.MainThreadProgress);\n\t}\n\n\tasync withProgress<R>(extension: IExtensionDescription, options: ProgressOptions, task: (progress: Progress<IProgressStep>, token: CancellationToken) => Thenable<R>): Promise<R> {\n\t\tconst handle = this._handles++;\n\t\tconst { title, location, cancellable } = options;\n\t\tconst source = { label: extension.displayName || extension.name, id: extension.identifier.value };\n\n\t\tthis._proxy.$startProgress(handle, { location: ProgressLocation.from(location), title, source, cancellable }, !extension.isUnderDevelopment ? extension.identifier.value : undefined).catch(onUnexpectedExternalError);\n\t\treturn this._withProgress(handle, task, !!cancellable);\n\t}\n\n\tasync withProgressFromSource<R>(source: string | INotificationSource, options: ProgressOptions, task: (progress: Progress<IProgressStep>, token: CancellationToken) => Thenable<R>): Promise<R> {\n\t\tconst handle = this._handles++;\n\t\tconst { title, location, cancellable } = options;\n\n\t\tthis._proxy.$startProgress(handle, { location: ProgressLocation.from(location), title, source, cancellable }, undefined).catch(onUnexpectedExternalError);\n\t\treturn this._withProgress(handle, task, !!cancellable);\n\t}\n\n\tprivate _withProgress<R>(handle: number, task: (progress: Progress<IProgressStep>, token: CancellationToken) => Thenable<R>, cancellable: boolean): Thenable<R> {\n\t\tlet source: CancellationTokenSource | undefined;\n\t\tif (cancellable) {\n\t\t\tsource = new CancellationTokenSource();\n\t\t\tthis._mapHandleToCancellationSource.set(handle, source);\n\t\t}\n\n\t\tconst progressEnd = (handle: number): void => {\n\t\t\tthis._proxy.$progressEnd(handle);\n\t\t\tthis._mapHandleToCancellationSource.delete(handle);\n\t\t\tsource?.dispose();\n\t\t};\n\n\t\tlet p: Thenable<R>;\n\n\t\ttry {\n\t\t\tp = task(new ProgressCallback(this._proxy, handle), cancellable && source ? source.token : CancellationToken.None);\n\t\t} catch (err) {\n\t\t\tprogressEnd(handle);\n\t\t\tthrow err;\n\t\t}\n\n\t\tp.then(result => progressEnd(handle), err => progressEnd(handle));\n\t\treturn p;\n\t}\n\n\tpublic $acceptProgressCanceled(handle: number): void {\n\t\tconst source = this._mapHandleToCancellationSource.get(handle);\n\t\tif (source) {\n\t\t\tsource.cancel();\n\t\t\tthis._mapHandleToCancellationSource.delete(handle);\n\t\t}\n\t}\n}\n\nfunction mergeProgress(result: IProgressStep, currentValue: IProgressStep): IProgressStep {\n\tresult.message = currentValue.message;\n\tif (typeof currentValue.increment === 'number') {\n\t\tif (typeof result.increment === 'number') {\n\t\t\tresult.increment += currentValue.increment;\n\t\t} else {\n\t\t\tresult.increment = currentValue.increment;\n\t\t}\n\t}\n\n\treturn result;\n}\n\nclass ProgressCallback extends Progress<IProgressStep> {\n\tconstructor(private _proxy: MainThreadProgressShape, private _handle: number) {\n\t\tsuper(p => this.throttledReport(p));\n\t}\n\n\t@throttle(100, (result: IProgressStep, currentValue: IProgressStep) => mergeProgress(result, currentValue), () => Object.create(null))\n\tthrottledReport(p: IProgressStep): void {\n\t\tthis._proxy.$progressReport(this._handle, p);\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { ProgressOptions } from 'vscode';\nimport { MainThreadProgressShape, ExtHostProgressShape, MainContext } from './extHost.protocol.js';\nimport { ProgressLocation } from './extHostTypeConverters.js';\nimport { Progress, IProgressStep } from '../../../platform/progress/common/progress.js';\nimport { CancellationTokenSource, CancellationToken } from '../../../base/common/cancellation.js';\nimport { throttle } from '../../../base/common/decorators.js';\nimport { IExtensionDescription } from '../../../platform/extensions/common/extensions.js';\nimport { onUnexpectedExternalError } from '../../../base/common/errors.js';\nimport { INotificationSource } from '../../../platform/notification/common/notification.js';\nimport { createDecorator } from '../../../platform/instantiation/common/instantiation.js';\nimport { IExtHostRpcService } from './extHostRpcService.js';\n\nexport interface IExtHostProgress extends ExtHostProgress { }\nexport const IExtHostProgress = createDecorator<IExtHostProgress>('IExtHostProgress');\n\nexport class ExtHostProgress implements ExtHostProgressShape {\n\n\tdeclare readonly _serviceBrand: undefined;\n\n\tprivate _proxy: MainThreadProgressShape;\n\tprivate _handles: number = 0;\n\tprivate _mapHandleToCancellationSource: Map<number, CancellationTokenSource> = new Map();\n\n\tconstructor(@IExtHostRpcService extHostRpc: IExtHostRpcService) {\n\t\tthis._proxy = extHostRpc.getProxy(MainContext.MainThreadProgress);\n\t}\n\n\tasync withProgress<R>(extension: IExtensionDescription, options: ProgressOptions, task: (progress: Progress<IProgressStep>, token: CancellationToken) => Thenable<R>): Promise<R> {\n\t\tconst handle = this._handles++;\n\t\tconst { title, location, cancellable } = options;\n\t\tconst source = { label: extension.displayName || extension.name, id: extension.identifier.value };\n\n\t\tthis._proxy.$startProgress(handle, { location: ProgressLocation.from(location), title, source, cancellable }, !extension.isUnderDevelopment ? extension.identifier.value : undefined).catch(onUnexpectedExternalError);\n\t\treturn this._withProgress(handle, task, !!cancellable);\n\t}\n\n\tasync withProgressFromSource<R>(source: string | INotificationSource, options: ProgressOptions, task: (progress: Progress<IProgressStep>, token: CancellationToken) => Thenable<R>): Promise<R> {\n\t\tconst handle = this._handles++;\n\t\tconst { title, location, cancellable } = options;\n\n\t\tthis._proxy.$startProgress(handle, { location: ProgressLocation.from(location), title, source, cancellable }, undefined).catch(onUnexpectedExternalError);\n\t\treturn this._withProgress(handle, task, !!cancellable);\n\t}\n\n\tprivate _withProgress<R>(handle: number, task: (progress: Progress<IProgressStep>, token: CancellationToken) => Thenable<R>, cancellable: boolean): Thenable<R> {\n\t\tlet source: CancellationTokenSource | undefined;\n\t\tif (cancellable) {\n\t\t\tsource = new CancellationTokenSource();\n\t\t\tthis._mapHandleToCancellationSource.set(handle, source);\n\t\t}\n\n\t\tconst progressEnd = (handle: number): void => {\n\t\t\tthis._proxy.$progressEnd(handle);\n\t\t\tthis._mapHandleToCancellationSource.delete(handle);\n\t\t\tsource?.dispose();\n\t\t};\n\n\t\tlet p: Thenable<R>;\n\n\t\ttry {\n\t\t\tp = task(new ProgressCallback(this._proxy, handle), cancellable && source ? source.token : CancellationToken.None);\n\t\t} catch (err) {\n\t\t\tprogressEnd(handle);\n\t\t\tthrow err;\n\t\t}\n\n\t\tp.then(result => progressEnd(handle), err => progressEnd(handle));\n\t\treturn p;\n\t}\n\n\tpublic $acceptProgressCanceled(handle: number): void {\n\t\tconst source = this._mapHandleToCancellationSource.get(handle);\n\t\tif (source) {\n\t\t\tsource.cancel();\n\t\t\tthis._mapHandleToCancellationSource.delete(handle);\n\t\t}\n\t}\n}\n\nfunction mergeProgress(result: IProgressStep, currentValue: IProgressStep): IProgressStep {\n\tresult.message = currentValue.message;\n\tif (typeof currentValue.increment === 'number') {\n\t\tif (typeof result.increment === 'number') {\n\t\t\tresult.increment += currentValue.increment;\n\t\t} else {\n\t\t\tresult.increment = currentValue.increment;\n\t\t}\n\t}\n\n\treturn result;\n}\n\nclass ProgressCallback extends Progress<IProgressStep> {\n\tconstructor(private _proxy: MainThreadProgressShape, private _handle: number) {\n\t\tsuper(p => this.throttledReport(p));\n\t}\n\n\t@throttle(100, (result: IProgressStep, currentValue: IProgressStep) => mergeProgress(result, currentValue), () => Object.create(null))\n\tthrottledReport(p: IProgressStep): void {\n\t\tthis._proxy.$progressReport(this._handle, p);\n\t}\n}\n"]}