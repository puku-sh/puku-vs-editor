{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/api/common/extHostDecorations.ts","vs/workbench/api/common/extHostDecorations.ts"],"names":[],"mappings":"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","file":"extHostDecorations.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport type * as vscode from 'vscode';\nimport { URI } from '../../../base/common/uri.js';\nimport { MainContext, ExtHostDecorationsShape, MainThreadDecorationsShape, DecorationData, DecorationRequest, DecorationReply } from './extHost.protocol.js';\nimport { Disposable, FileDecoration } from './extHostTypes.js';\nimport { CancellationToken } from '../../../base/common/cancellation.js';\nimport { IExtensionDescription } from '../../../platform/extensions/common/extensions.js';\nimport { createDecorator } from '../../../platform/instantiation/common/instantiation.js';\nimport { IExtHostRpcService } from './extHostRpcService.js';\nimport { ILogService } from '../../../platform/log/common/log.js';\nimport { asArray, groupBy } from '../../../base/common/arrays.js';\nimport { compare, count } from '../../../base/common/strings.js';\nimport { dirname } from '../../../base/common/path.js';\nimport { checkProposedApiEnabled } from '../../services/extensions/common/extensions.js';\n\ninterface ProviderData {\n\tprovider: vscode.FileDecorationProvider;\n\textensionDescription: IExtensionDescription;\n}\n\nexport class ExtHostDecorations implements ExtHostDecorationsShape {\n\n\tprivate static _handlePool = 0;\n\tprivate static _maxEventSize = 250;\n\n\treadonly _serviceBrand: undefined;\n\tprivate readonly _provider = new Map<number, ProviderData>();\n\tprivate readonly _proxy: MainThreadDecorationsShape;\n\n\tconstructor(\n\t\t@IExtHostRpcService extHostRpc: IExtHostRpcService,\n\t\t@ILogService private readonly _logService: ILogService,\n\t) {\n\t\tthis._proxy = extHostRpc.getProxy(MainContext.MainThreadDecorations);\n\t}\n\n\tregisterFileDecorationProvider(provider: vscode.FileDecorationProvider, extensionDescription: IExtensionDescription): vscode.Disposable {\n\t\tconst handle = ExtHostDecorations._handlePool++;\n\t\tthis._provider.set(handle, { provider, extensionDescription });\n\t\tthis._proxy.$registerDecorationProvider(handle, extensionDescription.identifier.value);\n\n\t\tconst listener = provider.onDidChangeFileDecorations && provider.onDidChangeFileDecorations(e => {\n\t\t\tif (!e) {\n\t\t\t\tthis._proxy.$onDidChange(handle, null);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst array = asArray(e);\n\t\t\tif (array.length <= ExtHostDecorations._maxEventSize) {\n\t\t\t\tthis._proxy.$onDidChange(handle, array);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// too many resources per event. pick one resource per folder, starting\n\t\t\t// with parent folders\n\t\t\tthis._logService.warn('[Decorations] CAPPING events from decorations provider', extensionDescription.identifier.value, array.length);\n\t\t\tconst mapped = array.map(uri => ({ uri, rank: count(uri.path, '/') }));\n\t\t\tconst groups = groupBy(mapped, (a, b) => a.rank - b.rank || compare(a.uri.path, b.uri.path));\n\t\t\tconst picked: URI[] = [];\n\t\t\touter: for (const uris of groups) {\n\t\t\t\tlet lastDirname: string | undefined;\n\t\t\t\tfor (const obj of uris) {\n\t\t\t\t\tconst myDirname = dirname(obj.uri.path);\n\t\t\t\t\tif (lastDirname !== myDirname) {\n\t\t\t\t\t\tlastDirname = myDirname;\n\t\t\t\t\t\tif (picked.push(obj.uri) >= ExtHostDecorations._maxEventSize) {\n\t\t\t\t\t\t\tbreak outer;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis._proxy.$onDidChange(handle, picked);\n\t\t});\n\n\t\treturn new Disposable(() => {\n\t\t\tlistener?.dispose();\n\t\t\tthis._proxy.$unregisterDecorationProvider(handle);\n\t\t\tthis._provider.delete(handle);\n\t\t});\n\t}\n\n\tasync $provideDecorations(handle: number, requests: DecorationRequest[], token: CancellationToken): Promise<DecorationReply> {\n\n\t\tif (!this._provider.has(handle)) {\n\t\t\t// might have been unregistered in the meantime\n\t\t\treturn Object.create(null);\n\t\t}\n\n\t\tconst result: DecorationReply = Object.create(null);\n\t\tconst { provider, extensionDescription: extensionId } = this._provider.get(handle)!;\n\n\t\tawait Promise.all(requests.map(async request => {\n\t\t\ttry {\n\t\t\t\tconst { uri, id } = request;\n\t\t\t\tconst data = await Promise.resolve(provider.provideFileDecoration(URI.revive(uri), token));\n\t\t\t\tif (!data) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\ttry {\n\t\t\t\t\tFileDecoration.validate(data);\n\t\t\t\t\tif (data.badge && typeof data.badge !== 'string') {\n\t\t\t\t\t\tcheckProposedApiEnabled(extensionId, 'codiconDecoration');\n\t\t\t\t\t}\n\t\t\t\t\tresult[id] = <DecorationData>[data.propagate, data.tooltip, data.badge, data.color];\n\t\t\t\t} catch (e) {\n\t\t\t\t\tthis._logService.warn(`INVALID decoration from extension '${extensionId.identifier.value}': ${e}`);\n\t\t\t\t}\n\t\t\t} catch (err) {\n\t\t\t\tthis._logService.error(err);\n\t\t\t}\n\t\t}));\n\n\t\treturn result;\n\t}\n}\n\nexport const IExtHostDecorations = createDecorator<IExtHostDecorations>('IExtHostDecorations');\nexport interface IExtHostDecorations extends ExtHostDecorations { }\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport type * as vscode from 'vscode';\nimport { URI } from '../../../base/common/uri.js';\nimport { MainContext, ExtHostDecorationsShape, MainThreadDecorationsShape, DecorationData, DecorationRequest, DecorationReply } from './extHost.protocol.js';\nimport { Disposable, FileDecoration } from './extHostTypes.js';\nimport { CancellationToken } from '../../../base/common/cancellation.js';\nimport { IExtensionDescription } from '../../../platform/extensions/common/extensions.js';\nimport { createDecorator } from '../../../platform/instantiation/common/instantiation.js';\nimport { IExtHostRpcService } from './extHostRpcService.js';\nimport { ILogService } from '../../../platform/log/common/log.js';\nimport { asArray, groupBy } from '../../../base/common/arrays.js';\nimport { compare, count } from '../../../base/common/strings.js';\nimport { dirname } from '../../../base/common/path.js';\nimport { checkProposedApiEnabled } from '../../services/extensions/common/extensions.js';\n\ninterface ProviderData {\n\tprovider: vscode.FileDecorationProvider;\n\textensionDescription: IExtensionDescription;\n}\n\nexport class ExtHostDecorations implements ExtHostDecorationsShape {\n\n\tprivate static _handlePool = 0;\n\tprivate static _maxEventSize = 250;\n\n\treadonly _serviceBrand: undefined;\n\tprivate readonly _provider = new Map<number, ProviderData>();\n\tprivate readonly _proxy: MainThreadDecorationsShape;\n\n\tconstructor(\n\t\t@IExtHostRpcService extHostRpc: IExtHostRpcService,\n\t\t@ILogService private readonly _logService: ILogService,\n\t) {\n\t\tthis._proxy = extHostRpc.getProxy(MainContext.MainThreadDecorations);\n\t}\n\n\tregisterFileDecorationProvider(provider: vscode.FileDecorationProvider, extensionDescription: IExtensionDescription): vscode.Disposable {\n\t\tconst handle = ExtHostDecorations._handlePool++;\n\t\tthis._provider.set(handle, { provider, extensionDescription });\n\t\tthis._proxy.$registerDecorationProvider(handle, extensionDescription.identifier.value);\n\n\t\tconst listener = provider.onDidChangeFileDecorations && provider.onDidChangeFileDecorations(e => {\n\t\t\tif (!e) {\n\t\t\t\tthis._proxy.$onDidChange(handle, null);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst array = asArray(e);\n\t\t\tif (array.length <= ExtHostDecorations._maxEventSize) {\n\t\t\t\tthis._proxy.$onDidChange(handle, array);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// too many resources per event. pick one resource per folder, starting\n\t\t\t// with parent folders\n\t\t\tthis._logService.warn('[Decorations] CAPPING events from decorations provider', extensionDescription.identifier.value, array.length);\n\t\t\tconst mapped = array.map(uri => ({ uri, rank: count(uri.path, '/') }));\n\t\t\tconst groups = groupBy(mapped, (a, b) => a.rank - b.rank || compare(a.uri.path, b.uri.path));\n\t\t\tconst picked: URI[] = [];\n\t\t\touter: for (const uris of groups) {\n\t\t\t\tlet lastDirname: string | undefined;\n\t\t\t\tfor (const obj of uris) {\n\t\t\t\t\tconst myDirname = dirname(obj.uri.path);\n\t\t\t\t\tif (lastDirname !== myDirname) {\n\t\t\t\t\t\tlastDirname = myDirname;\n\t\t\t\t\t\tif (picked.push(obj.uri) >= ExtHostDecorations._maxEventSize) {\n\t\t\t\t\t\t\tbreak outer;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis._proxy.$onDidChange(handle, picked);\n\t\t});\n\n\t\treturn new Disposable(() => {\n\t\t\tlistener?.dispose();\n\t\t\tthis._proxy.$unregisterDecorationProvider(handle);\n\t\t\tthis._provider.delete(handle);\n\t\t});\n\t}\n\n\tasync $provideDecorations(handle: number, requests: DecorationRequest[], token: CancellationToken): Promise<DecorationReply> {\n\n\t\tif (!this._provider.has(handle)) {\n\t\t\t// might have been unregistered in the meantime\n\t\t\treturn Object.create(null);\n\t\t}\n\n\t\tconst result: DecorationReply = Object.create(null);\n\t\tconst { provider, extensionDescription: extensionId } = this._provider.get(handle)!;\n\n\t\tawait Promise.all(requests.map(async request => {\n\t\t\ttry {\n\t\t\t\tconst { uri, id } = request;\n\t\t\t\tconst data = await Promise.resolve(provider.provideFileDecoration(URI.revive(uri), token));\n\t\t\t\tif (!data) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\ttry {\n\t\t\t\t\tFileDecoration.validate(data);\n\t\t\t\t\tif (data.badge && typeof data.badge !== 'string') {\n\t\t\t\t\t\tcheckProposedApiEnabled(extensionId, 'codiconDecoration');\n\t\t\t\t\t}\n\t\t\t\t\tresult[id] = <DecorationData>[data.propagate, data.tooltip, data.badge, data.color];\n\t\t\t\t} catch (e) {\n\t\t\t\t\tthis._logService.warn(`INVALID decoration from extension '${extensionId.identifier.value}': ${e}`);\n\t\t\t\t}\n\t\t\t} catch (err) {\n\t\t\t\tthis._logService.error(err);\n\t\t\t}\n\t\t}));\n\n\t\treturn result;\n\t}\n}\n\nexport const IExtHostDecorations = createDecorator<IExtHostDecorations>('IExtHostDecorations');\nexport interface IExtHostDecorations extends ExtHostDecorations { }\n"]}