{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/api/common/extHostSearch.ts","vs/workbench/api/common/extHostSearch.ts"],"names":[],"mappings":"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","file":"extHostSearch.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { IDisposable, toDisposable } from '../../../base/common/lifecycle.js';\nimport type * as vscode from 'vscode';\nimport { ExtHostSearchShape, MainThreadSearchShape, MainContext } from './extHost.protocol.js';\nimport { createDecorator } from '../../../platform/instantiation/common/instantiation.js';\nimport { FileSearchManager } from '../../services/search/common/fileSearchManager.js';\nimport { IExtHostRpcService } from './extHostRpcService.js';\nimport { IURITransformerService } from './extHostUriTransformerService.js';\nimport { ILogService } from '../../../platform/log/common/log.js';\nimport { IRawFileQuery, ISearchCompleteStats, IFileQuery, IRawTextQuery, IRawQuery, ITextQuery, IFolderQuery, IRawAITextQuery, IAITextQuery } from '../../services/search/common/search.js';\nimport { URI, UriComponents } from '../../../base/common/uri.js';\nimport { TextSearchManager } from '../../services/search/common/textSearchManager.js';\nimport { CancellationToken } from '../../../base/common/cancellation.js';\nimport { revive } from '../../../base/common/marshalling.js';\nimport { OldFileSearchProviderConverter, OldTextSearchProviderConverter } from '../../services/search/common/searchExtConversionTypes.js';\n\nexport interface IExtHostSearch extends ExtHostSearchShape {\n\tregisterTextSearchProviderOld(scheme: string, provider: vscode.TextSearchProvider): IDisposable;\n\tregisterFileSearchProviderOld(scheme: string, provider: vscode.FileSearchProvider): IDisposable;\n\tregisterTextSearchProvider(scheme: string, provider: vscode.TextSearchProvider2): IDisposable;\n\tregisterAITextSearchProvider(scheme: string, provider: vscode.AITextSearchProvider): IDisposable;\n\tregisterFileSearchProvider(scheme: string, provider: vscode.FileSearchProvider2): IDisposable;\n\tdoInternalFileSearchWithCustomCallback(query: IFileQuery, token: CancellationToken, handleFileMatch: (data: URI[]) => void): Promise<ISearchCompleteStats>;\n}\n\nexport const IExtHostSearch = createDecorator<IExtHostSearch>('IExtHostSearch');\n\nexport class ExtHostSearch implements IExtHostSearch {\n\n\tprotected readonly _proxy: MainThreadSearchShape;\n\tprotected _handlePool: number;\n\n\tprivate readonly _textSearchProvider: Map<number, vscode.TextSearchProvider2>;\n\tprivate readonly _textSearchUsedSchemes: Set<string>;\n\n\tprivate readonly _aiTextSearchProvider: Map<number, vscode.AITextSearchProvider>;\n\tprivate readonly _aiTextSearchUsedSchemes: Set<string>;\n\n\tprivate readonly _fileSearchProvider: Map<number, vscode.FileSearchProvider2>;\n\tprivate readonly _fileSearchUsedSchemes: Set<string>;\n\n\tprivate readonly _fileSearchManager: FileSearchManager;\n\n\tconstructor(\n\t\t@IExtHostRpcService private extHostRpc: IExtHostRpcService,\n\t\t@IURITransformerService protected _uriTransformer: IURITransformerService,\n\t\t@ILogService protected _logService: ILogService,\n\t) {\n\t\tthis._proxy = this.extHostRpc.getProxy(MainContext.MainThreadSearch);\n\t\tthis._handlePool = 0;\n\t\tthis._textSearchProvider = new Map<number, vscode.TextSearchProvider2>();\n\t\tthis._textSearchUsedSchemes = new Set<string>();\n\t\tthis._aiTextSearchProvider = new Map<number, vscode.AITextSearchProvider>();\n\t\tthis._aiTextSearchUsedSchemes = new Set<string>();\n\t\tthis._fileSearchProvider = new Map<number, vscode.FileSearchProvider2>();\n\t\tthis._fileSearchUsedSchemes = new Set<string>();\n\t\tthis._fileSearchManager = new FileSearchManager();\n\t}\n\n\tprotected _transformScheme(scheme: string): string {\n\t\treturn this._uriTransformer.transformOutgoingScheme(scheme);\n\t}\n\n\tregisterTextSearchProviderOld(scheme: string, provider: vscode.TextSearchProvider): IDisposable {\n\t\tif (this._textSearchUsedSchemes.has(scheme)) {\n\t\t\tthrow new Error(`a text search provider for the scheme '${scheme}' is already registered`);\n\t\t}\n\n\t\tthis._textSearchUsedSchemes.add(scheme);\n\t\tconst handle = this._handlePool++;\n\t\tthis._textSearchProvider.set(handle, new OldTextSearchProviderConverter(provider));\n\t\tthis._proxy.$registerTextSearchProvider(handle, this._transformScheme(scheme));\n\t\treturn toDisposable(() => {\n\t\t\tthis._textSearchUsedSchemes.delete(scheme);\n\t\t\tthis._textSearchProvider.delete(handle);\n\t\t\tthis._proxy.$unregisterProvider(handle);\n\t\t});\n\t}\n\n\tregisterTextSearchProvider(scheme: string, provider: vscode.TextSearchProvider2): IDisposable {\n\t\tif (this._textSearchUsedSchemes.has(scheme)) {\n\t\t\tthrow new Error(`a text search provider for the scheme '${scheme}' is already registered`);\n\t\t}\n\n\t\tthis._textSearchUsedSchemes.add(scheme);\n\t\tconst handle = this._handlePool++;\n\t\tthis._textSearchProvider.set(handle, provider);\n\t\tthis._proxy.$registerTextSearchProvider(handle, this._transformScheme(scheme));\n\t\treturn toDisposable(() => {\n\t\t\tthis._textSearchUsedSchemes.delete(scheme);\n\t\t\tthis._textSearchProvider.delete(handle);\n\t\t\tthis._proxy.$unregisterProvider(handle);\n\t\t});\n\t}\n\n\tregisterAITextSearchProvider(scheme: string, provider: vscode.AITextSearchProvider): IDisposable {\n\t\tif (this._aiTextSearchUsedSchemes.has(scheme)) {\n\t\t\tthrow new Error(`an AI text search provider for the scheme '${scheme}'is already registered`);\n\t\t}\n\n\t\tthis._aiTextSearchUsedSchemes.add(scheme);\n\t\tconst handle = this._handlePool++;\n\t\tthis._aiTextSearchProvider.set(handle, provider);\n\t\tthis._proxy.$registerAITextSearchProvider(handle, this._transformScheme(scheme));\n\t\treturn toDisposable(() => {\n\t\t\tthis._aiTextSearchUsedSchemes.delete(scheme);\n\t\t\tthis._aiTextSearchProvider.delete(handle);\n\t\t\tthis._proxy.$unregisterProvider(handle);\n\t\t});\n\t}\n\n\tregisterFileSearchProviderOld(scheme: string, provider: vscode.FileSearchProvider): IDisposable {\n\t\tif (this._fileSearchUsedSchemes.has(scheme)) {\n\t\t\tthrow new Error(`a file search provider for the scheme '${scheme}' is already registered`);\n\t\t}\n\n\t\tthis._fileSearchUsedSchemes.add(scheme);\n\t\tconst handle = this._handlePool++;\n\t\tthis._fileSearchProvider.set(handle, new OldFileSearchProviderConverter(provider));\n\t\tthis._proxy.$registerFileSearchProvider(handle, this._transformScheme(scheme));\n\t\treturn toDisposable(() => {\n\t\t\tthis._fileSearchUsedSchemes.delete(scheme);\n\t\t\tthis._fileSearchProvider.delete(handle);\n\t\t\tthis._proxy.$unregisterProvider(handle);\n\t\t});\n\t}\n\n\tregisterFileSearchProvider(scheme: string, provider: vscode.FileSearchProvider2): IDisposable {\n\t\tif (this._fileSearchUsedSchemes.has(scheme)) {\n\t\t\tthrow new Error(`a file search provider for the scheme '${scheme}' is already registered`);\n\t\t}\n\n\t\tthis._fileSearchUsedSchemes.add(scheme);\n\t\tconst handle = this._handlePool++;\n\t\tthis._fileSearchProvider.set(handle, provider);\n\t\tthis._proxy.$registerFileSearchProvider(handle, this._transformScheme(scheme));\n\t\treturn toDisposable(() => {\n\t\t\tthis._fileSearchUsedSchemes.delete(scheme);\n\t\t\tthis._fileSearchProvider.delete(handle);\n\t\t\tthis._proxy.$unregisterProvider(handle);\n\t\t});\n\t}\n\n\t$provideFileSearchResults(handle: number, session: number, rawQuery: IRawFileQuery, token: vscode.CancellationToken): Promise<ISearchCompleteStats> {\n\t\tconst query = reviveQuery(rawQuery);\n\t\tconst provider = this._fileSearchProvider.get(handle);\n\t\tif (provider) {\n\t\t\treturn this._fileSearchManager.fileSearch(query, provider, batch => {\n\t\t\t\tthis._proxy.$handleFileMatch(handle, session, batch.map(p => p.resource));\n\t\t\t}, token);\n\t\t} else {\n\t\t\tthrow new Error('unknown provider: ' + handle);\n\t\t}\n\t}\n\n\tasync doInternalFileSearchWithCustomCallback(query: IFileQuery, token: CancellationToken, handleFileMatch: (data: URI[]) => void): Promise<ISearchCompleteStats> {\n\t\treturn { messages: [] };\n\t}\n\n\t$clearCache(cacheKey: string): Promise<void> {\n\t\tthis._fileSearchManager.clearCache(cacheKey);\n\n\t\treturn Promise.resolve(undefined);\n\t}\n\n\t$provideTextSearchResults(handle: number, session: number, rawQuery: IRawTextQuery, token: vscode.CancellationToken): Promise<ISearchCompleteStats> {\n\t\tconst provider = this._textSearchProvider.get(handle);\n\t\tif (!provider || !provider.provideTextSearchResults) {\n\t\t\tthrow new Error(`Unknown Text Search Provider ${handle}`);\n\t\t}\n\n\t\tconst query = reviveQuery(rawQuery);\n\t\tconst engine = this.createTextSearchManager(query, provider);\n\t\treturn engine.search(progress => this._proxy.$handleTextMatch(handle, session, progress), token);\n\t}\n\n\t$provideAITextSearchResults(handle: number, session: number, rawQuery: IRawAITextQuery, token: vscode.CancellationToken): Promise<ISearchCompleteStats> {\n\t\tconst provider = this._aiTextSearchProvider.get(handle);\n\t\tif (!provider || !provider.provideAITextSearchResults) {\n\t\t\tthrow new Error(`Unknown AI Text Search Provider ${handle}`);\n\t\t}\n\n\t\tconst query = reviveQuery(rawQuery);\n\t\tconst engine = this.createAITextSearchManager(query, provider);\n\t\treturn engine.search(progress => this._proxy.$handleTextMatch(handle, session, progress), token, result => this._proxy.$handleKeywordResult(handle, session, result));\n\t}\n\n\t$enableExtensionHostSearch(): void { }\n\n\tasync $getAIName(handle: number): Promise<string | undefined> {\n\t\tconst provider = this._aiTextSearchProvider.get(handle);\n\t\tif (!provider || !provider.provideAITextSearchResults) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\t// if the provider is defined, but has no name, use default name\n\t\treturn provider.name ?? 'AI';\n\t}\n\n\tprotected createTextSearchManager(query: ITextQuery, provider: vscode.TextSearchProvider2): TextSearchManager {\n\t\treturn new TextSearchManager({ query, provider }, {\n\t\t\treaddir: resource => Promise.resolve([]),\n\t\t\ttoCanonicalName: encoding => encoding\n\t\t}, 'textSearchProvider');\n\t}\n\n\tprotected createAITextSearchManager(query: IAITextQuery, provider: vscode.AITextSearchProvider): TextSearchManager {\n\t\treturn new TextSearchManager({ query, provider }, {\n\t\t\treaddir: resource => Promise.resolve([]),\n\t\t\ttoCanonicalName: encoding => encoding\n\t\t}, 'aiTextSearchProvider');\n\t}\n}\n\nexport function reviveQuery<U extends IRawQuery>(rawQuery: U): U extends IRawTextQuery ? ITextQuery : U extends IRawAITextQuery ? IAITextQuery : IFileQuery {\n\treturn {\n\t\t// eslint-disable-next-line local/code-no-any-casts\n\t\t...<any>rawQuery, // TODO@rob ???\n\t\t...{\n\t\t\tfolderQueries: rawQuery.folderQueries && rawQuery.folderQueries.map(reviveFolderQuery),\n\t\t\textraFileResources: rawQuery.extraFileResources && rawQuery.extraFileResources.map(components => URI.revive(components))\n\t\t}\n\t};\n}\n\nfunction reviveFolderQuery(rawFolderQuery: IFolderQuery<UriComponents>): IFolderQuery<URI> {\n\treturn revive(rawFolderQuery);\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { IDisposable, toDisposable } from '../../../base/common/lifecycle.js';\nimport type * as vscode from 'vscode';\nimport { ExtHostSearchShape, MainThreadSearchShape, MainContext } from './extHost.protocol.js';\nimport { createDecorator } from '../../../platform/instantiation/common/instantiation.js';\nimport { FileSearchManager } from '../../services/search/common/fileSearchManager.js';\nimport { IExtHostRpcService } from './extHostRpcService.js';\nimport { IURITransformerService } from './extHostUriTransformerService.js';\nimport { ILogService } from '../../../platform/log/common/log.js';\nimport { IRawFileQuery, ISearchCompleteStats, IFileQuery, IRawTextQuery, IRawQuery, ITextQuery, IFolderQuery, IRawAITextQuery, IAITextQuery } from '../../services/search/common/search.js';\nimport { URI, UriComponents } from '../../../base/common/uri.js';\nimport { TextSearchManager } from '../../services/search/common/textSearchManager.js';\nimport { CancellationToken } from '../../../base/common/cancellation.js';\nimport { revive } from '../../../base/common/marshalling.js';\nimport { OldFileSearchProviderConverter, OldTextSearchProviderConverter } from '../../services/search/common/searchExtConversionTypes.js';\n\nexport interface IExtHostSearch extends ExtHostSearchShape {\n\tregisterTextSearchProviderOld(scheme: string, provider: vscode.TextSearchProvider): IDisposable;\n\tregisterFileSearchProviderOld(scheme: string, provider: vscode.FileSearchProvider): IDisposable;\n\tregisterTextSearchProvider(scheme: string, provider: vscode.TextSearchProvider2): IDisposable;\n\tregisterAITextSearchProvider(scheme: string, provider: vscode.AITextSearchProvider): IDisposable;\n\tregisterFileSearchProvider(scheme: string, provider: vscode.FileSearchProvider2): IDisposable;\n\tdoInternalFileSearchWithCustomCallback(query: IFileQuery, token: CancellationToken, handleFileMatch: (data: URI[]) => void): Promise<ISearchCompleteStats>;\n}\n\nexport const IExtHostSearch = createDecorator<IExtHostSearch>('IExtHostSearch');\n\nexport class ExtHostSearch implements IExtHostSearch {\n\n\tprotected readonly _proxy: MainThreadSearchShape;\n\tprotected _handlePool: number;\n\n\tprivate readonly _textSearchProvider: Map<number, vscode.TextSearchProvider2>;\n\tprivate readonly _textSearchUsedSchemes: Set<string>;\n\n\tprivate readonly _aiTextSearchProvider: Map<number, vscode.AITextSearchProvider>;\n\tprivate readonly _aiTextSearchUsedSchemes: Set<string>;\n\n\tprivate readonly _fileSearchProvider: Map<number, vscode.FileSearchProvider2>;\n\tprivate readonly _fileSearchUsedSchemes: Set<string>;\n\n\tprivate readonly _fileSearchManager: FileSearchManager;\n\n\tconstructor(\n\t\t@IExtHostRpcService private extHostRpc: IExtHostRpcService,\n\t\t@IURITransformerService protected _uriTransformer: IURITransformerService,\n\t\t@ILogService protected _logService: ILogService,\n\t) {\n\t\tthis._proxy = this.extHostRpc.getProxy(MainContext.MainThreadSearch);\n\t\tthis._handlePool = 0;\n\t\tthis._textSearchProvider = new Map<number, vscode.TextSearchProvider2>();\n\t\tthis._textSearchUsedSchemes = new Set<string>();\n\t\tthis._aiTextSearchProvider = new Map<number, vscode.AITextSearchProvider>();\n\t\tthis._aiTextSearchUsedSchemes = new Set<string>();\n\t\tthis._fileSearchProvider = new Map<number, vscode.FileSearchProvider2>();\n\t\tthis._fileSearchUsedSchemes = new Set<string>();\n\t\tthis._fileSearchManager = new FileSearchManager();\n\t}\n\n\tprotected _transformScheme(scheme: string): string {\n\t\treturn this._uriTransformer.transformOutgoingScheme(scheme);\n\t}\n\n\tregisterTextSearchProviderOld(scheme: string, provider: vscode.TextSearchProvider): IDisposable {\n\t\tif (this._textSearchUsedSchemes.has(scheme)) {\n\t\t\tthrow new Error(`a text search provider for the scheme '${scheme}' is already registered`);\n\t\t}\n\n\t\tthis._textSearchUsedSchemes.add(scheme);\n\t\tconst handle = this._handlePool++;\n\t\tthis._textSearchProvider.set(handle, new OldTextSearchProviderConverter(provider));\n\t\tthis._proxy.$registerTextSearchProvider(handle, this._transformScheme(scheme));\n\t\treturn toDisposable(() => {\n\t\t\tthis._textSearchUsedSchemes.delete(scheme);\n\t\t\tthis._textSearchProvider.delete(handle);\n\t\t\tthis._proxy.$unregisterProvider(handle);\n\t\t});\n\t}\n\n\tregisterTextSearchProvider(scheme: string, provider: vscode.TextSearchProvider2): IDisposable {\n\t\tif (this._textSearchUsedSchemes.has(scheme)) {\n\t\t\tthrow new Error(`a text search provider for the scheme '${scheme}' is already registered`);\n\t\t}\n\n\t\tthis._textSearchUsedSchemes.add(scheme);\n\t\tconst handle = this._handlePool++;\n\t\tthis._textSearchProvider.set(handle, provider);\n\t\tthis._proxy.$registerTextSearchProvider(handle, this._transformScheme(scheme));\n\t\treturn toDisposable(() => {\n\t\t\tthis._textSearchUsedSchemes.delete(scheme);\n\t\t\tthis._textSearchProvider.delete(handle);\n\t\t\tthis._proxy.$unregisterProvider(handle);\n\t\t});\n\t}\n\n\tregisterAITextSearchProvider(scheme: string, provider: vscode.AITextSearchProvider): IDisposable {\n\t\tif (this._aiTextSearchUsedSchemes.has(scheme)) {\n\t\t\tthrow new Error(`an AI text search provider for the scheme '${scheme}'is already registered`);\n\t\t}\n\n\t\tthis._aiTextSearchUsedSchemes.add(scheme);\n\t\tconst handle = this._handlePool++;\n\t\tthis._aiTextSearchProvider.set(handle, provider);\n\t\tthis._proxy.$registerAITextSearchProvider(handle, this._transformScheme(scheme));\n\t\treturn toDisposable(() => {\n\t\t\tthis._aiTextSearchUsedSchemes.delete(scheme);\n\t\t\tthis._aiTextSearchProvider.delete(handle);\n\t\t\tthis._proxy.$unregisterProvider(handle);\n\t\t});\n\t}\n\n\tregisterFileSearchProviderOld(scheme: string, provider: vscode.FileSearchProvider): IDisposable {\n\t\tif (this._fileSearchUsedSchemes.has(scheme)) {\n\t\t\tthrow new Error(`a file search provider for the scheme '${scheme}' is already registered`);\n\t\t}\n\n\t\tthis._fileSearchUsedSchemes.add(scheme);\n\t\tconst handle = this._handlePool++;\n\t\tthis._fileSearchProvider.set(handle, new OldFileSearchProviderConverter(provider));\n\t\tthis._proxy.$registerFileSearchProvider(handle, this._transformScheme(scheme));\n\t\treturn toDisposable(() => {\n\t\t\tthis._fileSearchUsedSchemes.delete(scheme);\n\t\t\tthis._fileSearchProvider.delete(handle);\n\t\t\tthis._proxy.$unregisterProvider(handle);\n\t\t});\n\t}\n\n\tregisterFileSearchProvider(scheme: string, provider: vscode.FileSearchProvider2): IDisposable {\n\t\tif (this._fileSearchUsedSchemes.has(scheme)) {\n\t\t\tthrow new Error(`a file search provider for the scheme '${scheme}' is already registered`);\n\t\t}\n\n\t\tthis._fileSearchUsedSchemes.add(scheme);\n\t\tconst handle = this._handlePool++;\n\t\tthis._fileSearchProvider.set(handle, provider);\n\t\tthis._proxy.$registerFileSearchProvider(handle, this._transformScheme(scheme));\n\t\treturn toDisposable(() => {\n\t\t\tthis._fileSearchUsedSchemes.delete(scheme);\n\t\t\tthis._fileSearchProvider.delete(handle);\n\t\t\tthis._proxy.$unregisterProvider(handle);\n\t\t});\n\t}\n\n\t$provideFileSearchResults(handle: number, session: number, rawQuery: IRawFileQuery, token: vscode.CancellationToken): Promise<ISearchCompleteStats> {\n\t\tconst query = reviveQuery(rawQuery);\n\t\tconst provider = this._fileSearchProvider.get(handle);\n\t\tif (provider) {\n\t\t\treturn this._fileSearchManager.fileSearch(query, provider, batch => {\n\t\t\t\tthis._proxy.$handleFileMatch(handle, session, batch.map(p => p.resource));\n\t\t\t}, token);\n\t\t} else {\n\t\t\tthrow new Error('unknown provider: ' + handle);\n\t\t}\n\t}\n\n\tasync doInternalFileSearchWithCustomCallback(query: IFileQuery, token: CancellationToken, handleFileMatch: (data: URI[]) => void): Promise<ISearchCompleteStats> {\n\t\treturn { messages: [] };\n\t}\n\n\t$clearCache(cacheKey: string): Promise<void> {\n\t\tthis._fileSearchManager.clearCache(cacheKey);\n\n\t\treturn Promise.resolve(undefined);\n\t}\n\n\t$provideTextSearchResults(handle: number, session: number, rawQuery: IRawTextQuery, token: vscode.CancellationToken): Promise<ISearchCompleteStats> {\n\t\tconst provider = this._textSearchProvider.get(handle);\n\t\tif (!provider || !provider.provideTextSearchResults) {\n\t\t\tthrow new Error(`Unknown Text Search Provider ${handle}`);\n\t\t}\n\n\t\tconst query = reviveQuery(rawQuery);\n\t\tconst engine = this.createTextSearchManager(query, provider);\n\t\treturn engine.search(progress => this._proxy.$handleTextMatch(handle, session, progress), token);\n\t}\n\n\t$provideAITextSearchResults(handle: number, session: number, rawQuery: IRawAITextQuery, token: vscode.CancellationToken): Promise<ISearchCompleteStats> {\n\t\tconst provider = this._aiTextSearchProvider.get(handle);\n\t\tif (!provider || !provider.provideAITextSearchResults) {\n\t\t\tthrow new Error(`Unknown AI Text Search Provider ${handle}`);\n\t\t}\n\n\t\tconst query = reviveQuery(rawQuery);\n\t\tconst engine = this.createAITextSearchManager(query, provider);\n\t\treturn engine.search(progress => this._proxy.$handleTextMatch(handle, session, progress), token, result => this._proxy.$handleKeywordResult(handle, session, result));\n\t}\n\n\t$enableExtensionHostSearch(): void { }\n\n\tasync $getAIName(handle: number): Promise<string | undefined> {\n\t\tconst provider = this._aiTextSearchProvider.get(handle);\n\t\tif (!provider || !provider.provideAITextSearchResults) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\t// if the provider is defined, but has no name, use default name\n\t\treturn provider.name ?? 'AI';\n\t}\n\n\tprotected createTextSearchManager(query: ITextQuery, provider: vscode.TextSearchProvider2): TextSearchManager {\n\t\treturn new TextSearchManager({ query, provider }, {\n\t\t\treaddir: resource => Promise.resolve([]),\n\t\t\ttoCanonicalName: encoding => encoding\n\t\t}, 'textSearchProvider');\n\t}\n\n\tprotected createAITextSearchManager(query: IAITextQuery, provider: vscode.AITextSearchProvider): TextSearchManager {\n\t\treturn new TextSearchManager({ query, provider }, {\n\t\t\treaddir: resource => Promise.resolve([]),\n\t\t\ttoCanonicalName: encoding => encoding\n\t\t}, 'aiTextSearchProvider');\n\t}\n}\n\nexport function reviveQuery<U extends IRawQuery>(rawQuery: U): U extends IRawTextQuery ? ITextQuery : U extends IRawAITextQuery ? IAITextQuery : IFileQuery {\n\treturn {\n\t\t// eslint-disable-next-line local/code-no-any-casts\n\t\t...<any>rawQuery, // TODO@rob ???\n\t\t...{\n\t\t\tfolderQueries: rawQuery.folderQueries && rawQuery.folderQueries.map(reviveFolderQuery),\n\t\t\textraFileResources: rawQuery.extraFileResources && rawQuery.extraFileResources.map(components => URI.revive(components))\n\t\t}\n\t};\n}\n\nfunction reviveFolderQuery(rawFolderQuery: IFolderQuery<UriComponents>): IFolderQuery<URI> {\n\treturn revive(rawFolderQuery);\n}\n"]}