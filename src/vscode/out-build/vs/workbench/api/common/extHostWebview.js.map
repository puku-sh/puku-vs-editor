{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/api/common/extHostWebview.ts","vs/workbench/api/common/extHostWebview.ts"],"names":[],"mappings":"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","file":"extHostWebview.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\n/* eslint-disable local/code-no-native-private */\n\nimport { VSBuffer } from '../../../base/common/buffer.js';\nimport { Emitter, Event } from '../../../base/common/event.js';\nimport { Disposable } from '../../../base/common/lifecycle.js';\nimport { Schemas } from '../../../base/common/network.js';\nimport * as objects from '../../../base/common/objects.js';\nimport { URI } from '../../../base/common/uri.js';\nimport { normalizeVersion, parseVersion } from '../../../platform/extensions/common/extensionValidator.js';\nimport { IExtensionDescription } from '../../../platform/extensions/common/extensions.js';\nimport { ILogService } from '../../../platform/log/common/log.js';\nimport { IExtHostApiDeprecationService } from './extHostApiDeprecationService.js';\nimport { deserializeWebviewMessage, serializeWebviewMessage } from './extHostWebviewMessaging.js';\nimport { IExtHostWorkspace } from './extHostWorkspace.js';\nimport { WebviewRemoteInfo, asWebviewUri, webviewGenericCspSource } from '../../contrib/webview/common/webview.js';\nimport { SerializableObjectWithBuffers } from '../../services/extensions/common/proxyIdentifier.js';\nimport type * as vscode from 'vscode';\nimport * as extHostProtocol from './extHost.protocol.js';\n\nexport class ExtHostWebview implements vscode.Webview {\n\n\treadonly #handle: extHostProtocol.WebviewHandle;\n\treadonly #proxy: extHostProtocol.MainThreadWebviewsShape;\n\treadonly #deprecationService: IExtHostApiDeprecationService;\n\n\treadonly #remoteInfo: WebviewRemoteInfo;\n\treadonly #workspace: IExtHostWorkspace | undefined;\n\treadonly #extension: IExtensionDescription;\n\n\t#html: string = '';\n\t#options: vscode.WebviewOptions;\n\t#isDisposed: boolean = false;\n\t#hasCalledAsWebviewUri = false;\n\n\t#serializeBuffersForPostMessage: boolean;\n\t#shouldRewriteOldResourceUris: boolean;\n\n\tconstructor(\n\t\thandle: extHostProtocol.WebviewHandle,\n\t\tproxy: extHostProtocol.MainThreadWebviewsShape,\n\t\toptions: vscode.WebviewOptions,\n\t\tremoteInfo: WebviewRemoteInfo,\n\t\tworkspace: IExtHostWorkspace | undefined,\n\t\textension: IExtensionDescription,\n\t\tdeprecationService: IExtHostApiDeprecationService,\n\t) {\n\t\tthis.#handle = handle;\n\t\tthis.#proxy = proxy;\n\t\tthis.#options = options;\n\t\tthis.#remoteInfo = remoteInfo;\n\t\tthis.#workspace = workspace;\n\t\tthis.#extension = extension;\n\t\tthis.#serializeBuffersForPostMessage = shouldSerializeBuffersForPostMessage(extension);\n\t\tthis.#shouldRewriteOldResourceUris = shouldTryRewritingOldResourceUris(extension);\n\t\tthis.#deprecationService = deprecationService;\n\t}\n\n\t/* internal */ readonly _onMessageEmitter = new Emitter<any>();\n\tpublic readonly onDidReceiveMessage: Event<any> = this._onMessageEmitter.event;\n\n\treadonly #onDidDisposeEmitter = new Emitter<void>();\n\t/* internal */ readonly _onDidDispose: Event<void> = this.#onDidDisposeEmitter.event;\n\n\tpublic dispose() {\n\t\tthis.#isDisposed = true;\n\n\t\tthis.#onDidDisposeEmitter.fire();\n\n\t\tthis.#onDidDisposeEmitter.dispose();\n\t\tthis._onMessageEmitter.dispose();\n\t}\n\n\tpublic asWebviewUri(resource: vscode.Uri): vscode.Uri {\n\t\tthis.#hasCalledAsWebviewUri = true;\n\t\treturn asWebviewUri(resource, this.#remoteInfo);\n\t}\n\n\tpublic get cspSource(): string {\n\t\tconst extensionLocation = this.#extension.extensionLocation;\n\t\tif (extensionLocation.scheme === Schemas.https || extensionLocation.scheme === Schemas.http) {\n\t\t\t// The extension is being served up from a CDN.\n\t\t\t// Also include the CDN in the default csp.\n\t\t\tlet extensionCspRule = extensionLocation.toString();\n\t\t\tif (!extensionCspRule.endsWith('/')) {\n\t\t\t\t// Always treat the location as a directory so that we allow all content under it\n\t\t\t\textensionCspRule += '/';\n\t\t\t}\n\t\t\treturn extensionCspRule + ' ' + webviewGenericCspSource;\n\t\t}\n\t\treturn webviewGenericCspSource;\n\t}\n\n\tpublic get html(): string {\n\t\tthis.assertNotDisposed();\n\t\treturn this.#html;\n\t}\n\n\tpublic set html(value: string) {\n\t\tthis.assertNotDisposed();\n\t\tif (this.#html !== value) {\n\t\t\tthis.#html = value;\n\t\t\tif (this.#shouldRewriteOldResourceUris && !this.#hasCalledAsWebviewUri && /([\"'])vscode-resource:([^\\s'\"]+?)([\"'])/i.test(value)) {\n\t\t\t\tthis.#hasCalledAsWebviewUri = true;\n\t\t\t\tthis.#deprecationService.report('Webview vscode-resource: uris', this.#extension,\n\t\t\t\t\t`Please migrate to use the 'webview.asWebviewUri' api instead: https://aka.ms/vscode-webview-use-aswebviewuri`);\n\t\t\t}\n\t\t\tthis.#proxy.$setHtml(this.#handle, this.rewriteOldResourceUrlsIfNeeded(value));\n\t\t}\n\t}\n\n\tpublic get options(): vscode.WebviewOptions {\n\t\tthis.assertNotDisposed();\n\t\treturn this.#options;\n\t}\n\n\tpublic set options(newOptions: vscode.WebviewOptions) {\n\t\tthis.assertNotDisposed();\n\n\t\tif (!objects.equals(this.#options, newOptions)) {\n\t\t\tthis.#proxy.$setOptions(this.#handle, serializeWebviewOptions(this.#extension, this.#workspace, newOptions));\n\t\t}\n\n\t\tthis.#options = newOptions;\n\t}\n\n\tpublic async postMessage(message: any): Promise<boolean> {\n\t\tif (this.#isDisposed) {\n\t\t\treturn false;\n\t\t}\n\t\tconst serialized = serializeWebviewMessage(message, { serializeBuffersForPostMessage: this.#serializeBuffersForPostMessage });\n\t\treturn this.#proxy.$postMessage(this.#handle, serialized.message, ...serialized.buffers);\n\t}\n\n\tprivate assertNotDisposed() {\n\t\tif (this.#isDisposed) {\n\t\t\tthrow new Error('Webview is disposed');\n\t\t}\n\t}\n\n\tprivate rewriteOldResourceUrlsIfNeeded(value: string): string {\n\t\tif (!this.#shouldRewriteOldResourceUris) {\n\t\t\treturn value;\n\t\t}\n\n\t\tconst isRemote = this.#extension.extensionLocation?.scheme === Schemas.vscodeRemote;\n\t\tconst remoteAuthority = this.#extension.extensionLocation.scheme === Schemas.vscodeRemote ? this.#extension.extensionLocation.authority : undefined;\n\t\treturn value\n\t\t\t.replace(/([\"'])(?:vscode-resource):(\\/\\/([^\\s\\/'\"]+?)(?=\\/))?([^\\s'\"]+?)([\"'])/gi, (_match, startQuote, _1, scheme, path, endQuote) => {\n\t\t\t\tconst uri = URI.from({\n\t\t\t\t\tscheme: scheme || 'file',\n\t\t\t\t\tpath: decodeURIComponent(path),\n\t\t\t\t});\n\t\t\t\tconst webviewUri = asWebviewUri(uri, { isRemote, authority: remoteAuthority }).toString();\n\t\t\t\treturn `${startQuote}${webviewUri}${endQuote}`;\n\t\t\t})\n\t\t\t.replace(/([\"'])(?:vscode-webview-resource):(\\/\\/[^\\s\\/'\"]+\\/([^\\s\\/'\"]+?)(?=\\/))?([^\\s'\"]+?)([\"'])/gi, (_match, startQuote, _1, scheme, path, endQuote) => {\n\t\t\t\tconst uri = URI.from({\n\t\t\t\t\tscheme: scheme || 'file',\n\t\t\t\t\tpath: decodeURIComponent(path),\n\t\t\t\t});\n\t\t\t\tconst webviewUri = asWebviewUri(uri, { isRemote, authority: remoteAuthority }).toString();\n\t\t\t\treturn `${startQuote}${webviewUri}${endQuote}`;\n\t\t\t});\n\t}\n}\n\nexport function shouldSerializeBuffersForPostMessage(extension: IExtensionDescription): boolean {\n\ttry {\n\t\tconst version = normalizeVersion(parseVersion(extension.engines.vscode));\n\t\treturn !!version && version.majorBase >= 1 && version.minorBase >= 57;\n\t} catch {\n\t\treturn false;\n\t}\n}\n\nfunction shouldTryRewritingOldResourceUris(extension: IExtensionDescription): boolean {\n\ttry {\n\t\tconst version = normalizeVersion(parseVersion(extension.engines.vscode));\n\t\tif (!version) {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn version.majorBase < 1 || (version.majorBase === 1 && version.minorBase < 60);\n\t} catch {\n\t\treturn false;\n\t}\n}\n\nexport class ExtHostWebviews extends Disposable implements extHostProtocol.ExtHostWebviewsShape {\n\n\tprivate readonly _webviewProxy: extHostProtocol.MainThreadWebviewsShape;\n\n\tprivate readonly _webviews = new Map<extHostProtocol.WebviewHandle, ExtHostWebview>();\n\n\tconstructor(\n\t\tmainContext: extHostProtocol.IMainContext,\n\t\tprivate readonly remoteInfo: WebviewRemoteInfo,\n\t\tprivate readonly workspace: IExtHostWorkspace | undefined,\n\t\tprivate readonly _logService: ILogService,\n\t\tprivate readonly _deprecationService: IExtHostApiDeprecationService,\n\t) {\n\t\tsuper();\n\t\tthis._webviewProxy = mainContext.getProxy(extHostProtocol.MainContext.MainThreadWebviews);\n\t}\n\n\tpublic override dispose(): void {\n\t\tsuper.dispose();\n\n\t\tfor (const webview of this._webviews.values()) {\n\t\t\twebview.dispose();\n\t\t}\n\t\tthis._webviews.clear();\n\t}\n\n\tpublic $onMessage(\n\t\thandle: extHostProtocol.WebviewHandle,\n\t\tjsonMessage: string,\n\t\tbuffers: SerializableObjectWithBuffers<VSBuffer[]>\n\t): void {\n\t\tconst webview = this.getWebview(handle);\n\t\tif (webview) {\n\t\t\tconst { message } = deserializeWebviewMessage(jsonMessage, buffers.value);\n\t\t\twebview._onMessageEmitter.fire(message);\n\t\t}\n\t}\n\n\tpublic $onMissingCsp(\n\t\t_handle: extHostProtocol.WebviewHandle,\n\t\textensionId: string\n\t): void {\n\t\tthis._logService.warn(`${extensionId} created a webview without a content security policy: https://aka.ms/vscode-webview-missing-csp`);\n\t}\n\n\tpublic createNewWebview(handle: string, options: extHostProtocol.IWebviewContentOptions, extension: IExtensionDescription): ExtHostWebview {\n\t\tconst webview = new ExtHostWebview(handle, this._webviewProxy, reviveOptions(options), this.remoteInfo, this.workspace, extension, this._deprecationService);\n\t\tthis._webviews.set(handle, webview);\n\n\t\tconst sub = webview._onDidDispose(() => {\n\t\t\tsub.dispose();\n\t\t\tthis.deleteWebview(handle);\n\t\t});\n\n\t\treturn webview;\n\t}\n\n\tpublic deleteWebview(handle: string) {\n\t\tthis._webviews.delete(handle);\n\t}\n\n\tprivate getWebview(handle: extHostProtocol.WebviewHandle): ExtHostWebview | undefined {\n\t\treturn this._webviews.get(handle);\n\t}\n}\n\nexport function toExtensionData(extension: IExtensionDescription): extHostProtocol.WebviewExtensionDescription {\n\treturn { id: extension.identifier, location: extension.extensionLocation };\n}\n\nexport function serializeWebviewOptions(\n\textension: IExtensionDescription,\n\tworkspace: IExtHostWorkspace | undefined,\n\toptions: vscode.WebviewOptions,\n): extHostProtocol.IWebviewContentOptions {\n\treturn {\n\t\tenableCommandUris: options.enableCommandUris,\n\t\tenableScripts: options.enableScripts,\n\t\tenableForms: options.enableForms,\n\t\tportMapping: options.portMapping,\n\t\tlocalResourceRoots: options.localResourceRoots || getDefaultLocalResourceRoots(extension, workspace)\n\t};\n}\n\nfunction reviveOptions(options: extHostProtocol.IWebviewContentOptions): vscode.WebviewOptions {\n\treturn {\n\t\tenableCommandUris: options.enableCommandUris,\n\t\tenableScripts: options.enableScripts,\n\t\tenableForms: options.enableForms,\n\t\tportMapping: options.portMapping,\n\t\tlocalResourceRoots: options.localResourceRoots?.map(components => URI.from(components)),\n\t};\n}\n\nfunction getDefaultLocalResourceRoots(\n\textension: IExtensionDescription,\n\tworkspace: IExtHostWorkspace | undefined,\n): URI[] {\n\treturn [\n\t\t...(workspace?.getWorkspaceFolders() || []).map(x => x.uri),\n\t\textension.extensionLocation,\n\t];\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\n/* eslint-disable local/code-no-native-private */\n\nimport { VSBuffer } from '../../../base/common/buffer.js';\nimport { Emitter, Event } from '../../../base/common/event.js';\nimport { Disposable } from '../../../base/common/lifecycle.js';\nimport { Schemas } from '../../../base/common/network.js';\nimport * as objects from '../../../base/common/objects.js';\nimport { URI } from '../../../base/common/uri.js';\nimport { normalizeVersion, parseVersion } from '../../../platform/extensions/common/extensionValidator.js';\nimport { IExtensionDescription } from '../../../platform/extensions/common/extensions.js';\nimport { ILogService } from '../../../platform/log/common/log.js';\nimport { IExtHostApiDeprecationService } from './extHostApiDeprecationService.js';\nimport { deserializeWebviewMessage, serializeWebviewMessage } from './extHostWebviewMessaging.js';\nimport { IExtHostWorkspace } from './extHostWorkspace.js';\nimport { WebviewRemoteInfo, asWebviewUri, webviewGenericCspSource } from '../../contrib/webview/common/webview.js';\nimport { SerializableObjectWithBuffers } from '../../services/extensions/common/proxyIdentifier.js';\nimport type * as vscode from 'vscode';\nimport * as extHostProtocol from './extHost.protocol.js';\n\nexport class ExtHostWebview implements vscode.Webview {\n\n\treadonly #handle: extHostProtocol.WebviewHandle;\n\treadonly #proxy: extHostProtocol.MainThreadWebviewsShape;\n\treadonly #deprecationService: IExtHostApiDeprecationService;\n\n\treadonly #remoteInfo: WebviewRemoteInfo;\n\treadonly #workspace: IExtHostWorkspace | undefined;\n\treadonly #extension: IExtensionDescription;\n\n\t#html: string = '';\n\t#options: vscode.WebviewOptions;\n\t#isDisposed: boolean = false;\n\t#hasCalledAsWebviewUri = false;\n\n\t#serializeBuffersForPostMessage: boolean;\n\t#shouldRewriteOldResourceUris: boolean;\n\n\tconstructor(\n\t\thandle: extHostProtocol.WebviewHandle,\n\t\tproxy: extHostProtocol.MainThreadWebviewsShape,\n\t\toptions: vscode.WebviewOptions,\n\t\tremoteInfo: WebviewRemoteInfo,\n\t\tworkspace: IExtHostWorkspace | undefined,\n\t\textension: IExtensionDescription,\n\t\tdeprecationService: IExtHostApiDeprecationService,\n\t) {\n\t\tthis.#handle = handle;\n\t\tthis.#proxy = proxy;\n\t\tthis.#options = options;\n\t\tthis.#remoteInfo = remoteInfo;\n\t\tthis.#workspace = workspace;\n\t\tthis.#extension = extension;\n\t\tthis.#serializeBuffersForPostMessage = shouldSerializeBuffersForPostMessage(extension);\n\t\tthis.#shouldRewriteOldResourceUris = shouldTryRewritingOldResourceUris(extension);\n\t\tthis.#deprecationService = deprecationService;\n\t}\n\n\t/* internal */ readonly _onMessageEmitter = new Emitter<any>();\n\tpublic readonly onDidReceiveMessage: Event<any> = this._onMessageEmitter.event;\n\n\treadonly #onDidDisposeEmitter = new Emitter<void>();\n\t/* internal */ readonly _onDidDispose: Event<void> = this.#onDidDisposeEmitter.event;\n\n\tpublic dispose() {\n\t\tthis.#isDisposed = true;\n\n\t\tthis.#onDidDisposeEmitter.fire();\n\n\t\tthis.#onDidDisposeEmitter.dispose();\n\t\tthis._onMessageEmitter.dispose();\n\t}\n\n\tpublic asWebviewUri(resource: vscode.Uri): vscode.Uri {\n\t\tthis.#hasCalledAsWebviewUri = true;\n\t\treturn asWebviewUri(resource, this.#remoteInfo);\n\t}\n\n\tpublic get cspSource(): string {\n\t\tconst extensionLocation = this.#extension.extensionLocation;\n\t\tif (extensionLocation.scheme === Schemas.https || extensionLocation.scheme === Schemas.http) {\n\t\t\t// The extension is being served up from a CDN.\n\t\t\t// Also include the CDN in the default csp.\n\t\t\tlet extensionCspRule = extensionLocation.toString();\n\t\t\tif (!extensionCspRule.endsWith('/')) {\n\t\t\t\t// Always treat the location as a directory so that we allow all content under it\n\t\t\t\textensionCspRule += '/';\n\t\t\t}\n\t\t\treturn extensionCspRule + ' ' + webviewGenericCspSource;\n\t\t}\n\t\treturn webviewGenericCspSource;\n\t}\n\n\tpublic get html(): string {\n\t\tthis.assertNotDisposed();\n\t\treturn this.#html;\n\t}\n\n\tpublic set html(value: string) {\n\t\tthis.assertNotDisposed();\n\t\tif (this.#html !== value) {\n\t\t\tthis.#html = value;\n\t\t\tif (this.#shouldRewriteOldResourceUris && !this.#hasCalledAsWebviewUri && /([\"'])vscode-resource:([^\\s'\"]+?)([\"'])/i.test(value)) {\n\t\t\t\tthis.#hasCalledAsWebviewUri = true;\n\t\t\t\tthis.#deprecationService.report('Webview vscode-resource: uris', this.#extension,\n\t\t\t\t\t`Please migrate to use the 'webview.asWebviewUri' api instead: https://aka.ms/vscode-webview-use-aswebviewuri`);\n\t\t\t}\n\t\t\tthis.#proxy.$setHtml(this.#handle, this.rewriteOldResourceUrlsIfNeeded(value));\n\t\t}\n\t}\n\n\tpublic get options(): vscode.WebviewOptions {\n\t\tthis.assertNotDisposed();\n\t\treturn this.#options;\n\t}\n\n\tpublic set options(newOptions: vscode.WebviewOptions) {\n\t\tthis.assertNotDisposed();\n\n\t\tif (!objects.equals(this.#options, newOptions)) {\n\t\t\tthis.#proxy.$setOptions(this.#handle, serializeWebviewOptions(this.#extension, this.#workspace, newOptions));\n\t\t}\n\n\t\tthis.#options = newOptions;\n\t}\n\n\tpublic async postMessage(message: any): Promise<boolean> {\n\t\tif (this.#isDisposed) {\n\t\t\treturn false;\n\t\t}\n\t\tconst serialized = serializeWebviewMessage(message, { serializeBuffersForPostMessage: this.#serializeBuffersForPostMessage });\n\t\treturn this.#proxy.$postMessage(this.#handle, serialized.message, ...serialized.buffers);\n\t}\n\n\tprivate assertNotDisposed() {\n\t\tif (this.#isDisposed) {\n\t\t\tthrow new Error('Webview is disposed');\n\t\t}\n\t}\n\n\tprivate rewriteOldResourceUrlsIfNeeded(value: string): string {\n\t\tif (!this.#shouldRewriteOldResourceUris) {\n\t\t\treturn value;\n\t\t}\n\n\t\tconst isRemote = this.#extension.extensionLocation?.scheme === Schemas.vscodeRemote;\n\t\tconst remoteAuthority = this.#extension.extensionLocation.scheme === Schemas.vscodeRemote ? this.#extension.extensionLocation.authority : undefined;\n\t\treturn value\n\t\t\t.replace(/([\"'])(?:vscode-resource):(\\/\\/([^\\s\\/'\"]+?)(?=\\/))?([^\\s'\"]+?)([\"'])/gi, (_match, startQuote, _1, scheme, path, endQuote) => {\n\t\t\t\tconst uri = URI.from({\n\t\t\t\t\tscheme: scheme || 'file',\n\t\t\t\t\tpath: decodeURIComponent(path),\n\t\t\t\t});\n\t\t\t\tconst webviewUri = asWebviewUri(uri, { isRemote, authority: remoteAuthority }).toString();\n\t\t\t\treturn `${startQuote}${webviewUri}${endQuote}`;\n\t\t\t})\n\t\t\t.replace(/([\"'])(?:vscode-webview-resource):(\\/\\/[^\\s\\/'\"]+\\/([^\\s\\/'\"]+?)(?=\\/))?([^\\s'\"]+?)([\"'])/gi, (_match, startQuote, _1, scheme, path, endQuote) => {\n\t\t\t\tconst uri = URI.from({\n\t\t\t\t\tscheme: scheme || 'file',\n\t\t\t\t\tpath: decodeURIComponent(path),\n\t\t\t\t});\n\t\t\t\tconst webviewUri = asWebviewUri(uri, { isRemote, authority: remoteAuthority }).toString();\n\t\t\t\treturn `${startQuote}${webviewUri}${endQuote}`;\n\t\t\t});\n\t}\n}\n\nexport function shouldSerializeBuffersForPostMessage(extension: IExtensionDescription): boolean {\n\ttry {\n\t\tconst version = normalizeVersion(parseVersion(extension.engines.vscode));\n\t\treturn !!version && version.majorBase >= 1 && version.minorBase >= 57;\n\t} catch {\n\t\treturn false;\n\t}\n}\n\nfunction shouldTryRewritingOldResourceUris(extension: IExtensionDescription): boolean {\n\ttry {\n\t\tconst version = normalizeVersion(parseVersion(extension.engines.vscode));\n\t\tif (!version) {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn version.majorBase < 1 || (version.majorBase === 1 && version.minorBase < 60);\n\t} catch {\n\t\treturn false;\n\t}\n}\n\nexport class ExtHostWebviews extends Disposable implements extHostProtocol.ExtHostWebviewsShape {\n\n\tprivate readonly _webviewProxy: extHostProtocol.MainThreadWebviewsShape;\n\n\tprivate readonly _webviews = new Map<extHostProtocol.WebviewHandle, ExtHostWebview>();\n\n\tconstructor(\n\t\tmainContext: extHostProtocol.IMainContext,\n\t\tprivate readonly remoteInfo: WebviewRemoteInfo,\n\t\tprivate readonly workspace: IExtHostWorkspace | undefined,\n\t\tprivate readonly _logService: ILogService,\n\t\tprivate readonly _deprecationService: IExtHostApiDeprecationService,\n\t) {\n\t\tsuper();\n\t\tthis._webviewProxy = mainContext.getProxy(extHostProtocol.MainContext.MainThreadWebviews);\n\t}\n\n\tpublic override dispose(): void {\n\t\tsuper.dispose();\n\n\t\tfor (const webview of this._webviews.values()) {\n\t\t\twebview.dispose();\n\t\t}\n\t\tthis._webviews.clear();\n\t}\n\n\tpublic $onMessage(\n\t\thandle: extHostProtocol.WebviewHandle,\n\t\tjsonMessage: string,\n\t\tbuffers: SerializableObjectWithBuffers<VSBuffer[]>\n\t): void {\n\t\tconst webview = this.getWebview(handle);\n\t\tif (webview) {\n\t\t\tconst { message } = deserializeWebviewMessage(jsonMessage, buffers.value);\n\t\t\twebview._onMessageEmitter.fire(message);\n\t\t}\n\t}\n\n\tpublic $onMissingCsp(\n\t\t_handle: extHostProtocol.WebviewHandle,\n\t\textensionId: string\n\t): void {\n\t\tthis._logService.warn(`${extensionId} created a webview without a content security policy: https://aka.ms/vscode-webview-missing-csp`);\n\t}\n\n\tpublic createNewWebview(handle: string, options: extHostProtocol.IWebviewContentOptions, extension: IExtensionDescription): ExtHostWebview {\n\t\tconst webview = new ExtHostWebview(handle, this._webviewProxy, reviveOptions(options), this.remoteInfo, this.workspace, extension, this._deprecationService);\n\t\tthis._webviews.set(handle, webview);\n\n\t\tconst sub = webview._onDidDispose(() => {\n\t\t\tsub.dispose();\n\t\t\tthis.deleteWebview(handle);\n\t\t});\n\n\t\treturn webview;\n\t}\n\n\tpublic deleteWebview(handle: string) {\n\t\tthis._webviews.delete(handle);\n\t}\n\n\tprivate getWebview(handle: extHostProtocol.WebviewHandle): ExtHostWebview | undefined {\n\t\treturn this._webviews.get(handle);\n\t}\n}\n\nexport function toExtensionData(extension: IExtensionDescription): extHostProtocol.WebviewExtensionDescription {\n\treturn { id: extension.identifier, location: extension.extensionLocation };\n}\n\nexport function serializeWebviewOptions(\n\textension: IExtensionDescription,\n\tworkspace: IExtHostWorkspace | undefined,\n\toptions: vscode.WebviewOptions,\n): extHostProtocol.IWebviewContentOptions {\n\treturn {\n\t\tenableCommandUris: options.enableCommandUris,\n\t\tenableScripts: options.enableScripts,\n\t\tenableForms: options.enableForms,\n\t\tportMapping: options.portMapping,\n\t\tlocalResourceRoots: options.localResourceRoots || getDefaultLocalResourceRoots(extension, workspace)\n\t};\n}\n\nfunction reviveOptions(options: extHostProtocol.IWebviewContentOptions): vscode.WebviewOptions {\n\treturn {\n\t\tenableCommandUris: options.enableCommandUris,\n\t\tenableScripts: options.enableScripts,\n\t\tenableForms: options.enableForms,\n\t\tportMapping: options.portMapping,\n\t\tlocalResourceRoots: options.localResourceRoots?.map(components => URI.from(components)),\n\t};\n}\n\nfunction getDefaultLocalResourceRoots(\n\textension: IExtensionDescription,\n\tworkspace: IExtHostWorkspace | undefined,\n): URI[] {\n\treturn [\n\t\t...(workspace?.getWorkspaceFolders() || []).map(x => x.uri),\n\t\textension.extensionLocation,\n\t];\n}\n"]}