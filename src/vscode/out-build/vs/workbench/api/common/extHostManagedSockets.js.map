{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/api/common/extHostManagedSockets.ts","vs/workbench/api/common/extHostManagedSockets.ts"],"names":[],"mappings":"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","file":"extHostManagedSockets.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { ExtHostManagedSocketsShape, MainContext, MainThreadManagedSocketsShape } from './extHost.protocol.js';\nimport { createDecorator } from '../../../platform/instantiation/common/instantiation.js';\nimport * as vscode from 'vscode';\nimport { Disposable, DisposableStore, toDisposable } from '../../../base/common/lifecycle.js';\nimport { IExtHostRpcService } from './extHostRpcService.js';\nimport { VSBuffer } from '../../../base/common/buffer.js';\n\nexport interface IExtHostManagedSockets extends ExtHostManagedSocketsShape {\n\tsetFactory(socketFactoryId: number, makeConnection: () => Thenable<vscode.ManagedMessagePassing>): void;\n\treadonly _serviceBrand: undefined;\n}\n\nexport const IExtHostManagedSockets = createDecorator<IExtHostManagedSockets>('IExtHostManagedSockets');\n\nexport class ExtHostManagedSockets implements IExtHostManagedSockets {\n\tdeclare readonly _serviceBrand: undefined;\n\n\tprivate readonly _proxy: MainThreadManagedSocketsShape;\n\tprivate _remoteSocketIdCounter = 0;\n\tprivate _factory: ManagedSocketFactory | null = null;\n\tprivate readonly _managedRemoteSockets: Map<number, ManagedSocket> = new Map();\n\n\tconstructor(\n\t\t@IExtHostRpcService extHostRpc: IExtHostRpcService,\n\t) {\n\t\tthis._proxy = extHostRpc.getProxy(MainContext.MainThreadManagedSockets);\n\t}\n\n\tsetFactory(socketFactoryId: number, makeConnection: () => Thenable<vscode.ManagedMessagePassing>): void {\n\t\t// Terminate all previous sockets\n\t\tfor (const socket of this._managedRemoteSockets.values()) {\n\t\t\t// calling dispose() will lead to it removing itself from the map\n\t\t\tsocket.dispose();\n\t\t}\n\t\t// Unregister previous factory\n\t\tif (this._factory) {\n\t\t\tthis._proxy.$unregisterSocketFactory(this._factory.socketFactoryId);\n\t\t}\n\n\t\tthis._factory = new ManagedSocketFactory(socketFactoryId, makeConnection);\n\t\tthis._proxy.$registerSocketFactory(this._factory.socketFactoryId);\n\t}\n\n\tasync $openRemoteSocket(socketFactoryId: number): Promise<number> {\n\t\tif (!this._factory || this._factory.socketFactoryId !== socketFactoryId) {\n\t\t\tthrow new Error(`No socket factory with id ${socketFactoryId}`);\n\t\t}\n\n\t\tconst id = (++this._remoteSocketIdCounter);\n\t\tconst socket = await this._factory.makeConnection();\n\t\tconst disposable = new DisposableStore();\n\t\tthis._managedRemoteSockets.set(id, new ManagedSocket(id, socket, disposable));\n\n\t\tdisposable.add(toDisposable(() => this._managedRemoteSockets.delete(id)));\n\t\tdisposable.add(socket.onDidEnd(() => {\n\t\t\tthis._proxy.$onDidManagedSocketEnd(id);\n\t\t\tdisposable.dispose();\n\t\t}));\n\t\tdisposable.add(socket.onDidClose(e => {\n\t\t\tthis._proxy.$onDidManagedSocketClose(id, e?.stack ?? e?.message);\n\t\t\tdisposable.dispose();\n\t\t}));\n\t\tdisposable.add(socket.onDidReceiveMessage(e => this._proxy.$onDidManagedSocketHaveData(id, VSBuffer.wrap(e))));\n\n\t\treturn id;\n\t}\n\n\t$remoteSocketWrite(socketId: number, buffer: VSBuffer): void {\n\t\tthis._managedRemoteSockets.get(socketId)?.actual.send(buffer.buffer);\n\t}\n\n\t$remoteSocketEnd(socketId: number): void {\n\t\tconst socket = this._managedRemoteSockets.get(socketId);\n\t\tif (socket) {\n\t\t\tsocket.actual.end();\n\t\t\tsocket.dispose();\n\t\t}\n\t}\n\n\tasync $remoteSocketDrain(socketId: number): Promise<void> {\n\t\tawait this._managedRemoteSockets.get(socketId)?.actual.drain?.();\n\t}\n}\n\nclass ManagedSocketFactory {\n\tconstructor(\n\t\tpublic readonly socketFactoryId: number,\n\t\tpublic readonly makeConnection: () => Thenable<vscode.ManagedMessagePassing>,\n\t) { }\n}\n\nclass ManagedSocket extends Disposable {\n\tconstructor(\n\t\tpublic readonly socketId: number,\n\t\tpublic readonly actual: vscode.ManagedMessagePassing,\n\t\tdisposer: DisposableStore,\n\t) {\n\t\tsuper();\n\t\tthis._register(disposer);\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { ExtHostManagedSocketsShape, MainContext, MainThreadManagedSocketsShape } from './extHost.protocol.js';\nimport { createDecorator } from '../../../platform/instantiation/common/instantiation.js';\nimport * as vscode from 'vscode';\nimport { Disposable, DisposableStore, toDisposable } from '../../../base/common/lifecycle.js';\nimport { IExtHostRpcService } from './extHostRpcService.js';\nimport { VSBuffer } from '../../../base/common/buffer.js';\n\nexport interface IExtHostManagedSockets extends ExtHostManagedSocketsShape {\n\tsetFactory(socketFactoryId: number, makeConnection: () => Thenable<vscode.ManagedMessagePassing>): void;\n\treadonly _serviceBrand: undefined;\n}\n\nexport const IExtHostManagedSockets = createDecorator<IExtHostManagedSockets>('IExtHostManagedSockets');\n\nexport class ExtHostManagedSockets implements IExtHostManagedSockets {\n\tdeclare readonly _serviceBrand: undefined;\n\n\tprivate readonly _proxy: MainThreadManagedSocketsShape;\n\tprivate _remoteSocketIdCounter = 0;\n\tprivate _factory: ManagedSocketFactory | null = null;\n\tprivate readonly _managedRemoteSockets: Map<number, ManagedSocket> = new Map();\n\n\tconstructor(\n\t\t@IExtHostRpcService extHostRpc: IExtHostRpcService,\n\t) {\n\t\tthis._proxy = extHostRpc.getProxy(MainContext.MainThreadManagedSockets);\n\t}\n\n\tsetFactory(socketFactoryId: number, makeConnection: () => Thenable<vscode.ManagedMessagePassing>): void {\n\t\t// Terminate all previous sockets\n\t\tfor (const socket of this._managedRemoteSockets.values()) {\n\t\t\t// calling dispose() will lead to it removing itself from the map\n\t\t\tsocket.dispose();\n\t\t}\n\t\t// Unregister previous factory\n\t\tif (this._factory) {\n\t\t\tthis._proxy.$unregisterSocketFactory(this._factory.socketFactoryId);\n\t\t}\n\n\t\tthis._factory = new ManagedSocketFactory(socketFactoryId, makeConnection);\n\t\tthis._proxy.$registerSocketFactory(this._factory.socketFactoryId);\n\t}\n\n\tasync $openRemoteSocket(socketFactoryId: number): Promise<number> {\n\t\tif (!this._factory || this._factory.socketFactoryId !== socketFactoryId) {\n\t\t\tthrow new Error(`No socket factory with id ${socketFactoryId}`);\n\t\t}\n\n\t\tconst id = (++this._remoteSocketIdCounter);\n\t\tconst socket = await this._factory.makeConnection();\n\t\tconst disposable = new DisposableStore();\n\t\tthis._managedRemoteSockets.set(id, new ManagedSocket(id, socket, disposable));\n\n\t\tdisposable.add(toDisposable(() => this._managedRemoteSockets.delete(id)));\n\t\tdisposable.add(socket.onDidEnd(() => {\n\t\t\tthis._proxy.$onDidManagedSocketEnd(id);\n\t\t\tdisposable.dispose();\n\t\t}));\n\t\tdisposable.add(socket.onDidClose(e => {\n\t\t\tthis._proxy.$onDidManagedSocketClose(id, e?.stack ?? e?.message);\n\t\t\tdisposable.dispose();\n\t\t}));\n\t\tdisposable.add(socket.onDidReceiveMessage(e => this._proxy.$onDidManagedSocketHaveData(id, VSBuffer.wrap(e))));\n\n\t\treturn id;\n\t}\n\n\t$remoteSocketWrite(socketId: number, buffer: VSBuffer): void {\n\t\tthis._managedRemoteSockets.get(socketId)?.actual.send(buffer.buffer);\n\t}\n\n\t$remoteSocketEnd(socketId: number): void {\n\t\tconst socket = this._managedRemoteSockets.get(socketId);\n\t\tif (socket) {\n\t\t\tsocket.actual.end();\n\t\t\tsocket.dispose();\n\t\t}\n\t}\n\n\tasync $remoteSocketDrain(socketId: number): Promise<void> {\n\t\tawait this._managedRemoteSockets.get(socketId)?.actual.drain?.();\n\t}\n}\n\nclass ManagedSocketFactory {\n\tconstructor(\n\t\tpublic readonly socketFactoryId: number,\n\t\tpublic readonly makeConnection: () => Thenable<vscode.ManagedMessagePassing>,\n\t) { }\n}\n\nclass ManagedSocket extends Disposable {\n\tconstructor(\n\t\tpublic readonly socketId: number,\n\t\tpublic readonly actual: vscode.ManagedMessagePassing,\n\t\tdisposer: DisposableStore,\n\t) {\n\t\tsuper();\n\t\tthis._register(disposer);\n\t}\n}\n"]}