{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/api/common/extHostMemento.ts","vs/workbench/api/common/extHostMemento.ts"],"names":[],"mappings":"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","file":"extHostMemento.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport type * as vscode from 'vscode';\nimport { IDisposable } from '../../../base/common/lifecycle.js';\nimport { ExtHostStorage } from './extHostStorage.js';\nimport { IExtensionDescription } from '../../../platform/extensions/common/extensions.js';\nimport { DeferredPromise, RunOnceScheduler } from '../../../base/common/async.js';\n\nexport class ExtensionMemento implements vscode.Memento {\n\n\tprotected readonly _id: string;\n\tprivate readonly _shared: boolean;\n\tprotected readonly _storage: ExtHostStorage;\n\n\tprivate readonly _init: Promise<ExtensionMemento>;\n\tprivate _value?: { [n: string]: any };\n\tprivate readonly _storageListener: IDisposable;\n\n\tprivate _deferredPromises: Map<string, DeferredPromise<void>> = new Map();\n\tprivate _scheduler: RunOnceScheduler;\n\n\tconstructor(id: string, global: boolean, storage: ExtHostStorage) {\n\t\tthis._id = id;\n\t\tthis._shared = global;\n\t\tthis._storage = storage;\n\n\t\tthis._init = this._storage.initializeExtensionStorage(this._shared, this._id, Object.create(null)).then(value => {\n\t\t\tthis._value = value;\n\t\t\treturn this;\n\t\t});\n\n\t\tthis._storageListener = this._storage.onDidChangeStorage(e => {\n\t\t\tif (e.shared === this._shared && e.key === this._id) {\n\t\t\t\tthis._value = e.value;\n\t\t\t}\n\t\t});\n\n\t\tthis._scheduler = new RunOnceScheduler(() => {\n\t\t\tconst records = this._deferredPromises;\n\t\t\tthis._deferredPromises = new Map();\n\t\t\t(async () => {\n\t\t\t\ttry {\n\t\t\t\t\tawait this._storage.setValue(this._shared, this._id, this._value!);\n\t\t\t\t\tfor (const value of records.values()) {\n\t\t\t\t\t\tvalue.complete();\n\t\t\t\t\t}\n\t\t\t\t} catch (e) {\n\t\t\t\t\tfor (const value of records.values()) {\n\t\t\t\t\t\tvalue.error(e);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t})();\n\t\t}, 0);\n\t}\n\n\tkeys(): readonly string[] {\n\t\t// Filter out `undefined` values, as they can stick around in the `_value` until the `onDidChangeStorage` event runs\n\t\treturn Object.entries(this._value ?? {}).filter(([, value]) => value !== undefined).map(([key]) => key);\n\t}\n\n\tget whenReady(): Promise<ExtensionMemento> {\n\t\treturn this._init;\n\t}\n\n\tget<T>(key: string): T | undefined;\n\tget<T>(key: string, defaultValue: T): T;\n\tget<T>(key: string, defaultValue?: T): T {\n\t\tlet value = this._value![key];\n\t\tif (typeof value === 'undefined') {\n\t\t\tvalue = defaultValue;\n\t\t}\n\t\treturn value;\n\t}\n\n\tupdate(key: string, value: any): Promise<void> {\n\t\tif (value !== null && typeof value === 'object') {\n\t\t\t// Prevent the value from being as-is for until we have\n\t\t\t// received the change event from the main side by emulating\n\t\t\t// the treatment of values via JSON parsing and stringifying.\n\t\t\t// (https://github.com/microsoft/vscode/issues/209479)\n\t\t\tthis._value![key] = JSON.parse(JSON.stringify(value));\n\t\t} else {\n\t\t\tthis._value![key] = value;\n\t\t}\n\n\t\tconst record = this._deferredPromises.get(key);\n\t\tif (record !== undefined) {\n\t\t\treturn record.p;\n\t\t}\n\n\t\tconst promise = new DeferredPromise<void>();\n\t\tthis._deferredPromises.set(key, promise);\n\n\t\tif (!this._scheduler.isScheduled()) {\n\t\t\tthis._scheduler.schedule();\n\t\t}\n\n\t\treturn promise.p;\n\t}\n\n\tdispose(): void {\n\t\tthis._storageListener.dispose();\n\t}\n}\n\nexport class ExtensionGlobalMemento extends ExtensionMemento {\n\n\tprivate readonly _extension: IExtensionDescription;\n\n\tsetKeysForSync(keys: string[]): void {\n\t\tthis._storage.registerExtensionStorageKeysToSync({ id: this._id, version: this._extension.version }, keys);\n\t}\n\n\tconstructor(extensionDescription: IExtensionDescription, storage: ExtHostStorage) {\n\t\tsuper(extensionDescription.identifier.value, true, storage);\n\t\tthis._extension = extensionDescription;\n\t}\n\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport type * as vscode from 'vscode';\nimport { IDisposable } from '../../../base/common/lifecycle.js';\nimport { ExtHostStorage } from './extHostStorage.js';\nimport { IExtensionDescription } from '../../../platform/extensions/common/extensions.js';\nimport { DeferredPromise, RunOnceScheduler } from '../../../base/common/async.js';\n\nexport class ExtensionMemento implements vscode.Memento {\n\n\tprotected readonly _id: string;\n\tprivate readonly _shared: boolean;\n\tprotected readonly _storage: ExtHostStorage;\n\n\tprivate readonly _init: Promise<ExtensionMemento>;\n\tprivate _value?: { [n: string]: any };\n\tprivate readonly _storageListener: IDisposable;\n\n\tprivate _deferredPromises: Map<string, DeferredPromise<void>> = new Map();\n\tprivate _scheduler: RunOnceScheduler;\n\n\tconstructor(id: string, global: boolean, storage: ExtHostStorage) {\n\t\tthis._id = id;\n\t\tthis._shared = global;\n\t\tthis._storage = storage;\n\n\t\tthis._init = this._storage.initializeExtensionStorage(this._shared, this._id, Object.create(null)).then(value => {\n\t\t\tthis._value = value;\n\t\t\treturn this;\n\t\t});\n\n\t\tthis._storageListener = this._storage.onDidChangeStorage(e => {\n\t\t\tif (e.shared === this._shared && e.key === this._id) {\n\t\t\t\tthis._value = e.value;\n\t\t\t}\n\t\t});\n\n\t\tthis._scheduler = new RunOnceScheduler(() => {\n\t\t\tconst records = this._deferredPromises;\n\t\t\tthis._deferredPromises = new Map();\n\t\t\t(async () => {\n\t\t\t\ttry {\n\t\t\t\t\tawait this._storage.setValue(this._shared, this._id, this._value!);\n\t\t\t\t\tfor (const value of records.values()) {\n\t\t\t\t\t\tvalue.complete();\n\t\t\t\t\t}\n\t\t\t\t} catch (e) {\n\t\t\t\t\tfor (const value of records.values()) {\n\t\t\t\t\t\tvalue.error(e);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t})();\n\t\t}, 0);\n\t}\n\n\tkeys(): readonly string[] {\n\t\t// Filter out `undefined` values, as they can stick around in the `_value` until the `onDidChangeStorage` event runs\n\t\treturn Object.entries(this._value ?? {}).filter(([, value]) => value !== undefined).map(([key]) => key);\n\t}\n\n\tget whenReady(): Promise<ExtensionMemento> {\n\t\treturn this._init;\n\t}\n\n\tget<T>(key: string): T | undefined;\n\tget<T>(key: string, defaultValue: T): T;\n\tget<T>(key: string, defaultValue?: T): T {\n\t\tlet value = this._value![key];\n\t\tif (typeof value === 'undefined') {\n\t\t\tvalue = defaultValue;\n\t\t}\n\t\treturn value;\n\t}\n\n\tupdate(key: string, value: any): Promise<void> {\n\t\tif (value !== null && typeof value === 'object') {\n\t\t\t// Prevent the value from being as-is for until we have\n\t\t\t// received the change event from the main side by emulating\n\t\t\t// the treatment of values via JSON parsing and stringifying.\n\t\t\t// (https://github.com/microsoft/vscode/issues/209479)\n\t\t\tthis._value![key] = JSON.parse(JSON.stringify(value));\n\t\t} else {\n\t\t\tthis._value![key] = value;\n\t\t}\n\n\t\tconst record = this._deferredPromises.get(key);\n\t\tif (record !== undefined) {\n\t\t\treturn record.p;\n\t\t}\n\n\t\tconst promise = new DeferredPromise<void>();\n\t\tthis._deferredPromises.set(key, promise);\n\n\t\tif (!this._scheduler.isScheduled()) {\n\t\t\tthis._scheduler.schedule();\n\t\t}\n\n\t\treturn promise.p;\n\t}\n\n\tdispose(): void {\n\t\tthis._storageListener.dispose();\n\t}\n}\n\nexport class ExtensionGlobalMemento extends ExtensionMemento {\n\n\tprivate readonly _extension: IExtensionDescription;\n\n\tsetKeysForSync(keys: string[]): void {\n\t\tthis._storage.registerExtensionStorageKeysToSync({ id: this._id, version: this._extension.version }, keys);\n\t}\n\n\tconstructor(extensionDescription: IExtensionDescription, storage: ExtHostStorage) {\n\t\tsuper(extensionDescription.identifier.value, true, storage);\n\t\tthis._extension = extensionDescription;\n\t}\n\n}\n"]}