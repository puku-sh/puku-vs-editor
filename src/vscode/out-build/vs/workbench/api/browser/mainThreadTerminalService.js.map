{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/api/browser/mainThreadTerminalService.ts","vs/workbench/api/browser/mainThreadTerminalService.ts"],"names":[],"mappings":"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","file":"mainThreadTerminalService.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { DisposableStore, Disposable, IDisposable, MutableDisposable, combinedDisposable, toDisposable } from '../../../base/common/lifecycle.js';\nimport { ExtHostContext, ExtHostTerminalServiceShape, MainThreadTerminalServiceShape, MainContext, TerminalLaunchConfig, ITerminalDimensionsDto, ExtHostTerminalIdentifier, TerminalQuickFix, ITerminalCommandDto } from '../common/extHost.protocol.js';\nimport { extHostNamedCustomer, IExtHostContext } from '../../services/extensions/common/extHostCustomers.js';\nimport { URI } from '../../../base/common/uri.js';\nimport { IInstantiationService } from '../../../platform/instantiation/common/instantiation.js';\nimport { ILogService } from '../../../platform/log/common/log.js';\nimport { IProcessProperty, IProcessReadyWindowsPty, IShellLaunchConfig, IShellLaunchConfigDto, ITerminalOutputMatch, ITerminalOutputMatcher, ProcessPropertyType, TerminalExitReason, TerminalLocation, type IProcessPropertyMap } from '../../../platform/terminal/common/terminal.js';\nimport { TerminalDataBufferer } from '../../../platform/terminal/common/terminalDataBuffering.js';\nimport { ITerminalEditorService, ITerminalExternalLinkProvider, ITerminalGroupService, ITerminalInstance, ITerminalLink, ITerminalService } from '../../contrib/terminal/browser/terminal.js';\nimport { TerminalProcessExtHostProxy } from '../../contrib/terminal/browser/terminalProcessExtHostProxy.js';\nimport { IEnvironmentVariableService } from '../../contrib/terminal/common/environmentVariable.js';\nimport { deserializeEnvironmentDescriptionMap, deserializeEnvironmentVariableCollection, serializeEnvironmentVariableCollection } from '../../../platform/terminal/common/environmentVariableShared.js';\nimport { IStartExtensionTerminalRequest, ITerminalProcessExtHostProxy, ITerminalProfileResolverService, ITerminalProfileService } from '../../contrib/terminal/common/terminal.js';\nimport { IRemoteAgentService } from '../../services/remote/common/remoteAgentService.js';\nimport { OperatingSystem, OS } from '../../../base/common/platform.js';\nimport { TerminalEditorLocationOptions } from 'vscode';\nimport { Promises } from '../../../base/common/async.js';\nimport { ISerializableEnvironmentDescriptionMap, ISerializableEnvironmentVariableCollection } from '../../../platform/terminal/common/environmentVariable.js';\nimport { ITerminalLinkProviderService } from '../../contrib/terminalContrib/links/browser/links.js';\nimport { ITerminalQuickFixService, ITerminalQuickFix, TerminalQuickFixType } from '../../contrib/terminalContrib/quickFix/browser/quickFix.js';\nimport { TerminalCapability } from '../../../platform/terminal/common/capabilities/capabilities.js';\nimport { ITerminalCompletionService } from '../../contrib/terminalContrib/suggest/browser/terminalCompletionService.js';\nimport { IWorkbenchEnvironmentService } from '../../services/environment/common/environmentService.js';\nimport { hasKey } from '../../../base/common/types.js';\n\n@extHostNamedCustomer(MainContext.MainThreadTerminalService)\nexport class MainThreadTerminalService extends Disposable implements MainThreadTerminalServiceShape {\n\n\tprivate readonly _proxy: ExtHostTerminalServiceShape;\n\n\t/**\n\t * Stores a map from a temporary terminal id (a UUID generated on the extension host side)\n\t * to a numeric terminal id (an id generated on the renderer side)\n\t * This comes in play only when dealing with terminals created on the extension host side\n\t */\n\tprivate readonly _extHostTerminals = new Map<string, Promise<ITerminalInstance>>();\n\tprivate readonly _terminalProcessProxies = new Map<number, { proxy: ITerminalProcessExtHostProxy; store: DisposableStore }>();\n\tprivate readonly _profileProviders = new Map<string, IDisposable>();\n\tprivate readonly _completionProviders = new Map<string, IDisposable>();\n\tprivate readonly _quickFixProviders = new Map<string, IDisposable>();\n\tprivate readonly _dataEventTracker = this._register(new MutableDisposable<TerminalDataEventTracker>());\n\tprivate readonly _sendCommandEventListener = this._register(new MutableDisposable());\n\n\t/**\n\t * A single shared terminal link provider for the exthost. When an ext registers a link\n\t * provider, this is registered with the terminal on the renderer side and all links are\n\t * provided through this, even from multiple ext link providers. Xterm should remove lower\n\t * priority intersecting links itself.\n\t */\n\tprivate readonly _linkProvider = this._register(new MutableDisposable());\n\n\tprivate _os: OperatingSystem = OS;\n\n\tconstructor(\n\t\t_extHostContext: IExtHostContext,\n\t\t@ITerminalService private readonly _terminalService: ITerminalService,\n\t\t@ITerminalLinkProviderService private readonly _terminalLinkProviderService: ITerminalLinkProviderService,\n\t\t@ITerminalQuickFixService private readonly _terminalQuickFixService: ITerminalQuickFixService,\n\t\t@IInstantiationService private readonly _instantiationService: IInstantiationService,\n\t\t@IEnvironmentVariableService private readonly _environmentVariableService: IEnvironmentVariableService,\n\t\t@ILogService private readonly _logService: ILogService,\n\t\t@ITerminalProfileResolverService private readonly _terminalProfileResolverService: ITerminalProfileResolverService,\n\t\t@IRemoteAgentService remoteAgentService: IRemoteAgentService,\n\t\t@ITerminalGroupService private readonly _terminalGroupService: ITerminalGroupService,\n\t\t@ITerminalEditorService private readonly _terminalEditorService: ITerminalEditorService,\n\t\t@ITerminalProfileService private readonly _terminalProfileService: ITerminalProfileService,\n\t\t@ITerminalCompletionService private readonly _terminalCompletionService: ITerminalCompletionService,\n\t\t@IWorkbenchEnvironmentService private readonly _environmentService: IWorkbenchEnvironmentService,\n\t) {\n\t\tsuper();\n\t\tthis._proxy = _extHostContext.getProxy(ExtHostContext.ExtHostTerminalService);\n\n\t\t// ITerminalService listeners\n\t\tthis._register(_terminalService.onDidCreateInstance((instance) => {\n\t\t\tthis._onTerminalOpened(instance);\n\t\t\tthis._onInstanceDimensionsChanged(instance);\n\t\t}));\n\n\t\tthis._register(_terminalService.onDidDisposeInstance(instance => this._onTerminalDisposed(instance)));\n\t\tthis._register(_terminalService.onAnyInstanceProcessIdReady(instance => this._onTerminalProcessIdReady(instance)));\n\t\tthis._register(_terminalService.onDidChangeInstanceDimensions(instance => this._onInstanceDimensionsChanged(instance)));\n\t\tthis._register(_terminalService.onAnyInstanceMaximumDimensionsChange(instance => this._onInstanceMaximumDimensionsChanged(instance)));\n\t\tthis._register(_terminalService.onDidRequestStartExtensionTerminal(e => this._onRequestStartExtensionTerminal(e)));\n\t\tthis._register(_terminalService.onDidChangeActiveInstance(instance => this._onActiveTerminalChanged(instance ? instance.instanceId : null)));\n\t\tthis._register(_terminalService.onAnyInstanceTitleChange(instance => instance && this._onTitleChanged(instance.instanceId, instance.title)));\n\t\tthis._register(_terminalService.onAnyInstanceDataInput(instance => this._proxy.$acceptTerminalInteraction(instance.instanceId)));\n\t\tthis._register(_terminalService.onAnyInstanceSelectionChange(instance => this._proxy.$acceptTerminalSelection(instance.instanceId, instance.selection)));\n\t\tthis._register(_terminalService.onAnyInstanceShellTypeChanged(instance => this._onShellTypeChanged(instance.instanceId)));\n\n\t\t// Set initial ext host state\n\t\tfor (const instance of this._terminalService.instances) {\n\t\t\tthis._onTerminalOpened(instance);\n\t\t\tinstance.processReady.then(() => this._onTerminalProcessIdReady(instance));\n\t\t\tif (instance.shellType) {\n\t\t\t\tthis._proxy.$acceptTerminalShellType(instance.instanceId, instance.shellType);\n\t\t\t}\n\t\t}\n\t\tconst activeInstance = this._terminalService.activeInstance;\n\t\tif (activeInstance) {\n\t\t\tthis._proxy.$acceptActiveTerminalChanged(activeInstance.instanceId);\n\t\t}\n\t\tif (this._environmentVariableService.collections.size > 0) {\n\t\t\tconst collectionAsArray = [...this._environmentVariableService.collections.entries()];\n\t\t\tconst serializedCollections: [string, ISerializableEnvironmentVariableCollection][] = collectionAsArray.map(e => {\n\t\t\t\treturn [e[0], serializeEnvironmentVariableCollection(e[1].map)];\n\t\t\t});\n\t\t\tthis._proxy.$initEnvironmentVariableCollections(serializedCollections);\n\t\t}\n\n\t\tthis._store.add(toDisposable(() => {\n\t\t\tfor (const e of this._terminalProcessProxies.values()) {\n\t\t\t\te.proxy.dispose();\n\t\t\t\te.store.dispose();\n\t\t\t}\n\t\t\tthis._terminalProcessProxies.clear();\n\t\t}));\n\n\t\tremoteAgentService.getEnvironment().then(async env => {\n\t\t\tthis._os = env?.os || OS;\n\t\t\tthis._updateDefaultProfile();\n\t\t});\n\t\tthis._register(this._terminalProfileService.onDidChangeAvailableProfiles(() => this._updateDefaultProfile()));\n\n\t\tthis._register(toDisposable(() => {\n\t\t\tfor (const provider of this._profileProviders.values()) {\n\t\t\t\tprovider.dispose();\n\t\t\t}\n\t\t\tfor (const provider of this._quickFixProviders.values()) {\n\t\t\t\tprovider.dispose();\n\t\t\t}\n\t\t}));\n\t}\n\n\tprivate async _updateDefaultProfile() {\n\t\tconst remoteAuthority = this._environmentService.remoteAuthority;\n\t\tconst defaultProfile = this._terminalProfileResolverService.getDefaultProfile({ remoteAuthority, os: this._os });\n\t\tconst defaultAutomationProfile = this._terminalProfileResolverService.getDefaultProfile({ remoteAuthority, os: this._os, allowAutomationShell: true });\n\t\tthis._proxy.$acceptDefaultProfile(...await Promise.all([defaultProfile, defaultAutomationProfile]));\n\t}\n\n\tprivate async _getTerminalInstance(id: ExtHostTerminalIdentifier): Promise<ITerminalInstance | undefined> {\n\t\tif (typeof id === 'string') {\n\t\t\treturn this._extHostTerminals.get(id);\n\t\t}\n\t\treturn this._terminalService.getInstanceFromId(id);\n\t}\n\n\tpublic async $createTerminal(extHostTerminalId: string, launchConfig: TerminalLaunchConfig): Promise<void> {\n\t\tconst shellLaunchConfig: IShellLaunchConfig = {\n\t\t\tname: launchConfig.name,\n\t\t\texecutable: launchConfig.shellPath,\n\t\t\targs: launchConfig.shellArgs,\n\t\t\tcwd: typeof launchConfig.cwd === 'string' ? launchConfig.cwd : URI.revive(launchConfig.cwd),\n\t\t\ticon: launchConfig.icon,\n\t\t\tcolor: launchConfig.color,\n\t\t\tinitialText: launchConfig.initialText,\n\t\t\twaitOnExit: launchConfig.waitOnExit,\n\t\t\tignoreConfigurationCwd: true,\n\t\t\tenv: launchConfig.env,\n\t\t\tstrictEnv: launchConfig.strictEnv,\n\t\t\thideFromUser: launchConfig.hideFromUser,\n\t\t\tcustomPtyImplementation: launchConfig.isExtensionCustomPtyTerminal\n\t\t\t\t? (id, cols, rows) => new TerminalProcessExtHostProxy(id, cols, rows, this._terminalService)\n\t\t\t\t: undefined,\n\t\t\textHostTerminalId,\n\t\t\tforceShellIntegration: launchConfig.forceShellIntegration,\n\t\t\tisFeatureTerminal: launchConfig.isFeatureTerminal,\n\t\t\tisExtensionOwnedTerminal: launchConfig.isExtensionOwnedTerminal,\n\t\t\tuseShellEnvironment: launchConfig.useShellEnvironment,\n\t\t\tisTransient: launchConfig.isTransient,\n\t\t\tshellIntegrationNonce: launchConfig.shellIntegrationNonce\n\t\t};\n\t\tconst terminal = Promises.withAsyncBody<ITerminalInstance>(async r => {\n\t\t\tconst terminal = await this._terminalService.createTerminal({\n\t\t\t\tconfig: shellLaunchConfig,\n\t\t\t\tlocation: await this._deserializeParentTerminal(launchConfig.location)\n\t\t\t});\n\t\t\tr(terminal);\n\t\t});\n\t\tthis._extHostTerminals.set(extHostTerminalId, terminal);\n\t\tconst terminalInstance = await terminal;\n\t\tthis._register(terminalInstance.onDisposed(() => {\n\t\t\tthis._extHostTerminals.delete(extHostTerminalId);\n\t\t}));\n\t}\n\n\tprivate async _deserializeParentTerminal(location?: TerminalLocation | TerminalEditorLocationOptions | { parentTerminal: ExtHostTerminalIdentifier } | { splitActiveTerminal: boolean; location?: TerminalLocation }): Promise<TerminalLocation | TerminalEditorLocationOptions | { parentTerminal: ITerminalInstance } | { splitActiveTerminal: boolean } | undefined> {\n\t\tif (typeof location === 'object' && hasKey(location, { parentTerminal: true })) {\n\t\t\tconst parentTerminal = await this._extHostTerminals.get(location.parentTerminal.toString());\n\t\t\treturn parentTerminal ? { parentTerminal } : undefined;\n\t\t}\n\t\treturn location;\n\t}\n\n\tpublic async $show(id: ExtHostTerminalIdentifier, preserveFocus: boolean): Promise<void> {\n\t\tconst terminalInstance = await this._getTerminalInstance(id);\n\t\tif (terminalInstance) {\n\t\t\tthis._terminalService.setActiveInstance(terminalInstance);\n\t\t\tif (terminalInstance.target === TerminalLocation.Editor) {\n\t\t\t\tawait this._terminalEditorService.revealActiveEditor(preserveFocus);\n\t\t\t} else {\n\t\t\t\tawait this._terminalGroupService.showPanel(!preserveFocus);\n\t\t\t}\n\t\t}\n\t}\n\n\tpublic async $hide(id: ExtHostTerminalIdentifier): Promise<void> {\n\t\tconst instanceToHide = await this._getTerminalInstance(id);\n\t\tconst activeInstance = this._terminalService.activeInstance;\n\t\tif (activeInstance && activeInstance.instanceId === instanceToHide?.instanceId && activeInstance.target !== TerminalLocation.Editor) {\n\t\t\tthis._terminalGroupService.hidePanel();\n\t\t}\n\t}\n\n\tpublic async $dispose(id: ExtHostTerminalIdentifier): Promise<void> {\n\t\t(await this._getTerminalInstance(id))?.dispose(TerminalExitReason.Extension);\n\t}\n\n\tpublic async $sendText(id: ExtHostTerminalIdentifier, text: string, shouldExecute: boolean): Promise<void> {\n\t\tconst instance = await this._getTerminalInstance(id);\n\t\tawait instance?.sendText(text, shouldExecute);\n\t}\n\n\tpublic $sendProcessExit(terminalId: number, exitCode: number | undefined): void {\n\t\tthis._terminalProcessProxies.get(terminalId)?.proxy.emitExit(exitCode);\n\t}\n\n\tpublic $startSendingDataEvents(): void {\n\t\tif (!this._dataEventTracker.value) {\n\t\t\tthis._dataEventTracker.value = this._instantiationService.createInstance(TerminalDataEventTracker, (id, data) => {\n\t\t\t\tthis._onTerminalData(id, data);\n\t\t\t});\n\t\t\t// Send initial events if they exist\n\t\t\tfor (const instance of this._terminalService.instances) {\n\t\t\t\tfor (const data of instance.initialDataEvents || []) {\n\t\t\t\t\tthis._onTerminalData(instance.instanceId, data);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tpublic $stopSendingDataEvents(): void {\n\t\tthis._dataEventTracker.clear();\n\t}\n\n\tpublic $startSendingCommandEvents(): void {\n\t\tif (this._sendCommandEventListener.value) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst multiplexer = this._terminalService.createOnInstanceCapabilityEvent(TerminalCapability.CommandDetection, capability => capability.onCommandFinished);\n\t\tconst sub = multiplexer.event(e => {\n\t\t\tthis._onDidExecuteCommand(e.instance.instanceId, {\n\t\t\t\tcommandLine: e.data.command,\n\t\t\t\t// TODO: Convert to URI if possible\n\t\t\t\tcwd: e.data.cwd,\n\t\t\t\texitCode: e.data.exitCode,\n\t\t\t\toutput: e.data.getOutput()\n\t\t\t});\n\t\t});\n\t\tthis._sendCommandEventListener.value = combinedDisposable(multiplexer, sub);\n\t}\n\n\tpublic $stopSendingCommandEvents(): void {\n\t\tthis._sendCommandEventListener.clear();\n\t}\n\n\tpublic $startLinkProvider(): void {\n\t\tthis._linkProvider.value = this._terminalLinkProviderService.registerLinkProvider(new ExtensionTerminalLinkProvider(this._proxy));\n\t}\n\n\tpublic $stopLinkProvider(): void {\n\t\tthis._linkProvider.clear();\n\t}\n\n\tpublic $registerProcessSupport(isSupported: boolean): void {\n\t\tthis._terminalService.registerProcessSupport(isSupported);\n\t}\n\n\tpublic $registerCompletionProvider(id: string, extensionIdentifier: string, ...triggerCharacters: string[]): void {\n\t\tthis._completionProviders.set(id, this._terminalCompletionService.registerTerminalCompletionProvider(extensionIdentifier, id, {\n\t\t\tid,\n\t\t\tprovideCompletions: async (commandLine, cursorIndex, token) => {\n\t\t\t\tconst completions = await this._proxy.$provideTerminalCompletions(id, { commandLine, cursorIndex }, token);\n\t\t\t\tif (!completions) {\n\t\t\t\t\treturn undefined;\n\t\t\t\t}\n\t\t\t\tif (completions.resourceOptions) {\n\t\t\t\t\tconst { cwd, globPattern, ...rest } = completions.resourceOptions;\n\t\t\t\t\treturn {\n\t\t\t\t\t\titems: completions.items?.map(c => ({\n\t\t\t\t\t\t\tprovider: `ext:${id}`,\n\t\t\t\t\t\t\t...c,\n\t\t\t\t\t\t})),\n\t\t\t\t\t\tresourceOptions: {\n\t\t\t\t\t\t\t...rest,\n\t\t\t\t\t\t\tcwd,\n\t\t\t\t\t\t\tglobPattern\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t\treturn completions.items?.map(c => ({\n\t\t\t\t\tprovider: `ext:${id}`,\n\t\t\t\t\t...c,\n\t\t\t\t}));\n\t\t\t}\n\t\t}, ...triggerCharacters));\n\t}\n\n\tpublic $unregisterCompletionProvider(id: string): void {\n\t\tthis._completionProviders.get(id)?.dispose();\n\t\tthis._completionProviders.delete(id);\n\t}\n\n\tpublic $registerProfileProvider(id: string, extensionIdentifier: string): void {\n\t\t// Proxy profile provider requests through the extension host\n\t\tthis._profileProviders.set(id, this._terminalProfileService.registerTerminalProfileProvider(extensionIdentifier, id, {\n\t\t\tcreateContributedTerminalProfile: async (options) => {\n\t\t\t\treturn this._proxy.$createContributedProfileTerminal(id, options);\n\t\t\t}\n\t\t}));\n\t}\n\n\tpublic $unregisterProfileProvider(id: string): void {\n\t\tthis._profileProviders.get(id)?.dispose();\n\t\tthis._profileProviders.delete(id);\n\t}\n\n\tpublic async $registerQuickFixProvider(id: string, extensionId: string): Promise<void> {\n\t\tthis._quickFixProviders.set(id, this._terminalQuickFixService.registerQuickFixProvider(id, {\n\t\t\tprovideTerminalQuickFixes: async (terminalCommand, lines, options, token) => {\n\t\t\t\tif (token.isCancellationRequested) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tif (options.outputMatcher?.length && options.outputMatcher.length > 40) {\n\t\t\t\t\toptions.outputMatcher.length = 40;\n\t\t\t\t\tthis._logService.warn('Cannot exceed output matcher length of 40');\n\t\t\t\t}\n\t\t\t\tconst commandLineMatch = terminalCommand.command.match(options.commandLineMatcher);\n\t\t\t\tif (!commandLineMatch || !lines) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tconst outputMatcher = options.outputMatcher;\n\t\t\t\tlet outputMatch;\n\t\t\t\tif (outputMatcher) {\n\t\t\t\t\toutputMatch = getOutputMatchForLines(lines, outputMatcher);\n\t\t\t\t}\n\t\t\t\tif (!outputMatch) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tconst matchResult = { commandLineMatch, outputMatch, commandLine: terminalCommand.command };\n\n\t\t\t\tif (matchResult) {\n\t\t\t\t\tconst result = await this._proxy.$provideTerminalQuickFixes(id, matchResult, token);\n\t\t\t\t\tif (result && Array.isArray(result)) {\n\t\t\t\t\t\treturn result.map(r => parseQuickFix(id, extensionId, r));\n\t\t\t\t\t} else if (result) {\n\t\t\t\t\t\treturn parseQuickFix(id, extensionId, result);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn;\n\t\t\t}\n\t\t}));\n\t}\n\n\tpublic $unregisterQuickFixProvider(id: string): void {\n\t\tthis._quickFixProviders.get(id)?.dispose();\n\t\tthis._quickFixProviders.delete(id);\n\t}\n\n\tprivate _onActiveTerminalChanged(terminalId: number | null): void {\n\t\tthis._proxy.$acceptActiveTerminalChanged(terminalId);\n\t}\n\n\tprivate _onTerminalData(terminalId: number, data: string): void {\n\t\tthis._proxy.$acceptTerminalProcessData(terminalId, data);\n\t}\n\n\tprivate _onDidExecuteCommand(terminalId: number, command: ITerminalCommandDto): void {\n\t\tthis._proxy.$acceptDidExecuteCommand(terminalId, command);\n\t}\n\n\tprivate _onTitleChanged(terminalId: number, name: string): void {\n\t\tthis._proxy.$acceptTerminalTitleChange(terminalId, name);\n\t}\n\n\tprivate _onShellTypeChanged(terminalId: number): void {\n\t\tconst terminalInstance = this._terminalService.getInstanceFromId(terminalId);\n\t\tif (terminalInstance) {\n\t\t\tthis._proxy.$acceptTerminalShellType(terminalId, terminalInstance.shellType);\n\t\t}\n\t}\n\n\tprivate _onTerminalDisposed(terminalInstance: ITerminalInstance): void {\n\t\tthis._proxy.$acceptTerminalClosed(terminalInstance.instanceId, terminalInstance.exitCode, terminalInstance.exitReason ?? TerminalExitReason.Unknown);\n\t\tconst proxy = this._terminalProcessProxies.get(terminalInstance.instanceId);\n\t\tif (proxy) {\n\t\t\tproxy.proxy.dispose();\n\t\t\tproxy.store.dispose();\n\t\t\tthis._terminalProcessProxies.delete(terminalInstance.instanceId);\n\t\t}\n\t}\n\n\tprivate _onTerminalOpened(terminalInstance: ITerminalInstance): void {\n\t\tconst extHostTerminalId = terminalInstance.shellLaunchConfig.extHostTerminalId;\n\t\tconst shellLaunchConfigDto: IShellLaunchConfigDto = {\n\t\t\tname: terminalInstance.shellLaunchConfig.name,\n\t\t\texecutable: terminalInstance.shellLaunchConfig.executable,\n\t\t\targs: terminalInstance.shellLaunchConfig.args,\n\t\t\tcwd: terminalInstance.shellLaunchConfig.cwd,\n\t\t\tenv: terminalInstance.shellLaunchConfig.env,\n\t\t\thideFromUser: terminalInstance.shellLaunchConfig.hideFromUser,\n\t\t\ttabActions: terminalInstance.shellLaunchConfig.tabActions\n\t\t};\n\t\tthis._proxy.$acceptTerminalOpened(terminalInstance.instanceId, extHostTerminalId, terminalInstance.title, shellLaunchConfigDto);\n\t}\n\n\tprivate _onTerminalProcessIdReady(terminalInstance: ITerminalInstance): void {\n\t\tif (terminalInstance.processId === undefined) {\n\t\t\treturn;\n\t\t}\n\t\tthis._proxy.$acceptTerminalProcessId(terminalInstance.instanceId, terminalInstance.processId);\n\t}\n\n\tprivate _onInstanceDimensionsChanged(instance: ITerminalInstance): void {\n\t\tthis._proxy.$acceptTerminalDimensions(instance.instanceId, instance.cols, instance.rows);\n\t}\n\n\tprivate _onInstanceMaximumDimensionsChanged(instance: ITerminalInstance): void {\n\t\tthis._proxy.$acceptTerminalMaximumDimensions(instance.instanceId, instance.maxCols, instance.maxRows);\n\t}\n\n\tprivate _onRequestStartExtensionTerminal(request: IStartExtensionTerminalRequest): void {\n\t\tconst proxy = request.proxy;\n\t\tconst store = new DisposableStore();\n\t\tthis._terminalProcessProxies.set(proxy.instanceId, { proxy, store });\n\n\t\t// Note that onResize is not being listened to here as it needs to fire when max dimensions\n\t\t// change, excluding the dimension override\n\t\tconst initialDimensions: ITerminalDimensionsDto | undefined = request.cols && request.rows ? {\n\t\t\tcolumns: request.cols,\n\t\t\trows: request.rows\n\t\t} : undefined;\n\n\t\tthis._proxy.$startExtensionTerminal(\n\t\t\tproxy.instanceId,\n\t\t\tinitialDimensions\n\t\t).then(request.callback);\n\n\t\tstore.add(proxy.onInput(data => this._proxy.$acceptProcessInput(proxy.instanceId, data)));\n\t\tstore.add(proxy.onShutdown(immediate => this._proxy.$acceptProcessShutdown(proxy.instanceId, immediate)));\n\t\tstore.add(proxy.onRequestCwd(() => this._proxy.$acceptProcessRequestCwd(proxy.instanceId)));\n\t\tstore.add(proxy.onRequestInitialCwd(() => this._proxy.$acceptProcessRequestInitialCwd(proxy.instanceId)));\n\t}\n\n\tpublic $sendProcessData(terminalId: number, data: string): void {\n\t\tthis._terminalProcessProxies.get(terminalId)?.proxy.emitData(data);\n\t}\n\n\tpublic $sendProcessReady(terminalId: number, pid: number, cwd: string, windowsPty: IProcessReadyWindowsPty | undefined): void {\n\t\tthis._terminalProcessProxies.get(terminalId)?.proxy.emitReady(pid, cwd, windowsPty);\n\t}\n\n\tpublic $sendProcessProperty(terminalId: number, property: IProcessProperty): void {\n\t\tif (property.type === ProcessPropertyType.Title) {\n\t\t\tconst instance = this._terminalService.getInstanceFromId(terminalId);\n\t\t\tinstance?.rename(property.value as IProcessPropertyMap[ProcessPropertyType.Title]);\n\t\t}\n\t\tthis._terminalProcessProxies.get(terminalId)?.proxy.emitProcessProperty(property);\n\t}\n\n\t$setEnvironmentVariableCollection(extensionIdentifier: string, persistent: boolean, collection: ISerializableEnvironmentVariableCollection | undefined, descriptionMap: ISerializableEnvironmentDescriptionMap): void {\n\t\tif (collection) {\n\t\t\tconst translatedCollection = {\n\t\t\t\tpersistent,\n\t\t\t\tmap: deserializeEnvironmentVariableCollection(collection),\n\t\t\t\tdescriptionMap: deserializeEnvironmentDescriptionMap(descriptionMap)\n\t\t\t};\n\t\t\tthis._environmentVariableService.set(extensionIdentifier, translatedCollection);\n\t\t} else {\n\t\t\tthis._environmentVariableService.delete(extensionIdentifier);\n\t\t}\n\t}\n}\n\n/**\n * Encapsulates temporary tracking of data events from terminal instances, once disposed all\n * listeners are removed.\n */\nclass TerminalDataEventTracker extends Disposable {\n\tprivate readonly _bufferer: TerminalDataBufferer;\n\n\tconstructor(\n\t\tprivate readonly _callback: (id: number, data: string) => void,\n\t\t@ITerminalService private readonly _terminalService: ITerminalService\n\t) {\n\t\tsuper();\n\n\t\tthis._register(this._bufferer = new TerminalDataBufferer(this._callback));\n\n\t\tfor (const instance of this._terminalService.instances) {\n\t\t\tthis._registerInstance(instance);\n\t\t}\n\t\tthis._register(this._terminalService.onDidCreateInstance(instance => this._registerInstance(instance)));\n\t\tthis._register(this._terminalService.onDidDisposeInstance(instance => this._bufferer.stopBuffering(instance.instanceId)));\n\t}\n\n\tprivate _registerInstance(instance: ITerminalInstance): void {\n\t\t// Buffer data events to reduce the amount of messages going to the extension host\n\t\tthis._register(this._bufferer.startBuffering(instance.instanceId, instance.onData));\n\t}\n}\n\nclass ExtensionTerminalLinkProvider implements ITerminalExternalLinkProvider {\n\tconstructor(\n\t\tprivate readonly _proxy: ExtHostTerminalServiceShape\n\t) {\n\t}\n\n\tasync provideLinks(instance: ITerminalInstance, line: string): Promise<ITerminalLink[] | undefined> {\n\t\tconst proxy = this._proxy;\n\t\tconst extHostLinks = await proxy.$provideLinks(instance.instanceId, line);\n\t\treturn extHostLinks.map(dto => ({\n\t\t\tid: dto.id,\n\t\t\tstartIndex: dto.startIndex,\n\t\t\tlength: dto.length,\n\t\t\tlabel: dto.label,\n\t\t\tactivate: () => proxy.$activateLink(instance.instanceId, dto.id)\n\t\t}));\n\t}\n}\n\nexport function getOutputMatchForLines(lines: string[], outputMatcher: ITerminalOutputMatcher): ITerminalOutputMatch | undefined {\n\tconst match: RegExpMatchArray | null | undefined = lines.join('\\n').match(outputMatcher.lineMatcher);\n\treturn match ? { regexMatch: match, outputLines: lines } : undefined;\n}\n\nfunction parseQuickFix(id: string, source: string, fix: TerminalQuickFix): ITerminalQuickFix {\n\tlet type = TerminalQuickFixType.TerminalCommand;\n\tif (hasKey(fix, { uri: true })) {\n\t\tfix.uri = URI.revive(fix.uri);\n\t\ttype = TerminalQuickFixType.Opener;\n\t} else if (hasKey(fix, { id: true })) {\n\t\ttype = TerminalQuickFixType.VscodeCommand;\n\t}\n\treturn { id, type, source, ...fix };\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { DisposableStore, Disposable, IDisposable, MutableDisposable, combinedDisposable, toDisposable } from '../../../base/common/lifecycle.js';\nimport { ExtHostContext, ExtHostTerminalServiceShape, MainThreadTerminalServiceShape, MainContext, TerminalLaunchConfig, ITerminalDimensionsDto, ExtHostTerminalIdentifier, TerminalQuickFix, ITerminalCommandDto } from '../common/extHost.protocol.js';\nimport { extHostNamedCustomer, IExtHostContext } from '../../services/extensions/common/extHostCustomers.js';\nimport { URI } from '../../../base/common/uri.js';\nimport { IInstantiationService } from '../../../platform/instantiation/common/instantiation.js';\nimport { ILogService } from '../../../platform/log/common/log.js';\nimport { IProcessProperty, IProcessReadyWindowsPty, IShellLaunchConfig, IShellLaunchConfigDto, ITerminalOutputMatch, ITerminalOutputMatcher, ProcessPropertyType, TerminalExitReason, TerminalLocation, type IProcessPropertyMap } from '../../../platform/terminal/common/terminal.js';\nimport { TerminalDataBufferer } from '../../../platform/terminal/common/terminalDataBuffering.js';\nimport { ITerminalEditorService, ITerminalExternalLinkProvider, ITerminalGroupService, ITerminalInstance, ITerminalLink, ITerminalService } from '../../contrib/terminal/browser/terminal.js';\nimport { TerminalProcessExtHostProxy } from '../../contrib/terminal/browser/terminalProcessExtHostProxy.js';\nimport { IEnvironmentVariableService } from '../../contrib/terminal/common/environmentVariable.js';\nimport { deserializeEnvironmentDescriptionMap, deserializeEnvironmentVariableCollection, serializeEnvironmentVariableCollection } from '../../../platform/terminal/common/environmentVariableShared.js';\nimport { IStartExtensionTerminalRequest, ITerminalProcessExtHostProxy, ITerminalProfileResolverService, ITerminalProfileService } from '../../contrib/terminal/common/terminal.js';\nimport { IRemoteAgentService } from '../../services/remote/common/remoteAgentService.js';\nimport { OperatingSystem, OS } from '../../../base/common/platform.js';\nimport { TerminalEditorLocationOptions } from 'vscode';\nimport { Promises } from '../../../base/common/async.js';\nimport { ISerializableEnvironmentDescriptionMap, ISerializableEnvironmentVariableCollection } from '../../../platform/terminal/common/environmentVariable.js';\nimport { ITerminalLinkProviderService } from '../../contrib/terminalContrib/links/browser/links.js';\nimport { ITerminalQuickFixService, ITerminalQuickFix, TerminalQuickFixType } from '../../contrib/terminalContrib/quickFix/browser/quickFix.js';\nimport { TerminalCapability } from '../../../platform/terminal/common/capabilities/capabilities.js';\nimport { ITerminalCompletionService } from '../../contrib/terminalContrib/suggest/browser/terminalCompletionService.js';\nimport { IWorkbenchEnvironmentService } from '../../services/environment/common/environmentService.js';\nimport { hasKey } from '../../../base/common/types.js';\n\n@extHostNamedCustomer(MainContext.MainThreadTerminalService)\nexport class MainThreadTerminalService extends Disposable implements MainThreadTerminalServiceShape {\n\n\tprivate readonly _proxy: ExtHostTerminalServiceShape;\n\n\t/**\n\t * Stores a map from a temporary terminal id (a UUID generated on the extension host side)\n\t * to a numeric terminal id (an id generated on the renderer side)\n\t * This comes in play only when dealing with terminals created on the extension host side\n\t */\n\tprivate readonly _extHostTerminals = new Map<string, Promise<ITerminalInstance>>();\n\tprivate readonly _terminalProcessProxies = new Map<number, { proxy: ITerminalProcessExtHostProxy; store: DisposableStore }>();\n\tprivate readonly _profileProviders = new Map<string, IDisposable>();\n\tprivate readonly _completionProviders = new Map<string, IDisposable>();\n\tprivate readonly _quickFixProviders = new Map<string, IDisposable>();\n\tprivate readonly _dataEventTracker = this._register(new MutableDisposable<TerminalDataEventTracker>());\n\tprivate readonly _sendCommandEventListener = this._register(new MutableDisposable());\n\n\t/**\n\t * A single shared terminal link provider for the exthost. When an ext registers a link\n\t * provider, this is registered with the terminal on the renderer side and all links are\n\t * provided through this, even from multiple ext link providers. Xterm should remove lower\n\t * priority intersecting links itself.\n\t */\n\tprivate readonly _linkProvider = this._register(new MutableDisposable());\n\n\tprivate _os: OperatingSystem = OS;\n\n\tconstructor(\n\t\t_extHostContext: IExtHostContext,\n\t\t@ITerminalService private readonly _terminalService: ITerminalService,\n\t\t@ITerminalLinkProviderService private readonly _terminalLinkProviderService: ITerminalLinkProviderService,\n\t\t@ITerminalQuickFixService private readonly _terminalQuickFixService: ITerminalQuickFixService,\n\t\t@IInstantiationService private readonly _instantiationService: IInstantiationService,\n\t\t@IEnvironmentVariableService private readonly _environmentVariableService: IEnvironmentVariableService,\n\t\t@ILogService private readonly _logService: ILogService,\n\t\t@ITerminalProfileResolverService private readonly _terminalProfileResolverService: ITerminalProfileResolverService,\n\t\t@IRemoteAgentService remoteAgentService: IRemoteAgentService,\n\t\t@ITerminalGroupService private readonly _terminalGroupService: ITerminalGroupService,\n\t\t@ITerminalEditorService private readonly _terminalEditorService: ITerminalEditorService,\n\t\t@ITerminalProfileService private readonly _terminalProfileService: ITerminalProfileService,\n\t\t@ITerminalCompletionService private readonly _terminalCompletionService: ITerminalCompletionService,\n\t\t@IWorkbenchEnvironmentService private readonly _environmentService: IWorkbenchEnvironmentService,\n\t) {\n\t\tsuper();\n\t\tthis._proxy = _extHostContext.getProxy(ExtHostContext.ExtHostTerminalService);\n\n\t\t// ITerminalService listeners\n\t\tthis._register(_terminalService.onDidCreateInstance((instance) => {\n\t\t\tthis._onTerminalOpened(instance);\n\t\t\tthis._onInstanceDimensionsChanged(instance);\n\t\t}));\n\n\t\tthis._register(_terminalService.onDidDisposeInstance(instance => this._onTerminalDisposed(instance)));\n\t\tthis._register(_terminalService.onAnyInstanceProcessIdReady(instance => this._onTerminalProcessIdReady(instance)));\n\t\tthis._register(_terminalService.onDidChangeInstanceDimensions(instance => this._onInstanceDimensionsChanged(instance)));\n\t\tthis._register(_terminalService.onAnyInstanceMaximumDimensionsChange(instance => this._onInstanceMaximumDimensionsChanged(instance)));\n\t\tthis._register(_terminalService.onDidRequestStartExtensionTerminal(e => this._onRequestStartExtensionTerminal(e)));\n\t\tthis._register(_terminalService.onDidChangeActiveInstance(instance => this._onActiveTerminalChanged(instance ? instance.instanceId : null)));\n\t\tthis._register(_terminalService.onAnyInstanceTitleChange(instance => instance && this._onTitleChanged(instance.instanceId, instance.title)));\n\t\tthis._register(_terminalService.onAnyInstanceDataInput(instance => this._proxy.$acceptTerminalInteraction(instance.instanceId)));\n\t\tthis._register(_terminalService.onAnyInstanceSelectionChange(instance => this._proxy.$acceptTerminalSelection(instance.instanceId, instance.selection)));\n\t\tthis._register(_terminalService.onAnyInstanceShellTypeChanged(instance => this._onShellTypeChanged(instance.instanceId)));\n\n\t\t// Set initial ext host state\n\t\tfor (const instance of this._terminalService.instances) {\n\t\t\tthis._onTerminalOpened(instance);\n\t\t\tinstance.processReady.then(() => this._onTerminalProcessIdReady(instance));\n\t\t\tif (instance.shellType) {\n\t\t\t\tthis._proxy.$acceptTerminalShellType(instance.instanceId, instance.shellType);\n\t\t\t}\n\t\t}\n\t\tconst activeInstance = this._terminalService.activeInstance;\n\t\tif (activeInstance) {\n\t\t\tthis._proxy.$acceptActiveTerminalChanged(activeInstance.instanceId);\n\t\t}\n\t\tif (this._environmentVariableService.collections.size > 0) {\n\t\t\tconst collectionAsArray = [...this._environmentVariableService.collections.entries()];\n\t\t\tconst serializedCollections: [string, ISerializableEnvironmentVariableCollection][] = collectionAsArray.map(e => {\n\t\t\t\treturn [e[0], serializeEnvironmentVariableCollection(e[1].map)];\n\t\t\t});\n\t\t\tthis._proxy.$initEnvironmentVariableCollections(serializedCollections);\n\t\t}\n\n\t\tthis._store.add(toDisposable(() => {\n\t\t\tfor (const e of this._terminalProcessProxies.values()) {\n\t\t\t\te.proxy.dispose();\n\t\t\t\te.store.dispose();\n\t\t\t}\n\t\t\tthis._terminalProcessProxies.clear();\n\t\t}));\n\n\t\tremoteAgentService.getEnvironment().then(async env => {\n\t\t\tthis._os = env?.os || OS;\n\t\t\tthis._updateDefaultProfile();\n\t\t});\n\t\tthis._register(this._terminalProfileService.onDidChangeAvailableProfiles(() => this._updateDefaultProfile()));\n\n\t\tthis._register(toDisposable(() => {\n\t\t\tfor (const provider of this._profileProviders.values()) {\n\t\t\t\tprovider.dispose();\n\t\t\t}\n\t\t\tfor (const provider of this._quickFixProviders.values()) {\n\t\t\t\tprovider.dispose();\n\t\t\t}\n\t\t}));\n\t}\n\n\tprivate async _updateDefaultProfile() {\n\t\tconst remoteAuthority = this._environmentService.remoteAuthority;\n\t\tconst defaultProfile = this._terminalProfileResolverService.getDefaultProfile({ remoteAuthority, os: this._os });\n\t\tconst defaultAutomationProfile = this._terminalProfileResolverService.getDefaultProfile({ remoteAuthority, os: this._os, allowAutomationShell: true });\n\t\tthis._proxy.$acceptDefaultProfile(...await Promise.all([defaultProfile, defaultAutomationProfile]));\n\t}\n\n\tprivate async _getTerminalInstance(id: ExtHostTerminalIdentifier): Promise<ITerminalInstance | undefined> {\n\t\tif (typeof id === 'string') {\n\t\t\treturn this._extHostTerminals.get(id);\n\t\t}\n\t\treturn this._terminalService.getInstanceFromId(id);\n\t}\n\n\tpublic async $createTerminal(extHostTerminalId: string, launchConfig: TerminalLaunchConfig): Promise<void> {\n\t\tconst shellLaunchConfig: IShellLaunchConfig = {\n\t\t\tname: launchConfig.name,\n\t\t\texecutable: launchConfig.shellPath,\n\t\t\targs: launchConfig.shellArgs,\n\t\t\tcwd: typeof launchConfig.cwd === 'string' ? launchConfig.cwd : URI.revive(launchConfig.cwd),\n\t\t\ticon: launchConfig.icon,\n\t\t\tcolor: launchConfig.color,\n\t\t\tinitialText: launchConfig.initialText,\n\t\t\twaitOnExit: launchConfig.waitOnExit,\n\t\t\tignoreConfigurationCwd: true,\n\t\t\tenv: launchConfig.env,\n\t\t\tstrictEnv: launchConfig.strictEnv,\n\t\t\thideFromUser: launchConfig.hideFromUser,\n\t\t\tcustomPtyImplementation: launchConfig.isExtensionCustomPtyTerminal\n\t\t\t\t? (id, cols, rows) => new TerminalProcessExtHostProxy(id, cols, rows, this._terminalService)\n\t\t\t\t: undefined,\n\t\t\textHostTerminalId,\n\t\t\tforceShellIntegration: launchConfig.forceShellIntegration,\n\t\t\tisFeatureTerminal: launchConfig.isFeatureTerminal,\n\t\t\tisExtensionOwnedTerminal: launchConfig.isExtensionOwnedTerminal,\n\t\t\tuseShellEnvironment: launchConfig.useShellEnvironment,\n\t\t\tisTransient: launchConfig.isTransient,\n\t\t\tshellIntegrationNonce: launchConfig.shellIntegrationNonce\n\t\t};\n\t\tconst terminal = Promises.withAsyncBody<ITerminalInstance>(async r => {\n\t\t\tconst terminal = await this._terminalService.createTerminal({\n\t\t\t\tconfig: shellLaunchConfig,\n\t\t\t\tlocation: await this._deserializeParentTerminal(launchConfig.location)\n\t\t\t});\n\t\t\tr(terminal);\n\t\t});\n\t\tthis._extHostTerminals.set(extHostTerminalId, terminal);\n\t\tconst terminalInstance = await terminal;\n\t\tthis._register(terminalInstance.onDisposed(() => {\n\t\t\tthis._extHostTerminals.delete(extHostTerminalId);\n\t\t}));\n\t}\n\n\tprivate async _deserializeParentTerminal(location?: TerminalLocation | TerminalEditorLocationOptions | { parentTerminal: ExtHostTerminalIdentifier } | { splitActiveTerminal: boolean; location?: TerminalLocation }): Promise<TerminalLocation | TerminalEditorLocationOptions | { parentTerminal: ITerminalInstance } | { splitActiveTerminal: boolean } | undefined> {\n\t\tif (typeof location === 'object' && hasKey(location, { parentTerminal: true })) {\n\t\t\tconst parentTerminal = await this._extHostTerminals.get(location.parentTerminal.toString());\n\t\t\treturn parentTerminal ? { parentTerminal } : undefined;\n\t\t}\n\t\treturn location;\n\t}\n\n\tpublic async $show(id: ExtHostTerminalIdentifier, preserveFocus: boolean): Promise<void> {\n\t\tconst terminalInstance = await this._getTerminalInstance(id);\n\t\tif (terminalInstance) {\n\t\t\tthis._terminalService.setActiveInstance(terminalInstance);\n\t\t\tif (terminalInstance.target === TerminalLocation.Editor) {\n\t\t\t\tawait this._terminalEditorService.revealActiveEditor(preserveFocus);\n\t\t\t} else {\n\t\t\t\tawait this._terminalGroupService.showPanel(!preserveFocus);\n\t\t\t}\n\t\t}\n\t}\n\n\tpublic async $hide(id: ExtHostTerminalIdentifier): Promise<void> {\n\t\tconst instanceToHide = await this._getTerminalInstance(id);\n\t\tconst activeInstance = this._terminalService.activeInstance;\n\t\tif (activeInstance && activeInstance.instanceId === instanceToHide?.instanceId && activeInstance.target !== TerminalLocation.Editor) {\n\t\t\tthis._terminalGroupService.hidePanel();\n\t\t}\n\t}\n\n\tpublic async $dispose(id: ExtHostTerminalIdentifier): Promise<void> {\n\t\t(await this._getTerminalInstance(id))?.dispose(TerminalExitReason.Extension);\n\t}\n\n\tpublic async $sendText(id: ExtHostTerminalIdentifier, text: string, shouldExecute: boolean): Promise<void> {\n\t\tconst instance = await this._getTerminalInstance(id);\n\t\tawait instance?.sendText(text, shouldExecute);\n\t}\n\n\tpublic $sendProcessExit(terminalId: number, exitCode: number | undefined): void {\n\t\tthis._terminalProcessProxies.get(terminalId)?.proxy.emitExit(exitCode);\n\t}\n\n\tpublic $startSendingDataEvents(): void {\n\t\tif (!this._dataEventTracker.value) {\n\t\t\tthis._dataEventTracker.value = this._instantiationService.createInstance(TerminalDataEventTracker, (id, data) => {\n\t\t\t\tthis._onTerminalData(id, data);\n\t\t\t});\n\t\t\t// Send initial events if they exist\n\t\t\tfor (const instance of this._terminalService.instances) {\n\t\t\t\tfor (const data of instance.initialDataEvents || []) {\n\t\t\t\t\tthis._onTerminalData(instance.instanceId, data);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tpublic $stopSendingDataEvents(): void {\n\t\tthis._dataEventTracker.clear();\n\t}\n\n\tpublic $startSendingCommandEvents(): void {\n\t\tif (this._sendCommandEventListener.value) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst multiplexer = this._terminalService.createOnInstanceCapabilityEvent(TerminalCapability.CommandDetection, capability => capability.onCommandFinished);\n\t\tconst sub = multiplexer.event(e => {\n\t\t\tthis._onDidExecuteCommand(e.instance.instanceId, {\n\t\t\t\tcommandLine: e.data.command,\n\t\t\t\t// TODO: Convert to URI if possible\n\t\t\t\tcwd: e.data.cwd,\n\t\t\t\texitCode: e.data.exitCode,\n\t\t\t\toutput: e.data.getOutput()\n\t\t\t});\n\t\t});\n\t\tthis._sendCommandEventListener.value = combinedDisposable(multiplexer, sub);\n\t}\n\n\tpublic $stopSendingCommandEvents(): void {\n\t\tthis._sendCommandEventListener.clear();\n\t}\n\n\tpublic $startLinkProvider(): void {\n\t\tthis._linkProvider.value = this._terminalLinkProviderService.registerLinkProvider(new ExtensionTerminalLinkProvider(this._proxy));\n\t}\n\n\tpublic $stopLinkProvider(): void {\n\t\tthis._linkProvider.clear();\n\t}\n\n\tpublic $registerProcessSupport(isSupported: boolean): void {\n\t\tthis._terminalService.registerProcessSupport(isSupported);\n\t}\n\n\tpublic $registerCompletionProvider(id: string, extensionIdentifier: string, ...triggerCharacters: string[]): void {\n\t\tthis._completionProviders.set(id, this._terminalCompletionService.registerTerminalCompletionProvider(extensionIdentifier, id, {\n\t\t\tid,\n\t\t\tprovideCompletions: async (commandLine, cursorIndex, token) => {\n\t\t\t\tconst completions = await this._proxy.$provideTerminalCompletions(id, { commandLine, cursorIndex }, token);\n\t\t\t\tif (!completions) {\n\t\t\t\t\treturn undefined;\n\t\t\t\t}\n\t\t\t\tif (completions.resourceOptions) {\n\t\t\t\t\tconst { cwd, globPattern, ...rest } = completions.resourceOptions;\n\t\t\t\t\treturn {\n\t\t\t\t\t\titems: completions.items?.map(c => ({\n\t\t\t\t\t\t\tprovider: `ext:${id}`,\n\t\t\t\t\t\t\t...c,\n\t\t\t\t\t\t})),\n\t\t\t\t\t\tresourceOptions: {\n\t\t\t\t\t\t\t...rest,\n\t\t\t\t\t\t\tcwd,\n\t\t\t\t\t\t\tglobPattern\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t\treturn completions.items?.map(c => ({\n\t\t\t\t\tprovider: `ext:${id}`,\n\t\t\t\t\t...c,\n\t\t\t\t}));\n\t\t\t}\n\t\t}, ...triggerCharacters));\n\t}\n\n\tpublic $unregisterCompletionProvider(id: string): void {\n\t\tthis._completionProviders.get(id)?.dispose();\n\t\tthis._completionProviders.delete(id);\n\t}\n\n\tpublic $registerProfileProvider(id: string, extensionIdentifier: string): void {\n\t\t// Proxy profile provider requests through the extension host\n\t\tthis._profileProviders.set(id, this._terminalProfileService.registerTerminalProfileProvider(extensionIdentifier, id, {\n\t\t\tcreateContributedTerminalProfile: async (options) => {\n\t\t\t\treturn this._proxy.$createContributedProfileTerminal(id, options);\n\t\t\t}\n\t\t}));\n\t}\n\n\tpublic $unregisterProfileProvider(id: string): void {\n\t\tthis._profileProviders.get(id)?.dispose();\n\t\tthis._profileProviders.delete(id);\n\t}\n\n\tpublic async $registerQuickFixProvider(id: string, extensionId: string): Promise<void> {\n\t\tthis._quickFixProviders.set(id, this._terminalQuickFixService.registerQuickFixProvider(id, {\n\t\t\tprovideTerminalQuickFixes: async (terminalCommand, lines, options, token) => {\n\t\t\t\tif (token.isCancellationRequested) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tif (options.outputMatcher?.length && options.outputMatcher.length > 40) {\n\t\t\t\t\toptions.outputMatcher.length = 40;\n\t\t\t\t\tthis._logService.warn('Cannot exceed output matcher length of 40');\n\t\t\t\t}\n\t\t\t\tconst commandLineMatch = terminalCommand.command.match(options.commandLineMatcher);\n\t\t\t\tif (!commandLineMatch || !lines) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tconst outputMatcher = options.outputMatcher;\n\t\t\t\tlet outputMatch;\n\t\t\t\tif (outputMatcher) {\n\t\t\t\t\toutputMatch = getOutputMatchForLines(lines, outputMatcher);\n\t\t\t\t}\n\t\t\t\tif (!outputMatch) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tconst matchResult = { commandLineMatch, outputMatch, commandLine: terminalCommand.command };\n\n\t\t\t\tif (matchResult) {\n\t\t\t\t\tconst result = await this._proxy.$provideTerminalQuickFixes(id, matchResult, token);\n\t\t\t\t\tif (result && Array.isArray(result)) {\n\t\t\t\t\t\treturn result.map(r => parseQuickFix(id, extensionId, r));\n\t\t\t\t\t} else if (result) {\n\t\t\t\t\t\treturn parseQuickFix(id, extensionId, result);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn;\n\t\t\t}\n\t\t}));\n\t}\n\n\tpublic $unregisterQuickFixProvider(id: string): void {\n\t\tthis._quickFixProviders.get(id)?.dispose();\n\t\tthis._quickFixProviders.delete(id);\n\t}\n\n\tprivate _onActiveTerminalChanged(terminalId: number | null): void {\n\t\tthis._proxy.$acceptActiveTerminalChanged(terminalId);\n\t}\n\n\tprivate _onTerminalData(terminalId: number, data: string): void {\n\t\tthis._proxy.$acceptTerminalProcessData(terminalId, data);\n\t}\n\n\tprivate _onDidExecuteCommand(terminalId: number, command: ITerminalCommandDto): void {\n\t\tthis._proxy.$acceptDidExecuteCommand(terminalId, command);\n\t}\n\n\tprivate _onTitleChanged(terminalId: number, name: string): void {\n\t\tthis._proxy.$acceptTerminalTitleChange(terminalId, name);\n\t}\n\n\tprivate _onShellTypeChanged(terminalId: number): void {\n\t\tconst terminalInstance = this._terminalService.getInstanceFromId(terminalId);\n\t\tif (terminalInstance) {\n\t\t\tthis._proxy.$acceptTerminalShellType(terminalId, terminalInstance.shellType);\n\t\t}\n\t}\n\n\tprivate _onTerminalDisposed(terminalInstance: ITerminalInstance): void {\n\t\tthis._proxy.$acceptTerminalClosed(terminalInstance.instanceId, terminalInstance.exitCode, terminalInstance.exitReason ?? TerminalExitReason.Unknown);\n\t\tconst proxy = this._terminalProcessProxies.get(terminalInstance.instanceId);\n\t\tif (proxy) {\n\t\t\tproxy.proxy.dispose();\n\t\t\tproxy.store.dispose();\n\t\t\tthis._terminalProcessProxies.delete(terminalInstance.instanceId);\n\t\t}\n\t}\n\n\tprivate _onTerminalOpened(terminalInstance: ITerminalInstance): void {\n\t\tconst extHostTerminalId = terminalInstance.shellLaunchConfig.extHostTerminalId;\n\t\tconst shellLaunchConfigDto: IShellLaunchConfigDto = {\n\t\t\tname: terminalInstance.shellLaunchConfig.name,\n\t\t\texecutable: terminalInstance.shellLaunchConfig.executable,\n\t\t\targs: terminalInstance.shellLaunchConfig.args,\n\t\t\tcwd: terminalInstance.shellLaunchConfig.cwd,\n\t\t\tenv: terminalInstance.shellLaunchConfig.env,\n\t\t\thideFromUser: terminalInstance.shellLaunchConfig.hideFromUser,\n\t\t\ttabActions: terminalInstance.shellLaunchConfig.tabActions\n\t\t};\n\t\tthis._proxy.$acceptTerminalOpened(terminalInstance.instanceId, extHostTerminalId, terminalInstance.title, shellLaunchConfigDto);\n\t}\n\n\tprivate _onTerminalProcessIdReady(terminalInstance: ITerminalInstance): void {\n\t\tif (terminalInstance.processId === undefined) {\n\t\t\treturn;\n\t\t}\n\t\tthis._proxy.$acceptTerminalProcessId(terminalInstance.instanceId, terminalInstance.processId);\n\t}\n\n\tprivate _onInstanceDimensionsChanged(instance: ITerminalInstance): void {\n\t\tthis._proxy.$acceptTerminalDimensions(instance.instanceId, instance.cols, instance.rows);\n\t}\n\n\tprivate _onInstanceMaximumDimensionsChanged(instance: ITerminalInstance): void {\n\t\tthis._proxy.$acceptTerminalMaximumDimensions(instance.instanceId, instance.maxCols, instance.maxRows);\n\t}\n\n\tprivate _onRequestStartExtensionTerminal(request: IStartExtensionTerminalRequest): void {\n\t\tconst proxy = request.proxy;\n\t\tconst store = new DisposableStore();\n\t\tthis._terminalProcessProxies.set(proxy.instanceId, { proxy, store });\n\n\t\t// Note that onResize is not being listened to here as it needs to fire when max dimensions\n\t\t// change, excluding the dimension override\n\t\tconst initialDimensions: ITerminalDimensionsDto | undefined = request.cols && request.rows ? {\n\t\t\tcolumns: request.cols,\n\t\t\trows: request.rows\n\t\t} : undefined;\n\n\t\tthis._proxy.$startExtensionTerminal(\n\t\t\tproxy.instanceId,\n\t\t\tinitialDimensions\n\t\t).then(request.callback);\n\n\t\tstore.add(proxy.onInput(data => this._proxy.$acceptProcessInput(proxy.instanceId, data)));\n\t\tstore.add(proxy.onShutdown(immediate => this._proxy.$acceptProcessShutdown(proxy.instanceId, immediate)));\n\t\tstore.add(proxy.onRequestCwd(() => this._proxy.$acceptProcessRequestCwd(proxy.instanceId)));\n\t\tstore.add(proxy.onRequestInitialCwd(() => this._proxy.$acceptProcessRequestInitialCwd(proxy.instanceId)));\n\t}\n\n\tpublic $sendProcessData(terminalId: number, data: string): void {\n\t\tthis._terminalProcessProxies.get(terminalId)?.proxy.emitData(data);\n\t}\n\n\tpublic $sendProcessReady(terminalId: number, pid: number, cwd: string, windowsPty: IProcessReadyWindowsPty | undefined): void {\n\t\tthis._terminalProcessProxies.get(terminalId)?.proxy.emitReady(pid, cwd, windowsPty);\n\t}\n\n\tpublic $sendProcessProperty(terminalId: number, property: IProcessProperty): void {\n\t\tif (property.type === ProcessPropertyType.Title) {\n\t\t\tconst instance = this._terminalService.getInstanceFromId(terminalId);\n\t\t\tinstance?.rename(property.value as IProcessPropertyMap[ProcessPropertyType.Title]);\n\t\t}\n\t\tthis._terminalProcessProxies.get(terminalId)?.proxy.emitProcessProperty(property);\n\t}\n\n\t$setEnvironmentVariableCollection(extensionIdentifier: string, persistent: boolean, collection: ISerializableEnvironmentVariableCollection | undefined, descriptionMap: ISerializableEnvironmentDescriptionMap): void {\n\t\tif (collection) {\n\t\t\tconst translatedCollection = {\n\t\t\t\tpersistent,\n\t\t\t\tmap: deserializeEnvironmentVariableCollection(collection),\n\t\t\t\tdescriptionMap: deserializeEnvironmentDescriptionMap(descriptionMap)\n\t\t\t};\n\t\t\tthis._environmentVariableService.set(extensionIdentifier, translatedCollection);\n\t\t} else {\n\t\t\tthis._environmentVariableService.delete(extensionIdentifier);\n\t\t}\n\t}\n}\n\n/**\n * Encapsulates temporary tracking of data events from terminal instances, once disposed all\n * listeners are removed.\n */\nclass TerminalDataEventTracker extends Disposable {\n\tprivate readonly _bufferer: TerminalDataBufferer;\n\n\tconstructor(\n\t\tprivate readonly _callback: (id: number, data: string) => void,\n\t\t@ITerminalService private readonly _terminalService: ITerminalService\n\t) {\n\t\tsuper();\n\n\t\tthis._register(this._bufferer = new TerminalDataBufferer(this._callback));\n\n\t\tfor (const instance of this._terminalService.instances) {\n\t\t\tthis._registerInstance(instance);\n\t\t}\n\t\tthis._register(this._terminalService.onDidCreateInstance(instance => this._registerInstance(instance)));\n\t\tthis._register(this._terminalService.onDidDisposeInstance(instance => this._bufferer.stopBuffering(instance.instanceId)));\n\t}\n\n\tprivate _registerInstance(instance: ITerminalInstance): void {\n\t\t// Buffer data events to reduce the amount of messages going to the extension host\n\t\tthis._register(this._bufferer.startBuffering(instance.instanceId, instance.onData));\n\t}\n}\n\nclass ExtensionTerminalLinkProvider implements ITerminalExternalLinkProvider {\n\tconstructor(\n\t\tprivate readonly _proxy: ExtHostTerminalServiceShape\n\t) {\n\t}\n\n\tasync provideLinks(instance: ITerminalInstance, line: string): Promise<ITerminalLink[] | undefined> {\n\t\tconst proxy = this._proxy;\n\t\tconst extHostLinks = await proxy.$provideLinks(instance.instanceId, line);\n\t\treturn extHostLinks.map(dto => ({\n\t\t\tid: dto.id,\n\t\t\tstartIndex: dto.startIndex,\n\t\t\tlength: dto.length,\n\t\t\tlabel: dto.label,\n\t\t\tactivate: () => proxy.$activateLink(instance.instanceId, dto.id)\n\t\t}));\n\t}\n}\n\nexport function getOutputMatchForLines(lines: string[], outputMatcher: ITerminalOutputMatcher): ITerminalOutputMatch | undefined {\n\tconst match: RegExpMatchArray | null | undefined = lines.join('\\n').match(outputMatcher.lineMatcher);\n\treturn match ? { regexMatch: match, outputLines: lines } : undefined;\n}\n\nfunction parseQuickFix(id: string, source: string, fix: TerminalQuickFix): ITerminalQuickFix {\n\tlet type = TerminalQuickFixType.TerminalCommand;\n\tif (hasKey(fix, { uri: true })) {\n\t\tfix.uri = URI.revive(fix.uri);\n\t\ttype = TerminalQuickFixType.Opener;\n\t} else if (hasKey(fix, { id: true })) {\n\t\ttype = TerminalQuickFixType.VscodeCommand;\n\t}\n\treturn { id, type, source, ...fix };\n}\n"]}