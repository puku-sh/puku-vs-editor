{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/api/browser/mainThreadDocuments.ts","vs/workbench/api/browser/mainThreadDocuments.ts"],"names":[],"mappings":"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","file":"mainThreadDocuments.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { toErrorMessage } from '../../../base/common/errorMessage.js';\nimport { IReference, dispose, Disposable } from '../../../base/common/lifecycle.js';\nimport { Schemas } from '../../../base/common/network.js';\nimport { URI, UriComponents } from '../../../base/common/uri.js';\nimport { ITextModel, shouldSynchronizeModel } from '../../../editor/common/model.js';\nimport { IModelService } from '../../../editor/common/services/model.js';\nimport { ITextModelService } from '../../../editor/common/services/resolverService.js';\nimport { IFileService, FileOperation } from '../../../platform/files/common/files.js';\nimport { ExtHostContext, ExtHostDocumentsShape, MainThreadDocumentsShape } from '../common/extHost.protocol.js';\nimport { EncodingMode, ITextFileEditorModel, ITextFileService, TextFileResolveReason } from '../../services/textfile/common/textfiles.js';\nimport { IUntitledTextEditorModel } from '../../services/untitled/common/untitledTextEditorModel.js';\nimport { IWorkbenchEnvironmentService } from '../../services/environment/common/environmentService.js';\nimport { toLocalResource, extUri, IExtUri } from '../../../base/common/resources.js';\nimport { IWorkingCopyFileService } from '../../services/workingCopy/common/workingCopyFileService.js';\nimport { IUriIdentityService } from '../../../platform/uriIdentity/common/uriIdentity.js';\nimport { Emitter, Event } from '../../../base/common/event.js';\nimport { IPathService } from '../../services/path/common/pathService.js';\nimport { ResourceMap } from '../../../base/common/map.js';\nimport { IExtHostContext } from '../../services/extensions/common/extHostCustomers.js';\nimport { ErrorNoTelemetry, onUnexpectedError } from '../../../base/common/errors.js';\nimport { ISerializedModelContentChangedEvent } from '../../../editor/common/textModelEvents.js';\n\nexport class BoundModelReferenceCollection {\n\n\tprivate _data = new Array<{ uri: URI; length: number; dispose(): void }>();\n\tprivate _length = 0;\n\n\tconstructor(\n\t\tprivate readonly _extUri: IExtUri,\n\t\tprivate readonly _maxAge: number = 1000 * 60 * 3, // auto-dispse by age\n\t\tprivate readonly _maxLength: number = 1024 * 1024 * 80, // auto-dispose by total length\n\t\tprivate readonly _maxSize: number = 50 // auto-dispose by number of references\n\t) {\n\t\t//\n\t}\n\n\tdispose(): void {\n\t\tthis._data = dispose(this._data);\n\t}\n\n\tremove(uri: URI): void {\n\t\tfor (const entry of [...this._data] /* copy array because dispose will modify it */) {\n\t\t\tif (this._extUri.isEqualOrParent(entry.uri, uri)) {\n\t\t\t\tentry.dispose();\n\t\t\t}\n\t\t}\n\t}\n\n\tadd(uri: URI, ref: IReference<unknown>, length: number = 0): void {\n\t\t// const length = ref.object.textEditorModel.getValueLength();\n\t\tconst dispose = () => {\n\t\t\tconst idx = this._data.indexOf(entry);\n\t\t\tif (idx >= 0) {\n\t\t\t\tthis._length -= length;\n\t\t\t\tref.dispose();\n\t\t\t\tclearTimeout(handle);\n\t\t\t\tthis._data.splice(idx, 1);\n\t\t\t}\n\t\t};\n\t\tconst handle = setTimeout(dispose, this._maxAge);\n\t\tconst entry = { uri, length, dispose };\n\n\t\tthis._data.push(entry);\n\t\tthis._length += length;\n\t\tthis._cleanup();\n\t}\n\n\tprivate _cleanup(): void {\n\t\t// clean-up wrt total length\n\t\twhile (this._length > this._maxLength) {\n\t\t\tthis._data[0].dispose();\n\t\t}\n\t\t// clean-up wrt number of documents\n\t\tconst extraSize = Math.ceil(this._maxSize * 1.2);\n\t\tif (this._data.length >= extraSize) {\n\t\t\tdispose(this._data.slice(0, extraSize - this._maxSize));\n\t\t}\n\t}\n}\n\nclass ModelTracker extends Disposable {\n\n\tprivate _knownVersionId: number;\n\n\tconstructor(\n\t\tprivate readonly _model: ITextModel,\n\t\tprivate readonly _onIsCaughtUpWithContentChanges: Emitter<URI>,\n\t\tprivate readonly _proxy: ExtHostDocumentsShape,\n\t\tprivate readonly _textFileService: ITextFileService,\n\t) {\n\t\tsuper();\n\t\tthis._knownVersionId = this._model.getVersionId();\n\t\tthis._store.add(this._model.onDidChangeContent((e) => {\n\t\t\tthis._knownVersionId = e.versionId;\n\t\t\tif (e.detailedReasonsChangeLengths.length !== 1) {\n\t\t\t\tonUnexpectedError(new Error(`Unexpected reasons: ${e.detailedReasons.map(r => r.toString())}`));\n\t\t\t}\n\n\t\t\tconst evt: ISerializedModelContentChangedEvent = {\n\t\t\t\tchanges: e.changes,\n\t\t\t\tisEolChange: e.isEolChange,\n\t\t\t\tisUndoing: e.isUndoing,\n\t\t\t\tisRedoing: e.isRedoing,\n\t\t\t\tisFlush: e.isFlush,\n\t\t\t\teol: e.eol,\n\t\t\t\tversionId: e.versionId,\n\t\t\t\tdetailedReason: e.detailedReasons[0].metadata,\n\t\t\t};\n\t\t\tthis._proxy.$acceptModelChanged(this._model.uri, evt, this._textFileService.isDirty(this._model.uri));\n\t\t\tif (this.isCaughtUpWithContentChanges()) {\n\t\t\t\tthis._onIsCaughtUpWithContentChanges.fire(this._model.uri);\n\t\t\t}\n\t\t}));\n\t}\n\n\tisCaughtUpWithContentChanges(): boolean {\n\t\treturn (this._model.getVersionId() === this._knownVersionId);\n\t}\n}\n\nexport class MainThreadDocuments extends Disposable implements MainThreadDocumentsShape {\n\n\tprivate _onIsCaughtUpWithContentChanges = this._store.add(new Emitter<URI>());\n\treadonly onIsCaughtUpWithContentChanges = this._onIsCaughtUpWithContentChanges.event;\n\n\tprivate readonly _proxy: ExtHostDocumentsShape;\n\tprivate readonly _modelTrackers = new ResourceMap<ModelTracker>();\n\tprivate readonly _modelReferenceCollection: BoundModelReferenceCollection;\n\n\tconstructor(\n\t\textHostContext: IExtHostContext,\n\t\t@IModelService private readonly _modelService: IModelService,\n\t\t@ITextFileService private readonly _textFileService: ITextFileService,\n\t\t@IFileService private readonly _fileService: IFileService,\n\t\t@ITextModelService private readonly _textModelResolverService: ITextModelService,\n\t\t@IWorkbenchEnvironmentService private readonly _environmentService: IWorkbenchEnvironmentService,\n\t\t@IUriIdentityService private readonly _uriIdentityService: IUriIdentityService,\n\t\t@IWorkingCopyFileService workingCopyFileService: IWorkingCopyFileService,\n\t\t@IPathService private readonly _pathService: IPathService\n\t) {\n\t\tsuper();\n\n\t\tthis._modelReferenceCollection = this._store.add(new BoundModelReferenceCollection(_uriIdentityService.extUri));\n\n\t\tthis._proxy = extHostContext.getProxy(ExtHostContext.ExtHostDocuments);\n\n\t\tthis._store.add(_modelService.onModelLanguageChanged(this._onModelModeChanged, this));\n\n\t\tthis._store.add(_textFileService.files.onDidSave(e => {\n\t\t\tif (this._shouldHandleFileEvent(e.model.resource)) {\n\t\t\t\tthis._proxy.$acceptModelSaved(e.model.resource);\n\t\t\t}\n\t\t}));\n\t\tthis._store.add(_textFileService.files.onDidChangeDirty(m => {\n\t\t\tif (this._shouldHandleFileEvent(m.resource)) {\n\t\t\t\tthis._proxy.$acceptDirtyStateChanged(m.resource, m.isDirty());\n\t\t\t}\n\t\t}));\n\t\tthis._store.add(Event.any<ITextFileEditorModel | IUntitledTextEditorModel>(_textFileService.files.onDidChangeEncoding, _textFileService.untitled.onDidChangeEncoding)(m => {\n\t\t\tif (this._shouldHandleFileEvent(m.resource)) {\n\t\t\t\tconst encoding = m.getEncoding();\n\t\t\t\tif (encoding) {\n\t\t\t\t\tthis._proxy.$acceptEncodingChanged(m.resource, encoding);\n\t\t\t\t}\n\t\t\t}\n\t\t}));\n\n\t\tthis._store.add(workingCopyFileService.onDidRunWorkingCopyFileOperation(e => {\n\t\t\tconst isMove = e.operation === FileOperation.MOVE;\n\t\t\tif (isMove || e.operation === FileOperation.DELETE) {\n\t\t\t\tfor (const pair of e.files) {\n\t\t\t\t\tconst removed = isMove ? pair.source : pair.target;\n\t\t\t\t\tif (removed) {\n\t\t\t\t\t\tthis._modelReferenceCollection.remove(removed);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}));\n\t}\n\n\toverride dispose(): void {\n\t\tdispose(this._modelTrackers.values());\n\t\tthis._modelTrackers.clear();\n\t\tsuper.dispose();\n\t}\n\n\tisCaughtUpWithContentChanges(resource: URI): boolean {\n\t\tconst tracker = this._modelTrackers.get(resource);\n\t\tif (tracker) {\n\t\t\treturn tracker.isCaughtUpWithContentChanges();\n\t\t}\n\t\treturn true;\n\t}\n\n\tprivate _shouldHandleFileEvent(resource: URI): boolean {\n\t\tconst model = this._modelService.getModel(resource);\n\t\treturn !!model && shouldSynchronizeModel(model);\n\t}\n\n\thandleModelAdded(model: ITextModel): void {\n\t\t// Same filter as in mainThreadEditorsTracker\n\t\tif (!shouldSynchronizeModel(model)) {\n\t\t\t// don't synchronize too large models\n\t\t\treturn;\n\t\t}\n\t\tthis._modelTrackers.set(model.uri, new ModelTracker(model, this._onIsCaughtUpWithContentChanges, this._proxy, this._textFileService));\n\t}\n\n\tprivate _onModelModeChanged(event: { model: ITextModel; oldLanguageId: string }): void {\n\t\tconst { model } = event;\n\t\tif (!this._modelTrackers.has(model.uri)) {\n\t\t\treturn;\n\t\t}\n\t\tthis._proxy.$acceptModelLanguageChanged(model.uri, model.getLanguageId());\n\t}\n\n\thandleModelRemoved(modelUrl: URI): void {\n\t\tif (!this._modelTrackers.has(modelUrl)) {\n\t\t\treturn;\n\t\t}\n\t\tthis._modelTrackers.get(modelUrl)!.dispose();\n\t\tthis._modelTrackers.delete(modelUrl);\n\t}\n\n\t// --- from extension host process\n\n\tasync $trySaveDocument(uri: UriComponents): Promise<boolean> {\n\t\tconst target = await this._textFileService.save(URI.revive(uri));\n\t\treturn Boolean(target);\n\t}\n\n\tasync $tryOpenDocument(uriData: UriComponents, options?: { encoding?: string }): Promise<URI> {\n\t\tconst inputUri = URI.revive(uriData);\n\t\tif (!inputUri.scheme || !(inputUri.fsPath || inputUri.authority)) {\n\t\t\tthrow new ErrorNoTelemetry(`Invalid uri. Scheme and authority or path must be set.`);\n\t\t}\n\n\t\tconst canonicalUri = this._uriIdentityService.asCanonicalUri(inputUri);\n\n\t\tlet promise: Promise<URI>;\n\t\tswitch (canonicalUri.scheme) {\n\t\t\tcase Schemas.untitled:\n\t\t\t\tpromise = this._handleUntitledScheme(canonicalUri, options);\n\t\t\t\tbreak;\n\t\t\tcase Schemas.file:\n\t\t\tdefault:\n\t\t\t\tpromise = this._handleAsResourceInput(canonicalUri, options);\n\t\t\t\tbreak;\n\t\t}\n\n\t\tlet documentUri: URI | undefined;\n\t\ttry {\n\t\t\tdocumentUri = await promise;\n\t\t} catch (err) {\n\t\t\tthrow new ErrorNoTelemetry(`cannot open ${canonicalUri.toString()}. Detail: ${toErrorMessage(err)}`);\n\t\t}\n\t\tif (!documentUri) {\n\t\t\tthrow new ErrorNoTelemetry(`cannot open ${canonicalUri.toString()}`);\n\t\t} else if (!extUri.isEqual(documentUri, canonicalUri)) {\n\t\t\tthrow new ErrorNoTelemetry(`cannot open ${canonicalUri.toString()}. Detail: Actual document opened as ${documentUri.toString()}`);\n\t\t} else if (!this._modelTrackers.has(canonicalUri)) {\n\t\t\tthrow new ErrorNoTelemetry(`cannot open ${canonicalUri.toString()}. Detail: Files above 50MB cannot be synchronized with extensions.`);\n\t\t} else {\n\t\t\treturn canonicalUri;\n\t\t}\n\t}\n\n\t$tryCreateDocument(options?: { language?: string; content?: string; encoding?: string }): Promise<URI> {\n\t\treturn this._doCreateUntitled(undefined, options);\n\t}\n\n\tprivate async _handleAsResourceInput(uri: URI, options?: { encoding?: string }): Promise<URI> {\n\t\tif (options?.encoding) {\n\t\t\tconst model = await this._textFileService.files.resolve(uri, { encoding: options.encoding, reason: TextFileResolveReason.REFERENCE });\n\t\t\tif (model.isDirty()) {\n\t\t\t\tthrow new ErrorNoTelemetry(`Cannot re-open a dirty text document with different encoding. Save it first.`);\n\t\t\t}\n\t\t\tawait model.setEncoding(options.encoding, EncodingMode.Decode);\n\t\t}\n\n\t\tconst ref = await this._textModelResolverService.createModelReference(uri);\n\t\tthis._modelReferenceCollection.add(uri, ref, ref.object.textEditorModel.getValueLength());\n\t\treturn ref.object.textEditorModel.uri;\n\t}\n\n\tprivate async _handleUntitledScheme(uri: URI, options?: { encoding?: string }): Promise<URI> {\n\t\tconst asLocalUri = toLocalResource(uri, this._environmentService.remoteAuthority, this._pathService.defaultUriScheme);\n\t\tconst exists = await this._fileService.exists(asLocalUri);\n\t\tif (exists) {\n\t\t\t// don't create a new file ontop of an existing file\n\t\t\treturn Promise.reject(new Error('file already exists'));\n\t\t}\n\t\treturn await this._doCreateUntitled(Boolean(uri.path) ? uri : undefined, options);\n\t}\n\n\tprivate async _doCreateUntitled(associatedResource?: URI, options?: { language?: string; content?: string; encoding?: string }): Promise<URI> {\n\t\tconst model = this._textFileService.untitled.create({\n\t\t\tassociatedResource,\n\t\t\tlanguageId: options?.language,\n\t\t\tinitialValue: options?.content,\n\t\t\tencoding: options?.encoding\n\t\t});\n\t\tif (options?.encoding) {\n\t\t\tawait model.setEncoding(options.encoding);\n\t\t}\n\t\tconst resource = model.resource;\n\t\tconst ref = await this._textModelResolverService.createModelReference(resource);\n\t\tif (!this._modelTrackers.has(resource)) {\n\t\t\tref.dispose();\n\t\t\tthrow new Error(`expected URI ${resource.toString()} to have come to LIFE`);\n\t\t}\n\t\tthis._modelReferenceCollection.add(resource, ref, ref.object.textEditorModel.getValueLength());\n\t\tEvent.once(model.onDidRevert)(() => this._modelReferenceCollection.remove(resource));\n\t\tthis._proxy.$acceptDirtyStateChanged(resource, true); // mark as dirty\n\t\treturn resource;\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { toErrorMessage } from '../../../base/common/errorMessage.js';\nimport { IReference, dispose, Disposable } from '../../../base/common/lifecycle.js';\nimport { Schemas } from '../../../base/common/network.js';\nimport { URI, UriComponents } from '../../../base/common/uri.js';\nimport { ITextModel, shouldSynchronizeModel } from '../../../editor/common/model.js';\nimport { IModelService } from '../../../editor/common/services/model.js';\nimport { ITextModelService } from '../../../editor/common/services/resolverService.js';\nimport { IFileService, FileOperation } from '../../../platform/files/common/files.js';\nimport { ExtHostContext, ExtHostDocumentsShape, MainThreadDocumentsShape } from '../common/extHost.protocol.js';\nimport { EncodingMode, ITextFileEditorModel, ITextFileService, TextFileResolveReason } from '../../services/textfile/common/textfiles.js';\nimport { IUntitledTextEditorModel } from '../../services/untitled/common/untitledTextEditorModel.js';\nimport { IWorkbenchEnvironmentService } from '../../services/environment/common/environmentService.js';\nimport { toLocalResource, extUri, IExtUri } from '../../../base/common/resources.js';\nimport { IWorkingCopyFileService } from '../../services/workingCopy/common/workingCopyFileService.js';\nimport { IUriIdentityService } from '../../../platform/uriIdentity/common/uriIdentity.js';\nimport { Emitter, Event } from '../../../base/common/event.js';\nimport { IPathService } from '../../services/path/common/pathService.js';\nimport { ResourceMap } from '../../../base/common/map.js';\nimport { IExtHostContext } from '../../services/extensions/common/extHostCustomers.js';\nimport { ErrorNoTelemetry, onUnexpectedError } from '../../../base/common/errors.js';\nimport { ISerializedModelContentChangedEvent } from '../../../editor/common/textModelEvents.js';\n\nexport class BoundModelReferenceCollection {\n\n\tprivate _data = new Array<{ uri: URI; length: number; dispose(): void }>();\n\tprivate _length = 0;\n\n\tconstructor(\n\t\tprivate readonly _extUri: IExtUri,\n\t\tprivate readonly _maxAge: number = 1000 * 60 * 3, // auto-dispse by age\n\t\tprivate readonly _maxLength: number = 1024 * 1024 * 80, // auto-dispose by total length\n\t\tprivate readonly _maxSize: number = 50 // auto-dispose by number of references\n\t) {\n\t\t//\n\t}\n\n\tdispose(): void {\n\t\tthis._data = dispose(this._data);\n\t}\n\n\tremove(uri: URI): void {\n\t\tfor (const entry of [...this._data] /* copy array because dispose will modify it */) {\n\t\t\tif (this._extUri.isEqualOrParent(entry.uri, uri)) {\n\t\t\t\tentry.dispose();\n\t\t\t}\n\t\t}\n\t}\n\n\tadd(uri: URI, ref: IReference<unknown>, length: number = 0): void {\n\t\t// const length = ref.object.textEditorModel.getValueLength();\n\t\tconst dispose = () => {\n\t\t\tconst idx = this._data.indexOf(entry);\n\t\t\tif (idx >= 0) {\n\t\t\t\tthis._length -= length;\n\t\t\t\tref.dispose();\n\t\t\t\tclearTimeout(handle);\n\t\t\t\tthis._data.splice(idx, 1);\n\t\t\t}\n\t\t};\n\t\tconst handle = setTimeout(dispose, this._maxAge);\n\t\tconst entry = { uri, length, dispose };\n\n\t\tthis._data.push(entry);\n\t\tthis._length += length;\n\t\tthis._cleanup();\n\t}\n\n\tprivate _cleanup(): void {\n\t\t// clean-up wrt total length\n\t\twhile (this._length > this._maxLength) {\n\t\t\tthis._data[0].dispose();\n\t\t}\n\t\t// clean-up wrt number of documents\n\t\tconst extraSize = Math.ceil(this._maxSize * 1.2);\n\t\tif (this._data.length >= extraSize) {\n\t\t\tdispose(this._data.slice(0, extraSize - this._maxSize));\n\t\t}\n\t}\n}\n\nclass ModelTracker extends Disposable {\n\n\tprivate _knownVersionId: number;\n\n\tconstructor(\n\t\tprivate readonly _model: ITextModel,\n\t\tprivate readonly _onIsCaughtUpWithContentChanges: Emitter<URI>,\n\t\tprivate readonly _proxy: ExtHostDocumentsShape,\n\t\tprivate readonly _textFileService: ITextFileService,\n\t) {\n\t\tsuper();\n\t\tthis._knownVersionId = this._model.getVersionId();\n\t\tthis._store.add(this._model.onDidChangeContent((e) => {\n\t\t\tthis._knownVersionId = e.versionId;\n\t\t\tif (e.detailedReasonsChangeLengths.length !== 1) {\n\t\t\t\tonUnexpectedError(new Error(`Unexpected reasons: ${e.detailedReasons.map(r => r.toString())}`));\n\t\t\t}\n\n\t\t\tconst evt: ISerializedModelContentChangedEvent = {\n\t\t\t\tchanges: e.changes,\n\t\t\t\tisEolChange: e.isEolChange,\n\t\t\t\tisUndoing: e.isUndoing,\n\t\t\t\tisRedoing: e.isRedoing,\n\t\t\t\tisFlush: e.isFlush,\n\t\t\t\teol: e.eol,\n\t\t\t\tversionId: e.versionId,\n\t\t\t\tdetailedReason: e.detailedReasons[0].metadata,\n\t\t\t};\n\t\t\tthis._proxy.$acceptModelChanged(this._model.uri, evt, this._textFileService.isDirty(this._model.uri));\n\t\t\tif (this.isCaughtUpWithContentChanges()) {\n\t\t\t\tthis._onIsCaughtUpWithContentChanges.fire(this._model.uri);\n\t\t\t}\n\t\t}));\n\t}\n\n\tisCaughtUpWithContentChanges(): boolean {\n\t\treturn (this._model.getVersionId() === this._knownVersionId);\n\t}\n}\n\nexport class MainThreadDocuments extends Disposable implements MainThreadDocumentsShape {\n\n\tprivate _onIsCaughtUpWithContentChanges = this._store.add(new Emitter<URI>());\n\treadonly onIsCaughtUpWithContentChanges = this._onIsCaughtUpWithContentChanges.event;\n\n\tprivate readonly _proxy: ExtHostDocumentsShape;\n\tprivate readonly _modelTrackers = new ResourceMap<ModelTracker>();\n\tprivate readonly _modelReferenceCollection: BoundModelReferenceCollection;\n\n\tconstructor(\n\t\textHostContext: IExtHostContext,\n\t\t@IModelService private readonly _modelService: IModelService,\n\t\t@ITextFileService private readonly _textFileService: ITextFileService,\n\t\t@IFileService private readonly _fileService: IFileService,\n\t\t@ITextModelService private readonly _textModelResolverService: ITextModelService,\n\t\t@IWorkbenchEnvironmentService private readonly _environmentService: IWorkbenchEnvironmentService,\n\t\t@IUriIdentityService private readonly _uriIdentityService: IUriIdentityService,\n\t\t@IWorkingCopyFileService workingCopyFileService: IWorkingCopyFileService,\n\t\t@IPathService private readonly _pathService: IPathService\n\t) {\n\t\tsuper();\n\n\t\tthis._modelReferenceCollection = this._store.add(new BoundModelReferenceCollection(_uriIdentityService.extUri));\n\n\t\tthis._proxy = extHostContext.getProxy(ExtHostContext.ExtHostDocuments);\n\n\t\tthis._store.add(_modelService.onModelLanguageChanged(this._onModelModeChanged, this));\n\n\t\tthis._store.add(_textFileService.files.onDidSave(e => {\n\t\t\tif (this._shouldHandleFileEvent(e.model.resource)) {\n\t\t\t\tthis._proxy.$acceptModelSaved(e.model.resource);\n\t\t\t}\n\t\t}));\n\t\tthis._store.add(_textFileService.files.onDidChangeDirty(m => {\n\t\t\tif (this._shouldHandleFileEvent(m.resource)) {\n\t\t\t\tthis._proxy.$acceptDirtyStateChanged(m.resource, m.isDirty());\n\t\t\t}\n\t\t}));\n\t\tthis._store.add(Event.any<ITextFileEditorModel | IUntitledTextEditorModel>(_textFileService.files.onDidChangeEncoding, _textFileService.untitled.onDidChangeEncoding)(m => {\n\t\t\tif (this._shouldHandleFileEvent(m.resource)) {\n\t\t\t\tconst encoding = m.getEncoding();\n\t\t\t\tif (encoding) {\n\t\t\t\t\tthis._proxy.$acceptEncodingChanged(m.resource, encoding);\n\t\t\t\t}\n\t\t\t}\n\t\t}));\n\n\t\tthis._store.add(workingCopyFileService.onDidRunWorkingCopyFileOperation(e => {\n\t\t\tconst isMove = e.operation === FileOperation.MOVE;\n\t\t\tif (isMove || e.operation === FileOperation.DELETE) {\n\t\t\t\tfor (const pair of e.files) {\n\t\t\t\t\tconst removed = isMove ? pair.source : pair.target;\n\t\t\t\t\tif (removed) {\n\t\t\t\t\t\tthis._modelReferenceCollection.remove(removed);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}));\n\t}\n\n\toverride dispose(): void {\n\t\tdispose(this._modelTrackers.values());\n\t\tthis._modelTrackers.clear();\n\t\tsuper.dispose();\n\t}\n\n\tisCaughtUpWithContentChanges(resource: URI): boolean {\n\t\tconst tracker = this._modelTrackers.get(resource);\n\t\tif (tracker) {\n\t\t\treturn tracker.isCaughtUpWithContentChanges();\n\t\t}\n\t\treturn true;\n\t}\n\n\tprivate _shouldHandleFileEvent(resource: URI): boolean {\n\t\tconst model = this._modelService.getModel(resource);\n\t\treturn !!model && shouldSynchronizeModel(model);\n\t}\n\n\thandleModelAdded(model: ITextModel): void {\n\t\t// Same filter as in mainThreadEditorsTracker\n\t\tif (!shouldSynchronizeModel(model)) {\n\t\t\t// don't synchronize too large models\n\t\t\treturn;\n\t\t}\n\t\tthis._modelTrackers.set(model.uri, new ModelTracker(model, this._onIsCaughtUpWithContentChanges, this._proxy, this._textFileService));\n\t}\n\n\tprivate _onModelModeChanged(event: { model: ITextModel; oldLanguageId: string }): void {\n\t\tconst { model } = event;\n\t\tif (!this._modelTrackers.has(model.uri)) {\n\t\t\treturn;\n\t\t}\n\t\tthis._proxy.$acceptModelLanguageChanged(model.uri, model.getLanguageId());\n\t}\n\n\thandleModelRemoved(modelUrl: URI): void {\n\t\tif (!this._modelTrackers.has(modelUrl)) {\n\t\t\treturn;\n\t\t}\n\t\tthis._modelTrackers.get(modelUrl)!.dispose();\n\t\tthis._modelTrackers.delete(modelUrl);\n\t}\n\n\t// --- from extension host process\n\n\tasync $trySaveDocument(uri: UriComponents): Promise<boolean> {\n\t\tconst target = await this._textFileService.save(URI.revive(uri));\n\t\treturn Boolean(target);\n\t}\n\n\tasync $tryOpenDocument(uriData: UriComponents, options?: { encoding?: string }): Promise<URI> {\n\t\tconst inputUri = URI.revive(uriData);\n\t\tif (!inputUri.scheme || !(inputUri.fsPath || inputUri.authority)) {\n\t\t\tthrow new ErrorNoTelemetry(`Invalid uri. Scheme and authority or path must be set.`);\n\t\t}\n\n\t\tconst canonicalUri = this._uriIdentityService.asCanonicalUri(inputUri);\n\n\t\tlet promise: Promise<URI>;\n\t\tswitch (canonicalUri.scheme) {\n\t\t\tcase Schemas.untitled:\n\t\t\t\tpromise = this._handleUntitledScheme(canonicalUri, options);\n\t\t\t\tbreak;\n\t\t\tcase Schemas.file:\n\t\t\tdefault:\n\t\t\t\tpromise = this._handleAsResourceInput(canonicalUri, options);\n\t\t\t\tbreak;\n\t\t}\n\n\t\tlet documentUri: URI | undefined;\n\t\ttry {\n\t\t\tdocumentUri = await promise;\n\t\t} catch (err) {\n\t\t\tthrow new ErrorNoTelemetry(`cannot open ${canonicalUri.toString()}. Detail: ${toErrorMessage(err)}`);\n\t\t}\n\t\tif (!documentUri) {\n\t\t\tthrow new ErrorNoTelemetry(`cannot open ${canonicalUri.toString()}`);\n\t\t} else if (!extUri.isEqual(documentUri, canonicalUri)) {\n\t\t\tthrow new ErrorNoTelemetry(`cannot open ${canonicalUri.toString()}. Detail: Actual document opened as ${documentUri.toString()}`);\n\t\t} else if (!this._modelTrackers.has(canonicalUri)) {\n\t\t\tthrow new ErrorNoTelemetry(`cannot open ${canonicalUri.toString()}. Detail: Files above 50MB cannot be synchronized with extensions.`);\n\t\t} else {\n\t\t\treturn canonicalUri;\n\t\t}\n\t}\n\n\t$tryCreateDocument(options?: { language?: string; content?: string; encoding?: string }): Promise<URI> {\n\t\treturn this._doCreateUntitled(undefined, options);\n\t}\n\n\tprivate async _handleAsResourceInput(uri: URI, options?: { encoding?: string }): Promise<URI> {\n\t\tif (options?.encoding) {\n\t\t\tconst model = await this._textFileService.files.resolve(uri, { encoding: options.encoding, reason: TextFileResolveReason.REFERENCE });\n\t\t\tif (model.isDirty()) {\n\t\t\t\tthrow new ErrorNoTelemetry(`Cannot re-open a dirty text document with different encoding. Save it first.`);\n\t\t\t}\n\t\t\tawait model.setEncoding(options.encoding, EncodingMode.Decode);\n\t\t}\n\n\t\tconst ref = await this._textModelResolverService.createModelReference(uri);\n\t\tthis._modelReferenceCollection.add(uri, ref, ref.object.textEditorModel.getValueLength());\n\t\treturn ref.object.textEditorModel.uri;\n\t}\n\n\tprivate async _handleUntitledScheme(uri: URI, options?: { encoding?: string }): Promise<URI> {\n\t\tconst asLocalUri = toLocalResource(uri, this._environmentService.remoteAuthority, this._pathService.defaultUriScheme);\n\t\tconst exists = await this._fileService.exists(asLocalUri);\n\t\tif (exists) {\n\t\t\t// don't create a new file ontop of an existing file\n\t\t\treturn Promise.reject(new Error('file already exists'));\n\t\t}\n\t\treturn await this._doCreateUntitled(Boolean(uri.path) ? uri : undefined, options);\n\t}\n\n\tprivate async _doCreateUntitled(associatedResource?: URI, options?: { language?: string; content?: string; encoding?: string }): Promise<URI> {\n\t\tconst model = this._textFileService.untitled.create({\n\t\t\tassociatedResource,\n\t\t\tlanguageId: options?.language,\n\t\t\tinitialValue: options?.content,\n\t\t\tencoding: options?.encoding\n\t\t});\n\t\tif (options?.encoding) {\n\t\t\tawait model.setEncoding(options.encoding);\n\t\t}\n\t\tconst resource = model.resource;\n\t\tconst ref = await this._textModelResolverService.createModelReference(resource);\n\t\tif (!this._modelTrackers.has(resource)) {\n\t\t\tref.dispose();\n\t\t\tthrow new Error(`expected URI ${resource.toString()} to have come to LIFE`);\n\t\t}\n\t\tthis._modelReferenceCollection.add(resource, ref, ref.object.textEditorModel.getValueLength());\n\t\tEvent.once(model.onDidRevert)(() => this._modelReferenceCollection.remove(resource));\n\t\tthis._proxy.$acceptDirtyStateChanged(resource, true); // mark as dirty\n\t\treturn resource;\n\t}\n}\n"]}