{"version":3,"sources":["vs/workbench/api/browser/mainThreadExtensionService.ts"],"names":[],"mappings":"AAAA;;;gGAGgG;;;;;;;;;;AAEhG,OAAO,EAAE,QAAQ,EAAE,MAAM,iCAAiC,CAAC;AAE3D,OAAO,EAAE,iBAAiB,EAAE,MAAM,sCAAsC,CAAC;AACzE,OAAO,EAAmB,+BAA+B,EAAE,MAAM,gCAAgC,CAAC;AAClG,OAAO,EAAE,UAAU,EAAE,MAAM,iCAAiC,CAAC;AAC7D,OAAO,QAAQ,MAAM,kCAAkC,CAAC;AACxD,OAAO,EAAE,GAAG,EAAiB,MAAM,6BAA6B,CAAC;AACjE,OAAO,EAAE,QAAQ,EAAE,MAAM,iBAAiB,CAAC;AAC3C,OAAO,EAAE,eAAe,EAAE,MAAM,+CAA+C,CAAC;AAEhF,OAAO,EAAE,iBAAiB,EAAE,MAAM,yEAAyE,CAAC;AAE5G,OAAO,EAAE,oBAAoB,EAAE,MAAM,uDAAuD,CAAC;AAC7F,OAAO,EAAyB,uBAAuB,EAA6D,yBAAyB,EAAE,MAAM,4DAA4D,CAAC;AAClN,OAAO,EAAE,cAAc,EAAgC,WAAW,EAAmC,MAAM,+BAA+B,CAAC;AAC3I,OAAO,EAAc,2BAA2B,EAAE,MAAM,+CAA+C,CAAC;AACxG,OAAO,EAAE,4BAA4B,EAAE,MAAM,yDAAyD,CAAC;AACvG,OAAO,EAAmB,oCAAoC,EAAE,MAAM,kEAAkE,CAAC;AAIzI,OAAO,EAA6C,iBAAiB,EAAyD,MAAM,gDAAgD,CAAC;AACrL,OAAO,EAAE,oBAAoB,EAA4C,MAAM,sDAAsD,CAAC;AAEtI,OAAO,EAAE,YAAY,EAAE,MAAM,qCAAqC,CAAC;AACnE,OAAO,EAAE,aAAa,EAAE,MAAM,8CAA8C,CAAC;AAGtE,IAAM,0BAA0B,GAAhC,MAAM,0BAA0B;IAKtC,YACC,cAA+B,EACK,iBAAoC,EACjC,oBAA0C,EACnC,2BAAwD,EACvE,YAA0B,EACF,2BAAiE,EACxF,aAA4B,EAC1B,eAAgC,EACjB,mBAAiD;QAP9D,sBAAiB,GAAjB,iBAAiB,CAAmB;QACjC,yBAAoB,GAApB,oBAAoB,CAAsB;QACnC,gCAA2B,GAA3B,2BAA2B,CAA6B;QACvE,iBAAY,GAAZ,YAAY,CAAc;QACF,gCAA2B,GAA3B,2BAA2B,CAAsC;QACxF,kBAAa,GAAb,aAAa,CAAe;QAC1B,oBAAe,GAAf,eAAe,CAAiB;QACjB,wBAAmB,GAAnB,mBAAmB,CAA8B;QAElG,IAAI,CAAC,kBAAkB,GAAG,cAAc,CAAC,iBAAiB,CAAC;QAE3D,MAAM,sBAAsB,GAA6B,cAAe,CAAC;QACzE,IAAI,CAAC,yBAAyB,GAAG,sBAAsB,CAAC,wBAAwB,CAAC;QACjF,sBAAsB,CAAC,sBAAsB,CAC5C,IAAI,kBAAkB,CAAC,cAAc,CAAC,QAAQ,CAAC,cAAc,CAAC,uBAAuB,CAAC,CAAC,CACvF,CAAC;QACF,uFAAuF;QACvF,sBAAsB,CAAC,2BAA2B,CAAC,MAAM,CAAC,IAAI,CAAC,WAAW,CAAC,CAAC,GAAG,CAAC,CAAC,GAAG,EAAE,EAAE,CAAO,WAAY,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC;IACpH,CAAC;IAEM,OAAO;IACd,CAAC;IAED,aAAa,CAAC,WAAmB;QAChC,OAAO,IAAI,CAAC,iBAAiB,CAAC,YAAY,CAAC,WAAW,CAAC,CAAC;IACzD,CAAC;IACD,kBAAkB,CAAC,WAAgC,EAAE,MAAiC;QACrF,OAAO,IAAI,CAAC,yBAAyB,CAAC,aAAa,CAAC,WAAW,EAAE,MAAM,CAAC,CAAC;IAC1E,CAAC;IACD,KAAK,CAAC,wBAAwB,CAAC,WAAgC;QAC9D,IAAI,CAAC,yBAAyB,CAAC,wBAAwB,CAAC,WAAW,CAAC,CAAC;IACtE,CAAC;IACD,uBAAuB,CAAC,WAAgC,EAAE,eAAuB,EAAE,gBAAwB,EAAE,oBAA4B,EAAE,gBAA2C;QACrL,IAAI,CAAC,yBAAyB,CAAC,uBAAuB,CAAC,WAAW,EAAE,eAAe,EAAE,gBAAgB,EAAE,oBAAoB,EAAE,gBAAgB,CAAC,CAAC;IAChJ,CAAC;IACD,wBAAwB,CAAC,WAAgC,EAAE,IAAqB;QAC/E,MAAM,KAAK,GAAG,+BAA+B,CAAC,IAAI,CAAC,CAAC;QACpD,IAAI,CAAC,yBAAyB,CAAC,wBAAwB,CAAC,WAAW,EAAE,KAAK,CAAC,CAAC;QAC5E,OAAO,CAAC,KAAK,CAAC,IAAI,WAAW,CAAC,KAAK,IAAI,KAAK,CAAC,OAAO,EAAE,CAAC,CAAC;QACxD,OAAO,CAAC,KAAK,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC;IAC5B,CAAC;IACD,KAAK,CAAC,2BAA2B,CAAC,WAAgC,EAAE,IAAqB,EAAE,0BAA6D;QACvJ,MAAM,KAAK,GAAG,+BAA+B,CAAC,IAAI,CAAC,CAAC;QAEpD,IAAI,CAAC,yBAAyB,CAAC,4BAA4B,CAAC,WAAW,EAAE,KAAK,CAAC,CAAC;QAEhF,IAAI,0BAA0B,EAAE,CAAC;YAChC,MAAM,SAAS,GAAG,MAAM,IAAI,CAAC,iBAAiB,CAAC,YAAY,CAAC,WAAW,CAAC,KAAK,CAAC,CAAC;YAC/E,IAAI,SAAS,EAAE,CAAC;gBACf,MAAM,KAAK,GAAG,MAAM,IAAI,CAAC,2BAA2B,CAAC,UAAU,EAAE,CAAC;gBAClE,MAAM,mBAAmB,GAAG,KAAK,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,CAAC,iBAAiB,CAAC,CAAC,CAAC,UAAU,EAAE,EAAE,EAAE,EAAE,0BAA0B,CAAC,UAAU,EAAE,CAAC,CAAC,CAAC;gBAC5H,IAAI,mBAAmB,EAAE,KAAK,EAAE,CAAC;oBAChC,MAAM,IAAI,CAAC,iCAAiC,CAAC,SAAS,EAAE,mBAAmB,CAAC,KAAK,CAAC,CAAC;oBACnF,OAAO;gBACR,CAAC;qBAAM,CAAC;oBACP,MAAM,IAAI,CAAC,oCAAoC,CAAC,SAAS,EAAE,0BAA0B,CAAC,UAAU,CAAC,CAAC;oBAClG,OAAO;gBACR,CAAC;YACF,CAAC;QACF,CAAC;QAED,MAAM,KAAK,GAAG,CAAC,IAAI,CAAC,mBAAmB,CAAC,OAAO,IAAI,IAAI,CAAC,mBAAmB,CAAC,sBAAsB,CAAC;QACnG,IAAI,KAAK,EAAE,CAAC;YACX,IAAI,CAAC,oBAAoB,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC;YACvC,OAAO;QACR,CAAC;QAED,OAAO,CAAC,KAAK,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC;IAC9B,CAAC;IAEO,KAAK,CAAC,iCAAiC,CAAC,SAAgC,EAAE,0BAA2C;QAC5H,MAAM,OAAO,GAAG,SAAS,CAAC,WAAW,IAAI,SAAS,CAAC,IAAI,CAAC;QACxD,IAAI,IAAI,CAAC,2BAA2B,CAAC,SAAS,CAAC,0BAA0B,CAAC,EAAE,CAAC;YAC5E,IAAI,CAAC,oBAAoB,CAAC,MAAM,CAAC;gBAChC,QAAQ,EAAE,QAAQ,CAAC,KAAK;gBACxB,OAAO,EAAE,QAAQ,CAAC,IAAe,EAAE,IAAgK,EAAE,OAAO,EAAE,0BAA0B,CAAC,QAAQ,CAAC,WAAW,IAAI,0BAA0B,CAAC,QAAQ,CAAC,IAAI,CAAC;gBAC1S,OAAO,EAAE;oBACR,OAAO,EAAE,CAAC,QAAQ,CAAC,EAAE,EAAE,EAAE,QAAQ,EAAE,KAAK,EAAE,QAAQ,CAAC,IAAQ,EAAE,IAAe,CAAC,EAAE,GAAG,EAAE,GAAG,EAAE,CAAC,IAAI,CAAC,YAAY,CAAC,MAAM,EAAE,EAAE,CAAC,CAAC;iBACxH;aACD,CAAC,CAAC;QACJ,CAAC;aAAM,CAAC;YACP,MAAM,eAAe,GAAG,IAAI,CAAC,2BAA2B,CAAC,kBAAkB,CAAC,0BAA0B,CAAC,CAAC;YACxG,IAAI,eAAe,uDAA+C,EAAE,CAAC;gBACpE,IAAI,CAAC,oBAAoB,CAAC,MAAM,CAAC;oBAChC,QAAQ,EAAE,QAAQ,CAAC,KAAK;oBACxB,OAAO,EAAE,QAAQ,CAAC,IAAyB,EAAE,IAA+H,EAAE,OAAO,EAAE,0BAA0B,CAAC,QAAQ,CAAC,WAAW,IAAI,0BAA0B,CAAC,QAAQ,CAAC,IAAI,CAAC;iBACnR,CAAC,CAAC;YACJ,CAAC;iBAAM,IAAI,eAAe,uDAA+C,EAAE,CAAC;gBAC3E,IAAI,CAAC,oBAAoB,CAAC,MAAM,CAAC;oBAChC,QAAQ,EAAE,QAAQ,CAAC,KAAK;oBACxB,OAAO,EAAE,QAAQ,CAAC,IAAgB,EAAE,IAAyH,EAAE,OAAO,EAAE,0BAA0B,CAAC,QAAQ,CAAC,WAAW,IAAI,0BAA0B,CAAC,QAAQ,CAAC,IAAI,CAAC;oBACpQ,OAAO,EAAE;wBACR,OAAO,EAAE,CAAC,QAAQ,CAAC,EAAE,EAAE,EAAE,sBAAsB,EAAE,KAAK,EAAE,QAAQ,CAAC,IAAsB,EAAE,IAAwB,CAAC,EAAE,GAAG,EAAE,GAAG,EAAE,CAAC,IAAI,CAAC,eAAe,CAAC,cAAc,CAAC,wBAAwB,CAAC,EAAE,CAAC,CAAC;qBAChM;iBACD,CAAC,CAAC;YACJ,CAAC;iBAAM,IAAI,IAAI,CAAC,2BAA2B,CAAC,mBAAmB,CAAC,0BAA0B,CAAC,EAAE,CAAC;gBAC7F,IAAI,CAAC,oBAAoB,CAAC,MAAM,CAAC;oBAChC,QAAQ,EAAE,QAAQ,CAAC,KAAK;oBACxB,OAAO,EAAE,QAAQ,CAAC,IAAa,EAAE,IAAgK,EAAE,OAAO,EAAE,0BAA0B,CAAC,QAAQ,CAAC,WAAW,IAAI,0BAA0B,CAAC,QAAQ,CAAC,IAAI,CAAC;oBACxS,OAAO,EAAE;wBACR,OAAO,EAAE,CAAC,QAAQ,CAAC;gCAClB,EAAE,EAAE,QAAQ,EAAE,KAAK,EAAE,QAAQ,CAAC,IAAY,EAAE,IAAmB,CAAC,EAAE,OAAO,EAAE,IAAI;gCAC/E,GAAG,EAAE,GAAG,EAAE,CAAC,IAAI,CAAC,2BAA2B,CAAC,aAAa,CAAC,CAAC,0BAA0B,CAAC,EAAE,eAAe,8CAAqC,CAAC,CAAC,0CAAiC,CAAC,0CAAiC,CAAC;qCAChN,IAAI,CAAC,GAAG,EAAE,CAAC,IAAI,CAAC,YAAY,CAAC,MAAM,EAAE,EAAE,CAAC,CAAC,EAAE,CAAC,IAAI,CAAC,oBAAoB,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC;6BACjF,CAAC,CAAC;qBACH;iBACD,CAAC,CAAC;YACJ,CAAC;iBAAM,CAAC;gBACP,IAAI,CAAC,oBAAoB,CAAC,MAAM,CAAC;oBAChC,QAAQ,EAAE,QAAQ,CAAC,KAAK;oBACxB,OAAO,EAAE,QAAQ,CAAC,IAAqB,EAAE,IAAkG,EAAE,OAAO,EAAE,0BAA0B,CAAC,QAAQ,CAAC,WAAW,IAAI,0BAA0B,CAAC,QAAQ,CAAC,IAAI,CAAC;iBAClP,CAAC,CAAC;YACJ,CAAC;QACF,CAAC;IACF,CAAC;IAEO,KAAK,CAAC,oCAAoC,CAAC,SAAgC,EAAE,iBAAyB;QAC7G,MAAM,OAAO,GAAG,SAAS,CAAC,WAAW,IAAI,SAAS,CAAC,IAAI,CAAC;QACxD,IAAI,mBAAmB,GAAsB,IAAI,CAAC;QAClD,IAAI,CAAC;YACJ,mBAAmB,GAAG,CAAC,MAAM,IAAI,CAAC,2BAA2B,CAAC,aAAa,CAAC,CAAC,EAAE,EAAE,EAAE,iBAAiB,EAAE,CAAC,EAAE,iBAAiB,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;QACtI,CAAC;QAAC,OAAO,GAAG,EAAE,CAAC;QACf,CAAC;QACD,IAAI,mBAAmB,EAAE,CAAC;YACzB,IAAI,CAAC,oBAAoB,CAAC,MAAM,CAAC;gBAChC,QAAQ,EAAE,QAAQ,CAAC,KAAK;gBACxB,OAAO,EAAE,QAAQ,CAAC,IAAgB,EAAE,IAAkL,EAAE,OAAO,EAAE,mBAAmB,CAAC,WAAW,EAAE,mBAAmB,CAAC,oBAAoB,CAAC;gBAC3S,OAAO,EAAE;oBACR,OAAO,EAAE,CAAC,QAAQ,CAAC;4BAClB,EAAE,EAAE,SAAS;4BACb,KAAK,EAAE,QAAQ,CAAC,IAAqB,EAAE,IAAoB,CAAC;4BAC5D,GAAG,EAAE,GAAG,EAAE,CAAC,IAAI,CAAC,2BAA2B,CAAC,OAAO,CAAC,mBAAmB,CAAC;iCACtE,IAAI,CAAC,GAAG,EAAE,CAAC,IAAI,CAAC,YAAY,CAAC,MAAM,EAAE,EAAE,CAAC,CAAC,EAAE,CAAC,IAAI,CAAC,oBAAoB,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC;yBACjF,CAAC,CAAC;iBACH;aACD,CAAC,CAAC;QACJ,CAAC;aAAM,CAAC;YACP,IAAI,CAAC,oBAAoB,CAAC,KAAK,CAAC,QAAQ,CAAC,IAAY,EAAE,IAAuF,EAAE,OAAO,EAAE,iBAAiB,CAAC,CAAC,CAAC;QAC9K,CAAC;IACF,CAAC;IAED,KAAK,CAAC,oBAAoB,CAAC,KAAwB;QAClD,IAAI,IAAI,CAAC,kBAAkB,2CAAmC,EAAE,CAAC;YAChE,IAAI,CAAC,aAAa,CAAC,mBAAmB,CAAC,cAAc,EAAE,KAAK,CAAC,CAAC;QAC/D,CAAC;aAAM,IAAI,IAAI,CAAC,kBAAkB,6CAAqC,EAAE,CAAC;YACzE,IAAI,CAAC,aAAa,CAAC,mBAAmB,CAAC,eAAe,EAAE,KAAK,CAAC,CAAC;QAChE,CAAC;aAAM,CAAC;YACP,IAAI,CAAC,aAAa,CAAC,mBAAmB,CAAC,eAAe,EAAE,KAAK,CAAC,CAAC;QAChE,CAAC;IACF,CAAC;IAED,KAAK,CAAC,aAAa,CAAC,GAAkB;QACrC,OAAO,UAAU,CAAC,eAAe,CAAC,GAAG,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,CAAC;IACpD,CAAC;CACD,CAAA;AAjKY,0BAA0B;IADtC,oBAAoB,CAAC,WAAW,CAAC,0BAA0B,CAAC;IAQ1D,WAAA,iBAAiB,CAAA;IACjB,WAAA,oBAAoB,CAAA;IACpB,WAAA,2BAA2B,CAAA;IAC3B,WAAA,YAAY,CAAA;IACZ,WAAA,oCAAoC,CAAA;IACpC,WAAA,aAAa,CAAA;IACb,WAAA,eAAe,CAAA;IACf,WAAA,4BAA4B,CAAA;GAdlB,0BAA0B,CAiKtC;;AAED,MAAM,kBAAkB;IACvB,YACkB,OAAqC;QAArC,YAAO,GAAP,OAAO,CAA8B;IACnD,CAAC;IAEL,KAAK,CAAC,gBAAgB,CAAC,eAAuB,EAAE,cAAsB;QACrE,MAAM,QAAQ,GAAG,4BAA4B,CAAC,MAAM,IAAI,CAAC,OAAO,CAAC,iBAAiB,CAAC,eAAe,EAAE,cAAc,CAAC,CAAC,CAAC;QACrH,OAAO,QAAQ,CAAC;IACjB,CAAC;IACD,KAAK,CAAC,eAAe,CAAC,eAAuB,EAAE,GAAQ;QACtD,MAAM,aAAa,GAAG,MAAM,IAAI,CAAC,OAAO,CAAC,gBAAgB,CAAC,eAAe,EAAE,GAAG,CAAC,CAAC;QAChF,OAAO,CAAC,aAAa,CAAC,CAAC,CAAC,GAAG,CAAC,MAAM,CAAC,aAAa,CAAC,CAAC,CAAC,CAAC,aAAa,CAAC,CAAC;IACpE,CAAC;IACD,kBAAkB,CAAC,eAA2C;QAC7D,OAAO,IAAI,CAAC,OAAO,CAAC,mBAAmB,CAAC,eAAe,CAAC,CAAC;IAC1D,CAAC;IACD,qBAAqB;QACpB,OAAO,IAAI,CAAC,OAAO,CAAC,sBAAsB,EAAE,CAAC;IAC9C,CAAC;IACD,eAAe,CAAC,eAAuB,EAAE,cAA8B;QACtE,OAAO,IAAI,CAAC,OAAO,CAAC,gBAAgB,CAAC,eAAe,EAAE,cAAc,CAAC,CAAC;IACvE,CAAC;IACD,QAAQ,CAAC,WAAgC,EAAE,MAAiC;QAC3E,OAAO,IAAI,CAAC,OAAO,CAAC,SAAS,CAAC,WAAW,EAAE,MAAM,CAAC,CAAC;IACpD,CAAC;IACD,oBAAoB,CAAC,GAAqC;QACzD,OAAO,IAAI,CAAC,OAAO,CAAC,qBAAqB,CAAC,GAAG,CAAC,CAAC;IAChD,CAAC;IACD,0BAA0B,CAAC,cAAqC;QAC/D,OAAO,IAAI,CAAC,OAAO,CAAC,2BAA2B,CAAC,cAAc,CAAC,CAAC;IACjE,CAAC;IACD,eAAe,CAAC,eAA2C;QAC1D,OAAO,IAAI,CAAC,OAAO,CAAC,gBAAgB,CAAC,eAAe,CAAC,CAAC;IACvD,CAAC;IACD,YAAY,CAAC,CAAS;QACrB,OAAO,IAAI,CAAC,OAAO,CAAC,aAAa,CAAC,CAAC,CAAC,CAAC;IACtC,CAAC;IACD,OAAO,CAAC,CAAW;QAClB,OAAO,IAAI,CAAC,OAAO,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC;IACjC,CAAC;IACD,SAAS,CAAC,IAAY;QACrB,OAAO,IAAI,CAAC,OAAO,CAAC,UAAU,CAAC,IAAI,CAAC,CAAC;IACtC,CAAC;CACD;AAED,SAAS,4BAA4B,CAAC,MAAoC;IACzE,IAAI,MAAM,CAAC,IAAI,KAAK,IAAI,EAAE,CAAC;QAC1B,OAAO;YACN,IAAI,EAAE,IAAI;YACV,KAAK,EAAE;gBACN,GAAG,MAAM,CAAC,KAAK;gBACf,SAAS,EAAE,uBAAuB,CAAC,MAAM,CAAC,KAAK,CAAC,SAAS,CAAC;aAC1D;SACD,CAAC;IACH,CAAC;SAAM,CAAC;QACP,OAAO,MAAM,CAAC;IACf,CAAC;AACF,CAAC;AAED,SAAS,uBAAuB,CAAC,iBAAyC;IACzE,OAAO;QACN,GAAG,iBAAiB;QACpB,SAAS,EAAE,gBAAgB,CAAC,iBAAiB,CAAC,SAAS,CAAC;KACxD,CAAC;AACH,CAAC;AAED,SAAS,gBAAgB,CAAC,UAAiC;IAC1D,IAAI,UAAU,CAAC,IAAI,2CAAmC,EAAE,CAAC;QACxD,OAAO,IAAI,yBAAyB,CAAC,UAAU,CAAC,IAAI,EAAE,UAAU,CAAC,IAAI,CAAC,CAAC;IACxE,CAAC;IACD,OAAO,IAAI,uBAAuB,CAAC,UAAU,CAAC,EAAE,CAAC,CAAC;AACnD,CAAC","file":"mainThreadExtensionService.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { toAction } from '../../../base/common/actions.js';\nimport { VSBuffer } from '../../../base/common/buffer.js';\nimport { CancellationToken } from '../../../base/common/cancellation.js';\nimport { SerializedError, transformErrorFromSerialization } from '../../../base/common/errors.js';\nimport { FileAccess } from '../../../base/common/network.js';\nimport Severity from '../../../base/common/severity.js';\nimport { URI, UriComponents } from '../../../base/common/uri.js';\nimport { localize } from '../../../nls.js';\nimport { ICommandService } from '../../../platform/commands/common/commands.js';\nimport { ILocalExtension } from '../../../platform/extensionManagement/common/extensionManagement.js';\nimport { areSameExtensions } from '../../../platform/extensionManagement/common/extensionManagementUtil.js';\nimport { ExtensionIdentifier, IExtensionDescription } from '../../../platform/extensions/common/extensions.js';\nimport { INotificationService } from '../../../platform/notification/common/notification.js';\nimport { IRemoteConnectionData, ManagedRemoteConnection, RemoteConnection, RemoteConnectionType, ResolvedAuthority, WebSocketRemoteConnection } from '../../../platform/remote/common/remoteAuthorityResolver.js';\nimport { ExtHostContext, ExtHostExtensionServiceShape, MainContext, MainThreadExtensionServiceShape } from '../common/extHost.protocol.js';\nimport { IExtension, IExtensionsWorkbenchService } from '../../contrib/extensions/common/extensions.js';\nimport { IWorkbenchEnvironmentService } from '../../services/environment/common/environmentService.js';\nimport { EnablementState, IWorkbenchExtensionEnablementService } from '../../services/extensionManagement/common/extensionManagement.js';\nimport { ExtensionHostKind } from '../../services/extensions/common/extensionHostKind.js';\nimport { IExtensionDescriptionDelta } from '../../services/extensions/common/extensionHostProtocol.js';\nimport { IExtensionHostProxy, IResolveAuthorityResult } from '../../services/extensions/common/extensionHostProxy.js';\nimport { ActivationKind, ExtensionActivationReason, IExtensionService, IInternalExtensionService, MissingExtensionDependency } from '../../services/extensions/common/extensions.js';\nimport { extHostNamedCustomer, IExtHostContext, IInternalExtHostContext } from '../../services/extensions/common/extHostCustomers.js';\nimport { Dto } from '../../services/extensions/common/proxyIdentifier.js';\nimport { IHostService } from '../../services/host/browser/host.js';\nimport { ITimerService } from '../../services/timer/browser/timerService.js';\n\n@extHostNamedCustomer(MainContext.MainThreadExtensionService)\nexport class MainThreadExtensionService implements MainThreadExtensionServiceShape {\n\n\tprivate readonly _extensionHostKind: ExtensionHostKind;\n\tprivate readonly _internalExtensionService: IInternalExtensionService;\n\n\tconstructor(\n\t\textHostContext: IExtHostContext,\n\t\t@IExtensionService private readonly _extensionService: IExtensionService,\n\t\t@INotificationService private readonly _notificationService: INotificationService,\n\t\t@IExtensionsWorkbenchService private readonly _extensionsWorkbenchService: IExtensionsWorkbenchService,\n\t\t@IHostService private readonly _hostService: IHostService,\n\t\t@IWorkbenchExtensionEnablementService private readonly _extensionEnablementService: IWorkbenchExtensionEnablementService,\n\t\t@ITimerService private readonly _timerService: ITimerService,\n\t\t@ICommandService private readonly _commandService: ICommandService,\n\t\t@IWorkbenchEnvironmentService protected readonly _environmentService: IWorkbenchEnvironmentService,\n\t) {\n\t\tthis._extensionHostKind = extHostContext.extensionHostKind;\n\n\t\tconst internalExtHostContext = (<IInternalExtHostContext>extHostContext);\n\t\tthis._internalExtensionService = internalExtHostContext.internalExtensionService;\n\t\tinternalExtHostContext._setExtensionHostProxy(\n\t\t\tnew ExtensionHostProxy(extHostContext.getProxy(ExtHostContext.ExtHostExtensionService))\n\t\t);\n\t\t// eslint-disable-next-line local/code-no-any-casts, @typescript-eslint/no-explicit-any\n\t\tinternalExtHostContext._setAllMainProxyIdentifiers(Object.keys(MainContext).map((key) => (<any>MainContext)[key]));\n\t}\n\n\tpublic dispose(): void {\n\t}\n\n\t$getExtension(extensionId: string) {\n\t\treturn this._extensionService.getExtension(extensionId);\n\t}\n\t$activateExtension(extensionId: ExtensionIdentifier, reason: ExtensionActivationReason): Promise<void> {\n\t\treturn this._internalExtensionService._activateById(extensionId, reason);\n\t}\n\tasync $onWillActivateExtension(extensionId: ExtensionIdentifier): Promise<void> {\n\t\tthis._internalExtensionService._onWillActivateExtension(extensionId);\n\t}\n\t$onDidActivateExtension(extensionId: ExtensionIdentifier, codeLoadingTime: number, activateCallTime: number, activateResolvedTime: number, activationReason: ExtensionActivationReason): void {\n\t\tthis._internalExtensionService._onDidActivateExtension(extensionId, codeLoadingTime, activateCallTime, activateResolvedTime, activationReason);\n\t}\n\t$onExtensionRuntimeError(extensionId: ExtensionIdentifier, data: SerializedError): void {\n\t\tconst error = transformErrorFromSerialization(data);\n\t\tthis._internalExtensionService._onExtensionRuntimeError(extensionId, error);\n\t\tconsole.error(`[${extensionId.value}]${error.message}`);\n\t\tconsole.error(error.stack);\n\t}\n\tasync $onExtensionActivationError(extensionId: ExtensionIdentifier, data: SerializedError, missingExtensionDependency: MissingExtensionDependency | null): Promise<void> {\n\t\tconst error = transformErrorFromSerialization(data);\n\n\t\tthis._internalExtensionService._onDidActivateExtensionError(extensionId, error);\n\n\t\tif (missingExtensionDependency) {\n\t\t\tconst extension = await this._extensionService.getExtension(extensionId.value);\n\t\t\tif (extension) {\n\t\t\t\tconst local = await this._extensionsWorkbenchService.queryLocal();\n\t\t\t\tconst installedDependency = local.find(i => areSameExtensions(i.identifier, { id: missingExtensionDependency.dependency }));\n\t\t\t\tif (installedDependency?.local) {\n\t\t\t\t\tawait this._handleMissingInstalledDependency(extension, installedDependency.local);\n\t\t\t\t\treturn;\n\t\t\t\t} else {\n\t\t\t\t\tawait this._handleMissingNotInstalledDependency(extension, missingExtensionDependency.dependency);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tconst isDev = !this._environmentService.isBuilt || this._environmentService.isExtensionDevelopment;\n\t\tif (isDev) {\n\t\t\tthis._notificationService.error(error);\n\t\t\treturn;\n\t\t}\n\n\t\tconsole.error(error.message);\n\t}\n\n\tprivate async _handleMissingInstalledDependency(extension: IExtensionDescription, missingInstalledDependency: ILocalExtension): Promise<void> {\n\t\tconst extName = extension.displayName || extension.name;\n\t\tif (this._extensionEnablementService.isEnabled(missingInstalledDependency)) {\n\t\t\tthis._notificationService.notify({\n\t\t\t\tseverity: Severity.Error,\n\t\t\t\tmessage: localize('reload window', \"Cannot activate the '{0}' extension because it depends on the '{1}' extension, which is not loaded. Would you like to reload the window to load the extension?\", extName, missingInstalledDependency.manifest.displayName || missingInstalledDependency.manifest.name),\n\t\t\t\tactions: {\n\t\t\t\t\tprimary: [toAction({ id: 'reload', label: localize('reload', \"Reload Window\"), run: () => this._hostService.reload() })]\n\t\t\t\t}\n\t\t\t});\n\t\t} else {\n\t\t\tconst enablementState = this._extensionEnablementService.getEnablementState(missingInstalledDependency);\n\t\t\tif (enablementState === EnablementState.DisabledByVirtualWorkspace) {\n\t\t\t\tthis._notificationService.notify({\n\t\t\t\t\tseverity: Severity.Error,\n\t\t\t\t\tmessage: localize('notSupportedInWorkspace', \"Cannot activate the '{0}' extension because it depends on the '{1}' extension which is not supported in the current workspace\", extName, missingInstalledDependency.manifest.displayName || missingInstalledDependency.manifest.name),\n\t\t\t\t});\n\t\t\t} else if (enablementState === EnablementState.DisabledByTrustRequirement) {\n\t\t\t\tthis._notificationService.notify({\n\t\t\t\t\tseverity: Severity.Error,\n\t\t\t\t\tmessage: localize('restrictedMode', \"Cannot activate the '{0}' extension because it depends on the '{1}' extension which is not supported in Restricted Mode\", extName, missingInstalledDependency.manifest.displayName || missingInstalledDependency.manifest.name),\n\t\t\t\t\tactions: {\n\t\t\t\t\t\tprimary: [toAction({ id: 'manageWorkspaceTrust', label: localize('manageWorkspaceTrust', \"Manage Workspace Trust\"), run: () => this._commandService.executeCommand('workbench.trust.manage') })]\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t} else if (this._extensionEnablementService.canChangeEnablement(missingInstalledDependency)) {\n\t\t\t\tthis._notificationService.notify({\n\t\t\t\t\tseverity: Severity.Error,\n\t\t\t\t\tmessage: localize('disabledDep', \"Cannot activate the '{0}' extension because it depends on the '{1}' extension which is disabled. Would you like to enable the extension and reload the window?\", extName, missingInstalledDependency.manifest.displayName || missingInstalledDependency.manifest.name),\n\t\t\t\t\tactions: {\n\t\t\t\t\t\tprimary: [toAction({\n\t\t\t\t\t\t\tid: 'enable', label: localize('enable dep', \"Enable and Reload\"), enabled: true,\n\t\t\t\t\t\t\trun: () => this._extensionEnablementService.setEnablement([missingInstalledDependency], enablementState === EnablementState.DisabledGlobally ? EnablementState.EnabledGlobally : EnablementState.EnabledWorkspace)\n\t\t\t\t\t\t\t\t.then(() => this._hostService.reload(), e => this._notificationService.error(e))\n\t\t\t\t\t\t})]\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tthis._notificationService.notify({\n\t\t\t\t\tseverity: Severity.Error,\n\t\t\t\t\tmessage: localize('disabledDepNoAction', \"Cannot activate the '{0}' extension because it depends on the '{1}' extension which is disabled.\", extName, missingInstalledDependency.manifest.displayName || missingInstalledDependency.manifest.name),\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate async _handleMissingNotInstalledDependency(extension: IExtensionDescription, missingDependency: string): Promise<void> {\n\t\tconst extName = extension.displayName || extension.name;\n\t\tlet dependencyExtension: IExtension | null = null;\n\t\ttry {\n\t\t\tdependencyExtension = (await this._extensionsWorkbenchService.getExtensions([{ id: missingDependency }], CancellationToken.None))[0];\n\t\t} catch (err) {\n\t\t}\n\t\tif (dependencyExtension) {\n\t\t\tthis._notificationService.notify({\n\t\t\t\tseverity: Severity.Error,\n\t\t\t\tmessage: localize('uninstalledDep', \"Cannot activate the '{0}' extension because it depends on the '{1}' extension from '{2}', which is not installed. Would you like to install the extension and reload the window?\", extName, dependencyExtension.displayName, dependencyExtension.publisherDisplayName),\n\t\t\t\tactions: {\n\t\t\t\t\tprimary: [toAction({\n\t\t\t\t\t\tid: 'install',\n\t\t\t\t\t\tlabel: localize('install missing dep', \"Install and Reload\"),\n\t\t\t\t\t\trun: () => this._extensionsWorkbenchService.install(dependencyExtension)\n\t\t\t\t\t\t\t.then(() => this._hostService.reload(), e => this._notificationService.error(e))\n\t\t\t\t\t})]\n\t\t\t\t}\n\t\t\t});\n\t\t} else {\n\t\t\tthis._notificationService.error(localize('unknownDep', \"Cannot activate the '{0}' extension because it depends on an unknown '{1}' extension.\", extName, missingDependency));\n\t\t}\n\t}\n\n\tasync $setPerformanceMarks(marks: PerformanceMark[]): Promise<void> {\n\t\tif (this._extensionHostKind === ExtensionHostKind.LocalProcess) {\n\t\t\tthis._timerService.setPerformanceMarks('localExtHost', marks);\n\t\t} else if (this._extensionHostKind === ExtensionHostKind.LocalWebWorker) {\n\t\t\tthis._timerService.setPerformanceMarks('workerExtHost', marks);\n\t\t} else {\n\t\t\tthis._timerService.setPerformanceMarks('remoteExtHost', marks);\n\t\t}\n\t}\n\n\tasync $asBrowserUri(uri: UriComponents): Promise<UriComponents> {\n\t\treturn FileAccess.uriToBrowserUri(URI.revive(uri));\n\t}\n}\n\nclass ExtensionHostProxy implements IExtensionHostProxy {\n\tconstructor(\n\t\tprivate readonly _actual: ExtHostExtensionServiceShape\n\t) { }\n\n\tasync resolveAuthority(remoteAuthority: string, resolveAttempt: number): Promise<IResolveAuthorityResult> {\n\t\tconst resolved = reviveResolveAuthorityResult(await this._actual.$resolveAuthority(remoteAuthority, resolveAttempt));\n\t\treturn resolved;\n\t}\n\tasync getCanonicalURI(remoteAuthority: string, uri: URI): Promise<URI | null> {\n\t\tconst uriComponents = await this._actual.$getCanonicalURI(remoteAuthority, uri);\n\t\treturn (uriComponents ? URI.revive(uriComponents) : uriComponents);\n\t}\n\tstartExtensionHost(extensionsDelta: IExtensionDescriptionDelta): Promise<void> {\n\t\treturn this._actual.$startExtensionHost(extensionsDelta);\n\t}\n\textensionTestsExecute(): Promise<number> {\n\t\treturn this._actual.$extensionTestsExecute();\n\t}\n\tactivateByEvent(activationEvent: string, activationKind: ActivationKind): Promise<void> {\n\t\treturn this._actual.$activateByEvent(activationEvent, activationKind);\n\t}\n\tactivate(extensionId: ExtensionIdentifier, reason: ExtensionActivationReason): Promise<boolean> {\n\t\treturn this._actual.$activate(extensionId, reason);\n\t}\n\tsetRemoteEnvironment(env: { [key: string]: string | null }): Promise<void> {\n\t\treturn this._actual.$setRemoteEnvironment(env);\n\t}\n\tupdateRemoteConnectionData(connectionData: IRemoteConnectionData): Promise<void> {\n\t\treturn this._actual.$updateRemoteConnectionData(connectionData);\n\t}\n\tdeltaExtensions(extensionsDelta: IExtensionDescriptionDelta): Promise<void> {\n\t\treturn this._actual.$deltaExtensions(extensionsDelta);\n\t}\n\ttest_latency(n: number): Promise<number> {\n\t\treturn this._actual.$test_latency(n);\n\t}\n\ttest_up(b: VSBuffer): Promise<number> {\n\t\treturn this._actual.$test_up(b);\n\t}\n\ttest_down(size: number): Promise<VSBuffer> {\n\t\treturn this._actual.$test_down(size);\n\t}\n}\n\nfunction reviveResolveAuthorityResult(result: Dto<IResolveAuthorityResult>): IResolveAuthorityResult {\n\tif (result.type === 'ok') {\n\t\treturn {\n\t\t\ttype: 'ok',\n\t\t\tvalue: {\n\t\t\t\t...result.value,\n\t\t\t\tauthority: reviveResolvedAuthority(result.value.authority),\n\t\t\t}\n\t\t};\n\t} else {\n\t\treturn result;\n\t}\n}\n\nfunction reviveResolvedAuthority(resolvedAuthority: Dto<ResolvedAuthority>): ResolvedAuthority {\n\treturn {\n\t\t...resolvedAuthority,\n\t\tconnectTo: reviveConnection(resolvedAuthority.connectTo),\n\t};\n}\n\nfunction reviveConnection(connection: Dto<RemoteConnection>): RemoteConnection {\n\tif (connection.type === RemoteConnectionType.WebSocket) {\n\t\treturn new WebSocketRemoteConnection(connection.host, connection.port);\n\t}\n\treturn new ManagedRemoteConnection(connection.id);\n}\n"]}