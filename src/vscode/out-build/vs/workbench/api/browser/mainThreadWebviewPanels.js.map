{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/api/browser/mainThreadWebviewPanels.ts","vs/workbench/api/browser/mainThreadWebviewPanels.ts"],"names":[],"mappings":"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","file":"mainThreadWebviewPanels.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { onUnexpectedError } from '../../../base/common/errors.js';\nimport { Event } from '../../../base/common/event.js';\nimport { Disposable, DisposableMap } from '../../../base/common/lifecycle.js';\nimport { URI } from '../../../base/common/uri.js';\nimport { generateUuid } from '../../../base/common/uuid.js';\nimport { IConfigurationService } from '../../../platform/configuration/common/configuration.js';\nimport { IStorageService } from '../../../platform/storage/common/storage.js';\nimport { DiffEditorInput } from '../../common/editor/diffEditorInput.js';\nimport { EditorInput } from '../../common/editor/editorInput.js';\nimport { ExtensionKeyedWebviewOriginStore, WebviewOptions } from '../../contrib/webview/browser/webview.js';\nimport { WebviewIcons, WebviewInput } from '../../contrib/webviewPanel/browser/webviewEditorInput.js';\nimport { IWebViewShowOptions, IWebviewWorkbenchService } from '../../contrib/webviewPanel/browser/webviewWorkbenchService.js';\nimport { editorGroupToColumn } from '../../services/editor/common/editorGroupColumn.js';\nimport { GroupLocation, GroupsOrder, IEditorGroup, IEditorGroupsService, preferredSideBySideGroupDirection } from '../../services/editor/common/editorGroupsService.js';\nimport { ACTIVE_GROUP, IEditorService, PreferredGroup, SIDE_GROUP } from '../../services/editor/common/editorService.js';\nimport { IExtensionService } from '../../services/extensions/common/extensions.js';\nimport { IExtHostContext } from '../../services/extensions/common/extHostCustomers.js';\nimport * as extHostProtocol from '../common/extHost.protocol.js';\nimport { MainThreadWebviews, reviveWebviewContentOptions, reviveWebviewExtension } from './mainThreadWebviews.js';\n\n/**\n * Bi-directional map between webview handles and inputs.\n */\nclass WebviewInputStore {\n\tprivate readonly _handlesToInputs = new Map<string, WebviewInput>();\n\tprivate readonly _inputsToHandles = new Map<WebviewInput, string>();\n\n\tpublic add(handle: string, input: WebviewInput): void {\n\t\tthis._handlesToInputs.set(handle, input);\n\t\tthis._inputsToHandles.set(input, handle);\n\t}\n\n\tpublic getHandleForInput(input: WebviewInput): string | undefined {\n\t\treturn this._inputsToHandles.get(input);\n\t}\n\n\tpublic getInputForHandle(handle: string): WebviewInput | undefined {\n\t\treturn this._handlesToInputs.get(handle);\n\t}\n\n\tpublic delete(handle: string): void {\n\t\tconst input = this.getInputForHandle(handle);\n\t\tthis._handlesToInputs.delete(handle);\n\t\tif (input) {\n\t\t\tthis._inputsToHandles.delete(input);\n\t\t}\n\t}\n\n\tpublic get size(): number {\n\t\treturn this._handlesToInputs.size;\n\t}\n\n\t[Symbol.iterator](): Iterator<WebviewInput> {\n\t\treturn this._handlesToInputs.values();\n\t}\n}\n\nclass WebviewViewTypeTransformer {\n\tpublic constructor(\n\t\tpublic readonly prefix: string,\n\t) { }\n\n\tpublic fromExternal(viewType: string): string {\n\t\treturn this.prefix + viewType;\n\t}\n\n\tpublic toExternal(viewType: string): string | undefined {\n\t\treturn viewType.startsWith(this.prefix)\n\t\t\t? viewType.substr(this.prefix.length)\n\t\t\t: undefined;\n\t}\n}\n\nexport class MainThreadWebviewPanels extends Disposable implements extHostProtocol.MainThreadWebviewPanelsShape {\n\n\tprivate readonly webviewPanelViewType = new WebviewViewTypeTransformer('mainThreadWebview-');\n\n\tprivate readonly _proxy: extHostProtocol.ExtHostWebviewPanelsShape;\n\n\tprivate readonly _webviewInputs = new WebviewInputStore();\n\n\tprivate readonly _revivers = this._register(new DisposableMap<string>());\n\n\tprivate readonly webviewOriginStore: ExtensionKeyedWebviewOriginStore;\n\n\tconstructor(\n\t\tcontext: IExtHostContext,\n\t\tprivate readonly _mainThreadWebviews: MainThreadWebviews,\n\t\t@IConfigurationService private readonly _configurationService: IConfigurationService,\n\t\t@IEditorGroupsService private readonly _editorGroupService: IEditorGroupsService,\n\t\t@IEditorService private readonly _editorService: IEditorService,\n\t\t@IExtensionService extensionService: IExtensionService,\n\t\t@IStorageService storageService: IStorageService,\n\t\t@IWebviewWorkbenchService private readonly _webviewWorkbenchService: IWebviewWorkbenchService,\n\t) {\n\t\tsuper();\n\n\t\tthis.webviewOriginStore = new ExtensionKeyedWebviewOriginStore('mainThreadWebviewPanel.origins', storageService);\n\n\t\tthis._proxy = context.getProxy(extHostProtocol.ExtHostContext.ExtHostWebviewPanels);\n\n\t\tthis._register(Event.any(\n\t\t\t_editorService.onDidActiveEditorChange,\n\t\t\t_editorService.onDidVisibleEditorsChange,\n\t\t\t_editorGroupService.onDidAddGroup,\n\t\t\t_editorGroupService.onDidRemoveGroup,\n\t\t\t_editorGroupService.onDidMoveGroup,\n\t\t)(() => {\n\t\t\tthis.updateWebviewViewStates(this._editorService.activeEditor);\n\t\t}));\n\n\t\tthis._register(_webviewWorkbenchService.onDidChangeActiveWebviewEditor(input => {\n\t\t\tthis.updateWebviewViewStates(input);\n\t\t}));\n\n\t\t// This reviver's only job is to activate extensions.\n\t\t// This should trigger the real reviver to be registered from the extension host side.\n\t\tthis._register(_webviewWorkbenchService.registerResolver({\n\t\t\tcanResolve: (webview: WebviewInput) => {\n\t\t\t\tconst viewType = this.webviewPanelViewType.toExternal(webview.viewType);\n\t\t\t\tif (typeof viewType === 'string') {\n\t\t\t\t\textensionService.activateByEvent(`onWebviewPanel:${viewType}`);\n\t\t\t\t}\n\t\t\t\treturn false;\n\t\t\t},\n\t\t\tresolveWebview: () => { throw new Error('not implemented'); }\n\t\t}));\n\t}\n\n\tpublic get webviewInputs(): Iterable<WebviewInput> { return this._webviewInputs; }\n\n\tpublic addWebviewInput(handle: extHostProtocol.WebviewHandle, input: WebviewInput, options: { serializeBuffersForPostMessage: boolean }): void {\n\t\tthis._webviewInputs.add(handle, input);\n\t\tthis._mainThreadWebviews.addWebview(handle, input.webview, options);\n\n\t\tconst disposeSub = input.webview.onDidDispose(() => {\n\t\t\tdisposeSub.dispose();\n\n\t\t\tthis._proxy.$onDidDisposeWebviewPanel(handle).finally(() => {\n\t\t\t\tthis._webviewInputs.delete(handle);\n\t\t\t});\n\t\t});\n\t}\n\n\tpublic $createWebviewPanel(\n\t\textensionData: extHostProtocol.WebviewExtensionDescription,\n\t\thandle: extHostProtocol.WebviewHandle,\n\t\tviewType: string,\n\t\tinitData: extHostProtocol.IWebviewInitData,\n\t\tshowOptions: extHostProtocol.WebviewPanelShowOptions,\n\t): void {\n\t\tconst targetGroup = this.getTargetGroupFromShowOptions(showOptions);\n\t\tconst mainThreadShowOptions: IWebViewShowOptions = showOptions ? {\n\t\t\tpreserveFocus: !!showOptions.preserveFocus,\n\t\t\tgroup: targetGroup\n\t\t} : {};\n\n\t\tconst extension = reviveWebviewExtension(extensionData);\n\t\tconst origin = this.webviewOriginStore.getOrigin(viewType, extension.id);\n\n\t\tconst webview = this._webviewWorkbenchService.openWebview({\n\t\t\torigin,\n\t\t\tprovidedViewType: viewType,\n\t\t\ttitle: initData.title,\n\t\t\toptions: reviveWebviewOptions(initData.panelOptions),\n\t\t\tcontentOptions: reviveWebviewContentOptions(initData.webviewOptions),\n\t\t\textension\n\t\t}, this.webviewPanelViewType.fromExternal(viewType), initData.title, undefined, mainThreadShowOptions);\n\n\t\tthis.addWebviewInput(handle, webview, { serializeBuffersForPostMessage: initData.serializeBuffersForPostMessage });\n\t}\n\n\tpublic $disposeWebview(handle: extHostProtocol.WebviewHandle): void {\n\t\tconst webview = this.tryGetWebviewInput(handle);\n\t\tif (!webview) {\n\t\t\treturn;\n\t\t}\n\t\twebview.dispose();\n\t}\n\n\tpublic $setTitle(handle: extHostProtocol.WebviewHandle, value: string): void {\n\t\tthis.tryGetWebviewInput(handle)?.setWebviewTitle(value);\n\t}\n\n\tpublic $setIconPath(handle: extHostProtocol.WebviewHandle, value: extHostProtocol.IWebviewIconPath | undefined): void {\n\t\tconst webview = this.tryGetWebviewInput(handle);\n\t\tif (webview) {\n\t\t\twebview.iconPath = reviveWebviewIcon(value);\n\t\t}\n\t}\n\n\tpublic $reveal(handle: extHostProtocol.WebviewHandle, showOptions: extHostProtocol.WebviewPanelShowOptions): void {\n\t\tconst webview = this.tryGetWebviewInput(handle);\n\t\tif (!webview || webview.isDisposed()) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst targetGroup = this.getTargetGroupFromShowOptions(showOptions);\n\t\tthis._webviewWorkbenchService.revealWebview(webview, targetGroup, !!showOptions.preserveFocus);\n\t}\n\n\tprivate getTargetGroupFromShowOptions(showOptions: extHostProtocol.WebviewPanelShowOptions): PreferredGroup {\n\t\tif (typeof showOptions.viewColumn === 'undefined'\n\t\t\t|| showOptions.viewColumn === ACTIVE_GROUP\n\t\t\t|| (this._editorGroupService.count === 1 && this._editorGroupService.activeGroup.isEmpty)\n\t\t) {\n\t\t\treturn ACTIVE_GROUP;\n\t\t}\n\n\t\tif (showOptions.viewColumn === SIDE_GROUP) {\n\t\t\treturn SIDE_GROUP;\n\t\t}\n\n\t\tif (showOptions.viewColumn >= 0) {\n\t\t\t// First check to see if an existing group exists\n\t\t\tconst groupInColumn = this._editorGroupService.getGroups(GroupsOrder.GRID_APPEARANCE)[showOptions.viewColumn];\n\t\t\tif (groupInColumn) {\n\t\t\t\treturn groupInColumn.id;\n\t\t\t}\n\n\t\t\t// We are dealing with an unknown group and therefore need a new group.\n\t\t\t// Note that the new group's id may not match the one requested. We only allow\n\t\t\t// creating a single new group, so if someone passes in `showOptions.viewColumn = 99`\n\t\t\t// and there are two editor groups open, we simply create a third editor group instead\n\t\t\t// of creating all the groups up to 99.\n\t\t\tconst newGroup = this._editorGroupService.findGroup({ location: GroupLocation.LAST });\n\t\t\tif (newGroup) {\n\t\t\t\tconst direction = preferredSideBySideGroupDirection(this._configurationService);\n\t\t\t\treturn this._editorGroupService.addGroup(newGroup, direction);\n\t\t\t}\n\t\t}\n\n\t\treturn ACTIVE_GROUP;\n\t}\n\n\tpublic $registerSerializer(viewType: string, options: { serializeBuffersForPostMessage: boolean }): void {\n\t\tif (this._revivers.has(viewType)) {\n\t\t\tthrow new Error(`Reviver for ${viewType} already registered`);\n\t\t}\n\n\t\tthis._revivers.set(viewType, this._webviewWorkbenchService.registerResolver({\n\t\t\tcanResolve: (webviewInput) => {\n\t\t\t\treturn webviewInput.viewType === this.webviewPanelViewType.fromExternal(viewType);\n\t\t\t},\n\t\t\tresolveWebview: async (webviewInput): Promise<void> => {\n\t\t\t\tconst viewType = this.webviewPanelViewType.toExternal(webviewInput.viewType);\n\t\t\t\tif (!viewType) {\n\t\t\t\t\twebviewInput.webview.setHtml(this._mainThreadWebviews.getWebviewResolvedFailedContent(webviewInput.viewType));\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst handle = generateUuid();\n\n\t\t\t\tthis.addWebviewInput(handle, webviewInput, options);\n\n\t\t\t\tlet state = undefined;\n\t\t\t\tif (webviewInput.webview.state) {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tstate = JSON.parse(webviewInput.webview.state);\n\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\tconsole.error('Could not load webview state', e, webviewInput.webview.state);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\ttry {\n\t\t\t\t\tawait this._proxy.$deserializeWebviewPanel(handle, viewType, {\n\t\t\t\t\t\ttitle: webviewInput.getTitle(),\n\t\t\t\t\t\tstate,\n\t\t\t\t\t\tpanelOptions: webviewInput.webview.options,\n\t\t\t\t\t\twebviewOptions: webviewInput.webview.contentOptions,\n\t\t\t\t\t\tactive: webviewInput === this._editorService.activeEditor,\n\t\t\t\t\t}, editorGroupToColumn(this._editorGroupService, webviewInput.group || 0));\n\t\t\t\t} catch (error) {\n\t\t\t\t\tonUnexpectedError(error);\n\t\t\t\t\twebviewInput.webview.setHtml(this._mainThreadWebviews.getWebviewResolvedFailedContent(viewType));\n\t\t\t\t}\n\t\t\t}\n\t\t}));\n\t}\n\n\tpublic $unregisterSerializer(viewType: string): void {\n\t\tif (!this._revivers.has(viewType)) {\n\t\t\tthrow new Error(`No reviver for ${viewType} registered`);\n\t\t}\n\n\t\tthis._revivers.deleteAndDispose(viewType);\n\t}\n\n\tprivate updateWebviewViewStates(activeEditorInput: EditorInput | undefined) {\n\t\tif (!this._webviewInputs.size) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst viewStates: extHostProtocol.WebviewPanelViewStateData = {};\n\n\t\tconst updateViewStatesForInput = (group: IEditorGroup, topLevelInput: EditorInput, editorInput: EditorInput) => {\n\t\t\tif (!(editorInput instanceof WebviewInput)) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\teditorInput.updateGroup(group.id);\n\n\t\t\tconst handle = this._webviewInputs.getHandleForInput(editorInput);\n\t\t\tif (handle) {\n\t\t\t\tviewStates[handle] = {\n\t\t\t\t\tvisible: topLevelInput === group.activeEditor,\n\t\t\t\t\tactive: editorInput === activeEditorInput,\n\t\t\t\t\tposition: editorGroupToColumn(this._editorGroupService, group.id),\n\t\t\t\t};\n\t\t\t}\n\t\t};\n\n\t\tfor (const group of this._editorGroupService.groups) {\n\t\t\tfor (const input of group.editors) {\n\t\t\t\tif (input instanceof DiffEditorInput) {\n\t\t\t\t\tupdateViewStatesForInput(group, input, input.primary);\n\t\t\t\t\tupdateViewStatesForInput(group, input, input.secondary);\n\t\t\t\t} else {\n\t\t\t\t\tupdateViewStatesForInput(group, input, input);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (Object.keys(viewStates).length) {\n\t\t\tthis._proxy.$onDidChangeWebviewPanelViewStates(viewStates);\n\t\t}\n\t}\n\n\tprivate tryGetWebviewInput(handle: extHostProtocol.WebviewHandle): WebviewInput | undefined {\n\t\treturn this._webviewInputs.getInputForHandle(handle);\n\t}\n}\n\nfunction reviveWebviewIcon(value: extHostProtocol.IWebviewIconPath | undefined): WebviewIcons | undefined {\n\tif (!value) {\n\t\treturn undefined;\n\t}\n\treturn {\n\t\tlight: URI.revive(value.light),\n\t\tdark: URI.revive(value.dark),\n\t};\n}\n\nfunction reviveWebviewOptions(panelOptions: extHostProtocol.IWebviewPanelOptions): WebviewOptions {\n\treturn {\n\t\tenableFindWidget: panelOptions.enableFindWidget,\n\t\tretainContextWhenHidden: panelOptions.retainContextWhenHidden,\n\t};\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { onUnexpectedError } from '../../../base/common/errors.js';\nimport { Event } from '../../../base/common/event.js';\nimport { Disposable, DisposableMap } from '../../../base/common/lifecycle.js';\nimport { URI } from '../../../base/common/uri.js';\nimport { generateUuid } from '../../../base/common/uuid.js';\nimport { IConfigurationService } from '../../../platform/configuration/common/configuration.js';\nimport { IStorageService } from '../../../platform/storage/common/storage.js';\nimport { DiffEditorInput } from '../../common/editor/diffEditorInput.js';\nimport { EditorInput } from '../../common/editor/editorInput.js';\nimport { ExtensionKeyedWebviewOriginStore, WebviewOptions } from '../../contrib/webview/browser/webview.js';\nimport { WebviewIcons, WebviewInput } from '../../contrib/webviewPanel/browser/webviewEditorInput.js';\nimport { IWebViewShowOptions, IWebviewWorkbenchService } from '../../contrib/webviewPanel/browser/webviewWorkbenchService.js';\nimport { editorGroupToColumn } from '../../services/editor/common/editorGroupColumn.js';\nimport { GroupLocation, GroupsOrder, IEditorGroup, IEditorGroupsService, preferredSideBySideGroupDirection } from '../../services/editor/common/editorGroupsService.js';\nimport { ACTIVE_GROUP, IEditorService, PreferredGroup, SIDE_GROUP } from '../../services/editor/common/editorService.js';\nimport { IExtensionService } from '../../services/extensions/common/extensions.js';\nimport { IExtHostContext } from '../../services/extensions/common/extHostCustomers.js';\nimport * as extHostProtocol from '../common/extHost.protocol.js';\nimport { MainThreadWebviews, reviveWebviewContentOptions, reviveWebviewExtension } from './mainThreadWebviews.js';\n\n/**\n * Bi-directional map between webview handles and inputs.\n */\nclass WebviewInputStore {\n\tprivate readonly _handlesToInputs = new Map<string, WebviewInput>();\n\tprivate readonly _inputsToHandles = new Map<WebviewInput, string>();\n\n\tpublic add(handle: string, input: WebviewInput): void {\n\t\tthis._handlesToInputs.set(handle, input);\n\t\tthis._inputsToHandles.set(input, handle);\n\t}\n\n\tpublic getHandleForInput(input: WebviewInput): string | undefined {\n\t\treturn this._inputsToHandles.get(input);\n\t}\n\n\tpublic getInputForHandle(handle: string): WebviewInput | undefined {\n\t\treturn this._handlesToInputs.get(handle);\n\t}\n\n\tpublic delete(handle: string): void {\n\t\tconst input = this.getInputForHandle(handle);\n\t\tthis._handlesToInputs.delete(handle);\n\t\tif (input) {\n\t\t\tthis._inputsToHandles.delete(input);\n\t\t}\n\t}\n\n\tpublic get size(): number {\n\t\treturn this._handlesToInputs.size;\n\t}\n\n\t[Symbol.iterator](): Iterator<WebviewInput> {\n\t\treturn this._handlesToInputs.values();\n\t}\n}\n\nclass WebviewViewTypeTransformer {\n\tpublic constructor(\n\t\tpublic readonly prefix: string,\n\t) { }\n\n\tpublic fromExternal(viewType: string): string {\n\t\treturn this.prefix + viewType;\n\t}\n\n\tpublic toExternal(viewType: string): string | undefined {\n\t\treturn viewType.startsWith(this.prefix)\n\t\t\t? viewType.substr(this.prefix.length)\n\t\t\t: undefined;\n\t}\n}\n\nexport class MainThreadWebviewPanels extends Disposable implements extHostProtocol.MainThreadWebviewPanelsShape {\n\n\tprivate readonly webviewPanelViewType = new WebviewViewTypeTransformer('mainThreadWebview-');\n\n\tprivate readonly _proxy: extHostProtocol.ExtHostWebviewPanelsShape;\n\n\tprivate readonly _webviewInputs = new WebviewInputStore();\n\n\tprivate readonly _revivers = this._register(new DisposableMap<string>());\n\n\tprivate readonly webviewOriginStore: ExtensionKeyedWebviewOriginStore;\n\n\tconstructor(\n\t\tcontext: IExtHostContext,\n\t\tprivate readonly _mainThreadWebviews: MainThreadWebviews,\n\t\t@IConfigurationService private readonly _configurationService: IConfigurationService,\n\t\t@IEditorGroupsService private readonly _editorGroupService: IEditorGroupsService,\n\t\t@IEditorService private readonly _editorService: IEditorService,\n\t\t@IExtensionService extensionService: IExtensionService,\n\t\t@IStorageService storageService: IStorageService,\n\t\t@IWebviewWorkbenchService private readonly _webviewWorkbenchService: IWebviewWorkbenchService,\n\t) {\n\t\tsuper();\n\n\t\tthis.webviewOriginStore = new ExtensionKeyedWebviewOriginStore('mainThreadWebviewPanel.origins', storageService);\n\n\t\tthis._proxy = context.getProxy(extHostProtocol.ExtHostContext.ExtHostWebviewPanels);\n\n\t\tthis._register(Event.any(\n\t\t\t_editorService.onDidActiveEditorChange,\n\t\t\t_editorService.onDidVisibleEditorsChange,\n\t\t\t_editorGroupService.onDidAddGroup,\n\t\t\t_editorGroupService.onDidRemoveGroup,\n\t\t\t_editorGroupService.onDidMoveGroup,\n\t\t)(() => {\n\t\t\tthis.updateWebviewViewStates(this._editorService.activeEditor);\n\t\t}));\n\n\t\tthis._register(_webviewWorkbenchService.onDidChangeActiveWebviewEditor(input => {\n\t\t\tthis.updateWebviewViewStates(input);\n\t\t}));\n\n\t\t// This reviver's only job is to activate extensions.\n\t\t// This should trigger the real reviver to be registered from the extension host side.\n\t\tthis._register(_webviewWorkbenchService.registerResolver({\n\t\t\tcanResolve: (webview: WebviewInput) => {\n\t\t\t\tconst viewType = this.webviewPanelViewType.toExternal(webview.viewType);\n\t\t\t\tif (typeof viewType === 'string') {\n\t\t\t\t\textensionService.activateByEvent(`onWebviewPanel:${viewType}`);\n\t\t\t\t}\n\t\t\t\treturn false;\n\t\t\t},\n\t\t\tresolveWebview: () => { throw new Error('not implemented'); }\n\t\t}));\n\t}\n\n\tpublic get webviewInputs(): Iterable<WebviewInput> { return this._webviewInputs; }\n\n\tpublic addWebviewInput(handle: extHostProtocol.WebviewHandle, input: WebviewInput, options: { serializeBuffersForPostMessage: boolean }): void {\n\t\tthis._webviewInputs.add(handle, input);\n\t\tthis._mainThreadWebviews.addWebview(handle, input.webview, options);\n\n\t\tconst disposeSub = input.webview.onDidDispose(() => {\n\t\t\tdisposeSub.dispose();\n\n\t\t\tthis._proxy.$onDidDisposeWebviewPanel(handle).finally(() => {\n\t\t\t\tthis._webviewInputs.delete(handle);\n\t\t\t});\n\t\t});\n\t}\n\n\tpublic $createWebviewPanel(\n\t\textensionData: extHostProtocol.WebviewExtensionDescription,\n\t\thandle: extHostProtocol.WebviewHandle,\n\t\tviewType: string,\n\t\tinitData: extHostProtocol.IWebviewInitData,\n\t\tshowOptions: extHostProtocol.WebviewPanelShowOptions,\n\t): void {\n\t\tconst targetGroup = this.getTargetGroupFromShowOptions(showOptions);\n\t\tconst mainThreadShowOptions: IWebViewShowOptions = showOptions ? {\n\t\t\tpreserveFocus: !!showOptions.preserveFocus,\n\t\t\tgroup: targetGroup\n\t\t} : {};\n\n\t\tconst extension = reviveWebviewExtension(extensionData);\n\t\tconst origin = this.webviewOriginStore.getOrigin(viewType, extension.id);\n\n\t\tconst webview = this._webviewWorkbenchService.openWebview({\n\t\t\torigin,\n\t\t\tprovidedViewType: viewType,\n\t\t\ttitle: initData.title,\n\t\t\toptions: reviveWebviewOptions(initData.panelOptions),\n\t\t\tcontentOptions: reviveWebviewContentOptions(initData.webviewOptions),\n\t\t\textension\n\t\t}, this.webviewPanelViewType.fromExternal(viewType), initData.title, undefined, mainThreadShowOptions);\n\n\t\tthis.addWebviewInput(handle, webview, { serializeBuffersForPostMessage: initData.serializeBuffersForPostMessage });\n\t}\n\n\tpublic $disposeWebview(handle: extHostProtocol.WebviewHandle): void {\n\t\tconst webview = this.tryGetWebviewInput(handle);\n\t\tif (!webview) {\n\t\t\treturn;\n\t\t}\n\t\twebview.dispose();\n\t}\n\n\tpublic $setTitle(handle: extHostProtocol.WebviewHandle, value: string): void {\n\t\tthis.tryGetWebviewInput(handle)?.setWebviewTitle(value);\n\t}\n\n\tpublic $setIconPath(handle: extHostProtocol.WebviewHandle, value: extHostProtocol.IWebviewIconPath | undefined): void {\n\t\tconst webview = this.tryGetWebviewInput(handle);\n\t\tif (webview) {\n\t\t\twebview.iconPath = reviveWebviewIcon(value);\n\t\t}\n\t}\n\n\tpublic $reveal(handle: extHostProtocol.WebviewHandle, showOptions: extHostProtocol.WebviewPanelShowOptions): void {\n\t\tconst webview = this.tryGetWebviewInput(handle);\n\t\tif (!webview || webview.isDisposed()) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst targetGroup = this.getTargetGroupFromShowOptions(showOptions);\n\t\tthis._webviewWorkbenchService.revealWebview(webview, targetGroup, !!showOptions.preserveFocus);\n\t}\n\n\tprivate getTargetGroupFromShowOptions(showOptions: extHostProtocol.WebviewPanelShowOptions): PreferredGroup {\n\t\tif (typeof showOptions.viewColumn === 'undefined'\n\t\t\t|| showOptions.viewColumn === ACTIVE_GROUP\n\t\t\t|| (this._editorGroupService.count === 1 && this._editorGroupService.activeGroup.isEmpty)\n\t\t) {\n\t\t\treturn ACTIVE_GROUP;\n\t\t}\n\n\t\tif (showOptions.viewColumn === SIDE_GROUP) {\n\t\t\treturn SIDE_GROUP;\n\t\t}\n\n\t\tif (showOptions.viewColumn >= 0) {\n\t\t\t// First check to see if an existing group exists\n\t\t\tconst groupInColumn = this._editorGroupService.getGroups(GroupsOrder.GRID_APPEARANCE)[showOptions.viewColumn];\n\t\t\tif (groupInColumn) {\n\t\t\t\treturn groupInColumn.id;\n\t\t\t}\n\n\t\t\t// We are dealing with an unknown group and therefore need a new group.\n\t\t\t// Note that the new group's id may not match the one requested. We only allow\n\t\t\t// creating a single new group, so if someone passes in `showOptions.viewColumn = 99`\n\t\t\t// and there are two editor groups open, we simply create a third editor group instead\n\t\t\t// of creating all the groups up to 99.\n\t\t\tconst newGroup = this._editorGroupService.findGroup({ location: GroupLocation.LAST });\n\t\t\tif (newGroup) {\n\t\t\t\tconst direction = preferredSideBySideGroupDirection(this._configurationService);\n\t\t\t\treturn this._editorGroupService.addGroup(newGroup, direction);\n\t\t\t}\n\t\t}\n\n\t\treturn ACTIVE_GROUP;\n\t}\n\n\tpublic $registerSerializer(viewType: string, options: { serializeBuffersForPostMessage: boolean }): void {\n\t\tif (this._revivers.has(viewType)) {\n\t\t\tthrow new Error(`Reviver for ${viewType} already registered`);\n\t\t}\n\n\t\tthis._revivers.set(viewType, this._webviewWorkbenchService.registerResolver({\n\t\t\tcanResolve: (webviewInput) => {\n\t\t\t\treturn webviewInput.viewType === this.webviewPanelViewType.fromExternal(viewType);\n\t\t\t},\n\t\t\tresolveWebview: async (webviewInput): Promise<void> => {\n\t\t\t\tconst viewType = this.webviewPanelViewType.toExternal(webviewInput.viewType);\n\t\t\t\tif (!viewType) {\n\t\t\t\t\twebviewInput.webview.setHtml(this._mainThreadWebviews.getWebviewResolvedFailedContent(webviewInput.viewType));\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst handle = generateUuid();\n\n\t\t\t\tthis.addWebviewInput(handle, webviewInput, options);\n\n\t\t\t\tlet state = undefined;\n\t\t\t\tif (webviewInput.webview.state) {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tstate = JSON.parse(webviewInput.webview.state);\n\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\tconsole.error('Could not load webview state', e, webviewInput.webview.state);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\ttry {\n\t\t\t\t\tawait this._proxy.$deserializeWebviewPanel(handle, viewType, {\n\t\t\t\t\t\ttitle: webviewInput.getTitle(),\n\t\t\t\t\t\tstate,\n\t\t\t\t\t\tpanelOptions: webviewInput.webview.options,\n\t\t\t\t\t\twebviewOptions: webviewInput.webview.contentOptions,\n\t\t\t\t\t\tactive: webviewInput === this._editorService.activeEditor,\n\t\t\t\t\t}, editorGroupToColumn(this._editorGroupService, webviewInput.group || 0));\n\t\t\t\t} catch (error) {\n\t\t\t\t\tonUnexpectedError(error);\n\t\t\t\t\twebviewInput.webview.setHtml(this._mainThreadWebviews.getWebviewResolvedFailedContent(viewType));\n\t\t\t\t}\n\t\t\t}\n\t\t}));\n\t}\n\n\tpublic $unregisterSerializer(viewType: string): void {\n\t\tif (!this._revivers.has(viewType)) {\n\t\t\tthrow new Error(`No reviver for ${viewType} registered`);\n\t\t}\n\n\t\tthis._revivers.deleteAndDispose(viewType);\n\t}\n\n\tprivate updateWebviewViewStates(activeEditorInput: EditorInput | undefined) {\n\t\tif (!this._webviewInputs.size) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst viewStates: extHostProtocol.WebviewPanelViewStateData = {};\n\n\t\tconst updateViewStatesForInput = (group: IEditorGroup, topLevelInput: EditorInput, editorInput: EditorInput) => {\n\t\t\tif (!(editorInput instanceof WebviewInput)) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\teditorInput.updateGroup(group.id);\n\n\t\t\tconst handle = this._webviewInputs.getHandleForInput(editorInput);\n\t\t\tif (handle) {\n\t\t\t\tviewStates[handle] = {\n\t\t\t\t\tvisible: topLevelInput === group.activeEditor,\n\t\t\t\t\tactive: editorInput === activeEditorInput,\n\t\t\t\t\tposition: editorGroupToColumn(this._editorGroupService, group.id),\n\t\t\t\t};\n\t\t\t}\n\t\t};\n\n\t\tfor (const group of this._editorGroupService.groups) {\n\t\t\tfor (const input of group.editors) {\n\t\t\t\tif (input instanceof DiffEditorInput) {\n\t\t\t\t\tupdateViewStatesForInput(group, input, input.primary);\n\t\t\t\t\tupdateViewStatesForInput(group, input, input.secondary);\n\t\t\t\t} else {\n\t\t\t\t\tupdateViewStatesForInput(group, input, input);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (Object.keys(viewStates).length) {\n\t\t\tthis._proxy.$onDidChangeWebviewPanelViewStates(viewStates);\n\t\t}\n\t}\n\n\tprivate tryGetWebviewInput(handle: extHostProtocol.WebviewHandle): WebviewInput | undefined {\n\t\treturn this._webviewInputs.getInputForHandle(handle);\n\t}\n}\n\nfunction reviveWebviewIcon(value: extHostProtocol.IWebviewIconPath | undefined): WebviewIcons | undefined {\n\tif (!value) {\n\t\treturn undefined;\n\t}\n\treturn {\n\t\tlight: URI.revive(value.light),\n\t\tdark: URI.revive(value.dark),\n\t};\n}\n\nfunction reviveWebviewOptions(panelOptions: extHostProtocol.IWebviewPanelOptions): WebviewOptions {\n\treturn {\n\t\tenableFindWidget: panelOptions.enableFindWidget,\n\t\tretainContextWhenHidden: panelOptions.retainContextWhenHidden,\n\t};\n}\n"]}