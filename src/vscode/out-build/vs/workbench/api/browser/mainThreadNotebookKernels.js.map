{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/api/browser/mainThreadNotebookKernels.ts","vs/workbench/api/browser/mainThreadNotebookKernels.ts"],"names":[],"mappings":"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","file":"mainThreadNotebookKernels.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { isNonEmptyArray } from '../../../base/common/arrays.js';\nimport { CancellationToken } from '../../../base/common/cancellation.js';\nimport { onUnexpectedError } from '../../../base/common/errors.js';\nimport { Emitter, Event } from '../../../base/common/event.js';\nimport { DisposableMap, DisposableStore, IDisposable, toDisposable } from '../../../base/common/lifecycle.js';\nimport { URI, UriComponents } from '../../../base/common/uri.js';\nimport { ILanguageService } from '../../../editor/common/languages/language.js';\nimport { ExtensionIdentifier } from '../../../platform/extensions/common/extensions.js';\nimport { NotebookDto } from './mainThreadNotebookDto.js';\nimport { extHostNamedCustomer, IExtHostContext } from '../../services/extensions/common/extHostCustomers.js';\nimport { INotebookEditor } from '../../contrib/notebook/browser/notebookBrowser.js';\nimport { INotebookEditorService } from '../../contrib/notebook/browser/services/notebookEditorService.js';\nimport { INotebookCellExecution, INotebookExecution, INotebookExecutionStateService } from '../../contrib/notebook/common/notebookExecutionStateService.js';\nimport { IKernelSourceActionProvider, INotebookKernel, INotebookKernelChangeEvent, INotebookKernelDetectionTask, INotebookKernelService, VariablesResult } from '../../contrib/notebook/common/notebookKernelService.js';\nimport { SerializableObjectWithBuffers } from '../../services/extensions/common/proxyIdentifier.js';\nimport { ExtHostContext, ExtHostNotebookKernelsShape, ICellExecuteUpdateDto, ICellExecutionCompleteDto, INotebookKernelDto2, MainContext, MainThreadNotebookKernelsShape } from '../common/extHost.protocol.js';\nimport { INotebookService } from '../../contrib/notebook/common/notebookService.js';\nimport { AsyncIterableEmitter, AsyncIterableProducer } from '../../../base/common/async.js';\n\nabstract class MainThreadKernel implements INotebookKernel {\n\tprivate readonly _onDidChange = new Emitter<INotebookKernelChangeEvent>();\n\tprivate readonly preloads: { uri: URI; provides: readonly string[] }[];\n\treadonly onDidChange: Event<INotebookKernelChangeEvent> = this._onDidChange.event;\n\n\treadonly id: string;\n\treadonly viewType: string;\n\treadonly extension: ExtensionIdentifier;\n\n\timplementsInterrupt: boolean;\n\tlabel: string;\n\tdescription?: string;\n\tdetail?: string;\n\tsupportedLanguages: string[];\n\timplementsExecutionOrder: boolean;\n\thasVariableProvider: boolean;\n\tlocalResourceRoot: URI;\n\n\tpublic get preloadUris() {\n\t\treturn this.preloads.map(p => p.uri);\n\t}\n\n\tpublic get preloadProvides() {\n\t\treturn this.preloads.flatMap(p => p.provides);\n\t}\n\n\tconstructor(data: INotebookKernelDto2, private _languageService: ILanguageService) {\n\t\tthis.id = data.id;\n\t\tthis.viewType = data.notebookType;\n\t\tthis.extension = data.extensionId;\n\n\t\tthis.implementsInterrupt = data.supportsInterrupt ?? false;\n\t\tthis.label = data.label;\n\t\tthis.description = data.description;\n\t\tthis.detail = data.detail;\n\t\tthis.supportedLanguages = isNonEmptyArray(data.supportedLanguages) ? data.supportedLanguages : _languageService.getRegisteredLanguageIds();\n\t\tthis.implementsExecutionOrder = data.supportsExecutionOrder ?? false;\n\t\tthis.hasVariableProvider = data.hasVariableProvider ?? false;\n\t\tthis.localResourceRoot = URI.revive(data.extensionLocation);\n\t\tthis.preloads = data.preloads?.map(u => ({ uri: URI.revive(u.uri), provides: u.provides })) ?? [];\n\t}\n\n\n\tupdate(data: Partial<INotebookKernelDto2>) {\n\n\t\tconst event: INotebookKernelChangeEvent = Object.create(null);\n\t\tif (data.label !== undefined) {\n\t\t\tthis.label = data.label;\n\t\t\tevent.label = true;\n\t\t}\n\t\tif (data.description !== undefined) {\n\t\t\tthis.description = data.description;\n\t\t\tevent.description = true;\n\t\t}\n\t\tif (data.detail !== undefined) {\n\t\t\tthis.detail = data.detail;\n\t\t\tevent.detail = true;\n\t\t}\n\t\tif (data.supportedLanguages !== undefined) {\n\t\t\tthis.supportedLanguages = isNonEmptyArray(data.supportedLanguages) ? data.supportedLanguages : this._languageService.getRegisteredLanguageIds();\n\t\t\tevent.supportedLanguages = true;\n\t\t}\n\t\tif (data.supportsExecutionOrder !== undefined) {\n\t\t\tthis.implementsExecutionOrder = data.supportsExecutionOrder;\n\t\t\tevent.hasExecutionOrder = true;\n\t\t}\n\t\tif (data.supportsInterrupt !== undefined) {\n\t\t\tthis.implementsInterrupt = data.supportsInterrupt;\n\t\t\tevent.hasInterruptHandler = true;\n\t\t}\n\t\tif (data.hasVariableProvider !== undefined) {\n\t\t\tthis.hasVariableProvider = data.hasVariableProvider;\n\t\t\tevent.hasVariableProvider = true;\n\t\t}\n\t\tthis._onDidChange.fire(event);\n\t}\n\n\tabstract executeNotebookCellsRequest(uri: URI, cellHandles: number[]): Promise<void>;\n\tabstract cancelNotebookCellExecution(uri: URI, cellHandles: number[]): Promise<void>;\n\tabstract provideVariables(notebookUri: URI, parentId: number | undefined, kind: 'named' | 'indexed', start: number, token: CancellationToken): AsyncIterableProducer<VariablesResult>;\n}\n\nclass MainThreadKernelDetectionTask implements INotebookKernelDetectionTask {\n\tconstructor(readonly notebookType: string) { }\n}\n\n@extHostNamedCustomer(MainContext.MainThreadNotebookKernels)\nexport class MainThreadNotebookKernels implements MainThreadNotebookKernelsShape {\n\n\tprivate readonly _editors = new DisposableMap<INotebookEditor>();\n\tprivate readonly _disposables = new DisposableStore();\n\n\tprivate readonly _kernels = new Map<number, [kernel: MainThreadKernel, registraion: IDisposable]>();\n\tprivate readonly _kernelDetectionTasks = new Map<number, [task: MainThreadKernelDetectionTask, registraion: IDisposable]>();\n\tprivate readonly _kernelSourceActionProviders = new Map<number, [provider: IKernelSourceActionProvider, registraion: IDisposable]>();\n\tprivate readonly _kernelSourceActionProvidersEventRegistrations = new Map<number, IDisposable>();\n\n\tprivate readonly _proxy: ExtHostNotebookKernelsShape;\n\n\tprivate readonly _executions = new Map<number, INotebookCellExecution>();\n\tprivate readonly _notebookExecutions = new Map<number, INotebookExecution>();\n\n\tconstructor(\n\t\textHostContext: IExtHostContext,\n\t\t@ILanguageService private readonly _languageService: ILanguageService,\n\t\t@INotebookKernelService private readonly _notebookKernelService: INotebookKernelService,\n\t\t@INotebookExecutionStateService private readonly _notebookExecutionStateService: INotebookExecutionStateService,\n\t\t@INotebookService private readonly _notebookService: INotebookService,\n\t\t@INotebookEditorService notebookEditorService: INotebookEditorService\n\t) {\n\t\tthis._proxy = extHostContext.getProxy(ExtHostContext.ExtHostNotebookKernels);\n\n\t\tnotebookEditorService.listNotebookEditors().forEach(this._onEditorAdd, this);\n\t\tnotebookEditorService.onDidAddNotebookEditor(this._onEditorAdd, this, this._disposables);\n\t\tnotebookEditorService.onDidRemoveNotebookEditor(this._onEditorRemove, this, this._disposables);\n\n\t\tthis._disposables.add(toDisposable(() => {\n\t\t\t// EH shut down, complete all executions started by this EH\n\t\t\tthis._executions.forEach(e => {\n\t\t\t\te.complete({});\n\t\t\t});\n\t\t\tthis._notebookExecutions.forEach(e => e.complete());\n\t\t}));\n\n\t\tthis._disposables.add(this._notebookKernelService.onDidChangeSelectedNotebooks(e => {\n\t\t\tfor (const [handle, [kernel,]] of this._kernels) {\n\t\t\t\tif (e.oldKernel === kernel.id) {\n\t\t\t\t\tthis._proxy.$acceptNotebookAssociation(handle, e.notebook, false);\n\t\t\t\t} else if (e.newKernel === kernel.id) {\n\t\t\t\t\tthis._proxy.$acceptNotebookAssociation(handle, e.notebook, true);\n\t\t\t\t}\n\t\t\t}\n\t\t}));\n\t}\n\n\tdispose(): void {\n\t\tthis._disposables.dispose();\n\t\tfor (const [, registration] of this._kernels.values()) {\n\t\t\tregistration.dispose();\n\t\t}\n\t\tfor (const [, registration] of this._kernelDetectionTasks.values()) {\n\t\t\tregistration.dispose();\n\t\t}\n\t\tfor (const [, registration] of this._kernelSourceActionProviders.values()) {\n\t\t\tregistration.dispose();\n\t\t}\n\t\tthis._editors.dispose();\n\t}\n\n\t// --- kernel ipc\n\n\tprivate _onEditorAdd(editor: INotebookEditor) {\n\n\t\tconst ipcListener = editor.onDidReceiveMessage(e => {\n\t\t\tif (!editor.hasModel()) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst { selected } = this._notebookKernelService.getMatchingKernel(editor.textModel);\n\t\t\tif (!selected) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tfor (const [handle, candidate] of this._kernels) {\n\t\t\t\tif (candidate[0] === selected) {\n\t\t\t\t\tthis._proxy.$acceptKernelMessageFromRenderer(handle, editor.getId(), e.message);\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\tthis._editors.set(editor, ipcListener);\n\t}\n\n\tprivate _onEditorRemove(editor: INotebookEditor) {\n\t\tthis._editors.deleteAndDispose(editor);\n\t}\n\n\tasync $postMessage(handle: number, editorId: string | undefined, message: unknown): Promise<boolean> {\n\t\tconst tuple = this._kernels.get(handle);\n\t\tif (!tuple) {\n\t\t\tthrow new Error('kernel already disposed');\n\t\t}\n\t\tconst [kernel] = tuple;\n\t\tlet didSend = false;\n\t\tfor (const [editor] of this._editors) {\n\t\t\tif (!editor.hasModel()) {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tif (this._notebookKernelService.getMatchingKernel(editor.textModel).selected !== kernel) {\n\t\t\t\t// different kernel\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tif (editorId === undefined) {\n\t\t\t\t// all editors\n\t\t\t\teditor.postMessage(message);\n\t\t\t\tdidSend = true;\n\t\t\t} else if (editor.getId() === editorId) {\n\t\t\t\t// selected editors\n\t\t\t\teditor.postMessage(message);\n\t\t\t\tdidSend = true;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\treturn didSend;\n\t}\n\n\tprivate variableRequestIndex = 0;\n\tprivate variableRequestMap = new Map<string, AsyncIterableEmitter<VariablesResult>>();\n\t$receiveVariable(requestId: string, variable: VariablesResult) {\n\t\tconst emitter = this.variableRequestMap.get(requestId);\n\t\tif (emitter) {\n\t\t\temitter.emitOne(variable);\n\t\t}\n\t}\n\n\t// --- kernel adding/updating/removal\n\n\tasync $addKernel(handle: number, data: INotebookKernelDto2): Promise<void> {\n\t\tconst that = this;\n\t\tconst kernel = new class extends MainThreadKernel {\n\t\t\tasync executeNotebookCellsRequest(uri: URI, handles: number[]): Promise<void> {\n\t\t\t\tawait that._proxy.$executeCells(handle, uri, handles);\n\t\t\t}\n\t\t\tasync cancelNotebookCellExecution(uri: URI, handles: number[]): Promise<void> {\n\t\t\t\tawait that._proxy.$cancelCells(handle, uri, handles);\n\t\t\t}\n\t\t\tprovideVariables(notebookUri: URI, parentId: number | undefined, kind: 'named' | 'indexed', start: number, token: CancellationToken): AsyncIterableProducer<VariablesResult> {\n\t\t\t\tconst requestId = `${handle}variables${that.variableRequestIndex++}`;\n\n\t\t\t\treturn new AsyncIterableProducer<VariablesResult>(async emitter => {\n\t\t\t\t\tthat.variableRequestMap.set(requestId, emitter);\n\n\t\t\t\t\ttry {\n\t\t\t\t\t\tawait that._proxy.$provideVariables(handle, requestId, notebookUri, parentId, kind, start, token);\n\t\t\t\t\t} finally {\n\t\t\t\t\t\tthat.variableRequestMap.delete(requestId);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}(data, this._languageService);\n\n\t\tconst disposables = this._disposables.add(new DisposableStore());\n\t\t// Ensure _kernels is up to date before we register a kernel.\n\t\tthis._kernels.set(handle, [kernel, disposables]);\n\t\tdisposables.add(this._notebookKernelService.registerKernel(kernel));\n\t}\n\n\t$updateKernel(handle: number, data: Partial<INotebookKernelDto2>): void {\n\t\tconst tuple = this._kernels.get(handle);\n\t\tif (tuple) {\n\t\t\ttuple[0].update(data);\n\t\t}\n\t}\n\n\t$removeKernel(handle: number): void {\n\t\tconst tuple = this._kernels.get(handle);\n\t\tif (tuple) {\n\t\t\ttuple[1].dispose();\n\t\t\tthis._kernels.delete(handle);\n\t\t}\n\t}\n\n\t$updateNotebookPriority(handle: number, notebook: UriComponents, value: number | undefined): void {\n\t\tconst tuple = this._kernels.get(handle);\n\t\tif (tuple) {\n\t\t\tthis._notebookKernelService.updateKernelNotebookAffinity(tuple[0], URI.revive(notebook), value);\n\t\t}\n\t}\n\n\t// --- Cell execution\n\n\t$createExecution(handle: number, controllerId: string, rawUri: UriComponents, cellHandle: number): void {\n\t\tconst uri = URI.revive(rawUri);\n\t\tconst notebook = this._notebookService.getNotebookTextModel(uri);\n\t\tif (!notebook) {\n\t\t\tthrow new Error(`Notebook not found: ${uri.toString()}`);\n\t\t}\n\n\t\tconst kernel = this._notebookKernelService.getMatchingKernel(notebook);\n\t\tif (!kernel.selected || kernel.selected.id !== controllerId) {\n\t\t\tthrow new Error(`Kernel is not selected: ${kernel.selected?.id} !== ${controllerId}`);\n\t\t}\n\t\tconst execution = this._notebookExecutionStateService.createCellExecution(uri, cellHandle);\n\t\texecution.confirm();\n\t\tthis._executions.set(handle, execution);\n\t}\n\n\t$updateExecution(handle: number, data: SerializableObjectWithBuffers<ICellExecuteUpdateDto[]>): void {\n\t\tconst updates = data.value;\n\t\ttry {\n\t\t\tconst execution = this._executions.get(handle);\n\t\t\texecution?.update(updates.map(NotebookDto.fromCellExecuteUpdateDto));\n\t\t} catch (e) {\n\t\t\tonUnexpectedError(e);\n\t\t}\n\t}\n\n\t$completeExecution(handle: number, data: SerializableObjectWithBuffers<ICellExecutionCompleteDto>): void {\n\t\ttry {\n\t\t\tconst execution = this._executions.get(handle);\n\t\t\texecution?.complete(NotebookDto.fromCellExecuteCompleteDto(data.value));\n\t\t} catch (e) {\n\t\t\tonUnexpectedError(e);\n\t\t} finally {\n\t\t\tthis._executions.delete(handle);\n\t\t}\n\t}\n\n\t// --- Notebook execution\n\n\t$createNotebookExecution(handle: number, controllerId: string, rawUri: UriComponents): void {\n\t\tconst uri = URI.revive(rawUri);\n\t\tconst notebook = this._notebookService.getNotebookTextModel(uri);\n\t\tif (!notebook) {\n\t\t\tthrow new Error(`Notebook not found: ${uri.toString()}`);\n\t\t}\n\n\t\tconst kernel = this._notebookKernelService.getMatchingKernel(notebook);\n\t\tif (!kernel.selected || kernel.selected.id !== controllerId) {\n\t\t\tthrow new Error(`Kernel is not selected: ${kernel.selected?.id} !== ${controllerId}`);\n\t\t}\n\t\tconst execution = this._notebookExecutionStateService.createExecution(uri);\n\t\texecution.confirm();\n\t\tthis._notebookExecutions.set(handle, execution);\n\t}\n\n\t$beginNotebookExecution(handle: number): void {\n\t\ttry {\n\t\t\tconst execution = this._notebookExecutions.get(handle);\n\t\t\texecution?.begin();\n\t\t} catch (e) {\n\t\t\tonUnexpectedError(e);\n\t\t}\n\t}\n\n\t$completeNotebookExecution(handle: number): void {\n\t\ttry {\n\t\t\tconst execution = this._notebookExecutions.get(handle);\n\t\t\texecution?.complete();\n\t\t} catch (e) {\n\t\t\tonUnexpectedError(e);\n\t\t} finally {\n\t\t\tthis._notebookExecutions.delete(handle);\n\t\t}\n\t}\n\n\t// --- notebook kernel detection task\n\tasync $addKernelDetectionTask(handle: number, notebookType: string): Promise<void> {\n\t\tconst kernelDetectionTask = new MainThreadKernelDetectionTask(notebookType);\n\t\tconst registration = this._notebookKernelService.registerNotebookKernelDetectionTask(kernelDetectionTask);\n\t\tthis._kernelDetectionTasks.set(handle, [kernelDetectionTask, registration]);\n\t}\n\n\t$removeKernelDetectionTask(handle: number): void {\n\t\tconst tuple = this._kernelDetectionTasks.get(handle);\n\t\tif (tuple) {\n\t\t\ttuple[1].dispose();\n\t\t\tthis._kernelDetectionTasks.delete(handle);\n\t\t}\n\t}\n\n\t// --- notebook kernel source action provider\n\n\tasync $addKernelSourceActionProvider(handle: number, eventHandle: number, notebookType: string): Promise<void> {\n\t\tconst kernelSourceActionProvider: IKernelSourceActionProvider = {\n\t\t\tviewType: notebookType,\n\t\t\tprovideKernelSourceActions: async () => {\n\t\t\t\tconst actions = await this._proxy.$provideKernelSourceActions(handle, CancellationToken.None);\n\n\t\t\t\treturn actions.map(action => {\n\t\t\t\t\tlet documentation = action.documentation;\n\t\t\t\t\tif (action.documentation && typeof action.documentation !== 'string') {\n\t\t\t\t\t\tdocumentation = URI.revive(action.documentation);\n\t\t\t\t\t}\n\n\t\t\t\t\treturn {\n\t\t\t\t\t\tlabel: action.label,\n\t\t\t\t\t\tcommand: action.command,\n\t\t\t\t\t\tdescription: action.description,\n\t\t\t\t\t\tdetail: action.detail,\n\t\t\t\t\t\tdocumentation,\n\t\t\t\t\t};\n\t\t\t\t});\n\t\t\t}\n\t\t};\n\n\t\tif (typeof eventHandle === 'number') {\n\t\t\tconst emitter = new Emitter<void>();\n\t\t\tthis._kernelSourceActionProvidersEventRegistrations.set(eventHandle, emitter);\n\t\t\tkernelSourceActionProvider.onDidChangeSourceActions = emitter.event;\n\t\t}\n\n\t\tconst registration = this._notebookKernelService.registerKernelSourceActionProvider(notebookType, kernelSourceActionProvider);\n\t\tthis._kernelSourceActionProviders.set(handle, [kernelSourceActionProvider, registration]);\n\t}\n\n\t$removeKernelSourceActionProvider(handle: number, eventHandle: number): void {\n\t\tconst tuple = this._kernelSourceActionProviders.get(handle);\n\t\tif (tuple) {\n\t\t\ttuple[1].dispose();\n\t\t\tthis._kernelSourceActionProviders.delete(handle);\n\t\t}\n\t\tif (typeof eventHandle === 'number') {\n\t\t\tthis._kernelSourceActionProvidersEventRegistrations.delete(eventHandle);\n\t\t}\n\t}\n\n\t$emitNotebookKernelSourceActionsChangeEvent(eventHandle: number): void {\n\t\tconst emitter = this._kernelSourceActionProvidersEventRegistrations.get(eventHandle);\n\t\tif (emitter instanceof Emitter) {\n\t\t\temitter.fire(undefined);\n\t\t}\n\t}\n\n\t$variablesUpdated(notebookUri: UriComponents): void {\n\t\tthis._notebookKernelService.notifyVariablesChange(URI.revive(notebookUri));\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { isNonEmptyArray } from '../../../base/common/arrays.js';\nimport { CancellationToken } from '../../../base/common/cancellation.js';\nimport { onUnexpectedError } from '../../../base/common/errors.js';\nimport { Emitter, Event } from '../../../base/common/event.js';\nimport { DisposableMap, DisposableStore, IDisposable, toDisposable } from '../../../base/common/lifecycle.js';\nimport { URI, UriComponents } from '../../../base/common/uri.js';\nimport { ILanguageService } from '../../../editor/common/languages/language.js';\nimport { ExtensionIdentifier } from '../../../platform/extensions/common/extensions.js';\nimport { NotebookDto } from './mainThreadNotebookDto.js';\nimport { extHostNamedCustomer, IExtHostContext } from '../../services/extensions/common/extHostCustomers.js';\nimport { INotebookEditor } from '../../contrib/notebook/browser/notebookBrowser.js';\nimport { INotebookEditorService } from '../../contrib/notebook/browser/services/notebookEditorService.js';\nimport { INotebookCellExecution, INotebookExecution, INotebookExecutionStateService } from '../../contrib/notebook/common/notebookExecutionStateService.js';\nimport { IKernelSourceActionProvider, INotebookKernel, INotebookKernelChangeEvent, INotebookKernelDetectionTask, INotebookKernelService, VariablesResult } from '../../contrib/notebook/common/notebookKernelService.js';\nimport { SerializableObjectWithBuffers } from '../../services/extensions/common/proxyIdentifier.js';\nimport { ExtHostContext, ExtHostNotebookKernelsShape, ICellExecuteUpdateDto, ICellExecutionCompleteDto, INotebookKernelDto2, MainContext, MainThreadNotebookKernelsShape } from '../common/extHost.protocol.js';\nimport { INotebookService } from '../../contrib/notebook/common/notebookService.js';\nimport { AsyncIterableEmitter, AsyncIterableProducer } from '../../../base/common/async.js';\n\nabstract class MainThreadKernel implements INotebookKernel {\n\tprivate readonly _onDidChange = new Emitter<INotebookKernelChangeEvent>();\n\tprivate readonly preloads: { uri: URI; provides: readonly string[] }[];\n\treadonly onDidChange: Event<INotebookKernelChangeEvent> = this._onDidChange.event;\n\n\treadonly id: string;\n\treadonly viewType: string;\n\treadonly extension: ExtensionIdentifier;\n\n\timplementsInterrupt: boolean;\n\tlabel: string;\n\tdescription?: string;\n\tdetail?: string;\n\tsupportedLanguages: string[];\n\timplementsExecutionOrder: boolean;\n\thasVariableProvider: boolean;\n\tlocalResourceRoot: URI;\n\n\tpublic get preloadUris() {\n\t\treturn this.preloads.map(p => p.uri);\n\t}\n\n\tpublic get preloadProvides() {\n\t\treturn this.preloads.flatMap(p => p.provides);\n\t}\n\n\tconstructor(data: INotebookKernelDto2, private _languageService: ILanguageService) {\n\t\tthis.id = data.id;\n\t\tthis.viewType = data.notebookType;\n\t\tthis.extension = data.extensionId;\n\n\t\tthis.implementsInterrupt = data.supportsInterrupt ?? false;\n\t\tthis.label = data.label;\n\t\tthis.description = data.description;\n\t\tthis.detail = data.detail;\n\t\tthis.supportedLanguages = isNonEmptyArray(data.supportedLanguages) ? data.supportedLanguages : _languageService.getRegisteredLanguageIds();\n\t\tthis.implementsExecutionOrder = data.supportsExecutionOrder ?? false;\n\t\tthis.hasVariableProvider = data.hasVariableProvider ?? false;\n\t\tthis.localResourceRoot = URI.revive(data.extensionLocation);\n\t\tthis.preloads = data.preloads?.map(u => ({ uri: URI.revive(u.uri), provides: u.provides })) ?? [];\n\t}\n\n\n\tupdate(data: Partial<INotebookKernelDto2>) {\n\n\t\tconst event: INotebookKernelChangeEvent = Object.create(null);\n\t\tif (data.label !== undefined) {\n\t\t\tthis.label = data.label;\n\t\t\tevent.label = true;\n\t\t}\n\t\tif (data.description !== undefined) {\n\t\t\tthis.description = data.description;\n\t\t\tevent.description = true;\n\t\t}\n\t\tif (data.detail !== undefined) {\n\t\t\tthis.detail = data.detail;\n\t\t\tevent.detail = true;\n\t\t}\n\t\tif (data.supportedLanguages !== undefined) {\n\t\t\tthis.supportedLanguages = isNonEmptyArray(data.supportedLanguages) ? data.supportedLanguages : this._languageService.getRegisteredLanguageIds();\n\t\t\tevent.supportedLanguages = true;\n\t\t}\n\t\tif (data.supportsExecutionOrder !== undefined) {\n\t\t\tthis.implementsExecutionOrder = data.supportsExecutionOrder;\n\t\t\tevent.hasExecutionOrder = true;\n\t\t}\n\t\tif (data.supportsInterrupt !== undefined) {\n\t\t\tthis.implementsInterrupt = data.supportsInterrupt;\n\t\t\tevent.hasInterruptHandler = true;\n\t\t}\n\t\tif (data.hasVariableProvider !== undefined) {\n\t\t\tthis.hasVariableProvider = data.hasVariableProvider;\n\t\t\tevent.hasVariableProvider = true;\n\t\t}\n\t\tthis._onDidChange.fire(event);\n\t}\n\n\tabstract executeNotebookCellsRequest(uri: URI, cellHandles: number[]): Promise<void>;\n\tabstract cancelNotebookCellExecution(uri: URI, cellHandles: number[]): Promise<void>;\n\tabstract provideVariables(notebookUri: URI, parentId: number | undefined, kind: 'named' | 'indexed', start: number, token: CancellationToken): AsyncIterableProducer<VariablesResult>;\n}\n\nclass MainThreadKernelDetectionTask implements INotebookKernelDetectionTask {\n\tconstructor(readonly notebookType: string) { }\n}\n\n@extHostNamedCustomer(MainContext.MainThreadNotebookKernels)\nexport class MainThreadNotebookKernels implements MainThreadNotebookKernelsShape {\n\n\tprivate readonly _editors = new DisposableMap<INotebookEditor>();\n\tprivate readonly _disposables = new DisposableStore();\n\n\tprivate readonly _kernels = new Map<number, [kernel: MainThreadKernel, registraion: IDisposable]>();\n\tprivate readonly _kernelDetectionTasks = new Map<number, [task: MainThreadKernelDetectionTask, registraion: IDisposable]>();\n\tprivate readonly _kernelSourceActionProviders = new Map<number, [provider: IKernelSourceActionProvider, registraion: IDisposable]>();\n\tprivate readonly _kernelSourceActionProvidersEventRegistrations = new Map<number, IDisposable>();\n\n\tprivate readonly _proxy: ExtHostNotebookKernelsShape;\n\n\tprivate readonly _executions = new Map<number, INotebookCellExecution>();\n\tprivate readonly _notebookExecutions = new Map<number, INotebookExecution>();\n\n\tconstructor(\n\t\textHostContext: IExtHostContext,\n\t\t@ILanguageService private readonly _languageService: ILanguageService,\n\t\t@INotebookKernelService private readonly _notebookKernelService: INotebookKernelService,\n\t\t@INotebookExecutionStateService private readonly _notebookExecutionStateService: INotebookExecutionStateService,\n\t\t@INotebookService private readonly _notebookService: INotebookService,\n\t\t@INotebookEditorService notebookEditorService: INotebookEditorService\n\t) {\n\t\tthis._proxy = extHostContext.getProxy(ExtHostContext.ExtHostNotebookKernels);\n\n\t\tnotebookEditorService.listNotebookEditors().forEach(this._onEditorAdd, this);\n\t\tnotebookEditorService.onDidAddNotebookEditor(this._onEditorAdd, this, this._disposables);\n\t\tnotebookEditorService.onDidRemoveNotebookEditor(this._onEditorRemove, this, this._disposables);\n\n\t\tthis._disposables.add(toDisposable(() => {\n\t\t\t// EH shut down, complete all executions started by this EH\n\t\t\tthis._executions.forEach(e => {\n\t\t\t\te.complete({});\n\t\t\t});\n\t\t\tthis._notebookExecutions.forEach(e => e.complete());\n\t\t}));\n\n\t\tthis._disposables.add(this._notebookKernelService.onDidChangeSelectedNotebooks(e => {\n\t\t\tfor (const [handle, [kernel,]] of this._kernels) {\n\t\t\t\tif (e.oldKernel === kernel.id) {\n\t\t\t\t\tthis._proxy.$acceptNotebookAssociation(handle, e.notebook, false);\n\t\t\t\t} else if (e.newKernel === kernel.id) {\n\t\t\t\t\tthis._proxy.$acceptNotebookAssociation(handle, e.notebook, true);\n\t\t\t\t}\n\t\t\t}\n\t\t}));\n\t}\n\n\tdispose(): void {\n\t\tthis._disposables.dispose();\n\t\tfor (const [, registration] of this._kernels.values()) {\n\t\t\tregistration.dispose();\n\t\t}\n\t\tfor (const [, registration] of this._kernelDetectionTasks.values()) {\n\t\t\tregistration.dispose();\n\t\t}\n\t\tfor (const [, registration] of this._kernelSourceActionProviders.values()) {\n\t\t\tregistration.dispose();\n\t\t}\n\t\tthis._editors.dispose();\n\t}\n\n\t// --- kernel ipc\n\n\tprivate _onEditorAdd(editor: INotebookEditor) {\n\n\t\tconst ipcListener = editor.onDidReceiveMessage(e => {\n\t\t\tif (!editor.hasModel()) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst { selected } = this._notebookKernelService.getMatchingKernel(editor.textModel);\n\t\t\tif (!selected) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tfor (const [handle, candidate] of this._kernels) {\n\t\t\t\tif (candidate[0] === selected) {\n\t\t\t\t\tthis._proxy.$acceptKernelMessageFromRenderer(handle, editor.getId(), e.message);\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\tthis._editors.set(editor, ipcListener);\n\t}\n\n\tprivate _onEditorRemove(editor: INotebookEditor) {\n\t\tthis._editors.deleteAndDispose(editor);\n\t}\n\n\tasync $postMessage(handle: number, editorId: string | undefined, message: unknown): Promise<boolean> {\n\t\tconst tuple = this._kernels.get(handle);\n\t\tif (!tuple) {\n\t\t\tthrow new Error('kernel already disposed');\n\t\t}\n\t\tconst [kernel] = tuple;\n\t\tlet didSend = false;\n\t\tfor (const [editor] of this._editors) {\n\t\t\tif (!editor.hasModel()) {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tif (this._notebookKernelService.getMatchingKernel(editor.textModel).selected !== kernel) {\n\t\t\t\t// different kernel\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tif (editorId === undefined) {\n\t\t\t\t// all editors\n\t\t\t\teditor.postMessage(message);\n\t\t\t\tdidSend = true;\n\t\t\t} else if (editor.getId() === editorId) {\n\t\t\t\t// selected editors\n\t\t\t\teditor.postMessage(message);\n\t\t\t\tdidSend = true;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\treturn didSend;\n\t}\n\n\tprivate variableRequestIndex = 0;\n\tprivate variableRequestMap = new Map<string, AsyncIterableEmitter<VariablesResult>>();\n\t$receiveVariable(requestId: string, variable: VariablesResult) {\n\t\tconst emitter = this.variableRequestMap.get(requestId);\n\t\tif (emitter) {\n\t\t\temitter.emitOne(variable);\n\t\t}\n\t}\n\n\t// --- kernel adding/updating/removal\n\n\tasync $addKernel(handle: number, data: INotebookKernelDto2): Promise<void> {\n\t\tconst that = this;\n\t\tconst kernel = new class extends MainThreadKernel {\n\t\t\tasync executeNotebookCellsRequest(uri: URI, handles: number[]): Promise<void> {\n\t\t\t\tawait that._proxy.$executeCells(handle, uri, handles);\n\t\t\t}\n\t\t\tasync cancelNotebookCellExecution(uri: URI, handles: number[]): Promise<void> {\n\t\t\t\tawait that._proxy.$cancelCells(handle, uri, handles);\n\t\t\t}\n\t\t\tprovideVariables(notebookUri: URI, parentId: number | undefined, kind: 'named' | 'indexed', start: number, token: CancellationToken): AsyncIterableProducer<VariablesResult> {\n\t\t\t\tconst requestId = `${handle}variables${that.variableRequestIndex++}`;\n\n\t\t\t\treturn new AsyncIterableProducer<VariablesResult>(async emitter => {\n\t\t\t\t\tthat.variableRequestMap.set(requestId, emitter);\n\n\t\t\t\t\ttry {\n\t\t\t\t\t\tawait that._proxy.$provideVariables(handle, requestId, notebookUri, parentId, kind, start, token);\n\t\t\t\t\t} finally {\n\t\t\t\t\t\tthat.variableRequestMap.delete(requestId);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}(data, this._languageService);\n\n\t\tconst disposables = this._disposables.add(new DisposableStore());\n\t\t// Ensure _kernels is up to date before we register a kernel.\n\t\tthis._kernels.set(handle, [kernel, disposables]);\n\t\tdisposables.add(this._notebookKernelService.registerKernel(kernel));\n\t}\n\n\t$updateKernel(handle: number, data: Partial<INotebookKernelDto2>): void {\n\t\tconst tuple = this._kernels.get(handle);\n\t\tif (tuple) {\n\t\t\ttuple[0].update(data);\n\t\t}\n\t}\n\n\t$removeKernel(handle: number): void {\n\t\tconst tuple = this._kernels.get(handle);\n\t\tif (tuple) {\n\t\t\ttuple[1].dispose();\n\t\t\tthis._kernels.delete(handle);\n\t\t}\n\t}\n\n\t$updateNotebookPriority(handle: number, notebook: UriComponents, value: number | undefined): void {\n\t\tconst tuple = this._kernels.get(handle);\n\t\tif (tuple) {\n\t\t\tthis._notebookKernelService.updateKernelNotebookAffinity(tuple[0], URI.revive(notebook), value);\n\t\t}\n\t}\n\n\t// --- Cell execution\n\n\t$createExecution(handle: number, controllerId: string, rawUri: UriComponents, cellHandle: number): void {\n\t\tconst uri = URI.revive(rawUri);\n\t\tconst notebook = this._notebookService.getNotebookTextModel(uri);\n\t\tif (!notebook) {\n\t\t\tthrow new Error(`Notebook not found: ${uri.toString()}`);\n\t\t}\n\n\t\tconst kernel = this._notebookKernelService.getMatchingKernel(notebook);\n\t\tif (!kernel.selected || kernel.selected.id !== controllerId) {\n\t\t\tthrow new Error(`Kernel is not selected: ${kernel.selected?.id} !== ${controllerId}`);\n\t\t}\n\t\tconst execution = this._notebookExecutionStateService.createCellExecution(uri, cellHandle);\n\t\texecution.confirm();\n\t\tthis._executions.set(handle, execution);\n\t}\n\n\t$updateExecution(handle: number, data: SerializableObjectWithBuffers<ICellExecuteUpdateDto[]>): void {\n\t\tconst updates = data.value;\n\t\ttry {\n\t\t\tconst execution = this._executions.get(handle);\n\t\t\texecution?.update(updates.map(NotebookDto.fromCellExecuteUpdateDto));\n\t\t} catch (e) {\n\t\t\tonUnexpectedError(e);\n\t\t}\n\t}\n\n\t$completeExecution(handle: number, data: SerializableObjectWithBuffers<ICellExecutionCompleteDto>): void {\n\t\ttry {\n\t\t\tconst execution = this._executions.get(handle);\n\t\t\texecution?.complete(NotebookDto.fromCellExecuteCompleteDto(data.value));\n\t\t} catch (e) {\n\t\t\tonUnexpectedError(e);\n\t\t} finally {\n\t\t\tthis._executions.delete(handle);\n\t\t}\n\t}\n\n\t// --- Notebook execution\n\n\t$createNotebookExecution(handle: number, controllerId: string, rawUri: UriComponents): void {\n\t\tconst uri = URI.revive(rawUri);\n\t\tconst notebook = this._notebookService.getNotebookTextModel(uri);\n\t\tif (!notebook) {\n\t\t\tthrow new Error(`Notebook not found: ${uri.toString()}`);\n\t\t}\n\n\t\tconst kernel = this._notebookKernelService.getMatchingKernel(notebook);\n\t\tif (!kernel.selected || kernel.selected.id !== controllerId) {\n\t\t\tthrow new Error(`Kernel is not selected: ${kernel.selected?.id} !== ${controllerId}`);\n\t\t}\n\t\tconst execution = this._notebookExecutionStateService.createExecution(uri);\n\t\texecution.confirm();\n\t\tthis._notebookExecutions.set(handle, execution);\n\t}\n\n\t$beginNotebookExecution(handle: number): void {\n\t\ttry {\n\t\t\tconst execution = this._notebookExecutions.get(handle);\n\t\t\texecution?.begin();\n\t\t} catch (e) {\n\t\t\tonUnexpectedError(e);\n\t\t}\n\t}\n\n\t$completeNotebookExecution(handle: number): void {\n\t\ttry {\n\t\t\tconst execution = this._notebookExecutions.get(handle);\n\t\t\texecution?.complete();\n\t\t} catch (e) {\n\t\t\tonUnexpectedError(e);\n\t\t} finally {\n\t\t\tthis._notebookExecutions.delete(handle);\n\t\t}\n\t}\n\n\t// --- notebook kernel detection task\n\tasync $addKernelDetectionTask(handle: number, notebookType: string): Promise<void> {\n\t\tconst kernelDetectionTask = new MainThreadKernelDetectionTask(notebookType);\n\t\tconst registration = this._notebookKernelService.registerNotebookKernelDetectionTask(kernelDetectionTask);\n\t\tthis._kernelDetectionTasks.set(handle, [kernelDetectionTask, registration]);\n\t}\n\n\t$removeKernelDetectionTask(handle: number): void {\n\t\tconst tuple = this._kernelDetectionTasks.get(handle);\n\t\tif (tuple) {\n\t\t\ttuple[1].dispose();\n\t\t\tthis._kernelDetectionTasks.delete(handle);\n\t\t}\n\t}\n\n\t// --- notebook kernel source action provider\n\n\tasync $addKernelSourceActionProvider(handle: number, eventHandle: number, notebookType: string): Promise<void> {\n\t\tconst kernelSourceActionProvider: IKernelSourceActionProvider = {\n\t\t\tviewType: notebookType,\n\t\t\tprovideKernelSourceActions: async () => {\n\t\t\t\tconst actions = await this._proxy.$provideKernelSourceActions(handle, CancellationToken.None);\n\n\t\t\t\treturn actions.map(action => {\n\t\t\t\t\tlet documentation = action.documentation;\n\t\t\t\t\tif (action.documentation && typeof action.documentation !== 'string') {\n\t\t\t\t\t\tdocumentation = URI.revive(action.documentation);\n\t\t\t\t\t}\n\n\t\t\t\t\treturn {\n\t\t\t\t\t\tlabel: action.label,\n\t\t\t\t\t\tcommand: action.command,\n\t\t\t\t\t\tdescription: action.description,\n\t\t\t\t\t\tdetail: action.detail,\n\t\t\t\t\t\tdocumentation,\n\t\t\t\t\t};\n\t\t\t\t});\n\t\t\t}\n\t\t};\n\n\t\tif (typeof eventHandle === 'number') {\n\t\t\tconst emitter = new Emitter<void>();\n\t\t\tthis._kernelSourceActionProvidersEventRegistrations.set(eventHandle, emitter);\n\t\t\tkernelSourceActionProvider.onDidChangeSourceActions = emitter.event;\n\t\t}\n\n\t\tconst registration = this._notebookKernelService.registerKernelSourceActionProvider(notebookType, kernelSourceActionProvider);\n\t\tthis._kernelSourceActionProviders.set(handle, [kernelSourceActionProvider, registration]);\n\t}\n\n\t$removeKernelSourceActionProvider(handle: number, eventHandle: number): void {\n\t\tconst tuple = this._kernelSourceActionProviders.get(handle);\n\t\tif (tuple) {\n\t\t\ttuple[1].dispose();\n\t\t\tthis._kernelSourceActionProviders.delete(handle);\n\t\t}\n\t\tif (typeof eventHandle === 'number') {\n\t\t\tthis._kernelSourceActionProvidersEventRegistrations.delete(eventHandle);\n\t\t}\n\t}\n\n\t$emitNotebookKernelSourceActionsChangeEvent(eventHandle: number): void {\n\t\tconst emitter = this._kernelSourceActionProvidersEventRegistrations.get(eventHandle);\n\t\tif (emitter instanceof Emitter) {\n\t\t\temitter.fire(undefined);\n\t\t}\n\t}\n\n\t$variablesUpdated(notebookUri: UriComponents): void {\n\t\tthis._notebookKernelService.notifyVariablesChange(URI.revive(notebookUri));\n\t}\n}\n"]}