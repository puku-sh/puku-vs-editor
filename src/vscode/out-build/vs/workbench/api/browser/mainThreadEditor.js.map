{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/api/browser/mainThreadEditor.ts","vs/workbench/api/browser/mainThreadEditor.ts"],"names":[],"mappings":"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","file":"mainThreadEditor.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Emitter, Event } from '../../../base/common/event.js';\nimport { DisposableStore } from '../../../base/common/lifecycle.js';\nimport { ICodeEditor } from '../../../editor/browser/editorBrowser.js';\nimport { RenderLineNumbersType, TextEditorCursorStyle, cursorStyleToString, EditorOption } from '../../../editor/common/config/editorOptions.js';\nimport { IRange, Range } from '../../../editor/common/core/range.js';\nimport { ISelection, Selection } from '../../../editor/common/core/selection.js';\nimport { IDecorationOptions, ScrollType } from '../../../editor/common/editorCommon.js';\nimport { ITextModel, ITextModelUpdateOptions } from '../../../editor/common/model.js';\nimport { ISingleEditOperation } from '../../../editor/common/core/editOperation.js';\nimport { IModelService } from '../../../editor/common/services/model.js';\nimport { SnippetController2 } from '../../../editor/contrib/snippet/browser/snippetController2.js';\nimport { IApplyEditsOptions, IEditorPropertiesChangeData, IResolvedTextEditorConfiguration, ISnippetOptions, ITextEditorConfigurationUpdate, TextEditorRevealType } from '../common/extHost.protocol.js';\nimport { IEditorPane } from '../../common/editor.js';\nimport { equals } from '../../../base/common/arrays.js';\nimport { CodeEditorStateFlag, EditorState } from '../../../editor/contrib/editorState/browser/editorState.js';\nimport { IClipboardService } from '../../../platform/clipboard/common/clipboardService.js';\nimport { SnippetParser } from '../../../editor/contrib/snippet/browser/snippetParser.js';\nimport { MainThreadDocuments } from './mainThreadDocuments.js';\nimport { ISnippetEdit } from '../../../editor/contrib/snippet/browser/snippetSession.js';\n\nexport interface IFocusTracker {\n\tonGainedFocus(): void;\n\tonLostFocus(): void;\n}\n\nexport class MainThreadTextEditorProperties {\n\n\tpublic static readFromEditor(previousProperties: MainThreadTextEditorProperties | null, model: ITextModel, codeEditor: ICodeEditor | null): MainThreadTextEditorProperties {\n\t\tconst selections = MainThreadTextEditorProperties._readSelectionsFromCodeEditor(previousProperties, codeEditor);\n\t\tconst options = MainThreadTextEditorProperties._readOptionsFromCodeEditor(previousProperties, model, codeEditor);\n\t\tconst visibleRanges = MainThreadTextEditorProperties._readVisibleRangesFromCodeEditor(previousProperties, codeEditor);\n\t\treturn new MainThreadTextEditorProperties(selections, options, visibleRanges);\n\t}\n\n\tprivate static _readSelectionsFromCodeEditor(previousProperties: MainThreadTextEditorProperties | null, codeEditor: ICodeEditor | null): Selection[] {\n\t\tlet result: Selection[] | null = null;\n\t\tif (codeEditor) {\n\t\t\tresult = codeEditor.getSelections();\n\t\t}\n\t\tif (!result && previousProperties) {\n\t\t\tresult = previousProperties.selections;\n\t\t}\n\t\tif (!result) {\n\t\t\tresult = [new Selection(1, 1, 1, 1)];\n\t\t}\n\t\treturn result;\n\t}\n\n\tprivate static _readOptionsFromCodeEditor(previousProperties: MainThreadTextEditorProperties | null, model: ITextModel, codeEditor: ICodeEditor | null): IResolvedTextEditorConfiguration {\n\t\tif (model.isDisposed()) {\n\t\t\tif (previousProperties) {\n\t\t\t\t// shutdown time\n\t\t\t\treturn previousProperties.options;\n\t\t\t} else {\n\t\t\t\tthrow new Error('No valid properties');\n\t\t\t}\n\t\t}\n\n\t\tlet cursorStyle: TextEditorCursorStyle;\n\t\tlet lineNumbers: RenderLineNumbersType;\n\t\tif (codeEditor) {\n\t\t\tconst options = codeEditor.getOptions();\n\t\t\tconst lineNumbersOpts = options.get(EditorOption.lineNumbers);\n\t\t\tcursorStyle = options.get(EditorOption.cursorStyle);\n\t\t\tlineNumbers = lineNumbersOpts.renderType;\n\t\t} else if (previousProperties) {\n\t\t\tcursorStyle = previousProperties.options.cursorStyle;\n\t\t\tlineNumbers = previousProperties.options.lineNumbers;\n\t\t} else {\n\t\t\tcursorStyle = TextEditorCursorStyle.Line;\n\t\t\tlineNumbers = RenderLineNumbersType.On;\n\t\t}\n\n\t\tconst modelOptions = model.getOptions();\n\t\treturn {\n\t\t\tinsertSpaces: modelOptions.insertSpaces,\n\t\t\ttabSize: modelOptions.tabSize,\n\t\t\tindentSize: modelOptions.indentSize,\n\t\t\toriginalIndentSize: modelOptions.originalIndentSize,\n\t\t\tcursorStyle: cursorStyle,\n\t\t\tlineNumbers: lineNumbers\n\t\t};\n\t}\n\n\tprivate static _readVisibleRangesFromCodeEditor(previousProperties: MainThreadTextEditorProperties | null, codeEditor: ICodeEditor | null): Range[] {\n\t\tif (codeEditor) {\n\t\t\treturn codeEditor.getVisibleRanges();\n\t\t}\n\t\treturn [];\n\t}\n\n\tconstructor(\n\t\tpublic readonly selections: Selection[],\n\t\tpublic readonly options: IResolvedTextEditorConfiguration,\n\t\tpublic readonly visibleRanges: Range[]\n\t) {\n\t}\n\n\tpublic generateDelta(oldProps: MainThreadTextEditorProperties | null, selectionChangeSource: string | null): IEditorPropertiesChangeData | null {\n\t\tconst delta: IEditorPropertiesChangeData = {\n\t\t\toptions: null,\n\t\t\tselections: null,\n\t\t\tvisibleRanges: null\n\t\t};\n\n\t\tif (!oldProps || !MainThreadTextEditorProperties._selectionsEqual(oldProps.selections, this.selections)) {\n\t\t\tdelta.selections = {\n\t\t\t\tselections: this.selections,\n\t\t\t\tsource: selectionChangeSource ?? undefined,\n\t\t\t};\n\t\t}\n\n\t\tif (!oldProps || !MainThreadTextEditorProperties._optionsEqual(oldProps.options, this.options)) {\n\t\t\tdelta.options = this.options;\n\t\t}\n\n\t\tif (!oldProps || !MainThreadTextEditorProperties._rangesEqual(oldProps.visibleRanges, this.visibleRanges)) {\n\t\t\tdelta.visibleRanges = this.visibleRanges;\n\t\t}\n\n\t\tif (delta.selections || delta.options || delta.visibleRanges) {\n\t\t\t// something changed\n\t\t\treturn delta;\n\t\t}\n\t\t// nothing changed\n\t\treturn null;\n\t}\n\n\tprivate static _selectionsEqual(a: readonly Selection[], b: readonly Selection[]): boolean {\n\t\treturn equals(a, b, (aValue, bValue) => aValue.equalsSelection(bValue));\n\t}\n\n\tprivate static _rangesEqual(a: readonly Range[], b: readonly Range[]): boolean {\n\t\treturn equals(a, b, (aValue, bValue) => aValue.equalsRange(bValue));\n\t}\n\n\tprivate static _optionsEqual(a: IResolvedTextEditorConfiguration, b: IResolvedTextEditorConfiguration): boolean {\n\t\tif (a && !b || !a && b) {\n\t\t\treturn false;\n\t\t}\n\t\tif (!a && !b) {\n\t\t\treturn true;\n\t\t}\n\t\treturn (\n\t\t\ta.tabSize === b.tabSize\n\t\t\t&& a.indentSize === b.indentSize\n\t\t\t&& a.insertSpaces === b.insertSpaces\n\t\t\t&& a.cursorStyle === b.cursorStyle\n\t\t\t&& a.lineNumbers === b.lineNumbers\n\t\t);\n\t}\n}\n\n/**\n * Text Editor that is permanently bound to the same model.\n * It can be bound or not to a CodeEditor.\n */\nexport class MainThreadTextEditor {\n\n\tprivate readonly _id: string;\n\tprivate readonly _model: ITextModel;\n\tprivate readonly _mainThreadDocuments: MainThreadDocuments;\n\tprivate readonly _modelService: IModelService;\n\tprivate readonly _clipboardService: IClipboardService;\n\tprivate readonly _modelListeners = new DisposableStore();\n\tprivate _codeEditor: ICodeEditor | null;\n\tprivate readonly _focusTracker: IFocusTracker;\n\tprivate readonly _codeEditorListeners = new DisposableStore();\n\n\tprivate _properties: MainThreadTextEditorProperties | null;\n\tprivate readonly _onPropertiesChanged: Emitter<IEditorPropertiesChangeData>;\n\n\tconstructor(\n\t\tid: string,\n\t\tmodel: ITextModel,\n\t\tcodeEditor: ICodeEditor,\n\t\tfocusTracker: IFocusTracker,\n\t\tmainThreadDocuments: MainThreadDocuments,\n\t\tmodelService: IModelService,\n\t\tclipboardService: IClipboardService,\n\t) {\n\t\tthis._id = id;\n\t\tthis._model = model;\n\t\tthis._codeEditor = null;\n\t\tthis._properties = null;\n\t\tthis._focusTracker = focusTracker;\n\t\tthis._mainThreadDocuments = mainThreadDocuments;\n\t\tthis._modelService = modelService;\n\t\tthis._clipboardService = clipboardService;\n\n\t\tthis._onPropertiesChanged = new Emitter<IEditorPropertiesChangeData>();\n\n\t\tthis._modelListeners.add(this._model.onDidChangeOptions((e) => {\n\t\t\tthis._updatePropertiesNow(null);\n\t\t}));\n\n\t\tthis.setCodeEditor(codeEditor);\n\t\tthis._updatePropertiesNow(null);\n\t}\n\n\tpublic dispose(): void {\n\t\tthis._modelListeners.dispose();\n\t\tthis._codeEditor = null;\n\t\tthis._codeEditorListeners.dispose();\n\t}\n\n\tprivate _updatePropertiesNow(selectionChangeSource: string | null): void {\n\t\tthis._setProperties(\n\t\t\tMainThreadTextEditorProperties.readFromEditor(this._properties, this._model, this._codeEditor),\n\t\t\tselectionChangeSource\n\t\t);\n\t}\n\n\tprivate _setProperties(newProperties: MainThreadTextEditorProperties, selectionChangeSource: string | null): void {\n\t\tconst delta = newProperties.generateDelta(this._properties, selectionChangeSource);\n\t\tthis._properties = newProperties;\n\t\tif (delta) {\n\t\t\tthis._onPropertiesChanged.fire(delta);\n\t\t}\n\t}\n\n\tpublic getId(): string {\n\t\treturn this._id;\n\t}\n\n\tpublic getModel(): ITextModel {\n\t\treturn this._model;\n\t}\n\n\tpublic getCodeEditor(): ICodeEditor | null {\n\t\treturn this._codeEditor;\n\t}\n\n\tpublic hasCodeEditor(codeEditor: ICodeEditor | null): boolean {\n\t\treturn (this._codeEditor === codeEditor);\n\t}\n\n\tpublic setCodeEditor(codeEditor: ICodeEditor | null): void {\n\t\tif (this.hasCodeEditor(codeEditor)) {\n\t\t\t// Nothing to do...\n\t\t\treturn;\n\t\t}\n\t\tthis._codeEditorListeners.clear();\n\n\t\tthis._codeEditor = codeEditor;\n\t\tif (this._codeEditor) {\n\n\t\t\t// Catch early the case that this code editor gets a different model set and disassociate from this model\n\t\t\tthis._codeEditorListeners.add(this._codeEditor.onDidChangeModel(() => {\n\t\t\t\tthis.setCodeEditor(null);\n\t\t\t}));\n\n\t\t\tthis._codeEditorListeners.add(this._codeEditor.onDidFocusEditorWidget(() => {\n\t\t\t\tthis._focusTracker.onGainedFocus();\n\t\t\t}));\n\t\t\tthis._codeEditorListeners.add(this._codeEditor.onDidBlurEditorWidget(() => {\n\t\t\t\tthis._focusTracker.onLostFocus();\n\t\t\t}));\n\n\t\t\tlet nextSelectionChangeSource: string | null = null;\n\t\t\tthis._codeEditorListeners.add(this._mainThreadDocuments.onIsCaughtUpWithContentChanges((uri) => {\n\t\t\t\tif (uri.toString() === this._model.uri.toString()) {\n\t\t\t\t\tconst selectionChangeSource = nextSelectionChangeSource;\n\t\t\t\t\tnextSelectionChangeSource = null;\n\t\t\t\t\tthis._updatePropertiesNow(selectionChangeSource);\n\t\t\t\t}\n\t\t\t}));\n\n\t\t\tconst isValidCodeEditor = () => {\n\t\t\t\t// Due to event timings, it is possible that there is a model change event not yet delivered to us.\n\t\t\t\t// > e.g. a model change event is emitted to a listener which then decides to update editor options\n\t\t\t\t// > In this case the editor configuration change event reaches us first.\n\t\t\t\t// So simply check that the model is still attached to this code editor\n\t\t\t\treturn (this._codeEditor && this._codeEditor.getModel() === this._model);\n\t\t\t};\n\n\t\t\tconst updateProperties = (selectionChangeSource: string | null) => {\n\t\t\t\t// Some editor events get delivered faster than model content changes. This is\n\t\t\t\t// problematic, as this leads to editor properties reaching the extension host\n\t\t\t\t// too soon, before the model content change that was the root cause.\n\t\t\t\t//\n\t\t\t\t// If this case is identified, then let's update editor properties on the next model\n\t\t\t\t// content change instead.\n\t\t\t\tif (this._mainThreadDocuments.isCaughtUpWithContentChanges(this._model.uri)) {\n\t\t\t\t\tnextSelectionChangeSource = null;\n\t\t\t\t\tthis._updatePropertiesNow(selectionChangeSource);\n\t\t\t\t} else {\n\t\t\t\t\t// update editor properties on the next model content change\n\t\t\t\t\tnextSelectionChangeSource = selectionChangeSource;\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tthis._codeEditorListeners.add(this._codeEditor.onDidChangeCursorSelection((e) => {\n\t\t\t\t// selection\n\t\t\t\tif (!isValidCodeEditor()) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tupdateProperties(e.source);\n\t\t\t}));\n\t\t\tthis._codeEditorListeners.add(this._codeEditor.onDidChangeConfiguration((e) => {\n\t\t\t\t// options\n\t\t\t\tif (!isValidCodeEditor()) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tupdateProperties(null);\n\t\t\t}));\n\t\t\tthis._codeEditorListeners.add(this._codeEditor.onDidLayoutChange(() => {\n\t\t\t\t// visibleRanges\n\t\t\t\tif (!isValidCodeEditor()) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tupdateProperties(null);\n\t\t\t}));\n\t\t\tthis._codeEditorListeners.add(this._codeEditor.onDidScrollChange(() => {\n\t\t\t\t// visibleRanges\n\t\t\t\tif (!isValidCodeEditor()) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tupdateProperties(null);\n\t\t\t}));\n\t\t\tthis._updatePropertiesNow(null);\n\t\t}\n\t}\n\n\tpublic isVisible(): boolean {\n\t\treturn !!this._codeEditor;\n\t}\n\n\tpublic getProperties(): MainThreadTextEditorProperties {\n\t\treturn this._properties!;\n\t}\n\n\tpublic get onPropertiesChanged(): Event<IEditorPropertiesChangeData> {\n\t\treturn this._onPropertiesChanged.event;\n\t}\n\n\tpublic setSelections(selections: ISelection[]): void {\n\t\tif (this._codeEditor) {\n\t\t\tthis._codeEditor.setSelections(selections);\n\t\t\treturn;\n\t\t}\n\n\t\tconst newSelections = selections.map(Selection.liftSelection);\n\t\tthis._setProperties(\n\t\t\tnew MainThreadTextEditorProperties(newSelections, this._properties!.options, this._properties!.visibleRanges),\n\t\t\tnull\n\t\t);\n\t}\n\n\tprivate _setIndentConfiguration(newConfiguration: ITextEditorConfigurationUpdate): void {\n\t\tconst creationOpts = this._modelService.getCreationOptions(this._model.getLanguageId(), this._model.uri, this._model.isForSimpleWidget);\n\n\t\tif (newConfiguration.tabSize === 'auto' || newConfiguration.insertSpaces === 'auto') {\n\t\t\t// one of the options was set to 'auto' => detect indentation\n\t\t\tlet insertSpaces = creationOpts.insertSpaces;\n\t\t\tlet tabSize = creationOpts.tabSize;\n\n\t\t\tif (newConfiguration.insertSpaces !== 'auto' && typeof newConfiguration.insertSpaces !== 'undefined') {\n\t\t\t\tinsertSpaces = newConfiguration.insertSpaces;\n\t\t\t}\n\n\t\t\tif (newConfiguration.tabSize !== 'auto' && typeof newConfiguration.tabSize !== 'undefined') {\n\t\t\t\ttabSize = newConfiguration.tabSize;\n\t\t\t}\n\n\t\t\tthis._model.detectIndentation(insertSpaces, tabSize);\n\t\t\treturn;\n\t\t}\n\n\t\tconst newOpts: ITextModelUpdateOptions = {};\n\t\tif (typeof newConfiguration.insertSpaces !== 'undefined') {\n\t\t\tnewOpts.insertSpaces = newConfiguration.insertSpaces;\n\t\t}\n\t\tif (typeof newConfiguration.tabSize !== 'undefined') {\n\t\t\tnewOpts.tabSize = newConfiguration.tabSize;\n\t\t}\n\t\tif (typeof newConfiguration.indentSize !== 'undefined') {\n\t\t\tnewOpts.indentSize = newConfiguration.indentSize;\n\t\t}\n\t\tthis._model.updateOptions(newOpts);\n\t}\n\n\tpublic setConfiguration(newConfiguration: ITextEditorConfigurationUpdate): void {\n\t\tthis._setIndentConfiguration(newConfiguration);\n\n\t\tif (!this._codeEditor) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (newConfiguration.cursorStyle) {\n\t\t\tconst newCursorStyle = cursorStyleToString(newConfiguration.cursorStyle);\n\t\t\tthis._codeEditor.updateOptions({\n\t\t\t\tcursorStyle: newCursorStyle\n\t\t\t});\n\t\t}\n\n\t\tif (typeof newConfiguration.lineNumbers !== 'undefined') {\n\t\t\tlet lineNumbers: 'on' | 'off' | 'relative' | 'interval';\n\t\t\tswitch (newConfiguration.lineNumbers) {\n\t\t\t\tcase RenderLineNumbersType.On:\n\t\t\t\t\tlineNumbers = 'on';\n\t\t\t\t\tbreak;\n\t\t\t\tcase RenderLineNumbersType.Relative:\n\t\t\t\t\tlineNumbers = 'relative';\n\t\t\t\t\tbreak;\n\t\t\t\tcase RenderLineNumbersType.Interval:\n\t\t\t\t\tlineNumbers = 'interval';\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\tlineNumbers = 'off';\n\t\t\t}\n\t\t\tthis._codeEditor.updateOptions({\n\t\t\t\tlineNumbers: lineNumbers\n\t\t\t});\n\t\t}\n\t}\n\n\tpublic setDecorations(key: string, ranges: IDecorationOptions[]): void {\n\t\tif (!this._codeEditor) {\n\t\t\treturn;\n\t\t}\n\t\tthis._codeEditor.setDecorationsByType('exthost-api', key, ranges);\n\t}\n\n\tpublic setDecorationsFast(key: string, _ranges: number[]): void {\n\t\tif (!this._codeEditor) {\n\t\t\treturn;\n\t\t}\n\t\tconst ranges: Range[] = [];\n\t\tfor (let i = 0, len = Math.floor(_ranges.length / 4); i < len; i++) {\n\t\t\tranges[i] = new Range(_ranges[4 * i], _ranges[4 * i + 1], _ranges[4 * i + 2], _ranges[4 * i + 3]);\n\t\t}\n\t\tthis._codeEditor.setDecorationsByTypeFast(key, ranges);\n\t}\n\n\tpublic revealRange(range: IRange, revealType: TextEditorRevealType): void {\n\t\tif (!this._codeEditor) {\n\t\t\treturn;\n\t\t}\n\t\tswitch (revealType) {\n\t\t\tcase TextEditorRevealType.Default:\n\t\t\t\tthis._codeEditor.revealRange(range, ScrollType.Smooth);\n\t\t\t\tbreak;\n\t\t\tcase TextEditorRevealType.InCenter:\n\t\t\t\tthis._codeEditor.revealRangeInCenter(range, ScrollType.Smooth);\n\t\t\t\tbreak;\n\t\t\tcase TextEditorRevealType.InCenterIfOutsideViewport:\n\t\t\t\tthis._codeEditor.revealRangeInCenterIfOutsideViewport(range, ScrollType.Smooth);\n\t\t\t\tbreak;\n\t\t\tcase TextEditorRevealType.AtTop:\n\t\t\t\tthis._codeEditor.revealRangeAtTop(range, ScrollType.Smooth);\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tconsole.warn(`Unknown revealType: ${revealType}`);\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tpublic isFocused(): boolean {\n\t\tif (this._codeEditor) {\n\t\t\treturn this._codeEditor.hasTextFocus();\n\t\t}\n\t\treturn false;\n\t}\n\n\tpublic matches(editor: IEditorPane): boolean {\n\t\tif (!editor) {\n\t\t\treturn false;\n\t\t}\n\t\treturn editor.getControl() === this._codeEditor;\n\t}\n\n\tpublic applyEdits(versionIdCheck: number, edits: ISingleEditOperation[], opts: IApplyEditsOptions): boolean {\n\t\tif (this._model.getVersionId() !== versionIdCheck) {\n\t\t\t// throw new Error('Model has changed in the meantime!');\n\t\t\t// model changed in the meantime\n\t\t\treturn false;\n\t\t}\n\n\t\tif (!this._codeEditor) {\n\t\t\t// console.warn('applyEdits on invisible editor');\n\t\t\treturn false;\n\t\t}\n\n\t\tif (typeof opts.setEndOfLine !== 'undefined') {\n\t\t\tthis._model.pushEOL(opts.setEndOfLine);\n\t\t}\n\n\t\tconst transformedEdits = edits.map((edit): ISingleEditOperation => {\n\t\t\treturn {\n\t\t\t\trange: Range.lift(edit.range),\n\t\t\t\ttext: edit.text,\n\t\t\t\tforceMoveMarkers: edit.forceMoveMarkers\n\t\t\t};\n\t\t});\n\n\t\tif (opts.undoStopBefore) {\n\t\t\tthis._codeEditor.pushUndoStop();\n\t\t}\n\t\tthis._codeEditor.executeEdits('MainThreadTextEditor', transformedEdits);\n\t\tif (opts.undoStopAfter) {\n\t\t\tthis._codeEditor.pushUndoStop();\n\t\t}\n\t\treturn true;\n\t}\n\n\tasync insertSnippet(modelVersionId: number, template: string, ranges: readonly IRange[], opts: ISnippetOptions) {\n\n\t\tif (!this._codeEditor || !this._codeEditor.hasModel()) {\n\t\t\treturn false;\n\t\t}\n\n\t\t// check if clipboard is required and only iff read it (async)\n\t\tlet clipboardText: string | undefined;\n\t\tconst needsTemplate = SnippetParser.guessNeedsClipboard(template);\n\t\tif (needsTemplate) {\n\t\t\tconst state = new EditorState(this._codeEditor, CodeEditorStateFlag.Value | CodeEditorStateFlag.Position);\n\t\t\tclipboardText = await this._clipboardService.readText();\n\t\t\tif (!state.validate(this._codeEditor)) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\n\t\tif (this._codeEditor.getModel().getVersionId() !== modelVersionId) {\n\t\t\treturn false;\n\t\t}\n\n\t\tconst snippetController = SnippetController2.get(this._codeEditor);\n\t\tif (!snippetController) {\n\t\t\treturn false;\n\t\t}\n\n\t\tthis._codeEditor.focus();\n\n\t\t// make modifications as snippet edit\n\t\tconst edits: ISnippetEdit[] = ranges.map(range => ({ range: Range.lift(range), template }));\n\t\tsnippetController.apply(edits, {\n\t\t\toverwriteBefore: 0, overwriteAfter: 0,\n\t\t\tundoStopBefore: opts.undoStopBefore, undoStopAfter: opts.undoStopAfter,\n\t\t\tadjustWhitespace: !opts.keepWhitespace,\n\t\t\tclipboardText\n\t\t});\n\n\t\treturn true;\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Emitter, Event } from '../../../base/common/event.js';\nimport { DisposableStore } from '../../../base/common/lifecycle.js';\nimport { ICodeEditor } from '../../../editor/browser/editorBrowser.js';\nimport { RenderLineNumbersType, TextEditorCursorStyle, cursorStyleToString, EditorOption } from '../../../editor/common/config/editorOptions.js';\nimport { IRange, Range } from '../../../editor/common/core/range.js';\nimport { ISelection, Selection } from '../../../editor/common/core/selection.js';\nimport { IDecorationOptions, ScrollType } from '../../../editor/common/editorCommon.js';\nimport { ITextModel, ITextModelUpdateOptions } from '../../../editor/common/model.js';\nimport { ISingleEditOperation } from '../../../editor/common/core/editOperation.js';\nimport { IModelService } from '../../../editor/common/services/model.js';\nimport { SnippetController2 } from '../../../editor/contrib/snippet/browser/snippetController2.js';\nimport { IApplyEditsOptions, IEditorPropertiesChangeData, IResolvedTextEditorConfiguration, ISnippetOptions, ITextEditorConfigurationUpdate, TextEditorRevealType } from '../common/extHost.protocol.js';\nimport { IEditorPane } from '../../common/editor.js';\nimport { equals } from '../../../base/common/arrays.js';\nimport { CodeEditorStateFlag, EditorState } from '../../../editor/contrib/editorState/browser/editorState.js';\nimport { IClipboardService } from '../../../platform/clipboard/common/clipboardService.js';\nimport { SnippetParser } from '../../../editor/contrib/snippet/browser/snippetParser.js';\nimport { MainThreadDocuments } from './mainThreadDocuments.js';\nimport { ISnippetEdit } from '../../../editor/contrib/snippet/browser/snippetSession.js';\n\nexport interface IFocusTracker {\n\tonGainedFocus(): void;\n\tonLostFocus(): void;\n}\n\nexport class MainThreadTextEditorProperties {\n\n\tpublic static readFromEditor(previousProperties: MainThreadTextEditorProperties | null, model: ITextModel, codeEditor: ICodeEditor | null): MainThreadTextEditorProperties {\n\t\tconst selections = MainThreadTextEditorProperties._readSelectionsFromCodeEditor(previousProperties, codeEditor);\n\t\tconst options = MainThreadTextEditorProperties._readOptionsFromCodeEditor(previousProperties, model, codeEditor);\n\t\tconst visibleRanges = MainThreadTextEditorProperties._readVisibleRangesFromCodeEditor(previousProperties, codeEditor);\n\t\treturn new MainThreadTextEditorProperties(selections, options, visibleRanges);\n\t}\n\n\tprivate static _readSelectionsFromCodeEditor(previousProperties: MainThreadTextEditorProperties | null, codeEditor: ICodeEditor | null): Selection[] {\n\t\tlet result: Selection[] | null = null;\n\t\tif (codeEditor) {\n\t\t\tresult = codeEditor.getSelections();\n\t\t}\n\t\tif (!result && previousProperties) {\n\t\t\tresult = previousProperties.selections;\n\t\t}\n\t\tif (!result) {\n\t\t\tresult = [new Selection(1, 1, 1, 1)];\n\t\t}\n\t\treturn result;\n\t}\n\n\tprivate static _readOptionsFromCodeEditor(previousProperties: MainThreadTextEditorProperties | null, model: ITextModel, codeEditor: ICodeEditor | null): IResolvedTextEditorConfiguration {\n\t\tif (model.isDisposed()) {\n\t\t\tif (previousProperties) {\n\t\t\t\t// shutdown time\n\t\t\t\treturn previousProperties.options;\n\t\t\t} else {\n\t\t\t\tthrow new Error('No valid properties');\n\t\t\t}\n\t\t}\n\n\t\tlet cursorStyle: TextEditorCursorStyle;\n\t\tlet lineNumbers: RenderLineNumbersType;\n\t\tif (codeEditor) {\n\t\t\tconst options = codeEditor.getOptions();\n\t\t\tconst lineNumbersOpts = options.get(EditorOption.lineNumbers);\n\t\t\tcursorStyle = options.get(EditorOption.cursorStyle);\n\t\t\tlineNumbers = lineNumbersOpts.renderType;\n\t\t} else if (previousProperties) {\n\t\t\tcursorStyle = previousProperties.options.cursorStyle;\n\t\t\tlineNumbers = previousProperties.options.lineNumbers;\n\t\t} else {\n\t\t\tcursorStyle = TextEditorCursorStyle.Line;\n\t\t\tlineNumbers = RenderLineNumbersType.On;\n\t\t}\n\n\t\tconst modelOptions = model.getOptions();\n\t\treturn {\n\t\t\tinsertSpaces: modelOptions.insertSpaces,\n\t\t\ttabSize: modelOptions.tabSize,\n\t\t\tindentSize: modelOptions.indentSize,\n\t\t\toriginalIndentSize: modelOptions.originalIndentSize,\n\t\t\tcursorStyle: cursorStyle,\n\t\t\tlineNumbers: lineNumbers\n\t\t};\n\t}\n\n\tprivate static _readVisibleRangesFromCodeEditor(previousProperties: MainThreadTextEditorProperties | null, codeEditor: ICodeEditor | null): Range[] {\n\t\tif (codeEditor) {\n\t\t\treturn codeEditor.getVisibleRanges();\n\t\t}\n\t\treturn [];\n\t}\n\n\tconstructor(\n\t\tpublic readonly selections: Selection[],\n\t\tpublic readonly options: IResolvedTextEditorConfiguration,\n\t\tpublic readonly visibleRanges: Range[]\n\t) {\n\t}\n\n\tpublic generateDelta(oldProps: MainThreadTextEditorProperties | null, selectionChangeSource: string | null): IEditorPropertiesChangeData | null {\n\t\tconst delta: IEditorPropertiesChangeData = {\n\t\t\toptions: null,\n\t\t\tselections: null,\n\t\t\tvisibleRanges: null\n\t\t};\n\n\t\tif (!oldProps || !MainThreadTextEditorProperties._selectionsEqual(oldProps.selections, this.selections)) {\n\t\t\tdelta.selections = {\n\t\t\t\tselections: this.selections,\n\t\t\t\tsource: selectionChangeSource ?? undefined,\n\t\t\t};\n\t\t}\n\n\t\tif (!oldProps || !MainThreadTextEditorProperties._optionsEqual(oldProps.options, this.options)) {\n\t\t\tdelta.options = this.options;\n\t\t}\n\n\t\tif (!oldProps || !MainThreadTextEditorProperties._rangesEqual(oldProps.visibleRanges, this.visibleRanges)) {\n\t\t\tdelta.visibleRanges = this.visibleRanges;\n\t\t}\n\n\t\tif (delta.selections || delta.options || delta.visibleRanges) {\n\t\t\t// something changed\n\t\t\treturn delta;\n\t\t}\n\t\t// nothing changed\n\t\treturn null;\n\t}\n\n\tprivate static _selectionsEqual(a: readonly Selection[], b: readonly Selection[]): boolean {\n\t\treturn equals(a, b, (aValue, bValue) => aValue.equalsSelection(bValue));\n\t}\n\n\tprivate static _rangesEqual(a: readonly Range[], b: readonly Range[]): boolean {\n\t\treturn equals(a, b, (aValue, bValue) => aValue.equalsRange(bValue));\n\t}\n\n\tprivate static _optionsEqual(a: IResolvedTextEditorConfiguration, b: IResolvedTextEditorConfiguration): boolean {\n\t\tif (a && !b || !a && b) {\n\t\t\treturn false;\n\t\t}\n\t\tif (!a && !b) {\n\t\t\treturn true;\n\t\t}\n\t\treturn (\n\t\t\ta.tabSize === b.tabSize\n\t\t\t&& a.indentSize === b.indentSize\n\t\t\t&& a.insertSpaces === b.insertSpaces\n\t\t\t&& a.cursorStyle === b.cursorStyle\n\t\t\t&& a.lineNumbers === b.lineNumbers\n\t\t);\n\t}\n}\n\n/**\n * Text Editor that is permanently bound to the same model.\n * It can be bound or not to a CodeEditor.\n */\nexport class MainThreadTextEditor {\n\n\tprivate readonly _id: string;\n\tprivate readonly _model: ITextModel;\n\tprivate readonly _mainThreadDocuments: MainThreadDocuments;\n\tprivate readonly _modelService: IModelService;\n\tprivate readonly _clipboardService: IClipboardService;\n\tprivate readonly _modelListeners = new DisposableStore();\n\tprivate _codeEditor: ICodeEditor | null;\n\tprivate readonly _focusTracker: IFocusTracker;\n\tprivate readonly _codeEditorListeners = new DisposableStore();\n\n\tprivate _properties: MainThreadTextEditorProperties | null;\n\tprivate readonly _onPropertiesChanged: Emitter<IEditorPropertiesChangeData>;\n\n\tconstructor(\n\t\tid: string,\n\t\tmodel: ITextModel,\n\t\tcodeEditor: ICodeEditor,\n\t\tfocusTracker: IFocusTracker,\n\t\tmainThreadDocuments: MainThreadDocuments,\n\t\tmodelService: IModelService,\n\t\tclipboardService: IClipboardService,\n\t) {\n\t\tthis._id = id;\n\t\tthis._model = model;\n\t\tthis._codeEditor = null;\n\t\tthis._properties = null;\n\t\tthis._focusTracker = focusTracker;\n\t\tthis._mainThreadDocuments = mainThreadDocuments;\n\t\tthis._modelService = modelService;\n\t\tthis._clipboardService = clipboardService;\n\n\t\tthis._onPropertiesChanged = new Emitter<IEditorPropertiesChangeData>();\n\n\t\tthis._modelListeners.add(this._model.onDidChangeOptions((e) => {\n\t\t\tthis._updatePropertiesNow(null);\n\t\t}));\n\n\t\tthis.setCodeEditor(codeEditor);\n\t\tthis._updatePropertiesNow(null);\n\t}\n\n\tpublic dispose(): void {\n\t\tthis._modelListeners.dispose();\n\t\tthis._codeEditor = null;\n\t\tthis._codeEditorListeners.dispose();\n\t}\n\n\tprivate _updatePropertiesNow(selectionChangeSource: string | null): void {\n\t\tthis._setProperties(\n\t\t\tMainThreadTextEditorProperties.readFromEditor(this._properties, this._model, this._codeEditor),\n\t\t\tselectionChangeSource\n\t\t);\n\t}\n\n\tprivate _setProperties(newProperties: MainThreadTextEditorProperties, selectionChangeSource: string | null): void {\n\t\tconst delta = newProperties.generateDelta(this._properties, selectionChangeSource);\n\t\tthis._properties = newProperties;\n\t\tif (delta) {\n\t\t\tthis._onPropertiesChanged.fire(delta);\n\t\t}\n\t}\n\n\tpublic getId(): string {\n\t\treturn this._id;\n\t}\n\n\tpublic getModel(): ITextModel {\n\t\treturn this._model;\n\t}\n\n\tpublic getCodeEditor(): ICodeEditor | null {\n\t\treturn this._codeEditor;\n\t}\n\n\tpublic hasCodeEditor(codeEditor: ICodeEditor | null): boolean {\n\t\treturn (this._codeEditor === codeEditor);\n\t}\n\n\tpublic setCodeEditor(codeEditor: ICodeEditor | null): void {\n\t\tif (this.hasCodeEditor(codeEditor)) {\n\t\t\t// Nothing to do...\n\t\t\treturn;\n\t\t}\n\t\tthis._codeEditorListeners.clear();\n\n\t\tthis._codeEditor = codeEditor;\n\t\tif (this._codeEditor) {\n\n\t\t\t// Catch early the case that this code editor gets a different model set and disassociate from this model\n\t\t\tthis._codeEditorListeners.add(this._codeEditor.onDidChangeModel(() => {\n\t\t\t\tthis.setCodeEditor(null);\n\t\t\t}));\n\n\t\t\tthis._codeEditorListeners.add(this._codeEditor.onDidFocusEditorWidget(() => {\n\t\t\t\tthis._focusTracker.onGainedFocus();\n\t\t\t}));\n\t\t\tthis._codeEditorListeners.add(this._codeEditor.onDidBlurEditorWidget(() => {\n\t\t\t\tthis._focusTracker.onLostFocus();\n\t\t\t}));\n\n\t\t\tlet nextSelectionChangeSource: string | null = null;\n\t\t\tthis._codeEditorListeners.add(this._mainThreadDocuments.onIsCaughtUpWithContentChanges((uri) => {\n\t\t\t\tif (uri.toString() === this._model.uri.toString()) {\n\t\t\t\t\tconst selectionChangeSource = nextSelectionChangeSource;\n\t\t\t\t\tnextSelectionChangeSource = null;\n\t\t\t\t\tthis._updatePropertiesNow(selectionChangeSource);\n\t\t\t\t}\n\t\t\t}));\n\n\t\t\tconst isValidCodeEditor = () => {\n\t\t\t\t// Due to event timings, it is possible that there is a model change event not yet delivered to us.\n\t\t\t\t// > e.g. a model change event is emitted to a listener which then decides to update editor options\n\t\t\t\t// > In this case the editor configuration change event reaches us first.\n\t\t\t\t// So simply check that the model is still attached to this code editor\n\t\t\t\treturn (this._codeEditor && this._codeEditor.getModel() === this._model);\n\t\t\t};\n\n\t\t\tconst updateProperties = (selectionChangeSource: string | null) => {\n\t\t\t\t// Some editor events get delivered faster than model content changes. This is\n\t\t\t\t// problematic, as this leads to editor properties reaching the extension host\n\t\t\t\t// too soon, before the model content change that was the root cause.\n\t\t\t\t//\n\t\t\t\t// If this case is identified, then let's update editor properties on the next model\n\t\t\t\t// content change instead.\n\t\t\t\tif (this._mainThreadDocuments.isCaughtUpWithContentChanges(this._model.uri)) {\n\t\t\t\t\tnextSelectionChangeSource = null;\n\t\t\t\t\tthis._updatePropertiesNow(selectionChangeSource);\n\t\t\t\t} else {\n\t\t\t\t\t// update editor properties on the next model content change\n\t\t\t\t\tnextSelectionChangeSource = selectionChangeSource;\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tthis._codeEditorListeners.add(this._codeEditor.onDidChangeCursorSelection((e) => {\n\t\t\t\t// selection\n\t\t\t\tif (!isValidCodeEditor()) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tupdateProperties(e.source);\n\t\t\t}));\n\t\t\tthis._codeEditorListeners.add(this._codeEditor.onDidChangeConfiguration((e) => {\n\t\t\t\t// options\n\t\t\t\tif (!isValidCodeEditor()) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tupdateProperties(null);\n\t\t\t}));\n\t\t\tthis._codeEditorListeners.add(this._codeEditor.onDidLayoutChange(() => {\n\t\t\t\t// visibleRanges\n\t\t\t\tif (!isValidCodeEditor()) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tupdateProperties(null);\n\t\t\t}));\n\t\t\tthis._codeEditorListeners.add(this._codeEditor.onDidScrollChange(() => {\n\t\t\t\t// visibleRanges\n\t\t\t\tif (!isValidCodeEditor()) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tupdateProperties(null);\n\t\t\t}));\n\t\t\tthis._updatePropertiesNow(null);\n\t\t}\n\t}\n\n\tpublic isVisible(): boolean {\n\t\treturn !!this._codeEditor;\n\t}\n\n\tpublic getProperties(): MainThreadTextEditorProperties {\n\t\treturn this._properties!;\n\t}\n\n\tpublic get onPropertiesChanged(): Event<IEditorPropertiesChangeData> {\n\t\treturn this._onPropertiesChanged.event;\n\t}\n\n\tpublic setSelections(selections: ISelection[]): void {\n\t\tif (this._codeEditor) {\n\t\t\tthis._codeEditor.setSelections(selections);\n\t\t\treturn;\n\t\t}\n\n\t\tconst newSelections = selections.map(Selection.liftSelection);\n\t\tthis._setProperties(\n\t\t\tnew MainThreadTextEditorProperties(newSelections, this._properties!.options, this._properties!.visibleRanges),\n\t\t\tnull\n\t\t);\n\t}\n\n\tprivate _setIndentConfiguration(newConfiguration: ITextEditorConfigurationUpdate): void {\n\t\tconst creationOpts = this._modelService.getCreationOptions(this._model.getLanguageId(), this._model.uri, this._model.isForSimpleWidget);\n\n\t\tif (newConfiguration.tabSize === 'auto' || newConfiguration.insertSpaces === 'auto') {\n\t\t\t// one of the options was set to 'auto' => detect indentation\n\t\t\tlet insertSpaces = creationOpts.insertSpaces;\n\t\t\tlet tabSize = creationOpts.tabSize;\n\n\t\t\tif (newConfiguration.insertSpaces !== 'auto' && typeof newConfiguration.insertSpaces !== 'undefined') {\n\t\t\t\tinsertSpaces = newConfiguration.insertSpaces;\n\t\t\t}\n\n\t\t\tif (newConfiguration.tabSize !== 'auto' && typeof newConfiguration.tabSize !== 'undefined') {\n\t\t\t\ttabSize = newConfiguration.tabSize;\n\t\t\t}\n\n\t\t\tthis._model.detectIndentation(insertSpaces, tabSize);\n\t\t\treturn;\n\t\t}\n\n\t\tconst newOpts: ITextModelUpdateOptions = {};\n\t\tif (typeof newConfiguration.insertSpaces !== 'undefined') {\n\t\t\tnewOpts.insertSpaces = newConfiguration.insertSpaces;\n\t\t}\n\t\tif (typeof newConfiguration.tabSize !== 'undefined') {\n\t\t\tnewOpts.tabSize = newConfiguration.tabSize;\n\t\t}\n\t\tif (typeof newConfiguration.indentSize !== 'undefined') {\n\t\t\tnewOpts.indentSize = newConfiguration.indentSize;\n\t\t}\n\t\tthis._model.updateOptions(newOpts);\n\t}\n\n\tpublic setConfiguration(newConfiguration: ITextEditorConfigurationUpdate): void {\n\t\tthis._setIndentConfiguration(newConfiguration);\n\n\t\tif (!this._codeEditor) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (newConfiguration.cursorStyle) {\n\t\t\tconst newCursorStyle = cursorStyleToString(newConfiguration.cursorStyle);\n\t\t\tthis._codeEditor.updateOptions({\n\t\t\t\tcursorStyle: newCursorStyle\n\t\t\t});\n\t\t}\n\n\t\tif (typeof newConfiguration.lineNumbers !== 'undefined') {\n\t\t\tlet lineNumbers: 'on' | 'off' | 'relative' | 'interval';\n\t\t\tswitch (newConfiguration.lineNumbers) {\n\t\t\t\tcase RenderLineNumbersType.On:\n\t\t\t\t\tlineNumbers = 'on';\n\t\t\t\t\tbreak;\n\t\t\t\tcase RenderLineNumbersType.Relative:\n\t\t\t\t\tlineNumbers = 'relative';\n\t\t\t\t\tbreak;\n\t\t\t\tcase RenderLineNumbersType.Interval:\n\t\t\t\t\tlineNumbers = 'interval';\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\tlineNumbers = 'off';\n\t\t\t}\n\t\t\tthis._codeEditor.updateOptions({\n\t\t\t\tlineNumbers: lineNumbers\n\t\t\t});\n\t\t}\n\t}\n\n\tpublic setDecorations(key: string, ranges: IDecorationOptions[]): void {\n\t\tif (!this._codeEditor) {\n\t\t\treturn;\n\t\t}\n\t\tthis._codeEditor.setDecorationsByType('exthost-api', key, ranges);\n\t}\n\n\tpublic setDecorationsFast(key: string, _ranges: number[]): void {\n\t\tif (!this._codeEditor) {\n\t\t\treturn;\n\t\t}\n\t\tconst ranges: Range[] = [];\n\t\tfor (let i = 0, len = Math.floor(_ranges.length / 4); i < len; i++) {\n\t\t\tranges[i] = new Range(_ranges[4 * i], _ranges[4 * i + 1], _ranges[4 * i + 2], _ranges[4 * i + 3]);\n\t\t}\n\t\tthis._codeEditor.setDecorationsByTypeFast(key, ranges);\n\t}\n\n\tpublic revealRange(range: IRange, revealType: TextEditorRevealType): void {\n\t\tif (!this._codeEditor) {\n\t\t\treturn;\n\t\t}\n\t\tswitch (revealType) {\n\t\t\tcase TextEditorRevealType.Default:\n\t\t\t\tthis._codeEditor.revealRange(range, ScrollType.Smooth);\n\t\t\t\tbreak;\n\t\t\tcase TextEditorRevealType.InCenter:\n\t\t\t\tthis._codeEditor.revealRangeInCenter(range, ScrollType.Smooth);\n\t\t\t\tbreak;\n\t\t\tcase TextEditorRevealType.InCenterIfOutsideViewport:\n\t\t\t\tthis._codeEditor.revealRangeInCenterIfOutsideViewport(range, ScrollType.Smooth);\n\t\t\t\tbreak;\n\t\t\tcase TextEditorRevealType.AtTop:\n\t\t\t\tthis._codeEditor.revealRangeAtTop(range, ScrollType.Smooth);\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tconsole.warn(`Unknown revealType: ${revealType}`);\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tpublic isFocused(): boolean {\n\t\tif (this._codeEditor) {\n\t\t\treturn this._codeEditor.hasTextFocus();\n\t\t}\n\t\treturn false;\n\t}\n\n\tpublic matches(editor: IEditorPane): boolean {\n\t\tif (!editor) {\n\t\t\treturn false;\n\t\t}\n\t\treturn editor.getControl() === this._codeEditor;\n\t}\n\n\tpublic applyEdits(versionIdCheck: number, edits: ISingleEditOperation[], opts: IApplyEditsOptions): boolean {\n\t\tif (this._model.getVersionId() !== versionIdCheck) {\n\t\t\t// throw new Error('Model has changed in the meantime!');\n\t\t\t// model changed in the meantime\n\t\t\treturn false;\n\t\t}\n\n\t\tif (!this._codeEditor) {\n\t\t\t// console.warn('applyEdits on invisible editor');\n\t\t\treturn false;\n\t\t}\n\n\t\tif (typeof opts.setEndOfLine !== 'undefined') {\n\t\t\tthis._model.pushEOL(opts.setEndOfLine);\n\t\t}\n\n\t\tconst transformedEdits = edits.map((edit): ISingleEditOperation => {\n\t\t\treturn {\n\t\t\t\trange: Range.lift(edit.range),\n\t\t\t\ttext: edit.text,\n\t\t\t\tforceMoveMarkers: edit.forceMoveMarkers\n\t\t\t};\n\t\t});\n\n\t\tif (opts.undoStopBefore) {\n\t\t\tthis._codeEditor.pushUndoStop();\n\t\t}\n\t\tthis._codeEditor.executeEdits('MainThreadTextEditor', transformedEdits);\n\t\tif (opts.undoStopAfter) {\n\t\t\tthis._codeEditor.pushUndoStop();\n\t\t}\n\t\treturn true;\n\t}\n\n\tasync insertSnippet(modelVersionId: number, template: string, ranges: readonly IRange[], opts: ISnippetOptions) {\n\n\t\tif (!this._codeEditor || !this._codeEditor.hasModel()) {\n\t\t\treturn false;\n\t\t}\n\n\t\t// check if clipboard is required and only iff read it (async)\n\t\tlet clipboardText: string | undefined;\n\t\tconst needsTemplate = SnippetParser.guessNeedsClipboard(template);\n\t\tif (needsTemplate) {\n\t\t\tconst state = new EditorState(this._codeEditor, CodeEditorStateFlag.Value | CodeEditorStateFlag.Position);\n\t\t\tclipboardText = await this._clipboardService.readText();\n\t\t\tif (!state.validate(this._codeEditor)) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\n\t\tif (this._codeEditor.getModel().getVersionId() !== modelVersionId) {\n\t\t\treturn false;\n\t\t}\n\n\t\tconst snippetController = SnippetController2.get(this._codeEditor);\n\t\tif (!snippetController) {\n\t\t\treturn false;\n\t\t}\n\n\t\tthis._codeEditor.focus();\n\n\t\t// make modifications as snippet edit\n\t\tconst edits: ISnippetEdit[] = ranges.map(range => ({ range: Range.lift(range), template }));\n\t\tsnippetController.apply(edits, {\n\t\t\toverwriteBefore: 0, overwriteAfter: 0,\n\t\t\tundoStopBefore: opts.undoStopBefore, undoStopAfter: opts.undoStopAfter,\n\t\t\tadjustWhitespace: !opts.keepWhitespace,\n\t\t\tclipboardText\n\t\t});\n\n\t\treturn true;\n\t}\n}\n"]}