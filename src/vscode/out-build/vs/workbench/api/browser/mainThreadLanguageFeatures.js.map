{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/api/browser/mainThreadLanguageFeatures.ts","vs/workbench/api/browser/mainThreadLanguageFeatures.ts"],"names":[],"mappings":"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","file":"mainThreadLanguageFeatures.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { VSBuffer } from '../../../base/common/buffer.js';\nimport { CancellationToken } from '../../../base/common/cancellation.js';\nimport { createStringDataTransferItem, IReadonlyVSDataTransfer, VSDataTransfer } from '../../../base/common/dataTransfer.js';\nimport { CancellationError } from '../../../base/common/errors.js';\nimport { Emitter, Event } from '../../../base/common/event.js';\nimport { HierarchicalKind } from '../../../base/common/hierarchicalKind.js';\nimport { combinedDisposable, Disposable, DisposableMap, toDisposable } from '../../../base/common/lifecycle.js';\nimport { ResourceMap } from '../../../base/common/map.js';\nimport { revive } from '../../../base/common/marshalling.js';\nimport { mixin } from '../../../base/common/objects.js';\nimport { URI } from '../../../base/common/uri.js';\nimport { Position as EditorPosition, IPosition } from '../../../editor/common/core/position.js';\nimport { Range as EditorRange, IRange } from '../../../editor/common/core/range.js';\nimport { Selection } from '../../../editor/common/core/selection.js';\nimport * as languages from '../../../editor/common/languages.js';\nimport { ILanguageService } from '../../../editor/common/languages/language.js';\nimport { IndentationRule, LanguageConfiguration, OnEnterRule } from '../../../editor/common/languages/languageConfiguration.js';\nimport { ILanguageConfigurationService } from '../../../editor/common/languages/languageConfigurationRegistry.js';\nimport { ITextModel } from '../../../editor/common/model.js';\nimport { ILanguageFeaturesService } from '../../../editor/common/services/languageFeatures.js';\nimport { decodeSemanticTokensDto } from '../../../editor/common/services/semanticTokensDto.js';\nimport { ExtensionIdentifier } from '../../../platform/extensions/common/extensions.js';\nimport { IUriIdentityService } from '../../../platform/uriIdentity/common/uriIdentity.js';\nimport { reviveWorkspaceEditDto } from './mainThreadBulkEdits.js';\nimport * as typeConvert from '../common/extHostTypeConverters.js';\nimport { DataTransferFileCache } from '../common/shared/dataTransferCache.js';\nimport * as callh from '../../contrib/callHierarchy/common/callHierarchy.js';\nimport * as search from '../../contrib/search/common/search.js';\nimport * as typeh from '../../contrib/typeHierarchy/common/typeHierarchy.js';\nimport { extHostNamedCustomer, IExtHostContext } from '../../services/extensions/common/extHostCustomers.js';\nimport { ExtHostContext, ExtHostLanguageFeaturesShape, HoverWithId, ICallHierarchyItemDto, ICodeActionDto, ICodeActionProviderMetadataDto, IdentifiableInlineCompletion, IdentifiableInlineCompletions, IDocumentDropEditDto, IDocumentDropEditProviderMetadata, IDocumentFilterDto, IIndentationRuleDto, IInlayHintDto, ILanguageConfigurationDto, ILanguageWordDefinitionDto, ILinkDto, ILocationDto, ILocationLinkDto, IOnEnterRuleDto, IPasteEditDto, IPasteEditProviderMetadataDto, IRegExpDto, ISignatureHelpProviderMetadataDto, ISuggestDataDto, ISuggestDataDtoField, ISuggestResultDtoField, ITypeHierarchyItemDto, IWorkspaceSymbolDto, MainContext, MainThreadLanguageFeaturesShape } from '../common/extHost.protocol.js';\nimport { InlineCompletionEndOfLifeReasonKind } from '../common/extHostTypes.js';\nimport { IInstantiationService } from '../../../platform/instantiation/common/instantiation.js';\nimport { DataChannelForwardingTelemetryService, forwardToChannelIf, isCopilotLikeExtension } from '../../../platform/dataChannel/browser/forwardingTelemetryService.js';\nimport { IAiEditTelemetryService } from '../../contrib/editTelemetry/browser/telemetry/aiEditTelemetry/aiEditTelemetryService.js';\nimport { EditDeltaInfo } from '../../../editor/common/textModelEditSource.js';\nimport { IInlineCompletionsUnificationService } from '../../services/inlineCompletions/common/inlineCompletionsUnification.js';\nimport { InlineCompletionEndOfLifeEvent, sendInlineCompletionsEndOfLifeTelemetry } from '../../../editor/contrib/inlineCompletions/browser/telemetry.js';\n\n@extHostNamedCustomer(MainContext.MainThreadLanguageFeatures)\nexport class MainThreadLanguageFeatures extends Disposable implements MainThreadLanguageFeaturesShape {\n\n\tprivate readonly _proxy: ExtHostLanguageFeaturesShape;\n\tprivate readonly _registrations = this._register(new DisposableMap<number>());\n\n\tconstructor(\n\t\textHostContext: IExtHostContext,\n\t\t@ILanguageService private readonly _languageService: ILanguageService,\n\t\t@ILanguageConfigurationService private readonly _languageConfigurationService: ILanguageConfigurationService,\n\t\t@ILanguageFeaturesService private readonly _languageFeaturesService: ILanguageFeaturesService,\n\t\t@IUriIdentityService private readonly _uriIdentService: IUriIdentityService,\n\t\t@IInstantiationService private readonly _instantiationService: IInstantiationService,\n\t\t@IInlineCompletionsUnificationService private readonly _inlineCompletionsUnificationService: IInlineCompletionsUnificationService,\n\t\t@IAiEditTelemetryService private readonly _aiEditTelemetryService: IAiEditTelemetryService,\n\t) {\n\t\tsuper();\n\n\t\tthis._proxy = extHostContext.getProxy(ExtHostContext.ExtHostLanguageFeatures);\n\n\t\tif (this._languageService) {\n\t\t\tconst updateAllWordDefinitions = () => {\n\t\t\t\tconst wordDefinitionDtos: ILanguageWordDefinitionDto[] = [];\n\t\t\t\tfor (const languageId of _languageService.getRegisteredLanguageIds()) {\n\t\t\t\t\tconst wordDefinition = this._languageConfigurationService.getLanguageConfiguration(languageId).getWordDefinition();\n\t\t\t\t\twordDefinitionDtos.push({\n\t\t\t\t\t\tlanguageId: languageId,\n\t\t\t\t\t\tregexSource: wordDefinition.source,\n\t\t\t\t\t\tregexFlags: wordDefinition.flags\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tthis._proxy.$setWordDefinitions(wordDefinitionDtos);\n\t\t\t};\n\t\t\tthis._register(this._languageConfigurationService.onDidChange((e) => {\n\t\t\t\tif (!e.languageId) {\n\t\t\t\t\tupdateAllWordDefinitions();\n\t\t\t\t} else {\n\t\t\t\t\tconst wordDefinition = this._languageConfigurationService.getLanguageConfiguration(e.languageId).getWordDefinition();\n\t\t\t\t\tthis._proxy.$setWordDefinitions([{\n\t\t\t\t\t\tlanguageId: e.languageId,\n\t\t\t\t\t\tregexSource: wordDefinition.source,\n\t\t\t\t\t\tregexFlags: wordDefinition.flags\n\t\t\t\t\t}]);\n\t\t\t\t}\n\t\t\t}));\n\t\t\tupdateAllWordDefinitions();\n\t\t}\n\n\t\tif (this._inlineCompletionsUnificationService) {\n\t\t\tthis._register(this._inlineCompletionsUnificationService.onDidStateChange(() => {\n\t\t\t\tthis._proxy.$acceptInlineCompletionsUnificationState(this._inlineCompletionsUnificationService.state);\n\t\t\t}));\n\t\t\tthis._proxy.$acceptInlineCompletionsUnificationState(this._inlineCompletionsUnificationService.state);\n\t\t}\n\t}\n\n\t$unregister(handle: number): void {\n\t\tthis._registrations.deleteAndDispose(handle);\n\t}\n\n\t//#region --- revive functions\n\n\tprivate static _reviveLocationDto(data?: ILocationDto): languages.Location;\n\tprivate static _reviveLocationDto(data?: ILocationDto[]): languages.Location[];\n\tprivate static _reviveLocationDto(data: ILocationDto | ILocationDto[] | undefined): languages.Location | languages.Location[] | undefined {\n\t\tif (!data) {\n\t\t\treturn data;\n\t\t} else if (Array.isArray(data)) {\n\t\t\tdata.forEach(l => MainThreadLanguageFeatures._reviveLocationDto(l));\n\t\t\treturn <languages.Location[]>data;\n\t\t} else {\n\t\t\tdata.uri = URI.revive(data.uri);\n\t\t\treturn <languages.Location>data;\n\t\t}\n\t}\n\n\tprivate static _reviveLocationLinkDto(data: ILocationLinkDto): languages.LocationLink;\n\tprivate static _reviveLocationLinkDto(data: ILocationLinkDto[]): languages.LocationLink[];\n\tprivate static _reviveLocationLinkDto(data: ILocationLinkDto | ILocationLinkDto[]): languages.LocationLink | languages.LocationLink[] {\n\t\tif (!data) {\n\t\t\treturn <languages.LocationLink>data;\n\t\t} else if (Array.isArray(data)) {\n\t\t\tdata.forEach(l => MainThreadLanguageFeatures._reviveLocationLinkDto(l));\n\t\t\treturn <languages.LocationLink[]>data;\n\t\t} else {\n\t\t\tdata.uri = URI.revive(data.uri);\n\t\t\treturn <languages.LocationLink>data;\n\t\t}\n\t}\n\n\tprivate static _reviveWorkspaceSymbolDto(data: IWorkspaceSymbolDto): search.IWorkspaceSymbol;\n\tprivate static _reviveWorkspaceSymbolDto(data: IWorkspaceSymbolDto[]): search.IWorkspaceSymbol[];\n\tprivate static _reviveWorkspaceSymbolDto(data: undefined): undefined;\n\tprivate static _reviveWorkspaceSymbolDto(data: IWorkspaceSymbolDto | IWorkspaceSymbolDto[] | undefined): search.IWorkspaceSymbol | search.IWorkspaceSymbol[] | undefined {\n\t\tif (!data) {\n\t\t\treturn data;\n\t\t} else if (Array.isArray(data)) {\n\t\t\tdata.forEach(MainThreadLanguageFeatures._reviveWorkspaceSymbolDto);\n\t\t\treturn <search.IWorkspaceSymbol[]>data;\n\t\t} else {\n\t\t\tdata.location = MainThreadLanguageFeatures._reviveLocationDto(data.location);\n\t\t\treturn <search.IWorkspaceSymbol>data;\n\t\t}\n\t}\n\n\tprivate static _reviveCodeActionDto(data: ReadonlyArray<ICodeActionDto>, uriIdentService: IUriIdentityService): languages.CodeAction[] {\n\t\tdata?.forEach(code => reviveWorkspaceEditDto(code.edit, uriIdentService));\n\t\treturn <languages.CodeAction[]>data;\n\t}\n\n\tprivate static _reviveLinkDTO(data: ILinkDto): languages.ILink {\n\t\tif (data.url && typeof data.url !== 'string') {\n\t\t\tdata.url = URI.revive(data.url);\n\t\t}\n\t\treturn <languages.ILink>data;\n\t}\n\n\tprivate static _reviveCallHierarchyItemDto(data: ICallHierarchyItemDto | undefined): callh.CallHierarchyItem {\n\t\tif (data) {\n\t\t\tdata.uri = URI.revive(data.uri);\n\t\t}\n\t\treturn data as callh.CallHierarchyItem;\n\t}\n\n\tprivate static _reviveTypeHierarchyItemDto(data: ITypeHierarchyItemDto | undefined): typeh.TypeHierarchyItem {\n\t\tif (data) {\n\t\t\tdata.uri = URI.revive(data.uri);\n\t\t}\n\t\treturn data as typeh.TypeHierarchyItem;\n\t}\n\n\t//#endregion\n\n\t// --- outline\n\n\t$registerDocumentSymbolProvider(handle: number, selector: IDocumentFilterDto[], displayName: string): void {\n\t\tthis._registrations.set(handle, this._languageFeaturesService.documentSymbolProvider.register(selector, {\n\t\t\tdisplayName,\n\t\t\tprovideDocumentSymbols: (model: ITextModel, token: CancellationToken): Promise<languages.DocumentSymbol[] | undefined> => {\n\t\t\t\treturn this._proxy.$provideDocumentSymbols(handle, model.uri, token);\n\t\t\t}\n\t\t}));\n\t}\n\n\t// --- code lens\n\n\t$registerCodeLensSupport(handle: number, selector: IDocumentFilterDto[], eventHandle: number | undefined): void {\n\n\t\tconst provider: languages.CodeLensProvider = {\n\t\t\tprovideCodeLenses: async (model: ITextModel, token: CancellationToken): Promise<languages.CodeLensList | undefined> => {\n\t\t\t\tconst listDto = await this._proxy.$provideCodeLenses(handle, model.uri, token);\n\t\t\t\tif (!listDto) {\n\t\t\t\t\treturn undefined;\n\t\t\t\t}\n\t\t\t\treturn {\n\t\t\t\t\tlenses: listDto.lenses,\n\t\t\t\t\tdispose: () => listDto.cacheId && this._proxy.$releaseCodeLenses(handle, listDto.cacheId)\n\t\t\t\t};\n\t\t\t},\n\t\t\tresolveCodeLens: async (model: ITextModel, codeLens: languages.CodeLens, token: CancellationToken): Promise<languages.CodeLens | undefined> => {\n\t\t\t\tconst result = await this._proxy.$resolveCodeLens(handle, codeLens, token);\n\t\t\t\tif (!result || token.isCancellationRequested) {\n\t\t\t\t\treturn undefined;\n\t\t\t\t}\n\n\t\t\t\treturn {\n\t\t\t\t\t...result,\n\t\t\t\t\trange: model.validateRange(result.range),\n\t\t\t\t};\n\t\t\t}\n\t\t};\n\n\t\tif (typeof eventHandle === 'number') {\n\t\t\tconst emitter = new Emitter<languages.CodeLensProvider>();\n\t\t\tthis._registrations.set(eventHandle, emitter);\n\t\t\tprovider.onDidChange = emitter.event;\n\t\t}\n\n\t\tthis._registrations.set(handle, this._languageFeaturesService.codeLensProvider.register(selector, provider));\n\t}\n\n\t$emitCodeLensEvent(eventHandle: number, event?: unknown): void {\n\t\tconst obj = this._registrations.get(eventHandle);\n\t\tif (obj instanceof Emitter) {\n\t\t\tobj.fire(event);\n\t\t}\n\t}\n\n\t// --- declaration\n\n\t$registerDefinitionSupport(handle: number, selector: IDocumentFilterDto[]): void {\n\t\tthis._registrations.set(handle, this._languageFeaturesService.definitionProvider.register(selector, {\n\t\t\tprovideDefinition: (model, position, token): Promise<languages.LocationLink[]> => {\n\t\t\t\treturn this._proxy.$provideDefinition(handle, model.uri, position, token).then(MainThreadLanguageFeatures._reviveLocationLinkDto);\n\t\t\t}\n\t\t}));\n\t}\n\n\t$registerDeclarationSupport(handle: number, selector: IDocumentFilterDto[]): void {\n\t\tthis._registrations.set(handle, this._languageFeaturesService.declarationProvider.register(selector, {\n\t\t\tprovideDeclaration: (model, position, token) => {\n\t\t\t\treturn this._proxy.$provideDeclaration(handle, model.uri, position, token).then(MainThreadLanguageFeatures._reviveLocationLinkDto);\n\t\t\t}\n\t\t}));\n\t}\n\n\t$registerImplementationSupport(handle: number, selector: IDocumentFilterDto[]): void {\n\t\tthis._registrations.set(handle, this._languageFeaturesService.implementationProvider.register(selector, {\n\t\t\tprovideImplementation: (model, position, token): Promise<languages.LocationLink[]> => {\n\t\t\t\treturn this._proxy.$provideImplementation(handle, model.uri, position, token).then(MainThreadLanguageFeatures._reviveLocationLinkDto);\n\t\t\t}\n\t\t}));\n\t}\n\n\t$registerTypeDefinitionSupport(handle: number, selector: IDocumentFilterDto[]): void {\n\t\tthis._registrations.set(handle, this._languageFeaturesService.typeDefinitionProvider.register(selector, {\n\t\t\tprovideTypeDefinition: (model, position, token): Promise<languages.LocationLink[]> => {\n\t\t\t\treturn this._proxy.$provideTypeDefinition(handle, model.uri, position, token).then(MainThreadLanguageFeatures._reviveLocationLinkDto);\n\t\t\t}\n\t\t}));\n\t}\n\n\t// --- extra info\n\n\t$registerHoverProvider(handle: number, selector: IDocumentFilterDto[]): void {\n\t\t/*\n\t\tconst hoverFinalizationRegistry = new FinalizationRegistry((hoverId: number) => {\n\t\t\tthis._proxy.$releaseHover(handle, hoverId);\n\t\t});\n\t\t*/\n\t\tthis._registrations.set(handle, this._languageFeaturesService.hoverProvider.register(selector, {\n\t\t\tprovideHover: async (model: ITextModel, position: EditorPosition, token: CancellationToken, context?: languages.HoverContext<HoverWithId>): Promise<HoverWithId | undefined> => {\n\t\t\t\tconst serializedContext: languages.HoverContext<{ id: number }> = {\n\t\t\t\t\tverbosityRequest: context?.verbosityRequest ? {\n\t\t\t\t\t\tverbosityDelta: context.verbosityRequest.verbosityDelta,\n\t\t\t\t\t\tpreviousHover: { id: context.verbosityRequest.previousHover.id }\n\t\t\t\t\t} : undefined,\n\t\t\t\t};\n\t\t\t\tconst hover = await this._proxy.$provideHover(handle, model.uri, position, serializedContext, token);\n\t\t\t\t// hoverFinalizationRegistry.register(hover, hover.id);\n\t\t\t\treturn hover;\n\t\t\t}\n\t\t}));\n\t}\n\n\t// --- debug hover\n\n\t$registerEvaluatableExpressionProvider(handle: number, selector: IDocumentFilterDto[]): void {\n\t\tthis._registrations.set(handle, this._languageFeaturesService.evaluatableExpressionProvider.register(selector, {\n\t\t\tprovideEvaluatableExpression: (model: ITextModel, position: EditorPosition, token: CancellationToken): Promise<languages.EvaluatableExpression | undefined> => {\n\t\t\t\treturn this._proxy.$provideEvaluatableExpression(handle, model.uri, position, token);\n\t\t\t}\n\t\t}));\n\t}\n\n\t// --- inline values\n\n\t$registerInlineValuesProvider(handle: number, selector: IDocumentFilterDto[], eventHandle: number | undefined): void {\n\t\tconst provider: languages.InlineValuesProvider = {\n\t\t\tprovideInlineValues: (model: ITextModel, viewPort: EditorRange, context: languages.InlineValueContext, token: CancellationToken): Promise<languages.InlineValue[] | undefined> => {\n\t\t\t\treturn this._proxy.$provideInlineValues(handle, model.uri, viewPort, context, token);\n\t\t\t}\n\t\t};\n\n\t\tif (typeof eventHandle === 'number') {\n\t\t\tconst emitter = new Emitter<void>();\n\t\t\tthis._registrations.set(eventHandle, emitter);\n\t\t\tprovider.onDidChangeInlineValues = emitter.event;\n\t\t}\n\n\t\tthis._registrations.set(handle, this._languageFeaturesService.inlineValuesProvider.register(selector, provider));\n\t}\n\n\t$emitInlineValuesEvent(eventHandle: number, event?: unknown): void {\n\t\tconst obj = this._registrations.get(eventHandle);\n\t\tif (obj instanceof Emitter) {\n\t\t\tobj.fire(event);\n\t\t}\n\t}\n\n\t// --- occurrences\n\n\t$registerDocumentHighlightProvider(handle: number, selector: IDocumentFilterDto[]): void {\n\t\tthis._registrations.set(handle, this._languageFeaturesService.documentHighlightProvider.register(selector, {\n\t\t\tprovideDocumentHighlights: (model: ITextModel, position: EditorPosition, token: CancellationToken): Promise<languages.DocumentHighlight[] | undefined> => {\n\t\t\t\treturn this._proxy.$provideDocumentHighlights(handle, model.uri, position, token);\n\t\t\t}\n\t\t}));\n\t}\n\n\t$registerMultiDocumentHighlightProvider(handle: number, selector: IDocumentFilterDto[]): void {\n\t\tthis._registrations.set(handle, this._languageFeaturesService.multiDocumentHighlightProvider.register(selector, {\n\t\t\tselector: selector,\n\t\t\tprovideMultiDocumentHighlights: (model: ITextModel, position: EditorPosition, otherModels: ITextModel[], token: CancellationToken): Promise<Map<URI, languages.DocumentHighlight[]> | undefined> => {\n\t\t\t\treturn this._proxy.$provideMultiDocumentHighlights(handle, model.uri, position, otherModels.map(model => model.uri), token).then(dto => {\n\t\t\t\t\t// dto should be non-null + non-undefined\n\t\t\t\t\t// dto length of 0 is valid, just no highlights, pass this through.\n\t\t\t\t\tif (dto === undefined || dto === null) {\n\t\t\t\t\t\treturn undefined;\n\t\t\t\t\t}\n\t\t\t\t\tconst result = new ResourceMap<languages.DocumentHighlight[]>();\n\t\t\t\t\tdto?.forEach(value => {\n\t\t\t\t\t\t// check if the URI exists already, if so, combine the highlights, otherwise create a new entry\n\t\t\t\t\t\tconst uri = URI.revive(value.uri);\n\t\t\t\t\t\tif (result.has(uri)) {\n\t\t\t\t\t\t\tresult.get(uri)!.push(...value.highlights);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tresult.set(uri, value.highlights);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\treturn result;\n\t\t\t\t});\n\t\t\t}\n\t\t}));\n\t}\n\n\t// --- linked editing\n\n\t$registerLinkedEditingRangeProvider(handle: number, selector: IDocumentFilterDto[]): void {\n\t\tthis._registrations.set(handle, this._languageFeaturesService.linkedEditingRangeProvider.register(selector, {\n\t\t\tprovideLinkedEditingRanges: async (model: ITextModel, position: EditorPosition, token: CancellationToken): Promise<languages.LinkedEditingRanges | undefined> => {\n\t\t\t\tconst res = await this._proxy.$provideLinkedEditingRanges(handle, model.uri, position, token);\n\t\t\t\tif (res) {\n\t\t\t\t\treturn {\n\t\t\t\t\t\tranges: res.ranges,\n\t\t\t\t\t\twordPattern: res.wordPattern ? MainThreadLanguageFeatures._reviveRegExp(res.wordPattern) : undefined\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t\treturn undefined;\n\t\t\t}\n\t\t}));\n\t}\n\n\t// --- references\n\n\t$registerReferenceSupport(handle: number, selector: IDocumentFilterDto[]): void {\n\t\tthis._registrations.set(handle, this._languageFeaturesService.referenceProvider.register(selector, {\n\t\t\tprovideReferences: (model: ITextModel, position: EditorPosition, context: languages.ReferenceContext, token: CancellationToken): Promise<languages.Location[]> => {\n\t\t\t\treturn this._proxy.$provideReferences(handle, model.uri, position, context, token).then(MainThreadLanguageFeatures._reviveLocationDto);\n\t\t\t}\n\t\t}));\n\t}\n\n\t// --- code actions\n\n\t$registerCodeActionSupport(handle: number, selector: IDocumentFilterDto[], metadata: ICodeActionProviderMetadataDto, displayName: string, extensionId: string, supportsResolve: boolean): void {\n\t\tconst provider: languages.CodeActionProvider = {\n\t\t\tprovideCodeActions: async (model: ITextModel, rangeOrSelection: EditorRange | Selection, context: languages.CodeActionContext, token: CancellationToken): Promise<languages.CodeActionList | undefined> => {\n\t\t\t\tconst listDto = await this._proxy.$provideCodeActions(handle, model.uri, rangeOrSelection, context, token);\n\t\t\t\tif (!listDto) {\n\t\t\t\t\treturn undefined;\n\t\t\t\t}\n\t\t\t\treturn {\n\t\t\t\t\tactions: MainThreadLanguageFeatures._reviveCodeActionDto(listDto.actions, this._uriIdentService),\n\t\t\t\t\tdispose: () => {\n\t\t\t\t\t\tif (typeof listDto.cacheId === 'number') {\n\t\t\t\t\t\t\tthis._proxy.$releaseCodeActions(handle, listDto.cacheId);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t},\n\t\t\tprovidedCodeActionKinds: metadata.providedKinds,\n\t\t\tdocumentation: metadata.documentation,\n\t\t\tdisplayName,\n\t\t\textensionId,\n\t\t};\n\n\t\tif (supportsResolve) {\n\t\t\tprovider.resolveCodeAction = async (codeAction: languages.CodeAction, token: CancellationToken): Promise<languages.CodeAction> => {\n\t\t\t\tconst resolved = await this._proxy.$resolveCodeAction(handle, (<ICodeActionDto>codeAction).cacheId!, token);\n\t\t\t\tif (resolved.edit) {\n\t\t\t\t\tcodeAction.edit = reviveWorkspaceEditDto(resolved.edit, this._uriIdentService);\n\t\t\t\t}\n\n\t\t\t\tif (resolved.command) {\n\t\t\t\t\tcodeAction.command = resolved.command;\n\t\t\t\t}\n\n\t\t\t\treturn codeAction;\n\t\t\t};\n\t\t}\n\n\t\tthis._registrations.set(handle, this._languageFeaturesService.codeActionProvider.register(selector, provider));\n\t}\n\n\t// --- copy paste action provider\n\n\tprivate readonly _pasteEditProviders = new Map<number, MainThreadPasteEditProvider>();\n\n\t$registerPasteEditProvider(handle: number, selector: IDocumentFilterDto[], metadata: IPasteEditProviderMetadataDto): void {\n\t\tconst provider = new MainThreadPasteEditProvider(handle, this._proxy, metadata, this._uriIdentService);\n\t\tthis._pasteEditProviders.set(handle, provider);\n\t\tthis._registrations.set(handle, combinedDisposable(\n\t\t\tthis._languageFeaturesService.documentPasteEditProvider.register(selector, provider),\n\t\t\ttoDisposable(() => this._pasteEditProviders.delete(handle)),\n\t\t));\n\t}\n\n\t$resolvePasteFileData(handle: number, requestId: number, dataId: string): Promise<VSBuffer> {\n\t\tconst provider = this._pasteEditProviders.get(handle);\n\t\tif (!provider) {\n\t\t\tthrow new Error('Could not find provider');\n\t\t}\n\t\treturn provider.resolveFileData(requestId, dataId);\n\t}\n\n\t// --- formatting\n\n\t$registerDocumentFormattingSupport(handle: number, selector: IDocumentFilterDto[], extensionId: ExtensionIdentifier, displayName: string): void {\n\t\tthis._registrations.set(handle, this._languageFeaturesService.documentFormattingEditProvider.register(selector, {\n\t\t\textensionId,\n\t\t\tdisplayName,\n\t\t\tprovideDocumentFormattingEdits: (model: ITextModel, options: languages.FormattingOptions, token: CancellationToken): Promise<languages.TextEdit[] | undefined> => {\n\t\t\t\treturn this._proxy.$provideDocumentFormattingEdits(handle, model.uri, options, token);\n\t\t\t}\n\t\t}));\n\t}\n\n\t$registerRangeFormattingSupport(handle: number, selector: IDocumentFilterDto[], extensionId: ExtensionIdentifier, displayName: string, supportsRanges: boolean): void {\n\t\tthis._registrations.set(handle, this._languageFeaturesService.documentRangeFormattingEditProvider.register(selector, {\n\t\t\textensionId,\n\t\t\tdisplayName,\n\t\t\tprovideDocumentRangeFormattingEdits: (model: ITextModel, range: EditorRange, options: languages.FormattingOptions, token: CancellationToken): Promise<languages.TextEdit[] | undefined> => {\n\t\t\t\treturn this._proxy.$provideDocumentRangeFormattingEdits(handle, model.uri, range, options, token);\n\t\t\t},\n\t\t\tprovideDocumentRangesFormattingEdits: !supportsRanges\n\t\t\t\t? undefined\n\t\t\t\t: (model, ranges, options, token) => {\n\t\t\t\t\treturn this._proxy.$provideDocumentRangesFormattingEdits(handle, model.uri, ranges, options, token);\n\t\t\t\t},\n\t\t}));\n\t}\n\n\t$registerOnTypeFormattingSupport(handle: number, selector: IDocumentFilterDto[], autoFormatTriggerCharacters: string[], extensionId: ExtensionIdentifier): void {\n\t\tthis._registrations.set(handle, this._languageFeaturesService.onTypeFormattingEditProvider.register(selector, {\n\t\t\textensionId,\n\t\t\tautoFormatTriggerCharacters,\n\t\t\tprovideOnTypeFormattingEdits: (model: ITextModel, position: EditorPosition, ch: string, options: languages.FormattingOptions, token: CancellationToken): Promise<languages.TextEdit[] | undefined> => {\n\t\t\t\treturn this._proxy.$provideOnTypeFormattingEdits(handle, model.uri, position, ch, options, token);\n\t\t\t}\n\t\t}));\n\t}\n\n\t// --- navigate type\n\n\t$registerNavigateTypeSupport(handle: number, supportsResolve: boolean): void {\n\t\tlet lastResultId: number | undefined;\n\n\t\tconst provider: search.IWorkspaceSymbolProvider = {\n\t\t\tprovideWorkspaceSymbols: async (search: string, token: CancellationToken): Promise<search.IWorkspaceSymbol[]> => {\n\t\t\t\tconst result = await this._proxy.$provideWorkspaceSymbols(handle, search, token);\n\t\t\t\tif (lastResultId !== undefined) {\n\t\t\t\t\tthis._proxy.$releaseWorkspaceSymbols(handle, lastResultId);\n\t\t\t\t}\n\t\t\t\tlastResultId = result.cacheId;\n\t\t\t\treturn MainThreadLanguageFeatures._reviveWorkspaceSymbolDto(result.symbols);\n\t\t\t}\n\t\t};\n\t\tif (supportsResolve) {\n\t\t\tprovider.resolveWorkspaceSymbol = async (item: search.IWorkspaceSymbol, token: CancellationToken): Promise<search.IWorkspaceSymbol | undefined> => {\n\t\t\t\tconst resolvedItem = await this._proxy.$resolveWorkspaceSymbol(handle, item, token);\n\t\t\t\treturn resolvedItem && MainThreadLanguageFeatures._reviveWorkspaceSymbolDto(resolvedItem);\n\t\t\t};\n\t\t}\n\t\tthis._registrations.set(handle, search.WorkspaceSymbolProviderRegistry.register(provider));\n\t}\n\n\t// --- rename\n\n\t$registerRenameSupport(handle: number, selector: IDocumentFilterDto[], supportResolveLocation: boolean): void {\n\t\tthis._registrations.set(handle, this._languageFeaturesService.renameProvider.register(selector, {\n\t\t\tprovideRenameEdits: (model: ITextModel, position: EditorPosition, newName: string, token: CancellationToken) => {\n\t\t\t\treturn this._proxy.$provideRenameEdits(handle, model.uri, position, newName, token).then(data => reviveWorkspaceEditDto(data, this._uriIdentService));\n\t\t\t},\n\t\t\tresolveRenameLocation: supportResolveLocation\n\t\t\t\t? (model: ITextModel, position: EditorPosition, token: CancellationToken): Promise<languages.RenameLocation | undefined> => this._proxy.$resolveRenameLocation(handle, model.uri, position, token)\n\t\t\t\t: undefined\n\t\t}));\n\t}\n\n\t$registerNewSymbolNamesProvider(handle: number, selector: IDocumentFilterDto[]): void {\n\t\tthis._registrations.set(handle, this._languageFeaturesService.newSymbolNamesProvider.register(selector, {\n\t\t\tsupportsAutomaticNewSymbolNamesTriggerKind: this._proxy.$supportsAutomaticNewSymbolNamesTriggerKind(handle),\n\t\t\tprovideNewSymbolNames: (model: ITextModel, range: IRange, triggerKind: languages.NewSymbolNameTriggerKind, token: CancellationToken): Promise<languages.NewSymbolName[] | undefined> => {\n\t\t\t\treturn this._proxy.$provideNewSymbolNames(handle, model.uri, range, triggerKind, token);\n\t\t\t}\n\t\t} satisfies languages.NewSymbolNamesProvider));\n\t}\n\n\t// --- semantic tokens\n\n\t$registerDocumentSemanticTokensProvider(handle: number, selector: IDocumentFilterDto[], legend: languages.SemanticTokensLegend, eventHandle: number | undefined): void {\n\t\tlet event: Event<void> | undefined = undefined;\n\t\tif (typeof eventHandle === 'number') {\n\t\t\tconst emitter = new Emitter<void>();\n\t\t\tthis._registrations.set(eventHandle, emitter);\n\t\t\tevent = emitter.event;\n\t\t}\n\t\tthis._registrations.set(handle, this._languageFeaturesService.documentSemanticTokensProvider.register(selector, new MainThreadDocumentSemanticTokensProvider(this._proxy, handle, legend, event)));\n\t}\n\n\t$emitDocumentSemanticTokensEvent(eventHandle: number): void {\n\t\tconst obj = this._registrations.get(eventHandle);\n\t\tif (obj instanceof Emitter) {\n\t\t\tobj.fire(undefined);\n\t\t}\n\t}\n\n\t$emitDocumentRangeSemanticTokensEvent(eventHandle: number): void {\n\t\tconst obj = this._registrations.get(eventHandle);\n\t\tif (obj instanceof Emitter) {\n\t\t\tobj.fire(undefined);\n\t\t}\n\t}\n\n\t$registerDocumentRangeSemanticTokensProvider(handle: number, selector: IDocumentFilterDto[], legend: languages.SemanticTokensLegend, eventHandle: number | undefined): void {\n\t\tlet event: Event<void> | undefined = undefined;\n\t\tif (typeof eventHandle === 'number') {\n\t\t\tconst emitter = new Emitter<void>();\n\t\t\tthis._registrations.set(eventHandle, emitter);\n\t\t\tevent = emitter.event;\n\t\t}\n\t\tthis._registrations.set(handle, this._languageFeaturesService.documentRangeSemanticTokensProvider.register(selector, new MainThreadDocumentRangeSemanticTokensProvider(this._proxy, handle, legend, event)));\n\t}\n\n\t// --- suggest\n\n\tprivate static _inflateSuggestDto(defaultRange: IRange | { insert: IRange; replace: IRange }, data: ISuggestDataDto, extensionId: ExtensionIdentifier): languages.CompletionItem {\n\n\t\tconst label = data[ISuggestDataDtoField.label];\n\t\tconst commandId = data[ISuggestDataDtoField.commandId];\n\t\tconst commandIdent = data[ISuggestDataDtoField.commandIdent];\n\t\tconst commitChars = data[ISuggestDataDtoField.commitCharacters];\n\n\t\ttype IdentCommand = languages.Command & { $ident: string | undefined };\n\n\t\tlet command: IdentCommand | undefined;\n\t\tif (commandId) {\n\t\t\tcommand = {\n\t\t\t\t$ident: commandIdent,\n\t\t\t\tid: commandId,\n\t\t\t\ttitle: '',\n\t\t\t\targuments: commandIdent ? [commandIdent] : data[ISuggestDataDtoField.commandArguments], // Automatically fill in ident as first argument\n\t\t\t};\n\t\t}\n\n\t\treturn {\n\t\t\tlabel,\n\t\t\textensionId,\n\t\t\tkind: data[ISuggestDataDtoField.kind] ?? languages.CompletionItemKind.Property,\n\t\t\ttags: data[ISuggestDataDtoField.kindModifier],\n\t\t\tdetail: data[ISuggestDataDtoField.detail],\n\t\t\tdocumentation: data[ISuggestDataDtoField.documentation],\n\t\t\tsortText: data[ISuggestDataDtoField.sortText],\n\t\t\tfilterText: data[ISuggestDataDtoField.filterText],\n\t\t\tpreselect: data[ISuggestDataDtoField.preselect],\n\t\t\tinsertText: data[ISuggestDataDtoField.insertText] ?? (typeof label === 'string' ? label : label.label),\n\t\t\trange: data[ISuggestDataDtoField.range] ?? defaultRange,\n\t\t\tinsertTextRules: data[ISuggestDataDtoField.insertTextRules],\n\t\t\tcommitCharacters: commitChars ? Array.from(commitChars) : undefined,\n\t\t\tadditionalTextEdits: data[ISuggestDataDtoField.additionalTextEdits],\n\t\t\tcommand,\n\t\t\t// not-standard\n\t\t\t_id: data.x,\n\t\t};\n\t}\n\n\t$registerCompletionsProvider(handle: number, selector: IDocumentFilterDto[], triggerCharacters: string[], supportsResolveDetails: boolean, extensionId: ExtensionIdentifier): void {\n\t\tconst provider: languages.CompletionItemProvider = {\n\t\t\ttriggerCharacters,\n\t\t\t_debugDisplayName: `${extensionId.value}(${triggerCharacters.join('')})`,\n\t\t\tprovideCompletionItems: async (model: ITextModel, position: EditorPosition, context: languages.CompletionContext, token: CancellationToken): Promise<languages.CompletionList | undefined> => {\n\t\t\t\tconst result = await this._proxy.$provideCompletionItems(handle, model.uri, position, context, token);\n\t\t\t\tif (!result) {\n\t\t\t\t\treturn result;\n\t\t\t\t}\n\t\t\t\treturn {\n\t\t\t\t\tsuggestions: result[ISuggestResultDtoField.completions].map(d => MainThreadLanguageFeatures._inflateSuggestDto(result[ISuggestResultDtoField.defaultRanges], d, extensionId)),\n\t\t\t\t\tincomplete: result[ISuggestResultDtoField.isIncomplete] || false,\n\t\t\t\t\tduration: result[ISuggestResultDtoField.duration],\n\t\t\t\t\tdispose: () => {\n\t\t\t\t\t\tif (typeof result.x === 'number') {\n\t\t\t\t\t\t\tthis._proxy.$releaseCompletionItems(handle, result.x);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t}\n\t\t};\n\t\tif (supportsResolveDetails) {\n\t\t\tprovider.resolveCompletionItem = (suggestion, token) => {\n\t\t\t\treturn this._proxy.$resolveCompletionItem(handle, suggestion._id!, token).then(result => {\n\t\t\t\t\tif (!result) {\n\t\t\t\t\t\treturn suggestion;\n\t\t\t\t\t}\n\n\t\t\t\t\tconst newSuggestion = MainThreadLanguageFeatures._inflateSuggestDto(suggestion.range, result, extensionId);\n\t\t\t\t\treturn mixin(suggestion, newSuggestion, true);\n\t\t\t\t});\n\t\t\t};\n\t\t}\n\t\tthis._registrations.set(handle, this._languageFeaturesService.completionProvider.register(selector, provider));\n\t}\n\n\t$registerInlineCompletionsSupport(handle: number, selector: IDocumentFilterDto[], supportsHandleEvents: boolean, extensionId: string, extensionVersion: string, groupId: string | undefined, yieldsToExtensionIds: string[], displayName: string | undefined, debounceDelayMs: number | undefined, excludesExtensionIds: string[], eventHandle: number | undefined): void {\n\t\tconst providerId = new languages.ProviderId(extensionId, extensionVersion, groupId);\n\t\tconst provider: languages.InlineCompletionsProvider<IdentifiableInlineCompletions> = {\n\t\t\tprovideInlineCompletions: async (model: ITextModel, position: EditorPosition, context: languages.InlineCompletionContext, token: CancellationToken): Promise<IdentifiableInlineCompletions | undefined> => {\n\t\t\t\tconst result = await this._proxy.$provideInlineCompletions(handle, model.uri, position, context, token);\n\t\t\t\treturn result;\n\t\t\t},\n\t\t\thandleItemDidShow: async (completions: IdentifiableInlineCompletions, item: IdentifiableInlineCompletion, updatedInsertText: string, editDeltaInfo: EditDeltaInfo): Promise<void> => {\n\t\t\t\tif (item.suggestionId === undefined) {\n\t\t\t\t\titem.suggestionId = this._aiEditTelemetryService.createSuggestionId({\n\t\t\t\t\t\tapplyCodeBlockSuggestionId: undefined,\n\t\t\t\t\t\tfeature: 'inlineSuggestion',\n\t\t\t\t\t\tsource: providerId,\n\t\t\t\t\t\tlanguageId: completions.languageId,\n\t\t\t\t\t\teditDeltaInfo: editDeltaInfo,\n\t\t\t\t\t\tmodeId: undefined,\n\t\t\t\t\t\tmodelId: undefined,\n\t\t\t\t\t\tpresentation: item.isInlineEdit ? 'nextEditSuggestion' : 'inlineCompletion',\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tif (supportsHandleEvents) {\n\t\t\t\t\tawait this._proxy.$handleInlineCompletionDidShow(handle, completions.pid, item.idx, updatedInsertText);\n\t\t\t\t}\n\t\t\t},\n\t\t\thandlePartialAccept: async (completions, item, acceptedCharacters, info: languages.PartialAcceptInfo): Promise<void> => {\n\t\t\t\tif (supportsHandleEvents) {\n\t\t\t\t\tawait this._proxy.$handleInlineCompletionPartialAccept(handle, completions.pid, item.idx, acceptedCharacters, info);\n\t\t\t\t}\n\t\t\t},\n\t\t\thandleEndOfLifetime: async (completions, item, reason, lifetimeSummary) => {\n\n\t\t\t\tfunction mapReason<T1, T2>(reason: languages.InlineCompletionEndOfLifeReason<T1>, f: (reason: T1) => T2): languages.InlineCompletionEndOfLifeReason<T2> {\n\t\t\t\t\tif (reason.kind === languages.InlineCompletionEndOfLifeReasonKind.Ignored) {\n\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\t...reason,\n\t\t\t\t\t\t\tsupersededBy: reason.supersededBy ? f(reason.supersededBy) : undefined,\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\t\t\t\t\treturn reason;\n\t\t\t\t}\n\n\t\t\t\tif (supportsHandleEvents) {\n\t\t\t\t\tawait this._proxy.$handleInlineCompletionEndOfLifetime(handle, completions.pid, item.idx, mapReason(reason, i => ({ pid: completions.pid, idx: i.idx })));\n\t\t\t\t}\n\n\t\t\t\tif (reason.kind === languages.InlineCompletionEndOfLifeReasonKind.Accepted) {\n\t\t\t\t\tif (item.suggestionId !== undefined) {\n\t\t\t\t\t\tthis._aiEditTelemetryService.handleCodeAccepted({\n\t\t\t\t\t\t\tsuggestionId: item.suggestionId,\n\t\t\t\t\t\t\tfeature: 'inlineSuggestion',\n\t\t\t\t\t\t\tsource: providerId,\n\t\t\t\t\t\t\tlanguageId: completions.languageId,\n\t\t\t\t\t\t\teditDeltaInfo: EditDeltaInfo.tryCreate(\n\t\t\t\t\t\t\t\tlifetimeSummary.lineCountModified,\n\t\t\t\t\t\t\t\tlifetimeSummary.lineCountOriginal,\n\t\t\t\t\t\t\t\tlifetimeSummary.characterCountModified,\n\t\t\t\t\t\t\t\tlifetimeSummary.characterCountOriginal,\n\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\tmodeId: undefined,\n\t\t\t\t\t\t\tmodelId: undefined,\n\t\t\t\t\t\t\tpresentation: item.isInlineEdit ? 'nextEditSuggestion' : 'inlineCompletion',\n\t\t\t\t\t\t\tacceptanceMethod: 'accept',\n\t\t\t\t\t\t\tapplyCodeBlockSuggestionId: undefined,\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tconst endOfLifeSummary: InlineCompletionEndOfLifeEvent = {\n\t\t\t\t\topportunityId: lifetimeSummary.requestUuid,\n\t\t\t\t\tcorrelationId: lifetimeSummary.correlationId,\n\t\t\t\t\tshown: lifetimeSummary.shown,\n\t\t\t\t\tshownDuration: lifetimeSummary.shownDuration,\n\t\t\t\t\tshownDurationUncollapsed: lifetimeSummary.shownDurationUncollapsed,\n\t\t\t\t\ttimeUntilShown: lifetimeSummary.timeUntilShown,\n\t\t\t\t\ttimeUntilProviderRequest: lifetimeSummary.timeUntilProviderRequest,\n\t\t\t\t\ttimeUntilProviderResponse: lifetimeSummary.timeUntilProviderResponse,\n\t\t\t\t\teditorType: lifetimeSummary.editorType,\n\t\t\t\t\tviewKind: lifetimeSummary.viewKind,\n\t\t\t\t\tpreceeded: lifetimeSummary.preceeded,\n\t\t\t\t\trequestReason: lifetimeSummary.requestReason,\n\t\t\t\t\ttypingInterval: lifetimeSummary.typingInterval,\n\t\t\t\t\ttypingIntervalCharacterCount: lifetimeSummary.typingIntervalCharacterCount,\n\t\t\t\t\tlanguageId: lifetimeSummary.languageId,\n\t\t\t\t\tcursorColumnDistance: lifetimeSummary.cursorColumnDistance,\n\t\t\t\t\tcursorLineDistance: lifetimeSummary.cursorLineDistance,\n\t\t\t\t\tlineCountOriginal: lifetimeSummary.lineCountOriginal,\n\t\t\t\t\tlineCountModified: lifetimeSummary.lineCountModified,\n\t\t\t\t\tcharacterCountOriginal: lifetimeSummary.characterCountOriginal,\n\t\t\t\t\tcharacterCountModified: lifetimeSummary.characterCountModified,\n\t\t\t\t\tdisjointReplacements: lifetimeSummary.disjointReplacements,\n\t\t\t\t\tsameShapeReplacements: lifetimeSummary.sameShapeReplacements,\n\t\t\t\t\tselectedSuggestionInfo: lifetimeSummary.selectedSuggestionInfo,\n\t\t\t\t\textensionId,\n\t\t\t\t\textensionVersion,\n\t\t\t\t\tgroupId,\n\t\t\t\t\tavailableProviders: lifetimeSummary.availableProviders,\n\t\t\t\t\tpartiallyAccepted: lifetimeSummary.partiallyAccepted,\n\t\t\t\t\tpartiallyAcceptedCountSinceOriginal: lifetimeSummary.partiallyAcceptedCountSinceOriginal,\n\t\t\t\t\tpartiallyAcceptedRatioSinceOriginal: lifetimeSummary.partiallyAcceptedRatioSinceOriginal,\n\t\t\t\t\tpartiallyAcceptedCharactersSinceOriginal: lifetimeSummary.partiallyAcceptedCharactersSinceOriginal,\n\t\t\t\t\tsuperseded: reason.kind === InlineCompletionEndOfLifeReasonKind.Ignored && !!reason.supersededBy,\n\t\t\t\t\treason: reason.kind === InlineCompletionEndOfLifeReasonKind.Accepted ? 'accepted'\n\t\t\t\t\t\t: reason.kind === InlineCompletionEndOfLifeReasonKind.Rejected ? 'rejected'\n\t\t\t\t\t\t\t: reason.kind === InlineCompletionEndOfLifeReasonKind.Ignored ? 'ignored' : undefined,\n\t\t\t\t\tnoSuggestionReason: undefined,\n\t\t\t\t\tnotShownReason: lifetimeSummary.notShownReason,\n\t\t\t\t\t...forwardToChannelIf(isCopilotLikeExtension(extensionId)),\n\t\t\t\t};\n\n\t\t\t\tconst dataChannelForwardingTelemetryService = this._instantiationService.createInstance(DataChannelForwardingTelemetryService);\n\t\t\t\tsendInlineCompletionsEndOfLifeTelemetry(dataChannelForwardingTelemetryService, endOfLifeSummary);\n\t\t\t},\n\t\t\tdisposeInlineCompletions: (completions: IdentifiableInlineCompletions, reason: languages.InlineCompletionsDisposeReason): void => {\n\t\t\t\tthis._proxy.$freeInlineCompletionsList(handle, completions.pid, reason);\n\t\t\t},\n\t\t\thandleRejection: async (completions, item): Promise<void> => {\n\t\t\t\tif (supportsHandleEvents) {\n\t\t\t\t\tawait this._proxy.$handleInlineCompletionRejection(handle, completions.pid, item.idx);\n\t\t\t\t}\n\t\t\t},\n\t\t\tgroupId: groupId ?? extensionId,\n\t\t\tproviderId,\n\t\t\tyieldsToGroupIds: yieldsToExtensionIds,\n\t\t\texcludesGroupIds: excludesExtensionIds,\n\t\t\tdebounceDelayMs,\n\t\t\tdisplayName,\n\t\t\ttoString() {\n\t\t\t\treturn `InlineCompletionsProvider(${extensionId})`;\n\t\t\t},\n\t\t};\n\t\tif (typeof eventHandle === 'number') {\n\t\t\tconst emitter = new Emitter<void>();\n\t\t\tthis._registrations.set(eventHandle, emitter);\n\t\t\tprovider.onDidChangeInlineCompletions = emitter.event;\n\t\t}\n\t\tthis._registrations.set(handle, this._languageFeaturesService.inlineCompletionsProvider.register(selector, provider));\n\t}\n\n\t$emitInlineCompletionsChange(handle: number): void {\n\t\tconst obj = this._registrations.get(handle);\n\t\tif (obj instanceof Emitter) {\n\t\t\tobj.fire(undefined);\n\t\t}\n\t}\n\n\t// --- parameter hints\n\n\t$registerSignatureHelpProvider(handle: number, selector: IDocumentFilterDto[], metadata: ISignatureHelpProviderMetadataDto): void {\n\t\tthis._registrations.set(handle, this._languageFeaturesService.signatureHelpProvider.register(selector, {\n\n\t\t\tsignatureHelpTriggerCharacters: metadata.triggerCharacters,\n\t\t\tsignatureHelpRetriggerCharacters: metadata.retriggerCharacters,\n\n\t\t\tprovideSignatureHelp: async (model: ITextModel, position: EditorPosition, token: CancellationToken, context: languages.SignatureHelpContext): Promise<languages.SignatureHelpResult | undefined> => {\n\t\t\t\tconst result = await this._proxy.$provideSignatureHelp(handle, model.uri, position, context, token);\n\t\t\t\tif (!result) {\n\t\t\t\t\treturn undefined;\n\t\t\t\t}\n\t\t\t\treturn {\n\t\t\t\t\tvalue: result,\n\t\t\t\t\tdispose: () => {\n\t\t\t\t\t\tthis._proxy.$releaseSignatureHelp(handle, result.id);\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t}\n\t\t}));\n\t}\n\n\t// --- inline hints\n\n\t$registerInlayHintsProvider(handle: number, selector: IDocumentFilterDto[], supportsResolve: boolean, eventHandle: number | undefined, displayName: string | undefined): void {\n\t\tconst provider: languages.InlayHintsProvider = {\n\t\t\tdisplayName,\n\t\t\tprovideInlayHints: async (model: ITextModel, range: EditorRange, token: CancellationToken): Promise<languages.InlayHintList | undefined> => {\n\t\t\t\tconst result = await this._proxy.$provideInlayHints(handle, model.uri, range, token);\n\t\t\t\tif (!result) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\treturn {\n\t\t\t\t\thints: revive(result.hints),\n\t\t\t\t\tdispose: () => {\n\t\t\t\t\t\tif (result.cacheId) {\n\t\t\t\t\t\t\tthis._proxy.$releaseInlayHints(handle, result.cacheId);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t}\n\t\t};\n\t\tif (supportsResolve) {\n\t\t\tprovider.resolveInlayHint = async (hint, token) => {\n\t\t\t\tconst dto: IInlayHintDto = hint;\n\t\t\t\tif (!dto.cacheId) {\n\t\t\t\t\treturn hint;\n\t\t\t\t}\n\t\t\t\tconst result = await this._proxy.$resolveInlayHint(handle, dto.cacheId, token);\n\t\t\t\tif (token.isCancellationRequested) {\n\t\t\t\t\tthrow new CancellationError();\n\t\t\t\t}\n\t\t\t\tif (!result) {\n\t\t\t\t\treturn hint;\n\t\t\t\t}\n\t\t\t\treturn {\n\t\t\t\t\t...hint,\n\t\t\t\t\ttooltip: result.tooltip,\n\t\t\t\t\tlabel: revive<string | languages.InlayHintLabelPart[]>(result.label),\n\t\t\t\t\ttextEdits: result.textEdits\n\t\t\t\t};\n\t\t\t};\n\t\t}\n\t\tif (typeof eventHandle === 'number') {\n\t\t\tconst emitter = new Emitter<void>();\n\t\t\tthis._registrations.set(eventHandle, emitter);\n\t\t\tprovider.onDidChangeInlayHints = emitter.event;\n\t\t}\n\n\t\tthis._registrations.set(handle, this._languageFeaturesService.inlayHintsProvider.register(selector, provider));\n\t}\n\n\t$emitInlayHintsEvent(eventHandle: number): void {\n\t\tconst obj = this._registrations.get(eventHandle);\n\t\tif (obj instanceof Emitter) {\n\t\t\tobj.fire(undefined);\n\t\t}\n\t}\n\n\t// --- links\n\n\t$registerDocumentLinkProvider(handle: number, selector: IDocumentFilterDto[], supportsResolve: boolean): void {\n\t\tconst provider: languages.LinkProvider = {\n\t\t\tprovideLinks: (model, token) => {\n\t\t\t\treturn this._proxy.$provideDocumentLinks(handle, model.uri, token).then(dto => {\n\t\t\t\t\tif (!dto) {\n\t\t\t\t\t\treturn undefined;\n\t\t\t\t\t}\n\t\t\t\t\treturn {\n\t\t\t\t\t\tlinks: dto.links.map(MainThreadLanguageFeatures._reviveLinkDTO),\n\t\t\t\t\t\tdispose: () => {\n\t\t\t\t\t\t\tif (typeof dto.cacheId === 'number') {\n\t\t\t\t\t\t\t\tthis._proxy.$releaseDocumentLinks(handle, dto.cacheId);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\t\t\t\t});\n\t\t\t}\n\t\t};\n\t\tif (supportsResolve) {\n\t\t\tprovider.resolveLink = (link, token) => {\n\t\t\t\tconst dto: ILinkDto = link;\n\t\t\t\tif (!dto.cacheId) {\n\t\t\t\t\treturn link;\n\t\t\t\t}\n\t\t\t\treturn this._proxy.$resolveDocumentLink(handle, dto.cacheId, token).then(obj => {\n\t\t\t\t\treturn obj && MainThreadLanguageFeatures._reviveLinkDTO(obj);\n\t\t\t\t});\n\t\t\t};\n\t\t}\n\t\tthis._registrations.set(handle, this._languageFeaturesService.linkProvider.register(selector, provider));\n\t}\n\n\t// --- colors\n\n\t$registerDocumentColorProvider(handle: number, selector: IDocumentFilterDto[]): void {\n\t\tconst proxy = this._proxy;\n\t\tthis._registrations.set(handle, this._languageFeaturesService.colorProvider.register(selector, {\n\t\t\tprovideDocumentColors: (model, token) => {\n\t\t\t\treturn proxy.$provideDocumentColors(handle, model.uri, token)\n\t\t\t\t\t.then(documentColors => {\n\t\t\t\t\t\treturn documentColors.map(documentColor => {\n\t\t\t\t\t\t\tconst [red, green, blue, alpha] = documentColor.color;\n\t\t\t\t\t\t\tconst color = {\n\t\t\t\t\t\t\t\tred: red,\n\t\t\t\t\t\t\t\tgreen: green,\n\t\t\t\t\t\t\t\tblue: blue,\n\t\t\t\t\t\t\t\talpha\n\t\t\t\t\t\t\t};\n\n\t\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\t\tcolor,\n\t\t\t\t\t\t\t\trange: documentColor.range\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t},\n\n\t\t\tprovideColorPresentations: (model, colorInfo, token) => {\n\t\t\t\treturn proxy.$provideColorPresentations(handle, model.uri, {\n\t\t\t\t\tcolor: [colorInfo.color.red, colorInfo.color.green, colorInfo.color.blue, colorInfo.color.alpha],\n\t\t\t\t\trange: colorInfo.range\n\t\t\t\t}, token);\n\t\t\t}\n\t\t}));\n\t}\n\n\t// --- folding\n\n\t$registerFoldingRangeProvider(handle: number, selector: IDocumentFilterDto[], extensionId: ExtensionIdentifier, eventHandle: number | undefined): void {\n\t\tconst provider: languages.FoldingRangeProvider = {\n\t\t\tid: extensionId.value,\n\t\t\tprovideFoldingRanges: (model, context, token) => {\n\t\t\t\treturn this._proxy.$provideFoldingRanges(handle, model.uri, context, token);\n\t\t\t}\n\t\t};\n\n\t\tif (typeof eventHandle === 'number') {\n\t\t\tconst emitter = new Emitter<languages.FoldingRangeProvider>();\n\t\t\tthis._registrations.set(eventHandle, emitter);\n\t\t\tprovider.onDidChange = emitter.event;\n\t\t}\n\n\t\tthis._registrations.set(handle, this._languageFeaturesService.foldingRangeProvider.register(selector, provider));\n\t}\n\n\t$emitFoldingRangeEvent(eventHandle: number, event?: unknown): void {\n\t\tconst obj = this._registrations.get(eventHandle);\n\t\tif (obj instanceof Emitter) {\n\t\t\tobj.fire(event);\n\t\t}\n\t}\n\n\t// -- smart select\n\n\t$registerSelectionRangeProvider(handle: number, selector: IDocumentFilterDto[]): void {\n\t\tthis._registrations.set(handle, this._languageFeaturesService.selectionRangeProvider.register(selector, {\n\t\t\tprovideSelectionRanges: (model, positions, token) => {\n\t\t\t\treturn this._proxy.$provideSelectionRanges(handle, model.uri, positions, token);\n\t\t\t}\n\t\t}));\n\t}\n\n\t// --- call hierarchy\n\n\t$registerCallHierarchyProvider(handle: number, selector: IDocumentFilterDto[]): void {\n\t\tthis._registrations.set(handle, callh.CallHierarchyProviderRegistry.register(selector, {\n\n\t\t\tprepareCallHierarchy: async (document, position, token) => {\n\t\t\t\tconst items = await this._proxy.$prepareCallHierarchy(handle, document.uri, position, token);\n\t\t\t\tif (!items || items.length === 0) {\n\t\t\t\t\treturn undefined;\n\t\t\t\t}\n\t\t\t\treturn {\n\t\t\t\t\tdispose: () => {\n\t\t\t\t\t\tfor (const item of items) {\n\t\t\t\t\t\t\tthis._proxy.$releaseCallHierarchy(handle, item._sessionId);\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\troots: items.map(MainThreadLanguageFeatures._reviveCallHierarchyItemDto)\n\t\t\t\t};\n\t\t\t},\n\n\t\t\tprovideOutgoingCalls: async (item, token) => {\n\t\t\t\tconst outgoing = await this._proxy.$provideCallHierarchyOutgoingCalls(handle, item._sessionId, item._itemId, token);\n\t\t\t\tif (!outgoing) {\n\t\t\t\t\treturn outgoing;\n\t\t\t\t}\n\t\t\t\toutgoing.forEach(value => {\n\t\t\t\t\tvalue.to = MainThreadLanguageFeatures._reviveCallHierarchyItemDto(value.to);\n\t\t\t\t});\n\t\t\t\t// eslint-disable-next-line local/code-no-any-casts, @typescript-eslint/no-explicit-any\n\t\t\t\treturn <any>outgoing;\n\t\t\t},\n\t\t\tprovideIncomingCalls: async (item, token) => {\n\t\t\t\tconst incoming = await this._proxy.$provideCallHierarchyIncomingCalls(handle, item._sessionId, item._itemId, token);\n\t\t\t\tif (!incoming) {\n\t\t\t\t\treturn incoming;\n\t\t\t\t}\n\t\t\t\tincoming.forEach(value => {\n\t\t\t\t\tvalue.from = MainThreadLanguageFeatures._reviveCallHierarchyItemDto(value.from);\n\t\t\t\t});\n\t\t\t\t// eslint-disable-next-line local/code-no-any-casts, @typescript-eslint/no-explicit-any\n\t\t\t\treturn <any>incoming;\n\t\t\t}\n\t\t}));\n\t}\n\n\t// --- configuration\n\n\tprivate static _reviveRegExp(regExp: IRegExpDto): RegExp {\n\t\treturn new RegExp(regExp.pattern, regExp.flags);\n\t}\n\n\tprivate static _reviveIndentationRule(indentationRule: IIndentationRuleDto): IndentationRule {\n\t\treturn {\n\t\t\tdecreaseIndentPattern: MainThreadLanguageFeatures._reviveRegExp(indentationRule.decreaseIndentPattern),\n\t\t\tincreaseIndentPattern: MainThreadLanguageFeatures._reviveRegExp(indentationRule.increaseIndentPattern),\n\t\t\tindentNextLinePattern: indentationRule.indentNextLinePattern ? MainThreadLanguageFeatures._reviveRegExp(indentationRule.indentNextLinePattern) : undefined,\n\t\t\tunIndentedLinePattern: indentationRule.unIndentedLinePattern ? MainThreadLanguageFeatures._reviveRegExp(indentationRule.unIndentedLinePattern) : undefined,\n\t\t};\n\t}\n\n\tprivate static _reviveOnEnterRule(onEnterRule: IOnEnterRuleDto): OnEnterRule {\n\t\treturn {\n\t\t\tbeforeText: MainThreadLanguageFeatures._reviveRegExp(onEnterRule.beforeText),\n\t\t\tafterText: onEnterRule.afterText ? MainThreadLanguageFeatures._reviveRegExp(onEnterRule.afterText) : undefined,\n\t\t\tpreviousLineText: onEnterRule.previousLineText ? MainThreadLanguageFeatures._reviveRegExp(onEnterRule.previousLineText) : undefined,\n\t\t\taction: onEnterRule.action\n\t\t};\n\t}\n\n\tprivate static _reviveOnEnterRules(onEnterRules: IOnEnterRuleDto[]): OnEnterRule[] {\n\t\treturn onEnterRules.map(MainThreadLanguageFeatures._reviveOnEnterRule);\n\t}\n\n\t$setLanguageConfiguration(handle: number, languageId: string, _configuration: ILanguageConfigurationDto): void {\n\n\t\tconst configuration: LanguageConfiguration = {\n\t\t\tcomments: _configuration.comments,\n\t\t\tbrackets: _configuration.brackets,\n\t\t\twordPattern: _configuration.wordPattern ? MainThreadLanguageFeatures._reviveRegExp(_configuration.wordPattern) : undefined,\n\t\t\tindentationRules: _configuration.indentationRules ? MainThreadLanguageFeatures._reviveIndentationRule(_configuration.indentationRules) : undefined,\n\t\t\tonEnterRules: _configuration.onEnterRules ? MainThreadLanguageFeatures._reviveOnEnterRules(_configuration.onEnterRules) : undefined,\n\n\t\t\tautoClosingPairs: undefined,\n\t\t\tsurroundingPairs: undefined,\n\t\t\t__electricCharacterSupport: undefined\n\t\t};\n\n\t\tif (_configuration.autoClosingPairs) {\n\t\t\tconfiguration.autoClosingPairs = _configuration.autoClosingPairs;\n\t\t} else if (_configuration.__characterPairSupport) {\n\t\t\t// backwards compatibility\n\t\t\tconfiguration.autoClosingPairs = _configuration.__characterPairSupport.autoClosingPairs;\n\t\t}\n\n\t\tif (_configuration.__electricCharacterSupport && _configuration.__electricCharacterSupport.docComment) {\n\t\t\tconfiguration.__electricCharacterSupport = {\n\t\t\t\tdocComment: {\n\t\t\t\t\topen: _configuration.__electricCharacterSupport.docComment.open,\n\t\t\t\t\tclose: _configuration.__electricCharacterSupport.docComment.close\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\n\t\tif (this._languageService.isRegisteredLanguageId(languageId)) {\n\t\t\tthis._registrations.set(handle, this._languageConfigurationService.register(languageId, configuration, 100));\n\t\t}\n\t}\n\n\t// --- type hierarchy\n\n\t$registerTypeHierarchyProvider(handle: number, selector: IDocumentFilterDto[]): void {\n\t\tthis._registrations.set(handle, typeh.TypeHierarchyProviderRegistry.register(selector, {\n\n\t\t\tprepareTypeHierarchy: async (document, position, token) => {\n\t\t\t\tconst items = await this._proxy.$prepareTypeHierarchy(handle, document.uri, position, token);\n\t\t\t\tif (!items) {\n\t\t\t\t\treturn undefined;\n\t\t\t\t}\n\t\t\t\treturn {\n\t\t\t\t\tdispose: () => {\n\t\t\t\t\t\tfor (const item of items) {\n\t\t\t\t\t\t\tthis._proxy.$releaseTypeHierarchy(handle, item._sessionId);\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\troots: items.map(MainThreadLanguageFeatures._reviveTypeHierarchyItemDto)\n\t\t\t\t};\n\t\t\t},\n\n\t\t\tprovideSupertypes: async (item, token) => {\n\t\t\t\tconst supertypes = await this._proxy.$provideTypeHierarchySupertypes(handle, item._sessionId, item._itemId, token);\n\t\t\t\tif (!supertypes) {\n\t\t\t\t\treturn supertypes;\n\t\t\t\t}\n\t\t\t\treturn supertypes.map(MainThreadLanguageFeatures._reviveTypeHierarchyItemDto);\n\t\t\t},\n\t\t\tprovideSubtypes: async (item, token) => {\n\t\t\t\tconst subtypes = await this._proxy.$provideTypeHierarchySubtypes(handle, item._sessionId, item._itemId, token);\n\t\t\t\tif (!subtypes) {\n\t\t\t\t\treturn subtypes;\n\t\t\t\t}\n\t\t\t\treturn subtypes.map(MainThreadLanguageFeatures._reviveTypeHierarchyItemDto);\n\t\t\t}\n\t\t}));\n\t}\n\n\n\t// --- document drop Edits\n\n\tprivate readonly _documentOnDropEditProviders = new Map<number, MainThreadDocumentOnDropEditProvider>();\n\n\t$registerDocumentOnDropEditProvider(handle: number, selector: IDocumentFilterDto[], metadata: IDocumentDropEditProviderMetadata): void {\n\t\tconst provider = new MainThreadDocumentOnDropEditProvider(handle, this._proxy, metadata, this._uriIdentService);\n\t\tthis._documentOnDropEditProviders.set(handle, provider);\n\t\tthis._registrations.set(handle, combinedDisposable(\n\t\t\tthis._languageFeaturesService.documentDropEditProvider.register(selector, provider),\n\t\t\ttoDisposable(() => this._documentOnDropEditProviders.delete(handle)),\n\t\t));\n\t}\n\n\tasync $resolveDocumentOnDropFileData(handle: number, requestId: number, dataId: string): Promise<VSBuffer> {\n\t\tconst provider = this._documentOnDropEditProviders.get(handle);\n\t\tif (!provider) {\n\t\t\tthrow new Error('Could not find provider');\n\t\t}\n\t\treturn provider.resolveDocumentOnDropFileData(requestId, dataId);\n\t}\n}\n\nclass MainThreadPasteEditProvider implements languages.DocumentPasteEditProvider {\n\n\tprivate readonly dataTransfers = new DataTransferFileCache();\n\n\tpublic readonly copyMimeTypes: readonly string[];\n\tpublic readonly pasteMimeTypes: readonly string[];\n\tpublic readonly providedPasteEditKinds: readonly HierarchicalKind[];\n\n\treadonly prepareDocumentPaste?: languages.DocumentPasteEditProvider['prepareDocumentPaste'];\n\treadonly provideDocumentPasteEdits?: languages.DocumentPasteEditProvider['provideDocumentPasteEdits'];\n\treadonly resolveDocumentPasteEdit?: languages.DocumentPasteEditProvider['resolveDocumentPasteEdit'];\n\n\tconstructor(\n\t\tprivate readonly _handle: number,\n\t\tprivate readonly _proxy: ExtHostLanguageFeaturesShape,\n\t\tmetadata: IPasteEditProviderMetadataDto,\n\t\t@IUriIdentityService private readonly _uriIdentService: IUriIdentityService\n\t) {\n\t\tthis.copyMimeTypes = metadata.copyMimeTypes ?? [];\n\t\tthis.pasteMimeTypes = metadata.pasteMimeTypes ?? [];\n\t\tthis.providedPasteEditKinds = metadata.providedPasteEditKinds?.map(kind => new HierarchicalKind(kind)) ?? [];\n\n\t\tif (metadata.supportsCopy) {\n\t\t\tthis.prepareDocumentPaste = async (model: ITextModel, selections: readonly IRange[], dataTransfer: IReadonlyVSDataTransfer, token: CancellationToken): Promise<IReadonlyVSDataTransfer | undefined> => {\n\t\t\t\tconst dataTransferDto = await typeConvert.DataTransfer.fromList(dataTransfer);\n\t\t\t\tif (token.isCancellationRequested) {\n\t\t\t\t\treturn undefined;\n\t\t\t\t}\n\n\t\t\t\tconst newDataTransfer = await this._proxy.$prepareDocumentPaste(_handle, model.uri, selections, dataTransferDto, token);\n\t\t\t\tif (!newDataTransfer) {\n\t\t\t\t\treturn undefined;\n\t\t\t\t}\n\n\t\t\t\tconst dataTransferOut = new VSDataTransfer();\n\t\t\t\tfor (const [type, item] of newDataTransfer.items) {\n\t\t\t\t\tdataTransferOut.replace(type, createStringDataTransferItem(item.asString, item.id));\n\t\t\t\t}\n\t\t\t\treturn dataTransferOut;\n\t\t\t};\n\t\t}\n\n\t\tif (metadata.supportsPaste) {\n\t\t\tthis.provideDocumentPasteEdits = async (model: ITextModel, selections: Selection[], dataTransfer: IReadonlyVSDataTransfer, context: languages.DocumentPasteContext, token: CancellationToken) => {\n\t\t\t\tconst request = this.dataTransfers.add(dataTransfer);\n\t\t\t\ttry {\n\t\t\t\t\tconst dataTransferDto = await typeConvert.DataTransfer.fromList(dataTransfer);\n\t\t\t\t\tif (token.isCancellationRequested) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tconst edits = await this._proxy.$providePasteEdits(this._handle, request.id, model.uri, selections, dataTransferDto, {\n\t\t\t\t\t\tonly: context.only?.value,\n\t\t\t\t\t\ttriggerKind: context.triggerKind,\n\t\t\t\t\t}, token);\n\t\t\t\t\tif (!edits) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn {\n\t\t\t\t\t\tedits: edits.map((edit): languages.DocumentPasteEdit => {\n\t\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\t\t...edit,\n\t\t\t\t\t\t\t\tkind: edit.kind ? new HierarchicalKind(edit.kind.value) : new HierarchicalKind(''),\n\t\t\t\t\t\t\t\tyieldTo: edit.yieldTo?.map(x => ({ kind: new HierarchicalKind(x) })),\n\t\t\t\t\t\t\t\tadditionalEdit: edit.additionalEdit ? reviveWorkspaceEditDto(edit.additionalEdit, this._uriIdentService, dataId => this.resolveFileData(request.id, dataId)) : undefined,\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tdispose: () => {\n\t\t\t\t\t\t\tthis._proxy.$releasePasteEdits(this._handle, request.id);\n\t\t\t\t\t\t},\n\t\t\t\t\t};\n\t\t\t\t} finally {\n\t\t\t\t\trequest.dispose();\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\t\tif (metadata.supportsResolve) {\n\t\t\tthis.resolveDocumentPasteEdit = async (edit: languages.DocumentPasteEdit, token: CancellationToken) => {\n\t\t\t\tconst resolved = await this._proxy.$resolvePasteEdit(this._handle, (<IPasteEditDto>edit)._cacheId!, token);\n\t\t\t\tif (typeof resolved.insertText !== 'undefined') {\n\t\t\t\t\tedit.insertText = resolved.insertText;\n\t\t\t\t}\n\n\t\t\t\tif (resolved.additionalEdit) {\n\t\t\t\t\tedit.additionalEdit = reviveWorkspaceEditDto(resolved.additionalEdit, this._uriIdentService);\n\t\t\t\t}\n\t\t\t\treturn edit;\n\t\t\t};\n\t\t}\n\t}\n\n\tresolveFileData(requestId: number, dataId: string): Promise<VSBuffer> {\n\t\treturn this.dataTransfers.resolveFileData(requestId, dataId);\n\t}\n}\n\nclass MainThreadDocumentOnDropEditProvider implements languages.DocumentDropEditProvider {\n\n\tprivate readonly dataTransfers = new DataTransferFileCache();\n\n\treadonly dropMimeTypes?: readonly string[];\n\n\treadonly providedDropEditKinds: readonly HierarchicalKind[] | undefined;\n\n\treadonly resolveDocumentDropEdit?: languages.DocumentDropEditProvider['resolveDocumentDropEdit'];\n\n\tconstructor(\n\t\tprivate readonly _handle: number,\n\t\tprivate readonly _proxy: ExtHostLanguageFeaturesShape,\n\t\tmetadata: IDocumentDropEditProviderMetadata | undefined,\n\t\t@IUriIdentityService private readonly _uriIdentService: IUriIdentityService\n\t) {\n\t\tthis.dropMimeTypes = metadata?.dropMimeTypes ?? ['*/*'];\n\t\tthis.providedDropEditKinds = metadata?.providedDropKinds?.map(kind => new HierarchicalKind(kind));\n\n\t\tif (metadata?.supportsResolve) {\n\t\t\tthis.resolveDocumentDropEdit = async (edit, token) => {\n\t\t\t\tconst resolved = await this._proxy.$resolvePasteEdit(this._handle, (<IDocumentDropEditDto>edit)._cacheId!, token);\n\t\t\t\tif (resolved.additionalEdit) {\n\t\t\t\t\tedit.additionalEdit = reviveWorkspaceEditDto(resolved.additionalEdit, this._uriIdentService);\n\t\t\t\t}\n\t\t\t\treturn edit;\n\t\t\t};\n\t\t}\n\t}\n\n\tasync provideDocumentDropEdits(model: ITextModel, position: IPosition, dataTransfer: IReadonlyVSDataTransfer, token: CancellationToken): Promise<languages.DocumentDropEditsSession | undefined> {\n\t\tconst request = this.dataTransfers.add(dataTransfer);\n\t\ttry {\n\t\t\tconst dataTransferDto = await typeConvert.DataTransfer.fromList(dataTransfer);\n\t\t\tif (token.isCancellationRequested) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst edits = await this._proxy.$provideDocumentOnDropEdits(this._handle, request.id, model.uri, position, dataTransferDto, token);\n\t\t\tif (!edits) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\tedits: edits.map(edit => {\n\t\t\t\t\treturn {\n\t\t\t\t\t\t...edit,\n\t\t\t\t\t\tyieldTo: edit.yieldTo?.map(x => ({ kind: new HierarchicalKind(x) })),\n\t\t\t\t\t\tkind: edit.kind ? new HierarchicalKind(edit.kind) : undefined,\n\t\t\t\t\t\tadditionalEdit: reviveWorkspaceEditDto(edit.additionalEdit, this._uriIdentService, dataId => this.resolveDocumentOnDropFileData(request.id, dataId)),\n\t\t\t\t\t};\n\t\t\t\t}),\n\t\t\t\tdispose: () => {\n\t\t\t\t\tthis._proxy.$releaseDocumentOnDropEdits(this._handle, request.id);\n\t\t\t\t},\n\t\t\t};\n\t\t} finally {\n\t\t\trequest.dispose();\n\t\t}\n\t}\n\n\tpublic resolveDocumentOnDropFileData(requestId: number, dataId: string): Promise<VSBuffer> {\n\t\treturn this.dataTransfers.resolveFileData(requestId, dataId);\n\t}\n}\n\nexport class MainThreadDocumentSemanticTokensProvider implements languages.DocumentSemanticTokensProvider {\n\n\tconstructor(\n\t\tprivate readonly _proxy: ExtHostLanguageFeaturesShape,\n\t\tprivate readonly _handle: number,\n\t\tprivate readonly _legend: languages.SemanticTokensLegend,\n\t\tpublic readonly onDidChange: Event<void> | undefined,\n\t) {\n\t}\n\n\tpublic releaseDocumentSemanticTokens(resultId: string | undefined): void {\n\t\tif (resultId) {\n\t\t\tthis._proxy.$releaseDocumentSemanticTokens(this._handle, parseInt(resultId, 10));\n\t\t}\n\t}\n\n\tpublic getLegend(): languages.SemanticTokensLegend {\n\t\treturn this._legend;\n\t}\n\n\tasync provideDocumentSemanticTokens(model: ITextModel, lastResultId: string | null, token: CancellationToken): Promise<languages.SemanticTokens | languages.SemanticTokensEdits | null> {\n\t\tconst nLastResultId = lastResultId ? parseInt(lastResultId, 10) : 0;\n\t\tconst encodedDto = await this._proxy.$provideDocumentSemanticTokens(this._handle, model.uri, nLastResultId, token);\n\t\tif (!encodedDto) {\n\t\t\treturn null;\n\t\t}\n\t\tif (token.isCancellationRequested) {\n\t\t\treturn null;\n\t\t}\n\t\tconst dto = decodeSemanticTokensDto(encodedDto);\n\t\tif (dto.type === 'full') {\n\t\t\treturn {\n\t\t\t\tresultId: String(dto.id),\n\t\t\t\tdata: dto.data\n\t\t\t};\n\t\t}\n\t\treturn {\n\t\t\tresultId: String(dto.id),\n\t\t\tedits: dto.deltas\n\t\t};\n\t}\n}\n\nexport class MainThreadDocumentRangeSemanticTokensProvider implements languages.DocumentRangeSemanticTokensProvider {\n\n\tconstructor(\n\t\tprivate readonly _proxy: ExtHostLanguageFeaturesShape,\n\t\tprivate readonly _handle: number,\n\t\tprivate readonly _legend: languages.SemanticTokensLegend,\n\t\tpublic readonly onDidChange: Event<void> | undefined,\n\t) {\n\t}\n\n\tpublic getLegend(): languages.SemanticTokensLegend {\n\t\treturn this._legend;\n\t}\n\n\tasync provideDocumentRangeSemanticTokens(model: ITextModel, range: EditorRange, token: CancellationToken): Promise<languages.SemanticTokens | null> {\n\t\tconst encodedDto = await this._proxy.$provideDocumentRangeSemanticTokens(this._handle, model.uri, range, token);\n\t\tif (!encodedDto) {\n\t\t\treturn null;\n\t\t}\n\t\tif (token.isCancellationRequested) {\n\t\t\treturn null;\n\t\t}\n\t\tconst dto = decodeSemanticTokensDto(encodedDto);\n\t\tif (dto.type === 'full') {\n\t\t\treturn {\n\t\t\t\tresultId: String(dto.id),\n\t\t\t\tdata: dto.data\n\t\t\t};\n\t\t}\n\t\tthrow new Error(`Unexpected`);\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { VSBuffer } from '../../../base/common/buffer.js';\nimport { CancellationToken } from '../../../base/common/cancellation.js';\nimport { createStringDataTransferItem, IReadonlyVSDataTransfer, VSDataTransfer } from '../../../base/common/dataTransfer.js';\nimport { CancellationError } from '../../../base/common/errors.js';\nimport { Emitter, Event } from '../../../base/common/event.js';\nimport { HierarchicalKind } from '../../../base/common/hierarchicalKind.js';\nimport { combinedDisposable, Disposable, DisposableMap, toDisposable } from '../../../base/common/lifecycle.js';\nimport { ResourceMap } from '../../../base/common/map.js';\nimport { revive } from '../../../base/common/marshalling.js';\nimport { mixin } from '../../../base/common/objects.js';\nimport { URI } from '../../../base/common/uri.js';\nimport { Position as EditorPosition, IPosition } from '../../../editor/common/core/position.js';\nimport { Range as EditorRange, IRange } from '../../../editor/common/core/range.js';\nimport { Selection } from '../../../editor/common/core/selection.js';\nimport * as languages from '../../../editor/common/languages.js';\nimport { ILanguageService } from '../../../editor/common/languages/language.js';\nimport { IndentationRule, LanguageConfiguration, OnEnterRule } from '../../../editor/common/languages/languageConfiguration.js';\nimport { ILanguageConfigurationService } from '../../../editor/common/languages/languageConfigurationRegistry.js';\nimport { ITextModel } from '../../../editor/common/model.js';\nimport { ILanguageFeaturesService } from '../../../editor/common/services/languageFeatures.js';\nimport { decodeSemanticTokensDto } from '../../../editor/common/services/semanticTokensDto.js';\nimport { ExtensionIdentifier } from '../../../platform/extensions/common/extensions.js';\nimport { IUriIdentityService } from '../../../platform/uriIdentity/common/uriIdentity.js';\nimport { reviveWorkspaceEditDto } from './mainThreadBulkEdits.js';\nimport * as typeConvert from '../common/extHostTypeConverters.js';\nimport { DataTransferFileCache } from '../common/shared/dataTransferCache.js';\nimport * as callh from '../../contrib/callHierarchy/common/callHierarchy.js';\nimport * as search from '../../contrib/search/common/search.js';\nimport * as typeh from '../../contrib/typeHierarchy/common/typeHierarchy.js';\nimport { extHostNamedCustomer, IExtHostContext } from '../../services/extensions/common/extHostCustomers.js';\nimport { ExtHostContext, ExtHostLanguageFeaturesShape, HoverWithId, ICallHierarchyItemDto, ICodeActionDto, ICodeActionProviderMetadataDto, IdentifiableInlineCompletion, IdentifiableInlineCompletions, IDocumentDropEditDto, IDocumentDropEditProviderMetadata, IDocumentFilterDto, IIndentationRuleDto, IInlayHintDto, ILanguageConfigurationDto, ILanguageWordDefinitionDto, ILinkDto, ILocationDto, ILocationLinkDto, IOnEnterRuleDto, IPasteEditDto, IPasteEditProviderMetadataDto, IRegExpDto, ISignatureHelpProviderMetadataDto, ISuggestDataDto, ISuggestDataDtoField, ISuggestResultDtoField, ITypeHierarchyItemDto, IWorkspaceSymbolDto, MainContext, MainThreadLanguageFeaturesShape } from '../common/extHost.protocol.js';\nimport { InlineCompletionEndOfLifeReasonKind } from '../common/extHostTypes.js';\nimport { IInstantiationService } from '../../../platform/instantiation/common/instantiation.js';\nimport { DataChannelForwardingTelemetryService, forwardToChannelIf, isCopilotLikeExtension } from '../../../platform/dataChannel/browser/forwardingTelemetryService.js';\nimport { IAiEditTelemetryService } from '../../contrib/editTelemetry/browser/telemetry/aiEditTelemetry/aiEditTelemetryService.js';\nimport { EditDeltaInfo } from '../../../editor/common/textModelEditSource.js';\nimport { IInlineCompletionsUnificationService } from '../../services/inlineCompletions/common/inlineCompletionsUnification.js';\nimport { InlineCompletionEndOfLifeEvent, sendInlineCompletionsEndOfLifeTelemetry } from '../../../editor/contrib/inlineCompletions/browser/telemetry.js';\n\n@extHostNamedCustomer(MainContext.MainThreadLanguageFeatures)\nexport class MainThreadLanguageFeatures extends Disposable implements MainThreadLanguageFeaturesShape {\n\n\tprivate readonly _proxy: ExtHostLanguageFeaturesShape;\n\tprivate readonly _registrations = this._register(new DisposableMap<number>());\n\n\tconstructor(\n\t\textHostContext: IExtHostContext,\n\t\t@ILanguageService private readonly _languageService: ILanguageService,\n\t\t@ILanguageConfigurationService private readonly _languageConfigurationService: ILanguageConfigurationService,\n\t\t@ILanguageFeaturesService private readonly _languageFeaturesService: ILanguageFeaturesService,\n\t\t@IUriIdentityService private readonly _uriIdentService: IUriIdentityService,\n\t\t@IInstantiationService private readonly _instantiationService: IInstantiationService,\n\t\t@IInlineCompletionsUnificationService private readonly _inlineCompletionsUnificationService: IInlineCompletionsUnificationService,\n\t\t@IAiEditTelemetryService private readonly _aiEditTelemetryService: IAiEditTelemetryService,\n\t) {\n\t\tsuper();\n\n\t\tthis._proxy = extHostContext.getProxy(ExtHostContext.ExtHostLanguageFeatures);\n\n\t\tif (this._languageService) {\n\t\t\tconst updateAllWordDefinitions = () => {\n\t\t\t\tconst wordDefinitionDtos: ILanguageWordDefinitionDto[] = [];\n\t\t\t\tfor (const languageId of _languageService.getRegisteredLanguageIds()) {\n\t\t\t\t\tconst wordDefinition = this._languageConfigurationService.getLanguageConfiguration(languageId).getWordDefinition();\n\t\t\t\t\twordDefinitionDtos.push({\n\t\t\t\t\t\tlanguageId: languageId,\n\t\t\t\t\t\tregexSource: wordDefinition.source,\n\t\t\t\t\t\tregexFlags: wordDefinition.flags\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tthis._proxy.$setWordDefinitions(wordDefinitionDtos);\n\t\t\t};\n\t\t\tthis._register(this._languageConfigurationService.onDidChange((e) => {\n\t\t\t\tif (!e.languageId) {\n\t\t\t\t\tupdateAllWordDefinitions();\n\t\t\t\t} else {\n\t\t\t\t\tconst wordDefinition = this._languageConfigurationService.getLanguageConfiguration(e.languageId).getWordDefinition();\n\t\t\t\t\tthis._proxy.$setWordDefinitions([{\n\t\t\t\t\t\tlanguageId: e.languageId,\n\t\t\t\t\t\tregexSource: wordDefinition.source,\n\t\t\t\t\t\tregexFlags: wordDefinition.flags\n\t\t\t\t\t}]);\n\t\t\t\t}\n\t\t\t}));\n\t\t\tupdateAllWordDefinitions();\n\t\t}\n\n\t\tif (this._inlineCompletionsUnificationService) {\n\t\t\tthis._register(this._inlineCompletionsUnificationService.onDidStateChange(() => {\n\t\t\t\tthis._proxy.$acceptInlineCompletionsUnificationState(this._inlineCompletionsUnificationService.state);\n\t\t\t}));\n\t\t\tthis._proxy.$acceptInlineCompletionsUnificationState(this._inlineCompletionsUnificationService.state);\n\t\t}\n\t}\n\n\t$unregister(handle: number): void {\n\t\tthis._registrations.deleteAndDispose(handle);\n\t}\n\n\t//#region --- revive functions\n\n\tprivate static _reviveLocationDto(data?: ILocationDto): languages.Location;\n\tprivate static _reviveLocationDto(data?: ILocationDto[]): languages.Location[];\n\tprivate static _reviveLocationDto(data: ILocationDto | ILocationDto[] | undefined): languages.Location | languages.Location[] | undefined {\n\t\tif (!data) {\n\t\t\treturn data;\n\t\t} else if (Array.isArray(data)) {\n\t\t\tdata.forEach(l => MainThreadLanguageFeatures._reviveLocationDto(l));\n\t\t\treturn <languages.Location[]>data;\n\t\t} else {\n\t\t\tdata.uri = URI.revive(data.uri);\n\t\t\treturn <languages.Location>data;\n\t\t}\n\t}\n\n\tprivate static _reviveLocationLinkDto(data: ILocationLinkDto): languages.LocationLink;\n\tprivate static _reviveLocationLinkDto(data: ILocationLinkDto[]): languages.LocationLink[];\n\tprivate static _reviveLocationLinkDto(data: ILocationLinkDto | ILocationLinkDto[]): languages.LocationLink | languages.LocationLink[] {\n\t\tif (!data) {\n\t\t\treturn <languages.LocationLink>data;\n\t\t} else if (Array.isArray(data)) {\n\t\t\tdata.forEach(l => MainThreadLanguageFeatures._reviveLocationLinkDto(l));\n\t\t\treturn <languages.LocationLink[]>data;\n\t\t} else {\n\t\t\tdata.uri = URI.revive(data.uri);\n\t\t\treturn <languages.LocationLink>data;\n\t\t}\n\t}\n\n\tprivate static _reviveWorkspaceSymbolDto(data: IWorkspaceSymbolDto): search.IWorkspaceSymbol;\n\tprivate static _reviveWorkspaceSymbolDto(data: IWorkspaceSymbolDto[]): search.IWorkspaceSymbol[];\n\tprivate static _reviveWorkspaceSymbolDto(data: undefined): undefined;\n\tprivate static _reviveWorkspaceSymbolDto(data: IWorkspaceSymbolDto | IWorkspaceSymbolDto[] | undefined): search.IWorkspaceSymbol | search.IWorkspaceSymbol[] | undefined {\n\t\tif (!data) {\n\t\t\treturn data;\n\t\t} else if (Array.isArray(data)) {\n\t\t\tdata.forEach(MainThreadLanguageFeatures._reviveWorkspaceSymbolDto);\n\t\t\treturn <search.IWorkspaceSymbol[]>data;\n\t\t} else {\n\t\t\tdata.location = MainThreadLanguageFeatures._reviveLocationDto(data.location);\n\t\t\treturn <search.IWorkspaceSymbol>data;\n\t\t}\n\t}\n\n\tprivate static _reviveCodeActionDto(data: ReadonlyArray<ICodeActionDto>, uriIdentService: IUriIdentityService): languages.CodeAction[] {\n\t\tdata?.forEach(code => reviveWorkspaceEditDto(code.edit, uriIdentService));\n\t\treturn <languages.CodeAction[]>data;\n\t}\n\n\tprivate static _reviveLinkDTO(data: ILinkDto): languages.ILink {\n\t\tif (data.url && typeof data.url !== 'string') {\n\t\t\tdata.url = URI.revive(data.url);\n\t\t}\n\t\treturn <languages.ILink>data;\n\t}\n\n\tprivate static _reviveCallHierarchyItemDto(data: ICallHierarchyItemDto | undefined): callh.CallHierarchyItem {\n\t\tif (data) {\n\t\t\tdata.uri = URI.revive(data.uri);\n\t\t}\n\t\treturn data as callh.CallHierarchyItem;\n\t}\n\n\tprivate static _reviveTypeHierarchyItemDto(data: ITypeHierarchyItemDto | undefined): typeh.TypeHierarchyItem {\n\t\tif (data) {\n\t\t\tdata.uri = URI.revive(data.uri);\n\t\t}\n\t\treturn data as typeh.TypeHierarchyItem;\n\t}\n\n\t//#endregion\n\n\t// --- outline\n\n\t$registerDocumentSymbolProvider(handle: number, selector: IDocumentFilterDto[], displayName: string): void {\n\t\tthis._registrations.set(handle, this._languageFeaturesService.documentSymbolProvider.register(selector, {\n\t\t\tdisplayName,\n\t\t\tprovideDocumentSymbols: (model: ITextModel, token: CancellationToken): Promise<languages.DocumentSymbol[] | undefined> => {\n\t\t\t\treturn this._proxy.$provideDocumentSymbols(handle, model.uri, token);\n\t\t\t}\n\t\t}));\n\t}\n\n\t// --- code lens\n\n\t$registerCodeLensSupport(handle: number, selector: IDocumentFilterDto[], eventHandle: number | undefined): void {\n\n\t\tconst provider: languages.CodeLensProvider = {\n\t\t\tprovideCodeLenses: async (model: ITextModel, token: CancellationToken): Promise<languages.CodeLensList | undefined> => {\n\t\t\t\tconst listDto = await this._proxy.$provideCodeLenses(handle, model.uri, token);\n\t\t\t\tif (!listDto) {\n\t\t\t\t\treturn undefined;\n\t\t\t\t}\n\t\t\t\treturn {\n\t\t\t\t\tlenses: listDto.lenses,\n\t\t\t\t\tdispose: () => listDto.cacheId && this._proxy.$releaseCodeLenses(handle, listDto.cacheId)\n\t\t\t\t};\n\t\t\t},\n\t\t\tresolveCodeLens: async (model: ITextModel, codeLens: languages.CodeLens, token: CancellationToken): Promise<languages.CodeLens | undefined> => {\n\t\t\t\tconst result = await this._proxy.$resolveCodeLens(handle, codeLens, token);\n\t\t\t\tif (!result || token.isCancellationRequested) {\n\t\t\t\t\treturn undefined;\n\t\t\t\t}\n\n\t\t\t\treturn {\n\t\t\t\t\t...result,\n\t\t\t\t\trange: model.validateRange(result.range),\n\t\t\t\t};\n\t\t\t}\n\t\t};\n\n\t\tif (typeof eventHandle === 'number') {\n\t\t\tconst emitter = new Emitter<languages.CodeLensProvider>();\n\t\t\tthis._registrations.set(eventHandle, emitter);\n\t\t\tprovider.onDidChange = emitter.event;\n\t\t}\n\n\t\tthis._registrations.set(handle, this._languageFeaturesService.codeLensProvider.register(selector, provider));\n\t}\n\n\t$emitCodeLensEvent(eventHandle: number, event?: unknown): void {\n\t\tconst obj = this._registrations.get(eventHandle);\n\t\tif (obj instanceof Emitter) {\n\t\t\tobj.fire(event);\n\t\t}\n\t}\n\n\t// --- declaration\n\n\t$registerDefinitionSupport(handle: number, selector: IDocumentFilterDto[]): void {\n\t\tthis._registrations.set(handle, this._languageFeaturesService.definitionProvider.register(selector, {\n\t\t\tprovideDefinition: (model, position, token): Promise<languages.LocationLink[]> => {\n\t\t\t\treturn this._proxy.$provideDefinition(handle, model.uri, position, token).then(MainThreadLanguageFeatures._reviveLocationLinkDto);\n\t\t\t}\n\t\t}));\n\t}\n\n\t$registerDeclarationSupport(handle: number, selector: IDocumentFilterDto[]): void {\n\t\tthis._registrations.set(handle, this._languageFeaturesService.declarationProvider.register(selector, {\n\t\t\tprovideDeclaration: (model, position, token) => {\n\t\t\t\treturn this._proxy.$provideDeclaration(handle, model.uri, position, token).then(MainThreadLanguageFeatures._reviveLocationLinkDto);\n\t\t\t}\n\t\t}));\n\t}\n\n\t$registerImplementationSupport(handle: number, selector: IDocumentFilterDto[]): void {\n\t\tthis._registrations.set(handle, this._languageFeaturesService.implementationProvider.register(selector, {\n\t\t\tprovideImplementation: (model, position, token): Promise<languages.LocationLink[]> => {\n\t\t\t\treturn this._proxy.$provideImplementation(handle, model.uri, position, token).then(MainThreadLanguageFeatures._reviveLocationLinkDto);\n\t\t\t}\n\t\t}));\n\t}\n\n\t$registerTypeDefinitionSupport(handle: number, selector: IDocumentFilterDto[]): void {\n\t\tthis._registrations.set(handle, this._languageFeaturesService.typeDefinitionProvider.register(selector, {\n\t\t\tprovideTypeDefinition: (model, position, token): Promise<languages.LocationLink[]> => {\n\t\t\t\treturn this._proxy.$provideTypeDefinition(handle, model.uri, position, token).then(MainThreadLanguageFeatures._reviveLocationLinkDto);\n\t\t\t}\n\t\t}));\n\t}\n\n\t// --- extra info\n\n\t$registerHoverProvider(handle: number, selector: IDocumentFilterDto[]): void {\n\t\t/*\n\t\tconst hoverFinalizationRegistry = new FinalizationRegistry((hoverId: number) => {\n\t\t\tthis._proxy.$releaseHover(handle, hoverId);\n\t\t});\n\t\t*/\n\t\tthis._registrations.set(handle, this._languageFeaturesService.hoverProvider.register(selector, {\n\t\t\tprovideHover: async (model: ITextModel, position: EditorPosition, token: CancellationToken, context?: languages.HoverContext<HoverWithId>): Promise<HoverWithId | undefined> => {\n\t\t\t\tconst serializedContext: languages.HoverContext<{ id: number }> = {\n\t\t\t\t\tverbosityRequest: context?.verbosityRequest ? {\n\t\t\t\t\t\tverbosityDelta: context.verbosityRequest.verbosityDelta,\n\t\t\t\t\t\tpreviousHover: { id: context.verbosityRequest.previousHover.id }\n\t\t\t\t\t} : undefined,\n\t\t\t\t};\n\t\t\t\tconst hover = await this._proxy.$provideHover(handle, model.uri, position, serializedContext, token);\n\t\t\t\t// hoverFinalizationRegistry.register(hover, hover.id);\n\t\t\t\treturn hover;\n\t\t\t}\n\t\t}));\n\t}\n\n\t// --- debug hover\n\n\t$registerEvaluatableExpressionProvider(handle: number, selector: IDocumentFilterDto[]): void {\n\t\tthis._registrations.set(handle, this._languageFeaturesService.evaluatableExpressionProvider.register(selector, {\n\t\t\tprovideEvaluatableExpression: (model: ITextModel, position: EditorPosition, token: CancellationToken): Promise<languages.EvaluatableExpression | undefined> => {\n\t\t\t\treturn this._proxy.$provideEvaluatableExpression(handle, model.uri, position, token);\n\t\t\t}\n\t\t}));\n\t}\n\n\t// --- inline values\n\n\t$registerInlineValuesProvider(handle: number, selector: IDocumentFilterDto[], eventHandle: number | undefined): void {\n\t\tconst provider: languages.InlineValuesProvider = {\n\t\t\tprovideInlineValues: (model: ITextModel, viewPort: EditorRange, context: languages.InlineValueContext, token: CancellationToken): Promise<languages.InlineValue[] | undefined> => {\n\t\t\t\treturn this._proxy.$provideInlineValues(handle, model.uri, viewPort, context, token);\n\t\t\t}\n\t\t};\n\n\t\tif (typeof eventHandle === 'number') {\n\t\t\tconst emitter = new Emitter<void>();\n\t\t\tthis._registrations.set(eventHandle, emitter);\n\t\t\tprovider.onDidChangeInlineValues = emitter.event;\n\t\t}\n\n\t\tthis._registrations.set(handle, this._languageFeaturesService.inlineValuesProvider.register(selector, provider));\n\t}\n\n\t$emitInlineValuesEvent(eventHandle: number, event?: unknown): void {\n\t\tconst obj = this._registrations.get(eventHandle);\n\t\tif (obj instanceof Emitter) {\n\t\t\tobj.fire(event);\n\t\t}\n\t}\n\n\t// --- occurrences\n\n\t$registerDocumentHighlightProvider(handle: number, selector: IDocumentFilterDto[]): void {\n\t\tthis._registrations.set(handle, this._languageFeaturesService.documentHighlightProvider.register(selector, {\n\t\t\tprovideDocumentHighlights: (model: ITextModel, position: EditorPosition, token: CancellationToken): Promise<languages.DocumentHighlight[] | undefined> => {\n\t\t\t\treturn this._proxy.$provideDocumentHighlights(handle, model.uri, position, token);\n\t\t\t}\n\t\t}));\n\t}\n\n\t$registerMultiDocumentHighlightProvider(handle: number, selector: IDocumentFilterDto[]): void {\n\t\tthis._registrations.set(handle, this._languageFeaturesService.multiDocumentHighlightProvider.register(selector, {\n\t\t\tselector: selector,\n\t\t\tprovideMultiDocumentHighlights: (model: ITextModel, position: EditorPosition, otherModels: ITextModel[], token: CancellationToken): Promise<Map<URI, languages.DocumentHighlight[]> | undefined> => {\n\t\t\t\treturn this._proxy.$provideMultiDocumentHighlights(handle, model.uri, position, otherModels.map(model => model.uri), token).then(dto => {\n\t\t\t\t\t// dto should be non-null + non-undefined\n\t\t\t\t\t// dto length of 0 is valid, just no highlights, pass this through.\n\t\t\t\t\tif (dto === undefined || dto === null) {\n\t\t\t\t\t\treturn undefined;\n\t\t\t\t\t}\n\t\t\t\t\tconst result = new ResourceMap<languages.DocumentHighlight[]>();\n\t\t\t\t\tdto?.forEach(value => {\n\t\t\t\t\t\t// check if the URI exists already, if so, combine the highlights, otherwise create a new entry\n\t\t\t\t\t\tconst uri = URI.revive(value.uri);\n\t\t\t\t\t\tif (result.has(uri)) {\n\t\t\t\t\t\t\tresult.get(uri)!.push(...value.highlights);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tresult.set(uri, value.highlights);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\treturn result;\n\t\t\t\t});\n\t\t\t}\n\t\t}));\n\t}\n\n\t// --- linked editing\n\n\t$registerLinkedEditingRangeProvider(handle: number, selector: IDocumentFilterDto[]): void {\n\t\tthis._registrations.set(handle, this._languageFeaturesService.linkedEditingRangeProvider.register(selector, {\n\t\t\tprovideLinkedEditingRanges: async (model: ITextModel, position: EditorPosition, token: CancellationToken): Promise<languages.LinkedEditingRanges | undefined> => {\n\t\t\t\tconst res = await this._proxy.$provideLinkedEditingRanges(handle, model.uri, position, token);\n\t\t\t\tif (res) {\n\t\t\t\t\treturn {\n\t\t\t\t\t\tranges: res.ranges,\n\t\t\t\t\t\twordPattern: res.wordPattern ? MainThreadLanguageFeatures._reviveRegExp(res.wordPattern) : undefined\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t\treturn undefined;\n\t\t\t}\n\t\t}));\n\t}\n\n\t// --- references\n\n\t$registerReferenceSupport(handle: number, selector: IDocumentFilterDto[]): void {\n\t\tthis._registrations.set(handle, this._languageFeaturesService.referenceProvider.register(selector, {\n\t\t\tprovideReferences: (model: ITextModel, position: EditorPosition, context: languages.ReferenceContext, token: CancellationToken): Promise<languages.Location[]> => {\n\t\t\t\treturn this._proxy.$provideReferences(handle, model.uri, position, context, token).then(MainThreadLanguageFeatures._reviveLocationDto);\n\t\t\t}\n\t\t}));\n\t}\n\n\t// --- code actions\n\n\t$registerCodeActionSupport(handle: number, selector: IDocumentFilterDto[], metadata: ICodeActionProviderMetadataDto, displayName: string, extensionId: string, supportsResolve: boolean): void {\n\t\tconst provider: languages.CodeActionProvider = {\n\t\t\tprovideCodeActions: async (model: ITextModel, rangeOrSelection: EditorRange | Selection, context: languages.CodeActionContext, token: CancellationToken): Promise<languages.CodeActionList | undefined> => {\n\t\t\t\tconst listDto = await this._proxy.$provideCodeActions(handle, model.uri, rangeOrSelection, context, token);\n\t\t\t\tif (!listDto) {\n\t\t\t\t\treturn undefined;\n\t\t\t\t}\n\t\t\t\treturn {\n\t\t\t\t\tactions: MainThreadLanguageFeatures._reviveCodeActionDto(listDto.actions, this._uriIdentService),\n\t\t\t\t\tdispose: () => {\n\t\t\t\t\t\tif (typeof listDto.cacheId === 'number') {\n\t\t\t\t\t\t\tthis._proxy.$releaseCodeActions(handle, listDto.cacheId);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t},\n\t\t\tprovidedCodeActionKinds: metadata.providedKinds,\n\t\t\tdocumentation: metadata.documentation,\n\t\t\tdisplayName,\n\t\t\textensionId,\n\t\t};\n\n\t\tif (supportsResolve) {\n\t\t\tprovider.resolveCodeAction = async (codeAction: languages.CodeAction, token: CancellationToken): Promise<languages.CodeAction> => {\n\t\t\t\tconst resolved = await this._proxy.$resolveCodeAction(handle, (<ICodeActionDto>codeAction).cacheId!, token);\n\t\t\t\tif (resolved.edit) {\n\t\t\t\t\tcodeAction.edit = reviveWorkspaceEditDto(resolved.edit, this._uriIdentService);\n\t\t\t\t}\n\n\t\t\t\tif (resolved.command) {\n\t\t\t\t\tcodeAction.command = resolved.command;\n\t\t\t\t}\n\n\t\t\t\treturn codeAction;\n\t\t\t};\n\t\t}\n\n\t\tthis._registrations.set(handle, this._languageFeaturesService.codeActionProvider.register(selector, provider));\n\t}\n\n\t// --- copy paste action provider\n\n\tprivate readonly _pasteEditProviders = new Map<number, MainThreadPasteEditProvider>();\n\n\t$registerPasteEditProvider(handle: number, selector: IDocumentFilterDto[], metadata: IPasteEditProviderMetadataDto): void {\n\t\tconst provider = new MainThreadPasteEditProvider(handle, this._proxy, metadata, this._uriIdentService);\n\t\tthis._pasteEditProviders.set(handle, provider);\n\t\tthis._registrations.set(handle, combinedDisposable(\n\t\t\tthis._languageFeaturesService.documentPasteEditProvider.register(selector, provider),\n\t\t\ttoDisposable(() => this._pasteEditProviders.delete(handle)),\n\t\t));\n\t}\n\n\t$resolvePasteFileData(handle: number, requestId: number, dataId: string): Promise<VSBuffer> {\n\t\tconst provider = this._pasteEditProviders.get(handle);\n\t\tif (!provider) {\n\t\t\tthrow new Error('Could not find provider');\n\t\t}\n\t\treturn provider.resolveFileData(requestId, dataId);\n\t}\n\n\t// --- formatting\n\n\t$registerDocumentFormattingSupport(handle: number, selector: IDocumentFilterDto[], extensionId: ExtensionIdentifier, displayName: string): void {\n\t\tthis._registrations.set(handle, this._languageFeaturesService.documentFormattingEditProvider.register(selector, {\n\t\t\textensionId,\n\t\t\tdisplayName,\n\t\t\tprovideDocumentFormattingEdits: (model: ITextModel, options: languages.FormattingOptions, token: CancellationToken): Promise<languages.TextEdit[] | undefined> => {\n\t\t\t\treturn this._proxy.$provideDocumentFormattingEdits(handle, model.uri, options, token);\n\t\t\t}\n\t\t}));\n\t}\n\n\t$registerRangeFormattingSupport(handle: number, selector: IDocumentFilterDto[], extensionId: ExtensionIdentifier, displayName: string, supportsRanges: boolean): void {\n\t\tthis._registrations.set(handle, this._languageFeaturesService.documentRangeFormattingEditProvider.register(selector, {\n\t\t\textensionId,\n\t\t\tdisplayName,\n\t\t\tprovideDocumentRangeFormattingEdits: (model: ITextModel, range: EditorRange, options: languages.FormattingOptions, token: CancellationToken): Promise<languages.TextEdit[] | undefined> => {\n\t\t\t\treturn this._proxy.$provideDocumentRangeFormattingEdits(handle, model.uri, range, options, token);\n\t\t\t},\n\t\t\tprovideDocumentRangesFormattingEdits: !supportsRanges\n\t\t\t\t? undefined\n\t\t\t\t: (model, ranges, options, token) => {\n\t\t\t\t\treturn this._proxy.$provideDocumentRangesFormattingEdits(handle, model.uri, ranges, options, token);\n\t\t\t\t},\n\t\t}));\n\t}\n\n\t$registerOnTypeFormattingSupport(handle: number, selector: IDocumentFilterDto[], autoFormatTriggerCharacters: string[], extensionId: ExtensionIdentifier): void {\n\t\tthis._registrations.set(handle, this._languageFeaturesService.onTypeFormattingEditProvider.register(selector, {\n\t\t\textensionId,\n\t\t\tautoFormatTriggerCharacters,\n\t\t\tprovideOnTypeFormattingEdits: (model: ITextModel, position: EditorPosition, ch: string, options: languages.FormattingOptions, token: CancellationToken): Promise<languages.TextEdit[] | undefined> => {\n\t\t\t\treturn this._proxy.$provideOnTypeFormattingEdits(handle, model.uri, position, ch, options, token);\n\t\t\t}\n\t\t}));\n\t}\n\n\t// --- navigate type\n\n\t$registerNavigateTypeSupport(handle: number, supportsResolve: boolean): void {\n\t\tlet lastResultId: number | undefined;\n\n\t\tconst provider: search.IWorkspaceSymbolProvider = {\n\t\t\tprovideWorkspaceSymbols: async (search: string, token: CancellationToken): Promise<search.IWorkspaceSymbol[]> => {\n\t\t\t\tconst result = await this._proxy.$provideWorkspaceSymbols(handle, search, token);\n\t\t\t\tif (lastResultId !== undefined) {\n\t\t\t\t\tthis._proxy.$releaseWorkspaceSymbols(handle, lastResultId);\n\t\t\t\t}\n\t\t\t\tlastResultId = result.cacheId;\n\t\t\t\treturn MainThreadLanguageFeatures._reviveWorkspaceSymbolDto(result.symbols);\n\t\t\t}\n\t\t};\n\t\tif (supportsResolve) {\n\t\t\tprovider.resolveWorkspaceSymbol = async (item: search.IWorkspaceSymbol, token: CancellationToken): Promise<search.IWorkspaceSymbol | undefined> => {\n\t\t\t\tconst resolvedItem = await this._proxy.$resolveWorkspaceSymbol(handle, item, token);\n\t\t\t\treturn resolvedItem && MainThreadLanguageFeatures._reviveWorkspaceSymbolDto(resolvedItem);\n\t\t\t};\n\t\t}\n\t\tthis._registrations.set(handle, search.WorkspaceSymbolProviderRegistry.register(provider));\n\t}\n\n\t// --- rename\n\n\t$registerRenameSupport(handle: number, selector: IDocumentFilterDto[], supportResolveLocation: boolean): void {\n\t\tthis._registrations.set(handle, this._languageFeaturesService.renameProvider.register(selector, {\n\t\t\tprovideRenameEdits: (model: ITextModel, position: EditorPosition, newName: string, token: CancellationToken) => {\n\t\t\t\treturn this._proxy.$provideRenameEdits(handle, model.uri, position, newName, token).then(data => reviveWorkspaceEditDto(data, this._uriIdentService));\n\t\t\t},\n\t\t\tresolveRenameLocation: supportResolveLocation\n\t\t\t\t? (model: ITextModel, position: EditorPosition, token: CancellationToken): Promise<languages.RenameLocation | undefined> => this._proxy.$resolveRenameLocation(handle, model.uri, position, token)\n\t\t\t\t: undefined\n\t\t}));\n\t}\n\n\t$registerNewSymbolNamesProvider(handle: number, selector: IDocumentFilterDto[]): void {\n\t\tthis._registrations.set(handle, this._languageFeaturesService.newSymbolNamesProvider.register(selector, {\n\t\t\tsupportsAutomaticNewSymbolNamesTriggerKind: this._proxy.$supportsAutomaticNewSymbolNamesTriggerKind(handle),\n\t\t\tprovideNewSymbolNames: (model: ITextModel, range: IRange, triggerKind: languages.NewSymbolNameTriggerKind, token: CancellationToken): Promise<languages.NewSymbolName[] | undefined> => {\n\t\t\t\treturn this._proxy.$provideNewSymbolNames(handle, model.uri, range, triggerKind, token);\n\t\t\t}\n\t\t} satisfies languages.NewSymbolNamesProvider));\n\t}\n\n\t// --- semantic tokens\n\n\t$registerDocumentSemanticTokensProvider(handle: number, selector: IDocumentFilterDto[], legend: languages.SemanticTokensLegend, eventHandle: number | undefined): void {\n\t\tlet event: Event<void> | undefined = undefined;\n\t\tif (typeof eventHandle === 'number') {\n\t\t\tconst emitter = new Emitter<void>();\n\t\t\tthis._registrations.set(eventHandle, emitter);\n\t\t\tevent = emitter.event;\n\t\t}\n\t\tthis._registrations.set(handle, this._languageFeaturesService.documentSemanticTokensProvider.register(selector, new MainThreadDocumentSemanticTokensProvider(this._proxy, handle, legend, event)));\n\t}\n\n\t$emitDocumentSemanticTokensEvent(eventHandle: number): void {\n\t\tconst obj = this._registrations.get(eventHandle);\n\t\tif (obj instanceof Emitter) {\n\t\t\tobj.fire(undefined);\n\t\t}\n\t}\n\n\t$emitDocumentRangeSemanticTokensEvent(eventHandle: number): void {\n\t\tconst obj = this._registrations.get(eventHandle);\n\t\tif (obj instanceof Emitter) {\n\t\t\tobj.fire(undefined);\n\t\t}\n\t}\n\n\t$registerDocumentRangeSemanticTokensProvider(handle: number, selector: IDocumentFilterDto[], legend: languages.SemanticTokensLegend, eventHandle: number | undefined): void {\n\t\tlet event: Event<void> | undefined = undefined;\n\t\tif (typeof eventHandle === 'number') {\n\t\t\tconst emitter = new Emitter<void>();\n\t\t\tthis._registrations.set(eventHandle, emitter);\n\t\t\tevent = emitter.event;\n\t\t}\n\t\tthis._registrations.set(handle, this._languageFeaturesService.documentRangeSemanticTokensProvider.register(selector, new MainThreadDocumentRangeSemanticTokensProvider(this._proxy, handle, legend, event)));\n\t}\n\n\t// --- suggest\n\n\tprivate static _inflateSuggestDto(defaultRange: IRange | { insert: IRange; replace: IRange }, data: ISuggestDataDto, extensionId: ExtensionIdentifier): languages.CompletionItem {\n\n\t\tconst label = data[ISuggestDataDtoField.label];\n\t\tconst commandId = data[ISuggestDataDtoField.commandId];\n\t\tconst commandIdent = data[ISuggestDataDtoField.commandIdent];\n\t\tconst commitChars = data[ISuggestDataDtoField.commitCharacters];\n\n\t\ttype IdentCommand = languages.Command & { $ident: string | undefined };\n\n\t\tlet command: IdentCommand | undefined;\n\t\tif (commandId) {\n\t\t\tcommand = {\n\t\t\t\t$ident: commandIdent,\n\t\t\t\tid: commandId,\n\t\t\t\ttitle: '',\n\t\t\t\targuments: commandIdent ? [commandIdent] : data[ISuggestDataDtoField.commandArguments], // Automatically fill in ident as first argument\n\t\t\t};\n\t\t}\n\n\t\treturn {\n\t\t\tlabel,\n\t\t\textensionId,\n\t\t\tkind: data[ISuggestDataDtoField.kind] ?? languages.CompletionItemKind.Property,\n\t\t\ttags: data[ISuggestDataDtoField.kindModifier],\n\t\t\tdetail: data[ISuggestDataDtoField.detail],\n\t\t\tdocumentation: data[ISuggestDataDtoField.documentation],\n\t\t\tsortText: data[ISuggestDataDtoField.sortText],\n\t\t\tfilterText: data[ISuggestDataDtoField.filterText],\n\t\t\tpreselect: data[ISuggestDataDtoField.preselect],\n\t\t\tinsertText: data[ISuggestDataDtoField.insertText] ?? (typeof label === 'string' ? label : label.label),\n\t\t\trange: data[ISuggestDataDtoField.range] ?? defaultRange,\n\t\t\tinsertTextRules: data[ISuggestDataDtoField.insertTextRules],\n\t\t\tcommitCharacters: commitChars ? Array.from(commitChars) : undefined,\n\t\t\tadditionalTextEdits: data[ISuggestDataDtoField.additionalTextEdits],\n\t\t\tcommand,\n\t\t\t// not-standard\n\t\t\t_id: data.x,\n\t\t};\n\t}\n\n\t$registerCompletionsProvider(handle: number, selector: IDocumentFilterDto[], triggerCharacters: string[], supportsResolveDetails: boolean, extensionId: ExtensionIdentifier): void {\n\t\tconst provider: languages.CompletionItemProvider = {\n\t\t\ttriggerCharacters,\n\t\t\t_debugDisplayName: `${extensionId.value}(${triggerCharacters.join('')})`,\n\t\t\tprovideCompletionItems: async (model: ITextModel, position: EditorPosition, context: languages.CompletionContext, token: CancellationToken): Promise<languages.CompletionList | undefined> => {\n\t\t\t\tconst result = await this._proxy.$provideCompletionItems(handle, model.uri, position, context, token);\n\t\t\t\tif (!result) {\n\t\t\t\t\treturn result;\n\t\t\t\t}\n\t\t\t\treturn {\n\t\t\t\t\tsuggestions: result[ISuggestResultDtoField.completions].map(d => MainThreadLanguageFeatures._inflateSuggestDto(result[ISuggestResultDtoField.defaultRanges], d, extensionId)),\n\t\t\t\t\tincomplete: result[ISuggestResultDtoField.isIncomplete] || false,\n\t\t\t\t\tduration: result[ISuggestResultDtoField.duration],\n\t\t\t\t\tdispose: () => {\n\t\t\t\t\t\tif (typeof result.x === 'number') {\n\t\t\t\t\t\t\tthis._proxy.$releaseCompletionItems(handle, result.x);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t}\n\t\t};\n\t\tif (supportsResolveDetails) {\n\t\t\tprovider.resolveCompletionItem = (suggestion, token) => {\n\t\t\t\treturn this._proxy.$resolveCompletionItem(handle, suggestion._id!, token).then(result => {\n\t\t\t\t\tif (!result) {\n\t\t\t\t\t\treturn suggestion;\n\t\t\t\t\t}\n\n\t\t\t\t\tconst newSuggestion = MainThreadLanguageFeatures._inflateSuggestDto(suggestion.range, result, extensionId);\n\t\t\t\t\treturn mixin(suggestion, newSuggestion, true);\n\t\t\t\t});\n\t\t\t};\n\t\t}\n\t\tthis._registrations.set(handle, this._languageFeaturesService.completionProvider.register(selector, provider));\n\t}\n\n\t$registerInlineCompletionsSupport(handle: number, selector: IDocumentFilterDto[], supportsHandleEvents: boolean, extensionId: string, extensionVersion: string, groupId: string | undefined, yieldsToExtensionIds: string[], displayName: string | undefined, debounceDelayMs: number | undefined, excludesExtensionIds: string[], eventHandle: number | undefined): void {\n\t\tconst providerId = new languages.ProviderId(extensionId, extensionVersion, groupId);\n\t\tconst provider: languages.InlineCompletionsProvider<IdentifiableInlineCompletions> = {\n\t\t\tprovideInlineCompletions: async (model: ITextModel, position: EditorPosition, context: languages.InlineCompletionContext, token: CancellationToken): Promise<IdentifiableInlineCompletions | undefined> => {\n\t\t\t\tconst result = await this._proxy.$provideInlineCompletions(handle, model.uri, position, context, token);\n\t\t\t\treturn result;\n\t\t\t},\n\t\t\thandleItemDidShow: async (completions: IdentifiableInlineCompletions, item: IdentifiableInlineCompletion, updatedInsertText: string, editDeltaInfo: EditDeltaInfo): Promise<void> => {\n\t\t\t\tif (item.suggestionId === undefined) {\n\t\t\t\t\titem.suggestionId = this._aiEditTelemetryService.createSuggestionId({\n\t\t\t\t\t\tapplyCodeBlockSuggestionId: undefined,\n\t\t\t\t\t\tfeature: 'inlineSuggestion',\n\t\t\t\t\t\tsource: providerId,\n\t\t\t\t\t\tlanguageId: completions.languageId,\n\t\t\t\t\t\teditDeltaInfo: editDeltaInfo,\n\t\t\t\t\t\tmodeId: undefined,\n\t\t\t\t\t\tmodelId: undefined,\n\t\t\t\t\t\tpresentation: item.isInlineEdit ? 'nextEditSuggestion' : 'inlineCompletion',\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tif (supportsHandleEvents) {\n\t\t\t\t\tawait this._proxy.$handleInlineCompletionDidShow(handle, completions.pid, item.idx, updatedInsertText);\n\t\t\t\t}\n\t\t\t},\n\t\t\thandlePartialAccept: async (completions, item, acceptedCharacters, info: languages.PartialAcceptInfo): Promise<void> => {\n\t\t\t\tif (supportsHandleEvents) {\n\t\t\t\t\tawait this._proxy.$handleInlineCompletionPartialAccept(handle, completions.pid, item.idx, acceptedCharacters, info);\n\t\t\t\t}\n\t\t\t},\n\t\t\thandleEndOfLifetime: async (completions, item, reason, lifetimeSummary) => {\n\n\t\t\t\tfunction mapReason<T1, T2>(reason: languages.InlineCompletionEndOfLifeReason<T1>, f: (reason: T1) => T2): languages.InlineCompletionEndOfLifeReason<T2> {\n\t\t\t\t\tif (reason.kind === languages.InlineCompletionEndOfLifeReasonKind.Ignored) {\n\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\t...reason,\n\t\t\t\t\t\t\tsupersededBy: reason.supersededBy ? f(reason.supersededBy) : undefined,\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\t\t\t\t\treturn reason;\n\t\t\t\t}\n\n\t\t\t\tif (supportsHandleEvents) {\n\t\t\t\t\tawait this._proxy.$handleInlineCompletionEndOfLifetime(handle, completions.pid, item.idx, mapReason(reason, i => ({ pid: completions.pid, idx: i.idx })));\n\t\t\t\t}\n\n\t\t\t\tif (reason.kind === languages.InlineCompletionEndOfLifeReasonKind.Accepted) {\n\t\t\t\t\tif (item.suggestionId !== undefined) {\n\t\t\t\t\t\tthis._aiEditTelemetryService.handleCodeAccepted({\n\t\t\t\t\t\t\tsuggestionId: item.suggestionId,\n\t\t\t\t\t\t\tfeature: 'inlineSuggestion',\n\t\t\t\t\t\t\tsource: providerId,\n\t\t\t\t\t\t\tlanguageId: completions.languageId,\n\t\t\t\t\t\t\teditDeltaInfo: EditDeltaInfo.tryCreate(\n\t\t\t\t\t\t\t\tlifetimeSummary.lineCountModified,\n\t\t\t\t\t\t\t\tlifetimeSummary.lineCountOriginal,\n\t\t\t\t\t\t\t\tlifetimeSummary.characterCountModified,\n\t\t\t\t\t\t\t\tlifetimeSummary.characterCountOriginal,\n\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\tmodeId: undefined,\n\t\t\t\t\t\t\tmodelId: undefined,\n\t\t\t\t\t\t\tpresentation: item.isInlineEdit ? 'nextEditSuggestion' : 'inlineCompletion',\n\t\t\t\t\t\t\tacceptanceMethod: 'accept',\n\t\t\t\t\t\t\tapplyCodeBlockSuggestionId: undefined,\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tconst endOfLifeSummary: InlineCompletionEndOfLifeEvent = {\n\t\t\t\t\topportunityId: lifetimeSummary.requestUuid,\n\t\t\t\t\tcorrelationId: lifetimeSummary.correlationId,\n\t\t\t\t\tshown: lifetimeSummary.shown,\n\t\t\t\t\tshownDuration: lifetimeSummary.shownDuration,\n\t\t\t\t\tshownDurationUncollapsed: lifetimeSummary.shownDurationUncollapsed,\n\t\t\t\t\ttimeUntilShown: lifetimeSummary.timeUntilShown,\n\t\t\t\t\ttimeUntilProviderRequest: lifetimeSummary.timeUntilProviderRequest,\n\t\t\t\t\ttimeUntilProviderResponse: lifetimeSummary.timeUntilProviderResponse,\n\t\t\t\t\teditorType: lifetimeSummary.editorType,\n\t\t\t\t\tviewKind: lifetimeSummary.viewKind,\n\t\t\t\t\tpreceeded: lifetimeSummary.preceeded,\n\t\t\t\t\trequestReason: lifetimeSummary.requestReason,\n\t\t\t\t\ttypingInterval: lifetimeSummary.typingInterval,\n\t\t\t\t\ttypingIntervalCharacterCount: lifetimeSummary.typingIntervalCharacterCount,\n\t\t\t\t\tlanguageId: lifetimeSummary.languageId,\n\t\t\t\t\tcursorColumnDistance: lifetimeSummary.cursorColumnDistance,\n\t\t\t\t\tcursorLineDistance: lifetimeSummary.cursorLineDistance,\n\t\t\t\t\tlineCountOriginal: lifetimeSummary.lineCountOriginal,\n\t\t\t\t\tlineCountModified: lifetimeSummary.lineCountModified,\n\t\t\t\t\tcharacterCountOriginal: lifetimeSummary.characterCountOriginal,\n\t\t\t\t\tcharacterCountModified: lifetimeSummary.characterCountModified,\n\t\t\t\t\tdisjointReplacements: lifetimeSummary.disjointReplacements,\n\t\t\t\t\tsameShapeReplacements: lifetimeSummary.sameShapeReplacements,\n\t\t\t\t\tselectedSuggestionInfo: lifetimeSummary.selectedSuggestionInfo,\n\t\t\t\t\textensionId,\n\t\t\t\t\textensionVersion,\n\t\t\t\t\tgroupId,\n\t\t\t\t\tavailableProviders: lifetimeSummary.availableProviders,\n\t\t\t\t\tpartiallyAccepted: lifetimeSummary.partiallyAccepted,\n\t\t\t\t\tpartiallyAcceptedCountSinceOriginal: lifetimeSummary.partiallyAcceptedCountSinceOriginal,\n\t\t\t\t\tpartiallyAcceptedRatioSinceOriginal: lifetimeSummary.partiallyAcceptedRatioSinceOriginal,\n\t\t\t\t\tpartiallyAcceptedCharactersSinceOriginal: lifetimeSummary.partiallyAcceptedCharactersSinceOriginal,\n\t\t\t\t\tsuperseded: reason.kind === InlineCompletionEndOfLifeReasonKind.Ignored && !!reason.supersededBy,\n\t\t\t\t\treason: reason.kind === InlineCompletionEndOfLifeReasonKind.Accepted ? 'accepted'\n\t\t\t\t\t\t: reason.kind === InlineCompletionEndOfLifeReasonKind.Rejected ? 'rejected'\n\t\t\t\t\t\t\t: reason.kind === InlineCompletionEndOfLifeReasonKind.Ignored ? 'ignored' : undefined,\n\t\t\t\t\tnoSuggestionReason: undefined,\n\t\t\t\t\tnotShownReason: lifetimeSummary.notShownReason,\n\t\t\t\t\t...forwardToChannelIf(isCopilotLikeExtension(extensionId)),\n\t\t\t\t};\n\n\t\t\t\tconst dataChannelForwardingTelemetryService = this._instantiationService.createInstance(DataChannelForwardingTelemetryService);\n\t\t\t\tsendInlineCompletionsEndOfLifeTelemetry(dataChannelForwardingTelemetryService, endOfLifeSummary);\n\t\t\t},\n\t\t\tdisposeInlineCompletions: (completions: IdentifiableInlineCompletions, reason: languages.InlineCompletionsDisposeReason): void => {\n\t\t\t\tthis._proxy.$freeInlineCompletionsList(handle, completions.pid, reason);\n\t\t\t},\n\t\t\thandleRejection: async (completions, item): Promise<void> => {\n\t\t\t\tif (supportsHandleEvents) {\n\t\t\t\t\tawait this._proxy.$handleInlineCompletionRejection(handle, completions.pid, item.idx);\n\t\t\t\t}\n\t\t\t},\n\t\t\tgroupId: groupId ?? extensionId,\n\t\t\tproviderId,\n\t\t\tyieldsToGroupIds: yieldsToExtensionIds,\n\t\t\texcludesGroupIds: excludesExtensionIds,\n\t\t\tdebounceDelayMs,\n\t\t\tdisplayName,\n\t\t\ttoString() {\n\t\t\t\treturn `InlineCompletionsProvider(${extensionId})`;\n\t\t\t},\n\t\t};\n\t\tif (typeof eventHandle === 'number') {\n\t\t\tconst emitter = new Emitter<void>();\n\t\t\tthis._registrations.set(eventHandle, emitter);\n\t\t\tprovider.onDidChangeInlineCompletions = emitter.event;\n\t\t}\n\t\tthis._registrations.set(handle, this._languageFeaturesService.inlineCompletionsProvider.register(selector, provider));\n\t}\n\n\t$emitInlineCompletionsChange(handle: number): void {\n\t\tconst obj = this._registrations.get(handle);\n\t\tif (obj instanceof Emitter) {\n\t\t\tobj.fire(undefined);\n\t\t}\n\t}\n\n\t// --- parameter hints\n\n\t$registerSignatureHelpProvider(handle: number, selector: IDocumentFilterDto[], metadata: ISignatureHelpProviderMetadataDto): void {\n\t\tthis._registrations.set(handle, this._languageFeaturesService.signatureHelpProvider.register(selector, {\n\n\t\t\tsignatureHelpTriggerCharacters: metadata.triggerCharacters,\n\t\t\tsignatureHelpRetriggerCharacters: metadata.retriggerCharacters,\n\n\t\t\tprovideSignatureHelp: async (model: ITextModel, position: EditorPosition, token: CancellationToken, context: languages.SignatureHelpContext): Promise<languages.SignatureHelpResult | undefined> => {\n\t\t\t\tconst result = await this._proxy.$provideSignatureHelp(handle, model.uri, position, context, token);\n\t\t\t\tif (!result) {\n\t\t\t\t\treturn undefined;\n\t\t\t\t}\n\t\t\t\treturn {\n\t\t\t\t\tvalue: result,\n\t\t\t\t\tdispose: () => {\n\t\t\t\t\t\tthis._proxy.$releaseSignatureHelp(handle, result.id);\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t}\n\t\t}));\n\t}\n\n\t// --- inline hints\n\n\t$registerInlayHintsProvider(handle: number, selector: IDocumentFilterDto[], supportsResolve: boolean, eventHandle: number | undefined, displayName: string | undefined): void {\n\t\tconst provider: languages.InlayHintsProvider = {\n\t\t\tdisplayName,\n\t\t\tprovideInlayHints: async (model: ITextModel, range: EditorRange, token: CancellationToken): Promise<languages.InlayHintList | undefined> => {\n\t\t\t\tconst result = await this._proxy.$provideInlayHints(handle, model.uri, range, token);\n\t\t\t\tif (!result) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\treturn {\n\t\t\t\t\thints: revive(result.hints),\n\t\t\t\t\tdispose: () => {\n\t\t\t\t\t\tif (result.cacheId) {\n\t\t\t\t\t\t\tthis._proxy.$releaseInlayHints(handle, result.cacheId);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t}\n\t\t};\n\t\tif (supportsResolve) {\n\t\t\tprovider.resolveInlayHint = async (hint, token) => {\n\t\t\t\tconst dto: IInlayHintDto = hint;\n\t\t\t\tif (!dto.cacheId) {\n\t\t\t\t\treturn hint;\n\t\t\t\t}\n\t\t\t\tconst result = await this._proxy.$resolveInlayHint(handle, dto.cacheId, token);\n\t\t\t\tif (token.isCancellationRequested) {\n\t\t\t\t\tthrow new CancellationError();\n\t\t\t\t}\n\t\t\t\tif (!result) {\n\t\t\t\t\treturn hint;\n\t\t\t\t}\n\t\t\t\treturn {\n\t\t\t\t\t...hint,\n\t\t\t\t\ttooltip: result.tooltip,\n\t\t\t\t\tlabel: revive<string | languages.InlayHintLabelPart[]>(result.label),\n\t\t\t\t\ttextEdits: result.textEdits\n\t\t\t\t};\n\t\t\t};\n\t\t}\n\t\tif (typeof eventHandle === 'number') {\n\t\t\tconst emitter = new Emitter<void>();\n\t\t\tthis._registrations.set(eventHandle, emitter);\n\t\t\tprovider.onDidChangeInlayHints = emitter.event;\n\t\t}\n\n\t\tthis._registrations.set(handle, this._languageFeaturesService.inlayHintsProvider.register(selector, provider));\n\t}\n\n\t$emitInlayHintsEvent(eventHandle: number): void {\n\t\tconst obj = this._registrations.get(eventHandle);\n\t\tif (obj instanceof Emitter) {\n\t\t\tobj.fire(undefined);\n\t\t}\n\t}\n\n\t// --- links\n\n\t$registerDocumentLinkProvider(handle: number, selector: IDocumentFilterDto[], supportsResolve: boolean): void {\n\t\tconst provider: languages.LinkProvider = {\n\t\t\tprovideLinks: (model, token) => {\n\t\t\t\treturn this._proxy.$provideDocumentLinks(handle, model.uri, token).then(dto => {\n\t\t\t\t\tif (!dto) {\n\t\t\t\t\t\treturn undefined;\n\t\t\t\t\t}\n\t\t\t\t\treturn {\n\t\t\t\t\t\tlinks: dto.links.map(MainThreadLanguageFeatures._reviveLinkDTO),\n\t\t\t\t\t\tdispose: () => {\n\t\t\t\t\t\t\tif (typeof dto.cacheId === 'number') {\n\t\t\t\t\t\t\t\tthis._proxy.$releaseDocumentLinks(handle, dto.cacheId);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\t\t\t\t});\n\t\t\t}\n\t\t};\n\t\tif (supportsResolve) {\n\t\t\tprovider.resolveLink = (link, token) => {\n\t\t\t\tconst dto: ILinkDto = link;\n\t\t\t\tif (!dto.cacheId) {\n\t\t\t\t\treturn link;\n\t\t\t\t}\n\t\t\t\treturn this._proxy.$resolveDocumentLink(handle, dto.cacheId, token).then(obj => {\n\t\t\t\t\treturn obj && MainThreadLanguageFeatures._reviveLinkDTO(obj);\n\t\t\t\t});\n\t\t\t};\n\t\t}\n\t\tthis._registrations.set(handle, this._languageFeaturesService.linkProvider.register(selector, provider));\n\t}\n\n\t// --- colors\n\n\t$registerDocumentColorProvider(handle: number, selector: IDocumentFilterDto[]): void {\n\t\tconst proxy = this._proxy;\n\t\tthis._registrations.set(handle, this._languageFeaturesService.colorProvider.register(selector, {\n\t\t\tprovideDocumentColors: (model, token) => {\n\t\t\t\treturn proxy.$provideDocumentColors(handle, model.uri, token)\n\t\t\t\t\t.then(documentColors => {\n\t\t\t\t\t\treturn documentColors.map(documentColor => {\n\t\t\t\t\t\t\tconst [red, green, blue, alpha] = documentColor.color;\n\t\t\t\t\t\t\tconst color = {\n\t\t\t\t\t\t\t\tred: red,\n\t\t\t\t\t\t\t\tgreen: green,\n\t\t\t\t\t\t\t\tblue: blue,\n\t\t\t\t\t\t\t\talpha\n\t\t\t\t\t\t\t};\n\n\t\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\t\tcolor,\n\t\t\t\t\t\t\t\trange: documentColor.range\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t},\n\n\t\t\tprovideColorPresentations: (model, colorInfo, token) => {\n\t\t\t\treturn proxy.$provideColorPresentations(handle, model.uri, {\n\t\t\t\t\tcolor: [colorInfo.color.red, colorInfo.color.green, colorInfo.color.blue, colorInfo.color.alpha],\n\t\t\t\t\trange: colorInfo.range\n\t\t\t\t}, token);\n\t\t\t}\n\t\t}));\n\t}\n\n\t// --- folding\n\n\t$registerFoldingRangeProvider(handle: number, selector: IDocumentFilterDto[], extensionId: ExtensionIdentifier, eventHandle: number | undefined): void {\n\t\tconst provider: languages.FoldingRangeProvider = {\n\t\t\tid: extensionId.value,\n\t\t\tprovideFoldingRanges: (model, context, token) => {\n\t\t\t\treturn this._proxy.$provideFoldingRanges(handle, model.uri, context, token);\n\t\t\t}\n\t\t};\n\n\t\tif (typeof eventHandle === 'number') {\n\t\t\tconst emitter = new Emitter<languages.FoldingRangeProvider>();\n\t\t\tthis._registrations.set(eventHandle, emitter);\n\t\t\tprovider.onDidChange = emitter.event;\n\t\t}\n\n\t\tthis._registrations.set(handle, this._languageFeaturesService.foldingRangeProvider.register(selector, provider));\n\t}\n\n\t$emitFoldingRangeEvent(eventHandle: number, event?: unknown): void {\n\t\tconst obj = this._registrations.get(eventHandle);\n\t\tif (obj instanceof Emitter) {\n\t\t\tobj.fire(event);\n\t\t}\n\t}\n\n\t// -- smart select\n\n\t$registerSelectionRangeProvider(handle: number, selector: IDocumentFilterDto[]): void {\n\t\tthis._registrations.set(handle, this._languageFeaturesService.selectionRangeProvider.register(selector, {\n\t\t\tprovideSelectionRanges: (model, positions, token) => {\n\t\t\t\treturn this._proxy.$provideSelectionRanges(handle, model.uri, positions, token);\n\t\t\t}\n\t\t}));\n\t}\n\n\t// --- call hierarchy\n\n\t$registerCallHierarchyProvider(handle: number, selector: IDocumentFilterDto[]): void {\n\t\tthis._registrations.set(handle, callh.CallHierarchyProviderRegistry.register(selector, {\n\n\t\t\tprepareCallHierarchy: async (document, position, token) => {\n\t\t\t\tconst items = await this._proxy.$prepareCallHierarchy(handle, document.uri, position, token);\n\t\t\t\tif (!items || items.length === 0) {\n\t\t\t\t\treturn undefined;\n\t\t\t\t}\n\t\t\t\treturn {\n\t\t\t\t\tdispose: () => {\n\t\t\t\t\t\tfor (const item of items) {\n\t\t\t\t\t\t\tthis._proxy.$releaseCallHierarchy(handle, item._sessionId);\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\troots: items.map(MainThreadLanguageFeatures._reviveCallHierarchyItemDto)\n\t\t\t\t};\n\t\t\t},\n\n\t\t\tprovideOutgoingCalls: async (item, token) => {\n\t\t\t\tconst outgoing = await this._proxy.$provideCallHierarchyOutgoingCalls(handle, item._sessionId, item._itemId, token);\n\t\t\t\tif (!outgoing) {\n\t\t\t\t\treturn outgoing;\n\t\t\t\t}\n\t\t\t\toutgoing.forEach(value => {\n\t\t\t\t\tvalue.to = MainThreadLanguageFeatures._reviveCallHierarchyItemDto(value.to);\n\t\t\t\t});\n\t\t\t\t// eslint-disable-next-line local/code-no-any-casts, @typescript-eslint/no-explicit-any\n\t\t\t\treturn <any>outgoing;\n\t\t\t},\n\t\t\tprovideIncomingCalls: async (item, token) => {\n\t\t\t\tconst incoming = await this._proxy.$provideCallHierarchyIncomingCalls(handle, item._sessionId, item._itemId, token);\n\t\t\t\tif (!incoming) {\n\t\t\t\t\treturn incoming;\n\t\t\t\t}\n\t\t\t\tincoming.forEach(value => {\n\t\t\t\t\tvalue.from = MainThreadLanguageFeatures._reviveCallHierarchyItemDto(value.from);\n\t\t\t\t});\n\t\t\t\t// eslint-disable-next-line local/code-no-any-casts, @typescript-eslint/no-explicit-any\n\t\t\t\treturn <any>incoming;\n\t\t\t}\n\t\t}));\n\t}\n\n\t// --- configuration\n\n\tprivate static _reviveRegExp(regExp: IRegExpDto): RegExp {\n\t\treturn new RegExp(regExp.pattern, regExp.flags);\n\t}\n\n\tprivate static _reviveIndentationRule(indentationRule: IIndentationRuleDto): IndentationRule {\n\t\treturn {\n\t\t\tdecreaseIndentPattern: MainThreadLanguageFeatures._reviveRegExp(indentationRule.decreaseIndentPattern),\n\t\t\tincreaseIndentPattern: MainThreadLanguageFeatures._reviveRegExp(indentationRule.increaseIndentPattern),\n\t\t\tindentNextLinePattern: indentationRule.indentNextLinePattern ? MainThreadLanguageFeatures._reviveRegExp(indentationRule.indentNextLinePattern) : undefined,\n\t\t\tunIndentedLinePattern: indentationRule.unIndentedLinePattern ? MainThreadLanguageFeatures._reviveRegExp(indentationRule.unIndentedLinePattern) : undefined,\n\t\t};\n\t}\n\n\tprivate static _reviveOnEnterRule(onEnterRule: IOnEnterRuleDto): OnEnterRule {\n\t\treturn {\n\t\t\tbeforeText: MainThreadLanguageFeatures._reviveRegExp(onEnterRule.beforeText),\n\t\t\tafterText: onEnterRule.afterText ? MainThreadLanguageFeatures._reviveRegExp(onEnterRule.afterText) : undefined,\n\t\t\tpreviousLineText: onEnterRule.previousLineText ? MainThreadLanguageFeatures._reviveRegExp(onEnterRule.previousLineText) : undefined,\n\t\t\taction: onEnterRule.action\n\t\t};\n\t}\n\n\tprivate static _reviveOnEnterRules(onEnterRules: IOnEnterRuleDto[]): OnEnterRule[] {\n\t\treturn onEnterRules.map(MainThreadLanguageFeatures._reviveOnEnterRule);\n\t}\n\n\t$setLanguageConfiguration(handle: number, languageId: string, _configuration: ILanguageConfigurationDto): void {\n\n\t\tconst configuration: LanguageConfiguration = {\n\t\t\tcomments: _configuration.comments,\n\t\t\tbrackets: _configuration.brackets,\n\t\t\twordPattern: _configuration.wordPattern ? MainThreadLanguageFeatures._reviveRegExp(_configuration.wordPattern) : undefined,\n\t\t\tindentationRules: _configuration.indentationRules ? MainThreadLanguageFeatures._reviveIndentationRule(_configuration.indentationRules) : undefined,\n\t\t\tonEnterRules: _configuration.onEnterRules ? MainThreadLanguageFeatures._reviveOnEnterRules(_configuration.onEnterRules) : undefined,\n\n\t\t\tautoClosingPairs: undefined,\n\t\t\tsurroundingPairs: undefined,\n\t\t\t__electricCharacterSupport: undefined\n\t\t};\n\n\t\tif (_configuration.autoClosingPairs) {\n\t\t\tconfiguration.autoClosingPairs = _configuration.autoClosingPairs;\n\t\t} else if (_configuration.__characterPairSupport) {\n\t\t\t// backwards compatibility\n\t\t\tconfiguration.autoClosingPairs = _configuration.__characterPairSupport.autoClosingPairs;\n\t\t}\n\n\t\tif (_configuration.__electricCharacterSupport && _configuration.__electricCharacterSupport.docComment) {\n\t\t\tconfiguration.__electricCharacterSupport = {\n\t\t\t\tdocComment: {\n\t\t\t\t\topen: _configuration.__electricCharacterSupport.docComment.open,\n\t\t\t\t\tclose: _configuration.__electricCharacterSupport.docComment.close\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\n\t\tif (this._languageService.isRegisteredLanguageId(languageId)) {\n\t\t\tthis._registrations.set(handle, this._languageConfigurationService.register(languageId, configuration, 100));\n\t\t}\n\t}\n\n\t// --- type hierarchy\n\n\t$registerTypeHierarchyProvider(handle: number, selector: IDocumentFilterDto[]): void {\n\t\tthis._registrations.set(handle, typeh.TypeHierarchyProviderRegistry.register(selector, {\n\n\t\t\tprepareTypeHierarchy: async (document, position, token) => {\n\t\t\t\tconst items = await this._proxy.$prepareTypeHierarchy(handle, document.uri, position, token);\n\t\t\t\tif (!items) {\n\t\t\t\t\treturn undefined;\n\t\t\t\t}\n\t\t\t\treturn {\n\t\t\t\t\tdispose: () => {\n\t\t\t\t\t\tfor (const item of items) {\n\t\t\t\t\t\t\tthis._proxy.$releaseTypeHierarchy(handle, item._sessionId);\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\troots: items.map(MainThreadLanguageFeatures._reviveTypeHierarchyItemDto)\n\t\t\t\t};\n\t\t\t},\n\n\t\t\tprovideSupertypes: async (item, token) => {\n\t\t\t\tconst supertypes = await this._proxy.$provideTypeHierarchySupertypes(handle, item._sessionId, item._itemId, token);\n\t\t\t\tif (!supertypes) {\n\t\t\t\t\treturn supertypes;\n\t\t\t\t}\n\t\t\t\treturn supertypes.map(MainThreadLanguageFeatures._reviveTypeHierarchyItemDto);\n\t\t\t},\n\t\t\tprovideSubtypes: async (item, token) => {\n\t\t\t\tconst subtypes = await this._proxy.$provideTypeHierarchySubtypes(handle, item._sessionId, item._itemId, token);\n\t\t\t\tif (!subtypes) {\n\t\t\t\t\treturn subtypes;\n\t\t\t\t}\n\t\t\t\treturn subtypes.map(MainThreadLanguageFeatures._reviveTypeHierarchyItemDto);\n\t\t\t}\n\t\t}));\n\t}\n\n\n\t// --- document drop Edits\n\n\tprivate readonly _documentOnDropEditProviders = new Map<number, MainThreadDocumentOnDropEditProvider>();\n\n\t$registerDocumentOnDropEditProvider(handle: number, selector: IDocumentFilterDto[], metadata: IDocumentDropEditProviderMetadata): void {\n\t\tconst provider = new MainThreadDocumentOnDropEditProvider(handle, this._proxy, metadata, this._uriIdentService);\n\t\tthis._documentOnDropEditProviders.set(handle, provider);\n\t\tthis._registrations.set(handle, combinedDisposable(\n\t\t\tthis._languageFeaturesService.documentDropEditProvider.register(selector, provider),\n\t\t\ttoDisposable(() => this._documentOnDropEditProviders.delete(handle)),\n\t\t));\n\t}\n\n\tasync $resolveDocumentOnDropFileData(handle: number, requestId: number, dataId: string): Promise<VSBuffer> {\n\t\tconst provider = this._documentOnDropEditProviders.get(handle);\n\t\tif (!provider) {\n\t\t\tthrow new Error('Could not find provider');\n\t\t}\n\t\treturn provider.resolveDocumentOnDropFileData(requestId, dataId);\n\t}\n}\n\nclass MainThreadPasteEditProvider implements languages.DocumentPasteEditProvider {\n\n\tprivate readonly dataTransfers = new DataTransferFileCache();\n\n\tpublic readonly copyMimeTypes: readonly string[];\n\tpublic readonly pasteMimeTypes: readonly string[];\n\tpublic readonly providedPasteEditKinds: readonly HierarchicalKind[];\n\n\treadonly prepareDocumentPaste?: languages.DocumentPasteEditProvider['prepareDocumentPaste'];\n\treadonly provideDocumentPasteEdits?: languages.DocumentPasteEditProvider['provideDocumentPasteEdits'];\n\treadonly resolveDocumentPasteEdit?: languages.DocumentPasteEditProvider['resolveDocumentPasteEdit'];\n\n\tconstructor(\n\t\tprivate readonly _handle: number,\n\t\tprivate readonly _proxy: ExtHostLanguageFeaturesShape,\n\t\tmetadata: IPasteEditProviderMetadataDto,\n\t\t@IUriIdentityService private readonly _uriIdentService: IUriIdentityService\n\t) {\n\t\tthis.copyMimeTypes = metadata.copyMimeTypes ?? [];\n\t\tthis.pasteMimeTypes = metadata.pasteMimeTypes ?? [];\n\t\tthis.providedPasteEditKinds = metadata.providedPasteEditKinds?.map(kind => new HierarchicalKind(kind)) ?? [];\n\n\t\tif (metadata.supportsCopy) {\n\t\t\tthis.prepareDocumentPaste = async (model: ITextModel, selections: readonly IRange[], dataTransfer: IReadonlyVSDataTransfer, token: CancellationToken): Promise<IReadonlyVSDataTransfer | undefined> => {\n\t\t\t\tconst dataTransferDto = await typeConvert.DataTransfer.fromList(dataTransfer);\n\t\t\t\tif (token.isCancellationRequested) {\n\t\t\t\t\treturn undefined;\n\t\t\t\t}\n\n\t\t\t\tconst newDataTransfer = await this._proxy.$prepareDocumentPaste(_handle, model.uri, selections, dataTransferDto, token);\n\t\t\t\tif (!newDataTransfer) {\n\t\t\t\t\treturn undefined;\n\t\t\t\t}\n\n\t\t\t\tconst dataTransferOut = new VSDataTransfer();\n\t\t\t\tfor (const [type, item] of newDataTransfer.items) {\n\t\t\t\t\tdataTransferOut.replace(type, createStringDataTransferItem(item.asString, item.id));\n\t\t\t\t}\n\t\t\t\treturn dataTransferOut;\n\t\t\t};\n\t\t}\n\n\t\tif (metadata.supportsPaste) {\n\t\t\tthis.provideDocumentPasteEdits = async (model: ITextModel, selections: Selection[], dataTransfer: IReadonlyVSDataTransfer, context: languages.DocumentPasteContext, token: CancellationToken) => {\n\t\t\t\tconst request = this.dataTransfers.add(dataTransfer);\n\t\t\t\ttry {\n\t\t\t\t\tconst dataTransferDto = await typeConvert.DataTransfer.fromList(dataTransfer);\n\t\t\t\t\tif (token.isCancellationRequested) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tconst edits = await this._proxy.$providePasteEdits(this._handle, request.id, model.uri, selections, dataTransferDto, {\n\t\t\t\t\t\tonly: context.only?.value,\n\t\t\t\t\t\ttriggerKind: context.triggerKind,\n\t\t\t\t\t}, token);\n\t\t\t\t\tif (!edits) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn {\n\t\t\t\t\t\tedits: edits.map((edit): languages.DocumentPasteEdit => {\n\t\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\t\t...edit,\n\t\t\t\t\t\t\t\tkind: edit.kind ? new HierarchicalKind(edit.kind.value) : new HierarchicalKind(''),\n\t\t\t\t\t\t\t\tyieldTo: edit.yieldTo?.map(x => ({ kind: new HierarchicalKind(x) })),\n\t\t\t\t\t\t\t\tadditionalEdit: edit.additionalEdit ? reviveWorkspaceEditDto(edit.additionalEdit, this._uriIdentService, dataId => this.resolveFileData(request.id, dataId)) : undefined,\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tdispose: () => {\n\t\t\t\t\t\t\tthis._proxy.$releasePasteEdits(this._handle, request.id);\n\t\t\t\t\t\t},\n\t\t\t\t\t};\n\t\t\t\t} finally {\n\t\t\t\t\trequest.dispose();\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\t\tif (metadata.supportsResolve) {\n\t\t\tthis.resolveDocumentPasteEdit = async (edit: languages.DocumentPasteEdit, token: CancellationToken) => {\n\t\t\t\tconst resolved = await this._proxy.$resolvePasteEdit(this._handle, (<IPasteEditDto>edit)._cacheId!, token);\n\t\t\t\tif (typeof resolved.insertText !== 'undefined') {\n\t\t\t\t\tedit.insertText = resolved.insertText;\n\t\t\t\t}\n\n\t\t\t\tif (resolved.additionalEdit) {\n\t\t\t\t\tedit.additionalEdit = reviveWorkspaceEditDto(resolved.additionalEdit, this._uriIdentService);\n\t\t\t\t}\n\t\t\t\treturn edit;\n\t\t\t};\n\t\t}\n\t}\n\n\tresolveFileData(requestId: number, dataId: string): Promise<VSBuffer> {\n\t\treturn this.dataTransfers.resolveFileData(requestId, dataId);\n\t}\n}\n\nclass MainThreadDocumentOnDropEditProvider implements languages.DocumentDropEditProvider {\n\n\tprivate readonly dataTransfers = new DataTransferFileCache();\n\n\treadonly dropMimeTypes?: readonly string[];\n\n\treadonly providedDropEditKinds: readonly HierarchicalKind[] | undefined;\n\n\treadonly resolveDocumentDropEdit?: languages.DocumentDropEditProvider['resolveDocumentDropEdit'];\n\n\tconstructor(\n\t\tprivate readonly _handle: number,\n\t\tprivate readonly _proxy: ExtHostLanguageFeaturesShape,\n\t\tmetadata: IDocumentDropEditProviderMetadata | undefined,\n\t\t@IUriIdentityService private readonly _uriIdentService: IUriIdentityService\n\t) {\n\t\tthis.dropMimeTypes = metadata?.dropMimeTypes ?? ['*/*'];\n\t\tthis.providedDropEditKinds = metadata?.providedDropKinds?.map(kind => new HierarchicalKind(kind));\n\n\t\tif (metadata?.supportsResolve) {\n\t\t\tthis.resolveDocumentDropEdit = async (edit, token) => {\n\t\t\t\tconst resolved = await this._proxy.$resolvePasteEdit(this._handle, (<IDocumentDropEditDto>edit)._cacheId!, token);\n\t\t\t\tif (resolved.additionalEdit) {\n\t\t\t\t\tedit.additionalEdit = reviveWorkspaceEditDto(resolved.additionalEdit, this._uriIdentService);\n\t\t\t\t}\n\t\t\t\treturn edit;\n\t\t\t};\n\t\t}\n\t}\n\n\tasync provideDocumentDropEdits(model: ITextModel, position: IPosition, dataTransfer: IReadonlyVSDataTransfer, token: CancellationToken): Promise<languages.DocumentDropEditsSession | undefined> {\n\t\tconst request = this.dataTransfers.add(dataTransfer);\n\t\ttry {\n\t\t\tconst dataTransferDto = await typeConvert.DataTransfer.fromList(dataTransfer);\n\t\t\tif (token.isCancellationRequested) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst edits = await this._proxy.$provideDocumentOnDropEdits(this._handle, request.id, model.uri, position, dataTransferDto, token);\n\t\t\tif (!edits) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\tedits: edits.map(edit => {\n\t\t\t\t\treturn {\n\t\t\t\t\t\t...edit,\n\t\t\t\t\t\tyieldTo: edit.yieldTo?.map(x => ({ kind: new HierarchicalKind(x) })),\n\t\t\t\t\t\tkind: edit.kind ? new HierarchicalKind(edit.kind) : undefined,\n\t\t\t\t\t\tadditionalEdit: reviveWorkspaceEditDto(edit.additionalEdit, this._uriIdentService, dataId => this.resolveDocumentOnDropFileData(request.id, dataId)),\n\t\t\t\t\t};\n\t\t\t\t}),\n\t\t\t\tdispose: () => {\n\t\t\t\t\tthis._proxy.$releaseDocumentOnDropEdits(this._handle, request.id);\n\t\t\t\t},\n\t\t\t};\n\t\t} finally {\n\t\t\trequest.dispose();\n\t\t}\n\t}\n\n\tpublic resolveDocumentOnDropFileData(requestId: number, dataId: string): Promise<VSBuffer> {\n\t\treturn this.dataTransfers.resolveFileData(requestId, dataId);\n\t}\n}\n\nexport class MainThreadDocumentSemanticTokensProvider implements languages.DocumentSemanticTokensProvider {\n\n\tconstructor(\n\t\tprivate readonly _proxy: ExtHostLanguageFeaturesShape,\n\t\tprivate readonly _handle: number,\n\t\tprivate readonly _legend: languages.SemanticTokensLegend,\n\t\tpublic readonly onDidChange: Event<void> | undefined,\n\t) {\n\t}\n\n\tpublic releaseDocumentSemanticTokens(resultId: string | undefined): void {\n\t\tif (resultId) {\n\t\t\tthis._proxy.$releaseDocumentSemanticTokens(this._handle, parseInt(resultId, 10));\n\t\t}\n\t}\n\n\tpublic getLegend(): languages.SemanticTokensLegend {\n\t\treturn this._legend;\n\t}\n\n\tasync provideDocumentSemanticTokens(model: ITextModel, lastResultId: string | null, token: CancellationToken): Promise<languages.SemanticTokens | languages.SemanticTokensEdits | null> {\n\t\tconst nLastResultId = lastResultId ? parseInt(lastResultId, 10) : 0;\n\t\tconst encodedDto = await this._proxy.$provideDocumentSemanticTokens(this._handle, model.uri, nLastResultId, token);\n\t\tif (!encodedDto) {\n\t\t\treturn null;\n\t\t}\n\t\tif (token.isCancellationRequested) {\n\t\t\treturn null;\n\t\t}\n\t\tconst dto = decodeSemanticTokensDto(encodedDto);\n\t\tif (dto.type === 'full') {\n\t\t\treturn {\n\t\t\t\tresultId: String(dto.id),\n\t\t\t\tdata: dto.data\n\t\t\t};\n\t\t}\n\t\treturn {\n\t\t\tresultId: String(dto.id),\n\t\t\tedits: dto.deltas\n\t\t};\n\t}\n}\n\nexport class MainThreadDocumentRangeSemanticTokensProvider implements languages.DocumentRangeSemanticTokensProvider {\n\n\tconstructor(\n\t\tprivate readonly _proxy: ExtHostLanguageFeaturesShape,\n\t\tprivate readonly _handle: number,\n\t\tprivate readonly _legend: languages.SemanticTokensLegend,\n\t\tpublic readonly onDidChange: Event<void> | undefined,\n\t) {\n\t}\n\n\tpublic getLegend(): languages.SemanticTokensLegend {\n\t\treturn this._legend;\n\t}\n\n\tasync provideDocumentRangeSemanticTokens(model: ITextModel, range: EditorRange, token: CancellationToken): Promise<languages.SemanticTokens | null> {\n\t\tconst encodedDto = await this._proxy.$provideDocumentRangeSemanticTokens(this._handle, model.uri, range, token);\n\t\tif (!encodedDto) {\n\t\t\treturn null;\n\t\t}\n\t\tif (token.isCancellationRequested) {\n\t\t\treturn null;\n\t\t}\n\t\tconst dto = decodeSemanticTokensDto(encodedDto);\n\t\tif (dto.type === 'full') {\n\t\t\treturn {\n\t\t\t\tresultId: String(dto.id),\n\t\t\t\tdata: dto.data\n\t\t\t};\n\t\t}\n\t\tthrow new Error(`Unexpected`);\n\t}\n}\n"]}