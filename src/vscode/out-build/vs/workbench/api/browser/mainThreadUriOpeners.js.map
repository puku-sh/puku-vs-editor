{"version":3,"sources":["vs/workbench/api/browser/mainThreadUriOpeners.ts"],"names":[],"mappings":"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","file":"mainThreadUriOpeners.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Action } from '../../../base/common/actions.js';\nimport { isCancellationError } from '../../../base/common/errors.js';\nimport { Disposable } from '../../../base/common/lifecycle.js';\nimport { Schemas } from '../../../base/common/network.js';\nimport { URI } from '../../../base/common/uri.js';\nimport { localize } from '../../../nls.js';\nimport { ExtensionIdentifier } from '../../../platform/extensions/common/extensions.js';\nimport { INotificationService, Severity } from '../../../platform/notification/common/notification.js';\nimport { IOpenerService } from '../../../platform/opener/common/opener.js';\nimport { IStorageService } from '../../../platform/storage/common/storage.js';\nimport { ExtHostContext, ExtHostUriOpenersShape, MainContext, MainThreadUriOpenersShape } from '../common/extHost.protocol.js';\nimport { defaultExternalUriOpenerId } from '../../contrib/externalUriOpener/common/configuration.js';\nimport { ContributedExternalUriOpenersStore } from '../../contrib/externalUriOpener/common/contributedOpeners.js';\nimport { IExternalOpenerProvider, IExternalUriOpener, IExternalUriOpenerService } from '../../contrib/externalUriOpener/common/externalUriOpenerService.js';\nimport { IExtensionService } from '../../services/extensions/common/extensions.js';\nimport { extHostNamedCustomer, IExtHostContext } from '../../services/extensions/common/extHostCustomers.js';\n\ninterface RegisteredOpenerMetadata {\n\treadonly schemes: ReadonlySet<string>;\n\treadonly extensionId: ExtensionIdentifier;\n\treadonly label: string;\n}\n\n@extHostNamedCustomer(MainContext.MainThreadUriOpeners)\nexport class MainThreadUriOpeners extends Disposable implements MainThreadUriOpenersShape, IExternalOpenerProvider {\n\n\tprivate readonly proxy: ExtHostUriOpenersShape;\n\tprivate readonly _registeredOpeners = new Map<string, RegisteredOpenerMetadata>();\n\tprivate readonly _contributedExternalUriOpenersStore: ContributedExternalUriOpenersStore;\n\n\tconstructor(\n\t\tcontext: IExtHostContext,\n\t\t@IStorageService storageService: IStorageService,\n\t\t@IExternalUriOpenerService externalUriOpenerService: IExternalUriOpenerService,\n\t\t@IExtensionService private readonly extensionService: IExtensionService,\n\t\t@IOpenerService private readonly openerService: IOpenerService,\n\t\t@INotificationService private readonly notificationService: INotificationService,\n\t) {\n\t\tsuper();\n\t\tthis.proxy = context.getProxy(ExtHostContext.ExtHostUriOpeners);\n\n\t\tthis._register(externalUriOpenerService.registerExternalOpenerProvider(this));\n\n\t\tthis._contributedExternalUriOpenersStore = this._register(new ContributedExternalUriOpenersStore(storageService, extensionService));\n\t}\n\n\tpublic async *getOpeners(targetUri: URI): AsyncIterable<IExternalUriOpener> {\n\n\t\t// Currently we only allow openers for http and https urls\n\t\tif (targetUri.scheme !== Schemas.http && targetUri.scheme !== Schemas.https) {\n\t\t\treturn;\n\t\t}\n\n\t\tawait this.extensionService.activateByEvent(`onOpenExternalUri:${targetUri.scheme}`);\n\n\t\tfor (const [id, openerMetadata] of this._registeredOpeners) {\n\t\t\tif (openerMetadata.schemes.has(targetUri.scheme)) {\n\t\t\t\tyield this.createOpener(id, openerMetadata);\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate createOpener(id: string, metadata: RegisteredOpenerMetadata): IExternalUriOpener {\n\t\treturn {\n\t\t\tid: id,\n\t\t\tlabel: metadata.label,\n\t\t\tcanOpen: (uri, token) => {\n\t\t\t\treturn this.proxy.$canOpenUri(id, uri, token);\n\t\t\t},\n\t\t\topenExternalUri: async (uri, ctx, token) => {\n\t\t\t\ttry {\n\t\t\t\t\tawait this.proxy.$openUri(id, { resolvedUri: uri, sourceUri: ctx.sourceUri }, token);\n\t\t\t\t} catch (e) {\n\t\t\t\t\tif (!isCancellationError(e)) {\n\t\t\t\t\t\tconst openDefaultAction = new Action('default', localize('openerFailedUseDefault', \"Open using default opener\"), undefined, undefined, async () => {\n\t\t\t\t\t\t\tawait this.openerService.open(uri, {\n\t\t\t\t\t\t\t\tallowTunneling: false,\n\t\t\t\t\t\t\t\tallowContributedOpeners: defaultExternalUriOpenerId,\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t});\n\t\t\t\t\t\topenDefaultAction.tooltip = uri.toString();\n\n\t\t\t\t\t\tthis.notificationService.notify({\n\t\t\t\t\t\t\tseverity: Severity.Error,\n\t\t\t\t\t\t\tmessage: localize({\n\t\t\t\t\t\t\t\tkey: 'openerFailedMessage',\n\t\t\t\t\t\t\t\tcomment: ['{0} is the id of the opener. {1} is the url being opened.'],\n\t\t\t\t\t\t\t}, 'Could not open uri with \\'{0}\\': {1}', id, e.toString()),\n\t\t\t\t\t\t\tactions: {\n\t\t\t\t\t\t\t\tprimary: [\n\t\t\t\t\t\t\t\t\topenDefaultAction\n\t\t\t\t\t\t\t\t]\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn true;\n\t\t\t},\n\t\t};\n\t}\n\n\tasync $registerUriOpener(\n\t\tid: string,\n\t\tschemes: readonly string[],\n\t\textensionId: ExtensionIdentifier,\n\t\tlabel: string,\n\t): Promise<void> {\n\t\tif (this._registeredOpeners.has(id)) {\n\t\t\tthrow new Error(`Opener with id '${id}' already registered`);\n\t\t}\n\n\t\tthis._registeredOpeners.set(id, {\n\t\t\tschemes: new Set(schemes),\n\t\t\tlabel,\n\t\t\textensionId,\n\t\t});\n\n\t\tthis._contributedExternalUriOpenersStore.didRegisterOpener(id, extensionId.value);\n\t}\n\n\tasync $unregisterUriOpener(id: string): Promise<void> {\n\t\tthis._registeredOpeners.delete(id);\n\t\tthis._contributedExternalUriOpenersStore.delete(id);\n\t}\n\n\toverride dispose(): void {\n\t\tsuper.dispose();\n\t\tthis._registeredOpeners.clear();\n\t}\n}\n"]}