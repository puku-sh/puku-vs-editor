{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/api/browser/mainThreadDocumentsAndEditors.ts","vs/workbench/api/browser/mainThreadDocumentsAndEditors.ts"],"names":[],"mappings":"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","file":"mainThreadDocumentsAndEditors.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Event } from '../../../base/common/event.js';\nimport { combinedDisposable, DisposableStore, DisposableMap } from '../../../base/common/lifecycle.js';\nimport { ICodeEditor, isCodeEditor, isDiffEditor, IActiveCodeEditor } from '../../../editor/browser/editorBrowser.js';\nimport { ICodeEditorService } from '../../../editor/browser/services/codeEditorService.js';\nimport { IEditor } from '../../../editor/common/editorCommon.js';\nimport { ITextModel, shouldSynchronizeModel } from '../../../editor/common/model.js';\nimport { IModelService } from '../../../editor/common/services/model.js';\nimport { ITextModelService } from '../../../editor/common/services/resolverService.js';\nimport { IFileService } from '../../../platform/files/common/files.js';\nimport { extHostCustomer, IExtHostContext } from '../../services/extensions/common/extHostCustomers.js';\nimport { MainThreadDocuments } from './mainThreadDocuments.js';\nimport { MainThreadTextEditor } from './mainThreadEditor.js';\nimport { MainThreadTextEditors } from './mainThreadEditors.js';\nimport { ExtHostContext, ExtHostDocumentsAndEditorsShape, IDocumentsAndEditorsDelta, IModelAddedData, ITextEditorAddData, MainContext } from '../common/extHost.protocol.js';\nimport { AbstractTextEditor } from '../../browser/parts/editor/textEditor.js';\nimport { IEditorPane } from '../../common/editor.js';\nimport { EditorGroupColumn, editorGroupToColumn } from '../../services/editor/common/editorGroupColumn.js';\nimport { IEditorService } from '../../services/editor/common/editorService.js';\nimport { IEditorGroupsService } from '../../services/editor/common/editorGroupsService.js';\nimport { ITextFileService } from '../../services/textfile/common/textfiles.js';\nimport { IWorkbenchEnvironmentService } from '../../services/environment/common/environmentService.js';\nimport { IWorkingCopyFileService } from '../../services/workingCopy/common/workingCopyFileService.js';\nimport { IUriIdentityService } from '../../../platform/uriIdentity/common/uriIdentity.js';\nimport { IClipboardService } from '../../../platform/clipboard/common/clipboardService.js';\nimport { IPathService } from '../../services/path/common/pathService.js';\nimport { diffSets, diffMaps } from '../../../base/common/collections.js';\nimport { IPaneCompositePartService } from '../../services/panecomposite/browser/panecomposite.js';\nimport { ViewContainerLocation } from '../../common/views.js';\nimport { IConfigurationService } from '../../../platform/configuration/common/configuration.js';\nimport { IQuickDiffModelService } from '../../contrib/scm/browser/quickDiffModel.js';\n\n\nclass TextEditorSnapshot {\n\n\treadonly id: string;\n\n\tconstructor(\n\t\treadonly editor: IActiveCodeEditor,\n\t) {\n\t\tthis.id = `${editor.getId()},${editor.getModel().id}`;\n\t}\n}\n\nclass DocumentAndEditorStateDelta {\n\n\treadonly isEmpty: boolean;\n\n\tconstructor(\n\t\treadonly removedDocuments: ITextModel[],\n\t\treadonly addedDocuments: ITextModel[],\n\t\treadonly removedEditors: TextEditorSnapshot[],\n\t\treadonly addedEditors: TextEditorSnapshot[],\n\t\treadonly oldActiveEditor: string | null | undefined,\n\t\treadonly newActiveEditor: string | null | undefined,\n\t) {\n\t\tthis.isEmpty = this.removedDocuments.length === 0\n\t\t\t&& this.addedDocuments.length === 0\n\t\t\t&& this.removedEditors.length === 0\n\t\t\t&& this.addedEditors.length === 0\n\t\t\t&& oldActiveEditor === newActiveEditor;\n\t}\n\n\ttoString(): string {\n\t\tlet ret = 'DocumentAndEditorStateDelta\\n';\n\t\tret += `\\tRemoved Documents: [${this.removedDocuments.map(d => d.uri.toString(true)).join(', ')}]\\n`;\n\t\tret += `\\tAdded Documents: [${this.addedDocuments.map(d => d.uri.toString(true)).join(', ')}]\\n`;\n\t\tret += `\\tRemoved Editors: [${this.removedEditors.map(e => e.id).join(', ')}]\\n`;\n\t\tret += `\\tAdded Editors: [${this.addedEditors.map(e => e.id).join(', ')}]\\n`;\n\t\tret += `\\tNew Active Editor: ${this.newActiveEditor}\\n`;\n\t\treturn ret;\n\t}\n}\n\nclass DocumentAndEditorState {\n\n\tstatic compute(before: DocumentAndEditorState | undefined, after: DocumentAndEditorState): DocumentAndEditorStateDelta {\n\t\tif (!before) {\n\t\t\treturn new DocumentAndEditorStateDelta(\n\t\t\t\t[], [...after.documents.values()],\n\t\t\t\t[], [...after.textEditors.values()],\n\t\t\t\tundefined, after.activeEditor\n\t\t\t);\n\t\t}\n\t\tconst documentDelta = diffSets(before.documents, after.documents);\n\t\tconst editorDelta = diffMaps(before.textEditors, after.textEditors);\n\t\tconst oldActiveEditor = before.activeEditor !== after.activeEditor ? before.activeEditor : undefined;\n\t\tconst newActiveEditor = before.activeEditor !== after.activeEditor ? after.activeEditor : undefined;\n\n\t\treturn new DocumentAndEditorStateDelta(\n\t\t\tdocumentDelta.removed, documentDelta.added,\n\t\t\teditorDelta.removed, editorDelta.added,\n\t\t\toldActiveEditor, newActiveEditor\n\t\t);\n\t}\n\n\tconstructor(\n\t\treadonly documents: Set<ITextModel>,\n\t\treadonly textEditors: Map<string, TextEditorSnapshot>,\n\t\treadonly activeEditor: string | null | undefined,\n\t) {\n\t\t//\n\t}\n}\n\nconst enum ActiveEditorOrder {\n\tEditor, Panel\n}\n\nclass MainThreadDocumentAndEditorStateComputer {\n\n\tprivate readonly _toDispose = new DisposableStore();\n\tprivate readonly _toDisposeOnEditorRemove = new DisposableMap<string>();\n\tprivate _currentState?: DocumentAndEditorState;\n\tprivate _activeEditorOrder: ActiveEditorOrder = ActiveEditorOrder.Editor;\n\n\tconstructor(\n\t\tprivate readonly _onDidChangeState: (delta: DocumentAndEditorStateDelta) => void,\n\t\t@IModelService private readonly _modelService: IModelService,\n\t\t@ICodeEditorService private readonly _codeEditorService: ICodeEditorService,\n\t\t@IEditorService private readonly _editorService: IEditorService,\n\t\t@IPaneCompositePartService private readonly _paneCompositeService: IPaneCompositePartService,\n\t) {\n\t\tthis._modelService.onModelAdded(this._updateStateOnModelAdd, this, this._toDispose);\n\t\tthis._modelService.onModelRemoved(_ => this._updateState(), this, this._toDispose);\n\t\tthis._editorService.onDidActiveEditorChange(_ => this._updateState(), this, this._toDispose);\n\n\t\tthis._codeEditorService.onCodeEditorAdd(this._onDidAddEditor, this, this._toDispose);\n\t\tthis._codeEditorService.onCodeEditorRemove(this._onDidRemoveEditor, this, this._toDispose);\n\t\tthis._codeEditorService.listCodeEditors().forEach(this._onDidAddEditor, this);\n\n\t\tEvent.filter(this._paneCompositeService.onDidPaneCompositeOpen, event => event.viewContainerLocation === ViewContainerLocation.Panel)(_ => this._activeEditorOrder = ActiveEditorOrder.Panel, undefined, this._toDispose);\n\t\tEvent.filter(this._paneCompositeService.onDidPaneCompositeClose, event => event.viewContainerLocation === ViewContainerLocation.Panel)(_ => this._activeEditorOrder = ActiveEditorOrder.Editor, undefined, this._toDispose);\n\t\tthis._editorService.onDidVisibleEditorsChange(_ => this._activeEditorOrder = ActiveEditorOrder.Editor, undefined, this._toDispose);\n\n\t\tthis._updateState();\n\t}\n\n\tdispose(): void {\n\t\tthis._toDispose.dispose();\n\t\tthis._toDisposeOnEditorRemove.dispose();\n\t}\n\n\tprivate _onDidAddEditor(e: ICodeEditor): void {\n\t\tthis._toDisposeOnEditorRemove.set(e.getId(), combinedDisposable(\n\t\t\te.onDidChangeModel(() => this._updateState()),\n\t\t\te.onDidFocusEditorText(() => this._updateState()),\n\t\t\te.onDidFocusEditorWidget(() => this._updateState(e))\n\t\t));\n\t\tthis._updateState();\n\t}\n\n\tprivate _onDidRemoveEditor(e: ICodeEditor): void {\n\t\tconst id = e.getId();\n\t\tif (this._toDisposeOnEditorRemove.has(id)) {\n\t\t\tthis._toDisposeOnEditorRemove.deleteAndDispose(id);\n\t\t\tthis._updateState();\n\t\t}\n\t}\n\n\tprivate _updateStateOnModelAdd(model: ITextModel): void {\n\t\tif (!shouldSynchronizeModel(model)) {\n\t\t\t// ignore\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this._currentState) {\n\t\t\t// too early\n\t\t\tthis._updateState();\n\t\t\treturn;\n\t\t}\n\n\t\t// small (fast) delta\n\t\tthis._currentState = new DocumentAndEditorState(\n\t\t\tthis._currentState.documents.add(model),\n\t\t\tthis._currentState.textEditors,\n\t\t\tthis._currentState.activeEditor\n\t\t);\n\n\t\tthis._onDidChangeState(new DocumentAndEditorStateDelta(\n\t\t\t[], [model],\n\t\t\t[], [],\n\t\t\tundefined, undefined\n\t\t));\n\t}\n\n\tprivate _updateState(widgetFocusCandidate?: ICodeEditor): void {\n\n\t\t// models: ignore too large models\n\t\tconst models = new Set<ITextModel>();\n\t\tfor (const model of this._modelService.getModels()) {\n\t\t\tif (shouldSynchronizeModel(model)) {\n\t\t\t\tmodels.add(model);\n\t\t\t}\n\t\t}\n\n\t\t// editor: only take those that have a not too large model\n\t\tconst editors = new Map<string, TextEditorSnapshot>();\n\t\tlet activeEditor: string | null = null; // Strict null work. This doesn't like being undefined!\n\n\t\tfor (const editor of this._codeEditorService.listCodeEditors()) {\n\t\t\tif (editor.isSimpleWidget) {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tconst model = editor.getModel();\n\t\t\tif (editor.hasModel() && model && shouldSynchronizeModel(model)\n\t\t\t\t&& !model.isDisposed() // model disposed\n\t\t\t\t&& Boolean(this._modelService.getModel(model.uri)) // model disposing, the flag didn't flip yet but the model service already removed it\n\t\t\t) {\n\t\t\t\tconst apiEditor = new TextEditorSnapshot(editor);\n\t\t\t\teditors.set(apiEditor.id, apiEditor);\n\t\t\t\tif (editor.hasTextFocus() || (widgetFocusCandidate === editor && editor.hasWidgetFocus())) {\n\t\t\t\t\t// text focus has priority, widget focus is tricky because multiple\n\t\t\t\t\t// editors might claim widget focus at the same time. therefore we use a\n\t\t\t\t\t// candidate (which is the editor that has raised an widget focus event)\n\t\t\t\t\t// in addition to the widget focus check\n\t\t\t\t\tactiveEditor = apiEditor.id;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// active editor: if none of the previous editors had focus we try\n\t\t// to match output panels or the active workbench editor with\n\t\t// one of editor we have just computed\n\t\tif (!activeEditor) {\n\t\t\tlet candidate: IEditor | undefined;\n\t\t\tif (this._activeEditorOrder === ActiveEditorOrder.Editor) {\n\t\t\t\tcandidate = this._getActiveEditorFromEditorPart() || this._getActiveEditorFromPanel();\n\t\t\t} else {\n\t\t\t\tcandidate = this._getActiveEditorFromPanel() || this._getActiveEditorFromEditorPart();\n\t\t\t}\n\n\t\t\tif (candidate) {\n\t\t\t\tfor (const snapshot of editors.values()) {\n\t\t\t\t\tif (candidate === snapshot.editor) {\n\t\t\t\t\t\tactiveEditor = snapshot.id;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// compute new state and compare against old\n\t\tconst newState = new DocumentAndEditorState(models, editors, activeEditor);\n\t\tconst delta = DocumentAndEditorState.compute(this._currentState, newState);\n\t\tif (!delta.isEmpty) {\n\t\t\tthis._currentState = newState;\n\t\t\tthis._onDidChangeState(delta);\n\t\t}\n\t}\n\n\tprivate _getActiveEditorFromPanel(): IEditor | undefined {\n\t\tconst panel = this._paneCompositeService.getActivePaneComposite(ViewContainerLocation.Panel);\n\t\tif (panel instanceof AbstractTextEditor) {\n\t\t\tconst control = panel.getControl();\n\t\t\tif (isCodeEditor(control)) {\n\t\t\t\treturn control;\n\t\t\t}\n\t\t}\n\n\t\treturn undefined;\n\t}\n\n\tprivate _getActiveEditorFromEditorPart(): IEditor | undefined {\n\t\tlet activeTextEditorControl = this._editorService.activeTextEditorControl;\n\t\tif (isDiffEditor(activeTextEditorControl)) {\n\t\t\tactiveTextEditorControl = activeTextEditorControl.getModifiedEditor();\n\t\t}\n\t\treturn activeTextEditorControl;\n\t}\n}\n\n@extHostCustomer\nexport class MainThreadDocumentsAndEditors {\n\n\tprivate readonly _toDispose = new DisposableStore();\n\tprivate readonly _proxy: ExtHostDocumentsAndEditorsShape;\n\tprivate readonly _mainThreadDocuments: MainThreadDocuments;\n\tprivate readonly _mainThreadEditors: MainThreadTextEditors;\n\tprivate readonly _textEditors = new Map<string, MainThreadTextEditor>();\n\n\tconstructor(\n\t\textHostContext: IExtHostContext,\n\t\t@IModelService private readonly _modelService: IModelService,\n\t\t@ITextFileService private readonly _textFileService: ITextFileService,\n\t\t@IEditorService private readonly _editorService: IEditorService,\n\t\t@ICodeEditorService codeEditorService: ICodeEditorService,\n\t\t@IFileService fileService: IFileService,\n\t\t@ITextModelService textModelResolverService: ITextModelService,\n\t\t@IEditorGroupsService private readonly _editorGroupService: IEditorGroupsService,\n\t\t@IPaneCompositePartService paneCompositeService: IPaneCompositePartService,\n\t\t@IWorkbenchEnvironmentService environmentService: IWorkbenchEnvironmentService,\n\t\t@IWorkingCopyFileService workingCopyFileService: IWorkingCopyFileService,\n\t\t@IUriIdentityService uriIdentityService: IUriIdentityService,\n\t\t@IClipboardService private readonly _clipboardService: IClipboardService,\n\t\t@IPathService pathService: IPathService,\n\t\t@IConfigurationService configurationService: IConfigurationService,\n\t\t@IQuickDiffModelService quickDiffModelService: IQuickDiffModelService\n\t) {\n\t\tthis._proxy = extHostContext.getProxy(ExtHostContext.ExtHostDocumentsAndEditors);\n\n\t\tthis._mainThreadDocuments = this._toDispose.add(new MainThreadDocuments(extHostContext, this._modelService, this._textFileService, fileService, textModelResolverService, environmentService, uriIdentityService, workingCopyFileService, pathService));\n\t\textHostContext.set(MainContext.MainThreadDocuments, this._mainThreadDocuments);\n\n\t\tthis._mainThreadEditors = this._toDispose.add(new MainThreadTextEditors(this, extHostContext, codeEditorService, this._editorService, this._editorGroupService, configurationService, quickDiffModelService, uriIdentityService));\n\t\textHostContext.set(MainContext.MainThreadTextEditors, this._mainThreadEditors);\n\n\t\t// It is expected that the ctor of the state computer calls our `_onDelta`.\n\t\tthis._toDispose.add(new MainThreadDocumentAndEditorStateComputer(delta => this._onDelta(delta), _modelService, codeEditorService, this._editorService, paneCompositeService));\n\t}\n\n\tdispose(): void {\n\t\tthis._toDispose.dispose();\n\t}\n\n\tprivate _onDelta(delta: DocumentAndEditorStateDelta): void {\n\n\t\tconst removedEditors: string[] = [];\n\t\tconst addedEditors: MainThreadTextEditor[] = [];\n\n\t\t// removed models\n\t\tconst removedDocuments = delta.removedDocuments.map(m => m.uri);\n\n\t\t// added editors\n\t\tfor (const apiEditor of delta.addedEditors) {\n\t\t\tconst mainThreadEditor = new MainThreadTextEditor(apiEditor.id, apiEditor.editor.getModel(),\n\t\t\t\tapiEditor.editor, { onGainedFocus() { }, onLostFocus() { } }, this._mainThreadDocuments, this._modelService, this._clipboardService);\n\n\t\t\tthis._textEditors.set(apiEditor.id, mainThreadEditor);\n\t\t\taddedEditors.push(mainThreadEditor);\n\t\t}\n\n\t\t// removed editors\n\t\tfor (const { id } of delta.removedEditors) {\n\t\t\tconst mainThreadEditor = this._textEditors.get(id);\n\t\t\tif (mainThreadEditor) {\n\t\t\t\tmainThreadEditor.dispose();\n\t\t\t\tthis._textEditors.delete(id);\n\t\t\t\tremovedEditors.push(id);\n\t\t\t}\n\t\t}\n\n\t\tconst extHostDelta: IDocumentsAndEditorsDelta = Object.create(null);\n\t\tlet empty = true;\n\t\tif (delta.newActiveEditor !== undefined) {\n\t\t\tempty = false;\n\t\t\textHostDelta.newActiveEditor = delta.newActiveEditor;\n\t\t}\n\t\tif (removedDocuments.length > 0) {\n\t\t\tempty = false;\n\t\t\textHostDelta.removedDocuments = removedDocuments;\n\t\t}\n\t\tif (removedEditors.length > 0) {\n\t\t\tempty = false;\n\t\t\textHostDelta.removedEditors = removedEditors;\n\t\t}\n\t\tif (delta.addedDocuments.length > 0) {\n\t\t\tempty = false;\n\t\t\textHostDelta.addedDocuments = delta.addedDocuments.map(m => this._toModelAddData(m));\n\t\t}\n\t\tif (delta.addedEditors.length > 0) {\n\t\t\tempty = false;\n\t\t\textHostDelta.addedEditors = addedEditors.map(e => this._toTextEditorAddData(e));\n\t\t}\n\n\t\tif (!empty) {\n\t\t\t// first update ext host\n\t\t\tthis._proxy.$acceptDocumentsAndEditorsDelta(extHostDelta);\n\n\t\t\t// second update dependent document/editor states\n\t\t\tremovedDocuments.forEach(this._mainThreadDocuments.handleModelRemoved, this._mainThreadDocuments);\n\t\t\tdelta.addedDocuments.forEach(this._mainThreadDocuments.handleModelAdded, this._mainThreadDocuments);\n\n\t\t\tremovedEditors.forEach(this._mainThreadEditors.handleTextEditorRemoved, this._mainThreadEditors);\n\t\t\taddedEditors.forEach(this._mainThreadEditors.handleTextEditorAdded, this._mainThreadEditors);\n\t\t}\n\t}\n\n\tprivate _toModelAddData(model: ITextModel): IModelAddedData {\n\t\treturn {\n\t\t\turi: model.uri,\n\t\t\tversionId: model.getVersionId(),\n\t\t\tlines: model.getLinesContent(),\n\t\t\tEOL: model.getEOL(),\n\t\t\tlanguageId: model.getLanguageId(),\n\t\t\tisDirty: this._textFileService.isDirty(model.uri),\n\t\t\tencoding: this._textFileService.getEncoding(model.uri)\n\t\t};\n\t}\n\n\tprivate _toTextEditorAddData(textEditor: MainThreadTextEditor): ITextEditorAddData {\n\t\tconst props = textEditor.getProperties();\n\t\treturn {\n\t\t\tid: textEditor.getId(),\n\t\t\tdocumentUri: textEditor.getModel().uri,\n\t\t\toptions: props.options,\n\t\t\tselections: props.selections,\n\t\t\tvisibleRanges: props.visibleRanges,\n\t\t\teditorPosition: this._findEditorPosition(textEditor)\n\t\t};\n\t}\n\n\tprivate _findEditorPosition(editor: MainThreadTextEditor): EditorGroupColumn | undefined {\n\t\tfor (const editorPane of this._editorService.visibleEditorPanes) {\n\t\t\tif (editor.matches(editorPane)) {\n\t\t\t\treturn editorGroupToColumn(this._editorGroupService, editorPane.group);\n\t\t\t}\n\t\t}\n\t\treturn undefined;\n\t}\n\n\tfindTextEditorIdFor(editorPane: IEditorPane): string | undefined {\n\t\tfor (const [id, editor] of this._textEditors) {\n\t\t\tif (editor.matches(editorPane)) {\n\t\t\t\treturn id;\n\t\t\t}\n\t\t}\n\t\treturn undefined;\n\t}\n\n\tgetIdOfCodeEditor(codeEditor: ICodeEditor): string | undefined {\n\t\tfor (const [id, editor] of this._textEditors) {\n\t\t\tif (editor.getCodeEditor() === codeEditor) {\n\t\t\t\treturn id;\n\t\t\t}\n\t\t}\n\t\treturn undefined;\n\t}\n\n\tgetEditor(id: string): MainThreadTextEditor | undefined {\n\t\treturn this._textEditors.get(id);\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Event } from '../../../base/common/event.js';\nimport { combinedDisposable, DisposableStore, DisposableMap } from '../../../base/common/lifecycle.js';\nimport { ICodeEditor, isCodeEditor, isDiffEditor, IActiveCodeEditor } from '../../../editor/browser/editorBrowser.js';\nimport { ICodeEditorService } from '../../../editor/browser/services/codeEditorService.js';\nimport { IEditor } from '../../../editor/common/editorCommon.js';\nimport { ITextModel, shouldSynchronizeModel } from '../../../editor/common/model.js';\nimport { IModelService } from '../../../editor/common/services/model.js';\nimport { ITextModelService } from '../../../editor/common/services/resolverService.js';\nimport { IFileService } from '../../../platform/files/common/files.js';\nimport { extHostCustomer, IExtHostContext } from '../../services/extensions/common/extHostCustomers.js';\nimport { MainThreadDocuments } from './mainThreadDocuments.js';\nimport { MainThreadTextEditor } from './mainThreadEditor.js';\nimport { MainThreadTextEditors } from './mainThreadEditors.js';\nimport { ExtHostContext, ExtHostDocumentsAndEditorsShape, IDocumentsAndEditorsDelta, IModelAddedData, ITextEditorAddData, MainContext } from '../common/extHost.protocol.js';\nimport { AbstractTextEditor } from '../../browser/parts/editor/textEditor.js';\nimport { IEditorPane } from '../../common/editor.js';\nimport { EditorGroupColumn, editorGroupToColumn } from '../../services/editor/common/editorGroupColumn.js';\nimport { IEditorService } from '../../services/editor/common/editorService.js';\nimport { IEditorGroupsService } from '../../services/editor/common/editorGroupsService.js';\nimport { ITextFileService } from '../../services/textfile/common/textfiles.js';\nimport { IWorkbenchEnvironmentService } from '../../services/environment/common/environmentService.js';\nimport { IWorkingCopyFileService } from '../../services/workingCopy/common/workingCopyFileService.js';\nimport { IUriIdentityService } from '../../../platform/uriIdentity/common/uriIdentity.js';\nimport { IClipboardService } from '../../../platform/clipboard/common/clipboardService.js';\nimport { IPathService } from '../../services/path/common/pathService.js';\nimport { diffSets, diffMaps } from '../../../base/common/collections.js';\nimport { IPaneCompositePartService } from '../../services/panecomposite/browser/panecomposite.js';\nimport { ViewContainerLocation } from '../../common/views.js';\nimport { IConfigurationService } from '../../../platform/configuration/common/configuration.js';\nimport { IQuickDiffModelService } from '../../contrib/scm/browser/quickDiffModel.js';\n\n\nclass TextEditorSnapshot {\n\n\treadonly id: string;\n\n\tconstructor(\n\t\treadonly editor: IActiveCodeEditor,\n\t) {\n\t\tthis.id = `${editor.getId()},${editor.getModel().id}`;\n\t}\n}\n\nclass DocumentAndEditorStateDelta {\n\n\treadonly isEmpty: boolean;\n\n\tconstructor(\n\t\treadonly removedDocuments: ITextModel[],\n\t\treadonly addedDocuments: ITextModel[],\n\t\treadonly removedEditors: TextEditorSnapshot[],\n\t\treadonly addedEditors: TextEditorSnapshot[],\n\t\treadonly oldActiveEditor: string | null | undefined,\n\t\treadonly newActiveEditor: string | null | undefined,\n\t) {\n\t\tthis.isEmpty = this.removedDocuments.length === 0\n\t\t\t&& this.addedDocuments.length === 0\n\t\t\t&& this.removedEditors.length === 0\n\t\t\t&& this.addedEditors.length === 0\n\t\t\t&& oldActiveEditor === newActiveEditor;\n\t}\n\n\ttoString(): string {\n\t\tlet ret = 'DocumentAndEditorStateDelta\\n';\n\t\tret += `\\tRemoved Documents: [${this.removedDocuments.map(d => d.uri.toString(true)).join(', ')}]\\n`;\n\t\tret += `\\tAdded Documents: [${this.addedDocuments.map(d => d.uri.toString(true)).join(', ')}]\\n`;\n\t\tret += `\\tRemoved Editors: [${this.removedEditors.map(e => e.id).join(', ')}]\\n`;\n\t\tret += `\\tAdded Editors: [${this.addedEditors.map(e => e.id).join(', ')}]\\n`;\n\t\tret += `\\tNew Active Editor: ${this.newActiveEditor}\\n`;\n\t\treturn ret;\n\t}\n}\n\nclass DocumentAndEditorState {\n\n\tstatic compute(before: DocumentAndEditorState | undefined, after: DocumentAndEditorState): DocumentAndEditorStateDelta {\n\t\tif (!before) {\n\t\t\treturn new DocumentAndEditorStateDelta(\n\t\t\t\t[], [...after.documents.values()],\n\t\t\t\t[], [...after.textEditors.values()],\n\t\t\t\tundefined, after.activeEditor\n\t\t\t);\n\t\t}\n\t\tconst documentDelta = diffSets(before.documents, after.documents);\n\t\tconst editorDelta = diffMaps(before.textEditors, after.textEditors);\n\t\tconst oldActiveEditor = before.activeEditor !== after.activeEditor ? before.activeEditor : undefined;\n\t\tconst newActiveEditor = before.activeEditor !== after.activeEditor ? after.activeEditor : undefined;\n\n\t\treturn new DocumentAndEditorStateDelta(\n\t\t\tdocumentDelta.removed, documentDelta.added,\n\t\t\teditorDelta.removed, editorDelta.added,\n\t\t\toldActiveEditor, newActiveEditor\n\t\t);\n\t}\n\n\tconstructor(\n\t\treadonly documents: Set<ITextModel>,\n\t\treadonly textEditors: Map<string, TextEditorSnapshot>,\n\t\treadonly activeEditor: string | null | undefined,\n\t) {\n\t\t//\n\t}\n}\n\nconst enum ActiveEditorOrder {\n\tEditor, Panel\n}\n\nclass MainThreadDocumentAndEditorStateComputer {\n\n\tprivate readonly _toDispose = new DisposableStore();\n\tprivate readonly _toDisposeOnEditorRemove = new DisposableMap<string>();\n\tprivate _currentState?: DocumentAndEditorState;\n\tprivate _activeEditorOrder: ActiveEditorOrder = ActiveEditorOrder.Editor;\n\n\tconstructor(\n\t\tprivate readonly _onDidChangeState: (delta: DocumentAndEditorStateDelta) => void,\n\t\t@IModelService private readonly _modelService: IModelService,\n\t\t@ICodeEditorService private readonly _codeEditorService: ICodeEditorService,\n\t\t@IEditorService private readonly _editorService: IEditorService,\n\t\t@IPaneCompositePartService private readonly _paneCompositeService: IPaneCompositePartService,\n\t) {\n\t\tthis._modelService.onModelAdded(this._updateStateOnModelAdd, this, this._toDispose);\n\t\tthis._modelService.onModelRemoved(_ => this._updateState(), this, this._toDispose);\n\t\tthis._editorService.onDidActiveEditorChange(_ => this._updateState(), this, this._toDispose);\n\n\t\tthis._codeEditorService.onCodeEditorAdd(this._onDidAddEditor, this, this._toDispose);\n\t\tthis._codeEditorService.onCodeEditorRemove(this._onDidRemoveEditor, this, this._toDispose);\n\t\tthis._codeEditorService.listCodeEditors().forEach(this._onDidAddEditor, this);\n\n\t\tEvent.filter(this._paneCompositeService.onDidPaneCompositeOpen, event => event.viewContainerLocation === ViewContainerLocation.Panel)(_ => this._activeEditorOrder = ActiveEditorOrder.Panel, undefined, this._toDispose);\n\t\tEvent.filter(this._paneCompositeService.onDidPaneCompositeClose, event => event.viewContainerLocation === ViewContainerLocation.Panel)(_ => this._activeEditorOrder = ActiveEditorOrder.Editor, undefined, this._toDispose);\n\t\tthis._editorService.onDidVisibleEditorsChange(_ => this._activeEditorOrder = ActiveEditorOrder.Editor, undefined, this._toDispose);\n\n\t\tthis._updateState();\n\t}\n\n\tdispose(): void {\n\t\tthis._toDispose.dispose();\n\t\tthis._toDisposeOnEditorRemove.dispose();\n\t}\n\n\tprivate _onDidAddEditor(e: ICodeEditor): void {\n\t\tthis._toDisposeOnEditorRemove.set(e.getId(), combinedDisposable(\n\t\t\te.onDidChangeModel(() => this._updateState()),\n\t\t\te.onDidFocusEditorText(() => this._updateState()),\n\t\t\te.onDidFocusEditorWidget(() => this._updateState(e))\n\t\t));\n\t\tthis._updateState();\n\t}\n\n\tprivate _onDidRemoveEditor(e: ICodeEditor): void {\n\t\tconst id = e.getId();\n\t\tif (this._toDisposeOnEditorRemove.has(id)) {\n\t\t\tthis._toDisposeOnEditorRemove.deleteAndDispose(id);\n\t\t\tthis._updateState();\n\t\t}\n\t}\n\n\tprivate _updateStateOnModelAdd(model: ITextModel): void {\n\t\tif (!shouldSynchronizeModel(model)) {\n\t\t\t// ignore\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this._currentState) {\n\t\t\t// too early\n\t\t\tthis._updateState();\n\t\t\treturn;\n\t\t}\n\n\t\t// small (fast) delta\n\t\tthis._currentState = new DocumentAndEditorState(\n\t\t\tthis._currentState.documents.add(model),\n\t\t\tthis._currentState.textEditors,\n\t\t\tthis._currentState.activeEditor\n\t\t);\n\n\t\tthis._onDidChangeState(new DocumentAndEditorStateDelta(\n\t\t\t[], [model],\n\t\t\t[], [],\n\t\t\tundefined, undefined\n\t\t));\n\t}\n\n\tprivate _updateState(widgetFocusCandidate?: ICodeEditor): void {\n\n\t\t// models: ignore too large models\n\t\tconst models = new Set<ITextModel>();\n\t\tfor (const model of this._modelService.getModels()) {\n\t\t\tif (shouldSynchronizeModel(model)) {\n\t\t\t\tmodels.add(model);\n\t\t\t}\n\t\t}\n\n\t\t// editor: only take those that have a not too large model\n\t\tconst editors = new Map<string, TextEditorSnapshot>();\n\t\tlet activeEditor: string | null = null; // Strict null work. This doesn't like being undefined!\n\n\t\tfor (const editor of this._codeEditorService.listCodeEditors()) {\n\t\t\tif (editor.isSimpleWidget) {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tconst model = editor.getModel();\n\t\t\tif (editor.hasModel() && model && shouldSynchronizeModel(model)\n\t\t\t\t&& !model.isDisposed() // model disposed\n\t\t\t\t&& Boolean(this._modelService.getModel(model.uri)) // model disposing, the flag didn't flip yet but the model service already removed it\n\t\t\t) {\n\t\t\t\tconst apiEditor = new TextEditorSnapshot(editor);\n\t\t\t\teditors.set(apiEditor.id, apiEditor);\n\t\t\t\tif (editor.hasTextFocus() || (widgetFocusCandidate === editor && editor.hasWidgetFocus())) {\n\t\t\t\t\t// text focus has priority, widget focus is tricky because multiple\n\t\t\t\t\t// editors might claim widget focus at the same time. therefore we use a\n\t\t\t\t\t// candidate (which is the editor that has raised an widget focus event)\n\t\t\t\t\t// in addition to the widget focus check\n\t\t\t\t\tactiveEditor = apiEditor.id;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// active editor: if none of the previous editors had focus we try\n\t\t// to match output panels or the active workbench editor with\n\t\t// one of editor we have just computed\n\t\tif (!activeEditor) {\n\t\t\tlet candidate: IEditor | undefined;\n\t\t\tif (this._activeEditorOrder === ActiveEditorOrder.Editor) {\n\t\t\t\tcandidate = this._getActiveEditorFromEditorPart() || this._getActiveEditorFromPanel();\n\t\t\t} else {\n\t\t\t\tcandidate = this._getActiveEditorFromPanel() || this._getActiveEditorFromEditorPart();\n\t\t\t}\n\n\t\t\tif (candidate) {\n\t\t\t\tfor (const snapshot of editors.values()) {\n\t\t\t\t\tif (candidate === snapshot.editor) {\n\t\t\t\t\t\tactiveEditor = snapshot.id;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// compute new state and compare against old\n\t\tconst newState = new DocumentAndEditorState(models, editors, activeEditor);\n\t\tconst delta = DocumentAndEditorState.compute(this._currentState, newState);\n\t\tif (!delta.isEmpty) {\n\t\t\tthis._currentState = newState;\n\t\t\tthis._onDidChangeState(delta);\n\t\t}\n\t}\n\n\tprivate _getActiveEditorFromPanel(): IEditor | undefined {\n\t\tconst panel = this._paneCompositeService.getActivePaneComposite(ViewContainerLocation.Panel);\n\t\tif (panel instanceof AbstractTextEditor) {\n\t\t\tconst control = panel.getControl();\n\t\t\tif (isCodeEditor(control)) {\n\t\t\t\treturn control;\n\t\t\t}\n\t\t}\n\n\t\treturn undefined;\n\t}\n\n\tprivate _getActiveEditorFromEditorPart(): IEditor | undefined {\n\t\tlet activeTextEditorControl = this._editorService.activeTextEditorControl;\n\t\tif (isDiffEditor(activeTextEditorControl)) {\n\t\t\tactiveTextEditorControl = activeTextEditorControl.getModifiedEditor();\n\t\t}\n\t\treturn activeTextEditorControl;\n\t}\n}\n\n@extHostCustomer\nexport class MainThreadDocumentsAndEditors {\n\n\tprivate readonly _toDispose = new DisposableStore();\n\tprivate readonly _proxy: ExtHostDocumentsAndEditorsShape;\n\tprivate readonly _mainThreadDocuments: MainThreadDocuments;\n\tprivate readonly _mainThreadEditors: MainThreadTextEditors;\n\tprivate readonly _textEditors = new Map<string, MainThreadTextEditor>();\n\n\tconstructor(\n\t\textHostContext: IExtHostContext,\n\t\t@IModelService private readonly _modelService: IModelService,\n\t\t@ITextFileService private readonly _textFileService: ITextFileService,\n\t\t@IEditorService private readonly _editorService: IEditorService,\n\t\t@ICodeEditorService codeEditorService: ICodeEditorService,\n\t\t@IFileService fileService: IFileService,\n\t\t@ITextModelService textModelResolverService: ITextModelService,\n\t\t@IEditorGroupsService private readonly _editorGroupService: IEditorGroupsService,\n\t\t@IPaneCompositePartService paneCompositeService: IPaneCompositePartService,\n\t\t@IWorkbenchEnvironmentService environmentService: IWorkbenchEnvironmentService,\n\t\t@IWorkingCopyFileService workingCopyFileService: IWorkingCopyFileService,\n\t\t@IUriIdentityService uriIdentityService: IUriIdentityService,\n\t\t@IClipboardService private readonly _clipboardService: IClipboardService,\n\t\t@IPathService pathService: IPathService,\n\t\t@IConfigurationService configurationService: IConfigurationService,\n\t\t@IQuickDiffModelService quickDiffModelService: IQuickDiffModelService\n\t) {\n\t\tthis._proxy = extHostContext.getProxy(ExtHostContext.ExtHostDocumentsAndEditors);\n\n\t\tthis._mainThreadDocuments = this._toDispose.add(new MainThreadDocuments(extHostContext, this._modelService, this._textFileService, fileService, textModelResolverService, environmentService, uriIdentityService, workingCopyFileService, pathService));\n\t\textHostContext.set(MainContext.MainThreadDocuments, this._mainThreadDocuments);\n\n\t\tthis._mainThreadEditors = this._toDispose.add(new MainThreadTextEditors(this, extHostContext, codeEditorService, this._editorService, this._editorGroupService, configurationService, quickDiffModelService, uriIdentityService));\n\t\textHostContext.set(MainContext.MainThreadTextEditors, this._mainThreadEditors);\n\n\t\t// It is expected that the ctor of the state computer calls our `_onDelta`.\n\t\tthis._toDispose.add(new MainThreadDocumentAndEditorStateComputer(delta => this._onDelta(delta), _modelService, codeEditorService, this._editorService, paneCompositeService));\n\t}\n\n\tdispose(): void {\n\t\tthis._toDispose.dispose();\n\t}\n\n\tprivate _onDelta(delta: DocumentAndEditorStateDelta): void {\n\n\t\tconst removedEditors: string[] = [];\n\t\tconst addedEditors: MainThreadTextEditor[] = [];\n\n\t\t// removed models\n\t\tconst removedDocuments = delta.removedDocuments.map(m => m.uri);\n\n\t\t// added editors\n\t\tfor (const apiEditor of delta.addedEditors) {\n\t\t\tconst mainThreadEditor = new MainThreadTextEditor(apiEditor.id, apiEditor.editor.getModel(),\n\t\t\t\tapiEditor.editor, { onGainedFocus() { }, onLostFocus() { } }, this._mainThreadDocuments, this._modelService, this._clipboardService);\n\n\t\t\tthis._textEditors.set(apiEditor.id, mainThreadEditor);\n\t\t\taddedEditors.push(mainThreadEditor);\n\t\t}\n\n\t\t// removed editors\n\t\tfor (const { id } of delta.removedEditors) {\n\t\t\tconst mainThreadEditor = this._textEditors.get(id);\n\t\t\tif (mainThreadEditor) {\n\t\t\t\tmainThreadEditor.dispose();\n\t\t\t\tthis._textEditors.delete(id);\n\t\t\t\tremovedEditors.push(id);\n\t\t\t}\n\t\t}\n\n\t\tconst extHostDelta: IDocumentsAndEditorsDelta = Object.create(null);\n\t\tlet empty = true;\n\t\tif (delta.newActiveEditor !== undefined) {\n\t\t\tempty = false;\n\t\t\textHostDelta.newActiveEditor = delta.newActiveEditor;\n\t\t}\n\t\tif (removedDocuments.length > 0) {\n\t\t\tempty = false;\n\t\t\textHostDelta.removedDocuments = removedDocuments;\n\t\t}\n\t\tif (removedEditors.length > 0) {\n\t\t\tempty = false;\n\t\t\textHostDelta.removedEditors = removedEditors;\n\t\t}\n\t\tif (delta.addedDocuments.length > 0) {\n\t\t\tempty = false;\n\t\t\textHostDelta.addedDocuments = delta.addedDocuments.map(m => this._toModelAddData(m));\n\t\t}\n\t\tif (delta.addedEditors.length > 0) {\n\t\t\tempty = false;\n\t\t\textHostDelta.addedEditors = addedEditors.map(e => this._toTextEditorAddData(e));\n\t\t}\n\n\t\tif (!empty) {\n\t\t\t// first update ext host\n\t\t\tthis._proxy.$acceptDocumentsAndEditorsDelta(extHostDelta);\n\n\t\t\t// second update dependent document/editor states\n\t\t\tremovedDocuments.forEach(this._mainThreadDocuments.handleModelRemoved, this._mainThreadDocuments);\n\t\t\tdelta.addedDocuments.forEach(this._mainThreadDocuments.handleModelAdded, this._mainThreadDocuments);\n\n\t\t\tremovedEditors.forEach(this._mainThreadEditors.handleTextEditorRemoved, this._mainThreadEditors);\n\t\t\taddedEditors.forEach(this._mainThreadEditors.handleTextEditorAdded, this._mainThreadEditors);\n\t\t}\n\t}\n\n\tprivate _toModelAddData(model: ITextModel): IModelAddedData {\n\t\treturn {\n\t\t\turi: model.uri,\n\t\t\tversionId: model.getVersionId(),\n\t\t\tlines: model.getLinesContent(),\n\t\t\tEOL: model.getEOL(),\n\t\t\tlanguageId: model.getLanguageId(),\n\t\t\tisDirty: this._textFileService.isDirty(model.uri),\n\t\t\tencoding: this._textFileService.getEncoding(model.uri)\n\t\t};\n\t}\n\n\tprivate _toTextEditorAddData(textEditor: MainThreadTextEditor): ITextEditorAddData {\n\t\tconst props = textEditor.getProperties();\n\t\treturn {\n\t\t\tid: textEditor.getId(),\n\t\t\tdocumentUri: textEditor.getModel().uri,\n\t\t\toptions: props.options,\n\t\t\tselections: props.selections,\n\t\t\tvisibleRanges: props.visibleRanges,\n\t\t\teditorPosition: this._findEditorPosition(textEditor)\n\t\t};\n\t}\n\n\tprivate _findEditorPosition(editor: MainThreadTextEditor): EditorGroupColumn | undefined {\n\t\tfor (const editorPane of this._editorService.visibleEditorPanes) {\n\t\t\tif (editor.matches(editorPane)) {\n\t\t\t\treturn editorGroupToColumn(this._editorGroupService, editorPane.group);\n\t\t\t}\n\t\t}\n\t\treturn undefined;\n\t}\n\n\tfindTextEditorIdFor(editorPane: IEditorPane): string | undefined {\n\t\tfor (const [id, editor] of this._textEditors) {\n\t\t\tif (editor.matches(editorPane)) {\n\t\t\t\treturn id;\n\t\t\t}\n\t\t}\n\t\treturn undefined;\n\t}\n\n\tgetIdOfCodeEditor(codeEditor: ICodeEditor): string | undefined {\n\t\tfor (const [id, editor] of this._textEditors) {\n\t\t\tif (editor.getCodeEditor() === codeEditor) {\n\t\t\t\treturn id;\n\t\t\t}\n\t\t}\n\t\treturn undefined;\n\t}\n\n\tgetEditor(id: string): MainThreadTextEditor | undefined {\n\t\treturn this._textEditors.get(id);\n\t}\n}\n"]}