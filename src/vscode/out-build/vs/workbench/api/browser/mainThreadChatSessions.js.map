{"version":3,"sources":["vs/workbench/api/browser/mainThreadChatSessions.ts"],"names":[],"mappings":"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","file":"mainThreadChatSessions.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { raceCancellationError } from '../../../base/common/async.js';\nimport { CancellationToken } from '../../../base/common/cancellation.js';\nimport { Emitter } from '../../../base/common/event.js';\nimport { IMarkdownString, MarkdownString } from '../../../base/common/htmlContent.js';\nimport { Disposable, DisposableMap, DisposableStore, IDisposable } from '../../../base/common/lifecycle.js';\nimport { ResourceMap } from '../../../base/common/map.js';\nimport { revive } from '../../../base/common/marshalling.js';\nimport { autorun, IObservable, observableValue } from '../../../base/common/observable.js';\nimport { isEqual } from '../../../base/common/resources.js';\nimport { URI, UriComponents } from '../../../base/common/uri.js';\nimport { localize } from '../../../nls.js';\nimport { IDialogService } from '../../../platform/dialogs/common/dialogs.js';\nimport { ILogService } from '../../../platform/log/common/log.js';\nimport { IChatEditorOptions } from '../../contrib/chat/browser/chatEditor.js';\nimport { ChatEditorInput } from '../../contrib/chat/browser/chatEditorInput.js';\nimport { IChatAgentRequest } from '../../contrib/chat/common/chatAgents.js';\nimport { IChatContentInlineReference, IChatProgress } from '../../contrib/chat/common/chatService.js';\nimport { IChatSession, IChatSessionContentProvider, IChatSessionHistoryItem, IChatSessionItem, IChatSessionItemProvider, IChatSessionProviderOptionItem, IChatSessionsService } from '../../contrib/chat/common/chatSessionsService.js';\nimport { IChatRequestVariableEntry } from '../../contrib/chat/common/chatVariableEntries.js';\nimport { IEditorGroupsService } from '../../services/editor/common/editorGroupsService.js';\nimport { IEditorService } from '../../services/editor/common/editorService.js';\nimport { extHostNamedCustomer, IExtHostContext } from '../../services/extensions/common/extHostCustomers.js';\nimport { Dto } from '../../services/extensions/common/proxyIdentifier.js';\nimport { ExtHostChatSessionsShape, ExtHostContext, IChatProgressDto, IChatSessionHistoryItemDto, MainContext, MainThreadChatSessionsShape } from '../common/extHost.protocol.js';\n\nexport class ObservableChatSession extends Disposable implements IChatSession {\n\n\treadonly sessionResource: URI;\n\treadonly providerHandle: number;\n\treadonly history: Array<IChatSessionHistoryItem>;\n\tprivate _options?: Record<string, string | IChatSessionProviderOptionItem>;\n\tpublic get options(): Record<string, string | IChatSessionProviderOptionItem> | undefined {\n\t\treturn this._options;\n\t}\n\tprivate readonly _progressObservable = observableValue<IChatProgress[]>(this, []);\n\tprivate readonly _isCompleteObservable = observableValue<boolean>(this, false);\n\n\tprivate readonly _onWillDispose = new Emitter<void>();\n\treadonly onWillDispose = this._onWillDispose.event;\n\n\tprivate readonly _pendingProgressChunks = new Map<string, IChatProgress[]>();\n\tprivate _isInitialized = false;\n\tprivate _interruptionWasCanceled = false;\n\tprivate _disposalPending = false;\n\n\tprivate _initializationPromise?: Promise<void>;\n\n\tinterruptActiveResponseCallback?: () => Promise<boolean>;\n\trequestHandler?: (\n\t\trequest: IChatAgentRequest,\n\t\tprogress: (progress: IChatProgress[]) => void,\n\t\thistory: any[],\n\t\ttoken: CancellationToken\n\t) => Promise<void>;\n\n\tprivate readonly _proxy: ExtHostChatSessionsShape;\n\tprivate readonly _providerHandle: number;\n\tprivate readonly _logService: ILogService;\n\tprivate readonly _dialogService: IDialogService;\n\n\tget progressObs(): IObservable<IChatProgress[]> {\n\t\treturn this._progressObservable;\n\t}\n\n\tget isCompleteObs(): IObservable<boolean> {\n\t\treturn this._isCompleteObservable;\n\t}\n\n\tconstructor(\n\t\tresource: URI,\n\t\tproviderHandle: number,\n\t\tproxy: ExtHostChatSessionsShape,\n\t\tlogService: ILogService,\n\t\tdialogService: IDialogService\n\t) {\n\t\tsuper();\n\n\t\tthis.sessionResource = resource;\n\t\tthis.providerHandle = providerHandle;\n\t\tthis.history = [];\n\t\tthis._proxy = proxy;\n\t\tthis._providerHandle = providerHandle;\n\t\tthis._logService = logService;\n\t\tthis._dialogService = dialogService;\n\t}\n\n\tinitialize(token: CancellationToken): Promise<void> {\n\t\tif (!this._initializationPromise) {\n\t\t\tthis._initializationPromise = this._doInitializeContent(token);\n\t\t}\n\t\treturn this._initializationPromise;\n\t}\n\n\tprivate async _doInitializeContent(token: CancellationToken): Promise<void> {\n\t\ttry {\n\t\t\tconst sessionContent = await raceCancellationError(\n\t\t\t\tthis._proxy.$provideChatSessionContent(this._providerHandle, this.sessionResource, token),\n\t\t\t\ttoken\n\t\t\t);\n\n\t\t\tthis._options = sessionContent.options;\n\t\t\tthis.history.length = 0;\n\t\t\tthis.history.push(...sessionContent.history.map((turn: IChatSessionHistoryItemDto) => {\n\t\t\t\tif (turn.type === 'request') {\n\t\t\t\t\tconst variables = turn.variableData?.variables.map(v => {\n\t\t\t\t\t\tconst entry = {\n\t\t\t\t\t\t\t...v,\n\t\t\t\t\t\t\tvalue: revive(v.value)\n\t\t\t\t\t\t};\n\t\t\t\t\t\treturn entry as IChatRequestVariableEntry;\n\t\t\t\t\t});\n\n\t\t\t\t\treturn {\n\t\t\t\t\t\ttype: 'request' as const,\n\t\t\t\t\t\tprompt: turn.prompt,\n\t\t\t\t\t\tparticipant: turn.participant,\n\t\t\t\t\t\tcommand: turn.command,\n\t\t\t\t\t\tvariableData: variables ? { variables } : undefined\n\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\treturn {\n\t\t\t\t\ttype: 'response' as const,\n\t\t\t\t\tparts: turn.parts.map((part: IChatProgressDto) => revive(part) as IChatProgress),\n\t\t\t\t\tparticipant: turn.participant\n\t\t\t\t};\n\t\t\t}));\n\n\t\t\tif (sessionContent.hasActiveResponseCallback && !this.interruptActiveResponseCallback) {\n\t\t\t\tthis.interruptActiveResponseCallback = async () => {\n\t\t\t\t\tconst confirmInterrupt = () => {\n\t\t\t\t\t\tif (this._disposalPending) {\n\t\t\t\t\t\t\tthis._proxy.$disposeChatSessionContent(this._providerHandle, this.sessionResource);\n\t\t\t\t\t\t\tthis._disposalPending = false;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tthis._proxy.$interruptChatSessionActiveResponse(this._providerHandle, this.sessionResource, 'ongoing');\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t};\n\n\t\t\t\t\tif (sessionContent.supportsInterruption) {\n\t\t\t\t\t\t// If the session supports hot reload, interrupt without confirmation\n\t\t\t\t\t\treturn confirmInterrupt();\n\t\t\t\t\t}\n\n\t\t\t\t\t// Prompt the user to confirm interruption\n\t\t\t\t\treturn this._dialogService.confirm({\n\t\t\t\t\t\tmessage: localize('interruptActiveResponse', 'Are you sure you want to interrupt the active session?')\n\t\t\t\t\t}).then(confirmed => {\n\t\t\t\t\t\tif (confirmed.confirmed) {\n\t\t\t\t\t\t\t// User confirmed interruption - dispose the session content on extension host\n\t\t\t\t\t\t\treturn confirmInterrupt();\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t// When user cancels the interruption, fire an empty progress message to keep the session alive\n\t\t\t\t\t\t\t// This matches the behavior of the old implementation\n\t\t\t\t\t\t\tthis._addProgress([{\n\t\t\t\t\t\t\t\tkind: 'progressMessage',\n\t\t\t\t\t\t\t\tcontent: { value: '', isTrusted: false }\n\t\t\t\t\t\t\t}]);\n\t\t\t\t\t\t\t// Set flag to prevent completion when extension host calls handleProgressComplete\n\t\t\t\t\t\t\tthis._interruptionWasCanceled = true;\n\t\t\t\t\t\t\t// User canceled interruption - cancel the deferred disposal\n\t\t\t\t\t\t\tif (this._disposalPending) {\n\t\t\t\t\t\t\t\tthis._logService.info(`Canceling deferred disposal for session ${this.sessionResource} (user canceled interruption)`);\n\t\t\t\t\t\t\t\tthis._disposalPending = false;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tif (sessionContent.hasRequestHandler && !this.requestHandler) {\n\t\t\t\tthis.requestHandler = async (\n\t\t\t\t\trequest: IChatAgentRequest,\n\t\t\t\t\tprogress: (progress: IChatProgress[]) => void,\n\t\t\t\t\thistory: any[],\n\t\t\t\t\ttoken: CancellationToken\n\t\t\t\t) => {\n\t\t\t\t\t// Clear previous progress and mark as active\n\t\t\t\t\tthis._progressObservable.set([], undefined);\n\t\t\t\t\tthis._isCompleteObservable.set(false, undefined);\n\n\t\t\t\t\t// Set up reactive progress observation before starting the request\n\t\t\t\t\tlet lastProgressLength = 0;\n\t\t\t\t\tconst progressDisposable = autorun(reader => {\n\t\t\t\t\t\tconst progressArray = this._progressObservable.read(reader);\n\t\t\t\t\t\tconst isComplete = this._isCompleteObservable.read(reader);\n\n\t\t\t\t\t\tif (progressArray.length > lastProgressLength) {\n\t\t\t\t\t\t\tconst newProgress = progressArray.slice(lastProgressLength);\n\t\t\t\t\t\t\tprogress(newProgress);\n\t\t\t\t\t\t\tlastProgressLength = progressArray.length;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (isComplete) {\n\t\t\t\t\t\t\tprogressDisposable.dispose();\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\ttry {\n\t\t\t\t\t\tawait this._proxy.$invokeChatSessionRequestHandler(this._providerHandle, this.sessionResource, request, history, token);\n\n\t\t\t\t\t\t// Only mark as complete if there's no active response callback\n\t\t\t\t\t\t// Sessions with active response callbacks should only complete when explicitly told to via handleProgressComplete\n\t\t\t\t\t\tif (!this._isCompleteObservable.get() && !this.interruptActiveResponseCallback) {\n\t\t\t\t\t\t\tthis._markComplete();\n\t\t\t\t\t\t}\n\t\t\t\t\t} catch (error) {\n\t\t\t\t\t\tconst errorProgress: IChatProgress = {\n\t\t\t\t\t\t\tkind: 'progressMessage',\n\t\t\t\t\t\t\tcontent: { value: `Error: ${error instanceof Error ? error.message : String(error)}`, isTrusted: false }\n\t\t\t\t\t\t};\n\n\t\t\t\t\t\tthis._addProgress([errorProgress]);\n\t\t\t\t\t\tthis._markComplete();\n\t\t\t\t\t\tthrow error;\n\t\t\t\t\t} finally {\n\t\t\t\t\t\t// Ensure progress observation is cleaned up\n\t\t\t\t\t\tprogressDisposable.dispose();\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tthis._isInitialized = true;\n\n\t\t\t// Process any pending progress chunks\n\t\t\tconst hasActiveResponse = sessionContent.hasActiveResponseCallback;\n\t\t\tconst hasRequestHandler = sessionContent.hasRequestHandler;\n\t\t\tconst hasAnyCapability = hasActiveResponse || hasRequestHandler;\n\n\t\t\tfor (const [requestId, chunks] of this._pendingProgressChunks) {\n\t\t\t\tthis._logService.debug(`Processing ${chunks.length} pending progress chunks for session ${this.sessionResource}, requestId ${requestId}`);\n\t\t\t\tthis._addProgress(chunks);\n\t\t\t}\n\t\t\tthis._pendingProgressChunks.clear();\n\n\t\t\t// If session has no active response callback and no request handler, mark it as complete\n\t\t\tif (!hasAnyCapability) {\n\t\t\t\tthis._isCompleteObservable.set(true, undefined);\n\t\t\t}\n\n\t\t} catch (error) {\n\t\t\tthis._logService.error(`Failed to initialize chat session ${this.sessionResource}:`, error);\n\t\t\tthrow error;\n\t\t}\n\t}\n\n\t/**\n\t * Handle progress chunks coming from the extension host.\n\t * If the session is not initialized yet, the chunks will be queued.\n\t */\n\thandleProgressChunk(requestId: string, progress: IChatProgress[]): void {\n\t\tif (!this._isInitialized) {\n\t\t\tconst existing = this._pendingProgressChunks.get(requestId) || [];\n\t\t\tthis._pendingProgressChunks.set(requestId, [...existing, ...progress]);\n\t\t\tthis._logService.debug(`Queuing ${progress.length} progress chunks for session ${this.sessionResource}, requestId ${requestId} (session not initialized)`);\n\t\t\treturn;\n\t\t}\n\n\t\tthis._addProgress(progress);\n\t}\n\n\t/**\n\t * Handle progress completion from the extension host.\n\t */\n\thandleProgressComplete(requestId: string): void {\n\t\t// Clean up any pending chunks for this request\n\t\tthis._pendingProgressChunks.delete(requestId);\n\n\t\tif (this._isInitialized) {\n\t\t\t// Don't mark as complete if user canceled the interruption\n\t\t\tif (!this._interruptionWasCanceled) {\n\t\t\t\tthis._markComplete();\n\t\t\t} else {\n\t\t\t\t// Reset the flag and don't mark as complete\n\t\t\t\tthis._interruptionWasCanceled = false;\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate _addProgress(progress: IChatProgress[]): void {\n\t\tconst currentProgress = this._progressObservable.get();\n\t\tthis._progressObservable.set([...currentProgress, ...progress], undefined);\n\t}\n\n\tprivate _markComplete(): void {\n\t\tif (!this._isCompleteObservable.get()) {\n\t\t\tthis._isCompleteObservable.set(true, undefined);\n\t\t}\n\t}\n\n\toverride dispose(): void {\n\t\tthis._onWillDispose.fire();\n\t\tthis._onWillDispose.dispose();\n\t\tthis._pendingProgressChunks.clear();\n\n\t\t// If this session has an active response callback and disposal is happening,\n\t\t// defer the actual session content disposal until we know the user's choice\n\t\tif (this.interruptActiveResponseCallback && !this._interruptionWasCanceled) {\n\t\t\tthis._disposalPending = true;\n\t\t\t// The actual disposal will happen in the interruption callback based on user's choice\n\t\t} else {\n\t\t\t// No active response callback or user already canceled interruption - dispose immediately\n\t\t\tthis._proxy.$disposeChatSessionContent(this._providerHandle, this.sessionResource);\n\t\t}\n\t\tsuper.dispose();\n\t}\n}\n\n@extHostNamedCustomer(MainContext.MainThreadChatSessions)\nexport class MainThreadChatSessions extends Disposable implements MainThreadChatSessionsShape {\n\tprivate readonly _itemProvidersRegistrations = this._register(new DisposableMap<number, IDisposable & {\n\t\treadonly provider: IChatSessionItemProvider;\n\t\treadonly onDidChangeItems: Emitter<void>;\n\t}>());\n\tprivate readonly _contentProvidersRegistrations = this._register(new DisposableMap<number>());\n\tprivate readonly _sessionTypeToHandle = new Map<string, number>();\n\n\tprivate readonly _activeSessions = new ResourceMap<ObservableChatSession>();\n\tprivate readonly _sessionDisposables = new ResourceMap<IDisposable>();\n\n\tprivate readonly _proxy: ExtHostChatSessionsShape;\n\n\tconstructor(\n\t\tprivate readonly _extHostContext: IExtHostContext,\n\t\t@IChatSessionsService private readonly _chatSessionsService: IChatSessionsService,\n\t\t@IDialogService private readonly _dialogService: IDialogService,\n\t\t@IEditorService private readonly _editorService: IEditorService,\n\t\t@IEditorGroupsService private readonly editorGroupService: IEditorGroupsService,\n\t\t@ILogService private readonly _logService: ILogService,\n\t) {\n\t\tsuper();\n\n\t\tthis._proxy = this._extHostContext.getProxy(ExtHostContext.ExtHostChatSessions);\n\n\t\tthis._chatSessionsService.setOptionsChangeCallback(async (sessionResource: URI, updates: ReadonlyArray<{ optionId: string; value: string }>) => {\n\t\t\tconst handle = this._getHandleForSessionType(sessionResource.scheme);\n\t\t\tif (handle !== undefined) {\n\t\t\t\tawait this.notifyOptionsChange(handle, sessionResource, updates);\n\t\t\t}\n\t\t});\n\t}\n\n\tprivate _getHandleForSessionType(chatSessionType: string): number | undefined {\n\t\treturn this._sessionTypeToHandle.get(chatSessionType);\n\t}\n\n\t$registerChatSessionItemProvider(handle: number, chatSessionType: string): void {\n\t\t// Register the provider handle - this tracks that a provider exists\n\t\tconst disposables = new DisposableStore();\n\t\tconst changeEmitter = disposables.add(new Emitter<void>());\n\n\t\tconst provider: IChatSessionItemProvider = {\n\t\t\tchatSessionType,\n\t\t\tonDidChangeChatSessionItems: changeEmitter.event,\n\t\t\tprovideChatSessionItems: (token) => this._provideChatSessionItems(handle, token),\n\t\t\tprovideNewChatSessionItem: (options, token) => this._provideNewChatSessionItem(handle, options, token)\n\t\t};\n\t\tdisposables.add(this._chatSessionsService.registerChatSessionItemProvider(provider));\n\n\t\tthis._itemProvidersRegistrations.set(handle, {\n\t\t\tdispose: () => disposables.dispose(),\n\t\t\tprovider,\n\t\t\tonDidChangeItems: changeEmitter,\n\t\t});\n\t}\n\n\t$onDidChangeChatSessionItems(handle: number): void {\n\t\tthis._itemProvidersRegistrations.get(handle)?.onDidChangeItems.fire();\n\t}\n\n\tasync $onDidCommitChatSessionItem(handle: number, originalComponents: UriComponents, modifiedCompoennts: UriComponents): Promise<void> {\n\t\tconst originalResource = URI.revive(originalComponents);\n\t\tconst modifiedResource = URI.revive(modifiedCompoennts);\n\n\t\tthis._logService.trace(`$onDidCommitChatSessionItem: handle(${handle}), original(${originalResource}), modified(${modifiedResource})`);\n\t\tconst chatSessionType = this._itemProvidersRegistrations.get(handle)?.provider.chatSessionType;\n\t\tif (!chatSessionType) {\n\t\t\tthis._logService.error(`No chat session type found for provider handle ${handle}`);\n\t\t\treturn;\n\t\t}\n\n\t\tconst originalEditor = this._editorService.editors.find(editor => editor.resource?.toString() === originalResource.toString());\n\t\tconst contribution = this._chatSessionsService.getAllChatSessionContributions().find(c => c.type === chatSessionType);\n\n\t\t// Find the group containing the original editor\n\t\tconst originalGroup =\n\t\t\tthis.editorGroupService.groups.find(group => group.editors.some(editor => isEqual(editor.resource, originalResource)))\n\t\t\t?? this.editorGroupService.activeGroup;\n\n\t\tconst options: IChatEditorOptions = {\n\t\t\ttitle: {\n\t\t\t\tpreferred: originalEditor?.getName() || undefined,\n\t\t\t\tfallback: localize('chatEditorContributionName', \"{0}\", contribution?.displayName),\n\t\t\t}\n\t\t};\n\n\t\tif (originalEditor) {\n\t\t\t// Prefetch the chat session content to make the subsequent editor swap quick\n\t\t\tconst newSession = await this._chatSessionsService.getOrCreateChatSession(\n\t\t\t\tURI.revive(modifiedResource),\n\t\t\t\tCancellationToken.None,\n\t\t\t);\n\n\t\t\tnewSession.initialEditingSession = originalEditor instanceof ChatEditorInput\n\t\t\t\t? originalEditor.transferOutEditingSession()\n\t\t\t\t: undefined;\n\n\t\t\tthis._editorService.replaceEditors([{\n\t\t\t\teditor: originalEditor,\n\t\t\t\treplacement: {\n\t\t\t\t\tresource: modifiedResource,\n\t\t\t\t\toptions,\n\t\t\t\t},\n\t\t\t}], originalGroup);\n\t\t} else {\n\t\t\tthis._logService.warn(`Original chat session editor not found for resource ${originalResource.toString()}`);\n\t\t\tthis._editorService.openEditor({ resource: modifiedResource }, originalGroup);\n\t\t}\n\t}\n\n\tprivate async _provideChatSessionItems(handle: number, token: CancellationToken): Promise<IChatSessionItem[]> {\n\t\ttry {\n\t\t\t// Get all results as an array from the RPC call\n\t\t\tconst sessions = await this._proxy.$provideChatSessionItems(handle, token);\n\t\t\treturn sessions.map(session => ({\n\t\t\t\t...session,\n\t\t\t\tresource: URI.revive(session.resource),\n\t\t\t\ticonPath: session.iconPath,\n\t\t\t\ttooltip: session.tooltip ? this._reviveTooltip(session.tooltip) : undefined\n\t\t\t}));\n\t\t} catch (error) {\n\t\t\tthis._logService.error('Error providing chat sessions:', error);\n\t\t}\n\t\treturn [];\n\t}\n\n\tprivate async _provideNewChatSessionItem(handle: number, options: { request: IChatAgentRequest; metadata?: any }, token: CancellationToken): Promise<IChatSessionItem> {\n\t\ttry {\n\t\t\tconst chatSessionItem = await this._proxy.$provideNewChatSessionItem(handle, options, token);\n\t\t\tif (!chatSessionItem) {\n\t\t\t\tthrow new Error('Extension failed to create chat session');\n\t\t\t}\n\t\t\treturn {\n\t\t\t\t...chatSessionItem,\n\t\t\t\tresource: URI.revive(chatSessionItem.resource),\n\t\t\t\ticonPath: chatSessionItem.iconPath,\n\t\t\t\ttooltip: chatSessionItem.tooltip ? this._reviveTooltip(chatSessionItem.tooltip) : undefined,\n\t\t\t};\n\t\t} catch (error) {\n\t\t\tthis._logService.error('Error creating chat session:', error);\n\t\t\tthrow error;\n\t\t}\n\t}\n\n\tprivate async _provideChatSessionContent(providerHandle: number, sessionResource: URI, token: CancellationToken): Promise<IChatSession> {\n\t\tlet session = this._activeSessions.get(sessionResource);\n\n\t\tif (!session) {\n\t\t\tsession = new ObservableChatSession(\n\t\t\t\tsessionResource,\n\t\t\t\tproviderHandle,\n\t\t\t\tthis._proxy,\n\t\t\t\tthis._logService,\n\t\t\t\tthis._dialogService\n\t\t\t);\n\t\t\tthis._activeSessions.set(sessionResource, session);\n\t\t\tconst disposable = session.onWillDispose(() => {\n\t\t\t\tthis._activeSessions.delete(sessionResource);\n\t\t\t\tthis._sessionDisposables.get(sessionResource)?.dispose();\n\t\t\t\tthis._sessionDisposables.delete(sessionResource);\n\t\t\t});\n\t\t\tthis._sessionDisposables.set(sessionResource, disposable);\n\t\t}\n\n\t\ttry {\n\t\t\tawait session.initialize(token);\n\t\t\tif (session.options) {\n\t\t\t\tfor (const [_, handle] of this._sessionTypeToHandle) {\n\t\t\t\t\tif (handle === providerHandle) {\n\t\t\t\t\t\tfor (const [optionId, value] of Object.entries(session.options)) {\n\t\t\t\t\t\t\tthis._chatSessionsService.setSessionOption(sessionResource, optionId, value);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn session;\n\t\t} catch (error) {\n\t\t\tsession.dispose();\n\t\t\tthis._logService.error(`Error providing chat session content for handle ${providerHandle} and resource ${sessionResource.toString()}:`, error);\n\t\t\tthrow error;\n\t\t}\n\t}\n\n\t$unregisterChatSessionItemProvider(handle: number): void {\n\t\tthis._itemProvidersRegistrations.deleteAndDispose(handle);\n\t}\n\n\t$registerChatSessionContentProvider(handle: number, chatSessionScheme: string): void {\n\t\tconst provider: IChatSessionContentProvider = {\n\t\t\tprovideChatSessionContent: (resource, token) => this._provideChatSessionContent(handle, resource, token)\n\t\t};\n\n\t\tthis._sessionTypeToHandle.set(chatSessionScheme, handle);\n\t\tthis._contentProvidersRegistrations.set(handle, this._chatSessionsService.registerChatSessionContentProvider(chatSessionScheme, provider));\n\t\tthis._proxy.$provideChatSessionProviderOptions(handle, CancellationToken.None).then(options => {\n\t\t\tif (options?.optionGroups && options.optionGroups.length) {\n\t\t\t\tthis._chatSessionsService.setOptionGroupsForSessionType(chatSessionScheme, handle, options.optionGroups);\n\t\t\t}\n\t\t}).catch(err => this._logService.error('Error fetching chat session options', err));\n\t}\n\n\t$unregisterChatSessionContentProvider(handle: number): void {\n\t\tthis._contentProvidersRegistrations.deleteAndDispose(handle);\n\t\tfor (const [sessionType, h] of this._sessionTypeToHandle) {\n\t\t\tif (h === handle) {\n\t\t\t\tthis._sessionTypeToHandle.delete(sessionType);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\t// dispose all sessions from this provider and clean up its disposables\n\t\tfor (const [key, session] of this._activeSessions) {\n\t\t\tif (session.providerHandle === handle) {\n\t\t\t\tsession.dispose();\n\t\t\t\tthis._activeSessions.delete(key);\n\t\t\t}\n\t\t}\n\t}\n\n\tasync $handleProgressChunk(handle: number, sessionResource: UriComponents, requestId: string, chunks: (IChatProgressDto | [IChatProgressDto, number])[]): Promise<void> {\n\t\tconst resource = URI.revive(sessionResource);\n\t\tconst observableSession = this._activeSessions.get(resource);\n\t\tif (!observableSession) {\n\t\t\tthis._logService.warn(`No session found for progress chunks: handle ${handle}, sessionResource ${resource}, requestId ${requestId}`);\n\t\t\treturn;\n\t\t}\n\n\t\tconst chatProgressParts: IChatProgress[] = chunks.map(chunk => {\n\t\t\tconst [progress] = Array.isArray(chunk) ? chunk : [chunk];\n\t\t\treturn revive(progress) as IChatProgress;\n\t\t});\n\n\t\tobservableSession.handleProgressChunk(requestId, chatProgressParts);\n\t}\n\n\t$handleProgressComplete(handle: number, sessionResource: UriComponents, requestId: string) {\n\t\tconst resource = URI.revive(sessionResource);\n\t\tconst observableSession = this._activeSessions.get(resource);\n\t\tif (!observableSession) {\n\t\t\tthis._logService.warn(`No session found for progress completion: handle ${handle}, sessionResource ${resource}, requestId ${requestId}`);\n\t\t\treturn;\n\t\t}\n\n\t\tobservableSession.handleProgressComplete(requestId);\n\t}\n\n\t$handleAnchorResolve(handle: number, sesssionResource: UriComponents, requestId: string, requestHandle: string, anchor: Dto<IChatContentInlineReference>): void {\n\t\t// throw new Error('Method not implemented.');\n\t}\n\n\toverride dispose(): void {\n\t\tfor (const session of this._activeSessions.values()) {\n\t\t\tsession.dispose();\n\t\t}\n\t\tthis._activeSessions.clear();\n\n\t\tfor (const disposable of this._sessionDisposables.values()) {\n\t\t\tdisposable.dispose();\n\t\t}\n\t\tthis._sessionDisposables.clear();\n\n\t\tsuper.dispose();\n\t}\n\n\tprivate _reviveTooltip(tooltip: string | IMarkdownString | undefined): string | MarkdownString | undefined {\n\t\tif (!tooltip) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\t// If it's already a string, return as-is\n\t\tif (typeof tooltip === 'string') {\n\t\t\treturn tooltip;\n\t\t}\n\n\t\t// If it's a serialized IMarkdownString, revive it to MarkdownString\n\t\tif (typeof tooltip === 'object' && 'value' in tooltip) {\n\t\t\treturn MarkdownString.lift(tooltip);\n\t\t}\n\n\t\treturn undefined;\n\t}\n\n\t/**\n\t * Notify the extension about option changes for a session\n\t */\n\tasync notifyOptionsChange(handle: number, sessionResource: URI, updates: ReadonlyArray<{ optionId: string; value: string | undefined }>): Promise<void> {\n\t\ttry {\n\t\t\tawait this._proxy.$provideHandleOptionsChange(handle, sessionResource, updates, CancellationToken.None);\n\t\t} catch (error) {\n\t\t\tthis._logService.error(`Error notifying extension about options change for handle ${handle}, sessionResource ${sessionResource}:`, error);\n\t\t}\n\t}\n}\n"]}