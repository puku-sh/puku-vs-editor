{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/api/browser/mainThreadDecorations.ts","vs/workbench/api/browser/mainThreadDecorations.ts"],"names":[],"mappings":"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","file":"mainThreadDecorations.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { URI, UriComponents } from '../../../base/common/uri.js';\nimport { Emitter } from '../../../base/common/event.js';\nimport { IDisposable, dispose } from '../../../base/common/lifecycle.js';\nimport { ExtHostContext, MainContext, MainThreadDecorationsShape, ExtHostDecorationsShape, DecorationData, DecorationRequest } from '../common/extHost.protocol.js';\nimport { extHostNamedCustomer, IExtHostContext } from '../../services/extensions/common/extHostCustomers.js';\nimport { IDecorationsService, IDecorationData } from '../../services/decorations/common/decorations.js';\nimport { CancellationToken } from '../../../base/common/cancellation.js';\nimport { DeferredPromise } from '../../../base/common/async.js';\nimport { CancellationError } from '../../../base/common/errors.js';\n\nclass DecorationRequestsQueue {\n\n\tprivate _idPool = 0;\n\tprivate _requests = new Map<number, DecorationRequest>();\n\tprivate _resolver = new Map<number, DeferredPromise<DecorationData>>();\n\n\tprivate _timer: Timeout | undefined;\n\n\tconstructor(\n\t\tprivate readonly _proxy: ExtHostDecorationsShape,\n\t\tprivate readonly _handle: number\n\t) {\n\t\t//\n\t}\n\n\tenqueue(uri: URI, token: CancellationToken): Promise<DecorationData> {\n\t\tconst id = ++this._idPool;\n\n\t\tconst defer = new DeferredPromise<DecorationData>();\n\t\tthis._requests.set(id, { id, uri });\n\t\tthis._resolver.set(id, defer);\n\t\tthis._processQueue();\n\n\t\tconst sub = token.onCancellationRequested(() => {\n\t\t\tthis._requests.delete(id);\n\t\t\tthis._resolver.delete(id);\n\t\t\tdefer.error(new CancellationError());\n\t\t});\n\t\treturn defer.p.finally(() => sub.dispose());\n\t}\n\n\tprivate _processQueue(): void {\n\t\tif (this._timer !== undefined) {\n\t\t\t// already queued\n\t\t\treturn;\n\t\t}\n\t\tthis._timer = setTimeout(() => {\n\t\t\t// make request\n\t\t\tconst requests = this._requests;\n\t\t\tconst resolver = this._resolver;\n\t\t\tthis._proxy.$provideDecorations(this._handle, [...requests.values()], CancellationToken.None).then(data => {\n\t\t\t\tfor (const [id, defer] of resolver) {\n\t\t\t\t\tdefer.complete(data[id]);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t// reset\n\t\t\tthis._requests = new Map();\n\t\t\tthis._resolver = new Map();\n\t\t\tthis._timer = undefined;\n\t\t}, 0);\n\t}\n}\n\n@extHostNamedCustomer(MainContext.MainThreadDecorations)\nexport class MainThreadDecorations implements MainThreadDecorationsShape {\n\n\tprivate readonly _provider = new Map<number, [Emitter<URI[]>, IDisposable]>();\n\tprivate readonly _proxy: ExtHostDecorationsShape;\n\n\tconstructor(\n\t\tcontext: IExtHostContext,\n\t\t@IDecorationsService private readonly _decorationsService: IDecorationsService\n\t) {\n\t\tthis._proxy = context.getProxy(ExtHostContext.ExtHostDecorations);\n\t}\n\n\tdispose() {\n\t\tthis._provider.forEach(value => dispose(value));\n\t\tthis._provider.clear();\n\t}\n\n\t$registerDecorationProvider(handle: number, label: string): void {\n\t\tconst emitter = new Emitter<URI[]>();\n\t\tconst queue = new DecorationRequestsQueue(this._proxy, handle);\n\t\tconst registration = this._decorationsService.registerDecorationsProvider({\n\t\t\tlabel,\n\t\t\tonDidChange: emitter.event,\n\t\t\tprovideDecorations: async (uri, token): Promise<IDecorationData | undefined> => {\n\t\t\t\tconst data = await queue.enqueue(uri, token);\n\t\t\t\tif (!data) {\n\t\t\t\t\treturn undefined;\n\t\t\t\t}\n\t\t\t\tconst [bubble, tooltip, letter, themeColor] = data;\n\t\t\t\treturn {\n\t\t\t\t\tweight: 10,\n\t\t\t\t\tbubble: bubble ?? false,\n\t\t\t\t\tcolor: themeColor?.id,\n\t\t\t\t\ttooltip,\n\t\t\t\t\tletter\n\t\t\t\t};\n\t\t\t}\n\t\t});\n\t\tthis._provider.set(handle, [emitter, registration]);\n\t}\n\n\t$onDidChange(handle: number, resources: UriComponents[]): void {\n\t\tconst provider = this._provider.get(handle);\n\t\tif (provider) {\n\t\t\tconst [emitter] = provider;\n\t\t\temitter.fire(resources && resources.map(r => URI.revive(r)));\n\t\t}\n\t}\n\n\t$unregisterDecorationProvider(handle: number): void {\n\t\tconst provider = this._provider.get(handle);\n\t\tif (provider) {\n\t\t\tdispose(provider);\n\t\t\tthis._provider.delete(handle);\n\t\t}\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { URI, UriComponents } from '../../../base/common/uri.js';\nimport { Emitter } from '../../../base/common/event.js';\nimport { IDisposable, dispose } from '../../../base/common/lifecycle.js';\nimport { ExtHostContext, MainContext, MainThreadDecorationsShape, ExtHostDecorationsShape, DecorationData, DecorationRequest } from '../common/extHost.protocol.js';\nimport { extHostNamedCustomer, IExtHostContext } from '../../services/extensions/common/extHostCustomers.js';\nimport { IDecorationsService, IDecorationData } from '../../services/decorations/common/decorations.js';\nimport { CancellationToken } from '../../../base/common/cancellation.js';\nimport { DeferredPromise } from '../../../base/common/async.js';\nimport { CancellationError } from '../../../base/common/errors.js';\n\nclass DecorationRequestsQueue {\n\n\tprivate _idPool = 0;\n\tprivate _requests = new Map<number, DecorationRequest>();\n\tprivate _resolver = new Map<number, DeferredPromise<DecorationData>>();\n\n\tprivate _timer: Timeout | undefined;\n\n\tconstructor(\n\t\tprivate readonly _proxy: ExtHostDecorationsShape,\n\t\tprivate readonly _handle: number\n\t) {\n\t\t//\n\t}\n\n\tenqueue(uri: URI, token: CancellationToken): Promise<DecorationData> {\n\t\tconst id = ++this._idPool;\n\n\t\tconst defer = new DeferredPromise<DecorationData>();\n\t\tthis._requests.set(id, { id, uri });\n\t\tthis._resolver.set(id, defer);\n\t\tthis._processQueue();\n\n\t\tconst sub = token.onCancellationRequested(() => {\n\t\t\tthis._requests.delete(id);\n\t\t\tthis._resolver.delete(id);\n\t\t\tdefer.error(new CancellationError());\n\t\t});\n\t\treturn defer.p.finally(() => sub.dispose());\n\t}\n\n\tprivate _processQueue(): void {\n\t\tif (this._timer !== undefined) {\n\t\t\t// already queued\n\t\t\treturn;\n\t\t}\n\t\tthis._timer = setTimeout(() => {\n\t\t\t// make request\n\t\t\tconst requests = this._requests;\n\t\t\tconst resolver = this._resolver;\n\t\t\tthis._proxy.$provideDecorations(this._handle, [...requests.values()], CancellationToken.None).then(data => {\n\t\t\t\tfor (const [id, defer] of resolver) {\n\t\t\t\t\tdefer.complete(data[id]);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t// reset\n\t\t\tthis._requests = new Map();\n\t\t\tthis._resolver = new Map();\n\t\t\tthis._timer = undefined;\n\t\t}, 0);\n\t}\n}\n\n@extHostNamedCustomer(MainContext.MainThreadDecorations)\nexport class MainThreadDecorations implements MainThreadDecorationsShape {\n\n\tprivate readonly _provider = new Map<number, [Emitter<URI[]>, IDisposable]>();\n\tprivate readonly _proxy: ExtHostDecorationsShape;\n\n\tconstructor(\n\t\tcontext: IExtHostContext,\n\t\t@IDecorationsService private readonly _decorationsService: IDecorationsService\n\t) {\n\t\tthis._proxy = context.getProxy(ExtHostContext.ExtHostDecorations);\n\t}\n\n\tdispose() {\n\t\tthis._provider.forEach(value => dispose(value));\n\t\tthis._provider.clear();\n\t}\n\n\t$registerDecorationProvider(handle: number, label: string): void {\n\t\tconst emitter = new Emitter<URI[]>();\n\t\tconst queue = new DecorationRequestsQueue(this._proxy, handle);\n\t\tconst registration = this._decorationsService.registerDecorationsProvider({\n\t\t\tlabel,\n\t\t\tonDidChange: emitter.event,\n\t\t\tprovideDecorations: async (uri, token): Promise<IDecorationData | undefined> => {\n\t\t\t\tconst data = await queue.enqueue(uri, token);\n\t\t\t\tif (!data) {\n\t\t\t\t\treturn undefined;\n\t\t\t\t}\n\t\t\t\tconst [bubble, tooltip, letter, themeColor] = data;\n\t\t\t\treturn {\n\t\t\t\t\tweight: 10,\n\t\t\t\t\tbubble: bubble ?? false,\n\t\t\t\t\tcolor: themeColor?.id,\n\t\t\t\t\ttooltip,\n\t\t\t\t\tletter\n\t\t\t\t};\n\t\t\t}\n\t\t});\n\t\tthis._provider.set(handle, [emitter, registration]);\n\t}\n\n\t$onDidChange(handle: number, resources: UriComponents[]): void {\n\t\tconst provider = this._provider.get(handle);\n\t\tif (provider) {\n\t\t\tconst [emitter] = provider;\n\t\t\temitter.fire(resources && resources.map(r => URI.revive(r)));\n\t\t}\n\t}\n\n\t$unregisterDecorationProvider(handle: number): void {\n\t\tconst provider = this._provider.get(handle);\n\t\tif (provider) {\n\t\t\tdispose(provider);\n\t\t\tthis._provider.delete(handle);\n\t\t}\n\t}\n}\n"]}