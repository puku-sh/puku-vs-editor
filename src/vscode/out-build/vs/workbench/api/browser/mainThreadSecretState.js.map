{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/api/browser/mainThreadSecretState.ts","vs/workbench/api/browser/mainThreadSecretState.ts"],"names":[],"mappings":"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","file":"mainThreadSecretState.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Disposable } from '../../../base/common/lifecycle.js';\nimport { extHostNamedCustomer, IExtHostContext } from '../../services/extensions/common/extHostCustomers.js';\nimport { ExtHostContext, ExtHostSecretStateShape, MainContext, MainThreadSecretStateShape } from '../common/extHost.protocol.js';\nimport { ILogService } from '../../../platform/log/common/log.js';\nimport { SequencerByKey } from '../../../base/common/async.js';\nimport { ISecretStorageService } from '../../../platform/secrets/common/secrets.js';\nimport { IBrowserWorkbenchEnvironmentService } from '../../services/environment/browser/environmentService.js';\n\n@extHostNamedCustomer(MainContext.MainThreadSecretState)\nexport class MainThreadSecretState extends Disposable implements MainThreadSecretStateShape {\n\tprivate readonly _proxy: ExtHostSecretStateShape;\n\n\tprivate readonly _sequencer = new SequencerByKey<string>();\n\n\tconstructor(\n\t\textHostContext: IExtHostContext,\n\t\t@ISecretStorageService private readonly secretStorageService: ISecretStorageService,\n\t\t@ILogService private readonly logService: ILogService,\n\t\t@IBrowserWorkbenchEnvironmentService environmentService: IBrowserWorkbenchEnvironmentService\n\t) {\n\t\tsuper();\n\n\t\tthis._proxy = extHostContext.getProxy(ExtHostContext.ExtHostSecretState);\n\n\t\tthis._register(this.secretStorageService.onDidChangeSecret((e: string) => {\n\t\t\tconst parsedKey = this.parseKey(e);\n\t\t\tif (parsedKey) {\n\t\t\t\tthis._proxy.$onDidChangePassword(parsedKey);\n\t\t\t}\n\t\t}));\n\t}\n\n\t$getPassword(extensionId: string, key: string): Promise<string | undefined> {\n\t\tthis.logService.trace(`[mainThreadSecretState] Getting password for ${extensionId} extension: `, key);\n\t\treturn this._sequencer.queue(extensionId, () => this.doGetPassword(extensionId, key));\n\t}\n\n\tprivate async doGetPassword(extensionId: string, key: string): Promise<string | undefined> {\n\t\tconst fullKey = this.getKey(extensionId, key);\n\t\tconst password = await this.secretStorageService.get(fullKey);\n\t\tthis.logService.trace(`[mainThreadSecretState] ${password ? 'P' : 'No p'}assword found for: `, extensionId, key);\n\t\treturn password;\n\t}\n\n\t$setPassword(extensionId: string, key: string, value: string): Promise<void> {\n\t\tthis.logService.trace(`[mainThreadSecretState] Setting password for ${extensionId} extension: `, key);\n\t\treturn this._sequencer.queue(extensionId, () => this.doSetPassword(extensionId, key, value));\n\t}\n\n\tprivate async doSetPassword(extensionId: string, key: string, value: string): Promise<void> {\n\t\tconst fullKey = this.getKey(extensionId, key);\n\t\tawait this.secretStorageService.set(fullKey, value);\n\t\tthis.logService.trace('[mainThreadSecretState] Password set for: ', extensionId, key);\n\t}\n\n\t$deletePassword(extensionId: string, key: string): Promise<void> {\n\t\tthis.logService.trace(`[mainThreadSecretState] Deleting password for ${extensionId} extension: `, key);\n\t\treturn this._sequencer.queue(extensionId, () => this.doDeletePassword(extensionId, key));\n\t}\n\n\tprivate async doDeletePassword(extensionId: string, key: string): Promise<void> {\n\t\tconst fullKey = this.getKey(extensionId, key);\n\t\tawait this.secretStorageService.delete(fullKey);\n\t\tthis.logService.trace('[mainThreadSecretState] Password deleted for: ', extensionId, key);\n\t}\n\n\t$getKeys(extensionId: string): Promise<string[]> {\n\t\tthis.logService.trace(`[mainThreadSecretState] Getting keys for ${extensionId} extension: `);\n\t\treturn this._sequencer.queue(extensionId, () => this.doGetKeys(extensionId));\n\t}\n\n\tprivate async doGetKeys(extensionId: string): Promise<string[]> {\n\t\tif (!this.secretStorageService.keys) {\n\t\t\tthrow new Error('Secret storage service does not support keys() method');\n\t\t}\n\t\tconst allKeys = await this.secretStorageService.keys();\n\t\tconst keys = allKeys\n\t\t\t.map(key => this.parseKey(key))\n\t\t\t.filter((parsedKey): parsedKey is { extensionId: string; key: string } => parsedKey !== undefined && parsedKey.extensionId === extensionId)\n\t\t\t.map(({ key }) => key); // Return only my keys\n\t\tthis.logService.trace(`[mainThreadSecretState] Got ${keys.length}key(s) for: `, extensionId);\n\t\treturn keys;\n\t}\n\n\tprivate getKey(extensionId: string, key: string): string {\n\t\treturn JSON.stringify({ extensionId, key });\n\t}\n\n\tprivate parseKey(key: string): { extensionId: string; key: string } | undefined {\n\t\ttry {\n\t\t\treturn JSON.parse(key);\n\t\t} catch {\n\t\t\treturn undefined;\n\t\t}\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Disposable } from '../../../base/common/lifecycle.js';\nimport { extHostNamedCustomer, IExtHostContext } from '../../services/extensions/common/extHostCustomers.js';\nimport { ExtHostContext, ExtHostSecretStateShape, MainContext, MainThreadSecretStateShape } from '../common/extHost.protocol.js';\nimport { ILogService } from '../../../platform/log/common/log.js';\nimport { SequencerByKey } from '../../../base/common/async.js';\nimport { ISecretStorageService } from '../../../platform/secrets/common/secrets.js';\nimport { IBrowserWorkbenchEnvironmentService } from '../../services/environment/browser/environmentService.js';\n\n@extHostNamedCustomer(MainContext.MainThreadSecretState)\nexport class MainThreadSecretState extends Disposable implements MainThreadSecretStateShape {\n\tprivate readonly _proxy: ExtHostSecretStateShape;\n\n\tprivate readonly _sequencer = new SequencerByKey<string>();\n\n\tconstructor(\n\t\textHostContext: IExtHostContext,\n\t\t@ISecretStorageService private readonly secretStorageService: ISecretStorageService,\n\t\t@ILogService private readonly logService: ILogService,\n\t\t@IBrowserWorkbenchEnvironmentService environmentService: IBrowserWorkbenchEnvironmentService\n\t) {\n\t\tsuper();\n\n\t\tthis._proxy = extHostContext.getProxy(ExtHostContext.ExtHostSecretState);\n\n\t\tthis._register(this.secretStorageService.onDidChangeSecret((e: string) => {\n\t\t\tconst parsedKey = this.parseKey(e);\n\t\t\tif (parsedKey) {\n\t\t\t\tthis._proxy.$onDidChangePassword(parsedKey);\n\t\t\t}\n\t\t}));\n\t}\n\n\t$getPassword(extensionId: string, key: string): Promise<string | undefined> {\n\t\tthis.logService.trace(`[mainThreadSecretState] Getting password for ${extensionId} extension: `, key);\n\t\treturn this._sequencer.queue(extensionId, () => this.doGetPassword(extensionId, key));\n\t}\n\n\tprivate async doGetPassword(extensionId: string, key: string): Promise<string | undefined> {\n\t\tconst fullKey = this.getKey(extensionId, key);\n\t\tconst password = await this.secretStorageService.get(fullKey);\n\t\tthis.logService.trace(`[mainThreadSecretState] ${password ? 'P' : 'No p'}assword found for: `, extensionId, key);\n\t\treturn password;\n\t}\n\n\t$setPassword(extensionId: string, key: string, value: string): Promise<void> {\n\t\tthis.logService.trace(`[mainThreadSecretState] Setting password for ${extensionId} extension: `, key);\n\t\treturn this._sequencer.queue(extensionId, () => this.doSetPassword(extensionId, key, value));\n\t}\n\n\tprivate async doSetPassword(extensionId: string, key: string, value: string): Promise<void> {\n\t\tconst fullKey = this.getKey(extensionId, key);\n\t\tawait this.secretStorageService.set(fullKey, value);\n\t\tthis.logService.trace('[mainThreadSecretState] Password set for: ', extensionId, key);\n\t}\n\n\t$deletePassword(extensionId: string, key: string): Promise<void> {\n\t\tthis.logService.trace(`[mainThreadSecretState] Deleting password for ${extensionId} extension: `, key);\n\t\treturn this._sequencer.queue(extensionId, () => this.doDeletePassword(extensionId, key));\n\t}\n\n\tprivate async doDeletePassword(extensionId: string, key: string): Promise<void> {\n\t\tconst fullKey = this.getKey(extensionId, key);\n\t\tawait this.secretStorageService.delete(fullKey);\n\t\tthis.logService.trace('[mainThreadSecretState] Password deleted for: ', extensionId, key);\n\t}\n\n\t$getKeys(extensionId: string): Promise<string[]> {\n\t\tthis.logService.trace(`[mainThreadSecretState] Getting keys for ${extensionId} extension: `);\n\t\treturn this._sequencer.queue(extensionId, () => this.doGetKeys(extensionId));\n\t}\n\n\tprivate async doGetKeys(extensionId: string): Promise<string[]> {\n\t\tif (!this.secretStorageService.keys) {\n\t\t\tthrow new Error('Secret storage service does not support keys() method');\n\t\t}\n\t\tconst allKeys = await this.secretStorageService.keys();\n\t\tconst keys = allKeys\n\t\t\t.map(key => this.parseKey(key))\n\t\t\t.filter((parsedKey): parsedKey is { extensionId: string; key: string } => parsedKey !== undefined && parsedKey.extensionId === extensionId)\n\t\t\t.map(({ key }) => key); // Return only my keys\n\t\tthis.logService.trace(`[mainThreadSecretState] Got ${keys.length}key(s) for: `, extensionId);\n\t\treturn keys;\n\t}\n\n\tprivate getKey(extensionId: string, key: string): string {\n\t\treturn JSON.stringify({ extensionId, key });\n\t}\n\n\tprivate parseKey(key: string): { extensionId: string; key: string } | undefined {\n\t\ttry {\n\t\t\treturn JSON.parse(key);\n\t\t} catch {\n\t\t\treturn undefined;\n\t\t}\n\t}\n}\n"]}