{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/api/browser/mainThreadManagedSockets.ts","vs/workbench/api/browser/mainThreadManagedSockets.ts"],"names":[],"mappings":"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","file":"mainThreadManagedSockets.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { VSBuffer } from '../../../base/common/buffer.js';\nimport { Emitter } from '../../../base/common/event.js';\nimport { Disposable, IDisposable } from '../../../base/common/lifecycle.js';\nimport { ISocket, SocketCloseEventType } from '../../../base/parts/ipc/common/ipc.net.js';\nimport { ManagedSocket, RemoteSocketHalf, connectManagedSocket } from '../../../platform/remote/common/managedSocket.js';\nimport { ManagedRemoteConnection, RemoteConnectionType } from '../../../platform/remote/common/remoteAuthorityResolver.js';\nimport { IRemoteSocketFactoryService, ISocketFactory } from '../../../platform/remote/common/remoteSocketFactoryService.js';\nimport { ExtHostContext, ExtHostManagedSocketsShape, MainContext, MainThreadManagedSocketsShape } from '../common/extHost.protocol.js';\nimport { IExtHostContext, extHostNamedCustomer } from '../../services/extensions/common/extHostCustomers.js';\n\n@extHostNamedCustomer(MainContext.MainThreadManagedSockets)\nexport class MainThreadManagedSockets extends Disposable implements MainThreadManagedSocketsShape {\n\n\tprivate readonly _proxy: ExtHostManagedSocketsShape;\n\tprivate readonly _registrations = new Map<number, IDisposable>();\n\tprivate readonly _remoteSockets = new Map<number, RemoteSocketHalf>();\n\n\tconstructor(\n\t\textHostContext: IExtHostContext,\n\t\t@IRemoteSocketFactoryService private readonly _remoteSocketFactoryService: IRemoteSocketFactoryService,\n\t) {\n\t\tsuper();\n\t\tthis._proxy = extHostContext.getProxy(ExtHostContext.ExtHostManagedSockets);\n\t}\n\n\tasync $registerSocketFactory(socketFactoryId: number): Promise<void> {\n\t\tconst that = this;\n\t\tconst socketFactory = new class implements ISocketFactory<RemoteConnectionType.Managed> {\n\n\t\t\tsupports(connectTo: ManagedRemoteConnection): boolean {\n\t\t\t\treturn (connectTo.id === socketFactoryId);\n\t\t\t}\n\n\t\t\tconnect(connectTo: ManagedRemoteConnection, path: string, query: string, debugLabel: string): Promise<ISocket> {\n\t\t\t\treturn new Promise<ISocket>((resolve, reject) => {\n\t\t\t\t\tif (connectTo.id !== socketFactoryId) {\n\t\t\t\t\t\treturn reject(new Error('Invalid connectTo'));\n\t\t\t\t\t}\n\n\t\t\t\t\tconst factoryId = connectTo.id;\n\t\t\t\t\tthat._proxy.$openRemoteSocket(factoryId).then(socketId => {\n\t\t\t\t\t\tconst half: RemoteSocketHalf = {\n\t\t\t\t\t\t\tonClose: new Emitter(),\n\t\t\t\t\t\t\tonData: new Emitter(),\n\t\t\t\t\t\t\tonEnd: new Emitter(),\n\t\t\t\t\t\t};\n\t\t\t\t\t\tthat._remoteSockets.set(socketId, half);\n\n\t\t\t\t\t\tMainThreadManagedSocket.connect(socketId, that._proxy, path, query, debugLabel, half)\n\t\t\t\t\t\t\t.then(\n\t\t\t\t\t\t\t\tsocket => {\n\t\t\t\t\t\t\t\t\tsocket.onDidDispose(() => that._remoteSockets.delete(socketId));\n\t\t\t\t\t\t\t\t\tresolve(socket);\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\terr => {\n\t\t\t\t\t\t\t\t\tthat._remoteSockets.delete(socketId);\n\t\t\t\t\t\t\t\t\treject(err);\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t}).catch(reject);\n\t\t\t\t});\n\t\t\t}\n\t\t};\n\t\tthis._registrations.set(socketFactoryId, this._remoteSocketFactoryService.register(RemoteConnectionType.Managed, socketFactory));\n\n\t}\n\n\tasync $unregisterSocketFactory(socketFactoryId: number): Promise<void> {\n\t\tthis._registrations.get(socketFactoryId)?.dispose();\n\t}\n\n\t$onDidManagedSocketHaveData(socketId: number, data: VSBuffer): void {\n\t\tthis._remoteSockets.get(socketId)?.onData.fire(data);\n\t}\n\n\t$onDidManagedSocketClose(socketId: number, error: string | undefined): void {\n\t\tthis._remoteSockets.get(socketId)?.onClose.fire({\n\t\t\ttype: SocketCloseEventType.NodeSocketCloseEvent,\n\t\t\terror: error ? new Error(error) : undefined,\n\t\t\thadError: !!error\n\t\t});\n\t\tthis._remoteSockets.delete(socketId);\n\t}\n\n\t$onDidManagedSocketEnd(socketId: number): void {\n\t\tthis._remoteSockets.get(socketId)?.onEnd.fire();\n\t}\n}\n\nexport class MainThreadManagedSocket extends ManagedSocket {\n\tpublic static connect(\n\t\tsocketId: number,\n\t\tproxy: ExtHostManagedSocketsShape,\n\t\tpath: string, query: string, debugLabel: string,\n\t\thalf: RemoteSocketHalf\n\t): Promise<MainThreadManagedSocket> {\n\t\tconst socket = new MainThreadManagedSocket(socketId, proxy, debugLabel, half);\n\t\treturn connectManagedSocket(socket, path, query, debugLabel, half);\n\t}\n\n\tprivate constructor(\n\t\tprivate readonly socketId: number,\n\t\tprivate readonly proxy: ExtHostManagedSocketsShape,\n\t\tdebugLabel: string,\n\t\thalf: RemoteSocketHalf,\n\t) {\n\t\tsuper(debugLabel, half);\n\t}\n\n\tpublic override write(buffer: VSBuffer): void {\n\t\tthis.proxy.$remoteSocketWrite(this.socketId, buffer);\n\t}\n\n\tprotected override  closeRemote(): void {\n\t\tthis.proxy.$remoteSocketEnd(this.socketId);\n\t}\n\n\tpublic override drain(): Promise<void> {\n\t\treturn this.proxy.$remoteSocketDrain(this.socketId);\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { VSBuffer } from '../../../base/common/buffer.js';\nimport { Emitter } from '../../../base/common/event.js';\nimport { Disposable, IDisposable } from '../../../base/common/lifecycle.js';\nimport { ISocket, SocketCloseEventType } from '../../../base/parts/ipc/common/ipc.net.js';\nimport { ManagedSocket, RemoteSocketHalf, connectManagedSocket } from '../../../platform/remote/common/managedSocket.js';\nimport { ManagedRemoteConnection, RemoteConnectionType } from '../../../platform/remote/common/remoteAuthorityResolver.js';\nimport { IRemoteSocketFactoryService, ISocketFactory } from '../../../platform/remote/common/remoteSocketFactoryService.js';\nimport { ExtHostContext, ExtHostManagedSocketsShape, MainContext, MainThreadManagedSocketsShape } from '../common/extHost.protocol.js';\nimport { IExtHostContext, extHostNamedCustomer } from '../../services/extensions/common/extHostCustomers.js';\n\n@extHostNamedCustomer(MainContext.MainThreadManagedSockets)\nexport class MainThreadManagedSockets extends Disposable implements MainThreadManagedSocketsShape {\n\n\tprivate readonly _proxy: ExtHostManagedSocketsShape;\n\tprivate readonly _registrations = new Map<number, IDisposable>();\n\tprivate readonly _remoteSockets = new Map<number, RemoteSocketHalf>();\n\n\tconstructor(\n\t\textHostContext: IExtHostContext,\n\t\t@IRemoteSocketFactoryService private readonly _remoteSocketFactoryService: IRemoteSocketFactoryService,\n\t) {\n\t\tsuper();\n\t\tthis._proxy = extHostContext.getProxy(ExtHostContext.ExtHostManagedSockets);\n\t}\n\n\tasync $registerSocketFactory(socketFactoryId: number): Promise<void> {\n\t\tconst that = this;\n\t\tconst socketFactory = new class implements ISocketFactory<RemoteConnectionType.Managed> {\n\n\t\t\tsupports(connectTo: ManagedRemoteConnection): boolean {\n\t\t\t\treturn (connectTo.id === socketFactoryId);\n\t\t\t}\n\n\t\t\tconnect(connectTo: ManagedRemoteConnection, path: string, query: string, debugLabel: string): Promise<ISocket> {\n\t\t\t\treturn new Promise<ISocket>((resolve, reject) => {\n\t\t\t\t\tif (connectTo.id !== socketFactoryId) {\n\t\t\t\t\t\treturn reject(new Error('Invalid connectTo'));\n\t\t\t\t\t}\n\n\t\t\t\t\tconst factoryId = connectTo.id;\n\t\t\t\t\tthat._proxy.$openRemoteSocket(factoryId).then(socketId => {\n\t\t\t\t\t\tconst half: RemoteSocketHalf = {\n\t\t\t\t\t\t\tonClose: new Emitter(),\n\t\t\t\t\t\t\tonData: new Emitter(),\n\t\t\t\t\t\t\tonEnd: new Emitter(),\n\t\t\t\t\t\t};\n\t\t\t\t\t\tthat._remoteSockets.set(socketId, half);\n\n\t\t\t\t\t\tMainThreadManagedSocket.connect(socketId, that._proxy, path, query, debugLabel, half)\n\t\t\t\t\t\t\t.then(\n\t\t\t\t\t\t\t\tsocket => {\n\t\t\t\t\t\t\t\t\tsocket.onDidDispose(() => that._remoteSockets.delete(socketId));\n\t\t\t\t\t\t\t\t\tresolve(socket);\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\terr => {\n\t\t\t\t\t\t\t\t\tthat._remoteSockets.delete(socketId);\n\t\t\t\t\t\t\t\t\treject(err);\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t}).catch(reject);\n\t\t\t\t});\n\t\t\t}\n\t\t};\n\t\tthis._registrations.set(socketFactoryId, this._remoteSocketFactoryService.register(RemoteConnectionType.Managed, socketFactory));\n\n\t}\n\n\tasync $unregisterSocketFactory(socketFactoryId: number): Promise<void> {\n\t\tthis._registrations.get(socketFactoryId)?.dispose();\n\t}\n\n\t$onDidManagedSocketHaveData(socketId: number, data: VSBuffer): void {\n\t\tthis._remoteSockets.get(socketId)?.onData.fire(data);\n\t}\n\n\t$onDidManagedSocketClose(socketId: number, error: string | undefined): void {\n\t\tthis._remoteSockets.get(socketId)?.onClose.fire({\n\t\t\ttype: SocketCloseEventType.NodeSocketCloseEvent,\n\t\t\terror: error ? new Error(error) : undefined,\n\t\t\thadError: !!error\n\t\t});\n\t\tthis._remoteSockets.delete(socketId);\n\t}\n\n\t$onDidManagedSocketEnd(socketId: number): void {\n\t\tthis._remoteSockets.get(socketId)?.onEnd.fire();\n\t}\n}\n\nexport class MainThreadManagedSocket extends ManagedSocket {\n\tpublic static connect(\n\t\tsocketId: number,\n\t\tproxy: ExtHostManagedSocketsShape,\n\t\tpath: string, query: string, debugLabel: string,\n\t\thalf: RemoteSocketHalf\n\t): Promise<MainThreadManagedSocket> {\n\t\tconst socket = new MainThreadManagedSocket(socketId, proxy, debugLabel, half);\n\t\treturn connectManagedSocket(socket, path, query, debugLabel, half);\n\t}\n\n\tprivate constructor(\n\t\tprivate readonly socketId: number,\n\t\tprivate readonly proxy: ExtHostManagedSocketsShape,\n\t\tdebugLabel: string,\n\t\thalf: RemoteSocketHalf,\n\t) {\n\t\tsuper(debugLabel, half);\n\t}\n\n\tpublic override write(buffer: VSBuffer): void {\n\t\tthis.proxy.$remoteSocketWrite(this.socketId, buffer);\n\t}\n\n\tprotected override  closeRemote(): void {\n\t\tthis.proxy.$remoteSocketEnd(this.socketId);\n\t}\n\n\tpublic override drain(): Promise<void> {\n\t\treturn this.proxy.$remoteSocketDrain(this.socketId);\n\t}\n}\n"]}