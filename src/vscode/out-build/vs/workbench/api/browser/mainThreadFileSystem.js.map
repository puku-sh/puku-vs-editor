{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/api/browser/mainThreadFileSystem.ts","vs/workbench/api/browser/mainThreadFileSystem.ts"],"names":[],"mappings":"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","file":"mainThreadFileSystem.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Emitter, Event } from '../../../base/common/event.js';\nimport { IDisposable, toDisposable, DisposableStore, DisposableMap } from '../../../base/common/lifecycle.js';\nimport { URI, UriComponents } from '../../../base/common/uri.js';\nimport { IFileWriteOptions, FileSystemProviderCapabilities, IFileChange, IFileService, IStat, IWatchOptions, FileType, IFileOverwriteOptions, IFileDeleteOptions, IFileOpenOptions, FileOperationError, FileOperationResult, FileSystemProviderErrorCode, IFileSystemProviderWithOpenReadWriteCloseCapability, IFileSystemProviderWithFileReadWriteCapability, IFileSystemProviderWithFileFolderCopyCapability, FilePermission, toFileSystemProviderErrorCode, IFileStatWithPartialMetadata, IFileStat } from '../../../platform/files/common/files.js';\nimport { extHostNamedCustomer, IExtHostContext } from '../../services/extensions/common/extHostCustomers.js';\nimport { ExtHostContext, ExtHostFileSystemShape, IFileChangeDto, MainContext, MainThreadFileSystemShape } from '../common/extHost.protocol.js';\nimport { VSBuffer } from '../../../base/common/buffer.js';\nimport { IMarkdownString } from '../../../base/common/htmlContent.js';\n\n@extHostNamedCustomer(MainContext.MainThreadFileSystem)\nexport class MainThreadFileSystem implements MainThreadFileSystemShape {\n\n\tprivate readonly _proxy: ExtHostFileSystemShape;\n\tprivate readonly _fileProvider = new DisposableMap<number, RemoteFileSystemProvider>();\n\tprivate readonly _disposables = new DisposableStore();\n\n\tconstructor(\n\t\textHostContext: IExtHostContext,\n\t\t@IFileService private readonly _fileService: IFileService\n\t) {\n\t\tthis._proxy = extHostContext.getProxy(ExtHostContext.ExtHostFileSystem);\n\n\t\tconst infoProxy = extHostContext.getProxy(ExtHostContext.ExtHostFileSystemInfo);\n\n\t\tfor (const entry of _fileService.listCapabilities()) {\n\t\t\tinfoProxy.$acceptProviderInfos(URI.from({ scheme: entry.scheme, path: '/dummy' }), entry.capabilities);\n\t\t}\n\t\tthis._disposables.add(_fileService.onDidChangeFileSystemProviderRegistrations(e => infoProxy.$acceptProviderInfos(URI.from({ scheme: e.scheme, path: '/dummy' }), e.provider?.capabilities ?? null)));\n\t\tthis._disposables.add(_fileService.onDidChangeFileSystemProviderCapabilities(e => infoProxy.$acceptProviderInfos(URI.from({ scheme: e.scheme, path: '/dummy' }), e.provider.capabilities)));\n\t}\n\n\tdispose(): void {\n\t\tthis._disposables.dispose();\n\t\tthis._fileProvider.dispose();\n\t}\n\n\tasync $registerFileSystemProvider(handle: number, scheme: string, capabilities: FileSystemProviderCapabilities, readonlyMessage?: IMarkdownString): Promise<void> {\n\t\tthis._fileProvider.set(handle, new RemoteFileSystemProvider(this._fileService, scheme, capabilities, readonlyMessage, handle, this._proxy));\n\t}\n\n\t$unregisterProvider(handle: number): void {\n\t\tthis._fileProvider.deleteAndDispose(handle);\n\t}\n\n\t$onFileSystemChange(handle: number, changes: IFileChangeDto[]): void {\n\t\tconst fileProvider = this._fileProvider.get(handle);\n\t\tif (!fileProvider) {\n\t\t\tthrow new Error('Unknown file provider');\n\t\t}\n\t\tfileProvider.$onFileSystemChange(changes);\n\t}\n\n\n\t// --- consumer fs, vscode.workspace.fs\n\n\tasync $stat(uri: UriComponents): Promise<IStat> {\n\t\ttry {\n\t\t\tconst stat = await this._fileService.stat(URI.revive(uri));\n\t\t\treturn {\n\t\t\t\tctime: stat.ctime,\n\t\t\t\tmtime: stat.mtime,\n\t\t\t\tsize: stat.size,\n\t\t\t\tpermissions: stat.readonly ? FilePermission.Readonly : undefined,\n\t\t\t\ttype: MainThreadFileSystem._asFileType(stat)\n\t\t\t};\n\t\t} catch (err) {\n\t\t\treturn MainThreadFileSystem._handleError(err);\n\t\t}\n\t}\n\n\tasync $readdir(uri: UriComponents): Promise<[string, FileType][]> {\n\t\ttry {\n\t\t\tconst stat = await this._fileService.resolve(URI.revive(uri), { resolveMetadata: false });\n\t\t\tif (!stat.isDirectory) {\n\t\t\t\tconst err = new Error(stat.name);\n\t\t\t\terr.name = FileSystemProviderErrorCode.FileNotADirectory;\n\t\t\t\tthrow err;\n\t\t\t}\n\t\t\treturn !stat.children ? [] : stat.children.map(child => [child.name, MainThreadFileSystem._asFileType(child)] as [string, FileType]);\n\t\t} catch (err) {\n\t\t\treturn MainThreadFileSystem._handleError(err);\n\t\t}\n\t}\n\n\tprivate static _asFileType(stat: IFileStat | IFileStatWithPartialMetadata): FileType {\n\t\tlet res = 0;\n\t\tif (stat.isFile) {\n\t\t\tres += FileType.File;\n\n\t\t} else if (stat.isDirectory) {\n\t\t\tres += FileType.Directory;\n\t\t}\n\t\tif (stat.isSymbolicLink) {\n\t\t\tres += FileType.SymbolicLink;\n\t\t}\n\t\treturn res;\n\t}\n\n\tasync $readFile(uri: UriComponents): Promise<VSBuffer> {\n\t\ttry {\n\t\t\tconst file = await this._fileService.readFile(URI.revive(uri));\n\t\t\treturn file.value;\n\t\t} catch (err) {\n\t\t\treturn MainThreadFileSystem._handleError(err);\n\t\t}\n\t}\n\n\tasync $writeFile(uri: UriComponents, content: VSBuffer): Promise<void> {\n\t\ttry {\n\t\t\tawait this._fileService.writeFile(URI.revive(uri), content);\n\t\t} catch (err) {\n\t\t\treturn MainThreadFileSystem._handleError(err);\n\t\t}\n\t}\n\n\tasync $rename(source: UriComponents, target: UriComponents, opts: IFileOverwriteOptions): Promise<void> {\n\t\ttry {\n\t\t\tawait this._fileService.move(URI.revive(source), URI.revive(target), opts.overwrite);\n\t\t} catch (err) {\n\t\t\treturn MainThreadFileSystem._handleError(err);\n\t\t}\n\t}\n\n\tasync $copy(source: UriComponents, target: UriComponents, opts: IFileOverwriteOptions): Promise<void> {\n\t\ttry {\n\t\t\tawait this._fileService.copy(URI.revive(source), URI.revive(target), opts.overwrite);\n\t\t} catch (err) {\n\t\t\treturn MainThreadFileSystem._handleError(err);\n\t\t}\n\t}\n\n\tasync $mkdir(uri: UriComponents): Promise<void> {\n\t\ttry {\n\t\t\tawait this._fileService.createFolder(URI.revive(uri));\n\t\t} catch (err) {\n\t\t\treturn MainThreadFileSystem._handleError(err);\n\t\t}\n\t}\n\n\tasync $delete(uri: UriComponents, opts: IFileDeleteOptions): Promise<void> {\n\t\ttry {\n\t\t\treturn await this._fileService.del(URI.revive(uri), opts);\n\t\t} catch (err) {\n\t\t\treturn MainThreadFileSystem._handleError(err);\n\t\t}\n\t}\n\n\tprivate static _handleError(err: unknown): never {\n\t\tif (err instanceof FileOperationError) {\n\t\t\tswitch (err.fileOperationResult) {\n\t\t\t\tcase FileOperationResult.FILE_NOT_FOUND:\n\t\t\t\t\terr.name = FileSystemProviderErrorCode.FileNotFound;\n\t\t\t\t\tbreak;\n\t\t\t\tcase FileOperationResult.FILE_IS_DIRECTORY:\n\t\t\t\t\terr.name = FileSystemProviderErrorCode.FileIsADirectory;\n\t\t\t\t\tbreak;\n\t\t\t\tcase FileOperationResult.FILE_PERMISSION_DENIED:\n\t\t\t\t\terr.name = FileSystemProviderErrorCode.NoPermissions;\n\t\t\t\t\tbreak;\n\t\t\t\tcase FileOperationResult.FILE_MOVE_CONFLICT:\n\t\t\t\t\terr.name = FileSystemProviderErrorCode.FileExists;\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t} else if (err instanceof Error) {\n\t\t\tconst code = toFileSystemProviderErrorCode(err);\n\t\t\tif (code !== FileSystemProviderErrorCode.Unknown) {\n\t\t\t\terr.name = code;\n\t\t\t}\n\t\t}\n\n\t\tthrow err;\n\t}\n\n\t$ensureActivation(scheme: string): Promise<void> {\n\t\treturn this._fileService.activateProvider(scheme);\n\t}\n}\n\nclass RemoteFileSystemProvider implements IFileSystemProviderWithFileReadWriteCapability, IFileSystemProviderWithOpenReadWriteCloseCapability, IFileSystemProviderWithFileFolderCopyCapability {\n\n\tprivate readonly _onDidChange = new Emitter<readonly IFileChange[]>();\n\tprivate readonly _registration: IDisposable;\n\n\treadonly onDidChangeFile: Event<readonly IFileChange[]> = this._onDidChange.event;\n\n\treadonly capabilities: FileSystemProviderCapabilities;\n\treadonly onDidChangeCapabilities: Event<void> = Event.None;\n\n\tconstructor(\n\t\tfileService: IFileService,\n\t\tscheme: string,\n\t\tcapabilities: FileSystemProviderCapabilities,\n\t\tpublic readonly readOnlyMessage: IMarkdownString | undefined,\n\t\tprivate readonly _handle: number,\n\t\tprivate readonly _proxy: ExtHostFileSystemShape\n\t) {\n\t\tthis.capabilities = capabilities;\n\t\tthis._registration = fileService.registerProvider(scheme, this);\n\t}\n\n\tdispose(): void {\n\t\tthis._registration.dispose();\n\t\tthis._onDidChange.dispose();\n\t}\n\n\twatch(resource: URI, opts: IWatchOptions) {\n\t\tconst session = Math.random();\n\t\tthis._proxy.$watch(this._handle, session, resource, opts);\n\t\treturn toDisposable(() => {\n\t\t\tthis._proxy.$unwatch(this._handle, session);\n\t\t});\n\t}\n\n\t$onFileSystemChange(changes: IFileChangeDto[]): void {\n\t\tthis._onDidChange.fire(changes.map(RemoteFileSystemProvider._createFileChange));\n\t}\n\n\tprivate static _createFileChange(dto: IFileChangeDto): IFileChange {\n\t\treturn { resource: URI.revive(dto.resource), type: dto.type };\n\t}\n\n\t// --- forwarding calls\n\n\tasync stat(resource: URI): Promise<IStat> {\n\t\ttry {\n\t\t\treturn await this._proxy.$stat(this._handle, resource);\n\t\t} catch (err) {\n\t\t\tthrow err;\n\t\t}\n\t}\n\n\tasync readFile(resource: URI): Promise<Uint8Array> {\n\t\tconst buffer = await this._proxy.$readFile(this._handle, resource);\n\t\treturn buffer.buffer;\n\t}\n\n\twriteFile(resource: URI, content: Uint8Array, opts: IFileWriteOptions): Promise<void> {\n\t\treturn this._proxy.$writeFile(this._handle, resource, VSBuffer.wrap(content), opts);\n\t}\n\n\tdelete(resource: URI, opts: IFileDeleteOptions): Promise<void> {\n\t\treturn this._proxy.$delete(this._handle, resource, opts);\n\t}\n\n\tmkdir(resource: URI): Promise<void> {\n\t\treturn this._proxy.$mkdir(this._handle, resource);\n\t}\n\n\treaddir(resource: URI): Promise<[string, FileType][]> {\n\t\treturn this._proxy.$readdir(this._handle, resource);\n\t}\n\n\trename(resource: URI, target: URI, opts: IFileOverwriteOptions): Promise<void> {\n\t\treturn this._proxy.$rename(this._handle, resource, target, opts);\n\t}\n\n\tcopy(resource: URI, target: URI, opts: IFileOverwriteOptions): Promise<void> {\n\t\treturn this._proxy.$copy(this._handle, resource, target, opts);\n\t}\n\n\topen(resource: URI, opts: IFileOpenOptions): Promise<number> {\n\t\treturn this._proxy.$open(this._handle, resource, opts);\n\t}\n\n\tclose(fd: number): Promise<void> {\n\t\treturn this._proxy.$close(this._handle, fd);\n\t}\n\n\tasync read(fd: number, pos: number, data: Uint8Array, offset: number, length: number): Promise<number> {\n\t\tconst readData = await this._proxy.$read(this._handle, fd, pos, length);\n\t\tdata.set(readData.buffer, offset);\n\t\treturn readData.byteLength;\n\t}\n\n\twrite(fd: number, pos: number, data: Uint8Array, offset: number, length: number): Promise<number> {\n\t\treturn this._proxy.$write(this._handle, fd, pos, VSBuffer.wrap(data).slice(offset, offset + length));\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Emitter, Event } from '../../../base/common/event.js';\nimport { IDisposable, toDisposable, DisposableStore, DisposableMap } from '../../../base/common/lifecycle.js';\nimport { URI, UriComponents } from '../../../base/common/uri.js';\nimport { IFileWriteOptions, FileSystemProviderCapabilities, IFileChange, IFileService, IStat, IWatchOptions, FileType, IFileOverwriteOptions, IFileDeleteOptions, IFileOpenOptions, FileOperationError, FileOperationResult, FileSystemProviderErrorCode, IFileSystemProviderWithOpenReadWriteCloseCapability, IFileSystemProviderWithFileReadWriteCapability, IFileSystemProviderWithFileFolderCopyCapability, FilePermission, toFileSystemProviderErrorCode, IFileStatWithPartialMetadata, IFileStat } from '../../../platform/files/common/files.js';\nimport { extHostNamedCustomer, IExtHostContext } from '../../services/extensions/common/extHostCustomers.js';\nimport { ExtHostContext, ExtHostFileSystemShape, IFileChangeDto, MainContext, MainThreadFileSystemShape } from '../common/extHost.protocol.js';\nimport { VSBuffer } from '../../../base/common/buffer.js';\nimport { IMarkdownString } from '../../../base/common/htmlContent.js';\n\n@extHostNamedCustomer(MainContext.MainThreadFileSystem)\nexport class MainThreadFileSystem implements MainThreadFileSystemShape {\n\n\tprivate readonly _proxy: ExtHostFileSystemShape;\n\tprivate readonly _fileProvider = new DisposableMap<number, RemoteFileSystemProvider>();\n\tprivate readonly _disposables = new DisposableStore();\n\n\tconstructor(\n\t\textHostContext: IExtHostContext,\n\t\t@IFileService private readonly _fileService: IFileService\n\t) {\n\t\tthis._proxy = extHostContext.getProxy(ExtHostContext.ExtHostFileSystem);\n\n\t\tconst infoProxy = extHostContext.getProxy(ExtHostContext.ExtHostFileSystemInfo);\n\n\t\tfor (const entry of _fileService.listCapabilities()) {\n\t\t\tinfoProxy.$acceptProviderInfos(URI.from({ scheme: entry.scheme, path: '/dummy' }), entry.capabilities);\n\t\t}\n\t\tthis._disposables.add(_fileService.onDidChangeFileSystemProviderRegistrations(e => infoProxy.$acceptProviderInfos(URI.from({ scheme: e.scheme, path: '/dummy' }), e.provider?.capabilities ?? null)));\n\t\tthis._disposables.add(_fileService.onDidChangeFileSystemProviderCapabilities(e => infoProxy.$acceptProviderInfos(URI.from({ scheme: e.scheme, path: '/dummy' }), e.provider.capabilities)));\n\t}\n\n\tdispose(): void {\n\t\tthis._disposables.dispose();\n\t\tthis._fileProvider.dispose();\n\t}\n\n\tasync $registerFileSystemProvider(handle: number, scheme: string, capabilities: FileSystemProviderCapabilities, readonlyMessage?: IMarkdownString): Promise<void> {\n\t\tthis._fileProvider.set(handle, new RemoteFileSystemProvider(this._fileService, scheme, capabilities, readonlyMessage, handle, this._proxy));\n\t}\n\n\t$unregisterProvider(handle: number): void {\n\t\tthis._fileProvider.deleteAndDispose(handle);\n\t}\n\n\t$onFileSystemChange(handle: number, changes: IFileChangeDto[]): void {\n\t\tconst fileProvider = this._fileProvider.get(handle);\n\t\tif (!fileProvider) {\n\t\t\tthrow new Error('Unknown file provider');\n\t\t}\n\t\tfileProvider.$onFileSystemChange(changes);\n\t}\n\n\n\t// --- consumer fs, vscode.workspace.fs\n\n\tasync $stat(uri: UriComponents): Promise<IStat> {\n\t\ttry {\n\t\t\tconst stat = await this._fileService.stat(URI.revive(uri));\n\t\t\treturn {\n\t\t\t\tctime: stat.ctime,\n\t\t\t\tmtime: stat.mtime,\n\t\t\t\tsize: stat.size,\n\t\t\t\tpermissions: stat.readonly ? FilePermission.Readonly : undefined,\n\t\t\t\ttype: MainThreadFileSystem._asFileType(stat)\n\t\t\t};\n\t\t} catch (err) {\n\t\t\treturn MainThreadFileSystem._handleError(err);\n\t\t}\n\t}\n\n\tasync $readdir(uri: UriComponents): Promise<[string, FileType][]> {\n\t\ttry {\n\t\t\tconst stat = await this._fileService.resolve(URI.revive(uri), { resolveMetadata: false });\n\t\t\tif (!stat.isDirectory) {\n\t\t\t\tconst err = new Error(stat.name);\n\t\t\t\terr.name = FileSystemProviderErrorCode.FileNotADirectory;\n\t\t\t\tthrow err;\n\t\t\t}\n\t\t\treturn !stat.children ? [] : stat.children.map(child => [child.name, MainThreadFileSystem._asFileType(child)] as [string, FileType]);\n\t\t} catch (err) {\n\t\t\treturn MainThreadFileSystem._handleError(err);\n\t\t}\n\t}\n\n\tprivate static _asFileType(stat: IFileStat | IFileStatWithPartialMetadata): FileType {\n\t\tlet res = 0;\n\t\tif (stat.isFile) {\n\t\t\tres += FileType.File;\n\n\t\t} else if (stat.isDirectory) {\n\t\t\tres += FileType.Directory;\n\t\t}\n\t\tif (stat.isSymbolicLink) {\n\t\t\tres += FileType.SymbolicLink;\n\t\t}\n\t\treturn res;\n\t}\n\n\tasync $readFile(uri: UriComponents): Promise<VSBuffer> {\n\t\ttry {\n\t\t\tconst file = await this._fileService.readFile(URI.revive(uri));\n\t\t\treturn file.value;\n\t\t} catch (err) {\n\t\t\treturn MainThreadFileSystem._handleError(err);\n\t\t}\n\t}\n\n\tasync $writeFile(uri: UriComponents, content: VSBuffer): Promise<void> {\n\t\ttry {\n\t\t\tawait this._fileService.writeFile(URI.revive(uri), content);\n\t\t} catch (err) {\n\t\t\treturn MainThreadFileSystem._handleError(err);\n\t\t}\n\t}\n\n\tasync $rename(source: UriComponents, target: UriComponents, opts: IFileOverwriteOptions): Promise<void> {\n\t\ttry {\n\t\t\tawait this._fileService.move(URI.revive(source), URI.revive(target), opts.overwrite);\n\t\t} catch (err) {\n\t\t\treturn MainThreadFileSystem._handleError(err);\n\t\t}\n\t}\n\n\tasync $copy(source: UriComponents, target: UriComponents, opts: IFileOverwriteOptions): Promise<void> {\n\t\ttry {\n\t\t\tawait this._fileService.copy(URI.revive(source), URI.revive(target), opts.overwrite);\n\t\t} catch (err) {\n\t\t\treturn MainThreadFileSystem._handleError(err);\n\t\t}\n\t}\n\n\tasync $mkdir(uri: UriComponents): Promise<void> {\n\t\ttry {\n\t\t\tawait this._fileService.createFolder(URI.revive(uri));\n\t\t} catch (err) {\n\t\t\treturn MainThreadFileSystem._handleError(err);\n\t\t}\n\t}\n\n\tasync $delete(uri: UriComponents, opts: IFileDeleteOptions): Promise<void> {\n\t\ttry {\n\t\t\treturn await this._fileService.del(URI.revive(uri), opts);\n\t\t} catch (err) {\n\t\t\treturn MainThreadFileSystem._handleError(err);\n\t\t}\n\t}\n\n\tprivate static _handleError(err: unknown): never {\n\t\tif (err instanceof FileOperationError) {\n\t\t\tswitch (err.fileOperationResult) {\n\t\t\t\tcase FileOperationResult.FILE_NOT_FOUND:\n\t\t\t\t\terr.name = FileSystemProviderErrorCode.FileNotFound;\n\t\t\t\t\tbreak;\n\t\t\t\tcase FileOperationResult.FILE_IS_DIRECTORY:\n\t\t\t\t\terr.name = FileSystemProviderErrorCode.FileIsADirectory;\n\t\t\t\t\tbreak;\n\t\t\t\tcase FileOperationResult.FILE_PERMISSION_DENIED:\n\t\t\t\t\terr.name = FileSystemProviderErrorCode.NoPermissions;\n\t\t\t\t\tbreak;\n\t\t\t\tcase FileOperationResult.FILE_MOVE_CONFLICT:\n\t\t\t\t\terr.name = FileSystemProviderErrorCode.FileExists;\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t} else if (err instanceof Error) {\n\t\t\tconst code = toFileSystemProviderErrorCode(err);\n\t\t\tif (code !== FileSystemProviderErrorCode.Unknown) {\n\t\t\t\terr.name = code;\n\t\t\t}\n\t\t}\n\n\t\tthrow err;\n\t}\n\n\t$ensureActivation(scheme: string): Promise<void> {\n\t\treturn this._fileService.activateProvider(scheme);\n\t}\n}\n\nclass RemoteFileSystemProvider implements IFileSystemProviderWithFileReadWriteCapability, IFileSystemProviderWithOpenReadWriteCloseCapability, IFileSystemProviderWithFileFolderCopyCapability {\n\n\tprivate readonly _onDidChange = new Emitter<readonly IFileChange[]>();\n\tprivate readonly _registration: IDisposable;\n\n\treadonly onDidChangeFile: Event<readonly IFileChange[]> = this._onDidChange.event;\n\n\treadonly capabilities: FileSystemProviderCapabilities;\n\treadonly onDidChangeCapabilities: Event<void> = Event.None;\n\n\tconstructor(\n\t\tfileService: IFileService,\n\t\tscheme: string,\n\t\tcapabilities: FileSystemProviderCapabilities,\n\t\tpublic readonly readOnlyMessage: IMarkdownString | undefined,\n\t\tprivate readonly _handle: number,\n\t\tprivate readonly _proxy: ExtHostFileSystemShape\n\t) {\n\t\tthis.capabilities = capabilities;\n\t\tthis._registration = fileService.registerProvider(scheme, this);\n\t}\n\n\tdispose(): void {\n\t\tthis._registration.dispose();\n\t\tthis._onDidChange.dispose();\n\t}\n\n\twatch(resource: URI, opts: IWatchOptions) {\n\t\tconst session = Math.random();\n\t\tthis._proxy.$watch(this._handle, session, resource, opts);\n\t\treturn toDisposable(() => {\n\t\t\tthis._proxy.$unwatch(this._handle, session);\n\t\t});\n\t}\n\n\t$onFileSystemChange(changes: IFileChangeDto[]): void {\n\t\tthis._onDidChange.fire(changes.map(RemoteFileSystemProvider._createFileChange));\n\t}\n\n\tprivate static _createFileChange(dto: IFileChangeDto): IFileChange {\n\t\treturn { resource: URI.revive(dto.resource), type: dto.type };\n\t}\n\n\t// --- forwarding calls\n\n\tasync stat(resource: URI): Promise<IStat> {\n\t\ttry {\n\t\t\treturn await this._proxy.$stat(this._handle, resource);\n\t\t} catch (err) {\n\t\t\tthrow err;\n\t\t}\n\t}\n\n\tasync readFile(resource: URI): Promise<Uint8Array> {\n\t\tconst buffer = await this._proxy.$readFile(this._handle, resource);\n\t\treturn buffer.buffer;\n\t}\n\n\twriteFile(resource: URI, content: Uint8Array, opts: IFileWriteOptions): Promise<void> {\n\t\treturn this._proxy.$writeFile(this._handle, resource, VSBuffer.wrap(content), opts);\n\t}\n\n\tdelete(resource: URI, opts: IFileDeleteOptions): Promise<void> {\n\t\treturn this._proxy.$delete(this._handle, resource, opts);\n\t}\n\n\tmkdir(resource: URI): Promise<void> {\n\t\treturn this._proxy.$mkdir(this._handle, resource);\n\t}\n\n\treaddir(resource: URI): Promise<[string, FileType][]> {\n\t\treturn this._proxy.$readdir(this._handle, resource);\n\t}\n\n\trename(resource: URI, target: URI, opts: IFileOverwriteOptions): Promise<void> {\n\t\treturn this._proxy.$rename(this._handle, resource, target, opts);\n\t}\n\n\tcopy(resource: URI, target: URI, opts: IFileOverwriteOptions): Promise<void> {\n\t\treturn this._proxy.$copy(this._handle, resource, target, opts);\n\t}\n\n\topen(resource: URI, opts: IFileOpenOptions): Promise<number> {\n\t\treturn this._proxy.$open(this._handle, resource, opts);\n\t}\n\n\tclose(fd: number): Promise<void> {\n\t\treturn this._proxy.$close(this._handle, fd);\n\t}\n\n\tasync read(fd: number, pos: number, data: Uint8Array, offset: number, length: number): Promise<number> {\n\t\tconst readData = await this._proxy.$read(this._handle, fd, pos, length);\n\t\tdata.set(readData.buffer, offset);\n\t\treturn readData.byteLength;\n\t}\n\n\twrite(fd: number, pos: number, data: Uint8Array, offset: number, length: number): Promise<number> {\n\t\treturn this._proxy.$write(this._handle, fd, pos, VSBuffer.wrap(data).slice(offset, offset + length));\n\t}\n}\n"]}