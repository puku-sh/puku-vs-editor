{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/api/browser/mainThreadChatCodeMapper.ts","vs/workbench/api/browser/mainThreadChatCodeMapper.ts"],"names":[],"mappings":"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","file":"mainThreadChatCodeMapper.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nimport { CancellationToken } from '../../../base/common/cancellation.js';\nimport { Disposable, DisposableMap, IDisposable } from '../../../base/common/lifecycle.js';\nimport { URI } from '../../../base/common/uri.js';\nimport { TextEdit } from '../../../editor/common/languages.js';\nimport { ICodeMapperProvider, ICodeMapperRequest, ICodeMapperResponse, ICodeMapperService } from '../../contrib/chat/common/chatCodeMapperService.js';\nimport { extHostNamedCustomer, IExtHostContext } from '../../services/extensions/common/extHostCustomers.js';\nimport { ExtHostCodeMapperShape, ExtHostContext, ICodeMapperProgressDto, ICodeMapperRequestDto, MainContext, MainThreadCodeMapperShape } from '../common/extHost.protocol.js';\nimport { NotebookDto } from './mainThreadNotebookDto.js';\n\n@extHostNamedCustomer(MainContext.MainThreadCodeMapper)\nexport class MainThreadChatCodemapper extends Disposable implements MainThreadCodeMapperShape {\n\n\tprivate providers = this._register(new DisposableMap<number, IDisposable>());\n\tprivate readonly _proxy: ExtHostCodeMapperShape;\n\tprivate static _requestHandlePool: number = 0;\n\tprivate _responseMap = new Map<string, ICodeMapperResponse>();\n\n\tconstructor(\n\t\textHostContext: IExtHostContext,\n\t\t@ICodeMapperService private readonly codeMapperService: ICodeMapperService\n\t) {\n\t\tsuper();\n\t\tthis._proxy = extHostContext.getProxy(ExtHostContext.ExtHostCodeMapper);\n\t}\n\n\t$registerCodeMapperProvider(handle: number, displayName: string): void {\n\t\tconst impl: ICodeMapperProvider = {\n\t\t\tdisplayName,\n\t\t\tmapCode: async (uiRequest: ICodeMapperRequest, response: ICodeMapperResponse, token: CancellationToken) => {\n\t\t\t\tconst requestId = String(MainThreadChatCodemapper._requestHandlePool++);\n\t\t\t\tthis._responseMap.set(requestId, response);\n\t\t\t\tconst extHostRequest: ICodeMapperRequestDto = {\n\t\t\t\t\trequestId,\n\t\t\t\t\tcodeBlocks: uiRequest.codeBlocks,\n\t\t\t\t\tchatRequestId: uiRequest.chatRequestId,\n\t\t\t\t\tchatRequestModel: uiRequest.chatRequestModel,\n\t\t\t\t\tchatSessionId: uiRequest.chatSessionId,\n\t\t\t\t\tlocation: uiRequest.location\n\t\t\t\t};\n\t\t\t\ttry {\n\t\t\t\t\treturn await this._proxy.$mapCode(handle, extHostRequest, token).then((result) => result ?? undefined);\n\t\t\t\t} finally {\n\t\t\t\t\tthis._responseMap.delete(requestId);\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\tconst disposable = this.codeMapperService.registerCodeMapperProvider(handle, impl);\n\t\tthis.providers.set(handle, disposable);\n\t}\n\n\t$unregisterCodeMapperProvider(handle: number): void {\n\t\tthis.providers.deleteAndDispose(handle);\n\t}\n\n\t$handleProgress(requestId: string, data: ICodeMapperProgressDto): Promise<void> {\n\t\tconst response = this._responseMap.get(requestId);\n\t\tif (response) {\n\t\t\tconst edits = data.edits;\n\t\t\tconst resource = URI.revive(data.uri);\n\t\t\tif (!edits.length) {\n\t\t\t\tresponse.textEdit(resource, []);\n\t\t\t} else if (edits.every(TextEdit.isTextEdit)) {\n\t\t\t\tresponse.textEdit(resource, edits);\n\t\t\t} else {\n\t\t\t\tresponse.notebookEdit(resource, edits.map(NotebookDto.fromCellEditOperationDto));\n\t\t\t}\n\t\t}\n\t\treturn Promise.resolve();\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nimport { CancellationToken } from '../../../base/common/cancellation.js';\nimport { Disposable, DisposableMap, IDisposable } from '../../../base/common/lifecycle.js';\nimport { URI } from '../../../base/common/uri.js';\nimport { TextEdit } from '../../../editor/common/languages.js';\nimport { ICodeMapperProvider, ICodeMapperRequest, ICodeMapperResponse, ICodeMapperService } from '../../contrib/chat/common/chatCodeMapperService.js';\nimport { extHostNamedCustomer, IExtHostContext } from '../../services/extensions/common/extHostCustomers.js';\nimport { ExtHostCodeMapperShape, ExtHostContext, ICodeMapperProgressDto, ICodeMapperRequestDto, MainContext, MainThreadCodeMapperShape } from '../common/extHost.protocol.js';\nimport { NotebookDto } from './mainThreadNotebookDto.js';\n\n@extHostNamedCustomer(MainContext.MainThreadCodeMapper)\nexport class MainThreadChatCodemapper extends Disposable implements MainThreadCodeMapperShape {\n\n\tprivate providers = this._register(new DisposableMap<number, IDisposable>());\n\tprivate readonly _proxy: ExtHostCodeMapperShape;\n\tprivate static _requestHandlePool: number = 0;\n\tprivate _responseMap = new Map<string, ICodeMapperResponse>();\n\n\tconstructor(\n\t\textHostContext: IExtHostContext,\n\t\t@ICodeMapperService private readonly codeMapperService: ICodeMapperService\n\t) {\n\t\tsuper();\n\t\tthis._proxy = extHostContext.getProxy(ExtHostContext.ExtHostCodeMapper);\n\t}\n\n\t$registerCodeMapperProvider(handle: number, displayName: string): void {\n\t\tconst impl: ICodeMapperProvider = {\n\t\t\tdisplayName,\n\t\t\tmapCode: async (uiRequest: ICodeMapperRequest, response: ICodeMapperResponse, token: CancellationToken) => {\n\t\t\t\tconst requestId = String(MainThreadChatCodemapper._requestHandlePool++);\n\t\t\t\tthis._responseMap.set(requestId, response);\n\t\t\t\tconst extHostRequest: ICodeMapperRequestDto = {\n\t\t\t\t\trequestId,\n\t\t\t\t\tcodeBlocks: uiRequest.codeBlocks,\n\t\t\t\t\tchatRequestId: uiRequest.chatRequestId,\n\t\t\t\t\tchatRequestModel: uiRequest.chatRequestModel,\n\t\t\t\t\tchatSessionId: uiRequest.chatSessionId,\n\t\t\t\t\tlocation: uiRequest.location\n\t\t\t\t};\n\t\t\t\ttry {\n\t\t\t\t\treturn await this._proxy.$mapCode(handle, extHostRequest, token).then((result) => result ?? undefined);\n\t\t\t\t} finally {\n\t\t\t\t\tthis._responseMap.delete(requestId);\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\tconst disposable = this.codeMapperService.registerCodeMapperProvider(handle, impl);\n\t\tthis.providers.set(handle, disposable);\n\t}\n\n\t$unregisterCodeMapperProvider(handle: number): void {\n\t\tthis.providers.deleteAndDispose(handle);\n\t}\n\n\t$handleProgress(requestId: string, data: ICodeMapperProgressDto): Promise<void> {\n\t\tconst response = this._responseMap.get(requestId);\n\t\tif (response) {\n\t\t\tconst edits = data.edits;\n\t\t\tconst resource = URI.revive(data.uri);\n\t\t\tif (!edits.length) {\n\t\t\t\tresponse.textEdit(resource, []);\n\t\t\t} else if (edits.every(TextEdit.isTextEdit)) {\n\t\t\t\tresponse.textEdit(resource, edits);\n\t\t\t} else {\n\t\t\t\tresponse.notebookEdit(resource, edits.map(NotebookDto.fromCellEditOperationDto));\n\t\t\t}\n\t\t}\n\t\treturn Promise.resolve();\n\t}\n}\n"]}