{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/api/browser/mainThreadTesting.ts","vs/workbench/api/browser/mainThreadTesting.ts"],"names":[],"mappings":"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","file":"mainThreadTesting.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { VSBuffer } from '../../../base/common/buffer.js';\nimport { CancellationToken } from '../../../base/common/cancellation.js';\nimport { Event } from '../../../base/common/event.js';\nimport { Disposable, DisposableStore, IDisposable, MutableDisposable, toDisposable } from '../../../base/common/lifecycle.js';\nimport { ISettableObservable, observableValue, transaction } from '../../../base/common/observable.js';\nimport { WellDefinedPrefixTree } from '../../../base/common/prefixTree.js';\nimport { URI, UriComponents } from '../../../base/common/uri.js';\nimport { Range } from '../../../editor/common/core/range.js';\nimport { IUriIdentityService } from '../../../platform/uriIdentity/common/uriIdentity.js';\nimport { TestCoverage } from '../../contrib/testing/common/testCoverage.js';\nimport { TestId } from '../../contrib/testing/common/testId.js';\nimport { ITestProfileService } from '../../contrib/testing/common/testProfileService.js';\nimport { LiveTestResult } from '../../contrib/testing/common/testResult.js';\nimport { ITestResultService } from '../../contrib/testing/common/testResultService.js';\nimport { IMainThreadTestController, ITestService } from '../../contrib/testing/common/testService.js';\nimport { CoverageDetails, ExtensionRunTestsRequest, IFileCoverage, ITestItem, ITestMessage, ITestRunProfile, ITestRunTask, ResolvedTestRunRequest, TestControllerCapability, TestResultState, TestRunProfileBitset, TestsDiffOp } from '../../contrib/testing/common/testTypes.js';\nimport { IExtHostContext, extHostNamedCustomer } from '../../services/extensions/common/extHostCustomers.js';\nimport { ExtHostContext, ExtHostTestingShape, ILocationDto, ITestControllerPatch, MainContext, MainThreadTestingShape } from '../common/extHost.protocol.js';\n\n@extHostNamedCustomer(MainContext.MainThreadTesting)\nexport class MainThreadTesting extends Disposable implements MainThreadTestingShape {\n\tprivate readonly proxy: ExtHostTestingShape;\n\tprivate readonly diffListener = this._register(new MutableDisposable());\n\tprivate readonly testProviderRegistrations = new Map<string, {\n\t\tinstance: IMainThreadTestController;\n\t\tlabel: ISettableObservable<string>;\n\t\tcapabilities: ISettableObservable<TestControllerCapability>;\n\t\tdisposable: IDisposable;\n\t}>();\n\n\tconstructor(\n\t\textHostContext: IExtHostContext,\n\t\t@IUriIdentityService private readonly uriIdentityService: IUriIdentityService,\n\t\t@ITestService private readonly testService: ITestService,\n\t\t@ITestProfileService private readonly testProfiles: ITestProfileService,\n\t\t@ITestResultService private readonly resultService: ITestResultService,\n\t) {\n\t\tsuper();\n\t\tthis.proxy = extHostContext.getProxy(ExtHostContext.ExtHostTesting);\n\n\t\tthis._register(this.testService.registerExtHost({\n\t\t\tprovideTestFollowups: (req, token) => this.proxy.$provideTestFollowups(req, token),\n\t\t\texecuteTestFollowup: id => this.proxy.$executeTestFollowup(id),\n\t\t\tdisposeTestFollowups: ids => this.proxy.$disposeTestFollowups(ids),\n\t\t\tgetTestsRelatedToCode: (uri, position, token) => this.proxy.$getTestsRelatedToCode(uri, position, token),\n\t\t}));\n\n\t\tthis._register(this.testService.onDidCancelTestRun(({ runId, taskId }) => {\n\t\t\tthis.proxy.$cancelExtensionTestRun(runId, taskId);\n\t\t}));\n\n\t\tthis._register(Event.debounce(testProfiles.onDidChange, (_last, e) => e)(() => {\n\t\t\tconst obj: Record</* controller id */string, /* profile id */ number[]> = {};\n\t\t\tfor (const group of [TestRunProfileBitset.Run, TestRunProfileBitset.Debug, TestRunProfileBitset.Coverage]) {\n\t\t\t\tfor (const profile of this.testProfiles.getGroupDefaultProfiles(group)) {\n\t\t\t\t\tobj[profile.controllerId] ??= [];\n\t\t\t\t\tobj[profile.controllerId].push(profile.profileId);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis.proxy.$setDefaultRunProfiles(obj);\n\t\t}));\n\n\t\tthis._register(resultService.onResultsChanged(evt => {\n\t\t\tif ('completed' in evt) {\n\t\t\t\tconst serialized = evt.completed.toJSONWithMessages();\n\t\t\t\tif (serialized) {\n\t\t\t\t\tthis.proxy.$publishTestResults([serialized]);\n\t\t\t\t}\n\t\t\t} else if ('removed' in evt) {\n\t\t\t\tevt.removed.forEach(r => {\n\t\t\t\t\tif (r instanceof LiveTestResult) {\n\t\t\t\t\t\tthis.proxy.$disposeRun(r.id);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}));\n\t}\n\n\t/**\n\t * @inheritdoc\n\t */\n\t$markTestRetired(testIds: string[] | undefined): void {\n\t\tlet tree: WellDefinedPrefixTree<undefined> | undefined;\n\t\tif (testIds) {\n\t\t\ttree = new WellDefinedPrefixTree();\n\t\t\tfor (const id of testIds) {\n\t\t\t\ttree.insert(TestId.fromString(id).path, undefined);\n\t\t\t}\n\t\t}\n\n\t\tfor (const result of this.resultService.results) {\n\t\t\t// all non-live results are already entirely outdated\n\t\t\tif (result instanceof LiveTestResult) {\n\t\t\t\tresult.markRetired(tree);\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * @inheritdoc\n\t */\n\t$publishTestRunProfile(profile: ITestRunProfile): void {\n\t\tconst controller = this.testProviderRegistrations.get(profile.controllerId);\n\t\tif (controller) {\n\t\t\tthis.testProfiles.addProfile(controller.instance, profile);\n\t\t}\n\t}\n\n\t/**\n\t * @inheritdoc\n\t */\n\t$updateTestRunConfig(controllerId: string, profileId: number, update: Partial<ITestRunProfile>): void {\n\t\tthis.testProfiles.updateProfile(controllerId, profileId, update);\n\t}\n\n\t/**\n\t * @inheritdoc\n\t */\n\t$removeTestProfile(controllerId: string, profileId: number): void {\n\t\tthis.testProfiles.removeProfile(controllerId, profileId);\n\t}\n\n\t/**\n\t * @inheritdoc\n\t */\n\t$addTestsToRun(controllerId: string, runId: string, tests: ITestItem.Serialized[]): void {\n\t\tthis.withLiveRun(runId, r => r.addTestChainToRun(controllerId,\n\t\t\ttests.map(t => ITestItem.deserialize(this.uriIdentityService, t))));\n\t}\n\n\t/**\n\t * @inheritdoc\n\t */\n\t$appendCoverage(runId: string, taskId: string, coverage: IFileCoverage.Serialized): void {\n\t\tthis.withLiveRun(runId, run => {\n\t\t\tconst task = run.tasks.find(t => t.id === taskId);\n\t\t\tif (!task) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst deserialized = IFileCoverage.deserialize(this.uriIdentityService, coverage);\n\n\t\t\ttransaction(tx => {\n\t\t\t\tlet value = task.coverage.read(undefined);\n\t\t\t\tif (!value) {\n\t\t\t\t\tvalue = new TestCoverage(run, taskId, this.uriIdentityService, {\n\t\t\t\t\t\tgetCoverageDetails: (id, testId, token) => this.proxy.$getCoverageDetails(id, testId, token)\n\t\t\t\t\t\t\t.then(r => r.map(CoverageDetails.deserialize)),\n\t\t\t\t\t});\n\t\t\t\t\tvalue.append(deserialized, tx);\n\t\t\t\t\t(task.coverage as ISettableObservable<TestCoverage>).set(value, tx);\n\t\t\t\t} else {\n\t\t\t\t\tvalue.append(deserialized, tx);\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t}\n\n\t/**\n\t * @inheritdoc\n\t */\n\t$startedExtensionTestRun(req: ExtensionRunTestsRequest): void {\n\t\tthis.resultService.createLiveResult(req);\n\t}\n\n\t/**\n\t * @inheritdoc\n\t */\n\t$startedTestRunTask(runId: string, task: ITestRunTask): void {\n\t\tthis.withLiveRun(runId, r => r.addTask(task));\n\t}\n\n\t/**\n\t * @inheritdoc\n\t */\n\t$finishedTestRunTask(runId: string, taskId: string): void {\n\t\tthis.withLiveRun(runId, r => r.markTaskComplete(taskId));\n\t}\n\n\t/**\n\t * @inheritdoc\n\t */\n\t$finishedExtensionTestRun(runId: string): void {\n\t\tthis.withLiveRun(runId, r => r.markComplete());\n\t}\n\n\t/**\n\t * @inheritdoc\n\t */\n\tpublic $updateTestStateInRun(runId: string, taskId: string, testId: string, state: TestResultState, duration?: number): void {\n\t\tthis.withLiveRun(runId, r => r.updateState(testId, taskId, state, duration));\n\t}\n\n\t/**\n\t * @inheritdoc\n\t */\n\tpublic $appendOutputToRun(runId: string, taskId: string, output: VSBuffer, locationDto?: ILocationDto, testId?: string): void {\n\t\tconst location = locationDto && {\n\t\t\turi: URI.revive(locationDto.uri),\n\t\t\trange: Range.lift(locationDto.range)\n\t\t};\n\n\t\tthis.withLiveRun(runId, r => r.appendOutput(output, taskId, location, testId));\n\t}\n\n\n\t/**\n\t * @inheritdoc\n\t */\n\tpublic $appendTestMessagesInRun(runId: string, taskId: string, testId: string, messages: ITestMessage.Serialized[]): void {\n\t\tconst r = this.resultService.getResult(runId);\n\t\tif (r && r instanceof LiveTestResult) {\n\t\t\tfor (const message of messages) {\n\t\t\t\tr.appendMessage(testId, taskId, ITestMessage.deserialize(this.uriIdentityService, message));\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * @inheritdoc\n\t */\n\tpublic $registerTestController(controllerId: string, _label: string, _capabilities: TestControllerCapability) {\n\t\tconst disposable = new DisposableStore();\n\t\tconst label = observableValue(`${controllerId}.label`, _label);\n\t\tconst capabilities = observableValue(`${controllerId}.cap`, _capabilities);\n\t\tconst controller: IMainThreadTestController = {\n\t\t\tid: controllerId,\n\t\t\tlabel,\n\t\t\tcapabilities,\n\t\t\tsyncTests: () => this.proxy.$syncTests(),\n\t\t\trefreshTests: token => this.proxy.$refreshTests(controllerId, token),\n\t\t\tconfigureRunProfile: id => this.proxy.$configureRunProfile(controllerId, id),\n\t\t\trunTests: (reqs, token) => this.proxy.$runControllerTests(reqs, token),\n\t\t\tstartContinuousRun: (reqs, token) => this.proxy.$startContinuousRun(reqs, token),\n\t\t\texpandTest: (testId, levels) => this.proxy.$expandTest(testId, isFinite(levels) ? levels : -1),\n\t\t\tgetRelatedCode: (testId, token) => this.proxy.$getCodeRelatedToTest(testId, token).then(locations =>\n\t\t\t\tlocations.map(l => ({\n\t\t\t\t\turi: URI.revive(l.uri),\n\t\t\t\t\trange: Range.lift(l.range)\n\t\t\t\t})),\n\t\t\t),\n\t\t};\n\n\t\tdisposable.add(toDisposable(() => this.testProfiles.removeProfile(controllerId)));\n\t\tdisposable.add(this.testService.registerTestController(controllerId, controller));\n\n\t\tthis.testProviderRegistrations.set(controllerId, {\n\t\t\tinstance: controller,\n\t\t\tlabel,\n\t\t\tcapabilities,\n\t\t\tdisposable\n\t\t});\n\t}\n\n\t/**\n\t * @inheritdoc\n\t */\n\tpublic $updateController(controllerId: string, patch: ITestControllerPatch) {\n\t\tconst controller = this.testProviderRegistrations.get(controllerId);\n\t\tif (!controller) {\n\t\t\treturn;\n\t\t}\n\n\t\ttransaction(tx => {\n\t\t\tif (patch.label !== undefined) {\n\t\t\t\tcontroller.label.set(patch.label, tx);\n\t\t\t}\n\n\t\t\tif (patch.capabilities !== undefined) {\n\t\t\t\tcontroller.capabilities.set(patch.capabilities, tx);\n\t\t\t}\n\t\t});\n\n\t}\n\n\t/**\n\t * @inheritdoc\n\t */\n\tpublic $unregisterTestController(controllerId: string) {\n\t\tthis.testProviderRegistrations.get(controllerId)?.disposable.dispose();\n\t\tthis.testProviderRegistrations.delete(controllerId);\n\t}\n\n\t/**\n\t * @inheritdoc\n\t */\n\tpublic $subscribeToDiffs(): void {\n\t\tthis.proxy.$acceptDiff(this.testService.collection.getReviverDiff().map(TestsDiffOp.serialize));\n\t\tthis.diffListener.value = this.testService.onDidProcessDiff(this.proxy.$acceptDiff, this.proxy);\n\t}\n\n\t/**\n\t * @inheritdoc\n\t */\n\tpublic $unsubscribeFromDiffs(): void {\n\t\tthis.diffListener.clear();\n\t}\n\n\t/**\n\t * @inheritdoc\n\t */\n\tpublic $publishDiff(controllerId: string, diff: TestsDiffOp.Serialized[]): void {\n\t\tthis.testService.publishDiff(controllerId,\n\t\t\tdiff.map(d => TestsDiffOp.deserialize(this.uriIdentityService, d)));\n\t}\n\n\t/**\n\t * @inheritdoc\n\t */\n\tpublic async $runTests(req: ResolvedTestRunRequest, token: CancellationToken): Promise<string> {\n\t\tconst result = await this.testService.runResolvedTests(req, token);\n\t\treturn result.id;\n\t}\n\n\t/**\n\t * @inheritdoc\n\t */\n\tpublic async $getCoverageDetails(resultId: string, taskIndex: number, uri: UriComponents, token: CancellationToken): Promise<CoverageDetails.Serialized[]> {\n\t\tconst details = await this.resultService.getResult(resultId)\n\t\t\t?.tasks[taskIndex]\n\t\t\t?.coverage.get()\n\t\t\t?.getUri(URI.from(uri))\n\t\t\t?.details(token);\n\n\t\t// Return empty if nothing. Some failure is always possible here because\n\t\t// results might be cleared in the meantime.\n\t\treturn details || [];\n\t}\n\n\tpublic override dispose() {\n\t\tsuper.dispose();\n\t\tfor (const subscription of this.testProviderRegistrations.values()) {\n\t\t\tsubscription.disposable.dispose();\n\t\t}\n\t\tthis.testProviderRegistrations.clear();\n\t}\n\n\tprivate withLiveRun<T>(runId: string, fn: (run: LiveTestResult) => T): T | undefined {\n\t\tconst r = this.resultService.getResult(runId);\n\t\treturn r && r instanceof LiveTestResult ? fn(r) : undefined;\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { VSBuffer } from '../../../base/common/buffer.js';\nimport { CancellationToken } from '../../../base/common/cancellation.js';\nimport { Event } from '../../../base/common/event.js';\nimport { Disposable, DisposableStore, IDisposable, MutableDisposable, toDisposable } from '../../../base/common/lifecycle.js';\nimport { ISettableObservable, observableValue, transaction } from '../../../base/common/observable.js';\nimport { WellDefinedPrefixTree } from '../../../base/common/prefixTree.js';\nimport { URI, UriComponents } from '../../../base/common/uri.js';\nimport { Range } from '../../../editor/common/core/range.js';\nimport { IUriIdentityService } from '../../../platform/uriIdentity/common/uriIdentity.js';\nimport { TestCoverage } from '../../contrib/testing/common/testCoverage.js';\nimport { TestId } from '../../contrib/testing/common/testId.js';\nimport { ITestProfileService } from '../../contrib/testing/common/testProfileService.js';\nimport { LiveTestResult } from '../../contrib/testing/common/testResult.js';\nimport { ITestResultService } from '../../contrib/testing/common/testResultService.js';\nimport { IMainThreadTestController, ITestService } from '../../contrib/testing/common/testService.js';\nimport { CoverageDetails, ExtensionRunTestsRequest, IFileCoverage, ITestItem, ITestMessage, ITestRunProfile, ITestRunTask, ResolvedTestRunRequest, TestControllerCapability, TestResultState, TestRunProfileBitset, TestsDiffOp } from '../../contrib/testing/common/testTypes.js';\nimport { IExtHostContext, extHostNamedCustomer } from '../../services/extensions/common/extHostCustomers.js';\nimport { ExtHostContext, ExtHostTestingShape, ILocationDto, ITestControllerPatch, MainContext, MainThreadTestingShape } from '../common/extHost.protocol.js';\n\n@extHostNamedCustomer(MainContext.MainThreadTesting)\nexport class MainThreadTesting extends Disposable implements MainThreadTestingShape {\n\tprivate readonly proxy: ExtHostTestingShape;\n\tprivate readonly diffListener = this._register(new MutableDisposable());\n\tprivate readonly testProviderRegistrations = new Map<string, {\n\t\tinstance: IMainThreadTestController;\n\t\tlabel: ISettableObservable<string>;\n\t\tcapabilities: ISettableObservable<TestControllerCapability>;\n\t\tdisposable: IDisposable;\n\t}>();\n\n\tconstructor(\n\t\textHostContext: IExtHostContext,\n\t\t@IUriIdentityService private readonly uriIdentityService: IUriIdentityService,\n\t\t@ITestService private readonly testService: ITestService,\n\t\t@ITestProfileService private readonly testProfiles: ITestProfileService,\n\t\t@ITestResultService private readonly resultService: ITestResultService,\n\t) {\n\t\tsuper();\n\t\tthis.proxy = extHostContext.getProxy(ExtHostContext.ExtHostTesting);\n\n\t\tthis._register(this.testService.registerExtHost({\n\t\t\tprovideTestFollowups: (req, token) => this.proxy.$provideTestFollowups(req, token),\n\t\t\texecuteTestFollowup: id => this.proxy.$executeTestFollowup(id),\n\t\t\tdisposeTestFollowups: ids => this.proxy.$disposeTestFollowups(ids),\n\t\t\tgetTestsRelatedToCode: (uri, position, token) => this.proxy.$getTestsRelatedToCode(uri, position, token),\n\t\t}));\n\n\t\tthis._register(this.testService.onDidCancelTestRun(({ runId, taskId }) => {\n\t\t\tthis.proxy.$cancelExtensionTestRun(runId, taskId);\n\t\t}));\n\n\t\tthis._register(Event.debounce(testProfiles.onDidChange, (_last, e) => e)(() => {\n\t\t\tconst obj: Record</* controller id */string, /* profile id */ number[]> = {};\n\t\t\tfor (const group of [TestRunProfileBitset.Run, TestRunProfileBitset.Debug, TestRunProfileBitset.Coverage]) {\n\t\t\t\tfor (const profile of this.testProfiles.getGroupDefaultProfiles(group)) {\n\t\t\t\t\tobj[profile.controllerId] ??= [];\n\t\t\t\t\tobj[profile.controllerId].push(profile.profileId);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis.proxy.$setDefaultRunProfiles(obj);\n\t\t}));\n\n\t\tthis._register(resultService.onResultsChanged(evt => {\n\t\t\tif ('completed' in evt) {\n\t\t\t\tconst serialized = evt.completed.toJSONWithMessages();\n\t\t\t\tif (serialized) {\n\t\t\t\t\tthis.proxy.$publishTestResults([serialized]);\n\t\t\t\t}\n\t\t\t} else if ('removed' in evt) {\n\t\t\t\tevt.removed.forEach(r => {\n\t\t\t\t\tif (r instanceof LiveTestResult) {\n\t\t\t\t\t\tthis.proxy.$disposeRun(r.id);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}));\n\t}\n\n\t/**\n\t * @inheritdoc\n\t */\n\t$markTestRetired(testIds: string[] | undefined): void {\n\t\tlet tree: WellDefinedPrefixTree<undefined> | undefined;\n\t\tif (testIds) {\n\t\t\ttree = new WellDefinedPrefixTree();\n\t\t\tfor (const id of testIds) {\n\t\t\t\ttree.insert(TestId.fromString(id).path, undefined);\n\t\t\t}\n\t\t}\n\n\t\tfor (const result of this.resultService.results) {\n\t\t\t// all non-live results are already entirely outdated\n\t\t\tif (result instanceof LiveTestResult) {\n\t\t\t\tresult.markRetired(tree);\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * @inheritdoc\n\t */\n\t$publishTestRunProfile(profile: ITestRunProfile): void {\n\t\tconst controller = this.testProviderRegistrations.get(profile.controllerId);\n\t\tif (controller) {\n\t\t\tthis.testProfiles.addProfile(controller.instance, profile);\n\t\t}\n\t}\n\n\t/**\n\t * @inheritdoc\n\t */\n\t$updateTestRunConfig(controllerId: string, profileId: number, update: Partial<ITestRunProfile>): void {\n\t\tthis.testProfiles.updateProfile(controllerId, profileId, update);\n\t}\n\n\t/**\n\t * @inheritdoc\n\t */\n\t$removeTestProfile(controllerId: string, profileId: number): void {\n\t\tthis.testProfiles.removeProfile(controllerId, profileId);\n\t}\n\n\t/**\n\t * @inheritdoc\n\t */\n\t$addTestsToRun(controllerId: string, runId: string, tests: ITestItem.Serialized[]): void {\n\t\tthis.withLiveRun(runId, r => r.addTestChainToRun(controllerId,\n\t\t\ttests.map(t => ITestItem.deserialize(this.uriIdentityService, t))));\n\t}\n\n\t/**\n\t * @inheritdoc\n\t */\n\t$appendCoverage(runId: string, taskId: string, coverage: IFileCoverage.Serialized): void {\n\t\tthis.withLiveRun(runId, run => {\n\t\t\tconst task = run.tasks.find(t => t.id === taskId);\n\t\t\tif (!task) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst deserialized = IFileCoverage.deserialize(this.uriIdentityService, coverage);\n\n\t\t\ttransaction(tx => {\n\t\t\t\tlet value = task.coverage.read(undefined);\n\t\t\t\tif (!value) {\n\t\t\t\t\tvalue = new TestCoverage(run, taskId, this.uriIdentityService, {\n\t\t\t\t\t\tgetCoverageDetails: (id, testId, token) => this.proxy.$getCoverageDetails(id, testId, token)\n\t\t\t\t\t\t\t.then(r => r.map(CoverageDetails.deserialize)),\n\t\t\t\t\t});\n\t\t\t\t\tvalue.append(deserialized, tx);\n\t\t\t\t\t(task.coverage as ISettableObservable<TestCoverage>).set(value, tx);\n\t\t\t\t} else {\n\t\t\t\t\tvalue.append(deserialized, tx);\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t}\n\n\t/**\n\t * @inheritdoc\n\t */\n\t$startedExtensionTestRun(req: ExtensionRunTestsRequest): void {\n\t\tthis.resultService.createLiveResult(req);\n\t}\n\n\t/**\n\t * @inheritdoc\n\t */\n\t$startedTestRunTask(runId: string, task: ITestRunTask): void {\n\t\tthis.withLiveRun(runId, r => r.addTask(task));\n\t}\n\n\t/**\n\t * @inheritdoc\n\t */\n\t$finishedTestRunTask(runId: string, taskId: string): void {\n\t\tthis.withLiveRun(runId, r => r.markTaskComplete(taskId));\n\t}\n\n\t/**\n\t * @inheritdoc\n\t */\n\t$finishedExtensionTestRun(runId: string): void {\n\t\tthis.withLiveRun(runId, r => r.markComplete());\n\t}\n\n\t/**\n\t * @inheritdoc\n\t */\n\tpublic $updateTestStateInRun(runId: string, taskId: string, testId: string, state: TestResultState, duration?: number): void {\n\t\tthis.withLiveRun(runId, r => r.updateState(testId, taskId, state, duration));\n\t}\n\n\t/**\n\t * @inheritdoc\n\t */\n\tpublic $appendOutputToRun(runId: string, taskId: string, output: VSBuffer, locationDto?: ILocationDto, testId?: string): void {\n\t\tconst location = locationDto && {\n\t\t\turi: URI.revive(locationDto.uri),\n\t\t\trange: Range.lift(locationDto.range)\n\t\t};\n\n\t\tthis.withLiveRun(runId, r => r.appendOutput(output, taskId, location, testId));\n\t}\n\n\n\t/**\n\t * @inheritdoc\n\t */\n\tpublic $appendTestMessagesInRun(runId: string, taskId: string, testId: string, messages: ITestMessage.Serialized[]): void {\n\t\tconst r = this.resultService.getResult(runId);\n\t\tif (r && r instanceof LiveTestResult) {\n\t\t\tfor (const message of messages) {\n\t\t\t\tr.appendMessage(testId, taskId, ITestMessage.deserialize(this.uriIdentityService, message));\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * @inheritdoc\n\t */\n\tpublic $registerTestController(controllerId: string, _label: string, _capabilities: TestControllerCapability) {\n\t\tconst disposable = new DisposableStore();\n\t\tconst label = observableValue(`${controllerId}.label`, _label);\n\t\tconst capabilities = observableValue(`${controllerId}.cap`, _capabilities);\n\t\tconst controller: IMainThreadTestController = {\n\t\t\tid: controllerId,\n\t\t\tlabel,\n\t\t\tcapabilities,\n\t\t\tsyncTests: () => this.proxy.$syncTests(),\n\t\t\trefreshTests: token => this.proxy.$refreshTests(controllerId, token),\n\t\t\tconfigureRunProfile: id => this.proxy.$configureRunProfile(controllerId, id),\n\t\t\trunTests: (reqs, token) => this.proxy.$runControllerTests(reqs, token),\n\t\t\tstartContinuousRun: (reqs, token) => this.proxy.$startContinuousRun(reqs, token),\n\t\t\texpandTest: (testId, levels) => this.proxy.$expandTest(testId, isFinite(levels) ? levels : -1),\n\t\t\tgetRelatedCode: (testId, token) => this.proxy.$getCodeRelatedToTest(testId, token).then(locations =>\n\t\t\t\tlocations.map(l => ({\n\t\t\t\t\turi: URI.revive(l.uri),\n\t\t\t\t\trange: Range.lift(l.range)\n\t\t\t\t})),\n\t\t\t),\n\t\t};\n\n\t\tdisposable.add(toDisposable(() => this.testProfiles.removeProfile(controllerId)));\n\t\tdisposable.add(this.testService.registerTestController(controllerId, controller));\n\n\t\tthis.testProviderRegistrations.set(controllerId, {\n\t\t\tinstance: controller,\n\t\t\tlabel,\n\t\t\tcapabilities,\n\t\t\tdisposable\n\t\t});\n\t}\n\n\t/**\n\t * @inheritdoc\n\t */\n\tpublic $updateController(controllerId: string, patch: ITestControllerPatch) {\n\t\tconst controller = this.testProviderRegistrations.get(controllerId);\n\t\tif (!controller) {\n\t\t\treturn;\n\t\t}\n\n\t\ttransaction(tx => {\n\t\t\tif (patch.label !== undefined) {\n\t\t\t\tcontroller.label.set(patch.label, tx);\n\t\t\t}\n\n\t\t\tif (patch.capabilities !== undefined) {\n\t\t\t\tcontroller.capabilities.set(patch.capabilities, tx);\n\t\t\t}\n\t\t});\n\n\t}\n\n\t/**\n\t * @inheritdoc\n\t */\n\tpublic $unregisterTestController(controllerId: string) {\n\t\tthis.testProviderRegistrations.get(controllerId)?.disposable.dispose();\n\t\tthis.testProviderRegistrations.delete(controllerId);\n\t}\n\n\t/**\n\t * @inheritdoc\n\t */\n\tpublic $subscribeToDiffs(): void {\n\t\tthis.proxy.$acceptDiff(this.testService.collection.getReviverDiff().map(TestsDiffOp.serialize));\n\t\tthis.diffListener.value = this.testService.onDidProcessDiff(this.proxy.$acceptDiff, this.proxy);\n\t}\n\n\t/**\n\t * @inheritdoc\n\t */\n\tpublic $unsubscribeFromDiffs(): void {\n\t\tthis.diffListener.clear();\n\t}\n\n\t/**\n\t * @inheritdoc\n\t */\n\tpublic $publishDiff(controllerId: string, diff: TestsDiffOp.Serialized[]): void {\n\t\tthis.testService.publishDiff(controllerId,\n\t\t\tdiff.map(d => TestsDiffOp.deserialize(this.uriIdentityService, d)));\n\t}\n\n\t/**\n\t * @inheritdoc\n\t */\n\tpublic async $runTests(req: ResolvedTestRunRequest, token: CancellationToken): Promise<string> {\n\t\tconst result = await this.testService.runResolvedTests(req, token);\n\t\treturn result.id;\n\t}\n\n\t/**\n\t * @inheritdoc\n\t */\n\tpublic async $getCoverageDetails(resultId: string, taskIndex: number, uri: UriComponents, token: CancellationToken): Promise<CoverageDetails.Serialized[]> {\n\t\tconst details = await this.resultService.getResult(resultId)\n\t\t\t?.tasks[taskIndex]\n\t\t\t?.coverage.get()\n\t\t\t?.getUri(URI.from(uri))\n\t\t\t?.details(token);\n\n\t\t// Return empty if nothing. Some failure is always possible here because\n\t\t// results might be cleared in the meantime.\n\t\treturn details || [];\n\t}\n\n\tpublic override dispose() {\n\t\tsuper.dispose();\n\t\tfor (const subscription of this.testProviderRegistrations.values()) {\n\t\t\tsubscription.disposable.dispose();\n\t\t}\n\t\tthis.testProviderRegistrations.clear();\n\t}\n\n\tprivate withLiveRun<T>(runId: string, fn: (run: LiveTestResult) => T): T | undefined {\n\t\tconst r = this.resultService.getResult(runId);\n\t\treturn r && r instanceof LiveTestResult ? fn(r) : undefined;\n\t}\n}\n"]}