{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/api/browser/mainThreadStorage.ts","vs/workbench/api/browser/mainThreadStorage.ts"],"names":[],"mappings":"AAAA;;;gGAGgG;;;;;;;;;;AAEhG,OAAO,EAAE,eAAe,EAAgB,MAAM,6CAA6C,CAAC;AAC5F,OAAO,EAA0B,WAAW,EAAuB,cAAc,EAAE,MAAM,+BAA+B,CAAC;AACzH,OAAO,EAAE,oBAAoB,EAAmB,MAAM,sDAAsD,CAAC;AAC7G,OAAO,EAAE,eAAe,EAAE,MAAM,mCAAmC,CAAC;AACpE,OAAO,EAAE,KAAK,EAAE,MAAM,kCAAkC,CAAC;AACzD,OAAO,EAA2B,wBAAwB,EAAE,MAAM,kEAAkE,CAAC;AACrI,OAAO,EAAE,uBAAuB,EAAE,MAAM,+DAA+D,CAAC;AACxG,OAAO,EAAE,qBAAqB,EAAE,MAAM,yDAAyD,CAAC;AAChG,OAAO,EAAE,WAAW,EAAE,MAAM,qCAAqC,CAAC;AAG3D,IAAM,iBAAiB,GAAvB,MAAM,iBAAiB;IAM7B,YACC,cAA+B,EACL,wBAAmE,EAC5E,eAAiD,EAC3C,qBAA6D,EACvE,WAAyC;QAHX,6BAAwB,GAAxB,wBAAwB,CAA0B;QAC3D,oBAAe,GAAf,eAAe,CAAiB;QAC1B,0BAAqB,GAArB,qBAAqB,CAAuB;QACtD,gBAAW,GAAX,WAAW,CAAa;QARtC,qBAAgB,GAAG,IAAI,eAAe,EAAE,CAAC;QACzC,8BAAyB,GAAyB,IAAI,GAAG,EAAmB,CAAC;QAS7F,IAAI,CAAC,MAAM,GAAG,cAAc,CAAC,QAAQ,CAAC,cAAc,CAAC,cAAc,CAAC,CAAC;QAErE,IAAI,CAAC,gBAAgB,CAAC,GAAG,CAAC,IAAI,CAAC,eAAe,CAAC,gBAAgB,+BAAuB,SAAS,EAAE,IAAI,CAAC,gBAAgB,CAAC,CAAC,CAAC,CAAC,EAAE;YAC3H,IAAI,IAAI,CAAC,yBAAyB,CAAC,GAAG,CAAC,CAAC,CAAC,GAAG,CAAC,EAAE,CAAC;gBAC/C,MAAM,QAAQ,GAAG,IAAI,CAAC,wBAAwB,CAAC,oBAAoB,CAAC,CAAC,CAAC,GAAG,EAAE,IAAI,CAAC,CAAC;gBACjF,IAAI,OAAO,QAAQ,KAAK,QAAQ,EAAE,CAAC;oBAClC,IAAI,CAAC,MAAM,CAAC,YAAY,CAAC,IAAI,EAAE,CAAC,CAAC,GAAG,EAAE,QAAQ,CAAC,CAAC;gBACjD,CAAC;YACF,CAAC;QACF,CAAC,CAAC,CAAC,CAAC;IACL,CAAC;IAED,OAAO;QACN,IAAI,CAAC,gBAAgB,CAAC,OAAO,EAAE,CAAC;IACjC,CAAC;IAED,KAAK,CAAC,2BAA2B,CAAC,MAAe,EAAE,WAAmB;QAErE,MAAM,IAAI,CAAC,+BAA+B,CAAC,WAAW,EAAE,MAAM,CAAC,CAAC;QAEhE,IAAI,MAAM,EAAE,CAAC;YACZ,IAAI,CAAC,yBAAyB,CAAC,GAAG,CAAC,WAAW,EAAE,IAAI,CAAC,CAAC;QACvD,CAAC;QACD,OAAO,IAAI,CAAC,wBAAwB,CAAC,oBAAoB,CAAC,WAAW,EAAE,MAAM,CAAC,CAAC;IAChF,CAAC;IAED,KAAK,CAAC,SAAS,CAAC,MAAe,EAAE,GAAW,EAAE,KAAa;QAC1D,IAAI,CAAC,wBAAwB,CAAC,iBAAiB,CAAC,GAAG,EAAE,KAAK,EAAE,MAAM,CAAC,CAAC;IACrE,CAAC;IAED,mCAAmC,CAAC,SAAkC,EAAE,IAAc;QACrF,IAAI,CAAC,wBAAwB,CAAC,cAAc,CAAC,SAAS,EAAE,IAAI,CAAC,CAAC;IAC/D,CAAC;IAEO,KAAK,CAAC,+BAA+B,CAAC,WAAmB,EAAE,MAAe;QACjF,IAAI,CAAC;YACJ,IAAI,iBAAiB,GAAG,IAAI,CAAC,wBAAwB,CAAC,2BAA2B,CAAC,WAAW,CAAC,CAAC;YAE/F,6CAA6C;YAC7C,6DAA6D;YAC7D,6EAA6E;YAC7E,0EAA0E;YAC1E,IAAI,CAAC,iBAAiB,IAAI,KAAK,IAAI,WAAW,KAAK,WAAW,CAAC,WAAW,EAAE,EAAE,CAAC;gBAC9E,iBAAiB,GAAG,WAAW,CAAC,WAAW,EAAE,CAAC;YAC/C,CAAC;YAED,IAAI,iBAAiB,EAAE,CAAC;gBACvB,6CAA6C;gBAC7C,4EAA4E;gBAC5E,mFAAmF;gBACnF,gEAAgE;gBAChE,IAAI,KAAK,IAAI,iBAAiB,KAAK,iBAAiB,CAAC,WAAW,EAAE,IAAI,IAAI,CAAC,wBAAwB,CAAC,iBAAiB,CAAC,iBAAiB,CAAC,WAAW,EAAE,EAAE,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,wBAAwB,CAAC,iBAAiB,CAAC,iBAAiB,EAAE,MAAM,CAAC,EAAE,CAAC;oBAC/O,iBAAiB,GAAG,iBAAiB,CAAC,WAAW,EAAE,CAAC;gBACrD,CAAC;gBACD,MAAM,uBAAuB,CAAC,iBAAiB,EAAE,WAAW,EAAE,MAAM,EAAE,IAAI,CAAC,qBAAqB,CAAC,CAAC;YACnG,CAAC;QACF,CAAC;QAAC,OAAO,KAAK,EAAE,CAAC;YAChB,IAAI,CAAC,WAAW,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC;QAC/B,CAAC;IACF,CAAC;CACD,CAAA;AAzEY,iBAAiB;IAD7B,oBAAoB,CAAC,WAAW,CAAC,iBAAiB,CAAC;IASjD,WAAA,wBAAwB,CAAA;IACxB,WAAA,eAAe,CAAA;IACf,WAAA,qBAAqB,CAAA;IACrB,WAAA,WAAW,CAAA;GAXD,iBAAiB,CAyE7B","file":"mainThreadStorage.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { IStorageService, StorageScope } from '../../../platform/storage/common/storage.js';\nimport { MainThreadStorageShape, MainContext, ExtHostStorageShape, ExtHostContext } from '../common/extHost.protocol.js';\nimport { extHostNamedCustomer, IExtHostContext } from '../../services/extensions/common/extHostCustomers.js';\nimport { DisposableStore } from '../../../base/common/lifecycle.js';\nimport { isWeb } from '../../../base/common/platform.js';\nimport { IExtensionIdWithVersion, IExtensionStorageService } from '../../../platform/extensionManagement/common/extensionStorage.js';\nimport { migrateExtensionStorage } from '../../services/extensions/common/extensionStorageMigration.js';\nimport { IInstantiationService } from '../../../platform/instantiation/common/instantiation.js';\nimport { ILogService } from '../../../platform/log/common/log.js';\n\n@extHostNamedCustomer(MainContext.MainThreadStorage)\nexport class MainThreadStorage implements MainThreadStorageShape {\n\n\tprivate readonly _proxy: ExtHostStorageShape;\n\tprivate readonly _storageListener = new DisposableStore();\n\tprivate readonly _sharedStorageKeysToWatch: Map<string, boolean> = new Map<string, boolean>();\n\n\tconstructor(\n\t\textHostContext: IExtHostContext,\n\t\t@IExtensionStorageService private readonly _extensionStorageService: IExtensionStorageService,\n\t\t@IStorageService private readonly _storageService: IStorageService,\n\t\t@IInstantiationService private readonly _instantiationService: IInstantiationService,\n\t\t@ILogService private readonly _logService: ILogService,\n\t) {\n\t\tthis._proxy = extHostContext.getProxy(ExtHostContext.ExtHostStorage);\n\n\t\tthis._storageListener.add(this._storageService.onDidChangeValue(StorageScope.PROFILE, undefined, this._storageListener)(e => {\n\t\t\tif (this._sharedStorageKeysToWatch.has(e.key)) {\n\t\t\t\tconst rawState = this._extensionStorageService.getExtensionStateRaw(e.key, true);\n\t\t\t\tif (typeof rawState === 'string') {\n\t\t\t\t\tthis._proxy.$acceptValue(true, e.key, rawState);\n\t\t\t\t}\n\t\t\t}\n\t\t}));\n\t}\n\n\tdispose(): void {\n\t\tthis._storageListener.dispose();\n\t}\n\n\tasync $initializeExtensionStorage(shared: boolean, extensionId: string): Promise<string | undefined> {\n\n\t\tawait this.checkAndMigrateExtensionStorage(extensionId, shared);\n\n\t\tif (shared) {\n\t\t\tthis._sharedStorageKeysToWatch.set(extensionId, true);\n\t\t}\n\t\treturn this._extensionStorageService.getExtensionStateRaw(extensionId, shared);\n\t}\n\n\tasync $setValue(shared: boolean, key: string, value: object): Promise<void> {\n\t\tthis._extensionStorageService.setExtensionState(key, value, shared);\n\t}\n\n\t$registerExtensionStorageKeysToSync(extension: IExtensionIdWithVersion, keys: string[]): void {\n\t\tthis._extensionStorageService.setKeysForSync(extension, keys);\n\t}\n\n\tprivate async checkAndMigrateExtensionStorage(extensionId: string, shared: boolean): Promise<void> {\n\t\ttry {\n\t\t\tlet sourceExtensionId = this._extensionStorageService.getSourceExtensionToMigrate(extensionId);\n\n\t\t\t// TODO: @sandy081 - Remove it after 6 months\n\t\t\t// If current extension does not have any migration requested\n\t\t\t// Then check if the extension has to be migrated for using lower case in web\n\t\t\t// If so, migrate the extension state from lower case id to its normal id.\n\t\t\tif (!sourceExtensionId && isWeb && extensionId !== extensionId.toLowerCase()) {\n\t\t\t\tsourceExtensionId = extensionId.toLowerCase();\n\t\t\t}\n\n\t\t\tif (sourceExtensionId) {\n\t\t\t\t// TODO: @sandy081 - Remove it after 6 months\n\t\t\t\t// In Web, extension state was used to be stored in lower case extension id.\n\t\t\t\t// Hence check that if the lower cased source extension was not yet migrated in web\n\t\t\t\t// If not take the lower cased source extension id for migration\n\t\t\t\tif (isWeb && sourceExtensionId !== sourceExtensionId.toLowerCase() && this._extensionStorageService.getExtensionState(sourceExtensionId.toLowerCase(), shared) && !this._extensionStorageService.getExtensionState(sourceExtensionId, shared)) {\n\t\t\t\t\tsourceExtensionId = sourceExtensionId.toLowerCase();\n\t\t\t\t}\n\t\t\t\tawait migrateExtensionStorage(sourceExtensionId, extensionId, shared, this._instantiationService);\n\t\t\t}\n\t\t} catch (error) {\n\t\t\tthis._logService.error(error);\n\t\t}\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { IStorageService, StorageScope } from '../../../platform/storage/common/storage.js';\nimport { MainThreadStorageShape, MainContext, ExtHostStorageShape, ExtHostContext } from '../common/extHost.protocol.js';\nimport { extHostNamedCustomer, IExtHostContext } from '../../services/extensions/common/extHostCustomers.js';\nimport { DisposableStore } from '../../../base/common/lifecycle.js';\nimport { isWeb } from '../../../base/common/platform.js';\nimport { IExtensionIdWithVersion, IExtensionStorageService } from '../../../platform/extensionManagement/common/extensionStorage.js';\nimport { migrateExtensionStorage } from '../../services/extensions/common/extensionStorageMigration.js';\nimport { IInstantiationService } from '../../../platform/instantiation/common/instantiation.js';\nimport { ILogService } from '../../../platform/log/common/log.js';\n\n@extHostNamedCustomer(MainContext.MainThreadStorage)\nexport class MainThreadStorage implements MainThreadStorageShape {\n\n\tprivate readonly _proxy: ExtHostStorageShape;\n\tprivate readonly _storageListener = new DisposableStore();\n\tprivate readonly _sharedStorageKeysToWatch: Map<string, boolean> = new Map<string, boolean>();\n\n\tconstructor(\n\t\textHostContext: IExtHostContext,\n\t\t@IExtensionStorageService private readonly _extensionStorageService: IExtensionStorageService,\n\t\t@IStorageService private readonly _storageService: IStorageService,\n\t\t@IInstantiationService private readonly _instantiationService: IInstantiationService,\n\t\t@ILogService private readonly _logService: ILogService,\n\t) {\n\t\tthis._proxy = extHostContext.getProxy(ExtHostContext.ExtHostStorage);\n\n\t\tthis._storageListener.add(this._storageService.onDidChangeValue(StorageScope.PROFILE, undefined, this._storageListener)(e => {\n\t\t\tif (this._sharedStorageKeysToWatch.has(e.key)) {\n\t\t\t\tconst rawState = this._extensionStorageService.getExtensionStateRaw(e.key, true);\n\t\t\t\tif (typeof rawState === 'string') {\n\t\t\t\t\tthis._proxy.$acceptValue(true, e.key, rawState);\n\t\t\t\t}\n\t\t\t}\n\t\t}));\n\t}\n\n\tdispose(): void {\n\t\tthis._storageListener.dispose();\n\t}\n\n\tasync $initializeExtensionStorage(shared: boolean, extensionId: string): Promise<string | undefined> {\n\n\t\tawait this.checkAndMigrateExtensionStorage(extensionId, shared);\n\n\t\tif (shared) {\n\t\t\tthis._sharedStorageKeysToWatch.set(extensionId, true);\n\t\t}\n\t\treturn this._extensionStorageService.getExtensionStateRaw(extensionId, shared);\n\t}\n\n\tasync $setValue(shared: boolean, key: string, value: object): Promise<void> {\n\t\tthis._extensionStorageService.setExtensionState(key, value, shared);\n\t}\n\n\t$registerExtensionStorageKeysToSync(extension: IExtensionIdWithVersion, keys: string[]): void {\n\t\tthis._extensionStorageService.setKeysForSync(extension, keys);\n\t}\n\n\tprivate async checkAndMigrateExtensionStorage(extensionId: string, shared: boolean): Promise<void> {\n\t\ttry {\n\t\t\tlet sourceExtensionId = this._extensionStorageService.getSourceExtensionToMigrate(extensionId);\n\n\t\t\t// TODO: @sandy081 - Remove it after 6 months\n\t\t\t// If current extension does not have any migration requested\n\t\t\t// Then check if the extension has to be migrated for using lower case in web\n\t\t\t// If so, migrate the extension state from lower case id to its normal id.\n\t\t\tif (!sourceExtensionId && isWeb && extensionId !== extensionId.toLowerCase()) {\n\t\t\t\tsourceExtensionId = extensionId.toLowerCase();\n\t\t\t}\n\n\t\t\tif (sourceExtensionId) {\n\t\t\t\t// TODO: @sandy081 - Remove it after 6 months\n\t\t\t\t// In Web, extension state was used to be stored in lower case extension id.\n\t\t\t\t// Hence check that if the lower cased source extension was not yet migrated in web\n\t\t\t\t// If not take the lower cased source extension id for migration\n\t\t\t\tif (isWeb && sourceExtensionId !== sourceExtensionId.toLowerCase() && this._extensionStorageService.getExtensionState(sourceExtensionId.toLowerCase(), shared) && !this._extensionStorageService.getExtensionState(sourceExtensionId, shared)) {\n\t\t\t\t\tsourceExtensionId = sourceExtensionId.toLowerCase();\n\t\t\t\t}\n\t\t\t\tawait migrateExtensionStorage(sourceExtensionId, extensionId, shared, this._instantiationService);\n\t\t\t}\n\t\t} catch (error) {\n\t\t\tthis._logService.error(error);\n\t\t}\n\t}\n}\n"]}