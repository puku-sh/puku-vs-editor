{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/api/browser/mainThreadDocumentContentProviders.ts","vs/workbench/api/browser/mainThreadDocumentContentProviders.ts"],"names":[],"mappings":"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","file":"mainThreadDocumentContentProviders.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { onUnexpectedError } from '../../../base/common/errors.js';\nimport { dispose, DisposableMap } from '../../../base/common/lifecycle.js';\nimport { URI, UriComponents } from '../../../base/common/uri.js';\nimport { EditOperation } from '../../../editor/common/core/editOperation.js';\nimport { Range } from '../../../editor/common/core/range.js';\nimport { ITextModel } from '../../../editor/common/model.js';\nimport { IEditorWorkerService } from '../../../editor/common/services/editorWorker.js';\nimport { IModelService } from '../../../editor/common/services/model.js';\nimport { ILanguageService } from '../../../editor/common/languages/language.js';\nimport { ITextModelService } from '../../../editor/common/services/resolverService.js';\nimport { extHostNamedCustomer, IExtHostContext } from '../../services/extensions/common/extHostCustomers.js';\nimport { ExtHostContext, ExtHostDocumentContentProvidersShape, MainContext, MainThreadDocumentContentProvidersShape } from '../common/extHost.protocol.js';\nimport { CancellationTokenSource } from '../../../base/common/cancellation.js';\n\n@extHostNamedCustomer(MainContext.MainThreadDocumentContentProviders)\nexport class MainThreadDocumentContentProviders implements MainThreadDocumentContentProvidersShape {\n\n\tprivate readonly _resourceContentProvider = new DisposableMap<number>();\n\tprivate readonly _pendingUpdate = new Map<string, CancellationTokenSource>();\n\tprivate readonly _proxy: ExtHostDocumentContentProvidersShape;\n\n\tconstructor(\n\t\textHostContext: IExtHostContext,\n\t\t@ITextModelService private readonly _textModelResolverService: ITextModelService,\n\t\t@ILanguageService private readonly _languageService: ILanguageService,\n\t\t@IModelService private readonly _modelService: IModelService,\n\t\t@IEditorWorkerService private readonly _editorWorkerService: IEditorWorkerService\n\t) {\n\t\tthis._proxy = extHostContext.getProxy(ExtHostContext.ExtHostDocumentContentProviders);\n\t}\n\n\tdispose(): void {\n\t\tthis._resourceContentProvider.dispose();\n\t\tdispose(this._pendingUpdate.values());\n\t}\n\n\t$registerTextContentProvider(handle: number, scheme: string): void {\n\t\tconst registration = this._textModelResolverService.registerTextModelContentProvider(scheme, {\n\t\t\tprovideTextContent: (uri: URI): Promise<ITextModel | null> => {\n\t\t\t\treturn this._proxy.$provideTextDocumentContent(handle, uri).then(value => {\n\t\t\t\t\tif (typeof value === 'string') {\n\t\t\t\t\t\tconst firstLineText = value.substr(0, 1 + value.search(/\\r?\\n/));\n\t\t\t\t\t\tconst languageSelection = this._languageService.createByFilepathOrFirstLine(uri, firstLineText);\n\t\t\t\t\t\treturn this._modelService.createModel(value, languageSelection, uri);\n\t\t\t\t\t}\n\t\t\t\t\treturn null;\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t\tthis._resourceContentProvider.set(handle, registration);\n\t}\n\n\t$unregisterTextContentProvider(handle: number): void {\n\t\tthis._resourceContentProvider.deleteAndDispose(handle);\n\t}\n\n\tasync $onVirtualDocumentChange(uri: UriComponents, value: string): Promise<void> {\n\t\tconst model = this._modelService.getModel(URI.revive(uri));\n\t\tif (!model) {\n\t\t\treturn;\n\t\t}\n\n\t\t// cancel and dispose an existing update\n\t\tconst pending = this._pendingUpdate.get(model.id);\n\t\tpending?.cancel();\n\n\t\t// create and keep update token\n\t\tconst myToken = new CancellationTokenSource();\n\t\tthis._pendingUpdate.set(model.id, myToken);\n\n\t\ttry {\n\t\t\tconst edits = await this._editorWorkerService.computeMoreMinimalEdits(model.uri, [{ text: value, range: model.getFullModelRange() }]);\n\n\t\t\t// remove token\n\t\t\tthis._pendingUpdate.delete(model.id);\n\n\t\t\tif (myToken.token.isCancellationRequested) {\n\t\t\t\t// ignore this\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (edits && edits.length > 0) {\n\t\t\t\t// use the evil-edit as these models show in readonly-editor only\n\t\t\t\tmodel.applyEdits(edits.map(edit => EditOperation.replace(Range.lift(edit.range), edit.text)));\n\t\t\t}\n\t\t} catch (error) {\n\t\t\tonUnexpectedError(error);\n\t\t}\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { onUnexpectedError } from '../../../base/common/errors.js';\nimport { dispose, DisposableMap } from '../../../base/common/lifecycle.js';\nimport { URI, UriComponents } from '../../../base/common/uri.js';\nimport { EditOperation } from '../../../editor/common/core/editOperation.js';\nimport { Range } from '../../../editor/common/core/range.js';\nimport { ITextModel } from '../../../editor/common/model.js';\nimport { IEditorWorkerService } from '../../../editor/common/services/editorWorker.js';\nimport { IModelService } from '../../../editor/common/services/model.js';\nimport { ILanguageService } from '../../../editor/common/languages/language.js';\nimport { ITextModelService } from '../../../editor/common/services/resolverService.js';\nimport { extHostNamedCustomer, IExtHostContext } from '../../services/extensions/common/extHostCustomers.js';\nimport { ExtHostContext, ExtHostDocumentContentProvidersShape, MainContext, MainThreadDocumentContentProvidersShape } from '../common/extHost.protocol.js';\nimport { CancellationTokenSource } from '../../../base/common/cancellation.js';\n\n@extHostNamedCustomer(MainContext.MainThreadDocumentContentProviders)\nexport class MainThreadDocumentContentProviders implements MainThreadDocumentContentProvidersShape {\n\n\tprivate readonly _resourceContentProvider = new DisposableMap<number>();\n\tprivate readonly _pendingUpdate = new Map<string, CancellationTokenSource>();\n\tprivate readonly _proxy: ExtHostDocumentContentProvidersShape;\n\n\tconstructor(\n\t\textHostContext: IExtHostContext,\n\t\t@ITextModelService private readonly _textModelResolverService: ITextModelService,\n\t\t@ILanguageService private readonly _languageService: ILanguageService,\n\t\t@IModelService private readonly _modelService: IModelService,\n\t\t@IEditorWorkerService private readonly _editorWorkerService: IEditorWorkerService\n\t) {\n\t\tthis._proxy = extHostContext.getProxy(ExtHostContext.ExtHostDocumentContentProviders);\n\t}\n\n\tdispose(): void {\n\t\tthis._resourceContentProvider.dispose();\n\t\tdispose(this._pendingUpdate.values());\n\t}\n\n\t$registerTextContentProvider(handle: number, scheme: string): void {\n\t\tconst registration = this._textModelResolverService.registerTextModelContentProvider(scheme, {\n\t\t\tprovideTextContent: (uri: URI): Promise<ITextModel | null> => {\n\t\t\t\treturn this._proxy.$provideTextDocumentContent(handle, uri).then(value => {\n\t\t\t\t\tif (typeof value === 'string') {\n\t\t\t\t\t\tconst firstLineText = value.substr(0, 1 + value.search(/\\r?\\n/));\n\t\t\t\t\t\tconst languageSelection = this._languageService.createByFilepathOrFirstLine(uri, firstLineText);\n\t\t\t\t\t\treturn this._modelService.createModel(value, languageSelection, uri);\n\t\t\t\t\t}\n\t\t\t\t\treturn null;\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t\tthis._resourceContentProvider.set(handle, registration);\n\t}\n\n\t$unregisterTextContentProvider(handle: number): void {\n\t\tthis._resourceContentProvider.deleteAndDispose(handle);\n\t}\n\n\tasync $onVirtualDocumentChange(uri: UriComponents, value: string): Promise<void> {\n\t\tconst model = this._modelService.getModel(URI.revive(uri));\n\t\tif (!model) {\n\t\t\treturn;\n\t\t}\n\n\t\t// cancel and dispose an existing update\n\t\tconst pending = this._pendingUpdate.get(model.id);\n\t\tpending?.cancel();\n\n\t\t// create and keep update token\n\t\tconst myToken = new CancellationTokenSource();\n\t\tthis._pendingUpdate.set(model.id, myToken);\n\n\t\ttry {\n\t\t\tconst edits = await this._editorWorkerService.computeMoreMinimalEdits(model.uri, [{ text: value, range: model.getFullModelRange() }]);\n\n\t\t\t// remove token\n\t\t\tthis._pendingUpdate.delete(model.id);\n\n\t\t\tif (myToken.token.isCancellationRequested) {\n\t\t\t\t// ignore this\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (edits && edits.length > 0) {\n\t\t\t\t// use the evil-edit as these models show in readonly-editor only\n\t\t\t\tmodel.applyEdits(edits.map(edit => EditOperation.replace(Range.lift(edit.range), edit.text)));\n\t\t\t}\n\t\t} catch (error) {\n\t\t\tonUnexpectedError(error);\n\t\t}\n\t}\n}\n"]}