{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/api/node/proxyResolver.ts","vs/workbench/api/node/proxyResolver.ts"],"names":[],"mappings":"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","file":"proxyResolver.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { IExtHostWorkspaceProvider } from '../common/extHostWorkspace.js';\nimport { ConfigurationInspect, ExtHostConfigProvider } from '../common/extHostConfiguration.js';\nimport { MainThreadTelemetryShape } from '../common/extHost.protocol.js';\nimport { IExtensionHostInitData } from '../../services/extensions/common/extensionHostProtocol.js';\nimport { ExtHostExtensionService } from './extHostExtensionService.js';\nimport { URI } from '../../../base/common/uri.js';\nimport { ILogService, LogLevel as LogServiceLevel } from '../../../platform/log/common/log.js';\nimport { IExtensionDescription } from '../../../platform/extensions/common/extensions.js';\nimport { LogLevel, createHttpPatch, createProxyResolver, createTlsPatch, ProxySupportSetting, ProxyAgentParams, createNetPatch, loadSystemCertificates, ResolveProxyWithRequest } from '@vscode/proxy-agent';\nimport { AuthInfo, systemCertificatesNodeDefault } from '../../../platform/request/common/request.js';\nimport { DisposableStore } from '../../../base/common/lifecycle.js';\nimport { createRequire } from 'node:module';\nimport type * as undiciType from 'undici-types';\nimport type * as tlsType from 'tls';\nimport { lookupKerberosAuthorization } from '../../../platform/request/node/requestService.js';\nimport * as proxyAgent from '@vscode/proxy-agent';\n\nconst require = createRequire(import.meta.url);\nconst http = require('http');\nconst https = require('https');\nconst tls: typeof tlsType = require('tls');\nconst net = require('net');\n\nconst systemCertificatesV2Default = false;\nconst useElectronFetchDefault = false;\n\nexport function connectProxyResolver(\n\textHostWorkspace: IExtHostWorkspaceProvider,\n\tconfigProvider: ExtHostConfigProvider,\n\textensionService: ExtHostExtensionService,\n\textHostLogService: ILogService,\n\tmainThreadTelemetry: MainThreadTelemetryShape,\n\tinitData: IExtensionHostInitData,\n\tdisposables: DisposableStore,\n) {\n\n\tconst isRemote = initData.remote.isRemote;\n\tconst useHostProxyDefault = initData.environment.useHostProxy ?? !isRemote;\n\tconst fallbackToLocalKerberos = useHostProxyDefault;\n\tconst loadLocalCertificates = useHostProxyDefault;\n\tconst isUseHostProxyEnabled = () => !isRemote || configProvider.getConfiguration('http').get<boolean>('useLocalProxyConfiguration', useHostProxyDefault);\n\tconst timedResolveProxy = createTimedResolveProxy(extHostWorkspace, mainThreadTelemetry);\n\tconst params: ProxyAgentParams = {\n\t\tresolveProxy: timedResolveProxy,\n\t\tlookupProxyAuthorization: lookupProxyAuthorization.bind(undefined, extHostWorkspace, extHostLogService, mainThreadTelemetry, configProvider, {}, {}, initData.remote.isRemote, fallbackToLocalKerberos),\n\t\tgetProxyURL: () => getExtHostConfigValue<string>(configProvider, isRemote, 'http.proxy'),\n\t\tgetProxySupport: () => getExtHostConfigValue<ProxySupportSetting>(configProvider, isRemote, 'http.proxySupport') || 'off',\n\t\tgetNoProxyConfig: () => getExtHostConfigValue<string[]>(configProvider, isRemote, 'http.noProxy') || [],\n\t\tisAdditionalFetchSupportEnabled: () => getExtHostConfigValue<boolean>(configProvider, isRemote, 'http.fetchAdditionalSupport', true),\n\t\taddCertificatesV1: () => certSettingV1(configProvider, isRemote),\n\t\taddCertificatesV2: () => certSettingV2(configProvider, isRemote),\n\t\tloadSystemCertificatesFromNode: () => getExtHostConfigValue<boolean>(configProvider, isRemote, 'http.systemCertificatesNode', systemCertificatesNodeDefault),\n\t\tlog: extHostLogService,\n\t\tgetLogLevel: () => {\n\t\t\tconst level = extHostLogService.getLevel();\n\t\t\tswitch (level) {\n\t\t\t\tcase LogServiceLevel.Trace: return LogLevel.Trace;\n\t\t\t\tcase LogServiceLevel.Debug: return LogLevel.Debug;\n\t\t\t\tcase LogServiceLevel.Info: return LogLevel.Info;\n\t\t\t\tcase LogServiceLevel.Warning: return LogLevel.Warning;\n\t\t\t\tcase LogServiceLevel.Error: return LogLevel.Error;\n\t\t\t\tcase LogServiceLevel.Off: return LogLevel.Off;\n\t\t\t\tdefault: return never(level);\n\t\t\t}\n\t\t\tfunction never(level: never) {\n\t\t\t\textHostLogService.error('Unknown log level', level);\n\t\t\t\treturn LogLevel.Debug;\n\t\t\t}\n\t\t},\n\t\tproxyResolveTelemetry: () => { },\n\t\tisUseHostProxyEnabled,\n\t\tgetNetworkInterfaceCheckInterval: () => {\n\t\t\tconst intervalSeconds = getExtHostConfigValue<number>(configProvider, isRemote, 'http.experimental.networkInterfaceCheckInterval', 300);\n\t\t\treturn intervalSeconds * 1000;\n\t\t},\n\t\tloadAdditionalCertificates: async () => {\n\t\t\tconst useNodeSystemCerts = getExtHostConfigValue<boolean>(configProvider, isRemote, 'http.systemCertificatesNode', systemCertificatesNodeDefault);\n\t\t\tconst promises: Promise<string[]>[] = [];\n\t\t\tif (isRemote) {\n\t\t\t\tpromises.push(loadSystemCertificates({\n\t\t\t\t\tloadSystemCertificatesFromNode: () => useNodeSystemCerts,\n\t\t\t\t\tlog: extHostLogService,\n\t\t\t\t}));\n\t\t\t}\n\t\t\tif (loadLocalCertificates) {\n\t\t\t\tif (!isRemote && useNodeSystemCerts) {\n\t\t\t\t\tpromises.push(loadSystemCertificates({\n\t\t\t\t\t\tloadSystemCertificatesFromNode: () => useNodeSystemCerts,\n\t\t\t\t\t\tlog: extHostLogService,\n\t\t\t\t\t}));\n\t\t\t\t} else {\n\t\t\t\t\textHostLogService.trace('ProxyResolver#loadAdditionalCertificates: Loading certificates from main process');\n\t\t\t\t\tconst certs = extHostWorkspace.loadCertificates(); // Loading from main process to share cache.\n\t\t\t\t\tcerts.then(certs => extHostLogService.trace('ProxyResolver#loadAdditionalCertificates: Loaded certificates from main process', certs.length));\n\t\t\t\t\tpromises.push(certs);\n\t\t\t\t}\n\t\t\t}\n\t\t\t// Using https.globalAgent because it is shared with proxy.test.ts and mutable.\n\t\t\tif (initData.environment.extensionTestsLocationURI && https.globalAgent.testCertificates?.length) {\n\t\t\t\textHostLogService.trace('ProxyResolver#loadAdditionalCertificates: Loading test certificates');\n\t\t\t\tpromises.push(Promise.resolve(https.globalAgent.testCertificates as string[]));\n\t\t\t}\n\t\t\treturn (await Promise.all(promises)).flat();\n\t\t},\n\t\tenv: process.env,\n\t};\n\tconst { resolveProxyWithRequest, resolveProxyURL } = createProxyResolver(params);\n\t// eslint-disable-next-line local/code-no-any-casts\n\tconst target = (proxyAgent as any).default || proxyAgent;\n\ttarget.resolveProxyURL = resolveProxyURL;\n\n\tpatchGlobalFetch(params, configProvider, mainThreadTelemetry, initData, resolveProxyURL, disposables);\n\n\tconst lookup = createPatchedModules(params, resolveProxyWithRequest);\n\treturn configureModuleLoading(extensionService, lookup);\n}\n\nconst unsafeHeaders = [\n\t'content-length',\n\t'host',\n\t'trailer',\n\t'te',\n\t'upgrade',\n\t'cookie2',\n\t'keep-alive',\n\t'transfer-encoding',\n\t'set-cookie',\n];\n\nfunction patchGlobalFetch(params: ProxyAgentParams, configProvider: ExtHostConfigProvider, mainThreadTelemetry: MainThreadTelemetryShape, initData: IExtensionHostInitData, resolveProxyURL: (url: string) => Promise<string | undefined>, disposables: DisposableStore) {\n\t// eslint-disable-next-line local/code-no-any-casts\n\tif (!(globalThis as any).__vscodeOriginalFetch) {\n\t\tconst originalFetch = globalThis.fetch;\n\t\t// eslint-disable-next-line local/code-no-any-casts\n\t\t(globalThis as any).__vscodeOriginalFetch = originalFetch;\n\t\tconst patchedFetch = proxyAgent.createFetchPatch(params, originalFetch, resolveProxyURL);\n\t\t// eslint-disable-next-line local/code-no-any-casts\n\t\t(globalThis as any).__vscodePatchedFetch = patchedFetch;\n\t\tlet useElectronFetch = false;\n\t\tif (!initData.remote.isRemote) {\n\t\t\tuseElectronFetch = configProvider.getConfiguration('http').get<boolean>('electronFetch', useElectronFetchDefault);\n\t\t\tdisposables.add(configProvider.onDidChangeConfiguration(e => {\n\t\t\t\tif (e.affectsConfiguration('http.electronFetch')) {\n\t\t\t\t\tuseElectronFetch = configProvider.getConfiguration('http').get<boolean>('electronFetch', useElectronFetchDefault);\n\t\t\t\t}\n\t\t\t}));\n\t\t}\n\t\t// https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API\n\t\tglobalThis.fetch = async function fetch(input: string | URL | Request, init?: RequestInit) {\n\t\t\tfunction getRequestProperty(name: keyof Request & keyof RequestInit) {\n\t\t\t\treturn init && name in init ? init[name] : typeof input === 'object' && 'cache' in input ? input[name] : undefined;\n\t\t\t}\n\t\t\t// Limitations: https://github.com/electron/electron/pull/36733#issuecomment-1405615494\n\t\t\t// net.fetch fails on manual redirect: https://github.com/electron/electron/issues/43715\n\t\t\tconst urlString = typeof input === 'string' ? input : 'cache' in input ? input.url : input.toString();\n\t\t\tconst isDataUrl = urlString.startsWith('data:');\n\t\t\tif (isDataUrl) {\n\t\t\t\trecordFetchFeatureUse(mainThreadTelemetry, 'data');\n\t\t\t}\n\t\t\tconst isBlobUrl = urlString.startsWith('blob:');\n\t\t\tif (isBlobUrl) {\n\t\t\t\trecordFetchFeatureUse(mainThreadTelemetry, 'blob');\n\t\t\t}\n\t\t\tconst isManualRedirect = getRequestProperty('redirect') === 'manual';\n\t\t\tif (isManualRedirect) {\n\t\t\t\trecordFetchFeatureUse(mainThreadTelemetry, 'manualRedirect');\n\t\t\t}\n\t\t\tconst integrity = getRequestProperty('integrity');\n\t\t\tif (integrity) {\n\t\t\t\trecordFetchFeatureUse(mainThreadTelemetry, 'integrity');\n\t\t\t}\n\t\t\tif (!useElectronFetch || isDataUrl || isBlobUrl || isManualRedirect || integrity) {\n\t\t\t\tconst response = await patchedFetch(input, init);\n\t\t\t\tmonitorResponseProperties(mainThreadTelemetry, response, urlString);\n\t\t\t\treturn response;\n\t\t\t}\n\t\t\t// Unsupported headers: https://source.chromium.org/chromium/chromium/src/+/main:services/network/public/cpp/header_util.cc;l=32;drc=ee7299f8961a1b05a3554efcc496b6daa0d7f6e1\n\t\t\tif (init?.headers) {\n\t\t\t\tconst headers = new Headers(init.headers);\n\t\t\t\tfor (const header of unsafeHeaders) {\n\t\t\t\t\theaders.delete(header);\n\t\t\t\t}\n\t\t\t\tinit = { ...init, headers };\n\t\t\t}\n\t\t\t// Support for URL: https://github.com/electron/electron/issues/43712\n\t\t\tconst electronInput = input instanceof URL ? input.toString() : input;\n\t\t\tconst electron = require('electron');\n\t\t\tconst response = await electron.net.fetch(electronInput, init);\n\t\t\tmonitorResponseProperties(mainThreadTelemetry, response, urlString);\n\t\t\treturn response;\n\t\t};\n\t}\n}\n\nfunction monitorResponseProperties(mainThreadTelemetry: MainThreadTelemetryShape, response: Response, urlString: string) {\n\tconst originalUrl = response.url;\n\tObject.defineProperty(response, 'url', {\n\t\tget() {\n\t\t\trecordFetchFeatureUse(mainThreadTelemetry, 'url');\n\t\t\treturn originalUrl || urlString;\n\t\t}\n\t});\n\tconst originalType = response.type;\n\tObject.defineProperty(response, 'type', {\n\t\tget() {\n\t\t\trecordFetchFeatureUse(mainThreadTelemetry, 'typeProperty');\n\t\t\treturn originalType !== 'default' ? originalType : 'basic';\n\t\t}\n\t});\n}\n\ntype FetchFeatureUseClassification = {\n\towner: 'chrmarti';\n\tcomment: 'Data about fetch API use';\n\turl: { classification: 'SystemMetaData'; purpose: 'FeatureInsight'; comment: 'Whether the url property was used.' };\n\ttypeProperty: { classification: 'SystemMetaData'; purpose: 'FeatureInsight'; comment: 'Whether the type property was used.' };\n\tdata: { classification: 'SystemMetaData'; purpose: 'FeatureInsight'; comment: 'Whether a data URL was used.' };\n\tblob: { classification: 'SystemMetaData'; purpose: 'FeatureInsight'; comment: 'Whether a blob URL was used.' };\n\tintegrity: { classification: 'SystemMetaData'; purpose: 'FeatureInsight'; comment: 'Whether the integrity property was used.' };\n\tmanualRedirect: { classification: 'SystemMetaData'; purpose: 'FeatureInsight'; comment: 'Whether a manual redirect was used.' };\n};\n\ntype FetchFeatureUseEvent = {\n\turl: number;\n\ttypeProperty: number;\n\tdata: number;\n\tblob: number;\n\tintegrity: number;\n\tmanualRedirect: number;\n};\n\nconst fetchFeatureUse: FetchFeatureUseEvent = {\n\turl: 0,\n\ttypeProperty: 0,\n\tdata: 0,\n\tblob: 0,\n\tintegrity: 0,\n\tmanualRedirect: 0,\n};\n\nlet timer: Timeout | undefined;\nconst enableFeatureUseTelemetry = false;\nfunction recordFetchFeatureUse(mainThreadTelemetry: MainThreadTelemetryShape, feature: keyof typeof fetchFeatureUse) {\n\tif (enableFeatureUseTelemetry && !fetchFeatureUse[feature]++) {\n\t\tif (timer) {\n\t\t\tclearTimeout(timer);\n\t\t}\n\t\ttimer = setTimeout(() => {\n\t\t\tmainThreadTelemetry.$publicLog2<FetchFeatureUseEvent, FetchFeatureUseClassification>('fetchFeatureUse', fetchFeatureUse);\n\t\t}, 10000); // collect additional features for 10 seconds\n\t\t(timer as unknown as NodeJS.Timeout).unref?.();\n\t}\n}\n\ntype ProxyResolveStatsClassification = {\n\towner: 'chrmarti';\n\tcomment: 'Performance statistics for proxy resolution';\n\tcount: { classification: 'SystemMetaData'; purpose: 'PerformanceAndHealth'; comment: 'Number of proxy resolution calls' };\n\ttotalDuration: { classification: 'SystemMetaData'; purpose: 'PerformanceAndHealth'; comment: 'Total time spent in proxy resolution (ms)' };\n\tminDuration: { classification: 'SystemMetaData'; purpose: 'PerformanceAndHealth'; comment: 'Minimum resolution time (ms)' };\n\tmaxDuration: { classification: 'SystemMetaData'; purpose: 'PerformanceAndHealth'; comment: 'Maximum resolution time (ms)' };\n\tavgDuration: { classification: 'SystemMetaData'; purpose: 'PerformanceAndHealth'; comment: 'Average resolution time (ms)' };\n};\n\ntype ProxyResolveStatsEvent = {\n\tcount: number;\n\ttotalDuration: number;\n\tminDuration: number;\n\tmaxDuration: number;\n\tavgDuration: number;\n};\n\nconst proxyResolveStats = {\n\tcount: 0,\n\ttotalDuration: 0,\n\tminDuration: Number.MAX_SAFE_INTEGER,\n\tmaxDuration: 0,\n\tlastSentTime: 0,\n};\n\nconst telemetryInterval = 60 * 60 * 1000; // 1 hour\n\nfunction sendProxyResolveStats(mainThreadTelemetry: MainThreadTelemetryShape) {\n\tif (proxyResolveStats.count > 0) {\n\t\tconst avgDuration = proxyResolveStats.totalDuration / proxyResolveStats.count;\n\t\tmainThreadTelemetry.$publicLog2<ProxyResolveStatsEvent, ProxyResolveStatsClassification>('proxyResolveStats', {\n\t\t\tcount: proxyResolveStats.count,\n\t\t\ttotalDuration: proxyResolveStats.totalDuration,\n\t\t\tminDuration: proxyResolveStats.minDuration,\n\t\t\tmaxDuration: proxyResolveStats.maxDuration,\n\t\t\tavgDuration,\n\t\t});\n\t\t// Reset stats after sending\n\t\tproxyResolveStats.count = 0;\n\t\tproxyResolveStats.totalDuration = 0;\n\t\tproxyResolveStats.minDuration = Number.MAX_SAFE_INTEGER;\n\t\tproxyResolveStats.maxDuration = 0;\n\t}\n\tproxyResolveStats.lastSentTime = Date.now();\n}\n\nfunction createTimedResolveProxy(extHostWorkspace: IExtHostWorkspaceProvider, mainThreadTelemetry: MainThreadTelemetryShape) {\n\treturn async (url: string): Promise<string | undefined> => {\n\t\tconst startTime = performance.now();\n\t\ttry {\n\t\t\treturn await extHostWorkspace.resolveProxy(url);\n\t\t} finally {\n\t\t\tconst duration = performance.now() - startTime;\n\t\t\tproxyResolveStats.count++;\n\t\t\tproxyResolveStats.totalDuration += duration;\n\t\t\tproxyResolveStats.minDuration = Math.min(proxyResolveStats.minDuration, duration);\n\t\t\tproxyResolveStats.maxDuration = Math.max(proxyResolveStats.maxDuration, duration);\n\n\t\t\t// Send telemetry if at least an hour has passed since last send\n\t\t\tconst now = Date.now();\n\t\t\tif (now - proxyResolveStats.lastSentTime >= telemetryInterval) {\n\t\t\t\tsendProxyResolveStats(mainThreadTelemetry);\n\t\t\t}\n\t\t}\n\t};\n}\n\nfunction createPatchedModules(params: ProxyAgentParams, resolveProxy: ResolveProxyWithRequest) {\n\n\tfunction mergeModules(module: any, patch: any) {\n\t\tconst target = module.default || module;\n\t\ttarget.__vscodeOriginal = Object.assign({}, target);\n\t\treturn Object.assign(target, patch);\n\t}\n\n\treturn {\n\t\thttp: mergeModules(http, createHttpPatch(params, http, resolveProxy)),\n\t\thttps: mergeModules(https, createHttpPatch(params, https, resolveProxy)),\n\t\tnet: mergeModules(net, createNetPatch(params, net)),\n\t\ttls: mergeModules(tls, createTlsPatch(params, tls))\n\t};\n}\n\nfunction certSettingV1(configProvider: ExtHostConfigProvider, isRemote: boolean) {\n\treturn !getExtHostConfigValue<boolean>(configProvider, isRemote, 'http.experimental.systemCertificatesV2', systemCertificatesV2Default) && !!getExtHostConfigValue<boolean>(configProvider, isRemote, 'http.systemCertificates');\n}\n\nfunction certSettingV2(configProvider: ExtHostConfigProvider, isRemote: boolean) {\n\treturn !!getExtHostConfigValue<boolean>(configProvider, isRemote, 'http.experimental.systemCertificatesV2', systemCertificatesV2Default) && !!getExtHostConfigValue<boolean>(configProvider, isRemote, 'http.systemCertificates');\n}\n\nconst modulesCache = new Map<IExtensionDescription | undefined, { http?: typeof http; https?: typeof https; undici?: typeof undiciType }>();\nfunction configureModuleLoading(extensionService: ExtHostExtensionService, lookup: ReturnType<typeof createPatchedModules>): Promise<void> {\n\treturn extensionService.getExtensionPathIndex()\n\t\t.then(extensionPaths => {\n\t\t\tconst node_module = require('module');\n\t\t\tconst original = node_module._load;\n\t\t\tnode_module._load = function load(request: string, parent: { filename: string }, isMain: boolean) {\n\t\t\t\tif (request === 'net') {\n\t\t\t\t\treturn lookup.net;\n\t\t\t\t}\n\n\t\t\t\tif (request === 'tls') {\n\t\t\t\t\treturn lookup.tls;\n\t\t\t\t}\n\n\t\t\t\tif (request !== 'http' && request !== 'https' && request !== 'undici') {\n\t\t\t\t\treturn original.apply(this, arguments);\n\t\t\t\t}\n\n\t\t\t\tconst ext = extensionPaths.findSubstr(URI.file(parent.filename));\n\t\t\t\tlet cache = modulesCache.get(ext);\n\t\t\t\tif (!cache) {\n\t\t\t\t\tmodulesCache.set(ext, cache = {});\n\t\t\t\t}\n\t\t\t\tif (!cache[request]) {\n\t\t\t\t\tif (request === 'undici') {\n\t\t\t\t\t\tconst undici = original.apply(this, arguments);\n\t\t\t\t\t\tproxyAgent.patchUndici(undici);\n\t\t\t\t\t\tcache[request] = undici;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tconst mod = lookup[request];\n\t\t\t\t\t\tcache[request] = { ...mod }; // Copy to work around #93167.\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn cache[request];\n\t\t\t};\n\t\t});\n}\n\nasync function lookupProxyAuthorization(\n\textHostWorkspace: IExtHostWorkspaceProvider,\n\textHostLogService: ILogService,\n\tmainThreadTelemetry: MainThreadTelemetryShape,\n\tconfigProvider: ExtHostConfigProvider,\n\tproxyAuthenticateCache: Record<string, string | string[] | undefined>,\n\tbasicAuthCache: Record<string, string | undefined>,\n\tisRemote: boolean,\n\tfallbackToLocalKerberos: boolean,\n\tproxyURL: string,\n\tproxyAuthenticate: string | string[] | undefined,\n\tstate: { kerberosRequested?: boolean; basicAuthCacheUsed?: boolean; basicAuthAttempt?: number }\n): Promise<string | undefined> {\n\tconst cached = proxyAuthenticateCache[proxyURL];\n\tif (proxyAuthenticate) {\n\t\tproxyAuthenticateCache[proxyURL] = proxyAuthenticate;\n\t}\n\textHostLogService.trace('ProxyResolver#lookupProxyAuthorization callback', `proxyURL:${proxyURL}`, `proxyAuthenticate:${proxyAuthenticate}`, `proxyAuthenticateCache:${cached}`);\n\tconst header = proxyAuthenticate || cached;\n\tconst authenticate = Array.isArray(header) ? header : typeof header === 'string' ? [header] : [];\n\tsendTelemetry(mainThreadTelemetry, authenticate, isRemote);\n\tif (authenticate.some(a => /^(Negotiate|Kerberos)( |$)/i.test(a)) && !state.kerberosRequested) {\n\t\tstate.kerberosRequested = true;\n\n\t\ttry {\n\t\t\tconst spnConfig = getExtHostConfigValue<string>(configProvider, isRemote, 'http.proxyKerberosServicePrincipal');\n\t\t\tconst response = await lookupKerberosAuthorization(proxyURL, spnConfig, extHostLogService, 'ProxyResolver#lookupProxyAuthorization');\n\t\t\treturn 'Negotiate ' + response;\n\t\t} catch (err) {\n\t\t\textHostLogService.debug('ProxyResolver#lookupProxyAuthorization Kerberos authentication failed', err);\n\t\t}\n\n\t\tif (isRemote && fallbackToLocalKerberos) {\n\t\t\textHostLogService.debug('ProxyResolver#lookupProxyAuthorization Kerberos authentication lookup on host', `proxyURL:${proxyURL}`);\n\t\t\tconst auth = await extHostWorkspace.lookupKerberosAuthorization(proxyURL);\n\t\t\tif (auth) {\n\t\t\t\treturn 'Negotiate ' + auth;\n\t\t\t}\n\t\t}\n\t}\n\tconst basicAuthHeader = authenticate.find(a => /^Basic( |$)/i.test(a));\n\tif (basicAuthHeader) {\n\t\ttry {\n\t\t\tconst cachedAuth = basicAuthCache[proxyURL];\n\t\t\tif (cachedAuth) {\n\t\t\t\tif (state.basicAuthCacheUsed) {\n\t\t\t\t\textHostLogService.debug('ProxyResolver#lookupProxyAuthorization Basic authentication deleting cached credentials', `proxyURL:${proxyURL}`);\n\t\t\t\t\tdelete basicAuthCache[proxyURL];\n\t\t\t\t} else {\n\t\t\t\t\textHostLogService.debug('ProxyResolver#lookupProxyAuthorization Basic authentication using cached credentials', `proxyURL:${proxyURL}`);\n\t\t\t\t\tstate.basicAuthCacheUsed = true;\n\t\t\t\t\treturn cachedAuth;\n\t\t\t\t}\n\t\t\t}\n\t\t\tstate.basicAuthAttempt = (state.basicAuthAttempt || 0) + 1;\n\t\t\tconst realm = / realm=\"([^\"]+)\"/i.exec(basicAuthHeader)?.[1];\n\t\t\textHostLogService.debug('ProxyResolver#lookupProxyAuthorization Basic authentication lookup', `proxyURL:${proxyURL}`, `realm:${realm}`);\n\t\t\tconst url = new URL(proxyURL);\n\t\t\tconst authInfo: AuthInfo = {\n\t\t\t\tscheme: 'basic',\n\t\t\t\thost: url.hostname,\n\t\t\t\tport: Number(url.port),\n\t\t\t\trealm: realm || '',\n\t\t\t\tisProxy: true,\n\t\t\t\tattempt: state.basicAuthAttempt,\n\t\t\t};\n\t\t\tconst credentials = await extHostWorkspace.lookupAuthorization(authInfo);\n\t\t\tif (credentials) {\n\t\t\t\textHostLogService.debug('ProxyResolver#lookupProxyAuthorization Basic authentication received credentials', `proxyURL:${proxyURL}`, `realm:${realm}`);\n\t\t\t\tconst auth = 'Basic ' + Buffer.from(`${credentials.username}:${credentials.password}`).toString('base64');\n\t\t\t\tbasicAuthCache[proxyURL] = auth;\n\t\t\t\treturn auth;\n\t\t\t} else {\n\t\t\t\textHostLogService.debug('ProxyResolver#lookupProxyAuthorization Basic authentication received no credentials', `proxyURL:${proxyURL}`, `realm:${realm}`);\n\t\t\t}\n\t\t} catch (err) {\n\t\t\textHostLogService.error('ProxyResolver#lookupProxyAuthorization Basic authentication failed', err);\n\t\t}\n\t}\n\treturn undefined;\n}\n\ntype ProxyAuthenticationClassification = {\n\towner: 'chrmarti';\n\tcomment: 'Data about proxy authentication requests';\n\tauthenticationType: { classification: 'PublicNonPersonalData'; purpose: 'FeatureInsight'; comment: 'Type of the authentication requested' };\n\textensionHostType: { classification: 'SystemMetaData'; purpose: 'FeatureInsight'; comment: 'Type of the extension host' };\n};\n\ntype ProxyAuthenticationEvent = {\n\tauthenticationType: string;\n\textensionHostType: string;\n};\n\nlet telemetrySent = false;\nconst enableProxyAuthenticationTelemetry = false;\nfunction sendTelemetry(mainThreadTelemetry: MainThreadTelemetryShape, authenticate: string[], isRemote: boolean) {\n\tif (!enableProxyAuthenticationTelemetry || telemetrySent || !authenticate.length) {\n\t\treturn;\n\t}\n\ttelemetrySent = true;\n\n\tmainThreadTelemetry.$publicLog2<ProxyAuthenticationEvent, ProxyAuthenticationClassification>('proxyAuthenticationRequest', {\n\t\tauthenticationType: authenticate.map(a => a.split(' ')[0]).join(','),\n\t\textensionHostType: isRemote ? 'remote' : 'local',\n\t});\n}\n\nfunction getExtHostConfigValue<T>(configProvider: ExtHostConfigProvider, isRemote: boolean, key: string, fallback: T): T;\nfunction getExtHostConfigValue<T>(configProvider: ExtHostConfigProvider, isRemote: boolean, key: string): T | undefined;\nfunction getExtHostConfigValue<T>(configProvider: ExtHostConfigProvider, isRemote: boolean, key: string, fallback?: T): T | undefined {\n\tif (isRemote) {\n\t\treturn configProvider.getConfiguration().get<T>(key) ?? fallback;\n\t}\n\tconst values: ConfigurationInspect<T> | undefined = configProvider.getConfiguration().inspect<T>(key);\n\treturn values?.globalLocalValue ?? values?.defaultValue ?? fallback;\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { IExtHostWorkspaceProvider } from '../common/extHostWorkspace.js';\nimport { ConfigurationInspect, ExtHostConfigProvider } from '../common/extHostConfiguration.js';\nimport { MainThreadTelemetryShape } from '../common/extHost.protocol.js';\nimport { IExtensionHostInitData } from '../../services/extensions/common/extensionHostProtocol.js';\nimport { ExtHostExtensionService } from './extHostExtensionService.js';\nimport { URI } from '../../../base/common/uri.js';\nimport { ILogService, LogLevel as LogServiceLevel } from '../../../platform/log/common/log.js';\nimport { IExtensionDescription } from '../../../platform/extensions/common/extensions.js';\nimport { LogLevel, createHttpPatch, createProxyResolver, createTlsPatch, ProxySupportSetting, ProxyAgentParams, createNetPatch, loadSystemCertificates, ResolveProxyWithRequest } from '@vscode/proxy-agent';\nimport { AuthInfo, systemCertificatesNodeDefault } from '../../../platform/request/common/request.js';\nimport { DisposableStore } from '../../../base/common/lifecycle.js';\nimport { createRequire } from 'node:module';\nimport type * as undiciType from 'undici-types';\nimport type * as tlsType from 'tls';\nimport { lookupKerberosAuthorization } from '../../../platform/request/node/requestService.js';\nimport * as proxyAgent from '@vscode/proxy-agent';\n\nconst require = createRequire(import.meta.url);\nconst http = require('http');\nconst https = require('https');\nconst tls: typeof tlsType = require('tls');\nconst net = require('net');\n\nconst systemCertificatesV2Default = false;\nconst useElectronFetchDefault = false;\n\nexport function connectProxyResolver(\n\textHostWorkspace: IExtHostWorkspaceProvider,\n\tconfigProvider: ExtHostConfigProvider,\n\textensionService: ExtHostExtensionService,\n\textHostLogService: ILogService,\n\tmainThreadTelemetry: MainThreadTelemetryShape,\n\tinitData: IExtensionHostInitData,\n\tdisposables: DisposableStore,\n) {\n\n\tconst isRemote = initData.remote.isRemote;\n\tconst useHostProxyDefault = initData.environment.useHostProxy ?? !isRemote;\n\tconst fallbackToLocalKerberos = useHostProxyDefault;\n\tconst loadLocalCertificates = useHostProxyDefault;\n\tconst isUseHostProxyEnabled = () => !isRemote || configProvider.getConfiguration('http').get<boolean>('useLocalProxyConfiguration', useHostProxyDefault);\n\tconst timedResolveProxy = createTimedResolveProxy(extHostWorkspace, mainThreadTelemetry);\n\tconst params: ProxyAgentParams = {\n\t\tresolveProxy: timedResolveProxy,\n\t\tlookupProxyAuthorization: lookupProxyAuthorization.bind(undefined, extHostWorkspace, extHostLogService, mainThreadTelemetry, configProvider, {}, {}, initData.remote.isRemote, fallbackToLocalKerberos),\n\t\tgetProxyURL: () => getExtHostConfigValue<string>(configProvider, isRemote, 'http.proxy'),\n\t\tgetProxySupport: () => getExtHostConfigValue<ProxySupportSetting>(configProvider, isRemote, 'http.proxySupport') || 'off',\n\t\tgetNoProxyConfig: () => getExtHostConfigValue<string[]>(configProvider, isRemote, 'http.noProxy') || [],\n\t\tisAdditionalFetchSupportEnabled: () => getExtHostConfigValue<boolean>(configProvider, isRemote, 'http.fetchAdditionalSupport', true),\n\t\taddCertificatesV1: () => certSettingV1(configProvider, isRemote),\n\t\taddCertificatesV2: () => certSettingV2(configProvider, isRemote),\n\t\tloadSystemCertificatesFromNode: () => getExtHostConfigValue<boolean>(configProvider, isRemote, 'http.systemCertificatesNode', systemCertificatesNodeDefault),\n\t\tlog: extHostLogService,\n\t\tgetLogLevel: () => {\n\t\t\tconst level = extHostLogService.getLevel();\n\t\t\tswitch (level) {\n\t\t\t\tcase LogServiceLevel.Trace: return LogLevel.Trace;\n\t\t\t\tcase LogServiceLevel.Debug: return LogLevel.Debug;\n\t\t\t\tcase LogServiceLevel.Info: return LogLevel.Info;\n\t\t\t\tcase LogServiceLevel.Warning: return LogLevel.Warning;\n\t\t\t\tcase LogServiceLevel.Error: return LogLevel.Error;\n\t\t\t\tcase LogServiceLevel.Off: return LogLevel.Off;\n\t\t\t\tdefault: return never(level);\n\t\t\t}\n\t\t\tfunction never(level: never) {\n\t\t\t\textHostLogService.error('Unknown log level', level);\n\t\t\t\treturn LogLevel.Debug;\n\t\t\t}\n\t\t},\n\t\tproxyResolveTelemetry: () => { },\n\t\tisUseHostProxyEnabled,\n\t\tgetNetworkInterfaceCheckInterval: () => {\n\t\t\tconst intervalSeconds = getExtHostConfigValue<number>(configProvider, isRemote, 'http.experimental.networkInterfaceCheckInterval', 300);\n\t\t\treturn intervalSeconds * 1000;\n\t\t},\n\t\tloadAdditionalCertificates: async () => {\n\t\t\tconst useNodeSystemCerts = getExtHostConfigValue<boolean>(configProvider, isRemote, 'http.systemCertificatesNode', systemCertificatesNodeDefault);\n\t\t\tconst promises: Promise<string[]>[] = [];\n\t\t\tif (isRemote) {\n\t\t\t\tpromises.push(loadSystemCertificates({\n\t\t\t\t\tloadSystemCertificatesFromNode: () => useNodeSystemCerts,\n\t\t\t\t\tlog: extHostLogService,\n\t\t\t\t}));\n\t\t\t}\n\t\t\tif (loadLocalCertificates) {\n\t\t\t\tif (!isRemote && useNodeSystemCerts) {\n\t\t\t\t\tpromises.push(loadSystemCertificates({\n\t\t\t\t\t\tloadSystemCertificatesFromNode: () => useNodeSystemCerts,\n\t\t\t\t\t\tlog: extHostLogService,\n\t\t\t\t\t}));\n\t\t\t\t} else {\n\t\t\t\t\textHostLogService.trace('ProxyResolver#loadAdditionalCertificates: Loading certificates from main process');\n\t\t\t\t\tconst certs = extHostWorkspace.loadCertificates(); // Loading from main process to share cache.\n\t\t\t\t\tcerts.then(certs => extHostLogService.trace('ProxyResolver#loadAdditionalCertificates: Loaded certificates from main process', certs.length));\n\t\t\t\t\tpromises.push(certs);\n\t\t\t\t}\n\t\t\t}\n\t\t\t// Using https.globalAgent because it is shared with proxy.test.ts and mutable.\n\t\t\tif (initData.environment.extensionTestsLocationURI && https.globalAgent.testCertificates?.length) {\n\t\t\t\textHostLogService.trace('ProxyResolver#loadAdditionalCertificates: Loading test certificates');\n\t\t\t\tpromises.push(Promise.resolve(https.globalAgent.testCertificates as string[]));\n\t\t\t}\n\t\t\treturn (await Promise.all(promises)).flat();\n\t\t},\n\t\tenv: process.env,\n\t};\n\tconst { resolveProxyWithRequest, resolveProxyURL } = createProxyResolver(params);\n\t// eslint-disable-next-line local/code-no-any-casts\n\tconst target = (proxyAgent as any).default || proxyAgent;\n\ttarget.resolveProxyURL = resolveProxyURL;\n\n\tpatchGlobalFetch(params, configProvider, mainThreadTelemetry, initData, resolveProxyURL, disposables);\n\n\tconst lookup = createPatchedModules(params, resolveProxyWithRequest);\n\treturn configureModuleLoading(extensionService, lookup);\n}\n\nconst unsafeHeaders = [\n\t'content-length',\n\t'host',\n\t'trailer',\n\t'te',\n\t'upgrade',\n\t'cookie2',\n\t'keep-alive',\n\t'transfer-encoding',\n\t'set-cookie',\n];\n\nfunction patchGlobalFetch(params: ProxyAgentParams, configProvider: ExtHostConfigProvider, mainThreadTelemetry: MainThreadTelemetryShape, initData: IExtensionHostInitData, resolveProxyURL: (url: string) => Promise<string | undefined>, disposables: DisposableStore) {\n\t// eslint-disable-next-line local/code-no-any-casts\n\tif (!(globalThis as any).__vscodeOriginalFetch) {\n\t\tconst originalFetch = globalThis.fetch;\n\t\t// eslint-disable-next-line local/code-no-any-casts\n\t\t(globalThis as any).__vscodeOriginalFetch = originalFetch;\n\t\tconst patchedFetch = proxyAgent.createFetchPatch(params, originalFetch, resolveProxyURL);\n\t\t// eslint-disable-next-line local/code-no-any-casts\n\t\t(globalThis as any).__vscodePatchedFetch = patchedFetch;\n\t\tlet useElectronFetch = false;\n\t\tif (!initData.remote.isRemote) {\n\t\t\tuseElectronFetch = configProvider.getConfiguration('http').get<boolean>('electronFetch', useElectronFetchDefault);\n\t\t\tdisposables.add(configProvider.onDidChangeConfiguration(e => {\n\t\t\t\tif (e.affectsConfiguration('http.electronFetch')) {\n\t\t\t\t\tuseElectronFetch = configProvider.getConfiguration('http').get<boolean>('electronFetch', useElectronFetchDefault);\n\t\t\t\t}\n\t\t\t}));\n\t\t}\n\t\t// https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API\n\t\tglobalThis.fetch = async function fetch(input: string | URL | Request, init?: RequestInit) {\n\t\t\tfunction getRequestProperty(name: keyof Request & keyof RequestInit) {\n\t\t\t\treturn init && name in init ? init[name] : typeof input === 'object' && 'cache' in input ? input[name] : undefined;\n\t\t\t}\n\t\t\t// Limitations: https://github.com/electron/electron/pull/36733#issuecomment-1405615494\n\t\t\t// net.fetch fails on manual redirect: https://github.com/electron/electron/issues/43715\n\t\t\tconst urlString = typeof input === 'string' ? input : 'cache' in input ? input.url : input.toString();\n\t\t\tconst isDataUrl = urlString.startsWith('data:');\n\t\t\tif (isDataUrl) {\n\t\t\t\trecordFetchFeatureUse(mainThreadTelemetry, 'data');\n\t\t\t}\n\t\t\tconst isBlobUrl = urlString.startsWith('blob:');\n\t\t\tif (isBlobUrl) {\n\t\t\t\trecordFetchFeatureUse(mainThreadTelemetry, 'blob');\n\t\t\t}\n\t\t\tconst isManualRedirect = getRequestProperty('redirect') === 'manual';\n\t\t\tif (isManualRedirect) {\n\t\t\t\trecordFetchFeatureUse(mainThreadTelemetry, 'manualRedirect');\n\t\t\t}\n\t\t\tconst integrity = getRequestProperty('integrity');\n\t\t\tif (integrity) {\n\t\t\t\trecordFetchFeatureUse(mainThreadTelemetry, 'integrity');\n\t\t\t}\n\t\t\tif (!useElectronFetch || isDataUrl || isBlobUrl || isManualRedirect || integrity) {\n\t\t\t\tconst response = await patchedFetch(input, init);\n\t\t\t\tmonitorResponseProperties(mainThreadTelemetry, response, urlString);\n\t\t\t\treturn response;\n\t\t\t}\n\t\t\t// Unsupported headers: https://source.chromium.org/chromium/chromium/src/+/main:services/network/public/cpp/header_util.cc;l=32;drc=ee7299f8961a1b05a3554efcc496b6daa0d7f6e1\n\t\t\tif (init?.headers) {\n\t\t\t\tconst headers = new Headers(init.headers);\n\t\t\t\tfor (const header of unsafeHeaders) {\n\t\t\t\t\theaders.delete(header);\n\t\t\t\t}\n\t\t\t\tinit = { ...init, headers };\n\t\t\t}\n\t\t\t// Support for URL: https://github.com/electron/electron/issues/43712\n\t\t\tconst electronInput = input instanceof URL ? input.toString() : input;\n\t\t\tconst electron = require('electron');\n\t\t\tconst response = await electron.net.fetch(electronInput, init);\n\t\t\tmonitorResponseProperties(mainThreadTelemetry, response, urlString);\n\t\t\treturn response;\n\t\t};\n\t}\n}\n\nfunction monitorResponseProperties(mainThreadTelemetry: MainThreadTelemetryShape, response: Response, urlString: string) {\n\tconst originalUrl = response.url;\n\tObject.defineProperty(response, 'url', {\n\t\tget() {\n\t\t\trecordFetchFeatureUse(mainThreadTelemetry, 'url');\n\t\t\treturn originalUrl || urlString;\n\t\t}\n\t});\n\tconst originalType = response.type;\n\tObject.defineProperty(response, 'type', {\n\t\tget() {\n\t\t\trecordFetchFeatureUse(mainThreadTelemetry, 'typeProperty');\n\t\t\treturn originalType !== 'default' ? originalType : 'basic';\n\t\t}\n\t});\n}\n\ntype FetchFeatureUseClassification = {\n\towner: 'chrmarti';\n\tcomment: 'Data about fetch API use';\n\turl: { classification: 'SystemMetaData'; purpose: 'FeatureInsight'; comment: 'Whether the url property was used.' };\n\ttypeProperty: { classification: 'SystemMetaData'; purpose: 'FeatureInsight'; comment: 'Whether the type property was used.' };\n\tdata: { classification: 'SystemMetaData'; purpose: 'FeatureInsight'; comment: 'Whether a data URL was used.' };\n\tblob: { classification: 'SystemMetaData'; purpose: 'FeatureInsight'; comment: 'Whether a blob URL was used.' };\n\tintegrity: { classification: 'SystemMetaData'; purpose: 'FeatureInsight'; comment: 'Whether the integrity property was used.' };\n\tmanualRedirect: { classification: 'SystemMetaData'; purpose: 'FeatureInsight'; comment: 'Whether a manual redirect was used.' };\n};\n\ntype FetchFeatureUseEvent = {\n\turl: number;\n\ttypeProperty: number;\n\tdata: number;\n\tblob: number;\n\tintegrity: number;\n\tmanualRedirect: number;\n};\n\nconst fetchFeatureUse: FetchFeatureUseEvent = {\n\turl: 0,\n\ttypeProperty: 0,\n\tdata: 0,\n\tblob: 0,\n\tintegrity: 0,\n\tmanualRedirect: 0,\n};\n\nlet timer: Timeout | undefined;\nconst enableFeatureUseTelemetry = false;\nfunction recordFetchFeatureUse(mainThreadTelemetry: MainThreadTelemetryShape, feature: keyof typeof fetchFeatureUse) {\n\tif (enableFeatureUseTelemetry && !fetchFeatureUse[feature]++) {\n\t\tif (timer) {\n\t\t\tclearTimeout(timer);\n\t\t}\n\t\ttimer = setTimeout(() => {\n\t\t\tmainThreadTelemetry.$publicLog2<FetchFeatureUseEvent, FetchFeatureUseClassification>('fetchFeatureUse', fetchFeatureUse);\n\t\t}, 10000); // collect additional features for 10 seconds\n\t\t(timer as unknown as NodeJS.Timeout).unref?.();\n\t}\n}\n\ntype ProxyResolveStatsClassification = {\n\towner: 'chrmarti';\n\tcomment: 'Performance statistics for proxy resolution';\n\tcount: { classification: 'SystemMetaData'; purpose: 'PerformanceAndHealth'; comment: 'Number of proxy resolution calls' };\n\ttotalDuration: { classification: 'SystemMetaData'; purpose: 'PerformanceAndHealth'; comment: 'Total time spent in proxy resolution (ms)' };\n\tminDuration: { classification: 'SystemMetaData'; purpose: 'PerformanceAndHealth'; comment: 'Minimum resolution time (ms)' };\n\tmaxDuration: { classification: 'SystemMetaData'; purpose: 'PerformanceAndHealth'; comment: 'Maximum resolution time (ms)' };\n\tavgDuration: { classification: 'SystemMetaData'; purpose: 'PerformanceAndHealth'; comment: 'Average resolution time (ms)' };\n};\n\ntype ProxyResolveStatsEvent = {\n\tcount: number;\n\ttotalDuration: number;\n\tminDuration: number;\n\tmaxDuration: number;\n\tavgDuration: number;\n};\n\nconst proxyResolveStats = {\n\tcount: 0,\n\ttotalDuration: 0,\n\tminDuration: Number.MAX_SAFE_INTEGER,\n\tmaxDuration: 0,\n\tlastSentTime: 0,\n};\n\nconst telemetryInterval = 60 * 60 * 1000; // 1 hour\n\nfunction sendProxyResolveStats(mainThreadTelemetry: MainThreadTelemetryShape) {\n\tif (proxyResolveStats.count > 0) {\n\t\tconst avgDuration = proxyResolveStats.totalDuration / proxyResolveStats.count;\n\t\tmainThreadTelemetry.$publicLog2<ProxyResolveStatsEvent, ProxyResolveStatsClassification>('proxyResolveStats', {\n\t\t\tcount: proxyResolveStats.count,\n\t\t\ttotalDuration: proxyResolveStats.totalDuration,\n\t\t\tminDuration: proxyResolveStats.minDuration,\n\t\t\tmaxDuration: proxyResolveStats.maxDuration,\n\t\t\tavgDuration,\n\t\t});\n\t\t// Reset stats after sending\n\t\tproxyResolveStats.count = 0;\n\t\tproxyResolveStats.totalDuration = 0;\n\t\tproxyResolveStats.minDuration = Number.MAX_SAFE_INTEGER;\n\t\tproxyResolveStats.maxDuration = 0;\n\t}\n\tproxyResolveStats.lastSentTime = Date.now();\n}\n\nfunction createTimedResolveProxy(extHostWorkspace: IExtHostWorkspaceProvider, mainThreadTelemetry: MainThreadTelemetryShape) {\n\treturn async (url: string): Promise<string | undefined> => {\n\t\tconst startTime = performance.now();\n\t\ttry {\n\t\t\treturn await extHostWorkspace.resolveProxy(url);\n\t\t} finally {\n\t\t\tconst duration = performance.now() - startTime;\n\t\t\tproxyResolveStats.count++;\n\t\t\tproxyResolveStats.totalDuration += duration;\n\t\t\tproxyResolveStats.minDuration = Math.min(proxyResolveStats.minDuration, duration);\n\t\t\tproxyResolveStats.maxDuration = Math.max(proxyResolveStats.maxDuration, duration);\n\n\t\t\t// Send telemetry if at least an hour has passed since last send\n\t\t\tconst now = Date.now();\n\t\t\tif (now - proxyResolveStats.lastSentTime >= telemetryInterval) {\n\t\t\t\tsendProxyResolveStats(mainThreadTelemetry);\n\t\t\t}\n\t\t}\n\t};\n}\n\nfunction createPatchedModules(params: ProxyAgentParams, resolveProxy: ResolveProxyWithRequest) {\n\n\tfunction mergeModules(module: any, patch: any) {\n\t\tconst target = module.default || module;\n\t\ttarget.__vscodeOriginal = Object.assign({}, target);\n\t\treturn Object.assign(target, patch);\n\t}\n\n\treturn {\n\t\thttp: mergeModules(http, createHttpPatch(params, http, resolveProxy)),\n\t\thttps: mergeModules(https, createHttpPatch(params, https, resolveProxy)),\n\t\tnet: mergeModules(net, createNetPatch(params, net)),\n\t\ttls: mergeModules(tls, createTlsPatch(params, tls))\n\t};\n}\n\nfunction certSettingV1(configProvider: ExtHostConfigProvider, isRemote: boolean) {\n\treturn !getExtHostConfigValue<boolean>(configProvider, isRemote, 'http.experimental.systemCertificatesV2', systemCertificatesV2Default) && !!getExtHostConfigValue<boolean>(configProvider, isRemote, 'http.systemCertificates');\n}\n\nfunction certSettingV2(configProvider: ExtHostConfigProvider, isRemote: boolean) {\n\treturn !!getExtHostConfigValue<boolean>(configProvider, isRemote, 'http.experimental.systemCertificatesV2', systemCertificatesV2Default) && !!getExtHostConfigValue<boolean>(configProvider, isRemote, 'http.systemCertificates');\n}\n\nconst modulesCache = new Map<IExtensionDescription | undefined, { http?: typeof http; https?: typeof https; undici?: typeof undiciType }>();\nfunction configureModuleLoading(extensionService: ExtHostExtensionService, lookup: ReturnType<typeof createPatchedModules>): Promise<void> {\n\treturn extensionService.getExtensionPathIndex()\n\t\t.then(extensionPaths => {\n\t\t\tconst node_module = require('module');\n\t\t\tconst original = node_module._load;\n\t\t\tnode_module._load = function load(request: string, parent: { filename: string }, isMain: boolean) {\n\t\t\t\tif (request === 'net') {\n\t\t\t\t\treturn lookup.net;\n\t\t\t\t}\n\n\t\t\t\tif (request === 'tls') {\n\t\t\t\t\treturn lookup.tls;\n\t\t\t\t}\n\n\t\t\t\tif (request !== 'http' && request !== 'https' && request !== 'undici') {\n\t\t\t\t\treturn original.apply(this, arguments);\n\t\t\t\t}\n\n\t\t\t\tconst ext = extensionPaths.findSubstr(URI.file(parent.filename));\n\t\t\t\tlet cache = modulesCache.get(ext);\n\t\t\t\tif (!cache) {\n\t\t\t\t\tmodulesCache.set(ext, cache = {});\n\t\t\t\t}\n\t\t\t\tif (!cache[request]) {\n\t\t\t\t\tif (request === 'undici') {\n\t\t\t\t\t\tconst undici = original.apply(this, arguments);\n\t\t\t\t\t\tproxyAgent.patchUndici(undici);\n\t\t\t\t\t\tcache[request] = undici;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tconst mod = lookup[request];\n\t\t\t\t\t\tcache[request] = { ...mod }; // Copy to work around #93167.\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn cache[request];\n\t\t\t};\n\t\t});\n}\n\nasync function lookupProxyAuthorization(\n\textHostWorkspace: IExtHostWorkspaceProvider,\n\textHostLogService: ILogService,\n\tmainThreadTelemetry: MainThreadTelemetryShape,\n\tconfigProvider: ExtHostConfigProvider,\n\tproxyAuthenticateCache: Record<string, string | string[] | undefined>,\n\tbasicAuthCache: Record<string, string | undefined>,\n\tisRemote: boolean,\n\tfallbackToLocalKerberos: boolean,\n\tproxyURL: string,\n\tproxyAuthenticate: string | string[] | undefined,\n\tstate: { kerberosRequested?: boolean; basicAuthCacheUsed?: boolean; basicAuthAttempt?: number }\n): Promise<string | undefined> {\n\tconst cached = proxyAuthenticateCache[proxyURL];\n\tif (proxyAuthenticate) {\n\t\tproxyAuthenticateCache[proxyURL] = proxyAuthenticate;\n\t}\n\textHostLogService.trace('ProxyResolver#lookupProxyAuthorization callback', `proxyURL:${proxyURL}`, `proxyAuthenticate:${proxyAuthenticate}`, `proxyAuthenticateCache:${cached}`);\n\tconst header = proxyAuthenticate || cached;\n\tconst authenticate = Array.isArray(header) ? header : typeof header === 'string' ? [header] : [];\n\tsendTelemetry(mainThreadTelemetry, authenticate, isRemote);\n\tif (authenticate.some(a => /^(Negotiate|Kerberos)( |$)/i.test(a)) && !state.kerberosRequested) {\n\t\tstate.kerberosRequested = true;\n\n\t\ttry {\n\t\t\tconst spnConfig = getExtHostConfigValue<string>(configProvider, isRemote, 'http.proxyKerberosServicePrincipal');\n\t\t\tconst response = await lookupKerberosAuthorization(proxyURL, spnConfig, extHostLogService, 'ProxyResolver#lookupProxyAuthorization');\n\t\t\treturn 'Negotiate ' + response;\n\t\t} catch (err) {\n\t\t\textHostLogService.debug('ProxyResolver#lookupProxyAuthorization Kerberos authentication failed', err);\n\t\t}\n\n\t\tif (isRemote && fallbackToLocalKerberos) {\n\t\t\textHostLogService.debug('ProxyResolver#lookupProxyAuthorization Kerberos authentication lookup on host', `proxyURL:${proxyURL}`);\n\t\t\tconst auth = await extHostWorkspace.lookupKerberosAuthorization(proxyURL);\n\t\t\tif (auth) {\n\t\t\t\treturn 'Negotiate ' + auth;\n\t\t\t}\n\t\t}\n\t}\n\tconst basicAuthHeader = authenticate.find(a => /^Basic( |$)/i.test(a));\n\tif (basicAuthHeader) {\n\t\ttry {\n\t\t\tconst cachedAuth = basicAuthCache[proxyURL];\n\t\t\tif (cachedAuth) {\n\t\t\t\tif (state.basicAuthCacheUsed) {\n\t\t\t\t\textHostLogService.debug('ProxyResolver#lookupProxyAuthorization Basic authentication deleting cached credentials', `proxyURL:${proxyURL}`);\n\t\t\t\t\tdelete basicAuthCache[proxyURL];\n\t\t\t\t} else {\n\t\t\t\t\textHostLogService.debug('ProxyResolver#lookupProxyAuthorization Basic authentication using cached credentials', `proxyURL:${proxyURL}`);\n\t\t\t\t\tstate.basicAuthCacheUsed = true;\n\t\t\t\t\treturn cachedAuth;\n\t\t\t\t}\n\t\t\t}\n\t\t\tstate.basicAuthAttempt = (state.basicAuthAttempt || 0) + 1;\n\t\t\tconst realm = / realm=\"([^\"]+)\"/i.exec(basicAuthHeader)?.[1];\n\t\t\textHostLogService.debug('ProxyResolver#lookupProxyAuthorization Basic authentication lookup', `proxyURL:${proxyURL}`, `realm:${realm}`);\n\t\t\tconst url = new URL(proxyURL);\n\t\t\tconst authInfo: AuthInfo = {\n\t\t\t\tscheme: 'basic',\n\t\t\t\thost: url.hostname,\n\t\t\t\tport: Number(url.port),\n\t\t\t\trealm: realm || '',\n\t\t\t\tisProxy: true,\n\t\t\t\tattempt: state.basicAuthAttempt,\n\t\t\t};\n\t\t\tconst credentials = await extHostWorkspace.lookupAuthorization(authInfo);\n\t\t\tif (credentials) {\n\t\t\t\textHostLogService.debug('ProxyResolver#lookupProxyAuthorization Basic authentication received credentials', `proxyURL:${proxyURL}`, `realm:${realm}`);\n\t\t\t\tconst auth = 'Basic ' + Buffer.from(`${credentials.username}:${credentials.password}`).toString('base64');\n\t\t\t\tbasicAuthCache[proxyURL] = auth;\n\t\t\t\treturn auth;\n\t\t\t} else {\n\t\t\t\textHostLogService.debug('ProxyResolver#lookupProxyAuthorization Basic authentication received no credentials', `proxyURL:${proxyURL}`, `realm:${realm}`);\n\t\t\t}\n\t\t} catch (err) {\n\t\t\textHostLogService.error('ProxyResolver#lookupProxyAuthorization Basic authentication failed', err);\n\t\t}\n\t}\n\treturn undefined;\n}\n\ntype ProxyAuthenticationClassification = {\n\towner: 'chrmarti';\n\tcomment: 'Data about proxy authentication requests';\n\tauthenticationType: { classification: 'PublicNonPersonalData'; purpose: 'FeatureInsight'; comment: 'Type of the authentication requested' };\n\textensionHostType: { classification: 'SystemMetaData'; purpose: 'FeatureInsight'; comment: 'Type of the extension host' };\n};\n\ntype ProxyAuthenticationEvent = {\n\tauthenticationType: string;\n\textensionHostType: string;\n};\n\nlet telemetrySent = false;\nconst enableProxyAuthenticationTelemetry = false;\nfunction sendTelemetry(mainThreadTelemetry: MainThreadTelemetryShape, authenticate: string[], isRemote: boolean) {\n\tif (!enableProxyAuthenticationTelemetry || telemetrySent || !authenticate.length) {\n\t\treturn;\n\t}\n\ttelemetrySent = true;\n\n\tmainThreadTelemetry.$publicLog2<ProxyAuthenticationEvent, ProxyAuthenticationClassification>('proxyAuthenticationRequest', {\n\t\tauthenticationType: authenticate.map(a => a.split(' ')[0]).join(','),\n\t\textensionHostType: isRemote ? 'remote' : 'local',\n\t});\n}\n\nfunction getExtHostConfigValue<T>(configProvider: ExtHostConfigProvider, isRemote: boolean, key: string, fallback: T): T;\nfunction getExtHostConfigValue<T>(configProvider: ExtHostConfigProvider, isRemote: boolean, key: string): T | undefined;\nfunction getExtHostConfigValue<T>(configProvider: ExtHostConfigProvider, isRemote: boolean, key: string, fallback?: T): T | undefined {\n\tif (isRemote) {\n\t\treturn configProvider.getConfiguration().get<T>(key) ?? fallback;\n\t}\n\tconst values: ConfigurationInspect<T> | undefined = configProvider.getConfiguration().inspect<T>(key);\n\treturn values?.globalLocalValue ?? values?.defaultValue ?? fallback;\n}\n"]}