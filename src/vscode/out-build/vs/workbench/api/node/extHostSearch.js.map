{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/api/node/extHostSearch.ts","vs/workbench/api/node/extHostSearch.ts"],"names":[],"mappings":"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","file":"extHostSearch.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { DisposableStore, IDisposable, toDisposable } from '../../../base/common/lifecycle.js';\nimport { Schemas } from '../../../base/common/network.js';\nimport { URI } from '../../../base/common/uri.js';\nimport * as pfs from '../../../base/node/pfs.js';\nimport { ILogService } from '../../../platform/log/common/log.js';\nimport { IExtHostConfiguration } from '../common/extHostConfiguration.js';\nimport { IExtHostInitDataService } from '../common/extHostInitDataService.js';\nimport { IExtHostRpcService } from '../common/extHostRpcService.js';\nimport { ExtHostSearch, reviveQuery } from '../common/extHostSearch.js';\nimport { IURITransformerService } from '../common/extHostUriTransformerService.js';\nimport { IFileQuery, IRawFileQuery, ISearchCompleteStats, ISerializedSearchProgressItem, isSerializedFileMatch, ITextQuery } from '../../services/search/common/search.js';\nimport { TextSearchManager } from '../../services/search/common/textSearchManager.js';\nimport { SearchService } from '../../services/search/node/rawSearchService.js';\nimport { RipgrepSearchProvider } from '../../services/search/node/ripgrepSearchProvider.js';\nimport { OutputChannel } from '../../services/search/node/ripgrepSearchUtils.js';\nimport { NativeTextSearchManager } from '../../services/search/node/textSearchManager.js';\nimport type * as vscode from 'vscode';\n\nexport class NativeExtHostSearch extends ExtHostSearch implements IDisposable {\n\n\tprotected _pfs: typeof pfs = pfs; // allow extending for tests\n\n\tprivate _internalFileSearchHandle: number = -1;\n\tprivate _internalFileSearchProvider: SearchService | null = null;\n\n\tprivate _registeredEHSearchProvider = false;\n\n\tprivate _numThreadsPromise: Promise<number | undefined> | undefined;\n\n\tprivate readonly _disposables = new DisposableStore();\n\n\tprivate isDisposed = false;\n\n\tconstructor(\n\t\t@IExtHostRpcService extHostRpc: IExtHostRpcService,\n\t\t@IExtHostInitDataService initData: IExtHostInitDataService,\n\t\t@IURITransformerService _uriTransformer: IURITransformerService,\n\t\t@IExtHostConfiguration private readonly configurationService: IExtHostConfiguration,\n\t\t@ILogService _logService: ILogService,\n\t) {\n\t\tsuper(extHostRpc, _uriTransformer, _logService);\n\t\tthis.getNumThreads = this.getNumThreads.bind(this);\n\t\tthis.getNumThreadsCached = this.getNumThreadsCached.bind(this);\n\t\tthis.handleConfigurationChanged = this.handleConfigurationChanged.bind(this);\n\t\tconst outputChannel = new OutputChannel('RipgrepSearchUD', this._logService);\n\t\tthis._disposables.add(this.registerTextSearchProvider(Schemas.vscodeUserData, new RipgrepSearchProvider(outputChannel, this.getNumThreadsCached)));\n\t\tif (initData.remote.isRemote && initData.remote.authority) {\n\t\t\tthis._registerEHSearchProviders();\n\t\t}\n\n\t\tconfigurationService.getConfigProvider().then(provider => {\n\t\t\tif (this.isDisposed) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis._disposables.add(provider.onDidChangeConfiguration(this.handleConfigurationChanged));\n\t\t});\n\t}\n\n\tprivate handleConfigurationChanged(event: vscode.ConfigurationChangeEvent) {\n\t\tif (!event.affectsConfiguration('search')) {\n\t\t\treturn;\n\t\t}\n\t\tthis._numThreadsPromise = undefined;\n\t}\n\n\tasync getNumThreads(): Promise<number | undefined> {\n\t\tconst configProvider = await this.configurationService.getConfigProvider();\n\t\tconst numThreads = configProvider.getConfiguration('search').get<number>('ripgrep.maxThreads');\n\t\treturn numThreads;\n\t}\n\n\tasync getNumThreadsCached(): Promise<number | undefined> {\n\t\tif (!this._numThreadsPromise) {\n\t\t\tthis._numThreadsPromise = this.getNumThreads();\n\t\t}\n\t\treturn this._numThreadsPromise;\n\t}\n\n\tdispose(): void {\n\t\tthis.isDisposed = true;\n\t\tthis._disposables.dispose();\n\t}\n\n\toverride $enableExtensionHostSearch(): void {\n\t\tthis._registerEHSearchProviders();\n\t}\n\n\tprivate _registerEHSearchProviders(): void {\n\t\tif (this._registeredEHSearchProvider) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._registeredEHSearchProvider = true;\n\t\tconst outputChannel = new OutputChannel('RipgrepSearchEH', this._logService);\n\t\tthis._disposables.add(this.registerTextSearchProvider(Schemas.file, new RipgrepSearchProvider(outputChannel, this.getNumThreadsCached)));\n\t\tthis._disposables.add(this.registerInternalFileSearchProvider(Schemas.file, new SearchService('fileSearchProvider', this.getNumThreadsCached)));\n\t}\n\n\tprivate registerInternalFileSearchProvider(scheme: string, provider: SearchService): IDisposable {\n\t\tconst handle = this._handlePool++;\n\t\tthis._internalFileSearchProvider = provider;\n\t\tthis._internalFileSearchHandle = handle;\n\t\tthis._proxy.$registerFileSearchProvider(handle, this._transformScheme(scheme));\n\t\treturn toDisposable(() => {\n\t\t\tthis._internalFileSearchProvider = null;\n\t\t\tthis._proxy.$unregisterProvider(handle);\n\t\t});\n\t}\n\n\toverride $provideFileSearchResults(handle: number, session: number, rawQuery: IRawFileQuery, token: vscode.CancellationToken): Promise<ISearchCompleteStats> {\n\t\tconst query = reviveQuery(rawQuery);\n\t\tif (handle === this._internalFileSearchHandle) {\n\t\t\tconst start = Date.now();\n\t\t\treturn this.doInternalFileSearch(handle, session, query, token).then(result => {\n\t\t\t\tconst elapsed = Date.now() - start;\n\t\t\t\tthis._logService.debug(`Ext host file search time: ${elapsed}ms`);\n\t\t\t\treturn result;\n\t\t\t});\n\t\t}\n\n\t\treturn super.$provideFileSearchResults(handle, session, rawQuery, token);\n\t}\n\n\toverride async doInternalFileSearchWithCustomCallback(rawQuery: IFileQuery, token: vscode.CancellationToken, handleFileMatch: (data: URI[]) => void): Promise<ISearchCompleteStats> {\n\t\tconst onResult = (ev: ISerializedSearchProgressItem) => {\n\t\t\tif (isSerializedFileMatch(ev)) {\n\t\t\t\tev = [ev];\n\t\t\t}\n\n\t\t\tif (Array.isArray(ev)) {\n\t\t\t\thandleFileMatch(ev.map(m => URI.file(m.path)));\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (ev.message) {\n\t\t\t\tthis._logService.debug('ExtHostSearch', ev.message);\n\t\t\t}\n\t\t};\n\n\t\tif (!this._internalFileSearchProvider) {\n\t\t\tthrow new Error('No internal file search handler');\n\t\t}\n\t\tconst numThreads = await this.getNumThreadsCached();\n\t\treturn <Promise<ISearchCompleteStats>>this._internalFileSearchProvider.doFileSearch(rawQuery, numThreads, onResult, token);\n\t}\n\n\tprivate async doInternalFileSearch(handle: number, session: number, rawQuery: IFileQuery, token: vscode.CancellationToken): Promise<ISearchCompleteStats> {\n\t\treturn this.doInternalFileSearchWithCustomCallback(rawQuery, token, (data) => {\n\t\t\tthis._proxy.$handleFileMatch(handle, session, data);\n\t\t});\n\t}\n\n\toverride $clearCache(cacheKey: string): Promise<void> {\n\t\tthis._internalFileSearchProvider?.clearCache(cacheKey);\n\n\t\treturn super.$clearCache(cacheKey);\n\t}\n\n\tprotected override createTextSearchManager(query: ITextQuery, provider: vscode.TextSearchProvider2): TextSearchManager {\n\t\treturn new NativeTextSearchManager(query, provider, undefined, 'textSearchProvider');\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { DisposableStore, IDisposable, toDisposable } from '../../../base/common/lifecycle.js';\nimport { Schemas } from '../../../base/common/network.js';\nimport { URI } from '../../../base/common/uri.js';\nimport * as pfs from '../../../base/node/pfs.js';\nimport { ILogService } from '../../../platform/log/common/log.js';\nimport { IExtHostConfiguration } from '../common/extHostConfiguration.js';\nimport { IExtHostInitDataService } from '../common/extHostInitDataService.js';\nimport { IExtHostRpcService } from '../common/extHostRpcService.js';\nimport { ExtHostSearch, reviveQuery } from '../common/extHostSearch.js';\nimport { IURITransformerService } from '../common/extHostUriTransformerService.js';\nimport { IFileQuery, IRawFileQuery, ISearchCompleteStats, ISerializedSearchProgressItem, isSerializedFileMatch, ITextQuery } from '../../services/search/common/search.js';\nimport { TextSearchManager } from '../../services/search/common/textSearchManager.js';\nimport { SearchService } from '../../services/search/node/rawSearchService.js';\nimport { RipgrepSearchProvider } from '../../services/search/node/ripgrepSearchProvider.js';\nimport { OutputChannel } from '../../services/search/node/ripgrepSearchUtils.js';\nimport { NativeTextSearchManager } from '../../services/search/node/textSearchManager.js';\nimport type * as vscode from 'vscode';\n\nexport class NativeExtHostSearch extends ExtHostSearch implements IDisposable {\n\n\tprotected _pfs: typeof pfs = pfs; // allow extending for tests\n\n\tprivate _internalFileSearchHandle: number = -1;\n\tprivate _internalFileSearchProvider: SearchService | null = null;\n\n\tprivate _registeredEHSearchProvider = false;\n\n\tprivate _numThreadsPromise: Promise<number | undefined> | undefined;\n\n\tprivate readonly _disposables = new DisposableStore();\n\n\tprivate isDisposed = false;\n\n\tconstructor(\n\t\t@IExtHostRpcService extHostRpc: IExtHostRpcService,\n\t\t@IExtHostInitDataService initData: IExtHostInitDataService,\n\t\t@IURITransformerService _uriTransformer: IURITransformerService,\n\t\t@IExtHostConfiguration private readonly configurationService: IExtHostConfiguration,\n\t\t@ILogService _logService: ILogService,\n\t) {\n\t\tsuper(extHostRpc, _uriTransformer, _logService);\n\t\tthis.getNumThreads = this.getNumThreads.bind(this);\n\t\tthis.getNumThreadsCached = this.getNumThreadsCached.bind(this);\n\t\tthis.handleConfigurationChanged = this.handleConfigurationChanged.bind(this);\n\t\tconst outputChannel = new OutputChannel('RipgrepSearchUD', this._logService);\n\t\tthis._disposables.add(this.registerTextSearchProvider(Schemas.vscodeUserData, new RipgrepSearchProvider(outputChannel, this.getNumThreadsCached)));\n\t\tif (initData.remote.isRemote && initData.remote.authority) {\n\t\t\tthis._registerEHSearchProviders();\n\t\t}\n\n\t\tconfigurationService.getConfigProvider().then(provider => {\n\t\t\tif (this.isDisposed) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis._disposables.add(provider.onDidChangeConfiguration(this.handleConfigurationChanged));\n\t\t});\n\t}\n\n\tprivate handleConfigurationChanged(event: vscode.ConfigurationChangeEvent) {\n\t\tif (!event.affectsConfiguration('search')) {\n\t\t\treturn;\n\t\t}\n\t\tthis._numThreadsPromise = undefined;\n\t}\n\n\tasync getNumThreads(): Promise<number | undefined> {\n\t\tconst configProvider = await this.configurationService.getConfigProvider();\n\t\tconst numThreads = configProvider.getConfiguration('search').get<number>('ripgrep.maxThreads');\n\t\treturn numThreads;\n\t}\n\n\tasync getNumThreadsCached(): Promise<number | undefined> {\n\t\tif (!this._numThreadsPromise) {\n\t\t\tthis._numThreadsPromise = this.getNumThreads();\n\t\t}\n\t\treturn this._numThreadsPromise;\n\t}\n\n\tdispose(): void {\n\t\tthis.isDisposed = true;\n\t\tthis._disposables.dispose();\n\t}\n\n\toverride $enableExtensionHostSearch(): void {\n\t\tthis._registerEHSearchProviders();\n\t}\n\n\tprivate _registerEHSearchProviders(): void {\n\t\tif (this._registeredEHSearchProvider) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._registeredEHSearchProvider = true;\n\t\tconst outputChannel = new OutputChannel('RipgrepSearchEH', this._logService);\n\t\tthis._disposables.add(this.registerTextSearchProvider(Schemas.file, new RipgrepSearchProvider(outputChannel, this.getNumThreadsCached)));\n\t\tthis._disposables.add(this.registerInternalFileSearchProvider(Schemas.file, new SearchService('fileSearchProvider', this.getNumThreadsCached)));\n\t}\n\n\tprivate registerInternalFileSearchProvider(scheme: string, provider: SearchService): IDisposable {\n\t\tconst handle = this._handlePool++;\n\t\tthis._internalFileSearchProvider = provider;\n\t\tthis._internalFileSearchHandle = handle;\n\t\tthis._proxy.$registerFileSearchProvider(handle, this._transformScheme(scheme));\n\t\treturn toDisposable(() => {\n\t\t\tthis._internalFileSearchProvider = null;\n\t\t\tthis._proxy.$unregisterProvider(handle);\n\t\t});\n\t}\n\n\toverride $provideFileSearchResults(handle: number, session: number, rawQuery: IRawFileQuery, token: vscode.CancellationToken): Promise<ISearchCompleteStats> {\n\t\tconst query = reviveQuery(rawQuery);\n\t\tif (handle === this._internalFileSearchHandle) {\n\t\t\tconst start = Date.now();\n\t\t\treturn this.doInternalFileSearch(handle, session, query, token).then(result => {\n\t\t\t\tconst elapsed = Date.now() - start;\n\t\t\t\tthis._logService.debug(`Ext host file search time: ${elapsed}ms`);\n\t\t\t\treturn result;\n\t\t\t});\n\t\t}\n\n\t\treturn super.$provideFileSearchResults(handle, session, rawQuery, token);\n\t}\n\n\toverride async doInternalFileSearchWithCustomCallback(rawQuery: IFileQuery, token: vscode.CancellationToken, handleFileMatch: (data: URI[]) => void): Promise<ISearchCompleteStats> {\n\t\tconst onResult = (ev: ISerializedSearchProgressItem) => {\n\t\t\tif (isSerializedFileMatch(ev)) {\n\t\t\t\tev = [ev];\n\t\t\t}\n\n\t\t\tif (Array.isArray(ev)) {\n\t\t\t\thandleFileMatch(ev.map(m => URI.file(m.path)));\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (ev.message) {\n\t\t\t\tthis._logService.debug('ExtHostSearch', ev.message);\n\t\t\t}\n\t\t};\n\n\t\tif (!this._internalFileSearchProvider) {\n\t\t\tthrow new Error('No internal file search handler');\n\t\t}\n\t\tconst numThreads = await this.getNumThreadsCached();\n\t\treturn <Promise<ISearchCompleteStats>>this._internalFileSearchProvider.doFileSearch(rawQuery, numThreads, onResult, token);\n\t}\n\n\tprivate async doInternalFileSearch(handle: number, session: number, rawQuery: IFileQuery, token: vscode.CancellationToken): Promise<ISearchCompleteStats> {\n\t\treturn this.doInternalFileSearchWithCustomCallback(rawQuery, token, (data) => {\n\t\t\tthis._proxy.$handleFileMatch(handle, session, data);\n\t\t});\n\t}\n\n\toverride $clearCache(cacheKey: string): Promise<void> {\n\t\tthis._internalFileSearchProvider?.clearCache(cacheKey);\n\n\t\treturn super.$clearCache(cacheKey);\n\t}\n\n\tprotected override createTextSearchManager(query: ITextQuery, provider: vscode.TextSearchProvider2): TextSearchManager {\n\t\treturn new NativeTextSearchManager(query, provider, undefined, 'textSearchProvider');\n\t}\n}\n"]}