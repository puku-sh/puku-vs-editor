{"version":3,"sources":["vs/workbench/api/node/extHostDebugService.ts"],"names":[],"mappings":"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","file":"extHostDebugService.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as vscode from 'vscode';\nimport { createCancelablePromise, disposableTimeout, firstParallel, RunOnceScheduler, timeout } from '../../../base/common/async.js';\nimport { DisposableStore, IDisposable } from '../../../base/common/lifecycle.js';\nimport * as platform from '../../../base/common/platform.js';\nimport * as nls from '../../../nls.js';\nimport { IExternalTerminalService } from '../../../platform/externalTerminal/common/externalTerminal.js';\nimport { LinuxExternalTerminalService, MacExternalTerminalService, WindowsExternalTerminalService } from '../../../platform/externalTerminal/node/externalTerminalService.js';\nimport { ISignService } from '../../../platform/sign/common/sign.js';\nimport { SignService } from '../../../platform/sign/node/signService.js';\nimport { AbstractDebugAdapter } from '../../contrib/debug/common/abstractDebugAdapter.js';\nimport { ExecutableDebugAdapter, NamedPipeDebugAdapter, SocketDebugAdapter } from '../../contrib/debug/node/debugAdapter.js';\nimport { hasChildProcesses, prepareCommand } from '../../contrib/debug/node/terminals.js';\nimport { ExtensionDescriptionRegistry } from '../../services/extensions/common/extensionDescriptionRegistry.js';\nimport { IExtHostCommands } from '../common/extHostCommands.js';\nimport { ExtHostConfigProvider, IExtHostConfiguration } from '../common/extHostConfiguration.js';\nimport { ExtHostDebugServiceBase, ExtHostDebugSession } from '../common/extHostDebugService.js';\nimport { IExtHostEditorTabs } from '../common/extHostEditorTabs.js';\nimport { IExtHostExtensionService } from '../common/extHostExtensionService.js';\nimport { IExtHostRpcService } from '../common/extHostRpcService.js';\nimport { IExtHostTerminalService } from '../common/extHostTerminalService.js';\nimport { IExtHostTesting } from '../common/extHostTesting.js';\nimport { DebugAdapterExecutable, DebugAdapterNamedPipeServer, DebugAdapterServer, ThemeIcon } from '../common/extHostTypes.js';\nimport { IExtHostVariableResolverProvider } from '../common/extHostVariableResolverService.js';\nimport { IExtHostWorkspace } from '../common/extHostWorkspace.js';\nimport { IExtHostTerminalShellIntegration } from '../common/extHostTerminalShellIntegration.js';\n\nexport class ExtHostDebugService extends ExtHostDebugServiceBase {\n\n\tprivate _integratedTerminalInstances = new DebugTerminalCollection();\n\tprivate _terminalDisposedListener: IDisposable | undefined;\n\n\tconstructor(\n\t\t@IExtHostRpcService extHostRpcService: IExtHostRpcService,\n\t\t@IExtHostWorkspace workspaceService: IExtHostWorkspace,\n\t\t@IExtHostExtensionService extensionService: IExtHostExtensionService,\n\t\t@IExtHostConfiguration configurationService: IExtHostConfiguration,\n\t\t@IExtHostTerminalService private _terminalService: IExtHostTerminalService,\n\t\t@IExtHostTerminalShellIntegration private _terminalShellIntegrationService: IExtHostTerminalShellIntegration,\n\t\t@IExtHostEditorTabs editorTabs: IExtHostEditorTabs,\n\t\t@IExtHostVariableResolverProvider variableResolver: IExtHostVariableResolverProvider,\n\t\t@IExtHostCommands commands: IExtHostCommands,\n\t\t@IExtHostTesting testing: IExtHostTesting,\n\t) {\n\t\tsuper(extHostRpcService, workspaceService, extensionService, configurationService, editorTabs, variableResolver, commands, testing);\n\t}\n\n\tprotected override createDebugAdapter(adapter: vscode.DebugAdapterDescriptor, session: ExtHostDebugSession): AbstractDebugAdapter | undefined {\n\t\tif (adapter instanceof DebugAdapterExecutable) {\n\t\t\treturn new ExecutableDebugAdapter(this.convertExecutableToDto(adapter), session.type);\n\t\t} else if (adapter instanceof DebugAdapterServer) {\n\t\t\treturn new SocketDebugAdapter(this.convertServerToDto(adapter));\n\t\t} else if (adapter instanceof DebugAdapterNamedPipeServer) {\n\t\t\treturn new NamedPipeDebugAdapter(this.convertPipeServerToDto(adapter));\n\t\t} else {\n\t\t\treturn super.createDebugAdapter(adapter, session);\n\t\t}\n\t}\n\n\tprotected override daExecutableFromPackage(session: ExtHostDebugSession, extensionRegistry: ExtensionDescriptionRegistry): DebugAdapterExecutable | undefined {\n\t\tconst dae = ExecutableDebugAdapter.platformAdapterExecutable(extensionRegistry.getAllExtensionDescriptions(), session.type);\n\t\tif (dae) {\n\t\t\treturn new DebugAdapterExecutable(dae.command, dae.args, dae.options);\n\t\t}\n\t\treturn undefined;\n\t}\n\n\tprotected override createSignService(): ISignService | undefined {\n\t\treturn new SignService();\n\t}\n\n\tpublic override async $runInTerminal(args: DebugProtocol.RunInTerminalRequestArguments, sessionId: string): Promise<number | undefined> {\n\n\t\tif (args.kind === 'integrated') {\n\n\t\t\tif (!this._terminalDisposedListener) {\n\t\t\t\t// React on terminal disposed and check if that is the debug terminal #12956\n\t\t\t\tthis._terminalDisposedListener = this._register(this._terminalService.onDidCloseTerminal(terminal => {\n\t\t\t\t\tthis._integratedTerminalInstances.onTerminalClosed(terminal);\n\t\t\t\t}));\n\t\t\t}\n\n\t\t\tconst configProvider = await this._configurationService.getConfigProvider();\n\t\t\tconst shell = this._terminalService.getDefaultShell(true);\n\t\t\tconst shellArgs = this._terminalService.getDefaultShellArgs(true);\n\n\t\t\tconst terminalName = args.title || nls.localize('debug.terminal.title', \"Debug Process\");\n\n\t\t\tconst shellConfig = JSON.stringify({ shell, shellArgs });\n\t\t\tlet terminal = await this._integratedTerminalInstances.checkout(shellConfig, terminalName);\n\n\t\t\tlet cwdForPrepareCommand: string | undefined;\n\t\t\tlet giveShellTimeToInitialize = false;\n\n\t\t\tif (!terminal) {\n\t\t\t\tconst options: vscode.TerminalOptions = {\n\t\t\t\t\tshellPath: shell,\n\t\t\t\t\tshellArgs: shellArgs,\n\t\t\t\t\tcwd: args.cwd,\n\t\t\t\t\tname: terminalName,\n\t\t\t\t\ticonPath: new ThemeIcon('debug'),\n\t\t\t\t};\n\t\t\t\tgiveShellTimeToInitialize = true;\n\t\t\t\tterminal = this._terminalService.createTerminalFromOptions(options, {\n\t\t\t\t\tisFeatureTerminal: true,\n\t\t\t\t\t// Since debug termnials are REPLs, we want shell integration to be enabled.\n\t\t\t\t\t// Ignore isFeatureTerminal when evaluating shell integration enablement.\n\t\t\t\t\tforceShellIntegration: true,\n\t\t\t\t\tuseShellEnvironment: true\n\t\t\t\t});\n\t\t\t\tthis._integratedTerminalInstances.insert(terminal, shellConfig);\n\n\t\t\t} else {\n\t\t\t\tcwdForPrepareCommand = args.cwd;\n\t\t\t}\n\n\t\t\tterminal.show(true);\n\n\t\t\tconst shellProcessId = await terminal.processId;\n\n\t\t\tif (giveShellTimeToInitialize) {\n\t\t\t\t// give a new terminal some time to initialize the shell (most recently, #228191)\n\t\t\t\t// - If shell integration is available, use that as a deterministic signal\n\t\t\t\t// - Debounce content being written to known when the prompt is available\n\t\t\t\t// - Give a longer timeout otherwise\n\t\t\t\tconst enum Timing {\n\t\t\t\t\tDataDebounce = 500,\n\t\t\t\t\tMaxDelay = 5000,\n\t\t\t\t}\n\n\t\t\t\tconst ds = new DisposableStore();\n\t\t\t\tawait new Promise<void>(resolve => {\n\t\t\t\t\tconst scheduler = ds.add(new RunOnceScheduler(resolve, Timing.DataDebounce));\n\t\t\t\t\tds.add(this._terminalService.onDidWriteTerminalData(e => {\n\t\t\t\t\t\tif (e.terminal === terminal) {\n\t\t\t\t\t\t\tscheduler.schedule();\n\t\t\t\t\t\t}\n\t\t\t\t\t}));\n\t\t\t\t\tds.add(this._terminalShellIntegrationService.onDidChangeTerminalShellIntegration(e => {\n\t\t\t\t\t\tif (e.terminal === terminal) {\n\t\t\t\t\t\t\tresolve();\n\t\t\t\t\t\t}\n\t\t\t\t\t}));\n\t\t\t\t\tds.add(disposableTimeout(resolve, Timing.MaxDelay));\n\t\t\t\t});\n\n\t\t\t\tds.dispose();\n\t\t\t} else {\n\t\t\t\tif (terminal.state.isInteractedWith && !terminal.shellIntegration) {\n\t\t\t\t\tterminal.sendText('\\u0003'); // Ctrl+C for #106743. Not part of the same command for #107969\n\t\t\t\t\tawait timeout(200); // mirroring https://github.com/microsoft/vscode/blob/c67ccc70ece5f472ec25464d3eeb874cfccee9f1/src/vs/workbench/contrib/terminal/browser/terminalInstance.ts#L852-L857\n\t\t\t\t}\n\n\t\t\t\tif (configProvider.getConfiguration('debug.terminal').get<boolean>('clearBeforeReusing')) {\n\t\t\t\t\t// clear terminal before reusing it\n\t\t\t\t\tlet clearCommand: string;\n\t\t\t\t\tif (shell.indexOf('powershell') >= 0 || shell.indexOf('pwsh') >= 0 || shell.indexOf('cmd.exe') >= 0) {\n\t\t\t\t\t\tclearCommand = 'cls';\n\t\t\t\t\t} else if (shell.indexOf('bash') >= 0) {\n\t\t\t\t\t\tclearCommand = 'clear';\n\t\t\t\t\t} else if (platform.isWindows) {\n\t\t\t\t\t\tclearCommand = 'cls';\n\t\t\t\t\t} else {\n\t\t\t\t\t\tclearCommand = 'clear';\n\t\t\t\t\t}\n\n\t\t\t\t\tif (terminal.shellIntegration) {\n\t\t\t\t\t\tconst ds = new DisposableStore();\n\t\t\t\t\t\tconst execution = terminal.shellIntegration.executeCommand(clearCommand);\n\t\t\t\t\t\tawait new Promise<void>(resolve => {\n\t\t\t\t\t\t\tds.add(this._terminalShellIntegrationService.onDidEndTerminalShellExecution(e => {\n\t\t\t\t\t\t\t\tif (e.execution === execution) {\n\t\t\t\t\t\t\t\t\tresolve();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}));\n\t\t\t\t\t\t\tds.add(disposableTimeout(resolve, 500)); // 500ms timeout to ensure we resolve\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\tds.dispose();\n\t\t\t\t\t} else {\n\t\t\t\t\t\tterminal.sendText(clearCommand);\n\t\t\t\t\t\tawait timeout(200); // add a small delay to ensure the command is processed, see #240953\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tconst command = prepareCommand(shell, args.args, !!args.argsCanBeInterpretedByShell, cwdForPrepareCommand, args.env);\n\n\t\t\tif (terminal.shellIntegration) {\n\t\t\t\tterminal.shellIntegration.executeCommand(command);\n\t\t\t} else {\n\t\t\t\tterminal.sendText(command);\n\t\t\t}\n\n\t\t\t// Mark terminal as unused when its session ends, see #112055\n\t\t\tconst sessionListener = this.onDidTerminateDebugSession(s => {\n\t\t\t\tif (s.id === sessionId) {\n\t\t\t\t\tthis._integratedTerminalInstances.free(terminal);\n\t\t\t\t\tsessionListener.dispose();\n\t\t\t\t}\n\t\t\t});\n\n\t\t\treturn shellProcessId;\n\n\t\t} else if (args.kind === 'external') {\n\t\t\treturn runInExternalTerminal(args, await this._configurationService.getConfigProvider());\n\t\t}\n\t\treturn super.$runInTerminal(args, sessionId);\n\t}\n}\n\nlet externalTerminalService: IExternalTerminalService | undefined = undefined;\n\nfunction runInExternalTerminal(args: DebugProtocol.RunInTerminalRequestArguments, configProvider: ExtHostConfigProvider): Promise<number | undefined> {\n\tif (!externalTerminalService) {\n\t\tif (platform.isWindows) {\n\t\t\texternalTerminalService = new WindowsExternalTerminalService();\n\t\t} else if (platform.isMacintosh) {\n\t\t\texternalTerminalService = new MacExternalTerminalService();\n\t\t} else if (platform.isLinux) {\n\t\t\texternalTerminalService = new LinuxExternalTerminalService();\n\t\t} else {\n\t\t\tthrow new Error('external terminals not supported on this platform');\n\t\t}\n\t}\n\tconst config = configProvider.getConfiguration('terminal');\n\treturn externalTerminalService.runInTerminal(args.title!, args.cwd, args.args, args.env || {}, config.external || {});\n}\n\nclass DebugTerminalCollection {\n\t/**\n\t * Delay before a new terminal is a candidate for reuse. See #71850\n\t */\n\tprivate static minUseDelay = 1000;\n\n\tprivate _terminalInstances = new Map<vscode.Terminal, { lastUsedAt: number; config: string }>();\n\n\tpublic async checkout(config: string, name: string, cleanupOthersByName = false) {\n\t\tconst entries = [...this._terminalInstances.entries()];\n\t\tconst promises = entries.map(([terminal, termInfo]) => createCancelablePromise(async ct => {\n\n\t\t\t// Only allow terminals that match the title.  See #123189\n\t\t\tif (terminal.name !== name) {\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tif (termInfo.lastUsedAt !== -1 && await hasChildProcesses(await terminal.processId)) {\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\t// important: date check and map operations must be synchronous\n\t\t\tconst now = Date.now();\n\t\t\tif (termInfo.lastUsedAt + DebugTerminalCollection.minUseDelay > now || ct.isCancellationRequested) {\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tif (termInfo.config !== config) {\n\t\t\t\tif (cleanupOthersByName) {\n\t\t\t\t\tterminal.dispose();\n\t\t\t\t}\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\ttermInfo.lastUsedAt = now;\n\t\t\treturn terminal;\n\t\t}));\n\n\t\treturn await firstParallel(promises, (t): t is vscode.Terminal => !!t);\n\t}\n\n\tpublic insert(terminal: vscode.Terminal, termConfig: string) {\n\t\tthis._terminalInstances.set(terminal, { lastUsedAt: Date.now(), config: termConfig });\n\t}\n\n\tpublic free(terminal: vscode.Terminal) {\n\t\tconst info = this._terminalInstances.get(terminal);\n\t\tif (info) {\n\t\t\tinfo.lastUsedAt = -1;\n\t\t}\n\t}\n\n\tpublic onTerminalClosed(terminal: vscode.Terminal) {\n\t\tthis._terminalInstances.delete(terminal);\n\t}\n}\n"]}