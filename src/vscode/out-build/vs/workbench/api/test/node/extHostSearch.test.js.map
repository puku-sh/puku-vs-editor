{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/api/test/node/extHostSearch.test.ts","vs/workbench/api/test/node/extHostSearch.test.ts"],"names":[],"mappings":"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","file":"extHostSearch.test.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport assert from 'assert';\nimport { mapArrayOrNot } from '../../../../base/common/arrays.js';\nimport { timeout } from '../../../../base/common/async.js';\nimport { CancellationTokenSource } from '../../../../base/common/cancellation.js';\nimport { isCancellationError } from '../../../../base/common/errors.js';\nimport { revive } from '../../../../base/common/marshalling.js';\nimport { joinPath } from '../../../../base/common/resources.js';\nimport { URI, UriComponents } from '../../../../base/common/uri.js';\nimport * as pfs from '../../../../base/node/pfs.js';\nimport { mock } from '../../../../base/test/common/mock.js';\nimport { ensureNoDisposablesAreLeakedInTestSuite } from '../../../../base/test/common/utils.js';\nimport { NullLogService } from '../../../../platform/log/common/log.js';\nimport { MainContext, MainThreadSearchShape } from '../../common/extHost.protocol.js';\nimport { ExtHostConfigProvider, IExtHostConfiguration } from '../../common/extHostConfiguration.js';\nimport { IExtHostInitDataService } from '../../common/extHostInitDataService.js';\nimport { Range } from '../../common/extHostTypes.js';\nimport { URITransformerService } from '../../common/extHostUriTransformerService.js';\nimport { NativeExtHostSearch } from '../../node/extHostSearch.js';\nimport { TestRPCProtocol } from '../common/testRPCProtocol.js';\nimport { IFileMatch, IFileQuery, IPatternInfo, IRawFileMatch2, ISearchCompleteStats, ISearchQuery, ITextQuery, QueryType, resultIsMatch } from '../../../services/search/common/search.js';\nimport { TextSearchManager } from '../../../services/search/common/textSearchManager.js';\nimport { NativeTextSearchManager } from '../../../services/search/node/textSearchManager.js';\nimport type * as vscode from 'vscode';\nimport { AISearchKeyword } from '../../../services/search/common/searchExtTypes.js';\n\nlet rpcProtocol: TestRPCProtocol;\nlet extHostSearch: NativeExtHostSearch;\n\nlet mockMainThreadSearch: MockMainThreadSearch;\nclass MockMainThreadSearch implements MainThreadSearchShape {\n\tlastHandle!: number;\n\n\tresults: Array<UriComponents | IRawFileMatch2> = [];\n\n\tkeywords: Array<AISearchKeyword> = [];\n\n\t$registerFileSearchProvider(handle: number, scheme: string): void {\n\t\tthis.lastHandle = handle;\n\t}\n\n\t$registerTextSearchProvider(handle: number, scheme: string): void {\n\t\tthis.lastHandle = handle;\n\t}\n\n\t$registerAITextSearchProvider(handle: number, scheme: string): void {\n\t\tthis.lastHandle = handle;\n\t}\n\n\t$unregisterProvider(handle: number): void {\n\t}\n\n\t$handleFileMatch(handle: number, session: number, data: UriComponents[]): void {\n\t\tthis.results.push(...data);\n\t}\n\n\t$handleTextMatch(handle: number, session: number, data: IRawFileMatch2[]): void {\n\t\tthis.results.push(...data);\n\t}\n\n\t$handleKeywordResult(handle: number, session: number, data: AISearchKeyword): void {\n\t\tthis.keywords.push(data);\n\t}\n\n\t$handleTelemetry(eventName: string, data: any): void {\n\t}\n\n\tdispose() {\n\t}\n}\n\nlet mockPFS: Partial<typeof pfs>;\n\nfunction extensionResultIsMatch(data: vscode.TextSearchResult): data is vscode.TextSearchMatch {\n\treturn !!(<vscode.TextSearchMatch>data).preview;\n}\n\nsuite('ExtHostSearch', () => {\n\tconst disposables = ensureNoDisposablesAreLeakedInTestSuite();\n\n\tasync function registerTestTextSearchProvider(provider: vscode.TextSearchProvider, scheme = 'file'): Promise<void> {\n\t\tdisposables.add(extHostSearch.registerTextSearchProviderOld(scheme, provider));\n\t\tawait rpcProtocol.sync();\n\t}\n\n\tasync function registerTestFileSearchProvider(provider: vscode.FileSearchProvider, scheme = 'file'): Promise<void> {\n\t\tdisposables.add(extHostSearch.registerFileSearchProviderOld(scheme, provider));\n\t\tawait rpcProtocol.sync();\n\t}\n\n\tasync function runFileSearch(query: IFileQuery, cancel = false): Promise<{ results: URI[]; stats: ISearchCompleteStats }> {\n\t\tlet stats: ISearchCompleteStats;\n\t\ttry {\n\t\t\tconst cancellation = new CancellationTokenSource();\n\t\t\tconst p = extHostSearch.$provideFileSearchResults(mockMainThreadSearch.lastHandle, 0, query, cancellation.token);\n\t\t\tif (cancel) {\n\t\t\t\tawait timeout(0);\n\t\t\t\tcancellation.cancel();\n\t\t\t}\n\n\t\t\tstats = await p;\n\t\t} catch (err) {\n\t\t\tif (!isCancellationError(err)) {\n\t\t\t\tawait rpcProtocol.sync();\n\t\t\t\tthrow err;\n\t\t\t}\n\t\t}\n\n\t\tawait rpcProtocol.sync();\n\t\treturn {\n\t\t\tresults: (<UriComponents[]>mockMainThreadSearch.results).map(r => URI.revive(r)),\n\t\t\tstats: stats!\n\t\t};\n\t}\n\n\tasync function runTextSearch(query: ITextQuery): Promise<{ results: IFileMatch[]; stats: ISearchCompleteStats }> {\n\t\tlet stats: ISearchCompleteStats;\n\t\ttry {\n\t\t\tconst cancellation = new CancellationTokenSource();\n\t\t\tconst p = extHostSearch.$provideTextSearchResults(mockMainThreadSearch.lastHandle, 0, query, cancellation.token);\n\n\t\t\tstats = await p;\n\t\t} catch (err) {\n\t\t\tif (!isCancellationError(err)) {\n\t\t\t\tawait rpcProtocol.sync();\n\t\t\t\tthrow err;\n\t\t\t}\n\t\t}\n\n\t\tawait rpcProtocol.sync();\n\t\tconst results: IFileMatch[] = revive(<IRawFileMatch2[]>mockMainThreadSearch.results);\n\n\t\treturn { results, stats: stats! };\n\t}\n\n\tsetup(() => {\n\t\trpcProtocol = new TestRPCProtocol();\n\n\t\tmockMainThreadSearch = new MockMainThreadSearch();\n\t\tconst logService = new NullLogService();\n\n\t\trpcProtocol.set(MainContext.MainThreadSearch, mockMainThreadSearch);\n\n\t\tmockPFS = {};\n\t\textHostSearch = disposables.add(new class extends NativeExtHostSearch {\n\t\t\tconstructor() {\n\t\t\t\tsuper(\n\t\t\t\t\trpcProtocol,\n\t\t\t\t\tnew class extends mock<IExtHostInitDataService>() { override remote = { isRemote: false, authority: undefined, connectionData: null }; },\n\t\t\t\t\tnew URITransformerService(null),\n\t\t\t\t\tnew class extends mock<IExtHostConfiguration>() {\n\t\t\t\t\t\toverride async getConfigProvider(): Promise<ExtHostConfigProvider> {\n\t\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\t\tonDidChangeConfiguration(_listener: (event: vscode.ConfigurationChangeEvent) => void) { },\n\t\t\t\t\t\t\t\tgetConfiguration(): vscode.WorkspaceConfiguration {\n\t\t\t\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\t\t\t\tget() { },\n\t\t\t\t\t\t\t\t\t\thas() {\n\t\t\t\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\tinspect() {\n\t\t\t\t\t\t\t\t\t\t\treturn undefined;\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\tasync update() { }\n\t\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\t},\n\n\t\t\t\t\t\t\t} as ExtHostConfigProvider;\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tlogService\n\t\t\t\t);\n\t\t\t\t// eslint-disable-next-line local/code-no-any-casts\n\t\t\t\tthis._pfs = mockPFS as any;\n\t\t\t}\n\n\t\t\tprotected override createTextSearchManager(query: ITextQuery, provider: vscode.TextSearchProvider2): TextSearchManager {\n\t\t\t\treturn new NativeTextSearchManager(query, provider, this._pfs);\n\t\t\t}\n\t\t});\n\t});\n\n\tteardown(() => {\n\t\treturn rpcProtocol.sync();\n\t});\n\n\tconst rootFolderA = URI.file('/foo/bar1');\n\tconst rootFolderB = URI.file('/foo/bar2');\n\tconst fancyScheme = 'fancy';\n\tconst fancySchemeFolderA = URI.from({ scheme: fancyScheme, path: '/project/folder1' });\n\n\tsuite('File:', () => {\n\n\t\tfunction getSimpleQuery(filePattern = ''): IFileQuery {\n\t\t\treturn {\n\t\t\t\ttype: QueryType.File,\n\n\t\t\t\tfilePattern,\n\t\t\t\tfolderQueries: [\n\t\t\t\t\t{ folder: rootFolderA }\n\t\t\t\t]\n\t\t\t};\n\t\t}\n\n\t\tfunction compareURIs(actual: URI[], expected: URI[]) {\n\t\t\tconst sortAndStringify = (arr: URI[]) => arr.sort().map(u => u.toString());\n\n\t\t\tassert.deepStrictEqual(\n\t\t\t\tsortAndStringify(actual),\n\t\t\t\tsortAndStringify(expected));\n\t\t}\n\n\t\ttest('no results', async () => {\n\t\t\tawait registerTestFileSearchProvider({\n\t\t\t\tprovideFileSearchResults(query: vscode.FileSearchQuery, options: vscode.FileSearchOptions, token: vscode.CancellationToken): Promise<URI[]> {\n\t\t\t\t\treturn Promise.resolve(null!);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tconst { results, stats } = await runFileSearch(getSimpleQuery());\n\t\t\tassert(!stats.limitHit);\n\t\t\tassert(!results.length);\n\t\t});\n\n\t\ttest('simple results', async () => {\n\t\t\tconst reportedResults = [\n\t\t\t\tjoinPath(rootFolderA, 'file1.ts'),\n\t\t\t\tjoinPath(rootFolderA, 'file2.ts'),\n\t\t\t\tjoinPath(rootFolderA, 'subfolder/file3.ts')\n\t\t\t];\n\n\t\t\tawait registerTestFileSearchProvider({\n\t\t\t\tprovideFileSearchResults(query: vscode.FileSearchQuery, options: vscode.FileSearchOptions, token: vscode.CancellationToken): Promise<URI[]> {\n\t\t\t\t\treturn Promise.resolve(reportedResults);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tconst { results, stats } = await runFileSearch(getSimpleQuery());\n\t\t\tassert(!stats.limitHit);\n\t\t\tassert.strictEqual(results.length, 3);\n\t\t\tcompareURIs(results, reportedResults);\n\t\t});\n\n\t\ttest('Search canceled', async () => {\n\t\t\tlet cancelRequested = false;\n\t\t\tawait registerTestFileSearchProvider({\n\t\t\t\tprovideFileSearchResults(query: vscode.FileSearchQuery, options: vscode.FileSearchOptions, token: vscode.CancellationToken): Promise<URI[]> {\n\n\t\t\t\t\treturn new Promise((resolve, reject) => {\n\t\t\t\t\t\tfunction onCancel() {\n\t\t\t\t\t\t\tcancelRequested = true;\n\n\t\t\t\t\t\t\tresolve([joinPath(options.folder, 'file1.ts')]); // or reject or nothing?\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (token.isCancellationRequested) {\n\t\t\t\t\t\t\tonCancel();\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tdisposables.add(token.onCancellationRequested(() => onCancel()));\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tconst { results } = await runFileSearch(getSimpleQuery(), true);\n\t\t\tassert(cancelRequested);\n\t\t\tassert(!results.length);\n\t\t});\n\n\t\ttest('session cancellation should work', async () => {\n\t\t\tlet numSessionCancelled = 0;\n\t\t\tconst disposables: (vscode.Disposable | undefined)[] = [];\n\t\t\tawait registerTestFileSearchProvider({\n\t\t\t\tprovideFileSearchResults(query: vscode.FileSearchQuery, options: vscode.FileSearchOptions, token: vscode.CancellationToken): Promise<URI[]> {\n\n\t\t\t\t\tdisposables.push(options.session?.onCancellationRequested(() => {\n\t\t\t\t\t\tnumSessionCancelled++;\n\t\t\t\t\t}));\n\n\t\t\t\t\treturn Promise.resolve([]);\n\t\t\t\t}\n\t\t\t});\n\n\n\t\t\tawait runFileSearch({ ...getSimpleQuery(), cacheKey: '1' }, true);\n\t\t\tawait runFileSearch({ ...getSimpleQuery(), cacheKey: '2' }, true);\n\t\t\textHostSearch.$clearCache('1');\n\t\t\tassert.strictEqual(numSessionCancelled, 1);\n\t\t\tdisposables.forEach(d => d?.dispose());\n\t\t});\n\n\t\ttest('provider returns null', async () => {\n\t\t\tawait registerTestFileSearchProvider({\n\t\t\t\tprovideFileSearchResults(query: vscode.FileSearchQuery, options: vscode.FileSearchOptions, token: vscode.CancellationToken): Promise<URI[]> {\n\t\t\t\t\treturn null!;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\ttry {\n\t\t\t\tawait runFileSearch(getSimpleQuery());\n\t\t\t\tassert(false, 'Expected to fail');\n\t\t\t} catch {\n\t\t\t\t// Expected to throw\n\t\t\t}\n\t\t});\n\n\t\ttest('all provider calls get global include/excludes', async () => {\n\t\t\tawait registerTestFileSearchProvider({\n\t\t\t\tprovideFileSearchResults(query: vscode.FileSearchQuery, options: vscode.FileSearchOptions, token: vscode.CancellationToken): Promise<URI[]> {\n\t\t\t\t\tassert(options.excludes.length === 2 && options.includes.length === 2, 'Missing global include/excludes');\n\t\t\t\t\treturn Promise.resolve(null!);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tconst query: ISearchQuery = {\n\t\t\t\ttype: QueryType.File,\n\n\t\t\t\tfilePattern: '',\n\t\t\t\tincludePattern: {\n\t\t\t\t\t'foo': true,\n\t\t\t\t\t'bar': true\n\t\t\t\t},\n\t\t\t\texcludePattern: {\n\t\t\t\t\t'something': true,\n\t\t\t\t\t'else': true\n\t\t\t\t},\n\t\t\t\tfolderQueries: [\n\t\t\t\t\t{ folder: rootFolderA },\n\t\t\t\t\t{ folder: rootFolderB }\n\t\t\t\t]\n\t\t\t};\n\n\t\t\tawait runFileSearch(query);\n\t\t});\n\n\t\ttest('global/local include/excludes combined', async () => {\n\t\t\tawait registerTestFileSearchProvider({\n\t\t\t\tprovideFileSearchResults(query: vscode.FileSearchQuery, options: vscode.FileSearchOptions, token: vscode.CancellationToken): Promise<URI[]> {\n\t\t\t\t\tif (options.folder.toString() === rootFolderA.toString()) {\n\t\t\t\t\t\tassert.deepStrictEqual(options.includes.sort(), ['*.ts', 'foo']);\n\t\t\t\t\t\tassert.deepStrictEqual(options.excludes.sort(), ['*.js', 'bar']);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tassert.deepStrictEqual(options.includes.sort(), ['*.ts']);\n\t\t\t\t\t\tassert.deepStrictEqual(options.excludes.sort(), ['*.js']);\n\t\t\t\t\t}\n\n\t\t\t\t\treturn Promise.resolve(null!);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tconst query: ISearchQuery = {\n\t\t\t\ttype: QueryType.File,\n\n\t\t\t\tfilePattern: '',\n\t\t\t\tincludePattern: {\n\t\t\t\t\t'*.ts': true\n\t\t\t\t},\n\t\t\t\texcludePattern: {\n\t\t\t\t\t'*.js': true\n\t\t\t\t},\n\t\t\t\tfolderQueries: [\n\t\t\t\t\t{\n\t\t\t\t\t\tfolder: rootFolderA,\n\t\t\t\t\t\tincludePattern: {\n\t\t\t\t\t\t\t'foo': true\n\t\t\t\t\t\t},\n\t\t\t\t\t\texcludePattern: [{\n\t\t\t\t\t\t\tpattern: {\n\t\t\t\t\t\t\t\t'bar': true\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}]\n\t\t\t\t\t},\n\t\t\t\t\t{ folder: rootFolderB }\n\t\t\t\t]\n\t\t\t};\n\n\t\t\tawait runFileSearch(query);\n\t\t});\n\n\t\ttest('include/excludes resolved correctly', async () => {\n\t\t\tawait registerTestFileSearchProvider({\n\t\t\t\tprovideFileSearchResults(query: vscode.FileSearchQuery, options: vscode.FileSearchOptions, token: vscode.CancellationToken): Promise<URI[]> {\n\t\t\t\t\tassert.deepStrictEqual(options.includes.sort(), ['*.jsx', '*.ts']);\n\t\t\t\t\tassert.deepStrictEqual(options.excludes.sort(), []);\n\n\t\t\t\t\treturn Promise.resolve(null!);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tconst query: ISearchQuery = {\n\t\t\t\ttype: QueryType.File,\n\n\t\t\t\tfilePattern: '',\n\t\t\t\tincludePattern: {\n\t\t\t\t\t'*.ts': true,\n\t\t\t\t\t'*.jsx': false\n\t\t\t\t},\n\t\t\t\texcludePattern: {\n\t\t\t\t\t'*.js': true,\n\t\t\t\t\t'*.tsx': false\n\t\t\t\t},\n\t\t\t\tfolderQueries: [\n\t\t\t\t\t{\n\t\t\t\t\t\tfolder: rootFolderA,\n\t\t\t\t\t\tincludePattern: {\n\t\t\t\t\t\t\t'*.jsx': true\n\t\t\t\t\t\t},\n\t\t\t\t\t\texcludePattern: [{\n\t\t\t\t\t\t\tpattern: {\n\t\t\t\t\t\t\t\t'*.js': false\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}]\n\t\t\t\t\t}\n\t\t\t\t]\n\t\t\t};\n\n\t\t\tawait runFileSearch(query);\n\t\t});\n\n\t\ttest('basic sibling exclude clause', async () => {\n\t\t\tconst reportedResults = [\n\t\t\t\t'file1.ts',\n\t\t\t\t'file1.js',\n\t\t\t];\n\n\t\t\tawait registerTestFileSearchProvider({\n\t\t\t\tprovideFileSearchResults(query: vscode.FileSearchQuery, options: vscode.FileSearchOptions, token: vscode.CancellationToken): Promise<URI[]> {\n\t\t\t\t\treturn Promise.resolve(reportedResults\n\t\t\t\t\t\t.map(relativePath => joinPath(options.folder, relativePath)));\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tconst query: ISearchQuery = {\n\t\t\t\ttype: QueryType.File,\n\n\t\t\t\tfilePattern: '',\n\t\t\t\texcludePattern: {\n\t\t\t\t\t'*.js': {\n\t\t\t\t\t\twhen: '$(basename).ts'\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tfolderQueries: [\n\t\t\t\t\t{ folder: rootFolderA }\n\t\t\t\t]\n\t\t\t};\n\n\t\t\tconst { results } = await runFileSearch(query);\n\t\t\tcompareURIs(\n\t\t\t\tresults,\n\t\t\t\t[\n\t\t\t\t\tjoinPath(rootFolderA, 'file1.ts')\n\t\t\t\t]);\n\t\t});\n\n\t\t// https://github.com/microsoft/vscode-remotehub/issues/255\n\t\ttest('include, sibling exclude, and subfolder', async () => {\n\t\t\tconst reportedResults = [\n\t\t\t\t'foo/file1.ts',\n\t\t\t\t'foo/file1.js',\n\t\t\t];\n\n\t\t\tawait registerTestFileSearchProvider({\n\t\t\t\tprovideFileSearchResults(query: vscode.FileSearchQuery, options: vscode.FileSearchOptions, token: vscode.CancellationToken): Promise<URI[]> {\n\t\t\t\t\treturn Promise.resolve(reportedResults\n\t\t\t\t\t\t.map(relativePath => joinPath(options.folder, relativePath)));\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tconst query: ISearchQuery = {\n\t\t\t\ttype: QueryType.File,\n\n\t\t\t\tfilePattern: '',\n\t\t\t\tincludePattern: { '**/*.ts': true },\n\t\t\t\texcludePattern: {\n\t\t\t\t\t'*.js': {\n\t\t\t\t\t\twhen: '$(basename).ts'\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tfolderQueries: [\n\t\t\t\t\t{ folder: rootFolderA }\n\t\t\t\t]\n\t\t\t};\n\n\t\t\tconst { results } = await runFileSearch(query);\n\t\t\tcompareURIs(\n\t\t\t\tresults,\n\t\t\t\t[\n\t\t\t\t\tjoinPath(rootFolderA, 'foo/file1.ts')\n\t\t\t\t]);\n\t\t});\n\n\t\ttest('multiroot sibling exclude clause', async () => {\n\n\t\t\tawait registerTestFileSearchProvider({\n\t\t\t\tprovideFileSearchResults(query: vscode.FileSearchQuery, options: vscode.FileSearchOptions, token: vscode.CancellationToken): Promise<URI[]> {\n\t\t\t\t\tlet reportedResults: URI[];\n\t\t\t\t\tif (options.folder.fsPath === rootFolderA.fsPath) {\n\t\t\t\t\t\treportedResults = [\n\t\t\t\t\t\t\t'folder/fileA.scss',\n\t\t\t\t\t\t\t'folder/fileA.css',\n\t\t\t\t\t\t\t'folder/file2.css'\n\t\t\t\t\t\t].map(relativePath => joinPath(rootFolderA, relativePath));\n\t\t\t\t\t} else {\n\t\t\t\t\t\treportedResults = [\n\t\t\t\t\t\t\t'fileB.ts',\n\t\t\t\t\t\t\t'fileB.js',\n\t\t\t\t\t\t\t'file3.js'\n\t\t\t\t\t\t].map(relativePath => joinPath(rootFolderB, relativePath));\n\t\t\t\t\t}\n\n\t\t\t\t\treturn Promise.resolve(reportedResults);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tconst query: ISearchQuery = {\n\t\t\t\ttype: QueryType.File,\n\n\t\t\t\tfilePattern: '',\n\t\t\t\texcludePattern: {\n\t\t\t\t\t'*.js': {\n\t\t\t\t\t\twhen: '$(basename).ts'\n\t\t\t\t\t},\n\t\t\t\t\t'*.css': true\n\t\t\t\t},\n\t\t\t\tfolderQueries: [\n\t\t\t\t\t{\n\t\t\t\t\t\tfolder: rootFolderA,\n\t\t\t\t\t\texcludePattern: [{\n\t\t\t\t\t\t\tpattern: {\n\t\t\t\t\t\t\t\t'folder/*.css': {\n\t\t\t\t\t\t\t\t\twhen: '$(basename).scss'\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}]\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tfolder: rootFolderB,\n\t\t\t\t\t\texcludePattern: [{\n\t\t\t\t\t\t\tpattern: {\n\t\t\t\t\t\t\t\t'*.js': false\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}]\n\t\t\t\t\t}\n\t\t\t\t]\n\t\t\t};\n\n\t\t\tconst { results } = await runFileSearch(query);\n\t\t\tcompareURIs(\n\t\t\t\tresults,\n\t\t\t\t[\n\t\t\t\t\tjoinPath(rootFolderA, 'folder/fileA.scss'),\n\t\t\t\t\tjoinPath(rootFolderA, 'folder/file2.css'),\n\n\t\t\t\t\tjoinPath(rootFolderB, 'fileB.ts'),\n\t\t\t\t\tjoinPath(rootFolderB, 'fileB.js'),\n\t\t\t\t\tjoinPath(rootFolderB, 'file3.js'),\n\t\t\t\t]);\n\t\t});\n\n\t\ttest('max results = 1', async () => {\n\t\t\tconst reportedResults = [\n\t\t\t\tjoinPath(rootFolderA, 'file1.ts'),\n\t\t\t\tjoinPath(rootFolderA, 'file2.ts'),\n\t\t\t\tjoinPath(rootFolderA, 'file3.ts'),\n\t\t\t];\n\n\t\t\tlet wasCanceled = false;\n\t\t\tawait registerTestFileSearchProvider({\n\t\t\t\tprovideFileSearchResults(query: vscode.FileSearchQuery, options: vscode.FileSearchOptions, token: vscode.CancellationToken): Promise<URI[]> {\n\t\t\t\t\tdisposables.add(token.onCancellationRequested(() => wasCanceled = true));\n\n\t\t\t\t\treturn Promise.resolve(reportedResults);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tconst query: ISearchQuery = {\n\t\t\t\ttype: QueryType.File,\n\n\t\t\t\tfilePattern: '',\n\t\t\t\tmaxResults: 1,\n\n\t\t\t\tfolderQueries: [\n\t\t\t\t\t{\n\t\t\t\t\t\tfolder: rootFolderA\n\t\t\t\t\t}\n\t\t\t\t]\n\t\t\t};\n\n\t\t\tconst { results, stats } = await runFileSearch(query);\n\t\t\tassert(stats.limitHit, 'Expected to return limitHit');\n\t\t\tassert.strictEqual(results.length, 1);\n\t\t\tcompareURIs(results, reportedResults.slice(0, 1));\n\t\t\tassert(wasCanceled, 'Expected to be canceled when hitting limit');\n\t\t});\n\n\t\ttest('max results = 2', async () => {\n\t\t\tconst reportedResults = [\n\t\t\t\tjoinPath(rootFolderA, 'file1.ts'),\n\t\t\t\tjoinPath(rootFolderA, 'file2.ts'),\n\t\t\t\tjoinPath(rootFolderA, 'file3.ts'),\n\t\t\t];\n\n\t\t\tlet wasCanceled = false;\n\t\t\tawait registerTestFileSearchProvider({\n\t\t\t\tprovideFileSearchResults(query: vscode.FileSearchQuery, options: vscode.FileSearchOptions, token: vscode.CancellationToken): Promise<URI[]> {\n\t\t\t\t\tdisposables.add(token.onCancellationRequested(() => wasCanceled = true));\n\n\t\t\t\t\treturn Promise.resolve(reportedResults);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tconst query: ISearchQuery = {\n\t\t\t\ttype: QueryType.File,\n\n\t\t\t\tfilePattern: '',\n\t\t\t\tmaxResults: 2,\n\n\t\t\t\tfolderQueries: [\n\t\t\t\t\t{\n\t\t\t\t\t\tfolder: rootFolderA\n\t\t\t\t\t}\n\t\t\t\t]\n\t\t\t};\n\n\t\t\tconst { results, stats } = await runFileSearch(query);\n\t\t\tassert(stats.limitHit, 'Expected to return limitHit');\n\t\t\tassert.strictEqual(results.length, 2);\n\t\t\tcompareURIs(results, reportedResults.slice(0, 2));\n\t\t\tassert(wasCanceled, 'Expected to be canceled when hitting limit');\n\t\t});\n\n\t\ttest('provider returns maxResults exactly', async () => {\n\t\t\tconst reportedResults = [\n\t\t\t\tjoinPath(rootFolderA, 'file1.ts'),\n\t\t\t\tjoinPath(rootFolderA, 'file2.ts'),\n\t\t\t];\n\n\t\t\tlet wasCanceled = false;\n\t\t\tawait registerTestFileSearchProvider({\n\t\t\t\tprovideFileSearchResults(query: vscode.FileSearchQuery, options: vscode.FileSearchOptions, token: vscode.CancellationToken): Promise<URI[]> {\n\t\t\t\t\tdisposables.add(token.onCancellationRequested(() => wasCanceled = true));\n\n\t\t\t\t\treturn Promise.resolve(reportedResults);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tconst query: ISearchQuery = {\n\t\t\t\ttype: QueryType.File,\n\n\t\t\t\tfilePattern: '',\n\t\t\t\tmaxResults: 2,\n\n\t\t\t\tfolderQueries: [\n\t\t\t\t\t{\n\t\t\t\t\t\tfolder: rootFolderA\n\t\t\t\t\t}\n\t\t\t\t]\n\t\t\t};\n\n\t\t\tconst { results, stats } = await runFileSearch(query);\n\t\t\tassert(!stats.limitHit, 'Expected not to return limitHit');\n\t\t\tassert.strictEqual(results.length, 2);\n\t\t\tcompareURIs(results, reportedResults);\n\t\t\tassert(!wasCanceled, 'Expected not to be canceled when just reaching limit');\n\t\t});\n\n\t\ttest('multiroot max results', async () => {\n\t\t\tlet cancels = 0;\n\t\t\tawait registerTestFileSearchProvider({\n\t\t\t\tasync provideFileSearchResults(query: vscode.FileSearchQuery, options: vscode.FileSearchOptions, token: vscode.CancellationToken): Promise<URI[]> {\n\t\t\t\t\tdisposables.add(token.onCancellationRequested(() => cancels++));\n\n\t\t\t\t\t// Provice results async so it has a chance to invoke every provider\n\t\t\t\t\tawait new Promise(r => process.nextTick(r));\n\t\t\t\t\treturn [\n\t\t\t\t\t\t'file1.ts',\n\t\t\t\t\t\t'file2.ts',\n\t\t\t\t\t\t'file3.ts',\n\t\t\t\t\t].map(relativePath => joinPath(options.folder, relativePath));\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tconst query: ISearchQuery = {\n\t\t\t\ttype: QueryType.File,\n\n\t\t\t\tfilePattern: '',\n\t\t\t\tmaxResults: 2,\n\n\t\t\t\tfolderQueries: [\n\t\t\t\t\t{\n\t\t\t\t\t\tfolder: rootFolderA\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tfolder: rootFolderB\n\t\t\t\t\t}\n\t\t\t\t]\n\t\t\t};\n\n\t\t\tconst { results } = await runFileSearch(query);\n\t\t\tassert.strictEqual(results.length, 2); // Don't care which 2 we got\n\t\t\tassert.strictEqual(cancels, 2, 'Expected all invocations to be canceled when hitting limit');\n\t\t});\n\n\t\ttest('works with non-file schemes', async () => {\n\t\t\tconst reportedResults = [\n\t\t\t\tjoinPath(fancySchemeFolderA, 'file1.ts'),\n\t\t\t\tjoinPath(fancySchemeFolderA, 'file2.ts'),\n\t\t\t\tjoinPath(fancySchemeFolderA, 'subfolder/file3.ts'),\n\n\t\t\t];\n\n\t\t\tawait registerTestFileSearchProvider({\n\t\t\t\tprovideFileSearchResults(query: vscode.FileSearchQuery, options: vscode.FileSearchOptions, token: vscode.CancellationToken): Promise<URI[]> {\n\t\t\t\t\treturn Promise.resolve(reportedResults);\n\t\t\t\t}\n\t\t\t}, fancyScheme);\n\n\t\t\tconst query: ISearchQuery = {\n\t\t\t\ttype: QueryType.File,\n\t\t\t\tfilePattern: '',\n\t\t\t\tfolderQueries: [\n\t\t\t\t\t{\n\t\t\t\t\t\tfolder: fancySchemeFolderA\n\t\t\t\t\t}\n\t\t\t\t]\n\t\t\t};\n\n\t\t\tconst { results } = await runFileSearch(query);\n\t\t\tcompareURIs(results, reportedResults);\n\t\t});\n\t\ttest('if onlyFileScheme is set, do not call custom schemes', async () => {\n\t\t\tlet fancySchemeCalled = false;\n\t\t\tawait registerTestFileSearchProvider({\n\t\t\t\tprovideFileSearchResults(query: vscode.FileSearchQuery, options: vscode.FileSearchOptions, token: vscode.CancellationToken): Promise<URI[]> {\n\t\t\t\t\tfancySchemeCalled = true;\n\t\t\t\t\treturn Promise.resolve([]);\n\t\t\t\t}\n\t\t\t}, fancyScheme);\n\n\t\t\tconst query: ISearchQuery = {\n\t\t\t\ttype: QueryType.File,\n\t\t\t\tfilePattern: '',\n\t\t\t\tfolderQueries: []\n\t\t\t};\n\n\t\t\tawait runFileSearch(query);\n\t\t\tassert(!fancySchemeCalled);\n\t\t});\n\t});\n\n\tsuite('Text:', () => {\n\n\t\tfunction makePreview(text: string): vscode.TextSearchMatch['preview'] {\n\t\t\treturn {\n\t\t\t\tmatches: [new Range(0, 0, 0, text.length)],\n\t\t\t\ttext\n\t\t\t};\n\t\t}\n\n\t\tfunction makeTextResult(baseFolder: URI, relativePath: string): vscode.TextSearchMatch {\n\t\t\treturn {\n\t\t\t\tpreview: makePreview('foo'),\n\t\t\t\tranges: [new Range(0, 0, 0, 3)],\n\t\t\t\turi: joinPath(baseFolder, relativePath)\n\t\t\t};\n\t\t}\n\n\t\tfunction getSimpleQuery(queryText: string): ITextQuery {\n\t\t\treturn {\n\t\t\t\ttype: QueryType.Text,\n\t\t\t\tcontentPattern: getPattern(queryText),\n\n\t\t\t\tfolderQueries: [\n\t\t\t\t\t{ folder: rootFolderA }\n\t\t\t\t]\n\t\t\t};\n\t\t}\n\n\t\tfunction getPattern(queryText: string): IPatternInfo {\n\t\t\treturn {\n\t\t\t\tpattern: queryText\n\t\t\t};\n\t\t}\n\n\t\tfunction assertResults(actual: IFileMatch[], expected: vscode.TextSearchResult[]) {\n\t\t\tconst actualTextSearchResults: vscode.TextSearchResult[] = [];\n\t\t\tfor (const fileMatch of actual) {\n\t\t\t\t// Make relative\n\t\t\t\tfor (const lineResult of fileMatch.results!) {\n\t\t\t\t\tif (resultIsMatch(lineResult)) {\n\t\t\t\t\t\tactualTextSearchResults.push({\n\t\t\t\t\t\t\tpreview: {\n\t\t\t\t\t\t\t\ttext: lineResult.previewText,\n\t\t\t\t\t\t\t\tmatches: mapArrayOrNot(\n\t\t\t\t\t\t\t\t\tlineResult.rangeLocations.map(r => r.preview),\n\t\t\t\t\t\t\t\t\tm => new Range(m.startLineNumber, m.startColumn, m.endLineNumber, m.endColumn))\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tranges: mapArrayOrNot(\n\t\t\t\t\t\t\t\tlineResult.rangeLocations.map(r => r.source),\n\t\t\t\t\t\t\t\tr => new Range(r.startLineNumber, r.startColumn, r.endLineNumber, r.endColumn),\n\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\turi: fileMatch.resource\n\t\t\t\t\t\t});\n\t\t\t\t\t} else {\n\t\t\t\t\t\tactualTextSearchResults.push(<vscode.TextSearchContext>{\n\t\t\t\t\t\t\ttext: lineResult.text,\n\t\t\t\t\t\t\tlineNumber: lineResult.lineNumber,\n\t\t\t\t\t\t\turi: fileMatch.resource\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tconst rangeToString = (r: vscode.Range) => `(${r.start.line}, ${r.start.character}), (${r.end.line}, ${r.end.character})`;\n\n\t\t\tconst makeComparable = (results: vscode.TextSearchResult[]) => results\n\t\t\t\t.sort((a, b) => {\n\t\t\t\t\tconst compareKeyA = a.uri.toString() + ': ' + (extensionResultIsMatch(a) ? a.preview.text : a.text);\n\t\t\t\t\tconst compareKeyB = b.uri.toString() + ': ' + (extensionResultIsMatch(b) ? b.preview.text : b.text);\n\t\t\t\t\treturn compareKeyB.localeCompare(compareKeyA);\n\t\t\t\t})\n\t\t\t\t.map(r => extensionResultIsMatch(r) ? {\n\t\t\t\t\turi: r.uri.toString(),\n\t\t\t\t\trange: mapArrayOrNot(r.ranges, rangeToString),\n\t\t\t\t\tpreview: {\n\t\t\t\t\t\ttext: r.preview.text,\n\t\t\t\t\t\tmatch: null // Don't care about this right now\n\t\t\t\t\t}\n\t\t\t\t} : {\n\t\t\t\t\turi: r.uri.toString(),\n\t\t\t\t\ttext: r.text,\n\t\t\t\t\tlineNumber: r.lineNumber\n\t\t\t\t});\n\n\t\t\treturn assert.deepStrictEqual(\n\t\t\t\tmakeComparable(actualTextSearchResults),\n\t\t\t\tmakeComparable(expected));\n\t\t}\n\n\t\ttest('no results', async () => {\n\t\t\tawait registerTestTextSearchProvider({\n\t\t\t\tprovideTextSearchResults(query: vscode.TextSearchQuery, options: vscode.TextSearchOptions, progress: vscode.Progress<vscode.TextSearchResult>, token: vscode.CancellationToken): Promise<vscode.TextSearchComplete> {\n\t\t\t\t\treturn Promise.resolve(null!);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tconst { results, stats } = await runTextSearch(getSimpleQuery('foo'));\n\t\t\tassert(!stats.limitHit);\n\t\t\tassert(!results.length);\n\t\t});\n\n\t\ttest('basic results', async () => {\n\t\t\tconst providedResults: vscode.TextSearchResult[] = [\n\t\t\t\tmakeTextResult(rootFolderA, 'file1.ts'),\n\t\t\t\tmakeTextResult(rootFolderA, 'file2.ts')\n\t\t\t];\n\n\t\t\tawait registerTestTextSearchProvider({\n\t\t\t\tprovideTextSearchResults(query: vscode.TextSearchQuery, options: vscode.TextSearchOptions, progress: vscode.Progress<vscode.TextSearchResult>, token: vscode.CancellationToken): Promise<vscode.TextSearchComplete> {\n\t\t\t\t\tprovidedResults.forEach(r => progress.report(r));\n\t\t\t\t\treturn Promise.resolve(null!);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tconst { results, stats } = await runTextSearch(getSimpleQuery('foo'));\n\t\t\tassert(!stats.limitHit);\n\t\t\tassertResults(results, providedResults);\n\t\t});\n\n\t\ttest('all provider calls get global include/excludes', async () => {\n\t\t\tawait registerTestTextSearchProvider({\n\t\t\t\tprovideTextSearchResults(query: vscode.TextSearchQuery, options: vscode.TextSearchOptions, progress: vscode.Progress<vscode.TextSearchResult>, token: vscode.CancellationToken): Promise<vscode.TextSearchComplete> {\n\t\t\t\t\tassert.strictEqual(options.includes.length, 1);\n\t\t\t\t\tassert.strictEqual(options.excludes.length, 1);\n\t\t\t\t\treturn Promise.resolve(null!);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tconst query: ITextQuery = {\n\t\t\t\ttype: QueryType.Text,\n\t\t\t\tcontentPattern: getPattern('foo'),\n\n\t\t\t\tincludePattern: {\n\t\t\t\t\t'*.ts': true\n\t\t\t\t},\n\n\t\t\t\texcludePattern: {\n\t\t\t\t\t'*.js': true\n\t\t\t\t},\n\n\t\t\t\tfolderQueries: [\n\t\t\t\t\t{ folder: rootFolderA },\n\t\t\t\t\t{ folder: rootFolderB }\n\t\t\t\t]\n\t\t\t};\n\n\t\t\tawait runTextSearch(query);\n\t\t});\n\n\t\ttest('global/local include/excludes combined', async () => {\n\t\t\tawait registerTestTextSearchProvider({\n\t\t\t\tprovideTextSearchResults(query: vscode.TextSearchQuery, options: vscode.TextSearchOptions, progress: vscode.Progress<vscode.TextSearchResult>, token: vscode.CancellationToken): Promise<vscode.TextSearchComplete> {\n\t\t\t\t\tif (options.folder.toString() === rootFolderA.toString()) {\n\t\t\t\t\t\tassert.deepStrictEqual(options.includes.sort(), ['*.ts', 'foo']);\n\t\t\t\t\t\tassert.deepStrictEqual(options.excludes.sort(), ['*.js', 'bar']);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tassert.deepStrictEqual(options.includes.sort(), ['*.ts']);\n\t\t\t\t\t\tassert.deepStrictEqual(options.excludes.sort(), ['*.js']);\n\t\t\t\t\t}\n\n\t\t\t\t\treturn Promise.resolve(null!);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tconst query: ITextQuery = {\n\t\t\t\ttype: QueryType.Text,\n\t\t\t\tcontentPattern: getPattern('foo'),\n\n\t\t\t\tincludePattern: {\n\t\t\t\t\t'*.ts': true\n\t\t\t\t},\n\t\t\t\texcludePattern: {\n\t\t\t\t\t'*.js': true\n\t\t\t\t},\n\t\t\t\tfolderQueries: [\n\t\t\t\t\t{\n\t\t\t\t\t\tfolder: rootFolderA,\n\t\t\t\t\t\tincludePattern: {\n\t\t\t\t\t\t\t'foo': true\n\t\t\t\t\t\t},\n\t\t\t\t\t\texcludePattern: [{\n\t\t\t\t\t\t\tpattern: {\n\t\t\t\t\t\t\t\t'bar': true\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}]\n\t\t\t\t\t},\n\t\t\t\t\t{ folder: rootFolderB }\n\t\t\t\t]\n\t\t\t};\n\n\t\t\tawait runTextSearch(query);\n\t\t});\n\n\t\ttest('include/excludes resolved correctly', async () => {\n\t\t\tawait registerTestTextSearchProvider({\n\t\t\t\tprovideTextSearchResults(query: vscode.TextSearchQuery, options: vscode.TextSearchOptions, progress: vscode.Progress<vscode.TextSearchResult>, token: vscode.CancellationToken): Promise<vscode.TextSearchComplete> {\n\t\t\t\t\tassert.deepStrictEqual(options.includes.sort(), ['*.jsx', '*.ts']);\n\t\t\t\t\tassert.deepStrictEqual(options.excludes.sort(), []);\n\n\t\t\t\t\treturn Promise.resolve(null!);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tconst query: ISearchQuery = {\n\t\t\t\ttype: QueryType.Text,\n\t\t\t\tcontentPattern: getPattern('foo'),\n\n\t\t\t\tincludePattern: {\n\t\t\t\t\t'*.ts': true,\n\t\t\t\t\t'*.jsx': false\n\t\t\t\t},\n\t\t\t\texcludePattern: {\n\t\t\t\t\t'*.js': true,\n\t\t\t\t\t'*.tsx': false\n\t\t\t\t},\n\t\t\t\tfolderQueries: [\n\t\t\t\t\t{\n\t\t\t\t\t\tfolder: rootFolderA,\n\t\t\t\t\t\tincludePattern: {\n\t\t\t\t\t\t\t'*.jsx': true\n\t\t\t\t\t\t},\n\t\t\t\t\t\texcludePattern: [{\n\t\t\t\t\t\t\tpattern: {\n\t\t\t\t\t\t\t\t'*.js': false\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}]\n\t\t\t\t\t}\n\t\t\t\t]\n\t\t\t};\n\n\t\t\tawait runTextSearch(query);\n\t\t});\n\n\t\ttest('provider fail', async () => {\n\t\t\tawait registerTestTextSearchProvider({\n\t\t\t\tprovideTextSearchResults(query: vscode.TextSearchQuery, options: vscode.TextSearchOptions, progress: vscode.Progress<vscode.TextSearchResult>, token: vscode.CancellationToken): Promise<vscode.TextSearchComplete> {\n\t\t\t\t\tthrow new Error('Provider fail');\n\t\t\t\t}\n\t\t\t});\n\n\t\t\ttry {\n\t\t\t\tawait runTextSearch(getSimpleQuery('foo'));\n\t\t\t\tassert(false, 'Expected to fail');\n\t\t\t} catch {\n\t\t\t\t// expected to fail\n\t\t\t}\n\t\t});\n\n\t\ttest('basic sibling clause', async () => {\n\t\t\t// eslint-disable-next-line local/code-no-any-casts\n\t\t\t(mockPFS as any).Promises = {\n\t\t\t\treaddir: (_path: string): any => {\n\t\t\t\t\tif (_path === rootFolderA.fsPath) {\n\t\t\t\t\t\treturn Promise.resolve([\n\t\t\t\t\t\t\t'file1.js',\n\t\t\t\t\t\t\t'file1.ts'\n\t\t\t\t\t\t]);\n\t\t\t\t\t} else {\n\t\t\t\t\t\treturn Promise.reject(new Error('Wrong path'));\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tconst providedResults: vscode.TextSearchResult[] = [\n\t\t\t\tmakeTextResult(rootFolderA, 'file1.js'),\n\t\t\t\tmakeTextResult(rootFolderA, 'file1.ts')\n\t\t\t];\n\n\t\t\tawait registerTestTextSearchProvider({\n\t\t\t\tprovideTextSearchResults(query: vscode.TextSearchQuery, options: vscode.TextSearchOptions, progress: vscode.Progress<vscode.TextSearchResult>, token: vscode.CancellationToken): Promise<vscode.TextSearchComplete> {\n\t\t\t\t\tprovidedResults.forEach(r => progress.report(r));\n\t\t\t\t\treturn Promise.resolve(null!);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tconst query: ISearchQuery = {\n\t\t\t\ttype: QueryType.Text,\n\t\t\t\tcontentPattern: getPattern('foo'),\n\n\t\t\t\texcludePattern: {\n\t\t\t\t\t'*.js': {\n\t\t\t\t\t\twhen: '$(basename).ts'\n\t\t\t\t\t}\n\t\t\t\t},\n\n\t\t\t\tfolderQueries: [\n\t\t\t\t\t{ folder: rootFolderA }\n\t\t\t\t]\n\t\t\t};\n\n\t\t\tconst { results } = await runTextSearch(query);\n\t\t\tassertResults(results, providedResults.slice(1));\n\t\t});\n\n\t\ttest('multiroot sibling clause', async () => {\n\t\t\t// eslint-disable-next-line local/code-no-any-casts\n\t\t\t(mockPFS as any).Promises = {\n\t\t\t\treaddir: (_path: string): any => {\n\t\t\t\t\tif (_path === joinPath(rootFolderA, 'folder').fsPath) {\n\t\t\t\t\t\treturn Promise.resolve([\n\t\t\t\t\t\t\t'fileA.scss',\n\t\t\t\t\t\t\t'fileA.css',\n\t\t\t\t\t\t\t'file2.css'\n\t\t\t\t\t\t]);\n\t\t\t\t\t} else if (_path === rootFolderB.fsPath) {\n\t\t\t\t\t\treturn Promise.resolve([\n\t\t\t\t\t\t\t'fileB.ts',\n\t\t\t\t\t\t\t'fileB.js',\n\t\t\t\t\t\t\t'file3.js'\n\t\t\t\t\t\t]);\n\t\t\t\t\t} else {\n\t\t\t\t\t\treturn Promise.reject(new Error('Wrong path'));\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tawait registerTestTextSearchProvider({\n\t\t\t\tprovideTextSearchResults(query: vscode.TextSearchQuery, options: vscode.TextSearchOptions, progress: vscode.Progress<vscode.TextSearchResult>, token: vscode.CancellationToken): Promise<vscode.TextSearchComplete> {\n\t\t\t\t\tlet reportedResults;\n\t\t\t\t\tif (options.folder.fsPath === rootFolderA.fsPath) {\n\t\t\t\t\t\treportedResults = [\n\t\t\t\t\t\t\tmakeTextResult(rootFolderA, 'folder/fileA.scss'),\n\t\t\t\t\t\t\tmakeTextResult(rootFolderA, 'folder/fileA.css'),\n\t\t\t\t\t\t\tmakeTextResult(rootFolderA, 'folder/file2.css')\n\t\t\t\t\t\t];\n\t\t\t\t\t} else {\n\t\t\t\t\t\treportedResults = [\n\t\t\t\t\t\t\tmakeTextResult(rootFolderB, 'fileB.ts'),\n\t\t\t\t\t\t\tmakeTextResult(rootFolderB, 'fileB.js'),\n\t\t\t\t\t\t\tmakeTextResult(rootFolderB, 'file3.js')\n\t\t\t\t\t\t];\n\t\t\t\t\t}\n\n\t\t\t\t\treportedResults.forEach(r => progress.report(r));\n\t\t\t\t\treturn Promise.resolve(null!);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tconst query: ISearchQuery = {\n\t\t\t\ttype: QueryType.Text,\n\t\t\t\tcontentPattern: getPattern('foo'),\n\n\t\t\t\texcludePattern: {\n\t\t\t\t\t'*.js': {\n\t\t\t\t\t\twhen: '$(basename).ts'\n\t\t\t\t\t},\n\t\t\t\t\t'*.css': true\n\t\t\t\t},\n\t\t\t\tfolderQueries: [\n\t\t\t\t\t{\n\t\t\t\t\t\tfolder: rootFolderA,\n\t\t\t\t\t\texcludePattern: [{\n\t\t\t\t\t\t\tpattern: {\n\t\t\t\t\t\t\t\t'folder/*.css': {\n\t\t\t\t\t\t\t\t\twhen: '$(basename).scss'\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}]\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tfolder: rootFolderB,\n\t\t\t\t\t\texcludePattern: [{\n\t\t\t\t\t\t\tpattern: {\n\t\t\t\t\t\t\t\t'*.js': false\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}]\n\t\t\t\t\t}\n\t\t\t\t]\n\t\t\t};\n\n\t\t\tconst { results } = await runTextSearch(query);\n\t\t\tassertResults(results, [\n\t\t\t\tmakeTextResult(rootFolderA, 'folder/fileA.scss'),\n\t\t\t\tmakeTextResult(rootFolderA, 'folder/file2.css'),\n\t\t\t\tmakeTextResult(rootFolderB, 'fileB.ts'),\n\t\t\t\tmakeTextResult(rootFolderB, 'fileB.js'),\n\t\t\t\tmakeTextResult(rootFolderB, 'file3.js')]);\n\t\t});\n\n\t\ttest('include pattern applied', async () => {\n\t\t\tconst providedResults: vscode.TextSearchResult[] = [\n\t\t\t\tmakeTextResult(rootFolderA, 'file1.js'),\n\t\t\t\tmakeTextResult(rootFolderA, 'file1.ts')\n\t\t\t];\n\n\t\t\tawait registerTestTextSearchProvider({\n\t\t\t\tprovideTextSearchResults(query: vscode.TextSearchQuery, options: vscode.TextSearchOptions, progress: vscode.Progress<vscode.TextSearchResult>, token: vscode.CancellationToken): Promise<vscode.TextSearchComplete> {\n\t\t\t\t\tprovidedResults.forEach(r => progress.report(r));\n\t\t\t\t\treturn Promise.resolve(null!);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tconst query: ISearchQuery = {\n\t\t\t\ttype: QueryType.Text,\n\t\t\t\tcontentPattern: getPattern('foo'),\n\n\t\t\t\tincludePattern: {\n\t\t\t\t\t'*.ts': true\n\t\t\t\t},\n\n\t\t\t\tfolderQueries: [\n\t\t\t\t\t{ folder: rootFolderA }\n\t\t\t\t]\n\t\t\t};\n\n\t\t\tconst { results } = await runTextSearch(query);\n\t\t\tassertResults(results, providedResults.slice(1));\n\t\t});\n\n\t\ttest('max results = 1', async () => {\n\t\t\tconst providedResults: vscode.TextSearchResult[] = [\n\t\t\t\tmakeTextResult(rootFolderA, 'file1.ts'),\n\t\t\t\tmakeTextResult(rootFolderA, 'file2.ts')\n\t\t\t];\n\n\t\t\tlet wasCanceled = false;\n\t\t\tawait registerTestTextSearchProvider({\n\t\t\t\tprovideTextSearchResults(query: vscode.TextSearchQuery, options: vscode.TextSearchOptions, progress: vscode.Progress<vscode.TextSearchResult>, token: vscode.CancellationToken): Promise<vscode.TextSearchComplete> {\n\t\t\t\t\tdisposables.add(token.onCancellationRequested(() => wasCanceled = true));\n\t\t\t\t\tprovidedResults.forEach(r => progress.report(r));\n\t\t\t\t\treturn Promise.resolve(null!);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tconst query: ISearchQuery = {\n\t\t\t\ttype: QueryType.Text,\n\t\t\t\tcontentPattern: getPattern('foo'),\n\n\t\t\t\tmaxResults: 1,\n\n\t\t\t\tfolderQueries: [\n\t\t\t\t\t{ folder: rootFolderA }\n\t\t\t\t]\n\t\t\t};\n\n\t\t\tconst { results, stats } = await runTextSearch(query);\n\t\t\tassert(stats.limitHit, 'Expected to return limitHit');\n\t\t\tassertResults(results, providedResults.slice(0, 1));\n\t\t\tassert(wasCanceled, 'Expected to be canceled');\n\t\t});\n\n\t\ttest('max results = 2', async () => {\n\t\t\tconst providedResults: vscode.TextSearchResult[] = [\n\t\t\t\tmakeTextResult(rootFolderA, 'file1.ts'),\n\t\t\t\tmakeTextResult(rootFolderA, 'file2.ts'),\n\t\t\t\tmakeTextResult(rootFolderA, 'file3.ts')\n\t\t\t];\n\n\t\t\tlet wasCanceled = false;\n\t\t\tawait registerTestTextSearchProvider({\n\t\t\t\tprovideTextSearchResults(query: vscode.TextSearchQuery, options: vscode.TextSearchOptions, progress: vscode.Progress<vscode.TextSearchResult>, token: vscode.CancellationToken): Promise<vscode.TextSearchComplete> {\n\t\t\t\t\tdisposables.add(token.onCancellationRequested(() => wasCanceled = true));\n\t\t\t\t\tprovidedResults.forEach(r => progress.report(r));\n\t\t\t\t\treturn Promise.resolve(null!);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tconst query: ISearchQuery = {\n\t\t\t\ttype: QueryType.Text,\n\t\t\t\tcontentPattern: getPattern('foo'),\n\n\t\t\t\tmaxResults: 2,\n\n\t\t\t\tfolderQueries: [\n\t\t\t\t\t{ folder: rootFolderA }\n\t\t\t\t]\n\t\t\t};\n\n\t\t\tconst { results, stats } = await runTextSearch(query);\n\t\t\tassert(stats.limitHit, 'Expected to return limitHit');\n\t\t\tassertResults(results, providedResults.slice(0, 2));\n\t\t\tassert(wasCanceled, 'Expected to be canceled');\n\t\t});\n\n\t\ttest('provider returns maxResults exactly', async () => {\n\t\t\tconst providedResults: vscode.TextSearchResult[] = [\n\t\t\t\tmakeTextResult(rootFolderA, 'file1.ts'),\n\t\t\t\tmakeTextResult(rootFolderA, 'file2.ts')\n\t\t\t];\n\n\t\t\tlet wasCanceled = false;\n\t\t\tawait registerTestTextSearchProvider({\n\t\t\t\tprovideTextSearchResults(query: vscode.TextSearchQuery, options: vscode.TextSearchOptions, progress: vscode.Progress<vscode.TextSearchResult>, token: vscode.CancellationToken): Promise<vscode.TextSearchComplete> {\n\t\t\t\t\tdisposables.add(token.onCancellationRequested(() => wasCanceled = true));\n\t\t\t\t\tprovidedResults.forEach(r => progress.report(r));\n\t\t\t\t\treturn Promise.resolve(null!);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tconst query: ISearchQuery = {\n\t\t\t\ttype: QueryType.Text,\n\t\t\t\tcontentPattern: getPattern('foo'),\n\n\t\t\t\tmaxResults: 2,\n\n\t\t\t\tfolderQueries: [\n\t\t\t\t\t{ folder: rootFolderA }\n\t\t\t\t]\n\t\t\t};\n\n\t\t\tconst { results, stats } = await runTextSearch(query);\n\t\t\tassert(!stats.limitHit, 'Expected not to return limitHit');\n\t\t\tassertResults(results, providedResults);\n\t\t\tassert(!wasCanceled, 'Expected not to be canceled');\n\t\t});\n\n\t\ttest('provider returns early with limitHit', async () => {\n\t\t\tconst providedResults: vscode.TextSearchResult[] = [\n\t\t\t\tmakeTextResult(rootFolderA, 'file1.ts'),\n\t\t\t\tmakeTextResult(rootFolderA, 'file2.ts'),\n\t\t\t\tmakeTextResult(rootFolderA, 'file3.ts')\n\t\t\t];\n\n\t\t\tawait registerTestTextSearchProvider({\n\t\t\t\tprovideTextSearchResults(query: vscode.TextSearchQuery, options: vscode.TextSearchOptions, progress: vscode.Progress<vscode.TextSearchResult>, token: vscode.CancellationToken): Promise<vscode.TextSearchComplete> {\n\t\t\t\t\tprovidedResults.forEach(r => progress.report(r));\n\t\t\t\t\treturn Promise.resolve({ limitHit: true });\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tconst query: ISearchQuery = {\n\t\t\t\ttype: QueryType.Text,\n\t\t\t\tcontentPattern: getPattern('foo'),\n\n\t\t\t\tmaxResults: 1000,\n\n\t\t\t\tfolderQueries: [\n\t\t\t\t\t{ folder: rootFolderA }\n\t\t\t\t]\n\t\t\t};\n\n\t\t\tconst { results, stats } = await runTextSearch(query);\n\t\t\tassert(stats.limitHit, 'Expected to return limitHit');\n\t\t\tassertResults(results, providedResults);\n\t\t});\n\n\t\ttest('multiroot max results', async () => {\n\t\t\tlet cancels = 0;\n\t\t\tawait registerTestTextSearchProvider({\n\t\t\t\tasync provideTextSearchResults(query: vscode.TextSearchQuery, options: vscode.TextSearchOptions, progress: vscode.Progress<vscode.TextSearchResult>, token: vscode.CancellationToken): Promise<vscode.TextSearchComplete> {\n\t\t\t\t\tdisposables.add(token.onCancellationRequested(() => cancels++));\n\t\t\t\t\tawait new Promise(r => process.nextTick(r));\n\t\t\t\t\t[\n\t\t\t\t\t\t'file1.ts',\n\t\t\t\t\t\t'file2.ts',\n\t\t\t\t\t\t'file3.ts',\n\t\t\t\t\t].forEach(f => progress.report(makeTextResult(options.folder, f)));\n\t\t\t\t\treturn null!;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tconst query: ISearchQuery = {\n\t\t\t\ttype: QueryType.Text,\n\t\t\t\tcontentPattern: getPattern('foo'),\n\n\t\t\t\tmaxResults: 2,\n\n\t\t\t\tfolderQueries: [\n\t\t\t\t\t{ folder: rootFolderA },\n\t\t\t\t\t{ folder: rootFolderB }\n\t\t\t\t]\n\t\t\t};\n\n\t\t\tconst { results } = await runTextSearch(query);\n\t\t\tassert.strictEqual(results.length, 2);\n\t\t\tassert.strictEqual(cancels, 2);\n\t\t});\n\n\t\ttest('works with non-file schemes', async () => {\n\t\t\tconst providedResults: vscode.TextSearchResult[] = [\n\t\t\t\tmakeTextResult(fancySchemeFolderA, 'file1.ts'),\n\t\t\t\tmakeTextResult(fancySchemeFolderA, 'file2.ts'),\n\t\t\t\tmakeTextResult(fancySchemeFolderA, 'file3.ts')\n\t\t\t];\n\n\t\t\tawait registerTestTextSearchProvider({\n\t\t\t\tprovideTextSearchResults(query: vscode.TextSearchQuery, options: vscode.TextSearchOptions, progress: vscode.Progress<vscode.TextSearchResult>, token: vscode.CancellationToken): Promise<vscode.TextSearchComplete> {\n\t\t\t\t\tprovidedResults.forEach(r => progress.report(r));\n\t\t\t\t\treturn Promise.resolve(null!);\n\t\t\t\t}\n\t\t\t}, fancyScheme);\n\n\t\t\tconst query: ISearchQuery = {\n\t\t\t\ttype: QueryType.Text,\n\t\t\t\tcontentPattern: getPattern('foo'),\n\n\t\t\t\tfolderQueries: [\n\t\t\t\t\t{ folder: fancySchemeFolderA }\n\t\t\t\t]\n\t\t\t};\n\n\t\t\tconst { results } = await runTextSearch(query);\n\t\t\tassertResults(results, providedResults);\n\t\t});\n\t});\n});\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport assert from 'assert';\nimport { mapArrayOrNot } from '../../../../base/common/arrays.js';\nimport { timeout } from '../../../../base/common/async.js';\nimport { CancellationTokenSource } from '../../../../base/common/cancellation.js';\nimport { isCancellationError } from '../../../../base/common/errors.js';\nimport { revive } from '../../../../base/common/marshalling.js';\nimport { joinPath } from '../../../../base/common/resources.js';\nimport { URI, UriComponents } from '../../../../base/common/uri.js';\nimport * as pfs from '../../../../base/node/pfs.js';\nimport { mock } from '../../../../base/test/common/mock.js';\nimport { ensureNoDisposablesAreLeakedInTestSuite } from '../../../../base/test/common/utils.js';\nimport { NullLogService } from '../../../../platform/log/common/log.js';\nimport { MainContext, MainThreadSearchShape } from '../../common/extHost.protocol.js';\nimport { ExtHostConfigProvider, IExtHostConfiguration } from '../../common/extHostConfiguration.js';\nimport { IExtHostInitDataService } from '../../common/extHostInitDataService.js';\nimport { Range } from '../../common/extHostTypes.js';\nimport { URITransformerService } from '../../common/extHostUriTransformerService.js';\nimport { NativeExtHostSearch } from '../../node/extHostSearch.js';\nimport { TestRPCProtocol } from '../common/testRPCProtocol.js';\nimport { IFileMatch, IFileQuery, IPatternInfo, IRawFileMatch2, ISearchCompleteStats, ISearchQuery, ITextQuery, QueryType, resultIsMatch } from '../../../services/search/common/search.js';\nimport { TextSearchManager } from '../../../services/search/common/textSearchManager.js';\nimport { NativeTextSearchManager } from '../../../services/search/node/textSearchManager.js';\nimport type * as vscode from 'vscode';\nimport { AISearchKeyword } from '../../../services/search/common/searchExtTypes.js';\n\nlet rpcProtocol: TestRPCProtocol;\nlet extHostSearch: NativeExtHostSearch;\n\nlet mockMainThreadSearch: MockMainThreadSearch;\nclass MockMainThreadSearch implements MainThreadSearchShape {\n\tlastHandle!: number;\n\n\tresults: Array<UriComponents | IRawFileMatch2> = [];\n\n\tkeywords: Array<AISearchKeyword> = [];\n\n\t$registerFileSearchProvider(handle: number, scheme: string): void {\n\t\tthis.lastHandle = handle;\n\t}\n\n\t$registerTextSearchProvider(handle: number, scheme: string): void {\n\t\tthis.lastHandle = handle;\n\t}\n\n\t$registerAITextSearchProvider(handle: number, scheme: string): void {\n\t\tthis.lastHandle = handle;\n\t}\n\n\t$unregisterProvider(handle: number): void {\n\t}\n\n\t$handleFileMatch(handle: number, session: number, data: UriComponents[]): void {\n\t\tthis.results.push(...data);\n\t}\n\n\t$handleTextMatch(handle: number, session: number, data: IRawFileMatch2[]): void {\n\t\tthis.results.push(...data);\n\t}\n\n\t$handleKeywordResult(handle: number, session: number, data: AISearchKeyword): void {\n\t\tthis.keywords.push(data);\n\t}\n\n\t$handleTelemetry(eventName: string, data: any): void {\n\t}\n\n\tdispose() {\n\t}\n}\n\nlet mockPFS: Partial<typeof pfs>;\n\nfunction extensionResultIsMatch(data: vscode.TextSearchResult): data is vscode.TextSearchMatch {\n\treturn !!(<vscode.TextSearchMatch>data).preview;\n}\n\nsuite('ExtHostSearch', () => {\n\tconst disposables = ensureNoDisposablesAreLeakedInTestSuite();\n\n\tasync function registerTestTextSearchProvider(provider: vscode.TextSearchProvider, scheme = 'file'): Promise<void> {\n\t\tdisposables.add(extHostSearch.registerTextSearchProviderOld(scheme, provider));\n\t\tawait rpcProtocol.sync();\n\t}\n\n\tasync function registerTestFileSearchProvider(provider: vscode.FileSearchProvider, scheme = 'file'): Promise<void> {\n\t\tdisposables.add(extHostSearch.registerFileSearchProviderOld(scheme, provider));\n\t\tawait rpcProtocol.sync();\n\t}\n\n\tasync function runFileSearch(query: IFileQuery, cancel = false): Promise<{ results: URI[]; stats: ISearchCompleteStats }> {\n\t\tlet stats: ISearchCompleteStats;\n\t\ttry {\n\t\t\tconst cancellation = new CancellationTokenSource();\n\t\t\tconst p = extHostSearch.$provideFileSearchResults(mockMainThreadSearch.lastHandle, 0, query, cancellation.token);\n\t\t\tif (cancel) {\n\t\t\t\tawait timeout(0);\n\t\t\t\tcancellation.cancel();\n\t\t\t}\n\n\t\t\tstats = await p;\n\t\t} catch (err) {\n\t\t\tif (!isCancellationError(err)) {\n\t\t\t\tawait rpcProtocol.sync();\n\t\t\t\tthrow err;\n\t\t\t}\n\t\t}\n\n\t\tawait rpcProtocol.sync();\n\t\treturn {\n\t\t\tresults: (<UriComponents[]>mockMainThreadSearch.results).map(r => URI.revive(r)),\n\t\t\tstats: stats!\n\t\t};\n\t}\n\n\tasync function runTextSearch(query: ITextQuery): Promise<{ results: IFileMatch[]; stats: ISearchCompleteStats }> {\n\t\tlet stats: ISearchCompleteStats;\n\t\ttry {\n\t\t\tconst cancellation = new CancellationTokenSource();\n\t\t\tconst p = extHostSearch.$provideTextSearchResults(mockMainThreadSearch.lastHandle, 0, query, cancellation.token);\n\n\t\t\tstats = await p;\n\t\t} catch (err) {\n\t\t\tif (!isCancellationError(err)) {\n\t\t\t\tawait rpcProtocol.sync();\n\t\t\t\tthrow err;\n\t\t\t}\n\t\t}\n\n\t\tawait rpcProtocol.sync();\n\t\tconst results: IFileMatch[] = revive(<IRawFileMatch2[]>mockMainThreadSearch.results);\n\n\t\treturn { results, stats: stats! };\n\t}\n\n\tsetup(() => {\n\t\trpcProtocol = new TestRPCProtocol();\n\n\t\tmockMainThreadSearch = new MockMainThreadSearch();\n\t\tconst logService = new NullLogService();\n\n\t\trpcProtocol.set(MainContext.MainThreadSearch, mockMainThreadSearch);\n\n\t\tmockPFS = {};\n\t\textHostSearch = disposables.add(new class extends NativeExtHostSearch {\n\t\t\tconstructor() {\n\t\t\t\tsuper(\n\t\t\t\t\trpcProtocol,\n\t\t\t\t\tnew class extends mock<IExtHostInitDataService>() { override remote = { isRemote: false, authority: undefined, connectionData: null }; },\n\t\t\t\t\tnew URITransformerService(null),\n\t\t\t\t\tnew class extends mock<IExtHostConfiguration>() {\n\t\t\t\t\t\toverride async getConfigProvider(): Promise<ExtHostConfigProvider> {\n\t\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\t\tonDidChangeConfiguration(_listener: (event: vscode.ConfigurationChangeEvent) => void) { },\n\t\t\t\t\t\t\t\tgetConfiguration(): vscode.WorkspaceConfiguration {\n\t\t\t\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\t\t\t\tget() { },\n\t\t\t\t\t\t\t\t\t\thas() {\n\t\t\t\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\tinspect() {\n\t\t\t\t\t\t\t\t\t\t\treturn undefined;\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\tasync update() { }\n\t\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\t},\n\n\t\t\t\t\t\t\t} as ExtHostConfigProvider;\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tlogService\n\t\t\t\t);\n\t\t\t\t// eslint-disable-next-line local/code-no-any-casts\n\t\t\t\tthis._pfs = mockPFS as any;\n\t\t\t}\n\n\t\t\tprotected override createTextSearchManager(query: ITextQuery, provider: vscode.TextSearchProvider2): TextSearchManager {\n\t\t\t\treturn new NativeTextSearchManager(query, provider, this._pfs);\n\t\t\t}\n\t\t});\n\t});\n\n\tteardown(() => {\n\t\treturn rpcProtocol.sync();\n\t});\n\n\tconst rootFolderA = URI.file('/foo/bar1');\n\tconst rootFolderB = URI.file('/foo/bar2');\n\tconst fancyScheme = 'fancy';\n\tconst fancySchemeFolderA = URI.from({ scheme: fancyScheme, path: '/project/folder1' });\n\n\tsuite('File:', () => {\n\n\t\tfunction getSimpleQuery(filePattern = ''): IFileQuery {\n\t\t\treturn {\n\t\t\t\ttype: QueryType.File,\n\n\t\t\t\tfilePattern,\n\t\t\t\tfolderQueries: [\n\t\t\t\t\t{ folder: rootFolderA }\n\t\t\t\t]\n\t\t\t};\n\t\t}\n\n\t\tfunction compareURIs(actual: URI[], expected: URI[]) {\n\t\t\tconst sortAndStringify = (arr: URI[]) => arr.sort().map(u => u.toString());\n\n\t\t\tassert.deepStrictEqual(\n\t\t\t\tsortAndStringify(actual),\n\t\t\t\tsortAndStringify(expected));\n\t\t}\n\n\t\ttest('no results', async () => {\n\t\t\tawait registerTestFileSearchProvider({\n\t\t\t\tprovideFileSearchResults(query: vscode.FileSearchQuery, options: vscode.FileSearchOptions, token: vscode.CancellationToken): Promise<URI[]> {\n\t\t\t\t\treturn Promise.resolve(null!);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tconst { results, stats } = await runFileSearch(getSimpleQuery());\n\t\t\tassert(!stats.limitHit);\n\t\t\tassert(!results.length);\n\t\t});\n\n\t\ttest('simple results', async () => {\n\t\t\tconst reportedResults = [\n\t\t\t\tjoinPath(rootFolderA, 'file1.ts'),\n\t\t\t\tjoinPath(rootFolderA, 'file2.ts'),\n\t\t\t\tjoinPath(rootFolderA, 'subfolder/file3.ts')\n\t\t\t];\n\n\t\t\tawait registerTestFileSearchProvider({\n\t\t\t\tprovideFileSearchResults(query: vscode.FileSearchQuery, options: vscode.FileSearchOptions, token: vscode.CancellationToken): Promise<URI[]> {\n\t\t\t\t\treturn Promise.resolve(reportedResults);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tconst { results, stats } = await runFileSearch(getSimpleQuery());\n\t\t\tassert(!stats.limitHit);\n\t\t\tassert.strictEqual(results.length, 3);\n\t\t\tcompareURIs(results, reportedResults);\n\t\t});\n\n\t\ttest('Search canceled', async () => {\n\t\t\tlet cancelRequested = false;\n\t\t\tawait registerTestFileSearchProvider({\n\t\t\t\tprovideFileSearchResults(query: vscode.FileSearchQuery, options: vscode.FileSearchOptions, token: vscode.CancellationToken): Promise<URI[]> {\n\n\t\t\t\t\treturn new Promise((resolve, reject) => {\n\t\t\t\t\t\tfunction onCancel() {\n\t\t\t\t\t\t\tcancelRequested = true;\n\n\t\t\t\t\t\t\tresolve([joinPath(options.folder, 'file1.ts')]); // or reject or nothing?\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (token.isCancellationRequested) {\n\t\t\t\t\t\t\tonCancel();\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tdisposables.add(token.onCancellationRequested(() => onCancel()));\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tconst { results } = await runFileSearch(getSimpleQuery(), true);\n\t\t\tassert(cancelRequested);\n\t\t\tassert(!results.length);\n\t\t});\n\n\t\ttest('session cancellation should work', async () => {\n\t\t\tlet numSessionCancelled = 0;\n\t\t\tconst disposables: (vscode.Disposable | undefined)[] = [];\n\t\t\tawait registerTestFileSearchProvider({\n\t\t\t\tprovideFileSearchResults(query: vscode.FileSearchQuery, options: vscode.FileSearchOptions, token: vscode.CancellationToken): Promise<URI[]> {\n\n\t\t\t\t\tdisposables.push(options.session?.onCancellationRequested(() => {\n\t\t\t\t\t\tnumSessionCancelled++;\n\t\t\t\t\t}));\n\n\t\t\t\t\treturn Promise.resolve([]);\n\t\t\t\t}\n\t\t\t});\n\n\n\t\t\tawait runFileSearch({ ...getSimpleQuery(), cacheKey: '1' }, true);\n\t\t\tawait runFileSearch({ ...getSimpleQuery(), cacheKey: '2' }, true);\n\t\t\textHostSearch.$clearCache('1');\n\t\t\tassert.strictEqual(numSessionCancelled, 1);\n\t\t\tdisposables.forEach(d => d?.dispose());\n\t\t});\n\n\t\ttest('provider returns null', async () => {\n\t\t\tawait registerTestFileSearchProvider({\n\t\t\t\tprovideFileSearchResults(query: vscode.FileSearchQuery, options: vscode.FileSearchOptions, token: vscode.CancellationToken): Promise<URI[]> {\n\t\t\t\t\treturn null!;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\ttry {\n\t\t\t\tawait runFileSearch(getSimpleQuery());\n\t\t\t\tassert(false, 'Expected to fail');\n\t\t\t} catch {\n\t\t\t\t// Expected to throw\n\t\t\t}\n\t\t});\n\n\t\ttest('all provider calls get global include/excludes', async () => {\n\t\t\tawait registerTestFileSearchProvider({\n\t\t\t\tprovideFileSearchResults(query: vscode.FileSearchQuery, options: vscode.FileSearchOptions, token: vscode.CancellationToken): Promise<URI[]> {\n\t\t\t\t\tassert(options.excludes.length === 2 && options.includes.length === 2, 'Missing global include/excludes');\n\t\t\t\t\treturn Promise.resolve(null!);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tconst query: ISearchQuery = {\n\t\t\t\ttype: QueryType.File,\n\n\t\t\t\tfilePattern: '',\n\t\t\t\tincludePattern: {\n\t\t\t\t\t'foo': true,\n\t\t\t\t\t'bar': true\n\t\t\t\t},\n\t\t\t\texcludePattern: {\n\t\t\t\t\t'something': true,\n\t\t\t\t\t'else': true\n\t\t\t\t},\n\t\t\t\tfolderQueries: [\n\t\t\t\t\t{ folder: rootFolderA },\n\t\t\t\t\t{ folder: rootFolderB }\n\t\t\t\t]\n\t\t\t};\n\n\t\t\tawait runFileSearch(query);\n\t\t});\n\n\t\ttest('global/local include/excludes combined', async () => {\n\t\t\tawait registerTestFileSearchProvider({\n\t\t\t\tprovideFileSearchResults(query: vscode.FileSearchQuery, options: vscode.FileSearchOptions, token: vscode.CancellationToken): Promise<URI[]> {\n\t\t\t\t\tif (options.folder.toString() === rootFolderA.toString()) {\n\t\t\t\t\t\tassert.deepStrictEqual(options.includes.sort(), ['*.ts', 'foo']);\n\t\t\t\t\t\tassert.deepStrictEqual(options.excludes.sort(), ['*.js', 'bar']);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tassert.deepStrictEqual(options.includes.sort(), ['*.ts']);\n\t\t\t\t\t\tassert.deepStrictEqual(options.excludes.sort(), ['*.js']);\n\t\t\t\t\t}\n\n\t\t\t\t\treturn Promise.resolve(null!);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tconst query: ISearchQuery = {\n\t\t\t\ttype: QueryType.File,\n\n\t\t\t\tfilePattern: '',\n\t\t\t\tincludePattern: {\n\t\t\t\t\t'*.ts': true\n\t\t\t\t},\n\t\t\t\texcludePattern: {\n\t\t\t\t\t'*.js': true\n\t\t\t\t},\n\t\t\t\tfolderQueries: [\n\t\t\t\t\t{\n\t\t\t\t\t\tfolder: rootFolderA,\n\t\t\t\t\t\tincludePattern: {\n\t\t\t\t\t\t\t'foo': true\n\t\t\t\t\t\t},\n\t\t\t\t\t\texcludePattern: [{\n\t\t\t\t\t\t\tpattern: {\n\t\t\t\t\t\t\t\t'bar': true\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}]\n\t\t\t\t\t},\n\t\t\t\t\t{ folder: rootFolderB }\n\t\t\t\t]\n\t\t\t};\n\n\t\t\tawait runFileSearch(query);\n\t\t});\n\n\t\ttest('include/excludes resolved correctly', async () => {\n\t\t\tawait registerTestFileSearchProvider({\n\t\t\t\tprovideFileSearchResults(query: vscode.FileSearchQuery, options: vscode.FileSearchOptions, token: vscode.CancellationToken): Promise<URI[]> {\n\t\t\t\t\tassert.deepStrictEqual(options.includes.sort(), ['*.jsx', '*.ts']);\n\t\t\t\t\tassert.deepStrictEqual(options.excludes.sort(), []);\n\n\t\t\t\t\treturn Promise.resolve(null!);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tconst query: ISearchQuery = {\n\t\t\t\ttype: QueryType.File,\n\n\t\t\t\tfilePattern: '',\n\t\t\t\tincludePattern: {\n\t\t\t\t\t'*.ts': true,\n\t\t\t\t\t'*.jsx': false\n\t\t\t\t},\n\t\t\t\texcludePattern: {\n\t\t\t\t\t'*.js': true,\n\t\t\t\t\t'*.tsx': false\n\t\t\t\t},\n\t\t\t\tfolderQueries: [\n\t\t\t\t\t{\n\t\t\t\t\t\tfolder: rootFolderA,\n\t\t\t\t\t\tincludePattern: {\n\t\t\t\t\t\t\t'*.jsx': true\n\t\t\t\t\t\t},\n\t\t\t\t\t\texcludePattern: [{\n\t\t\t\t\t\t\tpattern: {\n\t\t\t\t\t\t\t\t'*.js': false\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}]\n\t\t\t\t\t}\n\t\t\t\t]\n\t\t\t};\n\n\t\t\tawait runFileSearch(query);\n\t\t});\n\n\t\ttest('basic sibling exclude clause', async () => {\n\t\t\tconst reportedResults = [\n\t\t\t\t'file1.ts',\n\t\t\t\t'file1.js',\n\t\t\t];\n\n\t\t\tawait registerTestFileSearchProvider({\n\t\t\t\tprovideFileSearchResults(query: vscode.FileSearchQuery, options: vscode.FileSearchOptions, token: vscode.CancellationToken): Promise<URI[]> {\n\t\t\t\t\treturn Promise.resolve(reportedResults\n\t\t\t\t\t\t.map(relativePath => joinPath(options.folder, relativePath)));\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tconst query: ISearchQuery = {\n\t\t\t\ttype: QueryType.File,\n\n\t\t\t\tfilePattern: '',\n\t\t\t\texcludePattern: {\n\t\t\t\t\t'*.js': {\n\t\t\t\t\t\twhen: '$(basename).ts'\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tfolderQueries: [\n\t\t\t\t\t{ folder: rootFolderA }\n\t\t\t\t]\n\t\t\t};\n\n\t\t\tconst { results } = await runFileSearch(query);\n\t\t\tcompareURIs(\n\t\t\t\tresults,\n\t\t\t\t[\n\t\t\t\t\tjoinPath(rootFolderA, 'file1.ts')\n\t\t\t\t]);\n\t\t});\n\n\t\t// https://github.com/microsoft/vscode-remotehub/issues/255\n\t\ttest('include, sibling exclude, and subfolder', async () => {\n\t\t\tconst reportedResults = [\n\t\t\t\t'foo/file1.ts',\n\t\t\t\t'foo/file1.js',\n\t\t\t];\n\n\t\t\tawait registerTestFileSearchProvider({\n\t\t\t\tprovideFileSearchResults(query: vscode.FileSearchQuery, options: vscode.FileSearchOptions, token: vscode.CancellationToken): Promise<URI[]> {\n\t\t\t\t\treturn Promise.resolve(reportedResults\n\t\t\t\t\t\t.map(relativePath => joinPath(options.folder, relativePath)));\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tconst query: ISearchQuery = {\n\t\t\t\ttype: QueryType.File,\n\n\t\t\t\tfilePattern: '',\n\t\t\t\tincludePattern: { '**/*.ts': true },\n\t\t\t\texcludePattern: {\n\t\t\t\t\t'*.js': {\n\t\t\t\t\t\twhen: '$(basename).ts'\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tfolderQueries: [\n\t\t\t\t\t{ folder: rootFolderA }\n\t\t\t\t]\n\t\t\t};\n\n\t\t\tconst { results } = await runFileSearch(query);\n\t\t\tcompareURIs(\n\t\t\t\tresults,\n\t\t\t\t[\n\t\t\t\t\tjoinPath(rootFolderA, 'foo/file1.ts')\n\t\t\t\t]);\n\t\t});\n\n\t\ttest('multiroot sibling exclude clause', async () => {\n\n\t\t\tawait registerTestFileSearchProvider({\n\t\t\t\tprovideFileSearchResults(query: vscode.FileSearchQuery, options: vscode.FileSearchOptions, token: vscode.CancellationToken): Promise<URI[]> {\n\t\t\t\t\tlet reportedResults: URI[];\n\t\t\t\t\tif (options.folder.fsPath === rootFolderA.fsPath) {\n\t\t\t\t\t\treportedResults = [\n\t\t\t\t\t\t\t'folder/fileA.scss',\n\t\t\t\t\t\t\t'folder/fileA.css',\n\t\t\t\t\t\t\t'folder/file2.css'\n\t\t\t\t\t\t].map(relativePath => joinPath(rootFolderA, relativePath));\n\t\t\t\t\t} else {\n\t\t\t\t\t\treportedResults = [\n\t\t\t\t\t\t\t'fileB.ts',\n\t\t\t\t\t\t\t'fileB.js',\n\t\t\t\t\t\t\t'file3.js'\n\t\t\t\t\t\t].map(relativePath => joinPath(rootFolderB, relativePath));\n\t\t\t\t\t}\n\n\t\t\t\t\treturn Promise.resolve(reportedResults);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tconst query: ISearchQuery = {\n\t\t\t\ttype: QueryType.File,\n\n\t\t\t\tfilePattern: '',\n\t\t\t\texcludePattern: {\n\t\t\t\t\t'*.js': {\n\t\t\t\t\t\twhen: '$(basename).ts'\n\t\t\t\t\t},\n\t\t\t\t\t'*.css': true\n\t\t\t\t},\n\t\t\t\tfolderQueries: [\n\t\t\t\t\t{\n\t\t\t\t\t\tfolder: rootFolderA,\n\t\t\t\t\t\texcludePattern: [{\n\t\t\t\t\t\t\tpattern: {\n\t\t\t\t\t\t\t\t'folder/*.css': {\n\t\t\t\t\t\t\t\t\twhen: '$(basename).scss'\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}]\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tfolder: rootFolderB,\n\t\t\t\t\t\texcludePattern: [{\n\t\t\t\t\t\t\tpattern: {\n\t\t\t\t\t\t\t\t'*.js': false\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}]\n\t\t\t\t\t}\n\t\t\t\t]\n\t\t\t};\n\n\t\t\tconst { results } = await runFileSearch(query);\n\t\t\tcompareURIs(\n\t\t\t\tresults,\n\t\t\t\t[\n\t\t\t\t\tjoinPath(rootFolderA, 'folder/fileA.scss'),\n\t\t\t\t\tjoinPath(rootFolderA, 'folder/file2.css'),\n\n\t\t\t\t\tjoinPath(rootFolderB, 'fileB.ts'),\n\t\t\t\t\tjoinPath(rootFolderB, 'fileB.js'),\n\t\t\t\t\tjoinPath(rootFolderB, 'file3.js'),\n\t\t\t\t]);\n\t\t});\n\n\t\ttest('max results = 1', async () => {\n\t\t\tconst reportedResults = [\n\t\t\t\tjoinPath(rootFolderA, 'file1.ts'),\n\t\t\t\tjoinPath(rootFolderA, 'file2.ts'),\n\t\t\t\tjoinPath(rootFolderA, 'file3.ts'),\n\t\t\t];\n\n\t\t\tlet wasCanceled = false;\n\t\t\tawait registerTestFileSearchProvider({\n\t\t\t\tprovideFileSearchResults(query: vscode.FileSearchQuery, options: vscode.FileSearchOptions, token: vscode.CancellationToken): Promise<URI[]> {\n\t\t\t\t\tdisposables.add(token.onCancellationRequested(() => wasCanceled = true));\n\n\t\t\t\t\treturn Promise.resolve(reportedResults);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tconst query: ISearchQuery = {\n\t\t\t\ttype: QueryType.File,\n\n\t\t\t\tfilePattern: '',\n\t\t\t\tmaxResults: 1,\n\n\t\t\t\tfolderQueries: [\n\t\t\t\t\t{\n\t\t\t\t\t\tfolder: rootFolderA\n\t\t\t\t\t}\n\t\t\t\t]\n\t\t\t};\n\n\t\t\tconst { results, stats } = await runFileSearch(query);\n\t\t\tassert(stats.limitHit, 'Expected to return limitHit');\n\t\t\tassert.strictEqual(results.length, 1);\n\t\t\tcompareURIs(results, reportedResults.slice(0, 1));\n\t\t\tassert(wasCanceled, 'Expected to be canceled when hitting limit');\n\t\t});\n\n\t\ttest('max results = 2', async () => {\n\t\t\tconst reportedResults = [\n\t\t\t\tjoinPath(rootFolderA, 'file1.ts'),\n\t\t\t\tjoinPath(rootFolderA, 'file2.ts'),\n\t\t\t\tjoinPath(rootFolderA, 'file3.ts'),\n\t\t\t];\n\n\t\t\tlet wasCanceled = false;\n\t\t\tawait registerTestFileSearchProvider({\n\t\t\t\tprovideFileSearchResults(query: vscode.FileSearchQuery, options: vscode.FileSearchOptions, token: vscode.CancellationToken): Promise<URI[]> {\n\t\t\t\t\tdisposables.add(token.onCancellationRequested(() => wasCanceled = true));\n\n\t\t\t\t\treturn Promise.resolve(reportedResults);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tconst query: ISearchQuery = {\n\t\t\t\ttype: QueryType.File,\n\n\t\t\t\tfilePattern: '',\n\t\t\t\tmaxResults: 2,\n\n\t\t\t\tfolderQueries: [\n\t\t\t\t\t{\n\t\t\t\t\t\tfolder: rootFolderA\n\t\t\t\t\t}\n\t\t\t\t]\n\t\t\t};\n\n\t\t\tconst { results, stats } = await runFileSearch(query);\n\t\t\tassert(stats.limitHit, 'Expected to return limitHit');\n\t\t\tassert.strictEqual(results.length, 2);\n\t\t\tcompareURIs(results, reportedResults.slice(0, 2));\n\t\t\tassert(wasCanceled, 'Expected to be canceled when hitting limit');\n\t\t});\n\n\t\ttest('provider returns maxResults exactly', async () => {\n\t\t\tconst reportedResults = [\n\t\t\t\tjoinPath(rootFolderA, 'file1.ts'),\n\t\t\t\tjoinPath(rootFolderA, 'file2.ts'),\n\t\t\t];\n\n\t\t\tlet wasCanceled = false;\n\t\t\tawait registerTestFileSearchProvider({\n\t\t\t\tprovideFileSearchResults(query: vscode.FileSearchQuery, options: vscode.FileSearchOptions, token: vscode.CancellationToken): Promise<URI[]> {\n\t\t\t\t\tdisposables.add(token.onCancellationRequested(() => wasCanceled = true));\n\n\t\t\t\t\treturn Promise.resolve(reportedResults);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tconst query: ISearchQuery = {\n\t\t\t\ttype: QueryType.File,\n\n\t\t\t\tfilePattern: '',\n\t\t\t\tmaxResults: 2,\n\n\t\t\t\tfolderQueries: [\n\t\t\t\t\t{\n\t\t\t\t\t\tfolder: rootFolderA\n\t\t\t\t\t}\n\t\t\t\t]\n\t\t\t};\n\n\t\t\tconst { results, stats } = await runFileSearch(query);\n\t\t\tassert(!stats.limitHit, 'Expected not to return limitHit');\n\t\t\tassert.strictEqual(results.length, 2);\n\t\t\tcompareURIs(results, reportedResults);\n\t\t\tassert(!wasCanceled, 'Expected not to be canceled when just reaching limit');\n\t\t});\n\n\t\ttest('multiroot max results', async () => {\n\t\t\tlet cancels = 0;\n\t\t\tawait registerTestFileSearchProvider({\n\t\t\t\tasync provideFileSearchResults(query: vscode.FileSearchQuery, options: vscode.FileSearchOptions, token: vscode.CancellationToken): Promise<URI[]> {\n\t\t\t\t\tdisposables.add(token.onCancellationRequested(() => cancels++));\n\n\t\t\t\t\t// Provice results async so it has a chance to invoke every provider\n\t\t\t\t\tawait new Promise(r => process.nextTick(r));\n\t\t\t\t\treturn [\n\t\t\t\t\t\t'file1.ts',\n\t\t\t\t\t\t'file2.ts',\n\t\t\t\t\t\t'file3.ts',\n\t\t\t\t\t].map(relativePath => joinPath(options.folder, relativePath));\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tconst query: ISearchQuery = {\n\t\t\t\ttype: QueryType.File,\n\n\t\t\t\tfilePattern: '',\n\t\t\t\tmaxResults: 2,\n\n\t\t\t\tfolderQueries: [\n\t\t\t\t\t{\n\t\t\t\t\t\tfolder: rootFolderA\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tfolder: rootFolderB\n\t\t\t\t\t}\n\t\t\t\t]\n\t\t\t};\n\n\t\t\tconst { results } = await runFileSearch(query);\n\t\t\tassert.strictEqual(results.length, 2); // Don't care which 2 we got\n\t\t\tassert.strictEqual(cancels, 2, 'Expected all invocations to be canceled when hitting limit');\n\t\t});\n\n\t\ttest('works with non-file schemes', async () => {\n\t\t\tconst reportedResults = [\n\t\t\t\tjoinPath(fancySchemeFolderA, 'file1.ts'),\n\t\t\t\tjoinPath(fancySchemeFolderA, 'file2.ts'),\n\t\t\t\tjoinPath(fancySchemeFolderA, 'subfolder/file3.ts'),\n\n\t\t\t];\n\n\t\t\tawait registerTestFileSearchProvider({\n\t\t\t\tprovideFileSearchResults(query: vscode.FileSearchQuery, options: vscode.FileSearchOptions, token: vscode.CancellationToken): Promise<URI[]> {\n\t\t\t\t\treturn Promise.resolve(reportedResults);\n\t\t\t\t}\n\t\t\t}, fancyScheme);\n\n\t\t\tconst query: ISearchQuery = {\n\t\t\t\ttype: QueryType.File,\n\t\t\t\tfilePattern: '',\n\t\t\t\tfolderQueries: [\n\t\t\t\t\t{\n\t\t\t\t\t\tfolder: fancySchemeFolderA\n\t\t\t\t\t}\n\t\t\t\t]\n\t\t\t};\n\n\t\t\tconst { results } = await runFileSearch(query);\n\t\t\tcompareURIs(results, reportedResults);\n\t\t});\n\t\ttest('if onlyFileScheme is set, do not call custom schemes', async () => {\n\t\t\tlet fancySchemeCalled = false;\n\t\t\tawait registerTestFileSearchProvider({\n\t\t\t\tprovideFileSearchResults(query: vscode.FileSearchQuery, options: vscode.FileSearchOptions, token: vscode.CancellationToken): Promise<URI[]> {\n\t\t\t\t\tfancySchemeCalled = true;\n\t\t\t\t\treturn Promise.resolve([]);\n\t\t\t\t}\n\t\t\t}, fancyScheme);\n\n\t\t\tconst query: ISearchQuery = {\n\t\t\t\ttype: QueryType.File,\n\t\t\t\tfilePattern: '',\n\t\t\t\tfolderQueries: []\n\t\t\t};\n\n\t\t\tawait runFileSearch(query);\n\t\t\tassert(!fancySchemeCalled);\n\t\t});\n\t});\n\n\tsuite('Text:', () => {\n\n\t\tfunction makePreview(text: string): vscode.TextSearchMatch['preview'] {\n\t\t\treturn {\n\t\t\t\tmatches: [new Range(0, 0, 0, text.length)],\n\t\t\t\ttext\n\t\t\t};\n\t\t}\n\n\t\tfunction makeTextResult(baseFolder: URI, relativePath: string): vscode.TextSearchMatch {\n\t\t\treturn {\n\t\t\t\tpreview: makePreview('foo'),\n\t\t\t\tranges: [new Range(0, 0, 0, 3)],\n\t\t\t\turi: joinPath(baseFolder, relativePath)\n\t\t\t};\n\t\t}\n\n\t\tfunction getSimpleQuery(queryText: string): ITextQuery {\n\t\t\treturn {\n\t\t\t\ttype: QueryType.Text,\n\t\t\t\tcontentPattern: getPattern(queryText),\n\n\t\t\t\tfolderQueries: [\n\t\t\t\t\t{ folder: rootFolderA }\n\t\t\t\t]\n\t\t\t};\n\t\t}\n\n\t\tfunction getPattern(queryText: string): IPatternInfo {\n\t\t\treturn {\n\t\t\t\tpattern: queryText\n\t\t\t};\n\t\t}\n\n\t\tfunction assertResults(actual: IFileMatch[], expected: vscode.TextSearchResult[]) {\n\t\t\tconst actualTextSearchResults: vscode.TextSearchResult[] = [];\n\t\t\tfor (const fileMatch of actual) {\n\t\t\t\t// Make relative\n\t\t\t\tfor (const lineResult of fileMatch.results!) {\n\t\t\t\t\tif (resultIsMatch(lineResult)) {\n\t\t\t\t\t\tactualTextSearchResults.push({\n\t\t\t\t\t\t\tpreview: {\n\t\t\t\t\t\t\t\ttext: lineResult.previewText,\n\t\t\t\t\t\t\t\tmatches: mapArrayOrNot(\n\t\t\t\t\t\t\t\t\tlineResult.rangeLocations.map(r => r.preview),\n\t\t\t\t\t\t\t\t\tm => new Range(m.startLineNumber, m.startColumn, m.endLineNumber, m.endColumn))\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tranges: mapArrayOrNot(\n\t\t\t\t\t\t\t\tlineResult.rangeLocations.map(r => r.source),\n\t\t\t\t\t\t\t\tr => new Range(r.startLineNumber, r.startColumn, r.endLineNumber, r.endColumn),\n\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\turi: fileMatch.resource\n\t\t\t\t\t\t});\n\t\t\t\t\t} else {\n\t\t\t\t\t\tactualTextSearchResults.push(<vscode.TextSearchContext>{\n\t\t\t\t\t\t\ttext: lineResult.text,\n\t\t\t\t\t\t\tlineNumber: lineResult.lineNumber,\n\t\t\t\t\t\t\turi: fileMatch.resource\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tconst rangeToString = (r: vscode.Range) => `(${r.start.line}, ${r.start.character}), (${r.end.line}, ${r.end.character})`;\n\n\t\t\tconst makeComparable = (results: vscode.TextSearchResult[]) => results\n\t\t\t\t.sort((a, b) => {\n\t\t\t\t\tconst compareKeyA = a.uri.toString() + ': ' + (extensionResultIsMatch(a) ? a.preview.text : a.text);\n\t\t\t\t\tconst compareKeyB = b.uri.toString() + ': ' + (extensionResultIsMatch(b) ? b.preview.text : b.text);\n\t\t\t\t\treturn compareKeyB.localeCompare(compareKeyA);\n\t\t\t\t})\n\t\t\t\t.map(r => extensionResultIsMatch(r) ? {\n\t\t\t\t\turi: r.uri.toString(),\n\t\t\t\t\trange: mapArrayOrNot(r.ranges, rangeToString),\n\t\t\t\t\tpreview: {\n\t\t\t\t\t\ttext: r.preview.text,\n\t\t\t\t\t\tmatch: null // Don't care about this right now\n\t\t\t\t\t}\n\t\t\t\t} : {\n\t\t\t\t\turi: r.uri.toString(),\n\t\t\t\t\ttext: r.text,\n\t\t\t\t\tlineNumber: r.lineNumber\n\t\t\t\t});\n\n\t\t\treturn assert.deepStrictEqual(\n\t\t\t\tmakeComparable(actualTextSearchResults),\n\t\t\t\tmakeComparable(expected));\n\t\t}\n\n\t\ttest('no results', async () => {\n\t\t\tawait registerTestTextSearchProvider({\n\t\t\t\tprovideTextSearchResults(query: vscode.TextSearchQuery, options: vscode.TextSearchOptions, progress: vscode.Progress<vscode.TextSearchResult>, token: vscode.CancellationToken): Promise<vscode.TextSearchComplete> {\n\t\t\t\t\treturn Promise.resolve(null!);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tconst { results, stats } = await runTextSearch(getSimpleQuery('foo'));\n\t\t\tassert(!stats.limitHit);\n\t\t\tassert(!results.length);\n\t\t});\n\n\t\ttest('basic results', async () => {\n\t\t\tconst providedResults: vscode.TextSearchResult[] = [\n\t\t\t\tmakeTextResult(rootFolderA, 'file1.ts'),\n\t\t\t\tmakeTextResult(rootFolderA, 'file2.ts')\n\t\t\t];\n\n\t\t\tawait registerTestTextSearchProvider({\n\t\t\t\tprovideTextSearchResults(query: vscode.TextSearchQuery, options: vscode.TextSearchOptions, progress: vscode.Progress<vscode.TextSearchResult>, token: vscode.CancellationToken): Promise<vscode.TextSearchComplete> {\n\t\t\t\t\tprovidedResults.forEach(r => progress.report(r));\n\t\t\t\t\treturn Promise.resolve(null!);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tconst { results, stats } = await runTextSearch(getSimpleQuery('foo'));\n\t\t\tassert(!stats.limitHit);\n\t\t\tassertResults(results, providedResults);\n\t\t});\n\n\t\ttest('all provider calls get global include/excludes', async () => {\n\t\t\tawait registerTestTextSearchProvider({\n\t\t\t\tprovideTextSearchResults(query: vscode.TextSearchQuery, options: vscode.TextSearchOptions, progress: vscode.Progress<vscode.TextSearchResult>, token: vscode.CancellationToken): Promise<vscode.TextSearchComplete> {\n\t\t\t\t\tassert.strictEqual(options.includes.length, 1);\n\t\t\t\t\tassert.strictEqual(options.excludes.length, 1);\n\t\t\t\t\treturn Promise.resolve(null!);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tconst query: ITextQuery = {\n\t\t\t\ttype: QueryType.Text,\n\t\t\t\tcontentPattern: getPattern('foo'),\n\n\t\t\t\tincludePattern: {\n\t\t\t\t\t'*.ts': true\n\t\t\t\t},\n\n\t\t\t\texcludePattern: {\n\t\t\t\t\t'*.js': true\n\t\t\t\t},\n\n\t\t\t\tfolderQueries: [\n\t\t\t\t\t{ folder: rootFolderA },\n\t\t\t\t\t{ folder: rootFolderB }\n\t\t\t\t]\n\t\t\t};\n\n\t\t\tawait runTextSearch(query);\n\t\t});\n\n\t\ttest('global/local include/excludes combined', async () => {\n\t\t\tawait registerTestTextSearchProvider({\n\t\t\t\tprovideTextSearchResults(query: vscode.TextSearchQuery, options: vscode.TextSearchOptions, progress: vscode.Progress<vscode.TextSearchResult>, token: vscode.CancellationToken): Promise<vscode.TextSearchComplete> {\n\t\t\t\t\tif (options.folder.toString() === rootFolderA.toString()) {\n\t\t\t\t\t\tassert.deepStrictEqual(options.includes.sort(), ['*.ts', 'foo']);\n\t\t\t\t\t\tassert.deepStrictEqual(options.excludes.sort(), ['*.js', 'bar']);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tassert.deepStrictEqual(options.includes.sort(), ['*.ts']);\n\t\t\t\t\t\tassert.deepStrictEqual(options.excludes.sort(), ['*.js']);\n\t\t\t\t\t}\n\n\t\t\t\t\treturn Promise.resolve(null!);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tconst query: ITextQuery = {\n\t\t\t\ttype: QueryType.Text,\n\t\t\t\tcontentPattern: getPattern('foo'),\n\n\t\t\t\tincludePattern: {\n\t\t\t\t\t'*.ts': true\n\t\t\t\t},\n\t\t\t\texcludePattern: {\n\t\t\t\t\t'*.js': true\n\t\t\t\t},\n\t\t\t\tfolderQueries: [\n\t\t\t\t\t{\n\t\t\t\t\t\tfolder: rootFolderA,\n\t\t\t\t\t\tincludePattern: {\n\t\t\t\t\t\t\t'foo': true\n\t\t\t\t\t\t},\n\t\t\t\t\t\texcludePattern: [{\n\t\t\t\t\t\t\tpattern: {\n\t\t\t\t\t\t\t\t'bar': true\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}]\n\t\t\t\t\t},\n\t\t\t\t\t{ folder: rootFolderB }\n\t\t\t\t]\n\t\t\t};\n\n\t\t\tawait runTextSearch(query);\n\t\t});\n\n\t\ttest('include/excludes resolved correctly', async () => {\n\t\t\tawait registerTestTextSearchProvider({\n\t\t\t\tprovideTextSearchResults(query: vscode.TextSearchQuery, options: vscode.TextSearchOptions, progress: vscode.Progress<vscode.TextSearchResult>, token: vscode.CancellationToken): Promise<vscode.TextSearchComplete> {\n\t\t\t\t\tassert.deepStrictEqual(options.includes.sort(), ['*.jsx', '*.ts']);\n\t\t\t\t\tassert.deepStrictEqual(options.excludes.sort(), []);\n\n\t\t\t\t\treturn Promise.resolve(null!);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tconst query: ISearchQuery = {\n\t\t\t\ttype: QueryType.Text,\n\t\t\t\tcontentPattern: getPattern('foo'),\n\n\t\t\t\tincludePattern: {\n\t\t\t\t\t'*.ts': true,\n\t\t\t\t\t'*.jsx': false\n\t\t\t\t},\n\t\t\t\texcludePattern: {\n\t\t\t\t\t'*.js': true,\n\t\t\t\t\t'*.tsx': false\n\t\t\t\t},\n\t\t\t\tfolderQueries: [\n\t\t\t\t\t{\n\t\t\t\t\t\tfolder: rootFolderA,\n\t\t\t\t\t\tincludePattern: {\n\t\t\t\t\t\t\t'*.jsx': true\n\t\t\t\t\t\t},\n\t\t\t\t\t\texcludePattern: [{\n\t\t\t\t\t\t\tpattern: {\n\t\t\t\t\t\t\t\t'*.js': false\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}]\n\t\t\t\t\t}\n\t\t\t\t]\n\t\t\t};\n\n\t\t\tawait runTextSearch(query);\n\t\t});\n\n\t\ttest('provider fail', async () => {\n\t\t\tawait registerTestTextSearchProvider({\n\t\t\t\tprovideTextSearchResults(query: vscode.TextSearchQuery, options: vscode.TextSearchOptions, progress: vscode.Progress<vscode.TextSearchResult>, token: vscode.CancellationToken): Promise<vscode.TextSearchComplete> {\n\t\t\t\t\tthrow new Error('Provider fail');\n\t\t\t\t}\n\t\t\t});\n\n\t\t\ttry {\n\t\t\t\tawait runTextSearch(getSimpleQuery('foo'));\n\t\t\t\tassert(false, 'Expected to fail');\n\t\t\t} catch {\n\t\t\t\t// expected to fail\n\t\t\t}\n\t\t});\n\n\t\ttest('basic sibling clause', async () => {\n\t\t\t// eslint-disable-next-line local/code-no-any-casts\n\t\t\t(mockPFS as any).Promises = {\n\t\t\t\treaddir: (_path: string): any => {\n\t\t\t\t\tif (_path === rootFolderA.fsPath) {\n\t\t\t\t\t\treturn Promise.resolve([\n\t\t\t\t\t\t\t'file1.js',\n\t\t\t\t\t\t\t'file1.ts'\n\t\t\t\t\t\t]);\n\t\t\t\t\t} else {\n\t\t\t\t\t\treturn Promise.reject(new Error('Wrong path'));\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tconst providedResults: vscode.TextSearchResult[] = [\n\t\t\t\tmakeTextResult(rootFolderA, 'file1.js'),\n\t\t\t\tmakeTextResult(rootFolderA, 'file1.ts')\n\t\t\t];\n\n\t\t\tawait registerTestTextSearchProvider({\n\t\t\t\tprovideTextSearchResults(query: vscode.TextSearchQuery, options: vscode.TextSearchOptions, progress: vscode.Progress<vscode.TextSearchResult>, token: vscode.CancellationToken): Promise<vscode.TextSearchComplete> {\n\t\t\t\t\tprovidedResults.forEach(r => progress.report(r));\n\t\t\t\t\treturn Promise.resolve(null!);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tconst query: ISearchQuery = {\n\t\t\t\ttype: QueryType.Text,\n\t\t\t\tcontentPattern: getPattern('foo'),\n\n\t\t\t\texcludePattern: {\n\t\t\t\t\t'*.js': {\n\t\t\t\t\t\twhen: '$(basename).ts'\n\t\t\t\t\t}\n\t\t\t\t},\n\n\t\t\t\tfolderQueries: [\n\t\t\t\t\t{ folder: rootFolderA }\n\t\t\t\t]\n\t\t\t};\n\n\t\t\tconst { results } = await runTextSearch(query);\n\t\t\tassertResults(results, providedResults.slice(1));\n\t\t});\n\n\t\ttest('multiroot sibling clause', async () => {\n\t\t\t// eslint-disable-next-line local/code-no-any-casts\n\t\t\t(mockPFS as any).Promises = {\n\t\t\t\treaddir: (_path: string): any => {\n\t\t\t\t\tif (_path === joinPath(rootFolderA, 'folder').fsPath) {\n\t\t\t\t\t\treturn Promise.resolve([\n\t\t\t\t\t\t\t'fileA.scss',\n\t\t\t\t\t\t\t'fileA.css',\n\t\t\t\t\t\t\t'file2.css'\n\t\t\t\t\t\t]);\n\t\t\t\t\t} else if (_path === rootFolderB.fsPath) {\n\t\t\t\t\t\treturn Promise.resolve([\n\t\t\t\t\t\t\t'fileB.ts',\n\t\t\t\t\t\t\t'fileB.js',\n\t\t\t\t\t\t\t'file3.js'\n\t\t\t\t\t\t]);\n\t\t\t\t\t} else {\n\t\t\t\t\t\treturn Promise.reject(new Error('Wrong path'));\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tawait registerTestTextSearchProvider({\n\t\t\t\tprovideTextSearchResults(query: vscode.TextSearchQuery, options: vscode.TextSearchOptions, progress: vscode.Progress<vscode.TextSearchResult>, token: vscode.CancellationToken): Promise<vscode.TextSearchComplete> {\n\t\t\t\t\tlet reportedResults;\n\t\t\t\t\tif (options.folder.fsPath === rootFolderA.fsPath) {\n\t\t\t\t\t\treportedResults = [\n\t\t\t\t\t\t\tmakeTextResult(rootFolderA, 'folder/fileA.scss'),\n\t\t\t\t\t\t\tmakeTextResult(rootFolderA, 'folder/fileA.css'),\n\t\t\t\t\t\t\tmakeTextResult(rootFolderA, 'folder/file2.css')\n\t\t\t\t\t\t];\n\t\t\t\t\t} else {\n\t\t\t\t\t\treportedResults = [\n\t\t\t\t\t\t\tmakeTextResult(rootFolderB, 'fileB.ts'),\n\t\t\t\t\t\t\tmakeTextResult(rootFolderB, 'fileB.js'),\n\t\t\t\t\t\t\tmakeTextResult(rootFolderB, 'file3.js')\n\t\t\t\t\t\t];\n\t\t\t\t\t}\n\n\t\t\t\t\treportedResults.forEach(r => progress.report(r));\n\t\t\t\t\treturn Promise.resolve(null!);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tconst query: ISearchQuery = {\n\t\t\t\ttype: QueryType.Text,\n\t\t\t\tcontentPattern: getPattern('foo'),\n\n\t\t\t\texcludePattern: {\n\t\t\t\t\t'*.js': {\n\t\t\t\t\t\twhen: '$(basename).ts'\n\t\t\t\t\t},\n\t\t\t\t\t'*.css': true\n\t\t\t\t},\n\t\t\t\tfolderQueries: [\n\t\t\t\t\t{\n\t\t\t\t\t\tfolder: rootFolderA,\n\t\t\t\t\t\texcludePattern: [{\n\t\t\t\t\t\t\tpattern: {\n\t\t\t\t\t\t\t\t'folder/*.css': {\n\t\t\t\t\t\t\t\t\twhen: '$(basename).scss'\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}]\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tfolder: rootFolderB,\n\t\t\t\t\t\texcludePattern: [{\n\t\t\t\t\t\t\tpattern: {\n\t\t\t\t\t\t\t\t'*.js': false\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}]\n\t\t\t\t\t}\n\t\t\t\t]\n\t\t\t};\n\n\t\t\tconst { results } = await runTextSearch(query);\n\t\t\tassertResults(results, [\n\t\t\t\tmakeTextResult(rootFolderA, 'folder/fileA.scss'),\n\t\t\t\tmakeTextResult(rootFolderA, 'folder/file2.css'),\n\t\t\t\tmakeTextResult(rootFolderB, 'fileB.ts'),\n\t\t\t\tmakeTextResult(rootFolderB, 'fileB.js'),\n\t\t\t\tmakeTextResult(rootFolderB, 'file3.js')]);\n\t\t});\n\n\t\ttest('include pattern applied', async () => {\n\t\t\tconst providedResults: vscode.TextSearchResult[] = [\n\t\t\t\tmakeTextResult(rootFolderA, 'file1.js'),\n\t\t\t\tmakeTextResult(rootFolderA, 'file1.ts')\n\t\t\t];\n\n\t\t\tawait registerTestTextSearchProvider({\n\t\t\t\tprovideTextSearchResults(query: vscode.TextSearchQuery, options: vscode.TextSearchOptions, progress: vscode.Progress<vscode.TextSearchResult>, token: vscode.CancellationToken): Promise<vscode.TextSearchComplete> {\n\t\t\t\t\tprovidedResults.forEach(r => progress.report(r));\n\t\t\t\t\treturn Promise.resolve(null!);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tconst query: ISearchQuery = {\n\t\t\t\ttype: QueryType.Text,\n\t\t\t\tcontentPattern: getPattern('foo'),\n\n\t\t\t\tincludePattern: {\n\t\t\t\t\t'*.ts': true\n\t\t\t\t},\n\n\t\t\t\tfolderQueries: [\n\t\t\t\t\t{ folder: rootFolderA }\n\t\t\t\t]\n\t\t\t};\n\n\t\t\tconst { results } = await runTextSearch(query);\n\t\t\tassertResults(results, providedResults.slice(1));\n\t\t});\n\n\t\ttest('max results = 1', async () => {\n\t\t\tconst providedResults: vscode.TextSearchResult[] = [\n\t\t\t\tmakeTextResult(rootFolderA, 'file1.ts'),\n\t\t\t\tmakeTextResult(rootFolderA, 'file2.ts')\n\t\t\t];\n\n\t\t\tlet wasCanceled = false;\n\t\t\tawait registerTestTextSearchProvider({\n\t\t\t\tprovideTextSearchResults(query: vscode.TextSearchQuery, options: vscode.TextSearchOptions, progress: vscode.Progress<vscode.TextSearchResult>, token: vscode.CancellationToken): Promise<vscode.TextSearchComplete> {\n\t\t\t\t\tdisposables.add(token.onCancellationRequested(() => wasCanceled = true));\n\t\t\t\t\tprovidedResults.forEach(r => progress.report(r));\n\t\t\t\t\treturn Promise.resolve(null!);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tconst query: ISearchQuery = {\n\t\t\t\ttype: QueryType.Text,\n\t\t\t\tcontentPattern: getPattern('foo'),\n\n\t\t\t\tmaxResults: 1,\n\n\t\t\t\tfolderQueries: [\n\t\t\t\t\t{ folder: rootFolderA }\n\t\t\t\t]\n\t\t\t};\n\n\t\t\tconst { results, stats } = await runTextSearch(query);\n\t\t\tassert(stats.limitHit, 'Expected to return limitHit');\n\t\t\tassertResults(results, providedResults.slice(0, 1));\n\t\t\tassert(wasCanceled, 'Expected to be canceled');\n\t\t});\n\n\t\ttest('max results = 2', async () => {\n\t\t\tconst providedResults: vscode.TextSearchResult[] = [\n\t\t\t\tmakeTextResult(rootFolderA, 'file1.ts'),\n\t\t\t\tmakeTextResult(rootFolderA, 'file2.ts'),\n\t\t\t\tmakeTextResult(rootFolderA, 'file3.ts')\n\t\t\t];\n\n\t\t\tlet wasCanceled = false;\n\t\t\tawait registerTestTextSearchProvider({\n\t\t\t\tprovideTextSearchResults(query: vscode.TextSearchQuery, options: vscode.TextSearchOptions, progress: vscode.Progress<vscode.TextSearchResult>, token: vscode.CancellationToken): Promise<vscode.TextSearchComplete> {\n\t\t\t\t\tdisposables.add(token.onCancellationRequested(() => wasCanceled = true));\n\t\t\t\t\tprovidedResults.forEach(r => progress.report(r));\n\t\t\t\t\treturn Promise.resolve(null!);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tconst query: ISearchQuery = {\n\t\t\t\ttype: QueryType.Text,\n\t\t\t\tcontentPattern: getPattern('foo'),\n\n\t\t\t\tmaxResults: 2,\n\n\t\t\t\tfolderQueries: [\n\t\t\t\t\t{ folder: rootFolderA }\n\t\t\t\t]\n\t\t\t};\n\n\t\t\tconst { results, stats } = await runTextSearch(query);\n\t\t\tassert(stats.limitHit, 'Expected to return limitHit');\n\t\t\tassertResults(results, providedResults.slice(0, 2));\n\t\t\tassert(wasCanceled, 'Expected to be canceled');\n\t\t});\n\n\t\ttest('provider returns maxResults exactly', async () => {\n\t\t\tconst providedResults: vscode.TextSearchResult[] = [\n\t\t\t\tmakeTextResult(rootFolderA, 'file1.ts'),\n\t\t\t\tmakeTextResult(rootFolderA, 'file2.ts')\n\t\t\t];\n\n\t\t\tlet wasCanceled = false;\n\t\t\tawait registerTestTextSearchProvider({\n\t\t\t\tprovideTextSearchResults(query: vscode.TextSearchQuery, options: vscode.TextSearchOptions, progress: vscode.Progress<vscode.TextSearchResult>, token: vscode.CancellationToken): Promise<vscode.TextSearchComplete> {\n\t\t\t\t\tdisposables.add(token.onCancellationRequested(() => wasCanceled = true));\n\t\t\t\t\tprovidedResults.forEach(r => progress.report(r));\n\t\t\t\t\treturn Promise.resolve(null!);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tconst query: ISearchQuery = {\n\t\t\t\ttype: QueryType.Text,\n\t\t\t\tcontentPattern: getPattern('foo'),\n\n\t\t\t\tmaxResults: 2,\n\n\t\t\t\tfolderQueries: [\n\t\t\t\t\t{ folder: rootFolderA }\n\t\t\t\t]\n\t\t\t};\n\n\t\t\tconst { results, stats } = await runTextSearch(query);\n\t\t\tassert(!stats.limitHit, 'Expected not to return limitHit');\n\t\t\tassertResults(results, providedResults);\n\t\t\tassert(!wasCanceled, 'Expected not to be canceled');\n\t\t});\n\n\t\ttest('provider returns early with limitHit', async () => {\n\t\t\tconst providedResults: vscode.TextSearchResult[] = [\n\t\t\t\tmakeTextResult(rootFolderA, 'file1.ts'),\n\t\t\t\tmakeTextResult(rootFolderA, 'file2.ts'),\n\t\t\t\tmakeTextResult(rootFolderA, 'file3.ts')\n\t\t\t];\n\n\t\t\tawait registerTestTextSearchProvider({\n\t\t\t\tprovideTextSearchResults(query: vscode.TextSearchQuery, options: vscode.TextSearchOptions, progress: vscode.Progress<vscode.TextSearchResult>, token: vscode.CancellationToken): Promise<vscode.TextSearchComplete> {\n\t\t\t\t\tprovidedResults.forEach(r => progress.report(r));\n\t\t\t\t\treturn Promise.resolve({ limitHit: true });\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tconst query: ISearchQuery = {\n\t\t\t\ttype: QueryType.Text,\n\t\t\t\tcontentPattern: getPattern('foo'),\n\n\t\t\t\tmaxResults: 1000,\n\n\t\t\t\tfolderQueries: [\n\t\t\t\t\t{ folder: rootFolderA }\n\t\t\t\t]\n\t\t\t};\n\n\t\t\tconst { results, stats } = await runTextSearch(query);\n\t\t\tassert(stats.limitHit, 'Expected to return limitHit');\n\t\t\tassertResults(results, providedResults);\n\t\t});\n\n\t\ttest('multiroot max results', async () => {\n\t\t\tlet cancels = 0;\n\t\t\tawait registerTestTextSearchProvider({\n\t\t\t\tasync provideTextSearchResults(query: vscode.TextSearchQuery, options: vscode.TextSearchOptions, progress: vscode.Progress<vscode.TextSearchResult>, token: vscode.CancellationToken): Promise<vscode.TextSearchComplete> {\n\t\t\t\t\tdisposables.add(token.onCancellationRequested(() => cancels++));\n\t\t\t\t\tawait new Promise(r => process.nextTick(r));\n\t\t\t\t\t[\n\t\t\t\t\t\t'file1.ts',\n\t\t\t\t\t\t'file2.ts',\n\t\t\t\t\t\t'file3.ts',\n\t\t\t\t\t].forEach(f => progress.report(makeTextResult(options.folder, f)));\n\t\t\t\t\treturn null!;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tconst query: ISearchQuery = {\n\t\t\t\ttype: QueryType.Text,\n\t\t\t\tcontentPattern: getPattern('foo'),\n\n\t\t\t\tmaxResults: 2,\n\n\t\t\t\tfolderQueries: [\n\t\t\t\t\t{ folder: rootFolderA },\n\t\t\t\t\t{ folder: rootFolderB }\n\t\t\t\t]\n\t\t\t};\n\n\t\t\tconst { results } = await runTextSearch(query);\n\t\t\tassert.strictEqual(results.length, 2);\n\t\t\tassert.strictEqual(cancels, 2);\n\t\t});\n\n\t\ttest('works with non-file schemes', async () => {\n\t\t\tconst providedResults: vscode.TextSearchResult[] = [\n\t\t\t\tmakeTextResult(fancySchemeFolderA, 'file1.ts'),\n\t\t\t\tmakeTextResult(fancySchemeFolderA, 'file2.ts'),\n\t\t\t\tmakeTextResult(fancySchemeFolderA, 'file3.ts')\n\t\t\t];\n\n\t\t\tawait registerTestTextSearchProvider({\n\t\t\t\tprovideTextSearchResults(query: vscode.TextSearchQuery, options: vscode.TextSearchOptions, progress: vscode.Progress<vscode.TextSearchResult>, token: vscode.CancellationToken): Promise<vscode.TextSearchComplete> {\n\t\t\t\t\tprovidedResults.forEach(r => progress.report(r));\n\t\t\t\t\treturn Promise.resolve(null!);\n\t\t\t\t}\n\t\t\t}, fancyScheme);\n\n\t\t\tconst query: ISearchQuery = {\n\t\t\t\ttype: QueryType.Text,\n\t\t\t\tcontentPattern: getPattern('foo'),\n\n\t\t\t\tfolderQueries: [\n\t\t\t\t\t{ folder: fancySchemeFolderA }\n\t\t\t\t]\n\t\t\t};\n\n\t\t\tconst { results } = await runTextSearch(query);\n\t\t\tassertResults(results, providedResults);\n\t\t});\n\t});\n});\n"]}