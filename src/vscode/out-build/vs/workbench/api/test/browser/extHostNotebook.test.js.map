{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/api/test/browser/extHostNotebook.test.ts","vs/workbench/api/test/browser/extHostNotebook.test.ts"],"names":[],"mappings":"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","file":"extHostNotebook.test.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport assert from 'assert';\nimport * as vscode from 'vscode';\nimport { ExtHostDocumentsAndEditors } from '../../common/extHostDocumentsAndEditors.js';\nimport { TestRPCProtocol } from '../common/testRPCProtocol.js';\nimport { DisposableStore } from '../../../../base/common/lifecycle.js';\nimport { NullLogService } from '../../../../platform/log/common/log.js';\nimport { mock } from '../../../../base/test/common/mock.js';\nimport { IModelAddedData, MainContext, MainThreadCommandsShape, MainThreadNotebookShape, NotebookCellsChangedEventDto, NotebookOutputItemDto } from '../../common/extHost.protocol.js';\nimport { ExtHostNotebookController } from '../../common/extHostNotebook.js';\nimport { ExtHostNotebookDocument } from '../../common/extHostNotebookDocument.js';\nimport { CellKind, CellUri, NotebookCellsChangeType } from '../../../contrib/notebook/common/notebookCommon.js';\nimport { URI } from '../../../../base/common/uri.js';\nimport { ExtHostDocuments } from '../../common/extHostDocuments.js';\nimport { ExtHostCommands } from '../../common/extHostCommands.js';\nimport { nullExtensionDescription } from '../../../services/extensions/common/extensions.js';\nimport { isEqual } from '../../../../base/common/resources.js';\nimport { Event } from '../../../../base/common/event.js';\nimport { ExtHostNotebookDocuments } from '../../common/extHostNotebookDocuments.js';\nimport { SerializableObjectWithBuffers } from '../../../services/extensions/common/proxyIdentifier.js';\nimport { VSBuffer } from '../../../../base/common/buffer.js';\nimport { IExtHostTelemetry } from '../../common/extHostTelemetry.js';\nimport { ExtHostConsumerFileSystem } from '../../common/extHostFileSystemConsumer.js';\nimport { ExtHostFileSystemInfo } from '../../common/extHostFileSystemInfo.js';\nimport { ensureNoDisposablesAreLeakedInTestSuite } from '../../../../base/test/common/utils.js';\nimport { ExtHostSearch } from '../../common/extHostSearch.js';\nimport { URITransformerService } from '../../common/extHostUriTransformerService.js';\n\nsuite('NotebookCell#Document', function () {\n\tlet rpcProtocol: TestRPCProtocol;\n\tlet notebook: ExtHostNotebookDocument;\n\tlet extHostDocumentsAndEditors: ExtHostDocumentsAndEditors;\n\tlet extHostDocuments: ExtHostDocuments;\n\tlet extHostNotebooks: ExtHostNotebookController;\n\tlet extHostNotebookDocuments: ExtHostNotebookDocuments;\n\tlet extHostConsumerFileSystem: ExtHostConsumerFileSystem;\n\tlet extHostSearch: ExtHostSearch;\n\n\tconst notebookUri = URI.parse('test:///notebook.file');\n\tconst disposables = new DisposableStore();\n\n\tteardown(function () {\n\t\tdisposables.clear();\n\t});\n\n\tensureNoDisposablesAreLeakedInTestSuite();\n\n\tsetup(async function () {\n\t\trpcProtocol = new TestRPCProtocol();\n\t\trpcProtocol.set(MainContext.MainThreadCommands, new class extends mock<MainThreadCommandsShape>() {\n\t\t\toverride $registerCommand() { }\n\t\t});\n\t\trpcProtocol.set(MainContext.MainThreadNotebook, new class extends mock<MainThreadNotebookShape>() {\n\t\t\toverride async $registerNotebookSerializer() { }\n\t\t\toverride async $unregisterNotebookSerializer() { }\n\t\t});\n\t\textHostDocumentsAndEditors = new ExtHostDocumentsAndEditors(rpcProtocol, new NullLogService());\n\t\textHostDocuments = new ExtHostDocuments(rpcProtocol, extHostDocumentsAndEditors);\n\t\textHostConsumerFileSystem = new ExtHostConsumerFileSystem(rpcProtocol, new ExtHostFileSystemInfo());\n\t\textHostSearch = new ExtHostSearch(rpcProtocol, new URITransformerService(null), new NullLogService());\n\t\textHostNotebooks = new ExtHostNotebookController(rpcProtocol, new ExtHostCommands(rpcProtocol, new NullLogService(), new class extends mock<IExtHostTelemetry>() {\n\t\t\toverride onExtensionError(): boolean {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}), extHostDocumentsAndEditors, extHostDocuments, extHostConsumerFileSystem, extHostSearch, new NullLogService());\n\t\textHostNotebookDocuments = new ExtHostNotebookDocuments(extHostNotebooks);\n\n\t\tconst reg = extHostNotebooks.registerNotebookSerializer(nullExtensionDescription, 'test', new class extends mock<vscode.NotebookSerializer>() { });\n\t\textHostNotebooks.$acceptDocumentAndEditorsDelta(new SerializableObjectWithBuffers({\n\t\t\taddedDocuments: [{\n\t\t\t\turi: notebookUri,\n\t\t\t\tviewType: 'test',\n\t\t\t\tversionId: 0,\n\t\t\t\tcells: [{\n\t\t\t\t\thandle: 0,\n\t\t\t\t\turi: CellUri.generate(notebookUri, 0),\n\t\t\t\t\tsource: ['### Heading'],\n\t\t\t\t\teol: '\\n',\n\t\t\t\t\tlanguage: 'markdown',\n\t\t\t\t\tcellKind: CellKind.Markup,\n\t\t\t\t\toutputs: [],\n\t\t\t\t}, {\n\t\t\t\t\thandle: 1,\n\t\t\t\t\turi: CellUri.generate(notebookUri, 1),\n\t\t\t\t\tsource: ['console.log(\"aaa\")', 'console.log(\"bbb\")'],\n\t\t\t\t\teol: '\\n',\n\t\t\t\t\tlanguage: 'javascript',\n\t\t\t\t\tcellKind: CellKind.Code,\n\t\t\t\t\toutputs: [],\n\t\t\t\t}],\n\t\t\t}],\n\t\t\taddedEditors: [{\n\t\t\t\tdocumentUri: notebookUri,\n\t\t\t\tid: '_notebook_editor_0',\n\t\t\t\tselections: [{ start: 0, end: 1 }],\n\t\t\t\tvisibleRanges: [],\n\t\t\t\tviewType: 'test'\n\t\t\t}]\n\t\t}));\n\t\textHostNotebooks.$acceptDocumentAndEditorsDelta(new SerializableObjectWithBuffers({ newActiveEditor: '_notebook_editor_0' }));\n\n\t\tnotebook = extHostNotebooks.notebookDocuments[0]!;\n\n\t\tdisposables.add(reg);\n\t\tdisposables.add(notebook);\n\t\tdisposables.add(extHostDocuments);\n\t});\n\n\n\ttest('cell document is vscode.TextDocument', async function () {\n\n\t\tassert.strictEqual(notebook.apiNotebook.cellCount, 2);\n\n\t\tconst [c1, c2] = notebook.apiNotebook.getCells();\n\t\tconst d1 = extHostDocuments.getDocument(c1.document.uri);\n\n\t\tassert.ok(d1);\n\t\tassert.strictEqual(d1.languageId, c1.document.languageId);\n\t\tassert.strictEqual(d1.version, 1);\n\n\t\tconst d2 = extHostDocuments.getDocument(c2.document.uri);\n\t\tassert.ok(d2);\n\t\tassert.strictEqual(d2.languageId, c2.document.languageId);\n\t\tassert.strictEqual(d2.version, 1);\n\t});\n\n\ttest('cell document goes when notebook closes', async function () {\n\t\tconst cellUris: string[] = [];\n\t\tfor (const cell of notebook.apiNotebook.getCells()) {\n\t\t\tassert.ok(extHostDocuments.getDocument(cell.document.uri));\n\t\t\tcellUris.push(cell.document.uri.toString());\n\t\t}\n\n\t\tconst removedCellUris: string[] = [];\n\t\tconst reg = extHostDocuments.onDidRemoveDocument(doc => {\n\t\t\tremovedCellUris.push(doc.uri.toString());\n\t\t});\n\n\t\textHostNotebooks.$acceptDocumentAndEditorsDelta(new SerializableObjectWithBuffers({ removedDocuments: [notebook.uri] }));\n\t\treg.dispose();\n\n\t\tassert.strictEqual(removedCellUris.length, 2);\n\t\tassert.deepStrictEqual(removedCellUris.sort(), cellUris.sort());\n\t});\n\n\ttest('cell document is vscode.TextDocument after changing it', async function () {\n\n\t\tconst p = new Promise<void>((resolve, reject) => {\n\n\t\t\tdisposables.add(extHostNotebookDocuments.onDidChangeNotebookDocument(e => {\n\t\t\t\ttry {\n\t\t\t\t\tassert.strictEqual(e.contentChanges.length, 1);\n\t\t\t\t\tassert.strictEqual(e.contentChanges[0].addedCells.length, 2);\n\n\t\t\t\t\tconst [first, second] = e.contentChanges[0].addedCells;\n\n\t\t\t\t\tconst doc1 = extHostDocuments.getAllDocumentData().find(data => isEqual(data.document.uri, first.document.uri));\n\t\t\t\t\tassert.ok(doc1);\n\t\t\t\t\tassert.strictEqual(doc1?.document === first.document, true);\n\n\t\t\t\t\tconst doc2 = extHostDocuments.getAllDocumentData().find(data => isEqual(data.document.uri, second.document.uri));\n\t\t\t\t\tassert.ok(doc2);\n\t\t\t\t\tassert.strictEqual(doc2?.document === second.document, true);\n\n\t\t\t\t\tresolve();\n\n\t\t\t\t} catch (err) {\n\t\t\t\t\treject(err);\n\t\t\t\t}\n\t\t\t}));\n\n\t\t});\n\n\t\textHostNotebookDocuments.$acceptModelChanged(notebookUri, new SerializableObjectWithBuffers({\n\t\t\tversionId: notebook.apiNotebook.version + 1,\n\t\t\trawEvents: [\n\t\t\t\t{\n\t\t\t\t\tkind: NotebookCellsChangeType.ModelChange,\n\t\t\t\t\tchanges: [[0, 0, [{\n\t\t\t\t\t\thandle: 2,\n\t\t\t\t\t\turi: CellUri.generate(notebookUri, 2),\n\t\t\t\t\t\tsource: ['Hello', 'World', 'Hello World!'],\n\t\t\t\t\t\teol: '\\n',\n\t\t\t\t\t\tlanguage: 'test',\n\t\t\t\t\t\tcellKind: CellKind.Code,\n\t\t\t\t\t\toutputs: [],\n\t\t\t\t\t}, {\n\t\t\t\t\t\thandle: 3,\n\t\t\t\t\t\turi: CellUri.generate(notebookUri, 3),\n\t\t\t\t\t\tsource: ['Hallo', 'Welt', 'Hallo Welt!'],\n\t\t\t\t\t\teol: '\\n',\n\t\t\t\t\t\tlanguage: 'test',\n\t\t\t\t\t\tcellKind: CellKind.Code,\n\t\t\t\t\t\toutputs: [],\n\t\t\t\t\t}]]]\n\t\t\t\t}\n\t\t\t]\n\t\t}), false);\n\n\t\tawait p;\n\n\t});\n\n\ttest('cell document stays open when notebook is still open', async function () {\n\n\t\tconst docs: vscode.TextDocument[] = [];\n\t\tconst addData: IModelAddedData[] = [];\n\t\tfor (const cell of notebook.apiNotebook.getCells()) {\n\t\t\tconst doc = extHostDocuments.getDocument(cell.document.uri);\n\t\t\tassert.ok(doc);\n\t\t\tassert.strictEqual(extHostDocuments.getDocument(cell.document.uri).isClosed, false);\n\t\t\tdocs.push(doc);\n\t\t\taddData.push({\n\t\t\t\tEOL: '\\n',\n\t\t\t\tisDirty: doc.isDirty,\n\t\t\t\tlines: doc.getText().split('\\n'),\n\t\t\t\tlanguageId: doc.languageId,\n\t\t\t\turi: doc.uri,\n\t\t\t\tversionId: doc.version,\n\t\t\t\tencoding: 'utf8'\n\t\t\t});\n\t\t}\n\n\t\t// this call happens when opening a document on the main side\n\t\textHostDocumentsAndEditors.$acceptDocumentsAndEditorsDelta({ addedDocuments: addData });\n\n\t\t// this call happens when closing a document from the main side\n\t\textHostDocumentsAndEditors.$acceptDocumentsAndEditorsDelta({ removedDocuments: docs.map(d => d.uri) });\n\n\t\t// notebook is still open -> cell documents stay open\n\t\tfor (const cell of notebook.apiNotebook.getCells()) {\n\t\t\tassert.ok(extHostDocuments.getDocument(cell.document.uri));\n\t\t\tassert.strictEqual(extHostDocuments.getDocument(cell.document.uri).isClosed, false);\n\t\t}\n\n\t\t// close notebook -> docs are closed\n\t\textHostNotebooks.$acceptDocumentAndEditorsDelta(new SerializableObjectWithBuffers({ removedDocuments: [notebook.uri] }));\n\t\tfor (const cell of notebook.apiNotebook.getCells()) {\n\t\t\tassert.throws(() => extHostDocuments.getDocument(cell.document.uri));\n\t\t}\n\t\tfor (const doc of docs) {\n\t\t\tassert.strictEqual(doc.isClosed, true);\n\t\t}\n\t});\n\n\ttest('cell document goes when cell is removed', async function () {\n\n\t\tassert.strictEqual(notebook.apiNotebook.cellCount, 2);\n\t\tconst [cell1, cell2] = notebook.apiNotebook.getCells();\n\n\t\textHostNotebookDocuments.$acceptModelChanged(notebook.uri, new SerializableObjectWithBuffers({\n\t\t\tversionId: 2,\n\t\t\trawEvents: [\n\t\t\t\t{\n\t\t\t\t\tkind: NotebookCellsChangeType.ModelChange,\n\t\t\t\t\tchanges: [[0, 1, []]]\n\t\t\t\t}\n\t\t\t]\n\t\t}), false);\n\n\t\tassert.strictEqual(notebook.apiNotebook.cellCount, 1);\n\t\tassert.strictEqual(cell1.document.isClosed, true); // ref still alive!\n\t\tassert.strictEqual(cell2.document.isClosed, false);\n\n\t\tassert.throws(() => extHostDocuments.getDocument(cell1.document.uri));\n\t});\n\n\ttest('cell#index', function () {\n\n\t\tassert.strictEqual(notebook.apiNotebook.cellCount, 2);\n\t\tconst [first, second] = notebook.apiNotebook.getCells();\n\t\tassert.strictEqual(first.index, 0);\n\t\tassert.strictEqual(second.index, 1);\n\n\t\t// remove first cell\n\t\textHostNotebookDocuments.$acceptModelChanged(notebook.uri, new SerializableObjectWithBuffers({\n\t\t\tversionId: notebook.apiNotebook.version + 1,\n\t\t\trawEvents: [{\n\t\t\t\tkind: NotebookCellsChangeType.ModelChange,\n\t\t\t\tchanges: [[0, 1, []]]\n\t\t\t}]\n\t\t}), false);\n\n\t\tassert.strictEqual(notebook.apiNotebook.cellCount, 1);\n\t\tassert.strictEqual(second.index, 0);\n\n\t\textHostNotebookDocuments.$acceptModelChanged(notebookUri, new SerializableObjectWithBuffers({\n\t\t\tversionId: notebook.apiNotebook.version + 1,\n\t\t\trawEvents: [{\n\t\t\t\tkind: NotebookCellsChangeType.ModelChange,\n\t\t\t\tchanges: [[0, 0, [{\n\t\t\t\t\thandle: 2,\n\t\t\t\t\turi: CellUri.generate(notebookUri, 2),\n\t\t\t\t\tsource: ['Hello', 'World', 'Hello World!'],\n\t\t\t\t\teol: '\\n',\n\t\t\t\t\tlanguage: 'test',\n\t\t\t\t\tcellKind: CellKind.Code,\n\t\t\t\t\toutputs: [],\n\t\t\t\t}, {\n\t\t\t\t\thandle: 3,\n\t\t\t\t\turi: CellUri.generate(notebookUri, 3),\n\t\t\t\t\tsource: ['Hallo', 'Welt', 'Hallo Welt!'],\n\t\t\t\t\teol: '\\n',\n\t\t\t\t\tlanguage: 'test',\n\t\t\t\t\tcellKind: CellKind.Code,\n\t\t\t\t\toutputs: [],\n\t\t\t\t}]]]\n\t\t\t}]\n\t\t}), false);\n\n\t\tassert.strictEqual(notebook.apiNotebook.cellCount, 3);\n\t\tassert.strictEqual(second.index, 2);\n\t});\n\n\ttest('ERR MISSING extHostDocument for notebook cell: #116711', async function () {\n\n\t\tconst p = Event.toPromise(extHostNotebookDocuments.onDidChangeNotebookDocument);\n\n\t\t// DON'T call this, make sure the cell-documents have not been created yet\n\t\t// assert.strictEqual(notebook.notebookDocument.cellCount, 2);\n\n\t\textHostNotebookDocuments.$acceptModelChanged(notebook.uri, new SerializableObjectWithBuffers({\n\t\t\tversionId: 100,\n\t\t\trawEvents: [{\n\t\t\t\tkind: NotebookCellsChangeType.ModelChange,\n\t\t\t\tchanges: [[0, 2, [{\n\t\t\t\t\thandle: 3,\n\t\t\t\t\turi: CellUri.generate(notebookUri, 3),\n\t\t\t\t\tsource: ['### Heading'],\n\t\t\t\t\teol: '\\n',\n\t\t\t\t\tlanguage: 'markdown',\n\t\t\t\t\tcellKind: CellKind.Markup,\n\t\t\t\t\toutputs: [],\n\t\t\t\t}, {\n\t\t\t\t\thandle: 4,\n\t\t\t\t\turi: CellUri.generate(notebookUri, 4),\n\t\t\t\t\tsource: ['console.log(\"aaa\")', 'console.log(\"bbb\")'],\n\t\t\t\t\teol: '\\n',\n\t\t\t\t\tlanguage: 'javascript',\n\t\t\t\t\tcellKind: CellKind.Code,\n\t\t\t\t\toutputs: [],\n\t\t\t\t}]]]\n\t\t\t}]\n\t\t}), false);\n\n\t\tassert.strictEqual(notebook.apiNotebook.cellCount, 2);\n\n\t\tconst event = await p;\n\n\t\tassert.strictEqual(event.notebook === notebook.apiNotebook, true);\n\t\tassert.strictEqual(event.contentChanges.length, 1);\n\t\tassert.strictEqual(event.contentChanges[0].range.end - event.contentChanges[0].range.start, 2);\n\t\tassert.strictEqual(event.contentChanges[0].removedCells[0].document.isClosed, true);\n\t\tassert.strictEqual(event.contentChanges[0].removedCells[1].document.isClosed, true);\n\t\tassert.strictEqual(event.contentChanges[0].addedCells.length, 2);\n\t\tassert.strictEqual(event.contentChanges[0].addedCells[0].document.isClosed, false);\n\t\tassert.strictEqual(event.contentChanges[0].addedCells[1].document.isClosed, false);\n\t});\n\n\n\ttest('Opening a notebook results in VS Code firing the event onDidChangeActiveNotebookEditor twice #118470', function () {\n\t\tlet count = 0;\n\t\tdisposables.add(extHostNotebooks.onDidChangeActiveNotebookEditor(() => count += 1));\n\n\t\textHostNotebooks.$acceptDocumentAndEditorsDelta(new SerializableObjectWithBuffers({\n\t\t\taddedEditors: [{\n\t\t\t\tdocumentUri: notebookUri,\n\t\t\t\tid: '_notebook_editor_2',\n\t\t\t\tselections: [{ start: 0, end: 1 }],\n\t\t\t\tvisibleRanges: [],\n\t\t\t\tviewType: 'test'\n\t\t\t}]\n\t\t}));\n\n\t\textHostNotebooks.$acceptDocumentAndEditorsDelta(new SerializableObjectWithBuffers({\n\t\t\tnewActiveEditor: '_notebook_editor_2'\n\t\t}));\n\n\t\tassert.strictEqual(count, 1);\n\t});\n\n\ttest('unset active notebook editor', function () {\n\n\t\tconst editor = extHostNotebooks.activeNotebookEditor;\n\t\tassert.ok(editor !== undefined);\n\n\t\textHostNotebooks.$acceptDocumentAndEditorsDelta(new SerializableObjectWithBuffers({ newActiveEditor: undefined }));\n\t\tassert.ok(extHostNotebooks.activeNotebookEditor === editor);\n\n\t\textHostNotebooks.$acceptDocumentAndEditorsDelta(new SerializableObjectWithBuffers({}));\n\t\tassert.ok(extHostNotebooks.activeNotebookEditor === editor);\n\n\t\textHostNotebooks.$acceptDocumentAndEditorsDelta(new SerializableObjectWithBuffers({ newActiveEditor: null }));\n\t\tassert.ok(extHostNotebooks.activeNotebookEditor === undefined);\n\t});\n\n\ttest('change cell language triggers onDidChange events', async function () {\n\n\t\tconst first = notebook.apiNotebook.cellAt(0);\n\n\t\tassert.strictEqual(first.document.languageId, 'markdown');\n\n\t\tconst removed = Event.toPromise(extHostDocuments.onDidRemoveDocument);\n\t\tconst added = Event.toPromise(extHostDocuments.onDidAddDocument);\n\n\t\textHostNotebookDocuments.$acceptModelChanged(notebook.uri, new SerializableObjectWithBuffers({\n\t\t\tversionId: 12, rawEvents: [{\n\t\t\t\tkind: NotebookCellsChangeType.ChangeCellLanguage,\n\t\t\t\tindex: 0,\n\t\t\t\tlanguage: 'fooLang'\n\t\t\t}]\n\t\t}), false);\n\n\t\tconst removedDoc = await removed;\n\t\tconst addedDoc = await added;\n\n\t\tassert.strictEqual(first.document.languageId, 'fooLang');\n\t\tassert.ok(removedDoc === addedDoc);\n\t});\n\n\ttest('onDidChangeNotebook-event, cell changes', async function () {\n\n\t\tconst p = Event.toPromise(extHostNotebookDocuments.onDidChangeNotebookDocument);\n\n\t\textHostNotebookDocuments.$acceptModelChanged(notebook.uri, new SerializableObjectWithBuffers({\n\t\t\tversionId: 12, rawEvents: [{\n\t\t\t\tkind: NotebookCellsChangeType.ChangeCellMetadata,\n\t\t\t\tindex: 0,\n\t\t\t\tmetadata: { foo: 1 }\n\t\t\t}, {\n\t\t\t\tkind: NotebookCellsChangeType.ChangeCellMetadata,\n\t\t\t\tindex: 1,\n\t\t\t\tmetadata: { foo: 2 },\n\t\t\t}, {\n\t\t\t\tkind: NotebookCellsChangeType.Output,\n\t\t\t\tindex: 1,\n\t\t\t\toutputs: [\n\t\t\t\t\t{\n\t\t\t\t\t\titems: [{\n\t\t\t\t\t\t\tvalueBytes: VSBuffer.fromByteArray([0, 2, 3]),\n\t\t\t\t\t\t\tmime: 'text/plain'\n\t\t\t\t\t\t}],\n\t\t\t\t\t\toutputId: '1'\n\t\t\t\t\t}\n\t\t\t\t]\n\t\t\t}]\n\t\t}), false, undefined);\n\n\n\t\tconst event = await p;\n\n\t\tassert.strictEqual(event.notebook === notebook.apiNotebook, true);\n\t\tassert.strictEqual(event.contentChanges.length, 0);\n\t\tassert.strictEqual(event.cellChanges.length, 2);\n\n\t\tconst [first, second] = event.cellChanges;\n\t\tassert.deepStrictEqual(first.metadata, first.cell.metadata);\n\t\tassert.deepStrictEqual(first.executionSummary, undefined);\n\t\tassert.deepStrictEqual(first.outputs, undefined);\n\t\tassert.deepStrictEqual(first.document, undefined);\n\n\t\tassert.deepStrictEqual(second.outputs, second.cell.outputs);\n\t\tassert.deepStrictEqual(second.metadata, second.cell.metadata);\n\t\tassert.deepStrictEqual(second.executionSummary, undefined);\n\t\tassert.deepStrictEqual(second.document, undefined);\n\t});\n\n\ttest('onDidChangeNotebook-event, notebook metadata', async function () {\n\n\t\tconst p = Event.toPromise(extHostNotebookDocuments.onDidChangeNotebookDocument);\n\n\t\textHostNotebookDocuments.$acceptModelChanged(notebook.uri, new SerializableObjectWithBuffers({ versionId: 12, rawEvents: [] }), false, { foo: 2 });\n\n\t\tconst event = await p;\n\n\t\tassert.strictEqual(event.notebook === notebook.apiNotebook, true);\n\t\tassert.strictEqual(event.contentChanges.length, 0);\n\t\tassert.strictEqual(event.cellChanges.length, 0);\n\t\tassert.deepStrictEqual(event.metadata, { foo: 2 });\n\t});\n\n\ttest('onDidChangeNotebook-event, froozen data', async function () {\n\n\t\tconst p = Event.toPromise(extHostNotebookDocuments.onDidChangeNotebookDocument);\n\n\t\textHostNotebookDocuments.$acceptModelChanged(notebook.uri, new SerializableObjectWithBuffers({ versionId: 12, rawEvents: [] }), false, { foo: 2 });\n\n\t\tconst event = await p;\n\n\t\tassert.ok(Object.isFrozen(event));\n\t\tassert.ok(Object.isFrozen(event.cellChanges));\n\t\tassert.ok(Object.isFrozen(event.contentChanges));\n\t\tassert.ok(Object.isFrozen(event.notebook));\n\t\tassert.ok(!Object.isFrozen(event.metadata));\n\t});\n\n\ttest('change cell language and onDidChangeNotebookDocument', async function () {\n\n\t\tconst p = Event.toPromise(extHostNotebookDocuments.onDidChangeNotebookDocument);\n\n\t\tconst first = notebook.apiNotebook.cellAt(0);\n\t\tassert.strictEqual(first.document.languageId, 'markdown');\n\n\t\textHostNotebookDocuments.$acceptModelChanged(notebook.uri, new SerializableObjectWithBuffers({\n\t\t\tversionId: 12,\n\t\t\trawEvents: [{\n\t\t\t\tkind: NotebookCellsChangeType.ChangeCellLanguage,\n\t\t\t\tindex: 0,\n\t\t\t\tlanguage: 'fooLang'\n\t\t\t}]\n\t\t}), false);\n\n\t\tconst event = await p;\n\n\t\tassert.strictEqual(event.notebook === notebook.apiNotebook, true);\n\t\tassert.strictEqual(event.contentChanges.length, 0);\n\t\tassert.strictEqual(event.cellChanges.length, 1);\n\n\t\tconst [cellChange] = event.cellChanges;\n\n\t\tassert.strictEqual(cellChange.cell === first, true);\n\t\tassert.ok(cellChange.document === first.document);\n\t\tassert.ok(cellChange.executionSummary === undefined);\n\t\tassert.ok(cellChange.metadata === undefined);\n\t\tassert.ok(cellChange.outputs === undefined);\n\t});\n\n\ttest('change notebook cell document and onDidChangeNotebookDocument', async function () {\n\n\t\tconst p = Event.toPromise(extHostNotebookDocuments.onDidChangeNotebookDocument);\n\n\t\tconst first = notebook.apiNotebook.cellAt(0);\n\n\t\textHostNotebookDocuments.$acceptModelChanged(notebook.uri, new SerializableObjectWithBuffers({\n\t\t\tversionId: 12,\n\t\t\trawEvents: [{\n\t\t\t\tkind: NotebookCellsChangeType.ChangeCellContent,\n\t\t\t\tindex: 0\n\t\t\t}]\n\t\t}), false);\n\n\t\tconst event = await p;\n\n\t\tassert.strictEqual(event.notebook === notebook.apiNotebook, true);\n\t\tassert.strictEqual(event.contentChanges.length, 0);\n\t\tassert.strictEqual(event.cellChanges.length, 1);\n\n\t\tconst [cellChange] = event.cellChanges;\n\n\t\tassert.strictEqual(cellChange.cell === first, true);\n\t\tassert.ok(cellChange.document === first.document);\n\t\tassert.ok(cellChange.executionSummary === undefined);\n\t\tassert.ok(cellChange.metadata === undefined);\n\t\tassert.ok(cellChange.outputs === undefined);\n\t});\n\n\tasync function replaceOutputs(cellIndex: number, outputId: string, outputItems: NotebookOutputItemDto[]) {\n\t\tconst changeEvent = Event.toPromise(extHostNotebookDocuments.onDidChangeNotebookDocument);\n\t\textHostNotebookDocuments.$acceptModelChanged(notebook.uri, new SerializableObjectWithBuffers<NotebookCellsChangedEventDto>({\n\t\t\tversionId: notebook.apiNotebook.version + 1,\n\t\t\trawEvents: [{\n\t\t\t\tkind: NotebookCellsChangeType.Output,\n\t\t\t\tindex: cellIndex,\n\t\t\t\toutputs: [{ outputId, items: outputItems }]\n\t\t\t}]\n\t\t}), false);\n\t\tawait changeEvent;\n\t}\n\tasync function appendOutputItem(cellIndex: number, outputId: string, outputItems: NotebookOutputItemDto[]) {\n\t\tconst changeEvent = Event.toPromise(extHostNotebookDocuments.onDidChangeNotebookDocument);\n\t\textHostNotebookDocuments.$acceptModelChanged(notebook.uri, new SerializableObjectWithBuffers<NotebookCellsChangedEventDto>({\n\t\t\tversionId: notebook.apiNotebook.version + 1,\n\t\t\trawEvents: [{\n\t\t\t\tkind: NotebookCellsChangeType.OutputItem,\n\t\t\t\tindex: cellIndex,\n\t\t\t\tappend: true,\n\t\t\t\toutputId,\n\t\t\t\toutputItems\n\t\t\t}]\n\t\t}), false);\n\t\tawait changeEvent;\n\t}\n\ttest('Append multiple text/plain output items', async function () {\n\t\tawait replaceOutputs(1, '1', [{ mime: 'text/plain', valueBytes: VSBuffer.fromString('foo') }]);\n\t\tawait appendOutputItem(1, '1', [{ mime: 'text/plain', valueBytes: VSBuffer.fromString('bar') }]);\n\t\tawait appendOutputItem(1, '1', [{ mime: 'text/plain', valueBytes: VSBuffer.fromString('baz') }]);\n\n\n\t\tassert.strictEqual(notebook.apiNotebook.cellAt(1).outputs.length, 1);\n\t\tassert.strictEqual(notebook.apiNotebook.cellAt(1).outputs[0].items.length, 3);\n\t\tassert.strictEqual(notebook.apiNotebook.cellAt(1).outputs[0].items[0].mime, 'text/plain');\n\t\tassert.strictEqual(VSBuffer.wrap(notebook.apiNotebook.cellAt(1).outputs[0].items[0].data).toString(), 'foo');\n\t\tassert.strictEqual(notebook.apiNotebook.cellAt(1).outputs[0].items[1].mime, 'text/plain');\n\t\tassert.strictEqual(VSBuffer.wrap(notebook.apiNotebook.cellAt(1).outputs[0].items[1].data).toString(), 'bar');\n\t\tassert.strictEqual(notebook.apiNotebook.cellAt(1).outputs[0].items[2].mime, 'text/plain');\n\t\tassert.strictEqual(VSBuffer.wrap(notebook.apiNotebook.cellAt(1).outputs[0].items[2].data).toString(), 'baz');\n\t});\n\ttest('Append multiple stdout stream output items to an output with another mime', async function () {\n\t\tawait replaceOutputs(1, '1', [{ mime: 'text/plain', valueBytes: VSBuffer.fromString('foo') }]);\n\t\tawait appendOutputItem(1, '1', [{ mime: 'application/vnd.code.notebook.stdout', valueBytes: VSBuffer.fromString('bar') }]);\n\t\tawait appendOutputItem(1, '1', [{ mime: 'application/vnd.code.notebook.stdout', valueBytes: VSBuffer.fromString('baz') }]);\n\n\t\tassert.strictEqual(notebook.apiNotebook.cellAt(1).outputs.length, 1);\n\t\tassert.strictEqual(notebook.apiNotebook.cellAt(1).outputs[0].items.length, 3);\n\t\tassert.strictEqual(notebook.apiNotebook.cellAt(1).outputs[0].items[0].mime, 'text/plain');\n\t\tassert.strictEqual(notebook.apiNotebook.cellAt(1).outputs[0].items[1].mime, 'application/vnd.code.notebook.stdout');\n\t\tassert.strictEqual(notebook.apiNotebook.cellAt(1).outputs[0].items[2].mime, 'application/vnd.code.notebook.stdout');\n\t});\n\ttest('Compress multiple stdout stream output items', async function () {\n\t\tawait replaceOutputs(1, '1', [{ mime: 'application/vnd.code.notebook.stdout', valueBytes: VSBuffer.fromString('foo') }]);\n\t\tawait appendOutputItem(1, '1', [{ mime: 'application/vnd.code.notebook.stdout', valueBytes: VSBuffer.fromString('bar') }]);\n\t\tawait appendOutputItem(1, '1', [{ mime: 'application/vnd.code.notebook.stdout', valueBytes: VSBuffer.fromString('baz') }]);\n\n\t\tassert.strictEqual(notebook.apiNotebook.cellAt(1).outputs.length, 1);\n\t\tassert.strictEqual(notebook.apiNotebook.cellAt(1).outputs[0].items.length, 1);\n\t\tassert.strictEqual(notebook.apiNotebook.cellAt(1).outputs[0].items[0].mime, 'application/vnd.code.notebook.stdout');\n\t\tassert.strictEqual(VSBuffer.wrap(notebook.apiNotebook.cellAt(1).outputs[0].items[0].data).toString(), 'foobarbaz');\n\t});\n\ttest('Compress multiple stdout stream output items (with support for terminal escape code -> \\u001b[A)', async function () {\n\t\tawait replaceOutputs(1, '1', [{ mime: 'application/vnd.code.notebook.stdout', valueBytes: VSBuffer.fromString('\\nfoo') }]);\n\t\tawait appendOutputItem(1, '1', [{ mime: 'application/vnd.code.notebook.stdout', valueBytes: VSBuffer.fromString(`${String.fromCharCode(27)}[Abar`) }]);\n\n\t\tassert.strictEqual(notebook.apiNotebook.cellAt(1).outputs.length, 1);\n\t\tassert.strictEqual(notebook.apiNotebook.cellAt(1).outputs[0].items.length, 1);\n\t\tassert.strictEqual(notebook.apiNotebook.cellAt(1).outputs[0].items[0].mime, 'application/vnd.code.notebook.stdout');\n\t\tassert.strictEqual(VSBuffer.wrap(notebook.apiNotebook.cellAt(1).outputs[0].items[0].data).toString(), 'bar');\n\t});\n\ttest('Compress multiple stdout stream output items (with support for terminal escape code -> \\r character)', async function () {\n\t\tawait replaceOutputs(1, '1', [{ mime: 'application/vnd.code.notebook.stdout', valueBytes: VSBuffer.fromString('foo') }]);\n\t\tawait appendOutputItem(1, '1', [{ mime: 'application/vnd.code.notebook.stdout', valueBytes: VSBuffer.fromString(`\\rbar`) }]);\n\n\t\tassert.strictEqual(notebook.apiNotebook.cellAt(1).outputs.length, 1);\n\t\tassert.strictEqual(notebook.apiNotebook.cellAt(1).outputs[0].items.length, 1);\n\t\tassert.strictEqual(notebook.apiNotebook.cellAt(1).outputs[0].items[0].mime, 'application/vnd.code.notebook.stdout');\n\t\tassert.strictEqual(VSBuffer.wrap(notebook.apiNotebook.cellAt(1).outputs[0].items[0].data).toString(), 'bar');\n\t});\n\ttest('Compress multiple stderr stream output items', async function () {\n\t\tawait replaceOutputs(1, '1', [{ mime: 'application/vnd.code.notebook.stderr', valueBytes: VSBuffer.fromString('foo') }]);\n\t\tawait appendOutputItem(1, '1', [{ mime: 'application/vnd.code.notebook.stderr', valueBytes: VSBuffer.fromString('bar') }]);\n\t\tawait appendOutputItem(1, '1', [{ mime: 'application/vnd.code.notebook.stderr', valueBytes: VSBuffer.fromString('baz') }]);\n\n\t\tassert.strictEqual(notebook.apiNotebook.cellAt(1).outputs.length, 1);\n\t\tassert.strictEqual(notebook.apiNotebook.cellAt(1).outputs[0].items.length, 1);\n\t\tassert.strictEqual(notebook.apiNotebook.cellAt(1).outputs[0].items[0].mime, 'application/vnd.code.notebook.stderr');\n\t\tassert.strictEqual(VSBuffer.wrap(notebook.apiNotebook.cellAt(1).outputs[0].items[0].data).toString(), 'foobarbaz');\n\t});\n});\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport assert from 'assert';\nimport * as vscode from 'vscode';\nimport { ExtHostDocumentsAndEditors } from '../../common/extHostDocumentsAndEditors.js';\nimport { TestRPCProtocol } from '../common/testRPCProtocol.js';\nimport { DisposableStore } from '../../../../base/common/lifecycle.js';\nimport { NullLogService } from '../../../../platform/log/common/log.js';\nimport { mock } from '../../../../base/test/common/mock.js';\nimport { IModelAddedData, MainContext, MainThreadCommandsShape, MainThreadNotebookShape, NotebookCellsChangedEventDto, NotebookOutputItemDto } from '../../common/extHost.protocol.js';\nimport { ExtHostNotebookController } from '../../common/extHostNotebook.js';\nimport { ExtHostNotebookDocument } from '../../common/extHostNotebookDocument.js';\nimport { CellKind, CellUri, NotebookCellsChangeType } from '../../../contrib/notebook/common/notebookCommon.js';\nimport { URI } from '../../../../base/common/uri.js';\nimport { ExtHostDocuments } from '../../common/extHostDocuments.js';\nimport { ExtHostCommands } from '../../common/extHostCommands.js';\nimport { nullExtensionDescription } from '../../../services/extensions/common/extensions.js';\nimport { isEqual } from '../../../../base/common/resources.js';\nimport { Event } from '../../../../base/common/event.js';\nimport { ExtHostNotebookDocuments } from '../../common/extHostNotebookDocuments.js';\nimport { SerializableObjectWithBuffers } from '../../../services/extensions/common/proxyIdentifier.js';\nimport { VSBuffer } from '../../../../base/common/buffer.js';\nimport { IExtHostTelemetry } from '../../common/extHostTelemetry.js';\nimport { ExtHostConsumerFileSystem } from '../../common/extHostFileSystemConsumer.js';\nimport { ExtHostFileSystemInfo } from '../../common/extHostFileSystemInfo.js';\nimport { ensureNoDisposablesAreLeakedInTestSuite } from '../../../../base/test/common/utils.js';\nimport { ExtHostSearch } from '../../common/extHostSearch.js';\nimport { URITransformerService } from '../../common/extHostUriTransformerService.js';\n\nsuite('NotebookCell#Document', function () {\n\tlet rpcProtocol: TestRPCProtocol;\n\tlet notebook: ExtHostNotebookDocument;\n\tlet extHostDocumentsAndEditors: ExtHostDocumentsAndEditors;\n\tlet extHostDocuments: ExtHostDocuments;\n\tlet extHostNotebooks: ExtHostNotebookController;\n\tlet extHostNotebookDocuments: ExtHostNotebookDocuments;\n\tlet extHostConsumerFileSystem: ExtHostConsumerFileSystem;\n\tlet extHostSearch: ExtHostSearch;\n\n\tconst notebookUri = URI.parse('test:///notebook.file');\n\tconst disposables = new DisposableStore();\n\n\tteardown(function () {\n\t\tdisposables.clear();\n\t});\n\n\tensureNoDisposablesAreLeakedInTestSuite();\n\n\tsetup(async function () {\n\t\trpcProtocol = new TestRPCProtocol();\n\t\trpcProtocol.set(MainContext.MainThreadCommands, new class extends mock<MainThreadCommandsShape>() {\n\t\t\toverride $registerCommand() { }\n\t\t});\n\t\trpcProtocol.set(MainContext.MainThreadNotebook, new class extends mock<MainThreadNotebookShape>() {\n\t\t\toverride async $registerNotebookSerializer() { }\n\t\t\toverride async $unregisterNotebookSerializer() { }\n\t\t});\n\t\textHostDocumentsAndEditors = new ExtHostDocumentsAndEditors(rpcProtocol, new NullLogService());\n\t\textHostDocuments = new ExtHostDocuments(rpcProtocol, extHostDocumentsAndEditors);\n\t\textHostConsumerFileSystem = new ExtHostConsumerFileSystem(rpcProtocol, new ExtHostFileSystemInfo());\n\t\textHostSearch = new ExtHostSearch(rpcProtocol, new URITransformerService(null), new NullLogService());\n\t\textHostNotebooks = new ExtHostNotebookController(rpcProtocol, new ExtHostCommands(rpcProtocol, new NullLogService(), new class extends mock<IExtHostTelemetry>() {\n\t\t\toverride onExtensionError(): boolean {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}), extHostDocumentsAndEditors, extHostDocuments, extHostConsumerFileSystem, extHostSearch, new NullLogService());\n\t\textHostNotebookDocuments = new ExtHostNotebookDocuments(extHostNotebooks);\n\n\t\tconst reg = extHostNotebooks.registerNotebookSerializer(nullExtensionDescription, 'test', new class extends mock<vscode.NotebookSerializer>() { });\n\t\textHostNotebooks.$acceptDocumentAndEditorsDelta(new SerializableObjectWithBuffers({\n\t\t\taddedDocuments: [{\n\t\t\t\turi: notebookUri,\n\t\t\t\tviewType: 'test',\n\t\t\t\tversionId: 0,\n\t\t\t\tcells: [{\n\t\t\t\t\thandle: 0,\n\t\t\t\t\turi: CellUri.generate(notebookUri, 0),\n\t\t\t\t\tsource: ['### Heading'],\n\t\t\t\t\teol: '\\n',\n\t\t\t\t\tlanguage: 'markdown',\n\t\t\t\t\tcellKind: CellKind.Markup,\n\t\t\t\t\toutputs: [],\n\t\t\t\t}, {\n\t\t\t\t\thandle: 1,\n\t\t\t\t\turi: CellUri.generate(notebookUri, 1),\n\t\t\t\t\tsource: ['console.log(\"aaa\")', 'console.log(\"bbb\")'],\n\t\t\t\t\teol: '\\n',\n\t\t\t\t\tlanguage: 'javascript',\n\t\t\t\t\tcellKind: CellKind.Code,\n\t\t\t\t\toutputs: [],\n\t\t\t\t}],\n\t\t\t}],\n\t\t\taddedEditors: [{\n\t\t\t\tdocumentUri: notebookUri,\n\t\t\t\tid: '_notebook_editor_0',\n\t\t\t\tselections: [{ start: 0, end: 1 }],\n\t\t\t\tvisibleRanges: [],\n\t\t\t\tviewType: 'test'\n\t\t\t}]\n\t\t}));\n\t\textHostNotebooks.$acceptDocumentAndEditorsDelta(new SerializableObjectWithBuffers({ newActiveEditor: '_notebook_editor_0' }));\n\n\t\tnotebook = extHostNotebooks.notebookDocuments[0]!;\n\n\t\tdisposables.add(reg);\n\t\tdisposables.add(notebook);\n\t\tdisposables.add(extHostDocuments);\n\t});\n\n\n\ttest('cell document is vscode.TextDocument', async function () {\n\n\t\tassert.strictEqual(notebook.apiNotebook.cellCount, 2);\n\n\t\tconst [c1, c2] = notebook.apiNotebook.getCells();\n\t\tconst d1 = extHostDocuments.getDocument(c1.document.uri);\n\n\t\tassert.ok(d1);\n\t\tassert.strictEqual(d1.languageId, c1.document.languageId);\n\t\tassert.strictEqual(d1.version, 1);\n\n\t\tconst d2 = extHostDocuments.getDocument(c2.document.uri);\n\t\tassert.ok(d2);\n\t\tassert.strictEqual(d2.languageId, c2.document.languageId);\n\t\tassert.strictEqual(d2.version, 1);\n\t});\n\n\ttest('cell document goes when notebook closes', async function () {\n\t\tconst cellUris: string[] = [];\n\t\tfor (const cell of notebook.apiNotebook.getCells()) {\n\t\t\tassert.ok(extHostDocuments.getDocument(cell.document.uri));\n\t\t\tcellUris.push(cell.document.uri.toString());\n\t\t}\n\n\t\tconst removedCellUris: string[] = [];\n\t\tconst reg = extHostDocuments.onDidRemoveDocument(doc => {\n\t\t\tremovedCellUris.push(doc.uri.toString());\n\t\t});\n\n\t\textHostNotebooks.$acceptDocumentAndEditorsDelta(new SerializableObjectWithBuffers({ removedDocuments: [notebook.uri] }));\n\t\treg.dispose();\n\n\t\tassert.strictEqual(removedCellUris.length, 2);\n\t\tassert.deepStrictEqual(removedCellUris.sort(), cellUris.sort());\n\t});\n\n\ttest('cell document is vscode.TextDocument after changing it', async function () {\n\n\t\tconst p = new Promise<void>((resolve, reject) => {\n\n\t\t\tdisposables.add(extHostNotebookDocuments.onDidChangeNotebookDocument(e => {\n\t\t\t\ttry {\n\t\t\t\t\tassert.strictEqual(e.contentChanges.length, 1);\n\t\t\t\t\tassert.strictEqual(e.contentChanges[0].addedCells.length, 2);\n\n\t\t\t\t\tconst [first, second] = e.contentChanges[0].addedCells;\n\n\t\t\t\t\tconst doc1 = extHostDocuments.getAllDocumentData().find(data => isEqual(data.document.uri, first.document.uri));\n\t\t\t\t\tassert.ok(doc1);\n\t\t\t\t\tassert.strictEqual(doc1?.document === first.document, true);\n\n\t\t\t\t\tconst doc2 = extHostDocuments.getAllDocumentData().find(data => isEqual(data.document.uri, second.document.uri));\n\t\t\t\t\tassert.ok(doc2);\n\t\t\t\t\tassert.strictEqual(doc2?.document === second.document, true);\n\n\t\t\t\t\tresolve();\n\n\t\t\t\t} catch (err) {\n\t\t\t\t\treject(err);\n\t\t\t\t}\n\t\t\t}));\n\n\t\t});\n\n\t\textHostNotebookDocuments.$acceptModelChanged(notebookUri, new SerializableObjectWithBuffers({\n\t\t\tversionId: notebook.apiNotebook.version + 1,\n\t\t\trawEvents: [\n\t\t\t\t{\n\t\t\t\t\tkind: NotebookCellsChangeType.ModelChange,\n\t\t\t\t\tchanges: [[0, 0, [{\n\t\t\t\t\t\thandle: 2,\n\t\t\t\t\t\turi: CellUri.generate(notebookUri, 2),\n\t\t\t\t\t\tsource: ['Hello', 'World', 'Hello World!'],\n\t\t\t\t\t\teol: '\\n',\n\t\t\t\t\t\tlanguage: 'test',\n\t\t\t\t\t\tcellKind: CellKind.Code,\n\t\t\t\t\t\toutputs: [],\n\t\t\t\t\t}, {\n\t\t\t\t\t\thandle: 3,\n\t\t\t\t\t\turi: CellUri.generate(notebookUri, 3),\n\t\t\t\t\t\tsource: ['Hallo', 'Welt', 'Hallo Welt!'],\n\t\t\t\t\t\teol: '\\n',\n\t\t\t\t\t\tlanguage: 'test',\n\t\t\t\t\t\tcellKind: CellKind.Code,\n\t\t\t\t\t\toutputs: [],\n\t\t\t\t\t}]]]\n\t\t\t\t}\n\t\t\t]\n\t\t}), false);\n\n\t\tawait p;\n\n\t});\n\n\ttest('cell document stays open when notebook is still open', async function () {\n\n\t\tconst docs: vscode.TextDocument[] = [];\n\t\tconst addData: IModelAddedData[] = [];\n\t\tfor (const cell of notebook.apiNotebook.getCells()) {\n\t\t\tconst doc = extHostDocuments.getDocument(cell.document.uri);\n\t\t\tassert.ok(doc);\n\t\t\tassert.strictEqual(extHostDocuments.getDocument(cell.document.uri).isClosed, false);\n\t\t\tdocs.push(doc);\n\t\t\taddData.push({\n\t\t\t\tEOL: '\\n',\n\t\t\t\tisDirty: doc.isDirty,\n\t\t\t\tlines: doc.getText().split('\\n'),\n\t\t\t\tlanguageId: doc.languageId,\n\t\t\t\turi: doc.uri,\n\t\t\t\tversionId: doc.version,\n\t\t\t\tencoding: 'utf8'\n\t\t\t});\n\t\t}\n\n\t\t// this call happens when opening a document on the main side\n\t\textHostDocumentsAndEditors.$acceptDocumentsAndEditorsDelta({ addedDocuments: addData });\n\n\t\t// this call happens when closing a document from the main side\n\t\textHostDocumentsAndEditors.$acceptDocumentsAndEditorsDelta({ removedDocuments: docs.map(d => d.uri) });\n\n\t\t// notebook is still open -> cell documents stay open\n\t\tfor (const cell of notebook.apiNotebook.getCells()) {\n\t\t\tassert.ok(extHostDocuments.getDocument(cell.document.uri));\n\t\t\tassert.strictEqual(extHostDocuments.getDocument(cell.document.uri).isClosed, false);\n\t\t}\n\n\t\t// close notebook -> docs are closed\n\t\textHostNotebooks.$acceptDocumentAndEditorsDelta(new SerializableObjectWithBuffers({ removedDocuments: [notebook.uri] }));\n\t\tfor (const cell of notebook.apiNotebook.getCells()) {\n\t\t\tassert.throws(() => extHostDocuments.getDocument(cell.document.uri));\n\t\t}\n\t\tfor (const doc of docs) {\n\t\t\tassert.strictEqual(doc.isClosed, true);\n\t\t}\n\t});\n\n\ttest('cell document goes when cell is removed', async function () {\n\n\t\tassert.strictEqual(notebook.apiNotebook.cellCount, 2);\n\t\tconst [cell1, cell2] = notebook.apiNotebook.getCells();\n\n\t\textHostNotebookDocuments.$acceptModelChanged(notebook.uri, new SerializableObjectWithBuffers({\n\t\t\tversionId: 2,\n\t\t\trawEvents: [\n\t\t\t\t{\n\t\t\t\t\tkind: NotebookCellsChangeType.ModelChange,\n\t\t\t\t\tchanges: [[0, 1, []]]\n\t\t\t\t}\n\t\t\t]\n\t\t}), false);\n\n\t\tassert.strictEqual(notebook.apiNotebook.cellCount, 1);\n\t\tassert.strictEqual(cell1.document.isClosed, true); // ref still alive!\n\t\tassert.strictEqual(cell2.document.isClosed, false);\n\n\t\tassert.throws(() => extHostDocuments.getDocument(cell1.document.uri));\n\t});\n\n\ttest('cell#index', function () {\n\n\t\tassert.strictEqual(notebook.apiNotebook.cellCount, 2);\n\t\tconst [first, second] = notebook.apiNotebook.getCells();\n\t\tassert.strictEqual(first.index, 0);\n\t\tassert.strictEqual(second.index, 1);\n\n\t\t// remove first cell\n\t\textHostNotebookDocuments.$acceptModelChanged(notebook.uri, new SerializableObjectWithBuffers({\n\t\t\tversionId: notebook.apiNotebook.version + 1,\n\t\t\trawEvents: [{\n\t\t\t\tkind: NotebookCellsChangeType.ModelChange,\n\t\t\t\tchanges: [[0, 1, []]]\n\t\t\t}]\n\t\t}), false);\n\n\t\tassert.strictEqual(notebook.apiNotebook.cellCount, 1);\n\t\tassert.strictEqual(second.index, 0);\n\n\t\textHostNotebookDocuments.$acceptModelChanged(notebookUri, new SerializableObjectWithBuffers({\n\t\t\tversionId: notebook.apiNotebook.version + 1,\n\t\t\trawEvents: [{\n\t\t\t\tkind: NotebookCellsChangeType.ModelChange,\n\t\t\t\tchanges: [[0, 0, [{\n\t\t\t\t\thandle: 2,\n\t\t\t\t\turi: CellUri.generate(notebookUri, 2),\n\t\t\t\t\tsource: ['Hello', 'World', 'Hello World!'],\n\t\t\t\t\teol: '\\n',\n\t\t\t\t\tlanguage: 'test',\n\t\t\t\t\tcellKind: CellKind.Code,\n\t\t\t\t\toutputs: [],\n\t\t\t\t}, {\n\t\t\t\t\thandle: 3,\n\t\t\t\t\turi: CellUri.generate(notebookUri, 3),\n\t\t\t\t\tsource: ['Hallo', 'Welt', 'Hallo Welt!'],\n\t\t\t\t\teol: '\\n',\n\t\t\t\t\tlanguage: 'test',\n\t\t\t\t\tcellKind: CellKind.Code,\n\t\t\t\t\toutputs: [],\n\t\t\t\t}]]]\n\t\t\t}]\n\t\t}), false);\n\n\t\tassert.strictEqual(notebook.apiNotebook.cellCount, 3);\n\t\tassert.strictEqual(second.index, 2);\n\t});\n\n\ttest('ERR MISSING extHostDocument for notebook cell: #116711', async function () {\n\n\t\tconst p = Event.toPromise(extHostNotebookDocuments.onDidChangeNotebookDocument);\n\n\t\t// DON'T call this, make sure the cell-documents have not been created yet\n\t\t// assert.strictEqual(notebook.notebookDocument.cellCount, 2);\n\n\t\textHostNotebookDocuments.$acceptModelChanged(notebook.uri, new SerializableObjectWithBuffers({\n\t\t\tversionId: 100,\n\t\t\trawEvents: [{\n\t\t\t\tkind: NotebookCellsChangeType.ModelChange,\n\t\t\t\tchanges: [[0, 2, [{\n\t\t\t\t\thandle: 3,\n\t\t\t\t\turi: CellUri.generate(notebookUri, 3),\n\t\t\t\t\tsource: ['### Heading'],\n\t\t\t\t\teol: '\\n',\n\t\t\t\t\tlanguage: 'markdown',\n\t\t\t\t\tcellKind: CellKind.Markup,\n\t\t\t\t\toutputs: [],\n\t\t\t\t}, {\n\t\t\t\t\thandle: 4,\n\t\t\t\t\turi: CellUri.generate(notebookUri, 4),\n\t\t\t\t\tsource: ['console.log(\"aaa\")', 'console.log(\"bbb\")'],\n\t\t\t\t\teol: '\\n',\n\t\t\t\t\tlanguage: 'javascript',\n\t\t\t\t\tcellKind: CellKind.Code,\n\t\t\t\t\toutputs: [],\n\t\t\t\t}]]]\n\t\t\t}]\n\t\t}), false);\n\n\t\tassert.strictEqual(notebook.apiNotebook.cellCount, 2);\n\n\t\tconst event = await p;\n\n\t\tassert.strictEqual(event.notebook === notebook.apiNotebook, true);\n\t\tassert.strictEqual(event.contentChanges.length, 1);\n\t\tassert.strictEqual(event.contentChanges[0].range.end - event.contentChanges[0].range.start, 2);\n\t\tassert.strictEqual(event.contentChanges[0].removedCells[0].document.isClosed, true);\n\t\tassert.strictEqual(event.contentChanges[0].removedCells[1].document.isClosed, true);\n\t\tassert.strictEqual(event.contentChanges[0].addedCells.length, 2);\n\t\tassert.strictEqual(event.contentChanges[0].addedCells[0].document.isClosed, false);\n\t\tassert.strictEqual(event.contentChanges[0].addedCells[1].document.isClosed, false);\n\t});\n\n\n\ttest('Opening a notebook results in VS Code firing the event onDidChangeActiveNotebookEditor twice #118470', function () {\n\t\tlet count = 0;\n\t\tdisposables.add(extHostNotebooks.onDidChangeActiveNotebookEditor(() => count += 1));\n\n\t\textHostNotebooks.$acceptDocumentAndEditorsDelta(new SerializableObjectWithBuffers({\n\t\t\taddedEditors: [{\n\t\t\t\tdocumentUri: notebookUri,\n\t\t\t\tid: '_notebook_editor_2',\n\t\t\t\tselections: [{ start: 0, end: 1 }],\n\t\t\t\tvisibleRanges: [],\n\t\t\t\tviewType: 'test'\n\t\t\t}]\n\t\t}));\n\n\t\textHostNotebooks.$acceptDocumentAndEditorsDelta(new SerializableObjectWithBuffers({\n\t\t\tnewActiveEditor: '_notebook_editor_2'\n\t\t}));\n\n\t\tassert.strictEqual(count, 1);\n\t});\n\n\ttest('unset active notebook editor', function () {\n\n\t\tconst editor = extHostNotebooks.activeNotebookEditor;\n\t\tassert.ok(editor !== undefined);\n\n\t\textHostNotebooks.$acceptDocumentAndEditorsDelta(new SerializableObjectWithBuffers({ newActiveEditor: undefined }));\n\t\tassert.ok(extHostNotebooks.activeNotebookEditor === editor);\n\n\t\textHostNotebooks.$acceptDocumentAndEditorsDelta(new SerializableObjectWithBuffers({}));\n\t\tassert.ok(extHostNotebooks.activeNotebookEditor === editor);\n\n\t\textHostNotebooks.$acceptDocumentAndEditorsDelta(new SerializableObjectWithBuffers({ newActiveEditor: null }));\n\t\tassert.ok(extHostNotebooks.activeNotebookEditor === undefined);\n\t});\n\n\ttest('change cell language triggers onDidChange events', async function () {\n\n\t\tconst first = notebook.apiNotebook.cellAt(0);\n\n\t\tassert.strictEqual(first.document.languageId, 'markdown');\n\n\t\tconst removed = Event.toPromise(extHostDocuments.onDidRemoveDocument);\n\t\tconst added = Event.toPromise(extHostDocuments.onDidAddDocument);\n\n\t\textHostNotebookDocuments.$acceptModelChanged(notebook.uri, new SerializableObjectWithBuffers({\n\t\t\tversionId: 12, rawEvents: [{\n\t\t\t\tkind: NotebookCellsChangeType.ChangeCellLanguage,\n\t\t\t\tindex: 0,\n\t\t\t\tlanguage: 'fooLang'\n\t\t\t}]\n\t\t}), false);\n\n\t\tconst removedDoc = await removed;\n\t\tconst addedDoc = await added;\n\n\t\tassert.strictEqual(first.document.languageId, 'fooLang');\n\t\tassert.ok(removedDoc === addedDoc);\n\t});\n\n\ttest('onDidChangeNotebook-event, cell changes', async function () {\n\n\t\tconst p = Event.toPromise(extHostNotebookDocuments.onDidChangeNotebookDocument);\n\n\t\textHostNotebookDocuments.$acceptModelChanged(notebook.uri, new SerializableObjectWithBuffers({\n\t\t\tversionId: 12, rawEvents: [{\n\t\t\t\tkind: NotebookCellsChangeType.ChangeCellMetadata,\n\t\t\t\tindex: 0,\n\t\t\t\tmetadata: { foo: 1 }\n\t\t\t}, {\n\t\t\t\tkind: NotebookCellsChangeType.ChangeCellMetadata,\n\t\t\t\tindex: 1,\n\t\t\t\tmetadata: { foo: 2 },\n\t\t\t}, {\n\t\t\t\tkind: NotebookCellsChangeType.Output,\n\t\t\t\tindex: 1,\n\t\t\t\toutputs: [\n\t\t\t\t\t{\n\t\t\t\t\t\titems: [{\n\t\t\t\t\t\t\tvalueBytes: VSBuffer.fromByteArray([0, 2, 3]),\n\t\t\t\t\t\t\tmime: 'text/plain'\n\t\t\t\t\t\t}],\n\t\t\t\t\t\toutputId: '1'\n\t\t\t\t\t}\n\t\t\t\t]\n\t\t\t}]\n\t\t}), false, undefined);\n\n\n\t\tconst event = await p;\n\n\t\tassert.strictEqual(event.notebook === notebook.apiNotebook, true);\n\t\tassert.strictEqual(event.contentChanges.length, 0);\n\t\tassert.strictEqual(event.cellChanges.length, 2);\n\n\t\tconst [first, second] = event.cellChanges;\n\t\tassert.deepStrictEqual(first.metadata, first.cell.metadata);\n\t\tassert.deepStrictEqual(first.executionSummary, undefined);\n\t\tassert.deepStrictEqual(first.outputs, undefined);\n\t\tassert.deepStrictEqual(first.document, undefined);\n\n\t\tassert.deepStrictEqual(second.outputs, second.cell.outputs);\n\t\tassert.deepStrictEqual(second.metadata, second.cell.metadata);\n\t\tassert.deepStrictEqual(second.executionSummary, undefined);\n\t\tassert.deepStrictEqual(second.document, undefined);\n\t});\n\n\ttest('onDidChangeNotebook-event, notebook metadata', async function () {\n\n\t\tconst p = Event.toPromise(extHostNotebookDocuments.onDidChangeNotebookDocument);\n\n\t\textHostNotebookDocuments.$acceptModelChanged(notebook.uri, new SerializableObjectWithBuffers({ versionId: 12, rawEvents: [] }), false, { foo: 2 });\n\n\t\tconst event = await p;\n\n\t\tassert.strictEqual(event.notebook === notebook.apiNotebook, true);\n\t\tassert.strictEqual(event.contentChanges.length, 0);\n\t\tassert.strictEqual(event.cellChanges.length, 0);\n\t\tassert.deepStrictEqual(event.metadata, { foo: 2 });\n\t});\n\n\ttest('onDidChangeNotebook-event, froozen data', async function () {\n\n\t\tconst p = Event.toPromise(extHostNotebookDocuments.onDidChangeNotebookDocument);\n\n\t\textHostNotebookDocuments.$acceptModelChanged(notebook.uri, new SerializableObjectWithBuffers({ versionId: 12, rawEvents: [] }), false, { foo: 2 });\n\n\t\tconst event = await p;\n\n\t\tassert.ok(Object.isFrozen(event));\n\t\tassert.ok(Object.isFrozen(event.cellChanges));\n\t\tassert.ok(Object.isFrozen(event.contentChanges));\n\t\tassert.ok(Object.isFrozen(event.notebook));\n\t\tassert.ok(!Object.isFrozen(event.metadata));\n\t});\n\n\ttest('change cell language and onDidChangeNotebookDocument', async function () {\n\n\t\tconst p = Event.toPromise(extHostNotebookDocuments.onDidChangeNotebookDocument);\n\n\t\tconst first = notebook.apiNotebook.cellAt(0);\n\t\tassert.strictEqual(first.document.languageId, 'markdown');\n\n\t\textHostNotebookDocuments.$acceptModelChanged(notebook.uri, new SerializableObjectWithBuffers({\n\t\t\tversionId: 12,\n\t\t\trawEvents: [{\n\t\t\t\tkind: NotebookCellsChangeType.ChangeCellLanguage,\n\t\t\t\tindex: 0,\n\t\t\t\tlanguage: 'fooLang'\n\t\t\t}]\n\t\t}), false);\n\n\t\tconst event = await p;\n\n\t\tassert.strictEqual(event.notebook === notebook.apiNotebook, true);\n\t\tassert.strictEqual(event.contentChanges.length, 0);\n\t\tassert.strictEqual(event.cellChanges.length, 1);\n\n\t\tconst [cellChange] = event.cellChanges;\n\n\t\tassert.strictEqual(cellChange.cell === first, true);\n\t\tassert.ok(cellChange.document === first.document);\n\t\tassert.ok(cellChange.executionSummary === undefined);\n\t\tassert.ok(cellChange.metadata === undefined);\n\t\tassert.ok(cellChange.outputs === undefined);\n\t});\n\n\ttest('change notebook cell document and onDidChangeNotebookDocument', async function () {\n\n\t\tconst p = Event.toPromise(extHostNotebookDocuments.onDidChangeNotebookDocument);\n\n\t\tconst first = notebook.apiNotebook.cellAt(0);\n\n\t\textHostNotebookDocuments.$acceptModelChanged(notebook.uri, new SerializableObjectWithBuffers({\n\t\t\tversionId: 12,\n\t\t\trawEvents: [{\n\t\t\t\tkind: NotebookCellsChangeType.ChangeCellContent,\n\t\t\t\tindex: 0\n\t\t\t}]\n\t\t}), false);\n\n\t\tconst event = await p;\n\n\t\tassert.strictEqual(event.notebook === notebook.apiNotebook, true);\n\t\tassert.strictEqual(event.contentChanges.length, 0);\n\t\tassert.strictEqual(event.cellChanges.length, 1);\n\n\t\tconst [cellChange] = event.cellChanges;\n\n\t\tassert.strictEqual(cellChange.cell === first, true);\n\t\tassert.ok(cellChange.document === first.document);\n\t\tassert.ok(cellChange.executionSummary === undefined);\n\t\tassert.ok(cellChange.metadata === undefined);\n\t\tassert.ok(cellChange.outputs === undefined);\n\t});\n\n\tasync function replaceOutputs(cellIndex: number, outputId: string, outputItems: NotebookOutputItemDto[]) {\n\t\tconst changeEvent = Event.toPromise(extHostNotebookDocuments.onDidChangeNotebookDocument);\n\t\textHostNotebookDocuments.$acceptModelChanged(notebook.uri, new SerializableObjectWithBuffers<NotebookCellsChangedEventDto>({\n\t\t\tversionId: notebook.apiNotebook.version + 1,\n\t\t\trawEvents: [{\n\t\t\t\tkind: NotebookCellsChangeType.Output,\n\t\t\t\tindex: cellIndex,\n\t\t\t\toutputs: [{ outputId, items: outputItems }]\n\t\t\t}]\n\t\t}), false);\n\t\tawait changeEvent;\n\t}\n\tasync function appendOutputItem(cellIndex: number, outputId: string, outputItems: NotebookOutputItemDto[]) {\n\t\tconst changeEvent = Event.toPromise(extHostNotebookDocuments.onDidChangeNotebookDocument);\n\t\textHostNotebookDocuments.$acceptModelChanged(notebook.uri, new SerializableObjectWithBuffers<NotebookCellsChangedEventDto>({\n\t\t\tversionId: notebook.apiNotebook.version + 1,\n\t\t\trawEvents: [{\n\t\t\t\tkind: NotebookCellsChangeType.OutputItem,\n\t\t\t\tindex: cellIndex,\n\t\t\t\tappend: true,\n\t\t\t\toutputId,\n\t\t\t\toutputItems\n\t\t\t}]\n\t\t}), false);\n\t\tawait changeEvent;\n\t}\n\ttest('Append multiple text/plain output items', async function () {\n\t\tawait replaceOutputs(1, '1', [{ mime: 'text/plain', valueBytes: VSBuffer.fromString('foo') }]);\n\t\tawait appendOutputItem(1, '1', [{ mime: 'text/plain', valueBytes: VSBuffer.fromString('bar') }]);\n\t\tawait appendOutputItem(1, '1', [{ mime: 'text/plain', valueBytes: VSBuffer.fromString('baz') }]);\n\n\n\t\tassert.strictEqual(notebook.apiNotebook.cellAt(1).outputs.length, 1);\n\t\tassert.strictEqual(notebook.apiNotebook.cellAt(1).outputs[0].items.length, 3);\n\t\tassert.strictEqual(notebook.apiNotebook.cellAt(1).outputs[0].items[0].mime, 'text/plain');\n\t\tassert.strictEqual(VSBuffer.wrap(notebook.apiNotebook.cellAt(1).outputs[0].items[0].data).toString(), 'foo');\n\t\tassert.strictEqual(notebook.apiNotebook.cellAt(1).outputs[0].items[1].mime, 'text/plain');\n\t\tassert.strictEqual(VSBuffer.wrap(notebook.apiNotebook.cellAt(1).outputs[0].items[1].data).toString(), 'bar');\n\t\tassert.strictEqual(notebook.apiNotebook.cellAt(1).outputs[0].items[2].mime, 'text/plain');\n\t\tassert.strictEqual(VSBuffer.wrap(notebook.apiNotebook.cellAt(1).outputs[0].items[2].data).toString(), 'baz');\n\t});\n\ttest('Append multiple stdout stream output items to an output with another mime', async function () {\n\t\tawait replaceOutputs(1, '1', [{ mime: 'text/plain', valueBytes: VSBuffer.fromString('foo') }]);\n\t\tawait appendOutputItem(1, '1', [{ mime: 'application/vnd.code.notebook.stdout', valueBytes: VSBuffer.fromString('bar') }]);\n\t\tawait appendOutputItem(1, '1', [{ mime: 'application/vnd.code.notebook.stdout', valueBytes: VSBuffer.fromString('baz') }]);\n\n\t\tassert.strictEqual(notebook.apiNotebook.cellAt(1).outputs.length, 1);\n\t\tassert.strictEqual(notebook.apiNotebook.cellAt(1).outputs[0].items.length, 3);\n\t\tassert.strictEqual(notebook.apiNotebook.cellAt(1).outputs[0].items[0].mime, 'text/plain');\n\t\tassert.strictEqual(notebook.apiNotebook.cellAt(1).outputs[0].items[1].mime, 'application/vnd.code.notebook.stdout');\n\t\tassert.strictEqual(notebook.apiNotebook.cellAt(1).outputs[0].items[2].mime, 'application/vnd.code.notebook.stdout');\n\t});\n\ttest('Compress multiple stdout stream output items', async function () {\n\t\tawait replaceOutputs(1, '1', [{ mime: 'application/vnd.code.notebook.stdout', valueBytes: VSBuffer.fromString('foo') }]);\n\t\tawait appendOutputItem(1, '1', [{ mime: 'application/vnd.code.notebook.stdout', valueBytes: VSBuffer.fromString('bar') }]);\n\t\tawait appendOutputItem(1, '1', [{ mime: 'application/vnd.code.notebook.stdout', valueBytes: VSBuffer.fromString('baz') }]);\n\n\t\tassert.strictEqual(notebook.apiNotebook.cellAt(1).outputs.length, 1);\n\t\tassert.strictEqual(notebook.apiNotebook.cellAt(1).outputs[0].items.length, 1);\n\t\tassert.strictEqual(notebook.apiNotebook.cellAt(1).outputs[0].items[0].mime, 'application/vnd.code.notebook.stdout');\n\t\tassert.strictEqual(VSBuffer.wrap(notebook.apiNotebook.cellAt(1).outputs[0].items[0].data).toString(), 'foobarbaz');\n\t});\n\ttest('Compress multiple stdout stream output items (with support for terminal escape code -> \\u001b[A)', async function () {\n\t\tawait replaceOutputs(1, '1', [{ mime: 'application/vnd.code.notebook.stdout', valueBytes: VSBuffer.fromString('\\nfoo') }]);\n\t\tawait appendOutputItem(1, '1', [{ mime: 'application/vnd.code.notebook.stdout', valueBytes: VSBuffer.fromString(`${String.fromCharCode(27)}[Abar`) }]);\n\n\t\tassert.strictEqual(notebook.apiNotebook.cellAt(1).outputs.length, 1);\n\t\tassert.strictEqual(notebook.apiNotebook.cellAt(1).outputs[0].items.length, 1);\n\t\tassert.strictEqual(notebook.apiNotebook.cellAt(1).outputs[0].items[0].mime, 'application/vnd.code.notebook.stdout');\n\t\tassert.strictEqual(VSBuffer.wrap(notebook.apiNotebook.cellAt(1).outputs[0].items[0].data).toString(), 'bar');\n\t});\n\ttest('Compress multiple stdout stream output items (with support for terminal escape code -> \\r character)', async function () {\n\t\tawait replaceOutputs(1, '1', [{ mime: 'application/vnd.code.notebook.stdout', valueBytes: VSBuffer.fromString('foo') }]);\n\t\tawait appendOutputItem(1, '1', [{ mime: 'application/vnd.code.notebook.stdout', valueBytes: VSBuffer.fromString(`\\rbar`) }]);\n\n\t\tassert.strictEqual(notebook.apiNotebook.cellAt(1).outputs.length, 1);\n\t\tassert.strictEqual(notebook.apiNotebook.cellAt(1).outputs[0].items.length, 1);\n\t\tassert.strictEqual(notebook.apiNotebook.cellAt(1).outputs[0].items[0].mime, 'application/vnd.code.notebook.stdout');\n\t\tassert.strictEqual(VSBuffer.wrap(notebook.apiNotebook.cellAt(1).outputs[0].items[0].data).toString(), 'bar');\n\t});\n\ttest('Compress multiple stderr stream output items', async function () {\n\t\tawait replaceOutputs(1, '1', [{ mime: 'application/vnd.code.notebook.stderr', valueBytes: VSBuffer.fromString('foo') }]);\n\t\tawait appendOutputItem(1, '1', [{ mime: 'application/vnd.code.notebook.stderr', valueBytes: VSBuffer.fromString('bar') }]);\n\t\tawait appendOutputItem(1, '1', [{ mime: 'application/vnd.code.notebook.stderr', valueBytes: VSBuffer.fromString('baz') }]);\n\n\t\tassert.strictEqual(notebook.apiNotebook.cellAt(1).outputs.length, 1);\n\t\tassert.strictEqual(notebook.apiNotebook.cellAt(1).outputs[0].items.length, 1);\n\t\tassert.strictEqual(notebook.apiNotebook.cellAt(1).outputs[0].items[0].mime, 'application/vnd.code.notebook.stderr');\n\t\tassert.strictEqual(VSBuffer.wrap(notebook.apiNotebook.cellAt(1).outputs[0].items[0].data).toString(), 'foobarbaz');\n\t});\n});\n"]}