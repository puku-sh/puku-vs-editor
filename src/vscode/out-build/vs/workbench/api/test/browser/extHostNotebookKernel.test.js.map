{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/api/test/browser/extHostNotebookKernel.test.ts","vs/workbench/api/test/browser/extHostNotebookKernel.test.ts"],"names":[],"mappings":"AAAA;;;gGAGgG;AAEhG,OAAO,MAAM,MAAM,QAAQ,CAAC;AAC5B,OAAO,EAAE,OAAO,EAAE,MAAM,kCAAkC,CAAC;AAC3D,OAAO,EAAE,eAAe,EAAE,MAAM,sCAAsC,CAAC;AACvE,OAAO,EAAE,GAAG,EAAiB,MAAM,gCAAgC,CAAC;AACpE,OAAO,EAAE,mBAAmB,EAAE,MAAM,sDAAsD,CAAC;AAC3F,OAAO,EAAE,cAAc,EAAE,MAAM,wCAAwC,CAAC;AACxE,OAAO,EAAyE,WAAW,EAAsH,MAAM,kCAAkC,CAAC;AAC1P,OAAO,EAAE,eAAe,EAAE,MAAM,iCAAiC,CAAC;AAClE,OAAO,EAAE,gBAAgB,EAAE,MAAM,kCAAkC,CAAC;AACpE,OAAO,EAAE,0BAA0B,EAAE,MAAM,4CAA4C,CAAC;AAExF,OAAO,EAAE,yBAAyB,EAAE,MAAM,iCAAiC,CAAC;AAE5E,OAAO,EAAE,wBAAwB,EAAE,MAAM,0CAA0C,CAAC;AACpF,OAAO,EAAE,sBAAsB,EAAE,MAAM,wCAAwC,CAAC;AAChF,OAAO,EAAE,kBAAkB,EAAE,sBAAsB,EAAE,MAAM,8BAA8B,CAAC;AAC1F,OAAO,EAAE,QAAQ,EAAE,OAAO,EAAE,uBAAuB,EAAE,MAAM,oDAAoD,CAAC;AAChH,OAAO,EAAE,uBAAuB,EAAE,MAAM,8DAA8D,CAAC;AACvG,OAAO,EAAE,wBAAwB,EAAE,MAAM,mDAAmD,CAAC;AAC7F,OAAO,EAAE,6BAA6B,EAAE,MAAM,wDAAwD,CAAC;AACvG,OAAO,EAAE,eAAe,EAAE,MAAM,8BAA8B,CAAC;AAC/D,OAAO,EAAE,IAAI,EAAE,MAAM,+CAA+C,CAAC;AAErE,OAAO,EAAE,yBAAyB,EAAE,MAAM,2CAA2C,CAAC;AACtF,OAAO,EAAE,qBAAqB,EAAE,MAAM,uCAAuC,CAAC;AAC9E,OAAO,EAAE,uCAAuC,EAAE,MAAM,uCAAuC,CAAC;AAChG,OAAO,EAAE,aAAa,EAAE,MAAM,+BAA+B,CAAC;AAC9D,OAAO,EAAE,qBAAqB,EAAE,MAAM,8CAA8C,CAAC;AAErF,KAAK,CAAC,gBAAgB,EAAE;IACvB,IAAI,WAA4B,CAAC;IACjC,IAAI,sBAA8C,CAAC;IACnD,IAAI,QAAiC,CAAC;IACtC,IAAI,0BAAsD,CAAC;IAC3D,IAAI,gBAAkC,CAAC;IACvC,IAAI,gBAA2C,CAAC;IAChD,IAAI,wBAAkD,CAAC;IACvD,IAAI,eAAgC,CAAC;IACrC,IAAI,yBAAoD,CAAC;IACzD,IAAI,aAA4B,CAAC;IAEjC,MAAM,WAAW,GAAG,GAAG,CAAC,KAAK,CAAC,uBAAuB,CAAC,CAAC;IACvD,MAAM,UAAU,GAAG,IAAI,GAAG,EAA+B,CAAC;IAC1D,MAAM,WAAW,GAAG,IAAI,eAAe,EAAE,CAAC;IAE1C,MAAM,iBAAiB,GAAgD,EAAE,CAAC;IAC1E,MAAM,kBAAkB,GAA4B,EAAE,CAAC;IACvD,MAAM,mBAAmB,GAAgC,EAAE,CAAC;IAE5D,QAAQ,CAAC;QACR,WAAW,CAAC,KAAK,EAAE,CAAC;IACrB,CAAC,CAAC,CAAC;IAEH,uCAAuC,EAAE,CAAC;IAE1C,KAAK,CAAC,KAAK;QACV,iBAAiB,CAAC,MAAM,GAAG,CAAC,CAAC;QAC7B,kBAAkB,CAAC,MAAM,GAAG,CAAC,CAAC;QAC9B,mBAAmB,CAAC,MAAM,GAAG,CAAC,CAAC;QAC/B,UAAU,CAAC,KAAK,EAAE,CAAC;QAEnB,WAAW,GAAG,IAAI,eAAe,EAAE,CAAC;QACpC,WAAW,CAAC,GAAG,CAAC,WAAW,CAAC,kBAAkB,EAAE,IAAI,KAAM,SAAQ,IAAI,EAA2B;YACvF,gBAAgB,KAAK,CAAC;SAC/B,CAAC,CAAC;QACH,WAAW,CAAC,GAAG,CAAC,WAAW,CAAC,yBAAyB,EAAE,IAAI,KAAM,SAAQ,IAAI,EAAkC;YACrG,KAAK,CAAC,UAAU,CAAC,MAAc,EAAE,IAAyB;gBAClE,UAAU,CAAC,GAAG,CAAC,MAAM,EAAE,IAAI,CAAC,CAAC;YAC9B,CAAC;YACQ,aAAa,CAAC,MAAc;gBACpC,UAAU,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC;YAC3B,CAAC;YACQ,aAAa,CAAC,MAAc,EAAE,IAAkC;gBACxE,MAAM,CAAC,WAAW,CAAC,UAAU,CAAC,GAAG,CAAC,MAAM,CAAC,EAAE,IAAI,CAAC,CAAC;gBACjD,UAAU,CAAC,GAAG,CAAC,MAAM,EAAE,EAAE,GAAG,UAAU,CAAC,GAAG,CAAC,MAAM,CAAE,EAAE,GAAG,IAAI,GAAG,CAAC,CAAC;YAClE,CAAC;YACQ,gBAAgB,CAAC,MAAc,EAAE,YAAoB,EAAE,GAAkB,EAAE,UAAkB;gBACrG,iBAAiB,CAAC,IAAI,CAAC,EAAE,QAAQ,EAAE,GAAG,EAAE,IAAI,EAAE,UAAU,EAAE,CAAC,CAAC;YAC7D,CAAC;YACQ,gBAAgB,CAAC,MAAc,EAAE,IAA4D;gBACrG,kBAAkB,CAAC,IAAI,CAAC,GAAG,IAAI,CAAC,KAAK,CAAC,CAAC;YACxC,CAAC;YACQ,kBAAkB,CAAC,MAAc,EAAE,IAA8D;gBACzG,mBAAmB,CAAC,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;YACtC,CAAC;SACD,CAAC,CAAC;QACH,WAAW,CAAC,GAAG,CAAC,WAAW,CAAC,2BAA2B,EAAE,IAAI,KAAM,SAAQ,IAAI,EAAoC;SAElH,CAAC,CAAC;QACH,WAAW,CAAC,GAAG,CAAC,WAAW,CAAC,kBAAkB,EAAE,IAAI,KAAM,SAAQ,IAAI,EAA2B;YACvF,KAAK,CAAC,2BAA2B,KAAK,CAAC;YACvC,KAAK,CAAC,6BAA6B,KAAK,CAAC;SAClD,CAAC,CAAC;QACH,0BAA0B,GAAG,IAAI,0BAA0B,CAAC,WAAW,EAAE,IAAI,cAAc,EAAE,CAAC,CAAC;QAC/F,gBAAgB,GAAG,WAAW,CAAC,GAAG,CAAC,IAAI,gBAAgB,CAAC,WAAW,EAAE,0BAA0B,CAAC,CAAC,CAAC;QAClG,eAAe,GAAG,IAAI,eAAe,CAAC,WAAW,EAAE,IAAI,cAAc,EAAE,EAAE,IAAI,KAAM,SAAQ,IAAI,EAAqB;YAC1G,gBAAgB;gBACxB,OAAO,IAAI,CAAC;YACb,CAAC;SACD,CAAC,CAAC;QACH,yBAAyB,GAAG,IAAI,yBAAyB,CAAC,WAAW,EAAE,IAAI,qBAAqB,EAAE,CAAC,CAAC;QACpG,aAAa,GAAG,IAAI,aAAa,CAAC,WAAW,EAAE,IAAI,qBAAqB,CAAC,IAAI,CAAC,EAAE,IAAI,cAAc,EAAE,CAAC,CAAC;QACtG,gBAAgB,GAAG,IAAI,yBAAyB,CAAC,WAAW,EAAE,eAAe,EAAE,0BAA0B,EAAE,gBAAgB,EAAE,yBAAyB,EAAE,aAAa,EAAE,IAAI,cAAc,EAAE,CAAC,CAAC;QAE7L,wBAAwB,GAAG,IAAI,wBAAwB,CAAC,gBAAgB,CAAC,CAAC;QAE1E,gBAAgB,CAAC,8BAA8B,CAAC,IAAI,6BAA6B,CAAC;YACjF,cAAc,EAAE,CAAC;oBAChB,GAAG,EAAE,WAAW;oBAChB,QAAQ,EAAE,MAAM;oBAChB,SAAS,EAAE,CAAC;oBACZ,KAAK,EAAE,CAAC;4BACP,MAAM,EAAE,CAAC;4BACT,GAAG,EAAE,OAAO,CAAC,QAAQ,CAAC,WAAW,EAAE,CAAC,CAAC;4BACrC,MAAM,EAAE,CAAC,aAAa,CAAC;4BACvB,GAAG,EAAE,IAAI;4BACT,QAAQ,EAAE,UAAU;4BACpB,QAAQ,EAAE,QAAQ,CAAC,MAAM;4BACzB,OAAO,EAAE,EAAE;yBACX,EAAE;4BACF,MAAM,EAAE,CAAC;4BACT,GAAG,EAAE,OAAO,CAAC,QAAQ,CAAC,WAAW,EAAE,CAAC,CAAC;4BACrC,MAAM,EAAE,CAAC,oBAAoB,EAAE,oBAAoB,CAAC;4BACpD,GAAG,EAAE,IAAI;4BACT,QAAQ,EAAE,YAAY;4BACtB,QAAQ,EAAE,QAAQ,CAAC,IAAI;4BACvB,OAAO,EAAE,EAAE;yBACX,CAAC;iBACF,CAAC;YACF,YAAY,EAAE,CAAC;oBACd,WAAW,EAAE,WAAW;oBACxB,EAAE,EAAE,oBAAoB;oBACxB,UAAU,EAAE,CAAC,EAAE,KAAK,EAAE,CAAC,EAAE,GAAG,EAAE,CAAC,EAAE,CAAC;oBAClC,aAAa,EAAE,EAAE;oBACjB,QAAQ,EAAE,MAAM;iBAChB,CAAC;SACF,CAAC,CAAC,CAAC;QACJ,gBAAgB,CAAC,8BAA8B,CAAC,IAAI,6BAA6B,CAAC,EAAE,eAAe,EAAE,oBAAoB,EAAE,CAAC,CAAC,CAAC;QAE9H,QAAQ,GAAG,gBAAgB,CAAC,iBAAiB,CAAC,CAAC,CAAE,CAAC;QAElD,WAAW,CAAC,GAAG,CAAC,QAAQ,CAAC,CAAC;QAC1B,WAAW,CAAC,GAAG,CAAC,gBAAgB,CAAC,CAAC;QAGlC,sBAAsB,GAAG,IAAI,sBAAsB,CAClD,WAAW,EACX,IAAI,KAAM,SAAQ,IAAI,EAA2B;SAAI,EACrD,gBAAgB,EAChB,eAAe,EACf,IAAI,cAAc,EAAE,CACpB,CAAC;IACH,CAAC,CAAC,CAAC;IAEH,IAAI,CAAC,uBAAuB,EAAE,KAAK;QAElC,MAAM,MAAM,GAAG,sBAAsB,CAAC,wBAAwB,CAAC,wBAAwB,EAAE,KAAK,EAAE,GAAG,EAAE,KAAK,CAAC,CAAC;QAE5G,mDAAmD;QACnD,MAAM,CAAC,MAAM,CAAC,GAAG,EAAE,CAAO,MAAO,CAAC,EAAE,GAAG,IAAI,CAAC,CAAC;QAC7C,mDAAmD;QACnD,MAAM,CAAC,MAAM,CAAC,GAAG,EAAE,CAAO,MAAO,CAAC,YAAY,GAAG,IAAI,CAAC,CAAC;QAEvD,MAAM,CAAC,EAAE,CAAC,MAAM,CAAC,CAAC;QAClB,MAAM,CAAC,WAAW,CAAC,MAAM,CAAC,EAAE,EAAE,KAAK,CAAC,CAAC;QACrC,MAAM,CAAC,WAAW,CAAC,MAAM,CAAC,KAAK,EAAE,KAAK,CAAC,CAAC;QACxC,MAAM,CAAC,WAAW,CAAC,MAAM,CAAC,YAAY,EAAE,GAAG,CAAC,CAAC;QAE7C,MAAM,WAAW,CAAC,IAAI,EAAE,CAAC;QACzB,MAAM,CAAC,WAAW,CAAC,UAAU,CAAC,IAAI,EAAE,CAAC,CAAC,CAAC;QAEvC,MAAM,CAAC,KAAK,CAAC,GAAG,UAAU,CAAC,MAAM,EAAE,CAAC;QACpC,MAAM,CAAC,WAAW,CAAC,KAAK,CAAC,EAAE,EAAE,8BAA8B,CAAC,CAAC;QAC7D,MAAM,CAAC,WAAW,CAAC,mBAAmB,CAAC,MAAM,CAAC,KAAK,CAAC,WAAW,EAAE,wBAAwB,CAAC,UAAU,CAAC,EAAE,IAAI,CAAC,CAAC;QAC7G,MAAM,CAAC,WAAW,CAAC,KAAK,CAAC,KAAK,EAAE,KAAK,CAAC,CAAC;QACvC,MAAM,CAAC,WAAW,CAAC,KAAK,CAAC,YAAY,EAAE,GAAG,CAAC,CAAC;QAE5C,MAAM,CAAC,OAAO,EAAE,CAAC;QACjB,MAAM,WAAW,CAAC,IAAI,EAAE,CAAC;QACzB,MAAM,CAAC,WAAW,CAAC,UAAU,CAAC,IAAI,EAAE,CAAC,CAAC,CAAC;IACxC,CAAC,CAAC,CAAC;IAEH,IAAI,CAAC,eAAe,EAAE,KAAK;QAE1B,MAAM,MAAM,GAAG,WAAW,CAAC,GAAG,CAAC,sBAAsB,CAAC,wBAAwB,CAAC,wBAAwB,EAAE,KAAK,EAAE,GAAG,EAAE,KAAK,CAAC,CAAC,CAAC;QAE7H,MAAM,WAAW,CAAC,IAAI,EAAE,CAAC;QACzB,MAAM,CAAC,EAAE,CAAC,MAAM,CAAC,CAAC;QAElB,IAAI,CAAC,KAAK,CAAC,GAAG,UAAU,CAAC,MAAM,EAAE,CAAC;QAClC,MAAM,CAAC,WAAW,CAAC,KAAK,CAAC,EAAE,EAAE,8BAA8B,CAAC,CAAC;QAC7D,MAAM,CAAC,WAAW,CAAC,KAAK,CAAC,KAAK,EAAE,KAAK,CAAC,CAAC;QAEvC,MAAM,CAAC,KAAK,GAAG,KAAK,CAAC;QACrB,MAAM,CAAC,WAAW,CAAC,MAAM,CAAC,KAAK,EAAE,KAAK,CAAC,CAAC;QAExC,MAAM,WAAW,CAAC,IAAI,EAAE,CAAC;QACzB,CAAC,KAAK,CAAC,GAAG,UAAU,CAAC,MAAM,EAAE,CAAC;QAC9B,MAAM,CAAC,WAAW,CAAC,KAAK,CAAC,EAAE,EAAE,8BAA8B,CAAC,CAAC;QAC7D,MAAM,CAAC,WAAW,CAAC,KAAK,CAAC,KAAK,EAAE,KAAK,CAAC,CAAC;IACxC,CAAC,CAAC,CAAC;IAEH,IAAI,CAAC,8CAA8C,EAAE;QACpD,MAAM,MAAM,GAAG,WAAW,CAAC,GAAG,CAAC,sBAAsB,CAAC,wBAAwB,CAAC,wBAAwB,EAAE,KAAK,EAAE,GAAG,EAAE,KAAK,CAAC,CAAC,CAAC;QAE7H,sBAAsB,CAAC,0BAA0B,CAAC,CAAC,EAAE,QAAQ,CAAC,GAAG,EAAE,IAAI,CAAC,CAAC;QAEzE,MAAM,KAAK,GAAG,QAAQ,CAAC,WAAW,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC;QAC7C,MAAM,IAAI,GAAG,MAAM,CAAC,2BAA2B,CAAC,KAAK,CAAC,CAAC;QACvD,IAAI,CAAC,KAAK,EAAE,CAAC;QACb,IAAI,CAAC,GAAG,CAAC,SAAS,CAAC,CAAC;IACrB,CAAC,CAAC,CAAC;IAEH,IAAI,CAAC,0DAA0D,EAAE;QAChE,MAAM,MAAM,GAAG,WAAW,CAAC,GAAG,CAAC,sBAAsB,CAAC,wBAAwB,CAAC,wBAAwB,EAAE,KAAK,EAAE,GAAG,EAAE,KAAK,CAAC,CAAC,CAAC;QAC7H,MAAM,CAAC,MAAM,CAAC,GAAG,EAAE;YAClB,MAAM,CAAC,2BAA2B,CAAC,QAAQ,CAAC,WAAW,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,CAAC;QACpE,CAAC,CAAC,CAAC;QAEH,sBAAsB,CAAC,0BAA0B,CAAC,CAAC,EAAE,QAAQ,CAAC,GAAG,EAAE,IAAI,CAAC,CAAC;QACzE,MAAM,SAAS,GAAG,MAAM,CAAC,2BAA2B,CAAC,QAAQ,CAAC,WAAW,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,CAAC;QACrF,SAAS,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC;IACrB,CAAC,CAAC,CAAC;IAEH,IAAI,CAAC,iDAAiD,EAAE;QACvD,MAAM,MAAM,GAAG,WAAW,CAAC,GAAG,CAAC,sBAAsB,CAAC,wBAAwB,CAAC,wBAAwB,EAAE,KAAK,EAAE,GAAG,EAAE,KAAK,CAAC,CAAC,CAAC;QAE7H,MAAM,KAAK,GAAG,QAAQ,CAAC,WAAW,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC;QAE7C,sBAAsB,CAAC,0BAA0B,CAAC,CAAC,EAAE,QAAQ,CAAC,GAAG,EAAE,IAAI,CAAC,CAAC;QACzE,wBAAwB,CAAC,mBAAmB,CAAC,QAAQ,CAAC,GAAG,EAAE,IAAI,6BAA6B,CAAC;YAC5F,SAAS,EAAE,EAAE;YACb,SAAS,EAAE,CAAC;oBACX,IAAI,EAAE,uBAAuB,CAAC,WAAW;oBACzC,OAAO,EAAE,CAAC,CAAC,CAAC,EAAE,QAAQ,CAAC,WAAW,CAAC,SAAS,EAAE,EAAE,CAAC,CAAC;iBAClD,CAAC;SACF,CAAC,EAAE,IAAI,CAAC,CAAC;QAEV,MAAM,CAAC,WAAW,CAAC,KAAK,CAAC,KAAK,EAAE,CAAC,CAAC,CAAC,CAAC;QAEpC,MAAM,CAAC,MAAM,CAAC,GAAG,EAAE;YAClB,MAAM,CAAC,2BAA2B,CAAC,KAAK,CAAC,CAAC;QAC3C,CAAC,CAAC,CAAC;IACJ,CAAC,CAAC,CAAC;IAEH,IAAI,CAAC,iCAAiC,EAAE,KAAK;QAE5C,IAAI,kBAAkB,GAAG,CAAC,CAAC;QAC3B,IAAI,gBAAgB,GAAG,CAAC,CAAC;QAEzB,MAAM,MAAM,GAAG,WAAW,CAAC,GAAG,CAAC,sBAAsB,CAAC,wBAAwB,CAAC,wBAAwB,EAAE,KAAK,EAAE,GAAG,EAAE,KAAK,CAAC,CAAC,CAAC;QAC7H,MAAM,CAAC,gBAAgB,GAAG,GAAG,EAAE,GAAG,kBAAkB,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC;QAC7D,sBAAsB,CAAC,0BAA0B,CAAC,CAAC,EAAE,QAAQ,CAAC,GAAG,EAAE,IAAI,CAAC,CAAC;QAEzE,MAAM,KAAK,GAAG,QAAQ,CAAC,WAAW,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC;QAE7C,MAAM,IAAI,GAAG,MAAM,CAAC,2BAA2B,CAAC,KAAK,CAAC,CAAC;QACvD,WAAW,CAAC,GAAG,CAAC,IAAI,CAAC,KAAK,CAAC,uBAAuB,CAAC,GAAG,EAAE,CAAC,gBAAgB,IAAI,CAAC,CAAC,CAAC,CAAC;QAEjF,MAAM,sBAAsB,CAAC,YAAY,CAAC,CAAC,EAAE,QAAQ,CAAC,GAAG,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC;QAChE,MAAM,CAAC,WAAW,CAAC,kBAAkB,EAAE,CAAC,CAAC,CAAC;QAC1C,MAAM,CAAC,WAAW,CAAC,gBAAgB,EAAE,CAAC,CAAC,CAAC;QAExC,MAAM,sBAAsB,CAAC,YAAY,CAAC,CAAC,EAAE,QAAQ,CAAC,GAAG,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC;QAChE,MAAM,CAAC,WAAW,CAAC,kBAAkB,EAAE,CAAC,CAAC,CAAC;QAC1C,MAAM,CAAC,WAAW,CAAC,gBAAgB,EAAE,CAAC,CAAC,CAAC;QAExC,sDAAsD;QACtD,IAAI,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC;IACjB,CAAC,CAAC,CAAC;IAEH,IAAI,CAAC,uBAAuB,EAAE,KAAK;QAElC,MAAM,MAAM,GAAG,WAAW,CAAC,GAAG,CAAC,sBAAsB,CAAC,wBAAwB,CAAC,wBAAwB,EAAE,KAAK,EAAE,GAAG,EAAE,KAAK,CAAC,CAAC,CAAC;QAC7H,sBAAsB,CAAC,0BAA0B,CAAC,CAAC,EAAE,QAAQ,CAAC,GAAG,EAAE,IAAI,CAAC,CAAC;QAEzE,MAAM,KAAK,GAAG,QAAQ,CAAC,WAAW,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC;QAC7C,MAAM,IAAI,GAAG,MAAM,CAAC,2BAA2B,CAAC,KAAK,CAAC,CAAC;QACvD,IAAI,CAAC,KAAK,EAAE,CAAC;QAEb,MAAM,CAAC,GAAG,IAAI,OAAO,EAAE,CAAC;QAExB,WAAW,CAAC,GAAG,CACd,IAAI,CAAC,KAAK,CAAC,uBAAuB,CAAC,KAAK,IAAI,EAAE;YAC7C,MAAM,IAAI,CAAC,aAAa,CAAC,IAAI,kBAAkB,CAAC,CAAC,sBAAsB,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC,CAAC,CAAC,CAAC;YAC5F,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC;YACf,CAAC,CAAC,IAAI,EAAE,CAAC,CAAC,uDAAuD;QAClE,CAAC,CAAC,CACF,CAAC;QAEF,kBAAkB,CAAC,MAAM,GAAG,CAAC,CAAC;QAC9B,MAAM,sBAAsB,CAAC,YAAY,CAAC,CAAC,EAAE,QAAQ,CAAC,GAAG,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC;QAEhE,MAAM,CAAC,CAAC,IAAI,EAAE,CAAC;QAEf,MAAM,CAAC,WAAW,CAAC,kBAAkB,CAAC,MAAM,GAAG,CAAC,EAAE,IAAI,CAAC,CAAC;QAExD,IAAI,KAAK,GAAG,KAAK,CAAC;QAClB,KAAK,MAAM,IAAI,IAAI,kBAAkB,EAAE,CAAC;YACvC,IAAI,IAAI,CAAC,QAAQ,KAAK,uBAAuB,CAAC,MAAM,EAAE,CAAC;gBACtD,MAAM,CAAC,WAAW,CAAC,IAAI,CAAC,MAAM,EAAE,KAAK,CAAC,CAAC;gBACvC,MAAM,CAAC,WAAW,CAAC,IAAI,CAAC,OAAO,CAAC,MAAM,EAAE,CAAC,CAAC,CAAC;gBAC3C,MAAM,CAAC,WAAW,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC,KAAK,CAAC,MAAM,EAAE,CAAC,CAAC,CAAC;gBACpD,MAAM,CAAC,eAAe,CAAC,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,UAAU,CAAC,MAAM,CAAC,EAAE,KAAK,CAAC,IAAI,CAAC,IAAI,WAAW,EAAE,CAAC,MAAM,CAAC,UAAU,CAAC,CAAC,CAAC,CAAC;gBACjI,KAAK,GAAG,IAAI,CAAC;YACd,CAAC;QACF,CAAC;QACD,MAAM,CAAC,EAAE,CAAC,KAAK,CAAC,CAAC;IAClB,CAAC,CAAC,CAAC;IAEH,IAAI,CAAC,0BAA0B,EAAE,KAAK;QAErC,MAAM,MAAM,GAAG,sBAAsB,CAAC,wBAAwB,CAAC,wBAAwB,EAAE,KAAK,EAAE,GAAG,EAAE,KAAK,CAAC,CAAC;QAC5G,sBAAsB,CAAC,0BAA0B,CAAC,CAAC,EAAE,QAAQ,CAAC,GAAG,EAAE,IAAI,CAAC,CAAC;QAGzE,MAAM,KAAK,GAAG,QAAQ,CAAC,WAAW,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC;QAC7C,MAAM,IAAI,GAAG,MAAM,CAAC,2BAA2B,CAAC,KAAK,CAAC,CAAC;QACvD,IAAI,CAAC,KAAK,EAAE,CAAC;QAEb,MAAM,CAAC,gBAAgB,GAAG,KAAK,EAAC,SAAS,EAAC,EAAE;YAC3C,MAAM,CAAC,EAAE,CAAC,QAAQ,CAAC,WAAW,KAAK,SAAS,CAAC,CAAC;YAC9C,MAAM,IAAI,CAAC,aAAa,CAAC,IAAI,kBAAkB,CAAC,CAAC,sBAAsB,CAAC,IAAI,CAAC,aAAa,CAAC,CAAC,CAAC,CAAC,CAAC;YAC/F,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC;QAChB,CAAC,CAAC;QAEF,kBAAkB,CAAC,MAAM,GAAG,CAAC,CAAC;QAC9B,MAAM,sBAAsB,CAAC,YAAY,CAAC,CAAC,EAAE,QAAQ,CAAC,GAAG,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC;QAEhE,MAAM,CAAC,WAAW,CAAC,kBAAkB,CAAC,MAAM,GAAG,CAAC,EAAE,IAAI,CAAC,CAAC;QAExD,IAAI,KAAK,GAAG,KAAK,CAAC;QAClB,KAAK,MAAM,IAAI,IAAI,kBAAkB,EAAE,CAAC;YACvC,IAAI,IAAI,CAAC,QAAQ,KAAK,uBAAuB,CAAC,MAAM,EAAE,CAAC;gBACtD,MAAM,CAAC,WAAW,CAAC,IAAI,CAAC,MAAM,EAAE,KAAK,CAAC,CAAC;gBACvC,MAAM,CAAC,WAAW,CAAC,IAAI,CAAC,OAAO,CAAC,MAAM,EAAE,CAAC,CAAC,CAAC;gBAC3C,MAAM,CAAC,WAAW,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC,KAAK,CAAC,MAAM,EAAE,CAAC,CAAC,CAAC;gBACpD,MAAM,CAAC,eAAe,CAAC,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,UAAU,CAAC,MAAM,CAAC,EAAE,KAAK,CAAC,IAAI,CAAC,IAAI,WAAW,EAAE,CAAC,MAAM,CAAC,aAAa,CAAC,CAAC,CAAC,CAAC;gBACpI,KAAK,GAAG,IAAI,CAAC;YACd,CAAC;QACF,CAAC;QACD,MAAM,CAAC,EAAE,CAAC,KAAK,CAAC,CAAC;IAClB,CAAC,CAAC,CAAC;AACJ,CAAC,CAAC,CAAC","file":"extHostNotebookKernel.test.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport assert from 'assert';\nimport { Barrier } from '../../../../base/common/async.js';\nimport { DisposableStore } from '../../../../base/common/lifecycle.js';\nimport { URI, UriComponents } from '../../../../base/common/uri.js';\nimport { ExtensionIdentifier } from '../../../../platform/extensions/common/extensions.js';\nimport { NullLogService } from '../../../../platform/log/common/log.js';\nimport { ICellExecuteUpdateDto, ICellExecutionCompleteDto, INotebookKernelDto2, MainContext, MainThreadCommandsShape, MainThreadNotebookDocumentsShape, MainThreadNotebookKernelsShape, MainThreadNotebookShape } from '../../common/extHost.protocol.js';\nimport { ExtHostCommands } from '../../common/extHostCommands.js';\nimport { ExtHostDocuments } from '../../common/extHostDocuments.js';\nimport { ExtHostDocumentsAndEditors } from '../../common/extHostDocumentsAndEditors.js';\nimport { IExtHostInitDataService } from '../../common/extHostInitDataService.js';\nimport { ExtHostNotebookController } from '../../common/extHostNotebook.js';\nimport { ExtHostNotebookDocument } from '../../common/extHostNotebookDocument.js';\nimport { ExtHostNotebookDocuments } from '../../common/extHostNotebookDocuments.js';\nimport { ExtHostNotebookKernels } from '../../common/extHostNotebookKernels.js';\nimport { NotebookCellOutput, NotebookCellOutputItem } from '../../common/extHostTypes.js';\nimport { CellKind, CellUri, NotebookCellsChangeType } from '../../../contrib/notebook/common/notebookCommon.js';\nimport { CellExecutionUpdateType } from '../../../contrib/notebook/common/notebookExecutionService.js';\nimport { nullExtensionDescription } from '../../../services/extensions/common/extensions.js';\nimport { SerializableObjectWithBuffers } from '../../../services/extensions/common/proxyIdentifier.js';\nimport { TestRPCProtocol } from '../common/testRPCProtocol.js';\nimport { mock } from '../../../test/common/workbenchTestServices.js';\nimport { IExtHostTelemetry } from '../../common/extHostTelemetry.js';\nimport { ExtHostConsumerFileSystem } from '../../common/extHostFileSystemConsumer.js';\nimport { ExtHostFileSystemInfo } from '../../common/extHostFileSystemInfo.js';\nimport { ensureNoDisposablesAreLeakedInTestSuite } from '../../../../base/test/common/utils.js';\nimport { ExtHostSearch } from '../../common/extHostSearch.js';\nimport { URITransformerService } from '../../common/extHostUriTransformerService.js';\n\nsuite('NotebookKernel', function () {\n\tlet rpcProtocol: TestRPCProtocol;\n\tlet extHostNotebookKernels: ExtHostNotebookKernels;\n\tlet notebook: ExtHostNotebookDocument;\n\tlet extHostDocumentsAndEditors: ExtHostDocumentsAndEditors;\n\tlet extHostDocuments: ExtHostDocuments;\n\tlet extHostNotebooks: ExtHostNotebookController;\n\tlet extHostNotebookDocuments: ExtHostNotebookDocuments;\n\tlet extHostCommands: ExtHostCommands;\n\tlet extHostConsumerFileSystem: ExtHostConsumerFileSystem;\n\tlet extHostSearch: ExtHostSearch;\n\n\tconst notebookUri = URI.parse('test:///notebook.file');\n\tconst kernelData = new Map<number, INotebookKernelDto2>();\n\tconst disposables = new DisposableStore();\n\n\tconst cellExecuteCreate: { notebook: UriComponents; cell: number }[] = [];\n\tconst cellExecuteUpdates: ICellExecuteUpdateDto[] = [];\n\tconst cellExecuteComplete: ICellExecutionCompleteDto[] = [];\n\n\tteardown(function () {\n\t\tdisposables.clear();\n\t});\n\n\tensureNoDisposablesAreLeakedInTestSuite();\n\n\tsetup(async function () {\n\t\tcellExecuteCreate.length = 0;\n\t\tcellExecuteUpdates.length = 0;\n\t\tcellExecuteComplete.length = 0;\n\t\tkernelData.clear();\n\n\t\trpcProtocol = new TestRPCProtocol();\n\t\trpcProtocol.set(MainContext.MainThreadCommands, new class extends mock<MainThreadCommandsShape>() {\n\t\t\toverride $registerCommand() { }\n\t\t});\n\t\trpcProtocol.set(MainContext.MainThreadNotebookKernels, new class extends mock<MainThreadNotebookKernelsShape>() {\n\t\t\toverride async $addKernel(handle: number, data: INotebookKernelDto2): Promise<void> {\n\t\t\t\tkernelData.set(handle, data);\n\t\t\t}\n\t\t\toverride $removeKernel(handle: number) {\n\t\t\t\tkernelData.delete(handle);\n\t\t\t}\n\t\t\toverride $updateKernel(handle: number, data: Partial<INotebookKernelDto2>) {\n\t\t\t\tassert.strictEqual(kernelData.has(handle), true);\n\t\t\t\tkernelData.set(handle, { ...kernelData.get(handle)!, ...data, });\n\t\t\t}\n\t\t\toverride $createExecution(handle: number, controllerId: string, uri: UriComponents, cellHandle: number): void {\n\t\t\t\tcellExecuteCreate.push({ notebook: uri, cell: cellHandle });\n\t\t\t}\n\t\t\toverride $updateExecution(handle: number, data: SerializableObjectWithBuffers<ICellExecuteUpdateDto[]>): void {\n\t\t\t\tcellExecuteUpdates.push(...data.value);\n\t\t\t}\n\t\t\toverride $completeExecution(handle: number, data: SerializableObjectWithBuffers<ICellExecutionCompleteDto>): void {\n\t\t\t\tcellExecuteComplete.push(data.value);\n\t\t\t}\n\t\t});\n\t\trpcProtocol.set(MainContext.MainThreadNotebookDocuments, new class extends mock<MainThreadNotebookDocumentsShape>() {\n\n\t\t});\n\t\trpcProtocol.set(MainContext.MainThreadNotebook, new class extends mock<MainThreadNotebookShape>() {\n\t\t\toverride async $registerNotebookSerializer() { }\n\t\t\toverride async $unregisterNotebookSerializer() { }\n\t\t});\n\t\textHostDocumentsAndEditors = new ExtHostDocumentsAndEditors(rpcProtocol, new NullLogService());\n\t\textHostDocuments = disposables.add(new ExtHostDocuments(rpcProtocol, extHostDocumentsAndEditors));\n\t\textHostCommands = new ExtHostCommands(rpcProtocol, new NullLogService(), new class extends mock<IExtHostTelemetry>() {\n\t\t\toverride onExtensionError(): boolean {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t});\n\t\textHostConsumerFileSystem = new ExtHostConsumerFileSystem(rpcProtocol, new ExtHostFileSystemInfo());\n\t\textHostSearch = new ExtHostSearch(rpcProtocol, new URITransformerService(null), new NullLogService());\n\t\textHostNotebooks = new ExtHostNotebookController(rpcProtocol, extHostCommands, extHostDocumentsAndEditors, extHostDocuments, extHostConsumerFileSystem, extHostSearch, new NullLogService());\n\n\t\textHostNotebookDocuments = new ExtHostNotebookDocuments(extHostNotebooks);\n\n\t\textHostNotebooks.$acceptDocumentAndEditorsDelta(new SerializableObjectWithBuffers({\n\t\t\taddedDocuments: [{\n\t\t\t\turi: notebookUri,\n\t\t\t\tviewType: 'test',\n\t\t\t\tversionId: 0,\n\t\t\t\tcells: [{\n\t\t\t\t\thandle: 0,\n\t\t\t\t\turi: CellUri.generate(notebookUri, 0),\n\t\t\t\t\tsource: ['### Heading'],\n\t\t\t\t\teol: '\\n',\n\t\t\t\t\tlanguage: 'markdown',\n\t\t\t\t\tcellKind: CellKind.Markup,\n\t\t\t\t\toutputs: [],\n\t\t\t\t}, {\n\t\t\t\t\thandle: 1,\n\t\t\t\t\turi: CellUri.generate(notebookUri, 1),\n\t\t\t\t\tsource: ['console.log(\"aaa\")', 'console.log(\"bbb\")'],\n\t\t\t\t\teol: '\\n',\n\t\t\t\t\tlanguage: 'javascript',\n\t\t\t\t\tcellKind: CellKind.Code,\n\t\t\t\t\toutputs: [],\n\t\t\t\t}],\n\t\t\t}],\n\t\t\taddedEditors: [{\n\t\t\t\tdocumentUri: notebookUri,\n\t\t\t\tid: '_notebook_editor_0',\n\t\t\t\tselections: [{ start: 0, end: 1 }],\n\t\t\t\tvisibleRanges: [],\n\t\t\t\tviewType: 'test',\n\t\t\t}]\n\t\t}));\n\t\textHostNotebooks.$acceptDocumentAndEditorsDelta(new SerializableObjectWithBuffers({ newActiveEditor: '_notebook_editor_0' }));\n\n\t\tnotebook = extHostNotebooks.notebookDocuments[0]!;\n\n\t\tdisposables.add(notebook);\n\t\tdisposables.add(extHostDocuments);\n\n\n\t\textHostNotebookKernels = new ExtHostNotebookKernels(\n\t\t\trpcProtocol,\n\t\t\tnew class extends mock<IExtHostInitDataService>() { },\n\t\t\textHostNotebooks,\n\t\t\textHostCommands,\n\t\t\tnew NullLogService()\n\t\t);\n\t});\n\n\ttest('create/dispose kernel', async function () {\n\n\t\tconst kernel = extHostNotebookKernels.createNotebookController(nullExtensionDescription, 'foo', '*', 'Foo');\n\n\t\t// eslint-disable-next-line local/code-no-any-casts\n\t\tassert.throws(() => (<any>kernel).id = 'dd');\n\t\t// eslint-disable-next-line local/code-no-any-casts\n\t\tassert.throws(() => (<any>kernel).notebookType = 'dd');\n\n\t\tassert.ok(kernel);\n\t\tassert.strictEqual(kernel.id, 'foo');\n\t\tassert.strictEqual(kernel.label, 'Foo');\n\t\tassert.strictEqual(kernel.notebookType, '*');\n\n\t\tawait rpcProtocol.sync();\n\t\tassert.strictEqual(kernelData.size, 1);\n\n\t\tconst [first] = kernelData.values();\n\t\tassert.strictEqual(first.id, 'nullExtensionDescription/foo');\n\t\tassert.strictEqual(ExtensionIdentifier.equals(first.extensionId, nullExtensionDescription.identifier), true);\n\t\tassert.strictEqual(first.label, 'Foo');\n\t\tassert.strictEqual(first.notebookType, '*');\n\n\t\tkernel.dispose();\n\t\tawait rpcProtocol.sync();\n\t\tassert.strictEqual(kernelData.size, 0);\n\t});\n\n\ttest('update kernel', async function () {\n\n\t\tconst kernel = disposables.add(extHostNotebookKernels.createNotebookController(nullExtensionDescription, 'foo', '*', 'Foo'));\n\n\t\tawait rpcProtocol.sync();\n\t\tassert.ok(kernel);\n\n\t\tlet [first] = kernelData.values();\n\t\tassert.strictEqual(first.id, 'nullExtensionDescription/foo');\n\t\tassert.strictEqual(first.label, 'Foo');\n\n\t\tkernel.label = 'Far';\n\t\tassert.strictEqual(kernel.label, 'Far');\n\n\t\tawait rpcProtocol.sync();\n\t\t[first] = kernelData.values();\n\t\tassert.strictEqual(first.id, 'nullExtensionDescription/foo');\n\t\tassert.strictEqual(first.label, 'Far');\n\t});\n\n\ttest('execute - simple createNotebookCellExecution', function () {\n\t\tconst kernel = disposables.add(extHostNotebookKernels.createNotebookController(nullExtensionDescription, 'foo', '*', 'Foo'));\n\n\t\textHostNotebookKernels.$acceptNotebookAssociation(0, notebook.uri, true);\n\n\t\tconst cell1 = notebook.apiNotebook.cellAt(0);\n\t\tconst task = kernel.createNotebookCellExecution(cell1);\n\t\ttask.start();\n\t\ttask.end(undefined);\n\t});\n\n\ttest('createNotebookCellExecution, must be selected/associated', function () {\n\t\tconst kernel = disposables.add(extHostNotebookKernels.createNotebookController(nullExtensionDescription, 'foo', '*', 'Foo'));\n\t\tassert.throws(() => {\n\t\t\tkernel.createNotebookCellExecution(notebook.apiNotebook.cellAt(0));\n\t\t});\n\n\t\textHostNotebookKernels.$acceptNotebookAssociation(0, notebook.uri, true);\n\t\tconst execution = kernel.createNotebookCellExecution(notebook.apiNotebook.cellAt(0));\n\t\texecution.end(true);\n\t});\n\n\ttest('createNotebookCellExecution, cell must be alive', function () {\n\t\tconst kernel = disposables.add(extHostNotebookKernels.createNotebookController(nullExtensionDescription, 'foo', '*', 'Foo'));\n\n\t\tconst cell1 = notebook.apiNotebook.cellAt(0);\n\n\t\textHostNotebookKernels.$acceptNotebookAssociation(0, notebook.uri, true);\n\t\textHostNotebookDocuments.$acceptModelChanged(notebook.uri, new SerializableObjectWithBuffers({\n\t\t\tversionId: 12,\n\t\t\trawEvents: [{\n\t\t\t\tkind: NotebookCellsChangeType.ModelChange,\n\t\t\t\tchanges: [[0, notebook.apiNotebook.cellCount, []]]\n\t\t\t}]\n\t\t}), true);\n\n\t\tassert.strictEqual(cell1.index, -1);\n\n\t\tassert.throws(() => {\n\t\t\tkernel.createNotebookCellExecution(cell1);\n\t\t});\n\t});\n\n\ttest('interrupt handler, cancellation', async function () {\n\n\t\tlet interruptCallCount = 0;\n\t\tlet tokenCancelCount = 0;\n\n\t\tconst kernel = disposables.add(extHostNotebookKernels.createNotebookController(nullExtensionDescription, 'foo', '*', 'Foo'));\n\t\tkernel.interruptHandler = () => { interruptCallCount += 1; };\n\t\textHostNotebookKernels.$acceptNotebookAssociation(0, notebook.uri, true);\n\n\t\tconst cell1 = notebook.apiNotebook.cellAt(0);\n\n\t\tconst task = kernel.createNotebookCellExecution(cell1);\n\t\tdisposables.add(task.token.onCancellationRequested(() => tokenCancelCount += 1));\n\n\t\tawait extHostNotebookKernels.$cancelCells(0, notebook.uri, [0]);\n\t\tassert.strictEqual(interruptCallCount, 1);\n\t\tassert.strictEqual(tokenCancelCount, 0);\n\n\t\tawait extHostNotebookKernels.$cancelCells(0, notebook.uri, [0]);\n\t\tassert.strictEqual(interruptCallCount, 2);\n\t\tassert.strictEqual(tokenCancelCount, 0);\n\n\t\t// should cancelling the cells end the execution task?\n\t\ttask.end(false);\n\t});\n\n\ttest('set outputs on cancel', async function () {\n\n\t\tconst kernel = disposables.add(extHostNotebookKernels.createNotebookController(nullExtensionDescription, 'foo', '*', 'Foo'));\n\t\textHostNotebookKernels.$acceptNotebookAssociation(0, notebook.uri, true);\n\n\t\tconst cell1 = notebook.apiNotebook.cellAt(0);\n\t\tconst task = kernel.createNotebookCellExecution(cell1);\n\t\ttask.start();\n\n\t\tconst b = new Barrier();\n\n\t\tdisposables.add(\n\t\t\ttask.token.onCancellationRequested(async () => {\n\t\t\t\tawait task.replaceOutput(new NotebookCellOutput([NotebookCellOutputItem.text('canceled')]));\n\t\t\t\ttask.end(true);\n\t\t\t\tb.open(); // use barrier to signal that cancellation has happened\n\t\t\t})\n\t\t);\n\n\t\tcellExecuteUpdates.length = 0;\n\t\tawait extHostNotebookKernels.$cancelCells(0, notebook.uri, [0]);\n\n\t\tawait b.wait();\n\n\t\tassert.strictEqual(cellExecuteUpdates.length > 0, true);\n\n\t\tlet found = false;\n\t\tfor (const edit of cellExecuteUpdates) {\n\t\t\tif (edit.editType === CellExecutionUpdateType.Output) {\n\t\t\t\tassert.strictEqual(edit.append, false);\n\t\t\t\tassert.strictEqual(edit.outputs.length, 1);\n\t\t\t\tassert.strictEqual(edit.outputs[0].items.length, 1);\n\t\t\t\tassert.deepStrictEqual(Array.from(edit.outputs[0].items[0].valueBytes.buffer), Array.from(new TextEncoder().encode('canceled')));\n\t\t\t\tfound = true;\n\t\t\t}\n\t\t}\n\t\tassert.ok(found);\n\t});\n\n\ttest('set outputs on interrupt', async function () {\n\n\t\tconst kernel = extHostNotebookKernels.createNotebookController(nullExtensionDescription, 'foo', '*', 'Foo');\n\t\textHostNotebookKernels.$acceptNotebookAssociation(0, notebook.uri, true);\n\n\n\t\tconst cell1 = notebook.apiNotebook.cellAt(0);\n\t\tconst task = kernel.createNotebookCellExecution(cell1);\n\t\ttask.start();\n\n\t\tkernel.interruptHandler = async _notebook => {\n\t\t\tassert.ok(notebook.apiNotebook === _notebook);\n\t\t\tawait task.replaceOutput(new NotebookCellOutput([NotebookCellOutputItem.text('interrupted')]));\n\t\t\ttask.end(true);\n\t\t};\n\n\t\tcellExecuteUpdates.length = 0;\n\t\tawait extHostNotebookKernels.$cancelCells(0, notebook.uri, [0]);\n\n\t\tassert.strictEqual(cellExecuteUpdates.length > 0, true);\n\n\t\tlet found = false;\n\t\tfor (const edit of cellExecuteUpdates) {\n\t\t\tif (edit.editType === CellExecutionUpdateType.Output) {\n\t\t\t\tassert.strictEqual(edit.append, false);\n\t\t\t\tassert.strictEqual(edit.outputs.length, 1);\n\t\t\t\tassert.strictEqual(edit.outputs[0].items.length, 1);\n\t\t\t\tassert.deepStrictEqual(Array.from(edit.outputs[0].items[0].valueBytes.buffer), Array.from(new TextEncoder().encode('interrupted')));\n\t\t\t\tfound = true;\n\t\t\t}\n\t\t}\n\t\tassert.ok(found);\n\t});\n});\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport assert from 'assert';\nimport { Barrier } from '../../../../base/common/async.js';\nimport { DisposableStore } from '../../../../base/common/lifecycle.js';\nimport { URI, UriComponents } from '../../../../base/common/uri.js';\nimport { ExtensionIdentifier } from '../../../../platform/extensions/common/extensions.js';\nimport { NullLogService } from '../../../../platform/log/common/log.js';\nimport { ICellExecuteUpdateDto, ICellExecutionCompleteDto, INotebookKernelDto2, MainContext, MainThreadCommandsShape, MainThreadNotebookDocumentsShape, MainThreadNotebookKernelsShape, MainThreadNotebookShape } from '../../common/extHost.protocol.js';\nimport { ExtHostCommands } from '../../common/extHostCommands.js';\nimport { ExtHostDocuments } from '../../common/extHostDocuments.js';\nimport { ExtHostDocumentsAndEditors } from '../../common/extHostDocumentsAndEditors.js';\nimport { IExtHostInitDataService } from '../../common/extHostInitDataService.js';\nimport { ExtHostNotebookController } from '../../common/extHostNotebook.js';\nimport { ExtHostNotebookDocument } from '../../common/extHostNotebookDocument.js';\nimport { ExtHostNotebookDocuments } from '../../common/extHostNotebookDocuments.js';\nimport { ExtHostNotebookKernels } from '../../common/extHostNotebookKernels.js';\nimport { NotebookCellOutput, NotebookCellOutputItem } from '../../common/extHostTypes.js';\nimport { CellKind, CellUri, NotebookCellsChangeType } from '../../../contrib/notebook/common/notebookCommon.js';\nimport { CellExecutionUpdateType } from '../../../contrib/notebook/common/notebookExecutionService.js';\nimport { nullExtensionDescription } from '../../../services/extensions/common/extensions.js';\nimport { SerializableObjectWithBuffers } from '../../../services/extensions/common/proxyIdentifier.js';\nimport { TestRPCProtocol } from '../common/testRPCProtocol.js';\nimport { mock } from '../../../test/common/workbenchTestServices.js';\nimport { IExtHostTelemetry } from '../../common/extHostTelemetry.js';\nimport { ExtHostConsumerFileSystem } from '../../common/extHostFileSystemConsumer.js';\nimport { ExtHostFileSystemInfo } from '../../common/extHostFileSystemInfo.js';\nimport { ensureNoDisposablesAreLeakedInTestSuite } from '../../../../base/test/common/utils.js';\nimport { ExtHostSearch } from '../../common/extHostSearch.js';\nimport { URITransformerService } from '../../common/extHostUriTransformerService.js';\n\nsuite('NotebookKernel', function () {\n\tlet rpcProtocol: TestRPCProtocol;\n\tlet extHostNotebookKernels: ExtHostNotebookKernels;\n\tlet notebook: ExtHostNotebookDocument;\n\tlet extHostDocumentsAndEditors: ExtHostDocumentsAndEditors;\n\tlet extHostDocuments: ExtHostDocuments;\n\tlet extHostNotebooks: ExtHostNotebookController;\n\tlet extHostNotebookDocuments: ExtHostNotebookDocuments;\n\tlet extHostCommands: ExtHostCommands;\n\tlet extHostConsumerFileSystem: ExtHostConsumerFileSystem;\n\tlet extHostSearch: ExtHostSearch;\n\n\tconst notebookUri = URI.parse('test:///notebook.file');\n\tconst kernelData = new Map<number, INotebookKernelDto2>();\n\tconst disposables = new DisposableStore();\n\n\tconst cellExecuteCreate: { notebook: UriComponents; cell: number }[] = [];\n\tconst cellExecuteUpdates: ICellExecuteUpdateDto[] = [];\n\tconst cellExecuteComplete: ICellExecutionCompleteDto[] = [];\n\n\tteardown(function () {\n\t\tdisposables.clear();\n\t});\n\n\tensureNoDisposablesAreLeakedInTestSuite();\n\n\tsetup(async function () {\n\t\tcellExecuteCreate.length = 0;\n\t\tcellExecuteUpdates.length = 0;\n\t\tcellExecuteComplete.length = 0;\n\t\tkernelData.clear();\n\n\t\trpcProtocol = new TestRPCProtocol();\n\t\trpcProtocol.set(MainContext.MainThreadCommands, new class extends mock<MainThreadCommandsShape>() {\n\t\t\toverride $registerCommand() { }\n\t\t});\n\t\trpcProtocol.set(MainContext.MainThreadNotebookKernels, new class extends mock<MainThreadNotebookKernelsShape>() {\n\t\t\toverride async $addKernel(handle: number, data: INotebookKernelDto2): Promise<void> {\n\t\t\t\tkernelData.set(handle, data);\n\t\t\t}\n\t\t\toverride $removeKernel(handle: number) {\n\t\t\t\tkernelData.delete(handle);\n\t\t\t}\n\t\t\toverride $updateKernel(handle: number, data: Partial<INotebookKernelDto2>) {\n\t\t\t\tassert.strictEqual(kernelData.has(handle), true);\n\t\t\t\tkernelData.set(handle, { ...kernelData.get(handle)!, ...data, });\n\t\t\t}\n\t\t\toverride $createExecution(handle: number, controllerId: string, uri: UriComponents, cellHandle: number): void {\n\t\t\t\tcellExecuteCreate.push({ notebook: uri, cell: cellHandle });\n\t\t\t}\n\t\t\toverride $updateExecution(handle: number, data: SerializableObjectWithBuffers<ICellExecuteUpdateDto[]>): void {\n\t\t\t\tcellExecuteUpdates.push(...data.value);\n\t\t\t}\n\t\t\toverride $completeExecution(handle: number, data: SerializableObjectWithBuffers<ICellExecutionCompleteDto>): void {\n\t\t\t\tcellExecuteComplete.push(data.value);\n\t\t\t}\n\t\t});\n\t\trpcProtocol.set(MainContext.MainThreadNotebookDocuments, new class extends mock<MainThreadNotebookDocumentsShape>() {\n\n\t\t});\n\t\trpcProtocol.set(MainContext.MainThreadNotebook, new class extends mock<MainThreadNotebookShape>() {\n\t\t\toverride async $registerNotebookSerializer() { }\n\t\t\toverride async $unregisterNotebookSerializer() { }\n\t\t});\n\t\textHostDocumentsAndEditors = new ExtHostDocumentsAndEditors(rpcProtocol, new NullLogService());\n\t\textHostDocuments = disposables.add(new ExtHostDocuments(rpcProtocol, extHostDocumentsAndEditors));\n\t\textHostCommands = new ExtHostCommands(rpcProtocol, new NullLogService(), new class extends mock<IExtHostTelemetry>() {\n\t\t\toverride onExtensionError(): boolean {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t});\n\t\textHostConsumerFileSystem = new ExtHostConsumerFileSystem(rpcProtocol, new ExtHostFileSystemInfo());\n\t\textHostSearch = new ExtHostSearch(rpcProtocol, new URITransformerService(null), new NullLogService());\n\t\textHostNotebooks = new ExtHostNotebookController(rpcProtocol, extHostCommands, extHostDocumentsAndEditors, extHostDocuments, extHostConsumerFileSystem, extHostSearch, new NullLogService());\n\n\t\textHostNotebookDocuments = new ExtHostNotebookDocuments(extHostNotebooks);\n\n\t\textHostNotebooks.$acceptDocumentAndEditorsDelta(new SerializableObjectWithBuffers({\n\t\t\taddedDocuments: [{\n\t\t\t\turi: notebookUri,\n\t\t\t\tviewType: 'test',\n\t\t\t\tversionId: 0,\n\t\t\t\tcells: [{\n\t\t\t\t\thandle: 0,\n\t\t\t\t\turi: CellUri.generate(notebookUri, 0),\n\t\t\t\t\tsource: ['### Heading'],\n\t\t\t\t\teol: '\\n',\n\t\t\t\t\tlanguage: 'markdown',\n\t\t\t\t\tcellKind: CellKind.Markup,\n\t\t\t\t\toutputs: [],\n\t\t\t\t}, {\n\t\t\t\t\thandle: 1,\n\t\t\t\t\turi: CellUri.generate(notebookUri, 1),\n\t\t\t\t\tsource: ['console.log(\"aaa\")', 'console.log(\"bbb\")'],\n\t\t\t\t\teol: '\\n',\n\t\t\t\t\tlanguage: 'javascript',\n\t\t\t\t\tcellKind: CellKind.Code,\n\t\t\t\t\toutputs: [],\n\t\t\t\t}],\n\t\t\t}],\n\t\t\taddedEditors: [{\n\t\t\t\tdocumentUri: notebookUri,\n\t\t\t\tid: '_notebook_editor_0',\n\t\t\t\tselections: [{ start: 0, end: 1 }],\n\t\t\t\tvisibleRanges: [],\n\t\t\t\tviewType: 'test',\n\t\t\t}]\n\t\t}));\n\t\textHostNotebooks.$acceptDocumentAndEditorsDelta(new SerializableObjectWithBuffers({ newActiveEditor: '_notebook_editor_0' }));\n\n\t\tnotebook = extHostNotebooks.notebookDocuments[0]!;\n\n\t\tdisposables.add(notebook);\n\t\tdisposables.add(extHostDocuments);\n\n\n\t\textHostNotebookKernels = new ExtHostNotebookKernels(\n\t\t\trpcProtocol,\n\t\t\tnew class extends mock<IExtHostInitDataService>() { },\n\t\t\textHostNotebooks,\n\t\t\textHostCommands,\n\t\t\tnew NullLogService()\n\t\t);\n\t});\n\n\ttest('create/dispose kernel', async function () {\n\n\t\tconst kernel = extHostNotebookKernels.createNotebookController(nullExtensionDescription, 'foo', '*', 'Foo');\n\n\t\t// eslint-disable-next-line local/code-no-any-casts\n\t\tassert.throws(() => (<any>kernel).id = 'dd');\n\t\t// eslint-disable-next-line local/code-no-any-casts\n\t\tassert.throws(() => (<any>kernel).notebookType = 'dd');\n\n\t\tassert.ok(kernel);\n\t\tassert.strictEqual(kernel.id, 'foo');\n\t\tassert.strictEqual(kernel.label, 'Foo');\n\t\tassert.strictEqual(kernel.notebookType, '*');\n\n\t\tawait rpcProtocol.sync();\n\t\tassert.strictEqual(kernelData.size, 1);\n\n\t\tconst [first] = kernelData.values();\n\t\tassert.strictEqual(first.id, 'nullExtensionDescription/foo');\n\t\tassert.strictEqual(ExtensionIdentifier.equals(first.extensionId, nullExtensionDescription.identifier), true);\n\t\tassert.strictEqual(first.label, 'Foo');\n\t\tassert.strictEqual(first.notebookType, '*');\n\n\t\tkernel.dispose();\n\t\tawait rpcProtocol.sync();\n\t\tassert.strictEqual(kernelData.size, 0);\n\t});\n\n\ttest('update kernel', async function () {\n\n\t\tconst kernel = disposables.add(extHostNotebookKernels.createNotebookController(nullExtensionDescription, 'foo', '*', 'Foo'));\n\n\t\tawait rpcProtocol.sync();\n\t\tassert.ok(kernel);\n\n\t\tlet [first] = kernelData.values();\n\t\tassert.strictEqual(first.id, 'nullExtensionDescription/foo');\n\t\tassert.strictEqual(first.label, 'Foo');\n\n\t\tkernel.label = 'Far';\n\t\tassert.strictEqual(kernel.label, 'Far');\n\n\t\tawait rpcProtocol.sync();\n\t\t[first] = kernelData.values();\n\t\tassert.strictEqual(first.id, 'nullExtensionDescription/foo');\n\t\tassert.strictEqual(first.label, 'Far');\n\t});\n\n\ttest('execute - simple createNotebookCellExecution', function () {\n\t\tconst kernel = disposables.add(extHostNotebookKernels.createNotebookController(nullExtensionDescription, 'foo', '*', 'Foo'));\n\n\t\textHostNotebookKernels.$acceptNotebookAssociation(0, notebook.uri, true);\n\n\t\tconst cell1 = notebook.apiNotebook.cellAt(0);\n\t\tconst task = kernel.createNotebookCellExecution(cell1);\n\t\ttask.start();\n\t\ttask.end(undefined);\n\t});\n\n\ttest('createNotebookCellExecution, must be selected/associated', function () {\n\t\tconst kernel = disposables.add(extHostNotebookKernels.createNotebookController(nullExtensionDescription, 'foo', '*', 'Foo'));\n\t\tassert.throws(() => {\n\t\t\tkernel.createNotebookCellExecution(notebook.apiNotebook.cellAt(0));\n\t\t});\n\n\t\textHostNotebookKernels.$acceptNotebookAssociation(0, notebook.uri, true);\n\t\tconst execution = kernel.createNotebookCellExecution(notebook.apiNotebook.cellAt(0));\n\t\texecution.end(true);\n\t});\n\n\ttest('createNotebookCellExecution, cell must be alive', function () {\n\t\tconst kernel = disposables.add(extHostNotebookKernels.createNotebookController(nullExtensionDescription, 'foo', '*', 'Foo'));\n\n\t\tconst cell1 = notebook.apiNotebook.cellAt(0);\n\n\t\textHostNotebookKernels.$acceptNotebookAssociation(0, notebook.uri, true);\n\t\textHostNotebookDocuments.$acceptModelChanged(notebook.uri, new SerializableObjectWithBuffers({\n\t\t\tversionId: 12,\n\t\t\trawEvents: [{\n\t\t\t\tkind: NotebookCellsChangeType.ModelChange,\n\t\t\t\tchanges: [[0, notebook.apiNotebook.cellCount, []]]\n\t\t\t}]\n\t\t}), true);\n\n\t\tassert.strictEqual(cell1.index, -1);\n\n\t\tassert.throws(() => {\n\t\t\tkernel.createNotebookCellExecution(cell1);\n\t\t});\n\t});\n\n\ttest('interrupt handler, cancellation', async function () {\n\n\t\tlet interruptCallCount = 0;\n\t\tlet tokenCancelCount = 0;\n\n\t\tconst kernel = disposables.add(extHostNotebookKernels.createNotebookController(nullExtensionDescription, 'foo', '*', 'Foo'));\n\t\tkernel.interruptHandler = () => { interruptCallCount += 1; };\n\t\textHostNotebookKernels.$acceptNotebookAssociation(0, notebook.uri, true);\n\n\t\tconst cell1 = notebook.apiNotebook.cellAt(0);\n\n\t\tconst task = kernel.createNotebookCellExecution(cell1);\n\t\tdisposables.add(task.token.onCancellationRequested(() => tokenCancelCount += 1));\n\n\t\tawait extHostNotebookKernels.$cancelCells(0, notebook.uri, [0]);\n\t\tassert.strictEqual(interruptCallCount, 1);\n\t\tassert.strictEqual(tokenCancelCount, 0);\n\n\t\tawait extHostNotebookKernels.$cancelCells(0, notebook.uri, [0]);\n\t\tassert.strictEqual(interruptCallCount, 2);\n\t\tassert.strictEqual(tokenCancelCount, 0);\n\n\t\t// should cancelling the cells end the execution task?\n\t\ttask.end(false);\n\t});\n\n\ttest('set outputs on cancel', async function () {\n\n\t\tconst kernel = disposables.add(extHostNotebookKernels.createNotebookController(nullExtensionDescription, 'foo', '*', 'Foo'));\n\t\textHostNotebookKernels.$acceptNotebookAssociation(0, notebook.uri, true);\n\n\t\tconst cell1 = notebook.apiNotebook.cellAt(0);\n\t\tconst task = kernel.createNotebookCellExecution(cell1);\n\t\ttask.start();\n\n\t\tconst b = new Barrier();\n\n\t\tdisposables.add(\n\t\t\ttask.token.onCancellationRequested(async () => {\n\t\t\t\tawait task.replaceOutput(new NotebookCellOutput([NotebookCellOutputItem.text('canceled')]));\n\t\t\t\ttask.end(true);\n\t\t\t\tb.open(); // use barrier to signal that cancellation has happened\n\t\t\t})\n\t\t);\n\n\t\tcellExecuteUpdates.length = 0;\n\t\tawait extHostNotebookKernels.$cancelCells(0, notebook.uri, [0]);\n\n\t\tawait b.wait();\n\n\t\tassert.strictEqual(cellExecuteUpdates.length > 0, true);\n\n\t\tlet found = false;\n\t\tfor (const edit of cellExecuteUpdates) {\n\t\t\tif (edit.editType === CellExecutionUpdateType.Output) {\n\t\t\t\tassert.strictEqual(edit.append, false);\n\t\t\t\tassert.strictEqual(edit.outputs.length, 1);\n\t\t\t\tassert.strictEqual(edit.outputs[0].items.length, 1);\n\t\t\t\tassert.deepStrictEqual(Array.from(edit.outputs[0].items[0].valueBytes.buffer), Array.from(new TextEncoder().encode('canceled')));\n\t\t\t\tfound = true;\n\t\t\t}\n\t\t}\n\t\tassert.ok(found);\n\t});\n\n\ttest('set outputs on interrupt', async function () {\n\n\t\tconst kernel = extHostNotebookKernels.createNotebookController(nullExtensionDescription, 'foo', '*', 'Foo');\n\t\textHostNotebookKernels.$acceptNotebookAssociation(0, notebook.uri, true);\n\n\n\t\tconst cell1 = notebook.apiNotebook.cellAt(0);\n\t\tconst task = kernel.createNotebookCellExecution(cell1);\n\t\ttask.start();\n\n\t\tkernel.interruptHandler = async _notebook => {\n\t\t\tassert.ok(notebook.apiNotebook === _notebook);\n\t\t\tawait task.replaceOutput(new NotebookCellOutput([NotebookCellOutputItem.text('interrupted')]));\n\t\t\ttask.end(true);\n\t\t};\n\n\t\tcellExecuteUpdates.length = 0;\n\t\tawait extHostNotebookKernels.$cancelCells(0, notebook.uri, [0]);\n\n\t\tassert.strictEqual(cellExecuteUpdates.length > 0, true);\n\n\t\tlet found = false;\n\t\tfor (const edit of cellExecuteUpdates) {\n\t\t\tif (edit.editType === CellExecutionUpdateType.Output) {\n\t\t\t\tassert.strictEqual(edit.append, false);\n\t\t\t\tassert.strictEqual(edit.outputs.length, 1);\n\t\t\t\tassert.strictEqual(edit.outputs[0].items.length, 1);\n\t\t\t\tassert.deepStrictEqual(Array.from(edit.outputs[0].items[0].valueBytes.buffer), Array.from(new TextEncoder().encode('interrupted')));\n\t\t\t\tfound = true;\n\t\t\t}\n\t\t}\n\t\tassert.ok(found);\n\t});\n});\n"]}