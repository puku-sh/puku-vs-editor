{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/api/test/browser/extHostDocumentContentProvider.test.ts","vs/workbench/api/test/browser/extHostDocumentContentProvider.test.ts"],"names":[],"mappings":"AAAA;;;gGAGgG;AAEhG,OAAO,MAAM,MAAM,QAAQ,CAAC;AAC5B,OAAO,EAAE,GAAG,EAAiB,MAAM,gCAAgC,CAAC;AACpE,OAAO,EAAE,0BAA0B,EAAE,MAAM,4CAA4C,CAAC;AACxF,OAAO,EAAE,sBAAsB,EAAE,MAAM,8BAA8B,CAAC;AACtE,OAAO,EAAE,cAAc,EAAE,MAAM,wCAAwC,CAAC;AACxE,OAAO,EAAE,uCAAuC,EAAE,MAAM,uCAAuC,CAAC;AAChG,OAAO,EAAE,8BAA8B,EAAE,MAAM,iDAAiD,CAAC;AACjG,OAAO,EAAE,OAAO,EAAE,MAAM,kCAAkC,CAAC;AAE3D,OAAO,EAAE,OAAO,EAAE,MAAM,kCAAkC,CAAC;AAC3D,OAAO,EAAE,kBAAkB,EAAE,MAAM,qDAAqD,CAAC;AAEzF,KAAK,CAAC,gCAAgC,EAAE,GAAG,EAAE;IAE5C,uCAAuC,EAAE,CAAC;IAE1C,MAAM,QAAQ,GAAG,GAAG,CAAC,KAAK,CAAC,SAAS,CAAC,CAAC;IACtC,IAAI,uBAAuD,CAAC;IAC5D,IAAI,yBAAkE,CAAC;IACvE,MAAM,OAAO,GAA0C,EAAE,CAAC;IAE1D,KAAK,CAAC,GAAG,EAAE;QAEV,OAAO,CAAC,MAAM,GAAG,CAAC,CAAC;QAEnB,yBAAyB,GAAG,IAAI;YAC/B,4BAA4B,CAAC,MAAc,EAAE,MAAc;YAE3D,CAAC;YACD,8BAA8B,CAAC,MAAc;YAE7C,CAAC;YACD,KAAK,CAAC,wBAAwB,CAAC,GAAkB,EAAE,KAAa;gBAC/D,MAAM,OAAO,CAAC,EAAE,CAAC,CAAC;gBAClB,OAAO,CAAC,IAAI,CAAC,CAAC,GAAG,EAAE,KAAK,CAAC,CAAC,CAAC;YAC5B,CAAC;YACD,OAAO;gBACN,MAAM,IAAI,KAAK,CAAC,yBAAyB,CAAC,CAAC;YAC5C,CAAC;SACD,CAAC;QAEF,MAAM,SAAS,GAAG,sBAAsB,CAAC,yBAAyB,CAAC,CAAC;QACpE,MAAM,mBAAmB,GAAG,IAAI,0BAA0B,CAAC,SAAS,EAAE,IAAI,cAAc,EAAE,CAAC,CAAC;QAC5F,mBAAmB,CAAC,+BAA+B,CAAC;YACnD,cAAc,EAAE,CAAC;oBAChB,OAAO,EAAE,KAAK;oBACd,UAAU,EAAE,KAAK;oBACjB,GAAG,EAAE,QAAQ;oBACb,SAAS,EAAE,CAAC;oBACZ,KAAK,EAAE,CAAC,KAAK,CAAC;oBACd,GAAG,EAAE,IAAI;oBACT,QAAQ,EAAE,MAAM;iBAChB,CAAC;SACF,CAAC,CAAC;QACH,uBAAuB,GAAG,IAAI,8BAA8B,CAAC,SAAS,EAAE,mBAAmB,EAAE,IAAI,cAAc,EAAE,CAAC,CAAC;IACpH,CAAC,CAAC,CAAC;IAEH,IAAI,CAAC,uFAAuF,EAAE,KAAK,IAAI,EAAE;QACxG,MAAM,kBAAkB,CAAC,EAAE,EAAE,KAAK;YAEjC,MAAM,OAAO,GAAG,IAAI,OAAO,EAAO,CAAC;YACnC,MAAM,QAAQ,GAAG,CAAC,GAAG,EAAE,GAAG,CAAC,CAAC;YAC5B,IAAI,OAAO,GAAG,CAAC,CAAC;YAEhB,IAAI,KAAK,GAAG,CAAC,CAAC;YAEd,MAAM,CAAC,GAAG,uBAAuB,CAAC,mCAAmC,CAAC,QAAQ,CAAC,MAAM,EAAE;gBACtF,WAAW,EAAE,OAAO,CAAC,KAAK;gBAC1B,KAAK,CAAC,0BAA0B,CAAC,IAAI;oBACpC,MAAM,CAAC,WAAW,CAAC,KAAK,EAAE,CAAC,CAAC,CAAC;oBAC7B,KAAK,EAAE,CAAC;oBACR,IAAI,CAAC;wBACJ,MAAM,OAAO,CAAC,CAAC,CAAC,CAAC;wBACjB,OAAO,QAAQ,CAAC,OAAO,EAAE,GAAG,QAAQ,CAAC,MAAM,CAAC,CAAC;oBAC9C,CAAC;4BAAS,CAAC;wBACV,KAAK,EAAE,CAAC;oBACT,CAAC;gBACF,CAAC;aACD,CAAC,CAAC;YAEH,OAAO,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;YACvB,OAAO,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;YAEvB,MAAM,OAAO,CAAC,GAAG,CAAC,CAAC;YAEnB,MAAM,CAAC,WAAW,CAAC,OAAO,CAAC,MAAM,EAAE,CAAC,CAAC,CAAC;YACtC,MAAM,CAAC,WAAW,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,GAAG,CAAC,CAAC;YACvC,MAAM,CAAC,WAAW,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,GAAG,CAAC,CAAC;YAEvC,CAAC,CAAC,OAAO,EAAE,CAAC;QACb,CAAC,CAAC,CAAC;IACJ,CAAC,CAAC,CAAC;AAGJ,CAAC,CAAC,CAAC","file":"extHostDocumentContentProvider.test.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport assert from 'assert';\nimport { URI, UriComponents } from '../../../../base/common/uri.js';\nimport { ExtHostDocumentsAndEditors } from '../../common/extHostDocumentsAndEditors.js';\nimport { SingleProxyRPCProtocol } from '../common/testRPCProtocol.js';\nimport { NullLogService } from '../../../../platform/log/common/log.js';\nimport { ensureNoDisposablesAreLeakedInTestSuite } from '../../../../base/test/common/utils.js';\nimport { ExtHostDocumentContentProvider } from '../../common/extHostDocumentContentProviders.js';\nimport { Emitter } from '../../../../base/common/event.js';\nimport { MainThreadDocumentContentProvidersShape } from '../../common/extHost.protocol.js';\nimport { timeout } from '../../../../base/common/async.js';\nimport { runWithFakedTimers } from '../../../../base/test/common/timeTravelScheduler.js';\n\nsuite('ExtHostDocumentContentProvider', () => {\n\n\tensureNoDisposablesAreLeakedInTestSuite();\n\n\tconst resource = URI.parse('foo:bar');\n\tlet documentContentProvider: ExtHostDocumentContentProvider;\n\tlet mainThreadContentProvider: MainThreadDocumentContentProvidersShape;\n\tconst changes: [uri: UriComponents, value: string][] = [];\n\n\tsetup(() => {\n\n\t\tchanges.length = 0;\n\n\t\tmainThreadContentProvider = new class implements MainThreadDocumentContentProvidersShape {\n\t\t\t$registerTextContentProvider(handle: number, scheme: string): void {\n\n\t\t\t}\n\t\t\t$unregisterTextContentProvider(handle: number): void {\n\n\t\t\t}\n\t\t\tasync $onVirtualDocumentChange(uri: UriComponents, value: string): Promise<void> {\n\t\t\t\tawait timeout(10);\n\t\t\t\tchanges.push([uri, value]);\n\t\t\t}\n\t\t\tdispose(): void {\n\t\t\t\tthrow new Error('Method not implemented.');\n\t\t\t}\n\t\t};\n\n\t\tconst ehContext = SingleProxyRPCProtocol(mainThreadContentProvider);\n\t\tconst documentsAndEditors = new ExtHostDocumentsAndEditors(ehContext, new NullLogService());\n\t\tdocumentsAndEditors.$acceptDocumentsAndEditorsDelta({\n\t\t\taddedDocuments: [{\n\t\t\t\tisDirty: false,\n\t\t\t\tlanguageId: 'foo',\n\t\t\t\turi: resource,\n\t\t\t\tversionId: 1,\n\t\t\t\tlines: ['foo'],\n\t\t\t\tEOL: '\\n',\n\t\t\t\tencoding: 'utf8'\n\t\t\t}]\n\t\t});\n\t\tdocumentContentProvider = new ExtHostDocumentContentProvider(ehContext, documentsAndEditors, new NullLogService());\n\t});\n\n\ttest('TextDocumentContentProvider drops onDidChange events when they happen quickly #179711', async () => {\n\t\tawait runWithFakedTimers({}, async function () {\n\n\t\t\tconst emitter = new Emitter<URI>();\n\t\t\tconst contents = ['X', 'Y'];\n\t\t\tlet counter = 0;\n\n\t\t\tlet stack = 0;\n\n\t\t\tconst d = documentContentProvider.registerTextDocumentContentProvider(resource.scheme, {\n\t\t\t\tonDidChange: emitter.event,\n\t\t\t\tasync provideTextDocumentContent(_uri) {\n\t\t\t\t\tassert.strictEqual(stack, 0);\n\t\t\t\t\tstack++;\n\t\t\t\t\ttry {\n\t\t\t\t\t\tawait timeout(0);\n\t\t\t\t\t\treturn contents[counter++ % contents.length];\n\t\t\t\t\t} finally {\n\t\t\t\t\t\tstack--;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\temitter.fire(resource);\n\t\t\temitter.fire(resource);\n\n\t\t\tawait timeout(100);\n\n\t\t\tassert.strictEqual(changes.length, 2);\n\t\t\tassert.strictEqual(changes[0][1], 'X');\n\t\t\tassert.strictEqual(changes[1][1], 'Y');\n\n\t\t\td.dispose();\n\t\t});\n\t});\n\n\n});\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport assert from 'assert';\nimport { URI, UriComponents } from '../../../../base/common/uri.js';\nimport { ExtHostDocumentsAndEditors } from '../../common/extHostDocumentsAndEditors.js';\nimport { SingleProxyRPCProtocol } from '../common/testRPCProtocol.js';\nimport { NullLogService } from '../../../../platform/log/common/log.js';\nimport { ensureNoDisposablesAreLeakedInTestSuite } from '../../../../base/test/common/utils.js';\nimport { ExtHostDocumentContentProvider } from '../../common/extHostDocumentContentProviders.js';\nimport { Emitter } from '../../../../base/common/event.js';\nimport { MainThreadDocumentContentProvidersShape } from '../../common/extHost.protocol.js';\nimport { timeout } from '../../../../base/common/async.js';\nimport { runWithFakedTimers } from '../../../../base/test/common/timeTravelScheduler.js';\n\nsuite('ExtHostDocumentContentProvider', () => {\n\n\tensureNoDisposablesAreLeakedInTestSuite();\n\n\tconst resource = URI.parse('foo:bar');\n\tlet documentContentProvider: ExtHostDocumentContentProvider;\n\tlet mainThreadContentProvider: MainThreadDocumentContentProvidersShape;\n\tconst changes: [uri: UriComponents, value: string][] = [];\n\n\tsetup(() => {\n\n\t\tchanges.length = 0;\n\n\t\tmainThreadContentProvider = new class implements MainThreadDocumentContentProvidersShape {\n\t\t\t$registerTextContentProvider(handle: number, scheme: string): void {\n\n\t\t\t}\n\t\t\t$unregisterTextContentProvider(handle: number): void {\n\n\t\t\t}\n\t\t\tasync $onVirtualDocumentChange(uri: UriComponents, value: string): Promise<void> {\n\t\t\t\tawait timeout(10);\n\t\t\t\tchanges.push([uri, value]);\n\t\t\t}\n\t\t\tdispose(): void {\n\t\t\t\tthrow new Error('Method not implemented.');\n\t\t\t}\n\t\t};\n\n\t\tconst ehContext = SingleProxyRPCProtocol(mainThreadContentProvider);\n\t\tconst documentsAndEditors = new ExtHostDocumentsAndEditors(ehContext, new NullLogService());\n\t\tdocumentsAndEditors.$acceptDocumentsAndEditorsDelta({\n\t\t\taddedDocuments: [{\n\t\t\t\tisDirty: false,\n\t\t\t\tlanguageId: 'foo',\n\t\t\t\turi: resource,\n\t\t\t\tversionId: 1,\n\t\t\t\tlines: ['foo'],\n\t\t\t\tEOL: '\\n',\n\t\t\t\tencoding: 'utf8'\n\t\t\t}]\n\t\t});\n\t\tdocumentContentProvider = new ExtHostDocumentContentProvider(ehContext, documentsAndEditors, new NullLogService());\n\t});\n\n\ttest('TextDocumentContentProvider drops onDidChange events when they happen quickly #179711', async () => {\n\t\tawait runWithFakedTimers({}, async function () {\n\n\t\t\tconst emitter = new Emitter<URI>();\n\t\t\tconst contents = ['X', 'Y'];\n\t\t\tlet counter = 0;\n\n\t\t\tlet stack = 0;\n\n\t\t\tconst d = documentContentProvider.registerTextDocumentContentProvider(resource.scheme, {\n\t\t\t\tonDidChange: emitter.event,\n\t\t\t\tasync provideTextDocumentContent(_uri) {\n\t\t\t\t\tassert.strictEqual(stack, 0);\n\t\t\t\t\tstack++;\n\t\t\t\t\ttry {\n\t\t\t\t\t\tawait timeout(0);\n\t\t\t\t\t\treturn contents[counter++ % contents.length];\n\t\t\t\t\t} finally {\n\t\t\t\t\t\tstack--;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\temitter.fire(resource);\n\t\t\temitter.fire(resource);\n\n\t\t\tawait timeout(100);\n\n\t\t\tassert.strictEqual(changes.length, 2);\n\t\t\tassert.strictEqual(changes[0][1], 'X');\n\t\t\tassert.strictEqual(changes[1][1], 'Y');\n\n\t\t\td.dispose();\n\t\t});\n\t});\n\n\n});\n"]}