{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/api/test/browser/mainThreadAuthentication.integrationTest.ts","vs/workbench/api/test/browser/mainThreadAuthentication.integrationTest.ts"],"names":[],"mappings":"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","file":"mainThreadAuthentication.integrationTest.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport assert from 'assert';\nimport { IDialogService } from '../../../../platform/dialogs/common/dialogs.js';\nimport { TestDialogService } from '../../../../platform/dialogs/test/common/testDialogService.js';\nimport { TestInstantiationService } from '../../../../platform/instantiation/test/common/instantiationServiceMock.js';\nimport { INotificationService } from '../../../../platform/notification/common/notification.js';\nimport { TestNotificationService } from '../../../../platform/notification/test/common/testNotificationService.js';\nimport { IQuickInputService } from '../../../../platform/quickinput/common/quickInput.js';\nimport { IStorageService } from '../../../../platform/storage/common/storage.js';\nimport { ITelemetryService } from '../../../../platform/telemetry/common/telemetry.js';\nimport { NullTelemetryService } from '../../../../platform/telemetry/common/telemetryUtils.js';\nimport { MainThreadAuthentication } from '../../browser/mainThreadAuthentication.js';\nimport { ExtHostContext, MainContext } from '../../common/extHost.protocol.js';\nimport { IActivityService } from '../../../services/activity/common/activity.js';\nimport { AuthenticationService } from '../../../services/authentication/browser/authenticationService.js';\nimport { IAuthenticationExtensionsService, IAuthenticationService } from '../../../services/authentication/common/authentication.js';\nimport { IExtensionService } from '../../../services/extensions/common/extensions.js';\nimport { IRemoteAgentService } from '../../../services/remote/common/remoteAgentService.js';\nimport { TestRPCProtocol } from '../common/testRPCProtocol.js';\nimport { TestEnvironmentService, TestHostService, TestQuickInputService, TestRemoteAgentService } from '../../../test/browser/workbenchTestServices.js';\nimport { TestActivityService, TestExtensionService, TestProductService, TestStorageService } from '../../../test/common/workbenchTestServices.js';\nimport { IBrowserWorkbenchEnvironmentService } from '../../../services/environment/browser/environmentService.js';\nimport { IProductService } from '../../../../platform/product/common/productService.js';\nimport { AuthenticationAccessService, IAuthenticationAccessService } from '../../../services/authentication/browser/authenticationAccessService.js';\nimport { IAccountUsage, IAuthenticationUsageService } from '../../../services/authentication/browser/authenticationUsageService.js';\nimport { AuthenticationExtensionsService } from '../../../services/authentication/browser/authenticationExtensionsService.js';\nimport { ILogService, NullLogService } from '../../../../platform/log/common/log.js';\nimport { IHostService } from '../../../services/host/browser/host.js';\nimport { IOpenerService } from '../../../../platform/opener/common/opener.js';\nimport { IUserActivityService, UserActivityService } from '../../../services/userActivity/common/userActivityService.js';\nimport { ISecretStorageService } from '../../../../platform/secrets/common/secrets.js';\nimport { TestSecretStorageService } from '../../../../platform/secrets/test/common/testSecretStorageService.js';\nimport { IDynamicAuthenticationProviderStorageService } from '../../../services/authentication/common/dynamicAuthenticationProviderStorage.js';\nimport { DynamicAuthenticationProviderStorageService } from '../../../services/authentication/browser/dynamicAuthenticationProviderStorageService.js';\nimport { ensureNoDisposablesAreLeakedInTestSuite } from '../../../../base/test/common/utils.js';\nimport { ServiceCollection } from '../../../../platform/instantiation/common/serviceCollection.js';\nimport { SyncDescriptor } from '../../../../platform/instantiation/common/descriptors.js';\n\nclass TestAuthUsageService implements IAuthenticationUsageService {\n\t_serviceBrand: undefined;\n\tinitializeExtensionUsageCache(): Promise<void> { return Promise.resolve(); }\n\textensionUsesAuth(extensionId: string): Promise<boolean> { return Promise.resolve(false); }\n\treadAccountUsages(providerId: string, accountName: string): IAccountUsage[] { return []; }\n\tremoveAccountUsage(providerId: string, accountName: string): void { }\n\taddAccountUsage(providerId: string, accountName: string, scopes: ReadonlyArray<string>, extensionId: string, extensionName: string): void { }\n}\n\nsuite('MainThreadAuthentication', () => {\n\tconst disposables = ensureNoDisposablesAreLeakedInTestSuite();\n\n\tlet mainThreadAuthentication: MainThreadAuthentication;\n\tlet instantiationService: TestInstantiationService;\n\tlet rpcProtocol: TestRPCProtocol;\n\n\tsetup(async () => {\n\t\t// services\n\t\tconst services = new ServiceCollection();\n\t\tservices.set(ILogService, new SyncDescriptor(NullLogService));\n\t\tservices.set(IDialogService, new SyncDescriptor(TestDialogService, [{ confirmed: true }]));\n\t\tservices.set(IStorageService, new SyncDescriptor(TestStorageService));\n\t\tservices.set(ISecretStorageService, new SyncDescriptor(TestSecretStorageService));\n\t\tservices.set(IDynamicAuthenticationProviderStorageService, new SyncDescriptor(DynamicAuthenticationProviderStorageService));\n\t\tservices.set(IQuickInputService, new SyncDescriptor(TestQuickInputService));\n\t\tservices.set(IExtensionService, new SyncDescriptor(TestExtensionService));\n\t\tservices.set(IActivityService, new SyncDescriptor(TestActivityService));\n\t\tservices.set(IRemoteAgentService, new SyncDescriptor(TestRemoteAgentService));\n\t\tservices.set(INotificationService, new SyncDescriptor(TestNotificationService));\n\t\tservices.set(IHostService, new SyncDescriptor(TestHostService));\n\t\tservices.set(IUserActivityService, new SyncDescriptor(UserActivityService));\n\t\tservices.set(IAuthenticationAccessService, new SyncDescriptor(AuthenticationAccessService));\n\t\tservices.set(IAuthenticationService, new SyncDescriptor(AuthenticationService));\n\t\tservices.set(IAuthenticationUsageService, new SyncDescriptor(TestAuthUsageService));\n\t\tservices.set(IAuthenticationExtensionsService, new SyncDescriptor(AuthenticationExtensionsService));\n\t\tinstantiationService = disposables.add(new TestInstantiationService(services, undefined, undefined, true));\n\n\t\t// stubs\n\t\t// eslint-disable-next-line local/code-no-dangerous-type-assertions\n\t\tinstantiationService.stub(IOpenerService, {} as Partial<IOpenerService>);\n\t\tinstantiationService.stub(ITelemetryService, NullTelemetryService);\n\t\tinstantiationService.stub(IBrowserWorkbenchEnvironmentService, TestEnvironmentService);\n\t\tinstantiationService.stub(IProductService, TestProductService);\n\n\t\trpcProtocol = disposables.add(new TestRPCProtocol());\n\t\tmainThreadAuthentication = disposables.add(instantiationService.createInstance(MainThreadAuthentication, rpcProtocol));\n\t\trpcProtocol.set(MainContext.MainThreadAuthentication, mainThreadAuthentication);\n\t});\n\n\ttest('provider registration completes without errors', async () => {\n\t\t// Test basic registration - this should complete without throwing\n\t\tawait mainThreadAuthentication.$registerAuthenticationProvider({\n\t\t\tid: 'test-provider',\n\t\t\tlabel: 'Test Provider',\n\t\t\tsupportsMultipleAccounts: false\n\t\t});\n\n\t\t// Test unregistration - this should also complete without throwing\n\t\tawait mainThreadAuthentication.$unregisterAuthenticationProvider('test-provider');\n\n\t\t// Success if we reach here without timeout\n\t\tassert.ok(true, 'Registration and unregistration completed successfully');\n\t});\n\n\ttest('event suppression during explicit unregistration', async () => {\n\t\tlet unregisterEventFired = false;\n\t\tlet eventProviderId: string | undefined;\n\n\t\t// Mock the ext host to capture unregister events\n\t\tconst mockExtHost = {\n\t\t\t$onDidUnregisterAuthenticationProvider: (id: string) => {\n\t\t\t\tunregisterEventFired = true;\n\t\t\t\teventProviderId = id;\n\t\t\t\treturn Promise.resolve();\n\t\t\t},\n\t\t\t$getSessions: () => Promise.resolve([]),\n\t\t\t// eslint-disable-next-line local/code-no-any-casts\n\t\t\t$createSession: () => Promise.resolve({} as any),\n\t\t\t$removeSession: () => Promise.resolve(),\n\t\t\t$onDidChangeAuthenticationSessions: () => Promise.resolve(),\n\t\t\t$registerDynamicAuthProvider: () => Promise.resolve('test'),\n\t\t\t$onDidChangeDynamicAuthProviderTokens: () => Promise.resolve(),\n\t\t\t$getSessionsFromChallenges: () => Promise.resolve([]),\n\t\t\t// eslint-disable-next-line local/code-no-any-casts\n\t\t\t$createSessionFromChallenges: () => Promise.resolve({} as any),\n\t\t};\n\t\trpcProtocol.set(ExtHostContext.ExtHostAuthentication, mockExtHost);\n\n\t\t// Register a provider\n\t\tawait mainThreadAuthentication.$registerAuthenticationProvider({\n\t\t\tid: 'test-suppress',\n\t\t\tlabel: 'Test Suppress',\n\t\t\tsupportsMultipleAccounts: false\n\t\t});\n\n\t\t// Reset the flag\n\t\tunregisterEventFired = false;\n\t\teventProviderId = undefined;\n\n\t\t// Unregister the provider - this should NOT fire the event due to suppression\n\t\tawait mainThreadAuthentication.$unregisterAuthenticationProvider('test-suppress');\n\n\t\t// Verify the event was suppressed\n\t\tassert.strictEqual(unregisterEventFired, false, 'Unregister event should be suppressed during explicit unregistration');\n\t\tassert.strictEqual(eventProviderId, undefined, 'No provider ID should be captured from suppressed event');\n\t});\n\n\ttest('concurrent provider registrations complete without errors', async () => {\n\t\t// Register multiple providers simultaneously\n\t\tconst registrationPromises = [\n\t\t\tmainThreadAuthentication.$registerAuthenticationProvider({\n\t\t\t\tid: 'concurrent-1',\n\t\t\t\tlabel: 'Concurrent 1',\n\t\t\t\tsupportsMultipleAccounts: false\n\t\t\t}),\n\t\t\tmainThreadAuthentication.$registerAuthenticationProvider({\n\t\t\t\tid: 'concurrent-2',\n\t\t\t\tlabel: 'Concurrent 2',\n\t\t\t\tsupportsMultipleAccounts: false\n\t\t\t}),\n\t\t\tmainThreadAuthentication.$registerAuthenticationProvider({\n\t\t\t\tid: 'concurrent-3',\n\t\t\t\tlabel: 'Concurrent 3',\n\t\t\t\tsupportsMultipleAccounts: false\n\t\t\t})\n\t\t];\n\n\t\tawait Promise.all(registrationPromises);\n\n\t\t// Unregister all providers\n\t\tconst unregistrationPromises = [\n\t\t\tmainThreadAuthentication.$unregisterAuthenticationProvider('concurrent-1'),\n\t\t\tmainThreadAuthentication.$unregisterAuthenticationProvider('concurrent-2'),\n\t\t\tmainThreadAuthentication.$unregisterAuthenticationProvider('concurrent-3')\n\t\t];\n\n\t\tawait Promise.all(unregistrationPromises);\n\n\t\t// Success if we reach here without timeout\n\t\tassert.ok(true, 'Concurrent registrations and unregistrations completed successfully');\n\t});\n});\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport assert from 'assert';\nimport { IDialogService } from '../../../../platform/dialogs/common/dialogs.js';\nimport { TestDialogService } from '../../../../platform/dialogs/test/common/testDialogService.js';\nimport { TestInstantiationService } from '../../../../platform/instantiation/test/common/instantiationServiceMock.js';\nimport { INotificationService } from '../../../../platform/notification/common/notification.js';\nimport { TestNotificationService } from '../../../../platform/notification/test/common/testNotificationService.js';\nimport { IQuickInputService } from '../../../../platform/quickinput/common/quickInput.js';\nimport { IStorageService } from '../../../../platform/storage/common/storage.js';\nimport { ITelemetryService } from '../../../../platform/telemetry/common/telemetry.js';\nimport { NullTelemetryService } from '../../../../platform/telemetry/common/telemetryUtils.js';\nimport { MainThreadAuthentication } from '../../browser/mainThreadAuthentication.js';\nimport { ExtHostContext, MainContext } from '../../common/extHost.protocol.js';\nimport { IActivityService } from '../../../services/activity/common/activity.js';\nimport { AuthenticationService } from '../../../services/authentication/browser/authenticationService.js';\nimport { IAuthenticationExtensionsService, IAuthenticationService } from '../../../services/authentication/common/authentication.js';\nimport { IExtensionService } from '../../../services/extensions/common/extensions.js';\nimport { IRemoteAgentService } from '../../../services/remote/common/remoteAgentService.js';\nimport { TestRPCProtocol } from '../common/testRPCProtocol.js';\nimport { TestEnvironmentService, TestHostService, TestQuickInputService, TestRemoteAgentService } from '../../../test/browser/workbenchTestServices.js';\nimport { TestActivityService, TestExtensionService, TestProductService, TestStorageService } from '../../../test/common/workbenchTestServices.js';\nimport { IBrowserWorkbenchEnvironmentService } from '../../../services/environment/browser/environmentService.js';\nimport { IProductService } from '../../../../platform/product/common/productService.js';\nimport { AuthenticationAccessService, IAuthenticationAccessService } from '../../../services/authentication/browser/authenticationAccessService.js';\nimport { IAccountUsage, IAuthenticationUsageService } from '../../../services/authentication/browser/authenticationUsageService.js';\nimport { AuthenticationExtensionsService } from '../../../services/authentication/browser/authenticationExtensionsService.js';\nimport { ILogService, NullLogService } from '../../../../platform/log/common/log.js';\nimport { IHostService } from '../../../services/host/browser/host.js';\nimport { IOpenerService } from '../../../../platform/opener/common/opener.js';\nimport { IUserActivityService, UserActivityService } from '../../../services/userActivity/common/userActivityService.js';\nimport { ISecretStorageService } from '../../../../platform/secrets/common/secrets.js';\nimport { TestSecretStorageService } from '../../../../platform/secrets/test/common/testSecretStorageService.js';\nimport { IDynamicAuthenticationProviderStorageService } from '../../../services/authentication/common/dynamicAuthenticationProviderStorage.js';\nimport { DynamicAuthenticationProviderStorageService } from '../../../services/authentication/browser/dynamicAuthenticationProviderStorageService.js';\nimport { ensureNoDisposablesAreLeakedInTestSuite } from '../../../../base/test/common/utils.js';\nimport { ServiceCollection } from '../../../../platform/instantiation/common/serviceCollection.js';\nimport { SyncDescriptor } from '../../../../platform/instantiation/common/descriptors.js';\n\nclass TestAuthUsageService implements IAuthenticationUsageService {\n\t_serviceBrand: undefined;\n\tinitializeExtensionUsageCache(): Promise<void> { return Promise.resolve(); }\n\textensionUsesAuth(extensionId: string): Promise<boolean> { return Promise.resolve(false); }\n\treadAccountUsages(providerId: string, accountName: string): IAccountUsage[] { return []; }\n\tremoveAccountUsage(providerId: string, accountName: string): void { }\n\taddAccountUsage(providerId: string, accountName: string, scopes: ReadonlyArray<string>, extensionId: string, extensionName: string): void { }\n}\n\nsuite('MainThreadAuthentication', () => {\n\tconst disposables = ensureNoDisposablesAreLeakedInTestSuite();\n\n\tlet mainThreadAuthentication: MainThreadAuthentication;\n\tlet instantiationService: TestInstantiationService;\n\tlet rpcProtocol: TestRPCProtocol;\n\n\tsetup(async () => {\n\t\t// services\n\t\tconst services = new ServiceCollection();\n\t\tservices.set(ILogService, new SyncDescriptor(NullLogService));\n\t\tservices.set(IDialogService, new SyncDescriptor(TestDialogService, [{ confirmed: true }]));\n\t\tservices.set(IStorageService, new SyncDescriptor(TestStorageService));\n\t\tservices.set(ISecretStorageService, new SyncDescriptor(TestSecretStorageService));\n\t\tservices.set(IDynamicAuthenticationProviderStorageService, new SyncDescriptor(DynamicAuthenticationProviderStorageService));\n\t\tservices.set(IQuickInputService, new SyncDescriptor(TestQuickInputService));\n\t\tservices.set(IExtensionService, new SyncDescriptor(TestExtensionService));\n\t\tservices.set(IActivityService, new SyncDescriptor(TestActivityService));\n\t\tservices.set(IRemoteAgentService, new SyncDescriptor(TestRemoteAgentService));\n\t\tservices.set(INotificationService, new SyncDescriptor(TestNotificationService));\n\t\tservices.set(IHostService, new SyncDescriptor(TestHostService));\n\t\tservices.set(IUserActivityService, new SyncDescriptor(UserActivityService));\n\t\tservices.set(IAuthenticationAccessService, new SyncDescriptor(AuthenticationAccessService));\n\t\tservices.set(IAuthenticationService, new SyncDescriptor(AuthenticationService));\n\t\tservices.set(IAuthenticationUsageService, new SyncDescriptor(TestAuthUsageService));\n\t\tservices.set(IAuthenticationExtensionsService, new SyncDescriptor(AuthenticationExtensionsService));\n\t\tinstantiationService = disposables.add(new TestInstantiationService(services, undefined, undefined, true));\n\n\t\t// stubs\n\t\t// eslint-disable-next-line local/code-no-dangerous-type-assertions\n\t\tinstantiationService.stub(IOpenerService, {} as Partial<IOpenerService>);\n\t\tinstantiationService.stub(ITelemetryService, NullTelemetryService);\n\t\tinstantiationService.stub(IBrowserWorkbenchEnvironmentService, TestEnvironmentService);\n\t\tinstantiationService.stub(IProductService, TestProductService);\n\n\t\trpcProtocol = disposables.add(new TestRPCProtocol());\n\t\tmainThreadAuthentication = disposables.add(instantiationService.createInstance(MainThreadAuthentication, rpcProtocol));\n\t\trpcProtocol.set(MainContext.MainThreadAuthentication, mainThreadAuthentication);\n\t});\n\n\ttest('provider registration completes without errors', async () => {\n\t\t// Test basic registration - this should complete without throwing\n\t\tawait mainThreadAuthentication.$registerAuthenticationProvider({\n\t\t\tid: 'test-provider',\n\t\t\tlabel: 'Test Provider',\n\t\t\tsupportsMultipleAccounts: false\n\t\t});\n\n\t\t// Test unregistration - this should also complete without throwing\n\t\tawait mainThreadAuthentication.$unregisterAuthenticationProvider('test-provider');\n\n\t\t// Success if we reach here without timeout\n\t\tassert.ok(true, 'Registration and unregistration completed successfully');\n\t});\n\n\ttest('event suppression during explicit unregistration', async () => {\n\t\tlet unregisterEventFired = false;\n\t\tlet eventProviderId: string | undefined;\n\n\t\t// Mock the ext host to capture unregister events\n\t\tconst mockExtHost = {\n\t\t\t$onDidUnregisterAuthenticationProvider: (id: string) => {\n\t\t\t\tunregisterEventFired = true;\n\t\t\t\teventProviderId = id;\n\t\t\t\treturn Promise.resolve();\n\t\t\t},\n\t\t\t$getSessions: () => Promise.resolve([]),\n\t\t\t// eslint-disable-next-line local/code-no-any-casts\n\t\t\t$createSession: () => Promise.resolve({} as any),\n\t\t\t$removeSession: () => Promise.resolve(),\n\t\t\t$onDidChangeAuthenticationSessions: () => Promise.resolve(),\n\t\t\t$registerDynamicAuthProvider: () => Promise.resolve('test'),\n\t\t\t$onDidChangeDynamicAuthProviderTokens: () => Promise.resolve(),\n\t\t\t$getSessionsFromChallenges: () => Promise.resolve([]),\n\t\t\t// eslint-disable-next-line local/code-no-any-casts\n\t\t\t$createSessionFromChallenges: () => Promise.resolve({} as any),\n\t\t};\n\t\trpcProtocol.set(ExtHostContext.ExtHostAuthentication, mockExtHost);\n\n\t\t// Register a provider\n\t\tawait mainThreadAuthentication.$registerAuthenticationProvider({\n\t\t\tid: 'test-suppress',\n\t\t\tlabel: 'Test Suppress',\n\t\t\tsupportsMultipleAccounts: false\n\t\t});\n\n\t\t// Reset the flag\n\t\tunregisterEventFired = false;\n\t\teventProviderId = undefined;\n\n\t\t// Unregister the provider - this should NOT fire the event due to suppression\n\t\tawait mainThreadAuthentication.$unregisterAuthenticationProvider('test-suppress');\n\n\t\t// Verify the event was suppressed\n\t\tassert.strictEqual(unregisterEventFired, false, 'Unregister event should be suppressed during explicit unregistration');\n\t\tassert.strictEqual(eventProviderId, undefined, 'No provider ID should be captured from suppressed event');\n\t});\n\n\ttest('concurrent provider registrations complete without errors', async () => {\n\t\t// Register multiple providers simultaneously\n\t\tconst registrationPromises = [\n\t\t\tmainThreadAuthentication.$registerAuthenticationProvider({\n\t\t\t\tid: 'concurrent-1',\n\t\t\t\tlabel: 'Concurrent 1',\n\t\t\t\tsupportsMultipleAccounts: false\n\t\t\t}),\n\t\t\tmainThreadAuthentication.$registerAuthenticationProvider({\n\t\t\t\tid: 'concurrent-2',\n\t\t\t\tlabel: 'Concurrent 2',\n\t\t\t\tsupportsMultipleAccounts: false\n\t\t\t}),\n\t\t\tmainThreadAuthentication.$registerAuthenticationProvider({\n\t\t\t\tid: 'concurrent-3',\n\t\t\t\tlabel: 'Concurrent 3',\n\t\t\t\tsupportsMultipleAccounts: false\n\t\t\t})\n\t\t];\n\n\t\tawait Promise.all(registrationPromises);\n\n\t\t// Unregister all providers\n\t\tconst unregistrationPromises = [\n\t\t\tmainThreadAuthentication.$unregisterAuthenticationProvider('concurrent-1'),\n\t\t\tmainThreadAuthentication.$unregisterAuthenticationProvider('concurrent-2'),\n\t\t\tmainThreadAuthentication.$unregisterAuthenticationProvider('concurrent-3')\n\t\t];\n\n\t\tawait Promise.all(unregistrationPromises);\n\n\t\t// Success if we reach here without timeout\n\t\tassert.ok(true, 'Concurrent registrations and unregistrations completed successfully');\n\t});\n});\n"]}