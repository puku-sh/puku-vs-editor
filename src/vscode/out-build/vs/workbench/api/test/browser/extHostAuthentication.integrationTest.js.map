{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/api/test/browser/extHostAuthentication.integrationTest.ts","vs/workbench/api/test/browser/extHostAuthentication.integrationTest.ts"],"names":[],"mappings":"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","file":"extHostAuthentication.integrationTest.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport assert from 'assert';\nimport { IDialogService } from '../../../../platform/dialogs/common/dialogs.js';\nimport { TestDialogService } from '../../../../platform/dialogs/test/common/testDialogService.js';\nimport { TestInstantiationService } from '../../../../platform/instantiation/test/common/instantiationServiceMock.js';\nimport { INotificationService } from '../../../../platform/notification/common/notification.js';\nimport { TestNotificationService } from '../../../../platform/notification/test/common/testNotificationService.js';\nimport { IQuickInputHideEvent, IQuickInputService, IQuickPickDidAcceptEvent, IQuickPickItem, QuickInputHideReason } from '../../../../platform/quickinput/common/quickInput.js';\nimport { IStorageService } from '../../../../platform/storage/common/storage.js';\nimport { ITelemetryService } from '../../../../platform/telemetry/common/telemetry.js';\nimport { NullTelemetryService } from '../../../../platform/telemetry/common/telemetryUtils.js';\nimport { MainThreadAuthentication } from '../../browser/mainThreadAuthentication.js';\nimport { ExtHostContext, MainContext } from '../../common/extHost.protocol.js';\nimport { ExtHostAuthentication } from '../../common/extHostAuthentication.js';\nimport { IActivityService } from '../../../services/activity/common/activity.js';\nimport { AuthenticationService } from '../../../services/authentication/browser/authenticationService.js';\nimport { IAuthenticationExtensionsService, IAuthenticationService } from '../../../services/authentication/common/authentication.js';\nimport { IExtensionService, nullExtensionDescription as extensionDescription } from '../../../services/extensions/common/extensions.js';\nimport { IRemoteAgentService } from '../../../services/remote/common/remoteAgentService.js';\nimport { TestRPCProtocol } from '../common/testRPCProtocol.js';\nimport { TestEnvironmentService, TestHostService, TestQuickInputService, TestRemoteAgentService } from '../../../test/browser/workbenchTestServices.js';\nimport { TestActivityService, TestExtensionService, TestLoggerService, TestProductService, TestStorageService } from '../../../test/common/workbenchTestServices.js';\nimport type { AuthenticationProvider, AuthenticationSession } from 'vscode';\nimport { IBrowserWorkbenchEnvironmentService } from '../../../services/environment/browser/environmentService.js';\nimport { IProductService } from '../../../../platform/product/common/productService.js';\nimport { AuthenticationAccessService, IAuthenticationAccessService } from '../../../services/authentication/browser/authenticationAccessService.js';\nimport { IAccountUsage, IAuthenticationUsageService } from '../../../services/authentication/browser/authenticationUsageService.js';\nimport { AuthenticationExtensionsService } from '../../../services/authentication/browser/authenticationExtensionsService.js';\nimport { ILogService, NullLogService } from '../../../../platform/log/common/log.js';\nimport { IExtHostInitDataService } from '../../common/extHostInitDataService.js';\nimport { ExtHostWindow } from '../../common/extHostWindow.js';\nimport { MainThreadWindow } from '../../browser/mainThreadWindow.js';\nimport { IHostService } from '../../../services/host/browser/host.js';\nimport { IOpenerService } from '../../../../platform/opener/common/opener.js';\nimport { IUserActivityService, UserActivityService } from '../../../services/userActivity/common/userActivityService.js';\nimport { ExtHostUrls } from '../../common/extHostUrls.js';\nimport { ISecretStorageService } from '../../../../platform/secrets/common/secrets.js';\nimport { TestSecretStorageService } from '../../../../platform/secrets/test/common/testSecretStorageService.js';\nimport { IDynamicAuthenticationProviderStorageService } from '../../../services/authentication/common/dynamicAuthenticationProviderStorage.js';\nimport { DynamicAuthenticationProviderStorageService } from '../../../services/authentication/browser/dynamicAuthenticationProviderStorageService.js';\nimport { ExtHostProgress } from '../../common/extHostProgress.js';\nimport { ensureNoDisposablesAreLeakedInTestSuite } from '../../../../base/test/common/utils.js';\nimport { ServiceCollection } from '../../../../platform/instantiation/common/serviceCollection.js';\nimport { SyncDescriptor } from '../../../../platform/instantiation/common/descriptors.js';\n\nclass AuthQuickPick {\n\tprivate accept: ((e: IQuickPickDidAcceptEvent) => any) | undefined;\n\tprivate hide: ((e: IQuickInputHideEvent) => any) | undefined;\n\tpublic items = [];\n\tpublic get selectedItems(): IQuickPickItem[] {\n\t\treturn this.items;\n\t}\n\n\tonDidAccept(listener: (e: IQuickPickDidAcceptEvent) => any) {\n\t\tthis.accept = listener;\n\t}\n\tonDidHide(listener: (e: IQuickInputHideEvent) => any) {\n\t\tthis.hide = listener;\n\t}\n\n\tdispose() {\n\n\t}\n\tshow() {\n\t\tthis.accept?.({ inBackground: false });\n\t\tthis.hide?.({ reason: QuickInputHideReason.Other });\n\t}\n}\nclass AuthTestQuickInputService extends TestQuickInputService {\n\toverride createQuickPick() {\n\t\t// eslint-disable-next-line local/code-no-any-casts\n\t\treturn <any>new AuthQuickPick();\n\t}\n}\n\nclass TestAuthUsageService implements IAuthenticationUsageService {\n\t_serviceBrand: undefined;\n\tinitializeExtensionUsageCache(): Promise<void> { return Promise.resolve(); }\n\textensionUsesAuth(extensionId: string): Promise<boolean> { return Promise.resolve(false); }\n\treadAccountUsages(providerId: string, accountName: string): IAccountUsage[] { return []; }\n\tremoveAccountUsage(providerId: string, accountName: string): void { }\n\taddAccountUsage(providerId: string, accountName: string, scopes: ReadonlyArray<string>, extensionId: string, extensionName: string): void { }\n}\n\nclass TestAuthProvider implements AuthenticationProvider {\n\tprivate id = 1;\n\tprivate sessions = new Map<string, AuthenticationSession>();\n\tonDidChangeSessions = () => { return { dispose() { } }; };\n\tconstructor(private readonly authProviderName: string) { }\n\tasync getSessions(scopes?: readonly string[]): Promise<AuthenticationSession[]> {\n\t\tif (!scopes) {\n\t\t\treturn [...this.sessions.values()];\n\t\t}\n\n\t\tif (scopes[0] === 'return multiple') {\n\t\t\treturn [...this.sessions.values()];\n\t\t}\n\t\tconst sessions = this.sessions.get(scopes.join(' '));\n\t\treturn sessions ? [sessions] : [];\n\t}\n\tasync createSession(scopes: readonly string[]): Promise<AuthenticationSession> {\n\t\tconst scopesStr = scopes.join(' ');\n\t\tconst session = {\n\t\t\tscopes,\n\t\t\tid: `${this.id}`,\n\t\t\taccount: {\n\t\t\t\tlabel: this.authProviderName,\n\t\t\t\tid: `${this.id}`,\n\t\t\t},\n\t\t\taccessToken: Math.random() + '',\n\t\t};\n\t\tthis.sessions.set(scopesStr, session);\n\t\tthis.id++;\n\t\treturn session;\n\t}\n\tasync removeSession(sessionId: string): Promise<void> {\n\t\tthis.sessions.delete(sessionId);\n\t}\n\n}\n\nsuite('ExtHostAuthentication', () => {\n\tconst disposables = ensureNoDisposablesAreLeakedInTestSuite();\n\n\tlet extHostAuthentication: ExtHostAuthentication;\n\tlet mainInstantiationService: TestInstantiationService;\n\n\tsetup(async () => {\n\t\t// services\n\t\tconst services = new ServiceCollection();\n\t\tservices.set(ILogService, new SyncDescriptor(NullLogService));\n\t\tservices.set(IDialogService, new SyncDescriptor(TestDialogService, [{ confirmed: true }]));\n\t\tservices.set(IStorageService, new SyncDescriptor(TestStorageService));\n\t\tservices.set(ISecretStorageService, new SyncDescriptor(TestSecretStorageService));\n\t\tservices.set(IDynamicAuthenticationProviderStorageService, new SyncDescriptor(DynamicAuthenticationProviderStorageService));\n\t\tservices.set(IQuickInputService, new SyncDescriptor(AuthTestQuickInputService));\n\t\tservices.set(IExtensionService, new SyncDescriptor(TestExtensionService));\n\t\tservices.set(IActivityService, new SyncDescriptor(TestActivityService));\n\t\tservices.set(IRemoteAgentService, new SyncDescriptor(TestRemoteAgentService));\n\t\tservices.set(INotificationService, new SyncDescriptor(TestNotificationService));\n\t\tservices.set(IHostService, new SyncDescriptor(TestHostService));\n\t\tservices.set(IUserActivityService, new SyncDescriptor(UserActivityService));\n\t\tservices.set(IAuthenticationAccessService, new SyncDescriptor(AuthenticationAccessService));\n\t\tservices.set(IAuthenticationService, new SyncDescriptor(AuthenticationService));\n\t\tservices.set(IAuthenticationUsageService, new SyncDescriptor(TestAuthUsageService));\n\t\tservices.set(IAuthenticationExtensionsService, new SyncDescriptor(AuthenticationExtensionsService));\n\t\tmainInstantiationService = disposables.add(new TestInstantiationService(services, undefined, undefined, true));\n\n\t\t// stubs\n\t\t// eslint-disable-next-line local/code-no-dangerous-type-assertions\n\t\tmainInstantiationService.stub(IOpenerService, {} as Partial<IOpenerService>);\n\t\tmainInstantiationService.stub(ITelemetryService, NullTelemetryService);\n\t\tmainInstantiationService.stub(IBrowserWorkbenchEnvironmentService, TestEnvironmentService);\n\t\tmainInstantiationService.stub(IProductService, TestProductService);\n\n\t\tconst rpcProtocol = disposables.add(new TestRPCProtocol());\n\n\t\trpcProtocol.set(MainContext.MainThreadAuthentication, disposables.add(mainInstantiationService.createInstance(MainThreadAuthentication, rpcProtocol)));\n\t\trpcProtocol.set(MainContext.MainThreadWindow, disposables.add(mainInstantiationService.createInstance(MainThreadWindow, rpcProtocol)));\n\t\t// eslint-disable-next-line local/code-no-any-casts\n\t\tconst initData: IExtHostInitDataService = {\n\t\t\tenvironment: {\n\t\t\t\tappUriScheme: 'test',\n\t\t\t\tappName: 'Test'\n\t\t\t}\n\t\t} as any;\n\t\textHostAuthentication = new ExtHostAuthentication(\n\t\t\trpcProtocol,\n\t\t\t// eslint-disable-next-line local/code-no-any-casts\n\t\t\t{\n\t\t\t\tenvironment: {\n\t\t\t\t\tappUriScheme: 'test',\n\t\t\t\t\tappName: 'Test'\n\t\t\t\t}\n\t\t\t} as any,\n\t\t\tnew ExtHostWindow(initData, rpcProtocol),\n\t\t\tnew ExtHostUrls(rpcProtocol),\n\t\t\tnew ExtHostProgress(rpcProtocol),\n\t\t\tdisposables.add(new TestLoggerService()),\n\t\t\tnew NullLogService()\n\t\t);\n\t\trpcProtocol.set(ExtHostContext.ExtHostAuthentication, extHostAuthentication);\n\t\tdisposables.add(extHostAuthentication.registerAuthenticationProvider('test', 'test provider', new TestAuthProvider('test')));\n\t\tdisposables.add(extHostAuthentication.registerAuthenticationProvider(\n\t\t\t'test-multiple',\n\t\t\t'test multiple provider',\n\t\t\tnew TestAuthProvider('test-multiple'),\n\t\t\t{ supportsMultipleAccounts: true }));\n\t});\n\n\ttest('createIfNone - true', async () => {\n\t\tconst scopes = ['foo'];\n\t\tconst session = await extHostAuthentication.getSession(\n\t\t\textensionDescription,\n\t\t\t'test',\n\t\t\tscopes,\n\t\t\t{\n\t\t\t\tcreateIfNone: true\n\t\t\t});\n\t\tassert.strictEqual(session?.id, '1');\n\t\tassert.strictEqual(session?.scopes[0], 'foo');\n\t});\n\n\ttest('createIfNone - false', async () => {\n\t\tconst scopes = ['foo'];\n\t\tconst nosession = await extHostAuthentication.getSession(\n\t\t\textensionDescription,\n\t\t\t'test',\n\t\t\tscopes,\n\t\t\t{});\n\t\tassert.strictEqual(nosession, undefined);\n\n\t\t// Now create the session\n\t\tconst session = await extHostAuthentication.getSession(\n\t\t\textensionDescription,\n\t\t\t'test',\n\t\t\tscopes,\n\t\t\t{\n\t\t\t\tcreateIfNone: true\n\t\t\t});\n\n\t\tassert.strictEqual(session?.id, '1');\n\t\tassert.strictEqual(session?.scopes[0], 'foo');\n\n\t\tconst session2 = await extHostAuthentication.getSession(\n\t\t\textensionDescription,\n\t\t\t'test',\n\t\t\tscopes,\n\t\t\t{});\n\n\t\tassert.strictEqual(session2?.id, session.id);\n\t\tassert.strictEqual(session2?.scopes[0], session.scopes[0]);\n\t\tassert.strictEqual(session2?.accessToken, session.accessToken);\n\t});\n\n\t// should behave the same as createIfNone: false\n\ttest('silent - true', async () => {\n\t\tconst scopes = ['foo'];\n\t\tconst nosession = await extHostAuthentication.getSession(\n\t\t\textensionDescription,\n\t\t\t'test',\n\t\t\tscopes,\n\t\t\t{\n\t\t\t\tsilent: true\n\t\t\t});\n\t\tassert.strictEqual(nosession, undefined);\n\n\t\t// Now create the session\n\t\tconst session = await extHostAuthentication.getSession(\n\t\t\textensionDescription,\n\t\t\t'test',\n\t\t\tscopes,\n\t\t\t{\n\t\t\t\tcreateIfNone: true\n\t\t\t});\n\n\t\tassert.strictEqual(session?.id, '1');\n\t\tassert.strictEqual(session?.scopes[0], 'foo');\n\n\t\tconst session2 = await extHostAuthentication.getSession(\n\t\t\textensionDescription,\n\t\t\t'test',\n\t\t\tscopes,\n\t\t\t{\n\t\t\t\tsilent: true\n\t\t\t});\n\n\t\tassert.strictEqual(session.id, session2?.id);\n\t\tassert.strictEqual(session.scopes[0], session2?.scopes[0]);\n\t});\n\n\ttest('forceNewSession - true - existing session', async () => {\n\t\tconst scopes = ['foo'];\n\t\tconst session1 = await extHostAuthentication.getSession(\n\t\t\textensionDescription,\n\t\t\t'test',\n\t\t\tscopes,\n\t\t\t{\n\t\t\t\tcreateIfNone: true\n\t\t\t});\n\n\t\t// Now create the session\n\t\tconst session2 = await extHostAuthentication.getSession(\n\t\t\textensionDescription,\n\t\t\t'test',\n\t\t\tscopes,\n\t\t\t{\n\t\t\t\tforceNewSession: true\n\t\t\t});\n\n\t\tassert.strictEqual(session2?.id, '2');\n\t\tassert.strictEqual(session2?.scopes[0], 'foo');\n\t\tassert.notStrictEqual(session1.accessToken, session2?.accessToken);\n\t});\n\n\t// Should behave like createIfNone: true\n\ttest('forceNewSession - true - no existing session', async () => {\n\t\tconst scopes = ['foo'];\n\t\tconst session = await extHostAuthentication.getSession(\n\t\t\textensionDescription,\n\t\t\t'test',\n\t\t\tscopes,\n\t\t\t{\n\t\t\t\tforceNewSession: true\n\t\t\t});\n\t\tassert.strictEqual(session?.id, '1');\n\t\tassert.strictEqual(session?.scopes[0], 'foo');\n\t});\n\n\ttest('forceNewSession - detail', async () => {\n\t\tconst scopes = ['foo'];\n\t\tconst session1 = await extHostAuthentication.getSession(\n\t\t\textensionDescription,\n\t\t\t'test',\n\t\t\tscopes,\n\t\t\t{\n\t\t\t\tcreateIfNone: true\n\t\t\t});\n\n\t\t// Now create the session\n\t\tconst session2 = await extHostAuthentication.getSession(\n\t\t\textensionDescription,\n\t\t\t'test',\n\t\t\tscopes,\n\t\t\t{\n\t\t\t\tforceNewSession: { detail: 'bar' }\n\t\t\t});\n\n\t\tassert.strictEqual(session2?.id, '2');\n\t\tassert.strictEqual(session2?.scopes[0], 'foo');\n\t\tassert.notStrictEqual(session1.accessToken, session2?.accessToken);\n\t});\n\n\t//#region Multi-Account AuthProvider\n\n\ttest('clearSessionPreference - true', async () => {\n\t\tconst scopes = ['foo'];\n\t\t// Now create the session\n\t\tconst session = await extHostAuthentication.getSession(\n\t\t\textensionDescription,\n\t\t\t'test-multiple',\n\t\t\tscopes,\n\t\t\t{\n\t\t\t\tcreateIfNone: true\n\t\t\t});\n\n\t\tassert.strictEqual(session?.id, '1');\n\t\tassert.strictEqual(session?.scopes[0], scopes[0]);\n\n\t\tconst scopes2 = ['bar'];\n\t\tconst session2 = await extHostAuthentication.getSession(\n\t\t\textensionDescription,\n\t\t\t'test-multiple',\n\t\t\tscopes2,\n\t\t\t{\n\t\t\t\tcreateIfNone: true\n\t\t\t});\n\t\tassert.strictEqual(session2?.id, '2');\n\t\tassert.strictEqual(session2?.scopes[0], scopes2[0]);\n\n\t\tconst session3 = await extHostAuthentication.getSession(\n\t\t\textensionDescription,\n\t\t\t'test-multiple',\n\t\t\t['return multiple'],\n\t\t\t{\n\t\t\t\tclearSessionPreference: true,\n\t\t\t\tcreateIfNone: true\n\t\t\t});\n\n\t\t// clearing session preference causes us to get the first session\n\t\t// because it would normally show a quick pick for the user to choose\n\t\tassert.strictEqual(session3?.id, session.id);\n\t\tassert.strictEqual(session3?.scopes[0], session.scopes[0]);\n\t\tassert.strictEqual(session3?.accessToken, session.accessToken);\n\t});\n\n\ttest('silently getting session should return a session (if any) regardless of preference - fixes #137819', async () => {\n\t\tconst scopes = ['foo'];\n\t\t// Now create the session\n\t\tconst session = await extHostAuthentication.getSession(\n\t\t\textensionDescription,\n\t\t\t'test-multiple',\n\t\t\tscopes,\n\t\t\t{\n\t\t\t\tcreateIfNone: true\n\t\t\t});\n\n\t\tassert.strictEqual(session?.id, '1');\n\t\tassert.strictEqual(session?.scopes[0], scopes[0]);\n\n\t\tconst scopes2 = ['bar'];\n\t\tconst session2 = await extHostAuthentication.getSession(\n\t\t\textensionDescription,\n\t\t\t'test-multiple',\n\t\t\tscopes2,\n\t\t\t{\n\t\t\t\tcreateIfNone: true\n\t\t\t});\n\t\tassert.strictEqual(session2?.id, '2');\n\t\tassert.strictEqual(session2?.scopes[0], scopes2[0]);\n\n\t\tconst shouldBeSession1 = await extHostAuthentication.getSession(\n\t\t\textensionDescription,\n\t\t\t'test-multiple',\n\t\t\tscopes,\n\t\t\t{});\n\t\tassert.strictEqual(shouldBeSession1?.id, session.id);\n\t\tassert.strictEqual(shouldBeSession1?.scopes[0], session.scopes[0]);\n\t\tassert.strictEqual(shouldBeSession1?.accessToken, session.accessToken);\n\n\t\tconst shouldBeSession2 = await extHostAuthentication.getSession(\n\t\t\textensionDescription,\n\t\t\t'test-multiple',\n\t\t\tscopes2,\n\t\t\t{});\n\t\tassert.strictEqual(shouldBeSession2?.id, session2.id);\n\t\tassert.strictEqual(shouldBeSession2?.scopes[0], session2.scopes[0]);\n\t\tassert.strictEqual(shouldBeSession2?.accessToken, session2.accessToken);\n\t});\n\n\t//#endregion\n\n\t//#region error cases\n\n\ttest('createIfNone and forceNewSession', async () => {\n\t\ttry {\n\t\t\tawait extHostAuthentication.getSession(\n\t\t\t\textensionDescription,\n\t\t\t\t'test',\n\t\t\t\t['foo'],\n\t\t\t\t{\n\t\t\t\t\tcreateIfNone: true,\n\t\t\t\t\tforceNewSession: true\n\t\t\t\t});\n\t\t\tassert.fail('should have thrown an Error.');\n\t\t} catch (e) {\n\t\t\tassert.ok(e);\n\t\t}\n\t});\n\n\ttest('forceNewSession and silent', async () => {\n\t\ttry {\n\t\t\tawait extHostAuthentication.getSession(\n\t\t\t\textensionDescription,\n\t\t\t\t'test',\n\t\t\t\t['foo'],\n\t\t\t\t{\n\t\t\t\t\tforceNewSession: true,\n\t\t\t\t\tsilent: true\n\t\t\t\t});\n\t\t\tassert.fail('should have thrown an Error.');\n\t\t} catch (e) {\n\t\t\tassert.ok(e);\n\t\t}\n\t});\n\n\ttest('createIfNone and silent', async () => {\n\t\ttry {\n\t\t\tawait extHostAuthentication.getSession(\n\t\t\t\textensionDescription,\n\t\t\t\t'test',\n\t\t\t\t['foo'],\n\t\t\t\t{\n\t\t\t\t\tcreateIfNone: true,\n\t\t\t\t\tsilent: true\n\t\t\t\t});\n\t\t\tassert.fail('should have thrown an Error.');\n\t\t} catch (e) {\n\t\t\tassert.ok(e);\n\t\t}\n\t});\n\n\ttest('Can get multiple sessions (with different scopes) in one extension', async () => {\n\t\tlet session: AuthenticationSession | undefined = await extHostAuthentication.getSession(\n\t\t\textensionDescription,\n\t\t\t'test-multiple',\n\t\t\t['foo'],\n\t\t\t{\n\t\t\t\tcreateIfNone: true\n\t\t\t});\n\t\tsession = await extHostAuthentication.getSession(\n\t\t\textensionDescription,\n\t\t\t'test-multiple',\n\t\t\t['bar'],\n\t\t\t{\n\t\t\t\tcreateIfNone: true\n\t\t\t});\n\t\tassert.strictEqual(session?.id, '2');\n\t\tassert.strictEqual(session?.scopes[0], 'bar');\n\n\t\tsession = await extHostAuthentication.getSession(\n\t\t\textensionDescription,\n\t\t\t'test-multiple',\n\t\t\t['foo'],\n\t\t\t{\n\t\t\t\tcreateIfNone: false\n\t\t\t});\n\t\tassert.strictEqual(session?.id, '1');\n\t\tassert.strictEqual(session?.scopes[0], 'foo');\n\t});\n\n\ttest('Can get multiple sessions (from different providers) in one extension', async () => {\n\t\tlet session: AuthenticationSession | undefined = await extHostAuthentication.getSession(\n\t\t\textensionDescription,\n\t\t\t'test-multiple',\n\t\t\t['foo'],\n\t\t\t{\n\t\t\t\tcreateIfNone: true\n\t\t\t});\n\t\tsession = await extHostAuthentication.getSession(\n\t\t\textensionDescription,\n\t\t\t'test',\n\t\t\t['foo'],\n\t\t\t{\n\t\t\t\tcreateIfNone: true\n\t\t\t});\n\t\tassert.strictEqual(session?.id, '1');\n\t\tassert.strictEqual(session?.scopes[0], 'foo');\n\t\tassert.strictEqual(session?.account.label, 'test');\n\n\t\tconst session2 = await extHostAuthentication.getSession(\n\t\t\textensionDescription,\n\t\t\t'test-multiple',\n\t\t\t['foo'],\n\t\t\t{\n\t\t\t\tcreateIfNone: false\n\t\t\t});\n\t\tassert.strictEqual(session2?.id, '1');\n\t\tassert.strictEqual(session2?.scopes[0], 'foo');\n\t\tassert.strictEqual(session2?.account.label, 'test-multiple');\n\t});\n\n\ttest('Can get multiple sessions (from different providers) in one extension at the same time', async () => {\n\t\tconst sessionP: Promise<AuthenticationSession | undefined> = extHostAuthentication.getSession(\n\t\t\textensionDescription,\n\t\t\t'test',\n\t\t\t['foo'],\n\t\t\t{\n\t\t\t\tcreateIfNone: true\n\t\t\t});\n\t\tconst session2P: Promise<AuthenticationSession | undefined> = extHostAuthentication.getSession(\n\t\t\textensionDescription,\n\t\t\t'test-multiple',\n\t\t\t['foo'],\n\t\t\t{\n\t\t\t\tcreateIfNone: true\n\t\t\t});\n\t\tconst session = await sessionP;\n\t\tassert.strictEqual(session?.id, '1');\n\t\tassert.strictEqual(session?.scopes[0], 'foo');\n\t\tassert.strictEqual(session?.account.label, 'test');\n\n\t\tconst session2 = await session2P;\n\t\tassert.strictEqual(session2?.id, '1');\n\t\tassert.strictEqual(session2?.scopes[0], 'foo');\n\t\tassert.strictEqual(session2?.account.label, 'test-multiple');\n\t});\n\n\n\t//#endregion\n\n\t//#region Race Condition and Sequencing Tests\n\n\ttest('concurrent operations on same provider are serialized', async () => {\n\t\tconst provider = new TestAuthProvider('concurrent-test');\n\t\tconst operationOrder: string[] = [];\n\n\t\t// Mock the provider methods to track operation order\n\t\tconst originalCreateSession = provider.createSession.bind(provider);\n\t\tconst originalGetSessions = provider.getSessions.bind(provider);\n\n\t\tprovider.createSession = async (scopes) => {\n\t\t\toperationOrder.push(`create-start-${scopes[0]}`);\n\t\t\tawait new Promise(resolve => setTimeout(resolve, 20)); // Simulate async work\n\t\t\tconst result = await originalCreateSession(scopes);\n\t\t\toperationOrder.push(`create-end-${scopes[0]}`);\n\t\t\treturn result;\n\t\t};\n\n\t\tprovider.getSessions = async (scopes) => {\n\t\t\tconst scopeKey = scopes ? scopes[0] : 'all';\n\t\t\toperationOrder.push(`get-start-${scopeKey}`);\n\t\t\tawait new Promise(resolve => setTimeout(resolve, 10)); // Simulate async work\n\t\t\tconst result = await originalGetSessions(scopes);\n\t\t\toperationOrder.push(`get-end-${scopeKey}`);\n\t\t\treturn result;\n\t\t};\n\n\t\tconst disposable = extHostAuthentication.registerAuthenticationProvider('concurrent-test', 'Concurrent Test', provider);\n\t\tdisposables.add(disposable);\n\n\t\t// Start multiple operations simultaneously on the same provider\n\t\tconst promises = [\n\t\t\textHostAuthentication.getSession(extensionDescription, 'concurrent-test', ['scope1'], { createIfNone: true }),\n\t\t\textHostAuthentication.getSession(extensionDescription, 'concurrent-test', ['scope2'], { createIfNone: true }),\n\t\t\textHostAuthentication.getSession(extensionDescription, 'concurrent-test', ['scope1'], {}) // This should get the existing session\n\t\t];\n\n\t\tawait Promise.all(promises);\n\n\t\t// Verify that operations were serialized - no overlapping operations\n\t\t// Build a map of operation starts to their corresponding ends\n\t\tconst operationPairs: Array<{ start: number; end: number; operation: string }> = [];\n\n\t\tfor (let i = 0; i < operationOrder.length; i++) {\n\t\t\tconst current = operationOrder[i];\n\t\t\tif (current.includes('-start-')) {\n\t\t\t\tconst scope = current.split('-start-')[1];\n\t\t\t\tconst operationType = current.split('-start-')[0];\n\t\t\t\tconst endOperation = `${operationType}-end-${scope}`;\n\t\t\t\tconst endIndex = operationOrder.indexOf(endOperation, i + 1);\n\n\t\t\t\tif (endIndex !== -1) {\n\t\t\t\t\toperationPairs.push({\n\t\t\t\t\t\tstart: i,\n\t\t\t\t\t\tend: endIndex,\n\t\t\t\t\t\toperation: `${operationType}-${scope}`\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// Verify no operations overlap (serialization)\n\t\tfor (let i = 0; i < operationPairs.length; i++) {\n\t\t\tfor (let j = i + 1; j < operationPairs.length; j++) {\n\t\t\t\tconst op1 = operationPairs[i];\n\t\t\t\tconst op2 = operationPairs[j];\n\n\t\t\t\t// Operations should not overlap - one should completely finish before the other starts\n\t\t\t\tconst op1EndsBeforeOp2Starts = op1.end < op2.start;\n\t\t\t\tconst op2EndsBeforeOp1Starts = op2.end < op1.start;\n\n\t\t\t\tassert.ok(op1EndsBeforeOp2Starts || op2EndsBeforeOp1Starts,\n\t\t\t\t\t`Operations ${op1.operation} and ${op2.operation} should not overlap. ` +\n\t\t\t\t\t`Op1: ${op1.start}-${op1.end}, Op2: ${op2.start}-${op2.end}. ` +\n\t\t\t\t\t`Order: [${operationOrder.join(', ')}]`);\n\t\t\t}\n\t\t}\n\n\t\t// Verify we have the expected operations\n\t\tassert.ok(operationOrder.includes('create-start-scope1'), 'Should have created session for scope1');\n\t\tassert.ok(operationOrder.includes('create-end-scope1'), 'Should have completed creating session for scope1');\n\t\tassert.ok(operationOrder.includes('create-start-scope2'), 'Should have created session for scope2');\n\t\tassert.ok(operationOrder.includes('create-end-scope2'), 'Should have completed creating session for scope2');\n\n\t\t// The third call should use getSessions to find the existing scope1 session\n\t\tassert.ok(operationOrder.includes('get-start-scope1'), 'Should have called getSessions for existing scope1 session');\n\t\tassert.ok(operationOrder.includes('get-end-scope1'), 'Should have completed getSessions for existing scope1 session');\n\t});\n\n\ttest('provider registration and immediate disposal race condition', async () => {\n\t\tconst provider = new TestAuthProvider('race-test');\n\n\t\t// Register and immediately dispose\n\t\tconst disposable = extHostAuthentication.registerAuthenticationProvider('race-test', 'Race Test', provider);\n\t\tdisposable.dispose();\n\n\t\t// Try to use the provider after disposal - should fail gracefully\n\t\ttry {\n\t\t\tawait extHostAuthentication.getSession(extensionDescription, 'race-test', ['scope'], { createIfNone: true });\n\t\t\tassert.fail('Should have thrown an error for non-existent provider');\n\t\t} catch (error) {\n\t\t\t// Expected - provider should be unavailable\n\t\t\tassert.ok(error);\n\t\t}\n\t});\n\n\ttest('provider re-registration after proper disposal', async () => {\n\t\tconst provider1 = new TestAuthProvider('reregister-test-1');\n\t\tconst provider2 = new TestAuthProvider('reregister-test-2');\n\n\t\t// First registration\n\t\tconst disposable1 = extHostAuthentication.registerAuthenticationProvider('reregister-test', 'Provider 1', provider1);\n\n\t\t// Create a session with first provider\n\t\tconst session1 = await extHostAuthentication.getSession(extensionDescription, 'reregister-test', ['scope'], { createIfNone: true });\n\t\tassert.strictEqual(session1?.account.label, 'reregister-test-1');\n\n\t\t// Dispose first provider\n\t\tdisposable1.dispose();\n\n\t\t// Re-register with different provider\n\t\tconst disposable2 = extHostAuthentication.registerAuthenticationProvider('reregister-test', 'Provider 2', provider2);\n\t\tdisposables.add(disposable2);\n\n\t\t// Create session with second provider\n\t\tconst session2 = await extHostAuthentication.getSession(extensionDescription, 'reregister-test', ['scope'], { createIfNone: true });\n\t\tassert.strictEqual(session2?.account.label, 'reregister-test-2');\n\t\tassert.notStrictEqual(session1?.accessToken, session2?.accessToken);\n\t});\n\n\ttest('session operations during provider lifecycle changes', async () => {\n\t\tconst provider = new TestAuthProvider('lifecycle-test');\n\t\tconst disposable = extHostAuthentication.registerAuthenticationProvider('lifecycle-test', 'Lifecycle Test', provider);\n\n\t\t// Start a session creation\n\t\tconst sessionPromise = extHostAuthentication.getSession(extensionDescription, 'lifecycle-test', ['scope'], { createIfNone: true });\n\n\t\t// Don't dispose immediately - let the session creation start\n\t\tawait new Promise(resolve => setTimeout(resolve, 5));\n\n\t\t// Dispose the provider while the session creation is likely still in progress\n\t\tdisposable.dispose();\n\n\t\t// The session creation should complete successfully even if we dispose during the operation\n\t\tconst session = await sessionPromise;\n\t\tassert.ok(session);\n\t\tassert.strictEqual(session.account.label, 'lifecycle-test');\n\t});\n\n\ttest('operations on different providers run concurrently', async () => {\n\t\tconst provider1 = new TestAuthProvider('concurrent-1');\n\t\tconst provider2 = new TestAuthProvider('concurrent-2');\n\n\t\tlet provider1Started = false;\n\t\tlet provider2Started = false;\n\t\tlet provider1Finished = false;\n\t\tlet provider2Finished = false;\n\t\tlet concurrencyVerified = false;\n\n\t\t// Override createSession to track timing\n\t\tconst originalCreate1 = provider1.createSession.bind(provider1);\n\t\tconst originalCreate2 = provider2.createSession.bind(provider2);\n\n\t\tprovider1.createSession = async (scopes) => {\n\t\t\tprovider1Started = true;\n\t\t\tawait new Promise(resolve => setTimeout(resolve, 20));\n\t\t\tconst result = await originalCreate1(scopes);\n\t\t\tprovider1Finished = true;\n\t\t\treturn result;\n\t\t};\n\n\t\tprovider2.createSession = async (scopes) => {\n\t\t\tprovider2Started = true;\n\t\t\t// Provider 2 should start before provider 1 finishes (concurrent execution)\n\t\t\tif (provider1Started && !provider1Finished) {\n\t\t\t\tconcurrencyVerified = true;\n\t\t\t}\n\t\t\tawait new Promise(resolve => setTimeout(resolve, 10));\n\t\t\tconst result = await originalCreate2(scopes);\n\t\t\tprovider2Finished = true;\n\t\t\treturn result;\n\t\t};\n\n\t\tconst disposable1 = extHostAuthentication.registerAuthenticationProvider('concurrent-1', 'Concurrent 1', provider1);\n\t\tconst disposable2 = extHostAuthentication.registerAuthenticationProvider('concurrent-2', 'Concurrent 2', provider2);\n\t\tdisposables.add(disposable1);\n\t\tdisposables.add(disposable2);\n\n\t\t// Start operations on both providers simultaneously\n\t\tconst [session1, session2] = await Promise.all([\n\t\t\textHostAuthentication.getSession(extensionDescription, 'concurrent-1', ['scope'], { createIfNone: true }),\n\t\t\textHostAuthentication.getSession(extensionDescription, 'concurrent-2', ['scope'], { createIfNone: true })\n\t\t]);\n\n\t\t// Verify both operations completed successfully\n\t\tassert.ok(session1);\n\t\tassert.ok(session2);\n\t\tassert.ok(provider1Started, 'Provider 1 should have started');\n\t\tassert.ok(provider2Started, 'Provider 2 should have started');\n\t\tassert.ok(provider1Finished, 'Provider 1 should have finished');\n\t\tassert.ok(provider2Finished, 'Provider 2 should have finished');\n\t\tassert.strictEqual(session1.account.label, 'concurrent-1');\n\t\tassert.strictEqual(session2.account.label, 'concurrent-2');\n\n\t\t// Verify that operations ran concurrently (provider 2 started while provider 1 was still running)\n\t\tassert.ok(concurrencyVerified, 'Operations should have run concurrently - provider 2 should start while provider 1 is still running');\n\t});\n\n\t//#endregion\n});\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport assert from 'assert';\nimport { IDialogService } from '../../../../platform/dialogs/common/dialogs.js';\nimport { TestDialogService } from '../../../../platform/dialogs/test/common/testDialogService.js';\nimport { TestInstantiationService } from '../../../../platform/instantiation/test/common/instantiationServiceMock.js';\nimport { INotificationService } from '../../../../platform/notification/common/notification.js';\nimport { TestNotificationService } from '../../../../platform/notification/test/common/testNotificationService.js';\nimport { IQuickInputHideEvent, IQuickInputService, IQuickPickDidAcceptEvent, IQuickPickItem, QuickInputHideReason } from '../../../../platform/quickinput/common/quickInput.js';\nimport { IStorageService } from '../../../../platform/storage/common/storage.js';\nimport { ITelemetryService } from '../../../../platform/telemetry/common/telemetry.js';\nimport { NullTelemetryService } from '../../../../platform/telemetry/common/telemetryUtils.js';\nimport { MainThreadAuthentication } from '../../browser/mainThreadAuthentication.js';\nimport { ExtHostContext, MainContext } from '../../common/extHost.protocol.js';\nimport { ExtHostAuthentication } from '../../common/extHostAuthentication.js';\nimport { IActivityService } from '../../../services/activity/common/activity.js';\nimport { AuthenticationService } from '../../../services/authentication/browser/authenticationService.js';\nimport { IAuthenticationExtensionsService, IAuthenticationService } from '../../../services/authentication/common/authentication.js';\nimport { IExtensionService, nullExtensionDescription as extensionDescription } from '../../../services/extensions/common/extensions.js';\nimport { IRemoteAgentService } from '../../../services/remote/common/remoteAgentService.js';\nimport { TestRPCProtocol } from '../common/testRPCProtocol.js';\nimport { TestEnvironmentService, TestHostService, TestQuickInputService, TestRemoteAgentService } from '../../../test/browser/workbenchTestServices.js';\nimport { TestActivityService, TestExtensionService, TestLoggerService, TestProductService, TestStorageService } from '../../../test/common/workbenchTestServices.js';\nimport type { AuthenticationProvider, AuthenticationSession } from 'vscode';\nimport { IBrowserWorkbenchEnvironmentService } from '../../../services/environment/browser/environmentService.js';\nimport { IProductService } from '../../../../platform/product/common/productService.js';\nimport { AuthenticationAccessService, IAuthenticationAccessService } from '../../../services/authentication/browser/authenticationAccessService.js';\nimport { IAccountUsage, IAuthenticationUsageService } from '../../../services/authentication/browser/authenticationUsageService.js';\nimport { AuthenticationExtensionsService } from '../../../services/authentication/browser/authenticationExtensionsService.js';\nimport { ILogService, NullLogService } from '../../../../platform/log/common/log.js';\nimport { IExtHostInitDataService } from '../../common/extHostInitDataService.js';\nimport { ExtHostWindow } from '../../common/extHostWindow.js';\nimport { MainThreadWindow } from '../../browser/mainThreadWindow.js';\nimport { IHostService } from '../../../services/host/browser/host.js';\nimport { IOpenerService } from '../../../../platform/opener/common/opener.js';\nimport { IUserActivityService, UserActivityService } from '../../../services/userActivity/common/userActivityService.js';\nimport { ExtHostUrls } from '../../common/extHostUrls.js';\nimport { ISecretStorageService } from '../../../../platform/secrets/common/secrets.js';\nimport { TestSecretStorageService } from '../../../../platform/secrets/test/common/testSecretStorageService.js';\nimport { IDynamicAuthenticationProviderStorageService } from '../../../services/authentication/common/dynamicAuthenticationProviderStorage.js';\nimport { DynamicAuthenticationProviderStorageService } from '../../../services/authentication/browser/dynamicAuthenticationProviderStorageService.js';\nimport { ExtHostProgress } from '../../common/extHostProgress.js';\nimport { ensureNoDisposablesAreLeakedInTestSuite } from '../../../../base/test/common/utils.js';\nimport { ServiceCollection } from '../../../../platform/instantiation/common/serviceCollection.js';\nimport { SyncDescriptor } from '../../../../platform/instantiation/common/descriptors.js';\n\nclass AuthQuickPick {\n\tprivate accept: ((e: IQuickPickDidAcceptEvent) => any) | undefined;\n\tprivate hide: ((e: IQuickInputHideEvent) => any) | undefined;\n\tpublic items = [];\n\tpublic get selectedItems(): IQuickPickItem[] {\n\t\treturn this.items;\n\t}\n\n\tonDidAccept(listener: (e: IQuickPickDidAcceptEvent) => any) {\n\t\tthis.accept = listener;\n\t}\n\tonDidHide(listener: (e: IQuickInputHideEvent) => any) {\n\t\tthis.hide = listener;\n\t}\n\n\tdispose() {\n\n\t}\n\tshow() {\n\t\tthis.accept?.({ inBackground: false });\n\t\tthis.hide?.({ reason: QuickInputHideReason.Other });\n\t}\n}\nclass AuthTestQuickInputService extends TestQuickInputService {\n\toverride createQuickPick() {\n\t\t// eslint-disable-next-line local/code-no-any-casts\n\t\treturn <any>new AuthQuickPick();\n\t}\n}\n\nclass TestAuthUsageService implements IAuthenticationUsageService {\n\t_serviceBrand: undefined;\n\tinitializeExtensionUsageCache(): Promise<void> { return Promise.resolve(); }\n\textensionUsesAuth(extensionId: string): Promise<boolean> { return Promise.resolve(false); }\n\treadAccountUsages(providerId: string, accountName: string): IAccountUsage[] { return []; }\n\tremoveAccountUsage(providerId: string, accountName: string): void { }\n\taddAccountUsage(providerId: string, accountName: string, scopes: ReadonlyArray<string>, extensionId: string, extensionName: string): void { }\n}\n\nclass TestAuthProvider implements AuthenticationProvider {\n\tprivate id = 1;\n\tprivate sessions = new Map<string, AuthenticationSession>();\n\tonDidChangeSessions = () => { return { dispose() { } }; };\n\tconstructor(private readonly authProviderName: string) { }\n\tasync getSessions(scopes?: readonly string[]): Promise<AuthenticationSession[]> {\n\t\tif (!scopes) {\n\t\t\treturn [...this.sessions.values()];\n\t\t}\n\n\t\tif (scopes[0] === 'return multiple') {\n\t\t\treturn [...this.sessions.values()];\n\t\t}\n\t\tconst sessions = this.sessions.get(scopes.join(' '));\n\t\treturn sessions ? [sessions] : [];\n\t}\n\tasync createSession(scopes: readonly string[]): Promise<AuthenticationSession> {\n\t\tconst scopesStr = scopes.join(' ');\n\t\tconst session = {\n\t\t\tscopes,\n\t\t\tid: `${this.id}`,\n\t\t\taccount: {\n\t\t\t\tlabel: this.authProviderName,\n\t\t\t\tid: `${this.id}`,\n\t\t\t},\n\t\t\taccessToken: Math.random() + '',\n\t\t};\n\t\tthis.sessions.set(scopesStr, session);\n\t\tthis.id++;\n\t\treturn session;\n\t}\n\tasync removeSession(sessionId: string): Promise<void> {\n\t\tthis.sessions.delete(sessionId);\n\t}\n\n}\n\nsuite('ExtHostAuthentication', () => {\n\tconst disposables = ensureNoDisposablesAreLeakedInTestSuite();\n\n\tlet extHostAuthentication: ExtHostAuthentication;\n\tlet mainInstantiationService: TestInstantiationService;\n\n\tsetup(async () => {\n\t\t// services\n\t\tconst services = new ServiceCollection();\n\t\tservices.set(ILogService, new SyncDescriptor(NullLogService));\n\t\tservices.set(IDialogService, new SyncDescriptor(TestDialogService, [{ confirmed: true }]));\n\t\tservices.set(IStorageService, new SyncDescriptor(TestStorageService));\n\t\tservices.set(ISecretStorageService, new SyncDescriptor(TestSecretStorageService));\n\t\tservices.set(IDynamicAuthenticationProviderStorageService, new SyncDescriptor(DynamicAuthenticationProviderStorageService));\n\t\tservices.set(IQuickInputService, new SyncDescriptor(AuthTestQuickInputService));\n\t\tservices.set(IExtensionService, new SyncDescriptor(TestExtensionService));\n\t\tservices.set(IActivityService, new SyncDescriptor(TestActivityService));\n\t\tservices.set(IRemoteAgentService, new SyncDescriptor(TestRemoteAgentService));\n\t\tservices.set(INotificationService, new SyncDescriptor(TestNotificationService));\n\t\tservices.set(IHostService, new SyncDescriptor(TestHostService));\n\t\tservices.set(IUserActivityService, new SyncDescriptor(UserActivityService));\n\t\tservices.set(IAuthenticationAccessService, new SyncDescriptor(AuthenticationAccessService));\n\t\tservices.set(IAuthenticationService, new SyncDescriptor(AuthenticationService));\n\t\tservices.set(IAuthenticationUsageService, new SyncDescriptor(TestAuthUsageService));\n\t\tservices.set(IAuthenticationExtensionsService, new SyncDescriptor(AuthenticationExtensionsService));\n\t\tmainInstantiationService = disposables.add(new TestInstantiationService(services, undefined, undefined, true));\n\n\t\t// stubs\n\t\t// eslint-disable-next-line local/code-no-dangerous-type-assertions\n\t\tmainInstantiationService.stub(IOpenerService, {} as Partial<IOpenerService>);\n\t\tmainInstantiationService.stub(ITelemetryService, NullTelemetryService);\n\t\tmainInstantiationService.stub(IBrowserWorkbenchEnvironmentService, TestEnvironmentService);\n\t\tmainInstantiationService.stub(IProductService, TestProductService);\n\n\t\tconst rpcProtocol = disposables.add(new TestRPCProtocol());\n\n\t\trpcProtocol.set(MainContext.MainThreadAuthentication, disposables.add(mainInstantiationService.createInstance(MainThreadAuthentication, rpcProtocol)));\n\t\trpcProtocol.set(MainContext.MainThreadWindow, disposables.add(mainInstantiationService.createInstance(MainThreadWindow, rpcProtocol)));\n\t\t// eslint-disable-next-line local/code-no-any-casts\n\t\tconst initData: IExtHostInitDataService = {\n\t\t\tenvironment: {\n\t\t\t\tappUriScheme: 'test',\n\t\t\t\tappName: 'Test'\n\t\t\t}\n\t\t} as any;\n\t\textHostAuthentication = new ExtHostAuthentication(\n\t\t\trpcProtocol,\n\t\t\t// eslint-disable-next-line local/code-no-any-casts\n\t\t\t{\n\t\t\t\tenvironment: {\n\t\t\t\t\tappUriScheme: 'test',\n\t\t\t\t\tappName: 'Test'\n\t\t\t\t}\n\t\t\t} as any,\n\t\t\tnew ExtHostWindow(initData, rpcProtocol),\n\t\t\tnew ExtHostUrls(rpcProtocol),\n\t\t\tnew ExtHostProgress(rpcProtocol),\n\t\t\tdisposables.add(new TestLoggerService()),\n\t\t\tnew NullLogService()\n\t\t);\n\t\trpcProtocol.set(ExtHostContext.ExtHostAuthentication, extHostAuthentication);\n\t\tdisposables.add(extHostAuthentication.registerAuthenticationProvider('test', 'test provider', new TestAuthProvider('test')));\n\t\tdisposables.add(extHostAuthentication.registerAuthenticationProvider(\n\t\t\t'test-multiple',\n\t\t\t'test multiple provider',\n\t\t\tnew TestAuthProvider('test-multiple'),\n\t\t\t{ supportsMultipleAccounts: true }));\n\t});\n\n\ttest('createIfNone - true', async () => {\n\t\tconst scopes = ['foo'];\n\t\tconst session = await extHostAuthentication.getSession(\n\t\t\textensionDescription,\n\t\t\t'test',\n\t\t\tscopes,\n\t\t\t{\n\t\t\t\tcreateIfNone: true\n\t\t\t});\n\t\tassert.strictEqual(session?.id, '1');\n\t\tassert.strictEqual(session?.scopes[0], 'foo');\n\t});\n\n\ttest('createIfNone - false', async () => {\n\t\tconst scopes = ['foo'];\n\t\tconst nosession = await extHostAuthentication.getSession(\n\t\t\textensionDescription,\n\t\t\t'test',\n\t\t\tscopes,\n\t\t\t{});\n\t\tassert.strictEqual(nosession, undefined);\n\n\t\t// Now create the session\n\t\tconst session = await extHostAuthentication.getSession(\n\t\t\textensionDescription,\n\t\t\t'test',\n\t\t\tscopes,\n\t\t\t{\n\t\t\t\tcreateIfNone: true\n\t\t\t});\n\n\t\tassert.strictEqual(session?.id, '1');\n\t\tassert.strictEqual(session?.scopes[0], 'foo');\n\n\t\tconst session2 = await extHostAuthentication.getSession(\n\t\t\textensionDescription,\n\t\t\t'test',\n\t\t\tscopes,\n\t\t\t{});\n\n\t\tassert.strictEqual(session2?.id, session.id);\n\t\tassert.strictEqual(session2?.scopes[0], session.scopes[0]);\n\t\tassert.strictEqual(session2?.accessToken, session.accessToken);\n\t});\n\n\t// should behave the same as createIfNone: false\n\ttest('silent - true', async () => {\n\t\tconst scopes = ['foo'];\n\t\tconst nosession = await extHostAuthentication.getSession(\n\t\t\textensionDescription,\n\t\t\t'test',\n\t\t\tscopes,\n\t\t\t{\n\t\t\t\tsilent: true\n\t\t\t});\n\t\tassert.strictEqual(nosession, undefined);\n\n\t\t// Now create the session\n\t\tconst session = await extHostAuthentication.getSession(\n\t\t\textensionDescription,\n\t\t\t'test',\n\t\t\tscopes,\n\t\t\t{\n\t\t\t\tcreateIfNone: true\n\t\t\t});\n\n\t\tassert.strictEqual(session?.id, '1');\n\t\tassert.strictEqual(session?.scopes[0], 'foo');\n\n\t\tconst session2 = await extHostAuthentication.getSession(\n\t\t\textensionDescription,\n\t\t\t'test',\n\t\t\tscopes,\n\t\t\t{\n\t\t\t\tsilent: true\n\t\t\t});\n\n\t\tassert.strictEqual(session.id, session2?.id);\n\t\tassert.strictEqual(session.scopes[0], session2?.scopes[0]);\n\t});\n\n\ttest('forceNewSession - true - existing session', async () => {\n\t\tconst scopes = ['foo'];\n\t\tconst session1 = await extHostAuthentication.getSession(\n\t\t\textensionDescription,\n\t\t\t'test',\n\t\t\tscopes,\n\t\t\t{\n\t\t\t\tcreateIfNone: true\n\t\t\t});\n\n\t\t// Now create the session\n\t\tconst session2 = await extHostAuthentication.getSession(\n\t\t\textensionDescription,\n\t\t\t'test',\n\t\t\tscopes,\n\t\t\t{\n\t\t\t\tforceNewSession: true\n\t\t\t});\n\n\t\tassert.strictEqual(session2?.id, '2');\n\t\tassert.strictEqual(session2?.scopes[0], 'foo');\n\t\tassert.notStrictEqual(session1.accessToken, session2?.accessToken);\n\t});\n\n\t// Should behave like createIfNone: true\n\ttest('forceNewSession - true - no existing session', async () => {\n\t\tconst scopes = ['foo'];\n\t\tconst session = await extHostAuthentication.getSession(\n\t\t\textensionDescription,\n\t\t\t'test',\n\t\t\tscopes,\n\t\t\t{\n\t\t\t\tforceNewSession: true\n\t\t\t});\n\t\tassert.strictEqual(session?.id, '1');\n\t\tassert.strictEqual(session?.scopes[0], 'foo');\n\t});\n\n\ttest('forceNewSession - detail', async () => {\n\t\tconst scopes = ['foo'];\n\t\tconst session1 = await extHostAuthentication.getSession(\n\t\t\textensionDescription,\n\t\t\t'test',\n\t\t\tscopes,\n\t\t\t{\n\t\t\t\tcreateIfNone: true\n\t\t\t});\n\n\t\t// Now create the session\n\t\tconst session2 = await extHostAuthentication.getSession(\n\t\t\textensionDescription,\n\t\t\t'test',\n\t\t\tscopes,\n\t\t\t{\n\t\t\t\tforceNewSession: { detail: 'bar' }\n\t\t\t});\n\n\t\tassert.strictEqual(session2?.id, '2');\n\t\tassert.strictEqual(session2?.scopes[0], 'foo');\n\t\tassert.notStrictEqual(session1.accessToken, session2?.accessToken);\n\t});\n\n\t//#region Multi-Account AuthProvider\n\n\ttest('clearSessionPreference - true', async () => {\n\t\tconst scopes = ['foo'];\n\t\t// Now create the session\n\t\tconst session = await extHostAuthentication.getSession(\n\t\t\textensionDescription,\n\t\t\t'test-multiple',\n\t\t\tscopes,\n\t\t\t{\n\t\t\t\tcreateIfNone: true\n\t\t\t});\n\n\t\tassert.strictEqual(session?.id, '1');\n\t\tassert.strictEqual(session?.scopes[0], scopes[0]);\n\n\t\tconst scopes2 = ['bar'];\n\t\tconst session2 = await extHostAuthentication.getSession(\n\t\t\textensionDescription,\n\t\t\t'test-multiple',\n\t\t\tscopes2,\n\t\t\t{\n\t\t\t\tcreateIfNone: true\n\t\t\t});\n\t\tassert.strictEqual(session2?.id, '2');\n\t\tassert.strictEqual(session2?.scopes[0], scopes2[0]);\n\n\t\tconst session3 = await extHostAuthentication.getSession(\n\t\t\textensionDescription,\n\t\t\t'test-multiple',\n\t\t\t['return multiple'],\n\t\t\t{\n\t\t\t\tclearSessionPreference: true,\n\t\t\t\tcreateIfNone: true\n\t\t\t});\n\n\t\t// clearing session preference causes us to get the first session\n\t\t// because it would normally show a quick pick for the user to choose\n\t\tassert.strictEqual(session3?.id, session.id);\n\t\tassert.strictEqual(session3?.scopes[0], session.scopes[0]);\n\t\tassert.strictEqual(session3?.accessToken, session.accessToken);\n\t});\n\n\ttest('silently getting session should return a session (if any) regardless of preference - fixes #137819', async () => {\n\t\tconst scopes = ['foo'];\n\t\t// Now create the session\n\t\tconst session = await extHostAuthentication.getSession(\n\t\t\textensionDescription,\n\t\t\t'test-multiple',\n\t\t\tscopes,\n\t\t\t{\n\t\t\t\tcreateIfNone: true\n\t\t\t});\n\n\t\tassert.strictEqual(session?.id, '1');\n\t\tassert.strictEqual(session?.scopes[0], scopes[0]);\n\n\t\tconst scopes2 = ['bar'];\n\t\tconst session2 = await extHostAuthentication.getSession(\n\t\t\textensionDescription,\n\t\t\t'test-multiple',\n\t\t\tscopes2,\n\t\t\t{\n\t\t\t\tcreateIfNone: true\n\t\t\t});\n\t\tassert.strictEqual(session2?.id, '2');\n\t\tassert.strictEqual(session2?.scopes[0], scopes2[0]);\n\n\t\tconst shouldBeSession1 = await extHostAuthentication.getSession(\n\t\t\textensionDescription,\n\t\t\t'test-multiple',\n\t\t\tscopes,\n\t\t\t{});\n\t\tassert.strictEqual(shouldBeSession1?.id, session.id);\n\t\tassert.strictEqual(shouldBeSession1?.scopes[0], session.scopes[0]);\n\t\tassert.strictEqual(shouldBeSession1?.accessToken, session.accessToken);\n\n\t\tconst shouldBeSession2 = await extHostAuthentication.getSession(\n\t\t\textensionDescription,\n\t\t\t'test-multiple',\n\t\t\tscopes2,\n\t\t\t{});\n\t\tassert.strictEqual(shouldBeSession2?.id, session2.id);\n\t\tassert.strictEqual(shouldBeSession2?.scopes[0], session2.scopes[0]);\n\t\tassert.strictEqual(shouldBeSession2?.accessToken, session2.accessToken);\n\t});\n\n\t//#endregion\n\n\t//#region error cases\n\n\ttest('createIfNone and forceNewSession', async () => {\n\t\ttry {\n\t\t\tawait extHostAuthentication.getSession(\n\t\t\t\textensionDescription,\n\t\t\t\t'test',\n\t\t\t\t['foo'],\n\t\t\t\t{\n\t\t\t\t\tcreateIfNone: true,\n\t\t\t\t\tforceNewSession: true\n\t\t\t\t});\n\t\t\tassert.fail('should have thrown an Error.');\n\t\t} catch (e) {\n\t\t\tassert.ok(e);\n\t\t}\n\t});\n\n\ttest('forceNewSession and silent', async () => {\n\t\ttry {\n\t\t\tawait extHostAuthentication.getSession(\n\t\t\t\textensionDescription,\n\t\t\t\t'test',\n\t\t\t\t['foo'],\n\t\t\t\t{\n\t\t\t\t\tforceNewSession: true,\n\t\t\t\t\tsilent: true\n\t\t\t\t});\n\t\t\tassert.fail('should have thrown an Error.');\n\t\t} catch (e) {\n\t\t\tassert.ok(e);\n\t\t}\n\t});\n\n\ttest('createIfNone and silent', async () => {\n\t\ttry {\n\t\t\tawait extHostAuthentication.getSession(\n\t\t\t\textensionDescription,\n\t\t\t\t'test',\n\t\t\t\t['foo'],\n\t\t\t\t{\n\t\t\t\t\tcreateIfNone: true,\n\t\t\t\t\tsilent: true\n\t\t\t\t});\n\t\t\tassert.fail('should have thrown an Error.');\n\t\t} catch (e) {\n\t\t\tassert.ok(e);\n\t\t}\n\t});\n\n\ttest('Can get multiple sessions (with different scopes) in one extension', async () => {\n\t\tlet session: AuthenticationSession | undefined = await extHostAuthentication.getSession(\n\t\t\textensionDescription,\n\t\t\t'test-multiple',\n\t\t\t['foo'],\n\t\t\t{\n\t\t\t\tcreateIfNone: true\n\t\t\t});\n\t\tsession = await extHostAuthentication.getSession(\n\t\t\textensionDescription,\n\t\t\t'test-multiple',\n\t\t\t['bar'],\n\t\t\t{\n\t\t\t\tcreateIfNone: true\n\t\t\t});\n\t\tassert.strictEqual(session?.id, '2');\n\t\tassert.strictEqual(session?.scopes[0], 'bar');\n\n\t\tsession = await extHostAuthentication.getSession(\n\t\t\textensionDescription,\n\t\t\t'test-multiple',\n\t\t\t['foo'],\n\t\t\t{\n\t\t\t\tcreateIfNone: false\n\t\t\t});\n\t\tassert.strictEqual(session?.id, '1');\n\t\tassert.strictEqual(session?.scopes[0], 'foo');\n\t});\n\n\ttest('Can get multiple sessions (from different providers) in one extension', async () => {\n\t\tlet session: AuthenticationSession | undefined = await extHostAuthentication.getSession(\n\t\t\textensionDescription,\n\t\t\t'test-multiple',\n\t\t\t['foo'],\n\t\t\t{\n\t\t\t\tcreateIfNone: true\n\t\t\t});\n\t\tsession = await extHostAuthentication.getSession(\n\t\t\textensionDescription,\n\t\t\t'test',\n\t\t\t['foo'],\n\t\t\t{\n\t\t\t\tcreateIfNone: true\n\t\t\t});\n\t\tassert.strictEqual(session?.id, '1');\n\t\tassert.strictEqual(session?.scopes[0], 'foo');\n\t\tassert.strictEqual(session?.account.label, 'test');\n\n\t\tconst session2 = await extHostAuthentication.getSession(\n\t\t\textensionDescription,\n\t\t\t'test-multiple',\n\t\t\t['foo'],\n\t\t\t{\n\t\t\t\tcreateIfNone: false\n\t\t\t});\n\t\tassert.strictEqual(session2?.id, '1');\n\t\tassert.strictEqual(session2?.scopes[0], 'foo');\n\t\tassert.strictEqual(session2?.account.label, 'test-multiple');\n\t});\n\n\ttest('Can get multiple sessions (from different providers) in one extension at the same time', async () => {\n\t\tconst sessionP: Promise<AuthenticationSession | undefined> = extHostAuthentication.getSession(\n\t\t\textensionDescription,\n\t\t\t'test',\n\t\t\t['foo'],\n\t\t\t{\n\t\t\t\tcreateIfNone: true\n\t\t\t});\n\t\tconst session2P: Promise<AuthenticationSession | undefined> = extHostAuthentication.getSession(\n\t\t\textensionDescription,\n\t\t\t'test-multiple',\n\t\t\t['foo'],\n\t\t\t{\n\t\t\t\tcreateIfNone: true\n\t\t\t});\n\t\tconst session = await sessionP;\n\t\tassert.strictEqual(session?.id, '1');\n\t\tassert.strictEqual(session?.scopes[0], 'foo');\n\t\tassert.strictEqual(session?.account.label, 'test');\n\n\t\tconst session2 = await session2P;\n\t\tassert.strictEqual(session2?.id, '1');\n\t\tassert.strictEqual(session2?.scopes[0], 'foo');\n\t\tassert.strictEqual(session2?.account.label, 'test-multiple');\n\t});\n\n\n\t//#endregion\n\n\t//#region Race Condition and Sequencing Tests\n\n\ttest('concurrent operations on same provider are serialized', async () => {\n\t\tconst provider = new TestAuthProvider('concurrent-test');\n\t\tconst operationOrder: string[] = [];\n\n\t\t// Mock the provider methods to track operation order\n\t\tconst originalCreateSession = provider.createSession.bind(provider);\n\t\tconst originalGetSessions = provider.getSessions.bind(provider);\n\n\t\tprovider.createSession = async (scopes) => {\n\t\t\toperationOrder.push(`create-start-${scopes[0]}`);\n\t\t\tawait new Promise(resolve => setTimeout(resolve, 20)); // Simulate async work\n\t\t\tconst result = await originalCreateSession(scopes);\n\t\t\toperationOrder.push(`create-end-${scopes[0]}`);\n\t\t\treturn result;\n\t\t};\n\n\t\tprovider.getSessions = async (scopes) => {\n\t\t\tconst scopeKey = scopes ? scopes[0] : 'all';\n\t\t\toperationOrder.push(`get-start-${scopeKey}`);\n\t\t\tawait new Promise(resolve => setTimeout(resolve, 10)); // Simulate async work\n\t\t\tconst result = await originalGetSessions(scopes);\n\t\t\toperationOrder.push(`get-end-${scopeKey}`);\n\t\t\treturn result;\n\t\t};\n\n\t\tconst disposable = extHostAuthentication.registerAuthenticationProvider('concurrent-test', 'Concurrent Test', provider);\n\t\tdisposables.add(disposable);\n\n\t\t// Start multiple operations simultaneously on the same provider\n\t\tconst promises = [\n\t\t\textHostAuthentication.getSession(extensionDescription, 'concurrent-test', ['scope1'], { createIfNone: true }),\n\t\t\textHostAuthentication.getSession(extensionDescription, 'concurrent-test', ['scope2'], { createIfNone: true }),\n\t\t\textHostAuthentication.getSession(extensionDescription, 'concurrent-test', ['scope1'], {}) // This should get the existing session\n\t\t];\n\n\t\tawait Promise.all(promises);\n\n\t\t// Verify that operations were serialized - no overlapping operations\n\t\t// Build a map of operation starts to their corresponding ends\n\t\tconst operationPairs: Array<{ start: number; end: number; operation: string }> = [];\n\n\t\tfor (let i = 0; i < operationOrder.length; i++) {\n\t\t\tconst current = operationOrder[i];\n\t\t\tif (current.includes('-start-')) {\n\t\t\t\tconst scope = current.split('-start-')[1];\n\t\t\t\tconst operationType = current.split('-start-')[0];\n\t\t\t\tconst endOperation = `${operationType}-end-${scope}`;\n\t\t\t\tconst endIndex = operationOrder.indexOf(endOperation, i + 1);\n\n\t\t\t\tif (endIndex !== -1) {\n\t\t\t\t\toperationPairs.push({\n\t\t\t\t\t\tstart: i,\n\t\t\t\t\t\tend: endIndex,\n\t\t\t\t\t\toperation: `${operationType}-${scope}`\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// Verify no operations overlap (serialization)\n\t\tfor (let i = 0; i < operationPairs.length; i++) {\n\t\t\tfor (let j = i + 1; j < operationPairs.length; j++) {\n\t\t\t\tconst op1 = operationPairs[i];\n\t\t\t\tconst op2 = operationPairs[j];\n\n\t\t\t\t// Operations should not overlap - one should completely finish before the other starts\n\t\t\t\tconst op1EndsBeforeOp2Starts = op1.end < op2.start;\n\t\t\t\tconst op2EndsBeforeOp1Starts = op2.end < op1.start;\n\n\t\t\t\tassert.ok(op1EndsBeforeOp2Starts || op2EndsBeforeOp1Starts,\n\t\t\t\t\t`Operations ${op1.operation} and ${op2.operation} should not overlap. ` +\n\t\t\t\t\t`Op1: ${op1.start}-${op1.end}, Op2: ${op2.start}-${op2.end}. ` +\n\t\t\t\t\t`Order: [${operationOrder.join(', ')}]`);\n\t\t\t}\n\t\t}\n\n\t\t// Verify we have the expected operations\n\t\tassert.ok(operationOrder.includes('create-start-scope1'), 'Should have created session for scope1');\n\t\tassert.ok(operationOrder.includes('create-end-scope1'), 'Should have completed creating session for scope1');\n\t\tassert.ok(operationOrder.includes('create-start-scope2'), 'Should have created session for scope2');\n\t\tassert.ok(operationOrder.includes('create-end-scope2'), 'Should have completed creating session for scope2');\n\n\t\t// The third call should use getSessions to find the existing scope1 session\n\t\tassert.ok(operationOrder.includes('get-start-scope1'), 'Should have called getSessions for existing scope1 session');\n\t\tassert.ok(operationOrder.includes('get-end-scope1'), 'Should have completed getSessions for existing scope1 session');\n\t});\n\n\ttest('provider registration and immediate disposal race condition', async () => {\n\t\tconst provider = new TestAuthProvider('race-test');\n\n\t\t// Register and immediately dispose\n\t\tconst disposable = extHostAuthentication.registerAuthenticationProvider('race-test', 'Race Test', provider);\n\t\tdisposable.dispose();\n\n\t\t// Try to use the provider after disposal - should fail gracefully\n\t\ttry {\n\t\t\tawait extHostAuthentication.getSession(extensionDescription, 'race-test', ['scope'], { createIfNone: true });\n\t\t\tassert.fail('Should have thrown an error for non-existent provider');\n\t\t} catch (error) {\n\t\t\t// Expected - provider should be unavailable\n\t\t\tassert.ok(error);\n\t\t}\n\t});\n\n\ttest('provider re-registration after proper disposal', async () => {\n\t\tconst provider1 = new TestAuthProvider('reregister-test-1');\n\t\tconst provider2 = new TestAuthProvider('reregister-test-2');\n\n\t\t// First registration\n\t\tconst disposable1 = extHostAuthentication.registerAuthenticationProvider('reregister-test', 'Provider 1', provider1);\n\n\t\t// Create a session with first provider\n\t\tconst session1 = await extHostAuthentication.getSession(extensionDescription, 'reregister-test', ['scope'], { createIfNone: true });\n\t\tassert.strictEqual(session1?.account.label, 'reregister-test-1');\n\n\t\t// Dispose first provider\n\t\tdisposable1.dispose();\n\n\t\t// Re-register with different provider\n\t\tconst disposable2 = extHostAuthentication.registerAuthenticationProvider('reregister-test', 'Provider 2', provider2);\n\t\tdisposables.add(disposable2);\n\n\t\t// Create session with second provider\n\t\tconst session2 = await extHostAuthentication.getSession(extensionDescription, 'reregister-test', ['scope'], { createIfNone: true });\n\t\tassert.strictEqual(session2?.account.label, 'reregister-test-2');\n\t\tassert.notStrictEqual(session1?.accessToken, session2?.accessToken);\n\t});\n\n\ttest('session operations during provider lifecycle changes', async () => {\n\t\tconst provider = new TestAuthProvider('lifecycle-test');\n\t\tconst disposable = extHostAuthentication.registerAuthenticationProvider('lifecycle-test', 'Lifecycle Test', provider);\n\n\t\t// Start a session creation\n\t\tconst sessionPromise = extHostAuthentication.getSession(extensionDescription, 'lifecycle-test', ['scope'], { createIfNone: true });\n\n\t\t// Don't dispose immediately - let the session creation start\n\t\tawait new Promise(resolve => setTimeout(resolve, 5));\n\n\t\t// Dispose the provider while the session creation is likely still in progress\n\t\tdisposable.dispose();\n\n\t\t// The session creation should complete successfully even if we dispose during the operation\n\t\tconst session = await sessionPromise;\n\t\tassert.ok(session);\n\t\tassert.strictEqual(session.account.label, 'lifecycle-test');\n\t});\n\n\ttest('operations on different providers run concurrently', async () => {\n\t\tconst provider1 = new TestAuthProvider('concurrent-1');\n\t\tconst provider2 = new TestAuthProvider('concurrent-2');\n\n\t\tlet provider1Started = false;\n\t\tlet provider2Started = false;\n\t\tlet provider1Finished = false;\n\t\tlet provider2Finished = false;\n\t\tlet concurrencyVerified = false;\n\n\t\t// Override createSession to track timing\n\t\tconst originalCreate1 = provider1.createSession.bind(provider1);\n\t\tconst originalCreate2 = provider2.createSession.bind(provider2);\n\n\t\tprovider1.createSession = async (scopes) => {\n\t\t\tprovider1Started = true;\n\t\t\tawait new Promise(resolve => setTimeout(resolve, 20));\n\t\t\tconst result = await originalCreate1(scopes);\n\t\t\tprovider1Finished = true;\n\t\t\treturn result;\n\t\t};\n\n\t\tprovider2.createSession = async (scopes) => {\n\t\t\tprovider2Started = true;\n\t\t\t// Provider 2 should start before provider 1 finishes (concurrent execution)\n\t\t\tif (provider1Started && !provider1Finished) {\n\t\t\t\tconcurrencyVerified = true;\n\t\t\t}\n\t\t\tawait new Promise(resolve => setTimeout(resolve, 10));\n\t\t\tconst result = await originalCreate2(scopes);\n\t\t\tprovider2Finished = true;\n\t\t\treturn result;\n\t\t};\n\n\t\tconst disposable1 = extHostAuthentication.registerAuthenticationProvider('concurrent-1', 'Concurrent 1', provider1);\n\t\tconst disposable2 = extHostAuthentication.registerAuthenticationProvider('concurrent-2', 'Concurrent 2', provider2);\n\t\tdisposables.add(disposable1);\n\t\tdisposables.add(disposable2);\n\n\t\t// Start operations on both providers simultaneously\n\t\tconst [session1, session2] = await Promise.all([\n\t\t\textHostAuthentication.getSession(extensionDescription, 'concurrent-1', ['scope'], { createIfNone: true }),\n\t\t\textHostAuthentication.getSession(extensionDescription, 'concurrent-2', ['scope'], { createIfNone: true })\n\t\t]);\n\n\t\t// Verify both operations completed successfully\n\t\tassert.ok(session1);\n\t\tassert.ok(session2);\n\t\tassert.ok(provider1Started, 'Provider 1 should have started');\n\t\tassert.ok(provider2Started, 'Provider 2 should have started');\n\t\tassert.ok(provider1Finished, 'Provider 1 should have finished');\n\t\tassert.ok(provider2Finished, 'Provider 2 should have finished');\n\t\tassert.strictEqual(session1.account.label, 'concurrent-1');\n\t\tassert.strictEqual(session2.account.label, 'concurrent-2');\n\n\t\t// Verify that operations ran concurrently (provider 2 started while provider 1 was still running)\n\t\tassert.ok(concurrencyVerified, 'Operations should have run concurrently - provider 2 should start while provider 1 is still running');\n\t});\n\n\t//#endregion\n});\n"]}