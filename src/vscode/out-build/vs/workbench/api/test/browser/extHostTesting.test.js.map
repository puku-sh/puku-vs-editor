{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/api/test/browser/extHostTesting.test.ts","vs/workbench/api/test/browser/extHostTesting.test.ts"],"names":[],"mappings":"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","file":"extHostTesting.test.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport assert from 'assert';\nimport * as sinon from 'sinon';\nimport { timeout } from '../../../../base/common/async.js';\nimport { VSBuffer } from '../../../../base/common/buffer.js';\nimport { CancellationTokenSource } from '../../../../base/common/cancellation.js';\nimport { Event } from '../../../../base/common/event.js';\nimport { Iterable } from '../../../../base/common/iterator.js';\nimport { URI } from '../../../../base/common/uri.js';\nimport { mock, mockObject, MockObject } from '../../../../base/test/common/mock.js';\nimport { ensureNoDisposablesAreLeakedInTestSuite } from '../../../../base/test/common/utils.js';\nimport * as editorRange from '../../../../editor/common/core/range.js';\nimport { ExtensionIdentifier, IExtensionDescription } from '../../../../platform/extensions/common/extensions.js';\nimport { NullLogService } from '../../../../platform/log/common/log.js';\nimport { MainThreadTestingShape } from '../../common/extHost.protocol.js';\nimport { ExtHostCommands } from '../../common/extHostCommands.js';\nimport { ExtHostDocumentsAndEditors } from '../../common/extHostDocumentsAndEditors.js';\nimport { IExtHostTelemetry } from '../../common/extHostTelemetry.js';\nimport { ExtHostTesting, TestRunCoordinator, TestRunDto, TestRunProfileImpl } from '../../common/extHostTesting.js';\nimport { ExtHostTestItemCollection, TestItemImpl } from '../../common/extHostTestItem.js';\nimport * as convert from '../../common/extHostTypeConverters.js';\nimport { Location, Position, Range, TestMessage, TestRunProfileKind, TestRunRequest as TestRunRequestImpl, TestTag } from '../../common/extHostTypes.js';\nimport { AnyCallRPCProtocol } from '../common/testRPCProtocol.js';\nimport { TestId } from '../../../contrib/testing/common/testId.js';\nimport { TestDiffOpType, TestItemExpandState, TestMessageType, TestsDiff } from '../../../contrib/testing/common/testTypes.js';\nimport { nullExtensionDescription } from '../../../services/extensions/common/extensions.js';\nimport type { TestController, TestItem, TestRunProfile, TestRunRequest } from 'vscode';\n\nconst simplify = (item: TestItem) => ({\n\tid: item.id,\n\tlabel: item.label,\n\turi: item.uri,\n\trange: item.range,\n});\n\nconst assertTreesEqual = (a: TestItemImpl | undefined, b: TestItemImpl | undefined) => {\n\tif (!a) {\n\t\tthrow new assert.AssertionError({ message: 'Expected a to be defined', actual: a });\n\t}\n\n\tif (!b) {\n\t\tthrow new assert.AssertionError({ message: 'Expected b to be defined', actual: b });\n\t}\n\n\tassert.deepStrictEqual(simplify(a), simplify(b));\n\n\tconst aChildren = [...a.children].map(([_, c]) => c.id).sort();\n\tconst bChildren = [...b.children].map(([_, c]) => c.id).sort();\n\tassert.strictEqual(aChildren.length, bChildren.length, `expected ${a.label}.children.length == ${b.label}.children.length`);\n\taChildren.forEach(key => assertTreesEqual(a.children.get(key) as TestItemImpl, b.children.get(key) as TestItemImpl));\n};\n\n// const assertTreeListEqual = (a: ReadonlyArray<TestItem>, b: ReadonlyArray<TestItem>) => {\n// \tassert.strictEqual(a.length, b.length, `expected a.length == n.length`);\n// \ta.forEach((_, i) => assertTreesEqual(a[i], b[i]));\n// };\n\n// class TestMirroredCollection extends MirroredTestCollection {\n// \tpublic changeEvent!: TestChangeEvent;\n\n// \tconstructor() {\n// \t\tsuper();\n// \t\tthis.onDidChangeTests(evt => this.changeEvent = evt);\n// \t}\n\n// \tpublic get length() {\n// \t\treturn this.items.size;\n// \t}\n// }\n\nsuite('ExtHost Testing', () => {\n\tclass TestExtHostTestItemCollection extends ExtHostTestItemCollection {\n\t\tpublic setDiff(diff: TestsDiff) {\n\t\t\tthis.diff = diff;\n\t\t}\n\t}\n\n\tteardown(() => {\n\t\tsinon.restore();\n\t});\n\n\tconst ds = ensureNoDisposablesAreLeakedInTestSuite();\n\n\tlet single: TestExtHostTestItemCollection;\n\tlet resolveCalls: (string | undefined)[] = [];\n\tsetup(() => {\n\t\tresolveCalls = [];\n\t\tsingle = ds.add(new TestExtHostTestItemCollection('ctrlId', 'root', {\n\t\t\tgetDocument: () => undefined,\n\t\t} as Partial<ExtHostDocumentsAndEditors> as ExtHostDocumentsAndEditors));\n\t\tsingle.resolveHandler = item => {\n\t\t\tresolveCalls.push(item?.id);\n\t\t\tif (item === undefined) {\n\t\t\t\tconst a = new TestItemImpl('ctrlId', 'id-a', 'a', URI.file('/'));\n\t\t\t\ta.canResolveChildren = true;\n\t\t\t\tconst b = new TestItemImpl('ctrlId', 'id-b', 'b', URI.file('/'));\n\t\t\t\tsingle.root.children.add(a);\n\t\t\t\tsingle.root.children.add(b);\n\t\t\t} else if (item.id === 'id-a') {\n\t\t\t\titem.children.add(new TestItemImpl('ctrlId', 'id-aa', 'aa', URI.file('/')));\n\t\t\t\titem.children.add(new TestItemImpl('ctrlId', 'id-ab', 'ab', URI.file('/')));\n\t\t\t}\n\t\t};\n\n\t\tds.add(single.onDidGenerateDiff(d => single.setDiff(d /* don't clear during testing */)));\n\t});\n\n\tsuite('OwnedTestCollection', () => {\n\t\ttest('adds a root recursively', async () => {\n\t\t\tawait single.expand(single.root.id, Infinity);\n\t\t\tconst a = single.root.children.get('id-a') as TestItemImpl;\n\t\t\tconst b = single.root.children.get('id-b') as TestItemImpl;\n\t\t\tassert.deepStrictEqual(single.collectDiff(), [\n\t\t\t\t{\n\t\t\t\t\top: TestDiffOpType.Add,\n\t\t\t\t\titem: { controllerId: 'ctrlId', expand: TestItemExpandState.BusyExpanding, item: { ...convert.TestItem.from(single.root) } }\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\top: TestDiffOpType.Add,\n\t\t\t\t\titem: { controllerId: 'ctrlId', expand: TestItemExpandState.BusyExpanding, item: { ...convert.TestItem.from(a) } }\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\top: TestDiffOpType.Add,\n\t\t\t\t\titem: { controllerId: 'ctrlId', expand: TestItemExpandState.NotExpandable, item: convert.TestItem.from(a.children.get('id-aa') as TestItemImpl) }\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\top: TestDiffOpType.Add,\n\t\t\t\t\titem: { controllerId: 'ctrlId', expand: TestItemExpandState.NotExpandable, item: convert.TestItem.from(a.children.get('id-ab') as TestItemImpl) }\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\top: TestDiffOpType.Update,\n\t\t\t\t\titem: { extId: new TestId(['ctrlId', 'id-a']).toString(), expand: TestItemExpandState.Expanded }\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\top: TestDiffOpType.Add,\n\t\t\t\t\titem: { controllerId: 'ctrlId', expand: TestItemExpandState.NotExpandable, item: convert.TestItem.from(b) }\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\top: TestDiffOpType.Update,\n\t\t\t\t\titem: { extId: single.root.id, expand: TestItemExpandState.Expanded }\n\t\t\t\t},\n\t\t\t]);\n\t\t});\n\n\t\ttest('parents are set correctly', () => {\n\t\t\tsingle.expand(single.root.id, Infinity);\n\t\t\tsingle.collectDiff();\n\n\t\t\tconst a = single.root.children.get('id-a')!;\n\t\t\tconst ab = a.children.get('id-ab')!;\n\t\t\tassert.strictEqual(a.parent, undefined);\n\t\t\tassert.strictEqual(ab.parent, a);\n\t\t});\n\n\t\ttest('can add an item with same ID as root', () => {\n\t\t\tsingle.collectDiff();\n\n\t\t\tconst child = new TestItemImpl('ctrlId', 'ctrlId', 'c', undefined);\n\t\t\tsingle.root.children.add(child);\n\t\t\tassert.deepStrictEqual(single.collectDiff(), [\n\t\t\t\t{\n\t\t\t\t\top: TestDiffOpType.Add,\n\t\t\t\t\titem: { controllerId: 'ctrlId', expand: TestItemExpandState.NotExpandable, item: convert.TestItem.from(child) },\n\t\t\t\t}\n\t\t\t]);\n\t\t});\n\n\t\ttest('no-ops if items not changed', () => {\n\t\t\tsingle.collectDiff();\n\t\t\tassert.deepStrictEqual(single.collectDiff(), []);\n\t\t});\n\n\t\ttest('watches property mutations', () => {\n\t\t\tsingle.expand(single.root.id, Infinity);\n\t\t\tsingle.collectDiff();\n\t\t\tsingle.root.children.get('id-a')!.description = 'Hello world'; /* item a */\n\n\t\t\tassert.deepStrictEqual(single.collectDiff(), [\n\t\t\t\t{\n\t\t\t\t\top: TestDiffOpType.Update,\n\t\t\t\t\titem: { extId: new TestId(['ctrlId', 'id-a']).toString(), item: { description: 'Hello world' } },\n\t\t\t\t}\n\t\t\t]);\n\t\t});\n\n\t\ttest('removes children', () => {\n\t\t\tsingle.expand(single.root.id, Infinity);\n\t\t\tsingle.collectDiff();\n\t\t\tsingle.root.children.delete('id-a');\n\n\t\t\tassert.deepStrictEqual(single.collectDiff(), [\n\t\t\t\t{ op: TestDiffOpType.Remove, itemId: new TestId(['ctrlId', 'id-a']).toString() },\n\t\t\t]);\n\t\t\tassert.deepStrictEqual(\n\t\t\t\t[...single.tree.keys()].sort(),\n\t\t\t\t[single.root.id, new TestId(['ctrlId', 'id-b']).toString()],\n\t\t\t);\n\t\t\tassert.strictEqual(single.tree.size, 2);\n\t\t});\n\n\t\ttest('adds new children', () => {\n\t\t\tsingle.expand(single.root.id, Infinity);\n\t\t\tsingle.collectDiff();\n\t\t\tconst child = new TestItemImpl('ctrlId', 'id-ac', 'c', undefined);\n\t\t\tsingle.root.children.get('id-a')!.children.add(child);\n\n\t\t\tassert.deepStrictEqual(single.collectDiff(), [\n\t\t\t\t{\n\t\t\t\t\top: TestDiffOpType.Add, item: {\n\t\t\t\t\t\tcontrollerId: 'ctrlId',\n\t\t\t\t\t\texpand: TestItemExpandState.NotExpandable,\n\t\t\t\t\t\titem: convert.TestItem.from(child),\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t]);\n\t\t\tassert.deepStrictEqual(\n\t\t\t\t[...single.tree.values()].map(n => n.actual.id).sort(),\n\t\t\t\t[single.root.id, 'id-a', 'id-aa', 'id-ab', 'id-ac', 'id-b'],\n\t\t\t);\n\t\t\tassert.strictEqual(single.tree.size, 6);\n\t\t});\n\n\t\ttest('manages tags correctly', () => {\n\t\t\tsingle.expand(single.root.id, Infinity);\n\t\t\tsingle.collectDiff();\n\t\t\tconst tag1 = new TestTag('tag1');\n\t\t\tconst tag2 = new TestTag('tag2');\n\t\t\tconst tag3 = new TestTag('tag3');\n\t\t\tconst child = new TestItemImpl('ctrlId', 'id-ac', 'c', undefined);\n\t\t\tchild.tags = [tag1, tag2];\n\t\t\tsingle.root.children.get('id-a')!.children.add(child);\n\n\t\t\tassert.deepStrictEqual(single.collectDiff(), [\n\t\t\t\t{ op: TestDiffOpType.AddTag, tag: { id: 'ctrlId\\0tag1' } },\n\t\t\t\t{ op: TestDiffOpType.AddTag, tag: { id: 'ctrlId\\0tag2' } },\n\t\t\t\t{\n\t\t\t\t\top: TestDiffOpType.Add, item: {\n\t\t\t\t\t\tcontrollerId: 'ctrlId',\n\t\t\t\t\t\texpand: TestItemExpandState.NotExpandable,\n\t\t\t\t\t\titem: convert.TestItem.from(child),\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t]);\n\n\t\t\tchild.tags = [tag2, tag3];\n\t\t\tassert.deepStrictEqual(single.collectDiff(), [\n\t\t\t\t{ op: TestDiffOpType.AddTag, tag: { id: 'ctrlId\\0tag3' } },\n\t\t\t\t{\n\t\t\t\t\top: TestDiffOpType.Update, item: {\n\t\t\t\t\t\textId: new TestId(['ctrlId', 'id-a', 'id-ac']).toString(),\n\t\t\t\t\t\titem: { tags: ['ctrlId\\0tag2', 'ctrlId\\0tag3'] }\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t{ op: TestDiffOpType.RemoveTag, id: 'ctrlId\\0tag1' },\n\t\t\t]);\n\n\t\t\tconst a = single.root.children.get('id-a')!;\n\t\t\ta.tags = [tag2];\n\t\t\ta.children.replace([]);\n\t\t\tassert.deepStrictEqual(single.collectDiff().filter(t => t.op === TestDiffOpType.RemoveTag), [\n\t\t\t\t{ op: TestDiffOpType.RemoveTag, id: 'ctrlId\\0tag3' },\n\t\t\t]);\n\t\t});\n\n\t\ttest('replaces on uri change', () => {\n\t\t\tsingle.expand(single.root.id, Infinity);\n\t\t\tsingle.collectDiff();\n\n\t\t\tconst oldA = single.root.children.get('id-a') as TestItemImpl;\n\t\t\tconst uri = single.root.children.get('id-a')!.uri?.with({ path: '/different' });\n\t\t\tconst newA = new TestItemImpl('ctrlId', 'id-a', 'Hello world', uri);\n\t\t\tnewA.children.replace([...oldA.children].map(([_, item]) => item));\n\t\t\tsingle.root.children.replace([...single.root.children].map(([id, i]) => id === 'id-a' ? newA : i));\n\n\t\t\tassert.deepStrictEqual(single.collectDiff(), [\n\t\t\t\t{ op: TestDiffOpType.Remove, itemId: new TestId(['ctrlId', 'id-a']).toString() },\n\t\t\t\t{\n\t\t\t\t\top: TestDiffOpType.Add,\n\t\t\t\t\titem: { controllerId: 'ctrlId', expand: TestItemExpandState.NotExpandable, item: { ...convert.TestItem.from(newA) } }\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\top: TestDiffOpType.Add,\n\t\t\t\t\titem: { controllerId: 'ctrlId', expand: TestItemExpandState.NotExpandable, item: convert.TestItem.from(newA.children.get('id-aa') as TestItemImpl) }\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\top: TestDiffOpType.Add,\n\t\t\t\t\titem: { controllerId: 'ctrlId', expand: TestItemExpandState.NotExpandable, item: convert.TestItem.from(newA.children.get('id-ab') as TestItemImpl) }\n\t\t\t\t},\n\t\t\t]);\n\t\t});\n\n\t\ttest('treats in-place replacement as mutation', () => {\n\t\t\tsingle.expand(single.root.id, Infinity);\n\t\t\tsingle.collectDiff();\n\n\t\t\tconst oldA = single.root.children.get('id-a') as TestItemImpl;\n\t\t\tconst uri = single.root.children.get('id-a')!.uri;\n\t\t\tconst newA = new TestItemImpl('ctrlId', 'id-a', 'Hello world', uri);\n\t\t\tnewA.children.replace([...oldA.children].map(([_, item]) => item));\n\t\t\tsingle.root.children.replace([\n\t\t\t\tnewA,\n\t\t\t\tnew TestItemImpl('ctrlId', 'id-b', single.root.children.get('id-b')!.label, uri),\n\t\t\t]);\n\n\t\t\tassert.deepStrictEqual(single.collectDiff(), [\n\t\t\t\t{\n\t\t\t\t\top: TestDiffOpType.Update,\n\t\t\t\t\titem: { extId: new TestId(['ctrlId', 'id-a']).toString(), item: { label: 'Hello world' } },\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\top: TestDiffOpType.DocumentSynced,\n\t\t\t\t\tdocv: undefined,\n\t\t\t\t\turi: uri\n\t\t\t\t}\n\t\t\t]);\n\n\t\t\tnewA.label = 'still connected';\n\t\t\tassert.deepStrictEqual(single.collectDiff(), [\n\t\t\t\t{\n\t\t\t\t\top: TestDiffOpType.Update,\n\t\t\t\t\titem: { extId: new TestId(['ctrlId', 'id-a']).toString(), item: { label: 'still connected' } }\n\t\t\t\t},\n\t\t\t]);\n\n\t\t\toldA.label = 'no longer connected';\n\t\t\tassert.deepStrictEqual(single.collectDiff(), []);\n\t\t});\n\n\t\tsuite('expandibility restoration', () => {\n\t\t\tconst doReplace = async (canResolveChildren = true) => {\n\t\t\t\tconst uri = single.root.children.get('id-a')!.uri;\n\t\t\t\tconst newA = new TestItemImpl('ctrlId', 'id-a', 'Hello world', uri);\n\t\t\t\tnewA.canResolveChildren = canResolveChildren;\n\t\t\t\tsingle.root.children.replace([\n\t\t\t\t\tnewA,\n\t\t\t\t\tnew TestItemImpl('ctrlId', 'id-b', single.root.children.get('id-b')!.label, uri),\n\t\t\t\t]);\n\t\t\t\tawait timeout(0); // drain microtasks\n\t\t\t};\n\n\t\t\ttest('does not restore an unexpanded state', async () => {\n\t\t\t\tawait single.expand(single.root.id, 0);\n\t\t\t\tassert.deepStrictEqual(resolveCalls, [undefined]);\n\t\t\t\tawait doReplace();\n\t\t\t\tassert.deepStrictEqual(resolveCalls, [undefined]);\n\t\t\t});\n\n\t\t\ttest('restores resolve state on replacement', async () => {\n\t\t\t\tawait single.expand(single.root.id, Infinity);\n\t\t\t\tassert.deepStrictEqual(resolveCalls, [undefined, 'id-a']);\n\t\t\t\tawait doReplace();\n\t\t\t\tassert.deepStrictEqual(resolveCalls, [undefined, 'id-a', 'id-a']);\n\t\t\t});\n\n\t\t\ttest('does not expand if new child is not expandable', async () => {\n\t\t\t\tawait single.expand(single.root.id, Infinity);\n\t\t\t\tassert.deepStrictEqual(resolveCalls, [undefined, 'id-a']);\n\t\t\t\tawait doReplace(false);\n\t\t\t\tassert.deepStrictEqual(resolveCalls, [undefined, 'id-a']);\n\t\t\t});\n\t\t});\n\n\t\ttest('treats in-place replacement as mutation deeply', () => {\n\t\t\tsingle.expand(single.root.id, Infinity);\n\t\t\tsingle.collectDiff();\n\n\t\t\tconst oldA = single.root.children.get('id-a')!;\n\t\t\tconst uri = oldA.uri;\n\t\t\tconst newA = new TestItemImpl('ctrlId', 'id-a', single.root.children.get('id-a')!.label, uri);\n\t\t\tconst oldAA = oldA.children.get('id-aa')!;\n\t\t\tconst oldAB = oldA.children.get('id-ab')!;\n\t\t\tconst newAB = new TestItemImpl('ctrlId', 'id-ab', 'Hello world', uri);\n\t\t\tnewA.children.replace([oldAA, newAB]);\n\t\t\tsingle.root.children.replace([newA, single.root.children.get('id-b')!]);\n\n\t\t\tassert.deepStrictEqual(single.collectDiff(), [\n\t\t\t\t{\n\t\t\t\t\top: TestDiffOpType.Update,\n\t\t\t\t\titem: { extId: TestId.fromExtHostTestItem(oldAB, 'ctrlId').toString(), item: { label: 'Hello world' } },\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\top: TestDiffOpType.DocumentSynced,\n\t\t\t\t\tdocv: undefined,\n\t\t\t\t\turi: uri\n\t\t\t\t}\n\t\t\t]);\n\n\t\t\toldAA.label = 'still connected1';\n\t\t\tnewAB.label = 'still connected2';\n\t\t\toldAB.label = 'not connected3';\n\t\t\tassert.deepStrictEqual(single.collectDiff(), [\n\t\t\t\t{\n\t\t\t\t\top: TestDiffOpType.Update,\n\t\t\t\t\titem: { extId: new TestId(['ctrlId', 'id-a', 'id-aa']).toString(), item: { label: 'still connected1' } }\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\top: TestDiffOpType.Update,\n\t\t\t\t\titem: { extId: new TestId(['ctrlId', 'id-a', 'id-ab']).toString(), item: { label: 'still connected2' } }\n\t\t\t\t},\n\t\t\t]);\n\n\t\t\tassert.strictEqual(newAB.parent, newA);\n\t\t\tassert.strictEqual(oldAA.parent, newA);\n\t\t\tassert.deepStrictEqual(newA.parent, undefined);\n\t\t});\n\n\t\ttest('moves an item to be a new child', async () => {\n\t\t\tawait single.expand(single.root.id, 0);\n\t\t\tsingle.collectDiff();\n\t\t\tconst b = single.root.children.get('id-b') as TestItemImpl;\n\t\t\tconst a = single.root.children.get('id-a') as TestItemImpl;\n\t\t\ta.children.add(b);\n\t\t\tassert.deepStrictEqual(single.collectDiff(), [\n\t\t\t\t{\n\t\t\t\t\top: TestDiffOpType.Remove,\n\t\t\t\t\titemId: new TestId(['ctrlId', 'id-b']).toString(),\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\top: TestDiffOpType.Add,\n\t\t\t\t\titem: { controllerId: 'ctrlId', expand: TestItemExpandState.NotExpandable, item: convert.TestItem.from(b) }\n\t\t\t\t},\n\t\t\t]);\n\n\t\t\tb.label = 'still connected';\n\t\t\tassert.deepStrictEqual(single.collectDiff(), [\n\t\t\t\t{\n\t\t\t\t\top: TestDiffOpType.Update,\n\t\t\t\t\titem: { extId: new TestId(['ctrlId', 'id-a', 'id-b']).toString(), item: { label: 'still connected' } }\n\t\t\t\t},\n\t\t\t]);\n\n\t\t\tassert.deepStrictEqual([...single.root.children].map(([_, item]) => item), [single.root.children.get('id-a')]);\n\t\t\tassert.deepStrictEqual(b.parent, a);\n\t\t});\n\n\t\ttest('sends document sync events', async () => {\n\t\t\tawait single.expand(single.root.id, 0);\n\t\t\tsingle.collectDiff();\n\n\t\t\tconst a = single.root.children.get('id-a') as TestItemImpl;\n\t\t\ta.range = new Range(new Position(0, 0), new Position(1, 0));\n\n\t\t\tassert.deepStrictEqual(single.collectDiff(), [\n\t\t\t\t{\n\t\t\t\t\top: TestDiffOpType.DocumentSynced,\n\t\t\t\t\tdocv: undefined,\n\t\t\t\t\turi: URI.file('/')\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\top: TestDiffOpType.Update,\n\t\t\t\t\titem: {\n\t\t\t\t\t\textId: new TestId(['ctrlId', 'id-a']).toString(),\n\t\t\t\t\t\titem: {\n\t\t\t\t\t\t\trange: editorRange.Range.lift({\n\t\t\t\t\t\t\t\tendColumn: 1,\n\t\t\t\t\t\t\t\tendLineNumber: 2,\n\t\t\t\t\t\t\t\tstartColumn: 1,\n\t\t\t\t\t\t\t\tstartLineNumber: 1\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t]);\n\n\t\t\t// sends on replace even if it's a no-op\n\t\t\ta.range = a.range;\n\t\t\tassert.deepStrictEqual(single.collectDiff(), [\n\t\t\t\t{\n\t\t\t\t\top: TestDiffOpType.DocumentSynced,\n\t\t\t\t\tdocv: undefined,\n\t\t\t\t\turi: URI.file('/')\n\t\t\t\t},\n\t\t\t]);\n\n\t\t\t// sends on a child replacement\n\t\t\tconst uri = URI.file('/');\n\t\t\tconst a2 = new TestItemImpl('ctrlId', 'id-a', 'a', uri);\n\t\t\ta2.range = a.range;\n\t\t\tsingle.root.children.replace([a2, single.root.children.get('id-b')!]);\n\t\t\tassert.deepStrictEqual(single.collectDiff(), [\n\t\t\t\t{\n\t\t\t\t\top: TestDiffOpType.DocumentSynced,\n\t\t\t\t\tdocv: undefined,\n\t\t\t\t\turi\n\t\t\t\t},\n\t\t\t]);\n\t\t});\n\t});\n\n\n\tsuite('MirroredTestCollection', () => {\n\t\t// todo@connor4312: re-renable when we figure out what observing looks like we async children\n\t\t// \tlet m: TestMirroredCollection;\n\t\t// \tsetup(() => m = new TestMirroredCollection());\n\n\t\t// \ttest('mirrors creation of the root', () => {\n\t\t// \t\tconst tests = testStubs.nested();\n\t\t// \t\tsingle.addRoot(tests, 'pid');\n\t\t// \t\tsingle.expand(single.root.id, Infinity);\n\t\t// \t\tm.apply(single.collectDiff());\n\t\t// \t\tassertTreesEqual(m.rootTestItems[0], owned.getTestById(single.root.id)![1].actual);\n\t\t// \t\tassert.strictEqual(m.length, single.itemToInternal.size);\n\t\t// \t});\n\n\t\t// \ttest('mirrors node deletion', () => {\n\t\t// \t\tconst tests = testStubs.nested();\n\t\t// \t\tsingle.addRoot(tests, 'pid');\n\t\t// \t\tm.apply(single.collectDiff());\n\t\t// \t\tsingle.expand(single.root.id, Infinity);\n\t\t// \t\ttests.children!.splice(0, 1);\n\t\t// \t\tsingle.onItemChange(tests, 'pid');\n\t\t// \t\tsingle.expand(single.root.id, Infinity);\n\t\t// \t\tm.apply(single.collectDiff());\n\n\t\t// \t\tassertTreesEqual(m.rootTestItems[0], owned.getTestById(single.root.id)![1].actual);\n\t\t// \t\tassert.strictEqual(m.length, single.itemToInternal.size);\n\t\t// \t});\n\n\t\t// \ttest('mirrors node addition', () => {\n\t\t// \t\tconst tests = testStubs.nested();\n\t\t// \t\tsingle.addRoot(tests, 'pid');\n\t\t// \t\tm.apply(single.collectDiff());\n\t\t// \t\ttests.children![0].children!.push(stubTest('ac'));\n\t\t// \t\tsingle.onItemChange(tests, 'pid');\n\t\t// \t\tm.apply(single.collectDiff());\n\n\t\t// \t\tassertTreesEqual(m.rootTestItems[0], owned.getTestById(single.root.id)![1].actual);\n\t\t// \t\tassert.strictEqual(m.length, single.itemToInternal.size);\n\t\t// \t});\n\n\t\t// \ttest('mirrors node update', () => {\n\t\t// \t\tconst tests = testStubs.nested();\n\t\t// \t\tsingle.addRoot(tests, 'pid');\n\t\t// \t\tm.apply(single.collectDiff());\n\t\t// \t\ttests.children![0].description = 'Hello world'; /* item a */\n\t\t// \t\tsingle.onItemChange(tests, 'pid');\n\t\t// \t\tm.apply(single.collectDiff());\n\n\t\t// \t\tassertTreesEqual(m.rootTestItems[0], owned.getTestById(single.root.id)![1].actual);\n\t\t// \t});\n\n\t\t// \tsuite('MirroredChangeCollector', () => {\n\t\t// \t\tlet tests = testStubs.nested();\n\t\t// \t\tsetup(() => {\n\t\t// \t\t\ttests = testStubs.nested();\n\t\t// \t\t\tsingle.addRoot(tests, 'pid');\n\t\t// \t\t\tm.apply(single.collectDiff());\n\t\t// \t\t});\n\n\t\t// \t\ttest('creates change for root', () => {\n\t\t// \t\t\tassertTreeListEqual(m.changeEvent.added, [\n\t\t// \t\t\t\ttests,\n\t\t// \t\t\t\ttests.children[0],\n\t\t// \t\t\t\ttests.children![0].children![0],\n\t\t// \t\t\t\ttests.children![0].children![1],\n\t\t// \t\t\t\ttests.children[1],\n\t\t// \t\t\t]);\n\t\t// \t\t\tassertTreeListEqual(m.changeEvent.removed, []);\n\t\t// \t\t\tassertTreeListEqual(m.changeEvent.updated, []);\n\t\t// \t\t});\n\n\t\t// \t\ttest('creates change for delete', () => {\n\t\t// \t\t\tconst rm = tests.children.shift()!;\n\t\t// \t\t\tsingle.onItemChange(tests, 'pid');\n\t\t// \t\t\tm.apply(single.collectDiff());\n\n\t\t// \t\t\tassertTreeListEqual(m.changeEvent.added, []);\n\t\t// \t\t\tassertTreeListEqual(m.changeEvent.removed, [\n\t\t// \t\t\t\t{ ...rm },\n\t\t// \t\t\t\t{ ...rm.children![0] },\n\t\t// \t\t\t\t{ ...rm.children![1] },\n\t\t// \t\t\t]);\n\t\t// \t\t\tassertTreeListEqual(m.changeEvent.updated, []);\n\t\t// \t\t});\n\n\t\t// \t\ttest('creates change for update', () => {\n\t\t// \t\t\ttests.children[0].label = 'updated!';\n\t\t// \t\t\tsingle.onItemChange(tests, 'pid');\n\t\t// \t\t\tm.apply(single.collectDiff());\n\n\t\t// \t\t\tassertTreeListEqual(m.changeEvent.added, []);\n\t\t// \t\t\tassertTreeListEqual(m.changeEvent.removed, []);\n\t\t// \t\t\tassertTreeListEqual(m.changeEvent.updated, [tests.children[0]]);\n\t\t// \t\t});\n\n\t\t// \t\ttest('is a no-op if a node is added and removed', () => {\n\t\t// \t\t\tconst nested = testStubs.nested('id2-');\n\t\t// \t\t\ttests.children.push(nested);\n\t\t// \t\t\tsingle.onItemChange(tests, 'pid');\n\t\t// \t\t\ttests.children.pop();\n\t\t// \t\t\tsingle.onItemChange(tests, 'pid');\n\t\t// \t\t\tconst previousEvent = m.changeEvent;\n\t\t// \t\t\tm.apply(single.collectDiff());\n\t\t// \t\t\tassert.strictEqual(m.changeEvent, previousEvent);\n\t\t// \t\t});\n\n\t\t// \t\ttest('is a single-op if a node is added and changed', () => {\n\t\t// \t\t\tconst child = stubTest('c');\n\t\t// \t\t\ttests.children.push(child);\n\t\t// \t\t\tsingle.onItemChange(tests, 'pid');\n\t\t// \t\t\tchild.label = 'd';\n\t\t// \t\t\tsingle.onItemChange(tests, 'pid');\n\t\t// \t\t\tm.apply(single.collectDiff());\n\n\t\t// \t\t\tassertTreeListEqual(m.changeEvent.added, [child]);\n\t\t// \t\t\tassertTreeListEqual(m.changeEvent.removed, []);\n\t\t// \t\t\tassertTreeListEqual(m.changeEvent.updated, []);\n\t\t// \t\t});\n\n\t\t// \t\ttest('gets the common ancestor (1)', () => {\n\t\t// \t\t\ttests.children![0].children![0].label = 'za';\n\t\t// \t\t\ttests.children![0].children![1].label = 'zb';\n\t\t// \t\t\tsingle.onItemChange(tests, 'pid');\n\t\t// \t\t\tm.apply(single.collectDiff());\n\n\t\t// \t\t});\n\n\t\t// \t\ttest('gets the common ancestor (2)', () => {\n\t\t// \t\t\ttests.children![0].children![0].label = 'za';\n\t\t// \t\t\ttests.children![1].label = 'ab';\n\t\t// \t\t\tsingle.onItemChange(tests, 'pid');\n\t\t// \t\t\tm.apply(single.collectDiff());\n\t\t// \t\t});\n\t\t// \t});\n\t});\n\n\tsuite('TestRunTracker', () => {\n\t\tlet proxy: MockObject<MainThreadTestingShape>;\n\t\tlet c: TestRunCoordinator;\n\t\tlet cts: CancellationTokenSource;\n\t\tlet configuration: TestRunProfileImpl;\n\n\t\tlet req: TestRunRequest;\n\n\t\tlet dto: TestRunDto;\n\t\t// eslint-disable-next-line local/code-no-any-casts\n\t\tconst ext: IExtensionDescription = {} as any;\n\n\t\tteardown(() => {\n\t\t\tfor (const { id } of c.trackers) {\n\t\t\t\tc.disposeTestRun(id);\n\t\t\t}\n\t\t});\n\n\t\tsetup(async () => {\n\t\t\tproxy = mockObject<MainThreadTestingShape>()();\n\t\t\tcts = new CancellationTokenSource();\n\t\t\tc = new TestRunCoordinator(proxy, new NullLogService());\n\n\t\t\tconfiguration = new TestRunProfileImpl(mockObject<MainThreadTestingShape>()(), new Map(), new Set(), Event.None, 'ctrlId', 42, 'Do Run', TestRunProfileKind.Run, () => { }, false);\n\n\t\t\tawait single.expand(single.root.id, Infinity);\n\t\t\tsingle.collectDiff();\n\n\t\t\treq = {\n\t\t\t\tinclude: undefined,\n\t\t\t\texclude: [single.root.children.get('id-b')!],\n\t\t\t\tprofile: configuration,\n\t\t\t\tpreserveFocus: false,\n\t\t\t};\n\n\t\t\tdto = TestRunDto.fromInternal({\n\t\t\t\tcontrollerId: 'ctrl',\n\t\t\t\tprofileId: configuration.profileId,\n\t\t\t\texcludeExtIds: ['id-b'],\n\t\t\t\trunId: 'run-id',\n\t\t\t\ttestIds: [single.root.id],\n\t\t\t}, single);\n\t\t});\n\n\t\ttest('tracks a run started from a main thread request', () => {\n\t\t\tconst tracker = ds.add(c.prepareForMainThreadTestRun(ext, req, dto, configuration, cts.token));\n\t\t\tassert.strictEqual(tracker.hasRunningTasks, false);\n\n\t\t\tconst task1 = c.createTestRun(ext, 'ctrl', single, req, 'run1', true);\n\t\t\tconst task2 = c.createTestRun(ext, 'ctrl', single, req, 'run2', true);\n\t\t\tassert.strictEqual(proxy.$startedExtensionTestRun.called, false);\n\t\t\tassert.strictEqual(tracker.hasRunningTasks, true);\n\n\t\t\ttask1.appendOutput('hello');\n\t\t\tconst taskId = proxy.$appendOutputToRun.args[0]?.[1];\n\t\t\tassert.deepStrictEqual([['run-id', taskId, VSBuffer.fromString('hello'), undefined, undefined]], proxy.$appendOutputToRun.args);\n\t\t\ttask1.end();\n\n\t\t\tassert.strictEqual(proxy.$finishedExtensionTestRun.called, false);\n\t\t\tassert.strictEqual(tracker.hasRunningTasks, true);\n\n\t\t\ttask2.end();\n\n\t\t\tassert.strictEqual(proxy.$finishedExtensionTestRun.called, false);\n\t\t\tassert.strictEqual(tracker.hasRunningTasks, false);\n\t\t});\n\n\t\ttest('run cancel force ends after a timeout', () => {\n\t\t\tconst clock = sinon.useFakeTimers();\n\t\t\ttry {\n\t\t\t\tconst tracker = ds.add(c.prepareForMainThreadTestRun(ext, req, dto, configuration, cts.token));\n\t\t\t\tconst task = c.createTestRun(ext, 'ctrl', single, req, 'run1', true);\n\t\t\t\tconst onEnded = sinon.stub();\n\t\t\t\tds.add(tracker.onEnd(onEnded));\n\n\t\t\t\tassert.strictEqual(task.token.isCancellationRequested, false);\n\t\t\t\tassert.strictEqual(tracker.hasRunningTasks, true);\n\t\t\t\ttracker.cancel();\n\n\t\t\t\tassert.strictEqual(task.token.isCancellationRequested, true);\n\t\t\t\tassert.strictEqual(tracker.hasRunningTasks, true);\n\n\t\t\t\tclock.tick(9999);\n\t\t\t\tassert.strictEqual(tracker.hasRunningTasks, true);\n\t\t\t\tassert.strictEqual(onEnded.called, false);\n\n\t\t\t\tclock.tick(1);\n\t\t\t\tassert.strictEqual(onEnded.called, true);\n\t\t\t\tassert.strictEqual(tracker.hasRunningTasks, false);\n\t\t\t} finally {\n\t\t\t\tclock.restore();\n\t\t\t}\n\t\t});\n\n\t\ttest('run cancel force ends on second cancellation request', () => {\n\t\t\tconst tracker = ds.add(c.prepareForMainThreadTestRun(ext, req, dto, configuration, cts.token));\n\t\t\tconst task = c.createTestRun(ext, 'ctrl', single, req, 'run1', true);\n\t\t\tconst onEnded = sinon.stub();\n\t\t\tds.add(tracker.onEnd(onEnded));\n\n\t\t\tassert.strictEqual(task.token.isCancellationRequested, false);\n\t\t\tassert.strictEqual(tracker.hasRunningTasks, true);\n\t\t\ttracker.cancel();\n\n\t\t\tassert.strictEqual(task.token.isCancellationRequested, true);\n\t\t\tassert.strictEqual(tracker.hasRunningTasks, true);\n\t\t\tassert.strictEqual(onEnded.called, false);\n\t\t\ttracker.cancel();\n\n\t\t\tassert.strictEqual(tracker.hasRunningTasks, false);\n\t\t\tassert.strictEqual(onEnded.called, true);\n\t\t});\n\n\t\ttest('tracks a run started from an extension request', () => {\n\t\t\tconst task1 = c.createTestRun(ext, 'ctrl', single, req, 'hello world', false);\n\n\t\t\tconst tracker = Iterable.first(c.trackers)!;\n\t\t\tassert.strictEqual(tracker.hasRunningTasks, true);\n\t\t\tassert.deepStrictEqual(proxy.$startedExtensionTestRun.args, [\n\t\t\t\t[{\n\t\t\t\t\tprofile: { group: 2, id: 42 },\n\t\t\t\t\tcontrollerId: 'ctrl',\n\t\t\t\t\tid: tracker.id,\n\t\t\t\t\tinclude: [single.root.id],\n\t\t\t\t\texclude: [new TestId(['ctrlId', 'id-b']).toString()],\n\t\t\t\t\tpersist: false,\n\t\t\t\t\tcontinuous: false,\n\t\t\t\t\tpreserveFocus: false,\n\t\t\t\t}]\n\t\t\t]);\n\n\t\t\tconst task2 = c.createTestRun(ext, 'ctrl', single, req, 'run2', true);\n\t\t\tconst task3Detached = c.createTestRun(ext, 'ctrl', single, { ...req }, 'task3Detached', true);\n\n\t\t\ttask1.end();\n\t\t\tassert.strictEqual(proxy.$finishedExtensionTestRun.called, false);\n\t\t\tassert.strictEqual(tracker.hasRunningTasks, true);\n\n\t\t\ttask2.end();\n\t\t\tassert.deepStrictEqual(proxy.$finishedExtensionTestRun.args, [[tracker.id]]);\n\t\t\tassert.strictEqual(tracker.hasRunningTasks, false);\n\n\t\t\ttask3Detached.end();\n\t\t});\n\n\t\ttest('adds tests to run smartly', () => {\n\t\t\tconst task1 = c.createTestRun(ext, 'ctrlId', single, req, 'hello world', false);\n\t\t\tconst tracker = Iterable.first(c.trackers)!;\n\t\t\tconst expectedArgs: unknown[][] = [];\n\t\t\tassert.deepStrictEqual(proxy.$addTestsToRun.args, expectedArgs);\n\n\t\t\ttask1.passed(single.root.children.get('id-a')!.children.get('id-aa')!);\n\t\t\texpectedArgs.push([\n\t\t\t\t'ctrlId',\n\t\t\t\ttracker.id,\n\t\t\t\t[\n\t\t\t\t\tconvert.TestItem.from(single.root),\n\t\t\t\t\tconvert.TestItem.from(single.root.children.get('id-a') as TestItemImpl),\n\t\t\t\t\tconvert.TestItem.from(single.root.children.get('id-a')!.children.get('id-aa') as TestItemImpl),\n\t\t\t\t]\n\t\t\t]);\n\t\t\tassert.deepStrictEqual(proxy.$addTestsToRun.args, expectedArgs);\n\n\t\t\ttask1.enqueued(single.root.children.get('id-a')!.children.get('id-ab')!);\n\t\t\texpectedArgs.push([\n\t\t\t\t'ctrlId',\n\t\t\t\ttracker.id,\n\t\t\t\t[\n\t\t\t\t\tconvert.TestItem.from(single.root.children.get('id-a') as TestItemImpl),\n\t\t\t\t\tconvert.TestItem.from(single.root.children.get('id-a')!.children.get('id-ab') as TestItemImpl),\n\t\t\t\t],\n\t\t\t]);\n\t\t\tassert.deepStrictEqual(proxy.$addTestsToRun.args, expectedArgs);\n\n\t\t\ttask1.passed(single.root.children.get('id-a')!.children.get('id-ab')!);\n\t\t\tassert.deepStrictEqual(proxy.$addTestsToRun.args, expectedArgs);\n\n\t\t\ttask1.end();\n\t\t});\n\n\t\ttest('adds test messages to run', () => {\n\t\t\tconst test1 = new TestItemImpl('ctrlId', 'id-c', 'test c', URI.file('/testc.txt'));\n\t\t\tconst test2 = new TestItemImpl('ctrlId', 'id-d', 'test d', URI.file('/testd.txt'));\n\t\t\ttest1.range = test2.range = new Range(new Position(0, 0), new Position(1, 0));\n\t\t\tsingle.root.children.replace([test1, test2]);\n\t\t\tconst task = c.createTestRun(ext, 'ctrlId', single, req, 'hello world', false);\n\n\t\t\tconst message1 = new TestMessage('some message');\n\t\t\tmessage1.location = new Location(URI.file('/a.txt'), new Position(0, 0));\n\t\t\ttask.failed(test1, message1);\n\n\t\t\tconst args = proxy.$appendTestMessagesInRun.args[0];\n\t\t\tassert.deepStrictEqual(proxy.$appendTestMessagesInRun.args[0], [\n\t\t\t\targs[0],\n\t\t\t\targs[1],\n\t\t\t\tnew TestId(['ctrlId', 'id-c']).toString(),\n\t\t\t\t[{\n\t\t\t\t\tmessage: 'some message',\n\t\t\t\t\ttype: TestMessageType.Error,\n\t\t\t\t\texpected: undefined,\n\t\t\t\t\tcontextValue: undefined,\n\t\t\t\t\tactual: undefined,\n\t\t\t\t\tlocation: convert.location.from(message1.location),\n\t\t\t\t\tstackTrace: undefined,\n\t\t\t\t}]\n\t\t\t]);\n\n\t\t\t// should use test location as default\n\t\t\ttask.failed(test2, new TestMessage('some message'));\n\t\t\tassert.deepStrictEqual(proxy.$appendTestMessagesInRun.args[1], [\n\t\t\t\targs[0],\n\t\t\t\targs[1],\n\t\t\t\tnew TestId(['ctrlId', 'id-d']).toString(),\n\t\t\t\t[{\n\t\t\t\t\tmessage: 'some message',\n\t\t\t\t\ttype: TestMessageType.Error,\n\t\t\t\t\tcontextValue: undefined,\n\t\t\t\t\texpected: undefined,\n\t\t\t\t\tactual: undefined,\n\t\t\t\t\tlocation: convert.location.from({ uri: test2.uri!, range: test2.range }),\n\t\t\t\t\tstackTrace: undefined,\n\t\t\t\t}]\n\t\t\t]);\n\n\t\t\ttask.end();\n\t\t});\n\n\t\ttest('guards calls after runs are ended', () => {\n\t\t\tconst task = c.createTestRun(ext, 'ctrl', single, req, 'hello world', false);\n\t\t\ttask.end();\n\n\t\t\ttask.failed(single.root, new TestMessage('some message'));\n\t\t\ttask.appendOutput('output');\n\n\t\t\tassert.strictEqual(proxy.$addTestsToRun.called, false);\n\t\t\tassert.strictEqual(proxy.$appendOutputToRun.called, false);\n\t\t\tassert.strictEqual(proxy.$appendTestMessagesInRun.called, false);\n\t\t});\n\n\t\ttest('sets state of test with identical local IDs (#131827)', () => {\n\t\t\tconst testA = single.root.children.get('id-a');\n\t\t\tconst testB = single.root.children.get('id-b');\n\t\t\tconst childA = new TestItemImpl('ctrlId', 'id-child', 'child', undefined);\n\t\t\ttestA!.children.replace([childA]);\n\t\t\tconst childB = new TestItemImpl('ctrlId', 'id-child', 'child', undefined);\n\t\t\ttestB!.children.replace([childB]);\n\n\t\t\tconst task1 = c.createTestRun(ext, 'ctrl', single, new TestRunRequestImpl(), 'hello world', false);\n\t\t\tconst tracker = Iterable.first(c.trackers)!;\n\n\t\t\ttask1.passed(childA);\n\t\t\ttask1.passed(childB);\n\t\t\tassert.deepStrictEqual(proxy.$addTestsToRun.args, [\n\t\t\t\t[\n\t\t\t\t\t'ctrl',\n\t\t\t\t\ttracker.id,\n\t\t\t\t\t[single.root, testA, childA].map(t => convert.TestItem.from(t as TestItemImpl)),\n\t\t\t\t],\n\t\t\t\t[\n\t\t\t\t\t'ctrl',\n\t\t\t\t\ttracker.id,\n\t\t\t\t\t[single.root, testB, childB].map(t => convert.TestItem.from(t as TestItemImpl)),\n\t\t\t\t],\n\t\t\t]);\n\n\t\t\ttask1.end();\n\t\t});\n\t});\n\n\tsuite('service', () => {\n\t\tlet ctrl: TestExtHostTesting;\n\n\t\tclass TestExtHostTesting extends ExtHostTesting {\n\t\t\tpublic getProfileInternalId(ctrl: TestController, profile: TestRunProfile) {\n\t\t\t\tfor (const [id, p] of this.controllers.get(ctrl.id)!.profiles) {\n\t\t\t\t\tif (profile === p) {\n\t\t\t\t\t\treturn id;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tthrow new Error('profile not found');\n\t\t\t}\n\t\t}\n\n\t\tsetup(() => {\n\t\t\tconst rpcProtocol = AnyCallRPCProtocol();\n\t\t\tctrl = ds.add(new TestExtHostTesting(\n\t\t\t\trpcProtocol,\n\t\t\t\tnew NullLogService(),\n\t\t\t\tnew ExtHostCommands(rpcProtocol, new NullLogService(), new class extends mock<IExtHostTelemetry>() {\n\t\t\t\t\toverride onExtensionError(): boolean {\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\t\t\t\t}),\n\t\t\t\tnew ExtHostDocumentsAndEditors(rpcProtocol, new NullLogService()),\n\t\t\t));\n\t\t});\n\n\t\ttest('exposes active profiles correctly', async () => {\n\t\t\tconst extA = { ...nullExtensionDescription, identifier: new ExtensionIdentifier('ext.a'), enabledApiProposals: ['testingActiveProfile'] };\n\t\t\tconst extB = { ...nullExtensionDescription, identifier: new ExtensionIdentifier('ext.b'), enabledApiProposals: ['testingActiveProfile'] };\n\n\t\t\tconst ctrlA = ds.add(ctrl.createTestController(extA, 'a', 'ctrla'));\n\t\t\tconst profAA = ds.add(ctrlA.createRunProfile('aa', TestRunProfileKind.Run, () => { }));\n\t\t\tconst profAB = ds.add(ctrlA.createRunProfile('ab', TestRunProfileKind.Run, () => { }));\n\n\t\t\tconst ctrlB = ds.add(ctrl.createTestController(extB, 'b', 'ctrlb'));\n\t\t\tconst profBA = ds.add(ctrlB.createRunProfile('ba', TestRunProfileKind.Run, () => { }));\n\t\t\tconst profBB = ds.add(ctrlB.createRunProfile('bb', TestRunProfileKind.Run, () => { }));\n\t\t\tconst neverCalled = sinon.stub();\n\n\t\t\t// empty default state:\n\t\t\tassert.deepStrictEqual(profAA.isDefault, false);\n\t\t\tassert.deepStrictEqual(profBA.isDefault, false);\n\t\t\tassert.deepStrictEqual(profBB.isDefault, false);\n\n\t\t\t// fires a change event:\n\t\t\tconst changeA = Event.toPromise(profAA.onDidChangeDefault as Event<boolean>);\n\t\t\tconst changeBA = Event.toPromise(profBA.onDidChangeDefault as Event<boolean>);\n\t\t\tconst changeBB = Event.toPromise(profBB.onDidChangeDefault as Event<boolean>);\n\n\t\t\tds.add(profAB.onDidChangeDefault(neverCalled));\n\t\t\tassert.strictEqual(neverCalled.called, false);\n\n\t\t\tctrl.$setDefaultRunProfiles({\n\t\t\t\ta: [ctrl.getProfileInternalId(ctrlA, profAA)],\n\t\t\t\tb: [ctrl.getProfileInternalId(ctrlB, profBA), ctrl.getProfileInternalId(ctrlB, profBB)]\n\t\t\t});\n\n\t\t\tassert.deepStrictEqual(await changeA, true);\n\t\t\tassert.deepStrictEqual(await changeBA, true);\n\t\t\tassert.deepStrictEqual(await changeBB, true);\n\n\t\t\t// updates internal state:\n\t\t\tassert.deepStrictEqual(profAA.isDefault, true);\n\t\t\tassert.deepStrictEqual(profBA.isDefault, true);\n\t\t\tassert.deepStrictEqual(profBB.isDefault, true);\n\t\t\tassert.deepStrictEqual(profAB.isDefault, false);\n\n\t\t\t// no-ops if equal\n\t\t\tds.add(profAA.onDidChangeDefault(neverCalled));\n\t\t\tctrl.$setDefaultRunProfiles({\n\t\t\t\ta: [ctrl.getProfileInternalId(ctrlA, profAA)],\n\t\t\t});\n\t\t\tassert.strictEqual(neverCalled.called, false);\n\t\t});\n\t});\n});\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport assert from 'assert';\nimport * as sinon from 'sinon';\nimport { timeout } from '../../../../base/common/async.js';\nimport { VSBuffer } from '../../../../base/common/buffer.js';\nimport { CancellationTokenSource } from '../../../../base/common/cancellation.js';\nimport { Event } from '../../../../base/common/event.js';\nimport { Iterable } from '../../../../base/common/iterator.js';\nimport { URI } from '../../../../base/common/uri.js';\nimport { mock, mockObject, MockObject } from '../../../../base/test/common/mock.js';\nimport { ensureNoDisposablesAreLeakedInTestSuite } from '../../../../base/test/common/utils.js';\nimport * as editorRange from '../../../../editor/common/core/range.js';\nimport { ExtensionIdentifier, IExtensionDescription } from '../../../../platform/extensions/common/extensions.js';\nimport { NullLogService } from '../../../../platform/log/common/log.js';\nimport { MainThreadTestingShape } from '../../common/extHost.protocol.js';\nimport { ExtHostCommands } from '../../common/extHostCommands.js';\nimport { ExtHostDocumentsAndEditors } from '../../common/extHostDocumentsAndEditors.js';\nimport { IExtHostTelemetry } from '../../common/extHostTelemetry.js';\nimport { ExtHostTesting, TestRunCoordinator, TestRunDto, TestRunProfileImpl } from '../../common/extHostTesting.js';\nimport { ExtHostTestItemCollection, TestItemImpl } from '../../common/extHostTestItem.js';\nimport * as convert from '../../common/extHostTypeConverters.js';\nimport { Location, Position, Range, TestMessage, TestRunProfileKind, TestRunRequest as TestRunRequestImpl, TestTag } from '../../common/extHostTypes.js';\nimport { AnyCallRPCProtocol } from '../common/testRPCProtocol.js';\nimport { TestId } from '../../../contrib/testing/common/testId.js';\nimport { TestDiffOpType, TestItemExpandState, TestMessageType, TestsDiff } from '../../../contrib/testing/common/testTypes.js';\nimport { nullExtensionDescription } from '../../../services/extensions/common/extensions.js';\nimport type { TestController, TestItem, TestRunProfile, TestRunRequest } from 'vscode';\n\nconst simplify = (item: TestItem) => ({\n\tid: item.id,\n\tlabel: item.label,\n\turi: item.uri,\n\trange: item.range,\n});\n\nconst assertTreesEqual = (a: TestItemImpl | undefined, b: TestItemImpl | undefined) => {\n\tif (!a) {\n\t\tthrow new assert.AssertionError({ message: 'Expected a to be defined', actual: a });\n\t}\n\n\tif (!b) {\n\t\tthrow new assert.AssertionError({ message: 'Expected b to be defined', actual: b });\n\t}\n\n\tassert.deepStrictEqual(simplify(a), simplify(b));\n\n\tconst aChildren = [...a.children].map(([_, c]) => c.id).sort();\n\tconst bChildren = [...b.children].map(([_, c]) => c.id).sort();\n\tassert.strictEqual(aChildren.length, bChildren.length, `expected ${a.label}.children.length == ${b.label}.children.length`);\n\taChildren.forEach(key => assertTreesEqual(a.children.get(key) as TestItemImpl, b.children.get(key) as TestItemImpl));\n};\n\n// const assertTreeListEqual = (a: ReadonlyArray<TestItem>, b: ReadonlyArray<TestItem>) => {\n// \tassert.strictEqual(a.length, b.length, `expected a.length == n.length`);\n// \ta.forEach((_, i) => assertTreesEqual(a[i], b[i]));\n// };\n\n// class TestMirroredCollection extends MirroredTestCollection {\n// \tpublic changeEvent!: TestChangeEvent;\n\n// \tconstructor() {\n// \t\tsuper();\n// \t\tthis.onDidChangeTests(evt => this.changeEvent = evt);\n// \t}\n\n// \tpublic get length() {\n// \t\treturn this.items.size;\n// \t}\n// }\n\nsuite('ExtHost Testing', () => {\n\tclass TestExtHostTestItemCollection extends ExtHostTestItemCollection {\n\t\tpublic setDiff(diff: TestsDiff) {\n\t\t\tthis.diff = diff;\n\t\t}\n\t}\n\n\tteardown(() => {\n\t\tsinon.restore();\n\t});\n\n\tconst ds = ensureNoDisposablesAreLeakedInTestSuite();\n\n\tlet single: TestExtHostTestItemCollection;\n\tlet resolveCalls: (string | undefined)[] = [];\n\tsetup(() => {\n\t\tresolveCalls = [];\n\t\tsingle = ds.add(new TestExtHostTestItemCollection('ctrlId', 'root', {\n\t\t\tgetDocument: () => undefined,\n\t\t} as Partial<ExtHostDocumentsAndEditors> as ExtHostDocumentsAndEditors));\n\t\tsingle.resolveHandler = item => {\n\t\t\tresolveCalls.push(item?.id);\n\t\t\tif (item === undefined) {\n\t\t\t\tconst a = new TestItemImpl('ctrlId', 'id-a', 'a', URI.file('/'));\n\t\t\t\ta.canResolveChildren = true;\n\t\t\t\tconst b = new TestItemImpl('ctrlId', 'id-b', 'b', URI.file('/'));\n\t\t\t\tsingle.root.children.add(a);\n\t\t\t\tsingle.root.children.add(b);\n\t\t\t} else if (item.id === 'id-a') {\n\t\t\t\titem.children.add(new TestItemImpl('ctrlId', 'id-aa', 'aa', URI.file('/')));\n\t\t\t\titem.children.add(new TestItemImpl('ctrlId', 'id-ab', 'ab', URI.file('/')));\n\t\t\t}\n\t\t};\n\n\t\tds.add(single.onDidGenerateDiff(d => single.setDiff(d /* don't clear during testing */)));\n\t});\n\n\tsuite('OwnedTestCollection', () => {\n\t\ttest('adds a root recursively', async () => {\n\t\t\tawait single.expand(single.root.id, Infinity);\n\t\t\tconst a = single.root.children.get('id-a') as TestItemImpl;\n\t\t\tconst b = single.root.children.get('id-b') as TestItemImpl;\n\t\t\tassert.deepStrictEqual(single.collectDiff(), [\n\t\t\t\t{\n\t\t\t\t\top: TestDiffOpType.Add,\n\t\t\t\t\titem: { controllerId: 'ctrlId', expand: TestItemExpandState.BusyExpanding, item: { ...convert.TestItem.from(single.root) } }\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\top: TestDiffOpType.Add,\n\t\t\t\t\titem: { controllerId: 'ctrlId', expand: TestItemExpandState.BusyExpanding, item: { ...convert.TestItem.from(a) } }\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\top: TestDiffOpType.Add,\n\t\t\t\t\titem: { controllerId: 'ctrlId', expand: TestItemExpandState.NotExpandable, item: convert.TestItem.from(a.children.get('id-aa') as TestItemImpl) }\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\top: TestDiffOpType.Add,\n\t\t\t\t\titem: { controllerId: 'ctrlId', expand: TestItemExpandState.NotExpandable, item: convert.TestItem.from(a.children.get('id-ab') as TestItemImpl) }\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\top: TestDiffOpType.Update,\n\t\t\t\t\titem: { extId: new TestId(['ctrlId', 'id-a']).toString(), expand: TestItemExpandState.Expanded }\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\top: TestDiffOpType.Add,\n\t\t\t\t\titem: { controllerId: 'ctrlId', expand: TestItemExpandState.NotExpandable, item: convert.TestItem.from(b) }\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\top: TestDiffOpType.Update,\n\t\t\t\t\titem: { extId: single.root.id, expand: TestItemExpandState.Expanded }\n\t\t\t\t},\n\t\t\t]);\n\t\t});\n\n\t\ttest('parents are set correctly', () => {\n\t\t\tsingle.expand(single.root.id, Infinity);\n\t\t\tsingle.collectDiff();\n\n\t\t\tconst a = single.root.children.get('id-a')!;\n\t\t\tconst ab = a.children.get('id-ab')!;\n\t\t\tassert.strictEqual(a.parent, undefined);\n\t\t\tassert.strictEqual(ab.parent, a);\n\t\t});\n\n\t\ttest('can add an item with same ID as root', () => {\n\t\t\tsingle.collectDiff();\n\n\t\t\tconst child = new TestItemImpl('ctrlId', 'ctrlId', 'c', undefined);\n\t\t\tsingle.root.children.add(child);\n\t\t\tassert.deepStrictEqual(single.collectDiff(), [\n\t\t\t\t{\n\t\t\t\t\top: TestDiffOpType.Add,\n\t\t\t\t\titem: { controllerId: 'ctrlId', expand: TestItemExpandState.NotExpandable, item: convert.TestItem.from(child) },\n\t\t\t\t}\n\t\t\t]);\n\t\t});\n\n\t\ttest('no-ops if items not changed', () => {\n\t\t\tsingle.collectDiff();\n\t\t\tassert.deepStrictEqual(single.collectDiff(), []);\n\t\t});\n\n\t\ttest('watches property mutations', () => {\n\t\t\tsingle.expand(single.root.id, Infinity);\n\t\t\tsingle.collectDiff();\n\t\t\tsingle.root.children.get('id-a')!.description = 'Hello world'; /* item a */\n\n\t\t\tassert.deepStrictEqual(single.collectDiff(), [\n\t\t\t\t{\n\t\t\t\t\top: TestDiffOpType.Update,\n\t\t\t\t\titem: { extId: new TestId(['ctrlId', 'id-a']).toString(), item: { description: 'Hello world' } },\n\t\t\t\t}\n\t\t\t]);\n\t\t});\n\n\t\ttest('removes children', () => {\n\t\t\tsingle.expand(single.root.id, Infinity);\n\t\t\tsingle.collectDiff();\n\t\t\tsingle.root.children.delete('id-a');\n\n\t\t\tassert.deepStrictEqual(single.collectDiff(), [\n\t\t\t\t{ op: TestDiffOpType.Remove, itemId: new TestId(['ctrlId', 'id-a']).toString() },\n\t\t\t]);\n\t\t\tassert.deepStrictEqual(\n\t\t\t\t[...single.tree.keys()].sort(),\n\t\t\t\t[single.root.id, new TestId(['ctrlId', 'id-b']).toString()],\n\t\t\t);\n\t\t\tassert.strictEqual(single.tree.size, 2);\n\t\t});\n\n\t\ttest('adds new children', () => {\n\t\t\tsingle.expand(single.root.id, Infinity);\n\t\t\tsingle.collectDiff();\n\t\t\tconst child = new TestItemImpl('ctrlId', 'id-ac', 'c', undefined);\n\t\t\tsingle.root.children.get('id-a')!.children.add(child);\n\n\t\t\tassert.deepStrictEqual(single.collectDiff(), [\n\t\t\t\t{\n\t\t\t\t\top: TestDiffOpType.Add, item: {\n\t\t\t\t\t\tcontrollerId: 'ctrlId',\n\t\t\t\t\t\texpand: TestItemExpandState.NotExpandable,\n\t\t\t\t\t\titem: convert.TestItem.from(child),\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t]);\n\t\t\tassert.deepStrictEqual(\n\t\t\t\t[...single.tree.values()].map(n => n.actual.id).sort(),\n\t\t\t\t[single.root.id, 'id-a', 'id-aa', 'id-ab', 'id-ac', 'id-b'],\n\t\t\t);\n\t\t\tassert.strictEqual(single.tree.size, 6);\n\t\t});\n\n\t\ttest('manages tags correctly', () => {\n\t\t\tsingle.expand(single.root.id, Infinity);\n\t\t\tsingle.collectDiff();\n\t\t\tconst tag1 = new TestTag('tag1');\n\t\t\tconst tag2 = new TestTag('tag2');\n\t\t\tconst tag3 = new TestTag('tag3');\n\t\t\tconst child = new TestItemImpl('ctrlId', 'id-ac', 'c', undefined);\n\t\t\tchild.tags = [tag1, tag2];\n\t\t\tsingle.root.children.get('id-a')!.children.add(child);\n\n\t\t\tassert.deepStrictEqual(single.collectDiff(), [\n\t\t\t\t{ op: TestDiffOpType.AddTag, tag: { id: 'ctrlId\\0tag1' } },\n\t\t\t\t{ op: TestDiffOpType.AddTag, tag: { id: 'ctrlId\\0tag2' } },\n\t\t\t\t{\n\t\t\t\t\top: TestDiffOpType.Add, item: {\n\t\t\t\t\t\tcontrollerId: 'ctrlId',\n\t\t\t\t\t\texpand: TestItemExpandState.NotExpandable,\n\t\t\t\t\t\titem: convert.TestItem.from(child),\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t]);\n\n\t\t\tchild.tags = [tag2, tag3];\n\t\t\tassert.deepStrictEqual(single.collectDiff(), [\n\t\t\t\t{ op: TestDiffOpType.AddTag, tag: { id: 'ctrlId\\0tag3' } },\n\t\t\t\t{\n\t\t\t\t\top: TestDiffOpType.Update, item: {\n\t\t\t\t\t\textId: new TestId(['ctrlId', 'id-a', 'id-ac']).toString(),\n\t\t\t\t\t\titem: { tags: ['ctrlId\\0tag2', 'ctrlId\\0tag3'] }\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t{ op: TestDiffOpType.RemoveTag, id: 'ctrlId\\0tag1' },\n\t\t\t]);\n\n\t\t\tconst a = single.root.children.get('id-a')!;\n\t\t\ta.tags = [tag2];\n\t\t\ta.children.replace([]);\n\t\t\tassert.deepStrictEqual(single.collectDiff().filter(t => t.op === TestDiffOpType.RemoveTag), [\n\t\t\t\t{ op: TestDiffOpType.RemoveTag, id: 'ctrlId\\0tag3' },\n\t\t\t]);\n\t\t});\n\n\t\ttest('replaces on uri change', () => {\n\t\t\tsingle.expand(single.root.id, Infinity);\n\t\t\tsingle.collectDiff();\n\n\t\t\tconst oldA = single.root.children.get('id-a') as TestItemImpl;\n\t\t\tconst uri = single.root.children.get('id-a')!.uri?.with({ path: '/different' });\n\t\t\tconst newA = new TestItemImpl('ctrlId', 'id-a', 'Hello world', uri);\n\t\t\tnewA.children.replace([...oldA.children].map(([_, item]) => item));\n\t\t\tsingle.root.children.replace([...single.root.children].map(([id, i]) => id === 'id-a' ? newA : i));\n\n\t\t\tassert.deepStrictEqual(single.collectDiff(), [\n\t\t\t\t{ op: TestDiffOpType.Remove, itemId: new TestId(['ctrlId', 'id-a']).toString() },\n\t\t\t\t{\n\t\t\t\t\top: TestDiffOpType.Add,\n\t\t\t\t\titem: { controllerId: 'ctrlId', expand: TestItemExpandState.NotExpandable, item: { ...convert.TestItem.from(newA) } }\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\top: TestDiffOpType.Add,\n\t\t\t\t\titem: { controllerId: 'ctrlId', expand: TestItemExpandState.NotExpandable, item: convert.TestItem.from(newA.children.get('id-aa') as TestItemImpl) }\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\top: TestDiffOpType.Add,\n\t\t\t\t\titem: { controllerId: 'ctrlId', expand: TestItemExpandState.NotExpandable, item: convert.TestItem.from(newA.children.get('id-ab') as TestItemImpl) }\n\t\t\t\t},\n\t\t\t]);\n\t\t});\n\n\t\ttest('treats in-place replacement as mutation', () => {\n\t\t\tsingle.expand(single.root.id, Infinity);\n\t\t\tsingle.collectDiff();\n\n\t\t\tconst oldA = single.root.children.get('id-a') as TestItemImpl;\n\t\t\tconst uri = single.root.children.get('id-a')!.uri;\n\t\t\tconst newA = new TestItemImpl('ctrlId', 'id-a', 'Hello world', uri);\n\t\t\tnewA.children.replace([...oldA.children].map(([_, item]) => item));\n\t\t\tsingle.root.children.replace([\n\t\t\t\tnewA,\n\t\t\t\tnew TestItemImpl('ctrlId', 'id-b', single.root.children.get('id-b')!.label, uri),\n\t\t\t]);\n\n\t\t\tassert.deepStrictEqual(single.collectDiff(), [\n\t\t\t\t{\n\t\t\t\t\top: TestDiffOpType.Update,\n\t\t\t\t\titem: { extId: new TestId(['ctrlId', 'id-a']).toString(), item: { label: 'Hello world' } },\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\top: TestDiffOpType.DocumentSynced,\n\t\t\t\t\tdocv: undefined,\n\t\t\t\t\turi: uri\n\t\t\t\t}\n\t\t\t]);\n\n\t\t\tnewA.label = 'still connected';\n\t\t\tassert.deepStrictEqual(single.collectDiff(), [\n\t\t\t\t{\n\t\t\t\t\top: TestDiffOpType.Update,\n\t\t\t\t\titem: { extId: new TestId(['ctrlId', 'id-a']).toString(), item: { label: 'still connected' } }\n\t\t\t\t},\n\t\t\t]);\n\n\t\t\toldA.label = 'no longer connected';\n\t\t\tassert.deepStrictEqual(single.collectDiff(), []);\n\t\t});\n\n\t\tsuite('expandibility restoration', () => {\n\t\t\tconst doReplace = async (canResolveChildren = true) => {\n\t\t\t\tconst uri = single.root.children.get('id-a')!.uri;\n\t\t\t\tconst newA = new TestItemImpl('ctrlId', 'id-a', 'Hello world', uri);\n\t\t\t\tnewA.canResolveChildren = canResolveChildren;\n\t\t\t\tsingle.root.children.replace([\n\t\t\t\t\tnewA,\n\t\t\t\t\tnew TestItemImpl('ctrlId', 'id-b', single.root.children.get('id-b')!.label, uri),\n\t\t\t\t]);\n\t\t\t\tawait timeout(0); // drain microtasks\n\t\t\t};\n\n\t\t\ttest('does not restore an unexpanded state', async () => {\n\t\t\t\tawait single.expand(single.root.id, 0);\n\t\t\t\tassert.deepStrictEqual(resolveCalls, [undefined]);\n\t\t\t\tawait doReplace();\n\t\t\t\tassert.deepStrictEqual(resolveCalls, [undefined]);\n\t\t\t});\n\n\t\t\ttest('restores resolve state on replacement', async () => {\n\t\t\t\tawait single.expand(single.root.id, Infinity);\n\t\t\t\tassert.deepStrictEqual(resolveCalls, [undefined, 'id-a']);\n\t\t\t\tawait doReplace();\n\t\t\t\tassert.deepStrictEqual(resolveCalls, [undefined, 'id-a', 'id-a']);\n\t\t\t});\n\n\t\t\ttest('does not expand if new child is not expandable', async () => {\n\t\t\t\tawait single.expand(single.root.id, Infinity);\n\t\t\t\tassert.deepStrictEqual(resolveCalls, [undefined, 'id-a']);\n\t\t\t\tawait doReplace(false);\n\t\t\t\tassert.deepStrictEqual(resolveCalls, [undefined, 'id-a']);\n\t\t\t});\n\t\t});\n\n\t\ttest('treats in-place replacement as mutation deeply', () => {\n\t\t\tsingle.expand(single.root.id, Infinity);\n\t\t\tsingle.collectDiff();\n\n\t\t\tconst oldA = single.root.children.get('id-a')!;\n\t\t\tconst uri = oldA.uri;\n\t\t\tconst newA = new TestItemImpl('ctrlId', 'id-a', single.root.children.get('id-a')!.label, uri);\n\t\t\tconst oldAA = oldA.children.get('id-aa')!;\n\t\t\tconst oldAB = oldA.children.get('id-ab')!;\n\t\t\tconst newAB = new TestItemImpl('ctrlId', 'id-ab', 'Hello world', uri);\n\t\t\tnewA.children.replace([oldAA, newAB]);\n\t\t\tsingle.root.children.replace([newA, single.root.children.get('id-b')!]);\n\n\t\t\tassert.deepStrictEqual(single.collectDiff(), [\n\t\t\t\t{\n\t\t\t\t\top: TestDiffOpType.Update,\n\t\t\t\t\titem: { extId: TestId.fromExtHostTestItem(oldAB, 'ctrlId').toString(), item: { label: 'Hello world' } },\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\top: TestDiffOpType.DocumentSynced,\n\t\t\t\t\tdocv: undefined,\n\t\t\t\t\turi: uri\n\t\t\t\t}\n\t\t\t]);\n\n\t\t\toldAA.label = 'still connected1';\n\t\t\tnewAB.label = 'still connected2';\n\t\t\toldAB.label = 'not connected3';\n\t\t\tassert.deepStrictEqual(single.collectDiff(), [\n\t\t\t\t{\n\t\t\t\t\top: TestDiffOpType.Update,\n\t\t\t\t\titem: { extId: new TestId(['ctrlId', 'id-a', 'id-aa']).toString(), item: { label: 'still connected1' } }\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\top: TestDiffOpType.Update,\n\t\t\t\t\titem: { extId: new TestId(['ctrlId', 'id-a', 'id-ab']).toString(), item: { label: 'still connected2' } }\n\t\t\t\t},\n\t\t\t]);\n\n\t\t\tassert.strictEqual(newAB.parent, newA);\n\t\t\tassert.strictEqual(oldAA.parent, newA);\n\t\t\tassert.deepStrictEqual(newA.parent, undefined);\n\t\t});\n\n\t\ttest('moves an item to be a new child', async () => {\n\t\t\tawait single.expand(single.root.id, 0);\n\t\t\tsingle.collectDiff();\n\t\t\tconst b = single.root.children.get('id-b') as TestItemImpl;\n\t\t\tconst a = single.root.children.get('id-a') as TestItemImpl;\n\t\t\ta.children.add(b);\n\t\t\tassert.deepStrictEqual(single.collectDiff(), [\n\t\t\t\t{\n\t\t\t\t\top: TestDiffOpType.Remove,\n\t\t\t\t\titemId: new TestId(['ctrlId', 'id-b']).toString(),\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\top: TestDiffOpType.Add,\n\t\t\t\t\titem: { controllerId: 'ctrlId', expand: TestItemExpandState.NotExpandable, item: convert.TestItem.from(b) }\n\t\t\t\t},\n\t\t\t]);\n\n\t\t\tb.label = 'still connected';\n\t\t\tassert.deepStrictEqual(single.collectDiff(), [\n\t\t\t\t{\n\t\t\t\t\top: TestDiffOpType.Update,\n\t\t\t\t\titem: { extId: new TestId(['ctrlId', 'id-a', 'id-b']).toString(), item: { label: 'still connected' } }\n\t\t\t\t},\n\t\t\t]);\n\n\t\t\tassert.deepStrictEqual([...single.root.children].map(([_, item]) => item), [single.root.children.get('id-a')]);\n\t\t\tassert.deepStrictEqual(b.parent, a);\n\t\t});\n\n\t\ttest('sends document sync events', async () => {\n\t\t\tawait single.expand(single.root.id, 0);\n\t\t\tsingle.collectDiff();\n\n\t\t\tconst a = single.root.children.get('id-a') as TestItemImpl;\n\t\t\ta.range = new Range(new Position(0, 0), new Position(1, 0));\n\n\t\t\tassert.deepStrictEqual(single.collectDiff(), [\n\t\t\t\t{\n\t\t\t\t\top: TestDiffOpType.DocumentSynced,\n\t\t\t\t\tdocv: undefined,\n\t\t\t\t\turi: URI.file('/')\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\top: TestDiffOpType.Update,\n\t\t\t\t\titem: {\n\t\t\t\t\t\textId: new TestId(['ctrlId', 'id-a']).toString(),\n\t\t\t\t\t\titem: {\n\t\t\t\t\t\t\trange: editorRange.Range.lift({\n\t\t\t\t\t\t\t\tendColumn: 1,\n\t\t\t\t\t\t\t\tendLineNumber: 2,\n\t\t\t\t\t\t\t\tstartColumn: 1,\n\t\t\t\t\t\t\t\tstartLineNumber: 1\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t]);\n\n\t\t\t// sends on replace even if it's a no-op\n\t\t\ta.range = a.range;\n\t\t\tassert.deepStrictEqual(single.collectDiff(), [\n\t\t\t\t{\n\t\t\t\t\top: TestDiffOpType.DocumentSynced,\n\t\t\t\t\tdocv: undefined,\n\t\t\t\t\turi: URI.file('/')\n\t\t\t\t},\n\t\t\t]);\n\n\t\t\t// sends on a child replacement\n\t\t\tconst uri = URI.file('/');\n\t\t\tconst a2 = new TestItemImpl('ctrlId', 'id-a', 'a', uri);\n\t\t\ta2.range = a.range;\n\t\t\tsingle.root.children.replace([a2, single.root.children.get('id-b')!]);\n\t\t\tassert.deepStrictEqual(single.collectDiff(), [\n\t\t\t\t{\n\t\t\t\t\top: TestDiffOpType.DocumentSynced,\n\t\t\t\t\tdocv: undefined,\n\t\t\t\t\turi\n\t\t\t\t},\n\t\t\t]);\n\t\t});\n\t});\n\n\n\tsuite('MirroredTestCollection', () => {\n\t\t// todo@connor4312: re-renable when we figure out what observing looks like we async children\n\t\t// \tlet m: TestMirroredCollection;\n\t\t// \tsetup(() => m = new TestMirroredCollection());\n\n\t\t// \ttest('mirrors creation of the root', () => {\n\t\t// \t\tconst tests = testStubs.nested();\n\t\t// \t\tsingle.addRoot(tests, 'pid');\n\t\t// \t\tsingle.expand(single.root.id, Infinity);\n\t\t// \t\tm.apply(single.collectDiff());\n\t\t// \t\tassertTreesEqual(m.rootTestItems[0], owned.getTestById(single.root.id)![1].actual);\n\t\t// \t\tassert.strictEqual(m.length, single.itemToInternal.size);\n\t\t// \t});\n\n\t\t// \ttest('mirrors node deletion', () => {\n\t\t// \t\tconst tests = testStubs.nested();\n\t\t// \t\tsingle.addRoot(tests, 'pid');\n\t\t// \t\tm.apply(single.collectDiff());\n\t\t// \t\tsingle.expand(single.root.id, Infinity);\n\t\t// \t\ttests.children!.splice(0, 1);\n\t\t// \t\tsingle.onItemChange(tests, 'pid');\n\t\t// \t\tsingle.expand(single.root.id, Infinity);\n\t\t// \t\tm.apply(single.collectDiff());\n\n\t\t// \t\tassertTreesEqual(m.rootTestItems[0], owned.getTestById(single.root.id)![1].actual);\n\t\t// \t\tassert.strictEqual(m.length, single.itemToInternal.size);\n\t\t// \t});\n\n\t\t// \ttest('mirrors node addition', () => {\n\t\t// \t\tconst tests = testStubs.nested();\n\t\t// \t\tsingle.addRoot(tests, 'pid');\n\t\t// \t\tm.apply(single.collectDiff());\n\t\t// \t\ttests.children![0].children!.push(stubTest('ac'));\n\t\t// \t\tsingle.onItemChange(tests, 'pid');\n\t\t// \t\tm.apply(single.collectDiff());\n\n\t\t// \t\tassertTreesEqual(m.rootTestItems[0], owned.getTestById(single.root.id)![1].actual);\n\t\t// \t\tassert.strictEqual(m.length, single.itemToInternal.size);\n\t\t// \t});\n\n\t\t// \ttest('mirrors node update', () => {\n\t\t// \t\tconst tests = testStubs.nested();\n\t\t// \t\tsingle.addRoot(tests, 'pid');\n\t\t// \t\tm.apply(single.collectDiff());\n\t\t// \t\ttests.children![0].description = 'Hello world'; /* item a */\n\t\t// \t\tsingle.onItemChange(tests, 'pid');\n\t\t// \t\tm.apply(single.collectDiff());\n\n\t\t// \t\tassertTreesEqual(m.rootTestItems[0], owned.getTestById(single.root.id)![1].actual);\n\t\t// \t});\n\n\t\t// \tsuite('MirroredChangeCollector', () => {\n\t\t// \t\tlet tests = testStubs.nested();\n\t\t// \t\tsetup(() => {\n\t\t// \t\t\ttests = testStubs.nested();\n\t\t// \t\t\tsingle.addRoot(tests, 'pid');\n\t\t// \t\t\tm.apply(single.collectDiff());\n\t\t// \t\t});\n\n\t\t// \t\ttest('creates change for root', () => {\n\t\t// \t\t\tassertTreeListEqual(m.changeEvent.added, [\n\t\t// \t\t\t\ttests,\n\t\t// \t\t\t\ttests.children[0],\n\t\t// \t\t\t\ttests.children![0].children![0],\n\t\t// \t\t\t\ttests.children![0].children![1],\n\t\t// \t\t\t\ttests.children[1],\n\t\t// \t\t\t]);\n\t\t// \t\t\tassertTreeListEqual(m.changeEvent.removed, []);\n\t\t// \t\t\tassertTreeListEqual(m.changeEvent.updated, []);\n\t\t// \t\t});\n\n\t\t// \t\ttest('creates change for delete', () => {\n\t\t// \t\t\tconst rm = tests.children.shift()!;\n\t\t// \t\t\tsingle.onItemChange(tests, 'pid');\n\t\t// \t\t\tm.apply(single.collectDiff());\n\n\t\t// \t\t\tassertTreeListEqual(m.changeEvent.added, []);\n\t\t// \t\t\tassertTreeListEqual(m.changeEvent.removed, [\n\t\t// \t\t\t\t{ ...rm },\n\t\t// \t\t\t\t{ ...rm.children![0] },\n\t\t// \t\t\t\t{ ...rm.children![1] },\n\t\t// \t\t\t]);\n\t\t// \t\t\tassertTreeListEqual(m.changeEvent.updated, []);\n\t\t// \t\t});\n\n\t\t// \t\ttest('creates change for update', () => {\n\t\t// \t\t\ttests.children[0].label = 'updated!';\n\t\t// \t\t\tsingle.onItemChange(tests, 'pid');\n\t\t// \t\t\tm.apply(single.collectDiff());\n\n\t\t// \t\t\tassertTreeListEqual(m.changeEvent.added, []);\n\t\t// \t\t\tassertTreeListEqual(m.changeEvent.removed, []);\n\t\t// \t\t\tassertTreeListEqual(m.changeEvent.updated, [tests.children[0]]);\n\t\t// \t\t});\n\n\t\t// \t\ttest('is a no-op if a node is added and removed', () => {\n\t\t// \t\t\tconst nested = testStubs.nested('id2-');\n\t\t// \t\t\ttests.children.push(nested);\n\t\t// \t\t\tsingle.onItemChange(tests, 'pid');\n\t\t// \t\t\ttests.children.pop();\n\t\t// \t\t\tsingle.onItemChange(tests, 'pid');\n\t\t// \t\t\tconst previousEvent = m.changeEvent;\n\t\t// \t\t\tm.apply(single.collectDiff());\n\t\t// \t\t\tassert.strictEqual(m.changeEvent, previousEvent);\n\t\t// \t\t});\n\n\t\t// \t\ttest('is a single-op if a node is added and changed', () => {\n\t\t// \t\t\tconst child = stubTest('c');\n\t\t// \t\t\ttests.children.push(child);\n\t\t// \t\t\tsingle.onItemChange(tests, 'pid');\n\t\t// \t\t\tchild.label = 'd';\n\t\t// \t\t\tsingle.onItemChange(tests, 'pid');\n\t\t// \t\t\tm.apply(single.collectDiff());\n\n\t\t// \t\t\tassertTreeListEqual(m.changeEvent.added, [child]);\n\t\t// \t\t\tassertTreeListEqual(m.changeEvent.removed, []);\n\t\t// \t\t\tassertTreeListEqual(m.changeEvent.updated, []);\n\t\t// \t\t});\n\n\t\t// \t\ttest('gets the common ancestor (1)', () => {\n\t\t// \t\t\ttests.children![0].children![0].label = 'za';\n\t\t// \t\t\ttests.children![0].children![1].label = 'zb';\n\t\t// \t\t\tsingle.onItemChange(tests, 'pid');\n\t\t// \t\t\tm.apply(single.collectDiff());\n\n\t\t// \t\t});\n\n\t\t// \t\ttest('gets the common ancestor (2)', () => {\n\t\t// \t\t\ttests.children![0].children![0].label = 'za';\n\t\t// \t\t\ttests.children![1].label = 'ab';\n\t\t// \t\t\tsingle.onItemChange(tests, 'pid');\n\t\t// \t\t\tm.apply(single.collectDiff());\n\t\t// \t\t});\n\t\t// \t});\n\t});\n\n\tsuite('TestRunTracker', () => {\n\t\tlet proxy: MockObject<MainThreadTestingShape>;\n\t\tlet c: TestRunCoordinator;\n\t\tlet cts: CancellationTokenSource;\n\t\tlet configuration: TestRunProfileImpl;\n\n\t\tlet req: TestRunRequest;\n\n\t\tlet dto: TestRunDto;\n\t\t// eslint-disable-next-line local/code-no-any-casts\n\t\tconst ext: IExtensionDescription = {} as any;\n\n\t\tteardown(() => {\n\t\t\tfor (const { id } of c.trackers) {\n\t\t\t\tc.disposeTestRun(id);\n\t\t\t}\n\t\t});\n\n\t\tsetup(async () => {\n\t\t\tproxy = mockObject<MainThreadTestingShape>()();\n\t\t\tcts = new CancellationTokenSource();\n\t\t\tc = new TestRunCoordinator(proxy, new NullLogService());\n\n\t\t\tconfiguration = new TestRunProfileImpl(mockObject<MainThreadTestingShape>()(), new Map(), new Set(), Event.None, 'ctrlId', 42, 'Do Run', TestRunProfileKind.Run, () => { }, false);\n\n\t\t\tawait single.expand(single.root.id, Infinity);\n\t\t\tsingle.collectDiff();\n\n\t\t\treq = {\n\t\t\t\tinclude: undefined,\n\t\t\t\texclude: [single.root.children.get('id-b')!],\n\t\t\t\tprofile: configuration,\n\t\t\t\tpreserveFocus: false,\n\t\t\t};\n\n\t\t\tdto = TestRunDto.fromInternal({\n\t\t\t\tcontrollerId: 'ctrl',\n\t\t\t\tprofileId: configuration.profileId,\n\t\t\t\texcludeExtIds: ['id-b'],\n\t\t\t\trunId: 'run-id',\n\t\t\t\ttestIds: [single.root.id],\n\t\t\t}, single);\n\t\t});\n\n\t\ttest('tracks a run started from a main thread request', () => {\n\t\t\tconst tracker = ds.add(c.prepareForMainThreadTestRun(ext, req, dto, configuration, cts.token));\n\t\t\tassert.strictEqual(tracker.hasRunningTasks, false);\n\n\t\t\tconst task1 = c.createTestRun(ext, 'ctrl', single, req, 'run1', true);\n\t\t\tconst task2 = c.createTestRun(ext, 'ctrl', single, req, 'run2', true);\n\t\t\tassert.strictEqual(proxy.$startedExtensionTestRun.called, false);\n\t\t\tassert.strictEqual(tracker.hasRunningTasks, true);\n\n\t\t\ttask1.appendOutput('hello');\n\t\t\tconst taskId = proxy.$appendOutputToRun.args[0]?.[1];\n\t\t\tassert.deepStrictEqual([['run-id', taskId, VSBuffer.fromString('hello'), undefined, undefined]], proxy.$appendOutputToRun.args);\n\t\t\ttask1.end();\n\n\t\t\tassert.strictEqual(proxy.$finishedExtensionTestRun.called, false);\n\t\t\tassert.strictEqual(tracker.hasRunningTasks, true);\n\n\t\t\ttask2.end();\n\n\t\t\tassert.strictEqual(proxy.$finishedExtensionTestRun.called, false);\n\t\t\tassert.strictEqual(tracker.hasRunningTasks, false);\n\t\t});\n\n\t\ttest('run cancel force ends after a timeout', () => {\n\t\t\tconst clock = sinon.useFakeTimers();\n\t\t\ttry {\n\t\t\t\tconst tracker = ds.add(c.prepareForMainThreadTestRun(ext, req, dto, configuration, cts.token));\n\t\t\t\tconst task = c.createTestRun(ext, 'ctrl', single, req, 'run1', true);\n\t\t\t\tconst onEnded = sinon.stub();\n\t\t\t\tds.add(tracker.onEnd(onEnded));\n\n\t\t\t\tassert.strictEqual(task.token.isCancellationRequested, false);\n\t\t\t\tassert.strictEqual(tracker.hasRunningTasks, true);\n\t\t\t\ttracker.cancel();\n\n\t\t\t\tassert.strictEqual(task.token.isCancellationRequested, true);\n\t\t\t\tassert.strictEqual(tracker.hasRunningTasks, true);\n\n\t\t\t\tclock.tick(9999);\n\t\t\t\tassert.strictEqual(tracker.hasRunningTasks, true);\n\t\t\t\tassert.strictEqual(onEnded.called, false);\n\n\t\t\t\tclock.tick(1);\n\t\t\t\tassert.strictEqual(onEnded.called, true);\n\t\t\t\tassert.strictEqual(tracker.hasRunningTasks, false);\n\t\t\t} finally {\n\t\t\t\tclock.restore();\n\t\t\t}\n\t\t});\n\n\t\ttest('run cancel force ends on second cancellation request', () => {\n\t\t\tconst tracker = ds.add(c.prepareForMainThreadTestRun(ext, req, dto, configuration, cts.token));\n\t\t\tconst task = c.createTestRun(ext, 'ctrl', single, req, 'run1', true);\n\t\t\tconst onEnded = sinon.stub();\n\t\t\tds.add(tracker.onEnd(onEnded));\n\n\t\t\tassert.strictEqual(task.token.isCancellationRequested, false);\n\t\t\tassert.strictEqual(tracker.hasRunningTasks, true);\n\t\t\ttracker.cancel();\n\n\t\t\tassert.strictEqual(task.token.isCancellationRequested, true);\n\t\t\tassert.strictEqual(tracker.hasRunningTasks, true);\n\t\t\tassert.strictEqual(onEnded.called, false);\n\t\t\ttracker.cancel();\n\n\t\t\tassert.strictEqual(tracker.hasRunningTasks, false);\n\t\t\tassert.strictEqual(onEnded.called, true);\n\t\t});\n\n\t\ttest('tracks a run started from an extension request', () => {\n\t\t\tconst task1 = c.createTestRun(ext, 'ctrl', single, req, 'hello world', false);\n\n\t\t\tconst tracker = Iterable.first(c.trackers)!;\n\t\t\tassert.strictEqual(tracker.hasRunningTasks, true);\n\t\t\tassert.deepStrictEqual(proxy.$startedExtensionTestRun.args, [\n\t\t\t\t[{\n\t\t\t\t\tprofile: { group: 2, id: 42 },\n\t\t\t\t\tcontrollerId: 'ctrl',\n\t\t\t\t\tid: tracker.id,\n\t\t\t\t\tinclude: [single.root.id],\n\t\t\t\t\texclude: [new TestId(['ctrlId', 'id-b']).toString()],\n\t\t\t\t\tpersist: false,\n\t\t\t\t\tcontinuous: false,\n\t\t\t\t\tpreserveFocus: false,\n\t\t\t\t}]\n\t\t\t]);\n\n\t\t\tconst task2 = c.createTestRun(ext, 'ctrl', single, req, 'run2', true);\n\t\t\tconst task3Detached = c.createTestRun(ext, 'ctrl', single, { ...req }, 'task3Detached', true);\n\n\t\t\ttask1.end();\n\t\t\tassert.strictEqual(proxy.$finishedExtensionTestRun.called, false);\n\t\t\tassert.strictEqual(tracker.hasRunningTasks, true);\n\n\t\t\ttask2.end();\n\t\t\tassert.deepStrictEqual(proxy.$finishedExtensionTestRun.args, [[tracker.id]]);\n\t\t\tassert.strictEqual(tracker.hasRunningTasks, false);\n\n\t\t\ttask3Detached.end();\n\t\t});\n\n\t\ttest('adds tests to run smartly', () => {\n\t\t\tconst task1 = c.createTestRun(ext, 'ctrlId', single, req, 'hello world', false);\n\t\t\tconst tracker = Iterable.first(c.trackers)!;\n\t\t\tconst expectedArgs: unknown[][] = [];\n\t\t\tassert.deepStrictEqual(proxy.$addTestsToRun.args, expectedArgs);\n\n\t\t\ttask1.passed(single.root.children.get('id-a')!.children.get('id-aa')!);\n\t\t\texpectedArgs.push([\n\t\t\t\t'ctrlId',\n\t\t\t\ttracker.id,\n\t\t\t\t[\n\t\t\t\t\tconvert.TestItem.from(single.root),\n\t\t\t\t\tconvert.TestItem.from(single.root.children.get('id-a') as TestItemImpl),\n\t\t\t\t\tconvert.TestItem.from(single.root.children.get('id-a')!.children.get('id-aa') as TestItemImpl),\n\t\t\t\t]\n\t\t\t]);\n\t\t\tassert.deepStrictEqual(proxy.$addTestsToRun.args, expectedArgs);\n\n\t\t\ttask1.enqueued(single.root.children.get('id-a')!.children.get('id-ab')!);\n\t\t\texpectedArgs.push([\n\t\t\t\t'ctrlId',\n\t\t\t\ttracker.id,\n\t\t\t\t[\n\t\t\t\t\tconvert.TestItem.from(single.root.children.get('id-a') as TestItemImpl),\n\t\t\t\t\tconvert.TestItem.from(single.root.children.get('id-a')!.children.get('id-ab') as TestItemImpl),\n\t\t\t\t],\n\t\t\t]);\n\t\t\tassert.deepStrictEqual(proxy.$addTestsToRun.args, expectedArgs);\n\n\t\t\ttask1.passed(single.root.children.get('id-a')!.children.get('id-ab')!);\n\t\t\tassert.deepStrictEqual(proxy.$addTestsToRun.args, expectedArgs);\n\n\t\t\ttask1.end();\n\t\t});\n\n\t\ttest('adds test messages to run', () => {\n\t\t\tconst test1 = new TestItemImpl('ctrlId', 'id-c', 'test c', URI.file('/testc.txt'));\n\t\t\tconst test2 = new TestItemImpl('ctrlId', 'id-d', 'test d', URI.file('/testd.txt'));\n\t\t\ttest1.range = test2.range = new Range(new Position(0, 0), new Position(1, 0));\n\t\t\tsingle.root.children.replace([test1, test2]);\n\t\t\tconst task = c.createTestRun(ext, 'ctrlId', single, req, 'hello world', false);\n\n\t\t\tconst message1 = new TestMessage('some message');\n\t\t\tmessage1.location = new Location(URI.file('/a.txt'), new Position(0, 0));\n\t\t\ttask.failed(test1, message1);\n\n\t\t\tconst args = proxy.$appendTestMessagesInRun.args[0];\n\t\t\tassert.deepStrictEqual(proxy.$appendTestMessagesInRun.args[0], [\n\t\t\t\targs[0],\n\t\t\t\targs[1],\n\t\t\t\tnew TestId(['ctrlId', 'id-c']).toString(),\n\t\t\t\t[{\n\t\t\t\t\tmessage: 'some message',\n\t\t\t\t\ttype: TestMessageType.Error,\n\t\t\t\t\texpected: undefined,\n\t\t\t\t\tcontextValue: undefined,\n\t\t\t\t\tactual: undefined,\n\t\t\t\t\tlocation: convert.location.from(message1.location),\n\t\t\t\t\tstackTrace: undefined,\n\t\t\t\t}]\n\t\t\t]);\n\n\t\t\t// should use test location as default\n\t\t\ttask.failed(test2, new TestMessage('some message'));\n\t\t\tassert.deepStrictEqual(proxy.$appendTestMessagesInRun.args[1], [\n\t\t\t\targs[0],\n\t\t\t\targs[1],\n\t\t\t\tnew TestId(['ctrlId', 'id-d']).toString(),\n\t\t\t\t[{\n\t\t\t\t\tmessage: 'some message',\n\t\t\t\t\ttype: TestMessageType.Error,\n\t\t\t\t\tcontextValue: undefined,\n\t\t\t\t\texpected: undefined,\n\t\t\t\t\tactual: undefined,\n\t\t\t\t\tlocation: convert.location.from({ uri: test2.uri!, range: test2.range }),\n\t\t\t\t\tstackTrace: undefined,\n\t\t\t\t}]\n\t\t\t]);\n\n\t\t\ttask.end();\n\t\t});\n\n\t\ttest('guards calls after runs are ended', () => {\n\t\t\tconst task = c.createTestRun(ext, 'ctrl', single, req, 'hello world', false);\n\t\t\ttask.end();\n\n\t\t\ttask.failed(single.root, new TestMessage('some message'));\n\t\t\ttask.appendOutput('output');\n\n\t\t\tassert.strictEqual(proxy.$addTestsToRun.called, false);\n\t\t\tassert.strictEqual(proxy.$appendOutputToRun.called, false);\n\t\t\tassert.strictEqual(proxy.$appendTestMessagesInRun.called, false);\n\t\t});\n\n\t\ttest('sets state of test with identical local IDs (#131827)', () => {\n\t\t\tconst testA = single.root.children.get('id-a');\n\t\t\tconst testB = single.root.children.get('id-b');\n\t\t\tconst childA = new TestItemImpl('ctrlId', 'id-child', 'child', undefined);\n\t\t\ttestA!.children.replace([childA]);\n\t\t\tconst childB = new TestItemImpl('ctrlId', 'id-child', 'child', undefined);\n\t\t\ttestB!.children.replace([childB]);\n\n\t\t\tconst task1 = c.createTestRun(ext, 'ctrl', single, new TestRunRequestImpl(), 'hello world', false);\n\t\t\tconst tracker = Iterable.first(c.trackers)!;\n\n\t\t\ttask1.passed(childA);\n\t\t\ttask1.passed(childB);\n\t\t\tassert.deepStrictEqual(proxy.$addTestsToRun.args, [\n\t\t\t\t[\n\t\t\t\t\t'ctrl',\n\t\t\t\t\ttracker.id,\n\t\t\t\t\t[single.root, testA, childA].map(t => convert.TestItem.from(t as TestItemImpl)),\n\t\t\t\t],\n\t\t\t\t[\n\t\t\t\t\t'ctrl',\n\t\t\t\t\ttracker.id,\n\t\t\t\t\t[single.root, testB, childB].map(t => convert.TestItem.from(t as TestItemImpl)),\n\t\t\t\t],\n\t\t\t]);\n\n\t\t\ttask1.end();\n\t\t});\n\t});\n\n\tsuite('service', () => {\n\t\tlet ctrl: TestExtHostTesting;\n\n\t\tclass TestExtHostTesting extends ExtHostTesting {\n\t\t\tpublic getProfileInternalId(ctrl: TestController, profile: TestRunProfile) {\n\t\t\t\tfor (const [id, p] of this.controllers.get(ctrl.id)!.profiles) {\n\t\t\t\t\tif (profile === p) {\n\t\t\t\t\t\treturn id;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tthrow new Error('profile not found');\n\t\t\t}\n\t\t}\n\n\t\tsetup(() => {\n\t\t\tconst rpcProtocol = AnyCallRPCProtocol();\n\t\t\tctrl = ds.add(new TestExtHostTesting(\n\t\t\t\trpcProtocol,\n\t\t\t\tnew NullLogService(),\n\t\t\t\tnew ExtHostCommands(rpcProtocol, new NullLogService(), new class extends mock<IExtHostTelemetry>() {\n\t\t\t\t\toverride onExtensionError(): boolean {\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\t\t\t\t}),\n\t\t\t\tnew ExtHostDocumentsAndEditors(rpcProtocol, new NullLogService()),\n\t\t\t));\n\t\t});\n\n\t\ttest('exposes active profiles correctly', async () => {\n\t\t\tconst extA = { ...nullExtensionDescription, identifier: new ExtensionIdentifier('ext.a'), enabledApiProposals: ['testingActiveProfile'] };\n\t\t\tconst extB = { ...nullExtensionDescription, identifier: new ExtensionIdentifier('ext.b'), enabledApiProposals: ['testingActiveProfile'] };\n\n\t\t\tconst ctrlA = ds.add(ctrl.createTestController(extA, 'a', 'ctrla'));\n\t\t\tconst profAA = ds.add(ctrlA.createRunProfile('aa', TestRunProfileKind.Run, () => { }));\n\t\t\tconst profAB = ds.add(ctrlA.createRunProfile('ab', TestRunProfileKind.Run, () => { }));\n\n\t\t\tconst ctrlB = ds.add(ctrl.createTestController(extB, 'b', 'ctrlb'));\n\t\t\tconst profBA = ds.add(ctrlB.createRunProfile('ba', TestRunProfileKind.Run, () => { }));\n\t\t\tconst profBB = ds.add(ctrlB.createRunProfile('bb', TestRunProfileKind.Run, () => { }));\n\t\t\tconst neverCalled = sinon.stub();\n\n\t\t\t// empty default state:\n\t\t\tassert.deepStrictEqual(profAA.isDefault, false);\n\t\t\tassert.deepStrictEqual(profBA.isDefault, false);\n\t\t\tassert.deepStrictEqual(profBB.isDefault, false);\n\n\t\t\t// fires a change event:\n\t\t\tconst changeA = Event.toPromise(profAA.onDidChangeDefault as Event<boolean>);\n\t\t\tconst changeBA = Event.toPromise(profBA.onDidChangeDefault as Event<boolean>);\n\t\t\tconst changeBB = Event.toPromise(profBB.onDidChangeDefault as Event<boolean>);\n\n\t\t\tds.add(profAB.onDidChangeDefault(neverCalled));\n\t\t\tassert.strictEqual(neverCalled.called, false);\n\n\t\t\tctrl.$setDefaultRunProfiles({\n\t\t\t\ta: [ctrl.getProfileInternalId(ctrlA, profAA)],\n\t\t\t\tb: [ctrl.getProfileInternalId(ctrlB, profBA), ctrl.getProfileInternalId(ctrlB, profBB)]\n\t\t\t});\n\n\t\t\tassert.deepStrictEqual(await changeA, true);\n\t\t\tassert.deepStrictEqual(await changeBA, true);\n\t\t\tassert.deepStrictEqual(await changeBB, true);\n\n\t\t\t// updates internal state:\n\t\t\tassert.deepStrictEqual(profAA.isDefault, true);\n\t\t\tassert.deepStrictEqual(profBA.isDefault, true);\n\t\t\tassert.deepStrictEqual(profBB.isDefault, true);\n\t\t\tassert.deepStrictEqual(profAB.isDefault, false);\n\n\t\t\t// no-ops if equal\n\t\t\tds.add(profAA.onDidChangeDefault(neverCalled));\n\t\t\tctrl.$setDefaultRunProfiles({\n\t\t\t\ta: [ctrl.getProfileInternalId(ctrlA, profAA)],\n\t\t\t});\n\t\t\tassert.strictEqual(neverCalled.called, false);\n\t\t});\n\t});\n});\n"]}