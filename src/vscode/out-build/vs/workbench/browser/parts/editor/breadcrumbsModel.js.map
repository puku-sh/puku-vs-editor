{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/browser/parts/editor/breadcrumbsModel.ts","vs/workbench/browser/parts/editor/breadcrumbsModel.ts"],"names":[],"mappings":"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","file":"breadcrumbsModel.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { CancellationTokenSource } from '../../../../base/common/cancellation.js';\nimport { onUnexpectedError } from '../../../../base/common/errors.js';\nimport { Emitter, Event } from '../../../../base/common/event.js';\nimport { DisposableStore, MutableDisposable, toDisposable } from '../../../../base/common/lifecycle.js';\nimport { Schemas, matchesSomeScheme } from '../../../../base/common/network.js';\nimport { dirname, isEqual } from '../../../../base/common/resources.js';\nimport { URI } from '../../../../base/common/uri.js';\nimport { IConfigurationService } from '../../../../platform/configuration/common/configuration.js';\nimport { FileKind } from '../../../../platform/files/common/files.js';\nimport { IWorkspaceContextService, IWorkspaceFolder, WorkbenchState } from '../../../../platform/workspace/common/workspace.js';\nimport { BreadcrumbsConfig } from './breadcrumbs.js';\nimport { IEditorPane } from '../../../common/editor.js';\nimport { IOutline, IOutlineService, OutlineTarget } from '../../../services/outline/browser/outline.js';\n\nexport class FileElement {\n\tconstructor(\n\t\treadonly uri: URI,\n\t\treadonly kind: FileKind\n\t) { }\n}\n\ntype FileInfo = { path: FileElement[]; folder?: IWorkspaceFolder };\n\nexport class OutlineElement2 {\n\tconstructor(\n\t\treadonly element: IOutline<unknown> | unknown,\n\t\treadonly outline: IOutline<unknown>\n\t) { }\n}\n\nexport class BreadcrumbsModel {\n\n\tprivate readonly _disposables = new DisposableStore();\n\tprivate _fileInfo: FileInfo;\n\n\tprivate readonly _cfgFilePath: BreadcrumbsConfig<'on' | 'off' | 'last'>;\n\tprivate readonly _cfgSymbolPath: BreadcrumbsConfig<'on' | 'off' | 'last'>;\n\n\tprivate readonly _currentOutline = new MutableDisposable<IOutline<unknown>>();\n\tprivate readonly _outlineDisposables = new DisposableStore();\n\n\tprivate readonly _onDidUpdate = new Emitter<this>();\n\treadonly onDidUpdate: Event<this> = this._onDidUpdate.event;\n\n\tconstructor(\n\t\treadonly resource: URI,\n\t\treadonly editor: IEditorPane | undefined,\n\t\t@IConfigurationService configurationService: IConfigurationService,\n\t\t@IWorkspaceContextService private readonly _workspaceService: IWorkspaceContextService,\n\t\t@IOutlineService private readonly _outlineService: IOutlineService,\n\t) {\n\t\tthis._cfgFilePath = BreadcrumbsConfig.FilePath.bindTo(configurationService);\n\t\tthis._cfgSymbolPath = BreadcrumbsConfig.SymbolPath.bindTo(configurationService);\n\n\t\tthis._disposables.add(this._cfgFilePath.onDidChange(_ => this._onDidUpdate.fire(this)));\n\t\tthis._disposables.add(this._cfgSymbolPath.onDidChange(_ => this._onDidUpdate.fire(this)));\n\t\tthis._workspaceService.onDidChangeWorkspaceFolders(this._onDidChangeWorkspaceFolders, this, this._disposables);\n\t\tthis._fileInfo = this._initFilePathInfo(resource);\n\n\t\tif (editor) {\n\t\t\tthis._bindToEditor(editor);\n\t\t\tthis._disposables.add(_outlineService.onDidChange(() => this._bindToEditor(editor)));\n\t\t\tthis._disposables.add(editor.onDidChangeControl(() => this._bindToEditor(editor)));\n\t\t}\n\t\tthis._onDidUpdate.fire(this);\n\t}\n\n\tdispose(): void {\n\t\tthis._disposables.dispose();\n\t\tthis._cfgFilePath.dispose();\n\t\tthis._cfgSymbolPath.dispose();\n\t\tthis._currentOutline.dispose();\n\t\tthis._outlineDisposables.dispose();\n\t\tthis._onDidUpdate.dispose();\n\t}\n\n\tisRelative(): boolean {\n\t\treturn Boolean(this._fileInfo.folder);\n\t}\n\n\tgetElements(): ReadonlyArray<FileElement | OutlineElement2> {\n\t\tlet result: (FileElement | OutlineElement2)[] = [];\n\n\t\t// file path elements\n\t\tif (this._cfgFilePath.getValue() === 'on') {\n\t\t\tresult = result.concat(this._fileInfo.path);\n\t\t} else if (this._cfgFilePath.getValue() === 'last' && this._fileInfo.path.length > 0) {\n\t\t\tresult = result.concat(this._fileInfo.path.slice(-1));\n\t\t}\n\n\t\tif (this._cfgSymbolPath.getValue() === 'off') {\n\t\t\treturn result;\n\t\t}\n\n\t\tif (!this._currentOutline.value) {\n\t\t\treturn result;\n\t\t}\n\n\t\tconst breadcrumbsElements = this._currentOutline.value.config.breadcrumbsDataSource.getBreadcrumbElements();\n\t\tfor (let i = this._cfgSymbolPath.getValue() === 'last' && breadcrumbsElements.length > 0 ? breadcrumbsElements.length - 1 : 0; i < breadcrumbsElements.length; i++) {\n\t\t\tresult.push(new OutlineElement2(breadcrumbsElements[i], this._currentOutline.value));\n\t\t}\n\n\t\tif (breadcrumbsElements.length === 0 && !this._currentOutline.value.isEmpty) {\n\t\t\tresult.push(new OutlineElement2(this._currentOutline.value, this._currentOutline.value));\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tprivate _initFilePathInfo(uri: URI): FileInfo {\n\n\t\tif (matchesSomeScheme(uri, Schemas.untitled, Schemas.data)) {\n\t\t\treturn {\n\t\t\t\tfolder: undefined,\n\t\t\t\tpath: []\n\t\t\t};\n\t\t}\n\n\t\tconst info: FileInfo = {\n\t\t\tfolder: this._workspaceService.getWorkspaceFolder(uri) ?? undefined,\n\t\t\tpath: []\n\t\t};\n\n\t\tlet uriPrefix: URI | null = uri;\n\t\twhile (uriPrefix && uriPrefix.path !== '/') {\n\t\t\tif (info.folder && isEqual(info.folder.uri, uriPrefix)) {\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tinfo.path.unshift(new FileElement(uriPrefix, info.path.length === 0 ? FileKind.FILE : FileKind.FOLDER));\n\t\t\tconst prevPathLength = uriPrefix.path.length;\n\t\t\turiPrefix = dirname(uriPrefix);\n\t\t\tif (uriPrefix.path.length === prevPathLength) {\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\tif (info.folder && this._workspaceService.getWorkbenchState() === WorkbenchState.WORKSPACE) {\n\t\t\tinfo.path.unshift(new FileElement(info.folder.uri, FileKind.ROOT_FOLDER));\n\t\t}\n\t\treturn info;\n\t}\n\n\tprivate _onDidChangeWorkspaceFolders() {\n\t\tthis._fileInfo = this._initFilePathInfo(this.resource);\n\t\tthis._onDidUpdate.fire(this);\n\t}\n\n\tprivate _bindToEditor(editor: IEditorPane): void {\n\t\tconst newCts = new CancellationTokenSource();\n\t\tthis._currentOutline.clear();\n\t\tthis._outlineDisposables.clear();\n\t\tthis._outlineDisposables.add(toDisposable(() => newCts.dispose(true)));\n\n\t\tthis._outlineService.createOutline(editor, OutlineTarget.Breadcrumbs, newCts.token).then(outline => {\n\t\t\tif (newCts.token.isCancellationRequested) {\n\t\t\t\t// cancelled: dispose new outline and reset\n\t\t\t\toutline?.dispose();\n\t\t\t\toutline = undefined;\n\t\t\t}\n\t\t\tthis._currentOutline.value = outline;\n\t\t\tthis._onDidUpdate.fire(this);\n\t\t\tif (outline) {\n\t\t\t\tthis._outlineDisposables.add(outline.onDidChange(() => this._onDidUpdate.fire(this)));\n\t\t\t}\n\n\t\t}).catch(err => {\n\t\t\tthis._onDidUpdate.fire(this);\n\t\t\tonUnexpectedError(err);\n\t\t});\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { CancellationTokenSource } from '../../../../base/common/cancellation.js';\nimport { onUnexpectedError } from '../../../../base/common/errors.js';\nimport { Emitter, Event } from '../../../../base/common/event.js';\nimport { DisposableStore, MutableDisposable, toDisposable } from '../../../../base/common/lifecycle.js';\nimport { Schemas, matchesSomeScheme } from '../../../../base/common/network.js';\nimport { dirname, isEqual } from '../../../../base/common/resources.js';\nimport { URI } from '../../../../base/common/uri.js';\nimport { IConfigurationService } from '../../../../platform/configuration/common/configuration.js';\nimport { FileKind } from '../../../../platform/files/common/files.js';\nimport { IWorkspaceContextService, IWorkspaceFolder, WorkbenchState } from '../../../../platform/workspace/common/workspace.js';\nimport { BreadcrumbsConfig } from './breadcrumbs.js';\nimport { IEditorPane } from '../../../common/editor.js';\nimport { IOutline, IOutlineService, OutlineTarget } from '../../../services/outline/browser/outline.js';\n\nexport class FileElement {\n\tconstructor(\n\t\treadonly uri: URI,\n\t\treadonly kind: FileKind\n\t) { }\n}\n\ntype FileInfo = { path: FileElement[]; folder?: IWorkspaceFolder };\n\nexport class OutlineElement2 {\n\tconstructor(\n\t\treadonly element: IOutline<unknown> | unknown,\n\t\treadonly outline: IOutline<unknown>\n\t) { }\n}\n\nexport class BreadcrumbsModel {\n\n\tprivate readonly _disposables = new DisposableStore();\n\tprivate _fileInfo: FileInfo;\n\n\tprivate readonly _cfgFilePath: BreadcrumbsConfig<'on' | 'off' | 'last'>;\n\tprivate readonly _cfgSymbolPath: BreadcrumbsConfig<'on' | 'off' | 'last'>;\n\n\tprivate readonly _currentOutline = new MutableDisposable<IOutline<unknown>>();\n\tprivate readonly _outlineDisposables = new DisposableStore();\n\n\tprivate readonly _onDidUpdate = new Emitter<this>();\n\treadonly onDidUpdate: Event<this> = this._onDidUpdate.event;\n\n\tconstructor(\n\t\treadonly resource: URI,\n\t\treadonly editor: IEditorPane | undefined,\n\t\t@IConfigurationService configurationService: IConfigurationService,\n\t\t@IWorkspaceContextService private readonly _workspaceService: IWorkspaceContextService,\n\t\t@IOutlineService private readonly _outlineService: IOutlineService,\n\t) {\n\t\tthis._cfgFilePath = BreadcrumbsConfig.FilePath.bindTo(configurationService);\n\t\tthis._cfgSymbolPath = BreadcrumbsConfig.SymbolPath.bindTo(configurationService);\n\n\t\tthis._disposables.add(this._cfgFilePath.onDidChange(_ => this._onDidUpdate.fire(this)));\n\t\tthis._disposables.add(this._cfgSymbolPath.onDidChange(_ => this._onDidUpdate.fire(this)));\n\t\tthis._workspaceService.onDidChangeWorkspaceFolders(this._onDidChangeWorkspaceFolders, this, this._disposables);\n\t\tthis._fileInfo = this._initFilePathInfo(resource);\n\n\t\tif (editor) {\n\t\t\tthis._bindToEditor(editor);\n\t\t\tthis._disposables.add(_outlineService.onDidChange(() => this._bindToEditor(editor)));\n\t\t\tthis._disposables.add(editor.onDidChangeControl(() => this._bindToEditor(editor)));\n\t\t}\n\t\tthis._onDidUpdate.fire(this);\n\t}\n\n\tdispose(): void {\n\t\tthis._disposables.dispose();\n\t\tthis._cfgFilePath.dispose();\n\t\tthis._cfgSymbolPath.dispose();\n\t\tthis._currentOutline.dispose();\n\t\tthis._outlineDisposables.dispose();\n\t\tthis._onDidUpdate.dispose();\n\t}\n\n\tisRelative(): boolean {\n\t\treturn Boolean(this._fileInfo.folder);\n\t}\n\n\tgetElements(): ReadonlyArray<FileElement | OutlineElement2> {\n\t\tlet result: (FileElement | OutlineElement2)[] = [];\n\n\t\t// file path elements\n\t\tif (this._cfgFilePath.getValue() === 'on') {\n\t\t\tresult = result.concat(this._fileInfo.path);\n\t\t} else if (this._cfgFilePath.getValue() === 'last' && this._fileInfo.path.length > 0) {\n\t\t\tresult = result.concat(this._fileInfo.path.slice(-1));\n\t\t}\n\n\t\tif (this._cfgSymbolPath.getValue() === 'off') {\n\t\t\treturn result;\n\t\t}\n\n\t\tif (!this._currentOutline.value) {\n\t\t\treturn result;\n\t\t}\n\n\t\tconst breadcrumbsElements = this._currentOutline.value.config.breadcrumbsDataSource.getBreadcrumbElements();\n\t\tfor (let i = this._cfgSymbolPath.getValue() === 'last' && breadcrumbsElements.length > 0 ? breadcrumbsElements.length - 1 : 0; i < breadcrumbsElements.length; i++) {\n\t\t\tresult.push(new OutlineElement2(breadcrumbsElements[i], this._currentOutline.value));\n\t\t}\n\n\t\tif (breadcrumbsElements.length === 0 && !this._currentOutline.value.isEmpty) {\n\t\t\tresult.push(new OutlineElement2(this._currentOutline.value, this._currentOutline.value));\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tprivate _initFilePathInfo(uri: URI): FileInfo {\n\n\t\tif (matchesSomeScheme(uri, Schemas.untitled, Schemas.data)) {\n\t\t\treturn {\n\t\t\t\tfolder: undefined,\n\t\t\t\tpath: []\n\t\t\t};\n\t\t}\n\n\t\tconst info: FileInfo = {\n\t\t\tfolder: this._workspaceService.getWorkspaceFolder(uri) ?? undefined,\n\t\t\tpath: []\n\t\t};\n\n\t\tlet uriPrefix: URI | null = uri;\n\t\twhile (uriPrefix && uriPrefix.path !== '/') {\n\t\t\tif (info.folder && isEqual(info.folder.uri, uriPrefix)) {\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tinfo.path.unshift(new FileElement(uriPrefix, info.path.length === 0 ? FileKind.FILE : FileKind.FOLDER));\n\t\t\tconst prevPathLength = uriPrefix.path.length;\n\t\t\turiPrefix = dirname(uriPrefix);\n\t\t\tif (uriPrefix.path.length === prevPathLength) {\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\tif (info.folder && this._workspaceService.getWorkbenchState() === WorkbenchState.WORKSPACE) {\n\t\t\tinfo.path.unshift(new FileElement(info.folder.uri, FileKind.ROOT_FOLDER));\n\t\t}\n\t\treturn info;\n\t}\n\n\tprivate _onDidChangeWorkspaceFolders() {\n\t\tthis._fileInfo = this._initFilePathInfo(this.resource);\n\t\tthis._onDidUpdate.fire(this);\n\t}\n\n\tprivate _bindToEditor(editor: IEditorPane): void {\n\t\tconst newCts = new CancellationTokenSource();\n\t\tthis._currentOutline.clear();\n\t\tthis._outlineDisposables.clear();\n\t\tthis._outlineDisposables.add(toDisposable(() => newCts.dispose(true)));\n\n\t\tthis._outlineService.createOutline(editor, OutlineTarget.Breadcrumbs, newCts.token).then(outline => {\n\t\t\tif (newCts.token.isCancellationRequested) {\n\t\t\t\t// cancelled: dispose new outline and reset\n\t\t\t\toutline?.dispose();\n\t\t\t\toutline = undefined;\n\t\t\t}\n\t\t\tthis._currentOutline.value = outline;\n\t\t\tthis._onDidUpdate.fire(this);\n\t\t\tif (outline) {\n\t\t\t\tthis._outlineDisposables.add(outline.onDidChange(() => this._onDidUpdate.fire(this)));\n\t\t\t}\n\n\t\t}).catch(err => {\n\t\t\tthis._onDidUpdate.fire(this);\n\t\t\tonUnexpectedError(err);\n\t\t});\n\t}\n}\n"]}