{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/browser/parts/editor/editorCommandsContext.ts","vs/workbench/browser/parts/editor/editorCommandsContext.ts"],"names":[],"mappings":"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","file":"editorCommandsContext.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { getActiveElement } from '../../../../base/browser/dom.js';\nimport { List } from '../../../../base/browser/ui/list/listWidget.js';\nimport { URI } from '../../../../base/common/uri.js';\nimport { IListService } from '../../../../platform/list/browser/listService.js';\nimport { IEditorCommandsContext, isEditorCommandsContext, IEditorIdentifier, isEditorIdentifier } from '../../../common/editor.js';\nimport { EditorInput } from '../../../common/editor/editorInput.js';\nimport { IEditorGroup, IEditorGroupsService, isEditorGroup } from '../../../services/editor/common/editorGroupsService.js';\nimport { IEditorService } from '../../../services/editor/common/editorService.js';\n\nexport interface IResolvedEditorCommandsContext {\n\treadonly groupedEditors: {\n\t\treadonly group: IEditorGroup;\n\t\treadonly editors: EditorInput[];\n\t}[];\n\treadonly preserveFocus: boolean;\n}\n\nexport function resolveCommandsContext(commandArgs: unknown[], editorService: IEditorService, editorGroupsService: IEditorGroupsService, listService: IListService): IResolvedEditorCommandsContext {\n\n\tconst commandContext = getCommandsContext(commandArgs, editorService, editorGroupsService, listService);\n\tconst preserveFocus = commandContext.length ? commandContext[0].preserveFocus || false : false;\n\tconst resolvedContext: IResolvedEditorCommandsContext = { groupedEditors: [], preserveFocus };\n\n\tfor (const editorContext of commandContext) {\n\t\tconst groupAndEditor = getEditorAndGroupFromContext(editorContext, editorGroupsService);\n\t\tif (!groupAndEditor) {\n\t\t\tcontinue;\n\t\t}\n\n\t\tconst { group, editor } = groupAndEditor;\n\n\t\t// Find group context if already added\n\t\tlet groupContext = undefined;\n\t\tfor (const targetGroupContext of resolvedContext.groupedEditors) {\n\t\t\tif (targetGroupContext.group.id === group.id) {\n\t\t\t\tgroupContext = targetGroupContext;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\t// Otherwise add new group context\n\t\tif (!groupContext) {\n\t\t\tgroupContext = { group, editors: [] };\n\t\t\tresolvedContext.groupedEditors.push(groupContext);\n\t\t}\n\n\t\t// Add editor to group context\n\t\tif (editor) {\n\t\t\tgroupContext.editors.push(editor);\n\t\t}\n\t}\n\n\treturn resolvedContext;\n}\n\nfunction getCommandsContext(commandArgs: unknown[], editorService: IEditorService, editorGroupsService: IEditorGroupsService, listService: IListService): IEditorCommandsContext[] {\n\t// Figure out if command is executed from a list\n\tconst list = listService.lastFocusedList;\n\tlet isListAction = list instanceof List && list.getHTMLElement() === getActiveElement();\n\n\t// Get editor context for which the command was triggered\n\tlet editorContext = getEditorContextFromCommandArgs(commandArgs, isListAction, editorService, editorGroupsService, listService);\n\n\t// If the editor context can not be determind use the active editor\n\tif (!editorContext) {\n\t\tconst activeGroup = editorGroupsService.activeGroup;\n\t\tconst activeEditor = activeGroup.activeEditor;\n\t\teditorContext = { groupId: activeGroup.id, editorIndex: activeEditor ? activeGroup.getIndexOfEditor(activeEditor) : undefined };\n\t\tisListAction = false;\n\t}\n\n\tconst multiEditorContext = getMultiSelectContext(editorContext, isListAction, editorService, editorGroupsService, listService);\n\n\t// Make sure the command context is the first one in the list\n\treturn moveCurrentEditorContextToFront(editorContext, multiEditorContext);\n}\n\nfunction moveCurrentEditorContextToFront(editorContext: IEditorCommandsContext, multiEditorContext: IEditorCommandsContext[]): IEditorCommandsContext[] {\n\tif (multiEditorContext.length <= 1) {\n\t\treturn multiEditorContext;\n\t}\n\n\tconst editorContextIndex = multiEditorContext.findIndex(context =>\n\t\tcontext.groupId === editorContext.groupId &&\n\t\tcontext.editorIndex === editorContext.editorIndex\n\t);\n\n\tif (editorContextIndex !== -1) {\n\t\tmultiEditorContext.splice(editorContextIndex, 1);\n\t\tmultiEditorContext.unshift(editorContext);\n\t} else if (editorContext.editorIndex === undefined) {\n\t\tmultiEditorContext.unshift(editorContext);\n\t} else {\n\t\tthrow new Error('Editor context not found in multi editor context');\n\t}\n\n\treturn multiEditorContext;\n}\n\nfunction getEditorContextFromCommandArgs(commandArgs: unknown[], isListAction: boolean, editorService: IEditorService, editorGroupsService: IEditorGroupsService, listService: IListService): IEditorCommandsContext | undefined {\n\t// We only know how to extraxt the command context from URI and IEditorCommandsContext arguments\n\tconst filteredArgs = commandArgs.filter(arg => isEditorCommandsContext(arg) || URI.isUri(arg));\n\n\t// If the command arguments contain an editor context, use it\n\tfor (const arg of filteredArgs) {\n\t\tif (isEditorCommandsContext(arg)) {\n\t\t\treturn arg;\n\t\t}\n\t}\n\n\t// Otherwise, try to find the editor group by the URI of the resource\n\tfor (const uri of filteredArgs as URI[]) {\n\t\tconst editorIdentifiers = editorService.findEditors(uri);\n\t\tif (editorIdentifiers.length) {\n\t\t\tconst editorIdentifier = editorIdentifiers[0];\n\t\t\tconst group = editorGroupsService.getGroup(editorIdentifier.groupId);\n\t\t\treturn { groupId: editorIdentifier.groupId, editorIndex: group?.getIndexOfEditor(editorIdentifier.editor) };\n\t\t}\n\t}\n\n\t// If there is no context in the arguments, try to find the context from the focused list\n\t// if the action was executed from a list\n\tif (isListAction) {\n\t\tconst list = listService.lastFocusedList as List<unknown>;\n\t\tfor (const focusedElement of list.getFocusedElements()) {\n\t\t\tif (isGroupOrEditor(focusedElement)) {\n\t\t\t\treturn groupOrEditorToEditorContext(focusedElement, undefined, editorGroupsService);\n\t\t\t}\n\t\t}\n\t}\n\n\treturn undefined;\n}\n\nfunction getMultiSelectContext(editorContext: IEditorCommandsContext, isListAction: boolean, editorService: IEditorService, editorGroupsService: IEditorGroupsService, listService: IListService): IEditorCommandsContext[] {\n\n\t// If the action was executed from a list, return all selected editors\n\tif (isListAction) {\n\t\tconst list = listService.lastFocusedList as List<unknown>;\n\t\tconst selection = list.getSelectedElements().filter(isGroupOrEditor);\n\n\t\tif (selection.length > 1) {\n\t\t\treturn selection.map(e => groupOrEditorToEditorContext(e, editorContext.preserveFocus, editorGroupsService));\n\t\t}\n\n\t\tif (selection.length === 0) {\n\t\t\t// TODO@benibenj workaround for https://github.com/microsoft/vscode/issues/224050\n\t\t\t// Explainer: the `isListAction` flag can be a false positive in certain cases because\n\t\t\t// it will be `true` if the active element is a `List` even if it is part of the editor\n\t\t\t// area. The workaround here is to fallback to `isListAction: false` if the list is not\n\t\t\t// having any editor or group selected.\n\t\t\treturn getMultiSelectContext(editorContext, false, editorService, editorGroupsService, listService);\n\t\t}\n\t}\n\t// Check editors selected in the group (tabs)\n\telse {\n\t\tconst group = editorGroupsService.getGroup(editorContext.groupId);\n\t\tconst editor = editorContext.editorIndex !== undefined ? group?.getEditorByIndex(editorContext.editorIndex) : group?.activeEditor;\n\t\t// If the editor is selected, return all selected editors otherwise only use the editors context\n\t\tif (group && editor && group.isSelected(editor)) {\n\t\t\treturn group.selectedEditors.map(editor => groupOrEditorToEditorContext({ editor, groupId: group.id }, editorContext.preserveFocus, editorGroupsService));\n\t\t}\n\t}\n\n\t// Otherwise go with passed in context\n\treturn [editorContext];\n}\n\nfunction groupOrEditorToEditorContext(element: IEditorIdentifier | IEditorGroup, preserveFocus: boolean | undefined, editorGroupsService: IEditorGroupsService): IEditorCommandsContext {\n\tif (isEditorGroup(element)) {\n\t\treturn { groupId: element.id, editorIndex: undefined, preserveFocus };\n\t}\n\n\tconst group = editorGroupsService.getGroup(element.groupId);\n\n\treturn { groupId: element.groupId, editorIndex: group ? group.getIndexOfEditor(element.editor) : -1, preserveFocus };\n}\n\nfunction isGroupOrEditor(element: unknown): element is IEditorIdentifier | IEditorGroup {\n\treturn isEditorGroup(element) || isEditorIdentifier(element);\n}\n\nfunction getEditorAndGroupFromContext(commandContext: IEditorCommandsContext, editorGroupsService: IEditorGroupsService): { group: IEditorGroup; editor: EditorInput | undefined } | undefined {\n\tconst group = editorGroupsService.getGroup(commandContext.groupId);\n\tif (!group) {\n\t\treturn undefined;\n\t}\n\n\tif (commandContext.editorIndex === undefined) {\n\t\treturn { group, editor: undefined };\n\t}\n\n\tconst editor = group.getEditorByIndex(commandContext.editorIndex);\n\treturn { group, editor };\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { getActiveElement } from '../../../../base/browser/dom.js';\nimport { List } from '../../../../base/browser/ui/list/listWidget.js';\nimport { URI } from '../../../../base/common/uri.js';\nimport { IListService } from '../../../../platform/list/browser/listService.js';\nimport { IEditorCommandsContext, isEditorCommandsContext, IEditorIdentifier, isEditorIdentifier } from '../../../common/editor.js';\nimport { EditorInput } from '../../../common/editor/editorInput.js';\nimport { IEditorGroup, IEditorGroupsService, isEditorGroup } from '../../../services/editor/common/editorGroupsService.js';\nimport { IEditorService } from '../../../services/editor/common/editorService.js';\n\nexport interface IResolvedEditorCommandsContext {\n\treadonly groupedEditors: {\n\t\treadonly group: IEditorGroup;\n\t\treadonly editors: EditorInput[];\n\t}[];\n\treadonly preserveFocus: boolean;\n}\n\nexport function resolveCommandsContext(commandArgs: unknown[], editorService: IEditorService, editorGroupsService: IEditorGroupsService, listService: IListService): IResolvedEditorCommandsContext {\n\n\tconst commandContext = getCommandsContext(commandArgs, editorService, editorGroupsService, listService);\n\tconst preserveFocus = commandContext.length ? commandContext[0].preserveFocus || false : false;\n\tconst resolvedContext: IResolvedEditorCommandsContext = { groupedEditors: [], preserveFocus };\n\n\tfor (const editorContext of commandContext) {\n\t\tconst groupAndEditor = getEditorAndGroupFromContext(editorContext, editorGroupsService);\n\t\tif (!groupAndEditor) {\n\t\t\tcontinue;\n\t\t}\n\n\t\tconst { group, editor } = groupAndEditor;\n\n\t\t// Find group context if already added\n\t\tlet groupContext = undefined;\n\t\tfor (const targetGroupContext of resolvedContext.groupedEditors) {\n\t\t\tif (targetGroupContext.group.id === group.id) {\n\t\t\t\tgroupContext = targetGroupContext;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\t// Otherwise add new group context\n\t\tif (!groupContext) {\n\t\t\tgroupContext = { group, editors: [] };\n\t\t\tresolvedContext.groupedEditors.push(groupContext);\n\t\t}\n\n\t\t// Add editor to group context\n\t\tif (editor) {\n\t\t\tgroupContext.editors.push(editor);\n\t\t}\n\t}\n\n\treturn resolvedContext;\n}\n\nfunction getCommandsContext(commandArgs: unknown[], editorService: IEditorService, editorGroupsService: IEditorGroupsService, listService: IListService): IEditorCommandsContext[] {\n\t// Figure out if command is executed from a list\n\tconst list = listService.lastFocusedList;\n\tlet isListAction = list instanceof List && list.getHTMLElement() === getActiveElement();\n\n\t// Get editor context for which the command was triggered\n\tlet editorContext = getEditorContextFromCommandArgs(commandArgs, isListAction, editorService, editorGroupsService, listService);\n\n\t// If the editor context can not be determind use the active editor\n\tif (!editorContext) {\n\t\tconst activeGroup = editorGroupsService.activeGroup;\n\t\tconst activeEditor = activeGroup.activeEditor;\n\t\teditorContext = { groupId: activeGroup.id, editorIndex: activeEditor ? activeGroup.getIndexOfEditor(activeEditor) : undefined };\n\t\tisListAction = false;\n\t}\n\n\tconst multiEditorContext = getMultiSelectContext(editorContext, isListAction, editorService, editorGroupsService, listService);\n\n\t// Make sure the command context is the first one in the list\n\treturn moveCurrentEditorContextToFront(editorContext, multiEditorContext);\n}\n\nfunction moveCurrentEditorContextToFront(editorContext: IEditorCommandsContext, multiEditorContext: IEditorCommandsContext[]): IEditorCommandsContext[] {\n\tif (multiEditorContext.length <= 1) {\n\t\treturn multiEditorContext;\n\t}\n\n\tconst editorContextIndex = multiEditorContext.findIndex(context =>\n\t\tcontext.groupId === editorContext.groupId &&\n\t\tcontext.editorIndex === editorContext.editorIndex\n\t);\n\n\tif (editorContextIndex !== -1) {\n\t\tmultiEditorContext.splice(editorContextIndex, 1);\n\t\tmultiEditorContext.unshift(editorContext);\n\t} else if (editorContext.editorIndex === undefined) {\n\t\tmultiEditorContext.unshift(editorContext);\n\t} else {\n\t\tthrow new Error('Editor context not found in multi editor context');\n\t}\n\n\treturn multiEditorContext;\n}\n\nfunction getEditorContextFromCommandArgs(commandArgs: unknown[], isListAction: boolean, editorService: IEditorService, editorGroupsService: IEditorGroupsService, listService: IListService): IEditorCommandsContext | undefined {\n\t// We only know how to extraxt the command context from URI and IEditorCommandsContext arguments\n\tconst filteredArgs = commandArgs.filter(arg => isEditorCommandsContext(arg) || URI.isUri(arg));\n\n\t// If the command arguments contain an editor context, use it\n\tfor (const arg of filteredArgs) {\n\t\tif (isEditorCommandsContext(arg)) {\n\t\t\treturn arg;\n\t\t}\n\t}\n\n\t// Otherwise, try to find the editor group by the URI of the resource\n\tfor (const uri of filteredArgs as URI[]) {\n\t\tconst editorIdentifiers = editorService.findEditors(uri);\n\t\tif (editorIdentifiers.length) {\n\t\t\tconst editorIdentifier = editorIdentifiers[0];\n\t\t\tconst group = editorGroupsService.getGroup(editorIdentifier.groupId);\n\t\t\treturn { groupId: editorIdentifier.groupId, editorIndex: group?.getIndexOfEditor(editorIdentifier.editor) };\n\t\t}\n\t}\n\n\t// If there is no context in the arguments, try to find the context from the focused list\n\t// if the action was executed from a list\n\tif (isListAction) {\n\t\tconst list = listService.lastFocusedList as List<unknown>;\n\t\tfor (const focusedElement of list.getFocusedElements()) {\n\t\t\tif (isGroupOrEditor(focusedElement)) {\n\t\t\t\treturn groupOrEditorToEditorContext(focusedElement, undefined, editorGroupsService);\n\t\t\t}\n\t\t}\n\t}\n\n\treturn undefined;\n}\n\nfunction getMultiSelectContext(editorContext: IEditorCommandsContext, isListAction: boolean, editorService: IEditorService, editorGroupsService: IEditorGroupsService, listService: IListService): IEditorCommandsContext[] {\n\n\t// If the action was executed from a list, return all selected editors\n\tif (isListAction) {\n\t\tconst list = listService.lastFocusedList as List<unknown>;\n\t\tconst selection = list.getSelectedElements().filter(isGroupOrEditor);\n\n\t\tif (selection.length > 1) {\n\t\t\treturn selection.map(e => groupOrEditorToEditorContext(e, editorContext.preserveFocus, editorGroupsService));\n\t\t}\n\n\t\tif (selection.length === 0) {\n\t\t\t// TODO@benibenj workaround for https://github.com/microsoft/vscode/issues/224050\n\t\t\t// Explainer: the `isListAction` flag can be a false positive in certain cases because\n\t\t\t// it will be `true` if the active element is a `List` even if it is part of the editor\n\t\t\t// area. The workaround here is to fallback to `isListAction: false` if the list is not\n\t\t\t// having any editor or group selected.\n\t\t\treturn getMultiSelectContext(editorContext, false, editorService, editorGroupsService, listService);\n\t\t}\n\t}\n\t// Check editors selected in the group (tabs)\n\telse {\n\t\tconst group = editorGroupsService.getGroup(editorContext.groupId);\n\t\tconst editor = editorContext.editorIndex !== undefined ? group?.getEditorByIndex(editorContext.editorIndex) : group?.activeEditor;\n\t\t// If the editor is selected, return all selected editors otherwise only use the editors context\n\t\tif (group && editor && group.isSelected(editor)) {\n\t\t\treturn group.selectedEditors.map(editor => groupOrEditorToEditorContext({ editor, groupId: group.id }, editorContext.preserveFocus, editorGroupsService));\n\t\t}\n\t}\n\n\t// Otherwise go with passed in context\n\treturn [editorContext];\n}\n\nfunction groupOrEditorToEditorContext(element: IEditorIdentifier | IEditorGroup, preserveFocus: boolean | undefined, editorGroupsService: IEditorGroupsService): IEditorCommandsContext {\n\tif (isEditorGroup(element)) {\n\t\treturn { groupId: element.id, editorIndex: undefined, preserveFocus };\n\t}\n\n\tconst group = editorGroupsService.getGroup(element.groupId);\n\n\treturn { groupId: element.groupId, editorIndex: group ? group.getIndexOfEditor(element.editor) : -1, preserveFocus };\n}\n\nfunction isGroupOrEditor(element: unknown): element is IEditorIdentifier | IEditorGroup {\n\treturn isEditorGroup(element) || isEditorIdentifier(element);\n}\n\nfunction getEditorAndGroupFromContext(commandContext: IEditorCommandsContext, editorGroupsService: IEditorGroupsService): { group: IEditorGroup; editor: EditorInput | undefined } | undefined {\n\tconst group = editorGroupsService.getGroup(commandContext.groupId);\n\tif (!group) {\n\t\treturn undefined;\n\t}\n\n\tif (commandContext.editorIndex === undefined) {\n\t\treturn { group, editor: undefined };\n\t}\n\n\tconst editor = group.getEditorByIndex(commandContext.editorIndex);\n\treturn { group, editor };\n}\n"]}