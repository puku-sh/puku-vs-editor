{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/browser/parts/editor/textResourceEditor.ts","vs/workbench/browser/parts/editor/textResourceEditor.ts"],"names":[],"mappings":"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","file":"textResourceEditor.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { assertReturnsDefined } from '../../../../base/common/types.js';\nimport { ICodeEditor, IPasteEvent } from '../../../../editor/browser/editorBrowser.js';\nimport { IEditorOpenContext, isTextEditorViewState } from '../../../common/editor.js';\nimport { EditorInput } from '../../../common/editor/editorInput.js';\nimport { applyTextEditorOptions } from '../../../common/editor/editorOptions.js';\nimport { AbstractTextResourceEditorInput, TextResourceEditorInput } from '../../../common/editor/textResourceEditorInput.js';\nimport { BaseTextEditorModel } from '../../../common/editor/textEditorModel.js';\nimport { UntitledTextEditorInput } from '../../../services/untitled/common/untitledTextEditorInput.js';\nimport { AbstractTextCodeEditor } from './textCodeEditor.js';\nimport { ITelemetryService } from '../../../../platform/telemetry/common/telemetry.js';\nimport { IStorageService } from '../../../../platform/storage/common/storage.js';\nimport { ITextResourceConfigurationService } from '../../../../editor/common/services/textResourceConfiguration.js';\nimport { IInstantiationService } from '../../../../platform/instantiation/common/instantiation.js';\nimport { IThemeService } from '../../../../platform/theme/common/themeService.js';\nimport { ScrollType, ICodeEditorViewState } from '../../../../editor/common/editorCommon.js';\nimport { IEditorGroup, IEditorGroupsService } from '../../../services/editor/common/editorGroupsService.js';\nimport { CancellationToken } from '../../../../base/common/cancellation.js';\nimport { IEditorService } from '../../../services/editor/common/editorService.js';\nimport { IModelService } from '../../../../editor/common/services/model.js';\nimport { ILanguageService } from '../../../../editor/common/languages/language.js';\nimport { PLAINTEXT_LANGUAGE_ID } from '../../../../editor/common/languages/modesRegistry.js';\nimport { EditorOption, IEditorOptions as ICodeEditorOptions } from '../../../../editor/common/config/editorOptions.js';\nimport { ModelConstants } from '../../../../editor/common/model.js';\nimport { ITextEditorOptions } from '../../../../platform/editor/common/editor.js';\nimport { IFileService } from '../../../../platform/files/common/files.js';\n\n/**\n * An editor implementation that is capable of showing the contents of resource inputs. Uses\n * the TextEditor widget to show the contents.\n */\nexport abstract class AbstractTextResourceEditor extends AbstractTextCodeEditor<ICodeEditorViewState> {\n\n\tconstructor(\n\t\tid: string,\n\t\tgroup: IEditorGroup,\n\t\t@ITelemetryService telemetryService: ITelemetryService,\n\t\t@IInstantiationService instantiationService: IInstantiationService,\n\t\t@IStorageService storageService: IStorageService,\n\t\t@ITextResourceConfigurationService textResourceConfigurationService: ITextResourceConfigurationService,\n\t\t@IThemeService themeService: IThemeService,\n\t\t@IEditorGroupsService editorGroupService: IEditorGroupsService,\n\t\t@IEditorService editorService: IEditorService,\n\t\t@IFileService fileService: IFileService\n\t) {\n\t\tsuper(id, group, telemetryService, instantiationService, storageService, textResourceConfigurationService, themeService, editorService, editorGroupService, fileService);\n\t}\n\n\toverride async setInput(input: AbstractTextResourceEditorInput, options: ITextEditorOptions | undefined, context: IEditorOpenContext, token: CancellationToken): Promise<void> {\n\n\t\t// Set input and resolve\n\t\tawait super.setInput(input, options, context, token);\n\t\tconst resolvedModel = await input.resolve();\n\n\t\t// Check for cancellation\n\t\tif (token.isCancellationRequested) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\t// Assert Model instance\n\t\tif (!(resolvedModel instanceof BaseTextEditorModel)) {\n\t\t\tthrow new Error('Unable to open file as text');\n\t\t}\n\n\t\t// Set Editor Model\n\t\tconst control = assertReturnsDefined(this.editorControl);\n\t\tconst textEditorModel = resolvedModel.textEditorModel;\n\t\tcontrol.setModel(textEditorModel);\n\n\t\t// Restore view state (unless provided by options)\n\t\tif (!isTextEditorViewState(options?.viewState)) {\n\t\t\tconst editorViewState = this.loadEditorViewState(input, context);\n\t\t\tif (editorViewState) {\n\t\t\t\tif (options?.selection) {\n\t\t\t\t\teditorViewState.cursorState = []; // prevent duplicate selections via options\n\t\t\t\t}\n\n\t\t\t\tcontrol.restoreViewState(editorViewState);\n\t\t\t}\n\t\t}\n\n\t\t// Apply options to editor if any\n\t\tif (options) {\n\t\t\tapplyTextEditorOptions(options, control, ScrollType.Immediate);\n\t\t}\n\n\t\t// Since the resolved model provides information about being readonly\n\t\t// or not, we apply it here to the editor even though the editor input\n\t\t// was already asked for being readonly or not. The rationale is that\n\t\t// a resolved model might have more specific information about being\n\t\t// readonly or not that the input did not have.\n\t\tcontrol.updateOptions(this.getReadonlyConfiguration(resolvedModel.isReadonly()));\n\t}\n\n\t/**\n\t * Reveals the last line of this editor if it has a model set.\n\t */\n\trevealLastLine(): void {\n\t\tconst control = this.editorControl;\n\t\tif (!control) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst model = control.getModel();\n\n\t\tif (model) {\n\t\t\tconst lastLine = model.getLineCount();\n\t\t\tcontrol.revealPosition({ lineNumber: lastLine, column: model.getLineMaxColumn(lastLine) }, ScrollType.Smooth);\n\t\t}\n\t}\n\n\toverride clearInput(): void {\n\t\tsuper.clearInput();\n\n\t\t// Clear Model\n\t\tthis.editorControl?.setModel(null);\n\t}\n\n\tprotected override tracksEditorViewState(input: EditorInput): boolean {\n\t\t// editor view state persistence is only enabled for untitled and resource inputs\n\t\treturn input instanceof UntitledTextEditorInput || input instanceof TextResourceEditorInput;\n\t}\n}\n\nexport class TextResourceEditor extends AbstractTextResourceEditor {\n\n\tstatic readonly ID = 'workbench.editors.textResourceEditor';\n\n\tconstructor(\n\t\tgroup: IEditorGroup,\n\t\t@ITelemetryService telemetryService: ITelemetryService,\n\t\t@IInstantiationService instantiationService: IInstantiationService,\n\t\t@IStorageService storageService: IStorageService,\n\t\t@ITextResourceConfigurationService textResourceConfigurationService: ITextResourceConfigurationService,\n\t\t@IThemeService themeService: IThemeService,\n\t\t@IEditorService editorService: IEditorService,\n\t\t@IEditorGroupsService editorGroupService: IEditorGroupsService,\n\t\t@IModelService private readonly modelService: IModelService,\n\t\t@ILanguageService private readonly languageService: ILanguageService,\n\t\t@IFileService fileService: IFileService\n\t) {\n\t\tsuper(TextResourceEditor.ID, group, telemetryService, instantiationService, storageService, textResourceConfigurationService, themeService, editorGroupService, editorService, fileService);\n\t}\n\n\tprotected override createEditorControl(parent: HTMLElement, configuration: ICodeEditorOptions): void {\n\t\tsuper.createEditorControl(parent, configuration);\n\n\t\t// Install a listener for paste to update this editors\n\t\t// language if the paste includes a specific language\n\t\tconst control = this.editorControl;\n\t\tif (control) {\n\t\t\tthis._register(control.onDidPaste(e => this.onDidEditorPaste(e, control)));\n\t\t}\n\t}\n\n\tprivate onDidEditorPaste(e: IPasteEvent, codeEditor: ICodeEditor): void {\n\t\tif (this.input instanceof UntitledTextEditorInput && this.input.hasLanguageSetExplicitly) {\n\t\t\treturn; // do not override language if it was set explicitly\n\t\t}\n\n\t\tif (e.range.startLineNumber !== 1 || e.range.startColumn !== 1) {\n\t\t\treturn; // document had existing content before the pasted text, don't override.\n\t\t}\n\n\t\tif (codeEditor.getOption(EditorOption.readOnly)) {\n\t\t\treturn; // not for readonly editors\n\t\t}\n\n\t\tconst textModel = codeEditor.getModel();\n\t\tif (!textModel) {\n\t\t\treturn; // require a live model\n\t\t}\n\n\t\tconst pasteIsWholeContents = textModel.getLineCount() === e.range.endLineNumber && textModel.getLineMaxColumn(e.range.endLineNumber) === e.range.endColumn;\n\t\tif (!pasteIsWholeContents) {\n\t\t\treturn; // document had existing content after the pasted text, don't override.\n\t\t}\n\n\t\tconst currentLanguageId = textModel.getLanguageId();\n\t\tif (currentLanguageId !== PLAINTEXT_LANGUAGE_ID) {\n\t\t\treturn; // require current languageId to be unspecific\n\t\t}\n\n\t\tlet candidateLanguage: { id: string; source: 'event' | 'guess' } | undefined = undefined;\n\n\t\t// A languageId is provided via the paste event so text was copied using\n\t\t// VSCode. As such we trust this languageId and use it if specific\n\t\tif (e.languageId) {\n\t\t\tcandidateLanguage = { id: e.languageId, source: 'event' };\n\t\t}\n\n\t\t// A languageId was not provided, so the data comes from outside VSCode\n\t\t// We can still try to guess a good languageId from the first line if\n\t\t// the paste changed the first line\n\t\telse {\n\t\t\tconst guess = this.languageService.guessLanguageIdByFilepathOrFirstLine(textModel.uri, textModel.getLineContent(1).substr(0, ModelConstants.FIRST_LINE_DETECTION_LENGTH_LIMIT)) ?? undefined;\n\t\t\tif (guess) {\n\t\t\t\tcandidateLanguage = { id: guess, source: 'guess' };\n\t\t\t}\n\t\t}\n\n\t\t// Finally apply languageId to model if specified\n\t\tif (candidateLanguage && candidateLanguage.id !== PLAINTEXT_LANGUAGE_ID) {\n\t\t\tif (this.input instanceof UntitledTextEditorInput && candidateLanguage.source === 'event') {\n\t\t\t\t// High confidence, set language id at TextEditorModel level to block future auto-detection\n\t\t\t\tthis.input.setLanguageId(candidateLanguage.id);\n\t\t\t} else {\n\t\t\t\ttextModel.setLanguage(this.languageService.createById(candidateLanguage.id));\n\t\t\t}\n\n\t\t\tconst opts = this.modelService.getCreationOptions(textModel.getLanguageId(), textModel.uri, textModel.isForSimpleWidget);\n\t\t\ttextModel.detectIndentation(opts.insertSpaces, opts.tabSize);\n\t\t}\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { assertReturnsDefined } from '../../../../base/common/types.js';\nimport { ICodeEditor, IPasteEvent } from '../../../../editor/browser/editorBrowser.js';\nimport { IEditorOpenContext, isTextEditorViewState } from '../../../common/editor.js';\nimport { EditorInput } from '../../../common/editor/editorInput.js';\nimport { applyTextEditorOptions } from '../../../common/editor/editorOptions.js';\nimport { AbstractTextResourceEditorInput, TextResourceEditorInput } from '../../../common/editor/textResourceEditorInput.js';\nimport { BaseTextEditorModel } from '../../../common/editor/textEditorModel.js';\nimport { UntitledTextEditorInput } from '../../../services/untitled/common/untitledTextEditorInput.js';\nimport { AbstractTextCodeEditor } from './textCodeEditor.js';\nimport { ITelemetryService } from '../../../../platform/telemetry/common/telemetry.js';\nimport { IStorageService } from '../../../../platform/storage/common/storage.js';\nimport { ITextResourceConfigurationService } from '../../../../editor/common/services/textResourceConfiguration.js';\nimport { IInstantiationService } from '../../../../platform/instantiation/common/instantiation.js';\nimport { IThemeService } from '../../../../platform/theme/common/themeService.js';\nimport { ScrollType, ICodeEditorViewState } from '../../../../editor/common/editorCommon.js';\nimport { IEditorGroup, IEditorGroupsService } from '../../../services/editor/common/editorGroupsService.js';\nimport { CancellationToken } from '../../../../base/common/cancellation.js';\nimport { IEditorService } from '../../../services/editor/common/editorService.js';\nimport { IModelService } from '../../../../editor/common/services/model.js';\nimport { ILanguageService } from '../../../../editor/common/languages/language.js';\nimport { PLAINTEXT_LANGUAGE_ID } from '../../../../editor/common/languages/modesRegistry.js';\nimport { EditorOption, IEditorOptions as ICodeEditorOptions } from '../../../../editor/common/config/editorOptions.js';\nimport { ModelConstants } from '../../../../editor/common/model.js';\nimport { ITextEditorOptions } from '../../../../platform/editor/common/editor.js';\nimport { IFileService } from '../../../../platform/files/common/files.js';\n\n/**\n * An editor implementation that is capable of showing the contents of resource inputs. Uses\n * the TextEditor widget to show the contents.\n */\nexport abstract class AbstractTextResourceEditor extends AbstractTextCodeEditor<ICodeEditorViewState> {\n\n\tconstructor(\n\t\tid: string,\n\t\tgroup: IEditorGroup,\n\t\t@ITelemetryService telemetryService: ITelemetryService,\n\t\t@IInstantiationService instantiationService: IInstantiationService,\n\t\t@IStorageService storageService: IStorageService,\n\t\t@ITextResourceConfigurationService textResourceConfigurationService: ITextResourceConfigurationService,\n\t\t@IThemeService themeService: IThemeService,\n\t\t@IEditorGroupsService editorGroupService: IEditorGroupsService,\n\t\t@IEditorService editorService: IEditorService,\n\t\t@IFileService fileService: IFileService\n\t) {\n\t\tsuper(id, group, telemetryService, instantiationService, storageService, textResourceConfigurationService, themeService, editorService, editorGroupService, fileService);\n\t}\n\n\toverride async setInput(input: AbstractTextResourceEditorInput, options: ITextEditorOptions | undefined, context: IEditorOpenContext, token: CancellationToken): Promise<void> {\n\n\t\t// Set input and resolve\n\t\tawait super.setInput(input, options, context, token);\n\t\tconst resolvedModel = await input.resolve();\n\n\t\t// Check for cancellation\n\t\tif (token.isCancellationRequested) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\t// Assert Model instance\n\t\tif (!(resolvedModel instanceof BaseTextEditorModel)) {\n\t\t\tthrow new Error('Unable to open file as text');\n\t\t}\n\n\t\t// Set Editor Model\n\t\tconst control = assertReturnsDefined(this.editorControl);\n\t\tconst textEditorModel = resolvedModel.textEditorModel;\n\t\tcontrol.setModel(textEditorModel);\n\n\t\t// Restore view state (unless provided by options)\n\t\tif (!isTextEditorViewState(options?.viewState)) {\n\t\t\tconst editorViewState = this.loadEditorViewState(input, context);\n\t\t\tif (editorViewState) {\n\t\t\t\tif (options?.selection) {\n\t\t\t\t\teditorViewState.cursorState = []; // prevent duplicate selections via options\n\t\t\t\t}\n\n\t\t\t\tcontrol.restoreViewState(editorViewState);\n\t\t\t}\n\t\t}\n\n\t\t// Apply options to editor if any\n\t\tif (options) {\n\t\t\tapplyTextEditorOptions(options, control, ScrollType.Immediate);\n\t\t}\n\n\t\t// Since the resolved model provides information about being readonly\n\t\t// or not, we apply it here to the editor even though the editor input\n\t\t// was already asked for being readonly or not. The rationale is that\n\t\t// a resolved model might have more specific information about being\n\t\t// readonly or not that the input did not have.\n\t\tcontrol.updateOptions(this.getReadonlyConfiguration(resolvedModel.isReadonly()));\n\t}\n\n\t/**\n\t * Reveals the last line of this editor if it has a model set.\n\t */\n\trevealLastLine(): void {\n\t\tconst control = this.editorControl;\n\t\tif (!control) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst model = control.getModel();\n\n\t\tif (model) {\n\t\t\tconst lastLine = model.getLineCount();\n\t\t\tcontrol.revealPosition({ lineNumber: lastLine, column: model.getLineMaxColumn(lastLine) }, ScrollType.Smooth);\n\t\t}\n\t}\n\n\toverride clearInput(): void {\n\t\tsuper.clearInput();\n\n\t\t// Clear Model\n\t\tthis.editorControl?.setModel(null);\n\t}\n\n\tprotected override tracksEditorViewState(input: EditorInput): boolean {\n\t\t// editor view state persistence is only enabled for untitled and resource inputs\n\t\treturn input instanceof UntitledTextEditorInput || input instanceof TextResourceEditorInput;\n\t}\n}\n\nexport class TextResourceEditor extends AbstractTextResourceEditor {\n\n\tstatic readonly ID = 'workbench.editors.textResourceEditor';\n\n\tconstructor(\n\t\tgroup: IEditorGroup,\n\t\t@ITelemetryService telemetryService: ITelemetryService,\n\t\t@IInstantiationService instantiationService: IInstantiationService,\n\t\t@IStorageService storageService: IStorageService,\n\t\t@ITextResourceConfigurationService textResourceConfigurationService: ITextResourceConfigurationService,\n\t\t@IThemeService themeService: IThemeService,\n\t\t@IEditorService editorService: IEditorService,\n\t\t@IEditorGroupsService editorGroupService: IEditorGroupsService,\n\t\t@IModelService private readonly modelService: IModelService,\n\t\t@ILanguageService private readonly languageService: ILanguageService,\n\t\t@IFileService fileService: IFileService\n\t) {\n\t\tsuper(TextResourceEditor.ID, group, telemetryService, instantiationService, storageService, textResourceConfigurationService, themeService, editorGroupService, editorService, fileService);\n\t}\n\n\tprotected override createEditorControl(parent: HTMLElement, configuration: ICodeEditorOptions): void {\n\t\tsuper.createEditorControl(parent, configuration);\n\n\t\t// Install a listener for paste to update this editors\n\t\t// language if the paste includes a specific language\n\t\tconst control = this.editorControl;\n\t\tif (control) {\n\t\t\tthis._register(control.onDidPaste(e => this.onDidEditorPaste(e, control)));\n\t\t}\n\t}\n\n\tprivate onDidEditorPaste(e: IPasteEvent, codeEditor: ICodeEditor): void {\n\t\tif (this.input instanceof UntitledTextEditorInput && this.input.hasLanguageSetExplicitly) {\n\t\t\treturn; // do not override language if it was set explicitly\n\t\t}\n\n\t\tif (e.range.startLineNumber !== 1 || e.range.startColumn !== 1) {\n\t\t\treturn; // document had existing content before the pasted text, don't override.\n\t\t}\n\n\t\tif (codeEditor.getOption(EditorOption.readOnly)) {\n\t\t\treturn; // not for readonly editors\n\t\t}\n\n\t\tconst textModel = codeEditor.getModel();\n\t\tif (!textModel) {\n\t\t\treturn; // require a live model\n\t\t}\n\n\t\tconst pasteIsWholeContents = textModel.getLineCount() === e.range.endLineNumber && textModel.getLineMaxColumn(e.range.endLineNumber) === e.range.endColumn;\n\t\tif (!pasteIsWholeContents) {\n\t\t\treturn; // document had existing content after the pasted text, don't override.\n\t\t}\n\n\t\tconst currentLanguageId = textModel.getLanguageId();\n\t\tif (currentLanguageId !== PLAINTEXT_LANGUAGE_ID) {\n\t\t\treturn; // require current languageId to be unspecific\n\t\t}\n\n\t\tlet candidateLanguage: { id: string; source: 'event' | 'guess' } | undefined = undefined;\n\n\t\t// A languageId is provided via the paste event so text was copied using\n\t\t// VSCode. As such we trust this languageId and use it if specific\n\t\tif (e.languageId) {\n\t\t\tcandidateLanguage = { id: e.languageId, source: 'event' };\n\t\t}\n\n\t\t// A languageId was not provided, so the data comes from outside VSCode\n\t\t// We can still try to guess a good languageId from the first line if\n\t\t// the paste changed the first line\n\t\telse {\n\t\t\tconst guess = this.languageService.guessLanguageIdByFilepathOrFirstLine(textModel.uri, textModel.getLineContent(1).substr(0, ModelConstants.FIRST_LINE_DETECTION_LENGTH_LIMIT)) ?? undefined;\n\t\t\tif (guess) {\n\t\t\t\tcandidateLanguage = { id: guess, source: 'guess' };\n\t\t\t}\n\t\t}\n\n\t\t// Finally apply languageId to model if specified\n\t\tif (candidateLanguage && candidateLanguage.id !== PLAINTEXT_LANGUAGE_ID) {\n\t\t\tif (this.input instanceof UntitledTextEditorInput && candidateLanguage.source === 'event') {\n\t\t\t\t// High confidence, set language id at TextEditorModel level to block future auto-detection\n\t\t\t\tthis.input.setLanguageId(candidateLanguage.id);\n\t\t\t} else {\n\t\t\t\ttextModel.setLanguage(this.languageService.createById(candidateLanguage.id));\n\t\t\t}\n\n\t\t\tconst opts = this.modelService.getCreationOptions(textModel.getLanguageId(), textModel.uri, textModel.isForSimpleWidget);\n\t\t\ttextModel.detectIndentation(opts.insertSpaces, opts.tabSize);\n\t\t}\n\t}\n}\n"]}