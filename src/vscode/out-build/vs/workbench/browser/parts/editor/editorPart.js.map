{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/browser/parts/editor/editorPart.ts","vs/workbench/browser/parts/editor/editorPart.ts"],"names":[],"mappings":"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","file":"editorPart.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { IThemeService } from '../../../../platform/theme/common/themeService.js';\nimport { Part } from '../../part.js';\nimport { Dimension, $, EventHelper, addDisposableGenericMouseDownListener, getWindow, isAncestorOfActiveElement, getActiveElement, isHTMLElement } from '../../../../base/browser/dom.js';\nimport { Event, Emitter, Relay, PauseableEmitter } from '../../../../base/common/event.js';\nimport { contrastBorder, editorBackground } from '../../../../platform/theme/common/colorRegistry.js';\nimport { GroupDirection, GroupsArrangement, GroupOrientation, IMergeGroupOptions, MergeGroupMode, GroupsOrder, GroupLocation, IFindGroupScope, EditorGroupLayout, GroupLayoutArgument, IEditorSideGroup, IEditorDropTargetDelegate, IEditorPart } from '../../../services/editor/common/editorGroupsService.js';\nimport { IInstantiationService } from '../../../../platform/instantiation/common/instantiation.js';\nimport { IView, orthogonal, LayoutPriority, IViewSize, Direction, SerializableGrid, Sizing, ISerializedGrid, ISerializedNode, Orientation, GridBranchNode, isGridBranchNode, GridNode, createSerializedGrid, Grid } from '../../../../base/browser/ui/grid/grid.js';\nimport { GroupIdentifier, EditorInputWithOptions, IEditorPartOptions, IEditorPartOptionsChangeEvent, GroupModelChangeKind } from '../../../common/editor.js';\nimport { EDITOR_GROUP_BORDER, EDITOR_PANE_BACKGROUND } from '../../../common/theme.js';\nimport { distinct, coalesce } from '../../../../base/common/arrays.js';\nimport { IEditorGroupView, getEditorPartOptions, impactsEditorPartOptions, IEditorPartCreationOptions, IEditorPartsView, IEditorGroupsView, IEditorGroupViewOptions } from './editor.js';\nimport { EditorGroupView } from './editorGroupView.js';\nimport { IConfigurationService, IConfigurationChangeEvent } from '../../../../platform/configuration/common/configuration.js';\nimport { IDisposable, dispose, toDisposable, DisposableStore } from '../../../../base/common/lifecycle.js';\nimport { IStorageService, IStorageValueChangeEvent, StorageScope, StorageTarget } from '../../../../platform/storage/common/storage.js';\nimport { ISerializedEditorGroupModel, isSerializedEditorGroupModel } from '../../../common/editor/editorGroupModel.js';\nimport { EditorDropTarget } from './editorDropTarget.js';\nimport { Color } from '../../../../base/common/color.js';\nimport { CenteredViewLayout, CenteredViewState } from '../../../../base/browser/ui/centered/centeredViewLayout.js';\nimport { onUnexpectedError } from '../../../../base/common/errors.js';\nimport { Parts, IWorkbenchLayoutService, Position } from '../../../services/layout/browser/layoutService.js';\nimport { DeepPartial, assertType } from '../../../../base/common/types.js';\nimport { CompositeDragAndDropObserver } from '../../dnd.js';\nimport { DeferredPromise, Promises } from '../../../../base/common/async.js';\nimport { findGroup } from '../../../services/editor/common/editorGroupFinder.js';\nimport { SIDE_GROUP } from '../../../services/editor/common/editorService.js';\nimport { IBoundarySashes } from '../../../../base/browser/ui/sash/sash.js';\nimport { IHostService } from '../../../services/host/browser/host.js';\nimport { IContextKeyService } from '../../../../platform/contextkey/common/contextkey.js';\nimport { ServiceCollection } from '../../../../platform/instantiation/common/serviceCollection.js';\nimport { EditorPartMaximizedEditorGroupContext, EditorPartMultipleEditorGroupsContext, IsAuxiliaryWindowContext } from '../../../common/contextkeys.js';\nimport { mainWindow } from '../../../../base/browser/window.js';\n\nexport interface IEditorPartUIState {\n\treadonly serializedGrid: ISerializedGrid;\n\treadonly activeGroup: GroupIdentifier;\n\treadonly mostRecentActiveGroups: GroupIdentifier[];\n}\n\ninterface IEditorPartMemento {\n\t'editorpart.state'?: IEditorPartUIState;\n\t'editorpart.centeredview'?: CenteredViewState;\n}\n\nclass GridWidgetView<T extends IView> implements IView {\n\n\treadonly element: HTMLElement = $('.grid-view-container');\n\n\tget minimumWidth(): number { return this.gridWidget ? this.gridWidget.minimumWidth : 0; }\n\tget maximumWidth(): number { return this.gridWidget ? this.gridWidget.maximumWidth : Number.POSITIVE_INFINITY; }\n\tget minimumHeight(): number { return this.gridWidget ? this.gridWidget.minimumHeight : 0; }\n\tget maximumHeight(): number { return this.gridWidget ? this.gridWidget.maximumHeight : Number.POSITIVE_INFINITY; }\n\n\tprivate _onDidChange = new Relay<{ width: number; height: number } | undefined>();\n\treadonly onDidChange = this._onDidChange.event;\n\n\tprivate _gridWidget: Grid<T> | undefined;\n\n\tget gridWidget(): Grid<T> | undefined {\n\t\treturn this._gridWidget;\n\t}\n\n\tset gridWidget(grid: Grid<T> | undefined) {\n\t\tthis.element.textContent = '';\n\n\t\tif (grid) {\n\t\t\tthis.element.appendChild(grid.element);\n\t\t\tthis._onDidChange.input = grid.onDidChange;\n\t\t} else {\n\t\t\tthis._onDidChange.input = Event.None;\n\t\t}\n\n\t\tthis._gridWidget = grid;\n\t}\n\n\tlayout(width: number, height: number, top: number, left: number): void {\n\t\tthis.gridWidget?.layout(width, height, top, left);\n\t}\n\n\tdispose(): void {\n\t\tthis._onDidChange.dispose();\n\t}\n}\n\nexport class EditorPart extends Part<IEditorPartMemento> implements IEditorPart, IEditorGroupsView {\n\n\tprivate static readonly EDITOR_PART_UI_STATE_STORAGE_KEY = 'editorpart.state';\n\tprivate static readonly EDITOR_PART_CENTERED_VIEW_STORAGE_KEY = 'editorpart.centeredview';\n\n\t//#region Events\n\n\tprivate readonly _onDidFocus = this._register(new Emitter<void>());\n\treadonly onDidFocus = this._onDidFocus.event;\n\n\tprivate readonly _onDidLayout = this._register(new Emitter<Dimension>());\n\treadonly onDidLayout = this._onDidLayout.event;\n\n\tprivate readonly _onDidChangeActiveGroup = this._register(new Emitter<IEditorGroupView>());\n\treadonly onDidChangeActiveGroup = this._onDidChangeActiveGroup.event;\n\n\tprivate readonly _onDidChangeGroupIndex = this._register(new Emitter<IEditorGroupView>());\n\treadonly onDidChangeGroupIndex = this._onDidChangeGroupIndex.event;\n\n\tprivate readonly _onDidChangeGroupLabel = this._register(new Emitter<IEditorGroupView>());\n\treadonly onDidChangeGroupLabel = this._onDidChangeGroupLabel.event;\n\n\tprivate readonly _onDidChangeGroupLocked = this._register(new Emitter<IEditorGroupView>());\n\treadonly onDidChangeGroupLocked = this._onDidChangeGroupLocked.event;\n\n\tprivate readonly _onDidChangeGroupMaximized = this._register(new Emitter<boolean>());\n\treadonly onDidChangeGroupMaximized = this._onDidChangeGroupMaximized.event;\n\n\tprivate readonly _onDidActivateGroup = this._register(new Emitter<IEditorGroupView>());\n\treadonly onDidActivateGroup = this._onDidActivateGroup.event;\n\n\tprivate readonly _onDidAddGroup = this._register(new PauseableEmitter<IEditorGroupView>());\n\treadonly onDidAddGroup = this._onDidAddGroup.event;\n\n\tprivate readonly _onDidRemoveGroup = this._register(new PauseableEmitter<IEditorGroupView>());\n\treadonly onDidRemoveGroup = this._onDidRemoveGroup.event;\n\n\tprivate readonly _onDidMoveGroup = this._register(new Emitter<IEditorGroupView>());\n\treadonly onDidMoveGroup = this._onDidMoveGroup.event;\n\n\tprivate readonly onDidSetGridWidget = this._register(new Emitter<{ width: number; height: number } | undefined>());\n\n\tprivate readonly _onDidChangeSizeConstraints = this._register(new Relay<{ width: number; height: number } | undefined>());\n\treadonly onDidChangeSizeConstraints = Event.any(this.onDidSetGridWidget.event, this._onDidChangeSizeConstraints.event);\n\n\tprivate readonly _onDidScroll = this._register(new Relay<void>());\n\treadonly onDidScroll = Event.any(this.onDidSetGridWidget.event, this._onDidScroll.event);\n\n\tprivate readonly _onDidChangeEditorPartOptions = this._register(new Emitter<IEditorPartOptionsChangeEvent>());\n\treadonly onDidChangeEditorPartOptions = this._onDidChangeEditorPartOptions.event;\n\n\tprivate readonly _onWillDispose = this._register(new Emitter<void>());\n\treadonly onWillDispose = this._onWillDispose.event;\n\n\t//#endregion\n\n\tprivate readonly workspaceMemento = this.getMemento(StorageScope.WORKSPACE, StorageTarget.USER);\n\tprivate readonly profileMemento = this.getMemento(StorageScope.PROFILE, StorageTarget.MACHINE);\n\n\tprivate readonly groupViews = new Map<GroupIdentifier, IEditorGroupView>();\n\tprivate mostRecentActiveGroups: GroupIdentifier[] = [];\n\n\tprotected readonly container = $('.content');\n\n\treadonly scopedInstantiationService: IInstantiationService;\n\tprivate readonly scopedContextKeyService: IContextKeyService;\n\n\tprivate centeredLayoutWidget!: CenteredViewLayout;\n\n\tprivate gridWidget!: SerializableGrid<IEditorGroupView>;\n\tprivate readonly gridWidgetDisposables = this._register(new DisposableStore());\n\tprivate readonly gridWidgetView = this._register(new GridWidgetView<IEditorGroupView>());\n\n\tconstructor(\n\t\tprotected readonly editorPartsView: IEditorPartsView,\n\t\tid: string,\n\t\tprivate readonly groupsLabel: string,\n\t\treadonly windowId: number,\n\t\t@IInstantiationService private readonly instantiationService: IInstantiationService,\n\t\t@IThemeService themeService: IThemeService,\n\t\t@IConfigurationService private readonly configurationService: IConfigurationService,\n\t\t@IStorageService storageService: IStorageService,\n\t\t@IWorkbenchLayoutService layoutService: IWorkbenchLayoutService,\n\t\t@IHostService private readonly hostService: IHostService,\n\t\t@IContextKeyService private readonly contextKeyService: IContextKeyService\n\t) {\n\t\tsuper(id, { hasTitle: false }, themeService, storageService, layoutService);\n\n\t\tthis.scopedContextKeyService = this._register(this.contextKeyService.createScoped(this.container));\n\t\tthis.scopedInstantiationService = this._register(this.instantiationService.createChild(new ServiceCollection(\n\t\t\t[IContextKeyService, this.scopedContextKeyService]\n\t\t)));\n\n\t\tthis._partOptions = getEditorPartOptions(this.configurationService, this.themeService);\n\n\t\tthis.registerListeners();\n\t}\n\n\tprivate registerListeners(): void {\n\t\tthis._register(this.configurationService.onDidChangeConfiguration(e => this.onConfigurationUpdated(e)));\n\t\tthis._register(this.themeService.onDidFileIconThemeChange(() => this.handleChangedPartOptions()));\n\t\tthis._register(this.onDidChangeMementoValue(StorageScope.WORKSPACE, this._store)(e => this.onDidChangeMementoState(e)));\n\t}\n\n\tprivate onConfigurationUpdated(event: IConfigurationChangeEvent): void {\n\t\tif (impactsEditorPartOptions(event)) {\n\t\t\tthis.handleChangedPartOptions();\n\t\t}\n\t}\n\n\tprivate handleChangedPartOptions(): void {\n\t\tconst oldPartOptions = this._partOptions;\n\t\tconst newPartOptions = getEditorPartOptions(this.configurationService, this.themeService);\n\n\t\tfor (const enforcedPartOptions of this.enforcedPartOptions) {\n\t\t\tObject.assign(newPartOptions, enforcedPartOptions); // check for overrides\n\t\t}\n\n\t\tthis._partOptions = newPartOptions;\n\n\t\tthis._onDidChangeEditorPartOptions.fire({ oldPartOptions, newPartOptions });\n\t}\n\n\tprivate enforcedPartOptions: DeepPartial<IEditorPartOptions>[] = [];\n\n\tprivate _partOptions: IEditorPartOptions;\n\tget partOptions(): IEditorPartOptions { return this._partOptions; }\n\n\tenforcePartOptions(options: DeepPartial<IEditorPartOptions>): IDisposable {\n\t\tthis.enforcedPartOptions.push(options);\n\t\tthis.handleChangedPartOptions();\n\n\t\treturn toDisposable(() => {\n\t\t\tthis.enforcedPartOptions.splice(this.enforcedPartOptions.indexOf(options), 1);\n\t\t\tthis.handleChangedPartOptions();\n\t\t});\n\t}\n\n\tprivate top = 0;\n\tprivate left = 0;\n\tprivate _contentDimension!: Dimension;\n\tget contentDimension(): Dimension { return this._contentDimension; }\n\n\tprivate _activeGroup!: IEditorGroupView;\n\tget activeGroup(): IEditorGroupView {\n\t\treturn this._activeGroup;\n\t}\n\n\treadonly sideGroup: IEditorSideGroup = {\n\t\topenEditor: (editor, options) => {\n\t\t\tconst [group] = this.scopedInstantiationService.invokeFunction(accessor => findGroup(accessor, { editor, options }, SIDE_GROUP));\n\n\t\t\treturn group.openEditor(editor, options);\n\t\t}\n\t};\n\n\tget groups(): IEditorGroupView[] {\n\t\treturn Array.from(this.groupViews.values());\n\t}\n\n\tget count(): number {\n\t\treturn this.groupViews.size;\n\t}\n\n\tget orientation(): GroupOrientation {\n\t\treturn (this.gridWidget && this.gridWidget.orientation === Orientation.VERTICAL) ? GroupOrientation.VERTICAL : GroupOrientation.HORIZONTAL;\n\t}\n\n\tprivate _isReady = false;\n\tget isReady(): boolean { return this._isReady; }\n\n\tprivate readonly whenReadyPromise = new DeferredPromise<void>();\n\treadonly whenReady = this.whenReadyPromise.p;\n\n\tprivate readonly whenRestoredPromise = new DeferredPromise<void>();\n\treadonly whenRestored = this.whenRestoredPromise.p;\n\n\tget hasRestorableState(): boolean {\n\t\treturn !!this.workspaceMemento[EditorPart.EDITOR_PART_UI_STATE_STORAGE_KEY];\n\t}\n\n\tprivate _willRestoreState = false;\n\tget willRestoreState(): boolean { return this._willRestoreState; }\n\n\tgetGroups(order = GroupsOrder.CREATION_TIME): IEditorGroupView[] {\n\t\tswitch (order) {\n\t\t\tcase GroupsOrder.CREATION_TIME:\n\t\t\t\treturn this.groups;\n\n\t\t\tcase GroupsOrder.MOST_RECENTLY_ACTIVE: {\n\t\t\t\tconst mostRecentActive = coalesce(this.mostRecentActiveGroups.map(groupId => this.getGroup(groupId)));\n\n\t\t\t\t// there can be groups that got never active, even though they exist. in this case\n\t\t\t\t// make sure to just append them at the end so that all groups are returned properly\n\t\t\t\treturn distinct([...mostRecentActive, ...this.groups]);\n\t\t\t}\n\t\t\tcase GroupsOrder.GRID_APPEARANCE: {\n\t\t\t\tconst views: IEditorGroupView[] = [];\n\t\t\t\tif (this.gridWidget) {\n\t\t\t\t\tthis.fillGridNodes(views, this.gridWidget.getViews());\n\t\t\t\t}\n\n\t\t\t\treturn views;\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate fillGridNodes(target: IEditorGroupView[], node: GridBranchNode<IEditorGroupView> | GridNode<IEditorGroupView>): void {\n\t\tif (isGridBranchNode(node)) {\n\t\t\tnode.children.forEach(child => this.fillGridNodes(target, child));\n\t\t} else {\n\t\t\ttarget.push(node.view);\n\t\t}\n\t}\n\n\thasGroup(identifier: GroupIdentifier): boolean {\n\t\treturn this.groupViews.has(identifier);\n\t}\n\n\tgetGroup(identifier: GroupIdentifier): IEditorGroupView | undefined {\n\t\treturn this.groupViews.get(identifier);\n\t}\n\n\tfindGroup(scope: IFindGroupScope, source: IEditorGroupView | GroupIdentifier = this.activeGroup, wrap?: boolean): IEditorGroupView | undefined {\n\n\t\t// by direction\n\t\tif (typeof scope.direction === 'number') {\n\t\t\treturn this.doFindGroupByDirection(scope.direction, source, wrap);\n\t\t}\n\n\t\t// by location\n\t\tif (typeof scope.location === 'number') {\n\t\t\treturn this.doFindGroupByLocation(scope.location, source, wrap);\n\t\t}\n\n\t\tthrow new Error('invalid arguments');\n\t}\n\n\tprivate doFindGroupByDirection(direction: GroupDirection, source: IEditorGroupView | GroupIdentifier, wrap?: boolean): IEditorGroupView | undefined {\n\t\tconst sourceGroupView = this.assertGroupView(source);\n\n\t\t// Find neighbours and sort by our MRU list\n\t\tconst neighbours = this.gridWidget.getNeighborViews(sourceGroupView, this.toGridViewDirection(direction), wrap);\n\t\tneighbours.sort(((n1, n2) => this.mostRecentActiveGroups.indexOf(n1.id) - this.mostRecentActiveGroups.indexOf(n2.id)));\n\n\t\treturn neighbours[0];\n\t}\n\n\tprivate doFindGroupByLocation(location: GroupLocation, source: IEditorGroupView | GroupIdentifier, wrap?: boolean): IEditorGroupView | undefined {\n\t\tconst sourceGroupView = this.assertGroupView(source);\n\t\tconst groups = this.getGroups(GroupsOrder.GRID_APPEARANCE);\n\t\tconst index = groups.indexOf(sourceGroupView);\n\n\t\tswitch (location) {\n\t\t\tcase GroupLocation.FIRST:\n\t\t\t\treturn groups[0];\n\t\t\tcase GroupLocation.LAST:\n\t\t\t\treturn groups[groups.length - 1];\n\t\t\tcase GroupLocation.NEXT: {\n\t\t\t\tlet nextGroup: IEditorGroupView | undefined = groups[index + 1];\n\t\t\t\tif (!nextGroup && wrap) {\n\t\t\t\t\tnextGroup = this.doFindGroupByLocation(GroupLocation.FIRST, source);\n\t\t\t\t}\n\n\t\t\t\treturn nextGroup;\n\t\t\t}\n\t\t\tcase GroupLocation.PREVIOUS: {\n\t\t\t\tlet previousGroup: IEditorGroupView | undefined = groups[index - 1];\n\t\t\t\tif (!previousGroup && wrap) {\n\t\t\t\t\tpreviousGroup = this.doFindGroupByLocation(GroupLocation.LAST, source);\n\t\t\t\t}\n\n\t\t\t\treturn previousGroup;\n\t\t\t}\n\t\t}\n\t}\n\n\tactivateGroup(group: IEditorGroupView | GroupIdentifier, preserveWindowOrder?: boolean): IEditorGroupView {\n\t\tconst groupView = this.assertGroupView(group);\n\t\tthis.doSetGroupActive(groupView);\n\n\t\t// Ensure window on top unless disabled\n\t\tif (!preserveWindowOrder) {\n\t\t\tthis.hostService.moveTop(getWindow(this.element));\n\t\t}\n\n\t\treturn groupView;\n\t}\n\n\trestoreGroup(group: IEditorGroupView | GroupIdentifier): IEditorGroupView {\n\t\tconst groupView = this.assertGroupView(group);\n\t\tthis.doRestoreGroup(groupView);\n\n\t\treturn groupView;\n\t}\n\n\tgetSize(group: IEditorGroupView | GroupIdentifier): { width: number; height: number } {\n\t\tconst groupView = this.assertGroupView(group);\n\n\t\treturn this.gridWidget.getViewSize(groupView);\n\t}\n\n\tsetSize(group: IEditorGroupView | GroupIdentifier, size: { width: number; height: number }): void {\n\t\tconst groupView = this.assertGroupView(group);\n\n\t\tthis.gridWidget.resizeView(groupView, size);\n\t}\n\n\tarrangeGroups(arrangement: GroupsArrangement, target: IEditorGroupView | GroupIdentifier = this.activeGroup): void {\n\t\tif (this.count < 2) {\n\t\t\treturn; // require at least 2 groups to show\n\t\t}\n\n\t\tif (!this.gridWidget) {\n\t\t\treturn; // we have not been created yet\n\t\t}\n\n\t\tconst groupView = this.assertGroupView(target);\n\n\t\tswitch (arrangement) {\n\t\t\tcase GroupsArrangement.EVEN:\n\t\t\t\tthis.gridWidget.distributeViewSizes();\n\t\t\t\tbreak;\n\t\t\tcase GroupsArrangement.MAXIMIZE:\n\t\t\t\tif (this.groups.length < 2) {\n\t\t\t\t\treturn; // need at least 2 groups to be maximized\n\t\t\t\t}\n\t\t\t\tthis.gridWidget.maximizeView(groupView);\n\t\t\t\tgroupView.focus();\n\t\t\t\tbreak;\n\t\t\tcase GroupsArrangement.EXPAND:\n\t\t\t\tthis.gridWidget.expandView(groupView);\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\ttoggleMaximizeGroup(target: IEditorGroupView | GroupIdentifier = this.activeGroup): void {\n\t\tif (this.hasMaximizedGroup()) {\n\t\t\tthis.unmaximizeGroup();\n\t\t} else {\n\t\t\tthis.arrangeGroups(GroupsArrangement.MAXIMIZE, target);\n\t\t}\n\t}\n\n\ttoggleExpandGroup(target: IEditorGroupView | GroupIdentifier = this.activeGroup): void {\n\t\tif (this.isGroupExpanded(this.activeGroup)) {\n\t\t\tthis.arrangeGroups(GroupsArrangement.EVEN);\n\t\t} else {\n\t\t\tthis.arrangeGroups(GroupsArrangement.EXPAND, target);\n\t\t}\n\t}\n\n\tprivate unmaximizeGroup(): void {\n\t\tthis.gridWidget.exitMaximizedView();\n\t\tthis._activeGroup.focus(); // When making views visible the focus can be affected, so restore it\n\t}\n\n\thasMaximizedGroup(): boolean {\n\t\treturn this.gridWidget.hasMaximizedView();\n\t}\n\n\tprivate isGroupMaximized(targetGroup: IEditorGroupView): boolean {\n\t\treturn this.gridWidget.isViewMaximized(targetGroup);\n\t}\n\n\tisGroupExpanded(targetGroup: IEditorGroupView): boolean {\n\t\treturn this.gridWidget.isViewExpanded(targetGroup);\n\t}\n\n\tsetGroupOrientation(orientation: GroupOrientation): void {\n\t\tif (!this.gridWidget) {\n\t\t\treturn; // we have not been created yet\n\t\t}\n\n\t\tconst newOrientation = (orientation === GroupOrientation.HORIZONTAL) ? Orientation.HORIZONTAL : Orientation.VERTICAL;\n\t\tif (this.gridWidget.orientation !== newOrientation) {\n\t\t\tthis.gridWidget.orientation = newOrientation;\n\t\t}\n\t}\n\n\tapplyLayout(layout: EditorGroupLayout): void {\n\t\tconst restoreFocus = this.shouldRestoreFocus(this.container);\n\n\t\t// Determine how many groups we need overall\n\t\tlet layoutGroupsCount = 0;\n\t\tfunction countGroups(groups: GroupLayoutArgument[]): void {\n\t\t\tfor (const group of groups) {\n\t\t\t\tif (Array.isArray(group.groups)) {\n\t\t\t\t\tcountGroups(group.groups);\n\t\t\t\t} else {\n\t\t\t\t\tlayoutGroupsCount++;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tcountGroups(layout.groups);\n\n\t\t// If we currently have too many groups, merge them into the last one\n\t\tlet currentGroupViews = this.getGroups(GroupsOrder.GRID_APPEARANCE);\n\t\tif (layoutGroupsCount < currentGroupViews.length) {\n\t\t\tconst lastGroupInLayout = currentGroupViews[layoutGroupsCount - 1];\n\t\t\tcurrentGroupViews.forEach((group, index) => {\n\t\t\t\tif (index >= layoutGroupsCount) {\n\t\t\t\t\tthis.mergeGroup(group, lastGroupInLayout);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tcurrentGroupViews = this.getGroups(GroupsOrder.GRID_APPEARANCE);\n\t\t}\n\n\t\tconst activeGroup = this.activeGroup;\n\n\t\t// Prepare grid descriptor to create new grid from\n\t\tconst gridDescriptor = createSerializedGrid({\n\t\t\torientation: this.toGridViewOrientation(\n\t\t\t\tlayout.orientation,\n\t\t\t\tthis.isTwoDimensionalGrid() ?\n\t\t\t\t\tthis.gridWidget.orientation :\t\t\t// preserve original orientation for 2-dimensional grids\n\t\t\t\t\torthogonal(this.gridWidget.orientation) // otherwise flip (fix https://github.com/microsoft/vscode/issues/52975)\n\t\t\t),\n\t\t\tgroups: layout.groups\n\t\t});\n\n\t\t// Recreate gridwidget with descriptor\n\t\tthis.doApplyGridState(gridDescriptor, activeGroup.id, currentGroupViews);\n\n\t\t// Restore focus as needed\n\t\tif (restoreFocus) {\n\t\t\tthis._activeGroup.focus();\n\t\t}\n\t}\n\n\tgetLayout(): EditorGroupLayout {\n\n\t\t// Example return value:\n\t\t// { orientation: 0, groups: [ { groups: [ { size: 0.4 }, { size: 0.6 } ], size: 0.5 }, { groups: [ {}, {} ], size: 0.5 } ] }\n\n\t\tconst serializedGrid = this.gridWidget.serialize();\n\t\tconst orientation = serializedGrid.orientation === Orientation.HORIZONTAL ? GroupOrientation.HORIZONTAL : GroupOrientation.VERTICAL;\n\t\tconst root = this.serializedNodeToGroupLayoutArgument(serializedGrid.root);\n\n\t\treturn {\n\t\t\torientation,\n\t\t\tgroups: root.groups as GroupLayoutArgument[]\n\t\t};\n\t}\n\n\tprivate serializedNodeToGroupLayoutArgument(serializedNode: ISerializedNode): GroupLayoutArgument {\n\t\tif (serializedNode.type === 'branch') {\n\t\t\treturn {\n\t\t\t\tsize: serializedNode.size,\n\t\t\t\tgroups: serializedNode.data.map(node => this.serializedNodeToGroupLayoutArgument(node))\n\t\t\t};\n\t\t}\n\n\t\treturn { size: serializedNode.size };\n\t}\n\n\tprotected shouldRestoreFocus(target: Element | undefined): boolean {\n\t\tif (!target) {\n\t\t\treturn false;\n\t\t}\n\n\t\tconst activeElement = getActiveElement();\n\t\tif (activeElement === target.ownerDocument.body) {\n\t\t\treturn true; // always restore focus if nothing is focused currently\n\t\t}\n\n\t\t// otherwise check for the active element being an ancestor of the target\n\t\treturn isAncestorOfActiveElement(target);\n\t}\n\n\tprivate isTwoDimensionalGrid(): boolean {\n\t\tconst views = this.gridWidget.getViews();\n\t\tif (isGridBranchNode(views)) {\n\t\t\t// the grid is 2-dimensional if any children\n\t\t\t// of the grid is a branch node\n\t\t\treturn views.children.some(child => isGridBranchNode(child));\n\t\t}\n\n\t\treturn false;\n\t}\n\n\taddGroup(location: IEditorGroupView | GroupIdentifier, direction: GroupDirection, groupToCopy?: IEditorGroupView): IEditorGroupView {\n\t\tconst locationView = this.assertGroupView(location);\n\n\t\tlet newGroupView: IEditorGroupView;\n\n\t\t// Same groups view: add to grid widget directly\n\t\tif (locationView.groupsView === this) {\n\t\t\tconst restoreFocus = this.shouldRestoreFocus(locationView.element);\n\n\t\t\tconst shouldExpand = this.groupViews.size > 1 && this.isGroupExpanded(locationView);\n\t\t\tnewGroupView = this.doCreateGroupView(groupToCopy);\n\n\t\t\t// Add to grid widget\n\t\t\tthis.gridWidget.addView(\n\t\t\t\tnewGroupView,\n\t\t\t\tthis.getSplitSizingStyle(),\n\t\t\t\tlocationView,\n\t\t\t\tthis.toGridViewDirection(direction),\n\t\t\t);\n\n\t\t\t// Update container\n\t\t\tthis.updateContainer();\n\n\t\t\t// Event\n\t\t\tthis._onDidAddGroup.fire(newGroupView);\n\n\t\t\t// Notify group index change given a new group was added\n\t\t\tthis.notifyGroupIndexChange();\n\n\t\t\t// Expand new group, if the reference view was previously expanded\n\t\t\tif (shouldExpand) {\n\t\t\t\tthis.arrangeGroups(GroupsArrangement.EXPAND, newGroupView);\n\t\t\t}\n\n\t\t\t// Restore focus if we had it previously after completing the grid\n\t\t\t// operation. That operation might cause reparenting of grid views\n\t\t\t// which moves focus to the <body> element otherwise.\n\t\t\tif (restoreFocus) {\n\t\t\t\tlocationView.focus();\n\t\t\t}\n\t\t}\n\n\t\t// Different group view: add to grid widget of that group\n\t\telse {\n\t\t\tnewGroupView = locationView.groupsView.addGroup(locationView, direction, groupToCopy);\n\t\t}\n\n\t\treturn newGroupView;\n\t}\n\n\tprivate getSplitSizingStyle(): Sizing {\n\t\tswitch (this._partOptions.splitSizing) {\n\t\t\tcase 'distribute':\n\t\t\t\treturn Sizing.Distribute;\n\t\t\tcase 'split':\n\t\t\t\treturn Sizing.Split;\n\t\t\tdefault:\n\t\t\t\treturn Sizing.Auto;\n\t\t}\n\t}\n\n\tprivate doCreateGroupView(from?: IEditorGroupView | ISerializedEditorGroupModel | null, options?: IEditorGroupViewOptions): IEditorGroupView {\n\n\t\t// Create group view\n\t\tlet groupView: IEditorGroupView;\n\t\tif (from instanceof EditorGroupView) {\n\t\t\tgroupView = EditorGroupView.createCopy(from, this.editorPartsView, this, this.groupsLabel, this.count, this.scopedInstantiationService, options);\n\t\t} else if (isSerializedEditorGroupModel(from)) {\n\t\t\tgroupView = EditorGroupView.createFromSerialized(from, this.editorPartsView, this, this.groupsLabel, this.count, this.scopedInstantiationService, options);\n\t\t} else {\n\t\t\tgroupView = EditorGroupView.createNew(this.editorPartsView, this, this.groupsLabel, this.count, this.scopedInstantiationService, options);\n\t\t}\n\n\t\t// Keep in map\n\t\tthis.groupViews.set(groupView.id, groupView);\n\n\t\t// Track focus\n\t\tconst groupDisposables = new DisposableStore();\n\t\tgroupDisposables.add(groupView.onDidFocus(() => {\n\t\t\tthis.doSetGroupActive(groupView);\n\n\t\t\tthis._onDidFocus.fire();\n\t\t}));\n\n\t\t// Track group changes\n\t\tgroupDisposables.add(groupView.onDidModelChange(e => {\n\t\t\tswitch (e.kind) {\n\t\t\t\tcase GroupModelChangeKind.GROUP_LOCKED:\n\t\t\t\t\tthis._onDidChangeGroupLocked.fire(groupView);\n\t\t\t\t\tbreak;\n\t\t\t\tcase GroupModelChangeKind.GROUP_INDEX:\n\t\t\t\t\tthis._onDidChangeGroupIndex.fire(groupView);\n\t\t\t\t\tbreak;\n\t\t\t\tcase GroupModelChangeKind.GROUP_LABEL:\n\t\t\t\t\tthis._onDidChangeGroupLabel.fire(groupView);\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}));\n\n\t\t// Track active editor change after it occurred\n\t\tgroupDisposables.add(groupView.onDidActiveEditorChange(() => {\n\t\t\tthis.updateContainer();\n\t\t}));\n\n\t\t// Track dispose\n\t\tEvent.once(groupView.onWillDispose)(() => {\n\t\t\tdispose(groupDisposables);\n\t\t\tthis.groupViews.delete(groupView.id);\n\t\t\tthis.doUpdateMostRecentActive(groupView);\n\t\t});\n\n\t\treturn groupView;\n\t}\n\n\tprivate doSetGroupActive(group: IEditorGroupView): void {\n\t\tif (this._activeGroup !== group) {\n\t\t\tconst previousActiveGroup = this._activeGroup;\n\t\t\tthis._activeGroup = group;\n\n\t\t\t// Update list of most recently active groups\n\t\t\tthis.doUpdateMostRecentActive(group, true);\n\n\t\t\t// Mark previous one as inactive\n\t\t\tif (previousActiveGroup && !previousActiveGroup.disposed) {\n\t\t\t\tpreviousActiveGroup.setActive(false);\n\t\t\t}\n\n\t\t\t// Mark group as new active\n\t\t\tgroup.setActive(true);\n\n\t\t\t// Expand the group if it is currently minimized\n\t\t\tthis.doRestoreGroup(group);\n\n\t\t\t// Event\n\t\t\tthis._onDidChangeActiveGroup.fire(group);\n\t\t}\n\n\t\t// Always fire the event that a group has been activated\n\t\t// even if its the same group that is already active to\n\t\t// signal the intent even when nothing has changed.\n\t\tthis._onDidActivateGroup.fire(group);\n\t}\n\n\tprivate doRestoreGroup(group: IEditorGroupView): void {\n\t\tif (!this.gridWidget) {\n\t\t\treturn; // method is called as part of state restore very early\n\t\t}\n\n\t\ttry {\n\t\t\tif (this.hasMaximizedGroup() && !this.isGroupMaximized(group)) {\n\t\t\t\tthis.unmaximizeGroup();\n\t\t\t}\n\n\t\t\tconst viewSize = this.gridWidget.getViewSize(group);\n\t\t\tif (viewSize.width === group.minimumWidth || viewSize.height === group.minimumHeight) {\n\t\t\t\tthis.arrangeGroups(GroupsArrangement.EXPAND, group);\n\t\t\t}\n\t\t} catch (error) {\n\t\t\t// ignore: method might be called too early before view is known to grid\n\t\t}\n\t}\n\n\tprivate doUpdateMostRecentActive(group: IEditorGroupView, makeMostRecentlyActive?: boolean): void {\n\t\tconst index = this.mostRecentActiveGroups.indexOf(group.id);\n\n\t\t// Remove from MRU list\n\t\tif (index !== -1) {\n\t\t\tthis.mostRecentActiveGroups.splice(index, 1);\n\t\t}\n\n\t\t// Add to front as needed\n\t\tif (makeMostRecentlyActive) {\n\t\t\tthis.mostRecentActiveGroups.unshift(group.id);\n\t\t}\n\t}\n\n\tprivate toGridViewDirection(direction: GroupDirection): Direction {\n\t\tswitch (direction) {\n\t\t\tcase GroupDirection.UP: return Direction.Up;\n\t\t\tcase GroupDirection.DOWN: return Direction.Down;\n\t\t\tcase GroupDirection.LEFT: return Direction.Left;\n\t\t\tcase GroupDirection.RIGHT: return Direction.Right;\n\t\t}\n\t}\n\n\tprivate toGridViewOrientation(orientation: GroupOrientation, fallback: Orientation): Orientation {\n\t\tif (typeof orientation === 'number') {\n\t\t\treturn orientation === GroupOrientation.HORIZONTAL ? Orientation.HORIZONTAL : Orientation.VERTICAL;\n\t\t}\n\n\t\treturn fallback;\n\t}\n\n\tremoveGroup(group: IEditorGroupView | GroupIdentifier, preserveFocus?: boolean): void {\n\t\tconst groupView = this.assertGroupView(group);\n\t\tif (this.count === 1) {\n\t\t\treturn; // Cannot remove the last root group\n\t\t}\n\n\t\t// Remove empty group\n\t\tif (groupView.isEmpty) {\n\t\t\tthis.doRemoveEmptyGroup(groupView, preserveFocus);\n\t\t}\n\n\t\t// Remove group with editors\n\t\telse {\n\t\t\tthis.doRemoveGroupWithEditors(groupView);\n\t\t}\n\t}\n\n\tprivate doRemoveGroupWithEditors(groupView: IEditorGroupView): void {\n\t\tconst mostRecentlyActiveGroups = this.getGroups(GroupsOrder.MOST_RECENTLY_ACTIVE);\n\n\t\tlet lastActiveGroup: IEditorGroupView;\n\t\tif (this._activeGroup === groupView) {\n\t\t\tlastActiveGroup = mostRecentlyActiveGroups[1];\n\t\t} else {\n\t\t\tlastActiveGroup = mostRecentlyActiveGroups[0];\n\t\t}\n\n\t\t// Removing a group with editors should merge these editors into the\n\t\t// last active group and then remove this group.\n\t\tthis.mergeGroup(groupView, lastActiveGroup);\n\t}\n\n\tprivate doRemoveEmptyGroup(groupView: IEditorGroupView, preserveFocus?: boolean): void {\n\t\tconst restoreFocus = !preserveFocus && this.shouldRestoreFocus(this.container);\n\n\t\t// Activate next group if the removed one was active\n\t\tif (this._activeGroup === groupView) {\n\t\t\tconst mostRecentlyActiveGroups = this.getGroups(GroupsOrder.MOST_RECENTLY_ACTIVE);\n\t\t\tconst nextActiveGroup = mostRecentlyActiveGroups[1]; // [0] will be the current group we are about to dispose\n\t\t\tthis.doSetGroupActive(nextActiveGroup);\n\t\t}\n\n\t\t// Remove from grid widget & dispose\n\t\tthis.gridWidget.removeView(groupView, this.getSplitSizingStyle());\n\t\tgroupView.dispose();\n\n\t\t// Restore focus if we had it previously after completing the grid\n\t\t// operation. That operation might cause reparenting of grid views\n\t\t// which moves focus to the <body> element otherwise.\n\t\tif (restoreFocus) {\n\t\t\tthis._activeGroup.focus();\n\t\t}\n\n\t\t// Notify group index change given a group was removed\n\t\tthis.notifyGroupIndexChange();\n\n\t\t// Update container\n\t\tthis.updateContainer();\n\n\t\t// Event\n\t\tthis._onDidRemoveGroup.fire(groupView);\n\t}\n\n\tmoveGroup(group: IEditorGroupView | GroupIdentifier, location: IEditorGroupView | GroupIdentifier, direction: GroupDirection): IEditorGroupView {\n\t\tconst sourceView = this.assertGroupView(group);\n\t\tconst targetView = this.assertGroupView(location);\n\n\t\tif (sourceView.id === targetView.id) {\n\t\t\tthrow new Error('Cannot move group into its own');\n\t\t}\n\n\t\tconst restoreFocus = this.shouldRestoreFocus(sourceView.element);\n\t\tlet movedView: IEditorGroupView;\n\n\t\t// Same groups view: move via grid widget API\n\t\tif (sourceView.groupsView === targetView.groupsView) {\n\t\t\tthis.gridWidget.moveView(sourceView, this.getSplitSizingStyle(), targetView, this.toGridViewDirection(direction));\n\t\t\tmovedView = sourceView;\n\t\t}\n\n\t\t// Different groups view: move via groups view API\n\t\telse {\n\t\t\tmovedView = targetView.groupsView.addGroup(targetView, direction, sourceView);\n\t\t\tsourceView.closeAllEditors();\n\t\t\tthis.removeGroup(sourceView, restoreFocus);\n\t\t}\n\n\t\t// Restore focus if we had it previously after completing the grid\n\t\t// operation. That operation might cause reparenting of grid views\n\t\t// which moves focus to the <body> element otherwise.\n\t\tif (restoreFocus) {\n\t\t\tmovedView.focus();\n\t\t}\n\n\t\t// Event\n\t\tthis._onDidMoveGroup.fire(movedView);\n\n\t\t// Notify group index change given a group was moved\n\t\tthis.notifyGroupIndexChange();\n\n\t\treturn movedView;\n\t}\n\n\tcopyGroup(group: IEditorGroupView | GroupIdentifier, location: IEditorGroupView | GroupIdentifier, direction: GroupDirection): IEditorGroupView {\n\t\tconst groupView = this.assertGroupView(group);\n\t\tconst locationView = this.assertGroupView(location);\n\n\t\tconst restoreFocus = this.shouldRestoreFocus(groupView.element);\n\n\t\t// Copy the group view\n\t\tconst copiedGroupView = this.addGroup(locationView, direction, groupView);\n\n\t\t// Restore focus if we had it\n\t\tif (restoreFocus) {\n\t\t\tcopiedGroupView.focus();\n\t\t}\n\n\t\treturn copiedGroupView;\n\t}\n\n\tmergeGroup(group: IEditorGroupView | GroupIdentifier, target: IEditorGroupView | GroupIdentifier, options?: IMergeGroupOptions): boolean {\n\t\tconst sourceView = this.assertGroupView(group);\n\t\tconst targetView = this.assertGroupView(target);\n\n\t\t// Collect editors to move/copy\n\t\tconst editors: EditorInputWithOptions[] = [];\n\t\tlet index = (options && typeof options.index === 'number') ? options.index : targetView.count;\n\t\tfor (const editor of sourceView.editors) {\n\t\t\tconst inactive = !sourceView.isActive(editor) || this._activeGroup !== sourceView;\n\n\t\t\tlet actualIndex: number | undefined;\n\t\t\tif (targetView.contains(editor) &&\n\t\t\t\t(\n\t\t\t\t\t// Do not configure an `index` for editors that are sticky in\n\t\t\t\t\t// the target, otherwise there is a chance of losing that state\n\t\t\t\t\t// when the editor is moved.\n\t\t\t\t\t// See https://github.com/microsoft/vscode/issues/239549\n\t\t\t\t\ttargetView.isSticky(editor) ||\n\t\t\t\t\t// Do not configure an `index` when we are explicitly instructed\n\t\t\t\t\toptions?.preserveExistingIndex\n\t\t\t\t)\n\t\t\t) {\n\t\t\t\t// leave `index` as `undefined`\n\t\t\t} else {\n\t\t\t\tactualIndex = index;\n\t\t\t\tindex++;\n\t\t\t}\n\n\t\t\teditors.push({\n\t\t\t\teditor,\n\t\t\t\toptions: {\n\t\t\t\t\tindex: actualIndex,\n\t\t\t\t\tinactive,\n\t\t\t\t\tpreserveFocus: inactive\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\t// Move/Copy editors over into target\n\t\tlet result = true;\n\t\tif (options?.mode === MergeGroupMode.COPY_EDITORS) {\n\t\t\tsourceView.copyEditors(editors, targetView);\n\t\t} else {\n\t\t\tresult = sourceView.moveEditors(editors, targetView);\n\t\t}\n\n\t\t// Remove source if the view is now empty and not already removed\n\t\tif (sourceView.isEmpty && !sourceView.disposed /* could have been disposed already via workbench.editor.closeEmptyGroups setting */) {\n\t\t\tthis.removeGroup(sourceView, true);\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tmergeAllGroups(target: IEditorGroupView | GroupIdentifier, options?: IMergeGroupOptions): boolean {\n\t\tconst targetView = this.assertGroupView(target);\n\n\t\tlet result = true;\n\t\tfor (const group of this.getGroups(GroupsOrder.MOST_RECENTLY_ACTIVE)) {\n\t\t\tif (group === targetView) {\n\t\t\t\tcontinue; // keep target\n\t\t\t}\n\n\t\t\tconst merged = this.mergeGroup(group, targetView, options);\n\t\t\tif (!merged) {\n\t\t\t\tresult = false;\n\t\t\t}\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tprotected assertGroupView(group: IEditorGroupView | GroupIdentifier): IEditorGroupView {\n\t\tlet groupView: IEditorGroupView | undefined;\n\t\tif (typeof group === 'number') {\n\t\t\tgroupView = this.editorPartsView.getGroup(group);\n\t\t} else {\n\t\t\tgroupView = group;\n\t\t}\n\n\t\tif (!groupView) {\n\t\t\tthrow new Error('Invalid editor group provided!');\n\t\t}\n\n\t\treturn groupView;\n\t}\n\n\tcreateEditorDropTarget(container: unknown, delegate: IEditorDropTargetDelegate): IDisposable {\n\t\tassertType(isHTMLElement(container));\n\n\t\treturn this.scopedInstantiationService.createInstance(EditorDropTarget, container, delegate);\n\t}\n\n\t//#region Part\n\n\t// TODO @sbatten @joao find something better to prevent editor taking over #79897\n\tget minimumWidth(): number { return Math.min(this.centeredLayoutWidget.minimumWidth, this.layoutService.getMaximumEditorDimensions(this.layoutService.getContainer(getWindow(this.container))).width); }\n\tget maximumWidth(): number { return this.centeredLayoutWidget.maximumWidth; }\n\tget minimumHeight(): number { return Math.min(this.centeredLayoutWidget.minimumHeight, this.layoutService.getMaximumEditorDimensions(this.layoutService.getContainer(getWindow(this.container))).height); }\n\tget maximumHeight(): number { return this.centeredLayoutWidget.maximumHeight; }\n\n\tget snap(): boolean { return this.layoutService.getPanelAlignment() === 'center'; }\n\n\toverride get onDidChange(): Event<IViewSize | undefined> { return Event.any(this.centeredLayoutWidget.onDidChange, this.onDidSetGridWidget.event); }\n\treadonly priority: LayoutPriority = LayoutPriority.High;\n\n\tprivate get gridSeparatorBorder(): Color {\n\t\treturn this.theme.getColor(EDITOR_GROUP_BORDER) || this.theme.getColor(contrastBorder) || Color.transparent;\n\t}\n\n\toverride updateStyles(): void {\n\t\tthis.container.style.backgroundColor = this.getColor(editorBackground) || '';\n\n\t\tconst separatorBorderStyle = { separatorBorder: this.gridSeparatorBorder, background: this.theme.getColor(EDITOR_PANE_BACKGROUND) || Color.transparent };\n\t\tthis.gridWidget.style(separatorBorderStyle);\n\t\tthis.centeredLayoutWidget.styles(separatorBorderStyle);\n\t}\n\n\tprotected override createContentArea(parent: HTMLElement, options?: IEditorPartCreationOptions): HTMLElement {\n\n\t\t// Container\n\t\tthis.element = parent;\n\t\tif (this.windowId !== mainWindow.vscodeWindowId) {\n\t\t\tthis.container.classList.add('auxiliary');\n\t\t}\n\t\tparent.appendChild(this.container);\n\n\t\t// Grid control\n\t\tthis._willRestoreState = !options || options.restorePreviousState;\n\t\tthis.doCreateGridControl();\n\n\t\t// Centered layout widget\n\t\tthis.centeredLayoutWidget = this._register(new CenteredViewLayout(this.container, this.gridWidgetView, this.profileMemento[EditorPart.EDITOR_PART_CENTERED_VIEW_STORAGE_KEY], this._partOptions.centeredLayoutFixedWidth));\n\t\tthis._register(this.onDidChangeEditorPartOptions(e => this.centeredLayoutWidget.setFixedWidth(e.newPartOptions.centeredLayoutFixedWidth ?? false)));\n\n\t\t// Drag & Drop support\n\t\tthis.setupDragAndDropSupport(parent, this.container);\n\n\t\t// Context keys\n\t\tthis.handleContextKeys();\n\n\t\t// Signal ready\n\t\tthis.whenReadyPromise.complete();\n\t\tthis._isReady = true;\n\n\t\t// Signal restored\n\t\tPromises.settled(this.groups.map(group => group.whenRestored)).finally(() => {\n\t\t\tthis.whenRestoredPromise.complete();\n\t\t});\n\n\t\treturn this.container;\n\t}\n\n\tprivate handleContextKeys(): void {\n\t\tconst isAuxiliaryWindowContext = IsAuxiliaryWindowContext.bindTo(this.scopedContextKeyService);\n\t\tisAuxiliaryWindowContext.set(this.windowId !== mainWindow.vscodeWindowId);\n\n\t\tconst multipleEditorGroupsContext = EditorPartMultipleEditorGroupsContext.bindTo(this.scopedContextKeyService);\n\t\tconst maximizedEditorGroupContext = EditorPartMaximizedEditorGroupContext.bindTo(this.scopedContextKeyService);\n\n\t\tconst updateContextKeys = () => {\n\t\t\tconst groupCount = this.count;\n\t\t\tif (groupCount > 1) {\n\t\t\t\tmultipleEditorGroupsContext.set(true);\n\t\t\t} else {\n\t\t\t\tmultipleEditorGroupsContext.reset();\n\t\t\t}\n\n\t\t\tif (this.hasMaximizedGroup()) {\n\t\t\t\tmaximizedEditorGroupContext.set(true);\n\t\t\t} else {\n\t\t\t\tmaximizedEditorGroupContext.reset();\n\t\t\t}\n\t\t};\n\n\t\tupdateContextKeys();\n\n\t\tthis._register(this.onDidAddGroup(() => updateContextKeys()));\n\t\tthis._register(this.onDidRemoveGroup(() => updateContextKeys()));\n\t\tthis._register(this.onDidChangeGroupMaximized(() => updateContextKeys()));\n\t}\n\n\tprivate setupDragAndDropSupport(parent: HTMLElement, container: HTMLElement): void {\n\n\t\t// Editor drop target\n\t\tthis._register(this.createEditorDropTarget(container, Object.create(null)));\n\n\t\t// No drop in the editor\n\t\tconst overlay = $('.drop-block-overlay');\n\t\tparent.appendChild(overlay);\n\n\t\t// Hide the block if a mouse down event occurs #99065\n\t\tthis._register(addDisposableGenericMouseDownListener(overlay, () => overlay.classList.remove('visible')));\n\n\t\tthis._register(CompositeDragAndDropObserver.INSTANCE.registerTarget(this.element, {\n\t\t\tonDragStart: e => overlay.classList.add('visible'),\n\t\t\tonDragEnd: e => overlay.classList.remove('visible')\n\t\t}));\n\n\t\tlet horizontalOpenerTimeout: Timeout | undefined;\n\t\tlet verticalOpenerTimeout: Timeout | undefined;\n\t\tlet lastOpenHorizontalPosition: Position | undefined;\n\t\tlet lastOpenVerticalPosition: Position | undefined;\n\t\tconst openPartAtPosition = (position: Position) => {\n\t\t\tif (!this.layoutService.isVisible(Parts.PANEL_PART) && position === this.layoutService.getPanelPosition()) {\n\t\t\t\tthis.layoutService.setPartHidden(false, Parts.PANEL_PART);\n\t\t\t} else if (!this.layoutService.isVisible(Parts.AUXILIARYBAR_PART) && position === (this.layoutService.getSideBarPosition() === Position.RIGHT ? Position.LEFT : Position.RIGHT)) {\n\t\t\t\tthis.layoutService.setPartHidden(false, Parts.AUXILIARYBAR_PART);\n\t\t\t}\n\t\t};\n\n\t\tconst clearAllTimeouts = () => {\n\t\t\tif (horizontalOpenerTimeout) {\n\t\t\t\tclearTimeout(horizontalOpenerTimeout);\n\t\t\t\thorizontalOpenerTimeout = undefined;\n\t\t\t}\n\n\t\t\tif (verticalOpenerTimeout) {\n\t\t\t\tclearTimeout(verticalOpenerTimeout);\n\t\t\t\tverticalOpenerTimeout = undefined;\n\t\t\t}\n\t\t};\n\n\t\tthis._register(CompositeDragAndDropObserver.INSTANCE.registerTarget(overlay, {\n\t\t\tonDragOver: e => {\n\t\t\t\tEventHelper.stop(e.eventData, true);\n\t\t\t\tif (e.eventData.dataTransfer) {\n\t\t\t\t\te.eventData.dataTransfer.dropEffect = 'none';\n\t\t\t\t}\n\n\t\t\t\tconst boundingRect = overlay.getBoundingClientRect();\n\n\t\t\t\tlet openHorizontalPosition: Position | undefined = undefined;\n\t\t\t\tlet openVerticalPosition: Position | undefined = undefined;\n\t\t\t\tconst proximity = 100;\n\t\t\t\tif (e.eventData.clientX < boundingRect.left + proximity) {\n\t\t\t\t\topenHorizontalPosition = Position.LEFT;\n\t\t\t\t}\n\n\t\t\t\tif (e.eventData.clientX > boundingRect.right - proximity) {\n\t\t\t\t\topenHorizontalPosition = Position.RIGHT;\n\t\t\t\t}\n\n\t\t\t\tif (e.eventData.clientY > boundingRect.bottom - proximity) {\n\t\t\t\t\topenVerticalPosition = Position.BOTTOM;\n\t\t\t\t}\n\n\t\t\t\tif (e.eventData.clientY < boundingRect.top + proximity) {\n\t\t\t\t\topenVerticalPosition = Position.TOP;\n\t\t\t\t}\n\n\t\t\t\tif (horizontalOpenerTimeout && openHorizontalPosition !== lastOpenHorizontalPosition) {\n\t\t\t\t\tclearTimeout(horizontalOpenerTimeout);\n\t\t\t\t\thorizontalOpenerTimeout = undefined;\n\t\t\t\t}\n\n\t\t\t\tif (verticalOpenerTimeout && openVerticalPosition !== lastOpenVerticalPosition) {\n\t\t\t\t\tclearTimeout(verticalOpenerTimeout);\n\t\t\t\t\tverticalOpenerTimeout = undefined;\n\t\t\t\t}\n\n\t\t\t\tif (!horizontalOpenerTimeout && openHorizontalPosition !== undefined) {\n\t\t\t\t\tlastOpenHorizontalPosition = openHorizontalPosition;\n\t\t\t\t\thorizontalOpenerTimeout = setTimeout(() => openPartAtPosition(openHorizontalPosition), 200);\n\t\t\t\t}\n\n\t\t\t\tif (!verticalOpenerTimeout && openVerticalPosition !== undefined) {\n\t\t\t\t\tlastOpenVerticalPosition = openVerticalPosition;\n\t\t\t\t\tverticalOpenerTimeout = setTimeout(() => openPartAtPosition(openVerticalPosition), 200);\n\t\t\t\t}\n\t\t\t},\n\t\t\tonDragLeave: () => clearAllTimeouts(),\n\t\t\tonDragEnd: () => clearAllTimeouts(),\n\t\t\tonDrop: () => clearAllTimeouts()\n\t\t}));\n\t}\n\n\tcenterLayout(active: boolean): void {\n\t\tthis.centeredLayoutWidget.activate(active);\n\t}\n\n\tisLayoutCentered(): boolean {\n\t\tif (this.centeredLayoutWidget) {\n\t\t\treturn this.centeredLayoutWidget.isActive();\n\t\t}\n\n\t\treturn false;\n\t}\n\n\tprivate doCreateGridControl(): void {\n\n\t\t// Grid Widget (with previous UI state)\n\t\tlet restoreError = false;\n\t\tif (this._willRestoreState) {\n\t\t\trestoreError = !this.doCreateGridControlWithPreviousState();\n\t\t}\n\n\t\t// Grid Widget (no previous UI state or failed to restore)\n\t\tif (!this.gridWidget || restoreError) {\n\t\t\tconst initialGroup = this.doCreateGroupView();\n\t\t\tthis.doSetGridWidget(new SerializableGrid(initialGroup));\n\n\t\t\t// Ensure a group is active\n\t\t\tthis.doSetGroupActive(initialGroup);\n\t\t}\n\n\t\t// Update container\n\t\tthis.updateContainer();\n\n\t\t// Notify group index change we created the entire grid\n\t\tthis.notifyGroupIndexChange();\n\t}\n\n\tprivate doCreateGridControlWithPreviousState(): boolean {\n\t\tconst state: IEditorPartUIState | undefined = this.loadState();\n\t\tif (state?.serializedGrid) {\n\t\t\ttry {\n\n\t\t\t\t// MRU\n\t\t\t\tthis.mostRecentActiveGroups = state.mostRecentActiveGroups;\n\n\t\t\t\t// Grid Widget\n\t\t\t\tthis.doCreateGridControlWithState(state.serializedGrid, state.activeGroup);\n\t\t\t} catch (error) {\n\n\t\t\t\t// Log error\n\t\t\t\tonUnexpectedError(new Error(`Error restoring editor grid widget: ${error} (with state: ${JSON.stringify(state)})`));\n\n\t\t\t\t// Clear any state we have from the failing restore\n\t\t\t\tthis.disposeGroups();\n\n\t\t\t\treturn false; // failure\n\t\t\t}\n\t\t}\n\n\t\treturn true; // success\n\t}\n\n\tprivate doCreateGridControlWithState(serializedGrid: ISerializedGrid, activeGroupId: GroupIdentifier, editorGroupViewsToReuse?: IEditorGroupView[], options?: IEditorGroupViewOptions): void {\n\n\t\t// Determine group views to reuse if any\n\t\tlet reuseGroupViews: IEditorGroupView[];\n\t\tif (editorGroupViewsToReuse) {\n\t\t\treuseGroupViews = editorGroupViewsToReuse.slice(0); // do not modify original array\n\t\t} else {\n\t\t\treuseGroupViews = [];\n\t\t}\n\n\t\t// Create new\n\t\tconst groupViews: IEditorGroupView[] = [];\n\t\tconst gridWidget = SerializableGrid.deserialize(serializedGrid, {\n\t\t\tfromJSON: (serializedEditorGroup: ISerializedEditorGroupModel | null) => {\n\t\t\t\tlet groupView: IEditorGroupView;\n\t\t\t\tif (reuseGroupViews.length > 0) {\n\t\t\t\t\tgroupView = reuseGroupViews.shift()!;\n\t\t\t\t} else {\n\t\t\t\t\tgroupView = this.doCreateGroupView(serializedEditorGroup, options);\n\t\t\t\t}\n\n\t\t\t\tgroupViews.push(groupView);\n\n\t\t\t\tif (groupView.id === activeGroupId) {\n\t\t\t\t\tthis.doSetGroupActive(groupView);\n\t\t\t\t}\n\n\t\t\t\treturn groupView;\n\t\t\t}\n\t\t}, { styles: { separatorBorder: this.gridSeparatorBorder } });\n\n\t\t// If the active group was not found when restoring the grid\n\t\t// make sure to make at least one group active. We always need\n\t\t// an active group.\n\t\tif (!this._activeGroup) {\n\t\t\tthis.doSetGroupActive(groupViews[0]);\n\t\t}\n\n\t\t// Validate MRU group views matches grid widget state\n\t\tif (this.mostRecentActiveGroups.some(groupId => !this.getGroup(groupId))) {\n\t\t\tthis.mostRecentActiveGroups = groupViews.map(group => group.id);\n\t\t}\n\n\t\t// Set it\n\t\tthis.doSetGridWidget(gridWidget);\n\t}\n\n\tprivate doSetGridWidget(gridWidget: SerializableGrid<IEditorGroupView>): void {\n\t\tlet boundarySashes: IBoundarySashes = {};\n\n\t\tif (this.gridWidget) {\n\t\t\tboundarySashes = this.gridWidget.boundarySashes;\n\t\t\tthis.gridWidget.dispose();\n\t\t}\n\n\t\tthis.gridWidget = gridWidget;\n\t\tthis.gridWidget.boundarySashes = boundarySashes;\n\t\tthis.gridWidgetView.gridWidget = gridWidget;\n\n\t\tthis._onDidChangeSizeConstraints.input = gridWidget.onDidChange;\n\t\tthis._onDidScroll.input = gridWidget.onDidScroll;\n\t\tthis.gridWidgetDisposables.clear();\n\t\tthis.gridWidgetDisposables.add(gridWidget.onDidChangeViewMaximized(maximized => this._onDidChangeGroupMaximized.fire(maximized)));\n\n\t\tthis.onDidSetGridWidget.fire(undefined);\n\t}\n\n\tprivate updateContainer(): void {\n\t\tthis.container.classList.toggle('empty', this.isEmpty);\n\t}\n\n\tprivate notifyGroupIndexChange(): void {\n\t\tthis.getGroups(GroupsOrder.GRID_APPEARANCE).forEach((group, index) => group.notifyIndexChanged(index));\n\t}\n\n\tnotifyGroupsLabelChange(newLabel: string) {\n\t\tfor (const group of this.groups) {\n\t\t\tgroup.notifyLabelChanged(newLabel);\n\t\t}\n\t}\n\n\tprivate get isEmpty(): boolean {\n\t\treturn this.count === 1 && this._activeGroup.isEmpty;\n\t}\n\n\tsetBoundarySashes(sashes: IBoundarySashes): void {\n\t\tthis.gridWidget.boundarySashes = sashes;\n\t\tthis.centeredLayoutWidget.boundarySashes = sashes;\n\t}\n\n\toverride layout(width: number, height: number, top: number, left: number): void {\n\t\tthis.top = top;\n\t\tthis.left = left;\n\n\t\t// Layout contents\n\t\tconst contentAreaSize = super.layoutContents(width, height).contentSize;\n\n\t\t// Layout editor container\n\t\tthis.doLayout(Dimension.lift(contentAreaSize), top, left);\n\t}\n\n\tprivate doLayout(dimension: Dimension, top = this.top, left = this.left): void {\n\t\tthis._contentDimension = dimension;\n\n\t\t// Layout Grid\n\t\tthis.centeredLayoutWidget.layout(this._contentDimension.width, this._contentDimension.height, top, left);\n\n\t\t// Event\n\t\tthis._onDidLayout.fire(dimension);\n\t}\n\n\tprotected override saveState(): void {\n\n\t\t// Persist grid UI state\n\t\tif (this.gridWidget) {\n\t\t\tif (this.isEmpty) {\n\t\t\t\tdelete this.workspaceMemento[EditorPart.EDITOR_PART_UI_STATE_STORAGE_KEY];\n\t\t\t} else {\n\t\t\t\tthis.workspaceMemento[EditorPart.EDITOR_PART_UI_STATE_STORAGE_KEY] = this.createState();\n\t\t\t}\n\t\t}\n\n\t\t// Persist centered view state\n\t\tif (this.centeredLayoutWidget) {\n\t\t\tconst centeredLayoutState = this.centeredLayoutWidget.state;\n\t\t\tif (this.centeredLayoutWidget.isDefault(centeredLayoutState)) {\n\t\t\t\tdelete this.profileMemento[EditorPart.EDITOR_PART_CENTERED_VIEW_STORAGE_KEY];\n\t\t\t} else {\n\t\t\t\tthis.profileMemento[EditorPart.EDITOR_PART_CENTERED_VIEW_STORAGE_KEY] = centeredLayoutState;\n\t\t\t}\n\t\t}\n\n\t\tsuper.saveState();\n\t}\n\n\tprotected loadState(): IEditorPartUIState | undefined {\n\t\treturn this.workspaceMemento[EditorPart.EDITOR_PART_UI_STATE_STORAGE_KEY];\n\t}\n\n\tcreateState(): IEditorPartUIState {\n\t\treturn {\n\t\t\tserializedGrid: this.gridWidget.serialize(),\n\t\t\tactiveGroup: this._activeGroup.id,\n\t\t\tmostRecentActiveGroups: this.mostRecentActiveGroups\n\t\t};\n\t}\n\n\tapplyState(state: IEditorPartUIState | 'empty', options?: IEditorGroupViewOptions): Promise<void> {\n\t\tif (state === 'empty') {\n\t\t\treturn this.doApplyEmptyState();\n\t\t} else {\n\t\t\treturn this.doApplyState(state, options);\n\t\t}\n\t}\n\n\tprivate async doApplyState(state: IEditorPartUIState, options?: IEditorGroupViewOptions): Promise<void> {\n\t\tconst groups = await this.doPrepareApplyState();\n\n\t\t// Pause add/remove events for groups during the duration of applying the state\n\t\t// This ensures that we can do this transition atomically with the new state\n\t\t// being ready when the events are fired. This is important because usually there\n\t\t// is never the state where no groups are present, but for this transition we\n\t\t// need to temporarily dispose all groups to restore the new set.\n\n\t\tthis._onDidAddGroup.pause();\n\t\tthis._onDidRemoveGroup.pause();\n\n\t\tthis.disposeGroups();\n\n\t\t// MRU\n\t\tthis.mostRecentActiveGroups = state.mostRecentActiveGroups;\n\n\t\t// Grid Widget\n\t\ttry {\n\t\t\tthis.doApplyGridState(state.serializedGrid, state.activeGroup, undefined, options);\n\t\t} finally {\n\t\t\t// It is very important to keep this order: first resume the events for\n\t\t\t// removed groups and then for added groups. Many listeners may store\n\t\t\t// groups in sets by their identifier and groups can have the same\n\t\t\t// identifier before and after.\n\t\t\tthis._onDidRemoveGroup.resume();\n\t\t\tthis._onDidAddGroup.resume();\n\t\t}\n\n\t\t// Restore editors that were not closed before and are now opened now\n\t\tawait this.activeGroup.openEditors(\n\t\t\tgroups\n\t\t\t\t.flatMap(group => group.editors)\n\t\t\t\t.filter(editor => this.editorPartsView.groups.every(groupView => !groupView.contains(editor)))\n\t\t\t\t.map(editor => ({\n\t\t\t\t\teditor, options: { pinned: true, preserveFocus: true, inactive: true }\n\t\t\t\t}))\n\t\t);\n\t}\n\n\tprivate async doApplyEmptyState(): Promise<void> {\n\t\tawait this.doPrepareApplyState();\n\n\t\tthis.mergeAllGroups(this.activeGroup);\n\t}\n\n\tprivate async doPrepareApplyState(): Promise<IEditorGroupView[]> {\n\n\t\t// Before disposing groups, try to close as many editors as\n\t\t// possible, but skip over those that would trigger a dialog\n\t\t// (for example when being dirty). This is to be able to later\n\t\t// restore these editors after state has been applied.\n\n\t\tconst groups = this.getGroups(GroupsOrder.MOST_RECENTLY_ACTIVE);\n\t\tfor (const group of groups) {\n\t\t\tawait group.closeAllEditors({ excludeConfirming: true });\n\t\t}\n\n\t\treturn groups;\n\t}\n\n\tprivate doApplyGridState(gridState: ISerializedGrid, activeGroupId: GroupIdentifier, editorGroupViewsToReuse?: IEditorGroupView[], options?: IEditorGroupViewOptions): void {\n\n\t\t// Recreate grid widget from state\n\t\tthis.doCreateGridControlWithState(gridState, activeGroupId, editorGroupViewsToReuse, options);\n\n\t\t// Layout\n\t\tthis.doLayout(this._contentDimension);\n\n\t\t// Update container\n\t\tthis.updateContainer();\n\n\t\t// Events for groups that got added\n\t\tfor (const groupView of this.getGroups(GroupsOrder.GRID_APPEARANCE)) {\n\t\t\tif (!editorGroupViewsToReuse?.includes(groupView)) {\n\t\t\t\tthis._onDidAddGroup.fire(groupView);\n\t\t\t}\n\t\t}\n\n\t\t// Notify group index change given layout has changed\n\t\tthis.notifyGroupIndexChange();\n\t}\n\n\tprivate onDidChangeMementoState(e: IStorageValueChangeEvent): void {\n\t\tif (e.external && e.scope === StorageScope.WORKSPACE) {\n\t\t\tthis.reloadMemento(e.scope);\n\n\t\t\tconst state = this.loadState();\n\t\t\tif (state) {\n\t\t\t\tthis.applyState(state);\n\t\t\t}\n\t\t}\n\t}\n\n\ttoJSON(): object {\n\t\treturn {\n\t\t\ttype: Parts.EDITOR_PART\n\t\t};\n\t}\n\n\tprivate disposeGroups(): void {\n\t\tfor (const group of this.groups) {\n\t\t\tgroup.dispose();\n\n\t\t\tthis._onDidRemoveGroup.fire(group);\n\t\t}\n\n\t\tthis.groupViews.clear();\n\t\tthis.mostRecentActiveGroups = [];\n\t}\n\n\toverride dispose(): void {\n\n\t\t// Event\n\t\tthis._onWillDispose.fire();\n\n\t\t// Forward to all groups\n\t\tthis.disposeGroups();\n\n\t\t// Grid widget\n\t\tthis.gridWidget?.dispose();\n\n\t\tsuper.dispose();\n\t}\n\n\t//#endregion\n}\n\nexport class MainEditorPart extends EditorPart {\n\n\tconstructor(\n\t\teditorPartsView: IEditorPartsView,\n\t\t@IInstantiationService instantiationService: IInstantiationService,\n\t\t@IThemeService themeService: IThemeService,\n\t\t@IConfigurationService configurationService: IConfigurationService,\n\t\t@IStorageService storageService: IStorageService,\n\t\t@IWorkbenchLayoutService layoutService: IWorkbenchLayoutService,\n\t\t@IHostService hostService: IHostService,\n\t\t@IContextKeyService contextKeyService: IContextKeyService\n\t) {\n\t\tsuper(editorPartsView, Parts.EDITOR_PART, '', mainWindow.vscodeWindowId, instantiationService, themeService, configurationService, storageService, layoutService, hostService, contextKeyService);\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { IThemeService } from '../../../../platform/theme/common/themeService.js';\nimport { Part } from '../../part.js';\nimport { Dimension, $, EventHelper, addDisposableGenericMouseDownListener, getWindow, isAncestorOfActiveElement, getActiveElement, isHTMLElement } from '../../../../base/browser/dom.js';\nimport { Event, Emitter, Relay, PauseableEmitter } from '../../../../base/common/event.js';\nimport { contrastBorder, editorBackground } from '../../../../platform/theme/common/colorRegistry.js';\nimport { GroupDirection, GroupsArrangement, GroupOrientation, IMergeGroupOptions, MergeGroupMode, GroupsOrder, GroupLocation, IFindGroupScope, EditorGroupLayout, GroupLayoutArgument, IEditorSideGroup, IEditorDropTargetDelegate, IEditorPart } from '../../../services/editor/common/editorGroupsService.js';\nimport { IInstantiationService } from '../../../../platform/instantiation/common/instantiation.js';\nimport { IView, orthogonal, LayoutPriority, IViewSize, Direction, SerializableGrid, Sizing, ISerializedGrid, ISerializedNode, Orientation, GridBranchNode, isGridBranchNode, GridNode, createSerializedGrid, Grid } from '../../../../base/browser/ui/grid/grid.js';\nimport { GroupIdentifier, EditorInputWithOptions, IEditorPartOptions, IEditorPartOptionsChangeEvent, GroupModelChangeKind } from '../../../common/editor.js';\nimport { EDITOR_GROUP_BORDER, EDITOR_PANE_BACKGROUND } from '../../../common/theme.js';\nimport { distinct, coalesce } from '../../../../base/common/arrays.js';\nimport { IEditorGroupView, getEditorPartOptions, impactsEditorPartOptions, IEditorPartCreationOptions, IEditorPartsView, IEditorGroupsView, IEditorGroupViewOptions } from './editor.js';\nimport { EditorGroupView } from './editorGroupView.js';\nimport { IConfigurationService, IConfigurationChangeEvent } from '../../../../platform/configuration/common/configuration.js';\nimport { IDisposable, dispose, toDisposable, DisposableStore } from '../../../../base/common/lifecycle.js';\nimport { IStorageService, IStorageValueChangeEvent, StorageScope, StorageTarget } from '../../../../platform/storage/common/storage.js';\nimport { ISerializedEditorGroupModel, isSerializedEditorGroupModel } from '../../../common/editor/editorGroupModel.js';\nimport { EditorDropTarget } from './editorDropTarget.js';\nimport { Color } from '../../../../base/common/color.js';\nimport { CenteredViewLayout, CenteredViewState } from '../../../../base/browser/ui/centered/centeredViewLayout.js';\nimport { onUnexpectedError } from '../../../../base/common/errors.js';\nimport { Parts, IWorkbenchLayoutService, Position } from '../../../services/layout/browser/layoutService.js';\nimport { DeepPartial, assertType } from '../../../../base/common/types.js';\nimport { CompositeDragAndDropObserver } from '../../dnd.js';\nimport { DeferredPromise, Promises } from '../../../../base/common/async.js';\nimport { findGroup } from '../../../services/editor/common/editorGroupFinder.js';\nimport { SIDE_GROUP } from '../../../services/editor/common/editorService.js';\nimport { IBoundarySashes } from '../../../../base/browser/ui/sash/sash.js';\nimport { IHostService } from '../../../services/host/browser/host.js';\nimport { IContextKeyService } from '../../../../platform/contextkey/common/contextkey.js';\nimport { ServiceCollection } from '../../../../platform/instantiation/common/serviceCollection.js';\nimport { EditorPartMaximizedEditorGroupContext, EditorPartMultipleEditorGroupsContext, IsAuxiliaryWindowContext } from '../../../common/contextkeys.js';\nimport { mainWindow } from '../../../../base/browser/window.js';\n\nexport interface IEditorPartUIState {\n\treadonly serializedGrid: ISerializedGrid;\n\treadonly activeGroup: GroupIdentifier;\n\treadonly mostRecentActiveGroups: GroupIdentifier[];\n}\n\ninterface IEditorPartMemento {\n\t'editorpart.state'?: IEditorPartUIState;\n\t'editorpart.centeredview'?: CenteredViewState;\n}\n\nclass GridWidgetView<T extends IView> implements IView {\n\n\treadonly element: HTMLElement = $('.grid-view-container');\n\n\tget minimumWidth(): number { return this.gridWidget ? this.gridWidget.minimumWidth : 0; }\n\tget maximumWidth(): number { return this.gridWidget ? this.gridWidget.maximumWidth : Number.POSITIVE_INFINITY; }\n\tget minimumHeight(): number { return this.gridWidget ? this.gridWidget.minimumHeight : 0; }\n\tget maximumHeight(): number { return this.gridWidget ? this.gridWidget.maximumHeight : Number.POSITIVE_INFINITY; }\n\n\tprivate _onDidChange = new Relay<{ width: number; height: number } | undefined>();\n\treadonly onDidChange = this._onDidChange.event;\n\n\tprivate _gridWidget: Grid<T> | undefined;\n\n\tget gridWidget(): Grid<T> | undefined {\n\t\treturn this._gridWidget;\n\t}\n\n\tset gridWidget(grid: Grid<T> | undefined) {\n\t\tthis.element.textContent = '';\n\n\t\tif (grid) {\n\t\t\tthis.element.appendChild(grid.element);\n\t\t\tthis._onDidChange.input = grid.onDidChange;\n\t\t} else {\n\t\t\tthis._onDidChange.input = Event.None;\n\t\t}\n\n\t\tthis._gridWidget = grid;\n\t}\n\n\tlayout(width: number, height: number, top: number, left: number): void {\n\t\tthis.gridWidget?.layout(width, height, top, left);\n\t}\n\n\tdispose(): void {\n\t\tthis._onDidChange.dispose();\n\t}\n}\n\nexport class EditorPart extends Part<IEditorPartMemento> implements IEditorPart, IEditorGroupsView {\n\n\tprivate static readonly EDITOR_PART_UI_STATE_STORAGE_KEY = 'editorpart.state';\n\tprivate static readonly EDITOR_PART_CENTERED_VIEW_STORAGE_KEY = 'editorpart.centeredview';\n\n\t//#region Events\n\n\tprivate readonly _onDidFocus = this._register(new Emitter<void>());\n\treadonly onDidFocus = this._onDidFocus.event;\n\n\tprivate readonly _onDidLayout = this._register(new Emitter<Dimension>());\n\treadonly onDidLayout = this._onDidLayout.event;\n\n\tprivate readonly _onDidChangeActiveGroup = this._register(new Emitter<IEditorGroupView>());\n\treadonly onDidChangeActiveGroup = this._onDidChangeActiveGroup.event;\n\n\tprivate readonly _onDidChangeGroupIndex = this._register(new Emitter<IEditorGroupView>());\n\treadonly onDidChangeGroupIndex = this._onDidChangeGroupIndex.event;\n\n\tprivate readonly _onDidChangeGroupLabel = this._register(new Emitter<IEditorGroupView>());\n\treadonly onDidChangeGroupLabel = this._onDidChangeGroupLabel.event;\n\n\tprivate readonly _onDidChangeGroupLocked = this._register(new Emitter<IEditorGroupView>());\n\treadonly onDidChangeGroupLocked = this._onDidChangeGroupLocked.event;\n\n\tprivate readonly _onDidChangeGroupMaximized = this._register(new Emitter<boolean>());\n\treadonly onDidChangeGroupMaximized = this._onDidChangeGroupMaximized.event;\n\n\tprivate readonly _onDidActivateGroup = this._register(new Emitter<IEditorGroupView>());\n\treadonly onDidActivateGroup = this._onDidActivateGroup.event;\n\n\tprivate readonly _onDidAddGroup = this._register(new PauseableEmitter<IEditorGroupView>());\n\treadonly onDidAddGroup = this._onDidAddGroup.event;\n\n\tprivate readonly _onDidRemoveGroup = this._register(new PauseableEmitter<IEditorGroupView>());\n\treadonly onDidRemoveGroup = this._onDidRemoveGroup.event;\n\n\tprivate readonly _onDidMoveGroup = this._register(new Emitter<IEditorGroupView>());\n\treadonly onDidMoveGroup = this._onDidMoveGroup.event;\n\n\tprivate readonly onDidSetGridWidget = this._register(new Emitter<{ width: number; height: number } | undefined>());\n\n\tprivate readonly _onDidChangeSizeConstraints = this._register(new Relay<{ width: number; height: number } | undefined>());\n\treadonly onDidChangeSizeConstraints = Event.any(this.onDidSetGridWidget.event, this._onDidChangeSizeConstraints.event);\n\n\tprivate readonly _onDidScroll = this._register(new Relay<void>());\n\treadonly onDidScroll = Event.any(this.onDidSetGridWidget.event, this._onDidScroll.event);\n\n\tprivate readonly _onDidChangeEditorPartOptions = this._register(new Emitter<IEditorPartOptionsChangeEvent>());\n\treadonly onDidChangeEditorPartOptions = this._onDidChangeEditorPartOptions.event;\n\n\tprivate readonly _onWillDispose = this._register(new Emitter<void>());\n\treadonly onWillDispose = this._onWillDispose.event;\n\n\t//#endregion\n\n\tprivate readonly workspaceMemento = this.getMemento(StorageScope.WORKSPACE, StorageTarget.USER);\n\tprivate readonly profileMemento = this.getMemento(StorageScope.PROFILE, StorageTarget.MACHINE);\n\n\tprivate readonly groupViews = new Map<GroupIdentifier, IEditorGroupView>();\n\tprivate mostRecentActiveGroups: GroupIdentifier[] = [];\n\n\tprotected readonly container = $('.content');\n\n\treadonly scopedInstantiationService: IInstantiationService;\n\tprivate readonly scopedContextKeyService: IContextKeyService;\n\n\tprivate centeredLayoutWidget!: CenteredViewLayout;\n\n\tprivate gridWidget!: SerializableGrid<IEditorGroupView>;\n\tprivate readonly gridWidgetDisposables = this._register(new DisposableStore());\n\tprivate readonly gridWidgetView = this._register(new GridWidgetView<IEditorGroupView>());\n\n\tconstructor(\n\t\tprotected readonly editorPartsView: IEditorPartsView,\n\t\tid: string,\n\t\tprivate readonly groupsLabel: string,\n\t\treadonly windowId: number,\n\t\t@IInstantiationService private readonly instantiationService: IInstantiationService,\n\t\t@IThemeService themeService: IThemeService,\n\t\t@IConfigurationService private readonly configurationService: IConfigurationService,\n\t\t@IStorageService storageService: IStorageService,\n\t\t@IWorkbenchLayoutService layoutService: IWorkbenchLayoutService,\n\t\t@IHostService private readonly hostService: IHostService,\n\t\t@IContextKeyService private readonly contextKeyService: IContextKeyService\n\t) {\n\t\tsuper(id, { hasTitle: false }, themeService, storageService, layoutService);\n\n\t\tthis.scopedContextKeyService = this._register(this.contextKeyService.createScoped(this.container));\n\t\tthis.scopedInstantiationService = this._register(this.instantiationService.createChild(new ServiceCollection(\n\t\t\t[IContextKeyService, this.scopedContextKeyService]\n\t\t)));\n\n\t\tthis._partOptions = getEditorPartOptions(this.configurationService, this.themeService);\n\n\t\tthis.registerListeners();\n\t}\n\n\tprivate registerListeners(): void {\n\t\tthis._register(this.configurationService.onDidChangeConfiguration(e => this.onConfigurationUpdated(e)));\n\t\tthis._register(this.themeService.onDidFileIconThemeChange(() => this.handleChangedPartOptions()));\n\t\tthis._register(this.onDidChangeMementoValue(StorageScope.WORKSPACE, this._store)(e => this.onDidChangeMementoState(e)));\n\t}\n\n\tprivate onConfigurationUpdated(event: IConfigurationChangeEvent): void {\n\t\tif (impactsEditorPartOptions(event)) {\n\t\t\tthis.handleChangedPartOptions();\n\t\t}\n\t}\n\n\tprivate handleChangedPartOptions(): void {\n\t\tconst oldPartOptions = this._partOptions;\n\t\tconst newPartOptions = getEditorPartOptions(this.configurationService, this.themeService);\n\n\t\tfor (const enforcedPartOptions of this.enforcedPartOptions) {\n\t\t\tObject.assign(newPartOptions, enforcedPartOptions); // check for overrides\n\t\t}\n\n\t\tthis._partOptions = newPartOptions;\n\n\t\tthis._onDidChangeEditorPartOptions.fire({ oldPartOptions, newPartOptions });\n\t}\n\n\tprivate enforcedPartOptions: DeepPartial<IEditorPartOptions>[] = [];\n\n\tprivate _partOptions: IEditorPartOptions;\n\tget partOptions(): IEditorPartOptions { return this._partOptions; }\n\n\tenforcePartOptions(options: DeepPartial<IEditorPartOptions>): IDisposable {\n\t\tthis.enforcedPartOptions.push(options);\n\t\tthis.handleChangedPartOptions();\n\n\t\treturn toDisposable(() => {\n\t\t\tthis.enforcedPartOptions.splice(this.enforcedPartOptions.indexOf(options), 1);\n\t\t\tthis.handleChangedPartOptions();\n\t\t});\n\t}\n\n\tprivate top = 0;\n\tprivate left = 0;\n\tprivate _contentDimension!: Dimension;\n\tget contentDimension(): Dimension { return this._contentDimension; }\n\n\tprivate _activeGroup!: IEditorGroupView;\n\tget activeGroup(): IEditorGroupView {\n\t\treturn this._activeGroup;\n\t}\n\n\treadonly sideGroup: IEditorSideGroup = {\n\t\topenEditor: (editor, options) => {\n\t\t\tconst [group] = this.scopedInstantiationService.invokeFunction(accessor => findGroup(accessor, { editor, options }, SIDE_GROUP));\n\n\t\t\treturn group.openEditor(editor, options);\n\t\t}\n\t};\n\n\tget groups(): IEditorGroupView[] {\n\t\treturn Array.from(this.groupViews.values());\n\t}\n\n\tget count(): number {\n\t\treturn this.groupViews.size;\n\t}\n\n\tget orientation(): GroupOrientation {\n\t\treturn (this.gridWidget && this.gridWidget.orientation === Orientation.VERTICAL) ? GroupOrientation.VERTICAL : GroupOrientation.HORIZONTAL;\n\t}\n\n\tprivate _isReady = false;\n\tget isReady(): boolean { return this._isReady; }\n\n\tprivate readonly whenReadyPromise = new DeferredPromise<void>();\n\treadonly whenReady = this.whenReadyPromise.p;\n\n\tprivate readonly whenRestoredPromise = new DeferredPromise<void>();\n\treadonly whenRestored = this.whenRestoredPromise.p;\n\n\tget hasRestorableState(): boolean {\n\t\treturn !!this.workspaceMemento[EditorPart.EDITOR_PART_UI_STATE_STORAGE_KEY];\n\t}\n\n\tprivate _willRestoreState = false;\n\tget willRestoreState(): boolean { return this._willRestoreState; }\n\n\tgetGroups(order = GroupsOrder.CREATION_TIME): IEditorGroupView[] {\n\t\tswitch (order) {\n\t\t\tcase GroupsOrder.CREATION_TIME:\n\t\t\t\treturn this.groups;\n\n\t\t\tcase GroupsOrder.MOST_RECENTLY_ACTIVE: {\n\t\t\t\tconst mostRecentActive = coalesce(this.mostRecentActiveGroups.map(groupId => this.getGroup(groupId)));\n\n\t\t\t\t// there can be groups that got never active, even though they exist. in this case\n\t\t\t\t// make sure to just append them at the end so that all groups are returned properly\n\t\t\t\treturn distinct([...mostRecentActive, ...this.groups]);\n\t\t\t}\n\t\t\tcase GroupsOrder.GRID_APPEARANCE: {\n\t\t\t\tconst views: IEditorGroupView[] = [];\n\t\t\t\tif (this.gridWidget) {\n\t\t\t\t\tthis.fillGridNodes(views, this.gridWidget.getViews());\n\t\t\t\t}\n\n\t\t\t\treturn views;\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate fillGridNodes(target: IEditorGroupView[], node: GridBranchNode<IEditorGroupView> | GridNode<IEditorGroupView>): void {\n\t\tif (isGridBranchNode(node)) {\n\t\t\tnode.children.forEach(child => this.fillGridNodes(target, child));\n\t\t} else {\n\t\t\ttarget.push(node.view);\n\t\t}\n\t}\n\n\thasGroup(identifier: GroupIdentifier): boolean {\n\t\treturn this.groupViews.has(identifier);\n\t}\n\n\tgetGroup(identifier: GroupIdentifier): IEditorGroupView | undefined {\n\t\treturn this.groupViews.get(identifier);\n\t}\n\n\tfindGroup(scope: IFindGroupScope, source: IEditorGroupView | GroupIdentifier = this.activeGroup, wrap?: boolean): IEditorGroupView | undefined {\n\n\t\t// by direction\n\t\tif (typeof scope.direction === 'number') {\n\t\t\treturn this.doFindGroupByDirection(scope.direction, source, wrap);\n\t\t}\n\n\t\t// by location\n\t\tif (typeof scope.location === 'number') {\n\t\t\treturn this.doFindGroupByLocation(scope.location, source, wrap);\n\t\t}\n\n\t\tthrow new Error('invalid arguments');\n\t}\n\n\tprivate doFindGroupByDirection(direction: GroupDirection, source: IEditorGroupView | GroupIdentifier, wrap?: boolean): IEditorGroupView | undefined {\n\t\tconst sourceGroupView = this.assertGroupView(source);\n\n\t\t// Find neighbours and sort by our MRU list\n\t\tconst neighbours = this.gridWidget.getNeighborViews(sourceGroupView, this.toGridViewDirection(direction), wrap);\n\t\tneighbours.sort(((n1, n2) => this.mostRecentActiveGroups.indexOf(n1.id) - this.mostRecentActiveGroups.indexOf(n2.id)));\n\n\t\treturn neighbours[0];\n\t}\n\n\tprivate doFindGroupByLocation(location: GroupLocation, source: IEditorGroupView | GroupIdentifier, wrap?: boolean): IEditorGroupView | undefined {\n\t\tconst sourceGroupView = this.assertGroupView(source);\n\t\tconst groups = this.getGroups(GroupsOrder.GRID_APPEARANCE);\n\t\tconst index = groups.indexOf(sourceGroupView);\n\n\t\tswitch (location) {\n\t\t\tcase GroupLocation.FIRST:\n\t\t\t\treturn groups[0];\n\t\t\tcase GroupLocation.LAST:\n\t\t\t\treturn groups[groups.length - 1];\n\t\t\tcase GroupLocation.NEXT: {\n\t\t\t\tlet nextGroup: IEditorGroupView | undefined = groups[index + 1];\n\t\t\t\tif (!nextGroup && wrap) {\n\t\t\t\t\tnextGroup = this.doFindGroupByLocation(GroupLocation.FIRST, source);\n\t\t\t\t}\n\n\t\t\t\treturn nextGroup;\n\t\t\t}\n\t\t\tcase GroupLocation.PREVIOUS: {\n\t\t\t\tlet previousGroup: IEditorGroupView | undefined = groups[index - 1];\n\t\t\t\tif (!previousGroup && wrap) {\n\t\t\t\t\tpreviousGroup = this.doFindGroupByLocation(GroupLocation.LAST, source);\n\t\t\t\t}\n\n\t\t\t\treturn previousGroup;\n\t\t\t}\n\t\t}\n\t}\n\n\tactivateGroup(group: IEditorGroupView | GroupIdentifier, preserveWindowOrder?: boolean): IEditorGroupView {\n\t\tconst groupView = this.assertGroupView(group);\n\t\tthis.doSetGroupActive(groupView);\n\n\t\t// Ensure window on top unless disabled\n\t\tif (!preserveWindowOrder) {\n\t\t\tthis.hostService.moveTop(getWindow(this.element));\n\t\t}\n\n\t\treturn groupView;\n\t}\n\n\trestoreGroup(group: IEditorGroupView | GroupIdentifier): IEditorGroupView {\n\t\tconst groupView = this.assertGroupView(group);\n\t\tthis.doRestoreGroup(groupView);\n\n\t\treturn groupView;\n\t}\n\n\tgetSize(group: IEditorGroupView | GroupIdentifier): { width: number; height: number } {\n\t\tconst groupView = this.assertGroupView(group);\n\n\t\treturn this.gridWidget.getViewSize(groupView);\n\t}\n\n\tsetSize(group: IEditorGroupView | GroupIdentifier, size: { width: number; height: number }): void {\n\t\tconst groupView = this.assertGroupView(group);\n\n\t\tthis.gridWidget.resizeView(groupView, size);\n\t}\n\n\tarrangeGroups(arrangement: GroupsArrangement, target: IEditorGroupView | GroupIdentifier = this.activeGroup): void {\n\t\tif (this.count < 2) {\n\t\t\treturn; // require at least 2 groups to show\n\t\t}\n\n\t\tif (!this.gridWidget) {\n\t\t\treturn; // we have not been created yet\n\t\t}\n\n\t\tconst groupView = this.assertGroupView(target);\n\n\t\tswitch (arrangement) {\n\t\t\tcase GroupsArrangement.EVEN:\n\t\t\t\tthis.gridWidget.distributeViewSizes();\n\t\t\t\tbreak;\n\t\t\tcase GroupsArrangement.MAXIMIZE:\n\t\t\t\tif (this.groups.length < 2) {\n\t\t\t\t\treturn; // need at least 2 groups to be maximized\n\t\t\t\t}\n\t\t\t\tthis.gridWidget.maximizeView(groupView);\n\t\t\t\tgroupView.focus();\n\t\t\t\tbreak;\n\t\t\tcase GroupsArrangement.EXPAND:\n\t\t\t\tthis.gridWidget.expandView(groupView);\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\ttoggleMaximizeGroup(target: IEditorGroupView | GroupIdentifier = this.activeGroup): void {\n\t\tif (this.hasMaximizedGroup()) {\n\t\t\tthis.unmaximizeGroup();\n\t\t} else {\n\t\t\tthis.arrangeGroups(GroupsArrangement.MAXIMIZE, target);\n\t\t}\n\t}\n\n\ttoggleExpandGroup(target: IEditorGroupView | GroupIdentifier = this.activeGroup): void {\n\t\tif (this.isGroupExpanded(this.activeGroup)) {\n\t\t\tthis.arrangeGroups(GroupsArrangement.EVEN);\n\t\t} else {\n\t\t\tthis.arrangeGroups(GroupsArrangement.EXPAND, target);\n\t\t}\n\t}\n\n\tprivate unmaximizeGroup(): void {\n\t\tthis.gridWidget.exitMaximizedView();\n\t\tthis._activeGroup.focus(); // When making views visible the focus can be affected, so restore it\n\t}\n\n\thasMaximizedGroup(): boolean {\n\t\treturn this.gridWidget.hasMaximizedView();\n\t}\n\n\tprivate isGroupMaximized(targetGroup: IEditorGroupView): boolean {\n\t\treturn this.gridWidget.isViewMaximized(targetGroup);\n\t}\n\n\tisGroupExpanded(targetGroup: IEditorGroupView): boolean {\n\t\treturn this.gridWidget.isViewExpanded(targetGroup);\n\t}\n\n\tsetGroupOrientation(orientation: GroupOrientation): void {\n\t\tif (!this.gridWidget) {\n\t\t\treturn; // we have not been created yet\n\t\t}\n\n\t\tconst newOrientation = (orientation === GroupOrientation.HORIZONTAL) ? Orientation.HORIZONTAL : Orientation.VERTICAL;\n\t\tif (this.gridWidget.orientation !== newOrientation) {\n\t\t\tthis.gridWidget.orientation = newOrientation;\n\t\t}\n\t}\n\n\tapplyLayout(layout: EditorGroupLayout): void {\n\t\tconst restoreFocus = this.shouldRestoreFocus(this.container);\n\n\t\t// Determine how many groups we need overall\n\t\tlet layoutGroupsCount = 0;\n\t\tfunction countGroups(groups: GroupLayoutArgument[]): void {\n\t\t\tfor (const group of groups) {\n\t\t\t\tif (Array.isArray(group.groups)) {\n\t\t\t\t\tcountGroups(group.groups);\n\t\t\t\t} else {\n\t\t\t\t\tlayoutGroupsCount++;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tcountGroups(layout.groups);\n\n\t\t// If we currently have too many groups, merge them into the last one\n\t\tlet currentGroupViews = this.getGroups(GroupsOrder.GRID_APPEARANCE);\n\t\tif (layoutGroupsCount < currentGroupViews.length) {\n\t\t\tconst lastGroupInLayout = currentGroupViews[layoutGroupsCount - 1];\n\t\t\tcurrentGroupViews.forEach((group, index) => {\n\t\t\t\tif (index >= layoutGroupsCount) {\n\t\t\t\t\tthis.mergeGroup(group, lastGroupInLayout);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tcurrentGroupViews = this.getGroups(GroupsOrder.GRID_APPEARANCE);\n\t\t}\n\n\t\tconst activeGroup = this.activeGroup;\n\n\t\t// Prepare grid descriptor to create new grid from\n\t\tconst gridDescriptor = createSerializedGrid({\n\t\t\torientation: this.toGridViewOrientation(\n\t\t\t\tlayout.orientation,\n\t\t\t\tthis.isTwoDimensionalGrid() ?\n\t\t\t\t\tthis.gridWidget.orientation :\t\t\t// preserve original orientation for 2-dimensional grids\n\t\t\t\t\torthogonal(this.gridWidget.orientation) // otherwise flip (fix https://github.com/microsoft/vscode/issues/52975)\n\t\t\t),\n\t\t\tgroups: layout.groups\n\t\t});\n\n\t\t// Recreate gridwidget with descriptor\n\t\tthis.doApplyGridState(gridDescriptor, activeGroup.id, currentGroupViews);\n\n\t\t// Restore focus as needed\n\t\tif (restoreFocus) {\n\t\t\tthis._activeGroup.focus();\n\t\t}\n\t}\n\n\tgetLayout(): EditorGroupLayout {\n\n\t\t// Example return value:\n\t\t// { orientation: 0, groups: [ { groups: [ { size: 0.4 }, { size: 0.6 } ], size: 0.5 }, { groups: [ {}, {} ], size: 0.5 } ] }\n\n\t\tconst serializedGrid = this.gridWidget.serialize();\n\t\tconst orientation = serializedGrid.orientation === Orientation.HORIZONTAL ? GroupOrientation.HORIZONTAL : GroupOrientation.VERTICAL;\n\t\tconst root = this.serializedNodeToGroupLayoutArgument(serializedGrid.root);\n\n\t\treturn {\n\t\t\torientation,\n\t\t\tgroups: root.groups as GroupLayoutArgument[]\n\t\t};\n\t}\n\n\tprivate serializedNodeToGroupLayoutArgument(serializedNode: ISerializedNode): GroupLayoutArgument {\n\t\tif (serializedNode.type === 'branch') {\n\t\t\treturn {\n\t\t\t\tsize: serializedNode.size,\n\t\t\t\tgroups: serializedNode.data.map(node => this.serializedNodeToGroupLayoutArgument(node))\n\t\t\t};\n\t\t}\n\n\t\treturn { size: serializedNode.size };\n\t}\n\n\tprotected shouldRestoreFocus(target: Element | undefined): boolean {\n\t\tif (!target) {\n\t\t\treturn false;\n\t\t}\n\n\t\tconst activeElement = getActiveElement();\n\t\tif (activeElement === target.ownerDocument.body) {\n\t\t\treturn true; // always restore focus if nothing is focused currently\n\t\t}\n\n\t\t// otherwise check for the active element being an ancestor of the target\n\t\treturn isAncestorOfActiveElement(target);\n\t}\n\n\tprivate isTwoDimensionalGrid(): boolean {\n\t\tconst views = this.gridWidget.getViews();\n\t\tif (isGridBranchNode(views)) {\n\t\t\t// the grid is 2-dimensional if any children\n\t\t\t// of the grid is a branch node\n\t\t\treturn views.children.some(child => isGridBranchNode(child));\n\t\t}\n\n\t\treturn false;\n\t}\n\n\taddGroup(location: IEditorGroupView | GroupIdentifier, direction: GroupDirection, groupToCopy?: IEditorGroupView): IEditorGroupView {\n\t\tconst locationView = this.assertGroupView(location);\n\n\t\tlet newGroupView: IEditorGroupView;\n\n\t\t// Same groups view: add to grid widget directly\n\t\tif (locationView.groupsView === this) {\n\t\t\tconst restoreFocus = this.shouldRestoreFocus(locationView.element);\n\n\t\t\tconst shouldExpand = this.groupViews.size > 1 && this.isGroupExpanded(locationView);\n\t\t\tnewGroupView = this.doCreateGroupView(groupToCopy);\n\n\t\t\t// Add to grid widget\n\t\t\tthis.gridWidget.addView(\n\t\t\t\tnewGroupView,\n\t\t\t\tthis.getSplitSizingStyle(),\n\t\t\t\tlocationView,\n\t\t\t\tthis.toGridViewDirection(direction),\n\t\t\t);\n\n\t\t\t// Update container\n\t\t\tthis.updateContainer();\n\n\t\t\t// Event\n\t\t\tthis._onDidAddGroup.fire(newGroupView);\n\n\t\t\t// Notify group index change given a new group was added\n\t\t\tthis.notifyGroupIndexChange();\n\n\t\t\t// Expand new group, if the reference view was previously expanded\n\t\t\tif (shouldExpand) {\n\t\t\t\tthis.arrangeGroups(GroupsArrangement.EXPAND, newGroupView);\n\t\t\t}\n\n\t\t\t// Restore focus if we had it previously after completing the grid\n\t\t\t// operation. That operation might cause reparenting of grid views\n\t\t\t// which moves focus to the <body> element otherwise.\n\t\t\tif (restoreFocus) {\n\t\t\t\tlocationView.focus();\n\t\t\t}\n\t\t}\n\n\t\t// Different group view: add to grid widget of that group\n\t\telse {\n\t\t\tnewGroupView = locationView.groupsView.addGroup(locationView, direction, groupToCopy);\n\t\t}\n\n\t\treturn newGroupView;\n\t}\n\n\tprivate getSplitSizingStyle(): Sizing {\n\t\tswitch (this._partOptions.splitSizing) {\n\t\t\tcase 'distribute':\n\t\t\t\treturn Sizing.Distribute;\n\t\t\tcase 'split':\n\t\t\t\treturn Sizing.Split;\n\t\t\tdefault:\n\t\t\t\treturn Sizing.Auto;\n\t\t}\n\t}\n\n\tprivate doCreateGroupView(from?: IEditorGroupView | ISerializedEditorGroupModel | null, options?: IEditorGroupViewOptions): IEditorGroupView {\n\n\t\t// Create group view\n\t\tlet groupView: IEditorGroupView;\n\t\tif (from instanceof EditorGroupView) {\n\t\t\tgroupView = EditorGroupView.createCopy(from, this.editorPartsView, this, this.groupsLabel, this.count, this.scopedInstantiationService, options);\n\t\t} else if (isSerializedEditorGroupModel(from)) {\n\t\t\tgroupView = EditorGroupView.createFromSerialized(from, this.editorPartsView, this, this.groupsLabel, this.count, this.scopedInstantiationService, options);\n\t\t} else {\n\t\t\tgroupView = EditorGroupView.createNew(this.editorPartsView, this, this.groupsLabel, this.count, this.scopedInstantiationService, options);\n\t\t}\n\n\t\t// Keep in map\n\t\tthis.groupViews.set(groupView.id, groupView);\n\n\t\t// Track focus\n\t\tconst groupDisposables = new DisposableStore();\n\t\tgroupDisposables.add(groupView.onDidFocus(() => {\n\t\t\tthis.doSetGroupActive(groupView);\n\n\t\t\tthis._onDidFocus.fire();\n\t\t}));\n\n\t\t// Track group changes\n\t\tgroupDisposables.add(groupView.onDidModelChange(e => {\n\t\t\tswitch (e.kind) {\n\t\t\t\tcase GroupModelChangeKind.GROUP_LOCKED:\n\t\t\t\t\tthis._onDidChangeGroupLocked.fire(groupView);\n\t\t\t\t\tbreak;\n\t\t\t\tcase GroupModelChangeKind.GROUP_INDEX:\n\t\t\t\t\tthis._onDidChangeGroupIndex.fire(groupView);\n\t\t\t\t\tbreak;\n\t\t\t\tcase GroupModelChangeKind.GROUP_LABEL:\n\t\t\t\t\tthis._onDidChangeGroupLabel.fire(groupView);\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}));\n\n\t\t// Track active editor change after it occurred\n\t\tgroupDisposables.add(groupView.onDidActiveEditorChange(() => {\n\t\t\tthis.updateContainer();\n\t\t}));\n\n\t\t// Track dispose\n\t\tEvent.once(groupView.onWillDispose)(() => {\n\t\t\tdispose(groupDisposables);\n\t\t\tthis.groupViews.delete(groupView.id);\n\t\t\tthis.doUpdateMostRecentActive(groupView);\n\t\t});\n\n\t\treturn groupView;\n\t}\n\n\tprivate doSetGroupActive(group: IEditorGroupView): void {\n\t\tif (this._activeGroup !== group) {\n\t\t\tconst previousActiveGroup = this._activeGroup;\n\t\t\tthis._activeGroup = group;\n\n\t\t\t// Update list of most recently active groups\n\t\t\tthis.doUpdateMostRecentActive(group, true);\n\n\t\t\t// Mark previous one as inactive\n\t\t\tif (previousActiveGroup && !previousActiveGroup.disposed) {\n\t\t\t\tpreviousActiveGroup.setActive(false);\n\t\t\t}\n\n\t\t\t// Mark group as new active\n\t\t\tgroup.setActive(true);\n\n\t\t\t// Expand the group if it is currently minimized\n\t\t\tthis.doRestoreGroup(group);\n\n\t\t\t// Event\n\t\t\tthis._onDidChangeActiveGroup.fire(group);\n\t\t}\n\n\t\t// Always fire the event that a group has been activated\n\t\t// even if its the same group that is already active to\n\t\t// signal the intent even when nothing has changed.\n\t\tthis._onDidActivateGroup.fire(group);\n\t}\n\n\tprivate doRestoreGroup(group: IEditorGroupView): void {\n\t\tif (!this.gridWidget) {\n\t\t\treturn; // method is called as part of state restore very early\n\t\t}\n\n\t\ttry {\n\t\t\tif (this.hasMaximizedGroup() && !this.isGroupMaximized(group)) {\n\t\t\t\tthis.unmaximizeGroup();\n\t\t\t}\n\n\t\t\tconst viewSize = this.gridWidget.getViewSize(group);\n\t\t\tif (viewSize.width === group.minimumWidth || viewSize.height === group.minimumHeight) {\n\t\t\t\tthis.arrangeGroups(GroupsArrangement.EXPAND, group);\n\t\t\t}\n\t\t} catch (error) {\n\t\t\t// ignore: method might be called too early before view is known to grid\n\t\t}\n\t}\n\n\tprivate doUpdateMostRecentActive(group: IEditorGroupView, makeMostRecentlyActive?: boolean): void {\n\t\tconst index = this.mostRecentActiveGroups.indexOf(group.id);\n\n\t\t// Remove from MRU list\n\t\tif (index !== -1) {\n\t\t\tthis.mostRecentActiveGroups.splice(index, 1);\n\t\t}\n\n\t\t// Add to front as needed\n\t\tif (makeMostRecentlyActive) {\n\t\t\tthis.mostRecentActiveGroups.unshift(group.id);\n\t\t}\n\t}\n\n\tprivate toGridViewDirection(direction: GroupDirection): Direction {\n\t\tswitch (direction) {\n\t\t\tcase GroupDirection.UP: return Direction.Up;\n\t\t\tcase GroupDirection.DOWN: return Direction.Down;\n\t\t\tcase GroupDirection.LEFT: return Direction.Left;\n\t\t\tcase GroupDirection.RIGHT: return Direction.Right;\n\t\t}\n\t}\n\n\tprivate toGridViewOrientation(orientation: GroupOrientation, fallback: Orientation): Orientation {\n\t\tif (typeof orientation === 'number') {\n\t\t\treturn orientation === GroupOrientation.HORIZONTAL ? Orientation.HORIZONTAL : Orientation.VERTICAL;\n\t\t}\n\n\t\treturn fallback;\n\t}\n\n\tremoveGroup(group: IEditorGroupView | GroupIdentifier, preserveFocus?: boolean): void {\n\t\tconst groupView = this.assertGroupView(group);\n\t\tif (this.count === 1) {\n\t\t\treturn; // Cannot remove the last root group\n\t\t}\n\n\t\t// Remove empty group\n\t\tif (groupView.isEmpty) {\n\t\t\tthis.doRemoveEmptyGroup(groupView, preserveFocus);\n\t\t}\n\n\t\t// Remove group with editors\n\t\telse {\n\t\t\tthis.doRemoveGroupWithEditors(groupView);\n\t\t}\n\t}\n\n\tprivate doRemoveGroupWithEditors(groupView: IEditorGroupView): void {\n\t\tconst mostRecentlyActiveGroups = this.getGroups(GroupsOrder.MOST_RECENTLY_ACTIVE);\n\n\t\tlet lastActiveGroup: IEditorGroupView;\n\t\tif (this._activeGroup === groupView) {\n\t\t\tlastActiveGroup = mostRecentlyActiveGroups[1];\n\t\t} else {\n\t\t\tlastActiveGroup = mostRecentlyActiveGroups[0];\n\t\t}\n\n\t\t// Removing a group with editors should merge these editors into the\n\t\t// last active group and then remove this group.\n\t\tthis.mergeGroup(groupView, lastActiveGroup);\n\t}\n\n\tprivate doRemoveEmptyGroup(groupView: IEditorGroupView, preserveFocus?: boolean): void {\n\t\tconst restoreFocus = !preserveFocus && this.shouldRestoreFocus(this.container);\n\n\t\t// Activate next group if the removed one was active\n\t\tif (this._activeGroup === groupView) {\n\t\t\tconst mostRecentlyActiveGroups = this.getGroups(GroupsOrder.MOST_RECENTLY_ACTIVE);\n\t\t\tconst nextActiveGroup = mostRecentlyActiveGroups[1]; // [0] will be the current group we are about to dispose\n\t\t\tthis.doSetGroupActive(nextActiveGroup);\n\t\t}\n\n\t\t// Remove from grid widget & dispose\n\t\tthis.gridWidget.removeView(groupView, this.getSplitSizingStyle());\n\t\tgroupView.dispose();\n\n\t\t// Restore focus if we had it previously after completing the grid\n\t\t// operation. That operation might cause reparenting of grid views\n\t\t// which moves focus to the <body> element otherwise.\n\t\tif (restoreFocus) {\n\t\t\tthis._activeGroup.focus();\n\t\t}\n\n\t\t// Notify group index change given a group was removed\n\t\tthis.notifyGroupIndexChange();\n\n\t\t// Update container\n\t\tthis.updateContainer();\n\n\t\t// Event\n\t\tthis._onDidRemoveGroup.fire(groupView);\n\t}\n\n\tmoveGroup(group: IEditorGroupView | GroupIdentifier, location: IEditorGroupView | GroupIdentifier, direction: GroupDirection): IEditorGroupView {\n\t\tconst sourceView = this.assertGroupView(group);\n\t\tconst targetView = this.assertGroupView(location);\n\n\t\tif (sourceView.id === targetView.id) {\n\t\t\tthrow new Error('Cannot move group into its own');\n\t\t}\n\n\t\tconst restoreFocus = this.shouldRestoreFocus(sourceView.element);\n\t\tlet movedView: IEditorGroupView;\n\n\t\t// Same groups view: move via grid widget API\n\t\tif (sourceView.groupsView === targetView.groupsView) {\n\t\t\tthis.gridWidget.moveView(sourceView, this.getSplitSizingStyle(), targetView, this.toGridViewDirection(direction));\n\t\t\tmovedView = sourceView;\n\t\t}\n\n\t\t// Different groups view: move via groups view API\n\t\telse {\n\t\t\tmovedView = targetView.groupsView.addGroup(targetView, direction, sourceView);\n\t\t\tsourceView.closeAllEditors();\n\t\t\tthis.removeGroup(sourceView, restoreFocus);\n\t\t}\n\n\t\t// Restore focus if we had it previously after completing the grid\n\t\t// operation. That operation might cause reparenting of grid views\n\t\t// which moves focus to the <body> element otherwise.\n\t\tif (restoreFocus) {\n\t\t\tmovedView.focus();\n\t\t}\n\n\t\t// Event\n\t\tthis._onDidMoveGroup.fire(movedView);\n\n\t\t// Notify group index change given a group was moved\n\t\tthis.notifyGroupIndexChange();\n\n\t\treturn movedView;\n\t}\n\n\tcopyGroup(group: IEditorGroupView | GroupIdentifier, location: IEditorGroupView | GroupIdentifier, direction: GroupDirection): IEditorGroupView {\n\t\tconst groupView = this.assertGroupView(group);\n\t\tconst locationView = this.assertGroupView(location);\n\n\t\tconst restoreFocus = this.shouldRestoreFocus(groupView.element);\n\n\t\t// Copy the group view\n\t\tconst copiedGroupView = this.addGroup(locationView, direction, groupView);\n\n\t\t// Restore focus if we had it\n\t\tif (restoreFocus) {\n\t\t\tcopiedGroupView.focus();\n\t\t}\n\n\t\treturn copiedGroupView;\n\t}\n\n\tmergeGroup(group: IEditorGroupView | GroupIdentifier, target: IEditorGroupView | GroupIdentifier, options?: IMergeGroupOptions): boolean {\n\t\tconst sourceView = this.assertGroupView(group);\n\t\tconst targetView = this.assertGroupView(target);\n\n\t\t// Collect editors to move/copy\n\t\tconst editors: EditorInputWithOptions[] = [];\n\t\tlet index = (options && typeof options.index === 'number') ? options.index : targetView.count;\n\t\tfor (const editor of sourceView.editors) {\n\t\t\tconst inactive = !sourceView.isActive(editor) || this._activeGroup !== sourceView;\n\n\t\t\tlet actualIndex: number | undefined;\n\t\t\tif (targetView.contains(editor) &&\n\t\t\t\t(\n\t\t\t\t\t// Do not configure an `index` for editors that are sticky in\n\t\t\t\t\t// the target, otherwise there is a chance of losing that state\n\t\t\t\t\t// when the editor is moved.\n\t\t\t\t\t// See https://github.com/microsoft/vscode/issues/239549\n\t\t\t\t\ttargetView.isSticky(editor) ||\n\t\t\t\t\t// Do not configure an `index` when we are explicitly instructed\n\t\t\t\t\toptions?.preserveExistingIndex\n\t\t\t\t)\n\t\t\t) {\n\t\t\t\t// leave `index` as `undefined`\n\t\t\t} else {\n\t\t\t\tactualIndex = index;\n\t\t\t\tindex++;\n\t\t\t}\n\n\t\t\teditors.push({\n\t\t\t\teditor,\n\t\t\t\toptions: {\n\t\t\t\t\tindex: actualIndex,\n\t\t\t\t\tinactive,\n\t\t\t\t\tpreserveFocus: inactive\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\t// Move/Copy editors over into target\n\t\tlet result = true;\n\t\tif (options?.mode === MergeGroupMode.COPY_EDITORS) {\n\t\t\tsourceView.copyEditors(editors, targetView);\n\t\t} else {\n\t\t\tresult = sourceView.moveEditors(editors, targetView);\n\t\t}\n\n\t\t// Remove source if the view is now empty and not already removed\n\t\tif (sourceView.isEmpty && !sourceView.disposed /* could have been disposed already via workbench.editor.closeEmptyGroups setting */) {\n\t\t\tthis.removeGroup(sourceView, true);\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tmergeAllGroups(target: IEditorGroupView | GroupIdentifier, options?: IMergeGroupOptions): boolean {\n\t\tconst targetView = this.assertGroupView(target);\n\n\t\tlet result = true;\n\t\tfor (const group of this.getGroups(GroupsOrder.MOST_RECENTLY_ACTIVE)) {\n\t\t\tif (group === targetView) {\n\t\t\t\tcontinue; // keep target\n\t\t\t}\n\n\t\t\tconst merged = this.mergeGroup(group, targetView, options);\n\t\t\tif (!merged) {\n\t\t\t\tresult = false;\n\t\t\t}\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tprotected assertGroupView(group: IEditorGroupView | GroupIdentifier): IEditorGroupView {\n\t\tlet groupView: IEditorGroupView | undefined;\n\t\tif (typeof group === 'number') {\n\t\t\tgroupView = this.editorPartsView.getGroup(group);\n\t\t} else {\n\t\t\tgroupView = group;\n\t\t}\n\n\t\tif (!groupView) {\n\t\t\tthrow new Error('Invalid editor group provided!');\n\t\t}\n\n\t\treturn groupView;\n\t}\n\n\tcreateEditorDropTarget(container: unknown, delegate: IEditorDropTargetDelegate): IDisposable {\n\t\tassertType(isHTMLElement(container));\n\n\t\treturn this.scopedInstantiationService.createInstance(EditorDropTarget, container, delegate);\n\t}\n\n\t//#region Part\n\n\t// TODO @sbatten @joao find something better to prevent editor taking over #79897\n\tget minimumWidth(): number { return Math.min(this.centeredLayoutWidget.minimumWidth, this.layoutService.getMaximumEditorDimensions(this.layoutService.getContainer(getWindow(this.container))).width); }\n\tget maximumWidth(): number { return this.centeredLayoutWidget.maximumWidth; }\n\tget minimumHeight(): number { return Math.min(this.centeredLayoutWidget.minimumHeight, this.layoutService.getMaximumEditorDimensions(this.layoutService.getContainer(getWindow(this.container))).height); }\n\tget maximumHeight(): number { return this.centeredLayoutWidget.maximumHeight; }\n\n\tget snap(): boolean { return this.layoutService.getPanelAlignment() === 'center'; }\n\n\toverride get onDidChange(): Event<IViewSize | undefined> { return Event.any(this.centeredLayoutWidget.onDidChange, this.onDidSetGridWidget.event); }\n\treadonly priority: LayoutPriority = LayoutPriority.High;\n\n\tprivate get gridSeparatorBorder(): Color {\n\t\treturn this.theme.getColor(EDITOR_GROUP_BORDER) || this.theme.getColor(contrastBorder) || Color.transparent;\n\t}\n\n\toverride updateStyles(): void {\n\t\tthis.container.style.backgroundColor = this.getColor(editorBackground) || '';\n\n\t\tconst separatorBorderStyle = { separatorBorder: this.gridSeparatorBorder, background: this.theme.getColor(EDITOR_PANE_BACKGROUND) || Color.transparent };\n\t\tthis.gridWidget.style(separatorBorderStyle);\n\t\tthis.centeredLayoutWidget.styles(separatorBorderStyle);\n\t}\n\n\tprotected override createContentArea(parent: HTMLElement, options?: IEditorPartCreationOptions): HTMLElement {\n\n\t\t// Container\n\t\tthis.element = parent;\n\t\tif (this.windowId !== mainWindow.vscodeWindowId) {\n\t\t\tthis.container.classList.add('auxiliary');\n\t\t}\n\t\tparent.appendChild(this.container);\n\n\t\t// Grid control\n\t\tthis._willRestoreState = !options || options.restorePreviousState;\n\t\tthis.doCreateGridControl();\n\n\t\t// Centered layout widget\n\t\tthis.centeredLayoutWidget = this._register(new CenteredViewLayout(this.container, this.gridWidgetView, this.profileMemento[EditorPart.EDITOR_PART_CENTERED_VIEW_STORAGE_KEY], this._partOptions.centeredLayoutFixedWidth));\n\t\tthis._register(this.onDidChangeEditorPartOptions(e => this.centeredLayoutWidget.setFixedWidth(e.newPartOptions.centeredLayoutFixedWidth ?? false)));\n\n\t\t// Drag & Drop support\n\t\tthis.setupDragAndDropSupport(parent, this.container);\n\n\t\t// Context keys\n\t\tthis.handleContextKeys();\n\n\t\t// Signal ready\n\t\tthis.whenReadyPromise.complete();\n\t\tthis._isReady = true;\n\n\t\t// Signal restored\n\t\tPromises.settled(this.groups.map(group => group.whenRestored)).finally(() => {\n\t\t\tthis.whenRestoredPromise.complete();\n\t\t});\n\n\t\treturn this.container;\n\t}\n\n\tprivate handleContextKeys(): void {\n\t\tconst isAuxiliaryWindowContext = IsAuxiliaryWindowContext.bindTo(this.scopedContextKeyService);\n\t\tisAuxiliaryWindowContext.set(this.windowId !== mainWindow.vscodeWindowId);\n\n\t\tconst multipleEditorGroupsContext = EditorPartMultipleEditorGroupsContext.bindTo(this.scopedContextKeyService);\n\t\tconst maximizedEditorGroupContext = EditorPartMaximizedEditorGroupContext.bindTo(this.scopedContextKeyService);\n\n\t\tconst updateContextKeys = () => {\n\t\t\tconst groupCount = this.count;\n\t\t\tif (groupCount > 1) {\n\t\t\t\tmultipleEditorGroupsContext.set(true);\n\t\t\t} else {\n\t\t\t\tmultipleEditorGroupsContext.reset();\n\t\t\t}\n\n\t\t\tif (this.hasMaximizedGroup()) {\n\t\t\t\tmaximizedEditorGroupContext.set(true);\n\t\t\t} else {\n\t\t\t\tmaximizedEditorGroupContext.reset();\n\t\t\t}\n\t\t};\n\n\t\tupdateContextKeys();\n\n\t\tthis._register(this.onDidAddGroup(() => updateContextKeys()));\n\t\tthis._register(this.onDidRemoveGroup(() => updateContextKeys()));\n\t\tthis._register(this.onDidChangeGroupMaximized(() => updateContextKeys()));\n\t}\n\n\tprivate setupDragAndDropSupport(parent: HTMLElement, container: HTMLElement): void {\n\n\t\t// Editor drop target\n\t\tthis._register(this.createEditorDropTarget(container, Object.create(null)));\n\n\t\t// No drop in the editor\n\t\tconst overlay = $('.drop-block-overlay');\n\t\tparent.appendChild(overlay);\n\n\t\t// Hide the block if a mouse down event occurs #99065\n\t\tthis._register(addDisposableGenericMouseDownListener(overlay, () => overlay.classList.remove('visible')));\n\n\t\tthis._register(CompositeDragAndDropObserver.INSTANCE.registerTarget(this.element, {\n\t\t\tonDragStart: e => overlay.classList.add('visible'),\n\t\t\tonDragEnd: e => overlay.classList.remove('visible')\n\t\t}));\n\n\t\tlet horizontalOpenerTimeout: Timeout | undefined;\n\t\tlet verticalOpenerTimeout: Timeout | undefined;\n\t\tlet lastOpenHorizontalPosition: Position | undefined;\n\t\tlet lastOpenVerticalPosition: Position | undefined;\n\t\tconst openPartAtPosition = (position: Position) => {\n\t\t\tif (!this.layoutService.isVisible(Parts.PANEL_PART) && position === this.layoutService.getPanelPosition()) {\n\t\t\t\tthis.layoutService.setPartHidden(false, Parts.PANEL_PART);\n\t\t\t} else if (!this.layoutService.isVisible(Parts.AUXILIARYBAR_PART) && position === (this.layoutService.getSideBarPosition() === Position.RIGHT ? Position.LEFT : Position.RIGHT)) {\n\t\t\t\tthis.layoutService.setPartHidden(false, Parts.AUXILIARYBAR_PART);\n\t\t\t}\n\t\t};\n\n\t\tconst clearAllTimeouts = () => {\n\t\t\tif (horizontalOpenerTimeout) {\n\t\t\t\tclearTimeout(horizontalOpenerTimeout);\n\t\t\t\thorizontalOpenerTimeout = undefined;\n\t\t\t}\n\n\t\t\tif (verticalOpenerTimeout) {\n\t\t\t\tclearTimeout(verticalOpenerTimeout);\n\t\t\t\tverticalOpenerTimeout = undefined;\n\t\t\t}\n\t\t};\n\n\t\tthis._register(CompositeDragAndDropObserver.INSTANCE.registerTarget(overlay, {\n\t\t\tonDragOver: e => {\n\t\t\t\tEventHelper.stop(e.eventData, true);\n\t\t\t\tif (e.eventData.dataTransfer) {\n\t\t\t\t\te.eventData.dataTransfer.dropEffect = 'none';\n\t\t\t\t}\n\n\t\t\t\tconst boundingRect = overlay.getBoundingClientRect();\n\n\t\t\t\tlet openHorizontalPosition: Position | undefined = undefined;\n\t\t\t\tlet openVerticalPosition: Position | undefined = undefined;\n\t\t\t\tconst proximity = 100;\n\t\t\t\tif (e.eventData.clientX < boundingRect.left + proximity) {\n\t\t\t\t\topenHorizontalPosition = Position.LEFT;\n\t\t\t\t}\n\n\t\t\t\tif (e.eventData.clientX > boundingRect.right - proximity) {\n\t\t\t\t\topenHorizontalPosition = Position.RIGHT;\n\t\t\t\t}\n\n\t\t\t\tif (e.eventData.clientY > boundingRect.bottom - proximity) {\n\t\t\t\t\topenVerticalPosition = Position.BOTTOM;\n\t\t\t\t}\n\n\t\t\t\tif (e.eventData.clientY < boundingRect.top + proximity) {\n\t\t\t\t\topenVerticalPosition = Position.TOP;\n\t\t\t\t}\n\n\t\t\t\tif (horizontalOpenerTimeout && openHorizontalPosition !== lastOpenHorizontalPosition) {\n\t\t\t\t\tclearTimeout(horizontalOpenerTimeout);\n\t\t\t\t\thorizontalOpenerTimeout = undefined;\n\t\t\t\t}\n\n\t\t\t\tif (verticalOpenerTimeout && openVerticalPosition !== lastOpenVerticalPosition) {\n\t\t\t\t\tclearTimeout(verticalOpenerTimeout);\n\t\t\t\t\tverticalOpenerTimeout = undefined;\n\t\t\t\t}\n\n\t\t\t\tif (!horizontalOpenerTimeout && openHorizontalPosition !== undefined) {\n\t\t\t\t\tlastOpenHorizontalPosition = openHorizontalPosition;\n\t\t\t\t\thorizontalOpenerTimeout = setTimeout(() => openPartAtPosition(openHorizontalPosition), 200);\n\t\t\t\t}\n\n\t\t\t\tif (!verticalOpenerTimeout && openVerticalPosition !== undefined) {\n\t\t\t\t\tlastOpenVerticalPosition = openVerticalPosition;\n\t\t\t\t\tverticalOpenerTimeout = setTimeout(() => openPartAtPosition(openVerticalPosition), 200);\n\t\t\t\t}\n\t\t\t},\n\t\t\tonDragLeave: () => clearAllTimeouts(),\n\t\t\tonDragEnd: () => clearAllTimeouts(),\n\t\t\tonDrop: () => clearAllTimeouts()\n\t\t}));\n\t}\n\n\tcenterLayout(active: boolean): void {\n\t\tthis.centeredLayoutWidget.activate(active);\n\t}\n\n\tisLayoutCentered(): boolean {\n\t\tif (this.centeredLayoutWidget) {\n\t\t\treturn this.centeredLayoutWidget.isActive();\n\t\t}\n\n\t\treturn false;\n\t}\n\n\tprivate doCreateGridControl(): void {\n\n\t\t// Grid Widget (with previous UI state)\n\t\tlet restoreError = false;\n\t\tif (this._willRestoreState) {\n\t\t\trestoreError = !this.doCreateGridControlWithPreviousState();\n\t\t}\n\n\t\t// Grid Widget (no previous UI state or failed to restore)\n\t\tif (!this.gridWidget || restoreError) {\n\t\t\tconst initialGroup = this.doCreateGroupView();\n\t\t\tthis.doSetGridWidget(new SerializableGrid(initialGroup));\n\n\t\t\t// Ensure a group is active\n\t\t\tthis.doSetGroupActive(initialGroup);\n\t\t}\n\n\t\t// Update container\n\t\tthis.updateContainer();\n\n\t\t// Notify group index change we created the entire grid\n\t\tthis.notifyGroupIndexChange();\n\t}\n\n\tprivate doCreateGridControlWithPreviousState(): boolean {\n\t\tconst state: IEditorPartUIState | undefined = this.loadState();\n\t\tif (state?.serializedGrid) {\n\t\t\ttry {\n\n\t\t\t\t// MRU\n\t\t\t\tthis.mostRecentActiveGroups = state.mostRecentActiveGroups;\n\n\t\t\t\t// Grid Widget\n\t\t\t\tthis.doCreateGridControlWithState(state.serializedGrid, state.activeGroup);\n\t\t\t} catch (error) {\n\n\t\t\t\t// Log error\n\t\t\t\tonUnexpectedError(new Error(`Error restoring editor grid widget: ${error} (with state: ${JSON.stringify(state)})`));\n\n\t\t\t\t// Clear any state we have from the failing restore\n\t\t\t\tthis.disposeGroups();\n\n\t\t\t\treturn false; // failure\n\t\t\t}\n\t\t}\n\n\t\treturn true; // success\n\t}\n\n\tprivate doCreateGridControlWithState(serializedGrid: ISerializedGrid, activeGroupId: GroupIdentifier, editorGroupViewsToReuse?: IEditorGroupView[], options?: IEditorGroupViewOptions): void {\n\n\t\t// Determine group views to reuse if any\n\t\tlet reuseGroupViews: IEditorGroupView[];\n\t\tif (editorGroupViewsToReuse) {\n\t\t\treuseGroupViews = editorGroupViewsToReuse.slice(0); // do not modify original array\n\t\t} else {\n\t\t\treuseGroupViews = [];\n\t\t}\n\n\t\t// Create new\n\t\tconst groupViews: IEditorGroupView[] = [];\n\t\tconst gridWidget = SerializableGrid.deserialize(serializedGrid, {\n\t\t\tfromJSON: (serializedEditorGroup: ISerializedEditorGroupModel | null) => {\n\t\t\t\tlet groupView: IEditorGroupView;\n\t\t\t\tif (reuseGroupViews.length > 0) {\n\t\t\t\t\tgroupView = reuseGroupViews.shift()!;\n\t\t\t\t} else {\n\t\t\t\t\tgroupView = this.doCreateGroupView(serializedEditorGroup, options);\n\t\t\t\t}\n\n\t\t\t\tgroupViews.push(groupView);\n\n\t\t\t\tif (groupView.id === activeGroupId) {\n\t\t\t\t\tthis.doSetGroupActive(groupView);\n\t\t\t\t}\n\n\t\t\t\treturn groupView;\n\t\t\t}\n\t\t}, { styles: { separatorBorder: this.gridSeparatorBorder } });\n\n\t\t// If the active group was not found when restoring the grid\n\t\t// make sure to make at least one group active. We always need\n\t\t// an active group.\n\t\tif (!this._activeGroup) {\n\t\t\tthis.doSetGroupActive(groupViews[0]);\n\t\t}\n\n\t\t// Validate MRU group views matches grid widget state\n\t\tif (this.mostRecentActiveGroups.some(groupId => !this.getGroup(groupId))) {\n\t\t\tthis.mostRecentActiveGroups = groupViews.map(group => group.id);\n\t\t}\n\n\t\t// Set it\n\t\tthis.doSetGridWidget(gridWidget);\n\t}\n\n\tprivate doSetGridWidget(gridWidget: SerializableGrid<IEditorGroupView>): void {\n\t\tlet boundarySashes: IBoundarySashes = {};\n\n\t\tif (this.gridWidget) {\n\t\t\tboundarySashes = this.gridWidget.boundarySashes;\n\t\t\tthis.gridWidget.dispose();\n\t\t}\n\n\t\tthis.gridWidget = gridWidget;\n\t\tthis.gridWidget.boundarySashes = boundarySashes;\n\t\tthis.gridWidgetView.gridWidget = gridWidget;\n\n\t\tthis._onDidChangeSizeConstraints.input = gridWidget.onDidChange;\n\t\tthis._onDidScroll.input = gridWidget.onDidScroll;\n\t\tthis.gridWidgetDisposables.clear();\n\t\tthis.gridWidgetDisposables.add(gridWidget.onDidChangeViewMaximized(maximized => this._onDidChangeGroupMaximized.fire(maximized)));\n\n\t\tthis.onDidSetGridWidget.fire(undefined);\n\t}\n\n\tprivate updateContainer(): void {\n\t\tthis.container.classList.toggle('empty', this.isEmpty);\n\t}\n\n\tprivate notifyGroupIndexChange(): void {\n\t\tthis.getGroups(GroupsOrder.GRID_APPEARANCE).forEach((group, index) => group.notifyIndexChanged(index));\n\t}\n\n\tnotifyGroupsLabelChange(newLabel: string) {\n\t\tfor (const group of this.groups) {\n\t\t\tgroup.notifyLabelChanged(newLabel);\n\t\t}\n\t}\n\n\tprivate get isEmpty(): boolean {\n\t\treturn this.count === 1 && this._activeGroup.isEmpty;\n\t}\n\n\tsetBoundarySashes(sashes: IBoundarySashes): void {\n\t\tthis.gridWidget.boundarySashes = sashes;\n\t\tthis.centeredLayoutWidget.boundarySashes = sashes;\n\t}\n\n\toverride layout(width: number, height: number, top: number, left: number): void {\n\t\tthis.top = top;\n\t\tthis.left = left;\n\n\t\t// Layout contents\n\t\tconst contentAreaSize = super.layoutContents(width, height).contentSize;\n\n\t\t// Layout editor container\n\t\tthis.doLayout(Dimension.lift(contentAreaSize), top, left);\n\t}\n\n\tprivate doLayout(dimension: Dimension, top = this.top, left = this.left): void {\n\t\tthis._contentDimension = dimension;\n\n\t\t// Layout Grid\n\t\tthis.centeredLayoutWidget.layout(this._contentDimension.width, this._contentDimension.height, top, left);\n\n\t\t// Event\n\t\tthis._onDidLayout.fire(dimension);\n\t}\n\n\tprotected override saveState(): void {\n\n\t\t// Persist grid UI state\n\t\tif (this.gridWidget) {\n\t\t\tif (this.isEmpty) {\n\t\t\t\tdelete this.workspaceMemento[EditorPart.EDITOR_PART_UI_STATE_STORAGE_KEY];\n\t\t\t} else {\n\t\t\t\tthis.workspaceMemento[EditorPart.EDITOR_PART_UI_STATE_STORAGE_KEY] = this.createState();\n\t\t\t}\n\t\t}\n\n\t\t// Persist centered view state\n\t\tif (this.centeredLayoutWidget) {\n\t\t\tconst centeredLayoutState = this.centeredLayoutWidget.state;\n\t\t\tif (this.centeredLayoutWidget.isDefault(centeredLayoutState)) {\n\t\t\t\tdelete this.profileMemento[EditorPart.EDITOR_PART_CENTERED_VIEW_STORAGE_KEY];\n\t\t\t} else {\n\t\t\t\tthis.profileMemento[EditorPart.EDITOR_PART_CENTERED_VIEW_STORAGE_KEY] = centeredLayoutState;\n\t\t\t}\n\t\t}\n\n\t\tsuper.saveState();\n\t}\n\n\tprotected loadState(): IEditorPartUIState | undefined {\n\t\treturn this.workspaceMemento[EditorPart.EDITOR_PART_UI_STATE_STORAGE_KEY];\n\t}\n\n\tcreateState(): IEditorPartUIState {\n\t\treturn {\n\t\t\tserializedGrid: this.gridWidget.serialize(),\n\t\t\tactiveGroup: this._activeGroup.id,\n\t\t\tmostRecentActiveGroups: this.mostRecentActiveGroups\n\t\t};\n\t}\n\n\tapplyState(state: IEditorPartUIState | 'empty', options?: IEditorGroupViewOptions): Promise<void> {\n\t\tif (state === 'empty') {\n\t\t\treturn this.doApplyEmptyState();\n\t\t} else {\n\t\t\treturn this.doApplyState(state, options);\n\t\t}\n\t}\n\n\tprivate async doApplyState(state: IEditorPartUIState, options?: IEditorGroupViewOptions): Promise<void> {\n\t\tconst groups = await this.doPrepareApplyState();\n\n\t\t// Pause add/remove events for groups during the duration of applying the state\n\t\t// This ensures that we can do this transition atomically with the new state\n\t\t// being ready when the events are fired. This is important because usually there\n\t\t// is never the state where no groups are present, but for this transition we\n\t\t// need to temporarily dispose all groups to restore the new set.\n\n\t\tthis._onDidAddGroup.pause();\n\t\tthis._onDidRemoveGroup.pause();\n\n\t\tthis.disposeGroups();\n\n\t\t// MRU\n\t\tthis.mostRecentActiveGroups = state.mostRecentActiveGroups;\n\n\t\t// Grid Widget\n\t\ttry {\n\t\t\tthis.doApplyGridState(state.serializedGrid, state.activeGroup, undefined, options);\n\t\t} finally {\n\t\t\t// It is very important to keep this order: first resume the events for\n\t\t\t// removed groups and then for added groups. Many listeners may store\n\t\t\t// groups in sets by their identifier and groups can have the same\n\t\t\t// identifier before and after.\n\t\t\tthis._onDidRemoveGroup.resume();\n\t\t\tthis._onDidAddGroup.resume();\n\t\t}\n\n\t\t// Restore editors that were not closed before and are now opened now\n\t\tawait this.activeGroup.openEditors(\n\t\t\tgroups\n\t\t\t\t.flatMap(group => group.editors)\n\t\t\t\t.filter(editor => this.editorPartsView.groups.every(groupView => !groupView.contains(editor)))\n\t\t\t\t.map(editor => ({\n\t\t\t\t\teditor, options: { pinned: true, preserveFocus: true, inactive: true }\n\t\t\t\t}))\n\t\t);\n\t}\n\n\tprivate async doApplyEmptyState(): Promise<void> {\n\t\tawait this.doPrepareApplyState();\n\n\t\tthis.mergeAllGroups(this.activeGroup);\n\t}\n\n\tprivate async doPrepareApplyState(): Promise<IEditorGroupView[]> {\n\n\t\t// Before disposing groups, try to close as many editors as\n\t\t// possible, but skip over those that would trigger a dialog\n\t\t// (for example when being dirty). This is to be able to later\n\t\t// restore these editors after state has been applied.\n\n\t\tconst groups = this.getGroups(GroupsOrder.MOST_RECENTLY_ACTIVE);\n\t\tfor (const group of groups) {\n\t\t\tawait group.closeAllEditors({ excludeConfirming: true });\n\t\t}\n\n\t\treturn groups;\n\t}\n\n\tprivate doApplyGridState(gridState: ISerializedGrid, activeGroupId: GroupIdentifier, editorGroupViewsToReuse?: IEditorGroupView[], options?: IEditorGroupViewOptions): void {\n\n\t\t// Recreate grid widget from state\n\t\tthis.doCreateGridControlWithState(gridState, activeGroupId, editorGroupViewsToReuse, options);\n\n\t\t// Layout\n\t\tthis.doLayout(this._contentDimension);\n\n\t\t// Update container\n\t\tthis.updateContainer();\n\n\t\t// Events for groups that got added\n\t\tfor (const groupView of this.getGroups(GroupsOrder.GRID_APPEARANCE)) {\n\t\t\tif (!editorGroupViewsToReuse?.includes(groupView)) {\n\t\t\t\tthis._onDidAddGroup.fire(groupView);\n\t\t\t}\n\t\t}\n\n\t\t// Notify group index change given layout has changed\n\t\tthis.notifyGroupIndexChange();\n\t}\n\n\tprivate onDidChangeMementoState(e: IStorageValueChangeEvent): void {\n\t\tif (e.external && e.scope === StorageScope.WORKSPACE) {\n\t\t\tthis.reloadMemento(e.scope);\n\n\t\t\tconst state = this.loadState();\n\t\t\tif (state) {\n\t\t\t\tthis.applyState(state);\n\t\t\t}\n\t\t}\n\t}\n\n\ttoJSON(): object {\n\t\treturn {\n\t\t\ttype: Parts.EDITOR_PART\n\t\t};\n\t}\n\n\tprivate disposeGroups(): void {\n\t\tfor (const group of this.groups) {\n\t\t\tgroup.dispose();\n\n\t\t\tthis._onDidRemoveGroup.fire(group);\n\t\t}\n\n\t\tthis.groupViews.clear();\n\t\tthis.mostRecentActiveGroups = [];\n\t}\n\n\toverride dispose(): void {\n\n\t\t// Event\n\t\tthis._onWillDispose.fire();\n\n\t\t// Forward to all groups\n\t\tthis.disposeGroups();\n\n\t\t// Grid widget\n\t\tthis.gridWidget?.dispose();\n\n\t\tsuper.dispose();\n\t}\n\n\t//#endregion\n}\n\nexport class MainEditorPart extends EditorPart {\n\n\tconstructor(\n\t\teditorPartsView: IEditorPartsView,\n\t\t@IInstantiationService instantiationService: IInstantiationService,\n\t\t@IThemeService themeService: IThemeService,\n\t\t@IConfigurationService configurationService: IConfigurationService,\n\t\t@IStorageService storageService: IStorageService,\n\t\t@IWorkbenchLayoutService layoutService: IWorkbenchLayoutService,\n\t\t@IHostService hostService: IHostService,\n\t\t@IContextKeyService contextKeyService: IContextKeyService\n\t) {\n\t\tsuper(editorPartsView, Parts.EDITOR_PART, '', mainWindow.vscodeWindowId, instantiationService, themeService, configurationService, storageService, layoutService, hostService, contextKeyService);\n\t}\n}\n"]}