{"version":3,"sources":["vs/workbench/browser/parts/editor/textEditor.ts"],"names":[],"mappings":"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","file":"textEditor.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { localize } from '../../../../nls.js';\nimport { URI } from '../../../../base/common/uri.js';\nimport { distinct, deepClone } from '../../../../base/common/objects.js';\nimport { Emitter, Event } from '../../../../base/common/event.js';\nimport { isObject, assertReturnsDefined } from '../../../../base/common/types.js';\nimport { MutableDisposable } from '../../../../base/common/lifecycle.js';\nimport { ICodeEditor } from '../../../../editor/browser/editorBrowser.js';\nimport { IEditorOpenContext, IEditorPaneSelection, EditorPaneSelectionCompareResult, EditorPaneSelectionChangeReason, IEditorPaneWithSelection, IEditorPaneSelectionChangeEvent, IEditorPaneScrollPosition, IEditorPaneWithScrolling } from '../../../common/editor.js';\nimport { EditorInput } from '../../../common/editor/editorInput.js';\nimport { computeEditorAriaLabel } from '../../editor.js';\nimport { AbstractEditorWithViewState } from './editorWithViewState.js';\nimport { IEditorViewState } from '../../../../editor/common/editorCommon.js';\nimport { Selection } from '../../../../editor/common/core/selection.js';\nimport { IStorageService } from '../../../../platform/storage/common/storage.js';\nimport { IInstantiationService } from '../../../../platform/instantiation/common/instantiation.js';\nimport { ITelemetryService } from '../../../../platform/telemetry/common/telemetry.js';\nimport { IThemeService } from '../../../../platform/theme/common/themeService.js';\nimport { ITextResourceConfigurationChangeEvent, ITextResourceConfigurationService } from '../../../../editor/common/services/textResourceConfiguration.js';\nimport { IEditorOptions as ICodeEditorOptions } from '../../../../editor/common/config/editorOptions.js';\nimport { IEditorGroup, IEditorGroupsService } from '../../../services/editor/common/editorGroupsService.js';\nimport { CancellationToken } from '../../../../base/common/cancellation.js';\nimport { IEditorService } from '../../../services/editor/common/editorService.js';\nimport { IEditorOptions, ITextEditorOptions, TextEditorSelectionRevealType, TextEditorSelectionSource } from '../../../../platform/editor/common/editor.js';\nimport { ICursorPositionChangedEvent } from '../../../../editor/common/cursorEvents.js';\nimport { IFileService } from '../../../../platform/files/common/files.js';\nimport { IMarkdownString } from '../../../../base/common/htmlContent.js';\n\nexport interface IEditorConfiguration {\n\teditor: object;\n\tdiffEditor: object;\n\taccessibility?: {\n\t\tverbosity?: {\n\t\t\tdiffEditor?: boolean;\n\t\t};\n\t};\n\tproblems?: {\n\t\tvisibility?: boolean;\n\t};\n}\n\n/**\n * The base class of editors that leverage any kind of text editor for the editing experience.\n */\nexport abstract class AbstractTextEditor<T extends IEditorViewState> extends AbstractEditorWithViewState<T> implements IEditorPaneWithSelection, IEditorPaneWithScrolling {\n\n\tprivate static readonly VIEW_STATE_PREFERENCE_KEY = 'textEditorViewState';\n\n\tprotected readonly _onDidChangeSelection = this._register(new Emitter<IEditorPaneSelectionChangeEvent>());\n\treadonly onDidChangeSelection = this._onDidChangeSelection.event;\n\n\tprotected readonly _onDidChangeScroll = this._register(new Emitter<void>());\n\treadonly onDidChangeScroll = this._onDidChangeScroll.event;\n\n\tprivate editorContainer: HTMLElement | undefined;\n\n\tprivate hasPendingConfigurationChange: boolean | undefined;\n\tprivate lastAppliedEditorOptions?: ICodeEditorOptions;\n\n\tprivate readonly inputListener = this._register(new MutableDisposable());\n\n\tconstructor(\n\t\tid: string,\n\t\tgroup: IEditorGroup,\n\t\t@ITelemetryService telemetryService: ITelemetryService,\n\t\t@IInstantiationService instantiationService: IInstantiationService,\n\t\t@IStorageService storageService: IStorageService,\n\t\t@ITextResourceConfigurationService textResourceConfigurationService: ITextResourceConfigurationService,\n\t\t@IThemeService themeService: IThemeService,\n\t\t@IEditorService editorService: IEditorService,\n\t\t@IEditorGroupsService editorGroupService: IEditorGroupsService,\n\t\t@IFileService protected readonly fileService: IFileService\n\t) {\n\t\tsuper(id, group, AbstractTextEditor.VIEW_STATE_PREFERENCE_KEY, telemetryService, instantiationService, storageService, textResourceConfigurationService, themeService, editorService, editorGroupService);\n\n\t\t// Listen to configuration changes\n\t\tthis._register(this.textResourceConfigurationService.onDidChangeConfiguration(e => this.handleConfigurationChangeEvent(e)));\n\n\t\t// ARIA: if a group is added or removed, update the editor's ARIA\n\t\t// label so that it appears in the label for when there are > 1 groups\n\n\t\tthis._register(Event.any(this.editorGroupService.onDidAddGroup, this.editorGroupService.onDidRemoveGroup)(() => {\n\t\t\tconst ariaLabel = this.computeAriaLabel();\n\n\t\t\tthis.editorContainer?.setAttribute('aria-label', ariaLabel);\n\t\t\tthis.updateEditorControlOptions({ ariaLabel });\n\t\t}));\n\n\t\t// Listen to file system provider changes\n\t\tthis._register(this.fileService.onDidChangeFileSystemProviderCapabilities(e => this.onDidChangeFileSystemProvider(e.scheme)));\n\t\tthis._register(this.fileService.onDidChangeFileSystemProviderRegistrations(e => this.onDidChangeFileSystemProvider(e.scheme)));\n\t}\n\n\tprivate handleConfigurationChangeEvent(e: ITextResourceConfigurationChangeEvent): void {\n\t\tconst resource = this.getActiveResource();\n\t\tif (!this.shouldHandleConfigurationChangeEvent(e, resource)) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.isVisible()) {\n\t\t\tthis.updateEditorConfiguration(resource);\n\t\t} else {\n\t\t\tthis.hasPendingConfigurationChange = true;\n\t\t}\n\t}\n\n\tprotected shouldHandleConfigurationChangeEvent(e: ITextResourceConfigurationChangeEvent, resource: URI | undefined): boolean {\n\t\treturn e.affectsConfiguration(resource, 'editor') || e.affectsConfiguration(resource, 'problems.visibility');\n\t}\n\n\tprivate consumePendingConfigurationChangeEvent(): void {\n\t\tif (this.hasPendingConfigurationChange) {\n\t\t\tthis.updateEditorConfiguration();\n\t\t\tthis.hasPendingConfigurationChange = false;\n\t\t}\n\t}\n\n\tprotected computeConfiguration(configuration: IEditorConfiguration): ICodeEditorOptions {\n\n\t\t// Specific editor options always overwrite user configuration\n\t\tconst editorConfiguration: ICodeEditorOptions = isObject(configuration.editor) ? deepClone(configuration.editor) : Object.create(null);\n\t\tObject.assign(editorConfiguration, this.getConfigurationOverrides(configuration));\n\n\t\t// ARIA label\n\t\teditorConfiguration.ariaLabel = this.computeAriaLabel();\n\n\t\treturn editorConfiguration;\n\t}\n\n\tprotected computeAriaLabel(): string {\n\t\treturn this.input ? computeEditorAriaLabel(this.input, undefined, this.group, this.editorGroupService.count) : localize('editor', \"Editor\");\n\t}\n\n\tprivate onDidChangeFileSystemProvider(scheme: string): void {\n\t\tif (!this.input) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.getActiveResource()?.scheme === scheme) {\n\t\t\tthis.updateReadonly(this.input);\n\t\t}\n\t}\n\n\tprivate onDidChangeInputCapabilities(input: EditorInput): void {\n\t\tif (this.input === input) {\n\t\t\tthis.updateReadonly(input);\n\t\t}\n\t}\n\n\tprotected updateReadonly(input: EditorInput): void {\n\t\tthis.updateEditorControlOptions({ ...this.getReadonlyConfiguration(input.isReadonly()) });\n\t}\n\n\tprotected getReadonlyConfiguration(isReadonly: boolean | IMarkdownString | undefined): { readOnly: boolean; readOnlyMessage: IMarkdownString | undefined } {\n\t\treturn {\n\t\t\treadOnly: !!isReadonly,\n\t\t\treadOnlyMessage: typeof isReadonly !== 'boolean' ? isReadonly : undefined\n\t\t};\n\t}\n\n\tprotected getConfigurationOverrides(configuration: IEditorConfiguration): ICodeEditorOptions {\n\t\treturn {\n\t\t\toverviewRulerLanes: 3,\n\t\t\tlineNumbersMinChars: 3,\n\t\t\tfixedOverflowWidgets: true,\n\t\t\t...this.getReadonlyConfiguration(this.input?.isReadonly()),\n\t\t\trenderValidationDecorations: configuration.problems?.visibility !== false ? 'on' : 'off'\n\t\t};\n\t}\n\n\tprotected createEditor(parent: HTMLElement): void {\n\n\t\t// Create editor control\n\t\tthis.editorContainer = parent;\n\t\tthis.createEditorControl(parent, this.computeConfiguration(this.textResourceConfigurationService.getValue<IEditorConfiguration>(this.getActiveResource())));\n\n\t\t// Listeners\n\t\tthis.registerCodeEditorListeners();\n\t}\n\n\tprivate registerCodeEditorListeners(): void {\n\t\tconst mainControl = this.getMainControl();\n\t\tif (mainControl) {\n\t\t\tthis._register(mainControl.onDidChangeModelLanguage(() => this.updateEditorConfiguration()));\n\t\t\tthis._register(mainControl.onDidChangeModel(() => this.updateEditorConfiguration()));\n\t\t\tthis._register(mainControl.onDidChangeCursorPosition(e => this._onDidChangeSelection.fire({ reason: this.toEditorPaneSelectionChangeReason(e) })));\n\t\t\tthis._register(mainControl.onDidChangeModelContent(() => this._onDidChangeSelection.fire({ reason: EditorPaneSelectionChangeReason.EDIT })));\n\t\t\tthis._register(mainControl.onDidScrollChange(() => this._onDidChangeScroll.fire()));\n\t\t}\n\t}\n\n\tprivate toEditorPaneSelectionChangeReason(e: ICursorPositionChangedEvent): EditorPaneSelectionChangeReason {\n\t\tswitch (e.source) {\n\t\t\tcase TextEditorSelectionSource.PROGRAMMATIC: return EditorPaneSelectionChangeReason.PROGRAMMATIC;\n\t\t\tcase TextEditorSelectionSource.NAVIGATION: return EditorPaneSelectionChangeReason.NAVIGATION;\n\t\t\tcase TextEditorSelectionSource.JUMP: return EditorPaneSelectionChangeReason.JUMP;\n\t\t\tdefault: return EditorPaneSelectionChangeReason.USER;\n\t\t}\n\t}\n\n\tgetSelection(): IEditorPaneSelection | undefined {\n\t\tconst mainControl = this.getMainControl();\n\t\tif (mainControl) {\n\t\t\tconst selection = mainControl.getSelection();\n\t\t\tif (selection) {\n\t\t\t\treturn new TextEditorPaneSelection(selection);\n\t\t\t}\n\t\t}\n\n\t\treturn undefined;\n\t}\n\n\t/**\n\t * This method creates and returns the text editor control to be used.\n\t * Subclasses must override to provide their own editor control that\n\t * should be used (e.g. a text diff editor).\n\t *\n\t * The passed in configuration object should be passed to the editor\n\t * control when creating it.\n\t */\n\tprotected abstract createEditorControl(parent: HTMLElement, initialOptions: ICodeEditorOptions): void;\n\n\t/**\n\t * The method asks to update the editor control options and is called\n\t * whenever there is change to the options.\n\t */\n\tprotected abstract updateEditorControlOptions(options: ICodeEditorOptions): void;\n\n\t/**\n\t * This method returns the main, dominant instance of `ICodeEditor`\n\t * for the editor pane. E.g. for a diff editor, this is the right\n\t * hand (modified) side.\n\t */\n\tprotected abstract getMainControl(): ICodeEditor | undefined;\n\n\toverride async setInput(input: EditorInput, options: ITextEditorOptions | undefined, context: IEditorOpenContext, token: CancellationToken): Promise<void> {\n\t\tawait super.setInput(input, options, context, token);\n\n\t\t// Update our listener for input capabilities\n\t\tthis.inputListener.value = input.onDidChangeCapabilities(() => this.onDidChangeInputCapabilities(input));\n\n\t\t// Update editor options after having set the input. We do this because there can be\n\t\t// editor input specific options (e.g. an ARIA label depending on the input showing)\n\t\tthis.updateEditorConfiguration();\n\n\t\t// Update aria label on editor\n\t\tconst editorContainer = assertReturnsDefined(this.editorContainer);\n\t\teditorContainer.setAttribute('aria-label', this.computeAriaLabel());\n\t}\n\n\toverride clearInput(): void {\n\n\t\t// Clear input listener\n\t\tthis.inputListener.clear();\n\n\t\tsuper.clearInput();\n\t}\n\n\tgetScrollPosition(): IEditorPaneScrollPosition {\n\t\tconst editor = this.getMainControl();\n\t\tif (!editor) {\n\t\t\tthrow new Error('Control has not yet been initialized');\n\t\t}\n\n\t\treturn {\n\t\t\t// The top position can vary depending on the view zones (find widget for example)\n\t\t\tscrollTop: editor.getScrollTop() - editor.getTopForLineNumber(1),\n\t\t\tscrollLeft: editor.getScrollLeft(),\n\t\t};\n\t}\n\n\tsetScrollPosition(scrollPosition: IEditorPaneScrollPosition): void {\n\t\tconst editor = this.getMainControl();\n\t\tif (!editor) {\n\t\t\tthrow new Error('Control has not yet been initialized');\n\t\t}\n\n\t\teditor.setScrollTop(scrollPosition.scrollTop);\n\t\tif (scrollPosition.scrollLeft) {\n\t\t\teditor.setScrollLeft(scrollPosition.scrollLeft);\n\t\t}\n\t}\n\n\tprotected override setEditorVisible(visible: boolean): void {\n\t\tif (visible) {\n\t\t\tthis.consumePendingConfigurationChangeEvent();\n\t\t}\n\n\t\tsuper.setEditorVisible(visible);\n\t}\n\n\tprotected override toEditorViewStateResource(input: EditorInput): URI | undefined {\n\t\treturn input.resource;\n\t}\n\n\tprivate updateEditorConfiguration(resource = this.getActiveResource()): void {\n\t\tlet configuration: IEditorConfiguration | undefined = undefined;\n\t\tif (resource) {\n\t\t\tconfiguration = this.textResourceConfigurationService.getValue<IEditorConfiguration>(resource);\n\t\t}\n\n\t\tif (!configuration) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst editorConfiguration = this.computeConfiguration(configuration);\n\n\t\t// Try to figure out the actual editor options that changed from the last time we updated the editor.\n\t\t// We do this so that we are not overwriting some dynamic editor settings (e.g. word wrap) that might\n\t\t// have been applied to the editor directly.\n\t\tlet editorSettingsToApply = editorConfiguration;\n\t\tif (this.lastAppliedEditorOptions) {\n\t\t\teditorSettingsToApply = distinct(this.lastAppliedEditorOptions, editorSettingsToApply);\n\t\t}\n\n\t\tif (Object.keys(editorSettingsToApply).length > 0) {\n\t\t\tthis.lastAppliedEditorOptions = editorConfiguration;\n\n\t\t\tthis.updateEditorControlOptions(editorSettingsToApply);\n\t\t}\n\t}\n\n\tprivate getActiveResource(): URI | undefined {\n\t\tconst mainControl = this.getMainControl();\n\t\tif (mainControl) {\n\t\t\tconst model = mainControl.getModel();\n\t\t\tif (model) {\n\t\t\t\treturn model.uri;\n\t\t\t}\n\t\t}\n\n\t\tif (this.input) {\n\t\t\treturn this.input.resource;\n\t\t}\n\n\t\treturn undefined;\n\t}\n\n\toverride dispose(): void {\n\t\tthis.lastAppliedEditorOptions = undefined;\n\n\t\tsuper.dispose();\n\t}\n}\n\nexport class TextEditorPaneSelection implements IEditorPaneSelection {\n\n\tprivate static readonly TEXT_EDITOR_SELECTION_THRESHOLD = 10; // number of lines to move in editor to justify for significant change\n\n\tconstructor(\n\t\tprivate readonly textSelection: Selection\n\t) { }\n\n\tcompare(other: IEditorPaneSelection): EditorPaneSelectionCompareResult {\n\t\tif (!(other instanceof TextEditorPaneSelection)) {\n\t\t\treturn EditorPaneSelectionCompareResult.DIFFERENT;\n\t\t}\n\n\t\tconst thisLineNumber = Math.min(this.textSelection.selectionStartLineNumber, this.textSelection.positionLineNumber);\n\t\tconst otherLineNumber = Math.min(other.textSelection.selectionStartLineNumber, other.textSelection.positionLineNumber);\n\n\t\tif (thisLineNumber === otherLineNumber) {\n\t\t\treturn EditorPaneSelectionCompareResult.IDENTICAL;\n\t\t}\n\n\t\tif (Math.abs(thisLineNumber - otherLineNumber) < TextEditorPaneSelection.TEXT_EDITOR_SELECTION_THRESHOLD) {\n\t\t\treturn EditorPaneSelectionCompareResult.SIMILAR; // when in close proximity, treat selection as being similar\n\t\t}\n\n\t\treturn EditorPaneSelectionCompareResult.DIFFERENT;\n\t}\n\n\trestore(options: IEditorOptions): ITextEditorOptions {\n\t\tconst textEditorOptions: ITextEditorOptions = {\n\t\t\t...options,\n\t\t\tselection: this.textSelection,\n\t\t\tselectionRevealType: TextEditorSelectionRevealType.CenterIfOutsideViewport\n\t\t};\n\n\t\treturn textEditorOptions;\n\t}\n\n\tlog(): string {\n\t\treturn `line: ${this.textSelection.startLineNumber}-${this.textSelection.endLineNumber}, col:  ${this.textSelection.startColumn}-${this.textSelection.endColumn}`;\n\t}\n}\n"]}