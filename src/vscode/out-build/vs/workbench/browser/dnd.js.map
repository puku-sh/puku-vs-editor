{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/browser/dnd.ts","vs/workbench/browser/dnd.ts"],"names":[],"mappings":"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","file":"dnd.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { DataTransfers, IDragAndDropData } from '../../base/browser/dnd.js';\nimport { DragAndDropObserver, EventType, addDisposableListener, onDidRegisterWindow } from '../../base/browser/dom.js';\nimport { DragMouseEvent } from '../../base/browser/mouseEvent.js';\nimport { IListDragAndDrop } from '../../base/browser/ui/list/list.js';\nimport { ElementsDragAndDropData, ListViewTargetSector } from '../../base/browser/ui/list/listView.js';\nimport { ITreeDragOverReaction } from '../../base/browser/ui/tree/tree.js';\nimport { coalesce } from '../../base/common/arrays.js';\nimport { UriList, VSDataTransfer } from '../../base/common/dataTransfer.js';\nimport { Emitter, Event } from '../../base/common/event.js';\nimport { Disposable, DisposableStore, IDisposable, markAsSingleton } from '../../base/common/lifecycle.js';\nimport { stringify } from '../../base/common/marshalling.js';\nimport { Mimes } from '../../base/common/mime.js';\nimport { FileAccess, Schemas } from '../../base/common/network.js';\nimport { isWindows } from '../../base/common/platform.js';\nimport { basename, isEqual } from '../../base/common/resources.js';\nimport { URI } from '../../base/common/uri.js';\nimport { CodeDataTransfers, Extensions, IDragAndDropContributionRegistry, IDraggedResourceEditorInput, IResourceStat, LocalSelectionTransfer, createDraggedEditorInputFromRawResourcesData, extractEditorsAndFilesDropData } from '../../platform/dnd/browser/dnd.js';\nimport { IFileService } from '../../platform/files/common/files.js';\nimport { IInstantiationService, ServicesAccessor } from '../../platform/instantiation/common/instantiation.js';\nimport { ILabelService } from '../../platform/label/common/label.js';\nimport { extractSelection, withSelection } from '../../platform/opener/common/opener.js';\nimport { Registry } from '../../platform/registry/common/platform.js';\nimport { IWindowOpenable } from '../../platform/window/common/window.js';\nimport { IWorkspaceContextService, hasWorkspaceFileExtension, isTemporaryWorkspace } from '../../platform/workspace/common/workspace.js';\nimport { IWorkspaceFolderCreationData, IWorkspacesService } from '../../platform/workspaces/common/workspaces.js';\nimport { EditorResourceAccessor, GroupIdentifier, IEditorIdentifier, isEditorIdentifier, isResourceDiffEditorInput, isResourceMergeEditorInput, isResourceSideBySideEditorInput } from '../common/editor.js';\nimport { IEditorGroup } from '../services/editor/common/editorGroupsService.js';\nimport { IEditorService } from '../services/editor/common/editorService.js';\nimport { IHostService } from '../services/host/browser/host.js';\nimport { ITextFileService } from '../services/textfile/common/textfiles.js';\nimport { IWorkspaceEditingService } from '../services/workspaces/common/workspaceEditing.js';\nimport { IEditorOptions } from '../../platform/editor/common/editor.js';\nimport { mainWindow } from '../../base/browser/window.js';\nimport { BroadcastDataChannel } from '../../base/browser/broadcast.js';\n\n//#region Editor / Resources DND\n\nexport class DraggedEditorIdentifier {\n\n\tconstructor(readonly identifier: IEditorIdentifier) { }\n}\n\nexport class DraggedEditorGroupIdentifier {\n\n\tconstructor(readonly identifier: GroupIdentifier) { }\n}\n\nexport async function extractTreeDropData(dataTransfer: VSDataTransfer): Promise<Array<IDraggedResourceEditorInput>> {\n\tconst editors: IDraggedResourceEditorInput[] = [];\n\tconst resourcesKey = Mimes.uriList.toLowerCase();\n\n\t// Data Transfer: Resources\n\tif (dataTransfer.has(resourcesKey)) {\n\t\ttry {\n\t\t\tconst asString = await dataTransfer.get(resourcesKey)?.asString();\n\t\t\tconst rawResourcesData = JSON.stringify(UriList.parse(asString ?? ''));\n\t\t\teditors.push(...createDraggedEditorInputFromRawResourcesData(rawResourcesData));\n\t\t} catch (error) {\n\t\t\t// Invalid transfer\n\t\t}\n\t}\n\n\treturn editors;\n}\n\nexport interface IResourcesDropHandlerOptions {\n\n\t/**\n\t * Whether we probe for the dropped resource to be a workspace\n\t * (i.e. code-workspace file or even a folder), allowing to\n\t * open it as workspace instead of opening as editor.\n\t */\n\treadonly allowWorkspaceOpen: boolean;\n}\n\n/**\n * Shared function across some components to handle drag & drop of resources.\n * E.g. of folders and workspace files to open them in the window instead of\n * the editor or to handle dirty editors being dropped between instances of Code.\n */\nexport class ResourcesDropHandler {\n\n\tconstructor(\n\t\tprivate readonly options: IResourcesDropHandlerOptions,\n\t\t@IFileService private readonly fileService: IFileService,\n\t\t@IWorkspacesService private readonly workspacesService: IWorkspacesService,\n\t\t@IEditorService private readonly editorService: IEditorService,\n\t\t@IWorkspaceEditingService private readonly workspaceEditingService: IWorkspaceEditingService,\n\t\t@IHostService private readonly hostService: IHostService,\n\t\t@IWorkspaceContextService private readonly contextService: IWorkspaceContextService,\n\t\t@IInstantiationService private readonly instantiationService: IInstantiationService\n\t) {\n\t}\n\n\tasync handleDrop(event: DragEvent, targetWindow: Window, resolveTargetGroup?: () => IEditorGroup | undefined, afterDrop?: (targetGroup: IEditorGroup | undefined) => void, options?: IEditorOptions): Promise<void> {\n\t\tconst editors = await this.instantiationService.invokeFunction(accessor => extractEditorsAndFilesDropData(accessor, event));\n\t\tif (!editors.length) {\n\t\t\treturn;\n\t\t}\n\n\t\t// Make the window active to handle the drop properly within\n\t\tawait this.hostService.focus(targetWindow);\n\n\t\t// Check for workspace file / folder being dropped if we are allowed to do so\n\t\tif (this.options.allowWorkspaceOpen) {\n\t\t\tconst localFilesAllowedToOpenAsWorkspace = coalesce(editors.filter(editor => editor.allowWorkspaceOpen && editor.resource?.scheme === Schemas.file).map(editor => editor.resource));\n\t\t\tif (localFilesAllowedToOpenAsWorkspace.length > 0) {\n\t\t\t\tconst isWorkspaceOpening = await this.handleWorkspaceDrop(localFilesAllowedToOpenAsWorkspace);\n\t\t\t\tif (isWorkspaceOpening) {\n\t\t\t\t\treturn; // return early if the drop operation resulted in this window changing to a workspace\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// Add external ones to recently open list unless dropped resource is a workspace\n\t\tconst externalLocalFiles = coalesce(editors.filter(editor => editor.isExternal && editor.resource?.scheme === Schemas.file).map(editor => editor.resource));\n\t\tif (externalLocalFiles.length) {\n\t\t\tthis.workspacesService.addRecentlyOpened(externalLocalFiles.map(resource => ({ fileUri: resource })));\n\t\t}\n\n\t\t// Open in Editor\n\t\tconst targetGroup = resolveTargetGroup?.();\n\t\tawait this.editorService.openEditors(editors.map(editor => ({\n\t\t\t...editor,\n\t\t\tresource: editor.resource,\n\t\t\toptions: {\n\t\t\t\t...editor.options,\n\t\t\t\t...options,\n\t\t\t\tpinned: true\n\t\t\t}\n\t\t})), targetGroup, { validateTrust: true });\n\n\t\t// Finish with provided function\n\t\tafterDrop?.(targetGroup);\n\t}\n\n\tprivate async handleWorkspaceDrop(resources: URI[]): Promise<boolean> {\n\t\tconst toOpen: IWindowOpenable[] = [];\n\t\tconst folderURIs: IWorkspaceFolderCreationData[] = [];\n\n\t\tawait Promise.all(resources.map(async resource => {\n\n\t\t\t// Check for Workspace\n\t\t\tif (hasWorkspaceFileExtension(resource)) {\n\t\t\t\ttoOpen.push({ workspaceUri: resource });\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Check for Folder\n\t\t\ttry {\n\t\t\t\tconst stat = await this.fileService.stat(resource);\n\t\t\t\tif (stat.isDirectory) {\n\t\t\t\t\ttoOpen.push({ folderUri: stat.resource });\n\t\t\t\t\tfolderURIs.push({ uri: stat.resource });\n\t\t\t\t}\n\t\t\t} catch (error) {\n\t\t\t\t// Ignore error\n\t\t\t}\n\t\t}));\n\n\t\t// Return early if no external resource is a folder or workspace\n\t\tif (toOpen.length === 0) {\n\t\t\treturn false;\n\t\t}\n\n\t\t// Open in separate windows if we drop workspaces or just one folder\n\t\tif (toOpen.length > folderURIs.length || folderURIs.length === 1) {\n\t\t\tawait this.hostService.openWindow(toOpen);\n\t\t}\n\n\t\t// Add to workspace if we are in a temporary workspace\n\t\telse if (isTemporaryWorkspace(this.contextService.getWorkspace())) {\n\t\t\tawait this.workspaceEditingService.addFolders(folderURIs);\n\t\t}\n\n\t\t// Finally, enter untitled workspace when dropping >1 folders\n\t\telse {\n\t\t\tawait this.workspaceEditingService.createAndEnterWorkspace(folderURIs);\n\t\t}\n\n\t\treturn true;\n\t}\n}\n\nexport function fillEditorsDragData(accessor: ServicesAccessor, resources: URI[], event: DragMouseEvent | DragEvent, options?: { disableStandardTransfer: boolean }): void;\nexport function fillEditorsDragData(accessor: ServicesAccessor, resources: IResourceStat[], event: DragMouseEvent | DragEvent, options?: { disableStandardTransfer: boolean }): void;\nexport function fillEditorsDragData(accessor: ServicesAccessor, editors: IEditorIdentifier[], event: DragMouseEvent | DragEvent, options?: { disableStandardTransfer: boolean }): void;\nexport function fillEditorsDragData(accessor: ServicesAccessor, resourcesOrEditors: Array<URI | IResourceStat | IEditorIdentifier>, event: DragMouseEvent | DragEvent, options?: { disableStandardTransfer: boolean }): void {\n\tif (resourcesOrEditors.length === 0 || !event.dataTransfer) {\n\t\treturn;\n\t}\n\n\tconst textFileService = accessor.get(ITextFileService);\n\tconst editorService = accessor.get(IEditorService);\n\tconst fileService = accessor.get(IFileService);\n\tconst labelService = accessor.get(ILabelService);\n\n\t// Extract resources from URIs or Editors that\n\t// can be handled by the file service\n\tconst resources = coalesce(resourcesOrEditors.map((resourceOrEditor): IResourceStat | undefined => {\n\t\tif (URI.isUri(resourceOrEditor)) {\n\t\t\treturn { resource: resourceOrEditor };\n\t\t}\n\n\t\tif (isEditorIdentifier(resourceOrEditor)) {\n\t\t\tif (URI.isUri(resourceOrEditor.editor.resource)) {\n\t\t\t\treturn { resource: resourceOrEditor.editor.resource };\n\t\t\t}\n\n\t\t\treturn undefined; // editor without resource\n\t\t}\n\n\t\treturn {\n\t\t\tresource: resourceOrEditor.selection ? withSelection(resourceOrEditor.resource, resourceOrEditor.selection) : resourceOrEditor.resource,\n\t\t\tisDirectory: resourceOrEditor.isDirectory,\n\t\t\tselection: resourceOrEditor.selection,\n\t\t};\n\t}));\n\n\tconst fileSystemResources = resources.filter(({ resource }) => fileService.hasProvider(resource));\n\tif (!options?.disableStandardTransfer) {\n\n\t\t// Text: allows to paste into text-capable areas\n\t\tconst lineDelimiter = isWindows ? '\\r\\n' : '\\n';\n\t\tevent.dataTransfer.setData(DataTransfers.TEXT, fileSystemResources.map(({ resource }) => labelService.getUriLabel(resource, { noPrefix: true })).join(lineDelimiter));\n\n\t\t// Download URL: enables support to drag a tab as file to desktop\n\t\t// Requirements:\n\t\t// - Chrome/Edge only\n\t\t// - only a single file is supported\n\t\t// - only file:/ resources are supported\n\t\tconst firstFile = fileSystemResources.find(({ isDirectory }) => !isDirectory);\n\t\tif (firstFile) {\n\t\t\tconst firstFileUri = FileAccess.uriToFileUri(firstFile.resource); // enforce `file:` URIs\n\t\t\tif (firstFileUri.scheme === Schemas.file) {\n\t\t\t\tevent.dataTransfer.setData(DataTransfers.DOWNLOAD_URL, [Mimes.binary, basename(firstFile.resource), firstFileUri.toString()].join(':'));\n\t\t\t}\n\t\t}\n\t}\n\n\t// Resource URLs: allows to drop multiple file resources to a target in VS Code\n\tconst files = fileSystemResources.filter(({ isDirectory }) => !isDirectory);\n\tif (files.length) {\n\t\tevent.dataTransfer.setData(DataTransfers.RESOURCES, JSON.stringify(files.map(({ resource }) => resource.toString())));\n\t}\n\n\t// Contributions\n\tconst contributions = Registry.as<IDragAndDropContributionRegistry>(Extensions.DragAndDropContribution).getAll();\n\tfor (const contribution of contributions) {\n\t\tcontribution.setData(resources, event);\n\t}\n\n\t// Editors: enables cross window DND of editors\n\t// into the editor area while presering UI state\n\tconst draggedEditors: IDraggedResourceEditorInput[] = [];\n\n\tfor (const resourceOrEditor of resourcesOrEditors) {\n\n\t\t// Extract resource editor from provided object or URI\n\t\tlet editor: IDraggedResourceEditorInput | undefined = undefined;\n\t\tif (isEditorIdentifier(resourceOrEditor)) {\n\t\t\tconst untypedEditor = resourceOrEditor.editor.toUntyped({ preserveViewState: resourceOrEditor.groupId });\n\t\t\tif (untypedEditor) {\n\t\t\t\teditor = { ...untypedEditor, resource: EditorResourceAccessor.getCanonicalUri(untypedEditor) };\n\t\t\t}\n\t\t} else if (URI.isUri(resourceOrEditor)) {\n\t\t\tconst { selection, uri } = extractSelection(resourceOrEditor);\n\t\t\teditor = { resource: uri, options: selection ? { selection } : undefined };\n\t\t} else if (!resourceOrEditor.isDirectory) {\n\t\t\teditor = {\n\t\t\t\tresource: resourceOrEditor.resource,\n\t\t\t\toptions: {\n\t\t\t\t\tselection: resourceOrEditor.selection,\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\n\t\tif (!editor) {\n\t\t\tcontinue; // skip over editors that cannot be transferred via dnd\n\t\t}\n\n\t\t// Fill in some properties if they are not there already by accessing\n\t\t// some well known things from the text file universe.\n\t\t// This is not ideal for custom editors, but those have a chance to\n\t\t// provide everything from the `toUntyped` method.\n\t\t{\n\t\t\tconst resource = editor.resource;\n\t\t\tif (resource) {\n\t\t\t\tconst textFileModel = textFileService.files.get(resource);\n\t\t\t\tif (textFileModel) {\n\n\t\t\t\t\t// language\n\t\t\t\t\tif (typeof editor.languageId !== 'string') {\n\t\t\t\t\t\teditor.languageId = textFileModel.getLanguageId();\n\t\t\t\t\t}\n\n\t\t\t\t\t// encoding\n\t\t\t\t\tif (typeof editor.encoding !== 'string') {\n\t\t\t\t\t\teditor.encoding = textFileModel.getEncoding();\n\t\t\t\t\t}\n\n\t\t\t\t\t// contents (only if dirty and not too large)\n\t\t\t\t\tif (typeof editor.contents !== 'string' && textFileModel.isDirty() && !textFileModel.textEditorModel.isTooLargeForHeapOperation()) {\n\t\t\t\t\t\teditor.contents = textFileModel.textEditorModel.getValue();\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// viewState\n\t\t\t\tif (!editor.options?.viewState) {\n\t\t\t\t\teditor.options = {\n\t\t\t\t\t\t...editor.options,\n\t\t\t\t\t\tviewState: (() => {\n\t\t\t\t\t\t\tfor (const visibleEditorPane of editorService.visibleEditorPanes) {\n\t\t\t\t\t\t\t\tif (isEqual(visibleEditorPane.input.resource, resource)) {\n\t\t\t\t\t\t\t\t\tconst viewState = visibleEditorPane.getViewState();\n\t\t\t\t\t\t\t\t\tif (viewState) {\n\t\t\t\t\t\t\t\t\t\treturn viewState;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\treturn undefined;\n\t\t\t\t\t\t})()\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// Add as dragged editor\n\t\tdraggedEditors.push(editor);\n\t}\n\n\tif (draggedEditors.length) {\n\t\tevent.dataTransfer.setData(CodeDataTransfers.EDITORS, stringify(draggedEditors));\n\t}\n\n\t// Add a URI list entry\n\tconst draggedDirectories: URI[] = fileSystemResources.filter(({ isDirectory }) => isDirectory).map(({ resource }) => resource);\n\tif (draggedEditors.length || draggedDirectories.length) {\n\t\tconst uriListEntries: URI[] = [...draggedDirectories];\n\t\tfor (const editor of draggedEditors) {\n\t\t\tif (editor.resource) {\n\t\t\t\turiListEntries.push(editor.options?.selection ? withSelection(editor.resource, editor.options.selection) : editor.resource);\n\t\t\t} else if (isResourceDiffEditorInput(editor)) {\n\t\t\t\tif (editor.modified.resource) {\n\t\t\t\t\turiListEntries.push(editor.modified.resource);\n\t\t\t\t}\n\t\t\t} else if (isResourceSideBySideEditorInput(editor)) {\n\t\t\t\tif (editor.primary.resource) {\n\t\t\t\t\turiListEntries.push(editor.primary.resource);\n\t\t\t\t}\n\t\t\t} else if (isResourceMergeEditorInput(editor)) {\n\t\t\t\turiListEntries.push(editor.result.resource);\n\t\t\t}\n\t\t}\n\n\t\t// Due to https://bugs.chromium.org/p/chromium/issues/detail?id=239745, we can only set\n\t\t// a single uri for the real `text/uri-list` type. Otherwise all uris end up joined together\n\t\t// However we write the full uri-list to an internal type so that other parts of VS Code\n\t\t// can use the full list.\n\t\tif (!options?.disableStandardTransfer) {\n\t\t\tevent.dataTransfer.setData(Mimes.uriList, UriList.create(uriListEntries.slice(0, 1)));\n\t\t}\n\t\tevent.dataTransfer.setData(DataTransfers.INTERNAL_URI_LIST, UriList.create(uriListEntries));\n\t}\n}\n\n//#endregion\n\n//#region Composites DND\n\nexport type Before2D = {\n\treadonly verticallyBefore: boolean;\n\treadonly horizontallyBefore: boolean;\n};\n\nexport interface ICompositeDragAndDrop {\n\tdrop(data: IDragAndDropData, target: string | undefined, originalEvent: DragEvent, before?: Before2D): void;\n\tonDragOver(data: IDragAndDropData, target: string | undefined, originalEvent: DragEvent): boolean;\n\tonDragEnter(data: IDragAndDropData, target: string | undefined, originalEvent: DragEvent): boolean;\n}\n\nexport interface ICompositeDragAndDropObserverCallbacks {\n\tonDragEnter?: (e: IDraggedCompositeData) => void;\n\tonDragLeave?: (e: IDraggedCompositeData) => void;\n\tonDrop?: (e: IDraggedCompositeData) => void;\n\tonDragOver?: (e: IDraggedCompositeData) => void;\n\tonDragStart?: (e: IDraggedCompositeData) => void;\n\tonDragEnd?: (e: IDraggedCompositeData) => void;\n}\n\nexport class CompositeDragAndDropData implements IDragAndDropData {\n\n\tconstructor(private type: 'view' | 'composite', private id: string) { }\n\n\tupdate(dataTransfer: DataTransfer): void {\n\t\t// no-op\n\t}\n\n\tgetData(): {\n\t\ttype: 'view' | 'composite';\n\t\tid: string;\n\t} {\n\t\treturn { type: this.type, id: this.id };\n\t}\n}\n\nexport interface IDraggedCompositeData {\n\treadonly eventData: DragEvent;\n\treadonly dragAndDropData: CompositeDragAndDropData;\n}\n\nexport class DraggedCompositeIdentifier {\n\n\tconstructor(private compositeId: string) { }\n\n\tget id(): string {\n\t\treturn this.compositeId;\n\t}\n}\n\nexport class DraggedViewIdentifier {\n\n\tconstructor(private viewId: string) { }\n\n\tget id(): string {\n\t\treturn this.viewId;\n\t}\n}\n\nexport type ViewType = 'composite' | 'view';\n\nexport class CompositeDragAndDropObserver extends Disposable {\n\n\tprivate static instance: CompositeDragAndDropObserver | undefined;\n\n\tstatic get INSTANCE(): CompositeDragAndDropObserver {\n\t\tif (!CompositeDragAndDropObserver.instance) {\n\t\t\tCompositeDragAndDropObserver.instance = new CompositeDragAndDropObserver();\n\t\t\tmarkAsSingleton(CompositeDragAndDropObserver.instance);\n\t\t}\n\n\t\treturn CompositeDragAndDropObserver.instance;\n\t}\n\n\tprivate readonly transferData = LocalSelectionTransfer.getInstance<DraggedCompositeIdentifier | DraggedViewIdentifier>();\n\n\tprivate readonly onDragStart = this._register(new Emitter<IDraggedCompositeData>());\n\tprivate readonly onDragEnd = this._register(new Emitter<IDraggedCompositeData>());\n\n\tprivate constructor() {\n\t\tsuper();\n\n\t\tthis._register(this.onDragEnd.event(e => {\n\t\t\tconst id = e.dragAndDropData.getData().id;\n\t\t\tconst type = e.dragAndDropData.getData().type;\n\t\t\tconst data = this.readDragData(type);\n\t\t\tif (data?.getData().id === id) {\n\t\t\t\tthis.transferData.clearData(type === 'view' ? DraggedViewIdentifier.prototype : DraggedCompositeIdentifier.prototype);\n\t\t\t}\n\t\t}));\n\t}\n\n\tprivate readDragData(type: ViewType): CompositeDragAndDropData | undefined {\n\t\tif (this.transferData.hasData(type === 'view' ? DraggedViewIdentifier.prototype : DraggedCompositeIdentifier.prototype)) {\n\t\t\tconst data = this.transferData.getData(type === 'view' ? DraggedViewIdentifier.prototype : DraggedCompositeIdentifier.prototype);\n\t\t\tif (data?.[0]) {\n\t\t\t\treturn new CompositeDragAndDropData(type, data[0].id);\n\t\t\t}\n\t\t}\n\n\t\treturn undefined;\n\t}\n\n\tprivate writeDragData(id: string, type: ViewType): void {\n\t\tthis.transferData.setData([type === 'view' ? new DraggedViewIdentifier(id) : new DraggedCompositeIdentifier(id)], type === 'view' ? DraggedViewIdentifier.prototype : DraggedCompositeIdentifier.prototype);\n\t}\n\n\tregisterTarget(element: HTMLElement, callbacks: ICompositeDragAndDropObserverCallbacks): IDisposable {\n\t\tconst disposableStore = new DisposableStore();\n\t\tdisposableStore.add(new DragAndDropObserver(element, {\n\t\t\tonDragEnter: e => {\n\t\t\t\te.preventDefault();\n\n\t\t\t\tif (callbacks.onDragEnter) {\n\t\t\t\t\tconst data = this.readDragData('composite') || this.readDragData('view');\n\t\t\t\t\tif (data) {\n\t\t\t\t\t\tcallbacks.onDragEnter({ eventData: e, dragAndDropData: data });\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t\tonDragLeave: e => {\n\t\t\t\tconst data = this.readDragData('composite') || this.readDragData('view');\n\t\t\t\tif (callbacks.onDragLeave && data) {\n\t\t\t\t\tcallbacks.onDragLeave({ eventData: e, dragAndDropData: data });\n\t\t\t\t}\n\t\t\t},\n\t\t\tonDrop: e => {\n\t\t\t\tif (callbacks.onDrop) {\n\t\t\t\t\tconst data = this.readDragData('composite') || this.readDragData('view');\n\t\t\t\t\tif (!data) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tcallbacks.onDrop({ eventData: e, dragAndDropData: data });\n\n\t\t\t\t\t// Fire drag event in case drop handler destroys the dragged element\n\t\t\t\t\tthis.onDragEnd.fire({ eventData: e, dragAndDropData: data });\n\t\t\t\t}\n\t\t\t},\n\t\t\tonDragOver: e => {\n\t\t\t\te.preventDefault();\n\n\t\t\t\tif (callbacks.onDragOver) {\n\t\t\t\t\tconst data = this.readDragData('composite') || this.readDragData('view');\n\t\t\t\t\tif (!data) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tcallbacks.onDragOver({ eventData: e, dragAndDropData: data });\n\t\t\t\t}\n\t\t\t}\n\t\t}));\n\n\t\tif (callbacks.onDragStart) {\n\t\t\tthis.onDragStart.event(e => {\n\t\t\t\tcallbacks.onDragStart!(e);\n\t\t\t}, this, disposableStore);\n\t\t}\n\n\t\tif (callbacks.onDragEnd) {\n\t\t\tthis.onDragEnd.event(e => {\n\t\t\t\tcallbacks.onDragEnd!(e);\n\t\t\t}, this, disposableStore);\n\t\t}\n\n\t\treturn this._register(disposableStore);\n\t}\n\n\tregisterDraggable(element: HTMLElement, draggedItemProvider: () => { type: ViewType; id: string }, callbacks: ICompositeDragAndDropObserverCallbacks): IDisposable {\n\t\telement.draggable = true;\n\n\t\tconst disposableStore = new DisposableStore();\n\n\t\tdisposableStore.add(new DragAndDropObserver(element, {\n\t\t\tonDragStart: e => {\n\t\t\t\tconst { id, type } = draggedItemProvider();\n\t\t\t\tthis.writeDragData(id, type);\n\n\t\t\t\te.dataTransfer?.setDragImage(element, 0, 0);\n\n\t\t\t\tthis.onDragStart.fire({ eventData: e, dragAndDropData: this.readDragData(type)! });\n\t\t\t},\n\t\t\tonDragEnd: e => {\n\t\t\t\tconst { type } = draggedItemProvider();\n\t\t\t\tconst data = this.readDragData(type);\n\t\t\t\tif (!data) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tthis.onDragEnd.fire({ eventData: e, dragAndDropData: data });\n\t\t\t},\n\t\t\tonDragEnter: e => {\n\t\t\t\tif (callbacks.onDragEnter) {\n\t\t\t\t\tconst data = this.readDragData('composite') || this.readDragData('view');\n\t\t\t\t\tif (!data) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (data) {\n\t\t\t\t\t\tcallbacks.onDragEnter({ eventData: e, dragAndDropData: data });\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t\tonDragLeave: e => {\n\t\t\t\tconst data = this.readDragData('composite') || this.readDragData('view');\n\t\t\t\tif (!data) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tcallbacks.onDragLeave?.({ eventData: e, dragAndDropData: data });\n\t\t\t},\n\t\t\tonDrop: e => {\n\t\t\t\tif (callbacks.onDrop) {\n\t\t\t\t\tconst data = this.readDragData('composite') || this.readDragData('view');\n\t\t\t\t\tif (!data) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tcallbacks.onDrop({ eventData: e, dragAndDropData: data });\n\n\t\t\t\t\t// Fire drag event in case drop handler destroys the dragged element\n\t\t\t\t\tthis.onDragEnd.fire({ eventData: e, dragAndDropData: data });\n\t\t\t\t}\n\t\t\t},\n\t\t\tonDragOver: e => {\n\t\t\t\tif (callbacks.onDragOver) {\n\t\t\t\t\tconst data = this.readDragData('composite') || this.readDragData('view');\n\t\t\t\t\tif (!data) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tcallbacks.onDragOver({ eventData: e, dragAndDropData: data });\n\t\t\t\t}\n\t\t\t}\n\t\t}));\n\n\t\tif (callbacks.onDragStart) {\n\t\t\tthis.onDragStart.event(e => {\n\t\t\t\tcallbacks.onDragStart!(e);\n\t\t\t}, this, disposableStore);\n\t\t}\n\n\t\tif (callbacks.onDragEnd) {\n\t\t\tthis.onDragEnd.event(e => {\n\t\t\t\tcallbacks.onDragEnd!(e);\n\t\t\t}, this, disposableStore);\n\t\t}\n\n\t\treturn this._register(disposableStore);\n\t}\n}\n\nexport function toggleDropEffect(dataTransfer: DataTransfer | null, dropEffect: 'none' | 'copy' | 'link' | 'move', shouldHaveIt: boolean) {\n\tif (!dataTransfer) {\n\t\treturn;\n\t}\n\n\tdataTransfer.dropEffect = shouldHaveIt ? dropEffect : 'none';\n}\n\nexport class ResourceListDnDHandler<T> implements IListDragAndDrop<T> {\n\tconstructor(\n\t\tprivate readonly toResource: (e: T) => URI | null,\n\t\t@IInstantiationService private readonly instantiationService: IInstantiationService\n\t) { }\n\n\tgetDragURI(element: T): string | null {\n\t\tconst resource = this.toResource(element);\n\t\treturn resource ? resource.toString() : null;\n\t}\n\n\tgetDragLabel(elements: T[]): string | undefined {\n\t\tconst resources = coalesce(elements.map(this.toResource));\n\t\treturn resources.length === 1 ? basename(resources[0]) : resources.length > 1 ? String(resources.length) : undefined;\n\t}\n\n\tonDragStart(data: IDragAndDropData, originalEvent: DragEvent): void {\n\t\tconst resources: URI[] = [];\n\t\tconst elements = (data as ElementsDragAndDropData<T>).elements;\n\t\tfor (const element of elements) {\n\t\t\tconst resource = this.toResource(element);\n\t\t\tif (resource) {\n\t\t\t\tresources.push(resource);\n\t\t\t}\n\t\t}\n\t\tthis.onWillDragElements(elements, originalEvent);\n\t\tif (resources.length) {\n\t\t\t// Apply some datatransfer types to allow for dragging the element outside of the application\n\t\t\tthis.instantiationService.invokeFunction(accessor => fillEditorsDragData(accessor, resources, originalEvent));\n\t\t}\n\t}\n\n\tprotected onWillDragElements(elements: readonly T[], originalEvent: DragEvent): void {\n\t\t// noop\n\t}\n\n\tonDragOver(data: IDragAndDropData, targetElement: T, targetIndex: number, targetSector: ListViewTargetSector | undefined, originalEvent: DragEvent): boolean | ITreeDragOverReaction {\n\t\treturn false;\n\t}\n\n\tdrop(data: IDragAndDropData, targetElement: T, targetIndex: number, targetSector: ListViewTargetSector | undefined, originalEvent: DragEvent): void { }\n\n\tdispose(): void { }\n}\n\n//#endregion\n\nclass GlobalWindowDraggedOverTracker extends Disposable {\n\n\tprivate static readonly CHANNEL_NAME = 'monaco-workbench-global-dragged-over';\n\n\tprivate readonly broadcaster = this._register(new BroadcastDataChannel<boolean>(GlobalWindowDraggedOverTracker.CHANNEL_NAME));\n\n\tconstructor() {\n\t\tsuper();\n\n\t\tthis.registerListeners();\n\t}\n\n\tprivate registerListeners(): void {\n\t\tthis._register(Event.runAndSubscribe(onDidRegisterWindow, ({ window, disposables }) => {\n\t\t\tdisposables.add(addDisposableListener(window, EventType.DRAG_OVER, () => this.markDraggedOver(false), true));\n\t\t\tdisposables.add(addDisposableListener(window, EventType.DRAG_LEAVE, () => this.clearDraggedOver(false), true));\n\t\t}, { window: mainWindow, disposables: this._store }));\n\n\t\tthis._register(this.broadcaster.onDidReceiveData(data => {\n\t\t\tif (data === true) {\n\t\t\t\tthis.markDraggedOver(true);\n\t\t\t} else {\n\t\t\t\tthis.clearDraggedOver(true);\n\t\t\t}\n\t\t}));\n\t}\n\n\tprivate draggedOver = false;\n\tget isDraggedOver(): boolean { return this.draggedOver; }\n\n\tprivate markDraggedOver(fromBroadcast: boolean): void {\n\t\tif (this.draggedOver === true) {\n\t\t\treturn; // alrady marked\n\t\t}\n\n\t\tthis.draggedOver = true;\n\n\t\tif (!fromBroadcast) {\n\t\t\tthis.broadcaster.postData(true);\n\t\t}\n\t}\n\n\tprivate clearDraggedOver(fromBroadcast: boolean): void {\n\t\tif (this.draggedOver === false) {\n\t\t\treturn; // alrady cleared\n\t\t}\n\n\t\tthis.draggedOver = false;\n\n\t\tif (!fromBroadcast) {\n\t\t\tthis.broadcaster.postData(false);\n\t\t}\n\t}\n}\n\nconst globalDraggedOverTracker = new GlobalWindowDraggedOverTracker();\n\n/**\n * Returns whether the workbench is currently dragged over in any of\n * the opened windows (main windows and auxiliary windows).\n */\nexport function isWindowDraggedOver(): boolean {\n\treturn globalDraggedOverTracker.isDraggedOver;\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { DataTransfers, IDragAndDropData } from '../../base/browser/dnd.js';\nimport { DragAndDropObserver, EventType, addDisposableListener, onDidRegisterWindow } from '../../base/browser/dom.js';\nimport { DragMouseEvent } from '../../base/browser/mouseEvent.js';\nimport { IListDragAndDrop } from '../../base/browser/ui/list/list.js';\nimport { ElementsDragAndDropData, ListViewTargetSector } from '../../base/browser/ui/list/listView.js';\nimport { ITreeDragOverReaction } from '../../base/browser/ui/tree/tree.js';\nimport { coalesce } from '../../base/common/arrays.js';\nimport { UriList, VSDataTransfer } from '../../base/common/dataTransfer.js';\nimport { Emitter, Event } from '../../base/common/event.js';\nimport { Disposable, DisposableStore, IDisposable, markAsSingleton } from '../../base/common/lifecycle.js';\nimport { stringify } from '../../base/common/marshalling.js';\nimport { Mimes } from '../../base/common/mime.js';\nimport { FileAccess, Schemas } from '../../base/common/network.js';\nimport { isWindows } from '../../base/common/platform.js';\nimport { basename, isEqual } from '../../base/common/resources.js';\nimport { URI } from '../../base/common/uri.js';\nimport { CodeDataTransfers, Extensions, IDragAndDropContributionRegistry, IDraggedResourceEditorInput, IResourceStat, LocalSelectionTransfer, createDraggedEditorInputFromRawResourcesData, extractEditorsAndFilesDropData } from '../../platform/dnd/browser/dnd.js';\nimport { IFileService } from '../../platform/files/common/files.js';\nimport { IInstantiationService, ServicesAccessor } from '../../platform/instantiation/common/instantiation.js';\nimport { ILabelService } from '../../platform/label/common/label.js';\nimport { extractSelection, withSelection } from '../../platform/opener/common/opener.js';\nimport { Registry } from '../../platform/registry/common/platform.js';\nimport { IWindowOpenable } from '../../platform/window/common/window.js';\nimport { IWorkspaceContextService, hasWorkspaceFileExtension, isTemporaryWorkspace } from '../../platform/workspace/common/workspace.js';\nimport { IWorkspaceFolderCreationData, IWorkspacesService } from '../../platform/workspaces/common/workspaces.js';\nimport { EditorResourceAccessor, GroupIdentifier, IEditorIdentifier, isEditorIdentifier, isResourceDiffEditorInput, isResourceMergeEditorInput, isResourceSideBySideEditorInput } from '../common/editor.js';\nimport { IEditorGroup } from '../services/editor/common/editorGroupsService.js';\nimport { IEditorService } from '../services/editor/common/editorService.js';\nimport { IHostService } from '../services/host/browser/host.js';\nimport { ITextFileService } from '../services/textfile/common/textfiles.js';\nimport { IWorkspaceEditingService } from '../services/workspaces/common/workspaceEditing.js';\nimport { IEditorOptions } from '../../platform/editor/common/editor.js';\nimport { mainWindow } from '../../base/browser/window.js';\nimport { BroadcastDataChannel } from '../../base/browser/broadcast.js';\n\n//#region Editor / Resources DND\n\nexport class DraggedEditorIdentifier {\n\n\tconstructor(readonly identifier: IEditorIdentifier) { }\n}\n\nexport class DraggedEditorGroupIdentifier {\n\n\tconstructor(readonly identifier: GroupIdentifier) { }\n}\n\nexport async function extractTreeDropData(dataTransfer: VSDataTransfer): Promise<Array<IDraggedResourceEditorInput>> {\n\tconst editors: IDraggedResourceEditorInput[] = [];\n\tconst resourcesKey = Mimes.uriList.toLowerCase();\n\n\t// Data Transfer: Resources\n\tif (dataTransfer.has(resourcesKey)) {\n\t\ttry {\n\t\t\tconst asString = await dataTransfer.get(resourcesKey)?.asString();\n\t\t\tconst rawResourcesData = JSON.stringify(UriList.parse(asString ?? ''));\n\t\t\teditors.push(...createDraggedEditorInputFromRawResourcesData(rawResourcesData));\n\t\t} catch (error) {\n\t\t\t// Invalid transfer\n\t\t}\n\t}\n\n\treturn editors;\n}\n\nexport interface IResourcesDropHandlerOptions {\n\n\t/**\n\t * Whether we probe for the dropped resource to be a workspace\n\t * (i.e. code-workspace file or even a folder), allowing to\n\t * open it as workspace instead of opening as editor.\n\t */\n\treadonly allowWorkspaceOpen: boolean;\n}\n\n/**\n * Shared function across some components to handle drag & drop of resources.\n * E.g. of folders and workspace files to open them in the window instead of\n * the editor or to handle dirty editors being dropped between instances of Code.\n */\nexport class ResourcesDropHandler {\n\n\tconstructor(\n\t\tprivate readonly options: IResourcesDropHandlerOptions,\n\t\t@IFileService private readonly fileService: IFileService,\n\t\t@IWorkspacesService private readonly workspacesService: IWorkspacesService,\n\t\t@IEditorService private readonly editorService: IEditorService,\n\t\t@IWorkspaceEditingService private readonly workspaceEditingService: IWorkspaceEditingService,\n\t\t@IHostService private readonly hostService: IHostService,\n\t\t@IWorkspaceContextService private readonly contextService: IWorkspaceContextService,\n\t\t@IInstantiationService private readonly instantiationService: IInstantiationService\n\t) {\n\t}\n\n\tasync handleDrop(event: DragEvent, targetWindow: Window, resolveTargetGroup?: () => IEditorGroup | undefined, afterDrop?: (targetGroup: IEditorGroup | undefined) => void, options?: IEditorOptions): Promise<void> {\n\t\tconst editors = await this.instantiationService.invokeFunction(accessor => extractEditorsAndFilesDropData(accessor, event));\n\t\tif (!editors.length) {\n\t\t\treturn;\n\t\t}\n\n\t\t// Make the window active to handle the drop properly within\n\t\tawait this.hostService.focus(targetWindow);\n\n\t\t// Check for workspace file / folder being dropped if we are allowed to do so\n\t\tif (this.options.allowWorkspaceOpen) {\n\t\t\tconst localFilesAllowedToOpenAsWorkspace = coalesce(editors.filter(editor => editor.allowWorkspaceOpen && editor.resource?.scheme === Schemas.file).map(editor => editor.resource));\n\t\t\tif (localFilesAllowedToOpenAsWorkspace.length > 0) {\n\t\t\t\tconst isWorkspaceOpening = await this.handleWorkspaceDrop(localFilesAllowedToOpenAsWorkspace);\n\t\t\t\tif (isWorkspaceOpening) {\n\t\t\t\t\treturn; // return early if the drop operation resulted in this window changing to a workspace\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// Add external ones to recently open list unless dropped resource is a workspace\n\t\tconst externalLocalFiles = coalesce(editors.filter(editor => editor.isExternal && editor.resource?.scheme === Schemas.file).map(editor => editor.resource));\n\t\tif (externalLocalFiles.length) {\n\t\t\tthis.workspacesService.addRecentlyOpened(externalLocalFiles.map(resource => ({ fileUri: resource })));\n\t\t}\n\n\t\t// Open in Editor\n\t\tconst targetGroup = resolveTargetGroup?.();\n\t\tawait this.editorService.openEditors(editors.map(editor => ({\n\t\t\t...editor,\n\t\t\tresource: editor.resource,\n\t\t\toptions: {\n\t\t\t\t...editor.options,\n\t\t\t\t...options,\n\t\t\t\tpinned: true\n\t\t\t}\n\t\t})), targetGroup, { validateTrust: true });\n\n\t\t// Finish with provided function\n\t\tafterDrop?.(targetGroup);\n\t}\n\n\tprivate async handleWorkspaceDrop(resources: URI[]): Promise<boolean> {\n\t\tconst toOpen: IWindowOpenable[] = [];\n\t\tconst folderURIs: IWorkspaceFolderCreationData[] = [];\n\n\t\tawait Promise.all(resources.map(async resource => {\n\n\t\t\t// Check for Workspace\n\t\t\tif (hasWorkspaceFileExtension(resource)) {\n\t\t\t\ttoOpen.push({ workspaceUri: resource });\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Check for Folder\n\t\t\ttry {\n\t\t\t\tconst stat = await this.fileService.stat(resource);\n\t\t\t\tif (stat.isDirectory) {\n\t\t\t\t\ttoOpen.push({ folderUri: stat.resource });\n\t\t\t\t\tfolderURIs.push({ uri: stat.resource });\n\t\t\t\t}\n\t\t\t} catch (error) {\n\t\t\t\t// Ignore error\n\t\t\t}\n\t\t}));\n\n\t\t// Return early if no external resource is a folder or workspace\n\t\tif (toOpen.length === 0) {\n\t\t\treturn false;\n\t\t}\n\n\t\t// Open in separate windows if we drop workspaces or just one folder\n\t\tif (toOpen.length > folderURIs.length || folderURIs.length === 1) {\n\t\t\tawait this.hostService.openWindow(toOpen);\n\t\t}\n\n\t\t// Add to workspace if we are in a temporary workspace\n\t\telse if (isTemporaryWorkspace(this.contextService.getWorkspace())) {\n\t\t\tawait this.workspaceEditingService.addFolders(folderURIs);\n\t\t}\n\n\t\t// Finally, enter untitled workspace when dropping >1 folders\n\t\telse {\n\t\t\tawait this.workspaceEditingService.createAndEnterWorkspace(folderURIs);\n\t\t}\n\n\t\treturn true;\n\t}\n}\n\nexport function fillEditorsDragData(accessor: ServicesAccessor, resources: URI[], event: DragMouseEvent | DragEvent, options?: { disableStandardTransfer: boolean }): void;\nexport function fillEditorsDragData(accessor: ServicesAccessor, resources: IResourceStat[], event: DragMouseEvent | DragEvent, options?: { disableStandardTransfer: boolean }): void;\nexport function fillEditorsDragData(accessor: ServicesAccessor, editors: IEditorIdentifier[], event: DragMouseEvent | DragEvent, options?: { disableStandardTransfer: boolean }): void;\nexport function fillEditorsDragData(accessor: ServicesAccessor, resourcesOrEditors: Array<URI | IResourceStat | IEditorIdentifier>, event: DragMouseEvent | DragEvent, options?: { disableStandardTransfer: boolean }): void {\n\tif (resourcesOrEditors.length === 0 || !event.dataTransfer) {\n\t\treturn;\n\t}\n\n\tconst textFileService = accessor.get(ITextFileService);\n\tconst editorService = accessor.get(IEditorService);\n\tconst fileService = accessor.get(IFileService);\n\tconst labelService = accessor.get(ILabelService);\n\n\t// Extract resources from URIs or Editors that\n\t// can be handled by the file service\n\tconst resources = coalesce(resourcesOrEditors.map((resourceOrEditor): IResourceStat | undefined => {\n\t\tif (URI.isUri(resourceOrEditor)) {\n\t\t\treturn { resource: resourceOrEditor };\n\t\t}\n\n\t\tif (isEditorIdentifier(resourceOrEditor)) {\n\t\t\tif (URI.isUri(resourceOrEditor.editor.resource)) {\n\t\t\t\treturn { resource: resourceOrEditor.editor.resource };\n\t\t\t}\n\n\t\t\treturn undefined; // editor without resource\n\t\t}\n\n\t\treturn {\n\t\t\tresource: resourceOrEditor.selection ? withSelection(resourceOrEditor.resource, resourceOrEditor.selection) : resourceOrEditor.resource,\n\t\t\tisDirectory: resourceOrEditor.isDirectory,\n\t\t\tselection: resourceOrEditor.selection,\n\t\t};\n\t}));\n\n\tconst fileSystemResources = resources.filter(({ resource }) => fileService.hasProvider(resource));\n\tif (!options?.disableStandardTransfer) {\n\n\t\t// Text: allows to paste into text-capable areas\n\t\tconst lineDelimiter = isWindows ? '\\r\\n' : '\\n';\n\t\tevent.dataTransfer.setData(DataTransfers.TEXT, fileSystemResources.map(({ resource }) => labelService.getUriLabel(resource, { noPrefix: true })).join(lineDelimiter));\n\n\t\t// Download URL: enables support to drag a tab as file to desktop\n\t\t// Requirements:\n\t\t// - Chrome/Edge only\n\t\t// - only a single file is supported\n\t\t// - only file:/ resources are supported\n\t\tconst firstFile = fileSystemResources.find(({ isDirectory }) => !isDirectory);\n\t\tif (firstFile) {\n\t\t\tconst firstFileUri = FileAccess.uriToFileUri(firstFile.resource); // enforce `file:` URIs\n\t\t\tif (firstFileUri.scheme === Schemas.file) {\n\t\t\t\tevent.dataTransfer.setData(DataTransfers.DOWNLOAD_URL, [Mimes.binary, basename(firstFile.resource), firstFileUri.toString()].join(':'));\n\t\t\t}\n\t\t}\n\t}\n\n\t// Resource URLs: allows to drop multiple file resources to a target in VS Code\n\tconst files = fileSystemResources.filter(({ isDirectory }) => !isDirectory);\n\tif (files.length) {\n\t\tevent.dataTransfer.setData(DataTransfers.RESOURCES, JSON.stringify(files.map(({ resource }) => resource.toString())));\n\t}\n\n\t// Contributions\n\tconst contributions = Registry.as<IDragAndDropContributionRegistry>(Extensions.DragAndDropContribution).getAll();\n\tfor (const contribution of contributions) {\n\t\tcontribution.setData(resources, event);\n\t}\n\n\t// Editors: enables cross window DND of editors\n\t// into the editor area while presering UI state\n\tconst draggedEditors: IDraggedResourceEditorInput[] = [];\n\n\tfor (const resourceOrEditor of resourcesOrEditors) {\n\n\t\t// Extract resource editor from provided object or URI\n\t\tlet editor: IDraggedResourceEditorInput | undefined = undefined;\n\t\tif (isEditorIdentifier(resourceOrEditor)) {\n\t\t\tconst untypedEditor = resourceOrEditor.editor.toUntyped({ preserveViewState: resourceOrEditor.groupId });\n\t\t\tif (untypedEditor) {\n\t\t\t\teditor = { ...untypedEditor, resource: EditorResourceAccessor.getCanonicalUri(untypedEditor) };\n\t\t\t}\n\t\t} else if (URI.isUri(resourceOrEditor)) {\n\t\t\tconst { selection, uri } = extractSelection(resourceOrEditor);\n\t\t\teditor = { resource: uri, options: selection ? { selection } : undefined };\n\t\t} else if (!resourceOrEditor.isDirectory) {\n\t\t\teditor = {\n\t\t\t\tresource: resourceOrEditor.resource,\n\t\t\t\toptions: {\n\t\t\t\t\tselection: resourceOrEditor.selection,\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\n\t\tif (!editor) {\n\t\t\tcontinue; // skip over editors that cannot be transferred via dnd\n\t\t}\n\n\t\t// Fill in some properties if they are not there already by accessing\n\t\t// some well known things from the text file universe.\n\t\t// This is not ideal for custom editors, but those have a chance to\n\t\t// provide everything from the `toUntyped` method.\n\t\t{\n\t\t\tconst resource = editor.resource;\n\t\t\tif (resource) {\n\t\t\t\tconst textFileModel = textFileService.files.get(resource);\n\t\t\t\tif (textFileModel) {\n\n\t\t\t\t\t// language\n\t\t\t\t\tif (typeof editor.languageId !== 'string') {\n\t\t\t\t\t\teditor.languageId = textFileModel.getLanguageId();\n\t\t\t\t\t}\n\n\t\t\t\t\t// encoding\n\t\t\t\t\tif (typeof editor.encoding !== 'string') {\n\t\t\t\t\t\teditor.encoding = textFileModel.getEncoding();\n\t\t\t\t\t}\n\n\t\t\t\t\t// contents (only if dirty and not too large)\n\t\t\t\t\tif (typeof editor.contents !== 'string' && textFileModel.isDirty() && !textFileModel.textEditorModel.isTooLargeForHeapOperation()) {\n\t\t\t\t\t\teditor.contents = textFileModel.textEditorModel.getValue();\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// viewState\n\t\t\t\tif (!editor.options?.viewState) {\n\t\t\t\t\teditor.options = {\n\t\t\t\t\t\t...editor.options,\n\t\t\t\t\t\tviewState: (() => {\n\t\t\t\t\t\t\tfor (const visibleEditorPane of editorService.visibleEditorPanes) {\n\t\t\t\t\t\t\t\tif (isEqual(visibleEditorPane.input.resource, resource)) {\n\t\t\t\t\t\t\t\t\tconst viewState = visibleEditorPane.getViewState();\n\t\t\t\t\t\t\t\t\tif (viewState) {\n\t\t\t\t\t\t\t\t\t\treturn viewState;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\treturn undefined;\n\t\t\t\t\t\t})()\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// Add as dragged editor\n\t\tdraggedEditors.push(editor);\n\t}\n\n\tif (draggedEditors.length) {\n\t\tevent.dataTransfer.setData(CodeDataTransfers.EDITORS, stringify(draggedEditors));\n\t}\n\n\t// Add a URI list entry\n\tconst draggedDirectories: URI[] = fileSystemResources.filter(({ isDirectory }) => isDirectory).map(({ resource }) => resource);\n\tif (draggedEditors.length || draggedDirectories.length) {\n\t\tconst uriListEntries: URI[] = [...draggedDirectories];\n\t\tfor (const editor of draggedEditors) {\n\t\t\tif (editor.resource) {\n\t\t\t\turiListEntries.push(editor.options?.selection ? withSelection(editor.resource, editor.options.selection) : editor.resource);\n\t\t\t} else if (isResourceDiffEditorInput(editor)) {\n\t\t\t\tif (editor.modified.resource) {\n\t\t\t\t\turiListEntries.push(editor.modified.resource);\n\t\t\t\t}\n\t\t\t} else if (isResourceSideBySideEditorInput(editor)) {\n\t\t\t\tif (editor.primary.resource) {\n\t\t\t\t\turiListEntries.push(editor.primary.resource);\n\t\t\t\t}\n\t\t\t} else if (isResourceMergeEditorInput(editor)) {\n\t\t\t\turiListEntries.push(editor.result.resource);\n\t\t\t}\n\t\t}\n\n\t\t// Due to https://bugs.chromium.org/p/chromium/issues/detail?id=239745, we can only set\n\t\t// a single uri for the real `text/uri-list` type. Otherwise all uris end up joined together\n\t\t// However we write the full uri-list to an internal type so that other parts of VS Code\n\t\t// can use the full list.\n\t\tif (!options?.disableStandardTransfer) {\n\t\t\tevent.dataTransfer.setData(Mimes.uriList, UriList.create(uriListEntries.slice(0, 1)));\n\t\t}\n\t\tevent.dataTransfer.setData(DataTransfers.INTERNAL_URI_LIST, UriList.create(uriListEntries));\n\t}\n}\n\n//#endregion\n\n//#region Composites DND\n\nexport type Before2D = {\n\treadonly verticallyBefore: boolean;\n\treadonly horizontallyBefore: boolean;\n};\n\nexport interface ICompositeDragAndDrop {\n\tdrop(data: IDragAndDropData, target: string | undefined, originalEvent: DragEvent, before?: Before2D): void;\n\tonDragOver(data: IDragAndDropData, target: string | undefined, originalEvent: DragEvent): boolean;\n\tonDragEnter(data: IDragAndDropData, target: string | undefined, originalEvent: DragEvent): boolean;\n}\n\nexport interface ICompositeDragAndDropObserverCallbacks {\n\tonDragEnter?: (e: IDraggedCompositeData) => void;\n\tonDragLeave?: (e: IDraggedCompositeData) => void;\n\tonDrop?: (e: IDraggedCompositeData) => void;\n\tonDragOver?: (e: IDraggedCompositeData) => void;\n\tonDragStart?: (e: IDraggedCompositeData) => void;\n\tonDragEnd?: (e: IDraggedCompositeData) => void;\n}\n\nexport class CompositeDragAndDropData implements IDragAndDropData {\n\n\tconstructor(private type: 'view' | 'composite', private id: string) { }\n\n\tupdate(dataTransfer: DataTransfer): void {\n\t\t// no-op\n\t}\n\n\tgetData(): {\n\t\ttype: 'view' | 'composite';\n\t\tid: string;\n\t} {\n\t\treturn { type: this.type, id: this.id };\n\t}\n}\n\nexport interface IDraggedCompositeData {\n\treadonly eventData: DragEvent;\n\treadonly dragAndDropData: CompositeDragAndDropData;\n}\n\nexport class DraggedCompositeIdentifier {\n\n\tconstructor(private compositeId: string) { }\n\n\tget id(): string {\n\t\treturn this.compositeId;\n\t}\n}\n\nexport class DraggedViewIdentifier {\n\n\tconstructor(private viewId: string) { }\n\n\tget id(): string {\n\t\treturn this.viewId;\n\t}\n}\n\nexport type ViewType = 'composite' | 'view';\n\nexport class CompositeDragAndDropObserver extends Disposable {\n\n\tprivate static instance: CompositeDragAndDropObserver | undefined;\n\n\tstatic get INSTANCE(): CompositeDragAndDropObserver {\n\t\tif (!CompositeDragAndDropObserver.instance) {\n\t\t\tCompositeDragAndDropObserver.instance = new CompositeDragAndDropObserver();\n\t\t\tmarkAsSingleton(CompositeDragAndDropObserver.instance);\n\t\t}\n\n\t\treturn CompositeDragAndDropObserver.instance;\n\t}\n\n\tprivate readonly transferData = LocalSelectionTransfer.getInstance<DraggedCompositeIdentifier | DraggedViewIdentifier>();\n\n\tprivate readonly onDragStart = this._register(new Emitter<IDraggedCompositeData>());\n\tprivate readonly onDragEnd = this._register(new Emitter<IDraggedCompositeData>());\n\n\tprivate constructor() {\n\t\tsuper();\n\n\t\tthis._register(this.onDragEnd.event(e => {\n\t\t\tconst id = e.dragAndDropData.getData().id;\n\t\t\tconst type = e.dragAndDropData.getData().type;\n\t\t\tconst data = this.readDragData(type);\n\t\t\tif (data?.getData().id === id) {\n\t\t\t\tthis.transferData.clearData(type === 'view' ? DraggedViewIdentifier.prototype : DraggedCompositeIdentifier.prototype);\n\t\t\t}\n\t\t}));\n\t}\n\n\tprivate readDragData(type: ViewType): CompositeDragAndDropData | undefined {\n\t\tif (this.transferData.hasData(type === 'view' ? DraggedViewIdentifier.prototype : DraggedCompositeIdentifier.prototype)) {\n\t\t\tconst data = this.transferData.getData(type === 'view' ? DraggedViewIdentifier.prototype : DraggedCompositeIdentifier.prototype);\n\t\t\tif (data?.[0]) {\n\t\t\t\treturn new CompositeDragAndDropData(type, data[0].id);\n\t\t\t}\n\t\t}\n\n\t\treturn undefined;\n\t}\n\n\tprivate writeDragData(id: string, type: ViewType): void {\n\t\tthis.transferData.setData([type === 'view' ? new DraggedViewIdentifier(id) : new DraggedCompositeIdentifier(id)], type === 'view' ? DraggedViewIdentifier.prototype : DraggedCompositeIdentifier.prototype);\n\t}\n\n\tregisterTarget(element: HTMLElement, callbacks: ICompositeDragAndDropObserverCallbacks): IDisposable {\n\t\tconst disposableStore = new DisposableStore();\n\t\tdisposableStore.add(new DragAndDropObserver(element, {\n\t\t\tonDragEnter: e => {\n\t\t\t\te.preventDefault();\n\n\t\t\t\tif (callbacks.onDragEnter) {\n\t\t\t\t\tconst data = this.readDragData('composite') || this.readDragData('view');\n\t\t\t\t\tif (data) {\n\t\t\t\t\t\tcallbacks.onDragEnter({ eventData: e, dragAndDropData: data });\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t\tonDragLeave: e => {\n\t\t\t\tconst data = this.readDragData('composite') || this.readDragData('view');\n\t\t\t\tif (callbacks.onDragLeave && data) {\n\t\t\t\t\tcallbacks.onDragLeave({ eventData: e, dragAndDropData: data });\n\t\t\t\t}\n\t\t\t},\n\t\t\tonDrop: e => {\n\t\t\t\tif (callbacks.onDrop) {\n\t\t\t\t\tconst data = this.readDragData('composite') || this.readDragData('view');\n\t\t\t\t\tif (!data) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tcallbacks.onDrop({ eventData: e, dragAndDropData: data });\n\n\t\t\t\t\t// Fire drag event in case drop handler destroys the dragged element\n\t\t\t\t\tthis.onDragEnd.fire({ eventData: e, dragAndDropData: data });\n\t\t\t\t}\n\t\t\t},\n\t\t\tonDragOver: e => {\n\t\t\t\te.preventDefault();\n\n\t\t\t\tif (callbacks.onDragOver) {\n\t\t\t\t\tconst data = this.readDragData('composite') || this.readDragData('view');\n\t\t\t\t\tif (!data) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tcallbacks.onDragOver({ eventData: e, dragAndDropData: data });\n\t\t\t\t}\n\t\t\t}\n\t\t}));\n\n\t\tif (callbacks.onDragStart) {\n\t\t\tthis.onDragStart.event(e => {\n\t\t\t\tcallbacks.onDragStart!(e);\n\t\t\t}, this, disposableStore);\n\t\t}\n\n\t\tif (callbacks.onDragEnd) {\n\t\t\tthis.onDragEnd.event(e => {\n\t\t\t\tcallbacks.onDragEnd!(e);\n\t\t\t}, this, disposableStore);\n\t\t}\n\n\t\treturn this._register(disposableStore);\n\t}\n\n\tregisterDraggable(element: HTMLElement, draggedItemProvider: () => { type: ViewType; id: string }, callbacks: ICompositeDragAndDropObserverCallbacks): IDisposable {\n\t\telement.draggable = true;\n\n\t\tconst disposableStore = new DisposableStore();\n\n\t\tdisposableStore.add(new DragAndDropObserver(element, {\n\t\t\tonDragStart: e => {\n\t\t\t\tconst { id, type } = draggedItemProvider();\n\t\t\t\tthis.writeDragData(id, type);\n\n\t\t\t\te.dataTransfer?.setDragImage(element, 0, 0);\n\n\t\t\t\tthis.onDragStart.fire({ eventData: e, dragAndDropData: this.readDragData(type)! });\n\t\t\t},\n\t\t\tonDragEnd: e => {\n\t\t\t\tconst { type } = draggedItemProvider();\n\t\t\t\tconst data = this.readDragData(type);\n\t\t\t\tif (!data) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tthis.onDragEnd.fire({ eventData: e, dragAndDropData: data });\n\t\t\t},\n\t\t\tonDragEnter: e => {\n\t\t\t\tif (callbacks.onDragEnter) {\n\t\t\t\t\tconst data = this.readDragData('composite') || this.readDragData('view');\n\t\t\t\t\tif (!data) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (data) {\n\t\t\t\t\t\tcallbacks.onDragEnter({ eventData: e, dragAndDropData: data });\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t\tonDragLeave: e => {\n\t\t\t\tconst data = this.readDragData('composite') || this.readDragData('view');\n\t\t\t\tif (!data) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tcallbacks.onDragLeave?.({ eventData: e, dragAndDropData: data });\n\t\t\t},\n\t\t\tonDrop: e => {\n\t\t\t\tif (callbacks.onDrop) {\n\t\t\t\t\tconst data = this.readDragData('composite') || this.readDragData('view');\n\t\t\t\t\tif (!data) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tcallbacks.onDrop({ eventData: e, dragAndDropData: data });\n\n\t\t\t\t\t// Fire drag event in case drop handler destroys the dragged element\n\t\t\t\t\tthis.onDragEnd.fire({ eventData: e, dragAndDropData: data });\n\t\t\t\t}\n\t\t\t},\n\t\t\tonDragOver: e => {\n\t\t\t\tif (callbacks.onDragOver) {\n\t\t\t\t\tconst data = this.readDragData('composite') || this.readDragData('view');\n\t\t\t\t\tif (!data) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tcallbacks.onDragOver({ eventData: e, dragAndDropData: data });\n\t\t\t\t}\n\t\t\t}\n\t\t}));\n\n\t\tif (callbacks.onDragStart) {\n\t\t\tthis.onDragStart.event(e => {\n\t\t\t\tcallbacks.onDragStart!(e);\n\t\t\t}, this, disposableStore);\n\t\t}\n\n\t\tif (callbacks.onDragEnd) {\n\t\t\tthis.onDragEnd.event(e => {\n\t\t\t\tcallbacks.onDragEnd!(e);\n\t\t\t}, this, disposableStore);\n\t\t}\n\n\t\treturn this._register(disposableStore);\n\t}\n}\n\nexport function toggleDropEffect(dataTransfer: DataTransfer | null, dropEffect: 'none' | 'copy' | 'link' | 'move', shouldHaveIt: boolean) {\n\tif (!dataTransfer) {\n\t\treturn;\n\t}\n\n\tdataTransfer.dropEffect = shouldHaveIt ? dropEffect : 'none';\n}\n\nexport class ResourceListDnDHandler<T> implements IListDragAndDrop<T> {\n\tconstructor(\n\t\tprivate readonly toResource: (e: T) => URI | null,\n\t\t@IInstantiationService private readonly instantiationService: IInstantiationService\n\t) { }\n\n\tgetDragURI(element: T): string | null {\n\t\tconst resource = this.toResource(element);\n\t\treturn resource ? resource.toString() : null;\n\t}\n\n\tgetDragLabel(elements: T[]): string | undefined {\n\t\tconst resources = coalesce(elements.map(this.toResource));\n\t\treturn resources.length === 1 ? basename(resources[0]) : resources.length > 1 ? String(resources.length) : undefined;\n\t}\n\n\tonDragStart(data: IDragAndDropData, originalEvent: DragEvent): void {\n\t\tconst resources: URI[] = [];\n\t\tconst elements = (data as ElementsDragAndDropData<T>).elements;\n\t\tfor (const element of elements) {\n\t\t\tconst resource = this.toResource(element);\n\t\t\tif (resource) {\n\t\t\t\tresources.push(resource);\n\t\t\t}\n\t\t}\n\t\tthis.onWillDragElements(elements, originalEvent);\n\t\tif (resources.length) {\n\t\t\t// Apply some datatransfer types to allow for dragging the element outside of the application\n\t\t\tthis.instantiationService.invokeFunction(accessor => fillEditorsDragData(accessor, resources, originalEvent));\n\t\t}\n\t}\n\n\tprotected onWillDragElements(elements: readonly T[], originalEvent: DragEvent): void {\n\t\t// noop\n\t}\n\n\tonDragOver(data: IDragAndDropData, targetElement: T, targetIndex: number, targetSector: ListViewTargetSector | undefined, originalEvent: DragEvent): boolean | ITreeDragOverReaction {\n\t\treturn false;\n\t}\n\n\tdrop(data: IDragAndDropData, targetElement: T, targetIndex: number, targetSector: ListViewTargetSector | undefined, originalEvent: DragEvent): void { }\n\n\tdispose(): void { }\n}\n\n//#endregion\n\nclass GlobalWindowDraggedOverTracker extends Disposable {\n\n\tprivate static readonly CHANNEL_NAME = 'monaco-workbench-global-dragged-over';\n\n\tprivate readonly broadcaster = this._register(new BroadcastDataChannel<boolean>(GlobalWindowDraggedOverTracker.CHANNEL_NAME));\n\n\tconstructor() {\n\t\tsuper();\n\n\t\tthis.registerListeners();\n\t}\n\n\tprivate registerListeners(): void {\n\t\tthis._register(Event.runAndSubscribe(onDidRegisterWindow, ({ window, disposables }) => {\n\t\t\tdisposables.add(addDisposableListener(window, EventType.DRAG_OVER, () => this.markDraggedOver(false), true));\n\t\t\tdisposables.add(addDisposableListener(window, EventType.DRAG_LEAVE, () => this.clearDraggedOver(false), true));\n\t\t}, { window: mainWindow, disposables: this._store }));\n\n\t\tthis._register(this.broadcaster.onDidReceiveData(data => {\n\t\t\tif (data === true) {\n\t\t\t\tthis.markDraggedOver(true);\n\t\t\t} else {\n\t\t\t\tthis.clearDraggedOver(true);\n\t\t\t}\n\t\t}));\n\t}\n\n\tprivate draggedOver = false;\n\tget isDraggedOver(): boolean { return this.draggedOver; }\n\n\tprivate markDraggedOver(fromBroadcast: boolean): void {\n\t\tif (this.draggedOver === true) {\n\t\t\treturn; // alrady marked\n\t\t}\n\n\t\tthis.draggedOver = true;\n\n\t\tif (!fromBroadcast) {\n\t\t\tthis.broadcaster.postData(true);\n\t\t}\n\t}\n\n\tprivate clearDraggedOver(fromBroadcast: boolean): void {\n\t\tif (this.draggedOver === false) {\n\t\t\treturn; // alrady cleared\n\t\t}\n\n\t\tthis.draggedOver = false;\n\n\t\tif (!fromBroadcast) {\n\t\t\tthis.broadcaster.postData(false);\n\t\t}\n\t}\n}\n\nconst globalDraggedOverTracker = new GlobalWindowDraggedOverTracker();\n\n/**\n * Returns whether the workbench is currently dragged over in any of\n * the opened windows (main windows and auxiliary windows).\n */\nexport function isWindowDraggedOver(): boolean {\n\treturn globalDraggedOverTracker.isDraggedOver;\n}\n"]}