{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/browser/layout.ts","vs/workbench/browser/layout.ts"],"names":[],"mappings":"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","file":"layout.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Disposable, DisposableMap, DisposableStore, IDisposable, toDisposable } from '../../base/common/lifecycle.js';\nimport { Event, Emitter } from '../../base/common/event.js';\nimport { EventType, addDisposableListener, getClientArea, size, IDimension, isAncestorUsingFlowTo, computeScreenAwareSize, getActiveDocument, getWindows, getActiveWindow, isActiveDocument, getWindow, getWindowId, getActiveElement, Dimension } from '../../base/browser/dom.js';\nimport { onDidChangeFullscreen, isFullscreen, isWCOEnabled } from '../../base/browser/browser.js';\nimport { isWindows, isLinux, isMacintosh, isWeb, isIOS } from '../../base/common/platform.js';\nimport { EditorInputCapabilities, GroupIdentifier, isResourceEditorInput, IUntypedEditorInput, pathsToEditors } from '../common/editor.js';\nimport { SidebarPart } from './parts/sidebar/sidebarPart.js';\nimport { PanelPart } from './parts/panel/panelPart.js';\nimport { Position, Parts, PartOpensMaximizedOptions, IWorkbenchLayoutService, positionFromString, positionToString, partOpensMaximizedFromString, PanelAlignment, ActivityBarPosition, LayoutSettings, MULTI_WINDOW_PARTS, SINGLE_WINDOW_PARTS, ZenModeSettings, EditorTabsMode, EditorActionsLocation, shouldShowCustomTitleBar, isHorizontal, isMultiWindowPart } from '../services/layout/browser/layoutService.js';\nimport { isTemporaryWorkspace, IWorkspaceContextService, WorkbenchState } from '../../platform/workspace/common/workspace.js';\nimport { IStorageService, StorageScope, StorageTarget } from '../../platform/storage/common/storage.js';\nimport { IConfigurationChangeEvent, IConfigurationService, isConfigured } from '../../platform/configuration/common/configuration.js';\nimport { ITitleService } from '../services/title/browser/titleService.js';\nimport { ServicesAccessor } from '../../platform/instantiation/common/instantiation.js';\nimport { StartupKind, ILifecycleService } from '../services/lifecycle/common/lifecycle.js';\nimport { getMenuBarVisibility, IPath, hasNativeTitlebar, hasCustomTitlebar, TitleBarSetting, CustomTitleBarVisibility, useWindowControlsOverlay, DEFAULT_EMPTY_WINDOW_SIZE, DEFAULT_WORKSPACE_WINDOW_SIZE, hasNativeMenu, MenuSettings } from '../../platform/window/common/window.js';\nimport { IHostService } from '../services/host/browser/host.js';\nimport { IBrowserWorkbenchEnvironmentService } from '../services/environment/browser/environmentService.js';\nimport { IEditorService } from '../services/editor/common/editorService.js';\nimport { EditorGroupLayout, GroupOrientation, GroupsOrder, IEditorGroupsService } from '../services/editor/common/editorGroupsService.js';\nimport { SerializableGrid, ISerializableView, ISerializedGrid, Orientation, ISerializedNode, ISerializedLeafNode, Direction, IViewSize, Sizing } from '../../base/browser/ui/grid/grid.js';\nimport { Part } from './part.js';\nimport { IStatusbarService } from '../services/statusbar/browser/statusbar.js';\nimport { IFileService } from '../../platform/files/common/files.js';\nimport { isCodeEditor } from '../../editor/browser/editorBrowser.js';\nimport { coalesce } from '../../base/common/arrays.js';\nimport { assertReturnsDefined } from '../../base/common/types.js';\nimport { INotificationService, NotificationsFilter } from '../../platform/notification/common/notification.js';\nimport { IThemeService } from '../../platform/theme/common/themeService.js';\nimport { WINDOW_ACTIVE_BORDER, WINDOW_INACTIVE_BORDER } from '../common/theme.js';\nimport { LineNumbersType } from '../../editor/common/config/editorOptions.js';\nimport { URI } from '../../base/common/uri.js';\nimport { IViewDescriptorService, ViewContainerLocation } from '../common/views.js';\nimport { DiffEditorInput } from '../common/editor/diffEditorInput.js';\nimport { mark } from '../../base/common/performance.js';\nimport { IExtensionService } from '../services/extensions/common/extensions.js';\nimport { ILogService } from '../../platform/log/common/log.js';\nimport { DeferredPromise, Promises } from '../../base/common/async.js';\nimport { IBannerService } from '../services/banner/browser/bannerService.js';\nimport { IPaneCompositePartService } from '../services/panecomposite/browser/panecomposite.js';\nimport { AuxiliaryBarPart } from './parts/auxiliarybar/auxiliaryBarPart.js';\nimport { ITelemetryService } from '../../platform/telemetry/common/telemetry.js';\nimport { IAuxiliaryWindowService } from '../services/auxiliaryWindow/browser/auxiliaryWindowService.js';\nimport { CodeWindow, mainWindow } from '../../base/browser/window.js';\n\n//#region Layout Implementation\n\ninterface ILayoutRuntimeState {\n\tactiveContainerId: number;\n\tmainWindowFullscreen: boolean;\n\treadonly maximized: Set<number>;\n\thasFocus: boolean;\n\tmainWindowBorder: boolean;\n\treadonly menuBar: {\n\t\ttoggled: boolean;\n\t};\n\treadonly zenMode: {\n\t\treadonly transitionDisposables: DisposableMap<string, IDisposable>;\n\t};\n}\n\ninterface IEditorToOpen {\n\treadonly editor: IUntypedEditorInput;\n\treadonly viewColumn?: number;\n}\n\ninterface ILayoutInitializationState {\n\treadonly views: {\n\t\treadonly defaults: string[] | undefined;\n\t\treadonly containerToRestore: {\n\t\t\tsideBar?: string;\n\t\t\tpanel?: string;\n\t\t\tauxiliaryBar?: string;\n\t\t};\n\t};\n\treadonly editor: {\n\t\treadonly restoreEditors: boolean;\n\t\treadonly editorsToOpen: Promise<IEditorToOpen[]>;\n\t};\n\treadonly layout?: {\n\t\treadonly editors?: EditorGroupLayout;\n\t};\n}\n\ninterface ILayoutState {\n\treadonly runtime: ILayoutRuntimeState;\n\treadonly initialization: ILayoutInitializationState;\n}\n\nenum LayoutClasses {\n\tSIDEBAR_HIDDEN = 'nosidebar',\n\tMAIN_EDITOR_AREA_HIDDEN = 'nomaineditorarea',\n\tPANEL_HIDDEN = 'nopanel',\n\tAUXILIARYBAR_HIDDEN = 'noauxiliarybar',\n\tSTATUSBAR_HIDDEN = 'nostatusbar',\n\tFULLSCREEN = 'fullscreen',\n\tMAXIMIZED = 'maximized',\n\tWINDOW_BORDER = 'border'\n}\n\ninterface IPathToOpen extends IPath {\n\treadonly viewColumn?: number;\n}\n\ninterface IInitialEditorsState {\n\treadonly filesToOpenOrCreate?: IPathToOpen[];\n\treadonly filesToDiff?: IPathToOpen[];\n\treadonly filesToMerge?: IPathToOpen[];\n\n\treadonly layout?: EditorGroupLayout;\n}\n\nconst COMMAND_CENTER_SETTINGS = [\n\t'chat.commandCenter.enabled',\n\t'workbench.navigationControl.enabled',\n\t'workbench.experimental.share.enabled',\n];\n\nexport const TITLE_BAR_SETTINGS = [\n\tLayoutSettings.ACTIVITY_BAR_LOCATION,\n\tLayoutSettings.COMMAND_CENTER,\n\t...COMMAND_CENTER_SETTINGS,\n\tLayoutSettings.EDITOR_ACTIONS_LOCATION,\n\tLayoutSettings.LAYOUT_ACTIONS,\n\tMenuSettings.MenuBarVisibility,\n\tTitleBarSetting.TITLE_BAR_STYLE,\n\tTitleBarSetting.CUSTOM_TITLE_BAR_VISIBILITY,\n];\n\nconst DEFAULT_EMPTY_WINDOW_DIMENSIONS = new Dimension(DEFAULT_EMPTY_WINDOW_SIZE.width, DEFAULT_EMPTY_WINDOW_SIZE.height);\nconst DEFAULT_WORKSPACE_WINDOW_DIMENSIONS = new Dimension(DEFAULT_WORKSPACE_WINDOW_SIZE.width, DEFAULT_WORKSPACE_WINDOW_SIZE.height);\n\nexport abstract class Layout extends Disposable implements IWorkbenchLayoutService {\n\n\tdeclare readonly _serviceBrand: undefined;\n\n\t//#region Events\n\n\tprivate readonly _onDidChangeZenMode = this._register(new Emitter<boolean>());\n\treadonly onDidChangeZenMode = this._onDidChangeZenMode.event;\n\n\tprivate readonly _onDidChangeMainEditorCenteredLayout = this._register(new Emitter<boolean>());\n\treadonly onDidChangeMainEditorCenteredLayout = this._onDidChangeMainEditorCenteredLayout.event;\n\n\tprivate readonly _onDidChangePanelAlignment = this._register(new Emitter<PanelAlignment>());\n\treadonly onDidChangePanelAlignment = this._onDidChangePanelAlignment.event;\n\n\tprivate readonly _onDidChangeWindowMaximized = this._register(new Emitter<{ windowId: number; maximized: boolean }>());\n\treadonly onDidChangeWindowMaximized = this._onDidChangeWindowMaximized.event;\n\n\tprivate readonly _onDidChangePanelPosition = this._register(new Emitter<string>());\n\treadonly onDidChangePanelPosition = this._onDidChangePanelPosition.event;\n\n\tprivate readonly _onDidChangePartVisibility = this._register(new Emitter<void>());\n\treadonly onDidChangePartVisibility = this._onDidChangePartVisibility.event;\n\n\tprivate readonly _onDidChangeNotificationsVisibility = this._register(new Emitter<boolean>());\n\treadonly onDidChangeNotificationsVisibility = this._onDidChangeNotificationsVisibility.event;\n\n\tprivate readonly _onDidChangeAuxiliaryBarMaximized = this._register(new Emitter<void>());\n\treadonly onDidChangeAuxiliaryBarMaximized = this._onDidChangeAuxiliaryBarMaximized.event;\n\n\tprivate readonly _onDidLayoutMainContainer = this._register(new Emitter<IDimension>());\n\treadonly onDidLayoutMainContainer = this._onDidLayoutMainContainer.event;\n\n\tprivate readonly _onDidLayoutActiveContainer = this._register(new Emitter<IDimension>());\n\treadonly onDidLayoutActiveContainer = this._onDidLayoutActiveContainer.event;\n\n\tprivate readonly _onDidLayoutContainer = this._register(new Emitter<{ container: HTMLElement; dimension: IDimension }>());\n\treadonly onDidLayoutContainer = this._onDidLayoutContainer.event;\n\n\tprivate readonly _onDidAddContainer = this._register(new Emitter<{ container: HTMLElement; disposables: DisposableStore }>());\n\treadonly onDidAddContainer = this._onDidAddContainer.event;\n\n\tprivate readonly _onDidChangeActiveContainer = this._register(new Emitter<void>());\n\treadonly onDidChangeActiveContainer = this._onDidChangeActiveContainer.event;\n\n\t//#endregion\n\n\t//#region Properties\n\n\treadonly mainContainer = document.createElement('div');\n\tget activeContainer() { return this.getContainerFromDocument(getActiveDocument()); }\n\tget containers(): Iterable<HTMLElement> {\n\t\tconst containers: HTMLElement[] = [];\n\t\tfor (const { window } of getWindows()) {\n\t\t\tcontainers.push(this.getContainerFromDocument(window.document));\n\t\t}\n\n\t\treturn containers;\n\t}\n\n\tprivate getContainerFromDocument(targetDocument: Document): HTMLElement {\n\t\tif (targetDocument === this.mainContainer.ownerDocument) {\n\t\t\treturn this.mainContainer; // main window\n\t\t} else {\n\t\t\t// eslint-disable-next-line no-restricted-syntax\n\t\t\treturn targetDocument.body.getElementsByClassName('monaco-workbench')[0] as HTMLElement; // auxiliary window\n\t\t}\n\t}\n\n\tprivate readonly containerStylesLoaded = new Map<number /* window ID */, Promise<void>>();\n\twhenContainerStylesLoaded(window: CodeWindow): Promise<void> | undefined {\n\t\treturn this.containerStylesLoaded.get(window.vscodeWindowId);\n\t}\n\n\tprivate _mainContainerDimension!: IDimension;\n\tget mainContainerDimension(): IDimension { return this._mainContainerDimension; }\n\n\tget activeContainerDimension(): IDimension {\n\t\treturn this.getContainerDimension(this.activeContainer);\n\t}\n\n\tprivate getContainerDimension(container: HTMLElement): IDimension {\n\t\tif (container === this.mainContainer) {\n\t\t\treturn this.mainContainerDimension; // main window\n\t\t} else {\n\t\t\treturn getClientArea(container); \t// auxiliary window\n\t\t}\n\t}\n\n\tget mainContainerOffset() {\n\t\treturn this.computeContainerOffset(mainWindow);\n\t}\n\n\tget activeContainerOffset() {\n\t\treturn this.computeContainerOffset(getWindow(this.activeContainer));\n\t}\n\n\tprivate computeContainerOffset(targetWindow: Window) {\n\t\tlet top = 0;\n\t\tlet quickPickTop = 0;\n\n\t\tif (this.isVisible(Parts.BANNER_PART)) {\n\t\t\ttop = this.getPart(Parts.BANNER_PART).maximumHeight;\n\t\t\tquickPickTop = top;\n\t\t}\n\n\t\tconst titlebarVisible = this.isVisible(Parts.TITLEBAR_PART, targetWindow);\n\t\tif (titlebarVisible) {\n\t\t\ttop += this.getPart(Parts.TITLEBAR_PART).maximumHeight;\n\t\t\tquickPickTop = top;\n\t\t}\n\n\t\tconst isCommandCenterVisible = titlebarVisible && this.configurationService.getValue<boolean>(LayoutSettings.COMMAND_CENTER) !== false;\n\t\tif (isCommandCenterVisible) {\n\t\t\t// If the command center is visible then the quickinput\n\t\t\t// should go over the title bar and the banner\n\t\t\tquickPickTop = 6;\n\t\t}\n\n\t\treturn { top, quickPickTop };\n\t}\n\n\t//#endregion\n\n\tprivate readonly parts = new Map<string, Part>();\n\n\tprivate initialized = false;\n\tprivate workbenchGrid!: SerializableGrid<ISerializableView>;\n\n\tprivate titleBarPartView!: ISerializableView;\n\tprivate bannerPartView!: ISerializableView;\n\tprivate activityBarPartView!: ISerializableView;\n\tprivate sideBarPartView!: ISerializableView;\n\tprivate panelPartView!: ISerializableView;\n\tprivate auxiliaryBarPartView!: ISerializableView;\n\tprivate editorPartView!: ISerializableView;\n\tprivate statusBarPartView!: ISerializableView;\n\n\tprivate environmentService!: IBrowserWorkbenchEnvironmentService;\n\tprivate extensionService!: IExtensionService;\n\tprivate configurationService!: IConfigurationService;\n\tprivate storageService!: IStorageService;\n\tprivate hostService!: IHostService;\n\tprivate editorService!: IEditorService;\n\tprivate mainPartEditorService!: IEditorService;\n\tprivate editorGroupService!: IEditorGroupsService;\n\tprivate paneCompositeService!: IPaneCompositePartService;\n\tprivate titleService!: ITitleService;\n\tprivate viewDescriptorService!: IViewDescriptorService;\n\tprivate contextService!: IWorkspaceContextService;\n\tprivate notificationService!: INotificationService;\n\tprivate themeService!: IThemeService;\n\tprivate statusBarService!: IStatusbarService;\n\tprivate logService!: ILogService;\n\tprivate telemetryService!: ITelemetryService;\n\tprivate auxiliaryWindowService!: IAuxiliaryWindowService;\n\n\tprivate state!: ILayoutState;\n\tprivate stateModel!: LayoutStateModel;\n\n\tprivate disposed = false;\n\n\tconstructor(\n\t\tprotected readonly parent: HTMLElement,\n\t\tprivate readonly layoutOptions?: { resetLayout: boolean }\n\t) {\n\t\tsuper();\n\t}\n\n\tprotected initLayout(accessor: ServicesAccessor): void {\n\n\t\t// Services\n\t\tthis.environmentService = accessor.get(IBrowserWorkbenchEnvironmentService);\n\t\tthis.configurationService = accessor.get(IConfigurationService);\n\t\tthis.hostService = accessor.get(IHostService);\n\t\tthis.contextService = accessor.get(IWorkspaceContextService);\n\t\tthis.storageService = accessor.get(IStorageService);\n\t\tthis.themeService = accessor.get(IThemeService);\n\t\tthis.extensionService = accessor.get(IExtensionService);\n\t\tthis.logService = accessor.get(ILogService);\n\t\tthis.telemetryService = accessor.get(ITelemetryService);\n\t\tthis.auxiliaryWindowService = accessor.get(IAuxiliaryWindowService);\n\n\t\t// Parts\n\t\tthis.editorService = accessor.get(IEditorService);\n\t\tthis.editorGroupService = accessor.get(IEditorGroupsService);\n\t\tthis.mainPartEditorService = this.editorService.createScoped(this.editorGroupService.mainPart, this._store);\n\t\tthis.paneCompositeService = accessor.get(IPaneCompositePartService);\n\t\tthis.viewDescriptorService = accessor.get(IViewDescriptorService);\n\t\tthis.titleService = accessor.get(ITitleService);\n\t\tthis.notificationService = accessor.get(INotificationService);\n\t\tthis.statusBarService = accessor.get(IStatusbarService);\n\t\taccessor.get(IBannerService);\n\n\t\t// Listeners\n\t\tthis.registerLayoutListeners();\n\n\t\t// State\n\t\tthis.initLayoutState(accessor.get(ILifecycleService), accessor.get(IFileService));\n\t}\n\n\tprivate registerLayoutListeners(): void {\n\n\t\t// Restore editor if hidden and an editor is to show\n\t\tconst showEditorIfHidden = () => {\n\t\t\tif (!this.isVisible(Parts.EDITOR_PART, mainWindow)) {\n\t\t\t\tif (this.isAuxiliaryBarMaximized()) {\n\t\t\t\t\tthis.toggleMaximizedAuxiliaryBar();\n\t\t\t\t} else {\n\t\t\t\t\tthis.toggleMaximizedPanel();\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\t// Wait to register these listeners after the editor group service\n\t\t// is ready to avoid conflicts on startup\n\t\tthis.editorGroupService.whenRestored.then(() => {\n\n\t\t\t// Restore main editor part on any editor change in main part\n\t\t\tthis._register(this.mainPartEditorService.onDidVisibleEditorsChange(showEditorIfHidden));\n\t\t\tthis._register(this.editorGroupService.mainPart.onDidActivateGroup(showEditorIfHidden));\n\n\t\t\t// Revalidate center layout when active editor changes: diff editor quits centered mode.\n\t\t\tthis._register(this.mainPartEditorService.onDidActiveEditorChange(() => this.centerMainEditorLayout(this.stateModel.getRuntimeValue(LayoutStateKeys.MAIN_EDITOR_CENTERED))));\n\t\t});\n\n\t\t// Configuration changes\n\t\tthis._register(this.configurationService.onDidChangeConfiguration(e => {\n\t\t\tif ([\n\t\t\t\t...TITLE_BAR_SETTINGS,\n\t\t\t\tLegacyWorkbenchLayoutSettings.SIDEBAR_POSITION,\n\t\t\t\tLegacyWorkbenchLayoutSettings.STATUSBAR_VISIBLE,\n\t\t\t].some(setting => e.affectsConfiguration(setting))) {\n\n\t\t\t\t// Show Command Center if command center actions enabled\n\t\t\t\tconst shareEnabled = e.affectsConfiguration('workbench.experimental.share.enabled') && this.configurationService.getValue<boolean>('workbench.experimental.share.enabled');\n\t\t\t\tconst navigationControlEnabled = e.affectsConfiguration('workbench.navigationControl.enabled') && this.configurationService.getValue<boolean>('workbench.navigationControl.enabled');\n\n\t\t\t\t// Currently not supported for \"chat.commandCenter.enabled\" as we\n\t\t\t\t// programatically set this during setup and could lead to unwanted titlebar appearing\n\t\t\t\t// const chatControlsEnabled = e.affectsConfiguration('chat.commandCenter.enabled') && this.configurationService.getValue<boolean>('chat.commandCenter.enabled');\n\n\t\t\t\tif (shareEnabled || navigationControlEnabled) {\n\t\t\t\t\tif (this.configurationService.getValue<boolean>(LayoutSettings.COMMAND_CENTER) === false) {\n\t\t\t\t\t\tthis.configurationService.updateValue(LayoutSettings.COMMAND_CENTER, true);\n\t\t\t\t\t\treturn; // onDidChangeConfiguration will be triggered again\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Show Custom TitleBar if actions enabled in (or moved to) the titlebar\n\t\t\t\tconst editorActionsMovedToTitlebar = e.affectsConfiguration(LayoutSettings.EDITOR_ACTIONS_LOCATION) && this.configurationService.getValue<EditorActionsLocation>(LayoutSettings.EDITOR_ACTIONS_LOCATION) === EditorActionsLocation.TITLEBAR;\n\t\t\t\tconst commandCenterEnabled = e.affectsConfiguration(LayoutSettings.COMMAND_CENTER) && this.configurationService.getValue<boolean>(LayoutSettings.COMMAND_CENTER);\n\t\t\t\tconst layoutControlsEnabled = e.affectsConfiguration(LayoutSettings.LAYOUT_ACTIONS) && this.configurationService.getValue<boolean>(LayoutSettings.LAYOUT_ACTIONS);\n\t\t\t\tconst activityBarMovedToTopOrBottom = e.affectsConfiguration(LayoutSettings.ACTIVITY_BAR_LOCATION) && [ActivityBarPosition.TOP, ActivityBarPosition.BOTTOM].includes(this.configurationService.getValue<ActivityBarPosition>(LayoutSettings.ACTIVITY_BAR_LOCATION));\n\n\t\t\t\tif (activityBarMovedToTopOrBottom || editorActionsMovedToTitlebar || commandCenterEnabled || layoutControlsEnabled) {\n\t\t\t\t\tif (this.configurationService.getValue<CustomTitleBarVisibility>(TitleBarSetting.CUSTOM_TITLE_BAR_VISIBILITY) === CustomTitleBarVisibility.NEVER) {\n\t\t\t\t\t\tthis.configurationService.updateValue(TitleBarSetting.CUSTOM_TITLE_BAR_VISIBILITY, CustomTitleBarVisibility.AUTO);\n\t\t\t\t\t\treturn; // onDidChangeConfiguration will be triggered again\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tthis.doUpdateLayoutConfiguration();\n\t\t\t}\n\t\t}));\n\n\t\t// Fullscreen changes\n\t\tthis._register(onDidChangeFullscreen(windowId => this.onFullscreenChanged(windowId)));\n\n\t\t// Group changes\n\t\tthis._register(this.editorGroupService.mainPart.onDidAddGroup(() => this.centerMainEditorLayout(this.stateModel.getRuntimeValue(LayoutStateKeys.MAIN_EDITOR_CENTERED))));\n\t\tthis._register(this.editorGroupService.mainPart.onDidRemoveGroup(() => this.centerMainEditorLayout(this.stateModel.getRuntimeValue(LayoutStateKeys.MAIN_EDITOR_CENTERED))));\n\t\tthis._register(this.editorGroupService.mainPart.onDidChangeGroupMaximized(() => this.centerMainEditorLayout(this.stateModel.getRuntimeValue(LayoutStateKeys.MAIN_EDITOR_CENTERED))));\n\n\t\t// Prevent workbench from scrolling #55456\n\t\tthis._register(addDisposableListener(this.mainContainer, EventType.SCROLL, () => this.mainContainer.scrollTop = 0));\n\n\t\t// Menubar visibility changes\n\t\tconst showingCustomMenu = (isWindows || isLinux || isWeb) && !hasNativeTitlebar(this.configurationService);\n\t\tif (showingCustomMenu) {\n\t\t\tthis._register(this.titleService.onMenubarVisibilityChange(visible => this.onMenubarToggled(visible)));\n\t\t}\n\n\t\t// Theme changes\n\t\tthis._register(this.themeService.onDidColorThemeChange(() => this.updateWindowBorder()));\n\n\t\t// Window active / focus changes\n\t\tthis._register(this.hostService.onDidChangeFocus(focused => this.onWindowFocusChanged(focused)));\n\t\tthis._register(this.hostService.onDidChangeActiveWindow(() => this.onActiveWindowChanged()));\n\n\t\t// WCO changes\n\t\tif (isWeb && typeof (navigator as { windowControlsOverlay?: EventTarget }).windowControlsOverlay === 'object') {\n\t\t\tthis._register(addDisposableListener((navigator as unknown as { windowControlsOverlay: EventTarget }).windowControlsOverlay, 'geometrychange', () => this.onDidChangeWCO()));\n\t\t}\n\n\t\t// Auxiliary windows\n\t\tthis._register(this.auxiliaryWindowService.onDidOpenAuxiliaryWindow(({ window, disposables }) => {\n\t\t\tconst windowId = window.window.vscodeWindowId;\n\t\t\tthis.containerStylesLoaded.set(windowId, window.whenStylesHaveLoaded);\n\t\t\twindow.whenStylesHaveLoaded.then(() => this.containerStylesLoaded.delete(windowId));\n\t\t\tdisposables.add(toDisposable(() => this.containerStylesLoaded.delete(windowId)));\n\n\t\t\tconst eventDisposables = disposables.add(new DisposableStore());\n\t\t\tthis._onDidAddContainer.fire({ container: window.container, disposables: eventDisposables });\n\n\t\t\tdisposables.add(window.onDidLayout(dimension => this.handleContainerDidLayout(window.container, dimension)));\n\t\t}));\n\t}\n\n\tprivate onMenubarToggled(visible: boolean): void {\n\t\tif (visible !== this.state.runtime.menuBar.toggled) {\n\t\t\tthis.state.runtime.menuBar.toggled = visible;\n\n\t\t\tconst menuBarVisibility = getMenuBarVisibility(this.configurationService);\n\n\t\t\t// The menu bar toggles the title bar in web because it does not need to be shown for window controls only\n\t\t\tif (isWeb && menuBarVisibility === 'toggle') {\n\t\t\t\tthis.workbenchGrid.setViewVisible(this.titleBarPartView, shouldShowCustomTitleBar(this.configurationService, mainWindow, this.state.runtime.menuBar.toggled));\n\t\t\t}\n\n\t\t\t// The menu bar toggles the title bar in full screen for toggle and classic settings\n\t\t\telse if (this.state.runtime.mainWindowFullscreen && (menuBarVisibility === 'toggle' || menuBarVisibility === 'classic')) {\n\t\t\t\tthis.workbenchGrid.setViewVisible(this.titleBarPartView, shouldShowCustomTitleBar(this.configurationService, mainWindow, this.state.runtime.menuBar.toggled));\n\t\t\t}\n\n\t\t\t// Move layout call to any time the menubar\n\t\t\t// is toggled to update consumers of offset\n\t\t\t// see issue #115267\n\t\t\tthis.handleContainerDidLayout(this.mainContainer, this._mainContainerDimension);\n\t\t}\n\t}\n\n\tprivate handleContainerDidLayout(container: HTMLElement, dimension: IDimension): void {\n\t\tif (container === this.mainContainer) {\n\t\t\tthis._onDidLayoutMainContainer.fire(dimension);\n\t\t}\n\n\t\tif (isActiveDocument(container)) {\n\t\t\tthis._onDidLayoutActiveContainer.fire(dimension);\n\t\t}\n\n\t\tthis._onDidLayoutContainer.fire({ container, dimension });\n\t}\n\n\tprivate onFullscreenChanged(windowId: number): void {\n\t\tif (windowId !== mainWindow.vscodeWindowId) {\n\t\t\treturn; // ignore all but main window\n\t\t}\n\n\t\tthis.state.runtime.mainWindowFullscreen = isFullscreen(mainWindow);\n\n\t\t// Apply as CSS class\n\t\tif (this.state.runtime.mainWindowFullscreen) {\n\t\t\tthis.mainContainer.classList.add(LayoutClasses.FULLSCREEN);\n\t\t} else {\n\t\t\tthis.mainContainer.classList.remove(LayoutClasses.FULLSCREEN);\n\n\t\t\tconst zenModeExitInfo = this.stateModel.getRuntimeValue(LayoutStateKeys.ZEN_MODE_EXIT_INFO);\n\t\t\tif (zenModeExitInfo.transitionedToFullScreen && this.isZenModeActive()) {\n\t\t\t\tthis.toggleZenMode();\n\t\t\t}\n\t\t}\n\n\t\t// Change edge snapping accordingly\n\t\tthis.workbenchGrid.edgeSnapping = this.state.runtime.mainWindowFullscreen;\n\n\t\t// Changing fullscreen state of the main window has an impact\n\t\t// on custom title bar visibility, so we need to update\n\t\tif (hasCustomTitlebar(this.configurationService)) {\n\n\t\t\t// Propagate to grid\n\t\t\tthis.workbenchGrid.setViewVisible(this.titleBarPartView, shouldShowCustomTitleBar(this.configurationService, mainWindow, this.state.runtime.menuBar.toggled));\n\n\t\t\t// Indicate active window border\n\t\t\tthis.updateWindowBorder(true);\n\t\t}\n\t}\n\n\tprivate onActiveWindowChanged(): void {\n\t\tconst activeContainerId = this.getActiveContainerId();\n\t\tif (this.state.runtime.activeContainerId !== activeContainerId) {\n\t\t\tthis.state.runtime.activeContainerId = activeContainerId;\n\n\t\t\t// Indicate active window border\n\t\t\tthis.updateWindowBorder();\n\n\t\t\tthis._onDidChangeActiveContainer.fire();\n\t\t}\n\t}\n\n\tprivate onWindowFocusChanged(hasFocus: boolean): void {\n\t\tif (this.state.runtime.hasFocus !== hasFocus) {\n\t\t\tthis.state.runtime.hasFocus = hasFocus;\n\n\t\t\t// Indicate active window border\n\t\t\tthis.updateWindowBorder();\n\t\t}\n\t}\n\n\tprivate getActiveContainerId(): number {\n\t\tconst activeContainer = this.activeContainer;\n\n\t\treturn getWindow(activeContainer).vscodeWindowId;\n\t}\n\n\tprivate doUpdateLayoutConfiguration(skipLayout?: boolean): void {\n\n\t\t// Custom Titlebar visibility with native titlebar\n\t\tthis.updateCustomTitleBarVisibility();\n\n\t\t// Menubar visibility\n\t\tthis.updateMenubarVisibility(!!skipLayout);\n\n\t\t// Centered Layout\n\t\tthis.editorGroupService.whenRestored.then(() => this.centerMainEditorLayout(this.stateModel.getRuntimeValue(LayoutStateKeys.MAIN_EDITOR_CENTERED), skipLayout));\n\t}\n\n\tprivate setSideBarPosition(position: Position): void {\n\t\tconst activityBar = this.getPart(Parts.ACTIVITYBAR_PART);\n\t\tconst sideBar = this.getPart(Parts.SIDEBAR_PART);\n\t\tconst auxiliaryBar = this.getPart(Parts.AUXILIARYBAR_PART);\n\t\tconst newPositionValue = (position === Position.LEFT) ? 'left' : 'right';\n\t\tconst oldPositionValue = (position === Position.RIGHT) ? 'left' : 'right';\n\t\tconst panelAlignment = this.getPanelAlignment();\n\t\tconst panelPosition = this.getPanelPosition();\n\n\t\tthis.stateModel.setRuntimeValue(LayoutStateKeys.SIDEBAR_POSITON, position);\n\n\t\t// Adjust CSS\n\t\tconst activityBarContainer = assertReturnsDefined(activityBar.getContainer());\n\t\tconst sideBarContainer = assertReturnsDefined(sideBar.getContainer());\n\t\tconst auxiliaryBarContainer = assertReturnsDefined(auxiliaryBar.getContainer());\n\t\tactivityBarContainer.classList.remove(oldPositionValue);\n\t\tsideBarContainer.classList.remove(oldPositionValue);\n\t\tactivityBarContainer.classList.add(newPositionValue);\n\t\tsideBarContainer.classList.add(newPositionValue);\n\n\t\t// Auxiliary Bar has opposite values\n\t\tauxiliaryBarContainer.classList.remove(newPositionValue);\n\t\tauxiliaryBarContainer.classList.add(oldPositionValue);\n\n\t\t// Update Styles\n\t\tactivityBar.updateStyles();\n\t\tsideBar.updateStyles();\n\t\tauxiliaryBar.updateStyles();\n\n\t\t// Move activity bar and side bars\n\t\tthis.adjustPartPositions(position, panelAlignment, panelPosition);\n\t}\n\n\tprivate updateWindowBorder(skipLayout = false) {\n\t\tif (\n\t\t\tisWeb ||\n\t\t\tisWindows || \t\t\t\t\t\t\t\t\t\t\t// not working well with zooming (border often not visible)\n\t\t\t(\n\t\t\t\t(isWindows || isLinux) &&\n\t\t\t\tuseWindowControlsOverlay(this.configurationService)\t// Windows/Linux: not working with WCO (border cannot draw over the overlay)\n\t\t\t) ||\n\t\t\thasNativeTitlebar(this.configurationService)\n\t\t) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst theme = this.themeService.getColorTheme();\n\n\t\tconst activeBorder = theme.getColor(WINDOW_ACTIVE_BORDER);\n\t\tconst inactiveBorder = theme.getColor(WINDOW_INACTIVE_BORDER);\n\n\t\tconst didHaveMainWindowBorder = this.hasMainWindowBorder();\n\n\t\tfor (const container of this.containers) {\n\t\t\tconst isMainContainer = container === this.mainContainer;\n\t\t\tconst isActiveContainer = this.activeContainer === container;\n\n\t\t\tlet windowBorder = false;\n\t\t\tif (!this.state.runtime.mainWindowFullscreen && (activeBorder || inactiveBorder)) {\n\t\t\t\twindowBorder = true;\n\n\t\t\t\t// If the inactive color is missing, fallback to the active one\n\t\t\t\tconst borderColor = isActiveContainer && this.state.runtime.hasFocus ? activeBorder : inactiveBorder ?? activeBorder;\n\t\t\t\tcontainer.style.setProperty('--window-border-color', borderColor?.toString() ?? 'transparent');\n\t\t\t}\n\n\t\t\tif (isMainContainer) {\n\t\t\t\tthis.state.runtime.mainWindowBorder = windowBorder;\n\t\t\t}\n\n\t\t\tcontainer.classList.toggle(LayoutClasses.WINDOW_BORDER, windowBorder);\n\t\t}\n\n\t\tif (!skipLayout && didHaveMainWindowBorder !== this.hasMainWindowBorder()) {\n\t\t\tthis.layout();\n\t\t}\n\t}\n\n\tprivate initLayoutState(lifecycleService: ILifecycleService, fileService: IFileService): void {\n\t\tthis._mainContainerDimension = getClientArea(this.parent, this.contextService.getWorkbenchState() === WorkbenchState.EMPTY ? DEFAULT_EMPTY_WINDOW_DIMENSIONS : DEFAULT_WORKSPACE_WINDOW_DIMENSIONS); // running with fallback to ensure no error is thrown (https://github.com/microsoft/vscode/issues/240242)\n\n\t\tthis.stateModel = new LayoutStateModel(this.storageService, this.configurationService, this.contextService, this.environmentService);\n\t\tthis.stateModel.load({\n\t\t\tmainContainerDimension: this._mainContainerDimension,\n\t\t\tresetLayout: Boolean(this.layoutOptions?.resetLayout)\n\t\t});\n\n\t\tthis._register(this.stateModel.onDidChangeState(change => {\n\t\t\tif (change.key === LayoutStateKeys.ACTIVITYBAR_HIDDEN) {\n\t\t\t\tthis.setActivityBarHidden(change.value as boolean);\n\t\t\t}\n\n\t\t\tif (change.key === LayoutStateKeys.STATUSBAR_HIDDEN) {\n\t\t\t\tthis.setStatusBarHidden(change.value as boolean);\n\t\t\t}\n\n\t\t\tif (change.key === LayoutStateKeys.SIDEBAR_POSITON) {\n\t\t\t\tthis.setSideBarPosition(change.value as Position);\n\t\t\t}\n\n\t\t\tif (change.key === LayoutStateKeys.PANEL_POSITION) {\n\t\t\t\tthis.setPanelPosition(change.value as Position);\n\t\t\t}\n\n\t\t\tif (change.key === LayoutStateKeys.PANEL_ALIGNMENT) {\n\t\t\t\tthis.setPanelAlignment(change.value as PanelAlignment);\n\t\t\t}\n\n\t\t\tthis.doUpdateLayoutConfiguration();\n\t\t}));\n\n\t\t// Layout Initialization State\n\t\tconst initialEditorsState = this.getInitialEditorsState();\n\t\tif (initialEditorsState) {\n\t\t\tthis.logService.trace('Initial editor state', initialEditorsState);\n\t\t}\n\t\tconst initialLayoutState: ILayoutInitializationState = {\n\t\t\tlayout: {\n\t\t\t\teditors: initialEditorsState?.layout\n\t\t\t},\n\t\t\teditor: {\n\t\t\t\trestoreEditors: this.shouldRestoreEditors(this.contextService, initialEditorsState),\n\t\t\t\teditorsToOpen: this.resolveEditorsToOpen(fileService, initialEditorsState),\n\t\t\t},\n\t\t\tviews: {\n\t\t\t\tdefaults: this.getDefaultLayoutViews(this.environmentService, this.storageService),\n\t\t\t\tcontainerToRestore: {}\n\t\t\t}\n\t\t};\n\n\t\t// Layout Runtime State\n\t\tconst layoutRuntimeState: ILayoutRuntimeState = {\n\t\t\tactiveContainerId: this.getActiveContainerId(),\n\t\t\tmainWindowFullscreen: isFullscreen(mainWindow),\n\t\t\thasFocus: this.hostService.hasFocus,\n\t\t\tmaximized: new Set<number>(),\n\t\t\tmainWindowBorder: false,\n\t\t\tmenuBar: {\n\t\t\t\ttoggled: false,\n\t\t\t},\n\t\t\tzenMode: {\n\t\t\t\ttransitionDisposables: new DisposableMap(),\n\t\t\t}\n\t\t};\n\n\t\tthis.state = {\n\t\t\tinitialization: initialLayoutState,\n\t\t\truntime: layoutRuntimeState,\n\t\t};\n\n\t\t// Sidebar View Container To Restore\n\t\tif (this.isVisible(Parts.SIDEBAR_PART)) {\n\t\t\tlet viewContainerToRestore = this.storageService.get(SidebarPart.activeViewletSettingsKey, StorageScope.WORKSPACE, this.viewDescriptorService.getDefaultViewContainer(ViewContainerLocation.Sidebar)?.id);\n\t\t\tif (\n\t\t\t\t!this.environmentService.isBuilt ||\n\t\t\t\tlifecycleService.startupKind === StartupKind.ReloadedWindow ||\n\t\t\t\tthis.environmentService.isExtensionDevelopment && !this.environmentService.extensionTestsLocationURI\n\t\t\t) {\n\t\t\t\t// allow to restore a non-default viewlet in development mode or when window reloads\n\t\t\t} else if (\n\t\t\t\tviewContainerToRestore !== this.viewDescriptorService.getDefaultViewContainer(ViewContainerLocation.Sidebar)?.id &&\n\t\t\t\tviewContainerToRestore !== this.viewDescriptorService.getDefaultViewContainer(ViewContainerLocation.AuxiliaryBar)?.id\n\t\t\t) {\n\t\t\t\t// fallback to default viewlet otherwise if the viewlet is not a default viewlet\n\t\t\t\tviewContainerToRestore = this.viewDescriptorService.getDefaultViewContainer(ViewContainerLocation.Sidebar)?.id;\n\t\t\t}\n\n\t\t\tif (viewContainerToRestore) {\n\t\t\t\tthis.state.initialization.views.containerToRestore.sideBar = viewContainerToRestore;\n\t\t\t} else {\n\t\t\t\tthis.stateModel.setRuntimeValue(LayoutStateKeys.SIDEBAR_HIDDEN, true);\n\t\t\t}\n\t\t}\n\n\t\t// Panel View Container To Restore\n\t\tif (this.isVisible(Parts.PANEL_PART)) {\n\t\t\tconst viewContainerToRestore = this.storageService.get(PanelPart.activePanelSettingsKey, StorageScope.WORKSPACE, this.viewDescriptorService.getDefaultViewContainer(ViewContainerLocation.Panel)?.id);\n\n\t\t\tif (viewContainerToRestore) {\n\t\t\t\tthis.state.initialization.views.containerToRestore.panel = viewContainerToRestore;\n\t\t\t} else {\n\t\t\t\tthis.stateModel.setRuntimeValue(LayoutStateKeys.PANEL_HIDDEN, true);\n\t\t\t}\n\t\t}\n\n\t\t// Auxiliary View to restore\n\t\tif (this.isVisible(Parts.AUXILIARYBAR_PART)) {\n\t\t\tconst viewContainerToRestore = this.storageService.get(AuxiliaryBarPart.activeViewSettingsKey, StorageScope.WORKSPACE, this.viewDescriptorService.getDefaultViewContainer(ViewContainerLocation.AuxiliaryBar)?.id);\n\t\t\tif (viewContainerToRestore) {\n\t\t\t\tthis.state.initialization.views.containerToRestore.auxiliaryBar = viewContainerToRestore;\n\t\t\t} else {\n\t\t\t\tthis.stateModel.setRuntimeValue(LayoutStateKeys.AUXILIARYBAR_HIDDEN, true);\n\t\t\t}\n\t\t}\n\n\t\t// Window border\n\t\tthis.updateWindowBorder(true);\n\t}\n\n\tprivate getDefaultLayoutViews(environmentService: IBrowserWorkbenchEnvironmentService, storageService: IStorageService): string[] | undefined {\n\t\tconst defaultLayout = environmentService.options?.defaultLayout;\n\t\tif (!defaultLayout) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\tif (!defaultLayout.force && !storageService.isNew(StorageScope.WORKSPACE)) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\tconst { views } = defaultLayout;\n\t\tif (views?.length) {\n\t\t\treturn views.map(view => view.id);\n\t\t}\n\n\t\treturn undefined;\n\t}\n\n\tprivate shouldRestoreEditors(contextService: IWorkspaceContextService, initialEditorsState: IInitialEditorsState | undefined): boolean {\n\n\t\t// Restore editors based on a set of rules:\n\t\t// - never when running on temporary workspace\n\t\t// - not when we have files to open, unless:\n\t\t// - always when `window.restoreWindows: preserve`\n\n\t\tif (isTemporaryWorkspace(contextService.getWorkspace())) {\n\t\t\treturn false;\n\t\t}\n\n\t\tconst forceRestoreEditors = this.configurationService.getValue<string>('window.restoreWindows') === 'preserve';\n\t\treturn !!forceRestoreEditors || initialEditorsState === undefined;\n\t}\n\n\tprotected willRestoreEditors(): boolean {\n\t\treturn this.state.initialization.editor.restoreEditors;\n\t}\n\n\tprivate async resolveEditorsToOpen(fileService: IFileService, initialEditorsState: IInitialEditorsState | undefined): Promise<IEditorToOpen[]> {\n\t\tif (initialEditorsState) {\n\n\t\t\t// Merge editor (single)\n\t\t\tconst filesToMerge = coalesce(await pathsToEditors(initialEditorsState.filesToMerge, fileService, this.logService));\n\t\t\tif (filesToMerge.length === 4 && isResourceEditorInput(filesToMerge[0]) && isResourceEditorInput(filesToMerge[1]) && isResourceEditorInput(filesToMerge[2]) && isResourceEditorInput(filesToMerge[3])) {\n\t\t\t\treturn [{\n\t\t\t\t\teditor: {\n\t\t\t\t\t\tinput1: { resource: filesToMerge[0].resource },\n\t\t\t\t\t\tinput2: { resource: filesToMerge[1].resource },\n\t\t\t\t\t\tbase: { resource: filesToMerge[2].resource },\n\t\t\t\t\t\tresult: { resource: filesToMerge[3].resource },\n\t\t\t\t\t\toptions: { pinned: true }\n\t\t\t\t\t}\n\t\t\t\t}];\n\t\t\t}\n\n\t\t\t// Diff editor (single)\n\t\t\tconst filesToDiff = coalesce(await pathsToEditors(initialEditorsState.filesToDiff, fileService, this.logService));\n\t\t\tif (filesToDiff.length === 2) {\n\t\t\t\treturn [{\n\t\t\t\t\teditor: {\n\t\t\t\t\t\toriginal: { resource: filesToDiff[0].resource },\n\t\t\t\t\t\tmodified: { resource: filesToDiff[1].resource },\n\t\t\t\t\t\toptions: { pinned: true }\n\t\t\t\t\t}\n\t\t\t\t}];\n\t\t\t}\n\n\t\t\t// Normal editor (multiple)\n\t\t\tconst filesToOpenOrCreate: IEditorToOpen[] = [];\n\t\t\tconst resolvedFilesToOpenOrCreate = await pathsToEditors(initialEditorsState.filesToOpenOrCreate, fileService, this.logService);\n\t\t\tfor (let i = 0; i < resolvedFilesToOpenOrCreate.length; i++) {\n\t\t\t\tconst resolvedFileToOpenOrCreate = resolvedFilesToOpenOrCreate[i];\n\t\t\t\tif (resolvedFileToOpenOrCreate) {\n\t\t\t\t\tfilesToOpenOrCreate.push({\n\t\t\t\t\t\teditor: resolvedFileToOpenOrCreate,\n\t\t\t\t\t\tviewColumn: initialEditorsState.filesToOpenOrCreate?.[i].viewColumn // take over `viewColumn` from initial state\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn filesToOpenOrCreate;\n\t\t}\n\n\t\t// Empty workbench configured to open untitled file if empty\n\t\telse if (this.contextService.getWorkbenchState() === WorkbenchState.EMPTY && this.configurationService.getValue('workbench.startupEditor') === 'newUntitledFile') {\n\t\t\tif (this.editorGroupService.hasRestorableState) {\n\t\t\t\treturn []; // do not open any empty untitled file if we restored groups/editors from previous session\n\t\t\t}\n\n\t\t\treturn [{\n\t\t\t\teditor: { resource: undefined } // open empty untitled file\n\t\t\t}];\n\t\t}\n\n\t\treturn [];\n\t}\n\n\tprivate _openedDefaultEditors: boolean = false;\n\tget openedDefaultEditors() { return this._openedDefaultEditors; }\n\n\tprivate getInitialEditorsState(): IInitialEditorsState | undefined {\n\n\t\t// Check for editors / editor layout from `defaultLayout` options first\n\t\tconst defaultLayout = this.environmentService.options?.defaultLayout;\n\t\tif ((defaultLayout?.editors?.length || defaultLayout?.layout?.editors) && (defaultLayout.force || this.storageService.isNew(StorageScope.WORKSPACE))) {\n\t\t\tthis._openedDefaultEditors = true;\n\n\t\t\treturn {\n\t\t\t\tlayout: defaultLayout.layout?.editors,\n\t\t\t\tfilesToOpenOrCreate: defaultLayout?.editors?.map(editor => {\n\t\t\t\t\treturn {\n\t\t\t\t\t\tviewColumn: editor.viewColumn,\n\t\t\t\t\t\tfileUri: URI.revive(editor.uri),\n\t\t\t\t\t\topenOnlyIfExists: editor.openOnlyIfExists,\n\t\t\t\t\t\toptions: editor.options\n\t\t\t\t\t};\n\t\t\t\t})\n\t\t\t};\n\t\t}\n\n\t\t// Then check for files to open, create or diff/merge from main side\n\t\tconst { filesToOpenOrCreate, filesToDiff, filesToMerge } = this.environmentService;\n\t\tif (filesToOpenOrCreate || filesToDiff || filesToMerge) {\n\t\t\treturn { filesToOpenOrCreate, filesToDiff, filesToMerge };\n\t\t}\n\n\t\treturn undefined;\n\t}\n\n\tprivate readonly whenReadyPromise = new DeferredPromise<void>();\n\tprotected readonly whenReady = this.whenReadyPromise.p;\n\n\tprivate readonly whenRestoredPromise = new DeferredPromise<void>();\n\treadonly whenRestored = this.whenRestoredPromise.p;\n\tprivate restored = false;\n\n\tisRestored(): boolean {\n\t\treturn this.restored;\n\t}\n\n\tprotected restoreParts(): void {\n\n\t\t// distinguish long running restore operations that\n\t\t// are required for the layout to be ready from those\n\t\t// that are needed to signal restoring is done\n\t\tconst layoutReadyPromises: Promise<unknown>[] = [];\n\t\tconst layoutRestoredPromises: Promise<unknown>[] = [];\n\n\t\t// Restore editors\n\t\tlayoutReadyPromises.push((async () => {\n\t\t\tmark('code/willRestoreEditors');\n\n\t\t\t// first ensure the editor part is ready\n\t\t\tawait this.editorGroupService.whenReady;\n\t\t\tmark('code/restoreEditors/editorGroupsReady');\n\n\t\t\t// apply editor layout if any\n\t\t\tif (this.state.initialization.layout?.editors) {\n\t\t\t\tthis.editorGroupService.mainPart.applyLayout(this.state.initialization.layout.editors);\n\t\t\t}\n\n\t\t\t// then see for editors to open as instructed\n\t\t\t// it is important that we trigger this from\n\t\t\t// the overall restore flow to reduce possible\n\t\t\t// flicker on startup: we want any editor to\n\t\t\t// open to get a chance to open first before\n\t\t\t// signaling that layout is restored, but we do\n\t\t\t// not need to await the editors from having\n\t\t\t// fully loaded.\n\n\t\t\tconst editors = await this.state.initialization.editor.editorsToOpen;\n\t\t\tmark('code/restoreEditors/editorsToOpenResolved');\n\n\t\t\tlet openEditorsPromise: Promise<unknown> | undefined = undefined;\n\t\t\tif (editors.length) {\n\n\t\t\t\t// we have to map editors to their groups as instructed\n\t\t\t\t// by the input. this is important to ensure that we open\n\t\t\t\t// the editors in the groups they belong to.\n\n\t\t\t\tconst editorGroupsInVisualOrder = this.editorGroupService.mainPart.getGroups(GroupsOrder.GRID_APPEARANCE);\n\t\t\t\tconst mapEditorsToGroup = new Map<GroupIdentifier, Set<IUntypedEditorInput>>();\n\n\t\t\t\tfor (const editor of editors) {\n\t\t\t\t\tconst group = editorGroupsInVisualOrder[(editor.viewColumn ?? 1) - 1]; // viewColumn is index+1 based\n\n\t\t\t\t\tlet editorsByGroup = mapEditorsToGroup.get(group.id);\n\t\t\t\t\tif (!editorsByGroup) {\n\t\t\t\t\t\teditorsByGroup = new Set<IUntypedEditorInput>();\n\t\t\t\t\t\tmapEditorsToGroup.set(group.id, editorsByGroup);\n\t\t\t\t\t}\n\n\t\t\t\t\teditorsByGroup.add(editor.editor);\n\t\t\t\t}\n\n\t\t\t\topenEditorsPromise = Promise.all(Array.from(mapEditorsToGroup).map(async ([groupId, editors]) => {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tawait this.editorService.openEditors(Array.from(editors), groupId, { validateTrust: true });\n\t\t\t\t\t} catch (error) {\n\t\t\t\t\t\tthis.logService.error(error);\n\t\t\t\t\t}\n\t\t\t\t}));\n\t\t\t}\n\n\t\t\t// do not block the overall layout ready flow from potentially\n\t\t\t// slow editors to resolve on startup\n\t\t\tlayoutRestoredPromises.push(\n\t\t\t\tPromise.all([\n\t\t\t\t\topenEditorsPromise?.finally(() => mark('code/restoreEditors/editorsOpened')),\n\t\t\t\t\tthis.editorGroupService.whenRestored.finally(() => mark('code/restoreEditors/editorGroupsRestored'))\n\t\t\t\t]).finally(() => {\n\t\t\t\t\t// the `code/didRestoreEditors` perf mark is specifically\n\t\t\t\t\t// for when visible editors have resolved, so we only mark\n\t\t\t\t\t// if when editor group service has restored.\n\t\t\t\t\tmark('code/didRestoreEditors');\n\t\t\t\t})\n\t\t\t);\n\t\t})());\n\n\t\t// Restore default views (only when `IDefaultLayout` is provided)\n\t\tconst restoreDefaultViewsPromise = (async () => {\n\t\t\tif (this.state.initialization.views.defaults?.length) {\n\t\t\t\tmark('code/willOpenDefaultViews');\n\n\t\t\t\tconst locationsRestored: { id: string; order: number }[] = [];\n\n\t\t\t\tconst tryOpenView = (view: { id: string; order: number }): boolean => {\n\t\t\t\t\tconst location = this.viewDescriptorService.getViewLocationById(view.id);\n\t\t\t\t\tif (location !== null) {\n\t\t\t\t\t\tconst container = this.viewDescriptorService.getViewContainerByViewId(view.id);\n\t\t\t\t\t\tif (container) {\n\t\t\t\t\t\t\tif (view.order >= (locationsRestored?.[location]?.order ?? 0)) {\n\t\t\t\t\t\t\t\tlocationsRestored[location] = { id: container.id, order: view.order };\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tconst containerModel = this.viewDescriptorService.getViewContainerModel(container);\n\t\t\t\t\t\t\tcontainerModel.setCollapsed(view.id, false);\n\t\t\t\t\t\t\tcontainerModel.setVisible(view.id, true);\n\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\treturn false;\n\t\t\t\t};\n\n\t\t\t\tconst defaultViews = [...this.state.initialization.views.defaults].reverse().map((v, index) => ({ id: v, order: index }));\n\n\t\t\t\tlet i = defaultViews.length;\n\t\t\t\twhile (i) {\n\t\t\t\t\ti--;\n\t\t\t\t\tif (tryOpenView(defaultViews[i])) {\n\t\t\t\t\t\tdefaultViews.splice(i, 1);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// If we still have views left over, wait until all extensions have been registered and try again\n\t\t\t\tif (defaultViews.length) {\n\t\t\t\t\tawait this.extensionService.whenInstalledExtensionsRegistered();\n\n\t\t\t\t\tlet i = defaultViews.length;\n\t\t\t\t\twhile (i) {\n\t\t\t\t\t\ti--;\n\t\t\t\t\t\tif (tryOpenView(defaultViews[i])) {\n\t\t\t\t\t\t\tdefaultViews.splice(i, 1);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// If we opened a view in the sidebar, stop any restore there\n\t\t\t\tif (locationsRestored[ViewContainerLocation.Sidebar]) {\n\t\t\t\t\tthis.state.initialization.views.containerToRestore.sideBar = locationsRestored[ViewContainerLocation.Sidebar].id;\n\t\t\t\t}\n\n\t\t\t\t// If we opened a view in the panel, stop any restore there\n\t\t\t\tif (locationsRestored[ViewContainerLocation.Panel]) {\n\t\t\t\t\tthis.state.initialization.views.containerToRestore.panel = locationsRestored[ViewContainerLocation.Panel].id;\n\t\t\t\t}\n\n\t\t\t\t// If we opened a view in the auxiliary bar, stop any restore there\n\t\t\t\tif (locationsRestored[ViewContainerLocation.AuxiliaryBar]) {\n\t\t\t\t\tthis.state.initialization.views.containerToRestore.auxiliaryBar = locationsRestored[ViewContainerLocation.AuxiliaryBar].id;\n\t\t\t\t}\n\n\t\t\t\tmark('code/didOpenDefaultViews');\n\t\t\t}\n\t\t})();\n\t\tlayoutReadyPromises.push(restoreDefaultViewsPromise);\n\n\t\t// Restore Sidebar\n\t\tlayoutReadyPromises.push((async () => {\n\n\t\t\t// Restoring views could mean that sidebar already\n\t\t\t// restored, as such we need to test again\n\t\t\tawait restoreDefaultViewsPromise;\n\t\t\tif (!this.state.initialization.views.containerToRestore.sideBar) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tmark('code/willRestoreViewlet');\n\n\t\t\tawait this.openViewContainer(ViewContainerLocation.Sidebar, this.state.initialization.views.containerToRestore.sideBar);\n\n\t\t\tmark('code/didRestoreViewlet');\n\t\t})());\n\n\t\t// Restore Panel\n\t\tlayoutReadyPromises.push((async () => {\n\n\t\t\t// Restoring views could mean that panel already\n\t\t\t// restored, as such we need to test again\n\t\t\tawait restoreDefaultViewsPromise;\n\t\t\tif (!this.state.initialization.views.containerToRestore.panel) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tmark('code/willRestorePanel');\n\n\t\t\tawait this.openViewContainer(ViewContainerLocation.Panel, this.state.initialization.views.containerToRestore.panel);\n\n\t\t\tmark('code/didRestorePanel');\n\t\t})());\n\n\t\t// Restore Auxiliary Bar\n\t\tlayoutReadyPromises.push((async () => {\n\n\t\t\t// Restoring views could mean that auxbar already\n\t\t\t// restored, as such we need to test again\n\t\t\tawait restoreDefaultViewsPromise;\n\t\t\tif (!this.state.initialization.views.containerToRestore.auxiliaryBar) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tmark('code/willRestoreAuxiliaryBar');\n\n\t\t\tawait this.openViewContainer(ViewContainerLocation.AuxiliaryBar, this.state.initialization.views.containerToRestore.auxiliaryBar);\n\n\t\t\tmark('code/didRestoreAuxiliaryBar');\n\t\t})());\n\n\t\t// Restore Zen Mode\n\t\tconst zenModeWasActive = this.isZenModeActive();\n\t\tconst restoreZenMode = getZenModeConfiguration(this.configurationService).restore;\n\n\t\tif (zenModeWasActive) {\n\t\t\tthis.setZenModeActive(!restoreZenMode);\n\t\t\tthis.toggleZenMode(false, true);\n\t\t}\n\n\t\t// Restore Main Editor Center Mode\n\t\tif (this.stateModel.getRuntimeValue(LayoutStateKeys.MAIN_EDITOR_CENTERED)) {\n\t\t\tthis.centerMainEditorLayout(true, true);\n\t\t}\n\n\t\t// Await for promises that we recorded to update\n\t\t// our ready and restored states properly.\n\t\tPromises.settled(layoutReadyPromises).finally(() => {\n\n\t\t\t// Focus the active maximized part in case we have\n\t\t\t// not yet focused a specific element and panel\n\t\t\t// or auxiliary bar are maximized.\n\t\t\tif (getActiveElement() === mainWindow.document.body && (this.isPanelMaximized() || this.isAuxiliaryBarMaximized())) {\n\t\t\t\tthis.focus();\n\t\t\t}\n\n\t\t\tthis.whenReadyPromise.complete();\n\n\t\t\tPromises.settled(layoutRestoredPromises).finally(() => {\n\t\t\t\tthis.restored = true;\n\t\t\t\tthis.whenRestoredPromise.complete();\n\t\t\t});\n\t\t});\n\t}\n\n\tprivate async openViewContainer(location: ViewContainerLocation, id: string, focus?: boolean): Promise<void> {\n\t\tlet viewContainer = await this.paneCompositeService.openPaneComposite(id, location, focus);\n\t\tif (viewContainer) {\n\t\t\treturn;\n\t\t}\n\n\t\t// fallback to default view container\n\t\tviewContainer = await this.paneCompositeService.openPaneComposite(this.viewDescriptorService.getDefaultViewContainer(location)?.id, location, focus);\n\t\tif (viewContainer) {\n\t\t\treturn;\n\t\t}\n\n\t\t// finally try to just open the first visible view container\n\t\tawait this.paneCompositeService.openPaneComposite(this.paneCompositeService.getVisiblePaneCompositeIds(location).at(0), location, focus);\n\t}\n\n\tregisterPart(part: Part): IDisposable {\n\t\tconst id = part.getId();\n\t\tthis.parts.set(id, part);\n\n\t\treturn toDisposable(() => this.parts.delete(id));\n\t}\n\n\tprotected getPart(key: Parts): Part {\n\t\tconst part = this.parts.get(key);\n\t\tif (!part) {\n\t\t\tthrow new Error(`Unknown part ${key}`);\n\t\t}\n\n\t\treturn part;\n\t}\n\n\tregisterNotifications(delegate: { onDidChangeNotificationsVisibility: Event<boolean> }): void {\n\t\tthis._register(delegate.onDidChangeNotificationsVisibility(visible => this._onDidChangeNotificationsVisibility.fire(visible)));\n\t}\n\n\thasFocus(part: Parts): boolean {\n\t\tconst container = this.getContainer(getActiveWindow(), part);\n\t\tif (!container) {\n\t\t\treturn false;\n\t\t}\n\n\t\tconst activeElement = getActiveElement();\n\t\tif (!activeElement) {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn isAncestorUsingFlowTo(activeElement, container);\n\t}\n\n\tprivate _getFocusedPart(): Parts | undefined {\n\t\tfor (const part of this.parts.keys()) {\n\t\t\tif (this.hasFocus(part as Parts)) {\n\t\t\t\treturn part as Parts;\n\t\t\t}\n\t\t}\n\n\t\treturn undefined;\n\t}\n\n\tfocusPart(part: MULTI_WINDOW_PARTS, targetWindow: Window): void;\n\tfocusPart(part: SINGLE_WINDOW_PARTS): void;\n\tfocusPart(part: Parts, targetWindow: Window = mainWindow): void {\n\t\tconst container = this.getContainer(targetWindow, part) ?? this.mainContainer;\n\n\t\tswitch (part) {\n\t\t\tcase Parts.EDITOR_PART:\n\t\t\t\tthis.editorGroupService.getPart(container).activeGroup.focus();\n\t\t\t\tbreak;\n\t\t\tcase Parts.PANEL_PART: {\n\t\t\t\tthis.paneCompositeService.getActivePaneComposite(ViewContainerLocation.Panel)?.focus();\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcase Parts.SIDEBAR_PART: {\n\t\t\t\tthis.paneCompositeService.getActivePaneComposite(ViewContainerLocation.Sidebar)?.focus();\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcase Parts.AUXILIARYBAR_PART: {\n\t\t\t\tthis.paneCompositeService.getActivePaneComposite(ViewContainerLocation.AuxiliaryBar)?.focus();\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcase Parts.ACTIVITYBAR_PART:\n\t\t\t\t(this.getPart(Parts.SIDEBAR_PART) as SidebarPart).focusActivityBar();\n\t\t\t\tbreak;\n\t\t\tcase Parts.STATUSBAR_PART:\n\t\t\t\tthis.statusBarService.getPart(container).focus();\n\t\t\t\tbreak;\n\t\t\tdefault: {\n\t\t\t\tcontainer?.focus();\n\t\t\t}\n\t\t}\n\t}\n\n\tgetContainer(targetWindow: Window): HTMLElement;\n\tgetContainer(targetWindow: Window, part: Parts): HTMLElement | undefined;\n\tgetContainer(targetWindow: Window, part?: Parts): HTMLElement | undefined {\n\t\tif (typeof part === 'undefined') {\n\t\t\treturn this.getContainerFromDocument(targetWindow.document);\n\t\t}\n\n\t\tif (targetWindow === mainWindow) {\n\t\t\treturn this.getPart(part).getContainer();\n\t\t}\n\n\t\t// Only some parts are supported for auxiliary windows\n\t\tlet partCandidate: unknown;\n\t\tif (part === Parts.EDITOR_PART) {\n\t\t\tpartCandidate = this.editorGroupService.getPart(this.getContainerFromDocument(targetWindow.document));\n\t\t} else if (part === Parts.STATUSBAR_PART) {\n\t\t\tpartCandidate = this.statusBarService.getPart(this.getContainerFromDocument(targetWindow.document));\n\t\t} else if (part === Parts.TITLEBAR_PART) {\n\t\t\tpartCandidate = this.titleService.getPart(this.getContainerFromDocument(targetWindow.document));\n\t\t}\n\n\t\tif (partCandidate instanceof Part) {\n\t\t\treturn partCandidate.getContainer();\n\t\t}\n\n\t\treturn undefined;\n\t}\n\n\tisVisible(part: MULTI_WINDOW_PARTS, targetWindow: Window): boolean;\n\tisVisible(part: SINGLE_WINDOW_PARTS): boolean;\n\tisVisible(part: Parts, targetWindow?: Window): boolean;\n\tisVisible(part: Parts, targetWindow: Window = mainWindow): boolean {\n\t\tif (targetWindow !== mainWindow && part === Parts.EDITOR_PART) {\n\t\t\treturn true; // cannot hide editor part in auxiliary windows\n\t\t}\n\n\t\tswitch (part) {\n\t\t\tcase Parts.TITLEBAR_PART:\n\t\t\t\treturn this.initialized ?\n\t\t\t\t\tthis.workbenchGrid.isViewVisible(this.titleBarPartView) :\n\t\t\t\t\tshouldShowCustomTitleBar(this.configurationService, mainWindow, this.state.runtime.menuBar.toggled);\n\t\t\tcase Parts.SIDEBAR_PART:\n\t\t\t\treturn !this.stateModel.getRuntimeValue(LayoutStateKeys.SIDEBAR_HIDDEN);\n\t\t\tcase Parts.PANEL_PART:\n\t\t\t\treturn !this.stateModel.getRuntimeValue(LayoutStateKeys.PANEL_HIDDEN);\n\t\t\tcase Parts.AUXILIARYBAR_PART:\n\t\t\t\treturn !this.stateModel.getRuntimeValue(LayoutStateKeys.AUXILIARYBAR_HIDDEN);\n\t\t\tcase Parts.STATUSBAR_PART:\n\t\t\t\treturn !this.stateModel.getRuntimeValue(LayoutStateKeys.STATUSBAR_HIDDEN);\n\t\t\tcase Parts.ACTIVITYBAR_PART:\n\t\t\t\treturn !this.stateModel.getRuntimeValue(LayoutStateKeys.ACTIVITYBAR_HIDDEN);\n\t\t\tcase Parts.EDITOR_PART:\n\t\t\t\treturn !this.stateModel.getRuntimeValue(LayoutStateKeys.EDITOR_HIDDEN);\n\t\t\tcase Parts.BANNER_PART:\n\t\t\t\treturn this.initialized ? this.workbenchGrid.isViewVisible(this.bannerPartView) : false;\n\t\t\tdefault:\n\t\t\t\treturn false; // any other part cannot be hidden\n\t\t}\n\t}\n\n\tprivate shouldShowBannerFirst(): boolean {\n\t\treturn isWeb && !isWCOEnabled();\n\t}\n\n\tfocus(): void {\n\t\tif (this.isPanelMaximized() && this.mainContainer === this.activeContainer) {\n\t\t\tthis.focusPart(Parts.PANEL_PART);\n\t\t} else if (this.isAuxiliaryBarMaximized() && this.mainContainer === this.activeContainer) {\n\t\t\tthis.focusPart(Parts.AUXILIARYBAR_PART);\n\t\t} else {\n\t\t\tthis.focusPart(Parts.EDITOR_PART, getWindow(this.activeContainer));\n\t\t}\n\t}\n\n\tprivate focusPanelOrEditor(): void {\n\t\tconst activePanel = this.paneCompositeService.getActivePaneComposite(ViewContainerLocation.Panel);\n\t\tif ((this.hasFocus(Parts.PANEL_PART) || !this.isVisible(Parts.EDITOR_PART)) && activePanel) {\n\t\t\tactivePanel.focus(); // prefer panel if it has focus or editor is hidden\n\t\t} else {\n\t\t\tthis.focus(); // otherwise focus editor\n\t\t}\n\t}\n\n\tgetMaximumEditorDimensions(container: HTMLElement): IDimension {\n\t\tconst targetWindow = getWindow(container);\n\t\tconst containerDimension = this.getContainerDimension(container);\n\n\t\tif (container === this.mainContainer) {\n\t\t\tconst isPanelHorizontal = isHorizontal(this.getPanelPosition());\n\t\t\tconst takenWidth =\n\t\t\t\t(this.isVisible(Parts.ACTIVITYBAR_PART) ? this.activityBarPartView.minimumWidth : 0) +\n\t\t\t\t(this.isVisible(Parts.SIDEBAR_PART) ? this.sideBarPartView.minimumWidth : 0) +\n\t\t\t\t(this.isVisible(Parts.PANEL_PART) && !isPanelHorizontal ? this.panelPartView.minimumWidth : 0) +\n\t\t\t\t(this.isVisible(Parts.AUXILIARYBAR_PART) ? this.auxiliaryBarPartView.minimumWidth : 0);\n\n\t\t\tconst takenHeight =\n\t\t\t\t(this.isVisible(Parts.TITLEBAR_PART, targetWindow) ? this.titleBarPartView.minimumHeight : 0) +\n\t\t\t\t(this.isVisible(Parts.STATUSBAR_PART, targetWindow) ? this.statusBarPartView.minimumHeight : 0) +\n\t\t\t\t(this.isVisible(Parts.PANEL_PART) && isPanelHorizontal ? this.panelPartView.minimumHeight : 0);\n\n\t\t\tconst availableWidth = containerDimension.width - takenWidth;\n\t\t\tconst availableHeight = containerDimension.height - takenHeight;\n\n\t\t\treturn { width: availableWidth, height: availableHeight };\n\t\t} else {\n\t\t\tconst takenHeight =\n\t\t\t\t(this.isVisible(Parts.TITLEBAR_PART, targetWindow) ? this.titleBarPartView.minimumHeight : 0) +\n\t\t\t\t(this.isVisible(Parts.STATUSBAR_PART, targetWindow) ? this.statusBarPartView.minimumHeight : 0);\n\n\t\t\treturn { width: containerDimension.width, height: containerDimension.height - takenHeight };\n\t\t}\n\t}\n\n\tprivate isZenModeActive(): boolean {\n\t\treturn this.stateModel.getRuntimeValue(LayoutStateKeys.ZEN_MODE_ACTIVE);\n\t}\n\n\tprivate setZenModeActive(active: boolean) {\n\t\tthis.stateModel.setRuntimeValue(LayoutStateKeys.ZEN_MODE_ACTIVE, active);\n\t}\n\n\ttoggleZenMode(skipLayout?: boolean, restoring = false): void {\n\t\tconst focusedPartPreTransition = this._getFocusedPart();\n\n\t\tthis.setZenModeActive(!this.isZenModeActive());\n\t\tthis.state.runtime.zenMode.transitionDisposables.clearAndDisposeAll();\n\n\t\tconst setLineNumbers = (lineNumbers?: LineNumbersType) => {\n\t\t\tfor (const editor of this.mainPartEditorService.visibleTextEditorControls) {\n\n\t\t\t\t// To properly reset line numbers we need to read the configuration for each editor respecting it's uri.\n\t\t\t\tif (!lineNumbers && isCodeEditor(editor) && editor.hasModel()) {\n\t\t\t\t\tconst model = editor.getModel();\n\t\t\t\t\tlineNumbers = this.configurationService.getValue('editor.lineNumbers', { resource: model.uri, overrideIdentifier: model.getLanguageId() });\n\t\t\t\t}\n\t\t\t\tif (!lineNumbers) {\n\t\t\t\t\tlineNumbers = this.configurationService.getValue('editor.lineNumbers');\n\t\t\t\t}\n\n\t\t\t\teditor.updateOptions({ lineNumbers });\n\t\t\t}\n\t\t};\n\n\t\t// Check if zen mode transitioned to full screen and if now we are out of zen mode\n\t\t// -> we need to go out of full screen (same goes for the centered editor layout)\n\t\tlet toggleMainWindowFullScreen = false;\n\t\tconst config = getZenModeConfiguration(this.configurationService);\n\t\tconst zenModeExitInfo = this.stateModel.getRuntimeValue(LayoutStateKeys.ZEN_MODE_EXIT_INFO);\n\n\t\t// Zen Mode Active\n\t\tif (this.isZenModeActive()) {\n\n\t\t\ttoggleMainWindowFullScreen = !this.state.runtime.mainWindowFullscreen && config.fullScreen && !isIOS;\n\n\t\t\tif (!restoring) {\n\t\t\t\tzenModeExitInfo.transitionedToFullScreen = toggleMainWindowFullScreen;\n\t\t\t\tzenModeExitInfo.transitionedToCenteredEditorLayout = !this.isMainEditorLayoutCentered() && config.centerLayout;\n\t\t\t\tzenModeExitInfo.handleNotificationsDoNotDisturbMode = this.notificationService.getFilter() === NotificationsFilter.OFF;\n\t\t\t\tzenModeExitInfo.wasVisible.sideBar = this.isVisible(Parts.SIDEBAR_PART);\n\t\t\t\tzenModeExitInfo.wasVisible.panel = this.isVisible(Parts.PANEL_PART);\n\t\t\t\tzenModeExitInfo.wasVisible.auxiliaryBar = this.isVisible(Parts.AUXILIARYBAR_PART);\n\t\t\t\tthis.stateModel.setRuntimeValue(LayoutStateKeys.ZEN_MODE_EXIT_INFO, zenModeExitInfo);\n\t\t\t}\n\n\t\t\tthis.setPanelHidden(true, true);\n\t\t\tthis.setAuxiliaryBarHidden(true, true);\n\t\t\tthis.setSideBarHidden(true);\n\n\t\t\tif (config.hideActivityBar) {\n\t\t\t\tthis.setActivityBarHidden(true);\n\t\t\t}\n\n\t\t\tif (config.hideStatusBar) {\n\t\t\t\tthis.setStatusBarHidden(true);\n\t\t\t}\n\n\t\t\tif (config.hideLineNumbers) {\n\t\t\t\tsetLineNumbers('off');\n\t\t\t\tthis.state.runtime.zenMode.transitionDisposables.set(ZenModeSettings.HIDE_LINENUMBERS, this.mainPartEditorService.onDidVisibleEditorsChange(() => setLineNumbers('off')));\n\t\t\t}\n\n\t\t\tif (config.showTabs !== this.editorGroupService.partOptions.showTabs) {\n\t\t\t\tthis.state.runtime.zenMode.transitionDisposables.set(ZenModeSettings.SHOW_TABS, this.editorGroupService.mainPart.enforcePartOptions({ showTabs: config.showTabs }));\n\t\t\t}\n\n\t\t\tif (config.silentNotifications && zenModeExitInfo.handleNotificationsDoNotDisturbMode) {\n\t\t\t\tthis.notificationService.setFilter(NotificationsFilter.ERROR);\n\t\t\t}\n\n\t\t\tif (config.centerLayout) {\n\t\t\t\tthis.centerMainEditorLayout(true, true);\n\t\t\t}\n\n\t\t\t// Zen Mode Configuration Changes\n\t\t\tthis.state.runtime.zenMode.transitionDisposables.set('configurationChange', this.configurationService.onDidChangeConfiguration(e => {\n\n\t\t\t\t// Activity Bar\n\t\t\t\tif (e.affectsConfiguration(ZenModeSettings.HIDE_ACTIVITYBAR) || e.affectsConfiguration(LayoutSettings.ACTIVITY_BAR_LOCATION)) {\n\t\t\t\t\tconst zenModeHideActivityBar = this.configurationService.getValue<boolean>(ZenModeSettings.HIDE_ACTIVITYBAR);\n\t\t\t\t\tconst activityBarLocation = this.configurationService.getValue<ActivityBarPosition>(LayoutSettings.ACTIVITY_BAR_LOCATION);\n\t\t\t\t\tthis.setActivityBarHidden(zenModeHideActivityBar ? true : (activityBarLocation === ActivityBarPosition.TOP || activityBarLocation === ActivityBarPosition.BOTTOM));\n\t\t\t\t}\n\n\t\t\t\t// Status Bar\n\t\t\t\tif (e.affectsConfiguration(ZenModeSettings.HIDE_STATUSBAR)) {\n\t\t\t\t\tconst zenModeHideStatusBar = this.configurationService.getValue<boolean>(ZenModeSettings.HIDE_STATUSBAR);\n\t\t\t\t\tthis.setStatusBarHidden(zenModeHideStatusBar);\n\t\t\t\t}\n\n\t\t\t\t// Center Layout\n\t\t\t\tif (e.affectsConfiguration(ZenModeSettings.CENTER_LAYOUT)) {\n\t\t\t\t\tconst zenModeCenterLayout = this.configurationService.getValue<boolean>(ZenModeSettings.CENTER_LAYOUT);\n\t\t\t\t\tthis.centerMainEditorLayout(zenModeCenterLayout, true);\n\t\t\t\t}\n\n\t\t\t\t// Show Tabs\n\t\t\t\tif (e.affectsConfiguration(ZenModeSettings.SHOW_TABS)) {\n\t\t\t\t\tconst zenModeShowTabs = this.configurationService.getValue<EditorTabsMode | undefined>(ZenModeSettings.SHOW_TABS) ?? 'multiple';\n\t\t\t\t\tthis.state.runtime.zenMode.transitionDisposables.set(ZenModeSettings.SHOW_TABS, this.editorGroupService.mainPart.enforcePartOptions({ showTabs: zenModeShowTabs }));\n\t\t\t\t}\n\n\t\t\t\t// Notifications\n\t\t\t\tif (e.affectsConfiguration(ZenModeSettings.SILENT_NOTIFICATIONS)) {\n\t\t\t\t\tconst zenModeSilentNotifications = !!this.configurationService.getValue(ZenModeSettings.SILENT_NOTIFICATIONS);\n\t\t\t\t\tif (zenModeExitInfo.handleNotificationsDoNotDisturbMode) {\n\t\t\t\t\t\tthis.notificationService.setFilter(zenModeSilentNotifications ? NotificationsFilter.ERROR : NotificationsFilter.OFF);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Center Layout\n\t\t\t\tif (e.affectsConfiguration(ZenModeSettings.HIDE_LINENUMBERS)) {\n\t\t\t\t\tconst lineNumbersType = this.configurationService.getValue<boolean>(ZenModeSettings.HIDE_LINENUMBERS) ? 'off' : undefined;\n\t\t\t\t\tsetLineNumbers(lineNumbersType);\n\t\t\t\t\tthis.state.runtime.zenMode.transitionDisposables.set(ZenModeSettings.HIDE_LINENUMBERS, this.mainPartEditorService.onDidVisibleEditorsChange(() => setLineNumbers(lineNumbersType)));\n\t\t\t\t}\n\t\t\t}));\n\t\t}\n\n\t\t// Zen Mode Inactive\n\t\telse {\n\t\t\tif (zenModeExitInfo.wasVisible.panel) {\n\t\t\t\tthis.setPanelHidden(false, true);\n\t\t\t}\n\n\t\t\tif (zenModeExitInfo.wasVisible.auxiliaryBar) {\n\t\t\t\tthis.setAuxiliaryBarHidden(false, true);\n\t\t\t}\n\n\t\t\tif (zenModeExitInfo.wasVisible.sideBar) {\n\t\t\t\tthis.setSideBarHidden(false);\n\t\t\t}\n\n\t\t\tif (!this.stateModel.getRuntimeValue(LayoutStateKeys.ACTIVITYBAR_HIDDEN, true)) {\n\t\t\t\tthis.setActivityBarHidden(false);\n\t\t\t}\n\n\t\t\tif (!this.stateModel.getRuntimeValue(LayoutStateKeys.STATUSBAR_HIDDEN, true)) {\n\t\t\t\tthis.setStatusBarHidden(false);\n\t\t\t}\n\n\t\t\tif (zenModeExitInfo.transitionedToCenteredEditorLayout) {\n\t\t\t\tthis.centerMainEditorLayout(false, true);\n\t\t\t}\n\n\t\t\tif (zenModeExitInfo.handleNotificationsDoNotDisturbMode) {\n\t\t\t\tthis.notificationService.setFilter(NotificationsFilter.OFF);\n\t\t\t}\n\n\t\t\tsetLineNumbers();\n\n\t\t\ttoggleMainWindowFullScreen = zenModeExitInfo.transitionedToFullScreen && this.state.runtime.mainWindowFullscreen;\n\t\t}\n\n\t\tif (!skipLayout) {\n\t\t\tthis.layout();\n\t\t}\n\n\t\tif (toggleMainWindowFullScreen) {\n\t\t\tthis.hostService.toggleFullScreen(mainWindow);\n\t\t}\n\n\t\t// restore focus if part is still visible, otherwise fallback to editor\n\t\tif (focusedPartPreTransition && this.isVisible(focusedPartPreTransition, getWindow(this.activeContainer))) {\n\t\t\tif (isMultiWindowPart(focusedPartPreTransition)) {\n\t\t\t\tthis.focusPart(focusedPartPreTransition, getWindow(this.activeContainer));\n\t\t\t} else {\n\t\t\t\tthis.focusPart(focusedPartPreTransition);\n\t\t\t}\n\t\t} else {\n\t\t\tthis.focus();\n\t\t}\n\n\t\t// Event\n\t\tthis._onDidChangeZenMode.fire(this.isZenModeActive());\n\t}\n\n\tprivate setStatusBarHidden(hidden: boolean): void {\n\t\tthis.stateModel.setRuntimeValue(LayoutStateKeys.STATUSBAR_HIDDEN, hidden);\n\n\t\t// Adjust CSS\n\t\tif (hidden) {\n\t\t\tthis.mainContainer.classList.add(LayoutClasses.STATUSBAR_HIDDEN);\n\t\t} else {\n\t\t\tthis.mainContainer.classList.remove(LayoutClasses.STATUSBAR_HIDDEN);\n\t\t}\n\n\t\t// Propagate to grid\n\t\tthis.workbenchGrid.setViewVisible(this.statusBarPartView, !hidden);\n\t}\n\n\tprotected createWorkbenchLayout(): void {\n\t\tconst titleBar = this.getPart(Parts.TITLEBAR_PART);\n\t\tconst bannerPart = this.getPart(Parts.BANNER_PART);\n\t\tconst editorPart = this.getPart(Parts.EDITOR_PART);\n\t\tconst activityBar = this.getPart(Parts.ACTIVITYBAR_PART);\n\t\tconst panelPart = this.getPart(Parts.PANEL_PART);\n\t\tconst auxiliaryBarPart = this.getPart(Parts.AUXILIARYBAR_PART);\n\t\tconst sideBar = this.getPart(Parts.SIDEBAR_PART);\n\t\tconst statusBar = this.getPart(Parts.STATUSBAR_PART);\n\n\t\t// View references for all parts\n\t\tthis.titleBarPartView = titleBar;\n\t\tthis.bannerPartView = bannerPart;\n\t\tthis.sideBarPartView = sideBar;\n\t\tthis.activityBarPartView = activityBar;\n\t\tthis.editorPartView = editorPart;\n\t\tthis.panelPartView = panelPart;\n\t\tthis.auxiliaryBarPartView = auxiliaryBarPart;\n\t\tthis.statusBarPartView = statusBar;\n\n\t\tconst viewMap = {\n\t\t\t[Parts.ACTIVITYBAR_PART]: this.activityBarPartView,\n\t\t\t[Parts.BANNER_PART]: this.bannerPartView,\n\t\t\t[Parts.TITLEBAR_PART]: this.titleBarPartView,\n\t\t\t[Parts.EDITOR_PART]: this.editorPartView,\n\t\t\t[Parts.PANEL_PART]: this.panelPartView,\n\t\t\t[Parts.SIDEBAR_PART]: this.sideBarPartView,\n\t\t\t[Parts.STATUSBAR_PART]: this.statusBarPartView,\n\t\t\t[Parts.AUXILIARYBAR_PART]: this.auxiliaryBarPartView\n\t\t};\n\n\t\tconst fromJSON = ({ type }: { type: Parts }) => viewMap[type];\n\t\tconst workbenchGrid = SerializableGrid.deserialize(\n\t\t\tthis.createGridDescriptor(),\n\t\t\t{ fromJSON },\n\t\t\t{ proportionalLayout: false }\n\t\t);\n\n\t\tthis.mainContainer.prepend(workbenchGrid.element);\n\t\tthis.mainContainer.setAttribute('role', 'application');\n\t\tthis.workbenchGrid = workbenchGrid;\n\t\tthis.workbenchGrid.edgeSnapping = this.state.runtime.mainWindowFullscreen;\n\n\t\tfor (const part of [titleBar, editorPart, activityBar, panelPart, sideBar, statusBar, auxiliaryBarPart, bannerPart]) {\n\t\t\tthis._register(part.onDidVisibilityChange(visible => {\n\t\t\t\tif (!this.inMaximizedAuxiliaryBarTransition) {\n\n\t\t\t\t\t// skip reacting when we are transitioning\n\t\t\t\t\t// in or out of maximised auxiliary bar to prevent\n\t\t\t\t\t// stepping on each other toes because this\n\t\t\t\t\t// transition is already dealing with all parts\n\t\t\t\t\t// visibility efficiently.\n\n\t\t\t\t\tif (part === sideBar) {\n\t\t\t\t\t\tthis.setSideBarHidden(!visible);\n\t\t\t\t\t} else if (part === panelPart) {\n\t\t\t\t\t\tthis.setPanelHidden(!visible, true);\n\t\t\t\t\t} else if (part === auxiliaryBarPart) {\n\t\t\t\t\t\tthis.setAuxiliaryBarHidden(!visible, true);\n\t\t\t\t\t} else if (part === editorPart) {\n\t\t\t\t\t\tthis.setEditorHidden(!visible);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tthis._onDidChangePartVisibility.fire();\n\t\t\t\tthis.handleContainerDidLayout(this.mainContainer, this._mainContainerDimension);\n\t\t\t}));\n\t\t}\n\n\t\tthis._register(this.storageService.onWillSaveState(() => {\n\n\t\t\t// Side Bar Size\n\t\t\tconst sideBarSize = this.stateModel.getRuntimeValue(LayoutStateKeys.SIDEBAR_HIDDEN)\n\t\t\t\t? this.workbenchGrid.getViewCachedVisibleSize(this.sideBarPartView)\n\t\t\t\t: this.workbenchGrid.getViewSize(this.sideBarPartView).width;\n\t\t\tthis.stateModel.setInitializationValue(LayoutStateKeys.SIDEBAR_SIZE, sideBarSize as number);\n\n\t\t\t// Panel Size\n\t\t\tconst panelSize = this.stateModel.getRuntimeValue(LayoutStateKeys.PANEL_HIDDEN)\n\t\t\t\t? this.workbenchGrid.getViewCachedVisibleSize(this.panelPartView)\n\t\t\t\t: isHorizontal(this.stateModel.getRuntimeValue(LayoutStateKeys.PANEL_POSITION))\n\t\t\t\t\t? this.workbenchGrid.getViewSize(this.panelPartView).height\n\t\t\t\t\t: this.workbenchGrid.getViewSize(this.panelPartView).width;\n\t\t\tthis.stateModel.setInitializationValue(LayoutStateKeys.PANEL_SIZE, panelSize as number);\n\n\t\t\t// Auxiliary Bar Size\n\t\t\tconst auxiliaryBarSize = this.stateModel.getRuntimeValue(LayoutStateKeys.AUXILIARYBAR_HIDDEN)\n\t\t\t\t? this.workbenchGrid.getViewCachedVisibleSize(this.auxiliaryBarPartView)\n\t\t\t\t: this.workbenchGrid.getViewSize(this.auxiliaryBarPartView).width;\n\t\t\tthis.stateModel.setInitializationValue(LayoutStateKeys.AUXILIARYBAR_SIZE, auxiliaryBarSize as number);\n\n\t\t\tthis.stateModel.save(true, true);\n\t\t}));\n\n\t\tthis._register(Event.any(this.paneCompositeService.onDidPaneCompositeOpen, this.paneCompositeService.onDidPaneCompositeClose)(() => {\n\n\t\t\t// Auxiliary Bar State\n\t\t\tthis.stateModel.setInitializationValue(LayoutStateKeys.AUXILIARYBAR_EMPTY, this.paneCompositeService.getPaneCompositeIds(ViewContainerLocation.AuxiliaryBar).length === 0);\n\t\t}));\n\t}\n\n\tlayout(): void {\n\t\tif (!this.disposed) {\n\t\t\tthis._mainContainerDimension = getClientArea(this.state.runtime.mainWindowFullscreen ?\n\t\t\t\tmainWindow.document.body : \t// in fullscreen mode, make sure to use <body> element because\n\t\t\t\tthis.parent,\t\t\t\t// in that case the workbench will span the entire site\n\t\t\t\tthis.contextService.getWorkbenchState() === WorkbenchState.EMPTY ? DEFAULT_EMPTY_WINDOW_DIMENSIONS : DEFAULT_WORKSPACE_WINDOW_DIMENSIONS // running with fallback to ensure no error is thrown (https://github.com/microsoft/vscode/issues/240242)\n\t\t\t);\n\t\t\tthis.logService.trace(`Layout#layout, height: ${this._mainContainerDimension.height}, width: ${this._mainContainerDimension.width}`);\n\n\t\t\tsize(this.mainContainer, this._mainContainerDimension.width, this._mainContainerDimension.height);\n\n\t\t\t// Layout the grid widget\n\t\t\tthis.workbenchGrid.layout(this._mainContainerDimension.width, this._mainContainerDimension.height);\n\t\t\tthis.initialized = true;\n\n\t\t\t// Emit as event\n\t\t\tthis.handleContainerDidLayout(this.mainContainer, this._mainContainerDimension);\n\t\t}\n\t}\n\n\tisMainEditorLayoutCentered(): boolean {\n\t\treturn this.stateModel.getRuntimeValue(LayoutStateKeys.MAIN_EDITOR_CENTERED);\n\t}\n\n\tcenterMainEditorLayout(active: boolean, skipLayout?: boolean): void {\n\t\tthis.stateModel.setRuntimeValue(LayoutStateKeys.MAIN_EDITOR_CENTERED, active);\n\n\t\tconst mainVisibleEditors = coalesce(this.editorGroupService.mainPart.groups.map(group => group.activeEditor));\n\t\tconst isEditorComplex = mainVisibleEditors.some(editor => {\n\t\t\tif (editor instanceof DiffEditorInput) {\n\t\t\t\treturn this.configurationService.getValue('diffEditor.renderSideBySide');\n\t\t\t}\n\n\t\t\tif (editor?.hasCapability(EditorInputCapabilities.MultipleEditors)) {\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\treturn false;\n\t\t});\n\n\t\tconst layout = this.editorGroupService.getLayout();\n\t\tlet hasMoreThanOneColumn = false;\n\t\tif (layout.orientation === GroupOrientation.HORIZONTAL) {\n\t\t\thasMoreThanOneColumn = layout.groups.length > 1;\n\t\t} else {\n\t\t\thasMoreThanOneColumn = layout.groups.some(group => group.groups && group.groups.length > 1);\n\t\t}\n\n\t\tconst isCenteredLayoutAutoResizing = this.configurationService.getValue('workbench.editor.centeredLayoutAutoResize');\n\t\tif (\n\t\t\tisCenteredLayoutAutoResizing &&\n\t\t\t((hasMoreThanOneColumn && !this.editorGroupService.mainPart.hasMaximizedGroup()) || isEditorComplex)\n\t\t) {\n\t\t\tactive = false; // disable centered layout for complex editors or when there is more than one group\n\t\t}\n\n\t\tif (this.editorGroupService.mainPart.isLayoutCentered() !== active) {\n\t\t\tthis.editorGroupService.mainPart.centerLayout(active);\n\n\t\t\tif (!skipLayout) {\n\t\t\t\tthis.layout();\n\t\t\t}\n\t\t}\n\n\t\tthis._onDidChangeMainEditorCenteredLayout.fire(this.stateModel.getRuntimeValue(LayoutStateKeys.MAIN_EDITOR_CENTERED));\n\t}\n\n\tgetSize(part: Parts): IViewSize {\n\t\treturn this.workbenchGrid.getViewSize(this.getPart(part));\n\t}\n\n\tsetSize(part: Parts, size: IViewSize): void {\n\t\tthis.workbenchGrid.resizeView(this.getPart(part), size);\n\t}\n\n\tresizePart(part: Parts, sizeChangeWidth: number, sizeChangeHeight: number): void {\n\t\tconst sizeChangePxWidth = Math.sign(sizeChangeWidth) * computeScreenAwareSize(getActiveWindow(), Math.abs(sizeChangeWidth));\n\t\tconst sizeChangePxHeight = Math.sign(sizeChangeHeight) * computeScreenAwareSize(getActiveWindow(), Math.abs(sizeChangeHeight));\n\n\t\tlet viewSize: IViewSize;\n\n\t\tswitch (part) {\n\t\t\tcase Parts.SIDEBAR_PART:\n\t\t\t\tviewSize = this.workbenchGrid.getViewSize(this.sideBarPartView);\n\t\t\t\tthis.workbenchGrid.resizeView(this.sideBarPartView, {\n\t\t\t\t\twidth: viewSize.width + sizeChangePxWidth,\n\t\t\t\t\theight: viewSize.height\n\t\t\t\t});\n\n\t\t\t\tbreak;\n\t\t\tcase Parts.PANEL_PART:\n\t\t\t\tviewSize = this.workbenchGrid.getViewSize(this.panelPartView);\n\n\t\t\t\tthis.workbenchGrid.resizeView(this.panelPartView, {\n\t\t\t\t\twidth: viewSize.width + (isHorizontal(this.getPanelPosition()) ? 0 : sizeChangePxWidth),\n\t\t\t\t\theight: viewSize.height + (isHorizontal(this.getPanelPosition()) ? sizeChangePxHeight : 0)\n\t\t\t\t});\n\n\t\t\t\tbreak;\n\t\t\tcase Parts.AUXILIARYBAR_PART:\n\t\t\t\tviewSize = this.workbenchGrid.getViewSize(this.auxiliaryBarPartView);\n\t\t\t\tthis.workbenchGrid.resizeView(this.auxiliaryBarPartView, {\n\t\t\t\t\twidth: viewSize.width + sizeChangePxWidth,\n\t\t\t\t\theight: viewSize.height\n\t\t\t\t});\n\t\t\t\tbreak;\n\t\t\tcase Parts.EDITOR_PART:\n\t\t\t\tviewSize = this.workbenchGrid.getViewSize(this.editorPartView);\n\n\t\t\t\t// Single Editor Group\n\t\t\t\tif (this.editorGroupService.mainPart.count === 1) {\n\t\t\t\t\tthis.workbenchGrid.resizeView(this.editorPartView, {\n\t\t\t\t\t\twidth: viewSize.width + sizeChangePxWidth,\n\t\t\t\t\t\theight: viewSize.height + sizeChangePxHeight\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tconst activeGroup = this.editorGroupService.mainPart.activeGroup;\n\n\t\t\t\t\tconst { width, height } = this.editorGroupService.mainPart.getSize(activeGroup);\n\t\t\t\t\tthis.editorGroupService.mainPart.setSize(activeGroup, { width: width + sizeChangePxWidth, height: height + sizeChangePxHeight });\n\n\t\t\t\t\t// After resizing the editor group\n\t\t\t\t\t// if it does not change in either direction\n\t\t\t\t\t// try resizing the full editor part\n\t\t\t\t\tconst { width: newWidth, height: newHeight } = this.editorGroupService.mainPart.getSize(activeGroup);\n\t\t\t\t\tif ((sizeChangePxHeight && height === newHeight) || (sizeChangePxWidth && width === newWidth)) {\n\t\t\t\t\t\tthis.workbenchGrid.resizeView(this.editorPartView, {\n\t\t\t\t\t\t\twidth: viewSize.width + (sizeChangePxWidth && width === newWidth ? sizeChangePxWidth : 0),\n\t\t\t\t\t\t\theight: viewSize.height + (sizeChangePxHeight && height === newHeight ? sizeChangePxHeight : 0)\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\treturn; // Cannot resize other parts\n\t\t}\n\t}\n\n\tprivate setActivityBarHidden(hidden: boolean): void {\n\t\tthis.stateModel.setRuntimeValue(LayoutStateKeys.ACTIVITYBAR_HIDDEN, hidden);\n\t\tthis.workbenchGrid.setViewVisible(this.activityBarPartView, !hidden);\n\t}\n\n\tprivate setBannerHidden(hidden: boolean): void {\n\t\tthis.workbenchGrid.setViewVisible(this.bannerPartView, !hidden);\n\t}\n\n\tprivate setEditorHidden(hidden: boolean): void {\n\t\tif (!hidden && this.setAuxiliaryBarMaximized(false) && this.isVisible(Parts.EDITOR_PART)) {\n\t\t\treturn; // return: leaving maximised auxiliary bar made this part visible\n\t\t}\n\n\t\tthis.stateModel.setRuntimeValue(LayoutStateKeys.EDITOR_HIDDEN, hidden);\n\n\t\t// Adjust CSS\n\t\tif (hidden) {\n\t\t\tthis.mainContainer.classList.add(LayoutClasses.MAIN_EDITOR_AREA_HIDDEN);\n\t\t} else {\n\t\t\tthis.mainContainer.classList.remove(LayoutClasses.MAIN_EDITOR_AREA_HIDDEN);\n\t\t}\n\n\t\t// Propagate to grid\n\t\tthis.workbenchGrid.setViewVisible(this.editorPartView, !hidden);\n\n\t\t// The editor and panel cannot be hidden at the same time\n\t\t// unless we have a maximized auxiliary bar\n\t\tif (hidden && !this.isVisible(Parts.PANEL_PART) && !this.isAuxiliaryBarMaximized()) {\n\t\t\tthis.setPanelHidden(false, true);\n\t\t}\n\t}\n\n\tgetLayoutClasses(): string[] {\n\t\treturn coalesce([\n\t\t\t!this.isVisible(Parts.SIDEBAR_PART) ? LayoutClasses.SIDEBAR_HIDDEN : undefined,\n\t\t\t!this.isVisible(Parts.EDITOR_PART, mainWindow) ? LayoutClasses.MAIN_EDITOR_AREA_HIDDEN : undefined,\n\t\t\t!this.isVisible(Parts.PANEL_PART) ? LayoutClasses.PANEL_HIDDEN : undefined,\n\t\t\t!this.isVisible(Parts.AUXILIARYBAR_PART) ? LayoutClasses.AUXILIARYBAR_HIDDEN : undefined,\n\t\t\t!this.isVisible(Parts.STATUSBAR_PART) ? LayoutClasses.STATUSBAR_HIDDEN : undefined,\n\t\t\tthis.state.runtime.mainWindowFullscreen ? LayoutClasses.FULLSCREEN : undefined\n\t\t]);\n\t}\n\n\tprivate setSideBarHidden(hidden: boolean): void {\n\t\tif (!hidden && this.setAuxiliaryBarMaximized(false) && this.isVisible(Parts.SIDEBAR_PART)) {\n\t\t\treturn; // return: leaving maximised auxiliary bar made this part visible\n\t\t}\n\n\t\tthis.stateModel.setRuntimeValue(LayoutStateKeys.SIDEBAR_HIDDEN, hidden);\n\n\t\t// Adjust CSS\n\t\tif (hidden) {\n\t\t\tthis.mainContainer.classList.add(LayoutClasses.SIDEBAR_HIDDEN);\n\t\t} else {\n\t\t\tthis.mainContainer.classList.remove(LayoutClasses.SIDEBAR_HIDDEN);\n\t\t}\n\n\t\t// If sidebar becomes hidden, also hide the current active Viewlet if any\n\t\tif (hidden && this.paneCompositeService.getActivePaneComposite(ViewContainerLocation.Sidebar)) {\n\t\t\tthis.paneCompositeService.hideActivePaneComposite(ViewContainerLocation.Sidebar);\n\n\t\t\tif (!this.isAuxiliaryBarMaximized()) {\n\t\t\t\tthis.focusPanelOrEditor(); // do not auto focus when auxiliary bar is maximized\n\t\t\t}\n\t\t}\n\n\t\t// If sidebar becomes visible, show last active Viewlet or default viewlet\n\t\telse if (!hidden && !this.paneCompositeService.getActivePaneComposite(ViewContainerLocation.Sidebar)) {\n\t\t\tconst viewletToOpen = this.paneCompositeService.getLastActivePaneCompositeId(ViewContainerLocation.Sidebar);\n\t\t\tif (viewletToOpen) {\n\t\t\t\tthis.openViewContainer(ViewContainerLocation.Sidebar, viewletToOpen, true);\n\t\t\t}\n\t\t}\n\n\t\t// Propagate to grid\n\t\tthis.workbenchGrid.setViewVisible(this.sideBarPartView, !hidden);\n\t}\n\n\tprivate hasViews(id: string): boolean {\n\t\tconst viewContainer = this.viewDescriptorService.getViewContainerById(id);\n\t\tif (!viewContainer) {\n\t\t\treturn false;\n\t\t}\n\n\t\tconst viewContainerModel = this.viewDescriptorService.getViewContainerModel(viewContainer);\n\t\tif (!viewContainerModel) {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn viewContainerModel.activeViewDescriptors.length >= 1;\n\t}\n\n\tprivate adjustPartPositions(sideBarPosition: Position, panelAlignment: PanelAlignment, panelPosition: Position): void {\n\n\t\t// Move activity bar and side bars\n\t\tconst isPanelVertical = !isHorizontal(panelPosition);\n\t\tconst sideBarSiblingToEditor = isPanelVertical || !(panelAlignment === 'center' || (sideBarPosition === Position.LEFT && panelAlignment === 'right') || (sideBarPosition === Position.RIGHT && panelAlignment === 'left'));\n\t\tconst auxiliaryBarSiblingToEditor = isPanelVertical || !(panelAlignment === 'center' || (sideBarPosition === Position.RIGHT && panelAlignment === 'right') || (sideBarPosition === Position.LEFT && panelAlignment === 'left'));\n\t\tconst preMovePanelWidth = !this.isVisible(Parts.PANEL_PART) ? Sizing.Invisible(this.workbenchGrid.getViewCachedVisibleSize(this.panelPartView) ?? this.panelPartView.minimumWidth) : this.workbenchGrid.getViewSize(this.panelPartView).width;\n\t\tconst preMovePanelHeight = !this.isVisible(Parts.PANEL_PART) ? Sizing.Invisible(this.workbenchGrid.getViewCachedVisibleSize(this.panelPartView) ?? this.panelPartView.minimumHeight) : this.workbenchGrid.getViewSize(this.panelPartView).height;\n\t\tconst preMoveSideBarSize = !this.isVisible(Parts.SIDEBAR_PART) ? Sizing.Invisible(this.workbenchGrid.getViewCachedVisibleSize(this.sideBarPartView) ?? this.sideBarPartView.minimumWidth) : this.workbenchGrid.getViewSize(this.sideBarPartView).width;\n\t\tconst preMoveAuxiliaryBarSize = !this.isVisible(Parts.AUXILIARYBAR_PART) ? Sizing.Invisible(this.workbenchGrid.getViewCachedVisibleSize(this.auxiliaryBarPartView) ?? this.auxiliaryBarPartView.minimumWidth) : this.workbenchGrid.getViewSize(this.auxiliaryBarPartView).width;\n\n\t\tconst focusedPart = [Parts.PANEL_PART, Parts.SIDEBAR_PART, Parts.AUXILIARYBAR_PART].find(part => this.hasFocus(part)) as SINGLE_WINDOW_PARTS | undefined;\n\n\t\tif (sideBarPosition === Position.LEFT) {\n\t\t\tthis.workbenchGrid.moveViewTo(this.activityBarPartView, [2, 0]);\n\t\t\tthis.workbenchGrid.moveView(this.sideBarPartView, preMoveSideBarSize, sideBarSiblingToEditor ? this.editorPartView : this.activityBarPartView, sideBarSiblingToEditor ? Direction.Left : Direction.Right);\n\t\t\tif (auxiliaryBarSiblingToEditor) {\n\t\t\t\tthis.workbenchGrid.moveView(this.auxiliaryBarPartView, preMoveAuxiliaryBarSize, this.editorPartView, Direction.Right);\n\t\t\t} else {\n\t\t\t\tthis.workbenchGrid.moveViewTo(this.auxiliaryBarPartView, [2, -1]);\n\t\t\t}\n\t\t} else {\n\t\t\tthis.workbenchGrid.moveViewTo(this.activityBarPartView, [2, -1]);\n\t\t\tthis.workbenchGrid.moveView(this.sideBarPartView, preMoveSideBarSize, sideBarSiblingToEditor ? this.editorPartView : this.activityBarPartView, sideBarSiblingToEditor ? Direction.Right : Direction.Left);\n\t\t\tif (auxiliaryBarSiblingToEditor) {\n\t\t\t\tthis.workbenchGrid.moveView(this.auxiliaryBarPartView, preMoveAuxiliaryBarSize, this.editorPartView, Direction.Left);\n\t\t\t} else {\n\t\t\t\tthis.workbenchGrid.moveViewTo(this.auxiliaryBarPartView, [2, 0]);\n\t\t\t}\n\t\t}\n\n\t\t// Maintain focus after moving parts\n\t\tif (focusedPart) {\n\t\t\tthis.focusPart(focusedPart);\n\t\t}\n\n\t\t// We moved all the side parts based on the editor and ignored the panel\n\t\t// Now, we need to put the panel back in the right position when it is next to the editor\n\t\tif (isPanelVertical) {\n\t\t\tthis.workbenchGrid.moveView(this.panelPartView, preMovePanelWidth, this.editorPartView, panelPosition === Position.LEFT ? Direction.Left : Direction.Right);\n\t\t\tthis.workbenchGrid.resizeView(this.panelPartView, {\n\t\t\t\theight: preMovePanelHeight as number,\n\t\t\t\twidth: preMovePanelWidth as number\n\t\t\t});\n\t\t}\n\n\t\t// Moving views in the grid can cause them to re-distribute sizing unnecessarily\n\t\t// Resize visible parts to the width they were before the operation\n\t\tif (this.isVisible(Parts.SIDEBAR_PART)) {\n\t\t\tthis.workbenchGrid.resizeView(this.sideBarPartView, {\n\t\t\t\theight: this.workbenchGrid.getViewSize(this.sideBarPartView).height,\n\t\t\t\twidth: preMoveSideBarSize as number\n\t\t\t});\n\t\t}\n\n\t\tif (this.isVisible(Parts.AUXILIARYBAR_PART)) {\n\t\t\tthis.workbenchGrid.resizeView(this.auxiliaryBarPartView, {\n\t\t\t\theight: this.workbenchGrid.getViewSize(this.auxiliaryBarPartView).height,\n\t\t\t\twidth: preMoveAuxiliaryBarSize as number\n\t\t\t});\n\t\t}\n\t}\n\n\tsetPanelAlignment(alignment: PanelAlignment): void {\n\n\t\t// Panel alignment only applies to a panel in the top/bottom position\n\t\tif (!isHorizontal(this.getPanelPosition())) {\n\t\t\tthis.setPanelPosition(Position.BOTTOM);\n\t\t}\n\n\t\t// the workbench grid currently prevents us from supporting panel maximization with non-center panel alignment\n\t\tif (alignment !== 'center' && this.isPanelMaximized()) {\n\t\t\tthis.toggleMaximizedPanel();\n\t\t}\n\n\t\tthis.stateModel.setRuntimeValue(LayoutStateKeys.PANEL_ALIGNMENT, alignment);\n\n\t\tthis.adjustPartPositions(this.getSideBarPosition(), alignment, this.getPanelPosition());\n\n\t\tthis._onDidChangePanelAlignment.fire(alignment);\n\t}\n\n\tprivate setPanelHidden(hidden: boolean, skipLayout?: boolean): void {\n\t\tif (!this.workbenchGrid) {\n\t\t\treturn; // Return if not initialized fully (https://github.com/microsoft/vscode/issues/105480)\n\t\t}\n\n\t\tif (!hidden && this.setAuxiliaryBarMaximized(false) && this.isVisible(Parts.PANEL_PART)) {\n\t\t\treturn; // return: leaving maximised auxiliary bar made this part visible\n\t\t}\n\n\t\tconst wasHidden = !this.isVisible(Parts.PANEL_PART);\n\n\t\tthis.stateModel.setRuntimeValue(LayoutStateKeys.PANEL_HIDDEN, hidden);\n\n\t\tconst isPanelMaximized = this.isPanelMaximized();\n\t\tconst panelOpensMaximized = this.panelOpensMaximized();\n\n\t\t// Adjust CSS\n\t\tif (hidden) {\n\t\t\tthis.mainContainer.classList.add(LayoutClasses.PANEL_HIDDEN);\n\t\t} else {\n\t\t\tthis.mainContainer.classList.remove(LayoutClasses.PANEL_HIDDEN);\n\t\t}\n\n\t\t// If panel part becomes hidden, also hide the current active panel if any\n\t\tlet focusEditor = false;\n\t\tif (hidden && this.paneCompositeService.getActivePaneComposite(ViewContainerLocation.Panel)) {\n\t\t\tthis.paneCompositeService.hideActivePaneComposite(ViewContainerLocation.Panel);\n\t\t\tif (\n\t\t\t\t!isIOS &&\t\t\t\t\t\t// do not auto focus on iOS (https://github.com/microsoft/vscode/issues/127832)\n\t\t\t\t!this.isAuxiliaryBarMaximized()\t// do not auto focus when auxiliary bar is maximized\n\t\t\t) {\n\t\t\t\tfocusEditor = true;\n\t\t\t}\n\t\t}\n\n\t\t// If panel part becomes visible, show last active panel or default panel\n\t\telse if (!hidden && !this.paneCompositeService.getActivePaneComposite(ViewContainerLocation.Panel)) {\n\t\t\tlet panelToOpen: string | undefined = this.paneCompositeService.getLastActivePaneCompositeId(ViewContainerLocation.Panel);\n\n\t\t\t// verify that the panel we try to open has views before we default to it\n\t\t\t// otherwise fall back to any view that has views still refs #111463\n\t\t\tif (!panelToOpen || !this.hasViews(panelToOpen)) {\n\t\t\t\tpanelToOpen = this.viewDescriptorService\n\t\t\t\t\t.getViewContainersByLocation(ViewContainerLocation.Panel)\n\t\t\t\t\t.find(viewContainer => this.hasViews(viewContainer.id))?.id;\n\t\t\t}\n\n\t\t\tif (panelToOpen) {\n\t\t\t\tthis.openViewContainer(ViewContainerLocation.Panel, panelToOpen, !skipLayout);\n\t\t\t}\n\t\t}\n\n\t\t// If maximized and in process of hiding, unmaximize before\n\t\t// hiding to allow caching of non-maximized size\n\t\tif (hidden && isPanelMaximized) {\n\t\t\tthis.toggleMaximizedPanel();\n\t\t}\n\n\t\t// Don't proceed if we have already done this before\n\t\tif (wasHidden === hidden) {\n\t\t\treturn;\n\t\t}\n\n\t\t// Propagate layout changes to grid\n\t\tthis.workbenchGrid.setViewVisible(this.panelPartView, !hidden);\n\n\t\t// If in process of showing, toggle whether or not panel is maximized\n\t\tif (!hidden) {\n\t\t\tif (!skipLayout && isPanelMaximized !== panelOpensMaximized) {\n\t\t\t\tthis.toggleMaximizedPanel();\n\t\t\t}\n\t\t} else {\n\t\t\t// If in process of hiding, remember whether the panel is maximized or not\n\t\t\tthis.stateModel.setRuntimeValue(LayoutStateKeys.PANEL_WAS_LAST_MAXIMIZED, isPanelMaximized);\n\t\t}\n\n\t\tif (focusEditor) {\n\t\t\tthis.editorGroupService.mainPart.activeGroup.focus(); // Pass focus to editor group if panel part is now hidden\n\t\t}\n\t}\n\n\tprivate inMaximizedAuxiliaryBarTransition = false;\n\n\tisAuxiliaryBarMaximized(): boolean {\n\t\treturn this.stateModel.getRuntimeValue(LayoutStateKeys.AUXILIARYBAR_WAS_LAST_MAXIMIZED);\n\t}\n\n\ttoggleMaximizedAuxiliaryBar(): void {\n\t\tthis.setAuxiliaryBarMaximized(!this.isAuxiliaryBarMaximized());\n\t}\n\n\tsetAuxiliaryBarMaximized(maximized: boolean): boolean {\n\t\tif (\n\t\t\tthis.inMaximizedAuxiliaryBarTransition ||\t\t// prevent re-entrance\n\t\t\t(maximized === this.isAuxiliaryBarMaximized())\t// return early if state is already present\n\t\t) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif (maximized) {\n\t\t\tconst state = {\n\t\t\t\tsideBarVisible: this.isVisible(Parts.SIDEBAR_PART),\n\t\t\t\teditorVisible: this.isVisible(Parts.EDITOR_PART),\n\t\t\t\tpanelVisible: this.isVisible(Parts.PANEL_PART),\n\t\t\t\tauxiliaryBarVisible: this.isVisible(Parts.AUXILIARYBAR_PART)\n\t\t\t};\n\t\t\tthis.stateModel.setRuntimeValue(LayoutStateKeys.AUXILIARYBAR_WAS_LAST_MAXIMIZED, true);\n\n\t\t\tthis.inMaximizedAuxiliaryBarTransition = true;\n\t\t\ttry {\n\t\t\t\tif (!state.auxiliaryBarVisible) {\n\t\t\t\t\tthis.setAuxiliaryBarHidden(false);\n\t\t\t\t}\n\n\t\t\t\tconst size = this.workbenchGrid.getViewSize(this.auxiliaryBarPartView).width;\n\t\t\t\tthis.stateModel.setRuntimeValue(LayoutStateKeys.AUXILIARYBAR_LAST_NON_MAXIMIZED_SIZE, size);\n\n\t\t\t\tif (state.sideBarVisible) {\n\t\t\t\t\tthis.setSideBarHidden(true);\n\t\t\t\t}\n\t\t\t\tif (state.panelVisible) {\n\t\t\t\t\tthis.setPanelHidden(true);\n\t\t\t\t}\n\t\t\t\tif (state.editorVisible) {\n\t\t\t\t\tthis.setEditorHidden(true);\n\t\t\t\t}\n\n\t\t\t\tthis.stateModel.setRuntimeValue(LayoutStateKeys.AUXILIARYBAR_LAST_NON_MAXIMIZED_VISIBILITY, state);\n\t\t\t} finally {\n\t\t\t\tthis.inMaximizedAuxiliaryBarTransition = false;\n\t\t\t}\n\t\t} else {\n\t\t\tconst state = assertReturnsDefined(this.stateModel.getRuntimeValue(LayoutStateKeys.AUXILIARYBAR_LAST_NON_MAXIMIZED_VISIBILITY));\n\t\t\tthis.stateModel.setRuntimeValue(LayoutStateKeys.AUXILIARYBAR_WAS_LAST_MAXIMIZED, false);\n\n\t\t\tthis.inMaximizedAuxiliaryBarTransition = true;\n\t\t\ttry {\n\t\t\t\tthis.setEditorHidden(!state?.editorVisible);\t// this order of updating view visibility\n\t\t\t\tthis.setPanelHidden(!state?.panelVisible);\t\t// helps in restoring the previous view\n\t\t\t\tthis.setSideBarHidden(!state?.sideBarVisible);\t// sizes we had\n\n\t\t\t\tconst size = this.workbenchGrid.getViewSize(this.auxiliaryBarPartView);\n\t\t\t\tthis.workbenchGrid.resizeView(this.auxiliaryBarPartView, {\n\t\t\t\t\twidth: this.stateModel.getRuntimeValue(LayoutStateKeys.AUXILIARYBAR_LAST_NON_MAXIMIZED_SIZE),\n\t\t\t\t\theight: size.height\n\t\t\t\t});\n\t\t\t} finally {\n\t\t\t\tthis.inMaximizedAuxiliaryBarTransition = false;\n\t\t\t}\n\t\t}\n\n\t\tthis.focusPart(Parts.AUXILIARYBAR_PART);\n\n\t\tthis._onDidChangeAuxiliaryBarMaximized.fire();\n\n\t\treturn true;\n\t}\n\n\tisPanelMaximized(): boolean {\n\t\treturn (\n\t\t\tthis.getPanelAlignment() === 'center' || \t// the workbench grid currently prevents us from supporting panel\n\t\t\t!isHorizontal(this.getPanelPosition())\t\t// maximization with non-center panel alignment\n\t\t) && !this.isVisible(Parts.EDITOR_PART, mainWindow) && !this.isAuxiliaryBarMaximized();\n\t}\n\n\ttoggleMaximizedPanel(): void {\n\t\tconst size = this.workbenchGrid.getViewSize(this.panelPartView);\n\t\tconst panelPosition = this.getPanelPosition();\n\t\tconst maximize = !this.isPanelMaximized();\n\t\tif (maximize) {\n\t\t\tif (this.isVisible(Parts.PANEL_PART)) {\n\t\t\t\tif (isHorizontal(panelPosition)) {\n\t\t\t\t\tthis.stateModel.setRuntimeValue(LayoutStateKeys.PANEL_LAST_NON_MAXIMIZED_HEIGHT, size.height);\n\t\t\t\t} else {\n\t\t\t\t\tthis.stateModel.setRuntimeValue(LayoutStateKeys.PANEL_LAST_NON_MAXIMIZED_WIDTH, size.width);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis.setEditorHidden(true);\n\t\t} else {\n\t\t\tthis.setEditorHidden(false);\n\n\t\t\tthis.workbenchGrid.resizeView(this.panelPartView, {\n\t\t\t\twidth: isHorizontal(panelPosition) ? size.width : this.stateModel.getRuntimeValue(LayoutStateKeys.PANEL_LAST_NON_MAXIMIZED_WIDTH),\n\t\t\t\theight: isHorizontal(panelPosition) ? this.stateModel.getRuntimeValue(LayoutStateKeys.PANEL_LAST_NON_MAXIMIZED_HEIGHT) : size.height\n\t\t\t});\n\t\t}\n\n\t\tthis.stateModel.setRuntimeValue(LayoutStateKeys.PANEL_WAS_LAST_MAXIMIZED, maximize);\n\t}\n\n\tprivate panelOpensMaximized(): boolean {\n\t\tif (this.getPanelAlignment() !== 'center' && isHorizontal(this.getPanelPosition())) {\n\t\t\treturn false; // The workbench grid currently prevents us from supporting panel maximization with non-center panel alignment\n\t\t}\n\n\t\tconst panelOpensMaximized = partOpensMaximizedFromString(this.configurationService.getValue<string>(WorkbenchLayoutSettings.PANEL_OPENS_MAXIMIZED));\n\t\tconst panelLastIsMaximized = this.stateModel.getRuntimeValue(LayoutStateKeys.PANEL_WAS_LAST_MAXIMIZED);\n\n\t\treturn panelOpensMaximized === PartOpensMaximizedOptions.ALWAYS || (panelOpensMaximized === PartOpensMaximizedOptions.REMEMBER_LAST && panelLastIsMaximized);\n\t}\n\n\tprivate setAuxiliaryBarHidden(hidden: boolean, skipLayout?: boolean): void {\n\t\tif (hidden && this.setAuxiliaryBarMaximized(false) && !this.isVisible(Parts.AUXILIARYBAR_PART)) {\n\t\t\treturn; // return: leaving maximised auxiliary bar made this part hidden\n\t\t}\n\n\t\tthis.stateModel.setRuntimeValue(LayoutStateKeys.AUXILIARYBAR_HIDDEN, hidden);\n\n\t\t// Adjust CSS\n\t\tif (hidden) {\n\t\t\tthis.mainContainer.classList.add(LayoutClasses.AUXILIARYBAR_HIDDEN);\n\t\t} else {\n\t\t\tthis.mainContainer.classList.remove(LayoutClasses.AUXILIARYBAR_HIDDEN);\n\t\t}\n\n\t\t// If auxiliary bar becomes hidden, also hide the current active pane composite if any\n\t\tif (hidden && this.paneCompositeService.getActivePaneComposite(ViewContainerLocation.AuxiliaryBar)) {\n\t\t\tthis.paneCompositeService.hideActivePaneComposite(ViewContainerLocation.AuxiliaryBar);\n\t\t\tthis.focusPanelOrEditor();\n\t\t}\n\n\t\t// If auxiliary bar becomes visible, show last active pane composite or default pane composite\n\t\telse if (!hidden && !this.paneCompositeService.getActivePaneComposite(ViewContainerLocation.AuxiliaryBar)) {\n\t\t\tlet viewletToOpen: string | undefined = this.paneCompositeService.getLastActivePaneCompositeId(ViewContainerLocation.AuxiliaryBar);\n\n\t\t\t// verify that the viewlet we try to open has views before we default to it\n\t\t\t// otherwise fall back to any view that has views still refs #111463\n\t\t\tif (!viewletToOpen || !this.hasViews(viewletToOpen)) {\n\t\t\t\tviewletToOpen = this.viewDescriptorService\n\t\t\t\t\t.getViewContainersByLocation(ViewContainerLocation.AuxiliaryBar)\n\t\t\t\t\t.find(viewContainer => this.hasViews(viewContainer.id))?.id;\n\t\t\t}\n\n\t\t\tif (viewletToOpen) {\n\t\t\t\tthis.openViewContainer(ViewContainerLocation.AuxiliaryBar, viewletToOpen, !skipLayout);\n\t\t\t}\n\t\t}\n\n\t\t// Propagate to grid\n\t\tthis.workbenchGrid.setViewVisible(this.auxiliaryBarPartView, !hidden);\n\t}\n\n\tsetPartHidden(hidden: boolean, part: Parts): void {\n\t\tswitch (part) {\n\t\t\tcase Parts.ACTIVITYBAR_PART:\n\t\t\t\treturn this.setActivityBarHidden(hidden);\n\t\t\tcase Parts.SIDEBAR_PART:\n\t\t\t\treturn this.setSideBarHidden(hidden);\n\t\t\tcase Parts.EDITOR_PART:\n\t\t\t\treturn this.setEditorHidden(hidden);\n\t\t\tcase Parts.BANNER_PART:\n\t\t\t\treturn this.setBannerHidden(hidden);\n\t\t\tcase Parts.AUXILIARYBAR_PART:\n\t\t\t\treturn this.setAuxiliaryBarHidden(hidden);\n\t\t\tcase Parts.PANEL_PART:\n\t\t\t\treturn this.setPanelHidden(hidden);\n\t\t}\n\t}\n\n\thasMainWindowBorder(): boolean {\n\t\treturn this.state.runtime.mainWindowBorder;\n\t}\n\n\tgetMainWindowBorderRadius(): string | undefined {\n\t\treturn this.state.runtime.mainWindowBorder && isMacintosh ? '10px' : undefined;\n\t}\n\n\tgetSideBarPosition(): Position {\n\t\treturn this.stateModel.getRuntimeValue(LayoutStateKeys.SIDEBAR_POSITON);\n\t}\n\n\tgetPanelAlignment(): PanelAlignment {\n\t\treturn this.stateModel.getRuntimeValue(LayoutStateKeys.PANEL_ALIGNMENT);\n\t}\n\n\tupdateMenubarVisibility(skipLayout: boolean): void {\n\t\tconst shouldShowTitleBar = shouldShowCustomTitleBar(this.configurationService, mainWindow, this.state.runtime.menuBar.toggled);\n\t\tif (!skipLayout && this.workbenchGrid && shouldShowTitleBar !== this.isVisible(Parts.TITLEBAR_PART, mainWindow)) {\n\t\t\tthis.workbenchGrid.setViewVisible(this.titleBarPartView, shouldShowTitleBar);\n\t\t}\n\t}\n\n\tupdateCustomTitleBarVisibility(): void {\n\t\tconst shouldShowTitleBar = shouldShowCustomTitleBar(this.configurationService, mainWindow, this.state.runtime.menuBar.toggled);\n\t\tconst titlebarVisible = this.isVisible(Parts.TITLEBAR_PART);\n\t\tif (shouldShowTitleBar !== titlebarVisible) {\n\t\t\tthis.workbenchGrid.setViewVisible(this.titleBarPartView, shouldShowTitleBar);\n\t\t}\n\t}\n\n\ttoggleMenuBar(): void {\n\t\tlet currentVisibilityValue = getMenuBarVisibility(this.configurationService);\n\t\tif (typeof currentVisibilityValue !== 'string') {\n\t\t\tcurrentVisibilityValue = 'classic';\n\t\t}\n\n\t\tlet newVisibilityValue: string;\n\t\tif (currentVisibilityValue === 'visible' || currentVisibilityValue === 'classic') {\n\t\t\tnewVisibilityValue = hasNativeMenu(this.configurationService) ? 'toggle' : 'compact';\n\t\t} else {\n\t\t\tnewVisibilityValue = 'classic';\n\t\t}\n\n\t\tthis.configurationService.updateValue(MenuSettings.MenuBarVisibility, newVisibilityValue);\n\t}\n\n\tgetPanelPosition(): Position {\n\t\treturn this.stateModel.getRuntimeValue(LayoutStateKeys.PANEL_POSITION);\n\t}\n\n\tsetPanelPosition(position: Position): void {\n\t\tif (!this.isVisible(Parts.PANEL_PART)) {\n\t\t\tthis.setPanelHidden(false);\n\t\t}\n\n\t\tconst panelPart = this.getPart(Parts.PANEL_PART);\n\t\tconst oldPositionValue = positionToString(this.getPanelPosition());\n\t\tconst newPositionValue = positionToString(position);\n\n\t\t// Adjust CSS\n\t\tconst panelContainer = assertReturnsDefined(panelPart.getContainer());\n\t\tpanelContainer.classList.remove(oldPositionValue);\n\t\tpanelContainer.classList.add(newPositionValue);\n\n\t\t// Update Styles\n\t\tpanelPart.updateStyles();\n\n\t\t// Layout\n\t\tconst size = this.workbenchGrid.getViewSize(this.panelPartView);\n\t\tconst sideBarSize = this.workbenchGrid.getViewSize(this.sideBarPartView);\n\t\tconst auxiliaryBarSize = this.workbenchGrid.getViewSize(this.auxiliaryBarPartView);\n\n\t\tlet editorHidden = !this.isVisible(Parts.EDITOR_PART, mainWindow);\n\n\t\t// Save last non-maximized size for panel before move\n\t\tif (newPositionValue !== oldPositionValue && !editorHidden) {\n\n\t\t\t// Save the current size of the panel for the new orthogonal direction\n\t\t\t// If moving down, save the width of the panel\n\t\t\t// Otherwise, save the height of the panel\n\t\t\tif (isHorizontal(position)) {\n\t\t\t\tthis.stateModel.setRuntimeValue(LayoutStateKeys.PANEL_LAST_NON_MAXIMIZED_WIDTH, size.width);\n\t\t\t} else if (isHorizontal(positionFromString(oldPositionValue))) {\n\t\t\t\tthis.stateModel.setRuntimeValue(LayoutStateKeys.PANEL_LAST_NON_MAXIMIZED_HEIGHT, size.height);\n\t\t\t}\n\t\t}\n\n\t\tif (isHorizontal(position) && this.getPanelAlignment() !== 'center' && editorHidden) {\n\t\t\tthis.toggleMaximizedPanel();\n\t\t\teditorHidden = false;\n\t\t}\n\n\t\tthis.stateModel.setRuntimeValue(LayoutStateKeys.PANEL_POSITION, position);\n\n\t\tconst sideBarVisible = this.isVisible(Parts.SIDEBAR_PART);\n\t\tconst auxiliaryBarVisible = this.isVisible(Parts.AUXILIARYBAR_PART);\n\n\t\tconst hadFocus = this.hasFocus(Parts.PANEL_PART);\n\n\t\tif (position === Position.BOTTOM) {\n\t\t\tthis.workbenchGrid.moveView(this.panelPartView, editorHidden ? size.height : this.stateModel.getRuntimeValue(LayoutStateKeys.PANEL_LAST_NON_MAXIMIZED_HEIGHT), this.editorPartView, Direction.Down);\n\t\t} else if (position === Position.TOP) {\n\t\t\tthis.workbenchGrid.moveView(this.panelPartView, editorHidden ? size.height : this.stateModel.getRuntimeValue(LayoutStateKeys.PANEL_LAST_NON_MAXIMIZED_HEIGHT), this.editorPartView, Direction.Up);\n\t\t} else if (position === Position.RIGHT) {\n\t\t\tthis.workbenchGrid.moveView(this.panelPartView, editorHidden ? size.width : this.stateModel.getRuntimeValue(LayoutStateKeys.PANEL_LAST_NON_MAXIMIZED_WIDTH), this.editorPartView, Direction.Right);\n\t\t} else {\n\t\t\tthis.workbenchGrid.moveView(this.panelPartView, editorHidden ? size.width : this.stateModel.getRuntimeValue(LayoutStateKeys.PANEL_LAST_NON_MAXIMIZED_WIDTH), this.editorPartView, Direction.Left);\n\t\t}\n\n\t\tif (hadFocus) {\n\t\t\tthis.focusPart(Parts.PANEL_PART);\n\t\t}\n\n\t\t// Reset sidebar to original size before shifting the panel\n\t\tthis.workbenchGrid.resizeView(this.sideBarPartView, sideBarSize);\n\t\tif (!sideBarVisible) {\n\t\t\tthis.setSideBarHidden(true);\n\t\t}\n\n\t\tthis.workbenchGrid.resizeView(this.auxiliaryBarPartView, auxiliaryBarSize);\n\t\tif (!auxiliaryBarVisible) {\n\t\t\tthis.setAuxiliaryBarHidden(true);\n\t\t}\n\n\t\tif (isHorizontal(position)) {\n\t\t\tthis.adjustPartPositions(this.getSideBarPosition(), this.getPanelAlignment(), position);\n\t\t}\n\n\t\tthis._onDidChangePanelPosition.fire(newPositionValue);\n\t}\n\n\tisWindowMaximized(targetWindow: Window): boolean {\n\t\treturn this.state.runtime.maximized.has(getWindowId(targetWindow));\n\t}\n\n\tupdateWindowMaximizedState(targetWindow: Window, maximized: boolean) {\n\t\tthis.mainContainer.classList.toggle(LayoutClasses.MAXIMIZED, maximized);\n\n\t\tconst targetWindowId = getWindowId(targetWindow);\n\t\tif (maximized === this.state.runtime.maximized.has(targetWindowId)) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (maximized) {\n\t\t\tthis.state.runtime.maximized.add(targetWindowId);\n\t\t} else {\n\t\t\tthis.state.runtime.maximized.delete(targetWindowId);\n\t\t}\n\n\t\tthis.updateWindowBorder();\n\t\tthis._onDidChangeWindowMaximized.fire({ windowId: targetWindowId, maximized });\n\t}\n\n\tgetVisibleNeighborPart(part: Parts, direction: Direction): Parts | undefined {\n\t\tif (!this.workbenchGrid) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\tif (!this.isVisible(part, mainWindow)) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\tconst neighborViews = this.workbenchGrid.getNeighborViews(this.getPart(part), direction, false);\n\n\t\tif (!neighborViews) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\tfor (const neighborView of neighborViews) {\n\t\t\tconst neighborPart =\n\t\t\t\t[Parts.ACTIVITYBAR_PART, Parts.EDITOR_PART, Parts.PANEL_PART, Parts.AUXILIARYBAR_PART, Parts.SIDEBAR_PART, Parts.STATUSBAR_PART, Parts.TITLEBAR_PART]\n\t\t\t\t\t.find(partId => this.getPart(partId) === neighborView && this.isVisible(partId, mainWindow));\n\n\t\t\tif (neighborPart !== undefined) {\n\t\t\t\treturn neighborPart;\n\t\t\t}\n\t\t}\n\n\t\treturn undefined;\n\t}\n\n\tprivate onDidChangeWCO(): void {\n\t\tconst bannerFirst = this.workbenchGrid.getNeighborViews(this.titleBarPartView, Direction.Up, false).length > 0;\n\t\tconst shouldBannerBeFirst = this.shouldShowBannerFirst();\n\n\t\tif (bannerFirst !== shouldBannerBeFirst) {\n\t\t\tthis.workbenchGrid.moveView(this.bannerPartView, Sizing.Distribute, this.titleBarPartView, shouldBannerBeFirst ? Direction.Up : Direction.Down);\n\t\t}\n\n\t\tthis.workbenchGrid.setViewVisible(this.titleBarPartView, shouldShowCustomTitleBar(this.configurationService, mainWindow, this.state.runtime.menuBar.toggled));\n\t}\n\n\tprivate arrangeEditorNodes(nodes: { editor: ISerializedNode; sideBar?: ISerializedNode; auxiliaryBar?: ISerializedNode }, availableHeight: number, availableWidth: number): ISerializedNode {\n\t\tif (!nodes.sideBar && !nodes.auxiliaryBar) {\n\t\t\tnodes.editor.size = availableHeight;\n\t\t\treturn nodes.editor;\n\t\t}\n\n\t\tconst result = [nodes.editor];\n\t\tnodes.editor.size = availableWidth;\n\t\tif (nodes.sideBar) {\n\t\t\tif (this.stateModel.getRuntimeValue(LayoutStateKeys.SIDEBAR_POSITON) === Position.LEFT) {\n\t\t\t\tresult.splice(0, 0, nodes.sideBar);\n\t\t\t} else {\n\t\t\t\tresult.push(nodes.sideBar);\n\t\t\t}\n\n\t\t\tnodes.editor.size -= this.stateModel.getRuntimeValue(LayoutStateKeys.SIDEBAR_HIDDEN) ? 0 : nodes.sideBar.size;\n\t\t}\n\n\t\tif (nodes.auxiliaryBar) {\n\t\t\tif (this.stateModel.getRuntimeValue(LayoutStateKeys.SIDEBAR_POSITON) === Position.RIGHT) {\n\t\t\t\tresult.splice(0, 0, nodes.auxiliaryBar);\n\t\t\t} else {\n\t\t\t\tresult.push(nodes.auxiliaryBar);\n\t\t\t}\n\n\t\t\tnodes.editor.size -= this.stateModel.getRuntimeValue(LayoutStateKeys.AUXILIARYBAR_HIDDEN) ? 0 : nodes.auxiliaryBar.size;\n\t\t}\n\n\t\treturn {\n\t\t\ttype: 'branch',\n\t\t\tdata: result,\n\t\t\tsize: availableHeight,\n\t\t\tvisible: result.some(node => node.visible)\n\t\t};\n\t}\n\n\tprivate arrangeMiddleSectionNodes(nodes: { editor: ISerializedNode; panel: ISerializedNode; activityBar: ISerializedNode; sideBar: ISerializedNode; auxiliaryBar: ISerializedNode }, availableWidth: number, availableHeight: number): ISerializedNode[] {\n\t\tconst activityBarSize = this.stateModel.getRuntimeValue(LayoutStateKeys.ACTIVITYBAR_HIDDEN) ? 0 : nodes.activityBar.size;\n\t\tconst sideBarSize = this.stateModel.getRuntimeValue(LayoutStateKeys.SIDEBAR_HIDDEN) ? 0 : nodes.sideBar.size;\n\t\tconst auxiliaryBarSize = this.stateModel.getRuntimeValue(LayoutStateKeys.AUXILIARYBAR_HIDDEN) ? 0 : nodes.auxiliaryBar.size;\n\t\tconst panelSize = this.stateModel.getInitializationValue(LayoutStateKeys.PANEL_SIZE) ? 0 : nodes.panel.size;\n\n\t\tconst panelPostion = this.stateModel.getRuntimeValue(LayoutStateKeys.PANEL_POSITION);\n\t\tconst sideBarPosition = this.stateModel.getRuntimeValue(LayoutStateKeys.SIDEBAR_POSITON);\n\n\t\tconst result = [] as ISerializedNode[];\n\t\tif (!isHorizontal(panelPostion)) {\n\t\t\tresult.push(nodes.editor);\n\t\t\tnodes.editor.size = availableWidth - activityBarSize - sideBarSize - panelSize - auxiliaryBarSize;\n\t\t\tif (panelPostion === Position.RIGHT) {\n\t\t\t\tresult.push(nodes.panel);\n\t\t\t} else {\n\t\t\t\tresult.splice(0, 0, nodes.panel);\n\t\t\t}\n\n\t\t\tif (sideBarPosition === Position.LEFT) {\n\t\t\t\tresult.push(nodes.auxiliaryBar);\n\t\t\t\tresult.splice(0, 0, nodes.sideBar);\n\t\t\t\tresult.splice(0, 0, nodes.activityBar);\n\t\t\t} else {\n\t\t\t\tresult.splice(0, 0, nodes.auxiliaryBar);\n\t\t\t\tresult.push(nodes.sideBar);\n\t\t\t\tresult.push(nodes.activityBar);\n\t\t\t}\n\t\t} else {\n\t\t\tconst panelAlignment = this.stateModel.getRuntimeValue(LayoutStateKeys.PANEL_ALIGNMENT);\n\t\t\tconst sideBarNextToEditor = !(panelAlignment === 'center' || (sideBarPosition === Position.LEFT && panelAlignment === 'right') || (sideBarPosition === Position.RIGHT && panelAlignment === 'left'));\n\t\t\tconst auxiliaryBarNextToEditor = !(panelAlignment === 'center' || (sideBarPosition === Position.RIGHT && panelAlignment === 'right') || (sideBarPosition === Position.LEFT && panelAlignment === 'left'));\n\n\t\t\tconst editorSectionWidth = availableWidth - activityBarSize - (sideBarNextToEditor ? 0 : sideBarSize) - (auxiliaryBarNextToEditor ? 0 : auxiliaryBarSize);\n\n\t\t\tconst editorNodes = this.arrangeEditorNodes({\n\t\t\t\teditor: nodes.editor,\n\t\t\t\tsideBar: sideBarNextToEditor ? nodes.sideBar : undefined,\n\t\t\t\tauxiliaryBar: auxiliaryBarNextToEditor ? nodes.auxiliaryBar : undefined\n\t\t\t}, availableHeight - panelSize, editorSectionWidth);\n\n\t\t\tconst data = panelPostion === Position.BOTTOM ? [editorNodes, nodes.panel] : [nodes.panel, editorNodes];\n\t\t\tresult.push({\n\t\t\t\ttype: 'branch',\n\t\t\t\tdata,\n\t\t\t\tsize: editorSectionWidth,\n\t\t\t\tvisible: data.some(node => node.visible)\n\t\t\t});\n\n\t\t\tif (!sideBarNextToEditor) {\n\t\t\t\tif (sideBarPosition === Position.LEFT) {\n\t\t\t\t\tresult.splice(0, 0, nodes.sideBar);\n\t\t\t\t} else {\n\t\t\t\t\tresult.push(nodes.sideBar);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (!auxiliaryBarNextToEditor) {\n\t\t\t\tif (sideBarPosition === Position.RIGHT) {\n\t\t\t\t\tresult.splice(0, 0, nodes.auxiliaryBar);\n\t\t\t\t} else {\n\t\t\t\t\tresult.push(nodes.auxiliaryBar);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (sideBarPosition === Position.LEFT) {\n\t\t\t\tresult.splice(0, 0, nodes.activityBar);\n\t\t\t} else {\n\t\t\t\tresult.push(nodes.activityBar);\n\t\t\t}\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tprivate createGridDescriptor(): ISerializedGrid {\n\t\tconst { width, height } = this._mainContainerDimension;\n\t\tconst sideBarSize = this.stateModel.getInitializationValue(LayoutStateKeys.SIDEBAR_SIZE);\n\t\tconst auxiliaryBarSize = this.stateModel.getInitializationValue(LayoutStateKeys.AUXILIARYBAR_SIZE);\n\t\tconst panelSize = this.stateModel.getInitializationValue(LayoutStateKeys.PANEL_SIZE);\n\n\t\tconst titleBarHeight = this.titleBarPartView.minimumHeight;\n\t\tconst bannerHeight = this.bannerPartView.minimumHeight;\n\t\tconst statusBarHeight = this.statusBarPartView.minimumHeight;\n\t\tconst activityBarWidth = this.activityBarPartView.minimumWidth;\n\t\tconst middleSectionHeight = height - titleBarHeight - statusBarHeight;\n\n\t\tconst titleAndBanner: ISerializedNode[] = [\n\t\t\t{\n\t\t\t\ttype: 'leaf',\n\t\t\t\tdata: { type: Parts.TITLEBAR_PART },\n\t\t\t\tsize: titleBarHeight,\n\t\t\t\tvisible: this.isVisible(Parts.TITLEBAR_PART, mainWindow)\n\t\t\t},\n\t\t\t{\n\t\t\t\ttype: 'leaf',\n\t\t\t\tdata: { type: Parts.BANNER_PART },\n\t\t\t\tsize: bannerHeight,\n\t\t\t\tvisible: false\n\t\t\t}\n\t\t];\n\n\t\tconst activityBarNode: ISerializedLeafNode = {\n\t\t\ttype: 'leaf',\n\t\t\tdata: { type: Parts.ACTIVITYBAR_PART },\n\t\t\tsize: activityBarWidth,\n\t\t\tvisible: !this.stateModel.getRuntimeValue(LayoutStateKeys.ACTIVITYBAR_HIDDEN)\n\t\t};\n\n\t\tconst sideBarNode: ISerializedLeafNode = {\n\t\t\ttype: 'leaf',\n\t\t\tdata: { type: Parts.SIDEBAR_PART },\n\t\t\tsize: sideBarSize,\n\t\t\tvisible: !this.stateModel.getRuntimeValue(LayoutStateKeys.SIDEBAR_HIDDEN)\n\t\t};\n\n\t\tconst auxiliaryBarNode: ISerializedLeafNode = {\n\t\t\ttype: 'leaf',\n\t\t\tdata: { type: Parts.AUXILIARYBAR_PART },\n\t\t\tsize: auxiliaryBarSize,\n\t\t\tvisible: this.isVisible(Parts.AUXILIARYBAR_PART)\n\t\t};\n\n\t\tconst editorNode: ISerializedLeafNode = {\n\t\t\ttype: 'leaf',\n\t\t\tdata: { type: Parts.EDITOR_PART },\n\t\t\tsize: 0, // Update based on sibling sizes\n\t\t\tvisible: !this.stateModel.getRuntimeValue(LayoutStateKeys.EDITOR_HIDDEN)\n\t\t};\n\n\t\tconst panelNode: ISerializedLeafNode = {\n\t\t\ttype: 'leaf',\n\t\t\tdata: { type: Parts.PANEL_PART },\n\t\t\tsize: panelSize,\n\t\t\tvisible: !this.stateModel.getRuntimeValue(LayoutStateKeys.PANEL_HIDDEN)\n\t\t};\n\n\t\tconst middleSection: ISerializedNode[] = this.arrangeMiddleSectionNodes({\n\t\t\tactivityBar: activityBarNode,\n\t\t\tauxiliaryBar: auxiliaryBarNode,\n\t\t\teditor: editorNode,\n\t\t\tpanel: panelNode,\n\t\t\tsideBar: sideBarNode\n\t\t}, width, middleSectionHeight);\n\n\t\tconst result: ISerializedGrid = {\n\t\t\troot: {\n\t\t\t\ttype: 'branch',\n\t\t\t\tsize: width,\n\t\t\t\tdata: [\n\t\t\t\t\t...(this.shouldShowBannerFirst() ? titleAndBanner.reverse() : titleAndBanner),\n\t\t\t\t\t{\n\t\t\t\t\t\ttype: 'branch',\n\t\t\t\t\t\tdata: middleSection,\n\t\t\t\t\t\tsize: middleSectionHeight\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\ttype: 'leaf',\n\t\t\t\t\t\tdata: { type: Parts.STATUSBAR_PART },\n\t\t\t\t\t\tsize: statusBarHeight,\n\t\t\t\t\t\tvisible: !this.stateModel.getRuntimeValue(LayoutStateKeys.STATUSBAR_HIDDEN)\n\t\t\t\t\t}\n\t\t\t\t]\n\t\t\t},\n\t\t\torientation: Orientation.VERTICAL,\n\t\t\twidth,\n\t\t\theight\n\t\t};\n\n\t\ttype StartupLayoutEvent = {\n\t\t\tactivityBarVisible: boolean;\n\t\t\tsideBarVisible: boolean;\n\t\t\tauxiliaryBarVisible: boolean;\n\t\t\tpanelVisible: boolean;\n\t\t\tstatusbarVisible: boolean;\n\t\t\tsideBarPosition: string;\n\t\t\tpanelPosition: string;\n\t\t};\n\n\t\ttype StartupLayoutEventClassification = {\n\t\t\towner: 'benibenj';\n\t\t\tcomment: 'Information about the layout of the workbench during statup';\n\t\t\tactivityBarVisible: { classification: 'SystemMetaData'; purpose: 'FeatureInsight'; comment: 'Whether or the not the activity bar is visible' };\n\t\t\tsideBarVisible: { classification: 'SystemMetaData'; purpose: 'FeatureInsight'; comment: 'Whether or the not the primary side bar is visible' };\n\t\t\tauxiliaryBarVisible: { classification: 'SystemMetaData'; purpose: 'FeatureInsight'; comment: 'Whether or the not the secondary side bar is visible' };\n\t\t\tpanelVisible: { classification: 'SystemMetaData'; purpose: 'FeatureInsight'; comment: 'Whether or the not the panel is visible' };\n\t\t\tstatusbarVisible: { classification: 'SystemMetaData'; purpose: 'FeatureInsight'; comment: 'Whether or the not the status bar is visible' };\n\t\t\tsideBarPosition: { classification: 'SystemMetaData'; purpose: 'FeatureInsight'; comment: 'Whether the primary side bar is on the left or right' };\n\t\t\tpanelPosition: { classification: 'SystemMetaData'; purpose: 'FeatureInsight'; comment: 'Whether the panel is on the top, bottom, left, or right' };\n\t\t};\n\n\t\tconst layoutDescriptor: StartupLayoutEvent = {\n\t\t\tactivityBarVisible: !this.stateModel.getRuntimeValue(LayoutStateKeys.ACTIVITYBAR_HIDDEN),\n\t\t\tsideBarVisible: !this.stateModel.getRuntimeValue(LayoutStateKeys.SIDEBAR_HIDDEN),\n\t\t\tauxiliaryBarVisible: !this.stateModel.getRuntimeValue(LayoutStateKeys.AUXILIARYBAR_HIDDEN),\n\t\t\tpanelVisible: !this.stateModel.getRuntimeValue(LayoutStateKeys.PANEL_HIDDEN),\n\t\t\tstatusbarVisible: !this.stateModel.getRuntimeValue(LayoutStateKeys.STATUSBAR_HIDDEN),\n\t\t\tsideBarPosition: positionToString(this.stateModel.getRuntimeValue(LayoutStateKeys.SIDEBAR_POSITON)),\n\t\t\tpanelPosition: positionToString(this.stateModel.getRuntimeValue(LayoutStateKeys.PANEL_POSITION)),\n\t\t};\n\n\t\tthis.telemetryService.publicLog2<StartupLayoutEvent, StartupLayoutEventClassification>('startupLayout', layoutDescriptor);\n\n\t\treturn result;\n\t}\n\n\toverride dispose(): void {\n\t\tsuper.dispose();\n\n\t\tthis.disposed = true;\n\t}\n}\n\ntype ZenModeConfiguration = {\n\tcenterLayout: boolean;\n\tfullScreen: boolean;\n\thideActivityBar: boolean;\n\thideLineNumbers: boolean;\n\thideStatusBar: boolean;\n\tshowTabs: 'multiple' | 'single' | 'none';\n\trestore: boolean;\n\tsilentNotifications: boolean;\n};\n\nfunction getZenModeConfiguration(configurationService: IConfigurationService): ZenModeConfiguration {\n\treturn configurationService.getValue<ZenModeConfiguration>(WorkbenchLayoutSettings.ZEN_MODE_CONFIG);\n}\n\n//#endregion\n\n//#region Layout State Model\n\ninterface IWorkbenchLayoutStateKey {\n\treadonly name: string;\n\treadonly runtime: boolean;\n\treadonly defaultValue: unknown;\n\treadonly scope: StorageScope;\n\treadonly target: StorageTarget;\n\treadonly zenModeIgnore?: boolean;\n}\n\ntype StorageKeyType = string | boolean | number | object;\n\nabstract class WorkbenchLayoutStateKey<T extends StorageKeyType> implements IWorkbenchLayoutStateKey {\n\n\tabstract readonly runtime: boolean;\n\n\tconstructor(readonly name: string, readonly scope: StorageScope, readonly target: StorageTarget, public defaultValue: T) { }\n}\n\nclass RuntimeStateKey<T extends StorageKeyType> extends WorkbenchLayoutStateKey<T> {\n\n\treadonly runtime = true;\n\n\tconstructor(name: string, scope: StorageScope, target: StorageTarget, defaultValue: T, readonly zenModeIgnore?: boolean) {\n\t\tsuper(name, scope, target, defaultValue);\n\t}\n}\n\nclass InitializationStateKey<T extends StorageKeyType> extends WorkbenchLayoutStateKey<T> {\n\treadonly runtime = false;\n}\n\nconst LayoutStateKeys = {\n\n\t// Editor\n\tMAIN_EDITOR_CENTERED: new RuntimeStateKey<boolean>('editor.centered', StorageScope.WORKSPACE, StorageTarget.MACHINE, false),\n\n\t// Zen Mode\n\tZEN_MODE_ACTIVE: new RuntimeStateKey<boolean>('zenMode.active', StorageScope.WORKSPACE, StorageTarget.MACHINE, false),\n\tZEN_MODE_EXIT_INFO: new RuntimeStateKey('zenMode.exitInfo', StorageScope.WORKSPACE, StorageTarget.MACHINE, {\n\t\ttransitionedToCenteredEditorLayout: false,\n\t\ttransitionedToFullScreen: false,\n\t\thandleNotificationsDoNotDisturbMode: false,\n\t\twasVisible: {\n\t\t\tauxiliaryBar: false,\n\t\t\tpanel: false,\n\t\t\tsideBar: false,\n\t\t},\n\t}),\n\n\t// Part Sizing\n\tSIDEBAR_SIZE: new InitializationStateKey<number>('sideBar.size', StorageScope.PROFILE, StorageTarget.MACHINE, 300),\n\tAUXILIARYBAR_SIZE: new InitializationStateKey<number>('auxiliaryBar.size', StorageScope.PROFILE, StorageTarget.MACHINE, 300),\n\tPANEL_SIZE: new InitializationStateKey<number>('panel.size', StorageScope.PROFILE, StorageTarget.MACHINE, 300),\n\n\t// Part State\n\tPANEL_LAST_NON_MAXIMIZED_HEIGHT: new RuntimeStateKey<number>('panel.lastNonMaximizedHeight', StorageScope.PROFILE, StorageTarget.MACHINE, 300),\n\tPANEL_LAST_NON_MAXIMIZED_WIDTH: new RuntimeStateKey<number>('panel.lastNonMaximizedWidth', StorageScope.PROFILE, StorageTarget.MACHINE, 300),\n\tPANEL_WAS_LAST_MAXIMIZED: new RuntimeStateKey<boolean>('panel.wasLastMaximized', StorageScope.WORKSPACE, StorageTarget.MACHINE, false),\n\n\tAUXILIARYBAR_WAS_LAST_MAXIMIZED: new RuntimeStateKey<boolean>('auxiliaryBar.wasLastMaximized', StorageScope.WORKSPACE, StorageTarget.MACHINE, false),\n\tAUXILIARYBAR_LAST_NON_MAXIMIZED_SIZE: new RuntimeStateKey<number>('auxiliaryBar.lastNonMaximizedSize', StorageScope.PROFILE, StorageTarget.MACHINE, 300),\n\tAUXILIARYBAR_LAST_NON_MAXIMIZED_VISIBILITY: new RuntimeStateKey('auxiliaryBar.lastNonMaximizedVisibility', StorageScope.WORKSPACE, StorageTarget.MACHINE, {\n\t\tsideBarVisible: false,\n\t\teditorVisible: false,\n\t\tpanelVisible: false,\n\t\tauxiliaryBarVisible: false\n\t}),\n\tAUXILIARYBAR_EMPTY: new InitializationStateKey<boolean>('auxiliaryBar.empty', StorageScope.PROFILE, StorageTarget.MACHINE, false),\n\n\t// Part Positions\n\tSIDEBAR_POSITON: new RuntimeStateKey<Position>('sideBar.position', StorageScope.WORKSPACE, StorageTarget.MACHINE, Position.LEFT),\n\tPANEL_POSITION: new RuntimeStateKey<Position>('panel.position', StorageScope.WORKSPACE, StorageTarget.MACHINE, Position.BOTTOM),\n\tPANEL_ALIGNMENT: new RuntimeStateKey<PanelAlignment>('panel.alignment', StorageScope.PROFILE, StorageTarget.USER, 'center'),\n\n\t// Part Visibility\n\tACTIVITYBAR_HIDDEN: new RuntimeStateKey<boolean>('activityBar.hidden', StorageScope.WORKSPACE, StorageTarget.MACHINE, false, true),\n\tSIDEBAR_HIDDEN: new RuntimeStateKey<boolean>('sideBar.hidden', StorageScope.WORKSPACE, StorageTarget.MACHINE, false),\n\tEDITOR_HIDDEN: new RuntimeStateKey<boolean>('editor.hidden', StorageScope.WORKSPACE, StorageTarget.MACHINE, false),\n\tPANEL_HIDDEN: new RuntimeStateKey<boolean>('panel.hidden', StorageScope.WORKSPACE, StorageTarget.MACHINE, true),\n\tAUXILIARYBAR_HIDDEN: new RuntimeStateKey<boolean>('auxiliaryBar.hidden', StorageScope.WORKSPACE, StorageTarget.MACHINE, true),\n\tSTATUSBAR_HIDDEN: new RuntimeStateKey<boolean>('statusBar.hidden', StorageScope.WORKSPACE, StorageTarget.MACHINE, false, true)\n\n} as const;\n\ninterface ILayoutStateChangeEvent<T extends StorageKeyType> {\n\treadonly key: RuntimeStateKey<T>;\n\treadonly value: T;\n}\n\nenum WorkbenchLayoutSettings {\n\tAUXILIARYBAR_DEFAULT_VISIBILITY = 'workbench.secondarySideBar.defaultVisibility',\n\tACTIVITY_BAR_VISIBLE = 'workbench.activityBar.visible',\n\tPANEL_POSITION = 'workbench.panel.defaultLocation',\n\tPANEL_OPENS_MAXIMIZED = 'workbench.panel.opensMaximized',\n\tZEN_MODE_CONFIG = 'zenMode',\n\tEDITOR_CENTERED_LAYOUT_AUTO_RESIZE = 'workbench.editor.centeredLayoutAutoResize',\n}\n\nenum LegacyWorkbenchLayoutSettings {\n\tSTATUSBAR_VISIBLE = 'workbench.statusBar.visible', \t// Deprecated to UI State\n\tSIDEBAR_POSITION = 'workbench.sideBar.location', \t// Deprecated to UI State\n}\n\ninterface ILayoutStateLoadConfiguration {\n\treadonly mainContainerDimension: IDimension;\n\treadonly resetLayout: boolean;\n}\n\nclass LayoutStateModel extends Disposable {\n\n\tstatic readonly STORAGE_PREFIX = 'workbench.';\n\n\tprivate readonly _onDidChangeState = this._register(new Emitter<ILayoutStateChangeEvent<StorageKeyType>>());\n\treadonly onDidChangeState = this._onDidChangeState.event;\n\n\tprivate readonly stateCache = new Map<string, unknown>();\n\n\tprivate readonly isNew: {\n\t\t[StorageScope.WORKSPACE]: boolean;\n\t\t[StorageScope.PROFILE]: boolean;\n\t\t[StorageScope.APPLICATION]: boolean;\n\t};\n\n\tconstructor(\n\t\tprivate readonly storageService: IStorageService,\n\t\tprivate readonly configurationService: IConfigurationService,\n\t\tprivate readonly contextService: IWorkspaceContextService,\n\t\tprivate readonly environmentService: IBrowserWorkbenchEnvironmentService,\n\t) {\n\t\tsuper();\n\n\t\tthis.isNew = {\n\t\t\t[StorageScope.WORKSPACE]: this.storageService.isNew(StorageScope.WORKSPACE),\n\t\t\t[StorageScope.PROFILE]: this.storageService.isNew(StorageScope.PROFILE),\n\t\t\t[StorageScope.APPLICATION]: this.storageService.isNew(StorageScope.APPLICATION)\n\t\t};\n\n\t\tthis._register(this.configurationService.onDidChangeConfiguration(configurationChange => this.updateStateFromLegacySettings(configurationChange)));\n\t}\n\n\tprivate updateStateFromLegacySettings(configurationChangeEvent: IConfigurationChangeEvent): void {\n\t\tif (configurationChangeEvent.affectsConfiguration(LayoutSettings.ACTIVITY_BAR_LOCATION)) {\n\t\t\tthis.setRuntimeValueAndFire(LayoutStateKeys.ACTIVITYBAR_HIDDEN, this.isActivityBarHidden());\n\t\t}\n\n\t\tif (configurationChangeEvent.affectsConfiguration(LegacyWorkbenchLayoutSettings.STATUSBAR_VISIBLE)) {\n\t\t\tthis.setRuntimeValueAndFire(LayoutStateKeys.STATUSBAR_HIDDEN, !this.configurationService.getValue(LegacyWorkbenchLayoutSettings.STATUSBAR_VISIBLE));\n\t\t}\n\n\t\tif (configurationChangeEvent.affectsConfiguration(LegacyWorkbenchLayoutSettings.SIDEBAR_POSITION)) {\n\t\t\tthis.setRuntimeValueAndFire(LayoutStateKeys.SIDEBAR_POSITON, positionFromString(this.configurationService.getValue(LegacyWorkbenchLayoutSettings.SIDEBAR_POSITION) ?? 'left'));\n\t\t}\n\t}\n\n\tprivate updateLegacySettingsFromState<T extends StorageKeyType>(key: RuntimeStateKey<T>, value: T): void {\n\t\tconst isZenMode = this.getRuntimeValue(LayoutStateKeys.ZEN_MODE_ACTIVE);\n\t\tif (key.zenModeIgnore && isZenMode) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (key === LayoutStateKeys.ACTIVITYBAR_HIDDEN) {\n\t\t\tthis.configurationService.updateValue(LayoutSettings.ACTIVITY_BAR_LOCATION, value ? ActivityBarPosition.HIDDEN : undefined);\n\t\t} else if (key === LayoutStateKeys.STATUSBAR_HIDDEN) {\n\t\t\tthis.configurationService.updateValue(LegacyWorkbenchLayoutSettings.STATUSBAR_VISIBLE, !value);\n\t\t} else if (key === LayoutStateKeys.SIDEBAR_POSITON) {\n\t\t\tthis.configurationService.updateValue(LegacyWorkbenchLayoutSettings.SIDEBAR_POSITION, positionToString(value as Position));\n\t\t}\n\t}\n\n\tload(configuration: ILayoutStateLoadConfiguration): void {\n\t\tlet key: keyof typeof LayoutStateKeys;\n\n\t\t// Load stored values for all keys unless we explicitly set to reset\n\t\tif (!configuration.resetLayout) {\n\t\t\tfor (key in LayoutStateKeys) {\n\t\t\t\tconst stateKey = LayoutStateKeys[key] as WorkbenchLayoutStateKey<StorageKeyType>;\n\t\t\t\tconst value = this.loadKeyFromStorage(stateKey);\n\n\t\t\t\tif (value !== undefined) {\n\t\t\t\t\tthis.stateCache.set(stateKey.name, value);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// Apply legacy settings\n\t\tthis.stateCache.set(LayoutStateKeys.ACTIVITYBAR_HIDDEN.name, this.isActivityBarHidden());\n\t\tthis.stateCache.set(LayoutStateKeys.STATUSBAR_HIDDEN.name, !this.configurationService.getValue(LegacyWorkbenchLayoutSettings.STATUSBAR_VISIBLE));\n\t\tthis.stateCache.set(LayoutStateKeys.SIDEBAR_POSITON.name, positionFromString(this.configurationService.getValue(LegacyWorkbenchLayoutSettings.SIDEBAR_POSITION) ?? 'left'));\n\n\t\t// Set dynamic defaults: part sizing and side bar visibility\n\t\tconst workbenchState = this.contextService.getWorkbenchState();\n\t\tconst mainContainerDimension = configuration.mainContainerDimension;\n\t\tLayoutStateKeys.SIDEBAR_SIZE.defaultValue = Math.min(300, mainContainerDimension.width / 4);\n\t\tLayoutStateKeys.SIDEBAR_HIDDEN.defaultValue = workbenchState === WorkbenchState.EMPTY;\n\t\tLayoutStateKeys.AUXILIARYBAR_SIZE.defaultValue = Math.min(300, mainContainerDimension.width / 4);\n\t\tLayoutStateKeys.AUXILIARYBAR_HIDDEN.defaultValue = (() => {\n\t\t\tif (isWeb && !this.environmentService.remoteAuthority) {\n\t\t\t\treturn true; // TODO@bpasero remove this condition once Chat web support lands\n\t\t\t}\n\n\t\t\tconst configuration = this.configurationService.inspect(WorkbenchLayoutSettings.AUXILIARYBAR_DEFAULT_VISIBILITY);\n\n\t\t\t// Unless auxiliary bar visibility is explicitly configured, make\n\t\t\t// sure to not force open it in case we know it was empty before.\n\t\t\tif (configuration.defaultValue !== 'hidden' && !isConfigured(configuration) && this.stateCache.get(LayoutStateKeys.AUXILIARYBAR_EMPTY.name)) {\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\t// New users: Show auxiliary bar even in empty workspaces\n\t\t\t// but not if the user explicitly hides it\n\t\t\tif (\n\t\t\t\tthis.isNew[StorageScope.APPLICATION] &&\n\t\t\t\tconfiguration.value !== 'hidden'\n\t\t\t) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\t// Existing users: respect visibility setting\n\t\t\tswitch (configuration.value) {\n\t\t\t\tcase 'hidden':\n\t\t\t\t\treturn true;\n\t\t\t\tcase 'visibleInWorkspace':\n\t\t\t\tcase 'maximizedInWorkspace':\n\t\t\t\t\treturn workbenchState === WorkbenchState.EMPTY;\n\t\t\t\tdefault:\n\t\t\t\t\treturn false;\n\t\t\t}\n\t\t})();\n\t\tLayoutStateKeys.PANEL_SIZE.defaultValue = (this.stateCache.get(LayoutStateKeys.PANEL_POSITION.name) ?? isHorizontal(LayoutStateKeys.PANEL_POSITION.defaultValue)) ? mainContainerDimension.height / 3 : mainContainerDimension.width / 4;\n\t\tLayoutStateKeys.PANEL_POSITION.defaultValue = positionFromString(this.configurationService.getValue(WorkbenchLayoutSettings.PANEL_POSITION) ?? 'bottom');\n\n\t\t// Apply all defaults\n\t\tfor (key in LayoutStateKeys) {\n\t\t\tconst stateKey = LayoutStateKeys[key];\n\t\t\tif (this.stateCache.get(stateKey.name) === undefined) {\n\t\t\t\tthis.stateCache.set(stateKey.name, stateKey.defaultValue);\n\t\t\t}\n\t\t}\n\n\t\t// Apply all overrides\n\t\tthis.applyOverrides(configuration);\n\n\t\t// Register for runtime key changes\n\t\tthis._register(this.storageService.onDidChangeValue(StorageScope.PROFILE, undefined, this._store)(storageChangeEvent => {\n\t\t\tlet key: keyof typeof LayoutStateKeys;\n\t\t\tfor (key in LayoutStateKeys) {\n\t\t\t\tconst stateKey = LayoutStateKeys[key] as WorkbenchLayoutStateKey<StorageKeyType>;\n\t\t\t\tif (stateKey instanceof RuntimeStateKey && stateKey.scope === StorageScope.PROFILE && stateKey.target === StorageTarget.USER) {\n\t\t\t\t\tif (`${LayoutStateModel.STORAGE_PREFIX}${stateKey.name}` === storageChangeEvent.key) {\n\t\t\t\t\t\tconst value = this.loadKeyFromStorage(stateKey) ?? stateKey.defaultValue;\n\t\t\t\t\t\tif (this.stateCache.get(stateKey.name) !== value) {\n\t\t\t\t\t\t\tthis.stateCache.set(stateKey.name, value);\n\t\t\t\t\t\t\tthis._onDidChangeState.fire({ key: stateKey, value });\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}));\n\t}\n\n\tprivate applyOverrides(configuration: ILayoutStateLoadConfiguration): void {\n\n\t\t// Auxiliary bar: Maximized setting (new workspaces)\n\t\tif (this.isNew[StorageScope.WORKSPACE]) {\n\t\t\tconst defaultAuxiliaryBarVisibility = this.configurationService.getValue(WorkbenchLayoutSettings.AUXILIARYBAR_DEFAULT_VISIBILITY);\n\t\t\tif (\n\t\t\t\tdefaultAuxiliaryBarVisibility === 'maximized' ||\n\t\t\t\t(defaultAuxiliaryBarVisibility === 'maximizedInWorkspace' && this.contextService.getWorkbenchState() !== WorkbenchState.EMPTY)\n\t\t\t) {\n\t\t\t\tthis.applyAuxiliaryBarMaximizedOverride();\n\t\t\t}\n\t\t}\n\n\t\t// Both editor and panel should not be hidden on startup unless auxiliary bar is maximized\n\t\tif (\n\t\t\tthis.getRuntimeValue(LayoutStateKeys.PANEL_HIDDEN) &&\n\t\t\tthis.getRuntimeValue(LayoutStateKeys.EDITOR_HIDDEN) &&\n\t\t\t!this.getRuntimeValue(LayoutStateKeys.AUXILIARYBAR_WAS_LAST_MAXIMIZED)\n\t\t) {\n\t\t\tthis.setRuntimeValue(LayoutStateKeys.EDITOR_HIDDEN, false);\n\t\t}\n\n\t\t// Restrict auxiliary bar size in case of small window dimensions\n\t\tif (this.isNew[StorageScope.WORKSPACE] && configuration.mainContainerDimension.width <= DEFAULT_WORKSPACE_WINDOW_DIMENSIONS.width) {\n\t\t\tthis.setInitializationValue(LayoutStateKeys.SIDEBAR_SIZE, Math.min(300, configuration.mainContainerDimension.width / 4));\n\t\t\tthis.setInitializationValue(LayoutStateKeys.AUXILIARYBAR_SIZE, Math.min(300, configuration.mainContainerDimension.width / 4));\n\t\t}\n\t}\n\n\tprivate applyAuxiliaryBarMaximizedOverride(): void {\n\t\tthis.setRuntimeValue(LayoutStateKeys.AUXILIARYBAR_LAST_NON_MAXIMIZED_VISIBILITY, {\n\t\t\tsideBarVisible: !this.getRuntimeValue(LayoutStateKeys.SIDEBAR_HIDDEN),\n\t\t\tpanelVisible: !this.getRuntimeValue(LayoutStateKeys.PANEL_HIDDEN),\n\t\t\teditorVisible: !this.getRuntimeValue(LayoutStateKeys.EDITOR_HIDDEN),\n\t\t\tauxiliaryBarVisible: !this.getRuntimeValue(LayoutStateKeys.AUXILIARYBAR_HIDDEN)\n\t\t});\n\n\t\tthis.setRuntimeValue(LayoutStateKeys.SIDEBAR_HIDDEN, true);\n\t\tthis.setRuntimeValue(LayoutStateKeys.PANEL_HIDDEN, true);\n\t\tthis.setRuntimeValue(LayoutStateKeys.EDITOR_HIDDEN, true);\n\t\tthis.setRuntimeValue(LayoutStateKeys.AUXILIARYBAR_HIDDEN, false);\n\n\t\tthis.setRuntimeValue(LayoutStateKeys.AUXILIARYBAR_LAST_NON_MAXIMIZED_SIZE, this.getInitializationValue(LayoutStateKeys.AUXILIARYBAR_SIZE));\n\t\tthis.setRuntimeValue(LayoutStateKeys.AUXILIARYBAR_WAS_LAST_MAXIMIZED, true);\n\t}\n\n\tsave(workspace: boolean, global: boolean): void {\n\t\tlet key: keyof typeof LayoutStateKeys;\n\n\t\tconst isZenMode = this.getRuntimeValue(LayoutStateKeys.ZEN_MODE_ACTIVE);\n\n\t\tfor (key in LayoutStateKeys) {\n\t\t\tconst stateKey = LayoutStateKeys[key] as WorkbenchLayoutStateKey<StorageKeyType>;\n\t\t\tif ((workspace && stateKey.scope === StorageScope.WORKSPACE) ||\n\t\t\t\t(global && stateKey.scope === StorageScope.PROFILE)) {\n\t\t\t\tif (isZenMode && stateKey instanceof RuntimeStateKey && stateKey.zenModeIgnore) {\n\t\t\t\t\tcontinue; // Don't write out specific keys while in zen mode\n\t\t\t\t}\n\n\t\t\t\tthis.saveKeyToStorage(stateKey);\n\t\t\t}\n\t\t}\n\t}\n\n\tgetInitializationValue<T extends StorageKeyType>(key: InitializationStateKey<T>): T {\n\t\treturn this.stateCache.get(key.name) as T;\n\t}\n\n\tsetInitializationValue<T extends StorageKeyType>(key: InitializationStateKey<T>, value: T): void {\n\t\tthis.stateCache.set(key.name, value);\n\t}\n\n\tgetRuntimeValue<T extends StorageKeyType>(key: RuntimeStateKey<T>, fallbackToSetting?: boolean): T {\n\t\tif (fallbackToSetting) {\n\t\t\tswitch (key) {\n\t\t\t\tcase LayoutStateKeys.ACTIVITYBAR_HIDDEN:\n\t\t\t\t\tthis.stateCache.set(key.name, this.isActivityBarHidden());\n\t\t\t\t\tbreak;\n\t\t\t\tcase LayoutStateKeys.STATUSBAR_HIDDEN:\n\t\t\t\t\tthis.stateCache.set(key.name, !this.configurationService.getValue(LegacyWorkbenchLayoutSettings.STATUSBAR_VISIBLE));\n\t\t\t\t\tbreak;\n\t\t\t\tcase LayoutStateKeys.SIDEBAR_POSITON:\n\t\t\t\t\tthis.stateCache.set(key.name, this.configurationService.getValue(LegacyWorkbenchLayoutSettings.SIDEBAR_POSITION) ?? 'left');\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\treturn this.stateCache.get(key.name) as T;\n\t}\n\n\tsetRuntimeValue<T extends StorageKeyType>(key: RuntimeStateKey<T>, value: T): void {\n\t\tthis.stateCache.set(key.name, value);\n\t\tconst isZenMode = this.getRuntimeValue(LayoutStateKeys.ZEN_MODE_ACTIVE);\n\n\t\tif (key.scope === StorageScope.PROFILE) {\n\t\t\tif (!isZenMode || !key.zenModeIgnore) {\n\t\t\t\tthis.saveKeyToStorage<T>(key);\n\t\t\t\tthis.updateLegacySettingsFromState(key, value);\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate isActivityBarHidden(): boolean {\n\t\tconst oldValue = this.configurationService.getValue<boolean | undefined>(WorkbenchLayoutSettings.ACTIVITY_BAR_VISIBLE);\n\t\tif (oldValue !== undefined) {\n\t\t\treturn !oldValue;\n\t\t}\n\n\t\treturn this.configurationService.getValue(LayoutSettings.ACTIVITY_BAR_LOCATION) !== ActivityBarPosition.DEFAULT;\n\t}\n\n\tprivate setRuntimeValueAndFire<T extends StorageKeyType>(key: RuntimeStateKey<T>, value: T): void {\n\t\tconst previousValue = this.stateCache.get(key.name);\n\t\tif (previousValue === value) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.setRuntimeValue(key, value);\n\t\tthis._onDidChangeState.fire({ key, value });\n\t}\n\n\tprivate saveKeyToStorage<T extends StorageKeyType>(key: WorkbenchLayoutStateKey<T>): void {\n\t\tconst value = this.stateCache.get(key.name) as T;\n\t\tthis.storageService.store(`${LayoutStateModel.STORAGE_PREFIX}${key.name}`, typeof value === 'object' ? JSON.stringify(value) : value, key.scope, key.target);\n\t}\n\n\tprivate loadKeyFromStorage<T extends StorageKeyType>(key: WorkbenchLayoutStateKey<T>): T | undefined {\n\t\tlet value = this.storageService.get(`${LayoutStateModel.STORAGE_PREFIX}${key.name}`, key.scope);\n\n\t\t// TODO@bpasero remove this code in 1y when \"pre-AI\" workspaces have migrated\n\t\t// Refs: https://github.com/microsoft/vscode-internalbacklog/issues/6168\n\t\tif (\n\t\t\tkey.scope === StorageScope.WORKSPACE &&\n\t\t\tkey.name === LayoutStateKeys.AUXILIARYBAR_HIDDEN.name &&\n\t\t\tthis.configurationService.getValue('workbench.secondarySideBar.enableDefaultVisibilityInOldWorkspace') === true &&\n\t\t\tthis.storageService.get('workbench.panel.chat.numberOfVisibleViews', StorageScope.WORKSPACE) === undefined\n\t\t) {\n\t\t\tvalue = undefined;\n\t\t}\n\n\t\tif (value !== undefined) {\n\t\t\tthis.isNew[key.scope] = false; // remember that we had previous state for this scope\n\n\t\t\tswitch (typeof key.defaultValue) {\n\t\t\t\tcase 'boolean': return (value === 'true') as T;\n\t\t\t\tcase 'number': return parseInt(value) as T;\n\t\t\t\tcase 'object': return JSON.parse(value) as T;\n\t\t\t}\n\t\t}\n\n\t\treturn value as T | undefined;\n\t}\n}\n\n//#endregion\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Disposable, DisposableMap, DisposableStore, IDisposable, toDisposable } from '../../base/common/lifecycle.js';\nimport { Event, Emitter } from '../../base/common/event.js';\nimport { EventType, addDisposableListener, getClientArea, size, IDimension, isAncestorUsingFlowTo, computeScreenAwareSize, getActiveDocument, getWindows, getActiveWindow, isActiveDocument, getWindow, getWindowId, getActiveElement, Dimension } from '../../base/browser/dom.js';\nimport { onDidChangeFullscreen, isFullscreen, isWCOEnabled } from '../../base/browser/browser.js';\nimport { isWindows, isLinux, isMacintosh, isWeb, isIOS } from '../../base/common/platform.js';\nimport { EditorInputCapabilities, GroupIdentifier, isResourceEditorInput, IUntypedEditorInput, pathsToEditors } from '../common/editor.js';\nimport { SidebarPart } from './parts/sidebar/sidebarPart.js';\nimport { PanelPart } from './parts/panel/panelPart.js';\nimport { Position, Parts, PartOpensMaximizedOptions, IWorkbenchLayoutService, positionFromString, positionToString, partOpensMaximizedFromString, PanelAlignment, ActivityBarPosition, LayoutSettings, MULTI_WINDOW_PARTS, SINGLE_WINDOW_PARTS, ZenModeSettings, EditorTabsMode, EditorActionsLocation, shouldShowCustomTitleBar, isHorizontal, isMultiWindowPart } from '../services/layout/browser/layoutService.js';\nimport { isTemporaryWorkspace, IWorkspaceContextService, WorkbenchState } from '../../platform/workspace/common/workspace.js';\nimport { IStorageService, StorageScope, StorageTarget } from '../../platform/storage/common/storage.js';\nimport { IConfigurationChangeEvent, IConfigurationService, isConfigured } from '../../platform/configuration/common/configuration.js';\nimport { ITitleService } from '../services/title/browser/titleService.js';\nimport { ServicesAccessor } from '../../platform/instantiation/common/instantiation.js';\nimport { StartupKind, ILifecycleService } from '../services/lifecycle/common/lifecycle.js';\nimport { getMenuBarVisibility, IPath, hasNativeTitlebar, hasCustomTitlebar, TitleBarSetting, CustomTitleBarVisibility, useWindowControlsOverlay, DEFAULT_EMPTY_WINDOW_SIZE, DEFAULT_WORKSPACE_WINDOW_SIZE, hasNativeMenu, MenuSettings } from '../../platform/window/common/window.js';\nimport { IHostService } from '../services/host/browser/host.js';\nimport { IBrowserWorkbenchEnvironmentService } from '../services/environment/browser/environmentService.js';\nimport { IEditorService } from '../services/editor/common/editorService.js';\nimport { EditorGroupLayout, GroupOrientation, GroupsOrder, IEditorGroupsService } from '../services/editor/common/editorGroupsService.js';\nimport { SerializableGrid, ISerializableView, ISerializedGrid, Orientation, ISerializedNode, ISerializedLeafNode, Direction, IViewSize, Sizing } from '../../base/browser/ui/grid/grid.js';\nimport { Part } from './part.js';\nimport { IStatusbarService } from '../services/statusbar/browser/statusbar.js';\nimport { IFileService } from '../../platform/files/common/files.js';\nimport { isCodeEditor } from '../../editor/browser/editorBrowser.js';\nimport { coalesce } from '../../base/common/arrays.js';\nimport { assertReturnsDefined } from '../../base/common/types.js';\nimport { INotificationService, NotificationsFilter } from '../../platform/notification/common/notification.js';\nimport { IThemeService } from '../../platform/theme/common/themeService.js';\nimport { WINDOW_ACTIVE_BORDER, WINDOW_INACTIVE_BORDER } from '../common/theme.js';\nimport { LineNumbersType } from '../../editor/common/config/editorOptions.js';\nimport { URI } from '../../base/common/uri.js';\nimport { IViewDescriptorService, ViewContainerLocation } from '../common/views.js';\nimport { DiffEditorInput } from '../common/editor/diffEditorInput.js';\nimport { mark } from '../../base/common/performance.js';\nimport { IExtensionService } from '../services/extensions/common/extensions.js';\nimport { ILogService } from '../../platform/log/common/log.js';\nimport { DeferredPromise, Promises } from '../../base/common/async.js';\nimport { IBannerService } from '../services/banner/browser/bannerService.js';\nimport { IPaneCompositePartService } from '../services/panecomposite/browser/panecomposite.js';\nimport { AuxiliaryBarPart } from './parts/auxiliarybar/auxiliaryBarPart.js';\nimport { ITelemetryService } from '../../platform/telemetry/common/telemetry.js';\nimport { IAuxiliaryWindowService } from '../services/auxiliaryWindow/browser/auxiliaryWindowService.js';\nimport { CodeWindow, mainWindow } from '../../base/browser/window.js';\n\n//#region Layout Implementation\n\ninterface ILayoutRuntimeState {\n\tactiveContainerId: number;\n\tmainWindowFullscreen: boolean;\n\treadonly maximized: Set<number>;\n\thasFocus: boolean;\n\tmainWindowBorder: boolean;\n\treadonly menuBar: {\n\t\ttoggled: boolean;\n\t};\n\treadonly zenMode: {\n\t\treadonly transitionDisposables: DisposableMap<string, IDisposable>;\n\t};\n}\n\ninterface IEditorToOpen {\n\treadonly editor: IUntypedEditorInput;\n\treadonly viewColumn?: number;\n}\n\ninterface ILayoutInitializationState {\n\treadonly views: {\n\t\treadonly defaults: string[] | undefined;\n\t\treadonly containerToRestore: {\n\t\t\tsideBar?: string;\n\t\t\tpanel?: string;\n\t\t\tauxiliaryBar?: string;\n\t\t};\n\t};\n\treadonly editor: {\n\t\treadonly restoreEditors: boolean;\n\t\treadonly editorsToOpen: Promise<IEditorToOpen[]>;\n\t};\n\treadonly layout?: {\n\t\treadonly editors?: EditorGroupLayout;\n\t};\n}\n\ninterface ILayoutState {\n\treadonly runtime: ILayoutRuntimeState;\n\treadonly initialization: ILayoutInitializationState;\n}\n\nenum LayoutClasses {\n\tSIDEBAR_HIDDEN = 'nosidebar',\n\tMAIN_EDITOR_AREA_HIDDEN = 'nomaineditorarea',\n\tPANEL_HIDDEN = 'nopanel',\n\tAUXILIARYBAR_HIDDEN = 'noauxiliarybar',\n\tSTATUSBAR_HIDDEN = 'nostatusbar',\n\tFULLSCREEN = 'fullscreen',\n\tMAXIMIZED = 'maximized',\n\tWINDOW_BORDER = 'border'\n}\n\ninterface IPathToOpen extends IPath {\n\treadonly viewColumn?: number;\n}\n\ninterface IInitialEditorsState {\n\treadonly filesToOpenOrCreate?: IPathToOpen[];\n\treadonly filesToDiff?: IPathToOpen[];\n\treadonly filesToMerge?: IPathToOpen[];\n\n\treadonly layout?: EditorGroupLayout;\n}\n\nconst COMMAND_CENTER_SETTINGS = [\n\t'chat.commandCenter.enabled',\n\t'workbench.navigationControl.enabled',\n\t'workbench.experimental.share.enabled',\n];\n\nexport const TITLE_BAR_SETTINGS = [\n\tLayoutSettings.ACTIVITY_BAR_LOCATION,\n\tLayoutSettings.COMMAND_CENTER,\n\t...COMMAND_CENTER_SETTINGS,\n\tLayoutSettings.EDITOR_ACTIONS_LOCATION,\n\tLayoutSettings.LAYOUT_ACTIONS,\n\tMenuSettings.MenuBarVisibility,\n\tTitleBarSetting.TITLE_BAR_STYLE,\n\tTitleBarSetting.CUSTOM_TITLE_BAR_VISIBILITY,\n];\n\nconst DEFAULT_EMPTY_WINDOW_DIMENSIONS = new Dimension(DEFAULT_EMPTY_WINDOW_SIZE.width, DEFAULT_EMPTY_WINDOW_SIZE.height);\nconst DEFAULT_WORKSPACE_WINDOW_DIMENSIONS = new Dimension(DEFAULT_WORKSPACE_WINDOW_SIZE.width, DEFAULT_WORKSPACE_WINDOW_SIZE.height);\n\nexport abstract class Layout extends Disposable implements IWorkbenchLayoutService {\n\n\tdeclare readonly _serviceBrand: undefined;\n\n\t//#region Events\n\n\tprivate readonly _onDidChangeZenMode = this._register(new Emitter<boolean>());\n\treadonly onDidChangeZenMode = this._onDidChangeZenMode.event;\n\n\tprivate readonly _onDidChangeMainEditorCenteredLayout = this._register(new Emitter<boolean>());\n\treadonly onDidChangeMainEditorCenteredLayout = this._onDidChangeMainEditorCenteredLayout.event;\n\n\tprivate readonly _onDidChangePanelAlignment = this._register(new Emitter<PanelAlignment>());\n\treadonly onDidChangePanelAlignment = this._onDidChangePanelAlignment.event;\n\n\tprivate readonly _onDidChangeWindowMaximized = this._register(new Emitter<{ windowId: number; maximized: boolean }>());\n\treadonly onDidChangeWindowMaximized = this._onDidChangeWindowMaximized.event;\n\n\tprivate readonly _onDidChangePanelPosition = this._register(new Emitter<string>());\n\treadonly onDidChangePanelPosition = this._onDidChangePanelPosition.event;\n\n\tprivate readonly _onDidChangePartVisibility = this._register(new Emitter<void>());\n\treadonly onDidChangePartVisibility = this._onDidChangePartVisibility.event;\n\n\tprivate readonly _onDidChangeNotificationsVisibility = this._register(new Emitter<boolean>());\n\treadonly onDidChangeNotificationsVisibility = this._onDidChangeNotificationsVisibility.event;\n\n\tprivate readonly _onDidChangeAuxiliaryBarMaximized = this._register(new Emitter<void>());\n\treadonly onDidChangeAuxiliaryBarMaximized = this._onDidChangeAuxiliaryBarMaximized.event;\n\n\tprivate readonly _onDidLayoutMainContainer = this._register(new Emitter<IDimension>());\n\treadonly onDidLayoutMainContainer = this._onDidLayoutMainContainer.event;\n\n\tprivate readonly _onDidLayoutActiveContainer = this._register(new Emitter<IDimension>());\n\treadonly onDidLayoutActiveContainer = this._onDidLayoutActiveContainer.event;\n\n\tprivate readonly _onDidLayoutContainer = this._register(new Emitter<{ container: HTMLElement; dimension: IDimension }>());\n\treadonly onDidLayoutContainer = this._onDidLayoutContainer.event;\n\n\tprivate readonly _onDidAddContainer = this._register(new Emitter<{ container: HTMLElement; disposables: DisposableStore }>());\n\treadonly onDidAddContainer = this._onDidAddContainer.event;\n\n\tprivate readonly _onDidChangeActiveContainer = this._register(new Emitter<void>());\n\treadonly onDidChangeActiveContainer = this._onDidChangeActiveContainer.event;\n\n\t//#endregion\n\n\t//#region Properties\n\n\treadonly mainContainer = document.createElement('div');\n\tget activeContainer() { return this.getContainerFromDocument(getActiveDocument()); }\n\tget containers(): Iterable<HTMLElement> {\n\t\tconst containers: HTMLElement[] = [];\n\t\tfor (const { window } of getWindows()) {\n\t\t\tcontainers.push(this.getContainerFromDocument(window.document));\n\t\t}\n\n\t\treturn containers;\n\t}\n\n\tprivate getContainerFromDocument(targetDocument: Document): HTMLElement {\n\t\tif (targetDocument === this.mainContainer.ownerDocument) {\n\t\t\treturn this.mainContainer; // main window\n\t\t} else {\n\t\t\t// eslint-disable-next-line no-restricted-syntax\n\t\t\treturn targetDocument.body.getElementsByClassName('monaco-workbench')[0] as HTMLElement; // auxiliary window\n\t\t}\n\t}\n\n\tprivate readonly containerStylesLoaded = new Map<number /* window ID */, Promise<void>>();\n\twhenContainerStylesLoaded(window: CodeWindow): Promise<void> | undefined {\n\t\treturn this.containerStylesLoaded.get(window.vscodeWindowId);\n\t}\n\n\tprivate _mainContainerDimension!: IDimension;\n\tget mainContainerDimension(): IDimension { return this._mainContainerDimension; }\n\n\tget activeContainerDimension(): IDimension {\n\t\treturn this.getContainerDimension(this.activeContainer);\n\t}\n\n\tprivate getContainerDimension(container: HTMLElement): IDimension {\n\t\tif (container === this.mainContainer) {\n\t\t\treturn this.mainContainerDimension; // main window\n\t\t} else {\n\t\t\treturn getClientArea(container); \t// auxiliary window\n\t\t}\n\t}\n\n\tget mainContainerOffset() {\n\t\treturn this.computeContainerOffset(mainWindow);\n\t}\n\n\tget activeContainerOffset() {\n\t\treturn this.computeContainerOffset(getWindow(this.activeContainer));\n\t}\n\n\tprivate computeContainerOffset(targetWindow: Window) {\n\t\tlet top = 0;\n\t\tlet quickPickTop = 0;\n\n\t\tif (this.isVisible(Parts.BANNER_PART)) {\n\t\t\ttop = this.getPart(Parts.BANNER_PART).maximumHeight;\n\t\t\tquickPickTop = top;\n\t\t}\n\n\t\tconst titlebarVisible = this.isVisible(Parts.TITLEBAR_PART, targetWindow);\n\t\tif (titlebarVisible) {\n\t\t\ttop += this.getPart(Parts.TITLEBAR_PART).maximumHeight;\n\t\t\tquickPickTop = top;\n\t\t}\n\n\t\tconst isCommandCenterVisible = titlebarVisible && this.configurationService.getValue<boolean>(LayoutSettings.COMMAND_CENTER) !== false;\n\t\tif (isCommandCenterVisible) {\n\t\t\t// If the command center is visible then the quickinput\n\t\t\t// should go over the title bar and the banner\n\t\t\tquickPickTop = 6;\n\t\t}\n\n\t\treturn { top, quickPickTop };\n\t}\n\n\t//#endregion\n\n\tprivate readonly parts = new Map<string, Part>();\n\n\tprivate initialized = false;\n\tprivate workbenchGrid!: SerializableGrid<ISerializableView>;\n\n\tprivate titleBarPartView!: ISerializableView;\n\tprivate bannerPartView!: ISerializableView;\n\tprivate activityBarPartView!: ISerializableView;\n\tprivate sideBarPartView!: ISerializableView;\n\tprivate panelPartView!: ISerializableView;\n\tprivate auxiliaryBarPartView!: ISerializableView;\n\tprivate editorPartView!: ISerializableView;\n\tprivate statusBarPartView!: ISerializableView;\n\n\tprivate environmentService!: IBrowserWorkbenchEnvironmentService;\n\tprivate extensionService!: IExtensionService;\n\tprivate configurationService!: IConfigurationService;\n\tprivate storageService!: IStorageService;\n\tprivate hostService!: IHostService;\n\tprivate editorService!: IEditorService;\n\tprivate mainPartEditorService!: IEditorService;\n\tprivate editorGroupService!: IEditorGroupsService;\n\tprivate paneCompositeService!: IPaneCompositePartService;\n\tprivate titleService!: ITitleService;\n\tprivate viewDescriptorService!: IViewDescriptorService;\n\tprivate contextService!: IWorkspaceContextService;\n\tprivate notificationService!: INotificationService;\n\tprivate themeService!: IThemeService;\n\tprivate statusBarService!: IStatusbarService;\n\tprivate logService!: ILogService;\n\tprivate telemetryService!: ITelemetryService;\n\tprivate auxiliaryWindowService!: IAuxiliaryWindowService;\n\n\tprivate state!: ILayoutState;\n\tprivate stateModel!: LayoutStateModel;\n\n\tprivate disposed = false;\n\n\tconstructor(\n\t\tprotected readonly parent: HTMLElement,\n\t\tprivate readonly layoutOptions?: { resetLayout: boolean }\n\t) {\n\t\tsuper();\n\t}\n\n\tprotected initLayout(accessor: ServicesAccessor): void {\n\n\t\t// Services\n\t\tthis.environmentService = accessor.get(IBrowserWorkbenchEnvironmentService);\n\t\tthis.configurationService = accessor.get(IConfigurationService);\n\t\tthis.hostService = accessor.get(IHostService);\n\t\tthis.contextService = accessor.get(IWorkspaceContextService);\n\t\tthis.storageService = accessor.get(IStorageService);\n\t\tthis.themeService = accessor.get(IThemeService);\n\t\tthis.extensionService = accessor.get(IExtensionService);\n\t\tthis.logService = accessor.get(ILogService);\n\t\tthis.telemetryService = accessor.get(ITelemetryService);\n\t\tthis.auxiliaryWindowService = accessor.get(IAuxiliaryWindowService);\n\n\t\t// Parts\n\t\tthis.editorService = accessor.get(IEditorService);\n\t\tthis.editorGroupService = accessor.get(IEditorGroupsService);\n\t\tthis.mainPartEditorService = this.editorService.createScoped(this.editorGroupService.mainPart, this._store);\n\t\tthis.paneCompositeService = accessor.get(IPaneCompositePartService);\n\t\tthis.viewDescriptorService = accessor.get(IViewDescriptorService);\n\t\tthis.titleService = accessor.get(ITitleService);\n\t\tthis.notificationService = accessor.get(INotificationService);\n\t\tthis.statusBarService = accessor.get(IStatusbarService);\n\t\taccessor.get(IBannerService);\n\n\t\t// Listeners\n\t\tthis.registerLayoutListeners();\n\n\t\t// State\n\t\tthis.initLayoutState(accessor.get(ILifecycleService), accessor.get(IFileService));\n\t}\n\n\tprivate registerLayoutListeners(): void {\n\n\t\t// Restore editor if hidden and an editor is to show\n\t\tconst showEditorIfHidden = () => {\n\t\t\tif (!this.isVisible(Parts.EDITOR_PART, mainWindow)) {\n\t\t\t\tif (this.isAuxiliaryBarMaximized()) {\n\t\t\t\t\tthis.toggleMaximizedAuxiliaryBar();\n\t\t\t\t} else {\n\t\t\t\t\tthis.toggleMaximizedPanel();\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\t// Wait to register these listeners after the editor group service\n\t\t// is ready to avoid conflicts on startup\n\t\tthis.editorGroupService.whenRestored.then(() => {\n\n\t\t\t// Restore main editor part on any editor change in main part\n\t\t\tthis._register(this.mainPartEditorService.onDidVisibleEditorsChange(showEditorIfHidden));\n\t\t\tthis._register(this.editorGroupService.mainPart.onDidActivateGroup(showEditorIfHidden));\n\n\t\t\t// Revalidate center layout when active editor changes: diff editor quits centered mode.\n\t\t\tthis._register(this.mainPartEditorService.onDidActiveEditorChange(() => this.centerMainEditorLayout(this.stateModel.getRuntimeValue(LayoutStateKeys.MAIN_EDITOR_CENTERED))));\n\t\t});\n\n\t\t// Configuration changes\n\t\tthis._register(this.configurationService.onDidChangeConfiguration(e => {\n\t\t\tif ([\n\t\t\t\t...TITLE_BAR_SETTINGS,\n\t\t\t\tLegacyWorkbenchLayoutSettings.SIDEBAR_POSITION,\n\t\t\t\tLegacyWorkbenchLayoutSettings.STATUSBAR_VISIBLE,\n\t\t\t].some(setting => e.affectsConfiguration(setting))) {\n\n\t\t\t\t// Show Command Center if command center actions enabled\n\t\t\t\tconst shareEnabled = e.affectsConfiguration('workbench.experimental.share.enabled') && this.configurationService.getValue<boolean>('workbench.experimental.share.enabled');\n\t\t\t\tconst navigationControlEnabled = e.affectsConfiguration('workbench.navigationControl.enabled') && this.configurationService.getValue<boolean>('workbench.navigationControl.enabled');\n\n\t\t\t\t// Currently not supported for \"chat.commandCenter.enabled\" as we\n\t\t\t\t// programatically set this during setup and could lead to unwanted titlebar appearing\n\t\t\t\t// const chatControlsEnabled = e.affectsConfiguration('chat.commandCenter.enabled') && this.configurationService.getValue<boolean>('chat.commandCenter.enabled');\n\n\t\t\t\tif (shareEnabled || navigationControlEnabled) {\n\t\t\t\t\tif (this.configurationService.getValue<boolean>(LayoutSettings.COMMAND_CENTER) === false) {\n\t\t\t\t\t\tthis.configurationService.updateValue(LayoutSettings.COMMAND_CENTER, true);\n\t\t\t\t\t\treturn; // onDidChangeConfiguration will be triggered again\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Show Custom TitleBar if actions enabled in (or moved to) the titlebar\n\t\t\t\tconst editorActionsMovedToTitlebar = e.affectsConfiguration(LayoutSettings.EDITOR_ACTIONS_LOCATION) && this.configurationService.getValue<EditorActionsLocation>(LayoutSettings.EDITOR_ACTIONS_LOCATION) === EditorActionsLocation.TITLEBAR;\n\t\t\t\tconst commandCenterEnabled = e.affectsConfiguration(LayoutSettings.COMMAND_CENTER) && this.configurationService.getValue<boolean>(LayoutSettings.COMMAND_CENTER);\n\t\t\t\tconst layoutControlsEnabled = e.affectsConfiguration(LayoutSettings.LAYOUT_ACTIONS) && this.configurationService.getValue<boolean>(LayoutSettings.LAYOUT_ACTIONS);\n\t\t\t\tconst activityBarMovedToTopOrBottom = e.affectsConfiguration(LayoutSettings.ACTIVITY_BAR_LOCATION) && [ActivityBarPosition.TOP, ActivityBarPosition.BOTTOM].includes(this.configurationService.getValue<ActivityBarPosition>(LayoutSettings.ACTIVITY_BAR_LOCATION));\n\n\t\t\t\tif (activityBarMovedToTopOrBottom || editorActionsMovedToTitlebar || commandCenterEnabled || layoutControlsEnabled) {\n\t\t\t\t\tif (this.configurationService.getValue<CustomTitleBarVisibility>(TitleBarSetting.CUSTOM_TITLE_BAR_VISIBILITY) === CustomTitleBarVisibility.NEVER) {\n\t\t\t\t\t\tthis.configurationService.updateValue(TitleBarSetting.CUSTOM_TITLE_BAR_VISIBILITY, CustomTitleBarVisibility.AUTO);\n\t\t\t\t\t\treturn; // onDidChangeConfiguration will be triggered again\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tthis.doUpdateLayoutConfiguration();\n\t\t\t}\n\t\t}));\n\n\t\t// Fullscreen changes\n\t\tthis._register(onDidChangeFullscreen(windowId => this.onFullscreenChanged(windowId)));\n\n\t\t// Group changes\n\t\tthis._register(this.editorGroupService.mainPart.onDidAddGroup(() => this.centerMainEditorLayout(this.stateModel.getRuntimeValue(LayoutStateKeys.MAIN_EDITOR_CENTERED))));\n\t\tthis._register(this.editorGroupService.mainPart.onDidRemoveGroup(() => this.centerMainEditorLayout(this.stateModel.getRuntimeValue(LayoutStateKeys.MAIN_EDITOR_CENTERED))));\n\t\tthis._register(this.editorGroupService.mainPart.onDidChangeGroupMaximized(() => this.centerMainEditorLayout(this.stateModel.getRuntimeValue(LayoutStateKeys.MAIN_EDITOR_CENTERED))));\n\n\t\t// Prevent workbench from scrolling #55456\n\t\tthis._register(addDisposableListener(this.mainContainer, EventType.SCROLL, () => this.mainContainer.scrollTop = 0));\n\n\t\t// Menubar visibility changes\n\t\tconst showingCustomMenu = (isWindows || isLinux || isWeb) && !hasNativeTitlebar(this.configurationService);\n\t\tif (showingCustomMenu) {\n\t\t\tthis._register(this.titleService.onMenubarVisibilityChange(visible => this.onMenubarToggled(visible)));\n\t\t}\n\n\t\t// Theme changes\n\t\tthis._register(this.themeService.onDidColorThemeChange(() => this.updateWindowBorder()));\n\n\t\t// Window active / focus changes\n\t\tthis._register(this.hostService.onDidChangeFocus(focused => this.onWindowFocusChanged(focused)));\n\t\tthis._register(this.hostService.onDidChangeActiveWindow(() => this.onActiveWindowChanged()));\n\n\t\t// WCO changes\n\t\tif (isWeb && typeof (navigator as { windowControlsOverlay?: EventTarget }).windowControlsOverlay === 'object') {\n\t\t\tthis._register(addDisposableListener((navigator as unknown as { windowControlsOverlay: EventTarget }).windowControlsOverlay, 'geometrychange', () => this.onDidChangeWCO()));\n\t\t}\n\n\t\t// Auxiliary windows\n\t\tthis._register(this.auxiliaryWindowService.onDidOpenAuxiliaryWindow(({ window, disposables }) => {\n\t\t\tconst windowId = window.window.vscodeWindowId;\n\t\t\tthis.containerStylesLoaded.set(windowId, window.whenStylesHaveLoaded);\n\t\t\twindow.whenStylesHaveLoaded.then(() => this.containerStylesLoaded.delete(windowId));\n\t\t\tdisposables.add(toDisposable(() => this.containerStylesLoaded.delete(windowId)));\n\n\t\t\tconst eventDisposables = disposables.add(new DisposableStore());\n\t\t\tthis._onDidAddContainer.fire({ container: window.container, disposables: eventDisposables });\n\n\t\t\tdisposables.add(window.onDidLayout(dimension => this.handleContainerDidLayout(window.container, dimension)));\n\t\t}));\n\t}\n\n\tprivate onMenubarToggled(visible: boolean): void {\n\t\tif (visible !== this.state.runtime.menuBar.toggled) {\n\t\t\tthis.state.runtime.menuBar.toggled = visible;\n\n\t\t\tconst menuBarVisibility = getMenuBarVisibility(this.configurationService);\n\n\t\t\t// The menu bar toggles the title bar in web because it does not need to be shown for window controls only\n\t\t\tif (isWeb && menuBarVisibility === 'toggle') {\n\t\t\t\tthis.workbenchGrid.setViewVisible(this.titleBarPartView, shouldShowCustomTitleBar(this.configurationService, mainWindow, this.state.runtime.menuBar.toggled));\n\t\t\t}\n\n\t\t\t// The menu bar toggles the title bar in full screen for toggle and classic settings\n\t\t\telse if (this.state.runtime.mainWindowFullscreen && (menuBarVisibility === 'toggle' || menuBarVisibility === 'classic')) {\n\t\t\t\tthis.workbenchGrid.setViewVisible(this.titleBarPartView, shouldShowCustomTitleBar(this.configurationService, mainWindow, this.state.runtime.menuBar.toggled));\n\t\t\t}\n\n\t\t\t// Move layout call to any time the menubar\n\t\t\t// is toggled to update consumers of offset\n\t\t\t// see issue #115267\n\t\t\tthis.handleContainerDidLayout(this.mainContainer, this._mainContainerDimension);\n\t\t}\n\t}\n\n\tprivate handleContainerDidLayout(container: HTMLElement, dimension: IDimension): void {\n\t\tif (container === this.mainContainer) {\n\t\t\tthis._onDidLayoutMainContainer.fire(dimension);\n\t\t}\n\n\t\tif (isActiveDocument(container)) {\n\t\t\tthis._onDidLayoutActiveContainer.fire(dimension);\n\t\t}\n\n\t\tthis._onDidLayoutContainer.fire({ container, dimension });\n\t}\n\n\tprivate onFullscreenChanged(windowId: number): void {\n\t\tif (windowId !== mainWindow.vscodeWindowId) {\n\t\t\treturn; // ignore all but main window\n\t\t}\n\n\t\tthis.state.runtime.mainWindowFullscreen = isFullscreen(mainWindow);\n\n\t\t// Apply as CSS class\n\t\tif (this.state.runtime.mainWindowFullscreen) {\n\t\t\tthis.mainContainer.classList.add(LayoutClasses.FULLSCREEN);\n\t\t} else {\n\t\t\tthis.mainContainer.classList.remove(LayoutClasses.FULLSCREEN);\n\n\t\t\tconst zenModeExitInfo = this.stateModel.getRuntimeValue(LayoutStateKeys.ZEN_MODE_EXIT_INFO);\n\t\t\tif (zenModeExitInfo.transitionedToFullScreen && this.isZenModeActive()) {\n\t\t\t\tthis.toggleZenMode();\n\t\t\t}\n\t\t}\n\n\t\t// Change edge snapping accordingly\n\t\tthis.workbenchGrid.edgeSnapping = this.state.runtime.mainWindowFullscreen;\n\n\t\t// Changing fullscreen state of the main window has an impact\n\t\t// on custom title bar visibility, so we need to update\n\t\tif (hasCustomTitlebar(this.configurationService)) {\n\n\t\t\t// Propagate to grid\n\t\t\tthis.workbenchGrid.setViewVisible(this.titleBarPartView, shouldShowCustomTitleBar(this.configurationService, mainWindow, this.state.runtime.menuBar.toggled));\n\n\t\t\t// Indicate active window border\n\t\t\tthis.updateWindowBorder(true);\n\t\t}\n\t}\n\n\tprivate onActiveWindowChanged(): void {\n\t\tconst activeContainerId = this.getActiveContainerId();\n\t\tif (this.state.runtime.activeContainerId !== activeContainerId) {\n\t\t\tthis.state.runtime.activeContainerId = activeContainerId;\n\n\t\t\t// Indicate active window border\n\t\t\tthis.updateWindowBorder();\n\n\t\t\tthis._onDidChangeActiveContainer.fire();\n\t\t}\n\t}\n\n\tprivate onWindowFocusChanged(hasFocus: boolean): void {\n\t\tif (this.state.runtime.hasFocus !== hasFocus) {\n\t\t\tthis.state.runtime.hasFocus = hasFocus;\n\n\t\t\t// Indicate active window border\n\t\t\tthis.updateWindowBorder();\n\t\t}\n\t}\n\n\tprivate getActiveContainerId(): number {\n\t\tconst activeContainer = this.activeContainer;\n\n\t\treturn getWindow(activeContainer).vscodeWindowId;\n\t}\n\n\tprivate doUpdateLayoutConfiguration(skipLayout?: boolean): void {\n\n\t\t// Custom Titlebar visibility with native titlebar\n\t\tthis.updateCustomTitleBarVisibility();\n\n\t\t// Menubar visibility\n\t\tthis.updateMenubarVisibility(!!skipLayout);\n\n\t\t// Centered Layout\n\t\tthis.editorGroupService.whenRestored.then(() => this.centerMainEditorLayout(this.stateModel.getRuntimeValue(LayoutStateKeys.MAIN_EDITOR_CENTERED), skipLayout));\n\t}\n\n\tprivate setSideBarPosition(position: Position): void {\n\t\tconst activityBar = this.getPart(Parts.ACTIVITYBAR_PART);\n\t\tconst sideBar = this.getPart(Parts.SIDEBAR_PART);\n\t\tconst auxiliaryBar = this.getPart(Parts.AUXILIARYBAR_PART);\n\t\tconst newPositionValue = (position === Position.LEFT) ? 'left' : 'right';\n\t\tconst oldPositionValue = (position === Position.RIGHT) ? 'left' : 'right';\n\t\tconst panelAlignment = this.getPanelAlignment();\n\t\tconst panelPosition = this.getPanelPosition();\n\n\t\tthis.stateModel.setRuntimeValue(LayoutStateKeys.SIDEBAR_POSITON, position);\n\n\t\t// Adjust CSS\n\t\tconst activityBarContainer = assertReturnsDefined(activityBar.getContainer());\n\t\tconst sideBarContainer = assertReturnsDefined(sideBar.getContainer());\n\t\tconst auxiliaryBarContainer = assertReturnsDefined(auxiliaryBar.getContainer());\n\t\tactivityBarContainer.classList.remove(oldPositionValue);\n\t\tsideBarContainer.classList.remove(oldPositionValue);\n\t\tactivityBarContainer.classList.add(newPositionValue);\n\t\tsideBarContainer.classList.add(newPositionValue);\n\n\t\t// Auxiliary Bar has opposite values\n\t\tauxiliaryBarContainer.classList.remove(newPositionValue);\n\t\tauxiliaryBarContainer.classList.add(oldPositionValue);\n\n\t\t// Update Styles\n\t\tactivityBar.updateStyles();\n\t\tsideBar.updateStyles();\n\t\tauxiliaryBar.updateStyles();\n\n\t\t// Move activity bar and side bars\n\t\tthis.adjustPartPositions(position, panelAlignment, panelPosition);\n\t}\n\n\tprivate updateWindowBorder(skipLayout = false) {\n\t\tif (\n\t\t\tisWeb ||\n\t\t\tisWindows || \t\t\t\t\t\t\t\t\t\t\t// not working well with zooming (border often not visible)\n\t\t\t(\n\t\t\t\t(isWindows || isLinux) &&\n\t\t\t\tuseWindowControlsOverlay(this.configurationService)\t// Windows/Linux: not working with WCO (border cannot draw over the overlay)\n\t\t\t) ||\n\t\t\thasNativeTitlebar(this.configurationService)\n\t\t) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst theme = this.themeService.getColorTheme();\n\n\t\tconst activeBorder = theme.getColor(WINDOW_ACTIVE_BORDER);\n\t\tconst inactiveBorder = theme.getColor(WINDOW_INACTIVE_BORDER);\n\n\t\tconst didHaveMainWindowBorder = this.hasMainWindowBorder();\n\n\t\tfor (const container of this.containers) {\n\t\t\tconst isMainContainer = container === this.mainContainer;\n\t\t\tconst isActiveContainer = this.activeContainer === container;\n\n\t\t\tlet windowBorder = false;\n\t\t\tif (!this.state.runtime.mainWindowFullscreen && (activeBorder || inactiveBorder)) {\n\t\t\t\twindowBorder = true;\n\n\t\t\t\t// If the inactive color is missing, fallback to the active one\n\t\t\t\tconst borderColor = isActiveContainer && this.state.runtime.hasFocus ? activeBorder : inactiveBorder ?? activeBorder;\n\t\t\t\tcontainer.style.setProperty('--window-border-color', borderColor?.toString() ?? 'transparent');\n\t\t\t}\n\n\t\t\tif (isMainContainer) {\n\t\t\t\tthis.state.runtime.mainWindowBorder = windowBorder;\n\t\t\t}\n\n\t\t\tcontainer.classList.toggle(LayoutClasses.WINDOW_BORDER, windowBorder);\n\t\t}\n\n\t\tif (!skipLayout && didHaveMainWindowBorder !== this.hasMainWindowBorder()) {\n\t\t\tthis.layout();\n\t\t}\n\t}\n\n\tprivate initLayoutState(lifecycleService: ILifecycleService, fileService: IFileService): void {\n\t\tthis._mainContainerDimension = getClientArea(this.parent, this.contextService.getWorkbenchState() === WorkbenchState.EMPTY ? DEFAULT_EMPTY_WINDOW_DIMENSIONS : DEFAULT_WORKSPACE_WINDOW_DIMENSIONS); // running with fallback to ensure no error is thrown (https://github.com/microsoft/vscode/issues/240242)\n\n\t\tthis.stateModel = new LayoutStateModel(this.storageService, this.configurationService, this.contextService, this.environmentService);\n\t\tthis.stateModel.load({\n\t\t\tmainContainerDimension: this._mainContainerDimension,\n\t\t\tresetLayout: Boolean(this.layoutOptions?.resetLayout)\n\t\t});\n\n\t\tthis._register(this.stateModel.onDidChangeState(change => {\n\t\t\tif (change.key === LayoutStateKeys.ACTIVITYBAR_HIDDEN) {\n\t\t\t\tthis.setActivityBarHidden(change.value as boolean);\n\t\t\t}\n\n\t\t\tif (change.key === LayoutStateKeys.STATUSBAR_HIDDEN) {\n\t\t\t\tthis.setStatusBarHidden(change.value as boolean);\n\t\t\t}\n\n\t\t\tif (change.key === LayoutStateKeys.SIDEBAR_POSITON) {\n\t\t\t\tthis.setSideBarPosition(change.value as Position);\n\t\t\t}\n\n\t\t\tif (change.key === LayoutStateKeys.PANEL_POSITION) {\n\t\t\t\tthis.setPanelPosition(change.value as Position);\n\t\t\t}\n\n\t\t\tif (change.key === LayoutStateKeys.PANEL_ALIGNMENT) {\n\t\t\t\tthis.setPanelAlignment(change.value as PanelAlignment);\n\t\t\t}\n\n\t\t\tthis.doUpdateLayoutConfiguration();\n\t\t}));\n\n\t\t// Layout Initialization State\n\t\tconst initialEditorsState = this.getInitialEditorsState();\n\t\tif (initialEditorsState) {\n\t\t\tthis.logService.trace('Initial editor state', initialEditorsState);\n\t\t}\n\t\tconst initialLayoutState: ILayoutInitializationState = {\n\t\t\tlayout: {\n\t\t\t\teditors: initialEditorsState?.layout\n\t\t\t},\n\t\t\teditor: {\n\t\t\t\trestoreEditors: this.shouldRestoreEditors(this.contextService, initialEditorsState),\n\t\t\t\teditorsToOpen: this.resolveEditorsToOpen(fileService, initialEditorsState),\n\t\t\t},\n\t\t\tviews: {\n\t\t\t\tdefaults: this.getDefaultLayoutViews(this.environmentService, this.storageService),\n\t\t\t\tcontainerToRestore: {}\n\t\t\t}\n\t\t};\n\n\t\t// Layout Runtime State\n\t\tconst layoutRuntimeState: ILayoutRuntimeState = {\n\t\t\tactiveContainerId: this.getActiveContainerId(),\n\t\t\tmainWindowFullscreen: isFullscreen(mainWindow),\n\t\t\thasFocus: this.hostService.hasFocus,\n\t\t\tmaximized: new Set<number>(),\n\t\t\tmainWindowBorder: false,\n\t\t\tmenuBar: {\n\t\t\t\ttoggled: false,\n\t\t\t},\n\t\t\tzenMode: {\n\t\t\t\ttransitionDisposables: new DisposableMap(),\n\t\t\t}\n\t\t};\n\n\t\tthis.state = {\n\t\t\tinitialization: initialLayoutState,\n\t\t\truntime: layoutRuntimeState,\n\t\t};\n\n\t\t// Sidebar View Container To Restore\n\t\tif (this.isVisible(Parts.SIDEBAR_PART)) {\n\t\t\tlet viewContainerToRestore = this.storageService.get(SidebarPart.activeViewletSettingsKey, StorageScope.WORKSPACE, this.viewDescriptorService.getDefaultViewContainer(ViewContainerLocation.Sidebar)?.id);\n\t\t\tif (\n\t\t\t\t!this.environmentService.isBuilt ||\n\t\t\t\tlifecycleService.startupKind === StartupKind.ReloadedWindow ||\n\t\t\t\tthis.environmentService.isExtensionDevelopment && !this.environmentService.extensionTestsLocationURI\n\t\t\t) {\n\t\t\t\t// allow to restore a non-default viewlet in development mode or when window reloads\n\t\t\t} else if (\n\t\t\t\tviewContainerToRestore !== this.viewDescriptorService.getDefaultViewContainer(ViewContainerLocation.Sidebar)?.id &&\n\t\t\t\tviewContainerToRestore !== this.viewDescriptorService.getDefaultViewContainer(ViewContainerLocation.AuxiliaryBar)?.id\n\t\t\t) {\n\t\t\t\t// fallback to default viewlet otherwise if the viewlet is not a default viewlet\n\t\t\t\tviewContainerToRestore = this.viewDescriptorService.getDefaultViewContainer(ViewContainerLocation.Sidebar)?.id;\n\t\t\t}\n\n\t\t\tif (viewContainerToRestore) {\n\t\t\t\tthis.state.initialization.views.containerToRestore.sideBar = viewContainerToRestore;\n\t\t\t} else {\n\t\t\t\tthis.stateModel.setRuntimeValue(LayoutStateKeys.SIDEBAR_HIDDEN, true);\n\t\t\t}\n\t\t}\n\n\t\t// Panel View Container To Restore\n\t\tif (this.isVisible(Parts.PANEL_PART)) {\n\t\t\tconst viewContainerToRestore = this.storageService.get(PanelPart.activePanelSettingsKey, StorageScope.WORKSPACE, this.viewDescriptorService.getDefaultViewContainer(ViewContainerLocation.Panel)?.id);\n\n\t\t\tif (viewContainerToRestore) {\n\t\t\t\tthis.state.initialization.views.containerToRestore.panel = viewContainerToRestore;\n\t\t\t} else {\n\t\t\t\tthis.stateModel.setRuntimeValue(LayoutStateKeys.PANEL_HIDDEN, true);\n\t\t\t}\n\t\t}\n\n\t\t// Auxiliary View to restore\n\t\tif (this.isVisible(Parts.AUXILIARYBAR_PART)) {\n\t\t\tconst viewContainerToRestore = this.storageService.get(AuxiliaryBarPart.activeViewSettingsKey, StorageScope.WORKSPACE, this.viewDescriptorService.getDefaultViewContainer(ViewContainerLocation.AuxiliaryBar)?.id);\n\t\t\tif (viewContainerToRestore) {\n\t\t\t\tthis.state.initialization.views.containerToRestore.auxiliaryBar = viewContainerToRestore;\n\t\t\t} else {\n\t\t\t\tthis.stateModel.setRuntimeValue(LayoutStateKeys.AUXILIARYBAR_HIDDEN, true);\n\t\t\t}\n\t\t}\n\n\t\t// Window border\n\t\tthis.updateWindowBorder(true);\n\t}\n\n\tprivate getDefaultLayoutViews(environmentService: IBrowserWorkbenchEnvironmentService, storageService: IStorageService): string[] | undefined {\n\t\tconst defaultLayout = environmentService.options?.defaultLayout;\n\t\tif (!defaultLayout) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\tif (!defaultLayout.force && !storageService.isNew(StorageScope.WORKSPACE)) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\tconst { views } = defaultLayout;\n\t\tif (views?.length) {\n\t\t\treturn views.map(view => view.id);\n\t\t}\n\n\t\treturn undefined;\n\t}\n\n\tprivate shouldRestoreEditors(contextService: IWorkspaceContextService, initialEditorsState: IInitialEditorsState | undefined): boolean {\n\n\t\t// Restore editors based on a set of rules:\n\t\t// - never when running on temporary workspace\n\t\t// - not when we have files to open, unless:\n\t\t// - always when `window.restoreWindows: preserve`\n\n\t\tif (isTemporaryWorkspace(contextService.getWorkspace())) {\n\t\t\treturn false;\n\t\t}\n\n\t\tconst forceRestoreEditors = this.configurationService.getValue<string>('window.restoreWindows') === 'preserve';\n\t\treturn !!forceRestoreEditors || initialEditorsState === undefined;\n\t}\n\n\tprotected willRestoreEditors(): boolean {\n\t\treturn this.state.initialization.editor.restoreEditors;\n\t}\n\n\tprivate async resolveEditorsToOpen(fileService: IFileService, initialEditorsState: IInitialEditorsState | undefined): Promise<IEditorToOpen[]> {\n\t\tif (initialEditorsState) {\n\n\t\t\t// Merge editor (single)\n\t\t\tconst filesToMerge = coalesce(await pathsToEditors(initialEditorsState.filesToMerge, fileService, this.logService));\n\t\t\tif (filesToMerge.length === 4 && isResourceEditorInput(filesToMerge[0]) && isResourceEditorInput(filesToMerge[1]) && isResourceEditorInput(filesToMerge[2]) && isResourceEditorInput(filesToMerge[3])) {\n\t\t\t\treturn [{\n\t\t\t\t\teditor: {\n\t\t\t\t\t\tinput1: { resource: filesToMerge[0].resource },\n\t\t\t\t\t\tinput2: { resource: filesToMerge[1].resource },\n\t\t\t\t\t\tbase: { resource: filesToMerge[2].resource },\n\t\t\t\t\t\tresult: { resource: filesToMerge[3].resource },\n\t\t\t\t\t\toptions: { pinned: true }\n\t\t\t\t\t}\n\t\t\t\t}];\n\t\t\t}\n\n\t\t\t// Diff editor (single)\n\t\t\tconst filesToDiff = coalesce(await pathsToEditors(initialEditorsState.filesToDiff, fileService, this.logService));\n\t\t\tif (filesToDiff.length === 2) {\n\t\t\t\treturn [{\n\t\t\t\t\teditor: {\n\t\t\t\t\t\toriginal: { resource: filesToDiff[0].resource },\n\t\t\t\t\t\tmodified: { resource: filesToDiff[1].resource },\n\t\t\t\t\t\toptions: { pinned: true }\n\t\t\t\t\t}\n\t\t\t\t}];\n\t\t\t}\n\n\t\t\t// Normal editor (multiple)\n\t\t\tconst filesToOpenOrCreate: IEditorToOpen[] = [];\n\t\t\tconst resolvedFilesToOpenOrCreate = await pathsToEditors(initialEditorsState.filesToOpenOrCreate, fileService, this.logService);\n\t\t\tfor (let i = 0; i < resolvedFilesToOpenOrCreate.length; i++) {\n\t\t\t\tconst resolvedFileToOpenOrCreate = resolvedFilesToOpenOrCreate[i];\n\t\t\t\tif (resolvedFileToOpenOrCreate) {\n\t\t\t\t\tfilesToOpenOrCreate.push({\n\t\t\t\t\t\teditor: resolvedFileToOpenOrCreate,\n\t\t\t\t\t\tviewColumn: initialEditorsState.filesToOpenOrCreate?.[i].viewColumn // take over `viewColumn` from initial state\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn filesToOpenOrCreate;\n\t\t}\n\n\t\t// Empty workbench configured to open untitled file if empty\n\t\telse if (this.contextService.getWorkbenchState() === WorkbenchState.EMPTY && this.configurationService.getValue('workbench.startupEditor') === 'newUntitledFile') {\n\t\t\tif (this.editorGroupService.hasRestorableState) {\n\t\t\t\treturn []; // do not open any empty untitled file if we restored groups/editors from previous session\n\t\t\t}\n\n\t\t\treturn [{\n\t\t\t\teditor: { resource: undefined } // open empty untitled file\n\t\t\t}];\n\t\t}\n\n\t\treturn [];\n\t}\n\n\tprivate _openedDefaultEditors: boolean = false;\n\tget openedDefaultEditors() { return this._openedDefaultEditors; }\n\n\tprivate getInitialEditorsState(): IInitialEditorsState | undefined {\n\n\t\t// Check for editors / editor layout from `defaultLayout` options first\n\t\tconst defaultLayout = this.environmentService.options?.defaultLayout;\n\t\tif ((defaultLayout?.editors?.length || defaultLayout?.layout?.editors) && (defaultLayout.force || this.storageService.isNew(StorageScope.WORKSPACE))) {\n\t\t\tthis._openedDefaultEditors = true;\n\n\t\t\treturn {\n\t\t\t\tlayout: defaultLayout.layout?.editors,\n\t\t\t\tfilesToOpenOrCreate: defaultLayout?.editors?.map(editor => {\n\t\t\t\t\treturn {\n\t\t\t\t\t\tviewColumn: editor.viewColumn,\n\t\t\t\t\t\tfileUri: URI.revive(editor.uri),\n\t\t\t\t\t\topenOnlyIfExists: editor.openOnlyIfExists,\n\t\t\t\t\t\toptions: editor.options\n\t\t\t\t\t};\n\t\t\t\t})\n\t\t\t};\n\t\t}\n\n\t\t// Then check for files to open, create or diff/merge from main side\n\t\tconst { filesToOpenOrCreate, filesToDiff, filesToMerge } = this.environmentService;\n\t\tif (filesToOpenOrCreate || filesToDiff || filesToMerge) {\n\t\t\treturn { filesToOpenOrCreate, filesToDiff, filesToMerge };\n\t\t}\n\n\t\treturn undefined;\n\t}\n\n\tprivate readonly whenReadyPromise = new DeferredPromise<void>();\n\tprotected readonly whenReady = this.whenReadyPromise.p;\n\n\tprivate readonly whenRestoredPromise = new DeferredPromise<void>();\n\treadonly whenRestored = this.whenRestoredPromise.p;\n\tprivate restored = false;\n\n\tisRestored(): boolean {\n\t\treturn this.restored;\n\t}\n\n\tprotected restoreParts(): void {\n\n\t\t// distinguish long running restore operations that\n\t\t// are required for the layout to be ready from those\n\t\t// that are needed to signal restoring is done\n\t\tconst layoutReadyPromises: Promise<unknown>[] = [];\n\t\tconst layoutRestoredPromises: Promise<unknown>[] = [];\n\n\t\t// Restore editors\n\t\tlayoutReadyPromises.push((async () => {\n\t\t\tmark('code/willRestoreEditors');\n\n\t\t\t// first ensure the editor part is ready\n\t\t\tawait this.editorGroupService.whenReady;\n\t\t\tmark('code/restoreEditors/editorGroupsReady');\n\n\t\t\t// apply editor layout if any\n\t\t\tif (this.state.initialization.layout?.editors) {\n\t\t\t\tthis.editorGroupService.mainPart.applyLayout(this.state.initialization.layout.editors);\n\t\t\t}\n\n\t\t\t// then see for editors to open as instructed\n\t\t\t// it is important that we trigger this from\n\t\t\t// the overall restore flow to reduce possible\n\t\t\t// flicker on startup: we want any editor to\n\t\t\t// open to get a chance to open first before\n\t\t\t// signaling that layout is restored, but we do\n\t\t\t// not need to await the editors from having\n\t\t\t// fully loaded.\n\n\t\t\tconst editors = await this.state.initialization.editor.editorsToOpen;\n\t\t\tmark('code/restoreEditors/editorsToOpenResolved');\n\n\t\t\tlet openEditorsPromise: Promise<unknown> | undefined = undefined;\n\t\t\tif (editors.length) {\n\n\t\t\t\t// we have to map editors to their groups as instructed\n\t\t\t\t// by the input. this is important to ensure that we open\n\t\t\t\t// the editors in the groups they belong to.\n\n\t\t\t\tconst editorGroupsInVisualOrder = this.editorGroupService.mainPart.getGroups(GroupsOrder.GRID_APPEARANCE);\n\t\t\t\tconst mapEditorsToGroup = new Map<GroupIdentifier, Set<IUntypedEditorInput>>();\n\n\t\t\t\tfor (const editor of editors) {\n\t\t\t\t\tconst group = editorGroupsInVisualOrder[(editor.viewColumn ?? 1) - 1]; // viewColumn is index+1 based\n\n\t\t\t\t\tlet editorsByGroup = mapEditorsToGroup.get(group.id);\n\t\t\t\t\tif (!editorsByGroup) {\n\t\t\t\t\t\teditorsByGroup = new Set<IUntypedEditorInput>();\n\t\t\t\t\t\tmapEditorsToGroup.set(group.id, editorsByGroup);\n\t\t\t\t\t}\n\n\t\t\t\t\teditorsByGroup.add(editor.editor);\n\t\t\t\t}\n\n\t\t\t\topenEditorsPromise = Promise.all(Array.from(mapEditorsToGroup).map(async ([groupId, editors]) => {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tawait this.editorService.openEditors(Array.from(editors), groupId, { validateTrust: true });\n\t\t\t\t\t} catch (error) {\n\t\t\t\t\t\tthis.logService.error(error);\n\t\t\t\t\t}\n\t\t\t\t}));\n\t\t\t}\n\n\t\t\t// do not block the overall layout ready flow from potentially\n\t\t\t// slow editors to resolve on startup\n\t\t\tlayoutRestoredPromises.push(\n\t\t\t\tPromise.all([\n\t\t\t\t\topenEditorsPromise?.finally(() => mark('code/restoreEditors/editorsOpened')),\n\t\t\t\t\tthis.editorGroupService.whenRestored.finally(() => mark('code/restoreEditors/editorGroupsRestored'))\n\t\t\t\t]).finally(() => {\n\t\t\t\t\t// the `code/didRestoreEditors` perf mark is specifically\n\t\t\t\t\t// for when visible editors have resolved, so we only mark\n\t\t\t\t\t// if when editor group service has restored.\n\t\t\t\t\tmark('code/didRestoreEditors');\n\t\t\t\t})\n\t\t\t);\n\t\t})());\n\n\t\t// Restore default views (only when `IDefaultLayout` is provided)\n\t\tconst restoreDefaultViewsPromise = (async () => {\n\t\t\tif (this.state.initialization.views.defaults?.length) {\n\t\t\t\tmark('code/willOpenDefaultViews');\n\n\t\t\t\tconst locationsRestored: { id: string; order: number }[] = [];\n\n\t\t\t\tconst tryOpenView = (view: { id: string; order: number }): boolean => {\n\t\t\t\t\tconst location = this.viewDescriptorService.getViewLocationById(view.id);\n\t\t\t\t\tif (location !== null) {\n\t\t\t\t\t\tconst container = this.viewDescriptorService.getViewContainerByViewId(view.id);\n\t\t\t\t\t\tif (container) {\n\t\t\t\t\t\t\tif (view.order >= (locationsRestored?.[location]?.order ?? 0)) {\n\t\t\t\t\t\t\t\tlocationsRestored[location] = { id: container.id, order: view.order };\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tconst containerModel = this.viewDescriptorService.getViewContainerModel(container);\n\t\t\t\t\t\t\tcontainerModel.setCollapsed(view.id, false);\n\t\t\t\t\t\t\tcontainerModel.setVisible(view.id, true);\n\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\treturn false;\n\t\t\t\t};\n\n\t\t\t\tconst defaultViews = [...this.state.initialization.views.defaults].reverse().map((v, index) => ({ id: v, order: index }));\n\n\t\t\t\tlet i = defaultViews.length;\n\t\t\t\twhile (i) {\n\t\t\t\t\ti--;\n\t\t\t\t\tif (tryOpenView(defaultViews[i])) {\n\t\t\t\t\t\tdefaultViews.splice(i, 1);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// If we still have views left over, wait until all extensions have been registered and try again\n\t\t\t\tif (defaultViews.length) {\n\t\t\t\t\tawait this.extensionService.whenInstalledExtensionsRegistered();\n\n\t\t\t\t\tlet i = defaultViews.length;\n\t\t\t\t\twhile (i) {\n\t\t\t\t\t\ti--;\n\t\t\t\t\t\tif (tryOpenView(defaultViews[i])) {\n\t\t\t\t\t\t\tdefaultViews.splice(i, 1);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// If we opened a view in the sidebar, stop any restore there\n\t\t\t\tif (locationsRestored[ViewContainerLocation.Sidebar]) {\n\t\t\t\t\tthis.state.initialization.views.containerToRestore.sideBar = locationsRestored[ViewContainerLocation.Sidebar].id;\n\t\t\t\t}\n\n\t\t\t\t// If we opened a view in the panel, stop any restore there\n\t\t\t\tif (locationsRestored[ViewContainerLocation.Panel]) {\n\t\t\t\t\tthis.state.initialization.views.containerToRestore.panel = locationsRestored[ViewContainerLocation.Panel].id;\n\t\t\t\t}\n\n\t\t\t\t// If we opened a view in the auxiliary bar, stop any restore there\n\t\t\t\tif (locationsRestored[ViewContainerLocation.AuxiliaryBar]) {\n\t\t\t\t\tthis.state.initialization.views.containerToRestore.auxiliaryBar = locationsRestored[ViewContainerLocation.AuxiliaryBar].id;\n\t\t\t\t}\n\n\t\t\t\tmark('code/didOpenDefaultViews');\n\t\t\t}\n\t\t})();\n\t\tlayoutReadyPromises.push(restoreDefaultViewsPromise);\n\n\t\t// Restore Sidebar\n\t\tlayoutReadyPromises.push((async () => {\n\n\t\t\t// Restoring views could mean that sidebar already\n\t\t\t// restored, as such we need to test again\n\t\t\tawait restoreDefaultViewsPromise;\n\t\t\tif (!this.state.initialization.views.containerToRestore.sideBar) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tmark('code/willRestoreViewlet');\n\n\t\t\tawait this.openViewContainer(ViewContainerLocation.Sidebar, this.state.initialization.views.containerToRestore.sideBar);\n\n\t\t\tmark('code/didRestoreViewlet');\n\t\t})());\n\n\t\t// Restore Panel\n\t\tlayoutReadyPromises.push((async () => {\n\n\t\t\t// Restoring views could mean that panel already\n\t\t\t// restored, as such we need to test again\n\t\t\tawait restoreDefaultViewsPromise;\n\t\t\tif (!this.state.initialization.views.containerToRestore.panel) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tmark('code/willRestorePanel');\n\n\t\t\tawait this.openViewContainer(ViewContainerLocation.Panel, this.state.initialization.views.containerToRestore.panel);\n\n\t\t\tmark('code/didRestorePanel');\n\t\t})());\n\n\t\t// Restore Auxiliary Bar\n\t\tlayoutReadyPromises.push((async () => {\n\n\t\t\t// Restoring views could mean that auxbar already\n\t\t\t// restored, as such we need to test again\n\t\t\tawait restoreDefaultViewsPromise;\n\t\t\tif (!this.state.initialization.views.containerToRestore.auxiliaryBar) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tmark('code/willRestoreAuxiliaryBar');\n\n\t\t\tawait this.openViewContainer(ViewContainerLocation.AuxiliaryBar, this.state.initialization.views.containerToRestore.auxiliaryBar);\n\n\t\t\tmark('code/didRestoreAuxiliaryBar');\n\t\t})());\n\n\t\t// Restore Zen Mode\n\t\tconst zenModeWasActive = this.isZenModeActive();\n\t\tconst restoreZenMode = getZenModeConfiguration(this.configurationService).restore;\n\n\t\tif (zenModeWasActive) {\n\t\t\tthis.setZenModeActive(!restoreZenMode);\n\t\t\tthis.toggleZenMode(false, true);\n\t\t}\n\n\t\t// Restore Main Editor Center Mode\n\t\tif (this.stateModel.getRuntimeValue(LayoutStateKeys.MAIN_EDITOR_CENTERED)) {\n\t\t\tthis.centerMainEditorLayout(true, true);\n\t\t}\n\n\t\t// Await for promises that we recorded to update\n\t\t// our ready and restored states properly.\n\t\tPromises.settled(layoutReadyPromises).finally(() => {\n\n\t\t\t// Focus the active maximized part in case we have\n\t\t\t// not yet focused a specific element and panel\n\t\t\t// or auxiliary bar are maximized.\n\t\t\tif (getActiveElement() === mainWindow.document.body && (this.isPanelMaximized() || this.isAuxiliaryBarMaximized())) {\n\t\t\t\tthis.focus();\n\t\t\t}\n\n\t\t\tthis.whenReadyPromise.complete();\n\n\t\t\tPromises.settled(layoutRestoredPromises).finally(() => {\n\t\t\t\tthis.restored = true;\n\t\t\t\tthis.whenRestoredPromise.complete();\n\t\t\t});\n\t\t});\n\t}\n\n\tprivate async openViewContainer(location: ViewContainerLocation, id: string, focus?: boolean): Promise<void> {\n\t\tlet viewContainer = await this.paneCompositeService.openPaneComposite(id, location, focus);\n\t\tif (viewContainer) {\n\t\t\treturn;\n\t\t}\n\n\t\t// fallback to default view container\n\t\tviewContainer = await this.paneCompositeService.openPaneComposite(this.viewDescriptorService.getDefaultViewContainer(location)?.id, location, focus);\n\t\tif (viewContainer) {\n\t\t\treturn;\n\t\t}\n\n\t\t// finally try to just open the first visible view container\n\t\tawait this.paneCompositeService.openPaneComposite(this.paneCompositeService.getVisiblePaneCompositeIds(location).at(0), location, focus);\n\t}\n\n\tregisterPart(part: Part): IDisposable {\n\t\tconst id = part.getId();\n\t\tthis.parts.set(id, part);\n\n\t\treturn toDisposable(() => this.parts.delete(id));\n\t}\n\n\tprotected getPart(key: Parts): Part {\n\t\tconst part = this.parts.get(key);\n\t\tif (!part) {\n\t\t\tthrow new Error(`Unknown part ${key}`);\n\t\t}\n\n\t\treturn part;\n\t}\n\n\tregisterNotifications(delegate: { onDidChangeNotificationsVisibility: Event<boolean> }): void {\n\t\tthis._register(delegate.onDidChangeNotificationsVisibility(visible => this._onDidChangeNotificationsVisibility.fire(visible)));\n\t}\n\n\thasFocus(part: Parts): boolean {\n\t\tconst container = this.getContainer(getActiveWindow(), part);\n\t\tif (!container) {\n\t\t\treturn false;\n\t\t}\n\n\t\tconst activeElement = getActiveElement();\n\t\tif (!activeElement) {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn isAncestorUsingFlowTo(activeElement, container);\n\t}\n\n\tprivate _getFocusedPart(): Parts | undefined {\n\t\tfor (const part of this.parts.keys()) {\n\t\t\tif (this.hasFocus(part as Parts)) {\n\t\t\t\treturn part as Parts;\n\t\t\t}\n\t\t}\n\n\t\treturn undefined;\n\t}\n\n\tfocusPart(part: MULTI_WINDOW_PARTS, targetWindow: Window): void;\n\tfocusPart(part: SINGLE_WINDOW_PARTS): void;\n\tfocusPart(part: Parts, targetWindow: Window = mainWindow): void {\n\t\tconst container = this.getContainer(targetWindow, part) ?? this.mainContainer;\n\n\t\tswitch (part) {\n\t\t\tcase Parts.EDITOR_PART:\n\t\t\t\tthis.editorGroupService.getPart(container).activeGroup.focus();\n\t\t\t\tbreak;\n\t\t\tcase Parts.PANEL_PART: {\n\t\t\t\tthis.paneCompositeService.getActivePaneComposite(ViewContainerLocation.Panel)?.focus();\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcase Parts.SIDEBAR_PART: {\n\t\t\t\tthis.paneCompositeService.getActivePaneComposite(ViewContainerLocation.Sidebar)?.focus();\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcase Parts.AUXILIARYBAR_PART: {\n\t\t\t\tthis.paneCompositeService.getActivePaneComposite(ViewContainerLocation.AuxiliaryBar)?.focus();\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcase Parts.ACTIVITYBAR_PART:\n\t\t\t\t(this.getPart(Parts.SIDEBAR_PART) as SidebarPart).focusActivityBar();\n\t\t\t\tbreak;\n\t\t\tcase Parts.STATUSBAR_PART:\n\t\t\t\tthis.statusBarService.getPart(container).focus();\n\t\t\t\tbreak;\n\t\t\tdefault: {\n\t\t\t\tcontainer?.focus();\n\t\t\t}\n\t\t}\n\t}\n\n\tgetContainer(targetWindow: Window): HTMLElement;\n\tgetContainer(targetWindow: Window, part: Parts): HTMLElement | undefined;\n\tgetContainer(targetWindow: Window, part?: Parts): HTMLElement | undefined {\n\t\tif (typeof part === 'undefined') {\n\t\t\treturn this.getContainerFromDocument(targetWindow.document);\n\t\t}\n\n\t\tif (targetWindow === mainWindow) {\n\t\t\treturn this.getPart(part).getContainer();\n\t\t}\n\n\t\t// Only some parts are supported for auxiliary windows\n\t\tlet partCandidate: unknown;\n\t\tif (part === Parts.EDITOR_PART) {\n\t\t\tpartCandidate = this.editorGroupService.getPart(this.getContainerFromDocument(targetWindow.document));\n\t\t} else if (part === Parts.STATUSBAR_PART) {\n\t\t\tpartCandidate = this.statusBarService.getPart(this.getContainerFromDocument(targetWindow.document));\n\t\t} else if (part === Parts.TITLEBAR_PART) {\n\t\t\tpartCandidate = this.titleService.getPart(this.getContainerFromDocument(targetWindow.document));\n\t\t}\n\n\t\tif (partCandidate instanceof Part) {\n\t\t\treturn partCandidate.getContainer();\n\t\t}\n\n\t\treturn undefined;\n\t}\n\n\tisVisible(part: MULTI_WINDOW_PARTS, targetWindow: Window): boolean;\n\tisVisible(part: SINGLE_WINDOW_PARTS): boolean;\n\tisVisible(part: Parts, targetWindow?: Window): boolean;\n\tisVisible(part: Parts, targetWindow: Window = mainWindow): boolean {\n\t\tif (targetWindow !== mainWindow && part === Parts.EDITOR_PART) {\n\t\t\treturn true; // cannot hide editor part in auxiliary windows\n\t\t}\n\n\t\tswitch (part) {\n\t\t\tcase Parts.TITLEBAR_PART:\n\t\t\t\treturn this.initialized ?\n\t\t\t\t\tthis.workbenchGrid.isViewVisible(this.titleBarPartView) :\n\t\t\t\t\tshouldShowCustomTitleBar(this.configurationService, mainWindow, this.state.runtime.menuBar.toggled);\n\t\t\tcase Parts.SIDEBAR_PART:\n\t\t\t\treturn !this.stateModel.getRuntimeValue(LayoutStateKeys.SIDEBAR_HIDDEN);\n\t\t\tcase Parts.PANEL_PART:\n\t\t\t\treturn !this.stateModel.getRuntimeValue(LayoutStateKeys.PANEL_HIDDEN);\n\t\t\tcase Parts.AUXILIARYBAR_PART:\n\t\t\t\treturn !this.stateModel.getRuntimeValue(LayoutStateKeys.AUXILIARYBAR_HIDDEN);\n\t\t\tcase Parts.STATUSBAR_PART:\n\t\t\t\treturn !this.stateModel.getRuntimeValue(LayoutStateKeys.STATUSBAR_HIDDEN);\n\t\t\tcase Parts.ACTIVITYBAR_PART:\n\t\t\t\treturn !this.stateModel.getRuntimeValue(LayoutStateKeys.ACTIVITYBAR_HIDDEN);\n\t\t\tcase Parts.EDITOR_PART:\n\t\t\t\treturn !this.stateModel.getRuntimeValue(LayoutStateKeys.EDITOR_HIDDEN);\n\t\t\tcase Parts.BANNER_PART:\n\t\t\t\treturn this.initialized ? this.workbenchGrid.isViewVisible(this.bannerPartView) : false;\n\t\t\tdefault:\n\t\t\t\treturn false; // any other part cannot be hidden\n\t\t}\n\t}\n\n\tprivate shouldShowBannerFirst(): boolean {\n\t\treturn isWeb && !isWCOEnabled();\n\t}\n\n\tfocus(): void {\n\t\tif (this.isPanelMaximized() && this.mainContainer === this.activeContainer) {\n\t\t\tthis.focusPart(Parts.PANEL_PART);\n\t\t} else if (this.isAuxiliaryBarMaximized() && this.mainContainer === this.activeContainer) {\n\t\t\tthis.focusPart(Parts.AUXILIARYBAR_PART);\n\t\t} else {\n\t\t\tthis.focusPart(Parts.EDITOR_PART, getWindow(this.activeContainer));\n\t\t}\n\t}\n\n\tprivate focusPanelOrEditor(): void {\n\t\tconst activePanel = this.paneCompositeService.getActivePaneComposite(ViewContainerLocation.Panel);\n\t\tif ((this.hasFocus(Parts.PANEL_PART) || !this.isVisible(Parts.EDITOR_PART)) && activePanel) {\n\t\t\tactivePanel.focus(); // prefer panel if it has focus or editor is hidden\n\t\t} else {\n\t\t\tthis.focus(); // otherwise focus editor\n\t\t}\n\t}\n\n\tgetMaximumEditorDimensions(container: HTMLElement): IDimension {\n\t\tconst targetWindow = getWindow(container);\n\t\tconst containerDimension = this.getContainerDimension(container);\n\n\t\tif (container === this.mainContainer) {\n\t\t\tconst isPanelHorizontal = isHorizontal(this.getPanelPosition());\n\t\t\tconst takenWidth =\n\t\t\t\t(this.isVisible(Parts.ACTIVITYBAR_PART) ? this.activityBarPartView.minimumWidth : 0) +\n\t\t\t\t(this.isVisible(Parts.SIDEBAR_PART) ? this.sideBarPartView.minimumWidth : 0) +\n\t\t\t\t(this.isVisible(Parts.PANEL_PART) && !isPanelHorizontal ? this.panelPartView.minimumWidth : 0) +\n\t\t\t\t(this.isVisible(Parts.AUXILIARYBAR_PART) ? this.auxiliaryBarPartView.minimumWidth : 0);\n\n\t\t\tconst takenHeight =\n\t\t\t\t(this.isVisible(Parts.TITLEBAR_PART, targetWindow) ? this.titleBarPartView.minimumHeight : 0) +\n\t\t\t\t(this.isVisible(Parts.STATUSBAR_PART, targetWindow) ? this.statusBarPartView.minimumHeight : 0) +\n\t\t\t\t(this.isVisible(Parts.PANEL_PART) && isPanelHorizontal ? this.panelPartView.minimumHeight : 0);\n\n\t\t\tconst availableWidth = containerDimension.width - takenWidth;\n\t\t\tconst availableHeight = containerDimension.height - takenHeight;\n\n\t\t\treturn { width: availableWidth, height: availableHeight };\n\t\t} else {\n\t\t\tconst takenHeight =\n\t\t\t\t(this.isVisible(Parts.TITLEBAR_PART, targetWindow) ? this.titleBarPartView.minimumHeight : 0) +\n\t\t\t\t(this.isVisible(Parts.STATUSBAR_PART, targetWindow) ? this.statusBarPartView.minimumHeight : 0);\n\n\t\t\treturn { width: containerDimension.width, height: containerDimension.height - takenHeight };\n\t\t}\n\t}\n\n\tprivate isZenModeActive(): boolean {\n\t\treturn this.stateModel.getRuntimeValue(LayoutStateKeys.ZEN_MODE_ACTIVE);\n\t}\n\n\tprivate setZenModeActive(active: boolean) {\n\t\tthis.stateModel.setRuntimeValue(LayoutStateKeys.ZEN_MODE_ACTIVE, active);\n\t}\n\n\ttoggleZenMode(skipLayout?: boolean, restoring = false): void {\n\t\tconst focusedPartPreTransition = this._getFocusedPart();\n\n\t\tthis.setZenModeActive(!this.isZenModeActive());\n\t\tthis.state.runtime.zenMode.transitionDisposables.clearAndDisposeAll();\n\n\t\tconst setLineNumbers = (lineNumbers?: LineNumbersType) => {\n\t\t\tfor (const editor of this.mainPartEditorService.visibleTextEditorControls) {\n\n\t\t\t\t// To properly reset line numbers we need to read the configuration for each editor respecting it's uri.\n\t\t\t\tif (!lineNumbers && isCodeEditor(editor) && editor.hasModel()) {\n\t\t\t\t\tconst model = editor.getModel();\n\t\t\t\t\tlineNumbers = this.configurationService.getValue('editor.lineNumbers', { resource: model.uri, overrideIdentifier: model.getLanguageId() });\n\t\t\t\t}\n\t\t\t\tif (!lineNumbers) {\n\t\t\t\t\tlineNumbers = this.configurationService.getValue('editor.lineNumbers');\n\t\t\t\t}\n\n\t\t\t\teditor.updateOptions({ lineNumbers });\n\t\t\t}\n\t\t};\n\n\t\t// Check if zen mode transitioned to full screen and if now we are out of zen mode\n\t\t// -> we need to go out of full screen (same goes for the centered editor layout)\n\t\tlet toggleMainWindowFullScreen = false;\n\t\tconst config = getZenModeConfiguration(this.configurationService);\n\t\tconst zenModeExitInfo = this.stateModel.getRuntimeValue(LayoutStateKeys.ZEN_MODE_EXIT_INFO);\n\n\t\t// Zen Mode Active\n\t\tif (this.isZenModeActive()) {\n\n\t\t\ttoggleMainWindowFullScreen = !this.state.runtime.mainWindowFullscreen && config.fullScreen && !isIOS;\n\n\t\t\tif (!restoring) {\n\t\t\t\tzenModeExitInfo.transitionedToFullScreen = toggleMainWindowFullScreen;\n\t\t\t\tzenModeExitInfo.transitionedToCenteredEditorLayout = !this.isMainEditorLayoutCentered() && config.centerLayout;\n\t\t\t\tzenModeExitInfo.handleNotificationsDoNotDisturbMode = this.notificationService.getFilter() === NotificationsFilter.OFF;\n\t\t\t\tzenModeExitInfo.wasVisible.sideBar = this.isVisible(Parts.SIDEBAR_PART);\n\t\t\t\tzenModeExitInfo.wasVisible.panel = this.isVisible(Parts.PANEL_PART);\n\t\t\t\tzenModeExitInfo.wasVisible.auxiliaryBar = this.isVisible(Parts.AUXILIARYBAR_PART);\n\t\t\t\tthis.stateModel.setRuntimeValue(LayoutStateKeys.ZEN_MODE_EXIT_INFO, zenModeExitInfo);\n\t\t\t}\n\n\t\t\tthis.setPanelHidden(true, true);\n\t\t\tthis.setAuxiliaryBarHidden(true, true);\n\t\t\tthis.setSideBarHidden(true);\n\n\t\t\tif (config.hideActivityBar) {\n\t\t\t\tthis.setActivityBarHidden(true);\n\t\t\t}\n\n\t\t\tif (config.hideStatusBar) {\n\t\t\t\tthis.setStatusBarHidden(true);\n\t\t\t}\n\n\t\t\tif (config.hideLineNumbers) {\n\t\t\t\tsetLineNumbers('off');\n\t\t\t\tthis.state.runtime.zenMode.transitionDisposables.set(ZenModeSettings.HIDE_LINENUMBERS, this.mainPartEditorService.onDidVisibleEditorsChange(() => setLineNumbers('off')));\n\t\t\t}\n\n\t\t\tif (config.showTabs !== this.editorGroupService.partOptions.showTabs) {\n\t\t\t\tthis.state.runtime.zenMode.transitionDisposables.set(ZenModeSettings.SHOW_TABS, this.editorGroupService.mainPart.enforcePartOptions({ showTabs: config.showTabs }));\n\t\t\t}\n\n\t\t\tif (config.silentNotifications && zenModeExitInfo.handleNotificationsDoNotDisturbMode) {\n\t\t\t\tthis.notificationService.setFilter(NotificationsFilter.ERROR);\n\t\t\t}\n\n\t\t\tif (config.centerLayout) {\n\t\t\t\tthis.centerMainEditorLayout(true, true);\n\t\t\t}\n\n\t\t\t// Zen Mode Configuration Changes\n\t\t\tthis.state.runtime.zenMode.transitionDisposables.set('configurationChange', this.configurationService.onDidChangeConfiguration(e => {\n\n\t\t\t\t// Activity Bar\n\t\t\t\tif (e.affectsConfiguration(ZenModeSettings.HIDE_ACTIVITYBAR) || e.affectsConfiguration(LayoutSettings.ACTIVITY_BAR_LOCATION)) {\n\t\t\t\t\tconst zenModeHideActivityBar = this.configurationService.getValue<boolean>(ZenModeSettings.HIDE_ACTIVITYBAR);\n\t\t\t\t\tconst activityBarLocation = this.configurationService.getValue<ActivityBarPosition>(LayoutSettings.ACTIVITY_BAR_LOCATION);\n\t\t\t\t\tthis.setActivityBarHidden(zenModeHideActivityBar ? true : (activityBarLocation === ActivityBarPosition.TOP || activityBarLocation === ActivityBarPosition.BOTTOM));\n\t\t\t\t}\n\n\t\t\t\t// Status Bar\n\t\t\t\tif (e.affectsConfiguration(ZenModeSettings.HIDE_STATUSBAR)) {\n\t\t\t\t\tconst zenModeHideStatusBar = this.configurationService.getValue<boolean>(ZenModeSettings.HIDE_STATUSBAR);\n\t\t\t\t\tthis.setStatusBarHidden(zenModeHideStatusBar);\n\t\t\t\t}\n\n\t\t\t\t// Center Layout\n\t\t\t\tif (e.affectsConfiguration(ZenModeSettings.CENTER_LAYOUT)) {\n\t\t\t\t\tconst zenModeCenterLayout = this.configurationService.getValue<boolean>(ZenModeSettings.CENTER_LAYOUT);\n\t\t\t\t\tthis.centerMainEditorLayout(zenModeCenterLayout, true);\n\t\t\t\t}\n\n\t\t\t\t// Show Tabs\n\t\t\t\tif (e.affectsConfiguration(ZenModeSettings.SHOW_TABS)) {\n\t\t\t\t\tconst zenModeShowTabs = this.configurationService.getValue<EditorTabsMode | undefined>(ZenModeSettings.SHOW_TABS) ?? 'multiple';\n\t\t\t\t\tthis.state.runtime.zenMode.transitionDisposables.set(ZenModeSettings.SHOW_TABS, this.editorGroupService.mainPart.enforcePartOptions({ showTabs: zenModeShowTabs }));\n\t\t\t\t}\n\n\t\t\t\t// Notifications\n\t\t\t\tif (e.affectsConfiguration(ZenModeSettings.SILENT_NOTIFICATIONS)) {\n\t\t\t\t\tconst zenModeSilentNotifications = !!this.configurationService.getValue(ZenModeSettings.SILENT_NOTIFICATIONS);\n\t\t\t\t\tif (zenModeExitInfo.handleNotificationsDoNotDisturbMode) {\n\t\t\t\t\t\tthis.notificationService.setFilter(zenModeSilentNotifications ? NotificationsFilter.ERROR : NotificationsFilter.OFF);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Center Layout\n\t\t\t\tif (e.affectsConfiguration(ZenModeSettings.HIDE_LINENUMBERS)) {\n\t\t\t\t\tconst lineNumbersType = this.configurationService.getValue<boolean>(ZenModeSettings.HIDE_LINENUMBERS) ? 'off' : undefined;\n\t\t\t\t\tsetLineNumbers(lineNumbersType);\n\t\t\t\t\tthis.state.runtime.zenMode.transitionDisposables.set(ZenModeSettings.HIDE_LINENUMBERS, this.mainPartEditorService.onDidVisibleEditorsChange(() => setLineNumbers(lineNumbersType)));\n\t\t\t\t}\n\t\t\t}));\n\t\t}\n\n\t\t// Zen Mode Inactive\n\t\telse {\n\t\t\tif (zenModeExitInfo.wasVisible.panel) {\n\t\t\t\tthis.setPanelHidden(false, true);\n\t\t\t}\n\n\t\t\tif (zenModeExitInfo.wasVisible.auxiliaryBar) {\n\t\t\t\tthis.setAuxiliaryBarHidden(false, true);\n\t\t\t}\n\n\t\t\tif (zenModeExitInfo.wasVisible.sideBar) {\n\t\t\t\tthis.setSideBarHidden(false);\n\t\t\t}\n\n\t\t\tif (!this.stateModel.getRuntimeValue(LayoutStateKeys.ACTIVITYBAR_HIDDEN, true)) {\n\t\t\t\tthis.setActivityBarHidden(false);\n\t\t\t}\n\n\t\t\tif (!this.stateModel.getRuntimeValue(LayoutStateKeys.STATUSBAR_HIDDEN, true)) {\n\t\t\t\tthis.setStatusBarHidden(false);\n\t\t\t}\n\n\t\t\tif (zenModeExitInfo.transitionedToCenteredEditorLayout) {\n\t\t\t\tthis.centerMainEditorLayout(false, true);\n\t\t\t}\n\n\t\t\tif (zenModeExitInfo.handleNotificationsDoNotDisturbMode) {\n\t\t\t\tthis.notificationService.setFilter(NotificationsFilter.OFF);\n\t\t\t}\n\n\t\t\tsetLineNumbers();\n\n\t\t\ttoggleMainWindowFullScreen = zenModeExitInfo.transitionedToFullScreen && this.state.runtime.mainWindowFullscreen;\n\t\t}\n\n\t\tif (!skipLayout) {\n\t\t\tthis.layout();\n\t\t}\n\n\t\tif (toggleMainWindowFullScreen) {\n\t\t\tthis.hostService.toggleFullScreen(mainWindow);\n\t\t}\n\n\t\t// restore focus if part is still visible, otherwise fallback to editor\n\t\tif (focusedPartPreTransition && this.isVisible(focusedPartPreTransition, getWindow(this.activeContainer))) {\n\t\t\tif (isMultiWindowPart(focusedPartPreTransition)) {\n\t\t\t\tthis.focusPart(focusedPartPreTransition, getWindow(this.activeContainer));\n\t\t\t} else {\n\t\t\t\tthis.focusPart(focusedPartPreTransition);\n\t\t\t}\n\t\t} else {\n\t\t\tthis.focus();\n\t\t}\n\n\t\t// Event\n\t\tthis._onDidChangeZenMode.fire(this.isZenModeActive());\n\t}\n\n\tprivate setStatusBarHidden(hidden: boolean): void {\n\t\tthis.stateModel.setRuntimeValue(LayoutStateKeys.STATUSBAR_HIDDEN, hidden);\n\n\t\t// Adjust CSS\n\t\tif (hidden) {\n\t\t\tthis.mainContainer.classList.add(LayoutClasses.STATUSBAR_HIDDEN);\n\t\t} else {\n\t\t\tthis.mainContainer.classList.remove(LayoutClasses.STATUSBAR_HIDDEN);\n\t\t}\n\n\t\t// Propagate to grid\n\t\tthis.workbenchGrid.setViewVisible(this.statusBarPartView, !hidden);\n\t}\n\n\tprotected createWorkbenchLayout(): void {\n\t\tconst titleBar = this.getPart(Parts.TITLEBAR_PART);\n\t\tconst bannerPart = this.getPart(Parts.BANNER_PART);\n\t\tconst editorPart = this.getPart(Parts.EDITOR_PART);\n\t\tconst activityBar = this.getPart(Parts.ACTIVITYBAR_PART);\n\t\tconst panelPart = this.getPart(Parts.PANEL_PART);\n\t\tconst auxiliaryBarPart = this.getPart(Parts.AUXILIARYBAR_PART);\n\t\tconst sideBar = this.getPart(Parts.SIDEBAR_PART);\n\t\tconst statusBar = this.getPart(Parts.STATUSBAR_PART);\n\n\t\t// View references for all parts\n\t\tthis.titleBarPartView = titleBar;\n\t\tthis.bannerPartView = bannerPart;\n\t\tthis.sideBarPartView = sideBar;\n\t\tthis.activityBarPartView = activityBar;\n\t\tthis.editorPartView = editorPart;\n\t\tthis.panelPartView = panelPart;\n\t\tthis.auxiliaryBarPartView = auxiliaryBarPart;\n\t\tthis.statusBarPartView = statusBar;\n\n\t\tconst viewMap = {\n\t\t\t[Parts.ACTIVITYBAR_PART]: this.activityBarPartView,\n\t\t\t[Parts.BANNER_PART]: this.bannerPartView,\n\t\t\t[Parts.TITLEBAR_PART]: this.titleBarPartView,\n\t\t\t[Parts.EDITOR_PART]: this.editorPartView,\n\t\t\t[Parts.PANEL_PART]: this.panelPartView,\n\t\t\t[Parts.SIDEBAR_PART]: this.sideBarPartView,\n\t\t\t[Parts.STATUSBAR_PART]: this.statusBarPartView,\n\t\t\t[Parts.AUXILIARYBAR_PART]: this.auxiliaryBarPartView\n\t\t};\n\n\t\tconst fromJSON = ({ type }: { type: Parts }) => viewMap[type];\n\t\tconst workbenchGrid = SerializableGrid.deserialize(\n\t\t\tthis.createGridDescriptor(),\n\t\t\t{ fromJSON },\n\t\t\t{ proportionalLayout: false }\n\t\t);\n\n\t\tthis.mainContainer.prepend(workbenchGrid.element);\n\t\tthis.mainContainer.setAttribute('role', 'application');\n\t\tthis.workbenchGrid = workbenchGrid;\n\t\tthis.workbenchGrid.edgeSnapping = this.state.runtime.mainWindowFullscreen;\n\n\t\tfor (const part of [titleBar, editorPart, activityBar, panelPart, sideBar, statusBar, auxiliaryBarPart, bannerPart]) {\n\t\t\tthis._register(part.onDidVisibilityChange(visible => {\n\t\t\t\tif (!this.inMaximizedAuxiliaryBarTransition) {\n\n\t\t\t\t\t// skip reacting when we are transitioning\n\t\t\t\t\t// in or out of maximised auxiliary bar to prevent\n\t\t\t\t\t// stepping on each other toes because this\n\t\t\t\t\t// transition is already dealing with all parts\n\t\t\t\t\t// visibility efficiently.\n\n\t\t\t\t\tif (part === sideBar) {\n\t\t\t\t\t\tthis.setSideBarHidden(!visible);\n\t\t\t\t\t} else if (part === panelPart) {\n\t\t\t\t\t\tthis.setPanelHidden(!visible, true);\n\t\t\t\t\t} else if (part === auxiliaryBarPart) {\n\t\t\t\t\t\tthis.setAuxiliaryBarHidden(!visible, true);\n\t\t\t\t\t} else if (part === editorPart) {\n\t\t\t\t\t\tthis.setEditorHidden(!visible);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tthis._onDidChangePartVisibility.fire();\n\t\t\t\tthis.handleContainerDidLayout(this.mainContainer, this._mainContainerDimension);\n\t\t\t}));\n\t\t}\n\n\t\tthis._register(this.storageService.onWillSaveState(() => {\n\n\t\t\t// Side Bar Size\n\t\t\tconst sideBarSize = this.stateModel.getRuntimeValue(LayoutStateKeys.SIDEBAR_HIDDEN)\n\t\t\t\t? this.workbenchGrid.getViewCachedVisibleSize(this.sideBarPartView)\n\t\t\t\t: this.workbenchGrid.getViewSize(this.sideBarPartView).width;\n\t\t\tthis.stateModel.setInitializationValue(LayoutStateKeys.SIDEBAR_SIZE, sideBarSize as number);\n\n\t\t\t// Panel Size\n\t\t\tconst panelSize = this.stateModel.getRuntimeValue(LayoutStateKeys.PANEL_HIDDEN)\n\t\t\t\t? this.workbenchGrid.getViewCachedVisibleSize(this.panelPartView)\n\t\t\t\t: isHorizontal(this.stateModel.getRuntimeValue(LayoutStateKeys.PANEL_POSITION))\n\t\t\t\t\t? this.workbenchGrid.getViewSize(this.panelPartView).height\n\t\t\t\t\t: this.workbenchGrid.getViewSize(this.panelPartView).width;\n\t\t\tthis.stateModel.setInitializationValue(LayoutStateKeys.PANEL_SIZE, panelSize as number);\n\n\t\t\t// Auxiliary Bar Size\n\t\t\tconst auxiliaryBarSize = this.stateModel.getRuntimeValue(LayoutStateKeys.AUXILIARYBAR_HIDDEN)\n\t\t\t\t? this.workbenchGrid.getViewCachedVisibleSize(this.auxiliaryBarPartView)\n\t\t\t\t: this.workbenchGrid.getViewSize(this.auxiliaryBarPartView).width;\n\t\t\tthis.stateModel.setInitializationValue(LayoutStateKeys.AUXILIARYBAR_SIZE, auxiliaryBarSize as number);\n\n\t\t\tthis.stateModel.save(true, true);\n\t\t}));\n\n\t\tthis._register(Event.any(this.paneCompositeService.onDidPaneCompositeOpen, this.paneCompositeService.onDidPaneCompositeClose)(() => {\n\n\t\t\t// Auxiliary Bar State\n\t\t\tthis.stateModel.setInitializationValue(LayoutStateKeys.AUXILIARYBAR_EMPTY, this.paneCompositeService.getPaneCompositeIds(ViewContainerLocation.AuxiliaryBar).length === 0);\n\t\t}));\n\t}\n\n\tlayout(): void {\n\t\tif (!this.disposed) {\n\t\t\tthis._mainContainerDimension = getClientArea(this.state.runtime.mainWindowFullscreen ?\n\t\t\t\tmainWindow.document.body : \t// in fullscreen mode, make sure to use <body> element because\n\t\t\t\tthis.parent,\t\t\t\t// in that case the workbench will span the entire site\n\t\t\t\tthis.contextService.getWorkbenchState() === WorkbenchState.EMPTY ? DEFAULT_EMPTY_WINDOW_DIMENSIONS : DEFAULT_WORKSPACE_WINDOW_DIMENSIONS // running with fallback to ensure no error is thrown (https://github.com/microsoft/vscode/issues/240242)\n\t\t\t);\n\t\t\tthis.logService.trace(`Layout#layout, height: ${this._mainContainerDimension.height}, width: ${this._mainContainerDimension.width}`);\n\n\t\t\tsize(this.mainContainer, this._mainContainerDimension.width, this._mainContainerDimension.height);\n\n\t\t\t// Layout the grid widget\n\t\t\tthis.workbenchGrid.layout(this._mainContainerDimension.width, this._mainContainerDimension.height);\n\t\t\tthis.initialized = true;\n\n\t\t\t// Emit as event\n\t\t\tthis.handleContainerDidLayout(this.mainContainer, this._mainContainerDimension);\n\t\t}\n\t}\n\n\tisMainEditorLayoutCentered(): boolean {\n\t\treturn this.stateModel.getRuntimeValue(LayoutStateKeys.MAIN_EDITOR_CENTERED);\n\t}\n\n\tcenterMainEditorLayout(active: boolean, skipLayout?: boolean): void {\n\t\tthis.stateModel.setRuntimeValue(LayoutStateKeys.MAIN_EDITOR_CENTERED, active);\n\n\t\tconst mainVisibleEditors = coalesce(this.editorGroupService.mainPart.groups.map(group => group.activeEditor));\n\t\tconst isEditorComplex = mainVisibleEditors.some(editor => {\n\t\t\tif (editor instanceof DiffEditorInput) {\n\t\t\t\treturn this.configurationService.getValue('diffEditor.renderSideBySide');\n\t\t\t}\n\n\t\t\tif (editor?.hasCapability(EditorInputCapabilities.MultipleEditors)) {\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\treturn false;\n\t\t});\n\n\t\tconst layout = this.editorGroupService.getLayout();\n\t\tlet hasMoreThanOneColumn = false;\n\t\tif (layout.orientation === GroupOrientation.HORIZONTAL) {\n\t\t\thasMoreThanOneColumn = layout.groups.length > 1;\n\t\t} else {\n\t\t\thasMoreThanOneColumn = layout.groups.some(group => group.groups && group.groups.length > 1);\n\t\t}\n\n\t\tconst isCenteredLayoutAutoResizing = this.configurationService.getValue('workbench.editor.centeredLayoutAutoResize');\n\t\tif (\n\t\t\tisCenteredLayoutAutoResizing &&\n\t\t\t((hasMoreThanOneColumn && !this.editorGroupService.mainPart.hasMaximizedGroup()) || isEditorComplex)\n\t\t) {\n\t\t\tactive = false; // disable centered layout for complex editors or when there is more than one group\n\t\t}\n\n\t\tif (this.editorGroupService.mainPart.isLayoutCentered() !== active) {\n\t\t\tthis.editorGroupService.mainPart.centerLayout(active);\n\n\t\t\tif (!skipLayout) {\n\t\t\t\tthis.layout();\n\t\t\t}\n\t\t}\n\n\t\tthis._onDidChangeMainEditorCenteredLayout.fire(this.stateModel.getRuntimeValue(LayoutStateKeys.MAIN_EDITOR_CENTERED));\n\t}\n\n\tgetSize(part: Parts): IViewSize {\n\t\treturn this.workbenchGrid.getViewSize(this.getPart(part));\n\t}\n\n\tsetSize(part: Parts, size: IViewSize): void {\n\t\tthis.workbenchGrid.resizeView(this.getPart(part), size);\n\t}\n\n\tresizePart(part: Parts, sizeChangeWidth: number, sizeChangeHeight: number): void {\n\t\tconst sizeChangePxWidth = Math.sign(sizeChangeWidth) * computeScreenAwareSize(getActiveWindow(), Math.abs(sizeChangeWidth));\n\t\tconst sizeChangePxHeight = Math.sign(sizeChangeHeight) * computeScreenAwareSize(getActiveWindow(), Math.abs(sizeChangeHeight));\n\n\t\tlet viewSize: IViewSize;\n\n\t\tswitch (part) {\n\t\t\tcase Parts.SIDEBAR_PART:\n\t\t\t\tviewSize = this.workbenchGrid.getViewSize(this.sideBarPartView);\n\t\t\t\tthis.workbenchGrid.resizeView(this.sideBarPartView, {\n\t\t\t\t\twidth: viewSize.width + sizeChangePxWidth,\n\t\t\t\t\theight: viewSize.height\n\t\t\t\t});\n\n\t\t\t\tbreak;\n\t\t\tcase Parts.PANEL_PART:\n\t\t\t\tviewSize = this.workbenchGrid.getViewSize(this.panelPartView);\n\n\t\t\t\tthis.workbenchGrid.resizeView(this.panelPartView, {\n\t\t\t\t\twidth: viewSize.width + (isHorizontal(this.getPanelPosition()) ? 0 : sizeChangePxWidth),\n\t\t\t\t\theight: viewSize.height + (isHorizontal(this.getPanelPosition()) ? sizeChangePxHeight : 0)\n\t\t\t\t});\n\n\t\t\t\tbreak;\n\t\t\tcase Parts.AUXILIARYBAR_PART:\n\t\t\t\tviewSize = this.workbenchGrid.getViewSize(this.auxiliaryBarPartView);\n\t\t\t\tthis.workbenchGrid.resizeView(this.auxiliaryBarPartView, {\n\t\t\t\t\twidth: viewSize.width + sizeChangePxWidth,\n\t\t\t\t\theight: viewSize.height\n\t\t\t\t});\n\t\t\t\tbreak;\n\t\t\tcase Parts.EDITOR_PART:\n\t\t\t\tviewSize = this.workbenchGrid.getViewSize(this.editorPartView);\n\n\t\t\t\t// Single Editor Group\n\t\t\t\tif (this.editorGroupService.mainPart.count === 1) {\n\t\t\t\t\tthis.workbenchGrid.resizeView(this.editorPartView, {\n\t\t\t\t\t\twidth: viewSize.width + sizeChangePxWidth,\n\t\t\t\t\t\theight: viewSize.height + sizeChangePxHeight\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tconst activeGroup = this.editorGroupService.mainPart.activeGroup;\n\n\t\t\t\t\tconst { width, height } = this.editorGroupService.mainPart.getSize(activeGroup);\n\t\t\t\t\tthis.editorGroupService.mainPart.setSize(activeGroup, { width: width + sizeChangePxWidth, height: height + sizeChangePxHeight });\n\n\t\t\t\t\t// After resizing the editor group\n\t\t\t\t\t// if it does not change in either direction\n\t\t\t\t\t// try resizing the full editor part\n\t\t\t\t\tconst { width: newWidth, height: newHeight } = this.editorGroupService.mainPart.getSize(activeGroup);\n\t\t\t\t\tif ((sizeChangePxHeight && height === newHeight) || (sizeChangePxWidth && width === newWidth)) {\n\t\t\t\t\t\tthis.workbenchGrid.resizeView(this.editorPartView, {\n\t\t\t\t\t\t\twidth: viewSize.width + (sizeChangePxWidth && width === newWidth ? sizeChangePxWidth : 0),\n\t\t\t\t\t\t\theight: viewSize.height + (sizeChangePxHeight && height === newHeight ? sizeChangePxHeight : 0)\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\treturn; // Cannot resize other parts\n\t\t}\n\t}\n\n\tprivate setActivityBarHidden(hidden: boolean): void {\n\t\tthis.stateModel.setRuntimeValue(LayoutStateKeys.ACTIVITYBAR_HIDDEN, hidden);\n\t\tthis.workbenchGrid.setViewVisible(this.activityBarPartView, !hidden);\n\t}\n\n\tprivate setBannerHidden(hidden: boolean): void {\n\t\tthis.workbenchGrid.setViewVisible(this.bannerPartView, !hidden);\n\t}\n\n\tprivate setEditorHidden(hidden: boolean): void {\n\t\tif (!hidden && this.setAuxiliaryBarMaximized(false) && this.isVisible(Parts.EDITOR_PART)) {\n\t\t\treturn; // return: leaving maximised auxiliary bar made this part visible\n\t\t}\n\n\t\tthis.stateModel.setRuntimeValue(LayoutStateKeys.EDITOR_HIDDEN, hidden);\n\n\t\t// Adjust CSS\n\t\tif (hidden) {\n\t\t\tthis.mainContainer.classList.add(LayoutClasses.MAIN_EDITOR_AREA_HIDDEN);\n\t\t} else {\n\t\t\tthis.mainContainer.classList.remove(LayoutClasses.MAIN_EDITOR_AREA_HIDDEN);\n\t\t}\n\n\t\t// Propagate to grid\n\t\tthis.workbenchGrid.setViewVisible(this.editorPartView, !hidden);\n\n\t\t// The editor and panel cannot be hidden at the same time\n\t\t// unless we have a maximized auxiliary bar\n\t\tif (hidden && !this.isVisible(Parts.PANEL_PART) && !this.isAuxiliaryBarMaximized()) {\n\t\t\tthis.setPanelHidden(false, true);\n\t\t}\n\t}\n\n\tgetLayoutClasses(): string[] {\n\t\treturn coalesce([\n\t\t\t!this.isVisible(Parts.SIDEBAR_PART) ? LayoutClasses.SIDEBAR_HIDDEN : undefined,\n\t\t\t!this.isVisible(Parts.EDITOR_PART, mainWindow) ? LayoutClasses.MAIN_EDITOR_AREA_HIDDEN : undefined,\n\t\t\t!this.isVisible(Parts.PANEL_PART) ? LayoutClasses.PANEL_HIDDEN : undefined,\n\t\t\t!this.isVisible(Parts.AUXILIARYBAR_PART) ? LayoutClasses.AUXILIARYBAR_HIDDEN : undefined,\n\t\t\t!this.isVisible(Parts.STATUSBAR_PART) ? LayoutClasses.STATUSBAR_HIDDEN : undefined,\n\t\t\tthis.state.runtime.mainWindowFullscreen ? LayoutClasses.FULLSCREEN : undefined\n\t\t]);\n\t}\n\n\tprivate setSideBarHidden(hidden: boolean): void {\n\t\tif (!hidden && this.setAuxiliaryBarMaximized(false) && this.isVisible(Parts.SIDEBAR_PART)) {\n\t\t\treturn; // return: leaving maximised auxiliary bar made this part visible\n\t\t}\n\n\t\tthis.stateModel.setRuntimeValue(LayoutStateKeys.SIDEBAR_HIDDEN, hidden);\n\n\t\t// Adjust CSS\n\t\tif (hidden) {\n\t\t\tthis.mainContainer.classList.add(LayoutClasses.SIDEBAR_HIDDEN);\n\t\t} else {\n\t\t\tthis.mainContainer.classList.remove(LayoutClasses.SIDEBAR_HIDDEN);\n\t\t}\n\n\t\t// If sidebar becomes hidden, also hide the current active Viewlet if any\n\t\tif (hidden && this.paneCompositeService.getActivePaneComposite(ViewContainerLocation.Sidebar)) {\n\t\t\tthis.paneCompositeService.hideActivePaneComposite(ViewContainerLocation.Sidebar);\n\n\t\t\tif (!this.isAuxiliaryBarMaximized()) {\n\t\t\t\tthis.focusPanelOrEditor(); // do not auto focus when auxiliary bar is maximized\n\t\t\t}\n\t\t}\n\n\t\t// If sidebar becomes visible, show last active Viewlet or default viewlet\n\t\telse if (!hidden && !this.paneCompositeService.getActivePaneComposite(ViewContainerLocation.Sidebar)) {\n\t\t\tconst viewletToOpen = this.paneCompositeService.getLastActivePaneCompositeId(ViewContainerLocation.Sidebar);\n\t\t\tif (viewletToOpen) {\n\t\t\t\tthis.openViewContainer(ViewContainerLocation.Sidebar, viewletToOpen, true);\n\t\t\t}\n\t\t}\n\n\t\t// Propagate to grid\n\t\tthis.workbenchGrid.setViewVisible(this.sideBarPartView, !hidden);\n\t}\n\n\tprivate hasViews(id: string): boolean {\n\t\tconst viewContainer = this.viewDescriptorService.getViewContainerById(id);\n\t\tif (!viewContainer) {\n\t\t\treturn false;\n\t\t}\n\n\t\tconst viewContainerModel = this.viewDescriptorService.getViewContainerModel(viewContainer);\n\t\tif (!viewContainerModel) {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn viewContainerModel.activeViewDescriptors.length >= 1;\n\t}\n\n\tprivate adjustPartPositions(sideBarPosition: Position, panelAlignment: PanelAlignment, panelPosition: Position): void {\n\n\t\t// Move activity bar and side bars\n\t\tconst isPanelVertical = !isHorizontal(panelPosition);\n\t\tconst sideBarSiblingToEditor = isPanelVertical || !(panelAlignment === 'center' || (sideBarPosition === Position.LEFT && panelAlignment === 'right') || (sideBarPosition === Position.RIGHT && panelAlignment === 'left'));\n\t\tconst auxiliaryBarSiblingToEditor = isPanelVertical || !(panelAlignment === 'center' || (sideBarPosition === Position.RIGHT && panelAlignment === 'right') || (sideBarPosition === Position.LEFT && panelAlignment === 'left'));\n\t\tconst preMovePanelWidth = !this.isVisible(Parts.PANEL_PART) ? Sizing.Invisible(this.workbenchGrid.getViewCachedVisibleSize(this.panelPartView) ?? this.panelPartView.minimumWidth) : this.workbenchGrid.getViewSize(this.panelPartView).width;\n\t\tconst preMovePanelHeight = !this.isVisible(Parts.PANEL_PART) ? Sizing.Invisible(this.workbenchGrid.getViewCachedVisibleSize(this.panelPartView) ?? this.panelPartView.minimumHeight) : this.workbenchGrid.getViewSize(this.panelPartView).height;\n\t\tconst preMoveSideBarSize = !this.isVisible(Parts.SIDEBAR_PART) ? Sizing.Invisible(this.workbenchGrid.getViewCachedVisibleSize(this.sideBarPartView) ?? this.sideBarPartView.minimumWidth) : this.workbenchGrid.getViewSize(this.sideBarPartView).width;\n\t\tconst preMoveAuxiliaryBarSize = !this.isVisible(Parts.AUXILIARYBAR_PART) ? Sizing.Invisible(this.workbenchGrid.getViewCachedVisibleSize(this.auxiliaryBarPartView) ?? this.auxiliaryBarPartView.minimumWidth) : this.workbenchGrid.getViewSize(this.auxiliaryBarPartView).width;\n\n\t\tconst focusedPart = [Parts.PANEL_PART, Parts.SIDEBAR_PART, Parts.AUXILIARYBAR_PART].find(part => this.hasFocus(part)) as SINGLE_WINDOW_PARTS | undefined;\n\n\t\tif (sideBarPosition === Position.LEFT) {\n\t\t\tthis.workbenchGrid.moveViewTo(this.activityBarPartView, [2, 0]);\n\t\t\tthis.workbenchGrid.moveView(this.sideBarPartView, preMoveSideBarSize, sideBarSiblingToEditor ? this.editorPartView : this.activityBarPartView, sideBarSiblingToEditor ? Direction.Left : Direction.Right);\n\t\t\tif (auxiliaryBarSiblingToEditor) {\n\t\t\t\tthis.workbenchGrid.moveView(this.auxiliaryBarPartView, preMoveAuxiliaryBarSize, this.editorPartView, Direction.Right);\n\t\t\t} else {\n\t\t\t\tthis.workbenchGrid.moveViewTo(this.auxiliaryBarPartView, [2, -1]);\n\t\t\t}\n\t\t} else {\n\t\t\tthis.workbenchGrid.moveViewTo(this.activityBarPartView, [2, -1]);\n\t\t\tthis.workbenchGrid.moveView(this.sideBarPartView, preMoveSideBarSize, sideBarSiblingToEditor ? this.editorPartView : this.activityBarPartView, sideBarSiblingToEditor ? Direction.Right : Direction.Left);\n\t\t\tif (auxiliaryBarSiblingToEditor) {\n\t\t\t\tthis.workbenchGrid.moveView(this.auxiliaryBarPartView, preMoveAuxiliaryBarSize, this.editorPartView, Direction.Left);\n\t\t\t} else {\n\t\t\t\tthis.workbenchGrid.moveViewTo(this.auxiliaryBarPartView, [2, 0]);\n\t\t\t}\n\t\t}\n\n\t\t// Maintain focus after moving parts\n\t\tif (focusedPart) {\n\t\t\tthis.focusPart(focusedPart);\n\t\t}\n\n\t\t// We moved all the side parts based on the editor and ignored the panel\n\t\t// Now, we need to put the panel back in the right position when it is next to the editor\n\t\tif (isPanelVertical) {\n\t\t\tthis.workbenchGrid.moveView(this.panelPartView, preMovePanelWidth, this.editorPartView, panelPosition === Position.LEFT ? Direction.Left : Direction.Right);\n\t\t\tthis.workbenchGrid.resizeView(this.panelPartView, {\n\t\t\t\theight: preMovePanelHeight as number,\n\t\t\t\twidth: preMovePanelWidth as number\n\t\t\t});\n\t\t}\n\n\t\t// Moving views in the grid can cause them to re-distribute sizing unnecessarily\n\t\t// Resize visible parts to the width they were before the operation\n\t\tif (this.isVisible(Parts.SIDEBAR_PART)) {\n\t\t\tthis.workbenchGrid.resizeView(this.sideBarPartView, {\n\t\t\t\theight: this.workbenchGrid.getViewSize(this.sideBarPartView).height,\n\t\t\t\twidth: preMoveSideBarSize as number\n\t\t\t});\n\t\t}\n\n\t\tif (this.isVisible(Parts.AUXILIARYBAR_PART)) {\n\t\t\tthis.workbenchGrid.resizeView(this.auxiliaryBarPartView, {\n\t\t\t\theight: this.workbenchGrid.getViewSize(this.auxiliaryBarPartView).height,\n\t\t\t\twidth: preMoveAuxiliaryBarSize as number\n\t\t\t});\n\t\t}\n\t}\n\n\tsetPanelAlignment(alignment: PanelAlignment): void {\n\n\t\t// Panel alignment only applies to a panel in the top/bottom position\n\t\tif (!isHorizontal(this.getPanelPosition())) {\n\t\t\tthis.setPanelPosition(Position.BOTTOM);\n\t\t}\n\n\t\t// the workbench grid currently prevents us from supporting panel maximization with non-center panel alignment\n\t\tif (alignment !== 'center' && this.isPanelMaximized()) {\n\t\t\tthis.toggleMaximizedPanel();\n\t\t}\n\n\t\tthis.stateModel.setRuntimeValue(LayoutStateKeys.PANEL_ALIGNMENT, alignment);\n\n\t\tthis.adjustPartPositions(this.getSideBarPosition(), alignment, this.getPanelPosition());\n\n\t\tthis._onDidChangePanelAlignment.fire(alignment);\n\t}\n\n\tprivate setPanelHidden(hidden: boolean, skipLayout?: boolean): void {\n\t\tif (!this.workbenchGrid) {\n\t\t\treturn; // Return if not initialized fully (https://github.com/microsoft/vscode/issues/105480)\n\t\t}\n\n\t\tif (!hidden && this.setAuxiliaryBarMaximized(false) && this.isVisible(Parts.PANEL_PART)) {\n\t\t\treturn; // return: leaving maximised auxiliary bar made this part visible\n\t\t}\n\n\t\tconst wasHidden = !this.isVisible(Parts.PANEL_PART);\n\n\t\tthis.stateModel.setRuntimeValue(LayoutStateKeys.PANEL_HIDDEN, hidden);\n\n\t\tconst isPanelMaximized = this.isPanelMaximized();\n\t\tconst panelOpensMaximized = this.panelOpensMaximized();\n\n\t\t// Adjust CSS\n\t\tif (hidden) {\n\t\t\tthis.mainContainer.classList.add(LayoutClasses.PANEL_HIDDEN);\n\t\t} else {\n\t\t\tthis.mainContainer.classList.remove(LayoutClasses.PANEL_HIDDEN);\n\t\t}\n\n\t\t// If panel part becomes hidden, also hide the current active panel if any\n\t\tlet focusEditor = false;\n\t\tif (hidden && this.paneCompositeService.getActivePaneComposite(ViewContainerLocation.Panel)) {\n\t\t\tthis.paneCompositeService.hideActivePaneComposite(ViewContainerLocation.Panel);\n\t\t\tif (\n\t\t\t\t!isIOS &&\t\t\t\t\t\t// do not auto focus on iOS (https://github.com/microsoft/vscode/issues/127832)\n\t\t\t\t!this.isAuxiliaryBarMaximized()\t// do not auto focus when auxiliary bar is maximized\n\t\t\t) {\n\t\t\t\tfocusEditor = true;\n\t\t\t}\n\t\t}\n\n\t\t// If panel part becomes visible, show last active panel or default panel\n\t\telse if (!hidden && !this.paneCompositeService.getActivePaneComposite(ViewContainerLocation.Panel)) {\n\t\t\tlet panelToOpen: string | undefined = this.paneCompositeService.getLastActivePaneCompositeId(ViewContainerLocation.Panel);\n\n\t\t\t// verify that the panel we try to open has views before we default to it\n\t\t\t// otherwise fall back to any view that has views still refs #111463\n\t\t\tif (!panelToOpen || !this.hasViews(panelToOpen)) {\n\t\t\t\tpanelToOpen = this.viewDescriptorService\n\t\t\t\t\t.getViewContainersByLocation(ViewContainerLocation.Panel)\n\t\t\t\t\t.find(viewContainer => this.hasViews(viewContainer.id))?.id;\n\t\t\t}\n\n\t\t\tif (panelToOpen) {\n\t\t\t\tthis.openViewContainer(ViewContainerLocation.Panel, panelToOpen, !skipLayout);\n\t\t\t}\n\t\t}\n\n\t\t// If maximized and in process of hiding, unmaximize before\n\t\t// hiding to allow caching of non-maximized size\n\t\tif (hidden && isPanelMaximized) {\n\t\t\tthis.toggleMaximizedPanel();\n\t\t}\n\n\t\t// Don't proceed if we have already done this before\n\t\tif (wasHidden === hidden) {\n\t\t\treturn;\n\t\t}\n\n\t\t// Propagate layout changes to grid\n\t\tthis.workbenchGrid.setViewVisible(this.panelPartView, !hidden);\n\n\t\t// If in process of showing, toggle whether or not panel is maximized\n\t\tif (!hidden) {\n\t\t\tif (!skipLayout && isPanelMaximized !== panelOpensMaximized) {\n\t\t\t\tthis.toggleMaximizedPanel();\n\t\t\t}\n\t\t} else {\n\t\t\t// If in process of hiding, remember whether the panel is maximized or not\n\t\t\tthis.stateModel.setRuntimeValue(LayoutStateKeys.PANEL_WAS_LAST_MAXIMIZED, isPanelMaximized);\n\t\t}\n\n\t\tif (focusEditor) {\n\t\t\tthis.editorGroupService.mainPart.activeGroup.focus(); // Pass focus to editor group if panel part is now hidden\n\t\t}\n\t}\n\n\tprivate inMaximizedAuxiliaryBarTransition = false;\n\n\tisAuxiliaryBarMaximized(): boolean {\n\t\treturn this.stateModel.getRuntimeValue(LayoutStateKeys.AUXILIARYBAR_WAS_LAST_MAXIMIZED);\n\t}\n\n\ttoggleMaximizedAuxiliaryBar(): void {\n\t\tthis.setAuxiliaryBarMaximized(!this.isAuxiliaryBarMaximized());\n\t}\n\n\tsetAuxiliaryBarMaximized(maximized: boolean): boolean {\n\t\tif (\n\t\t\tthis.inMaximizedAuxiliaryBarTransition ||\t\t// prevent re-entrance\n\t\t\t(maximized === this.isAuxiliaryBarMaximized())\t// return early if state is already present\n\t\t) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif (maximized) {\n\t\t\tconst state = {\n\t\t\t\tsideBarVisible: this.isVisible(Parts.SIDEBAR_PART),\n\t\t\t\teditorVisible: this.isVisible(Parts.EDITOR_PART),\n\t\t\t\tpanelVisible: this.isVisible(Parts.PANEL_PART),\n\t\t\t\tauxiliaryBarVisible: this.isVisible(Parts.AUXILIARYBAR_PART)\n\t\t\t};\n\t\t\tthis.stateModel.setRuntimeValue(LayoutStateKeys.AUXILIARYBAR_WAS_LAST_MAXIMIZED, true);\n\n\t\t\tthis.inMaximizedAuxiliaryBarTransition = true;\n\t\t\ttry {\n\t\t\t\tif (!state.auxiliaryBarVisible) {\n\t\t\t\t\tthis.setAuxiliaryBarHidden(false);\n\t\t\t\t}\n\n\t\t\t\tconst size = this.workbenchGrid.getViewSize(this.auxiliaryBarPartView).width;\n\t\t\t\tthis.stateModel.setRuntimeValue(LayoutStateKeys.AUXILIARYBAR_LAST_NON_MAXIMIZED_SIZE, size);\n\n\t\t\t\tif (state.sideBarVisible) {\n\t\t\t\t\tthis.setSideBarHidden(true);\n\t\t\t\t}\n\t\t\t\tif (state.panelVisible) {\n\t\t\t\t\tthis.setPanelHidden(true);\n\t\t\t\t}\n\t\t\t\tif (state.editorVisible) {\n\t\t\t\t\tthis.setEditorHidden(true);\n\t\t\t\t}\n\n\t\t\t\tthis.stateModel.setRuntimeValue(LayoutStateKeys.AUXILIARYBAR_LAST_NON_MAXIMIZED_VISIBILITY, state);\n\t\t\t} finally {\n\t\t\t\tthis.inMaximizedAuxiliaryBarTransition = false;\n\t\t\t}\n\t\t} else {\n\t\t\tconst state = assertReturnsDefined(this.stateModel.getRuntimeValue(LayoutStateKeys.AUXILIARYBAR_LAST_NON_MAXIMIZED_VISIBILITY));\n\t\t\tthis.stateModel.setRuntimeValue(LayoutStateKeys.AUXILIARYBAR_WAS_LAST_MAXIMIZED, false);\n\n\t\t\tthis.inMaximizedAuxiliaryBarTransition = true;\n\t\t\ttry {\n\t\t\t\tthis.setEditorHidden(!state?.editorVisible);\t// this order of updating view visibility\n\t\t\t\tthis.setPanelHidden(!state?.panelVisible);\t\t// helps in restoring the previous view\n\t\t\t\tthis.setSideBarHidden(!state?.sideBarVisible);\t// sizes we had\n\n\t\t\t\tconst size = this.workbenchGrid.getViewSize(this.auxiliaryBarPartView);\n\t\t\t\tthis.workbenchGrid.resizeView(this.auxiliaryBarPartView, {\n\t\t\t\t\twidth: this.stateModel.getRuntimeValue(LayoutStateKeys.AUXILIARYBAR_LAST_NON_MAXIMIZED_SIZE),\n\t\t\t\t\theight: size.height\n\t\t\t\t});\n\t\t\t} finally {\n\t\t\t\tthis.inMaximizedAuxiliaryBarTransition = false;\n\t\t\t}\n\t\t}\n\n\t\tthis.focusPart(Parts.AUXILIARYBAR_PART);\n\n\t\tthis._onDidChangeAuxiliaryBarMaximized.fire();\n\n\t\treturn true;\n\t}\n\n\tisPanelMaximized(): boolean {\n\t\treturn (\n\t\t\tthis.getPanelAlignment() === 'center' || \t// the workbench grid currently prevents us from supporting panel\n\t\t\t!isHorizontal(this.getPanelPosition())\t\t// maximization with non-center panel alignment\n\t\t) && !this.isVisible(Parts.EDITOR_PART, mainWindow) && !this.isAuxiliaryBarMaximized();\n\t}\n\n\ttoggleMaximizedPanel(): void {\n\t\tconst size = this.workbenchGrid.getViewSize(this.panelPartView);\n\t\tconst panelPosition = this.getPanelPosition();\n\t\tconst maximize = !this.isPanelMaximized();\n\t\tif (maximize) {\n\t\t\tif (this.isVisible(Parts.PANEL_PART)) {\n\t\t\t\tif (isHorizontal(panelPosition)) {\n\t\t\t\t\tthis.stateModel.setRuntimeValue(LayoutStateKeys.PANEL_LAST_NON_MAXIMIZED_HEIGHT, size.height);\n\t\t\t\t} else {\n\t\t\t\t\tthis.stateModel.setRuntimeValue(LayoutStateKeys.PANEL_LAST_NON_MAXIMIZED_WIDTH, size.width);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis.setEditorHidden(true);\n\t\t} else {\n\t\t\tthis.setEditorHidden(false);\n\n\t\t\tthis.workbenchGrid.resizeView(this.panelPartView, {\n\t\t\t\twidth: isHorizontal(panelPosition) ? size.width : this.stateModel.getRuntimeValue(LayoutStateKeys.PANEL_LAST_NON_MAXIMIZED_WIDTH),\n\t\t\t\theight: isHorizontal(panelPosition) ? this.stateModel.getRuntimeValue(LayoutStateKeys.PANEL_LAST_NON_MAXIMIZED_HEIGHT) : size.height\n\t\t\t});\n\t\t}\n\n\t\tthis.stateModel.setRuntimeValue(LayoutStateKeys.PANEL_WAS_LAST_MAXIMIZED, maximize);\n\t}\n\n\tprivate panelOpensMaximized(): boolean {\n\t\tif (this.getPanelAlignment() !== 'center' && isHorizontal(this.getPanelPosition())) {\n\t\t\treturn false; // The workbench grid currently prevents us from supporting panel maximization with non-center panel alignment\n\t\t}\n\n\t\tconst panelOpensMaximized = partOpensMaximizedFromString(this.configurationService.getValue<string>(WorkbenchLayoutSettings.PANEL_OPENS_MAXIMIZED));\n\t\tconst panelLastIsMaximized = this.stateModel.getRuntimeValue(LayoutStateKeys.PANEL_WAS_LAST_MAXIMIZED);\n\n\t\treturn panelOpensMaximized === PartOpensMaximizedOptions.ALWAYS || (panelOpensMaximized === PartOpensMaximizedOptions.REMEMBER_LAST && panelLastIsMaximized);\n\t}\n\n\tprivate setAuxiliaryBarHidden(hidden: boolean, skipLayout?: boolean): void {\n\t\tif (hidden && this.setAuxiliaryBarMaximized(false) && !this.isVisible(Parts.AUXILIARYBAR_PART)) {\n\t\t\treturn; // return: leaving maximised auxiliary bar made this part hidden\n\t\t}\n\n\t\tthis.stateModel.setRuntimeValue(LayoutStateKeys.AUXILIARYBAR_HIDDEN, hidden);\n\n\t\t// Adjust CSS\n\t\tif (hidden) {\n\t\t\tthis.mainContainer.classList.add(LayoutClasses.AUXILIARYBAR_HIDDEN);\n\t\t} else {\n\t\t\tthis.mainContainer.classList.remove(LayoutClasses.AUXILIARYBAR_HIDDEN);\n\t\t}\n\n\t\t// If auxiliary bar becomes hidden, also hide the current active pane composite if any\n\t\tif (hidden && this.paneCompositeService.getActivePaneComposite(ViewContainerLocation.AuxiliaryBar)) {\n\t\t\tthis.paneCompositeService.hideActivePaneComposite(ViewContainerLocation.AuxiliaryBar);\n\t\t\tthis.focusPanelOrEditor();\n\t\t}\n\n\t\t// If auxiliary bar becomes visible, show last active pane composite or default pane composite\n\t\telse if (!hidden && !this.paneCompositeService.getActivePaneComposite(ViewContainerLocation.AuxiliaryBar)) {\n\t\t\tlet viewletToOpen: string | undefined = this.paneCompositeService.getLastActivePaneCompositeId(ViewContainerLocation.AuxiliaryBar);\n\n\t\t\t// verify that the viewlet we try to open has views before we default to it\n\t\t\t// otherwise fall back to any view that has views still refs #111463\n\t\t\tif (!viewletToOpen || !this.hasViews(viewletToOpen)) {\n\t\t\t\tviewletToOpen = this.viewDescriptorService\n\t\t\t\t\t.getViewContainersByLocation(ViewContainerLocation.AuxiliaryBar)\n\t\t\t\t\t.find(viewContainer => this.hasViews(viewContainer.id))?.id;\n\t\t\t}\n\n\t\t\tif (viewletToOpen) {\n\t\t\t\tthis.openViewContainer(ViewContainerLocation.AuxiliaryBar, viewletToOpen, !skipLayout);\n\t\t\t}\n\t\t}\n\n\t\t// Propagate to grid\n\t\tthis.workbenchGrid.setViewVisible(this.auxiliaryBarPartView, !hidden);\n\t}\n\n\tsetPartHidden(hidden: boolean, part: Parts): void {\n\t\tswitch (part) {\n\t\t\tcase Parts.ACTIVITYBAR_PART:\n\t\t\t\treturn this.setActivityBarHidden(hidden);\n\t\t\tcase Parts.SIDEBAR_PART:\n\t\t\t\treturn this.setSideBarHidden(hidden);\n\t\t\tcase Parts.EDITOR_PART:\n\t\t\t\treturn this.setEditorHidden(hidden);\n\t\t\tcase Parts.BANNER_PART:\n\t\t\t\treturn this.setBannerHidden(hidden);\n\t\t\tcase Parts.AUXILIARYBAR_PART:\n\t\t\t\treturn this.setAuxiliaryBarHidden(hidden);\n\t\t\tcase Parts.PANEL_PART:\n\t\t\t\treturn this.setPanelHidden(hidden);\n\t\t}\n\t}\n\n\thasMainWindowBorder(): boolean {\n\t\treturn this.state.runtime.mainWindowBorder;\n\t}\n\n\tgetMainWindowBorderRadius(): string | undefined {\n\t\treturn this.state.runtime.mainWindowBorder && isMacintosh ? '10px' : undefined;\n\t}\n\n\tgetSideBarPosition(): Position {\n\t\treturn this.stateModel.getRuntimeValue(LayoutStateKeys.SIDEBAR_POSITON);\n\t}\n\n\tgetPanelAlignment(): PanelAlignment {\n\t\treturn this.stateModel.getRuntimeValue(LayoutStateKeys.PANEL_ALIGNMENT);\n\t}\n\n\tupdateMenubarVisibility(skipLayout: boolean): void {\n\t\tconst shouldShowTitleBar = shouldShowCustomTitleBar(this.configurationService, mainWindow, this.state.runtime.menuBar.toggled);\n\t\tif (!skipLayout && this.workbenchGrid && shouldShowTitleBar !== this.isVisible(Parts.TITLEBAR_PART, mainWindow)) {\n\t\t\tthis.workbenchGrid.setViewVisible(this.titleBarPartView, shouldShowTitleBar);\n\t\t}\n\t}\n\n\tupdateCustomTitleBarVisibility(): void {\n\t\tconst shouldShowTitleBar = shouldShowCustomTitleBar(this.configurationService, mainWindow, this.state.runtime.menuBar.toggled);\n\t\tconst titlebarVisible = this.isVisible(Parts.TITLEBAR_PART);\n\t\tif (shouldShowTitleBar !== titlebarVisible) {\n\t\t\tthis.workbenchGrid.setViewVisible(this.titleBarPartView, shouldShowTitleBar);\n\t\t}\n\t}\n\n\ttoggleMenuBar(): void {\n\t\tlet currentVisibilityValue = getMenuBarVisibility(this.configurationService);\n\t\tif (typeof currentVisibilityValue !== 'string') {\n\t\t\tcurrentVisibilityValue = 'classic';\n\t\t}\n\n\t\tlet newVisibilityValue: string;\n\t\tif (currentVisibilityValue === 'visible' || currentVisibilityValue === 'classic') {\n\t\t\tnewVisibilityValue = hasNativeMenu(this.configurationService) ? 'toggle' : 'compact';\n\t\t} else {\n\t\t\tnewVisibilityValue = 'classic';\n\t\t}\n\n\t\tthis.configurationService.updateValue(MenuSettings.MenuBarVisibility, newVisibilityValue);\n\t}\n\n\tgetPanelPosition(): Position {\n\t\treturn this.stateModel.getRuntimeValue(LayoutStateKeys.PANEL_POSITION);\n\t}\n\n\tsetPanelPosition(position: Position): void {\n\t\tif (!this.isVisible(Parts.PANEL_PART)) {\n\t\t\tthis.setPanelHidden(false);\n\t\t}\n\n\t\tconst panelPart = this.getPart(Parts.PANEL_PART);\n\t\tconst oldPositionValue = positionToString(this.getPanelPosition());\n\t\tconst newPositionValue = positionToString(position);\n\n\t\t// Adjust CSS\n\t\tconst panelContainer = assertReturnsDefined(panelPart.getContainer());\n\t\tpanelContainer.classList.remove(oldPositionValue);\n\t\tpanelContainer.classList.add(newPositionValue);\n\n\t\t// Update Styles\n\t\tpanelPart.updateStyles();\n\n\t\t// Layout\n\t\tconst size = this.workbenchGrid.getViewSize(this.panelPartView);\n\t\tconst sideBarSize = this.workbenchGrid.getViewSize(this.sideBarPartView);\n\t\tconst auxiliaryBarSize = this.workbenchGrid.getViewSize(this.auxiliaryBarPartView);\n\n\t\tlet editorHidden = !this.isVisible(Parts.EDITOR_PART, mainWindow);\n\n\t\t// Save last non-maximized size for panel before move\n\t\tif (newPositionValue !== oldPositionValue && !editorHidden) {\n\n\t\t\t// Save the current size of the panel for the new orthogonal direction\n\t\t\t// If moving down, save the width of the panel\n\t\t\t// Otherwise, save the height of the panel\n\t\t\tif (isHorizontal(position)) {\n\t\t\t\tthis.stateModel.setRuntimeValue(LayoutStateKeys.PANEL_LAST_NON_MAXIMIZED_WIDTH, size.width);\n\t\t\t} else if (isHorizontal(positionFromString(oldPositionValue))) {\n\t\t\t\tthis.stateModel.setRuntimeValue(LayoutStateKeys.PANEL_LAST_NON_MAXIMIZED_HEIGHT, size.height);\n\t\t\t}\n\t\t}\n\n\t\tif (isHorizontal(position) && this.getPanelAlignment() !== 'center' && editorHidden) {\n\t\t\tthis.toggleMaximizedPanel();\n\t\t\teditorHidden = false;\n\t\t}\n\n\t\tthis.stateModel.setRuntimeValue(LayoutStateKeys.PANEL_POSITION, position);\n\n\t\tconst sideBarVisible = this.isVisible(Parts.SIDEBAR_PART);\n\t\tconst auxiliaryBarVisible = this.isVisible(Parts.AUXILIARYBAR_PART);\n\n\t\tconst hadFocus = this.hasFocus(Parts.PANEL_PART);\n\n\t\tif (position === Position.BOTTOM) {\n\t\t\tthis.workbenchGrid.moveView(this.panelPartView, editorHidden ? size.height : this.stateModel.getRuntimeValue(LayoutStateKeys.PANEL_LAST_NON_MAXIMIZED_HEIGHT), this.editorPartView, Direction.Down);\n\t\t} else if (position === Position.TOP) {\n\t\t\tthis.workbenchGrid.moveView(this.panelPartView, editorHidden ? size.height : this.stateModel.getRuntimeValue(LayoutStateKeys.PANEL_LAST_NON_MAXIMIZED_HEIGHT), this.editorPartView, Direction.Up);\n\t\t} else if (position === Position.RIGHT) {\n\t\t\tthis.workbenchGrid.moveView(this.panelPartView, editorHidden ? size.width : this.stateModel.getRuntimeValue(LayoutStateKeys.PANEL_LAST_NON_MAXIMIZED_WIDTH), this.editorPartView, Direction.Right);\n\t\t} else {\n\t\t\tthis.workbenchGrid.moveView(this.panelPartView, editorHidden ? size.width : this.stateModel.getRuntimeValue(LayoutStateKeys.PANEL_LAST_NON_MAXIMIZED_WIDTH), this.editorPartView, Direction.Left);\n\t\t}\n\n\t\tif (hadFocus) {\n\t\t\tthis.focusPart(Parts.PANEL_PART);\n\t\t}\n\n\t\t// Reset sidebar to original size before shifting the panel\n\t\tthis.workbenchGrid.resizeView(this.sideBarPartView, sideBarSize);\n\t\tif (!sideBarVisible) {\n\t\t\tthis.setSideBarHidden(true);\n\t\t}\n\n\t\tthis.workbenchGrid.resizeView(this.auxiliaryBarPartView, auxiliaryBarSize);\n\t\tif (!auxiliaryBarVisible) {\n\t\t\tthis.setAuxiliaryBarHidden(true);\n\t\t}\n\n\t\tif (isHorizontal(position)) {\n\t\t\tthis.adjustPartPositions(this.getSideBarPosition(), this.getPanelAlignment(), position);\n\t\t}\n\n\t\tthis._onDidChangePanelPosition.fire(newPositionValue);\n\t}\n\n\tisWindowMaximized(targetWindow: Window): boolean {\n\t\treturn this.state.runtime.maximized.has(getWindowId(targetWindow));\n\t}\n\n\tupdateWindowMaximizedState(targetWindow: Window, maximized: boolean) {\n\t\tthis.mainContainer.classList.toggle(LayoutClasses.MAXIMIZED, maximized);\n\n\t\tconst targetWindowId = getWindowId(targetWindow);\n\t\tif (maximized === this.state.runtime.maximized.has(targetWindowId)) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (maximized) {\n\t\t\tthis.state.runtime.maximized.add(targetWindowId);\n\t\t} else {\n\t\t\tthis.state.runtime.maximized.delete(targetWindowId);\n\t\t}\n\n\t\tthis.updateWindowBorder();\n\t\tthis._onDidChangeWindowMaximized.fire({ windowId: targetWindowId, maximized });\n\t}\n\n\tgetVisibleNeighborPart(part: Parts, direction: Direction): Parts | undefined {\n\t\tif (!this.workbenchGrid) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\tif (!this.isVisible(part, mainWindow)) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\tconst neighborViews = this.workbenchGrid.getNeighborViews(this.getPart(part), direction, false);\n\n\t\tif (!neighborViews) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\tfor (const neighborView of neighborViews) {\n\t\t\tconst neighborPart =\n\t\t\t\t[Parts.ACTIVITYBAR_PART, Parts.EDITOR_PART, Parts.PANEL_PART, Parts.AUXILIARYBAR_PART, Parts.SIDEBAR_PART, Parts.STATUSBAR_PART, Parts.TITLEBAR_PART]\n\t\t\t\t\t.find(partId => this.getPart(partId) === neighborView && this.isVisible(partId, mainWindow));\n\n\t\t\tif (neighborPart !== undefined) {\n\t\t\t\treturn neighborPart;\n\t\t\t}\n\t\t}\n\n\t\treturn undefined;\n\t}\n\n\tprivate onDidChangeWCO(): void {\n\t\tconst bannerFirst = this.workbenchGrid.getNeighborViews(this.titleBarPartView, Direction.Up, false).length > 0;\n\t\tconst shouldBannerBeFirst = this.shouldShowBannerFirst();\n\n\t\tif (bannerFirst !== shouldBannerBeFirst) {\n\t\t\tthis.workbenchGrid.moveView(this.bannerPartView, Sizing.Distribute, this.titleBarPartView, shouldBannerBeFirst ? Direction.Up : Direction.Down);\n\t\t}\n\n\t\tthis.workbenchGrid.setViewVisible(this.titleBarPartView, shouldShowCustomTitleBar(this.configurationService, mainWindow, this.state.runtime.menuBar.toggled));\n\t}\n\n\tprivate arrangeEditorNodes(nodes: { editor: ISerializedNode; sideBar?: ISerializedNode; auxiliaryBar?: ISerializedNode }, availableHeight: number, availableWidth: number): ISerializedNode {\n\t\tif (!nodes.sideBar && !nodes.auxiliaryBar) {\n\t\t\tnodes.editor.size = availableHeight;\n\t\t\treturn nodes.editor;\n\t\t}\n\n\t\tconst result = [nodes.editor];\n\t\tnodes.editor.size = availableWidth;\n\t\tif (nodes.sideBar) {\n\t\t\tif (this.stateModel.getRuntimeValue(LayoutStateKeys.SIDEBAR_POSITON) === Position.LEFT) {\n\t\t\t\tresult.splice(0, 0, nodes.sideBar);\n\t\t\t} else {\n\t\t\t\tresult.push(nodes.sideBar);\n\t\t\t}\n\n\t\t\tnodes.editor.size -= this.stateModel.getRuntimeValue(LayoutStateKeys.SIDEBAR_HIDDEN) ? 0 : nodes.sideBar.size;\n\t\t}\n\n\t\tif (nodes.auxiliaryBar) {\n\t\t\tif (this.stateModel.getRuntimeValue(LayoutStateKeys.SIDEBAR_POSITON) === Position.RIGHT) {\n\t\t\t\tresult.splice(0, 0, nodes.auxiliaryBar);\n\t\t\t} else {\n\t\t\t\tresult.push(nodes.auxiliaryBar);\n\t\t\t}\n\n\t\t\tnodes.editor.size -= this.stateModel.getRuntimeValue(LayoutStateKeys.AUXILIARYBAR_HIDDEN) ? 0 : nodes.auxiliaryBar.size;\n\t\t}\n\n\t\treturn {\n\t\t\ttype: 'branch',\n\t\t\tdata: result,\n\t\t\tsize: availableHeight,\n\t\t\tvisible: result.some(node => node.visible)\n\t\t};\n\t}\n\n\tprivate arrangeMiddleSectionNodes(nodes: { editor: ISerializedNode; panel: ISerializedNode; activityBar: ISerializedNode; sideBar: ISerializedNode; auxiliaryBar: ISerializedNode }, availableWidth: number, availableHeight: number): ISerializedNode[] {\n\t\tconst activityBarSize = this.stateModel.getRuntimeValue(LayoutStateKeys.ACTIVITYBAR_HIDDEN) ? 0 : nodes.activityBar.size;\n\t\tconst sideBarSize = this.stateModel.getRuntimeValue(LayoutStateKeys.SIDEBAR_HIDDEN) ? 0 : nodes.sideBar.size;\n\t\tconst auxiliaryBarSize = this.stateModel.getRuntimeValue(LayoutStateKeys.AUXILIARYBAR_HIDDEN) ? 0 : nodes.auxiliaryBar.size;\n\t\tconst panelSize = this.stateModel.getInitializationValue(LayoutStateKeys.PANEL_SIZE) ? 0 : nodes.panel.size;\n\n\t\tconst panelPostion = this.stateModel.getRuntimeValue(LayoutStateKeys.PANEL_POSITION);\n\t\tconst sideBarPosition = this.stateModel.getRuntimeValue(LayoutStateKeys.SIDEBAR_POSITON);\n\n\t\tconst result = [] as ISerializedNode[];\n\t\tif (!isHorizontal(panelPostion)) {\n\t\t\tresult.push(nodes.editor);\n\t\t\tnodes.editor.size = availableWidth - activityBarSize - sideBarSize - panelSize - auxiliaryBarSize;\n\t\t\tif (panelPostion === Position.RIGHT) {\n\t\t\t\tresult.push(nodes.panel);\n\t\t\t} else {\n\t\t\t\tresult.splice(0, 0, nodes.panel);\n\t\t\t}\n\n\t\t\tif (sideBarPosition === Position.LEFT) {\n\t\t\t\tresult.push(nodes.auxiliaryBar);\n\t\t\t\tresult.splice(0, 0, nodes.sideBar);\n\t\t\t\tresult.splice(0, 0, nodes.activityBar);\n\t\t\t} else {\n\t\t\t\tresult.splice(0, 0, nodes.auxiliaryBar);\n\t\t\t\tresult.push(nodes.sideBar);\n\t\t\t\tresult.push(nodes.activityBar);\n\t\t\t}\n\t\t} else {\n\t\t\tconst panelAlignment = this.stateModel.getRuntimeValue(LayoutStateKeys.PANEL_ALIGNMENT);\n\t\t\tconst sideBarNextToEditor = !(panelAlignment === 'center' || (sideBarPosition === Position.LEFT && panelAlignment === 'right') || (sideBarPosition === Position.RIGHT && panelAlignment === 'left'));\n\t\t\tconst auxiliaryBarNextToEditor = !(panelAlignment === 'center' || (sideBarPosition === Position.RIGHT && panelAlignment === 'right') || (sideBarPosition === Position.LEFT && panelAlignment === 'left'));\n\n\t\t\tconst editorSectionWidth = availableWidth - activityBarSize - (sideBarNextToEditor ? 0 : sideBarSize) - (auxiliaryBarNextToEditor ? 0 : auxiliaryBarSize);\n\n\t\t\tconst editorNodes = this.arrangeEditorNodes({\n\t\t\t\teditor: nodes.editor,\n\t\t\t\tsideBar: sideBarNextToEditor ? nodes.sideBar : undefined,\n\t\t\t\tauxiliaryBar: auxiliaryBarNextToEditor ? nodes.auxiliaryBar : undefined\n\t\t\t}, availableHeight - panelSize, editorSectionWidth);\n\n\t\t\tconst data = panelPostion === Position.BOTTOM ? [editorNodes, nodes.panel] : [nodes.panel, editorNodes];\n\t\t\tresult.push({\n\t\t\t\ttype: 'branch',\n\t\t\t\tdata,\n\t\t\t\tsize: editorSectionWidth,\n\t\t\t\tvisible: data.some(node => node.visible)\n\t\t\t});\n\n\t\t\tif (!sideBarNextToEditor) {\n\t\t\t\tif (sideBarPosition === Position.LEFT) {\n\t\t\t\t\tresult.splice(0, 0, nodes.sideBar);\n\t\t\t\t} else {\n\t\t\t\t\tresult.push(nodes.sideBar);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (!auxiliaryBarNextToEditor) {\n\t\t\t\tif (sideBarPosition === Position.RIGHT) {\n\t\t\t\t\tresult.splice(0, 0, nodes.auxiliaryBar);\n\t\t\t\t} else {\n\t\t\t\t\tresult.push(nodes.auxiliaryBar);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (sideBarPosition === Position.LEFT) {\n\t\t\t\tresult.splice(0, 0, nodes.activityBar);\n\t\t\t} else {\n\t\t\t\tresult.push(nodes.activityBar);\n\t\t\t}\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tprivate createGridDescriptor(): ISerializedGrid {\n\t\tconst { width, height } = this._mainContainerDimension;\n\t\tconst sideBarSize = this.stateModel.getInitializationValue(LayoutStateKeys.SIDEBAR_SIZE);\n\t\tconst auxiliaryBarSize = this.stateModel.getInitializationValue(LayoutStateKeys.AUXILIARYBAR_SIZE);\n\t\tconst panelSize = this.stateModel.getInitializationValue(LayoutStateKeys.PANEL_SIZE);\n\n\t\tconst titleBarHeight = this.titleBarPartView.minimumHeight;\n\t\tconst bannerHeight = this.bannerPartView.minimumHeight;\n\t\tconst statusBarHeight = this.statusBarPartView.minimumHeight;\n\t\tconst activityBarWidth = this.activityBarPartView.minimumWidth;\n\t\tconst middleSectionHeight = height - titleBarHeight - statusBarHeight;\n\n\t\tconst titleAndBanner: ISerializedNode[] = [\n\t\t\t{\n\t\t\t\ttype: 'leaf',\n\t\t\t\tdata: { type: Parts.TITLEBAR_PART },\n\t\t\t\tsize: titleBarHeight,\n\t\t\t\tvisible: this.isVisible(Parts.TITLEBAR_PART, mainWindow)\n\t\t\t},\n\t\t\t{\n\t\t\t\ttype: 'leaf',\n\t\t\t\tdata: { type: Parts.BANNER_PART },\n\t\t\t\tsize: bannerHeight,\n\t\t\t\tvisible: false\n\t\t\t}\n\t\t];\n\n\t\tconst activityBarNode: ISerializedLeafNode = {\n\t\t\ttype: 'leaf',\n\t\t\tdata: { type: Parts.ACTIVITYBAR_PART },\n\t\t\tsize: activityBarWidth,\n\t\t\tvisible: !this.stateModel.getRuntimeValue(LayoutStateKeys.ACTIVITYBAR_HIDDEN)\n\t\t};\n\n\t\tconst sideBarNode: ISerializedLeafNode = {\n\t\t\ttype: 'leaf',\n\t\t\tdata: { type: Parts.SIDEBAR_PART },\n\t\t\tsize: sideBarSize,\n\t\t\tvisible: !this.stateModel.getRuntimeValue(LayoutStateKeys.SIDEBAR_HIDDEN)\n\t\t};\n\n\t\tconst auxiliaryBarNode: ISerializedLeafNode = {\n\t\t\ttype: 'leaf',\n\t\t\tdata: { type: Parts.AUXILIARYBAR_PART },\n\t\t\tsize: auxiliaryBarSize,\n\t\t\tvisible: this.isVisible(Parts.AUXILIARYBAR_PART)\n\t\t};\n\n\t\tconst editorNode: ISerializedLeafNode = {\n\t\t\ttype: 'leaf',\n\t\t\tdata: { type: Parts.EDITOR_PART },\n\t\t\tsize: 0, // Update based on sibling sizes\n\t\t\tvisible: !this.stateModel.getRuntimeValue(LayoutStateKeys.EDITOR_HIDDEN)\n\t\t};\n\n\t\tconst panelNode: ISerializedLeafNode = {\n\t\t\ttype: 'leaf',\n\t\t\tdata: { type: Parts.PANEL_PART },\n\t\t\tsize: panelSize,\n\t\t\tvisible: !this.stateModel.getRuntimeValue(LayoutStateKeys.PANEL_HIDDEN)\n\t\t};\n\n\t\tconst middleSection: ISerializedNode[] = this.arrangeMiddleSectionNodes({\n\t\t\tactivityBar: activityBarNode,\n\t\t\tauxiliaryBar: auxiliaryBarNode,\n\t\t\teditor: editorNode,\n\t\t\tpanel: panelNode,\n\t\t\tsideBar: sideBarNode\n\t\t}, width, middleSectionHeight);\n\n\t\tconst result: ISerializedGrid = {\n\t\t\troot: {\n\t\t\t\ttype: 'branch',\n\t\t\t\tsize: width,\n\t\t\t\tdata: [\n\t\t\t\t\t...(this.shouldShowBannerFirst() ? titleAndBanner.reverse() : titleAndBanner),\n\t\t\t\t\t{\n\t\t\t\t\t\ttype: 'branch',\n\t\t\t\t\t\tdata: middleSection,\n\t\t\t\t\t\tsize: middleSectionHeight\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\ttype: 'leaf',\n\t\t\t\t\t\tdata: { type: Parts.STATUSBAR_PART },\n\t\t\t\t\t\tsize: statusBarHeight,\n\t\t\t\t\t\tvisible: !this.stateModel.getRuntimeValue(LayoutStateKeys.STATUSBAR_HIDDEN)\n\t\t\t\t\t}\n\t\t\t\t]\n\t\t\t},\n\t\t\torientation: Orientation.VERTICAL,\n\t\t\twidth,\n\t\t\theight\n\t\t};\n\n\t\ttype StartupLayoutEvent = {\n\t\t\tactivityBarVisible: boolean;\n\t\t\tsideBarVisible: boolean;\n\t\t\tauxiliaryBarVisible: boolean;\n\t\t\tpanelVisible: boolean;\n\t\t\tstatusbarVisible: boolean;\n\t\t\tsideBarPosition: string;\n\t\t\tpanelPosition: string;\n\t\t};\n\n\t\ttype StartupLayoutEventClassification = {\n\t\t\towner: 'benibenj';\n\t\t\tcomment: 'Information about the layout of the workbench during statup';\n\t\t\tactivityBarVisible: { classification: 'SystemMetaData'; purpose: 'FeatureInsight'; comment: 'Whether or the not the activity bar is visible' };\n\t\t\tsideBarVisible: { classification: 'SystemMetaData'; purpose: 'FeatureInsight'; comment: 'Whether or the not the primary side bar is visible' };\n\t\t\tauxiliaryBarVisible: { classification: 'SystemMetaData'; purpose: 'FeatureInsight'; comment: 'Whether or the not the secondary side bar is visible' };\n\t\t\tpanelVisible: { classification: 'SystemMetaData'; purpose: 'FeatureInsight'; comment: 'Whether or the not the panel is visible' };\n\t\t\tstatusbarVisible: { classification: 'SystemMetaData'; purpose: 'FeatureInsight'; comment: 'Whether or the not the status bar is visible' };\n\t\t\tsideBarPosition: { classification: 'SystemMetaData'; purpose: 'FeatureInsight'; comment: 'Whether the primary side bar is on the left or right' };\n\t\t\tpanelPosition: { classification: 'SystemMetaData'; purpose: 'FeatureInsight'; comment: 'Whether the panel is on the top, bottom, left, or right' };\n\t\t};\n\n\t\tconst layoutDescriptor: StartupLayoutEvent = {\n\t\t\tactivityBarVisible: !this.stateModel.getRuntimeValue(LayoutStateKeys.ACTIVITYBAR_HIDDEN),\n\t\t\tsideBarVisible: !this.stateModel.getRuntimeValue(LayoutStateKeys.SIDEBAR_HIDDEN),\n\t\t\tauxiliaryBarVisible: !this.stateModel.getRuntimeValue(LayoutStateKeys.AUXILIARYBAR_HIDDEN),\n\t\t\tpanelVisible: !this.stateModel.getRuntimeValue(LayoutStateKeys.PANEL_HIDDEN),\n\t\t\tstatusbarVisible: !this.stateModel.getRuntimeValue(LayoutStateKeys.STATUSBAR_HIDDEN),\n\t\t\tsideBarPosition: positionToString(this.stateModel.getRuntimeValue(LayoutStateKeys.SIDEBAR_POSITON)),\n\t\t\tpanelPosition: positionToString(this.stateModel.getRuntimeValue(LayoutStateKeys.PANEL_POSITION)),\n\t\t};\n\n\t\tthis.telemetryService.publicLog2<StartupLayoutEvent, StartupLayoutEventClassification>('startupLayout', layoutDescriptor);\n\n\t\treturn result;\n\t}\n\n\toverride dispose(): void {\n\t\tsuper.dispose();\n\n\t\tthis.disposed = true;\n\t}\n}\n\ntype ZenModeConfiguration = {\n\tcenterLayout: boolean;\n\tfullScreen: boolean;\n\thideActivityBar: boolean;\n\thideLineNumbers: boolean;\n\thideStatusBar: boolean;\n\tshowTabs: 'multiple' | 'single' | 'none';\n\trestore: boolean;\n\tsilentNotifications: boolean;\n};\n\nfunction getZenModeConfiguration(configurationService: IConfigurationService): ZenModeConfiguration {\n\treturn configurationService.getValue<ZenModeConfiguration>(WorkbenchLayoutSettings.ZEN_MODE_CONFIG);\n}\n\n//#endregion\n\n//#region Layout State Model\n\ninterface IWorkbenchLayoutStateKey {\n\treadonly name: string;\n\treadonly runtime: boolean;\n\treadonly defaultValue: unknown;\n\treadonly scope: StorageScope;\n\treadonly target: StorageTarget;\n\treadonly zenModeIgnore?: boolean;\n}\n\ntype StorageKeyType = string | boolean | number | object;\n\nabstract class WorkbenchLayoutStateKey<T extends StorageKeyType> implements IWorkbenchLayoutStateKey {\n\n\tabstract readonly runtime: boolean;\n\n\tconstructor(readonly name: string, readonly scope: StorageScope, readonly target: StorageTarget, public defaultValue: T) { }\n}\n\nclass RuntimeStateKey<T extends StorageKeyType> extends WorkbenchLayoutStateKey<T> {\n\n\treadonly runtime = true;\n\n\tconstructor(name: string, scope: StorageScope, target: StorageTarget, defaultValue: T, readonly zenModeIgnore?: boolean) {\n\t\tsuper(name, scope, target, defaultValue);\n\t}\n}\n\nclass InitializationStateKey<T extends StorageKeyType> extends WorkbenchLayoutStateKey<T> {\n\treadonly runtime = false;\n}\n\nconst LayoutStateKeys = {\n\n\t// Editor\n\tMAIN_EDITOR_CENTERED: new RuntimeStateKey<boolean>('editor.centered', StorageScope.WORKSPACE, StorageTarget.MACHINE, false),\n\n\t// Zen Mode\n\tZEN_MODE_ACTIVE: new RuntimeStateKey<boolean>('zenMode.active', StorageScope.WORKSPACE, StorageTarget.MACHINE, false),\n\tZEN_MODE_EXIT_INFO: new RuntimeStateKey('zenMode.exitInfo', StorageScope.WORKSPACE, StorageTarget.MACHINE, {\n\t\ttransitionedToCenteredEditorLayout: false,\n\t\ttransitionedToFullScreen: false,\n\t\thandleNotificationsDoNotDisturbMode: false,\n\t\twasVisible: {\n\t\t\tauxiliaryBar: false,\n\t\t\tpanel: false,\n\t\t\tsideBar: false,\n\t\t},\n\t}),\n\n\t// Part Sizing\n\tSIDEBAR_SIZE: new InitializationStateKey<number>('sideBar.size', StorageScope.PROFILE, StorageTarget.MACHINE, 300),\n\tAUXILIARYBAR_SIZE: new InitializationStateKey<number>('auxiliaryBar.size', StorageScope.PROFILE, StorageTarget.MACHINE, 300),\n\tPANEL_SIZE: new InitializationStateKey<number>('panel.size', StorageScope.PROFILE, StorageTarget.MACHINE, 300),\n\n\t// Part State\n\tPANEL_LAST_NON_MAXIMIZED_HEIGHT: new RuntimeStateKey<number>('panel.lastNonMaximizedHeight', StorageScope.PROFILE, StorageTarget.MACHINE, 300),\n\tPANEL_LAST_NON_MAXIMIZED_WIDTH: new RuntimeStateKey<number>('panel.lastNonMaximizedWidth', StorageScope.PROFILE, StorageTarget.MACHINE, 300),\n\tPANEL_WAS_LAST_MAXIMIZED: new RuntimeStateKey<boolean>('panel.wasLastMaximized', StorageScope.WORKSPACE, StorageTarget.MACHINE, false),\n\n\tAUXILIARYBAR_WAS_LAST_MAXIMIZED: new RuntimeStateKey<boolean>('auxiliaryBar.wasLastMaximized', StorageScope.WORKSPACE, StorageTarget.MACHINE, false),\n\tAUXILIARYBAR_LAST_NON_MAXIMIZED_SIZE: new RuntimeStateKey<number>('auxiliaryBar.lastNonMaximizedSize', StorageScope.PROFILE, StorageTarget.MACHINE, 300),\n\tAUXILIARYBAR_LAST_NON_MAXIMIZED_VISIBILITY: new RuntimeStateKey('auxiliaryBar.lastNonMaximizedVisibility', StorageScope.WORKSPACE, StorageTarget.MACHINE, {\n\t\tsideBarVisible: false,\n\t\teditorVisible: false,\n\t\tpanelVisible: false,\n\t\tauxiliaryBarVisible: false\n\t}),\n\tAUXILIARYBAR_EMPTY: new InitializationStateKey<boolean>('auxiliaryBar.empty', StorageScope.PROFILE, StorageTarget.MACHINE, false),\n\n\t// Part Positions\n\tSIDEBAR_POSITON: new RuntimeStateKey<Position>('sideBar.position', StorageScope.WORKSPACE, StorageTarget.MACHINE, Position.LEFT),\n\tPANEL_POSITION: new RuntimeStateKey<Position>('panel.position', StorageScope.WORKSPACE, StorageTarget.MACHINE, Position.BOTTOM),\n\tPANEL_ALIGNMENT: new RuntimeStateKey<PanelAlignment>('panel.alignment', StorageScope.PROFILE, StorageTarget.USER, 'center'),\n\n\t// Part Visibility\n\tACTIVITYBAR_HIDDEN: new RuntimeStateKey<boolean>('activityBar.hidden', StorageScope.WORKSPACE, StorageTarget.MACHINE, false, true),\n\tSIDEBAR_HIDDEN: new RuntimeStateKey<boolean>('sideBar.hidden', StorageScope.WORKSPACE, StorageTarget.MACHINE, false),\n\tEDITOR_HIDDEN: new RuntimeStateKey<boolean>('editor.hidden', StorageScope.WORKSPACE, StorageTarget.MACHINE, false),\n\tPANEL_HIDDEN: new RuntimeStateKey<boolean>('panel.hidden', StorageScope.WORKSPACE, StorageTarget.MACHINE, true),\n\tAUXILIARYBAR_HIDDEN: new RuntimeStateKey<boolean>('auxiliaryBar.hidden', StorageScope.WORKSPACE, StorageTarget.MACHINE, true),\n\tSTATUSBAR_HIDDEN: new RuntimeStateKey<boolean>('statusBar.hidden', StorageScope.WORKSPACE, StorageTarget.MACHINE, false, true)\n\n} as const;\n\ninterface ILayoutStateChangeEvent<T extends StorageKeyType> {\n\treadonly key: RuntimeStateKey<T>;\n\treadonly value: T;\n}\n\nenum WorkbenchLayoutSettings {\n\tAUXILIARYBAR_DEFAULT_VISIBILITY = 'workbench.secondarySideBar.defaultVisibility',\n\tACTIVITY_BAR_VISIBLE = 'workbench.activityBar.visible',\n\tPANEL_POSITION = 'workbench.panel.defaultLocation',\n\tPANEL_OPENS_MAXIMIZED = 'workbench.panel.opensMaximized',\n\tZEN_MODE_CONFIG = 'zenMode',\n\tEDITOR_CENTERED_LAYOUT_AUTO_RESIZE = 'workbench.editor.centeredLayoutAutoResize',\n}\n\nenum LegacyWorkbenchLayoutSettings {\n\tSTATUSBAR_VISIBLE = 'workbench.statusBar.visible', \t// Deprecated to UI State\n\tSIDEBAR_POSITION = 'workbench.sideBar.location', \t// Deprecated to UI State\n}\n\ninterface ILayoutStateLoadConfiguration {\n\treadonly mainContainerDimension: IDimension;\n\treadonly resetLayout: boolean;\n}\n\nclass LayoutStateModel extends Disposable {\n\n\tstatic readonly STORAGE_PREFIX = 'workbench.';\n\n\tprivate readonly _onDidChangeState = this._register(new Emitter<ILayoutStateChangeEvent<StorageKeyType>>());\n\treadonly onDidChangeState = this._onDidChangeState.event;\n\n\tprivate readonly stateCache = new Map<string, unknown>();\n\n\tprivate readonly isNew: {\n\t\t[StorageScope.WORKSPACE]: boolean;\n\t\t[StorageScope.PROFILE]: boolean;\n\t\t[StorageScope.APPLICATION]: boolean;\n\t};\n\n\tconstructor(\n\t\tprivate readonly storageService: IStorageService,\n\t\tprivate readonly configurationService: IConfigurationService,\n\t\tprivate readonly contextService: IWorkspaceContextService,\n\t\tprivate readonly environmentService: IBrowserWorkbenchEnvironmentService,\n\t) {\n\t\tsuper();\n\n\t\tthis.isNew = {\n\t\t\t[StorageScope.WORKSPACE]: this.storageService.isNew(StorageScope.WORKSPACE),\n\t\t\t[StorageScope.PROFILE]: this.storageService.isNew(StorageScope.PROFILE),\n\t\t\t[StorageScope.APPLICATION]: this.storageService.isNew(StorageScope.APPLICATION)\n\t\t};\n\n\t\tthis._register(this.configurationService.onDidChangeConfiguration(configurationChange => this.updateStateFromLegacySettings(configurationChange)));\n\t}\n\n\tprivate updateStateFromLegacySettings(configurationChangeEvent: IConfigurationChangeEvent): void {\n\t\tif (configurationChangeEvent.affectsConfiguration(LayoutSettings.ACTIVITY_BAR_LOCATION)) {\n\t\t\tthis.setRuntimeValueAndFire(LayoutStateKeys.ACTIVITYBAR_HIDDEN, this.isActivityBarHidden());\n\t\t}\n\n\t\tif (configurationChangeEvent.affectsConfiguration(LegacyWorkbenchLayoutSettings.STATUSBAR_VISIBLE)) {\n\t\t\tthis.setRuntimeValueAndFire(LayoutStateKeys.STATUSBAR_HIDDEN, !this.configurationService.getValue(LegacyWorkbenchLayoutSettings.STATUSBAR_VISIBLE));\n\t\t}\n\n\t\tif (configurationChangeEvent.affectsConfiguration(LegacyWorkbenchLayoutSettings.SIDEBAR_POSITION)) {\n\t\t\tthis.setRuntimeValueAndFire(LayoutStateKeys.SIDEBAR_POSITON, positionFromString(this.configurationService.getValue(LegacyWorkbenchLayoutSettings.SIDEBAR_POSITION) ?? 'left'));\n\t\t}\n\t}\n\n\tprivate updateLegacySettingsFromState<T extends StorageKeyType>(key: RuntimeStateKey<T>, value: T): void {\n\t\tconst isZenMode = this.getRuntimeValue(LayoutStateKeys.ZEN_MODE_ACTIVE);\n\t\tif (key.zenModeIgnore && isZenMode) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (key === LayoutStateKeys.ACTIVITYBAR_HIDDEN) {\n\t\t\tthis.configurationService.updateValue(LayoutSettings.ACTIVITY_BAR_LOCATION, value ? ActivityBarPosition.HIDDEN : undefined);\n\t\t} else if (key === LayoutStateKeys.STATUSBAR_HIDDEN) {\n\t\t\tthis.configurationService.updateValue(LegacyWorkbenchLayoutSettings.STATUSBAR_VISIBLE, !value);\n\t\t} else if (key === LayoutStateKeys.SIDEBAR_POSITON) {\n\t\t\tthis.configurationService.updateValue(LegacyWorkbenchLayoutSettings.SIDEBAR_POSITION, positionToString(value as Position));\n\t\t}\n\t}\n\n\tload(configuration: ILayoutStateLoadConfiguration): void {\n\t\tlet key: keyof typeof LayoutStateKeys;\n\n\t\t// Load stored values for all keys unless we explicitly set to reset\n\t\tif (!configuration.resetLayout) {\n\t\t\tfor (key in LayoutStateKeys) {\n\t\t\t\tconst stateKey = LayoutStateKeys[key] as WorkbenchLayoutStateKey<StorageKeyType>;\n\t\t\t\tconst value = this.loadKeyFromStorage(stateKey);\n\n\t\t\t\tif (value !== undefined) {\n\t\t\t\t\tthis.stateCache.set(stateKey.name, value);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// Apply legacy settings\n\t\tthis.stateCache.set(LayoutStateKeys.ACTIVITYBAR_HIDDEN.name, this.isActivityBarHidden());\n\t\tthis.stateCache.set(LayoutStateKeys.STATUSBAR_HIDDEN.name, !this.configurationService.getValue(LegacyWorkbenchLayoutSettings.STATUSBAR_VISIBLE));\n\t\tthis.stateCache.set(LayoutStateKeys.SIDEBAR_POSITON.name, positionFromString(this.configurationService.getValue(LegacyWorkbenchLayoutSettings.SIDEBAR_POSITION) ?? 'left'));\n\n\t\t// Set dynamic defaults: part sizing and side bar visibility\n\t\tconst workbenchState = this.contextService.getWorkbenchState();\n\t\tconst mainContainerDimension = configuration.mainContainerDimension;\n\t\tLayoutStateKeys.SIDEBAR_SIZE.defaultValue = Math.min(300, mainContainerDimension.width / 4);\n\t\tLayoutStateKeys.SIDEBAR_HIDDEN.defaultValue = workbenchState === WorkbenchState.EMPTY;\n\t\tLayoutStateKeys.AUXILIARYBAR_SIZE.defaultValue = Math.min(300, mainContainerDimension.width / 4);\n\t\tLayoutStateKeys.AUXILIARYBAR_HIDDEN.defaultValue = (() => {\n\t\t\tif (isWeb && !this.environmentService.remoteAuthority) {\n\t\t\t\treturn true; // TODO@bpasero remove this condition once Chat web support lands\n\t\t\t}\n\n\t\t\tconst configuration = this.configurationService.inspect(WorkbenchLayoutSettings.AUXILIARYBAR_DEFAULT_VISIBILITY);\n\n\t\t\t// Unless auxiliary bar visibility is explicitly configured, make\n\t\t\t// sure to not force open it in case we know it was empty before.\n\t\t\tif (configuration.defaultValue !== 'hidden' && !isConfigured(configuration) && this.stateCache.get(LayoutStateKeys.AUXILIARYBAR_EMPTY.name)) {\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\t// New users: Show auxiliary bar even in empty workspaces\n\t\t\t// but not if the user explicitly hides it\n\t\t\tif (\n\t\t\t\tthis.isNew[StorageScope.APPLICATION] &&\n\t\t\t\tconfiguration.value !== 'hidden'\n\t\t\t) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\t// Existing users: respect visibility setting\n\t\t\tswitch (configuration.value) {\n\t\t\t\tcase 'hidden':\n\t\t\t\t\treturn true;\n\t\t\t\tcase 'visibleInWorkspace':\n\t\t\t\tcase 'maximizedInWorkspace':\n\t\t\t\t\treturn workbenchState === WorkbenchState.EMPTY;\n\t\t\t\tdefault:\n\t\t\t\t\treturn false;\n\t\t\t}\n\t\t})();\n\t\tLayoutStateKeys.PANEL_SIZE.defaultValue = (this.stateCache.get(LayoutStateKeys.PANEL_POSITION.name) ?? isHorizontal(LayoutStateKeys.PANEL_POSITION.defaultValue)) ? mainContainerDimension.height / 3 : mainContainerDimension.width / 4;\n\t\tLayoutStateKeys.PANEL_POSITION.defaultValue = positionFromString(this.configurationService.getValue(WorkbenchLayoutSettings.PANEL_POSITION) ?? 'bottom');\n\n\t\t// Apply all defaults\n\t\tfor (key in LayoutStateKeys) {\n\t\t\tconst stateKey = LayoutStateKeys[key];\n\t\t\tif (this.stateCache.get(stateKey.name) === undefined) {\n\t\t\t\tthis.stateCache.set(stateKey.name, stateKey.defaultValue);\n\t\t\t}\n\t\t}\n\n\t\t// Apply all overrides\n\t\tthis.applyOverrides(configuration);\n\n\t\t// Register for runtime key changes\n\t\tthis._register(this.storageService.onDidChangeValue(StorageScope.PROFILE, undefined, this._store)(storageChangeEvent => {\n\t\t\tlet key: keyof typeof LayoutStateKeys;\n\t\t\tfor (key in LayoutStateKeys) {\n\t\t\t\tconst stateKey = LayoutStateKeys[key] as WorkbenchLayoutStateKey<StorageKeyType>;\n\t\t\t\tif (stateKey instanceof RuntimeStateKey && stateKey.scope === StorageScope.PROFILE && stateKey.target === StorageTarget.USER) {\n\t\t\t\t\tif (`${LayoutStateModel.STORAGE_PREFIX}${stateKey.name}` === storageChangeEvent.key) {\n\t\t\t\t\t\tconst value = this.loadKeyFromStorage(stateKey) ?? stateKey.defaultValue;\n\t\t\t\t\t\tif (this.stateCache.get(stateKey.name) !== value) {\n\t\t\t\t\t\t\tthis.stateCache.set(stateKey.name, value);\n\t\t\t\t\t\t\tthis._onDidChangeState.fire({ key: stateKey, value });\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}));\n\t}\n\n\tprivate applyOverrides(configuration: ILayoutStateLoadConfiguration): void {\n\n\t\t// Auxiliary bar: Maximized setting (new workspaces)\n\t\tif (this.isNew[StorageScope.WORKSPACE]) {\n\t\t\tconst defaultAuxiliaryBarVisibility = this.configurationService.getValue(WorkbenchLayoutSettings.AUXILIARYBAR_DEFAULT_VISIBILITY);\n\t\t\tif (\n\t\t\t\tdefaultAuxiliaryBarVisibility === 'maximized' ||\n\t\t\t\t(defaultAuxiliaryBarVisibility === 'maximizedInWorkspace' && this.contextService.getWorkbenchState() !== WorkbenchState.EMPTY)\n\t\t\t) {\n\t\t\t\tthis.applyAuxiliaryBarMaximizedOverride();\n\t\t\t}\n\t\t}\n\n\t\t// Both editor and panel should not be hidden on startup unless auxiliary bar is maximized\n\t\tif (\n\t\t\tthis.getRuntimeValue(LayoutStateKeys.PANEL_HIDDEN) &&\n\t\t\tthis.getRuntimeValue(LayoutStateKeys.EDITOR_HIDDEN) &&\n\t\t\t!this.getRuntimeValue(LayoutStateKeys.AUXILIARYBAR_WAS_LAST_MAXIMIZED)\n\t\t) {\n\t\t\tthis.setRuntimeValue(LayoutStateKeys.EDITOR_HIDDEN, false);\n\t\t}\n\n\t\t// Restrict auxiliary bar size in case of small window dimensions\n\t\tif (this.isNew[StorageScope.WORKSPACE] && configuration.mainContainerDimension.width <= DEFAULT_WORKSPACE_WINDOW_DIMENSIONS.width) {\n\t\t\tthis.setInitializationValue(LayoutStateKeys.SIDEBAR_SIZE, Math.min(300, configuration.mainContainerDimension.width / 4));\n\t\t\tthis.setInitializationValue(LayoutStateKeys.AUXILIARYBAR_SIZE, Math.min(300, configuration.mainContainerDimension.width / 4));\n\t\t}\n\t}\n\n\tprivate applyAuxiliaryBarMaximizedOverride(): void {\n\t\tthis.setRuntimeValue(LayoutStateKeys.AUXILIARYBAR_LAST_NON_MAXIMIZED_VISIBILITY, {\n\t\t\tsideBarVisible: !this.getRuntimeValue(LayoutStateKeys.SIDEBAR_HIDDEN),\n\t\t\tpanelVisible: !this.getRuntimeValue(LayoutStateKeys.PANEL_HIDDEN),\n\t\t\teditorVisible: !this.getRuntimeValue(LayoutStateKeys.EDITOR_HIDDEN),\n\t\t\tauxiliaryBarVisible: !this.getRuntimeValue(LayoutStateKeys.AUXILIARYBAR_HIDDEN)\n\t\t});\n\n\t\tthis.setRuntimeValue(LayoutStateKeys.SIDEBAR_HIDDEN, true);\n\t\tthis.setRuntimeValue(LayoutStateKeys.PANEL_HIDDEN, true);\n\t\tthis.setRuntimeValue(LayoutStateKeys.EDITOR_HIDDEN, true);\n\t\tthis.setRuntimeValue(LayoutStateKeys.AUXILIARYBAR_HIDDEN, false);\n\n\t\tthis.setRuntimeValue(LayoutStateKeys.AUXILIARYBAR_LAST_NON_MAXIMIZED_SIZE, this.getInitializationValue(LayoutStateKeys.AUXILIARYBAR_SIZE));\n\t\tthis.setRuntimeValue(LayoutStateKeys.AUXILIARYBAR_WAS_LAST_MAXIMIZED, true);\n\t}\n\n\tsave(workspace: boolean, global: boolean): void {\n\t\tlet key: keyof typeof LayoutStateKeys;\n\n\t\tconst isZenMode = this.getRuntimeValue(LayoutStateKeys.ZEN_MODE_ACTIVE);\n\n\t\tfor (key in LayoutStateKeys) {\n\t\t\tconst stateKey = LayoutStateKeys[key] as WorkbenchLayoutStateKey<StorageKeyType>;\n\t\t\tif ((workspace && stateKey.scope === StorageScope.WORKSPACE) ||\n\t\t\t\t(global && stateKey.scope === StorageScope.PROFILE)) {\n\t\t\t\tif (isZenMode && stateKey instanceof RuntimeStateKey && stateKey.zenModeIgnore) {\n\t\t\t\t\tcontinue; // Don't write out specific keys while in zen mode\n\t\t\t\t}\n\n\t\t\t\tthis.saveKeyToStorage(stateKey);\n\t\t\t}\n\t\t}\n\t}\n\n\tgetInitializationValue<T extends StorageKeyType>(key: InitializationStateKey<T>): T {\n\t\treturn this.stateCache.get(key.name) as T;\n\t}\n\n\tsetInitializationValue<T extends StorageKeyType>(key: InitializationStateKey<T>, value: T): void {\n\t\tthis.stateCache.set(key.name, value);\n\t}\n\n\tgetRuntimeValue<T extends StorageKeyType>(key: RuntimeStateKey<T>, fallbackToSetting?: boolean): T {\n\t\tif (fallbackToSetting) {\n\t\t\tswitch (key) {\n\t\t\t\tcase LayoutStateKeys.ACTIVITYBAR_HIDDEN:\n\t\t\t\t\tthis.stateCache.set(key.name, this.isActivityBarHidden());\n\t\t\t\t\tbreak;\n\t\t\t\tcase LayoutStateKeys.STATUSBAR_HIDDEN:\n\t\t\t\t\tthis.stateCache.set(key.name, !this.configurationService.getValue(LegacyWorkbenchLayoutSettings.STATUSBAR_VISIBLE));\n\t\t\t\t\tbreak;\n\t\t\t\tcase LayoutStateKeys.SIDEBAR_POSITON:\n\t\t\t\t\tthis.stateCache.set(key.name, this.configurationService.getValue(LegacyWorkbenchLayoutSettings.SIDEBAR_POSITION) ?? 'left');\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\treturn this.stateCache.get(key.name) as T;\n\t}\n\n\tsetRuntimeValue<T extends StorageKeyType>(key: RuntimeStateKey<T>, value: T): void {\n\t\tthis.stateCache.set(key.name, value);\n\t\tconst isZenMode = this.getRuntimeValue(LayoutStateKeys.ZEN_MODE_ACTIVE);\n\n\t\tif (key.scope === StorageScope.PROFILE) {\n\t\t\tif (!isZenMode || !key.zenModeIgnore) {\n\t\t\t\tthis.saveKeyToStorage<T>(key);\n\t\t\t\tthis.updateLegacySettingsFromState(key, value);\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate isActivityBarHidden(): boolean {\n\t\tconst oldValue = this.configurationService.getValue<boolean | undefined>(WorkbenchLayoutSettings.ACTIVITY_BAR_VISIBLE);\n\t\tif (oldValue !== undefined) {\n\t\t\treturn !oldValue;\n\t\t}\n\n\t\treturn this.configurationService.getValue(LayoutSettings.ACTIVITY_BAR_LOCATION) !== ActivityBarPosition.DEFAULT;\n\t}\n\n\tprivate setRuntimeValueAndFire<T extends StorageKeyType>(key: RuntimeStateKey<T>, value: T): void {\n\t\tconst previousValue = this.stateCache.get(key.name);\n\t\tif (previousValue === value) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.setRuntimeValue(key, value);\n\t\tthis._onDidChangeState.fire({ key, value });\n\t}\n\n\tprivate saveKeyToStorage<T extends StorageKeyType>(key: WorkbenchLayoutStateKey<T>): void {\n\t\tconst value = this.stateCache.get(key.name) as T;\n\t\tthis.storageService.store(`${LayoutStateModel.STORAGE_PREFIX}${key.name}`, typeof value === 'object' ? JSON.stringify(value) : value, key.scope, key.target);\n\t}\n\n\tprivate loadKeyFromStorage<T extends StorageKeyType>(key: WorkbenchLayoutStateKey<T>): T | undefined {\n\t\tlet value = this.storageService.get(`${LayoutStateModel.STORAGE_PREFIX}${key.name}`, key.scope);\n\n\t\t// TODO@bpasero remove this code in 1y when \"pre-AI\" workspaces have migrated\n\t\t// Refs: https://github.com/microsoft/vscode-internalbacklog/issues/6168\n\t\tif (\n\t\t\tkey.scope === StorageScope.WORKSPACE &&\n\t\t\tkey.name === LayoutStateKeys.AUXILIARYBAR_HIDDEN.name &&\n\t\t\tthis.configurationService.getValue('workbench.secondarySideBar.enableDefaultVisibilityInOldWorkspace') === true &&\n\t\t\tthis.storageService.get('workbench.panel.chat.numberOfVisibleViews', StorageScope.WORKSPACE) === undefined\n\t\t) {\n\t\t\tvalue = undefined;\n\t\t}\n\n\t\tif (value !== undefined) {\n\t\t\tthis.isNew[key.scope] = false; // remember that we had previous state for this scope\n\n\t\t\tswitch (typeof key.defaultValue) {\n\t\t\t\tcase 'boolean': return (value === 'true') as T;\n\t\t\t\tcase 'number': return parseInt(value) as T;\n\t\t\t\tcase 'object': return JSON.parse(value) as T;\n\t\t\t}\n\t\t}\n\n\t\treturn value as T | undefined;\n\t}\n}\n\n//#endregion\n"]}