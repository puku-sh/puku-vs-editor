{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/workbench/common/memento.ts","vs/workbench/common/memento.ts"],"names":[],"mappings":"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","file":"memento.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { IStorageService, IStorageValueChangeEvent, StorageScope, StorageTarget } from '../../platform/storage/common/storage.js';\nimport { isEmptyObject } from '../../base/common/types.js';\nimport { onUnexpectedError } from '../../base/common/errors.js';\nimport { DisposableStore } from '../../base/common/lifecycle.js';\nimport { Event } from '../../base/common/event.js';\n\nexport class Memento<T extends object> {\n\n\tprivate static readonly applicationMementos = new Map<string, ScopedMemento<unknown>>();\n\tprivate static readonly profileMementos = new Map<string, ScopedMemento<unknown>>();\n\tprivate static readonly workspaceMementos = new Map<string, ScopedMemento<unknown>>();\n\n\tprivate static readonly COMMON_PREFIX = 'memento/';\n\n\tprivate readonly id: string;\n\n\tconstructor(id: string, private storageService: IStorageService) {\n\t\tthis.id = Memento.COMMON_PREFIX + id;\n\t}\n\n\tgetMemento(scope: StorageScope, target: StorageTarget): Partial<T> {\n\t\tswitch (scope) {\n\t\t\tcase StorageScope.WORKSPACE: {\n\t\t\t\tlet workspaceMemento = Memento.workspaceMementos.get(this.id);\n\t\t\t\tif (!workspaceMemento) {\n\t\t\t\t\tworkspaceMemento = new ScopedMemento(this.id, scope, target, this.storageService);\n\t\t\t\t\tMemento.workspaceMementos.set(this.id, workspaceMemento);\n\t\t\t\t}\n\n\t\t\t\treturn workspaceMemento.getMemento();\n\t\t\t}\n\n\t\t\tcase StorageScope.PROFILE: {\n\t\t\t\tlet profileMemento = Memento.profileMementos.get(this.id);\n\t\t\t\tif (!profileMemento) {\n\t\t\t\t\tprofileMemento = new ScopedMemento(this.id, scope, target, this.storageService);\n\t\t\t\t\tMemento.profileMementos.set(this.id, profileMemento);\n\t\t\t\t}\n\n\t\t\t\treturn profileMemento.getMemento();\n\t\t\t}\n\n\t\t\tcase StorageScope.APPLICATION: {\n\t\t\t\tlet applicationMemento = Memento.applicationMementos.get(this.id);\n\t\t\t\tif (!applicationMemento) {\n\t\t\t\t\tapplicationMemento = new ScopedMemento(this.id, scope, target, this.storageService);\n\t\t\t\t\tMemento.applicationMementos.set(this.id, applicationMemento);\n\t\t\t\t}\n\n\t\t\t\treturn applicationMemento.getMemento();\n\t\t\t}\n\t\t}\n\t}\n\n\tonDidChangeValue(scope: StorageScope, disposables: DisposableStore): Event<IStorageValueChangeEvent> {\n\t\treturn this.storageService.onDidChangeValue(scope, this.id, disposables);\n\t}\n\n\tsaveMemento(): void {\n\t\tMemento.workspaceMementos.get(this.id)?.save();\n\t\tMemento.profileMementos.get(this.id)?.save();\n\t\tMemento.applicationMementos.get(this.id)?.save();\n\t}\n\n\treloadMemento(scope: StorageScope): void {\n\t\tlet memento: ScopedMemento<unknown> | undefined;\n\t\tswitch (scope) {\n\t\t\tcase StorageScope.APPLICATION:\n\t\t\t\tmemento = Memento.applicationMementos.get(this.id);\n\t\t\t\tbreak;\n\t\t\tcase StorageScope.PROFILE:\n\t\t\t\tmemento = Memento.profileMementos.get(this.id);\n\t\t\t\tbreak;\n\t\t\tcase StorageScope.WORKSPACE:\n\t\t\t\tmemento = Memento.workspaceMementos.get(this.id);\n\t\t\t\tbreak;\n\t\t}\n\n\t\tmemento?.reload();\n\t}\n\n\tstatic clear(scope: StorageScope): void {\n\t\tswitch (scope) {\n\t\t\tcase StorageScope.WORKSPACE:\n\t\t\t\tMemento.workspaceMementos.clear();\n\t\t\t\tbreak;\n\t\t\tcase StorageScope.PROFILE:\n\t\t\t\tMemento.profileMementos.clear();\n\t\t\t\tbreak;\n\t\t\tcase StorageScope.APPLICATION:\n\t\t\t\tMemento.applicationMementos.clear();\n\t\t\t\tbreak;\n\t\t}\n\t}\n}\n\nclass ScopedMemento<T> {\n\n\tprivate mementoObj: Partial<T>;\n\n\tconstructor(private id: string, private scope: StorageScope, private target: StorageTarget, private storageService: IStorageService) {\n\t\tthis.mementoObj = this.doLoad();\n\t}\n\n\tprivate doLoad(): Partial<T> {\n\t\ttry {\n\t\t\treturn this.storageService.getObject(this.id, this.scope, {});\n\t\t} catch (error) {\n\t\t\t// Seeing reports from users unable to open editors\n\t\t\t// from memento parsing exceptions. Log the contents\n\t\t\t// to diagnose further\n\t\t\t// https://github.com/microsoft/vscode/issues/102251\n\t\t\tonUnexpectedError(`[memento]: failed to parse contents: ${error} (id: ${this.id}, scope: ${this.scope}, contents: ${this.storageService.get(this.id, this.scope)})`);\n\t\t}\n\n\t\treturn {};\n\t}\n\n\tgetMemento(): Partial<T> {\n\t\treturn this.mementoObj;\n\t}\n\n\treload(): void {\n\n\t\t// Clear old\n\t\tfor (const name of Object.getOwnPropertyNames(this.mementoObj)) {\n\t\t\tdelete this.mementoObj[name as keyof Partial<T>];\n\t\t}\n\n\t\t// Assign new\n\t\tObject.assign(this.mementoObj, this.doLoad());\n\t}\n\n\tsave(): void {\n\t\tif (!isEmptyObject(this.mementoObj)) {\n\t\t\tthis.storageService.store(this.id, this.mementoObj, this.scope, this.target);\n\t\t} else {\n\t\t\tthis.storageService.remove(this.id, this.scope);\n\t\t}\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { IStorageService, IStorageValueChangeEvent, StorageScope, StorageTarget } from '../../platform/storage/common/storage.js';\nimport { isEmptyObject } from '../../base/common/types.js';\nimport { onUnexpectedError } from '../../base/common/errors.js';\nimport { DisposableStore } from '../../base/common/lifecycle.js';\nimport { Event } from '../../base/common/event.js';\n\nexport class Memento<T extends object> {\n\n\tprivate static readonly applicationMementos = new Map<string, ScopedMemento<unknown>>();\n\tprivate static readonly profileMementos = new Map<string, ScopedMemento<unknown>>();\n\tprivate static readonly workspaceMementos = new Map<string, ScopedMemento<unknown>>();\n\n\tprivate static readonly COMMON_PREFIX = 'memento/';\n\n\tprivate readonly id: string;\n\n\tconstructor(id: string, private storageService: IStorageService) {\n\t\tthis.id = Memento.COMMON_PREFIX + id;\n\t}\n\n\tgetMemento(scope: StorageScope, target: StorageTarget): Partial<T> {\n\t\tswitch (scope) {\n\t\t\tcase StorageScope.WORKSPACE: {\n\t\t\t\tlet workspaceMemento = Memento.workspaceMementos.get(this.id);\n\t\t\t\tif (!workspaceMemento) {\n\t\t\t\t\tworkspaceMemento = new ScopedMemento(this.id, scope, target, this.storageService);\n\t\t\t\t\tMemento.workspaceMementos.set(this.id, workspaceMemento);\n\t\t\t\t}\n\n\t\t\t\treturn workspaceMemento.getMemento();\n\t\t\t}\n\n\t\t\tcase StorageScope.PROFILE: {\n\t\t\t\tlet profileMemento = Memento.profileMementos.get(this.id);\n\t\t\t\tif (!profileMemento) {\n\t\t\t\t\tprofileMemento = new ScopedMemento(this.id, scope, target, this.storageService);\n\t\t\t\t\tMemento.profileMementos.set(this.id, profileMemento);\n\t\t\t\t}\n\n\t\t\t\treturn profileMemento.getMemento();\n\t\t\t}\n\n\t\t\tcase StorageScope.APPLICATION: {\n\t\t\t\tlet applicationMemento = Memento.applicationMementos.get(this.id);\n\t\t\t\tif (!applicationMemento) {\n\t\t\t\t\tapplicationMemento = new ScopedMemento(this.id, scope, target, this.storageService);\n\t\t\t\t\tMemento.applicationMementos.set(this.id, applicationMemento);\n\t\t\t\t}\n\n\t\t\t\treturn applicationMemento.getMemento();\n\t\t\t}\n\t\t}\n\t}\n\n\tonDidChangeValue(scope: StorageScope, disposables: DisposableStore): Event<IStorageValueChangeEvent> {\n\t\treturn this.storageService.onDidChangeValue(scope, this.id, disposables);\n\t}\n\n\tsaveMemento(): void {\n\t\tMemento.workspaceMementos.get(this.id)?.save();\n\t\tMemento.profileMementos.get(this.id)?.save();\n\t\tMemento.applicationMementos.get(this.id)?.save();\n\t}\n\n\treloadMemento(scope: StorageScope): void {\n\t\tlet memento: ScopedMemento<unknown> | undefined;\n\t\tswitch (scope) {\n\t\t\tcase StorageScope.APPLICATION:\n\t\t\t\tmemento = Memento.applicationMementos.get(this.id);\n\t\t\t\tbreak;\n\t\t\tcase StorageScope.PROFILE:\n\t\t\t\tmemento = Memento.profileMementos.get(this.id);\n\t\t\t\tbreak;\n\t\t\tcase StorageScope.WORKSPACE:\n\t\t\t\tmemento = Memento.workspaceMementos.get(this.id);\n\t\t\t\tbreak;\n\t\t}\n\n\t\tmemento?.reload();\n\t}\n\n\tstatic clear(scope: StorageScope): void {\n\t\tswitch (scope) {\n\t\t\tcase StorageScope.WORKSPACE:\n\t\t\t\tMemento.workspaceMementos.clear();\n\t\t\t\tbreak;\n\t\t\tcase StorageScope.PROFILE:\n\t\t\t\tMemento.profileMementos.clear();\n\t\t\t\tbreak;\n\t\t\tcase StorageScope.APPLICATION:\n\t\t\t\tMemento.applicationMementos.clear();\n\t\t\t\tbreak;\n\t\t}\n\t}\n}\n\nclass ScopedMemento<T> {\n\n\tprivate mementoObj: Partial<T>;\n\n\tconstructor(private id: string, private scope: StorageScope, private target: StorageTarget, private storageService: IStorageService) {\n\t\tthis.mementoObj = this.doLoad();\n\t}\n\n\tprivate doLoad(): Partial<T> {\n\t\ttry {\n\t\t\treturn this.storageService.getObject(this.id, this.scope, {});\n\t\t} catch (error) {\n\t\t\t// Seeing reports from users unable to open editors\n\t\t\t// from memento parsing exceptions. Log the contents\n\t\t\t// to diagnose further\n\t\t\t// https://github.com/microsoft/vscode/issues/102251\n\t\t\tonUnexpectedError(`[memento]: failed to parse contents: ${error} (id: ${this.id}, scope: ${this.scope}, contents: ${this.storageService.get(this.id, this.scope)})`);\n\t\t}\n\n\t\treturn {};\n\t}\n\n\tgetMemento(): Partial<T> {\n\t\treturn this.mementoObj;\n\t}\n\n\treload(): void {\n\n\t\t// Clear old\n\t\tfor (const name of Object.getOwnPropertyNames(this.mementoObj)) {\n\t\t\tdelete this.mementoObj[name as keyof Partial<T>];\n\t\t}\n\n\t\t// Assign new\n\t\tObject.assign(this.mementoObj, this.doLoad());\n\t}\n\n\tsave(): void {\n\t\tif (!isEmptyObject(this.mementoObj)) {\n\t\t\tthis.storageService.store(this.id, this.mementoObj, this.scope, this.target);\n\t\t} else {\n\t\t\tthis.storageService.remove(this.id, this.scope);\n\t\t}\n\t}\n}\n"]}