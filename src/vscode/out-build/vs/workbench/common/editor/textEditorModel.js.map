{"version":3,"sources":["vs/workbench/common/editor/textEditorModel.ts"],"names":[],"mappings":"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","file":"textEditorModel.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { ITextModel, ITextBufferFactory, ITextSnapshot, ModelConstants } from '../../../editor/common/model.js';\nimport { EditorModel } from './editorModel.js';\nimport { ILanguageSupport } from '../../services/textfile/common/textfiles.js';\nimport { URI } from '../../../base/common/uri.js';\nimport { ITextEditorModel, IResolvedTextEditorModel } from '../../../editor/common/services/resolverService.js';\nimport { ILanguageService, ILanguageSelection } from '../../../editor/common/languages/language.js';\nimport { IModelService } from '../../../editor/common/services/model.js';\nimport { MutableDisposable } from '../../../base/common/lifecycle.js';\nimport { PLAINTEXT_LANGUAGE_ID } from '../../../editor/common/languages/modesRegistry.js';\nimport { ILanguageDetectionService, LanguageDetectionLanguageEventSource } from '../../services/languageDetection/common/languageDetectionWorkerService.js';\nimport { ThrottledDelayer } from '../../../base/common/async.js';\nimport { IAccessibilityService } from '../../../platform/accessibility/common/accessibility.js';\nimport { localize } from '../../../nls.js';\nimport { IMarkdownString } from '../../../base/common/htmlContent.js';\nimport { TextModelEditSource } from '../../../editor/common/textModelEditSource.js';\n\n/**\n * The base text editor model leverages the code editor model. This class is only intended to be subclassed and not instantiated.\n */\nexport class BaseTextEditorModel extends EditorModel implements ITextEditorModel, ILanguageSupport {\n\n\tprivate static readonly AUTO_DETECT_LANGUAGE_THROTTLE_DELAY = 600;\n\n\tprotected textEditorModelHandle: URI | undefined = undefined;\n\n\tprivate createdEditorModel: boolean | undefined;\n\n\tprivate readonly modelDisposeListener = this._register(new MutableDisposable());\n\tprivate readonly autoDetectLanguageThrottler = this._register(new ThrottledDelayer<void>(BaseTextEditorModel.AUTO_DETECT_LANGUAGE_THROTTLE_DELAY));\n\n\tconstructor(\n\t\t@IModelService protected modelService: IModelService,\n\t\t@ILanguageService protected languageService: ILanguageService,\n\t\t@ILanguageDetectionService private readonly languageDetectionService: ILanguageDetectionService,\n\t\t@IAccessibilityService private readonly accessibilityService: IAccessibilityService,\n\t\ttextEditorModelHandle?: URI\n\t) {\n\t\tsuper();\n\n\t\tif (textEditorModelHandle) {\n\t\t\tthis.handleExistingModel(textEditorModelHandle);\n\t\t}\n\t}\n\n\tprivate handleExistingModel(textEditorModelHandle: URI): void {\n\n\t\t// We need the resource to point to an existing model\n\t\tconst model = this.modelService.getModel(textEditorModelHandle);\n\t\tif (!model) {\n\t\t\tthrow new Error(`Document with resource ${textEditorModelHandle.toString(true)} does not exist`);\n\t\t}\n\n\t\tthis.textEditorModelHandle = textEditorModelHandle;\n\n\t\t// Make sure we clean up when this model gets disposed\n\t\tthis.registerModelDisposeListener(model);\n\t}\n\n\tprivate registerModelDisposeListener(model: ITextModel): void {\n\t\tthis.modelDisposeListener.value = model.onWillDispose(() => {\n\t\t\tthis.textEditorModelHandle = undefined; // make sure we do not dispose code editor model again\n\t\t\tthis.dispose();\n\t\t});\n\t}\n\n\tget textEditorModel(): ITextModel | null {\n\t\treturn this.textEditorModelHandle ? this.modelService.getModel(this.textEditorModelHandle) : null;\n\t}\n\n\tisReadonly(): boolean | IMarkdownString {\n\t\treturn true;\n\t}\n\n\tprivate _blockLanguageChangeListener = false;\n\tprivate _languageChangeSource: 'user' | 'api' | undefined = undefined;\n\tget languageChangeSource() { return this._languageChangeSource; }\n\tget hasLanguageSetExplicitly() {\n\t\t// This is technically not 100% correct, because 'api' can also be\n\t\t// set as source if a model is resolved as text first and then\n\t\t// transitions into the resolved language. But to preserve the current\n\t\t// behaviour, we do not change this property. Rather, `languageChangeSource`\n\t\t// can be used to get more fine grained information.\n\t\treturn typeof this._languageChangeSource === 'string';\n\t}\n\n\tsetLanguageId(languageId: string, source?: string): void {\n\n\t\t// Remember that an explicit language was set\n\t\tthis._languageChangeSource = 'user';\n\n\t\tthis.setLanguageIdInternal(languageId, source);\n\t}\n\n\tprivate setLanguageIdInternal(languageId: string, source?: string): void {\n\t\tif (!this.isResolved()) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!languageId || languageId === this.textEditorModel.getLanguageId()) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._blockLanguageChangeListener = true;\n\t\ttry {\n\t\t\tthis.textEditorModel.setLanguage(this.languageService.createById(languageId), source);\n\t\t} finally {\n\t\t\tthis._blockLanguageChangeListener = false;\n\t\t}\n\t}\n\n\tprotected installModelListeners(model: ITextModel): void {\n\n\t\t// Setup listener for lower level language changes\n\t\tconst disposable = this._register(model.onDidChangeLanguage(e => {\n\t\t\tif (\n\t\t\t\te.source === LanguageDetectionLanguageEventSource ||\n\t\t\t\tthis._blockLanguageChangeListener\n\t\t\t) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis._languageChangeSource = 'api';\n\t\t\tdisposable.dispose();\n\t\t}));\n\t}\n\n\tgetLanguageId(): string | undefined {\n\t\treturn this.textEditorModel?.getLanguageId();\n\t}\n\n\tprotected autoDetectLanguage(): Promise<void> {\n\t\treturn this.autoDetectLanguageThrottler.trigger(() => this.doAutoDetectLanguage());\n\t}\n\n\tprivate async doAutoDetectLanguage(): Promise<void> {\n\t\tif (\n\t\t\tthis.hasLanguageSetExplicitly || \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// skip detection when the user has made an explicit choice on the language\n\t\t\t!this.textEditorModelHandle ||\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// require a URI to run the detection for\n\t\t\t!this.languageDetectionService.isEnabledForLanguage(this.getLanguageId() ?? PLAINTEXT_LANGUAGE_ID)\t// require a valid language that is enlisted for detection\n\t\t) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst lang = await this.languageDetectionService.detectLanguage(this.textEditorModelHandle);\n\t\tconst prevLang = this.getLanguageId();\n\t\tif (lang && lang !== prevLang && !this.isDisposed()) {\n\t\t\tthis.setLanguageIdInternal(lang, LanguageDetectionLanguageEventSource);\n\t\t\tconst languageName = this.languageService.getLanguageName(lang);\n\t\t\tthis.accessibilityService.alert(localize('languageAutoDetected', \"Language {0} was automatically detected and set as the language mode.\", languageName ?? lang));\n\t\t}\n\t}\n\n\t/**\n\t * Creates the text editor model with the provided value, optional preferred language\n\t * (can be comma separated for multiple values) and optional resource URL.\n\t */\n\tprotected createTextEditorModel(value: ITextBufferFactory, resource: URI | undefined, preferredLanguageId?: string): ITextModel {\n\t\tconst firstLineText = this.getFirstLineText(value);\n\t\tconst languageSelection = this.getOrCreateLanguage(resource, this.languageService, preferredLanguageId, firstLineText);\n\n\t\treturn this.doCreateTextEditorModel(value, languageSelection, resource);\n\t}\n\n\tprivate doCreateTextEditorModel(value: ITextBufferFactory, languageSelection: ILanguageSelection, resource: URI | undefined): ITextModel {\n\t\tlet model = resource && this.modelService.getModel(resource);\n\t\tif (!model) {\n\t\t\tmodel = this.modelService.createModel(value, languageSelection, resource);\n\t\t\tthis.createdEditorModel = true;\n\n\t\t\t// Make sure we clean up when this model gets disposed\n\t\t\tthis.registerModelDisposeListener(model);\n\t\t} else {\n\t\t\tthis.updateTextEditorModel(value, languageSelection.languageId);\n\t\t}\n\n\t\tthis.textEditorModelHandle = model.uri;\n\n\t\treturn model;\n\t}\n\n\tprotected getFirstLineText(value: ITextBufferFactory | ITextModel): string {\n\n\t\t// text buffer factory\n\t\tconst textBufferFactory = value as ITextBufferFactory;\n\t\tif (typeof textBufferFactory.getFirstLineText === 'function') {\n\t\t\treturn textBufferFactory.getFirstLineText(ModelConstants.FIRST_LINE_DETECTION_LENGTH_LIMIT);\n\t\t}\n\n\t\t// text model\n\t\tconst textSnapshot = value as ITextModel;\n\t\treturn textSnapshot.getLineContent(1).substr(0, ModelConstants.FIRST_LINE_DETECTION_LENGTH_LIMIT);\n\t}\n\n\t/**\n\t * Gets the language for the given identifier. Subclasses can override to provide their own implementation of this lookup.\n\t *\n\t * @param firstLineText optional first line of the text buffer to set the language on. This can be used to guess a language from content.\n\t */\n\tprotected getOrCreateLanguage(resource: URI | undefined, languageService: ILanguageService, preferredLanguage: string | undefined, firstLineText?: string): ILanguageSelection {\n\n\t\t// lookup language via resource path if the provided language is unspecific\n\t\tif (!preferredLanguage || preferredLanguage === PLAINTEXT_LANGUAGE_ID) {\n\t\t\treturn languageService.createByFilepathOrFirstLine(resource ?? null, firstLineText);\n\t\t}\n\n\t\t// otherwise take the preferred language for granted\n\t\treturn languageService.createById(preferredLanguage);\n\t}\n\n\t/**\n\t * Updates the text editor model with the provided value. If the value is the same as the model has, this is a no-op.\n\t */\n\tupdateTextEditorModel(newValue?: ITextBufferFactory, preferredLanguageId?: string, reason?: TextModelEditSource): void {\n\t\tif (!this.isResolved()) {\n\t\t\treturn;\n\t\t}\n\n\t\t// contents\n\t\tif (newValue) {\n\t\t\tthis.modelService.updateModel(this.textEditorModel, newValue, reason);\n\t\t}\n\n\t\t// language (only if specific and changed)\n\t\tif (preferredLanguageId && preferredLanguageId !== PLAINTEXT_LANGUAGE_ID && this.textEditorModel.getLanguageId() !== preferredLanguageId) {\n\t\t\tthis.textEditorModel.setLanguage(this.languageService.createById(preferredLanguageId));\n\t\t}\n\t}\n\n\tcreateSnapshot(this: IResolvedTextEditorModel): ITextSnapshot;\n\tcreateSnapshot(this: ITextEditorModel): ITextSnapshot | null;\n\tcreateSnapshot(): ITextSnapshot | null {\n\t\tif (!this.textEditorModel) {\n\t\t\treturn null;\n\t\t}\n\n\t\treturn this.textEditorModel.createSnapshot(true /* preserve BOM */);\n\t}\n\n\toverride isResolved(): this is IResolvedTextEditorModel {\n\t\treturn !!this.textEditorModelHandle;\n\t}\n\n\toverride dispose(): void {\n\t\tthis.modelDisposeListener.dispose(); // dispose this first because it will trigger another dispose() otherwise\n\n\t\tif (this.textEditorModelHandle && this.createdEditorModel) {\n\t\t\tthis.modelService.destroyModel(this.textEditorModelHandle);\n\t\t}\n\n\t\tthis.textEditorModelHandle = undefined;\n\t\tthis.createdEditorModel = false;\n\n\t\tsuper.dispose();\n\t}\n}\n"]}