{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/base/test/browser/domSanitize.test.ts","vs/base/test/browser/domSanitize.test.ts"],"names":[],"mappings":"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","file":"domSanitize.test.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as assert from 'assert';\nimport { sanitizeHtml } from '../../browser/domSanitize.js';\nimport { Schemas } from '../../common/network.js';\nimport { ensureNoDisposablesAreLeakedInTestSuite } from '../common/utils.js';\n\nsuite('DomSanitize', () => {\n\n\tensureNoDisposablesAreLeakedInTestSuite();\n\n\ttest('removes unsupported tags by default', () => {\n\t\tconst html = '<div>safe<script>alert(1)</script>content</div>';\n\t\tconst result = sanitizeHtml(html);\n\t\tconst str = result.toString();\n\n\t\tassert.ok(str.includes('<div>'));\n\t\tassert.ok(str.includes('safe'));\n\t\tassert.ok(str.includes('content'));\n\t\tassert.ok(!str.includes('<script>'));\n\t\tassert.ok(!str.includes('alert(1)'));\n\t});\n\n\ttest('removes unsupported attributes by default', () => {\n\t\tconst html = '<div onclick=\"alert(1)\" title=\"safe\">content</div>';\n\t\tconst result = sanitizeHtml(html);\n\t\tconst str = result.toString();\n\n\t\tassert.ok(str.includes('<div title=\"safe\">'));\n\t\tassert.ok(!str.includes('onclick'));\n\t\tassert.ok(!str.includes('alert(1)'));\n\t});\n\n\ttest('allows custom tags via config', () => {\n\t\t{\n\t\t\tconst html = '<div>removed</div><custom-tag>hello</custom-tag>';\n\t\t\tconst result = sanitizeHtml(html, {\n\t\t\t\tallowedTags: { override: ['custom-tag'] }\n\t\t\t});\n\t\t\tassert.strictEqual(result.toString(), 'removed<custom-tag>hello</custom-tag>');\n\t\t}\n\t\t{\n\t\t\tconst html = '<div>kept</div><augmented-tag>world</augmented-tag>';\n\t\t\tconst result = sanitizeHtml(html, {\n\t\t\t\tallowedTags: { augment: ['augmented-tag'] }\n\t\t\t});\n\t\t\tassert.strictEqual(result.toString(), '<div>kept</div><augmented-tag>world</augmented-tag>');\n\t\t}\n\t});\n\n\ttest('allows custom attributes via config', () => {\n\t\tconst html = '<div custom-attr=\"value\">content</div>';\n\t\tconst result = sanitizeHtml(html, {\n\t\t\tallowedAttributes: { override: ['custom-attr'] }\n\t\t});\n\t\tconst str = result.toString();\n\n\t\tassert.ok(str.includes('custom-attr=\"value\"'));\n\t});\n\n\ttest('Attributes in config should be case insensitive', () => {\n\t\tconst html = '<div Custom-Attr=\"value\">content</div>';\n\n\t\t{\n\t\t\tconst result = sanitizeHtml(html, {\n\t\t\t\tallowedAttributes: { override: ['custom-attr'] }\n\t\t\t});\n\t\t\tassert.ok(result.toString().includes('custom-attr=\"value\"'));\n\t\t}\n\t\t{\n\t\t\tconst result = sanitizeHtml(html, {\n\t\t\t\tallowedAttributes: { override: ['CUSTOM-ATTR'] }\n\t\t\t});\n\t\t\tassert.ok(result.toString().includes('custom-attr=\"value\"'));\n\t\t}\n\t});\n\n\ttest('removes unsupported protocols for href by default', () => {\n\t\tconst html = '<a href=\"javascript:alert(1)\">bad link</a>';\n\t\tconst result = sanitizeHtml(html);\n\t\tconst str = result.toString();\n\n\t\tassert.ok(str.includes('<a>bad link</a>'));\n\t\tassert.ok(!str.includes('javascript:'));\n\t});\n\n\ttest('removes unsupported protocols for src by default', () => {\n\t\tconst html = '<img alt=\"text\" src=\"javascript:alert(1)\">';\n\t\tconst result = sanitizeHtml(html);\n\t\tconst str = result.toString();\n\n\t\tassert.ok(str.includes('<img alt=\"text\">'));\n\t\tassert.ok(!str.includes('javascript:'));\n\t});\n\n\ttest('allows safe protocols for href', () => {\n\t\tconst html = '<a href=\"https://example.com\">safe link</a>';\n\t\tconst result = sanitizeHtml(html);\n\n\t\tassert.ok(result.toString().includes('href=\"https://example.com\"'));\n\t});\n\n\ttest('allows fragment links', () => {\n\t\tconst html = '<a href=\"#section\">fragment link</a>';\n\t\tconst result = sanitizeHtml(html);\n\t\tconst str = result.toString();\n\n\t\tassert.ok(str.includes('href=\"#section\"'));\n\t});\n\n\ttest('removes data images by default', () => {\n\t\tconst html = '<img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mP8/5+hHgAHggJ/PchI7wAAAABJRU5ErkJggg==\">';\n\t\tconst result = sanitizeHtml(html);\n\t\tconst str = result.toString();\n\n\t\tassert.ok(str.includes('<img>'));\n\t\tassert.ok(!str.includes('src=\"data:'));\n\t});\n\n\ttest('allows data images when enabled', () => {\n\t\tconst html = '<img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mP8/5+hHgAHggJ/PchI7wAAAABJRU5ErkJggg==\">';\n\t\tconst result = sanitizeHtml(html, {\n\t\t\tallowedMediaProtocols: { override: [Schemas.data] }\n\t\t});\n\n\t\tassert.ok(result.toString().includes('src=\"data:image/png;base64,'));\n\t});\n\n\ttest('Removes relative paths for img src by default', () => {\n\t\tconst html = '<img src=\"path/img.png\">';\n\t\tconst result = sanitizeHtml(html);\n\t\tassert.strictEqual(result.toString(), '<img>');\n\t});\n\n\ttest('Can allow relative paths for image', () => {\n\t\tconst html = '<img src=\"path/img.png\">';\n\t\tconst result = sanitizeHtml(html, {\n\t\t\tallowRelativeMediaPaths: true,\n\t\t});\n\t\tassert.strictEqual(result.toString(), '<img src=\"path/img.png\">');\n\t});\n\n\ttest('Supports dynamic attribute sanitization', () => {\n\t\tconst html = '<div title=\"a\" other=\"1\">text1</div><div title=\"b\" other=\"2\">text2</div>';\n\t\tconst result = sanitizeHtml(html, {\n\t\t\tallowedAttributes: {\n\t\t\t\toverride: [\n\t\t\t\t\t{\n\t\t\t\t\t\tattributeName: 'title',\n\t\t\t\t\t\tshouldKeep: (_el, data) => {\n\t\t\t\t\t\t\treturn data.attrValue.includes('b');\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t]\n\t\t\t}\n\t\t});\n\t\tassert.strictEqual(result.toString(), '<div>text1</div><div title=\"b\">text2</div>');\n\t});\n\n\ttest('Supports changing attributes in dynamic sanitization', () => {\n\t\tconst html = '<div title=\"abc\" other=\"1\">text1</div><div title=\"xyz\" other=\"2\">text2</div>';\n\t\tconst result = sanitizeHtml(html, {\n\t\t\tallowedAttributes: {\n\t\t\t\toverride: [\n\t\t\t\t\t{\n\t\t\t\t\t\tattributeName: 'title',\n\t\t\t\t\t\tshouldKeep: (_el, data) => {\n\t\t\t\t\t\t\tif (data.attrValue === 'abc') {\n\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\treturn data.attrValue + data.attrValue;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t]\n\t\t\t}\n\t\t});\n\t\t// xyz title should be preserved and doubled\n\t\tassert.strictEqual(result.toString(), '<div>text1</div><div title=\"xyzxyz\">text2</div>');\n\t});\n\n\ttest('Attr name should clear previously set dynamic sanitizer', () => {\n\t\tconst html = '<div title=\"abc\" other=\"1\">text1</div><div title=\"xyz\" other=\"2\">text2</div>';\n\t\tconst result = sanitizeHtml(html, {\n\t\t\tallowedAttributes: {\n\t\t\t\toverride: [\n\t\t\t\t\t{\n\t\t\t\t\t\tattributeName: 'title',\n\t\t\t\t\t\tshouldKeep: () => false\n\t\t\t\t\t},\n\t\t\t\t\t'title' // Should allow everything since it comes after custom rule\n\t\t\t\t]\n\t\t\t}\n\t\t});\n\t\tassert.strictEqual(result.toString(), '<div title=\"abc\">text1</div><div title=\"xyz\">text2</div>');\n\t});\n\n\tsuite('replaceWithPlaintext', () => {\n\n\t\ttest('replaces unsupported tags with plaintext representation', () => {\n\t\t\tconst html = '<div>safe<script>alert(1)</script>content</div>';\n\t\t\tconst result = sanitizeHtml(html, {\n\t\t\t\treplaceWithPlaintext: true\n\t\t\t});\n\t\t\tconst str = result.toString();\n\t\t\tassert.strictEqual(str, `<div>safe&lt;script&gt;alert(1)&lt;/script&gt;content</div>`);\n\t\t});\n\n\t\ttest('handles self-closing tags correctly', () => {\n\t\t\tconst html = '<div><input type=\"text\"><custom-input /></div>';\n\t\t\tconst result = sanitizeHtml(html, {\n\t\t\t\treplaceWithPlaintext: true\n\t\t\t});\n\t\t\tassert.strictEqual(result.toString(), '<div>&lt;input type=\"text\"&gt;&lt;custom-input&gt;&lt;/custom-input&gt;</div>');\n\t\t});\n\n\t\ttest('handles tags with attributes', () => {\n\t\t\tconst html = '<div><unknown-tag class=\"test\" id=\"myid\">content</unknown-tag></div>';\n\t\t\tconst result = sanitizeHtml(html, {\n\t\t\t\treplaceWithPlaintext: true\n\t\t\t});\n\t\t\tassert.strictEqual(result.toString(), '<div>&lt;unknown-tag class=\"test\" id=\"myid\"&gt;content&lt;/unknown-tag&gt;</div>');\n\t\t});\n\n\t\ttest('handles nested unsupported tags', () => {\n\t\t\tconst html = '<div><outer><inner>nested</inner></outer></div>';\n\t\t\tconst result = sanitizeHtml(html, {\n\t\t\t\treplaceWithPlaintext: true\n\t\t\t});\n\t\t\tassert.strictEqual(result.toString(), '<div>&lt;outer&gt;&lt;inner&gt;nested&lt;/inner&gt;&lt;/outer&gt;</div>');\n\t\t});\n\n\t\ttest('handles comments correctly', () => {\n\t\t\tconst html = '<div><!-- this is a comment -->content</div>';\n\t\t\tconst result = sanitizeHtml(html, {\n\t\t\t\treplaceWithPlaintext: true\n\t\t\t});\n\t\t\tassert.strictEqual(result.toString(), '<div>&lt;!-- this is a comment --&gt;content</div>');\n\t\t});\n\n\t\ttest('handles empty tags', () => {\n\t\t\tconst html = '<div><empty></empty></div>';\n\t\t\tconst result = sanitizeHtml(html, {\n\t\t\t\treplaceWithPlaintext: true\n\t\t\t});\n\t\t\tassert.strictEqual(result.toString(), '<div>&lt;empty&gt;&lt;/empty&gt;</div>');\n\t\t});\n\n\t\ttest('works with custom allowed tags configuration', () => {\n\t\t\tconst html = '<div><custom>allowed</custom><forbidden>not allowed</forbidden></div>';\n\t\t\tconst result = sanitizeHtml(html, {\n\t\t\t\treplaceWithPlaintext: true,\n\t\t\t\tallowedTags: { augment: ['custom'] }\n\t\t\t});\n\t\t\tassert.strictEqual(result.toString(), '<div><custom>allowed</custom>&lt;forbidden&gt;not allowed&lt;/forbidden&gt;</div>');\n\t\t});\n\t});\n});\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as assert from 'assert';\nimport { sanitizeHtml } from '../../browser/domSanitize.js';\nimport { Schemas } from '../../common/network.js';\nimport { ensureNoDisposablesAreLeakedInTestSuite } from '../common/utils.js';\n\nsuite('DomSanitize', () => {\n\n\tensureNoDisposablesAreLeakedInTestSuite();\n\n\ttest('removes unsupported tags by default', () => {\n\t\tconst html = '<div>safe<script>alert(1)</script>content</div>';\n\t\tconst result = sanitizeHtml(html);\n\t\tconst str = result.toString();\n\n\t\tassert.ok(str.includes('<div>'));\n\t\tassert.ok(str.includes('safe'));\n\t\tassert.ok(str.includes('content'));\n\t\tassert.ok(!str.includes('<script>'));\n\t\tassert.ok(!str.includes('alert(1)'));\n\t});\n\n\ttest('removes unsupported attributes by default', () => {\n\t\tconst html = '<div onclick=\"alert(1)\" title=\"safe\">content</div>';\n\t\tconst result = sanitizeHtml(html);\n\t\tconst str = result.toString();\n\n\t\tassert.ok(str.includes('<div title=\"safe\">'));\n\t\tassert.ok(!str.includes('onclick'));\n\t\tassert.ok(!str.includes('alert(1)'));\n\t});\n\n\ttest('allows custom tags via config', () => {\n\t\t{\n\t\t\tconst html = '<div>removed</div><custom-tag>hello</custom-tag>';\n\t\t\tconst result = sanitizeHtml(html, {\n\t\t\t\tallowedTags: { override: ['custom-tag'] }\n\t\t\t});\n\t\t\tassert.strictEqual(result.toString(), 'removed<custom-tag>hello</custom-tag>');\n\t\t}\n\t\t{\n\t\t\tconst html = '<div>kept</div><augmented-tag>world</augmented-tag>';\n\t\t\tconst result = sanitizeHtml(html, {\n\t\t\t\tallowedTags: { augment: ['augmented-tag'] }\n\t\t\t});\n\t\t\tassert.strictEqual(result.toString(), '<div>kept</div><augmented-tag>world</augmented-tag>');\n\t\t}\n\t});\n\n\ttest('allows custom attributes via config', () => {\n\t\tconst html = '<div custom-attr=\"value\">content</div>';\n\t\tconst result = sanitizeHtml(html, {\n\t\t\tallowedAttributes: { override: ['custom-attr'] }\n\t\t});\n\t\tconst str = result.toString();\n\n\t\tassert.ok(str.includes('custom-attr=\"value\"'));\n\t});\n\n\ttest('Attributes in config should be case insensitive', () => {\n\t\tconst html = '<div Custom-Attr=\"value\">content</div>';\n\n\t\t{\n\t\t\tconst result = sanitizeHtml(html, {\n\t\t\t\tallowedAttributes: { override: ['custom-attr'] }\n\t\t\t});\n\t\t\tassert.ok(result.toString().includes('custom-attr=\"value\"'));\n\t\t}\n\t\t{\n\t\t\tconst result = sanitizeHtml(html, {\n\t\t\t\tallowedAttributes: { override: ['CUSTOM-ATTR'] }\n\t\t\t});\n\t\t\tassert.ok(result.toString().includes('custom-attr=\"value\"'));\n\t\t}\n\t});\n\n\ttest('removes unsupported protocols for href by default', () => {\n\t\tconst html = '<a href=\"javascript:alert(1)\">bad link</a>';\n\t\tconst result = sanitizeHtml(html);\n\t\tconst str = result.toString();\n\n\t\tassert.ok(str.includes('<a>bad link</a>'));\n\t\tassert.ok(!str.includes('javascript:'));\n\t});\n\n\ttest('removes unsupported protocols for src by default', () => {\n\t\tconst html = '<img alt=\"text\" src=\"javascript:alert(1)\">';\n\t\tconst result = sanitizeHtml(html);\n\t\tconst str = result.toString();\n\n\t\tassert.ok(str.includes('<img alt=\"text\">'));\n\t\tassert.ok(!str.includes('javascript:'));\n\t});\n\n\ttest('allows safe protocols for href', () => {\n\t\tconst html = '<a href=\"https://example.com\">safe link</a>';\n\t\tconst result = sanitizeHtml(html);\n\n\t\tassert.ok(result.toString().includes('href=\"https://example.com\"'));\n\t});\n\n\ttest('allows fragment links', () => {\n\t\tconst html = '<a href=\"#section\">fragment link</a>';\n\t\tconst result = sanitizeHtml(html);\n\t\tconst str = result.toString();\n\n\t\tassert.ok(str.includes('href=\"#section\"'));\n\t});\n\n\ttest('removes data images by default', () => {\n\t\tconst html = '<img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mP8/5+hHgAHggJ/PchI7wAAAABJRU5ErkJggg==\">';\n\t\tconst result = sanitizeHtml(html);\n\t\tconst str = result.toString();\n\n\t\tassert.ok(str.includes('<img>'));\n\t\tassert.ok(!str.includes('src=\"data:'));\n\t});\n\n\ttest('allows data images when enabled', () => {\n\t\tconst html = '<img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mP8/5+hHgAHggJ/PchI7wAAAABJRU5ErkJggg==\">';\n\t\tconst result = sanitizeHtml(html, {\n\t\t\tallowedMediaProtocols: { override: [Schemas.data] }\n\t\t});\n\n\t\tassert.ok(result.toString().includes('src=\"data:image/png;base64,'));\n\t});\n\n\ttest('Removes relative paths for img src by default', () => {\n\t\tconst html = '<img src=\"path/img.png\">';\n\t\tconst result = sanitizeHtml(html);\n\t\tassert.strictEqual(result.toString(), '<img>');\n\t});\n\n\ttest('Can allow relative paths for image', () => {\n\t\tconst html = '<img src=\"path/img.png\">';\n\t\tconst result = sanitizeHtml(html, {\n\t\t\tallowRelativeMediaPaths: true,\n\t\t});\n\t\tassert.strictEqual(result.toString(), '<img src=\"path/img.png\">');\n\t});\n\n\ttest('Supports dynamic attribute sanitization', () => {\n\t\tconst html = '<div title=\"a\" other=\"1\">text1</div><div title=\"b\" other=\"2\">text2</div>';\n\t\tconst result = sanitizeHtml(html, {\n\t\t\tallowedAttributes: {\n\t\t\t\toverride: [\n\t\t\t\t\t{\n\t\t\t\t\t\tattributeName: 'title',\n\t\t\t\t\t\tshouldKeep: (_el, data) => {\n\t\t\t\t\t\t\treturn data.attrValue.includes('b');\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t]\n\t\t\t}\n\t\t});\n\t\tassert.strictEqual(result.toString(), '<div>text1</div><div title=\"b\">text2</div>');\n\t});\n\n\ttest('Supports changing attributes in dynamic sanitization', () => {\n\t\tconst html = '<div title=\"abc\" other=\"1\">text1</div><div title=\"xyz\" other=\"2\">text2</div>';\n\t\tconst result = sanitizeHtml(html, {\n\t\t\tallowedAttributes: {\n\t\t\t\toverride: [\n\t\t\t\t\t{\n\t\t\t\t\t\tattributeName: 'title',\n\t\t\t\t\t\tshouldKeep: (_el, data) => {\n\t\t\t\t\t\t\tif (data.attrValue === 'abc') {\n\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\treturn data.attrValue + data.attrValue;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t]\n\t\t\t}\n\t\t});\n\t\t// xyz title should be preserved and doubled\n\t\tassert.strictEqual(result.toString(), '<div>text1</div><div title=\"xyzxyz\">text2</div>');\n\t});\n\n\ttest('Attr name should clear previously set dynamic sanitizer', () => {\n\t\tconst html = '<div title=\"abc\" other=\"1\">text1</div><div title=\"xyz\" other=\"2\">text2</div>';\n\t\tconst result = sanitizeHtml(html, {\n\t\t\tallowedAttributes: {\n\t\t\t\toverride: [\n\t\t\t\t\t{\n\t\t\t\t\t\tattributeName: 'title',\n\t\t\t\t\t\tshouldKeep: () => false\n\t\t\t\t\t},\n\t\t\t\t\t'title' // Should allow everything since it comes after custom rule\n\t\t\t\t]\n\t\t\t}\n\t\t});\n\t\tassert.strictEqual(result.toString(), '<div title=\"abc\">text1</div><div title=\"xyz\">text2</div>');\n\t});\n\n\tsuite('replaceWithPlaintext', () => {\n\n\t\ttest('replaces unsupported tags with plaintext representation', () => {\n\t\t\tconst html = '<div>safe<script>alert(1)</script>content</div>';\n\t\t\tconst result = sanitizeHtml(html, {\n\t\t\t\treplaceWithPlaintext: true\n\t\t\t});\n\t\t\tconst str = result.toString();\n\t\t\tassert.strictEqual(str, `<div>safe&lt;script&gt;alert(1)&lt;/script&gt;content</div>`);\n\t\t});\n\n\t\ttest('handles self-closing tags correctly', () => {\n\t\t\tconst html = '<div><input type=\"text\"><custom-input /></div>';\n\t\t\tconst result = sanitizeHtml(html, {\n\t\t\t\treplaceWithPlaintext: true\n\t\t\t});\n\t\t\tassert.strictEqual(result.toString(), '<div>&lt;input type=\"text\"&gt;&lt;custom-input&gt;&lt;/custom-input&gt;</div>');\n\t\t});\n\n\t\ttest('handles tags with attributes', () => {\n\t\t\tconst html = '<div><unknown-tag class=\"test\" id=\"myid\">content</unknown-tag></div>';\n\t\t\tconst result = sanitizeHtml(html, {\n\t\t\t\treplaceWithPlaintext: true\n\t\t\t});\n\t\t\tassert.strictEqual(result.toString(), '<div>&lt;unknown-tag class=\"test\" id=\"myid\"&gt;content&lt;/unknown-tag&gt;</div>');\n\t\t});\n\n\t\ttest('handles nested unsupported tags', () => {\n\t\t\tconst html = '<div><outer><inner>nested</inner></outer></div>';\n\t\t\tconst result = sanitizeHtml(html, {\n\t\t\t\treplaceWithPlaintext: true\n\t\t\t});\n\t\t\tassert.strictEqual(result.toString(), '<div>&lt;outer&gt;&lt;inner&gt;nested&lt;/inner&gt;&lt;/outer&gt;</div>');\n\t\t});\n\n\t\ttest('handles comments correctly', () => {\n\t\t\tconst html = '<div><!-- this is a comment -->content</div>';\n\t\t\tconst result = sanitizeHtml(html, {\n\t\t\t\treplaceWithPlaintext: true\n\t\t\t});\n\t\t\tassert.strictEqual(result.toString(), '<div>&lt;!-- this is a comment --&gt;content</div>');\n\t\t});\n\n\t\ttest('handles empty tags', () => {\n\t\t\tconst html = '<div><empty></empty></div>';\n\t\t\tconst result = sanitizeHtml(html, {\n\t\t\t\treplaceWithPlaintext: true\n\t\t\t});\n\t\t\tassert.strictEqual(result.toString(), '<div>&lt;empty&gt;&lt;/empty&gt;</div>');\n\t\t});\n\n\t\ttest('works with custom allowed tags configuration', () => {\n\t\t\tconst html = '<div><custom>allowed</custom><forbidden>not allowed</forbidden></div>';\n\t\t\tconst result = sanitizeHtml(html, {\n\t\t\t\treplaceWithPlaintext: true,\n\t\t\t\tallowedTags: { augment: ['custom'] }\n\t\t\t});\n\t\t\tassert.strictEqual(result.toString(), '<div><custom>allowed</custom>&lt;forbidden&gt;not allowed&lt;/forbidden&gt;</div>');\n\t\t});\n\t});\n});\n"]}