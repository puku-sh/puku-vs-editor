{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/base/test/node/processes/processes.integrationTest.ts","vs/base/test/node/processes/processes.integrationTest.ts"],"names":[],"mappings":"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","file":"processes.integrationTest.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport assert from 'assert';\nimport * as cp from 'child_process';\nimport { FileAccess } from '../../../common/network.js';\nimport * as objects from '../../../common/objects.js';\nimport * as platform from '../../../common/platform.js';\nimport * as processes from '../../../node/processes.js';\n\nfunction fork(id: string): cp.ChildProcess {\n\tconst opts: any = {\n\t\tenv: objects.mixin(objects.deepClone(process.env), {\n\t\t\tVSCODE_ESM_ENTRYPOINT: id,\n\t\t\tVSCODE_PIPE_LOGGING: 'true',\n\t\t\tVSCODE_VERBOSE_LOGGING: true\n\t\t})\n\t};\n\n\treturn cp.fork(FileAccess.asFileUri('bootstrap-fork').fsPath, ['--type=processTests'], opts);\n}\n\nsuite('Processes', () => {\n\ttest('buffered sending - simple data', function (done: () => void) {\n\t\tif (process.env['VSCODE_PID']) {\n\t\t\treturn done(); // this test fails when run from within VS Code\n\t\t}\n\n\t\tconst child = fork('vs/base/test/node/processes/fixtures/fork');\n\t\tconst sender = processes.createQueuedSender(child);\n\n\t\tlet counter = 0;\n\n\t\tconst msg1 = 'Hello One';\n\t\tconst msg2 = 'Hello Two';\n\t\tconst msg3 = 'Hello Three';\n\n\t\tchild.on('message', msgFromChild => {\n\t\t\tif (msgFromChild === 'ready') {\n\t\t\t\tsender.send(msg1);\n\t\t\t\tsender.send(msg2);\n\t\t\t\tsender.send(msg3);\n\t\t\t} else {\n\t\t\t\tcounter++;\n\n\t\t\t\tif (counter === 1) {\n\t\t\t\t\tassert.strictEqual(msgFromChild, msg1);\n\t\t\t\t} else if (counter === 2) {\n\t\t\t\t\tassert.strictEqual(msgFromChild, msg2);\n\t\t\t\t} else if (counter === 3) {\n\t\t\t\t\tassert.strictEqual(msgFromChild, msg3);\n\n\t\t\t\t\tchild.kill();\n\t\t\t\t\tdone();\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t});\n\n\t(!platform.isWindows || process.env['VSCODE_PID'] ? test.skip : test)('buffered sending - lots of data (potential deadlock on win32)', function (done: () => void) { // test is only relevant for Windows and seems to crash randomly on some Linux builds\n\t\tconst child = fork('vs/base/test/node/processes/fixtures/fork_large');\n\t\tconst sender = processes.createQueuedSender(child);\n\n\t\tconst largeObj = Object.create(null);\n\t\tfor (let i = 0; i < 10000; i++) {\n\t\t\tlargeObj[i] = 'some data';\n\t\t}\n\n\t\tconst msg = JSON.stringify(largeObj);\n\t\tchild.on('message', msgFromChild => {\n\t\t\tif (msgFromChild === 'ready') {\n\t\t\t\tsender.send(msg);\n\t\t\t\tsender.send(msg);\n\t\t\t\tsender.send(msg);\n\t\t\t} else if (msgFromChild === 'done') {\n\t\t\t\tchild.kill();\n\t\t\t\tdone();\n\t\t\t}\n\t\t});\n\t});\n});\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport assert from 'assert';\nimport * as cp from 'child_process';\nimport { FileAccess } from '../../../common/network.js';\nimport * as objects from '../../../common/objects.js';\nimport * as platform from '../../../common/platform.js';\nimport * as processes from '../../../node/processes.js';\n\nfunction fork(id: string): cp.ChildProcess {\n\tconst opts: any = {\n\t\tenv: objects.mixin(objects.deepClone(process.env), {\n\t\t\tVSCODE_ESM_ENTRYPOINT: id,\n\t\t\tVSCODE_PIPE_LOGGING: 'true',\n\t\t\tVSCODE_VERBOSE_LOGGING: true\n\t\t})\n\t};\n\n\treturn cp.fork(FileAccess.asFileUri('bootstrap-fork').fsPath, ['--type=processTests'], opts);\n}\n\nsuite('Processes', () => {\n\ttest('buffered sending - simple data', function (done: () => void) {\n\t\tif (process.env['VSCODE_PID']) {\n\t\t\treturn done(); // this test fails when run from within VS Code\n\t\t}\n\n\t\tconst child = fork('vs/base/test/node/processes/fixtures/fork');\n\t\tconst sender = processes.createQueuedSender(child);\n\n\t\tlet counter = 0;\n\n\t\tconst msg1 = 'Hello One';\n\t\tconst msg2 = 'Hello Two';\n\t\tconst msg3 = 'Hello Three';\n\n\t\tchild.on('message', msgFromChild => {\n\t\t\tif (msgFromChild === 'ready') {\n\t\t\t\tsender.send(msg1);\n\t\t\t\tsender.send(msg2);\n\t\t\t\tsender.send(msg3);\n\t\t\t} else {\n\t\t\t\tcounter++;\n\n\t\t\t\tif (counter === 1) {\n\t\t\t\t\tassert.strictEqual(msgFromChild, msg1);\n\t\t\t\t} else if (counter === 2) {\n\t\t\t\t\tassert.strictEqual(msgFromChild, msg2);\n\t\t\t\t} else if (counter === 3) {\n\t\t\t\t\tassert.strictEqual(msgFromChild, msg3);\n\n\t\t\t\t\tchild.kill();\n\t\t\t\t\tdone();\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t});\n\n\t(!platform.isWindows || process.env['VSCODE_PID'] ? test.skip : test)('buffered sending - lots of data (potential deadlock on win32)', function (done: () => void) { // test is only relevant for Windows and seems to crash randomly on some Linux builds\n\t\tconst child = fork('vs/base/test/node/processes/fixtures/fork_large');\n\t\tconst sender = processes.createQueuedSender(child);\n\n\t\tconst largeObj = Object.create(null);\n\t\tfor (let i = 0; i < 10000; i++) {\n\t\t\tlargeObj[i] = 'some data';\n\t\t}\n\n\t\tconst msg = JSON.stringify(largeObj);\n\t\tchild.on('message', msgFromChild => {\n\t\t\tif (msgFromChild === 'ready') {\n\t\t\t\tsender.send(msg);\n\t\t\t\tsender.send(msg);\n\t\t\t\tsender.send(msg);\n\t\t\t} else if (msgFromChild === 'done') {\n\t\t\t\tchild.kill();\n\t\t\t\tdone();\n\t\t\t}\n\t\t});\n\t});\n});\n"]}