{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/base/test/common/timeTravelScheduler.ts","vs/base/test/common/timeTravelScheduler.ts"],"names":[],"mappings":"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","file":"timeTravelScheduler.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { compareBy, numberComparator, tieBreakComparators } from '../../common/arrays.js';\nimport { Emitter, Event } from '../../common/event.js';\nimport { Disposable, IDisposable } from '../../common/lifecycle.js';\nimport { setTimeout0, setTimeout0IsFaster } from '../../common/platform.js';\n\nexport type TimeOffset = number;\n\nexport interface Scheduler {\n\tschedule(task: ScheduledTask): IDisposable;\n\tget now(): TimeOffset;\n}\n\nexport interface ScheduledTask {\n\treadonly time: TimeOffset;\n\treadonly source: ScheduledTaskSource;\n\n\trun(): void;\n}\n\nexport interface ScheduledTaskSource {\n\ttoString(): string;\n\treadonly stackTrace: string | undefined;\n}\n\ninterface ExtendedScheduledTask extends ScheduledTask {\n\tid: number;\n}\n\nconst scheduledTaskComparator = tieBreakComparators<ExtendedScheduledTask>(\n\tcompareBy(i => i.time, numberComparator),\n\tcompareBy(i => i.id, numberComparator),\n);\n\nexport class TimeTravelScheduler implements Scheduler {\n\tprivate taskCounter = 0;\n\tprivate _nowMs: TimeOffset = 0;\n\tprivate readonly queue: PriorityQueue<ExtendedScheduledTask> = new SimplePriorityQueue<ExtendedScheduledTask>([], scheduledTaskComparator);\n\n\tprivate readonly taskScheduledEmitter = new Emitter<{ task: ScheduledTask }>();\n\tpublic readonly onTaskScheduled = this.taskScheduledEmitter.event;\n\n\tconstructor(startTimeMs: number) {\n\t\tthis._nowMs = startTimeMs;\n\t}\n\n\tschedule(task: ScheduledTask): IDisposable {\n\t\tif (task.time < this._nowMs) {\n\t\t\tthrow new Error(`Scheduled time (${task.time}) must be equal to or greater than the current time (${this._nowMs}).`);\n\t\t}\n\t\tconst extendedTask: ExtendedScheduledTask = { ...task, id: this.taskCounter++ };\n\t\tthis.queue.add(extendedTask);\n\t\tthis.taskScheduledEmitter.fire({ task });\n\t\treturn { dispose: () => this.queue.remove(extendedTask) };\n\t}\n\n\tget now(): TimeOffset {\n\t\treturn this._nowMs;\n\t}\n\n\tget hasScheduledTasks(): boolean {\n\t\treturn this.queue.length > 0;\n\t}\n\n\tgetScheduledTasks(): readonly ScheduledTask[] {\n\t\treturn this.queue.toSortedArray();\n\t}\n\n\trunNext(): ScheduledTask | undefined {\n\t\tconst task = this.queue.removeMin();\n\t\tif (task) {\n\t\t\tthis._nowMs = task.time;\n\t\t\ttask.run();\n\t\t}\n\n\t\treturn task;\n\t}\n\n\tinstallGlobally(): IDisposable {\n\t\treturn overwriteGlobals(this);\n\t}\n}\n\nexport class AsyncSchedulerProcessor extends Disposable {\n\tprivate isProcessing = false;\n\tprivate readonly _history = new Array<ScheduledTask>();\n\tpublic get history(): readonly ScheduledTask[] { return this._history; }\n\n\tprivate readonly maxTaskCount: number;\n\tprivate readonly useSetImmediate: boolean;\n\n\tprivate readonly queueEmptyEmitter = new Emitter<void>();\n\tpublic readonly onTaskQueueEmpty = this.queueEmptyEmitter.event;\n\n\tprivate lastError: Error | undefined;\n\n\tconstructor(private readonly scheduler: TimeTravelScheduler, options?: { useSetImmediate?: boolean; maxTaskCount?: number }) {\n\t\tsuper();\n\n\t\tthis.maxTaskCount = options && options.maxTaskCount ? options.maxTaskCount : 100;\n\t\tthis.useSetImmediate = options && options.useSetImmediate ? options.useSetImmediate : false;\n\n\t\tthis._register(scheduler.onTaskScheduled(() => {\n\t\t\tif (this.isProcessing) {\n\t\t\t\treturn;\n\t\t\t} else {\n\t\t\t\tthis.isProcessing = true;\n\t\t\t\tthis.schedule();\n\t\t\t}\n\t\t}));\n\t}\n\n\tprivate schedule() {\n\t\t// This allows promises created by a previous task to settle and schedule tasks before the next task is run.\n\t\t// Tasks scheduled in those promises might have to run before the current next task.\n\t\tPromise.resolve().then(() => {\n\t\t\tif (this.useSetImmediate) {\n\t\t\t\toriginalGlobalValues.setImmediate(() => this.process());\n\t\t\t} else if (setTimeout0IsFaster) {\n\t\t\t\tsetTimeout0(() => this.process());\n\t\t\t} else {\n\t\t\t\toriginalGlobalValues.setTimeout(() => this.process());\n\t\t\t}\n\t\t});\n\t}\n\n\tprivate process() {\n\t\tconst executedTask = this.scheduler.runNext();\n\t\tif (executedTask) {\n\t\t\tthis._history.push(executedTask);\n\n\t\t\tif (this.history.length >= this.maxTaskCount && this.scheduler.hasScheduledTasks) {\n\t\t\t\tconst lastTasks = this._history.slice(Math.max(0, this.history.length - 10)).map(h => `${h.source.toString()}: ${h.source.stackTrace}`);\n\t\t\t\tconst e = new Error(`Queue did not get empty after processing ${this.history.length} items. These are the last ${lastTasks.length} scheduled tasks:\\n${lastTasks.join('\\n\\n\\n')}`);\n\t\t\t\tthis.lastError = e;\n\t\t\t\tthrow e;\n\t\t\t}\n\t\t}\n\n\t\tif (this.scheduler.hasScheduledTasks) {\n\t\t\tthis.schedule();\n\t\t} else {\n\t\t\tthis.isProcessing = false;\n\t\t\tthis.queueEmptyEmitter.fire();\n\t\t}\n\t}\n\n\twaitForEmptyQueue(): Promise<void> {\n\t\tif (this.lastError) {\n\t\t\tconst error = this.lastError;\n\t\t\tthis.lastError = undefined;\n\t\t\tthrow error;\n\t\t}\n\t\tif (!this.isProcessing) {\n\t\t\treturn Promise.resolve();\n\t\t} else {\n\t\t\treturn Event.toPromise(this.onTaskQueueEmpty).then(() => {\n\t\t\t\tif (this.lastError) {\n\t\t\t\t\tthrow this.lastError;\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n}\n\n\nexport async function runWithFakedTimers<T>(options: { startTime?: number; useFakeTimers?: boolean; useSetImmediate?: boolean; maxTaskCount?: number }, fn: () => Promise<T>): Promise<T> {\n\tconst useFakeTimers = options.useFakeTimers === undefined ? true : options.useFakeTimers;\n\tif (!useFakeTimers) {\n\t\treturn fn();\n\t}\n\n\tconst scheduler = new TimeTravelScheduler(options.startTime ?? 0);\n\tconst schedulerProcessor = new AsyncSchedulerProcessor(scheduler, { useSetImmediate: options.useSetImmediate, maxTaskCount: options.maxTaskCount });\n\tconst globalInstallDisposable = scheduler.installGlobally();\n\n\tlet didThrow = true;\n\tlet result: T;\n\ttry {\n\t\tresult = await fn();\n\t\tdidThrow = false;\n\t} finally {\n\t\tglobalInstallDisposable.dispose();\n\n\t\ttry {\n\t\t\tif (!didThrow) {\n\t\t\t\t// We process the remaining scheduled tasks.\n\t\t\t\t// The global override is no longer active, so during this, no more tasks will be scheduled.\n\t\t\t\tawait schedulerProcessor.waitForEmptyQueue();\n\t\t\t}\n\t\t} finally {\n\t\t\tschedulerProcessor.dispose();\n\t\t}\n\t}\n\n\treturn result;\n}\n\nexport const originalGlobalValues = {\n\tsetTimeout: globalThis.setTimeout.bind(globalThis),\n\tclearTimeout: globalThis.clearTimeout.bind(globalThis),\n\tsetInterval: globalThis.setInterval.bind(globalThis),\n\tclearInterval: globalThis.clearInterval.bind(globalThis),\n\tsetImmediate: globalThis.setImmediate?.bind(globalThis),\n\tclearImmediate: globalThis.clearImmediate?.bind(globalThis),\n\trequestAnimationFrame: globalThis.requestAnimationFrame?.bind(globalThis),\n\tcancelAnimationFrame: globalThis.cancelAnimationFrame?.bind(globalThis),\n\tDate: globalThis.Date,\n};\n\nfunction setTimeout(scheduler: Scheduler, handler: TimerHandler, timeout: number = 0): IDisposable {\n\tif (typeof handler === 'string') {\n\t\tthrow new Error('String handler args should not be used and are not supported');\n\t}\n\n\treturn scheduler.schedule({\n\t\ttime: scheduler.now + timeout,\n\t\trun: () => {\n\t\t\thandler();\n\t\t},\n\t\tsource: {\n\t\t\ttoString() { return 'setTimeout'; },\n\t\t\tstackTrace: new Error().stack,\n\t\t}\n\t});\n}\n\nfunction setInterval(scheduler: Scheduler, handler: TimerHandler, interval: number): IDisposable {\n\tif (typeof handler === 'string') {\n\t\tthrow new Error('String handler args should not be used and are not supported');\n\t}\n\tconst validatedHandler = handler;\n\n\tlet iterCount = 0;\n\tconst stackTrace = new Error().stack;\n\n\tlet disposed = false;\n\tlet lastDisposable: IDisposable;\n\n\tfunction schedule(): void {\n\t\titerCount++;\n\t\tconst curIter = iterCount;\n\t\tlastDisposable = scheduler.schedule({\n\t\t\ttime: scheduler.now + interval,\n\t\t\trun() {\n\t\t\t\tif (!disposed) {\n\t\t\t\t\tschedule();\n\t\t\t\t\tvalidatedHandler();\n\t\t\t\t}\n\t\t\t},\n\t\t\tsource: {\n\t\t\t\ttoString() { return `setInterval (iteration ${curIter})`; },\n\t\t\t\tstackTrace,\n\t\t\t}\n\t\t});\n\t}\n\n\tschedule();\n\n\treturn {\n\t\tdispose: () => {\n\t\t\tif (disposed) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tdisposed = true;\n\t\t\tlastDisposable.dispose();\n\t\t}\n\t};\n}\n\nfunction overwriteGlobals(scheduler: Scheduler): IDisposable {\n\t// eslint-disable-next-line local/code-no-any-casts\n\tglobalThis.setTimeout = ((handler: TimerHandler, timeout?: number) => setTimeout(scheduler, handler, timeout)) as any;\n\tglobalThis.clearTimeout = (timeoutId: any) => {\n\t\tif (typeof timeoutId === 'object' && timeoutId && 'dispose' in timeoutId) {\n\t\t\ttimeoutId.dispose();\n\t\t} else {\n\t\t\toriginalGlobalValues.clearTimeout(timeoutId);\n\t\t}\n\t};\n\n\t// eslint-disable-next-line local/code-no-any-casts\n\tglobalThis.setInterval = ((handler: TimerHandler, timeout: number) => setInterval(scheduler, handler, timeout)) as any;\n\tglobalThis.clearInterval = (timeoutId: any) => {\n\t\tif (typeof timeoutId === 'object' && timeoutId && 'dispose' in timeoutId) {\n\t\t\ttimeoutId.dispose();\n\t\t} else {\n\t\t\toriginalGlobalValues.clearInterval(timeoutId);\n\t\t}\n\t};\n\n\tglobalThis.Date = createDateClass(scheduler);\n\n\treturn {\n\t\tdispose: () => {\n\t\t\tObject.assign(globalThis, originalGlobalValues);\n\t\t}\n\t};\n}\n\nfunction createDateClass(scheduler: Scheduler): DateConstructor {\n\tconst OriginalDate = originalGlobalValues.Date;\n\n\tfunction SchedulerDate(this: any, ...args: any): any {\n\t\t// the Date constructor called as a function, ref Ecma-262 Edition 5.1, section 15.9.2.\n\t\t// This remains so in the 10th edition of 2019 as well.\n\t\tif (!(this instanceof SchedulerDate)) {\n\t\t\treturn new OriginalDate(scheduler.now).toString();\n\t\t}\n\n\t\t// if Date is called as a constructor with 'new' keyword\n\t\tif (args.length === 0) {\n\t\t\treturn new OriginalDate(scheduler.now);\n\t\t}\n\t\t// eslint-disable-next-line local/code-no-any-casts\n\t\treturn new (OriginalDate as any)(...args);\n\t}\n\n\tfor (const prop in OriginalDate) {\n\t\tif (OriginalDate.hasOwnProperty(prop)) {\n\t\t\t// eslint-disable-next-line local/code-no-any-casts\n\t\t\t(SchedulerDate as any)[prop] = (OriginalDate as any)[prop];\n\t\t}\n\t}\n\n\tSchedulerDate.now = function now() {\n\t\treturn scheduler.now;\n\t};\n\tSchedulerDate.toString = function toString() {\n\t\treturn OriginalDate.toString();\n\t};\n\tSchedulerDate.prototype = OriginalDate.prototype;\n\tSchedulerDate.parse = OriginalDate.parse;\n\tSchedulerDate.UTC = OriginalDate.UTC;\n\tSchedulerDate.prototype.toUTCString = OriginalDate.prototype.toUTCString;\n\n\t// eslint-disable-next-line local/code-no-any-casts\n\treturn SchedulerDate as any;\n}\n\ninterface PriorityQueue<T> {\n\tlength: number;\n\tadd(value: T): void;\n\tremove(value: T): void;\n\n\tremoveMin(): T | undefined;\n\ttoSortedArray(): T[];\n}\n\nclass SimplePriorityQueue<T> implements PriorityQueue<T> {\n\tprivate isSorted = false;\n\tprivate items: T[];\n\n\tconstructor(items: T[], private readonly compare: (a: T, b: T) => number) {\n\t\tthis.items = items;\n\t}\n\n\tget length(): number {\n\t\treturn this.items.length;\n\t}\n\n\tadd(value: T): void {\n\t\tthis.items.push(value);\n\t\tthis.isSorted = false;\n\t}\n\n\tremove(value: T): void {\n\t\tconst idx = this.items.indexOf(value);\n\t\tif (idx !== -1) {\n\t\t\tthis.items.splice(idx, 1);\n\t\t\tthis.isSorted = false;\n\t\t}\n\t}\n\n\tremoveMin(): T | undefined {\n\t\tthis.ensureSorted();\n\t\treturn this.items.shift();\n\t}\n\n\tgetMin(): T | undefined {\n\t\tthis.ensureSorted();\n\t\treturn this.items[0];\n\t}\n\n\ttoSortedArray(): T[] {\n\t\tthis.ensureSorted();\n\t\treturn [...this.items];\n\t}\n\n\tprivate ensureSorted() {\n\t\tif (!this.isSorted) {\n\t\t\tthis.items.sort(this.compare);\n\t\t\tthis.isSorted = true;\n\t\t}\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { compareBy, numberComparator, tieBreakComparators } from '../../common/arrays.js';\nimport { Emitter, Event } from '../../common/event.js';\nimport { Disposable, IDisposable } from '../../common/lifecycle.js';\nimport { setTimeout0, setTimeout0IsFaster } from '../../common/platform.js';\n\nexport type TimeOffset = number;\n\nexport interface Scheduler {\n\tschedule(task: ScheduledTask): IDisposable;\n\tget now(): TimeOffset;\n}\n\nexport interface ScheduledTask {\n\treadonly time: TimeOffset;\n\treadonly source: ScheduledTaskSource;\n\n\trun(): void;\n}\n\nexport interface ScheduledTaskSource {\n\ttoString(): string;\n\treadonly stackTrace: string | undefined;\n}\n\ninterface ExtendedScheduledTask extends ScheduledTask {\n\tid: number;\n}\n\nconst scheduledTaskComparator = tieBreakComparators<ExtendedScheduledTask>(\n\tcompareBy(i => i.time, numberComparator),\n\tcompareBy(i => i.id, numberComparator),\n);\n\nexport class TimeTravelScheduler implements Scheduler {\n\tprivate taskCounter = 0;\n\tprivate _nowMs: TimeOffset = 0;\n\tprivate readonly queue: PriorityQueue<ExtendedScheduledTask> = new SimplePriorityQueue<ExtendedScheduledTask>([], scheduledTaskComparator);\n\n\tprivate readonly taskScheduledEmitter = new Emitter<{ task: ScheduledTask }>();\n\tpublic readonly onTaskScheduled = this.taskScheduledEmitter.event;\n\n\tconstructor(startTimeMs: number) {\n\t\tthis._nowMs = startTimeMs;\n\t}\n\n\tschedule(task: ScheduledTask): IDisposable {\n\t\tif (task.time < this._nowMs) {\n\t\t\tthrow new Error(`Scheduled time (${task.time}) must be equal to or greater than the current time (${this._nowMs}).`);\n\t\t}\n\t\tconst extendedTask: ExtendedScheduledTask = { ...task, id: this.taskCounter++ };\n\t\tthis.queue.add(extendedTask);\n\t\tthis.taskScheduledEmitter.fire({ task });\n\t\treturn { dispose: () => this.queue.remove(extendedTask) };\n\t}\n\n\tget now(): TimeOffset {\n\t\treturn this._nowMs;\n\t}\n\n\tget hasScheduledTasks(): boolean {\n\t\treturn this.queue.length > 0;\n\t}\n\n\tgetScheduledTasks(): readonly ScheduledTask[] {\n\t\treturn this.queue.toSortedArray();\n\t}\n\n\trunNext(): ScheduledTask | undefined {\n\t\tconst task = this.queue.removeMin();\n\t\tif (task) {\n\t\t\tthis._nowMs = task.time;\n\t\t\ttask.run();\n\t\t}\n\n\t\treturn task;\n\t}\n\n\tinstallGlobally(): IDisposable {\n\t\treturn overwriteGlobals(this);\n\t}\n}\n\nexport class AsyncSchedulerProcessor extends Disposable {\n\tprivate isProcessing = false;\n\tprivate readonly _history = new Array<ScheduledTask>();\n\tpublic get history(): readonly ScheduledTask[] { return this._history; }\n\n\tprivate readonly maxTaskCount: number;\n\tprivate readonly useSetImmediate: boolean;\n\n\tprivate readonly queueEmptyEmitter = new Emitter<void>();\n\tpublic readonly onTaskQueueEmpty = this.queueEmptyEmitter.event;\n\n\tprivate lastError: Error | undefined;\n\n\tconstructor(private readonly scheduler: TimeTravelScheduler, options?: { useSetImmediate?: boolean; maxTaskCount?: number }) {\n\t\tsuper();\n\n\t\tthis.maxTaskCount = options && options.maxTaskCount ? options.maxTaskCount : 100;\n\t\tthis.useSetImmediate = options && options.useSetImmediate ? options.useSetImmediate : false;\n\n\t\tthis._register(scheduler.onTaskScheduled(() => {\n\t\t\tif (this.isProcessing) {\n\t\t\t\treturn;\n\t\t\t} else {\n\t\t\t\tthis.isProcessing = true;\n\t\t\t\tthis.schedule();\n\t\t\t}\n\t\t}));\n\t}\n\n\tprivate schedule() {\n\t\t// This allows promises created by a previous task to settle and schedule tasks before the next task is run.\n\t\t// Tasks scheduled in those promises might have to run before the current next task.\n\t\tPromise.resolve().then(() => {\n\t\t\tif (this.useSetImmediate) {\n\t\t\t\toriginalGlobalValues.setImmediate(() => this.process());\n\t\t\t} else if (setTimeout0IsFaster) {\n\t\t\t\tsetTimeout0(() => this.process());\n\t\t\t} else {\n\t\t\t\toriginalGlobalValues.setTimeout(() => this.process());\n\t\t\t}\n\t\t});\n\t}\n\n\tprivate process() {\n\t\tconst executedTask = this.scheduler.runNext();\n\t\tif (executedTask) {\n\t\t\tthis._history.push(executedTask);\n\n\t\t\tif (this.history.length >= this.maxTaskCount && this.scheduler.hasScheduledTasks) {\n\t\t\t\tconst lastTasks = this._history.slice(Math.max(0, this.history.length - 10)).map(h => `${h.source.toString()}: ${h.source.stackTrace}`);\n\t\t\t\tconst e = new Error(`Queue did not get empty after processing ${this.history.length} items. These are the last ${lastTasks.length} scheduled tasks:\\n${lastTasks.join('\\n\\n\\n')}`);\n\t\t\t\tthis.lastError = e;\n\t\t\t\tthrow e;\n\t\t\t}\n\t\t}\n\n\t\tif (this.scheduler.hasScheduledTasks) {\n\t\t\tthis.schedule();\n\t\t} else {\n\t\t\tthis.isProcessing = false;\n\t\t\tthis.queueEmptyEmitter.fire();\n\t\t}\n\t}\n\n\twaitForEmptyQueue(): Promise<void> {\n\t\tif (this.lastError) {\n\t\t\tconst error = this.lastError;\n\t\t\tthis.lastError = undefined;\n\t\t\tthrow error;\n\t\t}\n\t\tif (!this.isProcessing) {\n\t\t\treturn Promise.resolve();\n\t\t} else {\n\t\t\treturn Event.toPromise(this.onTaskQueueEmpty).then(() => {\n\t\t\t\tif (this.lastError) {\n\t\t\t\t\tthrow this.lastError;\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n}\n\n\nexport async function runWithFakedTimers<T>(options: { startTime?: number; useFakeTimers?: boolean; useSetImmediate?: boolean; maxTaskCount?: number }, fn: () => Promise<T>): Promise<T> {\n\tconst useFakeTimers = options.useFakeTimers === undefined ? true : options.useFakeTimers;\n\tif (!useFakeTimers) {\n\t\treturn fn();\n\t}\n\n\tconst scheduler = new TimeTravelScheduler(options.startTime ?? 0);\n\tconst schedulerProcessor = new AsyncSchedulerProcessor(scheduler, { useSetImmediate: options.useSetImmediate, maxTaskCount: options.maxTaskCount });\n\tconst globalInstallDisposable = scheduler.installGlobally();\n\n\tlet didThrow = true;\n\tlet result: T;\n\ttry {\n\t\tresult = await fn();\n\t\tdidThrow = false;\n\t} finally {\n\t\tglobalInstallDisposable.dispose();\n\n\t\ttry {\n\t\t\tif (!didThrow) {\n\t\t\t\t// We process the remaining scheduled tasks.\n\t\t\t\t// The global override is no longer active, so during this, no more tasks will be scheduled.\n\t\t\t\tawait schedulerProcessor.waitForEmptyQueue();\n\t\t\t}\n\t\t} finally {\n\t\t\tschedulerProcessor.dispose();\n\t\t}\n\t}\n\n\treturn result;\n}\n\nexport const originalGlobalValues = {\n\tsetTimeout: globalThis.setTimeout.bind(globalThis),\n\tclearTimeout: globalThis.clearTimeout.bind(globalThis),\n\tsetInterval: globalThis.setInterval.bind(globalThis),\n\tclearInterval: globalThis.clearInterval.bind(globalThis),\n\tsetImmediate: globalThis.setImmediate?.bind(globalThis),\n\tclearImmediate: globalThis.clearImmediate?.bind(globalThis),\n\trequestAnimationFrame: globalThis.requestAnimationFrame?.bind(globalThis),\n\tcancelAnimationFrame: globalThis.cancelAnimationFrame?.bind(globalThis),\n\tDate: globalThis.Date,\n};\n\nfunction setTimeout(scheduler: Scheduler, handler: TimerHandler, timeout: number = 0): IDisposable {\n\tif (typeof handler === 'string') {\n\t\tthrow new Error('String handler args should not be used and are not supported');\n\t}\n\n\treturn scheduler.schedule({\n\t\ttime: scheduler.now + timeout,\n\t\trun: () => {\n\t\t\thandler();\n\t\t},\n\t\tsource: {\n\t\t\ttoString() { return 'setTimeout'; },\n\t\t\tstackTrace: new Error().stack,\n\t\t}\n\t});\n}\n\nfunction setInterval(scheduler: Scheduler, handler: TimerHandler, interval: number): IDisposable {\n\tif (typeof handler === 'string') {\n\t\tthrow new Error('String handler args should not be used and are not supported');\n\t}\n\tconst validatedHandler = handler;\n\n\tlet iterCount = 0;\n\tconst stackTrace = new Error().stack;\n\n\tlet disposed = false;\n\tlet lastDisposable: IDisposable;\n\n\tfunction schedule(): void {\n\t\titerCount++;\n\t\tconst curIter = iterCount;\n\t\tlastDisposable = scheduler.schedule({\n\t\t\ttime: scheduler.now + interval,\n\t\t\trun() {\n\t\t\t\tif (!disposed) {\n\t\t\t\t\tschedule();\n\t\t\t\t\tvalidatedHandler();\n\t\t\t\t}\n\t\t\t},\n\t\t\tsource: {\n\t\t\t\ttoString() { return `setInterval (iteration ${curIter})`; },\n\t\t\t\tstackTrace,\n\t\t\t}\n\t\t});\n\t}\n\n\tschedule();\n\n\treturn {\n\t\tdispose: () => {\n\t\t\tif (disposed) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tdisposed = true;\n\t\t\tlastDisposable.dispose();\n\t\t}\n\t};\n}\n\nfunction overwriteGlobals(scheduler: Scheduler): IDisposable {\n\t// eslint-disable-next-line local/code-no-any-casts\n\tglobalThis.setTimeout = ((handler: TimerHandler, timeout?: number) => setTimeout(scheduler, handler, timeout)) as any;\n\tglobalThis.clearTimeout = (timeoutId: any) => {\n\t\tif (typeof timeoutId === 'object' && timeoutId && 'dispose' in timeoutId) {\n\t\t\ttimeoutId.dispose();\n\t\t} else {\n\t\t\toriginalGlobalValues.clearTimeout(timeoutId);\n\t\t}\n\t};\n\n\t// eslint-disable-next-line local/code-no-any-casts\n\tglobalThis.setInterval = ((handler: TimerHandler, timeout: number) => setInterval(scheduler, handler, timeout)) as any;\n\tglobalThis.clearInterval = (timeoutId: any) => {\n\t\tif (typeof timeoutId === 'object' && timeoutId && 'dispose' in timeoutId) {\n\t\t\ttimeoutId.dispose();\n\t\t} else {\n\t\t\toriginalGlobalValues.clearInterval(timeoutId);\n\t\t}\n\t};\n\n\tglobalThis.Date = createDateClass(scheduler);\n\n\treturn {\n\t\tdispose: () => {\n\t\t\tObject.assign(globalThis, originalGlobalValues);\n\t\t}\n\t};\n}\n\nfunction createDateClass(scheduler: Scheduler): DateConstructor {\n\tconst OriginalDate = originalGlobalValues.Date;\n\n\tfunction SchedulerDate(this: any, ...args: any): any {\n\t\t// the Date constructor called as a function, ref Ecma-262 Edition 5.1, section 15.9.2.\n\t\t// This remains so in the 10th edition of 2019 as well.\n\t\tif (!(this instanceof SchedulerDate)) {\n\t\t\treturn new OriginalDate(scheduler.now).toString();\n\t\t}\n\n\t\t// if Date is called as a constructor with 'new' keyword\n\t\tif (args.length === 0) {\n\t\t\treturn new OriginalDate(scheduler.now);\n\t\t}\n\t\t// eslint-disable-next-line local/code-no-any-casts\n\t\treturn new (OriginalDate as any)(...args);\n\t}\n\n\tfor (const prop in OriginalDate) {\n\t\tif (OriginalDate.hasOwnProperty(prop)) {\n\t\t\t// eslint-disable-next-line local/code-no-any-casts\n\t\t\t(SchedulerDate as any)[prop] = (OriginalDate as any)[prop];\n\t\t}\n\t}\n\n\tSchedulerDate.now = function now() {\n\t\treturn scheduler.now;\n\t};\n\tSchedulerDate.toString = function toString() {\n\t\treturn OriginalDate.toString();\n\t};\n\tSchedulerDate.prototype = OriginalDate.prototype;\n\tSchedulerDate.parse = OriginalDate.parse;\n\tSchedulerDate.UTC = OriginalDate.UTC;\n\tSchedulerDate.prototype.toUTCString = OriginalDate.prototype.toUTCString;\n\n\t// eslint-disable-next-line local/code-no-any-casts\n\treturn SchedulerDate as any;\n}\n\ninterface PriorityQueue<T> {\n\tlength: number;\n\tadd(value: T): void;\n\tremove(value: T): void;\n\n\tremoveMin(): T | undefined;\n\ttoSortedArray(): T[];\n}\n\nclass SimplePriorityQueue<T> implements PriorityQueue<T> {\n\tprivate isSorted = false;\n\tprivate items: T[];\n\n\tconstructor(items: T[], private readonly compare: (a: T, b: T) => number) {\n\t\tthis.items = items;\n\t}\n\n\tget length(): number {\n\t\treturn this.items.length;\n\t}\n\n\tadd(value: T): void {\n\t\tthis.items.push(value);\n\t\tthis.isSorted = false;\n\t}\n\n\tremove(value: T): void {\n\t\tconst idx = this.items.indexOf(value);\n\t\tif (idx !== -1) {\n\t\t\tthis.items.splice(idx, 1);\n\t\t\tthis.isSorted = false;\n\t\t}\n\t}\n\n\tremoveMin(): T | undefined {\n\t\tthis.ensureSorted();\n\t\treturn this.items.shift();\n\t}\n\n\tgetMin(): T | undefined {\n\t\tthis.ensureSorted();\n\t\treturn this.items[0];\n\t}\n\n\ttoSortedArray(): T[] {\n\t\tthis.ensureSorted();\n\t\treturn [...this.items];\n\t}\n\n\tprivate ensureSorted() {\n\t\tif (!this.isSorted) {\n\t\t\tthis.items.sort(this.compare);\n\t\t\tthis.isSorted = true;\n\t\t}\n\t}\n}\n"]}