{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/base/test/common/sseParser.test.ts","vs/base/test/common/sseParser.test.ts"],"names":[],"mappings":"AAAA;;;gGAGgG;AAEhG,OAAO,KAAK,MAAM,MAAM,QAAQ,CAAC;AACjC,OAAO,EAAa,SAAS,EAAE,MAAM,2BAA2B,CAAC;AACjE,OAAO,EAAE,uCAAuC,EAAE,MAAM,YAAY,CAAC;AAErE,8DAA8D;AAC9D,SAAS,YAAY,CAAC,GAAW;IAChC,OAAO,IAAI,WAAW,EAAE,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC;AACtC,CAAC;AAED,KAAK,CAAC,WAAW,EAAE,GAAG,EAAE;IACvB,IAAI,cAA2B,CAAC;IAChC,IAAI,MAAiB,CAAC;IAEtB,uCAAuC,EAAE,CAAC;IAE1C,KAAK,CAAC,GAAG,EAAE;QACV,cAAc,GAAG,EAAE,CAAC;QACpB,MAAM,GAAG,IAAI,SAAS,CAAC,CAAC,KAAK,EAAE,EAAE,CAAC,cAAc,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC,CAAC;IAC/D,CAAC,CAAC,CAAC;IACH,IAAI,CAAC,sBAAsB,EAAE,GAAG,EAAE;QACjC,MAAM,CAAC,IAAI,CAAC,YAAY,CAAC,uBAAuB,CAAC,CAAC,CAAC;QAEnD,MAAM,CAAC,WAAW,CAAC,cAAc,CAAC,MAAM,EAAE,CAAC,CAAC,CAAC;QAC7C,MAAM,CAAC,WAAW,CAAC,cAAc,CAAC,CAAC,CAAC,CAAC,IAAI,EAAE,SAAS,CAAC,CAAC;QACtD,MAAM,CAAC,WAAW,CAAC,cAAc,CAAC,CAAC,CAAC,CAAC,IAAI,EAAE,aAAa,CAAC,CAAC;IAC3D,CAAC,CAAC,CAAC;IACH,IAAI,CAAC,0CAA0C,EAAE,GAAG,EAAE;QACrD,MAAM,CAAC,IAAI,CAAC,YAAY,CAAC,yCAAyC,CAAC,CAAC,CAAC;QAErE,MAAM,CAAC,WAAW,CAAC,cAAc,CAAC,MAAM,EAAE,CAAC,CAAC,CAAC;QAC7C,MAAM,CAAC,WAAW,CAAC,cAAc,CAAC,CAAC,CAAC,CAAC,IAAI,EAAE,yBAAyB,CAAC,CAAC;IACvE,CAAC,CAAC,CAAC;IACH,IAAI,CAAC,yCAAyC,EAAE,GAAG,EAAE;QACpD,MAAM,CAAC,IAAI,CAAC,YAAY,CAAC,sCAAsC,CAAC,CAAC,CAAC;QAElE,MAAM,CAAC,WAAW,CAAC,cAAc,CAAC,MAAM,EAAE,CAAC,CAAC,CAAC;QAC7C,MAAM,CAAC,WAAW,CAAC,cAAc,CAAC,CAAC,CAAC,CAAC,IAAI,EAAE,QAAQ,CAAC,CAAC;QACrD,MAAM,CAAC,WAAW,CAAC,cAAc,CAAC,CAAC,CAAC,CAAC,IAAI,EAAE,aAAa,CAAC,CAAC;IAC3D,CAAC,CAAC,CAAC;IACH,IAAI,CAAC,gDAAgD,EAAE,GAAG,EAAE;QAC3D,MAAM,CAAC,IAAI,CAAC,YAAY,CAAC,4CAA4C,CAAC,CAAC,CAAC;QAExE,MAAM,CAAC,WAAW,CAAC,cAAc,CAAC,MAAM,EAAE,CAAC,CAAC,CAAC;QAC7C,MAAM,CAAC,WAAW,CAAC,cAAc,CAAC,CAAC,CAAC,CAAC,IAAI,EAAE,QAAQ,CAAC,CAAC;QACrD,MAAM,CAAC,WAAW,CAAC,cAAc,CAAC,CAAC,CAAC,CAAC,IAAI,EAAE,aAAa,CAAC,CAAC;IAC3D,CAAC,CAAC,CAAC;IACH,IAAI,CAAC,0BAA0B,EAAE,GAAG,EAAE;QACrC,KAAK,MAAM,EAAE,IAAI,CAAC,IAAI,EAAE,MAAM,EAAE,IAAI,CAAC,EAAE,CAAC;YACvC,MAAM,OAAO,GAAG,YAAY,CAAC,gBAAgB,EAAE,oBAAoB,EAAE,GAAG,EAAE,iBAAiB,EAAE,qBAAqB,EAAE,GAAG,EAAE,EAAE,CAAC,CAAC;YAC7H,KAAK,IAAI,SAAS,GAAG,CAAC,EAAE,SAAS,GAAG,CAAC,EAAE,SAAS,EAAE,EAAE,CAAC;gBACpD,cAAc,CAAC,MAAM,GAAG,CAAC,CAAC;gBAE1B,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,OAAO,CAAC,MAAM,EAAE,CAAC,IAAI,SAAS,EAAE,CAAC;oBACpD,MAAM,KAAK,GAAG,OAAO,CAAC,KAAK,CAAC,CAAC,EAAE,CAAC,GAAG,SAAS,CAAC,CAAC;oBAC9C,MAAM,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;gBACpB,CAAC;gBAED,MAAM,CAAC,eAAe,CAAC,cAAc,EAAE;oBACtC,EAAE,IAAI,EAAE,QAAQ,EAAE,IAAI,EAAE,aAAa,EAAE;oBACvC,EAAE,IAAI,EAAE,SAAS,EAAE,IAAI,EAAE,cAAc,EAAE;iBACzC,EAAE,yBAAyB,SAAS,oBAAoB,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC;YAChF,CAAC;QACF,CAAC;IACF,CAAC,CAAC,CAAC;IACH,IAAI,CAAC,wBAAwB,EAAE,GAAG,EAAE;QACnC,MAAM,CAAC,IAAI,CAAC,YAAY,CAAC,yCAAyC,CAAC,CAAC,CAAC;QAErE,MAAM,CAAC,WAAW,CAAC,cAAc,CAAC,MAAM,EAAE,CAAC,CAAC,CAAC;QAC7C,MAAM,CAAC,WAAW,CAAC,cAAc,CAAC,CAAC,CAAC,CAAC,IAAI,EAAE,QAAQ,CAAC,CAAC;QACrD,MAAM,CAAC,WAAW,CAAC,cAAc,CAAC,CAAC,CAAC,CAAC,IAAI,EAAE,OAAO,CAAC,CAAC;QACpD,MAAM,CAAC,WAAW,CAAC,cAAc,CAAC,CAAC,CAAC,CAAC,EAAE,EAAE,KAAK,CAAC,CAAC;QAChD,MAAM,CAAC,WAAW,CAAC,MAAM,CAAC,cAAc,EAAE,EAAE,KAAK,CAAC,CAAC;IACpD,CAAC,CAAC,CAAC;IAEH,IAAI,CAAC,kBAAkB,EAAE,GAAG,EAAE;QAC7B,MAAM,CAAC,IAAI,CAAC,YAAY,CAAC,oDAAoD,CAAC,CAAC,CAAC;QAEhF,MAAM,CAAC,WAAW,CAAC,cAAc,CAAC,MAAM,EAAE,CAAC,CAAC,CAAC;QAC7C,MAAM,CAAC,WAAW,CAAC,cAAc,CAAC,CAAC,CAAC,CAAC,IAAI,EAAE,OAAO,CAAC,CAAC;IACrD,CAAC,CAAC,CAAC;IAEH,IAAI,CAAC,qBAAqB,EAAE,GAAG,EAAE;QAChC,MAAM,CAAC,IAAI,CAAC,YAAY,CAAC,8BAA8B,CAAC,CAAC,CAAC;QAE1D,MAAM,CAAC,WAAW,CAAC,cAAc,CAAC,MAAM,EAAE,CAAC,CAAC,CAAC;QAC7C,MAAM,CAAC,WAAW,CAAC,cAAc,CAAC,CAAC,CAAC,CAAC,IAAI,EAAE,OAAO,CAAC,CAAC;QACpD,MAAM,CAAC,WAAW,CAAC,cAAc,CAAC,CAAC,CAAC,CAAC,KAAK,EAAE,IAAI,CAAC,CAAC;QAClD,MAAM,CAAC,WAAW,CAAC,MAAM,CAAC,mBAAmB,EAAE,EAAE,IAAI,CAAC,CAAC;IACxD,CAAC,CAAC,CAAC;IACH,IAAI,CAAC,6BAA6B,EAAE,GAAG,EAAE;QACxC,MAAM,CAAC,IAAI,CAAC,YAAY,CAAC,iCAAiC,CAAC,CAAC,CAAC;QAE7D,MAAM,CAAC,WAAW,CAAC,cAAc,CAAC,MAAM,EAAE,CAAC,CAAC,CAAC;QAC7C,MAAM,CAAC,WAAW,CAAC,cAAc,CAAC,CAAC,CAAC,CAAC,IAAI,EAAE,OAAO,CAAC,CAAC;QACpD,MAAM,CAAC,WAAW,CAAC,cAAc,CAAC,CAAC,CAAC,CAAC,KAAK,EAAE,SAAS,CAAC,CAAC;QACvD,MAAM,CAAC,WAAW,CAAC,MAAM,CAAC,mBAAmB,EAAE,EAAE,SAAS,CAAC,CAAC;IAC7D,CAAC,CAAC,CAAC;IAEH,IAAI,CAAC,0CAA0C,EAAE,GAAG,EAAE;QACrD,MAAM,CAAC,IAAI,CAAC,YAAY,CAAC,6BAA6B,CAAC,CAAC,CAAC;QAEzD,MAAM,CAAC,WAAW,CAAC,cAAc,CAAC,MAAM,EAAE,CAAC,CAAC,CAAC;QAC7C,MAAM,CAAC,WAAW,CAAC,cAAc,CAAC,CAAC,CAAC,CAAC,EAAE,EAAE,SAAS,CAAC,CAAC;QACpD,MAAM,CAAC,WAAW,CAAC,MAAM,CAAC,cAAc,EAAE,EAAE,SAAS,CAAC,CAAC;IACxD,CAAC,CAAC,CAAC;IAEH,IAAI,CAAC,8BAA8B,EAAE,GAAG,EAAE;QACzC,MAAM,CAAC,IAAI,CAAC,YAAY,CAAC,cAAc,CAAC,CAAC,CAAC;QAE1C,MAAM,CAAC,WAAW,CAAC,cAAc,CAAC,MAAM,EAAE,CAAC,CAAC,CAAC;QAC7C,MAAM,CAAC,WAAW,CAAC,cAAc,CAAC,CAAC,CAAC,CAAC,IAAI,EAAE,EAAE,CAAC,CAAC;QAC/C,MAAM,CAAC,WAAW,CAAC,cAAc,CAAC,CAAC,CAAC,CAAC,EAAE,EAAE,EAAE,CAAC,CAAC;IAC9C,CAAC,CAAC,CAAC;IACH,IAAI,CAAC,uCAAuC,EAAE,GAAG,EAAE;QAClD,MAAM,CAAC,IAAI,CAAC,YAAY,CAAC,yCAAyC,CAAC,CAAC,CAAC;QAErE,MAAM,CAAC,WAAW,CAAC,cAAc,CAAC,MAAM,EAAE,CAAC,CAAC,CAAC;QAC7C,MAAM,CAAC,WAAW,CAAC,cAAc,CAAC,CAAC,CAAC,CAAC,IAAI,EAAE,OAAO,CAAC,CAAC;QACpD,MAAM,CAAC,WAAW,CAAC,cAAc,CAAC,CAAC,CAAC,CAAC,IAAI,EAAE,QAAQ,CAAC,CAAC;QACrD,MAAM,CAAC,WAAW,CAAC,cAAc,CAAC,CAAC,CAAC,CAAC,EAAE,EAAE,KAAK,CAAC,CAAC;IACjD,CAAC,CAAC,CAAC;IAEH,IAAI,CAAC,qCAAqC,EAAE,GAAG,EAAE;QAChD,MAAM,CAAC,IAAI,CAAC,YAAY,CAAC,iBAAiB,CAAC,CAAC,CAAC;QAE7C,MAAM,CAAC,WAAW,CAAC,cAAc,CAAC,MAAM,EAAE,CAAC,CAAC,CAAC;QAC7C,MAAM,CAAC,WAAW,CAAC,cAAc,CAAC,CAAC,CAAC,CAAC,IAAI,EAAE,OAAO,CAAC,CAAC;IACrD,CAAC,CAAC,CAAC;IAEH,IAAI,CAAC,qCAAqC,EAAE,GAAG,EAAE;QAChD,MAAM,CAAC,IAAI,CAAC,YAAY,CAAC,iBAAiB,CAAC,CAAC,CAAC;QAE7C,MAAM,CAAC,WAAW,CAAC,cAAc,CAAC,MAAM,EAAE,CAAC,CAAC,CAAC;QAC7C,MAAM,CAAC,WAAW,CAAC,cAAc,CAAC,CAAC,CAAC,CAAC,IAAI,EAAE,OAAO,CAAC,CAAC;IACrD,CAAC,CAAC,CAAC;IAEH,IAAI,CAAC,uCAAuC,EAAE,GAAG,EAAE;QAClD,MAAM,CAAC,IAAI,CAAC,YAAY,CAAC,qBAAqB,CAAC,CAAC,CAAC;QAEjD,MAAM,CAAC,WAAW,CAAC,cAAc,CAAC,MAAM,EAAE,CAAC,CAAC,CAAC;QAC7C,MAAM,CAAC,WAAW,CAAC,cAAc,CAAC,CAAC,CAAC,CAAC,IAAI,EAAE,OAAO,CAAC,CAAC;IACrD,CAAC,CAAC,CAAC;IACH,IAAI,CAAC,oCAAoC,EAAE,GAAG,EAAE;QAC/C,MAAM,CAAC,IAAI,CAAC,YAAY,CAAC,WAAW,CAAC,CAAC,CAAC;QAEvC,MAAM,CAAC,WAAW,CAAC,cAAc,CAAC,MAAM,EAAE,CAAC,CAAC,CAAC;QAC7C,MAAM,CAAC,WAAW,CAAC,cAAc,CAAC,CAAC,CAAC,CAAC,IAAI,EAAE,EAAE,CAAC,CAAC;IAChD,CAAC,CAAC,CAAC;IAEH,IAAI,CAAC,8CAA8C,EAAE,GAAG,EAAE;QACzD,MAAM,CAAC,IAAI,CAAC,YAAY,CAAC,mBAAmB,CAAC,CAAC,CAAC;QAE/C,MAAM,CAAC,WAAW,CAAC,cAAc,CAAC,MAAM,EAAE,CAAC,CAAC,CAAC;IAC9C,CAAC,CAAC,CAAC;IAEH,IAAI,CAAC,uBAAuB,EAAE,GAAG,EAAE;QAClC,MAAM,CAAC,IAAI,CAAC,YAAY,CAAC,YAAY,CAAC,CAAC,CAAC;QACxC,MAAM,CAAC,IAAI,CAAC,YAAY,CAAC,SAAS,CAAC,CAAC,CAAC;QACrC,MAAM,CAAC,IAAI,CAAC,YAAY,CAAC,aAAa,CAAC,CAAC,CAAC;QACzC,MAAM,CAAC,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,CAAC,CAAC;QAEhC,MAAM,CAAC,WAAW,CAAC,cAAc,CAAC,MAAM,EAAE,CAAC,CAAC,CAAC;QAC7C,MAAM,CAAC,WAAW,CAAC,cAAc,CAAC,CAAC,CAAC,CAAC,IAAI,EAAE,QAAQ,CAAC,CAAC;QACrD,MAAM,CAAC,WAAW,CAAC,cAAc,CAAC,CAAC,CAAC,CAAC,IAAI,EAAE,OAAO,CAAC,CAAC;IACrD,CAAC,CAAC,CAAC;IAEH,IAAI,CAAC,uBAAuB,EAAE,GAAG,EAAE;QAClC,wBAAwB;QACxB,MAAM,CAAC,IAAI,CAAC,YAAY,CAAC,kDAAkD,CAAC,CAAC,CAAC;QAC9E,MAAM,CAAC,IAAI,CAAC,YAAY,CAAC,2BAA2B,CAAC,CAAC,CAAC;QACvD,MAAM,CAAC,IAAI,CAAC,YAAY,CAAC,wBAAwB,CAAC,CAAC,CAAC;QAEpD,MAAM,CAAC,WAAW,CAAC,cAAc,CAAC,MAAM,EAAE,CAAC,CAAC,CAAC;QAC7C,MAAM,CAAC,WAAW,CAAC,cAAc,CAAC,CAAC,CAAC,CAAC,IAAI,EAAE,aAAa,CAAC,CAAC;QAC1D,MAAM,CAAC,WAAW,CAAC,cAAc,CAAC,CAAC,CAAC,CAAC,EAAE,EAAE,GAAG,CAAC,CAAC;QAC9C,MAAM,CAAC,WAAW,CAAC,cAAc,CAAC,CAAC,CAAC,CAAC,IAAI,EAAE,cAAc,CAAC,CAAC;QAC3D,MAAM,CAAC,WAAW,CAAC,cAAc,CAAC,CAAC,CAAC,CAAC,EAAE,EAAE,EAAE,CAAC,CAAC;QAC7C,MAAM,CAAC,WAAW,CAAC,cAAc,CAAC,CAAC,CAAC,CAAC,IAAI,EAAE,cAAc,CAAC,CAAC;IAC5D,CAAC,CAAC,CAAC;IAEH,IAAI,CAAC,kBAAkB,EAAE,GAAG,EAAE;QAC7B,MAAM,CAAC,IAAI,CAAC,YAAY,CAAC,eAAe,CAAC,CAAC,CAAC;QAC3C,MAAM,CAAC,KAAK,EAAE,CAAC;QACf,MAAM,CAAC,IAAI,CAAC,YAAY,CAAC,iBAAiB,CAAC,CAAC,CAAC;QAE7C,MAAM,CAAC,WAAW,CAAC,cAAc,CAAC,MAAM,EAAE,CAAC,CAAC,CAAC;QAC7C,MAAM,CAAC,WAAW,CAAC,cAAc,CAAC,CAAC,CAAC,CAAC,IAAI,EAAE,OAAO,CAAC,CAAC;IACrD,CAAC,CAAC,CAAC;AACJ,CAAC,CAAC,CAAC","file":"sseParser.test.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as assert from 'assert';\nimport { ISSEEvent, SSEParser } from '../../common/sseParser.js';\nimport { ensureNoDisposablesAreLeakedInTestSuite } from './utils.js';\n\n// Helper function to convert string to Uint8Array for testing\nfunction toUint8Array(str: string): Uint8Array {\n\treturn new TextEncoder().encode(str);\n}\n\nsuite('SSEParser', () => {\n\tlet receivedEvents: ISSEEvent[];\n\tlet parser: SSEParser;\n\n\tensureNoDisposablesAreLeakedInTestSuite();\n\n\tsetup(() => {\n\t\treceivedEvents = [];\n\t\tparser = new SSEParser((event) => receivedEvents.push(event));\n\t});\n\ttest('handles basic events', () => {\n\t\tparser.feed(toUint8Array('data: hello world\\n\\n'));\n\n\t\tassert.strictEqual(receivedEvents.length, 1);\n\t\tassert.strictEqual(receivedEvents[0].type, 'message');\n\t\tassert.strictEqual(receivedEvents[0].data, 'hello world');\n\t});\n\ttest('handles events with multiple data fields', () => {\n\t\tparser.feed(toUint8Array('data: first line\\ndata: second line\\n\\n'));\n\n\t\tassert.strictEqual(receivedEvents.length, 1);\n\t\tassert.strictEqual(receivedEvents[0].data, 'first line\\nsecond line');\n\t});\n\ttest('handles events with explicit event type', () => {\n\t\tparser.feed(toUint8Array('event: custom\\ndata: hello world\\n\\n'));\n\n\t\tassert.strictEqual(receivedEvents.length, 1);\n\t\tassert.strictEqual(receivedEvents[0].type, 'custom');\n\t\tassert.strictEqual(receivedEvents[0].data, 'hello world');\n\t});\n\ttest('handles events with explicit event type (CRLF)', () => {\n\t\tparser.feed(toUint8Array('event: custom\\r\\ndata: hello world\\r\\n\\r\\n'));\n\n\t\tassert.strictEqual(receivedEvents.length, 1);\n\t\tassert.strictEqual(receivedEvents[0].type, 'custom');\n\t\tassert.strictEqual(receivedEvents[0].data, 'hello world');\n\t});\n\ttest('stream processing chunks', () => {\n\t\tfor (const lf of ['\\n', '\\r\\n', '\\r']) {\n\t\t\tconst message = toUint8Array(`event: custom${lf}data: hello world${lf}${lf}event: custom2${lf}data: hello world2${lf}${lf}`);\n\t\t\tfor (let chunkSize = 1; chunkSize < 5; chunkSize++) {\n\t\t\t\treceivedEvents.length = 0;\n\n\t\t\t\tfor (let i = 0; i < message.length; i += chunkSize) {\n\t\t\t\t\tconst chunk = message.slice(i, i + chunkSize);\n\t\t\t\t\tparser.feed(chunk);\n\t\t\t\t}\n\n\t\t\t\tassert.deepStrictEqual(receivedEvents, [\n\t\t\t\t\t{ type: 'custom', data: 'hello world' },\n\t\t\t\t\t{ type: 'custom2', data: 'hello world2' }\n\t\t\t\t], `Failed for chunk size ${chunkSize} and line ending ${JSON.stringify(lf)}`);\n\t\t\t}\n\t\t}\n\t});\n\ttest('handles events with ID', () => {\n\t\tparser.feed(toUint8Array('event: custom\\ndata: hello\\nid: 123\\n\\n'));\n\n\t\tassert.strictEqual(receivedEvents.length, 1);\n\t\tassert.strictEqual(receivedEvents[0].type, 'custom');\n\t\tassert.strictEqual(receivedEvents[0].data, 'hello');\n\t\tassert.strictEqual(receivedEvents[0].id, '123');\n\t\tassert.strictEqual(parser.getLastEventId(), '123');\n\t});\n\n\ttest('ignores comments', () => {\n\t\tparser.feed(toUint8Array('event: custom\\n:this is a comment\\ndata: hello\\n\\n'));\n\n\t\tassert.strictEqual(receivedEvents.length, 1);\n\t\tassert.strictEqual(receivedEvents[0].data, 'hello');\n\t});\n\n\ttest('handles retry field', () => {\n\t\tparser.feed(toUint8Array('retry: 5000\\ndata: hello\\n\\n'));\n\n\t\tassert.strictEqual(receivedEvents.length, 1);\n\t\tassert.strictEqual(receivedEvents[0].data, 'hello');\n\t\tassert.strictEqual(receivedEvents[0].retry, 5000);\n\t\tassert.strictEqual(parser.getReconnectionTime(), 5000);\n\t});\n\ttest('handles invalid retry field', () => {\n\t\tparser.feed(toUint8Array('retry: invalid\\ndata: hello\\n\\n'));\n\n\t\tassert.strictEqual(receivedEvents.length, 1);\n\t\tassert.strictEqual(receivedEvents[0].data, 'hello');\n\t\tassert.strictEqual(receivedEvents[0].retry, undefined);\n\t\tassert.strictEqual(parser.getReconnectionTime(), undefined);\n\t});\n\n\ttest('ignores fields with NULL character in ID', () => {\n\t\tparser.feed(toUint8Array('id: 12\\0 3\\ndata: hello\\n\\n'));\n\n\t\tassert.strictEqual(receivedEvents.length, 1);\n\t\tassert.strictEqual(receivedEvents[0].id, undefined);\n\t\tassert.strictEqual(parser.getLastEventId(), undefined);\n\t});\n\n\ttest('handles fields with no value', () => {\n\t\tparser.feed(toUint8Array('data\\nid\\n\\n'));\n\n\t\tassert.strictEqual(receivedEvents.length, 1);\n\t\tassert.strictEqual(receivedEvents[0].data, '');\n\t\tassert.strictEqual(receivedEvents[0].id, '');\n\t});\n\ttest('handles fields with space after colon', () => {\n\t\tparser.feed(toUint8Array('data: hello\\nevent: custom\\nid: 123\\n\\n'));\n\n\t\tassert.strictEqual(receivedEvents.length, 1);\n\t\tassert.strictEqual(receivedEvents[0].data, 'hello');\n\t\tassert.strictEqual(receivedEvents[0].type, 'custom');\n\t\tassert.strictEqual(receivedEvents[0].id, '123');\n\t});\n\n\ttest('handles different line endings (LF)', () => {\n\t\tparser.feed(toUint8Array('data: hello\\n\\n'));\n\n\t\tassert.strictEqual(receivedEvents.length, 1);\n\t\tassert.strictEqual(receivedEvents[0].data, 'hello');\n\t});\n\n\ttest('handles different line endings (CR)', () => {\n\t\tparser.feed(toUint8Array('data: hello\\r\\r'));\n\n\t\tassert.strictEqual(receivedEvents.length, 1);\n\t\tassert.strictEqual(receivedEvents[0].data, 'hello');\n\t});\n\n\ttest('handles different line endings (CRLF)', () => {\n\t\tparser.feed(toUint8Array('data: hello\\r\\n\\r\\n'));\n\n\t\tassert.strictEqual(receivedEvents.length, 1);\n\t\tassert.strictEqual(receivedEvents[0].data, 'hello');\n\t});\n\ttest('handles empty data with blank line', () => {\n\t\tparser.feed(toUint8Array('data:\\n\\n'));\n\n\t\tassert.strictEqual(receivedEvents.length, 1);\n\t\tassert.strictEqual(receivedEvents[0].data, '');\n\t});\n\n\ttest('ignores events with no data after blank line', () => {\n\t\tparser.feed(toUint8Array('event: custom\\n\\n'));\n\n\t\tassert.strictEqual(receivedEvents.length, 0);\n\t});\n\n\ttest('supports chunked data', () => {\n\t\tparser.feed(toUint8Array('event: cus'));\n\t\tparser.feed(toUint8Array('tom\\nda'));\n\t\tparser.feed(toUint8Array('ta: hello\\n'));\n\t\tparser.feed(toUint8Array('\\n'));\n\n\t\tassert.strictEqual(receivedEvents.length, 1);\n\t\tassert.strictEqual(receivedEvents[0].type, 'custom');\n\t\tassert.strictEqual(receivedEvents[0].data, 'hello');\n\t});\n\n\ttest('supports spec example', () => {\n\t\t// Example from the spec\n\t\tparser.feed(toUint8Array(':This is a comment\\ndata: first event\\nid: 1\\n\\n'));\n\t\tparser.feed(toUint8Array('data:second event\\nid\\n\\n'));\n\t\tparser.feed(toUint8Array('data:  third event\\n\\n'));\n\n\t\tassert.strictEqual(receivedEvents.length, 3);\n\t\tassert.strictEqual(receivedEvents[0].data, 'first event');\n\t\tassert.strictEqual(receivedEvents[0].id, '1');\n\t\tassert.strictEqual(receivedEvents[1].data, 'second event');\n\t\tassert.strictEqual(receivedEvents[1].id, '');\n\t\tassert.strictEqual(receivedEvents[2].data, ' third event');\n\t});\n\n\ttest('resets correctly', () => {\n\t\tparser.feed(toUint8Array('data: hello\\n'));\n\t\tparser.reset();\n\t\tparser.feed(toUint8Array('data: world\\n\\n'));\n\n\t\tassert.strictEqual(receivedEvents.length, 1);\n\t\tassert.strictEqual(receivedEvents[0].data, 'world');\n\t});\n});\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as assert from 'assert';\nimport { ISSEEvent, SSEParser } from '../../common/sseParser.js';\nimport { ensureNoDisposablesAreLeakedInTestSuite } from './utils.js';\n\n// Helper function to convert string to Uint8Array for testing\nfunction toUint8Array(str: string): Uint8Array {\n\treturn new TextEncoder().encode(str);\n}\n\nsuite('SSEParser', () => {\n\tlet receivedEvents: ISSEEvent[];\n\tlet parser: SSEParser;\n\n\tensureNoDisposablesAreLeakedInTestSuite();\n\n\tsetup(() => {\n\t\treceivedEvents = [];\n\t\tparser = new SSEParser((event) => receivedEvents.push(event));\n\t});\n\ttest('handles basic events', () => {\n\t\tparser.feed(toUint8Array('data: hello world\\n\\n'));\n\n\t\tassert.strictEqual(receivedEvents.length, 1);\n\t\tassert.strictEqual(receivedEvents[0].type, 'message');\n\t\tassert.strictEqual(receivedEvents[0].data, 'hello world');\n\t});\n\ttest('handles events with multiple data fields', () => {\n\t\tparser.feed(toUint8Array('data: first line\\ndata: second line\\n\\n'));\n\n\t\tassert.strictEqual(receivedEvents.length, 1);\n\t\tassert.strictEqual(receivedEvents[0].data, 'first line\\nsecond line');\n\t});\n\ttest('handles events with explicit event type', () => {\n\t\tparser.feed(toUint8Array('event: custom\\ndata: hello world\\n\\n'));\n\n\t\tassert.strictEqual(receivedEvents.length, 1);\n\t\tassert.strictEqual(receivedEvents[0].type, 'custom');\n\t\tassert.strictEqual(receivedEvents[0].data, 'hello world');\n\t});\n\ttest('handles events with explicit event type (CRLF)', () => {\n\t\tparser.feed(toUint8Array('event: custom\\r\\ndata: hello world\\r\\n\\r\\n'));\n\n\t\tassert.strictEqual(receivedEvents.length, 1);\n\t\tassert.strictEqual(receivedEvents[0].type, 'custom');\n\t\tassert.strictEqual(receivedEvents[0].data, 'hello world');\n\t});\n\ttest('stream processing chunks', () => {\n\t\tfor (const lf of ['\\n', '\\r\\n', '\\r']) {\n\t\t\tconst message = toUint8Array(`event: custom${lf}data: hello world${lf}${lf}event: custom2${lf}data: hello world2${lf}${lf}`);\n\t\t\tfor (let chunkSize = 1; chunkSize < 5; chunkSize++) {\n\t\t\t\treceivedEvents.length = 0;\n\n\t\t\t\tfor (let i = 0; i < message.length; i += chunkSize) {\n\t\t\t\t\tconst chunk = message.slice(i, i + chunkSize);\n\t\t\t\t\tparser.feed(chunk);\n\t\t\t\t}\n\n\t\t\t\tassert.deepStrictEqual(receivedEvents, [\n\t\t\t\t\t{ type: 'custom', data: 'hello world' },\n\t\t\t\t\t{ type: 'custom2', data: 'hello world2' }\n\t\t\t\t], `Failed for chunk size ${chunkSize} and line ending ${JSON.stringify(lf)}`);\n\t\t\t}\n\t\t}\n\t});\n\ttest('handles events with ID', () => {\n\t\tparser.feed(toUint8Array('event: custom\\ndata: hello\\nid: 123\\n\\n'));\n\n\t\tassert.strictEqual(receivedEvents.length, 1);\n\t\tassert.strictEqual(receivedEvents[0].type, 'custom');\n\t\tassert.strictEqual(receivedEvents[0].data, 'hello');\n\t\tassert.strictEqual(receivedEvents[0].id, '123');\n\t\tassert.strictEqual(parser.getLastEventId(), '123');\n\t});\n\n\ttest('ignores comments', () => {\n\t\tparser.feed(toUint8Array('event: custom\\n:this is a comment\\ndata: hello\\n\\n'));\n\n\t\tassert.strictEqual(receivedEvents.length, 1);\n\t\tassert.strictEqual(receivedEvents[0].data, 'hello');\n\t});\n\n\ttest('handles retry field', () => {\n\t\tparser.feed(toUint8Array('retry: 5000\\ndata: hello\\n\\n'));\n\n\t\tassert.strictEqual(receivedEvents.length, 1);\n\t\tassert.strictEqual(receivedEvents[0].data, 'hello');\n\t\tassert.strictEqual(receivedEvents[0].retry, 5000);\n\t\tassert.strictEqual(parser.getReconnectionTime(), 5000);\n\t});\n\ttest('handles invalid retry field', () => {\n\t\tparser.feed(toUint8Array('retry: invalid\\ndata: hello\\n\\n'));\n\n\t\tassert.strictEqual(receivedEvents.length, 1);\n\t\tassert.strictEqual(receivedEvents[0].data, 'hello');\n\t\tassert.strictEqual(receivedEvents[0].retry, undefined);\n\t\tassert.strictEqual(parser.getReconnectionTime(), undefined);\n\t});\n\n\ttest('ignores fields with NULL character in ID', () => {\n\t\tparser.feed(toUint8Array('id: 12\\0 3\\ndata: hello\\n\\n'));\n\n\t\tassert.strictEqual(receivedEvents.length, 1);\n\t\tassert.strictEqual(receivedEvents[0].id, undefined);\n\t\tassert.strictEqual(parser.getLastEventId(), undefined);\n\t});\n\n\ttest('handles fields with no value', () => {\n\t\tparser.feed(toUint8Array('data\\nid\\n\\n'));\n\n\t\tassert.strictEqual(receivedEvents.length, 1);\n\t\tassert.strictEqual(receivedEvents[0].data, '');\n\t\tassert.strictEqual(receivedEvents[0].id, '');\n\t});\n\ttest('handles fields with space after colon', () => {\n\t\tparser.feed(toUint8Array('data: hello\\nevent: custom\\nid: 123\\n\\n'));\n\n\t\tassert.strictEqual(receivedEvents.length, 1);\n\t\tassert.strictEqual(receivedEvents[0].data, 'hello');\n\t\tassert.strictEqual(receivedEvents[0].type, 'custom');\n\t\tassert.strictEqual(receivedEvents[0].id, '123');\n\t});\n\n\ttest('handles different line endings (LF)', () => {\n\t\tparser.feed(toUint8Array('data: hello\\n\\n'));\n\n\t\tassert.strictEqual(receivedEvents.length, 1);\n\t\tassert.strictEqual(receivedEvents[0].data, 'hello');\n\t});\n\n\ttest('handles different line endings (CR)', () => {\n\t\tparser.feed(toUint8Array('data: hello\\r\\r'));\n\n\t\tassert.strictEqual(receivedEvents.length, 1);\n\t\tassert.strictEqual(receivedEvents[0].data, 'hello');\n\t});\n\n\ttest('handles different line endings (CRLF)', () => {\n\t\tparser.feed(toUint8Array('data: hello\\r\\n\\r\\n'));\n\n\t\tassert.strictEqual(receivedEvents.length, 1);\n\t\tassert.strictEqual(receivedEvents[0].data, 'hello');\n\t});\n\ttest('handles empty data with blank line', () => {\n\t\tparser.feed(toUint8Array('data:\\n\\n'));\n\n\t\tassert.strictEqual(receivedEvents.length, 1);\n\t\tassert.strictEqual(receivedEvents[0].data, '');\n\t});\n\n\ttest('ignores events with no data after blank line', () => {\n\t\tparser.feed(toUint8Array('event: custom\\n\\n'));\n\n\t\tassert.strictEqual(receivedEvents.length, 0);\n\t});\n\n\ttest('supports chunked data', () => {\n\t\tparser.feed(toUint8Array('event: cus'));\n\t\tparser.feed(toUint8Array('tom\\nda'));\n\t\tparser.feed(toUint8Array('ta: hello\\n'));\n\t\tparser.feed(toUint8Array('\\n'));\n\n\t\tassert.strictEqual(receivedEvents.length, 1);\n\t\tassert.strictEqual(receivedEvents[0].type, 'custom');\n\t\tassert.strictEqual(receivedEvents[0].data, 'hello');\n\t});\n\n\ttest('supports spec example', () => {\n\t\t// Example from the spec\n\t\tparser.feed(toUint8Array(':This is a comment\\ndata: first event\\nid: 1\\n\\n'));\n\t\tparser.feed(toUint8Array('data:second event\\nid\\n\\n'));\n\t\tparser.feed(toUint8Array('data:  third event\\n\\n'));\n\n\t\tassert.strictEqual(receivedEvents.length, 3);\n\t\tassert.strictEqual(receivedEvents[0].data, 'first event');\n\t\tassert.strictEqual(receivedEvents[0].id, '1');\n\t\tassert.strictEqual(receivedEvents[1].data, 'second event');\n\t\tassert.strictEqual(receivedEvents[1].id, '');\n\t\tassert.strictEqual(receivedEvents[2].data, ' third event');\n\t});\n\n\ttest('resets correctly', () => {\n\t\tparser.feed(toUint8Array('data: hello\\n'));\n\t\tparser.reset();\n\t\tparser.feed(toUint8Array('data: world\\n\\n'));\n\n\t\tassert.strictEqual(receivedEvents.length, 1);\n\t\tassert.strictEqual(receivedEvents[0].data, 'world');\n\t});\n});\n"]}