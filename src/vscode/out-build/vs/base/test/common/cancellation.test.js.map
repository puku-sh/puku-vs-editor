{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/base/test/common/cancellation.test.ts","vs/base/test/common/cancellation.test.ts"],"names":[],"mappings":"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","file":"cancellation.test.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nimport assert from 'assert';\nimport { CancellationToken, CancellationTokenSource, CancellationTokenPool } from '../../common/cancellation.js';\nimport { ensureNoDisposablesAreLeakedInTestSuite } from './utils.js';\n\nsuite('CancellationToken', function () {\n\n\tconst store = ensureNoDisposablesAreLeakedInTestSuite();\n\n\ttest('None', () => {\n\t\tassert.strictEqual(CancellationToken.None.isCancellationRequested, false);\n\t\tassert.strictEqual(typeof CancellationToken.None.onCancellationRequested, 'function');\n\t});\n\n\ttest('cancel before token', function () {\n\n\t\tconst source = new CancellationTokenSource();\n\t\tassert.strictEqual(source.token.isCancellationRequested, false);\n\t\tsource.cancel();\n\n\t\tassert.strictEqual(source.token.isCancellationRequested, true);\n\n\t\treturn new Promise<void>(resolve => {\n\t\t\tsource.token.onCancellationRequested(() => resolve());\n\t\t});\n\t});\n\n\ttest('cancel happens only once', function () {\n\n\t\tconst source = new CancellationTokenSource();\n\t\tassert.strictEqual(source.token.isCancellationRequested, false);\n\n\t\tlet cancelCount = 0;\n\t\tfunction onCancel() {\n\t\t\tcancelCount += 1;\n\t\t}\n\n\t\tstore.add(source.token.onCancellationRequested(onCancel));\n\n\t\tsource.cancel();\n\t\tsource.cancel();\n\n\t\tassert.strictEqual(cancelCount, 1);\n\t});\n\n\ttest('cancel calls all listeners', function () {\n\n\t\tlet count = 0;\n\n\t\tconst source = new CancellationTokenSource();\n\t\tstore.add(source.token.onCancellationRequested(() => count++));\n\t\tstore.add(source.token.onCancellationRequested(() => count++));\n\t\tstore.add(source.token.onCancellationRequested(() => count++));\n\n\t\tsource.cancel();\n\t\tassert.strictEqual(count, 3);\n\t});\n\n\ttest('token stays the same', function () {\n\n\t\tlet source = new CancellationTokenSource();\n\t\tlet token = source.token;\n\t\tassert.ok(token === source.token); // doesn't change on get\n\n\t\tsource.cancel();\n\t\tassert.ok(token === source.token); // doesn't change after cancel\n\n\t\tsource.cancel();\n\t\tassert.ok(token === source.token); // doesn't change after 2nd cancel\n\n\t\tsource = new CancellationTokenSource();\n\t\tsource.cancel();\n\t\ttoken = source.token;\n\t\tassert.ok(token === source.token); // doesn't change on get\n\t});\n\n\ttest('dispose calls no listeners', function () {\n\n\t\tlet count = 0;\n\n\t\tconst source = new CancellationTokenSource();\n\t\tstore.add(source.token.onCancellationRequested(() => count++));\n\n\t\tsource.dispose();\n\t\tsource.cancel();\n\t\tassert.strictEqual(count, 0);\n\t});\n\n\ttest('dispose calls no listeners (unless told to cancel)', function () {\n\n\t\tlet count = 0;\n\n\t\tconst source = new CancellationTokenSource();\n\t\tstore.add(source.token.onCancellationRequested(() => count++));\n\n\t\tsource.dispose(true);\n\t\t// source.cancel();\n\t\tassert.strictEqual(count, 1);\n\t});\n\n\ttest('dispose does not cancel', function () {\n\t\tconst source = new CancellationTokenSource();\n\t\tsource.dispose();\n\t\tassert.strictEqual(source.token.isCancellationRequested, false);\n\t});\n\n\ttest('parent cancels child', function () {\n\n\t\tconst parent = new CancellationTokenSource();\n\t\tconst child = new CancellationTokenSource(parent.token);\n\n\t\tlet count = 0;\n\t\tstore.add(child.token.onCancellationRequested(() => count++));\n\n\t\tparent.cancel();\n\n\t\tassert.strictEqual(count, 1);\n\t\tassert.strictEqual(child.token.isCancellationRequested, true);\n\t\tassert.strictEqual(parent.token.isCancellationRequested, true);\n\n\t\tchild.dispose();\n\t\tparent.dispose();\n\t});\n});\n\nsuite('CancellationTokenPool', function () {\n\n\tconst store = ensureNoDisposablesAreLeakedInTestSuite();\n\n\ttest('empty pool token is not cancelled', function () {\n\t\tconst pool = new CancellationTokenPool();\n\t\tstore.add(pool);\n\n\t\tassert.strictEqual(pool.token.isCancellationRequested, false);\n\t});\n\n\ttest('pool token cancels when all tokens are cancelled', function () {\n\t\tconst pool = new CancellationTokenPool();\n\t\tstore.add(pool);\n\n\t\tconst source1 = new CancellationTokenSource();\n\t\tconst source2 = new CancellationTokenSource();\n\t\tconst source3 = new CancellationTokenSource();\n\n\t\tpool.add(source1.token);\n\t\tpool.add(source2.token);\n\t\tpool.add(source3.token);\n\n\t\tassert.strictEqual(pool.token.isCancellationRequested, false);\n\n\t\tsource1.cancel();\n\t\tassert.strictEqual(pool.token.isCancellationRequested, false);\n\n\t\tsource2.cancel();\n\t\tassert.strictEqual(pool.token.isCancellationRequested, false);\n\n\t\tsource3.cancel();\n\t\tassert.strictEqual(pool.token.isCancellationRequested, true);\n\n\t\tsource1.dispose();\n\t\tsource2.dispose();\n\t\tsource3.dispose();\n\t});\n\n\ttest('pool token fires cancellation event when all tokens are cancelled', function () {\n\t\treturn new Promise<void>(resolve => {\n\t\t\tconst pool = new CancellationTokenPool();\n\t\t\tstore.add(pool);\n\n\t\t\tconst source1 = new CancellationTokenSource();\n\t\t\tconst source2 = new CancellationTokenSource();\n\n\t\t\tpool.add(source1.token);\n\t\t\tpool.add(source2.token);\n\n\t\t\tstore.add(pool.token.onCancellationRequested(() => resolve()));\n\n\t\t\tsource1.cancel();\n\t\t\tsource2.cancel();\n\n\t\t\tsource1.dispose();\n\t\t\tsource2.dispose();\n\t\t});\n\t});\n\n\ttest('adding already cancelled token counts immediately', function () {\n\t\tconst pool = new CancellationTokenPool();\n\t\tstore.add(pool);\n\n\t\tconst source1 = new CancellationTokenSource();\n\t\tconst source2 = new CancellationTokenSource();\n\n\t\tsource1.cancel(); // Cancel before adding to pool\n\n\t\tpool.add(source1.token);\n\t\tassert.strictEqual(pool.token.isCancellationRequested, true); // 1 of 1 cancelled, so pool is cancelled\n\n\t\tpool.add(source2.token); // Adding after pool is done should have no effect\n\t\tassert.strictEqual(pool.token.isCancellationRequested, true);\n\n\t\tsource2.cancel(); // This should have no effect since pool is already done\n\t\tassert.strictEqual(pool.token.isCancellationRequested, true);\n\n\t\tsource1.dispose();\n\t\tsource2.dispose();\n\t});\n\n\ttest('adding single already cancelled token cancels pool immediately', function () {\n\t\tconst pool = new CancellationTokenPool();\n\t\tstore.add(pool);\n\n\t\tconst source = new CancellationTokenSource();\n\t\tsource.cancel();\n\n\t\tpool.add(source.token);\n\t\tassert.strictEqual(pool.token.isCancellationRequested, true); // 1 of 1 cancelled\n\n\t\tsource.dispose();\n\t});\n\n\ttest('adding token after pool is done has no effect', function () {\n\t\tconst pool = new CancellationTokenPool();\n\t\tstore.add(pool);\n\n\t\tconst source1 = new CancellationTokenSource();\n\t\tconst source2 = new CancellationTokenSource();\n\n\t\tpool.add(source1.token);\n\t\tsource1.cancel(); // Pool should be done now\n\n\t\tassert.strictEqual(pool.token.isCancellationRequested, true);\n\n\t\t// Adding another token should have no effect\n\t\tpool.add(source2.token);\n\t\tsource2.cancel();\n\n\t\tassert.strictEqual(pool.token.isCancellationRequested, true);\n\n\t\tsource1.dispose();\n\t\tsource2.dispose();\n\t});\n\n\ttest('single token pool behaviour', function () {\n\t\tconst pool = new CancellationTokenPool();\n\t\tstore.add(pool);\n\n\t\tconst source = new CancellationTokenSource();\n\t\tpool.add(source.token);\n\n\t\tassert.strictEqual(pool.token.isCancellationRequested, false);\n\n\t\tsource.cancel();\n\t\tassert.strictEqual(pool.token.isCancellationRequested, true);\n\n\t\tsource.dispose();\n\t});\n\n\ttest('pool with only cancelled tokens', function () {\n\t\tconst pool = new CancellationTokenPool();\n\t\tstore.add(pool);\n\n\t\tconst source1 = new CancellationTokenSource();\n\t\tconst source2 = new CancellationTokenSource();\n\n\t\tsource1.cancel();\n\t\tsource2.cancel();\n\n\t\tpool.add(source1.token);\n\t\tpool.add(source2.token);\n\n\t\tassert.strictEqual(pool.token.isCancellationRequested, true);\n\n\t\tsource1.dispose();\n\t\tsource2.dispose();\n\t});\n});\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nimport assert from 'assert';\nimport { CancellationToken, CancellationTokenSource, CancellationTokenPool } from '../../common/cancellation.js';\nimport { ensureNoDisposablesAreLeakedInTestSuite } from './utils.js';\n\nsuite('CancellationToken', function () {\n\n\tconst store = ensureNoDisposablesAreLeakedInTestSuite();\n\n\ttest('None', () => {\n\t\tassert.strictEqual(CancellationToken.None.isCancellationRequested, false);\n\t\tassert.strictEqual(typeof CancellationToken.None.onCancellationRequested, 'function');\n\t});\n\n\ttest('cancel before token', function () {\n\n\t\tconst source = new CancellationTokenSource();\n\t\tassert.strictEqual(source.token.isCancellationRequested, false);\n\t\tsource.cancel();\n\n\t\tassert.strictEqual(source.token.isCancellationRequested, true);\n\n\t\treturn new Promise<void>(resolve => {\n\t\t\tsource.token.onCancellationRequested(() => resolve());\n\t\t});\n\t});\n\n\ttest('cancel happens only once', function () {\n\n\t\tconst source = new CancellationTokenSource();\n\t\tassert.strictEqual(source.token.isCancellationRequested, false);\n\n\t\tlet cancelCount = 0;\n\t\tfunction onCancel() {\n\t\t\tcancelCount += 1;\n\t\t}\n\n\t\tstore.add(source.token.onCancellationRequested(onCancel));\n\n\t\tsource.cancel();\n\t\tsource.cancel();\n\n\t\tassert.strictEqual(cancelCount, 1);\n\t});\n\n\ttest('cancel calls all listeners', function () {\n\n\t\tlet count = 0;\n\n\t\tconst source = new CancellationTokenSource();\n\t\tstore.add(source.token.onCancellationRequested(() => count++));\n\t\tstore.add(source.token.onCancellationRequested(() => count++));\n\t\tstore.add(source.token.onCancellationRequested(() => count++));\n\n\t\tsource.cancel();\n\t\tassert.strictEqual(count, 3);\n\t});\n\n\ttest('token stays the same', function () {\n\n\t\tlet source = new CancellationTokenSource();\n\t\tlet token = source.token;\n\t\tassert.ok(token === source.token); // doesn't change on get\n\n\t\tsource.cancel();\n\t\tassert.ok(token === source.token); // doesn't change after cancel\n\n\t\tsource.cancel();\n\t\tassert.ok(token === source.token); // doesn't change after 2nd cancel\n\n\t\tsource = new CancellationTokenSource();\n\t\tsource.cancel();\n\t\ttoken = source.token;\n\t\tassert.ok(token === source.token); // doesn't change on get\n\t});\n\n\ttest('dispose calls no listeners', function () {\n\n\t\tlet count = 0;\n\n\t\tconst source = new CancellationTokenSource();\n\t\tstore.add(source.token.onCancellationRequested(() => count++));\n\n\t\tsource.dispose();\n\t\tsource.cancel();\n\t\tassert.strictEqual(count, 0);\n\t});\n\n\ttest('dispose calls no listeners (unless told to cancel)', function () {\n\n\t\tlet count = 0;\n\n\t\tconst source = new CancellationTokenSource();\n\t\tstore.add(source.token.onCancellationRequested(() => count++));\n\n\t\tsource.dispose(true);\n\t\t// source.cancel();\n\t\tassert.strictEqual(count, 1);\n\t});\n\n\ttest('dispose does not cancel', function () {\n\t\tconst source = new CancellationTokenSource();\n\t\tsource.dispose();\n\t\tassert.strictEqual(source.token.isCancellationRequested, false);\n\t});\n\n\ttest('parent cancels child', function () {\n\n\t\tconst parent = new CancellationTokenSource();\n\t\tconst child = new CancellationTokenSource(parent.token);\n\n\t\tlet count = 0;\n\t\tstore.add(child.token.onCancellationRequested(() => count++));\n\n\t\tparent.cancel();\n\n\t\tassert.strictEqual(count, 1);\n\t\tassert.strictEqual(child.token.isCancellationRequested, true);\n\t\tassert.strictEqual(parent.token.isCancellationRequested, true);\n\n\t\tchild.dispose();\n\t\tparent.dispose();\n\t});\n});\n\nsuite('CancellationTokenPool', function () {\n\n\tconst store = ensureNoDisposablesAreLeakedInTestSuite();\n\n\ttest('empty pool token is not cancelled', function () {\n\t\tconst pool = new CancellationTokenPool();\n\t\tstore.add(pool);\n\n\t\tassert.strictEqual(pool.token.isCancellationRequested, false);\n\t});\n\n\ttest('pool token cancels when all tokens are cancelled', function () {\n\t\tconst pool = new CancellationTokenPool();\n\t\tstore.add(pool);\n\n\t\tconst source1 = new CancellationTokenSource();\n\t\tconst source2 = new CancellationTokenSource();\n\t\tconst source3 = new CancellationTokenSource();\n\n\t\tpool.add(source1.token);\n\t\tpool.add(source2.token);\n\t\tpool.add(source3.token);\n\n\t\tassert.strictEqual(pool.token.isCancellationRequested, false);\n\n\t\tsource1.cancel();\n\t\tassert.strictEqual(pool.token.isCancellationRequested, false);\n\n\t\tsource2.cancel();\n\t\tassert.strictEqual(pool.token.isCancellationRequested, false);\n\n\t\tsource3.cancel();\n\t\tassert.strictEqual(pool.token.isCancellationRequested, true);\n\n\t\tsource1.dispose();\n\t\tsource2.dispose();\n\t\tsource3.dispose();\n\t});\n\n\ttest('pool token fires cancellation event when all tokens are cancelled', function () {\n\t\treturn new Promise<void>(resolve => {\n\t\t\tconst pool = new CancellationTokenPool();\n\t\t\tstore.add(pool);\n\n\t\t\tconst source1 = new CancellationTokenSource();\n\t\t\tconst source2 = new CancellationTokenSource();\n\n\t\t\tpool.add(source1.token);\n\t\t\tpool.add(source2.token);\n\n\t\t\tstore.add(pool.token.onCancellationRequested(() => resolve()));\n\n\t\t\tsource1.cancel();\n\t\t\tsource2.cancel();\n\n\t\t\tsource1.dispose();\n\t\t\tsource2.dispose();\n\t\t});\n\t});\n\n\ttest('adding already cancelled token counts immediately', function () {\n\t\tconst pool = new CancellationTokenPool();\n\t\tstore.add(pool);\n\n\t\tconst source1 = new CancellationTokenSource();\n\t\tconst source2 = new CancellationTokenSource();\n\n\t\tsource1.cancel(); // Cancel before adding to pool\n\n\t\tpool.add(source1.token);\n\t\tassert.strictEqual(pool.token.isCancellationRequested, true); // 1 of 1 cancelled, so pool is cancelled\n\n\t\tpool.add(source2.token); // Adding after pool is done should have no effect\n\t\tassert.strictEqual(pool.token.isCancellationRequested, true);\n\n\t\tsource2.cancel(); // This should have no effect since pool is already done\n\t\tassert.strictEqual(pool.token.isCancellationRequested, true);\n\n\t\tsource1.dispose();\n\t\tsource2.dispose();\n\t});\n\n\ttest('adding single already cancelled token cancels pool immediately', function () {\n\t\tconst pool = new CancellationTokenPool();\n\t\tstore.add(pool);\n\n\t\tconst source = new CancellationTokenSource();\n\t\tsource.cancel();\n\n\t\tpool.add(source.token);\n\t\tassert.strictEqual(pool.token.isCancellationRequested, true); // 1 of 1 cancelled\n\n\t\tsource.dispose();\n\t});\n\n\ttest('adding token after pool is done has no effect', function () {\n\t\tconst pool = new CancellationTokenPool();\n\t\tstore.add(pool);\n\n\t\tconst source1 = new CancellationTokenSource();\n\t\tconst source2 = new CancellationTokenSource();\n\n\t\tpool.add(source1.token);\n\t\tsource1.cancel(); // Pool should be done now\n\n\t\tassert.strictEqual(pool.token.isCancellationRequested, true);\n\n\t\t// Adding another token should have no effect\n\t\tpool.add(source2.token);\n\t\tsource2.cancel();\n\n\t\tassert.strictEqual(pool.token.isCancellationRequested, true);\n\n\t\tsource1.dispose();\n\t\tsource2.dispose();\n\t});\n\n\ttest('single token pool behaviour', function () {\n\t\tconst pool = new CancellationTokenPool();\n\t\tstore.add(pool);\n\n\t\tconst source = new CancellationTokenSource();\n\t\tpool.add(source.token);\n\n\t\tassert.strictEqual(pool.token.isCancellationRequested, false);\n\n\t\tsource.cancel();\n\t\tassert.strictEqual(pool.token.isCancellationRequested, true);\n\n\t\tsource.dispose();\n\t});\n\n\ttest('pool with only cancelled tokens', function () {\n\t\tconst pool = new CancellationTokenPool();\n\t\tstore.add(pool);\n\n\t\tconst source1 = new CancellationTokenSource();\n\t\tconst source2 = new CancellationTokenSource();\n\n\t\tsource1.cancel();\n\t\tsource2.cancel();\n\n\t\tpool.add(source1.token);\n\t\tpool.add(source2.token);\n\n\t\tassert.strictEqual(pool.token.isCancellationRequested, true);\n\n\t\tsource1.dispose();\n\t\tsource2.dispose();\n\t});\n});\n"]}