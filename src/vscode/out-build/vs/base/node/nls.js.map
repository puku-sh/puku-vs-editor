{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/base/node/nls.ts","vs/base/node/nls.ts"],"names":[],"mappings":"AAAA;;;gGAGgG;AAEhG,OAAO,EAAE,IAAI,EAAE,MAAM,mBAAmB,CAAC;AACzC,OAAO,EAAE,QAAQ,EAAE,MAAM,IAAI,CAAC;AAC9B,OAAO,EAAE,IAAI,EAAE,MAAM,0BAA0B,CAAC;AAEhD,OAAO,EAAE,QAAQ,EAAE,MAAM,UAAU,CAAC;AAgCpC,MAAM,CAAC,KAAK,UAAU,uBAAuB,CAAC,EAAE,UAAU,EAAE,QAAQ,EAAE,YAAY,EAAE,MAAM,EAAE,eAAe,EAAmC;IAC7I,IAAI,CAAC,sBAAsB,CAAC,CAAC;IAE7B,IACC,OAAO,CAAC,GAAG,CAAC,YAAY,CAAC;QACzB,UAAU,KAAK,QAAQ;QACvB,UAAU,CAAC,UAAU,CAAC,IAAI,CAAC;QAC3B,CAAC,MAAM;QACP,CAAC,YAAY,EACZ,CAAC;QACF,OAAO,uBAAuB,CAAC,UAAU,EAAE,QAAQ,EAAE,eAAe,CAAC,CAAC;IACvE,CAAC;IAED,IAAI,CAAC;QACJ,MAAM,aAAa,GAAG,MAAM,6BAA6B,CAAC,YAAY,CAAC,CAAC;QACxE,IAAI,CAAC,aAAa,EAAE,CAAC;YACpB,OAAO,uBAAuB,CAAC,UAAU,EAAE,QAAQ,EAAE,eAAe,CAAC,CAAC;QACvE,CAAC;QAED,MAAM,gBAAgB,GAAG,2BAA2B,CAAC,aAAa,EAAE,UAAU,CAAC,CAAC;QAChF,IAAI,CAAC,gBAAgB,EAAE,CAAC;YACvB,OAAO,uBAAuB,CAAC,UAAU,EAAE,QAAQ,EAAE,eAAe,CAAC,CAAC;QACvE,CAAC;QAED,MAAM,YAAY,GAAG,aAAa,CAAC,gBAAgB,CAAC,CAAC;QACrD,MAAM,oBAAoB,GAAG,YAAY,EAAE,YAAY,EAAE,CAAC,QAAQ,CAAC,CAAC;QACpE,IACC,CAAC,YAAY;YACb,OAAO,YAAY,CAAC,IAAI,KAAK,QAAQ;YACrC,CAAC,YAAY,CAAC,YAAY;YAC1B,OAAO,oBAAoB,KAAK,QAAQ;YACxC,CAAC,CAAC,MAAM,QAAQ,CAAC,MAAM,CAAC,oBAAoB,CAAC,CAAC,EAC7C,CAAC;YACF,OAAO,uBAAuB,CAAC,UAAU,EAAE,QAAQ,EAAE,eAAe,CAAC,CAAC;QACvE,CAAC;QAED,MAAM,cAAc,GAAG,GAAG,YAAY,CAAC,IAAI,IAAI,gBAAgB,EAAE,CAAC;QAClE,MAAM,2BAA2B,GAAG,IAAI,CAAC,YAAY,EAAE,KAAK,EAAE,cAAc,CAAC,CAAC;QAC9E,MAAM,2BAA2B,GAAG,IAAI,CAAC,2BAA2B,EAAE,MAAM,CAAC,CAAC;QAC9E,MAAM,wBAAwB,GAAG,IAAI,CAAC,2BAA2B,EAAE,mBAAmB,CAAC,CAAC;QACxF,MAAM,sBAAsB,GAAG,IAAI,CAAC,2BAA2B,EAAE,UAAU,CAAC,CAAC;QAC7E,MAAM,6BAA6B,GAAG,IAAI,CAAC,2BAA2B,EAAE,gBAAgB,CAAC,CAAC;QAE1F,IAAI,MAAM,QAAQ,CAAC,MAAM,CAAC,6BAA6B,CAAC,EAAE,CAAC;YAC1D,MAAM,QAAQ,CAAC,EAAE,CAAC,2BAA2B,EAAE,EAAE,SAAS,EAAE,IAAI,EAAE,KAAK,EAAE,IAAI,EAAE,UAAU,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC,gCAAgC;QAClI,CAAC;QAED,MAAM,MAAM,GAAsB;YACjC,UAAU;YACV,QAAQ;YACR,gBAAgB;YAChB,mBAAmB,EAAE,IAAI,CAAC,eAAe,EAAE,mBAAmB,CAAC;YAC/D,YAAY,EAAE;gBACb,sBAAsB;gBACtB,YAAY,EAAE,wBAAwB;gBACtC,iBAAiB,EAAE,6BAA6B;aAChD;YAED,0FAA0F;YAC1F,MAAM,EAAE,UAAU;YAClB,kBAAkB,EAAE,EAAE,GAAG,EAAE,gBAAgB,EAAE;YAC7C,eAAe,EAAE,cAAc;YAC/B,oBAAoB,EAAE,IAAI;YAC1B,uBAAuB,EAAE,sBAAsB;YAC/C,UAAU,EAAE,2BAA2B;YACvC,iCAAiC,EAAE,2BAA2B;YAC9D,cAAc,EAAE,6BAA6B;SAC7C,CAAC;QAEF,IAAI,MAAM,QAAQ,CAAC,MAAM,CAAC,wBAAwB,CAAC,EAAE,CAAC;YACrD,KAAK,CAAC,2BAA2B,CAAC,CAAC,KAAK,CAAC,GAAG,EAAE,GAAG,CAAC,CAAC,CAAC,CAAC,wDAAwD;YAC7G,IAAI,CAAC,qBAAqB,CAAC,CAAC;YAC5B,OAAO,MAAM,CAAC;QACf,CAAC;QAED,MAAM,CACL,cAAc,EACd,kBAAkB,EAClB,WAAW,CACX;QAEA,yFAAyF;UACvF,MAAM,OAAO,CAAC,GAAG,CAAC;YACnB,QAAQ,CAAC,QAAQ,CAAC,IAAI,CAAC,eAAe,EAAE,eAAe,CAAC,EAAE,OAAO,CAAC,CAAC,IAAI,CAAC,OAAO,CAAC,EAAE,CAAC,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC;YACvG,QAAQ,CAAC,QAAQ,CAAC,IAAI,CAAC,eAAe,EAAE,mBAAmB,CAAC,EAAE,OAAO,CAAC,CAAC,IAAI,CAAC,OAAO,CAAC,EAAE,CAAC,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC;YAC3G,QAAQ,CAAC,QAAQ,CAAC,oBAAoB,EAAE,OAAO,CAAC,CAAC,IAAI,CAAC,OAAO,CAAC,EAAE,CAAC,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC;SACrF,CAAC,CAAC;QAEJ,MAAM,SAAS,GAAa,EAAE,CAAC;QAE/B,uEAAuE;QACvE,uEAAuE;QACvE,wEAAwE;QACxE,uEAAuE;QAEvE,IAAI,QAAQ,GAAG,CAAC,CAAC;QACjB,KAAK,MAAM,CAAC,QAAQ,EAAE,OAAO,CAAC,IAAI,cAAc,EAAE,CAAC;YAClD,MAAM,kBAAkB,GAAG,WAAW,CAAC,QAAQ,CAAC,QAAQ,CAAC,CAAC;YAC1D,KAAK,MAAM,MAAM,IAAI,OAAO,EAAE,CAAC;gBAC9B,SAAS,CAAC,IAAI,CAAC,kBAAkB,EAAE,CAAC,MAAM,CAAC,IAAI,kBAAkB,CAAC,QAAQ,CAAC,CAAC,CAAC;gBAC7E,QAAQ,EAAE,CAAC;YACZ,CAAC;QACF,CAAC;QAED,MAAM,QAAQ,CAAC,KAAK,CAAC,2BAA2B,EAAE,EAAE,SAAS,EAAE,IAAI,EAAE,CAAC,CAAC;QAEvE,MAAM,OAAO,CAAC,GAAG,CAAC;YACjB,QAAQ,CAAC,SAAS,CAAC,wBAAwB,EAAE,IAAI,CAAC,SAAS,CAAC,SAAS,CAAC,EAAE,OAAO,CAAC;YAChF,QAAQ,CAAC,SAAS,CAAC,sBAAsB,EAAE,IAAI,CAAC,SAAS,CAAC,YAAY,CAAC,YAAY,CAAC,EAAE,OAAO,CAAC;SAC9F,CAAC,CAAC;QAEH,IAAI,CAAC,qBAAqB,CAAC,CAAC;QAE5B,OAAO,MAAM,CAAC;IACf,CAAC;IAAC,OAAO,KAAK,EAAE,CAAC;QAChB,OAAO,CAAC,KAAK,CAAC,sCAAsC,EAAE,KAAK,CAAC,CAAC;IAC9D,CAAC;IAED,OAAO,uBAAuB,CAAC,UAAU,EAAE,QAAQ,EAAE,eAAe,CAAC,CAAC;AACvE,CAAC;AAED;;;;;;;GAOG;AACH,KAAK,UAAU,6BAA6B,CAAC,YAAoB;IAChE,MAAM,UAAU,GAAG,IAAI,CAAC,YAAY,EAAE,oBAAoB,CAAC,CAAC;IAC5D,IAAI,CAAC;QACJ,OAAO,IAAI,CAAC,KAAK,CAAC,MAAM,QAAQ,CAAC,QAAQ,CAAC,UAAU,EAAE,OAAO,CAAC,CAAC,CAAC;IACjE,CAAC;IAAC,OAAO,GAAG,EAAE,CAAC;QACd,OAAO,SAAS,CAAC,CAAC,yEAAyE;IAC5F,CAAC;AACF,CAAC;AAED,SAAS,2BAA2B,CAAC,aAA6B,EAAE,MAA0B;IAC7F,IAAI,CAAC;QACJ,OAAO,MAAM,EAAE,CAAC;YACf,IAAI,aAAa,CAAC,MAAM,CAAC,EAAE,CAAC;gBAC3B,OAAO,MAAM,CAAC;YACf,CAAC;YAED,MAAM,KAAK,GAAG,MAAM,CAAC,WAAW,CAAC,GAAG,CAAC,CAAC;YACtC,IAAI,KAAK,GAAG,CAAC,EAAE,CAAC;gBACf,MAAM,GAAG,MAAM,CAAC,SAAS,CAAC,CAAC,EAAE,KAAK,CAAC,CAAC;YACrC,CAAC;iBAAM,CAAC;gBACP,OAAO,SAAS,CAAC;YAClB,CAAC;QACF,CAAC;IACF,CAAC;IAAC,OAAO,KAAK,EAAE,CAAC;QAChB,OAAO,CAAC,KAAK,CAAC,+CAA+C,EAAE,KAAK,CAAC,CAAC;IACvE,CAAC;IAED,OAAO,SAAS,CAAC;AAClB,CAAC;AAED,SAAS,uBAAuB,CAAC,UAAkB,EAAE,QAAgB,EAAE,eAAuB;IAC7F,IAAI,CAAC,qBAAqB,CAAC,CAAC;IAE5B,OAAO;QACN,UAAU;QACV,QAAQ;QACR,gBAAgB,EAAE,IAAI;QACtB,mBAAmB,EAAE,IAAI,CAAC,eAAe,EAAE,mBAAmB,CAAC;QAE/D,iFAAiF;QACjF,MAAM,EAAE,UAAU;QAClB,kBAAkB,EAAE,EAAE;KACtB,CAAC;AACH,CAAC;AAED,oBAAoB;AAEpB,SAAS,KAAK,CAAC,IAAY;IAC1B,MAAM,IAAI,GAAG,IAAI,IAAI,EAAE,CAAC;IAExB,OAAO,QAAQ,CAAC,MAAM,CAAC,IAAI,EAAE,IAAI,EAAE,IAAI,CAAC,CAAC;AAC1C,CAAC;AAED,YAAY","file":"nls.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { join } from '../common/path.js';\nimport { promises } from 'fs';\nimport { mark } from '../common/performance.js';\nimport { ILanguagePacks, INLSConfiguration } from '../../nls.js';\nimport { Promises } from './pfs.js';\n\nexport interface IResolveNLSConfigurationContext {\n\n\t/**\n\t * Location where `nls.messages.json` and `nls.keys.json` are stored.\n\t */\n\treadonly nlsMetadataPath: string;\n\n\t/**\n\t * Path to the user data directory. Used as a cache for\n\t * language packs converted to the format we need.\n\t */\n\treadonly userDataPath: string;\n\n\t/**\n\t * Commit of the running application. Can be `undefined`\n\t * when not built.\n\t */\n\treadonly commit: string | undefined;\n\n\t/**\n\t * Locale as defined in `argv.json` or `app.getLocale()`.\n\t */\n\treadonly userLocale: string;\n\n\t/**\n\t * Locale as defined by the OS (e.g. `app.getPreferredSystemLanguages()`).\n\t */\n\treadonly osLocale: string;\n}\n\nexport async function resolveNLSConfiguration({ userLocale, osLocale, userDataPath, commit, nlsMetadataPath }: IResolveNLSConfigurationContext): Promise<INLSConfiguration> {\n\tmark('code/willGenerateNls');\n\n\tif (\n\t\tprocess.env['VSCODE_DEV'] ||\n\t\tuserLocale === 'pseudo' ||\n\t\tuserLocale.startsWith('en') ||\n\t\t!commit ||\n\t\t!userDataPath\n\t) {\n\t\treturn defaultNLSConfiguration(userLocale, osLocale, nlsMetadataPath);\n\t}\n\n\ttry {\n\t\tconst languagePacks = await getLanguagePackConfigurations(userDataPath);\n\t\tif (!languagePacks) {\n\t\t\treturn defaultNLSConfiguration(userLocale, osLocale, nlsMetadataPath);\n\t\t}\n\n\t\tconst resolvedLanguage = resolveLanguagePackLanguage(languagePacks, userLocale);\n\t\tif (!resolvedLanguage) {\n\t\t\treturn defaultNLSConfiguration(userLocale, osLocale, nlsMetadataPath);\n\t\t}\n\n\t\tconst languagePack = languagePacks[resolvedLanguage];\n\t\tconst mainLanguagePackPath = languagePack?.translations?.['vscode'];\n\t\tif (\n\t\t\t!languagePack ||\n\t\t\ttypeof languagePack.hash !== 'string' ||\n\t\t\t!languagePack.translations ||\n\t\t\ttypeof mainLanguagePackPath !== 'string' ||\n\t\t\t!(await Promises.exists(mainLanguagePackPath))\n\t\t) {\n\t\t\treturn defaultNLSConfiguration(userLocale, osLocale, nlsMetadataPath);\n\t\t}\n\n\t\tconst languagePackId = `${languagePack.hash}.${resolvedLanguage}`;\n\t\tconst globalLanguagePackCachePath = join(userDataPath, 'clp', languagePackId);\n\t\tconst commitLanguagePackCachePath = join(globalLanguagePackCachePath, commit);\n\t\tconst languagePackMessagesFile = join(commitLanguagePackCachePath, 'nls.messages.json');\n\t\tconst translationsConfigFile = join(globalLanguagePackCachePath, 'tcf.json');\n\t\tconst languagePackCorruptMarkerFile = join(globalLanguagePackCachePath, 'corrupted.info');\n\n\t\tif (await Promises.exists(languagePackCorruptMarkerFile)) {\n\t\t\tawait promises.rm(globalLanguagePackCachePath, { recursive: true, force: true, maxRetries: 3 }); // delete corrupted cache folder\n\t\t}\n\n\t\tconst result: INLSConfiguration = {\n\t\t\tuserLocale,\n\t\t\tosLocale,\n\t\t\tresolvedLanguage,\n\t\t\tdefaultMessagesFile: join(nlsMetadataPath, 'nls.messages.json'),\n\t\t\tlanguagePack: {\n\t\t\t\ttranslationsConfigFile,\n\t\t\t\tmessagesFile: languagePackMessagesFile,\n\t\t\t\tcorruptMarkerFile: languagePackCorruptMarkerFile\n\t\t\t},\n\n\t\t\t// NLS: below properties are a relic from old times only used by vscode-nls and deprecated\n\t\t\tlocale: userLocale,\n\t\t\tavailableLanguages: { '*': resolvedLanguage },\n\t\t\t_languagePackId: languagePackId,\n\t\t\t_languagePackSupport: true,\n\t\t\t_translationsConfigFile: translationsConfigFile,\n\t\t\t_cacheRoot: globalLanguagePackCachePath,\n\t\t\t_resolvedLanguagePackCoreLocation: commitLanguagePackCachePath,\n\t\t\t_corruptedFile: languagePackCorruptMarkerFile\n\t\t};\n\n\t\tif (await Promises.exists(languagePackMessagesFile)) {\n\t\t\ttouch(commitLanguagePackCachePath).catch(() => { }); // We don't wait for this. No big harm if we can't touch\n\t\t\tmark('code/didGenerateNls');\n\t\t\treturn result;\n\t\t}\n\n\t\tconst [\n\t\t\tnlsDefaultKeys,\n\t\t\tnlsDefaultMessages,\n\t\t\tnlsPackdata\n\t\t]:\n\t\t\t[Array<[string, string[]]>, string[], { contents: Record<string, Record<string, string>> }]\n\t\t\t//      ^moduleId ^nlsKeys                               ^moduleId      ^nlsKey ^nlsValue\n\t\t\t= await Promise.all([\n\t\t\t\tpromises.readFile(join(nlsMetadataPath, 'nls.keys.json'), 'utf-8').then(content => JSON.parse(content)),\n\t\t\t\tpromises.readFile(join(nlsMetadataPath, 'nls.messages.json'), 'utf-8').then(content => JSON.parse(content)),\n\t\t\t\tpromises.readFile(mainLanguagePackPath, 'utf-8').then(content => JSON.parse(content)),\n\t\t\t]);\n\n\t\tconst nlsResult: string[] = [];\n\n\t\t// We expect NLS messages to be in a flat array in sorted order as they\n\t\t// where produced during build time. We use `nls.keys.json` to know the\n\t\t// right order and then lookup the related message from the translation.\n\t\t// If a translation does not exist, we fallback to the default message.\n\n\t\tlet nlsIndex = 0;\n\t\tfor (const [moduleId, nlsKeys] of nlsDefaultKeys) {\n\t\t\tconst moduleTranslations = nlsPackdata.contents[moduleId];\n\t\t\tfor (const nlsKey of nlsKeys) {\n\t\t\t\tnlsResult.push(moduleTranslations?.[nlsKey] || nlsDefaultMessages[nlsIndex]);\n\t\t\t\tnlsIndex++;\n\t\t\t}\n\t\t}\n\n\t\tawait promises.mkdir(commitLanguagePackCachePath, { recursive: true });\n\n\t\tawait Promise.all([\n\t\t\tpromises.writeFile(languagePackMessagesFile, JSON.stringify(nlsResult), 'utf-8'),\n\t\t\tpromises.writeFile(translationsConfigFile, JSON.stringify(languagePack.translations), 'utf-8')\n\t\t]);\n\n\t\tmark('code/didGenerateNls');\n\n\t\treturn result;\n\t} catch (error) {\n\t\tconsole.error('Generating translation files failed.', error);\n\t}\n\n\treturn defaultNLSConfiguration(userLocale, osLocale, nlsMetadataPath);\n}\n\n/**\n * The `languagepacks.json` file is a JSON file that contains all metadata\n * about installed language extensions per language. Specifically, for\n * core (`vscode`) and all extensions it supports, it points to the related\n * translation files.\n *\n * The file is updated whenever a new language pack is installed or removed.\n */\nasync function getLanguagePackConfigurations(userDataPath: string): Promise<ILanguagePacks | undefined> {\n\tconst configFile = join(userDataPath, 'languagepacks.json');\n\ttry {\n\t\treturn JSON.parse(await promises.readFile(configFile, 'utf-8'));\n\t} catch (err) {\n\t\treturn undefined; // Do nothing. If we can't read the file we have no language pack config.\n\t}\n}\n\nfunction resolveLanguagePackLanguage(languagePacks: ILanguagePacks, locale: string | undefined): string | undefined {\n\ttry {\n\t\twhile (locale) {\n\t\t\tif (languagePacks[locale]) {\n\t\t\t\treturn locale;\n\t\t\t}\n\n\t\t\tconst index = locale.lastIndexOf('-');\n\t\t\tif (index > 0) {\n\t\t\t\tlocale = locale.substring(0, index);\n\t\t\t} else {\n\t\t\t\treturn undefined;\n\t\t\t}\n\t\t}\n\t} catch (error) {\n\t\tconsole.error('Resolving language pack configuration failed.', error);\n\t}\n\n\treturn undefined;\n}\n\nfunction defaultNLSConfiguration(userLocale: string, osLocale: string, nlsMetadataPath: string): INLSConfiguration {\n\tmark('code/didGenerateNls');\n\n\treturn {\n\t\tuserLocale,\n\t\tosLocale,\n\t\tresolvedLanguage: 'en',\n\t\tdefaultMessagesFile: join(nlsMetadataPath, 'nls.messages.json'),\n\n\t\t// NLS: below 2 are a relic from old times only used by vscode-nls and deprecated\n\t\tlocale: userLocale,\n\t\tavailableLanguages: {}\n\t};\n}\n\n//#region fs helpers\n\nfunction touch(path: string): Promise<void> {\n\tconst date = new Date();\n\n\treturn promises.utimes(path, date, date);\n}\n\n//#endregion\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { join } from '../common/path.js';\nimport { promises } from 'fs';\nimport { mark } from '../common/performance.js';\nimport { ILanguagePacks, INLSConfiguration } from '../../nls.js';\nimport { Promises } from './pfs.js';\n\nexport interface IResolveNLSConfigurationContext {\n\n\t/**\n\t * Location where `nls.messages.json` and `nls.keys.json` are stored.\n\t */\n\treadonly nlsMetadataPath: string;\n\n\t/**\n\t * Path to the user data directory. Used as a cache for\n\t * language packs converted to the format we need.\n\t */\n\treadonly userDataPath: string;\n\n\t/**\n\t * Commit of the running application. Can be `undefined`\n\t * when not built.\n\t */\n\treadonly commit: string | undefined;\n\n\t/**\n\t * Locale as defined in `argv.json` or `app.getLocale()`.\n\t */\n\treadonly userLocale: string;\n\n\t/**\n\t * Locale as defined by the OS (e.g. `app.getPreferredSystemLanguages()`).\n\t */\n\treadonly osLocale: string;\n}\n\nexport async function resolveNLSConfiguration({ userLocale, osLocale, userDataPath, commit, nlsMetadataPath }: IResolveNLSConfigurationContext): Promise<INLSConfiguration> {\n\tmark('code/willGenerateNls');\n\n\tif (\n\t\tprocess.env['VSCODE_DEV'] ||\n\t\tuserLocale === 'pseudo' ||\n\t\tuserLocale.startsWith('en') ||\n\t\t!commit ||\n\t\t!userDataPath\n\t) {\n\t\treturn defaultNLSConfiguration(userLocale, osLocale, nlsMetadataPath);\n\t}\n\n\ttry {\n\t\tconst languagePacks = await getLanguagePackConfigurations(userDataPath);\n\t\tif (!languagePacks) {\n\t\t\treturn defaultNLSConfiguration(userLocale, osLocale, nlsMetadataPath);\n\t\t}\n\n\t\tconst resolvedLanguage = resolveLanguagePackLanguage(languagePacks, userLocale);\n\t\tif (!resolvedLanguage) {\n\t\t\treturn defaultNLSConfiguration(userLocale, osLocale, nlsMetadataPath);\n\t\t}\n\n\t\tconst languagePack = languagePacks[resolvedLanguage];\n\t\tconst mainLanguagePackPath = languagePack?.translations?.['vscode'];\n\t\tif (\n\t\t\t!languagePack ||\n\t\t\ttypeof languagePack.hash !== 'string' ||\n\t\t\t!languagePack.translations ||\n\t\t\ttypeof mainLanguagePackPath !== 'string' ||\n\t\t\t!(await Promises.exists(mainLanguagePackPath))\n\t\t) {\n\t\t\treturn defaultNLSConfiguration(userLocale, osLocale, nlsMetadataPath);\n\t\t}\n\n\t\tconst languagePackId = `${languagePack.hash}.${resolvedLanguage}`;\n\t\tconst globalLanguagePackCachePath = join(userDataPath, 'clp', languagePackId);\n\t\tconst commitLanguagePackCachePath = join(globalLanguagePackCachePath, commit);\n\t\tconst languagePackMessagesFile = join(commitLanguagePackCachePath, 'nls.messages.json');\n\t\tconst translationsConfigFile = join(globalLanguagePackCachePath, 'tcf.json');\n\t\tconst languagePackCorruptMarkerFile = join(globalLanguagePackCachePath, 'corrupted.info');\n\n\t\tif (await Promises.exists(languagePackCorruptMarkerFile)) {\n\t\t\tawait promises.rm(globalLanguagePackCachePath, { recursive: true, force: true, maxRetries: 3 }); // delete corrupted cache folder\n\t\t}\n\n\t\tconst result: INLSConfiguration = {\n\t\t\tuserLocale,\n\t\t\tosLocale,\n\t\t\tresolvedLanguage,\n\t\t\tdefaultMessagesFile: join(nlsMetadataPath, 'nls.messages.json'),\n\t\t\tlanguagePack: {\n\t\t\t\ttranslationsConfigFile,\n\t\t\t\tmessagesFile: languagePackMessagesFile,\n\t\t\t\tcorruptMarkerFile: languagePackCorruptMarkerFile\n\t\t\t},\n\n\t\t\t// NLS: below properties are a relic from old times only used by vscode-nls and deprecated\n\t\t\tlocale: userLocale,\n\t\t\tavailableLanguages: { '*': resolvedLanguage },\n\t\t\t_languagePackId: languagePackId,\n\t\t\t_languagePackSupport: true,\n\t\t\t_translationsConfigFile: translationsConfigFile,\n\t\t\t_cacheRoot: globalLanguagePackCachePath,\n\t\t\t_resolvedLanguagePackCoreLocation: commitLanguagePackCachePath,\n\t\t\t_corruptedFile: languagePackCorruptMarkerFile\n\t\t};\n\n\t\tif (await Promises.exists(languagePackMessagesFile)) {\n\t\t\ttouch(commitLanguagePackCachePath).catch(() => { }); // We don't wait for this. No big harm if we can't touch\n\t\t\tmark('code/didGenerateNls');\n\t\t\treturn result;\n\t\t}\n\n\t\tconst [\n\t\t\tnlsDefaultKeys,\n\t\t\tnlsDefaultMessages,\n\t\t\tnlsPackdata\n\t\t]:\n\t\t\t[Array<[string, string[]]>, string[], { contents: Record<string, Record<string, string>> }]\n\t\t\t//      ^moduleId ^nlsKeys                               ^moduleId      ^nlsKey ^nlsValue\n\t\t\t= await Promise.all([\n\t\t\t\tpromises.readFile(join(nlsMetadataPath, 'nls.keys.json'), 'utf-8').then(content => JSON.parse(content)),\n\t\t\t\tpromises.readFile(join(nlsMetadataPath, 'nls.messages.json'), 'utf-8').then(content => JSON.parse(content)),\n\t\t\t\tpromises.readFile(mainLanguagePackPath, 'utf-8').then(content => JSON.parse(content)),\n\t\t\t]);\n\n\t\tconst nlsResult: string[] = [];\n\n\t\t// We expect NLS messages to be in a flat array in sorted order as they\n\t\t// where produced during build time. We use `nls.keys.json` to know the\n\t\t// right order and then lookup the related message from the translation.\n\t\t// If a translation does not exist, we fallback to the default message.\n\n\t\tlet nlsIndex = 0;\n\t\tfor (const [moduleId, nlsKeys] of nlsDefaultKeys) {\n\t\t\tconst moduleTranslations = nlsPackdata.contents[moduleId];\n\t\t\tfor (const nlsKey of nlsKeys) {\n\t\t\t\tnlsResult.push(moduleTranslations?.[nlsKey] || nlsDefaultMessages[nlsIndex]);\n\t\t\t\tnlsIndex++;\n\t\t\t}\n\t\t}\n\n\t\tawait promises.mkdir(commitLanguagePackCachePath, { recursive: true });\n\n\t\tawait Promise.all([\n\t\t\tpromises.writeFile(languagePackMessagesFile, JSON.stringify(nlsResult), 'utf-8'),\n\t\t\tpromises.writeFile(translationsConfigFile, JSON.stringify(languagePack.translations), 'utf-8')\n\t\t]);\n\n\t\tmark('code/didGenerateNls');\n\n\t\treturn result;\n\t} catch (error) {\n\t\tconsole.error('Generating translation files failed.', error);\n\t}\n\n\treturn defaultNLSConfiguration(userLocale, osLocale, nlsMetadataPath);\n}\n\n/**\n * The `languagepacks.json` file is a JSON file that contains all metadata\n * about installed language extensions per language. Specifically, for\n * core (`vscode`) and all extensions it supports, it points to the related\n * translation files.\n *\n * The file is updated whenever a new language pack is installed or removed.\n */\nasync function getLanguagePackConfigurations(userDataPath: string): Promise<ILanguagePacks | undefined> {\n\tconst configFile = join(userDataPath, 'languagepacks.json');\n\ttry {\n\t\treturn JSON.parse(await promises.readFile(configFile, 'utf-8'));\n\t} catch (err) {\n\t\treturn undefined; // Do nothing. If we can't read the file we have no language pack config.\n\t}\n}\n\nfunction resolveLanguagePackLanguage(languagePacks: ILanguagePacks, locale: string | undefined): string | undefined {\n\ttry {\n\t\twhile (locale) {\n\t\t\tif (languagePacks[locale]) {\n\t\t\t\treturn locale;\n\t\t\t}\n\n\t\t\tconst index = locale.lastIndexOf('-');\n\t\t\tif (index > 0) {\n\t\t\t\tlocale = locale.substring(0, index);\n\t\t\t} else {\n\t\t\t\treturn undefined;\n\t\t\t}\n\t\t}\n\t} catch (error) {\n\t\tconsole.error('Resolving language pack configuration failed.', error);\n\t}\n\n\treturn undefined;\n}\n\nfunction defaultNLSConfiguration(userLocale: string, osLocale: string, nlsMetadataPath: string): INLSConfiguration {\n\tmark('code/didGenerateNls');\n\n\treturn {\n\t\tuserLocale,\n\t\tosLocale,\n\t\tresolvedLanguage: 'en',\n\t\tdefaultMessagesFile: join(nlsMetadataPath, 'nls.messages.json'),\n\n\t\t// NLS: below 2 are a relic from old times only used by vscode-nls and deprecated\n\t\tlocale: userLocale,\n\t\tavailableLanguages: {}\n\t};\n}\n\n//#region fs helpers\n\nfunction touch(path: string): Promise<void> {\n\tconst date = new Date();\n\n\treturn promises.utimes(path, date, date);\n}\n\n//#endregion\n"]}