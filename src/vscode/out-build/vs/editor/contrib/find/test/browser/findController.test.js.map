{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/editor/contrib/find/test/browser/findController.test.ts","vs/editor/contrib/find/test/browser/findController.test.ts"],"names":[],"mappings":"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","file":"findController.test.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport assert from 'assert';\nimport { Delayer } from '../../../../../base/common/async.js';\nimport * as platform from '../../../../../base/common/platform.js';\nimport { ensureNoDisposablesAreLeakedInTestSuite } from '../../../../../base/test/common/utils.js';\nimport { ICodeEditor } from '../../../../browser/editorBrowser.js';\nimport { EditorAction } from '../../../../browser/editorExtensions.js';\nimport { EditOperation } from '../../../../common/core/editOperation.js';\nimport { Position } from '../../../../common/core/position.js';\nimport { Range } from '../../../../common/core/range.js';\nimport { Selection } from '../../../../common/core/selection.js';\nimport { CommonFindController, FindStartFocusAction, IFindStartOptions, NextMatchFindAction, NextSelectionMatchFindAction, StartFindAction, StartFindReplaceAction, StartFindWithSelectionAction } from '../../browser/findController.js';\nimport { CONTEXT_FIND_INPUT_FOCUSED } from '../../browser/findModel.js';\nimport { withAsyncTestCodeEditor } from '../../../../test/browser/testCodeEditor.js';\nimport { IClipboardService } from '../../../../../platform/clipboard/common/clipboardService.js';\nimport { IContextKey, IContextKeyService } from '../../../../../platform/contextkey/common/contextkey.js';\nimport { IHoverService } from '../../../../../platform/hover/browser/hover.js';\nimport { IInstantiationService } from '../../../../../platform/instantiation/common/instantiation.js';\nimport { ServiceCollection } from '../../../../../platform/instantiation/common/serviceCollection.js';\nimport { INotificationService } from '../../../../../platform/notification/common/notification.js';\nimport { IStorageService, InMemoryStorageService, StorageScope, StorageTarget } from '../../../../../platform/storage/common/storage.js';\n\nclass TestFindController extends CommonFindController {\n\n\tpublic hasFocus: boolean;\n\tpublic delayUpdateHistory: boolean = false;\n\n\tprivate _findInputFocused: IContextKey<boolean>;\n\n\tconstructor(\n\t\teditor: ICodeEditor,\n\t\t@IContextKeyService contextKeyService: IContextKeyService,\n\t\t@IStorageService storageService: IStorageService,\n\t\t@IClipboardService clipboardService: IClipboardService,\n\t\t@INotificationService notificationService: INotificationService,\n\t\t@IHoverService hoverService: IHoverService\n\t) {\n\t\tsuper(editor, contextKeyService, storageService, clipboardService, notificationService, hoverService);\n\t\tthis._findInputFocused = CONTEXT_FIND_INPUT_FOCUSED.bindTo(contextKeyService);\n\t\tthis._updateHistoryDelayer = new Delayer<void>(50);\n\t\tthis.hasFocus = false;\n\t}\n\n\tprotected override async _start(opts: IFindStartOptions): Promise<void> {\n\t\tawait super._start(opts);\n\n\t\tif (opts.shouldFocus !== FindStartFocusAction.NoFocusChange) {\n\t\t\tthis.hasFocus = true;\n\t\t}\n\n\t\tconst inputFocused = opts.shouldFocus === FindStartFocusAction.FocusFindInput;\n\t\tthis._findInputFocused.set(inputFocused);\n\t}\n}\n\nfunction fromSelection(slc: Selection): number[] {\n\treturn [slc.startLineNumber, slc.startColumn, slc.endLineNumber, slc.endColumn];\n}\n\nfunction executeAction(instantiationService: IInstantiationService, editor: ICodeEditor, action: EditorAction, args?: any): Promise<void> {\n\treturn instantiationService.invokeFunction((accessor) => {\n\t\treturn Promise.resolve(action.runEditorCommand(accessor, editor, args));\n\t});\n}\n\nsuite('FindController', () => {\n\n\tensureNoDisposablesAreLeakedInTestSuite();\n\n\tlet clipboardState = '';\n\tconst serviceCollection = new ServiceCollection();\n\tserviceCollection.set(IStorageService, new InMemoryStorageService());\n\n\tif (platform.isMacintosh) {\n\t\t// eslint-disable-next-line local/code-no-any-casts\n\t\tserviceCollection.set(IClipboardService, <any>{\n\t\t\treadFindText: () => clipboardState,\n\t\t\twriteFindText: (value: any) => { clipboardState = value; }\n\t\t});\n\t}\n\n\t/* test('stores to the global clipboard buffer on start find action', async () => {\n\t\tawait withAsyncTestCodeEditor([\n\t\t\t'ABC',\n\t\t\t'ABC',\n\t\t\t'XYZ',\n\t\t\t'ABC'\n\t\t], { serviceCollection: serviceCollection }, async (editor) => {\n\t\t\tclipboardState = '';\n\t\t\tif (!platform.isMacintosh) {\n\t\t\t\tassert.ok(true);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tlet findController = editor.registerAndInstantiateContribution(TestFindController.ID, TestFindController);\n\t\t\tlet startFindAction = new StartFindAction();\n\t\t\t// I select ABC on the first line\n\t\t\teditor.setSelection(new Selection(1, 1, 1, 4));\n\t\t\t// I hit Ctrl+F to show the Find dialog\n\t\t\tstartFindAction.run(null, editor);\n\n\t\t\tassert.deepStrictEqual(findController.getGlobalBufferTerm(), findController.getState().searchString);\n\t\t\tfindController.dispose();\n\t\t});\n\t});\n\n\ttest('reads from the global clipboard buffer on next find action if buffer exists', async () => {\n\t\tawait withAsyncTestCodeEditor([\n\t\t\t'ABC',\n\t\t\t'ABC',\n\t\t\t'XYZ',\n\t\t\t'ABC'\n\t\t], { serviceCollection: serviceCollection }, async (editor) => {\n\t\t\tclipboardState = 'ABC';\n\n\t\t\tif (!platform.isMacintosh) {\n\t\t\t\tassert.ok(true);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tlet findController = editor.registerAndInstantiateContribution(TestFindController.ID, TestFindController);\n\t\t\tlet findState = findController.getState();\n\t\t\tlet nextMatchFindAction = new NextMatchFindAction();\n\n\t\t\tnextMatchFindAction.run(null, editor);\n\t\t\tassert.strictEqual(findState.searchString, 'ABC');\n\n\t\t\tassert.deepStrictEqual(fromSelection(editor.getSelection()!), [1, 1, 1, 4]);\n\n\t\t\tfindController.dispose();\n\t\t});\n\t});\n\n\ttest('writes to the global clipboard buffer when text changes', async () => {\n\t\tawait withAsyncTestCodeEditor([\n\t\t\t'ABC',\n\t\t\t'ABC',\n\t\t\t'XYZ',\n\t\t\t'ABC'\n\t\t], { serviceCollection: serviceCollection }, async (editor) => {\n\t\t\tclipboardState = '';\n\t\t\tif (!platform.isMacintosh) {\n\t\t\t\tassert.ok(true);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tlet findController = editor.registerAndInstantiateContribution(TestFindController.ID, TestFindController);\n\t\t\tlet findState = findController.getState();\n\n\t\t\tfindState.change({ searchString: 'ABC' }, true);\n\n\t\t\tassert.deepStrictEqual(findController.getGlobalBufferTerm(), 'ABC');\n\n\t\t\tfindController.dispose();\n\t\t});\n\t}); */\n\n\ttest('issue #1857: F3, Find Next, acts like \"Find Under Cursor\"', async () => {\n\t\tawait withAsyncTestCodeEditor([\n\t\t\t'ABC',\n\t\t\t'ABC',\n\t\t\t'XYZ',\n\t\t\t'ABC'\n\t\t], { serviceCollection: serviceCollection }, async (editor, _, instantiationService) => {\n\t\t\tclipboardState = '';\n\t\t\t// The cursor is at the very top, of the file, at the first ABC\n\t\t\tconst findController = editor.registerAndInstantiateContribution(TestFindController.ID, TestFindController);\n\t\t\tconst findState = findController.getState();\n\t\t\tconst nextMatchFindAction = NextMatchFindAction;\n\n\t\t\t// I hit Ctrl+F to show the Find dialog\n\t\t\tawait executeAction(instantiationService, editor, StartFindAction);\n\n\t\t\t// I type ABC.\n\t\t\tfindState.change({ searchString: 'A' }, true);\n\t\t\tfindState.change({ searchString: 'AB' }, true);\n\t\t\tfindState.change({ searchString: 'ABC' }, true);\n\n\t\t\t// The first ABC is highlighted.\n\t\t\tassert.deepStrictEqual(fromSelection(editor.getSelection()!), [1, 1, 1, 4]);\n\n\t\t\t// I hit Esc to exit the Find dialog.\n\t\t\tfindController.closeFindWidget();\n\t\t\tfindController.hasFocus = false;\n\n\t\t\t// The cursor is now at end of the first line, with ABC on that line highlighted.\n\t\t\tassert.deepStrictEqual(fromSelection(editor.getSelection()!), [1, 1, 1, 4]);\n\n\t\t\t// I hit delete to remove it and change the text to XYZ.\n\t\t\teditor.pushUndoStop();\n\t\t\teditor.executeEdits('test', [EditOperation.delete(new Range(1, 1, 1, 4))]);\n\t\t\teditor.executeEdits('test', [EditOperation.insert(new Position(1, 1), 'XYZ')]);\n\t\t\teditor.pushUndoStop();\n\n\t\t\t// At this point the text editor looks like this:\n\t\t\t//   XYZ\n\t\t\t//   ABC\n\t\t\t//   XYZ\n\t\t\t//   ABC\n\t\t\tassert.strictEqual(editor.getModel()!.getLineContent(1), 'XYZ');\n\n\t\t\t// The cursor is at end of the first line.\n\t\t\tassert.deepStrictEqual(fromSelection(editor.getSelection()!), [1, 4, 1, 4]);\n\n\t\t\t// I hit F3 to \"Find Next\" to find the next occurrence of ABC, but instead it searches for XYZ.\n\t\t\tawait editor.runAction(nextMatchFindAction);\n\n\t\t\tassert.strictEqual(findState.searchString, 'ABC');\n\t\t\tassert.strictEqual(findController.hasFocus, false);\n\n\t\t\tfindController.dispose();\n\t\t});\n\t});\n\n\ttest('issue #3090: F3 does not loop with two matches on a single line', async () => {\n\t\tawait withAsyncTestCodeEditor([\n\t\t\t'import nls = require(\\'vs/nls\\');'\n\t\t], { serviceCollection: serviceCollection }, async (editor) => {\n\t\t\tclipboardState = '';\n\t\t\tconst findController = editor.registerAndInstantiateContribution(TestFindController.ID, TestFindController);\n\t\t\tconst nextMatchFindAction = NextMatchFindAction;\n\n\t\t\teditor.setPosition({\n\t\t\t\tlineNumber: 1,\n\t\t\t\tcolumn: 9\n\t\t\t});\n\n\t\t\tawait editor.runAction(nextMatchFindAction);\n\t\t\tassert.deepStrictEqual(fromSelection(editor.getSelection()!), [1, 26, 1, 29]);\n\n\t\t\tawait editor.runAction(nextMatchFindAction);\n\t\t\tassert.deepStrictEqual(fromSelection(editor.getSelection()!), [1, 8, 1, 11]);\n\n\t\t\tfindController.dispose();\n\t\t});\n\t});\n\n\ttest('issue #6149: Auto-escape highlighted text for search and replace regex mode', async () => {\n\t\tawait withAsyncTestCodeEditor([\n\t\t\t'var x = (3 * 5)',\n\t\t\t'var y = (3 * 5)',\n\t\t\t'var z = (3  * 5)',\n\t\t], { serviceCollection: serviceCollection }, async (editor, _, instantiationService) => {\n\t\t\tclipboardState = '';\n\t\t\tconst findController = editor.registerAndInstantiateContribution(TestFindController.ID, TestFindController);\n\t\t\tconst nextMatchFindAction = NextMatchFindAction;\n\n\t\t\teditor.setSelection(new Selection(1, 9, 1, 13));\n\n\t\t\tfindController.toggleRegex();\n\t\t\tawait executeAction(instantiationService, editor, StartFindAction);\n\n\t\t\tawait editor.runAction(nextMatchFindAction);\n\t\t\tassert.deepStrictEqual(fromSelection(editor.getSelection()!), [2, 9, 2, 13]);\n\n\t\t\tawait editor.runAction(nextMatchFindAction);\n\t\t\tassert.deepStrictEqual(fromSelection(editor.getSelection()!), [1, 9, 1, 13]);\n\n\t\t\tfindController.dispose();\n\t\t});\n\t});\n\n\ttest('issue #41027: Don\\'t replace find input value on replace action if find input is active', async () => {\n\t\tawait withAsyncTestCodeEditor([\n\t\t\t'test',\n\t\t], { serviceCollection: serviceCollection }, async (editor, _, instantiationService) => {\n\t\t\tconst testRegexString = 'tes.';\n\t\t\tconst findController = editor.registerAndInstantiateContribution(TestFindController.ID, TestFindController);\n\t\t\tconst nextMatchFindAction = NextMatchFindAction;\n\n\t\t\tfindController.toggleRegex();\n\t\t\tfindController.setSearchString(testRegexString);\n\t\t\tawait findController.start({\n\t\t\t\tforceRevealReplace: false,\n\t\t\t\tseedSearchStringFromSelection: 'none',\n\t\t\t\tseedSearchStringFromNonEmptySelection: false,\n\t\t\t\tseedSearchStringFromGlobalClipboard: false,\n\t\t\t\tshouldFocus: FindStartFocusAction.FocusFindInput,\n\t\t\t\tshouldAnimate: false,\n\t\t\t\tupdateSearchScope: false,\n\t\t\t\tloop: true\n\t\t\t});\n\t\t\tawait editor.runAction(nextMatchFindAction);\n\t\t\tawait executeAction(instantiationService, editor, StartFindReplaceAction);\n\n\t\t\tassert.strictEqual(findController.getState().searchString, testRegexString);\n\n\t\t\tfindController.dispose();\n\t\t});\n\t});\n\n\ttest('issue #9043: Clear search scope when find widget is hidden', async () => {\n\t\tawait withAsyncTestCodeEditor([\n\t\t\t'var x = (3 * 5)',\n\t\t\t'var y = (3 * 5)',\n\t\t\t'var z = (3 * 5)',\n\t\t], { serviceCollection: serviceCollection }, async (editor) => {\n\t\t\tclipboardState = '';\n\t\t\tconst findController = editor.registerAndInstantiateContribution(TestFindController.ID, TestFindController);\n\t\t\tawait findController.start({\n\t\t\t\tforceRevealReplace: false,\n\t\t\t\tseedSearchStringFromSelection: 'none',\n\t\t\t\tseedSearchStringFromNonEmptySelection: false,\n\t\t\t\tseedSearchStringFromGlobalClipboard: false,\n\t\t\t\tshouldFocus: FindStartFocusAction.NoFocusChange,\n\t\t\t\tshouldAnimate: false,\n\t\t\t\tupdateSearchScope: false,\n\t\t\t\tloop: true\n\t\t\t});\n\n\t\t\tassert.strictEqual(findController.getState().searchScope, null);\n\n\t\t\tfindController.getState().change({\n\t\t\t\tsearchScope: [new Range(1, 1, 1, 5)]\n\t\t\t}, false);\n\n\t\t\tassert.deepStrictEqual(findController.getState().searchScope, [new Range(1, 1, 1, 5)]);\n\n\t\t\tfindController.closeFindWidget();\n\t\t\tassert.strictEqual(findController.getState().searchScope, null);\n\t\t});\n\t});\n\n\ttest('issue #18111: Regex replace with single space replaces with no space', async () => {\n\t\tawait withAsyncTestCodeEditor([\n\t\t\t'HRESULT OnAmbientPropertyChange(DISPID   dispid);'\n\t\t], { serviceCollection: serviceCollection }, async (editor, _, instantiationService) => {\n\t\t\tclipboardState = '';\n\t\t\tconst findController = editor.registerAndInstantiateContribution(TestFindController.ID, TestFindController);\n\n\t\t\tawait executeAction(instantiationService, editor, StartFindAction);\n\n\t\t\tfindController.getState().change({ searchString: '\\\\b\\\\s{3}\\\\b', replaceString: ' ', isRegex: true }, false);\n\t\t\tfindController.moveToNextMatch();\n\n\t\t\tassert.deepStrictEqual(editor.getSelections()!.map(fromSelection), [\n\t\t\t\t[1, 39, 1, 42]\n\t\t\t]);\n\n\t\t\tfindController.replace();\n\n\t\t\tassert.deepStrictEqual(editor.getValue(), 'HRESULT OnAmbientPropertyChange(DISPID dispid);');\n\n\t\t\tfindController.dispose();\n\t\t});\n\t});\n\n\ttest('issue #24714: Regular expression with ^ in search & replace', async () => {\n\t\tawait withAsyncTestCodeEditor([\n\t\t\t'',\n\t\t\t'line2',\n\t\t\t'line3'\n\t\t], { serviceCollection: serviceCollection }, async (editor, _, instantiationService) => {\n\t\t\tclipboardState = '';\n\t\t\tconst findController = editor.registerAndInstantiateContribution(TestFindController.ID, TestFindController);\n\n\t\t\tawait executeAction(instantiationService, editor, StartFindAction);\n\n\t\t\tfindController.getState().change({ searchString: '^', replaceString: 'x', isRegex: true }, false);\n\t\t\tfindController.moveToNextMatch();\n\n\t\t\tassert.deepStrictEqual(editor.getSelections()!.map(fromSelection), [\n\t\t\t\t[2, 1, 2, 1]\n\t\t\t]);\n\n\t\t\tfindController.replace();\n\n\t\t\tassert.deepStrictEqual(editor.getValue(), '\\nxline2\\nline3');\n\n\t\t\tfindController.dispose();\n\t\t});\n\t});\n\n\ttest('issue #38232: Find Next Selection, regex enabled', async () => {\n\t\tawait withAsyncTestCodeEditor([\n\t\t\t'([funny]',\n\t\t\t'',\n\t\t\t'([funny]'\n\t\t], { serviceCollection: serviceCollection }, async (editor) => {\n\t\t\tclipboardState = '';\n\t\t\tconst findController = editor.registerAndInstantiateContribution(TestFindController.ID, TestFindController);\n\t\t\tconst nextSelectionMatchFindAction = new NextSelectionMatchFindAction();\n\n\t\t\t// toggle regex\n\t\t\tfindController.getState().change({ isRegex: true }, false);\n\n\t\t\t// change selection\n\t\t\teditor.setSelection(new Selection(1, 1, 1, 9));\n\n\t\t\t// cmd+f3\n\t\t\tawait editor.runAction(nextSelectionMatchFindAction);\n\n\t\t\tassert.deepStrictEqual(editor.getSelections()!.map(fromSelection), [\n\t\t\t\t[3, 1, 3, 9]\n\t\t\t]);\n\n\t\t\tfindController.dispose();\n\t\t});\n\t});\n\n\ttest('issue #38232: Find Next Selection, regex enabled, find widget open', async () => {\n\t\tawait withAsyncTestCodeEditor([\n\t\t\t'([funny]',\n\t\t\t'',\n\t\t\t'([funny]'\n\t\t], { serviceCollection: serviceCollection }, async (editor, _, instantiationService) => {\n\t\t\tclipboardState = '';\n\t\t\tconst findController = editor.registerAndInstantiateContribution(TestFindController.ID, TestFindController);\n\t\t\tconst nextSelectionMatchFindAction = new NextSelectionMatchFindAction();\n\n\t\t\t// cmd+f - open find widget\n\t\t\tawait executeAction(instantiationService, editor, StartFindAction);\n\n\t\t\t// toggle regex\n\t\t\tfindController.getState().change({ isRegex: true }, false);\n\n\t\t\t// change selection\n\t\t\teditor.setSelection(new Selection(1, 1, 1, 9));\n\n\t\t\t// cmd+f3\n\t\t\tawait editor.runAction(nextSelectionMatchFindAction);\n\n\t\t\tassert.deepStrictEqual(editor.getSelections()!.map(fromSelection), [\n\t\t\t\t[3, 1, 3, 9]\n\t\t\t]);\n\n\t\t\tfindController.dispose();\n\t\t});\n\t});\n\n\ttest('issue #47400, CMD+E supports feeding multiple line of text into the find widget', async () => {\n\t\tawait withAsyncTestCodeEditor([\n\t\t\t'ABC',\n\t\t\t'ABC',\n\t\t\t'XYZ',\n\t\t\t'ABC',\n\t\t\t'ABC'\n\t\t], { serviceCollection: serviceCollection }, async (editor, _, instantiationService) => {\n\t\t\tclipboardState = '';\n\t\t\tconst findController = editor.registerAndInstantiateContribution(TestFindController.ID, TestFindController);\n\n\t\t\t// change selection\n\t\t\teditor.setSelection(new Selection(1, 1, 1, 1));\n\n\t\t\t// cmd+f - open find widget\n\t\t\tawait executeAction(instantiationService, editor, StartFindAction);\n\n\t\t\teditor.setSelection(new Selection(1, 1, 2, 4));\n\t\t\tconst startFindWithSelectionAction = new StartFindWithSelectionAction();\n\t\t\tawait editor.runAction(startFindWithSelectionAction);\n\t\t\tconst findState = findController.getState();\n\n\t\t\tassert.deepStrictEqual(findState.searchString.split(/\\r\\n|\\r|\\n/g), ['ABC', 'ABC']);\n\n\t\t\teditor.setSelection(new Selection(3, 1, 3, 1));\n\t\t\tawait editor.runAction(startFindWithSelectionAction);\n\n\t\t\tfindController.dispose();\n\t\t});\n\t});\n\n\ttest('issue #109756, CMD+E with empty cursor should always work', async () => {\n\t\tawait withAsyncTestCodeEditor([\n\t\t\t'ABC',\n\t\t\t'ABC',\n\t\t\t'XYZ',\n\t\t\t'ABC',\n\t\t\t'ABC'\n\t\t], { serviceCollection: serviceCollection }, async (editor) => {\n\t\t\tclipboardState = '';\n\t\t\tconst findController = editor.registerAndInstantiateContribution(TestFindController.ID, TestFindController);\n\t\t\teditor.setSelection(new Selection(1, 2, 1, 2));\n\n\t\t\tconst startFindWithSelectionAction = new StartFindWithSelectionAction();\n\t\t\teditor.runAction(startFindWithSelectionAction);\n\n\t\t\tconst findState = findController.getState();\n\t\t\tassert.deepStrictEqual(findState.searchString, 'ABC');\n\t\t\tfindController.dispose();\n\t\t});\n\t});\n});\n\nsuite('FindController query options persistence', () => {\n\n\tensureNoDisposablesAreLeakedInTestSuite();\n\n\tconst serviceCollection = new ServiceCollection();\n\tconst storageService = new InMemoryStorageService();\n\tstorageService.store('editor.isRegex', false, StorageScope.WORKSPACE, StorageTarget.USER);\n\tstorageService.store('editor.matchCase', false, StorageScope.WORKSPACE, StorageTarget.USER);\n\tstorageService.store('editor.wholeWord', false, StorageScope.WORKSPACE, StorageTarget.USER);\n\tserviceCollection.set(IStorageService, storageService);\n\n\ttest('matchCase', async () => {\n\t\tawait withAsyncTestCodeEditor([\n\t\t\t'abc',\n\t\t\t'ABC',\n\t\t\t'XYZ',\n\t\t\t'ABC'\n\t\t], { serviceCollection: serviceCollection }, async (editor, _, instantiationService) => {\n\t\t\tstorageService.store('editor.matchCase', true, StorageScope.WORKSPACE, StorageTarget.USER);\n\t\t\t// The cursor is at the very top, of the file, at the first ABC\n\t\t\tconst findController = editor.registerAndInstantiateContribution(TestFindController.ID, TestFindController);\n\t\t\tconst findState = findController.getState();\n\n\t\t\t// I hit Ctrl+F to show the Find dialog\n\t\t\tawait executeAction(instantiationService, editor, StartFindAction);\n\n\t\t\t// I type ABC.\n\t\t\tfindState.change({ searchString: 'ABC' }, true);\n\t\t\t// The second ABC is highlighted as matchCase is true.\n\t\t\tassert.deepStrictEqual(fromSelection(editor.getSelection()!), [2, 1, 2, 4]);\n\n\t\t\tfindController.dispose();\n\t\t});\n\t});\n\n\tstorageService.store('editor.matchCase', false, StorageScope.WORKSPACE, StorageTarget.USER);\n\tstorageService.store('editor.wholeWord', true, StorageScope.WORKSPACE, StorageTarget.USER);\n\n\ttest('wholeWord', async () => {\n\t\tawait withAsyncTestCodeEditor([\n\t\t\t'ABC',\n\t\t\t'AB',\n\t\t\t'XYZ',\n\t\t\t'ABC'\n\t\t], { serviceCollection: serviceCollection }, async (editor, _, instantiationService) => {\n\t\t\t// The cursor is at the very top, of the file, at the first ABC\n\t\t\tconst findController = editor.registerAndInstantiateContribution(TestFindController.ID, TestFindController);\n\t\t\tconst findState = findController.getState();\n\n\t\t\t// I hit Ctrl+F to show the Find dialog\n\t\t\tawait executeAction(instantiationService, editor, StartFindAction);\n\n\t\t\t// I type AB.\n\t\t\tfindState.change({ searchString: 'AB' }, true);\n\t\t\t// The second AB is highlighted as wholeWord is true.\n\t\t\tassert.deepStrictEqual(fromSelection(editor.getSelection()!), [2, 1, 2, 3]);\n\n\t\t\tfindController.dispose();\n\t\t});\n\t});\n\n\ttest('toggling options is saved', async () => {\n\t\tawait withAsyncTestCodeEditor([\n\t\t\t'ABC',\n\t\t\t'AB',\n\t\t\t'XYZ',\n\t\t\t'ABC'\n\t\t], { serviceCollection: serviceCollection }, async (editor) => {\n\t\t\t// The cursor is at the very top, of the file, at the first ABC\n\t\t\tconst findController = editor.registerAndInstantiateContribution(TestFindController.ID, TestFindController);\n\t\t\tfindController.toggleRegex();\n\t\t\tassert.strictEqual(storageService.getBoolean('editor.isRegex', StorageScope.WORKSPACE), true);\n\n\t\t\tfindController.dispose();\n\t\t});\n\t});\n\n\ttest('issue #27083: Update search scope once find widget becomes visible', async () => {\n\t\tawait withAsyncTestCodeEditor([\n\t\t\t'var x = (3 * 5)',\n\t\t\t'var y = (3 * 5)',\n\t\t\t'var z = (3 * 5)',\n\t\t], { serviceCollection: serviceCollection, find: { autoFindInSelection: 'always', globalFindClipboard: false } }, async (editor) => {\n\t\t\t// clipboardState = '';\n\t\t\tconst findController = editor.registerAndInstantiateContribution(TestFindController.ID, TestFindController);\n\t\t\tconst findConfig: IFindStartOptions = {\n\t\t\t\tforceRevealReplace: false,\n\t\t\t\tseedSearchStringFromSelection: 'none',\n\t\t\t\tseedSearchStringFromNonEmptySelection: false,\n\t\t\t\tseedSearchStringFromGlobalClipboard: false,\n\t\t\t\tshouldFocus: FindStartFocusAction.NoFocusChange,\n\t\t\t\tshouldAnimate: false,\n\t\t\t\tupdateSearchScope: true,\n\t\t\t\tloop: true\n\t\t\t};\n\n\t\t\teditor.setSelection(new Range(1, 1, 2, 1));\n\t\t\tfindController.start(findConfig);\n\t\t\tassert.deepStrictEqual(findController.getState().searchScope, [new Selection(1, 1, 2, 1)]);\n\n\t\t\tfindController.closeFindWidget();\n\n\t\t\teditor.setSelections([new Selection(1, 1, 2, 1), new Selection(2, 1, 2, 5)]);\n\t\t\tfindController.start(findConfig);\n\t\t\tassert.deepStrictEqual(findController.getState().searchScope, [new Selection(1, 1, 2, 1), new Selection(2, 1, 2, 5)]);\n\t\t});\n\t});\n\n\ttest('issue #58604: Do not update searchScope if it is empty', async () => {\n\t\tawait withAsyncTestCodeEditor([\n\t\t\t'var x = (3 * 5)',\n\t\t\t'var y = (3 * 5)',\n\t\t\t'var z = (3 * 5)',\n\t\t], { serviceCollection: serviceCollection, find: { autoFindInSelection: 'always', globalFindClipboard: false } }, async (editor) => {\n\t\t\t// clipboardState = '';\n\t\t\teditor.setSelection(new Range(1, 2, 1, 2));\n\t\t\tconst findController = editor.registerAndInstantiateContribution(TestFindController.ID, TestFindController);\n\n\t\t\tawait findController.start({\n\t\t\t\tforceRevealReplace: false,\n\t\t\t\tseedSearchStringFromSelection: 'none',\n\t\t\t\tseedSearchStringFromNonEmptySelection: false,\n\t\t\t\tseedSearchStringFromGlobalClipboard: false,\n\t\t\t\tshouldFocus: FindStartFocusAction.NoFocusChange,\n\t\t\t\tshouldAnimate: false,\n\t\t\t\tupdateSearchScope: true,\n\t\t\t\tloop: true\n\t\t\t});\n\n\t\t\tassert.deepStrictEqual(findController.getState().searchScope, null);\n\t\t});\n\t});\n\n\ttest('issue #58604: Update searchScope if it is not empty', async () => {\n\t\tawait withAsyncTestCodeEditor([\n\t\t\t'var x = (3 * 5)',\n\t\t\t'var y = (3 * 5)',\n\t\t\t'var z = (3 * 5)',\n\t\t], { serviceCollection: serviceCollection, find: { autoFindInSelection: 'always', globalFindClipboard: false } }, async (editor) => {\n\t\t\t// clipboardState = '';\n\t\t\teditor.setSelection(new Range(1, 2, 1, 3));\n\t\t\tconst findController = editor.registerAndInstantiateContribution(TestFindController.ID, TestFindController);\n\n\t\t\tawait findController.start({\n\t\t\t\tforceRevealReplace: false,\n\t\t\t\tseedSearchStringFromSelection: 'none',\n\t\t\t\tseedSearchStringFromNonEmptySelection: false,\n\t\t\t\tseedSearchStringFromGlobalClipboard: false,\n\t\t\t\tshouldFocus: FindStartFocusAction.NoFocusChange,\n\t\t\t\tshouldAnimate: false,\n\t\t\t\tupdateSearchScope: true,\n\t\t\t\tloop: true\n\t\t\t});\n\n\t\t\tassert.deepStrictEqual(findController.getState().searchScope, [new Selection(1, 2, 1, 3)]);\n\t\t});\n\t});\n\n\n\ttest('issue #27083: Find in selection when multiple lines are selected', async () => {\n\t\tawait withAsyncTestCodeEditor([\n\t\t\t'var x = (3 * 5)',\n\t\t\t'var y = (3 * 5)',\n\t\t\t'var z = (3 * 5)',\n\t\t], { serviceCollection: serviceCollection, find: { autoFindInSelection: 'multiline', globalFindClipboard: false } }, async (editor) => {\n\t\t\t// clipboardState = '';\n\t\t\teditor.setSelection(new Range(1, 6, 2, 1));\n\t\t\tconst findController = editor.registerAndInstantiateContribution(TestFindController.ID, TestFindController);\n\n\t\t\tawait findController.start({\n\t\t\t\tforceRevealReplace: false,\n\t\t\t\tseedSearchStringFromSelection: 'none',\n\t\t\t\tseedSearchStringFromNonEmptySelection: false,\n\t\t\t\tseedSearchStringFromGlobalClipboard: false,\n\t\t\t\tshouldFocus: FindStartFocusAction.NoFocusChange,\n\t\t\t\tshouldAnimate: false,\n\t\t\t\tupdateSearchScope: true,\n\t\t\t\tloop: true\n\t\t\t});\n\n\t\t\tassert.deepStrictEqual(findController.getState().searchScope, [new Selection(1, 6, 2, 1)]);\n\t\t});\n\t});\n});\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport assert from 'assert';\nimport { Delayer } from '../../../../../base/common/async.js';\nimport * as platform from '../../../../../base/common/platform.js';\nimport { ensureNoDisposablesAreLeakedInTestSuite } from '../../../../../base/test/common/utils.js';\nimport { ICodeEditor } from '../../../../browser/editorBrowser.js';\nimport { EditorAction } from '../../../../browser/editorExtensions.js';\nimport { EditOperation } from '../../../../common/core/editOperation.js';\nimport { Position } from '../../../../common/core/position.js';\nimport { Range } from '../../../../common/core/range.js';\nimport { Selection } from '../../../../common/core/selection.js';\nimport { CommonFindController, FindStartFocusAction, IFindStartOptions, NextMatchFindAction, NextSelectionMatchFindAction, StartFindAction, StartFindReplaceAction, StartFindWithSelectionAction } from '../../browser/findController.js';\nimport { CONTEXT_FIND_INPUT_FOCUSED } from '../../browser/findModel.js';\nimport { withAsyncTestCodeEditor } from '../../../../test/browser/testCodeEditor.js';\nimport { IClipboardService } from '../../../../../platform/clipboard/common/clipboardService.js';\nimport { IContextKey, IContextKeyService } from '../../../../../platform/contextkey/common/contextkey.js';\nimport { IHoverService } from '../../../../../platform/hover/browser/hover.js';\nimport { IInstantiationService } from '../../../../../platform/instantiation/common/instantiation.js';\nimport { ServiceCollection } from '../../../../../platform/instantiation/common/serviceCollection.js';\nimport { INotificationService } from '../../../../../platform/notification/common/notification.js';\nimport { IStorageService, InMemoryStorageService, StorageScope, StorageTarget } from '../../../../../platform/storage/common/storage.js';\n\nclass TestFindController extends CommonFindController {\n\n\tpublic hasFocus: boolean;\n\tpublic delayUpdateHistory: boolean = false;\n\n\tprivate _findInputFocused: IContextKey<boolean>;\n\n\tconstructor(\n\t\teditor: ICodeEditor,\n\t\t@IContextKeyService contextKeyService: IContextKeyService,\n\t\t@IStorageService storageService: IStorageService,\n\t\t@IClipboardService clipboardService: IClipboardService,\n\t\t@INotificationService notificationService: INotificationService,\n\t\t@IHoverService hoverService: IHoverService\n\t) {\n\t\tsuper(editor, contextKeyService, storageService, clipboardService, notificationService, hoverService);\n\t\tthis._findInputFocused = CONTEXT_FIND_INPUT_FOCUSED.bindTo(contextKeyService);\n\t\tthis._updateHistoryDelayer = new Delayer<void>(50);\n\t\tthis.hasFocus = false;\n\t}\n\n\tprotected override async _start(opts: IFindStartOptions): Promise<void> {\n\t\tawait super._start(opts);\n\n\t\tif (opts.shouldFocus !== FindStartFocusAction.NoFocusChange) {\n\t\t\tthis.hasFocus = true;\n\t\t}\n\n\t\tconst inputFocused = opts.shouldFocus === FindStartFocusAction.FocusFindInput;\n\t\tthis._findInputFocused.set(inputFocused);\n\t}\n}\n\nfunction fromSelection(slc: Selection): number[] {\n\treturn [slc.startLineNumber, slc.startColumn, slc.endLineNumber, slc.endColumn];\n}\n\nfunction executeAction(instantiationService: IInstantiationService, editor: ICodeEditor, action: EditorAction, args?: any): Promise<void> {\n\treturn instantiationService.invokeFunction((accessor) => {\n\t\treturn Promise.resolve(action.runEditorCommand(accessor, editor, args));\n\t});\n}\n\nsuite('FindController', () => {\n\n\tensureNoDisposablesAreLeakedInTestSuite();\n\n\tlet clipboardState = '';\n\tconst serviceCollection = new ServiceCollection();\n\tserviceCollection.set(IStorageService, new InMemoryStorageService());\n\n\tif (platform.isMacintosh) {\n\t\t// eslint-disable-next-line local/code-no-any-casts\n\t\tserviceCollection.set(IClipboardService, <any>{\n\t\t\treadFindText: () => clipboardState,\n\t\t\twriteFindText: (value: any) => { clipboardState = value; }\n\t\t});\n\t}\n\n\t/* test('stores to the global clipboard buffer on start find action', async () => {\n\t\tawait withAsyncTestCodeEditor([\n\t\t\t'ABC',\n\t\t\t'ABC',\n\t\t\t'XYZ',\n\t\t\t'ABC'\n\t\t], { serviceCollection: serviceCollection }, async (editor) => {\n\t\t\tclipboardState = '';\n\t\t\tif (!platform.isMacintosh) {\n\t\t\t\tassert.ok(true);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tlet findController = editor.registerAndInstantiateContribution(TestFindController.ID, TestFindController);\n\t\t\tlet startFindAction = new StartFindAction();\n\t\t\t// I select ABC on the first line\n\t\t\teditor.setSelection(new Selection(1, 1, 1, 4));\n\t\t\t// I hit Ctrl+F to show the Find dialog\n\t\t\tstartFindAction.run(null, editor);\n\n\t\t\tassert.deepStrictEqual(findController.getGlobalBufferTerm(), findController.getState().searchString);\n\t\t\tfindController.dispose();\n\t\t});\n\t});\n\n\ttest('reads from the global clipboard buffer on next find action if buffer exists', async () => {\n\t\tawait withAsyncTestCodeEditor([\n\t\t\t'ABC',\n\t\t\t'ABC',\n\t\t\t'XYZ',\n\t\t\t'ABC'\n\t\t], { serviceCollection: serviceCollection }, async (editor) => {\n\t\t\tclipboardState = 'ABC';\n\n\t\t\tif (!platform.isMacintosh) {\n\t\t\t\tassert.ok(true);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tlet findController = editor.registerAndInstantiateContribution(TestFindController.ID, TestFindController);\n\t\t\tlet findState = findController.getState();\n\t\t\tlet nextMatchFindAction = new NextMatchFindAction();\n\n\t\t\tnextMatchFindAction.run(null, editor);\n\t\t\tassert.strictEqual(findState.searchString, 'ABC');\n\n\t\t\tassert.deepStrictEqual(fromSelection(editor.getSelection()!), [1, 1, 1, 4]);\n\n\t\t\tfindController.dispose();\n\t\t});\n\t});\n\n\ttest('writes to the global clipboard buffer when text changes', async () => {\n\t\tawait withAsyncTestCodeEditor([\n\t\t\t'ABC',\n\t\t\t'ABC',\n\t\t\t'XYZ',\n\t\t\t'ABC'\n\t\t], { serviceCollection: serviceCollection }, async (editor) => {\n\t\t\tclipboardState = '';\n\t\t\tif (!platform.isMacintosh) {\n\t\t\t\tassert.ok(true);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tlet findController = editor.registerAndInstantiateContribution(TestFindController.ID, TestFindController);\n\t\t\tlet findState = findController.getState();\n\n\t\t\tfindState.change({ searchString: 'ABC' }, true);\n\n\t\t\tassert.deepStrictEqual(findController.getGlobalBufferTerm(), 'ABC');\n\n\t\t\tfindController.dispose();\n\t\t});\n\t}); */\n\n\ttest('issue #1857: F3, Find Next, acts like \"Find Under Cursor\"', async () => {\n\t\tawait withAsyncTestCodeEditor([\n\t\t\t'ABC',\n\t\t\t'ABC',\n\t\t\t'XYZ',\n\t\t\t'ABC'\n\t\t], { serviceCollection: serviceCollection }, async (editor, _, instantiationService) => {\n\t\t\tclipboardState = '';\n\t\t\t// The cursor is at the very top, of the file, at the first ABC\n\t\t\tconst findController = editor.registerAndInstantiateContribution(TestFindController.ID, TestFindController);\n\t\t\tconst findState = findController.getState();\n\t\t\tconst nextMatchFindAction = NextMatchFindAction;\n\n\t\t\t// I hit Ctrl+F to show the Find dialog\n\t\t\tawait executeAction(instantiationService, editor, StartFindAction);\n\n\t\t\t// I type ABC.\n\t\t\tfindState.change({ searchString: 'A' }, true);\n\t\t\tfindState.change({ searchString: 'AB' }, true);\n\t\t\tfindState.change({ searchString: 'ABC' }, true);\n\n\t\t\t// The first ABC is highlighted.\n\t\t\tassert.deepStrictEqual(fromSelection(editor.getSelection()!), [1, 1, 1, 4]);\n\n\t\t\t// I hit Esc to exit the Find dialog.\n\t\t\tfindController.closeFindWidget();\n\t\t\tfindController.hasFocus = false;\n\n\t\t\t// The cursor is now at end of the first line, with ABC on that line highlighted.\n\t\t\tassert.deepStrictEqual(fromSelection(editor.getSelection()!), [1, 1, 1, 4]);\n\n\t\t\t// I hit delete to remove it and change the text to XYZ.\n\t\t\teditor.pushUndoStop();\n\t\t\teditor.executeEdits('test', [EditOperation.delete(new Range(1, 1, 1, 4))]);\n\t\t\teditor.executeEdits('test', [EditOperation.insert(new Position(1, 1), 'XYZ')]);\n\t\t\teditor.pushUndoStop();\n\n\t\t\t// At this point the text editor looks like this:\n\t\t\t//   XYZ\n\t\t\t//   ABC\n\t\t\t//   XYZ\n\t\t\t//   ABC\n\t\t\tassert.strictEqual(editor.getModel()!.getLineContent(1), 'XYZ');\n\n\t\t\t// The cursor is at end of the first line.\n\t\t\tassert.deepStrictEqual(fromSelection(editor.getSelection()!), [1, 4, 1, 4]);\n\n\t\t\t// I hit F3 to \"Find Next\" to find the next occurrence of ABC, but instead it searches for XYZ.\n\t\t\tawait editor.runAction(nextMatchFindAction);\n\n\t\t\tassert.strictEqual(findState.searchString, 'ABC');\n\t\t\tassert.strictEqual(findController.hasFocus, false);\n\n\t\t\tfindController.dispose();\n\t\t});\n\t});\n\n\ttest('issue #3090: F3 does not loop with two matches on a single line', async () => {\n\t\tawait withAsyncTestCodeEditor([\n\t\t\t'import nls = require(\\'vs/nls\\');'\n\t\t], { serviceCollection: serviceCollection }, async (editor) => {\n\t\t\tclipboardState = '';\n\t\t\tconst findController = editor.registerAndInstantiateContribution(TestFindController.ID, TestFindController);\n\t\t\tconst nextMatchFindAction = NextMatchFindAction;\n\n\t\t\teditor.setPosition({\n\t\t\t\tlineNumber: 1,\n\t\t\t\tcolumn: 9\n\t\t\t});\n\n\t\t\tawait editor.runAction(nextMatchFindAction);\n\t\t\tassert.deepStrictEqual(fromSelection(editor.getSelection()!), [1, 26, 1, 29]);\n\n\t\t\tawait editor.runAction(nextMatchFindAction);\n\t\t\tassert.deepStrictEqual(fromSelection(editor.getSelection()!), [1, 8, 1, 11]);\n\n\t\t\tfindController.dispose();\n\t\t});\n\t});\n\n\ttest('issue #6149: Auto-escape highlighted text for search and replace regex mode', async () => {\n\t\tawait withAsyncTestCodeEditor([\n\t\t\t'var x = (3 * 5)',\n\t\t\t'var y = (3 * 5)',\n\t\t\t'var z = (3  * 5)',\n\t\t], { serviceCollection: serviceCollection }, async (editor, _, instantiationService) => {\n\t\t\tclipboardState = '';\n\t\t\tconst findController = editor.registerAndInstantiateContribution(TestFindController.ID, TestFindController);\n\t\t\tconst nextMatchFindAction = NextMatchFindAction;\n\n\t\t\teditor.setSelection(new Selection(1, 9, 1, 13));\n\n\t\t\tfindController.toggleRegex();\n\t\t\tawait executeAction(instantiationService, editor, StartFindAction);\n\n\t\t\tawait editor.runAction(nextMatchFindAction);\n\t\t\tassert.deepStrictEqual(fromSelection(editor.getSelection()!), [2, 9, 2, 13]);\n\n\t\t\tawait editor.runAction(nextMatchFindAction);\n\t\t\tassert.deepStrictEqual(fromSelection(editor.getSelection()!), [1, 9, 1, 13]);\n\n\t\t\tfindController.dispose();\n\t\t});\n\t});\n\n\ttest('issue #41027: Don\\'t replace find input value on replace action if find input is active', async () => {\n\t\tawait withAsyncTestCodeEditor([\n\t\t\t'test',\n\t\t], { serviceCollection: serviceCollection }, async (editor, _, instantiationService) => {\n\t\t\tconst testRegexString = 'tes.';\n\t\t\tconst findController = editor.registerAndInstantiateContribution(TestFindController.ID, TestFindController);\n\t\t\tconst nextMatchFindAction = NextMatchFindAction;\n\n\t\t\tfindController.toggleRegex();\n\t\t\tfindController.setSearchString(testRegexString);\n\t\t\tawait findController.start({\n\t\t\t\tforceRevealReplace: false,\n\t\t\t\tseedSearchStringFromSelection: 'none',\n\t\t\t\tseedSearchStringFromNonEmptySelection: false,\n\t\t\t\tseedSearchStringFromGlobalClipboard: false,\n\t\t\t\tshouldFocus: FindStartFocusAction.FocusFindInput,\n\t\t\t\tshouldAnimate: false,\n\t\t\t\tupdateSearchScope: false,\n\t\t\t\tloop: true\n\t\t\t});\n\t\t\tawait editor.runAction(nextMatchFindAction);\n\t\t\tawait executeAction(instantiationService, editor, StartFindReplaceAction);\n\n\t\t\tassert.strictEqual(findController.getState().searchString, testRegexString);\n\n\t\t\tfindController.dispose();\n\t\t});\n\t});\n\n\ttest('issue #9043: Clear search scope when find widget is hidden', async () => {\n\t\tawait withAsyncTestCodeEditor([\n\t\t\t'var x = (3 * 5)',\n\t\t\t'var y = (3 * 5)',\n\t\t\t'var z = (3 * 5)',\n\t\t], { serviceCollection: serviceCollection }, async (editor) => {\n\t\t\tclipboardState = '';\n\t\t\tconst findController = editor.registerAndInstantiateContribution(TestFindController.ID, TestFindController);\n\t\t\tawait findController.start({\n\t\t\t\tforceRevealReplace: false,\n\t\t\t\tseedSearchStringFromSelection: 'none',\n\t\t\t\tseedSearchStringFromNonEmptySelection: false,\n\t\t\t\tseedSearchStringFromGlobalClipboard: false,\n\t\t\t\tshouldFocus: FindStartFocusAction.NoFocusChange,\n\t\t\t\tshouldAnimate: false,\n\t\t\t\tupdateSearchScope: false,\n\t\t\t\tloop: true\n\t\t\t});\n\n\t\t\tassert.strictEqual(findController.getState().searchScope, null);\n\n\t\t\tfindController.getState().change({\n\t\t\t\tsearchScope: [new Range(1, 1, 1, 5)]\n\t\t\t}, false);\n\n\t\t\tassert.deepStrictEqual(findController.getState().searchScope, [new Range(1, 1, 1, 5)]);\n\n\t\t\tfindController.closeFindWidget();\n\t\t\tassert.strictEqual(findController.getState().searchScope, null);\n\t\t});\n\t});\n\n\ttest('issue #18111: Regex replace with single space replaces with no space', async () => {\n\t\tawait withAsyncTestCodeEditor([\n\t\t\t'HRESULT OnAmbientPropertyChange(DISPID   dispid);'\n\t\t], { serviceCollection: serviceCollection }, async (editor, _, instantiationService) => {\n\t\t\tclipboardState = '';\n\t\t\tconst findController = editor.registerAndInstantiateContribution(TestFindController.ID, TestFindController);\n\n\t\t\tawait executeAction(instantiationService, editor, StartFindAction);\n\n\t\t\tfindController.getState().change({ searchString: '\\\\b\\\\s{3}\\\\b', replaceString: ' ', isRegex: true }, false);\n\t\t\tfindController.moveToNextMatch();\n\n\t\t\tassert.deepStrictEqual(editor.getSelections()!.map(fromSelection), [\n\t\t\t\t[1, 39, 1, 42]\n\t\t\t]);\n\n\t\t\tfindController.replace();\n\n\t\t\tassert.deepStrictEqual(editor.getValue(), 'HRESULT OnAmbientPropertyChange(DISPID dispid);');\n\n\t\t\tfindController.dispose();\n\t\t});\n\t});\n\n\ttest('issue #24714: Regular expression with ^ in search & replace', async () => {\n\t\tawait withAsyncTestCodeEditor([\n\t\t\t'',\n\t\t\t'line2',\n\t\t\t'line3'\n\t\t], { serviceCollection: serviceCollection }, async (editor, _, instantiationService) => {\n\t\t\tclipboardState = '';\n\t\t\tconst findController = editor.registerAndInstantiateContribution(TestFindController.ID, TestFindController);\n\n\t\t\tawait executeAction(instantiationService, editor, StartFindAction);\n\n\t\t\tfindController.getState().change({ searchString: '^', replaceString: 'x', isRegex: true }, false);\n\t\t\tfindController.moveToNextMatch();\n\n\t\t\tassert.deepStrictEqual(editor.getSelections()!.map(fromSelection), [\n\t\t\t\t[2, 1, 2, 1]\n\t\t\t]);\n\n\t\t\tfindController.replace();\n\n\t\t\tassert.deepStrictEqual(editor.getValue(), '\\nxline2\\nline3');\n\n\t\t\tfindController.dispose();\n\t\t});\n\t});\n\n\ttest('issue #38232: Find Next Selection, regex enabled', async () => {\n\t\tawait withAsyncTestCodeEditor([\n\t\t\t'([funny]',\n\t\t\t'',\n\t\t\t'([funny]'\n\t\t], { serviceCollection: serviceCollection }, async (editor) => {\n\t\t\tclipboardState = '';\n\t\t\tconst findController = editor.registerAndInstantiateContribution(TestFindController.ID, TestFindController);\n\t\t\tconst nextSelectionMatchFindAction = new NextSelectionMatchFindAction();\n\n\t\t\t// toggle regex\n\t\t\tfindController.getState().change({ isRegex: true }, false);\n\n\t\t\t// change selection\n\t\t\teditor.setSelection(new Selection(1, 1, 1, 9));\n\n\t\t\t// cmd+f3\n\t\t\tawait editor.runAction(nextSelectionMatchFindAction);\n\n\t\t\tassert.deepStrictEqual(editor.getSelections()!.map(fromSelection), [\n\t\t\t\t[3, 1, 3, 9]\n\t\t\t]);\n\n\t\t\tfindController.dispose();\n\t\t});\n\t});\n\n\ttest('issue #38232: Find Next Selection, regex enabled, find widget open', async () => {\n\t\tawait withAsyncTestCodeEditor([\n\t\t\t'([funny]',\n\t\t\t'',\n\t\t\t'([funny]'\n\t\t], { serviceCollection: serviceCollection }, async (editor, _, instantiationService) => {\n\t\t\tclipboardState = '';\n\t\t\tconst findController = editor.registerAndInstantiateContribution(TestFindController.ID, TestFindController);\n\t\t\tconst nextSelectionMatchFindAction = new NextSelectionMatchFindAction();\n\n\t\t\t// cmd+f - open find widget\n\t\t\tawait executeAction(instantiationService, editor, StartFindAction);\n\n\t\t\t// toggle regex\n\t\t\tfindController.getState().change({ isRegex: true }, false);\n\n\t\t\t// change selection\n\t\t\teditor.setSelection(new Selection(1, 1, 1, 9));\n\n\t\t\t// cmd+f3\n\t\t\tawait editor.runAction(nextSelectionMatchFindAction);\n\n\t\t\tassert.deepStrictEqual(editor.getSelections()!.map(fromSelection), [\n\t\t\t\t[3, 1, 3, 9]\n\t\t\t]);\n\n\t\t\tfindController.dispose();\n\t\t});\n\t});\n\n\ttest('issue #47400, CMD+E supports feeding multiple line of text into the find widget', async () => {\n\t\tawait withAsyncTestCodeEditor([\n\t\t\t'ABC',\n\t\t\t'ABC',\n\t\t\t'XYZ',\n\t\t\t'ABC',\n\t\t\t'ABC'\n\t\t], { serviceCollection: serviceCollection }, async (editor, _, instantiationService) => {\n\t\t\tclipboardState = '';\n\t\t\tconst findController = editor.registerAndInstantiateContribution(TestFindController.ID, TestFindController);\n\n\t\t\t// change selection\n\t\t\teditor.setSelection(new Selection(1, 1, 1, 1));\n\n\t\t\t// cmd+f - open find widget\n\t\t\tawait executeAction(instantiationService, editor, StartFindAction);\n\n\t\t\teditor.setSelection(new Selection(1, 1, 2, 4));\n\t\t\tconst startFindWithSelectionAction = new StartFindWithSelectionAction();\n\t\t\tawait editor.runAction(startFindWithSelectionAction);\n\t\t\tconst findState = findController.getState();\n\n\t\t\tassert.deepStrictEqual(findState.searchString.split(/\\r\\n|\\r|\\n/g), ['ABC', 'ABC']);\n\n\t\t\teditor.setSelection(new Selection(3, 1, 3, 1));\n\t\t\tawait editor.runAction(startFindWithSelectionAction);\n\n\t\t\tfindController.dispose();\n\t\t});\n\t});\n\n\ttest('issue #109756, CMD+E with empty cursor should always work', async () => {\n\t\tawait withAsyncTestCodeEditor([\n\t\t\t'ABC',\n\t\t\t'ABC',\n\t\t\t'XYZ',\n\t\t\t'ABC',\n\t\t\t'ABC'\n\t\t], { serviceCollection: serviceCollection }, async (editor) => {\n\t\t\tclipboardState = '';\n\t\t\tconst findController = editor.registerAndInstantiateContribution(TestFindController.ID, TestFindController);\n\t\t\teditor.setSelection(new Selection(1, 2, 1, 2));\n\n\t\t\tconst startFindWithSelectionAction = new StartFindWithSelectionAction();\n\t\t\teditor.runAction(startFindWithSelectionAction);\n\n\t\t\tconst findState = findController.getState();\n\t\t\tassert.deepStrictEqual(findState.searchString, 'ABC');\n\t\t\tfindController.dispose();\n\t\t});\n\t});\n});\n\nsuite('FindController query options persistence', () => {\n\n\tensureNoDisposablesAreLeakedInTestSuite();\n\n\tconst serviceCollection = new ServiceCollection();\n\tconst storageService = new InMemoryStorageService();\n\tstorageService.store('editor.isRegex', false, StorageScope.WORKSPACE, StorageTarget.USER);\n\tstorageService.store('editor.matchCase', false, StorageScope.WORKSPACE, StorageTarget.USER);\n\tstorageService.store('editor.wholeWord', false, StorageScope.WORKSPACE, StorageTarget.USER);\n\tserviceCollection.set(IStorageService, storageService);\n\n\ttest('matchCase', async () => {\n\t\tawait withAsyncTestCodeEditor([\n\t\t\t'abc',\n\t\t\t'ABC',\n\t\t\t'XYZ',\n\t\t\t'ABC'\n\t\t], { serviceCollection: serviceCollection }, async (editor, _, instantiationService) => {\n\t\t\tstorageService.store('editor.matchCase', true, StorageScope.WORKSPACE, StorageTarget.USER);\n\t\t\t// The cursor is at the very top, of the file, at the first ABC\n\t\t\tconst findController = editor.registerAndInstantiateContribution(TestFindController.ID, TestFindController);\n\t\t\tconst findState = findController.getState();\n\n\t\t\t// I hit Ctrl+F to show the Find dialog\n\t\t\tawait executeAction(instantiationService, editor, StartFindAction);\n\n\t\t\t// I type ABC.\n\t\t\tfindState.change({ searchString: 'ABC' }, true);\n\t\t\t// The second ABC is highlighted as matchCase is true.\n\t\t\tassert.deepStrictEqual(fromSelection(editor.getSelection()!), [2, 1, 2, 4]);\n\n\t\t\tfindController.dispose();\n\t\t});\n\t});\n\n\tstorageService.store('editor.matchCase', false, StorageScope.WORKSPACE, StorageTarget.USER);\n\tstorageService.store('editor.wholeWord', true, StorageScope.WORKSPACE, StorageTarget.USER);\n\n\ttest('wholeWord', async () => {\n\t\tawait withAsyncTestCodeEditor([\n\t\t\t'ABC',\n\t\t\t'AB',\n\t\t\t'XYZ',\n\t\t\t'ABC'\n\t\t], { serviceCollection: serviceCollection }, async (editor, _, instantiationService) => {\n\t\t\t// The cursor is at the very top, of the file, at the first ABC\n\t\t\tconst findController = editor.registerAndInstantiateContribution(TestFindController.ID, TestFindController);\n\t\t\tconst findState = findController.getState();\n\n\t\t\t// I hit Ctrl+F to show the Find dialog\n\t\t\tawait executeAction(instantiationService, editor, StartFindAction);\n\n\t\t\t// I type AB.\n\t\t\tfindState.change({ searchString: 'AB' }, true);\n\t\t\t// The second AB is highlighted as wholeWord is true.\n\t\t\tassert.deepStrictEqual(fromSelection(editor.getSelection()!), [2, 1, 2, 3]);\n\n\t\t\tfindController.dispose();\n\t\t});\n\t});\n\n\ttest('toggling options is saved', async () => {\n\t\tawait withAsyncTestCodeEditor([\n\t\t\t'ABC',\n\t\t\t'AB',\n\t\t\t'XYZ',\n\t\t\t'ABC'\n\t\t], { serviceCollection: serviceCollection }, async (editor) => {\n\t\t\t// The cursor is at the very top, of the file, at the first ABC\n\t\t\tconst findController = editor.registerAndInstantiateContribution(TestFindController.ID, TestFindController);\n\t\t\tfindController.toggleRegex();\n\t\t\tassert.strictEqual(storageService.getBoolean('editor.isRegex', StorageScope.WORKSPACE), true);\n\n\t\t\tfindController.dispose();\n\t\t});\n\t});\n\n\ttest('issue #27083: Update search scope once find widget becomes visible', async () => {\n\t\tawait withAsyncTestCodeEditor([\n\t\t\t'var x = (3 * 5)',\n\t\t\t'var y = (3 * 5)',\n\t\t\t'var z = (3 * 5)',\n\t\t], { serviceCollection: serviceCollection, find: { autoFindInSelection: 'always', globalFindClipboard: false } }, async (editor) => {\n\t\t\t// clipboardState = '';\n\t\t\tconst findController = editor.registerAndInstantiateContribution(TestFindController.ID, TestFindController);\n\t\t\tconst findConfig: IFindStartOptions = {\n\t\t\t\tforceRevealReplace: false,\n\t\t\t\tseedSearchStringFromSelection: 'none',\n\t\t\t\tseedSearchStringFromNonEmptySelection: false,\n\t\t\t\tseedSearchStringFromGlobalClipboard: false,\n\t\t\t\tshouldFocus: FindStartFocusAction.NoFocusChange,\n\t\t\t\tshouldAnimate: false,\n\t\t\t\tupdateSearchScope: true,\n\t\t\t\tloop: true\n\t\t\t};\n\n\t\t\teditor.setSelection(new Range(1, 1, 2, 1));\n\t\t\tfindController.start(findConfig);\n\t\t\tassert.deepStrictEqual(findController.getState().searchScope, [new Selection(1, 1, 2, 1)]);\n\n\t\t\tfindController.closeFindWidget();\n\n\t\t\teditor.setSelections([new Selection(1, 1, 2, 1), new Selection(2, 1, 2, 5)]);\n\t\t\tfindController.start(findConfig);\n\t\t\tassert.deepStrictEqual(findController.getState().searchScope, [new Selection(1, 1, 2, 1), new Selection(2, 1, 2, 5)]);\n\t\t});\n\t});\n\n\ttest('issue #58604: Do not update searchScope if it is empty', async () => {\n\t\tawait withAsyncTestCodeEditor([\n\t\t\t'var x = (3 * 5)',\n\t\t\t'var y = (3 * 5)',\n\t\t\t'var z = (3 * 5)',\n\t\t], { serviceCollection: serviceCollection, find: { autoFindInSelection: 'always', globalFindClipboard: false } }, async (editor) => {\n\t\t\t// clipboardState = '';\n\t\t\teditor.setSelection(new Range(1, 2, 1, 2));\n\t\t\tconst findController = editor.registerAndInstantiateContribution(TestFindController.ID, TestFindController);\n\n\t\t\tawait findController.start({\n\t\t\t\tforceRevealReplace: false,\n\t\t\t\tseedSearchStringFromSelection: 'none',\n\t\t\t\tseedSearchStringFromNonEmptySelection: false,\n\t\t\t\tseedSearchStringFromGlobalClipboard: false,\n\t\t\t\tshouldFocus: FindStartFocusAction.NoFocusChange,\n\t\t\t\tshouldAnimate: false,\n\t\t\t\tupdateSearchScope: true,\n\t\t\t\tloop: true\n\t\t\t});\n\n\t\t\tassert.deepStrictEqual(findController.getState().searchScope, null);\n\t\t});\n\t});\n\n\ttest('issue #58604: Update searchScope if it is not empty', async () => {\n\t\tawait withAsyncTestCodeEditor([\n\t\t\t'var x = (3 * 5)',\n\t\t\t'var y = (3 * 5)',\n\t\t\t'var z = (3 * 5)',\n\t\t], { serviceCollection: serviceCollection, find: { autoFindInSelection: 'always', globalFindClipboard: false } }, async (editor) => {\n\t\t\t// clipboardState = '';\n\t\t\teditor.setSelection(new Range(1, 2, 1, 3));\n\t\t\tconst findController = editor.registerAndInstantiateContribution(TestFindController.ID, TestFindController);\n\n\t\t\tawait findController.start({\n\t\t\t\tforceRevealReplace: false,\n\t\t\t\tseedSearchStringFromSelection: 'none',\n\t\t\t\tseedSearchStringFromNonEmptySelection: false,\n\t\t\t\tseedSearchStringFromGlobalClipboard: false,\n\t\t\t\tshouldFocus: FindStartFocusAction.NoFocusChange,\n\t\t\t\tshouldAnimate: false,\n\t\t\t\tupdateSearchScope: true,\n\t\t\t\tloop: true\n\t\t\t});\n\n\t\t\tassert.deepStrictEqual(findController.getState().searchScope, [new Selection(1, 2, 1, 3)]);\n\t\t});\n\t});\n\n\n\ttest('issue #27083: Find in selection when multiple lines are selected', async () => {\n\t\tawait withAsyncTestCodeEditor([\n\t\t\t'var x = (3 * 5)',\n\t\t\t'var y = (3 * 5)',\n\t\t\t'var z = (3 * 5)',\n\t\t], { serviceCollection: serviceCollection, find: { autoFindInSelection: 'multiline', globalFindClipboard: false } }, async (editor) => {\n\t\t\t// clipboardState = '';\n\t\t\teditor.setSelection(new Range(1, 6, 2, 1));\n\t\t\tconst findController = editor.registerAndInstantiateContribution(TestFindController.ID, TestFindController);\n\n\t\t\tawait findController.start({\n\t\t\t\tforceRevealReplace: false,\n\t\t\t\tseedSearchStringFromSelection: 'none',\n\t\t\t\tseedSearchStringFromNonEmptySelection: false,\n\t\t\t\tseedSearchStringFromGlobalClipboard: false,\n\t\t\t\tshouldFocus: FindStartFocusAction.NoFocusChange,\n\t\t\t\tshouldAnimate: false,\n\t\t\t\tupdateSearchScope: true,\n\t\t\t\tloop: true\n\t\t\t});\n\n\t\t\tassert.deepStrictEqual(findController.getState().searchScope, [new Selection(1, 6, 2, 1)]);\n\t\t});\n\t});\n});\n"]}