{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/editor/contrib/suggest/test/browser/suggestInlineCompletions.test.ts","vs/editor/contrib/suggest/test/browser/suggestInlineCompletions.test.ts"],"names":[],"mappings":"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","file":"suggestInlineCompletions.test.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport assert from 'assert';\nimport { CancellationToken } from '../../../../../base/common/cancellation.js';\nimport { DisposableStore } from '../../../../../base/common/lifecycle.js';\nimport { URI } from '../../../../../base/common/uri.js';\nimport { mock } from '../../../../../base/test/common/mock.js';\nimport { ensureNoDisposablesAreLeakedInTestSuite } from '../../../../../base/test/common/utils.js';\nimport { Position } from '../../../../common/core/position.js';\nimport { Range } from '../../../../common/core/range.js';\nimport { CompletionContext, CompletionItem, CompletionItemKind, CompletionItemProvider, CompletionList, InlineCompletionContext, InlineCompletionTriggerKind, ProviderResult } from '../../../../common/languages.js';\nimport { ITextModel } from '../../../../common/model.js';\nimport { TextModel } from '../../../../common/model/textModel.js';\nimport { ILanguageFeaturesService } from '../../../../common/services/languageFeatures.js';\nimport { SuggestInlineCompletions } from '../../browser/suggestInlineCompletions.js';\nimport { ISuggestMemoryService } from '../../browser/suggestMemory.js';\nimport { createCodeEditorServices, instantiateTestCodeEditor, ITestCodeEditor } from '../../../../test/browser/testCodeEditor.js';\nimport { createTextModel } from '../../../../test/common/testTextModel.js';\nimport { ServiceCollection } from '../../../../../platform/instantiation/common/serviceCollection.js';\nimport { TestInstantiationService } from '../../../../../platform/instantiation/test/common/instantiationServiceMock.js';\nimport { generateUuid } from '../../../../../base/common/uuid.js';\n\n\nsuite('Suggest Inline Completions', function () {\n\n\tconst disposables = new DisposableStore();\n\tconst services = new ServiceCollection([ISuggestMemoryService, new class extends mock<ISuggestMemoryService>() {\n\t\toverride select(): number {\n\t\t\treturn 0;\n\t\t}\n\t}]);\n\n\tlet insta: TestInstantiationService;\n\tlet model: TextModel;\n\tlet editor: ITestCodeEditor;\n\n\tsetup(function () {\n\n\t\tinsta = createCodeEditorServices(disposables, services);\n\t\tmodel = createTextModel('he', undefined, undefined, URI.from({ scheme: 'foo', path: 'foo.bar' }));\n\t\teditor = instantiateTestCodeEditor(insta, model);\n\t\teditor.updateOptions({ quickSuggestions: { comments: 'inline', strings: 'inline', other: 'inline' } });\n\n\t\tinsta.invokeFunction(accessor => {\n\t\t\tdisposables.add(accessor.get(ILanguageFeaturesService).completionProvider.register({ pattern: '*.bar', scheme: 'foo' }, new class implements CompletionItemProvider {\n\t\t\t\t_debugDisplayName = 'test';\n\n\t\t\t\ttriggerCharacters?: string[] | undefined;\n\n\t\t\t\tprovideCompletionItems(model: ITextModel, position: Position, context: CompletionContext, token: CancellationToken): ProviderResult<CompletionList> {\n\n\t\t\t\t\tconst word = model.getWordUntilPosition(position);\n\t\t\t\t\tconst range = new Range(position.lineNumber, word.startColumn, position.lineNumber, word.endColumn);\n\n\t\t\t\t\tconst suggestions: CompletionItem[] = [];\n\t\t\t\t\tsuggestions.push({ insertText: 'hello', label: 'hello', range, kind: CompletionItemKind.Class });\n\t\t\t\t\tsuggestions.push({ insertText: 'hell', label: 'hell', range, kind: CompletionItemKind.Class });\n\t\t\t\t\tsuggestions.push({ insertText: 'hey', label: 'hey', range, kind: CompletionItemKind.Snippet });\n\t\t\t\t\treturn { suggestions };\n\t\t\t\t}\n\n\t\t\t}));\n\t\t});\n\t});\n\n\tteardown(function () {\n\t\tdisposables.clear();\n\t\tmodel.dispose();\n\t\teditor.dispose();\n\t});\n\n\n\tensureNoDisposablesAreLeakedInTestSuite();\n\n\tconst context: InlineCompletionContext = { triggerKind: InlineCompletionTriggerKind.Explicit, selectedSuggestionInfo: undefined, includeInlineCompletions: true, includeInlineEdits: false, requestUuid: generateUuid(), requestIssuedDateTime: 0, earliestShownDateTime: 0 };\n\n\ttest('Aggressive inline completions when typing within line #146948', async function () {\n\n\t\tconst completions: SuggestInlineCompletions = disposables.add(insta.createInstance(SuggestInlineCompletions));\n\n\t\t{\n\t\t\t// (1,3), end of word -> suggestions\n\t\t\tconst result = await completions.provideInlineCompletions(model, new Position(1, 3), context, CancellationToken.None);\n\t\t\tassert.strictEqual(result?.items.length, 3);\n\t\t\tcompletions.disposeInlineCompletions(result);\n\t\t}\n\t\t{\n\t\t\t// (1,2), middle of word -> NO suggestions\n\t\t\tconst result = await completions.provideInlineCompletions(model, new Position(1, 2), context, CancellationToken.None);\n\t\t\tassert.ok(result === undefined);\n\t\t}\n\t});\n\n\ttest('Snippets show in inline suggestions even though they are turned off #175190', async function () {\n\t\tconst completions: SuggestInlineCompletions = disposables.add(insta.createInstance(SuggestInlineCompletions));\n\n\t\t{\n\t\t\t// unfiltered\n\t\t\tconst result = await completions.provideInlineCompletions(model, new Position(1, 3), context, CancellationToken.None);\n\t\t\tassert.strictEqual(result?.items.length, 3);\n\t\t\tcompletions.disposeInlineCompletions(result);\n\t\t}\n\n\t\t{\n\t\t\t// filtered\n\t\t\teditor.updateOptions({ suggest: { showSnippets: false } });\n\t\t\tconst result = await completions.provideInlineCompletions(model, new Position(1, 3), context, CancellationToken.None);\n\t\t\tassert.strictEqual(result?.items.length, 2);\n\t\t\tcompletions.disposeInlineCompletions(result);\n\t\t}\n\n\t});\n});\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport assert from 'assert';\nimport { CancellationToken } from '../../../../../base/common/cancellation.js';\nimport { DisposableStore } from '../../../../../base/common/lifecycle.js';\nimport { URI } from '../../../../../base/common/uri.js';\nimport { mock } from '../../../../../base/test/common/mock.js';\nimport { ensureNoDisposablesAreLeakedInTestSuite } from '../../../../../base/test/common/utils.js';\nimport { Position } from '../../../../common/core/position.js';\nimport { Range } from '../../../../common/core/range.js';\nimport { CompletionContext, CompletionItem, CompletionItemKind, CompletionItemProvider, CompletionList, InlineCompletionContext, InlineCompletionTriggerKind, ProviderResult } from '../../../../common/languages.js';\nimport { ITextModel } from '../../../../common/model.js';\nimport { TextModel } from '../../../../common/model/textModel.js';\nimport { ILanguageFeaturesService } from '../../../../common/services/languageFeatures.js';\nimport { SuggestInlineCompletions } from '../../browser/suggestInlineCompletions.js';\nimport { ISuggestMemoryService } from '../../browser/suggestMemory.js';\nimport { createCodeEditorServices, instantiateTestCodeEditor, ITestCodeEditor } from '../../../../test/browser/testCodeEditor.js';\nimport { createTextModel } from '../../../../test/common/testTextModel.js';\nimport { ServiceCollection } from '../../../../../platform/instantiation/common/serviceCollection.js';\nimport { TestInstantiationService } from '../../../../../platform/instantiation/test/common/instantiationServiceMock.js';\nimport { generateUuid } from '../../../../../base/common/uuid.js';\n\n\nsuite('Suggest Inline Completions', function () {\n\n\tconst disposables = new DisposableStore();\n\tconst services = new ServiceCollection([ISuggestMemoryService, new class extends mock<ISuggestMemoryService>() {\n\t\toverride select(): number {\n\t\t\treturn 0;\n\t\t}\n\t}]);\n\n\tlet insta: TestInstantiationService;\n\tlet model: TextModel;\n\tlet editor: ITestCodeEditor;\n\n\tsetup(function () {\n\n\t\tinsta = createCodeEditorServices(disposables, services);\n\t\tmodel = createTextModel('he', undefined, undefined, URI.from({ scheme: 'foo', path: 'foo.bar' }));\n\t\teditor = instantiateTestCodeEditor(insta, model);\n\t\teditor.updateOptions({ quickSuggestions: { comments: 'inline', strings: 'inline', other: 'inline' } });\n\n\t\tinsta.invokeFunction(accessor => {\n\t\t\tdisposables.add(accessor.get(ILanguageFeaturesService).completionProvider.register({ pattern: '*.bar', scheme: 'foo' }, new class implements CompletionItemProvider {\n\t\t\t\t_debugDisplayName = 'test';\n\n\t\t\t\ttriggerCharacters?: string[] | undefined;\n\n\t\t\t\tprovideCompletionItems(model: ITextModel, position: Position, context: CompletionContext, token: CancellationToken): ProviderResult<CompletionList> {\n\n\t\t\t\t\tconst word = model.getWordUntilPosition(position);\n\t\t\t\t\tconst range = new Range(position.lineNumber, word.startColumn, position.lineNumber, word.endColumn);\n\n\t\t\t\t\tconst suggestions: CompletionItem[] = [];\n\t\t\t\t\tsuggestions.push({ insertText: 'hello', label: 'hello', range, kind: CompletionItemKind.Class });\n\t\t\t\t\tsuggestions.push({ insertText: 'hell', label: 'hell', range, kind: CompletionItemKind.Class });\n\t\t\t\t\tsuggestions.push({ insertText: 'hey', label: 'hey', range, kind: CompletionItemKind.Snippet });\n\t\t\t\t\treturn { suggestions };\n\t\t\t\t}\n\n\t\t\t}));\n\t\t});\n\t});\n\n\tteardown(function () {\n\t\tdisposables.clear();\n\t\tmodel.dispose();\n\t\teditor.dispose();\n\t});\n\n\n\tensureNoDisposablesAreLeakedInTestSuite();\n\n\tconst context: InlineCompletionContext = { triggerKind: InlineCompletionTriggerKind.Explicit, selectedSuggestionInfo: undefined, includeInlineCompletions: true, includeInlineEdits: false, requestUuid: generateUuid(), requestIssuedDateTime: 0, earliestShownDateTime: 0 };\n\n\ttest('Aggressive inline completions when typing within line #146948', async function () {\n\n\t\tconst completions: SuggestInlineCompletions = disposables.add(insta.createInstance(SuggestInlineCompletions));\n\n\t\t{\n\t\t\t// (1,3), end of word -> suggestions\n\t\t\tconst result = await completions.provideInlineCompletions(model, new Position(1, 3), context, CancellationToken.None);\n\t\t\tassert.strictEqual(result?.items.length, 3);\n\t\t\tcompletions.disposeInlineCompletions(result);\n\t\t}\n\t\t{\n\t\t\t// (1,2), middle of word -> NO suggestions\n\t\t\tconst result = await completions.provideInlineCompletions(model, new Position(1, 2), context, CancellationToken.None);\n\t\t\tassert.ok(result === undefined);\n\t\t}\n\t});\n\n\ttest('Snippets show in inline suggestions even though they are turned off #175190', async function () {\n\t\tconst completions: SuggestInlineCompletions = disposables.add(insta.createInstance(SuggestInlineCompletions));\n\n\t\t{\n\t\t\t// unfiltered\n\t\t\tconst result = await completions.provideInlineCompletions(model, new Position(1, 3), context, CancellationToken.None);\n\t\t\tassert.strictEqual(result?.items.length, 3);\n\t\t\tcompletions.disposeInlineCompletions(result);\n\t\t}\n\n\t\t{\n\t\t\t// filtered\n\t\t\teditor.updateOptions({ suggest: { showSnippets: false } });\n\t\t\tconst result = await completions.provideInlineCompletions(model, new Position(1, 3), context, CancellationToken.None);\n\t\t\tassert.strictEqual(result?.items.length, 2);\n\t\t\tcompletions.disposeInlineCompletions(result);\n\t\t}\n\n\t});\n});\n"]}