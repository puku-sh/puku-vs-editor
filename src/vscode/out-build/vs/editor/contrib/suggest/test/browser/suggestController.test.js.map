{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/editor/contrib/suggest/test/browser/suggestController.test.ts","vs/editor/contrib/suggest/test/browser/suggestController.test.ts"],"names":[],"mappings":"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","file":"suggestController.test.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport assert from 'assert';\nimport { timeout } from '../../../../../base/common/async.js';\nimport { Event } from '../../../../../base/common/event.js';\nimport { DisposableStore } from '../../../../../base/common/lifecycle.js';\nimport { URI } from '../../../../../base/common/uri.js';\nimport { mock } from '../../../../../base/test/common/mock.js';\nimport { Range } from '../../../../common/core/range.js';\nimport { Selection } from '../../../../common/core/selection.js';\nimport { TextModel } from '../../../../common/model/textModel.js';\nimport { CompletionItemInsertTextRule, CompletionItemKind } from '../../../../common/languages.js';\nimport { IEditorWorkerService } from '../../../../common/services/editorWorker.js';\nimport { SnippetController2 } from '../../../snippet/browser/snippetController2.js';\nimport { SuggestController } from '../../browser/suggestController.js';\nimport { ISuggestMemoryService } from '../../browser/suggestMemory.js';\nimport { createTestCodeEditor, ITestCodeEditor } from '../../../../test/browser/testCodeEditor.js';\nimport { createTextModel } from '../../../../test/common/testTextModel.js';\nimport { IMenu, IMenuService } from '../../../../../platform/actions/common/actions.js';\nimport { ServiceCollection } from '../../../../../platform/instantiation/common/serviceCollection.js';\nimport { IKeybindingService } from '../../../../../platform/keybinding/common/keybinding.js';\nimport { MockKeybindingService } from '../../../../../platform/keybinding/test/common/mockKeybindingService.js';\nimport { ILabelService } from '../../../../../platform/label/common/label.js';\nimport { ILogService, NullLogService } from '../../../../../platform/log/common/log.js';\nimport { InMemoryStorageService, IStorageService } from '../../../../../platform/storage/common/storage.js';\nimport { ITelemetryService } from '../../../../../platform/telemetry/common/telemetry.js';\nimport { NullTelemetryService } from '../../../../../platform/telemetry/common/telemetryUtils.js';\nimport { IWorkspaceContextService } from '../../../../../platform/workspace/common/workspace.js';\nimport { LanguageFeaturesService } from '../../../../common/services/languageFeaturesService.js';\nimport { ILanguageFeaturesService } from '../../../../common/services/languageFeatures.js';\nimport { IEnvironmentService } from '../../../../../platform/environment/common/environment.js';\nimport { DeleteLinesAction } from '../../../linesOperations/browser/linesOperations.js';\n\nsuite('SuggestController', function () {\n\n\tconst disposables = new DisposableStore();\n\n\tlet controller: SuggestController;\n\tlet editor: ITestCodeEditor;\n\tlet model: TextModel;\n\tconst languageFeaturesService = new LanguageFeaturesService();\n\n\tteardown(function () {\n\n\t\tdisposables.clear();\n\t});\n\n\t// ensureNoDisposablesAreLeakedInTestSuite();\n\n\tsetup(function () {\n\n\t\tconst serviceCollection = new ServiceCollection(\n\t\t\t[ILanguageFeaturesService, languageFeaturesService],\n\t\t\t[ITelemetryService, NullTelemetryService],\n\t\t\t[ILogService, new NullLogService()],\n\t\t\t[IStorageService, disposables.add(new InMemoryStorageService())],\n\t\t\t[IKeybindingService, new MockKeybindingService()],\n\t\t\t[IEditorWorkerService, new class extends mock<IEditorWorkerService>() {\n\t\t\t\toverride computeWordRanges() {\n\t\t\t\t\treturn Promise.resolve({});\n\t\t\t\t}\n\t\t\t}],\n\t\t\t[ISuggestMemoryService, new class extends mock<ISuggestMemoryService>() {\n\t\t\t\toverride memorize(): void { }\n\t\t\t\toverride select(): number { return 0; }\n\t\t\t}],\n\t\t\t[IMenuService, new class extends mock<IMenuService>() {\n\t\t\t\toverride createMenu() {\n\t\t\t\t\treturn new class extends mock<IMenu>() {\n\t\t\t\t\t\toverride onDidChange = Event.None;\n\t\t\t\t\t\toverride dispose() { }\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t}],\n\t\t\t[ILabelService, new class extends mock<ILabelService>() { }],\n\t\t\t[IWorkspaceContextService, new class extends mock<IWorkspaceContextService>() { }],\n\t\t\t[IEnvironmentService, new class extends mock<IEnvironmentService>() {\n\t\t\t\toverride isBuilt: boolean = true;\n\t\t\t\toverride isExtensionDevelopment: boolean = false;\n\t\t\t}],\n\t\t);\n\n\t\tmodel = disposables.add(createTextModel('', undefined, undefined, URI.from({ scheme: 'test-ctrl', path: '/path.tst' })));\n\t\teditor = disposables.add(createTestCodeEditor(model, { serviceCollection }));\n\n\t\teditor.registerAndInstantiateContribution(SnippetController2.ID, SnippetController2);\n\t\tcontroller = editor.registerAndInstantiateContribution(SuggestController.ID, SuggestController);\n\t});\n\n\ttest('postfix completion reports incorrect position #86984', async function () {\n\t\tdisposables.add(languageFeaturesService.completionProvider.register({ scheme: 'test-ctrl' }, {\n\t\t\t_debugDisplayName: 'test',\n\t\t\tprovideCompletionItems(doc, pos) {\n\t\t\t\treturn {\n\t\t\t\t\tsuggestions: [{\n\t\t\t\t\t\tkind: CompletionItemKind.Snippet,\n\t\t\t\t\t\tlabel: 'let',\n\t\t\t\t\t\tinsertText: 'let ${1:name} = foo$0',\n\t\t\t\t\t\tinsertTextRules: CompletionItemInsertTextRule.InsertAsSnippet,\n\t\t\t\t\t\trange: { startLineNumber: 1, startColumn: 9, endLineNumber: 1, endColumn: 11 },\n\t\t\t\t\t\tadditionalTextEdits: [{\n\t\t\t\t\t\t\ttext: '',\n\t\t\t\t\t\t\trange: { startLineNumber: 1, startColumn: 5, endLineNumber: 1, endColumn: 9 }\n\t\t\t\t\t\t}]\n\t\t\t\t\t}]\n\t\t\t\t};\n\t\t\t}\n\t\t}));\n\n\t\teditor.setValue('    foo.le');\n\t\teditor.setSelection(new Selection(1, 11, 1, 11));\n\n\t\t// trigger\n\t\tconst p1 = Event.toPromise(controller.model.onDidSuggest);\n\t\tcontroller.triggerSuggest();\n\t\tawait p1;\n\n\t\t//\n\t\tconst p2 = Event.toPromise(controller.model.onDidCancel);\n\t\tcontroller.acceptSelectedSuggestion(false, false);\n\t\tawait p2;\n\n\t\tassert.strictEqual(editor.getValue(), '    let name = foo');\n\t});\n\n\ttest('use additionalTextEdits sync when possible', async function () {\n\n\t\tdisposables.add(languageFeaturesService.completionProvider.register({ scheme: 'test-ctrl' }, {\n\t\t\t_debugDisplayName: 'test',\n\t\t\tprovideCompletionItems(doc, pos) {\n\t\t\t\treturn {\n\t\t\t\t\tsuggestions: [{\n\t\t\t\t\t\tkind: CompletionItemKind.Snippet,\n\t\t\t\t\t\tlabel: 'let',\n\t\t\t\t\t\tinsertText: 'hello',\n\t\t\t\t\t\trange: Range.fromPositions(pos),\n\t\t\t\t\t\tadditionalTextEdits: [{\n\t\t\t\t\t\t\ttext: 'I came sync',\n\t\t\t\t\t\t\trange: { startLineNumber: 1, startColumn: 1, endLineNumber: 1, endColumn: 1 }\n\t\t\t\t\t\t}]\n\t\t\t\t\t}]\n\t\t\t\t};\n\t\t\t},\n\t\t\tasync resolveCompletionItem(item) {\n\t\t\t\treturn item;\n\t\t\t}\n\t\t}));\n\n\t\teditor.setValue('hello\\nhallo');\n\t\teditor.setSelection(new Selection(2, 6, 2, 6));\n\n\t\t// trigger\n\t\tconst p1 = Event.toPromise(controller.model.onDidSuggest);\n\t\tcontroller.triggerSuggest();\n\t\tawait p1;\n\n\t\t//\n\t\tconst p2 = Event.toPromise(controller.model.onDidCancel);\n\t\tcontroller.acceptSelectedSuggestion(false, false);\n\t\tawait p2;\n\n\t\t// insertText happens sync!\n\t\tassert.strictEqual(editor.getValue(), 'I came synchello\\nhallohello');\n\t});\n\n\ttest('resolve additionalTextEdits async when needed', async function () {\n\n\t\tlet resolveCallCount = 0;\n\n\t\tdisposables.add(languageFeaturesService.completionProvider.register({ scheme: 'test-ctrl' }, {\n\t\t\t_debugDisplayName: 'test',\n\t\t\tprovideCompletionItems(doc, pos) {\n\t\t\t\treturn {\n\t\t\t\t\tsuggestions: [{\n\t\t\t\t\t\tkind: CompletionItemKind.Snippet,\n\t\t\t\t\t\tlabel: 'let',\n\t\t\t\t\t\tinsertText: 'hello',\n\t\t\t\t\t\trange: Range.fromPositions(pos)\n\t\t\t\t\t}]\n\t\t\t\t};\n\t\t\t},\n\t\t\tasync resolveCompletionItem(item) {\n\t\t\t\tresolveCallCount += 1;\n\t\t\t\tawait timeout(10);\n\t\t\t\titem.additionalTextEdits = [{\n\t\t\t\t\ttext: 'I came late',\n\t\t\t\t\trange: { startLineNumber: 1, startColumn: 1, endLineNumber: 1, endColumn: 1 }\n\t\t\t\t}];\n\t\t\t\treturn item;\n\t\t\t}\n\t\t}));\n\n\t\teditor.setValue('hello\\nhallo');\n\t\teditor.setSelection(new Selection(2, 6, 2, 6));\n\n\t\t// trigger\n\t\tconst p1 = Event.toPromise(controller.model.onDidSuggest);\n\t\tcontroller.triggerSuggest();\n\t\tawait p1;\n\n\t\t//\n\t\tconst p2 = Event.toPromise(controller.model.onDidCancel);\n\t\tcontroller.acceptSelectedSuggestion(false, false);\n\t\tawait p2;\n\n\t\t// insertText happens sync!\n\t\tassert.strictEqual(editor.getValue(), 'hello\\nhallohello');\n\t\tassert.strictEqual(resolveCallCount, 1);\n\n\t\t// additional edits happened after a litte wait\n\t\tawait timeout(20);\n\t\tassert.strictEqual(editor.getValue(), 'I came latehello\\nhallohello');\n\n\t\t// single undo stop\n\t\teditor.getModel()?.undo();\n\t\tassert.strictEqual(editor.getValue(), 'hello\\nhallo');\n\t});\n\n\ttest('resolve additionalTextEdits async when needed (typing)', async function () {\n\n\t\tlet resolveCallCount = 0;\n\t\tlet resolve: Function = () => { };\n\t\tdisposables.add(languageFeaturesService.completionProvider.register({ scheme: 'test-ctrl' }, {\n\t\t\t_debugDisplayName: 'test',\n\t\t\tprovideCompletionItems(doc, pos) {\n\t\t\t\treturn {\n\t\t\t\t\tsuggestions: [{\n\t\t\t\t\t\tkind: CompletionItemKind.Snippet,\n\t\t\t\t\t\tlabel: 'let',\n\t\t\t\t\t\tinsertText: 'hello',\n\t\t\t\t\t\trange: Range.fromPositions(pos)\n\t\t\t\t\t}]\n\t\t\t\t};\n\t\t\t},\n\t\t\tasync resolveCompletionItem(item) {\n\t\t\t\tresolveCallCount += 1;\n\t\t\t\tawait new Promise(_resolve => resolve = _resolve);\n\t\t\t\titem.additionalTextEdits = [{\n\t\t\t\t\ttext: 'I came late',\n\t\t\t\t\trange: { startLineNumber: 1, startColumn: 1, endLineNumber: 1, endColumn: 1 }\n\t\t\t\t}];\n\t\t\t\treturn item;\n\t\t\t}\n\t\t}));\n\n\t\teditor.setValue('hello\\nhallo');\n\t\teditor.setSelection(new Selection(2, 6, 2, 6));\n\n\t\t// trigger\n\t\tconst p1 = Event.toPromise(controller.model.onDidSuggest);\n\t\tcontroller.triggerSuggest();\n\t\tawait p1;\n\n\t\t//\n\t\tconst p2 = Event.toPromise(controller.model.onDidCancel);\n\t\tcontroller.acceptSelectedSuggestion(false, false);\n\t\tawait p2;\n\n\t\t// insertText happens sync!\n\t\tassert.strictEqual(editor.getValue(), 'hello\\nhallohello');\n\t\tassert.strictEqual(resolveCallCount, 1);\n\n\t\t// additional edits happened after a litte wait\n\t\tassert.ok(editor.getSelection()?.equalsSelection(new Selection(2, 11, 2, 11)));\n\t\teditor.trigger('test', 'type', { text: 'TYPING' });\n\n\t\tassert.strictEqual(editor.getValue(), 'hello\\nhallohelloTYPING');\n\n\t\tresolve();\n\t\tawait timeout(10);\n\t\tassert.strictEqual(editor.getValue(), 'I came latehello\\nhallohelloTYPING');\n\t\tassert.ok(editor.getSelection()?.equalsSelection(new Selection(2, 17, 2, 17)));\n\t});\n\n\t// additional edit come late and are AFTER the selection -> cancel\n\ttest('resolve additionalTextEdits async when needed (simple conflict)', async function () {\n\n\t\tlet resolveCallCount = 0;\n\t\tlet resolve: Function = () => { };\n\t\tdisposables.add(languageFeaturesService.completionProvider.register({ scheme: 'test-ctrl' }, {\n\t\t\t_debugDisplayName: 'test',\n\t\t\tprovideCompletionItems(doc, pos) {\n\t\t\t\treturn {\n\t\t\t\t\tsuggestions: [{\n\t\t\t\t\t\tkind: CompletionItemKind.Snippet,\n\t\t\t\t\t\tlabel: 'let',\n\t\t\t\t\t\tinsertText: 'hello',\n\t\t\t\t\t\trange: Range.fromPositions(pos)\n\t\t\t\t\t}]\n\t\t\t\t};\n\t\t\t},\n\t\t\tasync resolveCompletionItem(item) {\n\t\t\t\tresolveCallCount += 1;\n\t\t\t\tawait new Promise(_resolve => resolve = _resolve);\n\t\t\t\titem.additionalTextEdits = [{\n\t\t\t\t\ttext: 'I came late',\n\t\t\t\t\trange: { startLineNumber: 1, startColumn: 6, endLineNumber: 1, endColumn: 6 }\n\t\t\t\t}];\n\t\t\t\treturn item;\n\t\t\t}\n\t\t}));\n\n\t\teditor.setValue('');\n\t\teditor.setSelection(new Selection(1, 1, 1, 1));\n\n\t\t// trigger\n\t\tconst p1 = Event.toPromise(controller.model.onDidSuggest);\n\t\tcontroller.triggerSuggest();\n\t\tawait p1;\n\n\t\t//\n\t\tconst p2 = Event.toPromise(controller.model.onDidCancel);\n\t\tcontroller.acceptSelectedSuggestion(false, false);\n\t\tawait p2;\n\n\t\t// insertText happens sync!\n\t\tassert.strictEqual(editor.getValue(), 'hello');\n\t\tassert.strictEqual(resolveCallCount, 1);\n\n\t\tresolve();\n\t\tawait timeout(10);\n\t\tassert.strictEqual(editor.getValue(), 'hello');\n\t});\n\n\t// additional edit come late and are AFTER the position at which the user typed -> cancelled\n\ttest('resolve additionalTextEdits async when needed (conflict)', async function () {\n\n\t\tlet resolveCallCount = 0;\n\t\tlet resolve: Function = () => { };\n\t\tdisposables.add(languageFeaturesService.completionProvider.register({ scheme: 'test-ctrl' }, {\n\t\t\t_debugDisplayName: 'test',\n\t\t\tprovideCompletionItems(doc, pos) {\n\t\t\t\treturn {\n\t\t\t\t\tsuggestions: [{\n\t\t\t\t\t\tkind: CompletionItemKind.Snippet,\n\t\t\t\t\t\tlabel: 'let',\n\t\t\t\t\t\tinsertText: 'hello',\n\t\t\t\t\t\trange: Range.fromPositions(pos)\n\t\t\t\t\t}]\n\t\t\t\t};\n\t\t\t},\n\t\t\tasync resolveCompletionItem(item) {\n\t\t\t\tresolveCallCount += 1;\n\t\t\t\tawait new Promise(_resolve => resolve = _resolve);\n\t\t\t\titem.additionalTextEdits = [{\n\t\t\t\t\ttext: 'I came late',\n\t\t\t\t\trange: { startLineNumber: 1, startColumn: 2, endLineNumber: 1, endColumn: 2 }\n\t\t\t\t}];\n\t\t\t\treturn item;\n\t\t\t}\n\t\t}));\n\n\t\teditor.setValue('hello\\nhallo');\n\t\teditor.setSelection(new Selection(2, 6, 2, 6));\n\n\t\t// trigger\n\t\tconst p1 = Event.toPromise(controller.model.onDidSuggest);\n\t\tcontroller.triggerSuggest();\n\t\tawait p1;\n\n\t\t//\n\t\tconst p2 = Event.toPromise(controller.model.onDidCancel);\n\t\tcontroller.acceptSelectedSuggestion(false, false);\n\t\tawait p2;\n\n\t\t// insertText happens sync!\n\t\tassert.strictEqual(editor.getValue(), 'hello\\nhallohello');\n\t\tassert.strictEqual(resolveCallCount, 1);\n\n\t\t// additional edits happened after a litte wait\n\t\teditor.setSelection(new Selection(1, 1, 1, 1));\n\t\teditor.trigger('test', 'type', { text: 'TYPING' });\n\n\t\tassert.strictEqual(editor.getValue(), 'TYPINGhello\\nhallohello');\n\n\t\tresolve();\n\t\tawait timeout(10);\n\t\tassert.strictEqual(editor.getValue(), 'TYPINGhello\\nhallohello');\n\t\tassert.ok(editor.getSelection()?.equalsSelection(new Selection(1, 7, 1, 7)));\n\t});\n\n\ttest('resolve additionalTextEdits async when needed (cancel)', async function () {\n\n\t\tconst resolve: Function[] = [];\n\t\tdisposables.add(languageFeaturesService.completionProvider.register({ scheme: 'test-ctrl' }, {\n\t\t\t_debugDisplayName: 'test',\n\t\t\tprovideCompletionItems(doc, pos) {\n\t\t\t\treturn {\n\t\t\t\t\tsuggestions: [{\n\t\t\t\t\t\tkind: CompletionItemKind.Snippet,\n\t\t\t\t\t\tlabel: 'let',\n\t\t\t\t\t\tinsertText: 'hello',\n\t\t\t\t\t\trange: Range.fromPositions(pos)\n\t\t\t\t\t}, {\n\t\t\t\t\t\tkind: CompletionItemKind.Snippet,\n\t\t\t\t\t\tlabel: 'let',\n\t\t\t\t\t\tinsertText: 'hallo',\n\t\t\t\t\t\trange: Range.fromPositions(pos)\n\t\t\t\t\t}]\n\t\t\t\t};\n\t\t\t},\n\t\t\tasync resolveCompletionItem(item) {\n\t\t\t\tawait new Promise(_resolve => resolve.push(_resolve));\n\t\t\t\titem.additionalTextEdits = [{\n\t\t\t\t\ttext: 'additionalTextEdits',\n\t\t\t\t\trange: { startLineNumber: 1, startColumn: 2, endLineNumber: 1, endColumn: 2 }\n\t\t\t\t}];\n\t\t\t\treturn item;\n\t\t\t}\n\t\t}));\n\n\t\teditor.setValue('abc');\n\t\teditor.setSelection(new Selection(1, 1, 1, 1));\n\n\t\t// trigger\n\t\tconst p1 = Event.toPromise(controller.model.onDidSuggest);\n\t\tcontroller.triggerSuggest();\n\t\tawait p1;\n\n\t\t//\n\t\tconst p2 = Event.toPromise(controller.model.onDidCancel);\n\t\tcontroller.acceptSelectedSuggestion(true, false);\n\t\tawait p2;\n\n\t\t// insertText happens sync!\n\t\tassert.strictEqual(editor.getValue(), 'helloabc');\n\n\t\t// next\n\t\tcontroller.acceptNextSuggestion();\n\n\t\t// resolve additional edits (MUST be cancelled)\n\t\tresolve.forEach(fn => fn);\n\t\tresolve.length = 0;\n\t\tawait timeout(10);\n\n\t\t// next suggestion used\n\t\tassert.strictEqual(editor.getValue(), 'halloabc');\n\t});\n\n\ttest('Completion edits are applied inconsistently when additionalTextEdits and textEdit start at the same offset #143888', async function () {\n\n\n\t\tdisposables.add(languageFeaturesService.completionProvider.register({ scheme: 'test-ctrl' }, {\n\t\t\t_debugDisplayName: 'test',\n\t\t\tprovideCompletionItems(doc, pos) {\n\t\t\t\treturn {\n\t\t\t\t\tsuggestions: [{\n\t\t\t\t\t\tkind: CompletionItemKind.Text,\n\t\t\t\t\t\tlabel: 'MyClassName',\n\t\t\t\t\t\tinsertText: 'MyClassName',\n\t\t\t\t\t\trange: Range.fromPositions(pos),\n\t\t\t\t\t\tadditionalTextEdits: [{\n\t\t\t\t\t\t\trange: Range.fromPositions(pos),\n\t\t\t\t\t\t\ttext: 'import \"my_class.txt\";\\n'\n\t\t\t\t\t\t}]\n\t\t\t\t\t}]\n\t\t\t\t};\n\t\t\t}\n\t\t}));\n\n\t\teditor.setValue('');\n\t\teditor.setSelection(new Selection(1, 1, 1, 1));\n\n\t\t// trigger\n\t\tconst p1 = Event.toPromise(controller.model.onDidSuggest);\n\t\tcontroller.triggerSuggest();\n\t\tawait p1;\n\n\t\t//\n\t\tconst p2 = Event.toPromise(controller.model.onDidCancel);\n\t\tcontroller.acceptSelectedSuggestion(true, false);\n\t\tawait p2;\n\n\t\t// insertText happens sync!\n\t\tassert.strictEqual(editor.getValue(), 'import \"my_class.txt\";\\nMyClassName');\n\n\t});\n\n\ttest('Pressing enter on autocomplete should always apply the selected dropdown completion, not a different, hidden one #161883', async function () {\n\t\tdisposables.add(languageFeaturesService.completionProvider.register({ scheme: 'test-ctrl' }, {\n\t\t\t_debugDisplayName: 'test',\n\t\t\tprovideCompletionItems(doc, pos) {\n\n\t\t\t\tconst word = doc.getWordUntilPosition(pos);\n\t\t\t\tconst range = new Range(pos.lineNumber, word.startColumn, pos.lineNumber, word.endColumn);\n\n\t\t\t\treturn {\n\t\t\t\t\tsuggestions: [{\n\t\t\t\t\t\tkind: CompletionItemKind.Text,\n\t\t\t\t\t\tlabel: 'filterBankSize',\n\t\t\t\t\t\tinsertText: 'filterBankSize',\n\t\t\t\t\t\tsortText: 'a',\n\t\t\t\t\t\trange\n\t\t\t\t\t}, {\n\t\t\t\t\t\tkind: CompletionItemKind.Text,\n\t\t\t\t\t\tlabel: 'filter',\n\t\t\t\t\t\tinsertText: 'filter',\n\t\t\t\t\t\tsortText: 'b',\n\t\t\t\t\t\trange\n\t\t\t\t\t}]\n\t\t\t\t};\n\t\t\t}\n\t\t}));\n\n\t\teditor.setValue('filte');\n\t\teditor.setSelection(new Selection(1, 6, 1, 6));\n\n\t\tconst p1 = Event.toPromise(controller.model.onDidSuggest);\n\t\tcontroller.triggerSuggest();\n\n\t\tconst { completionModel } = await p1;\n\t\tassert.strictEqual(completionModel.items.length, 2);\n\n\t\tconst [first, second] = completionModel.items;\n\t\tassert.strictEqual(first.textLabel, 'filterBankSize');\n\t\tassert.strictEqual(second.textLabel, 'filter');\n\n\t\tassert.deepStrictEqual(editor.getSelection(), new Selection(1, 6, 1, 6));\n\t\teditor.trigger('keyboard', 'type', { text: 'r' }); // now filter \"overtakes\" filterBankSize because it is fully matched\n\t\tassert.deepStrictEqual(editor.getSelection(), new Selection(1, 7, 1, 7));\n\n\t\tcontroller.acceptSelectedSuggestion(false, false);\n\t\tassert.strictEqual(editor.getValue(), 'filter');\n\t});\n\n\ttest('Fast autocomple typing selects the previous autocomplete suggestion, #71795', async function () {\n\t\tdisposables.add(languageFeaturesService.completionProvider.register({ scheme: 'test-ctrl' }, {\n\t\t\t_debugDisplayName: 'test',\n\t\t\tprovideCompletionItems(doc, pos) {\n\n\t\t\t\tconst word = doc.getWordUntilPosition(pos);\n\t\t\t\tconst range = new Range(pos.lineNumber, word.startColumn, pos.lineNumber, word.endColumn);\n\n\t\t\t\treturn {\n\t\t\t\t\tsuggestions: [{\n\t\t\t\t\t\tkind: CompletionItemKind.Text,\n\t\t\t\t\t\tlabel: 'false',\n\t\t\t\t\t\tinsertText: 'false',\n\t\t\t\t\t\trange\n\t\t\t\t\t}, {\n\t\t\t\t\t\tkind: CompletionItemKind.Text,\n\t\t\t\t\t\tlabel: 'float',\n\t\t\t\t\t\tinsertText: 'float',\n\t\t\t\t\t\trange\n\t\t\t\t\t}, {\n\t\t\t\t\t\tkind: CompletionItemKind.Text,\n\t\t\t\t\t\tlabel: 'for',\n\t\t\t\t\t\tinsertText: 'for',\n\t\t\t\t\t\trange\n\t\t\t\t\t}, {\n\t\t\t\t\t\tkind: CompletionItemKind.Text,\n\t\t\t\t\t\tlabel: 'foreach',\n\t\t\t\t\t\tinsertText: 'foreach',\n\t\t\t\t\t\trange\n\t\t\t\t\t}]\n\t\t\t\t};\n\t\t\t}\n\t\t}));\n\n\t\teditor.setValue('f');\n\t\teditor.setSelection(new Selection(1, 2, 1, 2));\n\n\t\tconst p1 = Event.toPromise(controller.model.onDidSuggest);\n\t\tcontroller.triggerSuggest();\n\n\t\tconst { completionModel } = await p1;\n\t\tassert.strictEqual(completionModel.items.length, 4);\n\n\t\tconst [first, second, third, fourth] = completionModel.items;\n\t\tassert.strictEqual(first.textLabel, 'false');\n\t\tassert.strictEqual(second.textLabel, 'float');\n\t\tassert.strictEqual(third.textLabel, 'for');\n\t\tassert.strictEqual(fourth.textLabel, 'foreach');\n\n\t\tassert.deepStrictEqual(editor.getSelection(), new Selection(1, 2, 1, 2));\n\t\teditor.trigger('keyboard', 'type', { text: 'o' }); // filters`false` and `float`\n\t\tassert.deepStrictEqual(editor.getSelection(), new Selection(1, 3, 1, 3));\n\n\t\tcontroller.acceptSelectedSuggestion(false, false);\n\t\tassert.strictEqual(editor.getValue(), 'for');\n\t});\n\n\ttest.skip('Suggest widget gets orphaned in editor #187779', async function () {\n\n\t\tdisposables.add(languageFeaturesService.completionProvider.register({ scheme: 'test-ctrl' }, {\n\t\t\t_debugDisplayName: 'test',\n\t\t\tprovideCompletionItems(doc, pos) {\n\n\t\t\t\tconst word = doc.getLineContent(pos.lineNumber);\n\t\t\t\tconst range = new Range(pos.lineNumber, 1, pos.lineNumber, pos.column);\n\n\t\t\t\treturn {\n\t\t\t\t\tsuggestions: [{\n\t\t\t\t\t\tkind: CompletionItemKind.Text,\n\t\t\t\t\t\tlabel: word,\n\t\t\t\t\t\tinsertText: word,\n\t\t\t\t\t\trange\n\t\t\t\t\t}]\n\t\t\t\t};\n\t\t\t}\n\t\t}));\n\n\t\teditor.setValue(`console.log(example.)\\nconsole.log(EXAMPLE.not)`);\n\t\teditor.setSelection(new Selection(1, 21, 1, 21));\n\n\t\tconst p1 = Event.toPromise(controller.model.onDidSuggest);\n\t\tcontroller.triggerSuggest();\n\n\t\tawait p1;\n\n\t\tconst p2 = Event.toPromise(controller.model.onDidCancel);\n\t\tnew DeleteLinesAction().run(null!, editor);\n\n\t\tawait p2;\n\t});\n\n\ttest('Ranges where additionalTextEdits are applied are not appropriate when characters are typed #177591', async function () {\n\t\tdisposables.add(languageFeaturesService.completionProvider.register({ scheme: 'test-ctrl' }, {\n\t\t\t_debugDisplayName: 'test',\n\t\t\tprovideCompletionItems(doc, pos) {\n\t\t\t\treturn {\n\t\t\t\t\tsuggestions: [{\n\t\t\t\t\t\tkind: CompletionItemKind.Snippet,\n\t\t\t\t\t\tlabel: 'aaa',\n\t\t\t\t\t\tinsertText: 'aaa',\n\t\t\t\t\t\trange: Range.fromPositions(pos),\n\t\t\t\t\t\tadditionalTextEdits: [{\n\t\t\t\t\t\t\trange: Range.fromPositions(pos.delta(0, 10)),\n\t\t\t\t\t\t\ttext: 'aaa'\n\t\t\t\t\t\t}]\n\t\t\t\t\t}]\n\t\t\t\t};\n\t\t\t}\n\t\t}));\n\n\t\t{ // PART1 - no typing\n\t\t\teditor.setValue(`123456789123456789`);\n\t\t\teditor.setSelection(new Selection(1, 1, 1, 1));\n\t\t\tconst p1 = Event.toPromise(controller.model.onDidSuggest);\n\t\t\tcontroller.triggerSuggest();\n\n\t\t\tconst e = await p1;\n\t\t\tassert.strictEqual(e.completionModel.items.length, 1);\n\t\t\tassert.strictEqual(e.completionModel.items[0].textLabel, 'aaa');\n\n\t\t\tcontroller.acceptSelectedSuggestion(false, false);\n\n\t\t\tassert.strictEqual(editor.getValue(), 'aaa1234567891aaa23456789');\n\t\t}\n\n\t\t{ // PART2 - typing\n\t\t\teditor.setValue(`123456789123456789`);\n\t\t\teditor.setSelection(new Selection(1, 1, 1, 1));\n\t\t\tconst p1 = Event.toPromise(controller.model.onDidSuggest);\n\t\t\tcontroller.triggerSuggest();\n\n\t\t\tconst e = await p1;\n\t\t\tassert.strictEqual(e.completionModel.items.length, 1);\n\t\t\tassert.strictEqual(e.completionModel.items[0].textLabel, 'aaa');\n\n\t\t\teditor.trigger('keyboard', 'type', { text: 'aa' });\n\n\t\t\tcontroller.acceptSelectedSuggestion(false, false);\n\n\t\t\tassert.strictEqual(editor.getValue(), 'aaa1234567891aaa23456789');\n\t\t}\n\t});\n\n\ttest.skip('[Bug] \"No suggestions\" persists while typing if the completion helper is set to return an empty list for empty content#3557', async function () {\n\t\tlet requestCount = 0;\n\n\t\tdisposables.add(languageFeaturesService.completionProvider.register({ scheme: 'test-ctrl' }, {\n\t\t\t_debugDisplayName: 'test',\n\t\t\tprovideCompletionItems(doc, pos) {\n\t\t\t\trequestCount += 1;\n\n\t\t\t\tif (requestCount === 1) {\n\t\t\t\t\treturn undefined;\n\t\t\t\t}\n\n\t\t\t\treturn {\n\t\t\t\t\tsuggestions: [{\n\t\t\t\t\t\tkind: CompletionItemKind.Text,\n\t\t\t\t\t\tlabel: 'foo',\n\t\t\t\t\t\tinsertText: 'foo',\n\t\t\t\t\t\trange: new Range(pos.lineNumber, 1, pos.lineNumber, pos.column)\n\t\t\t\t\t}],\n\t\t\t\t};\n\t\t\t}\n\t\t}));\n\n\t\tconst p1 = Event.toPromise(controller.model.onDidSuggest);\n\t\tcontroller.triggerSuggest();\n\n\t\tconst e1 = await p1;\n\t\tassert.strictEqual(e1.completionModel.items.length, 0);\n\t\tassert.strictEqual(requestCount, 1);\n\n\t\tconst p2 = Event.toPromise(controller.model.onDidSuggest);\n\t\teditor.trigger('keyboard', 'type', { text: 'f' });\n\n\t\tconst e2 = await p2;\n\t\tassert.strictEqual(e2.completionModel.items.length, 1);\n\t\tassert.strictEqual(requestCount, 2);\n\n\t});\n});\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport assert from 'assert';\nimport { timeout } from '../../../../../base/common/async.js';\nimport { Event } from '../../../../../base/common/event.js';\nimport { DisposableStore } from '../../../../../base/common/lifecycle.js';\nimport { URI } from '../../../../../base/common/uri.js';\nimport { mock } from '../../../../../base/test/common/mock.js';\nimport { Range } from '../../../../common/core/range.js';\nimport { Selection } from '../../../../common/core/selection.js';\nimport { TextModel } from '../../../../common/model/textModel.js';\nimport { CompletionItemInsertTextRule, CompletionItemKind } from '../../../../common/languages.js';\nimport { IEditorWorkerService } from '../../../../common/services/editorWorker.js';\nimport { SnippetController2 } from '../../../snippet/browser/snippetController2.js';\nimport { SuggestController } from '../../browser/suggestController.js';\nimport { ISuggestMemoryService } from '../../browser/suggestMemory.js';\nimport { createTestCodeEditor, ITestCodeEditor } from '../../../../test/browser/testCodeEditor.js';\nimport { createTextModel } from '../../../../test/common/testTextModel.js';\nimport { IMenu, IMenuService } from '../../../../../platform/actions/common/actions.js';\nimport { ServiceCollection } from '../../../../../platform/instantiation/common/serviceCollection.js';\nimport { IKeybindingService } from '../../../../../platform/keybinding/common/keybinding.js';\nimport { MockKeybindingService } from '../../../../../platform/keybinding/test/common/mockKeybindingService.js';\nimport { ILabelService } from '../../../../../platform/label/common/label.js';\nimport { ILogService, NullLogService } from '../../../../../platform/log/common/log.js';\nimport { InMemoryStorageService, IStorageService } from '../../../../../platform/storage/common/storage.js';\nimport { ITelemetryService } from '../../../../../platform/telemetry/common/telemetry.js';\nimport { NullTelemetryService } from '../../../../../platform/telemetry/common/telemetryUtils.js';\nimport { IWorkspaceContextService } from '../../../../../platform/workspace/common/workspace.js';\nimport { LanguageFeaturesService } from '../../../../common/services/languageFeaturesService.js';\nimport { ILanguageFeaturesService } from '../../../../common/services/languageFeatures.js';\nimport { IEnvironmentService } from '../../../../../platform/environment/common/environment.js';\nimport { DeleteLinesAction } from '../../../linesOperations/browser/linesOperations.js';\n\nsuite('SuggestController', function () {\n\n\tconst disposables = new DisposableStore();\n\n\tlet controller: SuggestController;\n\tlet editor: ITestCodeEditor;\n\tlet model: TextModel;\n\tconst languageFeaturesService = new LanguageFeaturesService();\n\n\tteardown(function () {\n\n\t\tdisposables.clear();\n\t});\n\n\t// ensureNoDisposablesAreLeakedInTestSuite();\n\n\tsetup(function () {\n\n\t\tconst serviceCollection = new ServiceCollection(\n\t\t\t[ILanguageFeaturesService, languageFeaturesService],\n\t\t\t[ITelemetryService, NullTelemetryService],\n\t\t\t[ILogService, new NullLogService()],\n\t\t\t[IStorageService, disposables.add(new InMemoryStorageService())],\n\t\t\t[IKeybindingService, new MockKeybindingService()],\n\t\t\t[IEditorWorkerService, new class extends mock<IEditorWorkerService>() {\n\t\t\t\toverride computeWordRanges() {\n\t\t\t\t\treturn Promise.resolve({});\n\t\t\t\t}\n\t\t\t}],\n\t\t\t[ISuggestMemoryService, new class extends mock<ISuggestMemoryService>() {\n\t\t\t\toverride memorize(): void { }\n\t\t\t\toverride select(): number { return 0; }\n\t\t\t}],\n\t\t\t[IMenuService, new class extends mock<IMenuService>() {\n\t\t\t\toverride createMenu() {\n\t\t\t\t\treturn new class extends mock<IMenu>() {\n\t\t\t\t\t\toverride onDidChange = Event.None;\n\t\t\t\t\t\toverride dispose() { }\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t}],\n\t\t\t[ILabelService, new class extends mock<ILabelService>() { }],\n\t\t\t[IWorkspaceContextService, new class extends mock<IWorkspaceContextService>() { }],\n\t\t\t[IEnvironmentService, new class extends mock<IEnvironmentService>() {\n\t\t\t\toverride isBuilt: boolean = true;\n\t\t\t\toverride isExtensionDevelopment: boolean = false;\n\t\t\t}],\n\t\t);\n\n\t\tmodel = disposables.add(createTextModel('', undefined, undefined, URI.from({ scheme: 'test-ctrl', path: '/path.tst' })));\n\t\teditor = disposables.add(createTestCodeEditor(model, { serviceCollection }));\n\n\t\teditor.registerAndInstantiateContribution(SnippetController2.ID, SnippetController2);\n\t\tcontroller = editor.registerAndInstantiateContribution(SuggestController.ID, SuggestController);\n\t});\n\n\ttest('postfix completion reports incorrect position #86984', async function () {\n\t\tdisposables.add(languageFeaturesService.completionProvider.register({ scheme: 'test-ctrl' }, {\n\t\t\t_debugDisplayName: 'test',\n\t\t\tprovideCompletionItems(doc, pos) {\n\t\t\t\treturn {\n\t\t\t\t\tsuggestions: [{\n\t\t\t\t\t\tkind: CompletionItemKind.Snippet,\n\t\t\t\t\t\tlabel: 'let',\n\t\t\t\t\t\tinsertText: 'let ${1:name} = foo$0',\n\t\t\t\t\t\tinsertTextRules: CompletionItemInsertTextRule.InsertAsSnippet,\n\t\t\t\t\t\trange: { startLineNumber: 1, startColumn: 9, endLineNumber: 1, endColumn: 11 },\n\t\t\t\t\t\tadditionalTextEdits: [{\n\t\t\t\t\t\t\ttext: '',\n\t\t\t\t\t\t\trange: { startLineNumber: 1, startColumn: 5, endLineNumber: 1, endColumn: 9 }\n\t\t\t\t\t\t}]\n\t\t\t\t\t}]\n\t\t\t\t};\n\t\t\t}\n\t\t}));\n\n\t\teditor.setValue('    foo.le');\n\t\teditor.setSelection(new Selection(1, 11, 1, 11));\n\n\t\t// trigger\n\t\tconst p1 = Event.toPromise(controller.model.onDidSuggest);\n\t\tcontroller.triggerSuggest();\n\t\tawait p1;\n\n\t\t//\n\t\tconst p2 = Event.toPromise(controller.model.onDidCancel);\n\t\tcontroller.acceptSelectedSuggestion(false, false);\n\t\tawait p2;\n\n\t\tassert.strictEqual(editor.getValue(), '    let name = foo');\n\t});\n\n\ttest('use additionalTextEdits sync when possible', async function () {\n\n\t\tdisposables.add(languageFeaturesService.completionProvider.register({ scheme: 'test-ctrl' }, {\n\t\t\t_debugDisplayName: 'test',\n\t\t\tprovideCompletionItems(doc, pos) {\n\t\t\t\treturn {\n\t\t\t\t\tsuggestions: [{\n\t\t\t\t\t\tkind: CompletionItemKind.Snippet,\n\t\t\t\t\t\tlabel: 'let',\n\t\t\t\t\t\tinsertText: 'hello',\n\t\t\t\t\t\trange: Range.fromPositions(pos),\n\t\t\t\t\t\tadditionalTextEdits: [{\n\t\t\t\t\t\t\ttext: 'I came sync',\n\t\t\t\t\t\t\trange: { startLineNumber: 1, startColumn: 1, endLineNumber: 1, endColumn: 1 }\n\t\t\t\t\t\t}]\n\t\t\t\t\t}]\n\t\t\t\t};\n\t\t\t},\n\t\t\tasync resolveCompletionItem(item) {\n\t\t\t\treturn item;\n\t\t\t}\n\t\t}));\n\n\t\teditor.setValue('hello\\nhallo');\n\t\teditor.setSelection(new Selection(2, 6, 2, 6));\n\n\t\t// trigger\n\t\tconst p1 = Event.toPromise(controller.model.onDidSuggest);\n\t\tcontroller.triggerSuggest();\n\t\tawait p1;\n\n\t\t//\n\t\tconst p2 = Event.toPromise(controller.model.onDidCancel);\n\t\tcontroller.acceptSelectedSuggestion(false, false);\n\t\tawait p2;\n\n\t\t// insertText happens sync!\n\t\tassert.strictEqual(editor.getValue(), 'I came synchello\\nhallohello');\n\t});\n\n\ttest('resolve additionalTextEdits async when needed', async function () {\n\n\t\tlet resolveCallCount = 0;\n\n\t\tdisposables.add(languageFeaturesService.completionProvider.register({ scheme: 'test-ctrl' }, {\n\t\t\t_debugDisplayName: 'test',\n\t\t\tprovideCompletionItems(doc, pos) {\n\t\t\t\treturn {\n\t\t\t\t\tsuggestions: [{\n\t\t\t\t\t\tkind: CompletionItemKind.Snippet,\n\t\t\t\t\t\tlabel: 'let',\n\t\t\t\t\t\tinsertText: 'hello',\n\t\t\t\t\t\trange: Range.fromPositions(pos)\n\t\t\t\t\t}]\n\t\t\t\t};\n\t\t\t},\n\t\t\tasync resolveCompletionItem(item) {\n\t\t\t\tresolveCallCount += 1;\n\t\t\t\tawait timeout(10);\n\t\t\t\titem.additionalTextEdits = [{\n\t\t\t\t\ttext: 'I came late',\n\t\t\t\t\trange: { startLineNumber: 1, startColumn: 1, endLineNumber: 1, endColumn: 1 }\n\t\t\t\t}];\n\t\t\t\treturn item;\n\t\t\t}\n\t\t}));\n\n\t\teditor.setValue('hello\\nhallo');\n\t\teditor.setSelection(new Selection(2, 6, 2, 6));\n\n\t\t// trigger\n\t\tconst p1 = Event.toPromise(controller.model.onDidSuggest);\n\t\tcontroller.triggerSuggest();\n\t\tawait p1;\n\n\t\t//\n\t\tconst p2 = Event.toPromise(controller.model.onDidCancel);\n\t\tcontroller.acceptSelectedSuggestion(false, false);\n\t\tawait p2;\n\n\t\t// insertText happens sync!\n\t\tassert.strictEqual(editor.getValue(), 'hello\\nhallohello');\n\t\tassert.strictEqual(resolveCallCount, 1);\n\n\t\t// additional edits happened after a litte wait\n\t\tawait timeout(20);\n\t\tassert.strictEqual(editor.getValue(), 'I came latehello\\nhallohello');\n\n\t\t// single undo stop\n\t\teditor.getModel()?.undo();\n\t\tassert.strictEqual(editor.getValue(), 'hello\\nhallo');\n\t});\n\n\ttest('resolve additionalTextEdits async when needed (typing)', async function () {\n\n\t\tlet resolveCallCount = 0;\n\t\tlet resolve: Function = () => { };\n\t\tdisposables.add(languageFeaturesService.completionProvider.register({ scheme: 'test-ctrl' }, {\n\t\t\t_debugDisplayName: 'test',\n\t\t\tprovideCompletionItems(doc, pos) {\n\t\t\t\treturn {\n\t\t\t\t\tsuggestions: [{\n\t\t\t\t\t\tkind: CompletionItemKind.Snippet,\n\t\t\t\t\t\tlabel: 'let',\n\t\t\t\t\t\tinsertText: 'hello',\n\t\t\t\t\t\trange: Range.fromPositions(pos)\n\t\t\t\t\t}]\n\t\t\t\t};\n\t\t\t},\n\t\t\tasync resolveCompletionItem(item) {\n\t\t\t\tresolveCallCount += 1;\n\t\t\t\tawait new Promise(_resolve => resolve = _resolve);\n\t\t\t\titem.additionalTextEdits = [{\n\t\t\t\t\ttext: 'I came late',\n\t\t\t\t\trange: { startLineNumber: 1, startColumn: 1, endLineNumber: 1, endColumn: 1 }\n\t\t\t\t}];\n\t\t\t\treturn item;\n\t\t\t}\n\t\t}));\n\n\t\teditor.setValue('hello\\nhallo');\n\t\teditor.setSelection(new Selection(2, 6, 2, 6));\n\n\t\t// trigger\n\t\tconst p1 = Event.toPromise(controller.model.onDidSuggest);\n\t\tcontroller.triggerSuggest();\n\t\tawait p1;\n\n\t\t//\n\t\tconst p2 = Event.toPromise(controller.model.onDidCancel);\n\t\tcontroller.acceptSelectedSuggestion(false, false);\n\t\tawait p2;\n\n\t\t// insertText happens sync!\n\t\tassert.strictEqual(editor.getValue(), 'hello\\nhallohello');\n\t\tassert.strictEqual(resolveCallCount, 1);\n\n\t\t// additional edits happened after a litte wait\n\t\tassert.ok(editor.getSelection()?.equalsSelection(new Selection(2, 11, 2, 11)));\n\t\teditor.trigger('test', 'type', { text: 'TYPING' });\n\n\t\tassert.strictEqual(editor.getValue(), 'hello\\nhallohelloTYPING');\n\n\t\tresolve();\n\t\tawait timeout(10);\n\t\tassert.strictEqual(editor.getValue(), 'I came latehello\\nhallohelloTYPING');\n\t\tassert.ok(editor.getSelection()?.equalsSelection(new Selection(2, 17, 2, 17)));\n\t});\n\n\t// additional edit come late and are AFTER the selection -> cancel\n\ttest('resolve additionalTextEdits async when needed (simple conflict)', async function () {\n\n\t\tlet resolveCallCount = 0;\n\t\tlet resolve: Function = () => { };\n\t\tdisposables.add(languageFeaturesService.completionProvider.register({ scheme: 'test-ctrl' }, {\n\t\t\t_debugDisplayName: 'test',\n\t\t\tprovideCompletionItems(doc, pos) {\n\t\t\t\treturn {\n\t\t\t\t\tsuggestions: [{\n\t\t\t\t\t\tkind: CompletionItemKind.Snippet,\n\t\t\t\t\t\tlabel: 'let',\n\t\t\t\t\t\tinsertText: 'hello',\n\t\t\t\t\t\trange: Range.fromPositions(pos)\n\t\t\t\t\t}]\n\t\t\t\t};\n\t\t\t},\n\t\t\tasync resolveCompletionItem(item) {\n\t\t\t\tresolveCallCount += 1;\n\t\t\t\tawait new Promise(_resolve => resolve = _resolve);\n\t\t\t\titem.additionalTextEdits = [{\n\t\t\t\t\ttext: 'I came late',\n\t\t\t\t\trange: { startLineNumber: 1, startColumn: 6, endLineNumber: 1, endColumn: 6 }\n\t\t\t\t}];\n\t\t\t\treturn item;\n\t\t\t}\n\t\t}));\n\n\t\teditor.setValue('');\n\t\teditor.setSelection(new Selection(1, 1, 1, 1));\n\n\t\t// trigger\n\t\tconst p1 = Event.toPromise(controller.model.onDidSuggest);\n\t\tcontroller.triggerSuggest();\n\t\tawait p1;\n\n\t\t//\n\t\tconst p2 = Event.toPromise(controller.model.onDidCancel);\n\t\tcontroller.acceptSelectedSuggestion(false, false);\n\t\tawait p2;\n\n\t\t// insertText happens sync!\n\t\tassert.strictEqual(editor.getValue(), 'hello');\n\t\tassert.strictEqual(resolveCallCount, 1);\n\n\t\tresolve();\n\t\tawait timeout(10);\n\t\tassert.strictEqual(editor.getValue(), 'hello');\n\t});\n\n\t// additional edit come late and are AFTER the position at which the user typed -> cancelled\n\ttest('resolve additionalTextEdits async when needed (conflict)', async function () {\n\n\t\tlet resolveCallCount = 0;\n\t\tlet resolve: Function = () => { };\n\t\tdisposables.add(languageFeaturesService.completionProvider.register({ scheme: 'test-ctrl' }, {\n\t\t\t_debugDisplayName: 'test',\n\t\t\tprovideCompletionItems(doc, pos) {\n\t\t\t\treturn {\n\t\t\t\t\tsuggestions: [{\n\t\t\t\t\t\tkind: CompletionItemKind.Snippet,\n\t\t\t\t\t\tlabel: 'let',\n\t\t\t\t\t\tinsertText: 'hello',\n\t\t\t\t\t\trange: Range.fromPositions(pos)\n\t\t\t\t\t}]\n\t\t\t\t};\n\t\t\t},\n\t\t\tasync resolveCompletionItem(item) {\n\t\t\t\tresolveCallCount += 1;\n\t\t\t\tawait new Promise(_resolve => resolve = _resolve);\n\t\t\t\titem.additionalTextEdits = [{\n\t\t\t\t\ttext: 'I came late',\n\t\t\t\t\trange: { startLineNumber: 1, startColumn: 2, endLineNumber: 1, endColumn: 2 }\n\t\t\t\t}];\n\t\t\t\treturn item;\n\t\t\t}\n\t\t}));\n\n\t\teditor.setValue('hello\\nhallo');\n\t\teditor.setSelection(new Selection(2, 6, 2, 6));\n\n\t\t// trigger\n\t\tconst p1 = Event.toPromise(controller.model.onDidSuggest);\n\t\tcontroller.triggerSuggest();\n\t\tawait p1;\n\n\t\t//\n\t\tconst p2 = Event.toPromise(controller.model.onDidCancel);\n\t\tcontroller.acceptSelectedSuggestion(false, false);\n\t\tawait p2;\n\n\t\t// insertText happens sync!\n\t\tassert.strictEqual(editor.getValue(), 'hello\\nhallohello');\n\t\tassert.strictEqual(resolveCallCount, 1);\n\n\t\t// additional edits happened after a litte wait\n\t\teditor.setSelection(new Selection(1, 1, 1, 1));\n\t\teditor.trigger('test', 'type', { text: 'TYPING' });\n\n\t\tassert.strictEqual(editor.getValue(), 'TYPINGhello\\nhallohello');\n\n\t\tresolve();\n\t\tawait timeout(10);\n\t\tassert.strictEqual(editor.getValue(), 'TYPINGhello\\nhallohello');\n\t\tassert.ok(editor.getSelection()?.equalsSelection(new Selection(1, 7, 1, 7)));\n\t});\n\n\ttest('resolve additionalTextEdits async when needed (cancel)', async function () {\n\n\t\tconst resolve: Function[] = [];\n\t\tdisposables.add(languageFeaturesService.completionProvider.register({ scheme: 'test-ctrl' }, {\n\t\t\t_debugDisplayName: 'test',\n\t\t\tprovideCompletionItems(doc, pos) {\n\t\t\t\treturn {\n\t\t\t\t\tsuggestions: [{\n\t\t\t\t\t\tkind: CompletionItemKind.Snippet,\n\t\t\t\t\t\tlabel: 'let',\n\t\t\t\t\t\tinsertText: 'hello',\n\t\t\t\t\t\trange: Range.fromPositions(pos)\n\t\t\t\t\t}, {\n\t\t\t\t\t\tkind: CompletionItemKind.Snippet,\n\t\t\t\t\t\tlabel: 'let',\n\t\t\t\t\t\tinsertText: 'hallo',\n\t\t\t\t\t\trange: Range.fromPositions(pos)\n\t\t\t\t\t}]\n\t\t\t\t};\n\t\t\t},\n\t\t\tasync resolveCompletionItem(item) {\n\t\t\t\tawait new Promise(_resolve => resolve.push(_resolve));\n\t\t\t\titem.additionalTextEdits = [{\n\t\t\t\t\ttext: 'additionalTextEdits',\n\t\t\t\t\trange: { startLineNumber: 1, startColumn: 2, endLineNumber: 1, endColumn: 2 }\n\t\t\t\t}];\n\t\t\t\treturn item;\n\t\t\t}\n\t\t}));\n\n\t\teditor.setValue('abc');\n\t\teditor.setSelection(new Selection(1, 1, 1, 1));\n\n\t\t// trigger\n\t\tconst p1 = Event.toPromise(controller.model.onDidSuggest);\n\t\tcontroller.triggerSuggest();\n\t\tawait p1;\n\n\t\t//\n\t\tconst p2 = Event.toPromise(controller.model.onDidCancel);\n\t\tcontroller.acceptSelectedSuggestion(true, false);\n\t\tawait p2;\n\n\t\t// insertText happens sync!\n\t\tassert.strictEqual(editor.getValue(), 'helloabc');\n\n\t\t// next\n\t\tcontroller.acceptNextSuggestion();\n\n\t\t// resolve additional edits (MUST be cancelled)\n\t\tresolve.forEach(fn => fn);\n\t\tresolve.length = 0;\n\t\tawait timeout(10);\n\n\t\t// next suggestion used\n\t\tassert.strictEqual(editor.getValue(), 'halloabc');\n\t});\n\n\ttest('Completion edits are applied inconsistently when additionalTextEdits and textEdit start at the same offset #143888', async function () {\n\n\n\t\tdisposables.add(languageFeaturesService.completionProvider.register({ scheme: 'test-ctrl' }, {\n\t\t\t_debugDisplayName: 'test',\n\t\t\tprovideCompletionItems(doc, pos) {\n\t\t\t\treturn {\n\t\t\t\t\tsuggestions: [{\n\t\t\t\t\t\tkind: CompletionItemKind.Text,\n\t\t\t\t\t\tlabel: 'MyClassName',\n\t\t\t\t\t\tinsertText: 'MyClassName',\n\t\t\t\t\t\trange: Range.fromPositions(pos),\n\t\t\t\t\t\tadditionalTextEdits: [{\n\t\t\t\t\t\t\trange: Range.fromPositions(pos),\n\t\t\t\t\t\t\ttext: 'import \"my_class.txt\";\\n'\n\t\t\t\t\t\t}]\n\t\t\t\t\t}]\n\t\t\t\t};\n\t\t\t}\n\t\t}));\n\n\t\teditor.setValue('');\n\t\teditor.setSelection(new Selection(1, 1, 1, 1));\n\n\t\t// trigger\n\t\tconst p1 = Event.toPromise(controller.model.onDidSuggest);\n\t\tcontroller.triggerSuggest();\n\t\tawait p1;\n\n\t\t//\n\t\tconst p2 = Event.toPromise(controller.model.onDidCancel);\n\t\tcontroller.acceptSelectedSuggestion(true, false);\n\t\tawait p2;\n\n\t\t// insertText happens sync!\n\t\tassert.strictEqual(editor.getValue(), 'import \"my_class.txt\";\\nMyClassName');\n\n\t});\n\n\ttest('Pressing enter on autocomplete should always apply the selected dropdown completion, not a different, hidden one #161883', async function () {\n\t\tdisposables.add(languageFeaturesService.completionProvider.register({ scheme: 'test-ctrl' }, {\n\t\t\t_debugDisplayName: 'test',\n\t\t\tprovideCompletionItems(doc, pos) {\n\n\t\t\t\tconst word = doc.getWordUntilPosition(pos);\n\t\t\t\tconst range = new Range(pos.lineNumber, word.startColumn, pos.lineNumber, word.endColumn);\n\n\t\t\t\treturn {\n\t\t\t\t\tsuggestions: [{\n\t\t\t\t\t\tkind: CompletionItemKind.Text,\n\t\t\t\t\t\tlabel: 'filterBankSize',\n\t\t\t\t\t\tinsertText: 'filterBankSize',\n\t\t\t\t\t\tsortText: 'a',\n\t\t\t\t\t\trange\n\t\t\t\t\t}, {\n\t\t\t\t\t\tkind: CompletionItemKind.Text,\n\t\t\t\t\t\tlabel: 'filter',\n\t\t\t\t\t\tinsertText: 'filter',\n\t\t\t\t\t\tsortText: 'b',\n\t\t\t\t\t\trange\n\t\t\t\t\t}]\n\t\t\t\t};\n\t\t\t}\n\t\t}));\n\n\t\teditor.setValue('filte');\n\t\teditor.setSelection(new Selection(1, 6, 1, 6));\n\n\t\tconst p1 = Event.toPromise(controller.model.onDidSuggest);\n\t\tcontroller.triggerSuggest();\n\n\t\tconst { completionModel } = await p1;\n\t\tassert.strictEqual(completionModel.items.length, 2);\n\n\t\tconst [first, second] = completionModel.items;\n\t\tassert.strictEqual(first.textLabel, 'filterBankSize');\n\t\tassert.strictEqual(second.textLabel, 'filter');\n\n\t\tassert.deepStrictEqual(editor.getSelection(), new Selection(1, 6, 1, 6));\n\t\teditor.trigger('keyboard', 'type', { text: 'r' }); // now filter \"overtakes\" filterBankSize because it is fully matched\n\t\tassert.deepStrictEqual(editor.getSelection(), new Selection(1, 7, 1, 7));\n\n\t\tcontroller.acceptSelectedSuggestion(false, false);\n\t\tassert.strictEqual(editor.getValue(), 'filter');\n\t});\n\n\ttest('Fast autocomple typing selects the previous autocomplete suggestion, #71795', async function () {\n\t\tdisposables.add(languageFeaturesService.completionProvider.register({ scheme: 'test-ctrl' }, {\n\t\t\t_debugDisplayName: 'test',\n\t\t\tprovideCompletionItems(doc, pos) {\n\n\t\t\t\tconst word = doc.getWordUntilPosition(pos);\n\t\t\t\tconst range = new Range(pos.lineNumber, word.startColumn, pos.lineNumber, word.endColumn);\n\n\t\t\t\treturn {\n\t\t\t\t\tsuggestions: [{\n\t\t\t\t\t\tkind: CompletionItemKind.Text,\n\t\t\t\t\t\tlabel: 'false',\n\t\t\t\t\t\tinsertText: 'false',\n\t\t\t\t\t\trange\n\t\t\t\t\t}, {\n\t\t\t\t\t\tkind: CompletionItemKind.Text,\n\t\t\t\t\t\tlabel: 'float',\n\t\t\t\t\t\tinsertText: 'float',\n\t\t\t\t\t\trange\n\t\t\t\t\t}, {\n\t\t\t\t\t\tkind: CompletionItemKind.Text,\n\t\t\t\t\t\tlabel: 'for',\n\t\t\t\t\t\tinsertText: 'for',\n\t\t\t\t\t\trange\n\t\t\t\t\t}, {\n\t\t\t\t\t\tkind: CompletionItemKind.Text,\n\t\t\t\t\t\tlabel: 'foreach',\n\t\t\t\t\t\tinsertText: 'foreach',\n\t\t\t\t\t\trange\n\t\t\t\t\t}]\n\t\t\t\t};\n\t\t\t}\n\t\t}));\n\n\t\teditor.setValue('f');\n\t\teditor.setSelection(new Selection(1, 2, 1, 2));\n\n\t\tconst p1 = Event.toPromise(controller.model.onDidSuggest);\n\t\tcontroller.triggerSuggest();\n\n\t\tconst { completionModel } = await p1;\n\t\tassert.strictEqual(completionModel.items.length, 4);\n\n\t\tconst [first, second, third, fourth] = completionModel.items;\n\t\tassert.strictEqual(first.textLabel, 'false');\n\t\tassert.strictEqual(second.textLabel, 'float');\n\t\tassert.strictEqual(third.textLabel, 'for');\n\t\tassert.strictEqual(fourth.textLabel, 'foreach');\n\n\t\tassert.deepStrictEqual(editor.getSelection(), new Selection(1, 2, 1, 2));\n\t\teditor.trigger('keyboard', 'type', { text: 'o' }); // filters`false` and `float`\n\t\tassert.deepStrictEqual(editor.getSelection(), new Selection(1, 3, 1, 3));\n\n\t\tcontroller.acceptSelectedSuggestion(false, false);\n\t\tassert.strictEqual(editor.getValue(), 'for');\n\t});\n\n\ttest.skip('Suggest widget gets orphaned in editor #187779', async function () {\n\n\t\tdisposables.add(languageFeaturesService.completionProvider.register({ scheme: 'test-ctrl' }, {\n\t\t\t_debugDisplayName: 'test',\n\t\t\tprovideCompletionItems(doc, pos) {\n\n\t\t\t\tconst word = doc.getLineContent(pos.lineNumber);\n\t\t\t\tconst range = new Range(pos.lineNumber, 1, pos.lineNumber, pos.column);\n\n\t\t\t\treturn {\n\t\t\t\t\tsuggestions: [{\n\t\t\t\t\t\tkind: CompletionItemKind.Text,\n\t\t\t\t\t\tlabel: word,\n\t\t\t\t\t\tinsertText: word,\n\t\t\t\t\t\trange\n\t\t\t\t\t}]\n\t\t\t\t};\n\t\t\t}\n\t\t}));\n\n\t\teditor.setValue(`console.log(example.)\\nconsole.log(EXAMPLE.not)`);\n\t\teditor.setSelection(new Selection(1, 21, 1, 21));\n\n\t\tconst p1 = Event.toPromise(controller.model.onDidSuggest);\n\t\tcontroller.triggerSuggest();\n\n\t\tawait p1;\n\n\t\tconst p2 = Event.toPromise(controller.model.onDidCancel);\n\t\tnew DeleteLinesAction().run(null!, editor);\n\n\t\tawait p2;\n\t});\n\n\ttest('Ranges where additionalTextEdits are applied are not appropriate when characters are typed #177591', async function () {\n\t\tdisposables.add(languageFeaturesService.completionProvider.register({ scheme: 'test-ctrl' }, {\n\t\t\t_debugDisplayName: 'test',\n\t\t\tprovideCompletionItems(doc, pos) {\n\t\t\t\treturn {\n\t\t\t\t\tsuggestions: [{\n\t\t\t\t\t\tkind: CompletionItemKind.Snippet,\n\t\t\t\t\t\tlabel: 'aaa',\n\t\t\t\t\t\tinsertText: 'aaa',\n\t\t\t\t\t\trange: Range.fromPositions(pos),\n\t\t\t\t\t\tadditionalTextEdits: [{\n\t\t\t\t\t\t\trange: Range.fromPositions(pos.delta(0, 10)),\n\t\t\t\t\t\t\ttext: 'aaa'\n\t\t\t\t\t\t}]\n\t\t\t\t\t}]\n\t\t\t\t};\n\t\t\t}\n\t\t}));\n\n\t\t{ // PART1 - no typing\n\t\t\teditor.setValue(`123456789123456789`);\n\t\t\teditor.setSelection(new Selection(1, 1, 1, 1));\n\t\t\tconst p1 = Event.toPromise(controller.model.onDidSuggest);\n\t\t\tcontroller.triggerSuggest();\n\n\t\t\tconst e = await p1;\n\t\t\tassert.strictEqual(e.completionModel.items.length, 1);\n\t\t\tassert.strictEqual(e.completionModel.items[0].textLabel, 'aaa');\n\n\t\t\tcontroller.acceptSelectedSuggestion(false, false);\n\n\t\t\tassert.strictEqual(editor.getValue(), 'aaa1234567891aaa23456789');\n\t\t}\n\n\t\t{ // PART2 - typing\n\t\t\teditor.setValue(`123456789123456789`);\n\t\t\teditor.setSelection(new Selection(1, 1, 1, 1));\n\t\t\tconst p1 = Event.toPromise(controller.model.onDidSuggest);\n\t\t\tcontroller.triggerSuggest();\n\n\t\t\tconst e = await p1;\n\t\t\tassert.strictEqual(e.completionModel.items.length, 1);\n\t\t\tassert.strictEqual(e.completionModel.items[0].textLabel, 'aaa');\n\n\t\t\teditor.trigger('keyboard', 'type', { text: 'aa' });\n\n\t\t\tcontroller.acceptSelectedSuggestion(false, false);\n\n\t\t\tassert.strictEqual(editor.getValue(), 'aaa1234567891aaa23456789');\n\t\t}\n\t});\n\n\ttest.skip('[Bug] \"No suggestions\" persists while typing if the completion helper is set to return an empty list for empty content#3557', async function () {\n\t\tlet requestCount = 0;\n\n\t\tdisposables.add(languageFeaturesService.completionProvider.register({ scheme: 'test-ctrl' }, {\n\t\t\t_debugDisplayName: 'test',\n\t\t\tprovideCompletionItems(doc, pos) {\n\t\t\t\trequestCount += 1;\n\n\t\t\t\tif (requestCount === 1) {\n\t\t\t\t\treturn undefined;\n\t\t\t\t}\n\n\t\t\t\treturn {\n\t\t\t\t\tsuggestions: [{\n\t\t\t\t\t\tkind: CompletionItemKind.Text,\n\t\t\t\t\t\tlabel: 'foo',\n\t\t\t\t\t\tinsertText: 'foo',\n\t\t\t\t\t\trange: new Range(pos.lineNumber, 1, pos.lineNumber, pos.column)\n\t\t\t\t\t}],\n\t\t\t\t};\n\t\t\t}\n\t\t}));\n\n\t\tconst p1 = Event.toPromise(controller.model.onDidSuggest);\n\t\tcontroller.triggerSuggest();\n\n\t\tconst e1 = await p1;\n\t\tassert.strictEqual(e1.completionModel.items.length, 0);\n\t\tassert.strictEqual(requestCount, 1);\n\n\t\tconst p2 = Event.toPromise(controller.model.onDidSuggest);\n\t\teditor.trigger('keyboard', 'type', { text: 'f' });\n\n\t\tconst e2 = await p2;\n\t\tassert.strictEqual(e2.completionModel.items.length, 1);\n\t\tassert.strictEqual(requestCount, 2);\n\n\t});\n});\n"]}