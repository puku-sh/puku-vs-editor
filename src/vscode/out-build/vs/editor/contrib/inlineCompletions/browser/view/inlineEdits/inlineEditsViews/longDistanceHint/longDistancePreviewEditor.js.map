{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/editor/contrib/inlineCompletions/browser/view/inlineEdits/inlineEditsViews/longDistanceHint/longDistancePreviewEditor.ts","vs/editor/contrib/inlineCompletions/browser/view/inlineEdits/inlineEditsViews/longDistanceHint/longDistancePreviewEditor.ts"],"names":[],"mappings":"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","file":"longDistancePreviewEditor.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { n } from '../../../../../../../../base/browser/dom.js';\nimport { Disposable } from '../../../../../../../../base/common/lifecycle.js';\nimport { IObservable, derived, constObservable, IReader, autorun, observableValue } from '../../../../../../../../base/common/observable.js';\nimport { IInstantiationService } from '../../../../../../../../platform/instantiation/common/instantiation.js';\nimport { ICodeEditor } from '../../../../../../../browser/editorBrowser.js';\nimport { ObservableCodeEditor, observableCodeEditor } from '../../../../../../../browser/observableCodeEditor.js';\nimport { EmbeddedCodeEditorWidget } from '../../../../../../../browser/widget/codeEditor/embeddedCodeEditorWidget.js';\nimport { IDimension } from '../../../../../../../common/core/2d/dimension.js';\nimport { Position } from '../../../../../../../common/core/position.js';\nimport { Range } from '../../../../../../../common/core/range.js';\nimport { LineRange } from '../../../../../../../common/core/ranges/lineRange.js';\nimport { OffsetRange } from '../../../../../../../common/core/ranges/offsetRange.js';\nimport { DetailedLineRangeMapping } from '../../../../../../../common/diff/rangeMapping.js';\nimport { IModelDeltaDecoration, ITextModel } from '../../../../../../../common/model.js';\nimport { ModelDecorationOptions } from '../../../../../../../common/model/textModel.js';\nimport { InlineCompletionContextKeys } from '../../../../controller/inlineCompletionContextKeys.js';\nimport { InlineEditsGutterIndicator, InlineEditsGutterIndicatorData, InlineSuggestionGutterMenuData, SimpleInlineSuggestModel } from '../../components/gutterIndicatorView.js';\nimport { InlineEditTabAction } from '../../inlineEditsViewInterface.js';\nimport { classNames, maxContentWidthInRange } from '../../utils/utils.js';\n\nexport interface ILongDistancePreviewProps {\n\tdiff: DetailedLineRangeMapping[];\n\tmodel: SimpleInlineSuggestModel;\n\tsuggestInfo: InlineSuggestionGutterMenuData;\n}\n\nexport class LongDistancePreviewEditor extends Disposable {\n\tpublic readonly previewEditor;\n\tprivate readonly _previewEditorObs;\n\n\tprivate readonly _previewRef = n.ref<HTMLDivElement>();\n\tpublic readonly element = n.div({ class: 'preview', style: { /*pointerEvents: 'none'*/ }, ref: this._previewRef });\n\n\tprivate _parentEditorObs: ObservableCodeEditor;\n\n\tconstructor(\n\t\tprivate readonly _previewTextModel: ITextModel,\n\t\tprivate readonly _properties: IObservable<ILongDistancePreviewProps | undefined>,\n\t\tprivate readonly _parentEditor: ICodeEditor,\n\t\tprivate readonly _tabAction: IObservable<InlineEditTabAction>,\n\t\t@IInstantiationService private readonly _instantiationService: IInstantiationService,\n\t) {\n\t\tsuper();\n\n\t\tthis.previewEditor = this._register(this._createPreviewEditor());\n\t\tthis._parentEditorObs = observableCodeEditor(this._parentEditor);\n\n\t\tthis._register(autorun(reader => {\n\t\t\tthis.previewEditor.setModel(this._state.read(reader)?.textModel || null);\n\t\t}));\n\n\t\tthis._previewEditorObs = observableCodeEditor(this.previewEditor);\n\t\tthis._register(this._previewEditorObs.setDecorations(derived(reader => {\n\t\t\tconst state = this._state.read(reader);\n\t\t\tconst decorations = this._editorDecorations.read(reader);\n\t\t\treturn (state?.mode === 'original' ? decorations?.originalDecorations : decorations?.modifiedDecorations) ?? [];\n\t\t})));\n\n\t\tthis._register(autorun(reader => {\n\t\t\tconst state = this._properties.read(reader);\n\t\t\tif (!state) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t// Ensure there is enough space to the left of the line number for the gutter indicator to fits.\n\t\t\tconst lineNumberDigets = state.diff[0].modified.startLineNumber.toString().length;\n\t\t\tthis.previewEditor.updateOptions({ lineNumbersMinChars: lineNumberDigets + 1 });\n\t\t}));\n\n\t\tthis._register(this._instantiationService.createInstance(\n\t\t\tInlineEditsGutterIndicator,\n\t\t\tthis._previewEditorObs,\n\t\t\tderived(reader => {\n\t\t\t\tconst state = this._properties.read(reader);\n\t\t\t\tif (!state) { return undefined; }\n\t\t\t\treturn new InlineEditsGutterIndicatorData(\n\t\t\t\t\tstate.suggestInfo,\n\t\t\t\t\tLineRange.ofLength(state.diff[0].original.startLineNumber, 1),\n\t\t\t\t\tstate.model,\n\t\t\t\t);\n\t\t\t}),\n\t\t\tthis._tabAction,\n\t\t\tconstObservable(0),\n\t\t\tconstObservable(false),\n\t\t\tobservableValue(this, false),\n\t\t));\n\n\t\tthis.updatePreviewEditorEffect.recomputeInitiallyAndOnChange(this._store);\n\t}\n\n\tprivate readonly _state = derived(this, reader => {\n\t\tconst props = this._properties.read(reader);\n\t\tif (!props) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\tif (props.diff[0].innerChanges?.every(c => c.modifiedRange.isEmpty())) {\n\t\t\treturn {\n\t\t\t\tdiff: props.diff,\n\t\t\t\tvisibleLineRange: LineRange.ofLength(props.diff[0].original.startLineNumber, 1),\n\t\t\t\ttextModel: this._parentEditorObs.model.read(reader),\n\t\t\t\tmode: 'original' as const,\n\t\t\t};\n\t\t} else {\n\t\t\treturn {\n\t\t\t\tdiff: props.diff,\n\t\t\t\tvisibleLineRange: LineRange.ofLength(props.diff[0].modified.startLineNumber, 1),\n\t\t\t\ttextModel: this._previewTextModel,\n\t\t\t\tmode: 'modified' as const,\n\t\t\t};\n\t\t}\n\t});\n\n\tprivate _createPreviewEditor() {\n\t\treturn this._instantiationService.createInstance(\n\t\t\tEmbeddedCodeEditorWidget,\n\t\t\tthis._previewRef.element,\n\t\t\t{\n\t\t\t\tglyphMargin: false,\n\t\t\t\tlineNumbers: 'on',\n\t\t\t\tminimap: { enabled: false },\n\t\t\t\tguides: {\n\t\t\t\t\tindentation: false,\n\t\t\t\t\tbracketPairs: false,\n\t\t\t\t\tbracketPairsHorizontal: false,\n\t\t\t\t\thighlightActiveIndentation: false,\n\t\t\t\t},\n\n\t\t\t\trulers: [],\n\t\t\t\tpadding: { top: 0, bottom: 0 },\n\t\t\t\t//folding: false,\n\t\t\t\tselectOnLineNumbers: false,\n\t\t\t\tselectionHighlight: false,\n\t\t\t\tcolumnSelection: false,\n\t\t\t\toverviewRulerBorder: false,\n\t\t\t\toverviewRulerLanes: 0,\n\t\t\t\t//lineDecorationsWidth: 0,\n\t\t\t\t//lineNumbersMinChars: 0,\n\t\t\t\trevealHorizontalRightPadding: 0,\n\t\t\t\tbracketPairColorization: { enabled: true, independentColorPoolPerBracketType: false },\n\t\t\t\tscrollBeyondLastLine: false,\n\t\t\t\tscrollbar: {\n\t\t\t\t\tvertical: 'hidden',\n\t\t\t\t\thorizontal: 'hidden',\n\t\t\t\t\thandleMouseWheel: false,\n\t\t\t\t},\n\t\t\t\treadOnly: true,\n\t\t\t\twordWrap: 'off',\n\t\t\t\twordWrapOverride1: 'off',\n\t\t\t\twordWrapOverride2: 'off',\n\t\t\t},\n\t\t\t{\n\t\t\t\tcontextKeyValues: {\n\t\t\t\t\t[InlineCompletionContextKeys.inInlineEditsPreviewEditor.key]: true,\n\t\t\t\t},\n\t\t\t\tcontributions: [],\n\t\t\t},\n\t\t\tthis._parentEditor\n\t\t);\n\t}\n\n\tpublic readonly updatePreviewEditorEffect = derived(this, reader => {\n\t\t// this._widgetContent.readEffect(reader);\n\t\tthis._previewEditorObs.model.read(reader); // update when the model is set\n\n\t\tconst range = this._state.read(reader)?.visibleLineRange;\n\t\tif (!range) {\n\t\t\treturn;\n\t\t}\n\t\tconst hiddenAreas: Range[] = [];\n\t\tif (range.startLineNumber > 1) {\n\t\t\thiddenAreas.push(new Range(1, 1, range.startLineNumber - 1, 1));\n\t\t}\n\t\tif (range.endLineNumberExclusive < this._previewTextModel.getLineCount() + 1) {\n\t\t\thiddenAreas.push(new Range(range.endLineNumberExclusive, 1, this._previewTextModel.getLineCount() + 1, 1));\n\t\t}\n\t\tthis.previewEditor.setHiddenAreas(hiddenAreas, undefined, true);\n\t});\n\n\tpublic readonly horizontalContentRangeInPreviewEditorToShow = derived(this, reader => {\n\t\treturn this._getHorizontalContentRangeInPreviewEditorToShow(this.previewEditor, this._properties.read(reader)?.diff ?? [], reader);\n\t});\n\n\tpublic readonly contentHeight = derived(this, (reader) => {\n\t\tconst viewState = this._properties.read(reader);\n\t\tif (!viewState) {\n\t\t\treturn constObservable(null);\n\t\t}\n\n\t\tconst previewEditorHeight = this._previewEditorObs.observeLineHeightForLine(viewState.diff[0].modified.startLineNumber);\n\t\treturn previewEditorHeight;\n\t}).flatten();\n\n\tprivate _getHorizontalContentRangeInPreviewEditorToShow(editor: ICodeEditor, diff: DetailedLineRangeMapping[], reader: IReader) {\n\n\t\tconst r = LineRange.ofLength(diff[0].modified.startLineNumber, 1);\n\t\tconst l = this._previewEditorObs.layoutInfo.read(reader);\n\t\tconst trueContentWidth = maxContentWidthInRange(this._previewEditorObs, r, reader);\n\n\t\tconst state = this._state.read(reader);\n\t\tif (!state || !diff[0].innerChanges) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\tconst firstCharacterChange = state.mode === 'modified' ? diff[0].innerChanges[0].modifiedRange : diff[0].innerChanges[0].originalRange;\n\n\n\t\t// find the horizontal range we want to show.\n\t\t// use 5 characters before the first change, at most 1 indentation\n\t\tconst left = this._previewEditorObs.getLeftOfPosition(firstCharacterChange.getStartPosition(), reader);\n\t\tconst right = this._previewEditorObs.getLeftOfPosition(firstCharacterChange.getEndPosition(), reader);\n\n\t\tconst indentCol = editor.getModel()!.getLineFirstNonWhitespaceColumn(firstCharacterChange.startLineNumber);\n\t\tconst indentationEnd = this._previewEditorObs.getLeftOfPosition(new Position(firstCharacterChange.startLineNumber, indentCol), reader);\n\n\t\tconst preferredRangeToReveal = new OffsetRange(left, right);\n\n\t\treturn {\n\t\t\tindentationEnd,\n\t\t\tpreferredRangeToReveal,\n\t\t\tmaxEditorWidth: trueContentWidth + l.contentLeft,\n\t\t\tcontentWidth: trueContentWidth,\n\t\t\tnonContentWidth: l.contentLeft, // Width of area that is not content\n\t\t};\n\t}\n\n\tpublic layout(dimension: IDimension, desiredPreviewEditorScrollLeft: number): void {\n\t\tthis.previewEditor.layout(dimension);\n\t\tthis._previewEditorObs.editor.setScrollLeft(desiredPreviewEditorScrollLeft);\n\t}\n\n\tprivate readonly _editorDecorations = derived(this, reader => {\n\t\tconst diff2 = this._state.read(reader);\n\t\tif (!diff2) { return undefined; }\n\n\t\tconst diff = {\n\t\t\tmode: 'insertionInline' as const,\n\t\t\tdiff: diff2.diff,\n\t\t};\n\t\tconst originalDecorations: IModelDeltaDecoration[] = [];\n\t\tconst modifiedDecorations: IModelDeltaDecoration[] = [];\n\n\t\tconst diffWholeLineDeleteDecoration = ModelDecorationOptions.register({\n\t\t\tclassName: 'inlineCompletions-char-delete',\n\t\t\tdescription: 'char-delete',\n\t\t\tisWholeLine: false,\n\t\t\tzIndex: 1, // be on top of diff background decoration\n\t\t});\n\n\t\tconst diffWholeLineAddDecoration = ModelDecorationOptions.register({\n\t\t\tclassName: 'inlineCompletions-char-insert',\n\t\t\tdescription: 'char-insert',\n\t\t\tisWholeLine: true,\n\t\t});\n\n\t\tconst diffAddDecoration = ModelDecorationOptions.register({\n\t\t\tclassName: 'inlineCompletions-char-insert',\n\t\t\tdescription: 'char-insert',\n\t\t\tshouldFillLineOnLineBreak: true,\n\t\t});\n\n\t\tconst hideEmptyInnerDecorations = true; // diff.mode === 'lineReplacement';\n\t\tfor (const m of diff.diff) {\n\t\t\tif (m.modified.isEmpty || m.original.isEmpty) {\n\t\t\t\tif (!m.original.isEmpty) {\n\t\t\t\t\toriginalDecorations.push({ range: m.original.toInclusiveRange()!, options: diffWholeLineDeleteDecoration });\n\t\t\t\t}\n\t\t\t\tif (!m.modified.isEmpty) {\n\t\t\t\t\tmodifiedDecorations.push({ range: m.modified.toInclusiveRange()!, options: diffWholeLineAddDecoration });\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tfor (const i of m.innerChanges || []) {\n\t\t\t\t\t// Don't show empty markers outside the line range\n\t\t\t\t\tif (m.original.contains(i.originalRange.startLineNumber) && !(hideEmptyInnerDecorations && i.originalRange.isEmpty())) {\n\t\t\t\t\t\toriginalDecorations.push({\n\t\t\t\t\t\t\trange: i.originalRange,\n\t\t\t\t\t\t\toptions: {\n\t\t\t\t\t\t\t\tdescription: 'char-delete',\n\t\t\t\t\t\t\t\tshouldFillLineOnLineBreak: false,\n\t\t\t\t\t\t\t\tclassName: classNames(\n\t\t\t\t\t\t\t\t\t'inlineCompletions-char-delete',\n\t\t\t\t\t\t\t\t\t// i.originalRange.isSingleLine() && diff.mode === 'insertionInline' && 'single-line-inline',\n\t\t\t\t\t\t\t\t\ti.originalRange.isEmpty() && 'empty',\n\t\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\t\tzIndex: 1\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tif (m.modified.contains(i.modifiedRange.startLineNumber)) {\n\t\t\t\t\t\tmodifiedDecorations.push({\n\t\t\t\t\t\t\trange: i.modifiedRange,\n\t\t\t\t\t\t\toptions: diffAddDecoration\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn { originalDecorations, modifiedDecorations };\n\t});\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { n } from '../../../../../../../../base/browser/dom.js';\nimport { Disposable } from '../../../../../../../../base/common/lifecycle.js';\nimport { IObservable, derived, constObservable, IReader, autorun, observableValue } from '../../../../../../../../base/common/observable.js';\nimport { IInstantiationService } from '../../../../../../../../platform/instantiation/common/instantiation.js';\nimport { ICodeEditor } from '../../../../../../../browser/editorBrowser.js';\nimport { ObservableCodeEditor, observableCodeEditor } from '../../../../../../../browser/observableCodeEditor.js';\nimport { EmbeddedCodeEditorWidget } from '../../../../../../../browser/widget/codeEditor/embeddedCodeEditorWidget.js';\nimport { IDimension } from '../../../../../../../common/core/2d/dimension.js';\nimport { Position } from '../../../../../../../common/core/position.js';\nimport { Range } from '../../../../../../../common/core/range.js';\nimport { LineRange } from '../../../../../../../common/core/ranges/lineRange.js';\nimport { OffsetRange } from '../../../../../../../common/core/ranges/offsetRange.js';\nimport { DetailedLineRangeMapping } from '../../../../../../../common/diff/rangeMapping.js';\nimport { IModelDeltaDecoration, ITextModel } from '../../../../../../../common/model.js';\nimport { ModelDecorationOptions } from '../../../../../../../common/model/textModel.js';\nimport { InlineCompletionContextKeys } from '../../../../controller/inlineCompletionContextKeys.js';\nimport { InlineEditsGutterIndicator, InlineEditsGutterIndicatorData, InlineSuggestionGutterMenuData, SimpleInlineSuggestModel } from '../../components/gutterIndicatorView.js';\nimport { InlineEditTabAction } from '../../inlineEditsViewInterface.js';\nimport { classNames, maxContentWidthInRange } from '../../utils/utils.js';\n\nexport interface ILongDistancePreviewProps {\n\tdiff: DetailedLineRangeMapping[];\n\tmodel: SimpleInlineSuggestModel;\n\tsuggestInfo: InlineSuggestionGutterMenuData;\n}\n\nexport class LongDistancePreviewEditor extends Disposable {\n\tpublic readonly previewEditor;\n\tprivate readonly _previewEditorObs;\n\n\tprivate readonly _previewRef = n.ref<HTMLDivElement>();\n\tpublic readonly element = n.div({ class: 'preview', style: { /*pointerEvents: 'none'*/ }, ref: this._previewRef });\n\n\tprivate _parentEditorObs: ObservableCodeEditor;\n\n\tconstructor(\n\t\tprivate readonly _previewTextModel: ITextModel,\n\t\tprivate readonly _properties: IObservable<ILongDistancePreviewProps | undefined>,\n\t\tprivate readonly _parentEditor: ICodeEditor,\n\t\tprivate readonly _tabAction: IObservable<InlineEditTabAction>,\n\t\t@IInstantiationService private readonly _instantiationService: IInstantiationService,\n\t) {\n\t\tsuper();\n\n\t\tthis.previewEditor = this._register(this._createPreviewEditor());\n\t\tthis._parentEditorObs = observableCodeEditor(this._parentEditor);\n\n\t\tthis._register(autorun(reader => {\n\t\t\tthis.previewEditor.setModel(this._state.read(reader)?.textModel || null);\n\t\t}));\n\n\t\tthis._previewEditorObs = observableCodeEditor(this.previewEditor);\n\t\tthis._register(this._previewEditorObs.setDecorations(derived(reader => {\n\t\t\tconst state = this._state.read(reader);\n\t\t\tconst decorations = this._editorDecorations.read(reader);\n\t\t\treturn (state?.mode === 'original' ? decorations?.originalDecorations : decorations?.modifiedDecorations) ?? [];\n\t\t})));\n\n\t\tthis._register(autorun(reader => {\n\t\t\tconst state = this._properties.read(reader);\n\t\t\tif (!state) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t// Ensure there is enough space to the left of the line number for the gutter indicator to fits.\n\t\t\tconst lineNumberDigets = state.diff[0].modified.startLineNumber.toString().length;\n\t\t\tthis.previewEditor.updateOptions({ lineNumbersMinChars: lineNumberDigets + 1 });\n\t\t}));\n\n\t\tthis._register(this._instantiationService.createInstance(\n\t\t\tInlineEditsGutterIndicator,\n\t\t\tthis._previewEditorObs,\n\t\t\tderived(reader => {\n\t\t\t\tconst state = this._properties.read(reader);\n\t\t\t\tif (!state) { return undefined; }\n\t\t\t\treturn new InlineEditsGutterIndicatorData(\n\t\t\t\t\tstate.suggestInfo,\n\t\t\t\t\tLineRange.ofLength(state.diff[0].original.startLineNumber, 1),\n\t\t\t\t\tstate.model,\n\t\t\t\t);\n\t\t\t}),\n\t\t\tthis._tabAction,\n\t\t\tconstObservable(0),\n\t\t\tconstObservable(false),\n\t\t\tobservableValue(this, false),\n\t\t));\n\n\t\tthis.updatePreviewEditorEffect.recomputeInitiallyAndOnChange(this._store);\n\t}\n\n\tprivate readonly _state = derived(this, reader => {\n\t\tconst props = this._properties.read(reader);\n\t\tif (!props) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\tif (props.diff[0].innerChanges?.every(c => c.modifiedRange.isEmpty())) {\n\t\t\treturn {\n\t\t\t\tdiff: props.diff,\n\t\t\t\tvisibleLineRange: LineRange.ofLength(props.diff[0].original.startLineNumber, 1),\n\t\t\t\ttextModel: this._parentEditorObs.model.read(reader),\n\t\t\t\tmode: 'original' as const,\n\t\t\t};\n\t\t} else {\n\t\t\treturn {\n\t\t\t\tdiff: props.diff,\n\t\t\t\tvisibleLineRange: LineRange.ofLength(props.diff[0].modified.startLineNumber, 1),\n\t\t\t\ttextModel: this._previewTextModel,\n\t\t\t\tmode: 'modified' as const,\n\t\t\t};\n\t\t}\n\t});\n\n\tprivate _createPreviewEditor() {\n\t\treturn this._instantiationService.createInstance(\n\t\t\tEmbeddedCodeEditorWidget,\n\t\t\tthis._previewRef.element,\n\t\t\t{\n\t\t\t\tglyphMargin: false,\n\t\t\t\tlineNumbers: 'on',\n\t\t\t\tminimap: { enabled: false },\n\t\t\t\tguides: {\n\t\t\t\t\tindentation: false,\n\t\t\t\t\tbracketPairs: false,\n\t\t\t\t\tbracketPairsHorizontal: false,\n\t\t\t\t\thighlightActiveIndentation: false,\n\t\t\t\t},\n\n\t\t\t\trulers: [],\n\t\t\t\tpadding: { top: 0, bottom: 0 },\n\t\t\t\t//folding: false,\n\t\t\t\tselectOnLineNumbers: false,\n\t\t\t\tselectionHighlight: false,\n\t\t\t\tcolumnSelection: false,\n\t\t\t\toverviewRulerBorder: false,\n\t\t\t\toverviewRulerLanes: 0,\n\t\t\t\t//lineDecorationsWidth: 0,\n\t\t\t\t//lineNumbersMinChars: 0,\n\t\t\t\trevealHorizontalRightPadding: 0,\n\t\t\t\tbracketPairColorization: { enabled: true, independentColorPoolPerBracketType: false },\n\t\t\t\tscrollBeyondLastLine: false,\n\t\t\t\tscrollbar: {\n\t\t\t\t\tvertical: 'hidden',\n\t\t\t\t\thorizontal: 'hidden',\n\t\t\t\t\thandleMouseWheel: false,\n\t\t\t\t},\n\t\t\t\treadOnly: true,\n\t\t\t\twordWrap: 'off',\n\t\t\t\twordWrapOverride1: 'off',\n\t\t\t\twordWrapOverride2: 'off',\n\t\t\t},\n\t\t\t{\n\t\t\t\tcontextKeyValues: {\n\t\t\t\t\t[InlineCompletionContextKeys.inInlineEditsPreviewEditor.key]: true,\n\t\t\t\t},\n\t\t\t\tcontributions: [],\n\t\t\t},\n\t\t\tthis._parentEditor\n\t\t);\n\t}\n\n\tpublic readonly updatePreviewEditorEffect = derived(this, reader => {\n\t\t// this._widgetContent.readEffect(reader);\n\t\tthis._previewEditorObs.model.read(reader); // update when the model is set\n\n\t\tconst range = this._state.read(reader)?.visibleLineRange;\n\t\tif (!range) {\n\t\t\treturn;\n\t\t}\n\t\tconst hiddenAreas: Range[] = [];\n\t\tif (range.startLineNumber > 1) {\n\t\t\thiddenAreas.push(new Range(1, 1, range.startLineNumber - 1, 1));\n\t\t}\n\t\tif (range.endLineNumberExclusive < this._previewTextModel.getLineCount() + 1) {\n\t\t\thiddenAreas.push(new Range(range.endLineNumberExclusive, 1, this._previewTextModel.getLineCount() + 1, 1));\n\t\t}\n\t\tthis.previewEditor.setHiddenAreas(hiddenAreas, undefined, true);\n\t});\n\n\tpublic readonly horizontalContentRangeInPreviewEditorToShow = derived(this, reader => {\n\t\treturn this._getHorizontalContentRangeInPreviewEditorToShow(this.previewEditor, this._properties.read(reader)?.diff ?? [], reader);\n\t});\n\n\tpublic readonly contentHeight = derived(this, (reader) => {\n\t\tconst viewState = this._properties.read(reader);\n\t\tif (!viewState) {\n\t\t\treturn constObservable(null);\n\t\t}\n\n\t\tconst previewEditorHeight = this._previewEditorObs.observeLineHeightForLine(viewState.diff[0].modified.startLineNumber);\n\t\treturn previewEditorHeight;\n\t}).flatten();\n\n\tprivate _getHorizontalContentRangeInPreviewEditorToShow(editor: ICodeEditor, diff: DetailedLineRangeMapping[], reader: IReader) {\n\n\t\tconst r = LineRange.ofLength(diff[0].modified.startLineNumber, 1);\n\t\tconst l = this._previewEditorObs.layoutInfo.read(reader);\n\t\tconst trueContentWidth = maxContentWidthInRange(this._previewEditorObs, r, reader);\n\n\t\tconst state = this._state.read(reader);\n\t\tif (!state || !diff[0].innerChanges) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\tconst firstCharacterChange = state.mode === 'modified' ? diff[0].innerChanges[0].modifiedRange : diff[0].innerChanges[0].originalRange;\n\n\n\t\t// find the horizontal range we want to show.\n\t\t// use 5 characters before the first change, at most 1 indentation\n\t\tconst left = this._previewEditorObs.getLeftOfPosition(firstCharacterChange.getStartPosition(), reader);\n\t\tconst right = this._previewEditorObs.getLeftOfPosition(firstCharacterChange.getEndPosition(), reader);\n\n\t\tconst indentCol = editor.getModel()!.getLineFirstNonWhitespaceColumn(firstCharacterChange.startLineNumber);\n\t\tconst indentationEnd = this._previewEditorObs.getLeftOfPosition(new Position(firstCharacterChange.startLineNumber, indentCol), reader);\n\n\t\tconst preferredRangeToReveal = new OffsetRange(left, right);\n\n\t\treturn {\n\t\t\tindentationEnd,\n\t\t\tpreferredRangeToReveal,\n\t\t\tmaxEditorWidth: trueContentWidth + l.contentLeft,\n\t\t\tcontentWidth: trueContentWidth,\n\t\t\tnonContentWidth: l.contentLeft, // Width of area that is not content\n\t\t};\n\t}\n\n\tpublic layout(dimension: IDimension, desiredPreviewEditorScrollLeft: number): void {\n\t\tthis.previewEditor.layout(dimension);\n\t\tthis._previewEditorObs.editor.setScrollLeft(desiredPreviewEditorScrollLeft);\n\t}\n\n\tprivate readonly _editorDecorations = derived(this, reader => {\n\t\tconst diff2 = this._state.read(reader);\n\t\tif (!diff2) { return undefined; }\n\n\t\tconst diff = {\n\t\t\tmode: 'insertionInline' as const,\n\t\t\tdiff: diff2.diff,\n\t\t};\n\t\tconst originalDecorations: IModelDeltaDecoration[] = [];\n\t\tconst modifiedDecorations: IModelDeltaDecoration[] = [];\n\n\t\tconst diffWholeLineDeleteDecoration = ModelDecorationOptions.register({\n\t\t\tclassName: 'inlineCompletions-char-delete',\n\t\t\tdescription: 'char-delete',\n\t\t\tisWholeLine: false,\n\t\t\tzIndex: 1, // be on top of diff background decoration\n\t\t});\n\n\t\tconst diffWholeLineAddDecoration = ModelDecorationOptions.register({\n\t\t\tclassName: 'inlineCompletions-char-insert',\n\t\t\tdescription: 'char-insert',\n\t\t\tisWholeLine: true,\n\t\t});\n\n\t\tconst diffAddDecoration = ModelDecorationOptions.register({\n\t\t\tclassName: 'inlineCompletions-char-insert',\n\t\t\tdescription: 'char-insert',\n\t\t\tshouldFillLineOnLineBreak: true,\n\t\t});\n\n\t\tconst hideEmptyInnerDecorations = true; // diff.mode === 'lineReplacement';\n\t\tfor (const m of diff.diff) {\n\t\t\tif (m.modified.isEmpty || m.original.isEmpty) {\n\t\t\t\tif (!m.original.isEmpty) {\n\t\t\t\t\toriginalDecorations.push({ range: m.original.toInclusiveRange()!, options: diffWholeLineDeleteDecoration });\n\t\t\t\t}\n\t\t\t\tif (!m.modified.isEmpty) {\n\t\t\t\t\tmodifiedDecorations.push({ range: m.modified.toInclusiveRange()!, options: diffWholeLineAddDecoration });\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tfor (const i of m.innerChanges || []) {\n\t\t\t\t\t// Don't show empty markers outside the line range\n\t\t\t\t\tif (m.original.contains(i.originalRange.startLineNumber) && !(hideEmptyInnerDecorations && i.originalRange.isEmpty())) {\n\t\t\t\t\t\toriginalDecorations.push({\n\t\t\t\t\t\t\trange: i.originalRange,\n\t\t\t\t\t\t\toptions: {\n\t\t\t\t\t\t\t\tdescription: 'char-delete',\n\t\t\t\t\t\t\t\tshouldFillLineOnLineBreak: false,\n\t\t\t\t\t\t\t\tclassName: classNames(\n\t\t\t\t\t\t\t\t\t'inlineCompletions-char-delete',\n\t\t\t\t\t\t\t\t\t// i.originalRange.isSingleLine() && diff.mode === 'insertionInline' && 'single-line-inline',\n\t\t\t\t\t\t\t\t\ti.originalRange.isEmpty() && 'empty',\n\t\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\t\tzIndex: 1\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tif (m.modified.contains(i.modifiedRange.startLineNumber)) {\n\t\t\t\t\t\tmodifiedDecorations.push({\n\t\t\t\t\t\t\trange: i.modifiedRange,\n\t\t\t\t\t\t\toptions: diffAddDecoration\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn { originalDecorations, modifiedDecorations };\n\t});\n}\n"]}