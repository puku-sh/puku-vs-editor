{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/editor/contrib/inlineCompletions/test/browser/utils.ts","vs/editor/contrib/inlineCompletions/test/browser/utils.ts"],"names":[],"mappings":"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","file":"utils.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { timeout } from '../../../../../base/common/async.js';\nimport { CancellationToken } from '../../../../../base/common/cancellation.js';\nimport { Disposable, DisposableStore } from '../../../../../base/common/lifecycle.js';\nimport { CoreEditingCommands, CoreNavigationCommands } from '../../../../browser/coreCommands.js';\nimport { Position } from '../../../../common/core/position.js';\nimport { ITextModel } from '../../../../common/model.js';\nimport { InlineCompletion, InlineCompletionContext, InlineCompletions, InlineCompletionsProvider } from '../../../../common/languages.js';\nimport { ITestCodeEditor, TestCodeEditorInstantiationOptions, withAsyncTestCodeEditor } from '../../../../test/browser/testCodeEditor.js';\nimport { InlineCompletionsModel } from '../../browser/model/inlineCompletionsModel.js';\nimport { autorun, derived } from '../../../../../base/common/observable.js';\nimport { runWithFakedTimers } from '../../../../../base/test/common/timeTravelScheduler.js';\nimport { IAccessibilitySignalService } from '../../../../../platform/accessibilitySignal/browser/accessibilitySignalService.js';\nimport { ServiceCollection } from '../../../../../platform/instantiation/common/serviceCollection.js';\nimport { ILanguageFeaturesService } from '../../../../common/services/languageFeatures.js';\nimport { LanguageFeaturesService } from '../../../../common/services/languageFeaturesService.js';\nimport { ViewModel } from '../../../../common/viewModel/viewModelImpl.js';\nimport { InlineCompletionsController } from '../../browser/controller/inlineCompletionsController.js';\nimport { Range } from '../../../../common/core/range.js';\nimport { TextEdit } from '../../../../common/core/edits/textEdit.js';\nimport { BugIndicatingError } from '../../../../../base/common/errors.js';\nimport { PositionOffsetTransformer } from '../../../../common/core/text/positionToOffset.js';\nimport { InlineSuggestionsView } from '../../browser/view/inlineSuggestionsView.js';\n\nexport class MockInlineCompletionsProvider implements InlineCompletionsProvider {\n\tprivate returnValue: InlineCompletion[] = [];\n\tprivate delayMs: number = 0;\n\n\tprivate callHistory = new Array<unknown>();\n\tprivate calledTwiceIn50Ms = false;\n\n\tconstructor(\n\t\tpublic readonly enableForwardStability = false,\n\t) { }\n\n\tpublic setReturnValue(value: InlineCompletion | undefined, delayMs: number = 0): void {\n\t\tthis.returnValue = value ? [value] : [];\n\t\tthis.delayMs = delayMs;\n\t}\n\n\tpublic setReturnValues(values: InlineCompletion[], delayMs: number = 0): void {\n\t\tthis.returnValue = values;\n\t\tthis.delayMs = delayMs;\n\t}\n\n\tpublic getAndClearCallHistory() {\n\t\tconst history = [...this.callHistory];\n\t\tthis.callHistory = [];\n\t\treturn history;\n\t}\n\n\tpublic assertNotCalledTwiceWithin50ms() {\n\t\tif (this.calledTwiceIn50Ms) {\n\t\t\tthrow new Error('provideInlineCompletions has been called at least twice within 50ms. This should not happen.');\n\t\t}\n\t}\n\n\tprivate lastTimeMs: number | undefined = undefined;\n\n\tasync provideInlineCompletions(model: ITextModel, position: Position, context: InlineCompletionContext, token: CancellationToken): Promise<InlineCompletions> {\n\t\tconst currentTimeMs = new Date().getTime();\n\t\tif (this.lastTimeMs && currentTimeMs - this.lastTimeMs < 50) {\n\t\t\tthis.calledTwiceIn50Ms = true;\n\t\t}\n\t\tthis.lastTimeMs = currentTimeMs;\n\n\t\tthis.callHistory.push({\n\t\t\tposition: position.toString(),\n\t\t\ttriggerKind: context.triggerKind,\n\t\t\ttext: model.getValue()\n\t\t});\n\t\tconst result = new Array<InlineCompletion>();\n\t\tfor (const v of this.returnValue) {\n\t\t\tconst x = { ...v };\n\t\t\tif (!x.range) {\n\t\t\t\tx.range = model.getFullModelRange();\n\t\t\t}\n\t\t\tresult.push(x);\n\t\t}\n\n\t\tif (this.delayMs > 0) {\n\t\t\tawait timeout(this.delayMs);\n\t\t}\n\n\t\treturn { items: result, enableForwardStability: this.enableForwardStability };\n\t}\n\tdisposeInlineCompletions() { }\n\thandleItemDidShow() { }\n}\n\nexport class MockSearchReplaceCompletionsProvider implements InlineCompletionsProvider {\n\tprivate _map = new Map<string, string>();\n\n\tpublic add(search: string, replace: string): void {\n\t\tthis._map.set(search, replace);\n\t}\n\n\tasync provideInlineCompletions(model: ITextModel, position: Position, context: InlineCompletionContext, token: CancellationToken): Promise<InlineCompletions> {\n\t\tconst text = model.getValue();\n\t\tfor (const [search, replace] of this._map) {\n\t\t\tconst idx = text.indexOf(search);\n\t\t\t// replace idx...idx+text.length with replace\n\t\t\tif (idx !== -1) {\n\t\t\t\tconst range = Range.fromPositions(model.getPositionAt(idx), model.getPositionAt(idx + search.length));\n\t\t\t\treturn {\n\t\t\t\t\titems: [\n\t\t\t\t\t\t{ range, insertText: replace, isInlineEdit: true }\n\t\t\t\t\t]\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\t\treturn { items: [] };\n\t}\n\tdisposeInlineCompletions() { }\n\thandleItemDidShow() { }\n}\n\nexport class InlineEditContext extends Disposable {\n\tpublic readonly prettyViewStates = new Array<string | undefined>();\n\n\tconstructor(model: InlineCompletionsModel, private readonly editor: ITestCodeEditor) {\n\t\tsuper();\n\n\t\tconst edit = derived(reader => {\n\t\t\tconst state = model.state.read(reader);\n\t\t\treturn state ? new TextEdit(state.edits) : undefined;\n\t\t});\n\n\t\tthis._register(autorun(reader => {\n\t\t\t/** @description update */\n\t\t\tconst e = edit.read(reader);\n\t\t\tlet view: string | undefined;\n\n\t\t\tif (e) {\n\t\t\t\tview = e.toString(this.editor.getValue());\n\t\t\t} else {\n\t\t\t\tview = undefined;\n\t\t\t}\n\n\t\t\tthis.prettyViewStates.push(view);\n\t\t}));\n\t}\n\n\tpublic getAndClearViewStates(): (string | undefined)[] {\n\t\tconst arr = [...this.prettyViewStates];\n\t\tthis.prettyViewStates.length = 0;\n\t\treturn arr;\n\t}\n}\n\nexport class GhostTextContext extends Disposable {\n\tpublic readonly prettyViewStates = new Array<string | undefined>();\n\tprivate _currentPrettyViewState: string | undefined;\n\tpublic get currentPrettyViewState() {\n\t\treturn this._currentPrettyViewState;\n\t}\n\n\tconstructor(model: InlineCompletionsModel, private readonly editor: ITestCodeEditor) {\n\t\tsuper();\n\n\t\tthis._register(autorun(reader => {\n\t\t\t/** @description update */\n\t\t\tconst ghostText = model.primaryGhostText.read(reader);\n\t\t\tlet view: string | undefined;\n\t\t\tif (ghostText) {\n\t\t\t\tview = ghostText.render(this.editor.getValue(), true);\n\t\t\t} else {\n\t\t\t\tview = this.editor.getValue();\n\t\t\t}\n\n\t\t\tif (this._currentPrettyViewState !== view) {\n\t\t\t\tthis.prettyViewStates.push(view);\n\t\t\t}\n\t\t\tthis._currentPrettyViewState = view;\n\t\t}));\n\t}\n\n\tpublic getAndClearViewStates(): (string | undefined)[] {\n\t\tconst arr = [...this.prettyViewStates];\n\t\tthis.prettyViewStates.length = 0;\n\t\treturn arr;\n\t}\n\n\tpublic keyboardType(text: string): void {\n\t\tthis.editor.trigger('keyboard', 'type', { text });\n\t}\n\n\tpublic cursorUp(): void {\n\t\tthis.editor.runCommand(CoreNavigationCommands.CursorUp, null);\n\t}\n\n\tpublic cursorRight(): void {\n\t\tthis.editor.runCommand(CoreNavigationCommands.CursorRight, null);\n\t}\n\n\tpublic cursorLeft(): void {\n\t\tthis.editor.runCommand(CoreNavigationCommands.CursorLeft, null);\n\t}\n\n\tpublic cursorDown(): void {\n\t\tthis.editor.runCommand(CoreNavigationCommands.CursorDown, null);\n\t}\n\n\tpublic cursorLineEnd(): void {\n\t\tthis.editor.runCommand(CoreNavigationCommands.CursorLineEnd, null);\n\t}\n\n\tpublic leftDelete(): void {\n\t\tthis.editor.runCommand(CoreEditingCommands.DeleteLeft, null);\n\t}\n}\n\nexport interface IWithAsyncTestCodeEditorAndInlineCompletionsModel {\n\teditor: ITestCodeEditor;\n\teditorViewModel: ViewModel;\n\tmodel: InlineCompletionsModel;\n\tcontext: GhostTextContext;\n\tstore: DisposableStore;\n}\n\nexport async function withAsyncTestCodeEditorAndInlineCompletionsModel<T>(\n\ttext: string,\n\toptions: TestCodeEditorInstantiationOptions & { provider?: InlineCompletionsProvider; fakeClock?: boolean },\n\tcallback: (args: IWithAsyncTestCodeEditorAndInlineCompletionsModel) => Promise<T>): Promise<T> {\n\treturn await runWithFakedTimers({\n\t\tuseFakeTimers: options.fakeClock,\n\t}, async () => {\n\t\tconst disposableStore = new DisposableStore();\n\n\t\ttry {\n\t\t\tif (options.provider) {\n\t\t\t\tconst languageFeaturesService = new LanguageFeaturesService();\n\t\t\t\tif (!options.serviceCollection) {\n\t\t\t\t\toptions.serviceCollection = new ServiceCollection();\n\t\t\t\t}\n\t\t\t\toptions.serviceCollection.set(ILanguageFeaturesService, languageFeaturesService);\n\t\t\t\t// eslint-disable-next-line local/code-no-any-casts\n\t\t\t\toptions.serviceCollection.set(IAccessibilitySignalService, {\n\t\t\t\t\tplaySignal: async () => { },\n\t\t\t\t\tisSoundEnabled(signal: unknown) { return false; },\n\t\t\t\t} as any);\n\t\t\t\tconst d = languageFeaturesService.inlineCompletionsProvider.register({ pattern: '**' }, options.provider);\n\t\t\t\tdisposableStore.add(d);\n\t\t\t}\n\n\t\t\tlet result: T;\n\t\t\tawait withAsyncTestCodeEditor(text, options, async (editor, editorViewModel, instantiationService) => {\n\t\t\t\tinstantiationService.stubInstance(InlineSuggestionsView, {\n\t\t\t\t\tshouldShowHoverAtViewZone: () => false,\n\t\t\t\t\tdispose: () => { },\n\t\t\t\t});\n\t\t\t\tconst controller = instantiationService.createInstance(InlineCompletionsController, editor);\n\t\t\t\tconst model = controller.model.get()!;\n\t\t\t\tconst context = new GhostTextContext(model, editor);\n\t\t\t\ttry {\n\t\t\t\t\tresult = await callback({ editor, editorViewModel, model, context, store: disposableStore });\n\t\t\t\t} finally {\n\t\t\t\t\tcontext.dispose();\n\t\t\t\t\tmodel.dispose();\n\t\t\t\t\tcontroller.dispose();\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif (options.provider instanceof MockInlineCompletionsProvider) {\n\t\t\t\toptions.provider.assertNotCalledTwiceWithin50ms();\n\t\t\t}\n\n\t\t\treturn result!;\n\t\t} finally {\n\t\t\tdisposableStore.dispose();\n\t\t}\n\t});\n}\n\nexport class AnnotatedString {\n\tpublic readonly value: string;\n\tpublic readonly markers: { mark: string; idx: number }[];\n\n\tconstructor(src: string, annotations: string[] = ['↓']) {\n\t\tconst markers = findMarkers(src, annotations);\n\t\tthis.value = markers.textWithoutMarkers;\n\t\tthis.markers = markers.results;\n\t}\n\n\tgetMarkerOffset(markerIdx = 0): number {\n\t\tif (markerIdx >= this.markers.length) {\n\t\t\tthrow new BugIndicatingError(`Marker index ${markerIdx} out of bounds`);\n\t\t}\n\t\treturn this.markers[markerIdx].idx;\n\t}\n}\n\nfunction findMarkers(text: string, markers: string[]): {\n\tresults: { mark: string; idx: number }[];\n\ttextWithoutMarkers: string;\n} {\n\tconst results: { mark: string; idx: number }[] = [];\n\tlet textWithoutMarkers = '';\n\n\tmarkers.sort((a, b) => b.length - a.length);\n\n\tlet pos = 0;\n\tfor (let i = 0; i < text.length;) {\n\t\tlet foundMarker = false;\n\t\tfor (const marker of markers) {\n\t\t\tif (text.startsWith(marker, i)) {\n\t\t\t\tresults.push({ mark: marker, idx: pos });\n\t\t\t\ti += marker.length;\n\t\t\t\tfoundMarker = true;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\tif (!foundMarker) {\n\t\t\ttextWithoutMarkers += text[i];\n\t\t\tpos++;\n\t\t\ti++;\n\t\t}\n\t}\n\n\treturn { results, textWithoutMarkers };\n}\n\nexport class AnnotatedText extends AnnotatedString {\n\tprivate readonly _transformer = new PositionOffsetTransformer(this.value);\n\n\tgetMarkerPosition(markerIdx = 0): Position {\n\t\treturn this._transformer.getPosition(this.getMarkerOffset(markerIdx));\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { timeout } from '../../../../../base/common/async.js';\nimport { CancellationToken } from '../../../../../base/common/cancellation.js';\nimport { Disposable, DisposableStore } from '../../../../../base/common/lifecycle.js';\nimport { CoreEditingCommands, CoreNavigationCommands } from '../../../../browser/coreCommands.js';\nimport { Position } from '../../../../common/core/position.js';\nimport { ITextModel } from '../../../../common/model.js';\nimport { InlineCompletion, InlineCompletionContext, InlineCompletions, InlineCompletionsProvider } from '../../../../common/languages.js';\nimport { ITestCodeEditor, TestCodeEditorInstantiationOptions, withAsyncTestCodeEditor } from '../../../../test/browser/testCodeEditor.js';\nimport { InlineCompletionsModel } from '../../browser/model/inlineCompletionsModel.js';\nimport { autorun, derived } from '../../../../../base/common/observable.js';\nimport { runWithFakedTimers } from '../../../../../base/test/common/timeTravelScheduler.js';\nimport { IAccessibilitySignalService } from '../../../../../platform/accessibilitySignal/browser/accessibilitySignalService.js';\nimport { ServiceCollection } from '../../../../../platform/instantiation/common/serviceCollection.js';\nimport { ILanguageFeaturesService } from '../../../../common/services/languageFeatures.js';\nimport { LanguageFeaturesService } from '../../../../common/services/languageFeaturesService.js';\nimport { ViewModel } from '../../../../common/viewModel/viewModelImpl.js';\nimport { InlineCompletionsController } from '../../browser/controller/inlineCompletionsController.js';\nimport { Range } from '../../../../common/core/range.js';\nimport { TextEdit } from '../../../../common/core/edits/textEdit.js';\nimport { BugIndicatingError } from '../../../../../base/common/errors.js';\nimport { PositionOffsetTransformer } from '../../../../common/core/text/positionToOffset.js';\nimport { InlineSuggestionsView } from '../../browser/view/inlineSuggestionsView.js';\n\nexport class MockInlineCompletionsProvider implements InlineCompletionsProvider {\n\tprivate returnValue: InlineCompletion[] = [];\n\tprivate delayMs: number = 0;\n\n\tprivate callHistory = new Array<unknown>();\n\tprivate calledTwiceIn50Ms = false;\n\n\tconstructor(\n\t\tpublic readonly enableForwardStability = false,\n\t) { }\n\n\tpublic setReturnValue(value: InlineCompletion | undefined, delayMs: number = 0): void {\n\t\tthis.returnValue = value ? [value] : [];\n\t\tthis.delayMs = delayMs;\n\t}\n\n\tpublic setReturnValues(values: InlineCompletion[], delayMs: number = 0): void {\n\t\tthis.returnValue = values;\n\t\tthis.delayMs = delayMs;\n\t}\n\n\tpublic getAndClearCallHistory() {\n\t\tconst history = [...this.callHistory];\n\t\tthis.callHistory = [];\n\t\treturn history;\n\t}\n\n\tpublic assertNotCalledTwiceWithin50ms() {\n\t\tif (this.calledTwiceIn50Ms) {\n\t\t\tthrow new Error('provideInlineCompletions has been called at least twice within 50ms. This should not happen.');\n\t\t}\n\t}\n\n\tprivate lastTimeMs: number | undefined = undefined;\n\n\tasync provideInlineCompletions(model: ITextModel, position: Position, context: InlineCompletionContext, token: CancellationToken): Promise<InlineCompletions> {\n\t\tconst currentTimeMs = new Date().getTime();\n\t\tif (this.lastTimeMs && currentTimeMs - this.lastTimeMs < 50) {\n\t\t\tthis.calledTwiceIn50Ms = true;\n\t\t}\n\t\tthis.lastTimeMs = currentTimeMs;\n\n\t\tthis.callHistory.push({\n\t\t\tposition: position.toString(),\n\t\t\ttriggerKind: context.triggerKind,\n\t\t\ttext: model.getValue()\n\t\t});\n\t\tconst result = new Array<InlineCompletion>();\n\t\tfor (const v of this.returnValue) {\n\t\t\tconst x = { ...v };\n\t\t\tif (!x.range) {\n\t\t\t\tx.range = model.getFullModelRange();\n\t\t\t}\n\t\t\tresult.push(x);\n\t\t}\n\n\t\tif (this.delayMs > 0) {\n\t\t\tawait timeout(this.delayMs);\n\t\t}\n\n\t\treturn { items: result, enableForwardStability: this.enableForwardStability };\n\t}\n\tdisposeInlineCompletions() { }\n\thandleItemDidShow() { }\n}\n\nexport class MockSearchReplaceCompletionsProvider implements InlineCompletionsProvider {\n\tprivate _map = new Map<string, string>();\n\n\tpublic add(search: string, replace: string): void {\n\t\tthis._map.set(search, replace);\n\t}\n\n\tasync provideInlineCompletions(model: ITextModel, position: Position, context: InlineCompletionContext, token: CancellationToken): Promise<InlineCompletions> {\n\t\tconst text = model.getValue();\n\t\tfor (const [search, replace] of this._map) {\n\t\t\tconst idx = text.indexOf(search);\n\t\t\t// replace idx...idx+text.length with replace\n\t\t\tif (idx !== -1) {\n\t\t\t\tconst range = Range.fromPositions(model.getPositionAt(idx), model.getPositionAt(idx + search.length));\n\t\t\t\treturn {\n\t\t\t\t\titems: [\n\t\t\t\t\t\t{ range, insertText: replace, isInlineEdit: true }\n\t\t\t\t\t]\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\t\treturn { items: [] };\n\t}\n\tdisposeInlineCompletions() { }\n\thandleItemDidShow() { }\n}\n\nexport class InlineEditContext extends Disposable {\n\tpublic readonly prettyViewStates = new Array<string | undefined>();\n\n\tconstructor(model: InlineCompletionsModel, private readonly editor: ITestCodeEditor) {\n\t\tsuper();\n\n\t\tconst edit = derived(reader => {\n\t\t\tconst state = model.state.read(reader);\n\t\t\treturn state ? new TextEdit(state.edits) : undefined;\n\t\t});\n\n\t\tthis._register(autorun(reader => {\n\t\t\t/** @description update */\n\t\t\tconst e = edit.read(reader);\n\t\t\tlet view: string | undefined;\n\n\t\t\tif (e) {\n\t\t\t\tview = e.toString(this.editor.getValue());\n\t\t\t} else {\n\t\t\t\tview = undefined;\n\t\t\t}\n\n\t\t\tthis.prettyViewStates.push(view);\n\t\t}));\n\t}\n\n\tpublic getAndClearViewStates(): (string | undefined)[] {\n\t\tconst arr = [...this.prettyViewStates];\n\t\tthis.prettyViewStates.length = 0;\n\t\treturn arr;\n\t}\n}\n\nexport class GhostTextContext extends Disposable {\n\tpublic readonly prettyViewStates = new Array<string | undefined>();\n\tprivate _currentPrettyViewState: string | undefined;\n\tpublic get currentPrettyViewState() {\n\t\treturn this._currentPrettyViewState;\n\t}\n\n\tconstructor(model: InlineCompletionsModel, private readonly editor: ITestCodeEditor) {\n\t\tsuper();\n\n\t\tthis._register(autorun(reader => {\n\t\t\t/** @description update */\n\t\t\tconst ghostText = model.primaryGhostText.read(reader);\n\t\t\tlet view: string | undefined;\n\t\t\tif (ghostText) {\n\t\t\t\tview = ghostText.render(this.editor.getValue(), true);\n\t\t\t} else {\n\t\t\t\tview = this.editor.getValue();\n\t\t\t}\n\n\t\t\tif (this._currentPrettyViewState !== view) {\n\t\t\t\tthis.prettyViewStates.push(view);\n\t\t\t}\n\t\t\tthis._currentPrettyViewState = view;\n\t\t}));\n\t}\n\n\tpublic getAndClearViewStates(): (string | undefined)[] {\n\t\tconst arr = [...this.prettyViewStates];\n\t\tthis.prettyViewStates.length = 0;\n\t\treturn arr;\n\t}\n\n\tpublic keyboardType(text: string): void {\n\t\tthis.editor.trigger('keyboard', 'type', { text });\n\t}\n\n\tpublic cursorUp(): void {\n\t\tthis.editor.runCommand(CoreNavigationCommands.CursorUp, null);\n\t}\n\n\tpublic cursorRight(): void {\n\t\tthis.editor.runCommand(CoreNavigationCommands.CursorRight, null);\n\t}\n\n\tpublic cursorLeft(): void {\n\t\tthis.editor.runCommand(CoreNavigationCommands.CursorLeft, null);\n\t}\n\n\tpublic cursorDown(): void {\n\t\tthis.editor.runCommand(CoreNavigationCommands.CursorDown, null);\n\t}\n\n\tpublic cursorLineEnd(): void {\n\t\tthis.editor.runCommand(CoreNavigationCommands.CursorLineEnd, null);\n\t}\n\n\tpublic leftDelete(): void {\n\t\tthis.editor.runCommand(CoreEditingCommands.DeleteLeft, null);\n\t}\n}\n\nexport interface IWithAsyncTestCodeEditorAndInlineCompletionsModel {\n\teditor: ITestCodeEditor;\n\teditorViewModel: ViewModel;\n\tmodel: InlineCompletionsModel;\n\tcontext: GhostTextContext;\n\tstore: DisposableStore;\n}\n\nexport async function withAsyncTestCodeEditorAndInlineCompletionsModel<T>(\n\ttext: string,\n\toptions: TestCodeEditorInstantiationOptions & { provider?: InlineCompletionsProvider; fakeClock?: boolean },\n\tcallback: (args: IWithAsyncTestCodeEditorAndInlineCompletionsModel) => Promise<T>): Promise<T> {\n\treturn await runWithFakedTimers({\n\t\tuseFakeTimers: options.fakeClock,\n\t}, async () => {\n\t\tconst disposableStore = new DisposableStore();\n\n\t\ttry {\n\t\t\tif (options.provider) {\n\t\t\t\tconst languageFeaturesService = new LanguageFeaturesService();\n\t\t\t\tif (!options.serviceCollection) {\n\t\t\t\t\toptions.serviceCollection = new ServiceCollection();\n\t\t\t\t}\n\t\t\t\toptions.serviceCollection.set(ILanguageFeaturesService, languageFeaturesService);\n\t\t\t\t// eslint-disable-next-line local/code-no-any-casts\n\t\t\t\toptions.serviceCollection.set(IAccessibilitySignalService, {\n\t\t\t\t\tplaySignal: async () => { },\n\t\t\t\t\tisSoundEnabled(signal: unknown) { return false; },\n\t\t\t\t} as any);\n\t\t\t\tconst d = languageFeaturesService.inlineCompletionsProvider.register({ pattern: '**' }, options.provider);\n\t\t\t\tdisposableStore.add(d);\n\t\t\t}\n\n\t\t\tlet result: T;\n\t\t\tawait withAsyncTestCodeEditor(text, options, async (editor, editorViewModel, instantiationService) => {\n\t\t\t\tinstantiationService.stubInstance(InlineSuggestionsView, {\n\t\t\t\t\tshouldShowHoverAtViewZone: () => false,\n\t\t\t\t\tdispose: () => { },\n\t\t\t\t});\n\t\t\t\tconst controller = instantiationService.createInstance(InlineCompletionsController, editor);\n\t\t\t\tconst model = controller.model.get()!;\n\t\t\t\tconst context = new GhostTextContext(model, editor);\n\t\t\t\ttry {\n\t\t\t\t\tresult = await callback({ editor, editorViewModel, model, context, store: disposableStore });\n\t\t\t\t} finally {\n\t\t\t\t\tcontext.dispose();\n\t\t\t\t\tmodel.dispose();\n\t\t\t\t\tcontroller.dispose();\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif (options.provider instanceof MockInlineCompletionsProvider) {\n\t\t\t\toptions.provider.assertNotCalledTwiceWithin50ms();\n\t\t\t}\n\n\t\t\treturn result!;\n\t\t} finally {\n\t\t\tdisposableStore.dispose();\n\t\t}\n\t});\n}\n\nexport class AnnotatedString {\n\tpublic readonly value: string;\n\tpublic readonly markers: { mark: string; idx: number }[];\n\n\tconstructor(src: string, annotations: string[] = ['↓']) {\n\t\tconst markers = findMarkers(src, annotations);\n\t\tthis.value = markers.textWithoutMarkers;\n\t\tthis.markers = markers.results;\n\t}\n\n\tgetMarkerOffset(markerIdx = 0): number {\n\t\tif (markerIdx >= this.markers.length) {\n\t\t\tthrow new BugIndicatingError(`Marker index ${markerIdx} out of bounds`);\n\t\t}\n\t\treturn this.markers[markerIdx].idx;\n\t}\n}\n\nfunction findMarkers(text: string, markers: string[]): {\n\tresults: { mark: string; idx: number }[];\n\ttextWithoutMarkers: string;\n} {\n\tconst results: { mark: string; idx: number }[] = [];\n\tlet textWithoutMarkers = '';\n\n\tmarkers.sort((a, b) => b.length - a.length);\n\n\tlet pos = 0;\n\tfor (let i = 0; i < text.length;) {\n\t\tlet foundMarker = false;\n\t\tfor (const marker of markers) {\n\t\t\tif (text.startsWith(marker, i)) {\n\t\t\t\tresults.push({ mark: marker, idx: pos });\n\t\t\t\ti += marker.length;\n\t\t\t\tfoundMarker = true;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\tif (!foundMarker) {\n\t\t\ttextWithoutMarkers += text[i];\n\t\t\tpos++;\n\t\t\ti++;\n\t\t}\n\t}\n\n\treturn { results, textWithoutMarkers };\n}\n\nexport class AnnotatedText extends AnnotatedString {\n\tprivate readonly _transformer = new PositionOffsetTransformer(this.value);\n\n\tgetMarkerPosition(markerIdx = 0): Position {\n\t\treturn this._transformer.getPosition(this.getMarkerOffset(markerIdx));\n\t}\n}\n"]}