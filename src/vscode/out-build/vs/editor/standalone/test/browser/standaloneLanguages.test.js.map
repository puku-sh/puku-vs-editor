{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/editor/standalone/test/browser/standaloneLanguages.test.ts","vs/editor/standalone/test/browser/standaloneLanguages.test.ts"],"names":[],"mappings":"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","file":"standaloneLanguages.test.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport assert from 'assert';\nimport { Color } from '../../../../base/common/color.js';\nimport { Emitter } from '../../../../base/common/event.js';\nimport { DisposableStore } from '../../../../base/common/lifecycle.js';\nimport { ensureNoDisposablesAreLeakedInTestSuite } from '../../../../base/test/common/utils.js';\nimport { LanguageId, MetadataConsts } from '../../../common/encodedTokenAttributes.js';\nimport { IState, Token } from '../../../common/languages.js';\nimport { TokenTheme } from '../../../common/languages/supports/tokenization.js';\nimport { LanguageService } from '../../../common/services/languageService.js';\nimport { ILineTokens, IToken, TokenizationSupportAdapter, TokensProvider } from '../../browser/standaloneLanguages.js';\nimport { IStandaloneTheme, IStandaloneThemeData, IStandaloneThemeService } from '../../common/standaloneTheme.js';\nimport { UnthemedProductIconTheme } from '../../../../platform/theme/browser/iconsStyleSheet.js';\nimport { ColorIdentifier } from '../../../../platform/theme/common/colorRegistry.js';\nimport { ColorScheme } from '../../../../platform/theme/common/theme.js';\nimport { IColorTheme, IFileIconTheme, IProductIconTheme, ITokenStyle } from '../../../../platform/theme/common/themeService.js';\n\nsuite('TokenizationSupport2Adapter', () => {\n\n\tensureNoDisposablesAreLeakedInTestSuite();\n\n\tconst languageId = 'tttt';\n\t// const tokenMetadata = (LanguageId.PlainText << MetadataConsts.LANGUAGEID_OFFSET);\n\n\tclass MockTokenTheme extends TokenTheme {\n\t\tprivate counter = 0;\n\t\tconstructor() {\n\t\t\tsuper(null!, null!);\n\t\t}\n\t\tpublic override match(languageId: LanguageId, token: string): number {\n\t\t\treturn (\n\t\t\t\t((this.counter++) << MetadataConsts.FOREGROUND_OFFSET)\n\t\t\t\t| (languageId << MetadataConsts.LANGUAGEID_OFFSET)\n\t\t\t) >>> 0;\n\t\t}\n\t}\n\n\tclass MockThemeService implements IStandaloneThemeService {\n\t\tdeclare readonly _serviceBrand: undefined;\n\t\tpublic setTheme(themeName: string): string {\n\t\t\tthrow new Error('Not implemented');\n\t\t}\n\t\tpublic setAutoDetectHighContrast(autoDetectHighContrast: boolean): void {\n\t\t\tthrow new Error('Not implemented');\n\t\t}\n\t\tpublic defineTheme(themeName: string, themeData: IStandaloneThemeData): void {\n\t\t\tthrow new Error('Not implemented');\n\t\t}\n\t\tpublic getColorTheme(): IStandaloneTheme {\n\t\t\treturn {\n\t\t\t\tlabel: 'mock',\n\n\t\t\t\ttokenTheme: new MockTokenTheme(),\n\n\t\t\t\tthemeName: ColorScheme.LIGHT,\n\n\t\t\t\ttype: ColorScheme.LIGHT,\n\n\t\t\t\tgetColor: (color: ColorIdentifier, useDefault?: boolean): Color => {\n\t\t\t\t\tthrow new Error('Not implemented');\n\t\t\t\t},\n\n\t\t\t\tdefines: (color: ColorIdentifier): boolean => {\n\t\t\t\t\tthrow new Error('Not implemented');\n\t\t\t\t},\n\n\t\t\t\tgetTokenStyleMetadata: (type: string, modifiers: string[], modelLanguage: string): ITokenStyle | undefined => {\n\t\t\t\t\treturn undefined;\n\t\t\t\t},\n\n\t\t\t\tsemanticHighlighting: false,\n\n\t\t\t\ttokenColorMap: []\n\t\t\t};\n\t\t}\n\t\tsetColorMapOverride(colorMapOverride: Color[] | null): void {\n\t\t}\n\t\tpublic getFileIconTheme(): IFileIconTheme {\n\t\t\treturn {\n\t\t\t\thasFileIcons: false,\n\t\t\t\thasFolderIcons: false,\n\t\t\t\thidesExplorerArrows: false\n\t\t\t};\n\t\t}\n\n\t\tprivate _builtInProductIconTheme = new UnthemedProductIconTheme();\n\n\t\tpublic getProductIconTheme(): IProductIconTheme {\n\t\t\treturn this._builtInProductIconTheme;\n\t\t}\n\t\tpublic readonly onDidColorThemeChange = new Emitter<IColorTheme>().event;\n\t\tpublic readonly onDidFileIconThemeChange = new Emitter<IFileIconTheme>().event;\n\t\tpublic readonly onDidProductIconThemeChange = new Emitter<IProductIconTheme>().event;\n\t}\n\n\tclass MockState implements IState {\n\t\tpublic static readonly INSTANCE = new MockState();\n\t\tprivate constructor() { }\n\t\tpublic clone(): IState {\n\t\t\treturn this;\n\t\t}\n\t\tpublic equals(other: IState): boolean {\n\t\t\treturn this === other;\n\t\t}\n\t}\n\n\tfunction testBadTokensProvider(providerTokens: IToken[], expectedClassicTokens: Token[], expectedModernTokens: number[]): void {\n\n\t\tclass BadTokensProvider implements TokensProvider {\n\t\t\tpublic getInitialState(): IState {\n\t\t\t\treturn MockState.INSTANCE;\n\t\t\t}\n\t\t\tpublic tokenize(line: string, state: IState): ILineTokens {\n\t\t\t\treturn {\n\t\t\t\t\ttokens: providerTokens,\n\t\t\t\t\tendState: MockState.INSTANCE\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\n\t\tconst disposables = new DisposableStore();\n\t\tconst languageService = disposables.add(new LanguageService());\n\t\tdisposables.add(languageService.registerLanguage({ id: languageId }));\n\t\tconst adapter = new TokenizationSupportAdapter(\n\t\t\tlanguageId,\n\t\t\tnew BadTokensProvider(),\n\t\t\tlanguageService,\n\t\t\tnew MockThemeService()\n\t\t);\n\n\t\tconst actualClassicTokens = adapter.tokenize('whatever', true, MockState.INSTANCE);\n\t\tassert.deepStrictEqual(actualClassicTokens.tokens, expectedClassicTokens);\n\n\t\tconst actualModernTokens = adapter.tokenizeEncoded('whatever', true, MockState.INSTANCE);\n\t\tconst modernTokens: number[] = [];\n\t\tfor (let i = 0; i < actualModernTokens.tokens.length; i++) {\n\t\t\tmodernTokens[i] = actualModernTokens.tokens[i];\n\t\t}\n\n\t\t// Add the encoded language id to the expected tokens\n\t\tconst encodedLanguageId = languageService.languageIdCodec.encodeLanguageId(languageId);\n\t\tconst tokenLanguageMetadata = (encodedLanguageId << MetadataConsts.LANGUAGEID_OFFSET);\n\t\tfor (let i = 1; i < expectedModernTokens.length; i += 2) {\n\t\t\texpectedModernTokens[i] |= tokenLanguageMetadata;\n\t\t}\n\t\tassert.deepStrictEqual(modernTokens, expectedModernTokens);\n\n\t\tdisposables.dispose();\n\t}\n\n\ttest('tokens always start at index 0', () => {\n\t\ttestBadTokensProvider(\n\t\t\t[\n\t\t\t\t{ startIndex: 7, scopes: 'foo' },\n\t\t\t\t{ startIndex: 0, scopes: 'bar' }\n\t\t\t],\n\t\t\t[\n\t\t\t\tnew Token(0, 'foo', languageId),\n\t\t\t\tnew Token(0, 'bar', languageId),\n\t\t\t],\n\t\t\t[\n\t\t\t\t0, (0 << MetadataConsts.FOREGROUND_OFFSET) | MetadataConsts.BALANCED_BRACKETS_MASK,\n\t\t\t\t0, (1 << MetadataConsts.FOREGROUND_OFFSET) | MetadataConsts.BALANCED_BRACKETS_MASK\n\t\t\t]\n\t\t);\n\t});\n\n\ttest('tokens always start after each other', () => {\n\t\ttestBadTokensProvider(\n\t\t\t[\n\t\t\t\t{ startIndex: 0, scopes: 'foo' },\n\t\t\t\t{ startIndex: 5, scopes: 'bar' },\n\t\t\t\t{ startIndex: 3, scopes: 'foo' },\n\t\t\t],\n\t\t\t[\n\t\t\t\tnew Token(0, 'foo', languageId),\n\t\t\t\tnew Token(5, 'bar', languageId),\n\t\t\t\tnew Token(5, 'foo', languageId),\n\t\t\t],\n\t\t\t[\n\t\t\t\t0, (0 << MetadataConsts.FOREGROUND_OFFSET) | MetadataConsts.BALANCED_BRACKETS_MASK,\n\t\t\t\t5, (1 << MetadataConsts.FOREGROUND_OFFSET) | MetadataConsts.BALANCED_BRACKETS_MASK,\n\t\t\t\t5, (2 << MetadataConsts.FOREGROUND_OFFSET) | MetadataConsts.BALANCED_BRACKETS_MASK\n\t\t\t]\n\t\t);\n\t});\n});\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport assert from 'assert';\nimport { Color } from '../../../../base/common/color.js';\nimport { Emitter } from '../../../../base/common/event.js';\nimport { DisposableStore } from '../../../../base/common/lifecycle.js';\nimport { ensureNoDisposablesAreLeakedInTestSuite } from '../../../../base/test/common/utils.js';\nimport { LanguageId, MetadataConsts } from '../../../common/encodedTokenAttributes.js';\nimport { IState, Token } from '../../../common/languages.js';\nimport { TokenTheme } from '../../../common/languages/supports/tokenization.js';\nimport { LanguageService } from '../../../common/services/languageService.js';\nimport { ILineTokens, IToken, TokenizationSupportAdapter, TokensProvider } from '../../browser/standaloneLanguages.js';\nimport { IStandaloneTheme, IStandaloneThemeData, IStandaloneThemeService } from '../../common/standaloneTheme.js';\nimport { UnthemedProductIconTheme } from '../../../../platform/theme/browser/iconsStyleSheet.js';\nimport { ColorIdentifier } from '../../../../platform/theme/common/colorRegistry.js';\nimport { ColorScheme } from '../../../../platform/theme/common/theme.js';\nimport { IColorTheme, IFileIconTheme, IProductIconTheme, ITokenStyle } from '../../../../platform/theme/common/themeService.js';\n\nsuite('TokenizationSupport2Adapter', () => {\n\n\tensureNoDisposablesAreLeakedInTestSuite();\n\n\tconst languageId = 'tttt';\n\t// const tokenMetadata = (LanguageId.PlainText << MetadataConsts.LANGUAGEID_OFFSET);\n\n\tclass MockTokenTheme extends TokenTheme {\n\t\tprivate counter = 0;\n\t\tconstructor() {\n\t\t\tsuper(null!, null!);\n\t\t}\n\t\tpublic override match(languageId: LanguageId, token: string): number {\n\t\t\treturn (\n\t\t\t\t((this.counter++) << MetadataConsts.FOREGROUND_OFFSET)\n\t\t\t\t| (languageId << MetadataConsts.LANGUAGEID_OFFSET)\n\t\t\t) >>> 0;\n\t\t}\n\t}\n\n\tclass MockThemeService implements IStandaloneThemeService {\n\t\tdeclare readonly _serviceBrand: undefined;\n\t\tpublic setTheme(themeName: string): string {\n\t\t\tthrow new Error('Not implemented');\n\t\t}\n\t\tpublic setAutoDetectHighContrast(autoDetectHighContrast: boolean): void {\n\t\t\tthrow new Error('Not implemented');\n\t\t}\n\t\tpublic defineTheme(themeName: string, themeData: IStandaloneThemeData): void {\n\t\t\tthrow new Error('Not implemented');\n\t\t}\n\t\tpublic getColorTheme(): IStandaloneTheme {\n\t\t\treturn {\n\t\t\t\tlabel: 'mock',\n\n\t\t\t\ttokenTheme: new MockTokenTheme(),\n\n\t\t\t\tthemeName: ColorScheme.LIGHT,\n\n\t\t\t\ttype: ColorScheme.LIGHT,\n\n\t\t\t\tgetColor: (color: ColorIdentifier, useDefault?: boolean): Color => {\n\t\t\t\t\tthrow new Error('Not implemented');\n\t\t\t\t},\n\n\t\t\t\tdefines: (color: ColorIdentifier): boolean => {\n\t\t\t\t\tthrow new Error('Not implemented');\n\t\t\t\t},\n\n\t\t\t\tgetTokenStyleMetadata: (type: string, modifiers: string[], modelLanguage: string): ITokenStyle | undefined => {\n\t\t\t\t\treturn undefined;\n\t\t\t\t},\n\n\t\t\t\tsemanticHighlighting: false,\n\n\t\t\t\ttokenColorMap: []\n\t\t\t};\n\t\t}\n\t\tsetColorMapOverride(colorMapOverride: Color[] | null): void {\n\t\t}\n\t\tpublic getFileIconTheme(): IFileIconTheme {\n\t\t\treturn {\n\t\t\t\thasFileIcons: false,\n\t\t\t\thasFolderIcons: false,\n\t\t\t\thidesExplorerArrows: false\n\t\t\t};\n\t\t}\n\n\t\tprivate _builtInProductIconTheme = new UnthemedProductIconTheme();\n\n\t\tpublic getProductIconTheme(): IProductIconTheme {\n\t\t\treturn this._builtInProductIconTheme;\n\t\t}\n\t\tpublic readonly onDidColorThemeChange = new Emitter<IColorTheme>().event;\n\t\tpublic readonly onDidFileIconThemeChange = new Emitter<IFileIconTheme>().event;\n\t\tpublic readonly onDidProductIconThemeChange = new Emitter<IProductIconTheme>().event;\n\t}\n\n\tclass MockState implements IState {\n\t\tpublic static readonly INSTANCE = new MockState();\n\t\tprivate constructor() { }\n\t\tpublic clone(): IState {\n\t\t\treturn this;\n\t\t}\n\t\tpublic equals(other: IState): boolean {\n\t\t\treturn this === other;\n\t\t}\n\t}\n\n\tfunction testBadTokensProvider(providerTokens: IToken[], expectedClassicTokens: Token[], expectedModernTokens: number[]): void {\n\n\t\tclass BadTokensProvider implements TokensProvider {\n\t\t\tpublic getInitialState(): IState {\n\t\t\t\treturn MockState.INSTANCE;\n\t\t\t}\n\t\t\tpublic tokenize(line: string, state: IState): ILineTokens {\n\t\t\t\treturn {\n\t\t\t\t\ttokens: providerTokens,\n\t\t\t\t\tendState: MockState.INSTANCE\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\n\t\tconst disposables = new DisposableStore();\n\t\tconst languageService = disposables.add(new LanguageService());\n\t\tdisposables.add(languageService.registerLanguage({ id: languageId }));\n\t\tconst adapter = new TokenizationSupportAdapter(\n\t\t\tlanguageId,\n\t\t\tnew BadTokensProvider(),\n\t\t\tlanguageService,\n\t\t\tnew MockThemeService()\n\t\t);\n\n\t\tconst actualClassicTokens = adapter.tokenize('whatever', true, MockState.INSTANCE);\n\t\tassert.deepStrictEqual(actualClassicTokens.tokens, expectedClassicTokens);\n\n\t\tconst actualModernTokens = adapter.tokenizeEncoded('whatever', true, MockState.INSTANCE);\n\t\tconst modernTokens: number[] = [];\n\t\tfor (let i = 0; i < actualModernTokens.tokens.length; i++) {\n\t\t\tmodernTokens[i] = actualModernTokens.tokens[i];\n\t\t}\n\n\t\t// Add the encoded language id to the expected tokens\n\t\tconst encodedLanguageId = languageService.languageIdCodec.encodeLanguageId(languageId);\n\t\tconst tokenLanguageMetadata = (encodedLanguageId << MetadataConsts.LANGUAGEID_OFFSET);\n\t\tfor (let i = 1; i < expectedModernTokens.length; i += 2) {\n\t\t\texpectedModernTokens[i] |= tokenLanguageMetadata;\n\t\t}\n\t\tassert.deepStrictEqual(modernTokens, expectedModernTokens);\n\n\t\tdisposables.dispose();\n\t}\n\n\ttest('tokens always start at index 0', () => {\n\t\ttestBadTokensProvider(\n\t\t\t[\n\t\t\t\t{ startIndex: 7, scopes: 'foo' },\n\t\t\t\t{ startIndex: 0, scopes: 'bar' }\n\t\t\t],\n\t\t\t[\n\t\t\t\tnew Token(0, 'foo', languageId),\n\t\t\t\tnew Token(0, 'bar', languageId),\n\t\t\t],\n\t\t\t[\n\t\t\t\t0, (0 << MetadataConsts.FOREGROUND_OFFSET) | MetadataConsts.BALANCED_BRACKETS_MASK,\n\t\t\t\t0, (1 << MetadataConsts.FOREGROUND_OFFSET) | MetadataConsts.BALANCED_BRACKETS_MASK\n\t\t\t]\n\t\t);\n\t});\n\n\ttest('tokens always start after each other', () => {\n\t\ttestBadTokensProvider(\n\t\t\t[\n\t\t\t\t{ startIndex: 0, scopes: 'foo' },\n\t\t\t\t{ startIndex: 5, scopes: 'bar' },\n\t\t\t\t{ startIndex: 3, scopes: 'foo' },\n\t\t\t],\n\t\t\t[\n\t\t\t\tnew Token(0, 'foo', languageId),\n\t\t\t\tnew Token(5, 'bar', languageId),\n\t\t\t\tnew Token(5, 'foo', languageId),\n\t\t\t],\n\t\t\t[\n\t\t\t\t0, (0 << MetadataConsts.FOREGROUND_OFFSET) | MetadataConsts.BALANCED_BRACKETS_MASK,\n\t\t\t\t5, (1 << MetadataConsts.FOREGROUND_OFFSET) | MetadataConsts.BALANCED_BRACKETS_MASK,\n\t\t\t\t5, (2 << MetadataConsts.FOREGROUND_OFFSET) | MetadataConsts.BALANCED_BRACKETS_MASK\n\t\t\t]\n\t\t);\n\t});\n});\n"]}