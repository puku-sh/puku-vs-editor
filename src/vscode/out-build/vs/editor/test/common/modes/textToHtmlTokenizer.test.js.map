{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/editor/test/common/modes/textToHtmlTokenizer.test.ts","vs/editor/test/common/modes/textToHtmlTokenizer.test.ts"],"names":[],"mappings":"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","file":"textToHtmlTokenizer.test.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport assert from 'assert';\nimport { Disposable, DisposableStore } from '../../../../base/common/lifecycle.js';\nimport { ensureNoDisposablesAreLeakedInTestSuite } from '../../../../base/test/common/utils.js';\nimport { ColorId, FontStyle, MetadataConsts } from '../../../common/encodedTokenAttributes.js';\nimport { EncodedTokenizationResult, IState, TokenizationRegistry } from '../../../common/languages.js';\nimport { ILanguageService } from '../../../common/languages/language.js';\nimport { _tokenizeToString, tokenizeLineToHTML } from '../../../common/languages/textToHtmlTokenizer.js';\nimport { LanguageIdCodec } from '../../../common/services/languagesRegistry.js';\nimport { TestLineToken, TestLineTokens } from '../core/testLineToken.js';\nimport { createModelServices } from '../testTextModel.js';\nimport { TestInstantiationService } from '../../../../platform/instantiation/test/common/instantiationServiceMock.js';\n\nsuite('Editor Modes - textToHtmlTokenizer', () => {\n\n\tlet disposables: DisposableStore;\n\tlet instantiationService: TestInstantiationService;\n\n\tsetup(() => {\n\t\tdisposables = new DisposableStore();\n\t\tinstantiationService = createModelServices(disposables);\n\t});\n\n\tteardown(() => {\n\t\tdisposables.dispose();\n\t});\n\n\tensureNoDisposablesAreLeakedInTestSuite();\n\n\tfunction toStr(pieces: { className: string; text: string }[]): string {\n\t\tconst resultArr = pieces.map((t) => `<span class=\"${t.className}\">${t.text}</span>`);\n\t\treturn resultArr.join('');\n\t}\n\n\ttest('TextToHtmlTokenizer 1', () => {\n\t\tconst mode = disposables.add(instantiationService.createInstance(Mode));\n\t\tconst support = TokenizationRegistry.get(mode.languageId)!;\n\n\t\tconst actual = _tokenizeToString('.abc..def...gh', new LanguageIdCodec(), support);\n\t\tconst expected = [\n\t\t\t{ className: 'mtk7', text: '.' },\n\t\t\t{ className: 'mtk9', text: 'abc' },\n\t\t\t{ className: 'mtk7', text: '..' },\n\t\t\t{ className: 'mtk9', text: 'def' },\n\t\t\t{ className: 'mtk7', text: '...' },\n\t\t\t{ className: 'mtk9', text: 'gh' },\n\t\t];\n\t\tconst expectedStr = `<div class=\"monaco-tokenized-source\">${toStr(expected)}</div>`;\n\n\t\tassert.strictEqual(actual, expectedStr);\n\t});\n\n\ttest('TextToHtmlTokenizer 2', () => {\n\t\tconst mode = disposables.add(instantiationService.createInstance(Mode));\n\t\tconst support = TokenizationRegistry.get(mode.languageId)!;\n\n\t\tconst actual = _tokenizeToString('.abc..def...gh\\n.abc..def...gh', new LanguageIdCodec(), support);\n\t\tconst expected1 = [\n\t\t\t{ className: 'mtk7', text: '.' },\n\t\t\t{ className: 'mtk9', text: 'abc' },\n\t\t\t{ className: 'mtk7', text: '..' },\n\t\t\t{ className: 'mtk9', text: 'def' },\n\t\t\t{ className: 'mtk7', text: '...' },\n\t\t\t{ className: 'mtk9', text: 'gh' },\n\t\t];\n\t\tconst expected2 = [\n\t\t\t{ className: 'mtk7', text: '.' },\n\t\t\t{ className: 'mtk9', text: 'abc' },\n\t\t\t{ className: 'mtk7', text: '..' },\n\t\t\t{ className: 'mtk9', text: 'def' },\n\t\t\t{ className: 'mtk7', text: '...' },\n\t\t\t{ className: 'mtk9', text: 'gh' },\n\t\t];\n\t\tconst expectedStr1 = toStr(expected1);\n\t\tconst expectedStr2 = toStr(expected2);\n\t\tconst expectedStr = `<div class=\"monaco-tokenized-source\">${expectedStr1}<br/>${expectedStr2}</div>`;\n\n\t\tassert.strictEqual(actual, expectedStr);\n\t});\n\n\ttest('tokenizeLineToHTML', () => {\n\t\tconst text = 'Ciao hello world!';\n\t\tconst lineTokens = new TestLineTokens([\n\t\t\tnew TestLineToken(\n\t\t\t\t4,\n\t\t\t\t(\n\t\t\t\t\t(3 << MetadataConsts.FOREGROUND_OFFSET)\n\t\t\t\t\t| ((FontStyle.Bold | FontStyle.Italic) << MetadataConsts.FONT_STYLE_OFFSET)\n\t\t\t\t) >>> 0\n\t\t\t),\n\t\t\tnew TestLineToken(\n\t\t\t\t5,\n\t\t\t\t(\n\t\t\t\t\t(1 << MetadataConsts.FOREGROUND_OFFSET)\n\t\t\t\t) >>> 0\n\t\t\t),\n\t\t\tnew TestLineToken(\n\t\t\t\t10,\n\t\t\t\t(\n\t\t\t\t\t(4 << MetadataConsts.FOREGROUND_OFFSET)\n\t\t\t\t) >>> 0\n\t\t\t),\n\t\t\tnew TestLineToken(\n\t\t\t\t11,\n\t\t\t\t(\n\t\t\t\t\t(1 << MetadataConsts.FOREGROUND_OFFSET)\n\t\t\t\t) >>> 0\n\t\t\t),\n\t\t\tnew TestLineToken(\n\t\t\t\t17,\n\t\t\t\t(\n\t\t\t\t\t(5 << MetadataConsts.FOREGROUND_OFFSET)\n\t\t\t\t\t| ((FontStyle.Underline) << MetadataConsts.FONT_STYLE_OFFSET)\n\t\t\t\t) >>> 0\n\t\t\t)\n\t\t]);\n\t\tconst colorMap = [null!, '#000000', '#ffffff', '#ff0000', '#00ff00', '#0000ff'];\n\n\t\tassert.strictEqual(\n\t\t\ttokenizeLineToHTML(text, lineTokens, colorMap, 0, 17, 4, true),\n\t\t\t[\n\t\t\t\t'<div>',\n\t\t\t\t'<span style=\"color: #ff0000;font-style: italic;font-weight: bold;\">Ciao</span>',\n\t\t\t\t'<span style=\"color: #000000;\"> </span>',\n\t\t\t\t'<span style=\"color: #00ff00;\">hello</span>',\n\t\t\t\t'<span style=\"color: #000000;\"> </span>',\n\t\t\t\t'<span style=\"color: #0000ff;text-decoration: underline;\">world!</span>',\n\t\t\t\t'</div>'\n\t\t\t].join('')\n\t\t);\n\n\t\tassert.strictEqual(\n\t\t\ttokenizeLineToHTML(text, lineTokens, colorMap, 0, 12, 4, true),\n\t\t\t[\n\t\t\t\t'<div>',\n\t\t\t\t'<span style=\"color: #ff0000;font-style: italic;font-weight: bold;\">Ciao</span>',\n\t\t\t\t'<span style=\"color: #000000;\"> </span>',\n\t\t\t\t'<span style=\"color: #00ff00;\">hello</span>',\n\t\t\t\t'<span style=\"color: #000000;\"> </span>',\n\t\t\t\t'<span style=\"color: #0000ff;text-decoration: underline;\">w</span>',\n\t\t\t\t'</div>'\n\t\t\t].join('')\n\t\t);\n\n\t\tassert.strictEqual(\n\t\t\ttokenizeLineToHTML(text, lineTokens, colorMap, 0, 11, 4, true),\n\t\t\t[\n\t\t\t\t'<div>',\n\t\t\t\t'<span style=\"color: #ff0000;font-style: italic;font-weight: bold;\">Ciao</span>',\n\t\t\t\t'<span style=\"color: #000000;\"> </span>',\n\t\t\t\t'<span style=\"color: #00ff00;\">hello</span>',\n\t\t\t\t'<span style=\"color: #000000;\"> </span>',\n\t\t\t\t'</div>'\n\t\t\t].join('')\n\t\t);\n\n\t\tassert.strictEqual(\n\t\t\ttokenizeLineToHTML(text, lineTokens, colorMap, 1, 11, 4, true),\n\t\t\t[\n\t\t\t\t'<div>',\n\t\t\t\t'<span style=\"color: #ff0000;font-style: italic;font-weight: bold;\">iao</span>',\n\t\t\t\t'<span style=\"color: #000000;\"> </span>',\n\t\t\t\t'<span style=\"color: #00ff00;\">hello</span>',\n\t\t\t\t'<span style=\"color: #000000;\"> </span>',\n\t\t\t\t'</div>'\n\t\t\t].join('')\n\t\t);\n\n\t\tassert.strictEqual(\n\t\t\ttokenizeLineToHTML(text, lineTokens, colorMap, 4, 11, 4, true),\n\t\t\t[\n\t\t\t\t'<div>',\n\t\t\t\t'<span style=\"color: #000000;\">&#160;</span>',\n\t\t\t\t'<span style=\"color: #00ff00;\">hello</span>',\n\t\t\t\t'<span style=\"color: #000000;\"> </span>',\n\t\t\t\t'</div>'\n\t\t\t].join('')\n\t\t);\n\n\t\tassert.strictEqual(\n\t\t\ttokenizeLineToHTML(text, lineTokens, colorMap, 5, 11, 4, true),\n\t\t\t[\n\t\t\t\t'<div>',\n\t\t\t\t'<span style=\"color: #00ff00;\">hello</span>',\n\t\t\t\t'<span style=\"color: #000000;\"> </span>',\n\t\t\t\t'</div>'\n\t\t\t].join('')\n\t\t);\n\n\t\tassert.strictEqual(\n\t\t\ttokenizeLineToHTML(text, lineTokens, colorMap, 5, 10, 4, true),\n\t\t\t[\n\t\t\t\t'<div>',\n\t\t\t\t'<span style=\"color: #00ff00;\">hello</span>',\n\t\t\t\t'</div>'\n\t\t\t].join('')\n\t\t);\n\n\t\tassert.strictEqual(\n\t\t\ttokenizeLineToHTML(text, lineTokens, colorMap, 6, 9, 4, true),\n\t\t\t[\n\t\t\t\t'<div>',\n\t\t\t\t'<span style=\"color: #00ff00;\">ell</span>',\n\t\t\t\t'</div>'\n\t\t\t].join('')\n\t\t);\n\t});\n\ttest('tokenizeLineToHTML handle spaces #35954', () => {\n\t\tconst text = '  Ciao   hello world!';\n\t\tconst lineTokens = new TestLineTokens([\n\t\t\tnew TestLineToken(\n\t\t\t\t2,\n\t\t\t\t(\n\t\t\t\t\t(1 << MetadataConsts.FOREGROUND_OFFSET)\n\t\t\t\t) >>> 0\n\t\t\t),\n\t\t\tnew TestLineToken(\n\t\t\t\t6,\n\t\t\t\t(\n\t\t\t\t\t(3 << MetadataConsts.FOREGROUND_OFFSET)\n\t\t\t\t\t| ((FontStyle.Bold | FontStyle.Italic) << MetadataConsts.FONT_STYLE_OFFSET)\n\t\t\t\t) >>> 0\n\t\t\t),\n\t\t\tnew TestLineToken(\n\t\t\t\t9,\n\t\t\t\t(\n\t\t\t\t\t(1 << MetadataConsts.FOREGROUND_OFFSET)\n\t\t\t\t) >>> 0\n\t\t\t),\n\t\t\tnew TestLineToken(\n\t\t\t\t14,\n\t\t\t\t(\n\t\t\t\t\t(4 << MetadataConsts.FOREGROUND_OFFSET)\n\t\t\t\t) >>> 0\n\t\t\t),\n\t\t\tnew TestLineToken(\n\t\t\t\t15,\n\t\t\t\t(\n\t\t\t\t\t(1 << MetadataConsts.FOREGROUND_OFFSET)\n\t\t\t\t) >>> 0\n\t\t\t),\n\t\t\tnew TestLineToken(\n\t\t\t\t21,\n\t\t\t\t(\n\t\t\t\t\t(5 << MetadataConsts.FOREGROUND_OFFSET)\n\t\t\t\t\t| ((FontStyle.Underline) << MetadataConsts.FONT_STYLE_OFFSET)\n\t\t\t\t) >>> 0\n\t\t\t)\n\t\t]);\n\t\tconst colorMap = [null!, '#000000', '#ffffff', '#ff0000', '#00ff00', '#0000ff'];\n\n\t\tassert.strictEqual(\n\t\t\ttokenizeLineToHTML(text, lineTokens, colorMap, 0, 21, 4, true),\n\t\t\t[\n\t\t\t\t'<div>',\n\t\t\t\t'<span style=\"color: #000000;\">&#160; </span>',\n\t\t\t\t'<span style=\"color: #ff0000;font-style: italic;font-weight: bold;\">Ciao</span>',\n\t\t\t\t'<span style=\"color: #000000;\"> &#160; </span>',\n\t\t\t\t'<span style=\"color: #00ff00;\">hello</span>',\n\t\t\t\t'<span style=\"color: #000000;\"> </span>',\n\t\t\t\t'<span style=\"color: #0000ff;text-decoration: underline;\">world!</span>',\n\t\t\t\t'</div>'\n\t\t\t].join('')\n\t\t);\n\n\t\tassert.strictEqual(\n\t\t\ttokenizeLineToHTML(text, lineTokens, colorMap, 0, 17, 4, true),\n\t\t\t[\n\t\t\t\t'<div>',\n\t\t\t\t'<span style=\"color: #000000;\">&#160; </span>',\n\t\t\t\t'<span style=\"color: #ff0000;font-style: italic;font-weight: bold;\">Ciao</span>',\n\t\t\t\t'<span style=\"color: #000000;\"> &#160; </span>',\n\t\t\t\t'<span style=\"color: #00ff00;\">hello</span>',\n\t\t\t\t'<span style=\"color: #000000;\"> </span>',\n\t\t\t\t'<span style=\"color: #0000ff;text-decoration: underline;\">wo</span>',\n\t\t\t\t'</div>'\n\t\t\t].join('')\n\t\t);\n\n\t\tassert.strictEqual(\n\t\t\ttokenizeLineToHTML(text, lineTokens, colorMap, 0, 3, 4, true),\n\t\t\t[\n\t\t\t\t'<div>',\n\t\t\t\t'<span style=\"color: #000000;\">&#160; </span>',\n\t\t\t\t'<span style=\"color: #ff0000;font-style: italic;font-weight: bold;\">C</span>',\n\t\t\t\t'</div>'\n\t\t\t].join('')\n\t\t);\n\t});\n\n\ttest('tokenizeLineToHTML with tabs and non-zero startOffset #263387', () => {\n\t\t// This test demonstrates the issue where tab padding is calculated incorrectly\n\t\t// when startOffset is non-zero and there are tabs AFTER the start position.\n\t\t// The bug: tabsCharDelta doesn't account for characters before startOffset.\n\n\t\tconst colorMap = [null!, '#000000', '#ffffff', '#ff0000', '#00ff00'];\n\n\t\t// Critical test case: \"\\ta\\tb\" starting at position 2 (skipping first tab and 'a')\n\t\t// Layout: First tab (pos 0) goes to column 4, 'a' (pos 1) at column 4,\n\t\t//         second tab (pos 2) should go from column 5 to column 8 (3 spaces)\n\t\t// With the bug: charIndex starts at 2, tabsCharDelta=0 (first tab was never seen)\n\t\t//   When processing second tab: insertSpacesCount = 4 - (2 + 0) % 4 = 2 spaces (WRONG!)\n\t\t//   The old code thinks it's at column 2, but it's actually at column 5\n\t\tconst text = '\\ta\\tb';\n\t\tconst lineTokens = new TestLineTokens([\n\t\t\tnew TestLineToken(\n\t\t\t\t1,\n\t\t\t\t(\n\t\t\t\t\t(1 << MetadataConsts.FOREGROUND_OFFSET)\n\t\t\t\t) >>> 0\n\t\t\t),\n\t\t\tnew TestLineToken(\n\t\t\t\t2,\n\t\t\t\t(\n\t\t\t\t\t(3 << MetadataConsts.FOREGROUND_OFFSET)\n\t\t\t\t) >>> 0\n\t\t\t),\n\t\t\tnew TestLineToken(\n\t\t\t\t3,\n\t\t\t\t(\n\t\t\t\t\t(1 << MetadataConsts.FOREGROUND_OFFSET)\n\t\t\t\t) >>> 0\n\t\t\t),\n\t\t\tnew TestLineToken(\n\t\t\t\t4,\n\t\t\t\t(\n\t\t\t\t\t(4 << MetadataConsts.FOREGROUND_OFFSET)\n\t\t\t\t) >>> 0\n\t\t\t)\n\t\t]);\n\n\t\t// First, verify the full line works correctly\n\t\tassert.strictEqual(\n\t\t\ttokenizeLineToHTML(text, lineTokens, colorMap, 0, 4, 4, true),\n\t\t\t[\n\t\t\t\t'<div>',\n\t\t\t\t'<span style=\"color: #000000;\">&#160; &#160; </span>', // First tab: 4 spaces\n\t\t\t\t'<span style=\"color: #ff0000;\">a</span>',               // 'a' at column 4\n\t\t\t\t'<span style=\"color: #000000;\"> &#160; </span>',       // Second tab: 3 spaces (column 5 to 8)\n\t\t\t\t'<span style=\"color: #00ff00;\">b</span>',\n\t\t\t\t'</div>'\n\t\t\t].join('')\n\t\t);\n\n\t\t// THE BUG: Starting at position 2 (after first tab and 'a')\n\t\t// Expected (with fix): 3 spaces for the second tab (column 5 to 8)\n\t\t// Buggy behavior (old code): 2 spaces (thinks it's at column 2, gives &#160; )\n\t\t// The fix correctly accounts for the skipped tab and 'a', outputting &#160; &#160;\n\t\tassert.strictEqual(\n\t\t\ttokenizeLineToHTML(text, lineTokens, colorMap, 2, 4, 4, true),\n\t\t\t[\n\t\t\t\t'<div>',\n\t\t\t\t'<span style=\"color: #000000;\">&#160; &#160;</span>', // With fix: 3 spaces; with bug: only 2 spaces\n\t\t\t\t'<span style=\"color: #00ff00;\">b</span>',\n\t\t\t\t'</div>'\n\t\t\t].join('')\n\t\t);\n\t});\n\n});\n\nclass Mode extends Disposable {\n\n\tpublic readonly languageId = 'textToHtmlTokenizerMode';\n\n\tconstructor(\n\t\t@ILanguageService languageService: ILanguageService\n\t) {\n\t\tsuper();\n\t\tthis._register(languageService.registerLanguage({ id: this.languageId }));\n\t\tthis._register(TokenizationRegistry.register(this.languageId, {\n\t\t\tgetInitialState: (): IState => null!,\n\t\t\ttokenize: undefined!,\n\t\t\ttokenizeEncoded: (line: string, hasEOL: boolean, state: IState): EncodedTokenizationResult => {\n\t\t\t\tconst tokensArr: number[] = [];\n\t\t\t\tlet prevColor = -1 as ColorId;\n\t\t\t\tfor (let i = 0; i < line.length; i++) {\n\t\t\t\t\tconst colorId = (line.charAt(i) === '.' ? 7 : 9) as ColorId;\n\t\t\t\t\tif (prevColor !== colorId) {\n\t\t\t\t\t\ttokensArr.push(i);\n\t\t\t\t\t\ttokensArr.push((\n\t\t\t\t\t\t\tcolorId << MetadataConsts.FOREGROUND_OFFSET\n\t\t\t\t\t\t) >>> 0);\n\t\t\t\t\t}\n\t\t\t\t\tprevColor = colorId;\n\t\t\t\t}\n\n\t\t\t\tconst tokens = new Uint32Array(tokensArr.length);\n\t\t\t\tfor (let i = 0; i < tokens.length; i++) {\n\t\t\t\t\ttokens[i] = tokensArr[i];\n\t\t\t\t}\n\t\t\t\treturn new EncodedTokenizationResult(tokens, null!);\n\t\t\t}\n\t\t}));\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport assert from 'assert';\nimport { Disposable, DisposableStore } from '../../../../base/common/lifecycle.js';\nimport { ensureNoDisposablesAreLeakedInTestSuite } from '../../../../base/test/common/utils.js';\nimport { ColorId, FontStyle, MetadataConsts } from '../../../common/encodedTokenAttributes.js';\nimport { EncodedTokenizationResult, IState, TokenizationRegistry } from '../../../common/languages.js';\nimport { ILanguageService } from '../../../common/languages/language.js';\nimport { _tokenizeToString, tokenizeLineToHTML } from '../../../common/languages/textToHtmlTokenizer.js';\nimport { LanguageIdCodec } from '../../../common/services/languagesRegistry.js';\nimport { TestLineToken, TestLineTokens } from '../core/testLineToken.js';\nimport { createModelServices } from '../testTextModel.js';\nimport { TestInstantiationService } from '../../../../platform/instantiation/test/common/instantiationServiceMock.js';\n\nsuite('Editor Modes - textToHtmlTokenizer', () => {\n\n\tlet disposables: DisposableStore;\n\tlet instantiationService: TestInstantiationService;\n\n\tsetup(() => {\n\t\tdisposables = new DisposableStore();\n\t\tinstantiationService = createModelServices(disposables);\n\t});\n\n\tteardown(() => {\n\t\tdisposables.dispose();\n\t});\n\n\tensureNoDisposablesAreLeakedInTestSuite();\n\n\tfunction toStr(pieces: { className: string; text: string }[]): string {\n\t\tconst resultArr = pieces.map((t) => `<span class=\"${t.className}\">${t.text}</span>`);\n\t\treturn resultArr.join('');\n\t}\n\n\ttest('TextToHtmlTokenizer 1', () => {\n\t\tconst mode = disposables.add(instantiationService.createInstance(Mode));\n\t\tconst support = TokenizationRegistry.get(mode.languageId)!;\n\n\t\tconst actual = _tokenizeToString('.abc..def...gh', new LanguageIdCodec(), support);\n\t\tconst expected = [\n\t\t\t{ className: 'mtk7', text: '.' },\n\t\t\t{ className: 'mtk9', text: 'abc' },\n\t\t\t{ className: 'mtk7', text: '..' },\n\t\t\t{ className: 'mtk9', text: 'def' },\n\t\t\t{ className: 'mtk7', text: '...' },\n\t\t\t{ className: 'mtk9', text: 'gh' },\n\t\t];\n\t\tconst expectedStr = `<div class=\"monaco-tokenized-source\">${toStr(expected)}</div>`;\n\n\t\tassert.strictEqual(actual, expectedStr);\n\t});\n\n\ttest('TextToHtmlTokenizer 2', () => {\n\t\tconst mode = disposables.add(instantiationService.createInstance(Mode));\n\t\tconst support = TokenizationRegistry.get(mode.languageId)!;\n\n\t\tconst actual = _tokenizeToString('.abc..def...gh\\n.abc..def...gh', new LanguageIdCodec(), support);\n\t\tconst expected1 = [\n\t\t\t{ className: 'mtk7', text: '.' },\n\t\t\t{ className: 'mtk9', text: 'abc' },\n\t\t\t{ className: 'mtk7', text: '..' },\n\t\t\t{ className: 'mtk9', text: 'def' },\n\t\t\t{ className: 'mtk7', text: '...' },\n\t\t\t{ className: 'mtk9', text: 'gh' },\n\t\t];\n\t\tconst expected2 = [\n\t\t\t{ className: 'mtk7', text: '.' },\n\t\t\t{ className: 'mtk9', text: 'abc' },\n\t\t\t{ className: 'mtk7', text: '..' },\n\t\t\t{ className: 'mtk9', text: 'def' },\n\t\t\t{ className: 'mtk7', text: '...' },\n\t\t\t{ className: 'mtk9', text: 'gh' },\n\t\t];\n\t\tconst expectedStr1 = toStr(expected1);\n\t\tconst expectedStr2 = toStr(expected2);\n\t\tconst expectedStr = `<div class=\"monaco-tokenized-source\">${expectedStr1}<br/>${expectedStr2}</div>`;\n\n\t\tassert.strictEqual(actual, expectedStr);\n\t});\n\n\ttest('tokenizeLineToHTML', () => {\n\t\tconst text = 'Ciao hello world!';\n\t\tconst lineTokens = new TestLineTokens([\n\t\t\tnew TestLineToken(\n\t\t\t\t4,\n\t\t\t\t(\n\t\t\t\t\t(3 << MetadataConsts.FOREGROUND_OFFSET)\n\t\t\t\t\t| ((FontStyle.Bold | FontStyle.Italic) << MetadataConsts.FONT_STYLE_OFFSET)\n\t\t\t\t) >>> 0\n\t\t\t),\n\t\t\tnew TestLineToken(\n\t\t\t\t5,\n\t\t\t\t(\n\t\t\t\t\t(1 << MetadataConsts.FOREGROUND_OFFSET)\n\t\t\t\t) >>> 0\n\t\t\t),\n\t\t\tnew TestLineToken(\n\t\t\t\t10,\n\t\t\t\t(\n\t\t\t\t\t(4 << MetadataConsts.FOREGROUND_OFFSET)\n\t\t\t\t) >>> 0\n\t\t\t),\n\t\t\tnew TestLineToken(\n\t\t\t\t11,\n\t\t\t\t(\n\t\t\t\t\t(1 << MetadataConsts.FOREGROUND_OFFSET)\n\t\t\t\t) >>> 0\n\t\t\t),\n\t\t\tnew TestLineToken(\n\t\t\t\t17,\n\t\t\t\t(\n\t\t\t\t\t(5 << MetadataConsts.FOREGROUND_OFFSET)\n\t\t\t\t\t| ((FontStyle.Underline) << MetadataConsts.FONT_STYLE_OFFSET)\n\t\t\t\t) >>> 0\n\t\t\t)\n\t\t]);\n\t\tconst colorMap = [null!, '#000000', '#ffffff', '#ff0000', '#00ff00', '#0000ff'];\n\n\t\tassert.strictEqual(\n\t\t\ttokenizeLineToHTML(text, lineTokens, colorMap, 0, 17, 4, true),\n\t\t\t[\n\t\t\t\t'<div>',\n\t\t\t\t'<span style=\"color: #ff0000;font-style: italic;font-weight: bold;\">Ciao</span>',\n\t\t\t\t'<span style=\"color: #000000;\"> </span>',\n\t\t\t\t'<span style=\"color: #00ff00;\">hello</span>',\n\t\t\t\t'<span style=\"color: #000000;\"> </span>',\n\t\t\t\t'<span style=\"color: #0000ff;text-decoration: underline;\">world!</span>',\n\t\t\t\t'</div>'\n\t\t\t].join('')\n\t\t);\n\n\t\tassert.strictEqual(\n\t\t\ttokenizeLineToHTML(text, lineTokens, colorMap, 0, 12, 4, true),\n\t\t\t[\n\t\t\t\t'<div>',\n\t\t\t\t'<span style=\"color: #ff0000;font-style: italic;font-weight: bold;\">Ciao</span>',\n\t\t\t\t'<span style=\"color: #000000;\"> </span>',\n\t\t\t\t'<span style=\"color: #00ff00;\">hello</span>',\n\t\t\t\t'<span style=\"color: #000000;\"> </span>',\n\t\t\t\t'<span style=\"color: #0000ff;text-decoration: underline;\">w</span>',\n\t\t\t\t'</div>'\n\t\t\t].join('')\n\t\t);\n\n\t\tassert.strictEqual(\n\t\t\ttokenizeLineToHTML(text, lineTokens, colorMap, 0, 11, 4, true),\n\t\t\t[\n\t\t\t\t'<div>',\n\t\t\t\t'<span style=\"color: #ff0000;font-style: italic;font-weight: bold;\">Ciao</span>',\n\t\t\t\t'<span style=\"color: #000000;\"> </span>',\n\t\t\t\t'<span style=\"color: #00ff00;\">hello</span>',\n\t\t\t\t'<span style=\"color: #000000;\"> </span>',\n\t\t\t\t'</div>'\n\t\t\t].join('')\n\t\t);\n\n\t\tassert.strictEqual(\n\t\t\ttokenizeLineToHTML(text, lineTokens, colorMap, 1, 11, 4, true),\n\t\t\t[\n\t\t\t\t'<div>',\n\t\t\t\t'<span style=\"color: #ff0000;font-style: italic;font-weight: bold;\">iao</span>',\n\t\t\t\t'<span style=\"color: #000000;\"> </span>',\n\t\t\t\t'<span style=\"color: #00ff00;\">hello</span>',\n\t\t\t\t'<span style=\"color: #000000;\"> </span>',\n\t\t\t\t'</div>'\n\t\t\t].join('')\n\t\t);\n\n\t\tassert.strictEqual(\n\t\t\ttokenizeLineToHTML(text, lineTokens, colorMap, 4, 11, 4, true),\n\t\t\t[\n\t\t\t\t'<div>',\n\t\t\t\t'<span style=\"color: #000000;\">&#160;</span>',\n\t\t\t\t'<span style=\"color: #00ff00;\">hello</span>',\n\t\t\t\t'<span style=\"color: #000000;\"> </span>',\n\t\t\t\t'</div>'\n\t\t\t].join('')\n\t\t);\n\n\t\tassert.strictEqual(\n\t\t\ttokenizeLineToHTML(text, lineTokens, colorMap, 5, 11, 4, true),\n\t\t\t[\n\t\t\t\t'<div>',\n\t\t\t\t'<span style=\"color: #00ff00;\">hello</span>',\n\t\t\t\t'<span style=\"color: #000000;\"> </span>',\n\t\t\t\t'</div>'\n\t\t\t].join('')\n\t\t);\n\n\t\tassert.strictEqual(\n\t\t\ttokenizeLineToHTML(text, lineTokens, colorMap, 5, 10, 4, true),\n\t\t\t[\n\t\t\t\t'<div>',\n\t\t\t\t'<span style=\"color: #00ff00;\">hello</span>',\n\t\t\t\t'</div>'\n\t\t\t].join('')\n\t\t);\n\n\t\tassert.strictEqual(\n\t\t\ttokenizeLineToHTML(text, lineTokens, colorMap, 6, 9, 4, true),\n\t\t\t[\n\t\t\t\t'<div>',\n\t\t\t\t'<span style=\"color: #00ff00;\">ell</span>',\n\t\t\t\t'</div>'\n\t\t\t].join('')\n\t\t);\n\t});\n\ttest('tokenizeLineToHTML handle spaces #35954', () => {\n\t\tconst text = '  Ciao   hello world!';\n\t\tconst lineTokens = new TestLineTokens([\n\t\t\tnew TestLineToken(\n\t\t\t\t2,\n\t\t\t\t(\n\t\t\t\t\t(1 << MetadataConsts.FOREGROUND_OFFSET)\n\t\t\t\t) >>> 0\n\t\t\t),\n\t\t\tnew TestLineToken(\n\t\t\t\t6,\n\t\t\t\t(\n\t\t\t\t\t(3 << MetadataConsts.FOREGROUND_OFFSET)\n\t\t\t\t\t| ((FontStyle.Bold | FontStyle.Italic) << MetadataConsts.FONT_STYLE_OFFSET)\n\t\t\t\t) >>> 0\n\t\t\t),\n\t\t\tnew TestLineToken(\n\t\t\t\t9,\n\t\t\t\t(\n\t\t\t\t\t(1 << MetadataConsts.FOREGROUND_OFFSET)\n\t\t\t\t) >>> 0\n\t\t\t),\n\t\t\tnew TestLineToken(\n\t\t\t\t14,\n\t\t\t\t(\n\t\t\t\t\t(4 << MetadataConsts.FOREGROUND_OFFSET)\n\t\t\t\t) >>> 0\n\t\t\t),\n\t\t\tnew TestLineToken(\n\t\t\t\t15,\n\t\t\t\t(\n\t\t\t\t\t(1 << MetadataConsts.FOREGROUND_OFFSET)\n\t\t\t\t) >>> 0\n\t\t\t),\n\t\t\tnew TestLineToken(\n\t\t\t\t21,\n\t\t\t\t(\n\t\t\t\t\t(5 << MetadataConsts.FOREGROUND_OFFSET)\n\t\t\t\t\t| ((FontStyle.Underline) << MetadataConsts.FONT_STYLE_OFFSET)\n\t\t\t\t) >>> 0\n\t\t\t)\n\t\t]);\n\t\tconst colorMap = [null!, '#000000', '#ffffff', '#ff0000', '#00ff00', '#0000ff'];\n\n\t\tassert.strictEqual(\n\t\t\ttokenizeLineToHTML(text, lineTokens, colorMap, 0, 21, 4, true),\n\t\t\t[\n\t\t\t\t'<div>',\n\t\t\t\t'<span style=\"color: #000000;\">&#160; </span>',\n\t\t\t\t'<span style=\"color: #ff0000;font-style: italic;font-weight: bold;\">Ciao</span>',\n\t\t\t\t'<span style=\"color: #000000;\"> &#160; </span>',\n\t\t\t\t'<span style=\"color: #00ff00;\">hello</span>',\n\t\t\t\t'<span style=\"color: #000000;\"> </span>',\n\t\t\t\t'<span style=\"color: #0000ff;text-decoration: underline;\">world!</span>',\n\t\t\t\t'</div>'\n\t\t\t].join('')\n\t\t);\n\n\t\tassert.strictEqual(\n\t\t\ttokenizeLineToHTML(text, lineTokens, colorMap, 0, 17, 4, true),\n\t\t\t[\n\t\t\t\t'<div>',\n\t\t\t\t'<span style=\"color: #000000;\">&#160; </span>',\n\t\t\t\t'<span style=\"color: #ff0000;font-style: italic;font-weight: bold;\">Ciao</span>',\n\t\t\t\t'<span style=\"color: #000000;\"> &#160; </span>',\n\t\t\t\t'<span style=\"color: #00ff00;\">hello</span>',\n\t\t\t\t'<span style=\"color: #000000;\"> </span>',\n\t\t\t\t'<span style=\"color: #0000ff;text-decoration: underline;\">wo</span>',\n\t\t\t\t'</div>'\n\t\t\t].join('')\n\t\t);\n\n\t\tassert.strictEqual(\n\t\t\ttokenizeLineToHTML(text, lineTokens, colorMap, 0, 3, 4, true),\n\t\t\t[\n\t\t\t\t'<div>',\n\t\t\t\t'<span style=\"color: #000000;\">&#160; </span>',\n\t\t\t\t'<span style=\"color: #ff0000;font-style: italic;font-weight: bold;\">C</span>',\n\t\t\t\t'</div>'\n\t\t\t].join('')\n\t\t);\n\t});\n\n\ttest('tokenizeLineToHTML with tabs and non-zero startOffset #263387', () => {\n\t\t// This test demonstrates the issue where tab padding is calculated incorrectly\n\t\t// when startOffset is non-zero and there are tabs AFTER the start position.\n\t\t// The bug: tabsCharDelta doesn't account for characters before startOffset.\n\n\t\tconst colorMap = [null!, '#000000', '#ffffff', '#ff0000', '#00ff00'];\n\n\t\t// Critical test case: \"\\ta\\tb\" starting at position 2 (skipping first tab and 'a')\n\t\t// Layout: First tab (pos 0) goes to column 4, 'a' (pos 1) at column 4,\n\t\t//         second tab (pos 2) should go from column 5 to column 8 (3 spaces)\n\t\t// With the bug: charIndex starts at 2, tabsCharDelta=0 (first tab was never seen)\n\t\t//   When processing second tab: insertSpacesCount = 4 - (2 + 0) % 4 = 2 spaces (WRONG!)\n\t\t//   The old code thinks it's at column 2, but it's actually at column 5\n\t\tconst text = '\\ta\\tb';\n\t\tconst lineTokens = new TestLineTokens([\n\t\t\tnew TestLineToken(\n\t\t\t\t1,\n\t\t\t\t(\n\t\t\t\t\t(1 << MetadataConsts.FOREGROUND_OFFSET)\n\t\t\t\t) >>> 0\n\t\t\t),\n\t\t\tnew TestLineToken(\n\t\t\t\t2,\n\t\t\t\t(\n\t\t\t\t\t(3 << MetadataConsts.FOREGROUND_OFFSET)\n\t\t\t\t) >>> 0\n\t\t\t),\n\t\t\tnew TestLineToken(\n\t\t\t\t3,\n\t\t\t\t(\n\t\t\t\t\t(1 << MetadataConsts.FOREGROUND_OFFSET)\n\t\t\t\t) >>> 0\n\t\t\t),\n\t\t\tnew TestLineToken(\n\t\t\t\t4,\n\t\t\t\t(\n\t\t\t\t\t(4 << MetadataConsts.FOREGROUND_OFFSET)\n\t\t\t\t) >>> 0\n\t\t\t)\n\t\t]);\n\n\t\t// First, verify the full line works correctly\n\t\tassert.strictEqual(\n\t\t\ttokenizeLineToHTML(text, lineTokens, colorMap, 0, 4, 4, true),\n\t\t\t[\n\t\t\t\t'<div>',\n\t\t\t\t'<span style=\"color: #000000;\">&#160; &#160; </span>', // First tab: 4 spaces\n\t\t\t\t'<span style=\"color: #ff0000;\">a</span>',               // 'a' at column 4\n\t\t\t\t'<span style=\"color: #000000;\"> &#160; </span>',       // Second tab: 3 spaces (column 5 to 8)\n\t\t\t\t'<span style=\"color: #00ff00;\">b</span>',\n\t\t\t\t'</div>'\n\t\t\t].join('')\n\t\t);\n\n\t\t// THE BUG: Starting at position 2 (after first tab and 'a')\n\t\t// Expected (with fix): 3 spaces for the second tab (column 5 to 8)\n\t\t// Buggy behavior (old code): 2 spaces (thinks it's at column 2, gives &#160; )\n\t\t// The fix correctly accounts for the skipped tab and 'a', outputting &#160; &#160;\n\t\tassert.strictEqual(\n\t\t\ttokenizeLineToHTML(text, lineTokens, colorMap, 2, 4, 4, true),\n\t\t\t[\n\t\t\t\t'<div>',\n\t\t\t\t'<span style=\"color: #000000;\">&#160; &#160;</span>', // With fix: 3 spaces; with bug: only 2 spaces\n\t\t\t\t'<span style=\"color: #00ff00;\">b</span>',\n\t\t\t\t'</div>'\n\t\t\t].join('')\n\t\t);\n\t});\n\n});\n\nclass Mode extends Disposable {\n\n\tpublic readonly languageId = 'textToHtmlTokenizerMode';\n\n\tconstructor(\n\t\t@ILanguageService languageService: ILanguageService\n\t) {\n\t\tsuper();\n\t\tthis._register(languageService.registerLanguage({ id: this.languageId }));\n\t\tthis._register(TokenizationRegistry.register(this.languageId, {\n\t\t\tgetInitialState: (): IState => null!,\n\t\t\ttokenize: undefined!,\n\t\t\ttokenizeEncoded: (line: string, hasEOL: boolean, state: IState): EncodedTokenizationResult => {\n\t\t\t\tconst tokensArr: number[] = [];\n\t\t\t\tlet prevColor = -1 as ColorId;\n\t\t\t\tfor (let i = 0; i < line.length; i++) {\n\t\t\t\t\tconst colorId = (line.charAt(i) === '.' ? 7 : 9) as ColorId;\n\t\t\t\t\tif (prevColor !== colorId) {\n\t\t\t\t\t\ttokensArr.push(i);\n\t\t\t\t\t\ttokensArr.push((\n\t\t\t\t\t\t\tcolorId << MetadataConsts.FOREGROUND_OFFSET\n\t\t\t\t\t\t) >>> 0);\n\t\t\t\t\t}\n\t\t\t\t\tprevColor = colorId;\n\t\t\t\t}\n\n\t\t\t\tconst tokens = new Uint32Array(tokensArr.length);\n\t\t\t\tfor (let i = 0; i < tokens.length; i++) {\n\t\t\t\t\ttokens[i] = tokensArr[i];\n\t\t\t\t}\n\t\t\t\treturn new EncodedTokenizationResult(tokens, null!);\n\t\t\t}\n\t\t}));\n\t}\n}\n"]}