{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/editor/test/common/services/semanticTokensProviderStyling.test.ts","vs/editor/test/common/services/semanticTokensProviderStyling.test.ts"],"names":[],"mappings":"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","file":"semanticTokensProviderStyling.test.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport assert from 'assert';\nimport { DisposableStore } from '../../../../base/common/lifecycle.js';\nimport { SparseMultilineTokens } from '../../../common/tokens/sparseMultilineTokens.js';\nimport { MetadataConsts } from '../../../common/encodedTokenAttributes.js';\nimport { SemanticTokensProviderStyling, toMultilineTokens2 } from '../../../common/services/semanticTokensProviderStyling.js';\nimport { createModelServices } from '../testTextModel.js';\nimport { TestInstantiationService } from '../../../../platform/instantiation/test/common/instantiationServiceMock.js';\nimport { IColorTheme, IThemeService, ITokenStyle } from '../../../../platform/theme/common/themeService.js';\nimport { ILanguageService } from '../../../common/languages/language.js';\nimport { ensureNoDisposablesAreLeakedInTestSuite } from '../../../../base/test/common/utils.js';\n\nsuite('ModelService', () => {\n\tlet disposables: DisposableStore;\n\tlet instantiationService: TestInstantiationService;\n\tlet languageService: ILanguageService;\n\n\tsetup(() => {\n\t\tdisposables = new DisposableStore();\n\t\tinstantiationService = createModelServices(disposables);\n\t\tlanguageService = instantiationService.get(ILanguageService);\n\t});\n\n\tteardown(() => {\n\t\tdisposables.dispose();\n\t});\n\n\tensureNoDisposablesAreLeakedInTestSuite();\n\n\ttest('issue #134973: invalid semantic tokens should be handled better', () => {\n\t\tconst languageId = 'java';\n\t\tdisposables.add(languageService.registerLanguage({ id: languageId }));\n\t\tconst legend = {\n\t\t\ttokenTypes: ['st0', 'st1', 'st2', 'st3', 'st4', 'st5', 'st6', 'st7', 'st8', 'st9', 'st10'],\n\t\t\ttokenModifiers: []\n\t\t};\n\t\tinstantiationService.stub(IThemeService, {\n\t\t\tgetColorTheme() {\n\t\t\t\treturn <IColorTheme>{\n\t\t\t\t\tgetTokenStyleMetadata: (tokenType, tokenModifiers, languageId): ITokenStyle => {\n\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\tforeground: parseInt(tokenType.substr(2), 10),\n\t\t\t\t\t\t\tbold: undefined,\n\t\t\t\t\t\t\tunderline: undefined,\n\t\t\t\t\t\t\tstrikethrough: undefined,\n\t\t\t\t\t\t\titalic: undefined\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t}\n\t\t});\n\t\tconst styling = instantiationService.createInstance(SemanticTokensProviderStyling, legend);\n\t\tconst badTokens = {\n\t\t\tdata: new Uint32Array([\n\t\t\t\t0, 13, 16, 1, 0,\n\t\t\t\t1, 2, 6, 2, 0,\n\t\t\t\t0, 7, 6, 3, 0,\n\t\t\t\t0, 15, 8, 4, 0,\n\t\t\t\t0, 17, 1, 5, 0,\n\t\t\t\t0, 7, 5, 6, 0,\n\t\t\t\t1, 12, 8, 7, 0,\n\t\t\t\t0, 19, 5, 8, 0,\n\t\t\t\t0, 7, 1, 9, 0,\n\t\t\t\t0, 4294967294, 5, 10, 0\n\t\t\t])\n\t\t};\n\t\tconst result = toMultilineTokens2(badTokens, styling, languageId);\n\t\tconst expected = SparseMultilineTokens.create(1, new Uint32Array([\n\t\t\t0, 13, 29, (MetadataConsts.SEMANTIC_USE_FOREGROUND | (1 << MetadataConsts.FOREGROUND_OFFSET)),\n\t\t\t1, 2, 8, (MetadataConsts.SEMANTIC_USE_FOREGROUND | (2 << MetadataConsts.FOREGROUND_OFFSET)),\n\t\t\t1, 9, 15, (MetadataConsts.SEMANTIC_USE_FOREGROUND | (3 << MetadataConsts.FOREGROUND_OFFSET)),\n\t\t\t1, 24, 32, (MetadataConsts.SEMANTIC_USE_FOREGROUND | (4 << MetadataConsts.FOREGROUND_OFFSET)),\n\t\t\t1, 41, 42, (MetadataConsts.SEMANTIC_USE_FOREGROUND | (5 << MetadataConsts.FOREGROUND_OFFSET)),\n\t\t\t1, 48, 53, (MetadataConsts.SEMANTIC_USE_FOREGROUND | (6 << MetadataConsts.FOREGROUND_OFFSET)),\n\t\t\t2, 12, 20, (MetadataConsts.SEMANTIC_USE_FOREGROUND | (7 << MetadataConsts.FOREGROUND_OFFSET)),\n\t\t\t2, 31, 36, (MetadataConsts.SEMANTIC_USE_FOREGROUND | (8 << MetadataConsts.FOREGROUND_OFFSET)),\n\t\t\t2, 38, 39, (MetadataConsts.SEMANTIC_USE_FOREGROUND | (9 << MetadataConsts.FOREGROUND_OFFSET)),\n\t\t]));\n\t\tassert.deepStrictEqual(result.toString(), expected.toString());\n\t});\n\n\ttest('issue #148651: VSCode UI process can hang if a semantic token with negative values is returned by language service', () => {\n\t\tconst languageId = 'dockerfile';\n\t\tdisposables.add(languageService.registerLanguage({ id: languageId }));\n\t\tconst legend = {\n\t\t\ttokenTypes: ['st0', 'st1', 'st2', 'st3', 'st4', 'st5', 'st6', 'st7', 'st8', 'st9'],\n\t\t\ttokenModifiers: ['stm0', 'stm1', 'stm2']\n\t\t};\n\t\tinstantiationService.stub(IThemeService, {\n\t\t\tgetColorTheme() {\n\t\t\t\treturn <IColorTheme>{\n\t\t\t\t\tgetTokenStyleMetadata: (tokenType, tokenModifiers, languageId): ITokenStyle => {\n\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\tforeground: parseInt(tokenType.substr(2), 10),\n\t\t\t\t\t\t\tbold: undefined,\n\t\t\t\t\t\t\tunderline: undefined,\n\t\t\t\t\t\t\tstrikethrough: undefined,\n\t\t\t\t\t\t\titalic: undefined\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t}\n\t\t});\n\t\tconst styling = instantiationService.createInstance(SemanticTokensProviderStyling, legend);\n\t\tconst badTokens = {\n\t\t\tdata: new Uint32Array([\n\t\t\t\t0, 0, 3, 0, 0,\n\t\t\t\t0, 4, 2, 2, 0,\n\t\t\t\t0, 2, 3, 8, 0,\n\t\t\t\t0, 3, 1, 9, 0,\n\t\t\t\t0, 1, 1, 10, 0,\n\t\t\t\t0, 1, 4, 8, 0,\n\t\t\t\t0, 4, 4294967292, 2, 0,\n\t\t\t\t0, 4294967292, 4294967294, 8, 0,\n\t\t\t\t0, 4294967294, 1, 9, 0,\n\t\t\t\t0, 1, 1, 10, 0,\n\t\t\t\t0, 1, 3, 8, 0,\n\t\t\t\t0, 3, 4294967291, 8, 0,\n\t\t\t\t0, 4294967291, 1, 9, 0,\n\t\t\t\t0, 1, 1, 10, 0,\n\t\t\t\t0, 1, 4, 8, 0\n\t\t\t])\n\t\t};\n\t\tconst result = toMultilineTokens2(badTokens, styling, languageId);\n\t\tconst expected = SparseMultilineTokens.create(1, new Uint32Array([\n\t\t\t0, 4, 6, (MetadataConsts.SEMANTIC_USE_FOREGROUND | (1 << MetadataConsts.FOREGROUND_OFFSET)),\n\t\t\t0, 6, 9, (MetadataConsts.SEMANTIC_USE_FOREGROUND | (2 << MetadataConsts.FOREGROUND_OFFSET)),\n\t\t\t0, 9, 10, (MetadataConsts.SEMANTIC_USE_FOREGROUND | (3 << MetadataConsts.FOREGROUND_OFFSET)),\n\t\t\t0, 11, 15, (MetadataConsts.SEMANTIC_USE_FOREGROUND | (4 << MetadataConsts.FOREGROUND_OFFSET)),\n\t\t]));\n\t\tassert.deepStrictEqual(result.toString(), expected.toString());\n\t});\n\n\ttest('issue #149130: vscode freezes because of Bracket Pair Colorization', () => {\n\t\tconst languageId = 'q';\n\t\tdisposables.add(languageService.registerLanguage({ id: languageId }));\n\t\tconst legend = {\n\t\t\ttokenTypes: ['st0', 'st1', 'st2', 'st3', 'st4', 'st5'],\n\t\t\ttokenModifiers: ['stm0', 'stm1', 'stm2']\n\t\t};\n\t\tinstantiationService.stub(IThemeService, {\n\t\t\tgetColorTheme() {\n\t\t\t\treturn <IColorTheme>{\n\t\t\t\t\tgetTokenStyleMetadata: (tokenType, tokenModifiers, languageId): ITokenStyle => {\n\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\tforeground: parseInt(tokenType.substr(2), 10),\n\t\t\t\t\t\t\tbold: undefined,\n\t\t\t\t\t\t\tunderline: undefined,\n\t\t\t\t\t\t\tstrikethrough: undefined,\n\t\t\t\t\t\t\titalic: undefined\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t}\n\t\t});\n\t\tconst styling = instantiationService.createInstance(SemanticTokensProviderStyling, legend);\n\t\tconst badTokens = {\n\t\t\tdata: new Uint32Array([\n\t\t\t\t0, 11, 1, 1, 0,\n\t\t\t\t0, 4, 1, 1, 0,\n\t\t\t\t0, 4294967289, 1, 1, 0\n\t\t\t])\n\t\t};\n\t\tconst result = toMultilineTokens2(badTokens, styling, languageId);\n\t\tconst expected = SparseMultilineTokens.create(1, new Uint32Array([\n\t\t\t0, 11, 12, (MetadataConsts.SEMANTIC_USE_FOREGROUND | (1 << MetadataConsts.FOREGROUND_OFFSET)),\n\t\t\t0, 15, 16, (MetadataConsts.SEMANTIC_USE_FOREGROUND | (1 << MetadataConsts.FOREGROUND_OFFSET)),\n\t\t]));\n\t\tassert.deepStrictEqual(result.toString(), expected.toString());\n\t});\n});\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport assert from 'assert';\nimport { DisposableStore } from '../../../../base/common/lifecycle.js';\nimport { SparseMultilineTokens } from '../../../common/tokens/sparseMultilineTokens.js';\nimport { MetadataConsts } from '../../../common/encodedTokenAttributes.js';\nimport { SemanticTokensProviderStyling, toMultilineTokens2 } from '../../../common/services/semanticTokensProviderStyling.js';\nimport { createModelServices } from '../testTextModel.js';\nimport { TestInstantiationService } from '../../../../platform/instantiation/test/common/instantiationServiceMock.js';\nimport { IColorTheme, IThemeService, ITokenStyle } from '../../../../platform/theme/common/themeService.js';\nimport { ILanguageService } from '../../../common/languages/language.js';\nimport { ensureNoDisposablesAreLeakedInTestSuite } from '../../../../base/test/common/utils.js';\n\nsuite('ModelService', () => {\n\tlet disposables: DisposableStore;\n\tlet instantiationService: TestInstantiationService;\n\tlet languageService: ILanguageService;\n\n\tsetup(() => {\n\t\tdisposables = new DisposableStore();\n\t\tinstantiationService = createModelServices(disposables);\n\t\tlanguageService = instantiationService.get(ILanguageService);\n\t});\n\n\tteardown(() => {\n\t\tdisposables.dispose();\n\t});\n\n\tensureNoDisposablesAreLeakedInTestSuite();\n\n\ttest('issue #134973: invalid semantic tokens should be handled better', () => {\n\t\tconst languageId = 'java';\n\t\tdisposables.add(languageService.registerLanguage({ id: languageId }));\n\t\tconst legend = {\n\t\t\ttokenTypes: ['st0', 'st1', 'st2', 'st3', 'st4', 'st5', 'st6', 'st7', 'st8', 'st9', 'st10'],\n\t\t\ttokenModifiers: []\n\t\t};\n\t\tinstantiationService.stub(IThemeService, {\n\t\t\tgetColorTheme() {\n\t\t\t\treturn <IColorTheme>{\n\t\t\t\t\tgetTokenStyleMetadata: (tokenType, tokenModifiers, languageId): ITokenStyle => {\n\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\tforeground: parseInt(tokenType.substr(2), 10),\n\t\t\t\t\t\t\tbold: undefined,\n\t\t\t\t\t\t\tunderline: undefined,\n\t\t\t\t\t\t\tstrikethrough: undefined,\n\t\t\t\t\t\t\titalic: undefined\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t}\n\t\t});\n\t\tconst styling = instantiationService.createInstance(SemanticTokensProviderStyling, legend);\n\t\tconst badTokens = {\n\t\t\tdata: new Uint32Array([\n\t\t\t\t0, 13, 16, 1, 0,\n\t\t\t\t1, 2, 6, 2, 0,\n\t\t\t\t0, 7, 6, 3, 0,\n\t\t\t\t0, 15, 8, 4, 0,\n\t\t\t\t0, 17, 1, 5, 0,\n\t\t\t\t0, 7, 5, 6, 0,\n\t\t\t\t1, 12, 8, 7, 0,\n\t\t\t\t0, 19, 5, 8, 0,\n\t\t\t\t0, 7, 1, 9, 0,\n\t\t\t\t0, 4294967294, 5, 10, 0\n\t\t\t])\n\t\t};\n\t\tconst result = toMultilineTokens2(badTokens, styling, languageId);\n\t\tconst expected = SparseMultilineTokens.create(1, new Uint32Array([\n\t\t\t0, 13, 29, (MetadataConsts.SEMANTIC_USE_FOREGROUND | (1 << MetadataConsts.FOREGROUND_OFFSET)),\n\t\t\t1, 2, 8, (MetadataConsts.SEMANTIC_USE_FOREGROUND | (2 << MetadataConsts.FOREGROUND_OFFSET)),\n\t\t\t1, 9, 15, (MetadataConsts.SEMANTIC_USE_FOREGROUND | (3 << MetadataConsts.FOREGROUND_OFFSET)),\n\t\t\t1, 24, 32, (MetadataConsts.SEMANTIC_USE_FOREGROUND | (4 << MetadataConsts.FOREGROUND_OFFSET)),\n\t\t\t1, 41, 42, (MetadataConsts.SEMANTIC_USE_FOREGROUND | (5 << MetadataConsts.FOREGROUND_OFFSET)),\n\t\t\t1, 48, 53, (MetadataConsts.SEMANTIC_USE_FOREGROUND | (6 << MetadataConsts.FOREGROUND_OFFSET)),\n\t\t\t2, 12, 20, (MetadataConsts.SEMANTIC_USE_FOREGROUND | (7 << MetadataConsts.FOREGROUND_OFFSET)),\n\t\t\t2, 31, 36, (MetadataConsts.SEMANTIC_USE_FOREGROUND | (8 << MetadataConsts.FOREGROUND_OFFSET)),\n\t\t\t2, 38, 39, (MetadataConsts.SEMANTIC_USE_FOREGROUND | (9 << MetadataConsts.FOREGROUND_OFFSET)),\n\t\t]));\n\t\tassert.deepStrictEqual(result.toString(), expected.toString());\n\t});\n\n\ttest('issue #148651: VSCode UI process can hang if a semantic token with negative values is returned by language service', () => {\n\t\tconst languageId = 'dockerfile';\n\t\tdisposables.add(languageService.registerLanguage({ id: languageId }));\n\t\tconst legend = {\n\t\t\ttokenTypes: ['st0', 'st1', 'st2', 'st3', 'st4', 'st5', 'st6', 'st7', 'st8', 'st9'],\n\t\t\ttokenModifiers: ['stm0', 'stm1', 'stm2']\n\t\t};\n\t\tinstantiationService.stub(IThemeService, {\n\t\t\tgetColorTheme() {\n\t\t\t\treturn <IColorTheme>{\n\t\t\t\t\tgetTokenStyleMetadata: (tokenType, tokenModifiers, languageId): ITokenStyle => {\n\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\tforeground: parseInt(tokenType.substr(2), 10),\n\t\t\t\t\t\t\tbold: undefined,\n\t\t\t\t\t\t\tunderline: undefined,\n\t\t\t\t\t\t\tstrikethrough: undefined,\n\t\t\t\t\t\t\titalic: undefined\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t}\n\t\t});\n\t\tconst styling = instantiationService.createInstance(SemanticTokensProviderStyling, legend);\n\t\tconst badTokens = {\n\t\t\tdata: new Uint32Array([\n\t\t\t\t0, 0, 3, 0, 0,\n\t\t\t\t0, 4, 2, 2, 0,\n\t\t\t\t0, 2, 3, 8, 0,\n\t\t\t\t0, 3, 1, 9, 0,\n\t\t\t\t0, 1, 1, 10, 0,\n\t\t\t\t0, 1, 4, 8, 0,\n\t\t\t\t0, 4, 4294967292, 2, 0,\n\t\t\t\t0, 4294967292, 4294967294, 8, 0,\n\t\t\t\t0, 4294967294, 1, 9, 0,\n\t\t\t\t0, 1, 1, 10, 0,\n\t\t\t\t0, 1, 3, 8, 0,\n\t\t\t\t0, 3, 4294967291, 8, 0,\n\t\t\t\t0, 4294967291, 1, 9, 0,\n\t\t\t\t0, 1, 1, 10, 0,\n\t\t\t\t0, 1, 4, 8, 0\n\t\t\t])\n\t\t};\n\t\tconst result = toMultilineTokens2(badTokens, styling, languageId);\n\t\tconst expected = SparseMultilineTokens.create(1, new Uint32Array([\n\t\t\t0, 4, 6, (MetadataConsts.SEMANTIC_USE_FOREGROUND | (1 << MetadataConsts.FOREGROUND_OFFSET)),\n\t\t\t0, 6, 9, (MetadataConsts.SEMANTIC_USE_FOREGROUND | (2 << MetadataConsts.FOREGROUND_OFFSET)),\n\t\t\t0, 9, 10, (MetadataConsts.SEMANTIC_USE_FOREGROUND | (3 << MetadataConsts.FOREGROUND_OFFSET)),\n\t\t\t0, 11, 15, (MetadataConsts.SEMANTIC_USE_FOREGROUND | (4 << MetadataConsts.FOREGROUND_OFFSET)),\n\t\t]));\n\t\tassert.deepStrictEqual(result.toString(), expected.toString());\n\t});\n\n\ttest('issue #149130: vscode freezes because of Bracket Pair Colorization', () => {\n\t\tconst languageId = 'q';\n\t\tdisposables.add(languageService.registerLanguage({ id: languageId }));\n\t\tconst legend = {\n\t\t\ttokenTypes: ['st0', 'st1', 'st2', 'st3', 'st4', 'st5'],\n\t\t\ttokenModifiers: ['stm0', 'stm1', 'stm2']\n\t\t};\n\t\tinstantiationService.stub(IThemeService, {\n\t\t\tgetColorTheme() {\n\t\t\t\treturn <IColorTheme>{\n\t\t\t\t\tgetTokenStyleMetadata: (tokenType, tokenModifiers, languageId): ITokenStyle => {\n\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\tforeground: parseInt(tokenType.substr(2), 10),\n\t\t\t\t\t\t\tbold: undefined,\n\t\t\t\t\t\t\tunderline: undefined,\n\t\t\t\t\t\t\tstrikethrough: undefined,\n\t\t\t\t\t\t\titalic: undefined\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t}\n\t\t});\n\t\tconst styling = instantiationService.createInstance(SemanticTokensProviderStyling, legend);\n\t\tconst badTokens = {\n\t\t\tdata: new Uint32Array([\n\t\t\t\t0, 11, 1, 1, 0,\n\t\t\t\t0, 4, 1, 1, 0,\n\t\t\t\t0, 4294967289, 1, 1, 0\n\t\t\t])\n\t\t};\n\t\tconst result = toMultilineTokens2(badTokens, styling, languageId);\n\t\tconst expected = SparseMultilineTokens.create(1, new Uint32Array([\n\t\t\t0, 11, 12, (MetadataConsts.SEMANTIC_USE_FOREGROUND | (1 << MetadataConsts.FOREGROUND_OFFSET)),\n\t\t\t0, 15, 16, (MetadataConsts.SEMANTIC_USE_FOREGROUND | (1 << MetadataConsts.FOREGROUND_OFFSET)),\n\t\t]));\n\t\tassert.deepStrictEqual(result.toString(), expected.toString());\n\t});\n});\n"]}