{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/editor/test/common/model/tokensStore.test.ts","vs/editor/test/common/model/tokensStore.test.ts"],"names":[],"mappings":"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","file":"tokensStore.test.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport assert from 'assert';\nimport { DisposableStore } from '../../../../base/common/lifecycle.js';\nimport { ensureNoDisposablesAreLeakedInTestSuite } from '../../../../base/test/common/utils.js';\nimport { ISingleEditOperation } from '../../../common/core/editOperation.js';\nimport { Position } from '../../../common/core/position.js';\nimport { Range } from '../../../common/core/range.js';\nimport { ColorId, FontStyle, MetadataConsts, TokenMetadata } from '../../../common/encodedTokenAttributes.js';\nimport { ILanguageConfigurationService, LanguageConfigurationService } from '../../../common/languages/languageConfigurationRegistry.js';\nimport { TextModel } from '../../../common/model/textModel.js';\nimport { LanguageIdCodec } from '../../../common/services/languagesRegistry.js';\nimport { LineTokens } from '../../../common/tokens/lineTokens.js';\nimport { SparseMultilineTokens } from '../../../common/tokens/sparseMultilineTokens.js';\nimport { SparseTokensStore } from '../../../common/tokens/sparseTokensStore.js';\nimport { createModelServices, createTextModel, instantiateTextModel } from '../testTextModel.js';\n\nsuite('TokensStore', () => {\n\n\tensureNoDisposablesAreLeakedInTestSuite();\n\n\tconst SEMANTIC_COLOR = 5 as ColorId;\n\n\tfunction parseTokensState(state: string[]): { text: string; tokens: SparseMultilineTokens } {\n\t\tconst text: string[] = [];\n\t\tconst tokens: number[] = [];\n\t\tlet baseLine = 1;\n\t\tfor (let i = 0; i < state.length; i++) {\n\t\t\tconst line = state[i];\n\n\t\t\tlet startOffset = 0;\n\t\t\tlet lineText = '';\n\t\t\twhile (true) {\n\t\t\t\tconst firstPipeOffset = line.indexOf('|', startOffset);\n\t\t\t\tif (firstPipeOffset === -1) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tconst secondPipeOffset = line.indexOf('|', firstPipeOffset + 1);\n\t\t\t\tif (secondPipeOffset === -1) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tif (firstPipeOffset + 1 === secondPipeOffset) {\n\t\t\t\t\t// skip ||\n\t\t\t\t\tlineText += line.substring(startOffset, secondPipeOffset + 1);\n\t\t\t\t\tstartOffset = secondPipeOffset + 1;\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tlineText += line.substring(startOffset, firstPipeOffset);\n\t\t\t\tconst tokenStartCharacter = lineText.length;\n\t\t\t\tconst tokenLength = secondPipeOffset - firstPipeOffset - 1;\n\t\t\t\tconst metadata = (\n\t\t\t\t\tSEMANTIC_COLOR << MetadataConsts.FOREGROUND_OFFSET\n\t\t\t\t\t| MetadataConsts.SEMANTIC_USE_FOREGROUND\n\t\t\t\t);\n\n\t\t\t\tif (tokens.length === 0) {\n\t\t\t\t\tbaseLine = i + 1;\n\t\t\t\t}\n\t\t\t\ttokens.push(i + 1 - baseLine, tokenStartCharacter, tokenStartCharacter + tokenLength, metadata);\n\n\t\t\t\tlineText += line.substr(firstPipeOffset + 1, tokenLength);\n\t\t\t\tstartOffset = secondPipeOffset + 1;\n\t\t\t}\n\n\t\t\tlineText += line.substring(startOffset);\n\n\t\t\ttext.push(lineText);\n\t\t}\n\n\t\treturn {\n\t\t\ttext: text.join('\\n'),\n\t\t\ttokens: SparseMultilineTokens.create(baseLine, new Uint32Array(tokens))\n\t\t};\n\t}\n\n\tfunction extractState(model: TextModel): string[] {\n\t\tconst result: string[] = [];\n\t\tfor (let lineNumber = 1; lineNumber <= model.getLineCount(); lineNumber++) {\n\t\t\tconst lineTokens = model.tokenization.getLineTokens(lineNumber);\n\t\t\tconst lineContent = model.getLineContent(lineNumber);\n\n\t\t\tlet lineText = '';\n\t\t\tfor (let i = 0; i < lineTokens.getCount(); i++) {\n\t\t\t\tconst tokenStartCharacter = lineTokens.getStartOffset(i);\n\t\t\t\tconst tokenEndCharacter = lineTokens.getEndOffset(i);\n\t\t\t\tconst metadata = lineTokens.getMetadata(i);\n\t\t\t\tconst color = TokenMetadata.getForeground(metadata);\n\t\t\t\tconst tokenText = lineContent.substring(tokenStartCharacter, tokenEndCharacter);\n\t\t\t\tif (color === SEMANTIC_COLOR) {\n\t\t\t\t\tlineText += `|${tokenText}|`;\n\t\t\t\t} else {\n\t\t\t\t\tlineText += tokenText;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tresult.push(lineText);\n\t\t}\n\t\treturn result;\n\t}\n\n\tfunction testTokensAdjustment(rawInitialState: string[], edits: ISingleEditOperation[], rawFinalState: string[]) {\n\t\tconst initialState = parseTokensState(rawInitialState);\n\t\tconst model = createTextModel(initialState.text);\n\t\tmodel.tokenization.setSemanticTokens([initialState.tokens], true);\n\n\t\tmodel.applyEdits(edits);\n\n\t\tconst actualState = extractState(model);\n\t\tassert.deepStrictEqual(actualState, rawFinalState);\n\n\t\tmodel.dispose();\n\t}\n\n\ttest('issue #86303 - color shifting between different tokens', () => {\n\t\ttestTokensAdjustment(\n\t\t\t[\n\t\t\t\t`import { |URI| } from 'vs/base/common/uri';`,\n\t\t\t\t`const foo = |URI|.parse('hey');`\n\t\t\t],\n\t\t\t[\n\t\t\t\t{ range: new Range(2, 9, 2, 10), text: '' }\n\t\t\t],\n\t\t\t[\n\t\t\t\t`import { |URI| } from 'vs/base/common/uri';`,\n\t\t\t\t`const fo = |URI|.parse('hey');`\n\t\t\t]\n\t\t);\n\t});\n\n\ttest('deleting a newline', () => {\n\t\ttestTokensAdjustment(\n\t\t\t[\n\t\t\t\t`import { |URI| } from 'vs/base/common/uri';`,\n\t\t\t\t`const foo = |URI|.parse('hey');`\n\t\t\t],\n\t\t\t[\n\t\t\t\t{ range: new Range(1, 42, 2, 1), text: '' }\n\t\t\t],\n\t\t\t[\n\t\t\t\t`import { |URI| } from 'vs/base/common/uri';const foo = |URI|.parse('hey');`\n\t\t\t]\n\t\t);\n\t});\n\n\ttest('inserting a newline', () => {\n\t\ttestTokensAdjustment(\n\t\t\t[\n\t\t\t\t`import { |URI| } from 'vs/base/common/uri';const foo = |URI|.parse('hey');`\n\t\t\t],\n\t\t\t[\n\t\t\t\t{ range: new Range(1, 42, 1, 42), text: '\\n' }\n\t\t\t],\n\t\t\t[\n\t\t\t\t`import { |URI| } from 'vs/base/common/uri';`,\n\t\t\t\t`const foo = |URI|.parse('hey');`\n\t\t\t]\n\t\t);\n\t});\n\n\ttest('deleting a newline 2', () => {\n\t\ttestTokensAdjustment(\n\t\t\t[\n\t\t\t\t`import { `,\n\t\t\t\t`    |URI| } from 'vs/base/common/uri';const foo = |URI|.parse('hey');`\n\t\t\t],\n\t\t\t[\n\t\t\t\t{ range: new Range(1, 10, 2, 5), text: '' }\n\t\t\t],\n\t\t\t[\n\t\t\t\t`import { |URI| } from 'vs/base/common/uri';const foo = |URI|.parse('hey');`\n\t\t\t]\n\t\t);\n\t});\n\n\ttest('issue #179268: a complex edit', () => {\n\t\ttestTokensAdjustment(\n\t\t\t[\n\t\t\t\t`|export| |'interior_material_selector.dart'|;`,\n\t\t\t\t`|export| |'mileage_selector.dart'|;`,\n\t\t\t\t`|export| |'owners_selector.dart'|;`,\n\t\t\t\t`|export| |'price_selector.dart'|;`,\n\t\t\t\t`|export| |'seat_count_selector.dart'|;`,\n\t\t\t\t`|export| |'year_selector.dart'|;`,\n\t\t\t\t`|export| |'winter_options_selector.dart'|;|export| |'camera_selector.dart'|;`\n\t\t\t],\n\t\t\t[\n\t\t\t\t{ range: new Range(1, 9, 1, 9), text: `camera_selector.dart';\\nexport '` },\n\t\t\t\t{ range: new Range(6, 9, 7, 9), text: `` },\n\t\t\t\t{ range: new Range(7, 39, 7, 39), text: `\\n` },\n\t\t\t\t{ range: new Range(7, 47, 7, 48), text: `ye` },\n\t\t\t\t{ range: new Range(7, 49, 7, 51), text: `` },\n\t\t\t\t{ range: new Range(7, 52, 7, 53), text: `` },\n\t\t\t],\n\t\t\t[\n\t\t\t\t`|export| |'|camera_selector.dart';`,\n\t\t\t\t`export 'interior_material_selector.dart';`,\n\t\t\t\t`|export| |'mileage_selector.dart'|;`,\n\t\t\t\t`|export| |'owners_selector.dart'|;`,\n\t\t\t\t`|export| |'price_selector.dart'|;`,\n\t\t\t\t`|export| |'seat_count_selector.dart'|;`,\n\t\t\t\t`|export| |'||winter_options_selector.dart'|;`,\n\t\t\t\t`|export| |'year_selector.dart'|;`\n\t\t\t]\n\t\t);\n\t});\n\n\ttest('issue #91936: Semantic token color highlighting fails on line with selected text', () => {\n\t\tconst model = createTextModel('                    else if ($s = 08) then \\'\\\\b\\'');\n\t\tmodel.tokenization.setSemanticTokens([\n\t\t\tSparseMultilineTokens.create(1, new Uint32Array([\n\t\t\t\t0, 20, 24, 0b01111000000000010000,\n\t\t\t\t0, 25, 27, 0b01111000000000010000,\n\t\t\t\t0, 28, 29, 0b00001000000000010000,\n\t\t\t\t0, 29, 31, 0b10000000000000010000,\n\t\t\t\t0, 32, 33, 0b00001000000000010000,\n\t\t\t\t0, 34, 36, 0b00110000000000010000,\n\t\t\t\t0, 36, 37, 0b00001000000000010000,\n\t\t\t\t0, 38, 42, 0b01111000000000010000,\n\t\t\t\t0, 43, 47, 0b01011000000000010000,\n\t\t\t]))\n\t\t], true);\n\t\tconst lineTokens = model.tokenization.getLineTokens(1);\n\t\tconst decodedTokens: number[] = [];\n\t\tfor (let i = 0, len = lineTokens.getCount(); i < len; i++) {\n\t\t\tdecodedTokens.push(lineTokens.getEndOffset(i), lineTokens.getMetadata(i));\n\t\t}\n\n\t\tassert.deepStrictEqual(decodedTokens, [\n\t\t\t20, 0b10000000001000010000000001,\n\t\t\t24, 0b10000001111000010000000001,\n\t\t\t25, 0b10000000001000010000000001,\n\t\t\t27, 0b10000001111000010000000001,\n\t\t\t28, 0b10000000001000010000000001,\n\t\t\t29, 0b10000000001000010000000001,\n\t\t\t31, 0b10000010000000010000000001,\n\t\t\t32, 0b10000000001000010000000001,\n\t\t\t33, 0b10000000001000010000000001,\n\t\t\t34, 0b10000000001000010000000001,\n\t\t\t36, 0b10000000110000010000000001,\n\t\t\t37, 0b10000000001000010000000001,\n\t\t\t38, 0b10000000001000010000000001,\n\t\t\t42, 0b10000001111000010000000001,\n\t\t\t43, 0b10000000001000010000000001,\n\t\t\t47, 0b10000001011000010000000001\n\t\t]);\n\n\t\tmodel.dispose();\n\t});\n\n\ttest('issue #147944: Language id \"vs.editor.nullLanguage\" is not configured nor known', () => {\n\t\tconst disposables = new DisposableStore();\n\t\tconst instantiationService = createModelServices(disposables, [\n\t\t\t[ILanguageConfigurationService, LanguageConfigurationService]\n\t\t]);\n\t\tconst model = disposables.add(instantiateTextModel(instantiationService, '--[[\\n\\n]]'));\n\t\tmodel.tokenization.setSemanticTokens([\n\t\t\tSparseMultilineTokens.create(1, new Uint32Array([\n\t\t\t\t0, 2, 4, 0b100000000000010000,\n\t\t\t\t1, 0, 0, 0b100000000000010000,\n\t\t\t\t2, 0, 2, 0b100000000000010000,\n\t\t\t]))\n\t\t], true);\n\t\tassert.strictEqual(model.getWordAtPosition(new Position(2, 1)), null);\n\t\tdisposables.dispose();\n\t});\n\n\ttest('partial tokens 1', () => {\n\t\tconst codec = new LanguageIdCodec();\n\t\tconst store = new SparseTokensStore(codec);\n\n\t\t// setPartial: [1,1 -> 31,2], [(5,5-10),(10,5-10),(15,5-10),(20,5-10),(25,5-10),(30,5-10)]\n\t\tstore.setPartial(new Range(1, 1, 31, 2), [\n\t\t\tSparseMultilineTokens.create(5, new Uint32Array([\n\t\t\t\t0, 5, 10, 1,\n\t\t\t\t5, 5, 10, 2,\n\t\t\t\t10, 5, 10, 3,\n\t\t\t\t15, 5, 10, 4,\n\t\t\t\t20, 5, 10, 5,\n\t\t\t\t25, 5, 10, 6,\n\t\t\t]))\n\t\t]);\n\n\t\t// setPartial: [18,1 -> 42,1], [(20,5-10),(25,5-10),(30,5-10),(35,5-10),(40,5-10)]\n\t\tstore.setPartial(new Range(18, 1, 42, 1), [\n\t\t\tSparseMultilineTokens.create(20, new Uint32Array([\n\t\t\t\t0, 5, 10, 4,\n\t\t\t\t5, 5, 10, 5,\n\t\t\t\t10, 5, 10, 6,\n\t\t\t\t15, 5, 10, 7,\n\t\t\t\t20, 5, 10, 8,\n\t\t\t]))\n\t\t]);\n\n\t\t// setPartial: [1,1 -> 31,2], [(5,5-10),(10,5-10),(15,5-10),(20,5-10),(25,5-10),(30,5-10)]\n\t\tstore.setPartial(new Range(1, 1, 31, 2), [\n\t\t\tSparseMultilineTokens.create(5, new Uint32Array([\n\t\t\t\t0, 5, 10, 1,\n\t\t\t\t5, 5, 10, 2,\n\t\t\t\t10, 5, 10, 3,\n\t\t\t\t15, 5, 10, 4,\n\t\t\t\t20, 5, 10, 5,\n\t\t\t\t25, 5, 10, 6,\n\t\t\t]))\n\t\t]);\n\n\t\tconst lineTokens = store.addSparseTokens(10, new LineTokens(new Uint32Array([12, 1]), `enum Enum1 {`, codec));\n\t\tassert.strictEqual(lineTokens.getCount(), 3);\n\t});\n\n\ttest('partial tokens 2', () => {\n\t\tconst codec = new LanguageIdCodec();\n\t\tconst store = new SparseTokensStore(codec);\n\n\t\t// setPartial: [1,1 -> 31,2], [(5,5-10),(10,5-10),(15,5-10),(20,5-10),(25,5-10),(30,5-10)]\n\t\tstore.setPartial(new Range(1, 1, 31, 2), [\n\t\t\tSparseMultilineTokens.create(5, new Uint32Array([\n\t\t\t\t0, 5, 10, 1,\n\t\t\t\t5, 5, 10, 2,\n\t\t\t\t10, 5, 10, 3,\n\t\t\t\t15, 5, 10, 4,\n\t\t\t\t20, 5, 10, 5,\n\t\t\t\t25, 5, 10, 6,\n\t\t\t]))\n\t\t]);\n\n\t\t// setPartial: [6,1 -> 36,2], [(10,5-10),(15,5-10),(20,5-10),(25,5-10),(30,5-10),(35,5-10)]\n\t\tstore.setPartial(new Range(6, 1, 36, 2), [\n\t\t\tSparseMultilineTokens.create(10, new Uint32Array([\n\t\t\t\t0, 5, 10, 2,\n\t\t\t\t5, 5, 10, 3,\n\t\t\t\t10, 5, 10, 4,\n\t\t\t\t15, 5, 10, 5,\n\t\t\t\t20, 5, 10, 6,\n\t\t\t]))\n\t\t]);\n\n\t\t// setPartial: [17,1 -> 42,1], [(20,5-10),(25,5-10),(30,5-10),(35,5-10),(40,5-10)]\n\t\tstore.setPartial(new Range(17, 1, 42, 1), [\n\t\t\tSparseMultilineTokens.create(20, new Uint32Array([\n\t\t\t\t0, 5, 10, 4,\n\t\t\t\t5, 5, 10, 5,\n\t\t\t\t10, 5, 10, 6,\n\t\t\t\t15, 5, 10, 7,\n\t\t\t\t20, 5, 10, 8,\n\t\t\t]))\n\t\t]);\n\n\t\tconst lineTokens = store.addSparseTokens(20, new LineTokens(new Uint32Array([12, 1]), `enum Enum1 {`, codec));\n\t\tassert.strictEqual(lineTokens.getCount(), 3);\n\t});\n\n\ttest('partial tokens 3', () => {\n\t\tconst codec = new LanguageIdCodec();\n\t\tconst store = new SparseTokensStore(codec);\n\n\t\t// setPartial: [1,1 -> 31,2], [(5,5-10),(10,5-10),(15,5-10),(20,5-10),(25,5-10),(30,5-10)]\n\t\tstore.setPartial(new Range(1, 1, 31, 2), [\n\t\t\tSparseMultilineTokens.create(5, new Uint32Array([\n\t\t\t\t0, 5, 10, 1,\n\t\t\t\t5, 5, 10, 2,\n\t\t\t\t10, 5, 10, 3,\n\t\t\t\t15, 5, 10, 4,\n\t\t\t\t20, 5, 10, 5,\n\t\t\t\t25, 5, 10, 6,\n\t\t\t]))\n\t\t]);\n\n\t\t// setPartial: [11,1 -> 16,2], [(15,5-10),(20,5-10)]\n\t\tstore.setPartial(new Range(11, 1, 16, 2), [\n\t\t\tSparseMultilineTokens.create(10, new Uint32Array([\n\t\t\t\t0, 5, 10, 3,\n\t\t\t\t5, 5, 10, 4,\n\t\t\t]))\n\t\t]);\n\n\t\tconst lineTokens = store.addSparseTokens(5, new LineTokens(new Uint32Array([12, 1]), `enum Enum1 {`, codec));\n\t\tassert.strictEqual(lineTokens.getCount(), 3);\n\t});\n\n\ttest('issue #94133: Semantic colors stick around when using (only) range provider', () => {\n\t\tconst codec = new LanguageIdCodec();\n\t\tconst store = new SparseTokensStore(codec);\n\n\t\t// setPartial: [1,1 -> 1,20] [(1,9-11)]\n\t\tstore.setPartial(new Range(1, 1, 1, 20), [\n\t\t\tSparseMultilineTokens.create(1, new Uint32Array([\n\t\t\t\t0, 9, 11, 1,\n\t\t\t]))\n\t\t]);\n\n\t\t// setPartial: [1,1 -> 1,20], []\n\t\tstore.setPartial(new Range(1, 1, 1, 20), []);\n\n\t\tconst lineTokens = store.addSparseTokens(1, new LineTokens(new Uint32Array([12, 1]), `enum Enum1 {`, codec));\n\t\tassert.strictEqual(lineTokens.getCount(), 1);\n\t});\n\n\ttest('bug', () => {\n\t\tfunction createTokens(str: string): SparseMultilineTokens {\n\t\t\tstr = str.replace(/^\\[\\(/, '');\n\t\t\tstr = str.replace(/\\)\\]$/, '');\n\t\t\tconst strTokens = str.split('),(');\n\t\t\tconst result: number[] = [];\n\t\t\tlet firstLineNumber = 0;\n\t\t\tfor (const strToken of strTokens) {\n\t\t\t\tconst pieces = strToken.split(',');\n\t\t\t\tconst chars = pieces[1].split('-');\n\t\t\t\tconst lineNumber = parseInt(pieces[0], 10);\n\t\t\t\tconst startChar = parseInt(chars[0], 10);\n\t\t\t\tconst endChar = parseInt(chars[1], 10);\n\t\t\t\tif (firstLineNumber === 0) {\n\t\t\t\t\t// this is the first line\n\t\t\t\t\tfirstLineNumber = lineNumber;\n\t\t\t\t}\n\t\t\t\tresult.push(lineNumber - firstLineNumber, startChar, endChar, (lineNumber + startChar) % 13);\n\t\t\t}\n\t\t\treturn SparseMultilineTokens.create(firstLineNumber, new Uint32Array(result));\n\t\t}\n\n\t\tconst codec = new LanguageIdCodec();\n\t\tconst store = new SparseTokensStore(codec);\n\t\t// setPartial [36446,1 -> 36475,115] [(36448,24-29),(36448,33-46),(36448,47-54),(36450,25-35),(36450,36-50),(36451,28-33),(36451,36-49),(36451,50-57),(36452,35-53),(36452,54-62),(36454,33-38),(36454,41-54),(36454,55-60),(36455,35-53),(36455,54-62),(36457,33-44),(36457,45-49),(36457,50-56),(36457,62-83),(36457,84-88),(36458,35-53),(36458,54-62),(36460,33-37),(36460,38-42),(36460,47-57),(36460,58-67),(36461,35-53),(36461,54-62),(36463,34-38),(36463,39-45),(36463,46-51),(36463,54-63),(36463,64-71),(36463,76-80),(36463,81-87),(36463,88-92),(36463,97-107),(36463,108-119),(36464,35-53),(36464,54-62),(36466,33-71),(36466,72-76),(36467,35-53),(36467,54-62),(36469,24-29),(36469,33-46),(36469,47-54),(36470,24-35),(36470,38-46),(36473,25-35),(36473,36-51),(36474,28-33),(36474,36-49),(36474,50-58),(36475,35-53),(36475,54-62)]\n\t\tstore.setPartial(\n\t\t\tnew Range(36446, 1, 36475, 115),\n\t\t\t[createTokens('[(36448,24-29),(36448,33-46),(36448,47-54),(36450,25-35),(36450,36-50),(36451,28-33),(36451,36-49),(36451,50-57),(36452,35-53),(36452,54-62),(36454,33-38),(36454,41-54),(36454,55-60),(36455,35-53),(36455,54-62),(36457,33-44),(36457,45-49),(36457,50-56),(36457,62-83),(36457,84-88),(36458,35-53),(36458,54-62),(36460,33-37),(36460,38-42),(36460,47-57),(36460,58-67),(36461,35-53),(36461,54-62),(36463,34-38),(36463,39-45),(36463,46-51),(36463,54-63),(36463,64-71),(36463,76-80),(36463,81-87),(36463,88-92),(36463,97-107),(36463,108-119),(36464,35-53),(36464,54-62),(36466,33-71),(36466,72-76),(36467,35-53),(36467,54-62),(36469,24-29),(36469,33-46),(36469,47-54),(36470,24-35),(36470,38-46),(36473,25-35),(36473,36-51),(36474,28-33),(36474,36-49),(36474,50-58),(36475,35-53),(36475,54-62)]')]\n\t\t);\n\t\t// setPartial [36436,1 -> 36464,142] [(36437,33-37),(36437,38-42),(36437,47-57),(36437,58-67),(36438,35-53),(36438,54-62),(36440,24-29),(36440,33-46),(36440,47-53),(36442,25-35),(36442,36-50),(36443,30-39),(36443,42-46),(36443,47-53),(36443,54-58),(36443,63-73),(36443,74-84),(36443,87-91),(36443,92-98),(36443,101-105),(36443,106-112),(36443,113-119),(36444,28-37),(36444,38-42),(36444,47-57),(36444,58-75),(36444,80-95),(36444,96-105),(36445,35-53),(36445,54-62),(36448,24-29),(36448,33-46),(36448,47-54),(36450,25-35),(36450,36-50),(36451,28-33),(36451,36-49),(36451,50-57),(36452,35-53),(36452,54-62),(36454,33-38),(36454,41-54),(36454,55-60),(36455,35-53),(36455,54-62),(36457,33-44),(36457,45-49),(36457,50-56),(36457,62-83),(36457,84-88),(36458,35-53),(36458,54-62),(36460,33-37),(36460,38-42),(36460,47-57),(36460,58-67),(36461,35-53),(36461,54-62),(36463,34-38),(36463,39-45),(36463,46-51),(36463,54-63),(36463,64-71),(36463,76-80),(36463,81-87),(36463,88-92),(36463,97-107),(36463,108-119),(36464,35-53),(36464,54-62)]\n\t\tstore.setPartial(\n\t\t\tnew Range(36436, 1, 36464, 142),\n\t\t\t[createTokens('[(36437,33-37),(36437,38-42),(36437,47-57),(36437,58-67),(36438,35-53),(36438,54-62),(36440,24-29),(36440,33-46),(36440,47-53),(36442,25-35),(36442,36-50),(36443,30-39),(36443,42-46),(36443,47-53),(36443,54-58),(36443,63-73),(36443,74-84),(36443,87-91),(36443,92-98),(36443,101-105),(36443,106-112),(36443,113-119),(36444,28-37),(36444,38-42),(36444,47-57),(36444,58-75),(36444,80-95),(36444,96-105),(36445,35-53),(36445,54-62),(36448,24-29),(36448,33-46),(36448,47-54),(36450,25-35),(36450,36-50),(36451,28-33),(36451,36-49),(36451,50-57),(36452,35-53),(36452,54-62),(36454,33-38),(36454,41-54),(36454,55-60),(36455,35-53),(36455,54-62),(36457,33-44),(36457,45-49),(36457,50-56),(36457,62-83),(36457,84-88),(36458,35-53),(36458,54-62),(36460,33-37),(36460,38-42),(36460,47-57),(36460,58-67),(36461,35-53),(36461,54-62),(36463,34-38),(36463,39-45),(36463,46-51),(36463,54-63),(36463,64-71),(36463,76-80),(36463,81-87),(36463,88-92),(36463,97-107),(36463,108-119),(36464,35-53),(36464,54-62)]')]\n\t\t);\n\t\t// setPartial [36457,1 -> 36485,140] [(36457,33-44),(36457,45-49),(36457,50-56),(36457,62-83),(36457,84-88),(36458,35-53),(36458,54-62),(36460,33-37),(36460,38-42),(36460,47-57),(36460,58-67),(36461,35-53),(36461,54-62),(36463,34-38),(36463,39-45),(36463,46-51),(36463,54-63),(36463,64-71),(36463,76-80),(36463,81-87),(36463,88-92),(36463,97-107),(36463,108-119),(36464,35-53),(36464,54-62),(36466,33-71),(36466,72-76),(36467,35-53),(36467,54-62),(36469,24-29),(36469,33-46),(36469,47-54),(36470,24-35),(36470,38-46),(36473,25-35),(36473,36-51),(36474,28-33),(36474,36-49),(36474,50-58),(36475,35-53),(36475,54-62),(36477,28-32),(36477,33-37),(36477,42-52),(36477,53-69),(36478,32-36),(36478,37-41),(36478,46-56),(36478,57-74),(36479,32-36),(36479,37-41),(36479,46-56),(36479,57-76),(36480,32-36),(36480,37-41),(36480,46-56),(36480,57-68),(36481,32-36),(36481,37-41),(36481,46-56),(36481,57-68),(36482,39-57),(36482,58-66),(36484,34-38),(36484,39-45),(36484,46-50),(36484,55-65),(36484,66-82),(36484,86-97),(36484,98-102),(36484,103-109),(36484,111-124),(36484,125-133),(36485,39-57),(36485,58-66)]\n\t\tstore.setPartial(\n\t\t\tnew Range(36457, 1, 36485, 140),\n\t\t\t[createTokens('[(36457,33-44),(36457,45-49),(36457,50-56),(36457,62-83),(36457,84-88),(36458,35-53),(36458,54-62),(36460,33-37),(36460,38-42),(36460,47-57),(36460,58-67),(36461,35-53),(36461,54-62),(36463,34-38),(36463,39-45),(36463,46-51),(36463,54-63),(36463,64-71),(36463,76-80),(36463,81-87),(36463,88-92),(36463,97-107),(36463,108-119),(36464,35-53),(36464,54-62),(36466,33-71),(36466,72-76),(36467,35-53),(36467,54-62),(36469,24-29),(36469,33-46),(36469,47-54),(36470,24-35),(36470,38-46),(36473,25-35),(36473,36-51),(36474,28-33),(36474,36-49),(36474,50-58),(36475,35-53),(36475,54-62),(36477,28-32),(36477,33-37),(36477,42-52),(36477,53-69),(36478,32-36),(36478,37-41),(36478,46-56),(36478,57-74),(36479,32-36),(36479,37-41),(36479,46-56),(36479,57-76),(36480,32-36),(36480,37-41),(36480,46-56),(36480,57-68),(36481,32-36),(36481,37-41),(36481,46-56),(36481,57-68),(36482,39-57),(36482,58-66),(36484,34-38),(36484,39-45),(36484,46-50),(36484,55-65),(36484,66-82),(36484,86-97),(36484,98-102),(36484,103-109),(36484,111-124),(36484,125-133),(36485,39-57),(36485,58-66)]')]\n\t\t);\n\t\t// setPartial [36441,1 -> 36469,56] [(36442,25-35),(36442,36-50),(36443,30-39),(36443,42-46),(36443,47-53),(36443,54-58),(36443,63-73),(36443,74-84),(36443,87-91),(36443,92-98),(36443,101-105),(36443,106-112),(36443,113-119),(36444,28-37),(36444,38-42),(36444,47-57),(36444,58-75),(36444,80-95),(36444,96-105),(36445,35-53),(36445,54-62),(36448,24-29),(36448,33-46),(36448,47-54),(36450,25-35),(36450,36-50),(36451,28-33),(36451,36-49),(36451,50-57),(36452,35-53),(36452,54-62),(36454,33-38),(36454,41-54),(36454,55-60),(36455,35-53),(36455,54-62),(36457,33-44),(36457,45-49),(36457,50-56),(36457,62-83),(36457,84-88),(36458,35-53),(36458,54-62),(36460,33-37),(36460,38-42),(36460,47-57),(36460,58-67),(36461,35-53),(36461,54-62),(36463,34-38),(36463,39-45),(36463,46-51),(36463,54-63),(36463,64-71),(36463,76-80),(36463,81-87),(36463,88-92),(36463,97-107),(36463,108-119),(36464,35-53),(36464,54-62),(36466,33-71),(36466,72-76),(36467,35-53),(36467,54-62),(36469,24-29),(36469,33-46),(36469,47-54),(36470,24-35)]\n\t\tstore.setPartial(\n\t\t\tnew Range(36441, 1, 36469, 56),\n\t\t\t[createTokens('[(36442,25-35),(36442,36-50),(36443,30-39),(36443,42-46),(36443,47-53),(36443,54-58),(36443,63-73),(36443,74-84),(36443,87-91),(36443,92-98),(36443,101-105),(36443,106-112),(36443,113-119),(36444,28-37),(36444,38-42),(36444,47-57),(36444,58-75),(36444,80-95),(36444,96-105),(36445,35-53),(36445,54-62),(36448,24-29),(36448,33-46),(36448,47-54),(36450,25-35),(36450,36-50),(36451,28-33),(36451,36-49),(36451,50-57),(36452,35-53),(36452,54-62),(36454,33-38),(36454,41-54),(36454,55-60),(36455,35-53),(36455,54-62),(36457,33-44),(36457,45-49),(36457,50-56),(36457,62-83),(36457,84-88),(36458,35-53),(36458,54-62),(36460,33-37),(36460,38-42),(36460,47-57),(36460,58-67),(36461,35-53),(36461,54-62),(36463,34-38),(36463,39-45),(36463,46-51),(36463,54-63),(36463,64-71),(36463,76-80),(36463,81-87),(36463,88-92),(36463,97-107),(36463,108-119),(36464,35-53),(36464,54-62),(36466,33-71),(36466,72-76),(36467,35-53),(36467,54-62),(36469,24-29),(36469,33-46),(36469,47-54),(36470,24-35)]')]\n\t\t);\n\n\t\tconst lineTokens = store.addSparseTokens(36451, new LineTokens(new Uint32Array([60, 1]), `                        if (flags & ModifierFlags.Ambient) {`, codec));\n\t\tassert.strictEqual(lineTokens.getCount(), 7);\n\t});\n\n\n\ttest('issue #95949: Identifiers are colored in bold when targetting keywords', () => {\n\n\t\tfunction createTMMetadata(foreground: number, fontStyle: number, languageId: number): number {\n\t\t\treturn (\n\t\t\t\t(languageId << MetadataConsts.LANGUAGEID_OFFSET)\n\t\t\t\t| (fontStyle << MetadataConsts.FONT_STYLE_OFFSET)\n\t\t\t\t| (foreground << MetadataConsts.FOREGROUND_OFFSET)\n\t\t\t) >>> 0;\n\t\t}\n\n\t\tfunction toArr(lineTokens: LineTokens): number[] {\n\t\t\tconst r: number[] = [];\n\t\t\tfor (let i = 0; i < lineTokens.getCount(); i++) {\n\t\t\t\tr.push(lineTokens.getEndOffset(i));\n\t\t\t\tr.push(lineTokens.getMetadata(i));\n\t\t\t}\n\t\t\treturn r;\n\t\t}\n\n\t\tconst codec = new LanguageIdCodec();\n\t\tconst store = new SparseTokensStore(codec);\n\n\t\tstore.set([\n\t\t\tSparseMultilineTokens.create(1, new Uint32Array([\n\t\t\t\t0, 6, 11, (1 << MetadataConsts.FOREGROUND_OFFSET) | MetadataConsts.SEMANTIC_USE_FOREGROUND,\n\t\t\t]))\n\t\t], true);\n\n\t\tconst lineTokens = store.addSparseTokens(1, new LineTokens(new Uint32Array([\n\t\t\t5, createTMMetadata(5, FontStyle.Bold, 53),\n\t\t\t14, createTMMetadata(1, FontStyle.None, 53),\n\t\t\t17, createTMMetadata(6, FontStyle.None, 53),\n\t\t\t18, createTMMetadata(1, FontStyle.None, 53),\n\t\t]), `const hello = 123;`, codec));\n\n\t\tconst actual = toArr(lineTokens);\n\t\tassert.deepStrictEqual(actual, [\n\t\t\t5, createTMMetadata(5, FontStyle.Bold, 53),\n\t\t\t6, createTMMetadata(1, FontStyle.None, 53),\n\t\t\t11, createTMMetadata(1, FontStyle.None, 53),\n\t\t\t14, createTMMetadata(1, FontStyle.None, 53),\n\t\t\t17, createTMMetadata(6, FontStyle.None, 53),\n\t\t\t18, createTMMetadata(1, FontStyle.None, 53)\n\t\t]);\n\t});\n\n\n\ttest('BUG: setPartial with startLineNumber > 1 and token removal creates invalid state', () => {\n\t\t/**\n\t\t * The bug is the same regardless of the starting line number.\n\t\t * If a piece starts at line 5 and all tokens are removed via setPartial:\n\t\t * - startLineNumber stays at 5\n\t\t * - endLineNumber becomes 5 + (-1) = 4\n\t\t */\n\t\tconst codec = new LanguageIdCodec();\n\t\tconst store = new SparseTokensStore(codec);\n\n\t\t// Set initial tokens on line 5\n\t\tstore.set([\n\t\t\tSparseMultilineTokens.create(5, new Uint32Array([\n\t\t\t\t0, 5, 10, 1,  // line 5, chars 5-10\n\t\t\t]))\n\t\t], false);\n\n\t\tassert.strictEqual(store.isEmpty(), false);\n\n\t\t// Remove all tokens via setPartial\n\t\tstore.setPartial(new Range(5, 1, 5, 20), []);\n\n\t\t// BUG: During processing, pieces can have invalid line numbers\n\t\t// The store should remove empty pieces and remain valid\n\t\tassert.strictEqual(store.isEmpty(), true,\n\t\t\t'Store should be empty after setPartial removes all tokens');\n\t});\n\n\ttest('BUG: setPartial with split that creates empty first piece with invalid line numbers', () => {\n\t\tconst codec = new LanguageIdCodec();\n\t\tconst store = new SparseTokensStore(codec);\n\n\t\t// Set initial tokens - token is on line 11\n\t\tstore.set([\n\t\t\tSparseMultilineTokens.create(1, new Uint32Array([\n\t\t\t\t10, 5, 10, 1,  // line 11 (deltaLine=10 from startLineNumber=1), chars 5-10\n\t\t\t]))\n\t\t], false);\n\n\t\t// setPartial with a range [1,1 -> 5,1] that will cause a split where the first piece is empty\n\t\tstore.setPartial(new Range(1, 1, 5, 1), []);\n\n\t\tassert.strictEqual(store.isEmpty(), false, 'Store should still have the token on line 11');\n\n\t\t// The token at line 11 should be retrievable after the split\n\t\tconst lineTokens = store.addSparseTokens(11, new LineTokens(new Uint32Array([22, 1]), `    test line text    `, codec));\n\t\tassert.strictEqual(lineTokens.getCount(), 3, 'Should have 3 tokens: base token start + semantic token from line 11 + base token end');\n\t\tassert.strictEqual(lineTokens.getStartOffset(1), 5, 'Semantic token should start at offset 5');\n\t\tassert.strictEqual(lineTokens.getEndOffset(1), 10, 'Semantic token should end at offset 10');\n\t});\n\n\ttest('piece with startLineNumber 0 and endLineNumber -1 after encompassing deletion', () => {\n\t\tconst codec = new LanguageIdCodec();\n\t\tconst store = new SparseTokensStore(codec);\n\n\t\t// Set initial tokens on lines 5-10\n\t\tconst piece = SparseMultilineTokens.create(5, new Uint32Array([\n\t\t\t0, 0, 5, 1,  // line 5, chars 0-5\n\t\t\t5, 0, 5, 2,  // line 10, chars 0-5\n\t\t]));\n\n\t\tstore.set([piece], false);\n\n\t\t// Verify initial state\n\t\tassert.strictEqual(piece.startLineNumber, 5);\n\t\tassert.strictEqual(piece.endLineNumber, 10);\n\t\tassert.strictEqual(piece.isEmpty(), false);\n\n\t\t// Perform an edit that completely encompasses the token range\n\t\t// Delete from line 1 to line 20 (encompasses lines 5-10)\n\t\t// This triggers the case in _acceptDeleteRange where:\n\t\t// if (firstLineIndex < 0 && lastLineIndex >= tokenMaxDeltaLine + 1)\n\t\t// Which sets this._startLineNumber = 0 and calls this._tokens.clear()\n\t\tstore.acceptEdit(\n\t\t\t{ startLineNumber: 1, startColumn: 1, endLineNumber: 20, endColumn: 1 },\n\t\t\t0, // eolCount - no new lines inserted\n\t\t\t0, // firstLineLength\n\t\t\t0, // lastLineLength\n\t\t\t0  // firstCharCode\n\t\t);\n\n\t\t// After an encompassing deletion, the piece should be empty\n\t\tassert.strictEqual(piece.isEmpty(), true, 'Piece should be empty after encompassing deletion');\n\n\t\t// EXPECTED BEHAVIOR: The store should be empty (no pieces with invalid line numbers)\n\t\t// Currently fails because the piece remains with startLineNumber=0, endLineNumber=-1\n\t\tassert.strictEqual(store.isEmpty(), true, 'Store should be empty after all tokens are deleted by encompassing edit');\n\t});\n});\n\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport assert from 'assert';\nimport { DisposableStore } from '../../../../base/common/lifecycle.js';\nimport { ensureNoDisposablesAreLeakedInTestSuite } from '../../../../base/test/common/utils.js';\nimport { ISingleEditOperation } from '../../../common/core/editOperation.js';\nimport { Position } from '../../../common/core/position.js';\nimport { Range } from '../../../common/core/range.js';\nimport { ColorId, FontStyle, MetadataConsts, TokenMetadata } from '../../../common/encodedTokenAttributes.js';\nimport { ILanguageConfigurationService, LanguageConfigurationService } from '../../../common/languages/languageConfigurationRegistry.js';\nimport { TextModel } from '../../../common/model/textModel.js';\nimport { LanguageIdCodec } from '../../../common/services/languagesRegistry.js';\nimport { LineTokens } from '../../../common/tokens/lineTokens.js';\nimport { SparseMultilineTokens } from '../../../common/tokens/sparseMultilineTokens.js';\nimport { SparseTokensStore } from '../../../common/tokens/sparseTokensStore.js';\nimport { createModelServices, createTextModel, instantiateTextModel } from '../testTextModel.js';\n\nsuite('TokensStore', () => {\n\n\tensureNoDisposablesAreLeakedInTestSuite();\n\n\tconst SEMANTIC_COLOR = 5 as ColorId;\n\n\tfunction parseTokensState(state: string[]): { text: string; tokens: SparseMultilineTokens } {\n\t\tconst text: string[] = [];\n\t\tconst tokens: number[] = [];\n\t\tlet baseLine = 1;\n\t\tfor (let i = 0; i < state.length; i++) {\n\t\t\tconst line = state[i];\n\n\t\t\tlet startOffset = 0;\n\t\t\tlet lineText = '';\n\t\t\twhile (true) {\n\t\t\t\tconst firstPipeOffset = line.indexOf('|', startOffset);\n\t\t\t\tif (firstPipeOffset === -1) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tconst secondPipeOffset = line.indexOf('|', firstPipeOffset + 1);\n\t\t\t\tif (secondPipeOffset === -1) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tif (firstPipeOffset + 1 === secondPipeOffset) {\n\t\t\t\t\t// skip ||\n\t\t\t\t\tlineText += line.substring(startOffset, secondPipeOffset + 1);\n\t\t\t\t\tstartOffset = secondPipeOffset + 1;\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tlineText += line.substring(startOffset, firstPipeOffset);\n\t\t\t\tconst tokenStartCharacter = lineText.length;\n\t\t\t\tconst tokenLength = secondPipeOffset - firstPipeOffset - 1;\n\t\t\t\tconst metadata = (\n\t\t\t\t\tSEMANTIC_COLOR << MetadataConsts.FOREGROUND_OFFSET\n\t\t\t\t\t| MetadataConsts.SEMANTIC_USE_FOREGROUND\n\t\t\t\t);\n\n\t\t\t\tif (tokens.length === 0) {\n\t\t\t\t\tbaseLine = i + 1;\n\t\t\t\t}\n\t\t\t\ttokens.push(i + 1 - baseLine, tokenStartCharacter, tokenStartCharacter + tokenLength, metadata);\n\n\t\t\t\tlineText += line.substr(firstPipeOffset + 1, tokenLength);\n\t\t\t\tstartOffset = secondPipeOffset + 1;\n\t\t\t}\n\n\t\t\tlineText += line.substring(startOffset);\n\n\t\t\ttext.push(lineText);\n\t\t}\n\n\t\treturn {\n\t\t\ttext: text.join('\\n'),\n\t\t\ttokens: SparseMultilineTokens.create(baseLine, new Uint32Array(tokens))\n\t\t};\n\t}\n\n\tfunction extractState(model: TextModel): string[] {\n\t\tconst result: string[] = [];\n\t\tfor (let lineNumber = 1; lineNumber <= model.getLineCount(); lineNumber++) {\n\t\t\tconst lineTokens = model.tokenization.getLineTokens(lineNumber);\n\t\t\tconst lineContent = model.getLineContent(lineNumber);\n\n\t\t\tlet lineText = '';\n\t\t\tfor (let i = 0; i < lineTokens.getCount(); i++) {\n\t\t\t\tconst tokenStartCharacter = lineTokens.getStartOffset(i);\n\t\t\t\tconst tokenEndCharacter = lineTokens.getEndOffset(i);\n\t\t\t\tconst metadata = lineTokens.getMetadata(i);\n\t\t\t\tconst color = TokenMetadata.getForeground(metadata);\n\t\t\t\tconst tokenText = lineContent.substring(tokenStartCharacter, tokenEndCharacter);\n\t\t\t\tif (color === SEMANTIC_COLOR) {\n\t\t\t\t\tlineText += `|${tokenText}|`;\n\t\t\t\t} else {\n\t\t\t\t\tlineText += tokenText;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tresult.push(lineText);\n\t\t}\n\t\treturn result;\n\t}\n\n\tfunction testTokensAdjustment(rawInitialState: string[], edits: ISingleEditOperation[], rawFinalState: string[]) {\n\t\tconst initialState = parseTokensState(rawInitialState);\n\t\tconst model = createTextModel(initialState.text);\n\t\tmodel.tokenization.setSemanticTokens([initialState.tokens], true);\n\n\t\tmodel.applyEdits(edits);\n\n\t\tconst actualState = extractState(model);\n\t\tassert.deepStrictEqual(actualState, rawFinalState);\n\n\t\tmodel.dispose();\n\t}\n\n\ttest('issue #86303 - color shifting between different tokens', () => {\n\t\ttestTokensAdjustment(\n\t\t\t[\n\t\t\t\t`import { |URI| } from 'vs/base/common/uri';`,\n\t\t\t\t`const foo = |URI|.parse('hey');`\n\t\t\t],\n\t\t\t[\n\t\t\t\t{ range: new Range(2, 9, 2, 10), text: '' }\n\t\t\t],\n\t\t\t[\n\t\t\t\t`import { |URI| } from 'vs/base/common/uri';`,\n\t\t\t\t`const fo = |URI|.parse('hey');`\n\t\t\t]\n\t\t);\n\t});\n\n\ttest('deleting a newline', () => {\n\t\ttestTokensAdjustment(\n\t\t\t[\n\t\t\t\t`import { |URI| } from 'vs/base/common/uri';`,\n\t\t\t\t`const foo = |URI|.parse('hey');`\n\t\t\t],\n\t\t\t[\n\t\t\t\t{ range: new Range(1, 42, 2, 1), text: '' }\n\t\t\t],\n\t\t\t[\n\t\t\t\t`import { |URI| } from 'vs/base/common/uri';const foo = |URI|.parse('hey');`\n\t\t\t]\n\t\t);\n\t});\n\n\ttest('inserting a newline', () => {\n\t\ttestTokensAdjustment(\n\t\t\t[\n\t\t\t\t`import { |URI| } from 'vs/base/common/uri';const foo = |URI|.parse('hey');`\n\t\t\t],\n\t\t\t[\n\t\t\t\t{ range: new Range(1, 42, 1, 42), text: '\\n' }\n\t\t\t],\n\t\t\t[\n\t\t\t\t`import { |URI| } from 'vs/base/common/uri';`,\n\t\t\t\t`const foo = |URI|.parse('hey');`\n\t\t\t]\n\t\t);\n\t});\n\n\ttest('deleting a newline 2', () => {\n\t\ttestTokensAdjustment(\n\t\t\t[\n\t\t\t\t`import { `,\n\t\t\t\t`    |URI| } from 'vs/base/common/uri';const foo = |URI|.parse('hey');`\n\t\t\t],\n\t\t\t[\n\t\t\t\t{ range: new Range(1, 10, 2, 5), text: '' }\n\t\t\t],\n\t\t\t[\n\t\t\t\t`import { |URI| } from 'vs/base/common/uri';const foo = |URI|.parse('hey');`\n\t\t\t]\n\t\t);\n\t});\n\n\ttest('issue #179268: a complex edit', () => {\n\t\ttestTokensAdjustment(\n\t\t\t[\n\t\t\t\t`|export| |'interior_material_selector.dart'|;`,\n\t\t\t\t`|export| |'mileage_selector.dart'|;`,\n\t\t\t\t`|export| |'owners_selector.dart'|;`,\n\t\t\t\t`|export| |'price_selector.dart'|;`,\n\t\t\t\t`|export| |'seat_count_selector.dart'|;`,\n\t\t\t\t`|export| |'year_selector.dart'|;`,\n\t\t\t\t`|export| |'winter_options_selector.dart'|;|export| |'camera_selector.dart'|;`\n\t\t\t],\n\t\t\t[\n\t\t\t\t{ range: new Range(1, 9, 1, 9), text: `camera_selector.dart';\\nexport '` },\n\t\t\t\t{ range: new Range(6, 9, 7, 9), text: `` },\n\t\t\t\t{ range: new Range(7, 39, 7, 39), text: `\\n` },\n\t\t\t\t{ range: new Range(7, 47, 7, 48), text: `ye` },\n\t\t\t\t{ range: new Range(7, 49, 7, 51), text: `` },\n\t\t\t\t{ range: new Range(7, 52, 7, 53), text: `` },\n\t\t\t],\n\t\t\t[\n\t\t\t\t`|export| |'|camera_selector.dart';`,\n\t\t\t\t`export 'interior_material_selector.dart';`,\n\t\t\t\t`|export| |'mileage_selector.dart'|;`,\n\t\t\t\t`|export| |'owners_selector.dart'|;`,\n\t\t\t\t`|export| |'price_selector.dart'|;`,\n\t\t\t\t`|export| |'seat_count_selector.dart'|;`,\n\t\t\t\t`|export| |'||winter_options_selector.dart'|;`,\n\t\t\t\t`|export| |'year_selector.dart'|;`\n\t\t\t]\n\t\t);\n\t});\n\n\ttest('issue #91936: Semantic token color highlighting fails on line with selected text', () => {\n\t\tconst model = createTextModel('                    else if ($s = 08) then \\'\\\\b\\'');\n\t\tmodel.tokenization.setSemanticTokens([\n\t\t\tSparseMultilineTokens.create(1, new Uint32Array([\n\t\t\t\t0, 20, 24, 0b01111000000000010000,\n\t\t\t\t0, 25, 27, 0b01111000000000010000,\n\t\t\t\t0, 28, 29, 0b00001000000000010000,\n\t\t\t\t0, 29, 31, 0b10000000000000010000,\n\t\t\t\t0, 32, 33, 0b00001000000000010000,\n\t\t\t\t0, 34, 36, 0b00110000000000010000,\n\t\t\t\t0, 36, 37, 0b00001000000000010000,\n\t\t\t\t0, 38, 42, 0b01111000000000010000,\n\t\t\t\t0, 43, 47, 0b01011000000000010000,\n\t\t\t]))\n\t\t], true);\n\t\tconst lineTokens = model.tokenization.getLineTokens(1);\n\t\tconst decodedTokens: number[] = [];\n\t\tfor (let i = 0, len = lineTokens.getCount(); i < len; i++) {\n\t\t\tdecodedTokens.push(lineTokens.getEndOffset(i), lineTokens.getMetadata(i));\n\t\t}\n\n\t\tassert.deepStrictEqual(decodedTokens, [\n\t\t\t20, 0b10000000001000010000000001,\n\t\t\t24, 0b10000001111000010000000001,\n\t\t\t25, 0b10000000001000010000000001,\n\t\t\t27, 0b10000001111000010000000001,\n\t\t\t28, 0b10000000001000010000000001,\n\t\t\t29, 0b10000000001000010000000001,\n\t\t\t31, 0b10000010000000010000000001,\n\t\t\t32, 0b10000000001000010000000001,\n\t\t\t33, 0b10000000001000010000000001,\n\t\t\t34, 0b10000000001000010000000001,\n\t\t\t36, 0b10000000110000010000000001,\n\t\t\t37, 0b10000000001000010000000001,\n\t\t\t38, 0b10000000001000010000000001,\n\t\t\t42, 0b10000001111000010000000001,\n\t\t\t43, 0b10000000001000010000000001,\n\t\t\t47, 0b10000001011000010000000001\n\t\t]);\n\n\t\tmodel.dispose();\n\t});\n\n\ttest('issue #147944: Language id \"vs.editor.nullLanguage\" is not configured nor known', () => {\n\t\tconst disposables = new DisposableStore();\n\t\tconst instantiationService = createModelServices(disposables, [\n\t\t\t[ILanguageConfigurationService, LanguageConfigurationService]\n\t\t]);\n\t\tconst model = disposables.add(instantiateTextModel(instantiationService, '--[[\\n\\n]]'));\n\t\tmodel.tokenization.setSemanticTokens([\n\t\t\tSparseMultilineTokens.create(1, new Uint32Array([\n\t\t\t\t0, 2, 4, 0b100000000000010000,\n\t\t\t\t1, 0, 0, 0b100000000000010000,\n\t\t\t\t2, 0, 2, 0b100000000000010000,\n\t\t\t]))\n\t\t], true);\n\t\tassert.strictEqual(model.getWordAtPosition(new Position(2, 1)), null);\n\t\tdisposables.dispose();\n\t});\n\n\ttest('partial tokens 1', () => {\n\t\tconst codec = new LanguageIdCodec();\n\t\tconst store = new SparseTokensStore(codec);\n\n\t\t// setPartial: [1,1 -> 31,2], [(5,5-10),(10,5-10),(15,5-10),(20,5-10),(25,5-10),(30,5-10)]\n\t\tstore.setPartial(new Range(1, 1, 31, 2), [\n\t\t\tSparseMultilineTokens.create(5, new Uint32Array([\n\t\t\t\t0, 5, 10, 1,\n\t\t\t\t5, 5, 10, 2,\n\t\t\t\t10, 5, 10, 3,\n\t\t\t\t15, 5, 10, 4,\n\t\t\t\t20, 5, 10, 5,\n\t\t\t\t25, 5, 10, 6,\n\t\t\t]))\n\t\t]);\n\n\t\t// setPartial: [18,1 -> 42,1], [(20,5-10),(25,5-10),(30,5-10),(35,5-10),(40,5-10)]\n\t\tstore.setPartial(new Range(18, 1, 42, 1), [\n\t\t\tSparseMultilineTokens.create(20, new Uint32Array([\n\t\t\t\t0, 5, 10, 4,\n\t\t\t\t5, 5, 10, 5,\n\t\t\t\t10, 5, 10, 6,\n\t\t\t\t15, 5, 10, 7,\n\t\t\t\t20, 5, 10, 8,\n\t\t\t]))\n\t\t]);\n\n\t\t// setPartial: [1,1 -> 31,2], [(5,5-10),(10,5-10),(15,5-10),(20,5-10),(25,5-10),(30,5-10)]\n\t\tstore.setPartial(new Range(1, 1, 31, 2), [\n\t\t\tSparseMultilineTokens.create(5, new Uint32Array([\n\t\t\t\t0, 5, 10, 1,\n\t\t\t\t5, 5, 10, 2,\n\t\t\t\t10, 5, 10, 3,\n\t\t\t\t15, 5, 10, 4,\n\t\t\t\t20, 5, 10, 5,\n\t\t\t\t25, 5, 10, 6,\n\t\t\t]))\n\t\t]);\n\n\t\tconst lineTokens = store.addSparseTokens(10, new LineTokens(new Uint32Array([12, 1]), `enum Enum1 {`, codec));\n\t\tassert.strictEqual(lineTokens.getCount(), 3);\n\t});\n\n\ttest('partial tokens 2', () => {\n\t\tconst codec = new LanguageIdCodec();\n\t\tconst store = new SparseTokensStore(codec);\n\n\t\t// setPartial: [1,1 -> 31,2], [(5,5-10),(10,5-10),(15,5-10),(20,5-10),(25,5-10),(30,5-10)]\n\t\tstore.setPartial(new Range(1, 1, 31, 2), [\n\t\t\tSparseMultilineTokens.create(5, new Uint32Array([\n\t\t\t\t0, 5, 10, 1,\n\t\t\t\t5, 5, 10, 2,\n\t\t\t\t10, 5, 10, 3,\n\t\t\t\t15, 5, 10, 4,\n\t\t\t\t20, 5, 10, 5,\n\t\t\t\t25, 5, 10, 6,\n\t\t\t]))\n\t\t]);\n\n\t\t// setPartial: [6,1 -> 36,2], [(10,5-10),(15,5-10),(20,5-10),(25,5-10),(30,5-10),(35,5-10)]\n\t\tstore.setPartial(new Range(6, 1, 36, 2), [\n\t\t\tSparseMultilineTokens.create(10, new Uint32Array([\n\t\t\t\t0, 5, 10, 2,\n\t\t\t\t5, 5, 10, 3,\n\t\t\t\t10, 5, 10, 4,\n\t\t\t\t15, 5, 10, 5,\n\t\t\t\t20, 5, 10, 6,\n\t\t\t]))\n\t\t]);\n\n\t\t// setPartial: [17,1 -> 42,1], [(20,5-10),(25,5-10),(30,5-10),(35,5-10),(40,5-10)]\n\t\tstore.setPartial(new Range(17, 1, 42, 1), [\n\t\t\tSparseMultilineTokens.create(20, new Uint32Array([\n\t\t\t\t0, 5, 10, 4,\n\t\t\t\t5, 5, 10, 5,\n\t\t\t\t10, 5, 10, 6,\n\t\t\t\t15, 5, 10, 7,\n\t\t\t\t20, 5, 10, 8,\n\t\t\t]))\n\t\t]);\n\n\t\tconst lineTokens = store.addSparseTokens(20, new LineTokens(new Uint32Array([12, 1]), `enum Enum1 {`, codec));\n\t\tassert.strictEqual(lineTokens.getCount(), 3);\n\t});\n\n\ttest('partial tokens 3', () => {\n\t\tconst codec = new LanguageIdCodec();\n\t\tconst store = new SparseTokensStore(codec);\n\n\t\t// setPartial: [1,1 -> 31,2], [(5,5-10),(10,5-10),(15,5-10),(20,5-10),(25,5-10),(30,5-10)]\n\t\tstore.setPartial(new Range(1, 1, 31, 2), [\n\t\t\tSparseMultilineTokens.create(5, new Uint32Array([\n\t\t\t\t0, 5, 10, 1,\n\t\t\t\t5, 5, 10, 2,\n\t\t\t\t10, 5, 10, 3,\n\t\t\t\t15, 5, 10, 4,\n\t\t\t\t20, 5, 10, 5,\n\t\t\t\t25, 5, 10, 6,\n\t\t\t]))\n\t\t]);\n\n\t\t// setPartial: [11,1 -> 16,2], [(15,5-10),(20,5-10)]\n\t\tstore.setPartial(new Range(11, 1, 16, 2), [\n\t\t\tSparseMultilineTokens.create(10, new Uint32Array([\n\t\t\t\t0, 5, 10, 3,\n\t\t\t\t5, 5, 10, 4,\n\t\t\t]))\n\t\t]);\n\n\t\tconst lineTokens = store.addSparseTokens(5, new LineTokens(new Uint32Array([12, 1]), `enum Enum1 {`, codec));\n\t\tassert.strictEqual(lineTokens.getCount(), 3);\n\t});\n\n\ttest('issue #94133: Semantic colors stick around when using (only) range provider', () => {\n\t\tconst codec = new LanguageIdCodec();\n\t\tconst store = new SparseTokensStore(codec);\n\n\t\t// setPartial: [1,1 -> 1,20] [(1,9-11)]\n\t\tstore.setPartial(new Range(1, 1, 1, 20), [\n\t\t\tSparseMultilineTokens.create(1, new Uint32Array([\n\t\t\t\t0, 9, 11, 1,\n\t\t\t]))\n\t\t]);\n\n\t\t// setPartial: [1,1 -> 1,20], []\n\t\tstore.setPartial(new Range(1, 1, 1, 20), []);\n\n\t\tconst lineTokens = store.addSparseTokens(1, new LineTokens(new Uint32Array([12, 1]), `enum Enum1 {`, codec));\n\t\tassert.strictEqual(lineTokens.getCount(), 1);\n\t});\n\n\ttest('bug', () => {\n\t\tfunction createTokens(str: string): SparseMultilineTokens {\n\t\t\tstr = str.replace(/^\\[\\(/, '');\n\t\t\tstr = str.replace(/\\)\\]$/, '');\n\t\t\tconst strTokens = str.split('),(');\n\t\t\tconst result: number[] = [];\n\t\t\tlet firstLineNumber = 0;\n\t\t\tfor (const strToken of strTokens) {\n\t\t\t\tconst pieces = strToken.split(',');\n\t\t\t\tconst chars = pieces[1].split('-');\n\t\t\t\tconst lineNumber = parseInt(pieces[0], 10);\n\t\t\t\tconst startChar = parseInt(chars[0], 10);\n\t\t\t\tconst endChar = parseInt(chars[1], 10);\n\t\t\t\tif (firstLineNumber === 0) {\n\t\t\t\t\t// this is the first line\n\t\t\t\t\tfirstLineNumber = lineNumber;\n\t\t\t\t}\n\t\t\t\tresult.push(lineNumber - firstLineNumber, startChar, endChar, (lineNumber + startChar) % 13);\n\t\t\t}\n\t\t\treturn SparseMultilineTokens.create(firstLineNumber, new Uint32Array(result));\n\t\t}\n\n\t\tconst codec = new LanguageIdCodec();\n\t\tconst store = new SparseTokensStore(codec);\n\t\t// setPartial [36446,1 -> 36475,115] [(36448,24-29),(36448,33-46),(36448,47-54),(36450,25-35),(36450,36-50),(36451,28-33),(36451,36-49),(36451,50-57),(36452,35-53),(36452,54-62),(36454,33-38),(36454,41-54),(36454,55-60),(36455,35-53),(36455,54-62),(36457,33-44),(36457,45-49),(36457,50-56),(36457,62-83),(36457,84-88),(36458,35-53),(36458,54-62),(36460,33-37),(36460,38-42),(36460,47-57),(36460,58-67),(36461,35-53),(36461,54-62),(36463,34-38),(36463,39-45),(36463,46-51),(36463,54-63),(36463,64-71),(36463,76-80),(36463,81-87),(36463,88-92),(36463,97-107),(36463,108-119),(36464,35-53),(36464,54-62),(36466,33-71),(36466,72-76),(36467,35-53),(36467,54-62),(36469,24-29),(36469,33-46),(36469,47-54),(36470,24-35),(36470,38-46),(36473,25-35),(36473,36-51),(36474,28-33),(36474,36-49),(36474,50-58),(36475,35-53),(36475,54-62)]\n\t\tstore.setPartial(\n\t\t\tnew Range(36446, 1, 36475, 115),\n\t\t\t[createTokens('[(36448,24-29),(36448,33-46),(36448,47-54),(36450,25-35),(36450,36-50),(36451,28-33),(36451,36-49),(36451,50-57),(36452,35-53),(36452,54-62),(36454,33-38),(36454,41-54),(36454,55-60),(36455,35-53),(36455,54-62),(36457,33-44),(36457,45-49),(36457,50-56),(36457,62-83),(36457,84-88),(36458,35-53),(36458,54-62),(36460,33-37),(36460,38-42),(36460,47-57),(36460,58-67),(36461,35-53),(36461,54-62),(36463,34-38),(36463,39-45),(36463,46-51),(36463,54-63),(36463,64-71),(36463,76-80),(36463,81-87),(36463,88-92),(36463,97-107),(36463,108-119),(36464,35-53),(36464,54-62),(36466,33-71),(36466,72-76),(36467,35-53),(36467,54-62),(36469,24-29),(36469,33-46),(36469,47-54),(36470,24-35),(36470,38-46),(36473,25-35),(36473,36-51),(36474,28-33),(36474,36-49),(36474,50-58),(36475,35-53),(36475,54-62)]')]\n\t\t);\n\t\t// setPartial [36436,1 -> 36464,142] [(36437,33-37),(36437,38-42),(36437,47-57),(36437,58-67),(36438,35-53),(36438,54-62),(36440,24-29),(36440,33-46),(36440,47-53),(36442,25-35),(36442,36-50),(36443,30-39),(36443,42-46),(36443,47-53),(36443,54-58),(36443,63-73),(36443,74-84),(36443,87-91),(36443,92-98),(36443,101-105),(36443,106-112),(36443,113-119),(36444,28-37),(36444,38-42),(36444,47-57),(36444,58-75),(36444,80-95),(36444,96-105),(36445,35-53),(36445,54-62),(36448,24-29),(36448,33-46),(36448,47-54),(36450,25-35),(36450,36-50),(36451,28-33),(36451,36-49),(36451,50-57),(36452,35-53),(36452,54-62),(36454,33-38),(36454,41-54),(36454,55-60),(36455,35-53),(36455,54-62),(36457,33-44),(36457,45-49),(36457,50-56),(36457,62-83),(36457,84-88),(36458,35-53),(36458,54-62),(36460,33-37),(36460,38-42),(36460,47-57),(36460,58-67),(36461,35-53),(36461,54-62),(36463,34-38),(36463,39-45),(36463,46-51),(36463,54-63),(36463,64-71),(36463,76-80),(36463,81-87),(36463,88-92),(36463,97-107),(36463,108-119),(36464,35-53),(36464,54-62)]\n\t\tstore.setPartial(\n\t\t\tnew Range(36436, 1, 36464, 142),\n\t\t\t[createTokens('[(36437,33-37),(36437,38-42),(36437,47-57),(36437,58-67),(36438,35-53),(36438,54-62),(36440,24-29),(36440,33-46),(36440,47-53),(36442,25-35),(36442,36-50),(36443,30-39),(36443,42-46),(36443,47-53),(36443,54-58),(36443,63-73),(36443,74-84),(36443,87-91),(36443,92-98),(36443,101-105),(36443,106-112),(36443,113-119),(36444,28-37),(36444,38-42),(36444,47-57),(36444,58-75),(36444,80-95),(36444,96-105),(36445,35-53),(36445,54-62),(36448,24-29),(36448,33-46),(36448,47-54),(36450,25-35),(36450,36-50),(36451,28-33),(36451,36-49),(36451,50-57),(36452,35-53),(36452,54-62),(36454,33-38),(36454,41-54),(36454,55-60),(36455,35-53),(36455,54-62),(36457,33-44),(36457,45-49),(36457,50-56),(36457,62-83),(36457,84-88),(36458,35-53),(36458,54-62),(36460,33-37),(36460,38-42),(36460,47-57),(36460,58-67),(36461,35-53),(36461,54-62),(36463,34-38),(36463,39-45),(36463,46-51),(36463,54-63),(36463,64-71),(36463,76-80),(36463,81-87),(36463,88-92),(36463,97-107),(36463,108-119),(36464,35-53),(36464,54-62)]')]\n\t\t);\n\t\t// setPartial [36457,1 -> 36485,140] [(36457,33-44),(36457,45-49),(36457,50-56),(36457,62-83),(36457,84-88),(36458,35-53),(36458,54-62),(36460,33-37),(36460,38-42),(36460,47-57),(36460,58-67),(36461,35-53),(36461,54-62),(36463,34-38),(36463,39-45),(36463,46-51),(36463,54-63),(36463,64-71),(36463,76-80),(36463,81-87),(36463,88-92),(36463,97-107),(36463,108-119),(36464,35-53),(36464,54-62),(36466,33-71),(36466,72-76),(36467,35-53),(36467,54-62),(36469,24-29),(36469,33-46),(36469,47-54),(36470,24-35),(36470,38-46),(36473,25-35),(36473,36-51),(36474,28-33),(36474,36-49),(36474,50-58),(36475,35-53),(36475,54-62),(36477,28-32),(36477,33-37),(36477,42-52),(36477,53-69),(36478,32-36),(36478,37-41),(36478,46-56),(36478,57-74),(36479,32-36),(36479,37-41),(36479,46-56),(36479,57-76),(36480,32-36),(36480,37-41),(36480,46-56),(36480,57-68),(36481,32-36),(36481,37-41),(36481,46-56),(36481,57-68),(36482,39-57),(36482,58-66),(36484,34-38),(36484,39-45),(36484,46-50),(36484,55-65),(36484,66-82),(36484,86-97),(36484,98-102),(36484,103-109),(36484,111-124),(36484,125-133),(36485,39-57),(36485,58-66)]\n\t\tstore.setPartial(\n\t\t\tnew Range(36457, 1, 36485, 140),\n\t\t\t[createTokens('[(36457,33-44),(36457,45-49),(36457,50-56),(36457,62-83),(36457,84-88),(36458,35-53),(36458,54-62),(36460,33-37),(36460,38-42),(36460,47-57),(36460,58-67),(36461,35-53),(36461,54-62),(36463,34-38),(36463,39-45),(36463,46-51),(36463,54-63),(36463,64-71),(36463,76-80),(36463,81-87),(36463,88-92),(36463,97-107),(36463,108-119),(36464,35-53),(36464,54-62),(36466,33-71),(36466,72-76),(36467,35-53),(36467,54-62),(36469,24-29),(36469,33-46),(36469,47-54),(36470,24-35),(36470,38-46),(36473,25-35),(36473,36-51),(36474,28-33),(36474,36-49),(36474,50-58),(36475,35-53),(36475,54-62),(36477,28-32),(36477,33-37),(36477,42-52),(36477,53-69),(36478,32-36),(36478,37-41),(36478,46-56),(36478,57-74),(36479,32-36),(36479,37-41),(36479,46-56),(36479,57-76),(36480,32-36),(36480,37-41),(36480,46-56),(36480,57-68),(36481,32-36),(36481,37-41),(36481,46-56),(36481,57-68),(36482,39-57),(36482,58-66),(36484,34-38),(36484,39-45),(36484,46-50),(36484,55-65),(36484,66-82),(36484,86-97),(36484,98-102),(36484,103-109),(36484,111-124),(36484,125-133),(36485,39-57),(36485,58-66)]')]\n\t\t);\n\t\t// setPartial [36441,1 -> 36469,56] [(36442,25-35),(36442,36-50),(36443,30-39),(36443,42-46),(36443,47-53),(36443,54-58),(36443,63-73),(36443,74-84),(36443,87-91),(36443,92-98),(36443,101-105),(36443,106-112),(36443,113-119),(36444,28-37),(36444,38-42),(36444,47-57),(36444,58-75),(36444,80-95),(36444,96-105),(36445,35-53),(36445,54-62),(36448,24-29),(36448,33-46),(36448,47-54),(36450,25-35),(36450,36-50),(36451,28-33),(36451,36-49),(36451,50-57),(36452,35-53),(36452,54-62),(36454,33-38),(36454,41-54),(36454,55-60),(36455,35-53),(36455,54-62),(36457,33-44),(36457,45-49),(36457,50-56),(36457,62-83),(36457,84-88),(36458,35-53),(36458,54-62),(36460,33-37),(36460,38-42),(36460,47-57),(36460,58-67),(36461,35-53),(36461,54-62),(36463,34-38),(36463,39-45),(36463,46-51),(36463,54-63),(36463,64-71),(36463,76-80),(36463,81-87),(36463,88-92),(36463,97-107),(36463,108-119),(36464,35-53),(36464,54-62),(36466,33-71),(36466,72-76),(36467,35-53),(36467,54-62),(36469,24-29),(36469,33-46),(36469,47-54),(36470,24-35)]\n\t\tstore.setPartial(\n\t\t\tnew Range(36441, 1, 36469, 56),\n\t\t\t[createTokens('[(36442,25-35),(36442,36-50),(36443,30-39),(36443,42-46),(36443,47-53),(36443,54-58),(36443,63-73),(36443,74-84),(36443,87-91),(36443,92-98),(36443,101-105),(36443,106-112),(36443,113-119),(36444,28-37),(36444,38-42),(36444,47-57),(36444,58-75),(36444,80-95),(36444,96-105),(36445,35-53),(36445,54-62),(36448,24-29),(36448,33-46),(36448,47-54),(36450,25-35),(36450,36-50),(36451,28-33),(36451,36-49),(36451,50-57),(36452,35-53),(36452,54-62),(36454,33-38),(36454,41-54),(36454,55-60),(36455,35-53),(36455,54-62),(36457,33-44),(36457,45-49),(36457,50-56),(36457,62-83),(36457,84-88),(36458,35-53),(36458,54-62),(36460,33-37),(36460,38-42),(36460,47-57),(36460,58-67),(36461,35-53),(36461,54-62),(36463,34-38),(36463,39-45),(36463,46-51),(36463,54-63),(36463,64-71),(36463,76-80),(36463,81-87),(36463,88-92),(36463,97-107),(36463,108-119),(36464,35-53),(36464,54-62),(36466,33-71),(36466,72-76),(36467,35-53),(36467,54-62),(36469,24-29),(36469,33-46),(36469,47-54),(36470,24-35)]')]\n\t\t);\n\n\t\tconst lineTokens = store.addSparseTokens(36451, new LineTokens(new Uint32Array([60, 1]), `                        if (flags & ModifierFlags.Ambient) {`, codec));\n\t\tassert.strictEqual(lineTokens.getCount(), 7);\n\t});\n\n\n\ttest('issue #95949: Identifiers are colored in bold when targetting keywords', () => {\n\n\t\tfunction createTMMetadata(foreground: number, fontStyle: number, languageId: number): number {\n\t\t\treturn (\n\t\t\t\t(languageId << MetadataConsts.LANGUAGEID_OFFSET)\n\t\t\t\t| (fontStyle << MetadataConsts.FONT_STYLE_OFFSET)\n\t\t\t\t| (foreground << MetadataConsts.FOREGROUND_OFFSET)\n\t\t\t) >>> 0;\n\t\t}\n\n\t\tfunction toArr(lineTokens: LineTokens): number[] {\n\t\t\tconst r: number[] = [];\n\t\t\tfor (let i = 0; i < lineTokens.getCount(); i++) {\n\t\t\t\tr.push(lineTokens.getEndOffset(i));\n\t\t\t\tr.push(lineTokens.getMetadata(i));\n\t\t\t}\n\t\t\treturn r;\n\t\t}\n\n\t\tconst codec = new LanguageIdCodec();\n\t\tconst store = new SparseTokensStore(codec);\n\n\t\tstore.set([\n\t\t\tSparseMultilineTokens.create(1, new Uint32Array([\n\t\t\t\t0, 6, 11, (1 << MetadataConsts.FOREGROUND_OFFSET) | MetadataConsts.SEMANTIC_USE_FOREGROUND,\n\t\t\t]))\n\t\t], true);\n\n\t\tconst lineTokens = store.addSparseTokens(1, new LineTokens(new Uint32Array([\n\t\t\t5, createTMMetadata(5, FontStyle.Bold, 53),\n\t\t\t14, createTMMetadata(1, FontStyle.None, 53),\n\t\t\t17, createTMMetadata(6, FontStyle.None, 53),\n\t\t\t18, createTMMetadata(1, FontStyle.None, 53),\n\t\t]), `const hello = 123;`, codec));\n\n\t\tconst actual = toArr(lineTokens);\n\t\tassert.deepStrictEqual(actual, [\n\t\t\t5, createTMMetadata(5, FontStyle.Bold, 53),\n\t\t\t6, createTMMetadata(1, FontStyle.None, 53),\n\t\t\t11, createTMMetadata(1, FontStyle.None, 53),\n\t\t\t14, createTMMetadata(1, FontStyle.None, 53),\n\t\t\t17, createTMMetadata(6, FontStyle.None, 53),\n\t\t\t18, createTMMetadata(1, FontStyle.None, 53)\n\t\t]);\n\t});\n\n\n\ttest('BUG: setPartial with startLineNumber > 1 and token removal creates invalid state', () => {\n\t\t/**\n\t\t * The bug is the same regardless of the starting line number.\n\t\t * If a piece starts at line 5 and all tokens are removed via setPartial:\n\t\t * - startLineNumber stays at 5\n\t\t * - endLineNumber becomes 5 + (-1) = 4\n\t\t */\n\t\tconst codec = new LanguageIdCodec();\n\t\tconst store = new SparseTokensStore(codec);\n\n\t\t// Set initial tokens on line 5\n\t\tstore.set([\n\t\t\tSparseMultilineTokens.create(5, new Uint32Array([\n\t\t\t\t0, 5, 10, 1,  // line 5, chars 5-10\n\t\t\t]))\n\t\t], false);\n\n\t\tassert.strictEqual(store.isEmpty(), false);\n\n\t\t// Remove all tokens via setPartial\n\t\tstore.setPartial(new Range(5, 1, 5, 20), []);\n\n\t\t// BUG: During processing, pieces can have invalid line numbers\n\t\t// The store should remove empty pieces and remain valid\n\t\tassert.strictEqual(store.isEmpty(), true,\n\t\t\t'Store should be empty after setPartial removes all tokens');\n\t});\n\n\ttest('BUG: setPartial with split that creates empty first piece with invalid line numbers', () => {\n\t\tconst codec = new LanguageIdCodec();\n\t\tconst store = new SparseTokensStore(codec);\n\n\t\t// Set initial tokens - token is on line 11\n\t\tstore.set([\n\t\t\tSparseMultilineTokens.create(1, new Uint32Array([\n\t\t\t\t10, 5, 10, 1,  // line 11 (deltaLine=10 from startLineNumber=1), chars 5-10\n\t\t\t]))\n\t\t], false);\n\n\t\t// setPartial with a range [1,1 -> 5,1] that will cause a split where the first piece is empty\n\t\tstore.setPartial(new Range(1, 1, 5, 1), []);\n\n\t\tassert.strictEqual(store.isEmpty(), false, 'Store should still have the token on line 11');\n\n\t\t// The token at line 11 should be retrievable after the split\n\t\tconst lineTokens = store.addSparseTokens(11, new LineTokens(new Uint32Array([22, 1]), `    test line text    `, codec));\n\t\tassert.strictEqual(lineTokens.getCount(), 3, 'Should have 3 tokens: base token start + semantic token from line 11 + base token end');\n\t\tassert.strictEqual(lineTokens.getStartOffset(1), 5, 'Semantic token should start at offset 5');\n\t\tassert.strictEqual(lineTokens.getEndOffset(1), 10, 'Semantic token should end at offset 10');\n\t});\n\n\ttest('piece with startLineNumber 0 and endLineNumber -1 after encompassing deletion', () => {\n\t\tconst codec = new LanguageIdCodec();\n\t\tconst store = new SparseTokensStore(codec);\n\n\t\t// Set initial tokens on lines 5-10\n\t\tconst piece = SparseMultilineTokens.create(5, new Uint32Array([\n\t\t\t0, 0, 5, 1,  // line 5, chars 0-5\n\t\t\t5, 0, 5, 2,  // line 10, chars 0-5\n\t\t]));\n\n\t\tstore.set([piece], false);\n\n\t\t// Verify initial state\n\t\tassert.strictEqual(piece.startLineNumber, 5);\n\t\tassert.strictEqual(piece.endLineNumber, 10);\n\t\tassert.strictEqual(piece.isEmpty(), false);\n\n\t\t// Perform an edit that completely encompasses the token range\n\t\t// Delete from line 1 to line 20 (encompasses lines 5-10)\n\t\t// This triggers the case in _acceptDeleteRange where:\n\t\t// if (firstLineIndex < 0 && lastLineIndex >= tokenMaxDeltaLine + 1)\n\t\t// Which sets this._startLineNumber = 0 and calls this._tokens.clear()\n\t\tstore.acceptEdit(\n\t\t\t{ startLineNumber: 1, startColumn: 1, endLineNumber: 20, endColumn: 1 },\n\t\t\t0, // eolCount - no new lines inserted\n\t\t\t0, // firstLineLength\n\t\t\t0, // lastLineLength\n\t\t\t0  // firstCharCode\n\t\t);\n\n\t\t// After an encompassing deletion, the piece should be empty\n\t\tassert.strictEqual(piece.isEmpty(), true, 'Piece should be empty after encompassing deletion');\n\n\t\t// EXPECTED BEHAVIOR: The store should be empty (no pieces with invalid line numbers)\n\t\t// Currently fails because the piece remains with startLineNumber=0, endLineNumber=-1\n\t\tassert.strictEqual(store.isEmpty(), true, 'Store should be empty after all tokens are deleted by encompassing edit');\n\t});\n});\n\n"]}