{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/editor/test/common/model/textChange.test.ts","vs/editor/test/common/model/textChange.test.ts"],"names":[],"mappings":"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","file":"textChange.test.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport assert from 'assert';\nimport { ensureNoDisposablesAreLeakedInTestSuite } from '../../../../base/test/common/utils.js';\nimport { compressConsecutiveTextChanges, TextChange } from '../../../common/core/textChange.js';\n\nconst GENERATE_TESTS = false;\n\ninterface IGeneratedEdit {\n\toffset: number;\n\tlength: number;\n\ttext: string;\n}\n\nsuite('TextChangeCompressor', () => {\n\n\tensureNoDisposablesAreLeakedInTestSuite();\n\n\tfunction getResultingContent(initialContent: string, edits: IGeneratedEdit[]): string {\n\t\tlet content = initialContent;\n\t\tfor (let i = edits.length - 1; i >= 0; i--) {\n\t\t\tcontent = (\n\t\t\t\tcontent.substring(0, edits[i].offset) +\n\t\t\t\tedits[i].text +\n\t\t\t\tcontent.substring(edits[i].offset + edits[i].length)\n\t\t\t);\n\t\t}\n\t\treturn content;\n\t}\n\n\tfunction getTextChanges(initialContent: string, edits: IGeneratedEdit[]): TextChange[] {\n\t\tlet content = initialContent;\n\t\tconst changes: TextChange[] = new Array<TextChange>(edits.length);\n\t\tlet deltaOffset = 0;\n\n\t\tfor (let i = 0; i < edits.length; i++) {\n\t\t\tconst edit = edits[i];\n\n\t\t\tconst position = edit.offset + deltaOffset;\n\t\t\tconst length = edit.length;\n\t\t\tconst text = edit.text;\n\n\t\t\tconst oldText = content.substr(position, length);\n\n\t\t\tcontent = (\n\t\t\t\tcontent.substr(0, position) +\n\t\t\t\ttext +\n\t\t\t\tcontent.substr(position + length)\n\t\t\t);\n\n\t\t\tchanges[i] = new TextChange(edit.offset, oldText, position, text);\n\n\t\t\tdeltaOffset += text.length - length;\n\t\t}\n\n\t\treturn changes;\n\t}\n\n\tfunction assertCompression(initialText: string, edit1: IGeneratedEdit[], edit2: IGeneratedEdit[]): void {\n\n\t\tconst tmpText = getResultingContent(initialText, edit1);\n\t\tconst chg1 = getTextChanges(initialText, edit1);\n\n\t\tconst finalText = getResultingContent(tmpText, edit2);\n\t\tconst chg2 = getTextChanges(tmpText, edit2);\n\n\t\tconst compressedTextChanges = compressConsecutiveTextChanges(chg1, chg2);\n\n\t\t// Check that the compression was correct\n\t\tconst compressedDoTextEdits: IGeneratedEdit[] = compressedTextChanges.map((change) => {\n\t\t\treturn {\n\t\t\t\toffset: change.oldPosition,\n\t\t\t\tlength: change.oldLength,\n\t\t\t\ttext: change.newText\n\t\t\t};\n\t\t});\n\t\tconst actualDoResult = getResultingContent(initialText, compressedDoTextEdits);\n\t\tassert.strictEqual(actualDoResult, finalText);\n\n\t\tconst compressedUndoTextEdits: IGeneratedEdit[] = compressedTextChanges.map((change) => {\n\t\t\treturn {\n\t\t\t\toffset: change.newPosition,\n\t\t\t\tlength: change.newLength,\n\t\t\t\ttext: change.oldText\n\t\t\t};\n\t\t});\n\t\tconst actualUndoResult = getResultingContent(finalText, compressedUndoTextEdits);\n\t\tassert.strictEqual(actualUndoResult, initialText);\n\t}\n\n\ttest('simple 1', () => {\n\t\tassertCompression(\n\t\t\t'',\n\t\t\t[{ offset: 0, length: 0, text: 'h' }],\n\t\t\t[{ offset: 1, length: 0, text: 'e' }]\n\t\t);\n\t});\n\n\ttest('simple 2', () => {\n\t\tassertCompression(\n\t\t\t'|',\n\t\t\t[{ offset: 0, length: 0, text: 'h' }],\n\t\t\t[{ offset: 2, length: 0, text: 'e' }]\n\t\t);\n\t});\n\n\ttest('complex1', () => {\n\t\tassertCompression(\n\t\t\t'abcdefghij',\n\t\t\t[\n\t\t\t\t{ offset: 0, length: 3, text: 'qh' },\n\t\t\t\t{ offset: 5, length: 0, text: '1' },\n\t\t\t\t{ offset: 8, length: 2, text: 'X' }\n\t\t\t],\n\t\t\t[\n\t\t\t\t{ offset: 1, length: 0, text: 'Z' },\n\t\t\t\t{ offset: 3, length: 3, text: 'Y' },\n\t\t\t]\n\t\t);\n\t});\n\n\t// test('issue #118041', () => {\n\t// \tassertCompression(\n\t// \t\t'﻿',\n\t// \t\t[\n\t// \t\t\t{ offset: 0, length: 1, text: '' },\n\t// \t\t],\n\t// \t\t[\n\t// \t\t\t{ offset: 1, length: 0, text: 'Z' },\n\t// \t\t\t{ offset: 3, length: 3, text: 'Y' },\n\t// \t\t]\n\t// \t);\n\t// })\n\n\ttest('gen1', () => {\n\t\tassertCompression(\n\t\t\t'kxm',\n\t\t\t[{ offset: 0, length: 1, text: 'tod_neu' }],\n\t\t\t[{ offset: 1, length: 2, text: 'sag_e' }]\n\t\t);\n\t});\n\n\ttest('gen2', () => {\n\t\tassertCompression(\n\t\t\t'kpb_r_v',\n\t\t\t[{ offset: 5, length: 2, text: 'a_jvf_l' }],\n\t\t\t[{ offset: 10, length: 2, text: 'w' }]\n\t\t);\n\t});\n\n\ttest('gen3', () => {\n\t\tassertCompression(\n\t\t\t'slu_w',\n\t\t\t[{ offset: 4, length: 1, text: '_wfw' }],\n\t\t\t[{ offset: 3, length: 5, text: '' }]\n\t\t);\n\t});\n\n\ttest('gen4', () => {\n\t\tassertCompression(\n\t\t\t'_e',\n\t\t\t[{ offset: 2, length: 0, text: 'zo_b' }],\n\t\t\t[{ offset: 1, length: 3, text: 'tra' }]\n\t\t);\n\t});\n\n\ttest('gen5', () => {\n\t\tassertCompression(\n\t\t\t'ssn_',\n\t\t\t[{ offset: 0, length: 2, text: 'tat_nwe' }],\n\t\t\t[{ offset: 2, length: 6, text: 'jm' }]\n\t\t);\n\t});\n\n\ttest('gen6', () => {\n\t\tassertCompression(\n\t\t\t'kl_nru',\n\t\t\t[{ offset: 4, length: 1, text: '' }],\n\t\t\t[{ offset: 1, length: 4, text: '__ut' }]\n\t\t);\n\t});\n\n\tconst _a = 'a'.charCodeAt(0);\n\tconst _z = 'z'.charCodeAt(0);\n\n\tfunction getRandomInt(min: number, max: number): number {\n\t\treturn Math.floor(Math.random() * (max - min + 1)) + min;\n\t}\n\n\tfunction getRandomString(minLength: number, maxLength: number): string {\n\t\tconst length = getRandomInt(minLength, maxLength);\n\t\tlet r = '';\n\t\tfor (let i = 0; i < length; i++) {\n\t\t\tr += String.fromCharCode(getRandomInt(_a, _z));\n\t\t}\n\t\treturn r;\n\t}\n\n\tfunction getRandomEOL(): string {\n\t\tswitch (getRandomInt(1, 3)) {\n\t\t\tcase 1: return '\\r';\n\t\t\tcase 2: return '\\n';\n\t\t\tcase 3: return '\\r\\n';\n\t\t}\n\t\tthrow new Error(`not possible`);\n\t}\n\n\tfunction getRandomBuffer(small: boolean): string {\n\t\tconst lineCount = getRandomInt(1, small ? 3 : 10);\n\t\tconst lines: string[] = [];\n\t\tfor (let i = 0; i < lineCount; i++) {\n\t\t\tlines.push(getRandomString(0, small ? 3 : 10) + getRandomEOL());\n\t\t}\n\t\treturn lines.join('');\n\t}\n\n\tfunction getRandomEdits(content: string, min: number = 1, max: number = 5): IGeneratedEdit[] {\n\n\t\tconst result: IGeneratedEdit[] = [];\n\t\tlet cnt = getRandomInt(min, max);\n\n\t\tlet maxOffset = content.length;\n\n\t\twhile (cnt > 0 && maxOffset > 0) {\n\n\t\t\tconst offset = getRandomInt(0, maxOffset);\n\t\t\tconst length = getRandomInt(0, maxOffset - offset);\n\t\t\tconst text = getRandomBuffer(true);\n\n\t\t\tresult.push({\n\t\t\t\toffset: offset,\n\t\t\t\tlength: length,\n\t\t\t\ttext: text\n\t\t\t});\n\n\t\t\tmaxOffset = offset;\n\t\t\tcnt--;\n\t\t}\n\n\t\tresult.reverse();\n\n\t\treturn result;\n\t}\n\n\tclass GeneratedTest {\n\n\t\tprivate readonly _content: string;\n\t\tprivate readonly _edits1: IGeneratedEdit[];\n\t\tprivate readonly _edits2: IGeneratedEdit[];\n\n\t\tconstructor() {\n\t\t\tthis._content = getRandomBuffer(false).replace(/\\n/g, '_');\n\t\t\tthis._edits1 = getRandomEdits(this._content, 1, 5).map((e) => { return { offset: e.offset, length: e.length, text: e.text.replace(/\\n/g, '_') }; });\n\t\t\tconst tmp = getResultingContent(this._content, this._edits1);\n\t\t\tthis._edits2 = getRandomEdits(tmp, 1, 5).map((e) => { return { offset: e.offset, length: e.length, text: e.text.replace(/\\n/g, '_') }; });\n\t\t}\n\n\t\tpublic print(): void {\n\t\t\tconsole.log(`assertCompression(${JSON.stringify(this._content)}, ${JSON.stringify(this._edits1)}, ${JSON.stringify(this._edits2)});`);\n\t\t}\n\n\t\tpublic assert(): void {\n\t\t\tassertCompression(this._content, this._edits1, this._edits2);\n\t\t}\n\t}\n\n\tif (GENERATE_TESTS) {\n\t\tlet testNumber = 0;\n\t\twhile (true) {\n\t\t\ttestNumber++;\n\t\t\tconsole.log(`------RUNNING TextChangeCompressor TEST ${testNumber}`);\n\t\t\tconst test = new GeneratedTest();\n\t\t\ttry {\n\t\t\t\ttest.assert();\n\t\t\t} catch (err) {\n\t\t\t\tconsole.log(err);\n\t\t\t\ttest.print();\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n});\n\nsuite('TextChange', () => {\n\n\tensureNoDisposablesAreLeakedInTestSuite();\n\n\ttest('issue #118041: unicode character undo bug', () => {\n\t\tconst textChange = new TextChange(428, '﻿', 428, '');\n\t\tconst buff = new Uint8Array(textChange.writeSize());\n\t\ttextChange.write(buff, 0);\n\t\tconst actual: TextChange[] = [];\n\t\tTextChange.read(buff, 0, actual);\n\t\tassert.deepStrictEqual(actual[0], textChange);\n\t});\n\n});\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport assert from 'assert';\nimport { ensureNoDisposablesAreLeakedInTestSuite } from '../../../../base/test/common/utils.js';\nimport { compressConsecutiveTextChanges, TextChange } from '../../../common/core/textChange.js';\n\nconst GENERATE_TESTS = false;\n\ninterface IGeneratedEdit {\n\toffset: number;\n\tlength: number;\n\ttext: string;\n}\n\nsuite('TextChangeCompressor', () => {\n\n\tensureNoDisposablesAreLeakedInTestSuite();\n\n\tfunction getResultingContent(initialContent: string, edits: IGeneratedEdit[]): string {\n\t\tlet content = initialContent;\n\t\tfor (let i = edits.length - 1; i >= 0; i--) {\n\t\t\tcontent = (\n\t\t\t\tcontent.substring(0, edits[i].offset) +\n\t\t\t\tedits[i].text +\n\t\t\t\tcontent.substring(edits[i].offset + edits[i].length)\n\t\t\t);\n\t\t}\n\t\treturn content;\n\t}\n\n\tfunction getTextChanges(initialContent: string, edits: IGeneratedEdit[]): TextChange[] {\n\t\tlet content = initialContent;\n\t\tconst changes: TextChange[] = new Array<TextChange>(edits.length);\n\t\tlet deltaOffset = 0;\n\n\t\tfor (let i = 0; i < edits.length; i++) {\n\t\t\tconst edit = edits[i];\n\n\t\t\tconst position = edit.offset + deltaOffset;\n\t\t\tconst length = edit.length;\n\t\t\tconst text = edit.text;\n\n\t\t\tconst oldText = content.substr(position, length);\n\n\t\t\tcontent = (\n\t\t\t\tcontent.substr(0, position) +\n\t\t\t\ttext +\n\t\t\t\tcontent.substr(position + length)\n\t\t\t);\n\n\t\t\tchanges[i] = new TextChange(edit.offset, oldText, position, text);\n\n\t\t\tdeltaOffset += text.length - length;\n\t\t}\n\n\t\treturn changes;\n\t}\n\n\tfunction assertCompression(initialText: string, edit1: IGeneratedEdit[], edit2: IGeneratedEdit[]): void {\n\n\t\tconst tmpText = getResultingContent(initialText, edit1);\n\t\tconst chg1 = getTextChanges(initialText, edit1);\n\n\t\tconst finalText = getResultingContent(tmpText, edit2);\n\t\tconst chg2 = getTextChanges(tmpText, edit2);\n\n\t\tconst compressedTextChanges = compressConsecutiveTextChanges(chg1, chg2);\n\n\t\t// Check that the compression was correct\n\t\tconst compressedDoTextEdits: IGeneratedEdit[] = compressedTextChanges.map((change) => {\n\t\t\treturn {\n\t\t\t\toffset: change.oldPosition,\n\t\t\t\tlength: change.oldLength,\n\t\t\t\ttext: change.newText\n\t\t\t};\n\t\t});\n\t\tconst actualDoResult = getResultingContent(initialText, compressedDoTextEdits);\n\t\tassert.strictEqual(actualDoResult, finalText);\n\n\t\tconst compressedUndoTextEdits: IGeneratedEdit[] = compressedTextChanges.map((change) => {\n\t\t\treturn {\n\t\t\t\toffset: change.newPosition,\n\t\t\t\tlength: change.newLength,\n\t\t\t\ttext: change.oldText\n\t\t\t};\n\t\t});\n\t\tconst actualUndoResult = getResultingContent(finalText, compressedUndoTextEdits);\n\t\tassert.strictEqual(actualUndoResult, initialText);\n\t}\n\n\ttest('simple 1', () => {\n\t\tassertCompression(\n\t\t\t'',\n\t\t\t[{ offset: 0, length: 0, text: 'h' }],\n\t\t\t[{ offset: 1, length: 0, text: 'e' }]\n\t\t);\n\t});\n\n\ttest('simple 2', () => {\n\t\tassertCompression(\n\t\t\t'|',\n\t\t\t[{ offset: 0, length: 0, text: 'h' }],\n\t\t\t[{ offset: 2, length: 0, text: 'e' }]\n\t\t);\n\t});\n\n\ttest('complex1', () => {\n\t\tassertCompression(\n\t\t\t'abcdefghij',\n\t\t\t[\n\t\t\t\t{ offset: 0, length: 3, text: 'qh' },\n\t\t\t\t{ offset: 5, length: 0, text: '1' },\n\t\t\t\t{ offset: 8, length: 2, text: 'X' }\n\t\t\t],\n\t\t\t[\n\t\t\t\t{ offset: 1, length: 0, text: 'Z' },\n\t\t\t\t{ offset: 3, length: 3, text: 'Y' },\n\t\t\t]\n\t\t);\n\t});\n\n\t// test('issue #118041', () => {\n\t// \tassertCompression(\n\t// \t\t'﻿',\n\t// \t\t[\n\t// \t\t\t{ offset: 0, length: 1, text: '' },\n\t// \t\t],\n\t// \t\t[\n\t// \t\t\t{ offset: 1, length: 0, text: 'Z' },\n\t// \t\t\t{ offset: 3, length: 3, text: 'Y' },\n\t// \t\t]\n\t// \t);\n\t// })\n\n\ttest('gen1', () => {\n\t\tassertCompression(\n\t\t\t'kxm',\n\t\t\t[{ offset: 0, length: 1, text: 'tod_neu' }],\n\t\t\t[{ offset: 1, length: 2, text: 'sag_e' }]\n\t\t);\n\t});\n\n\ttest('gen2', () => {\n\t\tassertCompression(\n\t\t\t'kpb_r_v',\n\t\t\t[{ offset: 5, length: 2, text: 'a_jvf_l' }],\n\t\t\t[{ offset: 10, length: 2, text: 'w' }]\n\t\t);\n\t});\n\n\ttest('gen3', () => {\n\t\tassertCompression(\n\t\t\t'slu_w',\n\t\t\t[{ offset: 4, length: 1, text: '_wfw' }],\n\t\t\t[{ offset: 3, length: 5, text: '' }]\n\t\t);\n\t});\n\n\ttest('gen4', () => {\n\t\tassertCompression(\n\t\t\t'_e',\n\t\t\t[{ offset: 2, length: 0, text: 'zo_b' }],\n\t\t\t[{ offset: 1, length: 3, text: 'tra' }]\n\t\t);\n\t});\n\n\ttest('gen5', () => {\n\t\tassertCompression(\n\t\t\t'ssn_',\n\t\t\t[{ offset: 0, length: 2, text: 'tat_nwe' }],\n\t\t\t[{ offset: 2, length: 6, text: 'jm' }]\n\t\t);\n\t});\n\n\ttest('gen6', () => {\n\t\tassertCompression(\n\t\t\t'kl_nru',\n\t\t\t[{ offset: 4, length: 1, text: '' }],\n\t\t\t[{ offset: 1, length: 4, text: '__ut' }]\n\t\t);\n\t});\n\n\tconst _a = 'a'.charCodeAt(0);\n\tconst _z = 'z'.charCodeAt(0);\n\n\tfunction getRandomInt(min: number, max: number): number {\n\t\treturn Math.floor(Math.random() * (max - min + 1)) + min;\n\t}\n\n\tfunction getRandomString(minLength: number, maxLength: number): string {\n\t\tconst length = getRandomInt(minLength, maxLength);\n\t\tlet r = '';\n\t\tfor (let i = 0; i < length; i++) {\n\t\t\tr += String.fromCharCode(getRandomInt(_a, _z));\n\t\t}\n\t\treturn r;\n\t}\n\n\tfunction getRandomEOL(): string {\n\t\tswitch (getRandomInt(1, 3)) {\n\t\t\tcase 1: return '\\r';\n\t\t\tcase 2: return '\\n';\n\t\t\tcase 3: return '\\r\\n';\n\t\t}\n\t\tthrow new Error(`not possible`);\n\t}\n\n\tfunction getRandomBuffer(small: boolean): string {\n\t\tconst lineCount = getRandomInt(1, small ? 3 : 10);\n\t\tconst lines: string[] = [];\n\t\tfor (let i = 0; i < lineCount; i++) {\n\t\t\tlines.push(getRandomString(0, small ? 3 : 10) + getRandomEOL());\n\t\t}\n\t\treturn lines.join('');\n\t}\n\n\tfunction getRandomEdits(content: string, min: number = 1, max: number = 5): IGeneratedEdit[] {\n\n\t\tconst result: IGeneratedEdit[] = [];\n\t\tlet cnt = getRandomInt(min, max);\n\n\t\tlet maxOffset = content.length;\n\n\t\twhile (cnt > 0 && maxOffset > 0) {\n\n\t\t\tconst offset = getRandomInt(0, maxOffset);\n\t\t\tconst length = getRandomInt(0, maxOffset - offset);\n\t\t\tconst text = getRandomBuffer(true);\n\n\t\t\tresult.push({\n\t\t\t\toffset: offset,\n\t\t\t\tlength: length,\n\t\t\t\ttext: text\n\t\t\t});\n\n\t\t\tmaxOffset = offset;\n\t\t\tcnt--;\n\t\t}\n\n\t\tresult.reverse();\n\n\t\treturn result;\n\t}\n\n\tclass GeneratedTest {\n\n\t\tprivate readonly _content: string;\n\t\tprivate readonly _edits1: IGeneratedEdit[];\n\t\tprivate readonly _edits2: IGeneratedEdit[];\n\n\t\tconstructor() {\n\t\t\tthis._content = getRandomBuffer(false).replace(/\\n/g, '_');\n\t\t\tthis._edits1 = getRandomEdits(this._content, 1, 5).map((e) => { return { offset: e.offset, length: e.length, text: e.text.replace(/\\n/g, '_') }; });\n\t\t\tconst tmp = getResultingContent(this._content, this._edits1);\n\t\t\tthis._edits2 = getRandomEdits(tmp, 1, 5).map((e) => { return { offset: e.offset, length: e.length, text: e.text.replace(/\\n/g, '_') }; });\n\t\t}\n\n\t\tpublic print(): void {\n\t\t\tconsole.log(`assertCompression(${JSON.stringify(this._content)}, ${JSON.stringify(this._edits1)}, ${JSON.stringify(this._edits2)});`);\n\t\t}\n\n\t\tpublic assert(): void {\n\t\t\tassertCompression(this._content, this._edits1, this._edits2);\n\t\t}\n\t}\n\n\tif (GENERATE_TESTS) {\n\t\tlet testNumber = 0;\n\t\twhile (true) {\n\t\t\ttestNumber++;\n\t\t\tconsole.log(`------RUNNING TextChangeCompressor TEST ${testNumber}`);\n\t\t\tconst test = new GeneratedTest();\n\t\t\ttry {\n\t\t\t\ttest.assert();\n\t\t\t} catch (err) {\n\t\t\t\tconsole.log(err);\n\t\t\t\ttest.print();\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n});\n\nsuite('TextChange', () => {\n\n\tensureNoDisposablesAreLeakedInTestSuite();\n\n\ttest('issue #118041: unicode character undo bug', () => {\n\t\tconst textChange = new TextChange(428, '﻿', 428, '');\n\t\tconst buff = new Uint8Array(textChange.writeSize());\n\t\ttextChange.write(buff, 0);\n\t\tconst actual: TextChange[] = [];\n\t\tTextChange.read(buff, 0, actual);\n\t\tassert.deepStrictEqual(actual[0], textChange);\n\t});\n\n});\n"]}