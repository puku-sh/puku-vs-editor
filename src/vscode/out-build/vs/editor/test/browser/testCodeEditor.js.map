{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/editor/test/browser/testCodeEditor.ts","vs/editor/test/browser/testCodeEditor.ts"],"names":[],"mappings":"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","file":"testCodeEditor.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { DisposableStore, IDisposable, toDisposable } from '../../../base/common/lifecycle.js';\nimport { mock } from '../../../base/test/common/mock.js';\nimport { EditorConfiguration } from '../../browser/config/editorConfiguration.js';\nimport { IActiveCodeEditor, ICodeEditor } from '../../browser/editorBrowser.js';\nimport { ICodeEditorService } from '../../browser/services/codeEditorService.js';\nimport { View } from '../../browser/view.js';\nimport { CodeEditorWidget, ICodeEditorWidgetOptions } from '../../browser/widget/codeEditor/codeEditorWidget.js';\nimport * as editorOptions from '../../common/config/editorOptions.js';\nimport { IEditorContribution } from '../../common/editorCommon.js';\nimport { ILanguageService } from '../../common/languages/language.js';\nimport { ILanguageConfigurationService } from '../../common/languages/languageConfigurationRegistry.js';\nimport { ITextBufferFactory, ITextModel } from '../../common/model.js';\nimport { IEditorWorkerService } from '../../common/services/editorWorker.js';\nimport { ILanguageFeatureDebounceService, LanguageFeatureDebounceService } from '../../common/services/languageFeatureDebounce.js';\nimport { ILanguageFeaturesService } from '../../common/services/languageFeatures.js';\nimport { LanguageFeaturesService } from '../../common/services/languageFeaturesService.js';\nimport { LanguageService } from '../../common/services/languageService.js';\nimport { IModelService } from '../../common/services/model.js';\nimport { ModelService } from '../../common/services/modelService.js';\nimport { ITextResourcePropertiesService } from '../../common/services/textResourceConfiguration.js';\nimport { ViewModel } from '../../common/viewModel/viewModelImpl.js';\nimport { TestConfiguration } from './config/testConfiguration.js';\nimport { TestCodeEditorService, TestCommandService } from './editorTestServices.js';\nimport { TestLanguageConfigurationService } from '../common/modes/testLanguageConfigurationService.js';\nimport { TestEditorWorkerService } from '../common/services/testEditorWorkerService.js';\nimport { TestTextResourcePropertiesService } from '../common/services/testTextResourcePropertiesService.js';\nimport { instantiateTextModel } from '../common/testTextModel.js';\nimport { AccessibilitySupport, IAccessibilityService } from '../../../platform/accessibility/common/accessibility.js';\nimport { TestAccessibilityService } from '../../../platform/accessibility/test/common/testAccessibilityService.js';\nimport { MenuId } from '../../../platform/actions/common/actions.js';\nimport { IClipboardService } from '../../../platform/clipboard/common/clipboardService.js';\nimport { TestClipboardService } from '../../../platform/clipboard/test/common/testClipboardService.js';\nimport { ICommandService } from '../../../platform/commands/common/commands.js';\nimport { IConfigurationService } from '../../../platform/configuration/common/configuration.js';\nimport { TestConfigurationService } from '../../../platform/configuration/test/common/testConfigurationService.js';\nimport { IContextKeyService, IContextKeyServiceTarget } from '../../../platform/contextkey/common/contextkey.js';\nimport { IDialogService } from '../../../platform/dialogs/common/dialogs.js';\nimport { TestDialogService } from '../../../platform/dialogs/test/common/testDialogService.js';\nimport { IEnvironmentService } from '../../../platform/environment/common/environment.js';\nimport { SyncDescriptor } from '../../../platform/instantiation/common/descriptors.js';\nimport { BrandedService, IInstantiationService, ServiceIdentifier, ServicesAccessor } from '../../../platform/instantiation/common/instantiation.js';\nimport { ServiceCollection } from '../../../platform/instantiation/common/serviceCollection.js';\nimport { TestInstantiationService } from '../../../platform/instantiation/test/common/instantiationServiceMock.js';\nimport { IKeybindingService } from '../../../platform/keybinding/common/keybinding.js';\nimport { MockContextKeyService, MockKeybindingService } from '../../../platform/keybinding/test/common/mockKeybindingService.js';\nimport { ILoggerService, ILogService, NullLoggerService, NullLogService } from '../../../platform/log/common/log.js';\nimport { INotificationService } from '../../../platform/notification/common/notification.js';\nimport { TestNotificationService } from '../../../platform/notification/test/common/testNotificationService.js';\nimport { IOpenerService } from '../../../platform/opener/common/opener.js';\nimport { NullOpenerService } from '../../../platform/opener/test/common/nullOpenerService.js';\nimport { ITelemetryService } from '../../../platform/telemetry/common/telemetry.js';\nimport { NullTelemetryServiceShape } from '../../../platform/telemetry/common/telemetryUtils.js';\nimport { IThemeService } from '../../../platform/theme/common/themeService.js';\nimport { TestThemeService } from '../../../platform/theme/test/common/testThemeService.js';\nimport { IUndoRedoService } from '../../../platform/undoRedo/common/undoRedo.js';\nimport { UndoRedoService } from '../../../platform/undoRedo/common/undoRedoService.js';\nimport { ITreeSitterLibraryService } from '../../common/services/treeSitter/treeSitterLibraryService.js';\nimport { TestTreeSitterLibraryService } from '../common/services/testTreeSitterLibraryService.js';\nimport { IInlineCompletionsService, InlineCompletionsService } from '../../browser/services/inlineCompletionsService.js';\nimport { EditorCommand } from '../../browser/editorExtensions.js';\nimport { IDataChannelService, NullDataChannelService } from '../../../platform/dataChannel/common/dataChannel.js';\n\nexport interface ITestCodeEditor extends IActiveCodeEditor {\n\tgetViewModel(): ViewModel | undefined;\n\tregisterAndInstantiateContribution<T extends IEditorContribution, Services extends BrandedService[]>(id: string, ctor: new (editor: ICodeEditor, ...services: Services) => T): T;\n\tregisterDisposable(disposable: IDisposable): void;\n\trunCommand(command: ITestEditorCommand, args?: any): void | Promise<void>;\n\trunAction(action: ITestEditorAction, args?: any): void | Promise<void>;\n}\n\nexport interface ITestEditorCommand {\n\trunEditorCommand(accessor: ServicesAccessor, editor: ICodeEditor, args?: any): void | Promise<void>;\n}\n\nexport interface ITestEditorAction {\n\trun(accessor: ServicesAccessor, editor: ICodeEditor, args?: any): void | Promise<void>;\n}\n\nexport class TestCodeEditor extends CodeEditorWidget implements ICodeEditor {\n\n\t//#region testing overrides\n\tprotected override _createConfiguration(isSimpleWidget: boolean, contextMenuId: MenuId, options: Readonly<TestCodeEditorCreationOptions>): EditorConfiguration {\n\t\treturn new TestConfiguration(options);\n\t}\n\tprotected override _createView(viewModel: ViewModel): [View, boolean] {\n\t\t// Never create a view\n\t\treturn [null! as View, false];\n\t}\n\tprivate _hasTextFocus = false;\n\tpublic setHasTextFocus(hasTextFocus: boolean): void {\n\t\tthis._hasTextFocus = hasTextFocus;\n\t}\n\tpublic override hasTextFocus(): boolean {\n\t\treturn this._hasTextFocus;\n\t}\n\t//#endregion\n\n\t//#region Testing utils\n\tpublic getViewModel(): ViewModel | undefined {\n\t\treturn this._modelData ? this._modelData.viewModel : undefined;\n\t}\n\tpublic registerAndInstantiateContribution<T extends IEditorContribution>(id: string, ctor: new (editor: ICodeEditor, ...services: BrandedService[]) => T): T {\n\t\tconst r: T = this._instantiationService.createInstance(ctor, this);\n\t\tthis._contributions.set(id, r);\n\t\treturn r;\n\t}\n\tpublic registerDisposable(disposable: IDisposable): void {\n\t\tthis._register(disposable);\n\t}\n\tpublic runCommand(command: EditorCommand, args?: any): void | Promise<void> {\n\t\treturn this._instantiationService.invokeFunction((accessor) => {\n\t\t\treturn command.runEditorCommand(accessor, this, args);\n\t\t});\n\t}\n\tpublic runAction(action: ITestEditorAction, args?: any): void | Promise<void> {\n\t\treturn this._instantiationService.invokeFunction((accessor) => {\n\t\t\treturn action.run(accessor, this, args);\n\t\t});\n\t}\n}\n\nclass TestEditorDomElement {\n\tparentElement: IContextKeyServiceTarget | null = null;\n\townerDocument = document;\n\tdocument = document;\n\tsetAttribute(attr: string, value: string): void { }\n\tremoveAttribute(attr: string): void { }\n\thasAttribute(attr: string): boolean { return false; }\n\tgetAttribute(attr: string): string | undefined { return undefined; }\n\taddEventListener(event: string): void { }\n\tremoveEventListener(event: string): void { }\n}\n\nexport interface TestCodeEditorCreationOptions extends editorOptions.IEditorOptions {\n\t/**\n\t * If the editor has text focus.\n\t * Defaults to true.\n\t */\n\thasTextFocus?: boolean;\n\t/**\n\t * Env configuration\n\t */\n\tenvConfig?: ITestEnvConfiguration;\n}\n\nexport interface TestCodeEditorInstantiationOptions extends TestCodeEditorCreationOptions {\n\t/**\n\t * Services to use.\n\t */\n\tserviceCollection?: ServiceCollection;\n}\n\nexport interface ITestEnvConfiguration {\n\textraEditorClassName?: string;\n\touterWidth?: number;\n\touterHeight?: number;\n\temptySelectionClipboard?: boolean;\n\tpixelRatio?: number;\n\taccessibilitySupport?: AccessibilitySupport;\n}\n\nexport function withTestCodeEditor(text: ITextModel | string | string[] | ITextBufferFactory, options: TestCodeEditorInstantiationOptions, callback: (editor: ITestCodeEditor, viewModel: ViewModel, instantiationService: TestInstantiationService) => void): void {\n\treturn _withTestCodeEditor(text, options, callback);\n}\n\nexport async function withAsyncTestCodeEditor(text: ITextModel | string | string[] | ITextBufferFactory, options: TestCodeEditorInstantiationOptions, callback: (editor: ITestCodeEditor, viewModel: ViewModel, instantiationService: TestInstantiationService) => Promise<void>): Promise<void> {\n\treturn _withTestCodeEditor(text, options, callback);\n}\n\nfunction isTextModel(arg: ITextModel | string | string[] | ITextBufferFactory): arg is ITextModel {\n\treturn Boolean(arg && (arg as ITextModel).uri);\n}\n\nfunction _withTestCodeEditor(arg: ITextModel | string | string[] | ITextBufferFactory, options: TestCodeEditorInstantiationOptions, callback: (editor: ITestCodeEditor, viewModel: ViewModel, instantiationService: TestInstantiationService) => void): void;\nfunction _withTestCodeEditor(arg: ITextModel | string | string[] | ITextBufferFactory, options: TestCodeEditorInstantiationOptions, callback: (editor: ITestCodeEditor, viewModel: ViewModel, instantiationService: TestInstantiationService) => Promise<void>): Promise<void>;\nfunction _withTestCodeEditor(arg: ITextModel | string | string[] | ITextBufferFactory, options: TestCodeEditorInstantiationOptions, callback: (editor: ITestCodeEditor, viewModel: ViewModel, instantiationService: TestInstantiationService) => Promise<void> | void): Promise<void> | void {\n\tconst disposables = new DisposableStore();\n\tconst instantiationService = createCodeEditorServices(disposables, options.serviceCollection);\n\tdelete options.serviceCollection;\n\n\t// create a model if necessary\n\tlet model: ITextModel;\n\tif (isTextModel(arg)) {\n\t\tmodel = arg;\n\t} else {\n\t\tmodel = disposables.add(instantiateTextModel(instantiationService, Array.isArray(arg) ? arg.join('\\n') : arg));\n\t}\n\n\tconst editor = disposables.add(instantiateTestCodeEditor(instantiationService, model, options));\n\tconst viewModel = editor.getViewModel()!;\n\tviewModel.setHasFocus(true);\n\tconst result = callback(editor, editor.getViewModel()!, instantiationService);\n\tif (result) {\n\t\treturn result.then(() => disposables.dispose());\n\t}\n\n\tdisposables.dispose();\n}\n\nexport function createCodeEditorServices(disposables: Pick<DisposableStore, 'add'>, services: ServiceCollection = new ServiceCollection()): TestInstantiationService {\n\tconst serviceIdentifiers: ServiceIdentifier<any>[] = [];\n\tconst define = <T>(id: ServiceIdentifier<T>, ctor: new (...args: any[]) => T) => {\n\t\tif (!services.has(id)) {\n\t\t\tservices.set(id, new SyncDescriptor(ctor));\n\t\t}\n\t\tserviceIdentifiers.push(id);\n\t};\n\tconst defineInstance = <T>(id: ServiceIdentifier<T>, instance: T) => {\n\t\tif (!services.has(id)) {\n\t\t\tservices.set(id, instance);\n\t\t}\n\t\tserviceIdentifiers.push(id);\n\t};\n\n\tdefine(IAccessibilityService, TestAccessibilityService);\n\tdefine(IKeybindingService, MockKeybindingService);\n\tdefine(IClipboardService, TestClipboardService);\n\tdefine(IEditorWorkerService, TestEditorWorkerService);\n\tdefineInstance(IOpenerService, NullOpenerService);\n\tdefine(INotificationService, TestNotificationService);\n\tdefine(IDialogService, TestDialogService);\n\tdefine(IUndoRedoService, UndoRedoService);\n\tdefine(ILanguageService, LanguageService);\n\tdefine(ILanguageConfigurationService, TestLanguageConfigurationService);\n\tdefine(IConfigurationService, TestConfigurationService);\n\tdefine(ITextResourcePropertiesService, TestTextResourcePropertiesService);\n\tdefine(IThemeService, TestThemeService);\n\tdefine(ILogService, NullLogService);\n\tdefine(IModelService, ModelService);\n\tdefine(ICodeEditorService, TestCodeEditorService);\n\tdefine(IContextKeyService, MockContextKeyService);\n\tdefine(ICommandService, TestCommandService);\n\tdefine(ITelemetryService, NullTelemetryServiceShape);\n\tdefine(ILoggerService, NullLoggerService);\n\tdefine(IDataChannelService, NullDataChannelService);\n\tdefine(IEnvironmentService, class extends mock<IEnvironmentService>() {\n\t\tdeclare readonly _serviceBrand: undefined;\n\t\toverride isBuilt: boolean = true;\n\t\toverride isExtensionDevelopment: boolean = false;\n\t});\n\tdefine(ILanguageFeatureDebounceService, LanguageFeatureDebounceService);\n\tdefine(ILanguageFeaturesService, LanguageFeaturesService);\n\tdefine(ITreeSitterLibraryService, TestTreeSitterLibraryService);\n\tdefine(IInlineCompletionsService, InlineCompletionsService);\n\n\tconst instantiationService = disposables.add(new TestInstantiationService(services, true));\n\tdisposables.add(toDisposable(() => {\n\t\tfor (const id of serviceIdentifiers) {\n\t\t\tconst instanceOrDescriptor = services.get(id);\n\t\t\tif (typeof instanceOrDescriptor.dispose === 'function') {\n\t\t\t\tinstanceOrDescriptor.dispose();\n\t\t\t}\n\t\t}\n\t}));\n\treturn instantiationService;\n}\n\nexport function createTestCodeEditor(model: ITextModel | undefined, options: TestCodeEditorInstantiationOptions = {}): ITestCodeEditor {\n\tconst disposables = new DisposableStore();\n\tconst instantiationService = createCodeEditorServices(disposables, options.serviceCollection);\n\tdelete options.serviceCollection;\n\n\tconst editor = instantiateTestCodeEditor(instantiationService, model || null, options);\n\teditor.registerDisposable(disposables);\n\treturn editor;\n}\n\nexport function instantiateTestCodeEditor(instantiationService: IInstantiationService, model: ITextModel | null, options: TestCodeEditorCreationOptions = {}): ITestCodeEditor {\n\tconst codeEditorWidgetOptions: ICodeEditorWidgetOptions = {\n\t\tcontributions: []\n\t};\n\tconst editor = instantiationService.createInstance(\n\t\tTestCodeEditor,\n\t\t// eslint-disable-next-line local/code-no-any-casts\n\t\t<HTMLElement><any>new TestEditorDomElement(),\n\t\toptions,\n\t\tcodeEditorWidgetOptions\n\t);\n\tif (typeof options.hasTextFocus === 'undefined') {\n\t\toptions.hasTextFocus = true;\n\t}\n\teditor.setHasTextFocus(options.hasTextFocus);\n\teditor.setModel(model);\n\tconst viewModel = editor.getViewModel();\n\tviewModel?.setHasFocus(options.hasTextFocus);\n\treturn <ITestCodeEditor>editor;\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { DisposableStore, IDisposable, toDisposable } from '../../../base/common/lifecycle.js';\nimport { mock } from '../../../base/test/common/mock.js';\nimport { EditorConfiguration } from '../../browser/config/editorConfiguration.js';\nimport { IActiveCodeEditor, ICodeEditor } from '../../browser/editorBrowser.js';\nimport { ICodeEditorService } from '../../browser/services/codeEditorService.js';\nimport { View } from '../../browser/view.js';\nimport { CodeEditorWidget, ICodeEditorWidgetOptions } from '../../browser/widget/codeEditor/codeEditorWidget.js';\nimport * as editorOptions from '../../common/config/editorOptions.js';\nimport { IEditorContribution } from '../../common/editorCommon.js';\nimport { ILanguageService } from '../../common/languages/language.js';\nimport { ILanguageConfigurationService } from '../../common/languages/languageConfigurationRegistry.js';\nimport { ITextBufferFactory, ITextModel } from '../../common/model.js';\nimport { IEditorWorkerService } from '../../common/services/editorWorker.js';\nimport { ILanguageFeatureDebounceService, LanguageFeatureDebounceService } from '../../common/services/languageFeatureDebounce.js';\nimport { ILanguageFeaturesService } from '../../common/services/languageFeatures.js';\nimport { LanguageFeaturesService } from '../../common/services/languageFeaturesService.js';\nimport { LanguageService } from '../../common/services/languageService.js';\nimport { IModelService } from '../../common/services/model.js';\nimport { ModelService } from '../../common/services/modelService.js';\nimport { ITextResourcePropertiesService } from '../../common/services/textResourceConfiguration.js';\nimport { ViewModel } from '../../common/viewModel/viewModelImpl.js';\nimport { TestConfiguration } from './config/testConfiguration.js';\nimport { TestCodeEditorService, TestCommandService } from './editorTestServices.js';\nimport { TestLanguageConfigurationService } from '../common/modes/testLanguageConfigurationService.js';\nimport { TestEditorWorkerService } from '../common/services/testEditorWorkerService.js';\nimport { TestTextResourcePropertiesService } from '../common/services/testTextResourcePropertiesService.js';\nimport { instantiateTextModel } from '../common/testTextModel.js';\nimport { AccessibilitySupport, IAccessibilityService } from '../../../platform/accessibility/common/accessibility.js';\nimport { TestAccessibilityService } from '../../../platform/accessibility/test/common/testAccessibilityService.js';\nimport { MenuId } from '../../../platform/actions/common/actions.js';\nimport { IClipboardService } from '../../../platform/clipboard/common/clipboardService.js';\nimport { TestClipboardService } from '../../../platform/clipboard/test/common/testClipboardService.js';\nimport { ICommandService } from '../../../platform/commands/common/commands.js';\nimport { IConfigurationService } from '../../../platform/configuration/common/configuration.js';\nimport { TestConfigurationService } from '../../../platform/configuration/test/common/testConfigurationService.js';\nimport { IContextKeyService, IContextKeyServiceTarget } from '../../../platform/contextkey/common/contextkey.js';\nimport { IDialogService } from '../../../platform/dialogs/common/dialogs.js';\nimport { TestDialogService } from '../../../platform/dialogs/test/common/testDialogService.js';\nimport { IEnvironmentService } from '../../../platform/environment/common/environment.js';\nimport { SyncDescriptor } from '../../../platform/instantiation/common/descriptors.js';\nimport { BrandedService, IInstantiationService, ServiceIdentifier, ServicesAccessor } from '../../../platform/instantiation/common/instantiation.js';\nimport { ServiceCollection } from '../../../platform/instantiation/common/serviceCollection.js';\nimport { TestInstantiationService } from '../../../platform/instantiation/test/common/instantiationServiceMock.js';\nimport { IKeybindingService } from '../../../platform/keybinding/common/keybinding.js';\nimport { MockContextKeyService, MockKeybindingService } from '../../../platform/keybinding/test/common/mockKeybindingService.js';\nimport { ILoggerService, ILogService, NullLoggerService, NullLogService } from '../../../platform/log/common/log.js';\nimport { INotificationService } from '../../../platform/notification/common/notification.js';\nimport { TestNotificationService } from '../../../platform/notification/test/common/testNotificationService.js';\nimport { IOpenerService } from '../../../platform/opener/common/opener.js';\nimport { NullOpenerService } from '../../../platform/opener/test/common/nullOpenerService.js';\nimport { ITelemetryService } from '../../../platform/telemetry/common/telemetry.js';\nimport { NullTelemetryServiceShape } from '../../../platform/telemetry/common/telemetryUtils.js';\nimport { IThemeService } from '../../../platform/theme/common/themeService.js';\nimport { TestThemeService } from '../../../platform/theme/test/common/testThemeService.js';\nimport { IUndoRedoService } from '../../../platform/undoRedo/common/undoRedo.js';\nimport { UndoRedoService } from '../../../platform/undoRedo/common/undoRedoService.js';\nimport { ITreeSitterLibraryService } from '../../common/services/treeSitter/treeSitterLibraryService.js';\nimport { TestTreeSitterLibraryService } from '../common/services/testTreeSitterLibraryService.js';\nimport { IInlineCompletionsService, InlineCompletionsService } from '../../browser/services/inlineCompletionsService.js';\nimport { EditorCommand } from '../../browser/editorExtensions.js';\nimport { IDataChannelService, NullDataChannelService } from '../../../platform/dataChannel/common/dataChannel.js';\n\nexport interface ITestCodeEditor extends IActiveCodeEditor {\n\tgetViewModel(): ViewModel | undefined;\n\tregisterAndInstantiateContribution<T extends IEditorContribution, Services extends BrandedService[]>(id: string, ctor: new (editor: ICodeEditor, ...services: Services) => T): T;\n\tregisterDisposable(disposable: IDisposable): void;\n\trunCommand(command: ITestEditorCommand, args?: any): void | Promise<void>;\n\trunAction(action: ITestEditorAction, args?: any): void | Promise<void>;\n}\n\nexport interface ITestEditorCommand {\n\trunEditorCommand(accessor: ServicesAccessor, editor: ICodeEditor, args?: any): void | Promise<void>;\n}\n\nexport interface ITestEditorAction {\n\trun(accessor: ServicesAccessor, editor: ICodeEditor, args?: any): void | Promise<void>;\n}\n\nexport class TestCodeEditor extends CodeEditorWidget implements ICodeEditor {\n\n\t//#region testing overrides\n\tprotected override _createConfiguration(isSimpleWidget: boolean, contextMenuId: MenuId, options: Readonly<TestCodeEditorCreationOptions>): EditorConfiguration {\n\t\treturn new TestConfiguration(options);\n\t}\n\tprotected override _createView(viewModel: ViewModel): [View, boolean] {\n\t\t// Never create a view\n\t\treturn [null! as View, false];\n\t}\n\tprivate _hasTextFocus = false;\n\tpublic setHasTextFocus(hasTextFocus: boolean): void {\n\t\tthis._hasTextFocus = hasTextFocus;\n\t}\n\tpublic override hasTextFocus(): boolean {\n\t\treturn this._hasTextFocus;\n\t}\n\t//#endregion\n\n\t//#region Testing utils\n\tpublic getViewModel(): ViewModel | undefined {\n\t\treturn this._modelData ? this._modelData.viewModel : undefined;\n\t}\n\tpublic registerAndInstantiateContribution<T extends IEditorContribution>(id: string, ctor: new (editor: ICodeEditor, ...services: BrandedService[]) => T): T {\n\t\tconst r: T = this._instantiationService.createInstance(ctor, this);\n\t\tthis._contributions.set(id, r);\n\t\treturn r;\n\t}\n\tpublic registerDisposable(disposable: IDisposable): void {\n\t\tthis._register(disposable);\n\t}\n\tpublic runCommand(command: EditorCommand, args?: any): void | Promise<void> {\n\t\treturn this._instantiationService.invokeFunction((accessor) => {\n\t\t\treturn command.runEditorCommand(accessor, this, args);\n\t\t});\n\t}\n\tpublic runAction(action: ITestEditorAction, args?: any): void | Promise<void> {\n\t\treturn this._instantiationService.invokeFunction((accessor) => {\n\t\t\treturn action.run(accessor, this, args);\n\t\t});\n\t}\n}\n\nclass TestEditorDomElement {\n\tparentElement: IContextKeyServiceTarget | null = null;\n\townerDocument = document;\n\tdocument = document;\n\tsetAttribute(attr: string, value: string): void { }\n\tremoveAttribute(attr: string): void { }\n\thasAttribute(attr: string): boolean { return false; }\n\tgetAttribute(attr: string): string | undefined { return undefined; }\n\taddEventListener(event: string): void { }\n\tremoveEventListener(event: string): void { }\n}\n\nexport interface TestCodeEditorCreationOptions extends editorOptions.IEditorOptions {\n\t/**\n\t * If the editor has text focus.\n\t * Defaults to true.\n\t */\n\thasTextFocus?: boolean;\n\t/**\n\t * Env configuration\n\t */\n\tenvConfig?: ITestEnvConfiguration;\n}\n\nexport interface TestCodeEditorInstantiationOptions extends TestCodeEditorCreationOptions {\n\t/**\n\t * Services to use.\n\t */\n\tserviceCollection?: ServiceCollection;\n}\n\nexport interface ITestEnvConfiguration {\n\textraEditorClassName?: string;\n\touterWidth?: number;\n\touterHeight?: number;\n\temptySelectionClipboard?: boolean;\n\tpixelRatio?: number;\n\taccessibilitySupport?: AccessibilitySupport;\n}\n\nexport function withTestCodeEditor(text: ITextModel | string | string[] | ITextBufferFactory, options: TestCodeEditorInstantiationOptions, callback: (editor: ITestCodeEditor, viewModel: ViewModel, instantiationService: TestInstantiationService) => void): void {\n\treturn _withTestCodeEditor(text, options, callback);\n}\n\nexport async function withAsyncTestCodeEditor(text: ITextModel | string | string[] | ITextBufferFactory, options: TestCodeEditorInstantiationOptions, callback: (editor: ITestCodeEditor, viewModel: ViewModel, instantiationService: TestInstantiationService) => Promise<void>): Promise<void> {\n\treturn _withTestCodeEditor(text, options, callback);\n}\n\nfunction isTextModel(arg: ITextModel | string | string[] | ITextBufferFactory): arg is ITextModel {\n\treturn Boolean(arg && (arg as ITextModel).uri);\n}\n\nfunction _withTestCodeEditor(arg: ITextModel | string | string[] | ITextBufferFactory, options: TestCodeEditorInstantiationOptions, callback: (editor: ITestCodeEditor, viewModel: ViewModel, instantiationService: TestInstantiationService) => void): void;\nfunction _withTestCodeEditor(arg: ITextModel | string | string[] | ITextBufferFactory, options: TestCodeEditorInstantiationOptions, callback: (editor: ITestCodeEditor, viewModel: ViewModel, instantiationService: TestInstantiationService) => Promise<void>): Promise<void>;\nfunction _withTestCodeEditor(arg: ITextModel | string | string[] | ITextBufferFactory, options: TestCodeEditorInstantiationOptions, callback: (editor: ITestCodeEditor, viewModel: ViewModel, instantiationService: TestInstantiationService) => Promise<void> | void): Promise<void> | void {\n\tconst disposables = new DisposableStore();\n\tconst instantiationService = createCodeEditorServices(disposables, options.serviceCollection);\n\tdelete options.serviceCollection;\n\n\t// create a model if necessary\n\tlet model: ITextModel;\n\tif (isTextModel(arg)) {\n\t\tmodel = arg;\n\t} else {\n\t\tmodel = disposables.add(instantiateTextModel(instantiationService, Array.isArray(arg) ? arg.join('\\n') : arg));\n\t}\n\n\tconst editor = disposables.add(instantiateTestCodeEditor(instantiationService, model, options));\n\tconst viewModel = editor.getViewModel()!;\n\tviewModel.setHasFocus(true);\n\tconst result = callback(editor, editor.getViewModel()!, instantiationService);\n\tif (result) {\n\t\treturn result.then(() => disposables.dispose());\n\t}\n\n\tdisposables.dispose();\n}\n\nexport function createCodeEditorServices(disposables: Pick<DisposableStore, 'add'>, services: ServiceCollection = new ServiceCollection()): TestInstantiationService {\n\tconst serviceIdentifiers: ServiceIdentifier<any>[] = [];\n\tconst define = <T>(id: ServiceIdentifier<T>, ctor: new (...args: any[]) => T) => {\n\t\tif (!services.has(id)) {\n\t\t\tservices.set(id, new SyncDescriptor(ctor));\n\t\t}\n\t\tserviceIdentifiers.push(id);\n\t};\n\tconst defineInstance = <T>(id: ServiceIdentifier<T>, instance: T) => {\n\t\tif (!services.has(id)) {\n\t\t\tservices.set(id, instance);\n\t\t}\n\t\tserviceIdentifiers.push(id);\n\t};\n\n\tdefine(IAccessibilityService, TestAccessibilityService);\n\tdefine(IKeybindingService, MockKeybindingService);\n\tdefine(IClipboardService, TestClipboardService);\n\tdefine(IEditorWorkerService, TestEditorWorkerService);\n\tdefineInstance(IOpenerService, NullOpenerService);\n\tdefine(INotificationService, TestNotificationService);\n\tdefine(IDialogService, TestDialogService);\n\tdefine(IUndoRedoService, UndoRedoService);\n\tdefine(ILanguageService, LanguageService);\n\tdefine(ILanguageConfigurationService, TestLanguageConfigurationService);\n\tdefine(IConfigurationService, TestConfigurationService);\n\tdefine(ITextResourcePropertiesService, TestTextResourcePropertiesService);\n\tdefine(IThemeService, TestThemeService);\n\tdefine(ILogService, NullLogService);\n\tdefine(IModelService, ModelService);\n\tdefine(ICodeEditorService, TestCodeEditorService);\n\tdefine(IContextKeyService, MockContextKeyService);\n\tdefine(ICommandService, TestCommandService);\n\tdefine(ITelemetryService, NullTelemetryServiceShape);\n\tdefine(ILoggerService, NullLoggerService);\n\tdefine(IDataChannelService, NullDataChannelService);\n\tdefine(IEnvironmentService, class extends mock<IEnvironmentService>() {\n\t\tdeclare readonly _serviceBrand: undefined;\n\t\toverride isBuilt: boolean = true;\n\t\toverride isExtensionDevelopment: boolean = false;\n\t});\n\tdefine(ILanguageFeatureDebounceService, LanguageFeatureDebounceService);\n\tdefine(ILanguageFeaturesService, LanguageFeaturesService);\n\tdefine(ITreeSitterLibraryService, TestTreeSitterLibraryService);\n\tdefine(IInlineCompletionsService, InlineCompletionsService);\n\n\tconst instantiationService = disposables.add(new TestInstantiationService(services, true));\n\tdisposables.add(toDisposable(() => {\n\t\tfor (const id of serviceIdentifiers) {\n\t\t\tconst instanceOrDescriptor = services.get(id);\n\t\t\tif (typeof instanceOrDescriptor.dispose === 'function') {\n\t\t\t\tinstanceOrDescriptor.dispose();\n\t\t\t}\n\t\t}\n\t}));\n\treturn instantiationService;\n}\n\nexport function createTestCodeEditor(model: ITextModel | undefined, options: TestCodeEditorInstantiationOptions = {}): ITestCodeEditor {\n\tconst disposables = new DisposableStore();\n\tconst instantiationService = createCodeEditorServices(disposables, options.serviceCollection);\n\tdelete options.serviceCollection;\n\n\tconst editor = instantiateTestCodeEditor(instantiationService, model || null, options);\n\teditor.registerDisposable(disposables);\n\treturn editor;\n}\n\nexport function instantiateTestCodeEditor(instantiationService: IInstantiationService, model: ITextModel | null, options: TestCodeEditorCreationOptions = {}): ITestCodeEditor {\n\tconst codeEditorWidgetOptions: ICodeEditorWidgetOptions = {\n\t\tcontributions: []\n\t};\n\tconst editor = instantiationService.createInstance(\n\t\tTestCodeEditor,\n\t\t// eslint-disable-next-line local/code-no-any-casts\n\t\t<HTMLElement><any>new TestEditorDomElement(),\n\t\toptions,\n\t\tcodeEditorWidgetOptions\n\t);\n\tif (typeof options.hasTextFocus === 'undefined') {\n\t\toptions.hasTextFocus = true;\n\t}\n\teditor.setHasTextFocus(options.hasTextFocus);\n\teditor.setModel(model);\n\tconst viewModel = editor.getViewModel();\n\tviewModel?.setHasFocus(options.hasTextFocus);\n\treturn <ITestCodeEditor>editor;\n}\n"]}