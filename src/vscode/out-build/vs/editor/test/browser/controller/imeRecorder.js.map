{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/editor/test/browser/controller/imeRecorder.ts","vs/editor/test/browser/controller/imeRecorder.ts"],"names":[],"mappings":"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","file":"imeRecorder.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { DisposableStore, toDisposable } from '../../../../base/common/lifecycle.js';\nimport { IRecorded, IRecordedCompositionEvent, IRecordedEvent, IRecordedInputEvent, IRecordedKeyboardEvent, IRecordedTextareaState } from './imeRecordedTypes.js';\nimport * as browser from '../../../../base/browser/browser.js';\nimport * as platform from '../../../../base/common/platform.js';\nimport { mainWindow } from '../../../../base/browser/window.js';\nimport { TextAreaWrapper } from '../../../browser/controller/editContext/textArea/textAreaEditContextInput.js';\n\n(() => {\n\n\t// eslint-disable-next-line no-restricted-syntax\n\tconst startButton = <HTMLButtonElement>mainWindow.document.getElementById('startRecording')!;\n\t// eslint-disable-next-line no-restricted-syntax\n\tconst endButton = <HTMLButtonElement>mainWindow.document.getElementById('endRecording')!;\n\n\tlet inputarea: HTMLTextAreaElement;\n\tconst disposables = new DisposableStore();\n\tlet originTimeStamp = 0;\n\tlet recorded: IRecorded = {\n\t\tenv: null!,\n\t\tinitial: null!,\n\t\tevents: [],\n\t\tfinal: null!\n\t};\n\n\tconst readTextareaState = (): IRecordedTextareaState => {\n\t\treturn {\n\t\t\tselectionDirection: inputarea.selectionDirection,\n\t\t\tselectionEnd: inputarea.selectionEnd,\n\t\t\tselectionStart: inputarea.selectionStart,\n\t\t\tvalue: inputarea.value,\n\t\t};\n\t};\n\n\tstartButton.onclick = () => {\n\t\tdisposables.clear();\n\t\tstartTest();\n\t\toriginTimeStamp = 0;\n\t\trecorded = {\n\t\t\tenv: {\n\t\t\t\tOS: platform.OS,\n\t\t\t\tbrowser: {\n\t\t\t\t\tisAndroid: browser.isAndroid,\n\t\t\t\t\tisFirefox: browser.isFirefox,\n\t\t\t\t\tisChrome: browser.isChrome,\n\t\t\t\t\tisSafari: browser.isSafari\n\t\t\t\t}\n\t\t\t},\n\t\t\tinitial: readTextareaState(),\n\t\t\tevents: [],\n\t\t\tfinal: null!\n\t\t};\n\t};\n\tendButton.onclick = () => {\n\t\trecorded.final = readTextareaState();\n\t\tconsole.log(printRecordedData());\n\t};\n\n\tfunction printRecordedData() {\n\t\tconst lines = [];\n\t\tlines.push(`const recorded: IRecorded = {`);\n\t\tlines.push(`\\tenv: ${JSON.stringify(recorded.env)}, `);\n\t\tlines.push(`\\tinitial: ${printState(recorded.initial)}, `);\n\t\tlines.push(`\\tevents: [\\n\\t\\t${recorded.events.map(ev => printEvent(ev)).join(',\\n\\t\\t')}\\n\\t],`);\n\t\tlines.push(`\\tfinal: ${printState(recorded.final)},`);\n\t\tlines.push(`}`);\n\n\t\treturn lines.join('\\n');\n\n\t\tfunction printString(str: string) {\n\t\t\treturn str.replace(/\\\\/g, '\\\\\\\\').replace(/'/g, '\\\\\\'');\n\t\t}\n\t\tfunction printState(state: IRecordedTextareaState) {\n\t\t\treturn `{ value: '${printString(state.value)}', selectionStart: ${state.selectionStart}, selectionEnd: ${state.selectionEnd}, selectionDirection: '${state.selectionDirection}' }`;\n\t\t}\n\t\tfunction printEvent(ev: IRecordedEvent) {\n\t\t\tif (ev.type === 'keydown' || ev.type === 'keypress' || ev.type === 'keyup') {\n\t\t\t\treturn `{ timeStamp: ${ev.timeStamp.toFixed(2)}, state: ${printState(ev.state)}, type: '${ev.type}', altKey: ${ev.altKey}, charCode: ${ev.charCode}, code: '${ev.code}', ctrlKey: ${ev.ctrlKey}, isComposing: ${ev.isComposing}, key: '${ev.key}', keyCode: ${ev.keyCode}, location: ${ev.location}, metaKey: ${ev.metaKey}, repeat: ${ev.repeat}, shiftKey: ${ev.shiftKey} }`;\n\t\t\t}\n\t\t\tif (ev.type === 'compositionstart' || ev.type === 'compositionupdate' || ev.type === 'compositionend') {\n\t\t\t\treturn `{ timeStamp: ${ev.timeStamp.toFixed(2)}, state: ${printState(ev.state)}, type: '${ev.type}', data: '${printString(ev.data)}' }`;\n\t\t\t}\n\t\t\tif (ev.type === 'beforeinput' || ev.type === 'input') {\n\t\t\t\treturn `{ timeStamp: ${ev.timeStamp.toFixed(2)}, state: ${printState(ev.state)}, type: '${ev.type}', data: ${ev.data === null ? 'null' : `'${printString(ev.data)}'`}, inputType: '${ev.inputType}', isComposing: ${ev.isComposing} }`;\n\t\t\t}\n\t\t\treturn JSON.stringify(ev);\n\t\t}\n\t}\n\n\tfunction startTest() {\n\t\tinputarea = document.createElement('textarea');\n\t\tmainWindow.document.body.appendChild(inputarea);\n\t\tinputarea.focus();\n\t\tdisposables.add(toDisposable(() => {\n\t\t\tinputarea.remove();\n\t\t}));\n\t\tconst wrapper = disposables.add(new TextAreaWrapper(inputarea));\n\n\t\twrapper.setValue('', `aaaa`);\n\t\twrapper.setSelectionRange('', 2, 2);\n\n\t\tconst recordEvent = (e: IRecordedEvent) => {\n\t\t\trecorded.events.push(e);\n\t\t};\n\n\t\tconst recordKeyboardEvent = (e: KeyboardEvent): void => {\n\t\t\tif (e.type !== 'keydown' && e.type !== 'keypress' && e.type !== 'keyup') {\n\t\t\t\tthrow new Error(`Not supported!`);\n\t\t\t}\n\t\t\tif (originTimeStamp === 0) {\n\t\t\t\toriginTimeStamp = e.timeStamp;\n\t\t\t}\n\t\t\tconst ev: IRecordedKeyboardEvent = {\n\t\t\t\ttimeStamp: e.timeStamp - originTimeStamp,\n\t\t\t\tstate: readTextareaState(),\n\t\t\t\ttype: e.type,\n\t\t\t\taltKey: e.altKey,\n\t\t\t\tcharCode: e.charCode,\n\t\t\t\tcode: e.code,\n\t\t\t\tctrlKey: e.ctrlKey,\n\t\t\t\tisComposing: e.isComposing,\n\t\t\t\tkey: e.key,\n\t\t\t\tkeyCode: e.keyCode,\n\t\t\t\tlocation: e.location,\n\t\t\t\tmetaKey: e.metaKey,\n\t\t\t\trepeat: e.repeat,\n\t\t\t\tshiftKey: e.shiftKey\n\t\t\t};\n\t\t\trecordEvent(ev);\n\t\t};\n\n\t\tconst recordCompositionEvent = (e: CompositionEvent): void => {\n\t\t\tif (e.type !== 'compositionstart' && e.type !== 'compositionupdate' && e.type !== 'compositionend') {\n\t\t\t\tthrow new Error(`Not supported!`);\n\t\t\t}\n\t\t\tif (originTimeStamp === 0) {\n\t\t\t\toriginTimeStamp = e.timeStamp;\n\t\t\t}\n\t\t\tconst ev: IRecordedCompositionEvent = {\n\t\t\t\ttimeStamp: e.timeStamp - originTimeStamp,\n\t\t\t\tstate: readTextareaState(),\n\t\t\t\ttype: e.type,\n\t\t\t\tdata: e.data,\n\t\t\t};\n\t\t\trecordEvent(ev);\n\t\t};\n\n\t\tconst recordInputEvent = (e: InputEvent): void => {\n\t\t\tif (e.type !== 'beforeinput' && e.type !== 'input') {\n\t\t\t\tthrow new Error(`Not supported!`);\n\t\t\t}\n\t\t\tif (originTimeStamp === 0) {\n\t\t\t\toriginTimeStamp = e.timeStamp;\n\t\t\t}\n\t\t\tconst ev: IRecordedInputEvent = {\n\t\t\t\ttimeStamp: e.timeStamp - originTimeStamp,\n\t\t\t\tstate: readTextareaState(),\n\t\t\t\ttype: e.type,\n\t\t\t\tdata: e.data,\n\t\t\t\tinputType: e.inputType,\n\t\t\t\tisComposing: e.isComposing,\n\t\t\t};\n\t\t\trecordEvent(ev);\n\t\t};\n\n\t\twrapper.onKeyDown(recordKeyboardEvent);\n\t\twrapper.onKeyPress(recordKeyboardEvent);\n\t\twrapper.onKeyUp(recordKeyboardEvent);\n\t\twrapper.onCompositionStart(recordCompositionEvent);\n\t\twrapper.onCompositionUpdate(recordCompositionEvent);\n\t\twrapper.onCompositionEnd(recordCompositionEvent);\n\t\twrapper.onBeforeInput(recordInputEvent);\n\t\twrapper.onInput(recordInputEvent);\n\t}\n\n})();\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { DisposableStore, toDisposable } from '../../../../base/common/lifecycle.js';\nimport { IRecorded, IRecordedCompositionEvent, IRecordedEvent, IRecordedInputEvent, IRecordedKeyboardEvent, IRecordedTextareaState } from './imeRecordedTypes.js';\nimport * as browser from '../../../../base/browser/browser.js';\nimport * as platform from '../../../../base/common/platform.js';\nimport { mainWindow } from '../../../../base/browser/window.js';\nimport { TextAreaWrapper } from '../../../browser/controller/editContext/textArea/textAreaEditContextInput.js';\n\n(() => {\n\n\t// eslint-disable-next-line no-restricted-syntax\n\tconst startButton = <HTMLButtonElement>mainWindow.document.getElementById('startRecording')!;\n\t// eslint-disable-next-line no-restricted-syntax\n\tconst endButton = <HTMLButtonElement>mainWindow.document.getElementById('endRecording')!;\n\n\tlet inputarea: HTMLTextAreaElement;\n\tconst disposables = new DisposableStore();\n\tlet originTimeStamp = 0;\n\tlet recorded: IRecorded = {\n\t\tenv: null!,\n\t\tinitial: null!,\n\t\tevents: [],\n\t\tfinal: null!\n\t};\n\n\tconst readTextareaState = (): IRecordedTextareaState => {\n\t\treturn {\n\t\t\tselectionDirection: inputarea.selectionDirection,\n\t\t\tselectionEnd: inputarea.selectionEnd,\n\t\t\tselectionStart: inputarea.selectionStart,\n\t\t\tvalue: inputarea.value,\n\t\t};\n\t};\n\n\tstartButton.onclick = () => {\n\t\tdisposables.clear();\n\t\tstartTest();\n\t\toriginTimeStamp = 0;\n\t\trecorded = {\n\t\t\tenv: {\n\t\t\t\tOS: platform.OS,\n\t\t\t\tbrowser: {\n\t\t\t\t\tisAndroid: browser.isAndroid,\n\t\t\t\t\tisFirefox: browser.isFirefox,\n\t\t\t\t\tisChrome: browser.isChrome,\n\t\t\t\t\tisSafari: browser.isSafari\n\t\t\t\t}\n\t\t\t},\n\t\t\tinitial: readTextareaState(),\n\t\t\tevents: [],\n\t\t\tfinal: null!\n\t\t};\n\t};\n\tendButton.onclick = () => {\n\t\trecorded.final = readTextareaState();\n\t\tconsole.log(printRecordedData());\n\t};\n\n\tfunction printRecordedData() {\n\t\tconst lines = [];\n\t\tlines.push(`const recorded: IRecorded = {`);\n\t\tlines.push(`\\tenv: ${JSON.stringify(recorded.env)}, `);\n\t\tlines.push(`\\tinitial: ${printState(recorded.initial)}, `);\n\t\tlines.push(`\\tevents: [\\n\\t\\t${recorded.events.map(ev => printEvent(ev)).join(',\\n\\t\\t')}\\n\\t],`);\n\t\tlines.push(`\\tfinal: ${printState(recorded.final)},`);\n\t\tlines.push(`}`);\n\n\t\treturn lines.join('\\n');\n\n\t\tfunction printString(str: string) {\n\t\t\treturn str.replace(/\\\\/g, '\\\\\\\\').replace(/'/g, '\\\\\\'');\n\t\t}\n\t\tfunction printState(state: IRecordedTextareaState) {\n\t\t\treturn `{ value: '${printString(state.value)}', selectionStart: ${state.selectionStart}, selectionEnd: ${state.selectionEnd}, selectionDirection: '${state.selectionDirection}' }`;\n\t\t}\n\t\tfunction printEvent(ev: IRecordedEvent) {\n\t\t\tif (ev.type === 'keydown' || ev.type === 'keypress' || ev.type === 'keyup') {\n\t\t\t\treturn `{ timeStamp: ${ev.timeStamp.toFixed(2)}, state: ${printState(ev.state)}, type: '${ev.type}', altKey: ${ev.altKey}, charCode: ${ev.charCode}, code: '${ev.code}', ctrlKey: ${ev.ctrlKey}, isComposing: ${ev.isComposing}, key: '${ev.key}', keyCode: ${ev.keyCode}, location: ${ev.location}, metaKey: ${ev.metaKey}, repeat: ${ev.repeat}, shiftKey: ${ev.shiftKey} }`;\n\t\t\t}\n\t\t\tif (ev.type === 'compositionstart' || ev.type === 'compositionupdate' || ev.type === 'compositionend') {\n\t\t\t\treturn `{ timeStamp: ${ev.timeStamp.toFixed(2)}, state: ${printState(ev.state)}, type: '${ev.type}', data: '${printString(ev.data)}' }`;\n\t\t\t}\n\t\t\tif (ev.type === 'beforeinput' || ev.type === 'input') {\n\t\t\t\treturn `{ timeStamp: ${ev.timeStamp.toFixed(2)}, state: ${printState(ev.state)}, type: '${ev.type}', data: ${ev.data === null ? 'null' : `'${printString(ev.data)}'`}, inputType: '${ev.inputType}', isComposing: ${ev.isComposing} }`;\n\t\t\t}\n\t\t\treturn JSON.stringify(ev);\n\t\t}\n\t}\n\n\tfunction startTest() {\n\t\tinputarea = document.createElement('textarea');\n\t\tmainWindow.document.body.appendChild(inputarea);\n\t\tinputarea.focus();\n\t\tdisposables.add(toDisposable(() => {\n\t\t\tinputarea.remove();\n\t\t}));\n\t\tconst wrapper = disposables.add(new TextAreaWrapper(inputarea));\n\n\t\twrapper.setValue('', `aaaa`);\n\t\twrapper.setSelectionRange('', 2, 2);\n\n\t\tconst recordEvent = (e: IRecordedEvent) => {\n\t\t\trecorded.events.push(e);\n\t\t};\n\n\t\tconst recordKeyboardEvent = (e: KeyboardEvent): void => {\n\t\t\tif (e.type !== 'keydown' && e.type !== 'keypress' && e.type !== 'keyup') {\n\t\t\t\tthrow new Error(`Not supported!`);\n\t\t\t}\n\t\t\tif (originTimeStamp === 0) {\n\t\t\t\toriginTimeStamp = e.timeStamp;\n\t\t\t}\n\t\t\tconst ev: IRecordedKeyboardEvent = {\n\t\t\t\ttimeStamp: e.timeStamp - originTimeStamp,\n\t\t\t\tstate: readTextareaState(),\n\t\t\t\ttype: e.type,\n\t\t\t\taltKey: e.altKey,\n\t\t\t\tcharCode: e.charCode,\n\t\t\t\tcode: e.code,\n\t\t\t\tctrlKey: e.ctrlKey,\n\t\t\t\tisComposing: e.isComposing,\n\t\t\t\tkey: e.key,\n\t\t\t\tkeyCode: e.keyCode,\n\t\t\t\tlocation: e.location,\n\t\t\t\tmetaKey: e.metaKey,\n\t\t\t\trepeat: e.repeat,\n\t\t\t\tshiftKey: e.shiftKey\n\t\t\t};\n\t\t\trecordEvent(ev);\n\t\t};\n\n\t\tconst recordCompositionEvent = (e: CompositionEvent): void => {\n\t\t\tif (e.type !== 'compositionstart' && e.type !== 'compositionupdate' && e.type !== 'compositionend') {\n\t\t\t\tthrow new Error(`Not supported!`);\n\t\t\t}\n\t\t\tif (originTimeStamp === 0) {\n\t\t\t\toriginTimeStamp = e.timeStamp;\n\t\t\t}\n\t\t\tconst ev: IRecordedCompositionEvent = {\n\t\t\t\ttimeStamp: e.timeStamp - originTimeStamp,\n\t\t\t\tstate: readTextareaState(),\n\t\t\t\ttype: e.type,\n\t\t\t\tdata: e.data,\n\t\t\t};\n\t\t\trecordEvent(ev);\n\t\t};\n\n\t\tconst recordInputEvent = (e: InputEvent): void => {\n\t\t\tif (e.type !== 'beforeinput' && e.type !== 'input') {\n\t\t\t\tthrow new Error(`Not supported!`);\n\t\t\t}\n\t\t\tif (originTimeStamp === 0) {\n\t\t\t\toriginTimeStamp = e.timeStamp;\n\t\t\t}\n\t\t\tconst ev: IRecordedInputEvent = {\n\t\t\t\ttimeStamp: e.timeStamp - originTimeStamp,\n\t\t\t\tstate: readTextareaState(),\n\t\t\t\ttype: e.type,\n\t\t\t\tdata: e.data,\n\t\t\t\tinputType: e.inputType,\n\t\t\t\tisComposing: e.isComposing,\n\t\t\t};\n\t\t\trecordEvent(ev);\n\t\t};\n\n\t\twrapper.onKeyDown(recordKeyboardEvent);\n\t\twrapper.onKeyPress(recordKeyboardEvent);\n\t\twrapper.onKeyUp(recordKeyboardEvent);\n\t\twrapper.onCompositionStart(recordCompositionEvent);\n\t\twrapper.onCompositionUpdate(recordCompositionEvent);\n\t\twrapper.onCompositionEnd(recordCompositionEvent);\n\t\twrapper.onBeforeInput(recordInputEvent);\n\t\twrapper.onInput(recordInputEvent);\n\t}\n\n})();\n"]}