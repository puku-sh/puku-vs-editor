{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/editor/test/browser/gpu/atlas/textureAtlasAllocator.test.ts","vs/editor/test/browser/gpu/atlas/textureAtlasAllocator.test.ts"],"names":[],"mappings":"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","file":"textureAtlasAllocator.test.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { deepStrictEqual, strictEqual, throws } from 'assert';\nimport type { IRasterizedGlyph } from '../../../../browser/gpu/raster/raster.js';\nimport { ensureNonNullable } from '../../../../browser/gpu/gpuUtils.js';\nimport type { ITextureAtlasAllocator } from '../../../../browser/gpu/atlas/atlas.js';\nimport { TextureAtlasShelfAllocator } from '../../../../browser/gpu/atlas/textureAtlasShelfAllocator.js';\nimport { TextureAtlasSlabAllocator, type TextureAtlasSlabAllocatorOptions } from '../../../../browser/gpu/atlas/textureAtlasSlabAllocator.js';\nimport { ensureNoDisposablesAreLeakedInTestSuite } from '../../../../../base/test/common/utils.js';\nimport { assertIsValidGlyph } from './testUtil.js';\nimport { BugIndicatingError } from '../../../../../base/common/errors.js';\n\nconst blackArr = [0x00, 0x00, 0x00, 0xFF];\n\nconst pixel1x1 = createRasterizedGlyph(1, 1, [...blackArr]);\nconst pixel2x1 = createRasterizedGlyph(2, 1, [...blackArr, ...blackArr]);\nconst pixel1x2 = createRasterizedGlyph(1, 2, [...blackArr, ...blackArr]);\n\nfunction createRasterizedGlyph(w: number, h: number, data: ArrayLike<number>): IRasterizedGlyph {\n\tstrictEqual(w * h * 4, data.length);\n\tconst source = new OffscreenCanvas(w, h);\n\tconst imageData = new ImageData(w, h);\n\timageData.data.set(data);\n\tensureNonNullable(source.getContext('2d')).putImageData(imageData, 0, 0);\n\treturn {\n\t\tsource,\n\t\tboundingBox: { top: 0, left: 0, bottom: h - 1, right: w - 1 },\n\t\toriginOffset: { x: 0, y: 0 },\n\t\tfontBoundingBoxAscent: 0,\n\t\tfontBoundingBoxDescent: 0,\n\t};\n}\n\nfunction allocateAndAssert(allocator: ITextureAtlasAllocator, rasterizedGlyph: IRasterizedGlyph, expected: { x: number; y: number; w: number; h: number } | undefined): void {\n\tconst actual = allocator.allocate(rasterizedGlyph);\n\tif (!actual) {\n\t\tstrictEqual(actual, expected);\n\t\treturn;\n\t}\n\tdeepStrictEqual({\n\t\tx: actual.x,\n\t\ty: actual.y,\n\t\tw: actual.w,\n\t\th: actual.h,\n\t}, expected);\n}\n\nfunction initShelfAllocator(w: number, h: number): { canvas: OffscreenCanvas; allocator: TextureAtlasShelfAllocator } {\n\tconst canvas = new OffscreenCanvas(w, h);\n\tconst allocator = new TextureAtlasShelfAllocator(canvas, 0);\n\treturn { canvas, allocator };\n}\n\nfunction initSlabAllocator(w: number, h: number, options?: TextureAtlasSlabAllocatorOptions): { canvas: OffscreenCanvas; allocator: TextureAtlasSlabAllocator } {\n\tconst canvas = new OffscreenCanvas(w, h);\n\tconst allocator = new TextureAtlasSlabAllocator(canvas, 0, options);\n\treturn { canvas, allocator };\n}\n\nconst allocatorDefinitions: { name: string; initAllocator: (w: number, h: number) => { canvas: OffscreenCanvas; allocator: ITextureAtlasAllocator } }[] = [\n\t{ name: 'shelf', initAllocator: initShelfAllocator },\n\t{ name: 'slab', initAllocator: initSlabAllocator },\n];\n\nsuite('TextureAtlasAllocator', () => {\n\tensureNoDisposablesAreLeakedInTestSuite();\n\n\tsuite('shared tests', () => {\n\t\tfor (const { name, initAllocator } of allocatorDefinitions) {\n\t\t\ttest(`(${name}) single allocation`, () => {\n\t\t\t\tconst { canvas, allocator } = initAllocator(2, 2);\n\t\t\t\tassertIsValidGlyph(allocator.allocate(pixel1x1), canvas);\n\t\t\t});\n\t\t\t// Skipping because it fails unexpectedly on web only when asserting the error message\n\t\t\ttest.skip(`(${name}) glyph too large for canvas`, () => {\n\t\t\t\tconst { allocator } = initAllocator(1, 1);\n\t\t\t\tthrows(() => allocateAndAssert(allocator, pixel2x1, undefined), new BugIndicatingError('Glyph is too large for the atlas page'));\n\t\t\t});\n\t\t}\n\t});\n\n\tsuite('TextureAtlasShelfAllocator', () => {\n\t\tconst initAllocator = initShelfAllocator;\n\n\t\ttest('single allocation', () => {\n\t\t\tconst { allocator } = initAllocator(2, 2);\n\t\t\t// 1o\n\t\t\t// oo\n\t\t\tallocateAndAssert(allocator, pixel1x1, { x: 0, y: 0, w: 1, h: 1 });\n\t\t});\n\t\ttest('wrapping', () => {\n\t\t\tconst { allocator } = initAllocator(5, 4);\n\n\t\t\t// 1233o\n\t\t\t// o2ooo\n\t\t\t// ooooo\n\t\t\t// ooooo\n\t\t\tallocateAndAssert(allocator, pixel1x1, { x: 0, y: 0, w: 1, h: 1 });\n\t\t\tallocateAndAssert(allocator, pixel1x2, { x: 1, y: 0, w: 1, h: 2 });\n\t\t\tallocateAndAssert(allocator, pixel2x1, { x: 2, y: 0, w: 2, h: 1 });\n\n\t\t\t// 1233x\n\t\t\t// x2xxx\n\t\t\t// 44556\n\t\t\t// ooooo\n\t\t\tallocateAndAssert(allocator, pixel2x1, { x: 0, y: 2, w: 2, h: 1 });\n\t\t\tallocateAndAssert(allocator, pixel2x1, { x: 2, y: 2, w: 2, h: 1 });\n\t\t\tallocateAndAssert(allocator, pixel1x1, { x: 4, y: 2, w: 1, h: 1 });\n\n\t\t\t// 1233x\n\t\t\t// x2xxx\n\t\t\t// 44556\n\t\t\t// 7oooo\n\t\t\tallocateAndAssert(allocator, pixel1x1, { x: 0, y: 3, w: 1, h: 1 });\n\t\t});\n\t\ttest('full', () => {\n\t\t\tconst { allocator } = initAllocator(3, 2);\n\t\t\t// 122\n\t\t\t// 1oo\n\t\t\tallocateAndAssert(allocator, pixel1x2, { x: 0, y: 0, w: 1, h: 2 });\n\t\t\tallocateAndAssert(allocator, pixel2x1, { x: 1, y: 0, w: 2, h: 1 });\n\t\t\tallocateAndAssert(allocator, pixel1x1, undefined);\n\t\t});\n\t});\n\n\tsuite('TextureAtlasSlabAllocator', () => {\n\t\tconst initAllocator = initSlabAllocator;\n\n\t\ttest('single allocation', () => {\n\t\t\tconst { allocator } = initAllocator(2, 2);\n\t\t\t// 1o\n\t\t\t// oo\n\t\t\tallocateAndAssert(allocator, pixel1x1, { x: 0, y: 0, w: 1, h: 1 });\n\t\t});\n\n\t\ttest('single slab single glyph full', () => {\n\t\t\tconst { allocator } = initAllocator(1, 1, { slabW: 1, slabH: 1 });\n\n\t\t\t// 1\n\t\t\tallocateAndAssert(allocator, pixel1x1, { x: 0, y: 0, w: 1, h: 1 });\n\n\t\t\tallocateAndAssert(allocator, pixel1x1, undefined);\n\t\t});\n\n\t\ttest('single slab multiple glyph full', () => {\n\t\t\tconst { allocator } = initAllocator(2, 2, { slabW: 2, slabH: 2 });\n\n\t\t\t// 1\n\t\t\t// 1\n\t\t\tallocateAndAssert(allocator, pixel1x2, { x: 0, y: 0, w: 1, h: 2 });\n\t\t\tallocateAndAssert(allocator, pixel1x2, { x: 1, y: 0, w: 1, h: 2 });\n\n\t\t\tallocateAndAssert(allocator, pixel1x2, undefined);\n\t\t});\n\n\t\ttest('allocate 1x1 to multiple slabs until full', () => {\n\t\t\tconst { allocator } = initAllocator(4, 2, { slabW: 2, slabH: 2 });\n\n\t\t\t// 12│oo\n\t\t\t// 34│oo\n\t\t\tallocateAndAssert(allocator, pixel1x1, { x: 0, y: 0, w: 1, h: 1 });\n\t\t\tallocateAndAssert(allocator, pixel1x1, { x: 1, y: 0, w: 1, h: 1 });\n\t\t\tallocateAndAssert(allocator, pixel1x1, { x: 0, y: 1, w: 1, h: 1 });\n\t\t\tallocateAndAssert(allocator, pixel1x1, { x: 1, y: 1, w: 1, h: 1 });\n\n\t\t\t// 12│56\n\t\t\t// 34│78\n\t\t\tallocateAndAssert(allocator, pixel1x1, { x: 2, y: 0, w: 1, h: 1 });\n\t\t\tallocateAndAssert(allocator, pixel1x1, { x: 3, y: 0, w: 1, h: 1 });\n\t\t\tallocateAndAssert(allocator, pixel1x1, { x: 2, y: 1, w: 1, h: 1 });\n\t\t\tallocateAndAssert(allocator, pixel1x1, { x: 3, y: 1, w: 1, h: 1 });\n\n\t\t\tallocateAndAssert(allocator, pixel1x1, undefined);\n\t\t});\n\n\t\ttest('glyph too large for slab (increase slab size for first glyph)', () => {\n\t\t\tconst { allocator } = initAllocator(2, 2, { slabW: 1, slabH: 1 });\n\t\t\tallocateAndAssert(allocator, pixel2x1, { x: 0, y: 0, w: 2, h: 1 });\n\t\t});\n\n\t\ttest('glyph too large for slab (undefined as it\\'s not the first glyph)', () => {\n\t\t\tconst { allocator } = initAllocator(2, 2, { slabW: 1, slabH: 1 });\n\t\t\tallocateAndAssert(allocator, pixel1x1, { x: 0, y: 0, w: 1, h: 1 });\n\t\t\tallocateAndAssert(allocator, pixel2x1, undefined);\n\t\t});\n\n\t\ttest('separate slabs for different sized glyphs', () => {\n\t\t\tconst { allocator } = initAllocator(4, 2, { slabW: 2, slabH: 2 });\n\n\t\t\t// 10│2o\n\t\t\t// 00│2o\n\t\t\tallocateAndAssert(allocator, pixel1x1, { x: 0, y: 0, w: 1, h: 1 });\n\t\t\tallocateAndAssert(allocator, pixel1x2, { x: 2, y: 0, w: 1, h: 2 });\n\n\t\t\t// 14│23\n\t\t\t// 00│23\n\t\t\tallocateAndAssert(allocator, pixel1x2, { x: 3, y: 0, w: 1, h: 2 });\n\t\t\tallocateAndAssert(allocator, pixel1x1, { x: 1, y: 0, w: 1, h: 1 });\n\t\t});\n\t});\n});\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { deepStrictEqual, strictEqual, throws } from 'assert';\nimport type { IRasterizedGlyph } from '../../../../browser/gpu/raster/raster.js';\nimport { ensureNonNullable } from '../../../../browser/gpu/gpuUtils.js';\nimport type { ITextureAtlasAllocator } from '../../../../browser/gpu/atlas/atlas.js';\nimport { TextureAtlasShelfAllocator } from '../../../../browser/gpu/atlas/textureAtlasShelfAllocator.js';\nimport { TextureAtlasSlabAllocator, type TextureAtlasSlabAllocatorOptions } from '../../../../browser/gpu/atlas/textureAtlasSlabAllocator.js';\nimport { ensureNoDisposablesAreLeakedInTestSuite } from '../../../../../base/test/common/utils.js';\nimport { assertIsValidGlyph } from './testUtil.js';\nimport { BugIndicatingError } from '../../../../../base/common/errors.js';\n\nconst blackArr = [0x00, 0x00, 0x00, 0xFF];\n\nconst pixel1x1 = createRasterizedGlyph(1, 1, [...blackArr]);\nconst pixel2x1 = createRasterizedGlyph(2, 1, [...blackArr, ...blackArr]);\nconst pixel1x2 = createRasterizedGlyph(1, 2, [...blackArr, ...blackArr]);\n\nfunction createRasterizedGlyph(w: number, h: number, data: ArrayLike<number>): IRasterizedGlyph {\n\tstrictEqual(w * h * 4, data.length);\n\tconst source = new OffscreenCanvas(w, h);\n\tconst imageData = new ImageData(w, h);\n\timageData.data.set(data);\n\tensureNonNullable(source.getContext('2d')).putImageData(imageData, 0, 0);\n\treturn {\n\t\tsource,\n\t\tboundingBox: { top: 0, left: 0, bottom: h - 1, right: w - 1 },\n\t\toriginOffset: { x: 0, y: 0 },\n\t\tfontBoundingBoxAscent: 0,\n\t\tfontBoundingBoxDescent: 0,\n\t};\n}\n\nfunction allocateAndAssert(allocator: ITextureAtlasAllocator, rasterizedGlyph: IRasterizedGlyph, expected: { x: number; y: number; w: number; h: number } | undefined): void {\n\tconst actual = allocator.allocate(rasterizedGlyph);\n\tif (!actual) {\n\t\tstrictEqual(actual, expected);\n\t\treturn;\n\t}\n\tdeepStrictEqual({\n\t\tx: actual.x,\n\t\ty: actual.y,\n\t\tw: actual.w,\n\t\th: actual.h,\n\t}, expected);\n}\n\nfunction initShelfAllocator(w: number, h: number): { canvas: OffscreenCanvas; allocator: TextureAtlasShelfAllocator } {\n\tconst canvas = new OffscreenCanvas(w, h);\n\tconst allocator = new TextureAtlasShelfAllocator(canvas, 0);\n\treturn { canvas, allocator };\n}\n\nfunction initSlabAllocator(w: number, h: number, options?: TextureAtlasSlabAllocatorOptions): { canvas: OffscreenCanvas; allocator: TextureAtlasSlabAllocator } {\n\tconst canvas = new OffscreenCanvas(w, h);\n\tconst allocator = new TextureAtlasSlabAllocator(canvas, 0, options);\n\treturn { canvas, allocator };\n}\n\nconst allocatorDefinitions: { name: string; initAllocator: (w: number, h: number) => { canvas: OffscreenCanvas; allocator: ITextureAtlasAllocator } }[] = [\n\t{ name: 'shelf', initAllocator: initShelfAllocator },\n\t{ name: 'slab', initAllocator: initSlabAllocator },\n];\n\nsuite('TextureAtlasAllocator', () => {\n\tensureNoDisposablesAreLeakedInTestSuite();\n\n\tsuite('shared tests', () => {\n\t\tfor (const { name, initAllocator } of allocatorDefinitions) {\n\t\t\ttest(`(${name}) single allocation`, () => {\n\t\t\t\tconst { canvas, allocator } = initAllocator(2, 2);\n\t\t\t\tassertIsValidGlyph(allocator.allocate(pixel1x1), canvas);\n\t\t\t});\n\t\t\t// Skipping because it fails unexpectedly on web only when asserting the error message\n\t\t\ttest.skip(`(${name}) glyph too large for canvas`, () => {\n\t\t\t\tconst { allocator } = initAllocator(1, 1);\n\t\t\t\tthrows(() => allocateAndAssert(allocator, pixel2x1, undefined), new BugIndicatingError('Glyph is too large for the atlas page'));\n\t\t\t});\n\t\t}\n\t});\n\n\tsuite('TextureAtlasShelfAllocator', () => {\n\t\tconst initAllocator = initShelfAllocator;\n\n\t\ttest('single allocation', () => {\n\t\t\tconst { allocator } = initAllocator(2, 2);\n\t\t\t// 1o\n\t\t\t// oo\n\t\t\tallocateAndAssert(allocator, pixel1x1, { x: 0, y: 0, w: 1, h: 1 });\n\t\t});\n\t\ttest('wrapping', () => {\n\t\t\tconst { allocator } = initAllocator(5, 4);\n\n\t\t\t// 1233o\n\t\t\t// o2ooo\n\t\t\t// ooooo\n\t\t\t// ooooo\n\t\t\tallocateAndAssert(allocator, pixel1x1, { x: 0, y: 0, w: 1, h: 1 });\n\t\t\tallocateAndAssert(allocator, pixel1x2, { x: 1, y: 0, w: 1, h: 2 });\n\t\t\tallocateAndAssert(allocator, pixel2x1, { x: 2, y: 0, w: 2, h: 1 });\n\n\t\t\t// 1233x\n\t\t\t// x2xxx\n\t\t\t// 44556\n\t\t\t// ooooo\n\t\t\tallocateAndAssert(allocator, pixel2x1, { x: 0, y: 2, w: 2, h: 1 });\n\t\t\tallocateAndAssert(allocator, pixel2x1, { x: 2, y: 2, w: 2, h: 1 });\n\t\t\tallocateAndAssert(allocator, pixel1x1, { x: 4, y: 2, w: 1, h: 1 });\n\n\t\t\t// 1233x\n\t\t\t// x2xxx\n\t\t\t// 44556\n\t\t\t// 7oooo\n\t\t\tallocateAndAssert(allocator, pixel1x1, { x: 0, y: 3, w: 1, h: 1 });\n\t\t});\n\t\ttest('full', () => {\n\t\t\tconst { allocator } = initAllocator(3, 2);\n\t\t\t// 122\n\t\t\t// 1oo\n\t\t\tallocateAndAssert(allocator, pixel1x2, { x: 0, y: 0, w: 1, h: 2 });\n\t\t\tallocateAndAssert(allocator, pixel2x1, { x: 1, y: 0, w: 2, h: 1 });\n\t\t\tallocateAndAssert(allocator, pixel1x1, undefined);\n\t\t});\n\t});\n\n\tsuite('TextureAtlasSlabAllocator', () => {\n\t\tconst initAllocator = initSlabAllocator;\n\n\t\ttest('single allocation', () => {\n\t\t\tconst { allocator } = initAllocator(2, 2);\n\t\t\t// 1o\n\t\t\t// oo\n\t\t\tallocateAndAssert(allocator, pixel1x1, { x: 0, y: 0, w: 1, h: 1 });\n\t\t});\n\n\t\ttest('single slab single glyph full', () => {\n\t\t\tconst { allocator } = initAllocator(1, 1, { slabW: 1, slabH: 1 });\n\n\t\t\t// 1\n\t\t\tallocateAndAssert(allocator, pixel1x1, { x: 0, y: 0, w: 1, h: 1 });\n\n\t\t\tallocateAndAssert(allocator, pixel1x1, undefined);\n\t\t});\n\n\t\ttest('single slab multiple glyph full', () => {\n\t\t\tconst { allocator } = initAllocator(2, 2, { slabW: 2, slabH: 2 });\n\n\t\t\t// 1\n\t\t\t// 1\n\t\t\tallocateAndAssert(allocator, pixel1x2, { x: 0, y: 0, w: 1, h: 2 });\n\t\t\tallocateAndAssert(allocator, pixel1x2, { x: 1, y: 0, w: 1, h: 2 });\n\n\t\t\tallocateAndAssert(allocator, pixel1x2, undefined);\n\t\t});\n\n\t\ttest('allocate 1x1 to multiple slabs until full', () => {\n\t\t\tconst { allocator } = initAllocator(4, 2, { slabW: 2, slabH: 2 });\n\n\t\t\t// 12│oo\n\t\t\t// 34│oo\n\t\t\tallocateAndAssert(allocator, pixel1x1, { x: 0, y: 0, w: 1, h: 1 });\n\t\t\tallocateAndAssert(allocator, pixel1x1, { x: 1, y: 0, w: 1, h: 1 });\n\t\t\tallocateAndAssert(allocator, pixel1x1, { x: 0, y: 1, w: 1, h: 1 });\n\t\t\tallocateAndAssert(allocator, pixel1x1, { x: 1, y: 1, w: 1, h: 1 });\n\n\t\t\t// 12│56\n\t\t\t// 34│78\n\t\t\tallocateAndAssert(allocator, pixel1x1, { x: 2, y: 0, w: 1, h: 1 });\n\t\t\tallocateAndAssert(allocator, pixel1x1, { x: 3, y: 0, w: 1, h: 1 });\n\t\t\tallocateAndAssert(allocator, pixel1x1, { x: 2, y: 1, w: 1, h: 1 });\n\t\t\tallocateAndAssert(allocator, pixel1x1, { x: 3, y: 1, w: 1, h: 1 });\n\n\t\t\tallocateAndAssert(allocator, pixel1x1, undefined);\n\t\t});\n\n\t\ttest('glyph too large for slab (increase slab size for first glyph)', () => {\n\t\t\tconst { allocator } = initAllocator(2, 2, { slabW: 1, slabH: 1 });\n\t\t\tallocateAndAssert(allocator, pixel2x1, { x: 0, y: 0, w: 2, h: 1 });\n\t\t});\n\n\t\ttest('glyph too large for slab (undefined as it\\'s not the first glyph)', () => {\n\t\t\tconst { allocator } = initAllocator(2, 2, { slabW: 1, slabH: 1 });\n\t\t\tallocateAndAssert(allocator, pixel1x1, { x: 0, y: 0, w: 1, h: 1 });\n\t\t\tallocateAndAssert(allocator, pixel2x1, undefined);\n\t\t});\n\n\t\ttest('separate slabs for different sized glyphs', () => {\n\t\t\tconst { allocator } = initAllocator(4, 2, { slabW: 2, slabH: 2 });\n\n\t\t\t// 10│2o\n\t\t\t// 00│2o\n\t\t\tallocateAndAssert(allocator, pixel1x1, { x: 0, y: 0, w: 1, h: 1 });\n\t\t\tallocateAndAssert(allocator, pixel1x2, { x: 2, y: 0, w: 1, h: 2 });\n\n\t\t\t// 14│23\n\t\t\t// 00│23\n\t\t\tallocateAndAssert(allocator, pixel1x2, { x: 3, y: 0, w: 1, h: 2 });\n\t\t\tallocateAndAssert(allocator, pixel1x1, { x: 1, y: 0, w: 1, h: 1 });\n\t\t});\n\t});\n});\n"]}