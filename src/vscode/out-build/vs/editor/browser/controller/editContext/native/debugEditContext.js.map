{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/editor/browser/controller/editContext/native/debugEditContext.ts","vs/editor/browser/controller/editContext/native/debugEditContext.ts"],"names":[],"mappings":"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","file":"debugEditContext.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { EditContext } from './editContextFactory.js';\n\nconst COLOR_FOR_CONTROL_BOUNDS = 'blue';\nconst COLOR_FOR_SELECTION_BOUNDS = 'red';\nconst COLOR_FOR_CHARACTER_BOUNDS = 'green';\n\nexport class DebugEditContext {\n\tprivate _isDebugging = true;\n\tprivate _controlBounds: DOMRect | null = null;\n\tprivate _selectionBounds: DOMRect | null = null;\n\tprivate _characterBounds: { rangeStart: number; characterBounds: DOMRect[] } | null = null;\n\n\tprivate _editContext: EditContext;\n\n\tconstructor(window: Window, options?: EditContextInit | undefined) {\n\t\tthis._editContext = EditContext.create(window, options);\n\t}\n\n\tget text(): DOMString {\n\t\treturn this._editContext.text;\n\t}\n\n\tget selectionStart(): number {\n\t\treturn this._editContext.selectionStart;\n\t}\n\n\tget selectionEnd(): number {\n\t\treturn this._editContext.selectionEnd;\n\t}\n\n\tget characterBoundsRangeStart(): number {\n\t\treturn this._editContext.characterBoundsRangeStart;\n\t}\n\n\tupdateText(rangeStart: number, rangeEnd: number, text: string): void {\n\t\tthis._editContext.updateText(rangeStart, rangeEnd, text);\n\t\tthis.renderDebug();\n\t}\n\tupdateSelection(start: number, end: number): void {\n\t\tthis._editContext.updateSelection(start, end);\n\t\tthis.renderDebug();\n\t}\n\tupdateControlBounds(controlBounds: DOMRect): void {\n\t\tthis._editContext.updateControlBounds(controlBounds);\n\t\tthis._controlBounds = controlBounds;\n\t\tthis.renderDebug();\n\t}\n\tupdateSelectionBounds(selectionBounds: DOMRect): void {\n\t\tthis._editContext.updateSelectionBounds(selectionBounds);\n\t\tthis._selectionBounds = selectionBounds;\n\t\tthis.renderDebug();\n\t}\n\tupdateCharacterBounds(rangeStart: number, characterBounds: DOMRect[]): void {\n\t\tthis._editContext.updateCharacterBounds(rangeStart, characterBounds);\n\t\tthis._characterBounds = { rangeStart, characterBounds };\n\t\tthis.renderDebug();\n\t}\n\tattachedElements(): HTMLElement[] {\n\t\treturn this._editContext.attachedElements();\n\t}\n\n\tcharacterBounds(): DOMRect[] {\n\t\treturn this._editContext.characterBounds();\n\t}\n\n\tprivate readonly _ontextupdateWrapper = new EventListenerWrapper('textupdate', this);\n\tprivate readonly _ontextformatupdateWrapper = new EventListenerWrapper('textformatupdate', this);\n\tprivate readonly _oncharacterboundsupdateWrapper = new EventListenerWrapper('characterboundsupdate', this);\n\tprivate readonly _oncompositionstartWrapper = new EventListenerWrapper('compositionstart', this);\n\tprivate readonly _oncompositionendWrapper = new EventListenerWrapper('compositionend', this);\n\n\tget ontextupdate(): EventHandler | null { return this._ontextupdateWrapper.eventHandler; }\n\tset ontextupdate(value: EventHandler | null) { this._ontextupdateWrapper.eventHandler = value; }\n\tget ontextformatupdate(): EventHandler | null { return this._ontextformatupdateWrapper.eventHandler; }\n\tset ontextformatupdate(value: EventHandler | null) { this._ontextformatupdateWrapper.eventHandler = value; }\n\tget oncharacterboundsupdate(): EventHandler | null { return this._oncharacterboundsupdateWrapper.eventHandler; }\n\tset oncharacterboundsupdate(value: EventHandler | null) { this._oncharacterboundsupdateWrapper.eventHandler = value; }\n\tget oncompositionstart(): EventHandler | null { return this._oncompositionstartWrapper.eventHandler; }\n\tset oncompositionstart(value: EventHandler | null) { this._oncompositionstartWrapper.eventHandler = value; }\n\tget oncompositionend(): EventHandler | null { return this._oncompositionendWrapper.eventHandler; }\n\tset oncompositionend(value: EventHandler | null) { this._oncompositionendWrapper.eventHandler = value; }\n\n\n\tprivate readonly _listenerMap = new Map<EventListenerOrEventListenerObject, EventListenerOrEventListenerObject>();\n\n\taddEventListener<K extends keyof EditContextEventHandlersEventMap>(type: K, listener: (this: GlobalEventHandlers, ev: EditContextEventHandlersEventMap[K]) => void, options?: boolean | AddEventListenerOptions): void;\n\taddEventListener(type: string, listener: EventListenerOrEventListenerObject, options?: boolean | AddEventListenerOptions): void {\n\t\tif (!listener) { return; }\n\n\t\tconst debugListener = (event: Event) => {\n\t\t\tif (this._isDebugging) {\n\t\t\t\tthis.renderDebug();\n\t\t\t\tconsole.log(`DebugEditContex.on_${type}`, event);\n\t\t\t}\n\t\t\tif (typeof listener === 'function') {\n\t\t\t\tlistener.call(this, event);\n\t\t\t} else if (typeof listener === 'object' && 'handleEvent' in listener) {\n\t\t\t\tlistener.handleEvent(event);\n\t\t\t}\n\t\t};\n\t\tthis._listenerMap.set(listener, debugListener);\n\t\tthis._editContext.addEventListener(type, debugListener, options);\n\t\tthis.renderDebug();\n\t}\n\n\tremoveEventListener(type: string, listener: EventListenerOrEventListenerObject | null, options?: boolean | EventListenerOptions | undefined): void {\n\t\tif (!listener) { return; }\n\t\tconst debugListener = this._listenerMap.get(listener);\n\t\tif (debugListener) {\n\t\t\tthis._editContext.removeEventListener(type, debugListener, options);\n\t\t\tthis._listenerMap.delete(listener);\n\t\t}\n\t\tthis.renderDebug();\n\t}\n\n\tdispatchEvent(event: Event): boolean {\n\t\treturn this._editContext.dispatchEvent(event);\n\t}\n\n\tpublic startDebugging() {\n\t\tthis._isDebugging = true;\n\t\tthis.renderDebug();\n\t}\n\n\tpublic endDebugging() {\n\t\tthis._isDebugging = false;\n\t\tthis.renderDebug();\n\t}\n\n\tprivate _disposables: { dispose(): void }[] = [];\n\n\tpublic renderDebug() {\n\t\tthis._disposables.forEach(d => d.dispose());\n\t\tthis._disposables = [];\n\t\tif (!this._isDebugging || this._listenerMap.size === 0) {\n\t\t\treturn;\n\t\t}\n\t\tif (this._controlBounds) {\n\t\t\tthis._disposables.push(createRect(this._controlBounds, COLOR_FOR_CONTROL_BOUNDS));\n\t\t}\n\t\tif (this._selectionBounds) {\n\t\t\tthis._disposables.push(createRect(this._selectionBounds, COLOR_FOR_SELECTION_BOUNDS));\n\t\t}\n\t\tif (this._characterBounds) {\n\t\t\tfor (const rect of this._characterBounds.characterBounds) {\n\t\t\t\tthis._disposables.push(createRect(rect, COLOR_FOR_CHARACTER_BOUNDS));\n\t\t\t}\n\t\t}\n\t\tthis._disposables.push(createDiv(this._editContext.text, this._editContext.selectionStart, this._editContext.selectionEnd));\n\t}\n}\n\nfunction createDiv(text: string, selectionStart: number, selectionEnd: number) {\n\tconst ret = document.createElement('div');\n\tret.className = 'debug-rect-marker';\n\tret.style.position = 'absolute';\n\tret.style.zIndex = '999999999';\n\tret.style.bottom = '50px';\n\tret.style.left = '60px';\n\tret.style.backgroundColor = 'white';\n\tret.style.border = '1px solid black';\n\tret.style.padding = '5px';\n\tret.style.whiteSpace = 'pre';\n\tret.style.font = '12px monospace';\n\tret.style.pointerEvents = 'none';\n\n\tconst before = text.substring(0, selectionStart);\n\tconst selected = text.substring(selectionStart, selectionEnd) || '|';\n\tconst after = text.substring(selectionEnd) + ' ';\n\n\tconst beforeNode = document.createTextNode(before);\n\tret.appendChild(beforeNode);\n\n\tconst selectedNode = document.createElement('span');\n\tselectedNode.style.backgroundColor = 'yellow';\n\tselectedNode.appendChild(document.createTextNode(selected));\n\n\tselectedNode.style.minWidth = '2px';\n\tselectedNode.style.minHeight = '16px';\n\tret.appendChild(selectedNode);\n\n\tconst afterNode = document.createTextNode(after);\n\tret.appendChild(afterNode);\n\n\t// eslint-disable-next-line no-restricted-syntax\n\tdocument.body.appendChild(ret);\n\n\treturn {\n\t\tdispose: () => {\n\t\t\tret.remove();\n\t\t}\n\t};\n}\n\nfunction createRect(rect: DOMRect, color: 'green' | 'blue' | 'red') {\n\tconst ret = document.createElement('div');\n\tret.className = 'debug-rect-marker';\n\tret.style.position = 'absolute';\n\tret.style.zIndex = '999999999';\n\tret.style.outline = `2px solid ${color}`;\n\tret.style.pointerEvents = 'none';\n\n\tret.style.top = rect.top + 'px';\n\tret.style.left = rect.left + 'px';\n\tret.style.width = rect.width + 'px';\n\tret.style.height = rect.height + 'px';\n\n\t// eslint-disable-next-line no-restricted-syntax\n\tdocument.body.appendChild(ret);\n\n\treturn {\n\t\tdispose: () => {\n\t\t\tret.remove();\n\t\t}\n\t};\n}\n\nclass EventListenerWrapper {\n\tprivate _eventHandler: EventHandler | null = null;\n\n\tconstructor(\n\t\tprivate readonly _eventType: string,\n\t\tprivate readonly _target: EventTarget,\n\t) {\n\t}\n\n\tget eventHandler(): EventHandler | null {\n\t\treturn this._eventHandler;\n\t}\n\n\tset eventHandler(value: EventHandler | null) {\n\t\tif (this._eventHandler) {\n\t\t\tthis._target.removeEventListener(this._eventType, this._eventHandler);\n\t\t}\n\t\tthis._eventHandler = value;\n\t\tif (value) {\n\t\t\tthis._target.addEventListener(this._eventType, value);\n\t\t}\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { EditContext } from './editContextFactory.js';\n\nconst COLOR_FOR_CONTROL_BOUNDS = 'blue';\nconst COLOR_FOR_SELECTION_BOUNDS = 'red';\nconst COLOR_FOR_CHARACTER_BOUNDS = 'green';\n\nexport class DebugEditContext {\n\tprivate _isDebugging = true;\n\tprivate _controlBounds: DOMRect | null = null;\n\tprivate _selectionBounds: DOMRect | null = null;\n\tprivate _characterBounds: { rangeStart: number; characterBounds: DOMRect[] } | null = null;\n\n\tprivate _editContext: EditContext;\n\n\tconstructor(window: Window, options?: EditContextInit | undefined) {\n\t\tthis._editContext = EditContext.create(window, options);\n\t}\n\n\tget text(): DOMString {\n\t\treturn this._editContext.text;\n\t}\n\n\tget selectionStart(): number {\n\t\treturn this._editContext.selectionStart;\n\t}\n\n\tget selectionEnd(): number {\n\t\treturn this._editContext.selectionEnd;\n\t}\n\n\tget characterBoundsRangeStart(): number {\n\t\treturn this._editContext.characterBoundsRangeStart;\n\t}\n\n\tupdateText(rangeStart: number, rangeEnd: number, text: string): void {\n\t\tthis._editContext.updateText(rangeStart, rangeEnd, text);\n\t\tthis.renderDebug();\n\t}\n\tupdateSelection(start: number, end: number): void {\n\t\tthis._editContext.updateSelection(start, end);\n\t\tthis.renderDebug();\n\t}\n\tupdateControlBounds(controlBounds: DOMRect): void {\n\t\tthis._editContext.updateControlBounds(controlBounds);\n\t\tthis._controlBounds = controlBounds;\n\t\tthis.renderDebug();\n\t}\n\tupdateSelectionBounds(selectionBounds: DOMRect): void {\n\t\tthis._editContext.updateSelectionBounds(selectionBounds);\n\t\tthis._selectionBounds = selectionBounds;\n\t\tthis.renderDebug();\n\t}\n\tupdateCharacterBounds(rangeStart: number, characterBounds: DOMRect[]): void {\n\t\tthis._editContext.updateCharacterBounds(rangeStart, characterBounds);\n\t\tthis._characterBounds = { rangeStart, characterBounds };\n\t\tthis.renderDebug();\n\t}\n\tattachedElements(): HTMLElement[] {\n\t\treturn this._editContext.attachedElements();\n\t}\n\n\tcharacterBounds(): DOMRect[] {\n\t\treturn this._editContext.characterBounds();\n\t}\n\n\tprivate readonly _ontextupdateWrapper = new EventListenerWrapper('textupdate', this);\n\tprivate readonly _ontextformatupdateWrapper = new EventListenerWrapper('textformatupdate', this);\n\tprivate readonly _oncharacterboundsupdateWrapper = new EventListenerWrapper('characterboundsupdate', this);\n\tprivate readonly _oncompositionstartWrapper = new EventListenerWrapper('compositionstart', this);\n\tprivate readonly _oncompositionendWrapper = new EventListenerWrapper('compositionend', this);\n\n\tget ontextupdate(): EventHandler | null { return this._ontextupdateWrapper.eventHandler; }\n\tset ontextupdate(value: EventHandler | null) { this._ontextupdateWrapper.eventHandler = value; }\n\tget ontextformatupdate(): EventHandler | null { return this._ontextformatupdateWrapper.eventHandler; }\n\tset ontextformatupdate(value: EventHandler | null) { this._ontextformatupdateWrapper.eventHandler = value; }\n\tget oncharacterboundsupdate(): EventHandler | null { return this._oncharacterboundsupdateWrapper.eventHandler; }\n\tset oncharacterboundsupdate(value: EventHandler | null) { this._oncharacterboundsupdateWrapper.eventHandler = value; }\n\tget oncompositionstart(): EventHandler | null { return this._oncompositionstartWrapper.eventHandler; }\n\tset oncompositionstart(value: EventHandler | null) { this._oncompositionstartWrapper.eventHandler = value; }\n\tget oncompositionend(): EventHandler | null { return this._oncompositionendWrapper.eventHandler; }\n\tset oncompositionend(value: EventHandler | null) { this._oncompositionendWrapper.eventHandler = value; }\n\n\n\tprivate readonly _listenerMap = new Map<EventListenerOrEventListenerObject, EventListenerOrEventListenerObject>();\n\n\taddEventListener<K extends keyof EditContextEventHandlersEventMap>(type: K, listener: (this: GlobalEventHandlers, ev: EditContextEventHandlersEventMap[K]) => void, options?: boolean | AddEventListenerOptions): void;\n\taddEventListener(type: string, listener: EventListenerOrEventListenerObject, options?: boolean | AddEventListenerOptions): void {\n\t\tif (!listener) { return; }\n\n\t\tconst debugListener = (event: Event) => {\n\t\t\tif (this._isDebugging) {\n\t\t\t\tthis.renderDebug();\n\t\t\t\tconsole.log(`DebugEditContex.on_${type}`, event);\n\t\t\t}\n\t\t\tif (typeof listener === 'function') {\n\t\t\t\tlistener.call(this, event);\n\t\t\t} else if (typeof listener === 'object' && 'handleEvent' in listener) {\n\t\t\t\tlistener.handleEvent(event);\n\t\t\t}\n\t\t};\n\t\tthis._listenerMap.set(listener, debugListener);\n\t\tthis._editContext.addEventListener(type, debugListener, options);\n\t\tthis.renderDebug();\n\t}\n\n\tremoveEventListener(type: string, listener: EventListenerOrEventListenerObject | null, options?: boolean | EventListenerOptions | undefined): void {\n\t\tif (!listener) { return; }\n\t\tconst debugListener = this._listenerMap.get(listener);\n\t\tif (debugListener) {\n\t\t\tthis._editContext.removeEventListener(type, debugListener, options);\n\t\t\tthis._listenerMap.delete(listener);\n\t\t}\n\t\tthis.renderDebug();\n\t}\n\n\tdispatchEvent(event: Event): boolean {\n\t\treturn this._editContext.dispatchEvent(event);\n\t}\n\n\tpublic startDebugging() {\n\t\tthis._isDebugging = true;\n\t\tthis.renderDebug();\n\t}\n\n\tpublic endDebugging() {\n\t\tthis._isDebugging = false;\n\t\tthis.renderDebug();\n\t}\n\n\tprivate _disposables: { dispose(): void }[] = [];\n\n\tpublic renderDebug() {\n\t\tthis._disposables.forEach(d => d.dispose());\n\t\tthis._disposables = [];\n\t\tif (!this._isDebugging || this._listenerMap.size === 0) {\n\t\t\treturn;\n\t\t}\n\t\tif (this._controlBounds) {\n\t\t\tthis._disposables.push(createRect(this._controlBounds, COLOR_FOR_CONTROL_BOUNDS));\n\t\t}\n\t\tif (this._selectionBounds) {\n\t\t\tthis._disposables.push(createRect(this._selectionBounds, COLOR_FOR_SELECTION_BOUNDS));\n\t\t}\n\t\tif (this._characterBounds) {\n\t\t\tfor (const rect of this._characterBounds.characterBounds) {\n\t\t\t\tthis._disposables.push(createRect(rect, COLOR_FOR_CHARACTER_BOUNDS));\n\t\t\t}\n\t\t}\n\t\tthis._disposables.push(createDiv(this._editContext.text, this._editContext.selectionStart, this._editContext.selectionEnd));\n\t}\n}\n\nfunction createDiv(text: string, selectionStart: number, selectionEnd: number) {\n\tconst ret = document.createElement('div');\n\tret.className = 'debug-rect-marker';\n\tret.style.position = 'absolute';\n\tret.style.zIndex = '999999999';\n\tret.style.bottom = '50px';\n\tret.style.left = '60px';\n\tret.style.backgroundColor = 'white';\n\tret.style.border = '1px solid black';\n\tret.style.padding = '5px';\n\tret.style.whiteSpace = 'pre';\n\tret.style.font = '12px monospace';\n\tret.style.pointerEvents = 'none';\n\n\tconst before = text.substring(0, selectionStart);\n\tconst selected = text.substring(selectionStart, selectionEnd) || '|';\n\tconst after = text.substring(selectionEnd) + ' ';\n\n\tconst beforeNode = document.createTextNode(before);\n\tret.appendChild(beforeNode);\n\n\tconst selectedNode = document.createElement('span');\n\tselectedNode.style.backgroundColor = 'yellow';\n\tselectedNode.appendChild(document.createTextNode(selected));\n\n\tselectedNode.style.minWidth = '2px';\n\tselectedNode.style.minHeight = '16px';\n\tret.appendChild(selectedNode);\n\n\tconst afterNode = document.createTextNode(after);\n\tret.appendChild(afterNode);\n\n\t// eslint-disable-next-line no-restricted-syntax\n\tdocument.body.appendChild(ret);\n\n\treturn {\n\t\tdispose: () => {\n\t\t\tret.remove();\n\t\t}\n\t};\n}\n\nfunction createRect(rect: DOMRect, color: 'green' | 'blue' | 'red') {\n\tconst ret = document.createElement('div');\n\tret.className = 'debug-rect-marker';\n\tret.style.position = 'absolute';\n\tret.style.zIndex = '999999999';\n\tret.style.outline = `2px solid ${color}`;\n\tret.style.pointerEvents = 'none';\n\n\tret.style.top = rect.top + 'px';\n\tret.style.left = rect.left + 'px';\n\tret.style.width = rect.width + 'px';\n\tret.style.height = rect.height + 'px';\n\n\t// eslint-disable-next-line no-restricted-syntax\n\tdocument.body.appendChild(ret);\n\n\treturn {\n\t\tdispose: () => {\n\t\t\tret.remove();\n\t\t}\n\t};\n}\n\nclass EventListenerWrapper {\n\tprivate _eventHandler: EventHandler | null = null;\n\n\tconstructor(\n\t\tprivate readonly _eventType: string,\n\t\tprivate readonly _target: EventTarget,\n\t) {\n\t}\n\n\tget eventHandler(): EventHandler | null {\n\t\treturn this._eventHandler;\n\t}\n\n\tset eventHandler(value: EventHandler | null) {\n\t\tif (this._eventHandler) {\n\t\t\tthis._target.removeEventListener(this._eventType, this._eventHandler);\n\t\t}\n\t\tthis._eventHandler = value;\n\t\tif (value) {\n\t\t\tthis._target.addEventListener(this._eventType, value);\n\t\t}\n\t}\n}\n"]}