{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/code/browser/workbench/workbench.ts","vs/code/browser/workbench/workbench.ts"],"names":[],"mappings":"AAAA;;;gGAGgG;AAEhG,OAAO,EAAE,YAAY,EAAE,MAAM,kCAAkC,CAAC;AAChE,OAAO,EAAE,qBAAqB,EAAE,MAAM,8BAA8B,CAAC;AACrE,OAAO,EAAE,UAAU,EAAE,MAAM,iCAAiC,CAAC;AAC7D,OAAO,EAAE,QAAQ,EAAE,YAAY,EAAE,YAAY,EAAE,MAAM,gCAAgC,CAAC;AACtF,OAAO,EAAE,OAAO,EAAE,MAAM,+BAA+B,CAAC;AACxD,OAAO,EAAE,UAAU,EAAe,MAAM,mCAAmC,CAAC;AAC5E,OAAO,EAAE,KAAK,EAAE,MAAM,qCAAqC,CAAC;AAC5D,OAAO,EAAE,OAAO,EAAE,MAAM,iCAAiC,CAAC;AAC1D,OAAO,EAAE,KAAK,EAAE,MAAM,8BAA8B,CAAC;AACrD,OAAO,EAAE,OAAO,EAAE,MAAM,mCAAmC,CAAC;AAC5D,OAAO,EAAE,KAAK,EAAE,MAAM,iCAAiC,CAAC;AACxD,OAAO,EAAE,GAAG,EAAiB,MAAM,6BAA6B,CAAC;AACjE,OAAO,OAAO,MAAM,6CAA6C,CAAC;AAElE,OAAO,EAAE,cAAc,EAAE,iBAAiB,EAAE,MAAM,2CAA2C,CAAC;AAI9F,OAAO,EAAE,MAAM,EAAE,MAAM,mDAAmD,CAAC;AAO3E,MAAM,iBAAiB;IAEtB,KAAK,CAAC,IAAI,CAAC,IAAY;QACtB,OAAO,IAAI,CAAC;IACb,CAAC;IAED,KAAK,CAAC,MAAM,CAAC,IAAY;QACxB,OAAO,IAAI,CAAC;IACb,CAAC;CACD;AAED,IAAW,YAIV;AAJD,WAAW,YAAY;IACtB,qCAAqB,CAAA;IACrB,6DAAgB,CAAA;IAChB,0DAAc,CAAA;AACf,CAAC,EAJU,YAAY,KAAZ,YAAY,QAItB;AAED,MAAM,YAAa,SAAQ,KAAK;IAE/B,YAAY,KAAY;QACvB,KAAK,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC;QACrB,IAAI,CAAC,IAAI,GAAG,KAAK,CAAC,IAAI,CAAC;QACvB,IAAI,CAAC,KAAK,GAAG,KAAK,CAAC,KAAK,CAAC;IAC1B,CAAC;CACD;AAED,MAAM,oBAAoB;IAIzB;;OAEG;IACH,MAAM,CAAC,SAAS;QACf,OAAO,CAAC,CAAC,MAAM,CAAC,MAAM,CAAC;IACxB,CAAC;IAED,YAA6B,YAAoB;QAApB,iBAAY,GAAZ,YAAY,CAAQ;IAAI,CAAC;IAEtD,KAAK,CAAC,IAAI,CAAC,IAAY;QACtB,2GAA2G;QAC3G,uFAAuF;QACvF,MAAM,EAAE,GAAG,UAAU,CAAC,MAAM,CAAC,eAAe,CAAC,IAAI,UAAU,iCAAwB,CAAC,CAAC;QACrF,kJAAkJ;QAClJ,MAAM,YAAY,GAAG,MAAM,UAAU,CAAC,MAAM,CAAC,MAAM,CAAC,WAAW,CAC9D,EAAE,IAAI,EAAE,sCAA+B,EAAE,MAAM,EAAE,iCAAgC,EAAE,EACnF,IAAI,EACJ,CAAC,SAAS,EAAE,SAAS,CAAC,CACtB,CAAC;QAEF,MAAM,SAAS,GAAG,IAAI,UAAU,CAAC,MAAM,UAAU,CAAC,MAAM,CAAC,MAAM,CAAC,SAAS,CAAC,KAAK,EAAE,YAAY,CAAC,CAAC,CAAC;QAChG,MAAM,GAAG,GAAG,MAAM,IAAI,CAAC,MAAM,CAAC,SAAS,CAAC,CAAC;QACzC,MAAM,cAAc,GAAG,IAAI,WAAW,EAAE,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC;QACtD,MAAM,UAAU,GAAgB,MAAM,UAAU,CAAC,MAAM,CAAC,MAAM,CAAC,OAAO,CACrE,EAAE,IAAI,EAAE,sCAA+B,EAAE,EAAE,EAAE,EAC7C,GAAG,EACH,cAAc,CACd,CAAC;QAEF,yFAAyF;QACzF,yDAAyD;QACzD,MAAM,MAAM,GAAG,IAAI,UAAU,CAAC,CAAC,GAAG,SAAS,EAAE,GAAG,EAAE,EAAE,GAAG,IAAI,UAAU,CAAC,UAAU,CAAC,CAAC,CAAC,CAAC;QACpF,OAAO,YAAY,CAAC,QAAQ,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC;IAC5C,CAAC;IAED,KAAK,CAAC,MAAM,CAAC,IAAY;QACxB,iJAAiJ;QACjJ,6GAA6G;QAC7G,MAAM,cAAc,GAAG,YAAY,CAAC,IAAI,CAAC,CAAC;QAE1C,IAAI,cAAc,CAAC,UAAU,GAAG,EAAE,EAAE,CAAC;YACpC,MAAM,KAAK,CAAC,qDAAqD,CAAC,CAAC;QACpE,CAAC;QAED,MAAM,SAAS,GAAG,oCAA0B,CAAC,CAAC;QAC9C,MAAM,SAAS,GAAG,cAAc,CAAC,KAAK,CAAC,CAAC,EAAE,SAAS,CAAC,CAAC;QACrD,MAAM,EAAE,GAAG,cAAc,CAAC,KAAK,CAAC,SAAS,EAAE,SAAS,kCAAyB,CAAC,CAAC;QAC/E,MAAM,UAAU,GAAG,cAAc,CAAC,KAAK,CAAC,SAAS,kCAAyB,CAAC,CAAC;QAE5E,iDAAiD;QACjD,MAAM,GAAG,GAAG,MAAM,IAAI,CAAC,MAAM,CAAC,SAAS,CAAC,MAAM,CAAC,CAAC;QAChD,MAAM,SAAS,GAAG,MAAM,UAAU,CAAC,MAAM,CAAC,MAAM,CAAC,OAAO,CACvD,EAAE,IAAI,EAAE,sCAA+B,EAAE,EAAE,EAAE,EAAE,CAAC,MAAiC,EAAE,EACnF,GAAG,EACH,UAAU,CAAC,MAAiC,CAC5C,CAAC;QAEF,OAAO,IAAI,WAAW,EAAE,CAAC,MAAM,CAAC,IAAI,UAAU,CAAC,SAAS,CAAC,CAAC,CAAC;IAC5D,CAAC;IAED;;;OAGG;IACK,KAAK,CAAC,MAAM,CAAC,SAAqB;QACzC,IAAI,CAAC,SAAS,IAAI,SAAS,CAAC,UAAU,KAAK,oCAA0B,CAAC,EAAE,CAAC;YACxE,MAAM,KAAK,CAAC,8BAA8B,CAAC,CAAC;QAC7C,CAAC;QAED,MAAM,SAAS,GAAG,MAAM,IAAI,CAAC,gBAAgB,EAAE,CAAC;QAChD,MAAM,OAAO,GAAG,IAAI,UAAU,CAAC,oCAA0B,CAAC,CAAC,CAAC;QAE5D,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,OAAO,CAAC,UAAU,EAAE,CAAC,EAAE,EAAE,CAAC;YAC7C,OAAO,CAAC,CAAC,CAAC,GAAG,SAAS,CAAC,CAAC,CAAC,GAAG,SAAS,CAAC,CAAC,CAAC,CAAC;QAC1C,CAAC;QAED,OAAO,UAAU,CAAC,MAAM,CAAC,MAAM,CAAC,SAAS,CACxC,KAAK,EACL,OAAO,EACP;YACC,IAAI,EAAE,sCAA+B;YACrC,MAAM,EAAE,iCAAgC;SACxC,EACD,IAAI,EACJ,CAAC,SAAS,EAAE,SAAS,CAAC,CACtB,CAAC;IACH,CAAC;IAEO,KAAK,CAAC,gBAAgB;QAC7B,IAAI,IAAI,CAAC,SAAS,EAAE,CAAC;YACpB,OAAO,IAAI,CAAC,SAAS,CAAC;QACvB,CAAC;QAED,IAAI,OAAO,GAAG,CAAC,CAAC;QAChB,IAAI,SAA4B,CAAC;QAEjC,OAAO,OAAO,IAAI,CAAC,EAAE,CAAC;YACrB,IAAI,CAAC;gBACJ,MAAM,GAAG,GAAG,MAAM,KAAK,CAAC,IAAI,CAAC,YAAY,EAAE,EAAE,WAAW,EAAE,SAAS,EAAE,MAAM,EAAE,MAAM,EAAE,CAAC,CAAC;gBACvF,IAAI,CAAC,GAAG,CAAC,EAAE,EAAE,CAAC;oBACb,MAAM,IAAI,KAAK,CAAC,GAAG,CAAC,UAAU,CAAC,CAAC;gBACjC,CAAC;gBAED,MAAM,SAAS,GAAG,IAAI,UAAU,CAAC,MAAM,GAAG,CAAC,WAAW,EAAE,CAAC,CAAC;gBAC1D,IAAI,SAAS,CAAC,UAAU,KAAK,oCAA0B,CAAC,EAAE,CAAC;oBAC1D,MAAM,KAAK,CAAC,0CAA0C,iCAAuB,YAAY,CAAC,CAAC;gBAC5F,CAAC;gBAED,IAAI,CAAC,SAAS,GAAG,SAAS,CAAC;gBAE3B,OAAO,IAAI,CAAC,SAAS,CAAC;YACvB,CAAC;YAAC,OAAO,CAAC,EAAE,CAAC;gBACZ,SAAS,GAAG,CAAC,YAAY,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,IAAI,KAAK,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,CAAC;gBAC1D,OAAO,EAAE,CAAC;gBAEV,sBAAsB;gBACtB,MAAM,IAAI,OAAO,CAAC,OAAO,CAAC,EAAE,CAAC,UAAU,CAAC,OAAO,EAAE,OAAO,GAAG,OAAO,GAAG,GAAG,CAAC,CAAC,CAAC;YAC5E,CAAC;QACF,CAAC;QAED,IAAI,SAAS,EAAE,CAAC;YACf,MAAM,IAAI,YAAY,CAAC,SAAS,CAAC,CAAC;QACnC,CAAC;QAED,MAAM,IAAI,KAAK,CAAC,eAAe,CAAC,CAAC;IAClC,CAAC;CACD;AAED,MAAM,OAAO,iCAAiC;IAQ7C,YACkB,MAA4B;QAA5B,WAAM,GAAN,MAAM,CAAsB;QAP7B,eAAU,GAAG,kBAAkB,CAAC;QAIjD,SAAI,GAA0C,WAAW,CAAC;QAKzD,IAAI,CAAC,cAAc,GAAG,IAAI,CAAC,IAAI,EAAE,CAAC;IACnC,CAAC;IAEO,KAAK,CAAC,IAAI;QACjB,MAAM,MAAM,GAAG,IAAI,CAAC,0BAA0B,EAAE,CAAC;QAEjD,MAAM,SAAS,GAAG,YAAY,CAAC,OAAO,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC;QACxD,IAAI,SAAS,EAAE,CAAC;YACf,IAAI,CAAC;gBACJ,MAAM,SAAS,GAAG,IAAI,CAAC,KAAK,CAAC,MAAM,IAAI,CAAC,MAAM,CAAC,MAAM,CAAC,SAAS,CAAC,CAAC,CAAC;gBAElE,OAAO,EAAE,GAAG,MAAM,EAAE,GAAG,SAAS,EAAE,CAAC;YACpC,CAAC;YAAC,OAAO,GAAG,EAAE,CAAC;gBACd,uBAAuB;gBACvB,OAAO,CAAC,KAAK,CAAC,6CAA6C,EAAE,GAAG,CAAC,CAAC;gBAClE,IAAI,CAAC,CAAC,GAAG,YAAY,YAAY,CAAC,EAAE,CAAC;oBACpC,YAAY,CAAC,UAAU,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC;gBAC1C,CAAC;YACF,CAAC;QACF,CAAC;QAED,OAAO,MAAM,CAAC;IACf,CAAC;IAEO,0BAA0B;QACjC,IAAI,eAAiF,CAAC;QACtF,gDAAgD;QAChD,MAAM,kBAAkB,GAAG,UAAU,CAAC,QAAQ,CAAC,cAAc,CAAC,+BAA+B,CAAC,CAAC;QAC/F,MAAM,2BAA2B,GAAG,kBAAkB,CAAC,CAAC,CAAC,kBAAkB,CAAC,YAAY,CAAC,eAAe,CAAC,CAAC,CAAC,CAAC,SAAS,CAAC;QACtH,IAAI,2BAA2B,EAAE,CAAC;YACjC,IAAI,CAAC;gBACJ,eAAe,GAAG,IAAI,CAAC,KAAK,CAAC,2BAA2B,CAAC,CAAC;YAC3D,CAAC;YAAC,OAAO,KAAK,EAAE,CAAC,CAAC,wCAAwC,CAAC,CAAC;QAC7D,CAAC;QAED,IAAI,CAAC,eAAe,EAAE,CAAC;YACtB,OAAO,EAAE,CAAC;QACX,CAAC;QAED,MAAM,MAAM,GAA2B,EAAE,CAAC;QAE1C,sBAAsB;QACtB,MAAM,CAAC,GAAG,OAAO,CAAC,WAAW,eAAe,CAAC,GAAG,IAAI,CAAC,SAAS,CAAC,eAAe,CAAC,CAAC;QAEhF,uBAAuB;QACvB,IAAI,eAAe,CAAC,UAAU,KAAK,QAAQ,EAAE,CAAC;YAC7C,OAAO,CAAC,KAAK,CAAC,6BAA6B,eAAe,CAAC,UAAU,sBAAsB,CAAC,CAAC;YAC7F,OAAO,MAAM,CAAC;QACf,CAAC;QAED,MAAM,WAAW,GAAG,IAAI,CAAC,SAAS,CAAC,EAAE,WAAW,EAAE,8BAA8B,EAAE,GAAG,EAAE,aAAa,EAAE,CAAC,CAAC;QACxG,MAAM,CAAC,WAAW,CAAC,GAAG,IAAI,CAAC,SAAS,CAAC,eAAe,CAAC,MAAM,CAAC,GAAG,CAAC,MAAM,CAAC,EAAE,CAAC,CAAC;YAC1E,EAAE,EAAE,eAAe,CAAC,EAAE;YACtB,MAAM;YACN,WAAW,EAAE,eAAe,CAAC,WAAW;SACxC,CAAC,CAAC,CAAC,CAAC;QAEL,OAAO,MAAM,CAAC;IACf,CAAC;IAED,KAAK,CAAC,GAAG,CAAC,GAAW;QACpB,MAAM,OAAO,GAAG,MAAM,IAAI,CAAC,cAAc,CAAC;QAE1C,OAAO,OAAO,CAAC,GAAG,CAAC,CAAC;IACrB,CAAC;IAED,KAAK,CAAC,GAAG,CAAC,GAAW,EAAE,KAAa;QACnC,MAAM,OAAO,GAAG,MAAM,IAAI,CAAC,cAAc,CAAC;QAC1C,OAAO,CAAC,GAAG,CAAC,GAAG,KAAK,CAAC;QACrB,IAAI,CAAC,cAAc,GAAG,OAAO,CAAC,OAAO,CAAC,OAAO,CAAC,CAAC;QAC/C,IAAI,CAAC,IAAI,EAAE,CAAC;IACb,CAAC;IAED,KAAK,CAAC,MAAM,CAAC,GAAW;QACvB,MAAM,OAAO,GAAG,MAAM,IAAI,CAAC,cAAc,CAAC;QAC1C,OAAO,OAAO,CAAC,GAAG,CAAC,CAAC;QACpB,IAAI,CAAC,cAAc,GAAG,OAAO,CAAC,OAAO,CAAC,OAAO,CAAC,CAAC;QAC/C,IAAI,CAAC,IAAI,EAAE,CAAC;IACb,CAAC;IAED,KAAK,CAAC,IAAI;QACT,MAAM,OAAO,GAAG,MAAM,IAAI,CAAC,cAAc,CAAC;QAC1C,OAAO,MAAM,CAAC,IAAI,CAAC,OAAO,CAAC,IAAI,EAAE,CAAC;IACnC,CAAC;IAEO,KAAK,CAAC,IAAI;QACjB,IAAI,CAAC;YACJ,MAAM,SAAS,GAAG,MAAM,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,SAAS,CAAC,MAAM,IAAI,CAAC,cAAc,CAAC,CAAC,CAAC;YACpF,YAAY,CAAC,OAAO,CAAC,IAAI,CAAC,UAAU,EAAE,SAAS,CAAC,CAAC;QAClD,CAAC;QAAC,OAAO,GAAG,EAAE,CAAC;YACd,OAAO,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC;QACpB,CAAC;IACF,CAAC;CACD;AAED,MAAM,+BAAgC,SAAQ,UAAU;aAExC,eAAU,GAAG,CAAH,AAAI,CAAC;aAEf,eAAU,GAA+D;QACvF,QAAQ;QACR,WAAW;QACX,MAAM;QACN,OAAO;QACP,UAAU;KALc,AAMxB,CAAC;IAUF,YAA6B,cAAsB;QAClD,KAAK,EAAE,CAAC;QADoB,mBAAc,GAAd,cAAc,CAAQ;QARlC,gBAAW,GAAG,IAAI,CAAC,SAAS,CAAC,IAAI,OAAO,EAAO,CAAC,CAAC;QACzD,eAAU,GAAG,IAAI,CAAC,WAAW,CAAC,KAAK,CAAC;QAErC,qBAAgB,GAAG,IAAI,GAAG,EAAU,CAAC;QACrC,oBAAe,GAAG,IAAI,CAAC,GAAG,EAAE,CAAC;QAC7B,0BAAqB,GAAwB,SAAS,CAAC;IAK/D,CAAC;IAED,MAAM,CAAC,UAAkC,EAAE;QAC1C,MAAM,EAAE,GAAG,EAAE,+BAA+B,CAAC,UAAU,CAAC;QACxD,MAAM,WAAW,GAAa,CAAC,gBAAgB,EAAE,EAAE,CAAC,CAAC;QAErD,KAAK,MAAM,GAAG,IAAI,+BAA+B,CAAC,UAAU,EAAE,CAAC;YAC9D,MAAM,KAAK,GAAG,OAAO,CAAC,GAAG,CAAC,CAAC;YAE3B,IAAI,KAAK,EAAE,CAAC;gBACX,WAAW,CAAC,IAAI,CAAC,UAAU,GAAG,IAAI,kBAAkB,CAAC,KAAK,CAAC,EAAE,CAAC,CAAC;YAChE,CAAC;QACF,CAAC;QAED,8BAA8B;QAC9B,oDAAoD;QACpD,iJAAiJ;QACjJ,IAAI,CAAC,CAAC,OAAO,CAAC,SAAS,KAAK,8BAA8B,IAAI,OAAO,CAAC,IAAI,KAAK,QAAQ,CAAC,EAAE,CAAC;YAC1F,MAAM,GAAG,GAAG,4BAA4B,EAAE,GAAG,CAAC;YAC9C,YAAY,CAAC,UAAU,CAAC,GAAG,CAAC,CAAC;YAE7B,IAAI,CAAC,gBAAgB,CAAC,GAAG,CAAC,EAAE,CAAC,CAAC;YAC9B,IAAI,CAAC,cAAc,EAAE,CAAC;QACvB,CAAC;QAED,OAAO,GAAG,CAAC,KAAK,CAAC,UAAU,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC,EAAE,IAAI,EAAE,IAAI,CAAC,cAAc,EAAE,KAAK,EAAE,WAAW,CAAC,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,CAAC;IAC9G,CAAC;IAEO,cAAc;QACrB,IAAI,IAAI,CAAC,iCAAiC,EAAE,CAAC;YAC5C,OAAO;QACR,CAAC;QAED,IAAI,CAAC,iCAAiC,GAAG,qBAAqB,CAAC,UAAU,EAAE,SAAS,EAAE,GAAG,EAAE,CAAC,IAAI,CAAC,uBAAuB,EAAE,CAAC,CAAC;IAC7H,CAAC;IAEO,aAAa;QACpB,IAAI,CAAC,iCAAiC,EAAE,OAAO,EAAE,CAAC;QAClD,IAAI,CAAC,iCAAiC,GAAG,SAAS,CAAC;IACpD,CAAC;IAED,sDAAsD;IACtD,oDAAoD;IAC5C,KAAK,CAAC,uBAAuB;QACpC,MAAM,QAAQ,GAAG,IAAI,CAAC,GAAG,EAAE,GAAG,IAAI,CAAC,eAAe,CAAC;QAEnD,IAAI,QAAQ,GAAG,IAAI,EAAE,CAAC;YACrB,IAAI,CAAC,cAAc,EAAE,CAAC;QACvB,CAAC;aAAM,IAAI,IAAI,CAAC,qBAAqB,KAAK,SAAS,EAAE,CAAC;YACrD,IAAI,CAAC,qBAAqB,GAAG,UAAU,CAAC,GAAG,EAAE;gBAC5C,IAAI,CAAC,qBAAqB,GAAG,SAAS,CAAC;gBACvC,IAAI,CAAC,cAAc,EAAE,CAAC;YACvB,CAAC,EAAE,IAAI,GAAG,QAAQ,CAAC,CAAC;QACrB,CAAC;IACF,CAAC;IAEO,cAAc;QACrB,IAAI,gBAAyC,CAAC;QAE9C,KAAK,MAAM,EAAE,IAAI,IAAI,CAAC,gBAAgB,EAAE,CAAC;YACxC,MAAM,GAAG,GAAG,4BAA4B,EAAE,GAAG,CAAC;YAC9C,MAAM,MAAM,GAAG,YAAY,CAAC,OAAO,CAAC,GAAG,CAAC,CAAC;YAEzC,IAAI,MAAM,KAAK,IAAI,EAAE,CAAC;gBACrB,IAAI,CAAC;oBACJ,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,GAAG,CAAC,MAAM,CAAC,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC;gBACvD,CAAC;gBAAC,OAAO,KAAK,EAAE,CAAC;oBAChB,OAAO,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC;gBACtB,CAAC;gBAED,gBAAgB,GAAG,gBAAgB,IAAI,IAAI,GAAG,CAAC,IAAI,CAAC,gBAAgB,CAAC,CAAC;gBACtE,gBAAgB,CAAC,MAAM,CAAC,EAAE,CAAC,CAAC;gBAC5B,YAAY,CAAC,UAAU,CAAC,GAAG,CAAC,CAAC;YAC9B,CAAC;QACF,CAAC;QAED,IAAI,gBAAgB,EAAE,CAAC;YACtB,IAAI,CAAC,gBAAgB,GAAG,gBAAgB,CAAC;YAEzC,IAAI,IAAI,CAAC,gBAAgB,CAAC,IAAI,KAAK,CAAC,EAAE,CAAC;gBACtC,IAAI,CAAC,aAAa,EAAE,CAAC;YACtB,CAAC;QACF,CAAC;QAED,IAAI,CAAC,eAAe,GAAG,IAAI,CAAC,GAAG,EAAE,CAAC;IACnC,CAAC;;AAGF,MAAM,iBAAiB;aAEP,6BAAwB,GAAG,IAAH,AAAO,CAAC;aAChC,uBAAkB,GAAG,QAAH,AAAW,CAAC;aAC9B,0BAAqB,GAAG,WAAH,AAAc,CAAC;aAEpC,wBAAmB,GAAG,SAAH,AAAY,CAAC;IAE/C,MAAM,CAAC,MAAM,CAAC,MAAmG;QAChH,IAAI,cAAc,GAAG,KAAK,CAAC;QAC3B,IAAI,SAAqB,CAAC;QAC1B,IAAI,OAAO,GAAG,MAAM,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC;QAElC,MAAM,KAAK,GAAG,IAAI,GAAG,CAAC,QAAQ,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAC,YAAY,CAAC;QAC3D,KAAK,CAAC,OAAO,CAAC,CAAC,KAAK,EAAE,GAAG,EAAE,EAAE;YAC5B,QAAQ,GAAG,EAAE,CAAC;gBAEb,SAAS;gBACT,KAAK,iBAAiB,CAAC,kBAAkB;oBACxC,IAAI,MAAM,CAAC,eAAe,IAAI,KAAK,CAAC,UAAU,CAAC,KAAK,CAAC,GAAG,CAAC,EAAE,CAAC;wBAC3D,gDAAgD;wBAChD,kDAAkD;wBAClD,iDAAiD;wBACjD,SAAS,GAAG,EAAE,SAAS,EAAE,GAAG,CAAC,IAAI,CAAC,EAAE,MAAM,EAAE,OAAO,CAAC,YAAY,EAAE,IAAI,EAAE,KAAK,EAAE,SAAS,EAAE,MAAM,CAAC,eAAe,EAAE,CAAC,EAAE,CAAC;oBACvH,CAAC;yBAAM,CAAC;wBACP,SAAS,GAAG,EAAE,SAAS,EAAE,GAAG,CAAC,KAAK,CAAC,KAAK,CAAC,EAAE,CAAC;oBAC7C,CAAC;oBACD,cAAc,GAAG,IAAI,CAAC;oBACtB,MAAM;gBAEP,YAAY;gBACZ,KAAK,iBAAiB,CAAC,qBAAqB;oBAC3C,IAAI,MAAM,CAAC,eAAe,IAAI,KAAK,CAAC,UAAU,CAAC,KAAK,CAAC,GAAG,CAAC,EAAE,CAAC;wBAC3D,gDAAgD;wBAChD,kDAAkD;wBAClD,iDAAiD;wBACjD,SAAS,GAAG,EAAE,YAAY,EAAE,GAAG,CAAC,IAAI,CAAC,EAAE,MAAM,EAAE,OAAO,CAAC,YAAY,EAAE,IAAI,EAAE,KAAK,EAAE,SAAS,EAAE,MAAM,CAAC,eAAe,EAAE,CAAC,EAAE,CAAC;oBAC1H,CAAC;yBAAM,CAAC;wBACP,SAAS,GAAG,EAAE,YAAY,EAAE,GAAG,CAAC,KAAK,CAAC,KAAK,CAAC,EAAE,CAAC;oBAChD,CAAC;oBACD,cAAc,GAAG,IAAI,CAAC;oBACtB,MAAM;gBAEP,QAAQ;gBACR,KAAK,iBAAiB,CAAC,wBAAwB;oBAC9C,SAAS,GAAG,SAAS,CAAC;oBACtB,cAAc,GAAG,IAAI,CAAC;oBACtB,MAAM;gBAEP,UAAU;gBACV,KAAK,iBAAiB,CAAC,mBAAmB;oBACzC,IAAI,CAAC;wBACJ,OAAO,GAAG,KAAK,CAAC,KAAK,CAAC,CAAC,CAAC,mDAAmD;oBAC5E,CAAC;oBAAC,OAAO,KAAK,EAAE,CAAC;wBAChB,OAAO,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC,CAAC,wBAAwB;oBAC/C,CAAC;oBACD,MAAM;YACR,CAAC;QACF,CAAC,CAAC,CAAC;QAEH,gEAAgE;QAChE,wBAAwB;QACxB,IAAI,CAAC,cAAc,EAAE,CAAC;YACrB,IAAI,MAAM,CAAC,SAAS,EAAE,CAAC;gBACtB,SAAS,GAAG,EAAE,SAAS,EAAE,GAAG,CAAC,MAAM,CAAC,MAAM,CAAC,SAAS,CAAC,EAAE,CAAC;YACzD,CAAC;iBAAM,IAAI,MAAM,CAAC,YAAY,EAAE,CAAC;gBAChC,SAAS,GAAG,EAAE,YAAY,EAAE,GAAG,CAAC,MAAM,CAAC,MAAM,CAAC,YAAY,CAAC,EAAE,CAAC;YAC/D,CAAC;QACF,CAAC;QAED,OAAO,IAAI,iBAAiB,CAAC,SAAS,EAAE,OAAO,EAAE,MAAM,CAAC,CAAC;IAC1D,CAAC;IAID,YACU,SAAqB,EACrB,OAAe,EACP,MAAqC;QAF7C,cAAS,GAAT,SAAS,CAAY;QACrB,YAAO,GAAP,OAAO,CAAQ;QACP,WAAM,GAAN,MAAM,CAA+B;QAL9C,YAAO,GAAG,IAAI,CAAC;IAOxB,CAAC;IAED,KAAK,CAAC,IAAI,CAAC,SAAqB,EAAE,OAA+C;QAChF,IAAI,OAAO,EAAE,KAAK,IAAI,CAAC,OAAO,CAAC,OAAO,IAAI,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,SAAS,EAAE,SAAS,CAAC,EAAE,CAAC;YAClF,OAAO,IAAI,CAAC,CAAC,sFAAsF;QACpG,CAAC;QAED,MAAM,UAAU,GAAG,IAAI,CAAC,eAAe,CAAC,SAAS,EAAE,OAAO,CAAC,CAAC;QAC5D,IAAI,UAAU,EAAE,CAAC;YAChB,IAAI,OAAO,EAAE,KAAK,EAAE,CAAC;gBACpB,UAAU,CAAC,QAAQ,CAAC,IAAI,GAAG,UAAU,CAAC;gBACtC,OAAO,IAAI,CAAC;YACb,CAAC;iBAAM,CAAC;gBACP,IAAI,MAAM,CAAC;gBACX,IAAI,YAAY,EAAE,EAAE,CAAC;oBACpB,MAAM,GAAG,UAAU,CAAC,IAAI,CAAC,UAAU,EAAE,QAAQ,EAAE,YAAY,CAAC,CAAC,CAAC,+CAA+C;gBAC9G,CAAC;qBAAM,CAAC;oBACP,MAAM,GAAG,UAAU,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC;gBACtC,CAAC;gBAED,OAAO,CAAC,CAAC,MAAM,CAAC;YACjB,CAAC;QACF,CAAC;QAED,OAAO,KAAK,CAAC;IACd,CAAC;IAEO,eAAe,CAAC,SAAqB,EAAE,OAA+C;QAE7F,QAAQ;QACR,IAAI,UAAU,GAAuB,SAAS,CAAC;QAC/C,IAAI,CAAC,SAAS,EAAE,CAAC;YAChB,UAAU,GAAG,GAAG,QAAQ,CAAC,QAAQ,CAAC,MAAM,GAAG,QAAQ,CAAC,QAAQ,CAAC,QAAQ,IAAI,iBAAiB,CAAC,wBAAwB,OAAO,CAAC;QAC5H,CAAC;QAED,SAAS;aACJ,IAAI,cAAc,CAAC,SAAS,CAAC,EAAE,CAAC;YACpC,MAAM,gBAAgB,GAAG,IAAI,CAAC,mBAAmB,CAAC,SAAS,CAAC,SAAS,CAAC,CAAC;YACvE,UAAU,GAAG,GAAG,QAAQ,CAAC,QAAQ,CAAC,MAAM,GAAG,QAAQ,CAAC,QAAQ,CAAC,QAAQ,IAAI,iBAAiB,CAAC,kBAAkB,IAAI,gBAAgB,EAAE,CAAC;QACrI,CAAC;QAED,YAAY;aACP,IAAI,iBAAiB,CAAC,SAAS,CAAC,EAAE,CAAC;YACvC,MAAM,mBAAmB,GAAG,IAAI,CAAC,mBAAmB,CAAC,SAAS,CAAC,YAAY,CAAC,CAAC;YAC7E,UAAU,GAAG,GAAG,QAAQ,CAAC,QAAQ,CAAC,MAAM,GAAG,QAAQ,CAAC,QAAQ,CAAC,QAAQ,IAAI,iBAAiB,CAAC,qBAAqB,IAAI,mBAAmB,EAAE,CAAC;QAC3I,CAAC;QAED,wBAAwB;QACxB,IAAI,OAAO,EAAE,OAAO,EAAE,CAAC;YACtB,UAAU,IAAI,IAAI,iBAAiB,CAAC,mBAAmB,IAAI,kBAAkB,CAAC,IAAI,CAAC,SAAS,CAAC,OAAO,CAAC,OAAO,CAAC,CAAC,EAAE,CAAC;QAClH,CAAC;QAED,OAAO,UAAU,CAAC;IACnB,CAAC;IAEO,mBAAmB,CAAC,GAAQ;QACnC,IAAI,IAAI,CAAC,MAAM,CAAC,eAAe,IAAI,GAAG,CAAC,MAAM,KAAK,OAAO,CAAC,YAAY,EAAE,CAAC;YAExE,iDAAiD;YACjD,kDAAkD;YAClD,8CAA8C;YAC9C,iDAAiD;YACjD,iDAAiD;YACjD,sBAAsB;YAEtB,OAAO,kBAAkB,CAAC,GAAG,KAAK,CAAC,GAAG,GAAG,KAAK,CAAC,GAAG,CAAC,IAAI,EAAE,KAAK,CAAC,GAAG,CAAC,EAAE,CAAC,CAAC,UAAU,CAAC,KAAK,EAAE,GAAG,CAAC,CAAC;QAC/F,CAAC;QAED,OAAO,kBAAkB,CAAC,GAAG,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAC,CAAC;IAC/C,CAAC;IAEO,MAAM,CAAC,UAAsB,EAAE,UAAsB;QAC5D,IAAI,CAAC,UAAU,IAAI,CAAC,UAAU,EAAE,CAAC;YAChC,OAAO,UAAU,KAAK,UAAU,CAAC,CAAC,aAAa;QAChD,CAAC;QAED,IAAI,cAAc,CAAC,UAAU,CAAC,IAAI,cAAc,CAAC,UAAU,CAAC,EAAE,CAAC;YAC9D,OAAO,OAAO,CAAC,UAAU,CAAC,SAAS,EAAE,UAAU,CAAC,SAAS,CAAC,CAAC,CAAC,iBAAiB;QAC9E,CAAC;QAED,IAAI,iBAAiB,CAAC,UAAU,CAAC,IAAI,iBAAiB,CAAC,UAAU,CAAC,EAAE,CAAC;YACpE,OAAO,OAAO,CAAC,UAAU,CAAC,YAAY,EAAE,UAAU,CAAC,YAAY,CAAC,CAAC,CAAC,iBAAiB;QACpF,CAAC;QAED,OAAO,KAAK,CAAC;IACd,CAAC;IAED,SAAS;QACR,IAAI,IAAI,CAAC,SAAS,EAAE,CAAC;YACpB,IAAI,cAAc,CAAC,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC;gBACpC,OAAO,IAAI,CAAC,SAAS,CAAC,SAAS,CAAC,MAAM,KAAK,OAAO,CAAC,YAAY,CAAC;YACjE,CAAC;YAED,IAAI,iBAAiB,CAAC,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC;gBACvC,OAAO,IAAI,CAAC,SAAS,CAAC,YAAY,CAAC,MAAM,KAAK,OAAO,CAAC,YAAY,CAAC;YACpE,CAAC;QACF,CAAC;QAED,OAAO,IAAI,CAAC;IACb,CAAC;;AAGF,SAAS,UAAU,CAAC,IAAY;IAC/B,MAAM,OAAO,GAAG,QAAQ,CAAC,MAAM,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC;IAC5C,KAAK,MAAM,MAAM,IAAI,OAAO,EAAE,CAAC;QAC9B,IAAI,MAAM,CAAC,UAAU,CAAC,IAAI,GAAG,GAAG,CAAC,EAAE,CAAC;YACnC,OAAO,MAAM,CAAC,SAAS,CAAC,IAAI,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC;QAC1C,CAAC;IACF,CAAC;IAED,OAAO,SAAS,CAAC;AAClB,CAAC;AAED,CAAC;IAEA,kCAAkC;IAClC,gDAAgD;IAChD,MAAM,aAAa,GAAG,UAAU,CAAC,QAAQ,CAAC,cAAc,CAAC,oCAAoC,CAAC,CAAC;IAC/F,MAAM,sBAAsB,GAAG,aAAa,CAAC,CAAC,CAAC,aAAa,CAAC,YAAY,CAAC,eAAe,CAAC,CAAC,CAAC,CAAC,SAAS,CAAC;IACvG,IAAI,CAAC,aAAa,IAAI,CAAC,sBAAsB,EAAE,CAAC;QAC/C,MAAM,IAAI,KAAK,CAAC,mCAAmC,CAAC,CAAC;IACtD,CAAC;IACD,MAAM,MAAM,GAAuH,IAAI,CAAC,KAAK,CAAC,sBAAsB,CAAC,CAAC;IACtK,MAAM,oBAAoB,GAAG,UAAU,CAAC,wBAAwB,CAAC,CAAC;IAClE,MAAM,mBAAmB,GAAG,oBAAoB,IAAI,oBAAoB,CAAC,SAAS,EAAE;QACnF,CAAC,CAAC,IAAI,oBAAoB,CAAC,oBAAoB,CAAC,CAAC,CAAC,CAAC,IAAI,iBAAiB,EAAE,CAAC;IAE5E,mBAAmB;IACnB,MAAM,CAAC,UAAU,CAAC,QAAQ,CAAC,IAAI,EAAE;QAChC,GAAG,MAAM;QACT,eAAe,EAAE,MAAM,CAAC,eAAe,IAAI,EAAE,KAAK,EAAE,WAAW,EAAE,OAAO,EAAE,GAAG,OAAO,CAAC,SAAS,MAAM,EAAE;QACtG,mBAAmB,EAAE,MAAM,CAAC,mBAAmB,CAAC,CAAC,CAAC,EAAE,OAAO,EAAE,MAAM,CAAC,mBAAmB,CAAC,OAAO,GAAG,CAAC,CAAC,CAAC,SAAS;QAC9G,iBAAiB,EAAE,iBAAiB,CAAC,MAAM,CAAC,MAAM,CAAC;QACnD,mBAAmB,EAAE,IAAI,+BAA+B,CAAC,MAAM,CAAC,aAAa,CAAC;QAC9E,qBAAqB,EAAE,MAAM,CAAC,eAAe,IAAI,CAAC,oBAAoB;YACrE,CAAC,CAAC,SAAS,CAAC,2EAA2E;YACvF,CAAC,CAAC,IAAI,iCAAiC,CAAC,mBAAmB,CAAC;KAC7D,CAAC,CAAC;AACJ,CAAC,CAAC,EAAE,CAAC","file":"workbench.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { isStandalone } from '../../../base/browser/browser.js';\nimport { addDisposableListener } from '../../../base/browser/dom.js';\nimport { mainWindow } from '../../../base/browser/window.js';\nimport { VSBuffer, decodeBase64, encodeBase64 } from '../../../base/common/buffer.js';\nimport { Emitter } from '../../../base/common/event.js';\nimport { Disposable, IDisposable } from '../../../base/common/lifecycle.js';\nimport { parse } from '../../../base/common/marshalling.js';\nimport { Schemas } from '../../../base/common/network.js';\nimport { posix } from '../../../base/common/path.js';\nimport { isEqual } from '../../../base/common/resources.js';\nimport { ltrim } from '../../../base/common/strings.js';\nimport { URI, UriComponents } from '../../../base/common/uri.js';\nimport product from '../../../platform/product/common/product.js';\nimport { ISecretStorageProvider } from '../../../platform/secrets/common/secrets.js';\nimport { isFolderToOpen, isWorkspaceToOpen } from '../../../platform/window/common/window.js';\nimport type { IWorkbenchConstructionOptions, IWorkspace, IWorkspaceProvider } from '../../../workbench/browser/web.api.js';\nimport { AuthenticationSessionInfo } from '../../../workbench/services/authentication/browser/authenticationService.js';\nimport type { IURLCallbackProvider } from '../../../workbench/services/url/browser/urlService.js';\nimport { create } from '../../../workbench/workbench.web.main.internal.js';\n\ninterface ISecretStorageCrypto {\n\tseal(data: string): Promise<string>;\n\tunseal(data: string): Promise<string>;\n}\n\nclass TransparentCrypto implements ISecretStorageCrypto {\n\n\tasync seal(data: string): Promise<string> {\n\t\treturn data;\n\t}\n\n\tasync unseal(data: string): Promise<string> {\n\t\treturn data;\n\t}\n}\n\nconst enum AESConstants {\n\tALGORITHM = 'AES-GCM',\n\tKEY_LENGTH = 256,\n\tIV_LENGTH = 12,\n}\n\nclass NetworkError extends Error {\n\n\tconstructor(inner: Error) {\n\t\tsuper(inner.message);\n\t\tthis.name = inner.name;\n\t\tthis.stack = inner.stack;\n\t}\n}\n\nclass ServerKeyedAESCrypto implements ISecretStorageCrypto {\n\n\tprivate serverKey: Uint8Array | undefined;\n\n\t/**\n\t * Gets whether the algorithm is supported; requires a secure context\n\t */\n\tstatic supported() {\n\t\treturn !!crypto.subtle;\n\t}\n\n\tconstructor(private readonly authEndpoint: string) { }\n\n\tasync seal(data: string): Promise<string> {\n\t\t// Get a new key and IV on every change, to avoid the risk of reusing the same key and IV pair with AES-GCM\n\t\t// (see also: https://developer.mozilla.org/en-US/docs/Web/API/AesGcmParams#properties)\n\t\tconst iv = mainWindow.crypto.getRandomValues(new Uint8Array(AESConstants.IV_LENGTH));\n\t\t// crypto.getRandomValues isn't a good-enough PRNG to generate crypto keys, so we need to use crypto.subtle.generateKey and export the key instead\n\t\tconst clientKeyObj = await mainWindow.crypto.subtle.generateKey(\n\t\t\t{ name: AESConstants.ALGORITHM as const, length: AESConstants.KEY_LENGTH as const },\n\t\t\ttrue,\n\t\t\t['encrypt', 'decrypt']\n\t\t);\n\n\t\tconst clientKey = new Uint8Array(await mainWindow.crypto.subtle.exportKey('raw', clientKeyObj));\n\t\tconst key = await this.getKey(clientKey);\n\t\tconst dataUint8Array = new TextEncoder().encode(data);\n\t\tconst cipherText: ArrayBuffer = await mainWindow.crypto.subtle.encrypt(\n\t\t\t{ name: AESConstants.ALGORITHM as const, iv },\n\t\t\tkey,\n\t\t\tdataUint8Array\n\t\t);\n\n\t\t// Base64 encode the result and store the ciphertext, the key, and the IV in localStorage\n\t\t// Note that the clientKey and IV don't need to be secret\n\t\tconst result = new Uint8Array([...clientKey, ...iv, ...new Uint8Array(cipherText)]);\n\t\treturn encodeBase64(VSBuffer.wrap(result));\n\t}\n\n\tasync unseal(data: string): Promise<string> {\n\t\t// encrypted should contain, in order: the key (32-byte), the IV for AES-GCM (12-byte) and the ciphertext (which has the GCM auth tag at the end)\n\t\t// Minimum length must be 44 (key+IV length) + 16 bytes (1 block encrypted with AES - regardless of key size)\n\t\tconst dataUint8Array = decodeBase64(data);\n\n\t\tif (dataUint8Array.byteLength < 60) {\n\t\t\tthrow Error('Invalid length for the value for credentials.crypto');\n\t\t}\n\n\t\tconst keyLength = AESConstants.KEY_LENGTH / 8;\n\t\tconst clientKey = dataUint8Array.slice(0, keyLength);\n\t\tconst iv = dataUint8Array.slice(keyLength, keyLength + AESConstants.IV_LENGTH);\n\t\tconst cipherText = dataUint8Array.slice(keyLength + AESConstants.IV_LENGTH);\n\n\t\t// Do the decryption and parse the result as JSON\n\t\tconst key = await this.getKey(clientKey.buffer);\n\t\tconst decrypted = await mainWindow.crypto.subtle.decrypt(\n\t\t\t{ name: AESConstants.ALGORITHM as const, iv: iv.buffer as Uint8Array<ArrayBuffer> },\n\t\t\tkey,\n\t\t\tcipherText.buffer as Uint8Array<ArrayBuffer>\n\t\t);\n\n\t\treturn new TextDecoder().decode(new Uint8Array(decrypted));\n\t}\n\n\t/**\n\t * Given a clientKey, returns the CryptoKey object that is used to encrypt/decrypt the data.\n\t * The actual key is (clientKey XOR serverKey)\n\t */\n\tprivate async getKey(clientKey: Uint8Array): Promise<CryptoKey> {\n\t\tif (!clientKey || clientKey.byteLength !== AESConstants.KEY_LENGTH / 8) {\n\t\t\tthrow Error('Invalid length for clientKey');\n\t\t}\n\n\t\tconst serverKey = await this.getServerKeyPart();\n\t\tconst keyData = new Uint8Array(AESConstants.KEY_LENGTH / 8);\n\n\t\tfor (let i = 0; i < keyData.byteLength; i++) {\n\t\t\tkeyData[i] = clientKey[i] ^ serverKey[i];\n\t\t}\n\n\t\treturn mainWindow.crypto.subtle.importKey(\n\t\t\t'raw',\n\t\t\tkeyData,\n\t\t\t{\n\t\t\t\tname: AESConstants.ALGORITHM as const,\n\t\t\t\tlength: AESConstants.KEY_LENGTH as const,\n\t\t\t},\n\t\t\ttrue,\n\t\t\t['encrypt', 'decrypt']\n\t\t);\n\t}\n\n\tprivate async getServerKeyPart(): Promise<Uint8Array> {\n\t\tif (this.serverKey) {\n\t\t\treturn this.serverKey;\n\t\t}\n\n\t\tlet attempt = 0;\n\t\tlet lastError: Error | undefined;\n\n\t\twhile (attempt <= 3) {\n\t\t\ttry {\n\t\t\t\tconst res = await fetch(this.authEndpoint, { credentials: 'include', method: 'POST' });\n\t\t\t\tif (!res.ok) {\n\t\t\t\t\tthrow new Error(res.statusText);\n\t\t\t\t}\n\n\t\t\t\tconst serverKey = new Uint8Array(await res.arrayBuffer());\n\t\t\t\tif (serverKey.byteLength !== AESConstants.KEY_LENGTH / 8) {\n\t\t\t\t\tthrow Error(`The key retrieved by the server is not ${AESConstants.KEY_LENGTH} bit long.`);\n\t\t\t\t}\n\n\t\t\t\tthis.serverKey = serverKey;\n\n\t\t\t\treturn this.serverKey;\n\t\t\t} catch (e) {\n\t\t\t\tlastError = e instanceof Error ? e : new Error(String(e));\n\t\t\t\tattempt++;\n\n\t\t\t\t// exponential backoff\n\t\t\t\tawait new Promise(resolve => setTimeout(resolve, attempt * attempt * 100));\n\t\t\t}\n\t\t}\n\n\t\tif (lastError) {\n\t\t\tthrow new NetworkError(lastError);\n\t\t}\n\n\t\tthrow new Error('Unknown error');\n\t}\n}\n\nexport class LocalStorageSecretStorageProvider implements ISecretStorageProvider {\n\n\tprivate readonly storageKey = 'secrets.provider';\n\n\tprivate secretsPromise: Promise<Record<string, string>>;\n\n\ttype: 'in-memory' | 'persisted' | 'unknown' = 'persisted';\n\n\tconstructor(\n\t\tprivate readonly crypto: ISecretStorageCrypto,\n\t) {\n\t\tthis.secretsPromise = this.load();\n\t}\n\n\tprivate async load(): Promise<Record<string, string>> {\n\t\tconst record = this.loadAuthSessionFromElement();\n\n\t\tconst encrypted = localStorage.getItem(this.storageKey);\n\t\tif (encrypted) {\n\t\t\ttry {\n\t\t\t\tconst decrypted = JSON.parse(await this.crypto.unseal(encrypted));\n\n\t\t\t\treturn { ...record, ...decrypted };\n\t\t\t} catch (err) {\n\t\t\t\t// TODO: send telemetry\n\t\t\t\tconsole.error('Failed to decrypt secrets from localStorage', err);\n\t\t\t\tif (!(err instanceof NetworkError)) {\n\t\t\t\t\tlocalStorage.removeItem(this.storageKey);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn record;\n\t}\n\n\tprivate loadAuthSessionFromElement(): Record<string, string> {\n\t\tlet authSessionInfo: (AuthenticationSessionInfo & { scopes: string[][] }) | undefined;\n\t\t// eslint-disable-next-line no-restricted-syntax\n\t\tconst authSessionElement = mainWindow.document.getElementById('vscode-workbench-auth-session');\n\t\tconst authSessionElementAttribute = authSessionElement ? authSessionElement.getAttribute('data-settings') : undefined;\n\t\tif (authSessionElementAttribute) {\n\t\t\ttry {\n\t\t\t\tauthSessionInfo = JSON.parse(authSessionElementAttribute);\n\t\t\t} catch (error) { /* Invalid session is passed. Ignore. */ }\n\t\t}\n\n\t\tif (!authSessionInfo) {\n\t\t\treturn {};\n\t\t}\n\n\t\tconst record: Record<string, string> = {};\n\n\t\t// Settings Sync Entry\n\t\trecord[`${product.urlProtocol}.loginAccount`] = JSON.stringify(authSessionInfo);\n\n\t\t// Auth extension Entry\n\t\tif (authSessionInfo.providerId !== 'github') {\n\t\t\tconsole.error(`Unexpected auth provider: ${authSessionInfo.providerId}. Expected 'github'.`);\n\t\t\treturn record;\n\t\t}\n\n\t\tconst authAccount = JSON.stringify({ extensionId: 'vscode.github-authentication', key: 'github.auth' });\n\t\trecord[authAccount] = JSON.stringify(authSessionInfo.scopes.map(scopes => ({\n\t\t\tid: authSessionInfo.id,\n\t\t\tscopes,\n\t\t\taccessToken: authSessionInfo.accessToken\n\t\t})));\n\n\t\treturn record;\n\t}\n\n\tasync get(key: string): Promise<string | undefined> {\n\t\tconst secrets = await this.secretsPromise;\n\n\t\treturn secrets[key];\n\t}\n\n\tasync set(key: string, value: string): Promise<void> {\n\t\tconst secrets = await this.secretsPromise;\n\t\tsecrets[key] = value;\n\t\tthis.secretsPromise = Promise.resolve(secrets);\n\t\tthis.save();\n\t}\n\n\tasync delete(key: string): Promise<void> {\n\t\tconst secrets = await this.secretsPromise;\n\t\tdelete secrets[key];\n\t\tthis.secretsPromise = Promise.resolve(secrets);\n\t\tthis.save();\n\t}\n\n\tasync keys(): Promise<string[]> {\n\t\tconst secrets = await this.secretsPromise;\n\t\treturn Object.keys(secrets) || [];\n\t}\n\n\tprivate async save(): Promise<void> {\n\t\ttry {\n\t\t\tconst encrypted = await this.crypto.seal(JSON.stringify(await this.secretsPromise));\n\t\t\tlocalStorage.setItem(this.storageKey, encrypted);\n\t\t} catch (err) {\n\t\t\tconsole.error(err);\n\t\t}\n\t}\n}\n\nclass LocalStorageURLCallbackProvider extends Disposable implements IURLCallbackProvider {\n\n\tprivate static REQUEST_ID = 0;\n\n\tprivate static QUERY_KEYS: ('scheme' | 'authority' | 'path' | 'query' | 'fragment')[] = [\n\t\t'scheme',\n\t\t'authority',\n\t\t'path',\n\t\t'query',\n\t\t'fragment'\n\t];\n\n\tprivate readonly _onCallback = this._register(new Emitter<URI>());\n\treadonly onCallback = this._onCallback.event;\n\n\tprivate pendingCallbacks = new Set<number>();\n\tprivate lastTimeChecked = Date.now();\n\tprivate checkCallbacksTimeout: Timeout | undefined = undefined;\n\tprivate onDidChangeLocalStorageDisposable: IDisposable | undefined;\n\n\tconstructor(private readonly _callbackRoute: string) {\n\t\tsuper();\n\t}\n\n\tcreate(options: Partial<UriComponents> = {}): URI {\n\t\tconst id = ++LocalStorageURLCallbackProvider.REQUEST_ID;\n\t\tconst queryParams: string[] = [`vscode-reqid=${id}`];\n\n\t\tfor (const key of LocalStorageURLCallbackProvider.QUERY_KEYS) {\n\t\t\tconst value = options[key];\n\n\t\t\tif (value) {\n\t\t\t\tqueryParams.push(`vscode-${key}=${encodeURIComponent(value)}`);\n\t\t\t}\n\t\t}\n\n\t\t// TODO@joao remove eventually\n\t\t// https://github.com/microsoft/vscode-dev/issues/62\n\t\t// https://github.com/microsoft/vscode/blob/159479eb5ae451a66b5dac3c12d564f32f454796/extensions/github-authentication/src/githubServer.ts#L50-L50\n\t\tif (!(options.authority === 'vscode.github-authentication' && options.path === '/dummy')) {\n\t\t\tconst key = `vscode-web.url-callbacks[${id}]`;\n\t\t\tlocalStorage.removeItem(key);\n\n\t\t\tthis.pendingCallbacks.add(id);\n\t\t\tthis.startListening();\n\t\t}\n\n\t\treturn URI.parse(mainWindow.location.href).with({ path: this._callbackRoute, query: queryParams.join('&') });\n\t}\n\n\tprivate startListening(): void {\n\t\tif (this.onDidChangeLocalStorageDisposable) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.onDidChangeLocalStorageDisposable = addDisposableListener(mainWindow, 'storage', () => this.onDidChangeLocalStorage());\n\t}\n\n\tprivate stopListening(): void {\n\t\tthis.onDidChangeLocalStorageDisposable?.dispose();\n\t\tthis.onDidChangeLocalStorageDisposable = undefined;\n\t}\n\n\t// this fires every time local storage changes, but we\n\t// don't want to check more often than once a second\n\tprivate async onDidChangeLocalStorage(): Promise<void> {\n\t\tconst ellapsed = Date.now() - this.lastTimeChecked;\n\n\t\tif (ellapsed > 1000) {\n\t\t\tthis.checkCallbacks();\n\t\t} else if (this.checkCallbacksTimeout === undefined) {\n\t\t\tthis.checkCallbacksTimeout = setTimeout(() => {\n\t\t\t\tthis.checkCallbacksTimeout = undefined;\n\t\t\t\tthis.checkCallbacks();\n\t\t\t}, 1000 - ellapsed);\n\t\t}\n\t}\n\n\tprivate checkCallbacks(): void {\n\t\tlet pendingCallbacks: Set<number> | undefined;\n\n\t\tfor (const id of this.pendingCallbacks) {\n\t\t\tconst key = `vscode-web.url-callbacks[${id}]`;\n\t\t\tconst result = localStorage.getItem(key);\n\n\t\t\tif (result !== null) {\n\t\t\t\ttry {\n\t\t\t\t\tthis._onCallback.fire(URI.revive(JSON.parse(result)));\n\t\t\t\t} catch (error) {\n\t\t\t\t\tconsole.error(error);\n\t\t\t\t}\n\n\t\t\t\tpendingCallbacks = pendingCallbacks ?? new Set(this.pendingCallbacks);\n\t\t\t\tpendingCallbacks.delete(id);\n\t\t\t\tlocalStorage.removeItem(key);\n\t\t\t}\n\t\t}\n\n\t\tif (pendingCallbacks) {\n\t\t\tthis.pendingCallbacks = pendingCallbacks;\n\n\t\t\tif (this.pendingCallbacks.size === 0) {\n\t\t\t\tthis.stopListening();\n\t\t\t}\n\t\t}\n\n\t\tthis.lastTimeChecked = Date.now();\n\t}\n}\n\nclass WorkspaceProvider implements IWorkspaceProvider {\n\n\tprivate static QUERY_PARAM_EMPTY_WINDOW = 'ew';\n\tprivate static QUERY_PARAM_FOLDER = 'folder';\n\tprivate static QUERY_PARAM_WORKSPACE = 'workspace';\n\n\tprivate static QUERY_PARAM_PAYLOAD = 'payload';\n\n\tstatic create(config: IWorkbenchConstructionOptions & { folderUri?: UriComponents; workspaceUri?: UriComponents }) {\n\t\tlet foundWorkspace = false;\n\t\tlet workspace: IWorkspace;\n\t\tlet payload = Object.create(null);\n\n\t\tconst query = new URL(document.location.href).searchParams;\n\t\tquery.forEach((value, key) => {\n\t\t\tswitch (key) {\n\n\t\t\t\t// Folder\n\t\t\t\tcase WorkspaceProvider.QUERY_PARAM_FOLDER:\n\t\t\t\t\tif (config.remoteAuthority && value.startsWith(posix.sep)) {\n\t\t\t\t\t\t// when connected to a remote and having a value\n\t\t\t\t\t\t// that is a path (begins with a `/`), assume this\n\t\t\t\t\t\t// is a vscode-remote resource as simplified URL.\n\t\t\t\t\t\tworkspace = { folderUri: URI.from({ scheme: Schemas.vscodeRemote, path: value, authority: config.remoteAuthority }) };\n\t\t\t\t\t} else {\n\t\t\t\t\t\tworkspace = { folderUri: URI.parse(value) };\n\t\t\t\t\t}\n\t\t\t\t\tfoundWorkspace = true;\n\t\t\t\t\tbreak;\n\n\t\t\t\t// Workspace\n\t\t\t\tcase WorkspaceProvider.QUERY_PARAM_WORKSPACE:\n\t\t\t\t\tif (config.remoteAuthority && value.startsWith(posix.sep)) {\n\t\t\t\t\t\t// when connected to a remote and having a value\n\t\t\t\t\t\t// that is a path (begins with a `/`), assume this\n\t\t\t\t\t\t// is a vscode-remote resource as simplified URL.\n\t\t\t\t\t\tworkspace = { workspaceUri: URI.from({ scheme: Schemas.vscodeRemote, path: value, authority: config.remoteAuthority }) };\n\t\t\t\t\t} else {\n\t\t\t\t\t\tworkspace = { workspaceUri: URI.parse(value) };\n\t\t\t\t\t}\n\t\t\t\t\tfoundWorkspace = true;\n\t\t\t\t\tbreak;\n\n\t\t\t\t// Empty\n\t\t\t\tcase WorkspaceProvider.QUERY_PARAM_EMPTY_WINDOW:\n\t\t\t\t\tworkspace = undefined;\n\t\t\t\t\tfoundWorkspace = true;\n\t\t\t\t\tbreak;\n\n\t\t\t\t// Payload\n\t\t\t\tcase WorkspaceProvider.QUERY_PARAM_PAYLOAD:\n\t\t\t\t\ttry {\n\t\t\t\t\t\tpayload = parse(value); // use marshalling#parse() to revive potential URIs\n\t\t\t\t\t} catch (error) {\n\t\t\t\t\t\tconsole.error(error); // possible invalid JSON\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t});\n\n\t\t// If no workspace is provided through the URL, check for config\n\t\t// attribute from server\n\t\tif (!foundWorkspace) {\n\t\t\tif (config.folderUri) {\n\t\t\t\tworkspace = { folderUri: URI.revive(config.folderUri) };\n\t\t\t} else if (config.workspaceUri) {\n\t\t\t\tworkspace = { workspaceUri: URI.revive(config.workspaceUri) };\n\t\t\t}\n\t\t}\n\n\t\treturn new WorkspaceProvider(workspace, payload, config);\n\t}\n\n\treadonly trusted = true;\n\n\tprivate constructor(\n\t\treadonly workspace: IWorkspace,\n\t\treadonly payload: object,\n\t\tprivate readonly config: IWorkbenchConstructionOptions\n\t) {\n\t}\n\n\tasync open(workspace: IWorkspace, options?: { reuse?: boolean; payload?: object }): Promise<boolean> {\n\t\tif (options?.reuse && !options.payload && this.isSame(this.workspace, workspace)) {\n\t\t\treturn true; // return early if workspace and environment is not changing and we are reusing window\n\t\t}\n\n\t\tconst targetHref = this.createTargetUrl(workspace, options);\n\t\tif (targetHref) {\n\t\t\tif (options?.reuse) {\n\t\t\t\tmainWindow.location.href = targetHref;\n\t\t\t\treturn true;\n\t\t\t} else {\n\t\t\t\tlet result;\n\t\t\t\tif (isStandalone()) {\n\t\t\t\t\tresult = mainWindow.open(targetHref, '_blank', 'toolbar=no'); // ensures to open another 'standalone' window!\n\t\t\t\t} else {\n\t\t\t\t\tresult = mainWindow.open(targetHref);\n\t\t\t\t}\n\n\t\t\t\treturn !!result;\n\t\t\t}\n\t\t}\n\n\t\treturn false;\n\t}\n\n\tprivate createTargetUrl(workspace: IWorkspace, options?: { reuse?: boolean; payload?: object }): string | undefined {\n\n\t\t// Empty\n\t\tlet targetHref: string | undefined = undefined;\n\t\tif (!workspace) {\n\t\t\ttargetHref = `${document.location.origin}${document.location.pathname}?${WorkspaceProvider.QUERY_PARAM_EMPTY_WINDOW}=true`;\n\t\t}\n\n\t\t// Folder\n\t\telse if (isFolderToOpen(workspace)) {\n\t\t\tconst queryParamFolder = this.encodeWorkspacePath(workspace.folderUri);\n\t\t\ttargetHref = `${document.location.origin}${document.location.pathname}?${WorkspaceProvider.QUERY_PARAM_FOLDER}=${queryParamFolder}`;\n\t\t}\n\n\t\t// Workspace\n\t\telse if (isWorkspaceToOpen(workspace)) {\n\t\t\tconst queryParamWorkspace = this.encodeWorkspacePath(workspace.workspaceUri);\n\t\t\ttargetHref = `${document.location.origin}${document.location.pathname}?${WorkspaceProvider.QUERY_PARAM_WORKSPACE}=${queryParamWorkspace}`;\n\t\t}\n\n\t\t// Append payload if any\n\t\tif (options?.payload) {\n\t\t\ttargetHref += `&${WorkspaceProvider.QUERY_PARAM_PAYLOAD}=${encodeURIComponent(JSON.stringify(options.payload))}`;\n\t\t}\n\n\t\treturn targetHref;\n\t}\n\n\tprivate encodeWorkspacePath(uri: URI): string {\n\t\tif (this.config.remoteAuthority && uri.scheme === Schemas.vscodeRemote) {\n\n\t\t\t// when connected to a remote and having a folder\n\t\t\t// or workspace for that remote, only use the path\n\t\t\t// as query value to form shorter, nicer URLs.\n\t\t\t// however, we still need to `encodeURIComponent`\n\t\t\t// to ensure to preserve special characters, such\n\t\t\t// as `+` in the path.\n\n\t\t\treturn encodeURIComponent(`${posix.sep}${ltrim(uri.path, posix.sep)}`).replaceAll('%2F', '/');\n\t\t}\n\n\t\treturn encodeURIComponent(uri.toString(true));\n\t}\n\n\tprivate isSame(workspaceA: IWorkspace, workspaceB: IWorkspace): boolean {\n\t\tif (!workspaceA || !workspaceB) {\n\t\t\treturn workspaceA === workspaceB; // both empty\n\t\t}\n\n\t\tif (isFolderToOpen(workspaceA) && isFolderToOpen(workspaceB)) {\n\t\t\treturn isEqual(workspaceA.folderUri, workspaceB.folderUri); // same workspace\n\t\t}\n\n\t\tif (isWorkspaceToOpen(workspaceA) && isWorkspaceToOpen(workspaceB)) {\n\t\t\treturn isEqual(workspaceA.workspaceUri, workspaceB.workspaceUri); // same workspace\n\t\t}\n\n\t\treturn false;\n\t}\n\n\thasRemote(): boolean {\n\t\tif (this.workspace) {\n\t\t\tif (isFolderToOpen(this.workspace)) {\n\t\t\t\treturn this.workspace.folderUri.scheme === Schemas.vscodeRemote;\n\t\t\t}\n\n\t\t\tif (isWorkspaceToOpen(this.workspace)) {\n\t\t\t\treturn this.workspace.workspaceUri.scheme === Schemas.vscodeRemote;\n\t\t\t}\n\t\t}\n\n\t\treturn true;\n\t}\n}\n\nfunction readCookie(name: string): string | undefined {\n\tconst cookies = document.cookie.split('; ');\n\tfor (const cookie of cookies) {\n\t\tif (cookie.startsWith(name + '=')) {\n\t\t\treturn cookie.substring(name.length + 1);\n\t\t}\n\t}\n\n\treturn undefined;\n}\n\n(function () {\n\n\t// Find config by checking for DOM\n\t// eslint-disable-next-line no-restricted-syntax\n\tconst configElement = mainWindow.document.getElementById('vscode-workbench-web-configuration');\n\tconst configElementAttribute = configElement ? configElement.getAttribute('data-settings') : undefined;\n\tif (!configElement || !configElementAttribute) {\n\t\tthrow new Error('Missing web configuration element');\n\t}\n\tconst config: IWorkbenchConstructionOptions & { folderUri?: UriComponents; workspaceUri?: UriComponents; callbackRoute: string } = JSON.parse(configElementAttribute);\n\tconst secretStorageKeyPath = readCookie('vscode-secret-key-path');\n\tconst secretStorageCrypto = secretStorageKeyPath && ServerKeyedAESCrypto.supported()\n\t\t? new ServerKeyedAESCrypto(secretStorageKeyPath) : new TransparentCrypto();\n\n\t// Create workbench\n\tcreate(mainWindow.document.body, {\n\t\t...config,\n\t\twindowIndicator: config.windowIndicator ?? { label: '$(remote)', tooltip: `${product.nameShort} Web` },\n\t\tsettingsSyncOptions: config.settingsSyncOptions ? { enabled: config.settingsSyncOptions.enabled, } : undefined,\n\t\tworkspaceProvider: WorkspaceProvider.create(config),\n\t\turlCallbackProvider: new LocalStorageURLCallbackProvider(config.callbackRoute),\n\t\tsecretStorageProvider: config.remoteAuthority && !secretStorageKeyPath\n\t\t\t? undefined /* with a remote without embedder-preferred storage, store on the remote */\n\t\t\t: new LocalStorageSecretStorageProvider(secretStorageCrypto),\n\t});\n})();\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { isStandalone } from '../../../base/browser/browser.js';\nimport { addDisposableListener } from '../../../base/browser/dom.js';\nimport { mainWindow } from '../../../base/browser/window.js';\nimport { VSBuffer, decodeBase64, encodeBase64 } from '../../../base/common/buffer.js';\nimport { Emitter } from '../../../base/common/event.js';\nimport { Disposable, IDisposable } from '../../../base/common/lifecycle.js';\nimport { parse } from '../../../base/common/marshalling.js';\nimport { Schemas } from '../../../base/common/network.js';\nimport { posix } from '../../../base/common/path.js';\nimport { isEqual } from '../../../base/common/resources.js';\nimport { ltrim } from '../../../base/common/strings.js';\nimport { URI, UriComponents } from '../../../base/common/uri.js';\nimport product from '../../../platform/product/common/product.js';\nimport { ISecretStorageProvider } from '../../../platform/secrets/common/secrets.js';\nimport { isFolderToOpen, isWorkspaceToOpen } from '../../../platform/window/common/window.js';\nimport type { IWorkbenchConstructionOptions, IWorkspace, IWorkspaceProvider } from '../../../workbench/browser/web.api.js';\nimport { AuthenticationSessionInfo } from '../../../workbench/services/authentication/browser/authenticationService.js';\nimport type { IURLCallbackProvider } from '../../../workbench/services/url/browser/urlService.js';\nimport { create } from '../../../workbench/workbench.web.main.internal.js';\n\ninterface ISecretStorageCrypto {\n\tseal(data: string): Promise<string>;\n\tunseal(data: string): Promise<string>;\n}\n\nclass TransparentCrypto implements ISecretStorageCrypto {\n\n\tasync seal(data: string): Promise<string> {\n\t\treturn data;\n\t}\n\n\tasync unseal(data: string): Promise<string> {\n\t\treturn data;\n\t}\n}\n\nconst enum AESConstants {\n\tALGORITHM = 'AES-GCM',\n\tKEY_LENGTH = 256,\n\tIV_LENGTH = 12,\n}\n\nclass NetworkError extends Error {\n\n\tconstructor(inner: Error) {\n\t\tsuper(inner.message);\n\t\tthis.name = inner.name;\n\t\tthis.stack = inner.stack;\n\t}\n}\n\nclass ServerKeyedAESCrypto implements ISecretStorageCrypto {\n\n\tprivate serverKey: Uint8Array | undefined;\n\n\t/**\n\t * Gets whether the algorithm is supported; requires a secure context\n\t */\n\tstatic supported() {\n\t\treturn !!crypto.subtle;\n\t}\n\n\tconstructor(private readonly authEndpoint: string) { }\n\n\tasync seal(data: string): Promise<string> {\n\t\t// Get a new key and IV on every change, to avoid the risk of reusing the same key and IV pair with AES-GCM\n\t\t// (see also: https://developer.mozilla.org/en-US/docs/Web/API/AesGcmParams#properties)\n\t\tconst iv = mainWindow.crypto.getRandomValues(new Uint8Array(AESConstants.IV_LENGTH));\n\t\t// crypto.getRandomValues isn't a good-enough PRNG to generate crypto keys, so we need to use crypto.subtle.generateKey and export the key instead\n\t\tconst clientKeyObj = await mainWindow.crypto.subtle.generateKey(\n\t\t\t{ name: AESConstants.ALGORITHM as const, length: AESConstants.KEY_LENGTH as const },\n\t\t\ttrue,\n\t\t\t['encrypt', 'decrypt']\n\t\t);\n\n\t\tconst clientKey = new Uint8Array(await mainWindow.crypto.subtle.exportKey('raw', clientKeyObj));\n\t\tconst key = await this.getKey(clientKey);\n\t\tconst dataUint8Array = new TextEncoder().encode(data);\n\t\tconst cipherText: ArrayBuffer = await mainWindow.crypto.subtle.encrypt(\n\t\t\t{ name: AESConstants.ALGORITHM as const, iv },\n\t\t\tkey,\n\t\t\tdataUint8Array\n\t\t);\n\n\t\t// Base64 encode the result and store the ciphertext, the key, and the IV in localStorage\n\t\t// Note that the clientKey and IV don't need to be secret\n\t\tconst result = new Uint8Array([...clientKey, ...iv, ...new Uint8Array(cipherText)]);\n\t\treturn encodeBase64(VSBuffer.wrap(result));\n\t}\n\n\tasync unseal(data: string): Promise<string> {\n\t\t// encrypted should contain, in order: the key (32-byte), the IV for AES-GCM (12-byte) and the ciphertext (which has the GCM auth tag at the end)\n\t\t// Minimum length must be 44 (key+IV length) + 16 bytes (1 block encrypted with AES - regardless of key size)\n\t\tconst dataUint8Array = decodeBase64(data);\n\n\t\tif (dataUint8Array.byteLength < 60) {\n\t\t\tthrow Error('Invalid length for the value for credentials.crypto');\n\t\t}\n\n\t\tconst keyLength = AESConstants.KEY_LENGTH / 8;\n\t\tconst clientKey = dataUint8Array.slice(0, keyLength);\n\t\tconst iv = dataUint8Array.slice(keyLength, keyLength + AESConstants.IV_LENGTH);\n\t\tconst cipherText = dataUint8Array.slice(keyLength + AESConstants.IV_LENGTH);\n\n\t\t// Do the decryption and parse the result as JSON\n\t\tconst key = await this.getKey(clientKey.buffer);\n\t\tconst decrypted = await mainWindow.crypto.subtle.decrypt(\n\t\t\t{ name: AESConstants.ALGORITHM as const, iv: iv.buffer as Uint8Array<ArrayBuffer> },\n\t\t\tkey,\n\t\t\tcipherText.buffer as Uint8Array<ArrayBuffer>\n\t\t);\n\n\t\treturn new TextDecoder().decode(new Uint8Array(decrypted));\n\t}\n\n\t/**\n\t * Given a clientKey, returns the CryptoKey object that is used to encrypt/decrypt the data.\n\t * The actual key is (clientKey XOR serverKey)\n\t */\n\tprivate async getKey(clientKey: Uint8Array): Promise<CryptoKey> {\n\t\tif (!clientKey || clientKey.byteLength !== AESConstants.KEY_LENGTH / 8) {\n\t\t\tthrow Error('Invalid length for clientKey');\n\t\t}\n\n\t\tconst serverKey = await this.getServerKeyPart();\n\t\tconst keyData = new Uint8Array(AESConstants.KEY_LENGTH / 8);\n\n\t\tfor (let i = 0; i < keyData.byteLength; i++) {\n\t\t\tkeyData[i] = clientKey[i] ^ serverKey[i];\n\t\t}\n\n\t\treturn mainWindow.crypto.subtle.importKey(\n\t\t\t'raw',\n\t\t\tkeyData,\n\t\t\t{\n\t\t\t\tname: AESConstants.ALGORITHM as const,\n\t\t\t\tlength: AESConstants.KEY_LENGTH as const,\n\t\t\t},\n\t\t\ttrue,\n\t\t\t['encrypt', 'decrypt']\n\t\t);\n\t}\n\n\tprivate async getServerKeyPart(): Promise<Uint8Array> {\n\t\tif (this.serverKey) {\n\t\t\treturn this.serverKey;\n\t\t}\n\n\t\tlet attempt = 0;\n\t\tlet lastError: Error | undefined;\n\n\t\twhile (attempt <= 3) {\n\t\t\ttry {\n\t\t\t\tconst res = await fetch(this.authEndpoint, { credentials: 'include', method: 'POST' });\n\t\t\t\tif (!res.ok) {\n\t\t\t\t\tthrow new Error(res.statusText);\n\t\t\t\t}\n\n\t\t\t\tconst serverKey = new Uint8Array(await res.arrayBuffer());\n\t\t\t\tif (serverKey.byteLength !== AESConstants.KEY_LENGTH / 8) {\n\t\t\t\t\tthrow Error(`The key retrieved by the server is not ${AESConstants.KEY_LENGTH} bit long.`);\n\t\t\t\t}\n\n\t\t\t\tthis.serverKey = serverKey;\n\n\t\t\t\treturn this.serverKey;\n\t\t\t} catch (e) {\n\t\t\t\tlastError = e instanceof Error ? e : new Error(String(e));\n\t\t\t\tattempt++;\n\n\t\t\t\t// exponential backoff\n\t\t\t\tawait new Promise(resolve => setTimeout(resolve, attempt * attempt * 100));\n\t\t\t}\n\t\t}\n\n\t\tif (lastError) {\n\t\t\tthrow new NetworkError(lastError);\n\t\t}\n\n\t\tthrow new Error('Unknown error');\n\t}\n}\n\nexport class LocalStorageSecretStorageProvider implements ISecretStorageProvider {\n\n\tprivate readonly storageKey = 'secrets.provider';\n\n\tprivate secretsPromise: Promise<Record<string, string>>;\n\n\ttype: 'in-memory' | 'persisted' | 'unknown' = 'persisted';\n\n\tconstructor(\n\t\tprivate readonly crypto: ISecretStorageCrypto,\n\t) {\n\t\tthis.secretsPromise = this.load();\n\t}\n\n\tprivate async load(): Promise<Record<string, string>> {\n\t\tconst record = this.loadAuthSessionFromElement();\n\n\t\tconst encrypted = localStorage.getItem(this.storageKey);\n\t\tif (encrypted) {\n\t\t\ttry {\n\t\t\t\tconst decrypted = JSON.parse(await this.crypto.unseal(encrypted));\n\n\t\t\t\treturn { ...record, ...decrypted };\n\t\t\t} catch (err) {\n\t\t\t\t// TODO: send telemetry\n\t\t\t\tconsole.error('Failed to decrypt secrets from localStorage', err);\n\t\t\t\tif (!(err instanceof NetworkError)) {\n\t\t\t\t\tlocalStorage.removeItem(this.storageKey);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn record;\n\t}\n\n\tprivate loadAuthSessionFromElement(): Record<string, string> {\n\t\tlet authSessionInfo: (AuthenticationSessionInfo & { scopes: string[][] }) | undefined;\n\t\t// eslint-disable-next-line no-restricted-syntax\n\t\tconst authSessionElement = mainWindow.document.getElementById('vscode-workbench-auth-session');\n\t\tconst authSessionElementAttribute = authSessionElement ? authSessionElement.getAttribute('data-settings') : undefined;\n\t\tif (authSessionElementAttribute) {\n\t\t\ttry {\n\t\t\t\tauthSessionInfo = JSON.parse(authSessionElementAttribute);\n\t\t\t} catch (error) { /* Invalid session is passed. Ignore. */ }\n\t\t}\n\n\t\tif (!authSessionInfo) {\n\t\t\treturn {};\n\t\t}\n\n\t\tconst record: Record<string, string> = {};\n\n\t\t// Settings Sync Entry\n\t\trecord[`${product.urlProtocol}.loginAccount`] = JSON.stringify(authSessionInfo);\n\n\t\t// Auth extension Entry\n\t\tif (authSessionInfo.providerId !== 'github') {\n\t\t\tconsole.error(`Unexpected auth provider: ${authSessionInfo.providerId}. Expected 'github'.`);\n\t\t\treturn record;\n\t\t}\n\n\t\tconst authAccount = JSON.stringify({ extensionId: 'vscode.github-authentication', key: 'github.auth' });\n\t\trecord[authAccount] = JSON.stringify(authSessionInfo.scopes.map(scopes => ({\n\t\t\tid: authSessionInfo.id,\n\t\t\tscopes,\n\t\t\taccessToken: authSessionInfo.accessToken\n\t\t})));\n\n\t\treturn record;\n\t}\n\n\tasync get(key: string): Promise<string | undefined> {\n\t\tconst secrets = await this.secretsPromise;\n\n\t\treturn secrets[key];\n\t}\n\n\tasync set(key: string, value: string): Promise<void> {\n\t\tconst secrets = await this.secretsPromise;\n\t\tsecrets[key] = value;\n\t\tthis.secretsPromise = Promise.resolve(secrets);\n\t\tthis.save();\n\t}\n\n\tasync delete(key: string): Promise<void> {\n\t\tconst secrets = await this.secretsPromise;\n\t\tdelete secrets[key];\n\t\tthis.secretsPromise = Promise.resolve(secrets);\n\t\tthis.save();\n\t}\n\n\tasync keys(): Promise<string[]> {\n\t\tconst secrets = await this.secretsPromise;\n\t\treturn Object.keys(secrets) || [];\n\t}\n\n\tprivate async save(): Promise<void> {\n\t\ttry {\n\t\t\tconst encrypted = await this.crypto.seal(JSON.stringify(await this.secretsPromise));\n\t\t\tlocalStorage.setItem(this.storageKey, encrypted);\n\t\t} catch (err) {\n\t\t\tconsole.error(err);\n\t\t}\n\t}\n}\n\nclass LocalStorageURLCallbackProvider extends Disposable implements IURLCallbackProvider {\n\n\tprivate static REQUEST_ID = 0;\n\n\tprivate static QUERY_KEYS: ('scheme' | 'authority' | 'path' | 'query' | 'fragment')[] = [\n\t\t'scheme',\n\t\t'authority',\n\t\t'path',\n\t\t'query',\n\t\t'fragment'\n\t];\n\n\tprivate readonly _onCallback = this._register(new Emitter<URI>());\n\treadonly onCallback = this._onCallback.event;\n\n\tprivate pendingCallbacks = new Set<number>();\n\tprivate lastTimeChecked = Date.now();\n\tprivate checkCallbacksTimeout: Timeout | undefined = undefined;\n\tprivate onDidChangeLocalStorageDisposable: IDisposable | undefined;\n\n\tconstructor(private readonly _callbackRoute: string) {\n\t\tsuper();\n\t}\n\n\tcreate(options: Partial<UriComponents> = {}): URI {\n\t\tconst id = ++LocalStorageURLCallbackProvider.REQUEST_ID;\n\t\tconst queryParams: string[] = [`vscode-reqid=${id}`];\n\n\t\tfor (const key of LocalStorageURLCallbackProvider.QUERY_KEYS) {\n\t\t\tconst value = options[key];\n\n\t\t\tif (value) {\n\t\t\t\tqueryParams.push(`vscode-${key}=${encodeURIComponent(value)}`);\n\t\t\t}\n\t\t}\n\n\t\t// TODO@joao remove eventually\n\t\t// https://github.com/microsoft/vscode-dev/issues/62\n\t\t// https://github.com/microsoft/vscode/blob/159479eb5ae451a66b5dac3c12d564f32f454796/extensions/github-authentication/src/githubServer.ts#L50-L50\n\t\tif (!(options.authority === 'vscode.github-authentication' && options.path === '/dummy')) {\n\t\t\tconst key = `vscode-web.url-callbacks[${id}]`;\n\t\t\tlocalStorage.removeItem(key);\n\n\t\t\tthis.pendingCallbacks.add(id);\n\t\t\tthis.startListening();\n\t\t}\n\n\t\treturn URI.parse(mainWindow.location.href).with({ path: this._callbackRoute, query: queryParams.join('&') });\n\t}\n\n\tprivate startListening(): void {\n\t\tif (this.onDidChangeLocalStorageDisposable) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.onDidChangeLocalStorageDisposable = addDisposableListener(mainWindow, 'storage', () => this.onDidChangeLocalStorage());\n\t}\n\n\tprivate stopListening(): void {\n\t\tthis.onDidChangeLocalStorageDisposable?.dispose();\n\t\tthis.onDidChangeLocalStorageDisposable = undefined;\n\t}\n\n\t// this fires every time local storage changes, but we\n\t// don't want to check more often than once a second\n\tprivate async onDidChangeLocalStorage(): Promise<void> {\n\t\tconst ellapsed = Date.now() - this.lastTimeChecked;\n\n\t\tif (ellapsed > 1000) {\n\t\t\tthis.checkCallbacks();\n\t\t} else if (this.checkCallbacksTimeout === undefined) {\n\t\t\tthis.checkCallbacksTimeout = setTimeout(() => {\n\t\t\t\tthis.checkCallbacksTimeout = undefined;\n\t\t\t\tthis.checkCallbacks();\n\t\t\t}, 1000 - ellapsed);\n\t\t}\n\t}\n\n\tprivate checkCallbacks(): void {\n\t\tlet pendingCallbacks: Set<number> | undefined;\n\n\t\tfor (const id of this.pendingCallbacks) {\n\t\t\tconst key = `vscode-web.url-callbacks[${id}]`;\n\t\t\tconst result = localStorage.getItem(key);\n\n\t\t\tif (result !== null) {\n\t\t\t\ttry {\n\t\t\t\t\tthis._onCallback.fire(URI.revive(JSON.parse(result)));\n\t\t\t\t} catch (error) {\n\t\t\t\t\tconsole.error(error);\n\t\t\t\t}\n\n\t\t\t\tpendingCallbacks = pendingCallbacks ?? new Set(this.pendingCallbacks);\n\t\t\t\tpendingCallbacks.delete(id);\n\t\t\t\tlocalStorage.removeItem(key);\n\t\t\t}\n\t\t}\n\n\t\tif (pendingCallbacks) {\n\t\t\tthis.pendingCallbacks = pendingCallbacks;\n\n\t\t\tif (this.pendingCallbacks.size === 0) {\n\t\t\t\tthis.stopListening();\n\t\t\t}\n\t\t}\n\n\t\tthis.lastTimeChecked = Date.now();\n\t}\n}\n\nclass WorkspaceProvider implements IWorkspaceProvider {\n\n\tprivate static QUERY_PARAM_EMPTY_WINDOW = 'ew';\n\tprivate static QUERY_PARAM_FOLDER = 'folder';\n\tprivate static QUERY_PARAM_WORKSPACE = 'workspace';\n\n\tprivate static QUERY_PARAM_PAYLOAD = 'payload';\n\n\tstatic create(config: IWorkbenchConstructionOptions & { folderUri?: UriComponents; workspaceUri?: UriComponents }) {\n\t\tlet foundWorkspace = false;\n\t\tlet workspace: IWorkspace;\n\t\tlet payload = Object.create(null);\n\n\t\tconst query = new URL(document.location.href).searchParams;\n\t\tquery.forEach((value, key) => {\n\t\t\tswitch (key) {\n\n\t\t\t\t// Folder\n\t\t\t\tcase WorkspaceProvider.QUERY_PARAM_FOLDER:\n\t\t\t\t\tif (config.remoteAuthority && value.startsWith(posix.sep)) {\n\t\t\t\t\t\t// when connected to a remote and having a value\n\t\t\t\t\t\t// that is a path (begins with a `/`), assume this\n\t\t\t\t\t\t// is a vscode-remote resource as simplified URL.\n\t\t\t\t\t\tworkspace = { folderUri: URI.from({ scheme: Schemas.vscodeRemote, path: value, authority: config.remoteAuthority }) };\n\t\t\t\t\t} else {\n\t\t\t\t\t\tworkspace = { folderUri: URI.parse(value) };\n\t\t\t\t\t}\n\t\t\t\t\tfoundWorkspace = true;\n\t\t\t\t\tbreak;\n\n\t\t\t\t// Workspace\n\t\t\t\tcase WorkspaceProvider.QUERY_PARAM_WORKSPACE:\n\t\t\t\t\tif (config.remoteAuthority && value.startsWith(posix.sep)) {\n\t\t\t\t\t\t// when connected to a remote and having a value\n\t\t\t\t\t\t// that is a path (begins with a `/`), assume this\n\t\t\t\t\t\t// is a vscode-remote resource as simplified URL.\n\t\t\t\t\t\tworkspace = { workspaceUri: URI.from({ scheme: Schemas.vscodeRemote, path: value, authority: config.remoteAuthority }) };\n\t\t\t\t\t} else {\n\t\t\t\t\t\tworkspace = { workspaceUri: URI.parse(value) };\n\t\t\t\t\t}\n\t\t\t\t\tfoundWorkspace = true;\n\t\t\t\t\tbreak;\n\n\t\t\t\t// Empty\n\t\t\t\tcase WorkspaceProvider.QUERY_PARAM_EMPTY_WINDOW:\n\t\t\t\t\tworkspace = undefined;\n\t\t\t\t\tfoundWorkspace = true;\n\t\t\t\t\tbreak;\n\n\t\t\t\t// Payload\n\t\t\t\tcase WorkspaceProvider.QUERY_PARAM_PAYLOAD:\n\t\t\t\t\ttry {\n\t\t\t\t\t\tpayload = parse(value); // use marshalling#parse() to revive potential URIs\n\t\t\t\t\t} catch (error) {\n\t\t\t\t\t\tconsole.error(error); // possible invalid JSON\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t});\n\n\t\t// If no workspace is provided through the URL, check for config\n\t\t// attribute from server\n\t\tif (!foundWorkspace) {\n\t\t\tif (config.folderUri) {\n\t\t\t\tworkspace = { folderUri: URI.revive(config.folderUri) };\n\t\t\t} else if (config.workspaceUri) {\n\t\t\t\tworkspace = { workspaceUri: URI.revive(config.workspaceUri) };\n\t\t\t}\n\t\t}\n\n\t\treturn new WorkspaceProvider(workspace, payload, config);\n\t}\n\n\treadonly trusted = true;\n\n\tprivate constructor(\n\t\treadonly workspace: IWorkspace,\n\t\treadonly payload: object,\n\t\tprivate readonly config: IWorkbenchConstructionOptions\n\t) {\n\t}\n\n\tasync open(workspace: IWorkspace, options?: { reuse?: boolean; payload?: object }): Promise<boolean> {\n\t\tif (options?.reuse && !options.payload && this.isSame(this.workspace, workspace)) {\n\t\t\treturn true; // return early if workspace and environment is not changing and we are reusing window\n\t\t}\n\n\t\tconst targetHref = this.createTargetUrl(workspace, options);\n\t\tif (targetHref) {\n\t\t\tif (options?.reuse) {\n\t\t\t\tmainWindow.location.href = targetHref;\n\t\t\t\treturn true;\n\t\t\t} else {\n\t\t\t\tlet result;\n\t\t\t\tif (isStandalone()) {\n\t\t\t\t\tresult = mainWindow.open(targetHref, '_blank', 'toolbar=no'); // ensures to open another 'standalone' window!\n\t\t\t\t} else {\n\t\t\t\t\tresult = mainWindow.open(targetHref);\n\t\t\t\t}\n\n\t\t\t\treturn !!result;\n\t\t\t}\n\t\t}\n\n\t\treturn false;\n\t}\n\n\tprivate createTargetUrl(workspace: IWorkspace, options?: { reuse?: boolean; payload?: object }): string | undefined {\n\n\t\t// Empty\n\t\tlet targetHref: string | undefined = undefined;\n\t\tif (!workspace) {\n\t\t\ttargetHref = `${document.location.origin}${document.location.pathname}?${WorkspaceProvider.QUERY_PARAM_EMPTY_WINDOW}=true`;\n\t\t}\n\n\t\t// Folder\n\t\telse if (isFolderToOpen(workspace)) {\n\t\t\tconst queryParamFolder = this.encodeWorkspacePath(workspace.folderUri);\n\t\t\ttargetHref = `${document.location.origin}${document.location.pathname}?${WorkspaceProvider.QUERY_PARAM_FOLDER}=${queryParamFolder}`;\n\t\t}\n\n\t\t// Workspace\n\t\telse if (isWorkspaceToOpen(workspace)) {\n\t\t\tconst queryParamWorkspace = this.encodeWorkspacePath(workspace.workspaceUri);\n\t\t\ttargetHref = `${document.location.origin}${document.location.pathname}?${WorkspaceProvider.QUERY_PARAM_WORKSPACE}=${queryParamWorkspace}`;\n\t\t}\n\n\t\t// Append payload if any\n\t\tif (options?.payload) {\n\t\t\ttargetHref += `&${WorkspaceProvider.QUERY_PARAM_PAYLOAD}=${encodeURIComponent(JSON.stringify(options.payload))}`;\n\t\t}\n\n\t\treturn targetHref;\n\t}\n\n\tprivate encodeWorkspacePath(uri: URI): string {\n\t\tif (this.config.remoteAuthority && uri.scheme === Schemas.vscodeRemote) {\n\n\t\t\t// when connected to a remote and having a folder\n\t\t\t// or workspace for that remote, only use the path\n\t\t\t// as query value to form shorter, nicer URLs.\n\t\t\t// however, we still need to `encodeURIComponent`\n\t\t\t// to ensure to preserve special characters, such\n\t\t\t// as `+` in the path.\n\n\t\t\treturn encodeURIComponent(`${posix.sep}${ltrim(uri.path, posix.sep)}`).replaceAll('%2F', '/');\n\t\t}\n\n\t\treturn encodeURIComponent(uri.toString(true));\n\t}\n\n\tprivate isSame(workspaceA: IWorkspace, workspaceB: IWorkspace): boolean {\n\t\tif (!workspaceA || !workspaceB) {\n\t\t\treturn workspaceA === workspaceB; // both empty\n\t\t}\n\n\t\tif (isFolderToOpen(workspaceA) && isFolderToOpen(workspaceB)) {\n\t\t\treturn isEqual(workspaceA.folderUri, workspaceB.folderUri); // same workspace\n\t\t}\n\n\t\tif (isWorkspaceToOpen(workspaceA) && isWorkspaceToOpen(workspaceB)) {\n\t\t\treturn isEqual(workspaceA.workspaceUri, workspaceB.workspaceUri); // same workspace\n\t\t}\n\n\t\treturn false;\n\t}\n\n\thasRemote(): boolean {\n\t\tif (this.workspace) {\n\t\t\tif (isFolderToOpen(this.workspace)) {\n\t\t\t\treturn this.workspace.folderUri.scheme === Schemas.vscodeRemote;\n\t\t\t}\n\n\t\t\tif (isWorkspaceToOpen(this.workspace)) {\n\t\t\t\treturn this.workspace.workspaceUri.scheme === Schemas.vscodeRemote;\n\t\t\t}\n\t\t}\n\n\t\treturn true;\n\t}\n}\n\nfunction readCookie(name: string): string | undefined {\n\tconst cookies = document.cookie.split('; ');\n\tfor (const cookie of cookies) {\n\t\tif (cookie.startsWith(name + '=')) {\n\t\t\treturn cookie.substring(name.length + 1);\n\t\t}\n\t}\n\n\treturn undefined;\n}\n\n(function () {\n\n\t// Find config by checking for DOM\n\t// eslint-disable-next-line no-restricted-syntax\n\tconst configElement = mainWindow.document.getElementById('vscode-workbench-web-configuration');\n\tconst configElementAttribute = configElement ? configElement.getAttribute('data-settings') : undefined;\n\tif (!configElement || !configElementAttribute) {\n\t\tthrow new Error('Missing web configuration element');\n\t}\n\tconst config: IWorkbenchConstructionOptions & { folderUri?: UriComponents; workspaceUri?: UriComponents; callbackRoute: string } = JSON.parse(configElementAttribute);\n\tconst secretStorageKeyPath = readCookie('vscode-secret-key-path');\n\tconst secretStorageCrypto = secretStorageKeyPath && ServerKeyedAESCrypto.supported()\n\t\t? new ServerKeyedAESCrypto(secretStorageKeyPath) : new TransparentCrypto();\n\n\t// Create workbench\n\tcreate(mainWindow.document.body, {\n\t\t...config,\n\t\twindowIndicator: config.windowIndicator ?? { label: '$(remote)', tooltip: `${product.nameShort} Web` },\n\t\tsettingsSyncOptions: config.settingsSyncOptions ? { enabled: config.settingsSyncOptions.enabled, } : undefined,\n\t\tworkspaceProvider: WorkspaceProvider.create(config),\n\t\turlCallbackProvider: new LocalStorageURLCallbackProvider(config.callbackRoute),\n\t\tsecretStorageProvider: config.remoteAuthority && !secretStorageKeyPath\n\t\t\t? undefined /* with a remote without embedder-preferred storage, store on the remote */\n\t\t\t: new LocalStorageSecretStorageProvider(secretStorageCrypto),\n\t});\n})();\n"]}