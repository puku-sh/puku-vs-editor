{"version":3,"sources":["vs/platform/remoteTunnel/node/remoteTunnelService.ts"],"names":[],"mappings":"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","file":"remoteTunnelService.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { CONFIGURATION_KEY_HOST_NAME, CONFIGURATION_KEY_PREVENT_SLEEP, ConnectionInfo, IRemoteTunnelSession, IRemoteTunnelService, LOGGER_NAME, LOG_ID, TunnelStates, TunnelStatus, TunnelMode, INACTIVE_TUNNEL_MODE, ActiveTunnelMode } from '../common/remoteTunnel.js';\nimport { Emitter } from '../../../base/common/event.js';\nimport { ITelemetryService } from '../../telemetry/common/telemetry.js';\nimport { INativeEnvironmentService } from '../../environment/common/environment.js';\nimport { Disposable } from '../../../base/common/lifecycle.js';\nimport { ILogger, ILoggerService, LogLevelToString } from '../../log/common/log.js';\nimport { dirname, join } from '../../../base/common/path.js';\nimport { ChildProcess, StdioOptions, spawn } from 'child_process';\nimport { IProductService } from '../../product/common/productService.js';\nimport { isMacintosh, isWindows } from '../../../base/common/platform.js';\nimport { CancelablePromise, createCancelablePromise, Delayer } from '../../../base/common/async.js';\nimport { ISharedProcessLifecycleService } from '../../lifecycle/node/sharedProcessLifecycleService.js';\nimport { IConfigurationService } from '../../configuration/common/configuration.js';\nimport { localize } from '../../../nls.js';\nimport { hostname, homedir } from 'os';\nimport { IStorageService, StorageScope, StorageTarget } from '../../storage/common/storage.js';\nimport { isString } from '../../../base/common/types.js';\nimport { StreamSplitter } from '../../../base/node/nodeStreams.js';\nimport { joinPath } from '../../../base/common/resources.js';\n\ntype RemoteTunnelEnablementClassification = {\n\towner: 'aeschli';\n\tcomment: 'Reporting when Remote Tunnel access is turned on or off';\n\tenabled?: { classification: 'SystemMetaData'; purpose: 'FeatureInsight'; comment: 'Flag indicating if Remote Tunnel Access is enabled or not' };\n\tservice?: { classification: 'SystemMetaData'; purpose: 'FeatureInsight'; comment: 'Flag indicating if Remote Tunnel Access is installed as a service' };\n};\n\ntype RemoteTunnelEnablementEvent = {\n\tenabled: boolean;\n\tservice: boolean;\n};\n\nconst restartTunnelOnConfigurationChanges: readonly string[] = [\n\tCONFIGURATION_KEY_HOST_NAME,\n\tCONFIGURATION_KEY_PREVENT_SLEEP,\n];\n\n// This is the session used run the tunnel access.\n// if set, the remote tunnel access is currently enabled.\n// if not set, the remote tunnel access is currently disabled.\nconst TUNNEL_ACCESS_SESSION = 'remoteTunnelSession';\n// Boolean indicating whether the tunnel should be installed as a service.\nconst TUNNEL_ACCESS_IS_SERVICE = 'remoteTunnelIsService';\n\n/**\n * This service runs on the shared service. It is running the `code-tunnel` command\n * to make the current machine available for remote access.\n */\nexport class RemoteTunnelService extends Disposable implements IRemoteTunnelService {\n\n\tdeclare readonly _serviceBrand: undefined;\n\n\tprivate readonly _onDidTokenFailedEmitter = new Emitter<IRemoteTunnelSession | undefined>();\n\tpublic readonly onDidTokenFailed = this._onDidTokenFailedEmitter.event;\n\n\tprivate readonly _onDidChangeTunnelStatusEmitter = new Emitter<TunnelStatus>();\n\tpublic readonly onDidChangeTunnelStatus = this._onDidChangeTunnelStatusEmitter.event;\n\n\tprivate readonly _onDidChangeModeEmitter = new Emitter<TunnelMode>();\n\tpublic readonly onDidChangeMode = this._onDidChangeModeEmitter.event;\n\n\tprivate readonly _logger: ILogger;\n\n\t/**\n\t * \"Mode\" in the terminal state we want to get to -- started, stopped, and\n\t * the attributes associated with each.\n\t *\n\t * At any given time, work may be ongoing to get `_tunnelStatus` into a\n\t * state that reflects the desired `mode`.\n\t */\n\tprivate _mode: TunnelMode = INACTIVE_TUNNEL_MODE;\n\n\tprivate _tunnelProcess: CancelablePromise<any> | undefined;\n\n\tprivate _tunnelStatus: TunnelStatus;\n\tprivate _startTunnelProcessDelayer: Delayer<void>;\n\n\tprivate _tunnelCommand: string | undefined;\n\n\tprivate _initialized = false;\n\n\tconstructor(\n\t\t@ITelemetryService private readonly telemetryService: ITelemetryService,\n\t\t@IProductService private readonly productService: IProductService,\n\t\t@INativeEnvironmentService private readonly environmentService: INativeEnvironmentService,\n\t\t@ILoggerService loggerService: ILoggerService,\n\t\t@ISharedProcessLifecycleService sharedProcessLifecycleService: ISharedProcessLifecycleService,\n\t\t@IConfigurationService private readonly configurationService: IConfigurationService,\n\t\t@IStorageService private readonly storageService: IStorageService\n\t) {\n\t\tsuper();\n\t\tthis._logger = this._register(loggerService.createLogger(joinPath(environmentService.logsHome, `${LOG_ID}.log`), { id: LOG_ID, name: LOGGER_NAME }));\n\t\tthis._startTunnelProcessDelayer = new Delayer(100);\n\n\t\tthis._register(this._logger.onDidChangeLogLevel(l => this._logger.info('Log level changed to ' + LogLevelToString(l))));\n\n\t\tthis._register(sharedProcessLifecycleService.onWillShutdown(() => {\n\t\t\tthis._tunnelProcess?.cancel();\n\t\t\tthis._tunnelProcess = undefined;\n\t\t\tthis.dispose();\n\t\t}));\n\n\t\tthis._register(configurationService.onDidChangeConfiguration(e => {\n\t\t\tif (restartTunnelOnConfigurationChanges.some(c => e.affectsConfiguration(c))) {\n\t\t\t\tthis._startTunnelProcessDelayer.trigger(() => this.updateTunnelProcess());\n\t\t\t}\n\t\t}));\n\n\t\tthis._mode = this._restoreMode();\n\t\tthis._tunnelStatus = TunnelStates.uninitialized;\n\t}\n\n\tpublic async getTunnelStatus(): Promise<TunnelStatus> {\n\t\treturn this._tunnelStatus;\n\t}\n\n\tprivate setTunnelStatus(tunnelStatus: TunnelStatus) {\n\t\tthis._tunnelStatus = tunnelStatus;\n\t\tthis._onDidChangeTunnelStatusEmitter.fire(tunnelStatus);\n\t}\n\n\tprivate setMode(mode: TunnelMode) {\n\t\tif (isSameMode(this._mode, mode)) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._mode = mode;\n\t\tthis._storeMode(mode);\n\t\tthis._onDidChangeModeEmitter.fire(this._mode);\n\t\tif (mode.active) {\n\t\t\tthis._logger.info(`Session updated: ${mode.session.accountLabel} (${mode.session.providerId}) (service=${mode.asService})`);\n\t\t\tif (mode.session.token) {\n\t\t\t\tthis._logger.info(`Session token updated: ${mode.session.accountLabel} (${mode.session.providerId})`);\n\t\t\t}\n\t\t} else {\n\t\t\tthis._logger.info(`Session reset`);\n\t\t}\n\t}\n\n\tgetMode(): Promise<TunnelMode> {\n\t\treturn Promise.resolve(this._mode);\n\t}\n\n\tasync initialize(mode: TunnelMode): Promise<TunnelStatus> {\n\t\tif (this._initialized) {\n\t\t\treturn this._tunnelStatus;\n\t\t}\n\t\tthis._initialized = true;\n\t\tthis.setMode(mode);\n\t\ttry {\n\t\t\tawait this._startTunnelProcessDelayer.trigger(() => this.updateTunnelProcess());\n\t\t} catch (e) {\n\t\t\tthis._logger.error(e);\n\t\t}\n\t\treturn this._tunnelStatus;\n\t}\n\n\tprivate readonly defaultOnOutput = (a: string, isErr: boolean) => {\n\t\tif (isErr) {\n\t\t\tthis._logger.error(a);\n\t\t} else {\n\t\t\tthis._logger.info(a);\n\t\t}\n\t};\n\n\tprivate getTunnelCommandLocation() {\n\t\tif (!this._tunnelCommand) {\n\t\t\tlet binParentLocation;\n\t\t\tif (isMacintosh) {\n\t\t\t\t// appRoot = /Applications/Visual Studio Code - Insiders.app/Contents/Resources/app\n\t\t\t\t// bin = /Applications/Visual Studio Code - Insiders.app/Contents/Resources/app/bin\n\t\t\t\tbinParentLocation = this.environmentService.appRoot;\n\t\t\t} else {\n\t\t\t\t// appRoot = C:\\Users\\<name>\\AppData\\Local\\Programs\\Microsoft VS Code Insiders\\resources\\app\n\t\t\t\t// bin = C:\\Users\\<name>\\AppData\\Local\\Programs\\Microsoft VS Code Insiders\\bin\n\t\t\t\t// appRoot = /usr/share/code-insiders/resources/app\n\t\t\t\t// bin = /usr/share/code-insiders/bin\n\t\t\t\tbinParentLocation = dirname(dirname(this.environmentService.appRoot));\n\t\t\t}\n\t\t\tthis._tunnelCommand = join(binParentLocation, 'bin', `${this.productService.tunnelApplicationName}${isWindows ? '.exe' : ''}`);\n\t\t}\n\t\treturn this._tunnelCommand;\n\t}\n\n\tasync startTunnel(mode: ActiveTunnelMode): Promise<TunnelStatus> {\n\t\tif (isSameMode(this._mode, mode) && this._tunnelStatus.type !== 'disconnected') {\n\t\t\treturn this._tunnelStatus;\n\t\t}\n\n\t\tthis.setMode(mode);\n\n\t\ttry {\n\t\t\tawait this._startTunnelProcessDelayer.trigger(() => this.updateTunnelProcess());\n\t\t} catch (e) {\n\t\t\tthis._logger.error(e);\n\t\t}\n\t\treturn this._tunnelStatus;\n\t}\n\n\n\tasync stopTunnel(): Promise<void> {\n\t\tif (this._tunnelProcess) {\n\t\t\tthis._tunnelProcess.cancel();\n\t\t\tthis._tunnelProcess = undefined;\n\t\t}\n\n\t\tif (this._mode.active) {\n\t\t\t// Be careful to only uninstall the service if we're the ones who installed it:\n\t\t\tconst needsServiceUninstall = this._mode.asService;\n\t\t\tthis.setMode(INACTIVE_TUNNEL_MODE);\n\n\t\t\ttry {\n\t\t\t\tif (needsServiceUninstall) {\n\t\t\t\t\tthis.runCodeTunnelCommand('uninstallService', ['service', 'uninstall']);\n\t\t\t\t}\n\t\t\t} catch (e) {\n\t\t\t\tthis._logger.error(e);\n\t\t\t}\n\t\t}\n\n\t\ttry {\n\t\t\tawait this.runCodeTunnelCommand('stop', ['kill']);\n\t\t} catch (e) {\n\t\t\tthis._logger.error(e);\n\t\t}\n\n\t\tthis.setTunnelStatus(TunnelStates.disconnected());\n\t}\n\n\tprivate async updateTunnelProcess(): Promise<void> {\n\t\tthis.telemetryService.publicLog2<RemoteTunnelEnablementEvent, RemoteTunnelEnablementClassification>('remoteTunnel.enablement', {\n\t\t\tenabled: this._mode.active,\n\t\t\tservice: this._mode.active && this._mode.asService,\n\t\t});\n\n\t\tif (this._tunnelProcess) {\n\t\t\tthis._tunnelProcess.cancel();\n\t\t\tthis._tunnelProcess = undefined;\n\t\t}\n\n\t\tlet output = '';\n\t\tlet isServiceInstalled = false;\n\t\tconst onOutput = (a: string, isErr: boolean) => {\n\t\t\tif (isErr) {\n\t\t\t\tthis._logger.error(a);\n\t\t\t} else {\n\t\t\t\toutput += a;\n\t\t\t}\n\t\t\tif (!this.environmentService.isBuilt && a.startsWith('   Compiling')) {\n\t\t\t\tthis.setTunnelStatus(TunnelStates.connecting(localize('remoteTunnelService.building', 'Building CLI from sources')));\n\t\t\t}\n\t\t};\n\n\t\tconst statusProcess = this.runCodeTunnelCommand('status', ['status'], onOutput);\n\t\tthis._tunnelProcess = statusProcess;\n\t\ttry {\n\t\t\tawait statusProcess;\n\t\t\tif (this._tunnelProcess !== statusProcess) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// split and find the line, since in dev builds additional noise is\n\t\t\t// added by cargo to the output.\n\t\t\tlet status: {\n\t\t\t\tservice_installed: boolean;\n\t\t\t\ttunnel: object | null;\n\t\t\t};\n\n\t\t\ttry {\n\t\t\t\tstatus = JSON.parse(output.trim().split('\\n').find(l => l.startsWith('{'))!);\n\t\t\t} catch (e) {\n\t\t\t\tthis._logger.error(`Could not parse status output: ${JSON.stringify(output.trim())}`);\n\t\t\t\tthis.setTunnelStatus(TunnelStates.disconnected());\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tisServiceInstalled = status.service_installed;\n\t\t\tthis._logger.info(status.tunnel ? 'Other tunnel running, attaching...' : 'No other tunnel running');\n\n\t\t\t// If a tunnel is running but the mode isn't \"active\", we'll still attach\n\t\t\t// to the tunnel to show its state in the UI. If neither are true, disconnect\n\t\t\tif (!status.tunnel && !this._mode.active) {\n\t\t\t\tthis.setTunnelStatus(TunnelStates.disconnected());\n\t\t\t\treturn;\n\t\t\t}\n\t\t} catch (e) {\n\t\t\tthis._logger.error(e);\n\t\t\tthis.setTunnelStatus(TunnelStates.disconnected());\n\t\t\treturn;\n\t\t} finally {\n\t\t\tif (this._tunnelProcess === statusProcess) {\n\t\t\t\tthis._tunnelProcess = undefined;\n\t\t\t}\n\t\t}\n\n\t\tconst session = this._mode.active ? this._mode.session : undefined;\n\t\tif (session && session.token) {\n\t\t\tconst token = session.token;\n\t\t\tthis.setTunnelStatus(TunnelStates.connecting(localize({ key: 'remoteTunnelService.authorizing', comment: ['{0} is a user account name, {1} a provider name (e.g. Github)'] }, 'Connecting as {0} ({1})', session.accountLabel, session.providerId)));\n\t\t\tconst onLoginOutput = (a: string, isErr: boolean) => {\n\t\t\t\ta = a.replaceAll(token, '*'.repeat(4));\n\t\t\t\tonOutput(a, isErr);\n\t\t\t};\n\t\t\tconst loginProcess = this.runCodeTunnelCommand('login', ['user', 'login', '--provider', session.providerId, '--log', LogLevelToString(this._logger.getLevel())], onLoginOutput, { VSCODE_CLI_ACCESS_TOKEN: token });\n\t\t\tthis._tunnelProcess = loginProcess;\n\t\t\ttry {\n\t\t\t\tawait loginProcess;\n\t\t\t\tif (this._tunnelProcess !== loginProcess) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t} catch (e) {\n\t\t\t\tthis._logger.error(e);\n\t\t\t\tthis._tunnelProcess = undefined;\n\t\t\t\tthis._onDidTokenFailedEmitter.fire(session);\n\t\t\t\tthis.setTunnelStatus(TunnelStates.disconnected(session));\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tconst hostName = this._getTunnelName();\n\t\tif (hostName) {\n\t\t\tthis.setTunnelStatus(TunnelStates.connecting(localize({ key: 'remoteTunnelService.openTunnelWithName', comment: ['{0} is a tunnel name'] }, 'Opening tunnel {0}', hostName)));\n\t\t} else {\n\t\t\tthis.setTunnelStatus(TunnelStates.connecting(localize('remoteTunnelService.openTunnel', 'Opening tunnel')));\n\t\t}\n\t\tconst args = ['--accept-server-license-terms', '--log', LogLevelToString(this._logger.getLevel())];\n\t\tif (hostName) {\n\t\t\targs.push('--name', hostName);\n\t\t} else {\n\t\t\targs.push('--random-name');\n\t\t}\n\n\t\tlet serviceInstallFailed = false;\n\t\tif (this._mode.active && this._mode.asService && !isServiceInstalled) {\n\t\t\t// I thought about calling `code tunnel kill` here, but having multiple\n\t\t\t// tunnel processes running is pretty much idempotent. If there's\n\t\t\t// another tunnel process running, the service process will\n\t\t\t// take over when it exits, no hard feelings.\n\t\t\tserviceInstallFailed = await this.installTunnelService(args) === false;\n\t\t}\n\n\t\treturn this.serverOrAttachTunnel(session, args, serviceInstallFailed);\n\t}\n\n\tprivate async installTunnelService(args: readonly string[]) {\n\t\tlet status: number;\n\t\ttry {\n\t\t\tstatus = await this.runCodeTunnelCommand('serviceInstall', ['service', 'install', ...args]);\n\t\t} catch (e) {\n\t\t\tthis._logger.error(e);\n\t\t\tstatus = 1;\n\t\t}\n\n\t\tif (status !== 0) {\n\t\t\tconst msg = localize('remoteTunnelService.serviceInstallFailed', 'Failed to install tunnel as a service, starting in session...');\n\t\t\tthis._logger.warn(msg);\n\t\t\tthis.setTunnelStatus(TunnelStates.connecting(msg));\n\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t}\n\n\tprivate async serverOrAttachTunnel(session: IRemoteTunnelSession | undefined, args: string[], serviceInstallFailed: boolean) {\n\t\targs.push('--parent-process-id', String(process.pid));\n\n\t\tif (this._preventSleep()) {\n\t\t\targs.push('--no-sleep');\n\t\t}\n\n\t\tlet isAttached = false;\n\t\tconst serveCommand = this.runCodeTunnelCommand('tunnel', args, (message: string, isErr: boolean) => {\n\t\t\tif (isErr) {\n\t\t\t\tthis._logger.error(message);\n\t\t\t} else {\n\t\t\t\tthis._logger.info(message);\n\t\t\t}\n\n\t\t\tif (message.includes('Connected to an existing tunnel process')) {\n\t\t\t\tisAttached = true;\n\t\t\t}\n\n\t\t\tconst m = message.match(/Open this link in your browser (https:\\/\\/([^\\/\\s]+)\\/([^\\/\\s]+)\\/([^\\/\\s]+))/);\n\t\t\tif (m) {\n\t\t\t\tconst info: ConnectionInfo = { link: m[1], domain: m[2], tunnelName: m[4], isAttached };\n\t\t\t\tthis.setTunnelStatus(TunnelStates.connected(info, serviceInstallFailed));\n\t\t\t} else if (message.match(/error refreshing token/)) {\n\t\t\t\tserveCommand.cancel();\n\t\t\t\tthis._onDidTokenFailedEmitter.fire(session);\n\t\t\t\tthis.setTunnelStatus(TunnelStates.disconnected(session));\n\t\t\t}\n\t\t});\n\t\tthis._tunnelProcess = serveCommand;\n\t\tserveCommand.finally(() => {\n\t\t\tif (serveCommand === this._tunnelProcess) {\n\t\t\t\t// process exited unexpectedly\n\t\t\t\tthis._logger.info(`tunnel process terminated`);\n\t\t\t\tthis._tunnelProcess = undefined;\n\t\t\t\tthis._mode = INACTIVE_TUNNEL_MODE;\n\n\t\t\t\tthis.setTunnelStatus(TunnelStates.disconnected());\n\t\t\t}\n\t\t});\n\t}\n\n\tprivate runCodeTunnelCommand(logLabel: string, commandArgs: string[], onOutput: (message: string, isError: boolean) => void = this.defaultOnOutput, env?: Record<string, string>): CancelablePromise<number> {\n\t\treturn createCancelablePromise<number>(token => {\n\t\t\treturn new Promise((resolve, reject) => {\n\t\t\t\tif (token.isCancellationRequested) {\n\t\t\t\t\tresolve(-1);\n\t\t\t\t}\n\t\t\t\tlet tunnelProcess: ChildProcess | undefined;\n\t\t\t\tconst stdio: StdioOptions = ['ignore', 'pipe', 'pipe'];\n\n\t\t\t\ttoken.onCancellationRequested(() => {\n\t\t\t\t\tif (tunnelProcess) {\n\t\t\t\t\t\tthis._logger.info(`${logLabel} terminating(${tunnelProcess.pid})`);\n\t\t\t\t\t\ttunnelProcess.kill();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tif (!this.environmentService.isBuilt) {\n\t\t\t\t\tonOutput('Building tunnel CLI from sources and run\\n', false);\n\t\t\t\t\tonOutput(`${logLabel} Spawning: cargo run -- tunnel ${commandArgs.join(' ')}\\n`, false);\n\t\t\t\t\ttunnelProcess = spawn('cargo', ['run', '--', 'tunnel', ...commandArgs], { cwd: join(this.environmentService.appRoot, 'cli'), stdio, env: { ...process.env, RUST_BACKTRACE: '1', ...env } });\n\t\t\t\t} else {\n\t\t\t\t\tonOutput('Running tunnel CLI\\n', false);\n\t\t\t\t\tconst tunnelCommand = this.getTunnelCommandLocation();\n\t\t\t\t\tonOutput(`${logLabel} Spawning: ${tunnelCommand} tunnel ${commandArgs.join(' ')}\\n`, false);\n\t\t\t\t\ttunnelProcess = spawn(tunnelCommand, ['tunnel', ...commandArgs], { cwd: homedir(), stdio, env: { ...process.env, ...env } });\n\t\t\t\t}\n\n\t\t\t\ttunnelProcess.stdout!.pipe(new StreamSplitter('\\n')).on('data', data => {\n\t\t\t\t\tif (tunnelProcess) {\n\t\t\t\t\t\tconst message = data.toString();\n\t\t\t\t\t\tonOutput(message, false);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\ttunnelProcess.stderr!.pipe(new StreamSplitter('\\n')).on('data', data => {\n\t\t\t\t\tif (tunnelProcess) {\n\t\t\t\t\t\tconst message = data.toString();\n\t\t\t\t\t\tonOutput(message, true);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\ttunnelProcess.on('exit', e => {\n\t\t\t\t\tif (tunnelProcess) {\n\t\t\t\t\t\tonOutput(`${logLabel} exit(${tunnelProcess.pid}): + ${e} `, false);\n\t\t\t\t\t\ttunnelProcess = undefined;\n\t\t\t\t\t\tresolve(e || 0);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\ttunnelProcess.on('error', e => {\n\t\t\t\t\tif (tunnelProcess) {\n\t\t\t\t\t\tonOutput(`${logLabel} error(${tunnelProcess.pid}): + ${e} `, true);\n\t\t\t\t\t\ttunnelProcess = undefined;\n\t\t\t\t\t\treject();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\t}\n\n\tpublic async getTunnelName(): Promise<string | undefined> {\n\t\treturn this._getTunnelName();\n\t}\n\n\tprivate _preventSleep() {\n\t\treturn !!this.configurationService.getValue<boolean>(CONFIGURATION_KEY_PREVENT_SLEEP);\n\t}\n\n\tprivate _getTunnelName(): string | undefined {\n\t\tlet name = this.configurationService.getValue<string>(CONFIGURATION_KEY_HOST_NAME) || hostname();\n\t\tname = name.replace(/^-+/g, '').replace(/[^\\w-]/g, '').substring(0, 20);\n\t\treturn name || undefined;\n\t}\n\n\tprivate _restoreMode(): TunnelMode {\n\t\ttry {\n\t\t\tconst tunnelAccessSession = this.storageService.get(TUNNEL_ACCESS_SESSION, StorageScope.APPLICATION);\n\t\t\tconst asService = this.storageService.getBoolean(TUNNEL_ACCESS_IS_SERVICE, StorageScope.APPLICATION, false);\n\t\t\tif (tunnelAccessSession) {\n\t\t\t\tconst session = JSON.parse(tunnelAccessSession) as IRemoteTunnelSession;\n\t\t\t\tif (session && isString(session.accountLabel) && isString(session.sessionId) && isString(session.providerId)) {\n\t\t\t\t\treturn { active: true, session, asService };\n\t\t\t\t}\n\t\t\t\tthis._logger.error('Problems restoring session from storage, invalid format', session);\n\t\t\t}\n\t\t} catch (e) {\n\t\t\tthis._logger.error('Problems restoring session from storage', e);\n\t\t}\n\t\treturn INACTIVE_TUNNEL_MODE;\n\t}\n\n\tprivate _storeMode(mode: TunnelMode): void {\n\t\tif (mode.active) {\n\t\t\tconst sessionWithoutToken = {\n\t\t\t\tproviderId: mode.session.providerId, sessionId: mode.session.sessionId, accountLabel: mode.session.accountLabel\n\t\t\t};\n\t\t\tthis.storageService.store(TUNNEL_ACCESS_SESSION, JSON.stringify(sessionWithoutToken), StorageScope.APPLICATION, StorageTarget.MACHINE);\n\t\t\tthis.storageService.store(TUNNEL_ACCESS_IS_SERVICE, mode.asService, StorageScope.APPLICATION, StorageTarget.MACHINE);\n\t\t} else {\n\t\t\tthis.storageService.remove(TUNNEL_ACCESS_SESSION, StorageScope.APPLICATION);\n\t\t\tthis.storageService.remove(TUNNEL_ACCESS_IS_SERVICE, StorageScope.APPLICATION);\n\t\t}\n\t}\n}\n\nfunction isSameSession(a1: IRemoteTunnelSession | undefined, a2: IRemoteTunnelSession | undefined): boolean {\n\tif (a1 && a2) {\n\t\treturn a1.sessionId === a2.sessionId && a1.providerId === a2.providerId && a1.token === a2.token;\n\t}\n\treturn a1 === a2;\n}\n\nconst isSameMode = (a: TunnelMode, b: TunnelMode) => {\n\tif (a.active !== b.active) {\n\t\treturn false;\n\t} else if (a.active && b.active) {\n\t\treturn a.asService === b.asService && isSameSession(a.session, b.session);\n\t} else {\n\t\treturn true;\n\t}\n};\n"]}