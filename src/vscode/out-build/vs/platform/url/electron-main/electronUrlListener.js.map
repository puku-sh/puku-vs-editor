{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/platform/url/electron-main/electronUrlListener.ts","vs/platform/url/electron-main/electronUrlListener.ts"],"names":[],"mappings":"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","file":"electronUrlListener.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { app, Event as ElectronEvent } from 'electron';\nimport { disposableTimeout } from '../../../base/common/async.js';\nimport { Event } from '../../../base/common/event.js';\nimport { Disposable } from '../../../base/common/lifecycle.js';\nimport { isWindows, isMacintosh } from '../../../base/common/platform.js';\nimport { URI } from '../../../base/common/uri.js';\nimport { IEnvironmentMainService } from '../../environment/electron-main/environmentMainService.js';\nimport { ILogService } from '../../log/common/log.js';\nimport { IProductService } from '../../product/common/productService.js';\nimport { IURLService } from '../common/url.js';\nimport { IProtocolUrl } from './url.js';\nimport { IWindowsMainService } from '../../windows/electron-main/windows.js';\n\n/**\n * A listener for URLs that are opened from the OS and handled by VSCode.\n * Depending on the platform, this works differently:\n * - Windows: we use `app.setAsDefaultProtocolClient()` to register VSCode with the OS\n *            and additionally add the `open-url` command line argument to identify.\n * - macOS:   we rely on `app.on('open-url')` to be called by the OS\n * - Linux:   we have a special shortcut installed (`resources/linux/code-url-handler.desktop`)\n *            that calls VSCode with the `open-url` command line argument\n *            (https://github.com/microsoft/vscode/pull/56727)\n */\nexport class ElectronURLListener extends Disposable {\n\n\tprivate uris: IProtocolUrl[] = [];\n\tprivate retryCount = 0;\n\n\tconstructor(\n\t\tinitialProtocolUrls: IProtocolUrl[] | undefined,\n\t\tprivate readonly urlService: IURLService,\n\t\twindowsMainService: IWindowsMainService,\n\t\tenvironmentMainService: IEnvironmentMainService,\n\t\tproductService: IProductService,\n\t\tprivate readonly logService: ILogService\n\t) {\n\t\tsuper();\n\n\t\tif (initialProtocolUrls) {\n\t\t\tlogService.trace('ElectronURLListener initialUrisToHandle:', initialProtocolUrls.map(url => url.originalUrl));\n\n\t\t\t// the initial set of URIs we need to handle once the window is ready\n\t\t\tthis.uris = initialProtocolUrls;\n\t\t}\n\n\t\t// Windows: install as protocol handler\n\t\tif (isWindows) {\n\t\t\tconst windowsParameters = environmentMainService.isBuilt ? [] : [`\"${environmentMainService.appRoot}\"`];\n\t\t\twindowsParameters.push('--open-url', '--');\n\t\t\tapp.setAsDefaultProtocolClient(productService.urlProtocol, process.execPath, windowsParameters);\n\t\t}\n\n\t\t// macOS: register protocol handler (especially important for development mode)\n\t\tif (isMacintosh) {\n\t\t\tlogService.trace('ElectronURLListener: registering protocol handler for macOS:', productService.urlProtocol);\n\t\t\tapp.setAsDefaultProtocolClient(productService.urlProtocol);\n\t\t}\n\n\t\t// macOS: listen to `open-url` events from here on to handle\n\t\tconst onOpenElectronUrl = Event.map(\n\t\t\tEvent.fromNodeEventEmitter(app, 'open-url', (event: ElectronEvent, url: string) => ({ event, url })),\n\t\t\t({ event, url }) => {\n\t\t\t\tevent.preventDefault(); // always prevent default and return the url as string\n\n\t\t\t\treturn url;\n\t\t\t});\n\n\t\tthis._register(onOpenElectronUrl(url => {\n\t\t\tconst uri = this.uriFromRawUrl(url);\n\t\t\tif (!uri) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.urlService.open(uri, { originalUrl: url });\n\t\t}));\n\n\t\t// Send initial links to the window once it has loaded\n\t\tconst isWindowReady = windowsMainService.getWindows()\n\t\t\t.filter(window => window.isReady)\n\t\t\t.length > 0;\n\n\t\tif (isWindowReady) {\n\t\t\tlogService.trace('ElectronURLListener: window is ready to handle URLs');\n\n\t\t\tthis.flush();\n\t\t} else {\n\t\t\tlogService.trace('ElectronURLListener: waiting for window to be ready to handle URLs...');\n\n\t\t\tthis._register(Event.once(windowsMainService.onDidSignalReadyWindow)(() => this.flush()));\n\t\t}\n\t}\n\n\tprivate uriFromRawUrl(url: string): URI | undefined {\n\t\ttry {\n\t\t\treturn URI.parse(url);\n\t\t} catch (e) {\n\t\t\treturn undefined;\n\t\t}\n\t}\n\n\tprivate async flush(): Promise<void> {\n\t\tif (this.retryCount++ > 10) {\n\t\t\tthis.logService.trace('ElectronURLListener#flush(): giving up after 10 retries');\n\n\t\t\treturn;\n\t\t}\n\n\t\tthis.logService.trace('ElectronURLListener#flush(): flushing URLs');\n\n\t\tconst uris: IProtocolUrl[] = [];\n\n\t\tfor (const obj of this.uris) {\n\t\t\tconst handled = await this.urlService.open(obj.uri, { originalUrl: obj.originalUrl });\n\t\t\tif (handled) {\n\t\t\t\tthis.logService.trace('ElectronURLListener#flush(): URL was handled', obj.originalUrl);\n\t\t\t} else {\n\t\t\t\tthis.logService.trace('ElectronURLListener#flush(): URL was not yet handled', obj.originalUrl);\n\n\t\t\t\turis.push(obj);\n\t\t\t}\n\t\t}\n\n\t\tif (uris.length === 0) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.uris = uris;\n\t\tdisposableTimeout(() => this.flush(), 500, this._store);\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { app, Event as ElectronEvent } from 'electron';\nimport { disposableTimeout } from '../../../base/common/async.js';\nimport { Event } from '../../../base/common/event.js';\nimport { Disposable } from '../../../base/common/lifecycle.js';\nimport { isWindows, isMacintosh } from '../../../base/common/platform.js';\nimport { URI } from '../../../base/common/uri.js';\nimport { IEnvironmentMainService } from '../../environment/electron-main/environmentMainService.js';\nimport { ILogService } from '../../log/common/log.js';\nimport { IProductService } from '../../product/common/productService.js';\nimport { IURLService } from '../common/url.js';\nimport { IProtocolUrl } from './url.js';\nimport { IWindowsMainService } from '../../windows/electron-main/windows.js';\n\n/**\n * A listener for URLs that are opened from the OS and handled by VSCode.\n * Depending on the platform, this works differently:\n * - Windows: we use `app.setAsDefaultProtocolClient()` to register VSCode with the OS\n *            and additionally add the `open-url` command line argument to identify.\n * - macOS:   we rely on `app.on('open-url')` to be called by the OS\n * - Linux:   we have a special shortcut installed (`resources/linux/code-url-handler.desktop`)\n *            that calls VSCode with the `open-url` command line argument\n *            (https://github.com/microsoft/vscode/pull/56727)\n */\nexport class ElectronURLListener extends Disposable {\n\n\tprivate uris: IProtocolUrl[] = [];\n\tprivate retryCount = 0;\n\n\tconstructor(\n\t\tinitialProtocolUrls: IProtocolUrl[] | undefined,\n\t\tprivate readonly urlService: IURLService,\n\t\twindowsMainService: IWindowsMainService,\n\t\tenvironmentMainService: IEnvironmentMainService,\n\t\tproductService: IProductService,\n\t\tprivate readonly logService: ILogService\n\t) {\n\t\tsuper();\n\n\t\tif (initialProtocolUrls) {\n\t\t\tlogService.trace('ElectronURLListener initialUrisToHandle:', initialProtocolUrls.map(url => url.originalUrl));\n\n\t\t\t// the initial set of URIs we need to handle once the window is ready\n\t\t\tthis.uris = initialProtocolUrls;\n\t\t}\n\n\t\t// Windows: install as protocol handler\n\t\tif (isWindows) {\n\t\t\tconst windowsParameters = environmentMainService.isBuilt ? [] : [`\"${environmentMainService.appRoot}\"`];\n\t\t\twindowsParameters.push('--open-url', '--');\n\t\t\tapp.setAsDefaultProtocolClient(productService.urlProtocol, process.execPath, windowsParameters);\n\t\t}\n\n\t\t// macOS: register protocol handler (especially important for development mode)\n\t\tif (isMacintosh) {\n\t\t\tlogService.trace('ElectronURLListener: registering protocol handler for macOS:', productService.urlProtocol);\n\t\t\tapp.setAsDefaultProtocolClient(productService.urlProtocol);\n\t\t}\n\n\t\t// macOS: listen to `open-url` events from here on to handle\n\t\tconst onOpenElectronUrl = Event.map(\n\t\t\tEvent.fromNodeEventEmitter(app, 'open-url', (event: ElectronEvent, url: string) => ({ event, url })),\n\t\t\t({ event, url }) => {\n\t\t\t\tevent.preventDefault(); // always prevent default and return the url as string\n\n\t\t\t\treturn url;\n\t\t\t});\n\n\t\tthis._register(onOpenElectronUrl(url => {\n\t\t\tconst uri = this.uriFromRawUrl(url);\n\t\t\tif (!uri) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.urlService.open(uri, { originalUrl: url });\n\t\t}));\n\n\t\t// Send initial links to the window once it has loaded\n\t\tconst isWindowReady = windowsMainService.getWindows()\n\t\t\t.filter(window => window.isReady)\n\t\t\t.length > 0;\n\n\t\tif (isWindowReady) {\n\t\t\tlogService.trace('ElectronURLListener: window is ready to handle URLs');\n\n\t\t\tthis.flush();\n\t\t} else {\n\t\t\tlogService.trace('ElectronURLListener: waiting for window to be ready to handle URLs...');\n\n\t\t\tthis._register(Event.once(windowsMainService.onDidSignalReadyWindow)(() => this.flush()));\n\t\t}\n\t}\n\n\tprivate uriFromRawUrl(url: string): URI | undefined {\n\t\ttry {\n\t\t\treturn URI.parse(url);\n\t\t} catch (e) {\n\t\t\treturn undefined;\n\t\t}\n\t}\n\n\tprivate async flush(): Promise<void> {\n\t\tif (this.retryCount++ > 10) {\n\t\t\tthis.logService.trace('ElectronURLListener#flush(): giving up after 10 retries');\n\n\t\t\treturn;\n\t\t}\n\n\t\tthis.logService.trace('ElectronURLListener#flush(): flushing URLs');\n\n\t\tconst uris: IProtocolUrl[] = [];\n\n\t\tfor (const obj of this.uris) {\n\t\t\tconst handled = await this.urlService.open(obj.uri, { originalUrl: obj.originalUrl });\n\t\t\tif (handled) {\n\t\t\t\tthis.logService.trace('ElectronURLListener#flush(): URL was handled', obj.originalUrl);\n\t\t\t} else {\n\t\t\t\tthis.logService.trace('ElectronURLListener#flush(): URL was not yet handled', obj.originalUrl);\n\n\t\t\t\turis.push(obj);\n\t\t\t}\n\t\t}\n\n\t\tif (uris.length === 0) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.uris = uris;\n\t\tdisposableTimeout(() => this.flush(), 500, this._store);\n\t}\n}\n"]}