{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/platform/userDataSync/test/common/userDataProfilesManifestSync.test.ts","vs/platform/userDataSync/test/common/userDataProfilesManifestSync.test.ts"],"names":[],"mappings":"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","file":"userDataProfilesManifestSync.test.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport assert from 'assert';\nimport { runWithFakedTimers } from '../../../../base/test/common/timeTravelScheduler.js';\nimport { ensureNoDisposablesAreLeakedInTestSuite } from '../../../../base/test/common/utils.js';\nimport { IUserDataProfilesService } from '../../../userDataProfile/common/userDataProfile.js';\nimport { UserDataProfilesManifestSynchroniser } from '../../common/userDataProfilesManifestSync.js';\nimport { ISyncData, ISyncUserDataProfile, IUserDataSyncStoreService, SyncResource, SyncStatus } from '../../common/userDataSync.js';\nimport { UserDataSyncClient, UserDataSyncTestServer } from './userDataSyncClient.js';\n\nsuite('UserDataProfilesManifestSync', () => {\n\n\tconst server = new UserDataSyncTestServer();\n\tlet testClient: UserDataSyncClient;\n\tlet client2: UserDataSyncClient;\n\n\tlet testObject: UserDataProfilesManifestSynchroniser;\n\n\tteardown(async () => {\n\t\tawait testClient.instantiationService.get(IUserDataSyncStoreService).clear();\n\t});\n\n\tconst disposableStore = ensureNoDisposablesAreLeakedInTestSuite();\n\n\tsetup(async () => {\n\t\ttestClient = disposableStore.add(new UserDataSyncClient(server));\n\t\tawait testClient.setUp(true);\n\t\ttestObject = testClient.getSynchronizer(SyncResource.Profiles) as UserDataProfilesManifestSynchroniser;\n\n\t\tclient2 = disposableStore.add(new UserDataSyncClient(server));\n\t\tawait client2.setUp(true);\n\t});\n\n\ttest('when profiles does not exist', async () => {\n\t\tawait runWithFakedTimers<void>({}, async () => {\n\t\t\tassert.deepStrictEqual(await testObject.getLastSyncUserData(), null);\n\t\t\tlet manifest = await testClient.getLatestRef(SyncResource.Profiles);\n\t\t\tserver.reset();\n\t\t\tawait testObject.sync(manifest);\n\n\t\t\tassert.deepStrictEqual(server.requests, []);\n\n\t\t\tconst lastSyncUserData = await testObject.getLastSyncUserData();\n\t\t\tconst remoteUserData = await testObject.getRemoteUserData(null);\n\t\t\tassert.deepStrictEqual(lastSyncUserData!.ref, remoteUserData.ref);\n\t\t\tassert.deepStrictEqual(lastSyncUserData!.syncData, remoteUserData.syncData);\n\t\t\tassert.strictEqual(lastSyncUserData!.syncData, null);\n\n\t\t\tmanifest = await testClient.getLatestRef(SyncResource.Profiles);\n\t\t\tserver.reset();\n\t\t\tawait testObject.sync(manifest);\n\t\t\tassert.deepStrictEqual(server.requests, []);\n\n\t\t\tmanifest = await testClient.getLatestRef(SyncResource.Profiles);\n\t\t\tserver.reset();\n\t\t\tawait testObject.sync(manifest);\n\t\t\tassert.deepStrictEqual(server.requests, []);\n\t\t});\n\t});\n\n\ttest('when profile is created after first sync', async () => {\n\t\tawait runWithFakedTimers<void>({}, async () => {\n\t\t\tawait testObject.sync(await testClient.getLatestRef(SyncResource.Profiles));\n\t\t\tawait testClient.instantiationService.get(IUserDataProfilesService).createProfile('1', '1');\n\n\t\t\tlet lastSyncUserData = await testObject.getLastSyncUserData();\n\t\t\tconst manifest = await testClient.getLatestRef(SyncResource.Profiles);\n\t\t\tserver.reset();\n\t\t\tawait testObject.sync(manifest);\n\n\t\t\tassert.deepStrictEqual(server.requests, [\n\t\t\t\t{ type: 'POST', url: `${server.url}/v1/collection`, headers: {} },\n\t\t\t\t{ type: 'POST', url: `${server.url}/v1/resource/${testObject.resource}`, headers: { 'If-Match': lastSyncUserData?.ref } },\n\t\t\t]);\n\n\t\t\tlastSyncUserData = await testObject.getLastSyncUserData();\n\t\t\tconst remoteUserData = await testObject.getRemoteUserData(null);\n\t\t\tassert.deepStrictEqual(lastSyncUserData!.ref, remoteUserData.ref);\n\t\t\tassert.deepStrictEqual(lastSyncUserData!.syncData, remoteUserData.syncData);\n\t\t\tassert.deepStrictEqual(JSON.parse(lastSyncUserData!.syncData!.content), [{ 'name': '1', 'id': '1', 'collection': '1' }]);\n\t\t});\n\t});\n\n\ttest('first time sync - outgoing to server (no state)', async () => {\n\t\tawait runWithFakedTimers<void>({}, async () => {\n\t\t\tawait testClient.instantiationService.get(IUserDataProfilesService).createProfile('1', '1');\n\n\t\t\tawait testObject.sync(await testClient.getLatestRef(SyncResource.Profiles));\n\t\t\tassert.strictEqual(testObject.status, SyncStatus.Idle);\n\t\t\tassert.deepStrictEqual(testObject.conflicts.conflicts, []);\n\n\t\t\tconst { content } = await testClient.read(testObject.resource);\n\t\t\tassert.ok(content !== null);\n\t\t\tassert.deepStrictEqual(JSON.parse(JSON.parse(content).content), [{ 'name': '1', 'id': '1', 'collection': '1' }]);\n\t\t});\n\t});\n\n\ttest('first time sync - incoming from server (no state)', async () => {\n\t\tawait runWithFakedTimers<void>({}, async () => {\n\t\t\tawait client2.instantiationService.get(IUserDataProfilesService).createProfile('1', 'name 1');\n\t\t\tawait client2.sync();\n\n\t\t\tawait testObject.sync(await testClient.getLatestRef(SyncResource.Profiles));\n\t\t\tassert.strictEqual(testObject.status, SyncStatus.Idle);\n\t\t\tassert.deepStrictEqual(testObject.conflicts.conflicts, []);\n\n\t\t\tconst profiles = getLocalProfiles(testClient);\n\t\t\tassert.deepStrictEqual(profiles, [{ id: '1', name: 'name 1', useDefaultFlags: undefined }]);\n\t\t});\n\t});\n\n\ttest('first time sync when profiles exists', async () => {\n\t\tawait runWithFakedTimers<void>({}, async () => {\n\t\t\tawait client2.instantiationService.get(IUserDataProfilesService).createProfile('1', 'name 1');\n\t\t\tawait client2.sync();\n\n\t\t\tawait testClient.instantiationService.get(IUserDataProfilesService).createProfile('2', 'name 2');\n\t\t\tawait testObject.sync(await testClient.getLatestRef(SyncResource.Profiles));\n\t\t\tassert.strictEqual(testObject.status, SyncStatus.Idle);\n\t\t\tassert.deepStrictEqual(testObject.conflicts.conflicts, []);\n\n\t\t\tconst profiles = getLocalProfiles(testClient);\n\t\t\tassert.deepStrictEqual(profiles, [{ id: '1', name: 'name 1', useDefaultFlags: undefined }, { id: '2', name: 'name 2', useDefaultFlags: undefined }]);\n\n\t\t\tconst { content } = await testClient.read(testObject.resource);\n\t\t\tassert.ok(content !== null);\n\t\t\tconst actual = parseRemoteProfiles(content);\n\t\t\tassert.deepStrictEqual(actual, [{ id: '1', name: 'name 1', collection: '1' }, { id: '2', name: 'name 2', collection: '2' }]);\n\t\t});\n\t});\n\n\ttest('first time sync when storage exists - has conflicts', async () => {\n\t\tawait runWithFakedTimers<void>({}, async () => {\n\t\t\tawait client2.instantiationService.get(IUserDataProfilesService).createProfile('1', 'name 1');\n\t\t\tawait client2.sync();\n\n\t\t\tawait testClient.instantiationService.get(IUserDataProfilesService).createProfile('1', 'name 2');\n\t\t\tawait testObject.sync(await testClient.getLatestRef(SyncResource.Profiles));\n\n\t\t\tassert.strictEqual(testObject.status, SyncStatus.Idle);\n\t\t\tassert.deepStrictEqual(testObject.conflicts.conflicts, []);\n\n\t\t\tconst profiles = getLocalProfiles(testClient);\n\t\t\tassert.deepStrictEqual(profiles, [{ id: '1', name: 'name 1', useDefaultFlags: undefined }]);\n\n\t\t\tconst { content } = await testClient.read(testObject.resource);\n\t\t\tassert.ok(content !== null);\n\t\t\tconst actual = parseRemoteProfiles(content);\n\t\t\tassert.deepStrictEqual(actual, [{ id: '1', name: 'name 1', collection: '1' }]);\n\t\t});\n\t});\n\n\ttest('sync adding a profile', async () => {\n\t\tawait runWithFakedTimers<void>({}, async () => {\n\t\t\tawait testClient.instantiationService.get(IUserDataProfilesService).createProfile('1', 'name 1');\n\t\t\tawait testObject.sync(await testClient.getLatestRef(SyncResource.Profiles));\n\t\t\tawait client2.sync();\n\n\t\t\tawait testClient.instantiationService.get(IUserDataProfilesService).createProfile('2', 'name 2');\n\t\t\tawait testObject.sync(await testClient.getLatestRef(SyncResource.Profiles));\n\t\t\tassert.strictEqual(testObject.status, SyncStatus.Idle);\n\t\t\tassert.deepStrictEqual(testObject.conflicts.conflicts, []);\n\t\t\tassert.deepStrictEqual(getLocalProfiles(testClient), [{ id: '1', name: 'name 1', useDefaultFlags: undefined }, { id: '2', name: 'name 2', useDefaultFlags: undefined }]);\n\n\t\t\tawait client2.sync();\n\t\t\tassert.deepStrictEqual(getLocalProfiles(client2), [{ id: '1', name: 'name 1', useDefaultFlags: undefined }, { id: '2', name: 'name 2', useDefaultFlags: undefined }]);\n\n\t\t\tconst { content } = await testClient.read(testObject.resource);\n\t\t\tassert.ok(content !== null);\n\t\t\tconst actual = parseRemoteProfiles(content);\n\t\t\tassert.deepStrictEqual(actual, [{ id: '1', name: 'name 1', collection: '1' }, { id: '2', name: 'name 2', collection: '2' }]);\n\t\t});\n\t});\n\n\ttest('sync updating a profile', async () => {\n\t\tawait runWithFakedTimers<void>({}, async () => {\n\t\t\tconst profile = await testClient.instantiationService.get(IUserDataProfilesService).createProfile('1', 'name 1');\n\t\t\tawait testObject.sync(await testClient.getLatestRef(SyncResource.Profiles));\n\t\t\tawait client2.sync();\n\n\t\t\tawait testClient.instantiationService.get(IUserDataProfilesService).updateProfile(profile, { name: 'name 2' });\n\t\t\tawait testObject.sync(await testClient.getLatestRef(SyncResource.Profiles));\n\t\t\tassert.strictEqual(testObject.status, SyncStatus.Idle);\n\t\t\tassert.deepStrictEqual(testObject.conflicts.conflicts, []);\n\t\t\tassert.deepStrictEqual(getLocalProfiles(testClient), [{ id: '1', name: 'name 2', useDefaultFlags: undefined }]);\n\n\t\t\tawait client2.sync();\n\t\t\tassert.deepStrictEqual(getLocalProfiles(client2), [{ id: '1', name: 'name 2', useDefaultFlags: undefined }]);\n\n\t\t\tconst { content } = await testClient.read(testObject.resource);\n\t\t\tassert.ok(content !== null);\n\t\t\tconst actual = parseRemoteProfiles(content);\n\t\t\tassert.deepStrictEqual(actual, [{ id: '1', name: 'name 2', collection: '1' }]);\n\t\t});\n\t});\n\n\ttest('sync removing a profile', async () => {\n\t\tawait runWithFakedTimers<void>({}, async () => {\n\t\t\tconst profile = await testClient.instantiationService.get(IUserDataProfilesService).createProfile('1', 'name 1');\n\t\t\tawait testClient.instantiationService.get(IUserDataProfilesService).createProfile('2', 'name 2');\n\t\t\tawait testObject.sync(await testClient.getLatestRef(SyncResource.Profiles));\n\t\t\tawait client2.sync();\n\n\t\t\ttestClient.instantiationService.get(IUserDataProfilesService).removeProfile(profile);\n\t\t\tawait testObject.sync(await testClient.getLatestRef(SyncResource.Profiles));\n\t\t\tassert.strictEqual(testObject.status, SyncStatus.Idle);\n\t\t\tassert.deepStrictEqual(testObject.conflicts.conflicts, []);\n\t\t\tassert.deepStrictEqual(getLocalProfiles(testClient), [{ id: '2', name: 'name 2', useDefaultFlags: undefined }]);\n\n\t\t\tawait client2.sync();\n\t\t\tassert.deepStrictEqual(getLocalProfiles(client2), [{ id: '2', name: 'name 2', useDefaultFlags: undefined }]);\n\n\t\t\tconst { content } = await testClient.read(testObject.resource);\n\t\t\tassert.ok(content !== null);\n\t\t\tconst actual = parseRemoteProfiles(content);\n\t\t\tassert.deepStrictEqual(actual, [{ id: '2', name: 'name 2', collection: '2' }]);\n\t\t});\n\t});\n\n\ttest('sync profile that uses default profile', async () => {\n\t\tawait runWithFakedTimers<void>({}, async () => {\n\t\t\tawait client2.instantiationService.get(IUserDataProfilesService).createProfile('1', 'name 1', { useDefaultFlags: { keybindings: true } });\n\t\t\tawait client2.sync();\n\n\t\t\tawait testObject.sync(await testClient.getLatestRef(SyncResource.Profiles));\n\t\t\tassert.strictEqual(testObject.status, SyncStatus.Idle);\n\t\t\tassert.deepStrictEqual(testObject.conflicts.conflicts, []);\n\n\t\t\tconst { content } = await testClient.read(testObject.resource);\n\t\t\tassert.ok(content !== null);\n\t\t\tconst actual = parseRemoteProfiles(content);\n\t\t\tassert.deepStrictEqual(actual, [{ id: '1', name: 'name 1', collection: '1', useDefaultFlags: { keybindings: true } }]);\n\n\t\t\tassert.deepStrictEqual(getLocalProfiles(testClient), [{ id: '1', name: 'name 1', useDefaultFlags: { keybindings: true } }]);\n\t\t});\n\t});\n\n\ttest('sync profile when the profile is updated to use default profile locally', async () => {\n\t\tawait runWithFakedTimers<void>({}, async () => {\n\t\t\tawait client2.instantiationService.get(IUserDataProfilesService).createProfile('1', 'name 1');\n\t\t\tawait client2.sync();\n\n\t\t\tawait testObject.sync(await testClient.getLatestRef(SyncResource.Profiles));\n\n\t\t\tconst profile = testClient.instantiationService.get(IUserDataProfilesService).profiles.find(p => p.id === '1')!;\n\t\t\ttestClient.instantiationService.get(IUserDataProfilesService).updateProfile(profile, { useDefaultFlags: { keybindings: true } });\n\n\t\t\tawait testObject.sync(await testClient.getLatestRef(SyncResource.Profiles));\n\t\t\tassert.strictEqual(testObject.status, SyncStatus.Idle);\n\t\t\tassert.deepStrictEqual(testObject.conflicts.conflicts, []);\n\n\t\t\tconst { content } = await testClient.read(testObject.resource);\n\t\t\tassert.ok(content !== null);\n\t\t\tconst actual = parseRemoteProfiles(content);\n\t\t\tassert.deepStrictEqual(actual, [{ id: '1', name: 'name 1', collection: '1', useDefaultFlags: { keybindings: true } }]);\n\t\t\tassert.deepStrictEqual(getLocalProfiles(testClient), [{ id: '1', name: 'name 1', useDefaultFlags: { keybindings: true } }]);\n\t\t});\n\t});\n\n\ttest('sync profile when the profile is updated to use default profile remotely', async () => {\n\t\tawait runWithFakedTimers<void>({}, async () => {\n\t\t\tconst profile = await client2.instantiationService.get(IUserDataProfilesService).createProfile('1', 'name 1');\n\t\t\tawait client2.sync();\n\n\t\t\tawait testObject.sync(await testClient.getLatestRef(SyncResource.Profiles));\n\n\t\t\tclient2.instantiationService.get(IUserDataProfilesService).updateProfile(profile, { useDefaultFlags: { keybindings: true } });\n\t\t\tawait client2.sync();\n\n\t\t\tawait testObject.sync(await testClient.getLatestRef(SyncResource.Profiles));\n\t\t\tassert.strictEqual(testObject.status, SyncStatus.Idle);\n\t\t\tassert.deepStrictEqual(testObject.conflicts.conflicts, []);\n\n\t\t\tconst { content } = await testClient.read(testObject.resource);\n\t\t\tassert.ok(content !== null);\n\t\t\tconst actual = parseRemoteProfiles(content);\n\t\t\tassert.deepStrictEqual(actual, [{ id: '1', name: 'name 1', collection: '1', useDefaultFlags: { keybindings: true } }]);\n\n\t\t\tassert.deepStrictEqual(getLocalProfiles(testClient), [{ id: '1', name: 'name 1', useDefaultFlags: { keybindings: true } }]);\n\t\t});\n\t});\n\n\tfunction parseRemoteProfiles(content: string): ISyncUserDataProfile[] {\n\t\tconst syncData: ISyncData = JSON.parse(content);\n\t\treturn JSON.parse(syncData.content);\n\t}\n\n\tfunction getLocalProfiles(client: UserDataSyncClient): { id: string; name: string }[] {\n\t\treturn client.instantiationService.get(IUserDataProfilesService).profiles\n\t\t\t.slice(1).sort((a, b) => a.name.localeCompare(b.name))\n\t\t\t.map(profile => ({ id: profile.id, name: profile.name, useDefaultFlags: profile.useDefaultFlags }));\n\t}\n\n\n});\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport assert from 'assert';\nimport { runWithFakedTimers } from '../../../../base/test/common/timeTravelScheduler.js';\nimport { ensureNoDisposablesAreLeakedInTestSuite } from '../../../../base/test/common/utils.js';\nimport { IUserDataProfilesService } from '../../../userDataProfile/common/userDataProfile.js';\nimport { UserDataProfilesManifestSynchroniser } from '../../common/userDataProfilesManifestSync.js';\nimport { ISyncData, ISyncUserDataProfile, IUserDataSyncStoreService, SyncResource, SyncStatus } from '../../common/userDataSync.js';\nimport { UserDataSyncClient, UserDataSyncTestServer } from './userDataSyncClient.js';\n\nsuite('UserDataProfilesManifestSync', () => {\n\n\tconst server = new UserDataSyncTestServer();\n\tlet testClient: UserDataSyncClient;\n\tlet client2: UserDataSyncClient;\n\n\tlet testObject: UserDataProfilesManifestSynchroniser;\n\n\tteardown(async () => {\n\t\tawait testClient.instantiationService.get(IUserDataSyncStoreService).clear();\n\t});\n\n\tconst disposableStore = ensureNoDisposablesAreLeakedInTestSuite();\n\n\tsetup(async () => {\n\t\ttestClient = disposableStore.add(new UserDataSyncClient(server));\n\t\tawait testClient.setUp(true);\n\t\ttestObject = testClient.getSynchronizer(SyncResource.Profiles) as UserDataProfilesManifestSynchroniser;\n\n\t\tclient2 = disposableStore.add(new UserDataSyncClient(server));\n\t\tawait client2.setUp(true);\n\t});\n\n\ttest('when profiles does not exist', async () => {\n\t\tawait runWithFakedTimers<void>({}, async () => {\n\t\t\tassert.deepStrictEqual(await testObject.getLastSyncUserData(), null);\n\t\t\tlet manifest = await testClient.getLatestRef(SyncResource.Profiles);\n\t\t\tserver.reset();\n\t\t\tawait testObject.sync(manifest);\n\n\t\t\tassert.deepStrictEqual(server.requests, []);\n\n\t\t\tconst lastSyncUserData = await testObject.getLastSyncUserData();\n\t\t\tconst remoteUserData = await testObject.getRemoteUserData(null);\n\t\t\tassert.deepStrictEqual(lastSyncUserData!.ref, remoteUserData.ref);\n\t\t\tassert.deepStrictEqual(lastSyncUserData!.syncData, remoteUserData.syncData);\n\t\t\tassert.strictEqual(lastSyncUserData!.syncData, null);\n\n\t\t\tmanifest = await testClient.getLatestRef(SyncResource.Profiles);\n\t\t\tserver.reset();\n\t\t\tawait testObject.sync(manifest);\n\t\t\tassert.deepStrictEqual(server.requests, []);\n\n\t\t\tmanifest = await testClient.getLatestRef(SyncResource.Profiles);\n\t\t\tserver.reset();\n\t\t\tawait testObject.sync(manifest);\n\t\t\tassert.deepStrictEqual(server.requests, []);\n\t\t});\n\t});\n\n\ttest('when profile is created after first sync', async () => {\n\t\tawait runWithFakedTimers<void>({}, async () => {\n\t\t\tawait testObject.sync(await testClient.getLatestRef(SyncResource.Profiles));\n\t\t\tawait testClient.instantiationService.get(IUserDataProfilesService).createProfile('1', '1');\n\n\t\t\tlet lastSyncUserData = await testObject.getLastSyncUserData();\n\t\t\tconst manifest = await testClient.getLatestRef(SyncResource.Profiles);\n\t\t\tserver.reset();\n\t\t\tawait testObject.sync(manifest);\n\n\t\t\tassert.deepStrictEqual(server.requests, [\n\t\t\t\t{ type: 'POST', url: `${server.url}/v1/collection`, headers: {} },\n\t\t\t\t{ type: 'POST', url: `${server.url}/v1/resource/${testObject.resource}`, headers: { 'If-Match': lastSyncUserData?.ref } },\n\t\t\t]);\n\n\t\t\tlastSyncUserData = await testObject.getLastSyncUserData();\n\t\t\tconst remoteUserData = await testObject.getRemoteUserData(null);\n\t\t\tassert.deepStrictEqual(lastSyncUserData!.ref, remoteUserData.ref);\n\t\t\tassert.deepStrictEqual(lastSyncUserData!.syncData, remoteUserData.syncData);\n\t\t\tassert.deepStrictEqual(JSON.parse(lastSyncUserData!.syncData!.content), [{ 'name': '1', 'id': '1', 'collection': '1' }]);\n\t\t});\n\t});\n\n\ttest('first time sync - outgoing to server (no state)', async () => {\n\t\tawait runWithFakedTimers<void>({}, async () => {\n\t\t\tawait testClient.instantiationService.get(IUserDataProfilesService).createProfile('1', '1');\n\n\t\t\tawait testObject.sync(await testClient.getLatestRef(SyncResource.Profiles));\n\t\t\tassert.strictEqual(testObject.status, SyncStatus.Idle);\n\t\t\tassert.deepStrictEqual(testObject.conflicts.conflicts, []);\n\n\t\t\tconst { content } = await testClient.read(testObject.resource);\n\t\t\tassert.ok(content !== null);\n\t\t\tassert.deepStrictEqual(JSON.parse(JSON.parse(content).content), [{ 'name': '1', 'id': '1', 'collection': '1' }]);\n\t\t});\n\t});\n\n\ttest('first time sync - incoming from server (no state)', async () => {\n\t\tawait runWithFakedTimers<void>({}, async () => {\n\t\t\tawait client2.instantiationService.get(IUserDataProfilesService).createProfile('1', 'name 1');\n\t\t\tawait client2.sync();\n\n\t\t\tawait testObject.sync(await testClient.getLatestRef(SyncResource.Profiles));\n\t\t\tassert.strictEqual(testObject.status, SyncStatus.Idle);\n\t\t\tassert.deepStrictEqual(testObject.conflicts.conflicts, []);\n\n\t\t\tconst profiles = getLocalProfiles(testClient);\n\t\t\tassert.deepStrictEqual(profiles, [{ id: '1', name: 'name 1', useDefaultFlags: undefined }]);\n\t\t});\n\t});\n\n\ttest('first time sync when profiles exists', async () => {\n\t\tawait runWithFakedTimers<void>({}, async () => {\n\t\t\tawait client2.instantiationService.get(IUserDataProfilesService).createProfile('1', 'name 1');\n\t\t\tawait client2.sync();\n\n\t\t\tawait testClient.instantiationService.get(IUserDataProfilesService).createProfile('2', 'name 2');\n\t\t\tawait testObject.sync(await testClient.getLatestRef(SyncResource.Profiles));\n\t\t\tassert.strictEqual(testObject.status, SyncStatus.Idle);\n\t\t\tassert.deepStrictEqual(testObject.conflicts.conflicts, []);\n\n\t\t\tconst profiles = getLocalProfiles(testClient);\n\t\t\tassert.deepStrictEqual(profiles, [{ id: '1', name: 'name 1', useDefaultFlags: undefined }, { id: '2', name: 'name 2', useDefaultFlags: undefined }]);\n\n\t\t\tconst { content } = await testClient.read(testObject.resource);\n\t\t\tassert.ok(content !== null);\n\t\t\tconst actual = parseRemoteProfiles(content);\n\t\t\tassert.deepStrictEqual(actual, [{ id: '1', name: 'name 1', collection: '1' }, { id: '2', name: 'name 2', collection: '2' }]);\n\t\t});\n\t});\n\n\ttest('first time sync when storage exists - has conflicts', async () => {\n\t\tawait runWithFakedTimers<void>({}, async () => {\n\t\t\tawait client2.instantiationService.get(IUserDataProfilesService).createProfile('1', 'name 1');\n\t\t\tawait client2.sync();\n\n\t\t\tawait testClient.instantiationService.get(IUserDataProfilesService).createProfile('1', 'name 2');\n\t\t\tawait testObject.sync(await testClient.getLatestRef(SyncResource.Profiles));\n\n\t\t\tassert.strictEqual(testObject.status, SyncStatus.Idle);\n\t\t\tassert.deepStrictEqual(testObject.conflicts.conflicts, []);\n\n\t\t\tconst profiles = getLocalProfiles(testClient);\n\t\t\tassert.deepStrictEqual(profiles, [{ id: '1', name: 'name 1', useDefaultFlags: undefined }]);\n\n\t\t\tconst { content } = await testClient.read(testObject.resource);\n\t\t\tassert.ok(content !== null);\n\t\t\tconst actual = parseRemoteProfiles(content);\n\t\t\tassert.deepStrictEqual(actual, [{ id: '1', name: 'name 1', collection: '1' }]);\n\t\t});\n\t});\n\n\ttest('sync adding a profile', async () => {\n\t\tawait runWithFakedTimers<void>({}, async () => {\n\t\t\tawait testClient.instantiationService.get(IUserDataProfilesService).createProfile('1', 'name 1');\n\t\t\tawait testObject.sync(await testClient.getLatestRef(SyncResource.Profiles));\n\t\t\tawait client2.sync();\n\n\t\t\tawait testClient.instantiationService.get(IUserDataProfilesService).createProfile('2', 'name 2');\n\t\t\tawait testObject.sync(await testClient.getLatestRef(SyncResource.Profiles));\n\t\t\tassert.strictEqual(testObject.status, SyncStatus.Idle);\n\t\t\tassert.deepStrictEqual(testObject.conflicts.conflicts, []);\n\t\t\tassert.deepStrictEqual(getLocalProfiles(testClient), [{ id: '1', name: 'name 1', useDefaultFlags: undefined }, { id: '2', name: 'name 2', useDefaultFlags: undefined }]);\n\n\t\t\tawait client2.sync();\n\t\t\tassert.deepStrictEqual(getLocalProfiles(client2), [{ id: '1', name: 'name 1', useDefaultFlags: undefined }, { id: '2', name: 'name 2', useDefaultFlags: undefined }]);\n\n\t\t\tconst { content } = await testClient.read(testObject.resource);\n\t\t\tassert.ok(content !== null);\n\t\t\tconst actual = parseRemoteProfiles(content);\n\t\t\tassert.deepStrictEqual(actual, [{ id: '1', name: 'name 1', collection: '1' }, { id: '2', name: 'name 2', collection: '2' }]);\n\t\t});\n\t});\n\n\ttest('sync updating a profile', async () => {\n\t\tawait runWithFakedTimers<void>({}, async () => {\n\t\t\tconst profile = await testClient.instantiationService.get(IUserDataProfilesService).createProfile('1', 'name 1');\n\t\t\tawait testObject.sync(await testClient.getLatestRef(SyncResource.Profiles));\n\t\t\tawait client2.sync();\n\n\t\t\tawait testClient.instantiationService.get(IUserDataProfilesService).updateProfile(profile, { name: 'name 2' });\n\t\t\tawait testObject.sync(await testClient.getLatestRef(SyncResource.Profiles));\n\t\t\tassert.strictEqual(testObject.status, SyncStatus.Idle);\n\t\t\tassert.deepStrictEqual(testObject.conflicts.conflicts, []);\n\t\t\tassert.deepStrictEqual(getLocalProfiles(testClient), [{ id: '1', name: 'name 2', useDefaultFlags: undefined }]);\n\n\t\t\tawait client2.sync();\n\t\t\tassert.deepStrictEqual(getLocalProfiles(client2), [{ id: '1', name: 'name 2', useDefaultFlags: undefined }]);\n\n\t\t\tconst { content } = await testClient.read(testObject.resource);\n\t\t\tassert.ok(content !== null);\n\t\t\tconst actual = parseRemoteProfiles(content);\n\t\t\tassert.deepStrictEqual(actual, [{ id: '1', name: 'name 2', collection: '1' }]);\n\t\t});\n\t});\n\n\ttest('sync removing a profile', async () => {\n\t\tawait runWithFakedTimers<void>({}, async () => {\n\t\t\tconst profile = await testClient.instantiationService.get(IUserDataProfilesService).createProfile('1', 'name 1');\n\t\t\tawait testClient.instantiationService.get(IUserDataProfilesService).createProfile('2', 'name 2');\n\t\t\tawait testObject.sync(await testClient.getLatestRef(SyncResource.Profiles));\n\t\t\tawait client2.sync();\n\n\t\t\ttestClient.instantiationService.get(IUserDataProfilesService).removeProfile(profile);\n\t\t\tawait testObject.sync(await testClient.getLatestRef(SyncResource.Profiles));\n\t\t\tassert.strictEqual(testObject.status, SyncStatus.Idle);\n\t\t\tassert.deepStrictEqual(testObject.conflicts.conflicts, []);\n\t\t\tassert.deepStrictEqual(getLocalProfiles(testClient), [{ id: '2', name: 'name 2', useDefaultFlags: undefined }]);\n\n\t\t\tawait client2.sync();\n\t\t\tassert.deepStrictEqual(getLocalProfiles(client2), [{ id: '2', name: 'name 2', useDefaultFlags: undefined }]);\n\n\t\t\tconst { content } = await testClient.read(testObject.resource);\n\t\t\tassert.ok(content !== null);\n\t\t\tconst actual = parseRemoteProfiles(content);\n\t\t\tassert.deepStrictEqual(actual, [{ id: '2', name: 'name 2', collection: '2' }]);\n\t\t});\n\t});\n\n\ttest('sync profile that uses default profile', async () => {\n\t\tawait runWithFakedTimers<void>({}, async () => {\n\t\t\tawait client2.instantiationService.get(IUserDataProfilesService).createProfile('1', 'name 1', { useDefaultFlags: { keybindings: true } });\n\t\t\tawait client2.sync();\n\n\t\t\tawait testObject.sync(await testClient.getLatestRef(SyncResource.Profiles));\n\t\t\tassert.strictEqual(testObject.status, SyncStatus.Idle);\n\t\t\tassert.deepStrictEqual(testObject.conflicts.conflicts, []);\n\n\t\t\tconst { content } = await testClient.read(testObject.resource);\n\t\t\tassert.ok(content !== null);\n\t\t\tconst actual = parseRemoteProfiles(content);\n\t\t\tassert.deepStrictEqual(actual, [{ id: '1', name: 'name 1', collection: '1', useDefaultFlags: { keybindings: true } }]);\n\n\t\t\tassert.deepStrictEqual(getLocalProfiles(testClient), [{ id: '1', name: 'name 1', useDefaultFlags: { keybindings: true } }]);\n\t\t});\n\t});\n\n\ttest('sync profile when the profile is updated to use default profile locally', async () => {\n\t\tawait runWithFakedTimers<void>({}, async () => {\n\t\t\tawait client2.instantiationService.get(IUserDataProfilesService).createProfile('1', 'name 1');\n\t\t\tawait client2.sync();\n\n\t\t\tawait testObject.sync(await testClient.getLatestRef(SyncResource.Profiles));\n\n\t\t\tconst profile = testClient.instantiationService.get(IUserDataProfilesService).profiles.find(p => p.id === '1')!;\n\t\t\ttestClient.instantiationService.get(IUserDataProfilesService).updateProfile(profile, { useDefaultFlags: { keybindings: true } });\n\n\t\t\tawait testObject.sync(await testClient.getLatestRef(SyncResource.Profiles));\n\t\t\tassert.strictEqual(testObject.status, SyncStatus.Idle);\n\t\t\tassert.deepStrictEqual(testObject.conflicts.conflicts, []);\n\n\t\t\tconst { content } = await testClient.read(testObject.resource);\n\t\t\tassert.ok(content !== null);\n\t\t\tconst actual = parseRemoteProfiles(content);\n\t\t\tassert.deepStrictEqual(actual, [{ id: '1', name: 'name 1', collection: '1', useDefaultFlags: { keybindings: true } }]);\n\t\t\tassert.deepStrictEqual(getLocalProfiles(testClient), [{ id: '1', name: 'name 1', useDefaultFlags: { keybindings: true } }]);\n\t\t});\n\t});\n\n\ttest('sync profile when the profile is updated to use default profile remotely', async () => {\n\t\tawait runWithFakedTimers<void>({}, async () => {\n\t\t\tconst profile = await client2.instantiationService.get(IUserDataProfilesService).createProfile('1', 'name 1');\n\t\t\tawait client2.sync();\n\n\t\t\tawait testObject.sync(await testClient.getLatestRef(SyncResource.Profiles));\n\n\t\t\tclient2.instantiationService.get(IUserDataProfilesService).updateProfile(profile, { useDefaultFlags: { keybindings: true } });\n\t\t\tawait client2.sync();\n\n\t\t\tawait testObject.sync(await testClient.getLatestRef(SyncResource.Profiles));\n\t\t\tassert.strictEqual(testObject.status, SyncStatus.Idle);\n\t\t\tassert.deepStrictEqual(testObject.conflicts.conflicts, []);\n\n\t\t\tconst { content } = await testClient.read(testObject.resource);\n\t\t\tassert.ok(content !== null);\n\t\t\tconst actual = parseRemoteProfiles(content);\n\t\t\tassert.deepStrictEqual(actual, [{ id: '1', name: 'name 1', collection: '1', useDefaultFlags: { keybindings: true } }]);\n\n\t\t\tassert.deepStrictEqual(getLocalProfiles(testClient), [{ id: '1', name: 'name 1', useDefaultFlags: { keybindings: true } }]);\n\t\t});\n\t});\n\n\tfunction parseRemoteProfiles(content: string): ISyncUserDataProfile[] {\n\t\tconst syncData: ISyncData = JSON.parse(content);\n\t\treturn JSON.parse(syncData.content);\n\t}\n\n\tfunction getLocalProfiles(client: UserDataSyncClient): { id: string; name: string }[] {\n\t\treturn client.instantiationService.get(IUserDataProfilesService).profiles\n\t\t\t.slice(1).sort((a, b) => a.name.localeCompare(b.name))\n\t\t\t.map(profile => ({ id: profile.id, name: profile.name, useDefaultFlags: profile.useDefaultFlags }));\n\t}\n\n\n});\n"]}