{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/platform/userDataSync/test/common/synchronizer.test.ts","vs/platform/userDataSync/test/common/synchronizer.test.ts"],"names":[],"mappings":"AAAA;;;gGAGgG;AAEhG,OAAO,MAAM,MAAM,QAAQ,CAAC;AAC5B,OAAO,EAAE,OAAO,EAAE,MAAM,kCAAkC,CAAC;AAC3D,OAAO,EAAE,QAAQ,EAAE,MAAM,mCAAmC,CAAC;AAE7D,OAAO,EAAE,OAAO,EAAE,KAAK,EAAE,MAAM,kCAAkC,CAAC;AAClE,OAAO,EAAE,OAAO,EAAE,QAAQ,EAAE,MAAM,sCAAsC,CAAC;AAEzE,OAAO,EAAE,kBAAkB,EAAE,MAAM,qDAAqD,CAAC;AACzF,OAAO,EAAE,uCAAuC,EAAE,MAAM,uCAAuC,CAAC;AAChG,OAAO,EAAE,YAAY,EAAE,MAAM,gCAAgC,CAAC;AAC9D,OAAO,EAAE,eAAe,EAAgB,MAAM,oCAAoC,CAAC;AACnF,OAAO,EAAE,wBAAwB,EAAE,MAAM,oDAAoD,CAAC;AAC9F,OAAO,EAAE,oBAAoB,EAA+D,MAAM,sCAAsC,CAAC;AACzI,OAAO,EAAiG,yBAAyB,EAAwC,qBAAqB,EAAa,MAAM,8BAA8B,CAAC;AAChP,OAAO,EAAE,kBAAkB,EAAE,sBAAsB,EAAE,MAAM,yBAAyB,CAAC;AAMrF,MAAM,gBAAiB,SAAQ,oBAAoB;IAAnD;;QAEC,gBAAW,GAAY,IAAI,OAAO,EAAE,CAAC;QACrC,eAAU,GAAiD,EAAE,YAAY,EAAE,KAAK,EAAE,QAAQ,EAAE,KAAK,EAAE,CAAC;QACpG,iBAAY,GAAkB,IAAI,CAAC,SAAS,CAAC,IAAI,OAAO,EAAQ,CAAC,CAAC;QAClE,wCAAmC,GAAY,KAAK,CAAC;QAElC,YAAO,GAAW,CAAC,CAAC;QAE/B,cAAS,GAAY,KAAK,CAAC;QAC1B,kBAAa,GAAG,QAAQ,CAAC,IAAI,CAAC,kBAAkB,CAAC,mBAAmB,EAAE,mBAAmB,CAAC,CAAC;QAoIpG,gCAA2B,GAAkB,IAAI,CAAC,SAAS,CAAC,IAAI,OAAO,EAAQ,CAAC,CAAC;IAQlF,CAAC;IA1IA,YAAY,KAAsB,OAAO,IAAI,CAAC,uBAAuB,CAAC,CAAC,CAAC;IACxE,mBAAmB,KAAU,OAAO,IAAI,CAAC,gBAAgB,CAAC,CAAC,CAAC;IAEzC,uBAAuB,CAAC,eAA0C,EAAE,gBAAwC;QAC9H,IAAI,IAAI,CAAC,mCAAmC,EAAE,CAAC;YAC9C,MAAM,IAAI,KAAK,EAAE,CAAC;QACnB,CAAC;QACD,OAAO,KAAK,CAAC,uBAAuB,CAAC,eAAe,EAAE,gBAAgB,CAAC,CAAC;IACzE,CAAC;IAEkB,KAAK,CAAC,MAAM,CAAC,cAA+B,EAAE,gBAAwC,EAAE,QAAsB,EAAE,yBAAqD;QACvL,IAAI,CAAC,SAAS,GAAG,KAAK,CAAC;QACvB,IAAI,CAAC,YAAY,CAAC,IAAI,EAAE,CAAC;QACzB,MAAM,IAAI,CAAC,WAAW,CAAC,IAAI,EAAE,CAAC;QAE9B,IAAI,IAAI,CAAC,SAAS,EAAE,CAAC;YACpB,oCAAuB;QACxB,CAAC;QAED,OAAO,KAAK,CAAC,MAAM,CAAC,cAAc,EAAE,gBAAgB,EAAE,QAAQ,EAAE,yBAAyB,CAAC,CAAC;IAC5F,CAAC;IAEkB,KAAK,CAAC,mBAAmB,CAAC,cAA+B;QAC3E,IAAI,IAAI,CAAC,UAAU,CAAC,QAAQ,EAAE,CAAC;YAC9B,MAAM,IAAI,KAAK,CAAC,QAAQ,CAAC,CAAC;QAC3B,CAAC;QAED,IAAI,WAAW,GAAG,IAAI,CAAC;QACvB,IAAI,CAAC;YACJ,WAAW,GAAG,MAAM,IAAI,CAAC,WAAW,CAAC,QAAQ,CAAC,IAAI,CAAC,aAAa,CAAC,CAAC;QACnE,CAAC;QAAC,OAAO,KAAK,EAAE,CAAC,CAAC,CAAC;QAEnB,OAAO,CAAC;gBACP,YAAY,EAAE,IAAI,CAAC,aAAa,CAAC,IAAI,CAAC,CAAC,EAAE,MAAM,EAAE,qBAAqB,EAAE,SAAS,EAAE,MAAM,EAAE,CAAC,CAAC;gBAC7F,WAAW,EAAE,IAAI;gBACjB,aAAa,EAAE,IAAI,CAAC,aAAa;gBACjC,YAAY,EAAE,WAAW,CAAC,CAAC,CAAC,WAAW,CAAC,KAAK,CAAC,QAAQ,EAAE,CAAC,CAAC,CAAC,IAAI;gBAC/D,cAAc,EAAE,IAAI,CAAC,aAAa,CAAC,IAAI,CAAC,CAAC,EAAE,MAAM,EAAE,qBAAqB,EAAE,SAAS,EAAE,QAAQ,EAAE,CAAC,CAAC;gBACjG,aAAa,EAAE,cAAc,CAAC,QAAQ,CAAC,CAAC,CAAC,cAAc,CAAC,QAAQ,CAAC,OAAO,CAAC,CAAC,CAAC,IAAI;gBAC/E,eAAe,EAAE,IAAI,CAAC,aAAa,CAAC,IAAI,CAAC,CAAC,EAAE,MAAM,EAAE,qBAAqB,EAAE,SAAS,EAAE,SAAS,EAAE,CAAC,CAAC;gBACnG,GAAG,EAAE,cAAc,CAAC,GAAG;gBACvB,WAAW,yBAAiB;gBAC5B,YAAY,yBAAiB;gBAC7B,gBAAgB,EAAE,IAAI,CAAC,aAAa,CAAC,IAAI,CAAC,CAAC,EAAE,MAAM,EAAE,qBAAqB,EAAE,SAAS,EAAE,UAAU,EAAE,CAAC,CAAC;aACrG,CAAC,CAAC;IACJ,CAAC;IAES,KAAK,CAAC,gBAAgB,CAAC,gBAAiC;QACjE,OAAO,IAAI,CAAC;IACb,CAAC;IAES,KAAK,CAAC,cAAc,CAAC,eAAqC,EAAE,KAAwB;QAC7F,OAAO;YACN,OAAO,EAAE,eAAe,CAAC,GAAG;YAC5B,WAAW,yBAAiB;YAC5B,YAAY,yBAAiB;YAC7B,YAAY,EAAE,IAAI,CAAC,UAAU,CAAC,YAAY;SAC1C,CAAC;IACH,CAAC;IAES,KAAK,CAAC,eAAe,CAAC,eAAqC,EAAE,QAAa,EAAE,OAAkC,EAAE,KAAwB;QAEjJ,IAAI,OAAO,CAAC,QAAQ,EAAE,eAAe,CAAC,aAAa,CAAC,EAAE,CAAC;YACtD,OAAO;gBACN,OAAO,EAAE,eAAe,CAAC,YAAY;gBACrC,WAAW,qBAAa;gBACxB,YAAY,EAAE,eAAe,CAAC,YAAY,KAAK,IAAI,CAAC,CAAC,wBAAgB,CAAC,wBAAgB;aACtF,CAAC;QACH,CAAC;QAED,IAAI,OAAO,CAAC,QAAQ,EAAE,eAAe,CAAC,cAAc,CAAC,EAAE,CAAC;YACvD,OAAO;gBACN,OAAO,EAAE,eAAe,CAAC,aAAa;gBACtC,WAAW,EAAE,eAAe,CAAC,aAAa,KAAK,IAAI,CAAC,CAAC,wBAAgB,CAAC,wBAAgB;gBACtF,YAAY,qBAAa;aACzB,CAAC;QACH,CAAC;QAED,IAAI,OAAO,CAAC,QAAQ,EAAE,eAAe,CAAC,eAAe,CAAC,EAAE,CAAC;YACxD,IAAI,OAAO,KAAK,SAAS,EAAE,CAAC;gBAC3B,OAAO;oBACN,OAAO,EAAE,eAAe,CAAC,GAAG;oBAC5B,WAAW,yBAAiB;oBAC5B,YAAY,yBAAiB;iBAC7B,CAAC;YACH,CAAC;iBAAM,CAAC;gBACP,OAAO;oBACN,OAAO;oBACP,WAAW,EAAE,OAAO,KAAK,IAAI,CAAC,CAAC,CAAC,eAAe,CAAC,YAAY,KAAK,IAAI,CAAC,CAAC,wBAAgB,CAAC,oBAAY,CAAC,CAAC,wBAAgB;oBACtH,YAAY,EAAE,OAAO,KAAK,IAAI,CAAC,CAAC,CAAC,eAAe,CAAC,aAAa,KAAK,IAAI,CAAC,CAAC,wBAAgB,CAAC,oBAAY,CAAC,CAAC,wBAAgB;iBACxH,CAAC;YACH,CAAC;QACF,CAAC;QAED,MAAM,IAAI,KAAK,CAAC,qBAAqB,QAAQ,CAAC,QAAQ,EAAE,EAAE,CAAC,CAAC;IAC7D,CAAC;IAES,KAAK,CAAC,WAAW,CAAC,cAA+B,EAAE,gBAAwC,EAAE,gBAAqD,EAAE,KAAc;QAC3K,IAAI,gBAAgB,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,WAAW,2BAAmB,EAAE,CAAC;YAC3D,MAAM,IAAI,CAAC,WAAW,CAAC,GAAG,CAAC,IAAI,CAAC,aAAa,CAAC,CAAC;QAChD,CAAC;QAED,IAAI,gBAAgB,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,WAAW,yBAAiB,IAAI,gBAAgB,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,WAAW,4BAAoB,EAAE,CAAC;YACnH,MAAM,IAAI,CAAC,WAAW,CAAC,SAAS,CAAC,IAAI,CAAC,aAAa,EAAE,QAAQ,CAAC,UAAU,CAAC,gBAAgB,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,OAAQ,CAAC,CAAC,CAAC;QAC5G,CAAC;QAED,IAAI,gBAAgB,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,YAAY,2BAAmB,EAAE,CAAC;YAC5D,MAAM,IAAI,CAAC,QAAQ,CAAC,IAAI,EAAE,cAAc,CAAC,GAAG,CAAC,CAAC;QAC/C,CAAC;QAED,IAAI,gBAAgB,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,YAAY,yBAAiB,IAAI,gBAAgB,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,YAAY,4BAAoB,EAAE,CAAC;YACrH,MAAM,IAAI,CAAC,QAAQ,CAAC,gBAAgB,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,OAAO,EAAE,cAAc,CAAC,GAAG,CAAC,CAAC;QACzE,CAAC;IACF,CAAC;IAED,KAAK,CAAC,QAAQ,CAAC,OAAsB,EAAE,GAAW;QACjD,MAAM,cAAc,GAAG,MAAM,IAAI,CAAC,oBAAoB,CAAC,OAAO,KAAK,IAAI,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,OAAO,EAAE,GAAG,CAAC,CAAC;QAC7F,MAAM,IAAI,CAAC,sBAAsB,CAAC,cAAc,CAAC,CAAC;IACnD,CAAC;IAEQ,KAAK,CAAC,IAAI;QAClB,IAAI,CAAC,SAAS,GAAG,IAAI,CAAC;QACtB,IAAI,CAAC,WAAW,CAAC,IAAI,EAAE,CAAC;QACxB,KAAK,CAAC,IAAI,EAAE,CAAC;IACd,CAAC;IAED,sBAAsB;QACrB,IAAI,CAAC,kBAAkB,EAAE,CAAC;IAC3B,CAAC;IAGkB,KAAK,CAAC,oBAAoB;QAC5C,MAAM,KAAK,CAAC,oBAAoB,EAAE,CAAC;QACnC,IAAI,CAAC,2BAA2B,CAAC,IAAI,EAAE,CAAC;IACzC,CAAC;IAED,YAAY,KAAuB,MAAM,IAAI,KAAK,CAAC,iBAAiB,CAAC,CAAC,CAAC,CAAC;IACxE,KAAK,CAAC,cAAc,CAAC,GAAQ,IAA4B,OAAO,IAAI,CAAC,CAAC,CAAC;CACvE;AAED,KAAK,CAAC,8BAA8B,EAAE,GAAG,EAAE;IAE1C,MAAM,MAAM,GAAG,IAAI,sBAAsB,EAAE,CAAC;IAC5C,IAAI,MAA0B,CAAC;IAE/B,QAAQ,CAAC,KAAK,IAAI,EAAE;QACnB,MAAM,MAAM,CAAC,oBAAoB,CAAC,GAAG,CAAC,yBAAyB,CAAC,CAAC,KAAK,EAAE,CAAC;IAC1E,CAAC,CAAC,CAAC;IAEH,MAAM,eAAe,GAAG,uCAAuC,EAAE,CAAC;IAElE,KAAK,CAAC,KAAK,IAAI,EAAE;QAChB,MAAM,GAAG,eAAe,CAAC,GAAG,CAAC,IAAI,kBAAkB,CAAC,MAAM,CAAC,CAAC,CAAC;QAC7D,MAAM,MAAM,CAAC,KAAK,EAAE,CAAC;IACtB,CAAC,CAAC,CAAC;IAEH,IAAI,CAAC,mBAAmB,EAAE,KAAK,IAAI,EAAE;QACpC,MAAM,kBAAkB,CAAO,EAAE,EAAE,KAAK,IAAI,EAAE;YAC7C,MAAM,UAAU,GAAqB,eAAe,CAAC,GAAG,CAAC,MAAM,CAAC,oBAAoB,CAAC,cAAc,CAAC,gBAAgB,EAAE,EAAE,YAAY,wCAAuB,EAAE,OAAO,EAAE,MAAM,CAAC,oBAAoB,CAAC,GAAG,CAAC,wBAAwB,CAAC,CAAC,cAAc,EAAE,EAAE,SAAS,CAAC,CAAC,CAAC;YAE9P,MAAM,MAAM,GAAiB,EAAE,CAAC;YAChC,eAAe,CAAC,GAAG,CAAC,UAAU,CAAC,iBAAiB,CAAC,MAAM,CAAC,EAAE,CAAC,MAAM,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC;YAEjF,MAAM,OAAO,GAAG,KAAK,CAAC,SAAS,CAAC,UAAU,CAAC,YAAY,CAAC,KAAK,CAAC,CAAC;YAE/D,UAAU,CAAC,IAAI,CAAC,MAAM,MAAM,CAAC,YAAY,CAAC,UAAU,CAAC,QAAQ,CAAC,CAAC,CAAC;YAChE,MAAM,OAAO,CAAC;YAEd,MAAM,CAAC,eAAe,CAAC,MAAM,EAAE,oCAAoB,CAAC,CAAC;YACrD,MAAM,CAAC,eAAe,CAAC,UAAU,CAAC,MAAM,qCAAqB,CAAC;YAE9D,UAAU,CAAC,IAAI,EAAE,CAAC;QACnB,CAAC,CAAC,CAAC;IACJ,CAAC,CAAC,CAAC;IAEH,IAAI,CAAC,+CAA+C,EAAE,KAAK,IAAI,EAAE;QAChE,MAAM,kBAAkB,CAAO,EAAE,EAAE,KAAK,IAAI,EAAE;YAC7C,MAAM,UAAU,GAAqB,eAAe,CAAC,GAAG,CAAC,MAAM,CAAC,oBAAoB,CAAC,cAAc,CAAC,gBAAgB,EAAE,EAAE,YAAY,wCAAuB,EAAE,OAAO,EAAE,MAAM,CAAC,oBAAoB,CAAC,GAAG,CAAC,wBAAwB,CAAC,CAAC,cAAc,EAAE,EAAE,SAAS,CAAC,CAAC,CAAC;YAC9P,UAAU,CAAC,WAAW,CAAC,IAAI,EAAE,CAAC;YAE9B,MAAM,MAAM,GAAiB,EAAE,CAAC;YAChC,eAAe,CAAC,GAAG,CAAC,UAAU,CAAC,iBAAiB,CAAC,MAAM,CAAC,EAAE,CAAC,MAAM,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC;YACjF,MAAM,UAAU,CAAC,IAAI,CAAC,MAAM,MAAM,CAAC,YAAY,CAAC,UAAU,CAAC,QAAQ,CAAC,CAAC,CAAC;YAEtE,MAAM,CAAC,eAAe,CAAC,MAAM,EAAE,kEAAqC,CAAC,CAAC;YACtE,MAAM,CAAC,eAAe,CAAC,UAAU,CAAC,MAAM,+BAAkB,CAAC;QAC5D,CAAC,CAAC,CAAC;IACJ,CAAC,CAAC,CAAC;IAEH,IAAI,CAAC,8CAA8C,EAAE,KAAK,IAAI,EAAE;QAC/D,MAAM,kBAAkB,CAAO,EAAE,EAAE,KAAK,IAAI,EAAE;YAC7C,MAAM,UAAU,GAAqB,eAAe,CAAC,GAAG,CAAC,MAAM,CAAC,oBAAoB,CAAC,cAAc,CAAC,gBAAgB,EAAE,EAAE,YAAY,wCAAuB,EAAE,OAAO,EAAE,MAAM,CAAC,oBAAoB,CAAC,GAAG,CAAC,wBAAwB,CAAC,CAAC,cAAc,EAAE,EAAE,SAAS,CAAC,CAAC,CAAC;YAC9P,UAAU,CAAC,UAAU,GAAG,EAAE,QAAQ,EAAE,IAAI,EAAE,YAAY,EAAE,KAAK,EAAE,CAAC;YAChE,UAAU,CAAC,WAAW,CAAC,IAAI,EAAE,CAAC;YAE9B,MAAM,MAAM,GAAiB,EAAE,CAAC;YAChC,eAAe,CAAC,GAAG,CAAC,UAAU,CAAC,iBAAiB,CAAC,MAAM,CAAC,EAAE,CAAC,MAAM,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC;YAEjF,IAAI,CAAC;gBACJ,MAAM,UAAU,CAAC,IAAI,CAAC,MAAM,MAAM,CAAC,YAAY,CAAC,UAAU,CAAC,QAAQ,CAAC,CAAC,CAAC;gBACtE,MAAM,CAAC,IAAI,CAAC,aAAa,CAAC,CAAC;YAC5B,CAAC;YAAC,OAAO,CAAC,EAAE,CAAC;gBACZ,MAAM,CAAC,eAAe,CAAC,MAAM,EAAE,kEAAqC,CAAC,CAAC;gBACtE,MAAM,CAAC,eAAe,CAAC,UAAU,CAAC,MAAM,+BAAkB,CAAC;YAC5D,CAAC;QACF,CAAC,CAAC,CAAC;IACJ,CAAC,CAAC,CAAC;IAEH,IAAI,CAAC,yEAAyE,EAAE,KAAK,IAAI,EAAE;QAC1F,MAAM,kBAAkB,CAAO,EAAE,EAAE,KAAK,IAAI,EAAE;YAC7C,MAAM,UAAU,GAAqB,eAAe,CAAC,GAAG,CAAC,MAAM,CAAC,oBAAoB,CAAC,cAAc,CAAC,gBAAgB,EAAE,EAAE,YAAY,wCAAuB,EAAE,OAAO,EAAE,MAAM,CAAC,oBAAoB,CAAC,GAAG,CAAC,wBAAwB,CAAC,CAAC,cAAc,EAAE,EAAE,SAAS,CAAC,CAAC,CAAC;YAC9P,UAAU,CAAC,UAAU,GAAG,EAAE,YAAY,EAAE,IAAI,EAAE,QAAQ,EAAE,KAAK,EAAE,CAAC;YAChE,UAAU,CAAC,WAAW,CAAC,IAAI,EAAE,CAAC;YAE9B,MAAM,UAAU,CAAC,IAAI,CAAC,MAAM,MAAM,CAAC,YAAY,CAAC,UAAU,CAAC,QAAQ,CAAC,CAAC,CAAC;YAEtE,MAAM,CAAC,eAAe,CAAC,UAAU,CAAC,MAAM,+CAA0B,CAAC;YACnE,eAAe,CAAC,UAAU,CAAC,SAAS,CAAC,SAAS,EAAE,CAAC,UAAU,CAAC,aAAa,CAAC,CAAC,CAAC;QAC7E,CAAC,CAAC,CAAC;IACJ,CAAC,CAAC,CAAC;IAEH,IAAI,CAAC,wCAAwC,EAAE,KAAK,IAAI,EAAE;QACzD,MAAM,kBAAkB,CAAO,EAAE,EAAE,KAAK,IAAI,EAAE;YAC7C,MAAM,UAAU,GAAqB,eAAe,CAAC,GAAG,CAAC,MAAM,CAAC,oBAAoB,CAAC,cAAc,CAAC,gBAAgB,EAAE,EAAE,YAAY,wCAAuB,EAAE,OAAO,EAAE,MAAM,CAAC,oBAAoB,CAAC,GAAG,CAAC,wBAAwB,CAAC,CAAC,cAAc,EAAE,EAAE,SAAS,CAAC,CAAC,CAAC;YAC9P,MAAM,OAAO,GAAG,KAAK,CAAC,SAAS,CAAC,UAAU,CAAC,YAAY,CAAC,KAAK,CAAC,CAAC;YAE/D,UAAU,CAAC,IAAI,CAAC,MAAM,MAAM,CAAC,YAAY,CAAC,UAAU,CAAC,QAAQ,CAAC,CAAC,CAAC;YAChE,MAAM,OAAO,CAAC;YAEd,MAAM,MAAM,GAAiB,EAAE,CAAC;YAChC,eAAe,CAAC,GAAG,CAAC,UAAU,CAAC,iBAAiB,CAAC,MAAM,CAAC,EAAE,CAAC,MAAM,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC;YACjF,MAAM,UAAU,CAAC,IAAI,CAAC,MAAM,MAAM,CAAC,YAAY,CAAC,UAAU,CAAC,QAAQ,CAAC,CAAC,CAAC;YAEtE,MAAM,CAAC,eAAe,CAAC,MAAM,EAAE,EAAE,CAAC,CAAC;YACnC,MAAM,CAAC,eAAe,CAAC,UAAU,CAAC,MAAM,qCAAqB,CAAC;YAE9D,MAAM,UAAU,CAAC,IAAI,EAAE,CAAC;QACzB,CAAC,CAAC,CAAC;IACJ,CAAC,CAAC,CAAC;IAEH,IAAI,CAAC,4CAA4C,EAAE,KAAK,IAAI,EAAE;QAC7D,MAAM,kBAAkB,CAAO,EAAE,EAAE,KAAK,IAAI,EAAE;YAC7C,MAAM,UAAU,GAAqB,eAAe,CAAC,GAAG,CAAC,MAAM,CAAC,oBAAoB,CAAC,cAAc,CAAC,gBAAgB,EAAE,EAAE,YAAY,wCAAuB,EAAE,OAAO,EAAE,MAAM,CAAC,oBAAoB,CAAC,GAAG,CAAC,wBAAwB,CAAC,CAAC,cAAc,EAAE,EAAE,SAAS,CAAC,CAAC,CAAC;YAC9P,UAAU,CAAC,UAAU,GAAG,EAAE,YAAY,EAAE,IAAI,EAAE,QAAQ,EAAE,KAAK,EAAE,CAAC;YAChE,UAAU,CAAC,WAAW,CAAC,IAAI,EAAE,CAAC;YAC9B,MAAM,UAAU,CAAC,IAAI,CAAC,MAAM,MAAM,CAAC,YAAY,CAAC,UAAU,CAAC,QAAQ,CAAC,CAAC,CAAC;YAEtE,MAAM,MAAM,GAAiB,EAAE,CAAC;YAChC,eAAe,CAAC,GAAG,CAAC,UAAU,CAAC,iBAAiB,CAAC,MAAM,CAAC,EAAE,CAAC,MAAM,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC;YACjF,MAAM,UAAU,CAAC,IAAI,CAAC,MAAM,MAAM,CAAC,YAAY,CAAC,UAAU,CAAC,QAAQ,CAAC,CAAC,CAAC;YAEtE,MAAM,CAAC,eAAe,CAAC,MAAM,EAAE,EAAE,CAAC,CAAC;YACnC,MAAM,CAAC,eAAe,CAAC,UAAU,CAAC,MAAM,+CAA0B,CAAC;QACpE,CAAC,CAAC,CAAC;IACJ,CAAC,CAAC,CAAC;IAEH,IAAI,CAAC,iCAAiC,EAAE,KAAK,IAAI,EAAE;QAClD,MAAM,kBAAkB,CAAO,EAAE,EAAE,KAAK,IAAI,EAAE;YAC7C,MAAM,UAAU,GAAqB,eAAe,CAAC,GAAG,CAAC,MAAM,CAAC,oBAAoB,CAAC,cAAc,CAAC,gBAAgB,EAAE,EAAE,YAAY,wCAAuB,EAAE,OAAO,EAAE,MAAM,CAAC,oBAAoB,CAAC,GAAG,CAAC,wBAAwB,CAAC,CAAC,cAAc,EAAE,EAAE,SAAS,CAAC,CAAC,CAAC;YAC9P,UAAU,CAAC,UAAU,GAAG,EAAE,YAAY,EAAE,IAAI,EAAE,QAAQ,EAAE,KAAK,EAAE,CAAC;YAChE,UAAU,CAAC,WAAW,CAAC,IAAI,EAAE,CAAC;YAE9B,MAAM,UAAU,CAAC,IAAI,CAAC,MAAM,MAAM,CAAC,YAAY,CAAC,UAAU,CAAC,QAAQ,CAAC,CAAC,CAAC;YACtE,MAAM,CAAC,eAAe,CAAC,UAAU,CAAC,MAAM,+CAA0B,CAAC;YAEnE,MAAM,UAAU,CAAC,MAAM,CAAC,UAAU,CAAC,SAAS,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC,eAAe,CAAC,CAAC;YAC3E,MAAM,CAAC,eAAe,CAAC,UAAU,CAAC,MAAM,qCAAqB,CAAC;YAC9D,eAAe,CAAC,UAAU,CAAC,SAAS,CAAC,SAAS,EAAE,EAAE,CAAC,CAAC;YAEpD,MAAM,UAAU,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC;YAC9B,MAAM,CAAC,eAAe,CAAC,UAAU,CAAC,MAAM,+BAAkB,CAAC;YAC3D,MAAM,WAAW,GAAG,MAAM,CAAC,oBAAoB,CAAC,GAAG,CAAC,YAAY,CAAC,CAAC;YAClE,MAAM,CAAC,WAAW,CAAC,CAAC,MAAM,UAAU,CAAC,iBAAiB,CAAC,IAAI,CAAC,CAAC,CAAC,QAAQ,EAAE,OAAO,EAAE,CAAC,MAAM,WAAW,CAAC,QAAQ,CAAC,UAAU,CAAC,aAAa,CAAC,CAAC,CAAC,KAAK,CAAC,QAAQ,EAAE,CAAC,CAAC;QAC3J,CAAC,CAAC,CAAC;IACJ,CAAC,CAAC,CAAC;IAEH,IAAI,CAAC,gCAAgC,EAAE,KAAK,IAAI,EAAE;QACjD,MAAM,kBAAkB,CAAO,EAAE,EAAE,KAAK,IAAI,EAAE;YAC7C,MAAM,UAAU,GAAqB,eAAe,CAAC,GAAG,CAAC,MAAM,CAAC,oBAAoB,CAAC,cAAc,CAAC,gBAAgB,EAAE,EAAE,YAAY,wCAAuB,EAAE,OAAO,EAAE,MAAM,CAAC,oBAAoB,CAAC,GAAG,CAAC,wBAAwB,CAAC,CAAC,cAAc,EAAE,EAAE,SAAS,CAAC,CAAC,CAAC;YAC9P,UAAU,CAAC,WAAW,CAAC,IAAI,EAAE,CAAC;YAC9B,MAAM,UAAU,CAAC,IAAI,CAAC,MAAM,MAAM,CAAC,YAAY,CAAC,UAAU,CAAC,QAAQ,CAAC,CAAC,CAAC;YACtE,MAAM,WAAW,GAAG,MAAM,CAAC,oBAAoB,CAAC,GAAG,CAAC,YAAY,CAAC,CAAC;YAClE,MAAM,oBAAoB,GAAG,CAAC,MAAM,UAAU,CAAC,iBAAiB,CAAC,IAAI,CAAC,CAAC,CAAC,QAAQ,EAAE,OAAO,CAAC;YAC1F,MAAM,eAAe,GAAG,UAAU,CAAC;YACnC,MAAM,WAAW,CAAC,SAAS,CAAC,UAAU,CAAC,aAAa,EAAE,QAAQ,CAAC,UAAU,CAAC,eAAe,CAAC,CAAC,CAAC;YAE5F,UAAU,CAAC,UAAU,GAAG,EAAE,YAAY,EAAE,IAAI,EAAE,QAAQ,EAAE,KAAK,EAAE,CAAC;YAChE,MAAM,UAAU,CAAC,IAAI,CAAC,MAAM,MAAM,CAAC,YAAY,CAAC,UAAU,CAAC,QAAQ,CAAC,CAAC,CAAC;YACtE,MAAM,CAAC,eAAe,CAAC,UAAU,CAAC,MAAM,+CAA0B,CAAC;YAEnE,MAAM,UAAU,CAAC,MAAM,CAAC,UAAU,CAAC,SAAS,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC,cAAc,CAAC,CAAC;YAC1E,MAAM,CAAC,eAAe,CAAC,UAAU,CAAC,MAAM,qCAAqB,CAAC;YAC9D,eAAe,CAAC,UAAU,CAAC,SAAS,CAAC,SAAS,EAAE,EAAE,CAAC,CAAC;YAEpD,MAAM,UAAU,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC;YAC9B,MAAM,CAAC,eAAe,CAAC,UAAU,CAAC,MAAM,+BAAkB,CAAC;YAC3D,MAAM,CAAC,WAAW,CAAC,CAAC,MAAM,UAAU,CAAC,iBAAiB,CAAC,IAAI,CAAC,CAAC,CAAC,QAAQ,EAAE,OAAO,EAAE,oBAAoB,CAAC,CAAC;YACvG,MAAM,CAAC,WAAW,CAAC,CAAC,MAAM,WAAW,CAAC,QAAQ,CAAC,UAAU,CAAC,aAAa,CAAC,CAAC,CAAC,KAAK,CAAC,QAAQ,EAAE,EAAE,oBAAoB,CAAC,CAAC;QACnH,CAAC,CAAC,CAAC;IACJ,CAAC,CAAC,CAAC;IAEH,IAAI,CAAC,+BAA+B,EAAE,KAAK,IAAI,EAAE;QAChD,MAAM,kBAAkB,CAAO,EAAE,EAAE,KAAK,IAAI,EAAE;YAC7C,MAAM,UAAU,GAAqB,eAAe,CAAC,GAAG,CAAC,MAAM,CAAC,oBAAoB,CAAC,cAAc,CAAC,gBAAgB,EAAE,EAAE,YAAY,wCAAuB,EAAE,OAAO,EAAE,MAAM,CAAC,oBAAoB,CAAC,GAAG,CAAC,wBAAwB,CAAC,CAAC,cAAc,EAAE,EAAE,SAAS,CAAC,CAAC,CAAC;YAC9P,UAAU,CAAC,WAAW,CAAC,IAAI,EAAE,CAAC;YAC9B,MAAM,UAAU,CAAC,IAAI,CAAC,MAAM,MAAM,CAAC,YAAY,CAAC,UAAU,CAAC,QAAQ,CAAC,CAAC,CAAC;YACtE,MAAM,WAAW,GAAG,MAAM,CAAC,oBAAoB,CAAC,GAAG,CAAC,YAAY,CAAC,CAAC;YAClE,MAAM,eAAe,GAAG,UAAU,CAAC;YACnC,MAAM,WAAW,CAAC,SAAS,CAAC,UAAU,CAAC,aAAa,EAAE,QAAQ,CAAC,UAAU,CAAC,eAAe,CAAC,CAAC,CAAC;YAE5F,UAAU,CAAC,UAAU,GAAG,EAAE,YAAY,EAAE,IAAI,EAAE,QAAQ,EAAE,KAAK,EAAE,CAAC;YAChE,MAAM,UAAU,CAAC,IAAI,CAAC,MAAM,MAAM,CAAC,YAAY,CAAC,UAAU,CAAC,QAAQ,CAAC,CAAC,CAAC;YACtE,MAAM,CAAC,eAAe,CAAC,UAAU,CAAC,MAAM,+CAA0B,CAAC;YAEnE,MAAM,UAAU,CAAC,MAAM,CAAC,UAAU,CAAC,SAAS,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC,aAAa,CAAC,CAAC;YACzE,MAAM,CAAC,eAAe,CAAC,UAAU,CAAC,MAAM,qCAAqB,CAAC;YAC9D,eAAe,CAAC,UAAU,CAAC,SAAS,CAAC,SAAS,EAAE,EAAE,CAAC,CAAC;YAEpD,MAAM,UAAU,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC;YAC9B,MAAM,CAAC,eAAe,CAAC,UAAU,CAAC,MAAM,+BAAkB,CAAC;YAC3D,MAAM,CAAC,WAAW,CAAC,CAAC,MAAM,UAAU,CAAC,iBAAiB,CAAC,IAAI,CAAC,CAAC,CAAC,QAAQ,EAAE,OAAO,EAAE,eAAe,CAAC,CAAC;YAClG,MAAM,CAAC,WAAW,CAAC,CAAC,MAAM,WAAW,CAAC,QAAQ,CAAC,UAAU,CAAC,aAAa,CAAC,CAAC,CAAC,KAAK,CAAC,QAAQ,EAAE,EAAE,eAAe,CAAC,CAAC;QAC9G,CAAC,CAAC,CAAC;IACJ,CAAC,CAAC,CAAC;IAEH,IAAI,CAAC,qCAAqC,EAAE,KAAK,IAAI,EAAE;QACtD,MAAM,kBAAkB,CAAO,EAAE,EAAE,KAAK,IAAI,EAAE;YAC7C,MAAM,UAAU,GAAqB,eAAe,CAAC,GAAG,CAAC,MAAM,CAAC,oBAAoB,CAAC,cAAc,CAAC,gBAAgB,EAAE,EAAE,YAAY,wCAAuB,EAAE,OAAO,EAAE,MAAM,CAAC,oBAAoB,CAAC,GAAG,CAAC,wBAAwB,CAAC,CAAC,cAAc,EAAE,EAAE,SAAS,CAAC,CAAC,CAAC;YAC9P,UAAU,CAAC,WAAW,CAAC,IAAI,EAAE,CAAC;YAC9B,MAAM,UAAU,CAAC,IAAI,CAAC,MAAM,MAAM,CAAC,YAAY,CAAC,UAAU,CAAC,QAAQ,CAAC,CAAC,CAAC;YACtE,MAAM,WAAW,GAAG,MAAM,CAAC,oBAAoB,CAAC,GAAG,CAAC,YAAY,CAAC,CAAC;YAClE,MAAM,eAAe,GAAG,UAAU,CAAC;YACnC,MAAM,WAAW,CAAC,SAAS,CAAC,UAAU,CAAC,aAAa,EAAE,QAAQ,CAAC,UAAU,CAAC,eAAe,CAAC,CAAC,CAAC;YAE5F,UAAU,CAAC,UAAU,GAAG,EAAE,YAAY,EAAE,IAAI,EAAE,QAAQ,EAAE,KAAK,EAAE,CAAC;YAChE,MAAM,UAAU,CAAC,IAAI,CAAC,MAAM,MAAM,CAAC,YAAY,CAAC,UAAU,CAAC,QAAQ,CAAC,CAAC,CAAC;YACtE,MAAM,CAAC,eAAe,CAAC,UAAU,CAAC,MAAM,+CAA0B,CAAC;YAEnE,MAAM,YAAY,GAAG,YAAY,CAAC;YAClC,MAAM,UAAU,CAAC,MAAM,CAAC,UAAU,CAAC,SAAS,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC,eAAe,EAAE,YAAY,CAAC,CAAC;YACzF,MAAM,CAAC,eAAe,CAAC,UAAU,CAAC,MAAM,qCAAqB,CAAC;YAC9D,eAAe,CAAC,UAAU,CAAC,SAAS,CAAC,SAAS,EAAE,EAAE,CAAC,CAAC;YAEpD,MAAM,UAAU,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC;YAC9B,MAAM,CAAC,eAAe,CAAC,UAAU,CAAC,MAAM,+BAAkB,CAAC;YAC3D,MAAM,CAAC,WAAW,CAAC,CAAC,MAAM,UAAU,CAAC,iBAAiB,CAAC,IAAI,CAAC,CAAC,CAAC,QAAQ,EAAE,OAAO,EAAE,YAAY,CAAC,CAAC;YAC/F,MAAM,CAAC,WAAW,CAAC,CAAC,MAAM,WAAW,CAAC,QAAQ,CAAC,UAAU,CAAC,aAAa,CAAC,CAAC,CAAC,KAAK,CAAC,QAAQ,EAAE,EAAE,YAAY,CAAC,CAAC;QAC3G,CAAC,CAAC,CAAC;IACJ,CAAC,CAAC,CAAC;IAEH,IAAI,CAAC,gCAAgC,EAAE,KAAK,IAAI,EAAE;QACjD,MAAM,kBAAkB,CAAO,EAAE,EAAE,KAAK,IAAI,EAAE;YAC7C,MAAM,UAAU,GAAqB,eAAe,CAAC,GAAG,CAAC,MAAM,CAAC,oBAAoB,CAAC,cAAc,CAAC,gBAAgB,EAAE,EAAE,YAAY,wCAAuB,EAAE,OAAO,EAAE,MAAM,CAAC,oBAAoB,CAAC,GAAG,CAAC,wBAAwB,CAAC,CAAC,cAAc,EAAE,EAAE,SAAS,CAAC,CAAC,CAAC;YAC9P,UAAU,CAAC,WAAW,CAAC,IAAI,EAAE,CAAC;YAC9B,MAAM,UAAU,CAAC,IAAI,CAAC,MAAM,MAAM,CAAC,YAAY,CAAC,UAAU,CAAC,QAAQ,CAAC,CAAC,CAAC;YACtE,MAAM,WAAW,GAAG,MAAM,CAAC,oBAAoB,CAAC,GAAG,CAAC,YAAY,CAAC,CAAC;YAClE,MAAM,eAAe,GAAG,UAAU,CAAC;YACnC,MAAM,WAAW,CAAC,SAAS,CAAC,UAAU,CAAC,aAAa,EAAE,QAAQ,CAAC,UAAU,CAAC,eAAe,CAAC,CAAC,CAAC;YAE5F,UAAU,CAAC,UAAU,GAAG,EAAE,YAAY,EAAE,IAAI,EAAE,QAAQ,EAAE,KAAK,EAAE,CAAC;YAChE,MAAM,UAAU,CAAC,IAAI,CAAC,MAAM,MAAM,CAAC,YAAY,CAAC,UAAU,CAAC,QAAQ,CAAC,CAAC,CAAC;YACtE,MAAM,CAAC,eAAe,CAAC,UAAU,CAAC,MAAM,+CAA0B,CAAC;YAEnE,MAAM,UAAU,CAAC,MAAM,CAAC,UAAU,CAAC,SAAS,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC,eAAe,EAAE,IAAI,CAAC,CAAC;YACjF,MAAM,CAAC,eAAe,CAAC,UAAU,CAAC,MAAM,qCAAqB,CAAC;YAC9D,eAAe,CAAC,UAAU,CAAC,SAAS,CAAC,SAAS,EAAE,EAAE,CAAC,CAAC;YAEpD,MAAM,UAAU,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC;YAC9B,MAAM,CAAC,eAAe,CAAC,UAAU,CAAC,MAAM,+BAAkB,CAAC;YAC3D,MAAM,CAAC,WAAW,CAAC,CAAC,MAAM,UAAU,CAAC,iBAAiB,CAAC,IAAI,CAAC,CAAC,CAAC,QAAQ,EAAE,OAAO,EAAE,EAAE,CAAC,CAAC;YACrF,MAAM,CAAC,EAAE,CAAC,CAAC,CAAC,MAAM,WAAW,CAAC,MAAM,CAAC,UAAU,CAAC,aAAa,CAAC,CAAC,CAAC,CAAC;QAClE,CAAC,CAAC,CAAC;IACJ,CAAC,CAAC,CAAC;IAEH,IAAI,CAAC,uCAAuC,EAAE,KAAK,IAAI,EAAE;QACxD,MAAM,kBAAkB,CAAO,EAAE,EAAE,KAAK,IAAI,EAAE;YAC7C,MAAM,UAAU,GAAqB,eAAe,CAAC,GAAG,CAAC,MAAM,CAAC,oBAAoB,CAAC,cAAc,CAAC,gBAAgB,EAAE,EAAE,YAAY,wCAAuB,EAAE,OAAO,EAAE,MAAM,CAAC,oBAAoB,CAAC,GAAG,CAAC,wBAAwB,CAAC,CAAC,cAAc,EAAE,EAAE,SAAS,CAAC,CAAC,CAAC;YAC9P,UAAU,CAAC,WAAW,CAAC,IAAI,EAAE,CAAC;YAC9B,MAAM,UAAU,CAAC,IAAI,CAAC,MAAM,MAAM,CAAC,YAAY,CAAC,UAAU,CAAC,QAAQ,CAAC,CAAC,CAAC;YACtE,MAAM,WAAW,GAAG,MAAM,CAAC,oBAAoB,CAAC,GAAG,CAAC,YAAY,CAAC,CAAC;YAClE,MAAM,WAAW,CAAC,GAAG,CAAC,UAAU,CAAC,aAAa,CAAC,CAAC;YAEhD,UAAU,CAAC,UAAU,GAAG,EAAE,YAAY,EAAE,IAAI,EAAE,QAAQ,EAAE,KAAK,EAAE,CAAC;YAChE,MAAM,UAAU,CAAC,IAAI,CAAC,MAAM,MAAM,CAAC,YAAY,CAAC,UAAU,CAAC,QAAQ,CAAC,CAAC,CAAC;YACtE,MAAM,CAAC,eAAe,CAAC,UAAU,CAAC,MAAM,+CAA0B,CAAC;YAEnE,MAAM,UAAU,CAAC,MAAM,CAAC,UAAU,CAAC,SAAS,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC,aAAa,CAAC,CAAC;YACzE,MAAM,CAAC,eAAe,CAAC,UAAU,CAAC,MAAM,qCAAqB,CAAC;YAC9D,eAAe,CAAC,UAAU,CAAC,SAAS,CAAC,SAAS,EAAE,EAAE,CAAC,CAAC;YAEpD,MAAM,UAAU,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC;YAC9B,MAAM,CAAC,eAAe,CAAC,UAAU,CAAC,MAAM,+BAAkB,CAAC;YAC3D,MAAM,CAAC,WAAW,CAAC,CAAC,MAAM,UAAU,CAAC,iBAAiB,CAAC,IAAI,CAAC,CAAC,CAAC,QAAQ,EAAE,OAAO,EAAE,EAAE,CAAC,CAAC;YACrF,MAAM,CAAC,EAAE,CAAC,CAAC,CAAC,MAAM,WAAW,CAAC,MAAM,CAAC,UAAU,CAAC,aAAa,CAAC,CAAC,CAAC,CAAC;QAClE,CAAC,CAAC,CAAC;IACJ,CAAC,CAAC,CAAC;IAEH,IAAI,CAAC,wCAAwC,EAAE,KAAK,IAAI,EAAE;QACzD,MAAM,kBAAkB,CAAO,EAAE,EAAE,KAAK,IAAI,EAAE;YAC7C,MAAM,UAAU,GAAqB,eAAe,CAAC,GAAG,CAAC,MAAM,CAAC,oBAAoB,CAAC,cAAc,CAAC,gBAAgB,EAAE,EAAE,YAAY,wCAAuB,EAAE,OAAO,EAAE,MAAM,CAAC,oBAAoB,CAAC,GAAG,CAAC,wBAAwB,CAAC,CAAC,cAAc,EAAE,EAAE,SAAS,CAAC,CAAC,CAAC;YAC9P,UAAU,CAAC,WAAW,CAAC,IAAI,EAAE,CAAC;YAC9B,MAAM,WAAW,GAAG,MAAM,CAAC,oBAAoB,CAAC,GAAG,CAAC,YAAY,CAAC,CAAC;YAClE,MAAM,WAAW,CAAC,SAAS,CAAC,UAAU,CAAC,aAAa,EAAE,QAAQ,CAAC,UAAU,CAAC,cAAc,CAAC,CAAC,CAAC;YAC3F,UAAU,CAAC,UAAU,GAAG,EAAE,YAAY,EAAE,IAAI,EAAE,QAAQ,EAAE,KAAK,EAAE,CAAC;YAEhE,MAAM,UAAU,CAAC,IAAI,CAAC,MAAM,MAAM,CAAC,YAAY,CAAC,UAAU,CAAC,QAAQ,CAAC,CAAC,CAAC;YACtE,MAAM,CAAC,eAAe,CAAC,UAAU,CAAC,MAAM,+CAA0B,CAAC;YAEnE,MAAM,UAAU,CAAC,MAAM,CAAC,UAAU,CAAC,SAAS,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC,cAAc,CAAC,CAAC;YAC1E,MAAM,CAAC,eAAe,CAAC,UAAU,CAAC,MAAM,qCAAqB,CAAC;YAC9D,eAAe,CAAC,UAAU,CAAC,SAAS,CAAC,SAAS,EAAE,EAAE,CAAC,CAAC;YAEpD,MAAM,UAAU,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC;YAC9B,MAAM,CAAC,eAAe,CAAC,UAAU,CAAC,MAAM,+BAAkB,CAAC;YAC3D,MAAM,CAAC,WAAW,CAAC,CAAC,MAAM,UAAU,CAAC,iBAAiB,CAAC,IAAI,CAAC,CAAC,CAAC,QAAQ,EAAE,IAAI,CAAC,CAAC;YAC9E,MAAM,CAAC,EAAE,CAAC,CAAC,CAAC,MAAM,WAAW,CAAC,MAAM,CAAC,UAAU,CAAC,aAAa,CAAC,CAAC,CAAC,CAAC;QAClE,CAAC,CAAC,CAAC;IACJ,CAAC,CAAC,CAAC;IAEH,IAAI,CAAC,6CAA6C,EAAE,KAAK,IAAI,EAAE;QAC9D,MAAM,kBAAkB,CAAO,EAAE,EAAE,KAAK,IAAI,EAAE;YAC7C,MAAM,UAAU,GAAqB,eAAe,CAAC,GAAG,CAAC,MAAM,CAAC,oBAAoB,CAAC,cAAc,CAAC,gBAAgB,EAAE,EAAE,YAAY,wCAAuB,EAAE,OAAO,EAAE,MAAM,CAAC,oBAAoB,CAAC,GAAG,CAAC,wBAAwB,CAAC,CAAC,cAAc,EAAE,EAAE,SAAS,CAAC,CAAC,CAAC;YAC9P,YAAY;YACZ,UAAU,CAAC,WAAW,CAAC,IAAI,EAAE,CAAC;YAC9B,MAAM,UAAU,CAAC,IAAI,CAAC,MAAM,MAAM,CAAC,YAAY,CAAC,UAAU,CAAC,QAAQ,CAAC,CAAC,CAAC;YACtE,UAAU,CAAC,WAAW,GAAG,IAAI,OAAO,EAAE,CAAC;YAEvC,oEAAoE;YACpE,MAAM,UAAU,GAAG,UAAU,CAAC,YAAY,CAAC,KAAK,CAAC,KAAK,IAAI,EAAE;gBAC3D,UAAU,CAAC,OAAO,EAAE,CAAC;gBACrB,MAAM,UAAU,CAAC,QAAQ,CAAC,GAAG,EAAE,GAAI,CAAC,CAAC;gBACrC,MAAM,CAAC,KAAK,EAAE,CAAC;gBACf,UAAU,CAAC,WAAW,CAAC,IAAI,EAAE,CAAC;YAC/B,CAAC,CAAC,CAAC;YAEH,eAAe;YACf,MAAM,GAAG,GAAG,MAAM,MAAM,CAAC,YAAY,CAAC,UAAU,CAAC,QAAQ,CAAC,CAAC;YAC3D,MAAM,UAAU,CAAC,IAAI,CAAC,MAAM,MAAM,CAAC,YAAY,CAAC,UAAU,CAAC,QAAQ,CAAC,CAAC,CAAC;YAEtE,MAAM,CAAC,eAAe,CAAC,MAAM,CAAC,QAAQ,EAAE;gBACvC,EAAE,IAAI,EAAE,MAAM,EAAE,GAAG,EAAE,GAAG,MAAM,CAAC,GAAG,gBAAgB,UAAU,CAAC,QAAQ,EAAE,EAAE,OAAO,EAAE,EAAE,UAAU,EAAE,GAAG,EAAE,EAAE;gBACvG,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,EAAE,GAAG,MAAM,CAAC,GAAG,gBAAgB,UAAU,CAAC,QAAQ,SAAS,EAAE,OAAO,EAAE,EAAE,EAAE;gBAC5F,EAAE,IAAI,EAAE,MAAM,EAAE,GAAG,EAAE,GAAG,MAAM,CAAC,GAAG,gBAAgB,UAAU,CAAC,QAAQ,EAAE,EAAE,OAAO,EAAE,EAAE,UAAU,EAAE,GAAG,QAAQ,CAAC,GAAI,CAAC,GAAG,CAAC,EAAE,EAAE,EAAE;aAC3H,CAAC,CAAC;QACJ,CAAC,CAAC,CAAC;IACJ,CAAC,CAAC,CAAC;IAEH,IAAI,CAAC,+DAA+D,EAAE,KAAK,IAAI,EAAE;QAChF,MAAM,kBAAkB,CAAO,EAAE,EAAE,KAAK,IAAI,EAAE;YAC7C,MAAM,UAAU,GAAqB,eAAe,CAAC,GAAG,CAAC,MAAM,CAAC,oBAAoB,CAAC,cAAc,CAAC,gBAAgB,EAAE,EAAE,YAAY,wCAAuB,EAAE,OAAO,EAAE,MAAM,CAAC,oBAAoB,CAAC,GAAG,CAAC,wBAAwB,CAAC,CAAC,cAAc,EAAE,EAAE,SAAS,CAAC,CAAC,CAAC;YAC9P,UAAU,CAAC,WAAW,CAAC,IAAI,EAAE,CAAC;YAC9B,MAAM,UAAU,CAAC,IAAI,CAAC,MAAM,MAAM,CAAC,YAAY,CAAC,UAAU,CAAC,QAAQ,CAAC,CAAC,CAAC;YAEtE,MAAM,CAAC,KAAK,EAAE,CAAC;YACf,MAAM,OAAO,GAAG,KAAK,CAAC,SAAS,CAAC,UAAU,CAAC,2BAA2B,CAAC,KAAK,CAAC,CAAC;YAC9E,UAAU,CAAC,sBAAsB,EAAE,CAAC;YAEpC,MAAM,OAAO,CAAC;YACd,MAAM,CAAC,eAAe,CAAC,MAAM,CAAC,QAAQ,EAAE,EAAE,CAAC,CAAC;QAC7C,CAAC,CAAC,CAAC;IACJ,CAAC,CAAC,CAAC;IAEH,IAAI,CAAC,uDAAuD,EAAE,KAAK,IAAI,EAAE;QACxE,MAAM,kBAAkB,CAAO,EAAE,EAAE,KAAK,IAAI,EAAE;YAC7C,MAAM,UAAU,GAAqB,eAAe,CAAC,GAAG,CAAC,MAAM,CAAC,oBAAoB,CAAC,cAAc,CAAC,gBAAgB,EAAE,EAAE,YAAY,wCAAuB,EAAE,OAAO,EAAE,MAAM,CAAC,oBAAoB,CAAC,GAAG,CAAC,wBAAwB,CAAC,CAAC,cAAc,EAAE,EAAE,SAAS,CAAC,CAAC,CAAC;YAC9P,UAAU,CAAC,mCAAmC,GAAG,IAAI,CAAC;YAEtD,IAAI,CAAC;gBACJ,MAAM,UAAU,CAAC,IAAI,CAAC,MAAM,MAAM,CAAC,YAAY,CAAC,UAAU,CAAC,QAAQ,CAAC,CAAC,CAAC;gBACtE,MAAM,CAAC,IAAI,CAAC,uBAAuB,CAAC,CAAC;YACtC,CAAC;YAAC,OAAO,KAAK,EAAE,CAAC;YACjB,CAAC;YAED,MAAM,CAAC,WAAW,CAAC,UAAU,CAAC,MAAM,+BAAkB,CAAC;QACxD,CAAC,CAAC,CAAC;IACJ,CAAC,CAAC,CAAC;AACJ,CAAC,CAAC,CAAC;AAEH,KAAK,CAAC,gCAAgC,EAAE,GAAG,EAAE;IAE5C,MAAM,MAAM,GAAG,IAAI,sBAAsB,EAAE,CAAC;IAC5C,IAAI,MAA0B,CAAC;IAE/B,QAAQ,CAAC,KAAK,IAAI,EAAE;QACnB,MAAM,MAAM,CAAC,oBAAoB,CAAC,GAAG,CAAC,yBAAyB,CAAC,CAAC,KAAK,EAAE,CAAC;IAC1E,CAAC,CAAC,CAAC;IAEH,MAAM,eAAe,GAAG,uCAAuC,EAAE,CAAC;IAElE,KAAK,CAAC,KAAK,IAAI,EAAE;QAChB,MAAM,GAAG,eAAe,CAAC,GAAG,CAAC,IAAI,kBAAkB,CAAC,MAAM,CAAC,CAAC,CAAC;QAC7D,MAAM,MAAM,CAAC,KAAK,EAAE,CAAC;IACtB,CAAC,CAAC,CAAC;IAEH,IAAI,CAAC,SAAS,EAAE,KAAK,IAAI,EAAE;QAC1B,MAAM,kBAAkB,CAAO,EAAE,EAAE,KAAK,IAAI,EAAE;YAC7C,MAAM,UAAU,GAAqB,eAAe,CAAC,GAAG,CAAC,MAAM,CAAC,oBAAoB,CAAC,cAAc,CAAC,gBAAgB,EAAE,EAAE,YAAY,wCAAuB,EAAE,OAAO,EAAE,MAAM,CAAC,oBAAoB,CAAC,GAAG,CAAC,wBAAwB,CAAC,CAAC,cAAc,EAAE,EAAE,SAAS,CAAC,CAAC,CAAC;YAC9P,UAAU,CAAC,UAAU,GAAG,EAAE,YAAY,EAAE,KAAK,EAAE,QAAQ,EAAE,KAAK,EAAE,CAAC;YACjE,UAAU,CAAC,WAAW,CAAC,IAAI,EAAE,CAAC;YAE9B,MAAM,OAAO,GAAG,MAAM,UAAU,CAAC,IAAI,CAAC,MAAM,MAAM,CAAC,YAAY,CAAC,UAAU,CAAC,QAAQ,CAAC,EAAE,IAAI,CAAC,CAAC;YAE5F,MAAM,CAAC,eAAe,CAAC,UAAU,CAAC,MAAM,qCAAqB,CAAC;YAC9D,cAAc,CAAC,OAAQ,CAAC,gBAAgB,EAAE,CAAC,UAAU,CAAC,aAAa,CAAC,CAAC,CAAC;YACtE,MAAM,CAAC,WAAW,CAAC,OAAQ,CAAC,gBAAgB,CAAC,CAAC,CAAC,CAAC,UAAU,uCAAsB,CAAC;YACjF,eAAe,CAAC,UAAU,CAAC,SAAS,CAAC,SAAS,EAAE,EAAE,CAAC,CAAC;QACrD,CAAC,CAAC,CAAC;IACJ,CAAC,CAAC,CAAC;IAEH,IAAI,CAAC,mBAAmB,EAAE,KAAK,IAAI,EAAE;QACpC,MAAM,kBAAkB,CAAO,EAAE,EAAE,KAAK,IAAI,EAAE;YAC7C,MAAM,UAAU,GAAqB,eAAe,CAAC,GAAG,CAAC,MAAM,CAAC,oBAAoB,CAAC,cAAc,CAAC,gBAAgB,EAAE,EAAE,YAAY,wCAAuB,EAAE,OAAO,EAAE,MAAM,CAAC,oBAAoB,CAAC,GAAG,CAAC,wBAAwB,CAAC,CAAC,cAAc,EAAE,EAAE,SAAS,CAAC,CAAC,CAAC;YAC9P,UAAU,CAAC,UAAU,GAAG,EAAE,YAAY,EAAE,KAAK,EAAE,QAAQ,EAAE,KAAK,EAAE,CAAC;YACjE,UAAU,CAAC,WAAW,CAAC,IAAI,EAAE,CAAC;YAE9B,IAAI,OAAO,GAAG,MAAM,UAAU,CAAC,IAAI,CAAC,MAAM,MAAM,CAAC,YAAY,CAAC,UAAU,CAAC,QAAQ,CAAC,EAAE,IAAI,CAAC,CAAC;YAC1F,OAAO,GAAG,MAAM,UAAU,CAAC,MAAM,CAAC,OAAQ,CAAC,gBAAgB,CAAC,CAAC,CAAC,CAAC,aAAa,CAAC,CAAC;YAE9E,MAAM,CAAC,eAAe,CAAC,UAAU,CAAC,MAAM,qCAAqB,CAAC;YAC9D,cAAc,CAAC,OAAQ,CAAC,gBAAgB,EAAE,CAAC,UAAU,CAAC,aAAa,CAAC,CAAC,CAAC;YACtE,MAAM,CAAC,WAAW,CAAC,OAAQ,CAAC,gBAAgB,CAAC,CAAC,CAAC,CAAC,UAAU,uCAAsB,CAAC;YACjF,eAAe,CAAC,UAAU,CAAC,SAAS,CAAC,SAAS,EAAE,EAAE,CAAC,CAAC;QACrD,CAAC,CAAC,CAAC;IACJ,CAAC,CAAC,CAAC;IAEH,IAAI,CAAC,2BAA2B,EAAE,KAAK,IAAI,EAAE;QAC5C,MAAM,kBAAkB,CAAO,EAAE,EAAE,KAAK,IAAI,EAAE;YAC7C,MAAM,UAAU,GAAqB,eAAe,CAAC,GAAG,CAAC,MAAM,CAAC,oBAAoB,CAAC,cAAc,CAAC,gBAAgB,EAAE,EAAE,YAAY,wCAAuB,EAAE,OAAO,EAAE,MAAM,CAAC,oBAAoB,CAAC,GAAG,CAAC,wBAAwB,CAAC,CAAC,cAAc,EAAE,EAAE,SAAS,CAAC,CAAC,CAAC;YAC9P,UAAU,CAAC,UAAU,GAAG,EAAE,YAAY,EAAE,KAAK,EAAE,QAAQ,EAAE,KAAK,EAAE,CAAC;YACjE,UAAU,CAAC,WAAW,CAAC,IAAI,EAAE,CAAC;YAC9B,MAAM,UAAU,CAAC,IAAI,CAAC,MAAM,MAAM,CAAC,YAAY,CAAC,UAAU,CAAC,QAAQ,CAAC,CAAC,CAAC;YAEtE,MAAM,GAAG,GAAG,MAAM,MAAM,CAAC,YAAY,CAAC,UAAU,CAAC,QAAQ,CAAC,CAAC;YAC3D,IAAI,OAAO,GAAG,MAAM,UAAU,CAAC,IAAI,CAAC,GAAG,EAAE,IAAI,CAAC,CAAC;YAC/C,OAAO,GAAG,MAAM,UAAU,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC;YAExC,MAAM,CAAC,eAAe,CAAC,UAAU,CAAC,MAAM,+BAAkB,CAAC;YAC3D,MAAM,CAAC,WAAW,CAAC,OAAO,EAAE,IAAI,CAAC,CAAC;YAClC,eAAe,CAAC,UAAU,CAAC,SAAS,CAAC,SAAS,EAAE,EAAE,CAAC,CAAC;YAEpD,MAAM,CAAC,WAAW,CAAC,CAAC,MAAM,UAAU,CAAC,iBAAiB,CAAC,IAAI,CAAC,CAAC,CAAC,QAAQ,EAAE,OAAO,EAAE,GAAG,CAAC,CAAC;YACtF,MAAM,CAAC,WAAW,CAAC,CAAC,MAAM,MAAM,CAAC,oBAAoB,CAAC,GAAG,CAAC,YAAY,CAAC,CAAC,QAAQ,CAAC,UAAU,CAAC,aAAa,CAAC,CAAC,CAAC,KAAK,CAAC,QAAQ,EAAE,EAAE,GAAG,CAAC,CAAC;QACpI,CAAC,CAAC,CAAC;IACJ,CAAC,CAAC,CAAC;IAEH,IAAI,CAAC,4BAA4B,EAAE,KAAK,IAAI,EAAE;QAC7C,MAAM,kBAAkB,CAAO,EAAE,EAAE,KAAK,IAAI,EAAE;YAC7C,MAAM,UAAU,GAAqB,eAAe,CAAC,GAAG,CAAC,MAAM,CAAC,oBAAoB,CAAC,cAAc,CAAC,gBAAgB,EAAE,EAAE,YAAY,wCAAuB,EAAE,OAAO,EAAE,MAAM,CAAC,oBAAoB,CAAC,GAAG,CAAC,wBAAwB,CAAC,CAAC,cAAc,EAAE,EAAE,SAAS,CAAC,CAAC,CAAC;YAC9P,UAAU,CAAC,UAAU,GAAG,EAAE,YAAY,EAAE,KAAK,EAAE,QAAQ,EAAE,KAAK,EAAE,CAAC;YACjE,UAAU,CAAC,WAAW,CAAC,IAAI,EAAE,CAAC;YAC9B,MAAM,UAAU,CAAC,IAAI,CAAC,MAAM,MAAM,CAAC,YAAY,CAAC,UAAU,CAAC,QAAQ,CAAC,CAAC,CAAC;YAEtE,MAAM,GAAG,GAAG,MAAM,MAAM,CAAC,YAAY,CAAC,UAAU,CAAC,QAAQ,CAAC,CAAC;YAC3D,IAAI,OAAO,GAAG,MAAM,UAAU,CAAC,IAAI,CAAC,GAAG,EAAE,IAAI,CAAC,CAAC;YAC/C,OAAO,GAAG,MAAM,UAAU,CAAC,MAAM,CAAC,OAAQ,CAAC,gBAAgB,CAAC,CAAC,CAAC,CAAC,eAAe,CAAC,CAAC;YAChF,OAAO,GAAG,MAAM,UAAU,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC;YAExC,MAAM,CAAC,eAAe,CAAC,UAAU,CAAC,MAAM,+BAAkB,CAAC;YAC3D,MAAM,CAAC,WAAW,CAAC,OAAO,EAAE,IAAI,CAAC,CAAC;YAClC,eAAe,CAAC,UAAU,CAAC,SAAS,CAAC,SAAS,EAAE,EAAE,CAAC,CAAC;YAEpD,MAAM,CAAC,WAAW,CAAC,CAAC,MAAM,UAAU,CAAC,iBAAiB,CAAC,IAAI,CAAC,CAAC,CAAC,QAAQ,EAAE,OAAO,EAAE,GAAG,CAAC,CAAC;YACtF,MAAM,CAAC,WAAW,CAAC,CAAC,MAAM,MAAM,CAAC,oBAAoB,CAAC,GAAG,CAAC,YAAY,CAAC,CAAC,QAAQ,CAAC,UAAU,CAAC,aAAa,CAAC,CAAC,CAAC,KAAK,CAAC,QAAQ,EAAE,EAAE,GAAG,CAAC,CAAC;QACpI,CAAC,CAAC,CAAC;IACJ,CAAC,CAAC,CAAC;IAEH,IAAI,CAAC,oBAAoB,EAAE,KAAK,IAAI,EAAE;QACrC,MAAM,kBAAkB,CAAO,EAAE,EAAE,KAAK,IAAI,EAAE;YAC7C,MAAM,UAAU,GAAqB,eAAe,CAAC,GAAG,CAAC,MAAM,CAAC,oBAAoB,CAAC,cAAc,CAAC,gBAAgB,EAAE,EAAE,YAAY,wCAAuB,EAAE,OAAO,EAAE,MAAM,CAAC,oBAAoB,CAAC,GAAG,CAAC,wBAAwB,CAAC,CAAC,cAAc,EAAE,EAAE,SAAS,CAAC,CAAC,CAAC;YAC9P,UAAU,CAAC,UAAU,GAAG,EAAE,YAAY,EAAE,KAAK,EAAE,QAAQ,EAAE,KAAK,EAAE,CAAC;YACjE,UAAU,CAAC,WAAW,CAAC,IAAI,EAAE,CAAC;YAE9B,IAAI,OAAO,GAAG,MAAM,UAAU,CAAC,IAAI,CAAC,MAAM,MAAM,CAAC,YAAY,CAAC,UAAU,CAAC,QAAQ,CAAC,EAAE,IAAI,CAAC,CAAC;YAC1F,OAAO,GAAG,MAAM,UAAU,CAAC,OAAO,CAAC,OAAQ,CAAC,gBAAgB,CAAC,CAAC,CAAC,CAAC,eAAe,CAAC,CAAC;YAEjF,MAAM,CAAC,eAAe,CAAC,UAAU,CAAC,MAAM,qCAAqB,CAAC;YAC9D,cAAc,CAAC,OAAQ,CAAC,gBAAgB,EAAE,CAAC,UAAU,CAAC,aAAa,CAAC,CAAC,CAAC;YACtE,MAAM,CAAC,WAAW,CAAC,OAAQ,CAAC,gBAAgB,CAAC,CAAC,CAAC,CAAC,UAAU,qCAAqB,CAAC;YAChF,eAAe,CAAC,UAAU,CAAC,SAAS,CAAC,SAAS,EAAE,EAAE,CAAC,CAAC;QACrD,CAAC,CAAC,CAAC;IACJ,CAAC,CAAC,CAAC;IAEH,IAAI,CAAC,8BAA8B,EAAE,KAAK,IAAI,EAAE;QAC/C,MAAM,kBAAkB,CAAO,EAAE,EAAE,KAAK,IAAI,EAAE;YAC7C,MAAM,UAAU,GAAqB,eAAe,CAAC,GAAG,CAAC,MAAM,CAAC,oBAAoB,CAAC,cAAc,CAAC,gBAAgB,EAAE,EAAE,YAAY,wCAAuB,EAAE,OAAO,EAAE,MAAM,CAAC,oBAAoB,CAAC,GAAG,CAAC,wBAAwB,CAAC,CAAC,cAAc,EAAE,EAAE,SAAS,CAAC,CAAC,CAAC;YAC9P,UAAU,CAAC,UAAU,GAAG,EAAE,YAAY,EAAE,KAAK,EAAE,QAAQ,EAAE,KAAK,EAAE,CAAC;YACjE,UAAU,CAAC,WAAW,CAAC,IAAI,EAAE,CAAC;YAE9B,IAAI,OAAO,GAAG,MAAM,UAAU,CAAC,IAAI,CAAC,MAAM,MAAM,CAAC,YAAY,CAAC,UAAU,CAAC,QAAQ,CAAC,EAAE,IAAI,CAAC,CAAC;YAC1F,OAAO,GAAG,MAAM,UAAU,CAAC,OAAO,CAAC,OAAQ,CAAC,gBAAgB,CAAC,CAAC,CAAC,CAAC,eAAe,CAAC,CAAC;YACjF,OAAO,GAAG,MAAM,UAAU,CAAC,MAAM,CAAC,OAAQ,CAAC,gBAAgB,CAAC,CAAC,CAAC,CAAC,cAAc,CAAC,CAAC;YAE/E,MAAM,CAAC,eAAe,CAAC,UAAU,CAAC,MAAM,qCAAqB,CAAC;YAC9D,cAAc,CAAC,OAAQ,CAAC,gBAAgB,EAAE,CAAC,UAAU,CAAC,aAAa,CAAC,CAAC,CAAC;YACtE,MAAM,CAAC,WAAW,CAAC,OAAQ,CAAC,gBAAgB,CAAC,CAAC,CAAC,CAAC,UAAU,uCAAsB,CAAC;YACjF,eAAe,CAAC,UAAU,CAAC,SAAS,CAAC,SAAS,EAAE,EAAE,CAAC,CAAC;QACrD,CAAC,CAAC,CAAC;IACJ,CAAC,CAAC,CAAC;IAEH,IAAI,CAAC,wCAAwC,EAAE,KAAK,IAAI,EAAE;QACzD,MAAM,kBAAkB,CAAO,EAAE,EAAE,KAAK,IAAI,EAAE;YAC7C,MAAM,UAAU,GAAqB,eAAe,CAAC,GAAG,CAAC,MAAM,CAAC,oBAAoB,CAAC,cAAc,CAAC,gBAAgB,EAAE,EAAE,YAAY,wCAAuB,EAAE,OAAO,EAAE,MAAM,CAAC,oBAAoB,CAAC,GAAG,CAAC,wBAAwB,CAAC,CAAC,cAAc,EAAE,EAAE,SAAS,CAAC,CAAC,CAAC;YAC9P,UAAU,CAAC,UAAU,GAAG,EAAE,YAAY,EAAE,KAAK,EAAE,QAAQ,EAAE,KAAK,EAAE,CAAC;YACjE,UAAU,CAAC,WAAW,CAAC,IAAI,EAAE,CAAC;YAE9B,IAAI,OAAO,GAAG,MAAM,UAAU,CAAC,IAAI,CAAC,MAAM,MAAM,CAAC,YAAY,CAAC,UAAU,CAAC,QAAQ,CAAC,EAAE,IAAI,CAAC,CAAC;YAC1F,OAAO,GAAG,MAAM,UAAU,CAAC,MAAM,CAAC,OAAQ,CAAC,gBAAgB,CAAC,CAAC,CAAC,CAAC,eAAe,CAAC,CAAC;YAChF,OAAO,GAAG,MAAM,UAAU,CAAC,OAAO,CAAC,OAAQ,CAAC,gBAAgB,CAAC,CAAC,CAAC,CAAC,eAAe,CAAC,CAAC;YACjF,OAAO,GAAG,MAAM,UAAU,CAAC,MAAM,CAAC,OAAQ,CAAC,gBAAgB,CAAC,CAAC,CAAC,CAAC,cAAc,CAAC,CAAC;YAE/E,MAAM,CAAC,eAAe,CAAC,UAAU,CAAC,MAAM,qCAAqB,CAAC;YAC9D,cAAc,CAAC,OAAQ,CAAC,gBAAgB,EAAE,CAAC,UAAU,CAAC,aAAa,CAAC,CAAC,CAAC;YACtE,MAAM,CAAC,WAAW,CAAC,OAAQ,CAAC,gBAAgB,CAAC,CAAC,CAAC,CAAC,UAAU,uCAAsB,CAAC;YACjF,eAAe,CAAC,UAAU,CAAC,SAAS,CAAC,SAAS,EAAE,EAAE,CAAC,CAAC;QACrD,CAAC,CAAC,CAAC;IACJ,CAAC,CAAC,CAAC;IAEH,IAAI,CAAC,8BAA8B,EAAE,KAAK,IAAI,EAAE;QAC/C,MAAM,kBAAkB,CAAO,EAAE,EAAE,KAAK,IAAI,EAAE;YAC7C,MAAM,UAAU,GAAqB,eAAe,CAAC,GAAG,CAAC,MAAM,CAAC,oBAAoB,CAAC,cAAc,CAAC,gBAAgB,EAAE,EAAE,YAAY,wCAAuB,EAAE,OAAO,EAAE,MAAM,CAAC,oBAAoB,CAAC,GAAG,CAAC,wBAAwB,CAAC,CAAC,cAAc,EAAE,EAAE,SAAS,CAAC,CAAC,CAAC;YAC9P,UAAU,CAAC,UAAU,GAAG,EAAE,YAAY,EAAE,KAAK,EAAE,QAAQ,EAAE,KAAK,EAAE,CAAC;YACjE,UAAU,CAAC,WAAW,CAAC,IAAI,EAAE,CAAC;YAE9B,IAAI,OAAO,GAAG,MAAM,UAAU,CAAC,IAAI,CAAC,MAAM,MAAM,CAAC,YAAY,CAAC,UAAU,CAAC,QAAQ,CAAC,EAAE,IAAI,CAAC,CAAC;YAC1F,OAAO,GAAG,MAAM,UAAU,CAAC,MAAM,CAAC,OAAQ,CAAC,gBAAgB,CAAC,CAAC,CAAC,CAAC,cAAc,CAAC,CAAC;YAC/E,OAAO,GAAG,MAAM,UAAU,CAAC,OAAO,CAAC,OAAQ,CAAC,gBAAgB,CAAC,CAAC,CAAC,CAAC,eAAe,CAAC,CAAC;YAEjF,MAAM,CAAC,eAAe,CAAC,UAAU,CAAC,MAAM,qCAAqB,CAAC;YAC9D,cAAc,CAAC,OAAQ,CAAC,gBAAgB,EAAE,CAAC,UAAU,CAAC,aAAa,CAAC,CAAC,CAAC;YACtE,MAAM,CAAC,WAAW,CAAC,OAAQ,CAAC,gBAAgB,CAAC,CAAC,CAAC,CAAC,UAAU,qCAAqB,CAAC;YAChF,eAAe,CAAC,UAAU,CAAC,SAAS,CAAC,SAAS,EAAE,EAAE,CAAC,CAAC;QACrD,CAAC,CAAC,CAAC;IACJ,CAAC,CAAC,CAAC;IAEH,IAAI,CAAC,uCAAuC,EAAE,KAAK,IAAI,EAAE;QACxD,MAAM,kBAAkB,CAAO,EAAE,EAAE,KAAK,IAAI,EAAE;YAC7C,MAAM,UAAU,GAAqB,eAAe,CAAC,GAAG,CAAC,MAAM,CAAC,oBAAoB,CAAC,cAAc,CAAC,gBAAgB,EAAE,EAAE,YAAY,wCAAuB,EAAE,OAAO,EAAE,MAAM,CAAC,oBAAoB,CAAC,GAAG,CAAC,wBAAwB,CAAC,CAAC,cAAc,EAAE,EAAE,SAAS,CAAC,CAAC,CAAC;YAC9P,UAAU,CAAC,UAAU,GAAG,EAAE,YAAY,EAAE,KAAK,EAAE,QAAQ,EAAE,KAAK,EAAE,CAAC;YACjE,UAAU,CAAC,WAAW,CAAC,IAAI,EAAE,CAAC;YAC9B,MAAM,UAAU,CAAC,IAAI,CAAC,MAAM,MAAM,CAAC,YAAY,CAAC,UAAU,CAAC,QAAQ,CAAC,CAAC,CAAC;YAEtE,MAAM,eAAe,GAAG,CAAC,MAAM,MAAM,CAAC,oBAAoB,CAAC,GAAG,CAAC,YAAY,CAAC,CAAC,QAAQ,CAAC,UAAU,CAAC,aAAa,CAAC,CAAC,CAAC,KAAK,CAAC,QAAQ,EAAE,CAAC;YAClI,IAAI,OAAO,GAAG,MAAM,UAAU,CAAC,IAAI,CAAC,MAAM,MAAM,CAAC,YAAY,CAAC,UAAU,CAAC,QAAQ,CAAC,EAAE,IAAI,CAAC,CAAC;YAC1F,OAAO,GAAG,MAAM,UAAU,CAAC,MAAM,CAAC,OAAQ,CAAC,gBAAgB,CAAC,CAAC,CAAC,CAAC,cAAc,CAAC,CAAC;YAC/E,OAAO,GAAG,MAAM,UAAU,CAAC,OAAO,CAAC,OAAQ,CAAC,gBAAgB,CAAC,CAAC,CAAC,CAAC,eAAe,CAAC,CAAC;YACjF,OAAO,GAAG,MAAM,UAAU,CAAC,MAAM,CAAC,OAAQ,CAAC,gBAAgB,CAAC,CAAC,CAAC,CAAC,aAAa,CAAC,CAAC;YAC9E,OAAO,GAAG,MAAM,UAAU,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC;YAExC,MAAM,CAAC,eAAe,CAAC,UAAU,CAAC,MAAM,+BAAkB,CAAC;YAC3D,MAAM,CAAC,WAAW,CAAC,OAAO,EAAE,IAAI,CAAC,CAAC;YAClC,eAAe,CAAC,UAAU,CAAC,SAAS,CAAC,SAAS,EAAE,EAAE,CAAC,CAAC;YACpD,MAAM,CAAC,WAAW,CAAC,CAAC,MAAM,UAAU,CAAC,iBAAiB,CAAC,IAAI,CAAC,CAAC,CAAC,QAAQ,EAAE,OAAO,EAAE,eAAe,CAAC,CAAC;YAClG,MAAM,CAAC,WAAW,CAAC,CAAC,MAAM,MAAM,CAAC,oBAAoB,CAAC,GAAG,CAAC,YAAY,CAAC,CAAC,QAAQ,CAAC,UAAU,CAAC,aAAa,CAAC,CAAC,CAAC,KAAK,CAAC,QAAQ,EAAE,EAAE,eAAe,CAAC,CAAC;QAChJ,CAAC,CAAC,CAAC;IACJ,CAAC,CAAC,CAAC;IAEH,IAAI,CAAC,oBAAoB,EAAE,KAAK,IAAI,EAAE;QACrC,MAAM,kBAAkB,CAAO,EAAE,EAAE,KAAK,IAAI,EAAE;YAC7C,MAAM,UAAU,GAAqB,eAAe,CAAC,GAAG,CAAC,MAAM,CAAC,oBAAoB,CAAC,cAAc,CAAC,gBAAgB,EAAE,EAAE,YAAY,wCAAuB,EAAE,OAAO,EAAE,MAAM,CAAC,oBAAoB,CAAC,GAAG,CAAC,wBAAwB,CAAC,CAAC,cAAc,EAAE,EAAE,SAAS,CAAC,CAAC,CAAC;YAC9P,UAAU,CAAC,UAAU,GAAG,EAAE,YAAY,EAAE,IAAI,EAAE,QAAQ,EAAE,KAAK,EAAE,CAAC;YAChE,UAAU,CAAC,WAAW,CAAC,IAAI,EAAE,CAAC;YAE9B,MAAM,OAAO,GAAG,MAAM,UAAU,CAAC,IAAI,CAAC,MAAM,MAAM,CAAC,YAAY,CAAC,UAAU,CAAC,QAAQ,CAAC,EAAE,IAAI,CAAC,CAAC;YAE5F,MAAM,CAAC,eAAe,CAAC,UAAU,CAAC,MAAM,+CAA0B,CAAC;YACnE,cAAc,CAAC,OAAQ,CAAC,gBAAgB,EAAE,CAAC,UAAU,CAAC,aAAa,CAAC,CAAC,CAAC;YACtE,MAAM,CAAC,WAAW,CAAC,OAAQ,CAAC,gBAAgB,CAAC,CAAC,CAAC,CAAC,UAAU,uCAAsB,CAAC;YACjF,eAAe,CAAC,UAAU,CAAC,SAAS,CAAC,SAAS,EAAE,CAAC,OAAQ,CAAC,gBAAgB,CAAC,CAAC,CAAC,CAAC,aAAa,CAAC,CAAC,CAAC;QAC/F,CAAC,CAAC,CAAC;IACJ,CAAC,CAAC,CAAC;IAEH,IAAI,CAAC,+BAA+B,EAAE,KAAK,IAAI,EAAE;QAChD,MAAM,kBAAkB,CAAO,EAAE,EAAE,KAAK,IAAI,EAAE;YAC7C,MAAM,UAAU,GAAqB,eAAe,CAAC,GAAG,CAAC,MAAM,CAAC,oBAAoB,CAAC,cAAc,CAAC,gBAAgB,EAAE,EAAE,YAAY,wCAAuB,EAAE,OAAO,EAAE,MAAM,CAAC,oBAAoB,CAAC,GAAG,CAAC,wBAAwB,CAAC,CAAC,cAAc,EAAE,EAAE,SAAS,CAAC,CAAC,CAAC;YAC9P,UAAU,CAAC,UAAU,GAAG,EAAE,YAAY,EAAE,IAAI,EAAE,QAAQ,EAAE,KAAK,EAAE,CAAC;YAChE,UAAU,CAAC,WAAW,CAAC,IAAI,EAAE,CAAC;YAE9B,MAAM,OAAO,GAAG,MAAM,UAAU,CAAC,IAAI,CAAC,MAAM,MAAM,CAAC,YAAY,CAAC,UAAU,CAAC,QAAQ,CAAC,EAAE,IAAI,CAAC,CAAC;YAC5F,MAAM,UAAU,CAAC,OAAO,CAAC,OAAQ,CAAC,gBAAgB,CAAC,CAAC,CAAC,CAAC,eAAe,CAAC,CAAC;YAEvE,MAAM,CAAC,eAAe,CAAC,UAAU,CAAC,MAAM,qCAAqB,CAAC;YAC9D,cAAc,CAAC,OAAQ,CAAC,gBAAgB,EAAE,CAAC,UAAU,CAAC,aAAa,CAAC,CAAC,CAAC;YACtE,MAAM,CAAC,WAAW,CAAC,OAAQ,CAAC,gBAAgB,CAAC,CAAC,CAAC,CAAC,UAAU,qCAAqB,CAAC;YAChF,eAAe,CAAC,UAAU,CAAC,SAAS,CAAC,SAAS,EAAE,EAAE,CAAC,CAAC;QACrD,CAAC,CAAC,CAAC;IACJ,CAAC,CAAC,CAAC;IAEH,IAAI,CAAC,8BAA8B,EAAE,KAAK,IAAI,EAAE;QAC/C,MAAM,kBAAkB,CAAO,EAAE,EAAE,KAAK,IAAI,EAAE;YAC7C,MAAM,UAAU,GAAqB,eAAe,CAAC,GAAG,CAAC,MAAM,CAAC,oBAAoB,CAAC,cAAc,CAAC,gBAAgB,EAAE,EAAE,YAAY,wCAAuB,EAAE,OAAO,EAAE,MAAM,CAAC,oBAAoB,CAAC,GAAG,CAAC,wBAAwB,CAAC,CAAC,cAAc,EAAE,EAAE,SAAS,CAAC,CAAC,CAAC;YAC9P,UAAU,CAAC,UAAU,GAAG,EAAE,YAAY,EAAE,IAAI,EAAE,QAAQ,EAAE,KAAK,EAAE,CAAC;YAChE,UAAU,CAAC,WAAW,CAAC,IAAI,EAAE,CAAC;YAE9B,IAAI,OAAO,GAAG,MAAM,UAAU,CAAC,IAAI,CAAC,MAAM,MAAM,CAAC,YAAY,CAAC,UAAU,CAAC,QAAQ,CAAC,EAAE,IAAI,CAAC,CAAC;YAC1F,MAAM,OAAO,GAAG,MAAM,UAAU,CAAC,cAAc,CAAC,OAAQ,CAAC,gBAAgB,CAAC,CAAC,CAAC,CAAC,eAAe,CAAC,CAAC;YAC9F,OAAO,GAAG,MAAM,UAAU,CAAC,MAAM,CAAC,OAAQ,CAAC,gBAAgB,CAAC,CAAC,CAAC,CAAC,eAAe,EAAE,OAAO,CAAC,CAAC;YAEzF,MAAM,CAAC,eAAe,CAAC,UAAU,CAAC,MAAM,qCAAqB,CAAC;YAC9D,cAAc,CAAC,OAAQ,CAAC,gBAAgB,EAAE,CAAC,UAAU,CAAC,aAAa,CAAC,CAAC,CAAC;YACtE,MAAM,CAAC,eAAe,CAAC,UAAU,CAAC,SAAS,CAAC,SAAS,EAAE,EAAE,CAAC,CAAC;QAC5D,CAAC,CAAC,CAAC;IACJ,CAAC,CAAC,CAAC;IAEH,IAAI,CAAC,gCAAgC,EAAE,KAAK,IAAI,EAAE;QACjD,MAAM,kBAAkB,CAAO,EAAE,EAAE,KAAK,IAAI,EAAE;YAC7C,MAAM,UAAU,GAAqB,eAAe,CAAC,GAAG,CAAC,MAAM,CAAC,oBAAoB,CAAC,cAAc,CAAC,gBAAgB,EAAE,EAAE,YAAY,wCAAuB,EAAE,OAAO,EAAE,MAAM,CAAC,oBAAoB,CAAC,GAAG,CAAC,wBAAwB,CAAC,CAAC,cAAc,EAAE,EAAE,SAAS,CAAC,CAAC,CAAC;YAC9P,UAAU,CAAC,UAAU,GAAG,EAAE,YAAY,EAAE,IAAI,EAAE,QAAQ,EAAE,KAAK,EAAE,CAAC;YAChE,UAAU,CAAC,WAAW,CAAC,IAAI,EAAE,CAAC;YAE9B,IAAI,OAAO,GAAG,MAAM,UAAU,CAAC,IAAI,CAAC,MAAM,MAAM,CAAC,YAAY,CAAC,UAAU,CAAC,QAAQ,CAAC,EAAE,IAAI,CAAC,CAAC;YAC1F,MAAM,OAAO,GAAG,MAAM,UAAU,CAAC,cAAc,CAAC,OAAQ,CAAC,gBAAgB,CAAC,CAAC,CAAC,CAAC,eAAe,CAAC,CAAC;YAC9F,OAAO,GAAG,MAAM,UAAU,CAAC,MAAM,CAAC,OAAQ,CAAC,gBAAgB,CAAC,CAAC,CAAC,CAAC,eAAe,EAAE,OAAO,CAAC,CAAC;YAEzF,MAAM,CAAC,eAAe,CAAC,UAAU,CAAC,MAAM,qCAAqB,CAAC;YAC9D,cAAc,CAAC,OAAQ,CAAC,gBAAgB,EAAE,CAAC,UAAU,CAAC,aAAa,CAAC,CAAC,CAAC;YACtE,eAAe,CAAC,UAAU,CAAC,SAAS,CAAC,SAAS,EAAE,EAAE,CAAC,CAAC;QACrD,CAAC,CAAC,CAAC;IACJ,CAAC,CAAC,CAAC;IAEH,IAAI,CAAC,uCAAuC,EAAE,KAAK,IAAI,EAAE;QACxD,MAAM,kBAAkB,CAAO,EAAE,EAAE,KAAK,IAAI,EAAE;YAC7C,MAAM,UAAU,GAAqB,eAAe,CAAC,GAAG,CAAC,MAAM,CAAC,oBAAoB,CAAC,cAAc,CAAC,gBAAgB,EAAE,EAAE,YAAY,wCAAuB,EAAE,OAAO,EAAE,MAAM,CAAC,oBAAoB,CAAC,GAAG,CAAC,wBAAwB,CAAC,CAAC,cAAc,EAAE,EAAE,SAAS,CAAC,CAAC,CAAC;YAC9P,UAAU,CAAC,UAAU,GAAG,EAAE,YAAY,EAAE,KAAK,EAAE,QAAQ,EAAE,KAAK,EAAE,CAAC;YACjE,UAAU,CAAC,WAAW,CAAC,IAAI,EAAE,CAAC;YAC9B,MAAM,UAAU,CAAC,IAAI,CAAC,MAAM,MAAM,CAAC,YAAY,CAAC,UAAU,CAAC,QAAQ,CAAC,CAAC,CAAC;YAEtE,UAAU,CAAC,UAAU,GAAG,EAAE,YAAY,EAAE,IAAI,EAAE,QAAQ,EAAE,KAAK,EAAE,CAAC;YAChE,MAAM,GAAG,GAAG,MAAM,MAAM,CAAC,YAAY,CAAC,UAAU,CAAC,QAAQ,CAAC,CAAC;YAC3D,IAAI,OAAO,GAAG,MAAM,UAAU,CAAC,IAAI,CAAC,GAAG,EAAE,IAAI,CAAC,CAAC;YAE/C,OAAO,GAAG,MAAM,UAAU,CAAC,MAAM,CAAC,OAAQ,CAAC,gBAAgB,CAAC,CAAC,CAAC,CAAC,eAAe,CAAC,CAAC;YAChF,OAAO,GAAG,MAAM,UAAU,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC;YAExC,MAAM,CAAC,eAAe,CAAC,UAAU,CAAC,MAAM,+BAAkB,CAAC;YAC3D,MAAM,CAAC,WAAW,CAAC,OAAO,EAAE,IAAI,CAAC,CAAC;YAClC,eAAe,CAAC,UAAU,CAAC,SAAS,CAAC,SAAS,EAAE,EAAE,CAAC,CAAC;YAEpD,MAAM,CAAC,WAAW,CAAC,CAAC,MAAM,UAAU,CAAC,iBAAiB,CAAC,IAAI,CAAC,CAAC,CAAC,QAAQ,EAAE,OAAO,EAAE,GAAG,CAAC,CAAC;YACtF,MAAM,CAAC,WAAW,CAAC,CAAC,MAAM,MAAM,CAAC,oBAAoB,CAAC,GAAG,CAAC,YAAY,CAAC,CAAC,QAAQ,CAAC,UAAU,CAAC,aAAa,CAAC,CAAC,CAAC,KAAK,CAAC,QAAQ,EAAE,EAAE,GAAG,CAAC,CAAC;QACpI,CAAC,CAAC,CAAC;IACJ,CAAC,CAAC,CAAC;IAEH,IAAI,CAAC,+BAA+B,EAAE,KAAK,IAAI,EAAE;QAChD,MAAM,kBAAkB,CAAO,EAAE,EAAE,KAAK,IAAI,EAAE;YAC7C,MAAM,UAAU,GAAqB,eAAe,CAAC,GAAG,CAAC,MAAM,CAAC,oBAAoB,CAAC,cAAc,CAAC,gBAAgB,EAAE,EAAE,YAAY,wCAAuB,EAAE,OAAO,EAAE,MAAM,CAAC,oBAAoB,CAAC,GAAG,CAAC,wBAAwB,CAAC,CAAC,cAAc,EAAE,EAAE,SAAS,CAAC,CAAC,CAAC;YAC9P,UAAU,CAAC,UAAU,GAAG,EAAE,YAAY,EAAE,IAAI,EAAE,QAAQ,EAAE,KAAK,EAAE,CAAC;YAChE,UAAU,CAAC,WAAW,CAAC,IAAI,EAAE,CAAC;YAE9B,IAAI,OAAO,GAAG,MAAM,UAAU,CAAC,IAAI,CAAC,MAAM,MAAM,CAAC,YAAY,CAAC,UAAU,CAAC,QAAQ,CAAC,EAAE,IAAI,CAAC,CAAC;YAC1F,OAAO,GAAG,MAAM,UAAU,CAAC,OAAO,CAAC,OAAQ,CAAC,gBAAgB,CAAC,CAAC,CAAC,CAAC,eAAe,CAAC,CAAC;YAEjF,MAAM,CAAC,eAAe,CAAC,UAAU,CAAC,MAAM,qCAAqB,CAAC;YAC9D,cAAc,CAAC,OAAQ,CAAC,gBAAgB,EAAE,CAAC,UAAU,CAAC,aAAa,CAAC,CAAC,CAAC;YACtE,MAAM,CAAC,WAAW,CAAC,OAAQ,CAAC,gBAAgB,CAAC,CAAC,CAAC,CAAC,UAAU,qCAAqB,CAAC;YAChF,eAAe,CAAC,UAAU,CAAC,SAAS,CAAC,SAAS,EAAE,EAAE,CAAC,CAAC;QACrD,CAAC,CAAC,CAAC;IACJ,CAAC,CAAC,CAAC;IAEH,IAAI,CAAC,yCAAyC,EAAE,KAAK,IAAI,EAAE;QAC1D,MAAM,kBAAkB,CAAO,EAAE,EAAE,KAAK,IAAI,EAAE;YAC7C,MAAM,UAAU,GAAqB,eAAe,CAAC,GAAG,CAAC,MAAM,CAAC,oBAAoB,CAAC,cAAc,CAAC,gBAAgB,EAAE,EAAE,YAAY,wCAAuB,EAAE,OAAO,EAAE,MAAM,CAAC,oBAAoB,CAAC,GAAG,CAAC,wBAAwB,CAAC,CAAC,cAAc,EAAE,EAAE,SAAS,CAAC,CAAC,CAAC;YAC9P,UAAU,CAAC,UAAU,GAAG,EAAE,YAAY,EAAE,IAAI,EAAE,QAAQ,EAAE,KAAK,EAAE,CAAC;YAChE,UAAU,CAAC,WAAW,CAAC,IAAI,EAAE,CAAC;YAE9B,IAAI,OAAO,GAAG,MAAM,UAAU,CAAC,IAAI,CAAC,MAAM,MAAM,CAAC,YAAY,CAAC,UAAU,CAAC,QAAQ,CAAC,EAAE,IAAI,CAAC,CAAC;YAC1F,OAAO,GAAG,MAAM,UAAU,CAAC,OAAO,CAAC,OAAQ,CAAC,gBAAgB,CAAC,CAAC,CAAC,CAAC,eAAe,CAAC,CAAC;YACjF,OAAO,GAAG,MAAM,UAAU,CAAC,MAAM,CAAC,OAAQ,CAAC,gBAAgB,CAAC,CAAC,CAAC,CAAC,cAAc,CAAC,CAAC;YAE/E,MAAM,CAAC,eAAe,CAAC,UAAU,CAAC,MAAM,qCAAqB,CAAC;YAC9D,cAAc,CAAC,OAAQ,CAAC,gBAAgB,EAAE,CAAC,UAAU,CAAC,aAAa,CAAC,CAAC,CAAC;YACtE,MAAM,CAAC,WAAW,CAAC,OAAQ,CAAC,gBAAgB,CAAC,CAAC,CAAC,CAAC,UAAU,uCAAsB,CAAC;YACjF,eAAe,CAAC,UAAU,CAAC,SAAS,CAAC,SAAS,EAAE,EAAE,CAAC,CAAC;QACrD,CAAC,CAAC,CAAC;IACJ,CAAC,CAAC,CAAC;IAEH,IAAI,CAAC,mDAAmD,EAAE,KAAK,IAAI,EAAE;QACpE,MAAM,kBAAkB,CAAO,EAAE,EAAE,KAAK,IAAI,EAAE;YAC7C,MAAM,UAAU,GAAqB,eAAe,CAAC,GAAG,CAAC,MAAM,CAAC,oBAAoB,CAAC,cAAc,CAAC,gBAAgB,EAAE,EAAE,YAAY,wCAAuB,EAAE,OAAO,EAAE,MAAM,CAAC,oBAAoB,CAAC,GAAG,CAAC,wBAAwB,CAAC,CAAC,cAAc,EAAE,EAAE,SAAS,CAAC,CAAC,CAAC;YAC9P,UAAU,CAAC,UAAU,GAAG,EAAE,YAAY,EAAE,IAAI,EAAE,QAAQ,EAAE,KAAK,EAAE,CAAC;YAChE,UAAU,CAAC,WAAW,CAAC,IAAI,EAAE,CAAC;YAE9B,IAAI,OAAO,GAAG,MAAM,UAAU,CAAC,IAAI,CAAC,MAAM,MAAM,CAAC,YAAY,CAAC,UAAU,CAAC,QAAQ,CAAC,EAAE,IAAI,CAAC,CAAC;YAC1F,OAAO,GAAG,MAAM,UAAU,CAAC,MAAM,CAAC,OAAQ,CAAC,gBAAgB,CAAC,CAAC,CAAC,CAAC,eAAe,CAAC,CAAC;YAChF,OAAO,GAAG,MAAM,UAAU,CAAC,OAAO,CAAC,OAAQ,CAAC,gBAAgB,CAAC,CAAC,CAAC,CAAC,eAAe,CAAC,CAAC;YACjF,OAAO,GAAG,MAAM,UAAU,CAAC,MAAM,CAAC,OAAQ,CAAC,gBAAgB,CAAC,CAAC,CAAC,CAAC,cAAc,CAAC,CAAC;YAE/E,MAAM,CAAC,eAAe,CAAC,UAAU,CAAC,MAAM,qCAAqB,CAAC;YAC9D,cAAc,CAAC,OAAQ,CAAC,gBAAgB,EAAE,CAAC,UAAU,CAAC,aAAa,CAAC,CAAC,CAAC;YACtE,MAAM,CAAC,WAAW,CAAC,OAAQ,CAAC,gBAAgB,CAAC,CAAC,CAAC,CAAC,UAAU,uCAAsB,CAAC;YACjF,eAAe,CAAC,UAAU,CAAC,SAAS,CAAC,SAAS,EAAE,EAAE,CAAC,CAAC;QACrD,CAAC,CAAC,CAAC;IACJ,CAAC,CAAC,CAAC;IAEH,IAAI,CAAC,yCAAyC,EAAE,KAAK,IAAI,EAAE;QAC1D,MAAM,kBAAkB,CAAO,EAAE,EAAE,KAAK,IAAI,EAAE;YAC7C,MAAM,UAAU,GAAqB,eAAe,CAAC,GAAG,CAAC,MAAM,CAAC,oBAAoB,CAAC,cAAc,CAAC,gBAAgB,EAAE,EAAE,YAAY,wCAAuB,EAAE,OAAO,EAAE,MAAM,CAAC,oBAAoB,CAAC,GAAG,CAAC,wBAAwB,CAAC,CAAC,cAAc,EAAE,EAAE,SAAS,CAAC,CAAC,CAAC;YAC9P,UAAU,CAAC,UAAU,GAAG,EAAE,YAAY,EAAE,KAAK,EAAE,QAAQ,EAAE,KAAK,EAAE,CAAC;YACjE,UAAU,CAAC,WAAW,CAAC,IAAI,EAAE,CAAC;YAE9B,IAAI,OAAO,GAAG,MAAM,UAAU,CAAC,IAAI,CAAC,MAAM,MAAM,CAAC,YAAY,CAAC,UAAU,CAAC,QAAQ,CAAC,EAAE,IAAI,CAAC,CAAC;YAC1F,OAAO,GAAG,MAAM,UAAU,CAAC,MAAM,CAAC,OAAQ,CAAC,gBAAgB,CAAC,CAAC,CAAC,CAAC,cAAc,CAAC,CAAC;YAC/E,OAAO,GAAG,MAAM,UAAU,CAAC,OAAO,CAAC,OAAQ,CAAC,gBAAgB,CAAC,CAAC,CAAC,CAAC,eAAe,CAAC,CAAC;YAEjF,MAAM,CAAC,eAAe,CAAC,UAAU,CAAC,MAAM,qCAAqB,CAAC;YAC9D,cAAc,CAAC,OAAQ,CAAC,gBAAgB,EAAE,CAAC,UAAU,CAAC,aAAa,CAAC,CAAC,CAAC;YACtE,MAAM,CAAC,WAAW,CAAC,OAAQ,CAAC,gBAAgB,CAAC,CAAC,CAAC,CAAC,UAAU,qCAAqB,CAAC;YAChF,eAAe,CAAC,UAAU,CAAC,SAAS,CAAC,SAAS,EAAE,EAAE,CAAC,CAAC;QACrD,CAAC,CAAC,CAAC;IACJ,CAAC,CAAC,CAAC;IAEH,IAAI,CAAC,kDAAkD,EAAE,KAAK,IAAI,EAAE;QACnE,MAAM,kBAAkB,CAAO,EAAE,EAAE,KAAK,IAAI,EAAE;YAC7C,MAAM,UAAU,GAAqB,eAAe,CAAC,GAAG,CAAC,MAAM,CAAC,oBAAoB,CAAC,cAAc,CAAC,gBAAgB,EAAE,EAAE,YAAY,wCAAuB,EAAE,OAAO,EAAE,MAAM,CAAC,oBAAoB,CAAC,GAAG,CAAC,wBAAwB,CAAC,CAAC,cAAc,EAAE,EAAE,SAAS,CAAC,CAAC,CAAC;YAC9P,UAAU,CAAC,UAAU,GAAG,EAAE,YAAY,EAAE,KAAK,EAAE,QAAQ,EAAE,KAAK,EAAE,CAAC;YACjE,UAAU,CAAC,WAAW,CAAC,IAAI,EAAE,CAAC;YAC9B,MAAM,UAAU,CAAC,IAAI,CAAC,MAAM,MAAM,CAAC,YAAY,CAAC,UAAU,CAAC,QAAQ,CAAC,CAAC,CAAC;YAEtE,MAAM,eAAe,GAAG,CAAC,MAAM,MAAM,CAAC,oBAAoB,CAAC,GAAG,CAAC,YAAY,CAAC,CAAC,QAAQ,CAAC,UAAU,CAAC,aAAa,CAAC,CAAC,CAAC,KAAK,CAAC,QAAQ,EAAE,CAAC;YAClI,IAAI,OAAO,GAAG,MAAM,UAAU,CAAC,IAAI,CAAC,MAAM,MAAM,CAAC,YAAY,CAAC,UAAU,CAAC,QAAQ,CAAC,EAAE,IAAI,CAAC,CAAC;YAC1F,OAAO,GAAG,MAAM,UAAU,CAAC,OAAO,CAAC,OAAQ,CAAC,gBAAgB,CAAC,CAAC,CAAC,CAAC,eAAe,CAAC,CAAC;YACjF,OAAO,GAAG,MAAM,UAAU,CAAC,MAAM,CAAC,OAAQ,CAAC,gBAAgB,CAAC,CAAC,CAAC,CAAC,aAAa,CAAC,CAAC;YAC9E,OAAO,GAAG,MAAM,UAAU,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC;YAExC,MAAM,CAAC,eAAe,CAAC,UAAU,CAAC,MAAM,+BAAkB,CAAC;YAC3D,MAAM,CAAC,WAAW,CAAC,OAAO,EAAE,IAAI,CAAC,CAAC;YAClC,eAAe,CAAC,UAAU,CAAC,SAAS,CAAC,SAAS,EAAE,EAAE,CAAC,CAAC;YACpD,MAAM,CAAC,WAAW,CAAC,CAAC,MAAM,UAAU,CAAC,iBAAiB,CAAC,IAAI,CAAC,CAAC,CAAC,QAAQ,EAAE,OAAO,EAAE,eAAe,CAAC,CAAC;YAClG,MAAM,CAAC,WAAW,CAAC,CAAC,MAAM,MAAM,CAAC,oBAAoB,CAAC,GAAG,CAAC,YAAY,CAAC,CAAC,QAAQ,CAAC,UAAU,CAAC,aAAa,CAAC,CAAC,CAAC,KAAK,CAAC,QAAQ,EAAE,EAAE,eAAe,CAAC,CAAC;QAChJ,CAAC,CAAC,CAAC;IACJ,CAAC,CAAC,CAAC;IAEH,IAAI,CAAC,4DAA4D,EAAE,KAAK,IAAI,EAAE;QAC7E,MAAM,kBAAkB,CAAO,EAAE,EAAE,KAAK,IAAI,EAAE;YAC7C,MAAM,UAAU,GAAqB,eAAe,CAAC,GAAG,CAAC,MAAM,CAAC,oBAAoB,CAAC,cAAc,CAAC,gBAAgB,EAAE,EAAE,YAAY,wCAAuB,EAAE,OAAO,EAAE,MAAM,CAAC,oBAAoB,CAAC,GAAG,CAAC,wBAAwB,CAAC,CAAC,cAAc,EAAE,EAAE,SAAS,CAAC,CAAC,CAAC;YAC9P,UAAU,CAAC,UAAU,GAAG,EAAE,YAAY,EAAE,KAAK,EAAE,QAAQ,EAAE,KAAK,EAAE,CAAC;YACjE,UAAU,CAAC,WAAW,CAAC,IAAI,EAAE,CAAC;YAC9B,MAAM,UAAU,CAAC,IAAI,CAAC,MAAM,MAAM,CAAC,YAAY,CAAC,UAAU,CAAC,QAAQ,CAAC,CAAC,CAAC;YAEtE,MAAM,eAAe,GAAG,CAAC,MAAM,MAAM,CAAC,oBAAoB,CAAC,GAAG,CAAC,YAAY,CAAC,CAAC,QAAQ,CAAC,UAAU,CAAC,aAAa,CAAC,CAAC,CAAC,KAAK,CAAC,QAAQ,EAAE,CAAC;YAClI,IAAI,OAAO,GAAG,MAAM,UAAU,CAAC,IAAI,CAAC,MAAM,MAAM,CAAC,YAAY,CAAC,UAAU,CAAC,QAAQ,CAAC,EAAE,IAAI,CAAC,CAAC;YAC1F,OAAO,GAAG,MAAM,UAAU,CAAC,MAAM,CAAC,OAAQ,CAAC,gBAAgB,CAAC,CAAC,CAAC,CAAC,cAAc,CAAC,CAAC;YAC/E,OAAO,GAAG,MAAM,UAAU,CAAC,OAAO,CAAC,OAAQ,CAAC,gBAAgB,CAAC,CAAC,CAAC,CAAC,eAAe,CAAC,CAAC;YACjF,OAAO,GAAG,MAAM,UAAU,CAAC,MAAM,CAAC,OAAQ,CAAC,gBAAgB,CAAC,CAAC,CAAC,CAAC,aAAa,CAAC,CAAC;YAC9E,OAAO,GAAG,MAAM,UAAU,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC;YAExC,MAAM,CAAC,eAAe,CAAC,UAAU,CAAC,MAAM,+BAAkB,CAAC;YAC3D,MAAM,CAAC,WAAW,CAAC,OAAO,EAAE,IAAI,CAAC,CAAC;YAClC,eAAe,CAAC,UAAU,CAAC,SAAS,CAAC,SAAS,EAAE,EAAE,CAAC,CAAC;YACpD,MAAM,CAAC,WAAW,CAAC,CAAC,MAAM,UAAU,CAAC,iBAAiB,CAAC,IAAI,CAAC,CAAC,CAAC,QAAQ,EAAE,OAAO,EAAE,eAAe,CAAC,CAAC;YAClG,MAAM,CAAC,WAAW,CAAC,CAAC,MAAM,MAAM,CAAC,oBAAoB,CAAC,GAAG,CAAC,YAAY,CAAC,CAAC,QAAQ,CAAC,UAAU,CAAC,aAAa,CAAC,CAAC,CAAC,KAAK,CAAC,QAAQ,EAAE,EAAE,eAAe,CAAC,CAAC;QAChJ,CAAC,CAAC,CAAC;IACJ,CAAC,CAAC,CAAC;IAEH,IAAI,CAAC,iEAAiE,EAAE,KAAK,IAAI,EAAE;QAClF,MAAM,kBAAkB,CAAO,EAAE,EAAE,KAAK,IAAI,EAAE;YAC7C,MAAM,WAAW,GAAG,MAAM,CAAC,oBAAoB,CAAC,GAAG,CAAC,YAAY,CAAC,CAAC;YAClE,MAAM,UAAU,GAAqB,eAAe,CAAC,GAAG,CAAC,MAAM,CAAC,oBAAoB,CAAC,cAAc,CAAC,gBAAgB,EAAE,EAAE,YAAY,wCAAuB,EAAE,OAAO,EAAE,MAAM,CAAC,oBAAoB,CAAC,GAAG,CAAC,wBAAwB,CAAC,CAAC,cAAc,EAAE,EAAE,SAAS,CAAC,CAAC,CAAC;YAC9P,UAAU,CAAC,WAAW,CAAC,IAAI,EAAE,CAAC;YAE9B,MAAM,UAAU,CAAC,IAAI,CAAC,MAAM,MAAM,CAAC,YAAY,CAAC,UAAU,CAAC,QAAQ,CAAC,CAAC,CAAC;YAEtE,MAAM,OAAO,GAAG,eAAe,CAAC,GAAG,CAAC,IAAI,kBAAkB,CAAC,MAAM,CAAC,CAAC,CAAC;YACpE,MAAM,OAAO,CAAC,KAAK,EAAE,CAAC;YACtB,MAAM,aAAa,GAAqB,eAAe,CAAC,GAAG,CAAC,OAAO,CAAC,oBAAoB,CAAC,cAAc,CAAC,gBAAgB,EAAE,EAAE,YAAY,wCAAuB,EAAE,OAAO,EAAE,OAAO,CAAC,oBAAoB,CAAC,GAAG,CAAC,wBAAwB,CAAC,CAAC,cAAc,EAAE,EAAE,SAAS,CAAC,CAAC,CAAC;YACnQ,aAAa,CAAC,WAAW,CAAC,IAAI,EAAE,CAAC;YACjC,MAAM,GAAG,GAAG,MAAM,OAAO,CAAC,YAAY,CAAC,UAAU,CAAC,QAAQ,CAAC,CAAC;YAC5D,MAAM,aAAa,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;YAE9B,MAAM,WAAW,CAAC,GAAG,CAAC,UAAU,CAAC,mBAAmB,EAAE,CAAC,CAAC;YACxD,MAAM,UAAU,CAAC,IAAI,CAAC,MAAM,MAAM,CAAC,YAAY,CAAC,UAAU,CAAC,QAAQ,CAAC,CAAC,CAAC;YAEtE,MAAM,CAAC,eAAe,CAAC,UAAU,CAAC,MAAM,+BAAkB,CAAC;YAC3D,MAAM,CAAC,WAAW,CAAC,CAAC,MAAM,MAAM,CAAC,oBAAoB,CAAC,GAAG,CAAC,YAAY,CAAC,CAAC,QAAQ,CAAC,UAAU,CAAC,aAAa,CAAC,CAAC,CAAC,KAAK,CAAC,QAAQ,EAAE,EAAE,GAAG,CAAC,CAAC;QACpI,CAAC,CAAC,CAAC;IACJ,CAAC,CAAC,CAAC;AAEJ,CAAC,CAAC,CAAC;AAEH,KAAK,CAAC,mCAAmC,EAAE,GAAG,EAAE;IAC/C,MAAM,MAAM,GAAG,IAAI,sBAAsB,EAAE,CAAC;IAC5C,IAAI,MAA0B,CAAC;IAE/B,QAAQ,CAAC,KAAK,IAAI,EAAE;QACnB,MAAM,MAAM,CAAC,oBAAoB,CAAC,GAAG,CAAC,yBAAyB,CAAC,CAAC,KAAK,EAAE,CAAC;IAC1E,CAAC,CAAC,CAAC;IAEH,MAAM,eAAe,GAAG,uCAAuC,EAAE,CAAC;IAElE,KAAK,CAAC,KAAK,IAAI,EAAE;QAChB,MAAM,GAAG,eAAe,CAAC,GAAG,CAAC,IAAI,kBAAkB,CAAC,MAAM,CAAC,CAAC,CAAC;QAC7D,MAAM,MAAM,CAAC,KAAK,EAAE,CAAC;IACtB,CAAC,CAAC,CAAC;IAEH,IAAI,CAAC,+CAA+C,EAAE,KAAK,IAAI,EAAE;QAChE,MAAM,kBAAkB,CAAO,EAAE,EAAE,KAAK,IAAI,EAAE;YAC7C,MAAM,UAAU,GAAqB,eAAe,CAAC,GAAG,CAAC,MAAM,CAAC,oBAAoB,CAAC,cAAc,CAAC,gBAAgB,EAAE,EAAE,YAAY,wCAAuB,EAAE,OAAO,EAAE,MAAM,CAAC,oBAAoB,CAAC,GAAG,CAAC,wBAAwB,CAAC,CAAC,cAAc,EAAE,EAAE,SAAS,CAAC,CAAC,CAAC;YAE9P,MAAM,MAAM,GAAG,MAAM,UAAU,CAAC,mBAAmB,EAAE,CAAC;YAEtD,MAAM,CAAC,WAAW,CAAC,MAAM,EAAE,IAAI,CAAC,CAAC;QAClC,CAAC,CAAC,CAAC;IACJ,CAAC,CAAC,CAAC;IAEH,IAAI,CAAC,kCAAkC,EAAE,KAAK,IAAI,EAAE;QACnD,MAAM,kBAAkB,CAAO,EAAE,EAAE,KAAK,IAAI,EAAE;YAC7C,MAAM,cAAc,GAAG,MAAM,CAAC,oBAAoB,CAAC,GAAG,CAAC,eAAe,CAAC,CAAC;YACxE,MAAM,WAAW,GAAG,MAAM,CAAC,oBAAoB,CAAC,GAAG,CAAC,YAAY,CAAC,CAAC;YAClE,MAAM,UAAU,GAAqB,eAAe,CAAC,GAAG,CAAC,MAAM,CAAC,oBAAoB,CAAC,cAAc,CAAC,gBAAgB,EAAE,EAAE,YAAY,wCAAuB,EAAE,OAAO,EAAE,MAAM,CAAC,oBAAoB,CAAC,GAAG,CAAC,wBAAwB,CAAC,CAAC,cAAc,EAAE,EAAE,SAAS,CAAC,CAAC,CAAC;YAC9P,UAAU,CAAC,WAAW,CAAC,IAAI,EAAE,CAAC;YAE9B,MAAM,UAAU,CAAC,IAAI,CAAC,MAAM,MAAM,CAAC,YAAY,CAAC,UAAU,CAAC,QAAQ,CAAC,CAAC,CAAC;YACtE,MAAM,SAAS,GAAG,MAAM,UAAU,CAAC,YAAY,EAAE,CAAC;YAClD,MAAM,MAAM,GAAG,MAAM,UAAU,CAAC,mBAAmB,EAAE,CAAC;YAEtD,MAAM,CAAC,eAAe,CAAC,cAAc,CAAC,GAAG,CAAC,2BAA2B,oCAA2B,EAAE,IAAI,CAAC,SAAS,CAAC,EAAE,GAAG,EAAE,GAAG,EAAE,CAAC,CAAC,CAAC;YAChI,MAAM,CAAC,eAAe,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC,MAAM,WAAW,CAAC,QAAQ,CAAC,UAAU,CAAC,mBAAmB,EAAE,CAAC,CAAC,CAAC,KAAK,CAAC,QAAQ,EAAE,CAAC,EAAE,EAAE,GAAG,EAAE,GAAG,EAAE,QAAQ,EAAE,EAAE,OAAO,EAAE,CAAC,EAAE,SAAS,EAAE,OAAO,EAAE,GAAG,EAAE,EAAE,CAAC,CAAC;YACrL,MAAM,CAAC,eAAe,CAAC,MAAM,EAAE;gBAC9B,GAAG,EAAE,GAAG;gBACR,QAAQ,EAAE;oBACT,OAAO,EAAE,GAAG;oBACZ,SAAS;oBACT,OAAO,EAAE,CAAC;iBACV;aACD,CAAC,CAAC;QACJ,CAAC,CAAC,CAAC;IACJ,CAAC,CAAC,CAAC;IAEH,IAAI,CAAC,gFAAgF,EAAE,KAAK,IAAI,EAAE;QACjG,MAAM,kBAAkB,CAAO,EAAE,EAAE,KAAK,IAAI,EAAE;YAC7C,MAAM,cAAc,GAAG,MAAM,CAAC,oBAAoB,CAAC,GAAG,CAAC,eAAe,CAAC,CAAC;YACxE,MAAM,WAAW,GAAG,MAAM,CAAC,oBAAoB,CAAC,GAAG,CAAC,YAAY,CAAC,CAAC;YAClE,MAAM,UAAU,GAAqB,eAAe,CAAC,GAAG,CAAC,MAAM,CAAC,oBAAoB,CAAC,cAAc,CAAC,gBAAgB,EAAE,EAAE,YAAY,wCAAuB,EAAE,OAAO,EAAE,MAAM,CAAC,oBAAoB,CAAC,GAAG,CAAC,wBAAwB,CAAC,CAAC,cAAc,EAAE,EAAE,SAAS,CAAC,CAAC,CAAC;YAC9P,UAAU,CAAC,WAAW,CAAC,IAAI,EAAE,CAAC;YAE9B,MAAM,UAAU,CAAC,IAAI,CAAC,MAAM,MAAM,CAAC,YAAY,CAAC,UAAU,CAAC,QAAQ,CAAC,CAAC,CAAC;YACtE,MAAM,SAAS,GAAG,MAAM,UAAU,CAAC,YAAY,EAAE,CAAC;YAClD,MAAM,WAAW,CAAC,GAAG,CAAC,UAAU,CAAC,mBAAmB,EAAE,CAAC,CAAC;YACxD,MAAM,MAAM,GAAG,MAAM,UAAU,CAAC,mBAAmB,EAAE,CAAC;YAEtD,MAAM,CAAC,eAAe,CAAC,cAAc,CAAC,GAAG,CAAC,2BAA2B,oCAA2B,EAAE,IAAI,CAAC,SAAS,CAAC,EAAE,GAAG,EAAE,GAAG,EAAE,CAAC,CAAC,CAAC;YAChI,MAAM,CAAC,eAAe,CAAC,MAAM,EAAE;gBAC9B,GAAG,EAAE,GAAG;gBACR,QAAQ,EAAE;oBACT,OAAO,EAAE,GAAG;oBACZ,SAAS;oBACT,OAAO,EAAE,CAAC;iBACV;aACD,CAAC,CAAC;QACJ,CAAC,CAAC,CAAC;IACJ,CAAC,CAAC,CAAC;IAEH,IAAI,CAAC,wEAAwE,EAAE,KAAK,IAAI,EAAE;QACzF,MAAM,kBAAkB,CAAO,EAAE,EAAE,KAAK,IAAI,EAAE;YAC7C,MAAM,cAAc,GAAG,MAAM,CAAC,oBAAoB,CAAC,GAAG,CAAC,eAAe,CAAC,CAAC;YACxE,MAAM,WAAW,GAAG,MAAM,CAAC,oBAAoB,CAAC,GAAG,CAAC,YAAY,CAAC,CAAC;YAClE,MAAM,UAAU,GAAqB,eAAe,CAAC,GAAG,CAAC,MAAM,CAAC,oBAAoB,CAAC,cAAc,CAAC,gBAAgB,EAAE,EAAE,YAAY,wCAAuB,EAAE,OAAO,EAAE,MAAM,CAAC,oBAAoB,CAAC,GAAG,CAAC,wBAAwB,CAAC,CAAC,cAAc,EAAE,EAAE,SAAS,CAAC,CAAC,CAAC;YAC9P,UAAU,CAAC,WAAW,CAAC,IAAI,EAAE,CAAC;YAE9B,MAAM,UAAU,CAAC,IAAI,CAAC,MAAM,MAAM,CAAC,YAAY,CAAC,UAAU,CAAC,QAAQ,CAAC,CAAC,CAAC;YACtE,MAAM,SAAS,GAAG,MAAM,UAAU,CAAC,YAAY,EAAE,CAAC;YAClD,MAAM,WAAW,CAAC,SAAS,CAAC,UAAU,CAAC,mBAAmB,EAAE,EAAE,QAAQ,CAAC,UAAU,CAAC,IAAI,CAAC,SAAS,CAAC;gBAChG,GAAG,EAAE,GAAG;gBACR,OAAO,EAAE,CAAC;gBACV,OAAO,EAAE,IAAI,CAAC,SAAS,CAAC;oBACvB,OAAO,EAAE,GAAG;oBACZ,SAAS;oBACT,OAAO,EAAE,CAAC;iBACV,CAAC;gBACF,cAAc,EAAE;oBACf,GAAG,EAAE,KAAK;iBACV;aACD,CAAC,CAAC,CAAC,CAAC;YACL,MAAM,CAAC,KAAK,EAAE,CAAC;YACf,MAAM,MAAM,GAAG,MAAM,UAAU,CAAC,mBAAmB,EAAE,CAAC;YAEtD,MAAM,CAAC,eAAe,CAAC,cAAc,CAAC,GAAG,CAAC,2BAA2B,oCAA2B,EAAE,IAAI,CAAC,SAAS,CAAC,EAAE,GAAG,EAAE,GAAG,EAAE,CAAC,CAAC,CAAC;YAChI,MAAM,CAAC,eAAe,CAAC,MAAM,EAAE;gBAC9B,GAAG,EAAE,GAAG;gBACR,QAAQ,EAAE;oBACT,OAAO,EAAE,GAAG;oBACZ,SAAS;oBACT,OAAO,EAAE,CAAC;iBACV;aACD,CAAC,CAAC;YACH,MAAM,CAAC,eAAe,CAAC,MAAM,CAAC,QAAQ,EAAE,CAAC,EAAE,OAAO,EAAE,EAAE,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,EAAE,yCAAyC,EAAE,CAAC,CAAC,CAAC;QACzH,CAAC,CAAC,CAAC;IACJ,CAAC,CAAC,CAAC;IAEH,IAAI,CAAC,gFAAgF,EAAE,KAAK,IAAI,EAAE;QACjG,MAAM,kBAAkB,CAAO,EAAE,EAAE,KAAK,IAAI,EAAE;YAC7C,MAAM,cAAc,GAAG,MAAM,CAAC,oBAAoB,CAAC,GAAG,CAAC,eAAe,CAAC,CAAC;YACxE,MAAM,WAAW,GAAG,MAAM,CAAC,oBAAoB,CAAC,GAAG,CAAC,YAAY,CAAC,CAAC;YAClE,MAAM,UAAU,GAAqB,eAAe,CAAC,GAAG,CAAC,MAAM,CAAC,oBAAoB,CAAC,cAAc,CAAC,gBAAgB,EAAE,EAAE,YAAY,wCAAuB,EAAE,OAAO,EAAE,MAAM,CAAC,oBAAoB,CAAC,GAAG,CAAC,wBAAwB,CAAC,CAAC,cAAc,EAAE,EAAE,SAAS,CAAC,CAAC,CAAC;YAC9P,UAAU,CAAC,WAAW,CAAC,IAAI,EAAE,CAAC;YAE9B,MAAM,UAAU,CAAC,IAAI,CAAC,MAAM,MAAM,CAAC,YAAY,CAAC,UAAU,CAAC,QAAQ,CAAC,CAAC,CAAC;YACtE,MAAM,SAAS,GAAG,MAAM,UAAU,CAAC,YAAY,EAAE,CAAC;YAClD,MAAM,WAAW,CAAC,SAAS,CAAC,UAAU,CAAC,mBAAmB,EAAE,EAAE,QAAQ,CAAC,UAAU,CAAC,IAAI,CAAC,SAAS,CAAC;gBAChG,GAAG,EAAE,GAAG;gBACR,QAAQ,EAAE;oBACT,OAAO,EAAE,GAAG;oBACZ,SAAS;oBACT,OAAO,EAAE,CAAC;iBACV;aACD,CAAC,CAAC,CAAC,CAAC;YACL,MAAM,CAAC,KAAK,EAAE,CAAC;YACf,MAAM,MAAM,GAAG,MAAM,UAAU,CAAC,mBAAmB,EAAE,CAAC;YAEtD,MAAM,CAAC,eAAe,CAAC,cAAc,CAAC,GAAG,CAAC,2BAA2B,oCAA2B,EAAE,IAAI,CAAC,SAAS,CAAC,EAAE,GAAG,EAAE,GAAG,EAAE,CAAC,CAAC,CAAC;YAChI,MAAM,CAAC,eAAe,CAAC,MAAM,EAAE;gBAC9B,GAAG,EAAE,GAAG;gBACR,QAAQ,EAAE;oBACT,OAAO,EAAE,GAAG;oBACZ,SAAS;oBACT,OAAO,EAAE,CAAC;iBACV;aACD,CAAC,CAAC;YACH,MAAM,CAAC,eAAe,CAAC,MAAM,CAAC,QAAQ,EAAE,CAAC,EAAE,OAAO,EAAE,EAAE,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,EAAE,yCAAyC,EAAE,CAAC,CAAC,CAAC;QACzH,CAAC,CAAC,CAAC;IACJ,CAAC,CAAC,CAAC;IAEH,IAAI,CAAC,kFAAkF,EAAE,KAAK,IAAI,EAAE;QACnG,MAAM,kBAAkB,CAAO,EAAE,EAAE,KAAK,IAAI,EAAE;YAC7C,MAAM,WAAW,GAAG,MAAM,CAAC,oBAAoB,CAAC,GAAG,CAAC,YAAY,CAAC,CAAC;YAClE,MAAM,UAAU,GAAqB,eAAe,CAAC,GAAG,CAAC,MAAM,CAAC,oBAAoB,CAAC,cAAc,CAAC,gBAAgB,EAAE,EAAE,YAAY,wCAAuB,EAAE,OAAO,EAAE,MAAM,CAAC,oBAAoB,CAAC,GAAG,CAAC,wBAAwB,CAAC,CAAC,cAAc,EAAE,EAAE,SAAS,CAAC,CAAC,CAAC;YAC9P,UAAU,CAAC,WAAW,CAAC,IAAI,EAAE,CAAC;YAE9B,MAAM,UAAU,CAAC,IAAI,CAAC,MAAM,MAAM,CAAC,YAAY,CAAC,UAAU,CAAC,QAAQ,CAAC,CAAC,CAAC;YACtE,MAAM,SAAS,GAAG,MAAM,UAAU,CAAC,YAAY,EAAE,CAAC;YAClD,MAAM,WAAW,CAAC,SAAS,CAAC,UAAU,CAAC,mBAAmB,EAAE,EAAE,QAAQ,CAAC,UAAU,CAAC,IAAI,CAAC,SAAS,CAAC;gBAChG,GAAG,EAAE,GAAG;gBACR,OAAO,EAAE,CAAC;gBACV,OAAO,EAAE,IAAI,CAAC,SAAS,CAAC;oBACvB,OAAO,EAAE,GAAG;oBACZ,SAAS;oBACT,OAAO,EAAE,CAAC;iBACV,CAAC;gBACF,cAAc,EAAE;oBACf,GAAG,EAAE,KAAK;iBACV;aACD,CAAC,CAAC,CAAC,CAAC;YACL,MAAM,UAAU,CAAC,mBAAmB,EAAE,CAAC;YACvC,MAAM,CAAC,KAAK,EAAE,CAAC;YAEf,MAAM,UAAU,CAAC,mBAAmB,EAAE,CAAC;YACvC,MAAM,CAAC,eAAe,CAAC,MAAM,CAAC,QAAQ,EAAE,EAAE,CAAC,CAAC;QAC7C,CAAC,CAAC,CAAC;IACJ,CAAC,CAAC,CAAC;IAEH,IAAI,CAAC,+EAA+E,EAAE,KAAK,IAAI,EAAE;QAChG,MAAM,kBAAkB,CAAO,EAAE,EAAE,KAAK,IAAI,EAAE;YAC7C,MAAM,WAAW,GAAG,MAAM,CAAC,oBAAoB,CAAC,GAAG,CAAC,YAAY,CAAC,CAAC;YAClE,MAAM,UAAU,GAAqB,eAAe,CAAC,GAAG,CAAC,MAAM,CAAC,oBAAoB,CAAC,cAAc,CAAC,gBAAgB,EAAE,EAAE,YAAY,wCAAuB,EAAE,OAAO,EAAE,MAAM,CAAC,oBAAoB,CAAC,GAAG,CAAC,wBAAwB,CAAC,CAAC,cAAc,EAAE,EAAE,SAAS,CAAC,CAAC,CAAC;YAC9P,UAAU,CAAC,WAAW,CAAC,IAAI,EAAE,CAAC;YAE9B,MAAM,UAAU,CAAC,IAAI,CAAC,MAAM,MAAM,CAAC,YAAY,CAAC,UAAU,CAAC,QAAQ,CAAC,CAAC,CAAC;YACtE,MAAM,CAAC,KAAK,EAAE,CAAC;YACf,MAAM,WAAW,CAAC,SAAS,CAAC,UAAU,CAAC,mBAAmB,EAAE,EAAE,QAAQ,CAAC,UAAU,CAAC,IAAI,CAAC,SAAS,CAAC;gBAChG,GAAG,EAAE,GAAG;gBACR,QAAQ,EAAE,IAAI;aACd,CAAC,CAAC,CAAC,CAAC;YACL,MAAM,UAAU,CAAC,mBAAmB,EAAE,CAAC;YAEvC,MAAM,CAAC,eAAe,CAAC,MAAM,CAAC,QAAQ,EAAE,EAAE,CAAC,CAAC;QAC7C,CAAC,CAAC,CAAC;IACJ,CAAC,CAAC,CAAC;IAEH,IAAI,CAAC,iEAAiE,EAAE,KAAK,IAAI,EAAE;QAClF,MAAM,kBAAkB,CAAO,EAAE,EAAE,KAAK,IAAI,EAAE;YAC7C,MAAM,cAAc,GAAG,MAAM,CAAC,oBAAoB,CAAC,GAAG,CAAC,eAAe,CAAC,CAAC;YACxE,MAAM,UAAU,GAAqB,eAAe,CAAC,GAAG,CAAC,MAAM,CAAC,oBAAoB,CAAC,cAAc,CAAC,gBAAgB,EAAE,EAAE,YAAY,wCAAuB,EAAE,OAAO,EAAE,MAAM,CAAC,oBAAoB,CAAC,GAAG,CAAC,wBAAwB,CAAC,CAAC,cAAc,EAAE,EAAE,SAAS,CAAC,CAAC,CAAC;YAC9P,UAAU,CAAC,WAAW,CAAC,IAAI,EAAE,CAAC;YAE9B,MAAM,UAAU,CAAC,IAAI,CAAC,MAAM,MAAM,CAAC,YAAY,CAAC,UAAU,CAAC,QAAQ,CAAC,CAAC,CAAC;YACtE,cAAc,CAAC,MAAM,CAAC,2BAA2B,oCAA2B,CAAC;YAC7E,MAAM,MAAM,GAAG,MAAM,UAAU,CAAC,mBAAmB,EAAE,CAAC;YAEtD,MAAM,CAAC,WAAW,CAAC,MAAM,EAAE,IAAI,CAAC,CAAC;QAClC,CAAC,CAAC,CAAC;IACJ,CAAC,CAAC,CAAC;IAEH,IAAI,CAAC,8EAA8E,EAAE,KAAK,IAAI,EAAE;QAC/F,MAAM,kBAAkB,CAAO,EAAE,EAAE,KAAK,IAAI,EAAE;YAC7C,MAAM,cAAc,GAAG,MAAM,CAAC,oBAAoB,CAAC,GAAG,CAAC,eAAe,CAAC,CAAC;YACxE,MAAM,WAAW,GAAG,MAAM,CAAC,oBAAoB,CAAC,GAAG,CAAC,YAAY,CAAC,CAAC;YAClE,MAAM,wBAAwB,GAAG,MAAM,CAAC,oBAAoB,CAAC,GAAG,CAAC,yBAAyB,CAAC,CAAC;YAC5F,MAAM,UAAU,GAAqB,eAAe,CAAC,GAAG,CAAC,MAAM,CAAC,oBAAoB,CAAC,cAAc,CAAC,gBAAgB,EAAE,EAAE,YAAY,wCAAuB,EAAE,OAAO,EAAE,MAAM,CAAC,oBAAoB,CAAC,GAAG,CAAC,wBAAwB,CAAC,CAAC,cAAc,EAAE,EAAE,SAAS,CAAC,CAAC,CAAC;YAC9P,UAAU,CAAC,WAAW,CAAC,IAAI,EAAE,CAAC;YAE9B,MAAM,UAAU,CAAC,IAAI,CAAC,MAAM,MAAM,CAAC,YAAY,CAAC,UAAU,CAAC,QAAQ,CAAC,CAAC,CAAC;YACtE,MAAM,WAAW,CAAC,GAAG,CAAC,UAAU,CAAC,mBAAmB,EAAE,CAAC,CAAC;YACxD,MAAM,wBAAwB,CAAC,cAAc,CAAC,UAAU,CAAC,YAAY,CAAC,YAAY,EAAE,IAAI,CAAC,CAAC;YAC1F,MAAM,MAAM,GAAG,MAAM,UAAU,CAAC,mBAAmB,EAAE,CAAC;YAEtD,MAAM,CAAC,eAAe,CAAC,cAAc,CAAC,GAAG,CAAC,2BAA2B,oCAA2B,EAAE,IAAI,CAAC,SAAS,CAAC,EAAE,GAAG,EAAE,GAAG,EAAE,CAAC,CAAC,CAAC;YAChI,MAAM,CAAC,WAAW,CAAC,MAAM,EAAE,IAAI,CAAC,CAAC;QAClC,CAAC,CAAC,CAAC;IACJ,CAAC,CAAC,CAAC;AAEJ,CAAC,CAAC,CAAC;AAEH,SAAS,eAAe,CAAC,MAA8B,EAAE,QAAe;IACvE,MAAM,CAAC,eAAe,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,EAAE,aAAa,EAAE,EAAE,EAAE,CAAC,aAAa,CAAC,QAAQ,EAAE,CAAC,EAAE,QAAQ,CAAC,GAAG,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,CAAC,QAAQ,EAAE,CAAC,CAAC,CAAC;AAC1H,CAAC;AAED,SAAS,cAAc,CAAC,MAA8B,EAAE,QAAe;IACtE,MAAM,CAAC,eAAe,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,EAAE,aAAa,EAAE,EAAE,EAAE,CAAC,aAAa,CAAC,QAAQ,EAAE,CAAC,EAAE,QAAQ,CAAC,GAAG,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,CAAC,QAAQ,EAAE,CAAC,CAAC,CAAC;AAC1H,CAAC","file":"synchronizer.test.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport assert from 'assert';\nimport { Barrier } from '../../../../base/common/async.js';\nimport { VSBuffer } from '../../../../base/common/buffer.js';\nimport { CancellationToken } from '../../../../base/common/cancellation.js';\nimport { Emitter, Event } from '../../../../base/common/event.js';\nimport { isEqual, joinPath } from '../../../../base/common/resources.js';\nimport { URI } from '../../../../base/common/uri.js';\nimport { runWithFakedTimers } from '../../../../base/test/common/timeTravelScheduler.js';\nimport { ensureNoDisposablesAreLeakedInTestSuite } from '../../../../base/test/common/utils.js';\nimport { IFileService } from '../../../files/common/files.js';\nimport { IStorageService, StorageScope } from '../../../storage/common/storage.js';\nimport { IUserDataProfilesService } from '../../../userDataProfile/common/userDataProfile.js';\nimport { AbstractSynchroniser, IAcceptResult, IMergeResult, IResourcePreview, SyncStrategy } from '../../common/abstractSynchronizer.js';\nimport { Change, IRemoteUserData, IResourcePreview as IBaseResourcePreview, IUserDataSyncConfiguration, IUserDataSyncStoreService, MergeState, SyncResource, SyncStatus, USER_DATA_SYNC_SCHEME, IUserData } from '../../common/userDataSync.js';\nimport { UserDataSyncClient, UserDataSyncTestServer } from './userDataSyncClient.js';\n\ninterface ITestResourcePreview extends IResourcePreview {\n\tref: string;\n}\n\nclass TestSynchroniser extends AbstractSynchroniser {\n\n\tsyncBarrier: Barrier = new Barrier();\n\tsyncResult: { hasConflicts: boolean; hasError: boolean } = { hasConflicts: false, hasError: false };\n\tonDoSyncCall: Emitter<void> = this._register(new Emitter<void>());\n\tfailWhenGettingLatestRemoteUserData: boolean = false;\n\n\tprotected readonly version: number = 1;\n\n\tprivate cancelled: boolean = false;\n\treadonly localResource = joinPath(this.environmentService.userRoamingDataHome, 'testResource.json');\n\n\tgetMachineId(): Promise<string> { return this.currentMachineIdPromise; }\n\tgetLastSyncResource(): URI { return this.lastSyncResource; }\n\n\tprotected override getLatestRemoteUserData(refOrLatestData: string | IUserData | null, lastSyncUserData: IRemoteUserData | null): Promise<IRemoteUserData> {\n\t\tif (this.failWhenGettingLatestRemoteUserData) {\n\t\t\tthrow new Error();\n\t\t}\n\t\treturn super.getLatestRemoteUserData(refOrLatestData, lastSyncUserData);\n\t}\n\n\tprotected override async doSync(remoteUserData: IRemoteUserData, lastSyncUserData: IRemoteUserData | null, strategy: SyncStrategy, userDataSyncConfiguration: IUserDataSyncConfiguration): Promise<SyncStatus> {\n\t\tthis.cancelled = false;\n\t\tthis.onDoSyncCall.fire();\n\t\tawait this.syncBarrier.wait();\n\n\t\tif (this.cancelled) {\n\t\t\treturn SyncStatus.Idle;\n\t\t}\n\n\t\treturn super.doSync(remoteUserData, lastSyncUserData, strategy, userDataSyncConfiguration);\n\t}\n\n\tprotected override async generateSyncPreview(remoteUserData: IRemoteUserData): Promise<ITestResourcePreview[]> {\n\t\tif (this.syncResult.hasError) {\n\t\t\tthrow new Error('failed');\n\t\t}\n\n\t\tlet fileContent = null;\n\t\ttry {\n\t\t\tfileContent = await this.fileService.readFile(this.localResource);\n\t\t} catch (error) { }\n\n\t\treturn [{\n\t\t\tbaseResource: this.localResource.with(({ scheme: USER_DATA_SYNC_SCHEME, authority: 'base' })),\n\t\t\tbaseContent: null,\n\t\t\tlocalResource: this.localResource,\n\t\t\tlocalContent: fileContent ? fileContent.value.toString() : null,\n\t\t\tremoteResource: this.localResource.with(({ scheme: USER_DATA_SYNC_SCHEME, authority: 'remote' })),\n\t\t\tremoteContent: remoteUserData.syncData ? remoteUserData.syncData.content : null,\n\t\t\tpreviewResource: this.localResource.with(({ scheme: USER_DATA_SYNC_SCHEME, authority: 'preview' })),\n\t\t\tref: remoteUserData.ref,\n\t\t\tlocalChange: Change.Modified,\n\t\t\tremoteChange: Change.Modified,\n\t\t\tacceptedResource: this.localResource.with(({ scheme: USER_DATA_SYNC_SCHEME, authority: 'accepted' })),\n\t\t}];\n\t}\n\n\tprotected async hasRemoteChanged(lastSyncUserData: IRemoteUserData): Promise<boolean> {\n\t\treturn true;\n\t}\n\n\tprotected async getMergeResult(resourcePreview: ITestResourcePreview, token: CancellationToken): Promise<IMergeResult> {\n\t\treturn {\n\t\t\tcontent: resourcePreview.ref,\n\t\t\tlocalChange: Change.Modified,\n\t\t\tremoteChange: Change.Modified,\n\t\t\thasConflicts: this.syncResult.hasConflicts,\n\t\t};\n\t}\n\n\tprotected async getAcceptResult(resourcePreview: ITestResourcePreview, resource: URI, content: string | null | undefined, token: CancellationToken): Promise<IAcceptResult> {\n\n\t\tif (isEqual(resource, resourcePreview.localResource)) {\n\t\t\treturn {\n\t\t\t\tcontent: resourcePreview.localContent,\n\t\t\t\tlocalChange: Change.None,\n\t\t\t\tremoteChange: resourcePreview.localContent === null ? Change.Deleted : Change.Modified,\n\t\t\t};\n\t\t}\n\n\t\tif (isEqual(resource, resourcePreview.remoteResource)) {\n\t\t\treturn {\n\t\t\t\tcontent: resourcePreview.remoteContent,\n\t\t\t\tlocalChange: resourcePreview.remoteContent === null ? Change.Deleted : Change.Modified,\n\t\t\t\tremoteChange: Change.None,\n\t\t\t};\n\t\t}\n\n\t\tif (isEqual(resource, resourcePreview.previewResource)) {\n\t\t\tif (content === undefined) {\n\t\t\t\treturn {\n\t\t\t\t\tcontent: resourcePreview.ref,\n\t\t\t\t\tlocalChange: Change.Modified,\n\t\t\t\t\tremoteChange: Change.Modified,\n\t\t\t\t};\n\t\t\t} else {\n\t\t\t\treturn {\n\t\t\t\t\tcontent,\n\t\t\t\t\tlocalChange: content === null ? resourcePreview.localContent !== null ? Change.Deleted : Change.None : Change.Modified,\n\t\t\t\t\tremoteChange: content === null ? resourcePreview.remoteContent !== null ? Change.Deleted : Change.None : Change.Modified,\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\n\t\tthrow new Error(`Invalid Resource: ${resource.toString()}`);\n\t}\n\n\tprotected async applyResult(remoteUserData: IRemoteUserData, lastSyncUserData: IRemoteUserData | null, resourcePreviews: [IResourcePreview, IAcceptResult][], force: boolean): Promise<void> {\n\t\tif (resourcePreviews[0][1].localChange === Change.Deleted) {\n\t\t\tawait this.fileService.del(this.localResource);\n\t\t}\n\n\t\tif (resourcePreviews[0][1].localChange === Change.Added || resourcePreviews[0][1].localChange === Change.Modified) {\n\t\t\tawait this.fileService.writeFile(this.localResource, VSBuffer.fromString(resourcePreviews[0][1].content!));\n\t\t}\n\n\t\tif (resourcePreviews[0][1].remoteChange === Change.Deleted) {\n\t\t\tawait this.applyRef(null, remoteUserData.ref);\n\t\t}\n\n\t\tif (resourcePreviews[0][1].remoteChange === Change.Added || resourcePreviews[0][1].remoteChange === Change.Modified) {\n\t\t\tawait this.applyRef(resourcePreviews[0][1].content, remoteUserData.ref);\n\t\t}\n\t}\n\n\tasync applyRef(content: string | null, ref: string): Promise<void> {\n\t\tconst remoteUserData = await this.updateRemoteUserData(content === null ? '' : content, ref);\n\t\tawait this.updateLastSyncUserData(remoteUserData);\n\t}\n\n\toverride async stop(): Promise<void> {\n\t\tthis.cancelled = true;\n\t\tthis.syncBarrier.open();\n\t\tsuper.stop();\n\t}\n\n\ttestTriggerLocalChange(): void {\n\t\tthis.triggerLocalChange();\n\t}\n\n\tonDidTriggerLocalChangeCall: Emitter<void> = this._register(new Emitter<void>());\n\tprotected override async doTriggerLocalChange(): Promise<void> {\n\t\tawait super.doTriggerLocalChange();\n\t\tthis.onDidTriggerLocalChangeCall.fire();\n\t}\n\n\thasLocalData(): Promise<boolean> { throw new Error('not implemented'); }\n\tasync resolveContent(uri: URI): Promise<string | null> { return null; }\n}\n\nsuite('TestSynchronizer - Auto Sync', () => {\n\n\tconst server = new UserDataSyncTestServer();\n\tlet client: UserDataSyncClient;\n\n\tteardown(async () => {\n\t\tawait client.instantiationService.get(IUserDataSyncStoreService).clear();\n\t});\n\n\tconst disposableStore = ensureNoDisposablesAreLeakedInTestSuite();\n\n\tsetup(async () => {\n\t\tclient = disposableStore.add(new UserDataSyncClient(server));\n\t\tawait client.setUp();\n\t});\n\n\ttest('status is syncing', async () => {\n\t\tawait runWithFakedTimers<void>({}, async () => {\n\t\t\tconst testObject: TestSynchroniser = disposableStore.add(client.instantiationService.createInstance(TestSynchroniser, { syncResource: SyncResource.Settings, profile: client.instantiationService.get(IUserDataProfilesService).defaultProfile }, undefined));\n\n\t\t\tconst actual: SyncStatus[] = [];\n\t\t\tdisposableStore.add(testObject.onDidChangeStatus(status => actual.push(status)));\n\n\t\t\tconst promise = Event.toPromise(testObject.onDoSyncCall.event);\n\n\t\t\ttestObject.sync(await client.getLatestRef(testObject.resource));\n\t\t\tawait promise;\n\n\t\t\tassert.deepStrictEqual(actual, [SyncStatus.Syncing]);\n\t\t\tassert.deepStrictEqual(testObject.status, SyncStatus.Syncing);\n\n\t\t\ttestObject.stop();\n\t\t});\n\t});\n\n\ttest('status is set correctly when sync is finished', async () => {\n\t\tawait runWithFakedTimers<void>({}, async () => {\n\t\t\tconst testObject: TestSynchroniser = disposableStore.add(client.instantiationService.createInstance(TestSynchroniser, { syncResource: SyncResource.Settings, profile: client.instantiationService.get(IUserDataProfilesService).defaultProfile }, undefined));\n\t\t\ttestObject.syncBarrier.open();\n\n\t\t\tconst actual: SyncStatus[] = [];\n\t\t\tdisposableStore.add(testObject.onDidChangeStatus(status => actual.push(status)));\n\t\t\tawait testObject.sync(await client.getLatestRef(testObject.resource));\n\n\t\t\tassert.deepStrictEqual(actual, [SyncStatus.Syncing, SyncStatus.Idle]);\n\t\t\tassert.deepStrictEqual(testObject.status, SyncStatus.Idle);\n\t\t});\n\t});\n\n\ttest('status is set correctly when sync has errors', async () => {\n\t\tawait runWithFakedTimers<void>({}, async () => {\n\t\t\tconst testObject: TestSynchroniser = disposableStore.add(client.instantiationService.createInstance(TestSynchroniser, { syncResource: SyncResource.Settings, profile: client.instantiationService.get(IUserDataProfilesService).defaultProfile }, undefined));\n\t\t\ttestObject.syncResult = { hasError: true, hasConflicts: false };\n\t\t\ttestObject.syncBarrier.open();\n\n\t\t\tconst actual: SyncStatus[] = [];\n\t\t\tdisposableStore.add(testObject.onDidChangeStatus(status => actual.push(status)));\n\n\t\t\ttry {\n\t\t\t\tawait testObject.sync(await client.getLatestRef(testObject.resource));\n\t\t\t\tassert.fail('Should fail');\n\t\t\t} catch (e) {\n\t\t\t\tassert.deepStrictEqual(actual, [SyncStatus.Syncing, SyncStatus.Idle]);\n\t\t\t\tassert.deepStrictEqual(testObject.status, SyncStatus.Idle);\n\t\t\t}\n\t\t});\n\t});\n\n\ttest('status is set to hasConflicts when asked to sync if there are conflicts', async () => {\n\t\tawait runWithFakedTimers<void>({}, async () => {\n\t\t\tconst testObject: TestSynchroniser = disposableStore.add(client.instantiationService.createInstance(TestSynchroniser, { syncResource: SyncResource.Settings, profile: client.instantiationService.get(IUserDataProfilesService).defaultProfile }, undefined));\n\t\t\ttestObject.syncResult = { hasConflicts: true, hasError: false };\n\t\t\ttestObject.syncBarrier.open();\n\n\t\t\tawait testObject.sync(await client.getLatestRef(testObject.resource));\n\n\t\t\tassert.deepStrictEqual(testObject.status, SyncStatus.HasConflicts);\n\t\t\tassertConflicts(testObject.conflicts.conflicts, [testObject.localResource]);\n\t\t});\n\t});\n\n\ttest('sync should not run if syncing already', async () => {\n\t\tawait runWithFakedTimers<void>({}, async () => {\n\t\t\tconst testObject: TestSynchroniser = disposableStore.add(client.instantiationService.createInstance(TestSynchroniser, { syncResource: SyncResource.Settings, profile: client.instantiationService.get(IUserDataProfilesService).defaultProfile }, undefined));\n\t\t\tconst promise = Event.toPromise(testObject.onDoSyncCall.event);\n\n\t\t\ttestObject.sync(await client.getLatestRef(testObject.resource));\n\t\t\tawait promise;\n\n\t\t\tconst actual: SyncStatus[] = [];\n\t\t\tdisposableStore.add(testObject.onDidChangeStatus(status => actual.push(status)));\n\t\t\tawait testObject.sync(await client.getLatestRef(testObject.resource));\n\n\t\t\tassert.deepStrictEqual(actual, []);\n\t\t\tassert.deepStrictEqual(testObject.status, SyncStatus.Syncing);\n\n\t\t\tawait testObject.stop();\n\t\t});\n\t});\n\n\ttest('sync should not run if there are conflicts', async () => {\n\t\tawait runWithFakedTimers<void>({}, async () => {\n\t\t\tconst testObject: TestSynchroniser = disposableStore.add(client.instantiationService.createInstance(TestSynchroniser, { syncResource: SyncResource.Settings, profile: client.instantiationService.get(IUserDataProfilesService).defaultProfile }, undefined));\n\t\t\ttestObject.syncResult = { hasConflicts: true, hasError: false };\n\t\t\ttestObject.syncBarrier.open();\n\t\t\tawait testObject.sync(await client.getLatestRef(testObject.resource));\n\n\t\t\tconst actual: SyncStatus[] = [];\n\t\t\tdisposableStore.add(testObject.onDidChangeStatus(status => actual.push(status)));\n\t\t\tawait testObject.sync(await client.getLatestRef(testObject.resource));\n\n\t\t\tassert.deepStrictEqual(actual, []);\n\t\t\tassert.deepStrictEqual(testObject.status, SyncStatus.HasConflicts);\n\t\t});\n\t});\n\n\ttest('accept preview during conflicts', async () => {\n\t\tawait runWithFakedTimers<void>({}, async () => {\n\t\t\tconst testObject: TestSynchroniser = disposableStore.add(client.instantiationService.createInstance(TestSynchroniser, { syncResource: SyncResource.Settings, profile: client.instantiationService.get(IUserDataProfilesService).defaultProfile }, undefined));\n\t\t\ttestObject.syncResult = { hasConflicts: true, hasError: false };\n\t\t\ttestObject.syncBarrier.open();\n\n\t\t\tawait testObject.sync(await client.getLatestRef(testObject.resource));\n\t\t\tassert.deepStrictEqual(testObject.status, SyncStatus.HasConflicts);\n\n\t\t\tawait testObject.accept(testObject.conflicts.conflicts[0].previewResource);\n\t\t\tassert.deepStrictEqual(testObject.status, SyncStatus.Syncing);\n\t\t\tassertConflicts(testObject.conflicts.conflicts, []);\n\n\t\t\tawait testObject.apply(false);\n\t\t\tassert.deepStrictEqual(testObject.status, SyncStatus.Idle);\n\t\t\tconst fileService = client.instantiationService.get(IFileService);\n\t\t\tassert.strictEqual((await testObject.getRemoteUserData(null)).syncData?.content, (await fileService.readFile(testObject.localResource)).value.toString());\n\t\t});\n\t});\n\n\ttest('accept remote during conflicts', async () => {\n\t\tawait runWithFakedTimers<void>({}, async () => {\n\t\t\tconst testObject: TestSynchroniser = disposableStore.add(client.instantiationService.createInstance(TestSynchroniser, { syncResource: SyncResource.Settings, profile: client.instantiationService.get(IUserDataProfilesService).defaultProfile }, undefined));\n\t\t\ttestObject.syncBarrier.open();\n\t\t\tawait testObject.sync(await client.getLatestRef(testObject.resource));\n\t\t\tconst fileService = client.instantiationService.get(IFileService);\n\t\t\tconst currentRemoteContent = (await testObject.getRemoteUserData(null)).syncData?.content;\n\t\t\tconst newLocalContent = 'conflict';\n\t\t\tawait fileService.writeFile(testObject.localResource, VSBuffer.fromString(newLocalContent));\n\n\t\t\ttestObject.syncResult = { hasConflicts: true, hasError: false };\n\t\t\tawait testObject.sync(await client.getLatestRef(testObject.resource));\n\t\t\tassert.deepStrictEqual(testObject.status, SyncStatus.HasConflicts);\n\n\t\t\tawait testObject.accept(testObject.conflicts.conflicts[0].remoteResource);\n\t\t\tassert.deepStrictEqual(testObject.status, SyncStatus.Syncing);\n\t\t\tassertConflicts(testObject.conflicts.conflicts, []);\n\n\t\t\tawait testObject.apply(false);\n\t\t\tassert.deepStrictEqual(testObject.status, SyncStatus.Idle);\n\t\t\tassert.strictEqual((await testObject.getRemoteUserData(null)).syncData?.content, currentRemoteContent);\n\t\t\tassert.strictEqual((await fileService.readFile(testObject.localResource)).value.toString(), currentRemoteContent);\n\t\t});\n\t});\n\n\ttest('accept local during conflicts', async () => {\n\t\tawait runWithFakedTimers<void>({}, async () => {\n\t\t\tconst testObject: TestSynchroniser = disposableStore.add(client.instantiationService.createInstance(TestSynchroniser, { syncResource: SyncResource.Settings, profile: client.instantiationService.get(IUserDataProfilesService).defaultProfile }, undefined));\n\t\t\ttestObject.syncBarrier.open();\n\t\t\tawait testObject.sync(await client.getLatestRef(testObject.resource));\n\t\t\tconst fileService = client.instantiationService.get(IFileService);\n\t\t\tconst newLocalContent = 'conflict';\n\t\t\tawait fileService.writeFile(testObject.localResource, VSBuffer.fromString(newLocalContent));\n\n\t\t\ttestObject.syncResult = { hasConflicts: true, hasError: false };\n\t\t\tawait testObject.sync(await client.getLatestRef(testObject.resource));\n\t\t\tassert.deepStrictEqual(testObject.status, SyncStatus.HasConflicts);\n\n\t\t\tawait testObject.accept(testObject.conflicts.conflicts[0].localResource);\n\t\t\tassert.deepStrictEqual(testObject.status, SyncStatus.Syncing);\n\t\t\tassertConflicts(testObject.conflicts.conflicts, []);\n\n\t\t\tawait testObject.apply(false);\n\t\t\tassert.deepStrictEqual(testObject.status, SyncStatus.Idle);\n\t\t\tassert.strictEqual((await testObject.getRemoteUserData(null)).syncData?.content, newLocalContent);\n\t\t\tassert.strictEqual((await fileService.readFile(testObject.localResource)).value.toString(), newLocalContent);\n\t\t});\n\t});\n\n\ttest('accept new content during conflicts', async () => {\n\t\tawait runWithFakedTimers<void>({}, async () => {\n\t\t\tconst testObject: TestSynchroniser = disposableStore.add(client.instantiationService.createInstance(TestSynchroniser, { syncResource: SyncResource.Settings, profile: client.instantiationService.get(IUserDataProfilesService).defaultProfile }, undefined));\n\t\t\ttestObject.syncBarrier.open();\n\t\t\tawait testObject.sync(await client.getLatestRef(testObject.resource));\n\t\t\tconst fileService = client.instantiationService.get(IFileService);\n\t\t\tconst newLocalContent = 'conflict';\n\t\t\tawait fileService.writeFile(testObject.localResource, VSBuffer.fromString(newLocalContent));\n\n\t\t\ttestObject.syncResult = { hasConflicts: true, hasError: false };\n\t\t\tawait testObject.sync(await client.getLatestRef(testObject.resource));\n\t\t\tassert.deepStrictEqual(testObject.status, SyncStatus.HasConflicts);\n\n\t\t\tconst mergeContent = 'newContent';\n\t\t\tawait testObject.accept(testObject.conflicts.conflicts[0].previewResource, mergeContent);\n\t\t\tassert.deepStrictEqual(testObject.status, SyncStatus.Syncing);\n\t\t\tassertConflicts(testObject.conflicts.conflicts, []);\n\n\t\t\tawait testObject.apply(false);\n\t\t\tassert.deepStrictEqual(testObject.status, SyncStatus.Idle);\n\t\t\tassert.strictEqual((await testObject.getRemoteUserData(null)).syncData?.content, mergeContent);\n\t\t\tassert.strictEqual((await fileService.readFile(testObject.localResource)).value.toString(), mergeContent);\n\t\t});\n\t});\n\n\ttest('accept delete during conflicts', async () => {\n\t\tawait runWithFakedTimers<void>({}, async () => {\n\t\t\tconst testObject: TestSynchroniser = disposableStore.add(client.instantiationService.createInstance(TestSynchroniser, { syncResource: SyncResource.Settings, profile: client.instantiationService.get(IUserDataProfilesService).defaultProfile }, undefined));\n\t\t\ttestObject.syncBarrier.open();\n\t\t\tawait testObject.sync(await client.getLatestRef(testObject.resource));\n\t\t\tconst fileService = client.instantiationService.get(IFileService);\n\t\t\tconst newLocalContent = 'conflict';\n\t\t\tawait fileService.writeFile(testObject.localResource, VSBuffer.fromString(newLocalContent));\n\n\t\t\ttestObject.syncResult = { hasConflicts: true, hasError: false };\n\t\t\tawait testObject.sync(await client.getLatestRef(testObject.resource));\n\t\t\tassert.deepStrictEqual(testObject.status, SyncStatus.HasConflicts);\n\n\t\t\tawait testObject.accept(testObject.conflicts.conflicts[0].previewResource, null);\n\t\t\tassert.deepStrictEqual(testObject.status, SyncStatus.Syncing);\n\t\t\tassertConflicts(testObject.conflicts.conflicts, []);\n\n\t\t\tawait testObject.apply(false);\n\t\t\tassert.deepStrictEqual(testObject.status, SyncStatus.Idle);\n\t\t\tassert.strictEqual((await testObject.getRemoteUserData(null)).syncData?.content, '');\n\t\t\tassert.ok(!(await fileService.exists(testObject.localResource)));\n\t\t});\n\t});\n\n\ttest('accept deleted local during conflicts', async () => {\n\t\tawait runWithFakedTimers<void>({}, async () => {\n\t\t\tconst testObject: TestSynchroniser = disposableStore.add(client.instantiationService.createInstance(TestSynchroniser, { syncResource: SyncResource.Settings, profile: client.instantiationService.get(IUserDataProfilesService).defaultProfile }, undefined));\n\t\t\ttestObject.syncBarrier.open();\n\t\t\tawait testObject.sync(await client.getLatestRef(testObject.resource));\n\t\t\tconst fileService = client.instantiationService.get(IFileService);\n\t\t\tawait fileService.del(testObject.localResource);\n\n\t\t\ttestObject.syncResult = { hasConflicts: true, hasError: false };\n\t\t\tawait testObject.sync(await client.getLatestRef(testObject.resource));\n\t\t\tassert.deepStrictEqual(testObject.status, SyncStatus.HasConflicts);\n\n\t\t\tawait testObject.accept(testObject.conflicts.conflicts[0].localResource);\n\t\t\tassert.deepStrictEqual(testObject.status, SyncStatus.Syncing);\n\t\t\tassertConflicts(testObject.conflicts.conflicts, []);\n\n\t\t\tawait testObject.apply(false);\n\t\t\tassert.deepStrictEqual(testObject.status, SyncStatus.Idle);\n\t\t\tassert.strictEqual((await testObject.getRemoteUserData(null)).syncData?.content, '');\n\t\t\tassert.ok(!(await fileService.exists(testObject.localResource)));\n\t\t});\n\t});\n\n\ttest('accept deleted remote during conflicts', async () => {\n\t\tawait runWithFakedTimers<void>({}, async () => {\n\t\t\tconst testObject: TestSynchroniser = disposableStore.add(client.instantiationService.createInstance(TestSynchroniser, { syncResource: SyncResource.Settings, profile: client.instantiationService.get(IUserDataProfilesService).defaultProfile }, undefined));\n\t\t\ttestObject.syncBarrier.open();\n\t\t\tconst fileService = client.instantiationService.get(IFileService);\n\t\t\tawait fileService.writeFile(testObject.localResource, VSBuffer.fromString('some content'));\n\t\t\ttestObject.syncResult = { hasConflicts: true, hasError: false };\n\n\t\t\tawait testObject.sync(await client.getLatestRef(testObject.resource));\n\t\t\tassert.deepStrictEqual(testObject.status, SyncStatus.HasConflicts);\n\n\t\t\tawait testObject.accept(testObject.conflicts.conflicts[0].remoteResource);\n\t\t\tassert.deepStrictEqual(testObject.status, SyncStatus.Syncing);\n\t\t\tassertConflicts(testObject.conflicts.conflicts, []);\n\n\t\t\tawait testObject.apply(false);\n\t\t\tassert.deepStrictEqual(testObject.status, SyncStatus.Idle);\n\t\t\tassert.strictEqual((await testObject.getRemoteUserData(null)).syncData, null);\n\t\t\tassert.ok(!(await fileService.exists(testObject.localResource)));\n\t\t});\n\t});\n\n\ttest('request latest data on precondition failure', async () => {\n\t\tawait runWithFakedTimers<void>({}, async () => {\n\t\t\tconst testObject: TestSynchroniser = disposableStore.add(client.instantiationService.createInstance(TestSynchroniser, { syncResource: SyncResource.Settings, profile: client.instantiationService.get(IUserDataProfilesService).defaultProfile }, undefined));\n\t\t\t// Sync once\n\t\t\ttestObject.syncBarrier.open();\n\t\t\tawait testObject.sync(await client.getLatestRef(testObject.resource));\n\t\t\ttestObject.syncBarrier = new Barrier();\n\n\t\t\t// update remote data before syncing so that 412 is thrown by server\n\t\t\tconst disposable = testObject.onDoSyncCall.event(async () => {\n\t\t\t\tdisposable.dispose();\n\t\t\t\tawait testObject.applyRef(ref, ref!);\n\t\t\t\tserver.reset();\n\t\t\t\ttestObject.syncBarrier.open();\n\t\t\t});\n\n\t\t\t// Start sycing\n\t\t\tconst ref = await client.getLatestRef(testObject.resource);\n\t\t\tawait testObject.sync(await client.getLatestRef(testObject.resource));\n\n\t\t\tassert.deepStrictEqual(server.requests, [\n\t\t\t\t{ type: 'POST', url: `${server.url}/v1/resource/${testObject.resource}`, headers: { 'If-Match': ref } },\n\t\t\t\t{ type: 'GET', url: `${server.url}/v1/resource/${testObject.resource}/latest`, headers: {} },\n\t\t\t\t{ type: 'POST', url: `${server.url}/v1/resource/${testObject.resource}`, headers: { 'If-Match': `${parseInt(ref!) + 1}` } },\n\t\t\t]);\n\t\t});\n\t});\n\n\ttest('no requests are made to server when local change is triggered', async () => {\n\t\tawait runWithFakedTimers<void>({}, async () => {\n\t\t\tconst testObject: TestSynchroniser = disposableStore.add(client.instantiationService.createInstance(TestSynchroniser, { syncResource: SyncResource.Settings, profile: client.instantiationService.get(IUserDataProfilesService).defaultProfile }, undefined));\n\t\t\ttestObject.syncBarrier.open();\n\t\t\tawait testObject.sync(await client.getLatestRef(testObject.resource));\n\n\t\t\tserver.reset();\n\t\t\tconst promise = Event.toPromise(testObject.onDidTriggerLocalChangeCall.event);\n\t\t\ttestObject.testTriggerLocalChange();\n\n\t\t\tawait promise;\n\t\t\tassert.deepStrictEqual(server.requests, []);\n\t\t});\n\t});\n\n\ttest('status is reset when getting latest remote data fails', async () => {\n\t\tawait runWithFakedTimers<void>({}, async () => {\n\t\t\tconst testObject: TestSynchroniser = disposableStore.add(client.instantiationService.createInstance(TestSynchroniser, { syncResource: SyncResource.Settings, profile: client.instantiationService.get(IUserDataProfilesService).defaultProfile }, undefined));\n\t\t\ttestObject.failWhenGettingLatestRemoteUserData = true;\n\n\t\t\ttry {\n\t\t\t\tawait testObject.sync(await client.getLatestRef(testObject.resource));\n\t\t\t\tassert.fail('Should throw an error');\n\t\t\t} catch (error) {\n\t\t\t}\n\n\t\t\tassert.strictEqual(testObject.status, SyncStatus.Idle);\n\t\t});\n\t});\n});\n\nsuite('TestSynchronizer - Manual Sync', () => {\n\n\tconst server = new UserDataSyncTestServer();\n\tlet client: UserDataSyncClient;\n\n\tteardown(async () => {\n\t\tawait client.instantiationService.get(IUserDataSyncStoreService).clear();\n\t});\n\n\tconst disposableStore = ensureNoDisposablesAreLeakedInTestSuite();\n\n\tsetup(async () => {\n\t\tclient = disposableStore.add(new UserDataSyncClient(server));\n\t\tawait client.setUp();\n\t});\n\n\ttest('preview', async () => {\n\t\tawait runWithFakedTimers<void>({}, async () => {\n\t\t\tconst testObject: TestSynchroniser = disposableStore.add(client.instantiationService.createInstance(TestSynchroniser, { syncResource: SyncResource.Settings, profile: client.instantiationService.get(IUserDataProfilesService).defaultProfile }, undefined));\n\t\t\ttestObject.syncResult = { hasConflicts: false, hasError: false };\n\t\t\ttestObject.syncBarrier.open();\n\n\t\t\tconst preview = await testObject.sync(await client.getLatestRef(testObject.resource), true);\n\n\t\t\tassert.deepStrictEqual(testObject.status, SyncStatus.Syncing);\n\t\t\tassertPreviews(preview!.resourcePreviews, [testObject.localResource]);\n\t\t\tassert.strictEqual(preview!.resourcePreviews[0].mergeState, MergeState.Accepted);\n\t\t\tassertConflicts(testObject.conflicts.conflicts, []);\n\t\t});\n\t});\n\n\ttest('preview -> accept', async () => {\n\t\tawait runWithFakedTimers<void>({}, async () => {\n\t\t\tconst testObject: TestSynchroniser = disposableStore.add(client.instantiationService.createInstance(TestSynchroniser, { syncResource: SyncResource.Settings, profile: client.instantiationService.get(IUserDataProfilesService).defaultProfile }, undefined));\n\t\t\ttestObject.syncResult = { hasConflicts: false, hasError: false };\n\t\t\ttestObject.syncBarrier.open();\n\n\t\t\tlet preview = await testObject.sync(await client.getLatestRef(testObject.resource), true);\n\t\t\tpreview = await testObject.accept(preview!.resourcePreviews[0].localResource);\n\n\t\t\tassert.deepStrictEqual(testObject.status, SyncStatus.Syncing);\n\t\t\tassertPreviews(preview!.resourcePreviews, [testObject.localResource]);\n\t\t\tassert.strictEqual(preview!.resourcePreviews[0].mergeState, MergeState.Accepted);\n\t\t\tassertConflicts(testObject.conflicts.conflicts, []);\n\t\t});\n\t});\n\n\ttest('preview -> merge -> apply', async () => {\n\t\tawait runWithFakedTimers<void>({}, async () => {\n\t\t\tconst testObject: TestSynchroniser = disposableStore.add(client.instantiationService.createInstance(TestSynchroniser, { syncResource: SyncResource.Settings, profile: client.instantiationService.get(IUserDataProfilesService).defaultProfile }, undefined));\n\t\t\ttestObject.syncResult = { hasConflicts: false, hasError: false };\n\t\t\ttestObject.syncBarrier.open();\n\t\t\tawait testObject.sync(await client.getLatestRef(testObject.resource));\n\n\t\t\tconst ref = await client.getLatestRef(testObject.resource);\n\t\t\tlet preview = await testObject.sync(ref, true);\n\t\t\tpreview = await testObject.apply(false);\n\n\t\t\tassert.deepStrictEqual(testObject.status, SyncStatus.Idle);\n\t\t\tassert.strictEqual(preview, null);\n\t\t\tassertConflicts(testObject.conflicts.conflicts, []);\n\n\t\t\tassert.strictEqual((await testObject.getRemoteUserData(null)).syncData?.content, ref);\n\t\t\tassert.strictEqual((await client.instantiationService.get(IFileService).readFile(testObject.localResource)).value.toString(), ref);\n\t\t});\n\t});\n\n\ttest('preview -> accept -> apply', async () => {\n\t\tawait runWithFakedTimers<void>({}, async () => {\n\t\t\tconst testObject: TestSynchroniser = disposableStore.add(client.instantiationService.createInstance(TestSynchroniser, { syncResource: SyncResource.Settings, profile: client.instantiationService.get(IUserDataProfilesService).defaultProfile }, undefined));\n\t\t\ttestObject.syncResult = { hasConflicts: false, hasError: false };\n\t\t\ttestObject.syncBarrier.open();\n\t\t\tawait testObject.sync(await client.getLatestRef(testObject.resource));\n\n\t\t\tconst ref = await client.getLatestRef(testObject.resource);\n\t\t\tlet preview = await testObject.sync(ref, true);\n\t\t\tpreview = await testObject.accept(preview!.resourcePreviews[0].previewResource);\n\t\t\tpreview = await testObject.apply(false);\n\n\t\t\tassert.deepStrictEqual(testObject.status, SyncStatus.Idle);\n\t\t\tassert.strictEqual(preview, null);\n\t\t\tassertConflicts(testObject.conflicts.conflicts, []);\n\n\t\t\tassert.strictEqual((await testObject.getRemoteUserData(null)).syncData?.content, ref);\n\t\t\tassert.strictEqual((await client.instantiationService.get(IFileService).readFile(testObject.localResource)).value.toString(), ref);\n\t\t});\n\t});\n\n\ttest('preivew -> discard', async () => {\n\t\tawait runWithFakedTimers<void>({}, async () => {\n\t\t\tconst testObject: TestSynchroniser = disposableStore.add(client.instantiationService.createInstance(TestSynchroniser, { syncResource: SyncResource.Settings, profile: client.instantiationService.get(IUserDataProfilesService).defaultProfile }, undefined));\n\t\t\ttestObject.syncResult = { hasConflicts: false, hasError: false };\n\t\t\ttestObject.syncBarrier.open();\n\n\t\t\tlet preview = await testObject.sync(await client.getLatestRef(testObject.resource), true);\n\t\t\tpreview = await testObject.discard(preview!.resourcePreviews[0].previewResource);\n\n\t\t\tassert.deepStrictEqual(testObject.status, SyncStatus.Syncing);\n\t\t\tassertPreviews(preview!.resourcePreviews, [testObject.localResource]);\n\t\t\tassert.strictEqual(preview!.resourcePreviews[0].mergeState, MergeState.Preview);\n\t\t\tassertConflicts(testObject.conflicts.conflicts, []);\n\t\t});\n\t});\n\n\ttest('preivew -> discard -> accept', async () => {\n\t\tawait runWithFakedTimers<void>({}, async () => {\n\t\t\tconst testObject: TestSynchroniser = disposableStore.add(client.instantiationService.createInstance(TestSynchroniser, { syncResource: SyncResource.Settings, profile: client.instantiationService.get(IUserDataProfilesService).defaultProfile }, undefined));\n\t\t\ttestObject.syncResult = { hasConflicts: false, hasError: false };\n\t\t\ttestObject.syncBarrier.open();\n\n\t\t\tlet preview = await testObject.sync(await client.getLatestRef(testObject.resource), true);\n\t\t\tpreview = await testObject.discard(preview!.resourcePreviews[0].previewResource);\n\t\t\tpreview = await testObject.accept(preview!.resourcePreviews[0].remoteResource);\n\n\t\t\tassert.deepStrictEqual(testObject.status, SyncStatus.Syncing);\n\t\t\tassertPreviews(preview!.resourcePreviews, [testObject.localResource]);\n\t\t\tassert.strictEqual(preview!.resourcePreviews[0].mergeState, MergeState.Accepted);\n\t\t\tassertConflicts(testObject.conflicts.conflicts, []);\n\t\t});\n\t});\n\n\ttest('preivew -> accept -> discard -> accept', async () => {\n\t\tawait runWithFakedTimers<void>({}, async () => {\n\t\t\tconst testObject: TestSynchroniser = disposableStore.add(client.instantiationService.createInstance(TestSynchroniser, { syncResource: SyncResource.Settings, profile: client.instantiationService.get(IUserDataProfilesService).defaultProfile }, undefined));\n\t\t\ttestObject.syncResult = { hasConflicts: false, hasError: false };\n\t\t\ttestObject.syncBarrier.open();\n\n\t\t\tlet preview = await testObject.sync(await client.getLatestRef(testObject.resource), true);\n\t\t\tpreview = await testObject.accept(preview!.resourcePreviews[0].previewResource);\n\t\t\tpreview = await testObject.discard(preview!.resourcePreviews[0].previewResource);\n\t\t\tpreview = await testObject.accept(preview!.resourcePreviews[0].remoteResource);\n\n\t\t\tassert.deepStrictEqual(testObject.status, SyncStatus.Syncing);\n\t\t\tassertPreviews(preview!.resourcePreviews, [testObject.localResource]);\n\t\t\tassert.strictEqual(preview!.resourcePreviews[0].mergeState, MergeState.Accepted);\n\t\t\tassertConflicts(testObject.conflicts.conflicts, []);\n\t\t});\n\t});\n\n\ttest('preivew -> accept -> discard', async () => {\n\t\tawait runWithFakedTimers<void>({}, async () => {\n\t\t\tconst testObject: TestSynchroniser = disposableStore.add(client.instantiationService.createInstance(TestSynchroniser, { syncResource: SyncResource.Settings, profile: client.instantiationService.get(IUserDataProfilesService).defaultProfile }, undefined));\n\t\t\ttestObject.syncResult = { hasConflicts: false, hasError: false };\n\t\t\ttestObject.syncBarrier.open();\n\n\t\t\tlet preview = await testObject.sync(await client.getLatestRef(testObject.resource), true);\n\t\t\tpreview = await testObject.accept(preview!.resourcePreviews[0].remoteResource);\n\t\t\tpreview = await testObject.discard(preview!.resourcePreviews[0].previewResource);\n\n\t\t\tassert.deepStrictEqual(testObject.status, SyncStatus.Syncing);\n\t\t\tassertPreviews(preview!.resourcePreviews, [testObject.localResource]);\n\t\t\tassert.strictEqual(preview!.resourcePreviews[0].mergeState, MergeState.Preview);\n\t\t\tassertConflicts(testObject.conflicts.conflicts, []);\n\t\t});\n\t});\n\n\ttest('preivew -> discard -> accept -> apply', async () => {\n\t\tawait runWithFakedTimers<void>({}, async () => {\n\t\t\tconst testObject: TestSynchroniser = disposableStore.add(client.instantiationService.createInstance(TestSynchroniser, { syncResource: SyncResource.Settings, profile: client.instantiationService.get(IUserDataProfilesService).defaultProfile }, undefined));\n\t\t\ttestObject.syncResult = { hasConflicts: false, hasError: false };\n\t\t\ttestObject.syncBarrier.open();\n\t\t\tawait testObject.sync(await client.getLatestRef(testObject.resource));\n\n\t\t\tconst expectedContent = (await client.instantiationService.get(IFileService).readFile(testObject.localResource)).value.toString();\n\t\t\tlet preview = await testObject.sync(await client.getLatestRef(testObject.resource), true);\n\t\t\tpreview = await testObject.accept(preview!.resourcePreviews[0].remoteResource);\n\t\t\tpreview = await testObject.discard(preview!.resourcePreviews[0].previewResource);\n\t\t\tpreview = await testObject.accept(preview!.resourcePreviews[0].localResource);\n\t\t\tpreview = await testObject.apply(false);\n\n\t\t\tassert.deepStrictEqual(testObject.status, SyncStatus.Idle);\n\t\t\tassert.strictEqual(preview, null);\n\t\t\tassertConflicts(testObject.conflicts.conflicts, []);\n\t\t\tassert.strictEqual((await testObject.getRemoteUserData(null)).syncData?.content, expectedContent);\n\t\t\tassert.strictEqual((await client.instantiationService.get(IFileService).readFile(testObject.localResource)).value.toString(), expectedContent);\n\t\t});\n\t});\n\n\ttest('conflicts: preview', async () => {\n\t\tawait runWithFakedTimers<void>({}, async () => {\n\t\t\tconst testObject: TestSynchroniser = disposableStore.add(client.instantiationService.createInstance(TestSynchroniser, { syncResource: SyncResource.Settings, profile: client.instantiationService.get(IUserDataProfilesService).defaultProfile }, undefined));\n\t\t\ttestObject.syncResult = { hasConflicts: true, hasError: false };\n\t\t\ttestObject.syncBarrier.open();\n\n\t\t\tconst preview = await testObject.sync(await client.getLatestRef(testObject.resource), true);\n\n\t\t\tassert.deepStrictEqual(testObject.status, SyncStatus.HasConflicts);\n\t\t\tassertPreviews(preview!.resourcePreviews, [testObject.localResource]);\n\t\t\tassert.strictEqual(preview!.resourcePreviews[0].mergeState, MergeState.Conflict);\n\t\t\tassertConflicts(testObject.conflicts.conflicts, [preview!.resourcePreviews[0].localResource]);\n\t\t});\n\t});\n\n\ttest('conflicts: preview -> discard', async () => {\n\t\tawait runWithFakedTimers<void>({}, async () => {\n\t\t\tconst testObject: TestSynchroniser = disposableStore.add(client.instantiationService.createInstance(TestSynchroniser, { syncResource: SyncResource.Settings, profile: client.instantiationService.get(IUserDataProfilesService).defaultProfile }, undefined));\n\t\t\ttestObject.syncResult = { hasConflicts: true, hasError: false };\n\t\t\ttestObject.syncBarrier.open();\n\n\t\t\tconst preview = await testObject.sync(await client.getLatestRef(testObject.resource), true);\n\t\t\tawait testObject.discard(preview!.resourcePreviews[0].previewResource);\n\n\t\t\tassert.deepStrictEqual(testObject.status, SyncStatus.Syncing);\n\t\t\tassertPreviews(preview!.resourcePreviews, [testObject.localResource]);\n\t\t\tassert.strictEqual(preview!.resourcePreviews[0].mergeState, MergeState.Preview);\n\t\t\tassertConflicts(testObject.conflicts.conflicts, []);\n\t\t});\n\t});\n\n\ttest('conflicts: preview -> accept', async () => {\n\t\tawait runWithFakedTimers<void>({}, async () => {\n\t\t\tconst testObject: TestSynchroniser = disposableStore.add(client.instantiationService.createInstance(TestSynchroniser, { syncResource: SyncResource.Settings, profile: client.instantiationService.get(IUserDataProfilesService).defaultProfile }, undefined));\n\t\t\ttestObject.syncResult = { hasConflicts: true, hasError: false };\n\t\t\ttestObject.syncBarrier.open();\n\n\t\t\tlet preview = await testObject.sync(await client.getLatestRef(testObject.resource), true);\n\t\t\tconst content = await testObject.resolveContent(preview!.resourcePreviews[0].previewResource);\n\t\t\tpreview = await testObject.accept(preview!.resourcePreviews[0].previewResource, content);\n\n\t\t\tassert.deepStrictEqual(testObject.status, SyncStatus.Syncing);\n\t\t\tassertPreviews(preview!.resourcePreviews, [testObject.localResource]);\n\t\t\tassert.deepStrictEqual(testObject.conflicts.conflicts, []);\n\t\t});\n\t});\n\n\ttest('conflicts: preview -> accept 2', async () => {\n\t\tawait runWithFakedTimers<void>({}, async () => {\n\t\t\tconst testObject: TestSynchroniser = disposableStore.add(client.instantiationService.createInstance(TestSynchroniser, { syncResource: SyncResource.Settings, profile: client.instantiationService.get(IUserDataProfilesService).defaultProfile }, undefined));\n\t\t\ttestObject.syncResult = { hasConflicts: true, hasError: false };\n\t\t\ttestObject.syncBarrier.open();\n\n\t\t\tlet preview = await testObject.sync(await client.getLatestRef(testObject.resource), true);\n\t\t\tconst content = await testObject.resolveContent(preview!.resourcePreviews[0].previewResource);\n\t\t\tpreview = await testObject.accept(preview!.resourcePreviews[0].previewResource, content);\n\n\t\t\tassert.deepStrictEqual(testObject.status, SyncStatus.Syncing);\n\t\t\tassertPreviews(preview!.resourcePreviews, [testObject.localResource]);\n\t\t\tassertConflicts(testObject.conflicts.conflicts, []);\n\t\t});\n\t});\n\n\ttest('conflicts: preview -> accept -> apply', async () => {\n\t\tawait runWithFakedTimers<void>({}, async () => {\n\t\t\tconst testObject: TestSynchroniser = disposableStore.add(client.instantiationService.createInstance(TestSynchroniser, { syncResource: SyncResource.Settings, profile: client.instantiationService.get(IUserDataProfilesService).defaultProfile }, undefined));\n\t\t\ttestObject.syncResult = { hasConflicts: false, hasError: false };\n\t\t\ttestObject.syncBarrier.open();\n\t\t\tawait testObject.sync(await client.getLatestRef(testObject.resource));\n\n\t\t\ttestObject.syncResult = { hasConflicts: true, hasError: false };\n\t\t\tconst ref = await client.getLatestRef(testObject.resource);\n\t\t\tlet preview = await testObject.sync(ref, true);\n\n\t\t\tpreview = await testObject.accept(preview!.resourcePreviews[0].previewResource);\n\t\t\tpreview = await testObject.apply(false);\n\n\t\t\tassert.deepStrictEqual(testObject.status, SyncStatus.Idle);\n\t\t\tassert.strictEqual(preview, null);\n\t\t\tassertConflicts(testObject.conflicts.conflicts, []);\n\n\t\t\tassert.strictEqual((await testObject.getRemoteUserData(null)).syncData?.content, ref);\n\t\t\tassert.strictEqual((await client.instantiationService.get(IFileService).readFile(testObject.localResource)).value.toString(), ref);\n\t\t});\n\t});\n\n\ttest('conflicts: preivew -> discard', async () => {\n\t\tawait runWithFakedTimers<void>({}, async () => {\n\t\t\tconst testObject: TestSynchroniser = disposableStore.add(client.instantiationService.createInstance(TestSynchroniser, { syncResource: SyncResource.Settings, profile: client.instantiationService.get(IUserDataProfilesService).defaultProfile }, undefined));\n\t\t\ttestObject.syncResult = { hasConflicts: true, hasError: false };\n\t\t\ttestObject.syncBarrier.open();\n\n\t\t\tlet preview = await testObject.sync(await client.getLatestRef(testObject.resource), true);\n\t\t\tpreview = await testObject.discard(preview!.resourcePreviews[0].previewResource);\n\n\t\t\tassert.deepStrictEqual(testObject.status, SyncStatus.Syncing);\n\t\t\tassertPreviews(preview!.resourcePreviews, [testObject.localResource]);\n\t\t\tassert.strictEqual(preview!.resourcePreviews[0].mergeState, MergeState.Preview);\n\t\t\tassertConflicts(testObject.conflicts.conflicts, []);\n\t\t});\n\t});\n\n\ttest('conflicts: preivew -> discard -> accept', async () => {\n\t\tawait runWithFakedTimers<void>({}, async () => {\n\t\t\tconst testObject: TestSynchroniser = disposableStore.add(client.instantiationService.createInstance(TestSynchroniser, { syncResource: SyncResource.Settings, profile: client.instantiationService.get(IUserDataProfilesService).defaultProfile }, undefined));\n\t\t\ttestObject.syncResult = { hasConflicts: true, hasError: false };\n\t\t\ttestObject.syncBarrier.open();\n\n\t\t\tlet preview = await testObject.sync(await client.getLatestRef(testObject.resource), true);\n\t\t\tpreview = await testObject.discard(preview!.resourcePreviews[0].previewResource);\n\t\t\tpreview = await testObject.accept(preview!.resourcePreviews[0].remoteResource);\n\n\t\t\tassert.deepStrictEqual(testObject.status, SyncStatus.Syncing);\n\t\t\tassertPreviews(preview!.resourcePreviews, [testObject.localResource]);\n\t\t\tassert.strictEqual(preview!.resourcePreviews[0].mergeState, MergeState.Accepted);\n\t\t\tassertConflicts(testObject.conflicts.conflicts, []);\n\t\t});\n\t});\n\n\ttest('conflicts: preivew -> accept -> discard -> accept', async () => {\n\t\tawait runWithFakedTimers<void>({}, async () => {\n\t\t\tconst testObject: TestSynchroniser = disposableStore.add(client.instantiationService.createInstance(TestSynchroniser, { syncResource: SyncResource.Settings, profile: client.instantiationService.get(IUserDataProfilesService).defaultProfile }, undefined));\n\t\t\ttestObject.syncResult = { hasConflicts: true, hasError: false };\n\t\t\ttestObject.syncBarrier.open();\n\n\t\t\tlet preview = await testObject.sync(await client.getLatestRef(testObject.resource), true);\n\t\t\tpreview = await testObject.accept(preview!.resourcePreviews[0].previewResource);\n\t\t\tpreview = await testObject.discard(preview!.resourcePreviews[0].previewResource);\n\t\t\tpreview = await testObject.accept(preview!.resourcePreviews[0].remoteResource);\n\n\t\t\tassert.deepStrictEqual(testObject.status, SyncStatus.Syncing);\n\t\t\tassertPreviews(preview!.resourcePreviews, [testObject.localResource]);\n\t\t\tassert.strictEqual(preview!.resourcePreviews[0].mergeState, MergeState.Accepted);\n\t\t\tassertConflicts(testObject.conflicts.conflicts, []);\n\t\t});\n\t});\n\n\ttest('conflicts: preivew -> accept -> discard', async () => {\n\t\tawait runWithFakedTimers<void>({}, async () => {\n\t\t\tconst testObject: TestSynchroniser = disposableStore.add(client.instantiationService.createInstance(TestSynchroniser, { syncResource: SyncResource.Settings, profile: client.instantiationService.get(IUserDataProfilesService).defaultProfile }, undefined));\n\t\t\ttestObject.syncResult = { hasConflicts: false, hasError: false };\n\t\t\ttestObject.syncBarrier.open();\n\n\t\t\tlet preview = await testObject.sync(await client.getLatestRef(testObject.resource), true);\n\t\t\tpreview = await testObject.accept(preview!.resourcePreviews[0].remoteResource);\n\t\t\tpreview = await testObject.discard(preview!.resourcePreviews[0].previewResource);\n\n\t\t\tassert.deepStrictEqual(testObject.status, SyncStatus.Syncing);\n\t\t\tassertPreviews(preview!.resourcePreviews, [testObject.localResource]);\n\t\t\tassert.strictEqual(preview!.resourcePreviews[0].mergeState, MergeState.Preview);\n\t\t\tassertConflicts(testObject.conflicts.conflicts, []);\n\t\t});\n\t});\n\n\ttest('conflicts: preivew -> discard -> accept -> apply', async () => {\n\t\tawait runWithFakedTimers<void>({}, async () => {\n\t\t\tconst testObject: TestSynchroniser = disposableStore.add(client.instantiationService.createInstance(TestSynchroniser, { syncResource: SyncResource.Settings, profile: client.instantiationService.get(IUserDataProfilesService).defaultProfile }, undefined));\n\t\t\ttestObject.syncResult = { hasConflicts: false, hasError: false };\n\t\t\ttestObject.syncBarrier.open();\n\t\t\tawait testObject.sync(await client.getLatestRef(testObject.resource));\n\n\t\t\tconst expectedContent = (await client.instantiationService.get(IFileService).readFile(testObject.localResource)).value.toString();\n\t\t\tlet preview = await testObject.sync(await client.getLatestRef(testObject.resource), true);\n\t\t\tpreview = await testObject.discard(preview!.resourcePreviews[0].previewResource);\n\t\t\tpreview = await testObject.accept(preview!.resourcePreviews[0].localResource);\n\t\t\tpreview = await testObject.apply(false);\n\n\t\t\tassert.deepStrictEqual(testObject.status, SyncStatus.Idle);\n\t\t\tassert.strictEqual(preview, null);\n\t\t\tassertConflicts(testObject.conflicts.conflicts, []);\n\t\t\tassert.strictEqual((await testObject.getRemoteUserData(null)).syncData?.content, expectedContent);\n\t\t\tassert.strictEqual((await client.instantiationService.get(IFileService).readFile(testObject.localResource)).value.toString(), expectedContent);\n\t\t});\n\t});\n\n\ttest('conflicts: preivew -> accept -> discard -> accept -> apply', async () => {\n\t\tawait runWithFakedTimers<void>({}, async () => {\n\t\t\tconst testObject: TestSynchroniser = disposableStore.add(client.instantiationService.createInstance(TestSynchroniser, { syncResource: SyncResource.Settings, profile: client.instantiationService.get(IUserDataProfilesService).defaultProfile }, undefined));\n\t\t\ttestObject.syncResult = { hasConflicts: false, hasError: false };\n\t\t\ttestObject.syncBarrier.open();\n\t\t\tawait testObject.sync(await client.getLatestRef(testObject.resource));\n\n\t\t\tconst expectedContent = (await client.instantiationService.get(IFileService).readFile(testObject.localResource)).value.toString();\n\t\t\tlet preview = await testObject.sync(await client.getLatestRef(testObject.resource), true);\n\t\t\tpreview = await testObject.accept(preview!.resourcePreviews[0].remoteResource);\n\t\t\tpreview = await testObject.discard(preview!.resourcePreviews[0].previewResource);\n\t\t\tpreview = await testObject.accept(preview!.resourcePreviews[0].localResource);\n\t\t\tpreview = await testObject.apply(false);\n\n\t\t\tassert.deepStrictEqual(testObject.status, SyncStatus.Idle);\n\t\t\tassert.strictEqual(preview, null);\n\t\t\tassertConflicts(testObject.conflicts.conflicts, []);\n\t\t\tassert.strictEqual((await testObject.getRemoteUserData(null)).syncData?.content, expectedContent);\n\t\t\tassert.strictEqual((await client.instantiationService.get(IFileService).readFile(testObject.localResource)).value.toString(), expectedContent);\n\t\t});\n\t});\n\n\ttest('remote is accepted if last sync state does not exists in server', async () => {\n\t\tawait runWithFakedTimers<void>({}, async () => {\n\t\t\tconst fileService = client.instantiationService.get(IFileService);\n\t\t\tconst testObject: TestSynchroniser = disposableStore.add(client.instantiationService.createInstance(TestSynchroniser, { syncResource: SyncResource.Settings, profile: client.instantiationService.get(IUserDataProfilesService).defaultProfile }, undefined));\n\t\t\ttestObject.syncBarrier.open();\n\n\t\t\tawait testObject.sync(await client.getLatestRef(testObject.resource));\n\n\t\t\tconst client2 = disposableStore.add(new UserDataSyncClient(server));\n\t\t\tawait client2.setUp();\n\t\t\tconst synchronizer2: TestSynchroniser = disposableStore.add(client2.instantiationService.createInstance(TestSynchroniser, { syncResource: SyncResource.Settings, profile: client2.instantiationService.get(IUserDataProfilesService).defaultProfile }, undefined));\n\t\t\tsynchronizer2.syncBarrier.open();\n\t\t\tconst ref = await client2.getLatestRef(testObject.resource);\n\t\t\tawait synchronizer2.sync(ref);\n\n\t\t\tawait fileService.del(testObject.getLastSyncResource());\n\t\t\tawait testObject.sync(await client.getLatestRef(testObject.resource));\n\n\t\t\tassert.deepStrictEqual(testObject.status, SyncStatus.Idle);\n\t\t\tassert.strictEqual((await client.instantiationService.get(IFileService).readFile(testObject.localResource)).value.toString(), ref);\n\t\t});\n\t});\n\n});\n\nsuite('TestSynchronizer - Last Sync Data', () => {\n\tconst server = new UserDataSyncTestServer();\n\tlet client: UserDataSyncClient;\n\n\tteardown(async () => {\n\t\tawait client.instantiationService.get(IUserDataSyncStoreService).clear();\n\t});\n\n\tconst disposableStore = ensureNoDisposablesAreLeakedInTestSuite();\n\n\tsetup(async () => {\n\t\tclient = disposableStore.add(new UserDataSyncClient(server));\n\t\tawait client.setUp();\n\t});\n\n\ttest('last sync data is null when not synced before', async () => {\n\t\tawait runWithFakedTimers<void>({}, async () => {\n\t\t\tconst testObject: TestSynchroniser = disposableStore.add(client.instantiationService.createInstance(TestSynchroniser, { syncResource: SyncResource.Settings, profile: client.instantiationService.get(IUserDataProfilesService).defaultProfile }, undefined));\n\n\t\t\tconst actual = await testObject.getLastSyncUserData();\n\n\t\t\tassert.strictEqual(actual, null);\n\t\t});\n\t});\n\n\ttest('last sync data is set after sync', async () => {\n\t\tawait runWithFakedTimers<void>({}, async () => {\n\t\t\tconst storageService = client.instantiationService.get(IStorageService);\n\t\t\tconst fileService = client.instantiationService.get(IFileService);\n\t\t\tconst testObject: TestSynchroniser = disposableStore.add(client.instantiationService.createInstance(TestSynchroniser, { syncResource: SyncResource.Settings, profile: client.instantiationService.get(IUserDataProfilesService).defaultProfile }, undefined));\n\t\t\ttestObject.syncBarrier.open();\n\n\t\t\tawait testObject.sync(await client.getLatestRef(testObject.resource));\n\t\t\tconst machineId = await testObject.getMachineId();\n\t\t\tconst actual = await testObject.getLastSyncUserData();\n\n\t\t\tassert.deepStrictEqual(storageService.get('settings.lastSyncUserData', StorageScope.APPLICATION), JSON.stringify({ ref: '1' }));\n\t\t\tassert.deepStrictEqual(JSON.parse((await fileService.readFile(testObject.getLastSyncResource())).value.toString()), { ref: '1', syncData: { version: 1, machineId, content: '0' } });\n\t\t\tassert.deepStrictEqual(actual, {\n\t\t\t\tref: '1',\n\t\t\t\tsyncData: {\n\t\t\t\t\tcontent: '0',\n\t\t\t\t\tmachineId,\n\t\t\t\t\tversion: 1\n\t\t\t\t},\n\t\t\t});\n\t\t});\n\t});\n\n\ttest('last sync data is read from server after sync if last sync resource is deleted', async () => {\n\t\tawait runWithFakedTimers<void>({}, async () => {\n\t\t\tconst storageService = client.instantiationService.get(IStorageService);\n\t\t\tconst fileService = client.instantiationService.get(IFileService);\n\t\t\tconst testObject: TestSynchroniser = disposableStore.add(client.instantiationService.createInstance(TestSynchroniser, { syncResource: SyncResource.Settings, profile: client.instantiationService.get(IUserDataProfilesService).defaultProfile }, undefined));\n\t\t\ttestObject.syncBarrier.open();\n\n\t\t\tawait testObject.sync(await client.getLatestRef(testObject.resource));\n\t\t\tconst machineId = await testObject.getMachineId();\n\t\t\tawait fileService.del(testObject.getLastSyncResource());\n\t\t\tconst actual = await testObject.getLastSyncUserData();\n\n\t\t\tassert.deepStrictEqual(storageService.get('settings.lastSyncUserData', StorageScope.APPLICATION), JSON.stringify({ ref: '1' }));\n\t\t\tassert.deepStrictEqual(actual, {\n\t\t\t\tref: '1',\n\t\t\t\tsyncData: {\n\t\t\t\t\tcontent: '0',\n\t\t\t\t\tmachineId,\n\t\t\t\t\tversion: 1\n\t\t\t\t},\n\t\t\t});\n\t\t});\n\t});\n\n\ttest('last sync data is read from server after sync and sync data is invalid', async () => {\n\t\tawait runWithFakedTimers<void>({}, async () => {\n\t\t\tconst storageService = client.instantiationService.get(IStorageService);\n\t\t\tconst fileService = client.instantiationService.get(IFileService);\n\t\t\tconst testObject: TestSynchroniser = disposableStore.add(client.instantiationService.createInstance(TestSynchroniser, { syncResource: SyncResource.Settings, profile: client.instantiationService.get(IUserDataProfilesService).defaultProfile }, undefined));\n\t\t\ttestObject.syncBarrier.open();\n\n\t\t\tawait testObject.sync(await client.getLatestRef(testObject.resource));\n\t\t\tconst machineId = await testObject.getMachineId();\n\t\t\tawait fileService.writeFile(testObject.getLastSyncResource(), VSBuffer.fromString(JSON.stringify({\n\t\t\t\tref: '1',\n\t\t\t\tversion: 1,\n\t\t\t\tcontent: JSON.stringify({\n\t\t\t\t\tcontent: '0',\n\t\t\t\t\tmachineId,\n\t\t\t\t\tversion: 1\n\t\t\t\t}),\n\t\t\t\tadditionalData: {\n\t\t\t\t\tfoo: 'bar'\n\t\t\t\t}\n\t\t\t})));\n\t\t\tserver.reset();\n\t\t\tconst actual = await testObject.getLastSyncUserData();\n\n\t\t\tassert.deepStrictEqual(storageService.get('settings.lastSyncUserData', StorageScope.APPLICATION), JSON.stringify({ ref: '1' }));\n\t\t\tassert.deepStrictEqual(actual, {\n\t\t\t\tref: '1',\n\t\t\t\tsyncData: {\n\t\t\t\t\tcontent: '0',\n\t\t\t\t\tmachineId,\n\t\t\t\t\tversion: 1\n\t\t\t\t},\n\t\t\t});\n\t\t\tassert.deepStrictEqual(server.requests, [{ headers: {}, type: 'GET', url: 'http://host:3000/v1/resource/settings/1' }]);\n\t\t});\n\t});\n\n\ttest('last sync data is read from server after sync and stored sync data is tampered', async () => {\n\t\tawait runWithFakedTimers<void>({}, async () => {\n\t\t\tconst storageService = client.instantiationService.get(IStorageService);\n\t\t\tconst fileService = client.instantiationService.get(IFileService);\n\t\t\tconst testObject: TestSynchroniser = disposableStore.add(client.instantiationService.createInstance(TestSynchroniser, { syncResource: SyncResource.Settings, profile: client.instantiationService.get(IUserDataProfilesService).defaultProfile }, undefined));\n\t\t\ttestObject.syncBarrier.open();\n\n\t\t\tawait testObject.sync(await client.getLatestRef(testObject.resource));\n\t\t\tconst machineId = await testObject.getMachineId();\n\t\t\tawait fileService.writeFile(testObject.getLastSyncResource(), VSBuffer.fromString(JSON.stringify({\n\t\t\t\tref: '2',\n\t\t\t\tsyncData: {\n\t\t\t\t\tcontent: '0',\n\t\t\t\t\tmachineId,\n\t\t\t\t\tversion: 1\n\t\t\t\t}\n\t\t\t})));\n\t\t\tserver.reset();\n\t\t\tconst actual = await testObject.getLastSyncUserData();\n\n\t\t\tassert.deepStrictEqual(storageService.get('settings.lastSyncUserData', StorageScope.APPLICATION), JSON.stringify({ ref: '1' }));\n\t\t\tassert.deepStrictEqual(actual, {\n\t\t\t\tref: '1',\n\t\t\t\tsyncData: {\n\t\t\t\t\tcontent: '0',\n\t\t\t\t\tmachineId,\n\t\t\t\t\tversion: 1\n\t\t\t\t}\n\t\t\t});\n\t\t\tassert.deepStrictEqual(server.requests, [{ headers: {}, type: 'GET', url: 'http://host:3000/v1/resource/settings/1' }]);\n\t\t});\n\t});\n\n\ttest('reading last sync data: no requests are made to server when sync data is invalid', async () => {\n\t\tawait runWithFakedTimers<void>({}, async () => {\n\t\t\tconst fileService = client.instantiationService.get(IFileService);\n\t\t\tconst testObject: TestSynchroniser = disposableStore.add(client.instantiationService.createInstance(TestSynchroniser, { syncResource: SyncResource.Settings, profile: client.instantiationService.get(IUserDataProfilesService).defaultProfile }, undefined));\n\t\t\ttestObject.syncBarrier.open();\n\n\t\t\tawait testObject.sync(await client.getLatestRef(testObject.resource));\n\t\t\tconst machineId = await testObject.getMachineId();\n\t\t\tawait fileService.writeFile(testObject.getLastSyncResource(), VSBuffer.fromString(JSON.stringify({\n\t\t\t\tref: '1',\n\t\t\t\tversion: 1,\n\t\t\t\tcontent: JSON.stringify({\n\t\t\t\t\tcontent: '0',\n\t\t\t\t\tmachineId,\n\t\t\t\t\tversion: 1\n\t\t\t\t}),\n\t\t\t\tadditionalData: {\n\t\t\t\t\tfoo: 'bar'\n\t\t\t\t}\n\t\t\t})));\n\t\t\tawait testObject.getLastSyncUserData();\n\t\t\tserver.reset();\n\n\t\t\tawait testObject.getLastSyncUserData();\n\t\t\tassert.deepStrictEqual(server.requests, []);\n\t\t});\n\t});\n\n\ttest('reading last sync data: no requests are made to server when sync data is null', async () => {\n\t\tawait runWithFakedTimers<void>({}, async () => {\n\t\t\tconst fileService = client.instantiationService.get(IFileService);\n\t\t\tconst testObject: TestSynchroniser = disposableStore.add(client.instantiationService.createInstance(TestSynchroniser, { syncResource: SyncResource.Settings, profile: client.instantiationService.get(IUserDataProfilesService).defaultProfile }, undefined));\n\t\t\ttestObject.syncBarrier.open();\n\n\t\t\tawait testObject.sync(await client.getLatestRef(testObject.resource));\n\t\t\tserver.reset();\n\t\t\tawait fileService.writeFile(testObject.getLastSyncResource(), VSBuffer.fromString(JSON.stringify({\n\t\t\t\tref: '1',\n\t\t\t\tsyncData: null,\n\t\t\t})));\n\t\t\tawait testObject.getLastSyncUserData();\n\n\t\t\tassert.deepStrictEqual(server.requests, []);\n\t\t});\n\t});\n\n\ttest('last sync data is null after sync if last sync state is deleted', async () => {\n\t\tawait runWithFakedTimers<void>({}, async () => {\n\t\t\tconst storageService = client.instantiationService.get(IStorageService);\n\t\t\tconst testObject: TestSynchroniser = disposableStore.add(client.instantiationService.createInstance(TestSynchroniser, { syncResource: SyncResource.Settings, profile: client.instantiationService.get(IUserDataProfilesService).defaultProfile }, undefined));\n\t\t\ttestObject.syncBarrier.open();\n\n\t\t\tawait testObject.sync(await client.getLatestRef(testObject.resource));\n\t\t\tstorageService.remove('settings.lastSyncUserData', StorageScope.APPLICATION);\n\t\t\tconst actual = await testObject.getLastSyncUserData();\n\n\t\t\tassert.strictEqual(actual, null);\n\t\t});\n\t});\n\n\ttest('last sync data is null after sync if last sync content is deleted everywhere', async () => {\n\t\tawait runWithFakedTimers<void>({}, async () => {\n\t\t\tconst storageService = client.instantiationService.get(IStorageService);\n\t\t\tconst fileService = client.instantiationService.get(IFileService);\n\t\t\tconst userDataSyncStoreService = client.instantiationService.get(IUserDataSyncStoreService);\n\t\t\tconst testObject: TestSynchroniser = disposableStore.add(client.instantiationService.createInstance(TestSynchroniser, { syncResource: SyncResource.Settings, profile: client.instantiationService.get(IUserDataProfilesService).defaultProfile }, undefined));\n\t\t\ttestObject.syncBarrier.open();\n\n\t\t\tawait testObject.sync(await client.getLatestRef(testObject.resource));\n\t\t\tawait fileService.del(testObject.getLastSyncResource());\n\t\t\tawait userDataSyncStoreService.deleteResource(testObject.syncResource.syncResource, null);\n\t\t\tconst actual = await testObject.getLastSyncUserData();\n\n\t\t\tassert.deepStrictEqual(storageService.get('settings.lastSyncUserData', StorageScope.APPLICATION), JSON.stringify({ ref: '1' }));\n\t\t\tassert.strictEqual(actual, null);\n\t\t});\n\t});\n\n});\n\nfunction assertConflicts(actual: IBaseResourcePreview[], expected: URI[]) {\n\tassert.deepStrictEqual(actual.map(({ localResource }) => localResource.toString()), expected.map(uri => uri.toString()));\n}\n\nfunction assertPreviews(actual: IBaseResourcePreview[], expected: URI[]) {\n\tassert.deepStrictEqual(actual.map(({ localResource }) => localResource.toString()), expected.map(uri => uri.toString()));\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport assert from 'assert';\nimport { Barrier } from '../../../../base/common/async.js';\nimport { VSBuffer } from '../../../../base/common/buffer.js';\nimport { CancellationToken } from '../../../../base/common/cancellation.js';\nimport { Emitter, Event } from '../../../../base/common/event.js';\nimport { isEqual, joinPath } from '../../../../base/common/resources.js';\nimport { URI } from '../../../../base/common/uri.js';\nimport { runWithFakedTimers } from '../../../../base/test/common/timeTravelScheduler.js';\nimport { ensureNoDisposablesAreLeakedInTestSuite } from '../../../../base/test/common/utils.js';\nimport { IFileService } from '../../../files/common/files.js';\nimport { IStorageService, StorageScope } from '../../../storage/common/storage.js';\nimport { IUserDataProfilesService } from '../../../userDataProfile/common/userDataProfile.js';\nimport { AbstractSynchroniser, IAcceptResult, IMergeResult, IResourcePreview, SyncStrategy } from '../../common/abstractSynchronizer.js';\nimport { Change, IRemoteUserData, IResourcePreview as IBaseResourcePreview, IUserDataSyncConfiguration, IUserDataSyncStoreService, MergeState, SyncResource, SyncStatus, USER_DATA_SYNC_SCHEME, IUserData } from '../../common/userDataSync.js';\nimport { UserDataSyncClient, UserDataSyncTestServer } from './userDataSyncClient.js';\n\ninterface ITestResourcePreview extends IResourcePreview {\n\tref: string;\n}\n\nclass TestSynchroniser extends AbstractSynchroniser {\n\n\tsyncBarrier: Barrier = new Barrier();\n\tsyncResult: { hasConflicts: boolean; hasError: boolean } = { hasConflicts: false, hasError: false };\n\tonDoSyncCall: Emitter<void> = this._register(new Emitter<void>());\n\tfailWhenGettingLatestRemoteUserData: boolean = false;\n\n\tprotected readonly version: number = 1;\n\n\tprivate cancelled: boolean = false;\n\treadonly localResource = joinPath(this.environmentService.userRoamingDataHome, 'testResource.json');\n\n\tgetMachineId(): Promise<string> { return this.currentMachineIdPromise; }\n\tgetLastSyncResource(): URI { return this.lastSyncResource; }\n\n\tprotected override getLatestRemoteUserData(refOrLatestData: string | IUserData | null, lastSyncUserData: IRemoteUserData | null): Promise<IRemoteUserData> {\n\t\tif (this.failWhenGettingLatestRemoteUserData) {\n\t\t\tthrow new Error();\n\t\t}\n\t\treturn super.getLatestRemoteUserData(refOrLatestData, lastSyncUserData);\n\t}\n\n\tprotected override async doSync(remoteUserData: IRemoteUserData, lastSyncUserData: IRemoteUserData | null, strategy: SyncStrategy, userDataSyncConfiguration: IUserDataSyncConfiguration): Promise<SyncStatus> {\n\t\tthis.cancelled = false;\n\t\tthis.onDoSyncCall.fire();\n\t\tawait this.syncBarrier.wait();\n\n\t\tif (this.cancelled) {\n\t\t\treturn SyncStatus.Idle;\n\t\t}\n\n\t\treturn super.doSync(remoteUserData, lastSyncUserData, strategy, userDataSyncConfiguration);\n\t}\n\n\tprotected override async generateSyncPreview(remoteUserData: IRemoteUserData): Promise<ITestResourcePreview[]> {\n\t\tif (this.syncResult.hasError) {\n\t\t\tthrow new Error('failed');\n\t\t}\n\n\t\tlet fileContent = null;\n\t\ttry {\n\t\t\tfileContent = await this.fileService.readFile(this.localResource);\n\t\t} catch (error) { }\n\n\t\treturn [{\n\t\t\tbaseResource: this.localResource.with(({ scheme: USER_DATA_SYNC_SCHEME, authority: 'base' })),\n\t\t\tbaseContent: null,\n\t\t\tlocalResource: this.localResource,\n\t\t\tlocalContent: fileContent ? fileContent.value.toString() : null,\n\t\t\tremoteResource: this.localResource.with(({ scheme: USER_DATA_SYNC_SCHEME, authority: 'remote' })),\n\t\t\tremoteContent: remoteUserData.syncData ? remoteUserData.syncData.content : null,\n\t\t\tpreviewResource: this.localResource.with(({ scheme: USER_DATA_SYNC_SCHEME, authority: 'preview' })),\n\t\t\tref: remoteUserData.ref,\n\t\t\tlocalChange: Change.Modified,\n\t\t\tremoteChange: Change.Modified,\n\t\t\tacceptedResource: this.localResource.with(({ scheme: USER_DATA_SYNC_SCHEME, authority: 'accepted' })),\n\t\t}];\n\t}\n\n\tprotected async hasRemoteChanged(lastSyncUserData: IRemoteUserData): Promise<boolean> {\n\t\treturn true;\n\t}\n\n\tprotected async getMergeResult(resourcePreview: ITestResourcePreview, token: CancellationToken): Promise<IMergeResult> {\n\t\treturn {\n\t\t\tcontent: resourcePreview.ref,\n\t\t\tlocalChange: Change.Modified,\n\t\t\tremoteChange: Change.Modified,\n\t\t\thasConflicts: this.syncResult.hasConflicts,\n\t\t};\n\t}\n\n\tprotected async getAcceptResult(resourcePreview: ITestResourcePreview, resource: URI, content: string | null | undefined, token: CancellationToken): Promise<IAcceptResult> {\n\n\t\tif (isEqual(resource, resourcePreview.localResource)) {\n\t\t\treturn {\n\t\t\t\tcontent: resourcePreview.localContent,\n\t\t\t\tlocalChange: Change.None,\n\t\t\t\tremoteChange: resourcePreview.localContent === null ? Change.Deleted : Change.Modified,\n\t\t\t};\n\t\t}\n\n\t\tif (isEqual(resource, resourcePreview.remoteResource)) {\n\t\t\treturn {\n\t\t\t\tcontent: resourcePreview.remoteContent,\n\t\t\t\tlocalChange: resourcePreview.remoteContent === null ? Change.Deleted : Change.Modified,\n\t\t\t\tremoteChange: Change.None,\n\t\t\t};\n\t\t}\n\n\t\tif (isEqual(resource, resourcePreview.previewResource)) {\n\t\t\tif (content === undefined) {\n\t\t\t\treturn {\n\t\t\t\t\tcontent: resourcePreview.ref,\n\t\t\t\t\tlocalChange: Change.Modified,\n\t\t\t\t\tremoteChange: Change.Modified,\n\t\t\t\t};\n\t\t\t} else {\n\t\t\t\treturn {\n\t\t\t\t\tcontent,\n\t\t\t\t\tlocalChange: content === null ? resourcePreview.localContent !== null ? Change.Deleted : Change.None : Change.Modified,\n\t\t\t\t\tremoteChange: content === null ? resourcePreview.remoteContent !== null ? Change.Deleted : Change.None : Change.Modified,\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\n\t\tthrow new Error(`Invalid Resource: ${resource.toString()}`);\n\t}\n\n\tprotected async applyResult(remoteUserData: IRemoteUserData, lastSyncUserData: IRemoteUserData | null, resourcePreviews: [IResourcePreview, IAcceptResult][], force: boolean): Promise<void> {\n\t\tif (resourcePreviews[0][1].localChange === Change.Deleted) {\n\t\t\tawait this.fileService.del(this.localResource);\n\t\t}\n\n\t\tif (resourcePreviews[0][1].localChange === Change.Added || resourcePreviews[0][1].localChange === Change.Modified) {\n\t\t\tawait this.fileService.writeFile(this.localResource, VSBuffer.fromString(resourcePreviews[0][1].content!));\n\t\t}\n\n\t\tif (resourcePreviews[0][1].remoteChange === Change.Deleted) {\n\t\t\tawait this.applyRef(null, remoteUserData.ref);\n\t\t}\n\n\t\tif (resourcePreviews[0][1].remoteChange === Change.Added || resourcePreviews[0][1].remoteChange === Change.Modified) {\n\t\t\tawait this.applyRef(resourcePreviews[0][1].content, remoteUserData.ref);\n\t\t}\n\t}\n\n\tasync applyRef(content: string | null, ref: string): Promise<void> {\n\t\tconst remoteUserData = await this.updateRemoteUserData(content === null ? '' : content, ref);\n\t\tawait this.updateLastSyncUserData(remoteUserData);\n\t}\n\n\toverride async stop(): Promise<void> {\n\t\tthis.cancelled = true;\n\t\tthis.syncBarrier.open();\n\t\tsuper.stop();\n\t}\n\n\ttestTriggerLocalChange(): void {\n\t\tthis.triggerLocalChange();\n\t}\n\n\tonDidTriggerLocalChangeCall: Emitter<void> = this._register(new Emitter<void>());\n\tprotected override async doTriggerLocalChange(): Promise<void> {\n\t\tawait super.doTriggerLocalChange();\n\t\tthis.onDidTriggerLocalChangeCall.fire();\n\t}\n\n\thasLocalData(): Promise<boolean> { throw new Error('not implemented'); }\n\tasync resolveContent(uri: URI): Promise<string | null> { return null; }\n}\n\nsuite('TestSynchronizer - Auto Sync', () => {\n\n\tconst server = new UserDataSyncTestServer();\n\tlet client: UserDataSyncClient;\n\n\tteardown(async () => {\n\t\tawait client.instantiationService.get(IUserDataSyncStoreService).clear();\n\t});\n\n\tconst disposableStore = ensureNoDisposablesAreLeakedInTestSuite();\n\n\tsetup(async () => {\n\t\tclient = disposableStore.add(new UserDataSyncClient(server));\n\t\tawait client.setUp();\n\t});\n\n\ttest('status is syncing', async () => {\n\t\tawait runWithFakedTimers<void>({}, async () => {\n\t\t\tconst testObject: TestSynchroniser = disposableStore.add(client.instantiationService.createInstance(TestSynchroniser, { syncResource: SyncResource.Settings, profile: client.instantiationService.get(IUserDataProfilesService).defaultProfile }, undefined));\n\n\t\t\tconst actual: SyncStatus[] = [];\n\t\t\tdisposableStore.add(testObject.onDidChangeStatus(status => actual.push(status)));\n\n\t\t\tconst promise = Event.toPromise(testObject.onDoSyncCall.event);\n\n\t\t\ttestObject.sync(await client.getLatestRef(testObject.resource));\n\t\t\tawait promise;\n\n\t\t\tassert.deepStrictEqual(actual, [SyncStatus.Syncing]);\n\t\t\tassert.deepStrictEqual(testObject.status, SyncStatus.Syncing);\n\n\t\t\ttestObject.stop();\n\t\t});\n\t});\n\n\ttest('status is set correctly when sync is finished', async () => {\n\t\tawait runWithFakedTimers<void>({}, async () => {\n\t\t\tconst testObject: TestSynchroniser = disposableStore.add(client.instantiationService.createInstance(TestSynchroniser, { syncResource: SyncResource.Settings, profile: client.instantiationService.get(IUserDataProfilesService).defaultProfile }, undefined));\n\t\t\ttestObject.syncBarrier.open();\n\n\t\t\tconst actual: SyncStatus[] = [];\n\t\t\tdisposableStore.add(testObject.onDidChangeStatus(status => actual.push(status)));\n\t\t\tawait testObject.sync(await client.getLatestRef(testObject.resource));\n\n\t\t\tassert.deepStrictEqual(actual, [SyncStatus.Syncing, SyncStatus.Idle]);\n\t\t\tassert.deepStrictEqual(testObject.status, SyncStatus.Idle);\n\t\t});\n\t});\n\n\ttest('status is set correctly when sync has errors', async () => {\n\t\tawait runWithFakedTimers<void>({}, async () => {\n\t\t\tconst testObject: TestSynchroniser = disposableStore.add(client.instantiationService.createInstance(TestSynchroniser, { syncResource: SyncResource.Settings, profile: client.instantiationService.get(IUserDataProfilesService).defaultProfile }, undefined));\n\t\t\ttestObject.syncResult = { hasError: true, hasConflicts: false };\n\t\t\ttestObject.syncBarrier.open();\n\n\t\t\tconst actual: SyncStatus[] = [];\n\t\t\tdisposableStore.add(testObject.onDidChangeStatus(status => actual.push(status)));\n\n\t\t\ttry {\n\t\t\t\tawait testObject.sync(await client.getLatestRef(testObject.resource));\n\t\t\t\tassert.fail('Should fail');\n\t\t\t} catch (e) {\n\t\t\t\tassert.deepStrictEqual(actual, [SyncStatus.Syncing, SyncStatus.Idle]);\n\t\t\t\tassert.deepStrictEqual(testObject.status, SyncStatus.Idle);\n\t\t\t}\n\t\t});\n\t});\n\n\ttest('status is set to hasConflicts when asked to sync if there are conflicts', async () => {\n\t\tawait runWithFakedTimers<void>({}, async () => {\n\t\t\tconst testObject: TestSynchroniser = disposableStore.add(client.instantiationService.createInstance(TestSynchroniser, { syncResource: SyncResource.Settings, profile: client.instantiationService.get(IUserDataProfilesService).defaultProfile }, undefined));\n\t\t\ttestObject.syncResult = { hasConflicts: true, hasError: false };\n\t\t\ttestObject.syncBarrier.open();\n\n\t\t\tawait testObject.sync(await client.getLatestRef(testObject.resource));\n\n\t\t\tassert.deepStrictEqual(testObject.status, SyncStatus.HasConflicts);\n\t\t\tassertConflicts(testObject.conflicts.conflicts, [testObject.localResource]);\n\t\t});\n\t});\n\n\ttest('sync should not run if syncing already', async () => {\n\t\tawait runWithFakedTimers<void>({}, async () => {\n\t\t\tconst testObject: TestSynchroniser = disposableStore.add(client.instantiationService.createInstance(TestSynchroniser, { syncResource: SyncResource.Settings, profile: client.instantiationService.get(IUserDataProfilesService).defaultProfile }, undefined));\n\t\t\tconst promise = Event.toPromise(testObject.onDoSyncCall.event);\n\n\t\t\ttestObject.sync(await client.getLatestRef(testObject.resource));\n\t\t\tawait promise;\n\n\t\t\tconst actual: SyncStatus[] = [];\n\t\t\tdisposableStore.add(testObject.onDidChangeStatus(status => actual.push(status)));\n\t\t\tawait testObject.sync(await client.getLatestRef(testObject.resource));\n\n\t\t\tassert.deepStrictEqual(actual, []);\n\t\t\tassert.deepStrictEqual(testObject.status, SyncStatus.Syncing);\n\n\t\t\tawait testObject.stop();\n\t\t});\n\t});\n\n\ttest('sync should not run if there are conflicts', async () => {\n\t\tawait runWithFakedTimers<void>({}, async () => {\n\t\t\tconst testObject: TestSynchroniser = disposableStore.add(client.instantiationService.createInstance(TestSynchroniser, { syncResource: SyncResource.Settings, profile: client.instantiationService.get(IUserDataProfilesService).defaultProfile }, undefined));\n\t\t\ttestObject.syncResult = { hasConflicts: true, hasError: false };\n\t\t\ttestObject.syncBarrier.open();\n\t\t\tawait testObject.sync(await client.getLatestRef(testObject.resource));\n\n\t\t\tconst actual: SyncStatus[] = [];\n\t\t\tdisposableStore.add(testObject.onDidChangeStatus(status => actual.push(status)));\n\t\t\tawait testObject.sync(await client.getLatestRef(testObject.resource));\n\n\t\t\tassert.deepStrictEqual(actual, []);\n\t\t\tassert.deepStrictEqual(testObject.status, SyncStatus.HasConflicts);\n\t\t});\n\t});\n\n\ttest('accept preview during conflicts', async () => {\n\t\tawait runWithFakedTimers<void>({}, async () => {\n\t\t\tconst testObject: TestSynchroniser = disposableStore.add(client.instantiationService.createInstance(TestSynchroniser, { syncResource: SyncResource.Settings, profile: client.instantiationService.get(IUserDataProfilesService).defaultProfile }, undefined));\n\t\t\ttestObject.syncResult = { hasConflicts: true, hasError: false };\n\t\t\ttestObject.syncBarrier.open();\n\n\t\t\tawait testObject.sync(await client.getLatestRef(testObject.resource));\n\t\t\tassert.deepStrictEqual(testObject.status, SyncStatus.HasConflicts);\n\n\t\t\tawait testObject.accept(testObject.conflicts.conflicts[0].previewResource);\n\t\t\tassert.deepStrictEqual(testObject.status, SyncStatus.Syncing);\n\t\t\tassertConflicts(testObject.conflicts.conflicts, []);\n\n\t\t\tawait testObject.apply(false);\n\t\t\tassert.deepStrictEqual(testObject.status, SyncStatus.Idle);\n\t\t\tconst fileService = client.instantiationService.get(IFileService);\n\t\t\tassert.strictEqual((await testObject.getRemoteUserData(null)).syncData?.content, (await fileService.readFile(testObject.localResource)).value.toString());\n\t\t});\n\t});\n\n\ttest('accept remote during conflicts', async () => {\n\t\tawait runWithFakedTimers<void>({}, async () => {\n\t\t\tconst testObject: TestSynchroniser = disposableStore.add(client.instantiationService.createInstance(TestSynchroniser, { syncResource: SyncResource.Settings, profile: client.instantiationService.get(IUserDataProfilesService).defaultProfile }, undefined));\n\t\t\ttestObject.syncBarrier.open();\n\t\t\tawait testObject.sync(await client.getLatestRef(testObject.resource));\n\t\t\tconst fileService = client.instantiationService.get(IFileService);\n\t\t\tconst currentRemoteContent = (await testObject.getRemoteUserData(null)).syncData?.content;\n\t\t\tconst newLocalContent = 'conflict';\n\t\t\tawait fileService.writeFile(testObject.localResource, VSBuffer.fromString(newLocalContent));\n\n\t\t\ttestObject.syncResult = { hasConflicts: true, hasError: false };\n\t\t\tawait testObject.sync(await client.getLatestRef(testObject.resource));\n\t\t\tassert.deepStrictEqual(testObject.status, SyncStatus.HasConflicts);\n\n\t\t\tawait testObject.accept(testObject.conflicts.conflicts[0].remoteResource);\n\t\t\tassert.deepStrictEqual(testObject.status, SyncStatus.Syncing);\n\t\t\tassertConflicts(testObject.conflicts.conflicts, []);\n\n\t\t\tawait testObject.apply(false);\n\t\t\tassert.deepStrictEqual(testObject.status, SyncStatus.Idle);\n\t\t\tassert.strictEqual((await testObject.getRemoteUserData(null)).syncData?.content, currentRemoteContent);\n\t\t\tassert.strictEqual((await fileService.readFile(testObject.localResource)).value.toString(), currentRemoteContent);\n\t\t});\n\t});\n\n\ttest('accept local during conflicts', async () => {\n\t\tawait runWithFakedTimers<void>({}, async () => {\n\t\t\tconst testObject: TestSynchroniser = disposableStore.add(client.instantiationService.createInstance(TestSynchroniser, { syncResource: SyncResource.Settings, profile: client.instantiationService.get(IUserDataProfilesService).defaultProfile }, undefined));\n\t\t\ttestObject.syncBarrier.open();\n\t\t\tawait testObject.sync(await client.getLatestRef(testObject.resource));\n\t\t\tconst fileService = client.instantiationService.get(IFileService);\n\t\t\tconst newLocalContent = 'conflict';\n\t\t\tawait fileService.writeFile(testObject.localResource, VSBuffer.fromString(newLocalContent));\n\n\t\t\ttestObject.syncResult = { hasConflicts: true, hasError: false };\n\t\t\tawait testObject.sync(await client.getLatestRef(testObject.resource));\n\t\t\tassert.deepStrictEqual(testObject.status, SyncStatus.HasConflicts);\n\n\t\t\tawait testObject.accept(testObject.conflicts.conflicts[0].localResource);\n\t\t\tassert.deepStrictEqual(testObject.status, SyncStatus.Syncing);\n\t\t\tassertConflicts(testObject.conflicts.conflicts, []);\n\n\t\t\tawait testObject.apply(false);\n\t\t\tassert.deepStrictEqual(testObject.status, SyncStatus.Idle);\n\t\t\tassert.strictEqual((await testObject.getRemoteUserData(null)).syncData?.content, newLocalContent);\n\t\t\tassert.strictEqual((await fileService.readFile(testObject.localResource)).value.toString(), newLocalContent);\n\t\t});\n\t});\n\n\ttest('accept new content during conflicts', async () => {\n\t\tawait runWithFakedTimers<void>({}, async () => {\n\t\t\tconst testObject: TestSynchroniser = disposableStore.add(client.instantiationService.createInstance(TestSynchroniser, { syncResource: SyncResource.Settings, profile: client.instantiationService.get(IUserDataProfilesService).defaultProfile }, undefined));\n\t\t\ttestObject.syncBarrier.open();\n\t\t\tawait testObject.sync(await client.getLatestRef(testObject.resource));\n\t\t\tconst fileService = client.instantiationService.get(IFileService);\n\t\t\tconst newLocalContent = 'conflict';\n\t\t\tawait fileService.writeFile(testObject.localResource, VSBuffer.fromString(newLocalContent));\n\n\t\t\ttestObject.syncResult = { hasConflicts: true, hasError: false };\n\t\t\tawait testObject.sync(await client.getLatestRef(testObject.resource));\n\t\t\tassert.deepStrictEqual(testObject.status, SyncStatus.HasConflicts);\n\n\t\t\tconst mergeContent = 'newContent';\n\t\t\tawait testObject.accept(testObject.conflicts.conflicts[0].previewResource, mergeContent);\n\t\t\tassert.deepStrictEqual(testObject.status, SyncStatus.Syncing);\n\t\t\tassertConflicts(testObject.conflicts.conflicts, []);\n\n\t\t\tawait testObject.apply(false);\n\t\t\tassert.deepStrictEqual(testObject.status, SyncStatus.Idle);\n\t\t\tassert.strictEqual((await testObject.getRemoteUserData(null)).syncData?.content, mergeContent);\n\t\t\tassert.strictEqual((await fileService.readFile(testObject.localResource)).value.toString(), mergeContent);\n\t\t});\n\t});\n\n\ttest('accept delete during conflicts', async () => {\n\t\tawait runWithFakedTimers<void>({}, async () => {\n\t\t\tconst testObject: TestSynchroniser = disposableStore.add(client.instantiationService.createInstance(TestSynchroniser, { syncResource: SyncResource.Settings, profile: client.instantiationService.get(IUserDataProfilesService).defaultProfile }, undefined));\n\t\t\ttestObject.syncBarrier.open();\n\t\t\tawait testObject.sync(await client.getLatestRef(testObject.resource));\n\t\t\tconst fileService = client.instantiationService.get(IFileService);\n\t\t\tconst newLocalContent = 'conflict';\n\t\t\tawait fileService.writeFile(testObject.localResource, VSBuffer.fromString(newLocalContent));\n\n\t\t\ttestObject.syncResult = { hasConflicts: true, hasError: false };\n\t\t\tawait testObject.sync(await client.getLatestRef(testObject.resource));\n\t\t\tassert.deepStrictEqual(testObject.status, SyncStatus.HasConflicts);\n\n\t\t\tawait testObject.accept(testObject.conflicts.conflicts[0].previewResource, null);\n\t\t\tassert.deepStrictEqual(testObject.status, SyncStatus.Syncing);\n\t\t\tassertConflicts(testObject.conflicts.conflicts, []);\n\n\t\t\tawait testObject.apply(false);\n\t\t\tassert.deepStrictEqual(testObject.status, SyncStatus.Idle);\n\t\t\tassert.strictEqual((await testObject.getRemoteUserData(null)).syncData?.content, '');\n\t\t\tassert.ok(!(await fileService.exists(testObject.localResource)));\n\t\t});\n\t});\n\n\ttest('accept deleted local during conflicts', async () => {\n\t\tawait runWithFakedTimers<void>({}, async () => {\n\t\t\tconst testObject: TestSynchroniser = disposableStore.add(client.instantiationService.createInstance(TestSynchroniser, { syncResource: SyncResource.Settings, profile: client.instantiationService.get(IUserDataProfilesService).defaultProfile }, undefined));\n\t\t\ttestObject.syncBarrier.open();\n\t\t\tawait testObject.sync(await client.getLatestRef(testObject.resource));\n\t\t\tconst fileService = client.instantiationService.get(IFileService);\n\t\t\tawait fileService.del(testObject.localResource);\n\n\t\t\ttestObject.syncResult = { hasConflicts: true, hasError: false };\n\t\t\tawait testObject.sync(await client.getLatestRef(testObject.resource));\n\t\t\tassert.deepStrictEqual(testObject.status, SyncStatus.HasConflicts);\n\n\t\t\tawait testObject.accept(testObject.conflicts.conflicts[0].localResource);\n\t\t\tassert.deepStrictEqual(testObject.status, SyncStatus.Syncing);\n\t\t\tassertConflicts(testObject.conflicts.conflicts, []);\n\n\t\t\tawait testObject.apply(false);\n\t\t\tassert.deepStrictEqual(testObject.status, SyncStatus.Idle);\n\t\t\tassert.strictEqual((await testObject.getRemoteUserData(null)).syncData?.content, '');\n\t\t\tassert.ok(!(await fileService.exists(testObject.localResource)));\n\t\t});\n\t});\n\n\ttest('accept deleted remote during conflicts', async () => {\n\t\tawait runWithFakedTimers<void>({}, async () => {\n\t\t\tconst testObject: TestSynchroniser = disposableStore.add(client.instantiationService.createInstance(TestSynchroniser, { syncResource: SyncResource.Settings, profile: client.instantiationService.get(IUserDataProfilesService).defaultProfile }, undefined));\n\t\t\ttestObject.syncBarrier.open();\n\t\t\tconst fileService = client.instantiationService.get(IFileService);\n\t\t\tawait fileService.writeFile(testObject.localResource, VSBuffer.fromString('some content'));\n\t\t\ttestObject.syncResult = { hasConflicts: true, hasError: false };\n\n\t\t\tawait testObject.sync(await client.getLatestRef(testObject.resource));\n\t\t\tassert.deepStrictEqual(testObject.status, SyncStatus.HasConflicts);\n\n\t\t\tawait testObject.accept(testObject.conflicts.conflicts[0].remoteResource);\n\t\t\tassert.deepStrictEqual(testObject.status, SyncStatus.Syncing);\n\t\t\tassertConflicts(testObject.conflicts.conflicts, []);\n\n\t\t\tawait testObject.apply(false);\n\t\t\tassert.deepStrictEqual(testObject.status, SyncStatus.Idle);\n\t\t\tassert.strictEqual((await testObject.getRemoteUserData(null)).syncData, null);\n\t\t\tassert.ok(!(await fileService.exists(testObject.localResource)));\n\t\t});\n\t});\n\n\ttest('request latest data on precondition failure', async () => {\n\t\tawait runWithFakedTimers<void>({}, async () => {\n\t\t\tconst testObject: TestSynchroniser = disposableStore.add(client.instantiationService.createInstance(TestSynchroniser, { syncResource: SyncResource.Settings, profile: client.instantiationService.get(IUserDataProfilesService).defaultProfile }, undefined));\n\t\t\t// Sync once\n\t\t\ttestObject.syncBarrier.open();\n\t\t\tawait testObject.sync(await client.getLatestRef(testObject.resource));\n\t\t\ttestObject.syncBarrier = new Barrier();\n\n\t\t\t// update remote data before syncing so that 412 is thrown by server\n\t\t\tconst disposable = testObject.onDoSyncCall.event(async () => {\n\t\t\t\tdisposable.dispose();\n\t\t\t\tawait testObject.applyRef(ref, ref!);\n\t\t\t\tserver.reset();\n\t\t\t\ttestObject.syncBarrier.open();\n\t\t\t});\n\n\t\t\t// Start sycing\n\t\t\tconst ref = await client.getLatestRef(testObject.resource);\n\t\t\tawait testObject.sync(await client.getLatestRef(testObject.resource));\n\n\t\t\tassert.deepStrictEqual(server.requests, [\n\t\t\t\t{ type: 'POST', url: `${server.url}/v1/resource/${testObject.resource}`, headers: { 'If-Match': ref } },\n\t\t\t\t{ type: 'GET', url: `${server.url}/v1/resource/${testObject.resource}/latest`, headers: {} },\n\t\t\t\t{ type: 'POST', url: `${server.url}/v1/resource/${testObject.resource}`, headers: { 'If-Match': `${parseInt(ref!) + 1}` } },\n\t\t\t]);\n\t\t});\n\t});\n\n\ttest('no requests are made to server when local change is triggered', async () => {\n\t\tawait runWithFakedTimers<void>({}, async () => {\n\t\t\tconst testObject: TestSynchroniser = disposableStore.add(client.instantiationService.createInstance(TestSynchroniser, { syncResource: SyncResource.Settings, profile: client.instantiationService.get(IUserDataProfilesService).defaultProfile }, undefined));\n\t\t\ttestObject.syncBarrier.open();\n\t\t\tawait testObject.sync(await client.getLatestRef(testObject.resource));\n\n\t\t\tserver.reset();\n\t\t\tconst promise = Event.toPromise(testObject.onDidTriggerLocalChangeCall.event);\n\t\t\ttestObject.testTriggerLocalChange();\n\n\t\t\tawait promise;\n\t\t\tassert.deepStrictEqual(server.requests, []);\n\t\t});\n\t});\n\n\ttest('status is reset when getting latest remote data fails', async () => {\n\t\tawait runWithFakedTimers<void>({}, async () => {\n\t\t\tconst testObject: TestSynchroniser = disposableStore.add(client.instantiationService.createInstance(TestSynchroniser, { syncResource: SyncResource.Settings, profile: client.instantiationService.get(IUserDataProfilesService).defaultProfile }, undefined));\n\t\t\ttestObject.failWhenGettingLatestRemoteUserData = true;\n\n\t\t\ttry {\n\t\t\t\tawait testObject.sync(await client.getLatestRef(testObject.resource));\n\t\t\t\tassert.fail('Should throw an error');\n\t\t\t} catch (error) {\n\t\t\t}\n\n\t\t\tassert.strictEqual(testObject.status, SyncStatus.Idle);\n\t\t});\n\t});\n});\n\nsuite('TestSynchronizer - Manual Sync', () => {\n\n\tconst server = new UserDataSyncTestServer();\n\tlet client: UserDataSyncClient;\n\n\tteardown(async () => {\n\t\tawait client.instantiationService.get(IUserDataSyncStoreService).clear();\n\t});\n\n\tconst disposableStore = ensureNoDisposablesAreLeakedInTestSuite();\n\n\tsetup(async () => {\n\t\tclient = disposableStore.add(new UserDataSyncClient(server));\n\t\tawait client.setUp();\n\t});\n\n\ttest('preview', async () => {\n\t\tawait runWithFakedTimers<void>({}, async () => {\n\t\t\tconst testObject: TestSynchroniser = disposableStore.add(client.instantiationService.createInstance(TestSynchroniser, { syncResource: SyncResource.Settings, profile: client.instantiationService.get(IUserDataProfilesService).defaultProfile }, undefined));\n\t\t\ttestObject.syncResult = { hasConflicts: false, hasError: false };\n\t\t\ttestObject.syncBarrier.open();\n\n\t\t\tconst preview = await testObject.sync(await client.getLatestRef(testObject.resource), true);\n\n\t\t\tassert.deepStrictEqual(testObject.status, SyncStatus.Syncing);\n\t\t\tassertPreviews(preview!.resourcePreviews, [testObject.localResource]);\n\t\t\tassert.strictEqual(preview!.resourcePreviews[0].mergeState, MergeState.Accepted);\n\t\t\tassertConflicts(testObject.conflicts.conflicts, []);\n\t\t});\n\t});\n\n\ttest('preview -> accept', async () => {\n\t\tawait runWithFakedTimers<void>({}, async () => {\n\t\t\tconst testObject: TestSynchroniser = disposableStore.add(client.instantiationService.createInstance(TestSynchroniser, { syncResource: SyncResource.Settings, profile: client.instantiationService.get(IUserDataProfilesService).defaultProfile }, undefined));\n\t\t\ttestObject.syncResult = { hasConflicts: false, hasError: false };\n\t\t\ttestObject.syncBarrier.open();\n\n\t\t\tlet preview = await testObject.sync(await client.getLatestRef(testObject.resource), true);\n\t\t\tpreview = await testObject.accept(preview!.resourcePreviews[0].localResource);\n\n\t\t\tassert.deepStrictEqual(testObject.status, SyncStatus.Syncing);\n\t\t\tassertPreviews(preview!.resourcePreviews, [testObject.localResource]);\n\t\t\tassert.strictEqual(preview!.resourcePreviews[0].mergeState, MergeState.Accepted);\n\t\t\tassertConflicts(testObject.conflicts.conflicts, []);\n\t\t});\n\t});\n\n\ttest('preview -> merge -> apply', async () => {\n\t\tawait runWithFakedTimers<void>({}, async () => {\n\t\t\tconst testObject: TestSynchroniser = disposableStore.add(client.instantiationService.createInstance(TestSynchroniser, { syncResource: SyncResource.Settings, profile: client.instantiationService.get(IUserDataProfilesService).defaultProfile }, undefined));\n\t\t\ttestObject.syncResult = { hasConflicts: false, hasError: false };\n\t\t\ttestObject.syncBarrier.open();\n\t\t\tawait testObject.sync(await client.getLatestRef(testObject.resource));\n\n\t\t\tconst ref = await client.getLatestRef(testObject.resource);\n\t\t\tlet preview = await testObject.sync(ref, true);\n\t\t\tpreview = await testObject.apply(false);\n\n\t\t\tassert.deepStrictEqual(testObject.status, SyncStatus.Idle);\n\t\t\tassert.strictEqual(preview, null);\n\t\t\tassertConflicts(testObject.conflicts.conflicts, []);\n\n\t\t\tassert.strictEqual((await testObject.getRemoteUserData(null)).syncData?.content, ref);\n\t\t\tassert.strictEqual((await client.instantiationService.get(IFileService).readFile(testObject.localResource)).value.toString(), ref);\n\t\t});\n\t});\n\n\ttest('preview -> accept -> apply', async () => {\n\t\tawait runWithFakedTimers<void>({}, async () => {\n\t\t\tconst testObject: TestSynchroniser = disposableStore.add(client.instantiationService.createInstance(TestSynchroniser, { syncResource: SyncResource.Settings, profile: client.instantiationService.get(IUserDataProfilesService).defaultProfile }, undefined));\n\t\t\ttestObject.syncResult = { hasConflicts: false, hasError: false };\n\t\t\ttestObject.syncBarrier.open();\n\t\t\tawait testObject.sync(await client.getLatestRef(testObject.resource));\n\n\t\t\tconst ref = await client.getLatestRef(testObject.resource);\n\t\t\tlet preview = await testObject.sync(ref, true);\n\t\t\tpreview = await testObject.accept(preview!.resourcePreviews[0].previewResource);\n\t\t\tpreview = await testObject.apply(false);\n\n\t\t\tassert.deepStrictEqual(testObject.status, SyncStatus.Idle);\n\t\t\tassert.strictEqual(preview, null);\n\t\t\tassertConflicts(testObject.conflicts.conflicts, []);\n\n\t\t\tassert.strictEqual((await testObject.getRemoteUserData(null)).syncData?.content, ref);\n\t\t\tassert.strictEqual((await client.instantiationService.get(IFileService).readFile(testObject.localResource)).value.toString(), ref);\n\t\t});\n\t});\n\n\ttest('preivew -> discard', async () => {\n\t\tawait runWithFakedTimers<void>({}, async () => {\n\t\t\tconst testObject: TestSynchroniser = disposableStore.add(client.instantiationService.createInstance(TestSynchroniser, { syncResource: SyncResource.Settings, profile: client.instantiationService.get(IUserDataProfilesService).defaultProfile }, undefined));\n\t\t\ttestObject.syncResult = { hasConflicts: false, hasError: false };\n\t\t\ttestObject.syncBarrier.open();\n\n\t\t\tlet preview = await testObject.sync(await client.getLatestRef(testObject.resource), true);\n\t\t\tpreview = await testObject.discard(preview!.resourcePreviews[0].previewResource);\n\n\t\t\tassert.deepStrictEqual(testObject.status, SyncStatus.Syncing);\n\t\t\tassertPreviews(preview!.resourcePreviews, [testObject.localResource]);\n\t\t\tassert.strictEqual(preview!.resourcePreviews[0].mergeState, MergeState.Preview);\n\t\t\tassertConflicts(testObject.conflicts.conflicts, []);\n\t\t});\n\t});\n\n\ttest('preivew -> discard -> accept', async () => {\n\t\tawait runWithFakedTimers<void>({}, async () => {\n\t\t\tconst testObject: TestSynchroniser = disposableStore.add(client.instantiationService.createInstance(TestSynchroniser, { syncResource: SyncResource.Settings, profile: client.instantiationService.get(IUserDataProfilesService).defaultProfile }, undefined));\n\t\t\ttestObject.syncResult = { hasConflicts: false, hasError: false };\n\t\t\ttestObject.syncBarrier.open();\n\n\t\t\tlet preview = await testObject.sync(await client.getLatestRef(testObject.resource), true);\n\t\t\tpreview = await testObject.discard(preview!.resourcePreviews[0].previewResource);\n\t\t\tpreview = await testObject.accept(preview!.resourcePreviews[0].remoteResource);\n\n\t\t\tassert.deepStrictEqual(testObject.status, SyncStatus.Syncing);\n\t\t\tassertPreviews(preview!.resourcePreviews, [testObject.localResource]);\n\t\t\tassert.strictEqual(preview!.resourcePreviews[0].mergeState, MergeState.Accepted);\n\t\t\tassertConflicts(testObject.conflicts.conflicts, []);\n\t\t});\n\t});\n\n\ttest('preivew -> accept -> discard -> accept', async () => {\n\t\tawait runWithFakedTimers<void>({}, async () => {\n\t\t\tconst testObject: TestSynchroniser = disposableStore.add(client.instantiationService.createInstance(TestSynchroniser, { syncResource: SyncResource.Settings, profile: client.instantiationService.get(IUserDataProfilesService).defaultProfile }, undefined));\n\t\t\ttestObject.syncResult = { hasConflicts: false, hasError: false };\n\t\t\ttestObject.syncBarrier.open();\n\n\t\t\tlet preview = await testObject.sync(await client.getLatestRef(testObject.resource), true);\n\t\t\tpreview = await testObject.accept(preview!.resourcePreviews[0].previewResource);\n\t\t\tpreview = await testObject.discard(preview!.resourcePreviews[0].previewResource);\n\t\t\tpreview = await testObject.accept(preview!.resourcePreviews[0].remoteResource);\n\n\t\t\tassert.deepStrictEqual(testObject.status, SyncStatus.Syncing);\n\t\t\tassertPreviews(preview!.resourcePreviews, [testObject.localResource]);\n\t\t\tassert.strictEqual(preview!.resourcePreviews[0].mergeState, MergeState.Accepted);\n\t\t\tassertConflicts(testObject.conflicts.conflicts, []);\n\t\t});\n\t});\n\n\ttest('preivew -> accept -> discard', async () => {\n\t\tawait runWithFakedTimers<void>({}, async () => {\n\t\t\tconst testObject: TestSynchroniser = disposableStore.add(client.instantiationService.createInstance(TestSynchroniser, { syncResource: SyncResource.Settings, profile: client.instantiationService.get(IUserDataProfilesService).defaultProfile }, undefined));\n\t\t\ttestObject.syncResult = { hasConflicts: false, hasError: false };\n\t\t\ttestObject.syncBarrier.open();\n\n\t\t\tlet preview = await testObject.sync(await client.getLatestRef(testObject.resource), true);\n\t\t\tpreview = await testObject.accept(preview!.resourcePreviews[0].remoteResource);\n\t\t\tpreview = await testObject.discard(preview!.resourcePreviews[0].previewResource);\n\n\t\t\tassert.deepStrictEqual(testObject.status, SyncStatus.Syncing);\n\t\t\tassertPreviews(preview!.resourcePreviews, [testObject.localResource]);\n\t\t\tassert.strictEqual(preview!.resourcePreviews[0].mergeState, MergeState.Preview);\n\t\t\tassertConflicts(testObject.conflicts.conflicts, []);\n\t\t});\n\t});\n\n\ttest('preivew -> discard -> accept -> apply', async () => {\n\t\tawait runWithFakedTimers<void>({}, async () => {\n\t\t\tconst testObject: TestSynchroniser = disposableStore.add(client.instantiationService.createInstance(TestSynchroniser, { syncResource: SyncResource.Settings, profile: client.instantiationService.get(IUserDataProfilesService).defaultProfile }, undefined));\n\t\t\ttestObject.syncResult = { hasConflicts: false, hasError: false };\n\t\t\ttestObject.syncBarrier.open();\n\t\t\tawait testObject.sync(await client.getLatestRef(testObject.resource));\n\n\t\t\tconst expectedContent = (await client.instantiationService.get(IFileService).readFile(testObject.localResource)).value.toString();\n\t\t\tlet preview = await testObject.sync(await client.getLatestRef(testObject.resource), true);\n\t\t\tpreview = await testObject.accept(preview!.resourcePreviews[0].remoteResource);\n\t\t\tpreview = await testObject.discard(preview!.resourcePreviews[0].previewResource);\n\t\t\tpreview = await testObject.accept(preview!.resourcePreviews[0].localResource);\n\t\t\tpreview = await testObject.apply(false);\n\n\t\t\tassert.deepStrictEqual(testObject.status, SyncStatus.Idle);\n\t\t\tassert.strictEqual(preview, null);\n\t\t\tassertConflicts(testObject.conflicts.conflicts, []);\n\t\t\tassert.strictEqual((await testObject.getRemoteUserData(null)).syncData?.content, expectedContent);\n\t\t\tassert.strictEqual((await client.instantiationService.get(IFileService).readFile(testObject.localResource)).value.toString(), expectedContent);\n\t\t});\n\t});\n\n\ttest('conflicts: preview', async () => {\n\t\tawait runWithFakedTimers<void>({}, async () => {\n\t\t\tconst testObject: TestSynchroniser = disposableStore.add(client.instantiationService.createInstance(TestSynchroniser, { syncResource: SyncResource.Settings, profile: client.instantiationService.get(IUserDataProfilesService).defaultProfile }, undefined));\n\t\t\ttestObject.syncResult = { hasConflicts: true, hasError: false };\n\t\t\ttestObject.syncBarrier.open();\n\n\t\t\tconst preview = await testObject.sync(await client.getLatestRef(testObject.resource), true);\n\n\t\t\tassert.deepStrictEqual(testObject.status, SyncStatus.HasConflicts);\n\t\t\tassertPreviews(preview!.resourcePreviews, [testObject.localResource]);\n\t\t\tassert.strictEqual(preview!.resourcePreviews[0].mergeState, MergeState.Conflict);\n\t\t\tassertConflicts(testObject.conflicts.conflicts, [preview!.resourcePreviews[0].localResource]);\n\t\t});\n\t});\n\n\ttest('conflicts: preview -> discard', async () => {\n\t\tawait runWithFakedTimers<void>({}, async () => {\n\t\t\tconst testObject: TestSynchroniser = disposableStore.add(client.instantiationService.createInstance(TestSynchroniser, { syncResource: SyncResource.Settings, profile: client.instantiationService.get(IUserDataProfilesService).defaultProfile }, undefined));\n\t\t\ttestObject.syncResult = { hasConflicts: true, hasError: false };\n\t\t\ttestObject.syncBarrier.open();\n\n\t\t\tconst preview = await testObject.sync(await client.getLatestRef(testObject.resource), true);\n\t\t\tawait testObject.discard(preview!.resourcePreviews[0].previewResource);\n\n\t\t\tassert.deepStrictEqual(testObject.status, SyncStatus.Syncing);\n\t\t\tassertPreviews(preview!.resourcePreviews, [testObject.localResource]);\n\t\t\tassert.strictEqual(preview!.resourcePreviews[0].mergeState, MergeState.Preview);\n\t\t\tassertConflicts(testObject.conflicts.conflicts, []);\n\t\t});\n\t});\n\n\ttest('conflicts: preview -> accept', async () => {\n\t\tawait runWithFakedTimers<void>({}, async () => {\n\t\t\tconst testObject: TestSynchroniser = disposableStore.add(client.instantiationService.createInstance(TestSynchroniser, { syncResource: SyncResource.Settings, profile: client.instantiationService.get(IUserDataProfilesService).defaultProfile }, undefined));\n\t\t\ttestObject.syncResult = { hasConflicts: true, hasError: false };\n\t\t\ttestObject.syncBarrier.open();\n\n\t\t\tlet preview = await testObject.sync(await client.getLatestRef(testObject.resource), true);\n\t\t\tconst content = await testObject.resolveContent(preview!.resourcePreviews[0].previewResource);\n\t\t\tpreview = await testObject.accept(preview!.resourcePreviews[0].previewResource, content);\n\n\t\t\tassert.deepStrictEqual(testObject.status, SyncStatus.Syncing);\n\t\t\tassertPreviews(preview!.resourcePreviews, [testObject.localResource]);\n\t\t\tassert.deepStrictEqual(testObject.conflicts.conflicts, []);\n\t\t});\n\t});\n\n\ttest('conflicts: preview -> accept 2', async () => {\n\t\tawait runWithFakedTimers<void>({}, async () => {\n\t\t\tconst testObject: TestSynchroniser = disposableStore.add(client.instantiationService.createInstance(TestSynchroniser, { syncResource: SyncResource.Settings, profile: client.instantiationService.get(IUserDataProfilesService).defaultProfile }, undefined));\n\t\t\ttestObject.syncResult = { hasConflicts: true, hasError: false };\n\t\t\ttestObject.syncBarrier.open();\n\n\t\t\tlet preview = await testObject.sync(await client.getLatestRef(testObject.resource), true);\n\t\t\tconst content = await testObject.resolveContent(preview!.resourcePreviews[0].previewResource);\n\t\t\tpreview = await testObject.accept(preview!.resourcePreviews[0].previewResource, content);\n\n\t\t\tassert.deepStrictEqual(testObject.status, SyncStatus.Syncing);\n\t\t\tassertPreviews(preview!.resourcePreviews, [testObject.localResource]);\n\t\t\tassertConflicts(testObject.conflicts.conflicts, []);\n\t\t});\n\t});\n\n\ttest('conflicts: preview -> accept -> apply', async () => {\n\t\tawait runWithFakedTimers<void>({}, async () => {\n\t\t\tconst testObject: TestSynchroniser = disposableStore.add(client.instantiationService.createInstance(TestSynchroniser, { syncResource: SyncResource.Settings, profile: client.instantiationService.get(IUserDataProfilesService).defaultProfile }, undefined));\n\t\t\ttestObject.syncResult = { hasConflicts: false, hasError: false };\n\t\t\ttestObject.syncBarrier.open();\n\t\t\tawait testObject.sync(await client.getLatestRef(testObject.resource));\n\n\t\t\ttestObject.syncResult = { hasConflicts: true, hasError: false };\n\t\t\tconst ref = await client.getLatestRef(testObject.resource);\n\t\t\tlet preview = await testObject.sync(ref, true);\n\n\t\t\tpreview = await testObject.accept(preview!.resourcePreviews[0].previewResource);\n\t\t\tpreview = await testObject.apply(false);\n\n\t\t\tassert.deepStrictEqual(testObject.status, SyncStatus.Idle);\n\t\t\tassert.strictEqual(preview, null);\n\t\t\tassertConflicts(testObject.conflicts.conflicts, []);\n\n\t\t\tassert.strictEqual((await testObject.getRemoteUserData(null)).syncData?.content, ref);\n\t\t\tassert.strictEqual((await client.instantiationService.get(IFileService).readFile(testObject.localResource)).value.toString(), ref);\n\t\t});\n\t});\n\n\ttest('conflicts: preivew -> discard', async () => {\n\t\tawait runWithFakedTimers<void>({}, async () => {\n\t\t\tconst testObject: TestSynchroniser = disposableStore.add(client.instantiationService.createInstance(TestSynchroniser, { syncResource: SyncResource.Settings, profile: client.instantiationService.get(IUserDataProfilesService).defaultProfile }, undefined));\n\t\t\ttestObject.syncResult = { hasConflicts: true, hasError: false };\n\t\t\ttestObject.syncBarrier.open();\n\n\t\t\tlet preview = await testObject.sync(await client.getLatestRef(testObject.resource), true);\n\t\t\tpreview = await testObject.discard(preview!.resourcePreviews[0].previewResource);\n\n\t\t\tassert.deepStrictEqual(testObject.status, SyncStatus.Syncing);\n\t\t\tassertPreviews(preview!.resourcePreviews, [testObject.localResource]);\n\t\t\tassert.strictEqual(preview!.resourcePreviews[0].mergeState, MergeState.Preview);\n\t\t\tassertConflicts(testObject.conflicts.conflicts, []);\n\t\t});\n\t});\n\n\ttest('conflicts: preivew -> discard -> accept', async () => {\n\t\tawait runWithFakedTimers<void>({}, async () => {\n\t\t\tconst testObject: TestSynchroniser = disposableStore.add(client.instantiationService.createInstance(TestSynchroniser, { syncResource: SyncResource.Settings, profile: client.instantiationService.get(IUserDataProfilesService).defaultProfile }, undefined));\n\t\t\ttestObject.syncResult = { hasConflicts: true, hasError: false };\n\t\t\ttestObject.syncBarrier.open();\n\n\t\t\tlet preview = await testObject.sync(await client.getLatestRef(testObject.resource), true);\n\t\t\tpreview = await testObject.discard(preview!.resourcePreviews[0].previewResource);\n\t\t\tpreview = await testObject.accept(preview!.resourcePreviews[0].remoteResource);\n\n\t\t\tassert.deepStrictEqual(testObject.status, SyncStatus.Syncing);\n\t\t\tassertPreviews(preview!.resourcePreviews, [testObject.localResource]);\n\t\t\tassert.strictEqual(preview!.resourcePreviews[0].mergeState, MergeState.Accepted);\n\t\t\tassertConflicts(testObject.conflicts.conflicts, []);\n\t\t});\n\t});\n\n\ttest('conflicts: preivew -> accept -> discard -> accept', async () => {\n\t\tawait runWithFakedTimers<void>({}, async () => {\n\t\t\tconst testObject: TestSynchroniser = disposableStore.add(client.instantiationService.createInstance(TestSynchroniser, { syncResource: SyncResource.Settings, profile: client.instantiationService.get(IUserDataProfilesService).defaultProfile }, undefined));\n\t\t\ttestObject.syncResult = { hasConflicts: true, hasError: false };\n\t\t\ttestObject.syncBarrier.open();\n\n\t\t\tlet preview = await testObject.sync(await client.getLatestRef(testObject.resource), true);\n\t\t\tpreview = await testObject.accept(preview!.resourcePreviews[0].previewResource);\n\t\t\tpreview = await testObject.discard(preview!.resourcePreviews[0].previewResource);\n\t\t\tpreview = await testObject.accept(preview!.resourcePreviews[0].remoteResource);\n\n\t\t\tassert.deepStrictEqual(testObject.status, SyncStatus.Syncing);\n\t\t\tassertPreviews(preview!.resourcePreviews, [testObject.localResource]);\n\t\t\tassert.strictEqual(preview!.resourcePreviews[0].mergeState, MergeState.Accepted);\n\t\t\tassertConflicts(testObject.conflicts.conflicts, []);\n\t\t});\n\t});\n\n\ttest('conflicts: preivew -> accept -> discard', async () => {\n\t\tawait runWithFakedTimers<void>({}, async () => {\n\t\t\tconst testObject: TestSynchroniser = disposableStore.add(client.instantiationService.createInstance(TestSynchroniser, { syncResource: SyncResource.Settings, profile: client.instantiationService.get(IUserDataProfilesService).defaultProfile }, undefined));\n\t\t\ttestObject.syncResult = { hasConflicts: false, hasError: false };\n\t\t\ttestObject.syncBarrier.open();\n\n\t\t\tlet preview = await testObject.sync(await client.getLatestRef(testObject.resource), true);\n\t\t\tpreview = await testObject.accept(preview!.resourcePreviews[0].remoteResource);\n\t\t\tpreview = await testObject.discard(preview!.resourcePreviews[0].previewResource);\n\n\t\t\tassert.deepStrictEqual(testObject.status, SyncStatus.Syncing);\n\t\t\tassertPreviews(preview!.resourcePreviews, [testObject.localResource]);\n\t\t\tassert.strictEqual(preview!.resourcePreviews[0].mergeState, MergeState.Preview);\n\t\t\tassertConflicts(testObject.conflicts.conflicts, []);\n\t\t});\n\t});\n\n\ttest('conflicts: preivew -> discard -> accept -> apply', async () => {\n\t\tawait runWithFakedTimers<void>({}, async () => {\n\t\t\tconst testObject: TestSynchroniser = disposableStore.add(client.instantiationService.createInstance(TestSynchroniser, { syncResource: SyncResource.Settings, profile: client.instantiationService.get(IUserDataProfilesService).defaultProfile }, undefined));\n\t\t\ttestObject.syncResult = { hasConflicts: false, hasError: false };\n\t\t\ttestObject.syncBarrier.open();\n\t\t\tawait testObject.sync(await client.getLatestRef(testObject.resource));\n\n\t\t\tconst expectedContent = (await client.instantiationService.get(IFileService).readFile(testObject.localResource)).value.toString();\n\t\t\tlet preview = await testObject.sync(await client.getLatestRef(testObject.resource), true);\n\t\t\tpreview = await testObject.discard(preview!.resourcePreviews[0].previewResource);\n\t\t\tpreview = await testObject.accept(preview!.resourcePreviews[0].localResource);\n\t\t\tpreview = await testObject.apply(false);\n\n\t\t\tassert.deepStrictEqual(testObject.status, SyncStatus.Idle);\n\t\t\tassert.strictEqual(preview, null);\n\t\t\tassertConflicts(testObject.conflicts.conflicts, []);\n\t\t\tassert.strictEqual((await testObject.getRemoteUserData(null)).syncData?.content, expectedContent);\n\t\t\tassert.strictEqual((await client.instantiationService.get(IFileService).readFile(testObject.localResource)).value.toString(), expectedContent);\n\t\t});\n\t});\n\n\ttest('conflicts: preivew -> accept -> discard -> accept -> apply', async () => {\n\t\tawait runWithFakedTimers<void>({}, async () => {\n\t\t\tconst testObject: TestSynchroniser = disposableStore.add(client.instantiationService.createInstance(TestSynchroniser, { syncResource: SyncResource.Settings, profile: client.instantiationService.get(IUserDataProfilesService).defaultProfile }, undefined));\n\t\t\ttestObject.syncResult = { hasConflicts: false, hasError: false };\n\t\t\ttestObject.syncBarrier.open();\n\t\t\tawait testObject.sync(await client.getLatestRef(testObject.resource));\n\n\t\t\tconst expectedContent = (await client.instantiationService.get(IFileService).readFile(testObject.localResource)).value.toString();\n\t\t\tlet preview = await testObject.sync(await client.getLatestRef(testObject.resource), true);\n\t\t\tpreview = await testObject.accept(preview!.resourcePreviews[0].remoteResource);\n\t\t\tpreview = await testObject.discard(preview!.resourcePreviews[0].previewResource);\n\t\t\tpreview = await testObject.accept(preview!.resourcePreviews[0].localResource);\n\t\t\tpreview = await testObject.apply(false);\n\n\t\t\tassert.deepStrictEqual(testObject.status, SyncStatus.Idle);\n\t\t\tassert.strictEqual(preview, null);\n\t\t\tassertConflicts(testObject.conflicts.conflicts, []);\n\t\t\tassert.strictEqual((await testObject.getRemoteUserData(null)).syncData?.content, expectedContent);\n\t\t\tassert.strictEqual((await client.instantiationService.get(IFileService).readFile(testObject.localResource)).value.toString(), expectedContent);\n\t\t});\n\t});\n\n\ttest('remote is accepted if last sync state does not exists in server', async () => {\n\t\tawait runWithFakedTimers<void>({}, async () => {\n\t\t\tconst fileService = client.instantiationService.get(IFileService);\n\t\t\tconst testObject: TestSynchroniser = disposableStore.add(client.instantiationService.createInstance(TestSynchroniser, { syncResource: SyncResource.Settings, profile: client.instantiationService.get(IUserDataProfilesService).defaultProfile }, undefined));\n\t\t\ttestObject.syncBarrier.open();\n\n\t\t\tawait testObject.sync(await client.getLatestRef(testObject.resource));\n\n\t\t\tconst client2 = disposableStore.add(new UserDataSyncClient(server));\n\t\t\tawait client2.setUp();\n\t\t\tconst synchronizer2: TestSynchroniser = disposableStore.add(client2.instantiationService.createInstance(TestSynchroniser, { syncResource: SyncResource.Settings, profile: client2.instantiationService.get(IUserDataProfilesService).defaultProfile }, undefined));\n\t\t\tsynchronizer2.syncBarrier.open();\n\t\t\tconst ref = await client2.getLatestRef(testObject.resource);\n\t\t\tawait synchronizer2.sync(ref);\n\n\t\t\tawait fileService.del(testObject.getLastSyncResource());\n\t\t\tawait testObject.sync(await client.getLatestRef(testObject.resource));\n\n\t\t\tassert.deepStrictEqual(testObject.status, SyncStatus.Idle);\n\t\t\tassert.strictEqual((await client.instantiationService.get(IFileService).readFile(testObject.localResource)).value.toString(), ref);\n\t\t});\n\t});\n\n});\n\nsuite('TestSynchronizer - Last Sync Data', () => {\n\tconst server = new UserDataSyncTestServer();\n\tlet client: UserDataSyncClient;\n\n\tteardown(async () => {\n\t\tawait client.instantiationService.get(IUserDataSyncStoreService).clear();\n\t});\n\n\tconst disposableStore = ensureNoDisposablesAreLeakedInTestSuite();\n\n\tsetup(async () => {\n\t\tclient = disposableStore.add(new UserDataSyncClient(server));\n\t\tawait client.setUp();\n\t});\n\n\ttest('last sync data is null when not synced before', async () => {\n\t\tawait runWithFakedTimers<void>({}, async () => {\n\t\t\tconst testObject: TestSynchroniser = disposableStore.add(client.instantiationService.createInstance(TestSynchroniser, { syncResource: SyncResource.Settings, profile: client.instantiationService.get(IUserDataProfilesService).defaultProfile }, undefined));\n\n\t\t\tconst actual = await testObject.getLastSyncUserData();\n\n\t\t\tassert.strictEqual(actual, null);\n\t\t});\n\t});\n\n\ttest('last sync data is set after sync', async () => {\n\t\tawait runWithFakedTimers<void>({}, async () => {\n\t\t\tconst storageService = client.instantiationService.get(IStorageService);\n\t\t\tconst fileService = client.instantiationService.get(IFileService);\n\t\t\tconst testObject: TestSynchroniser = disposableStore.add(client.instantiationService.createInstance(TestSynchroniser, { syncResource: SyncResource.Settings, profile: client.instantiationService.get(IUserDataProfilesService).defaultProfile }, undefined));\n\t\t\ttestObject.syncBarrier.open();\n\n\t\t\tawait testObject.sync(await client.getLatestRef(testObject.resource));\n\t\t\tconst machineId = await testObject.getMachineId();\n\t\t\tconst actual = await testObject.getLastSyncUserData();\n\n\t\t\tassert.deepStrictEqual(storageService.get('settings.lastSyncUserData', StorageScope.APPLICATION), JSON.stringify({ ref: '1' }));\n\t\t\tassert.deepStrictEqual(JSON.parse((await fileService.readFile(testObject.getLastSyncResource())).value.toString()), { ref: '1', syncData: { version: 1, machineId, content: '0' } });\n\t\t\tassert.deepStrictEqual(actual, {\n\t\t\t\tref: '1',\n\t\t\t\tsyncData: {\n\t\t\t\t\tcontent: '0',\n\t\t\t\t\tmachineId,\n\t\t\t\t\tversion: 1\n\t\t\t\t},\n\t\t\t});\n\t\t});\n\t});\n\n\ttest('last sync data is read from server after sync if last sync resource is deleted', async () => {\n\t\tawait runWithFakedTimers<void>({}, async () => {\n\t\t\tconst storageService = client.instantiationService.get(IStorageService);\n\t\t\tconst fileService = client.instantiationService.get(IFileService);\n\t\t\tconst testObject: TestSynchroniser = disposableStore.add(client.instantiationService.createInstance(TestSynchroniser, { syncResource: SyncResource.Settings, profile: client.instantiationService.get(IUserDataProfilesService).defaultProfile }, undefined));\n\t\t\ttestObject.syncBarrier.open();\n\n\t\t\tawait testObject.sync(await client.getLatestRef(testObject.resource));\n\t\t\tconst machineId = await testObject.getMachineId();\n\t\t\tawait fileService.del(testObject.getLastSyncResource());\n\t\t\tconst actual = await testObject.getLastSyncUserData();\n\n\t\t\tassert.deepStrictEqual(storageService.get('settings.lastSyncUserData', StorageScope.APPLICATION), JSON.stringify({ ref: '1' }));\n\t\t\tassert.deepStrictEqual(actual, {\n\t\t\t\tref: '1',\n\t\t\t\tsyncData: {\n\t\t\t\t\tcontent: '0',\n\t\t\t\t\tmachineId,\n\t\t\t\t\tversion: 1\n\t\t\t\t},\n\t\t\t});\n\t\t});\n\t});\n\n\ttest('last sync data is read from server after sync and sync data is invalid', async () => {\n\t\tawait runWithFakedTimers<void>({}, async () => {\n\t\t\tconst storageService = client.instantiationService.get(IStorageService);\n\t\t\tconst fileService = client.instantiationService.get(IFileService);\n\t\t\tconst testObject: TestSynchroniser = disposableStore.add(client.instantiationService.createInstance(TestSynchroniser, { syncResource: SyncResource.Settings, profile: client.instantiationService.get(IUserDataProfilesService).defaultProfile }, undefined));\n\t\t\ttestObject.syncBarrier.open();\n\n\t\t\tawait testObject.sync(await client.getLatestRef(testObject.resource));\n\t\t\tconst machineId = await testObject.getMachineId();\n\t\t\tawait fileService.writeFile(testObject.getLastSyncResource(), VSBuffer.fromString(JSON.stringify({\n\t\t\t\tref: '1',\n\t\t\t\tversion: 1,\n\t\t\t\tcontent: JSON.stringify({\n\t\t\t\t\tcontent: '0',\n\t\t\t\t\tmachineId,\n\t\t\t\t\tversion: 1\n\t\t\t\t}),\n\t\t\t\tadditionalData: {\n\t\t\t\t\tfoo: 'bar'\n\t\t\t\t}\n\t\t\t})));\n\t\t\tserver.reset();\n\t\t\tconst actual = await testObject.getLastSyncUserData();\n\n\t\t\tassert.deepStrictEqual(storageService.get('settings.lastSyncUserData', StorageScope.APPLICATION), JSON.stringify({ ref: '1' }));\n\t\t\tassert.deepStrictEqual(actual, {\n\t\t\t\tref: '1',\n\t\t\t\tsyncData: {\n\t\t\t\t\tcontent: '0',\n\t\t\t\t\tmachineId,\n\t\t\t\t\tversion: 1\n\t\t\t\t},\n\t\t\t});\n\t\t\tassert.deepStrictEqual(server.requests, [{ headers: {}, type: 'GET', url: 'http://host:3000/v1/resource/settings/1' }]);\n\t\t});\n\t});\n\n\ttest('last sync data is read from server after sync and stored sync data is tampered', async () => {\n\t\tawait runWithFakedTimers<void>({}, async () => {\n\t\t\tconst storageService = client.instantiationService.get(IStorageService);\n\t\t\tconst fileService = client.instantiationService.get(IFileService);\n\t\t\tconst testObject: TestSynchroniser = disposableStore.add(client.instantiationService.createInstance(TestSynchroniser, { syncResource: SyncResource.Settings, profile: client.instantiationService.get(IUserDataProfilesService).defaultProfile }, undefined));\n\t\t\ttestObject.syncBarrier.open();\n\n\t\t\tawait testObject.sync(await client.getLatestRef(testObject.resource));\n\t\t\tconst machineId = await testObject.getMachineId();\n\t\t\tawait fileService.writeFile(testObject.getLastSyncResource(), VSBuffer.fromString(JSON.stringify({\n\t\t\t\tref: '2',\n\t\t\t\tsyncData: {\n\t\t\t\t\tcontent: '0',\n\t\t\t\t\tmachineId,\n\t\t\t\t\tversion: 1\n\t\t\t\t}\n\t\t\t})));\n\t\t\tserver.reset();\n\t\t\tconst actual = await testObject.getLastSyncUserData();\n\n\t\t\tassert.deepStrictEqual(storageService.get('settings.lastSyncUserData', StorageScope.APPLICATION), JSON.stringify({ ref: '1' }));\n\t\t\tassert.deepStrictEqual(actual, {\n\t\t\t\tref: '1',\n\t\t\t\tsyncData: {\n\t\t\t\t\tcontent: '0',\n\t\t\t\t\tmachineId,\n\t\t\t\t\tversion: 1\n\t\t\t\t}\n\t\t\t});\n\t\t\tassert.deepStrictEqual(server.requests, [{ headers: {}, type: 'GET', url: 'http://host:3000/v1/resource/settings/1' }]);\n\t\t});\n\t});\n\n\ttest('reading last sync data: no requests are made to server when sync data is invalid', async () => {\n\t\tawait runWithFakedTimers<void>({}, async () => {\n\t\t\tconst fileService = client.instantiationService.get(IFileService);\n\t\t\tconst testObject: TestSynchroniser = disposableStore.add(client.instantiationService.createInstance(TestSynchroniser, { syncResource: SyncResource.Settings, profile: client.instantiationService.get(IUserDataProfilesService).defaultProfile }, undefined));\n\t\t\ttestObject.syncBarrier.open();\n\n\t\t\tawait testObject.sync(await client.getLatestRef(testObject.resource));\n\t\t\tconst machineId = await testObject.getMachineId();\n\t\t\tawait fileService.writeFile(testObject.getLastSyncResource(), VSBuffer.fromString(JSON.stringify({\n\t\t\t\tref: '1',\n\t\t\t\tversion: 1,\n\t\t\t\tcontent: JSON.stringify({\n\t\t\t\t\tcontent: '0',\n\t\t\t\t\tmachineId,\n\t\t\t\t\tversion: 1\n\t\t\t\t}),\n\t\t\t\tadditionalData: {\n\t\t\t\t\tfoo: 'bar'\n\t\t\t\t}\n\t\t\t})));\n\t\t\tawait testObject.getLastSyncUserData();\n\t\t\tserver.reset();\n\n\t\t\tawait testObject.getLastSyncUserData();\n\t\t\tassert.deepStrictEqual(server.requests, []);\n\t\t});\n\t});\n\n\ttest('reading last sync data: no requests are made to server when sync data is null', async () => {\n\t\tawait runWithFakedTimers<void>({}, async () => {\n\t\t\tconst fileService = client.instantiationService.get(IFileService);\n\t\t\tconst testObject: TestSynchroniser = disposableStore.add(client.instantiationService.createInstance(TestSynchroniser, { syncResource: SyncResource.Settings, profile: client.instantiationService.get(IUserDataProfilesService).defaultProfile }, undefined));\n\t\t\ttestObject.syncBarrier.open();\n\n\t\t\tawait testObject.sync(await client.getLatestRef(testObject.resource));\n\t\t\tserver.reset();\n\t\t\tawait fileService.writeFile(testObject.getLastSyncResource(), VSBuffer.fromString(JSON.stringify({\n\t\t\t\tref: '1',\n\t\t\t\tsyncData: null,\n\t\t\t})));\n\t\t\tawait testObject.getLastSyncUserData();\n\n\t\t\tassert.deepStrictEqual(server.requests, []);\n\t\t});\n\t});\n\n\ttest('last sync data is null after sync if last sync state is deleted', async () => {\n\t\tawait runWithFakedTimers<void>({}, async () => {\n\t\t\tconst storageService = client.instantiationService.get(IStorageService);\n\t\t\tconst testObject: TestSynchroniser = disposableStore.add(client.instantiationService.createInstance(TestSynchroniser, { syncResource: SyncResource.Settings, profile: client.instantiationService.get(IUserDataProfilesService).defaultProfile }, undefined));\n\t\t\ttestObject.syncBarrier.open();\n\n\t\t\tawait testObject.sync(await client.getLatestRef(testObject.resource));\n\t\t\tstorageService.remove('settings.lastSyncUserData', StorageScope.APPLICATION);\n\t\t\tconst actual = await testObject.getLastSyncUserData();\n\n\t\t\tassert.strictEqual(actual, null);\n\t\t});\n\t});\n\n\ttest('last sync data is null after sync if last sync content is deleted everywhere', async () => {\n\t\tawait runWithFakedTimers<void>({}, async () => {\n\t\t\tconst storageService = client.instantiationService.get(IStorageService);\n\t\t\tconst fileService = client.instantiationService.get(IFileService);\n\t\t\tconst userDataSyncStoreService = client.instantiationService.get(IUserDataSyncStoreService);\n\t\t\tconst testObject: TestSynchroniser = disposableStore.add(client.instantiationService.createInstance(TestSynchroniser, { syncResource: SyncResource.Settings, profile: client.instantiationService.get(IUserDataProfilesService).defaultProfile }, undefined));\n\t\t\ttestObject.syncBarrier.open();\n\n\t\t\tawait testObject.sync(await client.getLatestRef(testObject.resource));\n\t\t\tawait fileService.del(testObject.getLastSyncResource());\n\t\t\tawait userDataSyncStoreService.deleteResource(testObject.syncResource.syncResource, null);\n\t\t\tconst actual = await testObject.getLastSyncUserData();\n\n\t\t\tassert.deepStrictEqual(storageService.get('settings.lastSyncUserData', StorageScope.APPLICATION), JSON.stringify({ ref: '1' }));\n\t\t\tassert.strictEqual(actual, null);\n\t\t});\n\t});\n\n});\n\nfunction assertConflicts(actual: IBaseResourcePreview[], expected: URI[]) {\n\tassert.deepStrictEqual(actual.map(({ localResource }) => localResource.toString()), expected.map(uri => uri.toString()));\n}\n\nfunction assertPreviews(actual: IBaseResourcePreview[], expected: URI[]) {\n\tassert.deepStrictEqual(actual.map(({ localResource }) => localResource.toString()), expected.map(uri => uri.toString()));\n}\n"]}