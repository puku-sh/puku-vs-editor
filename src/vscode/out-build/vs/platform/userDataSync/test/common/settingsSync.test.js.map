{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/platform/userDataSync/test/common/settingsSync.test.ts","vs/platform/userDataSync/test/common/settingsSync.test.ts"],"names":[],"mappings":"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","file":"settingsSync.test.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport assert from 'assert';\nimport { VSBuffer } from '../../../../base/common/buffer.js';\nimport { Event } from '../../../../base/common/event.js';\nimport { runWithFakedTimers } from '../../../../base/test/common/timeTravelScheduler.js';\nimport { ensureNoDisposablesAreLeakedInTestSuite } from '../../../../base/test/common/utils.js';\nimport { IConfigurationService } from '../../../configuration/common/configuration.js';\nimport { ConfigurationScope, Extensions, IConfigurationRegistry } from '../../../configuration/common/configurationRegistry.js';\nimport { IFileService } from '../../../files/common/files.js';\nimport { Registry } from '../../../registry/common/platform.js';\nimport { IUserDataProfile, IUserDataProfilesService } from '../../../userDataProfile/common/userDataProfile.js';\nimport { ISettingsSyncContent, parseSettingsSyncContent, SettingsSynchroniser } from '../../common/settingsSync.js';\nimport { ISyncData, IUserDataSyncStoreService, SyncResource, SyncStatus, UserDataSyncError, UserDataSyncErrorCode } from '../../common/userDataSync.js';\nimport { UserDataSyncClient, UserDataSyncTestServer } from './userDataSyncClient.js';\n\nsuite('SettingsSync - Auto', () => {\n\n\tconst server = new UserDataSyncTestServer();\n\tlet client: UserDataSyncClient;\n\tlet testObject: SettingsSynchroniser;\n\n\tteardown(async () => {\n\t\tawait client.instantiationService.get(IUserDataSyncStoreService).clear();\n\t});\n\n\tconst disposableStore = ensureNoDisposablesAreLeakedInTestSuite();\n\n\tsetup(async () => {\n\t\tRegistry.as<IConfigurationRegistry>(Extensions.Configuration).registerConfiguration({\n\t\t\t'id': 'settingsSync',\n\t\t\t'type': 'object',\n\t\t\t'properties': {\n\t\t\t\t'settingsSync.machine': {\n\t\t\t\t\t'type': 'string',\n\t\t\t\t\t'scope': ConfigurationScope.MACHINE\n\t\t\t\t},\n\t\t\t\t'settingsSync.machineOverridable': {\n\t\t\t\t\t'type': 'string',\n\t\t\t\t\t'scope': ConfigurationScope.MACHINE_OVERRIDABLE\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\tclient = disposableStore.add(new UserDataSyncClient(server));\n\t\tawait client.setUp(true);\n\t\ttestObject = client.getSynchronizer(SyncResource.Settings) as SettingsSynchroniser;\n\t});\n\n\ttest('when settings file does not exist', () => runWithFakedTimers<void>({ useFakeTimers: true }, async () => {\n\t\tconst fileService = client.instantiationService.get(IFileService);\n\t\tconst settingResource = client.instantiationService.get(IUserDataProfilesService).defaultProfile.settingsResource;\n\n\t\tassert.deepStrictEqual(await testObject.getLastSyncUserData(), null);\n\t\tlet manifest = await client.getLatestRef(SyncResource.Settings);\n\t\tserver.reset();\n\t\tawait testObject.sync(manifest);\n\n\t\tassert.deepStrictEqual(server.requests, []);\n\t\tassert.ok(!await fileService.exists(settingResource));\n\n\t\tconst lastSyncUserData = await testObject.getLastSyncUserData();\n\t\tconst remoteUserData = await testObject.getRemoteUserData(null);\n\t\tassert.deepStrictEqual(lastSyncUserData!.ref, remoteUserData.ref);\n\t\tassert.deepStrictEqual(lastSyncUserData!.syncData, remoteUserData.syncData);\n\t\tassert.strictEqual(lastSyncUserData!.syncData, null);\n\n\t\tmanifest = await client.getLatestRef(SyncResource.Settings);\n\t\tserver.reset();\n\t\tawait testObject.sync(manifest);\n\t\tassert.deepStrictEqual(server.requests, []);\n\n\t\tmanifest = await client.getLatestRef(SyncResource.Settings);\n\t\tserver.reset();\n\t\tawait testObject.sync(manifest);\n\t\tassert.deepStrictEqual(server.requests, []);\n\t}));\n\n\ttest('when settings file is empty and remote has no changes', () => runWithFakedTimers<void>({ useFakeTimers: true }, async () => {\n\t\tconst fileService = client.instantiationService.get(IFileService);\n\t\tconst settingsResource = client.instantiationService.get(IUserDataProfilesService).defaultProfile.settingsResource;\n\t\tawait fileService.writeFile(settingsResource, VSBuffer.fromString(''));\n\n\t\tawait testObject.sync(await client.getLatestRef(SyncResource.Settings));\n\n\t\tconst lastSyncUserData = await testObject.getLastSyncUserData();\n\t\tconst remoteUserData = await testObject.getRemoteUserData(null);\n\t\tassert.strictEqual(parseSettingsSyncContent(lastSyncUserData!.syncData!.content)?.settings, '{}');\n\t\tassert.strictEqual(parseSettingsSyncContent(remoteUserData.syncData!.content)?.settings, '{}');\n\t\tassert.strictEqual((await fileService.readFile(settingsResource)).value.toString(), '');\n\t}));\n\n\ttest('when settings file is empty and remote has changes', () => runWithFakedTimers<void>({ useFakeTimers: true }, async () => {\n\t\tconst client2 = disposableStore.add(new UserDataSyncClient(server));\n\t\tawait client2.setUp(true);\n\t\tconst content =\n\t\t\t`{\n\t// Always\n\t\"files.autoSave\": \"afterDelay\",\n\t\"files.simpleDialog.enable\": true,\n\n\t// Workbench\n\t\"workbench.colorTheme\": \"GitHub Sharp\",\n\t\"workbench.tree.indent\": 20,\n\t\"workbench.colorCustomizations\": {\n\t\t\"editorLineNumber.activeForeground\": \"#ff0000\",\n\t\t\"[GitHub Sharp]\": {\n\t\t\t\"statusBarItem.remoteBackground\": \"#24292E\",\n\t\t\t\"editorPane.background\": \"#f3f1f11a\"\n\t\t}\n\t},\n\n\t\"gitBranch.base\": \"remote-repo/master\",\n\n\t// Experimental\n\t\"workbench.view.experimental.allowMovingToNewContainer\": true,\n}`;\n\t\tawait client2.instantiationService.get(IFileService).writeFile(client2.instantiationService.get(IUserDataProfilesService).defaultProfile.settingsResource, VSBuffer.fromString(content));\n\t\tawait client2.sync();\n\n\t\tconst fileService = client.instantiationService.get(IFileService);\n\t\tconst settingsResource = client.instantiationService.get(IUserDataProfilesService).defaultProfile.settingsResource;\n\t\tawait fileService.writeFile(settingsResource, VSBuffer.fromString(''));\n\n\t\tawait testObject.sync(await client.getLatestRef(SyncResource.Settings));\n\n\t\tconst lastSyncUserData = await testObject.getLastSyncUserData();\n\t\tconst remoteUserData = await testObject.getRemoteUserData(null);\n\t\tassert.strictEqual(parseSettingsSyncContent(lastSyncUserData!.syncData!.content)?.settings, content);\n\t\tassert.strictEqual(parseSettingsSyncContent(remoteUserData.syncData!.content)?.settings, content);\n\t\tassert.strictEqual((await fileService.readFile(settingsResource)).value.toString(), content);\n\t}));\n\n\ttest('when settings file is created after first sync', () => runWithFakedTimers<void>({ useFakeTimers: true }, async () => {\n\t\tconst fileService = client.instantiationService.get(IFileService);\n\n\t\tconst settingsResource = client.instantiationService.get(IUserDataProfilesService).defaultProfile.settingsResource;\n\t\tawait testObject.sync(await client.getLatestRef(SyncResource.Settings));\n\t\tawait fileService.createFile(settingsResource, VSBuffer.fromString('{}'));\n\n\t\tlet lastSyncUserData = await testObject.getLastSyncUserData();\n\t\tconst manifest = await client.getLatestRef(SyncResource.Settings);\n\t\tserver.reset();\n\t\tawait testObject.sync(manifest);\n\n\t\tassert.deepStrictEqual(server.requests, [\n\t\t\t{ type: 'POST', url: `${server.url}/v1/resource/${testObject.resource}`, headers: { 'If-Match': lastSyncUserData?.ref } },\n\t\t]);\n\n\t\tlastSyncUserData = await testObject.getLastSyncUserData();\n\t\tconst remoteUserData = await testObject.getRemoteUserData(null);\n\t\tassert.deepStrictEqual(lastSyncUserData!.ref, remoteUserData.ref);\n\t\tassert.deepStrictEqual(lastSyncUserData!.syncData, remoteUserData.syncData);\n\t\tassert.strictEqual(parseSettingsSyncContent(lastSyncUserData!.syncData!.content)?.settings, '{}');\n\t}));\n\n\ttest('sync for first time to the server', () => runWithFakedTimers<void>({ useFakeTimers: true }, async () => {\n\t\tconst expected =\n\t\t\t`{\n\t// Always\n\t\"files.autoSave\": \"afterDelay\",\n\t\"files.simpleDialog.enable\": true,\n\n\t// Workbench\n\t\"workbench.colorTheme\": \"GitHub Sharp\",\n\t\"workbench.tree.indent\": 20,\n\t\"workbench.colorCustomizations\": {\n\t\t\"editorLineNumber.activeForeground\": \"#ff0000\",\n\t\t\"[GitHub Sharp]\": {\n\t\t\t\"statusBarItem.remoteBackground\": \"#24292E\",\n\t\t\t\"editorPane.background\": \"#f3f1f11a\"\n\t\t}\n\t},\n\n\t\"gitBranch.base\": \"remote-repo/master\",\n\n\t// Experimental\n\t\"workbench.view.experimental.allowMovingToNewContainer\": true,\n}`;\n\n\t\tawait updateSettings(expected, client);\n\t\tawait testObject.sync(await client.getLatestRef(SyncResource.Settings));\n\n\t\tconst { content } = await client.read(testObject.resource);\n\t\tassert.ok(content !== null);\n\t\tconst actual = parseSettings(content);\n\t\tassert.deepStrictEqual(actual, expected);\n\t}));\n\n\ttest('do not sync machine settings', () => runWithFakedTimers<void>({ useFakeTimers: true }, async () => {\n\t\tconst settingsContent =\n\t\t\t`{\n\t// Always\n\t\"files.autoSave\": \"afterDelay\",\n\t\"files.simpleDialog.enable\": true,\n\n\t// Workbench\n\t\"workbench.colorTheme\": \"GitHub Sharp\",\n\n\t// Machine\n\t\"settingsSync.machine\": \"someValue\",\n\t\"settingsSync.machineOverridable\": \"someValue\"\n}`;\n\t\tawait updateSettings(settingsContent, client);\n\n\t\tawait testObject.sync(await client.getLatestRef(SyncResource.Settings));\n\n\t\tconst { content } = await client.read(testObject.resource);\n\t\tassert.ok(content !== null);\n\t\tconst actual = parseSettings(content);\n\t\tassert.deepStrictEqual(actual, `{\n\t// Always\n\t\"files.autoSave\": \"afterDelay\",\n\t\"files.simpleDialog.enable\": true,\n\n\t// Workbench\n\t\"workbench.colorTheme\": \"GitHub Sharp\"\n}`);\n\t}));\n\n\ttest('do not sync machine settings when spread across file', () => runWithFakedTimers<void>({ useFakeTimers: true }, async () => {\n\t\tconst settingsContent =\n\t\t\t`{\n\t// Always\n\t\"files.autoSave\": \"afterDelay\",\n\t\"settingsSync.machine\": \"someValue\",\n\t\"files.simpleDialog.enable\": true,\n\n\t// Workbench\n\t\"workbench.colorTheme\": \"GitHub Sharp\",\n\n\t// Machine\n\t\"settingsSync.machineOverridable\": \"someValue\"\n}`;\n\t\tawait updateSettings(settingsContent, client);\n\n\t\tawait testObject.sync(await client.getLatestRef(SyncResource.Settings));\n\n\t\tconst { content } = await client.read(testObject.resource);\n\t\tassert.ok(content !== null);\n\t\tconst actual = parseSettings(content);\n\t\tassert.deepStrictEqual(actual, `{\n\t// Always\n\t\"files.autoSave\": \"afterDelay\",\n\t\"files.simpleDialog.enable\": true,\n\n\t// Workbench\n\t\"workbench.colorTheme\": \"GitHub Sharp\"\n}`);\n\t}));\n\n\ttest('do not sync machine settings when spread across file - 2', () => runWithFakedTimers<void>({ useFakeTimers: true }, async () => {\n\t\tconst settingsContent =\n\t\t\t`{\n\t// Always\n\t\"files.autoSave\": \"afterDelay\",\n\t\"settingsSync.machine\": \"someValue\",\n\n\t// Workbench\n\t\"workbench.colorTheme\": \"GitHub Sharp\",\n\n\t// Machine\n\t\"settingsSync.machineOverridable\": \"someValue\",\n\t\"files.simpleDialog.enable\": true,\n}`;\n\t\tawait updateSettings(settingsContent, client);\n\n\t\tawait testObject.sync(await client.getLatestRef(SyncResource.Settings));\n\n\t\tconst { content } = await client.read(testObject.resource);\n\t\tassert.ok(content !== null);\n\t\tconst actual = parseSettings(content);\n\t\tassert.deepStrictEqual(actual, `{\n\t// Always\n\t\"files.autoSave\": \"afterDelay\",\n\n\t// Workbench\n\t\"workbench.colorTheme\": \"GitHub Sharp\",\n\t\"files.simpleDialog.enable\": true,\n}`);\n\t}));\n\n\ttest('sync when all settings are machine settings', () => runWithFakedTimers<void>({ useFakeTimers: true }, async () => {\n\t\tconst settingsContent =\n\t\t\t`{\n\t// Machine\n\t\"settingsSync.machine\": \"someValue\",\n\t\"settingsSync.machineOverridable\": \"someValue\"\n}`;\n\t\tawait updateSettings(settingsContent, client);\n\n\t\tawait testObject.sync(await client.getLatestRef(SyncResource.Settings));\n\n\t\tconst { content } = await client.read(testObject.resource);\n\t\tassert.ok(content !== null);\n\t\tconst actual = parseSettings(content);\n\t\tassert.deepStrictEqual(actual, `{\n}`);\n\t}));\n\n\ttest('sync when all settings are machine settings with trailing comma', () => runWithFakedTimers<void>({ useFakeTimers: true }, async () => {\n\t\tconst settingsContent =\n\t\t\t`{\n\t// Machine\n\t\"settingsSync.machine\": \"someValue\",\n\t\"settingsSync.machineOverridable\": \"someValue\",\n}`;\n\t\tawait updateSettings(settingsContent, client);\n\n\t\tawait testObject.sync(await client.getLatestRef(SyncResource.Settings));\n\n\t\tconst { content } = await client.read(testObject.resource);\n\t\tassert.ok(content !== null);\n\t\tconst actual = parseSettings(content);\n\t\tassert.deepStrictEqual(actual, `{\n\t,\n}`);\n\t}));\n\n\ttest('local change event is triggered when settings are changed', () => runWithFakedTimers<void>({ useFakeTimers: true }, async () => {\n\t\tconst content =\n\t\t\t`{\n\t\"files.autoSave\": \"afterDelay\",\n\t\"files.simpleDialog.enable\": true,\n}`;\n\n\t\tawait updateSettings(content, client);\n\t\tawait testObject.sync(await client.getLatestRef(SyncResource.Settings));\n\n\t\tconst promise = Event.toPromise(testObject.onDidChangeLocal);\n\t\tawait updateSettings(`{\n\t\"files.autoSave\": \"off\",\n\t\"files.simpleDialog.enable\": true,\n}`, client);\n\t\tawait promise;\n\t}));\n\n\ttest('do not sync ignored settings', () => runWithFakedTimers<void>({ useFakeTimers: true }, async () => {\n\t\tconst settingsContent =\n\t\t\t`{\n\t// Always\n\t\"files.autoSave\": \"afterDelay\",\n\t\"files.simpleDialog.enable\": true,\n\n\t// Editor\n\t\"editor.fontFamily\": \"Fira Code\",\n\n\t// Terminal\n\t\"terminal.integrated.shell.osx\": \"some path\",\n\n\t// Workbench\n\t\"workbench.colorTheme\": \"GitHub Sharp\",\n\n\t// Ignored\n\t\"settingsSync.ignoredSettings\": [\n\t\t\"editor.fontFamily\",\n\t\t\"terminal.integrated.shell.osx\"\n\t]\n}`;\n\t\tawait updateSettings(settingsContent, client);\n\n\t\tawait testObject.sync(await client.getLatestRef(SyncResource.Settings));\n\n\t\tconst { content } = await client.read(testObject.resource);\n\t\tassert.ok(content !== null);\n\t\tconst actual = parseSettings(content);\n\t\tassert.deepStrictEqual(actual, `{\n\t// Always\n\t\"files.autoSave\": \"afterDelay\",\n\t\"files.simpleDialog.enable\": true,\n\n\t// Workbench\n\t\"workbench.colorTheme\": \"GitHub Sharp\",\n\n\t// Ignored\n\t\"settingsSync.ignoredSettings\": [\n\t\t\"editor.fontFamily\",\n\t\t\"terminal.integrated.shell.osx\"\n\t]\n}`);\n\t}));\n\n\ttest('do not sync ignored and machine settings', () => runWithFakedTimers<void>({ useFakeTimers: true }, async () => {\n\t\tconst settingsContent =\n\t\t\t`{\n\t// Always\n\t\"files.autoSave\": \"afterDelay\",\n\t\"files.simpleDialog.enable\": true,\n\n\t// Editor\n\t\"editor.fontFamily\": \"Fira Code\",\n\n\t// Terminal\n\t\"terminal.integrated.shell.osx\": \"some path\",\n\n\t// Workbench\n\t\"workbench.colorTheme\": \"GitHub Sharp\",\n\n\t// Ignored\n\t\"settingsSync.ignoredSettings\": [\n\t\t\"editor.fontFamily\",\n\t\t\"terminal.integrated.shell.osx\"\n\t],\n\n\t// Machine\n\t\"settingsSync.machine\": \"someValue\",\n}`;\n\t\tawait updateSettings(settingsContent, client);\n\n\t\tawait testObject.sync(await client.getLatestRef(SyncResource.Settings));\n\n\t\tconst { content } = await client.read(testObject.resource);\n\t\tassert.ok(content !== null);\n\t\tconst actual = parseSettings(content);\n\t\tassert.deepStrictEqual(actual, `{\n\t// Always\n\t\"files.autoSave\": \"afterDelay\",\n\t\"files.simpleDialog.enable\": true,\n\n\t// Workbench\n\t\"workbench.colorTheme\": \"GitHub Sharp\",\n\n\t// Ignored\n\t\"settingsSync.ignoredSettings\": [\n\t\t\"editor.fontFamily\",\n\t\t\"terminal.integrated.shell.osx\"\n\t],\n}`);\n\t}));\n\n\ttest('sync throws invalid content error', () => runWithFakedTimers<void>({ useFakeTimers: true }, async () => {\n\t\tconst expected =\n\t\t\t`{\n\t// Always\n\t\"files.autoSave\": \"afterDelay\",\n\t\"files.simpleDialog.enable\": true,\n\n\t// Workbench\n\t\"workbench.colorTheme\": \"GitHub Sharp\",\n\t\"workbench.tree.indent\": 20,\n\t\"workbench.colorCustomizations\": {\n\t\t\"editorLineNumber.activeForeground\": \"#ff0000\",\n\t\t\"[GitHub Sharp]\": {\n\t\t\t\"statusBarItem.remoteBackground\": \"#24292E\",\n\t\t\t\"editorPane.background\": \"#f3f1f11a\"\n\t\t}\n\t}\n\n\t\"gitBranch.base\": \"remote-repo/master\",\n\n\t// Experimental\n\t\"workbench.view.experimental.allowMovingToNewContainer\": true,\n}`;\n\n\t\tawait updateSettings(expected, client);\n\n\t\ttry {\n\t\t\tawait testObject.sync(await client.getLatestRef(SyncResource.Settings));\n\t\t\tassert.fail('should fail with invalid content error');\n\t\t} catch (e) {\n\t\t\tassert.ok(e instanceof UserDataSyncError);\n\t\t\tassert.deepStrictEqual((<UserDataSyncError>e).code, UserDataSyncErrorCode.LocalInvalidContent);\n\t\t}\n\t}));\n\n\ttest('sync throws invalid content error - content is an array', () => runWithFakedTimers<void>({ useFakeTimers: true }, async () => {\n\t\tawait updateSettings('[]', client);\n\t\ttry {\n\t\t\tawait testObject.sync(await client.getLatestRef(SyncResource.Settings));\n\t\t\tassert.fail('should fail with invalid content error');\n\t\t} catch (e) {\n\t\t\tassert.ok(e instanceof UserDataSyncError);\n\t\t\tassert.deepStrictEqual((<UserDataSyncError>e).code, UserDataSyncErrorCode.LocalInvalidContent);\n\t\t}\n\t}));\n\n\ttest('sync when there are conflicts', () => runWithFakedTimers<void>({ useFakeTimers: true }, async () => {\n\t\tconst client2 = disposableStore.add(new UserDataSyncClient(server));\n\t\tawait client2.setUp(true);\n\t\tawait updateSettings(JSON.stringify({\n\t\t\t'a': 1,\n\t\t\t'b': 2,\n\t\t\t'settingsSync.ignoredSettings': ['a']\n\t\t}), client2);\n\t\tawait client2.sync();\n\n\t\tawait updateSettings(JSON.stringify({\n\t\t\t'a': 2,\n\t\t\t'b': 1,\n\t\t\t'settingsSync.ignoredSettings': ['a']\n\t\t}), client);\n\t\tawait testObject.sync(await client.getLatestRef(SyncResource.Settings));\n\n\t\tassert.strictEqual(testObject.status, SyncStatus.HasConflicts);\n\t\tassert.strictEqual(testObject.conflicts.conflicts[0].localResource.toString(), testObject.localResource.toString());\n\n\t\tconst fileService = client.instantiationService.get(IFileService);\n\t\tconst mergeContent = (await fileService.readFile(testObject.conflicts.conflicts[0].previewResource)).value.toString();\n\t\tassert.strictEqual(mergeContent, '');\n\t}));\n\n\ttest('sync profile settings', () => runWithFakedTimers<void>({ useFakeTimers: true }, async () => {\n\t\tconst client2 = disposableStore.add(new UserDataSyncClient(server));\n\t\tawait client2.setUp(true);\n\t\tconst profile = await client2.instantiationService.get(IUserDataProfilesService).createNamedProfile('profile1');\n\t\tawait updateSettings(JSON.stringify({\n\t\t\t'a': 1,\n\t\t\t'b': 2,\n\t\t}), client2, profile);\n\t\tawait client2.sync();\n\n\t\tawait client.sync();\n\n\t\tassert.strictEqual(testObject.status, SyncStatus.Idle);\n\n\t\tconst syncedProfile = client.instantiationService.get(IUserDataProfilesService).profiles.find(p => p.id === profile.id)!;\n\t\tconst content = (await client.instantiationService.get(IFileService).readFile(syncedProfile.settingsResource)).value.toString();\n\t\tassert.deepStrictEqual(JSON.parse(content), {\n\t\t\t'a': 1,\n\t\t\t'b': 2,\n\t\t});\n\t}));\n\n});\n\nsuite('SettingsSync - Manual', () => {\n\n\tconst server = new UserDataSyncTestServer();\n\tlet client: UserDataSyncClient;\n\tlet testObject: SettingsSynchroniser;\n\n\tteardown(async () => {\n\t\tawait client.instantiationService.get(IUserDataSyncStoreService).clear();\n\t});\n\n\tconst disposableStore = ensureNoDisposablesAreLeakedInTestSuite();\n\n\tsetup(async () => {\n\t\tclient = disposableStore.add(new UserDataSyncClient(server));\n\t\tawait client.setUp(true);\n\t\ttestObject = client.getSynchronizer(SyncResource.Settings) as SettingsSynchroniser;\n\t});\n\n\ttest('do not sync ignored settings', () => runWithFakedTimers<void>({ useFakeTimers: true }, async () => {\n\t\tconst settingsContent =\n\t\t\t`{\n\t// Always\n\t\"files.autoSave\": \"afterDelay\",\n\t\"files.simpleDialog.enable\": true,\n\n\t// Editor\n\t\"editor.fontFamily\": \"Fira Code\",\n\n\t// Terminal\n\t\"terminal.integrated.shell.osx\": \"some path\",\n\n\t// Workbench\n\t\"workbench.colorTheme\": \"GitHub Sharp\",\n\n\t// Ignored\n\t\"settingsSync.ignoredSettings\": [\n\t\t\"editor.fontFamily\",\n\t\t\"terminal.integrated.shell.osx\"\n\t]\n}`;\n\t\tawait updateSettings(settingsContent, client);\n\n\t\tlet preview = await testObject.sync(await client.getLatestRef(SyncResource.Settings), true);\n\t\tassert.strictEqual(testObject.status, SyncStatus.Syncing);\n\t\tpreview = await testObject.accept(preview!.resourcePreviews[0].previewResource);\n\t\tpreview = await testObject.apply(false);\n\n\t\tconst { content } = await client.read(testObject.resource);\n\t\tassert.ok(content !== null);\n\t\tconst actual = parseSettings(content);\n\t\tassert.deepStrictEqual(actual, `{\n\t// Always\n\t\"files.autoSave\": \"afterDelay\",\n\t\"files.simpleDialog.enable\": true,\n\n\t// Workbench\n\t\"workbench.colorTheme\": \"GitHub Sharp\",\n\n\t// Ignored\n\t\"settingsSync.ignoredSettings\": [\n\t\t\"editor.fontFamily\",\n\t\t\"terminal.integrated.shell.osx\"\n\t]\n}`);\n\t}));\n\n});\n\nfunction parseSettings(content: string): string {\n\tconst syncData: ISyncData = JSON.parse(content);\n\tconst settingsSyncContent: ISettingsSyncContent = JSON.parse(syncData.content);\n\treturn settingsSyncContent.settings;\n}\n\nasync function updateSettings(content: string, client: UserDataSyncClient, profile?: IUserDataProfile): Promise<void> {\n\tawait client.instantiationService.get(IFileService).writeFile((profile ?? client.instantiationService.get(IUserDataProfilesService).defaultProfile).settingsResource, VSBuffer.fromString(content));\n\tawait client.instantiationService.get(IConfigurationService).reloadConfiguration();\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport assert from 'assert';\nimport { VSBuffer } from '../../../../base/common/buffer.js';\nimport { Event } from '../../../../base/common/event.js';\nimport { runWithFakedTimers } from '../../../../base/test/common/timeTravelScheduler.js';\nimport { ensureNoDisposablesAreLeakedInTestSuite } from '../../../../base/test/common/utils.js';\nimport { IConfigurationService } from '../../../configuration/common/configuration.js';\nimport { ConfigurationScope, Extensions, IConfigurationRegistry } from '../../../configuration/common/configurationRegistry.js';\nimport { IFileService } from '../../../files/common/files.js';\nimport { Registry } from '../../../registry/common/platform.js';\nimport { IUserDataProfile, IUserDataProfilesService } from '../../../userDataProfile/common/userDataProfile.js';\nimport { ISettingsSyncContent, parseSettingsSyncContent, SettingsSynchroniser } from '../../common/settingsSync.js';\nimport { ISyncData, IUserDataSyncStoreService, SyncResource, SyncStatus, UserDataSyncError, UserDataSyncErrorCode } from '../../common/userDataSync.js';\nimport { UserDataSyncClient, UserDataSyncTestServer } from './userDataSyncClient.js';\n\nsuite('SettingsSync - Auto', () => {\n\n\tconst server = new UserDataSyncTestServer();\n\tlet client: UserDataSyncClient;\n\tlet testObject: SettingsSynchroniser;\n\n\tteardown(async () => {\n\t\tawait client.instantiationService.get(IUserDataSyncStoreService).clear();\n\t});\n\n\tconst disposableStore = ensureNoDisposablesAreLeakedInTestSuite();\n\n\tsetup(async () => {\n\t\tRegistry.as<IConfigurationRegistry>(Extensions.Configuration).registerConfiguration({\n\t\t\t'id': 'settingsSync',\n\t\t\t'type': 'object',\n\t\t\t'properties': {\n\t\t\t\t'settingsSync.machine': {\n\t\t\t\t\t'type': 'string',\n\t\t\t\t\t'scope': ConfigurationScope.MACHINE\n\t\t\t\t},\n\t\t\t\t'settingsSync.machineOverridable': {\n\t\t\t\t\t'type': 'string',\n\t\t\t\t\t'scope': ConfigurationScope.MACHINE_OVERRIDABLE\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\tclient = disposableStore.add(new UserDataSyncClient(server));\n\t\tawait client.setUp(true);\n\t\ttestObject = client.getSynchronizer(SyncResource.Settings) as SettingsSynchroniser;\n\t});\n\n\ttest('when settings file does not exist', () => runWithFakedTimers<void>({ useFakeTimers: true }, async () => {\n\t\tconst fileService = client.instantiationService.get(IFileService);\n\t\tconst settingResource = client.instantiationService.get(IUserDataProfilesService).defaultProfile.settingsResource;\n\n\t\tassert.deepStrictEqual(await testObject.getLastSyncUserData(), null);\n\t\tlet manifest = await client.getLatestRef(SyncResource.Settings);\n\t\tserver.reset();\n\t\tawait testObject.sync(manifest);\n\n\t\tassert.deepStrictEqual(server.requests, []);\n\t\tassert.ok(!await fileService.exists(settingResource));\n\n\t\tconst lastSyncUserData = await testObject.getLastSyncUserData();\n\t\tconst remoteUserData = await testObject.getRemoteUserData(null);\n\t\tassert.deepStrictEqual(lastSyncUserData!.ref, remoteUserData.ref);\n\t\tassert.deepStrictEqual(lastSyncUserData!.syncData, remoteUserData.syncData);\n\t\tassert.strictEqual(lastSyncUserData!.syncData, null);\n\n\t\tmanifest = await client.getLatestRef(SyncResource.Settings);\n\t\tserver.reset();\n\t\tawait testObject.sync(manifest);\n\t\tassert.deepStrictEqual(server.requests, []);\n\n\t\tmanifest = await client.getLatestRef(SyncResource.Settings);\n\t\tserver.reset();\n\t\tawait testObject.sync(manifest);\n\t\tassert.deepStrictEqual(server.requests, []);\n\t}));\n\n\ttest('when settings file is empty and remote has no changes', () => runWithFakedTimers<void>({ useFakeTimers: true }, async () => {\n\t\tconst fileService = client.instantiationService.get(IFileService);\n\t\tconst settingsResource = client.instantiationService.get(IUserDataProfilesService).defaultProfile.settingsResource;\n\t\tawait fileService.writeFile(settingsResource, VSBuffer.fromString(''));\n\n\t\tawait testObject.sync(await client.getLatestRef(SyncResource.Settings));\n\n\t\tconst lastSyncUserData = await testObject.getLastSyncUserData();\n\t\tconst remoteUserData = await testObject.getRemoteUserData(null);\n\t\tassert.strictEqual(parseSettingsSyncContent(lastSyncUserData!.syncData!.content)?.settings, '{}');\n\t\tassert.strictEqual(parseSettingsSyncContent(remoteUserData.syncData!.content)?.settings, '{}');\n\t\tassert.strictEqual((await fileService.readFile(settingsResource)).value.toString(), '');\n\t}));\n\n\ttest('when settings file is empty and remote has changes', () => runWithFakedTimers<void>({ useFakeTimers: true }, async () => {\n\t\tconst client2 = disposableStore.add(new UserDataSyncClient(server));\n\t\tawait client2.setUp(true);\n\t\tconst content =\n\t\t\t`{\n\t// Always\n\t\"files.autoSave\": \"afterDelay\",\n\t\"files.simpleDialog.enable\": true,\n\n\t// Workbench\n\t\"workbench.colorTheme\": \"GitHub Sharp\",\n\t\"workbench.tree.indent\": 20,\n\t\"workbench.colorCustomizations\": {\n\t\t\"editorLineNumber.activeForeground\": \"#ff0000\",\n\t\t\"[GitHub Sharp]\": {\n\t\t\t\"statusBarItem.remoteBackground\": \"#24292E\",\n\t\t\t\"editorPane.background\": \"#f3f1f11a\"\n\t\t}\n\t},\n\n\t\"gitBranch.base\": \"remote-repo/master\",\n\n\t// Experimental\n\t\"workbench.view.experimental.allowMovingToNewContainer\": true,\n}`;\n\t\tawait client2.instantiationService.get(IFileService).writeFile(client2.instantiationService.get(IUserDataProfilesService).defaultProfile.settingsResource, VSBuffer.fromString(content));\n\t\tawait client2.sync();\n\n\t\tconst fileService = client.instantiationService.get(IFileService);\n\t\tconst settingsResource = client.instantiationService.get(IUserDataProfilesService).defaultProfile.settingsResource;\n\t\tawait fileService.writeFile(settingsResource, VSBuffer.fromString(''));\n\n\t\tawait testObject.sync(await client.getLatestRef(SyncResource.Settings));\n\n\t\tconst lastSyncUserData = await testObject.getLastSyncUserData();\n\t\tconst remoteUserData = await testObject.getRemoteUserData(null);\n\t\tassert.strictEqual(parseSettingsSyncContent(lastSyncUserData!.syncData!.content)?.settings, content);\n\t\tassert.strictEqual(parseSettingsSyncContent(remoteUserData.syncData!.content)?.settings, content);\n\t\tassert.strictEqual((await fileService.readFile(settingsResource)).value.toString(), content);\n\t}));\n\n\ttest('when settings file is created after first sync', () => runWithFakedTimers<void>({ useFakeTimers: true }, async () => {\n\t\tconst fileService = client.instantiationService.get(IFileService);\n\n\t\tconst settingsResource = client.instantiationService.get(IUserDataProfilesService).defaultProfile.settingsResource;\n\t\tawait testObject.sync(await client.getLatestRef(SyncResource.Settings));\n\t\tawait fileService.createFile(settingsResource, VSBuffer.fromString('{}'));\n\n\t\tlet lastSyncUserData = await testObject.getLastSyncUserData();\n\t\tconst manifest = await client.getLatestRef(SyncResource.Settings);\n\t\tserver.reset();\n\t\tawait testObject.sync(manifest);\n\n\t\tassert.deepStrictEqual(server.requests, [\n\t\t\t{ type: 'POST', url: `${server.url}/v1/resource/${testObject.resource}`, headers: { 'If-Match': lastSyncUserData?.ref } },\n\t\t]);\n\n\t\tlastSyncUserData = await testObject.getLastSyncUserData();\n\t\tconst remoteUserData = await testObject.getRemoteUserData(null);\n\t\tassert.deepStrictEqual(lastSyncUserData!.ref, remoteUserData.ref);\n\t\tassert.deepStrictEqual(lastSyncUserData!.syncData, remoteUserData.syncData);\n\t\tassert.strictEqual(parseSettingsSyncContent(lastSyncUserData!.syncData!.content)?.settings, '{}');\n\t}));\n\n\ttest('sync for first time to the server', () => runWithFakedTimers<void>({ useFakeTimers: true }, async () => {\n\t\tconst expected =\n\t\t\t`{\n\t// Always\n\t\"files.autoSave\": \"afterDelay\",\n\t\"files.simpleDialog.enable\": true,\n\n\t// Workbench\n\t\"workbench.colorTheme\": \"GitHub Sharp\",\n\t\"workbench.tree.indent\": 20,\n\t\"workbench.colorCustomizations\": {\n\t\t\"editorLineNumber.activeForeground\": \"#ff0000\",\n\t\t\"[GitHub Sharp]\": {\n\t\t\t\"statusBarItem.remoteBackground\": \"#24292E\",\n\t\t\t\"editorPane.background\": \"#f3f1f11a\"\n\t\t}\n\t},\n\n\t\"gitBranch.base\": \"remote-repo/master\",\n\n\t// Experimental\n\t\"workbench.view.experimental.allowMovingToNewContainer\": true,\n}`;\n\n\t\tawait updateSettings(expected, client);\n\t\tawait testObject.sync(await client.getLatestRef(SyncResource.Settings));\n\n\t\tconst { content } = await client.read(testObject.resource);\n\t\tassert.ok(content !== null);\n\t\tconst actual = parseSettings(content);\n\t\tassert.deepStrictEqual(actual, expected);\n\t}));\n\n\ttest('do not sync machine settings', () => runWithFakedTimers<void>({ useFakeTimers: true }, async () => {\n\t\tconst settingsContent =\n\t\t\t`{\n\t// Always\n\t\"files.autoSave\": \"afterDelay\",\n\t\"files.simpleDialog.enable\": true,\n\n\t// Workbench\n\t\"workbench.colorTheme\": \"GitHub Sharp\",\n\n\t// Machine\n\t\"settingsSync.machine\": \"someValue\",\n\t\"settingsSync.machineOverridable\": \"someValue\"\n}`;\n\t\tawait updateSettings(settingsContent, client);\n\n\t\tawait testObject.sync(await client.getLatestRef(SyncResource.Settings));\n\n\t\tconst { content } = await client.read(testObject.resource);\n\t\tassert.ok(content !== null);\n\t\tconst actual = parseSettings(content);\n\t\tassert.deepStrictEqual(actual, `{\n\t// Always\n\t\"files.autoSave\": \"afterDelay\",\n\t\"files.simpleDialog.enable\": true,\n\n\t// Workbench\n\t\"workbench.colorTheme\": \"GitHub Sharp\"\n}`);\n\t}));\n\n\ttest('do not sync machine settings when spread across file', () => runWithFakedTimers<void>({ useFakeTimers: true }, async () => {\n\t\tconst settingsContent =\n\t\t\t`{\n\t// Always\n\t\"files.autoSave\": \"afterDelay\",\n\t\"settingsSync.machine\": \"someValue\",\n\t\"files.simpleDialog.enable\": true,\n\n\t// Workbench\n\t\"workbench.colorTheme\": \"GitHub Sharp\",\n\n\t// Machine\n\t\"settingsSync.machineOverridable\": \"someValue\"\n}`;\n\t\tawait updateSettings(settingsContent, client);\n\n\t\tawait testObject.sync(await client.getLatestRef(SyncResource.Settings));\n\n\t\tconst { content } = await client.read(testObject.resource);\n\t\tassert.ok(content !== null);\n\t\tconst actual = parseSettings(content);\n\t\tassert.deepStrictEqual(actual, `{\n\t// Always\n\t\"files.autoSave\": \"afterDelay\",\n\t\"files.simpleDialog.enable\": true,\n\n\t// Workbench\n\t\"workbench.colorTheme\": \"GitHub Sharp\"\n}`);\n\t}));\n\n\ttest('do not sync machine settings when spread across file - 2', () => runWithFakedTimers<void>({ useFakeTimers: true }, async () => {\n\t\tconst settingsContent =\n\t\t\t`{\n\t// Always\n\t\"files.autoSave\": \"afterDelay\",\n\t\"settingsSync.machine\": \"someValue\",\n\n\t// Workbench\n\t\"workbench.colorTheme\": \"GitHub Sharp\",\n\n\t// Machine\n\t\"settingsSync.machineOverridable\": \"someValue\",\n\t\"files.simpleDialog.enable\": true,\n}`;\n\t\tawait updateSettings(settingsContent, client);\n\n\t\tawait testObject.sync(await client.getLatestRef(SyncResource.Settings));\n\n\t\tconst { content } = await client.read(testObject.resource);\n\t\tassert.ok(content !== null);\n\t\tconst actual = parseSettings(content);\n\t\tassert.deepStrictEqual(actual, `{\n\t// Always\n\t\"files.autoSave\": \"afterDelay\",\n\n\t// Workbench\n\t\"workbench.colorTheme\": \"GitHub Sharp\",\n\t\"files.simpleDialog.enable\": true,\n}`);\n\t}));\n\n\ttest('sync when all settings are machine settings', () => runWithFakedTimers<void>({ useFakeTimers: true }, async () => {\n\t\tconst settingsContent =\n\t\t\t`{\n\t// Machine\n\t\"settingsSync.machine\": \"someValue\",\n\t\"settingsSync.machineOverridable\": \"someValue\"\n}`;\n\t\tawait updateSettings(settingsContent, client);\n\n\t\tawait testObject.sync(await client.getLatestRef(SyncResource.Settings));\n\n\t\tconst { content } = await client.read(testObject.resource);\n\t\tassert.ok(content !== null);\n\t\tconst actual = parseSettings(content);\n\t\tassert.deepStrictEqual(actual, `{\n}`);\n\t}));\n\n\ttest('sync when all settings are machine settings with trailing comma', () => runWithFakedTimers<void>({ useFakeTimers: true }, async () => {\n\t\tconst settingsContent =\n\t\t\t`{\n\t// Machine\n\t\"settingsSync.machine\": \"someValue\",\n\t\"settingsSync.machineOverridable\": \"someValue\",\n}`;\n\t\tawait updateSettings(settingsContent, client);\n\n\t\tawait testObject.sync(await client.getLatestRef(SyncResource.Settings));\n\n\t\tconst { content } = await client.read(testObject.resource);\n\t\tassert.ok(content !== null);\n\t\tconst actual = parseSettings(content);\n\t\tassert.deepStrictEqual(actual, `{\n\t,\n}`);\n\t}));\n\n\ttest('local change event is triggered when settings are changed', () => runWithFakedTimers<void>({ useFakeTimers: true }, async () => {\n\t\tconst content =\n\t\t\t`{\n\t\"files.autoSave\": \"afterDelay\",\n\t\"files.simpleDialog.enable\": true,\n}`;\n\n\t\tawait updateSettings(content, client);\n\t\tawait testObject.sync(await client.getLatestRef(SyncResource.Settings));\n\n\t\tconst promise = Event.toPromise(testObject.onDidChangeLocal);\n\t\tawait updateSettings(`{\n\t\"files.autoSave\": \"off\",\n\t\"files.simpleDialog.enable\": true,\n}`, client);\n\t\tawait promise;\n\t}));\n\n\ttest('do not sync ignored settings', () => runWithFakedTimers<void>({ useFakeTimers: true }, async () => {\n\t\tconst settingsContent =\n\t\t\t`{\n\t// Always\n\t\"files.autoSave\": \"afterDelay\",\n\t\"files.simpleDialog.enable\": true,\n\n\t// Editor\n\t\"editor.fontFamily\": \"Fira Code\",\n\n\t// Terminal\n\t\"terminal.integrated.shell.osx\": \"some path\",\n\n\t// Workbench\n\t\"workbench.colorTheme\": \"GitHub Sharp\",\n\n\t// Ignored\n\t\"settingsSync.ignoredSettings\": [\n\t\t\"editor.fontFamily\",\n\t\t\"terminal.integrated.shell.osx\"\n\t]\n}`;\n\t\tawait updateSettings(settingsContent, client);\n\n\t\tawait testObject.sync(await client.getLatestRef(SyncResource.Settings));\n\n\t\tconst { content } = await client.read(testObject.resource);\n\t\tassert.ok(content !== null);\n\t\tconst actual = parseSettings(content);\n\t\tassert.deepStrictEqual(actual, `{\n\t// Always\n\t\"files.autoSave\": \"afterDelay\",\n\t\"files.simpleDialog.enable\": true,\n\n\t// Workbench\n\t\"workbench.colorTheme\": \"GitHub Sharp\",\n\n\t// Ignored\n\t\"settingsSync.ignoredSettings\": [\n\t\t\"editor.fontFamily\",\n\t\t\"terminal.integrated.shell.osx\"\n\t]\n}`);\n\t}));\n\n\ttest('do not sync ignored and machine settings', () => runWithFakedTimers<void>({ useFakeTimers: true }, async () => {\n\t\tconst settingsContent =\n\t\t\t`{\n\t// Always\n\t\"files.autoSave\": \"afterDelay\",\n\t\"files.simpleDialog.enable\": true,\n\n\t// Editor\n\t\"editor.fontFamily\": \"Fira Code\",\n\n\t// Terminal\n\t\"terminal.integrated.shell.osx\": \"some path\",\n\n\t// Workbench\n\t\"workbench.colorTheme\": \"GitHub Sharp\",\n\n\t// Ignored\n\t\"settingsSync.ignoredSettings\": [\n\t\t\"editor.fontFamily\",\n\t\t\"terminal.integrated.shell.osx\"\n\t],\n\n\t// Machine\n\t\"settingsSync.machine\": \"someValue\",\n}`;\n\t\tawait updateSettings(settingsContent, client);\n\n\t\tawait testObject.sync(await client.getLatestRef(SyncResource.Settings));\n\n\t\tconst { content } = await client.read(testObject.resource);\n\t\tassert.ok(content !== null);\n\t\tconst actual = parseSettings(content);\n\t\tassert.deepStrictEqual(actual, `{\n\t// Always\n\t\"files.autoSave\": \"afterDelay\",\n\t\"files.simpleDialog.enable\": true,\n\n\t// Workbench\n\t\"workbench.colorTheme\": \"GitHub Sharp\",\n\n\t// Ignored\n\t\"settingsSync.ignoredSettings\": [\n\t\t\"editor.fontFamily\",\n\t\t\"terminal.integrated.shell.osx\"\n\t],\n}`);\n\t}));\n\n\ttest('sync throws invalid content error', () => runWithFakedTimers<void>({ useFakeTimers: true }, async () => {\n\t\tconst expected =\n\t\t\t`{\n\t// Always\n\t\"files.autoSave\": \"afterDelay\",\n\t\"files.simpleDialog.enable\": true,\n\n\t// Workbench\n\t\"workbench.colorTheme\": \"GitHub Sharp\",\n\t\"workbench.tree.indent\": 20,\n\t\"workbench.colorCustomizations\": {\n\t\t\"editorLineNumber.activeForeground\": \"#ff0000\",\n\t\t\"[GitHub Sharp]\": {\n\t\t\t\"statusBarItem.remoteBackground\": \"#24292E\",\n\t\t\t\"editorPane.background\": \"#f3f1f11a\"\n\t\t}\n\t}\n\n\t\"gitBranch.base\": \"remote-repo/master\",\n\n\t// Experimental\n\t\"workbench.view.experimental.allowMovingToNewContainer\": true,\n}`;\n\n\t\tawait updateSettings(expected, client);\n\n\t\ttry {\n\t\t\tawait testObject.sync(await client.getLatestRef(SyncResource.Settings));\n\t\t\tassert.fail('should fail with invalid content error');\n\t\t} catch (e) {\n\t\t\tassert.ok(e instanceof UserDataSyncError);\n\t\t\tassert.deepStrictEqual((<UserDataSyncError>e).code, UserDataSyncErrorCode.LocalInvalidContent);\n\t\t}\n\t}));\n\n\ttest('sync throws invalid content error - content is an array', () => runWithFakedTimers<void>({ useFakeTimers: true }, async () => {\n\t\tawait updateSettings('[]', client);\n\t\ttry {\n\t\t\tawait testObject.sync(await client.getLatestRef(SyncResource.Settings));\n\t\t\tassert.fail('should fail with invalid content error');\n\t\t} catch (e) {\n\t\t\tassert.ok(e instanceof UserDataSyncError);\n\t\t\tassert.deepStrictEqual((<UserDataSyncError>e).code, UserDataSyncErrorCode.LocalInvalidContent);\n\t\t}\n\t}));\n\n\ttest('sync when there are conflicts', () => runWithFakedTimers<void>({ useFakeTimers: true }, async () => {\n\t\tconst client2 = disposableStore.add(new UserDataSyncClient(server));\n\t\tawait client2.setUp(true);\n\t\tawait updateSettings(JSON.stringify({\n\t\t\t'a': 1,\n\t\t\t'b': 2,\n\t\t\t'settingsSync.ignoredSettings': ['a']\n\t\t}), client2);\n\t\tawait client2.sync();\n\n\t\tawait updateSettings(JSON.stringify({\n\t\t\t'a': 2,\n\t\t\t'b': 1,\n\t\t\t'settingsSync.ignoredSettings': ['a']\n\t\t}), client);\n\t\tawait testObject.sync(await client.getLatestRef(SyncResource.Settings));\n\n\t\tassert.strictEqual(testObject.status, SyncStatus.HasConflicts);\n\t\tassert.strictEqual(testObject.conflicts.conflicts[0].localResource.toString(), testObject.localResource.toString());\n\n\t\tconst fileService = client.instantiationService.get(IFileService);\n\t\tconst mergeContent = (await fileService.readFile(testObject.conflicts.conflicts[0].previewResource)).value.toString();\n\t\tassert.strictEqual(mergeContent, '');\n\t}));\n\n\ttest('sync profile settings', () => runWithFakedTimers<void>({ useFakeTimers: true }, async () => {\n\t\tconst client2 = disposableStore.add(new UserDataSyncClient(server));\n\t\tawait client2.setUp(true);\n\t\tconst profile = await client2.instantiationService.get(IUserDataProfilesService).createNamedProfile('profile1');\n\t\tawait updateSettings(JSON.stringify({\n\t\t\t'a': 1,\n\t\t\t'b': 2,\n\t\t}), client2, profile);\n\t\tawait client2.sync();\n\n\t\tawait client.sync();\n\n\t\tassert.strictEqual(testObject.status, SyncStatus.Idle);\n\n\t\tconst syncedProfile = client.instantiationService.get(IUserDataProfilesService).profiles.find(p => p.id === profile.id)!;\n\t\tconst content = (await client.instantiationService.get(IFileService).readFile(syncedProfile.settingsResource)).value.toString();\n\t\tassert.deepStrictEqual(JSON.parse(content), {\n\t\t\t'a': 1,\n\t\t\t'b': 2,\n\t\t});\n\t}));\n\n});\n\nsuite('SettingsSync - Manual', () => {\n\n\tconst server = new UserDataSyncTestServer();\n\tlet client: UserDataSyncClient;\n\tlet testObject: SettingsSynchroniser;\n\n\tteardown(async () => {\n\t\tawait client.instantiationService.get(IUserDataSyncStoreService).clear();\n\t});\n\n\tconst disposableStore = ensureNoDisposablesAreLeakedInTestSuite();\n\n\tsetup(async () => {\n\t\tclient = disposableStore.add(new UserDataSyncClient(server));\n\t\tawait client.setUp(true);\n\t\ttestObject = client.getSynchronizer(SyncResource.Settings) as SettingsSynchroniser;\n\t});\n\n\ttest('do not sync ignored settings', () => runWithFakedTimers<void>({ useFakeTimers: true }, async () => {\n\t\tconst settingsContent =\n\t\t\t`{\n\t// Always\n\t\"files.autoSave\": \"afterDelay\",\n\t\"files.simpleDialog.enable\": true,\n\n\t// Editor\n\t\"editor.fontFamily\": \"Fira Code\",\n\n\t// Terminal\n\t\"terminal.integrated.shell.osx\": \"some path\",\n\n\t// Workbench\n\t\"workbench.colorTheme\": \"GitHub Sharp\",\n\n\t// Ignored\n\t\"settingsSync.ignoredSettings\": [\n\t\t\"editor.fontFamily\",\n\t\t\"terminal.integrated.shell.osx\"\n\t]\n}`;\n\t\tawait updateSettings(settingsContent, client);\n\n\t\tlet preview = await testObject.sync(await client.getLatestRef(SyncResource.Settings), true);\n\t\tassert.strictEqual(testObject.status, SyncStatus.Syncing);\n\t\tpreview = await testObject.accept(preview!.resourcePreviews[0].previewResource);\n\t\tpreview = await testObject.apply(false);\n\n\t\tconst { content } = await client.read(testObject.resource);\n\t\tassert.ok(content !== null);\n\t\tconst actual = parseSettings(content);\n\t\tassert.deepStrictEqual(actual, `{\n\t// Always\n\t\"files.autoSave\": \"afterDelay\",\n\t\"files.simpleDialog.enable\": true,\n\n\t// Workbench\n\t\"workbench.colorTheme\": \"GitHub Sharp\",\n\n\t// Ignored\n\t\"settingsSync.ignoredSettings\": [\n\t\t\"editor.fontFamily\",\n\t\t\"terminal.integrated.shell.osx\"\n\t]\n}`);\n\t}));\n\n});\n\nfunction parseSettings(content: string): string {\n\tconst syncData: ISyncData = JSON.parse(content);\n\tconst settingsSyncContent: ISettingsSyncContent = JSON.parse(syncData.content);\n\treturn settingsSyncContent.settings;\n}\n\nasync function updateSettings(content: string, client: UserDataSyncClient, profile?: IUserDataProfile): Promise<void> {\n\tawait client.instantiationService.get(IFileService).writeFile((profile ?? client.instantiationService.get(IUserDataProfilesService).defaultProfile).settingsResource, VSBuffer.fromString(content));\n\tawait client.instantiationService.get(IConfigurationService).reloadConfiguration();\n}\n"]}