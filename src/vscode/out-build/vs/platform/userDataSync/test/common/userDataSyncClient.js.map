{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/platform/userDataSync/test/common/userDataSyncClient.ts","vs/platform/userDataSync/test/common/userDataSyncClient.ts"],"names":[],"mappings":"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","file":"userDataSyncClient.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { bufferToStream, VSBuffer } from '../../../../base/common/buffer.js';\nimport { CancellationToken } from '../../../../base/common/cancellation.js';\nimport { IStringDictionary } from '../../../../base/common/collections.js';\nimport { Emitter } from '../../../../base/common/event.js';\nimport { FormattingOptions } from '../../../../base/common/jsonFormatter.js';\nimport { Disposable } from '../../../../base/common/lifecycle.js';\nimport { Schemas } from '../../../../base/common/network.js';\nimport { joinPath } from '../../../../base/common/resources.js';\nimport { URI } from '../../../../base/common/uri.js';\nimport { generateUuid } from '../../../../base/common/uuid.js';\nimport { IHeaders, IRequestContext, IRequestOptions } from '../../../../base/parts/request/common/request.js';\nimport { IConfigurationService } from '../../../configuration/common/configuration.js';\nimport { ConfigurationService } from '../../../configuration/common/configurationService.js';\nimport { IEnvironmentService } from '../../../environment/common/environment.js';\nimport { GlobalExtensionEnablementService } from '../../../extensionManagement/common/extensionEnablementService.js';\nimport { DidUninstallExtensionEvent, IExtensionGalleryService, IExtensionManagementService, IGlobalExtensionEnablementService, InstallExtensionResult } from '../../../extensionManagement/common/extensionManagement.js';\nimport { IFileService } from '../../../files/common/files.js';\nimport { FileService } from '../../../files/common/fileService.js';\nimport { InMemoryFileSystemProvider } from '../../../files/common/inMemoryFilesystemProvider.js';\nimport { TestInstantiationService } from '../../../instantiation/test/common/instantiationServiceMock.js';\nimport { ILogService, NullLogService } from '../../../log/common/log.js';\nimport product from '../../../product/common/product.js';\nimport { IProductService } from '../../../product/common/productService.js';\nimport { AuthInfo, Credentials, IRequestService } from '../../../request/common/request.js';\nimport { InMemoryStorageService, IStorageService } from '../../../storage/common/storage.js';\nimport { ITelemetryService } from '../../../telemetry/common/telemetry.js';\nimport { NullTelemetryService } from '../../../telemetry/common/telemetryUtils.js';\nimport { IUriIdentityService } from '../../../uriIdentity/common/uriIdentity.js';\nimport { UriIdentityService } from '../../../uriIdentity/common/uriIdentityService.js';\nimport { ExtensionStorageService, IExtensionStorageService } from '../../../extensionManagement/common/extensionStorage.js';\nimport { IgnoredExtensionsManagementService, IIgnoredExtensionsManagementService } from '../../common/ignoredExtensions.js';\nimport { ALL_SYNC_RESOURCES, getDefaultIgnoredSettings, IUserData, IUserDataSyncLocalStoreService, IUserDataSyncLogService, IUserDataSyncEnablementService, IUserDataSyncService, IUserDataSyncStoreManagementService, IUserDataSyncStoreService, IUserDataSyncUtilService, registerConfiguration, ServerResource, SyncResource, IUserDataSynchroniser, IUserDataResourceManifest, IUserDataCollectionManifest, USER_DATA_SYNC_SCHEME, IUserDataManifest } from '../../common/userDataSync.js';\nimport { IUserDataSyncAccountService, UserDataSyncAccountService } from '../../common/userDataSyncAccount.js';\nimport { UserDataSyncLocalStoreService } from '../../common/userDataSyncLocalStoreService.js';\nimport { IUserDataSyncMachinesService, UserDataSyncMachinesService } from '../../common/userDataSyncMachines.js';\nimport { UserDataSyncEnablementService } from '../../common/userDataSyncEnablementService.js';\nimport { UserDataSyncService } from '../../common/userDataSyncService.js';\nimport { UserDataSyncStoreManagementService, UserDataSyncStoreService } from '../../common/userDataSyncStoreService.js';\nimport { InMemoryUserDataProfilesService, IUserDataProfile, IUserDataProfilesService } from '../../../userDataProfile/common/userDataProfile.js';\nimport { NullPolicyService } from '../../../policy/common/policy.js';\nimport { IUserDataProfileStorageService } from '../../../userDataProfile/common/userDataProfileStorageService.js';\nimport { TestUserDataProfileStorageService } from '../../../userDataProfile/test/common/userDataProfileStorageService.test.js';\n\nexport class UserDataSyncClient extends Disposable {\n\n\treadonly instantiationService: TestInstantiationService;\n\n\tconstructor(readonly testServer: UserDataSyncTestServer = new UserDataSyncTestServer()) {\n\t\tsuper();\n\t\tthis.instantiationService = this._register(new TestInstantiationService());\n\t}\n\n\tasync setUp(empty: boolean = false): Promise<void> {\n\t\tthis._register(registerConfiguration());\n\n\t\tconst logService = this.instantiationService.stub(ILogService, new NullLogService());\n\n\t\tconst userRoamingDataHome = URI.file('userdata').with({ scheme: Schemas.inMemory });\n\t\tconst userDataSyncHome = joinPath(userRoamingDataHome, '.sync');\n\t\tconst environmentService = this.instantiationService.stub(IEnvironmentService, {\n\t\t\tuserDataSyncHome,\n\t\t\tuserRoamingDataHome,\n\t\t\tcacheHome: joinPath(userRoamingDataHome, 'cache'),\n\t\t\targvResource: joinPath(userRoamingDataHome, 'argv.json'),\n\t\t\tsync: 'on',\n\t\t});\n\n\t\tthis.instantiationService.stub(IProductService, {\n\t\t\t_serviceBrand: undefined, ...product, ...{\n\t\t\t\t'configurationSync.store': {\n\t\t\t\t\turl: this.testServer.url,\n\t\t\t\t\tstableUrl: this.testServer.url,\n\t\t\t\t\tinsidersUrl: this.testServer.url,\n\t\t\t\t\tcanSwitch: false,\n\t\t\t\t\tauthenticationProviders: { 'test': { scopes: [] } }\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tconst fileService = this._register(new FileService(logService));\n\t\tthis._register(fileService.registerProvider(Schemas.inMemory, this._register(new InMemoryFileSystemProvider())));\n\t\tthis._register(fileService.registerProvider(USER_DATA_SYNC_SCHEME, this._register(new InMemoryFileSystemProvider())));\n\t\tthis.instantiationService.stub(IFileService, fileService);\n\n\t\tconst uriIdentityService = this._register(this.instantiationService.createInstance(UriIdentityService));\n\t\tthis.instantiationService.stub(IUriIdentityService, uriIdentityService);\n\n\t\tconst userDataProfilesService = this._register(new InMemoryUserDataProfilesService(environmentService, fileService, uriIdentityService, logService));\n\t\tthis.instantiationService.stub(IUserDataProfilesService, userDataProfilesService);\n\n\t\tconst storageService = this._register(new TestStorageService(userDataProfilesService.defaultProfile));\n\t\tthis.instantiationService.stub(IStorageService, this._register(storageService));\n\t\tthis.instantiationService.stub(IUserDataProfileStorageService, this._register(new TestUserDataProfileStorageService(false, storageService)));\n\n\t\tconst configurationService = this._register(new ConfigurationService(userDataProfilesService.defaultProfile.settingsResource, fileService, new NullPolicyService(), logService));\n\t\tawait configurationService.initialize();\n\t\tthis.instantiationService.stub(IConfigurationService, configurationService);\n\n\t\tthis.instantiationService.stub(IRequestService, this.testServer);\n\n\t\tthis.instantiationService.stub(IUserDataSyncLogService, logService);\n\t\tthis.instantiationService.stub(ITelemetryService, NullTelemetryService);\n\t\tthis.instantiationService.stub(IUserDataSyncStoreManagementService, this._register(this.instantiationService.createInstance(UserDataSyncStoreManagementService)));\n\t\tthis.instantiationService.stub(IUserDataSyncStoreService, this._register(this.instantiationService.createInstance(UserDataSyncStoreService)));\n\n\t\tconst userDataSyncAccountService: IUserDataSyncAccountService = this._register(this.instantiationService.createInstance(UserDataSyncAccountService));\n\t\tawait userDataSyncAccountService.updateAccount({ authenticationProviderId: 'authenticationProviderId', token: 'token' });\n\t\tthis.instantiationService.stub(IUserDataSyncAccountService, userDataSyncAccountService);\n\n\t\tthis.instantiationService.stub(IUserDataSyncMachinesService, this._register(this.instantiationService.createInstance(UserDataSyncMachinesService)));\n\t\tthis.instantiationService.stub(IUserDataSyncLocalStoreService, this._register(this.instantiationService.createInstance(UserDataSyncLocalStoreService)));\n\t\tthis.instantiationService.stub(IUserDataSyncUtilService, new TestUserDataSyncUtilService());\n\t\tthis.instantiationService.stub(IUserDataSyncEnablementService, this._register(this.instantiationService.createInstance(UserDataSyncEnablementService)));\n\n\t\tthis.instantiationService.stub(IExtensionManagementService, {\n\t\t\tasync getInstalled() { return []; },\n\t\t\tonDidInstallExtensions: new Emitter<readonly InstallExtensionResult[]>().event,\n\t\t\tonDidUninstallExtension: new Emitter<DidUninstallExtensionEvent>().event,\n\t\t});\n\t\tthis.instantiationService.stub(IGlobalExtensionEnablementService, this._register(this.instantiationService.createInstance(GlobalExtensionEnablementService)));\n\t\tthis.instantiationService.stub(IExtensionStorageService, this._register(this.instantiationService.createInstance(ExtensionStorageService)));\n\t\tthis.instantiationService.stub(IIgnoredExtensionsManagementService, this.instantiationService.createInstance(IgnoredExtensionsManagementService));\n\t\tthis.instantiationService.stub(IExtensionGalleryService, {\n\t\t\tisEnabled() { return true; },\n\t\t\tasync getCompatibleExtension() { return null; }\n\t\t});\n\n\t\tthis.instantiationService.stub(IUserDataSyncService, this._register(this.instantiationService.createInstance(UserDataSyncService)));\n\n\t\tif (!empty) {\n\t\t\tawait fileService.writeFile(userDataProfilesService.defaultProfile.settingsResource, VSBuffer.fromString(JSON.stringify({})));\n\t\t\tawait fileService.writeFile(userDataProfilesService.defaultProfile.keybindingsResource, VSBuffer.fromString(JSON.stringify([])));\n\t\t\tawait fileService.writeFile(joinPath(userDataProfilesService.defaultProfile.snippetsHome, 'c.json'), VSBuffer.fromString(`{}`));\n\t\t\tawait fileService.writeFile(joinPath(userDataProfilesService.defaultProfile.promptsHome, 'c.prompt.md'), VSBuffer.fromString(' '));\n\t\t\tawait fileService.writeFile(userDataProfilesService.defaultProfile.tasksResource, VSBuffer.fromString(`{}`));\n\t\t\tawait fileService.writeFile(environmentService.argvResource, VSBuffer.fromString(JSON.stringify({ 'locale': 'en' })));\n\t\t}\n\t\tawait configurationService.reloadConfiguration();\n\n\t\t// `prompts` resource is disabled by default, so enable it for tests\n\t\tthis.instantiationService\n\t\t\t.get(IUserDataSyncEnablementService)\n\t\t\t.setResourceEnablement(SyncResource.Prompts, true);\n\t}\n\n\tasync sync(): Promise<void> {\n\t\tawait (await this.instantiationService.get(IUserDataSyncService).createSyncTask(null)).run();\n\t}\n\n\tread(resource: SyncResource, collection?: string): Promise<IUserData> {\n\t\treturn this.instantiationService.get(IUserDataSyncStoreService).readResource(resource, null, collection);\n\t}\n\n\tasync getLatestRef(resource: SyncResource): Promise<string | null> {\n\t\tconst manifest = await this._getResourceManifest();\n\t\treturn manifest?.[resource] ?? null;\n\t}\n\n\tasync _getResourceManifest(): Promise<IUserDataResourceManifest | null> {\n\t\tconst manifest = await this.instantiationService.get(IUserDataSyncStoreService).manifest(null);\n\t\treturn manifest?.latest ?? null;\n\t}\n\n\tgetSynchronizer(source: SyncResource): IUserDataSynchroniser {\n\t\treturn (this.instantiationService.get(IUserDataSyncService) as UserDataSyncService).getOrCreateActiveProfileSynchronizer(this.instantiationService.get(IUserDataProfilesService).defaultProfile, undefined).enabled.find(s => s.resource === source)!;\n\t}\n\n}\n\nconst ALL_SERVER_RESOURCES: ServerResource[] = [...ALL_SYNC_RESOURCES, 'machines'];\n\nexport class UserDataSyncTestServer implements IRequestService {\n\n\t_serviceBrand: undefined;\n\n\treadonly url: string = 'http://host:3000';\n\tprivate session: string | null = null;\n\tprivate readonly collections = new Map<string, Map<ServerResource, IUserData>>();\n\tprivate readonly data = new Map<ServerResource, IUserData>();\n\n\tprivate _requests: { url: string; type: string; headers?: IHeaders }[] = [];\n\tget requests(): { url: string; type: string; headers?: IHeaders }[] { return this._requests; }\n\n\tprivate _requestsWithAllHeaders: { url: string; type: string; headers?: IHeaders }[] = [];\n\tget requestsWithAllHeaders(): { url: string; type: string; headers?: IHeaders }[] { return this._requestsWithAllHeaders; }\n\n\tprivate _responses: { status: number }[] = [];\n\tget responses(): { status: number }[] { return this._responses; }\n\treset(): void { this._requests = []; this._responses = []; this._requestsWithAllHeaders = []; }\n\n\tprivate manifestRef = 0;\n\tprivate collectionCounter = 0;\n\n\tconstructor(private readonly rateLimit = Number.MAX_SAFE_INTEGER, private readonly retryAfter?: number) { }\n\n\tasync resolveProxy(url: string): Promise<string | undefined> { return url; }\n\tasync lookupAuthorization(authInfo: AuthInfo): Promise<Credentials | undefined> { return undefined; }\n\tasync lookupKerberosAuthorization(url: string): Promise<string | undefined> { return undefined; }\n\tasync loadCertificates(): Promise<string[]> { return []; }\n\n\tasync request(options: IRequestOptions, token: CancellationToken): Promise<IRequestContext> {\n\t\tif (this._requests.length === this.rateLimit) {\n\t\t\treturn this.toResponse(429, this.retryAfter ? { 'retry-after': `${this.retryAfter}` } : undefined);\n\t\t}\n\t\tconst headers: IHeaders = {};\n\t\tif (options.headers) {\n\t\t\tif (options.headers['If-None-Match']) {\n\t\t\t\theaders['If-None-Match'] = options.headers['If-None-Match'];\n\t\t\t}\n\t\t\tif (options.headers['If-Match']) {\n\t\t\t\theaders['If-Match'] = options.headers['If-Match'];\n\t\t\t}\n\t\t}\n\t\tthis._requests.push({ url: options.url!, type: options.type!, headers });\n\t\tthis._requestsWithAllHeaders.push({ url: options.url!, type: options.type!, headers: options.headers });\n\t\tconst requestContext = await this.doRequest(options);\n\t\tthis._responses.push({ status: requestContext.res.statusCode! });\n\t\treturn requestContext;\n\t}\n\n\tprivate async doRequest(options: IRequestOptions): Promise<IRequestContext> {\n\t\tconst versionUrl = `${this.url}/v1/`;\n\t\tconst relativePath = options.url!.indexOf(versionUrl) === 0 ? options.url!.substring(versionUrl.length) : undefined;\n\t\tconst segments = relativePath ? relativePath.split('/') : [];\n\t\tif (options.type === 'GET' && segments.length === 1 && segments[0] === 'manifest') {\n\t\t\treturn this.getManifest(options.headers);\n\t\t}\n\t\tif (options.type === 'GET' && segments.length === 3 && segments[0] === 'resource') {\n\t\t\treturn this.getResourceData(undefined, segments[1], segments[2] === 'latest' ? undefined : segments[2], options.headers);\n\t\t}\n\t\tif (options.type === 'POST' && segments.length === 2 && segments[0] === 'resource') {\n\t\t\treturn this.writeData(undefined, segments[1], options.data, options.headers);\n\t\t}\n\t\t// resources in collection\n\t\tif (options.type === 'GET' && segments.length === 5 && segments[0] === 'collection' && segments[2] === 'resource') {\n\t\t\treturn this.getResourceData(segments[1], segments[3], segments[4] === 'latest' ? undefined : segments[4], options.headers);\n\t\t}\n\t\tif (options.type === 'POST' && segments.length === 4 && segments[0] === 'collection' && segments[2] === 'resource') {\n\t\t\treturn this.writeData(segments[1], segments[3], options.data, options.headers);\n\t\t}\n\t\tif (options.type === 'DELETE' && segments.length === 2 && segments[0] === 'resource') {\n\t\t\treturn this.deleteResourceData(undefined, segments[1]);\n\t\t}\n\t\tif (options.type === 'DELETE' && segments.length === 1 && segments[0] === 'resource') {\n\t\t\treturn this.clear(options.headers);\n\t\t}\n\t\tif (options.type === 'DELETE' && segments[0] === 'collection') {\n\t\t\treturn this.toResponse(204);\n\t\t}\n\t\tif (options.type === 'POST' && segments.length === 1 && segments[0] === 'collection') {\n\t\t\treturn this.createCollection();\n\t\t}\n\t\treturn this.toResponse(501);\n\t}\n\n\tprivate async getManifest(headers?: IHeaders): Promise<IRequestContext> {\n\t\tif (this.session) {\n\t\t\tconst latest: Record<ServerResource, string> = Object.create({});\n\t\t\tthis.data.forEach((value, key) => latest[key] = value.ref);\n\t\t\tlet collections: IUserDataCollectionManifest | undefined = undefined;\n\t\t\tif (this.collectionCounter) {\n\t\t\t\tcollections = {};\n\t\t\t\tfor (let collectionId = 1; collectionId <= this.collectionCounter; collectionId++) {\n\t\t\t\t\tconst collectionData = this.collections.get(`${collectionId}`);\n\t\t\t\t\tif (collectionData) {\n\t\t\t\t\t\tconst latest: Record<ServerResource, string> = Object.create({});\n\t\t\t\t\t\tcollectionData.forEach((value, key) => latest[key] = value.ref);\n\t\t\t\t\t\tcollections[`${collectionId}`] = { latest };\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tconst manifest: IUserDataManifest = { session: this.session, latest, collections, ref: '1' };\n\t\t\treturn this.toResponse(200, { 'Content-Type': 'application/json', etag: `${this.manifestRef++}` }, JSON.stringify(manifest));\n\t\t}\n\t\treturn this.toResponse(204, { etag: `${this.manifestRef++}` });\n\t}\n\n\tprivate async getResourceData(collection: string | undefined, resource: string, ref?: string, headers: IHeaders = {}): Promise<IRequestContext> {\n\t\tconst collectionData = collection ? this.collections.get(collection) : this.data;\n\t\tif (!collectionData) {\n\t\t\treturn this.toResponse(501);\n\t\t}\n\n\t\tconst resourceKey = ALL_SERVER_RESOURCES.find(key => key === resource);\n\t\tif (resourceKey) {\n\t\t\tconst data = collectionData.get(resourceKey);\n\t\t\tif (ref && data?.ref !== ref) {\n\t\t\t\treturn this.toResponse(404);\n\t\t\t}\n\t\t\tif (!data) {\n\t\t\t\treturn this.toResponse(204, { etag: '0' });\n\t\t\t}\n\t\t\tif (headers['If-None-Match'] === data.ref) {\n\t\t\t\treturn this.toResponse(304);\n\t\t\t}\n\t\t\treturn this.toResponse(200, { etag: data.ref }, data.content || '');\n\t\t}\n\t\treturn this.toResponse(204);\n\t}\n\n\tprivate async writeData(collection: string | undefined, resource: string, content: string = '', headers: IHeaders = {}): Promise<IRequestContext> {\n\t\tif (!this.session) {\n\t\t\tthis.session = generateUuid();\n\t\t}\n\t\tconst collectionData = collection ? this.collections.get(collection) : this.data;\n\t\tif (!collectionData) {\n\t\t\treturn this.toResponse(501);\n\t\t}\n\t\tconst resourceKey = ALL_SERVER_RESOURCES.find(key => key === resource);\n\t\tif (resourceKey) {\n\t\t\tconst data = collectionData.get(resourceKey);\n\t\t\tif (headers['If-Match'] !== undefined && headers['If-Match'] !== (data ? data.ref : '0')) {\n\t\t\t\treturn this.toResponse(412);\n\t\t\t}\n\t\t\tconst ref = `${parseInt(data?.ref || '0') + 1}`;\n\t\t\tcollectionData.set(resourceKey, { ref, content });\n\t\t\treturn this.toResponse(200, { etag: ref });\n\t\t}\n\t\treturn this.toResponse(204);\n\t}\n\n\tprivate async deleteResourceData(collection: string | undefined, resource: string, headers: IHeaders = {}): Promise<IRequestContext> {\n\t\tconst collectionData = collection ? this.collections.get(collection) : this.data;\n\t\tif (!collectionData) {\n\t\t\treturn this.toResponse(501);\n\t\t}\n\n\t\tconst resourceKey = ALL_SERVER_RESOURCES.find(key => key === resource);\n\t\tif (resourceKey) {\n\t\t\tcollectionData.delete(resourceKey);\n\t\t\treturn this.toResponse(200);\n\t\t}\n\n\t\treturn this.toResponse(404);\n\t}\n\n\tprivate async createCollection(): Promise<IRequestContext> {\n\t\tconst collectionId = `${++this.collectionCounter}`;\n\t\tthis.collections.set(collectionId, new Map());\n\t\treturn this.toResponse(200, {}, collectionId);\n\t}\n\n\tasync clear(headers?: IHeaders): Promise<IRequestContext> {\n\t\tthis.collections.clear();\n\t\tthis.data.clear();\n\t\tthis.session = null;\n\t\tthis.collectionCounter = 0;\n\t\treturn this.toResponse(204);\n\t}\n\n\tprivate toResponse(statusCode: number, headers?: IHeaders, data?: string): IRequestContext {\n\t\treturn {\n\t\t\tres: {\n\t\t\t\theaders: headers || {},\n\t\t\t\tstatusCode\n\t\t\t},\n\t\t\tstream: bufferToStream(VSBuffer.fromString(data || ''))\n\t\t};\n\t}\n}\n\nexport class TestUserDataSyncUtilService implements IUserDataSyncUtilService {\n\n\t_serviceBrand: undefined;\n\n\tasync resolveDefaultCoreIgnoredSettings(): Promise<string[]> {\n\t\treturn getDefaultIgnoredSettings();\n\t}\n\n\tasync resolveUserBindings(userbindings: string[]): Promise<IStringDictionary<string>> {\n\t\tconst keys: IStringDictionary<string> = {};\n\t\tfor (const keybinding of userbindings) {\n\t\t\tkeys[keybinding] = keybinding;\n\t\t}\n\t\treturn keys;\n\t}\n\n\tasync resolveFormattingOptions(file?: URI): Promise<FormattingOptions> {\n\t\treturn { eol: '\\n', insertSpaces: false, tabSize: 4 };\n\t}\n\n}\n\nclass TestStorageService extends InMemoryStorageService {\n\tconstructor(private readonly profileStorageProfile: IUserDataProfile) {\n\t\tsuper();\n\t}\n\toverride hasScope(profile: IUserDataProfile): boolean {\n\t\treturn this.profileStorageProfile.id === profile.id;\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { bufferToStream, VSBuffer } from '../../../../base/common/buffer.js';\nimport { CancellationToken } from '../../../../base/common/cancellation.js';\nimport { IStringDictionary } from '../../../../base/common/collections.js';\nimport { Emitter } from '../../../../base/common/event.js';\nimport { FormattingOptions } from '../../../../base/common/jsonFormatter.js';\nimport { Disposable } from '../../../../base/common/lifecycle.js';\nimport { Schemas } from '../../../../base/common/network.js';\nimport { joinPath } from '../../../../base/common/resources.js';\nimport { URI } from '../../../../base/common/uri.js';\nimport { generateUuid } from '../../../../base/common/uuid.js';\nimport { IHeaders, IRequestContext, IRequestOptions } from '../../../../base/parts/request/common/request.js';\nimport { IConfigurationService } from '../../../configuration/common/configuration.js';\nimport { ConfigurationService } from '../../../configuration/common/configurationService.js';\nimport { IEnvironmentService } from '../../../environment/common/environment.js';\nimport { GlobalExtensionEnablementService } from '../../../extensionManagement/common/extensionEnablementService.js';\nimport { DidUninstallExtensionEvent, IExtensionGalleryService, IExtensionManagementService, IGlobalExtensionEnablementService, InstallExtensionResult } from '../../../extensionManagement/common/extensionManagement.js';\nimport { IFileService } from '../../../files/common/files.js';\nimport { FileService } from '../../../files/common/fileService.js';\nimport { InMemoryFileSystemProvider } from '../../../files/common/inMemoryFilesystemProvider.js';\nimport { TestInstantiationService } from '../../../instantiation/test/common/instantiationServiceMock.js';\nimport { ILogService, NullLogService } from '../../../log/common/log.js';\nimport product from '../../../product/common/product.js';\nimport { IProductService } from '../../../product/common/productService.js';\nimport { AuthInfo, Credentials, IRequestService } from '../../../request/common/request.js';\nimport { InMemoryStorageService, IStorageService } from '../../../storage/common/storage.js';\nimport { ITelemetryService } from '../../../telemetry/common/telemetry.js';\nimport { NullTelemetryService } from '../../../telemetry/common/telemetryUtils.js';\nimport { IUriIdentityService } from '../../../uriIdentity/common/uriIdentity.js';\nimport { UriIdentityService } from '../../../uriIdentity/common/uriIdentityService.js';\nimport { ExtensionStorageService, IExtensionStorageService } from '../../../extensionManagement/common/extensionStorage.js';\nimport { IgnoredExtensionsManagementService, IIgnoredExtensionsManagementService } from '../../common/ignoredExtensions.js';\nimport { ALL_SYNC_RESOURCES, getDefaultIgnoredSettings, IUserData, IUserDataSyncLocalStoreService, IUserDataSyncLogService, IUserDataSyncEnablementService, IUserDataSyncService, IUserDataSyncStoreManagementService, IUserDataSyncStoreService, IUserDataSyncUtilService, registerConfiguration, ServerResource, SyncResource, IUserDataSynchroniser, IUserDataResourceManifest, IUserDataCollectionManifest, USER_DATA_SYNC_SCHEME, IUserDataManifest } from '../../common/userDataSync.js';\nimport { IUserDataSyncAccountService, UserDataSyncAccountService } from '../../common/userDataSyncAccount.js';\nimport { UserDataSyncLocalStoreService } from '../../common/userDataSyncLocalStoreService.js';\nimport { IUserDataSyncMachinesService, UserDataSyncMachinesService } from '../../common/userDataSyncMachines.js';\nimport { UserDataSyncEnablementService } from '../../common/userDataSyncEnablementService.js';\nimport { UserDataSyncService } from '../../common/userDataSyncService.js';\nimport { UserDataSyncStoreManagementService, UserDataSyncStoreService } from '../../common/userDataSyncStoreService.js';\nimport { InMemoryUserDataProfilesService, IUserDataProfile, IUserDataProfilesService } from '../../../userDataProfile/common/userDataProfile.js';\nimport { NullPolicyService } from '../../../policy/common/policy.js';\nimport { IUserDataProfileStorageService } from '../../../userDataProfile/common/userDataProfileStorageService.js';\nimport { TestUserDataProfileStorageService } from '../../../userDataProfile/test/common/userDataProfileStorageService.test.js';\n\nexport class UserDataSyncClient extends Disposable {\n\n\treadonly instantiationService: TestInstantiationService;\n\n\tconstructor(readonly testServer: UserDataSyncTestServer = new UserDataSyncTestServer()) {\n\t\tsuper();\n\t\tthis.instantiationService = this._register(new TestInstantiationService());\n\t}\n\n\tasync setUp(empty: boolean = false): Promise<void> {\n\t\tthis._register(registerConfiguration());\n\n\t\tconst logService = this.instantiationService.stub(ILogService, new NullLogService());\n\n\t\tconst userRoamingDataHome = URI.file('userdata').with({ scheme: Schemas.inMemory });\n\t\tconst userDataSyncHome = joinPath(userRoamingDataHome, '.sync');\n\t\tconst environmentService = this.instantiationService.stub(IEnvironmentService, {\n\t\t\tuserDataSyncHome,\n\t\t\tuserRoamingDataHome,\n\t\t\tcacheHome: joinPath(userRoamingDataHome, 'cache'),\n\t\t\targvResource: joinPath(userRoamingDataHome, 'argv.json'),\n\t\t\tsync: 'on',\n\t\t});\n\n\t\tthis.instantiationService.stub(IProductService, {\n\t\t\t_serviceBrand: undefined, ...product, ...{\n\t\t\t\t'configurationSync.store': {\n\t\t\t\t\turl: this.testServer.url,\n\t\t\t\t\tstableUrl: this.testServer.url,\n\t\t\t\t\tinsidersUrl: this.testServer.url,\n\t\t\t\t\tcanSwitch: false,\n\t\t\t\t\tauthenticationProviders: { 'test': { scopes: [] } }\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tconst fileService = this._register(new FileService(logService));\n\t\tthis._register(fileService.registerProvider(Schemas.inMemory, this._register(new InMemoryFileSystemProvider())));\n\t\tthis._register(fileService.registerProvider(USER_DATA_SYNC_SCHEME, this._register(new InMemoryFileSystemProvider())));\n\t\tthis.instantiationService.stub(IFileService, fileService);\n\n\t\tconst uriIdentityService = this._register(this.instantiationService.createInstance(UriIdentityService));\n\t\tthis.instantiationService.stub(IUriIdentityService, uriIdentityService);\n\n\t\tconst userDataProfilesService = this._register(new InMemoryUserDataProfilesService(environmentService, fileService, uriIdentityService, logService));\n\t\tthis.instantiationService.stub(IUserDataProfilesService, userDataProfilesService);\n\n\t\tconst storageService = this._register(new TestStorageService(userDataProfilesService.defaultProfile));\n\t\tthis.instantiationService.stub(IStorageService, this._register(storageService));\n\t\tthis.instantiationService.stub(IUserDataProfileStorageService, this._register(new TestUserDataProfileStorageService(false, storageService)));\n\n\t\tconst configurationService = this._register(new ConfigurationService(userDataProfilesService.defaultProfile.settingsResource, fileService, new NullPolicyService(), logService));\n\t\tawait configurationService.initialize();\n\t\tthis.instantiationService.stub(IConfigurationService, configurationService);\n\n\t\tthis.instantiationService.stub(IRequestService, this.testServer);\n\n\t\tthis.instantiationService.stub(IUserDataSyncLogService, logService);\n\t\tthis.instantiationService.stub(ITelemetryService, NullTelemetryService);\n\t\tthis.instantiationService.stub(IUserDataSyncStoreManagementService, this._register(this.instantiationService.createInstance(UserDataSyncStoreManagementService)));\n\t\tthis.instantiationService.stub(IUserDataSyncStoreService, this._register(this.instantiationService.createInstance(UserDataSyncStoreService)));\n\n\t\tconst userDataSyncAccountService: IUserDataSyncAccountService = this._register(this.instantiationService.createInstance(UserDataSyncAccountService));\n\t\tawait userDataSyncAccountService.updateAccount({ authenticationProviderId: 'authenticationProviderId', token: 'token' });\n\t\tthis.instantiationService.stub(IUserDataSyncAccountService, userDataSyncAccountService);\n\n\t\tthis.instantiationService.stub(IUserDataSyncMachinesService, this._register(this.instantiationService.createInstance(UserDataSyncMachinesService)));\n\t\tthis.instantiationService.stub(IUserDataSyncLocalStoreService, this._register(this.instantiationService.createInstance(UserDataSyncLocalStoreService)));\n\t\tthis.instantiationService.stub(IUserDataSyncUtilService, new TestUserDataSyncUtilService());\n\t\tthis.instantiationService.stub(IUserDataSyncEnablementService, this._register(this.instantiationService.createInstance(UserDataSyncEnablementService)));\n\n\t\tthis.instantiationService.stub(IExtensionManagementService, {\n\t\t\tasync getInstalled() { return []; },\n\t\t\tonDidInstallExtensions: new Emitter<readonly InstallExtensionResult[]>().event,\n\t\t\tonDidUninstallExtension: new Emitter<DidUninstallExtensionEvent>().event,\n\t\t});\n\t\tthis.instantiationService.stub(IGlobalExtensionEnablementService, this._register(this.instantiationService.createInstance(GlobalExtensionEnablementService)));\n\t\tthis.instantiationService.stub(IExtensionStorageService, this._register(this.instantiationService.createInstance(ExtensionStorageService)));\n\t\tthis.instantiationService.stub(IIgnoredExtensionsManagementService, this.instantiationService.createInstance(IgnoredExtensionsManagementService));\n\t\tthis.instantiationService.stub(IExtensionGalleryService, {\n\t\t\tisEnabled() { return true; },\n\t\t\tasync getCompatibleExtension() { return null; }\n\t\t});\n\n\t\tthis.instantiationService.stub(IUserDataSyncService, this._register(this.instantiationService.createInstance(UserDataSyncService)));\n\n\t\tif (!empty) {\n\t\t\tawait fileService.writeFile(userDataProfilesService.defaultProfile.settingsResource, VSBuffer.fromString(JSON.stringify({})));\n\t\t\tawait fileService.writeFile(userDataProfilesService.defaultProfile.keybindingsResource, VSBuffer.fromString(JSON.stringify([])));\n\t\t\tawait fileService.writeFile(joinPath(userDataProfilesService.defaultProfile.snippetsHome, 'c.json'), VSBuffer.fromString(`{}`));\n\t\t\tawait fileService.writeFile(joinPath(userDataProfilesService.defaultProfile.promptsHome, 'c.prompt.md'), VSBuffer.fromString(' '));\n\t\t\tawait fileService.writeFile(userDataProfilesService.defaultProfile.tasksResource, VSBuffer.fromString(`{}`));\n\t\t\tawait fileService.writeFile(environmentService.argvResource, VSBuffer.fromString(JSON.stringify({ 'locale': 'en' })));\n\t\t}\n\t\tawait configurationService.reloadConfiguration();\n\n\t\t// `prompts` resource is disabled by default, so enable it for tests\n\t\tthis.instantiationService\n\t\t\t.get(IUserDataSyncEnablementService)\n\t\t\t.setResourceEnablement(SyncResource.Prompts, true);\n\t}\n\n\tasync sync(): Promise<void> {\n\t\tawait (await this.instantiationService.get(IUserDataSyncService).createSyncTask(null)).run();\n\t}\n\n\tread(resource: SyncResource, collection?: string): Promise<IUserData> {\n\t\treturn this.instantiationService.get(IUserDataSyncStoreService).readResource(resource, null, collection);\n\t}\n\n\tasync getLatestRef(resource: SyncResource): Promise<string | null> {\n\t\tconst manifest = await this._getResourceManifest();\n\t\treturn manifest?.[resource] ?? null;\n\t}\n\n\tasync _getResourceManifest(): Promise<IUserDataResourceManifest | null> {\n\t\tconst manifest = await this.instantiationService.get(IUserDataSyncStoreService).manifest(null);\n\t\treturn manifest?.latest ?? null;\n\t}\n\n\tgetSynchronizer(source: SyncResource): IUserDataSynchroniser {\n\t\treturn (this.instantiationService.get(IUserDataSyncService) as UserDataSyncService).getOrCreateActiveProfileSynchronizer(this.instantiationService.get(IUserDataProfilesService).defaultProfile, undefined).enabled.find(s => s.resource === source)!;\n\t}\n\n}\n\nconst ALL_SERVER_RESOURCES: ServerResource[] = [...ALL_SYNC_RESOURCES, 'machines'];\n\nexport class UserDataSyncTestServer implements IRequestService {\n\n\t_serviceBrand: undefined;\n\n\treadonly url: string = 'http://host:3000';\n\tprivate session: string | null = null;\n\tprivate readonly collections = new Map<string, Map<ServerResource, IUserData>>();\n\tprivate readonly data = new Map<ServerResource, IUserData>();\n\n\tprivate _requests: { url: string; type: string; headers?: IHeaders }[] = [];\n\tget requests(): { url: string; type: string; headers?: IHeaders }[] { return this._requests; }\n\n\tprivate _requestsWithAllHeaders: { url: string; type: string; headers?: IHeaders }[] = [];\n\tget requestsWithAllHeaders(): { url: string; type: string; headers?: IHeaders }[] { return this._requestsWithAllHeaders; }\n\n\tprivate _responses: { status: number }[] = [];\n\tget responses(): { status: number }[] { return this._responses; }\n\treset(): void { this._requests = []; this._responses = []; this._requestsWithAllHeaders = []; }\n\n\tprivate manifestRef = 0;\n\tprivate collectionCounter = 0;\n\n\tconstructor(private readonly rateLimit = Number.MAX_SAFE_INTEGER, private readonly retryAfter?: number) { }\n\n\tasync resolveProxy(url: string): Promise<string | undefined> { return url; }\n\tasync lookupAuthorization(authInfo: AuthInfo): Promise<Credentials | undefined> { return undefined; }\n\tasync lookupKerberosAuthorization(url: string): Promise<string | undefined> { return undefined; }\n\tasync loadCertificates(): Promise<string[]> { return []; }\n\n\tasync request(options: IRequestOptions, token: CancellationToken): Promise<IRequestContext> {\n\t\tif (this._requests.length === this.rateLimit) {\n\t\t\treturn this.toResponse(429, this.retryAfter ? { 'retry-after': `${this.retryAfter}` } : undefined);\n\t\t}\n\t\tconst headers: IHeaders = {};\n\t\tif (options.headers) {\n\t\t\tif (options.headers['If-None-Match']) {\n\t\t\t\theaders['If-None-Match'] = options.headers['If-None-Match'];\n\t\t\t}\n\t\t\tif (options.headers['If-Match']) {\n\t\t\t\theaders['If-Match'] = options.headers['If-Match'];\n\t\t\t}\n\t\t}\n\t\tthis._requests.push({ url: options.url!, type: options.type!, headers });\n\t\tthis._requestsWithAllHeaders.push({ url: options.url!, type: options.type!, headers: options.headers });\n\t\tconst requestContext = await this.doRequest(options);\n\t\tthis._responses.push({ status: requestContext.res.statusCode! });\n\t\treturn requestContext;\n\t}\n\n\tprivate async doRequest(options: IRequestOptions): Promise<IRequestContext> {\n\t\tconst versionUrl = `${this.url}/v1/`;\n\t\tconst relativePath = options.url!.indexOf(versionUrl) === 0 ? options.url!.substring(versionUrl.length) : undefined;\n\t\tconst segments = relativePath ? relativePath.split('/') : [];\n\t\tif (options.type === 'GET' && segments.length === 1 && segments[0] === 'manifest') {\n\t\t\treturn this.getManifest(options.headers);\n\t\t}\n\t\tif (options.type === 'GET' && segments.length === 3 && segments[0] === 'resource') {\n\t\t\treturn this.getResourceData(undefined, segments[1], segments[2] === 'latest' ? undefined : segments[2], options.headers);\n\t\t}\n\t\tif (options.type === 'POST' && segments.length === 2 && segments[0] === 'resource') {\n\t\t\treturn this.writeData(undefined, segments[1], options.data, options.headers);\n\t\t}\n\t\t// resources in collection\n\t\tif (options.type === 'GET' && segments.length === 5 && segments[0] === 'collection' && segments[2] === 'resource') {\n\t\t\treturn this.getResourceData(segments[1], segments[3], segments[4] === 'latest' ? undefined : segments[4], options.headers);\n\t\t}\n\t\tif (options.type === 'POST' && segments.length === 4 && segments[0] === 'collection' && segments[2] === 'resource') {\n\t\t\treturn this.writeData(segments[1], segments[3], options.data, options.headers);\n\t\t}\n\t\tif (options.type === 'DELETE' && segments.length === 2 && segments[0] === 'resource') {\n\t\t\treturn this.deleteResourceData(undefined, segments[1]);\n\t\t}\n\t\tif (options.type === 'DELETE' && segments.length === 1 && segments[0] === 'resource') {\n\t\t\treturn this.clear(options.headers);\n\t\t}\n\t\tif (options.type === 'DELETE' && segments[0] === 'collection') {\n\t\t\treturn this.toResponse(204);\n\t\t}\n\t\tif (options.type === 'POST' && segments.length === 1 && segments[0] === 'collection') {\n\t\t\treturn this.createCollection();\n\t\t}\n\t\treturn this.toResponse(501);\n\t}\n\n\tprivate async getManifest(headers?: IHeaders): Promise<IRequestContext> {\n\t\tif (this.session) {\n\t\t\tconst latest: Record<ServerResource, string> = Object.create({});\n\t\t\tthis.data.forEach((value, key) => latest[key] = value.ref);\n\t\t\tlet collections: IUserDataCollectionManifest | undefined = undefined;\n\t\t\tif (this.collectionCounter) {\n\t\t\t\tcollections = {};\n\t\t\t\tfor (let collectionId = 1; collectionId <= this.collectionCounter; collectionId++) {\n\t\t\t\t\tconst collectionData = this.collections.get(`${collectionId}`);\n\t\t\t\t\tif (collectionData) {\n\t\t\t\t\t\tconst latest: Record<ServerResource, string> = Object.create({});\n\t\t\t\t\t\tcollectionData.forEach((value, key) => latest[key] = value.ref);\n\t\t\t\t\t\tcollections[`${collectionId}`] = { latest };\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tconst manifest: IUserDataManifest = { session: this.session, latest, collections, ref: '1' };\n\t\t\treturn this.toResponse(200, { 'Content-Type': 'application/json', etag: `${this.manifestRef++}` }, JSON.stringify(manifest));\n\t\t}\n\t\treturn this.toResponse(204, { etag: `${this.manifestRef++}` });\n\t}\n\n\tprivate async getResourceData(collection: string | undefined, resource: string, ref?: string, headers: IHeaders = {}): Promise<IRequestContext> {\n\t\tconst collectionData = collection ? this.collections.get(collection) : this.data;\n\t\tif (!collectionData) {\n\t\t\treturn this.toResponse(501);\n\t\t}\n\n\t\tconst resourceKey = ALL_SERVER_RESOURCES.find(key => key === resource);\n\t\tif (resourceKey) {\n\t\t\tconst data = collectionData.get(resourceKey);\n\t\t\tif (ref && data?.ref !== ref) {\n\t\t\t\treturn this.toResponse(404);\n\t\t\t}\n\t\t\tif (!data) {\n\t\t\t\treturn this.toResponse(204, { etag: '0' });\n\t\t\t}\n\t\t\tif (headers['If-None-Match'] === data.ref) {\n\t\t\t\treturn this.toResponse(304);\n\t\t\t}\n\t\t\treturn this.toResponse(200, { etag: data.ref }, data.content || '');\n\t\t}\n\t\treturn this.toResponse(204);\n\t}\n\n\tprivate async writeData(collection: string | undefined, resource: string, content: string = '', headers: IHeaders = {}): Promise<IRequestContext> {\n\t\tif (!this.session) {\n\t\t\tthis.session = generateUuid();\n\t\t}\n\t\tconst collectionData = collection ? this.collections.get(collection) : this.data;\n\t\tif (!collectionData) {\n\t\t\treturn this.toResponse(501);\n\t\t}\n\t\tconst resourceKey = ALL_SERVER_RESOURCES.find(key => key === resource);\n\t\tif (resourceKey) {\n\t\t\tconst data = collectionData.get(resourceKey);\n\t\t\tif (headers['If-Match'] !== undefined && headers['If-Match'] !== (data ? data.ref : '0')) {\n\t\t\t\treturn this.toResponse(412);\n\t\t\t}\n\t\t\tconst ref = `${parseInt(data?.ref || '0') + 1}`;\n\t\t\tcollectionData.set(resourceKey, { ref, content });\n\t\t\treturn this.toResponse(200, { etag: ref });\n\t\t}\n\t\treturn this.toResponse(204);\n\t}\n\n\tprivate async deleteResourceData(collection: string | undefined, resource: string, headers: IHeaders = {}): Promise<IRequestContext> {\n\t\tconst collectionData = collection ? this.collections.get(collection) : this.data;\n\t\tif (!collectionData) {\n\t\t\treturn this.toResponse(501);\n\t\t}\n\n\t\tconst resourceKey = ALL_SERVER_RESOURCES.find(key => key === resource);\n\t\tif (resourceKey) {\n\t\t\tcollectionData.delete(resourceKey);\n\t\t\treturn this.toResponse(200);\n\t\t}\n\n\t\treturn this.toResponse(404);\n\t}\n\n\tprivate async createCollection(): Promise<IRequestContext> {\n\t\tconst collectionId = `${++this.collectionCounter}`;\n\t\tthis.collections.set(collectionId, new Map());\n\t\treturn this.toResponse(200, {}, collectionId);\n\t}\n\n\tasync clear(headers?: IHeaders): Promise<IRequestContext> {\n\t\tthis.collections.clear();\n\t\tthis.data.clear();\n\t\tthis.session = null;\n\t\tthis.collectionCounter = 0;\n\t\treturn this.toResponse(204);\n\t}\n\n\tprivate toResponse(statusCode: number, headers?: IHeaders, data?: string): IRequestContext {\n\t\treturn {\n\t\t\tres: {\n\t\t\t\theaders: headers || {},\n\t\t\t\tstatusCode\n\t\t\t},\n\t\t\tstream: bufferToStream(VSBuffer.fromString(data || ''))\n\t\t};\n\t}\n}\n\nexport class TestUserDataSyncUtilService implements IUserDataSyncUtilService {\n\n\t_serviceBrand: undefined;\n\n\tasync resolveDefaultCoreIgnoredSettings(): Promise<string[]> {\n\t\treturn getDefaultIgnoredSettings();\n\t}\n\n\tasync resolveUserBindings(userbindings: string[]): Promise<IStringDictionary<string>> {\n\t\tconst keys: IStringDictionary<string> = {};\n\t\tfor (const keybinding of userbindings) {\n\t\t\tkeys[keybinding] = keybinding;\n\t\t}\n\t\treturn keys;\n\t}\n\n\tasync resolveFormattingOptions(file?: URI): Promise<FormattingOptions> {\n\t\treturn { eol: '\\n', insertSpaces: false, tabSize: 4 };\n\t}\n\n}\n\nclass TestStorageService extends InMemoryStorageService {\n\tconstructor(private readonly profileStorageProfile: IUserDataProfile) {\n\t\tsuper();\n\t}\n\toverride hasScope(profile: IUserDataProfile): boolean {\n\t\treturn this.profileStorageProfile.id === profile.id;\n\t}\n}\n"]}