{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/platform/userDataSync/common/extensionsSync.ts","vs/platform/userDataSync/common/extensionsSync.ts"],"names":[],"mappings":"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","file":"extensionsSync.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Promises } from '../../../base/common/async.js';\nimport { CancellationToken } from '../../../base/common/cancellation.js';\nimport { IStringDictionary } from '../../../base/common/collections.js';\nimport { getErrorMessage } from '../../../base/common/errors.js';\nimport { Event } from '../../../base/common/event.js';\nimport { toFormattedString } from '../../../base/common/jsonFormatter.js';\nimport { DisposableStore } from '../../../base/common/lifecycle.js';\nimport { compare } from '../../../base/common/strings.js';\nimport { URI } from '../../../base/common/uri.js';\nimport { IConfigurationService } from '../../configuration/common/configuration.js';\nimport { IEnvironmentService } from '../../environment/common/environment.js';\nimport { GlobalExtensionEnablementService } from '../../extensionManagement/common/extensionEnablementService.js';\nimport { IExtensionGalleryService, IExtensionManagementService, IGlobalExtensionEnablementService, ILocalExtension, ExtensionManagementError, ExtensionManagementErrorCode, IGalleryExtension, DISABLED_EXTENSIONS_STORAGE_PATH, EXTENSION_INSTALL_SKIP_WALKTHROUGH_CONTEXT, EXTENSION_INSTALL_SOURCE_CONTEXT, InstallExtensionInfo, ExtensionInstallSource, EXTENSION_INSTALL_SKIP_PUBLISHER_TRUST_CONTEXT } from '../../extensionManagement/common/extensionManagement.js';\nimport { areSameExtensions } from '../../extensionManagement/common/extensionManagementUtil.js';\nimport { ExtensionStorageService, IExtensionStorageService } from '../../extensionManagement/common/extensionStorage.js';\nimport { ExtensionType, IExtensionIdentifier, isApplicationScopedExtension } from '../../extensions/common/extensions.js';\nimport { IFileService } from '../../files/common/files.js';\nimport { IInstantiationService } from '../../instantiation/common/instantiation.js';\nimport { ServiceCollection } from '../../instantiation/common/serviceCollection.js';\nimport { ILogService } from '../../log/common/log.js';\nimport { IStorageService } from '../../storage/common/storage.js';\nimport { ITelemetryService } from '../../telemetry/common/telemetry.js';\nimport { IUriIdentityService } from '../../uriIdentity/common/uriIdentity.js';\nimport { IUserDataProfile, IUserDataProfilesService } from '../../userDataProfile/common/userDataProfile.js';\nimport { AbstractInitializer, AbstractSynchroniser, getSyncResourceLogLabel, IAcceptResult, IMergeResult, IResourcePreview } from './abstractSynchronizer.js';\nimport { IMergeResult as IExtensionMergeResult, merge } from './extensionsMerge.js';\nimport { IIgnoredExtensionsManagementService } from './ignoredExtensions.js';\nimport { Change, IRemoteUserData, ISyncData, ISyncExtension, IUserDataSyncLocalStoreService, IUserDataSynchroniser, IUserDataSyncLogService, IUserDataSyncEnablementService, IUserDataSyncStoreService, SyncResource, USER_DATA_SYNC_SCHEME, ILocalSyncExtension } from './userDataSync.js';\nimport { IUserDataProfileStorageService } from '../../userDataProfile/common/userDataProfileStorageService.js';\n\ntype IExtensionResourceMergeResult = IAcceptResult & IExtensionMergeResult;\n\ninterface IExtensionResourcePreview extends IResourcePreview {\n\treadonly localExtensions: ILocalSyncExtension[];\n\treadonly remoteExtensions: ISyncExtension[] | null;\n\treadonly skippedExtensions: ISyncExtension[];\n\treadonly builtinExtensions: IExtensionIdentifier[] | null;\n\treadonly previewResult: IExtensionResourceMergeResult;\n}\n\ninterface ILastSyncUserData extends IRemoteUserData {\n\tskippedExtensions: ISyncExtension[] | undefined;\n\tbuiltinExtensions: IExtensionIdentifier[] | undefined;\n}\n\nasync function parseAndMigrateExtensions(syncData: ISyncData, extensionManagementService: IExtensionManagementService): Promise<ISyncExtension[]> {\n\tconst extensions = JSON.parse(syncData.content);\n\tif (syncData.version === 1\n\t\t|| syncData.version === 2\n\t) {\n\t\tconst builtinExtensions = (await extensionManagementService.getInstalled(ExtensionType.System)).filter(e => e.isBuiltin);\n\t\tfor (const extension of extensions) {\n\t\t\t// #region Migration from v1 (enabled -> disabled)\n\t\t\tif (syncData.version === 1) {\n\t\t\t\tif (extension.enabled === false) {\n\t\t\t\t\textension.disabled = true;\n\t\t\t\t}\n\t\t\t\tdelete extension.enabled;\n\t\t\t}\n\t\t\t// #endregion\n\n\t\t\t// #region Migration from v2 (set installed property on extension)\n\t\t\tif (syncData.version === 2) {\n\t\t\t\tif (builtinExtensions.every(installed => !areSameExtensions(installed.identifier, extension.identifier))) {\n\t\t\t\t\textension.installed = true;\n\t\t\t\t}\n\t\t\t}\n\t\t\t// #endregion\n\t\t}\n\t}\n\treturn extensions;\n}\n\nexport function parseExtensions(syncData: ISyncData): ISyncExtension[] {\n\treturn JSON.parse(syncData.content);\n}\n\nexport function stringify(extensions: ISyncExtension[], format: boolean): string {\n\textensions.sort((e1, e2) => {\n\t\tif (!e1.identifier.uuid && e2.identifier.uuid) {\n\t\t\treturn -1;\n\t\t}\n\t\tif (e1.identifier.uuid && !e2.identifier.uuid) {\n\t\t\treturn 1;\n\t\t}\n\t\treturn compare(e1.identifier.id, e2.identifier.id);\n\t});\n\treturn format ? toFormattedString(extensions, {}) : JSON.stringify(extensions);\n}\n\nexport class ExtensionsSynchroniser extends AbstractSynchroniser implements IUserDataSynchroniser {\n\n\t/*\n\t\tVersion 3 - Introduce installed property to skip installing built in extensions\n\t\tprotected readonly version: number = 3;\n\t*/\n\t/* Version 4: Change settings from `sync.${setting}` to `settingsSync.{setting}` */\n\t/* Version 5: Introduce extension state */\n\t/* Version 6: Added isApplicationScoped property */\n\tprotected readonly version: number = 6;\n\n\tprivate readonly previewResource: URI = this.extUri.joinPath(this.syncPreviewFolder, 'extensions.json');\n\tprivate readonly baseResource: URI = this.previewResource.with({ scheme: USER_DATA_SYNC_SCHEME, authority: 'base' });\n\tprivate readonly localResource: URI = this.previewResource.with({ scheme: USER_DATA_SYNC_SCHEME, authority: 'local' });\n\tprivate readonly remoteResource: URI = this.previewResource.with({ scheme: USER_DATA_SYNC_SCHEME, authority: 'remote' });\n\tprivate readonly acceptedResource: URI = this.previewResource.with({ scheme: USER_DATA_SYNC_SCHEME, authority: 'accepted' });\n\n\tprivate readonly localExtensionsProvider: LocalExtensionsProvider;\n\n\tconstructor(\n\t\t// profileLocation changes for default profile\n\t\tprofile: IUserDataProfile,\n\t\tcollection: string | undefined,\n\t\t@IEnvironmentService environmentService: IEnvironmentService,\n\t\t@IFileService fileService: IFileService,\n\t\t@IStorageService storageService: IStorageService,\n\t\t@IUserDataSyncStoreService userDataSyncStoreService: IUserDataSyncStoreService,\n\t\t@IUserDataSyncLocalStoreService userDataSyncLocalStoreService: IUserDataSyncLocalStoreService,\n\t\t@IExtensionManagementService private readonly extensionManagementService: IExtensionManagementService,\n\t\t@IIgnoredExtensionsManagementService private readonly ignoredExtensionsManagementService: IIgnoredExtensionsManagementService,\n\t\t@IUserDataSyncLogService logService: IUserDataSyncLogService,\n\t\t@IConfigurationService configurationService: IConfigurationService,\n\t\t@IUserDataSyncEnablementService userDataSyncEnablementService: IUserDataSyncEnablementService,\n\t\t@ITelemetryService telemetryService: ITelemetryService,\n\t\t@IExtensionStorageService extensionStorageService: IExtensionStorageService,\n\t\t@IUriIdentityService uriIdentityService: IUriIdentityService,\n\t\t@IUserDataProfileStorageService userDataProfileStorageService: IUserDataProfileStorageService,\n\t\t@IInstantiationService private readonly instantiationService: IInstantiationService,\n\t) {\n\t\tsuper({ syncResource: SyncResource.Extensions, profile }, collection, fileService, environmentService, storageService, userDataSyncStoreService, userDataSyncLocalStoreService, userDataSyncEnablementService, telemetryService, logService, configurationService, uriIdentityService);\n\t\tthis.localExtensionsProvider = this.instantiationService.createInstance(LocalExtensionsProvider);\n\t\tthis._register(\n\t\t\tEvent.any<any>(\n\t\t\t\tEvent.filter(this.extensionManagementService.onDidInstallExtensions, (e => e.some(({ local }) => !!local))),\n\t\t\t\tEvent.filter(this.extensionManagementService.onDidUninstallExtension, (e => !e.error)),\n\t\t\t\tEvent.filter(userDataProfileStorageService.onDidChange, e => e.valueChanges.some(({ profile, changes }) => this.syncResource.profile.id === profile.id && changes.some(change => change.key === DISABLED_EXTENSIONS_STORAGE_PATH))),\n\t\t\t\textensionStorageService.onDidChangeExtensionStorageToSync)(() => this.triggerLocalChange()));\n\t}\n\n\tprotected async generateSyncPreview(remoteUserData: IRemoteUserData, lastSyncUserData: ILastSyncUserData | null): Promise<IExtensionResourcePreview[]> {\n\t\tconst remoteExtensions = remoteUserData.syncData ? await parseAndMigrateExtensions(remoteUserData.syncData, this.extensionManagementService) : null;\n\t\tconst skippedExtensions = lastSyncUserData?.skippedExtensions ?? [];\n\t\tconst builtinExtensions = lastSyncUserData?.builtinExtensions ?? null;\n\t\tconst lastSyncExtensions = lastSyncUserData?.syncData ? await parseAndMigrateExtensions(lastSyncUserData.syncData, this.extensionManagementService) : null;\n\n\t\tconst { localExtensions, ignoredExtensions } = await this.localExtensionsProvider.getLocalExtensions(this.syncResource.profile);\n\n\t\tif (remoteExtensions) {\n\t\t\tthis.logService.trace(`${this.syncResourceLogLabel}: Merging remote extensions with local extensions...`);\n\t\t} else {\n\t\t\tthis.logService.trace(`${this.syncResourceLogLabel}: Remote extensions does not exist. Synchronizing extensions for the first time.`);\n\t\t}\n\n\t\tconst { local, remote } = merge(localExtensions, remoteExtensions, lastSyncExtensions, skippedExtensions, ignoredExtensions, builtinExtensions);\n\t\tconst previewResult: IExtensionResourceMergeResult = {\n\t\t\tlocal, remote,\n\t\t\tcontent: this.getPreviewContent(localExtensions, local.added, local.updated, local.removed),\n\t\t\tlocalChange: local.added.length > 0 || local.removed.length > 0 || local.updated.length > 0 ? Change.Modified : Change.None,\n\t\t\tremoteChange: remote !== null ? Change.Modified : Change.None,\n\t\t};\n\n\t\tconst localContent = this.stringify(localExtensions, false);\n\t\treturn [{\n\t\t\tskippedExtensions,\n\t\t\tbuiltinExtensions,\n\t\t\tbaseResource: this.baseResource,\n\t\t\tbaseContent: lastSyncExtensions ? this.stringify(lastSyncExtensions, false) : localContent,\n\t\t\tlocalResource: this.localResource,\n\t\t\tlocalContent,\n\t\t\tlocalExtensions,\n\t\t\tremoteResource: this.remoteResource,\n\t\t\tremoteExtensions,\n\t\t\tremoteContent: remoteExtensions ? this.stringify(remoteExtensions, false) : null,\n\t\t\tpreviewResource: this.previewResource,\n\t\t\tpreviewResult,\n\t\t\tlocalChange: previewResult.localChange,\n\t\t\tremoteChange: previewResult.remoteChange,\n\t\t\tacceptedResource: this.acceptedResource,\n\t\t}];\n\t}\n\n\tprotected async hasRemoteChanged(lastSyncUserData: ILastSyncUserData): Promise<boolean> {\n\t\tconst lastSyncExtensions: ISyncExtension[] | null = lastSyncUserData.syncData ? await parseAndMigrateExtensions(lastSyncUserData.syncData, this.extensionManagementService) : null;\n\t\tconst { localExtensions, ignoredExtensions } = await this.localExtensionsProvider.getLocalExtensions(this.syncResource.profile);\n\t\tconst { remote } = merge(localExtensions, lastSyncExtensions, lastSyncExtensions, lastSyncUserData.skippedExtensions || [], ignoredExtensions, lastSyncUserData.builtinExtensions || []);\n\t\treturn remote !== null;\n\t}\n\n\tprivate getPreviewContent(localExtensions: ISyncExtension[], added: ISyncExtension[], updated: ISyncExtension[], removed: IExtensionIdentifier[]): string {\n\t\tconst preview: ISyncExtension[] = [...added, ...updated];\n\n\t\tconst idsOrUUIDs: Set<string> = new Set<string>();\n\t\tconst addIdentifier = (identifier: IExtensionIdentifier) => {\n\t\t\tidsOrUUIDs.add(identifier.id.toLowerCase());\n\t\t\tif (identifier.uuid) {\n\t\t\t\tidsOrUUIDs.add(identifier.uuid);\n\t\t\t}\n\t\t};\n\t\tpreview.forEach(({ identifier }) => addIdentifier(identifier));\n\t\tremoved.forEach(addIdentifier);\n\n\t\tfor (const localExtension of localExtensions) {\n\t\t\tif (idsOrUUIDs.has(localExtension.identifier.id.toLowerCase()) || (localExtension.identifier.uuid && idsOrUUIDs.has(localExtension.identifier.uuid))) {\n\t\t\t\t// skip\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tpreview.push(localExtension);\n\t\t}\n\n\t\treturn this.stringify(preview, false);\n\t}\n\n\tprotected async getMergeResult(resourcePreview: IExtensionResourcePreview, token: CancellationToken): Promise<IMergeResult> {\n\t\treturn { ...resourcePreview.previewResult, hasConflicts: false };\n\t}\n\n\tprotected async getAcceptResult(resourcePreview: IExtensionResourcePreview, resource: URI, content: string | null | undefined, token: CancellationToken): Promise<IExtensionResourceMergeResult> {\n\n\t\t/* Accept local resource */\n\t\tif (this.extUri.isEqual(resource, this.localResource)) {\n\t\t\treturn this.acceptLocal(resourcePreview);\n\t\t}\n\n\t\t/* Accept remote resource */\n\t\tif (this.extUri.isEqual(resource, this.remoteResource)) {\n\t\t\treturn this.acceptRemote(resourcePreview);\n\t\t}\n\n\t\t/* Accept preview resource */\n\t\tif (this.extUri.isEqual(resource, this.previewResource)) {\n\t\t\treturn resourcePreview.previewResult;\n\t\t}\n\n\t\tthrow new Error(`Invalid Resource: ${resource.toString()}`);\n\t}\n\n\tprivate async acceptLocal(resourcePreview: IExtensionResourcePreview): Promise<IExtensionResourceMergeResult> {\n\t\tconst installedExtensions = await this.extensionManagementService.getInstalled(undefined, this.syncResource.profile.extensionsResource);\n\t\tconst ignoredExtensions = this.ignoredExtensionsManagementService.getIgnoredExtensions(installedExtensions);\n\t\tconst remoteExtensions = resourcePreview.remoteContent ? JSON.parse(resourcePreview.remoteContent) : null;\n\t\tconst mergeResult = merge(resourcePreview.localExtensions, remoteExtensions, remoteExtensions, resourcePreview.skippedExtensions, ignoredExtensions, resourcePreview.builtinExtensions);\n\t\tconst { local, remote } = mergeResult;\n\t\treturn {\n\t\t\tcontent: resourcePreview.localContent,\n\t\t\tlocal,\n\t\t\tremote,\n\t\t\tlocalChange: local.added.length > 0 || local.removed.length > 0 || local.updated.length > 0 ? Change.Modified : Change.None,\n\t\t\tremoteChange: remote !== null ? Change.Modified : Change.None,\n\t\t};\n\t}\n\n\tprivate async acceptRemote(resourcePreview: IExtensionResourcePreview): Promise<IExtensionResourceMergeResult> {\n\t\tconst installedExtensions = await this.extensionManagementService.getInstalled(undefined, this.syncResource.profile.extensionsResource);\n\t\tconst ignoredExtensions = this.ignoredExtensionsManagementService.getIgnoredExtensions(installedExtensions);\n\t\tconst remoteExtensions = resourcePreview.remoteContent ? JSON.parse(resourcePreview.remoteContent) : null;\n\t\tif (remoteExtensions !== null) {\n\t\t\tconst mergeResult = merge(resourcePreview.localExtensions, remoteExtensions, resourcePreview.localExtensions, [], ignoredExtensions, resourcePreview.builtinExtensions);\n\t\t\tconst { local, remote } = mergeResult;\n\t\t\treturn {\n\t\t\t\tcontent: resourcePreview.remoteContent,\n\t\t\t\tlocal,\n\t\t\t\tremote,\n\t\t\t\tlocalChange: local.added.length > 0 || local.removed.length > 0 || local.updated.length > 0 ? Change.Modified : Change.None,\n\t\t\t\tremoteChange: remote !== null ? Change.Modified : Change.None,\n\t\t\t};\n\t\t} else {\n\t\t\treturn {\n\t\t\t\tcontent: resourcePreview.remoteContent,\n\t\t\t\tlocal: { added: [], removed: [], updated: [] },\n\t\t\t\tremote: null,\n\t\t\t\tlocalChange: Change.None,\n\t\t\t\tremoteChange: Change.None,\n\t\t\t};\n\t\t}\n\t}\n\n\tprotected async applyResult(remoteUserData: IRemoteUserData, lastSyncUserData: IRemoteUserData | null, resourcePreviews: [IExtensionResourcePreview, IExtensionResourceMergeResult][], force: boolean): Promise<void> {\n\t\tlet { skippedExtensions, builtinExtensions, localExtensions } = resourcePreviews[0][0];\n\t\tconst { local, remote, localChange, remoteChange } = resourcePreviews[0][1];\n\n\t\tif (localChange === Change.None && remoteChange === Change.None) {\n\t\t\tthis.logService.info(`${this.syncResourceLogLabel}: No changes found during synchronizing extensions.`);\n\t\t}\n\n\t\tif (localChange !== Change.None) {\n\t\t\tawait this.backupLocal(JSON.stringify(localExtensions));\n\t\t\tskippedExtensions = await this.localExtensionsProvider.updateLocalExtensions(local.added, local.removed, local.updated, skippedExtensions, this.syncResource.profile);\n\t\t}\n\n\t\tif (remote) {\n\t\t\t// update remote\n\t\t\tthis.logService.trace(`${this.syncResourceLogLabel}: Updating remote extensions...`);\n\t\t\tconst content = JSON.stringify(remote.all);\n\t\t\tremoteUserData = await this.updateRemoteUserData(content, force ? null : remoteUserData.ref);\n\t\t\tthis.logService.info(`${this.syncResourceLogLabel}: Updated remote extensions.${remote.added.length ? ` Added: ${JSON.stringify(remote.added.map(e => e.identifier.id))}.` : ''}${remote.updated.length ? ` Updated: ${JSON.stringify(remote.updated.map(e => e.identifier.id))}.` : ''}${remote.removed.length ? ` Removed: ${JSON.stringify(remote.removed.map(e => e.identifier.id))}.` : ''}`);\n\t\t}\n\n\t\tif (lastSyncUserData?.ref !== remoteUserData.ref) {\n\t\t\t// update last sync\n\t\t\tthis.logService.trace(`${this.syncResourceLogLabel}: Updating last synchronized extensions...`);\n\t\t\tbuiltinExtensions = this.computeBuiltinExtensions(localExtensions, builtinExtensions);\n\t\t\tawait this.updateLastSyncUserData(remoteUserData, { skippedExtensions, builtinExtensions });\n\t\t\tthis.logService.info(`${this.syncResourceLogLabel}: Updated last synchronized extensions.${skippedExtensions.length ? ` Skipped: ${JSON.stringify(skippedExtensions.map(e => e.identifier.id))}.` : ''}`);\n\t\t}\n\t}\n\n\tprivate computeBuiltinExtensions(localExtensions: ILocalSyncExtension[], previousBuiltinExtensions: IExtensionIdentifier[] | null): IExtensionIdentifier[] {\n\t\tconst localExtensionsSet = new Set<string>();\n\t\tconst builtinExtensions: IExtensionIdentifier[] = [];\n\t\tfor (const localExtension of localExtensions) {\n\t\t\tlocalExtensionsSet.add(localExtension.identifier.id.toLowerCase());\n\t\t\tif (!localExtension.installed) {\n\t\t\t\tbuiltinExtensions.push(localExtension.identifier);\n\t\t\t}\n\t\t}\n\t\tif (previousBuiltinExtensions) {\n\t\t\tfor (const builtinExtension of previousBuiltinExtensions) {\n\t\t\t\t// Add previous builtin extension if it does not exist in local extensions\n\t\t\t\tif (!localExtensionsSet.has(builtinExtension.id.toLowerCase())) {\n\t\t\t\t\tbuiltinExtensions.push(builtinExtension);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn builtinExtensions;\n\t}\n\n\tasync resolveContent(uri: URI): Promise<string | null> {\n\t\tif (this.extUri.isEqual(this.remoteResource, uri)\n\t\t\t|| this.extUri.isEqual(this.baseResource, uri)\n\t\t\t|| this.extUri.isEqual(this.localResource, uri)\n\t\t\t|| this.extUri.isEqual(this.acceptedResource, uri)\n\t\t) {\n\t\t\tconst content = await this.resolvePreviewContent(uri);\n\t\t\treturn content ? this.stringify(JSON.parse(content), true) : content;\n\t\t}\n\t\treturn null;\n\t}\n\n\tprivate stringify(extensions: ISyncExtension[], format: boolean): string {\n\t\treturn stringify(extensions, format);\n\t}\n\n\tasync hasLocalData(): Promise<boolean> {\n\t\ttry {\n\t\t\tconst { localExtensions } = await this.localExtensionsProvider.getLocalExtensions(this.syncResource.profile);\n\t\t\tif (localExtensions.some(e => e.installed || e.disabled)) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t} catch (error) {\n\t\t\t/* ignore error */\n\t\t}\n\t\treturn false;\n\t}\n\n}\n\nexport class LocalExtensionsProvider {\n\n\tconstructor(\n\t\t@IExtensionManagementService private readonly extensionManagementService: IExtensionManagementService,\n\t\t@IUserDataProfileStorageService private readonly userDataProfileStorageService: IUserDataProfileStorageService,\n\t\t@IExtensionGalleryService private readonly extensionGalleryService: IExtensionGalleryService,\n\t\t@IIgnoredExtensionsManagementService private readonly ignoredExtensionsManagementService: IIgnoredExtensionsManagementService,\n\t\t@IInstantiationService private readonly instantiationService: IInstantiationService,\n\t\t@IUserDataSyncLogService private readonly logService: IUserDataSyncLogService,\n\t) { }\n\n\tasync getLocalExtensions(profile: IUserDataProfile): Promise<{ localExtensions: ILocalSyncExtension[]; ignoredExtensions: string[] }> {\n\t\tconst installedExtensions = await this.extensionManagementService.getInstalled(undefined, profile.extensionsResource);\n\t\tconst ignoredExtensions = this.ignoredExtensionsManagementService.getIgnoredExtensions(installedExtensions);\n\t\tconst localExtensions = await this.withProfileScopedServices(profile, async (extensionEnablementService, extensionStorageService) => {\n\t\t\tconst disabledExtensions = extensionEnablementService.getDisabledExtensions();\n\t\t\treturn installedExtensions\n\t\t\t\t.map(extension => {\n\t\t\t\t\tconst { identifier, isBuiltin, manifest, preRelease, pinned, isApplicationScoped } = extension;\n\t\t\t\t\tconst syncExntesion: ILocalSyncExtension = { identifier, preRelease, version: manifest.version, pinned: !!pinned };\n\t\t\t\t\tif (isApplicationScoped && !isApplicationScopedExtension(manifest)) {\n\t\t\t\t\t\tsyncExntesion.isApplicationScoped = isApplicationScoped;\n\t\t\t\t\t}\n\t\t\t\t\tif (disabledExtensions.some(disabledExtension => areSameExtensions(disabledExtension, identifier))) {\n\t\t\t\t\t\tsyncExntesion.disabled = true;\n\t\t\t\t\t}\n\t\t\t\t\tif (!isBuiltin) {\n\t\t\t\t\t\tsyncExntesion.installed = true;\n\t\t\t\t\t}\n\t\t\t\t\ttry {\n\t\t\t\t\t\tconst keys = extensionStorageService.getKeysForSync({ id: identifier.id, version: manifest.version });\n\t\t\t\t\t\tif (keys) {\n\t\t\t\t\t\t\tconst extensionStorageState = extensionStorageService.getExtensionState(extension, true) || {};\n\t\t\t\t\t\t\tsyncExntesion.state = Object.keys(extensionStorageState).reduce((state: IStringDictionary<any>, key) => {\n\t\t\t\t\t\t\t\tif (keys.includes(key)) {\n\t\t\t\t\t\t\t\t\tstate[key] = extensionStorageState[key];\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\treturn state;\n\t\t\t\t\t\t\t}, {});\n\t\t\t\t\t\t}\n\t\t\t\t\t} catch (error) {\n\t\t\t\t\t\tthis.logService.info(`${getSyncResourceLogLabel(SyncResource.Extensions, profile)}: Error while parsing extension state`, getErrorMessage(error));\n\t\t\t\t\t}\n\t\t\t\t\treturn syncExntesion;\n\t\t\t\t});\n\t\t});\n\t\treturn { localExtensions, ignoredExtensions };\n\t}\n\n\tasync updateLocalExtensions(added: ISyncExtension[], removed: IExtensionIdentifier[], updated: ISyncExtension[], skippedExtensions: ISyncExtension[], profile: IUserDataProfile): Promise<ISyncExtension[]> {\n\t\tconst syncResourceLogLabel = getSyncResourceLogLabel(SyncResource.Extensions, profile);\n\t\tconst extensionsToInstall: InstallExtensionInfo[] = [];\n\t\tconst syncExtensionsToInstall = new Map<string, ISyncExtension>();\n\t\tconst removeFromSkipped: IExtensionIdentifier[] = [];\n\t\tconst addToSkipped: ISyncExtension[] = [];\n\t\tconst installedExtensions = await this.extensionManagementService.getInstalled(undefined, profile.extensionsResource);\n\n\t\t// 1. Sync extensions state first so that the storage is flushed and updated in all opened windows\n\t\tif (added.length || updated.length) {\n\t\t\tawait this.withProfileScopedServices(profile, async (extensionEnablementService, extensionStorageService) => {\n\t\t\t\tawait Promises.settled([...added, ...updated].map(async e => {\n\t\t\t\t\tconst installedExtension = installedExtensions.find(installed => areSameExtensions(installed.identifier, e.identifier));\n\n\t\t\t\t\t// Builtin Extension Sync: Enablement & State\n\t\t\t\t\tif (installedExtension && installedExtension.isBuiltin) {\n\t\t\t\t\t\tif (e.state && installedExtension.manifest.version === e.version) {\n\t\t\t\t\t\t\tthis.updateExtensionState(e.state, installedExtension, installedExtension.manifest.version, extensionStorageService);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tconst isDisabled = extensionEnablementService.getDisabledExtensions().some(disabledExtension => areSameExtensions(disabledExtension, e.identifier));\n\t\t\t\t\t\tif (isDisabled !== !!e.disabled) {\n\t\t\t\t\t\t\tif (e.disabled) {\n\t\t\t\t\t\t\t\tthis.logService.trace(`${syncResourceLogLabel}: Disabling extension...`, e.identifier.id);\n\t\t\t\t\t\t\t\tawait extensionEnablementService.disableExtension(e.identifier);\n\t\t\t\t\t\t\t\tthis.logService.info(`${syncResourceLogLabel}: Disabled extension`, e.identifier.id);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tthis.logService.trace(`${syncResourceLogLabel}: Enabling extension...`, e.identifier.id);\n\t\t\t\t\t\t\t\tawait extensionEnablementService.enableExtension(e.identifier);\n\t\t\t\t\t\t\t\tthis.logService.info(`${syncResourceLogLabel}: Enabled extension`, e.identifier.id);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tremoveFromSkipped.push(e.identifier);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\t// User Extension Sync: Install/Update, Enablement & State\n\t\t\t\t\tconst version = e.pinned ? e.version : undefined;\n\t\t\t\t\tconst extension = (await this.extensionGalleryService.getExtensions([{ ...e.identifier, version, preRelease: version ? undefined : e.preRelease }], CancellationToken.None))[0];\n\n\t\t\t\t\t/* Update extension state only if\n\t\t\t\t\t *\textension is installed and version is same as synced version or\n\t\t\t\t\t *\textension is not installed and installable\n\t\t\t\t\t */\n\t\t\t\t\tif (e.state &&\n\t\t\t\t\t\t(installedExtension ? installedExtension.manifest.version === e.version /* Installed and remote has same version */\n\t\t\t\t\t\t\t: !!extension /* Installable */)\n\t\t\t\t\t) {\n\t\t\t\t\t\tthis.updateExtensionState(e.state, installedExtension || extension, installedExtension?.manifest.version, extensionStorageService);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (extension) {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tconst isDisabled = extensionEnablementService.getDisabledExtensions().some(disabledExtension => areSameExtensions(disabledExtension, e.identifier));\n\t\t\t\t\t\t\tif (isDisabled !== !!e.disabled) {\n\t\t\t\t\t\t\t\tif (e.disabled) {\n\t\t\t\t\t\t\t\t\tthis.logService.trace(`${syncResourceLogLabel}: Disabling extension...`, e.identifier.id, extension.version);\n\t\t\t\t\t\t\t\t\tawait extensionEnablementService.disableExtension(extension.identifier);\n\t\t\t\t\t\t\t\t\tthis.logService.info(`${syncResourceLogLabel}: Disabled extension`, e.identifier.id, extension.version);\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tthis.logService.trace(`${syncResourceLogLabel}: Enabling extension...`, e.identifier.id, extension.version);\n\t\t\t\t\t\t\t\t\tawait extensionEnablementService.enableExtension(extension.identifier);\n\t\t\t\t\t\t\t\t\tthis.logService.info(`${syncResourceLogLabel}: Enabled extension`, e.identifier.id, extension.version);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (!installedExtension // Install if the extension does not exist\n\t\t\t\t\t\t\t\t|| installedExtension.preRelease !== e.preRelease // Install if the extension pre-release preference has changed\n\t\t\t\t\t\t\t\t|| installedExtension.pinned !== e.pinned  // Install if the extension pinned preference has changed\n\t\t\t\t\t\t\t\t|| (version && installedExtension.manifest.version !== version)  // Install if the extension version has changed\n\t\t\t\t\t\t\t) {\n\t\t\t\t\t\t\t\tif (await this.extensionManagementService.canInstall(extension) === true) {\n\t\t\t\t\t\t\t\t\textensionsToInstall.push({\n\t\t\t\t\t\t\t\t\t\textension, options: {\n\t\t\t\t\t\t\t\t\t\t\tisMachineScoped: false /* set isMachineScoped value to prevent install and sync dialog in web */,\n\t\t\t\t\t\t\t\t\t\t\tdonotIncludePackAndDependencies: true,\n\t\t\t\t\t\t\t\t\t\t\tinstallGivenVersion: e.pinned && !!e.version,\n\t\t\t\t\t\t\t\t\t\t\tpinned: e.pinned,\n\t\t\t\t\t\t\t\t\t\t\tinstallPreReleaseVersion: e.preRelease,\n\t\t\t\t\t\t\t\t\t\t\tpreRelease: e.preRelease,\n\t\t\t\t\t\t\t\t\t\t\tprofileLocation: profile.extensionsResource,\n\t\t\t\t\t\t\t\t\t\t\tisApplicationScoped: e.isApplicationScoped,\n\t\t\t\t\t\t\t\t\t\t\tcontext: { [EXTENSION_INSTALL_SKIP_WALKTHROUGH_CONTEXT]: true, [EXTENSION_INSTALL_SOURCE_CONTEXT]: ExtensionInstallSource.SETTINGS_SYNC, [EXTENSION_INSTALL_SKIP_PUBLISHER_TRUST_CONTEXT]: true }\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\tsyncExtensionsToInstall.set(extension.identifier.id.toLowerCase(), e);\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tthis.logService.info(`${syncResourceLogLabel}: Skipped synchronizing extension because it cannot be installed.`, extension.displayName || extension.identifier.id);\n\t\t\t\t\t\t\t\t\taddToSkipped.push(e);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} catch (error) {\n\t\t\t\t\t\t\taddToSkipped.push(e);\n\t\t\t\t\t\t\tthis.logService.error(error);\n\t\t\t\t\t\t\tthis.logService.info(`${syncResourceLogLabel}: Skipped synchronizing extension`, extension.displayName || extension.identifier.id);\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\taddToSkipped.push(e);\n\t\t\t\t\t\tthis.logService.info(`${syncResourceLogLabel}: Skipped synchronizing extension because the extension is not found.`, e.identifier.id);\n\t\t\t\t\t}\n\t\t\t\t}));\n\t\t\t});\n\t\t}\n\n\t\t// 2. Next uninstall the removed extensions\n\t\tif (removed.length) {\n\t\t\tconst extensionsToRemove = installedExtensions.filter(({ identifier, isBuiltin }) => !isBuiltin && removed.some(r => areSameExtensions(identifier, r)));\n\t\t\tawait Promises.settled(extensionsToRemove.map(async extensionToRemove => {\n\t\t\t\tthis.logService.trace(`${syncResourceLogLabel}: Uninstalling local extension...`, extensionToRemove.identifier.id);\n\t\t\t\tawait this.extensionManagementService.uninstall(extensionToRemove, { donotIncludePack: true, donotCheckDependents: true, profileLocation: profile.extensionsResource });\n\t\t\t\tthis.logService.info(`${syncResourceLogLabel}: Uninstalled local extension.`, extensionToRemove.identifier.id);\n\t\t\t\tremoveFromSkipped.push(extensionToRemove.identifier);\n\t\t\t}));\n\t\t}\n\n\t\t// 3. Install extensions at the end\n\t\tconst results = await this.extensionManagementService.installGalleryExtensions(extensionsToInstall);\n\t\tfor (const { identifier, local, error, source } of results) {\n\t\t\tconst gallery = source as IGalleryExtension;\n\t\t\tif (local) {\n\t\t\t\tthis.logService.info(`${syncResourceLogLabel}: Installed extension.`, identifier.id, gallery.version);\n\t\t\t\tremoveFromSkipped.push(identifier);\n\t\t\t} else {\n\t\t\t\tconst e = syncExtensionsToInstall.get(identifier.id.toLowerCase());\n\t\t\t\tif (e) {\n\t\t\t\t\taddToSkipped.push(e);\n\t\t\t\t\tthis.logService.info(`${syncResourceLogLabel}: Skipped synchronizing extension`, gallery.displayName || gallery.identifier.id);\n\t\t\t\t}\n\t\t\t\tif (error instanceof ExtensionManagementError && [ExtensionManagementErrorCode.Incompatible, ExtensionManagementErrorCode.IncompatibleApi, ExtensionManagementErrorCode.IncompatibleTargetPlatform].includes(error.code)) {\n\t\t\t\t\tthis.logService.info(`${syncResourceLogLabel}: Skipped synchronizing extension because the compatible extension is not found.`, gallery.displayName || gallery.identifier.id);\n\t\t\t\t} else if (error) {\n\t\t\t\t\tthis.logService.error(error);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tconst newSkippedExtensions: ISyncExtension[] = [];\n\t\tfor (const skippedExtension of skippedExtensions) {\n\t\t\tif (!removeFromSkipped.some(e => areSameExtensions(e, skippedExtension.identifier))) {\n\t\t\t\tnewSkippedExtensions.push(skippedExtension);\n\t\t\t}\n\t\t}\n\t\tfor (const skippedExtension of addToSkipped) {\n\t\t\tif (!newSkippedExtensions.some(e => areSameExtensions(e.identifier, skippedExtension.identifier))) {\n\t\t\t\tnewSkippedExtensions.push(skippedExtension);\n\t\t\t}\n\t\t}\n\t\treturn newSkippedExtensions;\n\t}\n\n\tprivate updateExtensionState(state: IStringDictionary<any>, extension: ILocalExtension | IGalleryExtension, version: string | undefined, extensionStorageService: IExtensionStorageService): void {\n\t\tconst extensionState = extensionStorageService.getExtensionState(extension, true) || {};\n\t\tconst keys = version ? extensionStorageService.getKeysForSync({ id: extension.identifier.id, version }) : undefined;\n\t\tif (keys) {\n\t\t\tkeys.forEach(key => { extensionState[key] = state[key]; });\n\t\t} else {\n\t\t\tObject.keys(state).forEach(key => extensionState[key] = state[key]);\n\t\t}\n\t\textensionStorageService.setExtensionState(extension, extensionState, true);\n\t}\n\n\tprivate async withProfileScopedServices<T>(profile: IUserDataProfile, fn: (extensionEnablementService: IGlobalExtensionEnablementService, extensionStorageService: IExtensionStorageService) => Promise<T>): Promise<T> {\n\t\treturn this.userDataProfileStorageService.withProfileScopedStorageService(profile,\n\t\t\tasync storageService => {\n\t\t\t\tconst disposables = new DisposableStore();\n\t\t\t\tconst instantiationService = disposables.add(this.instantiationService.createChild(new ServiceCollection([IStorageService, storageService])));\n\t\t\t\tconst extensionEnablementService = disposables.add(instantiationService.createInstance(GlobalExtensionEnablementService));\n\t\t\t\tconst extensionStorageService = disposables.add(instantiationService.createInstance(ExtensionStorageService));\n\t\t\t\ttry {\n\t\t\t\t\treturn await fn(extensionEnablementService, extensionStorageService);\n\t\t\t\t} finally {\n\t\t\t\t\tdisposables.dispose();\n\t\t\t\t}\n\t\t\t});\n\t}\n\n}\n\nexport interface IExtensionsInitializerPreviewResult {\n\treadonly installedExtensions: ILocalExtension[];\n\treadonly disabledExtensions: IExtensionIdentifier[];\n\treadonly newExtensions: (IExtensionIdentifier & { preRelease: boolean })[];\n\treadonly remoteExtensions: ISyncExtension[];\n}\n\nexport abstract class AbstractExtensionsInitializer extends AbstractInitializer {\n\n\tconstructor(\n\t\t@IExtensionManagementService protected readonly extensionManagementService: IExtensionManagementService,\n\t\t@IIgnoredExtensionsManagementService private readonly ignoredExtensionsManagementService: IIgnoredExtensionsManagementService,\n\t\t@IFileService fileService: IFileService,\n\t\t@IUserDataProfilesService userDataProfilesService: IUserDataProfilesService,\n\t\t@IEnvironmentService environmentService: IEnvironmentService,\n\t\t@ILogService logService: ILogService,\n\t\t@IStorageService storageService: IStorageService,\n\t\t@IUriIdentityService uriIdentityService: IUriIdentityService,\n\t) {\n\t\tsuper(SyncResource.Extensions, userDataProfilesService, environmentService, logService, fileService, storageService, uriIdentityService);\n\t}\n\n\tprotected async parseExtensions(remoteUserData: IRemoteUserData): Promise<ISyncExtension[] | null> {\n\t\treturn remoteUserData.syncData ? await parseAndMigrateExtensions(remoteUserData.syncData, this.extensionManagementService) : null;\n\t}\n\n\tprotected generatePreview(remoteExtensions: ISyncExtension[], localExtensions: ILocalExtension[]): IExtensionsInitializerPreviewResult {\n\t\tconst installedExtensions: ILocalExtension[] = [];\n\t\tconst newExtensions: (IExtensionIdentifier & { preRelease: boolean })[] = [];\n\t\tconst disabledExtensions: IExtensionIdentifier[] = [];\n\t\tfor (const extension of remoteExtensions) {\n\t\t\tif (this.ignoredExtensionsManagementService.hasToNeverSyncExtension(extension.identifier.id)) {\n\t\t\t\t// Skip extension ignored to sync\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tconst installedExtension = localExtensions.find(i => areSameExtensions(i.identifier, extension.identifier));\n\t\t\tif (installedExtension) {\n\t\t\t\tinstalledExtensions.push(installedExtension);\n\t\t\t\tif (extension.disabled) {\n\t\t\t\t\tdisabledExtensions.push(extension.identifier);\n\t\t\t\t}\n\t\t\t} else if (extension.installed) {\n\t\t\t\tnewExtensions.push({ ...extension.identifier, preRelease: !!extension.preRelease });\n\t\t\t\tif (extension.disabled) {\n\t\t\t\t\tdisabledExtensions.push(extension.identifier);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn { installedExtensions, newExtensions, disabledExtensions, remoteExtensions };\n\t}\n\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Promises } from '../../../base/common/async.js';\nimport { CancellationToken } from '../../../base/common/cancellation.js';\nimport { IStringDictionary } from '../../../base/common/collections.js';\nimport { getErrorMessage } from '../../../base/common/errors.js';\nimport { Event } from '../../../base/common/event.js';\nimport { toFormattedString } from '../../../base/common/jsonFormatter.js';\nimport { DisposableStore } from '../../../base/common/lifecycle.js';\nimport { compare } from '../../../base/common/strings.js';\nimport { URI } from '../../../base/common/uri.js';\nimport { IConfigurationService } from '../../configuration/common/configuration.js';\nimport { IEnvironmentService } from '../../environment/common/environment.js';\nimport { GlobalExtensionEnablementService } from '../../extensionManagement/common/extensionEnablementService.js';\nimport { IExtensionGalleryService, IExtensionManagementService, IGlobalExtensionEnablementService, ILocalExtension, ExtensionManagementError, ExtensionManagementErrorCode, IGalleryExtension, DISABLED_EXTENSIONS_STORAGE_PATH, EXTENSION_INSTALL_SKIP_WALKTHROUGH_CONTEXT, EXTENSION_INSTALL_SOURCE_CONTEXT, InstallExtensionInfo, ExtensionInstallSource, EXTENSION_INSTALL_SKIP_PUBLISHER_TRUST_CONTEXT } from '../../extensionManagement/common/extensionManagement.js';\nimport { areSameExtensions } from '../../extensionManagement/common/extensionManagementUtil.js';\nimport { ExtensionStorageService, IExtensionStorageService } from '../../extensionManagement/common/extensionStorage.js';\nimport { ExtensionType, IExtensionIdentifier, isApplicationScopedExtension } from '../../extensions/common/extensions.js';\nimport { IFileService } from '../../files/common/files.js';\nimport { IInstantiationService } from '../../instantiation/common/instantiation.js';\nimport { ServiceCollection } from '../../instantiation/common/serviceCollection.js';\nimport { ILogService } from '../../log/common/log.js';\nimport { IStorageService } from '../../storage/common/storage.js';\nimport { ITelemetryService } from '../../telemetry/common/telemetry.js';\nimport { IUriIdentityService } from '../../uriIdentity/common/uriIdentity.js';\nimport { IUserDataProfile, IUserDataProfilesService } from '../../userDataProfile/common/userDataProfile.js';\nimport { AbstractInitializer, AbstractSynchroniser, getSyncResourceLogLabel, IAcceptResult, IMergeResult, IResourcePreview } from './abstractSynchronizer.js';\nimport { IMergeResult as IExtensionMergeResult, merge } from './extensionsMerge.js';\nimport { IIgnoredExtensionsManagementService } from './ignoredExtensions.js';\nimport { Change, IRemoteUserData, ISyncData, ISyncExtension, IUserDataSyncLocalStoreService, IUserDataSynchroniser, IUserDataSyncLogService, IUserDataSyncEnablementService, IUserDataSyncStoreService, SyncResource, USER_DATA_SYNC_SCHEME, ILocalSyncExtension } from './userDataSync.js';\nimport { IUserDataProfileStorageService } from '../../userDataProfile/common/userDataProfileStorageService.js';\n\ntype IExtensionResourceMergeResult = IAcceptResult & IExtensionMergeResult;\n\ninterface IExtensionResourcePreview extends IResourcePreview {\n\treadonly localExtensions: ILocalSyncExtension[];\n\treadonly remoteExtensions: ISyncExtension[] | null;\n\treadonly skippedExtensions: ISyncExtension[];\n\treadonly builtinExtensions: IExtensionIdentifier[] | null;\n\treadonly previewResult: IExtensionResourceMergeResult;\n}\n\ninterface ILastSyncUserData extends IRemoteUserData {\n\tskippedExtensions: ISyncExtension[] | undefined;\n\tbuiltinExtensions: IExtensionIdentifier[] | undefined;\n}\n\nasync function parseAndMigrateExtensions(syncData: ISyncData, extensionManagementService: IExtensionManagementService): Promise<ISyncExtension[]> {\n\tconst extensions = JSON.parse(syncData.content);\n\tif (syncData.version === 1\n\t\t|| syncData.version === 2\n\t) {\n\t\tconst builtinExtensions = (await extensionManagementService.getInstalled(ExtensionType.System)).filter(e => e.isBuiltin);\n\t\tfor (const extension of extensions) {\n\t\t\t// #region Migration from v1 (enabled -> disabled)\n\t\t\tif (syncData.version === 1) {\n\t\t\t\tif (extension.enabled === false) {\n\t\t\t\t\textension.disabled = true;\n\t\t\t\t}\n\t\t\t\tdelete extension.enabled;\n\t\t\t}\n\t\t\t// #endregion\n\n\t\t\t// #region Migration from v2 (set installed property on extension)\n\t\t\tif (syncData.version === 2) {\n\t\t\t\tif (builtinExtensions.every(installed => !areSameExtensions(installed.identifier, extension.identifier))) {\n\t\t\t\t\textension.installed = true;\n\t\t\t\t}\n\t\t\t}\n\t\t\t// #endregion\n\t\t}\n\t}\n\treturn extensions;\n}\n\nexport function parseExtensions(syncData: ISyncData): ISyncExtension[] {\n\treturn JSON.parse(syncData.content);\n}\n\nexport function stringify(extensions: ISyncExtension[], format: boolean): string {\n\textensions.sort((e1, e2) => {\n\t\tif (!e1.identifier.uuid && e2.identifier.uuid) {\n\t\t\treturn -1;\n\t\t}\n\t\tif (e1.identifier.uuid && !e2.identifier.uuid) {\n\t\t\treturn 1;\n\t\t}\n\t\treturn compare(e1.identifier.id, e2.identifier.id);\n\t});\n\treturn format ? toFormattedString(extensions, {}) : JSON.stringify(extensions);\n}\n\nexport class ExtensionsSynchroniser extends AbstractSynchroniser implements IUserDataSynchroniser {\n\n\t/*\n\t\tVersion 3 - Introduce installed property to skip installing built in extensions\n\t\tprotected readonly version: number = 3;\n\t*/\n\t/* Version 4: Change settings from `sync.${setting}` to `settingsSync.{setting}` */\n\t/* Version 5: Introduce extension state */\n\t/* Version 6: Added isApplicationScoped property */\n\tprotected readonly version: number = 6;\n\n\tprivate readonly previewResource: URI = this.extUri.joinPath(this.syncPreviewFolder, 'extensions.json');\n\tprivate readonly baseResource: URI = this.previewResource.with({ scheme: USER_DATA_SYNC_SCHEME, authority: 'base' });\n\tprivate readonly localResource: URI = this.previewResource.with({ scheme: USER_DATA_SYNC_SCHEME, authority: 'local' });\n\tprivate readonly remoteResource: URI = this.previewResource.with({ scheme: USER_DATA_SYNC_SCHEME, authority: 'remote' });\n\tprivate readonly acceptedResource: URI = this.previewResource.with({ scheme: USER_DATA_SYNC_SCHEME, authority: 'accepted' });\n\n\tprivate readonly localExtensionsProvider: LocalExtensionsProvider;\n\n\tconstructor(\n\t\t// profileLocation changes for default profile\n\t\tprofile: IUserDataProfile,\n\t\tcollection: string | undefined,\n\t\t@IEnvironmentService environmentService: IEnvironmentService,\n\t\t@IFileService fileService: IFileService,\n\t\t@IStorageService storageService: IStorageService,\n\t\t@IUserDataSyncStoreService userDataSyncStoreService: IUserDataSyncStoreService,\n\t\t@IUserDataSyncLocalStoreService userDataSyncLocalStoreService: IUserDataSyncLocalStoreService,\n\t\t@IExtensionManagementService private readonly extensionManagementService: IExtensionManagementService,\n\t\t@IIgnoredExtensionsManagementService private readonly ignoredExtensionsManagementService: IIgnoredExtensionsManagementService,\n\t\t@IUserDataSyncLogService logService: IUserDataSyncLogService,\n\t\t@IConfigurationService configurationService: IConfigurationService,\n\t\t@IUserDataSyncEnablementService userDataSyncEnablementService: IUserDataSyncEnablementService,\n\t\t@ITelemetryService telemetryService: ITelemetryService,\n\t\t@IExtensionStorageService extensionStorageService: IExtensionStorageService,\n\t\t@IUriIdentityService uriIdentityService: IUriIdentityService,\n\t\t@IUserDataProfileStorageService userDataProfileStorageService: IUserDataProfileStorageService,\n\t\t@IInstantiationService private readonly instantiationService: IInstantiationService,\n\t) {\n\t\tsuper({ syncResource: SyncResource.Extensions, profile }, collection, fileService, environmentService, storageService, userDataSyncStoreService, userDataSyncLocalStoreService, userDataSyncEnablementService, telemetryService, logService, configurationService, uriIdentityService);\n\t\tthis.localExtensionsProvider = this.instantiationService.createInstance(LocalExtensionsProvider);\n\t\tthis._register(\n\t\t\tEvent.any<any>(\n\t\t\t\tEvent.filter(this.extensionManagementService.onDidInstallExtensions, (e => e.some(({ local }) => !!local))),\n\t\t\t\tEvent.filter(this.extensionManagementService.onDidUninstallExtension, (e => !e.error)),\n\t\t\t\tEvent.filter(userDataProfileStorageService.onDidChange, e => e.valueChanges.some(({ profile, changes }) => this.syncResource.profile.id === profile.id && changes.some(change => change.key === DISABLED_EXTENSIONS_STORAGE_PATH))),\n\t\t\t\textensionStorageService.onDidChangeExtensionStorageToSync)(() => this.triggerLocalChange()));\n\t}\n\n\tprotected async generateSyncPreview(remoteUserData: IRemoteUserData, lastSyncUserData: ILastSyncUserData | null): Promise<IExtensionResourcePreview[]> {\n\t\tconst remoteExtensions = remoteUserData.syncData ? await parseAndMigrateExtensions(remoteUserData.syncData, this.extensionManagementService) : null;\n\t\tconst skippedExtensions = lastSyncUserData?.skippedExtensions ?? [];\n\t\tconst builtinExtensions = lastSyncUserData?.builtinExtensions ?? null;\n\t\tconst lastSyncExtensions = lastSyncUserData?.syncData ? await parseAndMigrateExtensions(lastSyncUserData.syncData, this.extensionManagementService) : null;\n\n\t\tconst { localExtensions, ignoredExtensions } = await this.localExtensionsProvider.getLocalExtensions(this.syncResource.profile);\n\n\t\tif (remoteExtensions) {\n\t\t\tthis.logService.trace(`${this.syncResourceLogLabel}: Merging remote extensions with local extensions...`);\n\t\t} else {\n\t\t\tthis.logService.trace(`${this.syncResourceLogLabel}: Remote extensions does not exist. Synchronizing extensions for the first time.`);\n\t\t}\n\n\t\tconst { local, remote } = merge(localExtensions, remoteExtensions, lastSyncExtensions, skippedExtensions, ignoredExtensions, builtinExtensions);\n\t\tconst previewResult: IExtensionResourceMergeResult = {\n\t\t\tlocal, remote,\n\t\t\tcontent: this.getPreviewContent(localExtensions, local.added, local.updated, local.removed),\n\t\t\tlocalChange: local.added.length > 0 || local.removed.length > 0 || local.updated.length > 0 ? Change.Modified : Change.None,\n\t\t\tremoteChange: remote !== null ? Change.Modified : Change.None,\n\t\t};\n\n\t\tconst localContent = this.stringify(localExtensions, false);\n\t\treturn [{\n\t\t\tskippedExtensions,\n\t\t\tbuiltinExtensions,\n\t\t\tbaseResource: this.baseResource,\n\t\t\tbaseContent: lastSyncExtensions ? this.stringify(lastSyncExtensions, false) : localContent,\n\t\t\tlocalResource: this.localResource,\n\t\t\tlocalContent,\n\t\t\tlocalExtensions,\n\t\t\tremoteResource: this.remoteResource,\n\t\t\tremoteExtensions,\n\t\t\tremoteContent: remoteExtensions ? this.stringify(remoteExtensions, false) : null,\n\t\t\tpreviewResource: this.previewResource,\n\t\t\tpreviewResult,\n\t\t\tlocalChange: previewResult.localChange,\n\t\t\tremoteChange: previewResult.remoteChange,\n\t\t\tacceptedResource: this.acceptedResource,\n\t\t}];\n\t}\n\n\tprotected async hasRemoteChanged(lastSyncUserData: ILastSyncUserData): Promise<boolean> {\n\t\tconst lastSyncExtensions: ISyncExtension[] | null = lastSyncUserData.syncData ? await parseAndMigrateExtensions(lastSyncUserData.syncData, this.extensionManagementService) : null;\n\t\tconst { localExtensions, ignoredExtensions } = await this.localExtensionsProvider.getLocalExtensions(this.syncResource.profile);\n\t\tconst { remote } = merge(localExtensions, lastSyncExtensions, lastSyncExtensions, lastSyncUserData.skippedExtensions || [], ignoredExtensions, lastSyncUserData.builtinExtensions || []);\n\t\treturn remote !== null;\n\t}\n\n\tprivate getPreviewContent(localExtensions: ISyncExtension[], added: ISyncExtension[], updated: ISyncExtension[], removed: IExtensionIdentifier[]): string {\n\t\tconst preview: ISyncExtension[] = [...added, ...updated];\n\n\t\tconst idsOrUUIDs: Set<string> = new Set<string>();\n\t\tconst addIdentifier = (identifier: IExtensionIdentifier) => {\n\t\t\tidsOrUUIDs.add(identifier.id.toLowerCase());\n\t\t\tif (identifier.uuid) {\n\t\t\t\tidsOrUUIDs.add(identifier.uuid);\n\t\t\t}\n\t\t};\n\t\tpreview.forEach(({ identifier }) => addIdentifier(identifier));\n\t\tremoved.forEach(addIdentifier);\n\n\t\tfor (const localExtension of localExtensions) {\n\t\t\tif (idsOrUUIDs.has(localExtension.identifier.id.toLowerCase()) || (localExtension.identifier.uuid && idsOrUUIDs.has(localExtension.identifier.uuid))) {\n\t\t\t\t// skip\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tpreview.push(localExtension);\n\t\t}\n\n\t\treturn this.stringify(preview, false);\n\t}\n\n\tprotected async getMergeResult(resourcePreview: IExtensionResourcePreview, token: CancellationToken): Promise<IMergeResult> {\n\t\treturn { ...resourcePreview.previewResult, hasConflicts: false };\n\t}\n\n\tprotected async getAcceptResult(resourcePreview: IExtensionResourcePreview, resource: URI, content: string | null | undefined, token: CancellationToken): Promise<IExtensionResourceMergeResult> {\n\n\t\t/* Accept local resource */\n\t\tif (this.extUri.isEqual(resource, this.localResource)) {\n\t\t\treturn this.acceptLocal(resourcePreview);\n\t\t}\n\n\t\t/* Accept remote resource */\n\t\tif (this.extUri.isEqual(resource, this.remoteResource)) {\n\t\t\treturn this.acceptRemote(resourcePreview);\n\t\t}\n\n\t\t/* Accept preview resource */\n\t\tif (this.extUri.isEqual(resource, this.previewResource)) {\n\t\t\treturn resourcePreview.previewResult;\n\t\t}\n\n\t\tthrow new Error(`Invalid Resource: ${resource.toString()}`);\n\t}\n\n\tprivate async acceptLocal(resourcePreview: IExtensionResourcePreview): Promise<IExtensionResourceMergeResult> {\n\t\tconst installedExtensions = await this.extensionManagementService.getInstalled(undefined, this.syncResource.profile.extensionsResource);\n\t\tconst ignoredExtensions = this.ignoredExtensionsManagementService.getIgnoredExtensions(installedExtensions);\n\t\tconst remoteExtensions = resourcePreview.remoteContent ? JSON.parse(resourcePreview.remoteContent) : null;\n\t\tconst mergeResult = merge(resourcePreview.localExtensions, remoteExtensions, remoteExtensions, resourcePreview.skippedExtensions, ignoredExtensions, resourcePreview.builtinExtensions);\n\t\tconst { local, remote } = mergeResult;\n\t\treturn {\n\t\t\tcontent: resourcePreview.localContent,\n\t\t\tlocal,\n\t\t\tremote,\n\t\t\tlocalChange: local.added.length > 0 || local.removed.length > 0 || local.updated.length > 0 ? Change.Modified : Change.None,\n\t\t\tremoteChange: remote !== null ? Change.Modified : Change.None,\n\t\t};\n\t}\n\n\tprivate async acceptRemote(resourcePreview: IExtensionResourcePreview): Promise<IExtensionResourceMergeResult> {\n\t\tconst installedExtensions = await this.extensionManagementService.getInstalled(undefined, this.syncResource.profile.extensionsResource);\n\t\tconst ignoredExtensions = this.ignoredExtensionsManagementService.getIgnoredExtensions(installedExtensions);\n\t\tconst remoteExtensions = resourcePreview.remoteContent ? JSON.parse(resourcePreview.remoteContent) : null;\n\t\tif (remoteExtensions !== null) {\n\t\t\tconst mergeResult = merge(resourcePreview.localExtensions, remoteExtensions, resourcePreview.localExtensions, [], ignoredExtensions, resourcePreview.builtinExtensions);\n\t\t\tconst { local, remote } = mergeResult;\n\t\t\treturn {\n\t\t\t\tcontent: resourcePreview.remoteContent,\n\t\t\t\tlocal,\n\t\t\t\tremote,\n\t\t\t\tlocalChange: local.added.length > 0 || local.removed.length > 0 || local.updated.length > 0 ? Change.Modified : Change.None,\n\t\t\t\tremoteChange: remote !== null ? Change.Modified : Change.None,\n\t\t\t};\n\t\t} else {\n\t\t\treturn {\n\t\t\t\tcontent: resourcePreview.remoteContent,\n\t\t\t\tlocal: { added: [], removed: [], updated: [] },\n\t\t\t\tremote: null,\n\t\t\t\tlocalChange: Change.None,\n\t\t\t\tremoteChange: Change.None,\n\t\t\t};\n\t\t}\n\t}\n\n\tprotected async applyResult(remoteUserData: IRemoteUserData, lastSyncUserData: IRemoteUserData | null, resourcePreviews: [IExtensionResourcePreview, IExtensionResourceMergeResult][], force: boolean): Promise<void> {\n\t\tlet { skippedExtensions, builtinExtensions, localExtensions } = resourcePreviews[0][0];\n\t\tconst { local, remote, localChange, remoteChange } = resourcePreviews[0][1];\n\n\t\tif (localChange === Change.None && remoteChange === Change.None) {\n\t\t\tthis.logService.info(`${this.syncResourceLogLabel}: No changes found during synchronizing extensions.`);\n\t\t}\n\n\t\tif (localChange !== Change.None) {\n\t\t\tawait this.backupLocal(JSON.stringify(localExtensions));\n\t\t\tskippedExtensions = await this.localExtensionsProvider.updateLocalExtensions(local.added, local.removed, local.updated, skippedExtensions, this.syncResource.profile);\n\t\t}\n\n\t\tif (remote) {\n\t\t\t// update remote\n\t\t\tthis.logService.trace(`${this.syncResourceLogLabel}: Updating remote extensions...`);\n\t\t\tconst content = JSON.stringify(remote.all);\n\t\t\tremoteUserData = await this.updateRemoteUserData(content, force ? null : remoteUserData.ref);\n\t\t\tthis.logService.info(`${this.syncResourceLogLabel}: Updated remote extensions.${remote.added.length ? ` Added: ${JSON.stringify(remote.added.map(e => e.identifier.id))}.` : ''}${remote.updated.length ? ` Updated: ${JSON.stringify(remote.updated.map(e => e.identifier.id))}.` : ''}${remote.removed.length ? ` Removed: ${JSON.stringify(remote.removed.map(e => e.identifier.id))}.` : ''}`);\n\t\t}\n\n\t\tif (lastSyncUserData?.ref !== remoteUserData.ref) {\n\t\t\t// update last sync\n\t\t\tthis.logService.trace(`${this.syncResourceLogLabel}: Updating last synchronized extensions...`);\n\t\t\tbuiltinExtensions = this.computeBuiltinExtensions(localExtensions, builtinExtensions);\n\t\t\tawait this.updateLastSyncUserData(remoteUserData, { skippedExtensions, builtinExtensions });\n\t\t\tthis.logService.info(`${this.syncResourceLogLabel}: Updated last synchronized extensions.${skippedExtensions.length ? ` Skipped: ${JSON.stringify(skippedExtensions.map(e => e.identifier.id))}.` : ''}`);\n\t\t}\n\t}\n\n\tprivate computeBuiltinExtensions(localExtensions: ILocalSyncExtension[], previousBuiltinExtensions: IExtensionIdentifier[] | null): IExtensionIdentifier[] {\n\t\tconst localExtensionsSet = new Set<string>();\n\t\tconst builtinExtensions: IExtensionIdentifier[] = [];\n\t\tfor (const localExtension of localExtensions) {\n\t\t\tlocalExtensionsSet.add(localExtension.identifier.id.toLowerCase());\n\t\t\tif (!localExtension.installed) {\n\t\t\t\tbuiltinExtensions.push(localExtension.identifier);\n\t\t\t}\n\t\t}\n\t\tif (previousBuiltinExtensions) {\n\t\t\tfor (const builtinExtension of previousBuiltinExtensions) {\n\t\t\t\t// Add previous builtin extension if it does not exist in local extensions\n\t\t\t\tif (!localExtensionsSet.has(builtinExtension.id.toLowerCase())) {\n\t\t\t\t\tbuiltinExtensions.push(builtinExtension);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn builtinExtensions;\n\t}\n\n\tasync resolveContent(uri: URI): Promise<string | null> {\n\t\tif (this.extUri.isEqual(this.remoteResource, uri)\n\t\t\t|| this.extUri.isEqual(this.baseResource, uri)\n\t\t\t|| this.extUri.isEqual(this.localResource, uri)\n\t\t\t|| this.extUri.isEqual(this.acceptedResource, uri)\n\t\t) {\n\t\t\tconst content = await this.resolvePreviewContent(uri);\n\t\t\treturn content ? this.stringify(JSON.parse(content), true) : content;\n\t\t}\n\t\treturn null;\n\t}\n\n\tprivate stringify(extensions: ISyncExtension[], format: boolean): string {\n\t\treturn stringify(extensions, format);\n\t}\n\n\tasync hasLocalData(): Promise<boolean> {\n\t\ttry {\n\t\t\tconst { localExtensions } = await this.localExtensionsProvider.getLocalExtensions(this.syncResource.profile);\n\t\t\tif (localExtensions.some(e => e.installed || e.disabled)) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t} catch (error) {\n\t\t\t/* ignore error */\n\t\t}\n\t\treturn false;\n\t}\n\n}\n\nexport class LocalExtensionsProvider {\n\n\tconstructor(\n\t\t@IExtensionManagementService private readonly extensionManagementService: IExtensionManagementService,\n\t\t@IUserDataProfileStorageService private readonly userDataProfileStorageService: IUserDataProfileStorageService,\n\t\t@IExtensionGalleryService private readonly extensionGalleryService: IExtensionGalleryService,\n\t\t@IIgnoredExtensionsManagementService private readonly ignoredExtensionsManagementService: IIgnoredExtensionsManagementService,\n\t\t@IInstantiationService private readonly instantiationService: IInstantiationService,\n\t\t@IUserDataSyncLogService private readonly logService: IUserDataSyncLogService,\n\t) { }\n\n\tasync getLocalExtensions(profile: IUserDataProfile): Promise<{ localExtensions: ILocalSyncExtension[]; ignoredExtensions: string[] }> {\n\t\tconst installedExtensions = await this.extensionManagementService.getInstalled(undefined, profile.extensionsResource);\n\t\tconst ignoredExtensions = this.ignoredExtensionsManagementService.getIgnoredExtensions(installedExtensions);\n\t\tconst localExtensions = await this.withProfileScopedServices(profile, async (extensionEnablementService, extensionStorageService) => {\n\t\t\tconst disabledExtensions = extensionEnablementService.getDisabledExtensions();\n\t\t\treturn installedExtensions\n\t\t\t\t.map(extension => {\n\t\t\t\t\tconst { identifier, isBuiltin, manifest, preRelease, pinned, isApplicationScoped } = extension;\n\t\t\t\t\tconst syncExntesion: ILocalSyncExtension = { identifier, preRelease, version: manifest.version, pinned: !!pinned };\n\t\t\t\t\tif (isApplicationScoped && !isApplicationScopedExtension(manifest)) {\n\t\t\t\t\t\tsyncExntesion.isApplicationScoped = isApplicationScoped;\n\t\t\t\t\t}\n\t\t\t\t\tif (disabledExtensions.some(disabledExtension => areSameExtensions(disabledExtension, identifier))) {\n\t\t\t\t\t\tsyncExntesion.disabled = true;\n\t\t\t\t\t}\n\t\t\t\t\tif (!isBuiltin) {\n\t\t\t\t\t\tsyncExntesion.installed = true;\n\t\t\t\t\t}\n\t\t\t\t\ttry {\n\t\t\t\t\t\tconst keys = extensionStorageService.getKeysForSync({ id: identifier.id, version: manifest.version });\n\t\t\t\t\t\tif (keys) {\n\t\t\t\t\t\t\tconst extensionStorageState = extensionStorageService.getExtensionState(extension, true) || {};\n\t\t\t\t\t\t\tsyncExntesion.state = Object.keys(extensionStorageState).reduce((state: IStringDictionary<any>, key) => {\n\t\t\t\t\t\t\t\tif (keys.includes(key)) {\n\t\t\t\t\t\t\t\t\tstate[key] = extensionStorageState[key];\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\treturn state;\n\t\t\t\t\t\t\t}, {});\n\t\t\t\t\t\t}\n\t\t\t\t\t} catch (error) {\n\t\t\t\t\t\tthis.logService.info(`${getSyncResourceLogLabel(SyncResource.Extensions, profile)}: Error while parsing extension state`, getErrorMessage(error));\n\t\t\t\t\t}\n\t\t\t\t\treturn syncExntesion;\n\t\t\t\t});\n\t\t});\n\t\treturn { localExtensions, ignoredExtensions };\n\t}\n\n\tasync updateLocalExtensions(added: ISyncExtension[], removed: IExtensionIdentifier[], updated: ISyncExtension[], skippedExtensions: ISyncExtension[], profile: IUserDataProfile): Promise<ISyncExtension[]> {\n\t\tconst syncResourceLogLabel = getSyncResourceLogLabel(SyncResource.Extensions, profile);\n\t\tconst extensionsToInstall: InstallExtensionInfo[] = [];\n\t\tconst syncExtensionsToInstall = new Map<string, ISyncExtension>();\n\t\tconst removeFromSkipped: IExtensionIdentifier[] = [];\n\t\tconst addToSkipped: ISyncExtension[] = [];\n\t\tconst installedExtensions = await this.extensionManagementService.getInstalled(undefined, profile.extensionsResource);\n\n\t\t// 1. Sync extensions state first so that the storage is flushed and updated in all opened windows\n\t\tif (added.length || updated.length) {\n\t\t\tawait this.withProfileScopedServices(profile, async (extensionEnablementService, extensionStorageService) => {\n\t\t\t\tawait Promises.settled([...added, ...updated].map(async e => {\n\t\t\t\t\tconst installedExtension = installedExtensions.find(installed => areSameExtensions(installed.identifier, e.identifier));\n\n\t\t\t\t\t// Builtin Extension Sync: Enablement & State\n\t\t\t\t\tif (installedExtension && installedExtension.isBuiltin) {\n\t\t\t\t\t\tif (e.state && installedExtension.manifest.version === e.version) {\n\t\t\t\t\t\t\tthis.updateExtensionState(e.state, installedExtension, installedExtension.manifest.version, extensionStorageService);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tconst isDisabled = extensionEnablementService.getDisabledExtensions().some(disabledExtension => areSameExtensions(disabledExtension, e.identifier));\n\t\t\t\t\t\tif (isDisabled !== !!e.disabled) {\n\t\t\t\t\t\t\tif (e.disabled) {\n\t\t\t\t\t\t\t\tthis.logService.trace(`${syncResourceLogLabel}: Disabling extension...`, e.identifier.id);\n\t\t\t\t\t\t\t\tawait extensionEnablementService.disableExtension(e.identifier);\n\t\t\t\t\t\t\t\tthis.logService.info(`${syncResourceLogLabel}: Disabled extension`, e.identifier.id);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tthis.logService.trace(`${syncResourceLogLabel}: Enabling extension...`, e.identifier.id);\n\t\t\t\t\t\t\t\tawait extensionEnablementService.enableExtension(e.identifier);\n\t\t\t\t\t\t\t\tthis.logService.info(`${syncResourceLogLabel}: Enabled extension`, e.identifier.id);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tremoveFromSkipped.push(e.identifier);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\t// User Extension Sync: Install/Update, Enablement & State\n\t\t\t\t\tconst version = e.pinned ? e.version : undefined;\n\t\t\t\t\tconst extension = (await this.extensionGalleryService.getExtensions([{ ...e.identifier, version, preRelease: version ? undefined : e.preRelease }], CancellationToken.None))[0];\n\n\t\t\t\t\t/* Update extension state only if\n\t\t\t\t\t *\textension is installed and version is same as synced version or\n\t\t\t\t\t *\textension is not installed and installable\n\t\t\t\t\t */\n\t\t\t\t\tif (e.state &&\n\t\t\t\t\t\t(installedExtension ? installedExtension.manifest.version === e.version /* Installed and remote has same version */\n\t\t\t\t\t\t\t: !!extension /* Installable */)\n\t\t\t\t\t) {\n\t\t\t\t\t\tthis.updateExtensionState(e.state, installedExtension || extension, installedExtension?.manifest.version, extensionStorageService);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (extension) {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tconst isDisabled = extensionEnablementService.getDisabledExtensions().some(disabledExtension => areSameExtensions(disabledExtension, e.identifier));\n\t\t\t\t\t\t\tif (isDisabled !== !!e.disabled) {\n\t\t\t\t\t\t\t\tif (e.disabled) {\n\t\t\t\t\t\t\t\t\tthis.logService.trace(`${syncResourceLogLabel}: Disabling extension...`, e.identifier.id, extension.version);\n\t\t\t\t\t\t\t\t\tawait extensionEnablementService.disableExtension(extension.identifier);\n\t\t\t\t\t\t\t\t\tthis.logService.info(`${syncResourceLogLabel}: Disabled extension`, e.identifier.id, extension.version);\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tthis.logService.trace(`${syncResourceLogLabel}: Enabling extension...`, e.identifier.id, extension.version);\n\t\t\t\t\t\t\t\t\tawait extensionEnablementService.enableExtension(extension.identifier);\n\t\t\t\t\t\t\t\t\tthis.logService.info(`${syncResourceLogLabel}: Enabled extension`, e.identifier.id, extension.version);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (!installedExtension // Install if the extension does not exist\n\t\t\t\t\t\t\t\t|| installedExtension.preRelease !== e.preRelease // Install if the extension pre-release preference has changed\n\t\t\t\t\t\t\t\t|| installedExtension.pinned !== e.pinned  // Install if the extension pinned preference has changed\n\t\t\t\t\t\t\t\t|| (version && installedExtension.manifest.version !== version)  // Install if the extension version has changed\n\t\t\t\t\t\t\t) {\n\t\t\t\t\t\t\t\tif (await this.extensionManagementService.canInstall(extension) === true) {\n\t\t\t\t\t\t\t\t\textensionsToInstall.push({\n\t\t\t\t\t\t\t\t\t\textension, options: {\n\t\t\t\t\t\t\t\t\t\t\tisMachineScoped: false /* set isMachineScoped value to prevent install and sync dialog in web */,\n\t\t\t\t\t\t\t\t\t\t\tdonotIncludePackAndDependencies: true,\n\t\t\t\t\t\t\t\t\t\t\tinstallGivenVersion: e.pinned && !!e.version,\n\t\t\t\t\t\t\t\t\t\t\tpinned: e.pinned,\n\t\t\t\t\t\t\t\t\t\t\tinstallPreReleaseVersion: e.preRelease,\n\t\t\t\t\t\t\t\t\t\t\tpreRelease: e.preRelease,\n\t\t\t\t\t\t\t\t\t\t\tprofileLocation: profile.extensionsResource,\n\t\t\t\t\t\t\t\t\t\t\tisApplicationScoped: e.isApplicationScoped,\n\t\t\t\t\t\t\t\t\t\t\tcontext: { [EXTENSION_INSTALL_SKIP_WALKTHROUGH_CONTEXT]: true, [EXTENSION_INSTALL_SOURCE_CONTEXT]: ExtensionInstallSource.SETTINGS_SYNC, [EXTENSION_INSTALL_SKIP_PUBLISHER_TRUST_CONTEXT]: true }\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\tsyncExtensionsToInstall.set(extension.identifier.id.toLowerCase(), e);\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tthis.logService.info(`${syncResourceLogLabel}: Skipped synchronizing extension because it cannot be installed.`, extension.displayName || extension.identifier.id);\n\t\t\t\t\t\t\t\t\taddToSkipped.push(e);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} catch (error) {\n\t\t\t\t\t\t\taddToSkipped.push(e);\n\t\t\t\t\t\t\tthis.logService.error(error);\n\t\t\t\t\t\t\tthis.logService.info(`${syncResourceLogLabel}: Skipped synchronizing extension`, extension.displayName || extension.identifier.id);\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\taddToSkipped.push(e);\n\t\t\t\t\t\tthis.logService.info(`${syncResourceLogLabel}: Skipped synchronizing extension because the extension is not found.`, e.identifier.id);\n\t\t\t\t\t}\n\t\t\t\t}));\n\t\t\t});\n\t\t}\n\n\t\t// 2. Next uninstall the removed extensions\n\t\tif (removed.length) {\n\t\t\tconst extensionsToRemove = installedExtensions.filter(({ identifier, isBuiltin }) => !isBuiltin && removed.some(r => areSameExtensions(identifier, r)));\n\t\t\tawait Promises.settled(extensionsToRemove.map(async extensionToRemove => {\n\t\t\t\tthis.logService.trace(`${syncResourceLogLabel}: Uninstalling local extension...`, extensionToRemove.identifier.id);\n\t\t\t\tawait this.extensionManagementService.uninstall(extensionToRemove, { donotIncludePack: true, donotCheckDependents: true, profileLocation: profile.extensionsResource });\n\t\t\t\tthis.logService.info(`${syncResourceLogLabel}: Uninstalled local extension.`, extensionToRemove.identifier.id);\n\t\t\t\tremoveFromSkipped.push(extensionToRemove.identifier);\n\t\t\t}));\n\t\t}\n\n\t\t// 3. Install extensions at the end\n\t\tconst results = await this.extensionManagementService.installGalleryExtensions(extensionsToInstall);\n\t\tfor (const { identifier, local, error, source } of results) {\n\t\t\tconst gallery = source as IGalleryExtension;\n\t\t\tif (local) {\n\t\t\t\tthis.logService.info(`${syncResourceLogLabel}: Installed extension.`, identifier.id, gallery.version);\n\t\t\t\tremoveFromSkipped.push(identifier);\n\t\t\t} else {\n\t\t\t\tconst e = syncExtensionsToInstall.get(identifier.id.toLowerCase());\n\t\t\t\tif (e) {\n\t\t\t\t\taddToSkipped.push(e);\n\t\t\t\t\tthis.logService.info(`${syncResourceLogLabel}: Skipped synchronizing extension`, gallery.displayName || gallery.identifier.id);\n\t\t\t\t}\n\t\t\t\tif (error instanceof ExtensionManagementError && [ExtensionManagementErrorCode.Incompatible, ExtensionManagementErrorCode.IncompatibleApi, ExtensionManagementErrorCode.IncompatibleTargetPlatform].includes(error.code)) {\n\t\t\t\t\tthis.logService.info(`${syncResourceLogLabel}: Skipped synchronizing extension because the compatible extension is not found.`, gallery.displayName || gallery.identifier.id);\n\t\t\t\t} else if (error) {\n\t\t\t\t\tthis.logService.error(error);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tconst newSkippedExtensions: ISyncExtension[] = [];\n\t\tfor (const skippedExtension of skippedExtensions) {\n\t\t\tif (!removeFromSkipped.some(e => areSameExtensions(e, skippedExtension.identifier))) {\n\t\t\t\tnewSkippedExtensions.push(skippedExtension);\n\t\t\t}\n\t\t}\n\t\tfor (const skippedExtension of addToSkipped) {\n\t\t\tif (!newSkippedExtensions.some(e => areSameExtensions(e.identifier, skippedExtension.identifier))) {\n\t\t\t\tnewSkippedExtensions.push(skippedExtension);\n\t\t\t}\n\t\t}\n\t\treturn newSkippedExtensions;\n\t}\n\n\tprivate updateExtensionState(state: IStringDictionary<any>, extension: ILocalExtension | IGalleryExtension, version: string | undefined, extensionStorageService: IExtensionStorageService): void {\n\t\tconst extensionState = extensionStorageService.getExtensionState(extension, true) || {};\n\t\tconst keys = version ? extensionStorageService.getKeysForSync({ id: extension.identifier.id, version }) : undefined;\n\t\tif (keys) {\n\t\t\tkeys.forEach(key => { extensionState[key] = state[key]; });\n\t\t} else {\n\t\t\tObject.keys(state).forEach(key => extensionState[key] = state[key]);\n\t\t}\n\t\textensionStorageService.setExtensionState(extension, extensionState, true);\n\t}\n\n\tprivate async withProfileScopedServices<T>(profile: IUserDataProfile, fn: (extensionEnablementService: IGlobalExtensionEnablementService, extensionStorageService: IExtensionStorageService) => Promise<T>): Promise<T> {\n\t\treturn this.userDataProfileStorageService.withProfileScopedStorageService(profile,\n\t\t\tasync storageService => {\n\t\t\t\tconst disposables = new DisposableStore();\n\t\t\t\tconst instantiationService = disposables.add(this.instantiationService.createChild(new ServiceCollection([IStorageService, storageService])));\n\t\t\t\tconst extensionEnablementService = disposables.add(instantiationService.createInstance(GlobalExtensionEnablementService));\n\t\t\t\tconst extensionStorageService = disposables.add(instantiationService.createInstance(ExtensionStorageService));\n\t\t\t\ttry {\n\t\t\t\t\treturn await fn(extensionEnablementService, extensionStorageService);\n\t\t\t\t} finally {\n\t\t\t\t\tdisposables.dispose();\n\t\t\t\t}\n\t\t\t});\n\t}\n\n}\n\nexport interface IExtensionsInitializerPreviewResult {\n\treadonly installedExtensions: ILocalExtension[];\n\treadonly disabledExtensions: IExtensionIdentifier[];\n\treadonly newExtensions: (IExtensionIdentifier & { preRelease: boolean })[];\n\treadonly remoteExtensions: ISyncExtension[];\n}\n\nexport abstract class AbstractExtensionsInitializer extends AbstractInitializer {\n\n\tconstructor(\n\t\t@IExtensionManagementService protected readonly extensionManagementService: IExtensionManagementService,\n\t\t@IIgnoredExtensionsManagementService private readonly ignoredExtensionsManagementService: IIgnoredExtensionsManagementService,\n\t\t@IFileService fileService: IFileService,\n\t\t@IUserDataProfilesService userDataProfilesService: IUserDataProfilesService,\n\t\t@IEnvironmentService environmentService: IEnvironmentService,\n\t\t@ILogService logService: ILogService,\n\t\t@IStorageService storageService: IStorageService,\n\t\t@IUriIdentityService uriIdentityService: IUriIdentityService,\n\t) {\n\t\tsuper(SyncResource.Extensions, userDataProfilesService, environmentService, logService, fileService, storageService, uriIdentityService);\n\t}\n\n\tprotected async parseExtensions(remoteUserData: IRemoteUserData): Promise<ISyncExtension[] | null> {\n\t\treturn remoteUserData.syncData ? await parseAndMigrateExtensions(remoteUserData.syncData, this.extensionManagementService) : null;\n\t}\n\n\tprotected generatePreview(remoteExtensions: ISyncExtension[], localExtensions: ILocalExtension[]): IExtensionsInitializerPreviewResult {\n\t\tconst installedExtensions: ILocalExtension[] = [];\n\t\tconst newExtensions: (IExtensionIdentifier & { preRelease: boolean })[] = [];\n\t\tconst disabledExtensions: IExtensionIdentifier[] = [];\n\t\tfor (const extension of remoteExtensions) {\n\t\t\tif (this.ignoredExtensionsManagementService.hasToNeverSyncExtension(extension.identifier.id)) {\n\t\t\t\t// Skip extension ignored to sync\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tconst installedExtension = localExtensions.find(i => areSameExtensions(i.identifier, extension.identifier));\n\t\t\tif (installedExtension) {\n\t\t\t\tinstalledExtensions.push(installedExtension);\n\t\t\t\tif (extension.disabled) {\n\t\t\t\t\tdisabledExtensions.push(extension.identifier);\n\t\t\t\t}\n\t\t\t} else if (extension.installed) {\n\t\t\t\tnewExtensions.push({ ...extension.identifier, preRelease: !!extension.preRelease });\n\t\t\t\tif (extension.disabled) {\n\t\t\t\t\tdisabledExtensions.push(extension.identifier);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn { installedExtensions, newExtensions, disabledExtensions, remoteExtensions };\n\t}\n\n}\n"]}