{"version":3,"sources":["vs/platform/userDataSync/common/abstractSynchronizer.ts"],"names":[],"mappings":"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","file":"abstractSynchronizer.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { equals } from '../../../base/common/arrays.js';\nimport { CancelablePromise, createCancelablePromise, ThrottledDelayer } from '../../../base/common/async.js';\nimport { VSBuffer } from '../../../base/common/buffer.js';\nimport { CancellationToken } from '../../../base/common/cancellation.js';\nimport { IStringDictionary } from '../../../base/common/collections.js';\nimport { Emitter, Event } from '../../../base/common/event.js';\nimport { parse, ParseError } from '../../../base/common/json.js';\nimport { FormattingOptions } from '../../../base/common/jsonFormatter.js';\nimport { Disposable } from '../../../base/common/lifecycle.js';\nimport { IExtUri } from '../../../base/common/resources.js';\nimport { uppercaseFirstLetter } from '../../../base/common/strings.js';\nimport { isString, isUndefined } from '../../../base/common/types.js';\nimport { URI } from '../../../base/common/uri.js';\nimport { IHeaders } from '../../../base/parts/request/common/request.js';\nimport { localize } from '../../../nls.js';\nimport { IConfigurationService } from '../../configuration/common/configuration.js';\nimport { IEnvironmentService } from '../../environment/common/environment.js';\nimport { FileChangesEvent, FileOperationError, FileOperationResult, IFileContent, IFileService, toFileOperationResult } from '../../files/common/files.js';\nimport { ILogService } from '../../log/common/log.js';\nimport { getServiceMachineId } from '../../externalServices/common/serviceMachineId.js';\nimport { IStorageService, StorageScope, StorageTarget } from '../../storage/common/storage.js';\nimport { ITelemetryService } from '../../telemetry/common/telemetry.js';\nimport { IUriIdentityService } from '../../uriIdentity/common/uriIdentity.js';\nimport {\n\tChange, getLastSyncResourceUri, IRemoteUserData, IResourcePreview as IBaseResourcePreview, ISyncData,\n\tIUserDataSyncResourcePreview as IBaseSyncResourcePreview, IUserData, IUserDataSyncResourceInitializer, IUserDataSyncLocalStoreService,\n\tIUserDataSyncConfiguration, IUserDataSynchroniser, IUserDataSyncLogService, IUserDataSyncEnablementService, IUserDataSyncStoreService,\n\tIUserDataSyncUtilService, MergeState, PREVIEW_DIR_NAME, SyncResource, SyncStatus, UserDataSyncError, UserDataSyncErrorCode,\n\tUSER_DATA_SYNC_CONFIGURATION_SCOPE, USER_DATA_SYNC_SCHEME, getPathSegments, IUserDataSyncResourceConflicts,\n\tIUserDataSyncResource, IUserDataSyncResourcePreview,\n\tNON_EXISTING_RESOURCE_REF,\n} from './userDataSync.js';\nimport { IUserDataProfile, IUserDataProfilesService } from '../../userDataProfile/common/userDataProfile.js';\n\nexport function isRemoteUserData(thing: any): thing is IRemoteUserData {\n\tif (thing\n\t\t&& (thing.ref !== undefined && typeof thing.ref === 'string' && thing.ref !== '')\n\t\t&& (thing.syncData !== undefined && (thing.syncData === null || isSyncData(thing.syncData)))) {\n\t\treturn true;\n\t}\n\n\treturn false;\n}\n\nexport function isSyncData(thing: any): thing is ISyncData {\n\tif (thing\n\t\t&& (thing.version !== undefined && typeof thing.version === 'number')\n\t\t&& (thing.content !== undefined && typeof thing.content === 'string')) {\n\n\t\t// backward compatibility\n\t\tif (Object.keys(thing).length === 2) {\n\t\t\treturn true;\n\t\t}\n\n\t\tif (Object.keys(thing).length === 3\n\t\t\t&& (thing.machineId !== undefined && typeof thing.machineId === 'string')) {\n\t\t\treturn true;\n\t\t}\n\t}\n\n\treturn false;\n}\n\nexport function getSyncResourceLogLabel(syncResource: SyncResource, profile: IUserDataProfile): string {\n\treturn `${uppercaseFirstLetter(syncResource)}${profile.isDefault ? '' : ` (${profile.name})`}`;\n}\n\nexport interface IResourcePreview {\n\n\treadonly baseResource: URI;\n\treadonly baseContent: string | null;\n\n\treadonly remoteResource: URI;\n\treadonly remoteContent: string | null;\n\treadonly remoteChange: Change;\n\n\treadonly localResource: URI;\n\treadonly localContent: string | null;\n\treadonly localChange: Change;\n\n\treadonly previewResource: URI;\n\treadonly acceptedResource: URI;\n}\n\nexport interface IAcceptResult {\n\treadonly content: string | null;\n\treadonly localChange: Change;\n\treadonly remoteChange: Change;\n}\n\nexport interface IMergeResult extends IAcceptResult {\n\treadonly hasConflicts: boolean;\n}\n\ninterface IEditableResourcePreview extends IBaseResourcePreview, IResourcePreview {\n\tlocalChange: Change;\n\tremoteChange: Change;\n\tmergeState: MergeState;\n\tacceptResult?: IAcceptResult;\n}\n\nexport interface ISyncResourcePreview extends IBaseSyncResourcePreview {\n\treadonly remoteUserData: IRemoteUserData;\n\treadonly lastSyncUserData: IRemoteUserData | null;\n\treadonly resourcePreviews: IEditableResourcePreview[];\n}\n\ninterface ILastSyncUserDataState {\n\treadonly ref: string;\n\treadonly version: string | undefined;\n\t[key: string]: any;\n}\n\nexport const enum SyncStrategy {\n\tPreview = 'preview', // Merge the local and remote data without applying.\n\tMerge = 'merge', // Merge the local and remote data and apply.\n\tPullOrPush = 'pull-push', // Pull the remote data or push the local data.\n}\n\nexport abstract class AbstractSynchroniser extends Disposable implements IUserDataSynchroniser {\n\n\tprivate syncPreviewPromise: CancelablePromise<ISyncResourcePreview> | null = null;\n\n\tprotected readonly syncFolder: URI;\n\tprotected readonly syncPreviewFolder: URI;\n\tprotected readonly extUri: IExtUri;\n\tprotected readonly currentMachineIdPromise: Promise<string>;\n\n\tprivate _status: SyncStatus = SyncStatus.Idle;\n\tget status(): SyncStatus { return this._status; }\n\tprivate _onDidChangStatus: Emitter<SyncStatus> = this._register(new Emitter<SyncStatus>());\n\treadonly onDidChangeStatus: Event<SyncStatus> = this._onDidChangStatus.event;\n\n\tprivate _conflicts: IBaseResourcePreview[] = [];\n\tget conflicts(): IUserDataSyncResourceConflicts { return { ...this.syncResource, conflicts: this._conflicts }; }\n\tprivate _onDidChangeConflicts = this._register(new Emitter<IUserDataSyncResourceConflicts>());\n\treadonly onDidChangeConflicts = this._onDidChangeConflicts.event;\n\n\tprivate readonly localChangeTriggerThrottler = this._register(new ThrottledDelayer<void>(50));\n\tprivate readonly _onDidChangeLocal: Emitter<void> = this._register(new Emitter<void>());\n\treadonly onDidChangeLocal: Event<void> = this._onDidChangeLocal.event;\n\n\tprotected readonly lastSyncResource: URI;\n\tprivate readonly lastSyncUserDataStateKey: string;\n\tprivate hasSyncResourceStateVersionChanged: boolean = false;\n\tprotected readonly syncResourceLogLabel: string;\n\n\tprotected syncHeaders: IHeaders = {};\n\n\treadonly resource: SyncResource;\n\n\tconstructor(\n\t\treadonly syncResource: IUserDataSyncResource,\n\t\treadonly collection: string | undefined,\n\t\t@IFileService protected readonly fileService: IFileService,\n\t\t@IEnvironmentService protected readonly environmentService: IEnvironmentService,\n\t\t@IStorageService protected readonly storageService: IStorageService,\n\t\t@IUserDataSyncStoreService protected readonly userDataSyncStoreService: IUserDataSyncStoreService,\n\t\t@IUserDataSyncLocalStoreService protected readonly userDataSyncLocalStoreService: IUserDataSyncLocalStoreService,\n\t\t@IUserDataSyncEnablementService protected readonly userDataSyncEnablementService: IUserDataSyncEnablementService,\n\t\t@ITelemetryService protected readonly telemetryService: ITelemetryService,\n\t\t@IUserDataSyncLogService protected readonly logService: IUserDataSyncLogService,\n\t\t@IConfigurationService protected readonly configurationService: IConfigurationService,\n\t\t@IUriIdentityService uriIdentityService: IUriIdentityService,\n\t) {\n\t\tsuper();\n\t\tthis.lastSyncUserDataStateKey = `${collection ? `${collection}.` : ''}${syncResource.syncResource}.lastSyncUserData`;\n\t\tthis.resource = syncResource.syncResource;\n\t\tthis.syncResourceLogLabel = getSyncResourceLogLabel(syncResource.syncResource, syncResource.profile);\n\t\tthis.extUri = uriIdentityService.extUri;\n\t\tthis.syncFolder = this.extUri.joinPath(environmentService.userDataSyncHome, ...getPathSegments(syncResource.profile.isDefault ? undefined : syncResource.profile.id, syncResource.syncResource));\n\t\tthis.syncPreviewFolder = this.extUri.joinPath(this.syncFolder, PREVIEW_DIR_NAME);\n\t\tthis.lastSyncResource = getLastSyncResourceUri(syncResource.profile.isDefault ? undefined : syncResource.profile.id, syncResource.syncResource, environmentService, this.extUri);\n\t\tthis.currentMachineIdPromise = getServiceMachineId(environmentService, fileService, storageService);\n\t}\n\n\tprotected triggerLocalChange(): void {\n\t\tthis.localChangeTriggerThrottler.trigger(() => this.doTriggerLocalChange());\n\t}\n\n\tprotected async doTriggerLocalChange(): Promise<void> {\n\n\t\t// Sync again if current status is in conflicts\n\t\tif (this.status === SyncStatus.HasConflicts) {\n\t\t\tthis.logService.info(`${this.syncResourceLogLabel}: In conflicts state and local change detected. Syncing again...`);\n\t\t\tconst preview = await this.syncPreviewPromise!;\n\t\t\tthis.syncPreviewPromise = null;\n\t\t\tconst status = await this.performSync(preview.remoteUserData, preview.lastSyncUserData, SyncStrategy.Merge, this.getUserDataSyncConfiguration());\n\t\t\tthis.setStatus(status);\n\t\t}\n\n\t\t// Check if local change causes remote change\n\t\telse {\n\t\t\tthis.logService.trace(`${this.syncResourceLogLabel}: Checking for local changes...`);\n\t\t\tconst lastSyncUserData = await this.getLastSyncUserData();\n\t\t\tconst hasRemoteChanged = lastSyncUserData ? await this.hasRemoteChanged(lastSyncUserData) : true;\n\t\t\tif (hasRemoteChanged) {\n\t\t\t\tthis._onDidChangeLocal.fire();\n\t\t\t}\n\t\t}\n\t}\n\n\tprotected setStatus(status: SyncStatus): void {\n\t\tif (this._status !== status) {\n\t\t\tthis._status = status;\n\t\t\tthis._onDidChangStatus.fire(status);\n\t\t}\n\t}\n\n\tasync sync(refOrUserData: string | IUserData | null, preview: boolean = false, userDataSyncConfiguration: IUserDataSyncConfiguration = this.getUserDataSyncConfiguration(), headers: IHeaders = {}): Promise<IUserDataSyncResourcePreview | null> {\n\t\ttry {\n\t\t\tthis.syncHeaders = { ...headers };\n\n\t\t\tif (this.status === SyncStatus.HasConflicts) {\n\t\t\t\tthis.logService.info(`${this.syncResourceLogLabel}: Skipped synchronizing ${this.resource.toLowerCase()} as there are conflicts.`);\n\t\t\t\treturn this.syncPreviewPromise;\n\t\t\t}\n\n\t\t\tif (this.status === SyncStatus.Syncing) {\n\t\t\t\tthis.logService.info(`${this.syncResourceLogLabel}: Skipped synchronizing ${this.resource.toLowerCase()} as it is running already.`);\n\t\t\t\treturn this.syncPreviewPromise;\n\t\t\t}\n\n\t\t\tthis.logService.trace(`${this.syncResourceLogLabel}: Started synchronizing ${this.resource.toLowerCase()}...`);\n\t\t\tthis.setStatus(SyncStatus.Syncing);\n\n\t\t\tlet status: SyncStatus = SyncStatus.Idle;\n\t\t\ttry {\n\t\t\t\tconst lastSyncUserData = await this.getLastSyncUserData();\n\t\t\t\tconst remoteUserData = await this.getLatestRemoteUserData(refOrUserData, lastSyncUserData);\n\t\t\t\tstatus = await this.performSync(remoteUserData, lastSyncUserData, preview ? SyncStrategy.Preview : SyncStrategy.Merge, userDataSyncConfiguration);\n\t\t\t\tif (status === SyncStatus.HasConflicts) {\n\t\t\t\t\tthis.logService.info(`${this.syncResourceLogLabel}: Detected conflicts while synchronizing ${this.resource.toLowerCase()}.`);\n\t\t\t\t} else if (status === SyncStatus.Idle) {\n\t\t\t\t\tthis.logService.trace(`${this.syncResourceLogLabel}: Finished synchronizing ${this.resource.toLowerCase()}.`);\n\t\t\t\t}\n\t\t\t\treturn this.syncPreviewPromise || null;\n\t\t\t} finally {\n\t\t\t\tthis.setStatus(status);\n\t\t\t}\n\t\t} finally {\n\t\t\tthis.syncHeaders = {};\n\t\t}\n\t}\n\n\tasync apply(force: boolean, headers: IHeaders = {}): Promise<ISyncResourcePreview | null> {\n\t\ttry {\n\t\t\tthis.syncHeaders = { ...headers };\n\n\t\t\tconst status = await this.doApply(force);\n\t\t\tthis.setStatus(status);\n\n\t\t\treturn this.syncPreviewPromise;\n\t\t} finally {\n\t\t\tthis.syncHeaders = {};\n\t\t}\n\t}\n\n\tasync replace(content: string): Promise<boolean> {\n\t\tconst syncData = this.parseSyncData(content);\n\t\tif (!syncData) {\n\t\t\treturn false;\n\t\t}\n\n\t\tawait this.stop();\n\n\t\ttry {\n\t\t\tthis.logService.trace(`${this.syncResourceLogLabel}: Started resetting ${this.resource.toLowerCase()}...`);\n\t\t\tthis.setStatus(SyncStatus.Syncing);\n\t\t\tconst lastSyncUserData = await this.getLastSyncUserData();\n\t\t\tconst remoteUserData = await this.getLatestRemoteUserData(null, lastSyncUserData);\n\t\t\tconst isRemoteDataFromCurrentMachine = await this.isRemoteDataFromCurrentMachine(remoteUserData);\n\n\t\t\t/* use replace sync data */\n\t\t\tconst resourcePreviewResults = await this.generateSyncPreview({ ref: remoteUserData.ref, syncData }, lastSyncUserData, isRemoteDataFromCurrentMachine, this.getUserDataSyncConfiguration(), CancellationToken.None);\n\n\t\t\tconst resourcePreviews: [IResourcePreview, IAcceptResult][] = [];\n\t\t\tfor (const resourcePreviewResult of resourcePreviewResults) {\n\t\t\t\t/* Accept remote resource */\n\t\t\t\tconst acceptResult: IAcceptResult = await this.getAcceptResult(resourcePreviewResult, resourcePreviewResult.remoteResource, undefined, CancellationToken.None);\n\t\t\t\t/* compute remote change */\n\t\t\t\tconst { remoteChange } = await this.getAcceptResult(resourcePreviewResult, resourcePreviewResult.previewResource, resourcePreviewResult.remoteContent, CancellationToken.None);\n\t\t\t\tresourcePreviews.push([resourcePreviewResult, { ...acceptResult, remoteChange: remoteChange !== Change.None ? remoteChange : Change.Modified }]);\n\t\t\t}\n\n\t\t\tawait this.applyResult(remoteUserData, lastSyncUserData, resourcePreviews, false);\n\t\t\tthis.logService.info(`${this.syncResourceLogLabel}: Finished resetting ${this.resource.toLowerCase()}.`);\n\t\t} finally {\n\t\t\tthis.setStatus(SyncStatus.Idle);\n\t\t}\n\n\t\treturn true;\n\t}\n\n\tprivate async isRemoteDataFromCurrentMachine(remoteUserData: IRemoteUserData): Promise<boolean> {\n\t\tconst machineId = await this.currentMachineIdPromise;\n\t\treturn !!remoteUserData.syncData?.machineId && remoteUserData.syncData.machineId === machineId;\n\t}\n\n\tprotected async getLatestRemoteUserData(refOrLatestData: string | IUserData | null, lastSyncUserData: IRemoteUserData | null): Promise<IRemoteUserData> {\n\t\tif (refOrLatestData === null) {\n\t\t\treturn { ref: NON_EXISTING_RESOURCE_REF, syncData: null };\n\t\t}\n\n\t\tif (!isString(refOrLatestData)) {\n\t\t\treturn this.toRemoteUserData(refOrLatestData);\n\t\t}\n\n\t\t// Last time synced resource and latest resource on server are same\n\t\tif (lastSyncUserData?.ref === refOrLatestData) {\n\t\t\treturn lastSyncUserData;\n\t\t}\n\n\t\treturn this.getRemoteUserData(lastSyncUserData);\n\t}\n\n\tprivate async performSync(remoteUserData: IRemoteUserData, lastSyncUserData: IRemoteUserData | null, strategy: SyncStrategy, userDataSyncConfiguration: IUserDataSyncConfiguration): Promise<SyncStatus> {\n\t\tif (remoteUserData.syncData && remoteUserData.syncData.version > this.version) {\n\t\t\tthrow new UserDataSyncError(localize({ key: 'incompatible', comment: ['This is an error while syncing a resource that its local version is not compatible with its remote version.'] }, \"Cannot sync {0} as its local version {1} is not compatible with its remote version {2}\", this.resource, this.version, remoteUserData.syncData.version), UserDataSyncErrorCode.IncompatibleLocalContent, this.resource);\n\t\t}\n\n\t\ttry {\n\t\t\treturn await this.doSync(remoteUserData, lastSyncUserData, strategy, userDataSyncConfiguration);\n\t\t} catch (e) {\n\t\t\tif (e instanceof UserDataSyncError) {\n\t\t\t\tswitch (e.code) {\n\n\t\t\t\t\tcase UserDataSyncErrorCode.LocalPreconditionFailed:\n\t\t\t\t\t\t// Rejected as there is a new local version. Syncing again...\n\t\t\t\t\t\tthis.logService.info(`${this.syncResourceLogLabel}: Failed to synchronize ${this.syncResourceLogLabel} as there is a new local version available. Synchronizing again...`);\n\t\t\t\t\t\treturn this.performSync(remoteUserData, lastSyncUserData, strategy, userDataSyncConfiguration);\n\n\t\t\t\t\tcase UserDataSyncErrorCode.Conflict:\n\t\t\t\t\tcase UserDataSyncErrorCode.PreconditionFailed:\n\t\t\t\t\t\t// Rejected as there is a new remote version. Syncing again...\n\t\t\t\t\t\tthis.logService.info(`${this.syncResourceLogLabel}: Failed to synchronize as there is a new remote version available. Synchronizing again...`);\n\n\t\t\t\t\t\t// Avoid cache and get latest remote user data - https://github.com/microsoft/vscode/issues/90624\n\t\t\t\t\t\tremoteUserData = await this.getRemoteUserData(null);\n\n\t\t\t\t\t\t// Get the latest last sync user data. Because multiple parallel syncs (in Web) could share same last sync data\n\t\t\t\t\t\t// and one of them successfully updated remote and last sync state.\n\t\t\t\t\t\tlastSyncUserData = await this.getLastSyncUserData();\n\n\t\t\t\t\t\treturn this.performSync(remoteUserData, lastSyncUserData, SyncStrategy.Merge, userDataSyncConfiguration);\n\t\t\t\t}\n\t\t\t}\n\t\t\tthrow e;\n\t\t}\n\t}\n\n\tprotected async doSync(remoteUserData: IRemoteUserData, lastSyncUserData: IRemoteUserData | null, strategy: SyncStrategy, userDataSyncConfiguration: IUserDataSyncConfiguration): Promise<SyncStatus> {\n\t\ttry {\n\n\t\t\tconst isRemoteDataFromCurrentMachine = await this.isRemoteDataFromCurrentMachine(remoteUserData);\n\t\t\tconst acceptRemote = !isRemoteDataFromCurrentMachine && lastSyncUserData === null && this.getStoredLastSyncUserDataStateContent() !== undefined;\n\t\t\tconst merge = strategy === SyncStrategy.Preview || (strategy === SyncStrategy.Merge && !acceptRemote);\n\t\t\tconst apply = strategy === SyncStrategy.Merge || strategy === SyncStrategy.PullOrPush;\n\n\t\t\t// generate or use existing preview\n\t\t\tif (!this.syncPreviewPromise) {\n\t\t\t\tthis.syncPreviewPromise = createCancelablePromise(token => this.doGenerateSyncResourcePreview(remoteUserData, lastSyncUserData, isRemoteDataFromCurrentMachine, merge, userDataSyncConfiguration, token));\n\t\t\t}\n\n\t\t\tlet preview = await this.syncPreviewPromise;\n\n\t\t\tif (strategy === SyncStrategy.Merge && acceptRemote) {\n\t\t\t\tthis.logService.info(`${this.syncResourceLogLabel}: Accepting remote because it was synced before and the last sync data is not available.`);\n\t\t\t\tfor (const resourcePreview of preview.resourcePreviews) {\n\t\t\t\t\tpreview = (await this.accept(resourcePreview.remoteResource)) || preview;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\telse if (strategy === SyncStrategy.PullOrPush) {\n\t\t\t\tfor (const resourcePreview of preview.resourcePreviews) {\n\t\t\t\t\tif (resourcePreview.mergeState === MergeState.Accepted) {\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\t\tif (remoteUserData.ref === lastSyncUserData?.ref || isRemoteDataFromCurrentMachine) {\n\t\t\t\t\t\tpreview = (await this.accept(resourcePreview.localResource)) ?? preview;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tpreview = (await this.accept(resourcePreview.remoteResource)) ?? preview;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis.updateConflicts(preview.resourcePreviews);\n\t\t\tif (preview.resourcePreviews.some(({ mergeState }) => mergeState === MergeState.Conflict)) {\n\t\t\t\treturn SyncStatus.HasConflicts;\n\t\t\t}\n\n\t\t\tif (apply) {\n\t\t\t\treturn await this.doApply(false);\n\t\t\t}\n\n\t\t\treturn SyncStatus.Syncing;\n\n\t\t} catch (error) {\n\n\t\t\t// reset preview on error\n\t\t\tthis.syncPreviewPromise = null;\n\n\t\t\tthrow error;\n\t\t}\n\t}\n\n\tasync accept(resource: URI, content?: string | null): Promise<ISyncResourcePreview | null> {\n\t\tawait this.updateSyncResourcePreview(resource, async (resourcePreview) => {\n\t\t\tconst acceptResult = await this.getAcceptResult(resourcePreview, resource, content, CancellationToken.None);\n\t\t\tresourcePreview.acceptResult = acceptResult;\n\t\t\tresourcePreview.mergeState = MergeState.Accepted;\n\t\t\tresourcePreview.localChange = acceptResult.localChange;\n\t\t\tresourcePreview.remoteChange = acceptResult.remoteChange;\n\t\t\treturn resourcePreview;\n\t\t});\n\t\treturn this.syncPreviewPromise;\n\t}\n\n\tasync discard(resource: URI): Promise<ISyncResourcePreview | null> {\n\t\tawait this.updateSyncResourcePreview(resource, async (resourcePreview) => {\n\t\t\tconst mergeResult = await this.getMergeResult(resourcePreview, CancellationToken.None);\n\t\t\tawait this.fileService.writeFile(resourcePreview.previewResource, VSBuffer.fromString(mergeResult.content || ''));\n\t\t\tresourcePreview.acceptResult = undefined;\n\t\t\tresourcePreview.mergeState = MergeState.Preview;\n\t\t\tresourcePreview.localChange = mergeResult.localChange;\n\t\t\tresourcePreview.remoteChange = mergeResult.remoteChange;\n\t\t\treturn resourcePreview;\n\t\t});\n\t\treturn this.syncPreviewPromise;\n\t}\n\n\tprivate async updateSyncResourcePreview(resource: URI, updateResourcePreview: (resourcePreview: IEditableResourcePreview) => Promise<IEditableResourcePreview>): Promise<void> {\n\t\tif (!this.syncPreviewPromise) {\n\t\t\treturn;\n\t\t}\n\n\t\tlet preview = await this.syncPreviewPromise;\n\t\tconst index = preview.resourcePreviews.findIndex(({ localResource, remoteResource, previewResource }) =>\n\t\t\tthis.extUri.isEqual(localResource, resource) || this.extUri.isEqual(remoteResource, resource) || this.extUri.isEqual(previewResource, resource));\n\t\tif (index === -1) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.syncPreviewPromise = createCancelablePromise(async token => {\n\t\t\tconst resourcePreviews = [...preview.resourcePreviews];\n\t\t\tresourcePreviews[index] = await updateResourcePreview(resourcePreviews[index]);\n\t\t\treturn {\n\t\t\t\t...preview,\n\t\t\t\tresourcePreviews\n\t\t\t};\n\t\t});\n\n\t\tpreview = await this.syncPreviewPromise;\n\t\tthis.updateConflicts(preview.resourcePreviews);\n\t\tif (preview.resourcePreviews.some(({ mergeState }) => mergeState === MergeState.Conflict)) {\n\t\t\tthis.setStatus(SyncStatus.HasConflicts);\n\t\t} else {\n\t\t\tthis.setStatus(SyncStatus.Syncing);\n\t\t}\n\t}\n\n\tprivate async doApply(force: boolean): Promise<SyncStatus> {\n\t\tif (!this.syncPreviewPromise) {\n\t\t\treturn SyncStatus.Idle;\n\t\t}\n\n\t\tconst preview = await this.syncPreviewPromise;\n\n\t\t// check for conflicts\n\t\tif (preview.resourcePreviews.some(({ mergeState }) => mergeState === MergeState.Conflict)) {\n\t\t\treturn SyncStatus.HasConflicts;\n\t\t}\n\n\t\t// check if all are accepted\n\t\tif (preview.resourcePreviews.some(({ mergeState }) => mergeState !== MergeState.Accepted)) {\n\t\t\treturn SyncStatus.Syncing;\n\t\t}\n\n\t\t// apply preview\n\t\tawait this.applyResult(preview.remoteUserData, preview.lastSyncUserData, preview.resourcePreviews.map(resourcePreview => ([resourcePreview, resourcePreview.acceptResult!])), force);\n\n\t\t// reset preview\n\t\tthis.syncPreviewPromise = null;\n\n\t\t// reset preview folder\n\t\tawait this.clearPreviewFolder();\n\n\t\treturn SyncStatus.Idle;\n\t}\n\n\tprivate async clearPreviewFolder(): Promise<void> {\n\t\ttry {\n\t\t\tawait this.fileService.del(this.syncPreviewFolder, { recursive: true });\n\t\t} catch (error) { /* Ignore */ }\n\t}\n\n\tprivate updateConflicts(resourcePreviews: IEditableResourcePreview[]): void {\n\t\tconst conflicts = resourcePreviews.filter(({ mergeState }) => mergeState === MergeState.Conflict);\n\t\tif (!equals(this._conflicts, conflicts, (a, b) => this.extUri.isEqual(a.previewResource, b.previewResource))) {\n\t\t\tthis._conflicts = conflicts;\n\t\t\tthis._onDidChangeConflicts.fire(this.conflicts);\n\t\t}\n\t}\n\n\tasync hasPreviouslySynced(): Promise<boolean> {\n\t\tconst lastSyncData = await this.getLastSyncUserData();\n\t\treturn !!lastSyncData && lastSyncData.syncData !== null /* `null` sync data implies resource is not synced */;\n\t}\n\n\tprotected async resolvePreviewContent(uri: URI): Promise<string | null> {\n\t\tconst syncPreview = this.syncPreviewPromise ? await this.syncPreviewPromise : null;\n\t\tif (syncPreview) {\n\t\t\tfor (const resourcePreview of syncPreview.resourcePreviews) {\n\t\t\t\tif (this.extUri.isEqual(resourcePreview.acceptedResource, uri)) {\n\t\t\t\t\treturn resourcePreview.acceptResult ? resourcePreview.acceptResult.content : null;\n\t\t\t\t}\n\t\t\t\tif (this.extUri.isEqual(resourcePreview.remoteResource, uri)) {\n\t\t\t\t\treturn resourcePreview.remoteContent;\n\t\t\t\t}\n\t\t\t\tif (this.extUri.isEqual(resourcePreview.localResource, uri)) {\n\t\t\t\t\treturn resourcePreview.localContent;\n\t\t\t\t}\n\t\t\t\tif (this.extUri.isEqual(resourcePreview.baseResource, uri)) {\n\t\t\t\t\treturn resourcePreview.baseContent;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn null;\n\t}\n\n\tasync resetLocal(): Promise<void> {\n\t\tthis.storageService.remove(this.lastSyncUserDataStateKey, StorageScope.APPLICATION);\n\t\ttry {\n\t\t\tawait this.fileService.del(this.lastSyncResource);\n\t\t} catch (error) {\n\t\t\tif (toFileOperationResult(error) !== FileOperationResult.FILE_NOT_FOUND) {\n\t\t\t\tthis.logService.error(error);\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate async doGenerateSyncResourcePreview(remoteUserData: IRemoteUserData, lastSyncUserData: IRemoteUserData | null, isRemoteDataFromCurrentMachine: boolean, merge: boolean, userDataSyncConfiguration: IUserDataSyncConfiguration, token: CancellationToken): Promise<ISyncResourcePreview> {\n\t\tconst resourcePreviewResults = await this.generateSyncPreview(remoteUserData, lastSyncUserData, isRemoteDataFromCurrentMachine, userDataSyncConfiguration, token);\n\n\t\tconst resourcePreviews: IEditableResourcePreview[] = [];\n\t\tfor (const resourcePreviewResult of resourcePreviewResults) {\n\t\t\tconst acceptedResource = resourcePreviewResult.previewResource.with({ scheme: USER_DATA_SYNC_SCHEME, authority: 'accepted' });\n\n\t\t\t/* No change -> Accept */\n\t\t\tif (resourcePreviewResult.localChange === Change.None && resourcePreviewResult.remoteChange === Change.None) {\n\t\t\t\tresourcePreviews.push({\n\t\t\t\t\t...resourcePreviewResult,\n\t\t\t\t\tacceptedResource,\n\t\t\t\t\tacceptResult: { content: null, localChange: Change.None, remoteChange: Change.None },\n\t\t\t\t\tmergeState: MergeState.Accepted\n\t\t\t\t});\n\t\t\t}\n\n\t\t\t/* Changed -> Apply ? (Merge ? Conflict | Accept) : Preview */\n\t\t\telse {\n\t\t\t\t/* Merge */\n\t\t\t\tconst mergeResult = merge ? await this.getMergeResult(resourcePreviewResult, token) : undefined;\n\t\t\t\tif (token.isCancellationRequested) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tawait this.fileService.writeFile(resourcePreviewResult.previewResource, VSBuffer.fromString(mergeResult?.content || ''));\n\n\t\t\t\t/* Conflict | Accept */\n\t\t\t\tconst acceptResult = mergeResult && !mergeResult.hasConflicts\n\t\t\t\t\t/* Accept if merged and there are no conflicts */\n\t\t\t\t\t? await this.getAcceptResult(resourcePreviewResult, resourcePreviewResult.previewResource, undefined, token)\n\t\t\t\t\t: undefined;\n\n\t\t\t\tresourcePreviews.push({\n\t\t\t\t\t...resourcePreviewResult,\n\t\t\t\t\tacceptResult,\n\t\t\t\t\tmergeState: mergeResult?.hasConflicts ? MergeState.Conflict : acceptResult ? MergeState.Accepted : MergeState.Preview,\n\t\t\t\t\tlocalChange: acceptResult ? acceptResult.localChange : mergeResult ? mergeResult.localChange : resourcePreviewResult.localChange,\n\t\t\t\t\tremoteChange: acceptResult ? acceptResult.remoteChange : mergeResult ? mergeResult.remoteChange : resourcePreviewResult.remoteChange\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\treturn { syncResource: this.resource, profile: this.syncResource.profile, remoteUserData, lastSyncUserData, resourcePreviews, isLastSyncFromCurrentMachine: isRemoteDataFromCurrentMachine };\n\t}\n\n\tasync getLastSyncUserData(): Promise<IRemoteUserData | null> {\n\t\tconst storedLastSyncUserDataStateContent = this.getStoredLastSyncUserDataStateContent();\n\n\t\t// Last Sync Data state does not exist\n\t\tif (!storedLastSyncUserDataStateContent) {\n\t\t\tthis.logService.info(`${this.syncResourceLogLabel}: Last sync data state does not exist.`);\n\t\t\treturn null;\n\t\t}\n\n\t\tconst lastSyncUserDataState: ILastSyncUserDataState = JSON.parse(storedLastSyncUserDataStateContent);\n\t\tconst resourceSyncStateVersion = this.userDataSyncEnablementService.getResourceSyncStateVersion(this.resource);\n\t\tthis.hasSyncResourceStateVersionChanged = !!lastSyncUserDataState.version && !!resourceSyncStateVersion && lastSyncUserDataState.version !== resourceSyncStateVersion;\n\t\tif (this.hasSyncResourceStateVersionChanged) {\n\t\t\tthis.logService.info(`${this.syncResourceLogLabel}: Reset last sync state because last sync state version ${lastSyncUserDataState.version} is not compatible with current sync state version ${resourceSyncStateVersion}.`);\n\t\t\tawait this.resetLocal();\n\t\t\treturn null;\n\t\t}\n\n\t\tlet syncData: ISyncData | null | undefined = undefined;\n\n\t\t// Get Last Sync Data from Local\n\t\tlet retrial = 1;\n\t\twhile (syncData === undefined && retrial++ < 6 /* Retry 5 times */) {\n\t\t\ttry {\n\t\t\t\tconst lastSyncStoredRemoteUserData = await this.readLastSyncStoredRemoteUserData();\n\t\t\t\tif (lastSyncStoredRemoteUserData) {\n\t\t\t\t\tif (lastSyncStoredRemoteUserData.ref === lastSyncUserDataState.ref) {\n\t\t\t\t\t\tsyncData = lastSyncStoredRemoteUserData.syncData;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.logService.info(`${this.syncResourceLogLabel}: Last sync data stored locally is not same as the last sync state.`);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\t} catch (error) {\n\t\t\t\tif (error instanceof FileOperationError && error.fileOperationResult === FileOperationResult.FILE_NOT_FOUND) {\n\t\t\t\t\tthis.logService.info(`${this.syncResourceLogLabel}: Last sync resource does not exist locally.`);\n\t\t\t\t\tbreak;\n\t\t\t\t} else if (error instanceof UserDataSyncError) {\n\t\t\t\t\tthrow error;\n\t\t\t\t} else {\n\t\t\t\t\t// log and retry\n\t\t\t\t\tthis.logService.error(error, retrial);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// Get Last Sync Data from Remote\n\t\tif (syncData === undefined) {\n\t\t\ttry {\n\t\t\t\tconst content = await this.userDataSyncStoreService.resolveResourceContent(this.resource, lastSyncUserDataState.ref, this.collection, this.syncHeaders);\n\t\t\t\tsyncData = content === null ? null : this.parseSyncData(content);\n\t\t\t\tawait this.writeLastSyncStoredRemoteUserData({ ref: lastSyncUserDataState.ref, syncData });\n\t\t\t} catch (error) {\n\t\t\t\tif (error instanceof UserDataSyncError && error.code === UserDataSyncErrorCode.NotFound) {\n\t\t\t\t\tthis.logService.info(`${this.syncResourceLogLabel}: Last sync resource does not exist remotely.`);\n\t\t\t\t} else {\n\t\t\t\t\tthrow error;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// Last Sync Data Not Found\n\t\tif (syncData === undefined) {\n\t\t\treturn null;\n\t\t}\n\n\t\treturn {\n\t\t\t...lastSyncUserDataState,\n\t\t\tsyncData,\n\t\t};\n\t}\n\n\tprotected async updateLastSyncUserData(lastSyncRemoteUserData: IRemoteUserData, additionalProps: IStringDictionary<any> = {}): Promise<void> {\n\t\tif (additionalProps['ref'] || additionalProps['version']) {\n\t\t\tthrow new Error('Cannot have core properties as additional');\n\t\t}\n\n\t\tconst version = this.userDataSyncEnablementService.getResourceSyncStateVersion(this.resource);\n\t\tconst lastSyncUserDataState: ILastSyncUserDataState = {\n\t\t\tref: lastSyncRemoteUserData.ref,\n\t\t\tversion,\n\t\t\t...additionalProps\n\t\t};\n\n\t\tthis.storageService.store(this.lastSyncUserDataStateKey, JSON.stringify(lastSyncUserDataState), StorageScope.APPLICATION, StorageTarget.MACHINE);\n\t\tawait this.writeLastSyncStoredRemoteUserData(lastSyncRemoteUserData);\n\t}\n\n\tprivate getStoredLastSyncUserDataStateContent(): string | undefined {\n\t\treturn this.storageService.get(this.lastSyncUserDataStateKey, StorageScope.APPLICATION);\n\t}\n\n\tprivate async readLastSyncStoredRemoteUserData(): Promise<IRemoteUserData | undefined> {\n\t\tconst content = (await this.fileService.readFile(this.lastSyncResource)).value.toString();\n\t\ttry {\n\t\t\tconst lastSyncStoredRemoteUserData = content ? JSON.parse(content) : undefined;\n\t\t\tif (isRemoteUserData(lastSyncStoredRemoteUserData)) {\n\t\t\t\treturn lastSyncStoredRemoteUserData;\n\t\t\t}\n\t\t} catch (e) {\n\t\t\tthis.logService.error(e);\n\t\t}\n\t\treturn undefined;\n\t}\n\n\tprivate async writeLastSyncStoredRemoteUserData(lastSyncRemoteUserData: IRemoteUserData): Promise<void> {\n\t\tawait this.fileService.writeFile(this.lastSyncResource, VSBuffer.fromString(JSON.stringify(lastSyncRemoteUserData)));\n\t}\n\n\tasync getRemoteUserData(lastSyncData: IRemoteUserData | null): Promise<IRemoteUserData> {\n\t\tconst userData = await this.getUserData(lastSyncData);\n\t\treturn this.toRemoteUserData(userData);\n\t}\n\n\tprivate toRemoteUserData({ ref, content }: IUserData): IRemoteUserData {\n\t\tlet syncData: ISyncData | null = null;\n\t\tif (content !== null) {\n\t\t\tsyncData = this.parseSyncData(content);\n\t\t}\n\t\treturn { ref, syncData };\n\t}\n\n\tprotected parseSyncData(content: string): ISyncData {\n\t\ttry {\n\t\t\tconst syncData: ISyncData = JSON.parse(content);\n\t\t\tif (isSyncData(syncData)) {\n\t\t\t\treturn syncData;\n\t\t\t}\n\t\t} catch (error) {\n\t\t\tthis.logService.error(error);\n\t\t}\n\t\tthrow new UserDataSyncError(localize('incompatible sync data', \"Cannot parse sync data as it is not compatible with the current version.\"), UserDataSyncErrorCode.IncompatibleRemoteContent, this.resource);\n\t}\n\n\tprivate async getUserData(lastSyncData: IRemoteUserData | null): Promise<IUserData> {\n\t\tconst lastSyncUserData: IUserData | null = lastSyncData ? { ref: lastSyncData.ref, content: lastSyncData.syncData ? JSON.stringify(lastSyncData.syncData) : null } : null;\n\t\treturn this.userDataSyncStoreService.readResource(this.resource, lastSyncUserData, this.collection, this.syncHeaders);\n\t}\n\n\tprotected async updateRemoteUserData(content: string, ref: string | null): Promise<IRemoteUserData> {\n\t\tconst machineId = await this.currentMachineIdPromise;\n\t\tconst syncData: ISyncData = { version: this.version, machineId, content };\n\t\ttry {\n\t\t\tref = await this.userDataSyncStoreService.writeResource(this.resource, JSON.stringify(syncData), ref, this.collection, this.syncHeaders);\n\t\t\treturn { ref, syncData };\n\t\t} catch (error) {\n\t\t\tif (error instanceof UserDataSyncError && error.code === UserDataSyncErrorCode.TooLarge) {\n\t\t\t\terror = new UserDataSyncError(error.message, error.code, this.resource);\n\t\t\t}\n\t\t\tthrow error;\n\t\t}\n\t}\n\n\tprotected async backupLocal(content: string): Promise<void> {\n\t\tconst syncData: ISyncData = { version: this.version, content };\n\t\treturn this.userDataSyncLocalStoreService.writeResource(this.resource, JSON.stringify(syncData), new Date(), this.syncResource.profile.isDefault ? undefined : this.syncResource.profile.id);\n\t}\n\n\tasync stop(): Promise<void> {\n\t\tif (this.status === SyncStatus.Idle) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.logService.trace(`${this.syncResourceLogLabel}: Stopping synchronizing ${this.resource.toLowerCase()}.`);\n\t\tif (this.syncPreviewPromise) {\n\t\t\tthis.syncPreviewPromise.cancel();\n\t\t\tthis.syncPreviewPromise = null;\n\t\t}\n\n\t\tthis.updateConflicts([]);\n\t\tawait this.clearPreviewFolder();\n\n\t\tthis.setStatus(SyncStatus.Idle);\n\t\tthis.logService.info(`${this.syncResourceLogLabel}: Stopped synchronizing ${this.resource.toLowerCase()}.`);\n\t}\n\n\tprivate getUserDataSyncConfiguration(): IUserDataSyncConfiguration {\n\t\treturn this.configurationService.getValue(USER_DATA_SYNC_CONFIGURATION_SCOPE);\n\t}\n\n\tprotected abstract readonly version: number;\n\tprotected abstract generateSyncPreview(remoteUserData: IRemoteUserData, lastSyncUserData: IRemoteUserData | null, isRemoteDataFromCurrentMachine: boolean, userDataSyncConfiguration: IUserDataSyncConfiguration, token: CancellationToken): Promise<IResourcePreview[]>;\n\tprotected abstract getMergeResult(resourcePreview: IResourcePreview, token: CancellationToken): Promise<IMergeResult>;\n\tprotected abstract getAcceptResult(resourcePreview: IResourcePreview, resource: URI, content: string | null | undefined, token: CancellationToken): Promise<IAcceptResult>;\n\tprotected abstract applyResult(remoteUserData: IRemoteUserData, lastSyncUserData: IRemoteUserData | null, result: [IResourcePreview, IAcceptResult][], force: boolean): Promise<void>;\n\tprotected abstract hasRemoteChanged(lastSyncUserData: IRemoteUserData): Promise<boolean>;\n\n\tabstract hasLocalData(): Promise<boolean>;\n\tabstract resolveContent(uri: URI): Promise<string | null>;\n}\n\nexport interface IFileResourcePreview extends IResourcePreview {\n\treadonly fileContent: IFileContent | null;\n}\n\nexport abstract class AbstractFileSynchroniser extends AbstractSynchroniser {\n\n\tconstructor(\n\t\tprotected readonly file: URI,\n\t\tsyncResource: IUserDataSyncResource,\n\t\tcollection: string | undefined,\n\t\t@IFileService fileService: IFileService,\n\t\t@IEnvironmentService environmentService: IEnvironmentService,\n\t\t@IStorageService storageService: IStorageService,\n\t\t@IUserDataSyncStoreService userDataSyncStoreService: IUserDataSyncStoreService,\n\t\t@IUserDataSyncLocalStoreService userDataSyncLocalStoreService: IUserDataSyncLocalStoreService,\n\t\t@IUserDataSyncEnablementService userDataSyncEnablementService: IUserDataSyncEnablementService,\n\t\t@ITelemetryService telemetryService: ITelemetryService,\n\t\t@IUserDataSyncLogService logService: IUserDataSyncLogService,\n\t\t@IConfigurationService configurationService: IConfigurationService,\n\t\t@IUriIdentityService uriIdentityService: IUriIdentityService,\n\t) {\n\t\tsuper(syncResource, collection, fileService, environmentService, storageService, userDataSyncStoreService, userDataSyncLocalStoreService, userDataSyncEnablementService, telemetryService, logService, configurationService, uriIdentityService);\n\t\tthis._register(this.fileService.watch(this.extUri.dirname(file)));\n\t\tthis._register(this.fileService.onDidFilesChange(e => this.onFileChanges(e)));\n\t}\n\n\tprotected async getLocalFileContent(): Promise<IFileContent | null> {\n\t\ttry {\n\t\t\treturn await this.fileService.readFile(this.file);\n\t\t} catch (error) {\n\t\t\treturn null;\n\t\t}\n\t}\n\n\tprotected async updateLocalFileContent(newContent: string, oldContent: IFileContent | null, force: boolean): Promise<void> {\n\t\ttry {\n\t\t\tif (oldContent) {\n\t\t\t\t// file exists already\n\t\t\t\tawait this.fileService.writeFile(this.file, VSBuffer.fromString(newContent), force ? undefined : oldContent);\n\t\t\t} else {\n\t\t\t\t// file does not exist\n\t\t\t\tawait this.fileService.createFile(this.file, VSBuffer.fromString(newContent), { overwrite: force });\n\t\t\t}\n\t\t} catch (e) {\n\t\t\tif ((e instanceof FileOperationError && e.fileOperationResult === FileOperationResult.FILE_NOT_FOUND) ||\n\t\t\t\t(e instanceof FileOperationError && e.fileOperationResult === FileOperationResult.FILE_MODIFIED_SINCE)) {\n\t\t\t\tthrow new UserDataSyncError(e.message, UserDataSyncErrorCode.LocalPreconditionFailed);\n\t\t\t} else {\n\t\t\t\tthrow e;\n\t\t\t}\n\t\t}\n\t}\n\n\tprotected async deleteLocalFile(): Promise<void> {\n\t\ttry {\n\t\t\tawait this.fileService.del(this.file);\n\t\t} catch (e) {\n\t\t\tif (!(e instanceof FileOperationError && e.fileOperationResult === FileOperationResult.FILE_NOT_FOUND)) {\n\t\t\t\tthrow e;\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate onFileChanges(e: FileChangesEvent): void {\n\t\tif (!e.contains(this.file)) {\n\t\t\treturn;\n\t\t}\n\t\tthis.triggerLocalChange();\n\t}\n\n}\n\nexport abstract class AbstractJsonFileSynchroniser extends AbstractFileSynchroniser {\n\n\tconstructor(\n\t\tfile: URI,\n\t\tsyncResource: IUserDataSyncResource,\n\t\tcollection: string | undefined,\n\t\t@IFileService fileService: IFileService,\n\t\t@IEnvironmentService environmentService: IEnvironmentService,\n\t\t@IStorageService storageService: IStorageService,\n\t\t@IUserDataSyncStoreService userDataSyncStoreService: IUserDataSyncStoreService,\n\t\t@IUserDataSyncLocalStoreService userDataSyncLocalStoreService: IUserDataSyncLocalStoreService,\n\t\t@IUserDataSyncEnablementService userDataSyncEnablementService: IUserDataSyncEnablementService,\n\t\t@ITelemetryService telemetryService: ITelemetryService,\n\t\t@IUserDataSyncLogService logService: IUserDataSyncLogService,\n\t\t@IUserDataSyncUtilService protected readonly userDataSyncUtilService: IUserDataSyncUtilService,\n\t\t@IConfigurationService configurationService: IConfigurationService,\n\t\t@IUriIdentityService uriIdentityService: IUriIdentityService,\n\t) {\n\t\tsuper(file, syncResource, collection, fileService, environmentService, storageService, userDataSyncStoreService, userDataSyncLocalStoreService, userDataSyncEnablementService, telemetryService, logService, configurationService, uriIdentityService);\n\t}\n\n\tprotected hasErrors(content: string, isArray: boolean): boolean {\n\t\tconst parseErrors: ParseError[] = [];\n\t\tconst result = parse(content, parseErrors, { allowEmptyContent: true, allowTrailingComma: true });\n\t\treturn parseErrors.length > 0 || (!isUndefined(result) && isArray !== Array.isArray(result));\n\t}\n\n\tprivate _formattingOptions: Promise<FormattingOptions> | undefined = undefined;\n\tprotected getFormattingOptions(): Promise<FormattingOptions> {\n\t\tif (!this._formattingOptions) {\n\t\t\tthis._formattingOptions = this.userDataSyncUtilService.resolveFormattingOptions(this.file);\n\t\t}\n\t\treturn this._formattingOptions;\n\t}\n\n}\n\nexport abstract class AbstractInitializer implements IUserDataSyncResourceInitializer {\n\n\tprotected readonly extUri: IExtUri;\n\tprivate readonly lastSyncResource: URI;\n\n\tconstructor(\n\t\treadonly resource: SyncResource,\n\t\t@IUserDataProfilesService protected readonly userDataProfilesService: IUserDataProfilesService,\n\t\t@IEnvironmentService protected readonly environmentService: IEnvironmentService,\n\t\t@ILogService protected readonly logService: ILogService,\n\t\t@IFileService protected readonly fileService: IFileService,\n\t\t@IStorageService protected readonly storageService: IStorageService,\n\t\t@IUriIdentityService uriIdentityService: IUriIdentityService,\n\t) {\n\t\tthis.extUri = uriIdentityService.extUri;\n\t\tthis.lastSyncResource = getLastSyncResourceUri(undefined, this.resource, environmentService, this.extUri);\n\t}\n\n\tasync initialize({ ref, content }: IUserData): Promise<void> {\n\t\tif (!content) {\n\t\t\tthis.logService.info('Remote content does not exist.', this.resource);\n\t\t\treturn;\n\t\t}\n\n\t\tconst syncData = this.parseSyncData(content);\n\t\tif (!syncData) {\n\t\t\treturn;\n\t\t}\n\n\t\ttry {\n\t\t\tawait this.doInitialize({ ref, syncData });\n\t\t} catch (error) {\n\t\t\tthis.logService.error(error);\n\t\t}\n\t}\n\n\tprivate parseSyncData(content: string): ISyncData | undefined {\n\t\ttry {\n\t\t\tconst syncData: ISyncData = JSON.parse(content);\n\t\t\tif (isSyncData(syncData)) {\n\t\t\t\treturn syncData;\n\t\t\t}\n\t\t} catch (error) {\n\t\t\tthis.logService.error(error);\n\t\t}\n\t\tthis.logService.info('Cannot parse sync data as it is not compatible with the current version.', this.resource);\n\t\treturn undefined;\n\t}\n\n\tprotected async updateLastSyncUserData(lastSyncRemoteUserData: IRemoteUserData, additionalProps: IStringDictionary<any> = {}): Promise<void> {\n\t\tif (additionalProps['ref'] || additionalProps['version']) {\n\t\t\tthrow new Error('Cannot have core properties as additional');\n\t\t}\n\n\t\tconst lastSyncUserDataState: ILastSyncUserDataState = {\n\t\t\tref: lastSyncRemoteUserData.ref,\n\t\t\tversion: undefined,\n\t\t\t...additionalProps\n\t\t};\n\n\t\tthis.storageService.store(`${this.resource}.lastSyncUserData`, JSON.stringify(lastSyncUserDataState), StorageScope.APPLICATION, StorageTarget.MACHINE);\n\t\tawait this.fileService.writeFile(this.lastSyncResource, VSBuffer.fromString(JSON.stringify(lastSyncRemoteUserData)));\n\t}\n\n\tprotected abstract doInitialize(remoteUserData: IRemoteUserData): Promise<void>;\n\n}\n"]}