{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/platform/userDataSync/common/userDataProfilesManifestMerge.ts","vs/platform/userDataSync/common/userDataProfilesManifestMerge.ts"],"names":[],"mappings":"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","file":"userDataProfilesManifestMerge.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { equals } from '../../../base/common/objects.js';\nimport { IUserDataProfile, UseDefaultProfileFlags } from '../../userDataProfile/common/userDataProfile.js';\nimport { ISyncUserDataProfile } from './userDataSync.js';\n\ninterface IRelaxedMergeResult {\n\tlocal: { added: ISyncUserDataProfile[]; removed: IUserDataProfile[]; updated: ISyncUserDataProfile[] };\n\tremote: { added: IUserDataProfile[]; removed: ISyncUserDataProfile[]; updated: IUserDataProfile[] } | null;\n}\n\nexport type IMergeResult = Required<IRelaxedMergeResult>;\n\ninterface IUserDataProfileInfo {\n\treadonly id: string;\n\treadonly name: string;\n\treadonly icon?: string;\n\treadonly useDefaultFlags?: UseDefaultProfileFlags;\n}\n\nexport function merge(local: IUserDataProfile[], remote: ISyncUserDataProfile[] | null, lastSync: ISyncUserDataProfile[] | null, ignored: string[]): IMergeResult {\n\tconst localResult: { added: ISyncUserDataProfile[]; removed: IUserDataProfile[]; updated: ISyncUserDataProfile[] } = { added: [], removed: [], updated: [] };\n\tlet remoteResult: { added: IUserDataProfile[]; removed: ISyncUserDataProfile[]; updated: IUserDataProfile[] } | null = { added: [], removed: [], updated: [] };\n\n\tif (!remote) {\n\t\tconst added = local.filter(({ id }) => !ignored.includes(id));\n\t\tif (added.length) {\n\t\t\tremoteResult.added = added;\n\t\t} else {\n\t\t\tremoteResult = null;\n\t\t}\n\t\treturn {\n\t\t\tlocal: localResult,\n\t\t\tremote: remoteResult\n\t\t};\n\t}\n\n\tconst localToRemote = compare(local, remote, ignored);\n\tif (localToRemote.added.length > 0 || localToRemote.removed.length > 0 || localToRemote.updated.length > 0) {\n\n\t\tconst baseToLocal = compare(lastSync, local, ignored);\n\t\tconst baseToRemote = compare(lastSync, remote, ignored);\n\n\t\t// Remotely removed profiles\n\t\tfor (const id of baseToRemote.removed) {\n\t\t\tconst e = local.find(profile => profile.id === id);\n\t\t\tif (e) {\n\t\t\t\tlocalResult.removed.push(e);\n\t\t\t}\n\t\t}\n\n\t\t// Remotely added profiles\n\t\tfor (const id of baseToRemote.added) {\n\t\t\tconst remoteProfile = remote.find(profile => profile.id === id)!;\n\t\t\t// Got added in local\n\t\t\tif (baseToLocal.added.includes(id)) {\n\t\t\t\t// Is different from local to remote\n\t\t\t\tif (localToRemote.updated.includes(id)) {\n\t\t\t\t\t// Remote wins always\n\t\t\t\t\tlocalResult.updated.push(remoteProfile);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tlocalResult.added.push(remoteProfile);\n\t\t\t}\n\t\t}\n\n\t\t// Remotely updated profiles\n\t\tfor (const id of baseToRemote.updated) {\n\t\t\t// Remote wins always\n\t\t\tlocalResult.updated.push(remote.find(profile => profile.id === id)!);\n\t\t}\n\n\t\t// Locally added profiles\n\t\tfor (const id of baseToLocal.added) {\n\t\t\t// Not there in remote\n\t\t\tif (!baseToRemote.added.includes(id)) {\n\t\t\t\tremoteResult.added.push(local.find(profile => profile.id === id)!);\n\t\t\t}\n\t\t}\n\n\t\t// Locally updated profiles\n\t\tfor (const id of baseToLocal.updated) {\n\t\t\t// If removed in remote\n\t\t\tif (baseToRemote.removed.includes(id)) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t// If not updated in remote\n\t\t\tif (!baseToRemote.updated.includes(id)) {\n\t\t\t\tremoteResult.updated.push(local.find(profile => profile.id === id)!);\n\t\t\t}\n\t\t}\n\n\t\t// Locally removed profiles\n\t\tfor (const id of baseToLocal.removed) {\n\t\t\tconst removedProfile = remote.find(profile => profile.id === id);\n\t\t\tif (removedProfile) {\n\t\t\t\tremoteResult.removed.push(removedProfile);\n\t\t\t}\n\t\t}\n\t}\n\n\tif (remoteResult.added.length === 0 && remoteResult.removed.length === 0 && remoteResult.updated.length === 0) {\n\t\tremoteResult = null;\n\t}\n\n\treturn { local: localResult, remote: remoteResult };\n}\n\nfunction compare(from: IUserDataProfileInfo[] | null, to: IUserDataProfileInfo[], ignoredProfiles: string[]): { added: string[]; removed: string[]; updated: string[] } {\n\tfrom = from ? from.filter(({ id }) => !ignoredProfiles.includes(id)) : [];\n\tto = to.filter(({ id }) => !ignoredProfiles.includes(id));\n\tconst fromKeys = from.map(({ id }) => id);\n\tconst toKeys = to.map(({ id }) => id);\n\tconst added = toKeys.filter(key => !fromKeys.includes(key));\n\tconst removed = fromKeys.filter(key => !toKeys.includes(key));\n\tconst updated: string[] = [];\n\n\tfor (const { id, name, icon, useDefaultFlags } of from) {\n\t\tif (removed.includes(id)) {\n\t\t\tcontinue;\n\t\t}\n\t\tconst toProfile = to.find(p => p.id === id);\n\t\tif (!toProfile\n\t\t\t|| toProfile.name !== name\n\t\t\t|| toProfile.icon !== icon\n\t\t\t|| !equals(toProfile.useDefaultFlags, useDefaultFlags)\n\t\t) {\n\t\t\tupdated.push(id);\n\t\t}\n\t}\n\n\treturn { added, removed, updated };\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { equals } from '../../../base/common/objects.js';\nimport { IUserDataProfile, UseDefaultProfileFlags } from '../../userDataProfile/common/userDataProfile.js';\nimport { ISyncUserDataProfile } from './userDataSync.js';\n\ninterface IRelaxedMergeResult {\n\tlocal: { added: ISyncUserDataProfile[]; removed: IUserDataProfile[]; updated: ISyncUserDataProfile[] };\n\tremote: { added: IUserDataProfile[]; removed: ISyncUserDataProfile[]; updated: IUserDataProfile[] } | null;\n}\n\nexport type IMergeResult = Required<IRelaxedMergeResult>;\n\ninterface IUserDataProfileInfo {\n\treadonly id: string;\n\treadonly name: string;\n\treadonly icon?: string;\n\treadonly useDefaultFlags?: UseDefaultProfileFlags;\n}\n\nexport function merge(local: IUserDataProfile[], remote: ISyncUserDataProfile[] | null, lastSync: ISyncUserDataProfile[] | null, ignored: string[]): IMergeResult {\n\tconst localResult: { added: ISyncUserDataProfile[]; removed: IUserDataProfile[]; updated: ISyncUserDataProfile[] } = { added: [], removed: [], updated: [] };\n\tlet remoteResult: { added: IUserDataProfile[]; removed: ISyncUserDataProfile[]; updated: IUserDataProfile[] } | null = { added: [], removed: [], updated: [] };\n\n\tif (!remote) {\n\t\tconst added = local.filter(({ id }) => !ignored.includes(id));\n\t\tif (added.length) {\n\t\t\tremoteResult.added = added;\n\t\t} else {\n\t\t\tremoteResult = null;\n\t\t}\n\t\treturn {\n\t\t\tlocal: localResult,\n\t\t\tremote: remoteResult\n\t\t};\n\t}\n\n\tconst localToRemote = compare(local, remote, ignored);\n\tif (localToRemote.added.length > 0 || localToRemote.removed.length > 0 || localToRemote.updated.length > 0) {\n\n\t\tconst baseToLocal = compare(lastSync, local, ignored);\n\t\tconst baseToRemote = compare(lastSync, remote, ignored);\n\n\t\t// Remotely removed profiles\n\t\tfor (const id of baseToRemote.removed) {\n\t\t\tconst e = local.find(profile => profile.id === id);\n\t\t\tif (e) {\n\t\t\t\tlocalResult.removed.push(e);\n\t\t\t}\n\t\t}\n\n\t\t// Remotely added profiles\n\t\tfor (const id of baseToRemote.added) {\n\t\t\tconst remoteProfile = remote.find(profile => profile.id === id)!;\n\t\t\t// Got added in local\n\t\t\tif (baseToLocal.added.includes(id)) {\n\t\t\t\t// Is different from local to remote\n\t\t\t\tif (localToRemote.updated.includes(id)) {\n\t\t\t\t\t// Remote wins always\n\t\t\t\t\tlocalResult.updated.push(remoteProfile);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tlocalResult.added.push(remoteProfile);\n\t\t\t}\n\t\t}\n\n\t\t// Remotely updated profiles\n\t\tfor (const id of baseToRemote.updated) {\n\t\t\t// Remote wins always\n\t\t\tlocalResult.updated.push(remote.find(profile => profile.id === id)!);\n\t\t}\n\n\t\t// Locally added profiles\n\t\tfor (const id of baseToLocal.added) {\n\t\t\t// Not there in remote\n\t\t\tif (!baseToRemote.added.includes(id)) {\n\t\t\t\tremoteResult.added.push(local.find(profile => profile.id === id)!);\n\t\t\t}\n\t\t}\n\n\t\t// Locally updated profiles\n\t\tfor (const id of baseToLocal.updated) {\n\t\t\t// If removed in remote\n\t\t\tif (baseToRemote.removed.includes(id)) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t// If not updated in remote\n\t\t\tif (!baseToRemote.updated.includes(id)) {\n\t\t\t\tremoteResult.updated.push(local.find(profile => profile.id === id)!);\n\t\t\t}\n\t\t}\n\n\t\t// Locally removed profiles\n\t\tfor (const id of baseToLocal.removed) {\n\t\t\tconst removedProfile = remote.find(profile => profile.id === id);\n\t\t\tif (removedProfile) {\n\t\t\t\tremoteResult.removed.push(removedProfile);\n\t\t\t}\n\t\t}\n\t}\n\n\tif (remoteResult.added.length === 0 && remoteResult.removed.length === 0 && remoteResult.updated.length === 0) {\n\t\tremoteResult = null;\n\t}\n\n\treturn { local: localResult, remote: remoteResult };\n}\n\nfunction compare(from: IUserDataProfileInfo[] | null, to: IUserDataProfileInfo[], ignoredProfiles: string[]): { added: string[]; removed: string[]; updated: string[] } {\n\tfrom = from ? from.filter(({ id }) => !ignoredProfiles.includes(id)) : [];\n\tto = to.filter(({ id }) => !ignoredProfiles.includes(id));\n\tconst fromKeys = from.map(({ id }) => id);\n\tconst toKeys = to.map(({ id }) => id);\n\tconst added = toKeys.filter(key => !fromKeys.includes(key));\n\tconst removed = fromKeys.filter(key => !toKeys.includes(key));\n\tconst updated: string[] = [];\n\n\tfor (const { id, name, icon, useDefaultFlags } of from) {\n\t\tif (removed.includes(id)) {\n\t\t\tcontinue;\n\t\t}\n\t\tconst toProfile = to.find(p => p.id === id);\n\t\tif (!toProfile\n\t\t\t|| toProfile.name !== name\n\t\t\t|| toProfile.icon !== icon\n\t\t\t|| !equals(toProfile.useDefaultFlags, useDefaultFlags)\n\t\t) {\n\t\t\tupdated.push(id);\n\t\t}\n\t}\n\n\treturn { added, removed, updated };\n}\n"]}