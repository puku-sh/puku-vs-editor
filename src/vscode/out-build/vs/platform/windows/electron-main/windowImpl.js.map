{"version":3,"sources":["vs/platform/windows/electron-main/windowImpl.ts"],"names":[],"mappings":"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","file":"windowImpl.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport electron, { BrowserWindowConstructorOptions, Display, screen } from 'electron';\nimport { DeferredPromise, RunOnceScheduler, timeout, Delayer } from '../../../base/common/async.js';\nimport { CancellationToken } from '../../../base/common/cancellation.js';\nimport { toErrorMessage } from '../../../base/common/errorMessage.js';\nimport { Emitter, Event } from '../../../base/common/event.js';\nimport { Disposable, DisposableStore, IDisposable, MutableDisposable, toDisposable } from '../../../base/common/lifecycle.js';\nimport { FileAccess, Schemas } from '../../../base/common/network.js';\nimport { getMarks, mark } from '../../../base/common/performance.js';\nimport { isBigSurOrNewer, isLinux, isMacintosh, isWindows } from '../../../base/common/platform.js';\nimport { URI } from '../../../base/common/uri.js';\nimport { localize } from '../../../nls.js';\nimport { release } from 'os';\nimport { ISerializableCommandAction } from '../../action/common/action.js';\nimport { IBackupMainService } from '../../backup/electron-main/backup.js';\nimport { IConfigurationChangeEvent, IConfigurationService } from '../../configuration/common/configuration.js';\nimport { IDialogMainService } from '../../dialogs/electron-main/dialogMainService.js';\nimport { NativeParsedArgs } from '../../environment/common/argv.js';\nimport { IEnvironmentMainService } from '../../environment/electron-main/environmentMainService.js';\nimport { isLaunchedFromCli } from '../../environment/node/argvHelper.js';\nimport { IFileService } from '../../files/common/files.js';\nimport { ILifecycleMainService } from '../../lifecycle/electron-main/lifecycleMainService.js';\nimport { ILogService } from '../../log/common/log.js';\nimport { IProductService } from '../../product/common/productService.js';\nimport { IIPCObjectUrl, IProtocolMainService } from '../../protocol/electron-main/protocol.js';\nimport { resolveMarketplaceHeaders } from '../../externalServices/common/marketplace.js';\nimport { IApplicationStorageMainService, IStorageMainService } from '../../storage/electron-main/storageMainService.js';\nimport { ITelemetryService } from '../../telemetry/common/telemetry.js';\nimport { ThemeIcon } from '../../../base/common/themables.js';\nimport { IThemeMainService } from '../../theme/electron-main/themeMainService.js';\nimport { getMenuBarVisibility, IFolderToOpen, INativeWindowConfiguration, IWindowSettings, IWorkspaceToOpen, MenuBarVisibility, hasNativeTitlebar, useNativeFullScreen, useWindowControlsOverlay, DEFAULT_CUSTOM_TITLEBAR_HEIGHT, TitlebarStyle, MenuSettings } from '../../window/common/window.js';\nimport { defaultBrowserWindowOptions, getAllWindowsExcludingOffscreen, IWindowsMainService, OpenContext, WindowStateValidator } from './windows.js';\nimport { ISingleFolderWorkspaceIdentifier, IWorkspaceIdentifier, isSingleFolderWorkspaceIdentifier, isWorkspaceIdentifier, toWorkspaceIdentifier } from '../../workspace/common/workspace.js';\nimport { IWorkspacesManagementMainService } from '../../workspaces/electron-main/workspacesManagementMainService.js';\nimport { IWindowState, ICodeWindow, ILoadEvent, WindowMode, WindowError, LoadReason, defaultWindowState, IBaseWindow } from '../../window/electron-main/window.js';\nimport { IPolicyService } from '../../policy/common/policy.js';\nimport { IUserDataProfile } from '../../userDataProfile/common/userDataProfile.js';\nimport { IStateService } from '../../state/node/state.js';\nimport { IUserDataProfilesMainService } from '../../userDataProfile/electron-main/userDataProfile.js';\nimport { ILoggerMainService } from '../../log/electron-main/loggerService.js';\nimport { IInstantiationService } from '../../instantiation/common/instantiation.js';\nimport { VSBuffer } from '../../../base/common/buffer.js';\nimport { errorHandler } from '../../../base/common/errors.js';\nimport { FocusMode } from '../../native/common/native.js';\n\nexport interface IWindowCreationOptions {\n\treadonly state: IWindowState;\n\treadonly extensionDevelopmentPath?: string[];\n\treadonly isExtensionTestHost?: boolean;\n}\n\ninterface ITouchBarSegment extends electron.SegmentedControlSegment {\n\treadonly id: string;\n}\n\ninterface ILoadOptions {\n\treadonly isReload?: boolean;\n\treadonly disableExtensions?: boolean;\n}\n\nconst enum ReadyState {\n\n\t/**\n\t * This window has not loaded anything yet\n\t * and this is the initial state of every\n\t * window.\n\t */\n\tNONE,\n\n\t/**\n\t * This window is navigating, either for the\n\t * first time or subsequent times.\n\t */\n\tNAVIGATING,\n\n\t/**\n\t * This window has finished loading and is ready\n\t * to forward IPC requests to the web contents.\n\t */\n\tREADY\n}\n\nclass DockBadgeManager {\n\n\tstatic readonly INSTANCE = new DockBadgeManager();\n\n\tprivate readonly windows = new Set<number>();\n\n\tacquireBadge(window: IBaseWindow): IDisposable {\n\t\tthis.windows.add(window.id);\n\n\t\telectron.app.setBadgeCount(isLinux ? 1 /* only numbers supported */ : undefined /* generic dot */);\n\n\t\treturn {\n\t\t\tdispose: () => {\n\t\t\t\tthis.windows.delete(window.id);\n\n\t\t\t\tif (this.windows.size === 0) {\n\t\t\t\t\telectron.app.setBadgeCount(0);\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t}\n}\n\nexport abstract class BaseWindow extends Disposable implements IBaseWindow {\n\n\t//#region Events\n\n\tprivate readonly _onDidClose = this._register(new Emitter<void>());\n\treadonly onDidClose = this._onDidClose.event;\n\n\tprivate readonly _onDidMaximize = this._register(new Emitter<void>());\n\treadonly onDidMaximize = this._onDidMaximize.event;\n\n\tprivate readonly _onDidUnmaximize = this._register(new Emitter<void>());\n\treadonly onDidUnmaximize = this._onDidUnmaximize.event;\n\n\tprivate readonly _onDidTriggerSystemContextMenu = this._register(new Emitter<{ x: number; y: number }>());\n\treadonly onDidTriggerSystemContextMenu = this._onDidTriggerSystemContextMenu.event;\n\n\tprivate readonly _onDidEnterFullScreen = this._register(new Emitter<void>());\n\treadonly onDidEnterFullScreen = this._onDidEnterFullScreen.event;\n\n\tprivate readonly _onDidLeaveFullScreen = this._register(new Emitter<void>());\n\treadonly onDidLeaveFullScreen = this._onDidLeaveFullScreen.event;\n\n\tprivate readonly _onDidChangeAlwaysOnTop = this._register(new Emitter<boolean>());\n\treadonly onDidChangeAlwaysOnTop = this._onDidChangeAlwaysOnTop.event;\n\n\t//#endregion\n\n\tabstract readonly id: number;\n\n\tprotected _lastFocusTime = Date.now(); // window is shown on creation so take current time\n\tget lastFocusTime(): number { return this._lastFocusTime; }\n\n\tprivate maximizedWindowState: IWindowState | undefined;\n\n\tprotected _win: electron.BrowserWindow | null = null;\n\tget win() { return this._win; }\n\tprotected setWin(win: electron.BrowserWindow, options?: BrowserWindowConstructorOptions): void {\n\t\tthis._win = win;\n\n\t\t// Window Events\n\t\tthis._register(Event.fromNodeEventEmitter(win, 'maximize')(() => {\n\t\t\tif (isWindows && this.environmentMainService.enableRDPDisplayTracking && this._win) {\n\t\t\t\tconst [x, y] = this._win.getPosition();\n\t\t\t\tconst [width, height] = this._win.getSize();\n\n\t\t\t\tthis.maximizedWindowState = { mode: WindowMode.Maximized, width, height, x, y };\n\t\t\t\tthis.logService.debug(`Saved maximized window ${this.id} display state:`, this.maximizedWindowState);\n\t\t\t}\n\n\t\t\tthis._onDidMaximize.fire();\n\t\t}));\n\t\tthis._register(Event.fromNodeEventEmitter(win, 'unmaximize')(() => {\n\t\t\tif (isWindows && this.environmentMainService.enableRDPDisplayTracking && this.maximizedWindowState) {\n\t\t\t\tthis.maximizedWindowState = undefined;\n\n\t\t\t\tthis.logService.debug(`Cleared maximized window ${this.id} state`);\n\t\t\t}\n\n\t\t\tthis._onDidUnmaximize.fire();\n\t\t}));\n\t\tthis._register(Event.fromNodeEventEmitter(win, 'closed')(() => {\n\t\t\tthis._onDidClose.fire();\n\n\t\t\tthis.dispose();\n\t\t}));\n\t\tthis._register(Event.fromNodeEventEmitter(win, 'focus')(() => {\n\t\t\tthis.clearNotifyFocus();\n\n\t\t\tthis._lastFocusTime = Date.now();\n\t\t}));\n\t\tthis._register(Event.fromNodeEventEmitter(this._win, 'enter-full-screen')(() => this._onDidEnterFullScreen.fire()));\n\t\tthis._register(Event.fromNodeEventEmitter(this._win, 'leave-full-screen')(() => this._onDidLeaveFullScreen.fire()));\n\t\tthis._register(Event.fromNodeEventEmitter(this._win, 'always-on-top-changed', (_, alwaysOnTop) => alwaysOnTop)(alwaysOnTop => this._onDidChangeAlwaysOnTop.fire(alwaysOnTop)));\n\n\t\t// Sheet Offsets\n\t\tconst useCustomTitleStyle = !hasNativeTitlebar(this.configurationService, options?.titleBarStyle === 'hidden' ? TitlebarStyle.CUSTOM : undefined /* unknown */);\n\t\tif (isMacintosh && useCustomTitleStyle) {\n\t\t\twin.setSheetOffset(isBigSurOrNewer(release()) ? 28 : 22); // offset dialogs by the height of the custom title bar if we have any\n\t\t}\n\n\t\t// Update the window controls immediately based on cached or default values\n\t\tif (useCustomTitleStyle && useWindowControlsOverlay(this.configurationService)) {\n\t\t\tconst cachedWindowControlHeight = this.stateService.getItem<number>((BaseWindow.windowControlHeightStateStorageKey));\n\t\t\tif (cachedWindowControlHeight) {\n\t\t\t\tthis.updateWindowControls({ height: cachedWindowControlHeight });\n\t\t\t} else {\n\t\t\t\tthis.updateWindowControls({ height: DEFAULT_CUSTOM_TITLEBAR_HEIGHT });\n\t\t\t}\n\t\t}\n\n\t\t// Setup windows/linux system context menu so it only is allowed over the app icon\n\t\tif ((isWindows || isLinux) && useCustomTitleStyle) {\n\t\t\tthis._register(Event.fromNodeEventEmitter(win, 'system-context-menu', (event: Electron.Event, point: Electron.Point) => ({ event, point }))(e => {\n\t\t\t\tconst [x, y] = win.getPosition();\n\t\t\t\tconst cursorPos = electron.screen.screenToDipPoint(e.point);\n\t\t\t\tconst cx = Math.floor(cursorPos.x) - x;\n\t\t\t\tconst cy = Math.floor(cursorPos.y) - y;\n\n\t\t\t\t// TODO@deepak1556 workaround for https://github.com/microsoft/vscode/issues/250626\n\t\t\t\t// where showing the custom menu seems broken on Windows\n\t\t\t\tif (isLinux) {\n\t\t\t\t\tif (cx > 35 /* Cursor is beyond app icon in title bar */) {\n\t\t\t\t\t\te.event.preventDefault();\n\n\t\t\t\t\t\tthis._onDidTriggerSystemContextMenu.fire({ x: cx, y: cy });\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}));\n\t\t}\n\n\t\t// Open devtools if instructed from command line args\n\t\tif (this.environmentMainService.args['open-devtools'] === true) {\n\t\t\twin.webContents.openDevTools();\n\t\t}\n\n\t\t// macOS: Window Fullscreen Transitions\n\t\tif (isMacintosh) {\n\t\t\tthis._register(this.onDidEnterFullScreen(() => {\n\t\t\t\tthis.joinNativeFullScreenTransition?.complete(true);\n\t\t\t}));\n\n\t\t\tthis._register(this.onDidLeaveFullScreen(() => {\n\t\t\t\tthis.joinNativeFullScreenTransition?.complete(true);\n\t\t\t}));\n\t\t}\n\n\t\tif (isWindows && this.environmentMainService.enableRDPDisplayTracking) {\n\t\t\t// Handles the display-added event on Windows RDP multi-monitor scenarios.\n\t\t\t// This helps restore maximized windows to their correct monitor after RDP reconnection.\n\t\t\t// Refs https://github.com/electron/electron/issues/47016\n\t\t\tthis._register(Event.fromNodeEventEmitter(screen, 'display-added', (event: Electron.Event, display: Display) => ({ event, display }))((e) => {\n\t\t\t\tthis.onDisplayAdded(e.display);\n\t\t\t}));\n\t\t}\n\t}\n\n\tprivate onDisplayAdded(display: Display): void {\n\t\tconst state = this.maximizedWindowState;\n\t\tif (state && this._win && WindowStateValidator.validateWindowStateOnDisplay(state, display)) {\n\t\t\tthis.logService.debug(`Setting maximized window ${this.id} bounds to match newly added display`, state);\n\n\t\t\tthis._win.setBounds(state);\n\t\t}\n\t}\n\n\tconstructor(\n\t\tprotected readonly configurationService: IConfigurationService,\n\t\tprotected readonly stateService: IStateService,\n\t\tprotected readonly environmentMainService: IEnvironmentMainService,\n\t\tprotected readonly logService: ILogService\n\t) {\n\t\tsuper();\n\t}\n\n\tprotected applyState(state: IWindowState, hasMultipleDisplays = electron.screen.getAllDisplays().length > 0): void {\n\n\t\t// TODO@electron (Electron 4 regression): when running on multiple displays where the target display\n\t\t// to open the window has a larger resolution than the primary display, the window will not size\n\t\t// correctly unless we set the bounds again (https://github.com/microsoft/vscode/issues/74872)\n\t\t//\n\t\t// Extended to cover Windows as well as Mac (https://github.com/microsoft/vscode/issues/146499)\n\t\t//\n\t\t// However, when running with native tabs with multiple windows we cannot use this workaround\n\t\t// because there is a potential that the new window will be added as native tab instead of being\n\t\t// a window on its own. In that case calling setBounds() would cause https://github.com/microsoft/vscode/issues/75830\n\n\t\tconst windowSettings = this.configurationService.getValue<IWindowSettings | undefined>('window');\n\t\tconst useNativeTabs = isMacintosh && windowSettings?.nativeTabs === true;\n\t\tif ((isMacintosh || isWindows) && hasMultipleDisplays && (!useNativeTabs || getAllWindowsExcludingOffscreen().length === 1)) {\n\t\t\tif ([state.width, state.height, state.x, state.y].every(value => typeof value === 'number')) {\n\t\t\t\tthis._win?.setBounds({\n\t\t\t\t\twidth: state.width,\n\t\t\t\t\theight: state.height,\n\t\t\t\t\tx: state.x,\n\t\t\t\t\ty: state.y\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tif (state.mode === WindowMode.Maximized || state.mode === WindowMode.Fullscreen) {\n\n\t\t\t// this call may or may not show the window, depends\n\t\t\t// on the platform: currently on Windows and Linux will\n\t\t\t// show the window as active. To be on the safe side,\n\t\t\t// we show the window at the end of this block.\n\t\t\tthis._win?.maximize();\n\n\t\t\tif (state.mode === WindowMode.Fullscreen) {\n\t\t\t\tthis.setFullScreen(true, true);\n\t\t\t}\n\n\t\t\t// to reduce flicker from the default window size\n\t\t\t// to maximize or fullscreen, we only show after\n\t\t\tthis._win?.show();\n\t\t}\n\t}\n\n\tprivate representedFilename: string | undefined;\n\n\tsetRepresentedFilename(filename: string): void {\n\t\tif (isMacintosh) {\n\t\t\tthis.win?.setRepresentedFilename(filename);\n\t\t} else {\n\t\t\tthis.representedFilename = filename;\n\t\t}\n\t}\n\n\tgetRepresentedFilename(): string | undefined {\n\t\tif (isMacintosh) {\n\t\t\treturn this.win?.getRepresentedFilename();\n\t\t}\n\n\t\treturn this.representedFilename;\n\t}\n\n\tprivate documentEdited: boolean | undefined;\n\n\tsetDocumentEdited(edited: boolean): void {\n\t\tif (isMacintosh) {\n\t\t\tthis.win?.setDocumentEdited(edited);\n\t\t}\n\n\t\tthis.documentEdited = edited;\n\t}\n\n\tisDocumentEdited(): boolean {\n\t\tif (isMacintosh) {\n\t\t\treturn Boolean(this.win?.isDocumentEdited());\n\t\t}\n\n\t\treturn !!this.documentEdited;\n\t}\n\n\tfocus(options?: { mode: FocusMode }): void {\n\t\tswitch (options?.mode ?? FocusMode.Transfer) {\n\t\t\tcase FocusMode.Transfer:\n\t\t\t\tthis.doFocusWindow();\n\t\t\t\tbreak;\n\n\t\t\tcase FocusMode.Notify:\n\t\t\t\tthis.showNotifyFocus();\n\t\t\t\tbreak;\n\n\t\t\tcase FocusMode.Force:\n\t\t\t\tif (isMacintosh) {\n\t\t\t\t\telectron.app.focus({ steal: true });\n\t\t\t\t}\n\t\t\t\tthis.doFocusWindow();\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tprivate readonly notifyFocusDisposable = this._register(new MutableDisposable());\n\n\tprivate showNotifyFocus(): void {\n\t\tconst disposables = new DisposableStore();\n\t\tthis.notifyFocusDisposable.value = disposables;\n\n\t\t// Badge\n\t\tdisposables.add(DockBadgeManager.INSTANCE.acquireBadge(this));\n\n\t\t// Flash/Bounce\n\t\tif (isWindows || isLinux) {\n\t\t\tthis.win?.flashFrame(true);\n\t\t\tdisposables.add(toDisposable(() => this.win?.flashFrame(false)));\n\t\t} else if (isMacintosh) {\n\t\t\telectron.app.dock?.bounce('informational');\n\t\t}\n\t}\n\n\tprivate clearNotifyFocus(): void {\n\t\tthis.notifyFocusDisposable.clear();\n\t}\n\n\tprivate doFocusWindow() {\n\t\tconst win = this.win;\n\t\tif (!win) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (win.isMinimized()) {\n\t\t\twin.restore();\n\t\t}\n\n\t\twin.focus();\n\t}\n\n\t//#region Window Control Overlays\n\n\tprivate static readonly windowControlHeightStateStorageKey = 'windowControlHeight';\n\n\tupdateWindowControls(options: { height?: number; backgroundColor?: string; foregroundColor?: string }): void {\n\t\tconst win = this.win;\n\t\tif (!win) {\n\t\t\treturn;\n\t\t}\n\n\t\t// Cache the height for speeds lookups on startup\n\t\tif (options.height) {\n\t\t\tthis.stateService.setItem((CodeWindow.windowControlHeightStateStorageKey), options.height);\n\t\t}\n\n\t\t// Windows/Linux: update window controls via setTitleBarOverlay()\n\t\tif (!isMacintosh && useWindowControlsOverlay(this.configurationService)) {\n\t\t\twin.setTitleBarOverlay({\n\t\t\t\tcolor: options.backgroundColor?.trim() === '' ? undefined : options.backgroundColor,\n\t\t\t\tsymbolColor: options.foregroundColor?.trim() === '' ? undefined : options.foregroundColor,\n\t\t\t\theight: options.height ? options.height - 1 : undefined // account for window border\n\t\t\t});\n\t\t}\n\n\t\t// macOS: update window controls via setWindowButtonPosition()\n\t\telse if (isMacintosh && options.height !== undefined) {\n\t\t\t// The traffic lights have a height of 12px. There's an invisible margin\n\t\t\t// of 2px at the top and bottom, and 1px on the left and right. Therefore,\n\t\t\t// the height for centering is 12px + 2 * 2px = 16px. When the position\n\t\t\t// is set, the horizontal margin is offset to ensure the distance between\n\t\t\t// the traffic lights and the window frame is equal in both directions.\n\t\t\tconst offset = Math.floor((options.height - 16) / 2);\n\t\t\tif (!offset) {\n\t\t\t\twin.setWindowButtonPosition(null);\n\t\t\t} else {\n\t\t\t\twin.setWindowButtonPosition({ x: offset + 1, y: offset });\n\t\t\t}\n\t\t}\n\t}\n\n\t//#endregion\n\n\t//#region Fullscreen\n\n\tprivate transientIsNativeFullScreen: boolean | undefined = undefined;\n\tprivate joinNativeFullScreenTransition: DeferredPromise<boolean> | undefined = undefined;\n\n\ttoggleFullScreen(): void {\n\t\tthis.setFullScreen(!this.isFullScreen, false);\n\t}\n\n\tprotected setFullScreen(fullscreen: boolean, fromRestore: boolean): void {\n\n\t\t// Set fullscreen state\n\t\tif (useNativeFullScreen(this.configurationService)) {\n\t\t\tthis.setNativeFullScreen(fullscreen, fromRestore);\n\t\t} else {\n\t\t\tthis.setSimpleFullScreen(fullscreen);\n\t\t}\n\t}\n\n\tget isFullScreen(): boolean {\n\t\tif (isMacintosh && typeof this.transientIsNativeFullScreen === 'boolean') {\n\t\t\treturn this.transientIsNativeFullScreen;\n\t\t}\n\n\t\tconst win = this.win;\n\t\tconst isFullScreen = win?.isFullScreen();\n\t\tconst isSimpleFullScreen = win?.isSimpleFullScreen();\n\n\t\treturn Boolean(isFullScreen || isSimpleFullScreen);\n\t}\n\n\tprivate setNativeFullScreen(fullscreen: boolean, fromRestore: boolean): void {\n\t\tconst win = this.win;\n\t\tif (win?.isSimpleFullScreen()) {\n\t\t\twin?.setSimpleFullScreen(false);\n\t\t}\n\n\t\tthis.doSetNativeFullScreen(fullscreen, fromRestore);\n\t}\n\n\tprivate doSetNativeFullScreen(fullscreen: boolean, fromRestore: boolean): void {\n\t\tif (isMacintosh) {\n\n\t\t\t// macOS: Electron windows report `false` for `isFullScreen()` for as long\n\t\t\t// as the fullscreen transition animation takes place. As such, we need to\n\t\t\t// listen to the transition events and carry around an intermediate state\n\t\t\t// for knowing if we are in fullscreen or not\n\t\t\t// Refs: https://github.com/electron/electron/issues/35360\n\n\t\t\tthis.transientIsNativeFullScreen = fullscreen;\n\n\t\t\tconst joinNativeFullScreenTransition = this.joinNativeFullScreenTransition = new DeferredPromise<boolean>();\n\t\t\t(async () => {\n\t\t\t\tconst transitioned = await Promise.race([\n\t\t\t\t\tjoinNativeFullScreenTransition.p,\n\t\t\t\t\ttimeout(10000).then(() => false)\n\t\t\t\t]);\n\n\t\t\t\tif (this.joinNativeFullScreenTransition !== joinNativeFullScreenTransition) {\n\t\t\t\t\treturn; // another transition was requested later\n\t\t\t\t}\n\n\t\t\t\tthis.transientIsNativeFullScreen = undefined;\n\t\t\t\tthis.joinNativeFullScreenTransition = undefined;\n\n\t\t\t\t// There is one interesting gotcha on macOS: when you are opening a new\n\t\t\t\t// window from a fullscreen window, that new window will immediately\n\t\t\t\t// open fullscreen and emit the `enter-full-screen` event even before we\n\t\t\t\t// reach this method. In that case, we actually will timeout after 10s\n\t\t\t\t// for detecting the transition and as such it is important that we only\n\t\t\t\t// signal to leave fullscreen if the window reports as not being in fullscreen.\n\n\t\t\t\tif (!transitioned && fullscreen && fromRestore && this.win && !this.win.isFullScreen()) {\n\n\t\t\t\t\t// We have seen requests for fullscreen failing eventually after some\n\t\t\t\t\t// time, for example when an OS update was performed and windows restore.\n\t\t\t\t\t// In those cases a user would find a window that is not in fullscreen\n\t\t\t\t\t// but also does not show any custom titlebar (and thus window controls)\n\t\t\t\t\t// because we think the window is in fullscreen.\n\t\t\t\t\t//\n\t\t\t\t\t// As a workaround in that case we emit a warning and leave fullscreen\n\t\t\t\t\t// so that at least the window controls are back.\n\n\t\t\t\t\tthis.logService.warn('window: native macOS fullscreen transition did not happen within 10s from restoring');\n\n\t\t\t\t\tthis._onDidLeaveFullScreen.fire();\n\t\t\t\t}\n\t\t\t})();\n\t\t}\n\n\t\tconst win = this.win;\n\t\twin?.setFullScreen(fullscreen);\n\t}\n\n\tprivate setSimpleFullScreen(fullscreen: boolean): void {\n\t\tconst win = this.win;\n\t\tif (win?.isFullScreen()) {\n\t\t\tthis.doSetNativeFullScreen(false, false);\n\t\t}\n\n\t\twin?.setSimpleFullScreen(fullscreen);\n\t\twin?.webContents.focus(); // workaround issue where focus is not going into window\n\t}\n\n\t//#endregion\n\n\tabstract matches(webContents: electron.WebContents): boolean;\n\n\toverride dispose(): void {\n\t\tsuper.dispose();\n\n\t\tthis._win = null!; // Important to dereference the window object to allow for GC\n\t}\n}\n\nexport class CodeWindow extends BaseWindow implements ICodeWindow {\n\n\t//#region Events\n\n\tprivate readonly _onWillLoad = this._register(new Emitter<ILoadEvent>());\n\treadonly onWillLoad = this._onWillLoad.event;\n\n\tprivate readonly _onDidSignalReady = this._register(new Emitter<void>());\n\treadonly onDidSignalReady = this._onDidSignalReady.event;\n\n\tprivate readonly _onDidDestroy = this._register(new Emitter<void>());\n\treadonly onDidDestroy = this._onDidDestroy.event;\n\n\t//#endregion\n\n\n\t//#region Properties\n\n\tprivate _id: number;\n\tget id(): number { return this._id; }\n\n\tprotected override _win: electron.BrowserWindow;\n\n\tget backupPath(): string | undefined { return this._config?.backupPath; }\n\n\tget openedWorkspace(): IWorkspaceIdentifier | ISingleFolderWorkspaceIdentifier | undefined { return this._config?.workspace; }\n\n\tget profile(): IUserDataProfile | undefined {\n\t\tif (!this.config) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\tconst profile = this.userDataProfilesService.profiles.find(profile => profile.id === this.config?.profiles.profile.id);\n\t\tif (this.isExtensionDevelopmentHost && profile) {\n\t\t\treturn profile;\n\t\t}\n\n\t\treturn this.userDataProfilesService.getProfileForWorkspace(this.config.workspace ?? toWorkspaceIdentifier(this.backupPath, this.isExtensionDevelopmentHost)) ?? this.userDataProfilesService.defaultProfile;\n\t}\n\n\tget remoteAuthority(): string | undefined { return this._config?.remoteAuthority; }\n\n\tprivate _config: INativeWindowConfiguration | undefined;\n\tget config(): INativeWindowConfiguration | undefined { return this._config; }\n\n\tget isExtensionDevelopmentHost(): boolean { return !!(this._config?.extensionDevelopmentPath); }\n\n\tget isExtensionTestHost(): boolean { return !!(this._config?.extensionTestsPath); }\n\n\tget isExtensionDevelopmentTestFromCli(): boolean { return this.isExtensionDevelopmentHost && this.isExtensionTestHost && !this._config?.debugId; }\n\n\t//#endregion\n\n\tprivate readonly windowState: IWindowState;\n\tprivate currentMenuBarVisibility: MenuBarVisibility | undefined;\n\n\tprivate readonly whenReadyCallbacks: { (window: ICodeWindow): void }[] = [];\n\n\tprivate readonly touchBarGroups: electron.TouchBarSegmentedControl[] = [];\n\n\tprivate currentHttpProxy: string | undefined = undefined;\n\tprivate currentNoProxy: string | undefined = undefined;\n\n\tprivate customZoomLevel: number | undefined = undefined;\n\n\tprivate readonly configObjectUrl: IIPCObjectUrl<INativeWindowConfiguration>;\n\tprivate pendingLoadConfig: INativeWindowConfiguration | undefined;\n\tprivate wasLoaded = false;\n\n\tprivate readonly jsCallStackMap: Map<string, number>;\n\tprivate readonly jsCallStackEffectiveSampleCount: number;\n\tprivate readonly jsCallStackCollector: Delayer<void>;\n\tprivate readonly jsCallStackCollectorStopScheduler: RunOnceScheduler;\n\n\tconstructor(\n\t\tconfig: IWindowCreationOptions,\n\t\t@ILogService logService: ILogService,\n\t\t@ILoggerMainService private readonly loggerMainService: ILoggerMainService,\n\t\t@IEnvironmentMainService environmentMainService: IEnvironmentMainService,\n\t\t@IPolicyService private readonly policyService: IPolicyService,\n\t\t@IUserDataProfilesMainService private readonly userDataProfilesService: IUserDataProfilesMainService,\n\t\t@IFileService private readonly fileService: IFileService,\n\t\t@IApplicationStorageMainService private readonly applicationStorageMainService: IApplicationStorageMainService,\n\t\t@IStorageMainService private readonly storageMainService: IStorageMainService,\n\t\t@IConfigurationService configurationService: IConfigurationService,\n\t\t@IThemeMainService private readonly themeMainService: IThemeMainService,\n\t\t@IWorkspacesManagementMainService private readonly workspacesManagementMainService: IWorkspacesManagementMainService,\n\t\t@IBackupMainService private readonly backupMainService: IBackupMainService,\n\t\t@ITelemetryService private readonly telemetryService: ITelemetryService,\n\t\t@IDialogMainService private readonly dialogMainService: IDialogMainService,\n\t\t@ILifecycleMainService private readonly lifecycleMainService: ILifecycleMainService,\n\t\t@IProductService private readonly productService: IProductService,\n\t\t@IProtocolMainService protocolMainService: IProtocolMainService,\n\t\t@IWindowsMainService private readonly windowsMainService: IWindowsMainService,\n\t\t@IStateService stateService: IStateService,\n\t\t@IInstantiationService instantiationService: IInstantiationService\n\t) {\n\t\tsuper(configurationService, stateService, environmentMainService, logService);\n\n\t\t//#region create browser window\n\t\t{\n\t\t\tthis.configObjectUrl = this._register(protocolMainService.createIPCObjectUrl<INativeWindowConfiguration>());\n\n\t\t\t// Load window state\n\t\t\tconst [state, hasMultipleDisplays] = this.restoreWindowState(config.state);\n\t\t\tthis.windowState = state;\n\t\t\tthis.logService.trace('window#ctor: using window state', state);\n\n\t\t\tconst options = instantiationService.invokeFunction(defaultBrowserWindowOptions, this.windowState, undefined, {\n\t\t\t\tpreload: FileAccess.asFileUri('vs/base/parts/sandbox/electron-browser/preload.js').fsPath,\n\t\t\t\tadditionalArguments: [`--vscode-window-config=${this.configObjectUrl.resource.toString()}`],\n\t\t\t\tv8CacheOptions: this.environmentMainService.useCodeCache ? 'bypassHeatCheck' : 'none',\n\t\t\t});\n\n\t\t\t// Create the browser window\n\t\t\tmark('code/willCreateCodeBrowserWindow');\n\t\t\tthis._win = new electron.BrowserWindow(options);\n\t\t\tmark('code/didCreateCodeBrowserWindow');\n\n\t\t\tthis._id = this._win.id;\n\t\t\tthis.setWin(this._win, options);\n\n\t\t\t// Apply some state after window creation\n\t\t\tthis.applyState(this.windowState, hasMultipleDisplays);\n\n\t\t\tthis._lastFocusTime = Date.now(); // since we show directly, we need to set the last focus time too\n\t\t}\n\t\t//#endregion\n\n\t\t//#region JS Callstack Collector\n\n\t\tlet sampleInterval = parseInt(this.environmentMainService.args['unresponsive-sample-interval'] || '1000');\n\t\tlet samplePeriod = parseInt(this.environmentMainService.args['unresponsive-sample-period'] || '15000');\n\t\tif (sampleInterval <= 0 || samplePeriod <= 0 || sampleInterval > samplePeriod) {\n\t\t\tthis.logService.warn(`Invalid unresponsive sample interval (${sampleInterval}ms) or period (${samplePeriod}ms), using defaults.`);\n\t\t\tsampleInterval = 1000;\n\t\t\tsamplePeriod = 15000;\n\t\t}\n\n\t\tthis.jsCallStackMap = new Map<string, number>();\n\t\tthis.jsCallStackEffectiveSampleCount = Math.round(samplePeriod / sampleInterval);\n\t\tthis.jsCallStackCollector = this._register(new Delayer<void>(sampleInterval));\n\t\tthis.jsCallStackCollectorStopScheduler = this._register(new RunOnceScheduler(() => {\n\t\t\tthis.stopCollectingJScallStacks(); // Stop collecting after 15s max\n\t\t}, samplePeriod));\n\n\t\t//#endregion\n\n\t\t// respect configured menu bar visibility\n\t\tthis.onConfigurationUpdated();\n\n\t\t// macOS: touch bar support\n\t\tthis.createTouchBar();\n\n\t\t// Eventing\n\t\tthis.registerListeners();\n\t}\n\n\tprivate readyState = ReadyState.NONE;\n\n\tsetReady(): void {\n\t\tthis.logService.trace(`window#load: window reported ready (id: ${this._id})`);\n\n\t\tthis.readyState = ReadyState.READY;\n\n\t\t// inform all waiting promises that we are ready now\n\t\twhile (this.whenReadyCallbacks.length) {\n\t\t\tthis.whenReadyCallbacks.pop()!(this);\n\t\t}\n\n\t\t// Events\n\t\tthis._onDidSignalReady.fire();\n\t}\n\n\tready(): Promise<ICodeWindow> {\n\t\treturn new Promise<ICodeWindow>(resolve => {\n\t\t\tif (this.isReady) {\n\t\t\t\treturn resolve(this);\n\t\t\t}\n\n\t\t\t// otherwise keep and call later when we are ready\n\t\t\tthis.whenReadyCallbacks.push(resolve);\n\t\t});\n\t}\n\n\tget isReady(): boolean {\n\t\treturn this.readyState === ReadyState.READY;\n\t}\n\n\tget whenClosedOrLoaded(): Promise<void> {\n\t\treturn new Promise<void>(resolve => {\n\n\t\t\tfunction handle() {\n\t\t\t\tcloseListener.dispose();\n\t\t\t\tloadListener.dispose();\n\n\t\t\t\tresolve();\n\t\t\t}\n\n\t\t\tconst closeListener = this.onDidClose(() => handle());\n\t\t\tconst loadListener = this.onWillLoad(() => handle());\n\t\t});\n\t}\n\n\tprivate registerListeners(): void {\n\n\t\t// Window error conditions to handle\n\t\tthis._register(Event.fromNodeEventEmitter(this._win, 'unresponsive')(() => this.onWindowError(WindowError.UNRESPONSIVE)));\n\t\tthis._register(Event.fromNodeEventEmitter(this._win, 'responsive')(() => this.onWindowError(WindowError.RESPONSIVE)));\n\t\tthis._register(Event.fromNodeEventEmitter(this._win.webContents, 'render-process-gone', (event, details) => details)(details => this.onWindowError(WindowError.PROCESS_GONE, { ...details })));\n\t\tthis._register(Event.fromNodeEventEmitter(this._win.webContents, 'did-fail-load', (event, exitCode, reason) => ({ exitCode, reason }))(({ exitCode, reason }) => this.onWindowError(WindowError.LOAD, { reason, exitCode })));\n\n\t\t// Prevent windows/iframes from blocking the unload\n\t\t// through DOM events. We have our own logic for\n\t\t// unloading a window that should not be confused\n\t\t// with the DOM way.\n\t\t// (https://github.com/microsoft/vscode/issues/122736)\n\t\tthis._register(Event.fromNodeEventEmitter<electron.Event>(this._win.webContents, 'will-prevent-unload')(event => event.preventDefault()));\n\n\t\t// Remember that we loaded\n\t\tthis._register(Event.fromNodeEventEmitter(this._win.webContents, 'did-finish-load')(() => {\n\n\t\t\t// Associate properties from the load request if provided\n\t\t\tif (this.pendingLoadConfig) {\n\t\t\t\tthis._config = this.pendingLoadConfig;\n\n\t\t\t\tthis.pendingLoadConfig = undefined;\n\t\t\t}\n\t\t}));\n\n\t\t// Window (Un)Maximize\n\t\tthis._register(this.onDidMaximize(() => {\n\t\t\tif (this._config) {\n\t\t\t\tthis._config.maximized = true;\n\t\t\t}\n\t\t}));\n\n\t\tthis._register(this.onDidUnmaximize(() => {\n\t\t\tif (this._config) {\n\t\t\t\tthis._config.maximized = false;\n\t\t\t}\n\t\t}));\n\n\t\t// Window Fullscreen\n\t\tthis._register(this.onDidEnterFullScreen(() => {\n\t\t\tthis.sendWhenReady('vscode:enterFullScreen', CancellationToken.None);\n\t\t}));\n\n\t\tthis._register(this.onDidLeaveFullScreen(() => {\n\t\t\tthis.sendWhenReady('vscode:leaveFullScreen', CancellationToken.None);\n\t\t}));\n\n\t\t// Handle configuration changes\n\t\tthis._register(this.configurationService.onDidChangeConfiguration(e => this.onConfigurationUpdated(e)));\n\n\t\t// Handle Workspace events\n\t\tthis._register(this.workspacesManagementMainService.onDidDeleteUntitledWorkspace(e => this.onDidDeleteUntitledWorkspace(e)));\n\n\t\t// Inject headers when requests are incoming\n\t\tconst urls = ['https://*.vsassets.io/*'];\n\t\tif (this.productService.extensionsGallery?.serviceUrl) {\n\t\t\tconst serviceUrl = URI.parse(this.productService.extensionsGallery.serviceUrl);\n\t\t\turls.push(`${serviceUrl.scheme}://${serviceUrl.authority}/*`);\n\t\t}\n\t\tthis._win.webContents.session.webRequest.onBeforeSendHeaders({ urls }, async (details, cb) => {\n\t\t\tconst headers = await this.getMarketplaceHeaders();\n\n\t\t\tcb({ cancel: false, requestHeaders: Object.assign(details.requestHeaders, headers) });\n\t\t});\n\t}\n\n\tprivate marketplaceHeadersPromise: Promise<object> | undefined;\n\tprivate getMarketplaceHeaders(): Promise<object> {\n\t\tif (!this.marketplaceHeadersPromise) {\n\t\t\tthis.marketplaceHeadersPromise = resolveMarketplaceHeaders(\n\t\t\t\tthis.productService.version,\n\t\t\t\tthis.productService,\n\t\t\t\tthis.environmentMainService,\n\t\t\t\tthis.configurationService,\n\t\t\t\tthis.fileService,\n\t\t\t\tthis.applicationStorageMainService,\n\t\t\t\tthis.telemetryService);\n\t\t}\n\n\t\treturn this.marketplaceHeadersPromise;\n\t}\n\n\tprivate async onWindowError(error: WindowError.UNRESPONSIVE): Promise<void>;\n\tprivate async onWindowError(error: WindowError.RESPONSIVE): Promise<void>;\n\tprivate async onWindowError(error: WindowError.PROCESS_GONE, details: { reason: string; exitCode: number }): Promise<void>;\n\tprivate async onWindowError(error: WindowError.LOAD, details: { reason: string; exitCode: number }): Promise<void>;\n\tprivate async onWindowError(type: WindowError, details?: { reason?: string; exitCode?: number }): Promise<void> {\n\n\t\tswitch (type) {\n\t\t\tcase WindowError.PROCESS_GONE:\n\t\t\t\tthis.logService.error(`CodeWindow: renderer process gone (reason: ${details?.reason || '<unknown>'}, code: ${details?.exitCode || '<unknown>'})`);\n\t\t\t\tbreak;\n\t\t\tcase WindowError.UNRESPONSIVE:\n\t\t\t\tthis.logService.error('CodeWindow: detected unresponsive');\n\t\t\t\tbreak;\n\t\t\tcase WindowError.RESPONSIVE:\n\t\t\t\tthis.logService.error('CodeWindow: recovered from unresponsive');\n\t\t\t\tbreak;\n\t\t\tcase WindowError.LOAD:\n\t\t\t\tthis.logService.error(`CodeWindow: failed to load (reason: ${details?.reason || '<unknown>'}, code: ${details?.exitCode || '<unknown>'})`);\n\t\t\t\tbreak;\n\t\t}\n\n\t\t// Telemetry\n\t\ttype WindowErrorClassification = {\n\t\t\ttype: { classification: 'SystemMetaData'; purpose: 'PerformanceAndHealth'; comment: 'The type of window error to understand the nature of the error better.' };\n\t\t\treason: { classification: 'SystemMetaData'; purpose: 'PerformanceAndHealth'; comment: 'The reason of the window error to understand the nature of the error better.' };\n\t\t\tcode: { classification: 'SystemMetaData'; purpose: 'PerformanceAndHealth'; comment: 'The exit code of the window process to understand the nature of the error better' };\n\t\t\towner: 'bpasero';\n\t\t\tcomment: 'Provides insight into reasons the vscode window had an error.';\n\t\t};\n\t\ttype WindowErrorEvent = {\n\t\t\ttype: WindowError;\n\t\t\treason: string | undefined;\n\t\t\tcode: number | undefined;\n\t\t};\n\t\tthis.telemetryService.publicLog2<WindowErrorEvent, WindowErrorClassification>('windowerror', {\n\t\t\ttype,\n\t\t\treason: details?.reason,\n\t\t\tcode: details?.exitCode\n\t\t});\n\n\t\t// Inform User if non-recoverable\n\t\tswitch (type) {\n\t\t\tcase WindowError.UNRESPONSIVE:\n\t\t\tcase WindowError.PROCESS_GONE:\n\n\t\t\t\t// If we run extension tests from CLI, we want to signal\n\t\t\t\t// back this state to the test runner by exiting with a\n\t\t\t\t// non-zero exit code.\n\t\t\t\tif (this.isExtensionDevelopmentTestFromCli) {\n\t\t\t\t\tthis.lifecycleMainService.kill(1);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t// If we run smoke tests, want to proceed with an orderly\n\t\t\t\t// shutdown as much as possible by destroying the window\n\t\t\t\t// and then calling the normal `quit` routine.\n\t\t\t\tif (this.environmentMainService.args['enable-smoke-test-driver']) {\n\t\t\t\t\tawait this.destroyWindow(false, false);\n\t\t\t\t\tthis.lifecycleMainService.quit(); // still allow for an orderly shutdown\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t// Unresponsive\n\t\t\t\tif (type === WindowError.UNRESPONSIVE) {\n\t\t\t\t\tif (this.isExtensionDevelopmentHost || this.isExtensionTestHost || this._win?.webContents?.isDevToolsOpened()) {\n\t\t\t\t\t\t// TODO@electron Workaround for https://github.com/microsoft/vscode/issues/56994\n\t\t\t\t\t\t// In certain cases the window can report unresponsiveness because a breakpoint was hit\n\t\t\t\t\t\t// and the process is stopped executing. The most typical cases are:\n\t\t\t\t\t\t// - devtools are opened and debugging happens\n\t\t\t\t\t\t// - window is an extensions development host that is being debugged\n\t\t\t\t\t\t// - window is an extension test development host that is being debugged\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Interrupt V8 and collect JavaScript stack\n\t\t\t\t\tthis.jsCallStackCollector.trigger(() => this.startCollectingJScallStacks());\n\t\t\t\t\t// Stack collection will stop under any of the following conditions:\n\t\t\t\t\t// - The window becomes responsive again\n\t\t\t\t\t// - The window is destroyed i-e reopen or closed\n\t\t\t\t\t// - sampling period is complete, default is 15s\n\t\t\t\t\tthis.jsCallStackCollectorStopScheduler.schedule();\n\n\t\t\t\t\t// Show Dialog\n\t\t\t\t\tconst { response, checkboxChecked } = await this.dialogMainService.showMessageBox({\n\t\t\t\t\t\ttype: 'warning',\n\t\t\t\t\t\tbuttons: [\n\t\t\t\t\t\t\tlocalize({ key: 'reopen', comment: ['&& denotes a mnemonic'] }, \"&&Reopen\"),\n\t\t\t\t\t\t\tlocalize({ key: 'close', comment: ['&& denotes a mnemonic'] }, \"&&Close\"),\n\t\t\t\t\t\t\tlocalize({ key: 'wait', comment: ['&& denotes a mnemonic'] }, \"&&Keep Waiting\")\n\t\t\t\t\t\t],\n\t\t\t\t\t\tmessage: localize('appStalled', \"The window is not responding\"),\n\t\t\t\t\t\tdetail: localize('appStalledDetail', \"You can reopen or close the window or keep waiting.\"),\n\t\t\t\t\t\tcheckboxLabel: this._config?.workspace ? localize('doNotRestoreEditors', \"Don't restore editors\") : undefined\n\t\t\t\t\t}, this._win);\n\n\t\t\t\t\t// Handle choice\n\t\t\t\t\tif (response !== 2 /* keep waiting */) {\n\t\t\t\t\t\tconst reopen = response === 0;\n\t\t\t\t\t\tthis.stopCollectingJScallStacks();\n\t\t\t\t\t\tawait this.destroyWindow(reopen, checkboxChecked);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Process gone\n\t\t\t\telse if (type === WindowError.PROCESS_GONE) {\n\t\t\t\t\tlet message: string;\n\t\t\t\t\tif (!details) {\n\t\t\t\t\t\tmessage = localize('appGone', \"The window terminated unexpectedly\");\n\t\t\t\t\t} else {\n\t\t\t\t\t\tmessage = localize('appGoneDetails', \"The window terminated unexpectedly (reason: '{0}', code: '{1}')\", details.reason, details.exitCode ?? '<unknown>');\n\t\t\t\t\t}\n\n\t\t\t\t\t// Show Dialog\n\t\t\t\t\tconst { response, checkboxChecked } = await this.dialogMainService.showMessageBox({\n\t\t\t\t\t\ttype: 'warning',\n\t\t\t\t\t\tbuttons: [\n\t\t\t\t\t\t\tthis._config?.workspace ? localize({ key: 'reopen', comment: ['&& denotes a mnemonic'] }, \"&&Reopen\") : localize({ key: 'newWindow', comment: ['&& denotes a mnemonic'] }, \"&&New Window\"),\n\t\t\t\t\t\t\tlocalize({ key: 'close', comment: ['&& denotes a mnemonic'] }, \"&&Close\")\n\t\t\t\t\t\t],\n\t\t\t\t\t\tmessage,\n\t\t\t\t\t\tdetail: this._config?.workspace ?\n\t\t\t\t\t\t\tlocalize('appGoneDetailWorkspace', \"We are sorry for the inconvenience. You can reopen the window to continue where you left off.\") :\n\t\t\t\t\t\t\tlocalize('appGoneDetailEmptyWindow', \"We are sorry for the inconvenience. You can open a new empty window to start again.\"),\n\t\t\t\t\t\tcheckboxLabel: this._config?.workspace ? localize('doNotRestoreEditors', \"Don't restore editors\") : undefined\n\t\t\t\t\t}, this._win);\n\n\t\t\t\t\t// Handle choice\n\t\t\t\t\tconst reopen = response === 0;\n\t\t\t\t\tawait this.destroyWindow(reopen, checkboxChecked);\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase WindowError.RESPONSIVE:\n\t\t\t\tthis.stopCollectingJScallStacks();\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tprivate async destroyWindow(reopen: boolean, skipRestoreEditors: boolean): Promise<void> {\n\t\tconst workspace = this._config?.workspace;\n\n\t\t// check to discard editor state first\n\t\tif (skipRestoreEditors && workspace) {\n\t\t\ttry {\n\t\t\t\tconst workspaceStorage = this.storageMainService.workspaceStorage(workspace);\n\t\t\t\tawait workspaceStorage.init();\n\t\t\t\tworkspaceStorage.delete('memento/workbench.parts.editor');\n\t\t\t\tawait workspaceStorage.close();\n\t\t\t} catch (error) {\n\t\t\t\tthis.logService.error(error);\n\t\t\t}\n\t\t}\n\n\t\t// 'close' event will not be fired on destroy(), so signal crash via explicit event\n\t\tthis._onDidDestroy.fire();\n\n\t\ttry {\n\t\t\t// ask the windows service to open a new fresh window if specified\n\t\t\tif (reopen && this._config) {\n\n\t\t\t\t// We have to reconstruct a openable from the current workspace\n\t\t\t\tlet uriToOpen: IWorkspaceToOpen | IFolderToOpen | undefined = undefined;\n\t\t\t\tlet forceEmpty = undefined;\n\t\t\t\tif (isSingleFolderWorkspaceIdentifier(workspace)) {\n\t\t\t\t\turiToOpen = { folderUri: workspace.uri };\n\t\t\t\t} else if (isWorkspaceIdentifier(workspace)) {\n\t\t\t\t\turiToOpen = { workspaceUri: workspace.configPath };\n\t\t\t\t} else {\n\t\t\t\t\tforceEmpty = true;\n\t\t\t\t}\n\n\t\t\t\t// Delegate to windows service\n\t\t\t\tconst window = (await this.windowsMainService.open({\n\t\t\t\t\tcontext: OpenContext.API,\n\t\t\t\t\tuserEnv: this._config.userEnv,\n\t\t\t\t\tcli: {\n\t\t\t\t\t\t...this.environmentMainService.args,\n\t\t\t\t\t\t_: [] // we pass in the workspace to open explicitly via `urisToOpen`\n\t\t\t\t\t},\n\t\t\t\t\turisToOpen: uriToOpen ? [uriToOpen] : undefined,\n\t\t\t\t\tforceEmpty,\n\t\t\t\t\tforceNewWindow: true,\n\t\t\t\t\tremoteAuthority: this.remoteAuthority\n\t\t\t\t})).at(0);\n\t\t\t\twindow?.focus();\n\t\t\t}\n\t\t} finally {\n\t\t\t// make sure to destroy the window as its renderer process is gone. do this\n\t\t\t// after the code for reopening the window, to prevent the entire application\n\t\t\t// from quitting when the last window closes as a result.\n\t\t\tthis._win?.destroy();\n\t\t}\n\t}\n\n\tprivate onDidDeleteUntitledWorkspace(workspace: IWorkspaceIdentifier): void {\n\n\t\t// Make sure to update our workspace config if we detect that it\n\t\t// was deleted\n\t\tif (this._config?.workspace?.id === workspace.id) {\n\t\t\tthis._config.workspace = undefined;\n\t\t}\n\t}\n\n\tprivate onConfigurationUpdated(e?: IConfigurationChangeEvent): void {\n\n\t\t// Swipe command support (macOS)\n\t\tif (isMacintosh && (!e || e.affectsConfiguration('workbench.editor.swipeToNavigate'))) {\n\t\t\tconst swipeToNavigate = this.configurationService.getValue<boolean>('workbench.editor.swipeToNavigate');\n\t\t\tif (swipeToNavigate) {\n\t\t\t\tthis.registerSwipeListener();\n\t\t\t} else {\n\t\t\t\tthis.swipeListenerDisposable.clear();\n\t\t\t}\n\t\t}\n\n\t\t// Menubar\n\t\tif (!e || e.affectsConfiguration(MenuSettings.MenuBarVisibility)) {\n\t\t\tconst newMenuBarVisibility = this.getMenuBarVisibility();\n\t\t\tif (newMenuBarVisibility !== this.currentMenuBarVisibility) {\n\t\t\t\tthis.currentMenuBarVisibility = newMenuBarVisibility;\n\t\t\t\tthis.setMenuBarVisibility(newMenuBarVisibility);\n\t\t\t}\n\t\t}\n\n\t\t// Proxy\n\t\tif (!e || e.affectsConfiguration('http.proxy') || e.affectsConfiguration('http.noProxy')) {\n\t\t\tconst inspect = this.configurationService.inspect<string>('http.proxy');\n\t\t\tlet newHttpProxy = (inspect.userLocalValue || '').trim()\n\t\t\t\t|| (process.env['https_proxy'] || process.env['HTTPS_PROXY'] || process.env['http_proxy'] || process.env['HTTP_PROXY'] || '').trim() // Not standardized.\n\t\t\t\t|| undefined;\n\n\t\t\tif (newHttpProxy?.indexOf('@') !== -1) {\n\t\t\t\tconst uri = URI.parse(newHttpProxy!);\n\t\t\t\tconst i = uri.authority.indexOf('@');\n\t\t\t\tif (i !== -1) {\n\t\t\t\t\tnewHttpProxy = uri.with({ authority: uri.authority.substring(i + 1) })\n\t\t\t\t\t\t.toString();\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (newHttpProxy?.endsWith('/')) {\n\t\t\t\tnewHttpProxy = newHttpProxy.substr(0, newHttpProxy.length - 1);\n\t\t\t}\n\n\t\t\tconst newNoProxy = (this.configurationService.getValue<string[]>('http.noProxy') || []).map((item) => item.trim()).join(',')\n\t\t\t\t|| (process.env['no_proxy'] || process.env['NO_PROXY'] || '').trim() || undefined; // Not standardized.\n\t\t\tif ((newHttpProxy || '').indexOf('@') === -1 && (newHttpProxy !== this.currentHttpProxy || newNoProxy !== this.currentNoProxy)) {\n\t\t\t\tthis.currentHttpProxy = newHttpProxy;\n\t\t\t\tthis.currentNoProxy = newNoProxy;\n\n\t\t\t\tconst proxyRules = newHttpProxy || '';\n\t\t\t\tconst proxyBypassRules = newNoProxy ? `${newNoProxy},<local>` : '<local>';\n\t\t\t\tthis.logService.trace(`Setting proxy to '${proxyRules}', bypassing '${proxyBypassRules}'`);\n\t\t\t\tthis._win.webContents.session.setProxy({ proxyRules, proxyBypassRules, pacScript: '' });\n\t\t\t\telectron.app.setProxy({ proxyRules, proxyBypassRules, pacScript: '' });\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate readonly swipeListenerDisposable = this._register(new MutableDisposable());\n\n\tprivate registerSwipeListener(): void {\n\t\tthis.swipeListenerDisposable.value = Event.fromNodeEventEmitter<string>(this._win, 'swipe', (event: Electron.Event, cmd: string) => cmd)(cmd => {\n\t\t\tif (!this.isReady) {\n\t\t\t\treturn; // window must be ready\n\t\t\t}\n\n\t\t\tif (cmd === 'left') {\n\t\t\t\tthis.send('vscode:runAction', { id: 'workbench.action.openPreviousRecentlyUsedEditor', from: 'mouse' });\n\t\t\t} else if (cmd === 'right') {\n\t\t\t\tthis.send('vscode:runAction', { id: 'workbench.action.openNextRecentlyUsedEditor', from: 'mouse' });\n\t\t\t}\n\t\t});\n\t}\n\n\taddTabbedWindow(window: ICodeWindow): void {\n\t\tif (isMacintosh && window.win) {\n\t\t\tthis._win.addTabbedWindow(window.win);\n\t\t}\n\t}\n\n\tload(configuration: INativeWindowConfiguration, options: ILoadOptions = Object.create(null)): void {\n\t\tthis.logService.trace(`window#load: attempt to load window (id: ${this._id})`);\n\n\t\t// Clear Document Edited if needed\n\t\tif (this.isDocumentEdited()) {\n\t\t\tif (!options.isReload || !this.backupMainService.isHotExitEnabled()) {\n\t\t\t\tthis.setDocumentEdited(false);\n\t\t\t}\n\t\t}\n\n\t\t// Clear Title and Filename if needed\n\t\tif (!options.isReload) {\n\t\t\tif (this.getRepresentedFilename()) {\n\t\t\t\tthis.setRepresentedFilename('');\n\t\t\t}\n\n\t\t\tthis._win.setTitle(this.productService.nameLong);\n\t\t}\n\n\t\t// Update configuration values based on our window context\n\t\t// and set it into the config object URL for usage.\n\t\tthis.updateConfiguration(configuration, options);\n\n\t\t// If this is the first time the window is loaded, we associate the paths\n\t\t// directly with the window because we assume the loading will just work\n\t\tif (this.readyState === ReadyState.NONE) {\n\t\t\tthis._config = configuration;\n\t\t}\n\n\t\t// Otherwise, the window is currently showing a folder and if there is an\n\t\t// unload handler preventing the load, we cannot just associate the paths\n\t\t// because the loading might be vetoed. Instead we associate it later when\n\t\t// the window load event has fired.\n\t\telse {\n\t\t\tthis.pendingLoadConfig = configuration;\n\t\t}\n\n\t\t// Indicate we are navigting now\n\t\tthis.readyState = ReadyState.NAVIGATING;\n\n\t\t// Load URL\n\t\tthis._win.loadURL(FileAccess.asBrowserUri(`vs/code/electron-browser/workbench/workbench${this.environmentMainService.isBuilt ? '' : '-dev'}.html`).toString(true));\n\n\t\t// Remember that we did load\n\t\tconst wasLoaded = this.wasLoaded;\n\t\tthis.wasLoaded = true;\n\n\t\t// Make window visible if it did not open in N seconds because this indicates an error\n\t\t// Only do this when running out of sources and not when running tests\n\t\tif (!this.environmentMainService.isBuilt && !this.environmentMainService.extensionTestsLocationURI) {\n\t\t\tthis._register(new RunOnceScheduler(() => {\n\t\t\t\tif (this._win && !this._win.isVisible() && !this._win.isMinimized()) {\n\t\t\t\t\tthis._win.show();\n\t\t\t\t\tthis.focus({ mode: FocusMode.Force });\n\t\t\t\t\tthis._win.webContents.openDevTools();\n\t\t\t\t}\n\t\t\t}, 10000)).schedule();\n\t\t}\n\n\t\t// Event\n\t\tthis._onWillLoad.fire({ workspace: configuration.workspace, reason: options.isReload ? LoadReason.RELOAD : wasLoaded ? LoadReason.LOAD : LoadReason.INITIAL });\n\t}\n\n\tprivate updateConfiguration(configuration: INativeWindowConfiguration, options: ILoadOptions): void {\n\n\t\t// If this window was loaded before from the command line\n\t\t// (as indicated by VSCODE_CLI environment), make sure to\n\t\t// preserve that user environment in subsequent loads,\n\t\t// unless the new configuration context was also a CLI\n\t\t// (for https://github.com/microsoft/vscode/issues/108571)\n\t\t// Also, preserve the environment if we're loading from an\n\t\t// extension development host that had its environment set\n\t\t// (for https://github.com/microsoft/vscode/issues/123508)\n\t\tconst currentUserEnv = (this._config ?? this.pendingLoadConfig)?.userEnv;\n\t\tif (currentUserEnv) {\n\t\t\tconst shouldPreserveLaunchCliEnvironment = isLaunchedFromCli(currentUserEnv) && !isLaunchedFromCli(configuration.userEnv);\n\t\t\tconst shouldPreserveDebugEnvironmnet = this.isExtensionDevelopmentHost;\n\t\t\tif (shouldPreserveLaunchCliEnvironment || shouldPreserveDebugEnvironmnet) {\n\t\t\t\tconfiguration.userEnv = { ...currentUserEnv, ...configuration.userEnv }; // still allow to override certain environment as passed in\n\t\t\t}\n\t\t}\n\n\t\t// If named pipe was instantiated for the crashpad_handler process, reuse the same\n\t\t// pipe for new app instances connecting to the original app instance.\n\t\t// Ref: https://github.com/microsoft/vscode/issues/115874\n\t\tif (process.env['CHROME_CRASHPAD_PIPE_NAME']) {\n\t\t\tObject.assign(configuration.userEnv, {\n\t\t\t\tCHROME_CRASHPAD_PIPE_NAME: process.env['CHROME_CRASHPAD_PIPE_NAME']\n\t\t\t});\n\t\t}\n\n\t\t// Add disable-extensions to the config, but do not preserve it on currentConfig or\n\t\t// pendingLoadConfig so that it is applied only on this load\n\t\tif (options.disableExtensions !== undefined) {\n\t\t\tconfiguration['disable-extensions'] = options.disableExtensions;\n\t\t}\n\n\t\t// Update window related properties\n\t\ttry {\n\t\t\tconfiguration.handle = VSBuffer.wrap(this._win.getNativeWindowHandle());\n\t\t} catch (error) {\n\t\t\tthis.logService.error(`Error getting native window handle: ${error}`);\n\t\t}\n\t\tconfiguration.fullscreen = this.isFullScreen;\n\t\tconfiguration.maximized = this._win.isMaximized();\n\t\tconfiguration.partsSplash = this.themeMainService.getWindowSplash(configuration.workspace);\n\t\tconfiguration.zoomLevel = this.getZoomLevel();\n\t\tconfiguration.isCustomZoomLevel = typeof this.customZoomLevel === 'number';\n\t\tif (configuration.isCustomZoomLevel && configuration.partsSplash) {\n\t\t\tconfiguration.partsSplash.zoomLevel = configuration.zoomLevel;\n\t\t}\n\n\t\t// Update with latest perf marks\n\t\tmark('code/willOpenNewWindow');\n\t\tconfiguration.perfMarks = getMarks();\n\n\t\t// Update in config object URL for usage in renderer\n\t\tthis.configObjectUrl.update(configuration);\n\t}\n\n\tasync reload(cli?: NativeParsedArgs): Promise<void> {\n\n\t\t// Copy our current config for reuse\n\t\tconst configuration = Object.assign({}, this._config);\n\n\t\t// Validate workspace\n\t\tconfiguration.workspace = await this.validateWorkspaceBeforeReload(configuration);\n\n\t\t// Delete some properties we do not want during reload\n\t\tdelete configuration.filesToOpenOrCreate;\n\t\tdelete configuration.filesToDiff;\n\t\tdelete configuration.filesToMerge;\n\t\tdelete configuration.filesToWait;\n\n\t\t// Some configuration things get inherited if the window is being reloaded and we are\n\t\t// in extension development mode. These options are all development related.\n\t\tif (this.isExtensionDevelopmentHost && cli) {\n\t\t\tconfiguration.verbose = cli.verbose;\n\t\t\tconfiguration.debugId = cli.debugId;\n\t\t\tconfiguration.extensionEnvironment = cli.extensionEnvironment;\n\t\t\tconfiguration['inspect-extensions'] = cli['inspect-extensions'];\n\t\t\tconfiguration['inspect-brk-extensions'] = cli['inspect-brk-extensions'];\n\t\t\tconfiguration['extensions-dir'] = cli['extensions-dir'];\n\t\t}\n\n\t\tconfiguration.accessibilitySupport = electron.app.isAccessibilitySupportEnabled();\n\t\tconfiguration.isInitialStartup = false; // since this is a reload\n\t\tconfiguration.policiesData = this.policyService.serialize(); // set policies data again\n\t\tconfiguration.continueOn = this.environmentMainService.continueOn;\n\t\tconfiguration.profiles = {\n\t\t\tall: this.userDataProfilesService.profiles,\n\t\t\tprofile: this.profile || this.userDataProfilesService.defaultProfile,\n\t\t\thome: this.userDataProfilesService.profilesHome\n\t\t};\n\t\tconfiguration.logLevel = this.loggerMainService.getLogLevel();\n\t\tconfiguration.loggers = this.loggerMainService.getGlobalLoggers();\n\n\t\t// Load config\n\t\tthis.load(configuration, { isReload: true, disableExtensions: cli?.['disable-extensions'] });\n\t}\n\n\tprivate async validateWorkspaceBeforeReload(configuration: INativeWindowConfiguration): Promise<IWorkspaceIdentifier | ISingleFolderWorkspaceIdentifier | undefined> {\n\n\t\t// Multi folder\n\t\tif (isWorkspaceIdentifier(configuration.workspace)) {\n\t\t\tconst configPath = configuration.workspace.configPath;\n\t\t\tif (configPath.scheme === Schemas.file) {\n\t\t\t\tconst workspaceExists = await this.fileService.exists(configPath);\n\t\t\t\tif (!workspaceExists) {\n\t\t\t\t\treturn undefined;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// Single folder\n\t\telse if (isSingleFolderWorkspaceIdentifier(configuration.workspace)) {\n\t\t\tconst uri = configuration.workspace.uri;\n\t\t\tif (uri.scheme === Schemas.file) {\n\t\t\t\tconst folderExists = await this.fileService.exists(uri);\n\t\t\t\tif (!folderExists) {\n\t\t\t\t\treturn undefined;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// Workspace is valid\n\t\treturn configuration.workspace;\n\t}\n\n\tserializeWindowState(): IWindowState {\n\t\tif (!this._win) {\n\t\t\treturn defaultWindowState();\n\t\t}\n\n\t\t// fullscreen gets special treatment\n\t\tif (this.isFullScreen) {\n\t\t\tlet display: electron.Display | undefined;\n\t\t\ttry {\n\t\t\t\tdisplay = electron.screen.getDisplayMatching(this.getBounds());\n\t\t\t} catch (error) {\n\t\t\t\t// Electron has weird conditions under which it throws errors\n\t\t\t\t// e.g. https://github.com/microsoft/vscode/issues/100334 when\n\t\t\t\t// large numbers are passed in\n\t\t\t}\n\n\t\t\tconst defaultState = defaultWindowState();\n\n\t\t\treturn {\n\t\t\t\tmode: WindowMode.Fullscreen,\n\t\t\t\tdisplay: display ? display.id : undefined,\n\n\t\t\t\t// Still carry over window dimensions from previous sessions\n\t\t\t\t// if we can compute it in fullscreen state.\n\t\t\t\t// does not seem possible in all cases on Linux for example\n\t\t\t\t// (https://github.com/microsoft/vscode/issues/58218) so we\n\t\t\t\t// fallback to the defaults in that case.\n\t\t\t\twidth: this.windowState.width || defaultState.width,\n\t\t\t\theight: this.windowState.height || defaultState.height,\n\t\t\t\tx: this.windowState.x || 0,\n\t\t\t\ty: this.windowState.y || 0,\n\t\t\t\tzoomLevel: this.customZoomLevel\n\t\t\t};\n\t\t}\n\n\t\tconst state: IWindowState = Object.create(null);\n\t\tlet mode: WindowMode;\n\n\t\t// get window mode\n\t\tif (!isMacintosh && this._win.isMaximized()) {\n\t\t\tmode = WindowMode.Maximized;\n\t\t} else {\n\t\t\tmode = WindowMode.Normal;\n\t\t}\n\n\t\t// we don't want to save minimized state, only maximized or normal\n\t\tif (mode === WindowMode.Maximized) {\n\t\t\tstate.mode = WindowMode.Maximized;\n\t\t} else {\n\t\t\tstate.mode = WindowMode.Normal;\n\t\t}\n\n\t\t// only consider non-minimized window states\n\t\tif (mode === WindowMode.Normal || mode === WindowMode.Maximized) {\n\t\t\tlet bounds: electron.Rectangle;\n\t\t\tif (mode === WindowMode.Normal) {\n\t\t\t\tbounds = this.getBounds();\n\t\t\t} else {\n\t\t\t\tbounds = this._win.getNormalBounds(); // make sure to persist the normal bounds when maximized to be able to restore them\n\t\t\t}\n\n\t\t\tstate.x = bounds.x;\n\t\t\tstate.y = bounds.y;\n\t\t\tstate.width = bounds.width;\n\t\t\tstate.height = bounds.height;\n\t\t}\n\n\t\tstate.zoomLevel = this.customZoomLevel;\n\n\t\treturn state;\n\t}\n\n\tprivate restoreWindowState(state?: IWindowState): [IWindowState, boolean? /* has multiple displays */] {\n\t\tmark('code/willRestoreCodeWindowState');\n\n\t\tlet hasMultipleDisplays = false;\n\t\tif (state) {\n\n\t\t\t// Window zoom\n\t\t\tthis.customZoomLevel = state.zoomLevel;\n\n\t\t\t// Window dimensions\n\t\t\ttry {\n\t\t\t\tconst displays = electron.screen.getAllDisplays();\n\t\t\t\thasMultipleDisplays = displays.length > 1;\n\n\t\t\t\tstate = WindowStateValidator.validateWindowState(this.logService, state, displays);\n\t\t\t} catch (err) {\n\t\t\t\tthis.logService.warn(`Unexpected error validating window state: ${err}\\n${err.stack}`); // somehow display API can be picky about the state to validate\n\t\t\t}\n\t\t}\n\n\t\tmark('code/didRestoreCodeWindowState');\n\n\t\treturn [state || defaultWindowState(), hasMultipleDisplays];\n\t}\n\n\tgetBounds(): electron.Rectangle {\n\t\tconst [x, y] = this._win.getPosition();\n\t\tconst [width, height] = this._win.getSize();\n\n\t\treturn { x, y, width, height };\n\t}\n\n\tprotected override setFullScreen(fullscreen: boolean, fromRestore: boolean): void {\n\t\tsuper.setFullScreen(fullscreen, fromRestore);\n\n\t\t// Events\n\t\tthis.sendWhenReady(fullscreen ? 'vscode:enterFullScreen' : 'vscode:leaveFullScreen', CancellationToken.None);\n\n\t\t// Respect configured menu bar visibility or default to toggle if not set\n\t\tif (this.currentMenuBarVisibility) {\n\t\t\tthis.setMenuBarVisibility(this.currentMenuBarVisibility, false);\n\t\t}\n\t}\n\n\tprivate getMenuBarVisibility(): MenuBarVisibility {\n\t\tlet menuBarVisibility = getMenuBarVisibility(this.configurationService);\n\t\tif (['visible', 'toggle', 'hidden'].indexOf(menuBarVisibility) < 0) {\n\t\t\tmenuBarVisibility = 'classic';\n\t\t}\n\n\t\treturn menuBarVisibility;\n\t}\n\n\tprivate setMenuBarVisibility(visibility: MenuBarVisibility, notify = true): void {\n\t\tif (isMacintosh) {\n\t\t\treturn; // ignore for macOS platform\n\t\t}\n\n\t\tif (visibility === 'toggle') {\n\t\t\tif (notify) {\n\t\t\t\tthis.send('vscode:showInfoMessage', localize('hiddenMenuBar', \"You can still access the menu bar by pressing the Alt-key.\"));\n\t\t\t}\n\t\t}\n\n\t\tif (visibility === 'hidden') {\n\t\t\t// for some weird reason that I have no explanation for, the menu bar is not hiding when calling\n\t\t\t// this without timeout (see https://github.com/microsoft/vscode/issues/19777). there seems to be\n\t\t\t// a timing issue with us opening the first window and the menu bar getting created. somehow the\n\t\t\t// fact that we want to hide the menu without being able to bring it back via Alt key makes Electron\n\t\t\t// still show the menu. Unable to reproduce from a simple Hello World application though...\n\t\t\tsetTimeout(() => {\n\t\t\t\tthis.doSetMenuBarVisibility(visibility);\n\t\t\t});\n\t\t} else {\n\t\t\tthis.doSetMenuBarVisibility(visibility);\n\t\t}\n\t}\n\n\tprivate doSetMenuBarVisibility(visibility: MenuBarVisibility): void {\n\t\tconst isFullscreen = this.isFullScreen;\n\n\t\tswitch (visibility) {\n\t\t\tcase ('classic'):\n\t\t\t\tthis._win.setMenuBarVisibility(!isFullscreen);\n\t\t\t\tthis._win.autoHideMenuBar = isFullscreen;\n\t\t\t\tbreak;\n\n\t\t\tcase ('visible'):\n\t\t\t\tthis._win.setMenuBarVisibility(true);\n\t\t\t\tthis._win.autoHideMenuBar = false;\n\t\t\t\tbreak;\n\n\t\t\tcase ('toggle'):\n\t\t\t\tthis._win.setMenuBarVisibility(false);\n\t\t\t\tthis._win.autoHideMenuBar = true;\n\t\t\t\tbreak;\n\n\t\t\tcase ('hidden'):\n\t\t\t\tthis._win.setMenuBarVisibility(false);\n\t\t\t\tthis._win.autoHideMenuBar = false;\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tnotifyZoomLevel(zoomLevel: number | undefined): void {\n\t\tthis.customZoomLevel = zoomLevel;\n\t}\n\n\tprivate getZoomLevel(): number | undefined {\n\t\tif (typeof this.customZoomLevel === 'number') {\n\t\t\treturn this.customZoomLevel;\n\t\t}\n\n\t\tconst windowSettings = this.configurationService.getValue<IWindowSettings | undefined>('window');\n\t\treturn windowSettings?.zoomLevel;\n\t}\n\n\tclose(): void {\n\t\tthis._win?.close();\n\t}\n\n\tsendWhenReady(channel: string, token: CancellationToken, ...args: unknown[]): void {\n\t\tif (this.isReady) {\n\t\t\tthis.send(channel, ...args);\n\t\t} else {\n\t\t\tthis.ready().then(() => {\n\t\t\t\tif (!token.isCancellationRequested) {\n\t\t\t\t\tthis.send(channel, ...args);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\tsend(channel: string, ...args: unknown[]): void {\n\t\tif (this._win) {\n\t\t\tif (this._win.isDestroyed() || this._win.webContents.isDestroyed()) {\n\t\t\t\tthis.logService.warn(`Sending IPC message to channel '${channel}' for window that is destroyed`);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\ttry {\n\t\t\t\tthis._win.webContents.send(channel, ...args);\n\t\t\t} catch (error) {\n\t\t\t\tthis.logService.warn(`Error sending IPC message to channel '${channel}' of window ${this._id}: ${toErrorMessage(error)}`);\n\t\t\t}\n\t\t}\n\t}\n\n\tupdateTouchBar(groups: ISerializableCommandAction[][]): void {\n\t\tif (!isMacintosh) {\n\t\t\treturn; // only supported on macOS\n\t\t}\n\n\t\t// Update segments for all groups. Setting the segments property\n\t\t// of the group directly prevents ugly flickering from happening\n\t\tthis.touchBarGroups.forEach((touchBarGroup, index) => {\n\t\t\tconst commands = groups[index];\n\t\t\ttouchBarGroup.segments = this.createTouchBarGroupSegments(commands);\n\t\t});\n\t}\n\n\tprivate createTouchBar(): void {\n\t\tif (!isMacintosh) {\n\t\t\treturn; // only supported on macOS\n\t\t}\n\n\t\t// To avoid flickering, we try to reuse the touch bar group\n\t\t// as much as possible by creating a large number of groups\n\t\t// for reusing later.\n\t\tfor (let i = 0; i < 10; i++) {\n\t\t\tconst groupTouchBar = this.createTouchBarGroup();\n\t\t\tthis.touchBarGroups.push(groupTouchBar);\n\t\t}\n\n\t\tthis._win.setTouchBar(new electron.TouchBar({ items: this.touchBarGroups }));\n\t}\n\n\tprivate createTouchBarGroup(items: ISerializableCommandAction[] = []): electron.TouchBarSegmentedControl {\n\n\t\t// Group Segments\n\t\tconst segments = this.createTouchBarGroupSegments(items);\n\n\t\t// Group Control\n\t\tconst control = new electron.TouchBar.TouchBarSegmentedControl({\n\t\t\tsegments,\n\t\t\tmode: 'buttons',\n\t\t\tsegmentStyle: 'automatic',\n\t\t\tchange: (selectedIndex) => {\n\t\t\t\tthis.sendWhenReady('vscode:runAction', CancellationToken.None, { id: (control.segments[selectedIndex] as ITouchBarSegment).id, from: 'touchbar' });\n\t\t\t}\n\t\t});\n\n\t\treturn control;\n\t}\n\n\tprivate createTouchBarGroupSegments(items: ISerializableCommandAction[] = []): ITouchBarSegment[] {\n\t\tconst segments: ITouchBarSegment[] = items.map(item => {\n\t\t\tlet icon: electron.NativeImage | undefined;\n\t\t\tif (item.icon && !ThemeIcon.isThemeIcon(item.icon) && item.icon?.dark?.scheme === Schemas.file) {\n\t\t\t\ticon = electron.nativeImage.createFromPath(URI.revive(item.icon.dark).fsPath);\n\t\t\t\tif (icon.isEmpty()) {\n\t\t\t\t\ticon = undefined;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tlet title: string;\n\t\t\tif (typeof item.title === 'string') {\n\t\t\t\ttitle = item.title;\n\t\t\t} else {\n\t\t\t\ttitle = item.title.value;\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\tid: item.id,\n\t\t\t\tlabel: !icon ? title : undefined,\n\t\t\t\ticon\n\t\t\t};\n\t\t});\n\n\t\treturn segments;\n\t}\n\n\tprivate async startCollectingJScallStacks(): Promise<void> {\n\t\tif (!this.jsCallStackCollector.isTriggered()) {\n\t\t\tconst stack = await this._win?.webContents.mainFrame.collectJavaScriptCallStack();\n\n\t\t\t// Increment the count for this stack trace\n\t\t\tif (stack) {\n\t\t\t\tconst count = this.jsCallStackMap.get(stack) || 0;\n\t\t\t\tthis.jsCallStackMap.set(stack, count + 1);\n\t\t\t}\n\n\t\t\tthis.jsCallStackCollector.trigger(() => this.startCollectingJScallStacks());\n\t\t}\n\t}\n\n\tprivate stopCollectingJScallStacks(): void {\n\t\tthis.jsCallStackCollectorStopScheduler.cancel();\n\t\tthis.jsCallStackCollector.cancel();\n\n\t\tif (this.jsCallStackMap.size) {\n\t\t\tlet logMessage = `CodeWindow unresponsive samples:\\n`;\n\t\t\tlet samples = 0;\n\n\t\t\tconst sortedEntries = Array.from(this.jsCallStackMap.entries())\n\t\t\t\t.sort((a, b) => b[1] - a[1]);\n\n\t\t\tfor (const [stack, count] of sortedEntries) {\n\t\t\t\tsamples += count;\n\t\t\t\t// If the stack appears more than 20 percent of the time, log it\n\t\t\t\t// to the error telemetry as UnresponsiveSampleError.\n\t\t\t\tif (Math.round((count * 100) / this.jsCallStackEffectiveSampleCount) > 20) {\n\t\t\t\t\tconst fakeError = new UnresponsiveError(stack, this.id, this._win?.webContents.getOSProcessId());\n\t\t\t\t\terrorHandler.onUnexpectedError(fakeError);\n\t\t\t\t}\n\t\t\t\tlogMessage += `<${count}> ${stack}\\n`;\n\t\t\t}\n\n\t\t\tlogMessage += `Total Samples: ${samples}\\n`;\n\t\t\tlogMessage += 'For full overview of the unresponsive period, capture cpu profile via https://aka.ms/vscode-tracing-cpu-profile';\n\t\t\tthis.logService.error(logMessage);\n\t\t}\n\n\t\tthis.jsCallStackMap.clear();\n\t}\n\n\tmatches(webContents: electron.WebContents): boolean {\n\t\treturn this._win?.webContents.id === webContents.id;\n\t}\n\n\toverride dispose(): void {\n\t\tsuper.dispose();\n\n\t\t// Deregister the loggers for this window\n\t\tthis.loggerMainService.deregisterLoggers(this.id);\n\t}\n}\n\nclass UnresponsiveError extends Error {\n\n\tconstructor(sample: string, windowId: number, pid = 0) {\n\t\t// Since the stacks are available via the sample\n\t\t// we can avoid collecting them when constructing the error.\n\t\tconst stackTraceLimit = Error.stackTraceLimit;\n\t\tError.stackTraceLimit = 0;\n\t\tsuper(`UnresponsiveSampleError: from window with ID ${windowId} belonging to process with pid ${pid}`);\n\t\tError.stackTraceLimit = stackTraceLimit;\n\t\tthis.name = 'UnresponsiveSampleError';\n\t\tthis.stack = sample;\n\t}\n}\n"]}