{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/platform/windows/electron-main/windows.ts","vs/platform/windows/electron-main/windows.ts"],"names":[],"mappings":"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","file":"windows.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport electron, { Display, Rectangle } from 'electron';\nimport { Color } from '../../../base/common/color.js';\nimport { Event } from '../../../base/common/event.js';\nimport { join } from '../../../base/common/path.js';\nimport { IProcessEnvironment, isLinux, isMacintosh, isWindows } from '../../../base/common/platform.js';\nimport { URI } from '../../../base/common/uri.js';\nimport { IAuxiliaryWindow } from '../../auxiliaryWindow/electron-main/auxiliaryWindow.js';\nimport { IConfigurationService } from '../../configuration/common/configuration.js';\nimport { NativeParsedArgs } from '../../environment/common/argv.js';\nimport { IEnvironmentMainService } from '../../environment/electron-main/environmentMainService.js';\nimport { ServicesAccessor, createDecorator } from '../../instantiation/common/instantiation.js';\nimport { ILogService } from '../../log/common/log.js';\nimport { IProductService } from '../../product/common/productService.js';\nimport { IThemeMainService } from '../../theme/electron-main/themeMainService.js';\nimport { IOpenEmptyWindowOptions, IWindowOpenable, IWindowSettings, TitlebarStyle, WindowMinimumSize, hasNativeTitlebar, useNativeFullScreen, useWindowControlsOverlay, zoomLevelToZoomFactor } from '../../window/common/window.js';\nimport { ICodeWindow, IWindowState, WindowMode, defaultWindowState } from '../../window/electron-main/window.js';\n\nexport const IWindowsMainService = createDecorator<IWindowsMainService>('windowsMainService');\n\nexport interface IWindowsMainService {\n\n\treadonly _serviceBrand: undefined;\n\n\treadonly onDidChangeWindowsCount: Event<IWindowsCountChangedEvent>;\n\n\treadonly onDidOpenWindow: Event<ICodeWindow>;\n\treadonly onDidSignalReadyWindow: Event<ICodeWindow>;\n\treadonly onDidMaximizeWindow: Event<ICodeWindow>;\n\treadonly onDidUnmaximizeWindow: Event<ICodeWindow>;\n\treadonly onDidChangeFullScreen: Event<{ window: ICodeWindow; fullscreen: boolean }>;\n\treadonly onDidTriggerSystemContextMenu: Event<{ readonly window: ICodeWindow; readonly x: number; readonly y: number }>;\n\treadonly onDidDestroyWindow: Event<ICodeWindow>;\n\n\topen(openConfig: IOpenConfiguration): Promise<ICodeWindow[]>;\n\topenEmptyWindow(openConfig: IOpenEmptyConfiguration, options?: IOpenEmptyWindowOptions): Promise<ICodeWindow[]>;\n\topenExtensionDevelopmentHostWindow(extensionDevelopmentPath: string[], openConfig: IOpenConfiguration): Promise<ICodeWindow[]>;\n\n\topenExistingWindow(window: ICodeWindow, openConfig: IOpenConfiguration): void;\n\n\tsendToFocused(channel: string, ...args: unknown[]): void;\n\tsendToOpeningWindow(channel: string, ...args: unknown[]): void;\n\tsendToAll(channel: string, payload?: unknown, windowIdsToIgnore?: number[]): void;\n\n\tgetWindows(): ICodeWindow[];\n\tgetWindowCount(): number;\n\n\tgetFocusedWindow(): ICodeWindow | undefined;\n\tgetLastActiveWindow(): ICodeWindow | undefined;\n\n\tgetWindowById(windowId: number): ICodeWindow | undefined;\n\tgetWindowByWebContents(webContents: electron.WebContents): ICodeWindow | undefined;\n}\n\nexport interface IWindowsCountChangedEvent {\n\treadonly oldCount: number;\n\treadonly newCount: number;\n}\n\nexport const enum OpenContext {\n\n\t// opening when running from the command line\n\tCLI,\n\n\t// macOS only: opening from the dock (also when opening files to a running instance from desktop)\n\tDOCK,\n\n\t// opening from the main application window\n\tMENU,\n\n\t// opening from a file or folder dialog\n\tDIALOG,\n\n\t// opening from the OS's UI\n\tDESKTOP,\n\n\t// opening through the API\n\tAPI,\n\n\t// opening from a protocol link\n\tLINK\n}\n\nexport interface IBaseOpenConfiguration {\n\treadonly context: OpenContext;\n\treadonly contextWindowId?: number;\n}\n\nexport interface IOpenConfiguration extends IBaseOpenConfiguration {\n\treadonly cli: NativeParsedArgs;\n\treadonly userEnv?: IProcessEnvironment;\n\treadonly urisToOpen?: IWindowOpenable[];\n\treadonly waitMarkerFileURI?: URI;\n\treadonly preferNewWindow?: boolean;\n\treadonly forceNewWindow?: boolean;\n\treadonly forceNewTabbedWindow?: boolean;\n\treadonly forceReuseWindow?: boolean;\n\treadonly forceEmpty?: boolean;\n\treadonly diffMode?: boolean;\n\treadonly mergeMode?: boolean;\n\taddMode?: boolean;\n\tremoveMode?: boolean;\n\treadonly gotoLineMode?: boolean;\n\treadonly initialStartup?: boolean;\n\treadonly noRecentEntry?: boolean;\n\t/**\n\t * The remote authority to use when windows are opened with either\n\t * - no workspace (empty window)\n\t * - a workspace that is neither `file://` nor `vscode-remote://`\n\t */\n\treadonly remoteAuthority?: string;\n\treadonly forceProfile?: string;\n\treadonly forceTempProfile?: boolean;\n}\n\nexport interface IOpenEmptyConfiguration extends IBaseOpenConfiguration { }\n\nexport interface IDefaultBrowserWindowOptionsOverrides {\n\tforceNativeTitlebar?: boolean;\n\tdisableFullscreen?: boolean;\n\talwaysOnTop?: boolean;\n}\n\nexport function defaultBrowserWindowOptions(accessor: ServicesAccessor, windowState: IWindowState, overrides?: IDefaultBrowserWindowOptionsOverrides, webPreferences?: electron.WebPreferences): electron.BrowserWindowConstructorOptions & { experimentalDarkMode: boolean } {\n\tconst themeMainService = accessor.get(IThemeMainService);\n\tconst productService = accessor.get(IProductService);\n\tconst configurationService = accessor.get(IConfigurationService);\n\tconst environmentMainService = accessor.get(IEnvironmentMainService);\n\n\tconst windowSettings = configurationService.getValue<IWindowSettings | undefined>('window');\n\n\tconst options: electron.BrowserWindowConstructorOptions & { experimentalDarkMode: boolean; accentColor?: boolean | string } = {\n\t\tbackgroundColor: themeMainService.getBackgroundColor(),\n\t\tminWidth: WindowMinimumSize.WIDTH,\n\t\tminHeight: WindowMinimumSize.HEIGHT,\n\t\ttitle: productService.nameLong,\n\t\tshow: windowState.mode !== WindowMode.Maximized && windowState.mode !== WindowMode.Fullscreen, // reduce flicker by showing later\n\t\tx: windowState.x,\n\t\ty: windowState.y,\n\t\twidth: windowState.width,\n\t\theight: windowState.height,\n\t\twebPreferences: {\n\t\t\t...webPreferences,\n\t\t\tenableWebSQL: false,\n\t\t\tspellcheck: false,\n\t\t\tzoomFactor: zoomLevelToZoomFactor(windowState.zoomLevel ?? windowSettings?.zoomLevel),\n\t\t\tautoplayPolicy: 'user-gesture-required',\n\t\t\t// Enable experimental css highlight api https://chromestatus.com/feature/5436441440026624\n\t\t\t// Refs https://github.com/microsoft/vscode/issues/140098\n\t\t\tenableBlinkFeatures: 'HighlightAPI',\n\t\t\tsandbox: true,\n\t\t\t// TODO(deepak1556): Should be removed once migration is complete\n\t\t\t// https://github.com/microsoft/vscode/issues/239228\n\t\t\tenableDeprecatedPaste: true,\n\t\t},\n\t\texperimentalDarkMode: true\n\t};\n\n\tif (isWindows) {\n\t\tlet borderSetting = windowSettings?.border || 'default';\n\t\tif (borderSetting === 'system') {\n\t\t\tborderSetting = 'default';\n\t\t}\n\t\tif (borderSetting !== 'default') {\n\t\t\tif (borderSetting === 'off') {\n\t\t\t\toptions.accentColor = false;\n\t\t\t} else if (typeof borderSetting === 'string') {\n\t\t\t\toptions.accentColor = borderSetting;\n\t\t\t}\n\t\t}\n\t}\n\n\tif (isLinux) {\n\t\toptions.icon = join(environmentMainService.appRoot, 'resources/linux/code.png'); // always on Linux\n\t} else if (isWindows && !environmentMainService.isBuilt) {\n\t\toptions.icon = join(environmentMainService.appRoot, 'resources/win32/code_150x150.png'); // only when running out of sources on Windows\n\t}\n\n\tif (isMacintosh) {\n\t\toptions.acceptFirstMouse = true; // enabled by default\n\n\t\tif (windowSettings?.clickThroughInactive === false) {\n\t\t\toptions.acceptFirstMouse = false;\n\t\t}\n\t}\n\n\tif (overrides?.disableFullscreen) {\n\t\toptions.fullscreen = false;\n\t} else if (isMacintosh && !useNativeFullScreen(configurationService)) {\n\t\toptions.fullscreenable = false; // enables simple fullscreen mode\n\t}\n\n\tconst useNativeTabs = isMacintosh && windowSettings?.nativeTabs === true;\n\tif (useNativeTabs) {\n\t\toptions.tabbingIdentifier = productService.nameShort; // this opts in to sierra tabs\n\t}\n\n\tconst hideNativeTitleBar = !hasNativeTitlebar(configurationService, overrides?.forceNativeTitlebar ? TitlebarStyle.NATIVE : undefined);\n\tif (hideNativeTitleBar) {\n\t\toptions.titleBarStyle = 'hidden';\n\t\tif (!isMacintosh) {\n\t\t\toptions.frame = false;\n\t\t}\n\n\t\tif (useWindowControlsOverlay(configurationService)) {\n\t\t\tif (isMacintosh) {\n\t\t\t\toptions.titleBarOverlay = true;\n\t\t\t} else {\n\n\t\t\t\t// This logic will not perfectly guess the right colors\n\t\t\t\t// to use on initialization, but prefer to keep things\n\t\t\t\t// simple as it is temporary and not noticeable\n\n\t\t\t\tconst titleBarColor = themeMainService.getWindowSplash(undefined)?.colorInfo.titleBarBackground ?? themeMainService.getBackgroundColor();\n\t\t\t\tconst symbolColor = Color.fromHex(titleBarColor).isDarker() ? '#FFFFFF' : '#000000';\n\n\t\t\t\toptions.titleBarOverlay = {\n\t\t\t\t\theight: 29, // the smallest size of the title bar on windows accounting for the border on windows 11\n\t\t\t\t\tcolor: titleBarColor,\n\t\t\t\t\tsymbolColor\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\t}\n\n\tif (overrides?.alwaysOnTop) {\n\t\toptions.alwaysOnTop = true;\n\t}\n\n\treturn options;\n}\n\nexport function getLastFocused(windows: ICodeWindow[]): ICodeWindow | undefined;\nexport function getLastFocused(windows: IAuxiliaryWindow[]): IAuxiliaryWindow | undefined;\nexport function getLastFocused(windows: ICodeWindow[] | IAuxiliaryWindow[]): ICodeWindow | IAuxiliaryWindow | undefined {\n\tlet lastFocusedWindow: ICodeWindow | IAuxiliaryWindow | undefined = undefined;\n\tlet maxLastFocusTime = Number.MIN_VALUE;\n\n\tfor (const window of windows) {\n\t\tif (window.lastFocusTime > maxLastFocusTime) {\n\t\t\tmaxLastFocusTime = window.lastFocusTime;\n\t\t\tlastFocusedWindow = window;\n\t\t}\n\t}\n\n\treturn lastFocusedWindow;\n}\n\nexport namespace WindowStateValidator {\n\n\texport function validateWindowState(logService: ILogService, state: IWindowState, displays = electron.screen.getAllDisplays()): IWindowState | undefined {\n\t\tlogService.trace(`window#validateWindowState: validating window state on ${displays.length} display(s)`, state);\n\n\t\tif (\n\t\t\ttypeof state.x !== 'number' ||\n\t\t\ttypeof state.y !== 'number' ||\n\t\t\ttypeof state.width !== 'number' ||\n\t\t\ttypeof state.height !== 'number'\n\t\t) {\n\t\t\tlogService.trace('window#validateWindowState: unexpected type of state values');\n\n\t\t\treturn undefined;\n\t\t}\n\n\t\tif (state.width <= 0 || state.height <= 0) {\n\t\t\tlogService.trace('window#validateWindowState: unexpected negative values');\n\n\t\t\treturn undefined;\n\t\t}\n\n\t\t// Single Monitor: be strict about x/y positioning\n\t\t// macOS & Linux: these OS seem to be pretty good in ensuring that a window is never outside of it's bounds.\n\t\t// Windows: it is possible to have a window with a size that makes it fall out of the window. our strategy\n\t\t//          is to try as much as possible to keep the window in the monitor bounds. we are not as strict as\n\t\t//          macOS and Linux and allow the window to exceed the monitor bounds as long as the window is still\n\t\t//          some pixels (128) visible on the screen for the user to drag it back.\n\t\tif (displays.length === 1) {\n\t\t\tconst displayWorkingArea = getWorkingArea(displays[0]);\n\t\t\tlogService.trace('window#validateWindowState: single monitor working area', displayWorkingArea);\n\n\t\t\tif (displayWorkingArea) {\n\n\t\t\t\tfunction ensureStateInDisplayWorkingArea(): void {\n\t\t\t\t\tif (!state || typeof state.x !== 'number' || typeof state.y !== 'number' || !displayWorkingArea) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (state.x < displayWorkingArea.x) {\n\t\t\t\t\t\t// prevent window from falling out of the screen to the left\n\t\t\t\t\t\tstate.x = displayWorkingArea.x;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (state.y < displayWorkingArea.y) {\n\t\t\t\t\t\t// prevent window from falling out of the screen to the top\n\t\t\t\t\t\tstate.y = displayWorkingArea.y;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// ensure state is not outside display working area (top, left)\n\t\t\t\tensureStateInDisplayWorkingArea();\n\n\t\t\t\tif (state.width > displayWorkingArea.width) {\n\t\t\t\t\t// prevent window from exceeding display bounds width\n\t\t\t\t\tstate.width = displayWorkingArea.width;\n\t\t\t\t}\n\n\t\t\t\tif (state.height > displayWorkingArea.height) {\n\t\t\t\t\t// prevent window from exceeding display bounds height\n\t\t\t\t\tstate.height = displayWorkingArea.height;\n\t\t\t\t}\n\n\t\t\t\tif (state.x > (displayWorkingArea.x + displayWorkingArea.width - 128)) {\n\t\t\t\t\t// prevent window from falling out of the screen to the right with\n\t\t\t\t\t// 128px margin by positioning the window to the far right edge of\n\t\t\t\t\t// the screen\n\t\t\t\t\tstate.x = displayWorkingArea.x + displayWorkingArea.width - state.width;\n\t\t\t\t}\n\n\t\t\t\tif (state.y > (displayWorkingArea.y + displayWorkingArea.height - 128)) {\n\t\t\t\t\t// prevent window from falling out of the screen to the bottom with\n\t\t\t\t\t// 128px margin by positioning the window to the far bottom edge of\n\t\t\t\t\t// the screen\n\t\t\t\t\tstate.y = displayWorkingArea.y + displayWorkingArea.height - state.height;\n\t\t\t\t}\n\n\t\t\t\t// again ensure state is not outside display working area\n\t\t\t\t// (it may have changed from the previous validation step)\n\t\t\t\tensureStateInDisplayWorkingArea();\n\t\t\t}\n\n\t\t\treturn state;\n\t\t}\n\n\t\t// Multi Montior (fullscreen): try to find the previously used display\n\t\tif (state.display && state.mode === WindowMode.Fullscreen) {\n\t\t\tconst display = displays.find(d => d.id === state.display);\n\t\t\tif (display && typeof display.bounds?.x === 'number' && typeof display.bounds?.y === 'number') {\n\t\t\t\tlogService.trace('window#validateWindowState: restoring fullscreen to previous display');\n\n\t\t\t\tconst defaults = defaultWindowState(WindowMode.Fullscreen); // make sure we have good values when the user restores the window\n\t\t\t\tdefaults.x = display.bounds.x; // carefull to use displays x/y position so that the window ends up on the correct monitor\n\t\t\t\tdefaults.y = display.bounds.y;\n\n\t\t\t\treturn defaults;\n\t\t\t}\n\t\t}\n\n\t\t// Multi Monitor (non-fullscreen): ensure window is within display bounds\n\t\tlet display: electron.Display | undefined;\n\t\tlet displayWorkingArea: electron.Rectangle | undefined;\n\t\ttry {\n\t\t\tdisplay = electron.screen.getDisplayMatching({ x: state.x, y: state.y, width: state.width, height: state.height });\n\t\t\tdisplayWorkingArea = getWorkingArea(display);\n\n\t\t\tlogService.trace('window#validateWindowState: multi-monitor working area', displayWorkingArea);\n\t\t} catch (error) {\n\t\t\t// Electron has weird conditions under which it throws errors\n\t\t\t// e.g. https://github.com/microsoft/vscode/issues/100334 when\n\t\t\t// large numbers are passed in\n\t\t\tlogService.error('window#validateWindowState: error finding display for window state', error);\n\t\t}\n\n\t\tif (display && validateWindowStateOnDisplay(state, display)) {\n\t\t\treturn state;\n\t\t}\n\n\t\tlogService.trace('window#validateWindowState: state is outside of the multi-monitor working area');\n\n\t\treturn undefined;\n\t}\n\n\texport function validateWindowStateOnDisplay(state: IWindowState, display: Display): state is Rectangle {\n\t\tif (\n\t\t\ttypeof state.x !== 'number' ||\n\t\t\ttypeof state.y !== 'number' ||\n\t\t\ttypeof state.width !== 'number' ||\n\t\t\ttypeof state.height !== 'number' ||\n\t\t\tstate.width <= 0 || state.height <= 0\n\t\t) {\n\t\t\treturn false;\n\t\t}\n\n\t\tconst displayWorkingArea = getWorkingArea(display);\n\t\treturn Boolean(\n\t\t\tdisplayWorkingArea &&\t\t\t\t\t\t\t\t\t\t\t// we have valid working area bounds\n\t\t\tstate.x + state.width > displayWorkingArea.x &&\t\t\t\t\t// prevent window from falling out of the screen to the left\n\t\t\tstate.y + state.height > displayWorkingArea.y &&\t\t\t\t// prevent window from falling out of the screen to the top\n\t\t\tstate.x < displayWorkingArea.x + displayWorkingArea.width &&\t// prevent window from falling out of the screen to the right\n\t\t\tstate.y < displayWorkingArea.y + displayWorkingArea.height\t\t// prevent window from falling out of the screen to the bottom\n\t\t);\n\t}\n\n\tfunction getWorkingArea(display: electron.Display): electron.Rectangle | undefined {\n\n\t\t// Prefer the working area of the display to account for taskbars on the\n\t\t// desktop being positioned somewhere (https://github.com/microsoft/vscode/issues/50830).\n\t\t//\n\t\t// Linux X11 sessions sometimes report wrong display bounds, so we validate\n\t\t// the reported sizes are positive.\n\t\tif (display.workArea.width > 0 && display.workArea.height > 0) {\n\t\t\treturn display.workArea;\n\t\t}\n\n\t\tif (display.bounds.width > 0 && display.bounds.height > 0) {\n\t\t\treturn display.bounds;\n\t\t}\n\n\t\treturn undefined;\n\t}\n}\n\n/**\n * We have some components like `NativeWebContentExtractorService` that create offscreen windows\n * to extract content from web pages. These windows are not visible to the user and are not\n * considered part of the main application window. This function filters out those offscreen\n * windows from the list of all windows.\n * @returns An array of all BrowserWindow instances that are not offscreen.\n */\nexport function getAllWindowsExcludingOffscreen() {\n\treturn electron.BrowserWindow.getAllWindows().filter(win => !win.webContents.isOffscreen());\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport electron, { Display, Rectangle } from 'electron';\nimport { Color } from '../../../base/common/color.js';\nimport { Event } from '../../../base/common/event.js';\nimport { join } from '../../../base/common/path.js';\nimport { IProcessEnvironment, isLinux, isMacintosh, isWindows } from '../../../base/common/platform.js';\nimport { URI } from '../../../base/common/uri.js';\nimport { IAuxiliaryWindow } from '../../auxiliaryWindow/electron-main/auxiliaryWindow.js';\nimport { IConfigurationService } from '../../configuration/common/configuration.js';\nimport { NativeParsedArgs } from '../../environment/common/argv.js';\nimport { IEnvironmentMainService } from '../../environment/electron-main/environmentMainService.js';\nimport { ServicesAccessor, createDecorator } from '../../instantiation/common/instantiation.js';\nimport { ILogService } from '../../log/common/log.js';\nimport { IProductService } from '../../product/common/productService.js';\nimport { IThemeMainService } from '../../theme/electron-main/themeMainService.js';\nimport { IOpenEmptyWindowOptions, IWindowOpenable, IWindowSettings, TitlebarStyle, WindowMinimumSize, hasNativeTitlebar, useNativeFullScreen, useWindowControlsOverlay, zoomLevelToZoomFactor } from '../../window/common/window.js';\nimport { ICodeWindow, IWindowState, WindowMode, defaultWindowState } from '../../window/electron-main/window.js';\n\nexport const IWindowsMainService = createDecorator<IWindowsMainService>('windowsMainService');\n\nexport interface IWindowsMainService {\n\n\treadonly _serviceBrand: undefined;\n\n\treadonly onDidChangeWindowsCount: Event<IWindowsCountChangedEvent>;\n\n\treadonly onDidOpenWindow: Event<ICodeWindow>;\n\treadonly onDidSignalReadyWindow: Event<ICodeWindow>;\n\treadonly onDidMaximizeWindow: Event<ICodeWindow>;\n\treadonly onDidUnmaximizeWindow: Event<ICodeWindow>;\n\treadonly onDidChangeFullScreen: Event<{ window: ICodeWindow; fullscreen: boolean }>;\n\treadonly onDidTriggerSystemContextMenu: Event<{ readonly window: ICodeWindow; readonly x: number; readonly y: number }>;\n\treadonly onDidDestroyWindow: Event<ICodeWindow>;\n\n\topen(openConfig: IOpenConfiguration): Promise<ICodeWindow[]>;\n\topenEmptyWindow(openConfig: IOpenEmptyConfiguration, options?: IOpenEmptyWindowOptions): Promise<ICodeWindow[]>;\n\topenExtensionDevelopmentHostWindow(extensionDevelopmentPath: string[], openConfig: IOpenConfiguration): Promise<ICodeWindow[]>;\n\n\topenExistingWindow(window: ICodeWindow, openConfig: IOpenConfiguration): void;\n\n\tsendToFocused(channel: string, ...args: unknown[]): void;\n\tsendToOpeningWindow(channel: string, ...args: unknown[]): void;\n\tsendToAll(channel: string, payload?: unknown, windowIdsToIgnore?: number[]): void;\n\n\tgetWindows(): ICodeWindow[];\n\tgetWindowCount(): number;\n\n\tgetFocusedWindow(): ICodeWindow | undefined;\n\tgetLastActiveWindow(): ICodeWindow | undefined;\n\n\tgetWindowById(windowId: number): ICodeWindow | undefined;\n\tgetWindowByWebContents(webContents: electron.WebContents): ICodeWindow | undefined;\n}\n\nexport interface IWindowsCountChangedEvent {\n\treadonly oldCount: number;\n\treadonly newCount: number;\n}\n\nexport const enum OpenContext {\n\n\t// opening when running from the command line\n\tCLI,\n\n\t// macOS only: opening from the dock (also when opening files to a running instance from desktop)\n\tDOCK,\n\n\t// opening from the main application window\n\tMENU,\n\n\t// opening from a file or folder dialog\n\tDIALOG,\n\n\t// opening from the OS's UI\n\tDESKTOP,\n\n\t// opening through the API\n\tAPI,\n\n\t// opening from a protocol link\n\tLINK\n}\n\nexport interface IBaseOpenConfiguration {\n\treadonly context: OpenContext;\n\treadonly contextWindowId?: number;\n}\n\nexport interface IOpenConfiguration extends IBaseOpenConfiguration {\n\treadonly cli: NativeParsedArgs;\n\treadonly userEnv?: IProcessEnvironment;\n\treadonly urisToOpen?: IWindowOpenable[];\n\treadonly waitMarkerFileURI?: URI;\n\treadonly preferNewWindow?: boolean;\n\treadonly forceNewWindow?: boolean;\n\treadonly forceNewTabbedWindow?: boolean;\n\treadonly forceReuseWindow?: boolean;\n\treadonly forceEmpty?: boolean;\n\treadonly diffMode?: boolean;\n\treadonly mergeMode?: boolean;\n\taddMode?: boolean;\n\tremoveMode?: boolean;\n\treadonly gotoLineMode?: boolean;\n\treadonly initialStartup?: boolean;\n\treadonly noRecentEntry?: boolean;\n\t/**\n\t * The remote authority to use when windows are opened with either\n\t * - no workspace (empty window)\n\t * - a workspace that is neither `file://` nor `vscode-remote://`\n\t */\n\treadonly remoteAuthority?: string;\n\treadonly forceProfile?: string;\n\treadonly forceTempProfile?: boolean;\n}\n\nexport interface IOpenEmptyConfiguration extends IBaseOpenConfiguration { }\n\nexport interface IDefaultBrowserWindowOptionsOverrides {\n\tforceNativeTitlebar?: boolean;\n\tdisableFullscreen?: boolean;\n\talwaysOnTop?: boolean;\n}\n\nexport function defaultBrowserWindowOptions(accessor: ServicesAccessor, windowState: IWindowState, overrides?: IDefaultBrowserWindowOptionsOverrides, webPreferences?: electron.WebPreferences): electron.BrowserWindowConstructorOptions & { experimentalDarkMode: boolean } {\n\tconst themeMainService = accessor.get(IThemeMainService);\n\tconst productService = accessor.get(IProductService);\n\tconst configurationService = accessor.get(IConfigurationService);\n\tconst environmentMainService = accessor.get(IEnvironmentMainService);\n\n\tconst windowSettings = configurationService.getValue<IWindowSettings | undefined>('window');\n\n\tconst options: electron.BrowserWindowConstructorOptions & { experimentalDarkMode: boolean; accentColor?: boolean | string } = {\n\t\tbackgroundColor: themeMainService.getBackgroundColor(),\n\t\tminWidth: WindowMinimumSize.WIDTH,\n\t\tminHeight: WindowMinimumSize.HEIGHT,\n\t\ttitle: productService.nameLong,\n\t\tshow: windowState.mode !== WindowMode.Maximized && windowState.mode !== WindowMode.Fullscreen, // reduce flicker by showing later\n\t\tx: windowState.x,\n\t\ty: windowState.y,\n\t\twidth: windowState.width,\n\t\theight: windowState.height,\n\t\twebPreferences: {\n\t\t\t...webPreferences,\n\t\t\tenableWebSQL: false,\n\t\t\tspellcheck: false,\n\t\t\tzoomFactor: zoomLevelToZoomFactor(windowState.zoomLevel ?? windowSettings?.zoomLevel),\n\t\t\tautoplayPolicy: 'user-gesture-required',\n\t\t\t// Enable experimental css highlight api https://chromestatus.com/feature/5436441440026624\n\t\t\t// Refs https://github.com/microsoft/vscode/issues/140098\n\t\t\tenableBlinkFeatures: 'HighlightAPI',\n\t\t\tsandbox: true,\n\t\t\t// TODO(deepak1556): Should be removed once migration is complete\n\t\t\t// https://github.com/microsoft/vscode/issues/239228\n\t\t\tenableDeprecatedPaste: true,\n\t\t},\n\t\texperimentalDarkMode: true\n\t};\n\n\tif (isWindows) {\n\t\tlet borderSetting = windowSettings?.border || 'default';\n\t\tif (borderSetting === 'system') {\n\t\t\tborderSetting = 'default';\n\t\t}\n\t\tif (borderSetting !== 'default') {\n\t\t\tif (borderSetting === 'off') {\n\t\t\t\toptions.accentColor = false;\n\t\t\t} else if (typeof borderSetting === 'string') {\n\t\t\t\toptions.accentColor = borderSetting;\n\t\t\t}\n\t\t}\n\t}\n\n\tif (isLinux) {\n\t\toptions.icon = join(environmentMainService.appRoot, 'resources/linux/code.png'); // always on Linux\n\t} else if (isWindows && !environmentMainService.isBuilt) {\n\t\toptions.icon = join(environmentMainService.appRoot, 'resources/win32/code_150x150.png'); // only when running out of sources on Windows\n\t}\n\n\tif (isMacintosh) {\n\t\toptions.acceptFirstMouse = true; // enabled by default\n\n\t\tif (windowSettings?.clickThroughInactive === false) {\n\t\t\toptions.acceptFirstMouse = false;\n\t\t}\n\t}\n\n\tif (overrides?.disableFullscreen) {\n\t\toptions.fullscreen = false;\n\t} else if (isMacintosh && !useNativeFullScreen(configurationService)) {\n\t\toptions.fullscreenable = false; // enables simple fullscreen mode\n\t}\n\n\tconst useNativeTabs = isMacintosh && windowSettings?.nativeTabs === true;\n\tif (useNativeTabs) {\n\t\toptions.tabbingIdentifier = productService.nameShort; // this opts in to sierra tabs\n\t}\n\n\tconst hideNativeTitleBar = !hasNativeTitlebar(configurationService, overrides?.forceNativeTitlebar ? TitlebarStyle.NATIVE : undefined);\n\tif (hideNativeTitleBar) {\n\t\toptions.titleBarStyle = 'hidden';\n\t\tif (!isMacintosh) {\n\t\t\toptions.frame = false;\n\t\t}\n\n\t\tif (useWindowControlsOverlay(configurationService)) {\n\t\t\tif (isMacintosh) {\n\t\t\t\toptions.titleBarOverlay = true;\n\t\t\t} else {\n\n\t\t\t\t// This logic will not perfectly guess the right colors\n\t\t\t\t// to use on initialization, but prefer to keep things\n\t\t\t\t// simple as it is temporary and not noticeable\n\n\t\t\t\tconst titleBarColor = themeMainService.getWindowSplash(undefined)?.colorInfo.titleBarBackground ?? themeMainService.getBackgroundColor();\n\t\t\t\tconst symbolColor = Color.fromHex(titleBarColor).isDarker() ? '#FFFFFF' : '#000000';\n\n\t\t\t\toptions.titleBarOverlay = {\n\t\t\t\t\theight: 29, // the smallest size of the title bar on windows accounting for the border on windows 11\n\t\t\t\t\tcolor: titleBarColor,\n\t\t\t\t\tsymbolColor\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\t}\n\n\tif (overrides?.alwaysOnTop) {\n\t\toptions.alwaysOnTop = true;\n\t}\n\n\treturn options;\n}\n\nexport function getLastFocused(windows: ICodeWindow[]): ICodeWindow | undefined;\nexport function getLastFocused(windows: IAuxiliaryWindow[]): IAuxiliaryWindow | undefined;\nexport function getLastFocused(windows: ICodeWindow[] | IAuxiliaryWindow[]): ICodeWindow | IAuxiliaryWindow | undefined {\n\tlet lastFocusedWindow: ICodeWindow | IAuxiliaryWindow | undefined = undefined;\n\tlet maxLastFocusTime = Number.MIN_VALUE;\n\n\tfor (const window of windows) {\n\t\tif (window.lastFocusTime > maxLastFocusTime) {\n\t\t\tmaxLastFocusTime = window.lastFocusTime;\n\t\t\tlastFocusedWindow = window;\n\t\t}\n\t}\n\n\treturn lastFocusedWindow;\n}\n\nexport namespace WindowStateValidator {\n\n\texport function validateWindowState(logService: ILogService, state: IWindowState, displays = electron.screen.getAllDisplays()): IWindowState | undefined {\n\t\tlogService.trace(`window#validateWindowState: validating window state on ${displays.length} display(s)`, state);\n\n\t\tif (\n\t\t\ttypeof state.x !== 'number' ||\n\t\t\ttypeof state.y !== 'number' ||\n\t\t\ttypeof state.width !== 'number' ||\n\t\t\ttypeof state.height !== 'number'\n\t\t) {\n\t\t\tlogService.trace('window#validateWindowState: unexpected type of state values');\n\n\t\t\treturn undefined;\n\t\t}\n\n\t\tif (state.width <= 0 || state.height <= 0) {\n\t\t\tlogService.trace('window#validateWindowState: unexpected negative values');\n\n\t\t\treturn undefined;\n\t\t}\n\n\t\t// Single Monitor: be strict about x/y positioning\n\t\t// macOS & Linux: these OS seem to be pretty good in ensuring that a window is never outside of it's bounds.\n\t\t// Windows: it is possible to have a window with a size that makes it fall out of the window. our strategy\n\t\t//          is to try as much as possible to keep the window in the monitor bounds. we are not as strict as\n\t\t//          macOS and Linux and allow the window to exceed the monitor bounds as long as the window is still\n\t\t//          some pixels (128) visible on the screen for the user to drag it back.\n\t\tif (displays.length === 1) {\n\t\t\tconst displayWorkingArea = getWorkingArea(displays[0]);\n\t\t\tlogService.trace('window#validateWindowState: single monitor working area', displayWorkingArea);\n\n\t\t\tif (displayWorkingArea) {\n\n\t\t\t\tfunction ensureStateInDisplayWorkingArea(): void {\n\t\t\t\t\tif (!state || typeof state.x !== 'number' || typeof state.y !== 'number' || !displayWorkingArea) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (state.x < displayWorkingArea.x) {\n\t\t\t\t\t\t// prevent window from falling out of the screen to the left\n\t\t\t\t\t\tstate.x = displayWorkingArea.x;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (state.y < displayWorkingArea.y) {\n\t\t\t\t\t\t// prevent window from falling out of the screen to the top\n\t\t\t\t\t\tstate.y = displayWorkingArea.y;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// ensure state is not outside display working area (top, left)\n\t\t\t\tensureStateInDisplayWorkingArea();\n\n\t\t\t\tif (state.width > displayWorkingArea.width) {\n\t\t\t\t\t// prevent window from exceeding display bounds width\n\t\t\t\t\tstate.width = displayWorkingArea.width;\n\t\t\t\t}\n\n\t\t\t\tif (state.height > displayWorkingArea.height) {\n\t\t\t\t\t// prevent window from exceeding display bounds height\n\t\t\t\t\tstate.height = displayWorkingArea.height;\n\t\t\t\t}\n\n\t\t\t\tif (state.x > (displayWorkingArea.x + displayWorkingArea.width - 128)) {\n\t\t\t\t\t// prevent window from falling out of the screen to the right with\n\t\t\t\t\t// 128px margin by positioning the window to the far right edge of\n\t\t\t\t\t// the screen\n\t\t\t\t\tstate.x = displayWorkingArea.x + displayWorkingArea.width - state.width;\n\t\t\t\t}\n\n\t\t\t\tif (state.y > (displayWorkingArea.y + displayWorkingArea.height - 128)) {\n\t\t\t\t\t// prevent window from falling out of the screen to the bottom with\n\t\t\t\t\t// 128px margin by positioning the window to the far bottom edge of\n\t\t\t\t\t// the screen\n\t\t\t\t\tstate.y = displayWorkingArea.y + displayWorkingArea.height - state.height;\n\t\t\t\t}\n\n\t\t\t\t// again ensure state is not outside display working area\n\t\t\t\t// (it may have changed from the previous validation step)\n\t\t\t\tensureStateInDisplayWorkingArea();\n\t\t\t}\n\n\t\t\treturn state;\n\t\t}\n\n\t\t// Multi Montior (fullscreen): try to find the previously used display\n\t\tif (state.display && state.mode === WindowMode.Fullscreen) {\n\t\t\tconst display = displays.find(d => d.id === state.display);\n\t\t\tif (display && typeof display.bounds?.x === 'number' && typeof display.bounds?.y === 'number') {\n\t\t\t\tlogService.trace('window#validateWindowState: restoring fullscreen to previous display');\n\n\t\t\t\tconst defaults = defaultWindowState(WindowMode.Fullscreen); // make sure we have good values when the user restores the window\n\t\t\t\tdefaults.x = display.bounds.x; // carefull to use displays x/y position so that the window ends up on the correct monitor\n\t\t\t\tdefaults.y = display.bounds.y;\n\n\t\t\t\treturn defaults;\n\t\t\t}\n\t\t}\n\n\t\t// Multi Monitor (non-fullscreen): ensure window is within display bounds\n\t\tlet display: electron.Display | undefined;\n\t\tlet displayWorkingArea: electron.Rectangle | undefined;\n\t\ttry {\n\t\t\tdisplay = electron.screen.getDisplayMatching({ x: state.x, y: state.y, width: state.width, height: state.height });\n\t\t\tdisplayWorkingArea = getWorkingArea(display);\n\n\t\t\tlogService.trace('window#validateWindowState: multi-monitor working area', displayWorkingArea);\n\t\t} catch (error) {\n\t\t\t// Electron has weird conditions under which it throws errors\n\t\t\t// e.g. https://github.com/microsoft/vscode/issues/100334 when\n\t\t\t// large numbers are passed in\n\t\t\tlogService.error('window#validateWindowState: error finding display for window state', error);\n\t\t}\n\n\t\tif (display && validateWindowStateOnDisplay(state, display)) {\n\t\t\treturn state;\n\t\t}\n\n\t\tlogService.trace('window#validateWindowState: state is outside of the multi-monitor working area');\n\n\t\treturn undefined;\n\t}\n\n\texport function validateWindowStateOnDisplay(state: IWindowState, display: Display): state is Rectangle {\n\t\tif (\n\t\t\ttypeof state.x !== 'number' ||\n\t\t\ttypeof state.y !== 'number' ||\n\t\t\ttypeof state.width !== 'number' ||\n\t\t\ttypeof state.height !== 'number' ||\n\t\t\tstate.width <= 0 || state.height <= 0\n\t\t) {\n\t\t\treturn false;\n\t\t}\n\n\t\tconst displayWorkingArea = getWorkingArea(display);\n\t\treturn Boolean(\n\t\t\tdisplayWorkingArea &&\t\t\t\t\t\t\t\t\t\t\t// we have valid working area bounds\n\t\t\tstate.x + state.width > displayWorkingArea.x &&\t\t\t\t\t// prevent window from falling out of the screen to the left\n\t\t\tstate.y + state.height > displayWorkingArea.y &&\t\t\t\t// prevent window from falling out of the screen to the top\n\t\t\tstate.x < displayWorkingArea.x + displayWorkingArea.width &&\t// prevent window from falling out of the screen to the right\n\t\t\tstate.y < displayWorkingArea.y + displayWorkingArea.height\t\t// prevent window from falling out of the screen to the bottom\n\t\t);\n\t}\n\n\tfunction getWorkingArea(display: electron.Display): electron.Rectangle | undefined {\n\n\t\t// Prefer the working area of the display to account for taskbars on the\n\t\t// desktop being positioned somewhere (https://github.com/microsoft/vscode/issues/50830).\n\t\t//\n\t\t// Linux X11 sessions sometimes report wrong display bounds, so we validate\n\t\t// the reported sizes are positive.\n\t\tif (display.workArea.width > 0 && display.workArea.height > 0) {\n\t\t\treturn display.workArea;\n\t\t}\n\n\t\tif (display.bounds.width > 0 && display.bounds.height > 0) {\n\t\t\treturn display.bounds;\n\t\t}\n\n\t\treturn undefined;\n\t}\n}\n\n/**\n * We have some components like `NativeWebContentExtractorService` that create offscreen windows\n * to extract content from web pages. These windows are not visible to the user and are not\n * considered part of the main application window. This function filters out those offscreen\n * windows from the list of all windows.\n * @returns An array of all BrowserWindow instances that are not offscreen.\n */\nexport function getAllWindowsExcludingOffscreen() {\n\treturn electron.BrowserWindow.getAllWindows().filter(win => !win.webContents.isOffscreen());\n}\n"]}