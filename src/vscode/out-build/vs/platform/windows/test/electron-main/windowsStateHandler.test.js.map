{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/platform/windows/test/electron-main/windowsStateHandler.test.ts","vs/platform/windows/test/electron-main/windowsStateHandler.test.ts"],"names":[],"mappings":"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","file":"windowsStateHandler.test.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport assert from 'assert';\nimport { tmpdir } from 'os';\nimport { join } from '../../../../base/common/path.js';\nimport { URI } from '../../../../base/common/uri.js';\nimport { ensureNoDisposablesAreLeakedInTestSuite } from '../../../../base/test/common/utils.js';\nimport { IWindowState as IWindowUIState, WindowMode } from '../../../window/electron-main/window.js';\nimport { getWindowsStateStoreData, IWindowsState, IWindowState, restoreWindowsState } from '../../electron-main/windowsStateHandler.js';\nimport { IWorkspaceIdentifier } from '../../../workspace/common/workspace.js';\n\nsuite('Windows State Storing', () => {\n\n\tfunction getUIState(): IWindowUIState {\n\t\treturn {\n\t\t\tx: 0,\n\t\t\ty: 10,\n\t\t\twidth: 100,\n\t\t\theight: 200,\n\t\t\tmode: 0\n\t\t};\n\t}\n\n\tfunction toWorkspace(uri: URI): IWorkspaceIdentifier {\n\t\treturn {\n\t\t\tid: '1234',\n\t\t\tconfigPath: uri\n\t\t};\n\t}\n\tfunction assertEqualURI(u1: URI | undefined, u2: URI | undefined, message?: string): void {\n\t\tassert.strictEqual(u1 && u1.toString(), u2 && u2.toString(), message);\n\t}\n\n\tfunction assertEqualWorkspace(w1: IWorkspaceIdentifier | undefined, w2: IWorkspaceIdentifier | undefined, message?: string): void {\n\t\tif (!w1 || !w2) {\n\t\t\tassert.strictEqual(w1, w2, message);\n\t\t\treturn;\n\t\t}\n\t\tassert.strictEqual(w1.id, w2.id, message);\n\t\tassertEqualURI(w1.configPath, w2.configPath, message);\n\t}\n\n\tfunction assertEqualWindowState(expected: IWindowState | undefined, actual: IWindowState | undefined, message?: string) {\n\t\tif (!expected || !actual) {\n\t\t\tassert.deepStrictEqual(expected, actual, message);\n\t\t\treturn;\n\t\t}\n\t\tassert.strictEqual(expected.backupPath, actual.backupPath, message);\n\t\tassertEqualURI(expected.folderUri, actual.folderUri, message);\n\t\tassert.strictEqual(expected.remoteAuthority, actual.remoteAuthority, message);\n\t\tassertEqualWorkspace(expected.workspace, actual.workspace, message);\n\t\tassert.deepStrictEqual(expected.uiState, actual.uiState, message);\n\t}\n\n\tfunction assertEqualWindowsState(expected: IWindowsState, actual: IWindowsState, message?: string) {\n\t\tassertEqualWindowState(expected.lastPluginDevelopmentHostWindow, actual.lastPluginDevelopmentHostWindow, message);\n\t\tassertEqualWindowState(expected.lastActiveWindow, actual.lastActiveWindow, message);\n\t\tassert.strictEqual(expected.openedWindows.length, actual.openedWindows.length, message);\n\t\tfor (let i = 0; i < expected.openedWindows.length; i++) {\n\t\t\tassertEqualWindowState(expected.openedWindows[i], actual.openedWindows[i], message);\n\t\t}\n\t}\n\n\tfunction assertRestoring(state: IWindowsState, message?: string) {\n\t\tconst stored = getWindowsStateStoreData(state);\n\t\tconst restored = restoreWindowsState(stored);\n\t\tassertEqualWindowsState(state, restored, message);\n\t}\n\n\tconst testBackupPath1 = join(tmpdir(), 'windowStateTest', 'backupFolder1');\n\tconst testBackupPath2 = join(tmpdir(), 'windowStateTest', 'backupFolder2');\n\n\tconst testWSPath = URI.file(join(tmpdir(), 'windowStateTest', 'test.code-workspace'));\n\tconst testFolderURI = URI.file(join(tmpdir(), 'windowStateTest', 'testFolder'));\n\n\tconst testRemoteFolderURI = URI.parse('foo://bar/c/d');\n\n\ttest('storing and restoring', () => {\n\t\tlet windowState: IWindowsState;\n\t\twindowState = {\n\t\t\topenedWindows: []\n\t\t};\n\t\tassertRestoring(windowState, 'no windows');\n\t\twindowState = {\n\t\t\topenedWindows: [{ backupPath: testBackupPath1, uiState: getUIState() }]\n\t\t};\n\t\tassertRestoring(windowState, 'empty workspace');\n\n\t\twindowState = {\n\t\t\topenedWindows: [{ backupPath: testBackupPath1, uiState: getUIState(), workspace: toWorkspace(testWSPath) }]\n\t\t};\n\t\tassertRestoring(windowState, 'workspace');\n\n\t\twindowState = {\n\t\t\topenedWindows: [{ backupPath: testBackupPath2, uiState: getUIState(), folderUri: testFolderURI }]\n\t\t};\n\t\tassertRestoring(windowState, 'folder');\n\n\t\twindowState = {\n\t\t\topenedWindows: [{ backupPath: testBackupPath1, uiState: getUIState(), folderUri: testFolderURI }, { backupPath: testBackupPath1, uiState: getUIState(), folderUri: testRemoteFolderURI, remoteAuthority: 'bar' }]\n\t\t};\n\t\tassertRestoring(windowState, 'multiple windows');\n\n\t\twindowState = {\n\t\t\tlastActiveWindow: { backupPath: testBackupPath2, uiState: getUIState(), folderUri: testFolderURI },\n\t\t\topenedWindows: []\n\t\t};\n\t\tassertRestoring(windowState, 'lastActiveWindow');\n\n\t\twindowState = {\n\t\t\tlastPluginDevelopmentHostWindow: { backupPath: testBackupPath2, uiState: getUIState(), folderUri: testFolderURI },\n\t\t\topenedWindows: []\n\t\t};\n\t\tassertRestoring(windowState, 'lastPluginDevelopmentHostWindow');\n\t});\n\n\ttest('open 1_32', () => {\n\t\tconst v1_32_workspace = `{\n\t\t\t\"openedWindows\": [],\n\t\t\t\"lastActiveWindow\": {\n\t\t\t\t\"workspaceIdentifier\": {\n\t\t\t\t\t\"id\": \"53b714b46ef1a2d4346568b4f591028c\",\n\t\t\t\t\t\"configURIPath\": \"file:///home/user/workspaces/testing/custom.code-workspace\"\n\t\t\t\t},\n\t\t\t\t\"backupPath\": \"/home/user/.config/code-oss-dev/Backups/53b714b46ef1a2d4346568b4f591028c\",\n\t\t\t\t\"uiState\": {\n\t\t\t\t\t\"mode\": 0,\n\t\t\t\t\t\"x\": 0,\n\t\t\t\t\t\"y\": 27,\n\t\t\t\t\t\"width\": 2560,\n\t\t\t\t\t\"height\": 1364\n\t\t\t\t}\n\t\t\t}\n\t\t}`;\n\n\t\tlet windowsState = restoreWindowsState(JSON.parse(v1_32_workspace));\n\t\tlet expected: IWindowsState = {\n\t\t\topenedWindows: [],\n\t\t\tlastActiveWindow: {\n\t\t\t\tbackupPath: '/home/user/.config/code-oss-dev/Backups/53b714b46ef1a2d4346568b4f591028c',\n\t\t\t\tuiState: { mode: WindowMode.Maximized, x: 0, y: 27, width: 2560, height: 1364 },\n\t\t\t\tworkspace: { id: '53b714b46ef1a2d4346568b4f591028c', configPath: URI.parse('file:///home/user/workspaces/testing/custom.code-workspace') }\n\t\t\t}\n\t\t};\n\n\t\tassertEqualWindowsState(expected, windowsState, 'v1_32_workspace');\n\n\t\tconst v1_32_folder = `{\n\t\t\t\"openedWindows\": [],\n\t\t\t\"lastActiveWindow\": {\n\t\t\t\t\"folder\": \"file:///home/user/workspaces/testing/folding\",\n\t\t\t\t\"backupPath\": \"/home/user/.config/code-oss-dev/Backups/1daac1621c6c06f9e916ac8062e5a1b5\",\n\t\t\t\t\"uiState\": {\n\t\t\t\t\t\"mode\": 1,\n\t\t\t\t\t\"x\": 625,\n\t\t\t\t\t\"y\": 263,\n\t\t\t\t\t\"width\": 1718,\n\t\t\t\t\t\"height\": 953\n\t\t\t\t}\n\t\t\t}\n\t\t}`;\n\n\t\twindowsState = restoreWindowsState(JSON.parse(v1_32_folder));\n\t\texpected = {\n\t\t\topenedWindows: [],\n\t\t\tlastActiveWindow: {\n\t\t\t\tbackupPath: '/home/user/.config/code-oss-dev/Backups/1daac1621c6c06f9e916ac8062e5a1b5',\n\t\t\t\tuiState: { mode: WindowMode.Normal, x: 625, y: 263, width: 1718, height: 953 },\n\t\t\t\tfolderUri: URI.parse('file:///home/user/workspaces/testing/folding')\n\t\t\t}\n\t\t};\n\t\tassertEqualWindowsState(expected, windowsState, 'v1_32_folder');\n\n\t\tconst v1_32_empty_window = ` {\n\t\t\t\"openedWindows\": [\n\t\t\t],\n\t\t\t\"lastActiveWindow\": {\n\t\t\t\t\"backupPath\": \"/home/user/.config/code-oss-dev/Backups/1549539668998\",\n\t\t\t\t\"uiState\": {\n\t\t\t\t\t\"mode\": 1,\n\t\t\t\t\t\"x\": 768,\n\t\t\t\t\t\"y\": 336,\n\t\t\t\t\t\"width\": 1200,\n\t\t\t\t\t\"height\": 800\n\t\t\t\t}\n\t\t\t}\n\t\t}`;\n\n\t\twindowsState = restoreWindowsState(JSON.parse(v1_32_empty_window));\n\t\texpected = {\n\t\t\topenedWindows: [],\n\t\t\tlastActiveWindow: {\n\t\t\t\tbackupPath: '/home/user/.config/code-oss-dev/Backups/1549539668998',\n\t\t\t\tuiState: { mode: WindowMode.Normal, x: 768, y: 336, width: 1200, height: 800 }\n\t\t\t}\n\t\t};\n\t\tassertEqualWindowsState(expected, windowsState, 'v1_32_empty_window');\n\t});\n\n\tensureNoDisposablesAreLeakedInTestSuite();\n});\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport assert from 'assert';\nimport { tmpdir } from 'os';\nimport { join } from '../../../../base/common/path.js';\nimport { URI } from '../../../../base/common/uri.js';\nimport { ensureNoDisposablesAreLeakedInTestSuite } from '../../../../base/test/common/utils.js';\nimport { IWindowState as IWindowUIState, WindowMode } from '../../../window/electron-main/window.js';\nimport { getWindowsStateStoreData, IWindowsState, IWindowState, restoreWindowsState } from '../../electron-main/windowsStateHandler.js';\nimport { IWorkspaceIdentifier } from '../../../workspace/common/workspace.js';\n\nsuite('Windows State Storing', () => {\n\n\tfunction getUIState(): IWindowUIState {\n\t\treturn {\n\t\t\tx: 0,\n\t\t\ty: 10,\n\t\t\twidth: 100,\n\t\t\theight: 200,\n\t\t\tmode: 0\n\t\t};\n\t}\n\n\tfunction toWorkspace(uri: URI): IWorkspaceIdentifier {\n\t\treturn {\n\t\t\tid: '1234',\n\t\t\tconfigPath: uri\n\t\t};\n\t}\n\tfunction assertEqualURI(u1: URI | undefined, u2: URI | undefined, message?: string): void {\n\t\tassert.strictEqual(u1 && u1.toString(), u2 && u2.toString(), message);\n\t}\n\n\tfunction assertEqualWorkspace(w1: IWorkspaceIdentifier | undefined, w2: IWorkspaceIdentifier | undefined, message?: string): void {\n\t\tif (!w1 || !w2) {\n\t\t\tassert.strictEqual(w1, w2, message);\n\t\t\treturn;\n\t\t}\n\t\tassert.strictEqual(w1.id, w2.id, message);\n\t\tassertEqualURI(w1.configPath, w2.configPath, message);\n\t}\n\n\tfunction assertEqualWindowState(expected: IWindowState | undefined, actual: IWindowState | undefined, message?: string) {\n\t\tif (!expected || !actual) {\n\t\t\tassert.deepStrictEqual(expected, actual, message);\n\t\t\treturn;\n\t\t}\n\t\tassert.strictEqual(expected.backupPath, actual.backupPath, message);\n\t\tassertEqualURI(expected.folderUri, actual.folderUri, message);\n\t\tassert.strictEqual(expected.remoteAuthority, actual.remoteAuthority, message);\n\t\tassertEqualWorkspace(expected.workspace, actual.workspace, message);\n\t\tassert.deepStrictEqual(expected.uiState, actual.uiState, message);\n\t}\n\n\tfunction assertEqualWindowsState(expected: IWindowsState, actual: IWindowsState, message?: string) {\n\t\tassertEqualWindowState(expected.lastPluginDevelopmentHostWindow, actual.lastPluginDevelopmentHostWindow, message);\n\t\tassertEqualWindowState(expected.lastActiveWindow, actual.lastActiveWindow, message);\n\t\tassert.strictEqual(expected.openedWindows.length, actual.openedWindows.length, message);\n\t\tfor (let i = 0; i < expected.openedWindows.length; i++) {\n\t\t\tassertEqualWindowState(expected.openedWindows[i], actual.openedWindows[i], message);\n\t\t}\n\t}\n\n\tfunction assertRestoring(state: IWindowsState, message?: string) {\n\t\tconst stored = getWindowsStateStoreData(state);\n\t\tconst restored = restoreWindowsState(stored);\n\t\tassertEqualWindowsState(state, restored, message);\n\t}\n\n\tconst testBackupPath1 = join(tmpdir(), 'windowStateTest', 'backupFolder1');\n\tconst testBackupPath2 = join(tmpdir(), 'windowStateTest', 'backupFolder2');\n\n\tconst testWSPath = URI.file(join(tmpdir(), 'windowStateTest', 'test.code-workspace'));\n\tconst testFolderURI = URI.file(join(tmpdir(), 'windowStateTest', 'testFolder'));\n\n\tconst testRemoteFolderURI = URI.parse('foo://bar/c/d');\n\n\ttest('storing and restoring', () => {\n\t\tlet windowState: IWindowsState;\n\t\twindowState = {\n\t\t\topenedWindows: []\n\t\t};\n\t\tassertRestoring(windowState, 'no windows');\n\t\twindowState = {\n\t\t\topenedWindows: [{ backupPath: testBackupPath1, uiState: getUIState() }]\n\t\t};\n\t\tassertRestoring(windowState, 'empty workspace');\n\n\t\twindowState = {\n\t\t\topenedWindows: [{ backupPath: testBackupPath1, uiState: getUIState(), workspace: toWorkspace(testWSPath) }]\n\t\t};\n\t\tassertRestoring(windowState, 'workspace');\n\n\t\twindowState = {\n\t\t\topenedWindows: [{ backupPath: testBackupPath2, uiState: getUIState(), folderUri: testFolderURI }]\n\t\t};\n\t\tassertRestoring(windowState, 'folder');\n\n\t\twindowState = {\n\t\t\topenedWindows: [{ backupPath: testBackupPath1, uiState: getUIState(), folderUri: testFolderURI }, { backupPath: testBackupPath1, uiState: getUIState(), folderUri: testRemoteFolderURI, remoteAuthority: 'bar' }]\n\t\t};\n\t\tassertRestoring(windowState, 'multiple windows');\n\n\t\twindowState = {\n\t\t\tlastActiveWindow: { backupPath: testBackupPath2, uiState: getUIState(), folderUri: testFolderURI },\n\t\t\topenedWindows: []\n\t\t};\n\t\tassertRestoring(windowState, 'lastActiveWindow');\n\n\t\twindowState = {\n\t\t\tlastPluginDevelopmentHostWindow: { backupPath: testBackupPath2, uiState: getUIState(), folderUri: testFolderURI },\n\t\t\topenedWindows: []\n\t\t};\n\t\tassertRestoring(windowState, 'lastPluginDevelopmentHostWindow');\n\t});\n\n\ttest('open 1_32', () => {\n\t\tconst v1_32_workspace = `{\n\t\t\t\"openedWindows\": [],\n\t\t\t\"lastActiveWindow\": {\n\t\t\t\t\"workspaceIdentifier\": {\n\t\t\t\t\t\"id\": \"53b714b46ef1a2d4346568b4f591028c\",\n\t\t\t\t\t\"configURIPath\": \"file:///home/user/workspaces/testing/custom.code-workspace\"\n\t\t\t\t},\n\t\t\t\t\"backupPath\": \"/home/user/.config/code-oss-dev/Backups/53b714b46ef1a2d4346568b4f591028c\",\n\t\t\t\t\"uiState\": {\n\t\t\t\t\t\"mode\": 0,\n\t\t\t\t\t\"x\": 0,\n\t\t\t\t\t\"y\": 27,\n\t\t\t\t\t\"width\": 2560,\n\t\t\t\t\t\"height\": 1364\n\t\t\t\t}\n\t\t\t}\n\t\t}`;\n\n\t\tlet windowsState = restoreWindowsState(JSON.parse(v1_32_workspace));\n\t\tlet expected: IWindowsState = {\n\t\t\topenedWindows: [],\n\t\t\tlastActiveWindow: {\n\t\t\t\tbackupPath: '/home/user/.config/code-oss-dev/Backups/53b714b46ef1a2d4346568b4f591028c',\n\t\t\t\tuiState: { mode: WindowMode.Maximized, x: 0, y: 27, width: 2560, height: 1364 },\n\t\t\t\tworkspace: { id: '53b714b46ef1a2d4346568b4f591028c', configPath: URI.parse('file:///home/user/workspaces/testing/custom.code-workspace') }\n\t\t\t}\n\t\t};\n\n\t\tassertEqualWindowsState(expected, windowsState, 'v1_32_workspace');\n\n\t\tconst v1_32_folder = `{\n\t\t\t\"openedWindows\": [],\n\t\t\t\"lastActiveWindow\": {\n\t\t\t\t\"folder\": \"file:///home/user/workspaces/testing/folding\",\n\t\t\t\t\"backupPath\": \"/home/user/.config/code-oss-dev/Backups/1daac1621c6c06f9e916ac8062e5a1b5\",\n\t\t\t\t\"uiState\": {\n\t\t\t\t\t\"mode\": 1,\n\t\t\t\t\t\"x\": 625,\n\t\t\t\t\t\"y\": 263,\n\t\t\t\t\t\"width\": 1718,\n\t\t\t\t\t\"height\": 953\n\t\t\t\t}\n\t\t\t}\n\t\t}`;\n\n\t\twindowsState = restoreWindowsState(JSON.parse(v1_32_folder));\n\t\texpected = {\n\t\t\topenedWindows: [],\n\t\t\tlastActiveWindow: {\n\t\t\t\tbackupPath: '/home/user/.config/code-oss-dev/Backups/1daac1621c6c06f9e916ac8062e5a1b5',\n\t\t\t\tuiState: { mode: WindowMode.Normal, x: 625, y: 263, width: 1718, height: 953 },\n\t\t\t\tfolderUri: URI.parse('file:///home/user/workspaces/testing/folding')\n\t\t\t}\n\t\t};\n\t\tassertEqualWindowsState(expected, windowsState, 'v1_32_folder');\n\n\t\tconst v1_32_empty_window = ` {\n\t\t\t\"openedWindows\": [\n\t\t\t],\n\t\t\t\"lastActiveWindow\": {\n\t\t\t\t\"backupPath\": \"/home/user/.config/code-oss-dev/Backups/1549539668998\",\n\t\t\t\t\"uiState\": {\n\t\t\t\t\t\"mode\": 1,\n\t\t\t\t\t\"x\": 768,\n\t\t\t\t\t\"y\": 336,\n\t\t\t\t\t\"width\": 1200,\n\t\t\t\t\t\"height\": 800\n\t\t\t\t}\n\t\t\t}\n\t\t}`;\n\n\t\twindowsState = restoreWindowsState(JSON.parse(v1_32_empty_window));\n\t\texpected = {\n\t\t\topenedWindows: [],\n\t\t\tlastActiveWindow: {\n\t\t\t\tbackupPath: '/home/user/.config/code-oss-dev/Backups/1549539668998',\n\t\t\t\tuiState: { mode: WindowMode.Normal, x: 768, y: 336, width: 1200, height: 800 }\n\t\t\t}\n\t\t};\n\t\tassertEqualWindowsState(expected, windowsState, 'v1_32_empty_window');\n\t});\n\n\tensureNoDisposablesAreLeakedInTestSuite();\n});\n"]}