{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/platform/storage/electron-main/storageMainService.ts","vs/platform/storage/electron-main/storageMainService.ts"],"names":[],"mappings":"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","file":"storageMainService.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { URI } from '../../../base/common/uri.js';\nimport { Emitter, Event } from '../../../base/common/event.js';\nimport { Disposable } from '../../../base/common/lifecycle.js';\nimport { IStorage } from '../../../base/parts/storage/common/storage.js';\nimport { IEnvironmentService } from '../../environment/common/environment.js';\nimport { IFileService } from '../../files/common/files.js';\nimport { createDecorator } from '../../instantiation/common/instantiation.js';\nimport { ILifecycleMainService, LifecycleMainPhase, ShutdownReason } from '../../lifecycle/electron-main/lifecycleMainService.js';\nimport { ILogService } from '../../log/common/log.js';\nimport { AbstractStorageService, isProfileUsingDefaultStorage, IStorageService, StorageScope, StorageTarget } from '../common/storage.js';\nimport { ApplicationStorageMain, ProfileStorageMain, InMemoryStorageMain, IStorageMain, IStorageMainOptions, WorkspaceStorageMain, IStorageChangeEvent } from './storageMain.js';\nimport { IUserDataProfile, IUserDataProfilesService } from '../../userDataProfile/common/userDataProfile.js';\nimport { IUserDataProfilesMainService } from '../../userDataProfile/electron-main/userDataProfile.js';\nimport { IAnyWorkspaceIdentifier } from '../../workspace/common/workspace.js';\nimport { IUriIdentityService } from '../../uriIdentity/common/uriIdentity.js';\nimport { Schemas } from '../../../base/common/network.js';\n\n//#region Storage Main Service (intent: make application, profile and workspace storage accessible to windows from main process)\n\nexport const IStorageMainService = createDecorator<IStorageMainService>('storageMainService');\n\nexport interface IProfileStorageChangeEvent extends IStorageChangeEvent {\n\treadonly storage: IStorageMain;\n\treadonly profile: IUserDataProfile;\n}\n\nexport interface IStorageMainService {\n\n\treadonly _serviceBrand: undefined;\n\n\t/**\n\t * Provides access to the application storage shared across all\n\t * windows and all profiles.\n\t *\n\t * Note: DO NOT use this for reading/writing from the main process!\n\t *       Rather use `IApplicationStorageMainService` for that purpose.\n\t */\n\treadonly applicationStorage: IStorageMain;\n\n\t/**\n\t * Emitted whenever data is updated or deleted in profile scoped storage.\n\t */\n\treadonly onDidChangeProfileStorage: Event<IProfileStorageChangeEvent>;\n\n\t/**\n\t * Provides access to the profile storage shared across all windows\n\t * for the provided profile.\n\t *\n\t * Note: DO NOT use this for reading/writing from the main process!\n\t *       This is currently not supported.\n\t */\n\tprofileStorage(profile: IUserDataProfile): IStorageMain;\n\n\t/**\n\t * Provides access to the workspace storage specific to a single window.\n\t *\n\t * Note: DO NOT use this for reading/writing from the main process!\n\t *       This is currently not supported.\n\t */\n\tworkspaceStorage(workspace: IAnyWorkspaceIdentifier): IStorageMain;\n\n\t/**\n\t * Checks if the provided path is currently in use for a storage database.\n\t *\n\t * @param path the path to the storage file or parent folder\n\t */\n\tisUsed(path: string): boolean;\n}\n\nexport class StorageMainService extends Disposable implements IStorageMainService {\n\n\tdeclare readonly _serviceBrand: undefined;\n\n\tprivate shutdownReason: ShutdownReason | undefined = undefined;\n\n\tprivate readonly _onDidChangeProfileStorage = this._register(new Emitter<IProfileStorageChangeEvent>());\n\treadonly onDidChangeProfileStorage = this._onDidChangeProfileStorage.event;\n\n\tconstructor(\n\t\t@ILogService private readonly logService: ILogService,\n\t\t@IEnvironmentService private readonly environmentService: IEnvironmentService,\n\t\t@IUserDataProfilesMainService private readonly userDataProfilesService: IUserDataProfilesMainService,\n\t\t@ILifecycleMainService private readonly lifecycleMainService: ILifecycleMainService,\n\t\t@IFileService private readonly fileService: IFileService,\n\t\t@IUriIdentityService private readonly uriIdentityService: IUriIdentityService\n\t) {\n\t\tsuper();\n\n\t\tthis.applicationStorage = this._register(this.createApplicationStorage());\n\n\t\tthis.registerListeners();\n\t}\n\n\tprotected getStorageOptions(): IStorageMainOptions {\n\t\treturn {\n\t\t\tuseInMemoryStorage: !!this.environmentService.extensionTestsLocationURI // no storage during extension tests!\n\t\t};\n\t}\n\n\tprivate registerListeners(): void {\n\n\t\t// Application Storage: Warmup when any window opens\n\t\t(async () => {\n\t\t\tawait this.lifecycleMainService.when(LifecycleMainPhase.AfterWindowOpen);\n\n\t\t\tthis.applicationStorage.init();\n\t\t})();\n\n\t\tthis._register(this.lifecycleMainService.onWillLoadWindow(e => {\n\n\t\t\t// Profile Storage: Warmup when related window with profile loads\n\t\t\tif (e.window.profile) {\n\t\t\t\tthis.profileStorage(e.window.profile).init();\n\t\t\t}\n\n\t\t\t// Workspace Storage: Warmup when related window with workspace loads\n\t\t\tif (e.workspace) {\n\t\t\t\tthis.workspaceStorage(e.workspace).init();\n\t\t\t}\n\t\t}));\n\n\t\t// All Storage: Close when shutting down\n\t\tthis._register(this.lifecycleMainService.onWillShutdown(e => {\n\t\t\tthis.logService.trace('storageMainService#onWillShutdown()');\n\n\t\t\t// Remember shutdown reason\n\t\t\tthis.shutdownReason = e.reason;\n\n\t\t\t// Application Storage\n\t\t\te.join('applicationStorage', this.applicationStorage.close());\n\n\t\t\t// Profile Storage(s)\n\t\t\tfor (const [, profileStorage] of this.mapProfileToStorage) {\n\t\t\t\te.join('profileStorage', profileStorage.close());\n\t\t\t}\n\n\t\t\t// Workspace Storage(s)\n\t\t\tfor (const [, workspaceStorage] of this.mapWorkspaceToStorage) {\n\t\t\t\te.join('workspaceStorage', workspaceStorage.close());\n\t\t\t}\n\t\t}));\n\n\t\t// Prepare storage location as needed\n\t\tthis._register(this.userDataProfilesService.onWillCreateProfile(e => {\n\t\t\te.join((async () => {\n\t\t\t\tif (!(await this.fileService.exists(e.profile.globalStorageHome))) {\n\t\t\t\t\tawait this.fileService.createFolder(e.profile.globalStorageHome);\n\t\t\t\t}\n\t\t\t})());\n\t\t}));\n\n\t\t// Close the storage of the profile that is being removed\n\t\tthis._register(this.userDataProfilesService.onWillRemoveProfile(e => {\n\t\t\tconst storage = this.mapProfileToStorage.get(e.profile.id);\n\t\t\tif (storage) {\n\t\t\t\te.join(storage.close());\n\t\t\t}\n\t\t}));\n\t}\n\n\t//#region Application Storage\n\n\treadonly applicationStorage: IStorageMain;\n\n\tprivate createApplicationStorage(): IStorageMain {\n\t\tthis.logService.trace(`StorageMainService: creating application storage`);\n\n\t\tconst applicationStorage = new ApplicationStorageMain(this.getStorageOptions(), this.userDataProfilesService, this.logService, this.fileService);\n\n\t\tthis._register(Event.once(applicationStorage.onDidCloseStorage)(() => {\n\t\t\tthis.logService.trace(`StorageMainService: closed application storage`);\n\t\t}));\n\n\t\treturn applicationStorage;\n\t}\n\n\t//#endregion\n\n\t//#region Profile Storage\n\n\tprivate readonly mapProfileToStorage = new Map<string /* profile ID */, IStorageMain>();\n\n\tprofileStorage(profile: IUserDataProfile): IStorageMain {\n\t\tif (isProfileUsingDefaultStorage(profile)) {\n\t\t\treturn this.applicationStorage; // for profiles using default storage, use application storage\n\t\t}\n\n\t\tlet profileStorage = this.mapProfileToStorage.get(profile.id);\n\t\tif (!profileStorage) {\n\t\t\tthis.logService.trace(`StorageMainService: creating profile storage (${profile.name})`);\n\n\t\t\tprofileStorage = this._register(this.createProfileStorage(profile));\n\t\t\tthis.mapProfileToStorage.set(profile.id, profileStorage);\n\n\t\t\tconst listener = this._register(profileStorage.onDidChangeStorage(e => this._onDidChangeProfileStorage.fire({\n\t\t\t\t...e,\n\t\t\t\tstorage: profileStorage!,\n\t\t\t\tprofile\n\t\t\t})));\n\n\t\t\tthis._register(Event.once(profileStorage.onDidCloseStorage)(() => {\n\t\t\t\tthis.logService.trace(`StorageMainService: closed profile storage (${profile.name})`);\n\n\t\t\t\tthis.mapProfileToStorage.delete(profile.id);\n\t\t\t\tlistener.dispose();\n\t\t\t}));\n\t\t}\n\n\t\treturn profileStorage;\n\t}\n\n\tprivate createProfileStorage(profile: IUserDataProfile): IStorageMain {\n\t\tif (this.shutdownReason === ShutdownReason.KILL) {\n\n\t\t\t// Workaround for native crashes that we see when\n\t\t\t// SQLite DBs are being created even after shutdown\n\t\t\t// https://github.com/microsoft/vscode/issues/143186\n\n\t\t\treturn new InMemoryStorageMain(this.logService, this.fileService);\n\t\t}\n\n\t\treturn new ProfileStorageMain(profile, this.getStorageOptions(), this.logService, this.fileService);\n\t}\n\n\t//#endregion\n\n\n\t//#region Workspace Storage\n\n\tprivate readonly mapWorkspaceToStorage = new Map<string /* workspace ID */, IStorageMain>();\n\n\tworkspaceStorage(workspace: IAnyWorkspaceIdentifier): IStorageMain {\n\t\tlet workspaceStorage = this.mapWorkspaceToStorage.get(workspace.id);\n\t\tif (!workspaceStorage) {\n\t\t\tthis.logService.trace(`StorageMainService: creating workspace storage (${workspace.id})`);\n\n\t\t\tworkspaceStorage = this._register(this.createWorkspaceStorage(workspace));\n\t\t\tthis.mapWorkspaceToStorage.set(workspace.id, workspaceStorage);\n\n\t\t\tthis._register(Event.once(workspaceStorage.onDidCloseStorage)(() => {\n\t\t\t\tthis.logService.trace(`StorageMainService: closed workspace storage (${workspace.id})`);\n\n\t\t\t\tthis.mapWorkspaceToStorage.delete(workspace.id);\n\t\t\t}));\n\t\t}\n\n\t\treturn workspaceStorage;\n\t}\n\n\tprivate createWorkspaceStorage(workspace: IAnyWorkspaceIdentifier): IStorageMain {\n\t\tif (this.shutdownReason === ShutdownReason.KILL) {\n\n\t\t\t// Workaround for native crashes that we see when\n\t\t\t// SQLite DBs are being created even after shutdown\n\t\t\t// https://github.com/microsoft/vscode/issues/143186\n\n\t\t\treturn new InMemoryStorageMain(this.logService, this.fileService);\n\t\t}\n\n\t\treturn new WorkspaceStorageMain(workspace, this.getStorageOptions(), this.logService, this.environmentService, this.fileService);\n\t}\n\n\t//#endregion\n\n\tisUsed(path: string): boolean {\n\t\tconst pathUri = URI.file(path);\n\n\t\tfor (const storage of [this.applicationStorage, ...this.mapProfileToStorage.values(), ...this.mapWorkspaceToStorage.values()]) {\n\t\t\tif (!storage.path) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif (this.uriIdentityService.extUri.isEqualOrParent(URI.file(storage.path), pathUri)) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\n\t\treturn false;\n\t}\n}\n\n//#endregion\n\n\n//#region Application Main Storage Service (intent: use application storage from main process)\n\nexport const IApplicationStorageMainService = createDecorator<IStorageMainService>('applicationStorageMainService');\n\n/**\n * A specialized `IStorageService` interface that only allows\n * access to the `StorageScope.APPLICATION` scope.\n */\nexport interface IApplicationStorageMainService extends IStorageService {\n\n\t/**\n\t * Important: unlike other storage services in the renderer, the\n\t * main process does not await the storage to be ready, rather\n\t * storage is being initialized while a window opens to reduce\n\t * pressure on startup.\n\t *\n\t * As such, any client wanting to access application storage from the\n\t * main process needs to wait for `whenReady`, otherwise there is\n\t * a chance that the service operates on an in-memory store that\n\t * is not backed by any persistent DB.\n\t */\n\treadonly whenReady: Promise<void>;\n\n\tget(key: string, scope: StorageScope.APPLICATION, fallbackValue: string): string;\n\tget(key: string, scope: StorageScope.APPLICATION, fallbackValue?: string): string | undefined;\n\n\tgetBoolean(key: string, scope: StorageScope.APPLICATION, fallbackValue: boolean): boolean;\n\tgetBoolean(key: string, scope: StorageScope.APPLICATION, fallbackValue?: boolean): boolean | undefined;\n\n\tgetNumber(key: string, scope: StorageScope.APPLICATION, fallbackValue: number): number;\n\tgetNumber(key: string, scope: StorageScope.APPLICATION, fallbackValue?: number): number | undefined;\n\n\tstore(key: string, value: string | boolean | number | undefined | null, scope: StorageScope.APPLICATION, target: StorageTarget): void;\n\n\tremove(key: string, scope: StorageScope.APPLICATION): void;\n\n\tkeys(scope: StorageScope.APPLICATION, target: StorageTarget): string[];\n\n\tswitch(): never;\n\n\tisNew(scope: StorageScope.APPLICATION): boolean;\n}\n\nexport class ApplicationStorageMainService extends AbstractStorageService implements IApplicationStorageMainService {\n\n\tdeclare readonly _serviceBrand: undefined;\n\n\treadonly whenReady: Promise<void>;\n\n\tconstructor(\n\t\t@IUserDataProfilesService private readonly userDataProfilesService: IUserDataProfilesService,\n\t\t@IStorageMainService private readonly storageMainService: IStorageMainService\n\t) {\n\t\tsuper();\n\n\t\tthis.whenReady = this.storageMainService.applicationStorage.whenInit;\n\t}\n\n\tprotected doInitialize(): Promise<void> {\n\n\t\t// application storage is being initialized as part\n\t\t// of the first window opening, so we do not trigger\n\t\t// it here but can join it\n\t\treturn this.storageMainService.applicationStorage.whenInit;\n\t}\n\n\tprotected getStorage(scope: StorageScope): IStorage | undefined {\n\t\tif (scope === StorageScope.APPLICATION) {\n\t\t\treturn this.storageMainService.applicationStorage.storage;\n\t\t}\n\n\t\treturn undefined; // any other scope is unsupported from main process\n\t}\n\n\tprotected getLogDetails(scope: StorageScope): string | undefined {\n\t\tif (scope === StorageScope.APPLICATION) {\n\t\t\treturn this.userDataProfilesService.defaultProfile.globalStorageHome.with({ scheme: Schemas.file }).fsPath;\n\t\t}\n\n\t\treturn undefined; // any other scope is unsupported from main process\n\t}\n\n\tprotected override shouldFlushWhenIdle(): boolean {\n\t\treturn false; // not needed here, will be triggered from any window that is opened\n\t}\n\n\toverride switch(): never {\n\t\tthrow new Error('Migrating storage is unsupported from main process');\n\t}\n\n\tprotected switchToProfile(): never {\n\t\tthrow new Error('Switching storage profile is unsupported from main process');\n\t}\n\n\tprotected switchToWorkspace(): never {\n\t\tthrow new Error('Switching storage workspace is unsupported from main process');\n\t}\n\n\thasScope(): never {\n\t\tthrow new Error('Main process is never profile or workspace scoped');\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { URI } from '../../../base/common/uri.js';\nimport { Emitter, Event } from '../../../base/common/event.js';\nimport { Disposable } from '../../../base/common/lifecycle.js';\nimport { IStorage } from '../../../base/parts/storage/common/storage.js';\nimport { IEnvironmentService } from '../../environment/common/environment.js';\nimport { IFileService } from '../../files/common/files.js';\nimport { createDecorator } from '../../instantiation/common/instantiation.js';\nimport { ILifecycleMainService, LifecycleMainPhase, ShutdownReason } from '../../lifecycle/electron-main/lifecycleMainService.js';\nimport { ILogService } from '../../log/common/log.js';\nimport { AbstractStorageService, isProfileUsingDefaultStorage, IStorageService, StorageScope, StorageTarget } from '../common/storage.js';\nimport { ApplicationStorageMain, ProfileStorageMain, InMemoryStorageMain, IStorageMain, IStorageMainOptions, WorkspaceStorageMain, IStorageChangeEvent } from './storageMain.js';\nimport { IUserDataProfile, IUserDataProfilesService } from '../../userDataProfile/common/userDataProfile.js';\nimport { IUserDataProfilesMainService } from '../../userDataProfile/electron-main/userDataProfile.js';\nimport { IAnyWorkspaceIdentifier } from '../../workspace/common/workspace.js';\nimport { IUriIdentityService } from '../../uriIdentity/common/uriIdentity.js';\nimport { Schemas } from '../../../base/common/network.js';\n\n//#region Storage Main Service (intent: make application, profile and workspace storage accessible to windows from main process)\n\nexport const IStorageMainService = createDecorator<IStorageMainService>('storageMainService');\n\nexport interface IProfileStorageChangeEvent extends IStorageChangeEvent {\n\treadonly storage: IStorageMain;\n\treadonly profile: IUserDataProfile;\n}\n\nexport interface IStorageMainService {\n\n\treadonly _serviceBrand: undefined;\n\n\t/**\n\t * Provides access to the application storage shared across all\n\t * windows and all profiles.\n\t *\n\t * Note: DO NOT use this for reading/writing from the main process!\n\t *       Rather use `IApplicationStorageMainService` for that purpose.\n\t */\n\treadonly applicationStorage: IStorageMain;\n\n\t/**\n\t * Emitted whenever data is updated or deleted in profile scoped storage.\n\t */\n\treadonly onDidChangeProfileStorage: Event<IProfileStorageChangeEvent>;\n\n\t/**\n\t * Provides access to the profile storage shared across all windows\n\t * for the provided profile.\n\t *\n\t * Note: DO NOT use this for reading/writing from the main process!\n\t *       This is currently not supported.\n\t */\n\tprofileStorage(profile: IUserDataProfile): IStorageMain;\n\n\t/**\n\t * Provides access to the workspace storage specific to a single window.\n\t *\n\t * Note: DO NOT use this for reading/writing from the main process!\n\t *       This is currently not supported.\n\t */\n\tworkspaceStorage(workspace: IAnyWorkspaceIdentifier): IStorageMain;\n\n\t/**\n\t * Checks if the provided path is currently in use for a storage database.\n\t *\n\t * @param path the path to the storage file or parent folder\n\t */\n\tisUsed(path: string): boolean;\n}\n\nexport class StorageMainService extends Disposable implements IStorageMainService {\n\n\tdeclare readonly _serviceBrand: undefined;\n\n\tprivate shutdownReason: ShutdownReason | undefined = undefined;\n\n\tprivate readonly _onDidChangeProfileStorage = this._register(new Emitter<IProfileStorageChangeEvent>());\n\treadonly onDidChangeProfileStorage = this._onDidChangeProfileStorage.event;\n\n\tconstructor(\n\t\t@ILogService private readonly logService: ILogService,\n\t\t@IEnvironmentService private readonly environmentService: IEnvironmentService,\n\t\t@IUserDataProfilesMainService private readonly userDataProfilesService: IUserDataProfilesMainService,\n\t\t@ILifecycleMainService private readonly lifecycleMainService: ILifecycleMainService,\n\t\t@IFileService private readonly fileService: IFileService,\n\t\t@IUriIdentityService private readonly uriIdentityService: IUriIdentityService\n\t) {\n\t\tsuper();\n\n\t\tthis.applicationStorage = this._register(this.createApplicationStorage());\n\n\t\tthis.registerListeners();\n\t}\n\n\tprotected getStorageOptions(): IStorageMainOptions {\n\t\treturn {\n\t\t\tuseInMemoryStorage: !!this.environmentService.extensionTestsLocationURI // no storage during extension tests!\n\t\t};\n\t}\n\n\tprivate registerListeners(): void {\n\n\t\t// Application Storage: Warmup when any window opens\n\t\t(async () => {\n\t\t\tawait this.lifecycleMainService.when(LifecycleMainPhase.AfterWindowOpen);\n\n\t\t\tthis.applicationStorage.init();\n\t\t})();\n\n\t\tthis._register(this.lifecycleMainService.onWillLoadWindow(e => {\n\n\t\t\t// Profile Storage: Warmup when related window with profile loads\n\t\t\tif (e.window.profile) {\n\t\t\t\tthis.profileStorage(e.window.profile).init();\n\t\t\t}\n\n\t\t\t// Workspace Storage: Warmup when related window with workspace loads\n\t\t\tif (e.workspace) {\n\t\t\t\tthis.workspaceStorage(e.workspace).init();\n\t\t\t}\n\t\t}));\n\n\t\t// All Storage: Close when shutting down\n\t\tthis._register(this.lifecycleMainService.onWillShutdown(e => {\n\t\t\tthis.logService.trace('storageMainService#onWillShutdown()');\n\n\t\t\t// Remember shutdown reason\n\t\t\tthis.shutdownReason = e.reason;\n\n\t\t\t// Application Storage\n\t\t\te.join('applicationStorage', this.applicationStorage.close());\n\n\t\t\t// Profile Storage(s)\n\t\t\tfor (const [, profileStorage] of this.mapProfileToStorage) {\n\t\t\t\te.join('profileStorage', profileStorage.close());\n\t\t\t}\n\n\t\t\t// Workspace Storage(s)\n\t\t\tfor (const [, workspaceStorage] of this.mapWorkspaceToStorage) {\n\t\t\t\te.join('workspaceStorage', workspaceStorage.close());\n\t\t\t}\n\t\t}));\n\n\t\t// Prepare storage location as needed\n\t\tthis._register(this.userDataProfilesService.onWillCreateProfile(e => {\n\t\t\te.join((async () => {\n\t\t\t\tif (!(await this.fileService.exists(e.profile.globalStorageHome))) {\n\t\t\t\t\tawait this.fileService.createFolder(e.profile.globalStorageHome);\n\t\t\t\t}\n\t\t\t})());\n\t\t}));\n\n\t\t// Close the storage of the profile that is being removed\n\t\tthis._register(this.userDataProfilesService.onWillRemoveProfile(e => {\n\t\t\tconst storage = this.mapProfileToStorage.get(e.profile.id);\n\t\t\tif (storage) {\n\t\t\t\te.join(storage.close());\n\t\t\t}\n\t\t}));\n\t}\n\n\t//#region Application Storage\n\n\treadonly applicationStorage: IStorageMain;\n\n\tprivate createApplicationStorage(): IStorageMain {\n\t\tthis.logService.trace(`StorageMainService: creating application storage`);\n\n\t\tconst applicationStorage = new ApplicationStorageMain(this.getStorageOptions(), this.userDataProfilesService, this.logService, this.fileService);\n\n\t\tthis._register(Event.once(applicationStorage.onDidCloseStorage)(() => {\n\t\t\tthis.logService.trace(`StorageMainService: closed application storage`);\n\t\t}));\n\n\t\treturn applicationStorage;\n\t}\n\n\t//#endregion\n\n\t//#region Profile Storage\n\n\tprivate readonly mapProfileToStorage = new Map<string /* profile ID */, IStorageMain>();\n\n\tprofileStorage(profile: IUserDataProfile): IStorageMain {\n\t\tif (isProfileUsingDefaultStorage(profile)) {\n\t\t\treturn this.applicationStorage; // for profiles using default storage, use application storage\n\t\t}\n\n\t\tlet profileStorage = this.mapProfileToStorage.get(profile.id);\n\t\tif (!profileStorage) {\n\t\t\tthis.logService.trace(`StorageMainService: creating profile storage (${profile.name})`);\n\n\t\t\tprofileStorage = this._register(this.createProfileStorage(profile));\n\t\t\tthis.mapProfileToStorage.set(profile.id, profileStorage);\n\n\t\t\tconst listener = this._register(profileStorage.onDidChangeStorage(e => this._onDidChangeProfileStorage.fire({\n\t\t\t\t...e,\n\t\t\t\tstorage: profileStorage!,\n\t\t\t\tprofile\n\t\t\t})));\n\n\t\t\tthis._register(Event.once(profileStorage.onDidCloseStorage)(() => {\n\t\t\t\tthis.logService.trace(`StorageMainService: closed profile storage (${profile.name})`);\n\n\t\t\t\tthis.mapProfileToStorage.delete(profile.id);\n\t\t\t\tlistener.dispose();\n\t\t\t}));\n\t\t}\n\n\t\treturn profileStorage;\n\t}\n\n\tprivate createProfileStorage(profile: IUserDataProfile): IStorageMain {\n\t\tif (this.shutdownReason === ShutdownReason.KILL) {\n\n\t\t\t// Workaround for native crashes that we see when\n\t\t\t// SQLite DBs are being created even after shutdown\n\t\t\t// https://github.com/microsoft/vscode/issues/143186\n\n\t\t\treturn new InMemoryStorageMain(this.logService, this.fileService);\n\t\t}\n\n\t\treturn new ProfileStorageMain(profile, this.getStorageOptions(), this.logService, this.fileService);\n\t}\n\n\t//#endregion\n\n\n\t//#region Workspace Storage\n\n\tprivate readonly mapWorkspaceToStorage = new Map<string /* workspace ID */, IStorageMain>();\n\n\tworkspaceStorage(workspace: IAnyWorkspaceIdentifier): IStorageMain {\n\t\tlet workspaceStorage = this.mapWorkspaceToStorage.get(workspace.id);\n\t\tif (!workspaceStorage) {\n\t\t\tthis.logService.trace(`StorageMainService: creating workspace storage (${workspace.id})`);\n\n\t\t\tworkspaceStorage = this._register(this.createWorkspaceStorage(workspace));\n\t\t\tthis.mapWorkspaceToStorage.set(workspace.id, workspaceStorage);\n\n\t\t\tthis._register(Event.once(workspaceStorage.onDidCloseStorage)(() => {\n\t\t\t\tthis.logService.trace(`StorageMainService: closed workspace storage (${workspace.id})`);\n\n\t\t\t\tthis.mapWorkspaceToStorage.delete(workspace.id);\n\t\t\t}));\n\t\t}\n\n\t\treturn workspaceStorage;\n\t}\n\n\tprivate createWorkspaceStorage(workspace: IAnyWorkspaceIdentifier): IStorageMain {\n\t\tif (this.shutdownReason === ShutdownReason.KILL) {\n\n\t\t\t// Workaround for native crashes that we see when\n\t\t\t// SQLite DBs are being created even after shutdown\n\t\t\t// https://github.com/microsoft/vscode/issues/143186\n\n\t\t\treturn new InMemoryStorageMain(this.logService, this.fileService);\n\t\t}\n\n\t\treturn new WorkspaceStorageMain(workspace, this.getStorageOptions(), this.logService, this.environmentService, this.fileService);\n\t}\n\n\t//#endregion\n\n\tisUsed(path: string): boolean {\n\t\tconst pathUri = URI.file(path);\n\n\t\tfor (const storage of [this.applicationStorage, ...this.mapProfileToStorage.values(), ...this.mapWorkspaceToStorage.values()]) {\n\t\t\tif (!storage.path) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif (this.uriIdentityService.extUri.isEqualOrParent(URI.file(storage.path), pathUri)) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\n\t\treturn false;\n\t}\n}\n\n//#endregion\n\n\n//#region Application Main Storage Service (intent: use application storage from main process)\n\nexport const IApplicationStorageMainService = createDecorator<IStorageMainService>('applicationStorageMainService');\n\n/**\n * A specialized `IStorageService` interface that only allows\n * access to the `StorageScope.APPLICATION` scope.\n */\nexport interface IApplicationStorageMainService extends IStorageService {\n\n\t/**\n\t * Important: unlike other storage services in the renderer, the\n\t * main process does not await the storage to be ready, rather\n\t * storage is being initialized while a window opens to reduce\n\t * pressure on startup.\n\t *\n\t * As such, any client wanting to access application storage from the\n\t * main process needs to wait for `whenReady`, otherwise there is\n\t * a chance that the service operates on an in-memory store that\n\t * is not backed by any persistent DB.\n\t */\n\treadonly whenReady: Promise<void>;\n\n\tget(key: string, scope: StorageScope.APPLICATION, fallbackValue: string): string;\n\tget(key: string, scope: StorageScope.APPLICATION, fallbackValue?: string): string | undefined;\n\n\tgetBoolean(key: string, scope: StorageScope.APPLICATION, fallbackValue: boolean): boolean;\n\tgetBoolean(key: string, scope: StorageScope.APPLICATION, fallbackValue?: boolean): boolean | undefined;\n\n\tgetNumber(key: string, scope: StorageScope.APPLICATION, fallbackValue: number): number;\n\tgetNumber(key: string, scope: StorageScope.APPLICATION, fallbackValue?: number): number | undefined;\n\n\tstore(key: string, value: string | boolean | number | undefined | null, scope: StorageScope.APPLICATION, target: StorageTarget): void;\n\n\tremove(key: string, scope: StorageScope.APPLICATION): void;\n\n\tkeys(scope: StorageScope.APPLICATION, target: StorageTarget): string[];\n\n\tswitch(): never;\n\n\tisNew(scope: StorageScope.APPLICATION): boolean;\n}\n\nexport class ApplicationStorageMainService extends AbstractStorageService implements IApplicationStorageMainService {\n\n\tdeclare readonly _serviceBrand: undefined;\n\n\treadonly whenReady: Promise<void>;\n\n\tconstructor(\n\t\t@IUserDataProfilesService private readonly userDataProfilesService: IUserDataProfilesService,\n\t\t@IStorageMainService private readonly storageMainService: IStorageMainService\n\t) {\n\t\tsuper();\n\n\t\tthis.whenReady = this.storageMainService.applicationStorage.whenInit;\n\t}\n\n\tprotected doInitialize(): Promise<void> {\n\n\t\t// application storage is being initialized as part\n\t\t// of the first window opening, so we do not trigger\n\t\t// it here but can join it\n\t\treturn this.storageMainService.applicationStorage.whenInit;\n\t}\n\n\tprotected getStorage(scope: StorageScope): IStorage | undefined {\n\t\tif (scope === StorageScope.APPLICATION) {\n\t\t\treturn this.storageMainService.applicationStorage.storage;\n\t\t}\n\n\t\treturn undefined; // any other scope is unsupported from main process\n\t}\n\n\tprotected getLogDetails(scope: StorageScope): string | undefined {\n\t\tif (scope === StorageScope.APPLICATION) {\n\t\t\treturn this.userDataProfilesService.defaultProfile.globalStorageHome.with({ scheme: Schemas.file }).fsPath;\n\t\t}\n\n\t\treturn undefined; // any other scope is unsupported from main process\n\t}\n\n\tprotected override shouldFlushWhenIdle(): boolean {\n\t\treturn false; // not needed here, will be triggered from any window that is opened\n\t}\n\n\toverride switch(): never {\n\t\tthrow new Error('Migrating storage is unsupported from main process');\n\t}\n\n\tprotected switchToProfile(): never {\n\t\tthrow new Error('Switching storage profile is unsupported from main process');\n\t}\n\n\tprotected switchToWorkspace(): never {\n\t\tthrow new Error('Switching storage workspace is unsupported from main process');\n\t}\n\n\thasScope(): never {\n\t\tthrow new Error('Main process is never profile or workspace scoped');\n\t}\n}\n"]}