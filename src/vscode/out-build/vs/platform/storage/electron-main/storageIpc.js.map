{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/platform/storage/electron-main/storageIpc.ts","vs/platform/storage/electron-main/storageIpc.ts"],"names":[],"mappings":"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","file":"storageIpc.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Emitter, Event } from '../../../base/common/event.js';\nimport { Disposable } from '../../../base/common/lifecycle.js';\nimport { revive } from '../../../base/common/marshalling.js';\nimport { IServerChannel } from '../../../base/parts/ipc/common/ipc.js';\nimport { ILogService } from '../../log/common/log.js';\nimport { IBaseSerializableStorageRequest, ISerializableItemsChangeEvent, ISerializableUpdateRequest, Key, Value } from '../common/storageIpc.js';\nimport { IStorageChangeEvent, IStorageMain } from './storageMain.js';\nimport { IStorageMainService } from './storageMainService.js';\nimport { IUserDataProfile } from '../../userDataProfile/common/userDataProfile.js';\nimport { reviveIdentifier, IAnyWorkspaceIdentifier } from '../../workspace/common/workspace.js';\n\nexport class StorageDatabaseChannel extends Disposable implements IServerChannel {\n\n\tprivate static readonly STORAGE_CHANGE_DEBOUNCE_TIME = 100;\n\n\tprivate readonly onDidChangeApplicationStorageEmitter = this._register(new Emitter<ISerializableItemsChangeEvent>());\n\n\tprivate readonly mapProfileToOnDidChangeProfileStorageEmitter = new Map<string /* profile ID */, Emitter<ISerializableItemsChangeEvent>>();\n\n\tconstructor(\n\t\tprivate readonly logService: ILogService,\n\t\tprivate readonly storageMainService: IStorageMainService\n\t) {\n\t\tsuper();\n\n\t\tthis.registerStorageChangeListeners(storageMainService.applicationStorage, this.onDidChangeApplicationStorageEmitter);\n\t}\n\n\t//#region Storage Change Events\n\n\tprivate registerStorageChangeListeners(storage: IStorageMain, emitter: Emitter<ISerializableItemsChangeEvent>): void {\n\n\t\t// Listen for changes in provided storage to send to listeners\n\t\t// that are listening. Use a debouncer to reduce IPC traffic.\n\n\t\tthis._register(Event.debounce(storage.onDidChangeStorage, (prev: IStorageChangeEvent[] | undefined, cur: IStorageChangeEvent) => {\n\t\t\tif (!prev) {\n\t\t\t\tprev = [cur];\n\t\t\t} else {\n\t\t\t\tprev.push(cur);\n\t\t\t}\n\n\t\t\treturn prev;\n\t\t}, StorageDatabaseChannel.STORAGE_CHANGE_DEBOUNCE_TIME)(events => {\n\t\t\tif (events.length) {\n\t\t\t\temitter.fire(this.serializeStorageChangeEvents(events, storage));\n\t\t\t}\n\t\t}));\n\t}\n\n\tprivate serializeStorageChangeEvents(events: IStorageChangeEvent[], storage: IStorageMain): ISerializableItemsChangeEvent {\n\t\tconst changed = new Map<Key, Value>();\n\t\tconst deleted = new Set<Key>();\n\t\tevents.forEach(event => {\n\t\t\tconst existing = storage.get(event.key);\n\t\t\tif (typeof existing === 'string') {\n\t\t\t\tchanged.set(event.key, existing);\n\t\t\t} else {\n\t\t\t\tdeleted.add(event.key);\n\t\t\t}\n\t\t});\n\n\t\treturn {\n\t\t\tchanged: Array.from(changed.entries()),\n\t\t\tdeleted: Array.from(deleted.values())\n\t\t};\n\t}\n\n\t// eslint-disable-next-line @typescript-eslint/no-explicit-any\n\tlisten(_: unknown, event: string, arg: IBaseSerializableStorageRequest): Event<any> {\n\t\tswitch (event) {\n\t\t\tcase 'onDidChangeStorage': {\n\t\t\t\tconst profile = arg.profile ? revive<IUserDataProfile>(arg.profile) : undefined;\n\n\t\t\t\t// Without profile: application scope\n\t\t\t\tif (!profile) {\n\t\t\t\t\treturn this.onDidChangeApplicationStorageEmitter.event;\n\t\t\t\t}\n\n\t\t\t\t// With profile: profile scope for the profile\n\t\t\t\tlet profileStorageChangeEmitter = this.mapProfileToOnDidChangeProfileStorageEmitter.get(profile.id);\n\t\t\t\tif (!profileStorageChangeEmitter) {\n\t\t\t\t\tprofileStorageChangeEmitter = this._register(new Emitter<ISerializableItemsChangeEvent>());\n\t\t\t\t\tthis.registerStorageChangeListeners(this.storageMainService.profileStorage(profile), profileStorageChangeEmitter);\n\t\t\t\t\tthis.mapProfileToOnDidChangeProfileStorageEmitter.set(profile.id, profileStorageChangeEmitter);\n\t\t\t\t}\n\n\t\t\t\treturn profileStorageChangeEmitter.event;\n\t\t\t}\n\t\t}\n\n\t\tthrow new Error(`Event not found: ${event}`);\n\t}\n\n\t//#endregion\n\n\t// eslint-disable-next-line @typescript-eslint/no-explicit-any\n\tasync call(_: unknown, command: string, arg: IBaseSerializableStorageRequest): Promise<any> {\n\t\tconst profile = arg.profile ? revive<IUserDataProfile>(arg.profile) : undefined;\n\t\tconst workspace = reviveIdentifier(arg.workspace);\n\n\t\t// Get storage to be ready\n\t\tconst storage = await this.withStorageInitialized(profile, workspace);\n\n\t\t// handle call\n\t\tswitch (command) {\n\t\t\tcase 'getItems': {\n\t\t\t\treturn Array.from(storage.items.entries());\n\t\t\t}\n\n\t\t\tcase 'updateItems': {\n\t\t\t\tconst items: ISerializableUpdateRequest = arg;\n\n\t\t\t\tif (items.insert) {\n\t\t\t\t\tfor (const [key, value] of items.insert) {\n\t\t\t\t\t\tstorage.set(key, value);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\titems.delete?.forEach(key => storage.delete(key));\n\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tcase 'optimize': {\n\t\t\t\treturn storage.optimize();\n\t\t\t}\n\n\t\t\tcase 'isUsed': {\n\t\t\t\tconst path = arg.payload as string | undefined;\n\t\t\t\tif (typeof path === 'string') {\n\t\t\t\t\treturn this.storageMainService.isUsed(path);\n\t\t\t\t}\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tdefault:\n\t\t\t\tthrow new Error(`Call not found: ${command}`);\n\t\t}\n\t}\n\n\tprivate async withStorageInitialized(profile: IUserDataProfile | undefined, workspace: IAnyWorkspaceIdentifier | undefined): Promise<IStorageMain> {\n\t\tlet storage: IStorageMain;\n\t\tif (workspace) {\n\t\t\tstorage = this.storageMainService.workspaceStorage(workspace);\n\t\t} else if (profile) {\n\t\t\tstorage = this.storageMainService.profileStorage(profile);\n\t\t} else {\n\t\t\tstorage = this.storageMainService.applicationStorage;\n\t\t}\n\n\t\ttry {\n\t\t\tawait storage.init();\n\t\t} catch (error) {\n\t\t\tthis.logService.error(`StorageIPC#init: Unable to init ${workspace ? 'workspace' : profile ? 'profile' : 'application'} storage due to ${error}`);\n\t\t}\n\n\t\treturn storage;\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Emitter, Event } from '../../../base/common/event.js';\nimport { Disposable } from '../../../base/common/lifecycle.js';\nimport { revive } from '../../../base/common/marshalling.js';\nimport { IServerChannel } from '../../../base/parts/ipc/common/ipc.js';\nimport { ILogService } from '../../log/common/log.js';\nimport { IBaseSerializableStorageRequest, ISerializableItemsChangeEvent, ISerializableUpdateRequest, Key, Value } from '../common/storageIpc.js';\nimport { IStorageChangeEvent, IStorageMain } from './storageMain.js';\nimport { IStorageMainService } from './storageMainService.js';\nimport { IUserDataProfile } from '../../userDataProfile/common/userDataProfile.js';\nimport { reviveIdentifier, IAnyWorkspaceIdentifier } from '../../workspace/common/workspace.js';\n\nexport class StorageDatabaseChannel extends Disposable implements IServerChannel {\n\n\tprivate static readonly STORAGE_CHANGE_DEBOUNCE_TIME = 100;\n\n\tprivate readonly onDidChangeApplicationStorageEmitter = this._register(new Emitter<ISerializableItemsChangeEvent>());\n\n\tprivate readonly mapProfileToOnDidChangeProfileStorageEmitter = new Map<string /* profile ID */, Emitter<ISerializableItemsChangeEvent>>();\n\n\tconstructor(\n\t\tprivate readonly logService: ILogService,\n\t\tprivate readonly storageMainService: IStorageMainService\n\t) {\n\t\tsuper();\n\n\t\tthis.registerStorageChangeListeners(storageMainService.applicationStorage, this.onDidChangeApplicationStorageEmitter);\n\t}\n\n\t//#region Storage Change Events\n\n\tprivate registerStorageChangeListeners(storage: IStorageMain, emitter: Emitter<ISerializableItemsChangeEvent>): void {\n\n\t\t// Listen for changes in provided storage to send to listeners\n\t\t// that are listening. Use a debouncer to reduce IPC traffic.\n\n\t\tthis._register(Event.debounce(storage.onDidChangeStorage, (prev: IStorageChangeEvent[] | undefined, cur: IStorageChangeEvent) => {\n\t\t\tif (!prev) {\n\t\t\t\tprev = [cur];\n\t\t\t} else {\n\t\t\t\tprev.push(cur);\n\t\t\t}\n\n\t\t\treturn prev;\n\t\t}, StorageDatabaseChannel.STORAGE_CHANGE_DEBOUNCE_TIME)(events => {\n\t\t\tif (events.length) {\n\t\t\t\temitter.fire(this.serializeStorageChangeEvents(events, storage));\n\t\t\t}\n\t\t}));\n\t}\n\n\tprivate serializeStorageChangeEvents(events: IStorageChangeEvent[], storage: IStorageMain): ISerializableItemsChangeEvent {\n\t\tconst changed = new Map<Key, Value>();\n\t\tconst deleted = new Set<Key>();\n\t\tevents.forEach(event => {\n\t\t\tconst existing = storage.get(event.key);\n\t\t\tif (typeof existing === 'string') {\n\t\t\t\tchanged.set(event.key, existing);\n\t\t\t} else {\n\t\t\t\tdeleted.add(event.key);\n\t\t\t}\n\t\t});\n\n\t\treturn {\n\t\t\tchanged: Array.from(changed.entries()),\n\t\t\tdeleted: Array.from(deleted.values())\n\t\t};\n\t}\n\n\t// eslint-disable-next-line @typescript-eslint/no-explicit-any\n\tlisten(_: unknown, event: string, arg: IBaseSerializableStorageRequest): Event<any> {\n\t\tswitch (event) {\n\t\t\tcase 'onDidChangeStorage': {\n\t\t\t\tconst profile = arg.profile ? revive<IUserDataProfile>(arg.profile) : undefined;\n\n\t\t\t\t// Without profile: application scope\n\t\t\t\tif (!profile) {\n\t\t\t\t\treturn this.onDidChangeApplicationStorageEmitter.event;\n\t\t\t\t}\n\n\t\t\t\t// With profile: profile scope for the profile\n\t\t\t\tlet profileStorageChangeEmitter = this.mapProfileToOnDidChangeProfileStorageEmitter.get(profile.id);\n\t\t\t\tif (!profileStorageChangeEmitter) {\n\t\t\t\t\tprofileStorageChangeEmitter = this._register(new Emitter<ISerializableItemsChangeEvent>());\n\t\t\t\t\tthis.registerStorageChangeListeners(this.storageMainService.profileStorage(profile), profileStorageChangeEmitter);\n\t\t\t\t\tthis.mapProfileToOnDidChangeProfileStorageEmitter.set(profile.id, profileStorageChangeEmitter);\n\t\t\t\t}\n\n\t\t\t\treturn profileStorageChangeEmitter.event;\n\t\t\t}\n\t\t}\n\n\t\tthrow new Error(`Event not found: ${event}`);\n\t}\n\n\t//#endregion\n\n\t// eslint-disable-next-line @typescript-eslint/no-explicit-any\n\tasync call(_: unknown, command: string, arg: IBaseSerializableStorageRequest): Promise<any> {\n\t\tconst profile = arg.profile ? revive<IUserDataProfile>(arg.profile) : undefined;\n\t\tconst workspace = reviveIdentifier(arg.workspace);\n\n\t\t// Get storage to be ready\n\t\tconst storage = await this.withStorageInitialized(profile, workspace);\n\n\t\t// handle call\n\t\tswitch (command) {\n\t\t\tcase 'getItems': {\n\t\t\t\treturn Array.from(storage.items.entries());\n\t\t\t}\n\n\t\t\tcase 'updateItems': {\n\t\t\t\tconst items: ISerializableUpdateRequest = arg;\n\n\t\t\t\tif (items.insert) {\n\t\t\t\t\tfor (const [key, value] of items.insert) {\n\t\t\t\t\t\tstorage.set(key, value);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\titems.delete?.forEach(key => storage.delete(key));\n\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tcase 'optimize': {\n\t\t\t\treturn storage.optimize();\n\t\t\t}\n\n\t\t\tcase 'isUsed': {\n\t\t\t\tconst path = arg.payload as string | undefined;\n\t\t\t\tif (typeof path === 'string') {\n\t\t\t\t\treturn this.storageMainService.isUsed(path);\n\t\t\t\t}\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tdefault:\n\t\t\t\tthrow new Error(`Call not found: ${command}`);\n\t\t}\n\t}\n\n\tprivate async withStorageInitialized(profile: IUserDataProfile | undefined, workspace: IAnyWorkspaceIdentifier | undefined): Promise<IStorageMain> {\n\t\tlet storage: IStorageMain;\n\t\tif (workspace) {\n\t\t\tstorage = this.storageMainService.workspaceStorage(workspace);\n\t\t} else if (profile) {\n\t\t\tstorage = this.storageMainService.profileStorage(profile);\n\t\t} else {\n\t\t\tstorage = this.storageMainService.applicationStorage;\n\t\t}\n\n\t\ttry {\n\t\t\tawait storage.init();\n\t\t} catch (error) {\n\t\t\tthis.logService.error(`StorageIPC#init: Unable to init ${workspace ? 'workspace' : profile ? 'profile' : 'application'} storage due to ${error}`);\n\t\t}\n\n\t\treturn storage;\n\t}\n}\n"]}