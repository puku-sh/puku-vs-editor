{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/platform/storage/common/storageIpc.ts","vs/platform/storage/common/storageIpc.ts"],"names":[],"mappings":"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","file":"storageIpc.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Emitter, Event } from '../../../base/common/event.js';\nimport { Disposable } from '../../../base/common/lifecycle.js';\nimport { UriDto } from '../../../base/common/uri.js';\nimport { IChannel } from '../../../base/parts/ipc/common/ipc.js';\nimport { IStorageDatabase, IStorageItemsChangeEvent, IUpdateRequest } from '../../../base/parts/storage/common/storage.js';\nimport { IUserDataProfile } from '../../userDataProfile/common/userDataProfile.js';\nimport { ISerializedSingleFolderWorkspaceIdentifier, ISerializedWorkspaceIdentifier, IEmptyWorkspaceIdentifier, IAnyWorkspaceIdentifier } from '../../workspace/common/workspace.js';\n\nexport type Key = string;\nexport type Value = string;\nexport type Item = [Key, Value];\n\nexport interface IBaseSerializableStorageRequest {\n\n\t/**\n\t * Profile to correlate storage. Only used when no\n\t * workspace is provided. Can be undefined to denote\n\t * application scope.\n\t */\n\treadonly profile: UriDto<IUserDataProfile> | undefined;\n\n\t/**\n\t * Workspace to correlate storage. Can be undefined to\n\t * denote application or profile scope depending on profile.\n\t */\n\treadonly workspace: ISerializedWorkspaceIdentifier | ISerializedSingleFolderWorkspaceIdentifier | IEmptyWorkspaceIdentifier | undefined;\n\n\t/**\n\t * Additional payload for the request to perform.\n\t */\n\treadonly payload?: unknown;\n}\n\nexport interface ISerializableUpdateRequest extends IBaseSerializableStorageRequest {\n\tinsert?: Item[];\n\tdelete?: Key[];\n}\n\nexport interface ISerializableItemsChangeEvent {\n\treadonly changed?: Item[];\n\treadonly deleted?: Key[];\n}\n\nabstract class BaseStorageDatabaseClient extends Disposable implements IStorageDatabase {\n\n\tabstract readonly onDidChangeItemsExternal: Event<IStorageItemsChangeEvent>;\n\n\tconstructor(\n\t\tprotected channel: IChannel,\n\t\tprotected profile: UriDto<IUserDataProfile> | undefined,\n\t\tprotected workspace: IAnyWorkspaceIdentifier | undefined\n\t) {\n\t\tsuper();\n\t}\n\n\tasync getItems(): Promise<Map<string, string>> {\n\t\tconst serializableRequest: IBaseSerializableStorageRequest = { profile: this.profile, workspace: this.workspace };\n\t\tconst items: Item[] = await this.channel.call('getItems', serializableRequest);\n\n\t\treturn new Map(items);\n\t}\n\n\tupdateItems(request: IUpdateRequest): Promise<void> {\n\t\tconst serializableRequest: ISerializableUpdateRequest = { profile: this.profile, workspace: this.workspace };\n\n\t\tif (request.insert) {\n\t\t\tserializableRequest.insert = Array.from(request.insert.entries());\n\t\t}\n\n\t\tif (request.delete) {\n\t\t\tserializableRequest.delete = Array.from(request.delete.values());\n\t\t}\n\n\t\treturn this.channel.call('updateItems', serializableRequest);\n\t}\n\n\toptimize(): Promise<void> {\n\t\tconst serializableRequest: IBaseSerializableStorageRequest = { profile: this.profile, workspace: this.workspace };\n\n\t\treturn this.channel.call('optimize', serializableRequest);\n\t}\n\n\tabstract close(): Promise<void>;\n}\n\nabstract class BaseProfileAwareStorageDatabaseClient extends BaseStorageDatabaseClient {\n\n\tprivate readonly _onDidChangeItemsExternal = this._register(new Emitter<IStorageItemsChangeEvent>());\n\treadonly onDidChangeItemsExternal = this._onDidChangeItemsExternal.event;\n\n\tconstructor(channel: IChannel, profile: UriDto<IUserDataProfile> | undefined) {\n\t\tsuper(channel, profile, undefined);\n\n\t\tthis.registerListeners();\n\t}\n\n\tprivate registerListeners(): void {\n\t\tthis._register(this.channel.listen<ISerializableItemsChangeEvent>('onDidChangeStorage', { profile: this.profile })((e: ISerializableItemsChangeEvent) => this.onDidChangeStorage(e)));\n\t}\n\n\tprivate onDidChangeStorage(e: ISerializableItemsChangeEvent): void {\n\t\tif (Array.isArray(e.changed) || Array.isArray(e.deleted)) {\n\t\t\tthis._onDidChangeItemsExternal.fire({\n\t\t\t\tchanged: e.changed ? new Map(e.changed) : undefined,\n\t\t\t\tdeleted: e.deleted ? new Set<string>(e.deleted) : undefined\n\t\t\t});\n\t\t}\n\t}\n}\n\nexport class ApplicationStorageDatabaseClient extends BaseProfileAwareStorageDatabaseClient {\n\n\tconstructor(channel: IChannel) {\n\t\tsuper(channel, undefined);\n\t}\n\n\tasync close(): Promise<void> {\n\n\t\t// The application storage database is shared across all instances so\n\t\t// we do not close it from the window. However we dispose the\n\t\t// listener for external changes because we no longer interested in it.\n\n\t\tthis.dispose();\n\t}\n}\n\nexport class ProfileStorageDatabaseClient extends BaseProfileAwareStorageDatabaseClient {\n\n\tasync close(): Promise<void> {\n\n\t\t// The profile storage database is shared across all instances of\n\t\t// the same profile so we do not close it from the window.\n\t\t// However we dispose the listener for external changes because\n\t\t// we no longer interested in it.\n\n\t\tthis.dispose();\n\t}\n}\n\nexport class WorkspaceStorageDatabaseClient extends BaseStorageDatabaseClient implements IStorageDatabase {\n\n\treadonly onDidChangeItemsExternal = Event.None; // unsupported for workspace storage because we only ever write from one window\n\n\tconstructor(channel: IChannel, workspace: IAnyWorkspaceIdentifier) {\n\t\tsuper(channel, undefined, workspace);\n\t}\n\n\tasync close(): Promise<void> {\n\n\t\t// The workspace storage database is only used in this instance\n\t\t// but we do not need to close it from here, the main process\n\t\t// can take care of that.\n\n\t\tthis.dispose();\n\t}\n}\n\nexport class StorageClient {\n\n\tconstructor(private readonly channel: IChannel) { }\n\n\tisUsed(path: string): Promise<boolean> {\n\t\tconst serializableRequest: ISerializableUpdateRequest = { payload: path, profile: undefined, workspace: undefined };\n\n\t\treturn this.channel.call('isUsed', serializableRequest);\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Emitter, Event } from '../../../base/common/event.js';\nimport { Disposable } from '../../../base/common/lifecycle.js';\nimport { UriDto } from '../../../base/common/uri.js';\nimport { IChannel } from '../../../base/parts/ipc/common/ipc.js';\nimport { IStorageDatabase, IStorageItemsChangeEvent, IUpdateRequest } from '../../../base/parts/storage/common/storage.js';\nimport { IUserDataProfile } from '../../userDataProfile/common/userDataProfile.js';\nimport { ISerializedSingleFolderWorkspaceIdentifier, ISerializedWorkspaceIdentifier, IEmptyWorkspaceIdentifier, IAnyWorkspaceIdentifier } from '../../workspace/common/workspace.js';\n\nexport type Key = string;\nexport type Value = string;\nexport type Item = [Key, Value];\n\nexport interface IBaseSerializableStorageRequest {\n\n\t/**\n\t * Profile to correlate storage. Only used when no\n\t * workspace is provided. Can be undefined to denote\n\t * application scope.\n\t */\n\treadonly profile: UriDto<IUserDataProfile> | undefined;\n\n\t/**\n\t * Workspace to correlate storage. Can be undefined to\n\t * denote application or profile scope depending on profile.\n\t */\n\treadonly workspace: ISerializedWorkspaceIdentifier | ISerializedSingleFolderWorkspaceIdentifier | IEmptyWorkspaceIdentifier | undefined;\n\n\t/**\n\t * Additional payload for the request to perform.\n\t */\n\treadonly payload?: unknown;\n}\n\nexport interface ISerializableUpdateRequest extends IBaseSerializableStorageRequest {\n\tinsert?: Item[];\n\tdelete?: Key[];\n}\n\nexport interface ISerializableItemsChangeEvent {\n\treadonly changed?: Item[];\n\treadonly deleted?: Key[];\n}\n\nabstract class BaseStorageDatabaseClient extends Disposable implements IStorageDatabase {\n\n\tabstract readonly onDidChangeItemsExternal: Event<IStorageItemsChangeEvent>;\n\n\tconstructor(\n\t\tprotected channel: IChannel,\n\t\tprotected profile: UriDto<IUserDataProfile> | undefined,\n\t\tprotected workspace: IAnyWorkspaceIdentifier | undefined\n\t) {\n\t\tsuper();\n\t}\n\n\tasync getItems(): Promise<Map<string, string>> {\n\t\tconst serializableRequest: IBaseSerializableStorageRequest = { profile: this.profile, workspace: this.workspace };\n\t\tconst items: Item[] = await this.channel.call('getItems', serializableRequest);\n\n\t\treturn new Map(items);\n\t}\n\n\tupdateItems(request: IUpdateRequest): Promise<void> {\n\t\tconst serializableRequest: ISerializableUpdateRequest = { profile: this.profile, workspace: this.workspace };\n\n\t\tif (request.insert) {\n\t\t\tserializableRequest.insert = Array.from(request.insert.entries());\n\t\t}\n\n\t\tif (request.delete) {\n\t\t\tserializableRequest.delete = Array.from(request.delete.values());\n\t\t}\n\n\t\treturn this.channel.call('updateItems', serializableRequest);\n\t}\n\n\toptimize(): Promise<void> {\n\t\tconst serializableRequest: IBaseSerializableStorageRequest = { profile: this.profile, workspace: this.workspace };\n\n\t\treturn this.channel.call('optimize', serializableRequest);\n\t}\n\n\tabstract close(): Promise<void>;\n}\n\nabstract class BaseProfileAwareStorageDatabaseClient extends BaseStorageDatabaseClient {\n\n\tprivate readonly _onDidChangeItemsExternal = this._register(new Emitter<IStorageItemsChangeEvent>());\n\treadonly onDidChangeItemsExternal = this._onDidChangeItemsExternal.event;\n\n\tconstructor(channel: IChannel, profile: UriDto<IUserDataProfile> | undefined) {\n\t\tsuper(channel, profile, undefined);\n\n\t\tthis.registerListeners();\n\t}\n\n\tprivate registerListeners(): void {\n\t\tthis._register(this.channel.listen<ISerializableItemsChangeEvent>('onDidChangeStorage', { profile: this.profile })((e: ISerializableItemsChangeEvent) => this.onDidChangeStorage(e)));\n\t}\n\n\tprivate onDidChangeStorage(e: ISerializableItemsChangeEvent): void {\n\t\tif (Array.isArray(e.changed) || Array.isArray(e.deleted)) {\n\t\t\tthis._onDidChangeItemsExternal.fire({\n\t\t\t\tchanged: e.changed ? new Map(e.changed) : undefined,\n\t\t\t\tdeleted: e.deleted ? new Set<string>(e.deleted) : undefined\n\t\t\t});\n\t\t}\n\t}\n}\n\nexport class ApplicationStorageDatabaseClient extends BaseProfileAwareStorageDatabaseClient {\n\n\tconstructor(channel: IChannel) {\n\t\tsuper(channel, undefined);\n\t}\n\n\tasync close(): Promise<void> {\n\n\t\t// The application storage database is shared across all instances so\n\t\t// we do not close it from the window. However we dispose the\n\t\t// listener for external changes because we no longer interested in it.\n\n\t\tthis.dispose();\n\t}\n}\n\nexport class ProfileStorageDatabaseClient extends BaseProfileAwareStorageDatabaseClient {\n\n\tasync close(): Promise<void> {\n\n\t\t// The profile storage database is shared across all instances of\n\t\t// the same profile so we do not close it from the window.\n\t\t// However we dispose the listener for external changes because\n\t\t// we no longer interested in it.\n\n\t\tthis.dispose();\n\t}\n}\n\nexport class WorkspaceStorageDatabaseClient extends BaseStorageDatabaseClient implements IStorageDatabase {\n\n\treadonly onDidChangeItemsExternal = Event.None; // unsupported for workspace storage because we only ever write from one window\n\n\tconstructor(channel: IChannel, workspace: IAnyWorkspaceIdentifier) {\n\t\tsuper(channel, undefined, workspace);\n\t}\n\n\tasync close(): Promise<void> {\n\n\t\t// The workspace storage database is only used in this instance\n\t\t// but we do not need to close it from here, the main process\n\t\t// can take care of that.\n\n\t\tthis.dispose();\n\t}\n}\n\nexport class StorageClient {\n\n\tconstructor(private readonly channel: IChannel) { }\n\n\tisUsed(path: string): Promise<boolean> {\n\t\tconst serializableRequest: ISerializableUpdateRequest = { payload: path, profile: undefined, workspace: undefined };\n\n\t\treturn this.channel.call('isUsed', serializableRequest);\n\t}\n}\n"]}