{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/platform/extensionManagement/node/extensionsManifestCache.ts","vs/platform/extensionManagement/node/extensionsManifestCache.ts"],"names":[],"mappings":"AAAA;;;gGAGgG;AAEhG,OAAO,EAAE,UAAU,EAAE,MAAM,mCAAmC,CAAC;AAG/D,OAAO,EAAE,wBAAwB,EAAE,MAAM,uCAAuC,CAAC;AACjF,OAAO,EAAqC,qBAAqB,EAAE,MAAM,6BAA6B,CAAC;AAKvG,MAAM,OAAO,uBAAwB,SAAQ,UAAU;IAEtD,YACkB,uBAAiD,EACjD,WAAyB,EACzB,kBAAuC,EACxD,2BAAwD,EACvC,UAAuB;QAExC,KAAK,EAAE,CAAC;QANS,4BAAuB,GAAvB,uBAAuB,CAA0B;QACjD,gBAAW,GAAX,WAAW,CAAc;QACzB,uBAAkB,GAAlB,kBAAkB,CAAqB;QAEvC,eAAU,GAAV,UAAU,CAAa;QAGxC,IAAI,CAAC,SAAS,CAAC,2BAA2B,CAAC,sBAAsB,CAAC,CAAC,CAAC,EAAE,CAAC,IAAI,CAAC,sBAAsB,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;QACxG,IAAI,CAAC,SAAS,CAAC,2BAA2B,CAAC,uBAAuB,CAAC,CAAC,CAAC,EAAE,CAAC,IAAI,CAAC,uBAAuB,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;IAC3G,CAAC;IAEO,sBAAsB,CAAC,OAA0C;QACxE,KAAK,MAAM,CAAC,IAAI,OAAO,EAAE,CAAC;YACzB,IAAI,CAAC,CAAC,KAAK,EAAE,CAAC;gBACb,IAAI,CAAC,UAAU,CAAC,CAAC,CAAC,eAAe,CAAC,CAAC;YACpC,CAAC;QACF,CAAC;IACF,CAAC;IAEO,uBAAuB,CAAC,CAA6B;QAC5D,IAAI,CAAC,CAAC,CAAC,KAAK,EAAE,CAAC;YACd,IAAI,CAAC,UAAU,CAAC,CAAC,CAAC,eAAe,CAAC,CAAC;QACpC,CAAC;IACF,CAAC;IAED,KAAK,CAAC,UAAU,CAAC,0BAA2C;QAC3D,IAAI,0BAA0B,EAAE,CAAC;YAChC,KAAK,MAAM,OAAO,IAAI,IAAI,CAAC,uBAAuB,CAAC,QAAQ,EAAE,CAAC;gBAC7D,IAAI,IAAI,CAAC,kBAAkB,CAAC,MAAM,CAAC,OAAO,CAAC,OAAO,CAAC,kBAAkB,EAAE,0BAA0B,CAAC,EAAE,CAAC;oBACpG,MAAM,IAAI,CAAC,mBAAmB,CAAC,OAAO,CAAC,CAAC;gBACzC,CAAC;YACF,CAAC;QACF,CAAC;aAAM,CAAC;YACP,MAAM,IAAI,CAAC,mBAAmB,CAAC,IAAI,CAAC,uBAAuB,CAAC,cAAc,CAAC,CAAC;QAC7E,CAAC;IACF,CAAC;IAEO,KAAK,CAAC,mBAAmB,CAAC,OAAyB;QAC1D,IAAI,CAAC;YACJ,MAAM,IAAI,CAAC,WAAW,CAAC,GAAG,CAAC,IAAI,CAAC,kBAAkB,CAAC,MAAM,CAAC,QAAQ,CAAC,OAAO,CAAC,SAAS,EAAE,wBAAwB,CAAC,CAAC,CAAC;QAClH,CAAC;QAAC,OAAO,KAAK,EAAE,CAAC;YAChB,IAAI,qBAAqB,CAAC,KAAK,CAAC,+CAAuC,EAAE,CAAC;gBACzE,IAAI,CAAC,UAAU,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC;YAC9B,CAAC;QACF,CAAC;IACF,CAAC;CACD","file":"extensionsManifestCache.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Disposable } from '../../../base/common/lifecycle.js';\nimport { URI } from '../../../base/common/uri.js';\nimport { DidUninstallExtensionEvent, IExtensionManagementService, InstallExtensionResult } from '../common/extensionManagement.js';\nimport { USER_MANIFEST_CACHE_FILE } from '../../extensions/common/extensions.js';\nimport { FileOperationResult, IFileService, toFileOperationResult } from '../../files/common/files.js';\nimport { ILogService } from '../../log/common/log.js';\nimport { IUriIdentityService } from '../../uriIdentity/common/uriIdentity.js';\nimport { IUserDataProfile, IUserDataProfilesService } from '../../userDataProfile/common/userDataProfile.js';\n\nexport class ExtensionsManifestCache extends Disposable {\n\n\tconstructor(\n\t\tprivate readonly userDataProfilesService: IUserDataProfilesService,\n\t\tprivate readonly fileService: IFileService,\n\t\tprivate readonly uriIdentityService: IUriIdentityService,\n\t\textensionsManagementService: IExtensionManagementService,\n\t\tprivate readonly logService: ILogService,\n\t) {\n\t\tsuper();\n\t\tthis._register(extensionsManagementService.onDidInstallExtensions(e => this.onDidInstallExtensions(e)));\n\t\tthis._register(extensionsManagementService.onDidUninstallExtension(e => this.onDidUnInstallExtension(e)));\n\t}\n\n\tprivate onDidInstallExtensions(results: readonly InstallExtensionResult[]): void {\n\t\tfor (const r of results) {\n\t\t\tif (r.local) {\n\t\t\t\tthis.invalidate(r.profileLocation);\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate onDidUnInstallExtension(e: DidUninstallExtensionEvent): void {\n\t\tif (!e.error) {\n\t\t\tthis.invalidate(e.profileLocation);\n\t\t}\n\t}\n\n\tasync invalidate(extensionsManifestLocation: URI | undefined): Promise<void> {\n\t\tif (extensionsManifestLocation) {\n\t\t\tfor (const profile of this.userDataProfilesService.profiles) {\n\t\t\t\tif (this.uriIdentityService.extUri.isEqual(profile.extensionsResource, extensionsManifestLocation)) {\n\t\t\t\t\tawait this.deleteUserCacheFile(profile);\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tawait this.deleteUserCacheFile(this.userDataProfilesService.defaultProfile);\n\t\t}\n\t}\n\n\tprivate async deleteUserCacheFile(profile: IUserDataProfile): Promise<void> {\n\t\ttry {\n\t\t\tawait this.fileService.del(this.uriIdentityService.extUri.joinPath(profile.cacheHome, USER_MANIFEST_CACHE_FILE));\n\t\t} catch (error) {\n\t\t\tif (toFileOperationResult(error) !== FileOperationResult.FILE_NOT_FOUND) {\n\t\t\t\tthis.logService.error(error);\n\t\t\t}\n\t\t}\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Disposable } from '../../../base/common/lifecycle.js';\nimport { URI } from '../../../base/common/uri.js';\nimport { DidUninstallExtensionEvent, IExtensionManagementService, InstallExtensionResult } from '../common/extensionManagement.js';\nimport { USER_MANIFEST_CACHE_FILE } from '../../extensions/common/extensions.js';\nimport { FileOperationResult, IFileService, toFileOperationResult } from '../../files/common/files.js';\nimport { ILogService } from '../../log/common/log.js';\nimport { IUriIdentityService } from '../../uriIdentity/common/uriIdentity.js';\nimport { IUserDataProfile, IUserDataProfilesService } from '../../userDataProfile/common/userDataProfile.js';\n\nexport class ExtensionsManifestCache extends Disposable {\n\n\tconstructor(\n\t\tprivate readonly userDataProfilesService: IUserDataProfilesService,\n\t\tprivate readonly fileService: IFileService,\n\t\tprivate readonly uriIdentityService: IUriIdentityService,\n\t\textensionsManagementService: IExtensionManagementService,\n\t\tprivate readonly logService: ILogService,\n\t) {\n\t\tsuper();\n\t\tthis._register(extensionsManagementService.onDidInstallExtensions(e => this.onDidInstallExtensions(e)));\n\t\tthis._register(extensionsManagementService.onDidUninstallExtension(e => this.onDidUnInstallExtension(e)));\n\t}\n\n\tprivate onDidInstallExtensions(results: readonly InstallExtensionResult[]): void {\n\t\tfor (const r of results) {\n\t\t\tif (r.local) {\n\t\t\t\tthis.invalidate(r.profileLocation);\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate onDidUnInstallExtension(e: DidUninstallExtensionEvent): void {\n\t\tif (!e.error) {\n\t\t\tthis.invalidate(e.profileLocation);\n\t\t}\n\t}\n\n\tasync invalidate(extensionsManifestLocation: URI | undefined): Promise<void> {\n\t\tif (extensionsManifestLocation) {\n\t\t\tfor (const profile of this.userDataProfilesService.profiles) {\n\t\t\t\tif (this.uriIdentityService.extUri.isEqual(profile.extensionsResource, extensionsManifestLocation)) {\n\t\t\t\t\tawait this.deleteUserCacheFile(profile);\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tawait this.deleteUserCacheFile(this.userDataProfilesService.defaultProfile);\n\t\t}\n\t}\n\n\tprivate async deleteUserCacheFile(profile: IUserDataProfile): Promise<void> {\n\t\ttry {\n\t\t\tawait this.fileService.del(this.uriIdentityService.extUri.joinPath(profile.cacheHome, USER_MANIFEST_CACHE_FILE));\n\t\t} catch (error) {\n\t\t\tif (toFileOperationResult(error) !== FileOperationResult.FILE_NOT_FOUND) {\n\t\t\t\tthis.logService.error(error);\n\t\t\t}\n\t\t}\n\t}\n}\n"]}