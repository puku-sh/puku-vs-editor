{"version":3,"sources":["vs/platform/extensionManagement/node/extensionManagementService.ts"],"names":[],"mappings":"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","file":"extensionManagementService.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as fs from 'fs';\nimport { Promises, Queue } from '../../../base/common/async.js';\nimport { VSBuffer } from '../../../base/common/buffer.js';\nimport { CancellationToken } from '../../../base/common/cancellation.js';\nimport { IStringDictionary } from '../../../base/common/collections.js';\nimport { CancellationError, getErrorMessage } from '../../../base/common/errors.js';\nimport { Emitter } from '../../../base/common/event.js';\nimport { hash } from '../../../base/common/hash.js';\nimport { Disposable } from '../../../base/common/lifecycle.js';\nimport { ResourceMap, ResourceSet } from '../../../base/common/map.js';\nimport { Schemas } from '../../../base/common/network.js';\nimport * as path from '../../../base/common/path.js';\nimport { joinPath } from '../../../base/common/resources.js';\nimport * as semver from '../../../base/common/semver/semver.js';\nimport { isBoolean, isDefined, isUndefined } from '../../../base/common/types.js';\nimport { URI } from '../../../base/common/uri.js';\nimport { generateUuid } from '../../../base/common/uuid.js';\nimport * as pfs from '../../../base/node/pfs.js';\nimport { extract, IFile, zip } from '../../../base/node/zip.js';\nimport * as nls from '../../../nls.js';\nimport { IDownloadService } from '../../download/common/download.js';\nimport { INativeEnvironmentService } from '../../environment/common/environment.js';\nimport { AbstractExtensionManagementService, AbstractExtensionTask, IInstallExtensionTask, InstallExtensionTaskOptions, IUninstallExtensionTask, toExtensionManagementError, UninstallExtensionTaskOptions } from '../common/abstractExtensionManagementService.js';\nimport {\n\tExtensionManagementError, ExtensionManagementErrorCode, IExtensionGalleryService, IExtensionIdentifier, IExtensionManagementService, IGalleryExtension, ILocalExtension, InstallOperation,\n\tMetadata, InstallOptions,\n\tIProductVersion,\n\tEXTENSION_INSTALL_CLIENT_TARGET_PLATFORM_CONTEXT,\n\tExtensionSignatureVerificationCode,\n\tcomputeSize,\n\tIAllowedExtensionsService,\n\tVerifyExtensionSignatureConfigKey,\n\tshouldRequireRepositorySignatureFor,\n} from '../common/extensionManagement.js';\nimport { areSameExtensions, computeTargetPlatform, ExtensionKey, getGalleryExtensionId, groupByExtension } from '../common/extensionManagementUtil.js';\nimport { IExtensionsProfileScannerService, IScannedProfileExtension } from '../common/extensionsProfileScannerService.js';\nimport { IExtensionsScannerService, IScannedExtension, ManifestMetadata, UserExtensionsScanOptions } from '../common/extensionsScannerService.js';\nimport { ExtensionsDownloader } from './extensionDownloader.js';\nimport { ExtensionsLifecycle } from './extensionLifecycle.js';\nimport { fromExtractError, getManifest } from './extensionManagementUtil.js';\nimport { ExtensionsManifestCache } from './extensionsManifestCache.js';\nimport { DidChangeProfileExtensionsEvent, ExtensionsWatcher } from './extensionsWatcher.js';\nimport { ExtensionType, IExtension, IExtensionManifest, TargetPlatform } from '../../extensions/common/extensions.js';\nimport { isEngineValid } from '../../extensions/common/extensionValidator.js';\nimport { FileChangesEvent, FileChangeType, FileOperationResult, IFileService, IFileStat, toFileOperationResult } from '../../files/common/files.js';\nimport { IInstantiationService, refineServiceDecorator } from '../../instantiation/common/instantiation.js';\nimport { ILogService } from '../../log/common/log.js';\nimport { IProductService } from '../../product/common/productService.js';\nimport { ITelemetryService } from '../../telemetry/common/telemetry.js';\nimport { IUriIdentityService } from '../../uriIdentity/common/uriIdentity.js';\nimport { IUserDataProfilesService } from '../../userDataProfile/common/userDataProfile.js';\nimport { IConfigurationService } from '../../configuration/common/configuration.js';\nimport { IExtensionGalleryManifestService } from '../common/extensionGalleryManifest.js';\n\nexport const INativeServerExtensionManagementService = refineServiceDecorator<IExtensionManagementService, INativeServerExtensionManagementService>(IExtensionManagementService);\nexport interface INativeServerExtensionManagementService extends IExtensionManagementService {\n\treadonly _serviceBrand: undefined;\n\tscanAllUserInstalledExtensions(): Promise<ILocalExtension[]>;\n\tscanInstalledExtensionAtLocation(location: URI): Promise<ILocalExtension | null>;\n\tdeleteExtensions(...extensions: IExtension[]): Promise<void>;\n}\n\ntype ExtractExtensionResult = { readonly local: ILocalExtension; readonly verificationStatus?: ExtensionSignatureVerificationCode };\n\nconst DELETED_FOLDER_POSTFIX = '.vsctmp';\n\nexport class ExtensionManagementService extends AbstractExtensionManagementService implements INativeServerExtensionManagementService {\n\n\tprivate readonly extensionsScanner: ExtensionsScanner;\n\tprivate readonly manifestCache: ExtensionsManifestCache;\n\tprivate readonly extensionsDownloader: ExtensionsDownloader;\n\n\tprivate readonly extractingGalleryExtensions = new Map<string, Promise<ExtractExtensionResult>>();\n\n\tconstructor(\n\t\t@IExtensionGalleryService galleryService: IExtensionGalleryService,\n\t\t@ITelemetryService telemetryService: ITelemetryService,\n\t\t@ILogService logService: ILogService,\n\t\t@INativeEnvironmentService private readonly environmentService: INativeEnvironmentService,\n\t\t@IExtensionsScannerService private readonly extensionsScannerService: IExtensionsScannerService,\n\t\t@IExtensionsProfileScannerService private readonly extensionsProfileScannerService: IExtensionsProfileScannerService,\n\t\t@IDownloadService private downloadService: IDownloadService,\n\t\t@IInstantiationService private readonly instantiationService: IInstantiationService,\n\t\t@IFileService private readonly fileService: IFileService,\n\t\t@IConfigurationService private readonly configurationService: IConfigurationService,\n\t\t@IExtensionGalleryManifestService protected readonly extensionGalleryManifestService: IExtensionGalleryManifestService,\n\t\t@IProductService productService: IProductService,\n\t\t@IAllowedExtensionsService allowedExtensionsService: IAllowedExtensionsService,\n\t\t@IUriIdentityService uriIdentityService: IUriIdentityService,\n\t\t@IUserDataProfilesService userDataProfilesService: IUserDataProfilesService\n\t) {\n\t\tsuper(galleryService, telemetryService, uriIdentityService, logService, productService, allowedExtensionsService, userDataProfilesService);\n\t\tconst extensionLifecycle = this._register(instantiationService.createInstance(ExtensionsLifecycle));\n\t\tthis.extensionsScanner = this._register(instantiationService.createInstance(ExtensionsScanner, extension => extensionLifecycle.postUninstall(extension)));\n\t\tthis.manifestCache = this._register(new ExtensionsManifestCache(userDataProfilesService, fileService, uriIdentityService, this, this.logService));\n\t\tthis.extensionsDownloader = this._register(instantiationService.createInstance(ExtensionsDownloader));\n\n\t\tconst extensionsWatcher = this._register(new ExtensionsWatcher(this, this.extensionsScannerService, userDataProfilesService, extensionsProfileScannerService, uriIdentityService, fileService, logService));\n\t\tthis._register(extensionsWatcher.onDidChangeExtensionsByAnotherSource(e => this.onDidChangeExtensionsFromAnotherSource(e)));\n\t\tthis.watchForExtensionsNotInstalledBySystem();\n\t}\n\n\tprivate _targetPlatformPromise: Promise<TargetPlatform> | undefined;\n\tgetTargetPlatform(): Promise<TargetPlatform> {\n\t\tif (!this._targetPlatformPromise) {\n\t\t\tthis._targetPlatformPromise = computeTargetPlatform(this.fileService, this.logService);\n\t\t}\n\t\treturn this._targetPlatformPromise;\n\t}\n\n\tasync zip(extension: ILocalExtension): Promise<URI> {\n\t\tthis.logService.trace('ExtensionManagementService#zip', extension.identifier.id);\n\t\tconst files = await this.collectFiles(extension);\n\t\tconst location = await zip(joinPath(this.extensionsDownloader.extensionsDownloadDir, generateUuid()).fsPath, files);\n\t\treturn URI.file(location);\n\t}\n\n\tasync getManifest(vsix: URI): Promise<IExtensionManifest> {\n\t\tconst { location, cleanup } = await this.downloadVsix(vsix);\n\t\tconst zipPath = path.resolve(location.fsPath);\n\t\ttry {\n\t\t\treturn await getManifest(zipPath);\n\t\t} finally {\n\t\t\tawait cleanup();\n\t\t}\n\t}\n\n\tgetInstalled(type?: ExtensionType, profileLocation: URI = this.userDataProfilesService.defaultProfile.extensionsResource, productVersion: IProductVersion = { version: this.productService.version, date: this.productService.date }, language?: string): Promise<ILocalExtension[]> {\n\t\treturn this.extensionsScanner.scanExtensions(type ?? null, profileLocation, productVersion, language);\n\t}\n\n\tscanAllUserInstalledExtensions(): Promise<ILocalExtension[]> {\n\t\treturn this.extensionsScanner.scanAllUserExtensions();\n\t}\n\n\tscanInstalledExtensionAtLocation(location: URI): Promise<ILocalExtension | null> {\n\t\treturn this.extensionsScanner.scanUserExtensionAtLocation(location);\n\t}\n\n\tasync install(vsix: URI, options: InstallOptions = {}): Promise<ILocalExtension> {\n\t\tthis.logService.trace('ExtensionManagementService#install', vsix.toString());\n\n\t\tconst { location, cleanup } = await this.downloadVsix(vsix);\n\n\t\ttry {\n\t\t\tconst manifest = await getManifest(path.resolve(location.fsPath));\n\t\t\tconst extensionId = getGalleryExtensionId(manifest.publisher, manifest.name);\n\t\t\tif (manifest.engines && manifest.engines.vscode && !isEngineValid(manifest.engines.vscode, this.productService.version, this.productService.date)) {\n\t\t\t\tthrow new Error(nls.localize('incompatible', \"Unable to install extension '{0}' as it is not compatible with VS Code '{1}'.\", extensionId, this.productService.version));\n\t\t\t}\n\n\t\t\tconst allowedToInstall = this.allowedExtensionsService.isAllowed({ id: extensionId, version: manifest.version, publisherDisplayName: undefined });\n\t\t\tif (allowedToInstall !== true) {\n\t\t\t\tthrow new Error(nls.localize('notAllowed', \"This extension cannot be installed because {0}\", allowedToInstall.value));\n\t\t\t}\n\n\t\t\tconst results = await this.installExtensions([{ manifest, extension: location, options }]);\n\t\t\tconst result = results.find(({ identifier }) => areSameExtensions(identifier, { id: extensionId }));\n\t\t\tif (result?.local) {\n\t\t\t\treturn result.local;\n\t\t\t}\n\t\t\tif (result?.error) {\n\t\t\t\tthrow result.error;\n\t\t\t}\n\t\t\tthrow toExtensionManagementError(new Error(`Unknown error while installing extension ${extensionId}`));\n\t\t} finally {\n\t\t\tawait cleanup();\n\t\t}\n\t}\n\n\tasync installFromLocation(location: URI, profileLocation: URI): Promise<ILocalExtension> {\n\t\tthis.logService.trace('ExtensionManagementService#installFromLocation', location.toString());\n\t\tconst local = await this.extensionsScanner.scanUserExtensionAtLocation(location);\n\t\tif (!local || !local.manifest.name || !local.manifest.version) {\n\t\t\tthrow new Error(`Cannot find a valid extension from the location ${location.toString()}`);\n\t\t}\n\t\tawait this.addExtensionsToProfile([[local, { source: 'resource' }]], profileLocation);\n\t\tthis.logService.info('Successfully installed extension', local.identifier.id, profileLocation.toString());\n\t\treturn local;\n\t}\n\n\tasync installExtensionsFromProfile(extensions: IExtensionIdentifier[], fromProfileLocation: URI, toProfileLocation: URI): Promise<ILocalExtension[]> {\n\t\tthis.logService.trace('ExtensionManagementService#installExtensionsFromProfile', extensions, fromProfileLocation.toString(), toProfileLocation.toString());\n\t\tconst extensionsToInstall = (await this.getInstalled(ExtensionType.User, fromProfileLocation)).filter(e => extensions.some(id => areSameExtensions(id, e.identifier)));\n\t\tif (extensionsToInstall.length) {\n\t\t\tconst metadata = await Promise.all(extensionsToInstall.map(e => this.extensionsScanner.scanMetadata(e, fromProfileLocation)));\n\t\t\tawait this.addExtensionsToProfile(extensionsToInstall.map((e, index) => [e, metadata[index]]), toProfileLocation);\n\t\t\tthis.logService.info('Successfully installed extensions', extensionsToInstall.map(e => e.identifier.id), toProfileLocation.toString());\n\t\t}\n\t\treturn extensionsToInstall;\n\t}\n\n\tasync updateMetadata(local: ILocalExtension, metadata: Partial<Metadata>, profileLocation: URI): Promise<ILocalExtension> {\n\t\tthis.logService.trace('ExtensionManagementService#updateMetadata', local.identifier.id);\n\t\tif (metadata.isPreReleaseVersion) {\n\t\t\tmetadata.preRelease = true;\n\t\t\tmetadata.hasPreReleaseVersion = true;\n\t\t}\n\t\t// unset if false\n\t\tif (metadata.isMachineScoped === false) {\n\t\t\tmetadata.isMachineScoped = undefined;\n\t\t}\n\t\tif (metadata.isBuiltin === false) {\n\t\t\tmetadata.isBuiltin = undefined;\n\t\t}\n\t\tif (metadata.pinned === false) {\n\t\t\tmetadata.pinned = undefined;\n\t\t}\n\t\tlocal = await this.extensionsScanner.updateMetadata(local, metadata, profileLocation);\n\t\tthis.manifestCache.invalidate(profileLocation);\n\t\tthis._onDidUpdateExtensionMetadata.fire({ local, profileLocation });\n\t\treturn local;\n\t}\n\n\tprotected deleteExtension(extension: ILocalExtension): Promise<void> {\n\t\treturn this.extensionsScanner.deleteExtension(extension, 'remove');\n\t}\n\n\tprotected copyExtension(extension: ILocalExtension, fromProfileLocation: URI, toProfileLocation: URI, metadata: Partial<Metadata>): Promise<ILocalExtension> {\n\t\treturn this.extensionsScanner.copyExtension(extension, fromProfileLocation, toProfileLocation, metadata);\n\t}\n\n\tprotected moveExtension(extension: ILocalExtension, fromProfileLocation: URI, toProfileLocation: URI, metadata: Partial<Metadata>): Promise<ILocalExtension> {\n\t\treturn this.extensionsScanner.moveExtension(extension, fromProfileLocation, toProfileLocation, metadata);\n\t}\n\n\tprotected removeExtension(extension: ILocalExtension, fromProfileLocation: URI): Promise<void> {\n\t\treturn this.extensionsScanner.removeExtension(extension.identifier, fromProfileLocation);\n\t}\n\n\tcopyExtensions(fromProfileLocation: URI, toProfileLocation: URI): Promise<void> {\n\t\treturn this.extensionsScanner.copyExtensions(fromProfileLocation, toProfileLocation, { version: this.productService.version, date: this.productService.date });\n\t}\n\n\tdeleteExtensions(...extensions: IExtension[]): Promise<void> {\n\t\treturn this.extensionsScanner.setExtensionsForRemoval(...extensions);\n\t}\n\n\tasync cleanUp(): Promise<void> {\n\t\tthis.logService.trace('ExtensionManagementService#cleanUp');\n\t\ttry {\n\t\t\tawait this.extensionsScanner.cleanUp();\n\t\t} catch (error) {\n\t\t\tthis.logService.error(error);\n\t\t}\n\t}\n\n\tasync download(extension: IGalleryExtension, operation: InstallOperation, donotVerifySignature: boolean): Promise<URI> {\n\t\tconst { location } = await this.downloadExtension(extension, operation, !donotVerifySignature);\n\t\treturn location;\n\t}\n\n\tprivate async downloadVsix(vsix: URI): Promise<{ location: URI; cleanup: () => Promise<void> }> {\n\t\tif (vsix.scheme === Schemas.file) {\n\t\t\treturn { location: vsix, async cleanup() { } };\n\t\t}\n\t\tthis.logService.trace('Downloading extension from', vsix.toString());\n\t\tconst location = joinPath(this.extensionsDownloader.extensionsDownloadDir, generateUuid());\n\t\tawait this.downloadService.download(vsix, location);\n\t\tthis.logService.info('Downloaded extension to', location.toString());\n\t\tconst cleanup = async () => {\n\t\t\ttry {\n\t\t\t\tawait this.fileService.del(location);\n\t\t\t} catch (error) {\n\t\t\t\tthis.logService.error(error);\n\t\t\t}\n\t\t};\n\t\treturn { location, cleanup };\n\t}\n\n\tprotected getCurrentExtensionsManifestLocation(): URI {\n\t\treturn this.userDataProfilesService.defaultProfile.extensionsResource;\n\t}\n\n\tprotected createInstallExtensionTask(manifest: IExtensionManifest, extension: URI | IGalleryExtension, options: InstallExtensionTaskOptions): IInstallExtensionTask {\n\t\tconst extensionKey = extension instanceof URI ? new ExtensionKey({ id: getGalleryExtensionId(manifest.publisher, manifest.name) }, manifest.version) : ExtensionKey.create(extension);\n\t\treturn this.instantiationService.createInstance(InstallExtensionInProfileTask, extensionKey, manifest, extension, options, (operation, token) => {\n\t\t\tif (extension instanceof URI) {\n\t\t\t\treturn this.extractVSIX(extensionKey, extension, options, token);\n\t\t\t}\n\t\t\tlet promise = this.extractingGalleryExtensions.get(extensionKey.toString());\n\t\t\tif (!promise) {\n\t\t\t\tthis.extractingGalleryExtensions.set(extensionKey.toString(), promise = this.downloadAndExtractGalleryExtension(extensionKey, extension, operation, options, token));\n\t\t\t\tpromise.finally(() => this.extractingGalleryExtensions.delete(extensionKey.toString()));\n\t\t\t}\n\t\t\treturn promise;\n\t\t}, this.extensionsScanner);\n\t}\n\n\tprotected createUninstallExtensionTask(extension: ILocalExtension, options: UninstallExtensionTaskOptions): IUninstallExtensionTask {\n\t\treturn new UninstallExtensionInProfileTask(extension, options, this.extensionsProfileScannerService);\n\t}\n\n\tprivate async downloadAndExtractGalleryExtension(extensionKey: ExtensionKey, gallery: IGalleryExtension, operation: InstallOperation, options: InstallExtensionTaskOptions, token: CancellationToken): Promise<ExtractExtensionResult> {\n\t\tconst { verificationStatus, location } = await this.downloadExtension(gallery, operation, !options.donotVerifySignature, options.context?.[EXTENSION_INSTALL_CLIENT_TARGET_PLATFORM_CONTEXT] as TargetPlatform | undefined);\n\t\ttry {\n\n\t\t\tif (token.isCancellationRequested) {\n\t\t\t\tthrow new CancellationError();\n\t\t\t}\n\n\t\t\t// validate manifest\n\t\t\tconst manifest = await getManifest(location.fsPath);\n\t\t\tif (!new ExtensionKey(gallery.identifier, gallery.version).equals(new ExtensionKey({ id: getGalleryExtensionId(manifest.publisher, manifest.name) }, manifest.version))) {\n\t\t\t\tthrow new ExtensionManagementError(nls.localize('invalidManifest', \"Cannot install '{0}' extension because of manifest mismatch with Marketplace\", gallery.identifier.id), ExtensionManagementErrorCode.Invalid);\n\t\t\t}\n\n\t\t\tconst local = await this.extensionsScanner.extractUserExtension(\n\t\t\t\textensionKey,\n\t\t\t\tlocation.fsPath,\n\t\t\t\tfalse,\n\t\t\t\ttoken);\n\n\t\t\tif (verificationStatus !== ExtensionSignatureVerificationCode.Success && this.environmentService.isBuilt) {\n\t\t\t\ttry {\n\t\t\t\t\tawait this.extensionsDownloader.delete(location);\n\t\t\t\t} catch (e) {\n\t\t\t\t\t/* Ignore */\n\t\t\t\t\tthis.logService.warn(`Error while deleting the downloaded file`, location.toString(), getErrorMessage(e));\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn { local, verificationStatus };\n\t\t} catch (error) {\n\t\t\ttry {\n\t\t\t\tawait this.extensionsDownloader.delete(location);\n\t\t\t} catch (e) {\n\t\t\t\t/* Ignore */\n\t\t\t\tthis.logService.warn(`Error while deleting the downloaded file`, location.toString(), getErrorMessage(e));\n\t\t\t}\n\t\t\tthrow toExtensionManagementError(error);\n\t\t}\n\t}\n\n\tprivate async downloadExtension(extension: IGalleryExtension, operation: InstallOperation, verifySignature: boolean, clientTargetPlatform?: TargetPlatform): Promise<{ readonly location: URI; readonly verificationStatus: ExtensionSignatureVerificationCode | undefined }> {\n\t\tif (verifySignature) {\n\t\t\tconst value = this.configurationService.getValue(VerifyExtensionSignatureConfigKey);\n\t\t\tverifySignature = isBoolean(value) ? value : true;\n\t\t}\n\t\tconst { location, verificationStatus } = await this.extensionsDownloader.download(extension, operation, verifySignature, clientTargetPlatform);\n\t\tconst shouldRequireSignature = shouldRequireRepositorySignatureFor(extension.private, await this.extensionGalleryManifestService.getExtensionGalleryManifest());\n\n\t\tif (\n\t\t\tverificationStatus !== ExtensionSignatureVerificationCode.Success\n\t\t\t&& !(verificationStatus === ExtensionSignatureVerificationCode.NotSigned && !shouldRequireSignature)\n\t\t\t&& verifySignature\n\t\t\t&& this.environmentService.isBuilt\n\t\t\t&& (await this.getTargetPlatform()) !== TargetPlatform.LINUX_ARMHF\n\t\t) {\n\t\t\ttry {\n\t\t\t\tawait this.extensionsDownloader.delete(location);\n\t\t\t} catch (e) {\n\t\t\t\t/* Ignore */\n\t\t\t\tthis.logService.warn(`Error while deleting the downloaded file`, location.toString(), getErrorMessage(e));\n\t\t\t}\n\n\t\t\tif (!verificationStatus) {\n\t\t\t\tthrow new ExtensionManagementError(nls.localize('signature verification not executed', \"Signature verification was not executed.\"), ExtensionManagementErrorCode.SignatureVerificationInternal);\n\t\t\t}\n\n\t\t\tswitch (verificationStatus) {\n\t\t\t\tcase ExtensionSignatureVerificationCode.PackageIntegrityCheckFailed:\n\t\t\t\tcase ExtensionSignatureVerificationCode.SignatureIsInvalid:\n\t\t\t\tcase ExtensionSignatureVerificationCode.SignatureManifestIsInvalid:\n\t\t\t\tcase ExtensionSignatureVerificationCode.SignatureIntegrityCheckFailed:\n\t\t\t\tcase ExtensionSignatureVerificationCode.EntryIsMissing:\n\t\t\t\tcase ExtensionSignatureVerificationCode.EntryIsTampered:\n\t\t\t\tcase ExtensionSignatureVerificationCode.Untrusted:\n\t\t\t\tcase ExtensionSignatureVerificationCode.CertificateRevoked:\n\t\t\t\tcase ExtensionSignatureVerificationCode.SignatureIsNotValid:\n\t\t\t\tcase ExtensionSignatureVerificationCode.SignatureArchiveHasTooManyEntries:\n\t\t\t\tcase ExtensionSignatureVerificationCode.NotSigned:\n\t\t\t\t\tthrow new ExtensionManagementError(nls.localize('signature verification failed', \"Signature verification failed with '{0}' error.\", verificationStatus), ExtensionManagementErrorCode.SignatureVerificationFailed);\n\t\t\t}\n\n\t\t\tthrow new ExtensionManagementError(nls.localize('signature verification failed', \"Signature verification failed with '{0}' error.\", verificationStatus), ExtensionManagementErrorCode.SignatureVerificationInternal);\n\t\t}\n\n\t\treturn { location, verificationStatus };\n\t}\n\n\tprivate async extractVSIX(extensionKey: ExtensionKey, location: URI, options: InstallExtensionTaskOptions, token: CancellationToken): Promise<ExtractExtensionResult> {\n\t\tconst local = await this.extensionsScanner.extractUserExtension(\n\t\t\textensionKey,\n\t\t\tpath.resolve(location.fsPath),\n\t\t\tisBoolean(options.keepExisting) ? !options.keepExisting : true,\n\t\t\ttoken);\n\t\treturn { local };\n\t}\n\n\tprivate async collectFiles(extension: ILocalExtension): Promise<IFile[]> {\n\n\t\tconst collectFilesFromDirectory = async (dir: string): Promise<string[]> => {\n\t\t\tlet entries = await pfs.Promises.readdir(dir);\n\t\t\tentries = entries.map(e => path.join(dir, e));\n\t\t\tconst stats = await Promise.all(entries.map(e => fs.promises.stat(e)));\n\t\t\tlet promise: Promise<string[]> = Promise.resolve([]);\n\t\t\tstats.forEach((stat, index) => {\n\t\t\t\tconst entry = entries[index];\n\t\t\t\tif (stat.isFile()) {\n\t\t\t\t\tpromise = promise.then(result => ([...result, entry]));\n\t\t\t\t}\n\t\t\t\tif (stat.isDirectory()) {\n\t\t\t\t\tpromise = promise\n\t\t\t\t\t\t.then(result => collectFilesFromDirectory(entry)\n\t\t\t\t\t\t\t.then(files => ([...result, ...files])));\n\t\t\t\t}\n\t\t\t});\n\t\t\treturn promise;\n\t\t};\n\n\t\tconst files = await collectFilesFromDirectory(extension.location.fsPath);\n\t\treturn files.map(f => ({ path: `extension/${path.relative(extension.location.fsPath, f)}`, localPath: f }));\n\t}\n\n\tprivate async onDidChangeExtensionsFromAnotherSource({ added, removed }: DidChangeProfileExtensionsEvent): Promise<void> {\n\t\tif (removed) {\n\t\t\tconst removedExtensions = added && this.uriIdentityService.extUri.isEqual(removed.profileLocation, added.profileLocation)\n\t\t\t\t? removed.extensions.filter(e => added.extensions.every(identifier => !areSameExtensions(identifier, e)))\n\t\t\t\t: removed.extensions;\n\t\t\tfor (const identifier of removedExtensions) {\n\t\t\t\tthis.logService.info('Extensions removed from another source', identifier.id, removed.profileLocation.toString());\n\t\t\t\tthis._onDidUninstallExtension.fire({ identifier, profileLocation: removed.profileLocation });\n\t\t\t}\n\t\t}\n\t\tif (added) {\n\t\t\tconst extensions = await this.getInstalled(ExtensionType.User, added.profileLocation);\n\t\t\tconst addedExtensions = extensions.filter(e => added.extensions.some(identifier => areSameExtensions(identifier, e.identifier)));\n\t\t\tthis._onDidInstallExtensions.fire(addedExtensions.map(local => {\n\t\t\t\tthis.logService.info('Extensions added from another source', local.identifier.id, added.profileLocation.toString());\n\t\t\t\treturn { identifier: local.identifier, local, profileLocation: added.profileLocation, operation: InstallOperation.None };\n\t\t\t}));\n\t\t}\n\t}\n\n\tprivate readonly knownDirectories = new ResourceSet();\n\tprivate async watchForExtensionsNotInstalledBySystem(): Promise<void> {\n\t\tthis._register(this.extensionsScanner.onExtract(resource => this.knownDirectories.add(resource)));\n\t\tconst stat = await this.fileService.resolve(this.extensionsScannerService.userExtensionsLocation);\n\t\tfor (const childStat of stat.children ?? []) {\n\t\t\tif (childStat.isDirectory) {\n\t\t\t\tthis.knownDirectories.add(childStat.resource);\n\t\t\t}\n\t\t}\n\t\tthis._register(this.fileService.watch(this.extensionsScannerService.userExtensionsLocation));\n\t\tthis._register(this.fileService.onDidFilesChange(e => this.onDidFilesChange(e)));\n\t}\n\n\tprivate async onDidFilesChange(e: FileChangesEvent): Promise<void> {\n\t\tif (!e.affects(this.extensionsScannerService.userExtensionsLocation, FileChangeType.ADDED)) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst added: ILocalExtension[] = [];\n\t\tfor (const resource of e.rawAdded) {\n\t\t\t// Check if this is a known directory\n\t\t\tif (this.knownDirectories.has(resource)) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t// Is not immediate child of extensions resource\n\t\t\tif (!this.uriIdentityService.extUri.isEqual(this.uriIdentityService.extUri.dirname(resource), this.extensionsScannerService.userExtensionsLocation)) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t// .obsolete file changed\n\t\t\tif (this.uriIdentityService.extUri.isEqual(resource, this.uriIdentityService.extUri.joinPath(this.extensionsScannerService.userExtensionsLocation, '.obsolete'))) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t// Ignore changes to files starting with `.`\n\t\t\tif (this.uriIdentityService.extUri.basename(resource).startsWith('.')) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t// Ignore changes to the deleted folder\n\t\t\tif (this.uriIdentityService.extUri.basename(resource).endsWith(DELETED_FOLDER_POSTFIX)) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\ttry {\n\t\t\t\t// Check if this is a directory\n\t\t\t\tif (!(await this.fileService.stat(resource)).isDirectory) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t} catch (error) {\n\t\t\t\tif (toFileOperationResult(error) !== FileOperationResult.FILE_NOT_FOUND) {\n\t\t\t\t\tthis.logService.error(error);\n\t\t\t\t}\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t// Check if this is an extension added by another source\n\t\t\t// Extension added by another source will not have installed timestamp\n\t\t\tconst extension = await this.extensionsScanner.scanUserExtensionAtLocation(resource);\n\t\t\tif (extension && extension.installedTimestamp === undefined) {\n\t\t\t\tthis.knownDirectories.add(resource);\n\t\t\t\tadded.push(extension);\n\t\t\t}\n\t\t}\n\n\t\tif (added.length) {\n\t\t\tawait this.addExtensionsToProfile(added.map(e => [e, undefined]), this.userDataProfilesService.defaultProfile.extensionsResource);\n\t\t\tthis.logService.info('Added extensions to default profile from external source', added.map(e => e.identifier.id));\n\t\t}\n\t}\n\n\tprivate async addExtensionsToProfile(extensions: [ILocalExtension, Metadata | undefined][], profileLocation: URI): Promise<void> {\n\t\tconst localExtensions = extensions.map(e => e[0]);\n\t\tawait this.extensionsScanner.unsetExtensionsForRemoval(...localExtensions.map(extension => ExtensionKey.create(extension)));\n\t\tawait this.extensionsProfileScannerService.addExtensionsToProfile(extensions, profileLocation);\n\t\tthis._onDidInstallExtensions.fire(localExtensions.map(local => ({ local, identifier: local.identifier, operation: InstallOperation.None, profileLocation })));\n\t}\n}\n\ntype UpdateMetadataErrorClassification = {\n\towner: 'sandy081';\n\tcomment: 'Update metadata error';\n\textensionId: { classification: 'SystemMetaData'; purpose: 'FeatureInsight'; comment: 'extension identifier' };\n\tcode?: { classification: 'SystemMetaData'; purpose: 'FeatureInsight'; comment: 'error code' };\n\tisProfile?: { classification: 'SystemMetaData'; purpose: 'FeatureInsight'; comment: 'Is writing into profile' };\n};\ntype UpdateMetadataErrorEvent = {\n\textensionId: string;\n\tcode?: string;\n\tisProfile?: boolean;\n};\n\nexport class ExtensionsScanner extends Disposable {\n\n\tprivate readonly obsoletedResource: URI;\n\tprivate readonly obsoleteFileLimiter: Queue<IStringDictionary<boolean>>;\n\n\tprivate readonly _onExtract = this._register(new Emitter<URI>());\n\treadonly onExtract = this._onExtract.event;\n\n\tprivate scanAllExtensionPromise = new ResourceMap<Promise<IScannedExtension[]>>();\n\tprivate scanUserExtensionsPromise = new ResourceMap<Promise<IScannedExtension[]>>();\n\n\tconstructor(\n\t\tprivate readonly beforeRemovingExtension: (e: ILocalExtension) => Promise<void>,\n\t\t@IFileService private readonly fileService: IFileService,\n\t\t@IExtensionsScannerService private readonly extensionsScannerService: IExtensionsScannerService,\n\t\t@IExtensionsProfileScannerService private readonly extensionsProfileScannerService: IExtensionsProfileScannerService,\n\t\t@IUriIdentityService private readonly uriIdentityService: IUriIdentityService,\n\t\t@ITelemetryService private readonly telemetryService: ITelemetryService,\n\t\t@ILogService private readonly logService: ILogService,\n\t) {\n\t\tsuper();\n\t\tthis.obsoletedResource = joinPath(this.extensionsScannerService.userExtensionsLocation, '.obsolete');\n\t\tthis.obsoleteFileLimiter = new Queue();\n\t}\n\n\tasync cleanUp(): Promise<void> {\n\t\tawait this.removeTemporarilyDeletedFolders();\n\t\tawait this.deleteExtensionsMarkedForRemoval();\n\t\t//TODO: Remove this initiialization after coupe of releases\n\t\tawait this.initializeExtensionSize();\n\t}\n\n\tasync scanExtensions(type: ExtensionType | null, profileLocation: URI, productVersion: IProductVersion, language?: string): Promise<ILocalExtension[]> {\n\t\ttry {\n\t\t\tconst cacheKey: URI = profileLocation.with({ query: language });\n\t\t\tconst userScanOptions: UserExtensionsScanOptions = { includeInvalid: true, profileLocation, productVersion, language };\n\t\t\tlet scannedExtensions: IScannedExtension[] = [];\n\t\t\tif (type === null || type === ExtensionType.System) {\n\t\t\t\tlet scanAllExtensionsPromise = this.scanAllExtensionPromise.get(cacheKey);\n\t\t\t\tif (!scanAllExtensionsPromise) {\n\t\t\t\t\tscanAllExtensionsPromise = this.extensionsScannerService.scanAllExtensions({ language }, userScanOptions)\n\t\t\t\t\t\t.finally(() => this.scanAllExtensionPromise.delete(cacheKey));\n\t\t\t\t\tthis.scanAllExtensionPromise.set(cacheKey, scanAllExtensionsPromise);\n\t\t\t\t}\n\t\t\t\tscannedExtensions.push(...await scanAllExtensionsPromise);\n\t\t\t} else if (type === ExtensionType.User) {\n\t\t\t\tlet scanUserExtensionsPromise = this.scanUserExtensionsPromise.get(cacheKey);\n\t\t\t\tif (!scanUserExtensionsPromise) {\n\t\t\t\t\tscanUserExtensionsPromise = this.extensionsScannerService.scanUserExtensions(userScanOptions)\n\t\t\t\t\t\t.finally(() => this.scanUserExtensionsPromise.delete(cacheKey));\n\t\t\t\t\tthis.scanUserExtensionsPromise.set(cacheKey, scanUserExtensionsPromise);\n\t\t\t\t}\n\t\t\t\tscannedExtensions.push(...await scanUserExtensionsPromise);\n\t\t\t}\n\t\t\tscannedExtensions = type !== null ? scannedExtensions.filter(r => r.type === type) : scannedExtensions;\n\t\t\treturn await Promise.all(scannedExtensions.map(extension => this.toLocalExtension(extension)));\n\t\t} catch (error) {\n\t\t\tthrow toExtensionManagementError(error, ExtensionManagementErrorCode.Scanning);\n\t\t}\n\t}\n\n\tasync scanAllUserExtensions(): Promise<ILocalExtension[]> {\n\t\ttry {\n\t\t\tconst scannedExtensions = await this.extensionsScannerService.scanAllUserExtensions();\n\t\t\treturn await Promise.all(scannedExtensions.map(extension => this.toLocalExtension(extension)));\n\t\t} catch (error) {\n\t\t\tthrow toExtensionManagementError(error, ExtensionManagementErrorCode.Scanning);\n\t\t}\n\t}\n\n\tasync scanUserExtensionAtLocation(location: URI): Promise<ILocalExtension | null> {\n\t\ttry {\n\t\t\tconst scannedExtension = await this.extensionsScannerService.scanExistingExtension(location, ExtensionType.User, { includeInvalid: true });\n\t\t\tif (scannedExtension) {\n\t\t\t\treturn await this.toLocalExtension(scannedExtension);\n\t\t\t}\n\t\t} catch (error) {\n\t\t\tthis.logService.error(error);\n\t\t}\n\t\treturn null;\n\t}\n\n\tasync extractUserExtension(extensionKey: ExtensionKey, zipPath: string, removeIfExists: boolean, token: CancellationToken): Promise<ILocalExtension> {\n\t\tconst folderName = extensionKey.toString();\n\t\tconst tempLocation = URI.file(path.join(this.extensionsScannerService.userExtensionsLocation.fsPath, `.${generateUuid()}`));\n\t\tconst extensionLocation = URI.file(path.join(this.extensionsScannerService.userExtensionsLocation.fsPath, folderName));\n\n\t\tif (await this.fileService.exists(extensionLocation)) {\n\t\t\tif (!removeIfExists) {\n\t\t\t\ttry {\n\t\t\t\t\treturn await this.scanLocalExtension(extensionLocation, ExtensionType.User);\n\t\t\t\t} catch (error) {\n\t\t\t\t\tthis.logService.warn(`Error while scanning the existing extension at ${extensionLocation.path}. Deleting the existing extension and extracting it.`, getErrorMessage(error));\n\t\t\t\t}\n\t\t\t}\n\n\t\t\ttry {\n\t\t\t\tawait this.deleteExtensionFromLocation(extensionKey.id, extensionLocation, 'removeExisting');\n\t\t\t} catch (error) {\n\t\t\t\tthrow new ExtensionManagementError(nls.localize('errorDeleting', \"Unable to delete the existing folder '{0}' while installing the extension '{1}'. Please delete the folder manually and try again\", extensionLocation.fsPath, extensionKey.id), ExtensionManagementErrorCode.Delete);\n\t\t\t}\n\t\t}\n\n\t\ttry {\n\t\t\tif (token.isCancellationRequested) {\n\t\t\t\tthrow new CancellationError();\n\t\t\t}\n\n\t\t\t// Extract\n\t\t\ttry {\n\t\t\t\tthis.logService.trace(`Started extracting the extension from ${zipPath} to ${extensionLocation.fsPath}`);\n\t\t\t\tawait extract(zipPath, tempLocation.fsPath, { sourcePath: 'extension', overwrite: true }, token);\n\t\t\t\tthis.logService.info(`Extracted extension to ${extensionLocation}:`, extensionKey.id);\n\t\t\t} catch (e) {\n\t\t\t\tthrow fromExtractError(e);\n\t\t\t}\n\n\t\t\tconst metadata: ManifestMetadata = { installedTimestamp: Date.now(), targetPlatform: extensionKey.targetPlatform };\n\t\t\ttry {\n\t\t\t\tmetadata.size = await computeSize(tempLocation, this.fileService);\n\t\t\t} catch (error) {\n\t\t\t\t// Log & ignore\n\t\t\t\tthis.logService.warn(`Error while getting the size of the extracted extension : ${tempLocation.fsPath}`, getErrorMessage(error));\n\t\t\t}\n\n\t\t\ttry {\n\t\t\t\tawait this.extensionsScannerService.updateManifestMetadata(tempLocation, metadata);\n\t\t\t} catch (error) {\n\t\t\t\tthis.telemetryService.publicLog2<UpdateMetadataErrorEvent, UpdateMetadataErrorClassification>('extension:extract', { extensionId: extensionKey.id, code: `${toFileOperationResult(error)}` });\n\t\t\t\tthrow toExtensionManagementError(error, ExtensionManagementErrorCode.UpdateMetadata);\n\t\t\t}\n\n\t\t\tif (token.isCancellationRequested) {\n\t\t\t\tthrow new CancellationError();\n\t\t\t}\n\n\t\t\t// Rename\n\t\t\ttry {\n\t\t\t\tthis.logService.trace(`Started renaming the extension from ${tempLocation.fsPath} to ${extensionLocation.fsPath}`);\n\t\t\t\tawait this.rename(tempLocation.fsPath, extensionLocation.fsPath);\n\t\t\t\tthis.logService.info('Renamed to', extensionLocation.fsPath);\n\t\t\t} catch (error) {\n\t\t\t\tif (error.code === 'ENOTEMPTY') {\n\t\t\t\t\tthis.logService.info(`Rename failed because extension was installed by another source. So ignoring renaming.`, extensionKey.id);\n\t\t\t\t\ttry { await this.fileService.del(tempLocation, { recursive: true }); } catch (e) { /* ignore */ }\n\t\t\t\t} else {\n\t\t\t\t\tthis.logService.info(`Rename failed because of ${getErrorMessage(error)}. Deleted from extracted location`, tempLocation);\n\t\t\t\t\tthrow error;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis._onExtract.fire(extensionLocation);\n\n\t\t} catch (error) {\n\t\t\ttry { await this.fileService.del(tempLocation, { recursive: true }); } catch (e) { /* ignore */ }\n\t\t\tthrow error;\n\t\t}\n\n\t\treturn this.scanLocalExtension(extensionLocation, ExtensionType.User);\n\t}\n\n\tasync scanMetadata(local: ILocalExtension, profileLocation: URI): Promise<Metadata | undefined> {\n\t\tconst extension = await this.getScannedExtension(local, profileLocation);\n\t\treturn extension?.metadata;\n\t}\n\n\tprivate async getScannedExtension(local: ILocalExtension, profileLocation: URI): Promise<IScannedProfileExtension | undefined> {\n\t\tconst extensions = await this.extensionsProfileScannerService.scanProfileExtensions(profileLocation);\n\t\treturn extensions.find(e => areSameExtensions(e.identifier, local.identifier));\n\t}\n\n\tasync updateMetadata(local: ILocalExtension, metadata: Partial<Metadata>, profileLocation: URI): Promise<ILocalExtension> {\n\t\ttry {\n\t\t\tawait this.extensionsProfileScannerService.updateMetadata([[local, metadata]], profileLocation);\n\t\t} catch (error) {\n\t\t\tthis.telemetryService.publicLog2<UpdateMetadataErrorEvent, UpdateMetadataErrorClassification>('extension:extract', { extensionId: local.identifier.id, code: `${toFileOperationResult(error)}`, isProfile: !!profileLocation });\n\t\t\tthrow toExtensionManagementError(error, ExtensionManagementErrorCode.UpdateMetadata);\n\t\t}\n\t\treturn this.scanLocalExtension(local.location, local.type, profileLocation);\n\t}\n\n\tasync setExtensionsForRemoval(...extensions: IExtension[]): Promise<void> {\n\t\tconst extensionsToRemove = [];\n\t\tfor (const extension of extensions) {\n\t\t\tif (await this.fileService.exists(extension.location)) {\n\t\t\t\textensionsToRemove.push(extension);\n\t\t\t}\n\t\t}\n\t\tconst extensionKeys: ExtensionKey[] = extensionsToRemove.map(e => ExtensionKey.create(e));\n\t\tawait this.withRemovedExtensions(removedExtensions =>\n\t\t\textensionKeys.forEach(extensionKey => {\n\t\t\t\tremovedExtensions[extensionKey.toString()] = true;\n\t\t\t\tthis.logService.info('Marked extension as removed', extensionKey.toString());\n\t\t\t}));\n\t}\n\n\tasync unsetExtensionsForRemoval(...extensionKeys: ExtensionKey[]): Promise<boolean[]> {\n\t\ttry {\n\t\t\tconst results: boolean[] = [];\n\t\t\tawait this.withRemovedExtensions(removedExtensions =>\n\t\t\t\textensionKeys.forEach(extensionKey => {\n\t\t\t\t\tif (removedExtensions[extensionKey.toString()]) {\n\t\t\t\t\t\tresults.push(true);\n\t\t\t\t\t\tdelete removedExtensions[extensionKey.toString()];\n\t\t\t\t\t} else {\n\t\t\t\t\t\tresults.push(false);\n\t\t\t\t\t}\n\t\t\t\t}));\n\t\t\treturn results;\n\t\t} catch (error) {\n\t\t\tthrow toExtensionManagementError(error, ExtensionManagementErrorCode.UnsetRemoved);\n\t\t}\n\t}\n\n\tasync deleteExtension(extension: ILocalExtension | IScannedExtension, type: string): Promise<void> {\n\t\tif (this.uriIdentityService.extUri.isEqualOrParent(extension.location, this.extensionsScannerService.userExtensionsLocation)) {\n\t\t\tawait this.deleteExtensionFromLocation(extension.identifier.id, extension.location, type);\n\t\t\tawait this.unsetExtensionsForRemoval(ExtensionKey.create(extension));\n\t\t}\n\t}\n\n\tasync copyExtension(extension: ILocalExtension, fromProfileLocation: URI, toProfileLocation: URI, metadata: Partial<Metadata>): Promise<ILocalExtension> {\n\t\tconst source = await this.getScannedExtension(extension, fromProfileLocation);\n\t\tconst target = await this.getScannedExtension(extension, toProfileLocation);\n\t\tmetadata = { ...source?.metadata, ...metadata };\n\n\t\tif (target) {\n\t\t\tif (this.uriIdentityService.extUri.isEqual(target.location, extension.location)) {\n\t\t\t\tawait this.extensionsProfileScannerService.updateMetadata([[extension, { ...target.metadata, ...metadata }]], toProfileLocation);\n\t\t\t} else {\n\t\t\t\tconst targetExtension = await this.scanLocalExtension(target.location, extension.type, toProfileLocation);\n\t\t\t\tawait this.extensionsProfileScannerService.removeExtensionsFromProfile([targetExtension.identifier], toProfileLocation);\n\t\t\t\tawait this.extensionsProfileScannerService.addExtensionsToProfile([[extension, { ...target.metadata, ...metadata }]], toProfileLocation);\n\t\t\t}\n\t\t} else {\n\t\t\tawait this.extensionsProfileScannerService.addExtensionsToProfile([[extension, metadata]], toProfileLocation);\n\t\t}\n\n\t\treturn this.scanLocalExtension(extension.location, extension.type, toProfileLocation);\n\t}\n\n\tasync moveExtension(extension: ILocalExtension, fromProfileLocation: URI, toProfileLocation: URI, metadata: Partial<Metadata>): Promise<ILocalExtension> {\n\t\tconst source = await this.getScannedExtension(extension, fromProfileLocation);\n\t\tconst target = await this.getScannedExtension(extension, toProfileLocation);\n\t\tmetadata = { ...source?.metadata, ...metadata };\n\n\t\tif (target) {\n\t\t\tif (this.uriIdentityService.extUri.isEqual(target.location, extension.location)) {\n\t\t\t\tawait this.extensionsProfileScannerService.updateMetadata([[extension, { ...target.metadata, ...metadata }]], toProfileLocation);\n\t\t\t} else {\n\t\t\t\tconst targetExtension = await this.scanLocalExtension(target.location, extension.type, toProfileLocation);\n\t\t\t\tawait this.removeExtension(targetExtension.identifier, toProfileLocation);\n\t\t\t\tawait this.extensionsProfileScannerService.addExtensionsToProfile([[extension, { ...target.metadata, ...metadata }]], toProfileLocation);\n\t\t\t}\n\t\t} else {\n\t\t\tawait this.extensionsProfileScannerService.addExtensionsToProfile([[extension, metadata]], toProfileLocation);\n\t\t\tif (source) {\n\t\t\t\tawait this.removeExtension(source.identifier, fromProfileLocation);\n\t\t\t}\n\t\t}\n\n\t\treturn this.scanLocalExtension(extension.location, extension.type, toProfileLocation);\n\t}\n\n\tasync removeExtension(identifier: IExtensionIdentifier, fromProfileLocation: URI): Promise<void> {\n\t\tawait this.extensionsProfileScannerService.removeExtensionsFromProfile([identifier], fromProfileLocation);\n\t}\n\n\tasync copyExtensions(fromProfileLocation: URI, toProfileLocation: URI, productVersion: IProductVersion): Promise<void> {\n\t\tconst fromExtensions = await this.scanExtensions(ExtensionType.User, fromProfileLocation, productVersion);\n\t\tconst extensions: [ILocalExtension, Metadata | undefined][] = await Promise.all(fromExtensions\n\t\t\t.filter(e => !e.isApplicationScoped) /* remove application scoped extensions */\n\t\t\t.map(async e => ([e, await this.scanMetadata(e, fromProfileLocation)])));\n\t\tawait this.extensionsProfileScannerService.addExtensionsToProfile(extensions, toProfileLocation);\n\t}\n\n\tprivate async deleteExtensionFromLocation(id: string, location: URI, type: string): Promise<void> {\n\t\tthis.logService.trace(`Deleting ${type} extension from disk`, id, location.fsPath);\n\t\tconst renamedLocation = this.uriIdentityService.extUri.joinPath(this.uriIdentityService.extUri.dirname(location), `${this.uriIdentityService.extUri.basename(location)}.${hash(generateUuid()).toString(16)}${DELETED_FOLDER_POSTFIX}`);\n\t\tawait this.rename(location.fsPath, renamedLocation.fsPath);\n\t\tawait this.fileService.del(renamedLocation, { recursive: true });\n\t\tthis.logService.info(`Deleted ${type} extension from disk`, id, location.fsPath);\n\t}\n\n\tprivate withRemovedExtensions(updateFn?: (removed: IStringDictionary<boolean>) => void): Promise<IStringDictionary<boolean>> {\n\t\treturn this.obsoleteFileLimiter.queue(async () => {\n\t\t\tlet raw: string | undefined;\n\t\t\ttry {\n\t\t\t\tconst content = await this.fileService.readFile(this.obsoletedResource, 'utf8');\n\t\t\t\traw = content.value.toString();\n\t\t\t} catch (error) {\n\t\t\t\tif (toFileOperationResult(error) !== FileOperationResult.FILE_NOT_FOUND) {\n\t\t\t\t\tthrow error;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tlet removed = {};\n\t\t\tif (raw) {\n\t\t\t\ttry {\n\t\t\t\t\tremoved = JSON.parse(raw);\n\t\t\t\t} catch (e) { /* ignore */ }\n\t\t\t}\n\n\t\t\tif (updateFn) {\n\t\t\t\tupdateFn(removed);\n\t\t\t\tif (Object.keys(removed).length) {\n\t\t\t\t\tawait this.fileService.writeFile(this.obsoletedResource, VSBuffer.fromString(JSON.stringify(removed)));\n\t\t\t\t} else {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tawait this.fileService.del(this.obsoletedResource);\n\t\t\t\t\t} catch (error) {\n\t\t\t\t\t\tif (toFileOperationResult(error) !== FileOperationResult.FILE_NOT_FOUND) {\n\t\t\t\t\t\t\tthrow error;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn removed;\n\t\t});\n\t}\n\n\tprivate async rename(extractPath: string, renamePath: string): Promise<void> {\n\t\ttry {\n\t\t\tawait pfs.Promises.rename(extractPath, renamePath, 2 * 60 * 1000 /* Retry for 2 minutes */);\n\t\t} catch (error) {\n\t\t\tthrow toExtensionManagementError(error, ExtensionManagementErrorCode.Rename);\n\t\t}\n\t}\n\n\tasync scanLocalExtension(location: URI, type: ExtensionType, profileLocation?: URI): Promise<ILocalExtension> {\n\t\ttry {\n\t\t\tif (profileLocation) {\n\t\t\t\tconst scannedExtensions = await this.extensionsScannerService.scanUserExtensions({ profileLocation });\n\t\t\t\tconst scannedExtension = scannedExtensions.find(e => this.uriIdentityService.extUri.isEqual(e.location, location));\n\t\t\t\tif (scannedExtension) {\n\t\t\t\t\treturn await this.toLocalExtension(scannedExtension);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tconst scannedExtension = await this.extensionsScannerService.scanExistingExtension(location, type, { includeInvalid: true });\n\t\t\t\tif (scannedExtension) {\n\t\t\t\t\treturn await this.toLocalExtension(scannedExtension);\n\t\t\t\t}\n\t\t\t}\n\t\t\tthrow new ExtensionManagementError(nls.localize('cannot read', \"Cannot read the extension from {0}\", location.path), ExtensionManagementErrorCode.ScanningExtension);\n\t\t} catch (error) {\n\t\t\tthrow toExtensionManagementError(error, ExtensionManagementErrorCode.ScanningExtension);\n\t\t}\n\t}\n\n\tprivate async toLocalExtension(extension: IScannedExtension): Promise<ILocalExtension> {\n\t\tlet stat: IFileStat | undefined;\n\t\ttry {\n\t\t\tstat = await this.fileService.resolve(extension.location);\n\t\t} catch (error) {/* ignore */ }\n\n\t\tlet readmeUrl: URI | undefined;\n\t\tlet changelogUrl: URI | undefined;\n\t\tif (stat?.children) {\n\t\t\treadmeUrl = stat.children.find(({ name }) => /^readme(\\.txt|\\.md|)$/i.test(name))?.resource;\n\t\t\tchangelogUrl = stat.children.find(({ name }) => /^changelog(\\.txt|\\.md|)$/i.test(name))?.resource;\n\t\t}\n\t\treturn {\n\t\t\tidentifier: extension.identifier,\n\t\t\ttype: extension.type,\n\t\t\tisBuiltin: extension.isBuiltin || !!extension.metadata?.isBuiltin,\n\t\t\tlocation: extension.location,\n\t\t\tmanifest: extension.manifest,\n\t\t\ttargetPlatform: extension.targetPlatform,\n\t\t\tvalidations: extension.validations,\n\t\t\tisValid: extension.isValid,\n\t\t\treadmeUrl,\n\t\t\tchangelogUrl,\n\t\t\tpublisherDisplayName: extension.metadata?.publisherDisplayName,\n\t\t\tpublisherId: extension.metadata?.publisherId || null,\n\t\t\tisApplicationScoped: !!extension.metadata?.isApplicationScoped,\n\t\t\tisMachineScoped: !!extension.metadata?.isMachineScoped,\n\t\t\tisPreReleaseVersion: !!extension.metadata?.isPreReleaseVersion,\n\t\t\thasPreReleaseVersion: !!extension.metadata?.hasPreReleaseVersion,\n\t\t\tpreRelease: extension.preRelease,\n\t\t\tinstalledTimestamp: extension.metadata?.installedTimestamp,\n\t\t\tupdated: !!extension.metadata?.updated,\n\t\t\tpinned: !!extension.metadata?.pinned,\n\t\t\tprivate: !!extension.metadata?.private,\n\t\t\tisWorkspaceScoped: false,\n\t\t\tsource: extension.metadata?.source ?? (extension.identifier.uuid ? 'gallery' : 'vsix'),\n\t\t\tsize: extension.metadata?.size ?? 0,\n\t\t};\n\t}\n\n\tprivate async initializeExtensionSize(): Promise<void> {\n\t\tconst extensions = await this.extensionsScannerService.scanAllUserExtensions();\n\t\tawait Promise.all(extensions.map(async extension => {\n\t\t\t// set size if not set before\n\t\t\tif (isDefined(extension.metadata?.installedTimestamp) && isUndefined(extension.metadata?.size)) {\n\t\t\t\tconst size = await computeSize(extension.location, this.fileService);\n\t\t\t\tawait this.extensionsScannerService.updateManifestMetadata(extension.location, { size });\n\t\t\t}\n\t\t}));\n\t}\n\n\tprivate async deleteExtensionsMarkedForRemoval(): Promise<void> {\n\t\tlet removed: IStringDictionary<boolean>;\n\t\ttry {\n\t\t\tremoved = await this.withRemovedExtensions();\n\t\t} catch (error) {\n\t\t\tthrow toExtensionManagementError(error, ExtensionManagementErrorCode.ReadRemoved);\n\t\t}\n\n\t\tif (Object.keys(removed).length === 0) {\n\t\t\tthis.logService.debug(`No extensions are marked as removed.`);\n\t\t\treturn;\n\t\t}\n\n\t\tthis.logService.debug(`Deleting extensions marked as removed:`, Object.keys(removed));\n\n\t\tconst extensions = await this.scanAllUserExtensions();\n\t\tconst installed: Set<string> = new Set<string>();\n\t\tfor (const e of extensions) {\n\t\t\tif (!removed[ExtensionKey.create(e).toString()]) {\n\t\t\t\tinstalled.add(e.identifier.id.toLowerCase());\n\t\t\t}\n\t\t}\n\n\t\ttry {\n\t\t\t// running post uninstall tasks for extensions that are not installed anymore\n\t\t\tconst byExtension = groupByExtension(extensions, e => e.identifier);\n\t\t\tawait Promises.settled(byExtension.map(async e => {\n\t\t\t\tconst latest = e.sort((a, b) => semver.rcompare(a.manifest.version, b.manifest.version))[0];\n\t\t\t\tif (!installed.has(latest.identifier.id.toLowerCase())) {\n\t\t\t\t\tawait this.beforeRemovingExtension(latest);\n\t\t\t\t}\n\t\t\t}));\n\t\t} catch (error) {\n\t\t\tthis.logService.error(error);\n\t\t}\n\n\t\tconst toRemove = extensions.filter(e => e.installedTimestamp /* Installed by System */ && removed[ExtensionKey.create(e).toString()]);\n\t\tawait Promise.allSettled(toRemove.map(e => this.deleteExtension(e, 'marked for removal')));\n\t}\n\n\tprivate async removeTemporarilyDeletedFolders(): Promise<void> {\n\t\tthis.logService.trace('ExtensionManagementService#removeTempDeleteFolders');\n\n\t\tlet stat;\n\t\ttry {\n\t\t\tstat = await this.fileService.resolve(this.extensionsScannerService.userExtensionsLocation);\n\t\t} catch (error) {\n\t\t\tif (toFileOperationResult(error) !== FileOperationResult.FILE_NOT_FOUND) {\n\t\t\t\tthis.logService.error(error);\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\n\t\tif (!stat?.children) {\n\t\t\treturn;\n\t\t}\n\n\t\ttry {\n\t\t\tawait Promise.allSettled(stat.children.map(async child => {\n\t\t\t\tif (!child.isDirectory || !child.name.endsWith(DELETED_FOLDER_POSTFIX)) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tthis.logService.trace('Deleting the temporarily deleted folder', child.resource.toString());\n\t\t\t\ttry {\n\t\t\t\t\tawait this.fileService.del(child.resource, { recursive: true });\n\t\t\t\t\tthis.logService.trace('Deleted the temporarily deleted folder', child.resource.toString());\n\t\t\t\t} catch (error) {\n\t\t\t\t\tif (toFileOperationResult(error) !== FileOperationResult.FILE_NOT_FOUND) {\n\t\t\t\t\t\tthis.logService.error(error);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}));\n\t\t} catch (error) { /* ignore */ }\n\t}\n\n}\n\nclass InstallExtensionInProfileTask extends AbstractExtensionTask<ILocalExtension> implements IInstallExtensionTask {\n\n\tprivate _operation = InstallOperation.Install;\n\tget operation() { return this.options.operation ?? this._operation; }\n\n\tprivate _verificationStatus: ExtensionSignatureVerificationCode | undefined;\n\tget verificationStatus() { return this._verificationStatus; }\n\n\treadonly identifier: IExtensionIdentifier;\n\n\tconstructor(\n\t\tprivate readonly extensionKey: ExtensionKey,\n\t\treadonly manifest: IExtensionManifest,\n\t\treadonly source: IGalleryExtension | URI,\n\t\treadonly options: InstallExtensionTaskOptions,\n\t\tprivate readonly extractExtensionFn: (operation: InstallOperation, token: CancellationToken) => Promise<ExtractExtensionResult>,\n\t\tprivate readonly extensionsScanner: ExtensionsScanner,\n\t\t@IUriIdentityService private readonly uriIdentityService: IUriIdentityService,\n\t\t@IExtensionGalleryService private readonly galleryService: IExtensionGalleryService,\n\t\t@IUserDataProfilesService private readonly userDataProfilesService: IUserDataProfilesService,\n\t\t@IExtensionsScannerService private readonly extensionsScannerService: IExtensionsScannerService,\n\t\t@IExtensionsProfileScannerService private readonly extensionsProfileScannerService: IExtensionsProfileScannerService,\n\t\t@ILogService private readonly logService: ILogService,\n\t) {\n\t\tsuper();\n\t\tthis.identifier = this.extensionKey.identifier;\n\t}\n\n\tprotected async doRun(token: CancellationToken): Promise<ILocalExtension> {\n\t\tconst installed = await this.extensionsScanner.scanExtensions(ExtensionType.User, this.options.profileLocation, this.options.productVersion);\n\t\tconst existingExtension = installed.find(i => areSameExtensions(i.identifier, this.identifier));\n\t\tif (existingExtension) {\n\t\t\tthis._operation = InstallOperation.Update;\n\t\t}\n\n\t\tconst metadata: Metadata = {\n\t\t\tisApplicationScoped: this.options.isApplicationScoped || existingExtension?.isApplicationScoped,\n\t\t\tisMachineScoped: this.options.isMachineScoped || existingExtension?.isMachineScoped,\n\t\t\tisBuiltin: this.options.isBuiltin || existingExtension?.isBuiltin,\n\t\t\tisSystem: existingExtension?.type === ExtensionType.System ? true : undefined,\n\t\t\tinstalledTimestamp: Date.now(),\n\t\t\tpinned: this.options.installGivenVersion ? true : (this.options.pinned ?? existingExtension?.pinned),\n\t\t\tsource: this.source instanceof URI ? 'vsix' : 'gallery',\n\t\t};\n\n\t\tlet local: ILocalExtension | undefined;\n\n\t\t// VSIX\n\t\tif (this.source instanceof URI) {\n\t\t\tif (existingExtension) {\n\t\t\t\tif (this.extensionKey.equals(new ExtensionKey(existingExtension.identifier, existingExtension.manifest.version))) {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tawait this.extensionsScanner.deleteExtension(existingExtension, 'existing');\n\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\tthrow new Error(nls.localize('restartCode', \"Please restart VS Code before reinstalling {0}.\", this.manifest.displayName || this.manifest.name));\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\t// Remove the extension with same version if it is already uninstalled.\n\t\t\t// Installing a VSIX extension shall replace the existing extension always.\n\t\t\tconst existingWithSameVersion = await this.unsetIfRemoved(this.extensionKey);\n\t\t\tif (existingWithSameVersion) {\n\t\t\t\ttry {\n\t\t\t\t\tawait this.extensionsScanner.deleteExtension(existingWithSameVersion, 'existing');\n\t\t\t\t} catch (e) {\n\t\t\t\t\tthrow new Error(nls.localize('restartCode', \"Please restart VS Code before reinstalling {0}.\", this.manifest.displayName || this.manifest.name));\n\t\t\t\t}\n\t\t\t}\n\n\t\t}\n\n\t\t// Gallery\n\t\telse {\n\t\t\tmetadata.id = this.source.identifier.uuid;\n\t\t\tmetadata.publisherId = this.source.publisherId;\n\t\t\tmetadata.publisherDisplayName = this.source.publisherDisplayName;\n\t\t\tmetadata.targetPlatform = this.source.properties.targetPlatform;\n\t\t\tmetadata.updated = !!existingExtension;\n\t\t\tmetadata.private = this.source.private;\n\t\t\tmetadata.isPreReleaseVersion = this.source.properties.isPreReleaseVersion;\n\t\t\tmetadata.hasPreReleaseVersion = existingExtension?.hasPreReleaseVersion || this.source.properties.isPreReleaseVersion;\n\t\t\tmetadata.preRelease = isBoolean(this.options.preRelease)\n\t\t\t\t? this.options.preRelease\n\t\t\t\t: this.options.installPreReleaseVersion || this.source.properties.isPreReleaseVersion || existingExtension?.preRelease;\n\n\t\t\tif (existingExtension && existingExtension.type !== ExtensionType.System && existingExtension.manifest.version === this.source.version) {\n\t\t\t\treturn this.extensionsScanner.updateMetadata(existingExtension, metadata, this.options.profileLocation);\n\t\t\t}\n\n\t\t\t// Unset if the extension is uninstalled and return the unset extension.\n\t\t\tlocal = await this.unsetIfRemoved(this.extensionKey);\n\t\t}\n\n\t\tif (token.isCancellationRequested) {\n\t\t\tthrow toExtensionManagementError(new CancellationError());\n\t\t}\n\n\t\tif (!local) {\n\t\t\tconst result = await this.extractExtensionFn(this.operation, token);\n\t\t\tlocal = result.local;\n\t\t\tthis._verificationStatus = result.verificationStatus;\n\t\t}\n\n\t\tif (this.uriIdentityService.extUri.isEqual(this.userDataProfilesService.defaultProfile.extensionsResource, this.options.profileLocation)) {\n\t\t\ttry {\n\t\t\t\tawait this.extensionsScannerService.initializeDefaultProfileExtensions();\n\t\t\t} catch (error) {\n\t\t\t\tthrow toExtensionManagementError(error, ExtensionManagementErrorCode.IntializeDefaultProfile);\n\t\t\t}\n\t\t}\n\n\t\tif (token.isCancellationRequested) {\n\t\t\tthrow toExtensionManagementError(new CancellationError());\n\t\t}\n\n\t\ttry {\n\t\t\tawait this.extensionsProfileScannerService.addExtensionsToProfile([[local, metadata]], this.options.profileLocation, !local.isValid);\n\t\t} catch (error) {\n\t\t\tthrow toExtensionManagementError(error, ExtensionManagementErrorCode.AddToProfile);\n\t\t}\n\n\t\tconst result = await this.extensionsScanner.scanLocalExtension(local.location, ExtensionType.User, this.options.profileLocation);\n\t\tif (!result) {\n\t\t\tthrow new ExtensionManagementError('Cannot find the installed extension', ExtensionManagementErrorCode.InstalledExtensionNotFound);\n\t\t}\n\n\t\tif (this.source instanceof URI) {\n\t\t\tthis.updateMetadata(local, token);\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tprivate async unsetIfRemoved(extensionKey: ExtensionKey): Promise<ILocalExtension | undefined> {\n\t\t// If the same version of extension is marked as removed, remove it from there and return the local.\n\t\tconst [removed] = await this.extensionsScanner.unsetExtensionsForRemoval(extensionKey);\n\t\tif (removed) {\n\t\t\tthis.logService.info('Removed the extension from removed list:', extensionKey.id);\n\t\t\tconst userExtensions = await this.extensionsScanner.scanAllUserExtensions();\n\t\t\treturn userExtensions.find(i => ExtensionKey.create(i).equals(extensionKey));\n\t\t}\n\t\treturn undefined;\n\t}\n\n\tprivate async updateMetadata(extension: ILocalExtension, token: CancellationToken): Promise<void> {\n\t\ttry {\n\t\t\tlet [galleryExtension] = await this.galleryService.getExtensions([{ id: extension.identifier.id, version: extension.manifest.version }], token);\n\t\t\tif (!galleryExtension) {\n\t\t\t\t[galleryExtension] = await this.galleryService.getExtensions([{ id: extension.identifier.id }], token);\n\t\t\t}\n\t\t\tif (galleryExtension) {\n\t\t\t\tconst metadata = {\n\t\t\t\t\tid: galleryExtension.identifier.uuid,\n\t\t\t\t\tpublisherDisplayName: galleryExtension.publisherDisplayName,\n\t\t\t\t\tpublisherId: galleryExtension.publisherId,\n\t\t\t\t\tisPreReleaseVersion: galleryExtension.properties.isPreReleaseVersion,\n\t\t\t\t\thasPreReleaseVersion: extension.hasPreReleaseVersion || galleryExtension.properties.isPreReleaseVersion,\n\t\t\t\t\tpreRelease: galleryExtension.properties.isPreReleaseVersion || this.options.installPreReleaseVersion\n\t\t\t\t};\n\t\t\t\tawait this.extensionsScanner.updateMetadata(extension, metadata, this.options.profileLocation);\n\t\t\t}\n\t\t} catch (error) {\n\t\t\t/* Ignore Error */\n\t\t}\n\t}\n}\n\nclass UninstallExtensionInProfileTask extends AbstractExtensionTask<void> implements IUninstallExtensionTask {\n\n\tconstructor(\n\t\treadonly extension: ILocalExtension,\n\t\treadonly options: UninstallExtensionTaskOptions,\n\t\tprivate readonly extensionsProfileScannerService: IExtensionsProfileScannerService,\n\t) {\n\t\tsuper();\n\t}\n\n\tprotected doRun(token: CancellationToken): Promise<void> {\n\t\treturn this.extensionsProfileScannerService.removeExtensionsFromProfile([this.extension.identifier], this.options.profileLocation);\n\t}\n\n}\n"]}