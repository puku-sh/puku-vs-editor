{"version":3,"sources":["vs/platform/extensionManagement/common/extensionsScannerService.ts"],"names":[],"mappings":"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","file":"extensionsScannerService.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { coalesce } from '../../../base/common/arrays.js';\nimport { ThrottledDelayer } from '../../../base/common/async.js';\nimport * as objects from '../../../base/common/objects.js';\nimport { VSBuffer } from '../../../base/common/buffer.js';\nimport { getErrorMessage } from '../../../base/common/errors.js';\nimport { getNodeType, parse, ParseError } from '../../../base/common/json.js';\nimport { getParseErrorMessage } from '../../../base/common/jsonErrorMessages.js';\nimport { Disposable } from '../../../base/common/lifecycle.js';\nimport { FileAccess, Schemas } from '../../../base/common/network.js';\nimport * as path from '../../../base/common/path.js';\nimport * as platform from '../../../base/common/platform.js';\nimport { basename, isEqual, joinPath } from '../../../base/common/resources.js';\nimport * as semver from '../../../base/common/semver/semver.js';\nimport Severity from '../../../base/common/severity.js';\nimport { URI } from '../../../base/common/uri.js';\nimport { localize } from '../../../nls.js';\nimport { IEnvironmentService } from '../../environment/common/environment.js';\nimport { IProductVersion, Metadata } from './extensionManagement.js';\nimport { areSameExtensions, computeTargetPlatform, getExtensionId, getGalleryExtensionId } from './extensionManagementUtil.js';\nimport { ExtensionType, ExtensionIdentifier, IExtensionManifest, TargetPlatform, IExtensionIdentifier, IRelaxedExtensionManifest, UNDEFINED_PUBLISHER, IExtensionDescription, BUILTIN_MANIFEST_CACHE_FILE, USER_MANIFEST_CACHE_FILE, ExtensionIdentifierMap, parseEnabledApiProposalNames } from '../../extensions/common/extensions.js';\nimport { validateExtensionManifest } from '../../extensions/common/extensionValidator.js';\nimport { FileOperationResult, IFileService, toFileOperationResult } from '../../files/common/files.js';\nimport { createDecorator, IInstantiationService } from '../../instantiation/common/instantiation.js';\nimport { ILogService } from '../../log/common/log.js';\nimport { IProductService } from '../../product/common/productService.js';\nimport { Emitter, Event } from '../../../base/common/event.js';\nimport { revive } from '../../../base/common/marshalling.js';\nimport { ExtensionsProfileScanningError, ExtensionsProfileScanningErrorCode, IExtensionsProfileScannerService, IProfileExtensionsScanOptions, IScannedProfileExtension } from './extensionsProfileScannerService.js';\nimport { IUserDataProfile, IUserDataProfilesService } from '../../userDataProfile/common/userDataProfile.js';\nimport { IUriIdentityService } from '../../uriIdentity/common/uriIdentity.js';\nimport { localizeManifest } from './extensionNls.js';\n\nexport type ManifestMetadata = Partial<{\n\ttargetPlatform: TargetPlatform;\n\tinstalledTimestamp: number;\n\tsize: number;\n}>;\n\nexport type IScannedExtensionManifest = IRelaxedExtensionManifest & { __metadata?: ManifestMetadata };\n\ninterface IRelaxedScannedExtension {\n\ttype: ExtensionType;\n\tisBuiltin: boolean;\n\tidentifier: IExtensionIdentifier;\n\tmanifest: IRelaxedExtensionManifest;\n\tlocation: URI;\n\ttargetPlatform: TargetPlatform;\n\tpublisherDisplayName?: string;\n\tmetadata: Metadata | undefined;\n\tisValid: boolean;\n\tvalidations: readonly [Severity, string][];\n\tpreRelease: boolean;\n}\n\nexport type IScannedExtension = Readonly<IRelaxedScannedExtension> & { manifest: IExtensionManifest };\n\nexport interface Translations {\n\t[id: string]: string;\n}\n\nexport namespace Translations {\n\texport function equals(a: Translations, b: Translations): boolean {\n\t\tif (a === b) {\n\t\t\treturn true;\n\t\t}\n\t\tconst aKeys = Object.keys(a);\n\t\tconst bKeys: Set<string> = new Set<string>();\n\t\tfor (const key of Object.keys(b)) {\n\t\t\tbKeys.add(key);\n\t\t}\n\t\tif (aKeys.length !== bKeys.size) {\n\t\t\treturn false;\n\t\t}\n\n\t\tfor (const key of aKeys) {\n\t\t\tif (a[key] !== b[key]) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tbKeys.delete(key);\n\t\t}\n\t\treturn bKeys.size === 0;\n\t}\n}\n\ninterface MessageBag {\n\t[key: string]: string | { message: string; comment: string[] };\n}\n\ninterface TranslationBundle {\n\tcontents: {\n\t\tpackage: MessageBag;\n\t};\n}\n\ninterface LocalizedMessages {\n\tvalues: MessageBag | undefined;\n\tdefault: URI | null;\n}\n\ninterface IBuiltInExtensionControl {\n\t[name: string]: 'marketplace' | 'disabled' | string;\n}\n\nexport type SystemExtensionsScanOptions = {\n\treadonly checkControlFile?: boolean;\n\treadonly language?: string;\n};\n\nexport type UserExtensionsScanOptions = {\n\treadonly profileLocation: URI;\n\treadonly includeInvalid?: boolean;\n\treadonly language?: string;\n\treadonly useCache?: boolean;\n\treadonly productVersion?: IProductVersion;\n};\n\nexport type ScanOptions = {\n\treadonly includeInvalid?: boolean;\n\treadonly language?: string;\n};\n\nexport const IExtensionsScannerService = createDecorator<IExtensionsScannerService>('IExtensionsScannerService');\nexport interface IExtensionsScannerService {\n\treadonly _serviceBrand: undefined;\n\n\treadonly systemExtensionsLocation: URI;\n\treadonly userExtensionsLocation: URI;\n\treadonly onDidChangeCache: Event<ExtensionType>;\n\n\tscanAllExtensions(systemScanOptions: SystemExtensionsScanOptions, userScanOptions: UserExtensionsScanOptions): Promise<IScannedExtension[]>;\n\tscanSystemExtensions(scanOptions: SystemExtensionsScanOptions): Promise<IScannedExtension[]>;\n\tscanUserExtensions(scanOptions: UserExtensionsScanOptions): Promise<IScannedExtension[]>;\n\tscanAllUserExtensions(): Promise<IScannedExtension[]>;\n\n\tscanExtensionsUnderDevelopment(existingExtensions: IScannedExtension[], scanOptions: ScanOptions): Promise<IScannedExtension[]>;\n\tscanExistingExtension(extensionLocation: URI, extensionType: ExtensionType, scanOptions: ScanOptions): Promise<IScannedExtension | null>;\n\tscanMultipleExtensions(extensionLocations: URI[], extensionType: ExtensionType, scanOptions: ScanOptions): Promise<IScannedExtension[]>;\n\tscanOneOrMultipleExtensions(extensionLocation: URI, extensionType: ExtensionType, scanOptions: ScanOptions): Promise<IScannedExtension[]>;\n\n\tupdateManifestMetadata(extensionLocation: URI, metadata: ManifestMetadata): Promise<void>;\n\tinitializeDefaultProfileExtensions(): Promise<void>;\n}\n\nexport abstract class AbstractExtensionsScannerService extends Disposable implements IExtensionsScannerService {\n\n\treadonly _serviceBrand: undefined;\n\n\tprotected abstract getTranslations(language: string): Promise<Translations>;\n\n\tprivate readonly _onDidChangeCache = this._register(new Emitter<ExtensionType>());\n\treadonly onDidChangeCache = this._onDidChangeCache.event;\n\n\tprivate readonly systemExtensionsCachedScanner: CachedExtensionsScanner;\n\tprivate readonly userExtensionsCachedScanner: CachedExtensionsScanner;\n\tprivate readonly extensionsScanner: ExtensionsScanner;\n\n\tconstructor(\n\t\treadonly systemExtensionsLocation: URI,\n\t\treadonly userExtensionsLocation: URI,\n\t\tprivate readonly extensionsControlLocation: URI,\n\t\tcurrentProfile: IUserDataProfile,\n\t\t@IUserDataProfilesService private readonly userDataProfilesService: IUserDataProfilesService,\n\t\t@IExtensionsProfileScannerService protected readonly extensionsProfileScannerService: IExtensionsProfileScannerService,\n\t\t@IFileService protected readonly fileService: IFileService,\n\t\t@ILogService protected readonly logService: ILogService,\n\t\t@IEnvironmentService private readonly environmentService: IEnvironmentService,\n\t\t@IProductService private readonly productService: IProductService,\n\t\t@IUriIdentityService private readonly uriIdentityService: IUriIdentityService,\n\t\t@IInstantiationService private readonly instantiationService: IInstantiationService,\n\t) {\n\t\tsuper();\n\n\t\tthis.systemExtensionsCachedScanner = this._register(this.instantiationService.createInstance(CachedExtensionsScanner, currentProfile));\n\t\tthis.userExtensionsCachedScanner = this._register(this.instantiationService.createInstance(CachedExtensionsScanner, currentProfile));\n\t\tthis.extensionsScanner = this._register(this.instantiationService.createInstance(ExtensionsScanner));\n\n\t\tthis._register(this.systemExtensionsCachedScanner.onDidChangeCache(() => this._onDidChangeCache.fire(ExtensionType.System)));\n\t\tthis._register(this.userExtensionsCachedScanner.onDidChangeCache(() => this._onDidChangeCache.fire(ExtensionType.User)));\n\t}\n\n\tprivate _targetPlatformPromise: Promise<TargetPlatform> | undefined;\n\tprivate getTargetPlatform(): Promise<TargetPlatform> {\n\t\tif (!this._targetPlatformPromise) {\n\t\t\tthis._targetPlatformPromise = computeTargetPlatform(this.fileService, this.logService);\n\t\t}\n\t\treturn this._targetPlatformPromise;\n\t}\n\n\tasync scanAllExtensions(systemScanOptions: SystemExtensionsScanOptions, userScanOptions: UserExtensionsScanOptions): Promise<IScannedExtension[]> {\n\t\tconst [system, user] = await Promise.all([\n\t\t\tthis.scanSystemExtensions(systemScanOptions),\n\t\t\tthis.scanUserExtensions(userScanOptions),\n\t\t]);\n\t\treturn this.dedupExtensions(system, user, [], await this.getTargetPlatform(), true);\n\t}\n\n\tasync scanSystemExtensions(scanOptions: SystemExtensionsScanOptions): Promise<IScannedExtension[]> {\n\t\tconst promises: Promise<IRelaxedScannedExtension[]>[] = [];\n\t\tpromises.push(this.scanDefaultSystemExtensions(scanOptions.language));\n\t\tpromises.push(this.scanDevSystemExtensions(scanOptions.language, !!scanOptions.checkControlFile));\n\t\tconst [defaultSystemExtensions, devSystemExtensions] = await Promise.all(promises);\n\t\treturn this.applyScanOptions([...defaultSystemExtensions, ...devSystemExtensions], ExtensionType.System, { pickLatest: false });\n\t}\n\n\tasync scanUserExtensions(scanOptions: UserExtensionsScanOptions): Promise<IScannedExtension[]> {\n\t\tthis.logService.trace('Started scanning user extensions', scanOptions.profileLocation);\n\t\tconst profileScanOptions: IProfileExtensionsScanOptions | undefined = this.uriIdentityService.extUri.isEqual(scanOptions.profileLocation, this.userDataProfilesService.defaultProfile.extensionsResource) ? { bailOutWhenFileNotFound: true } : undefined;\n\t\tconst extensionsScannerInput = await this.createExtensionScannerInput(scanOptions.profileLocation, true, ExtensionType.User, scanOptions.language, true, profileScanOptions, scanOptions.productVersion ?? this.getProductVersion());\n\t\tconst extensionsScanner = scanOptions.useCache && !extensionsScannerInput.devMode ? this.userExtensionsCachedScanner : this.extensionsScanner;\n\t\tlet extensions: IRelaxedScannedExtension[];\n\t\ttry {\n\t\t\textensions = await extensionsScanner.scanExtensions(extensionsScannerInput);\n\t\t} catch (error) {\n\t\t\tif (error instanceof ExtensionsProfileScanningError && error.code === ExtensionsProfileScanningErrorCode.ERROR_PROFILE_NOT_FOUND) {\n\t\t\t\tawait this.doInitializeDefaultProfileExtensions();\n\t\t\t\textensions = await extensionsScanner.scanExtensions(extensionsScannerInput);\n\t\t\t} else {\n\t\t\t\tthrow error;\n\t\t\t}\n\t\t}\n\t\textensions = await this.applyScanOptions(extensions, ExtensionType.User, { includeInvalid: scanOptions.includeInvalid, pickLatest: true });\n\t\tthis.logService.trace('Scanned user extensions:', extensions.length);\n\t\treturn extensions;\n\t}\n\n\tasync scanAllUserExtensions(scanOptions: { includeAllVersions?: boolean; includeInvalid: boolean } = { includeInvalid: true, includeAllVersions: true }): Promise<IScannedExtension[]> {\n\t\tconst extensionsScannerInput = await this.createExtensionScannerInput(this.userExtensionsLocation, false, ExtensionType.User, undefined, true, undefined, this.getProductVersion());\n\t\tconst extensions = await this.extensionsScanner.scanExtensions(extensionsScannerInput);\n\t\treturn this.applyScanOptions(extensions, ExtensionType.User, { includeAllVersions: scanOptions.includeAllVersions, includeInvalid: scanOptions.includeInvalid });\n\t}\n\n\tasync scanExtensionsUnderDevelopment(existingExtensions: IScannedExtension[], scanOptions: ScanOptions): Promise<IScannedExtension[]> {\n\t\tif (this.environmentService.isExtensionDevelopment && this.environmentService.extensionDevelopmentLocationURI) {\n\t\t\tconst extensions = (await Promise.all(this.environmentService.extensionDevelopmentLocationURI.filter(extLoc => extLoc.scheme === Schemas.file)\n\t\t\t\t.map(async extensionDevelopmentLocationURI => {\n\t\t\t\t\tconst input = await this.createExtensionScannerInput(extensionDevelopmentLocationURI, false, ExtensionType.User, scanOptions.language, false /* do not validate */, undefined, this.getProductVersion());\n\t\t\t\t\tconst extensions = await this.extensionsScanner.scanOneOrMultipleExtensions(input);\n\t\t\t\t\treturn extensions.map(extension => {\n\t\t\t\t\t\t// Override the extension type from the existing extensions\n\t\t\t\t\t\textension.type = existingExtensions.find(e => areSameExtensions(e.identifier, extension.identifier))?.type ?? extension.type;\n\t\t\t\t\t\t// Validate the extension\n\t\t\t\t\t\treturn this.extensionsScanner.validate(extension, input);\n\t\t\t\t\t});\n\t\t\t\t})))\n\t\t\t\t.flat();\n\t\t\treturn this.applyScanOptions(extensions, 'development', { includeInvalid: scanOptions.includeInvalid, pickLatest: true });\n\t\t}\n\t\treturn [];\n\t}\n\n\tasync scanExistingExtension(extensionLocation: URI, extensionType: ExtensionType, scanOptions: ScanOptions): Promise<IScannedExtension | null> {\n\t\tconst extensionsScannerInput = await this.createExtensionScannerInput(extensionLocation, false, extensionType, scanOptions.language, true, undefined, this.getProductVersion());\n\t\tconst extension = await this.extensionsScanner.scanExtension(extensionsScannerInput);\n\t\tif (!extension) {\n\t\t\treturn null;\n\t\t}\n\t\tif (!scanOptions.includeInvalid && !extension.isValid) {\n\t\t\treturn null;\n\t\t}\n\t\treturn extension;\n\t}\n\n\tasync scanOneOrMultipleExtensions(extensionLocation: URI, extensionType: ExtensionType, scanOptions: ScanOptions): Promise<IScannedExtension[]> {\n\t\tconst extensionsScannerInput = await this.createExtensionScannerInput(extensionLocation, false, extensionType, scanOptions.language, true, undefined, this.getProductVersion());\n\t\tconst extensions = await this.extensionsScanner.scanOneOrMultipleExtensions(extensionsScannerInput);\n\t\treturn this.applyScanOptions(extensions, extensionType, { includeInvalid: scanOptions.includeInvalid, pickLatest: true });\n\t}\n\n\tasync scanMultipleExtensions(extensionLocations: URI[], extensionType: ExtensionType, scanOptions: ScanOptions): Promise<IScannedExtension[]> {\n\t\tconst extensions: IRelaxedScannedExtension[] = [];\n\t\tawait Promise.all(extensionLocations.map(async extensionLocation => {\n\t\t\tconst scannedExtensions = await this.scanOneOrMultipleExtensions(extensionLocation, extensionType, scanOptions);\n\t\t\textensions.push(...scannedExtensions);\n\t\t}));\n\t\treturn this.applyScanOptions(extensions, extensionType, { includeInvalid: scanOptions.includeInvalid, pickLatest: true });\n\t}\n\n\tasync updateManifestMetadata(extensionLocation: URI, metaData: ManifestMetadata): Promise<void> {\n\t\tconst manifestLocation = joinPath(extensionLocation, 'package.json');\n\t\tconst content = (await this.fileService.readFile(manifestLocation)).value.toString();\n\t\tconst manifest: IScannedExtensionManifest = JSON.parse(content);\n\t\tmanifest.__metadata = { ...manifest.__metadata, ...metaData };\n\n\t\tawait this.fileService.writeFile(joinPath(extensionLocation, 'package.json'), VSBuffer.fromString(JSON.stringify(manifest, null, '\\t')));\n\t}\n\n\tasync initializeDefaultProfileExtensions(): Promise<void> {\n\t\ttry {\n\t\t\tawait this.extensionsProfileScannerService.scanProfileExtensions(this.userDataProfilesService.defaultProfile.extensionsResource, { bailOutWhenFileNotFound: true });\n\t\t} catch (error) {\n\t\t\tif (error instanceof ExtensionsProfileScanningError && error.code === ExtensionsProfileScanningErrorCode.ERROR_PROFILE_NOT_FOUND) {\n\t\t\t\tawait this.doInitializeDefaultProfileExtensions();\n\t\t\t} else {\n\t\t\t\tthrow error;\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate initializeDefaultProfileExtensionsPromise: Promise<void> | undefined = undefined;\n\tprivate async doInitializeDefaultProfileExtensions(): Promise<void> {\n\t\tif (!this.initializeDefaultProfileExtensionsPromise) {\n\t\t\tthis.initializeDefaultProfileExtensionsPromise = (async () => {\n\t\t\t\ttry {\n\t\t\t\t\tthis.logService.info('Started initializing default profile extensions in extensions installation folder.', this.userExtensionsLocation.toString());\n\t\t\t\t\tconst userExtensions = await this.scanAllUserExtensions({ includeInvalid: true });\n\t\t\t\t\tif (userExtensions.length) {\n\t\t\t\t\t\tawait this.extensionsProfileScannerService.addExtensionsToProfile(userExtensions.map(e => [e, e.metadata]), this.userDataProfilesService.defaultProfile.extensionsResource);\n\t\t\t\t\t} else {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tawait this.fileService.createFile(this.userDataProfilesService.defaultProfile.extensionsResource, VSBuffer.fromString(JSON.stringify([])));\n\t\t\t\t\t\t} catch (error) {\n\t\t\t\t\t\t\tif (toFileOperationResult(error) !== FileOperationResult.FILE_NOT_FOUND) {\n\t\t\t\t\t\t\t\tthis.logService.warn('Failed to create default profile extensions manifest in extensions installation folder.', this.userExtensionsLocation.toString(), getErrorMessage(error));\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tthis.logService.info('Completed initializing default profile extensions in extensions installation folder.', this.userExtensionsLocation.toString());\n\t\t\t\t} catch (error) {\n\t\t\t\t\tthis.logService.error(error);\n\t\t\t\t} finally {\n\t\t\t\t\tthis.initializeDefaultProfileExtensionsPromise = undefined;\n\t\t\t\t}\n\t\t\t})();\n\t\t}\n\t\treturn this.initializeDefaultProfileExtensionsPromise;\n\t}\n\n\tprivate async applyScanOptions(extensions: IRelaxedScannedExtension[], type: ExtensionType | 'development', scanOptions: { includeAllVersions?: boolean; includeInvalid?: boolean; pickLatest?: boolean } = {}): Promise<IRelaxedScannedExtension[]> {\n\t\tif (!scanOptions.includeAllVersions) {\n\t\t\textensions = this.dedupExtensions(type === ExtensionType.System ? extensions : undefined, type === ExtensionType.User ? extensions : undefined, type === 'development' ? extensions : undefined, await this.getTargetPlatform(), !!scanOptions.pickLatest);\n\t\t}\n\t\tif (!scanOptions.includeInvalid) {\n\t\t\textensions = extensions.filter(extension => extension.isValid);\n\t\t}\n\t\treturn extensions.sort((a, b) => {\n\t\t\tconst aLastSegment = path.basename(a.location.fsPath);\n\t\t\tconst bLastSegment = path.basename(b.location.fsPath);\n\t\t\tif (aLastSegment < bLastSegment) {\n\t\t\t\treturn -1;\n\t\t\t}\n\t\t\tif (aLastSegment > bLastSegment) {\n\t\t\t\treturn 1;\n\t\t\t}\n\t\t\treturn 0;\n\t\t});\n\t}\n\n\tprivate dedupExtensions(system: IScannedExtension[] | undefined, user: IScannedExtension[] | undefined, development: IScannedExtension[] | undefined, targetPlatform: TargetPlatform, pickLatest: boolean): IScannedExtension[] {\n\t\tconst pick = (existing: IScannedExtension, extension: IScannedExtension, isDevelopment: boolean): boolean => {\n\t\t\tif (!isDevelopment) {\n\t\t\t\tif (existing.metadata?.isApplicationScoped && !extension.metadata?.isApplicationScoped) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t\tif (!existing.metadata?.isApplicationScoped && extension.metadata?.isApplicationScoped) {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (existing.isValid && !extension.isValid) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tif (existing.isValid === extension.isValid) {\n\t\t\t\tif (pickLatest && semver.gt(existing.manifest.version, extension.manifest.version)) {\n\t\t\t\t\tthis.logService.debug(`Skipping extension ${extension.location.path} with lower version ${extension.manifest.version} in favour of ${existing.location.path} with version ${existing.manifest.version}`);\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t\tif (semver.eq(existing.manifest.version, extension.manifest.version)) {\n\t\t\t\t\tif (existing.type === ExtensionType.System) {\n\t\t\t\t\t\tthis.logService.debug(`Skipping extension ${extension.location.path} in favour of system extension ${existing.location.path} with same version`);\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t\tif (existing.targetPlatform === targetPlatform) {\n\t\t\t\t\t\tthis.logService.debug(`Skipping extension ${extension.location.path} from different target platform ${extension.targetPlatform}`);\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (isDevelopment) {\n\t\t\t\tthis.logService.warn(`Overwriting user extension ${existing.location.path} with ${extension.location.path}.`);\n\t\t\t} else {\n\t\t\t\tthis.logService.debug(`Overwriting user extension ${existing.location.path} with ${extension.location.path}.`);\n\t\t\t}\n\t\t\treturn true;\n\t\t};\n\t\tconst result = new ExtensionIdentifierMap<IScannedExtension>();\n\t\tsystem?.forEach((extension) => {\n\t\t\tconst existing = result.get(extension.identifier.id);\n\t\t\tif (!existing || pick(existing, extension, false)) {\n\t\t\t\tresult.set(extension.identifier.id, extension);\n\t\t\t}\n\t\t});\n\t\tuser?.forEach((extension) => {\n\t\t\tconst existing = result.get(extension.identifier.id);\n\t\t\tif (!existing && system && extension.type === ExtensionType.System) {\n\t\t\t\tthis.logService.debug(`Skipping obsolete system extension ${extension.location.path}.`);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (!existing || pick(existing, extension, false)) {\n\t\t\t\tresult.set(extension.identifier.id, extension);\n\t\t\t}\n\t\t});\n\t\tdevelopment?.forEach(extension => {\n\t\t\tconst existing = result.get(extension.identifier.id);\n\t\t\tif (!existing || pick(existing, extension, true)) {\n\t\t\t\tresult.set(extension.identifier.id, extension);\n\t\t\t}\n\t\t\tresult.set(extension.identifier.id, extension);\n\t\t});\n\t\treturn [...result.values()];\n\t}\n\n\tprivate async scanDefaultSystemExtensions(language: string | undefined): Promise<IRelaxedScannedExtension[]> {\n\t\tthis.logService.trace('Started scanning system extensions');\n\t\tconst extensionsScannerInput = await this.createExtensionScannerInput(this.systemExtensionsLocation, false, ExtensionType.System, language, true, undefined, this.getProductVersion());\n\t\tconst extensionsScanner = extensionsScannerInput.devMode ? this.extensionsScanner : this.systemExtensionsCachedScanner;\n\t\tconst result = await extensionsScanner.scanExtensions(extensionsScannerInput);\n\t\tthis.logService.trace('Scanned system extensions:', result.length);\n\t\treturn result;\n\t}\n\n\tprivate async scanDevSystemExtensions(language: string | undefined, checkControlFile: boolean): Promise<IRelaxedScannedExtension[]> {\n\t\tconst devSystemExtensionsList = this.environmentService.isBuilt ? [] : this.productService.builtInExtensions;\n\t\tif (!devSystemExtensionsList?.length) {\n\t\t\treturn [];\n\t\t}\n\n\t\tthis.logService.trace('Started scanning dev system extensions');\n\t\tconst builtinExtensionControl = checkControlFile ? await this.getBuiltInExtensionControl() : {};\n\t\tconst devSystemExtensionsLocations: URI[] = [];\n\t\tconst devSystemExtensionsLocation = URI.file(path.normalize(path.join(FileAccess.asFileUri('').fsPath, '..', '.build', 'builtInExtensions')));\n\t\tfor (const extension of devSystemExtensionsList) {\n\t\t\tconst controlState = builtinExtensionControl[extension.name] || 'marketplace';\n\t\t\tswitch (controlState) {\n\t\t\t\tcase 'disabled':\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'marketplace':\n\t\t\t\t\tdevSystemExtensionsLocations.push(joinPath(devSystemExtensionsLocation, extension.name));\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\tdevSystemExtensionsLocations.push(URI.file(controlState));\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\tconst result = await Promise.all(devSystemExtensionsLocations.map(async location => this.extensionsScanner.scanExtension((await this.createExtensionScannerInput(location, false, ExtensionType.System, language, true, undefined, this.getProductVersion())))));\n\t\tthis.logService.trace('Scanned dev system extensions:', result.length);\n\t\treturn coalesce(result);\n\t}\n\n\tprivate async getBuiltInExtensionControl(): Promise<IBuiltInExtensionControl> {\n\t\ttry {\n\t\t\tconst content = await this.fileService.readFile(this.extensionsControlLocation);\n\t\t\treturn JSON.parse(content.value.toString());\n\t\t} catch (error) {\n\t\t\treturn {};\n\t\t}\n\t}\n\n\tprivate async createExtensionScannerInput(location: URI, profile: boolean, type: ExtensionType, language: string | undefined, validate: boolean, profileScanOptions: IProfileExtensionsScanOptions | undefined, productVersion: IProductVersion): Promise<ExtensionScannerInput> {\n\t\tconst translations = await this.getTranslations(language ?? platform.language);\n\t\tconst mtime = await this.getMtime(location);\n\t\tconst applicationExtensionsLocation = profile && !this.uriIdentityService.extUri.isEqual(location, this.userDataProfilesService.defaultProfile.extensionsResource) ? this.userDataProfilesService.defaultProfile.extensionsResource : undefined;\n\t\tconst applicationExtensionsLocationMtime = applicationExtensionsLocation ? await this.getMtime(applicationExtensionsLocation) : undefined;\n\t\treturn new ExtensionScannerInput(\n\t\t\tlocation,\n\t\t\tmtime,\n\t\t\tapplicationExtensionsLocation,\n\t\t\tapplicationExtensionsLocationMtime,\n\t\t\tprofile,\n\t\t\tprofileScanOptions,\n\t\t\ttype,\n\t\t\tvalidate,\n\t\t\tproductVersion.version,\n\t\t\tproductVersion.date,\n\t\t\tthis.productService.commit,\n\t\t\t!this.environmentService.isBuilt,\n\t\t\tlanguage,\n\t\t\ttranslations,\n\t\t);\n\t}\n\n\tprivate async getMtime(location: URI): Promise<number | undefined> {\n\t\ttry {\n\t\t\tconst stat = await this.fileService.stat(location);\n\t\t\tif (typeof stat.mtime === 'number') {\n\t\t\t\treturn stat.mtime;\n\t\t\t}\n\t\t} catch (err) {\n\t\t\t// That's ok...\n\t\t}\n\t\treturn undefined;\n\t}\n\n\tprivate getProductVersion(): IProductVersion {\n\t\treturn {\n\t\t\tversion: this.productService.version,\n\t\t\tdate: this.productService.date,\n\t\t};\n\t}\n\n}\n\nexport class ExtensionScannerInput {\n\n\tconstructor(\n\t\tpublic readonly location: URI,\n\t\tpublic readonly mtime: number | undefined,\n\t\tpublic readonly applicationExtensionslocation: URI | undefined,\n\t\tpublic readonly applicationExtensionslocationMtime: number | undefined,\n\t\tpublic readonly profile: boolean,\n\t\tpublic readonly profileScanOptions: IProfileExtensionsScanOptions | undefined,\n\t\tpublic readonly type: ExtensionType,\n\t\tpublic readonly validate: boolean,\n\t\tpublic readonly productVersion: string,\n\t\tpublic readonly productDate: string | undefined,\n\t\tpublic readonly productCommit: string | undefined,\n\t\tpublic readonly devMode: boolean,\n\t\tpublic readonly language: string | undefined,\n\t\tpublic readonly translations: Translations\n\t) {\n\t\t// Keep empty!! (JSON.parse)\n\t}\n\n\tpublic static createNlsConfiguration(input: ExtensionScannerInput): NlsConfiguration {\n\t\treturn {\n\t\t\tlanguage: input.language,\n\t\t\tpseudo: input.language === 'pseudo',\n\t\t\tdevMode: input.devMode,\n\t\t\ttranslations: input.translations\n\t\t};\n\t}\n\n\tpublic static equals(a: ExtensionScannerInput, b: ExtensionScannerInput): boolean {\n\t\treturn (\n\t\t\tisEqual(a.location, b.location)\n\t\t\t&& a.mtime === b.mtime\n\t\t\t&& isEqual(a.applicationExtensionslocation, b.applicationExtensionslocation)\n\t\t\t&& a.applicationExtensionslocationMtime === b.applicationExtensionslocationMtime\n\t\t\t&& a.profile === b.profile\n\t\t\t&& objects.equals(a.profileScanOptions, b.profileScanOptions)\n\t\t\t&& a.type === b.type\n\t\t\t&& a.validate === b.validate\n\t\t\t&& a.productVersion === b.productVersion\n\t\t\t&& a.productDate === b.productDate\n\t\t\t&& a.productCommit === b.productCommit\n\t\t\t&& a.devMode === b.devMode\n\t\t\t&& a.language === b.language\n\t\t\t&& Translations.equals(a.translations, b.translations)\n\t\t);\n\t}\n}\n\ntype NlsConfiguration = {\n\tlanguage: string | undefined;\n\tpseudo: boolean;\n\tdevMode: boolean;\n\ttranslations: Translations;\n};\n\nclass ExtensionsScanner extends Disposable {\n\n\tprivate readonly extensionsEnabledWithApiProposalVersion: string[];\n\n\tconstructor(\n\t\t@IExtensionsProfileScannerService protected readonly extensionsProfileScannerService: IExtensionsProfileScannerService,\n\t\t@IUriIdentityService protected readonly uriIdentityService: IUriIdentityService,\n\t\t@IFileService protected readonly fileService: IFileService,\n\t\t@IProductService productService: IProductService,\n\t\t@IEnvironmentService private readonly environmentService: IEnvironmentService,\n\t\t@ILogService protected readonly logService: ILogService\n\t) {\n\t\tsuper();\n\t\tthis.extensionsEnabledWithApiProposalVersion = productService.extensionsEnabledWithApiProposalVersion?.map(id => id.toLowerCase()) ?? [];\n\t}\n\n\tasync scanExtensions(input: ExtensionScannerInput): Promise<IRelaxedScannedExtension[]> {\n\t\treturn input.profile\n\t\t\t? this.scanExtensionsFromProfile(input)\n\t\t\t: this.scanExtensionsFromLocation(input);\n\t}\n\n\tprivate async scanExtensionsFromLocation(input: ExtensionScannerInput): Promise<IRelaxedScannedExtension[]> {\n\t\tconst stat = await this.fileService.resolve(input.location);\n\t\tif (!stat.children?.length) {\n\t\t\treturn [];\n\t\t}\n\t\tconst extensions = await Promise.all<IRelaxedScannedExtension | null>(\n\t\t\tstat.children.map(async c => {\n\t\t\t\tif (!c.isDirectory) {\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\t\t\t\t// Do not consider user extension folder starting with `.`\n\t\t\t\tif (input.type === ExtensionType.User && basename(c.resource).indexOf('.') === 0) {\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\t\t\t\tconst extensionScannerInput = new ExtensionScannerInput(c.resource, input.mtime, input.applicationExtensionslocation, input.applicationExtensionslocationMtime, input.profile, input.profileScanOptions, input.type, input.validate, input.productVersion, input.productDate, input.productCommit, input.devMode, input.language, input.translations);\n\t\t\t\treturn this.scanExtension(extensionScannerInput);\n\t\t\t}));\n\t\treturn coalesce(extensions)\n\t\t\t// Sort: Make sure extensions are in the same order always. Helps cache invalidation even if the order changes.\n\t\t\t.sort((a, b) => a.location.path < b.location.path ? -1 : 1);\n\t}\n\n\tprivate async scanExtensionsFromProfile(input: ExtensionScannerInput): Promise<IRelaxedScannedExtension[]> {\n\t\tlet profileExtensions = await this.scanExtensionsFromProfileResource(input.location, () => true, input);\n\t\tif (input.applicationExtensionslocation && !this.uriIdentityService.extUri.isEqual(input.location, input.applicationExtensionslocation)) {\n\t\t\tprofileExtensions = profileExtensions.filter(e => !e.metadata?.isApplicationScoped);\n\t\t\tconst applicationExtensions = await this.scanExtensionsFromProfileResource(input.applicationExtensionslocation, (e) => !!e.metadata?.isBuiltin || !!e.metadata?.isApplicationScoped, input);\n\t\t\tprofileExtensions.push(...applicationExtensions);\n\t\t}\n\t\treturn profileExtensions;\n\t}\n\n\tprivate async scanExtensionsFromProfileResource(profileResource: URI, filter: (extensionInfo: IScannedProfileExtension) => boolean, input: ExtensionScannerInput): Promise<IRelaxedScannedExtension[]> {\n\t\tconst scannedProfileExtensions = await this.extensionsProfileScannerService.scanProfileExtensions(profileResource, input.profileScanOptions);\n\t\tif (!scannedProfileExtensions.length) {\n\t\t\treturn [];\n\t\t}\n\t\tconst extensions = await Promise.all<IRelaxedScannedExtension | null>(\n\t\t\tscannedProfileExtensions.map(async extensionInfo => {\n\t\t\t\tif (filter(extensionInfo)) {\n\t\t\t\t\tconst extensionScannerInput = new ExtensionScannerInput(extensionInfo.location, input.mtime, input.applicationExtensionslocation, input.applicationExtensionslocationMtime, input.profile, input.profileScanOptions, input.type, input.validate, input.productVersion, input.productDate, input.productCommit, input.devMode, input.language, input.translations);\n\t\t\t\t\treturn this.scanExtension(extensionScannerInput, extensionInfo);\n\t\t\t\t}\n\t\t\t\treturn null;\n\t\t\t}));\n\t\treturn coalesce(extensions);\n\t}\n\n\tasync scanOneOrMultipleExtensions(input: ExtensionScannerInput): Promise<IRelaxedScannedExtension[]> {\n\t\ttry {\n\t\t\tif (await this.fileService.exists(joinPath(input.location, 'package.json'))) {\n\t\t\t\tconst extension = await this.scanExtension(input);\n\t\t\t\treturn extension ? [extension] : [];\n\t\t\t} else {\n\t\t\t\treturn await this.scanExtensions(input);\n\t\t\t}\n\t\t} catch (error) {\n\t\t\tthis.logService.error(`Error scanning extensions at ${input.location.path}:`, getErrorMessage(error));\n\t\t\treturn [];\n\t\t}\n\t}\n\n\tasync scanExtension(input: ExtensionScannerInput): Promise<IRelaxedScannedExtension | null>;\n\tasync scanExtension(input: ExtensionScannerInput, scannedProfileExtension: IScannedProfileExtension): Promise<IRelaxedScannedExtension>;\n\tasync scanExtension(input: ExtensionScannerInput, scannedProfileExtension?: IScannedProfileExtension): Promise<IRelaxedScannedExtension | null> {\n\t\tconst validations: [Severity, string][] = [];\n\t\tlet isValid = true;\n\t\tlet manifest: IScannedExtensionManifest;\n\t\ttry {\n\t\t\tmanifest = await this.scanExtensionManifest(input.location);\n\t\t} catch (e) {\n\t\t\tif (scannedProfileExtension) {\n\t\t\t\tvalidations.push([Severity.Error, getErrorMessage(e)]);\n\t\t\t\tisValid = false;\n\t\t\t\tconst [publisher, name] = scannedProfileExtension.identifier.id.split('.');\n\t\t\t\tmanifest = {\n\t\t\t\t\tname,\n\t\t\t\t\tpublisher,\n\t\t\t\t\tversion: scannedProfileExtension.version,\n\t\t\t\t\tengines: { vscode: '' }\n\t\t\t\t};\n\t\t\t} else {\n\t\t\t\tif (input.type !== ExtensionType.System) {\n\t\t\t\t\tthis.logService.error(e);\n\t\t\t\t}\n\t\t\t\treturn null;\n\t\t\t}\n\t\t}\n\n\t\t// allow publisher to be undefined to make the initial extension authoring experience smoother\n\t\tif (!manifest.publisher) {\n\t\t\tmanifest.publisher = UNDEFINED_PUBLISHER;\n\t\t}\n\n\t\tlet metadata: Metadata | undefined;\n\t\tif (scannedProfileExtension) {\n\t\t\tmetadata = {\n\t\t\t\t...scannedProfileExtension.metadata,\n\t\t\t\tsize: manifest.__metadata?.size,\n\t\t\t};\n\t\t} else if (manifest.__metadata) {\n\t\t\tmetadata = {\n\t\t\t\tinstalledTimestamp: manifest.__metadata.installedTimestamp,\n\t\t\t\tsize: manifest.__metadata.size,\n\t\t\t\ttargetPlatform: manifest.__metadata.targetPlatform,\n\t\t\t};\n\t\t}\n\n\t\tdelete manifest.__metadata;\n\t\tconst id = getGalleryExtensionId(manifest.publisher, manifest.name);\n\t\tconst identifier = metadata?.id ? { id, uuid: metadata.id } : { id };\n\t\tconst type = metadata?.isSystem ? ExtensionType.System : input.type;\n\t\tconst isBuiltin = type === ExtensionType.System || !!metadata?.isBuiltin;\n\t\ttry {\n\t\t\tmanifest = await this.translateManifest(input.location, manifest, ExtensionScannerInput.createNlsConfiguration(input));\n\t\t} catch (error) {\n\t\t\tthis.logService.warn('Failed to translate manifest', getErrorMessage(error));\n\t\t}\n\t\tlet extension: IRelaxedScannedExtension = {\n\t\t\ttype,\n\t\t\tidentifier,\n\t\t\tmanifest,\n\t\t\tlocation: input.location,\n\t\t\tisBuiltin,\n\t\t\ttargetPlatform: metadata?.targetPlatform ?? TargetPlatform.UNDEFINED,\n\t\t\tpublisherDisplayName: metadata?.publisherDisplayName,\n\t\t\tmetadata,\n\t\t\tisValid,\n\t\t\tvalidations,\n\t\t\tpreRelease: !!metadata?.preRelease,\n\t\t};\n\t\tif (input.validate) {\n\t\t\textension = this.validate(extension, input);\n\t\t}\n\t\tif (manifest.enabledApiProposals && (!this.environmentService.isBuilt || this.extensionsEnabledWithApiProposalVersion.includes(id.toLowerCase()))) {\n\t\t\tmanifest.originalEnabledApiProposals = manifest.enabledApiProposals;\n\t\t\tmanifest.enabledApiProposals = parseEnabledApiProposalNames([...manifest.enabledApiProposals]);\n\t\t}\n\t\treturn extension;\n\t}\n\n\tvalidate(extension: IRelaxedScannedExtension, input: ExtensionScannerInput): IRelaxedScannedExtension {\n\t\tlet isValid = extension.isValid;\n\t\tconst validateApiVersion = this.environmentService.isBuilt && this.extensionsEnabledWithApiProposalVersion.includes(extension.identifier.id.toLowerCase());\n\t\tconst validations = validateExtensionManifest(input.productVersion, input.productDate, input.location, extension.manifest, extension.isBuiltin, validateApiVersion);\n\t\tfor (const [severity, message] of validations) {\n\t\t\tif (severity === Severity.Error) {\n\t\t\t\tisValid = false;\n\t\t\t\tthis.logService.error(this.formatMessage(input.location, message));\n\t\t\t}\n\t\t}\n\t\textension.isValid = isValid;\n\t\textension.validations = [...extension.validations, ...validations];\n\t\treturn extension;\n\t}\n\n\tprivate async scanExtensionManifest(extensionLocation: URI): Promise<IScannedExtensionManifest> {\n\t\tconst manifestLocation = joinPath(extensionLocation, 'package.json');\n\t\tlet content;\n\t\ttry {\n\t\t\tcontent = (await this.fileService.readFile(manifestLocation)).value.toString();\n\t\t} catch (error) {\n\t\t\tif (toFileOperationResult(error) !== FileOperationResult.FILE_NOT_FOUND) {\n\t\t\t\tthis.logService.error(this.formatMessage(extensionLocation, localize('fileReadFail', \"Cannot read file {0}: {1}.\", manifestLocation.path, error.message)));\n\t\t\t}\n\t\t\tthrow error;\n\t\t}\n\t\tlet manifest: IScannedExtensionManifest;\n\t\ttry {\n\t\t\tmanifest = JSON.parse(content);\n\t\t} catch (err) {\n\t\t\t// invalid JSON, let's get good errors\n\t\t\tconst errors: ParseError[] = [];\n\t\t\tparse(content, errors);\n\t\t\tfor (const e of errors) {\n\t\t\t\tthis.logService.error(this.formatMessage(extensionLocation, localize('jsonParseFail', \"Failed to parse {0}: [{1}, {2}] {3}.\", manifestLocation.path, e.offset, e.length, getParseErrorMessage(e.error))));\n\t\t\t}\n\t\t\tthrow err;\n\t\t}\n\t\tif (getNodeType(manifest) !== 'object') {\n\t\t\tconst errorMessage = this.formatMessage(extensionLocation, localize('jsonParseInvalidType', \"Invalid manifest file {0}: Not a JSON object.\", manifestLocation.path));\n\t\t\tthis.logService.error(errorMessage);\n\t\t\tthrow new Error(errorMessage);\n\t\t}\n\t\treturn manifest;\n\t}\n\n\tprivate async translateManifest(extensionLocation: URI, extensionManifest: IExtensionManifest, nlsConfiguration: NlsConfiguration): Promise<IExtensionManifest> {\n\t\tconst localizedMessages = await this.getLocalizedMessages(extensionLocation, extensionManifest, nlsConfiguration);\n\t\tif (localizedMessages) {\n\t\t\ttry {\n\t\t\t\tconst errors: ParseError[] = [];\n\t\t\t\t// resolveOriginalMessageBundle returns null if localizedMessages.default === undefined;\n\t\t\t\tconst defaults = await this.resolveOriginalMessageBundle(localizedMessages.default, errors);\n\t\t\t\tif (errors.length > 0) {\n\t\t\t\t\terrors.forEach((error) => {\n\t\t\t\t\t\tthis.logService.error(this.formatMessage(extensionLocation, localize('jsonsParseReportErrors', \"Failed to parse {0}: {1}.\", localizedMessages.default?.path, getParseErrorMessage(error.error))));\n\t\t\t\t\t});\n\t\t\t\t\treturn extensionManifest;\n\t\t\t\t} else if (getNodeType(localizedMessages) !== 'object') {\n\t\t\t\t\tthis.logService.error(this.formatMessage(extensionLocation, localize('jsonInvalidFormat', \"Invalid format {0}: JSON object expected.\", localizedMessages.default?.path)));\n\t\t\t\t\treturn extensionManifest;\n\t\t\t\t}\n\t\t\t\tconst localized = localizedMessages.values || Object.create(null);\n\t\t\t\treturn localizeManifest(this.logService, extensionManifest, localized, defaults);\n\t\t\t} catch (error) {\n\t\t\t\t/*Ignore Error*/\n\t\t\t}\n\t\t}\n\t\treturn extensionManifest;\n\t}\n\n\tprivate async getLocalizedMessages(extensionLocation: URI, extensionManifest: IExtensionManifest, nlsConfiguration: NlsConfiguration): Promise<LocalizedMessages | undefined> {\n\t\tconst defaultPackageNLS = joinPath(extensionLocation, 'package.nls.json');\n\t\tconst reportErrors = (localized: URI | null, errors: ParseError[]): void => {\n\t\t\terrors.forEach((error) => {\n\t\t\t\tthis.logService.error(this.formatMessage(extensionLocation, localize('jsonsParseReportErrors', \"Failed to parse {0}: {1}.\", localized?.path, getParseErrorMessage(error.error))));\n\t\t\t});\n\t\t};\n\t\tconst reportInvalidFormat = (localized: URI | null): void => {\n\t\t\tthis.logService.error(this.formatMessage(extensionLocation, localize('jsonInvalidFormat', \"Invalid format {0}: JSON object expected.\", localized?.path)));\n\t\t};\n\n\t\tconst translationId = `${extensionManifest.publisher}.${extensionManifest.name}`;\n\t\tconst translationPath = nlsConfiguration.translations[translationId];\n\n\t\tif (translationPath) {\n\t\t\ttry {\n\t\t\t\tconst translationResource = URI.file(translationPath);\n\t\t\t\tconst content = (await this.fileService.readFile(translationResource)).value.toString();\n\t\t\t\tconst errors: ParseError[] = [];\n\t\t\t\tconst translationBundle: TranslationBundle = parse(content, errors);\n\t\t\t\tif (errors.length > 0) {\n\t\t\t\t\treportErrors(translationResource, errors);\n\t\t\t\t\treturn { values: undefined, default: defaultPackageNLS };\n\t\t\t\t} else if (getNodeType(translationBundle) !== 'object') {\n\t\t\t\t\treportInvalidFormat(translationResource);\n\t\t\t\t\treturn { values: undefined, default: defaultPackageNLS };\n\t\t\t\t} else {\n\t\t\t\t\tconst values = translationBundle.contents ? translationBundle.contents.package : undefined;\n\t\t\t\t\treturn { values: values, default: defaultPackageNLS };\n\t\t\t\t}\n\t\t\t} catch (error) {\n\t\t\t\treturn { values: undefined, default: defaultPackageNLS };\n\t\t\t}\n\t\t} else {\n\t\t\tconst exists = await this.fileService.exists(defaultPackageNLS);\n\t\t\tif (!exists) {\n\t\t\t\treturn undefined;\n\t\t\t}\n\t\t\tlet messageBundle;\n\t\t\ttry {\n\t\t\t\tmessageBundle = await this.findMessageBundles(extensionLocation, nlsConfiguration);\n\t\t\t} catch (error) {\n\t\t\t\treturn undefined;\n\t\t\t}\n\t\t\tif (!messageBundle.localized) {\n\t\t\t\treturn { values: undefined, default: messageBundle.original };\n\t\t\t}\n\t\t\ttry {\n\t\t\t\tconst messageBundleContent = (await this.fileService.readFile(messageBundle.localized)).value.toString();\n\t\t\t\tconst errors: ParseError[] = [];\n\t\t\t\tconst messages: MessageBag = parse(messageBundleContent, errors);\n\t\t\t\tif (errors.length > 0) {\n\t\t\t\t\treportErrors(messageBundle.localized, errors);\n\t\t\t\t\treturn { values: undefined, default: messageBundle.original };\n\t\t\t\t} else if (getNodeType(messages) !== 'object') {\n\t\t\t\t\treportInvalidFormat(messageBundle.localized);\n\t\t\t\t\treturn { values: undefined, default: messageBundle.original };\n\t\t\t\t}\n\t\t\t\treturn { values: messages, default: messageBundle.original };\n\t\t\t} catch (error) {\n\t\t\t\treturn { values: undefined, default: messageBundle.original };\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Parses original message bundle, returns null if the original message bundle is null.\n\t */\n\tprivate async resolveOriginalMessageBundle(originalMessageBundle: URI | null, errors: ParseError[]): Promise<{ [key: string]: string } | undefined> {\n\t\tif (originalMessageBundle) {\n\t\t\ttry {\n\t\t\t\tconst originalBundleContent = (await this.fileService.readFile(originalMessageBundle)).value.toString();\n\t\t\t\treturn parse(originalBundleContent, errors);\n\t\t\t} catch (error) {\n\t\t\t\t/* Ignore Error */\n\t\t\t}\n\t\t}\n\t\treturn;\n\t}\n\n\t/**\n\t * Finds localized message bundle and the original (unlocalized) one.\n\t * If the localized file is not present, returns null for the original and marks original as localized.\n\t */\n\tprivate findMessageBundles(extensionLocation: URI, nlsConfiguration: NlsConfiguration): Promise<{ localized: URI; original: URI | null }> {\n\t\treturn new Promise<{ localized: URI; original: URI | null }>((c, e) => {\n\t\t\tconst loop = (locale: string): void => {\n\t\t\t\tconst toCheck = joinPath(extensionLocation, `package.nls.${locale}.json`);\n\t\t\t\tthis.fileService.exists(toCheck).then(exists => {\n\t\t\t\t\tif (exists) {\n\t\t\t\t\t\tc({ localized: toCheck, original: joinPath(extensionLocation, 'package.nls.json') });\n\t\t\t\t\t}\n\t\t\t\t\tconst index = locale.lastIndexOf('-');\n\t\t\t\t\tif (index === -1) {\n\t\t\t\t\t\tc({ localized: joinPath(extensionLocation, 'package.nls.json'), original: null });\n\t\t\t\t\t} else {\n\t\t\t\t\t\tlocale = locale.substring(0, index);\n\t\t\t\t\t\tloop(locale);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t};\n\t\t\tif (nlsConfiguration.devMode || nlsConfiguration.pseudo || !nlsConfiguration.language) {\n\t\t\t\treturn c({ localized: joinPath(extensionLocation, 'package.nls.json'), original: null });\n\t\t\t}\n\t\t\tloop(nlsConfiguration.language);\n\t\t});\n\t}\n\n\tprivate formatMessage(extensionLocation: URI, message: string): string {\n\t\treturn `[${extensionLocation.path}]: ${message}`;\n\t}\n\n}\n\ninterface IExtensionCacheData {\n\tinput: ExtensionScannerInput;\n\tresult: IRelaxedScannedExtension[];\n}\n\nclass CachedExtensionsScanner extends ExtensionsScanner {\n\n\tprivate input: ExtensionScannerInput | undefined;\n\tprivate readonly cacheValidatorThrottler: ThrottledDelayer<void> = this._register(new ThrottledDelayer(3000));\n\n\tprivate readonly _onDidChangeCache = this._register(new Emitter<void>());\n\treadonly onDidChangeCache = this._onDidChangeCache.event;\n\n\tconstructor(\n\t\tprivate readonly currentProfile: IUserDataProfile,\n\t\t@IUserDataProfilesService private readonly userDataProfilesService: IUserDataProfilesService,\n\t\t@IExtensionsProfileScannerService extensionsProfileScannerService: IExtensionsProfileScannerService,\n\t\t@IUriIdentityService uriIdentityService: IUriIdentityService,\n\t\t@IFileService fileService: IFileService,\n\t\t@IProductService productService: IProductService,\n\t\t@IEnvironmentService environmentService: IEnvironmentService,\n\t\t@ILogService logService: ILogService\n\t) {\n\t\tsuper(extensionsProfileScannerService, uriIdentityService, fileService, productService, environmentService, logService);\n\t}\n\n\toverride async scanExtensions(input: ExtensionScannerInput): Promise<IRelaxedScannedExtension[]> {\n\t\tconst cacheFile = this.getCacheFile(input);\n\t\tconst cacheContents = await this.readExtensionCache(cacheFile);\n\t\tthis.input = input;\n\t\tif (cacheContents && cacheContents.input && ExtensionScannerInput.equals(cacheContents.input, this.input)) {\n\t\t\tthis.logService.debug('Using cached extensions scan result', input.type === ExtensionType.System ? 'system' : 'user', input.location.toString());\n\t\t\tthis.cacheValidatorThrottler.trigger(() => this.validateCache());\n\t\t\treturn cacheContents.result.map((extension) => {\n\t\t\t\t// revive URI object\n\t\t\t\textension.location = URI.revive(extension.location);\n\t\t\t\treturn extension;\n\t\t\t});\n\t\t}\n\t\tconst result = await super.scanExtensions(input);\n\t\tawait this.writeExtensionCache(cacheFile, { input, result });\n\t\treturn result;\n\t}\n\n\tprivate async readExtensionCache(cacheFile: URI): Promise<IExtensionCacheData | null> {\n\t\ttry {\n\t\t\tconst cacheRawContents = await this.fileService.readFile(cacheFile);\n\t\t\tconst extensionCacheData: IExtensionCacheData = JSON.parse(cacheRawContents.value.toString());\n\t\t\treturn { result: extensionCacheData.result, input: revive(extensionCacheData.input) };\n\t\t} catch (error) {\n\t\t\tthis.logService.debug('Error while reading the extension cache file:', cacheFile.path, getErrorMessage(error));\n\t\t}\n\t\treturn null;\n\t}\n\n\tprivate async writeExtensionCache(cacheFile: URI, cacheContents: IExtensionCacheData): Promise<void> {\n\t\ttry {\n\t\t\tawait this.fileService.writeFile(cacheFile, VSBuffer.fromString(JSON.stringify(cacheContents)));\n\t\t} catch (error) {\n\t\t\tthis.logService.debug('Error while writing the extension cache file:', cacheFile.path, getErrorMessage(error));\n\t\t}\n\t}\n\n\tprivate async validateCache(): Promise<void> {\n\t\tif (!this.input) {\n\t\t\t// Input has been unset by the time we get here, so skip validation\n\t\t\treturn;\n\t\t}\n\n\t\tconst cacheFile = this.getCacheFile(this.input);\n\t\tconst cacheContents = await this.readExtensionCache(cacheFile);\n\t\tif (!cacheContents) {\n\t\t\t// Cache has been deleted by someone else, which is perfectly fine...\n\t\t\treturn;\n\t\t}\n\n\t\tconst actual = cacheContents.result;\n\t\tconst expected = JSON.parse(JSON.stringify(await super.scanExtensions(this.input)));\n\t\tif (objects.equals(expected, actual)) {\n\t\t\t// Cache is valid and running with it is perfectly fine...\n\t\t\treturn;\n\t\t}\n\n\t\ttry {\n\t\t\tthis.logService.info('Invalidating Cache', actual, expected);\n\t\t\t// Cache is invalid, delete it\n\t\t\tawait this.fileService.del(cacheFile);\n\t\t\tthis._onDidChangeCache.fire();\n\t\t} catch (error) {\n\t\t\tthis.logService.error(error);\n\t\t}\n\t}\n\n\tprivate getCacheFile(input: ExtensionScannerInput): URI {\n\t\tconst profile = this.getProfile(input);\n\t\treturn this.uriIdentityService.extUri.joinPath(profile.cacheHome, input.type === ExtensionType.System ? BUILTIN_MANIFEST_CACHE_FILE : USER_MANIFEST_CACHE_FILE);\n\t}\n\n\tprivate getProfile(input: ExtensionScannerInput): IUserDataProfile {\n\t\tif (input.type === ExtensionType.System) {\n\t\t\treturn this.userDataProfilesService.defaultProfile;\n\t\t}\n\t\tif (!input.profile) {\n\t\t\treturn this.userDataProfilesService.defaultProfile;\n\t\t}\n\t\tif (this.uriIdentityService.extUri.isEqual(input.location, this.currentProfile.extensionsResource)) {\n\t\t\treturn this.currentProfile;\n\t\t}\n\t\treturn this.userDataProfilesService.profiles.find(p => this.uriIdentityService.extUri.isEqual(input.location, p.extensionsResource)) ?? this.currentProfile;\n\t}\n\n}\n\nexport function toExtensionDescription(extension: IScannedExtension, isUnderDevelopment: boolean): IExtensionDescription {\n\tconst id = getExtensionId(extension.manifest.publisher, extension.manifest.name);\n\treturn {\n\t\tid,\n\t\tidentifier: new ExtensionIdentifier(id),\n\t\tisBuiltin: extension.type === ExtensionType.System,\n\t\tisUserBuiltin: extension.type === ExtensionType.User && extension.isBuiltin,\n\t\tisUnderDevelopment,\n\t\textensionLocation: extension.location,\n\t\tuuid: extension.identifier.uuid,\n\t\ttargetPlatform: extension.targetPlatform,\n\t\tpublisherDisplayName: extension.publisherDisplayName,\n\t\tpreRelease: extension.preRelease,\n\t\t...extension.manifest,\n\t};\n}\n\nexport class NativeExtensionsScannerService extends AbstractExtensionsScannerService implements IExtensionsScannerService {\n\n\tprivate readonly translationsPromise: Promise<Translations>;\n\n\tconstructor(\n\t\tsystemExtensionsLocation: URI,\n\t\tuserExtensionsLocation: URI,\n\t\tuserHome: URI,\n\t\tcurrentProfile: IUserDataProfile,\n\t\tuserDataProfilesService: IUserDataProfilesService,\n\t\textensionsProfileScannerService: IExtensionsProfileScannerService,\n\t\tfileService: IFileService,\n\t\tlogService: ILogService,\n\t\tenvironmentService: IEnvironmentService,\n\t\tproductService: IProductService,\n\t\turiIdentityService: IUriIdentityService,\n\t\tinstantiationService: IInstantiationService,\n\t) {\n\t\tsuper(\n\t\t\tsystemExtensionsLocation,\n\t\t\tuserExtensionsLocation,\n\t\t\tjoinPath(userHome, '.vscode-oss-dev', 'extensions', 'control.json'),\n\t\t\tcurrentProfile,\n\t\t\tuserDataProfilesService, extensionsProfileScannerService, fileService, logService, environmentService, productService, uriIdentityService, instantiationService);\n\t\tthis.translationsPromise = (async () => {\n\t\t\tif (platform.translationsConfigFile) {\n\t\t\t\ttry {\n\t\t\t\t\tconst content = await this.fileService.readFile(URI.file(platform.translationsConfigFile));\n\t\t\t\t\treturn JSON.parse(content.value.toString());\n\t\t\t\t} catch (err) { /* Ignore Error */ }\n\t\t\t}\n\t\t\treturn Object.create(null);\n\t\t})();\n\t}\n\n\tprotected getTranslations(language: string): Promise<Translations> {\n\t\treturn this.translationsPromise;\n\t}\n\n}\n"]}