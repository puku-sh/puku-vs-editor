{"version":3,"sources":["vs/platform/extensionManagement/common/allowedExtensionsService.ts"],"names":[],"mappings":"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","file":"allowedExtensionsService.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Disposable } from '../../../base/common/lifecycle.js';\nimport * as nls from '../../../nls.js';\nimport { IGalleryExtension, AllowedExtensionsConfigKey, IAllowedExtensionsService, AllowedExtensionsConfigValueType } from './extensionManagement.js';\nimport { ExtensionType, IExtension, TargetPlatform } from '../../extensions/common/extensions.js';\nimport { IProductService } from '../../product/common/productService.js';\nimport { createCommandUri, IMarkdownString, MarkdownString } from '../../../base/common/htmlContent.js';\nimport { IConfigurationService } from '../../configuration/common/configuration.js';\nimport { isBoolean, isObject, isUndefined } from '../../../base/common/types.js';\nimport { Emitter } from '../../../base/common/event.js';\n\nfunction isGalleryExtension(extension: unknown): extension is IGalleryExtension {\n\treturn (extension as IGalleryExtension).type === 'gallery';\n}\n\nfunction isIExtension(extension: unknown): extension is IExtension {\n\treturn (extension as IExtension).type === ExtensionType.User || (extension as IExtension).type === ExtensionType.System;\n}\n\n\nconst VersionRegex = /^(?<version>\\d+\\.\\d+\\.\\d+(-.*)?)(@(?<platform>.+))?$/;\n\nexport class AllowedExtensionsService extends Disposable implements IAllowedExtensionsService {\n\n\t_serviceBrand: undefined;\n\n\tprivate readonly publisherOrgs: string[];\n\n\tprivate _allowedExtensionsConfigValue: AllowedExtensionsConfigValueType | undefined;\n\tget allowedExtensionsConfigValue(): AllowedExtensionsConfigValueType | undefined {\n\t\treturn this._allowedExtensionsConfigValue;\n\t}\n\tprivate _onDidChangeAllowedExtensions = this._register(new Emitter<void>());\n\treadonly onDidChangeAllowedExtensionsConfigValue = this._onDidChangeAllowedExtensions.event;\n\n\tconstructor(\n\t\t@IProductService productService: IProductService,\n\t\t@IConfigurationService protected readonly configurationService: IConfigurationService\n\t) {\n\t\tsuper();\n\t\tthis.publisherOrgs = productService.extensionPublisherOrgs?.map(p => p.toLowerCase()) ?? [];\n\t\tthis._allowedExtensionsConfigValue = this.getAllowedExtensionsValue();\n\t\tthis._register(this.configurationService.onDidChangeConfiguration(e => {\n\t\t\tif (e.affectsConfiguration(AllowedExtensionsConfigKey)) {\n\t\t\t\tthis._allowedExtensionsConfigValue = this.getAllowedExtensionsValue();\n\t\t\t\tthis._onDidChangeAllowedExtensions.fire();\n\t\t\t}\n\t\t}));\n\t}\n\n\tprivate getAllowedExtensionsValue(): AllowedExtensionsConfigValueType | undefined {\n\t\tconst value = this.configurationService.getValue<AllowedExtensionsConfigValueType | undefined>(AllowedExtensionsConfigKey);\n\t\tif (!isObject(value) || Array.isArray(value)) {\n\t\t\treturn undefined;\n\t\t}\n\t\tconst entries = Object.entries(value).map(([key, value]) => [key.toLowerCase(), value]);\n\t\tif (entries.length === 1 && entries[0][0] === '*' && entries[0][1] === true) {\n\t\t\treturn undefined;\n\t\t}\n\t\treturn Object.fromEntries(entries);\n\t}\n\n\tisAllowed(extension: IGalleryExtension | IExtension | { id: string; publisherDisplayName: string | undefined; version?: string; prerelease?: boolean; targetPlatform?: TargetPlatform }): true | IMarkdownString {\n\t\tif (!this._allowedExtensionsConfigValue) {\n\t\t\treturn true;\n\t\t}\n\n\t\tlet id: string, version: string, targetPlatform: TargetPlatform, prerelease: boolean, publisher: string, publisherDisplayName: string | undefined;\n\n\t\tif (isGalleryExtension(extension)) {\n\t\t\tid = extension.identifier.id.toLowerCase();\n\t\t\tversion = extension.version;\n\t\t\tprerelease = extension.properties.isPreReleaseVersion;\n\t\t\tpublisher = extension.publisher.toLowerCase();\n\t\t\tpublisherDisplayName = extension.publisherDisplayName.toLowerCase();\n\t\t\ttargetPlatform = extension.properties.targetPlatform;\n\t\t} else if (isIExtension(extension)) {\n\t\t\tid = extension.identifier.id.toLowerCase();\n\t\t\tversion = extension.manifest.version;\n\t\t\tprerelease = extension.preRelease;\n\t\t\tpublisher = extension.manifest.publisher.toLowerCase();\n\t\t\tpublisherDisplayName = extension.publisherDisplayName?.toLowerCase();\n\t\t\ttargetPlatform = extension.targetPlatform;\n\t\t} else {\n\t\t\tid = extension.id.toLowerCase();\n\t\t\tversion = extension.version ?? '*';\n\t\t\ttargetPlatform = extension.targetPlatform ?? TargetPlatform.UNIVERSAL;\n\t\t\tprerelease = extension.prerelease ?? false;\n\t\t\tpublisher = extension.id.substring(0, extension.id.indexOf('.')).toLowerCase();\n\t\t\tpublisherDisplayName = extension.publisherDisplayName?.toLowerCase();\n\t\t}\n\n\t\tconst settingsCommandLink = createCommandUri('workbench.action.openSettings', { query: `@id:${AllowedExtensionsConfigKey}` }).toString();\n\t\tconst extensionValue = this._allowedExtensionsConfigValue[id];\n\t\tconst extensionReason = new MarkdownString(nls.localize('specific extension not allowed', \"it is not in the [allowed list]({0})\", settingsCommandLink));\n\t\tif (!isUndefined(extensionValue)) {\n\t\t\tif (isBoolean(extensionValue)) {\n\t\t\t\treturn extensionValue ? true : extensionReason;\n\t\t\t}\n\t\t\tif (extensionValue === 'stable' && prerelease) {\n\t\t\t\treturn new MarkdownString(nls.localize('extension prerelease not allowed', \"the pre-release versions of this extension are not in the [allowed list]({0})\", settingsCommandLink));\n\t\t\t}\n\t\t\tif (version !== '*' && Array.isArray(extensionValue) && !extensionValue.some(v => {\n\t\t\t\tconst match = VersionRegex.exec(v);\n\t\t\t\tif (match && match.groups) {\n\t\t\t\t\tconst { platform: p, version: v } = match.groups;\n\t\t\t\t\tif (v !== version) {\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t\tif (targetPlatform !== TargetPlatform.UNIVERSAL && p && targetPlatform !== p) {\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t\treturn false;\n\t\t\t})) {\n\t\t\t\treturn new MarkdownString(nls.localize('specific version of extension not allowed', \"the version {0} of this extension is not in the [allowed list]({1})\", version, settingsCommandLink));\n\t\t\t}\n\t\t\treturn true;\n\t\t}\n\n\t\tconst publisherKey = publisherDisplayName && this.publisherOrgs.includes(publisherDisplayName) ? publisherDisplayName : publisher;\n\t\tconst publisherValue = this._allowedExtensionsConfigValue[publisherKey];\n\t\tif (!isUndefined(publisherValue)) {\n\t\t\tif (isBoolean(publisherValue)) {\n\t\t\t\treturn publisherValue ? true : new MarkdownString(nls.localize('publisher not allowed', \"the extensions from this publisher are not in the [allowed list]({1})\", publisherKey, settingsCommandLink));\n\t\t\t}\n\t\t\tif (publisherValue === 'stable' && prerelease) {\n\t\t\t\treturn new MarkdownString(nls.localize('prerelease versions from this publisher not allowed', \"the pre-release versions from this publisher are not in the [allowed list]({1})\", publisherKey, settingsCommandLink));\n\t\t\t}\n\t\t\treturn true;\n\t\t}\n\n\t\tif (this._allowedExtensionsConfigValue['*'] === true) {\n\t\t\treturn true;\n\t\t}\n\n\t\treturn extensionReason;\n\t}\n}\n"]}