{"version":3,"sources":["vs/platform/extensionManagement/common/abstractExtensionManagementService.ts"],"names":[],"mappings":"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","file":"abstractExtensionManagementService.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { distinct, isNonEmptyArray } from '../../../base/common/arrays.js';\nimport { Barrier, CancelablePromise, createCancelablePromise } from '../../../base/common/async.js';\nimport { CancellationToken } from '../../../base/common/cancellation.js';\nimport { CancellationError, getErrorMessage, isCancellationError } from '../../../base/common/errors.js';\nimport { Emitter, Event } from '../../../base/common/event.js';\nimport { Disposable, toDisposable } from '../../../base/common/lifecycle.js';\nimport { ResourceMap } from '../../../base/common/map.js';\nimport { isWeb } from '../../../base/common/platform.js';\nimport { URI } from '../../../base/common/uri.js';\nimport * as nls from '../../../nls.js';\nimport {\n\tExtensionManagementError, IExtensionGalleryService, IExtensionIdentifier, IExtensionManagementParticipant, IGalleryExtension, ILocalExtension, InstallOperation,\n\tIExtensionsControlManifest, StatisticType, isTargetPlatformCompatible, TargetPlatformToString, ExtensionManagementErrorCode,\n\tInstallOptions, UninstallOptions, Metadata, InstallExtensionEvent, DidUninstallExtensionEvent, InstallExtensionResult, UninstallExtensionEvent, IExtensionManagementService, InstallExtensionInfo, EXTENSION_INSTALL_DEP_PACK_CONTEXT, ExtensionGalleryError,\n\tIProductVersion, ExtensionGalleryErrorCode,\n\tEXTENSION_INSTALL_SOURCE_CONTEXT,\n\tDidUpdateExtensionMetadata,\n\tUninstallExtensionInfo,\n\tExtensionSignatureVerificationCode,\n\tIAllowedExtensionsService\n} from './extensionManagement.js';\nimport { areSameExtensions, ExtensionKey, getGalleryExtensionId, getGalleryExtensionTelemetryData, getLocalExtensionTelemetryData, isMalicious } from './extensionManagementUtil.js';\nimport { ExtensionType, IExtensionManifest, isApplicationScopedExtension, TargetPlatform } from '../../extensions/common/extensions.js';\nimport { areApiProposalsCompatible } from '../../extensions/common/extensionValidator.js';\nimport { ILogService } from '../../log/common/log.js';\nimport { IProductService } from '../../product/common/productService.js';\nimport { ITelemetryService } from '../../telemetry/common/telemetry.js';\nimport { IUriIdentityService } from '../../uriIdentity/common/uriIdentity.js';\nimport { IUserDataProfilesService } from '../../userDataProfile/common/userDataProfile.js';\nimport { IMarkdownString, MarkdownString } from '../../../base/common/htmlContent.js';\n\nexport type InstallableExtension = { readonly manifest: IExtensionManifest; extension: IGalleryExtension | URI; options: InstallOptions };\n\nexport type InstallExtensionTaskOptions = InstallOptions & { readonly profileLocation: URI; readonly productVersion: IProductVersion };\nexport interface IInstallExtensionTask {\n\treadonly manifest: IExtensionManifest;\n\treadonly identifier: IExtensionIdentifier;\n\treadonly source: IGalleryExtension | URI;\n\treadonly operation: InstallOperation;\n\treadonly options: InstallExtensionTaskOptions;\n\treadonly verificationStatus?: ExtensionSignatureVerificationCode;\n\trun(): Promise<ILocalExtension>;\n\twaitUntilTaskIsFinished(): Promise<ILocalExtension>;\n\tcancel(): void;\n}\n\nexport type UninstallExtensionTaskOptions = UninstallOptions & { readonly profileLocation: URI };\nexport interface IUninstallExtensionTask {\n\treadonly options: UninstallExtensionTaskOptions;\n\treadonly extension: ILocalExtension;\n\trun(): Promise<void>;\n\twaitUntilTaskIsFinished(): Promise<void>;\n\tcancel(): void;\n}\n\nexport abstract class CommontExtensionManagementService extends Disposable implements IExtensionManagementService {\n\n\t_serviceBrand: undefined;\n\n\treadonly preferPreReleases: boolean;\n\n\tconstructor(\n\t\t@IProductService protected readonly productService: IProductService,\n\t\t@IAllowedExtensionsService protected readonly allowedExtensionsService: IAllowedExtensionsService,\n\t) {\n\t\tsuper();\n\t\tthis.preferPreReleases = this.productService.quality !== 'stable';\n\t}\n\n\tasync canInstall(extension: IGalleryExtension): Promise<true | IMarkdownString> {\n\t\tconst allowedToInstall = this.allowedExtensionsService.isAllowed({ id: extension.identifier.id, publisherDisplayName: extension.publisherDisplayName });\n\t\tif (allowedToInstall !== true) {\n\t\t\treturn new MarkdownString(nls.localize('not allowed to install', \"This extension cannot be installed because {0}\", allowedToInstall.value));\n\t\t}\n\n\t\tif (!(await this.isExtensionPlatformCompatible(extension))) {\n\t\t\tconst learnLink = isWeb ? 'https://aka.ms/vscode-web-extensions-guide' : 'https://aka.ms/vscode-platform-specific-extensions';\n\t\t\treturn new MarkdownString(`${nls.localize('incompatible platform', \"The '{0}' extension is not available in {1} for the {2}.\",\n\t\t\t\textension.displayName ?? extension.identifier.id, this.productService.nameLong, TargetPlatformToString(await this.getTargetPlatform()))} [${nls.localize('learn why', \"Learn Why\")}](${learnLink})`);\n\t\t}\n\n\t\treturn true;\n\t}\n\n\tprotected async isExtensionPlatformCompatible(extension: IGalleryExtension): Promise<boolean> {\n\t\tconst currentTargetPlatform = await this.getTargetPlatform();\n\t\treturn extension.allTargetPlatforms.some(targetPlatform => isTargetPlatformCompatible(targetPlatform, extension.allTargetPlatforms, currentTargetPlatform));\n\t}\n\n\tabstract readonly onInstallExtension: Event<InstallExtensionEvent>;\n\tabstract readonly onDidInstallExtensions: Event<readonly InstallExtensionResult[]>;\n\tabstract readonly onUninstallExtension: Event<UninstallExtensionEvent>;\n\tabstract readonly onDidUninstallExtension: Event<DidUninstallExtensionEvent>;\n\tabstract readonly onDidUpdateExtensionMetadata: Event<DidUpdateExtensionMetadata>;\n\tabstract installFromGallery(extension: IGalleryExtension, options?: InstallOptions): Promise<ILocalExtension>;\n\tabstract installGalleryExtensions(extensions: InstallExtensionInfo[]): Promise<InstallExtensionResult[]>;\n\tabstract uninstall(extension: ILocalExtension, options?: UninstallOptions): Promise<void>;\n\tabstract uninstallExtensions(extensions: UninstallExtensionInfo[]): Promise<void>;\n\tabstract toggleApplicationScope(extension: ILocalExtension, fromProfileLocation: URI): Promise<ILocalExtension>;\n\tabstract getExtensionsControlManifest(): Promise<IExtensionsControlManifest>;\n\tabstract resetPinnedStateForAllUserExtensions(pinned: boolean): Promise<void>;\n\tabstract registerParticipant(pariticipant: IExtensionManagementParticipant): void;\n\tabstract getTargetPlatform(): Promise<TargetPlatform>;\n\tabstract zip(extension: ILocalExtension): Promise<URI>;\n\tabstract getManifest(vsix: URI): Promise<IExtensionManifest>;\n\tabstract install(vsix: URI, options?: InstallOptions): Promise<ILocalExtension>;\n\tabstract installFromLocation(location: URI, profileLocation: URI): Promise<ILocalExtension>;\n\tabstract installExtensionsFromProfile(extensions: IExtensionIdentifier[], fromProfileLocation: URI, toProfileLocation: URI): Promise<ILocalExtension[]>;\n\tabstract getInstalled(type?: ExtensionType, profileLocation?: URI, productVersion?: IProductVersion): Promise<ILocalExtension[]>;\n\tabstract copyExtensions(fromProfileLocation: URI, toProfileLocation: URI): Promise<void>;\n\tabstract download(extension: IGalleryExtension, operation: InstallOperation, donotVerifySignature: boolean): Promise<URI>;\n\tabstract cleanUp(): Promise<void>;\n\tabstract updateMetadata(local: ILocalExtension, metadata: Partial<Metadata>, profileLocation: URI): Promise<ILocalExtension>;\n}\n\nexport abstract class AbstractExtensionManagementService extends CommontExtensionManagementService implements IExtensionManagementService {\n\n\tdeclare readonly _serviceBrand: undefined;\n\n\tprivate extensionsControlManifest: Promise<IExtensionsControlManifest> | undefined;\n\tprivate lastReportTimestamp = 0;\n\tprivate readonly installingExtensions = new Map<string, { task: IInstallExtensionTask; waitingTasks: IInstallExtensionTask[] }>();\n\tprivate readonly uninstallingExtensions = new Map<string, IUninstallExtensionTask>();\n\n\tprivate readonly _onInstallExtension = this._register(new Emitter<InstallExtensionEvent>());\n\tget onInstallExtension() { return this._onInstallExtension.event; }\n\n\tprotected readonly _onDidInstallExtensions = this._register(new Emitter<InstallExtensionResult[]>());\n\tget onDidInstallExtensions() { return this._onDidInstallExtensions.event; }\n\n\tprotected readonly _onUninstallExtension = this._register(new Emitter<UninstallExtensionEvent>());\n\tget onUninstallExtension() { return this._onUninstallExtension.event; }\n\n\tprotected _onDidUninstallExtension = this._register(new Emitter<DidUninstallExtensionEvent>());\n\tget onDidUninstallExtension() { return this._onDidUninstallExtension.event; }\n\n\tprotected readonly _onDidUpdateExtensionMetadata = this._register(new Emitter<DidUpdateExtensionMetadata>());\n\tget onDidUpdateExtensionMetadata() { return this._onDidUpdateExtensionMetadata.event; }\n\n\tprivate readonly participants: IExtensionManagementParticipant[] = [];\n\n\tconstructor(\n\t\t@IExtensionGalleryService protected readonly galleryService: IExtensionGalleryService,\n\t\t@ITelemetryService protected readonly telemetryService: ITelemetryService,\n\t\t@IUriIdentityService protected readonly uriIdentityService: IUriIdentityService,\n\t\t@ILogService protected readonly logService: ILogService,\n\t\t@IProductService productService: IProductService,\n\t\t@IAllowedExtensionsService allowedExtensionsService: IAllowedExtensionsService,\n\t\t@IUserDataProfilesService protected readonly userDataProfilesService: IUserDataProfilesService,\n\t) {\n\t\tsuper(productService, allowedExtensionsService);\n\t\tthis._register(toDisposable(() => {\n\t\t\tthis.installingExtensions.forEach(({ task }) => task.cancel());\n\t\t\tthis.uninstallingExtensions.forEach(promise => promise.cancel());\n\t\t\tthis.installingExtensions.clear();\n\t\t\tthis.uninstallingExtensions.clear();\n\t\t}));\n\t}\n\n\tasync installFromGallery(extension: IGalleryExtension, options: InstallOptions = {}): Promise<ILocalExtension> {\n\t\ttry {\n\t\t\tconst results = await this.installGalleryExtensions([{ extension, options }]);\n\t\t\tconst result = results.find(({ identifier }) => areSameExtensions(identifier, extension.identifier));\n\t\t\tif (result?.local) {\n\t\t\t\treturn result?.local;\n\t\t\t}\n\t\t\tif (result?.error) {\n\t\t\t\tthrow result.error;\n\t\t\t}\n\t\t\tthrow new ExtensionManagementError(`Unknown error while installing extension ${extension.identifier.id}`, ExtensionManagementErrorCode.Unknown);\n\t\t} catch (error) {\n\t\t\tthrow toExtensionManagementError(error);\n\t\t}\n\t}\n\n\tasync installGalleryExtensions(extensions: InstallExtensionInfo[]): Promise<InstallExtensionResult[]> {\n\t\tif (!this.galleryService.isEnabled()) {\n\t\t\tthrow new ExtensionManagementError(nls.localize('MarketPlaceDisabled', \"Marketplace is not enabled\"), ExtensionManagementErrorCode.NotAllowed);\n\t\t}\n\n\t\tconst results: InstallExtensionResult[] = [];\n\t\tconst installableExtensions: InstallableExtension[] = [];\n\n\t\tawait Promise.allSettled(extensions.map(async ({ extension, options }) => {\n\t\t\ttry {\n\t\t\t\tconst compatible = await this.checkAndGetCompatibleVersion(extension, !!options?.installGivenVersion, !!options?.installPreReleaseVersion, options.productVersion ?? { version: this.productService.version, date: this.productService.date });\n\t\t\t\tinstallableExtensions.push({ ...compatible, options });\n\t\t\t} catch (error) {\n\t\t\t\tresults.push({ identifier: extension.identifier, operation: InstallOperation.Install, source: extension, error, profileLocation: options.profileLocation ?? this.getCurrentExtensionsManifestLocation() });\n\t\t\t}\n\t\t}));\n\n\t\tif (installableExtensions.length) {\n\t\t\tresults.push(...await this.installExtensions(installableExtensions));\n\t\t}\n\n\t\treturn results;\n\t}\n\n\tasync uninstall(extension: ILocalExtension, options?: UninstallOptions): Promise<void> {\n\t\tthis.logService.trace('ExtensionManagementService#uninstall', extension.identifier.id);\n\t\treturn this.uninstallExtensions([{ extension, options }]);\n\t}\n\n\tasync toggleApplicationScope(extension: ILocalExtension, fromProfileLocation: URI): Promise<ILocalExtension> {\n\t\tif (isApplicationScopedExtension(extension.manifest) || extension.isBuiltin) {\n\t\t\treturn extension;\n\t\t}\n\n\t\tif (extension.isApplicationScoped) {\n\t\t\tlet local = await this.updateMetadata(extension, { isApplicationScoped: false }, this.userDataProfilesService.defaultProfile.extensionsResource);\n\t\t\tif (!this.uriIdentityService.extUri.isEqual(fromProfileLocation, this.userDataProfilesService.defaultProfile.extensionsResource)) {\n\t\t\t\tlocal = await this.copyExtension(extension, this.userDataProfilesService.defaultProfile.extensionsResource, fromProfileLocation);\n\t\t\t}\n\n\t\t\tfor (const profile of this.userDataProfilesService.profiles) {\n\t\t\t\tconst existing = (await this.getInstalled(ExtensionType.User, profile.extensionsResource))\n\t\t\t\t\t.find(e => areSameExtensions(e.identifier, extension.identifier));\n\t\t\t\tif (existing) {\n\t\t\t\t\tthis._onDidUpdateExtensionMetadata.fire({ local: existing, profileLocation: profile.extensionsResource });\n\t\t\t\t} else {\n\t\t\t\t\tthis._onDidUninstallExtension.fire({ identifier: extension.identifier, profileLocation: profile.extensionsResource });\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn local;\n\t\t}\n\n\t\telse {\n\t\t\tconst local = this.uriIdentityService.extUri.isEqual(fromProfileLocation, this.userDataProfilesService.defaultProfile.extensionsResource)\n\t\t\t\t? await this.updateMetadata(extension, { isApplicationScoped: true }, this.userDataProfilesService.defaultProfile.extensionsResource)\n\t\t\t\t: await this.copyExtension(extension, fromProfileLocation, this.userDataProfilesService.defaultProfile.extensionsResource, { isApplicationScoped: true });\n\n\t\t\tthis._onDidInstallExtensions.fire([{ identifier: local.identifier, operation: InstallOperation.Install, local, profileLocation: this.userDataProfilesService.defaultProfile.extensionsResource, applicationScoped: true }]);\n\t\t\treturn local;\n\t\t}\n\n\t}\n\n\tgetExtensionsControlManifest(): Promise<IExtensionsControlManifest> {\n\t\tconst now = new Date().getTime();\n\n\t\tif (!this.extensionsControlManifest || now - this.lastReportTimestamp > 1000 * 60 * 5) { // 5 minute cache freshness\n\t\t\tthis.extensionsControlManifest = this.updateControlCache();\n\t\t\tthis.lastReportTimestamp = now;\n\t\t}\n\n\t\treturn this.extensionsControlManifest;\n\t}\n\n\tregisterParticipant(participant: IExtensionManagementParticipant): void {\n\t\tthis.participants.push(participant);\n\t}\n\n\tasync resetPinnedStateForAllUserExtensions(pinned: boolean): Promise<void> {\n\t\ttry {\n\t\t\tawait this.joinAllSettled(this.userDataProfilesService.profiles.map(\n\t\t\t\tasync profile => {\n\t\t\t\t\tconst extensions = await this.getInstalled(ExtensionType.User, profile.extensionsResource);\n\t\t\t\t\tawait this.joinAllSettled(extensions.map(\n\t\t\t\t\t\tasync extension => {\n\t\t\t\t\t\t\tif (extension.pinned !== pinned) {\n\t\t\t\t\t\t\t\tawait this.updateMetadata(extension, { pinned }, profile.extensionsResource);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}));\n\t\t\t\t}));\n\t\t} catch (error) {\n\t\t\tthis.logService.error('Error while resetting pinned state for all user extensions', getErrorMessage(error));\n\t\t\tthrow error;\n\t\t}\n\t}\n\n\tprotected async installExtensions(extensions: InstallableExtension[]): Promise<InstallExtensionResult[]> {\n\t\tconst installExtensionResultsMap = new Map<string, InstallExtensionResult & { profileLocation: URI }>();\n\t\tconst installingExtensionsMap = new Map<string, { task: IInstallExtensionTask; root: IInstallExtensionTask | undefined; uninstallTaskToWaitFor?: IUninstallExtensionTask }>();\n\t\tconst alreadyRequestedInstallations: Promise<ILocalExtension>[] = [];\n\n\t\tconst getInstallExtensionTaskKey = (extension: IGalleryExtension, profileLocation: URI) => `${ExtensionKey.create(extension).toString()}-${profileLocation.toString()}`;\n\t\tconst createInstallExtensionTask = (manifest: IExtensionManifest, extension: IGalleryExtension | URI, options: InstallExtensionTaskOptions, root: IInstallExtensionTask | undefined): void => {\n\t\t\tlet uninstallTaskToWaitFor;\n\t\t\tif (!URI.isUri(extension)) {\n\t\t\t\tif (installingExtensionsMap.has(`${extension.identifier.id.toLowerCase()}-${options.profileLocation.toString()}`)) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tconst existingInstallingExtension = this.installingExtensions.get(getInstallExtensionTaskKey(extension, options.profileLocation));\n\t\t\t\tif (existingInstallingExtension) {\n\t\t\t\t\tif (root && this.canWaitForTask(root, existingInstallingExtension.task)) {\n\t\t\t\t\t\tconst identifier = existingInstallingExtension.task.identifier;\n\t\t\t\t\t\tthis.logService.info('Waiting for already requested installing extension', identifier.id, root.identifier.id, options.profileLocation.toString());\n\t\t\t\t\t\texistingInstallingExtension.waitingTasks.push(root);\n\t\t\t\t\t\t// add promise that waits until the extension is completely installed, ie., onDidInstallExtensions event is triggered for this extension\n\t\t\t\t\t\talreadyRequestedInstallations.push(\n\t\t\t\t\t\t\tEvent.toPromise(\n\t\t\t\t\t\t\t\tEvent.filter(this.onDidInstallExtensions, results => results.some(result => areSameExtensions(result.identifier, identifier)))\n\t\t\t\t\t\t\t).then(results => {\n\t\t\t\t\t\t\t\tthis.logService.info('Finished waiting for already requested installing extension', identifier.id, root.identifier.id, options.profileLocation.toString());\n\t\t\t\t\t\t\t\tconst result = results.find(result => areSameExtensions(result.identifier, identifier));\n\t\t\t\t\t\t\t\tif (!result?.local) {\n\t\t\t\t\t\t\t\t\t// Extension failed to install\n\t\t\t\t\t\t\t\t\tthrow new Error(`Extension ${identifier.id} is not installed`);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\treturn result.local;\n\t\t\t\t\t\t\t}));\n\t\t\t\t\t}\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tuninstallTaskToWaitFor = this.uninstallingExtensions.get(this.getUninstallExtensionTaskKey(extension.identifier, options.profileLocation));\n\t\t\t}\n\t\t\tconst installExtensionTask = this.createInstallExtensionTask(manifest, extension, options);\n\t\t\tconst key = `${getGalleryExtensionId(manifest.publisher, manifest.name)}-${options.profileLocation.toString()}`;\n\t\t\tinstallingExtensionsMap.set(key, { task: installExtensionTask, root, uninstallTaskToWaitFor });\n\t\t\tthis._onInstallExtension.fire({ identifier: installExtensionTask.identifier, source: extension, profileLocation: options.profileLocation });\n\t\t\tthis.logService.info('Installing extension:', installExtensionTask.identifier.id, options);\n\t\t\t// only cache gallery extensions tasks\n\t\t\tif (!URI.isUri(extension)) {\n\t\t\t\tthis.installingExtensions.set(getInstallExtensionTaskKey(extension, options.profileLocation), { task: installExtensionTask, waitingTasks: [] });\n\t\t\t}\n\t\t};\n\n\t\ttry {\n\t\t\t// Start installing extensions\n\t\t\tfor (const { manifest, extension, options } of extensions) {\n\t\t\t\tconst isApplicationScoped = options.isApplicationScoped || options.isBuiltin || isApplicationScopedExtension(manifest);\n\t\t\t\tconst installExtensionTaskOptions: InstallExtensionTaskOptions = {\n\t\t\t\t\t...options,\n\t\t\t\t\tisApplicationScoped,\n\t\t\t\t\tprofileLocation: isApplicationScoped ? this.userDataProfilesService.defaultProfile.extensionsResource : options.profileLocation ?? this.getCurrentExtensionsManifestLocation(),\n\t\t\t\t\tproductVersion: options.productVersion ?? { version: this.productService.version, date: this.productService.date }\n\t\t\t\t};\n\n\t\t\t\tconst existingInstallExtensionTask = !URI.isUri(extension) ? this.installingExtensions.get(getInstallExtensionTaskKey(extension, installExtensionTaskOptions.profileLocation)) : undefined;\n\t\t\t\tif (existingInstallExtensionTask) {\n\t\t\t\t\tthis.logService.info('Extension is already requested to install', existingInstallExtensionTask.task.identifier.id, installExtensionTaskOptions.profileLocation.toString());\n\t\t\t\t\talreadyRequestedInstallations.push(existingInstallExtensionTask.task.waitUntilTaskIsFinished());\n\t\t\t\t} else {\n\t\t\t\t\tcreateInstallExtensionTask(manifest, extension, installExtensionTaskOptions, undefined);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// collect and start installing all dependencies and pack extensions\n\t\t\tawait Promise.all([...installingExtensionsMap.values()].map(async ({ task }) => {\n\t\t\t\tif (task.options.donotIncludePackAndDependencies) {\n\t\t\t\t\tthis.logService.info('Installing the extension without checking dependencies and pack', task.identifier.id);\n\t\t\t\t} else {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tlet preferPreRelease = this.preferPreReleases;\n\t\t\t\t\t\tif (task.options.installPreReleaseVersion) {\n\t\t\t\t\t\t\tpreferPreRelease = true;\n\t\t\t\t\t\t} else if (!URI.isUri(task.source) && task.source.hasPreReleaseVersion) {\n\t\t\t\t\t\t\t// Explicitly asked to install the release version\n\t\t\t\t\t\t\tpreferPreRelease = false;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tconst installed = await this.getInstalled(undefined, task.options.profileLocation, task.options.productVersion);\n\t\t\t\t\t\tconst allDepsAndPackExtensionsToInstall = await this.getAllDepsAndPackExtensions(task.identifier, task.manifest, preferPreRelease, task.options.productVersion, installed);\n\t\t\t\t\t\tconst options: InstallExtensionTaskOptions = { ...task.options, pinned: false, installGivenVersion: false, context: { ...task.options.context, [EXTENSION_INSTALL_DEP_PACK_CONTEXT]: true } };\n\t\t\t\t\t\tfor (const { gallery, manifest } of distinct(allDepsAndPackExtensionsToInstall, ({ gallery }) => gallery.identifier.id)) {\n\t\t\t\t\t\t\tconst existing = installed.find(e => areSameExtensions(e.identifier, gallery.identifier));\n\t\t\t\t\t\t\t// Skip if the extension is already installed and has the same application scope\n\t\t\t\t\t\t\tif (existing && existing.isApplicationScoped === !!options.isApplicationScoped) {\n\t\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tcreateInstallExtensionTask(manifest, gallery, options, task);\n\t\t\t\t\t\t}\n\t\t\t\t\t} catch (error) {\n\t\t\t\t\t\t// Installing through VSIX\n\t\t\t\t\t\tif (URI.isUri(task.source)) {\n\t\t\t\t\t\t\t// Ignore installing dependencies and packs\n\t\t\t\t\t\t\tif (isNonEmptyArray(task.manifest.extensionDependencies)) {\n\t\t\t\t\t\t\t\tthis.logService.warn(`Cannot install dependencies of extension:`, task.identifier.id, error.message);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (isNonEmptyArray(task.manifest.extensionPack)) {\n\t\t\t\t\t\t\t\tthis.logService.warn(`Cannot install packed extensions of extension:`, task.identifier.id, error.message);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tthis.logService.error('Error while preparing to install dependencies and extension packs of the extension:', task.identifier.id);\n\t\t\t\t\t\t\tthrow error;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}));\n\n\t\t\tconst otherProfilesToUpdate = await this.getOtherProfilesToUpdateExtension([...installingExtensionsMap.values()].map(({ task }) => task));\n\t\t\tfor (const [profileLocation, task] of otherProfilesToUpdate) {\n\t\t\t\tcreateInstallExtensionTask(task.manifest, task.source, { ...task.options, profileLocation }, undefined);\n\t\t\t}\n\n\t\t\t// Install extensions in parallel and wait until all extensions are installed / failed\n\t\t\tawait this.joinAllSettled([...installingExtensionsMap.entries()].map(async ([key, { task, uninstallTaskToWaitFor }]) => {\n\t\t\t\tconst startTime = new Date().getTime();\n\t\t\t\tlet local: ILocalExtension;\n\t\t\t\ttry {\n\t\t\t\t\tif (uninstallTaskToWaitFor) {\n\t\t\t\t\t\tthis.logService.info('Waiting for existing uninstall task to complete before installing', task.identifier.id);\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tawait uninstallTaskToWaitFor.waitUntilTaskIsFinished();\n\t\t\t\t\t\t\tthis.logService.info('Finished waiting for uninstall task, proceeding with install', task.identifier.id);\n\t\t\t\t\t\t} catch (error) {\n\t\t\t\t\t\t\tthis.logService.info('Uninstall task failed, proceeding with install anyway', task.identifier.id, getErrorMessage(error));\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tlocal = await task.run();\n\t\t\t\t\tawait this.joinAllSettled(this.participants.map(participant => participant.postInstall(local, task.source, task.options, CancellationToken.None)), ExtensionManagementErrorCode.PostInstall);\n\t\t\t\t} catch (e) {\n\t\t\t\t\tconst error = toExtensionManagementError(e);\n\t\t\t\t\tif (!URI.isUri(task.source)) {\n\t\t\t\t\t\treportTelemetry(this.telemetryService, task.operation === InstallOperation.Update ? 'extensionGallery:update' : 'extensionGallery:install', {\n\t\t\t\t\t\t\textensionData: getGalleryExtensionTelemetryData(task.source),\n\t\t\t\t\t\t\terror,\n\t\t\t\t\t\t\tsource: task.options.context?.[EXTENSION_INSTALL_SOURCE_CONTEXT] as string | undefined\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tinstallExtensionResultsMap.set(key, { error, identifier: task.identifier, operation: task.operation, source: task.source, context: task.options.context, profileLocation: task.options.profileLocation, applicationScoped: task.options.isApplicationScoped });\n\t\t\t\t\tthis.logService.error('Error while installing the extension', task.identifier.id, getErrorMessage(error), task.options.profileLocation.toString());\n\t\t\t\t\tthrow error;\n\t\t\t\t}\n\t\t\t\tif (!URI.isUri(task.source)) {\n\t\t\t\t\tconst isUpdate = task.operation === InstallOperation.Update;\n\t\t\t\t\tconst durationSinceUpdate = isUpdate ? undefined : (new Date().getTime() - task.source.lastUpdated) / 1000;\n\t\t\t\t\treportTelemetry(this.telemetryService, isUpdate ? 'extensionGallery:update' : 'extensionGallery:install', {\n\t\t\t\t\t\textensionData: getGalleryExtensionTelemetryData(task.source),\n\t\t\t\t\t\tverificationStatus: task.verificationStatus,\n\t\t\t\t\t\tduration: new Date().getTime() - startTime,\n\t\t\t\t\t\tdurationSinceUpdate,\n\t\t\t\t\t\tsource: task.options.context?.[EXTENSION_INSTALL_SOURCE_CONTEXT] as string | undefined\n\t\t\t\t\t});\n\t\t\t\t\t// In web, report extension install statistics explicitly. In Desktop, statistics are automatically updated while downloading the VSIX.\n\t\t\t\t\tif (isWeb && task.operation !== InstallOperation.Update) {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tawait this.galleryService.reportStatistic(local.manifest.publisher, local.manifest.name, local.manifest.version, StatisticType.Install);\n\t\t\t\t\t\t} catch (error) { /* ignore */ }\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tinstallExtensionResultsMap.set(key, { local, identifier: task.identifier, operation: task.operation, source: task.source, context: task.options.context, profileLocation: task.options.profileLocation, applicationScoped: local.isApplicationScoped });\n\t\t\t}));\n\n\t\t\tif (alreadyRequestedInstallations.length) {\n\t\t\t\tawait this.joinAllSettled(alreadyRequestedInstallations);\n\t\t\t}\n\t\t} catch (error) {\n\t\t\tconst getAllDepsAndPacks = (extension: ILocalExtension, profileLocation: URI, allDepsOrPacks: string[]) => {\n\t\t\t\tconst depsOrPacks = [];\n\t\t\t\tif (extension.manifest.extensionDependencies?.length) {\n\t\t\t\t\tdepsOrPacks.push(...extension.manifest.extensionDependencies);\n\t\t\t\t}\n\t\t\t\tif (extension.manifest.extensionPack?.length) {\n\t\t\t\t\tdepsOrPacks.push(...extension.manifest.extensionPack);\n\t\t\t\t}\n\t\t\t\tfor (const id of depsOrPacks) {\n\t\t\t\t\tif (allDepsOrPacks.includes(id.toLowerCase())) {\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\t\tallDepsOrPacks.push(id.toLowerCase());\n\t\t\t\t\tconst installed = installExtensionResultsMap.get(`${id.toLowerCase()}-${profileLocation.toString()}`);\n\t\t\t\t\tif (installed?.local) {\n\t\t\t\t\t\tallDepsOrPacks = getAllDepsAndPacks(installed.local, profileLocation, allDepsOrPacks);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn allDepsOrPacks;\n\t\t\t};\n\t\t\tconst getErrorResult = (task: IInstallExtensionTask) => ({ identifier: task.identifier, operation: InstallOperation.Install, source: task.source, context: task.options.context, profileLocation: task.options.profileLocation, error });\n\n\t\t\tconst rollbackTasks: IUninstallExtensionTask[] = [];\n\t\t\tfor (const [key, { task, root }] of installingExtensionsMap) {\n\t\t\t\tconst result = installExtensionResultsMap.get(key);\n\t\t\t\tif (!result) {\n\t\t\t\t\ttask.cancel();\n\t\t\t\t\tinstallExtensionResultsMap.set(key, getErrorResult(task));\n\t\t\t\t}\n\t\t\t\t// If the extension is installed by a root task and the root task is failed, then uninstall the extension\n\t\t\t\telse if (result.local && root && !installExtensionResultsMap.get(`${root.identifier.id.toLowerCase()}-${task.options.profileLocation.toString()}`)?.local) {\n\t\t\t\t\trollbackTasks.push(this.createUninstallExtensionTask(result.local, { versionOnly: true, profileLocation: task.options.profileLocation }));\n\t\t\t\t\tinstallExtensionResultsMap.set(key, getErrorResult(task));\n\t\t\t\t}\n\t\t\t}\n\t\t\tfor (const [key, { task }] of installingExtensionsMap) {\n\t\t\t\tconst result = installExtensionResultsMap.get(key);\n\t\t\t\tif (!result?.local) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tif (task.options.donotIncludePackAndDependencies) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tconst depsOrPacks = getAllDepsAndPacks(result.local, task.options.profileLocation, [result.local.identifier.id.toLowerCase()]).slice(1);\n\t\t\t\tif (depsOrPacks.some(depOrPack => installingExtensionsMap.has(`${depOrPack.toLowerCase()}-${task.options.profileLocation.toString()}`) && !installExtensionResultsMap.get(`${depOrPack.toLowerCase()}-${task.options.profileLocation.toString()}`)?.local)) {\n\t\t\t\t\trollbackTasks.push(this.createUninstallExtensionTask(result.local, { versionOnly: true, profileLocation: task.options.profileLocation }));\n\t\t\t\t\tinstallExtensionResultsMap.set(key, getErrorResult(task));\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (rollbackTasks.length) {\n\t\t\t\tawait Promise.allSettled(rollbackTasks.map(async rollbackTask => {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tawait rollbackTask.run();\n\t\t\t\t\t\tthis.logService.info('Rollback: Uninstalled extension', rollbackTask.extension.identifier.id);\n\t\t\t\t\t} catch (error) {\n\t\t\t\t\t\tthis.logService.warn('Rollback: Error while uninstalling extension', rollbackTask.extension.identifier.id, getErrorMessage(error));\n\t\t\t\t\t}\n\t\t\t\t}));\n\t\t\t}\n\t\t} finally {\n\t\t\t// Finally, remove all the tasks from the cache\n\t\t\tfor (const { task } of installingExtensionsMap.values()) {\n\t\t\t\tif (task.source && !URI.isUri(task.source)) {\n\t\t\t\t\tthis.installingExtensions.delete(getInstallExtensionTaskKey(task.source, task.options.profileLocation));\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tconst results = [...installExtensionResultsMap.values()];\n\t\tfor (const result of results) {\n\t\t\tif (result.local) {\n\t\t\t\tthis.logService.info(`Extension installed successfully:`, result.identifier.id, result.profileLocation.toString());\n\t\t\t}\n\t\t}\n\t\tthis._onDidInstallExtensions.fire(results);\n\t\treturn results;\n\t}\n\n\tprivate async getOtherProfilesToUpdateExtension(tasks: IInstallExtensionTask[]): Promise<[URI, IInstallExtensionTask][]> {\n\t\tconst otherProfilesToUpdate: [URI, IInstallExtensionTask][] = [];\n\t\tconst profileExtensionsCache = new ResourceMap<ILocalExtension[]>();\n\t\tfor (const task of tasks) {\n\t\t\tif (task.operation !== InstallOperation.Update\n\t\t\t\t|| task.options.isApplicationScoped\n\t\t\t\t|| task.options.pinned\n\t\t\t\t|| task.options.installGivenVersion\n\t\t\t\t|| URI.isUri(task.source)\n\t\t\t) {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tfor (const profile of this.userDataProfilesService.profiles) {\n\t\t\t\tif (this.uriIdentityService.extUri.isEqual(profile.extensionsResource, task.options.profileLocation)) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tlet installedExtensions = profileExtensionsCache.get(profile.extensionsResource);\n\t\t\t\tif (!installedExtensions) {\n\t\t\t\t\tinstalledExtensions = await this.getInstalled(ExtensionType.User, profile.extensionsResource);\n\t\t\t\t\tprofileExtensionsCache.set(profile.extensionsResource, installedExtensions);\n\t\t\t\t}\n\t\t\t\tconst installedExtension = installedExtensions.find(e => areSameExtensions(e.identifier, task.identifier));\n\t\t\t\tif (installedExtension && !installedExtension.pinned) {\n\t\t\t\t\totherProfilesToUpdate.push([profile.extensionsResource, task]);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn otherProfilesToUpdate;\n\t}\n\n\tprivate canWaitForTask(taskToWait: IInstallExtensionTask, taskToWaitFor: IInstallExtensionTask): boolean {\n\t\tfor (const [, { task, waitingTasks }] of this.installingExtensions.entries()) {\n\t\t\tif (task === taskToWait) {\n\t\t\t\t// Cannot be waited, If taskToWaitFor is waiting for taskToWait\n\t\t\t\tif (waitingTasks.includes(taskToWaitFor)) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t\t// Cannot be waited, If taskToWaitFor is waiting for tasks waiting for taskToWait\n\t\t\t\tif (waitingTasks.some(waitingTask => this.canWaitForTask(waitingTask, taskToWaitFor))) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t}\n\t\t\t// Cannot be waited, if the taskToWait cannot be waited for the task created the taskToWaitFor\n\t\t\t// Because, the task waits for the tasks it created\n\t\t\tif (task === taskToWaitFor && waitingTasks[0] && !this.canWaitForTask(taskToWait, waitingTasks[0])) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\t\treturn true;\n\t}\n\n\tprivate async joinAllSettled<T>(promises: Promise<T>[], errorCode?: ExtensionManagementErrorCode): Promise<T[]> {\n\t\tconst results: T[] = [];\n\t\tconst errors: ExtensionManagementError[] = [];\n\t\tconst promiseResults = await Promise.allSettled(promises);\n\t\tfor (const r of promiseResults) {\n\t\t\tif (r.status === 'fulfilled') {\n\t\t\t\tresults.push(r.value);\n\t\t\t} else {\n\t\t\t\terrors.push(toExtensionManagementError(r.reason, errorCode));\n\t\t\t}\n\t\t}\n\n\t\tif (!errors.length) {\n\t\t\treturn results;\n\t\t}\n\n\t\t// Throw if there are errors\n\t\tif (errors.length === 1) {\n\t\t\tthrow errors[0];\n\t\t}\n\n\t\tlet error = new ExtensionManagementError('', ExtensionManagementErrorCode.Unknown);\n\t\tfor (const current of errors) {\n\t\t\terror = new ExtensionManagementError(\n\t\t\t\terror.message ? `${error.message}, ${current.message}` : current.message,\n\t\t\t\tcurrent.code !== ExtensionManagementErrorCode.Unknown && current.code !== ExtensionManagementErrorCode.Internal ? current.code : error.code\n\t\t\t);\n\t\t}\n\t\tthrow error;\n\t}\n\n\tprivate async getAllDepsAndPackExtensions(extensionIdentifier: IExtensionIdentifier, manifest: IExtensionManifest, preferPreRelease: boolean, productVersion: IProductVersion, installed: ILocalExtension[]): Promise<{ gallery: IGalleryExtension; manifest: IExtensionManifest }[]> {\n\t\tif (!this.galleryService.isEnabled()) {\n\t\t\treturn [];\n\t\t}\n\n\t\tconst knownIdentifiers: IExtensionIdentifier[] = [];\n\n\t\tconst allDependenciesAndPacks: { gallery: IGalleryExtension; manifest: IExtensionManifest }[] = [];\n\t\tconst collectDependenciesAndPackExtensionsToInstall = async (extensionIdentifier: IExtensionIdentifier, manifest: IExtensionManifest): Promise<void> => {\n\t\t\tknownIdentifiers.push(extensionIdentifier);\n\t\t\tconst dependecies: string[] = manifest.extensionDependencies ? manifest.extensionDependencies.filter(dep => !installed.some(e => areSameExtensions(e.identifier, { id: dep }))) : [];\n\t\t\tconst dependenciesAndPackExtensions = [...dependecies];\n\t\t\tif (manifest.extensionPack) {\n\t\t\t\tconst existing = installed.find(e => areSameExtensions(e.identifier, extensionIdentifier));\n\t\t\t\tfor (const extension of manifest.extensionPack) {\n\t\t\t\t\t// add only those extensions which are new in currently installed extension\n\t\t\t\t\tif (!(existing && existing.manifest.extensionPack && existing.manifest.extensionPack.some(old => areSameExtensions({ id: old }, { id: extension })))) {\n\t\t\t\t\t\tif (dependenciesAndPackExtensions.every(e => !areSameExtensions({ id: e }, { id: extension }))) {\n\t\t\t\t\t\t\tdependenciesAndPackExtensions.push(extension);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (dependenciesAndPackExtensions.length) {\n\t\t\t\t// filter out known extensions\n\t\t\t\tconst ids = dependenciesAndPackExtensions.filter(id => knownIdentifiers.every(galleryIdentifier => !areSameExtensions(galleryIdentifier, { id })));\n\t\t\t\tif (ids.length) {\n\t\t\t\t\tconst galleryExtensions = await this.galleryService.getExtensions(ids.map(id => ({ id, preRelease: preferPreRelease })), CancellationToken.None);\n\t\t\t\t\tfor (const galleryExtension of galleryExtensions) {\n\t\t\t\t\t\tif (knownIdentifiers.find(identifier => areSameExtensions(identifier, galleryExtension.identifier))) {\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tconst isDependency = dependecies.some(id => areSameExtensions({ id }, galleryExtension.identifier));\n\t\t\t\t\t\tlet compatible;\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tcompatible = await this.checkAndGetCompatibleVersion(galleryExtension, false, preferPreRelease, productVersion);\n\t\t\t\t\t\t} catch (error) {\n\t\t\t\t\t\t\tif (!isDependency) {\n\t\t\t\t\t\t\t\tthis.logService.info('Skipping the packed extension as it cannot be installed', galleryExtension.identifier.id, getErrorMessage(error));\n\t\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tthrow error;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tallDependenciesAndPacks.push({ gallery: compatible.extension, manifest: compatible.manifest });\n\t\t\t\t\t\tawait collectDependenciesAndPackExtensionsToInstall(compatible.extension.identifier, compatible.manifest);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\tawait collectDependenciesAndPackExtensionsToInstall(extensionIdentifier, manifest);\n\t\treturn allDependenciesAndPacks;\n\t}\n\n\tprivate async checkAndGetCompatibleVersion(extension: IGalleryExtension, sameVersion: boolean, installPreRelease: boolean, productVersion: IProductVersion): Promise<{ extension: IGalleryExtension; manifest: IExtensionManifest }> {\n\t\tlet compatibleExtension: IGalleryExtension | null;\n\n\t\tconst extensionsControlManifest = await this.getExtensionsControlManifest();\n\t\tif (isMalicious(extension.identifier, extensionsControlManifest.malicious)) {\n\t\t\tthrow new ExtensionManagementError(nls.localize('malicious extension', \"Can't install '{0}' extension since it was reported to be problematic.\", extension.identifier.id), ExtensionManagementErrorCode.Malicious);\n\t\t}\n\n\t\tconst deprecationInfo = extensionsControlManifest.deprecated[extension.identifier.id.toLowerCase()];\n\t\tif (deprecationInfo?.extension?.autoMigrate) {\n\t\t\tthis.logService.info(`The '${extension.identifier.id}' extension is deprecated, fetching the compatible '${deprecationInfo.extension.id}' extension instead.`);\n\t\t\tcompatibleExtension = (await this.galleryService.getExtensions([{ id: deprecationInfo.extension.id, preRelease: deprecationInfo.extension.preRelease }], { targetPlatform: await this.getTargetPlatform(), compatible: true, productVersion }, CancellationToken.None))[0];\n\t\t\tif (!compatibleExtension) {\n\t\t\t\tthrow new ExtensionManagementError(nls.localize('notFoundDeprecatedReplacementExtension', \"Can't install '{0}' extension since it was deprecated and the replacement extension '{1}' can't be found.\", extension.identifier.id, deprecationInfo.extension.id), ExtensionManagementErrorCode.Deprecated);\n\t\t\t}\n\t\t}\n\n\t\telse {\n\t\t\tif (await this.canInstall(extension) !== true) {\n\t\t\t\tconst targetPlatform = await this.getTargetPlatform();\n\t\t\t\tthrow new ExtensionManagementError(nls.localize('incompatible platform', \"The '{0}' extension is not available in {1} for the {2}.\", extension.identifier.id, this.productService.nameLong, TargetPlatformToString(targetPlatform)), ExtensionManagementErrorCode.IncompatibleTargetPlatform);\n\t\t\t}\n\n\t\t\tcompatibleExtension = await this.getCompatibleVersion(extension, sameVersion, installPreRelease, productVersion);\n\t\t\tif (!compatibleExtension) {\n\t\t\t\tconst incompatibleApiProposalsMessages: string[] = [];\n\t\t\t\tif (!areApiProposalsCompatible(extension.properties.enabledApiProposals ?? [], incompatibleApiProposalsMessages)) {\n\t\t\t\t\tthrow new ExtensionManagementError(nls.localize('incompatibleAPI', \"Can't install '{0}' extension. {1}\", extension.displayName ?? extension.identifier.id, incompatibleApiProposalsMessages[0]), ExtensionManagementErrorCode.IncompatibleApi);\n\t\t\t\t}\n\t\t\t\t/** If no compatible release version is found, check if the extension has a release version or not and throw relevant error */\n\t\t\t\tif (!installPreRelease && extension.hasPreReleaseVersion && extension.properties.isPreReleaseVersion && (await this.galleryService.getExtensions([extension.identifier], CancellationToken.None))[0]) {\n\t\t\t\t\tthrow new ExtensionManagementError(nls.localize('notFoundReleaseExtension', \"Can't install release version of '{0}' extension because it has no release version.\", extension.displayName ?? extension.identifier.id), ExtensionManagementErrorCode.ReleaseVersionNotFound);\n\t\t\t\t}\n\t\t\t\tthrow new ExtensionManagementError(nls.localize('notFoundCompatibleDependency', \"Can't install '{0}' extension because it is not compatible with the current version of {1} (version {2}).\", extension.identifier.id, this.productService.nameLong, this.productService.version), ExtensionManagementErrorCode.Incompatible);\n\t\t\t}\n\t\t}\n\n\t\tthis.logService.info('Getting Manifest...', compatibleExtension.identifier.id);\n\t\tconst manifest = await this.galleryService.getManifest(compatibleExtension, CancellationToken.None);\n\t\tif (manifest === null) {\n\t\t\tthrow new ExtensionManagementError(`Missing manifest for extension ${compatibleExtension.identifier.id}`, ExtensionManagementErrorCode.Invalid);\n\t\t}\n\n\t\tif (manifest.version !== compatibleExtension.version) {\n\t\t\tthrow new ExtensionManagementError(`Cannot install '${compatibleExtension.identifier.id}' extension because of version mismatch in Marketplace`, ExtensionManagementErrorCode.Invalid);\n\t\t}\n\n\t\treturn { extension: compatibleExtension, manifest };\n\t}\n\n\tprotected async getCompatibleVersion(extension: IGalleryExtension, sameVersion: boolean, includePreRelease: boolean, productVersion: IProductVersion): Promise<IGalleryExtension | null> {\n\t\tconst targetPlatform = await this.getTargetPlatform();\n\t\tlet compatibleExtension: IGalleryExtension | null = null;\n\n\t\tif (!sameVersion && extension.hasPreReleaseVersion && extension.properties.isPreReleaseVersion !== includePreRelease) {\n\t\t\tcompatibleExtension = (await this.galleryService.getExtensions([{ ...extension.identifier, preRelease: includePreRelease }], { targetPlatform, compatible: true, productVersion }, CancellationToken.None))[0] || null;\n\t\t}\n\n\t\tif (!compatibleExtension && await this.galleryService.isExtensionCompatible(extension, includePreRelease, targetPlatform, productVersion)) {\n\t\t\tcompatibleExtension = extension;\n\t\t}\n\n\t\tif (!compatibleExtension) {\n\t\t\tif (sameVersion) {\n\t\t\t\tcompatibleExtension = (await this.galleryService.getExtensions([{ ...extension.identifier, version: extension.version }], { targetPlatform, compatible: true, productVersion }, CancellationToken.None))[0] || null;\n\t\t\t} else {\n\t\t\t\tcompatibleExtension = await this.galleryService.getCompatibleExtension(extension, includePreRelease, targetPlatform, productVersion);\n\t\t\t}\n\t\t}\n\n\t\treturn compatibleExtension;\n\t}\n\n\tprivate getUninstallExtensionTaskKey(identifier: IExtensionIdentifier, profileLocation: URI, version?: string): string {\n\t\treturn `${identifier.id.toLowerCase()}${version ? `-${version}` : ''}@${profileLocation.toString()}`;\n\t}\n\n\tasync uninstallExtensions(extensions: UninstallExtensionInfo[]): Promise<void> {\n\n\t\tconst getUninstallExtensionTaskKey = (extension: ILocalExtension, uninstallOptions: UninstallExtensionTaskOptions) => this.getUninstallExtensionTaskKey(extension.identifier, uninstallOptions.profileLocation, uninstallOptions.versionOnly ? extension.manifest.version : undefined);\n\n\t\tconst createUninstallExtensionTask = (extension: ILocalExtension, uninstallOptions: UninstallExtensionTaskOptions): void => {\n\t\t\tlet installTaskToWaitFor: IInstallExtensionTask | undefined;\n\t\t\tfor (const { task } of this.installingExtensions.values()) {\n\t\t\t\tif (!(task.source instanceof URI) && areSameExtensions(task.identifier, extension.identifier) && this.uriIdentityService.extUri.isEqual(task.options.profileLocation, uninstallOptions.profileLocation)) {\n\t\t\t\t\tinstallTaskToWaitFor = task;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t\tconst task = this.createUninstallExtensionTask(extension, uninstallOptions);\n\t\t\tthis.uninstallingExtensions.set(getUninstallExtensionTaskKey(task.extension, uninstallOptions), task);\n\t\t\tthis.logService.info('Uninstalling extension from the profile:', `${extension.identifier.id}@${extension.manifest.version}`, uninstallOptions.profileLocation.toString());\n\t\t\tthis._onUninstallExtension.fire({ identifier: extension.identifier, profileLocation: uninstallOptions.profileLocation, applicationScoped: extension.isApplicationScoped });\n\t\t\tallTasks.push({ task, installTaskToWaitFor });\n\t\t};\n\n\t\tconst postUninstallExtension = (extension: ILocalExtension, uninstallOptions: UninstallExtensionTaskOptions, error?: ExtensionManagementError): void => {\n\t\t\tif (error) {\n\t\t\t\tthis.logService.error('Failed to uninstall extension from the profile:', `${extension.identifier.id}@${extension.manifest.version}`, uninstallOptions.profileLocation.toString(), error.message);\n\t\t\t} else {\n\t\t\t\tthis.logService.info('Successfully uninstalled extension from the profile', `${extension.identifier.id}@${extension.manifest.version}`, uninstallOptions.profileLocation.toString());\n\t\t\t}\n\t\t\treportTelemetry(this.telemetryService, 'extensionGallery:uninstall', { extensionData: getLocalExtensionTelemetryData(extension), error });\n\t\t\tthis._onDidUninstallExtension.fire({ identifier: extension.identifier, error: error?.code, profileLocation: uninstallOptions.profileLocation, applicationScoped: extension.isApplicationScoped });\n\t\t};\n\n\t\tconst allTasks: { task: IUninstallExtensionTask; installTaskToWaitFor?: IInstallExtensionTask }[] = [];\n\t\tconst processedTasks: IUninstallExtensionTask[] = [];\n\t\tconst alreadyRequestedUninstalls: Promise<void>[] = [];\n\t\tconst extensionsToRemove: ILocalExtension[] = [];\n\n\t\tconst installedExtensionsMap = new ResourceMap<ILocalExtension[]>();\n\t\tconst getInstalledExtensions = async (profileLocation: URI) => {\n\t\t\tlet installed = installedExtensionsMap.get(profileLocation);\n\t\t\tif (!installed) {\n\t\t\t\tinstalledExtensionsMap.set(profileLocation, installed = await this.getInstalled(ExtensionType.User, profileLocation));\n\t\t\t}\n\t\t\treturn installed;\n\t\t};\n\n\t\tfor (const { extension, options } of extensions) {\n\t\t\tconst uninstallOptions: UninstallExtensionTaskOptions = {\n\t\t\t\t...options,\n\t\t\t\tprofileLocation: extension.isApplicationScoped ? this.userDataProfilesService.defaultProfile.extensionsResource : options?.profileLocation ?? this.getCurrentExtensionsManifestLocation()\n\t\t\t};\n\t\t\tconst uninstallExtensionTask = this.uninstallingExtensions.get(getUninstallExtensionTaskKey(extension, uninstallOptions));\n\t\t\tif (uninstallExtensionTask) {\n\t\t\t\tthis.logService.info('Extensions is already requested to uninstall', extension.identifier.id);\n\t\t\t\talreadyRequestedUninstalls.push(uninstallExtensionTask.waitUntilTaskIsFinished());\n\t\t\t} else {\n\t\t\t\tcreateUninstallExtensionTask(extension, uninstallOptions);\n\t\t\t}\n\n\t\t\tif (uninstallOptions.remove || extension.isApplicationScoped) {\n\t\t\t\tif (uninstallOptions.remove) {\n\t\t\t\t\textensionsToRemove.push(extension);\n\t\t\t\t}\n\t\t\t\tfor (const profile of this.userDataProfilesService.profiles) {\n\t\t\t\t\tif (this.uriIdentityService.extUri.isEqual(profile.extensionsResource, uninstallOptions.profileLocation)) {\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\t\tconst installed = await getInstalledExtensions(profile.extensionsResource);\n\t\t\t\t\tconst profileExtension = installed.find(e => areSameExtensions(e.identifier, extension.identifier));\n\t\t\t\t\tif (profileExtension) {\n\t\t\t\t\t\tconst uninstallOptionsWithProfile = { ...uninstallOptions, profileLocation: profile.extensionsResource };\n\t\t\t\t\t\tconst uninstallExtensionTask = this.uninstallingExtensions.get(getUninstallExtensionTaskKey(profileExtension, uninstallOptionsWithProfile));\n\t\t\t\t\t\tif (uninstallExtensionTask) {\n\t\t\t\t\t\t\tthis.logService.info('Extensions is already requested to uninstall', profileExtension.identifier.id);\n\t\t\t\t\t\t\talreadyRequestedUninstalls.push(uninstallExtensionTask.waitUntilTaskIsFinished());\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tcreateUninstallExtensionTask(profileExtension, uninstallOptionsWithProfile);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\ttry {\n\t\t\tfor (const { task } of allTasks.slice(0)) {\n\t\t\t\tconst installed = await getInstalledExtensions(task.options.profileLocation);\n\n\t\t\t\tif (task.options.donotIncludePack) {\n\t\t\t\t\tthis.logService.info('Uninstalling the extension without including packed extension', `${task.extension.identifier.id}@${task.extension.manifest.version}`);\n\t\t\t\t} else {\n\t\t\t\t\tconst packedExtensions = this.getAllPackExtensionsToUninstall(task.extension, installed);\n\t\t\t\t\tfor (const packedExtension of packedExtensions) {\n\t\t\t\t\t\tif (this.uninstallingExtensions.has(getUninstallExtensionTaskKey(packedExtension, task.options))) {\n\t\t\t\t\t\t\tthis.logService.info('Extensions is already requested to uninstall', packedExtension.identifier.id);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tcreateUninstallExtensionTask(packedExtension, task.options);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (task.options.donotCheckDependents) {\n\t\t\t\t\tthis.logService.info('Uninstalling the extension without checking dependents', `${task.extension.identifier.id}@${task.extension.manifest.version}`);\n\t\t\t\t} else {\n\t\t\t\t\tthis.checkForDependents(allTasks.map(({ task }) => task.extension), installed, task.extension);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Uninstall extensions in parallel and wait until all extensions are uninstalled / failed\n\t\t\tawait this.joinAllSettled(allTasks.map(async ({ task, installTaskToWaitFor }) => {\n\t\t\t\ttry {\n\t\t\t\t\t// Wait for opposite task if it exists\n\t\t\t\t\tif (installTaskToWaitFor) {\n\t\t\t\t\t\tthis.logService.info('Waiting for existing install task to complete before uninstalling', task.extension.identifier.id);\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tawait installTaskToWaitFor.waitUntilTaskIsFinished();\n\t\t\t\t\t\t\tthis.logService.info('Finished waiting for install task, proceeding with uninstall', task.extension.identifier.id);\n\t\t\t\t\t\t} catch (error) {\n\t\t\t\t\t\t\tthis.logService.info('Install task failed, proceeding with uninstall anyway', task.extension.identifier.id, getErrorMessage(error));\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tawait task.run();\n\t\t\t\t\tawait this.joinAllSettled(this.participants.map(participant => participant.postUninstall(task.extension, task.options, CancellationToken.None)));\n\t\t\t\t\t// only report if extension has a mapped gallery extension. UUID identifies the gallery extension.\n\t\t\t\t\tif (task.extension.identifier.uuid) {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tawait this.galleryService.reportStatistic(task.extension.manifest.publisher, task.extension.manifest.name, task.extension.manifest.version, StatisticType.Uninstall);\n\t\t\t\t\t\t} catch (error) { /* ignore */ }\n\t\t\t\t\t}\n\t\t\t\t} catch (e) {\n\t\t\t\t\tconst error = toExtensionManagementError(e);\n\t\t\t\t\tpostUninstallExtension(task.extension, task.options, error);\n\t\t\t\t\tthrow error;\n\t\t\t\t} finally {\n\t\t\t\t\tprocessedTasks.push(task);\n\t\t\t\t}\n\t\t\t}));\n\n\t\t\tif (alreadyRequestedUninstalls.length) {\n\t\t\t\tawait this.joinAllSettled(alreadyRequestedUninstalls);\n\t\t\t}\n\n\t\t\tfor (const { task } of allTasks) {\n\t\t\t\tpostUninstallExtension(task.extension, task.options);\n\t\t\t}\n\n\t\t\tif (extensionsToRemove.length) {\n\t\t\t\tawait this.joinAllSettled(extensionsToRemove.map(extension => this.deleteExtension(extension)));\n\t\t\t}\n\t\t} catch (e) {\n\t\t\tconst error = toExtensionManagementError(e);\n\t\t\tfor (const { task } of allTasks) {\n\t\t\t\t// cancel the tasks\n\t\t\t\ttry { task.cancel(); } catch (error) { /* ignore */ }\n\t\t\t\tif (!processedTasks.includes(task)) {\n\t\t\t\t\tpostUninstallExtension(task.extension, task.options, error);\n\t\t\t\t}\n\t\t\t}\n\t\t\tthrow error;\n\t\t} finally {\n\t\t\t// Remove tasks from cache\n\t\t\tfor (const { task } of allTasks) {\n\t\t\t\tif (!this.uninstallingExtensions.delete(getUninstallExtensionTaskKey(task.extension, task.options))) {\n\t\t\t\t\tthis.logService.warn('Uninstallation task is not found in the cache', task.extension.identifier.id);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate checkForDependents(extensionsToUninstall: ILocalExtension[], installed: ILocalExtension[], extensionToUninstall: ILocalExtension): void {\n\t\tfor (const extension of extensionsToUninstall) {\n\t\t\tconst dependents = this.getDependents(extension, installed);\n\t\t\tif (dependents.length) {\n\t\t\t\tconst remainingDependents = dependents.filter(dependent => !extensionsToUninstall.some(e => areSameExtensions(e.identifier, dependent.identifier)));\n\t\t\t\tif (remainingDependents.length) {\n\t\t\t\t\tthrow new Error(this.getDependentsErrorMessage(extension, remainingDependents, extensionToUninstall));\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate getDependentsErrorMessage(dependingExtension: ILocalExtension, dependents: ILocalExtension[], extensionToUninstall: ILocalExtension): string {\n\t\tif (extensionToUninstall === dependingExtension) {\n\t\t\tif (dependents.length === 1) {\n\t\t\t\treturn nls.localize('singleDependentError', \"Cannot uninstall '{0}' extension. '{1}' extension depends on this.\",\n\t\t\t\t\textensionToUninstall.manifest.displayName || extensionToUninstall.manifest.name, dependents[0].manifest.displayName || dependents[0].manifest.name);\n\t\t\t}\n\t\t\tif (dependents.length === 2) {\n\t\t\t\treturn nls.localize('twoDependentsError', \"Cannot uninstall '{0}' extension. '{1}' and '{2}' extensions depend on this.\",\n\t\t\t\t\textensionToUninstall.manifest.displayName || extensionToUninstall.manifest.name, dependents[0].manifest.displayName || dependents[0].manifest.name, dependents[1].manifest.displayName || dependents[1].manifest.name);\n\t\t\t}\n\t\t\treturn nls.localize('multipleDependentsError', \"Cannot uninstall '{0}' extension. '{1}', '{2}' and other extension depend on this.\",\n\t\t\t\textensionToUninstall.manifest.displayName || extensionToUninstall.manifest.name, dependents[0].manifest.displayName || dependents[0].manifest.name, dependents[1].manifest.displayName || dependents[1].manifest.name);\n\t\t}\n\t\tif (dependents.length === 1) {\n\t\t\treturn nls.localize('singleIndirectDependentError', \"Cannot uninstall '{0}' extension . It includes uninstalling '{1}' extension and '{2}' extension depends on this.\",\n\t\t\t\textensionToUninstall.manifest.displayName || extensionToUninstall.manifest.name, dependingExtension.manifest.displayName\n\t\t\t|| dependingExtension.manifest.name, dependents[0].manifest.displayName || dependents[0].manifest.name);\n\t\t}\n\t\tif (dependents.length === 2) {\n\t\t\treturn nls.localize('twoIndirectDependentsError', \"Cannot uninstall '{0}' extension. It includes uninstalling '{1}' extension and '{2}' and '{3}' extensions depend on this.\",\n\t\t\t\textensionToUninstall.manifest.displayName || extensionToUninstall.manifest.name, dependingExtension.manifest.displayName\n\t\t\t|| dependingExtension.manifest.name, dependents[0].manifest.displayName || dependents[0].manifest.name, dependents[1].manifest.displayName || dependents[1].manifest.name);\n\t\t}\n\t\treturn nls.localize('multipleIndirectDependentsError', \"Cannot uninstall '{0}' extension. It includes uninstalling '{1}' extension and '{2}', '{3}' and other extensions depend on this.\",\n\t\t\textensionToUninstall.manifest.displayName || extensionToUninstall.manifest.name, dependingExtension.manifest.displayName\n\t\t|| dependingExtension.manifest.name, dependents[0].manifest.displayName || dependents[0].manifest.name, dependents[1].manifest.displayName || dependents[1].manifest.name);\n\n\t}\n\n\tprivate getAllPackExtensionsToUninstall(extension: ILocalExtension, installed: ILocalExtension[], checked: ILocalExtension[] = []): ILocalExtension[] {\n\t\tif (checked.indexOf(extension) !== -1) {\n\t\t\treturn [];\n\t\t}\n\t\tchecked.push(extension);\n\t\tconst extensionsPack = extension.manifest.extensionPack ? extension.manifest.extensionPack : [];\n\t\tif (extensionsPack.length) {\n\t\t\tconst packedExtensions = installed.filter(i => !i.isBuiltin && extensionsPack.some(id => areSameExtensions({ id }, i.identifier)));\n\t\t\tconst packOfPackedExtensions: ILocalExtension[] = [];\n\t\t\tfor (const packedExtension of packedExtensions) {\n\t\t\t\tpackOfPackedExtensions.push(...this.getAllPackExtensionsToUninstall(packedExtension, installed, checked));\n\t\t\t}\n\t\t\treturn [...packedExtensions, ...packOfPackedExtensions];\n\t\t}\n\t\treturn [];\n\t}\n\n\tprivate getDependents(extension: ILocalExtension, installed: ILocalExtension[]): ILocalExtension[] {\n\t\treturn installed.filter(e => e.manifest.extensionDependencies && e.manifest.extensionDependencies.some(id => areSameExtensions({ id }, extension.identifier)));\n\t}\n\n\tprivate async updateControlCache(): Promise<IExtensionsControlManifest> {\n\t\ttry {\n\t\t\tthis.logService.trace('ExtensionManagementService.updateControlCache');\n\t\t\treturn await this.galleryService.getExtensionsControlManifest();\n\t\t} catch (err) {\n\t\t\tthis.logService.trace('ExtensionManagementService.refreshControlCache - failed to get extension control manifest', getErrorMessage(err));\n\t\t\treturn { malicious: [], deprecated: {}, search: [] };\n\t\t}\n\t}\n\n\tprotected abstract getCurrentExtensionsManifestLocation(): URI;\n\tprotected abstract createInstallExtensionTask(manifest: IExtensionManifest, extension: URI | IGalleryExtension, options: InstallExtensionTaskOptions): IInstallExtensionTask;\n\tprotected abstract createUninstallExtensionTask(extension: ILocalExtension, options: UninstallExtensionTaskOptions): IUninstallExtensionTask;\n\tprotected abstract copyExtension(extension: ILocalExtension, fromProfileLocation: URI, toProfileLocation: URI, metadata?: Partial<Metadata>): Promise<ILocalExtension>;\n\tprotected abstract moveExtension(extension: ILocalExtension, fromProfileLocation: URI, toProfileLocation: URI, metadata?: Partial<Metadata>): Promise<ILocalExtension>;\n\tprotected abstract removeExtension(extension: ILocalExtension, fromProfileLocation: URI): Promise<void>;\n\tprotected abstract deleteExtension(extension: ILocalExtension): Promise<void>;\n}\n\nexport function toExtensionManagementError(error: Error, code?: ExtensionManagementErrorCode): ExtensionManagementError {\n\tif (error instanceof ExtensionManagementError) {\n\t\treturn error;\n\t}\n\tlet extensionManagementError: ExtensionManagementError;\n\tif (error instanceof ExtensionGalleryError) {\n\t\textensionManagementError = new ExtensionManagementError(error.message, error.code === ExtensionGalleryErrorCode.DownloadFailedWriting ? ExtensionManagementErrorCode.DownloadFailedWriting : ExtensionManagementErrorCode.Gallery);\n\t} else {\n\t\textensionManagementError = new ExtensionManagementError(error.message, isCancellationError(error) ? ExtensionManagementErrorCode.Cancelled : (code ?? ExtensionManagementErrorCode.Internal));\n\t}\n\textensionManagementError.stack = error.stack;\n\treturn extensionManagementError;\n}\n\nfunction reportTelemetry(telemetryService: ITelemetryService, eventName: string,\n\t{\n\t\textensionData,\n\t\tverificationStatus,\n\t\tduration,\n\t\terror,\n\t\tsource,\n\t\tdurationSinceUpdate\n\t}: {\n\t\textensionData: object;\n\t\tverificationStatus?: ExtensionSignatureVerificationCode;\n\t\tduration?: number;\n\t\tdurationSinceUpdate?: number;\n\t\tsource?: string;\n\t\terror?: ExtensionManagementError | ExtensionGalleryError;\n\t}): void {\n\n\t/* __GDPR__\n\t\t\"extensionGallery:install\" : {\n\t\t\t\"owner\": \"sandy081\",\n\t\t\t\"success\": { \"classification\": \"SystemMetaData\", \"purpose\": \"PerformanceAndHealth\", \"isMeasurement\": true },\n\t\t\t\"duration\" : { \"classification\": \"SystemMetaData\", \"purpose\": \"PerformanceAndHealth\", \"isMeasurement\": true },\n\t\t\t\"durationSinceUpdate\" : { \"classification\": \"SystemMetaData\", \"purpose\": \"FeatureInsight\", \"isMeasurement\": true },\n\t\t\t\"errorcode\": { \"classification\": \"CallstackOrException\", \"purpose\": \"PerformanceAndHealth\" },\n\t\t\t\"recommendationReason\": { \"retiredFromVersion\": \"1.23.0\", \"classification\": \"SystemMetaData\", \"purpose\": \"FeatureInsight\", \"isMeasurement\": true },\n\t\t\t\"verificationStatus\" : { \"classification\": \"SystemMetaData\", \"purpose\": \"FeatureInsight\" },\n\t\t\t\"source\": { \"classification\": \"SystemMetaData\", \"purpose\": \"FeatureInsight\" },\n\t\t\t\"${include}\": [\n\t\t\t\t\"${GalleryExtensionTelemetryData}\"\n\t\t\t]\n\t\t}\n\t*/\n\t/* __GDPR__\n\t\t\"extensionGallery:uninstall\" : {\n\t\t\t\"owner\": \"sandy081\",\n\t\t\t\"success\": { \"classification\": \"SystemMetaData\", \"purpose\": \"PerformanceAndHealth\", \"isMeasurement\": true },\n\t\t\t\"duration\" : { \"classification\": \"SystemMetaData\", \"purpose\": \"PerformanceAndHealth\", \"isMeasurement\": true },\n\t\t\t\"errorcode\": { \"classification\": \"CallstackOrException\", \"purpose\": \"PerformanceAndHealth\" },\n\t\t\t\"${include}\": [\n\t\t\t\t\"${GalleryExtensionTelemetryData}\"\n\t\t\t]\n\t\t}\n\t*/\n\t/* __GDPR__\n\t\t\"extensionGallery:update\" : {\n\t\t\t\"owner\": \"sandy081\",\n\t\t\t\"success\": { \"classification\": \"SystemMetaData\", \"purpose\": \"PerformanceAndHealth\", \"isMeasurement\": true },\n\t\t\t\"duration\" : { \"classification\": \"SystemMetaData\", \"purpose\": \"PerformanceAndHealth\", \"isMeasurement\": true },\n\t\t\t\"errorcode\": { \"classification\": \"CallstackOrException\", \"purpose\": \"PerformanceAndHealth\" },\n\t\t\t\"verificationStatus\" : { \"classification\": \"SystemMetaData\", \"purpose\": \"FeatureInsight\" },\n\t\t\t\"source\": { \"classification\": \"SystemMetaData\", \"purpose\": \"FeatureInsight\" },\n\t\t\t\"${include}\": [\n\t\t\t\t\"${GalleryExtensionTelemetryData}\"\n\t\t\t]\n\t\t}\n\t*/\n\ttelemetryService.publicLog(eventName, {\n\t\t...extensionData,\n\t\tsource,\n\t\tduration,\n\t\tdurationSinceUpdate,\n\t\tsuccess: !error,\n\t\terrorcode: error?.code,\n\t\tverificationStatus: verificationStatus === ExtensionSignatureVerificationCode.Success ? 'Verified' : (verificationStatus ?? 'Unverified')\n\t});\n}\n\nexport abstract class AbstractExtensionTask<T> {\n\n\tprivate readonly barrier = new Barrier();\n\tprivate cancellablePromise: CancelablePromise<T> | undefined;\n\n\tasync waitUntilTaskIsFinished(): Promise<T> {\n\t\tawait this.barrier.wait();\n\t\treturn this.cancellablePromise!;\n\t}\n\n\trun(): Promise<T> {\n\t\tif (!this.cancellablePromise) {\n\t\t\tthis.cancellablePromise = createCancelablePromise(token => this.doRun(token));\n\t\t}\n\t\tthis.barrier.open();\n\t\treturn this.cancellablePromise;\n\t}\n\n\tcancel(): void {\n\t\tif (!this.cancellablePromise) {\n\t\t\tthis.cancellablePromise = createCancelablePromise(token => {\n\t\t\t\treturn new Promise((c, e) => {\n\t\t\t\t\tconst disposable = token.onCancellationRequested(() => {\n\t\t\t\t\t\tdisposable.dispose();\n\t\t\t\t\t\te(new CancellationError());\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t});\n\t\t\tthis.barrier.open();\n\t\t}\n\t\tthis.cancellablePromise.cancel();\n\t}\n\n\tprotected abstract doRun(token: CancellationToken): Promise<T>;\n}\n"]}