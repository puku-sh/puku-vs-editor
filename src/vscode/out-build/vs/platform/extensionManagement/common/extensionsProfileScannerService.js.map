{"version":3,"sources":["file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src/vs/platform/extensionManagement/common/extensionsProfileScannerService.ts","vs/platform/extensionManagement/common/extensionsProfileScannerService.ts"],"names":[],"mappings":"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","file":"extensionsProfileScannerService.js","sourceRoot":"file:///Users/sahamed/Desktop/puku-vs-editor/puku-editor/github/vscode/src","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Queue } from '../../../base/common/async.js';\nimport { VSBuffer } from '../../../base/common/buffer.js';\nimport { Disposable } from '../../../base/common/lifecycle.js';\nimport { Emitter, Event } from '../../../base/common/event.js';\nimport { ResourceMap } from '../../../base/common/map.js';\nimport { URI, UriComponents } from '../../../base/common/uri.js';\nimport { Metadata, isIExtensionIdentifier } from './extensionManagement.js';\nimport { areSameExtensions } from './extensionManagementUtil.js';\nimport { IExtension, IExtensionIdentifier } from '../../extensions/common/extensions.js';\nimport { FileOperationResult, IFileService, toFileOperationResult } from '../../files/common/files.js';\nimport { createDecorator } from '../../instantiation/common/instantiation.js';\nimport { ILogService } from '../../log/common/log.js';\nimport { IUserDataProfilesService } from '../../userDataProfile/common/userDataProfile.js';\nimport { IUriIdentityService } from '../../uriIdentity/common/uriIdentity.js';\nimport { Mutable, isObject, isString, isUndefined } from '../../../base/common/types.js';\nimport { getErrorMessage } from '../../../base/common/errors.js';\n\ninterface IStoredProfileExtension {\n\tidentifier: IExtensionIdentifier;\n\tlocation: UriComponents | string;\n\trelativeLocation: string | undefined;\n\tversion: string;\n\tmetadata?: Metadata;\n}\n\nexport const enum ExtensionsProfileScanningErrorCode {\n\n\t/**\n\t * Error when trying to scan extensions from a profile that does not exist.\n\t */\n\tERROR_PROFILE_NOT_FOUND = 'ERROR_PROFILE_NOT_FOUND',\n\n\t/**\n\t * Error when profile file is invalid.\n\t */\n\tERROR_INVALID_CONTENT = 'ERROR_INVALID_CONTENT',\n\n}\n\nexport class ExtensionsProfileScanningError extends Error {\n\tconstructor(message: string, public code: ExtensionsProfileScanningErrorCode) {\n\t\tsuper(message);\n\t}\n}\n\nexport interface IScannedProfileExtension {\n\treadonly identifier: IExtensionIdentifier;\n\treadonly version: string;\n\treadonly location: URI;\n\treadonly metadata?: Metadata;\n}\n\nexport interface ProfileExtensionsEvent {\n\treadonly extensions: readonly IScannedProfileExtension[];\n\treadonly profileLocation: URI;\n}\n\nexport interface DidAddProfileExtensionsEvent extends ProfileExtensionsEvent {\n\treadonly error?: Error;\n}\n\nexport interface DidRemoveProfileExtensionsEvent extends ProfileExtensionsEvent {\n\treadonly error?: Error;\n}\n\nexport interface IProfileExtensionsScanOptions {\n\treadonly bailOutWhenFileNotFound?: boolean;\n}\n\nexport const IExtensionsProfileScannerService = createDecorator<IExtensionsProfileScannerService>('IExtensionsProfileScannerService');\nexport interface IExtensionsProfileScannerService {\n\treadonly _serviceBrand: undefined;\n\n\treadonly onAddExtensions: Event<ProfileExtensionsEvent>;\n\treadonly onDidAddExtensions: Event<DidAddProfileExtensionsEvent>;\n\treadonly onRemoveExtensions: Event<ProfileExtensionsEvent>;\n\treadonly onDidRemoveExtensions: Event<DidRemoveProfileExtensionsEvent>;\n\n\tscanProfileExtensions(profileLocation: URI, options?: IProfileExtensionsScanOptions): Promise<IScannedProfileExtension[]>;\n\taddExtensionsToProfile(extensions: [IExtension, Metadata | undefined][], profileLocation: URI, keepExistingVersions?: boolean): Promise<IScannedProfileExtension[]>;\n\tupdateMetadata(extensions: [IExtension, Metadata | undefined][], profileLocation: URI): Promise<IScannedProfileExtension[]>;\n\tremoveExtensionsFromProfile(extensions: IExtensionIdentifier[], profileLocation: URI): Promise<void>;\n}\n\nexport abstract class AbstractExtensionsProfileScannerService extends Disposable implements IExtensionsProfileScannerService {\n\treadonly _serviceBrand: undefined;\n\n\tprivate readonly _onAddExtensions = this._register(new Emitter<ProfileExtensionsEvent>());\n\treadonly onAddExtensions = this._onAddExtensions.event;\n\n\tprivate readonly _onDidAddExtensions = this._register(new Emitter<DidAddProfileExtensionsEvent>());\n\treadonly onDidAddExtensions = this._onDidAddExtensions.event;\n\n\tprivate readonly _onRemoveExtensions = this._register(new Emitter<ProfileExtensionsEvent>());\n\treadonly onRemoveExtensions = this._onRemoveExtensions.event;\n\n\tprivate readonly _onDidRemoveExtensions = this._register(new Emitter<DidRemoveProfileExtensionsEvent>());\n\treadonly onDidRemoveExtensions = this._onDidRemoveExtensions.event;\n\n\tprivate readonly resourcesAccessQueueMap = new ResourceMap<Queue<IScannedProfileExtension[]>>();\n\n\tconstructor(\n\t\tprivate readonly extensionsLocation: URI,\n\t\t@IFileService private readonly fileService: IFileService,\n\t\t@IUserDataProfilesService private readonly userDataProfilesService: IUserDataProfilesService,\n\t\t@IUriIdentityService private readonly uriIdentityService: IUriIdentityService,\n\t\t@ILogService private readonly logService: ILogService,\n\t) {\n\t\tsuper();\n\t}\n\n\tscanProfileExtensions(profileLocation: URI, options?: IProfileExtensionsScanOptions): Promise<IScannedProfileExtension[]> {\n\t\treturn this.withProfileExtensions(profileLocation, undefined, options);\n\t}\n\n\tasync addExtensionsToProfile(extensions: [IExtension, Metadata | undefined][], profileLocation: URI, keepExistingVersions?: boolean): Promise<IScannedProfileExtension[]> {\n\t\tconst extensionsToRemove: IScannedProfileExtension[] = [];\n\t\tconst extensionsToAdd: IScannedProfileExtension[] = [];\n\t\ttry {\n\t\t\tawait this.withProfileExtensions(profileLocation, existingExtensions => {\n\t\t\t\tconst result: IScannedProfileExtension[] = [];\n\t\t\t\tif (keepExistingVersions) {\n\t\t\t\t\tresult.push(...existingExtensions);\n\t\t\t\t} else {\n\t\t\t\t\tfor (const existing of existingExtensions) {\n\t\t\t\t\t\tif (extensions.some(([e]) => areSameExtensions(e.identifier, existing.identifier) && e.manifest.version !== existing.version)) {\n\t\t\t\t\t\t\t// Remove the existing extension with different version\n\t\t\t\t\t\t\textensionsToRemove.push(existing);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tresult.push(existing);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tfor (const [extension, metadata] of extensions) {\n\t\t\t\t\tconst index = result.findIndex(e => areSameExtensions(e.identifier, extension.identifier) && e.version === extension.manifest.version);\n\t\t\t\t\tconst extensionToAdd = { identifier: extension.identifier, version: extension.manifest.version, location: extension.location, metadata };\n\t\t\t\t\tif (index === -1) {\n\t\t\t\t\t\textensionsToAdd.push(extensionToAdd);\n\t\t\t\t\t\tresult.push(extensionToAdd);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tresult.splice(index, 1, extensionToAdd);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (extensionsToAdd.length) {\n\t\t\t\t\tthis._onAddExtensions.fire({ extensions: extensionsToAdd, profileLocation });\n\t\t\t\t}\n\t\t\t\tif (extensionsToRemove.length) {\n\t\t\t\t\tthis._onRemoveExtensions.fire({ extensions: extensionsToRemove, profileLocation });\n\t\t\t\t}\n\t\t\t\treturn result;\n\t\t\t});\n\t\t\tif (extensionsToAdd.length) {\n\t\t\t\tthis._onDidAddExtensions.fire({ extensions: extensionsToAdd, profileLocation });\n\t\t\t}\n\t\t\tif (extensionsToRemove.length) {\n\t\t\t\tthis._onDidRemoveExtensions.fire({ extensions: extensionsToRemove, profileLocation });\n\t\t\t}\n\t\t\treturn extensionsToAdd;\n\t\t} catch (error) {\n\t\t\tif (extensionsToAdd.length) {\n\t\t\t\tthis._onDidAddExtensions.fire({ extensions: extensionsToAdd, error, profileLocation });\n\t\t\t}\n\t\t\tif (extensionsToRemove.length) {\n\t\t\t\tthis._onDidRemoveExtensions.fire({ extensions: extensionsToRemove, error, profileLocation });\n\t\t\t}\n\t\t\tthrow error;\n\t\t}\n\t}\n\n\tasync updateMetadata(extensions: [IExtension, Metadata][], profileLocation: URI): Promise<IScannedProfileExtension[]> {\n\t\tconst updatedExtensions: IScannedProfileExtension[] = [];\n\t\tawait this.withProfileExtensions(profileLocation, profileExtensions => {\n\t\t\tconst result: IScannedProfileExtension[] = [];\n\t\t\tfor (const profileExtension of profileExtensions) {\n\t\t\t\tconst extension = extensions.find(([e]) => areSameExtensions({ id: e.identifier.id }, { id: profileExtension.identifier.id }) && e.manifest.version === profileExtension.version);\n\t\t\t\tif (extension) {\n\t\t\t\t\tprofileExtension.metadata = { ...profileExtension.metadata, ...extension[1] };\n\t\t\t\t\tupdatedExtensions.push(profileExtension);\n\t\t\t\t\tresult.push(profileExtension);\n\t\t\t\t} else {\n\t\t\t\t\tresult.push(profileExtension);\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn result;\n\t\t});\n\t\treturn updatedExtensions;\n\t}\n\n\tasync removeExtensionsFromProfile(extensions: IExtensionIdentifier[], profileLocation: URI): Promise<void> {\n\t\tconst extensionsToRemove: IScannedProfileExtension[] = [];\n\t\ttry {\n\t\t\tawait this.withProfileExtensions(profileLocation, profileExtensions => {\n\t\t\t\tconst result: IScannedProfileExtension[] = [];\n\t\t\t\tfor (const e of profileExtensions) {\n\t\t\t\t\tif (extensions.some(extension => areSameExtensions(e.identifier, extension))) {\n\t\t\t\t\t\textensionsToRemove.push(e);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tresult.push(e);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (extensionsToRemove.length) {\n\t\t\t\t\tthis._onRemoveExtensions.fire({ extensions: extensionsToRemove, profileLocation });\n\t\t\t\t}\n\t\t\t\treturn result;\n\t\t\t});\n\t\t\tif (extensionsToRemove.length) {\n\t\t\t\tthis._onDidRemoveExtensions.fire({ extensions: extensionsToRemove, profileLocation });\n\t\t\t}\n\t\t} catch (error) {\n\t\t\tif (extensionsToRemove.length) {\n\t\t\t\tthis._onDidRemoveExtensions.fire({ extensions: extensionsToRemove, error, profileLocation });\n\t\t\t}\n\t\t\tthrow error;\n\t\t}\n\t}\n\n\tprivate async withProfileExtensions(file: URI, updateFn?: (extensions: Mutable<IScannedProfileExtension>[]) => IScannedProfileExtension[], options?: IProfileExtensionsScanOptions): Promise<IScannedProfileExtension[]> {\n\t\treturn this.getResourceAccessQueue(file).queue(async () => {\n\t\t\tlet extensions: IScannedProfileExtension[] = [];\n\n\t\t\t// Read\n\t\t\tlet storedProfileExtensions: IStoredProfileExtension[] | undefined;\n\t\t\ttry {\n\t\t\t\tconst content = await this.fileService.readFile(file);\n\t\t\t\tstoredProfileExtensions = JSON.parse(content.value.toString().trim() || '[]');\n\t\t\t} catch (error) {\n\t\t\t\tif (toFileOperationResult(error) !== FileOperationResult.FILE_NOT_FOUND) {\n\t\t\t\t\tthrow error;\n\t\t\t\t}\n\t\t\t\t// migrate from old location, remove this after couple of releases\n\t\t\t\tif (this.uriIdentityService.extUri.isEqual(file, this.userDataProfilesService.defaultProfile.extensionsResource)) {\n\t\t\t\t\tstoredProfileExtensions = await this.migrateFromOldDefaultProfileExtensionsLocation();\n\t\t\t\t}\n\t\t\t\tif (!storedProfileExtensions && options?.bailOutWhenFileNotFound) {\n\t\t\t\t\tthrow new ExtensionsProfileScanningError(getErrorMessage(error), ExtensionsProfileScanningErrorCode.ERROR_PROFILE_NOT_FOUND);\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (storedProfileExtensions) {\n\t\t\t\tif (!Array.isArray(storedProfileExtensions)) {\n\t\t\t\t\tthis.throwInvalidConentError(file);\n\t\t\t\t}\n\t\t\t\t// TODO @sandy081: Remove this migration after couple of releases\n\t\t\t\tlet migrate = false;\n\t\t\t\tfor (const e of storedProfileExtensions) {\n\t\t\t\t\tif (!isStoredProfileExtension(e)) {\n\t\t\t\t\t\tthis.throwInvalidConentError(file);\n\t\t\t\t\t}\n\t\t\t\t\tlet location: URI;\n\t\t\t\t\tif (isString(e.relativeLocation) && e.relativeLocation) {\n\t\t\t\t\t\t// Extension in new format. No migration needed.\n\t\t\t\t\t\tlocation = this.resolveExtensionLocation(e.relativeLocation);\n\t\t\t\t\t} else if (isString(e.location)) {\n\t\t\t\t\t\tthis.logService.warn(`Extensions profile: Ignoring extension with invalid location: ${e.location}`);\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tlocation = URI.revive(e.location);\n\t\t\t\t\t\tconst relativePath = this.toRelativePath(location);\n\t\t\t\t\t\tif (relativePath) {\n\t\t\t\t\t\t\t// Extension in old format. Migrate to new format.\n\t\t\t\t\t\t\tmigrate = true;\n\t\t\t\t\t\t\te.relativeLocation = relativePath;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif (isUndefined(e.metadata?.hasPreReleaseVersion) && e.metadata?.preRelease) {\n\t\t\t\t\t\tmigrate = true;\n\t\t\t\t\t\te.metadata.hasPreReleaseVersion = true;\n\t\t\t\t\t}\n\t\t\t\t\tconst uuid = e.metadata?.id ?? e.identifier.uuid;\n\t\t\t\t\textensions.push({\n\t\t\t\t\t\tidentifier: uuid ? { id: e.identifier.id, uuid } : { id: e.identifier.id },\n\t\t\t\t\t\tlocation,\n\t\t\t\t\t\tversion: e.version,\n\t\t\t\t\t\tmetadata: e.metadata,\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tif (migrate) {\n\t\t\t\t\tawait this.fileService.writeFile(file, VSBuffer.fromString(JSON.stringify(storedProfileExtensions)));\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Update\n\t\t\tif (updateFn) {\n\t\t\t\textensions = updateFn(extensions);\n\t\t\t\tconst storedProfileExtensions: IStoredProfileExtension[] = extensions.map(e => ({\n\t\t\t\t\tidentifier: e.identifier,\n\t\t\t\t\tversion: e.version,\n\t\t\t\t\t// retain old format so that old clients can read it\n\t\t\t\t\tlocation: e.location.toJSON(),\n\t\t\t\t\trelativeLocation: this.toRelativePath(e.location),\n\t\t\t\t\tmetadata: e.metadata\n\t\t\t\t}));\n\t\t\t\tawait this.fileService.writeFile(file, VSBuffer.fromString(JSON.stringify(storedProfileExtensions)));\n\t\t\t}\n\n\t\t\treturn extensions;\n\t\t});\n\t}\n\n\tprivate throwInvalidConentError(file: URI): void {\n\t\tthrow new ExtensionsProfileScanningError(`Invalid extensions content in ${file.toString()}`, ExtensionsProfileScanningErrorCode.ERROR_INVALID_CONTENT);\n\t}\n\n\tprivate toRelativePath(extensionLocation: URI): string | undefined {\n\t\treturn this.uriIdentityService.extUri.isEqual(this.uriIdentityService.extUri.dirname(extensionLocation), this.extensionsLocation)\n\t\t\t? this.uriIdentityService.extUri.basename(extensionLocation)\n\t\t\t: undefined;\n\t}\n\n\tprivate resolveExtensionLocation(path: string): URI {\n\t\treturn this.uriIdentityService.extUri.joinPath(this.extensionsLocation, path);\n\t}\n\n\tprivate _migrationPromise: Promise<IStoredProfileExtension[] | undefined> | undefined;\n\tprivate async migrateFromOldDefaultProfileExtensionsLocation(): Promise<IStoredProfileExtension[] | undefined> {\n\t\tif (!this._migrationPromise) {\n\t\t\tthis._migrationPromise = (async () => {\n\t\t\t\tconst oldDefaultProfileExtensionsLocation = this.uriIdentityService.extUri.joinPath(this.userDataProfilesService.defaultProfile.location, 'extensions.json');\n\t\t\t\tconst oldDefaultProfileExtensionsInitLocation = this.uriIdentityService.extUri.joinPath(this.extensionsLocation, '.init-default-profile-extensions');\n\t\t\t\tlet content: string;\n\t\t\t\ttry {\n\t\t\t\t\tcontent = (await this.fileService.readFile(oldDefaultProfileExtensionsLocation)).value.toString();\n\t\t\t\t} catch (error) {\n\t\t\t\t\tif (toFileOperationResult(error) === FileOperationResult.FILE_NOT_FOUND) {\n\t\t\t\t\t\treturn undefined;\n\t\t\t\t\t}\n\t\t\t\t\tthrow error;\n\t\t\t\t}\n\n\t\t\t\tthis.logService.info('Migrating extensions from old default profile location', oldDefaultProfileExtensionsLocation.toString());\n\t\t\t\tlet storedProfileExtensions: IStoredProfileExtension[] | undefined;\n\t\t\t\ttry {\n\t\t\t\t\tconst parsedData = JSON.parse(content);\n\t\t\t\t\tif (Array.isArray(parsedData) && parsedData.every(candidate => isStoredProfileExtension(candidate))) {\n\t\t\t\t\t\tstoredProfileExtensions = parsedData;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.logService.warn('Skipping migrating from old default profile locaiton: Found invalid data', parsedData);\n\t\t\t\t\t}\n\t\t\t\t} catch (error) {\n\t\t\t\t\t/* Ignore */\n\t\t\t\t\tthis.logService.error(error);\n\t\t\t\t}\n\n\t\t\t\tif (storedProfileExtensions) {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tawait this.fileService.createFile(this.userDataProfilesService.defaultProfile.extensionsResource, VSBuffer.fromString(JSON.stringify(storedProfileExtensions)), { overwrite: false });\n\t\t\t\t\t\tthis.logService.info('Migrated extensions from old default profile location to new location', oldDefaultProfileExtensionsLocation.toString(), this.userDataProfilesService.defaultProfile.extensionsResource.toString());\n\t\t\t\t\t} catch (error) {\n\t\t\t\t\t\tif (toFileOperationResult(error) === FileOperationResult.FILE_MODIFIED_SINCE) {\n\t\t\t\t\t\t\tthis.logService.info('Migration from old default profile location to new location is done by another window', oldDefaultProfileExtensionsLocation.toString(), this.userDataProfilesService.defaultProfile.extensionsResource.toString());\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tthrow error;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\ttry {\n\t\t\t\t\tawait this.fileService.del(oldDefaultProfileExtensionsLocation);\n\t\t\t\t} catch (error) {\n\t\t\t\t\tif (toFileOperationResult(error) !== FileOperationResult.FILE_NOT_FOUND) {\n\t\t\t\t\t\tthis.logService.error(error);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\ttry {\n\t\t\t\t\tawait this.fileService.del(oldDefaultProfileExtensionsInitLocation);\n\t\t\t\t} catch (error) {\n\t\t\t\t\tif (toFileOperationResult(error) !== FileOperationResult.FILE_NOT_FOUND) {\n\t\t\t\t\t\tthis.logService.error(error);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn storedProfileExtensions;\n\t\t\t})();\n\t\t}\n\t\treturn this._migrationPromise;\n\t}\n\n\tprivate getResourceAccessQueue(file: URI): Queue<IScannedProfileExtension[]> {\n\t\tlet resourceQueue = this.resourcesAccessQueueMap.get(file);\n\t\tif (!resourceQueue) {\n\t\t\tresourceQueue = new Queue<IScannedProfileExtension[]>();\n\t\t\tthis.resourcesAccessQueueMap.set(file, resourceQueue);\n\t\t}\n\t\treturn resourceQueue;\n\t}\n}\n\nfunction isStoredProfileExtension(obj: unknown): obj is IStoredProfileExtension {\n\tconst candidate = obj as IStoredProfileExtension | undefined;\n\treturn isObject(candidate)\n\t\t&& isIExtensionIdentifier(candidate.identifier)\n\t\t&& (isUriComponents(candidate.location) || (isString(candidate.location) && !!candidate.location))\n\t\t&& (isUndefined(candidate.relativeLocation) || isString(candidate.relativeLocation))\n\t\t&& !!candidate.version\n\t\t&& isString(candidate.version);\n}\n\nfunction isUriComponents(obj: unknown): obj is UriComponents {\n\tif (!obj) {\n\t\treturn false;\n\t}\n\tconst thing = obj as UriComponents | undefined;\n\treturn typeof thing?.path === 'string' &&\n\t\ttypeof thing?.scheme === 'string';\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Queue } from '../../../base/common/async.js';\nimport { VSBuffer } from '../../../base/common/buffer.js';\nimport { Disposable } from '../../../base/common/lifecycle.js';\nimport { Emitter, Event } from '../../../base/common/event.js';\nimport { ResourceMap } from '../../../base/common/map.js';\nimport { URI, UriComponents } from '../../../base/common/uri.js';\nimport { Metadata, isIExtensionIdentifier } from './extensionManagement.js';\nimport { areSameExtensions } from './extensionManagementUtil.js';\nimport { IExtension, IExtensionIdentifier } from '../../extensions/common/extensions.js';\nimport { FileOperationResult, IFileService, toFileOperationResult } from '../../files/common/files.js';\nimport { createDecorator } from '../../instantiation/common/instantiation.js';\nimport { ILogService } from '../../log/common/log.js';\nimport { IUserDataProfilesService } from '../../userDataProfile/common/userDataProfile.js';\nimport { IUriIdentityService } from '../../uriIdentity/common/uriIdentity.js';\nimport { Mutable, isObject, isString, isUndefined } from '../../../base/common/types.js';\nimport { getErrorMessage } from '../../../base/common/errors.js';\n\ninterface IStoredProfileExtension {\n\tidentifier: IExtensionIdentifier;\n\tlocation: UriComponents | string;\n\trelativeLocation: string | undefined;\n\tversion: string;\n\tmetadata?: Metadata;\n}\n\nexport const enum ExtensionsProfileScanningErrorCode {\n\n\t/**\n\t * Error when trying to scan extensions from a profile that does not exist.\n\t */\n\tERROR_PROFILE_NOT_FOUND = 'ERROR_PROFILE_NOT_FOUND',\n\n\t/**\n\t * Error when profile file is invalid.\n\t */\n\tERROR_INVALID_CONTENT = 'ERROR_INVALID_CONTENT',\n\n}\n\nexport class ExtensionsProfileScanningError extends Error {\n\tconstructor(message: string, public code: ExtensionsProfileScanningErrorCode) {\n\t\tsuper(message);\n\t}\n}\n\nexport interface IScannedProfileExtension {\n\treadonly identifier: IExtensionIdentifier;\n\treadonly version: string;\n\treadonly location: URI;\n\treadonly metadata?: Metadata;\n}\n\nexport interface ProfileExtensionsEvent {\n\treadonly extensions: readonly IScannedProfileExtension[];\n\treadonly profileLocation: URI;\n}\n\nexport interface DidAddProfileExtensionsEvent extends ProfileExtensionsEvent {\n\treadonly error?: Error;\n}\n\nexport interface DidRemoveProfileExtensionsEvent extends ProfileExtensionsEvent {\n\treadonly error?: Error;\n}\n\nexport interface IProfileExtensionsScanOptions {\n\treadonly bailOutWhenFileNotFound?: boolean;\n}\n\nexport const IExtensionsProfileScannerService = createDecorator<IExtensionsProfileScannerService>('IExtensionsProfileScannerService');\nexport interface IExtensionsProfileScannerService {\n\treadonly _serviceBrand: undefined;\n\n\treadonly onAddExtensions: Event<ProfileExtensionsEvent>;\n\treadonly onDidAddExtensions: Event<DidAddProfileExtensionsEvent>;\n\treadonly onRemoveExtensions: Event<ProfileExtensionsEvent>;\n\treadonly onDidRemoveExtensions: Event<DidRemoveProfileExtensionsEvent>;\n\n\tscanProfileExtensions(profileLocation: URI, options?: IProfileExtensionsScanOptions): Promise<IScannedProfileExtension[]>;\n\taddExtensionsToProfile(extensions: [IExtension, Metadata | undefined][], profileLocation: URI, keepExistingVersions?: boolean): Promise<IScannedProfileExtension[]>;\n\tupdateMetadata(extensions: [IExtension, Metadata | undefined][], profileLocation: URI): Promise<IScannedProfileExtension[]>;\n\tremoveExtensionsFromProfile(extensions: IExtensionIdentifier[], profileLocation: URI): Promise<void>;\n}\n\nexport abstract class AbstractExtensionsProfileScannerService extends Disposable implements IExtensionsProfileScannerService {\n\treadonly _serviceBrand: undefined;\n\n\tprivate readonly _onAddExtensions = this._register(new Emitter<ProfileExtensionsEvent>());\n\treadonly onAddExtensions = this._onAddExtensions.event;\n\n\tprivate readonly _onDidAddExtensions = this._register(new Emitter<DidAddProfileExtensionsEvent>());\n\treadonly onDidAddExtensions = this._onDidAddExtensions.event;\n\n\tprivate readonly _onRemoveExtensions = this._register(new Emitter<ProfileExtensionsEvent>());\n\treadonly onRemoveExtensions = this._onRemoveExtensions.event;\n\n\tprivate readonly _onDidRemoveExtensions = this._register(new Emitter<DidRemoveProfileExtensionsEvent>());\n\treadonly onDidRemoveExtensions = this._onDidRemoveExtensions.event;\n\n\tprivate readonly resourcesAccessQueueMap = new ResourceMap<Queue<IScannedProfileExtension[]>>();\n\n\tconstructor(\n\t\tprivate readonly extensionsLocation: URI,\n\t\t@IFileService private readonly fileService: IFileService,\n\t\t@IUserDataProfilesService private readonly userDataProfilesService: IUserDataProfilesService,\n\t\t@IUriIdentityService private readonly uriIdentityService: IUriIdentityService,\n\t\t@ILogService private readonly logService: ILogService,\n\t) {\n\t\tsuper();\n\t}\n\n\tscanProfileExtensions(profileLocation: URI, options?: IProfileExtensionsScanOptions): Promise<IScannedProfileExtension[]> {\n\t\treturn this.withProfileExtensions(profileLocation, undefined, options);\n\t}\n\n\tasync addExtensionsToProfile(extensions: [IExtension, Metadata | undefined][], profileLocation: URI, keepExistingVersions?: boolean): Promise<IScannedProfileExtension[]> {\n\t\tconst extensionsToRemove: IScannedProfileExtension[] = [];\n\t\tconst extensionsToAdd: IScannedProfileExtension[] = [];\n\t\ttry {\n\t\t\tawait this.withProfileExtensions(profileLocation, existingExtensions => {\n\t\t\t\tconst result: IScannedProfileExtension[] = [];\n\t\t\t\tif (keepExistingVersions) {\n\t\t\t\t\tresult.push(...existingExtensions);\n\t\t\t\t} else {\n\t\t\t\t\tfor (const existing of existingExtensions) {\n\t\t\t\t\t\tif (extensions.some(([e]) => areSameExtensions(e.identifier, existing.identifier) && e.manifest.version !== existing.version)) {\n\t\t\t\t\t\t\t// Remove the existing extension with different version\n\t\t\t\t\t\t\textensionsToRemove.push(existing);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tresult.push(existing);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tfor (const [extension, metadata] of extensions) {\n\t\t\t\t\tconst index = result.findIndex(e => areSameExtensions(e.identifier, extension.identifier) && e.version === extension.manifest.version);\n\t\t\t\t\tconst extensionToAdd = { identifier: extension.identifier, version: extension.manifest.version, location: extension.location, metadata };\n\t\t\t\t\tif (index === -1) {\n\t\t\t\t\t\textensionsToAdd.push(extensionToAdd);\n\t\t\t\t\t\tresult.push(extensionToAdd);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tresult.splice(index, 1, extensionToAdd);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (extensionsToAdd.length) {\n\t\t\t\t\tthis._onAddExtensions.fire({ extensions: extensionsToAdd, profileLocation });\n\t\t\t\t}\n\t\t\t\tif (extensionsToRemove.length) {\n\t\t\t\t\tthis._onRemoveExtensions.fire({ extensions: extensionsToRemove, profileLocation });\n\t\t\t\t}\n\t\t\t\treturn result;\n\t\t\t});\n\t\t\tif (extensionsToAdd.length) {\n\t\t\t\tthis._onDidAddExtensions.fire({ extensions: extensionsToAdd, profileLocation });\n\t\t\t}\n\t\t\tif (extensionsToRemove.length) {\n\t\t\t\tthis._onDidRemoveExtensions.fire({ extensions: extensionsToRemove, profileLocation });\n\t\t\t}\n\t\t\treturn extensionsToAdd;\n\t\t} catch (error) {\n\t\t\tif (extensionsToAdd.length) {\n\t\t\t\tthis._onDidAddExtensions.fire({ extensions: extensionsToAdd, error, profileLocation });\n\t\t\t}\n\t\t\tif (extensionsToRemove.length) {\n\t\t\t\tthis._onDidRemoveExtensions.fire({ extensions: extensionsToRemove, error, profileLocation });\n\t\t\t}\n\t\t\tthrow error;\n\t\t}\n\t}\n\n\tasync updateMetadata(extensions: [IExtension, Metadata][], profileLocation: URI): Promise<IScannedProfileExtension[]> {\n\t\tconst updatedExtensions: IScannedProfileExtension[] = [];\n\t\tawait this.withProfileExtensions(profileLocation, profileExtensions => {\n\t\t\tconst result: IScannedProfileExtension[] = [];\n\t\t\tfor (const profileExtension of profileExtensions) {\n\t\t\t\tconst extension = extensions.find(([e]) => areSameExtensions({ id: e.identifier.id }, { id: profileExtension.identifier.id }) && e.manifest.version === profileExtension.version);\n\t\t\t\tif (extension) {\n\t\t\t\t\tprofileExtension.metadata = { ...profileExtension.metadata, ...extension[1] };\n\t\t\t\t\tupdatedExtensions.push(profileExtension);\n\t\t\t\t\tresult.push(profileExtension);\n\t\t\t\t} else {\n\t\t\t\t\tresult.push(profileExtension);\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn result;\n\t\t});\n\t\treturn updatedExtensions;\n\t}\n\n\tasync removeExtensionsFromProfile(extensions: IExtensionIdentifier[], profileLocation: URI): Promise<void> {\n\t\tconst extensionsToRemove: IScannedProfileExtension[] = [];\n\t\ttry {\n\t\t\tawait this.withProfileExtensions(profileLocation, profileExtensions => {\n\t\t\t\tconst result: IScannedProfileExtension[] = [];\n\t\t\t\tfor (const e of profileExtensions) {\n\t\t\t\t\tif (extensions.some(extension => areSameExtensions(e.identifier, extension))) {\n\t\t\t\t\t\textensionsToRemove.push(e);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tresult.push(e);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (extensionsToRemove.length) {\n\t\t\t\t\tthis._onRemoveExtensions.fire({ extensions: extensionsToRemove, profileLocation });\n\t\t\t\t}\n\t\t\t\treturn result;\n\t\t\t});\n\t\t\tif (extensionsToRemove.length) {\n\t\t\t\tthis._onDidRemoveExtensions.fire({ extensions: extensionsToRemove, profileLocation });\n\t\t\t}\n\t\t} catch (error) {\n\t\t\tif (extensionsToRemove.length) {\n\t\t\t\tthis._onDidRemoveExtensions.fire({ extensions: extensionsToRemove, error, profileLocation });\n\t\t\t}\n\t\t\tthrow error;\n\t\t}\n\t}\n\n\tprivate async withProfileExtensions(file: URI, updateFn?: (extensions: Mutable<IScannedProfileExtension>[]) => IScannedProfileExtension[], options?: IProfileExtensionsScanOptions): Promise<IScannedProfileExtension[]> {\n\t\treturn this.getResourceAccessQueue(file).queue(async () => {\n\t\t\tlet extensions: IScannedProfileExtension[] = [];\n\n\t\t\t// Read\n\t\t\tlet storedProfileExtensions: IStoredProfileExtension[] | undefined;\n\t\t\ttry {\n\t\t\t\tconst content = await this.fileService.readFile(file);\n\t\t\t\tstoredProfileExtensions = JSON.parse(content.value.toString().trim() || '[]');\n\t\t\t} catch (error) {\n\t\t\t\tif (toFileOperationResult(error) !== FileOperationResult.FILE_NOT_FOUND) {\n\t\t\t\t\tthrow error;\n\t\t\t\t}\n\t\t\t\t// migrate from old location, remove this after couple of releases\n\t\t\t\tif (this.uriIdentityService.extUri.isEqual(file, this.userDataProfilesService.defaultProfile.extensionsResource)) {\n\t\t\t\t\tstoredProfileExtensions = await this.migrateFromOldDefaultProfileExtensionsLocation();\n\t\t\t\t}\n\t\t\t\tif (!storedProfileExtensions && options?.bailOutWhenFileNotFound) {\n\t\t\t\t\tthrow new ExtensionsProfileScanningError(getErrorMessage(error), ExtensionsProfileScanningErrorCode.ERROR_PROFILE_NOT_FOUND);\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (storedProfileExtensions) {\n\t\t\t\tif (!Array.isArray(storedProfileExtensions)) {\n\t\t\t\t\tthis.throwInvalidConentError(file);\n\t\t\t\t}\n\t\t\t\t// TODO @sandy081: Remove this migration after couple of releases\n\t\t\t\tlet migrate = false;\n\t\t\t\tfor (const e of storedProfileExtensions) {\n\t\t\t\t\tif (!isStoredProfileExtension(e)) {\n\t\t\t\t\t\tthis.throwInvalidConentError(file);\n\t\t\t\t\t}\n\t\t\t\t\tlet location: URI;\n\t\t\t\t\tif (isString(e.relativeLocation) && e.relativeLocation) {\n\t\t\t\t\t\t// Extension in new format. No migration needed.\n\t\t\t\t\t\tlocation = this.resolveExtensionLocation(e.relativeLocation);\n\t\t\t\t\t} else if (isString(e.location)) {\n\t\t\t\t\t\tthis.logService.warn(`Extensions profile: Ignoring extension with invalid location: ${e.location}`);\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tlocation = URI.revive(e.location);\n\t\t\t\t\t\tconst relativePath = this.toRelativePath(location);\n\t\t\t\t\t\tif (relativePath) {\n\t\t\t\t\t\t\t// Extension in old format. Migrate to new format.\n\t\t\t\t\t\t\tmigrate = true;\n\t\t\t\t\t\t\te.relativeLocation = relativePath;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif (isUndefined(e.metadata?.hasPreReleaseVersion) && e.metadata?.preRelease) {\n\t\t\t\t\t\tmigrate = true;\n\t\t\t\t\t\te.metadata.hasPreReleaseVersion = true;\n\t\t\t\t\t}\n\t\t\t\t\tconst uuid = e.metadata?.id ?? e.identifier.uuid;\n\t\t\t\t\textensions.push({\n\t\t\t\t\t\tidentifier: uuid ? { id: e.identifier.id, uuid } : { id: e.identifier.id },\n\t\t\t\t\t\tlocation,\n\t\t\t\t\t\tversion: e.version,\n\t\t\t\t\t\tmetadata: e.metadata,\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tif (migrate) {\n\t\t\t\t\tawait this.fileService.writeFile(file, VSBuffer.fromString(JSON.stringify(storedProfileExtensions)));\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Update\n\t\t\tif (updateFn) {\n\t\t\t\textensions = updateFn(extensions);\n\t\t\t\tconst storedProfileExtensions: IStoredProfileExtension[] = extensions.map(e => ({\n\t\t\t\t\tidentifier: e.identifier,\n\t\t\t\t\tversion: e.version,\n\t\t\t\t\t// retain old format so that old clients can read it\n\t\t\t\t\tlocation: e.location.toJSON(),\n\t\t\t\t\trelativeLocation: this.toRelativePath(e.location),\n\t\t\t\t\tmetadata: e.metadata\n\t\t\t\t}));\n\t\t\t\tawait this.fileService.writeFile(file, VSBuffer.fromString(JSON.stringify(storedProfileExtensions)));\n\t\t\t}\n\n\t\t\treturn extensions;\n\t\t});\n\t}\n\n\tprivate throwInvalidConentError(file: URI): void {\n\t\tthrow new ExtensionsProfileScanningError(`Invalid extensions content in ${file.toString()}`, ExtensionsProfileScanningErrorCode.ERROR_INVALID_CONTENT);\n\t}\n\n\tprivate toRelativePath(extensionLocation: URI): string | undefined {\n\t\treturn this.uriIdentityService.extUri.isEqual(this.uriIdentityService.extUri.dirname(extensionLocation), this.extensionsLocation)\n\t\t\t? this.uriIdentityService.extUri.basename(extensionLocation)\n\t\t\t: undefined;\n\t}\n\n\tprivate resolveExtensionLocation(path: string): URI {\n\t\treturn this.uriIdentityService.extUri.joinPath(this.extensionsLocation, path);\n\t}\n\n\tprivate _migrationPromise: Promise<IStoredProfileExtension[] | undefined> | undefined;\n\tprivate async migrateFromOldDefaultProfileExtensionsLocation(): Promise<IStoredProfileExtension[] | undefined> {\n\t\tif (!this._migrationPromise) {\n\t\t\tthis._migrationPromise = (async () => {\n\t\t\t\tconst oldDefaultProfileExtensionsLocation = this.uriIdentityService.extUri.joinPath(this.userDataProfilesService.defaultProfile.location, 'extensions.json');\n\t\t\t\tconst oldDefaultProfileExtensionsInitLocation = this.uriIdentityService.extUri.joinPath(this.extensionsLocation, '.init-default-profile-extensions');\n\t\t\t\tlet content: string;\n\t\t\t\ttry {\n\t\t\t\t\tcontent = (await this.fileService.readFile(oldDefaultProfileExtensionsLocation)).value.toString();\n\t\t\t\t} catch (error) {\n\t\t\t\t\tif (toFileOperationResult(error) === FileOperationResult.FILE_NOT_FOUND) {\n\t\t\t\t\t\treturn undefined;\n\t\t\t\t\t}\n\t\t\t\t\tthrow error;\n\t\t\t\t}\n\n\t\t\t\tthis.logService.info('Migrating extensions from old default profile location', oldDefaultProfileExtensionsLocation.toString());\n\t\t\t\tlet storedProfileExtensions: IStoredProfileExtension[] | undefined;\n\t\t\t\ttry {\n\t\t\t\t\tconst parsedData = JSON.parse(content);\n\t\t\t\t\tif (Array.isArray(parsedData) && parsedData.every(candidate => isStoredProfileExtension(candidate))) {\n\t\t\t\t\t\tstoredProfileExtensions = parsedData;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.logService.warn('Skipping migrating from old default profile locaiton: Found invalid data', parsedData);\n\t\t\t\t\t}\n\t\t\t\t} catch (error) {\n\t\t\t\t\t/* Ignore */\n\t\t\t\t\tthis.logService.error(error);\n\t\t\t\t}\n\n\t\t\t\tif (storedProfileExtensions) {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tawait this.fileService.createFile(this.userDataProfilesService.defaultProfile.extensionsResource, VSBuffer.fromString(JSON.stringify(storedProfileExtensions)), { overwrite: false });\n\t\t\t\t\t\tthis.logService.info('Migrated extensions from old default profile location to new location', oldDefaultProfileExtensionsLocation.toString(), this.userDataProfilesService.defaultProfile.extensionsResource.toString());\n\t\t\t\t\t} catch (error) {\n\t\t\t\t\t\tif (toFileOperationResult(error) === FileOperationResult.FILE_MODIFIED_SINCE) {\n\t\t\t\t\t\t\tthis.logService.info('Migration from old default profile location to new location is done by another window', oldDefaultProfileExtensionsLocation.toString(), this.userDataProfilesService.defaultProfile.extensionsResource.toString());\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tthrow error;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\ttry {\n\t\t\t\t\tawait this.fileService.del(oldDefaultProfileExtensionsLocation);\n\t\t\t\t} catch (error) {\n\t\t\t\t\tif (toFileOperationResult(error) !== FileOperationResult.FILE_NOT_FOUND) {\n\t\t\t\t\t\tthis.logService.error(error);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\ttry {\n\t\t\t\t\tawait this.fileService.del(oldDefaultProfileExtensionsInitLocation);\n\t\t\t\t} catch (error) {\n\t\t\t\t\tif (toFileOperationResult(error) !== FileOperationResult.FILE_NOT_FOUND) {\n\t\t\t\t\t\tthis.logService.error(error);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn storedProfileExtensions;\n\t\t\t})();\n\t\t}\n\t\treturn this._migrationPromise;\n\t}\n\n\tprivate getResourceAccessQueue(file: URI): Queue<IScannedProfileExtension[]> {\n\t\tlet resourceQueue = this.resourcesAccessQueueMap.get(file);\n\t\tif (!resourceQueue) {\n\t\t\tresourceQueue = new Queue<IScannedProfileExtension[]>();\n\t\t\tthis.resourcesAccessQueueMap.set(file, resourceQueue);\n\t\t}\n\t\treturn resourceQueue;\n\t}\n}\n\nfunction isStoredProfileExtension(obj: unknown): obj is IStoredProfileExtension {\n\tconst candidate = obj as IStoredProfileExtension | undefined;\n\treturn isObject(candidate)\n\t\t&& isIExtensionIdentifier(candidate.identifier)\n\t\t&& (isUriComponents(candidate.location) || (isString(candidate.location) && !!candidate.location))\n\t\t&& (isUndefined(candidate.relativeLocation) || isString(candidate.relativeLocation))\n\t\t&& !!candidate.version\n\t\t&& isString(candidate.version);\n}\n\nfunction isUriComponents(obj: unknown): obj is UriComponents {\n\tif (!obj) {\n\t\treturn false;\n\t}\n\tconst thing = obj as UriComponents | undefined;\n\treturn typeof thing?.path === 'string' &&\n\t\ttypeof thing?.scheme === 'string';\n}\n"]}